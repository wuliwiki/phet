// Copyright 2014-2022, University of Colorado Boulder

/**
 * Contains all of the model logic for the screen LeastSquaresRegressionScreen.
 *
 * @author Martin Veillette (Berea College)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import createObservableArray from '../../../../axon/js/createObservableArray.js';
import Emitter from '../../../../axon/js/Emitter.js';
import Property from '../../../../axon/js/Property.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Bucket from '../../../../phetcommon/js/model/Bucket.js';
import leastSquaresRegression from '../../leastSquaresRegression.js';
import DataPoint from './DataPoint.js';
import DataSet from './DataSet.js';
import Graph from './Graph.js';

// constants
const BUCKET_SIZE = new Dimension2(100, 55);
const BUCKET_POSITION = new Vector2(120, 480);
class LeastSquaresRegressionModel {
  constructor() {
    // @public {Property.<boolean>} controls the visibility of the graph grid
    this.showGridProperty = new BooleanProperty(false);

    // @public {Property.<Object>}  dataSet selected by the Combo Box: initially value set on Custom
    this.selectedDataSetProperty = new Property(DataSet.CUSTOM);

    // @public, sends an event when points are added in bulk
    this.dataPointsAddedEmitter = new Emitter();

    // Array of dataPoints in the model (may not be necessarily on the graph, could be user controlled outside the graph zone or animated)
    this.dataPoints = createObservableArray(); // @public

    // The various data Sets that populates the Combo Box
    // @public read-only
    this.dataSets = [];
    this.dataSets.push(DataSet.CUSTOM);
    this.dataSets.push(DataSet.HEIGHT_SHOE);
    this.dataSets.push(DataSet.SPENDING_SALARY);
    this.dataSets.push(DataSet.MORTALITY_YEAR);
    this.dataSets.push(DataSet.WAGE_YEAR);
    this.dataSets.push(DataSet.USER_YEAR);
    this.dataSets.push(DataSet.GASOLINE_YEAR);
    this.dataSets.push(DataSet.LIFE_TV);
    this.dataSets.push(DataSet.SPEED_DISTANCE);
    this.dataSets.push(DataSet.TEMPERATURE_FAHRENHEIT_CHIRP);
    this.dataSets.push(DataSet.TEMPERATURE_FAHRENHEIT_LONGITUDE);
    this.dataSets.push(DataSet.TEMPERATURE_FAHRENHEIT_LATITUDE);
    this.dataSets.push(DataSet.TEMPERATURE_CELSIUS_CHIRP);
    this.dataSets.push(DataSet.TEMPERATURE_CELSIUS_LONGITUDE);
    this.dataSets.push(DataSet.TEMPERATURE_CELSIUS_LATITUDE);

    // Model of the graph that contains all information regarding the composition of the graph
    // @public read-only
    this.graph = new Graph(this.selectedDataSetProperty.value.xRange, this.selectedDataSetProperty.value.yRange);

    // Bucket model to be filled with dataPoint
    // @public read-only
    this.bucket = new Bucket({
      position: BUCKET_POSITION,
      baseColor: '#000080',
      size: BUCKET_SIZE,
      invertY: true
    });

    // array for the CUSTOM dataPoints
    let savedCustomDataPoints = []; // {Array.<DataPoints>}

    // What to do when the selected Data Set changes. no need to unlink, present for the lifetime of the sim
    this.selectedDataSetProperty.link((selectedDataSet, oldSelectedDataSet) => {
      // saved the position data of CUSTOM if we are going from CUSTOM to another dataSet
      if (oldSelectedDataSet && oldSelectedDataSet === DataSet.CUSTOM) {
        // add the current dataPoints on graph to savedCustomDataPoints
        savedCustomDataPoints = this.graph.dataPointsOnGraph;
      }

      // unlink the listeners to dataPoints
      // this address an issue if one is userControlling a dataPoint while changing selecting a new dataSet (only possible with multitouch)
      //  see  https://github.com/phetsims/least-squares-regression/issues/11
      this.dispose();

      // Clear the dataPoints array
      this.dataPoints.clear();

      // Clear the residual arrays and the dataPointsOnGraph array
      this.graph.resetOnChangeOfDataSet();

      // Set the horizontal range, vertical range, and multiplicative factors for the slope and the intercept
      this.graph.setGraphDomain(selectedDataSet.xRange, selectedDataSet.yRange);

      // Populate the dataPoints array

      if (selectedDataSet === DataSet.CUSTOM) {
        // use the savedCustomDataPoints to populate the dataPoints array
        savedCustomDataPoints.forEach(dataPoint => {
          this.dataPoints.push(dataPoint);
        });
        // Add the Data Points on Graph and all the Residuals
        // For performance reason, we do it in bulk so that we don't constantly update the residuals after adding a dataPoint
        this.graph.addDataPointsOnGraphAndResidualsInBulk(this.dataPoints);
        this.dataPoints.forEach(dataPoint => {
          this.addDataPointControlledListener(dataPoint);
        });
      } else {
        // Populate the dataPoints array with the new SelectedDataSet
        selectedDataSet.dataXY.forEach(position => {
          // For your information, only one modelViewTransform is used throughout the simulation, the bounds of the model are set by the graph bounds
          // Rescale all the {X,Y} value to the normalized graph bounds
          const XNormalized = Utils.linear(selectedDataSet.xRange.min, selectedDataSet.xRange.max, this.graph.bounds.minX, this.graph.bounds.maxX, position.x);
          const YNormalized = Utils.linear(selectedDataSet.yRange.min, selectedDataSet.yRange.max, this.graph.bounds.minY, this.graph.bounds.maxY, position.y);
          const positionVector = new Vector2(XNormalized, YNormalized);
          this.dataPoints.push(new DataPoint(positionVector));
        });
        // Add the Data Points on Graph and all the Residuals
        // For performance reason, we do it in bulk so that we don't constantly update the residuals after adding a dataPoint
        this.graph.addDataPointsOnGraphAndResidualsInBulk(this.dataPoints);
      }
      // Since we added the dataPoints in Bulk, let's send a trigger to the view
      this.dataPointsAddedEmitter.emit();
    });
  }

  /**
   * Resets values to their original state
   * @public
   */
  reset() {
    this.showGridProperty.reset();
    this.selectedDataSetProperty.reset();
    this.dispose();
    this.dataPoints.clear();
    this.graph.reset();
  }

  /**
   * Unlink listeners to dataPoint. Listeners might have been removed when the data point was removed from the graph,
   * so check that they are still attached first.
   *
   * @private
   */
  dispose() {
    this.dataPoints.forEach(dataPoint => {
      if (dataPoint.positionProperty.hasListener(dataPoint.positionUpdateListener)) {
        dataPoint.positionProperty.unlink(dataPoint.positionUpdateListener);
      }
      if (dataPoint.userControlledProperty.hasListener(dataPoint.userControlledListener)) {
        dataPoint.userControlledProperty.unlink(dataPoint.userControlledListener);
      }
    });
  }

  /**
   * Function that animates all the dataPoints
   * @public
   */
  returnAllDataPointsToBucket() {
    this.dataPoints.forEach(dataPoint => {
      dataPoint.animate();
    });
  }

  /**
   * Function for adding new dataPoints to this model when the user creates them, generally by clicking on
   * some sort of creator node.
   * @public
   * @param {DataPoint} dataPoint
   */
  addUserCreatedDataPoint(dataPoint) {
    this.dataPoints.push(dataPoint);
    this.addDataPointControlledListener(dataPoint);
  }

  /**
   * Function that adds position listener and user Controlled listener;
   * Useful for dynamical points
   * @public
   *
   * @param {DataPoint} dataPoint
   */
  addDataPointControlledListener(dataPoint) {
    dataPoint.userControlledListener = userControlled => {
      const isOnGraph = this.graph.isDataPointPositionOverlappingGraph(dataPoint.positionProperty.value);
      if (!isOnGraph && !userControlled) {
        // return the dataPoint to the bucket
        dataPoint.animate();
      }
    };

    // Determine if the data Point is not user controlled and not on graph. If so let's animate it, i.e. return it to the bucket
    dataPoint.userControlledProperty.link(dataPoint.userControlledListener);

    // The dataPoint will be removed from the model if and when it returns to its origination point. This is how a dataPoint
    // can be 'put back' into the bucket. Listeners might have been removed when it was removed from the
    // graph so check to make sure listeners are still attached before unlinking.
    dataPoint.returnedToOriginListener = () => {
      if (this.dataPoints.includes(dataPoint)) {
        this.dataPoints.remove(dataPoint);
      }
      if (dataPoint.positionProperty.hasListener(dataPoint.positionUpdateListener)) {
        dataPoint.positionProperty.unlink(dataPoint.positionUpdateListener);
      }
      if (dataPoint.userControlledProperty.hasListener(dataPoint.userControlledProperty)) {
        dataPoint.userControlledProperty.unlink(dataPoint.userControlledListener);
      }
      if (dataPoint.returnedToOriginEmitter.hasListener(dataPoint.returnedToOriginListener)) {
        dataPoint.returnedToOriginEmitter.removeListener(dataPoint.returnedToOriginListener);
      }
    };
    dataPoint.returnedToOriginEmitter.addListener(dataPoint.returnedToOriginListener);
  }
}
leastSquaresRegression.register('LeastSquaresRegressionModel', LeastSquaresRegressionModel);
export default LeastSquaresRegressionModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJjcmVhdGVPYnNlcnZhYmxlQXJyYXkiLCJFbWl0dGVyIiwiUHJvcGVydHkiLCJEaW1lbnNpb24yIiwiVXRpbHMiLCJWZWN0b3IyIiwiQnVja2V0IiwibGVhc3RTcXVhcmVzUmVncmVzc2lvbiIsIkRhdGFQb2ludCIsIkRhdGFTZXQiLCJHcmFwaCIsIkJVQ0tFVF9TSVpFIiwiQlVDS0VUX1BPU0lUSU9OIiwiTGVhc3RTcXVhcmVzUmVncmVzc2lvbk1vZGVsIiwiY29uc3RydWN0b3IiLCJzaG93R3JpZFByb3BlcnR5Iiwic2VsZWN0ZWREYXRhU2V0UHJvcGVydHkiLCJDVVNUT00iLCJkYXRhUG9pbnRzQWRkZWRFbWl0dGVyIiwiZGF0YVBvaW50cyIsImRhdGFTZXRzIiwicHVzaCIsIkhFSUdIVF9TSE9FIiwiU1BFTkRJTkdfU0FMQVJZIiwiTU9SVEFMSVRZX1lFQVIiLCJXQUdFX1lFQVIiLCJVU0VSX1lFQVIiLCJHQVNPTElORV9ZRUFSIiwiTElGRV9UViIsIlNQRUVEX0RJU1RBTkNFIiwiVEVNUEVSQVRVUkVfRkFIUkVOSEVJVF9DSElSUCIsIlRFTVBFUkFUVVJFX0ZBSFJFTkhFSVRfTE9OR0lUVURFIiwiVEVNUEVSQVRVUkVfRkFIUkVOSEVJVF9MQVRJVFVERSIsIlRFTVBFUkFUVVJFX0NFTFNJVVNfQ0hJUlAiLCJURU1QRVJBVFVSRV9DRUxTSVVTX0xPTkdJVFVERSIsIlRFTVBFUkFUVVJFX0NFTFNJVVNfTEFUSVRVREUiLCJncmFwaCIsInZhbHVlIiwieFJhbmdlIiwieVJhbmdlIiwiYnVja2V0IiwicG9zaXRpb24iLCJiYXNlQ29sb3IiLCJzaXplIiwiaW52ZXJ0WSIsInNhdmVkQ3VzdG9tRGF0YVBvaW50cyIsImxpbmsiLCJzZWxlY3RlZERhdGFTZXQiLCJvbGRTZWxlY3RlZERhdGFTZXQiLCJkYXRhUG9pbnRzT25HcmFwaCIsImRpc3Bvc2UiLCJjbGVhciIsInJlc2V0T25DaGFuZ2VPZkRhdGFTZXQiLCJzZXRHcmFwaERvbWFpbiIsImZvckVhY2giLCJkYXRhUG9pbnQiLCJhZGREYXRhUG9pbnRzT25HcmFwaEFuZFJlc2lkdWFsc0luQnVsayIsImFkZERhdGFQb2ludENvbnRyb2xsZWRMaXN0ZW5lciIsImRhdGFYWSIsIlhOb3JtYWxpemVkIiwibGluZWFyIiwibWluIiwibWF4IiwiYm91bmRzIiwibWluWCIsIm1heFgiLCJ4IiwiWU5vcm1hbGl6ZWQiLCJtaW5ZIiwibWF4WSIsInkiLCJwb3NpdGlvblZlY3RvciIsImVtaXQiLCJyZXNldCIsInBvc2l0aW9uUHJvcGVydHkiLCJoYXNMaXN0ZW5lciIsInBvc2l0aW9uVXBkYXRlTGlzdGVuZXIiLCJ1bmxpbmsiLCJ1c2VyQ29udHJvbGxlZFByb3BlcnR5IiwidXNlckNvbnRyb2xsZWRMaXN0ZW5lciIsInJldHVybkFsbERhdGFQb2ludHNUb0J1Y2tldCIsImFuaW1hdGUiLCJhZGRVc2VyQ3JlYXRlZERhdGFQb2ludCIsInVzZXJDb250cm9sbGVkIiwiaXNPbkdyYXBoIiwiaXNEYXRhUG9pbnRQb3NpdGlvbk92ZXJsYXBwaW5nR3JhcGgiLCJyZXR1cm5lZFRvT3JpZ2luTGlzdGVuZXIiLCJpbmNsdWRlcyIsInJlbW92ZSIsInJldHVybmVkVG9PcmlnaW5FbWl0dGVyIiwicmVtb3ZlTGlzdGVuZXIiLCJhZGRMaXN0ZW5lciIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTGVhc3RTcXVhcmVzUmVncmVzc2lvbk1vZGVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIENvbnRhaW5zIGFsbCBvZiB0aGUgbW9kZWwgbG9naWMgZm9yIHRoZSBzY3JlZW4gTGVhc3RTcXVhcmVzUmVncmVzc2lvblNjcmVlbi5cclxuICpcclxuICogQGF1dGhvciBNYXJ0aW4gVmVpbGxldHRlIChCZXJlYSBDb2xsZWdlKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgY3JlYXRlT2JzZXJ2YWJsZUFycmF5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvY3JlYXRlT2JzZXJ2YWJsZUFycmF5LmpzJztcclxuaW1wb3J0IEVtaXR0ZXIgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbWl0dGVyLmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBCdWNrZXQgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy9tb2RlbC9CdWNrZXQuanMnO1xyXG5pbXBvcnQgbGVhc3RTcXVhcmVzUmVncmVzc2lvbiBmcm9tICcuLi8uLi9sZWFzdFNxdWFyZXNSZWdyZXNzaW9uLmpzJztcclxuaW1wb3J0IERhdGFQb2ludCBmcm9tICcuL0RhdGFQb2ludC5qcyc7XHJcbmltcG9ydCBEYXRhU2V0IGZyb20gJy4vRGF0YVNldC5qcyc7XHJcbmltcG9ydCBHcmFwaCBmcm9tICcuL0dyYXBoLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBCVUNLRVRfU0laRSA9IG5ldyBEaW1lbnNpb24yKCAxMDAsIDU1ICk7XHJcbmNvbnN0IEJVQ0tFVF9QT1NJVElPTiA9IG5ldyBWZWN0b3IyKCAxMjAsIDQ4MCApO1xyXG5cclxuY2xhc3MgTGVhc3RTcXVhcmVzUmVncmVzc2lvbk1vZGVsIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuXHJcbiAgICAvLyBAcHVibGljIHtQcm9wZXJ0eS48Ym9vbGVhbj59IGNvbnRyb2xzIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBncmFwaCBncmlkXHJcbiAgICB0aGlzLnNob3dHcmlkUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge1Byb3BlcnR5LjxPYmplY3Q+fSAgZGF0YVNldCBzZWxlY3RlZCBieSB0aGUgQ29tYm8gQm94OiBpbml0aWFsbHkgdmFsdWUgc2V0IG9uIEN1c3RvbVxyXG4gICAgdGhpcy5zZWxlY3RlZERhdGFTZXRQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggRGF0YVNldC5DVVNUT00gKTtcclxuXHJcbiAgICAvLyBAcHVibGljLCBzZW5kcyBhbiBldmVudCB3aGVuIHBvaW50cyBhcmUgYWRkZWQgaW4gYnVsa1xyXG4gICAgdGhpcy5kYXRhUG9pbnRzQWRkZWRFbWl0dGVyID0gbmV3IEVtaXR0ZXIoKTtcclxuXHJcbiAgICAvLyBBcnJheSBvZiBkYXRhUG9pbnRzIGluIHRoZSBtb2RlbCAobWF5IG5vdCBiZSBuZWNlc3NhcmlseSBvbiB0aGUgZ3JhcGgsIGNvdWxkIGJlIHVzZXIgY29udHJvbGxlZCBvdXRzaWRlIHRoZSBncmFwaCB6b25lIG9yIGFuaW1hdGVkKVxyXG4gICAgdGhpcy5kYXRhUG9pbnRzID0gY3JlYXRlT2JzZXJ2YWJsZUFycmF5KCk7IC8vIEBwdWJsaWNcclxuXHJcbiAgICAvLyBUaGUgdmFyaW91cyBkYXRhIFNldHMgdGhhdCBwb3B1bGF0ZXMgdGhlIENvbWJvIEJveFxyXG4gICAgLy8gQHB1YmxpYyByZWFkLW9ubHlcclxuICAgIHRoaXMuZGF0YVNldHMgPSBbXTtcclxuICAgIHRoaXMuZGF0YVNldHMucHVzaCggRGF0YVNldC5DVVNUT00gKTtcclxuICAgIHRoaXMuZGF0YVNldHMucHVzaCggRGF0YVNldC5IRUlHSFRfU0hPRSApO1xyXG4gICAgdGhpcy5kYXRhU2V0cy5wdXNoKCBEYXRhU2V0LlNQRU5ESU5HX1NBTEFSWSApO1xyXG4gICAgdGhpcy5kYXRhU2V0cy5wdXNoKCBEYXRhU2V0Lk1PUlRBTElUWV9ZRUFSICk7XHJcbiAgICB0aGlzLmRhdGFTZXRzLnB1c2goIERhdGFTZXQuV0FHRV9ZRUFSICk7XHJcbiAgICB0aGlzLmRhdGFTZXRzLnB1c2goIERhdGFTZXQuVVNFUl9ZRUFSICk7XHJcbiAgICB0aGlzLmRhdGFTZXRzLnB1c2goIERhdGFTZXQuR0FTT0xJTkVfWUVBUiApO1xyXG4gICAgdGhpcy5kYXRhU2V0cy5wdXNoKCBEYXRhU2V0LkxJRkVfVFYgKTtcclxuICAgIHRoaXMuZGF0YVNldHMucHVzaCggRGF0YVNldC5TUEVFRF9ESVNUQU5DRSApO1xyXG4gICAgdGhpcy5kYXRhU2V0cy5wdXNoKCBEYXRhU2V0LlRFTVBFUkFUVVJFX0ZBSFJFTkhFSVRfQ0hJUlAgKTtcclxuICAgIHRoaXMuZGF0YVNldHMucHVzaCggRGF0YVNldC5URU1QRVJBVFVSRV9GQUhSRU5IRUlUX0xPTkdJVFVERSApO1xyXG4gICAgdGhpcy5kYXRhU2V0cy5wdXNoKCBEYXRhU2V0LlRFTVBFUkFUVVJFX0ZBSFJFTkhFSVRfTEFUSVRVREUgKTtcclxuICAgIHRoaXMuZGF0YVNldHMucHVzaCggRGF0YVNldC5URU1QRVJBVFVSRV9DRUxTSVVTX0NISVJQICk7XHJcbiAgICB0aGlzLmRhdGFTZXRzLnB1c2goIERhdGFTZXQuVEVNUEVSQVRVUkVfQ0VMU0lVU19MT05HSVRVREUgKTtcclxuICAgIHRoaXMuZGF0YVNldHMucHVzaCggRGF0YVNldC5URU1QRVJBVFVSRV9DRUxTSVVTX0xBVElUVURFICk7XHJcblxyXG4gICAgLy8gTW9kZWwgb2YgdGhlIGdyYXBoIHRoYXQgY29udGFpbnMgYWxsIGluZm9ybWF0aW9uIHJlZ2FyZGluZyB0aGUgY29tcG9zaXRpb24gb2YgdGhlIGdyYXBoXHJcbiAgICAvLyBAcHVibGljIHJlYWQtb25seVxyXG4gICAgdGhpcy5ncmFwaCA9IG5ldyBHcmFwaChcclxuICAgICAgdGhpcy5zZWxlY3RlZERhdGFTZXRQcm9wZXJ0eS52YWx1ZS54UmFuZ2UsXHJcbiAgICAgIHRoaXMuc2VsZWN0ZWREYXRhU2V0UHJvcGVydHkudmFsdWUueVJhbmdlXHJcbiAgICApO1xyXG5cclxuICAgIC8vIEJ1Y2tldCBtb2RlbCB0byBiZSBmaWxsZWQgd2l0aCBkYXRhUG9pbnRcclxuICAgIC8vIEBwdWJsaWMgcmVhZC1vbmx5XHJcbiAgICB0aGlzLmJ1Y2tldCA9IG5ldyBCdWNrZXQoIHtcclxuICAgICAgcG9zaXRpb246IEJVQ0tFVF9QT1NJVElPTixcclxuICAgICAgYmFzZUNvbG9yOiAnIzAwMDA4MCcsXHJcbiAgICAgIHNpemU6IEJVQ0tFVF9TSVpFLFxyXG4gICAgICBpbnZlcnRZOiB0cnVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYXJyYXkgZm9yIHRoZSBDVVNUT00gZGF0YVBvaW50c1xyXG4gICAgbGV0IHNhdmVkQ3VzdG9tRGF0YVBvaW50cyA9IFtdOyAvLyB7QXJyYXkuPERhdGFQb2ludHM+fVxyXG5cclxuICAgIC8vIFdoYXQgdG8gZG8gd2hlbiB0aGUgc2VsZWN0ZWQgRGF0YSBTZXQgY2hhbmdlcy4gbm8gbmVlZCB0byB1bmxpbmssIHByZXNlbnQgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltXHJcbiAgICB0aGlzLnNlbGVjdGVkRGF0YVNldFByb3BlcnR5LmxpbmsoICggc2VsZWN0ZWREYXRhU2V0LCBvbGRTZWxlY3RlZERhdGFTZXQgKSA9PiB7XHJcblxyXG4gICAgICAvLyBzYXZlZCB0aGUgcG9zaXRpb24gZGF0YSBvZiBDVVNUT00gaWYgd2UgYXJlIGdvaW5nIGZyb20gQ1VTVE9NIHRvIGFub3RoZXIgZGF0YVNldFxyXG4gICAgICBpZiAoIG9sZFNlbGVjdGVkRGF0YVNldCAmJiBvbGRTZWxlY3RlZERhdGFTZXQgPT09IERhdGFTZXQuQ1VTVE9NICkge1xyXG4gICAgICAgIC8vIGFkZCB0aGUgY3VycmVudCBkYXRhUG9pbnRzIG9uIGdyYXBoIHRvIHNhdmVkQ3VzdG9tRGF0YVBvaW50c1xyXG4gICAgICAgIHNhdmVkQ3VzdG9tRGF0YVBvaW50cyA9IHRoaXMuZ3JhcGguZGF0YVBvaW50c09uR3JhcGg7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIHVubGluayB0aGUgbGlzdGVuZXJzIHRvIGRhdGFQb2ludHNcclxuICAgICAgLy8gdGhpcyBhZGRyZXNzIGFuIGlzc3VlIGlmIG9uZSBpcyB1c2VyQ29udHJvbGxpbmcgYSBkYXRhUG9pbnQgd2hpbGUgY2hhbmdpbmcgc2VsZWN0aW5nIGEgbmV3IGRhdGFTZXQgKG9ubHkgcG9zc2libGUgd2l0aCBtdWx0aXRvdWNoKVxyXG4gICAgICAvLyAgc2VlICBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbGVhc3Qtc3F1YXJlcy1yZWdyZXNzaW9uL2lzc3Vlcy8xMVxyXG4gICAgICB0aGlzLmRpc3Bvc2UoKTtcclxuXHJcbiAgICAgIC8vIENsZWFyIHRoZSBkYXRhUG9pbnRzIGFycmF5XHJcbiAgICAgIHRoaXMuZGF0YVBvaW50cy5jbGVhcigpO1xyXG5cclxuICAgICAgLy8gQ2xlYXIgdGhlIHJlc2lkdWFsIGFycmF5cyBhbmQgdGhlIGRhdGFQb2ludHNPbkdyYXBoIGFycmF5XHJcbiAgICAgIHRoaXMuZ3JhcGgucmVzZXRPbkNoYW5nZU9mRGF0YVNldCgpO1xyXG5cclxuICAgICAgLy8gU2V0IHRoZSBob3Jpem9udGFsIHJhbmdlLCB2ZXJ0aWNhbCByYW5nZSwgYW5kIG11bHRpcGxpY2F0aXZlIGZhY3RvcnMgZm9yIHRoZSBzbG9wZSBhbmQgdGhlIGludGVyY2VwdFxyXG4gICAgICB0aGlzLmdyYXBoLnNldEdyYXBoRG9tYWluKCBzZWxlY3RlZERhdGFTZXQueFJhbmdlLCBzZWxlY3RlZERhdGFTZXQueVJhbmdlICk7XHJcblxyXG4gICAgICAvLyBQb3B1bGF0ZSB0aGUgZGF0YVBvaW50cyBhcnJheVxyXG5cclxuICAgICAgaWYgKCBzZWxlY3RlZERhdGFTZXQgPT09IERhdGFTZXQuQ1VTVE9NICkge1xyXG4gICAgICAgIC8vIHVzZSB0aGUgc2F2ZWRDdXN0b21EYXRhUG9pbnRzIHRvIHBvcHVsYXRlIHRoZSBkYXRhUG9pbnRzIGFycmF5XHJcbiAgICAgICAgc2F2ZWRDdXN0b21EYXRhUG9pbnRzLmZvckVhY2goIGRhdGFQb2ludCA9PiB7XHJcbiAgICAgICAgICB0aGlzLmRhdGFQb2ludHMucHVzaCggZGF0YVBvaW50ICk7XHJcbiAgICAgICAgfSApO1xyXG4gICAgICAgIC8vIEFkZCB0aGUgRGF0YSBQb2ludHMgb24gR3JhcGggYW5kIGFsbCB0aGUgUmVzaWR1YWxzXHJcbiAgICAgICAgLy8gRm9yIHBlcmZvcm1hbmNlIHJlYXNvbiwgd2UgZG8gaXQgaW4gYnVsayBzbyB0aGF0IHdlIGRvbid0IGNvbnN0YW50bHkgdXBkYXRlIHRoZSByZXNpZHVhbHMgYWZ0ZXIgYWRkaW5nIGEgZGF0YVBvaW50XHJcbiAgICAgICAgdGhpcy5ncmFwaC5hZGREYXRhUG9pbnRzT25HcmFwaEFuZFJlc2lkdWFsc0luQnVsayggdGhpcy5kYXRhUG9pbnRzICk7XHJcbiAgICAgICAgdGhpcy5kYXRhUG9pbnRzLmZvckVhY2goIGRhdGFQb2ludCA9PiB7XHJcbiAgICAgICAgICB0aGlzLmFkZERhdGFQb2ludENvbnRyb2xsZWRMaXN0ZW5lciggZGF0YVBvaW50ICk7XHJcbiAgICAgICAgfSApO1xyXG5cclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICAvLyBQb3B1bGF0ZSB0aGUgZGF0YVBvaW50cyBhcnJheSB3aXRoIHRoZSBuZXcgU2VsZWN0ZWREYXRhU2V0XHJcbiAgICAgICAgc2VsZWN0ZWREYXRhU2V0LmRhdGFYWS5mb3JFYWNoKCBwb3NpdGlvbiA9PiB7XHJcbiAgICAgICAgICAvLyBGb3IgeW91ciBpbmZvcm1hdGlvbiwgb25seSBvbmUgbW9kZWxWaWV3VHJhbnNmb3JtIGlzIHVzZWQgdGhyb3VnaG91dCB0aGUgc2ltdWxhdGlvbiwgdGhlIGJvdW5kcyBvZiB0aGUgbW9kZWwgYXJlIHNldCBieSB0aGUgZ3JhcGggYm91bmRzXHJcbiAgICAgICAgICAvLyBSZXNjYWxlIGFsbCB0aGUge1gsWX0gdmFsdWUgdG8gdGhlIG5vcm1hbGl6ZWQgZ3JhcGggYm91bmRzXHJcbiAgICAgICAgICBjb25zdCBYTm9ybWFsaXplZCA9IFV0aWxzLmxpbmVhciggc2VsZWN0ZWREYXRhU2V0LnhSYW5nZS5taW4sIHNlbGVjdGVkRGF0YVNldC54UmFuZ2UubWF4LCB0aGlzLmdyYXBoLmJvdW5kcy5taW5YLCB0aGlzLmdyYXBoLmJvdW5kcy5tYXhYLCBwb3NpdGlvbi54ICk7XHJcbiAgICAgICAgICBjb25zdCBZTm9ybWFsaXplZCA9IFV0aWxzLmxpbmVhciggc2VsZWN0ZWREYXRhU2V0LnlSYW5nZS5taW4sIHNlbGVjdGVkRGF0YVNldC55UmFuZ2UubWF4LCB0aGlzLmdyYXBoLmJvdW5kcy5taW5ZLCB0aGlzLmdyYXBoLmJvdW5kcy5tYXhZLCBwb3NpdGlvbi55ICk7XHJcbiAgICAgICAgICBjb25zdCBwb3NpdGlvblZlY3RvciA9IG5ldyBWZWN0b3IyKCBYTm9ybWFsaXplZCwgWU5vcm1hbGl6ZWQgKTtcclxuICAgICAgICAgIHRoaXMuZGF0YVBvaW50cy5wdXNoKCBuZXcgRGF0YVBvaW50KCBwb3NpdGlvblZlY3RvciApICk7XHJcbiAgICAgICAgfSApO1xyXG4gICAgICAgIC8vIEFkZCB0aGUgRGF0YSBQb2ludHMgb24gR3JhcGggYW5kIGFsbCB0aGUgUmVzaWR1YWxzXHJcbiAgICAgICAgLy8gRm9yIHBlcmZvcm1hbmNlIHJlYXNvbiwgd2UgZG8gaXQgaW4gYnVsayBzbyB0aGF0IHdlIGRvbid0IGNvbnN0YW50bHkgdXBkYXRlIHRoZSByZXNpZHVhbHMgYWZ0ZXIgYWRkaW5nIGEgZGF0YVBvaW50XHJcbiAgICAgICAgdGhpcy5ncmFwaC5hZGREYXRhUG9pbnRzT25HcmFwaEFuZFJlc2lkdWFsc0luQnVsayggdGhpcy5kYXRhUG9pbnRzICk7XHJcbiAgICAgIH1cclxuICAgICAgLy8gU2luY2Ugd2UgYWRkZWQgdGhlIGRhdGFQb2ludHMgaW4gQnVsaywgbGV0J3Mgc2VuZCBhIHRyaWdnZXIgdG8gdGhlIHZpZXdcclxuICAgICAgdGhpcy5kYXRhUG9pbnRzQWRkZWRFbWl0dGVyLmVtaXQoKTtcclxuXHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNldHMgdmFsdWVzIHRvIHRoZWlyIG9yaWdpbmFsIHN0YXRlXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHJlc2V0KCkge1xyXG4gICAgdGhpcy5zaG93R3JpZFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnNlbGVjdGVkRGF0YVNldFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmRpc3Bvc2UoKTtcclxuICAgIHRoaXMuZGF0YVBvaW50cy5jbGVhcigpO1xyXG4gICAgdGhpcy5ncmFwaC5yZXNldCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVW5saW5rIGxpc3RlbmVycyB0byBkYXRhUG9pbnQuIExpc3RlbmVycyBtaWdodCBoYXZlIGJlZW4gcmVtb3ZlZCB3aGVuIHRoZSBkYXRhIHBvaW50IHdhcyByZW1vdmVkIGZyb20gdGhlIGdyYXBoLFxyXG4gICAqIHNvIGNoZWNrIHRoYXQgdGhleSBhcmUgc3RpbGwgYXR0YWNoZWQgZmlyc3QuXHJcbiAgICpcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGRpc3Bvc2UoKSB7XHJcbiAgICB0aGlzLmRhdGFQb2ludHMuZm9yRWFjaCggZGF0YVBvaW50ID0+IHtcclxuICAgICAgaWYgKCBkYXRhUG9pbnQucG9zaXRpb25Qcm9wZXJ0eS5oYXNMaXN0ZW5lciggZGF0YVBvaW50LnBvc2l0aW9uVXBkYXRlTGlzdGVuZXIgKSApIHtcclxuICAgICAgICBkYXRhUG9pbnQucG9zaXRpb25Qcm9wZXJ0eS51bmxpbmsoIGRhdGFQb2ludC5wb3NpdGlvblVwZGF0ZUxpc3RlbmVyICk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCBkYXRhUG9pbnQudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5oYXNMaXN0ZW5lciggZGF0YVBvaW50LnVzZXJDb250cm9sbGVkTGlzdGVuZXIgKSApIHtcclxuICAgICAgICBkYXRhUG9pbnQudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS51bmxpbmsoIGRhdGFQb2ludC51c2VyQ29udHJvbGxlZExpc3RlbmVyICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRoYXQgYW5pbWF0ZXMgYWxsIHRoZSBkYXRhUG9pbnRzXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHJldHVybkFsbERhdGFQb2ludHNUb0J1Y2tldCgpIHtcclxuICAgIHRoaXMuZGF0YVBvaW50cy5mb3JFYWNoKCBkYXRhUG9pbnQgPT4ge1xyXG4gICAgICBkYXRhUG9pbnQuYW5pbWF0ZSgpO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRnVuY3Rpb24gZm9yIGFkZGluZyBuZXcgZGF0YVBvaW50cyB0byB0aGlzIG1vZGVsIHdoZW4gdGhlIHVzZXIgY3JlYXRlcyB0aGVtLCBnZW5lcmFsbHkgYnkgY2xpY2tpbmcgb25cclxuICAgKiBzb21lIHNvcnQgb2YgY3JlYXRvciBub2RlLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAcGFyYW0ge0RhdGFQb2ludH0gZGF0YVBvaW50XHJcbiAgICovXHJcbiAgYWRkVXNlckNyZWF0ZWREYXRhUG9pbnQoIGRhdGFQb2ludCApIHtcclxuXHJcbiAgICB0aGlzLmRhdGFQb2ludHMucHVzaCggZGF0YVBvaW50ICk7XHJcblxyXG4gICAgdGhpcy5hZGREYXRhUG9pbnRDb250cm9sbGVkTGlzdGVuZXIoIGRhdGFQb2ludCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRnVuY3Rpb24gdGhhdCBhZGRzIHBvc2l0aW9uIGxpc3RlbmVyIGFuZCB1c2VyIENvbnRyb2xsZWQgbGlzdGVuZXI7XHJcbiAgICogVXNlZnVsIGZvciBkeW5hbWljYWwgcG9pbnRzXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHtEYXRhUG9pbnR9IGRhdGFQb2ludFxyXG4gICAqL1xyXG4gIGFkZERhdGFQb2ludENvbnRyb2xsZWRMaXN0ZW5lciggZGF0YVBvaW50ICkge1xyXG4gICAgZGF0YVBvaW50LnVzZXJDb250cm9sbGVkTGlzdGVuZXIgPSB1c2VyQ29udHJvbGxlZCA9PiB7XHJcbiAgICAgIGNvbnN0IGlzT25HcmFwaCA9IHRoaXMuZ3JhcGguaXNEYXRhUG9pbnRQb3NpdGlvbk92ZXJsYXBwaW5nR3JhcGgoIGRhdGFQb2ludC5wb3NpdGlvblByb3BlcnR5LnZhbHVlICk7XHJcbiAgICAgIGlmICggIWlzT25HcmFwaCAmJiAhdXNlckNvbnRyb2xsZWQgKSB7XHJcbiAgICAgICAgLy8gcmV0dXJuIHRoZSBkYXRhUG9pbnQgdG8gdGhlIGJ1Y2tldFxyXG4gICAgICAgIGRhdGFQb2ludC5hbmltYXRlKCk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gRGV0ZXJtaW5lIGlmIHRoZSBkYXRhIFBvaW50IGlzIG5vdCB1c2VyIGNvbnRyb2xsZWQgYW5kIG5vdCBvbiBncmFwaC4gSWYgc28gbGV0J3MgYW5pbWF0ZSBpdCwgaS5lLiByZXR1cm4gaXQgdG8gdGhlIGJ1Y2tldFxyXG4gICAgZGF0YVBvaW50LnVzZXJDb250cm9sbGVkUHJvcGVydHkubGluayggZGF0YVBvaW50LnVzZXJDb250cm9sbGVkTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBUaGUgZGF0YVBvaW50IHdpbGwgYmUgcmVtb3ZlZCBmcm9tIHRoZSBtb2RlbCBpZiBhbmQgd2hlbiBpdCByZXR1cm5zIHRvIGl0cyBvcmlnaW5hdGlvbiBwb2ludC4gVGhpcyBpcyBob3cgYSBkYXRhUG9pbnRcclxuICAgIC8vIGNhbiBiZSAncHV0IGJhY2snIGludG8gdGhlIGJ1Y2tldC4gTGlzdGVuZXJzIG1pZ2h0IGhhdmUgYmVlbiByZW1vdmVkIHdoZW4gaXQgd2FzIHJlbW92ZWQgZnJvbSB0aGVcclxuICAgIC8vIGdyYXBoIHNvIGNoZWNrIHRvIG1ha2Ugc3VyZSBsaXN0ZW5lcnMgYXJlIHN0aWxsIGF0dGFjaGVkIGJlZm9yZSB1bmxpbmtpbmcuXHJcbiAgICBkYXRhUG9pbnQucmV0dXJuZWRUb09yaWdpbkxpc3RlbmVyID0gKCkgPT4ge1xyXG4gICAgICBpZiAoIHRoaXMuZGF0YVBvaW50cy5pbmNsdWRlcyggZGF0YVBvaW50ICkgKSB7XHJcbiAgICAgICAgdGhpcy5kYXRhUG9pbnRzLnJlbW92ZSggZGF0YVBvaW50ICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICggZGF0YVBvaW50LnBvc2l0aW9uUHJvcGVydHkuaGFzTGlzdGVuZXIoIGRhdGFQb2ludC5wb3NpdGlvblVwZGF0ZUxpc3RlbmVyICkgKSB7XHJcbiAgICAgICAgZGF0YVBvaW50LnBvc2l0aW9uUHJvcGVydHkudW5saW5rKCBkYXRhUG9pbnQucG9zaXRpb25VcGRhdGVMaXN0ZW5lciApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICggZGF0YVBvaW50LnVzZXJDb250cm9sbGVkUHJvcGVydHkuaGFzTGlzdGVuZXIoIGRhdGFQb2ludC51c2VyQ29udHJvbGxlZFByb3BlcnR5ICkgKSB7XHJcbiAgICAgICAgZGF0YVBvaW50LnVzZXJDb250cm9sbGVkUHJvcGVydHkudW5saW5rKCBkYXRhUG9pbnQudXNlckNvbnRyb2xsZWRMaXN0ZW5lciApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICggZGF0YVBvaW50LnJldHVybmVkVG9PcmlnaW5FbWl0dGVyLmhhc0xpc3RlbmVyKCBkYXRhUG9pbnQucmV0dXJuZWRUb09yaWdpbkxpc3RlbmVyICkgKSB7XHJcbiAgICAgICAgZGF0YVBvaW50LnJldHVybmVkVG9PcmlnaW5FbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCBkYXRhUG9pbnQucmV0dXJuZWRUb09yaWdpbkxpc3RlbmVyICk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZGF0YVBvaW50LnJldHVybmVkVG9PcmlnaW5FbWl0dGVyLmFkZExpc3RlbmVyKCBkYXRhUG9pbnQucmV0dXJuZWRUb09yaWdpbkxpc3RlbmVyICk7XHJcbiAgfVxyXG59XHJcblxyXG5sZWFzdFNxdWFyZXNSZWdyZXNzaW9uLnJlZ2lzdGVyKCAnTGVhc3RTcXVhcmVzUmVncmVzc2lvbk1vZGVsJywgTGVhc3RTcXVhcmVzUmVncmVzc2lvbk1vZGVsICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBMZWFzdFNxdWFyZXNSZWdyZXNzaW9uTW9kZWw7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLHFCQUFxQixNQUFNLDhDQUE4QztBQUNoRixPQUFPQyxPQUFPLE1BQU0sZ0NBQWdDO0FBQ3BELE9BQU9DLFFBQVEsTUFBTSxpQ0FBaUM7QUFDdEQsT0FBT0MsVUFBVSxNQUFNLGtDQUFrQztBQUN6RCxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsTUFBTSxNQUFNLDJDQUEyQztBQUM5RCxPQUFPQyxzQkFBc0IsTUFBTSxpQ0FBaUM7QUFDcEUsT0FBT0MsU0FBUyxNQUFNLGdCQUFnQjtBQUN0QyxPQUFPQyxPQUFPLE1BQU0sY0FBYztBQUNsQyxPQUFPQyxLQUFLLE1BQU0sWUFBWTs7QUFFOUI7QUFDQSxNQUFNQyxXQUFXLEdBQUcsSUFBSVIsVUFBVSxDQUFFLEdBQUcsRUFBRSxFQUFHLENBQUM7QUFDN0MsTUFBTVMsZUFBZSxHQUFHLElBQUlQLE9BQU8sQ0FBRSxHQUFHLEVBQUUsR0FBSSxDQUFDO0FBRS9DLE1BQU1RLDJCQUEyQixDQUFDO0VBQ2hDQyxXQUFXQSxDQUFBLEVBQUc7SUFFWjtJQUNBLElBQUksQ0FBQ0MsZ0JBQWdCLEdBQUcsSUFBSWhCLGVBQWUsQ0FBRSxLQUFNLENBQUM7O0lBRXBEO0lBQ0EsSUFBSSxDQUFDaUIsdUJBQXVCLEdBQUcsSUFBSWQsUUFBUSxDQUFFTyxPQUFPLENBQUNRLE1BQU8sQ0FBQzs7SUFFN0Q7SUFDQSxJQUFJLENBQUNDLHNCQUFzQixHQUFHLElBQUlqQixPQUFPLENBQUMsQ0FBQzs7SUFFM0M7SUFDQSxJQUFJLENBQUNrQixVQUFVLEdBQUduQixxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7SUFFM0M7SUFDQTtJQUNBLElBQUksQ0FBQ29CLFFBQVEsR0FBRyxFQUFFO0lBQ2xCLElBQUksQ0FBQ0EsUUFBUSxDQUFDQyxJQUFJLENBQUVaLE9BQU8sQ0FBQ1EsTUFBTyxDQUFDO0lBQ3BDLElBQUksQ0FBQ0csUUFBUSxDQUFDQyxJQUFJLENBQUVaLE9BQU8sQ0FBQ2EsV0FBWSxDQUFDO0lBQ3pDLElBQUksQ0FBQ0YsUUFBUSxDQUFDQyxJQUFJLENBQUVaLE9BQU8sQ0FBQ2MsZUFBZ0IsQ0FBQztJQUM3QyxJQUFJLENBQUNILFFBQVEsQ0FBQ0MsSUFBSSxDQUFFWixPQUFPLENBQUNlLGNBQWUsQ0FBQztJQUM1QyxJQUFJLENBQUNKLFFBQVEsQ0FBQ0MsSUFBSSxDQUFFWixPQUFPLENBQUNnQixTQUFVLENBQUM7SUFDdkMsSUFBSSxDQUFDTCxRQUFRLENBQUNDLElBQUksQ0FBRVosT0FBTyxDQUFDaUIsU0FBVSxDQUFDO0lBQ3ZDLElBQUksQ0FBQ04sUUFBUSxDQUFDQyxJQUFJLENBQUVaLE9BQU8sQ0FBQ2tCLGFBQWMsQ0FBQztJQUMzQyxJQUFJLENBQUNQLFFBQVEsQ0FBQ0MsSUFBSSxDQUFFWixPQUFPLENBQUNtQixPQUFRLENBQUM7SUFDckMsSUFBSSxDQUFDUixRQUFRLENBQUNDLElBQUksQ0FBRVosT0FBTyxDQUFDb0IsY0FBZSxDQUFDO0lBQzVDLElBQUksQ0FBQ1QsUUFBUSxDQUFDQyxJQUFJLENBQUVaLE9BQU8sQ0FBQ3FCLDRCQUE2QixDQUFDO0lBQzFELElBQUksQ0FBQ1YsUUFBUSxDQUFDQyxJQUFJLENBQUVaLE9BQU8sQ0FBQ3NCLGdDQUFpQyxDQUFDO0lBQzlELElBQUksQ0FBQ1gsUUFBUSxDQUFDQyxJQUFJLENBQUVaLE9BQU8sQ0FBQ3VCLCtCQUFnQyxDQUFDO0lBQzdELElBQUksQ0FBQ1osUUFBUSxDQUFDQyxJQUFJLENBQUVaLE9BQU8sQ0FBQ3dCLHlCQUEwQixDQUFDO0lBQ3ZELElBQUksQ0FBQ2IsUUFBUSxDQUFDQyxJQUFJLENBQUVaLE9BQU8sQ0FBQ3lCLDZCQUE4QixDQUFDO0lBQzNELElBQUksQ0FBQ2QsUUFBUSxDQUFDQyxJQUFJLENBQUVaLE9BQU8sQ0FBQzBCLDRCQUE2QixDQUFDOztJQUUxRDtJQUNBO0lBQ0EsSUFBSSxDQUFDQyxLQUFLLEdBQUcsSUFBSTFCLEtBQUssQ0FDcEIsSUFBSSxDQUFDTSx1QkFBdUIsQ0FBQ3FCLEtBQUssQ0FBQ0MsTUFBTSxFQUN6QyxJQUFJLENBQUN0Qix1QkFBdUIsQ0FBQ3FCLEtBQUssQ0FBQ0UsTUFDckMsQ0FBQzs7SUFFRDtJQUNBO0lBQ0EsSUFBSSxDQUFDQyxNQUFNLEdBQUcsSUFBSWxDLE1BQU0sQ0FBRTtNQUN4Qm1DLFFBQVEsRUFBRTdCLGVBQWU7TUFDekI4QixTQUFTLEVBQUUsU0FBUztNQUNwQkMsSUFBSSxFQUFFaEMsV0FBVztNQUNqQmlDLE9BQU8sRUFBRTtJQUNYLENBQUUsQ0FBQzs7SUFFSDtJQUNBLElBQUlDLHFCQUFxQixHQUFHLEVBQUUsQ0FBQyxDQUFDOztJQUVoQztJQUNBLElBQUksQ0FBQzdCLHVCQUF1QixDQUFDOEIsSUFBSSxDQUFFLENBQUVDLGVBQWUsRUFBRUMsa0JBQWtCLEtBQU07TUFFNUU7TUFDQSxJQUFLQSxrQkFBa0IsSUFBSUEsa0JBQWtCLEtBQUt2QyxPQUFPLENBQUNRLE1BQU0sRUFBRztRQUNqRTtRQUNBNEIscUJBQXFCLEdBQUcsSUFBSSxDQUFDVCxLQUFLLENBQUNhLGlCQUFpQjtNQUN0RDs7TUFFQTtNQUNBO01BQ0E7TUFDQSxJQUFJLENBQUNDLE9BQU8sQ0FBQyxDQUFDOztNQUVkO01BQ0EsSUFBSSxDQUFDL0IsVUFBVSxDQUFDZ0MsS0FBSyxDQUFDLENBQUM7O01BRXZCO01BQ0EsSUFBSSxDQUFDZixLQUFLLENBQUNnQixzQkFBc0IsQ0FBQyxDQUFDOztNQUVuQztNQUNBLElBQUksQ0FBQ2hCLEtBQUssQ0FBQ2lCLGNBQWMsQ0FBRU4sZUFBZSxDQUFDVCxNQUFNLEVBQUVTLGVBQWUsQ0FBQ1IsTUFBTyxDQUFDOztNQUUzRTs7TUFFQSxJQUFLUSxlQUFlLEtBQUt0QyxPQUFPLENBQUNRLE1BQU0sRUFBRztRQUN4QztRQUNBNEIscUJBQXFCLENBQUNTLE9BQU8sQ0FBRUMsU0FBUyxJQUFJO1VBQzFDLElBQUksQ0FBQ3BDLFVBQVUsQ0FBQ0UsSUFBSSxDQUFFa0MsU0FBVSxDQUFDO1FBQ25DLENBQUUsQ0FBQztRQUNIO1FBQ0E7UUFDQSxJQUFJLENBQUNuQixLQUFLLENBQUNvQixzQ0FBc0MsQ0FBRSxJQUFJLENBQUNyQyxVQUFXLENBQUM7UUFDcEUsSUFBSSxDQUFDQSxVQUFVLENBQUNtQyxPQUFPLENBQUVDLFNBQVMsSUFBSTtVQUNwQyxJQUFJLENBQUNFLDhCQUE4QixDQUFFRixTQUFVLENBQUM7UUFDbEQsQ0FBRSxDQUFDO01BRUwsQ0FBQyxNQUNJO1FBQ0g7UUFDQVIsZUFBZSxDQUFDVyxNQUFNLENBQUNKLE9BQU8sQ0FBRWIsUUFBUSxJQUFJO1VBQzFDO1VBQ0E7VUFDQSxNQUFNa0IsV0FBVyxHQUFHdkQsS0FBSyxDQUFDd0QsTUFBTSxDQUFFYixlQUFlLENBQUNULE1BQU0sQ0FBQ3VCLEdBQUcsRUFBRWQsZUFBZSxDQUFDVCxNQUFNLENBQUN3QixHQUFHLEVBQUUsSUFBSSxDQUFDMUIsS0FBSyxDQUFDMkIsTUFBTSxDQUFDQyxJQUFJLEVBQUUsSUFBSSxDQUFDNUIsS0FBSyxDQUFDMkIsTUFBTSxDQUFDRSxJQUFJLEVBQUV4QixRQUFRLENBQUN5QixDQUFFLENBQUM7VUFDdEosTUFBTUMsV0FBVyxHQUFHL0QsS0FBSyxDQUFDd0QsTUFBTSxDQUFFYixlQUFlLENBQUNSLE1BQU0sQ0FBQ3NCLEdBQUcsRUFBRWQsZUFBZSxDQUFDUixNQUFNLENBQUN1QixHQUFHLEVBQUUsSUFBSSxDQUFDMUIsS0FBSyxDQUFDMkIsTUFBTSxDQUFDSyxJQUFJLEVBQUUsSUFBSSxDQUFDaEMsS0FBSyxDQUFDMkIsTUFBTSxDQUFDTSxJQUFJLEVBQUU1QixRQUFRLENBQUM2QixDQUFFLENBQUM7VUFDdEosTUFBTUMsY0FBYyxHQUFHLElBQUlsRSxPQUFPLENBQUVzRCxXQUFXLEVBQUVRLFdBQVksQ0FBQztVQUM5RCxJQUFJLENBQUNoRCxVQUFVLENBQUNFLElBQUksQ0FBRSxJQUFJYixTQUFTLENBQUUrRCxjQUFlLENBQUUsQ0FBQztRQUN6RCxDQUFFLENBQUM7UUFDSDtRQUNBO1FBQ0EsSUFBSSxDQUFDbkMsS0FBSyxDQUFDb0Isc0NBQXNDLENBQUUsSUFBSSxDQUFDckMsVUFBVyxDQUFDO01BQ3RFO01BQ0E7TUFDQSxJQUFJLENBQUNELHNCQUFzQixDQUFDc0QsSUFBSSxDQUFDLENBQUM7SUFFcEMsQ0FBRSxDQUFDO0VBQ0w7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7RUFDRUMsS0FBS0EsQ0FBQSxFQUFHO0lBQ04sSUFBSSxDQUFDMUQsZ0JBQWdCLENBQUMwRCxLQUFLLENBQUMsQ0FBQztJQUM3QixJQUFJLENBQUN6RCx1QkFBdUIsQ0FBQ3lELEtBQUssQ0FBQyxDQUFDO0lBQ3BDLElBQUksQ0FBQ3ZCLE9BQU8sQ0FBQyxDQUFDO0lBQ2QsSUFBSSxDQUFDL0IsVUFBVSxDQUFDZ0MsS0FBSyxDQUFDLENBQUM7SUFDdkIsSUFBSSxDQUFDZixLQUFLLENBQUNxQyxLQUFLLENBQUMsQ0FBQztFQUNwQjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRXZCLE9BQU9BLENBQUEsRUFBRztJQUNSLElBQUksQ0FBQy9CLFVBQVUsQ0FBQ21DLE9BQU8sQ0FBRUMsU0FBUyxJQUFJO01BQ3BDLElBQUtBLFNBQVMsQ0FBQ21CLGdCQUFnQixDQUFDQyxXQUFXLENBQUVwQixTQUFTLENBQUNxQixzQkFBdUIsQ0FBQyxFQUFHO1FBQ2hGckIsU0FBUyxDQUFDbUIsZ0JBQWdCLENBQUNHLE1BQU0sQ0FBRXRCLFNBQVMsQ0FBQ3FCLHNCQUF1QixDQUFDO01BQ3ZFO01BQ0EsSUFBS3JCLFNBQVMsQ0FBQ3VCLHNCQUFzQixDQUFDSCxXQUFXLENBQUVwQixTQUFTLENBQUN3QixzQkFBdUIsQ0FBQyxFQUFHO1FBQ3RGeEIsU0FBUyxDQUFDdUIsc0JBQXNCLENBQUNELE1BQU0sQ0FBRXRCLFNBQVMsQ0FBQ3dCLHNCQUF1QixDQUFDO01BQzdFO0lBQ0YsQ0FBRSxDQUFDO0VBQ0w7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7RUFDRUMsMkJBQTJCQSxDQUFBLEVBQUc7SUFDNUIsSUFBSSxDQUFDN0QsVUFBVSxDQUFDbUMsT0FBTyxDQUFFQyxTQUFTLElBQUk7TUFDcENBLFNBQVMsQ0FBQzBCLE9BQU8sQ0FBQyxDQUFDO0lBQ3JCLENBQUUsQ0FBQztFQUNMOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFQyx1QkFBdUJBLENBQUUzQixTQUFTLEVBQUc7SUFFbkMsSUFBSSxDQUFDcEMsVUFBVSxDQUFDRSxJQUFJLENBQUVrQyxTQUFVLENBQUM7SUFFakMsSUFBSSxDQUFDRSw4QkFBOEIsQ0FBRUYsU0FBVSxDQUFDO0VBQ2xEOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VFLDhCQUE4QkEsQ0FBRUYsU0FBUyxFQUFHO0lBQzFDQSxTQUFTLENBQUN3QixzQkFBc0IsR0FBR0ksY0FBYyxJQUFJO01BQ25ELE1BQU1DLFNBQVMsR0FBRyxJQUFJLENBQUNoRCxLQUFLLENBQUNpRCxtQ0FBbUMsQ0FBRTlCLFNBQVMsQ0FBQ21CLGdCQUFnQixDQUFDckMsS0FBTSxDQUFDO01BQ3BHLElBQUssQ0FBQytDLFNBQVMsSUFBSSxDQUFDRCxjQUFjLEVBQUc7UUFDbkM7UUFDQTVCLFNBQVMsQ0FBQzBCLE9BQU8sQ0FBQyxDQUFDO01BQ3JCO0lBQ0YsQ0FBQzs7SUFFRDtJQUNBMUIsU0FBUyxDQUFDdUIsc0JBQXNCLENBQUNoQyxJQUFJLENBQUVTLFNBQVMsQ0FBQ3dCLHNCQUF1QixDQUFDOztJQUV6RTtJQUNBO0lBQ0E7SUFDQXhCLFNBQVMsQ0FBQytCLHdCQUF3QixHQUFHLE1BQU07TUFDekMsSUFBSyxJQUFJLENBQUNuRSxVQUFVLENBQUNvRSxRQUFRLENBQUVoQyxTQUFVLENBQUMsRUFBRztRQUMzQyxJQUFJLENBQUNwQyxVQUFVLENBQUNxRSxNQUFNLENBQUVqQyxTQUFVLENBQUM7TUFDckM7TUFFQSxJQUFLQSxTQUFTLENBQUNtQixnQkFBZ0IsQ0FBQ0MsV0FBVyxDQUFFcEIsU0FBUyxDQUFDcUIsc0JBQXVCLENBQUMsRUFBRztRQUNoRnJCLFNBQVMsQ0FBQ21CLGdCQUFnQixDQUFDRyxNQUFNLENBQUV0QixTQUFTLENBQUNxQixzQkFBdUIsQ0FBQztNQUN2RTtNQUNBLElBQUtyQixTQUFTLENBQUN1QixzQkFBc0IsQ0FBQ0gsV0FBVyxDQUFFcEIsU0FBUyxDQUFDdUIsc0JBQXVCLENBQUMsRUFBRztRQUN0RnZCLFNBQVMsQ0FBQ3VCLHNCQUFzQixDQUFDRCxNQUFNLENBQUV0QixTQUFTLENBQUN3QixzQkFBdUIsQ0FBQztNQUM3RTtNQUNBLElBQUt4QixTQUFTLENBQUNrQyx1QkFBdUIsQ0FBQ2QsV0FBVyxDQUFFcEIsU0FBUyxDQUFDK0Isd0JBQXlCLENBQUMsRUFBRztRQUN6Ri9CLFNBQVMsQ0FBQ2tDLHVCQUF1QixDQUFDQyxjQUFjLENBQUVuQyxTQUFTLENBQUMrQix3QkFBeUIsQ0FBQztNQUN4RjtJQUNGLENBQUM7SUFFRC9CLFNBQVMsQ0FBQ2tDLHVCQUF1QixDQUFDRSxXQUFXLENBQUVwQyxTQUFTLENBQUMrQix3QkFBeUIsQ0FBQztFQUNyRjtBQUNGO0FBRUEvRSxzQkFBc0IsQ0FBQ3FGLFFBQVEsQ0FBRSw2QkFBNkIsRUFBRS9FLDJCQUE0QixDQUFDO0FBRTdGLGVBQWVBLDJCQUEyQiJ9