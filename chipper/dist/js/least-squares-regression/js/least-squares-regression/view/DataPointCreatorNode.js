// Copyright 2014-2022, University of Colorado Boulder

/**
 * A Scenery node that can be clicked upon to create new dataPoints in the model.
 *
 * @author John Blanco
 * @author Martin Veillette (Berea College)
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import ScreenView from '../../../../joist/js/ScreenView.js';
import { Circle, Node, SimpleDragHandler } from '../../../../scenery/js/imports.js';
import leastSquaresRegression from '../../leastSquaresRegression.js';
import LeastSquaresRegressionConstants from '../LeastSquaresRegressionConstants.js';
import DataPoint from '../model/DataPoint.js';
class DataPointCreatorNode extends Node {
  /**
   * @param {Function} addDataPointToModel - A function for adding the created dataPoint to the model
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Object} [options]
   */
  constructor(addDataPointToModel, modelViewTransform, options) {
    super({
      cursor: 'pointer'
    });

    // Create the node that the user will click upon to add a model element to the view.
    const representation = new Circle(LeastSquaresRegressionConstants.DYNAMIC_DATA_POINT_RADIUS, {
      fill: LeastSquaresRegressionConstants.DYNAMIC_DATA_POINT_FILL,
      stroke: LeastSquaresRegressionConstants.DYNAMIC_DATA_POINT_STROKE,
      lineWidth: LeastSquaresRegressionConstants.DYNAMIC_DATA_POINT_LINE_WIDTH
    });
    this.addChild(representation);

    // Set up the mouse and touch areas for this node so that this can still be grabbed when invisible.
    this.touchArea = this.localBounds.dilated(15);
    this.mouseArea = this.localBounds.dilated(5);
    let parentScreenView = null;
    let dataPoint;
    // Add the listener that will allow the user to click on this and create a new dataPoint, then position it in the model.
    this.addInputListener(new SimpleDragHandler({
      // Allow moving a finger (touch) across this node to interact with it
      allowTouchSnag: true,
      start: (event, trail) => {
        // find the parent screen if not already found by moving up the scene graph
        if (!parentScreenView) {
          let testNode = this; // eslint-disable-line consistent-this
          while (testNode !== null) {
            if (testNode instanceof ScreenView) {
              parentScreenView = testNode;
              break;
            }
            testNode = testNode.parents[0]; // move up the scene graph by one level
          }

          assert && assert(parentScreenView, 'unable to find parent screen view');
        }

        // Determine the initial position (set to be one circle radius above the pointer point)
        const initialPosition = parentScreenView.globalToLocalPoint(event.pointer.point.plus(new Vector2(0, -LeastSquaresRegressionConstants.DYNAMIC_DATA_POINT_RADIUS)));

        // Create and add the new model element.
        dataPoint = new DataPoint(modelViewTransform.viewToModelPosition(initialPosition));
        dataPoint.userControlledProperty.set(true);
        addDataPointToModel(dataPoint);
      },
      translate: translationParams => {
        dataPoint.positionProperty.value = dataPoint.positionProperty.value.plus(modelViewTransform.viewToModelDelta(translationParams.delta));
      },
      end: () => {
        dataPoint.userControlledProperty.set(false);
        dataPoint = null;
      }
    }));

    // Pass options through to parent.
    this.mutate(options);
  }
}
leastSquaresRegression.register('DataPointCreatorNode', DataPointCreatorNode);
export default DataPointCreatorNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiU2NyZWVuVmlldyIsIkNpcmNsZSIsIk5vZGUiLCJTaW1wbGVEcmFnSGFuZGxlciIsImxlYXN0U3F1YXJlc1JlZ3Jlc3Npb24iLCJMZWFzdFNxdWFyZXNSZWdyZXNzaW9uQ29uc3RhbnRzIiwiRGF0YVBvaW50IiwiRGF0YVBvaW50Q3JlYXRvck5vZGUiLCJjb25zdHJ1Y3RvciIsImFkZERhdGFQb2ludFRvTW9kZWwiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJvcHRpb25zIiwiY3Vyc29yIiwicmVwcmVzZW50YXRpb24iLCJEWU5BTUlDX0RBVEFfUE9JTlRfUkFESVVTIiwiZmlsbCIsIkRZTkFNSUNfREFUQV9QT0lOVF9GSUxMIiwic3Ryb2tlIiwiRFlOQU1JQ19EQVRBX1BPSU5UX1NUUk9LRSIsImxpbmVXaWR0aCIsIkRZTkFNSUNfREFUQV9QT0lOVF9MSU5FX1dJRFRIIiwiYWRkQ2hpbGQiLCJ0b3VjaEFyZWEiLCJsb2NhbEJvdW5kcyIsImRpbGF0ZWQiLCJtb3VzZUFyZWEiLCJwYXJlbnRTY3JlZW5WaWV3IiwiZGF0YVBvaW50IiwiYWRkSW5wdXRMaXN0ZW5lciIsImFsbG93VG91Y2hTbmFnIiwic3RhcnQiLCJldmVudCIsInRyYWlsIiwidGVzdE5vZGUiLCJwYXJlbnRzIiwiYXNzZXJ0IiwiaW5pdGlhbFBvc2l0aW9uIiwiZ2xvYmFsVG9Mb2NhbFBvaW50IiwicG9pbnRlciIsInBvaW50IiwicGx1cyIsInZpZXdUb01vZGVsUG9zaXRpb24iLCJ1c2VyQ29udHJvbGxlZFByb3BlcnR5Iiwic2V0IiwidHJhbnNsYXRlIiwidHJhbnNsYXRpb25QYXJhbXMiLCJwb3NpdGlvblByb3BlcnR5IiwidmFsdWUiLCJ2aWV3VG9Nb2RlbERlbHRhIiwiZGVsdGEiLCJlbmQiLCJtdXRhdGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkRhdGFQb2ludENyZWF0b3JOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEEgU2NlbmVyeSBub2RlIHRoYXQgY2FuIGJlIGNsaWNrZWQgdXBvbiB0byBjcmVhdGUgbmV3IGRhdGFQb2ludHMgaW4gdGhlIG1vZGVsLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvXHJcbiAqIEBhdXRob3IgTWFydGluIFZlaWxsZXR0ZSAoQmVyZWEgQ29sbGVnZSlcclxuICovXHJcblxyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBTY3JlZW5WaWV3IGZyb20gJy4uLy4uLy4uLy4uL2pvaXN0L2pzL1NjcmVlblZpZXcuanMnO1xyXG5pbXBvcnQgeyBDaXJjbGUsIE5vZGUsIFNpbXBsZURyYWdIYW5kbGVyIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGxlYXN0U3F1YXJlc1JlZ3Jlc3Npb24gZnJvbSAnLi4vLi4vbGVhc3RTcXVhcmVzUmVncmVzc2lvbi5qcyc7XHJcbmltcG9ydCBMZWFzdFNxdWFyZXNSZWdyZXNzaW9uQ29uc3RhbnRzIGZyb20gJy4uL0xlYXN0U3F1YXJlc1JlZ3Jlc3Npb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgRGF0YVBvaW50IGZyb20gJy4uL21vZGVsL0RhdGFQb2ludC5qcyc7XHJcblxyXG5jbGFzcyBEYXRhUG9pbnRDcmVhdG9yTm9kZSBleHRlbmRzIE5vZGUge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGFkZERhdGFQb2ludFRvTW9kZWwgLSBBIGZ1bmN0aW9uIGZvciBhZGRpbmcgdGhlIGNyZWF0ZWQgZGF0YVBvaW50IHRvIHRoZSBtb2RlbFxyXG4gICAqIEBwYXJhbSB7TW9kZWxWaWV3VHJhbnNmb3JtMn0gbW9kZWxWaWV3VHJhbnNmb3JtXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBhZGREYXRhUG9pbnRUb01vZGVsLCBtb2RlbFZpZXdUcmFuc2Zvcm0sIG9wdGlvbnMgKSB7XHJcbiAgICBzdXBlciggeyBjdXJzb3I6ICdwb2ludGVyJyB9ICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBub2RlIHRoYXQgdGhlIHVzZXIgd2lsbCBjbGljayB1cG9uIHRvIGFkZCBhIG1vZGVsIGVsZW1lbnQgdG8gdGhlIHZpZXcuXHJcbiAgICBjb25zdCByZXByZXNlbnRhdGlvbiA9IG5ldyBDaXJjbGUoIExlYXN0U3F1YXJlc1JlZ3Jlc3Npb25Db25zdGFudHMuRFlOQU1JQ19EQVRBX1BPSU5UX1JBRElVUywge1xyXG4gICAgICBmaWxsOiBMZWFzdFNxdWFyZXNSZWdyZXNzaW9uQ29uc3RhbnRzLkRZTkFNSUNfREFUQV9QT0lOVF9GSUxMLFxyXG4gICAgICBzdHJva2U6IExlYXN0U3F1YXJlc1JlZ3Jlc3Npb25Db25zdGFudHMuRFlOQU1JQ19EQVRBX1BPSU5UX1NUUk9LRSxcclxuICAgICAgbGluZVdpZHRoOiBMZWFzdFNxdWFyZXNSZWdyZXNzaW9uQ29uc3RhbnRzLkRZTkFNSUNfREFUQV9QT0lOVF9MSU5FX1dJRFRIXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5hZGRDaGlsZCggcmVwcmVzZW50YXRpb24gKTtcclxuXHJcbiAgICAvLyBTZXQgdXAgdGhlIG1vdXNlIGFuZCB0b3VjaCBhcmVhcyBmb3IgdGhpcyBub2RlIHNvIHRoYXQgdGhpcyBjYW4gc3RpbGwgYmUgZ3JhYmJlZCB3aGVuIGludmlzaWJsZS5cclxuICAgIHRoaXMudG91Y2hBcmVhID0gdGhpcy5sb2NhbEJvdW5kcy5kaWxhdGVkKCAxNSApO1xyXG4gICAgdGhpcy5tb3VzZUFyZWEgPSB0aGlzLmxvY2FsQm91bmRzLmRpbGF0ZWQoIDUgKTtcclxuXHJcbiAgICBsZXQgcGFyZW50U2NyZWVuVmlldyA9IG51bGw7XHJcbiAgICBsZXQgZGF0YVBvaW50O1xyXG4gICAgLy8gQWRkIHRoZSBsaXN0ZW5lciB0aGF0IHdpbGwgYWxsb3cgdGhlIHVzZXIgdG8gY2xpY2sgb24gdGhpcyBhbmQgY3JlYXRlIGEgbmV3IGRhdGFQb2ludCwgdGhlbiBwb3NpdGlvbiBpdCBpbiB0aGUgbW9kZWwuXHJcbiAgICB0aGlzLmFkZElucHV0TGlzdGVuZXIoIG5ldyBTaW1wbGVEcmFnSGFuZGxlcigge1xyXG5cclxuICAgICAgLy8gQWxsb3cgbW92aW5nIGEgZmluZ2VyICh0b3VjaCkgYWNyb3NzIHRoaXMgbm9kZSB0byBpbnRlcmFjdCB3aXRoIGl0XHJcbiAgICAgIGFsbG93VG91Y2hTbmFnOiB0cnVlLFxyXG5cclxuICAgICAgc3RhcnQ6ICggZXZlbnQsIHRyYWlsICkgPT4ge1xyXG5cclxuICAgICAgICAvLyBmaW5kIHRoZSBwYXJlbnQgc2NyZWVuIGlmIG5vdCBhbHJlYWR5IGZvdW5kIGJ5IG1vdmluZyB1cCB0aGUgc2NlbmUgZ3JhcGhcclxuICAgICAgICBpZiAoICFwYXJlbnRTY3JlZW5WaWV3ICkge1xyXG4gICAgICAgICAgbGV0IHRlc3ROb2RlID0gdGhpczsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjb25zaXN0ZW50LXRoaXNcclxuICAgICAgICAgIHdoaWxlICggdGVzdE5vZGUgIT09IG51bGwgKSB7XHJcbiAgICAgICAgICAgIGlmICggdGVzdE5vZGUgaW5zdGFuY2VvZiBTY3JlZW5WaWV3ICkge1xyXG4gICAgICAgICAgICAgIHBhcmVudFNjcmVlblZpZXcgPSB0ZXN0Tm9kZTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0ZXN0Tm9kZSA9IHRlc3ROb2RlLnBhcmVudHNbIDAgXTsgLy8gbW92ZSB1cCB0aGUgc2NlbmUgZ3JhcGggYnkgb25lIGxldmVsXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBwYXJlbnRTY3JlZW5WaWV3LCAndW5hYmxlIHRvIGZpbmQgcGFyZW50IHNjcmVlbiB2aWV3JyApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBpbml0aWFsIHBvc2l0aW9uIChzZXQgdG8gYmUgb25lIGNpcmNsZSByYWRpdXMgYWJvdmUgdGhlIHBvaW50ZXIgcG9pbnQpXHJcbiAgICAgICAgY29uc3QgaW5pdGlhbFBvc2l0aW9uID0gcGFyZW50U2NyZWVuVmlldy5nbG9iYWxUb0xvY2FsUG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQucGx1cyggbmV3IFZlY3RvcjIoIDAsIC1MZWFzdFNxdWFyZXNSZWdyZXNzaW9uQ29uc3RhbnRzLkRZTkFNSUNfREFUQV9QT0lOVF9SQURJVVMgKSApICk7XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSBhbmQgYWRkIHRoZSBuZXcgbW9kZWwgZWxlbWVudC5cclxuICAgICAgICBkYXRhUG9pbnQgPSBuZXcgRGF0YVBvaW50KCBtb2RlbFZpZXdUcmFuc2Zvcm0udmlld1RvTW9kZWxQb3NpdGlvbiggaW5pdGlhbFBvc2l0aW9uICkgKTtcclxuICAgICAgICBkYXRhUG9pbnQudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5zZXQoIHRydWUgKTtcclxuICAgICAgICBhZGREYXRhUG9pbnRUb01vZGVsKCBkYXRhUG9pbnQgKTtcclxuXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICB0cmFuc2xhdGU6IHRyYW5zbGF0aW9uUGFyYW1zID0+IHtcclxuICAgICAgICBkYXRhUG9pbnQucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZSA9IGRhdGFQb2ludC5wb3NpdGlvblByb3BlcnR5LnZhbHVlLnBsdXMoIG1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbERlbHRhKCB0cmFuc2xhdGlvblBhcmFtcy5kZWx0YSApICk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBlbmQ6ICgpID0+IHtcclxuICAgICAgICBkYXRhUG9pbnQudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5zZXQoIGZhbHNlICk7XHJcbiAgICAgICAgZGF0YVBvaW50ID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfSApICk7XHJcblxyXG4gICAgLy8gUGFzcyBvcHRpb25zIHRocm91Z2ggdG8gcGFyZW50LlxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuICB9XHJcbn1cclxuXHJcbmxlYXN0U3F1YXJlc1JlZ3Jlc3Npb24ucmVnaXN0ZXIoICdEYXRhUG9pbnRDcmVhdG9yTm9kZScsIERhdGFQb2ludENyZWF0b3JOb2RlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBEYXRhUG9pbnRDcmVhdG9yTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLFVBQVUsTUFBTSxvQ0FBb0M7QUFDM0QsU0FBU0MsTUFBTSxFQUFFQyxJQUFJLEVBQUVDLGlCQUFpQixRQUFRLG1DQUFtQztBQUNuRixPQUFPQyxzQkFBc0IsTUFBTSxpQ0FBaUM7QUFDcEUsT0FBT0MsK0JBQStCLE1BQU0sdUNBQXVDO0FBQ25GLE9BQU9DLFNBQVMsTUFBTSx1QkFBdUI7QUFFN0MsTUFBTUMsb0JBQW9CLFNBQVNMLElBQUksQ0FBQztFQUN0QztBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0VNLFdBQVdBLENBQUVDLG1CQUFtQixFQUFFQyxrQkFBa0IsRUFBRUMsT0FBTyxFQUFHO0lBQzlELEtBQUssQ0FBRTtNQUFFQyxNQUFNLEVBQUU7SUFBVSxDQUFFLENBQUM7O0lBRTlCO0lBQ0EsTUFBTUMsY0FBYyxHQUFHLElBQUlaLE1BQU0sQ0FBRUksK0JBQStCLENBQUNTLHlCQUF5QixFQUFFO01BQzVGQyxJQUFJLEVBQUVWLCtCQUErQixDQUFDVyx1QkFBdUI7TUFDN0RDLE1BQU0sRUFBRVosK0JBQStCLENBQUNhLHlCQUF5QjtNQUNqRUMsU0FBUyxFQUFFZCwrQkFBK0IsQ0FBQ2U7SUFDN0MsQ0FBRSxDQUFDO0lBRUgsSUFBSSxDQUFDQyxRQUFRLENBQUVSLGNBQWUsQ0FBQzs7SUFFL0I7SUFDQSxJQUFJLENBQUNTLFNBQVMsR0FBRyxJQUFJLENBQUNDLFdBQVcsQ0FBQ0MsT0FBTyxDQUFFLEVBQUcsQ0FBQztJQUMvQyxJQUFJLENBQUNDLFNBQVMsR0FBRyxJQUFJLENBQUNGLFdBQVcsQ0FBQ0MsT0FBTyxDQUFFLENBQUUsQ0FBQztJQUU5QyxJQUFJRSxnQkFBZ0IsR0FBRyxJQUFJO0lBQzNCLElBQUlDLFNBQVM7SUFDYjtJQUNBLElBQUksQ0FBQ0MsZ0JBQWdCLENBQUUsSUFBSXpCLGlCQUFpQixDQUFFO01BRTVDO01BQ0EwQixjQUFjLEVBQUUsSUFBSTtNQUVwQkMsS0FBSyxFQUFFQSxDQUFFQyxLQUFLLEVBQUVDLEtBQUssS0FBTTtRQUV6QjtRQUNBLElBQUssQ0FBQ04sZ0JBQWdCLEVBQUc7VUFDdkIsSUFBSU8sUUFBUSxHQUFHLElBQUksQ0FBQyxDQUFDO1VBQ3JCLE9BQVFBLFFBQVEsS0FBSyxJQUFJLEVBQUc7WUFDMUIsSUFBS0EsUUFBUSxZQUFZakMsVUFBVSxFQUFHO2NBQ3BDMEIsZ0JBQWdCLEdBQUdPLFFBQVE7Y0FDM0I7WUFDRjtZQUNBQSxRQUFRLEdBQUdBLFFBQVEsQ0FBQ0MsT0FBTyxDQUFFLENBQUMsQ0FBRSxDQUFDLENBQUM7VUFDcEM7O1VBQ0FDLE1BQU0sSUFBSUEsTUFBTSxDQUFFVCxnQkFBZ0IsRUFBRSxtQ0FBb0MsQ0FBQztRQUMzRTs7UUFFQTtRQUNBLE1BQU1VLGVBQWUsR0FBR1YsZ0JBQWdCLENBQUNXLGtCQUFrQixDQUFFTixLQUFLLENBQUNPLE9BQU8sQ0FBQ0MsS0FBSyxDQUFDQyxJQUFJLENBQUUsSUFBSXpDLE9BQU8sQ0FBRSxDQUFDLEVBQUUsQ0FBQ00sK0JBQStCLENBQUNTLHlCQUEwQixDQUFFLENBQUUsQ0FBQzs7UUFFdks7UUFDQWEsU0FBUyxHQUFHLElBQUlyQixTQUFTLENBQUVJLGtCQUFrQixDQUFDK0IsbUJBQW1CLENBQUVMLGVBQWdCLENBQUUsQ0FBQztRQUN0RlQsU0FBUyxDQUFDZSxzQkFBc0IsQ0FBQ0MsR0FBRyxDQUFFLElBQUssQ0FBQztRQUM1Q2xDLG1CQUFtQixDQUFFa0IsU0FBVSxDQUFDO01BRWxDLENBQUM7TUFFRGlCLFNBQVMsRUFBRUMsaUJBQWlCLElBQUk7UUFDOUJsQixTQUFTLENBQUNtQixnQkFBZ0IsQ0FBQ0MsS0FBSyxHQUFHcEIsU0FBUyxDQUFDbUIsZ0JBQWdCLENBQUNDLEtBQUssQ0FBQ1AsSUFBSSxDQUFFOUIsa0JBQWtCLENBQUNzQyxnQkFBZ0IsQ0FBRUgsaUJBQWlCLENBQUNJLEtBQU0sQ0FBRSxDQUFDO01BQzVJLENBQUM7TUFFREMsR0FBRyxFQUFFQSxDQUFBLEtBQU07UUFDVHZCLFNBQVMsQ0FBQ2Usc0JBQXNCLENBQUNDLEdBQUcsQ0FBRSxLQUFNLENBQUM7UUFDN0NoQixTQUFTLEdBQUcsSUFBSTtNQUNsQjtJQUNGLENBQUUsQ0FBRSxDQUFDOztJQUVMO0lBQ0EsSUFBSSxDQUFDd0IsTUFBTSxDQUFFeEMsT0FBUSxDQUFDO0VBQ3hCO0FBQ0Y7QUFFQVAsc0JBQXNCLENBQUNnRCxRQUFRLENBQUUsc0JBQXNCLEVBQUU3QyxvQkFBcUIsQ0FBQztBQUUvRSxlQUFlQSxvQkFBb0IifQ==