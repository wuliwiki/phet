// Copyright 2014-2022, University of Colorado Boulder

/**
 * View for the states screen
 *
 * @author John Blanco
 * @author Aaron Davis
 * @author Siddhartha Chinthapally (Actual Concepts)
 */

import Multilink from '../../../../axon/js/Multilink.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import ScreenView from '../../../../joist/js/ScreenView.js';
import merge from '../../../../phet-core/js/merge.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import HeaterCoolerNode from '../../../../scenery-phet/js/HeaterCoolerNode.js';
import TimeControlNode from '../../../../scenery-phet/js/TimeControlNode.js';
import MultipleParticleModel from '../../common/model/MultipleParticleModel.js';
import SOMConstants from '../../common/SOMConstants.js';
import SOMQueryParameters from '../../common/SOMQueryParameters.js';
import ParticleContainerNode from '../../common/view/ParticleContainerNode.js';
import statesOfMatter from '../../statesOfMatter.js';
import StatesMoleculesControlPanel from './StatesMoleculesControlPanel.js';
import StatesPhaseControlNode from './StatesPhaseControlNode.js';

// constants
const CONTROL_PANEL_X_INSET = 15;
const CONTROL_PANEL_Y_INSET = 10;
const CONTROL_PANEL_WIDTH = 175; // empirically determined by looks

class StatesScreenView extends ScreenView {
  /**
   * @param {MultipleParticleModel} multipleParticleModel - model of the simulation
   * @param {Tandem} tandem
   */
  constructor(multipleParticleModel, tandem) {
    super(merge({
      tandem: tandem
    }, SOMConstants.SCREEN_VIEW_OPTIONS));

    // Create the model-view transform. The multipliers for the 2nd parameter can be used to adjust where the point
    // (0, 0) in the model, which is the lower left corner of the particle container, appears in the view.The final
    // parameter is the scale, and can be changed to make the view more zoomed in or out.
    const modelViewTransform = ModelViewTransform2.createSinglePointScaleInvertedYMapping(new Vector2(0, 0), new Vector2(this.layoutBounds.width * 0.325, this.layoutBounds.height * 0.75), SOMConstants.VIEW_CONTAINER_WIDTH / MultipleParticleModel.PARTICLE_CONTAINER_WIDTH);

    // Figure out where in the view the interior of the particle container will be.
    const particleContainerViewBounds = new Bounds2(modelViewTransform.modelToViewX(0), modelViewTransform.modelToViewY(0) + modelViewTransform.modelToViewDeltaY(MultipleParticleModel.PARTICLE_CONTAINER_INITIAL_HEIGHT), modelViewTransform.modelToViewX(0) + modelViewTransform.modelToViewDeltaX(MultipleParticleModel.PARTICLE_CONTAINER_WIDTH), modelViewTransform.modelToViewY(0));

    // @private particle container
    this.particleContainerNode = new ParticleContainerNode(multipleParticleModel, modelViewTransform, {
      thermometerXOffsetFromCenter: modelViewTransform.modelToViewDeltaX(-MultipleParticleModel.PARTICLE_CONTAINER_WIDTH * 0.3),
      tandem: tandem.createTandem('particleContainerNode')
    });
    this.addChild(this.particleContainerNode);

    // @private - heater/cooler node
    const heaterCoolerNode = new HeaterCoolerNode(multipleParticleModel.heatingCoolingAmountProperty, {
      scale: 0.79,
      centerX: particleContainerViewBounds.centerX,
      top: particleContainerViewBounds.bottom + 30,
      // distance from bottom of particle area empirically determined
      tandem: tandem.createTandem('heaterCoolerNode'),
      frontOptions: {
        snapToZero: !SOMQueryParameters.stickyBurners
      }
    });
    this.addChild(heaterCoolerNode);

    // control when the heater/cooler node is enabled for input
    Multilink.multilink([multipleParticleModel.isPlayingProperty, multipleParticleModel.isExplodedProperty], (isPlaying, isExploded) => {
      if (!isPlaying || isExploded) {
        heaterCoolerNode.interruptSubtreeInput(); // cancel interaction
        heaterCoolerNode.heatCoolAmountProperty.set(0); // force to zero in case snapToZero is off
        heaterCoolerNode.slider.enabled = false;
      } else {
        heaterCoolerNode.slider.enabled = true;
      }
    });

    // selection panel for the atoms/molecules
    const moleculesControlPanel = new StatesMoleculesControlPanel(multipleParticleModel.substanceProperty, {
      right: this.layoutBounds.right - CONTROL_PANEL_X_INSET,
      top: this.layoutBounds.top + CONTROL_PANEL_Y_INSET,
      minWidth: CONTROL_PANEL_WIDTH,
      maxWidth: CONTROL_PANEL_WIDTH,
      tandem: tandem.createTandem('moleculesControlPanel')
    });
    this.addChild(moleculesControlPanel);

    // phases control node
    const solidLiquidGasPhaseControlNode = new StatesPhaseControlNode(multipleParticleModel, {
      right: moleculesControlPanel.right,
      top: moleculesControlPanel.bottom + CONTROL_PANEL_Y_INSET,
      buttonWidth: CONTROL_PANEL_WIDTH,
      tandem: tandem.createTandem('solidLiquidGasPhaseControlNode')
    });
    this.addChild(solidLiquidGasPhaseControlNode);
    const resetAllButton = new ResetAllButton({
      listener: () => {
        multipleParticleModel.reset();
        this.particleContainerNode.reset();
      },
      radius: SOMConstants.RESET_ALL_BUTTON_RADIUS,
      right: this.layoutBounds.maxX - SOMConstants.RESET_ALL_BUTTON_DISTANCE_FROM_SIDE,
      bottom: this.layoutBounds.maxY - SOMConstants.RESET_ALL_BUTTON_DISTANCE_FROM_BOTTOM,
      tandem: tandem.createTandem('resetAllButton')
    });
    this.addChild(resetAllButton);

    // add the play/pause/step control
    this.addChild(new TimeControlNode(multipleParticleModel.isPlayingProperty, {
      playPauseStepButtonOptions: {
        playPauseButtonOptions: {
          radius: SOMConstants.PLAY_PAUSE_BUTTON_RADIUS
        },
        stepForwardButtonOptions: {
          radius: SOMConstants.STEP_BUTTON_RADIUS,
          listener: () => {
            multipleParticleModel.stepInTime(SOMConstants.NOMINAL_TIME_STEP);
          }
        },
        playPauseStepXSpacing: 10
      },
      // position empirically determined
      right: heaterCoolerNode.left - 50,
      centerY: heaterCoolerNode.centerY,
      tandem: tandem.createTandem('timeControlNode')
    }));
  }

  /**
   * @public
   */
  step(dt) {
    this.particleContainerNode.step(dt);
  }
}
statesOfMatter.register('StatesScreenView', StatesScreenView);
export default StatesScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJCb3VuZHMyIiwiVmVjdG9yMiIsIlNjcmVlblZpZXciLCJtZXJnZSIsIk1vZGVsVmlld1RyYW5zZm9ybTIiLCJSZXNldEFsbEJ1dHRvbiIsIkhlYXRlckNvb2xlck5vZGUiLCJUaW1lQ29udHJvbE5vZGUiLCJNdWx0aXBsZVBhcnRpY2xlTW9kZWwiLCJTT01Db25zdGFudHMiLCJTT01RdWVyeVBhcmFtZXRlcnMiLCJQYXJ0aWNsZUNvbnRhaW5lck5vZGUiLCJzdGF0ZXNPZk1hdHRlciIsIlN0YXRlc01vbGVjdWxlc0NvbnRyb2xQYW5lbCIsIlN0YXRlc1BoYXNlQ29udHJvbE5vZGUiLCJDT05UUk9MX1BBTkVMX1hfSU5TRVQiLCJDT05UUk9MX1BBTkVMX1lfSU5TRVQiLCJDT05UUk9MX1BBTkVMX1dJRFRIIiwiU3RhdGVzU2NyZWVuVmlldyIsImNvbnN0cnVjdG9yIiwibXVsdGlwbGVQYXJ0aWNsZU1vZGVsIiwidGFuZGVtIiwiU0NSRUVOX1ZJRVdfT1BUSU9OUyIsIm1vZGVsVmlld1RyYW5zZm9ybSIsImNyZWF0ZVNpbmdsZVBvaW50U2NhbGVJbnZlcnRlZFlNYXBwaW5nIiwibGF5b3V0Qm91bmRzIiwid2lkdGgiLCJoZWlnaHQiLCJWSUVXX0NPTlRBSU5FUl9XSURUSCIsIlBBUlRJQ0xFX0NPTlRBSU5FUl9XSURUSCIsInBhcnRpY2xlQ29udGFpbmVyVmlld0JvdW5kcyIsIm1vZGVsVG9WaWV3WCIsIm1vZGVsVG9WaWV3WSIsIm1vZGVsVG9WaWV3RGVsdGFZIiwiUEFSVElDTEVfQ09OVEFJTkVSX0lOSVRJQUxfSEVJR0hUIiwibW9kZWxUb1ZpZXdEZWx0YVgiLCJwYXJ0aWNsZUNvbnRhaW5lck5vZGUiLCJ0aGVybW9tZXRlclhPZmZzZXRGcm9tQ2VudGVyIiwiY3JlYXRlVGFuZGVtIiwiYWRkQ2hpbGQiLCJoZWF0ZXJDb29sZXJOb2RlIiwiaGVhdGluZ0Nvb2xpbmdBbW91bnRQcm9wZXJ0eSIsInNjYWxlIiwiY2VudGVyWCIsInRvcCIsImJvdHRvbSIsImZyb250T3B0aW9ucyIsInNuYXBUb1plcm8iLCJzdGlja3lCdXJuZXJzIiwibXVsdGlsaW5rIiwiaXNQbGF5aW5nUHJvcGVydHkiLCJpc0V4cGxvZGVkUHJvcGVydHkiLCJpc1BsYXlpbmciLCJpc0V4cGxvZGVkIiwiaW50ZXJydXB0U3VidHJlZUlucHV0IiwiaGVhdENvb2xBbW91bnRQcm9wZXJ0eSIsInNldCIsInNsaWRlciIsImVuYWJsZWQiLCJtb2xlY3VsZXNDb250cm9sUGFuZWwiLCJzdWJzdGFuY2VQcm9wZXJ0eSIsInJpZ2h0IiwibWluV2lkdGgiLCJtYXhXaWR0aCIsInNvbGlkTGlxdWlkR2FzUGhhc2VDb250cm9sTm9kZSIsImJ1dHRvbldpZHRoIiwicmVzZXRBbGxCdXR0b24iLCJsaXN0ZW5lciIsInJlc2V0IiwicmFkaXVzIiwiUkVTRVRfQUxMX0JVVFRPTl9SQURJVVMiLCJtYXhYIiwiUkVTRVRfQUxMX0JVVFRPTl9ESVNUQU5DRV9GUk9NX1NJREUiLCJtYXhZIiwiUkVTRVRfQUxMX0JVVFRPTl9ESVNUQU5DRV9GUk9NX0JPVFRPTSIsInBsYXlQYXVzZVN0ZXBCdXR0b25PcHRpb25zIiwicGxheVBhdXNlQnV0dG9uT3B0aW9ucyIsIlBMQVlfUEFVU0VfQlVUVE9OX1JBRElVUyIsInN0ZXBGb3J3YXJkQnV0dG9uT3B0aW9ucyIsIlNURVBfQlVUVE9OX1JBRElVUyIsInN0ZXBJblRpbWUiLCJOT01JTkFMX1RJTUVfU1RFUCIsInBsYXlQYXVzZVN0ZXBYU3BhY2luZyIsImxlZnQiLCJjZW50ZXJZIiwic3RlcCIsImR0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJTdGF0ZXNTY3JlZW5WaWV3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFZpZXcgZm9yIHRoZSBzdGF0ZXMgc2NyZWVuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICogQGF1dGhvciBBYXJvbiBEYXZpc1xyXG4gKiBAYXV0aG9yIFNpZGRoYXJ0aGEgQ2hpbnRoYXBhbGx5IChBY3R1YWwgQ29uY2VwdHMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgU2NyZWVuVmlldyBmcm9tICcuLi8uLi8uLi8uLi9qb2lzdC9qcy9TY3JlZW5WaWV3LmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBNb2RlbFZpZXdUcmFuc2Zvcm0yIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdmlldy9Nb2RlbFZpZXdUcmFuc2Zvcm0yLmpzJztcclxuaW1wb3J0IFJlc2V0QWxsQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL1Jlc2V0QWxsQnV0dG9uLmpzJztcclxuaW1wb3J0IEhlYXRlckNvb2xlck5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL0hlYXRlckNvb2xlck5vZGUuanMnO1xyXG5pbXBvcnQgVGltZUNvbnRyb2xOb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9UaW1lQ29udHJvbE5vZGUuanMnO1xyXG5pbXBvcnQgTXVsdGlwbGVQYXJ0aWNsZU1vZGVsIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9NdWx0aXBsZVBhcnRpY2xlTW9kZWwuanMnO1xyXG5pbXBvcnQgU09NQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9TT01Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgU09NUXVlcnlQYXJhbWV0ZXJzIGZyb20gJy4uLy4uL2NvbW1vbi9TT01RdWVyeVBhcmFtZXRlcnMuanMnO1xyXG5pbXBvcnQgUGFydGljbGVDb250YWluZXJOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L1BhcnRpY2xlQ29udGFpbmVyTm9kZS5qcyc7XHJcbmltcG9ydCBzdGF0ZXNPZk1hdHRlciBmcm9tICcuLi8uLi9zdGF0ZXNPZk1hdHRlci5qcyc7XHJcbmltcG9ydCBTdGF0ZXNNb2xlY3VsZXNDb250cm9sUGFuZWwgZnJvbSAnLi9TdGF0ZXNNb2xlY3VsZXNDb250cm9sUGFuZWwuanMnO1xyXG5pbXBvcnQgU3RhdGVzUGhhc2VDb250cm9sTm9kZSBmcm9tICcuL1N0YXRlc1BoYXNlQ29udHJvbE5vZGUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IENPTlRST0xfUEFORUxfWF9JTlNFVCA9IDE1O1xyXG5jb25zdCBDT05UUk9MX1BBTkVMX1lfSU5TRVQgPSAxMDtcclxuY29uc3QgQ09OVFJPTF9QQU5FTF9XSURUSCA9IDE3NTsgLy8gZW1waXJpY2FsbHkgZGV0ZXJtaW5lZCBieSBsb29rc1xyXG5cclxuY2xhc3MgU3RhdGVzU2NyZWVuVmlldyBleHRlbmRzIFNjcmVlblZpZXcge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge011bHRpcGxlUGFydGljbGVNb2RlbH0gbXVsdGlwbGVQYXJ0aWNsZU1vZGVsIC0gbW9kZWwgb2YgdGhlIHNpbXVsYXRpb25cclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG11bHRpcGxlUGFydGljbGVNb2RlbCwgdGFuZGVtICkge1xyXG5cclxuICAgIHN1cGVyKCBtZXJnZSggeyB0YW5kZW06IHRhbmRlbSB9LCBTT01Db25zdGFudHMuU0NSRUVOX1ZJRVdfT1BUSU9OUyApICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBtb2RlbC12aWV3IHRyYW5zZm9ybS4gVGhlIG11bHRpcGxpZXJzIGZvciB0aGUgMm5kIHBhcmFtZXRlciBjYW4gYmUgdXNlZCB0byBhZGp1c3Qgd2hlcmUgdGhlIHBvaW50XHJcbiAgICAvLyAoMCwgMCkgaW4gdGhlIG1vZGVsLCB3aGljaCBpcyB0aGUgbG93ZXIgbGVmdCBjb3JuZXIgb2YgdGhlIHBhcnRpY2xlIGNvbnRhaW5lciwgYXBwZWFycyBpbiB0aGUgdmlldy5UaGUgZmluYWxcclxuICAgIC8vIHBhcmFtZXRlciBpcyB0aGUgc2NhbGUsIGFuZCBjYW4gYmUgY2hhbmdlZCB0byBtYWtlIHRoZSB2aWV3IG1vcmUgem9vbWVkIGluIG9yIG91dC5cclxuICAgIGNvbnN0IG1vZGVsVmlld1RyYW5zZm9ybSA9IE1vZGVsVmlld1RyYW5zZm9ybTIuY3JlYXRlU2luZ2xlUG9pbnRTY2FsZUludmVydGVkWU1hcHBpbmcoXHJcbiAgICAgIG5ldyBWZWN0b3IyKCAwLCAwICksXHJcbiAgICAgIG5ldyBWZWN0b3IyKCB0aGlzLmxheW91dEJvdW5kcy53aWR0aCAqIDAuMzI1LCB0aGlzLmxheW91dEJvdW5kcy5oZWlnaHQgKiAwLjc1ICksXHJcbiAgICAgIFNPTUNvbnN0YW50cy5WSUVXX0NPTlRBSU5FUl9XSURUSCAvIE11bHRpcGxlUGFydGljbGVNb2RlbC5QQVJUSUNMRV9DT05UQUlORVJfV0lEVEhcclxuICAgICk7XHJcblxyXG4gICAgLy8gRmlndXJlIG91dCB3aGVyZSBpbiB0aGUgdmlldyB0aGUgaW50ZXJpb3Igb2YgdGhlIHBhcnRpY2xlIGNvbnRhaW5lciB3aWxsIGJlLlxyXG4gICAgY29uc3QgcGFydGljbGVDb250YWluZXJWaWV3Qm91bmRzID0gbmV3IEJvdW5kczIoXHJcbiAgICAgIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIDAgKSxcclxuICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggMCApICsgbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFZKCBNdWx0aXBsZVBhcnRpY2xlTW9kZWwuUEFSVElDTEVfQ09OVEFJTkVSX0lOSVRJQUxfSEVJR0hUICksXHJcbiAgICAgIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIDAgKSArIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggTXVsdGlwbGVQYXJ0aWNsZU1vZGVsLlBBUlRJQ0xFX0NPTlRBSU5FUl9XSURUSCApLFxyXG4gICAgICBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdZKCAwIClcclxuICAgICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgcGFydGljbGUgY29udGFpbmVyXHJcbiAgICB0aGlzLnBhcnRpY2xlQ29udGFpbmVyTm9kZSA9IG5ldyBQYXJ0aWNsZUNvbnRhaW5lck5vZGUoIG11bHRpcGxlUGFydGljbGVNb2RlbCwgbW9kZWxWaWV3VHJhbnNmb3JtLCB7XHJcbiAgICAgIHRoZXJtb21ldGVyWE9mZnNldEZyb21DZW50ZXI6IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWChcclxuICAgICAgICAtTXVsdGlwbGVQYXJ0aWNsZU1vZGVsLlBBUlRJQ0xFX0NPTlRBSU5FUl9XSURUSCAqIDAuM1xyXG4gICAgICApLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdwYXJ0aWNsZUNvbnRhaW5lck5vZGUnIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMucGFydGljbGVDb250YWluZXJOb2RlICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgLSBoZWF0ZXIvY29vbGVyIG5vZGVcclxuICAgIGNvbnN0IGhlYXRlckNvb2xlck5vZGUgPSBuZXcgSGVhdGVyQ29vbGVyTm9kZSggbXVsdGlwbGVQYXJ0aWNsZU1vZGVsLmhlYXRpbmdDb29saW5nQW1vdW50UHJvcGVydHksIHtcclxuICAgICAgc2NhbGU6IDAuNzksXHJcbiAgICAgIGNlbnRlclg6IHBhcnRpY2xlQ29udGFpbmVyVmlld0JvdW5kcy5jZW50ZXJYLFxyXG4gICAgICB0b3A6IHBhcnRpY2xlQ29udGFpbmVyVmlld0JvdW5kcy5ib3R0b20gKyAzMCwgLy8gZGlzdGFuY2UgZnJvbSBib3R0b20gb2YgcGFydGljbGUgYXJlYSBlbXBpcmljYWxseSBkZXRlcm1pbmVkXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2hlYXRlckNvb2xlck5vZGUnICksXHJcbiAgICAgIGZyb250T3B0aW9uczoge1xyXG4gICAgICAgIHNuYXBUb1plcm86ICFTT01RdWVyeVBhcmFtZXRlcnMuc3RpY2t5QnVybmVyc1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBoZWF0ZXJDb29sZXJOb2RlICk7XHJcblxyXG4gICAgLy8gY29udHJvbCB3aGVuIHRoZSBoZWF0ZXIvY29vbGVyIG5vZGUgaXMgZW5hYmxlZCBmb3IgaW5wdXRcclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoXHJcbiAgICAgIFsgbXVsdGlwbGVQYXJ0aWNsZU1vZGVsLmlzUGxheWluZ1Byb3BlcnR5LCBtdWx0aXBsZVBhcnRpY2xlTW9kZWwuaXNFeHBsb2RlZFByb3BlcnR5IF0sXHJcbiAgICAgICggaXNQbGF5aW5nLCBpc0V4cGxvZGVkICkgPT4ge1xyXG4gICAgICAgIGlmICggIWlzUGxheWluZyB8fCBpc0V4cGxvZGVkICkge1xyXG4gICAgICAgICAgaGVhdGVyQ29vbGVyTm9kZS5pbnRlcnJ1cHRTdWJ0cmVlSW5wdXQoKTsgLy8gY2FuY2VsIGludGVyYWN0aW9uXHJcbiAgICAgICAgICBoZWF0ZXJDb29sZXJOb2RlLmhlYXRDb29sQW1vdW50UHJvcGVydHkuc2V0KCAwICk7IC8vIGZvcmNlIHRvIHplcm8gaW4gY2FzZSBzbmFwVG9aZXJvIGlzIG9mZlxyXG4gICAgICAgICAgaGVhdGVyQ29vbGVyTm9kZS5zbGlkZXIuZW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGhlYXRlckNvb2xlck5vZGUuc2xpZGVyLmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBzZWxlY3Rpb24gcGFuZWwgZm9yIHRoZSBhdG9tcy9tb2xlY3VsZXNcclxuICAgIGNvbnN0IG1vbGVjdWxlc0NvbnRyb2xQYW5lbCA9IG5ldyBTdGF0ZXNNb2xlY3VsZXNDb250cm9sUGFuZWwoIG11bHRpcGxlUGFydGljbGVNb2RlbC5zdWJzdGFuY2VQcm9wZXJ0eSwge1xyXG4gICAgICByaWdodDogdGhpcy5sYXlvdXRCb3VuZHMucmlnaHQgLSBDT05UUk9MX1BBTkVMX1hfSU5TRVQsXHJcbiAgICAgIHRvcDogdGhpcy5sYXlvdXRCb3VuZHMudG9wICsgQ09OVFJPTF9QQU5FTF9ZX0lOU0VULFxyXG4gICAgICBtaW5XaWR0aDogQ09OVFJPTF9QQU5FTF9XSURUSCxcclxuICAgICAgbWF4V2lkdGg6IENPTlRST0xfUEFORUxfV0lEVEgsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ21vbGVjdWxlc0NvbnRyb2xQYW5lbCcgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbW9sZWN1bGVzQ29udHJvbFBhbmVsICk7XHJcblxyXG4gICAgLy8gcGhhc2VzIGNvbnRyb2wgbm9kZVxyXG4gICAgY29uc3Qgc29saWRMaXF1aWRHYXNQaGFzZUNvbnRyb2xOb2RlID0gbmV3IFN0YXRlc1BoYXNlQ29udHJvbE5vZGUoIG11bHRpcGxlUGFydGljbGVNb2RlbCwge1xyXG4gICAgICByaWdodDogbW9sZWN1bGVzQ29udHJvbFBhbmVsLnJpZ2h0LFxyXG4gICAgICB0b3A6IG1vbGVjdWxlc0NvbnRyb2xQYW5lbC5ib3R0b20gKyBDT05UUk9MX1BBTkVMX1lfSU5TRVQsXHJcbiAgICAgIGJ1dHRvbldpZHRoOiBDT05UUk9MX1BBTkVMX1dJRFRILFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdzb2xpZExpcXVpZEdhc1BoYXNlQ29udHJvbE5vZGUnIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHNvbGlkTGlxdWlkR2FzUGhhc2VDb250cm9sTm9kZSApO1xyXG5cclxuICAgIGNvbnN0IHJlc2V0QWxsQnV0dG9uID0gbmV3IFJlc2V0QWxsQnV0dG9uKCB7XHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgbXVsdGlwbGVQYXJ0aWNsZU1vZGVsLnJlc2V0KCk7XHJcbiAgICAgICAgdGhpcy5wYXJ0aWNsZUNvbnRhaW5lck5vZGUucmVzZXQoKTtcclxuICAgICAgfSxcclxuICAgICAgcmFkaXVzOiBTT01Db25zdGFudHMuUkVTRVRfQUxMX0JVVFRPTl9SQURJVVMsXHJcbiAgICAgIHJpZ2h0OiB0aGlzLmxheW91dEJvdW5kcy5tYXhYIC0gU09NQ29uc3RhbnRzLlJFU0VUX0FMTF9CVVRUT05fRElTVEFOQ0VfRlJPTV9TSURFLFxyXG4gICAgICBib3R0b206IHRoaXMubGF5b3V0Qm91bmRzLm1heFkgLSBTT01Db25zdGFudHMuUkVTRVRfQUxMX0JVVFRPTl9ESVNUQU5DRV9GUk9NX0JPVFRPTSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAncmVzZXRBbGxCdXR0b24nIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHJlc2V0QWxsQnV0dG9uICk7XHJcblxyXG4gICAgLy8gYWRkIHRoZSBwbGF5L3BhdXNlL3N0ZXAgY29udHJvbFxyXG4gICAgdGhpcy5hZGRDaGlsZCggbmV3IFRpbWVDb250cm9sTm9kZSggbXVsdGlwbGVQYXJ0aWNsZU1vZGVsLmlzUGxheWluZ1Byb3BlcnR5LCB7XHJcbiAgICAgIHBsYXlQYXVzZVN0ZXBCdXR0b25PcHRpb25zOiB7XHJcbiAgICAgICAgcGxheVBhdXNlQnV0dG9uT3B0aW9uczoge1xyXG4gICAgICAgICAgcmFkaXVzOiBTT01Db25zdGFudHMuUExBWV9QQVVTRV9CVVRUT05fUkFESVVTXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzdGVwRm9yd2FyZEJ1dHRvbk9wdGlvbnM6IHtcclxuICAgICAgICAgIHJhZGl1czogU09NQ29uc3RhbnRzLlNURVBfQlVUVE9OX1JBRElVUyxcclxuICAgICAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIG11bHRpcGxlUGFydGljbGVNb2RlbC5zdGVwSW5UaW1lKCBTT01Db25zdGFudHMuTk9NSU5BTF9USU1FX1NURVAgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHBsYXlQYXVzZVN0ZXBYU3BhY2luZzogMTBcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIHBvc2l0aW9uIGVtcGlyaWNhbGx5IGRldGVybWluZWRcclxuICAgICAgcmlnaHQ6IGhlYXRlckNvb2xlck5vZGUubGVmdCAtIDUwLFxyXG4gICAgICBjZW50ZXJZOiBoZWF0ZXJDb29sZXJOb2RlLmNlbnRlclksXHJcblxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd0aW1lQ29udHJvbE5vZGUnIClcclxuICAgIH0gKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHN0ZXAoIGR0ICkge1xyXG4gICAgdGhpcy5wYXJ0aWNsZUNvbnRhaW5lck5vZGUuc3RlcCggZHQgKTtcclxuICB9XHJcbn1cclxuXHJcbnN0YXRlc09mTWF0dGVyLnJlZ2lzdGVyKCAnU3RhdGVzU2NyZWVuVmlldycsIFN0YXRlc1NjcmVlblZpZXcgKTtcclxuZXhwb3J0IGRlZmF1bHQgU3RhdGVzU2NyZWVuVmlldzsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFNBQVMsTUFBTSxrQ0FBa0M7QUFDeEQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLFVBQVUsTUFBTSxvQ0FBb0M7QUFDM0QsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNy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