// Copyright 2014-2021, University of Colorado Boulder

/**
 * Implementation of the Verlet algorithm for simulating molecular interaction based on the Lennard-Jones potential.
 * This version is used specifically for simulating water, i.e. H2O, and also includes calculations for the charge
 * distributions present in this molecule.
 *
 * @author John Blanco
 * @author Siddhartha Chinthapally (Actual Concepts)
 * @author Jonathan Olson
 */

import statesOfMatter from '../../../statesOfMatter.js';
import AbstractVerletAlgorithm from './AbstractVerletAlgorithm.js';
import WaterAtomPositionUpdater from './WaterAtomPositionUpdater.js';

// constants, mostly parameters used for "hollywooding" of the water crystal
const WATER_FULLY_MELTED_TEMPERATURE = 0.3;
const WATER_FULLY_MELTED_ELECTROSTATIC_FORCE = 1.0;
const WATER_FULLY_FROZEN_TEMPERATURE = 0.22;
const WATER_FULLY_FROZEN_ELECTROSTATIC_FORCE = 4.25;
const MAX_REPULSIVE_SCALING_FACTOR_FOR_WATER = 5.25;
const MAX_ROTATION_RATE = 16; // revolutions per second, empirically determined, see usage below
const TEMPERATURE_BELOW_WHICH_GRAVITY_INCREASES = 0.10;
class WaterVerletAlgorithm extends AbstractVerletAlgorithm {
  /**
   * @param {MultipleParticleModel} multipleParticleModel
   */
  constructor(multipleParticleModel) {
    super(multipleParticleModel);
    this.positionUpdater = WaterAtomPositionUpdater;

    // @private precomputed values to save time later
    this.massInverse = 1 / multipleParticleModel.moleculeDataSet.getMoleculeMass();
    this.inertiaInverse = 1 / multipleParticleModel.moleculeDataSet.getMoleculeRotationalInertia();

    // @private pre-allocated arrays to avoid reallocation with each force and position update
    this.normalCharges = new Array(3);
    this.alteredCharges = new Array(3);
  }

  /**
   * @param {MoleculeForceAndMotionDataSet} moleculeDataSet
   * @override
   * @protected
   */
  initializeForces(moleculeDataSet) {
    const temperatureSetPoint = this.multipleParticleModel.temperatureSetPointProperty.get();
    let accelerationDueToGravity = this.multipleParticleModel.gravitationalAcceleration;
    if (temperatureSetPoint < TEMPERATURE_BELOW_WHICH_GRAVITY_INCREASES) {
      // Below a certain temperature, gravity is increased to counteract some odd-looking behavior caused by the
      // thermostat.  The multiplier was empirically determined.
      accelerationDueToGravity = accelerationDueToGravity * (1 + (TEMPERATURE_BELOW_WHICH_GRAVITY_INCREASES - temperatureSetPoint) * 0.32);
    }
    const nextMoleculeForces = moleculeDataSet.nextMoleculeForces;
    const nextMoleculeTorques = moleculeDataSet.nextMoleculeTorques;
    for (let i = 0; i < moleculeDataSet.getNumberOfMolecules(); i++) {
      nextMoleculeForces[i].setXY(0, accelerationDueToGravity);
      nextMoleculeTorques[i] = 0;
    }
  }

  /**
   * @param moleculeDataSet
   * @override
   * @protected
   */
  updateInteractionForces(moleculeDataSet) {
    const moleculeCenterOfMassPositions = moleculeDataSet.moleculeCenterOfMassPositions;
    const atomPositions = moleculeDataSet.atomPositions;
    const nextMoleculeForces = moleculeDataSet.nextMoleculeForces;
    const nextMoleculeTorques = moleculeDataSet.nextMoleculeTorques;
    const temperatureSetPoint = this.multipleParticleModel.temperatureSetPointProperty.get();

    // Verify that this is being used on an appropriate data set.
    assert && assert(moleculeDataSet.getAtomsPerMolecule() === 3);

    // Set up the values for the charges that will be used when calculating the coloumb interactions.
    let q0;
    let temperatureFactor;

    // A scaling factor is added here for the repulsive portion of the Lennard-Jones force.  The idea is that the
    // force goes up at lower temperatures in order to make the ice appear more spacious.  This is not real physics,
    // it is "hollywooding" in order to get the crystalline behavior we need for ice.
    let repulsiveForceScalingFactor;
    if (temperatureSetPoint < WATER_FULLY_FROZEN_TEMPERATURE) {
      // Use stronger electrostatic forces in order to create more of a crystal structure.
      q0 = WATER_FULLY_FROZEN_ELECTROSTATIC_FORCE;

      // Scale by the max to force space in the crystal.
      repulsiveForceScalingFactor = MAX_REPULSIVE_SCALING_FACTOR_FOR_WATER;
    } else if (temperatureSetPoint > WATER_FULLY_MELTED_TEMPERATURE) {
      // Use weaker electrostatic forces in order to create more of an appearance of liquid.
      q0 = WATER_FULLY_MELTED_ELECTROSTATIC_FORCE;

      // No scaling of the repulsive force.
      repulsiveForceScalingFactor = 1;
    } else {
      // We are somewhere in between the temperature for being fully melted or frozen, so scale accordingly.
      temperatureFactor = (temperatureSetPoint - WATER_FULLY_FROZEN_TEMPERATURE) / (WATER_FULLY_MELTED_TEMPERATURE - WATER_FULLY_FROZEN_TEMPERATURE);
      q0 = WATER_FULLY_FROZEN_ELECTROSTATIC_FORCE - temperatureFactor * (WATER_FULLY_FROZEN_ELECTROSTATIC_FORCE - WATER_FULLY_MELTED_ELECTROSTATIC_FORCE);
      repulsiveForceScalingFactor = MAX_REPULSIVE_SCALING_FACTOR_FOR_WATER - temperatureFactor * (MAX_REPULSIVE_SCALING_FACTOR_FOR_WATER - 1);
    }
    this.normalCharges[0] = -2 * q0;
    this.normalCharges[1] = q0;
    this.normalCharges[2] = q0;
    this.alteredCharges[0] = -2 * q0;
    this.alteredCharges[1] = 1.67 * q0;
    this.alteredCharges[2] = 0.33 * q0;

    // Calculate the force and torque due to inter-particle interactions.
    const numberOfMolecules = moleculeDataSet.getNumberOfMolecules();
    for (let i = 0; i < numberOfMolecules; i++) {
      const moleculeCenterOfMassPosition1 = moleculeCenterOfMassPositions[i];
      const m1x = moleculeCenterOfMassPosition1.x;
      const m1y = moleculeCenterOfMassPosition1.y;
      const nextMoleculeForceI = nextMoleculeForces[i];

      // Select which charges to use for this molecule.  This is part of the "hollywooding" to make the solid form
      // appear more crystalline.
      let chargesA;
      if (i % 2 === 0) {
        chargesA = this.normalCharges;
      } else {
        chargesA = this.alteredCharges;
      }
      for (let j = i + 1; j < numberOfMolecules; j++) {
        const moleculeCenterOfMassPosition2 = moleculeCenterOfMassPositions[j];
        const m2x = moleculeCenterOfMassPosition2.x;
        const m2y = moleculeCenterOfMassPosition2.y;
        const nextMoleculeForceJ = nextMoleculeForces[j];

        // Calculate Lennard-Jones potential between mass centers.
        let dx = m1x - m2x;
        let dy = m1y - m2y;
        let distanceSquared = Math.max(dx * dx + dy * dy, AbstractVerletAlgorithm.MIN_DISTANCE_SQUARED);
        if (distanceSquared < AbstractVerletAlgorithm.PARTICLE_INTERACTION_DISTANCE_THRESH_SQRD) {
          // Select charges for the other molecule.
          let chargesB;
          if (j % 2 === 0) {
            chargesB = this.normalCharges;
          } else {
            chargesB = this.alteredCharges;
          }

          // Calculate the Lennard-Jones interaction forces.
          let r2inv = 1 / distanceSquared;
          const r6inv = r2inv * r2inv * r2inv;
          let forceScalar = 48 * r2inv * r6inv * (r6inv * repulsiveForceScalingFactor - 0.5);
          let forceX = dx * forceScalar;
          let forceY = dy * forceScalar;
          nextMoleculeForceI.addXY(forceX, forceY);
          nextMoleculeForceJ.subtractXY(forceX, forceY);
          this.potentialEnergy += 4 * r6inv * (r6inv - 1) + 0.016316891136;

          // Calculate coulomb-like interactions between atoms on individual water molecules.
          for (let ii = 0; ii < 3; ii++) {
            const atomIndex1 = 3 * i + ii;
            if ((atomIndex1 + 1) % 6 === 0) {
              // This is a hydrogen atom that is not going to be included in the calculation in order to try to
              // create a more crystalline solid.  This is part of the "hollywooding" that we do to create a better
              // looking water crystal at low temperatures.
              continue;
            }
            const chargeAii = chargesA[ii];
            const atomPosition1 = atomPositions[atomIndex1];
            const a1x = atomPosition1.x;
            const a1y = atomPosition1.y;
            for (let jj = 0; jj < 3; jj++) {
              const atomIndex2 = 3 * j + jj;
              if ((atomIndex2 + 1) % 6 === 0) {
                // This is a hydrogen atom that is not going to be included in the calculation in order to try to
                // create a more crystalline solid.  This is part of the "hollywooding" that we do to create a better
                // looking water crystal at low temperatures.
                continue;
              }
              const atomPosition2 = atomPositions[atomIndex2];
              const a2x = atomPosition2.x;
              const a2y = atomPosition2.y;
              dx = atomPosition1.x - atomPosition2.x;
              dy = atomPosition1.y - atomPosition2.y;
              distanceSquared = Math.max(dx * dx + dy * dy, AbstractVerletAlgorithm.MIN_DISTANCE_SQUARED);
              r2inv = 1 / distanceSquared;
              forceScalar = chargeAii * chargesB[jj] * r2inv * r2inv;
              forceX = dx * forceScalar;
              forceY = dy * forceScalar;
              nextMoleculeForceI.addXY(forceX, forceY);
              nextMoleculeForceJ.subtractXY(forceX, forceY);
              nextMoleculeTorques[i] += (a1x - m1x) * forceY - (a1y - m1y) * forceX;
              nextMoleculeTorques[j] -= (a2x - m2x) * forceY - (a2y - m2y) * forceX;
            }
          }
        }
      }
    }
  }

  /**
   * @param {MoleculeForceAndMotionDataSet} moleculeDataSet
   * @param {number} timeStep
   * @override
   * @protected
   */
  updateVelocitiesAndRotationRates(moleculeDataSet, timeStep) {
    const numberOfMolecules = moleculeDataSet.getNumberOfMolecules();
    const moleculeVelocities = moleculeDataSet.moleculeVelocities;
    const moleculeForces = moleculeDataSet.moleculeForces;
    const nextMoleculeForces = moleculeDataSet.nextMoleculeForces;
    const moleculeRotationRates = moleculeDataSet.moleculeRotationRates;
    const moleculeTorques = moleculeDataSet.moleculeTorques;
    const nextMoleculeTorques = moleculeDataSet.nextMoleculeTorques;
    const moleculeMass = moleculeDataSet.getMoleculeMass();
    const moleculeRotationalInertia = moleculeDataSet.getMoleculeRotationalInertia();
    const timeStepHalf = timeStep / 2;

    // Update the velocities and rotation rates based on the forces being exerted on the molecules, then calculate
    // the kinetic energy of the system.
    let translationalKineticEnergy = 0;
    let rotationalKineticEnergy = 0;
    for (let i = 0; i < numberOfMolecules; i++) {
      const xVel = moleculeVelocities[i].x + timeStepHalf * (moleculeForces[i].x + nextMoleculeForces[i].x) * this.massInverse;
      const yVel = moleculeVelocities[i].y + timeStepHalf * (moleculeForces[i].y + nextMoleculeForces[i].y) * this.massInverse;
      moleculeVelocities[i].setXY(xVel, yVel);
      let rotationRate = moleculeRotationRates[i] + timeStepHalf * (moleculeTorques[i] + nextMoleculeTorques[i]) * this.inertiaInverse;

      // If needed, clamp the rotation rate to an empirically determined max to prevent runaway rotation, see
      // https://github.com/phetsims/states-of-matter/issues/152
      if (rotationRate > MAX_ROTATION_RATE) {
        rotationRate = MAX_ROTATION_RATE;
      } else if (rotationRate < -MAX_ROTATION_RATE) {
        rotationRate = -MAX_ROTATION_RATE;
      }
      moleculeRotationRates[i] = rotationRate;

      // calculate the kinetic energy
      translationalKineticEnergy += 0.5 * moleculeMass * moleculeVelocities[i].magnitudeSquared;
      rotationalKineticEnergy += 0.5 * moleculeRotationalInertia * moleculeRotationRates[i] * moleculeRotationRates[i];

      // Move the newly calculated forces and torques into the current spots.
      moleculeForces[i].setXY(nextMoleculeForces[i].x, nextMoleculeForces[i].y);
      moleculeTorques[i] = nextMoleculeTorques[i];
    }

    // Record the calculated temperature.
    if (numberOfMolecules > 0) {
      this.calculatedTemperature = (translationalKineticEnergy + rotationalKineticEnergy) / numberOfMolecules;
    } else {
      this.calculatedTemperature = this.multipleParticleModel.minModelTemperature;
    }
  }
}
statesOfMatter.register('WaterVerletAlgorithm', WaterVerletAlgorithm);
export default WaterVerletAlgorithm;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzdGF0ZXNPZk1hdHRlciIsIkFic3RyYWN0VmVybGV0QWxnb3JpdGhtIiwiV2F0ZXJBdG9tUG9zaXRpb25VcGRhdGVyIiwiV0FURVJfRlVMTFlfTUVMVEVEX1RFTVBFUkFUVVJFIiwiV0FURVJfRlVMTFlfTUVMVEVEX0VMRUNUUk9TVEFUSUNfRk9SQ0UiLCJXQVRFUl9GVUxMWV9GUk9aRU5fVEVNUEVSQVRVUkUiLCJXQVRFUl9GVUxMWV9GUk9aRU5fRUxFQ1RST1NUQVRJQ19GT1JDRSIsIk1BWF9SRVBVTFNJVkVfU0NBTElOR19GQUNUT1JfRk9SX1dBVEVSIiwiTUFYX1JPVEFUSU9OX1JBVEUiLCJURU1QRVJBVFVSRV9CRUxPV19XSElDSF9HUkFWSVRZX0lOQ1JFQVNFUyIsIldhdGVyVmVybGV0QWxnb3JpdGhtIiwiY29uc3RydWN0b3IiLCJtdWx0aXBsZVBhcnRpY2xlTW9kZWwiLCJwb3NpdGlvblVwZGF0ZXIiLCJtYXNzSW52ZXJzZSIsIm1vbGVjdWxlRGF0YVNldCIsImdldE1vbGVjdWxlTWFzcyIsImluZXJ0aWFJbnZlcnNlIiwiZ2V0TW9sZWN1bGVSb3RhdGlvbmFsSW5lcnRpYSIsIm5vcm1hbENoYXJnZXMiLCJBcnJheSIsImFsdGVyZWRDaGFyZ2VzIiwiaW5pdGlhbGl6ZUZvcmNlcyIsInRlbXBlcmF0dXJlU2V0UG9pbnQiLCJ0ZW1wZXJhdHVyZVNldFBvaW50UHJvcGVydHkiLCJnZXQiLCJhY2NlbGVyYXRpb25EdWVUb0dyYXZpdHkiLCJncmF2aXRhdGlvbmFsQWNjZWxlcmF0aW9uIiwibmV4dE1vbGVjdWxlRm9yY2VzIiwibmV4dE1vbGVjdWxlVG9ycXVlcyIsImkiLCJnZXROdW1iZXJPZk1vbGVjdWxlcyIsInNldFhZIiwidXBkYXRlSW50ZXJhY3Rpb25Gb3JjZXMiLCJtb2xlY3VsZUNlbnRlck9mTWFzc1Bvc2l0aW9ucyIsImF0b21Qb3NpdGlvbnMiLCJhc3NlcnQiLCJnZXRBdG9tc1Blck1vbGVjdWxlIiwicTAiLCJ0ZW1wZXJhdHVyZUZhY3RvciIsInJlcHVsc2l2ZUZvcmNlU2NhbGluZ0ZhY3RvciIsIm51bWJlck9mTW9sZWN1bGVzIiwibW9sZWN1bGVDZW50ZXJPZk1hc3NQb3NpdGlvbjEiLCJtMXgiLCJ4IiwibTF5IiwieSIsIm5leHRNb2xlY3VsZUZvcmNlSSIsImNoYXJnZXNBIiwiaiIsIm1vbGVjdWxlQ2VudGVyT2ZNYXNzUG9zaXRpb24yIiwibTJ4IiwibTJ5IiwibmV4dE1vbGVjdWxlRm9yY2VKIiwiZHgiLCJkeSIsImRpc3RhbmNlU3F1YXJlZCIsIk1hdGgiLCJtYXgiLCJNSU5fRElTVEFOQ0VfU1FVQVJFRCIsIlBBUlRJQ0xFX0lOVEVSQUNUSU9OX0RJU1RBTkNFX1RIUkVTSF9TUVJEIiwiY2hhcmdlc0IiLCJyMmludiIsInI2aW52IiwiZm9yY2VTY2FsYXIiLCJmb3JjZVgiLCJmb3JjZVkiLCJhZGRYWSIsInN1YnRyYWN0WFkiLCJwb3RlbnRpYWxFbmVyZ3kiLCJpaSIsImF0b21JbmRleDEiLCJjaGFyZ2VBaWkiLCJhdG9tUG9zaXRpb24xIiwiYTF4IiwiYTF5IiwiamoiLCJhdG9tSW5kZXgyIiwiYXRvbVBvc2l0aW9uMiIsImEyeCIsImEyeSIsInVwZGF0ZVZlbG9jaXRpZXNBbmRSb3RhdGlvblJhdGVzIiwidGltZVN0ZXAiLCJtb2xlY3VsZVZlbG9jaXRpZXMiLCJtb2xlY3VsZUZvcmNlcyIsIm1vbGVjdWxlUm90YXRpb25SYXRlcyIsIm1vbGVjdWxlVG9ycXVlcyIsIm1vbGVjdWxlTWFzcyIsIm1vbGVjdWxlUm90YXRpb25hbEluZXJ0aWEiLCJ0aW1lU3RlcEhhbGYiLCJ0cmFuc2xhdGlvbmFsS2luZXRpY0VuZXJneSIsInJvdGF0aW9uYWxLaW5ldGljRW5lcmd5IiwieFZlbCIsInlWZWwiLCJyb3RhdGlvblJhdGUiLCJtYWduaXR1ZGVTcXVhcmVkIiwiY2FsY3VsYXRlZFRlbXBlcmF0dXJlIiwibWluTW9kZWxUZW1wZXJhdHVyZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiV2F0ZXJWZXJsZXRBbGdvcml0aG0uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogSW1wbGVtZW50YXRpb24gb2YgdGhlIFZlcmxldCBhbGdvcml0aG0gZm9yIHNpbXVsYXRpbmcgbW9sZWN1bGFyIGludGVyYWN0aW9uIGJhc2VkIG9uIHRoZSBMZW5uYXJkLUpvbmVzIHBvdGVudGlhbC5cclxuICogVGhpcyB2ZXJzaW9uIGlzIHVzZWQgc3BlY2lmaWNhbGx5IGZvciBzaW11bGF0aW5nIHdhdGVyLCBpLmUuIEgyTywgYW5kIGFsc28gaW5jbHVkZXMgY2FsY3VsYXRpb25zIGZvciB0aGUgY2hhcmdlXHJcbiAqIGRpc3RyaWJ1dGlvbnMgcHJlc2VudCBpbiB0aGlzIG1vbGVjdWxlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvXHJcbiAqIEBhdXRob3IgU2lkZGhhcnRoYSBDaGludGhhcGFsbHkgKEFjdHVhbCBDb25jZXB0cylcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvblxyXG4gKi9cclxuXHJcbmltcG9ydCBzdGF0ZXNPZk1hdHRlciBmcm9tICcuLi8uLi8uLi9zdGF0ZXNPZk1hdHRlci5qcyc7XHJcbmltcG9ydCBBYnN0cmFjdFZlcmxldEFsZ29yaXRobSBmcm9tICcuL0Fic3RyYWN0VmVybGV0QWxnb3JpdGhtLmpzJztcclxuaW1wb3J0IFdhdGVyQXRvbVBvc2l0aW9uVXBkYXRlciBmcm9tICcuL1dhdGVyQXRvbVBvc2l0aW9uVXBkYXRlci5qcyc7XHJcblxyXG4vLyBjb25zdGFudHMsIG1vc3RseSBwYXJhbWV0ZXJzIHVzZWQgZm9yIFwiaG9sbHl3b29kaW5nXCIgb2YgdGhlIHdhdGVyIGNyeXN0YWxcclxuY29uc3QgV0FURVJfRlVMTFlfTUVMVEVEX1RFTVBFUkFUVVJFID0gMC4zO1xyXG5jb25zdCBXQVRFUl9GVUxMWV9NRUxURURfRUxFQ1RST1NUQVRJQ19GT1JDRSA9IDEuMDtcclxuY29uc3QgV0FURVJfRlVMTFlfRlJPWkVOX1RFTVBFUkFUVVJFID0gMC4yMjtcclxuY29uc3QgV0FURVJfRlVMTFlfRlJPWkVOX0VMRUNUUk9TVEFUSUNfRk9SQ0UgPSA0LjI1O1xyXG5jb25zdCBNQVhfUkVQVUxTSVZFX1NDQUxJTkdfRkFDVE9SX0ZPUl9XQVRFUiA9IDUuMjU7XHJcbmNvbnN0IE1BWF9ST1RBVElPTl9SQVRFID0gMTY7IC8vIHJldm9sdXRpb25zIHBlciBzZWNvbmQsIGVtcGlyaWNhbGx5IGRldGVybWluZWQsIHNlZSB1c2FnZSBiZWxvd1xyXG5jb25zdCBURU1QRVJBVFVSRV9CRUxPV19XSElDSF9HUkFWSVRZX0lOQ1JFQVNFUyA9IDAuMTA7XHJcblxyXG5jbGFzcyBXYXRlclZlcmxldEFsZ29yaXRobSBleHRlbmRzIEFic3RyYWN0VmVybGV0QWxnb3JpdGhtIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtNdWx0aXBsZVBhcnRpY2xlTW9kZWx9IG11bHRpcGxlUGFydGljbGVNb2RlbFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBtdWx0aXBsZVBhcnRpY2xlTW9kZWwgKSB7XHJcblxyXG4gICAgc3VwZXIoIG11bHRpcGxlUGFydGljbGVNb2RlbCApO1xyXG4gICAgdGhpcy5wb3NpdGlvblVwZGF0ZXIgPSBXYXRlckF0b21Qb3NpdGlvblVwZGF0ZXI7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgcHJlY29tcHV0ZWQgdmFsdWVzIHRvIHNhdmUgdGltZSBsYXRlclxyXG4gICAgdGhpcy5tYXNzSW52ZXJzZSA9IDEgLyBtdWx0aXBsZVBhcnRpY2xlTW9kZWwubW9sZWN1bGVEYXRhU2V0LmdldE1vbGVjdWxlTWFzcygpO1xyXG4gICAgdGhpcy5pbmVydGlhSW52ZXJzZSA9IDEgLyBtdWx0aXBsZVBhcnRpY2xlTW9kZWwubW9sZWN1bGVEYXRhU2V0LmdldE1vbGVjdWxlUm90YXRpb25hbEluZXJ0aWEoKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSBwcmUtYWxsb2NhdGVkIGFycmF5cyB0byBhdm9pZCByZWFsbG9jYXRpb24gd2l0aCBlYWNoIGZvcmNlIGFuZCBwb3NpdGlvbiB1cGRhdGVcclxuICAgIHRoaXMubm9ybWFsQ2hhcmdlcyA9IG5ldyBBcnJheSggMyApO1xyXG4gICAgdGhpcy5hbHRlcmVkQ2hhcmdlcyA9IG5ldyBBcnJheSggMyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtNb2xlY3VsZUZvcmNlQW5kTW90aW9uRGF0YVNldH0gbW9sZWN1bGVEYXRhU2V0XHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICogQHByb3RlY3RlZFxyXG4gICAqL1xyXG4gIGluaXRpYWxpemVGb3JjZXMoIG1vbGVjdWxlRGF0YVNldCApIHtcclxuICAgIGNvbnN0IHRlbXBlcmF0dXJlU2V0UG9pbnQgPSB0aGlzLm11bHRpcGxlUGFydGljbGVNb2RlbC50ZW1wZXJhdHVyZVNldFBvaW50UHJvcGVydHkuZ2V0KCk7XHJcbiAgICBsZXQgYWNjZWxlcmF0aW9uRHVlVG9HcmF2aXR5ID0gdGhpcy5tdWx0aXBsZVBhcnRpY2xlTW9kZWwuZ3Jhdml0YXRpb25hbEFjY2VsZXJhdGlvbjtcclxuICAgIGlmICggdGVtcGVyYXR1cmVTZXRQb2ludCA8IFRFTVBFUkFUVVJFX0JFTE9XX1dISUNIX0dSQVZJVFlfSU5DUkVBU0VTICkge1xyXG5cclxuICAgICAgLy8gQmVsb3cgYSBjZXJ0YWluIHRlbXBlcmF0dXJlLCBncmF2aXR5IGlzIGluY3JlYXNlZCB0byBjb3VudGVyYWN0IHNvbWUgb2RkLWxvb2tpbmcgYmVoYXZpb3IgY2F1c2VkIGJ5IHRoZVxyXG4gICAgICAvLyB0aGVybW9zdGF0LiAgVGhlIG11bHRpcGxpZXIgd2FzIGVtcGlyaWNhbGx5IGRldGVybWluZWQuXHJcbiAgICAgIGFjY2VsZXJhdGlvbkR1ZVRvR3Jhdml0eSA9IGFjY2VsZXJhdGlvbkR1ZVRvR3Jhdml0eSAqXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICggMSArICggVEVNUEVSQVRVUkVfQkVMT1dfV0hJQ0hfR1JBVklUWV9JTkNSRUFTRVMgLSB0ZW1wZXJhdHVyZVNldFBvaW50ICkgKiAwLjMyICk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBuZXh0TW9sZWN1bGVGb3JjZXMgPSBtb2xlY3VsZURhdGFTZXQubmV4dE1vbGVjdWxlRm9yY2VzO1xyXG4gICAgY29uc3QgbmV4dE1vbGVjdWxlVG9ycXVlcyA9IG1vbGVjdWxlRGF0YVNldC5uZXh0TW9sZWN1bGVUb3JxdWVzO1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgbW9sZWN1bGVEYXRhU2V0LmdldE51bWJlck9mTW9sZWN1bGVzKCk7IGkrKyApIHtcclxuICAgICAgbmV4dE1vbGVjdWxlRm9yY2VzWyBpIF0uc2V0WFkoIDAsIGFjY2VsZXJhdGlvbkR1ZVRvR3Jhdml0eSApO1xyXG4gICAgICBuZXh0TW9sZWN1bGVUb3JxdWVzWyBpIF0gPSAwO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIG1vbGVjdWxlRGF0YVNldFxyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqIEBwcm90ZWN0ZWRcclxuICAgKi9cclxuICB1cGRhdGVJbnRlcmFjdGlvbkZvcmNlcyggbW9sZWN1bGVEYXRhU2V0ICkge1xyXG5cclxuICAgIGNvbnN0IG1vbGVjdWxlQ2VudGVyT2ZNYXNzUG9zaXRpb25zID0gbW9sZWN1bGVEYXRhU2V0Lm1vbGVjdWxlQ2VudGVyT2ZNYXNzUG9zaXRpb25zO1xyXG4gICAgY29uc3QgYXRvbVBvc2l0aW9ucyA9IG1vbGVjdWxlRGF0YVNldC5hdG9tUG9zaXRpb25zO1xyXG4gICAgY29uc3QgbmV4dE1vbGVjdWxlRm9yY2VzID0gbW9sZWN1bGVEYXRhU2V0Lm5leHRNb2xlY3VsZUZvcmNlcztcclxuICAgIGNvbnN0IG5leHRNb2xlY3VsZVRvcnF1ZXMgPSBtb2xlY3VsZURhdGFTZXQubmV4dE1vbGVjdWxlVG9ycXVlcztcclxuICAgIGNvbnN0IHRlbXBlcmF0dXJlU2V0UG9pbnQgPSB0aGlzLm11bHRpcGxlUGFydGljbGVNb2RlbC50ZW1wZXJhdHVyZVNldFBvaW50UHJvcGVydHkuZ2V0KCk7XHJcblxyXG4gICAgLy8gVmVyaWZ5IHRoYXQgdGhpcyBpcyBiZWluZyB1c2VkIG9uIGFuIGFwcHJvcHJpYXRlIGRhdGEgc2V0LlxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggbW9sZWN1bGVEYXRhU2V0LmdldEF0b21zUGVyTW9sZWN1bGUoKSA9PT0gMyApO1xyXG5cclxuICAgIC8vIFNldCB1cCB0aGUgdmFsdWVzIGZvciB0aGUgY2hhcmdlcyB0aGF0IHdpbGwgYmUgdXNlZCB3aGVuIGNhbGN1bGF0aW5nIHRoZSBjb2xvdW1iIGludGVyYWN0aW9ucy5cclxuICAgIGxldCBxMDtcclxuICAgIGxldCB0ZW1wZXJhdHVyZUZhY3RvcjtcclxuXHJcbiAgICAvLyBBIHNjYWxpbmcgZmFjdG9yIGlzIGFkZGVkIGhlcmUgZm9yIHRoZSByZXB1bHNpdmUgcG9ydGlvbiBvZiB0aGUgTGVubmFyZC1Kb25lcyBmb3JjZS4gIFRoZSBpZGVhIGlzIHRoYXQgdGhlXHJcbiAgICAvLyBmb3JjZSBnb2VzIHVwIGF0IGxvd2VyIHRlbXBlcmF0dXJlcyBpbiBvcmRlciB0byBtYWtlIHRoZSBpY2UgYXBwZWFyIG1vcmUgc3BhY2lvdXMuICBUaGlzIGlzIG5vdCByZWFsIHBoeXNpY3MsXHJcbiAgICAvLyBpdCBpcyBcImhvbGx5d29vZGluZ1wiIGluIG9yZGVyIHRvIGdldCB0aGUgY3J5c3RhbGxpbmUgYmVoYXZpb3Igd2UgbmVlZCBmb3IgaWNlLlxyXG4gICAgbGV0IHJlcHVsc2l2ZUZvcmNlU2NhbGluZ0ZhY3RvcjtcclxuXHJcbiAgICBpZiAoIHRlbXBlcmF0dXJlU2V0UG9pbnQgPCBXQVRFUl9GVUxMWV9GUk9aRU5fVEVNUEVSQVRVUkUgKSB7XHJcblxyXG4gICAgICAvLyBVc2Ugc3Ryb25nZXIgZWxlY3Ryb3N0YXRpYyBmb3JjZXMgaW4gb3JkZXIgdG8gY3JlYXRlIG1vcmUgb2YgYSBjcnlzdGFsIHN0cnVjdHVyZS5cclxuICAgICAgcTAgPSBXQVRFUl9GVUxMWV9GUk9aRU5fRUxFQ1RST1NUQVRJQ19GT1JDRTtcclxuXHJcbiAgICAgIC8vIFNjYWxlIGJ5IHRoZSBtYXggdG8gZm9yY2Ugc3BhY2UgaW4gdGhlIGNyeXN0YWwuXHJcbiAgICAgIHJlcHVsc2l2ZUZvcmNlU2NhbGluZ0ZhY3RvciA9IE1BWF9SRVBVTFNJVkVfU0NBTElOR19GQUNUT1JfRk9SX1dBVEVSO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIHRlbXBlcmF0dXJlU2V0UG9pbnQgPiBXQVRFUl9GVUxMWV9NRUxURURfVEVNUEVSQVRVUkUgKSB7XHJcblxyXG4gICAgICAvLyBVc2Ugd2Vha2VyIGVsZWN0cm9zdGF0aWMgZm9yY2VzIGluIG9yZGVyIHRvIGNyZWF0ZSBtb3JlIG9mIGFuIGFwcGVhcmFuY2Ugb2YgbGlxdWlkLlxyXG4gICAgICBxMCA9IFdBVEVSX0ZVTExZX01FTFRFRF9FTEVDVFJPU1RBVElDX0ZPUkNFO1xyXG5cclxuICAgICAgLy8gTm8gc2NhbGluZyBvZiB0aGUgcmVwdWxzaXZlIGZvcmNlLlxyXG4gICAgICByZXB1bHNpdmVGb3JjZVNjYWxpbmdGYWN0b3IgPSAxO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIC8vIFdlIGFyZSBzb21ld2hlcmUgaW4gYmV0d2VlbiB0aGUgdGVtcGVyYXR1cmUgZm9yIGJlaW5nIGZ1bGx5IG1lbHRlZCBvciBmcm96ZW4sIHNvIHNjYWxlIGFjY29yZGluZ2x5LlxyXG4gICAgICB0ZW1wZXJhdHVyZUZhY3RvciA9ICggdGVtcGVyYXR1cmVTZXRQb2ludCAtIFdBVEVSX0ZVTExZX0ZST1pFTl9URU1QRVJBVFVSRSApIC9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAoIFdBVEVSX0ZVTExZX01FTFRFRF9URU1QRVJBVFVSRSAtIFdBVEVSX0ZVTExZX0ZST1pFTl9URU1QRVJBVFVSRSApO1xyXG4gICAgICBxMCA9IFdBVEVSX0ZVTExZX0ZST1pFTl9FTEVDVFJPU1RBVElDX0ZPUkNFIC1cclxuICAgICAgICAgICAoIHRlbXBlcmF0dXJlRmFjdG9yICogKCBXQVRFUl9GVUxMWV9GUk9aRU5fRUxFQ1RST1NUQVRJQ19GT1JDRSAtIFdBVEVSX0ZVTExZX01FTFRFRF9FTEVDVFJPU1RBVElDX0ZPUkNFICkgKTtcclxuICAgICAgcmVwdWxzaXZlRm9yY2VTY2FsaW5nRmFjdG9yID0gTUFYX1JFUFVMU0lWRV9TQ0FMSU5HX0ZBQ1RPUl9GT1JfV0FURVIgLVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIHRlbXBlcmF0dXJlRmFjdG9yICogKCBNQVhfUkVQVUxTSVZFX1NDQUxJTkdfRkFDVE9SX0ZPUl9XQVRFUiAtIDEgKSApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5ub3JtYWxDaGFyZ2VzWyAwIF0gPSAtMiAqIHEwO1xyXG4gICAgdGhpcy5ub3JtYWxDaGFyZ2VzWyAxIF0gPSBxMDtcclxuICAgIHRoaXMubm9ybWFsQ2hhcmdlc1sgMiBdID0gcTA7XHJcbiAgICB0aGlzLmFsdGVyZWRDaGFyZ2VzWyAwIF0gPSAtMiAqIHEwO1xyXG4gICAgdGhpcy5hbHRlcmVkQ2hhcmdlc1sgMSBdID0gMS42NyAqIHEwO1xyXG4gICAgdGhpcy5hbHRlcmVkQ2hhcmdlc1sgMiBdID0gMC4zMyAqIHEwO1xyXG5cclxuICAgIC8vIENhbGN1bGF0ZSB0aGUgZm9yY2UgYW5kIHRvcnF1ZSBkdWUgdG8gaW50ZXItcGFydGljbGUgaW50ZXJhY3Rpb25zLlxyXG4gICAgY29uc3QgbnVtYmVyT2ZNb2xlY3VsZXMgPSBtb2xlY3VsZURhdGFTZXQuZ2V0TnVtYmVyT2ZNb2xlY3VsZXMoKTtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IG51bWJlck9mTW9sZWN1bGVzOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IG1vbGVjdWxlQ2VudGVyT2ZNYXNzUG9zaXRpb24xID0gbW9sZWN1bGVDZW50ZXJPZk1hc3NQb3NpdGlvbnNbIGkgXTtcclxuICAgICAgY29uc3QgbTF4ID0gbW9sZWN1bGVDZW50ZXJPZk1hc3NQb3NpdGlvbjEueDtcclxuICAgICAgY29uc3QgbTF5ID0gbW9sZWN1bGVDZW50ZXJPZk1hc3NQb3NpdGlvbjEueTtcclxuICAgICAgY29uc3QgbmV4dE1vbGVjdWxlRm9yY2VJID0gbmV4dE1vbGVjdWxlRm9yY2VzWyBpIF07XHJcblxyXG4gICAgICAvLyBTZWxlY3Qgd2hpY2ggY2hhcmdlcyB0byB1c2UgZm9yIHRoaXMgbW9sZWN1bGUuICBUaGlzIGlzIHBhcnQgb2YgdGhlIFwiaG9sbHl3b29kaW5nXCIgdG8gbWFrZSB0aGUgc29saWQgZm9ybVxyXG4gICAgICAvLyBhcHBlYXIgbW9yZSBjcnlzdGFsbGluZS5cclxuICAgICAgbGV0IGNoYXJnZXNBO1xyXG4gICAgICBpZiAoIGkgJSAyID09PSAwICkge1xyXG4gICAgICAgIGNoYXJnZXNBID0gdGhpcy5ub3JtYWxDaGFyZ2VzO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGNoYXJnZXNBID0gdGhpcy5hbHRlcmVkQ2hhcmdlcztcclxuICAgICAgfVxyXG5cclxuICAgICAgZm9yICggbGV0IGogPSBpICsgMTsgaiA8IG51bWJlck9mTW9sZWN1bGVzOyBqKysgKSB7XHJcbiAgICAgICAgY29uc3QgbW9sZWN1bGVDZW50ZXJPZk1hc3NQb3NpdGlvbjIgPSBtb2xlY3VsZUNlbnRlck9mTWFzc1Bvc2l0aW9uc1sgaiBdO1xyXG4gICAgICAgIGNvbnN0IG0yeCA9IG1vbGVjdWxlQ2VudGVyT2ZNYXNzUG9zaXRpb24yLng7XHJcbiAgICAgICAgY29uc3QgbTJ5ID0gbW9sZWN1bGVDZW50ZXJPZk1hc3NQb3NpdGlvbjIueTtcclxuICAgICAgICBjb25zdCBuZXh0TW9sZWN1bGVGb3JjZUogPSBuZXh0TW9sZWN1bGVGb3JjZXNbIGogXTtcclxuXHJcbiAgICAgICAgLy8gQ2FsY3VsYXRlIExlbm5hcmQtSm9uZXMgcG90ZW50aWFsIGJldHdlZW4gbWFzcyBjZW50ZXJzLlxyXG4gICAgICAgIGxldCBkeCA9IG0xeCAtIG0yeDtcclxuICAgICAgICBsZXQgZHkgPSBtMXkgLSBtMnk7XHJcbiAgICAgICAgbGV0IGRpc3RhbmNlU3F1YXJlZCA9IE1hdGgubWF4KCBkeCAqIGR4ICsgZHkgKiBkeSwgQWJzdHJhY3RWZXJsZXRBbGdvcml0aG0uTUlOX0RJU1RBTkNFX1NRVUFSRUQgKTtcclxuICAgICAgICBpZiAoIGRpc3RhbmNlU3F1YXJlZCA8IEFic3RyYWN0VmVybGV0QWxnb3JpdGhtLlBBUlRJQ0xFX0lOVEVSQUNUSU9OX0RJU1RBTkNFX1RIUkVTSF9TUVJEICkge1xyXG4gICAgICAgICAgLy8gU2VsZWN0IGNoYXJnZXMgZm9yIHRoZSBvdGhlciBtb2xlY3VsZS5cclxuICAgICAgICAgIGxldCBjaGFyZ2VzQjtcclxuICAgICAgICAgIGlmICggaiAlIDIgPT09IDAgKSB7XHJcbiAgICAgICAgICAgIGNoYXJnZXNCID0gdGhpcy5ub3JtYWxDaGFyZ2VzO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNoYXJnZXNCID0gdGhpcy5hbHRlcmVkQ2hhcmdlcztcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIExlbm5hcmQtSm9uZXMgaW50ZXJhY3Rpb24gZm9yY2VzLlxyXG4gICAgICAgICAgbGV0IHIyaW52ID0gMSAvIGRpc3RhbmNlU3F1YXJlZDtcclxuICAgICAgICAgIGNvbnN0IHI2aW52ID0gcjJpbnYgKiByMmludiAqIHIyaW52O1xyXG5cclxuICAgICAgICAgIGxldCBmb3JjZVNjYWxhciA9IDQ4ICogcjJpbnYgKiByNmludiAqICggKCByNmludiAqIHJlcHVsc2l2ZUZvcmNlU2NhbGluZ0ZhY3RvciApIC0gMC41ICk7XHJcbiAgICAgICAgICBsZXQgZm9yY2VYID0gZHggKiBmb3JjZVNjYWxhcjtcclxuICAgICAgICAgIGxldCBmb3JjZVkgPSBkeSAqIGZvcmNlU2NhbGFyO1xyXG4gICAgICAgICAgbmV4dE1vbGVjdWxlRm9yY2VJLmFkZFhZKCBmb3JjZVgsIGZvcmNlWSApO1xyXG4gICAgICAgICAgbmV4dE1vbGVjdWxlRm9yY2VKLnN1YnRyYWN0WFkoIGZvcmNlWCwgZm9yY2VZICk7XHJcbiAgICAgICAgICB0aGlzLnBvdGVudGlhbEVuZXJneSArPSA0ICogcjZpbnYgKiAoIHI2aW52IC0gMSApICsgMC4wMTYzMTY4OTExMzY7XHJcblxyXG4gICAgICAgICAgLy8gQ2FsY3VsYXRlIGNvdWxvbWItbGlrZSBpbnRlcmFjdGlvbnMgYmV0d2VlbiBhdG9tcyBvbiBpbmRpdmlkdWFsIHdhdGVyIG1vbGVjdWxlcy5cclxuICAgICAgICAgIGZvciAoIGxldCBpaSA9IDA7IGlpIDwgMzsgaWkrKyApIHtcclxuICAgICAgICAgICAgY29uc3QgYXRvbUluZGV4MSA9IDMgKiBpICsgaWk7XHJcbiAgICAgICAgICAgIGlmICggKCBhdG9tSW5kZXgxICsgMSApICUgNiA9PT0gMCApIHtcclxuXHJcbiAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIGh5ZHJvZ2VuIGF0b20gdGhhdCBpcyBub3QgZ29pbmcgdG8gYmUgaW5jbHVkZWQgaW4gdGhlIGNhbGN1bGF0aW9uIGluIG9yZGVyIHRvIHRyeSB0b1xyXG4gICAgICAgICAgICAgIC8vIGNyZWF0ZSBhIG1vcmUgY3J5c3RhbGxpbmUgc29saWQuICBUaGlzIGlzIHBhcnQgb2YgdGhlIFwiaG9sbHl3b29kaW5nXCIgdGhhdCB3ZSBkbyB0byBjcmVhdGUgYSBiZXR0ZXJcclxuICAgICAgICAgICAgICAvLyBsb29raW5nIHdhdGVyIGNyeXN0YWwgYXQgbG93IHRlbXBlcmF0dXJlcy5cclxuICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgY2hhcmdlQWlpID0gY2hhcmdlc0FbIGlpIF07XHJcbiAgICAgICAgICAgIGNvbnN0IGF0b21Qb3NpdGlvbjEgPSBhdG9tUG9zaXRpb25zWyBhdG9tSW5kZXgxIF07XHJcbiAgICAgICAgICAgIGNvbnN0IGExeCA9IGF0b21Qb3NpdGlvbjEueDtcclxuICAgICAgICAgICAgY29uc3QgYTF5ID0gYXRvbVBvc2l0aW9uMS55O1xyXG5cclxuICAgICAgICAgICAgZm9yICggbGV0IGpqID0gMDsgamogPCAzOyBqaisrICkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGF0b21JbmRleDIgPSAzICogaiArIGpqO1xyXG4gICAgICAgICAgICAgIGlmICggKCBhdG9tSW5kZXgyICsgMSApICUgNiA9PT0gMCApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgaHlkcm9nZW4gYXRvbSB0aGF0IGlzIG5vdCBnb2luZyB0byBiZSBpbmNsdWRlZCBpbiB0aGUgY2FsY3VsYXRpb24gaW4gb3JkZXIgdG8gdHJ5IHRvXHJcbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYSBtb3JlIGNyeXN0YWxsaW5lIHNvbGlkLiAgVGhpcyBpcyBwYXJ0IG9mIHRoZSBcImhvbGx5d29vZGluZ1wiIHRoYXQgd2UgZG8gdG8gY3JlYXRlIGEgYmV0dGVyXHJcbiAgICAgICAgICAgICAgICAvLyBsb29raW5nIHdhdGVyIGNyeXN0YWwgYXQgbG93IHRlbXBlcmF0dXJlcy5cclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgY29uc3QgYXRvbVBvc2l0aW9uMiA9IGF0b21Qb3NpdGlvbnNbIGF0b21JbmRleDIgXTtcclxuICAgICAgICAgICAgICBjb25zdCBhMnggPSBhdG9tUG9zaXRpb24yLng7XHJcbiAgICAgICAgICAgICAgY29uc3QgYTJ5ID0gYXRvbVBvc2l0aW9uMi55O1xyXG5cclxuICAgICAgICAgICAgICBkeCA9IGF0b21Qb3NpdGlvbjEueCAtIGF0b21Qb3NpdGlvbjIueDtcclxuICAgICAgICAgICAgICBkeSA9IGF0b21Qb3NpdGlvbjEueSAtIGF0b21Qb3NpdGlvbjIueTtcclxuICAgICAgICAgICAgICBkaXN0YW5jZVNxdWFyZWQgPSBNYXRoLm1heCggZHggKiBkeCArIGR5ICogZHksIEFic3RyYWN0VmVybGV0QWxnb3JpdGhtLk1JTl9ESVNUQU5DRV9TUVVBUkVEICk7XHJcbiAgICAgICAgICAgICAgcjJpbnYgPSAxIC8gZGlzdGFuY2VTcXVhcmVkO1xyXG4gICAgICAgICAgICAgIGZvcmNlU2NhbGFyID0gY2hhcmdlQWlpICogY2hhcmdlc0JbIGpqIF0gKiByMmludiAqIHIyaW52O1xyXG4gICAgICAgICAgICAgIGZvcmNlWCA9IGR4ICogZm9yY2VTY2FsYXI7XHJcbiAgICAgICAgICAgICAgZm9yY2VZID0gZHkgKiBmb3JjZVNjYWxhcjtcclxuICAgICAgICAgICAgICBuZXh0TW9sZWN1bGVGb3JjZUkuYWRkWFkoIGZvcmNlWCwgZm9yY2VZICk7XHJcbiAgICAgICAgICAgICAgbmV4dE1vbGVjdWxlRm9yY2VKLnN1YnRyYWN0WFkoIGZvcmNlWCwgZm9yY2VZICk7XHJcbiAgICAgICAgICAgICAgbmV4dE1vbGVjdWxlVG9ycXVlc1sgaSBdICs9ICggYTF4IC0gbTF4ICkgKiBmb3JjZVkgLSAoIGExeSAtIG0xeSApICogZm9yY2VYO1xyXG4gICAgICAgICAgICAgIG5leHRNb2xlY3VsZVRvcnF1ZXNbIGogXSAtPSAoIGEyeCAtIG0yeCApICogZm9yY2VZIC0gKCBhMnkgLSBtMnkgKSAqIGZvcmNlWDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtNb2xlY3VsZUZvcmNlQW5kTW90aW9uRGF0YVNldH0gbW9sZWN1bGVEYXRhU2V0XHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHRpbWVTdGVwXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICogQHByb3RlY3RlZFxyXG4gICAqL1xyXG4gIHVwZGF0ZVZlbG9jaXRpZXNBbmRSb3RhdGlvblJhdGVzKCBtb2xlY3VsZURhdGFTZXQsIHRpbWVTdGVwICkge1xyXG5cclxuICAgIGNvbnN0IG51bWJlck9mTW9sZWN1bGVzID0gbW9sZWN1bGVEYXRhU2V0LmdldE51bWJlck9mTW9sZWN1bGVzKCk7XHJcbiAgICBjb25zdCBtb2xlY3VsZVZlbG9jaXRpZXMgPSBtb2xlY3VsZURhdGFTZXQubW9sZWN1bGVWZWxvY2l0aWVzO1xyXG4gICAgY29uc3QgbW9sZWN1bGVGb3JjZXMgPSBtb2xlY3VsZURhdGFTZXQubW9sZWN1bGVGb3JjZXM7XHJcbiAgICBjb25zdCBuZXh0TW9sZWN1bGVGb3JjZXMgPSBtb2xlY3VsZURhdGFTZXQubmV4dE1vbGVjdWxlRm9yY2VzO1xyXG4gICAgY29uc3QgbW9sZWN1bGVSb3RhdGlvblJhdGVzID0gbW9sZWN1bGVEYXRhU2V0Lm1vbGVjdWxlUm90YXRpb25SYXRlcztcclxuICAgIGNvbnN0IG1vbGVjdWxlVG9ycXVlcyA9IG1vbGVjdWxlRGF0YVNldC5tb2xlY3VsZVRvcnF1ZXM7XHJcbiAgICBjb25zdCBuZXh0TW9sZWN1bGVUb3JxdWVzID0gbW9sZWN1bGVEYXRhU2V0Lm5leHRNb2xlY3VsZVRvcnF1ZXM7XHJcbiAgICBjb25zdCBtb2xlY3VsZU1hc3MgPSBtb2xlY3VsZURhdGFTZXQuZ2V0TW9sZWN1bGVNYXNzKCk7XHJcbiAgICBjb25zdCBtb2xlY3VsZVJvdGF0aW9uYWxJbmVydGlhID0gbW9sZWN1bGVEYXRhU2V0LmdldE1vbGVjdWxlUm90YXRpb25hbEluZXJ0aWEoKTtcclxuXHJcbiAgICBjb25zdCB0aW1lU3RlcEhhbGYgPSB0aW1lU3RlcCAvIDI7XHJcblxyXG4gICAgLy8gVXBkYXRlIHRoZSB2ZWxvY2l0aWVzIGFuZCByb3RhdGlvbiByYXRlcyBiYXNlZCBvbiB0aGUgZm9yY2VzIGJlaW5nIGV4ZXJ0ZWQgb24gdGhlIG1vbGVjdWxlcywgdGhlbiBjYWxjdWxhdGVcclxuICAgIC8vIHRoZSBraW5ldGljIGVuZXJneSBvZiB0aGUgc3lzdGVtLlxyXG4gICAgbGV0IHRyYW5zbGF0aW9uYWxLaW5ldGljRW5lcmd5ID0gMDtcclxuICAgIGxldCByb3RhdGlvbmFsS2luZXRpY0VuZXJneSA9IDA7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBudW1iZXJPZk1vbGVjdWxlczsgaSsrICkge1xyXG4gICAgICBjb25zdCB4VmVsID0gbW9sZWN1bGVWZWxvY2l0aWVzWyBpIF0ueCArIHRpbWVTdGVwSGFsZiAqICggbW9sZWN1bGVGb3JjZXNbIGkgXS54ICsgbmV4dE1vbGVjdWxlRm9yY2VzWyBpIF0ueCApICogdGhpcy5tYXNzSW52ZXJzZTtcclxuICAgICAgY29uc3QgeVZlbCA9IG1vbGVjdWxlVmVsb2NpdGllc1sgaSBdLnkgKyB0aW1lU3RlcEhhbGYgKiAoIG1vbGVjdWxlRm9yY2VzWyBpIF0ueSArIG5leHRNb2xlY3VsZUZvcmNlc1sgaSBdLnkgKSAqIHRoaXMubWFzc0ludmVyc2U7XHJcbiAgICAgIG1vbGVjdWxlVmVsb2NpdGllc1sgaSBdLnNldFhZKCB4VmVsLCB5VmVsICk7XHJcbiAgICAgIGxldCByb3RhdGlvblJhdGUgPSBtb2xlY3VsZVJvdGF0aW9uUmF0ZXNbIGkgXSArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU3RlcEhhbGYgKiAoIG1vbGVjdWxlVG9ycXVlc1sgaSBdICsgbmV4dE1vbGVjdWxlVG9ycXVlc1sgaSBdICkgKiB0aGlzLmluZXJ0aWFJbnZlcnNlO1xyXG5cclxuICAgICAgLy8gSWYgbmVlZGVkLCBjbGFtcCB0aGUgcm90YXRpb24gcmF0ZSB0byBhbiBlbXBpcmljYWxseSBkZXRlcm1pbmVkIG1heCB0byBwcmV2ZW50IHJ1bmF3YXkgcm90YXRpb24sIHNlZVxyXG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc3RhdGVzLW9mLW1hdHRlci9pc3N1ZXMvMTUyXHJcbiAgICAgIGlmICggcm90YXRpb25SYXRlID4gTUFYX1JPVEFUSU9OX1JBVEUgKSB7XHJcbiAgICAgICAgcm90YXRpb25SYXRlID0gTUFYX1JPVEFUSU9OX1JBVEU7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHJvdGF0aW9uUmF0ZSA8IC1NQVhfUk9UQVRJT05fUkFURSApIHtcclxuICAgICAgICByb3RhdGlvblJhdGUgPSAtTUFYX1JPVEFUSU9OX1JBVEU7XHJcbiAgICAgIH1cclxuICAgICAgbW9sZWN1bGVSb3RhdGlvblJhdGVzWyBpIF0gPSByb3RhdGlvblJhdGU7XHJcblxyXG4gICAgICAvLyBjYWxjdWxhdGUgdGhlIGtpbmV0aWMgZW5lcmd5XHJcbiAgICAgIHRyYW5zbGF0aW9uYWxLaW5ldGljRW5lcmd5ICs9IDAuNSAqIG1vbGVjdWxlTWFzcyAqIG1vbGVjdWxlVmVsb2NpdGllc1sgaSBdLm1hZ25pdHVkZVNxdWFyZWQ7XHJcbiAgICAgIHJvdGF0aW9uYWxLaW5ldGljRW5lcmd5ICs9IDAuNSAqIG1vbGVjdWxlUm90YXRpb25hbEluZXJ0aWEgKiBtb2xlY3VsZVJvdGF0aW9uUmF0ZXNbIGkgXSAqIG1vbGVjdWxlUm90YXRpb25SYXRlc1sgaSBdO1xyXG5cclxuICAgICAgLy8gTW92ZSB0aGUgbmV3bHkgY2FsY3VsYXRlZCBmb3JjZXMgYW5kIHRvcnF1ZXMgaW50byB0aGUgY3VycmVudCBzcG90cy5cclxuICAgICAgbW9sZWN1bGVGb3JjZXNbIGkgXS5zZXRYWSggbmV4dE1vbGVjdWxlRm9yY2VzWyBpIF0ueCwgbmV4dE1vbGVjdWxlRm9yY2VzWyBpIF0ueSApO1xyXG4gICAgICBtb2xlY3VsZVRvcnF1ZXNbIGkgXSA9IG5leHRNb2xlY3VsZVRvcnF1ZXNbIGkgXTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSZWNvcmQgdGhlIGNhbGN1bGF0ZWQgdGVtcGVyYXR1cmUuXHJcbiAgICBpZiAoIG51bWJlck9mTW9sZWN1bGVzID4gMCApIHtcclxuICAgICAgdGhpcy5jYWxjdWxhdGVkVGVtcGVyYXR1cmUgPSAoIHRyYW5zbGF0aW9uYWxLaW5ldGljRW5lcmd5ICsgcm90YXRpb25hbEtpbmV0aWNFbmVyZ3kgKSAvIG51bWJlck9mTW9sZWN1bGVzO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMuY2FsY3VsYXRlZFRlbXBlcmF0dXJlID0gdGhpcy5tdWx0aXBsZVBhcnRpY2xlTW9kZWwubWluTW9kZWxUZW1wZXJhdHVyZTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbnN0YXRlc09mTWF0dGVyLnJlZ2lzdGVyKCAnV2F0ZXJWZXJsZXRBbGdvcml0aG0nLCBXYXRlclZlcmxldEFsZ29yaXRobSApO1xyXG5leHBvcnQgZGVmYXVsdCBXYXRlclZlcmxldEFsZ29yaXRobTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxjQUFjLE1BQU0sNEJBQTRCO0FBQ3ZELE9BQU9DLHVCQUF1QixNQUFNLDhCQUE4QjtBQUNsRSxPQUFPQyx3QkFBd0IsTUFBTSwrQkFBK0I7O0FBRXBFO0FBQ0EsTUFBTUMsOEJBQThCLEdBQUcsR0FBRztBQUMxQyxNQUFNQyxzQ0FBc0MsR0FBRyxHQUFHO0FBQ2xELE1BQU1DLDhCQUE4QixHQUFHLElBQUk7QUFDM0MsTUFBTUMsc0NBQXNDLEdBQUcsSUFBSTtBQUNuRCxNQUFNQyxzQ0FBc0MsR0FBRyxJQUFJO0FBQ25ELE1BQU1DLGlCQUFpQixHQUFHLEVBQUUsQ0FBQyxDQUFDO0FBQzlCLE1BQU1DLHlDQUF5QyxHQUFHLElBQUk7QUFFdEQsTUFBTUMsb0JBQW9CLFNBQVNULHVCQUF1QixDQUFDO0VBRXpEO0FBQ0Y7QUFDQTtFQUNFVSxXQUFXQSxDQUFFQyxxQkFBcUIsRUFBRztJQUVuQyxLQUFLLENBQUVBLHFCQUFzQixDQUFDO0lBQzlCLElBQUksQ0FBQ0MsZUFBZSxHQUFHWCx3QkFBd0I7O0lBRS9DO0lBQ0EsSUFBSSxDQUFDWSxXQUFXLEdBQUcsQ0FBQyxHQUFHRixxQkFBcUIsQ0FBQ0csZUFBZSxDQUFDQyxlQUFlLENBQUMsQ0FBQztJQUM5RSxJQUFJLENBQUNDLGNBQWMsR0FBRyxDQUFDLEdBQUdMLHFCQUFxQixDQUFDRyxlQUFlLENBQUNHLDRCQUE0QixDQUFDLENBQUM7O0lBRTlG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