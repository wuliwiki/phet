// Copyright 2014-2020, University of Colorado Boulder

/**
 * Implementation of the Verlet algorithm for simulating molecular interaction based on the Lennard-Jones potential -
 * monatomic (i.e. one atom per molecule) version.
 *
 * @author John Blanco
 * @author Aaron Davis
 */

import Vector2 from '../../../../../dot/js/Vector2.js';
import statesOfMatter from '../../../statesOfMatter.js';
import AbstractVerletAlgorithm from './AbstractVerletAlgorithm.js';
import MonatomicAtomPositionUpdater from './MonatomicAtomPositionUpdater.js';
class MonatomicVerletAlgorithm extends AbstractVerletAlgorithm {
  /**
   * @param {MultipleParticleModel} multipleParticleModel of the simulation
   */
  constructor(multipleParticleModel) {
    super(multipleParticleModel);

    // @private
    this.positionUpdater = MonatomicAtomPositionUpdater;
    this.epsilon = 1; // controls the strength of particle interaction
    this.velocityVector = new Vector2(0, 0); // reusable vector to save allocations
  }

  /**
   * @param {number} scaledEpsilon
   * @public
   */
  setScaledEpsilon(scaledEpsilon) {
    this.epsilon = scaledEpsilon;
  }

  /**
   * @returns {number}
   * @public
   */
  getScaledEpsilon() {
    return this.epsilon;
  }

  /**
   * @param {MoleculeForceAndMotionDataSet} moleculeDataSet
   * @override
   * @protected
   */
  initializeForces(moleculeDataSet) {
    const accelerationDueToGravity = this.multipleParticleModel.gravitationalAcceleration;
    const nextAtomForces = moleculeDataSet.nextMoleculeForces;
    for (let i = 0; i < moleculeDataSet.getNumberOfMolecules(); i++) {
      nextAtomForces[i].setXY(0, accelerationDueToGravity);
    }
  }

  /**
   * @param {MoleculeForceAndMotionDataSet} moleculeDataSet
   * @override
   * @private
   */
  updateInteractionForces(moleculeDataSet) {
    const numberOfAtoms = moleculeDataSet.numberOfMolecules;
    const atomCenterOfMassPositions = moleculeDataSet.moleculeCenterOfMassPositions;
    const nextAtomForces = moleculeDataSet.nextMoleculeForces;
    for (let i = 0; i < numberOfAtoms; i++) {
      const atomCenterOfMassPositionsIX = atomCenterOfMassPositions[i].x;
      const atomCenterOfMassPositionsIY = atomCenterOfMassPositions[i].y;
      const nextAtomForcesI = nextAtomForces[i];
      for (let j = i + 1; j < numberOfAtoms; j++) {
        let dx = atomCenterOfMassPositionsIX - atomCenterOfMassPositions[j].x;
        let dy = atomCenterOfMassPositionsIY - atomCenterOfMassPositions[j].y;
        let distanceSqrd = Math.max(dx * dx + dy * dy, AbstractVerletAlgorithm.MIN_DISTANCE_SQUARED);
        if (distanceSqrd === 0) {
          // Handle the special case where the particles are right on top of each other by assigning an arbitrary
          // spacing. In general, this only happens when injecting new particles.
          dx = 1;
          dy = 1;
          distanceSqrd = 2;
        }
        if (distanceSqrd < AbstractVerletAlgorithm.PARTICLE_INTERACTION_DISTANCE_THRESH_SQRD) {
          // This pair of particles is close enough to one another that we need to calculate their interaction forces.
          const r2inv = 1 / distanceSqrd;
          const r6inv = r2inv * r2inv * r2inv;
          const forceScalar = 48 * r2inv * r6inv * (r6inv - 0.5) * this.epsilon;
          const forceX = dx * forceScalar;
          const forceY = dy * forceScalar;
          nextAtomForcesI.addXY(forceX, forceY);
          nextAtomForces[j].subtractXY(forceX, forceY);
        }
      }
    }
  }

  /**
   * @param {MoleculeForcesAndMotionDataSet} moleculeDataSet
   * @param {number} timeStep
   * @override
   * @protected
   */
  updateVelocitiesAndRotationRates(moleculeDataSet, timeStep) {
    let atomVelocity;
    const numberOfAtoms = moleculeDataSet.numberOfAtoms;
    const atomVelocities = moleculeDataSet.moleculeVelocities;
    const atomForces = moleculeDataSet.moleculeForces;
    const nextAtomForces = moleculeDataSet.nextMoleculeForces;
    const timeStepHalf = timeStep / 2;
    let totalKineticEnergy = 0;
    let velocityVector = this.velocityVector;

    // Update the atom velocities based upon the forces that are acting on them, then calculate the kinetic energy.
    for (let i = 0; i < numberOfAtoms; i++) {
      atomVelocity = atomVelocities[i];
      const moleculeForce = atomForces[i];
      velocityVector = velocityVector.setXY(atomVelocity.x + timeStepHalf * (moleculeForce.x + nextAtomForces[i].x), atomVelocity.y + timeStepHalf * (moleculeForce.y + nextAtomForces[i].y));
      if (velocityVector.magnitude > 10) {
        velocityVector.setMagnitude(10);
      }
      atomVelocity.set(velocityVector);
      totalKineticEnergy += (atomVelocity.x * atomVelocity.x + atomVelocity.y * atomVelocity.y) / 2;

      // update to the new force value for the next model step
      moleculeForce.setXY(nextAtomForces[i].x, nextAtomForces[i].y);
    }

    // Update the temperature.
    if (numberOfAtoms > 0) {
      this.calculatedTemperature = 2 / 3 * (totalKineticEnergy / numberOfAtoms);
    } else {
      this.calculatedTemperature = this.multipleParticleModel.minModelTemperature;
    }
  }
}
statesOfMatter.register('MonatomicVerletAlgorithm', MonatomicVerletAlgorithm);
export default MonatomicVerletAlgorithm;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwic3RhdGVzT2ZNYXR0ZXIiLCJBYnN0cmFjdFZlcmxldEFsZ29yaXRobSIsIk1vbmF0b21pY0F0b21Qb3NpdGlvblVwZGF0ZXIiLCJNb25hdG9taWNWZXJsZXRBbGdvcml0aG0iLCJjb25zdHJ1Y3RvciIsIm11bHRpcGxlUGFydGljbGVNb2RlbCIsInBvc2l0aW9uVXBkYXRlciIsImVwc2lsb24iLCJ2ZWxvY2l0eVZlY3RvciIsInNldFNjYWxlZEVwc2lsb24iLCJzY2FsZWRFcHNpbG9uIiwiZ2V0U2NhbGVkRXBzaWxvbiIsImluaXRpYWxpemVGb3JjZXMiLCJtb2xlY3VsZURhdGFTZXQiLCJhY2NlbGVyYXRpb25EdWVUb0dyYXZpdHkiLCJncmF2aXRhdGlvbmFsQWNjZWxlcmF0aW9uIiwibmV4dEF0b21Gb3JjZXMiLCJuZXh0TW9sZWN1bGVGb3JjZXMiLCJpIiwiZ2V0TnVtYmVyT2ZNb2xlY3VsZXMiLCJzZXRYWSIsInVwZGF0ZUludGVyYWN0aW9uRm9yY2VzIiwibnVtYmVyT2ZBdG9tcyIsIm51bWJlck9mTW9sZWN1bGVzIiwiYXRvbUNlbnRlck9mTWFzc1Bvc2l0aW9ucyIsIm1vbGVjdWxlQ2VudGVyT2ZNYXNzUG9zaXRpb25zIiwiYXRvbUNlbnRlck9mTWFzc1Bvc2l0aW9uc0lYIiwieCIsImF0b21DZW50ZXJPZk1hc3NQb3NpdGlvbnNJWSIsInkiLCJuZXh0QXRvbUZvcmNlc0kiLCJqIiwiZHgiLCJkeSIsImRpc3RhbmNlU3FyZCIsIk1hdGgiLCJtYXgiLCJNSU5fRElTVEFOQ0VfU1FVQVJFRCIsIlBBUlRJQ0xFX0lOVEVSQUNUSU9OX0RJU1RBTkNFX1RIUkVTSF9TUVJEIiwicjJpbnYiLCJyNmludiIsImZvcmNlU2NhbGFyIiwiZm9yY2VYIiwiZm9yY2VZIiwiYWRkWFkiLCJzdWJ0cmFjdFhZIiwidXBkYXRlVmVsb2NpdGllc0FuZFJvdGF0aW9uUmF0ZXMiLCJ0aW1lU3RlcCIsImF0b21WZWxvY2l0eSIsImF0b21WZWxvY2l0aWVzIiwibW9sZWN1bGVWZWxvY2l0aWVzIiwiYXRvbUZvcmNlcyIsIm1vbGVjdWxlRm9yY2VzIiwidGltZVN0ZXBIYWxmIiwidG90YWxLaW5ldGljRW5lcmd5IiwibW9sZWN1bGVGb3JjZSIsIm1hZ25pdHVkZSIsInNldE1hZ25pdHVkZSIsInNldCIsImNhbGN1bGF0ZWRUZW1wZXJhdHVyZSIsIm1pbk1vZGVsVGVtcGVyYXR1cmUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIk1vbmF0b21pY1ZlcmxldEFsZ29yaXRobS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIwLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgVmVybGV0IGFsZ29yaXRobSBmb3Igc2ltdWxhdGluZyBtb2xlY3VsYXIgaW50ZXJhY3Rpb24gYmFzZWQgb24gdGhlIExlbm5hcmQtSm9uZXMgcG90ZW50aWFsIC1cclxuICogbW9uYXRvbWljIChpLmUuIG9uZSBhdG9tIHBlciBtb2xlY3VsZSkgdmVyc2lvbi5cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKiBAYXV0aG9yIEFhcm9uIERhdmlzXHJcbiAqL1xyXG5cclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgc3RhdGVzT2ZNYXR0ZXIgZnJvbSAnLi4vLi4vLi4vc3RhdGVzT2ZNYXR0ZXIuanMnO1xyXG5pbXBvcnQgQWJzdHJhY3RWZXJsZXRBbGdvcml0aG0gZnJvbSAnLi9BYnN0cmFjdFZlcmxldEFsZ29yaXRobS5qcyc7XHJcbmltcG9ydCBNb25hdG9taWNBdG9tUG9zaXRpb25VcGRhdGVyIGZyb20gJy4vTW9uYXRvbWljQXRvbVBvc2l0aW9uVXBkYXRlci5qcyc7XHJcblxyXG5jbGFzcyBNb25hdG9taWNWZXJsZXRBbGdvcml0aG0gZXh0ZW5kcyBBYnN0cmFjdFZlcmxldEFsZ29yaXRobSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7TXVsdGlwbGVQYXJ0aWNsZU1vZGVsfSBtdWx0aXBsZVBhcnRpY2xlTW9kZWwgb2YgdGhlIHNpbXVsYXRpb25cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbXVsdGlwbGVQYXJ0aWNsZU1vZGVsICkge1xyXG4gICAgc3VwZXIoIG11bHRpcGxlUGFydGljbGVNb2RlbCApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlXHJcbiAgICB0aGlzLnBvc2l0aW9uVXBkYXRlciA9IE1vbmF0b21pY0F0b21Qb3NpdGlvblVwZGF0ZXI7XHJcbiAgICB0aGlzLmVwc2lsb24gPSAxOyAvLyBjb250cm9scyB0aGUgc3RyZW5ndGggb2YgcGFydGljbGUgaW50ZXJhY3Rpb25cclxuICAgIHRoaXMudmVsb2NpdHlWZWN0b3IgPSBuZXcgVmVjdG9yMiggMCwgMCApOyAvLyByZXVzYWJsZSB2ZWN0b3IgdG8gc2F2ZSBhbGxvY2F0aW9uc1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHNjYWxlZEVwc2lsb25cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc2V0U2NhbGVkRXBzaWxvbiggc2NhbGVkRXBzaWxvbiApIHtcclxuICAgIHRoaXMuZXBzaWxvbiA9IHNjYWxlZEVwc2lsb247XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBnZXRTY2FsZWRFcHNpbG9uKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZXBzaWxvbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7TW9sZWN1bGVGb3JjZUFuZE1vdGlvbkRhdGFTZXR9IG1vbGVjdWxlRGF0YVNldFxyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqIEBwcm90ZWN0ZWRcclxuICAgKi9cclxuICBpbml0aWFsaXplRm9yY2VzKCBtb2xlY3VsZURhdGFTZXQgKSB7XHJcbiAgICBjb25zdCBhY2NlbGVyYXRpb25EdWVUb0dyYXZpdHkgPSB0aGlzLm11bHRpcGxlUGFydGljbGVNb2RlbC5ncmF2aXRhdGlvbmFsQWNjZWxlcmF0aW9uO1xyXG4gICAgY29uc3QgbmV4dEF0b21Gb3JjZXMgPSBtb2xlY3VsZURhdGFTZXQubmV4dE1vbGVjdWxlRm9yY2VzO1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgbW9sZWN1bGVEYXRhU2V0LmdldE51bWJlck9mTW9sZWN1bGVzKCk7IGkrKyApIHtcclxuICAgICAgbmV4dEF0b21Gb3JjZXNbIGkgXS5zZXRYWSggMCwgYWNjZWxlcmF0aW9uRHVlVG9HcmF2aXR5ICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge01vbGVjdWxlRm9yY2VBbmRNb3Rpb25EYXRhU2V0fSBtb2xlY3VsZURhdGFTZXRcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIHVwZGF0ZUludGVyYWN0aW9uRm9yY2VzKCBtb2xlY3VsZURhdGFTZXQgKSB7XHJcblxyXG4gICAgY29uc3QgbnVtYmVyT2ZBdG9tcyA9IG1vbGVjdWxlRGF0YVNldC5udW1iZXJPZk1vbGVjdWxlcztcclxuICAgIGNvbnN0IGF0b21DZW50ZXJPZk1hc3NQb3NpdGlvbnMgPSBtb2xlY3VsZURhdGFTZXQubW9sZWN1bGVDZW50ZXJPZk1hc3NQb3NpdGlvbnM7XHJcbiAgICBjb25zdCBuZXh0QXRvbUZvcmNlcyA9IG1vbGVjdWxlRGF0YVNldC5uZXh0TW9sZWN1bGVGb3JjZXM7XHJcblxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZBdG9tczsgaSsrICkge1xyXG5cclxuICAgICAgY29uc3QgYXRvbUNlbnRlck9mTWFzc1Bvc2l0aW9uc0lYID0gYXRvbUNlbnRlck9mTWFzc1Bvc2l0aW9uc1sgaSBdLng7XHJcbiAgICAgIGNvbnN0IGF0b21DZW50ZXJPZk1hc3NQb3NpdGlvbnNJWSA9IGF0b21DZW50ZXJPZk1hc3NQb3NpdGlvbnNbIGkgXS55O1xyXG4gICAgICBjb25zdCBuZXh0QXRvbUZvcmNlc0kgPSBuZXh0QXRvbUZvcmNlc1sgaSBdO1xyXG5cclxuICAgICAgZm9yICggbGV0IGogPSBpICsgMTsgaiA8IG51bWJlck9mQXRvbXM7IGorKyApIHtcclxuXHJcbiAgICAgICAgbGV0IGR4ID0gYXRvbUNlbnRlck9mTWFzc1Bvc2l0aW9uc0lYIC0gYXRvbUNlbnRlck9mTWFzc1Bvc2l0aW9uc1sgaiBdLng7XHJcbiAgICAgICAgbGV0IGR5ID0gYXRvbUNlbnRlck9mTWFzc1Bvc2l0aW9uc0lZIC0gYXRvbUNlbnRlck9mTWFzc1Bvc2l0aW9uc1sgaiBdLnk7XHJcbiAgICAgICAgbGV0IGRpc3RhbmNlU3FyZCA9IE1hdGgubWF4KCBkeCAqIGR4ICsgZHkgKiBkeSwgQWJzdHJhY3RWZXJsZXRBbGdvcml0aG0uTUlOX0RJU1RBTkNFX1NRVUFSRUQgKTtcclxuXHJcbiAgICAgICAgaWYgKCBkaXN0YW5jZVNxcmQgPT09IDAgKSB7XHJcbiAgICAgICAgICAvLyBIYW5kbGUgdGhlIHNwZWNpYWwgY2FzZSB3aGVyZSB0aGUgcGFydGljbGVzIGFyZSByaWdodCBvbiB0b3Agb2YgZWFjaCBvdGhlciBieSBhc3NpZ25pbmcgYW4gYXJiaXRyYXJ5XHJcbiAgICAgICAgICAvLyBzcGFjaW5nLiBJbiBnZW5lcmFsLCB0aGlzIG9ubHkgaGFwcGVucyB3aGVuIGluamVjdGluZyBuZXcgcGFydGljbGVzLlxyXG4gICAgICAgICAgZHggPSAxO1xyXG4gICAgICAgICAgZHkgPSAxO1xyXG4gICAgICAgICAgZGlzdGFuY2VTcXJkID0gMjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICggZGlzdGFuY2VTcXJkIDwgQWJzdHJhY3RWZXJsZXRBbGdvcml0aG0uUEFSVElDTEVfSU5URVJBQ1RJT05fRElTVEFOQ0VfVEhSRVNIX1NRUkQgKSB7XHJcbiAgICAgICAgICAvLyBUaGlzIHBhaXIgb2YgcGFydGljbGVzIGlzIGNsb3NlIGVub3VnaCB0byBvbmUgYW5vdGhlciB0aGF0IHdlIG5lZWQgdG8gY2FsY3VsYXRlIHRoZWlyIGludGVyYWN0aW9uIGZvcmNlcy5cclxuICAgICAgICAgIGNvbnN0IHIyaW52ID0gMSAvIGRpc3RhbmNlU3FyZDtcclxuICAgICAgICAgIGNvbnN0IHI2aW52ID0gcjJpbnYgKiByMmludiAqIHIyaW52O1xyXG4gICAgICAgICAgY29uc3QgZm9yY2VTY2FsYXIgPSA0OCAqIHIyaW52ICogcjZpbnYgKiAoIHI2aW52IC0gMC41ICkgKiB0aGlzLmVwc2lsb247XHJcbiAgICAgICAgICBjb25zdCBmb3JjZVggPSBkeCAqIGZvcmNlU2NhbGFyO1xyXG4gICAgICAgICAgY29uc3QgZm9yY2VZID0gZHkgKiBmb3JjZVNjYWxhcjtcclxuICAgICAgICAgIG5leHRBdG9tRm9yY2VzSS5hZGRYWSggZm9yY2VYLCBmb3JjZVkgKTtcclxuICAgICAgICAgIG5leHRBdG9tRm9yY2VzWyBqIF0uc3VidHJhY3RYWSggZm9yY2VYLCBmb3JjZVkgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7TW9sZWN1bGVGb3JjZXNBbmRNb3Rpb25EYXRhU2V0fSBtb2xlY3VsZURhdGFTZXRcclxuICAgKiBAcGFyYW0ge251bWJlcn0gdGltZVN0ZXBcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBAcHJvdGVjdGVkXHJcbiAgICovXHJcbiAgdXBkYXRlVmVsb2NpdGllc0FuZFJvdGF0aW9uUmF0ZXMoIG1vbGVjdWxlRGF0YVNldCwgdGltZVN0ZXAgKSB7XHJcblxyXG4gICAgbGV0IGF0b21WZWxvY2l0eTtcclxuICAgIGNvbnN0IG51bWJlck9mQXRvbXMgPSBtb2xlY3VsZURhdGFTZXQubnVtYmVyT2ZBdG9tcztcclxuICAgIGNvbnN0IGF0b21WZWxvY2l0aWVzID0gbW9sZWN1bGVEYXRhU2V0Lm1vbGVjdWxlVmVsb2NpdGllcztcclxuICAgIGNvbnN0IGF0b21Gb3JjZXMgPSBtb2xlY3VsZURhdGFTZXQubW9sZWN1bGVGb3JjZXM7XHJcbiAgICBjb25zdCBuZXh0QXRvbUZvcmNlcyA9IG1vbGVjdWxlRGF0YVNldC5uZXh0TW9sZWN1bGVGb3JjZXM7XHJcbiAgICBjb25zdCB0aW1lU3RlcEhhbGYgPSB0aW1lU3RlcCAvIDI7XHJcbiAgICBsZXQgdG90YWxLaW5ldGljRW5lcmd5ID0gMDtcclxuICAgIGxldCB2ZWxvY2l0eVZlY3RvciA9IHRoaXMudmVsb2NpdHlWZWN0b3I7XHJcblxyXG4gICAgLy8gVXBkYXRlIHRoZSBhdG9tIHZlbG9jaXRpZXMgYmFzZWQgdXBvbiB0aGUgZm9yY2VzIHRoYXQgYXJlIGFjdGluZyBvbiB0aGVtLCB0aGVuIGNhbGN1bGF0ZSB0aGUga2luZXRpYyBlbmVyZ3kuXHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBudW1iZXJPZkF0b21zOyBpKysgKSB7XHJcbiAgICAgIGF0b21WZWxvY2l0eSA9IGF0b21WZWxvY2l0aWVzWyBpIF07XHJcbiAgICAgIGNvbnN0IG1vbGVjdWxlRm9yY2UgPSBhdG9tRm9yY2VzWyBpIF07XHJcbiAgICAgIHZlbG9jaXR5VmVjdG9yID0gdmVsb2NpdHlWZWN0b3Iuc2V0WFkoXHJcbiAgICAgICAgYXRvbVZlbG9jaXR5LnggKyB0aW1lU3RlcEhhbGYgKiAoIG1vbGVjdWxlRm9yY2UueCArIG5leHRBdG9tRm9yY2VzWyBpIF0ueCApLFxyXG4gICAgICAgIGF0b21WZWxvY2l0eS55ICsgdGltZVN0ZXBIYWxmICogKCBtb2xlY3VsZUZvcmNlLnkgKyBuZXh0QXRvbUZvcmNlc1sgaSBdLnkgKVxyXG4gICAgICApO1xyXG4gICAgICBpZiAoIHZlbG9jaXR5VmVjdG9yLm1hZ25pdHVkZSA+IDEwICkge1xyXG4gICAgICAgIHZlbG9jaXR5VmVjdG9yLnNldE1hZ25pdHVkZSggMTAgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYXRvbVZlbG9jaXR5LnNldCggdmVsb2NpdHlWZWN0b3IgKTtcclxuICAgICAgdG90YWxLaW5ldGljRW5lcmd5ICs9ICggKCBhdG9tVmVsb2NpdHkueCAqIGF0b21WZWxvY2l0eS54ICkgKyAoIGF0b21WZWxvY2l0eS55ICogYXRvbVZlbG9jaXR5LnkgKSApIC8gMjtcclxuXHJcbiAgICAgIC8vIHVwZGF0ZSB0byB0aGUgbmV3IGZvcmNlIHZhbHVlIGZvciB0aGUgbmV4dCBtb2RlbCBzdGVwXHJcbiAgICAgIG1vbGVjdWxlRm9yY2Uuc2V0WFkoIG5leHRBdG9tRm9yY2VzWyBpIF0ueCwgbmV4dEF0b21Gb3JjZXNbIGkgXS55ICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXBkYXRlIHRoZSB0ZW1wZXJhdHVyZS5cclxuICAgIGlmICggbnVtYmVyT2ZBdG9tcyA+IDAgKSB7XHJcbiAgICAgIHRoaXMuY2FsY3VsYXRlZFRlbXBlcmF0dXJlID0gKCAyIC8gMyApICogKCB0b3RhbEtpbmV0aWNFbmVyZ3kgLyBudW1iZXJPZkF0b21zICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5jYWxjdWxhdGVkVGVtcGVyYXR1cmUgPSB0aGlzLm11bHRpcGxlUGFydGljbGVNb2RlbC5taW5Nb2RlbFRlbXBlcmF0dXJlO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuc3RhdGVzT2ZNYXR0ZXIucmVnaXN0ZXIoICdNb25hdG9taWNWZXJsZXRBbGdvcml0aG0nLCBNb25hdG9taWNWZXJsZXRBbGdvcml0aG0gKTtcclxuZXhwb3J0IGRlZmF1bHQgTW9uYXRvbWljVmVybGV0QWxnb3JpdGhtOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsT0FBTyxNQUFNLGtDQUFrQztBQUN0RCxPQUFPQyxjQUFjLE1BQU0sNEJBQTRCO0FBQ3ZELE9BQU9DLHVCQUF1QixNQUFNLDhCQUE4QjtBQUNsRSxPQUFPQyw0QkFBNEIsTUFBTSxtQ0FBbUM7QUFFNUUsTUFBTUMsd0JBQXdCLFNBQVNGLHVCQUF1QixDQUFDO0VB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