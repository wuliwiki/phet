// Copyright 2014-2022, University of Colorado Boulder

/**
 * This class represents a node that looks like a hand with an extended finger, and is generally used to push down on
 * things.
 *
 * @author Siddhartha Chinthapally (Actual Concepts)
 * @author John Blanco
 */

import merge from '../../../../phet-core/js/merge.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import { DragListener, Image, Node } from '../../../../scenery/js/imports.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import pointingHand_png from '../../../mipmaps/pointingHand_png.js';
import statesOfMatter from '../../statesOfMatter.js';
import MultipleParticleModel from '../model/MultipleParticleModel.js';

// constants
const WIDTH = 150; // in screen coords

class PointingHandNode extends Node {
  /**
   * @param {PhaseChangesModel} phaseChangesModel - model of the simulation
   * @param {ModelViewTransform2} modelViewTransform to convert between model and view co-ordinate frames
   * @param {Object} [options]
   */
  constructor(phaseChangesModel, modelViewTransform, options) {
    options = merge({
      tandem: Tandem.REQUIRED
    }, options);
    super();

    // Add the up arrow.
    const upArrowNode = new ArrowNode(0, 0, 0, 25, {
      headHeight: 10,
      headWidth: 10,
      tailWidth: 6,
      fill: '#33FF00',
      stroke: '#33FF00',
      pickable: true,
      rotation: 2 * Math.PI / 2
    });

    // Add the down arrow.
    const downArrowNode = new ArrowNode(0, 0, 0, 25, {
      headHeight: 10,
      headWidth: 10,
      tailWidth: 6,
      fill: '#33FF00',
      stroke: '#33FF00',
      pickable: true,
      top: upArrowNode.bottom + 5
    });

    // Load and scale the image.  Scale was empirically determined.
    const pointingHandImageNode = new Image(pointingHand_png, {
      cursor: 'ns-resize',
      pickable: true
    });
    pointingHandImageNode.scale(WIDTH / pointingHandImageNode.width);
    const hintNode = new Node({
      children: [upArrowNode, downArrowNode],
      visible: false,
      top: pointingHandImageNode.bottom - 50,
      // adjusted a bit for better look
      left: pointingHandImageNode.right - 20 // adjusted a bit for better look
    });

    let mouseOver = false;
    let beingDragged = false;
    const updateHintVisibility = () => {
      hintNode.setVisible(mouseOver || beingDragged);
    };

    // Set ourself up to listen for and handle mouse dragging events.
    let startY;
    let endY;
    let containerSizeAtDragStart;

    // add a listener to handle drag events
    pointingHandImageNode.addInputListener(new DragListener({
      allowTouchSnag: true,
      start: event => {
        startY = this.globalToParentPoint(event.pointer.point).y;
        beingDragged = true;
        containerSizeAtDragStart = phaseChangesModel.containerHeightProperty.get();
        updateHintVisibility();
      },
      drag: event => {
        endY = this.globalToParentPoint(event.pointer.point).y;

        // Resize the container based on the amount that the node has moved.
        phaseChangesModel.setTargetContainerHeight(containerSizeAtDragStart + modelViewTransform.viewToModelDeltaY(endY - startY));
        updateHintVisibility();
      },
      end: () => {
        // Set the target size to the current size, which will stop any change in size that is currently underway.
        if (!phaseChangesModel.isExplodedProperty.value) {
          phaseChangesModel.setTargetContainerHeight(phaseChangesModel.containerHeightProperty.get());
        }
        beingDragged = false;
        updateHintVisibility();
      },
      tandem: options.tandem.createTandem('dragListener')
    }));

    // The particle container can explode while this is being dragged and, if that happens, cancel the interaction.
    phaseChangesModel.isExplodedProperty.lazyLink(isExploded => {
      if (isExploded) {
        this.interruptSubtreeInput();
      }
    });

    // add the listener that will show and hide the hint
    this.addInputListener({
      enter: () => {
        mouseOver = true;
        updateHintVisibility();
      },
      exit: () => {
        mouseOver = false;
        updateHintVisibility();
      }
    });

    // Add the child nodes.
    this.addChild(pointingHandImageNode);
    this.addChild(hintNode);

    // Expand the touch area (only on the image, since that's where the drag handler will be).
    pointingHandImageNode.touchArea = pointingHandImageNode.localBounds.dilatedXY(10, 10);

    // Add a listener to update the individual arrow visibility.
    phaseChangesModel.containerHeightProperty.link(particleContainerHeight => {
      if (particleContainerHeight === MultipleParticleModel.PARTICLE_CONTAINER_INITIAL_HEIGHT) {
        // At the height limit, so only show the down arrow.
        upArrowNode.setVisible(false);
        downArrowNode.setVisible(true);
      } else if (particleContainerHeight === MultipleParticleModel.PARTICLE_CONTAINER_MIN_HEIGHT) {
        // Particle container all the way down, so show only the up arrow.
        upArrowNode.setVisible(true);
        downArrowNode.setVisible(false);
      } else {
        upArrowNode.setVisible(true);
        downArrowNode.setVisible(true);
      }
    });

    // Set a value that will be used to position the fingertip.
    this.fingertipToBottomDistanceY = hintNode.bottom - pointingHandImageNode.bottom;
    this.mutate(options);
  }

  /**
   * Set the position of this node such that the tip of the finger is at the provided Y position.  The x position
   * remains unchanged.
   * @param {number} fingertipYPos
   * @public
   */
  setFingertipYPosition(fingertipYPos) {
    this.bottom = fingertipYPos + this.fingertipToBottomDistanceY;
  }
}
statesOfMatter.register('PointingHandNode', PointingHandNode);
export default PointingHandNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtZXJnZSIsIkFycm93Tm9kZSIsIkRyYWdMaXN0ZW5lciIsIkltYWdlIiwiTm9kZSIsIlRhbmRlbSIsInBvaW50aW5nSGFuZF9wbmciLCJzdGF0ZXNPZk1hdHRlciIsIk11bHRpcGxlUGFydGljbGVNb2RlbCIsIldJRFRIIiwiUG9pbnRpbmdIYW5kTm9kZSIsImNvbnN0cnVjdG9yIiwicGhhc2VDaGFuZ2VzTW9kZWwiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJvcHRpb25zIiwidGFuZGVtIiwiUkVRVUlSRUQiLCJ1cEFycm93Tm9kZSIsImhlYWRIZWlnaHQiLCJoZWFkV2lkdGgiLCJ0YWlsV2lkdGgiLCJmaWxsIiwic3Ryb2tlIiwicGlja2FibGUiLCJyb3RhdGlvbiIsIk1hdGgiLCJQSSIsImRvd25BcnJvd05vZGUiLCJ0b3AiLCJib3R0b20iLCJwb2ludGluZ0hhbmRJbWFnZU5vZGUiLCJjdXJzb3IiLCJzY2FsZSIsIndpZHRoIiwiaGludE5vZGUiLCJjaGlsZHJlbiIsInZpc2libGUiLCJsZWZ0IiwicmlnaHQiLCJtb3VzZU92ZXIiLCJiZWluZ0RyYWdnZWQiLCJ1cGRhdGVIaW50VmlzaWJpbGl0eSIsInNldFZpc2libGUiLCJzdGFydFkiLCJlbmRZIiwiY29udGFpbmVyU2l6ZUF0RHJhZ1N0YXJ0IiwiYWRkSW5wdXRMaXN0ZW5lciIsImFsbG93VG91Y2hTbmFnIiwic3RhcnQiLCJldmVudCIsImdsb2JhbFRvUGFyZW50UG9pbnQiLCJwb2ludGVyIiwicG9pbnQiLCJ5IiwiY29udGFpbmVySGVpZ2h0UHJvcGVydHkiLCJnZXQiLCJkcmFnIiwic2V0VGFyZ2V0Q29udGFpbmVySGVpZ2h0Iiwidmlld1RvTW9kZWxEZWx0YVkiLCJlbmQiLCJpc0V4cGxvZGVkUHJvcGVydHkiLCJ2YWx1ZSIsImNyZWF0ZVRhbmRlbSIsImxhenlMaW5rIiwiaXNFeHBsb2RlZCIsImludGVycnVwdFN1YnRyZWVJbnB1dCIsImVudGVyIiwiZXhpdCIsImFkZENoaWxkIiwidG91Y2hBcmVhIiwibG9jYWxCb3VuZHMiLCJkaWxhdGVkWFkiLCJsaW5rIiwicGFydGljbGVDb250YWluZXJIZWlnaHQiLCJQQVJUSUNMRV9DT05UQUlORVJfSU5JVElBTF9IRUlHSFQiLCJQQVJUSUNMRV9DT05UQUlORVJfTUlOX0hFSUdIVCIsImZpbmdlcnRpcFRvQm90dG9tRGlzdGFuY2VZIiwibXV0YXRlIiwic2V0RmluZ2VydGlwWVBvc2l0aW9uIiwiZmluZ2VydGlwWVBvcyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUG9pbnRpbmdIYW5kTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBUaGlzIGNsYXNzIHJlcHJlc2VudHMgYSBub2RlIHRoYXQgbG9va3MgbGlrZSBhIGhhbmQgd2l0aCBhbiBleHRlbmRlZCBmaW5nZXIsIGFuZCBpcyBnZW5lcmFsbHkgdXNlZCB0byBwdXNoIGRvd24gb25cclxuICogdGhpbmdzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNpZGRoYXJ0aGEgQ2hpbnRoYXBhbGx5IChBY3R1YWwgQ29uY2VwdHMpXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICovXHJcblxyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IEFycm93Tm9kZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvQXJyb3dOb2RlLmpzJztcclxuaW1wb3J0IHsgRHJhZ0xpc3RlbmVyLCBJbWFnZSwgTm9kZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBwb2ludGluZ0hhbmRfcG5nIGZyb20gJy4uLy4uLy4uL21pcG1hcHMvcG9pbnRpbmdIYW5kX3BuZy5qcyc7XHJcbmltcG9ydCBzdGF0ZXNPZk1hdHRlciBmcm9tICcuLi8uLi9zdGF0ZXNPZk1hdHRlci5qcyc7XHJcbmltcG9ydCBNdWx0aXBsZVBhcnRpY2xlTW9kZWwgZnJvbSAnLi4vbW9kZWwvTXVsdGlwbGVQYXJ0aWNsZU1vZGVsLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBXSURUSCA9IDE1MDsgLy8gaW4gc2NyZWVuIGNvb3Jkc1xyXG5cclxuY2xhc3MgUG9pbnRpbmdIYW5kTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1BoYXNlQ2hhbmdlc01vZGVsfSBwaGFzZUNoYW5nZXNNb2RlbCAtIG1vZGVsIG9mIHRoZSBzaW11bGF0aW9uXHJcbiAgICogQHBhcmFtIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfSBtb2RlbFZpZXdUcmFuc2Zvcm0gdG8gY29udmVydCBiZXR3ZWVuIG1vZGVsIGFuZCB2aWV3IGNvLW9yZGluYXRlIGZyYW1lc1xyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggcGhhc2VDaGFuZ2VzTW9kZWwsIG1vZGVsVmlld1RyYW5zZm9ybSwgb3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRURcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgdXAgYXJyb3cuXHJcbiAgICBjb25zdCB1cEFycm93Tm9kZSA9IG5ldyBBcnJvd05vZGUoIDAsIDAsIDAsIDI1LCB7XHJcbiAgICAgIGhlYWRIZWlnaHQ6IDEwLFxyXG4gICAgICBoZWFkV2lkdGg6IDEwLFxyXG4gICAgICB0YWlsV2lkdGg6IDYsXHJcbiAgICAgIGZpbGw6ICcjMzNGRjAwJyxcclxuICAgICAgc3Ryb2tlOiAnIzMzRkYwMCcsXHJcbiAgICAgIHBpY2thYmxlOiB0cnVlLFxyXG4gICAgICByb3RhdGlvbjogMiAqIE1hdGguUEkgLyAyXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBkb3duIGFycm93LlxyXG4gICAgY29uc3QgZG93bkFycm93Tm9kZSA9IG5ldyBBcnJvd05vZGUoIDAsIDAsIDAsIDI1LCB7XHJcbiAgICAgIGhlYWRIZWlnaHQ6IDEwLFxyXG4gICAgICBoZWFkV2lkdGg6IDEwLFxyXG4gICAgICB0YWlsV2lkdGg6IDYsXHJcbiAgICAgIGZpbGw6ICcjMzNGRjAwJyxcclxuICAgICAgc3Ryb2tlOiAnIzMzRkYwMCcsXHJcbiAgICAgIHBpY2thYmxlOiB0cnVlLFxyXG4gICAgICB0b3A6IHVwQXJyb3dOb2RlLmJvdHRvbSArIDVcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBMb2FkIGFuZCBzY2FsZSB0aGUgaW1hZ2UuICBTY2FsZSB3YXMgZW1waXJpY2FsbHkgZGV0ZXJtaW5lZC5cclxuICAgIGNvbnN0IHBvaW50aW5nSGFuZEltYWdlTm9kZSA9IG5ldyBJbWFnZSggcG9pbnRpbmdIYW5kX3BuZywge1xyXG4gICAgICBjdXJzb3I6ICducy1yZXNpemUnLFxyXG4gICAgICBwaWNrYWJsZTogdHJ1ZVxyXG4gICAgfSApO1xyXG4gICAgcG9pbnRpbmdIYW5kSW1hZ2VOb2RlLnNjYWxlKCBXSURUSCAvIHBvaW50aW5nSGFuZEltYWdlTm9kZS53aWR0aCApO1xyXG5cclxuICAgIGNvbnN0IGhpbnROb2RlID0gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFsgdXBBcnJvd05vZGUsIGRvd25BcnJvd05vZGUgXSxcclxuICAgICAgdmlzaWJsZTogZmFsc2UsXHJcbiAgICAgIHRvcDogcG9pbnRpbmdIYW5kSW1hZ2VOb2RlLmJvdHRvbSAtIDUwLCAvLyBhZGp1c3RlZCBhIGJpdCBmb3IgYmV0dGVyIGxvb2tcclxuICAgICAgbGVmdDogcG9pbnRpbmdIYW5kSW1hZ2VOb2RlLnJpZ2h0IC0gMjAgLy8gYWRqdXN0ZWQgYSBiaXQgZm9yIGJldHRlciBsb29rXHJcbiAgICB9ICk7XHJcblxyXG4gICAgbGV0IG1vdXNlT3ZlciA9IGZhbHNlO1xyXG4gICAgbGV0IGJlaW5nRHJhZ2dlZCA9IGZhbHNlO1xyXG5cclxuICAgIGNvbnN0IHVwZGF0ZUhpbnRWaXNpYmlsaXR5ID0gKCkgPT4ge1xyXG4gICAgICBoaW50Tm9kZS5zZXRWaXNpYmxlKCBtb3VzZU92ZXIgfHwgYmVpbmdEcmFnZ2VkICk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIFNldCBvdXJzZWxmIHVwIHRvIGxpc3RlbiBmb3IgYW5kIGhhbmRsZSBtb3VzZSBkcmFnZ2luZyBldmVudHMuXHJcbiAgICBsZXQgc3RhcnRZO1xyXG4gICAgbGV0IGVuZFk7XHJcbiAgICBsZXQgY29udGFpbmVyU2l6ZUF0RHJhZ1N0YXJ0O1xyXG5cclxuICAgIC8vIGFkZCBhIGxpc3RlbmVyIHRvIGhhbmRsZSBkcmFnIGV2ZW50c1xyXG4gICAgcG9pbnRpbmdIYW5kSW1hZ2VOb2RlLmFkZElucHV0TGlzdGVuZXIoIG5ldyBEcmFnTGlzdGVuZXIoIHtcclxuXHJcbiAgICAgIGFsbG93VG91Y2hTbmFnOiB0cnVlLFxyXG5cclxuICAgICAgc3RhcnQ6IGV2ZW50ID0+IHtcclxuICAgICAgICBzdGFydFkgPSB0aGlzLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKS55O1xyXG4gICAgICAgIGJlaW5nRHJhZ2dlZCA9IHRydWU7XHJcbiAgICAgICAgY29udGFpbmVyU2l6ZUF0RHJhZ1N0YXJ0ID0gcGhhc2VDaGFuZ2VzTW9kZWwuY29udGFpbmVySGVpZ2h0UHJvcGVydHkuZ2V0KCk7XHJcbiAgICAgICAgdXBkYXRlSGludFZpc2liaWxpdHkoKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGRyYWc6IGV2ZW50ID0+IHtcclxuICAgICAgICBlbmRZID0gdGhpcy5nbG9iYWxUb1BhcmVudFBvaW50KCBldmVudC5wb2ludGVyLnBvaW50ICkueTtcclxuXHJcbiAgICAgICAgLy8gUmVzaXplIHRoZSBjb250YWluZXIgYmFzZWQgb24gdGhlIGFtb3VudCB0aGF0IHRoZSBub2RlIGhhcyBtb3ZlZC5cclxuICAgICAgICBwaGFzZUNoYW5nZXNNb2RlbC5zZXRUYXJnZXRDb250YWluZXJIZWlnaHQoXHJcbiAgICAgICAgICBjb250YWluZXJTaXplQXREcmFnU3RhcnQgKyBtb2RlbFZpZXdUcmFuc2Zvcm0udmlld1RvTW9kZWxEZWx0YVkoIGVuZFkgLSBzdGFydFkgKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdXBkYXRlSGludFZpc2liaWxpdHkoKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGVuZDogKCkgPT4ge1xyXG5cclxuICAgICAgICAvLyBTZXQgdGhlIHRhcmdldCBzaXplIHRvIHRoZSBjdXJyZW50IHNpemUsIHdoaWNoIHdpbGwgc3RvcCBhbnkgY2hhbmdlIGluIHNpemUgdGhhdCBpcyBjdXJyZW50bHkgdW5kZXJ3YXkuXHJcbiAgICAgICAgaWYgKCAhcGhhc2VDaGFuZ2VzTW9kZWwuaXNFeHBsb2RlZFByb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICAgICAgcGhhc2VDaGFuZ2VzTW9kZWwuc2V0VGFyZ2V0Q29udGFpbmVySGVpZ2h0KCBwaGFzZUNoYW5nZXNNb2RlbC5jb250YWluZXJIZWlnaHRQcm9wZXJ0eS5nZXQoKSApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBiZWluZ0RyYWdnZWQgPSBmYWxzZTtcclxuICAgICAgICB1cGRhdGVIaW50VmlzaWJpbGl0eSgpO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdkcmFnTGlzdGVuZXInIClcclxuICAgIH0gKSApO1xyXG5cclxuICAgIC8vIFRoZSBwYXJ0aWNsZSBjb250YWluZXIgY2FuIGV4cGxvZGUgd2hpbGUgdGhpcyBpcyBiZWluZyBkcmFnZ2VkIGFuZCwgaWYgdGhhdCBoYXBwZW5zLCBjYW5jZWwgdGhlIGludGVyYWN0aW9uLlxyXG4gICAgcGhhc2VDaGFuZ2VzTW9kZWwuaXNFeHBsb2RlZFByb3BlcnR5LmxhenlMaW5rKCBpc0V4cGxvZGVkID0+IHtcclxuICAgICAgaWYgKCBpc0V4cGxvZGVkICkge1xyXG4gICAgICAgIHRoaXMuaW50ZXJydXB0U3VidHJlZUlucHV0KCk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBhZGQgdGhlIGxpc3RlbmVyIHRoYXQgd2lsbCBzaG93IGFuZCBoaWRlIHRoZSBoaW50XHJcbiAgICB0aGlzLmFkZElucHV0TGlzdGVuZXIoIHtcclxuICAgICAgZW50ZXI6ICgpID0+IHtcclxuICAgICAgICBtb3VzZU92ZXIgPSB0cnVlO1xyXG4gICAgICAgIHVwZGF0ZUhpbnRWaXNpYmlsaXR5KCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGV4aXQ6ICgpID0+IHtcclxuICAgICAgICBtb3VzZU92ZXIgPSBmYWxzZTtcclxuICAgICAgICB1cGRhdGVIaW50VmlzaWJpbGl0eSgpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBjaGlsZCBub2Rlcy5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIHBvaW50aW5nSGFuZEltYWdlTm9kZSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggaGludE5vZGUgKTtcclxuXHJcbiAgICAvLyBFeHBhbmQgdGhlIHRvdWNoIGFyZWEgKG9ubHkgb24gdGhlIGltYWdlLCBzaW5jZSB0aGF0J3Mgd2hlcmUgdGhlIGRyYWcgaGFuZGxlciB3aWxsIGJlKS5cclxuICAgIHBvaW50aW5nSGFuZEltYWdlTm9kZS50b3VjaEFyZWEgPSBwb2ludGluZ0hhbmRJbWFnZU5vZGUubG9jYWxCb3VuZHMuZGlsYXRlZFhZKCAxMCwgMTAgKTtcclxuXHJcbiAgICAvLyBBZGQgYSBsaXN0ZW5lciB0byB1cGRhdGUgdGhlIGluZGl2aWR1YWwgYXJyb3cgdmlzaWJpbGl0eS5cclxuICAgIHBoYXNlQ2hhbmdlc01vZGVsLmNvbnRhaW5lckhlaWdodFByb3BlcnR5LmxpbmsoIHBhcnRpY2xlQ29udGFpbmVySGVpZ2h0ID0+IHtcclxuICAgICAgaWYgKCBwYXJ0aWNsZUNvbnRhaW5lckhlaWdodCA9PT0gTXVsdGlwbGVQYXJ0aWNsZU1vZGVsLlBBUlRJQ0xFX0NPTlRBSU5FUl9JTklUSUFMX0hFSUdIVCApIHtcclxuXHJcbiAgICAgICAgLy8gQXQgdGhlIGhlaWdodCBsaW1pdCwgc28gb25seSBzaG93IHRoZSBkb3duIGFycm93LlxyXG4gICAgICAgIHVwQXJyb3dOb2RlLnNldFZpc2libGUoIGZhbHNlICk7XHJcbiAgICAgICAgZG93bkFycm93Tm9kZS5zZXRWaXNpYmxlKCB0cnVlICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHBhcnRpY2xlQ29udGFpbmVySGVpZ2h0ID09PSBNdWx0aXBsZVBhcnRpY2xlTW9kZWwuUEFSVElDTEVfQ09OVEFJTkVSX01JTl9IRUlHSFQgKSB7XHJcblxyXG4gICAgICAgIC8vIFBhcnRpY2xlIGNvbnRhaW5lciBhbGwgdGhlIHdheSBkb3duLCBzbyBzaG93IG9ubHkgdGhlIHVwIGFycm93LlxyXG4gICAgICAgIHVwQXJyb3dOb2RlLnNldFZpc2libGUoIHRydWUgKTtcclxuICAgICAgICBkb3duQXJyb3dOb2RlLnNldFZpc2libGUoIGZhbHNlICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdXBBcnJvd05vZGUuc2V0VmlzaWJsZSggdHJ1ZSApO1xyXG4gICAgICAgIGRvd25BcnJvd05vZGUuc2V0VmlzaWJsZSggdHJ1ZSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gU2V0IGEgdmFsdWUgdGhhdCB3aWxsIGJlIHVzZWQgdG8gcG9zaXRpb24gdGhlIGZpbmdlcnRpcC5cclxuICAgIHRoaXMuZmluZ2VydGlwVG9Cb3R0b21EaXN0YW5jZVkgPSBoaW50Tm9kZS5ib3R0b20gLSBwb2ludGluZ0hhbmRJbWFnZU5vZGUuYm90dG9tO1xyXG5cclxuICAgIHRoaXMubXV0YXRlKCBvcHRpb25zICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIHBvc2l0aW9uIG9mIHRoaXMgbm9kZSBzdWNoIHRoYXQgdGhlIHRpcCBvZiB0aGUgZmluZ2VyIGlzIGF0IHRoZSBwcm92aWRlZCBZIHBvc2l0aW9uLiAgVGhlIHggcG9zaXRpb25cclxuICAgKiByZW1haW5zIHVuY2hhbmdlZC5cclxuICAgKiBAcGFyYW0ge251bWJlcn0gZmluZ2VydGlwWVBvc1xyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBzZXRGaW5nZXJ0aXBZUG9zaXRpb24oIGZpbmdlcnRpcFlQb3MgKSB7XHJcbiAgICB0aGlzLmJvdHRvbSA9IGZpbmdlcnRpcFlQb3MgKyB0aGlzLmZpbmdlcnRpcFRvQm90dG9tRGlzdGFuY2VZO1xyXG4gIH1cclxufVxyXG5cclxuc3RhdGVzT2ZNYXR0ZXIucmVnaXN0ZXIoICdQb2ludGluZ0hhbmROb2RlJywgUG9pbnRpbmdIYW5kTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBQb2ludGluZ0hhbmROb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxPQUFPQyxTQUFTLE1BQU0sMENBQTBDO0FBQ2hFLFNBQVNDLFlBQVksRUFBRUMsS0FBSyxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQzdFLE9BQU9DLE1BQU0sTUFBTSxpQ0FBaUM7QUFDcEQsT0FBT0MsZ0JBQWdCLE1BQU0sc0NBQXNDO0FBQ25FLE9BQU9DLGNBQWMsTUFBTSx5QkFBeUI7QUFDcEQsT0FBT0MscUJBQXFCLE1BQU0sbUNBQW1DOztBQUVyRTtBQUNBLE1BQU1DLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQzs7QUFFbkIsTUFBTUMsZ0JBQWdCLFNBQVNOLElBQUksQ0FBQztFQUVsQztBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0VPLFdBQVdBLENBQUVDLGlCQUFpQixFQUFFQyxrQkFBa0IsRUFBRUMsT0FBTyxFQUFHO0lBRTVEQSxPQUFPLEdBQUdkLEtBQUssQ0FBRTtNQUNmZSxNQUFNLEVBQUVWLE1BQU0sQ0FBQ1c7SUFDakIsQ0FBQyxFQUFFRixPQUFRLENBQUM7SUFFWixLQUFLLENBQUMsQ0FBQzs7SUFFUDtJQUNBLE1BQU1HLFdBQVcsR0FBRyxJQUFJaEIsU0FBUyxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRTtNQUM5Q2lCLFVBQVUsRUFBRSxFQUFFO01BQ2RDLFNBQVMsRUFBRSxFQUFFO01BQ2JDLFNBQVMsRUFBRSxDQUFDO01BQ1pDLElBQUksRUFBRSxTQUFTO01BQ2ZDLE1BQU0sRUFBRSxTQUFTO01BQ2pCQyxRQUFRLEVBQUUsSUFBSTtNQUNkQyxRQUFRLEVBQUUsQ0FBQyxHQUFHQyxJQUFJLENBQUNDLEVBQUUsR0FBRztJQUMxQixDQUFFLENBQUM7O0lBRUg7SUFDQSxNQUFNQyxhQUFhLEdBQUcsSUFBSTFCLFNBQVMsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUU7TUFDaERpQixVQUFVLEVBQUUsRUFBRTtNQUNkQyxTQUFTLEVBQUUsRUFBRTtNQUNiQyxTQUFTLEVBQUUsQ0FBQztNQUNaQyxJQUFJLEVBQUUsU0FBUztNQUNmQyxNQUFNLEVBQUUsU0FBUztNQUNqQkMsUUFBUSxFQUFFLElBQUk7TUFDZEssR0FBRyxFQUFFWCxXQUFXLENBQUNZLE1BQU0sR0FBRztJQUM1QixDQUFFLENBQUM7O0lBRUg7SUFDQSxNQUFNQyxxQkFBcUIsR0FBRyxJQUFJM0IsS0FBSyxDQUFFRyxnQkFBZ0IsRUFBRTtNQUN6RHlCLE1BQU0sRUFBRSxXQUFXO01BQ25CUixRQUFRLEVBQUU7SUFDWixDQUFFLENBQUM7SUFDSE8scUJBQXFCLENBQUNFLEtBQUssQ0FBRXZCLEtBQUssR0FBR3FCLHFCQUFxQixDQUFDRyxLQUFNLENBQUM7SUFFbEUsTUFBTUMsUUFBUSxHQUFHLElBQUk5QixJQUFJLENBQUU7TUFDekIrQixRQUFRLEVBQUUsQ0FBRWxCLFdBQVcsRUFBRVUsYUFBYSxDQUFFO01BQ3hDUyxPQUFPLEVBQUUsS0FBSztNQUNkUixHQUFHLEVBQUVFLHFCQUFxQixDQUFDRCxNQUFNLEdBQUcsRUFBRTtNQUFFO01BQ3hDUSxJQUFJLEVBQUVQLHFCQUFxQixDQUFDUSxLQUFLLEdBQUcsRUFBRSxDQUFDO0lBQ3pDLENBQUUsQ0FBQzs7SUFFSCxJQUFJQyxTQUFTLEdBQUcsS0FBSztJQUNyQixJQUFJQyxZQUFZLEdBQUcsS0FBSztJQUV4QixNQUFNQyxvQkFBb0IsR0FBR0EsQ0FBQSxLQUFNO01BQ2pDUCxRQUFRLENBQUNRLFVBQVUsQ0FBRUgsU0FBUyxJQUFJQyxZQUFhLENBQUM7SUFDbEQsQ0FBQzs7SUFFRDtJQUNBLElBQUlHLE1BQU07SUFDVixJQUFJQyxJQUFJO0lBQ1IsSUFBSUMsd0JBQXdCOztJQUU1QjtJQUNBZixxQkFBcUIsQ0FBQ2dCLGdCQUFnQixDQUFFLElBQUk1QyxZQUFZLENBQUU7TUFFeEQ2QyxjQUFjLEVBQUUsSUFBSTtNQUVwQkMsS0FBSyxFQUFFQyxLQUFLLElBQUk7UUFDZE4sTUFBTSxHQUFHLElBQUksQ0FBQ08sbUJBQW1CLENBQUVELEtBQUssQ0FBQ0UsT0FBTyxDQUFDQyxLQUFNLENBQUMsQ0FBQ0MsQ0FBQztRQUMxRGIsWUFBWSxHQUFHLElBQUk7UUFDbkJLLHdCQUF3QixHQUFHakMsaUJBQWlCLENBQUMwQyx1QkFBdUIsQ0FBQ0MsR0FBRyxDQUFDLENBQUM7UUFDMUVkLG9CQUFvQixDQUFDLENBQUM7TUFDeEIsQ0FBQztNQUVEZSxJQUFJLEVBQUVQLEtBQUssSUFBSTtRQUNiTCxJQUFJLEdBQUcsSUFBSSxDQUFDTSxtQkFBbUIsQ0FBRUQsS0FBSyxDQUFDRSxPQUFPLENBQUNDLEtBQU0sQ0FBQyxDQUFDQyxDQUFDOztRQUV4RDtRQUNBekMsaUJBQWlCLENBQUM2Qyx3QkFBd0IsQ0FDeENaLHdCQUF3QixHQUFHaEMsa0JBQWtCLENBQUM2QyxpQkFBaUIsQ0FBRWQsSUFBSSxHQUFHRCxNQUFPLENBQ2pGLENBQUM7UUFDREYsb0JBQW9CLENBQUMsQ0FBQztNQUN4QixDQUFDO01BRURrQixHQUFHLEVBQUVBLENBQUEsS0FBTTtRQUVUO1FBQ0EsSUFBSyxDQUFDL0MsaUJBQWlCLENBQUNnRCxrQkFBa0IsQ0FBQ0MsS0FBSyxFQUFHO1VBQ2pEakQsaUJBQWlCLENBQUM2Qyx3QkFBd0IsQ0FBRTdDLGlCQUFpQixDQUFDMEMsdUJBQXVCLENBQUNDLEdBQUcsQ0FBQyxDQUFFLENBQUM7UUFDL0Y7UUFDQWYsWUFBWSxHQUFHLEtBQUs7UUFDcEJDLG9CQUFvQixDQUFDLENBQUM7TUFDeEIsQ0FBQztNQUVEMUIsTUFBTSxFQUFFRCxPQUFPLENBQUNDLE1BQU0sQ0FBQytDLFlBQVksQ0FBRSxjQUFlO0lBQ3RELENBQUUsQ0FBRSxDQUFDOztJQUVMO0lBQ0FsRCxpQkFBaUIsQ0FBQ2dELGtCQUFrQixDQUFDRyxRQUFRLENBQUVDLFVBQVUsSUFBSTtNQUMzRCxJQUFLQSxVQUFVLEVBQUc7UUFDaEIsSUFBSSxDQUFDQyxxQkFBcUIsQ0FBQyxDQUFDO01BQzlCO0lBQ0YsQ0FBRSxDQUFDOztJQUVIO0lBQ0EsSUFBSSxDQUFDbkIsZ0JBQWdCLENBQUU7TUFDckJvQixLQUFLLEVBQUVBLENBQUEsS0FBTTtRQUNYM0IsU0FBUyxHQUFHLElBQUk7UUFDaEJFLG9CQUFvQixDQUFDLENBQUM7TUFDeEIsQ0FBQztNQUNEMEIsSUFBSSxFQUFFQSxDQUFBLEtBQU07UUFDVjVCLFNBQVMsR0FBRyxLQUFLO1FBQ2pCRSxvQkFBb0IsQ0FBQyxDQUFDO01BQ3hCO0lBQ0YsQ0FBRSxDQUFDOztJQUVIO0lBQ0EsSUFBSSxDQUFDMkIsUUFBUSxDQUFFdEMscUJBQXNCLENBQUM7SUFDdEMsSUFBSSxDQUFDc0MsUUFBUSxDQUFFbEMsUUFBUyxDQUFDOztJQUV6QjtJQUNBSixxQkFBcUIsQ0FBQ3VDLFNBQVMsR0FBR3ZDLHFCQUFxQixDQUFDd0MsV0FBVyxDQUFDQyxTQUFTLENBQUUsRUFBRSxFQUFFLEVBQUcsQ0FBQzs7SUFFdkY7SUFDQTNELGlCQUFpQixDQUFDMEMsdUJBQXVCLENBQUNrQixJQUFJLENBQUVDLHVCQUF1QixJQUFJO01BQ3pFLElBQUtBLHVCQUF1QixLQUFLakUscUJBQXFCLENBQUNrRSxpQ0FBaUMsRUFBRztRQUV6RjtRQUNBekQsV0FBVyxDQUFDeUIsVUFBVSxDQUFFLEtBQU0sQ0FBQztRQUMvQmYsYUFBYSxDQUFDZSxVQUFVLENBQUUsSUFBSyxDQUFDO01BQ2xDLENBQUMsTUFDSSxJQUFLK0IsdUJBQXVCLEtBQUtqRSxxQkFBcUIsQ0FBQ21FLDZCQUE2QixFQUFHO1FBRTFGO1FBQ0ExRCxXQUFXLENBQUN5QixVQUFVLENBQUUsSUFBSyxDQUFDO1FBQzlCZixhQUFhLENBQUNlLFVBQVUsQ0FBRSxLQUFNLENBQUM7TUFDbkMsQ0FBQyxNQUNJO1FBQ0h6QixXQUFXLENBQUN5QixVQUFVLENBQUUsSUFBSyxDQUFDO1FBQzlCZixhQUFhLENBQUNlLFVBQVUsQ0FBRSxJQUFLLENBQUM7TUFDbEM7SUFDRixDQUFFLENBQUM7O0lBRUg7SUFDQSxJQUFJLENBQUNrQywwQkFBMEIsR0FBRzFDLFFBQVEsQ0FBQ0wsTUFBTSxHQUFHQyxxQkFBcUIsQ0FBQ0QsTUFBTTtJQUVoRixJQUFJLENBQUNnRCxNQUFNLENBQUUvRCxPQUFRLENBQUM7RUFDeEI7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VnRSxxQkFBcUJBLENBQUVDLGFBQWEsRUFBRztJQUNyQyxJQUFJLENBQUNsRCxNQUFNLEdBQUdrRCxhQUFhLEdBQUcsSUFBSSxDQUFDSCwwQkFBMEI7RUFDL0Q7QUFDRjtBQUVBckUsY0FBYyxDQUFDeUUsUUFBUSxDQUFFLGtCQUFrQixFQUFFdEUsZ0JBQWlCLENBQUM7QUFDL0QsZUFBZUEsZ0JBQWdCIn0=