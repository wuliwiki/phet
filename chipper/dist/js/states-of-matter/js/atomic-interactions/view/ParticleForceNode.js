// Copyright 2015-2021, University of Colorado Boulder

/**
 * this type adds the ability to display force arrows to a particle node
 * @author Siddhartha Chinthapally (Actual Concepts)
 */

import merge from '../../../../phet-core/js/merge.js';
import { Color } from '../../../../scenery/js/imports.js';
import statesOfMatter from '../../statesOfMatter.js';
import DimensionalArrowNode from './DimensionalArrowNode.js';
import ParticleNode from './ParticleNode.js';

// The following constants control some of the aspects of the appearance of the force arrows.  The values were
// empirically chosen to look good in this particular sim.
const ATTRACTIVE_FORCE_COLOR = '#FC9732';
const REPULSIVE_FORCE_COLOR = new Color(255, 0, 255, 175); // Magenta.
const TOTAL_FORCE_COLOR = '#49B649';
const COMPONENT_FORCE_ARROW_REFERENCE_LENGTH = 150;
const COMPONENT_FORCE_ARROW_REFERENCE_MAGNITUDE = 1E-22;
const TOTAL_FORCE_ARROW_REFERENCE_LENGTH = 200;
const TOTAL_FORCE_ARROW_REFERENCE_MAGNITUDE = 1E-22;
const FORCE_ARROW_TAIL_WIDTH = 30;
const FORCE_ARROW_HEAD_WIDTH = 50;
const FORCE_ARROW_HEAD_LENGTH = 50;
class ParticleForceNode extends ParticleNode {
  /**
   * @param {Particle} particle - The particle in the model that this node will represent in the view.
   * @param {ModelViewTransform2} modelViewTransform to convert between model and view co-ordinates
   * The gradient is computationally intensive to create, so use only when needed.
   * @param {boolean} enableOverlap - true if the node should be larger than the actual particle, thus allowing particles
   * @param {Tandem} tandem - support for exporting instances from the sim
   */
  constructor(particle, modelViewTransform, enableOverlap, tandem) {
    super(particle, modelViewTransform, enableOverlap, tandem);

    // @private
    this.attractiveForce = 0;
    this.repulsiveForce = 0;
    const commonForceArrowNodeOptions = {
      pickable: false,
      headHeight: FORCE_ARROW_HEAD_LENGTH,
      headWidth: FORCE_ARROW_HEAD_WIDTH,
      tailWidth: FORCE_ARROW_TAIL_WIDTH,
      opacity: 0.7 // empirically determined
    };

    // @private attractive force node
    this.attractiveForceVectorNode = new DimensionalArrowNode(0, 0, COMPONENT_FORCE_ARROW_REFERENCE_LENGTH, 0, merge({
      fill: ATTRACTIVE_FORCE_COLOR
    }, commonForceArrowNodeOptions));
    this.addChild(this.attractiveForceVectorNode);
    this.attractiveForceVectorNode.setVisible(false);

    // @private repulsive force node
    this.repulsiveForceVectorNode = new DimensionalArrowNode(0, 0, COMPONENT_FORCE_ARROW_REFERENCE_LENGTH, 0, merge({
      fill: REPULSIVE_FORCE_COLOR
    }, commonForceArrowNodeOptions));
    this.addChild(this.repulsiveForceVectorNode);
    this.repulsiveForceVectorNode.setVisible(false);

    // @private total force node
    this.totalForceVectorNode = new DimensionalArrowNode(0, 0, TOTAL_FORCE_ARROW_REFERENCE_LENGTH, 0, merge({
      fill: TOTAL_FORCE_COLOR
    }, commonForceArrowNodeOptions));
    this.addChild(this.totalForceVectorNode);
    this.totalForceVectorNode.setVisible(false);
    const handlePositionChanged = position => {
      this.setTranslation(modelViewTransform.modelToViewX(position.x), modelViewTransform.modelToViewY(position.y));
    };
    particle.positionProperty.link(handlePositionChanged);

    // dispose function
    this.disposeParticleForceNode = () => {
      particle.positionProperty.unlink(handlePositionChanged);
    };
  }

  /**
   * @public
   */
  dispose() {
    this.disposeParticleForceNode();
    super.dispose();
  }

  /**
   * Set the levels of attractive and repulsive forces being experienced by the particle in the model so that they may
   * be represented as force vectors.
   * @param {number}attractiveForce
   * @param {number}repulsiveForce
   * @public
   */
  setForces(attractiveForce, repulsiveForce) {
    this.attractiveForce = attractiveForce;
    this.repulsiveForce = repulsiveForce;
    this.updateForceVectors();
  }

  /**
   * @param {boolean} showAttractiveForces - true to show attractive force, false to hide
   * @public
   */
  setShowAttractiveForces(showAttractiveForces) {
    this.attractiveForceVectorNode.setVisible(showAttractiveForces);
  }

  /**
   * @param {boolean} showRepulsiveForces - true to show repulsive force, false to hide
   * @public
   */
  setShowRepulsiveForces(showRepulsiveForces) {
    this.repulsiveForceVectorNode.setVisible(showRepulsiveForces);
  }

  /**
   * @param {boolean} showTotalForce - true to show total force, false to hide
   * @public
   */
  setShowTotalForces(showTotalForce) {
    this.totalForceVectorNode.setVisible(showTotalForce);
  }

  /**
   * Update the force vectors to reflect the forces being experienced by the atom.
   * @private
   */
  updateForceVectors() {
    const angle = 0;
    const attractiveY = this.attractiveForce * Math.sin(angle) * (COMPONENT_FORCE_ARROW_REFERENCE_LENGTH / COMPONENT_FORCE_ARROW_REFERENCE_MAGNITUDE);
    const attractiveX = this.attractiveForce * Math.cos(angle) * (COMPONENT_FORCE_ARROW_REFERENCE_LENGTH / COMPONENT_FORCE_ARROW_REFERENCE_MAGNITUDE);
    this.attractiveForceVectorNode.setTailAndTip(0, 0, attractiveX, attractiveY);
    const repulsiveY = this.repulsiveForce * Math.sin(angle) * (COMPONENT_FORCE_ARROW_REFERENCE_LENGTH / COMPONENT_FORCE_ARROW_REFERENCE_MAGNITUDE);
    const repulsiveX = this.repulsiveForce * Math.cos(angle) * (COMPONENT_FORCE_ARROW_REFERENCE_LENGTH / COMPONENT_FORCE_ARROW_REFERENCE_MAGNITUDE);
    this.repulsiveForceVectorNode.setTailAndTip(0, 0, repulsiveX, repulsiveY);
    const totalForceY = (this.attractiveForce + this.repulsiveForce) * Math.sin(angle) * (TOTAL_FORCE_ARROW_REFERENCE_LENGTH / TOTAL_FORCE_ARROW_REFERENCE_MAGNITUDE);
    const totalForceX = (this.attractiveForce + this.repulsiveForce) * Math.cos(angle) * (TOTAL_FORCE_ARROW_REFERENCE_LENGTH / TOTAL_FORCE_ARROW_REFERENCE_MAGNITUDE);
    this.totalForceVectorNode.setTailAndTip(0, 0, totalForceX, totalForceY);
  }
}
statesOfMatter.register('ParticleForceNode', ParticleForceNode);
export default ParticleForceNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtZXJnZSIsIkNvbG9yIiwic3RhdGVzT2ZNYXR0ZXIiLCJEaW1lbnNpb25hbEFycm93Tm9kZSIsIlBhcnRpY2xlTm9kZSIsIkFUVFJBQ1RJVkVfRk9SQ0VfQ09MT1IiLCJSRVBVTFNJVkVfRk9SQ0VfQ09MT1IiLCJUT1RBTF9GT1JDRV9DT0xPUiIsIkNPTVBPTkVOVF9GT1JDRV9BUlJPV19SRUZFUkVOQ0VfTEVOR1RIIiwiQ09NUE9ORU5UX0ZPUkNFX0FSUk9XX1JFRkVSRU5DRV9NQUdOSVRVREUiLCJUT1RBTF9GT1JDRV9BUlJPV19SRUZFUkVOQ0VfTEVOR1RIIiwiVE9UQUxfRk9SQ0VfQVJST1dfUkVGRVJFTkNFX01BR05JVFVERSIsIkZPUkNFX0FSUk9XX1RBSUxfV0lEVEgiLCJGT1JDRV9BUlJPV19IRUFEX1dJRFRIIiwiRk9SQ0VfQVJST1dfSEVBRF9MRU5HVEgiLCJQYXJ0aWNsZUZvcmNlTm9kZSIsImNvbnN0cnVjdG9yIiwicGFydGljbGUiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJlbmFibGVPdmVybGFwIiwidGFuZGVtIiwiYXR0cmFjdGl2ZUZvcmNlIiwicmVwdWxzaXZlRm9yY2UiLCJjb21tb25Gb3JjZUFycm93Tm9kZU9wdGlvbnMiLCJwaWNrYWJsZSIsImhlYWRIZWlnaHQiLCJoZWFkV2lkdGgiLCJ0YWlsV2lkdGgiLCJvcGFjaXR5IiwiYXR0cmFjdGl2ZUZvcmNlVmVjdG9yTm9kZSIsImZpbGwiLCJhZGRDaGlsZCIsInNldFZpc2libGUiLCJyZXB1bHNpdmVGb3JjZVZlY3Rvck5vZGUiLCJ0b3RhbEZvcmNlVmVjdG9yTm9kZSIsImhhbmRsZVBvc2l0aW9uQ2hhbmdlZCIsInBvc2l0aW9uIiwic2V0VHJhbnNsYXRpb24iLCJtb2RlbFRvVmlld1giLCJ4IiwibW9kZWxUb1ZpZXdZIiwieSIsInBvc2l0aW9uUHJvcGVydHkiLCJsaW5rIiwiZGlzcG9zZVBhcnRpY2xlRm9yY2VOb2RlIiwidW5saW5rIiwiZGlzcG9zZSIsInNldEZvcmNlcyIsInVwZGF0ZUZvcmNlVmVjdG9ycyIsInNldFNob3dBdHRyYWN0aXZlRm9yY2VzIiwic2hvd0F0dHJhY3RpdmVGb3JjZXMiLCJzZXRTaG93UmVwdWxzaXZlRm9yY2VzIiwic2hvd1JlcHVsc2l2ZUZvcmNlcyIsInNldFNob3dUb3RhbEZvcmNlcyIsInNob3dUb3RhbEZvcmNlIiwiYW5nbGUiLCJhdHRyYWN0aXZlWSIsIk1hdGgiLCJzaW4iLCJhdHRyYWN0aXZlWCIsImNvcyIsInNldFRhaWxBbmRUaXAiLCJyZXB1bHNpdmVZIiwicmVwdWxzaXZlWCIsInRvdGFsRm9yY2VZIiwidG90YWxGb3JjZVgiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlBhcnRpY2xlRm9yY2VOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjEsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIHRoaXMgdHlwZSBhZGRzIHRoZSBhYmlsaXR5IHRvIGRpc3BsYXkgZm9yY2UgYXJyb3dzIHRvIGEgcGFydGljbGUgbm9kZVxyXG4gKiBAYXV0aG9yIFNpZGRoYXJ0aGEgQ2hpbnRoYXBhbGx5IChBY3R1YWwgQ29uY2VwdHMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCB7IENvbG9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHN0YXRlc09mTWF0dGVyIGZyb20gJy4uLy4uL3N0YXRlc09mTWF0dGVyLmpzJztcclxuaW1wb3J0IERpbWVuc2lvbmFsQXJyb3dOb2RlIGZyb20gJy4vRGltZW5zaW9uYWxBcnJvd05vZGUuanMnO1xyXG5pbXBvcnQgUGFydGljbGVOb2RlIGZyb20gJy4vUGFydGljbGVOb2RlLmpzJztcclxuXHJcbi8vIFRoZSBmb2xsb3dpbmcgY29uc3RhbnRzIGNvbnRyb2wgc29tZSBvZiB0aGUgYXNwZWN0cyBvZiB0aGUgYXBwZWFyYW5jZSBvZiB0aGUgZm9yY2UgYXJyb3dzLiAgVGhlIHZhbHVlcyB3ZXJlXHJcbi8vIGVtcGlyaWNhbGx5IGNob3NlbiB0byBsb29rIGdvb2QgaW4gdGhpcyBwYXJ0aWN1bGFyIHNpbS5cclxuY29uc3QgQVRUUkFDVElWRV9GT1JDRV9DT0xPUiA9ICcjRkM5NzMyJztcclxuY29uc3QgUkVQVUxTSVZFX0ZPUkNFX0NPTE9SID0gbmV3IENvbG9yKCAyNTUsIDAsIDI1NSwgMTc1ICk7IC8vIE1hZ2VudGEuXHJcbmNvbnN0IFRPVEFMX0ZPUkNFX0NPTE9SID0gJyM0OUI2NDknO1xyXG5jb25zdCBDT01QT05FTlRfRk9SQ0VfQVJST1dfUkVGRVJFTkNFX0xFTkdUSCA9IDE1MDtcclxuY29uc3QgQ09NUE9ORU5UX0ZPUkNFX0FSUk9XX1JFRkVSRU5DRV9NQUdOSVRVREUgPSAxRS0yMjtcclxuY29uc3QgVE9UQUxfRk9SQ0VfQVJST1dfUkVGRVJFTkNFX0xFTkdUSCA9IDIwMDtcclxuY29uc3QgVE9UQUxfRk9SQ0VfQVJST1dfUkVGRVJFTkNFX01BR05JVFVERSA9IDFFLTIyO1xyXG5jb25zdCBGT1JDRV9BUlJPV19UQUlMX1dJRFRIID0gMzA7XHJcbmNvbnN0IEZPUkNFX0FSUk9XX0hFQURfV0lEVEggPSA1MDtcclxuY29uc3QgRk9SQ0VfQVJST1dfSEVBRF9MRU5HVEggPSA1MDtcclxuXHJcbmNsYXNzIFBhcnRpY2xlRm9yY2VOb2RlIGV4dGVuZHMgUGFydGljbGVOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtQYXJ0aWNsZX0gcGFydGljbGUgLSBUaGUgcGFydGljbGUgaW4gdGhlIG1vZGVsIHRoYXQgdGhpcyBub2RlIHdpbGwgcmVwcmVzZW50IGluIHRoZSB2aWV3LlxyXG4gICAqIEBwYXJhbSB7TW9kZWxWaWV3VHJhbnNmb3JtMn0gbW9kZWxWaWV3VHJhbnNmb3JtIHRvIGNvbnZlcnQgYmV0d2VlbiBtb2RlbCBhbmQgdmlldyBjby1vcmRpbmF0ZXNcclxuICAgKiBUaGUgZ3JhZGllbnQgaXMgY29tcHV0YXRpb25hbGx5IGludGVuc2l2ZSB0byBjcmVhdGUsIHNvIHVzZSBvbmx5IHdoZW4gbmVlZGVkLlxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gZW5hYmxlT3ZlcmxhcCAtIHRydWUgaWYgdGhlIG5vZGUgc2hvdWxkIGJlIGxhcmdlciB0aGFuIHRoZSBhY3R1YWwgcGFydGljbGUsIHRodXMgYWxsb3dpbmcgcGFydGljbGVzXHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbSAtIHN1cHBvcnQgZm9yIGV4cG9ydGluZyBpbnN0YW5jZXMgZnJvbSB0aGUgc2ltXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIHBhcnRpY2xlLCBtb2RlbFZpZXdUcmFuc2Zvcm0sIGVuYWJsZU92ZXJsYXAsIHRhbmRlbSApIHtcclxuXHJcbiAgICBzdXBlciggcGFydGljbGUsIG1vZGVsVmlld1RyYW5zZm9ybSwgZW5hYmxlT3ZlcmxhcCwgdGFuZGVtICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMuYXR0cmFjdGl2ZUZvcmNlID0gMDtcclxuICAgIHRoaXMucmVwdWxzaXZlRm9yY2UgPSAwO1xyXG5cclxuICAgIGNvbnN0IGNvbW1vbkZvcmNlQXJyb3dOb2RlT3B0aW9ucyA9IHtcclxuICAgICAgcGlja2FibGU6IGZhbHNlLFxyXG4gICAgICBoZWFkSGVpZ2h0OiBGT1JDRV9BUlJPV19IRUFEX0xFTkdUSCxcclxuICAgICAgaGVhZFdpZHRoOiBGT1JDRV9BUlJPV19IRUFEX1dJRFRILFxyXG4gICAgICB0YWlsV2lkdGg6IEZPUkNFX0FSUk9XX1RBSUxfV0lEVEgsXHJcbiAgICAgIG9wYWNpdHk6IDAuNyAvLyBlbXBpcmljYWxseSBkZXRlcm1pbmVkXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEBwcml2YXRlIGF0dHJhY3RpdmUgZm9yY2Ugbm9kZVxyXG4gICAgdGhpcy5hdHRyYWN0aXZlRm9yY2VWZWN0b3JOb2RlID0gbmV3IERpbWVuc2lvbmFsQXJyb3dOb2RlKCAwLCAwLCBDT01QT05FTlRfRk9SQ0VfQVJST1dfUkVGRVJFTkNFX0xFTkdUSCwgMCwgbWVyZ2UoIHtcclxuICAgICAgZmlsbDogQVRUUkFDVElWRV9GT1JDRV9DT0xPUlxyXG4gICAgfSwgY29tbW9uRm9yY2VBcnJvd05vZGVPcHRpb25zICkgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuYXR0cmFjdGl2ZUZvcmNlVmVjdG9yTm9kZSApO1xyXG4gICAgdGhpcy5hdHRyYWN0aXZlRm9yY2VWZWN0b3JOb2RlLnNldFZpc2libGUoIGZhbHNlICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgcmVwdWxzaXZlIGZvcmNlIG5vZGVcclxuICAgIHRoaXMucmVwdWxzaXZlRm9yY2VWZWN0b3JOb2RlID0gbmV3IERpbWVuc2lvbmFsQXJyb3dOb2RlKCAwLCAwLCBDT01QT05FTlRfRk9SQ0VfQVJST1dfUkVGRVJFTkNFX0xFTkdUSCwgMCwgbWVyZ2UoIHtcclxuICAgICAgZmlsbDogUkVQVUxTSVZFX0ZPUkNFX0NPTE9SXHJcbiAgICB9LCBjb21tb25Gb3JjZUFycm93Tm9kZU9wdGlvbnMgKSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5yZXB1bHNpdmVGb3JjZVZlY3Rvck5vZGUgKTtcclxuICAgIHRoaXMucmVwdWxzaXZlRm9yY2VWZWN0b3JOb2RlLnNldFZpc2libGUoIGZhbHNlICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgdG90YWwgZm9yY2Ugbm9kZVxyXG4gICAgdGhpcy50b3RhbEZvcmNlVmVjdG9yTm9kZSA9IG5ldyBEaW1lbnNpb25hbEFycm93Tm9kZSggMCwgMCwgVE9UQUxfRk9SQ0VfQVJST1dfUkVGRVJFTkNFX0xFTkdUSCwgMCwgbWVyZ2UoIHtcclxuICAgICAgZmlsbDogVE9UQUxfRk9SQ0VfQ09MT1JcclxuICAgIH0sIGNvbW1vbkZvcmNlQXJyb3dOb2RlT3B0aW9ucyApICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLnRvdGFsRm9yY2VWZWN0b3JOb2RlICk7XHJcbiAgICB0aGlzLnRvdGFsRm9yY2VWZWN0b3JOb2RlLnNldFZpc2libGUoIGZhbHNlICk7XHJcblxyXG4gICAgY29uc3QgaGFuZGxlUG9zaXRpb25DaGFuZ2VkID0gcG9zaXRpb24gPT4ge1xyXG4gICAgICB0aGlzLnNldFRyYW5zbGF0aW9uKFxyXG4gICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIHBvc2l0aW9uLnggKSxcclxuICAgICAgICBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdZKCBwb3NpdGlvbi55IClcclxuICAgICAgKTtcclxuICAgIH07XHJcblxyXG4gICAgcGFydGljbGUucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCBoYW5kbGVQb3NpdGlvbkNoYW5nZWQgKTtcclxuXHJcbiAgICAvLyBkaXNwb3NlIGZ1bmN0aW9uXHJcbiAgICB0aGlzLmRpc3Bvc2VQYXJ0aWNsZUZvcmNlTm9kZSA9ICgpID0+IHtcclxuICAgICAgcGFydGljbGUucG9zaXRpb25Qcm9wZXJ0eS51bmxpbmsoIGhhbmRsZVBvc2l0aW9uQ2hhbmdlZCApO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBkaXNwb3NlKCkge1xyXG4gICAgdGhpcy5kaXNwb3NlUGFydGljbGVGb3JjZU5vZGUoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCB0aGUgbGV2ZWxzIG9mIGF0dHJhY3RpdmUgYW5kIHJlcHVsc2l2ZSBmb3JjZXMgYmVpbmcgZXhwZXJpZW5jZWQgYnkgdGhlIHBhcnRpY2xlIGluIHRoZSBtb2RlbCBzbyB0aGF0IHRoZXkgbWF5XHJcbiAgICogYmUgcmVwcmVzZW50ZWQgYXMgZm9yY2UgdmVjdG9ycy5cclxuICAgKiBAcGFyYW0ge251bWJlcn1hdHRyYWN0aXZlRm9yY2VcclxuICAgKiBAcGFyYW0ge251bWJlcn1yZXB1bHNpdmVGb3JjZVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBzZXRGb3JjZXMoIGF0dHJhY3RpdmVGb3JjZSwgcmVwdWxzaXZlRm9yY2UgKSB7XHJcbiAgICB0aGlzLmF0dHJhY3RpdmVGb3JjZSA9IGF0dHJhY3RpdmVGb3JjZTtcclxuICAgIHRoaXMucmVwdWxzaXZlRm9yY2UgPSByZXB1bHNpdmVGb3JjZTtcclxuICAgIHRoaXMudXBkYXRlRm9yY2VWZWN0b3JzKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNob3dBdHRyYWN0aXZlRm9yY2VzIC0gdHJ1ZSB0byBzaG93IGF0dHJhY3RpdmUgZm9yY2UsIGZhbHNlIHRvIGhpZGVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc2V0U2hvd0F0dHJhY3RpdmVGb3JjZXMoIHNob3dBdHRyYWN0aXZlRm9yY2VzICkge1xyXG4gICAgdGhpcy5hdHRyYWN0aXZlRm9yY2VWZWN0b3JOb2RlLnNldFZpc2libGUoIHNob3dBdHRyYWN0aXZlRm9yY2VzICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNob3dSZXB1bHNpdmVGb3JjZXMgLSB0cnVlIHRvIHNob3cgcmVwdWxzaXZlIGZvcmNlLCBmYWxzZSB0byBoaWRlXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHNldFNob3dSZXB1bHNpdmVGb3JjZXMoIHNob3dSZXB1bHNpdmVGb3JjZXMgKSB7XHJcbiAgICB0aGlzLnJlcHVsc2l2ZUZvcmNlVmVjdG9yTm9kZS5zZXRWaXNpYmxlKCBzaG93UmVwdWxzaXZlRm9yY2VzICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNob3dUb3RhbEZvcmNlIC0gdHJ1ZSB0byBzaG93IHRvdGFsIGZvcmNlLCBmYWxzZSB0byBoaWRlXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHNldFNob3dUb3RhbEZvcmNlcyggc2hvd1RvdGFsRm9yY2UgKSB7XHJcbiAgICB0aGlzLnRvdGFsRm9yY2VWZWN0b3JOb2RlLnNldFZpc2libGUoIHNob3dUb3RhbEZvcmNlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgdGhlIGZvcmNlIHZlY3RvcnMgdG8gcmVmbGVjdCB0aGUgZm9yY2VzIGJlaW5nIGV4cGVyaWVuY2VkIGJ5IHRoZSBhdG9tLlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgdXBkYXRlRm9yY2VWZWN0b3JzKCkge1xyXG4gICAgY29uc3QgYW5nbGUgPSAwO1xyXG4gICAgY29uc3QgYXR0cmFjdGl2ZVkgPSB0aGlzLmF0dHJhY3RpdmVGb3JjZSAqIE1hdGguc2luKCBhbmdsZSApICpcclxuICAgICAgICAgICAgICAgICAgICAgICAgKCBDT01QT05FTlRfRk9SQ0VfQVJST1dfUkVGRVJFTkNFX0xFTkdUSCAvIENPTVBPTkVOVF9GT1JDRV9BUlJPV19SRUZFUkVOQ0VfTUFHTklUVURFICk7XHJcbiAgICBjb25zdCBhdHRyYWN0aXZlWCA9IHRoaXMuYXR0cmFjdGl2ZUZvcmNlICogTWF0aC5jb3MoIGFuZ2xlICkgKlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoIENPTVBPTkVOVF9GT1JDRV9BUlJPV19SRUZFUkVOQ0VfTEVOR1RIIC8gQ09NUE9ORU5UX0ZPUkNFX0FSUk9XX1JFRkVSRU5DRV9NQUdOSVRVREUgKTtcclxuICAgIHRoaXMuYXR0cmFjdGl2ZUZvcmNlVmVjdG9yTm9kZS5zZXRUYWlsQW5kVGlwKCAwLCAwLCBhdHRyYWN0aXZlWCwgYXR0cmFjdGl2ZVkgKTtcclxuXHJcbiAgICBjb25zdCByZXB1bHNpdmVZID0gdGhpcy5yZXB1bHNpdmVGb3JjZSAqIE1hdGguc2luKCBhbmdsZSApICpcclxuICAgICAgICAgICAgICAgICAgICAgICAoIENPTVBPTkVOVF9GT1JDRV9BUlJPV19SRUZFUkVOQ0VfTEVOR1RIIC8gQ09NUE9ORU5UX0ZPUkNFX0FSUk9XX1JFRkVSRU5DRV9NQUdOSVRVREUgKTtcclxuICAgIGNvbnN0IHJlcHVsc2l2ZVggPSB0aGlzLnJlcHVsc2l2ZUZvcmNlICogTWF0aC5jb3MoIGFuZ2xlICkgKlxyXG4gICAgICAgICAgICAgICAgICAgICAgICggQ09NUE9ORU5UX0ZPUkNFX0FSUk9XX1JFRkVSRU5DRV9MRU5HVEggLyBDT01QT05FTlRfRk9SQ0VfQVJST1dfUkVGRVJFTkNFX01BR05JVFVERSApO1xyXG4gICAgdGhpcy5yZXB1bHNpdmVGb3JjZVZlY3Rvck5vZGUuc2V0VGFpbEFuZFRpcCggMCwgMCwgcmVwdWxzaXZlWCwgcmVwdWxzaXZlWSApO1xyXG5cclxuICAgIGNvbnN0IHRvdGFsRm9yY2VZID0gKCB0aGlzLmF0dHJhY3RpdmVGb3JjZSArIHRoaXMucmVwdWxzaXZlRm9yY2UgKSAqIE1hdGguc2luKCBhbmdsZSApICpcclxuICAgICAgICAgICAgICAgICAgICAgICAgKCBUT1RBTF9GT1JDRV9BUlJPV19SRUZFUkVOQ0VfTEVOR1RIIC8gVE9UQUxfRk9SQ0VfQVJST1dfUkVGRVJFTkNFX01BR05JVFVERSApO1xyXG4gICAgY29uc3QgdG90YWxGb3JjZVggPSAoIHRoaXMuYXR0cmFjdGl2ZUZvcmNlICsgdGhpcy5yZXB1bHNpdmVGb3JjZSApICogTWF0aC5jb3MoIGFuZ2xlICkgKlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoIFRPVEFMX0ZPUkNFX0FSUk9XX1JFRkVSRU5DRV9MRU5HVEggLyBUT1RBTF9GT1JDRV9BUlJPV19SRUZFUkVOQ0VfTUFHTklUVURFICk7XHJcbiAgICB0aGlzLnRvdGFsRm9yY2VWZWN0b3JOb2RlLnNldFRhaWxBbmRUaXAoIDAsIDAsIHRvdGFsRm9yY2VYLCB0b3RhbEZvcmNlWSApO1xyXG4gIH1cclxufVxyXG5cclxuc3RhdGVzT2ZNYXR0ZXIucmVnaXN0ZXIoICdQYXJ0aWNsZUZvcmNlTm9kZScsIFBhcnRpY2xlRm9yY2VOb2RlICk7XHJcbmV4cG9ydCBkZWZhdWx0IFBhcnRpY2xlRm9yY2VOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FB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