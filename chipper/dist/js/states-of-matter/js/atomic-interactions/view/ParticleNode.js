// Copyright 2015-2022, University of Colorado Boulder

/**
 * Scenery Node that represents a particle
 * @author Aaron Davis
 * @author Chandrashekar Bemagoni (Actual Concepts)
 * @author John Blanco
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import { Circle, Color, Node, RadialGradient } from '../../../../scenery/js/imports.js';
import statesOfMatter from '../../statesOfMatter.js';

// constants
const MVT_SCALE = 0.25;
const OVERLAP_ENLARGEMENT_FACTOR = 1.25;
class ParticleNode extends Node {
  /**
   * @param {MotionAtom} particle  - The particle in the model that this node will represent in the view.
   * @param {ModelViewTransform2} modelViewTransform to convert between model and view co-ordinates
   * The gradient is computationally intensive to create, so use only when needed.
   * @param {boolean} enableOverlap - true if the node should be larger than the actual particle, thus allowing particles
   * @param {Tandem} tandem - support for exporting instances from the sim
   */
  constructor(particle, modelViewTransform, enableOverlap, tandem) {
    assert && assert(particle && modelViewTransform);
    super({
      tandem: tandem,
      phetioInputEnabledPropertyInstrumented: true
    });

    // @private
    this.particle = particle;
    this.modelViewTransform = modelViewTransform;
    this.overlapEnabled = enableOverlap;
    this.position = new Vector2(0, 0);

    // @private - node that will represent this particle, initialized arbitrarily, updated below
    this.circle = new Circle(1);
    this.addChild(this.circle);

    // update the appearance when the particle configuration changes
    const updateAppearance = () => {
      // calculate the scaled radius of the circle
      let radiusInView = particle.radiusProperty.value * MVT_SCALE;
      if (this.overlapEnabled) {
        // Overlap is enabled, so make the shape slightly larger than the radius of the circle so that overlap will occur
        // during inter-particle collisions.
        radiusInView = radiusInView * OVERLAP_ENLARGEMENT_FACTOR;
      }
      this.circle.setRadius(radiusInView);
      this.circle.fill = this.createFill(particle.color, particle.radiusProperty.value);
    };
    particle.radiusProperty.link(updateAppearance);
    particle.configurationChanged.addListener(updateAppearance);

    // Set ourself to be initially non-pickable so that we don't get mouse events.
    this.setPickable(false);
    this.updatePosition();
  }

  /**
   * @public
   */
  updatePosition() {
    if (this.particle !== null) {
      this.position = this.modelViewTransform.modelToViewPosition(this.particle.positionProperty.value);
      this.setTranslation(this.position);
    }
  }

  /**
   * Create the gradient fill for this particle.
   * @returns {RadialGradient} - paint to use for this particle
   * @private
   */
  createFill(baseColor, atomRadius) {
    const darkenedBaseColor = baseColor.colorUtilsDarker(0.5);
    const transparentDarkenedBasedColor = new Color(darkenedBaseColor.getRed(), darkenedBaseColor.getGreen(), darkenedBaseColor.getBlue(), 0.3);
    const radius = (this.overlapEnabled ? atomRadius * OVERLAP_ENLARGEMENT_FACTOR : atomRadius) * MVT_SCALE;
    return new RadialGradient(0, 0, 0, 0, 0, radius).addColorStop(0, baseColor).addColorStop(0.95, transparentDarkenedBasedColor);
  }
}
statesOfMatter.register('ParticleNode', ParticleNode);
export default ParticleNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiQ2lyY2xlIiwiQ29sb3IiLCJOb2RlIiwiUmFkaWFsR3JhZGllbnQiLCJzdGF0ZXNPZk1hdHRlciIsIk1WVF9TQ0FMRSIsIk9WRVJMQVBfRU5MQVJHRU1FTlRfRkFDVE9SIiwiUGFydGljbGVOb2RlIiwiY29uc3RydWN0b3IiLCJwYXJ0aWNsZSIsIm1vZGVsVmlld1RyYW5zZm9ybSIsImVuYWJsZU92ZXJsYXAiLCJ0YW5kZW0iLCJhc3NlcnQiLCJwaGV0aW9JbnB1dEVuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZCIsIm92ZXJsYXBFbmFibGVkIiwicG9zaXRpb24iLCJjaXJjbGUiLCJhZGRDaGlsZCIsInVwZGF0ZUFwcGVhcmFuY2UiLCJyYWRpdXNJblZpZXciLCJyYWRpdXNQcm9wZXJ0eSIsInZhbHVlIiwic2V0UmFkaXVzIiwiZmlsbCIsImNyZWF0ZUZpbGwiLCJjb2xvciIsImxpbmsiLCJjb25maWd1cmF0aW9uQ2hhbmdlZCIsImFkZExpc3RlbmVyIiwic2V0UGlja2FibGUiLCJ1cGRhdGVQb3NpdGlvbiIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJwb3NpdGlvblByb3BlcnR5Iiwic2V0VHJhbnNsYXRpb24iLCJiYXNlQ29sb3IiLCJhdG9tUmFkaXVzIiwiZGFya2VuZWRCYXNlQ29sb3IiLCJjb2xvclV0aWxzRGFya2VyIiwidHJhbnNwYXJlbnREYXJrZW5lZEJhc2VkQ29sb3IiLCJnZXRSZWQiLCJnZXRHcmVlbiIsImdldEJsdWUiLCJyYWRpdXMiLCJhZGRDb2xvclN0b3AiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlBhcnRpY2xlTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTY2VuZXJ5IE5vZGUgdGhhdCByZXByZXNlbnRzIGEgcGFydGljbGVcclxuICogQGF1dGhvciBBYXJvbiBEYXZpc1xyXG4gKiBAYXV0aG9yIENoYW5kcmFzaGVrYXIgQmVtYWdvbmkgKEFjdHVhbCBDb25jZXB0cylcclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKi9cclxuXHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgQ2lyY2xlLCBDb2xvciwgTm9kZSwgUmFkaWFsR3JhZGllbnQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgc3RhdGVzT2ZNYXR0ZXIgZnJvbSAnLi4vLi4vc3RhdGVzT2ZNYXR0ZXIuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE1WVF9TQ0FMRSA9IDAuMjU7XHJcbmNvbnN0IE9WRVJMQVBfRU5MQVJHRU1FTlRfRkFDVE9SID0gMS4yNTtcclxuXHJcbmNsYXNzIFBhcnRpY2xlTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge01vdGlvbkF0b219IHBhcnRpY2xlICAtIFRoZSBwYXJ0aWNsZSBpbiB0aGUgbW9kZWwgdGhhdCB0aGlzIG5vZGUgd2lsbCByZXByZXNlbnQgaW4gdGhlIHZpZXcuXHJcbiAgICogQHBhcmFtIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfSBtb2RlbFZpZXdUcmFuc2Zvcm0gdG8gY29udmVydCBiZXR3ZWVuIG1vZGVsIGFuZCB2aWV3IGNvLW9yZGluYXRlc1xyXG4gICAqIFRoZSBncmFkaWVudCBpcyBjb21wdXRhdGlvbmFsbHkgaW50ZW5zaXZlIHRvIGNyZWF0ZSwgc28gdXNlIG9ubHkgd2hlbiBuZWVkZWQuXHJcbiAgICogQHBhcmFtIHtib29sZWFufSBlbmFibGVPdmVybGFwIC0gdHJ1ZSBpZiB0aGUgbm9kZSBzaG91bGQgYmUgbGFyZ2VyIHRoYW4gdGhlIGFjdHVhbCBwYXJ0aWNsZSwgdGh1cyBhbGxvd2luZyBwYXJ0aWNsZXNcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtIC0gc3VwcG9ydCBmb3IgZXhwb3J0aW5nIGluc3RhbmNlcyBmcm9tIHRoZSBzaW1cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggcGFydGljbGUsIG1vZGVsVmlld1RyYW5zZm9ybSwgZW5hYmxlT3ZlcmxhcCwgdGFuZGVtICkge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggcGFydGljbGUgJiYgbW9kZWxWaWV3VHJhbnNmb3JtICk7XHJcblxyXG4gICAgc3VwZXIoIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0sXHJcbiAgICAgIHBoZXRpb0lucHV0RW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkOiB0cnVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMucGFydGljbGUgPSBwYXJ0aWNsZTtcclxuICAgIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtID0gbW9kZWxWaWV3VHJhbnNmb3JtO1xyXG4gICAgdGhpcy5vdmVybGFwRW5hYmxlZCA9IGVuYWJsZU92ZXJsYXA7XHJcbiAgICB0aGlzLnBvc2l0aW9uID0gbmV3IFZlY3RvcjIoIDAsIDAgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSAtIG5vZGUgdGhhdCB3aWxsIHJlcHJlc2VudCB0aGlzIHBhcnRpY2xlLCBpbml0aWFsaXplZCBhcmJpdHJhcmlseSwgdXBkYXRlZCBiZWxvd1xyXG4gICAgdGhpcy5jaXJjbGUgPSBuZXcgQ2lyY2xlKCAxICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLmNpcmNsZSApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSB0aGUgYXBwZWFyYW5jZSB3aGVuIHRoZSBwYXJ0aWNsZSBjb25maWd1cmF0aW9uIGNoYW5nZXNcclxuICAgIGNvbnN0IHVwZGF0ZUFwcGVhcmFuY2UgPSAoKSA9PiB7XHJcblxyXG4gICAgICAvLyBjYWxjdWxhdGUgdGhlIHNjYWxlZCByYWRpdXMgb2YgdGhlIGNpcmNsZVxyXG4gICAgICBsZXQgcmFkaXVzSW5WaWV3ID0gcGFydGljbGUucmFkaXVzUHJvcGVydHkudmFsdWUgKiBNVlRfU0NBTEU7XHJcbiAgICAgIGlmICggdGhpcy5vdmVybGFwRW5hYmxlZCApIHtcclxuXHJcbiAgICAgICAgLy8gT3ZlcmxhcCBpcyBlbmFibGVkLCBzbyBtYWtlIHRoZSBzaGFwZSBzbGlnaHRseSBsYXJnZXIgdGhhbiB0aGUgcmFkaXVzIG9mIHRoZSBjaXJjbGUgc28gdGhhdCBvdmVybGFwIHdpbGwgb2NjdXJcclxuICAgICAgICAvLyBkdXJpbmcgaW50ZXItcGFydGljbGUgY29sbGlzaW9ucy5cclxuICAgICAgICByYWRpdXNJblZpZXcgPSByYWRpdXNJblZpZXcgKiBPVkVSTEFQX0VOTEFSR0VNRU5UX0ZBQ1RPUjtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5jaXJjbGUuc2V0UmFkaXVzKCByYWRpdXNJblZpZXcgKTtcclxuICAgICAgdGhpcy5jaXJjbGUuZmlsbCA9IHRoaXMuY3JlYXRlRmlsbCggcGFydGljbGUuY29sb3IsIHBhcnRpY2xlLnJhZGl1c1Byb3BlcnR5LnZhbHVlICk7XHJcbiAgICB9O1xyXG4gICAgcGFydGljbGUucmFkaXVzUHJvcGVydHkubGluayggdXBkYXRlQXBwZWFyYW5jZSApO1xyXG4gICAgcGFydGljbGUuY29uZmlndXJhdGlvbkNoYW5nZWQuYWRkTGlzdGVuZXIoIHVwZGF0ZUFwcGVhcmFuY2UgKTtcclxuXHJcbiAgICAvLyBTZXQgb3Vyc2VsZiB0byBiZSBpbml0aWFsbHkgbm9uLXBpY2thYmxlIHNvIHRoYXQgd2UgZG9uJ3QgZ2V0IG1vdXNlIGV2ZW50cy5cclxuICAgIHRoaXMuc2V0UGlja2FibGUoIGZhbHNlICk7XHJcblxyXG4gICAgdGhpcy51cGRhdGVQb3NpdGlvbigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHVwZGF0ZVBvc2l0aW9uKCkge1xyXG4gICAgaWYgKCB0aGlzLnBhcnRpY2xlICE9PSBudWxsICkge1xyXG4gICAgICB0aGlzLnBvc2l0aW9uID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggdGhpcy5wYXJ0aWNsZS5wb3NpdGlvblByb3BlcnR5LnZhbHVlICk7XHJcbiAgICAgIHRoaXMuc2V0VHJhbnNsYXRpb24oIHRoaXMucG9zaXRpb24gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSB0aGUgZ3JhZGllbnQgZmlsbCBmb3IgdGhpcyBwYXJ0aWNsZS5cclxuICAgKiBAcmV0dXJucyB7UmFkaWFsR3JhZGllbnR9IC0gcGFpbnQgdG8gdXNlIGZvciB0aGlzIHBhcnRpY2xlXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBjcmVhdGVGaWxsKCBiYXNlQ29sb3IsIGF0b21SYWRpdXMgKSB7XHJcbiAgICBjb25zdCBkYXJrZW5lZEJhc2VDb2xvciA9IGJhc2VDb2xvci5jb2xvclV0aWxzRGFya2VyKCAwLjUgKTtcclxuICAgIGNvbnN0IHRyYW5zcGFyZW50RGFya2VuZWRCYXNlZENvbG9yID0gbmV3IENvbG9yKFxyXG4gICAgICBkYXJrZW5lZEJhc2VDb2xvci5nZXRSZWQoKSxcclxuICAgICAgZGFya2VuZWRCYXNlQ29sb3IuZ2V0R3JlZW4oKSxcclxuICAgICAgZGFya2VuZWRCYXNlQ29sb3IuZ2V0Qmx1ZSgpLFxyXG4gICAgICAwLjNcclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgcmFkaXVzID0gKCB0aGlzLm92ZXJsYXBFbmFibGVkID8gKCBhdG9tUmFkaXVzICogT1ZFUkxBUF9FTkxBUkdFTUVOVF9GQUNUT1IgKSA6IGF0b21SYWRpdXMgKSAqIE1WVF9TQ0FMRTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFJhZGlhbEdyYWRpZW50KCAwLCAwLCAwLCAwLCAwLCByYWRpdXMgKVxyXG4gICAgICAuYWRkQ29sb3JTdG9wKCAwLCBiYXNlQ29sb3IgKVxyXG4gICAgICAuYWRkQ29sb3JTdG9wKCAwLjk1LCB0cmFuc3BhcmVudERhcmtlbmVkQmFzZWRDb2xvciApO1xyXG4gIH1cclxufVxyXG5cclxuc3RhdGVzT2ZNYXR0ZXIucmVnaXN0ZXIoICdQYXJ0aWNsZU5vZGUnLCBQYXJ0aWNsZU5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgUGFydGljbGVOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsU0FBU0MsTUFBTSxFQUFFQyxLQUFLLEVBQUVDLElBQUksRUFBRUMsY0FBYyxRQUFRLG1DQUFtQztBQUN2RixPQUFPQyxjQUFjLE1BQU0seUJBQXlCOztBQUVwRDtBQUNBLE1BQU1DLFNBQVMsR0FBRyxJQUFJO0FBQ3RCLE1BQU1DLDBCQUEwQixHQUFHLElBQUk7QUFFdkMsTUFBTUMsWUFBWSxTQUFTTCxJQUFJLENBQUM7RUFFOUI7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRU0sV0FBV0EsQ0FBRUMsUUFBUSxFQUFFQyxrQkFBa0IsRUFBRUMsYUFBYSxFQUFFQyxNQUFNLEVBQUc7SUFDakVDLE1BQU0sSUFBSUEsTUFBTSxDQUFFSixRQUFRLElBQUlDLGtCQUFtQixDQUFDO0lBRWxELEtBQUssQ0FBRTtNQUNMRSxNQUFNLEVBQUVBLE1BQU07TUFDZEUsc0NBQXNDLEVBQUU7SUFDMUMsQ0FBRSxDQUFDOztJQUVIO0lBQ0EsSUFBSSxDQUFDTCxRQUFRLEdBQUdBLFFBQVE7SUFDeEIsSUFBSSxDQUFDQyxrQkFBa0IsR0FBR0Esa0JBQWtCO0lBQzVDLElBQUksQ0FBQ0ssY0FBYyxHQUFHSixhQUFhO0lBQ25DLElBQUksQ0FBQ0ssUUFBUSxHQUFHLElBQUlqQixPQUFPLENBQUUsQ0FBQyxFQUFFLENBQUUsQ0FBQzs7SUFFbkM7SUFDQSxJQUFJLENBQUNrQixNQUFNLEdBQUcsSUFBSWpCLE1BQU0sQ0FBRSxDQUFFLENBQUM7SUFDN0IsSUFBSSxDQUFDa0IsUUFBUSxDQUFFLElBQUksQ0FBQ0QsTUFBTyxDQUFDOztJQUU1QjtJQUNBLE1BQU1FLGdCQUFnQixHQUFHQSxDQUFBLEtBQU07TUFFN0I7TUFDQSxJQUFJQyxZQUFZLEdBQUdYLFFBQVEsQ0FBQ1ksY0FBYyxDQUFDQyxLQUFLLEdBQUdqQixTQUFTO01BQzVELElBQUssSUFBSSxDQUFDVSxjQUFjLEVBQUc7UUFFekI7UUFDQTtRQUNBSyxZQUFZLEdBQUdBLFlBQVksR0FBR2QsMEJBQTBCO01BQzFEO01BRUEsSUFBSSxDQUFDVyxNQUFNLENBQUNNLFNBQVMsQ0FBRUgsWUFBYSxDQUFDO01BQ3JDLElBQUksQ0FBQ0gsTUFBTSxDQUFDTyxJQUFJLEdBQUcsSUFBSSxDQUFDQyxVQUFVLENBQUVoQixRQUFRLENBQUNpQixLQUFLLEVBQUVqQixRQUFRLENBQUNZLGNBQWMsQ0FBQ0MsS0FBTSxDQUFDO0lBQ3JGLENBQUM7SUFDRGIsUUFBUSxDQUFDWSxjQUFjLENBQUNNLElBQUksQ0FBRVIsZ0JBQWlCLENBQUM7SUFDaERWLFFBQVEsQ0FBQ21CLG9CQUFvQixDQUFDQyxXQUFXLENBQUVWLGdCQUFpQixDQUFDOztJQUU3RDtJQUNBLElBQUksQ0FBQ1csV0FBVyxDQUFFLEtBQU0sQ0FBQztJQUV6QixJQUFJLENBQUNDLGNBQWMsQ0FBQyxDQUFDO0VBQ3ZCOztFQUVBO0FBQ0Y7QUFDQTtFQUNFQSxjQUFjQSxDQUFBLEVBQUc7SUFDZixJQUFLLElBQUksQ0FBQ3RCLFFBQVEsS0FBSyxJQUFJLEVBQUc7TUFDNUIsSUFBSSxDQUFDTyxRQUFRLEdBQUcsSUFBSSxDQUFDTixrQkFBa0IsQ0FBQ3NCLG1CQUFtQixDQUFFLElBQUksQ0FBQ3ZCLFFBQVEsQ0FBQ3dCLGdCQUFnQixDQUFDWCxLQUFNLENBQUM7TUFDbkcsSUFBSSxDQUFDWSxjQUFjLENBQUUsSUFBSSxDQUFDbEIsUUFBUyxDQUFDO0lBQ3RDO0VBQ0Y7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNFUyxVQUFVQSxDQUFFVSxTQUFTLEVBQUVDLFVBQVUsRUFBRztJQUNsQyxNQUFNQyxpQkFBaUIsR0FBR0YsU0FBUyxDQUFDRyxnQkFBZ0IsQ0FBRSxHQUFJLENBQUM7SUFDM0QsTUFBTUMsNkJBQTZCLEdBQUcsSUFBSXRDLEtBQUssQ0FDN0NvQyxpQkFBaUIsQ0FBQ0csTUFBTSxDQUFDLENBQUMsRUFDMUJILGlCQUFpQixDQUFDSSxRQUFRLENBQUMsQ0FBQyxFQUM1QkosaUJBQWlCLENBQUNLLE9BQU8sQ0FBQyxDQUFDLEVBQzNCLEdBQ0YsQ0FBQztJQUVELE1BQU1DLE1BQU0sR0FBRyxDQUFFLElBQUksQ0FBQzVCLGNBQWMsR0FBS3FCLFVBQVUsR0FBRzlCLDBCQUEwQixHQUFLOEIsVUFBVSxJQUFLL0IsU0FBUztJQUU3RyxPQUFPLElBQUlGLGNBQWMsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFd0MsTUFBTyxDQUFDLENBQy9DQyxZQUFZLENBQUUsQ0FBQyxFQUFFVCxTQUFVLENBQUMsQ0FDNUJTLFlBQVksQ0FBRSxJQUFJLEVBQUVMLDZCQUE4QixDQUFDO0VBQ3hEO0FBQ0Y7QUFFQW5DLGNBQWMsQ0FBQ3lDLFFBQVEsQ0FBRSxjQUFjLEVBQUV0QyxZQUFhLENBQUM7QUFDdkQsZUFBZUEsWUFBWSJ9