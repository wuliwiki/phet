// Copyright 2015-2022, University of Colorado Boulder

/**
 * This extension of the ParticleNode class allows users to grab the node and move it, thus changing the position
 * within the underlying model.
 *
 * @author Siddhartha Chinthapally (Actual Concepts)
 * @author John Blanco
 */

import { DragListener } from '../../../../scenery/js/imports.js';
import statesOfMatter from '../../statesOfMatter.js';
import ParticleForceNode from './ParticleForceNode.js';
class GrabbableParticleNode extends ParticleForceNode {
  /**
   * @param {DualAtomModel} dualAtomModel - model of the simulation
   * @param {ScaledAtom} particle
   * @param {ModelViewTransform2} modelViewTransform to convert between model and view co-ordinates
   * @param {boolean} enableOverlap - true if the node should be larger than the actual particle, thus allowing particles
   * @param {number} minX - grabbable particle  min x position
   * @param {Tandem} tandem - support for exporting instances from the sim
   */
  constructor(dualAtomModel, particle, modelViewTransform, enableOverlap, minX, tandem) {
    super(particle, modelViewTransform, enableOverlap, tandem);

    // @private
    this.minX = minX;

    // This node will need to be pickable so the user can grab it.
    this.setPickable(true);

    // Put a cursor handler into place.
    this.cursor = 'pointer';
    let startDragX;
    let endDragX;
    let initialStartX = this.x;
    const inputListener = new DragListener({
      allowTouchSnag: true,
      start: event => {
        // Stop the model from moving the particle at the same time the user is moving it.
        dualAtomModel.setMotionPaused(true);
        initialStartX = this.x;
        startDragX = this.globalToParentPoint(event.pointer.point).x;
      },
      drag: event => {
        endDragX = this.globalToParentPoint(event.pointer.point).x;
        const d = endDragX - startDragX;

        // Make sure we don't exceed the positional limits.
        const newPosX = Math.max(initialStartX + d, this.minX);

        // Move the particle based on the amount of mouse movement.
        this.particle.setPosition(modelViewTransform.viewToModelX(newPosX), particle.positionProperty.value.y);
      },
      end: () => {
        // Let the model move the particles again.  Note that this happens even if the motion was paused by some other
        // means.
        dualAtomModel.setMotionPaused(false);
        dualAtomModel.movementHintVisibleProperty.set(false);
      },
      tandem: tandem.createTandem('dragListener')
    });
    this.addInputListener(inputListener);

    // dispose function
    this.disposeGrabbableParticleNode = () => {
      this.removeInputListener(inputListener);
    };
  }

  /**
   * @public
   */
  dispose() {
    this.disposeGrabbableParticleNode();
    super.dispose();
  }

  /**
   * @returns {number}
   * @public
   */
  getMinX() {
    return this.minX;
  }

  /**
   * @param {number} minX - min x position
   * @public
   */
  setMinX(minX) {
    this.minX = minX;
  }
}
statesOfMatter.register('GrabbableParticleNode', GrabbableParticleNode);
export default GrabbableParticleNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEcmFnTGlzdGVuZXIiLCJzdGF0ZXNPZk1hdHRlciIsIlBhcnRpY2xlRm9yY2VOb2RlIiwiR3JhYmJhYmxlUGFydGljbGVOb2RlIiwiY29uc3RydWN0b3IiLCJkdWFsQXRvbU1vZGVsIiwicGFydGljbGUiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJlbmFibGVPdmVybGFwIiwibWluWCIsInRhbmRlbSIsInNldFBpY2thYmxlIiwiY3Vyc29yIiwic3RhcnREcmFnWCIsImVuZERyYWdYIiwiaW5pdGlhbFN0YXJ0WCIsIngiLCJpbnB1dExpc3RlbmVyIiwiYWxsb3dUb3VjaFNuYWciLCJzdGFydCIsImV2ZW50Iiwic2V0TW90aW9uUGF1c2VkIiwiZ2xvYmFsVG9QYXJlbnRQb2ludCIsInBvaW50ZXIiLCJwb2ludCIsImRyYWciLCJkIiwibmV3UG9zWCIsIk1hdGgiLCJtYXgiLCJzZXRQb3NpdGlvbiIsInZpZXdUb01vZGVsWCIsInBvc2l0aW9uUHJvcGVydHkiLCJ2YWx1ZSIsInkiLCJlbmQiLCJtb3ZlbWVudEhpbnRWaXNpYmxlUHJvcGVydHkiLCJzZXQiLCJjcmVhdGVUYW5kZW0iLCJhZGRJbnB1dExpc3RlbmVyIiwiZGlzcG9zZUdyYWJiYWJsZVBhcnRpY2xlTm9kZSIsInJlbW92ZUlucHV0TGlzdGVuZXIiLCJkaXNwb3NlIiwiZ2V0TWluWCIsInNldE1pblgiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkdyYWJiYWJsZVBhcnRpY2xlTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBUaGlzIGV4dGVuc2lvbiBvZiB0aGUgUGFydGljbGVOb2RlIGNsYXNzIGFsbG93cyB1c2VycyB0byBncmFiIHRoZSBub2RlIGFuZCBtb3ZlIGl0LCB0aHVzIGNoYW5naW5nIHRoZSBwb3NpdGlvblxyXG4gKiB3aXRoaW4gdGhlIHVuZGVybHlpbmcgbW9kZWwuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2lkZGhhcnRoYSBDaGludGhhcGFsbHkgKEFjdHVhbCBDb25jZXB0cylcclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKi9cclxuXHJcbmltcG9ydCB7IERyYWdMaXN0ZW5lciB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBzdGF0ZXNPZk1hdHRlciBmcm9tICcuLi8uLi9zdGF0ZXNPZk1hdHRlci5qcyc7XHJcbmltcG9ydCBQYXJ0aWNsZUZvcmNlTm9kZSBmcm9tICcuL1BhcnRpY2xlRm9yY2VOb2RlLmpzJztcclxuXHJcbmNsYXNzIEdyYWJiYWJsZVBhcnRpY2xlTm9kZSBleHRlbmRzIFBhcnRpY2xlRm9yY2VOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtEdWFsQXRvbU1vZGVsfSBkdWFsQXRvbU1vZGVsIC0gbW9kZWwgb2YgdGhlIHNpbXVsYXRpb25cclxuICAgKiBAcGFyYW0ge1NjYWxlZEF0b219IHBhcnRpY2xlXHJcbiAgICogQHBhcmFtIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfSBtb2RlbFZpZXdUcmFuc2Zvcm0gdG8gY29udmVydCBiZXR3ZWVuIG1vZGVsIGFuZCB2aWV3IGNvLW9yZGluYXRlc1xyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gZW5hYmxlT3ZlcmxhcCAtIHRydWUgaWYgdGhlIG5vZGUgc2hvdWxkIGJlIGxhcmdlciB0aGFuIHRoZSBhY3R1YWwgcGFydGljbGUsIHRodXMgYWxsb3dpbmcgcGFydGljbGVzXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IG1pblggLSBncmFiYmFibGUgcGFydGljbGUgIG1pbiB4IHBvc2l0aW9uXHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbSAtIHN1cHBvcnQgZm9yIGV4cG9ydGluZyBpbnN0YW5jZXMgZnJvbSB0aGUgc2ltXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGR1YWxBdG9tTW9kZWwsIHBhcnRpY2xlLCBtb2RlbFZpZXdUcmFuc2Zvcm0sIGVuYWJsZU92ZXJsYXAsIG1pblgsIHRhbmRlbSApIHtcclxuXHJcbiAgICBzdXBlciggcGFydGljbGUsIG1vZGVsVmlld1RyYW5zZm9ybSwgZW5hYmxlT3ZlcmxhcCwgdGFuZGVtICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMubWluWCA9IG1pblg7XHJcblxyXG4gICAgLy8gVGhpcyBub2RlIHdpbGwgbmVlZCB0byBiZSBwaWNrYWJsZSBzbyB0aGUgdXNlciBjYW4gZ3JhYiBpdC5cclxuICAgIHRoaXMuc2V0UGlja2FibGUoIHRydWUgKTtcclxuXHJcbiAgICAvLyBQdXQgYSBjdXJzb3IgaGFuZGxlciBpbnRvIHBsYWNlLlxyXG4gICAgdGhpcy5jdXJzb3IgPSAncG9pbnRlcic7XHJcblxyXG4gICAgbGV0IHN0YXJ0RHJhZ1g7XHJcbiAgICBsZXQgZW5kRHJhZ1g7XHJcbiAgICBsZXQgaW5pdGlhbFN0YXJ0WCA9IHRoaXMueDtcclxuXHJcbiAgICBjb25zdCBpbnB1dExpc3RlbmVyID0gbmV3IERyYWdMaXN0ZW5lcigge1xyXG4gICAgICBhbGxvd1RvdWNoU25hZzogdHJ1ZSxcclxuXHJcbiAgICAgIHN0YXJ0OiBldmVudCA9PiB7XHJcblxyXG4gICAgICAgIC8vIFN0b3AgdGhlIG1vZGVsIGZyb20gbW92aW5nIHRoZSBwYXJ0aWNsZSBhdCB0aGUgc2FtZSB0aW1lIHRoZSB1c2VyIGlzIG1vdmluZyBpdC5cclxuICAgICAgICBkdWFsQXRvbU1vZGVsLnNldE1vdGlvblBhdXNlZCggdHJ1ZSApO1xyXG4gICAgICAgIGluaXRpYWxTdGFydFggPSB0aGlzLng7XHJcbiAgICAgICAgc3RhcnREcmFnWCA9IHRoaXMuZ2xvYmFsVG9QYXJlbnRQb2ludCggZXZlbnQucG9pbnRlci5wb2ludCApLng7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBkcmFnOiBldmVudCA9PiB7XHJcblxyXG4gICAgICAgIGVuZERyYWdYID0gdGhpcy5nbG9iYWxUb1BhcmVudFBvaW50KCBldmVudC5wb2ludGVyLnBvaW50ICkueDtcclxuICAgICAgICBjb25zdCBkID0gZW5kRHJhZ1ggLSBzdGFydERyYWdYO1xyXG5cclxuICAgICAgICAvLyBNYWtlIHN1cmUgd2UgZG9uJ3QgZXhjZWVkIHRoZSBwb3NpdGlvbmFsIGxpbWl0cy5cclxuICAgICAgICBjb25zdCBuZXdQb3NYID0gTWF0aC5tYXgoIGluaXRpYWxTdGFydFggKyBkLCB0aGlzLm1pblggKTtcclxuXHJcbiAgICAgICAgLy8gTW92ZSB0aGUgcGFydGljbGUgYmFzZWQgb24gdGhlIGFtb3VudCBvZiBtb3VzZSBtb3ZlbWVudC5cclxuICAgICAgICB0aGlzLnBhcnRpY2xlLnNldFBvc2l0aW9uKCBtb2RlbFZpZXdUcmFuc2Zvcm0udmlld1RvTW9kZWxYKCBuZXdQb3NYICksIHBhcnRpY2xlLnBvc2l0aW9uUHJvcGVydHkudmFsdWUueSApO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgZW5kOiAoKSA9PiB7XHJcblxyXG4gICAgICAgIC8vIExldCB0aGUgbW9kZWwgbW92ZSB0aGUgcGFydGljbGVzIGFnYWluLiAgTm90ZSB0aGF0IHRoaXMgaGFwcGVucyBldmVuIGlmIHRoZSBtb3Rpb24gd2FzIHBhdXNlZCBieSBzb21lIG90aGVyXHJcbiAgICAgICAgLy8gbWVhbnMuXHJcbiAgICAgICAgZHVhbEF0b21Nb2RlbC5zZXRNb3Rpb25QYXVzZWQoIGZhbHNlICk7XHJcbiAgICAgICAgZHVhbEF0b21Nb2RlbC5tb3ZlbWVudEhpbnRWaXNpYmxlUHJvcGVydHkuc2V0KCBmYWxzZSApO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZHJhZ0xpc3RlbmVyJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5hZGRJbnB1dExpc3RlbmVyKCBpbnB1dExpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gZGlzcG9zZSBmdW5jdGlvblxyXG4gICAgdGhpcy5kaXNwb3NlR3JhYmJhYmxlUGFydGljbGVOb2RlID0gKCkgPT4ge1xyXG4gICAgICB0aGlzLnJlbW92ZUlucHV0TGlzdGVuZXIoIGlucHV0TGlzdGVuZXIgKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIHRoaXMuZGlzcG9zZUdyYWJiYWJsZVBhcnRpY2xlTm9kZSgpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHJldHVybnMge251bWJlcn1cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZ2V0TWluWCgpIHtcclxuICAgIHJldHVybiB0aGlzLm1pblg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge251bWJlcn0gbWluWCAtIG1pbiB4IHBvc2l0aW9uXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHNldE1pblgoIG1pblggKSB7XHJcbiAgICB0aGlzLm1pblggPSBtaW5YO1xyXG4gIH1cclxufVxyXG5cclxuc3RhdGVzT2ZNYXR0ZXIucmVnaXN0ZXIoICdHcmFiYmFibGVQYXJ0aWNsZU5vZGUnLCBHcmFiYmFibGVQYXJ0aWNsZU5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgR3JhYmJhYmxlUGFydGljbGVOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBU0EsWUFBWSxRQUFRLG1DQUFtQztBQUNoRSxPQUFPQyxjQUFjLE1BQU0seUJBQXlCO0FBQ3BELE9BQU9DLGlCQUFpQixNQUFNLHdCQUF3QjtBQUV0RCxNQUFNQyxxQkFBcUIsU0FBU0QsaUJBQWlCLENBQUM7RUFFcEQ7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFRSxXQUFXQSxDQUFFQyxhQUFhLEVBQUVDLFFBQVEsRUFBRUMsa0JBQWtCLEVBQUVDLGFBQWEsRUFBRUMsSUFBSSxFQUFF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