// Copyright 2020-2021, University of Colorado Boulder

/**
 * PhaseChangesModel is a multiple particle model that adds some additional items specific to the "PhaseChanges" screen.
 */

import BooleanProperty from '../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import NumberProperty from '../../../axon/js/NumberProperty.js';
import Range from '../../../dot/js/Range.js';
import Utils from '../../../dot/js/Utils.js';
import AtomType from '../common/model/AtomType.js';
import InteractionStrengthTable from '../common/model/InteractionStrengthTable.js';
import MultipleParticleModel from '../common/model/MultipleParticleModel.js';
import SOMConstants from '../common/SOMConstants.js';
import SubstanceType from '../common/SubstanceType.js';
import statesOfMatter from '../statesOfMatter.js';

// --------------------------------------------------------------------------------------------------------------------
// constants
// --------------------------------------------------------------------------------------------------------------------
const MIN_ALLOWABLE_CONTAINER_HEIGHT = 1500; // empirically determined, almost all the way to the bottom
const MAX_CONTAINER_SHRINK_RATE = 1250; // in model units per second

// Min a max values for adjustable epsilon.  Originally there was a wider allowable range, but the simulation did not
// work so well, so the range below was arrived at empirically and seems to work reasonably well.
const MIN_ADJUSTABLE_EPSILON = SOMConstants.MIN_ADJUSTABLE_EPSILON;
const MAX_ADJUSTABLE_EPSILON = SOMConstants.MAX_ADJUSTABLE_EPSILON;

// constant table of the sigma values used in the LJ potential calculations for the various substances used in the sim
// Note: Can't used Map constructor due to lack of support in IE
const SIGMA_TABLE = new Map();
SIGMA_TABLE.set(SubstanceType.NEON, SOMConstants.NEON_RADIUS * 2);
SIGMA_TABLE.set(SubstanceType.ARGON, SOMConstants.ARGON_RADIUS * 2);
SIGMA_TABLE.set(SubstanceType.DIATOMIC_OXYGEN, SOMConstants.SIGMA_FOR_DIATOMIC_OXYGEN);
SIGMA_TABLE.set(SubstanceType.WATER, SOMConstants.SIGMA_FOR_WATER);
SIGMA_TABLE.set(SubstanceType.ADJUSTABLE_ATOM, SOMConstants.ADJUSTABLE_ATTRACTION_DEFAULT_RADIUS * 2);

// constant table of the epsilon values used in the LJ potential calculations for the various substances used in the sim
const EPSILON_TABLE = new Map();
EPSILON_TABLE.set(SubstanceType.NEON, InteractionStrengthTable.getInteractionPotential(AtomType.NEON, AtomType.NEON));
EPSILON_TABLE.set(SubstanceType.ARGON, InteractionStrengthTable.getInteractionPotential(AtomType.ARGON, AtomType.ARGON));
EPSILON_TABLE.set(SubstanceType.DIATOMIC_OXYGEN, SOMConstants.EPSILON_FOR_DIATOMIC_OXYGEN);
EPSILON_TABLE.set(SubstanceType.WATER, SOMConstants.EPSILON_FOR_WATER);
class PhaseChangesModel extends MultipleParticleModel {
  /**
   * @param {Tandem} tandem
   */
  constructor(tandem) {
    super(tandem);

    // @public (read-write)
    this.phaseDiagramExpandedProperty = new BooleanProperty(true, {
      tandem: tandem.createTandem('phaseDiagramExpandedProperty')
    });

    // @public (read-write)
    this.interactionPotentialExpandedProperty = new BooleanProperty(true, {
      tandem: tandem.createTandem('interactionPotentialExpandedProperty')
    });

    // @public (read-write) - interaction strength of the adjustable attraction atoms
    this.adjustableAtomInteractionStrengthProperty = new NumberProperty(MAX_ADJUSTABLE_EPSILON, {
      tandem: tandem.createTandem('adjustableAtomInteractionStrengthProperty'),
      range: new Range(MIN_ADJUSTABLE_EPSILON, MAX_ADJUSTABLE_EPSILON),
      phetioDocumentation: 'intermolecular potential for the "Adjustable Attraction" atoms - this is a parameter in the Lennard-Jones potential equation'
    });

    // @public (read-write)
    this.targetContainerHeightProperty = new NumberProperty(MultipleParticleModel.PARTICLE_CONTAINER_INITIAL_HEIGHT, {
      tandem: tandem.createTandem('targetContainerHeightProperty'),
      range: new Range(MIN_ALLOWABLE_CONTAINER_HEIGHT, MultipleParticleModel.PARTICLE_CONTAINER_INITIAL_HEIGHT)
    });

    // @public (read-only) - a derived property that indicates whether the lid is higher than the injection point
    this.lidAboveInjectionPointProperty = new DerivedProperty([this.containerHeightProperty], containerHeight => {
      // This may appear a little suspect, but the model is designed such that the container height is always reset
      // to its max when the particle diameter and injection change, so this can be trusted.
      return containerHeight / this.particleDiameter > this.injectionPoint.y;
    });

    // Reset the target container height in the event of an explosion.
    this.isExplodedProperty.lazyLink(isExploded => {
      if (isExploded) {
        this.targetContainerHeightProperty.reset();
      }
    });

    // Reset the target container height when the substance changes.
    this.substanceProperty.lazyLink(() => {
      this.targetContainerHeightProperty.reset();
    });

    // @private - This flag is used to avoid problems when the superconstructor calls the overrides in this subclass
    // before the subclass-specific properties have been added.
    this.phaseChangeModelConstructed = true;
  }

  /**
   * Get the sigma value, which is one of the two parameters that describes the Lennard-Jones potential.
   * @returns {number}
   * @public
   */
  getSigma() {
    return SIGMA_TABLE.get(this.substanceProperty.value);
  }

  /**
   * Get the epsilon value, which is one of the two parameters that describes the Lennard-Jones potential.
   * @returns {number}
   * @public
   */
  getEpsilon() {
    const substance = this.substanceProperty.value;
    let epsilon;
    if (substance === SubstanceType.ADJUSTABLE_ATOM) {
      epsilon = this.adjustableAtomInteractionStrengthProperty.value;
    } else {
      epsilon = EPSILON_TABLE.get(substance);
    }
    return epsilon;
  }

  /**
   * @param {number} epsilon
   * @public
   */
  setEpsilon(epsilon) {
    if (this.substanceProperty.get() === SubstanceType.ADJUSTABLE_ATOM) {
      this.moleculeForceAndMotionCalculator.setScaledEpsilon(convertEpsilonToScaledEpsilon(Utils.clamp(epsilon, MIN_ADJUSTABLE_EPSILON, MAX_ADJUSTABLE_EPSILON)));
    } else {
      assert && assert(false, 'Error: Epsilon cannot be set when non-configurable molecule is in use.');
    }
  }

  /**
   * handler that sets up the various portions of the model to support the newly selected substance
   * @param {SubstanceType} substance
   * @protected
   * @override
   */
  handleSubstanceChanged(substance) {
    // reset the target container height whenever the substance changes
    this.targetContainerHeightProperty && this.targetContainerHeightProperty.reset();

    // base class does most of the heavy lifting on this
    super.handleSubstanceChanged(substance);

    // If the adjustable atom has been selected, set the epsilon value of the LJ potential to be based on the previously
    // set interaction strength.
    if (substance === SubstanceType.ADJUSTABLE_ATOM) {
      this.setEpsilon(this.adjustableAtomInteractionStrengthProperty.value);
    }
  }

  /**
   * Sets the target height of the container.  The target height is set rather than the actual height because the
   * model limits the rate at which the height can changed.  The model will gradually move towards the target height.
   * @param {number} desiredContainerHeight
   * @public
   */
  setTargetContainerHeight(desiredContainerHeight) {
    this.targetContainerHeightProperty.set(Utils.clamp(desiredContainerHeight, MIN_ALLOWABLE_CONTAINER_HEIGHT, MultipleParticleModel.PARTICLE_CONTAINER_INITIAL_HEIGHT));
  }

  /**
   * @protected
   * @override
   */
  updateContainerSize(dt) {
    if (!this.phaseChangeModelConstructed || this.isExplodedProperty.value || this.targetContainerHeightProperty.value === this.containerHeightProperty.value) {
      // in this case, the super makes the needed adjustments
      super.updateContainerSize(dt);
    } else if (this.targetContainerHeightProperty.value !== this.containerHeightProperty.value) {
      this.heightChangeThisStep = this.targetContainerHeightProperty.get() - this.containerHeightProperty.get();
      if (this.heightChangeThisStep > 0) {
        // the container is expanding, limit the change to the max allowed rate
        this.heightChangeThisStep = Math.min(this.heightChangeThisStep, MultipleParticleModel.MAX_CONTAINER_EXPAND_RATE * dt);
        this.containerHeightProperty.set(Math.min(this.containerHeightProperty.get() + this.heightChangeThisStep, MultipleParticleModel.PARTICLE_CONTAINER_INITIAL_HEIGHT));
      } else {
        // the container is shrinking, limit the change to the max allowed rate
        this.heightChangeThisStep = Math.max(this.heightChangeThisStep, -MAX_CONTAINER_SHRINK_RATE * dt);
        this.containerHeightProperty.set(Math.max(this.containerHeightProperty.get() + this.heightChangeThisStep, MIN_ALLOWABLE_CONTAINER_HEIGHT));
      }
      this.normalizedContainerHeight = this.containerHeightProperty.get() / this.particleDiameter;
      this.normalizedLidVelocityY = this.heightChangeThisStep / this.particleDiameter / dt;
    }
  }

  /**
   * @public
   */
  reset() {
    super.reset();
    this.targetContainerHeightProperty.reset();
    this.adjustableAtomInteractionStrengthProperty.reset();
    this.phaseDiagramExpandedProperty.reset();
    this.interactionPotentialExpandedProperty.reset();
  }
}

// helper function - The following conversion of the target value for epsilon to a scaled value for the motion
// calculator object was determined empirically such that the resulting behavior roughly matched that of the existing
// monatomic molecules.
const convertEpsilonToScaledEpsilon = epsilon => epsilon / (SOMConstants.MAX_EPSILON / 2);

// static constants
PhaseChangesModel.MAX_ADJUSTABLE_EPSILON = MAX_ADJUSTABLE_EPSILON;
statesOfMatter.register('PhaseChangesModel', PhaseChangesModel);
export default PhaseChangesModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIlJhbmdlIiwiVXRpbHMiLCJBdG9tVHlwZSIsIkludGVyYWN0aW9uU3RyZW5ndGhUYWJsZSIsIk11bHRpcGxlUGFydGljbGVNb2RlbCIsIlNPTUNvbnN0YW50cyIsIlN1YnN0YW5jZVR5cGUiLCJzdGF0ZXNPZk1hdHRlciIsIk1JTl9BTExPV0FCTEVfQ09OVEFJTkVSX0hFSUdIVCIsIk1BWF9DT05UQUlORVJfU0hSSU5LX1JBVEUiLCJNSU5fQURKVVNUQUJMRV9FUFNJTE9OIiwiTUFYX0FESlVTVEFCTEVfRVBTSUxPTiIsIlNJR01BX1RBQkxFIiwiTWFwIiwic2V0IiwiTkVPTiIsIk5FT05fUkFESVVTIiwiQVJHT04iLCJBUkdPTl9SQURJVVMiLCJESUFUT01JQ19PWFlHRU4iLCJTSUdNQV9GT1JfRElBVE9NSUNfT1hZR0VOIiwiV0FURVIiLCJTSUdNQV9GT1JfV0FURVIiLCJBREpVU1RBQkxFX0FUT00iLCJBREpVU1RBQkxFX0FUVFJBQ1RJT05fREVGQVVMVF9SQURJVVMiLCJFUFNJTE9OX1RBQkxFIiwiZ2V0SW50ZXJhY3Rpb25Qb3RlbnRpYWwiLCJFUFNJTE9OX0ZPUl9ESUFUT01JQ19PWFlHRU4iLCJFUFNJTE9OX0ZPUl9XQVRFUiIsIlBoYXNlQ2hhbmdlc01vZGVsIiwiY29uc3RydWN0b3IiLCJ0YW5kZW0iLCJwaGFzZURpYWdyYW1FeHBhbmRlZFByb3BlcnR5IiwiY3JlYXRlVGFuZGVtIiwiaW50ZXJhY3Rpb25Qb3RlbnRpYWxFeHBhbmRlZFByb3BlcnR5IiwiYWRqdXN0YWJsZUF0b21JbnRlcmFjdGlvblN0cmVuZ3RoUHJvcGVydHkiLCJyYW5nZSIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJ0YXJnZXRDb250YWluZXJIZWlnaHRQcm9wZXJ0eSIsIlBBUlRJQ0xFX0NPTlRBSU5FUl9JTklUSUFMX0hFSUdIVCIsImxpZEFib3ZlSW5qZWN0aW9uUG9pbnRQcm9wZXJ0eSIsImNvbnRhaW5lckhlaWdodFByb3BlcnR5IiwiY29udGFpbmVySGVpZ2h0IiwicGFydGljbGVEaWFtZXRlciIsImluamVjdGlvblBvaW50IiwieSIsImlzRXhwbG9kZWRQcm9wZXJ0eSIsImxhenlMaW5rIiwiaXNFeHBsb2RlZCIsInJlc2V0Iiwic3Vic3RhbmNlUHJvcGVydHkiLCJwaGFzZUNoYW5nZU1vZGVsQ29uc3RydWN0ZWQiLCJnZXRTaWdtYSIsImdldCIsInZhbHVlIiwiZ2V0RXBzaWxvbiIsInN1YnN0YW5jZSIsImVwc2lsb24iLCJzZXRFcHNpbG9uIiwibW9sZWN1bGVGb3JjZUFuZE1vdGlvbkNhbGN1bGF0b3IiLCJzZXRTY2FsZWRFcHNpbG9uIiwiY29udmVydEVwc2lsb25Ub1NjYWxlZEVwc2lsb24iLCJjbGFtcCIsImFzc2VydCIsImhhbmRsZVN1YnN0YW5jZUNoYW5nZWQiLCJzZXRUYXJnZXRDb250YWluZXJIZWlnaHQiLCJkZXNpcmVkQ29udGFpbmVySGVpZ2h0IiwidXBkYXRlQ29udGFpbmVyU2l6ZSIsImR0IiwiaGVpZ2h0Q2hhbmdlVGhpc1N0ZXAiLCJNYXRoIiwibWluIiwiTUFYX0NPTlRBSU5FUl9FWFBBTkRfUkFURSIsIm1heCIsIm5vcm1hbGl6ZWRDb250YWluZXJIZWlnaHQiLCJub3JtYWxpemVkTGlkVmVsb2NpdHlZIiwiTUFYX0VQU0lMT04iLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlBoYXNlQ2hhbmdlc01vZGVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIwLTIwMjEsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFBoYXNlQ2hhbmdlc01vZGVsIGlzIGEgbXVsdGlwbGUgcGFydGljbGUgbW9kZWwgdGhhdCBhZGRzIHNvbWUgYWRkaXRpb25hbCBpdGVtcyBzcGVjaWZpYyB0byB0aGUgXCJQaGFzZUNoYW5nZXNcIiBzY3JlZW4uXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IEF0b21UeXBlIGZyb20gJy4uL2NvbW1vbi9tb2RlbC9BdG9tVHlwZS5qcyc7XHJcbmltcG9ydCBJbnRlcmFjdGlvblN0cmVuZ3RoVGFibGUgZnJvbSAnLi4vY29tbW9uL21vZGVsL0ludGVyYWN0aW9uU3RyZW5ndGhUYWJsZS5qcyc7XHJcbmltcG9ydCBNdWx0aXBsZVBhcnRpY2xlTW9kZWwgZnJvbSAnLi4vY29tbW9uL21vZGVsL011bHRpcGxlUGFydGljbGVNb2RlbC5qcyc7XHJcbmltcG9ydCBTT01Db25zdGFudHMgZnJvbSAnLi4vY29tbW9uL1NPTUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBTdWJzdGFuY2VUeXBlIGZyb20gJy4uL2NvbW1vbi9TdWJzdGFuY2VUeXBlLmpzJztcclxuaW1wb3J0IHN0YXRlc09mTWF0dGVyIGZyb20gJy4uL3N0YXRlc09mTWF0dGVyLmpzJztcclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vIGNvbnN0YW50c1xyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5jb25zdCBNSU5fQUxMT1dBQkxFX0NPTlRBSU5FUl9IRUlHSFQgPSAxNTAwOyAvLyBlbXBpcmljYWxseSBkZXRlcm1pbmVkLCBhbG1vc3QgYWxsIHRoZSB3YXkgdG8gdGhlIGJvdHRvbVxyXG5jb25zdCBNQVhfQ09OVEFJTkVSX1NIUklOS19SQVRFID0gMTI1MDsgLy8gaW4gbW9kZWwgdW5pdHMgcGVyIHNlY29uZFxyXG5cclxuLy8gTWluIGEgbWF4IHZhbHVlcyBmb3IgYWRqdXN0YWJsZSBlcHNpbG9uLiAgT3JpZ2luYWxseSB0aGVyZSB3YXMgYSB3aWRlciBhbGxvd2FibGUgcmFuZ2UsIGJ1dCB0aGUgc2ltdWxhdGlvbiBkaWQgbm90XHJcbi8vIHdvcmsgc28gd2VsbCwgc28gdGhlIHJhbmdlIGJlbG93IHdhcyBhcnJpdmVkIGF0IGVtcGlyaWNhbGx5IGFuZCBzZWVtcyB0byB3b3JrIHJlYXNvbmFibHkgd2VsbC5cclxuY29uc3QgTUlOX0FESlVTVEFCTEVfRVBTSUxPTiA9IFNPTUNvbnN0YW50cy5NSU5fQURKVVNUQUJMRV9FUFNJTE9OO1xyXG5jb25zdCBNQVhfQURKVVNUQUJMRV9FUFNJTE9OID0gU09NQ29uc3RhbnRzLk1BWF9BREpVU1RBQkxFX0VQU0lMT047XHJcblxyXG4vLyBjb25zdGFudCB0YWJsZSBvZiB0aGUgc2lnbWEgdmFsdWVzIHVzZWQgaW4gdGhlIExKIHBvdGVudGlhbCBjYWxjdWxhdGlvbnMgZm9yIHRoZSB2YXJpb3VzIHN1YnN0YW5jZXMgdXNlZCBpbiB0aGUgc2ltXHJcbi8vIE5vdGU6IENhbid0IHVzZWQgTWFwIGNvbnN0cnVjdG9yIGR1ZSB0byBsYWNrIG9mIHN1cHBvcnQgaW4gSUVcclxuY29uc3QgU0lHTUFfVEFCTEUgPSBuZXcgTWFwKCk7XHJcblNJR01BX1RBQkxFLnNldCggU3Vic3RhbmNlVHlwZS5ORU9OLCBTT01Db25zdGFudHMuTkVPTl9SQURJVVMgKiAyICk7XHJcblNJR01BX1RBQkxFLnNldCggU3Vic3RhbmNlVHlwZS5BUkdPTiwgU09NQ29uc3RhbnRzLkFSR09OX1JBRElVUyAqIDIgKTtcclxuU0lHTUFfVEFCTEUuc2V0KCBTdWJzdGFuY2VUeXBlLkRJQVRPTUlDX09YWUdFTiwgU09NQ29uc3RhbnRzLlNJR01BX0ZPUl9ESUFUT01JQ19PWFlHRU4gKTtcclxuU0lHTUFfVEFCTEUuc2V0KCBTdWJzdGFuY2VUeXBlLldBVEVSLCBTT01Db25zdGFudHMuU0lHTUFfRk9SX1dBVEVSICk7XHJcblNJR01BX1RBQkxFLnNldCggU3Vic3RhbmNlVHlwZS5BREpVU1RBQkxFX0FUT00sIFNPTUNvbnN0YW50cy5BREpVU1RBQkxFX0FUVFJBQ1RJT05fREVGQVVMVF9SQURJVVMgKiAyICk7XHJcblxyXG4vLyBjb25zdGFudCB0YWJsZSBvZiB0aGUgZXBzaWxvbiB2YWx1ZXMgdXNlZCBpbiB0aGUgTEogcG90ZW50aWFsIGNhbGN1bGF0aW9ucyBmb3IgdGhlIHZhcmlvdXMgc3Vic3RhbmNlcyB1c2VkIGluIHRoZSBzaW1cclxuY29uc3QgRVBTSUxPTl9UQUJMRSA9IG5ldyBNYXAoKTtcclxuRVBTSUxPTl9UQUJMRS5zZXQoIFN1YnN0YW5jZVR5cGUuTkVPTiwgSW50ZXJhY3Rpb25TdHJlbmd0aFRhYmxlLmdldEludGVyYWN0aW9uUG90ZW50aWFsKCBBdG9tVHlwZS5ORU9OLCBBdG9tVHlwZS5ORU9OICkgKTtcclxuRVBTSUxPTl9UQUJMRS5zZXQoIFN1YnN0YW5jZVR5cGUuQVJHT04sIEludGVyYWN0aW9uU3RyZW5ndGhUYWJsZS5nZXRJbnRlcmFjdGlvblBvdGVudGlhbCggQXRvbVR5cGUuQVJHT04sIEF0b21UeXBlLkFSR09OICkgKTtcclxuRVBTSUxPTl9UQUJMRS5zZXQoIFN1YnN0YW5jZVR5cGUuRElBVE9NSUNfT1hZR0VOLCBTT01Db25zdGFudHMuRVBTSUxPTl9GT1JfRElBVE9NSUNfT1hZR0VOICk7XHJcbkVQU0lMT05fVEFCTEUuc2V0KCBTdWJzdGFuY2VUeXBlLldBVEVSLCBTT01Db25zdGFudHMuRVBTSUxPTl9GT1JfV0FURVIgKTtcclxuXHJcbmNsYXNzIFBoYXNlQ2hhbmdlc01vZGVsIGV4dGVuZHMgTXVsdGlwbGVQYXJ0aWNsZU1vZGVsIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCB0YW5kZW0gKSB7XHJcblxyXG4gICAgc3VwZXIoIHRhbmRlbSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMgKHJlYWQtd3JpdGUpXHJcbiAgICB0aGlzLnBoYXNlRGlhZ3JhbUV4cGFuZGVkUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3BoYXNlRGlhZ3JhbUV4cGFuZGVkUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLXdyaXRlKVxyXG4gICAgdGhpcy5pbnRlcmFjdGlvblBvdGVudGlhbEV4cGFuZGVkUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2ludGVyYWN0aW9uUG90ZW50aWFsRXhwYW5kZWRQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMgKHJlYWQtd3JpdGUpIC0gaW50ZXJhY3Rpb24gc3RyZW5ndGggb2YgdGhlIGFkanVzdGFibGUgYXR0cmFjdGlvbiBhdG9tc1xyXG4gICAgdGhpcy5hZGp1c3RhYmxlQXRvbUludGVyYWN0aW9uU3RyZW5ndGhQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggTUFYX0FESlVTVEFCTEVfRVBTSUxPTiwge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdhZGp1c3RhYmxlQXRvbUludGVyYWN0aW9uU3RyZW5ndGhQcm9wZXJ0eScgKSxcclxuICAgICAgcmFuZ2U6IG5ldyBSYW5nZSggTUlOX0FESlVTVEFCTEVfRVBTSUxPTiwgTUFYX0FESlVTVEFCTEVfRVBTSUxPTiApLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnaW50ZXJtb2xlY3VsYXIgcG90ZW50aWFsIGZvciB0aGUgXCJBZGp1c3RhYmxlIEF0dHJhY3Rpb25cIiBhdG9tcyAtIHRoaXMgaXMgYSBwYXJhbWV0ZXIgaW4gdGhlIExlbm5hcmQtSm9uZXMgcG90ZW50aWFsIGVxdWF0aW9uJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMgKHJlYWQtd3JpdGUpXHJcbiAgICB0aGlzLnRhcmdldENvbnRhaW5lckhlaWdodFByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCBNdWx0aXBsZVBhcnRpY2xlTW9kZWwuUEFSVElDTEVfQ09OVEFJTkVSX0lOSVRJQUxfSEVJR0hULCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3RhcmdldENvbnRhaW5lckhlaWdodFByb3BlcnR5JyApLFxyXG4gICAgICByYW5nZTogbmV3IFJhbmdlKCBNSU5fQUxMT1dBQkxFX0NPTlRBSU5FUl9IRUlHSFQsIE11bHRpcGxlUGFydGljbGVNb2RlbC5QQVJUSUNMRV9DT05UQUlORVJfSU5JVElBTF9IRUlHSFQgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMgKHJlYWQtb25seSkgLSBhIGRlcml2ZWQgcHJvcGVydHkgdGhhdCBpbmRpY2F0ZXMgd2hldGhlciB0aGUgbGlkIGlzIGhpZ2hlciB0aGFuIHRoZSBpbmplY3Rpb24gcG9pbnRcclxuICAgIHRoaXMubGlkQWJvdmVJbmplY3Rpb25Qb2ludFByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyB0aGlzLmNvbnRhaW5lckhlaWdodFByb3BlcnR5IF0sIGNvbnRhaW5lckhlaWdodCA9PiB7XHJcblxyXG4gICAgICAvLyBUaGlzIG1heSBhcHBlYXIgYSBsaXR0bGUgc3VzcGVjdCwgYnV0IHRoZSBtb2RlbCBpcyBkZXNpZ25lZCBzdWNoIHRoYXQgdGhlIGNvbnRhaW5lciBoZWlnaHQgaXMgYWx3YXlzIHJlc2V0XHJcbiAgICAgIC8vIHRvIGl0cyBtYXggd2hlbiB0aGUgcGFydGljbGUgZGlhbWV0ZXIgYW5kIGluamVjdGlvbiBjaGFuZ2UsIHNvIHRoaXMgY2FuIGJlIHRydXN0ZWQuXHJcbiAgICAgIHJldHVybiAoIGNvbnRhaW5lckhlaWdodCAvIHRoaXMucGFydGljbGVEaWFtZXRlciApID4gdGhpcy5pbmplY3Rpb25Qb2ludC55O1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFJlc2V0IHRoZSB0YXJnZXQgY29udGFpbmVyIGhlaWdodCBpbiB0aGUgZXZlbnQgb2YgYW4gZXhwbG9zaW9uLlxyXG4gICAgdGhpcy5pc0V4cGxvZGVkUHJvcGVydHkubGF6eUxpbmsoIGlzRXhwbG9kZWQgPT4ge1xyXG4gICAgICBpZiAoIGlzRXhwbG9kZWQgKSB7XHJcbiAgICAgICAgdGhpcy50YXJnZXRDb250YWluZXJIZWlnaHRQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gUmVzZXQgdGhlIHRhcmdldCBjb250YWluZXIgaGVpZ2h0IHdoZW4gdGhlIHN1YnN0YW5jZSBjaGFuZ2VzLlxyXG4gICAgdGhpcy5zdWJzdGFuY2VQcm9wZXJ0eS5sYXp5TGluayggKCkgPT4ge1xyXG4gICAgICB0aGlzLnRhcmdldENvbnRhaW5lckhlaWdodFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgLSBUaGlzIGZsYWcgaXMgdXNlZCB0byBhdm9pZCBwcm9ibGVtcyB3aGVuIHRoZSBzdXBlcmNvbnN0cnVjdG9yIGNhbGxzIHRoZSBvdmVycmlkZXMgaW4gdGhpcyBzdWJjbGFzc1xyXG4gICAgLy8gYmVmb3JlIHRoZSBzdWJjbGFzcy1zcGVjaWZpYyBwcm9wZXJ0aWVzIGhhdmUgYmVlbiBhZGRlZC5cclxuICAgIHRoaXMucGhhc2VDaGFuZ2VNb2RlbENvbnN0cnVjdGVkID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgc2lnbWEgdmFsdWUsIHdoaWNoIGlzIG9uZSBvZiB0aGUgdHdvIHBhcmFtZXRlcnMgdGhhdCBkZXNjcmliZXMgdGhlIExlbm5hcmQtSm9uZXMgcG90ZW50aWFsLlxyXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGdldFNpZ21hKCkge1xyXG4gICAgcmV0dXJuIFNJR01BX1RBQkxFLmdldCggdGhpcy5zdWJzdGFuY2VQcm9wZXJ0eS52YWx1ZSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHRoZSBlcHNpbG9uIHZhbHVlLCB3aGljaCBpcyBvbmUgb2YgdGhlIHR3byBwYXJhbWV0ZXJzIHRoYXQgZGVzY3JpYmVzIHRoZSBMZW5uYXJkLUpvbmVzIHBvdGVudGlhbC5cclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBnZXRFcHNpbG9uKCkge1xyXG4gICAgY29uc3Qgc3Vic3RhbmNlID0gdGhpcy5zdWJzdGFuY2VQcm9wZXJ0eS52YWx1ZTtcclxuICAgIGxldCBlcHNpbG9uO1xyXG4gICAgaWYgKCBzdWJzdGFuY2UgPT09IFN1YnN0YW5jZVR5cGUuQURKVVNUQUJMRV9BVE9NICkge1xyXG4gICAgICBlcHNpbG9uID0gdGhpcy5hZGp1c3RhYmxlQXRvbUludGVyYWN0aW9uU3RyZW5ndGhQcm9wZXJ0eS52YWx1ZTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBlcHNpbG9uID0gRVBTSUxPTl9UQUJMRS5nZXQoIHN1YnN0YW5jZSApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGVwc2lsb247XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZXBzaWxvblxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBzZXRFcHNpbG9uKCBlcHNpbG9uICkge1xyXG4gICAgaWYgKCB0aGlzLnN1YnN0YW5jZVByb3BlcnR5LmdldCgpID09PSBTdWJzdGFuY2VUeXBlLkFESlVTVEFCTEVfQVRPTSApIHtcclxuICAgICAgdGhpcy5tb2xlY3VsZUZvcmNlQW5kTW90aW9uQ2FsY3VsYXRvci5zZXRTY2FsZWRFcHNpbG9uKFxyXG4gICAgICAgIGNvbnZlcnRFcHNpbG9uVG9TY2FsZWRFcHNpbG9uKCBVdGlscy5jbGFtcCggZXBzaWxvbiwgTUlOX0FESlVTVEFCTEVfRVBTSUxPTiwgTUFYX0FESlVTVEFCTEVfRVBTSUxPTiApIClcclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmYWxzZSwgJ0Vycm9yOiBFcHNpbG9uIGNhbm5vdCBiZSBzZXQgd2hlbiBub24tY29uZmlndXJhYmxlIG1vbGVjdWxlIGlzIGluIHVzZS4nICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBoYW5kbGVyIHRoYXQgc2V0cyB1cCB0aGUgdmFyaW91cyBwb3J0aW9ucyBvZiB0aGUgbW9kZWwgdG8gc3VwcG9ydCB0aGUgbmV3bHkgc2VsZWN0ZWQgc3Vic3RhbmNlXHJcbiAgICogQHBhcmFtIHtTdWJzdGFuY2VUeXBlfSBzdWJzdGFuY2VcclxuICAgKiBAcHJvdGVjdGVkXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICovXHJcbiAgaGFuZGxlU3Vic3RhbmNlQ2hhbmdlZCggc3Vic3RhbmNlICkge1xyXG5cclxuICAgIC8vIHJlc2V0IHRoZSB0YXJnZXQgY29udGFpbmVyIGhlaWdodCB3aGVuZXZlciB0aGUgc3Vic3RhbmNlIGNoYW5nZXNcclxuICAgIHRoaXMudGFyZ2V0Q29udGFpbmVySGVpZ2h0UHJvcGVydHkgJiYgdGhpcy50YXJnZXRDb250YWluZXJIZWlnaHRQcm9wZXJ0eS5yZXNldCgpO1xyXG5cclxuICAgIC8vIGJhc2UgY2xhc3MgZG9lcyBtb3N0IG9mIHRoZSBoZWF2eSBsaWZ0aW5nIG9uIHRoaXNcclxuICAgIHN1cGVyLmhhbmRsZVN1YnN0YW5jZUNoYW5nZWQoIHN1YnN0YW5jZSApO1xyXG5cclxuICAgIC8vIElmIHRoZSBhZGp1c3RhYmxlIGF0b20gaGFzIGJlZW4gc2VsZWN0ZWQsIHNldCB0aGUgZXBzaWxvbiB2YWx1ZSBvZiB0aGUgTEogcG90ZW50aWFsIHRvIGJlIGJhc2VkIG9uIHRoZSBwcmV2aW91c2x5XHJcbiAgICAvLyBzZXQgaW50ZXJhY3Rpb24gc3RyZW5ndGguXHJcbiAgICBpZiAoIHN1YnN0YW5jZSA9PT0gU3Vic3RhbmNlVHlwZS5BREpVU1RBQkxFX0FUT00gKSB7XHJcbiAgICAgIHRoaXMuc2V0RXBzaWxvbiggdGhpcy5hZGp1c3RhYmxlQXRvbUludGVyYWN0aW9uU3RyZW5ndGhQcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgdGFyZ2V0IGhlaWdodCBvZiB0aGUgY29udGFpbmVyLiAgVGhlIHRhcmdldCBoZWlnaHQgaXMgc2V0IHJhdGhlciB0aGFuIHRoZSBhY3R1YWwgaGVpZ2h0IGJlY2F1c2UgdGhlXHJcbiAgICogbW9kZWwgbGltaXRzIHRoZSByYXRlIGF0IHdoaWNoIHRoZSBoZWlnaHQgY2FuIGNoYW5nZWQuICBUaGUgbW9kZWwgd2lsbCBncmFkdWFsbHkgbW92ZSB0b3dhcmRzIHRoZSB0YXJnZXQgaGVpZ2h0LlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBkZXNpcmVkQ29udGFpbmVySGVpZ2h0XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHNldFRhcmdldENvbnRhaW5lckhlaWdodCggZGVzaXJlZENvbnRhaW5lckhlaWdodCApIHtcclxuICAgIHRoaXMudGFyZ2V0Q29udGFpbmVySGVpZ2h0UHJvcGVydHkuc2V0KCBVdGlscy5jbGFtcChcclxuICAgICAgZGVzaXJlZENvbnRhaW5lckhlaWdodCxcclxuICAgICAgTUlOX0FMTE9XQUJMRV9DT05UQUlORVJfSEVJR0hULFxyXG4gICAgICBNdWx0aXBsZVBhcnRpY2xlTW9kZWwuUEFSVElDTEVfQ09OVEFJTkVSX0lOSVRJQUxfSEVJR0hUXHJcbiAgICApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHJvdGVjdGVkXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICovXHJcbiAgdXBkYXRlQ29udGFpbmVyU2l6ZSggZHQgKSB7XHJcblxyXG4gICAgaWYgKCAhdGhpcy5waGFzZUNoYW5nZU1vZGVsQ29uc3RydWN0ZWQgfHxcclxuICAgICAgICAgdGhpcy5pc0V4cGxvZGVkUHJvcGVydHkudmFsdWUgfHxcclxuICAgICAgICAgdGhpcy50YXJnZXRDb250YWluZXJIZWlnaHRQcm9wZXJ0eS52YWx1ZSA9PT0gdGhpcy5jb250YWluZXJIZWlnaHRQcm9wZXJ0eS52YWx1ZSApIHtcclxuXHJcbiAgICAgIC8vIGluIHRoaXMgY2FzZSwgdGhlIHN1cGVyIG1ha2VzIHRoZSBuZWVkZWQgYWRqdXN0bWVudHNcclxuICAgICAgc3VwZXIudXBkYXRlQ29udGFpbmVyU2l6ZSggZHQgKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCB0aGlzLnRhcmdldENvbnRhaW5lckhlaWdodFByb3BlcnR5LnZhbHVlICE9PSB0aGlzLmNvbnRhaW5lckhlaWdodFByb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICB0aGlzLmhlaWdodENoYW5nZVRoaXNTdGVwID0gdGhpcy50YXJnZXRDb250YWluZXJIZWlnaHRQcm9wZXJ0eS5nZXQoKSAtIHRoaXMuY29udGFpbmVySGVpZ2h0UHJvcGVydHkuZ2V0KCk7XHJcbiAgICAgIGlmICggdGhpcy5oZWlnaHRDaGFuZ2VUaGlzU3RlcCA+IDAgKSB7XHJcblxyXG4gICAgICAgIC8vIHRoZSBjb250YWluZXIgaXMgZXhwYW5kaW5nLCBsaW1pdCB0aGUgY2hhbmdlIHRvIHRoZSBtYXggYWxsb3dlZCByYXRlXHJcbiAgICAgICAgdGhpcy5oZWlnaHRDaGFuZ2VUaGlzU3RlcCA9IE1hdGgubWluKFxyXG4gICAgICAgICAgdGhpcy5oZWlnaHRDaGFuZ2VUaGlzU3RlcCxcclxuICAgICAgICAgIE11bHRpcGxlUGFydGljbGVNb2RlbC5NQVhfQ09OVEFJTkVSX0VYUEFORF9SQVRFICogZHQgKTtcclxuXHJcbiAgICAgICAgdGhpcy5jb250YWluZXJIZWlnaHRQcm9wZXJ0eS5zZXQoIE1hdGgubWluKFxyXG4gICAgICAgICAgdGhpcy5jb250YWluZXJIZWlnaHRQcm9wZXJ0eS5nZXQoKSArIHRoaXMuaGVpZ2h0Q2hhbmdlVGhpc1N0ZXAsXHJcbiAgICAgICAgICBNdWx0aXBsZVBhcnRpY2xlTW9kZWwuUEFSVElDTEVfQ09OVEFJTkVSX0lOSVRJQUxfSEVJR0hUXHJcbiAgICAgICAgKSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAvLyB0aGUgY29udGFpbmVyIGlzIHNocmlua2luZywgbGltaXQgdGhlIGNoYW5nZSB0byB0aGUgbWF4IGFsbG93ZWQgcmF0ZVxyXG4gICAgICAgIHRoaXMuaGVpZ2h0Q2hhbmdlVGhpc1N0ZXAgPSBNYXRoLm1heCggdGhpcy5oZWlnaHRDaGFuZ2VUaGlzU3RlcCwgLU1BWF9DT05UQUlORVJfU0hSSU5LX1JBVEUgKiBkdCApO1xyXG5cclxuICAgICAgICB0aGlzLmNvbnRhaW5lckhlaWdodFByb3BlcnR5LnNldCggTWF0aC5tYXgoXHJcbiAgICAgICAgICB0aGlzLmNvbnRhaW5lckhlaWdodFByb3BlcnR5LmdldCgpICsgdGhpcy5oZWlnaHRDaGFuZ2VUaGlzU3RlcCxcclxuICAgICAgICAgIE1JTl9BTExPV0FCTEVfQ09OVEFJTkVSX0hFSUdIVFxyXG4gICAgICAgICkgKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLm5vcm1hbGl6ZWRDb250YWluZXJIZWlnaHQgPSB0aGlzLmNvbnRhaW5lckhlaWdodFByb3BlcnR5LmdldCgpIC8gdGhpcy5wYXJ0aWNsZURpYW1ldGVyO1xyXG4gICAgICB0aGlzLm5vcm1hbGl6ZWRMaWRWZWxvY2l0eVkgPSAoIHRoaXMuaGVpZ2h0Q2hhbmdlVGhpc1N0ZXAgLyB0aGlzLnBhcnRpY2xlRGlhbWV0ZXIgKSAvIGR0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHJlc2V0KCkge1xyXG4gICAgc3VwZXIucmVzZXQoKTtcclxuICAgIHRoaXMudGFyZ2V0Q29udGFpbmVySGVpZ2h0UHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuYWRqdXN0YWJsZUF0b21JbnRlcmFjdGlvblN0cmVuZ3RoUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMucGhhc2VEaWFncmFtRXhwYW5kZWRQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5pbnRlcmFjdGlvblBvdGVudGlhbEV4cGFuZGVkUHJvcGVydHkucmVzZXQoKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIGhlbHBlciBmdW5jdGlvbiAtIFRoZSBmb2xsb3dpbmcgY29udmVyc2lvbiBvZiB0aGUgdGFyZ2V0IHZhbHVlIGZvciBlcHNpbG9uIHRvIGEgc2NhbGVkIHZhbHVlIGZvciB0aGUgbW90aW9uXHJcbi8vIGNhbGN1bGF0b3Igb2JqZWN0IHdhcyBkZXRlcm1pbmVkIGVtcGlyaWNhbGx5IHN1Y2ggdGhhdCB0aGUgcmVzdWx0aW5nIGJlaGF2aW9yIHJvdWdobHkgbWF0Y2hlZCB0aGF0IG9mIHRoZSBleGlzdGluZ1xyXG4vLyBtb25hdG9taWMgbW9sZWN1bGVzLlxyXG5jb25zdCBjb252ZXJ0RXBzaWxvblRvU2NhbGVkRXBzaWxvbiA9IGVwc2lsb24gPT4gZXBzaWxvbiAvICggU09NQ29uc3RhbnRzLk1BWF9FUFNJTE9OIC8gMiApO1xyXG5cclxuLy8gc3RhdGljIGNvbnN0YW50c1xyXG5QaGFzZUNoYW5nZXNNb2RlbC5NQVhfQURKVVNUQUJMRV9FUFNJTE9OID0gTUFYX0FESlVTVEFCTEVfRVBTSUxPTjtcclxuXHJcbnN0YXRlc09mTWF0dGVyLnJlZ2lzdGVyKCAnUGhhc2VDaGFuZ2VzTW9kZWwnLCBQaGFzZUNoYW5nZXNNb2RlbCApO1xyXG5l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