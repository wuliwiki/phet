// Copyright 2022-2023, University of Colorado Boulder

/**
 * Logic that controls the gravitational interactions between bodies.
 *
 * The engine updates the position of the bodies on the run() function,
 * inside it uses a Position Extended Forest-Ruth Like algorithm (PEFRL) (Omelyan, Myrglod & Folk, 2001)
 *
 *
 * @author Agust√≠n Vallejo (PhET Interactive Simulations)
 */

import mySolarSystem from '../../mySolarSystem.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Engine from '../../../../solar-system-common/js/model/Engine.js';
const scratchVector = new Vector2(0, 0);

// constants for PEFRL algorithm
const XI = 0.1786178958448091;
const LAMBDA = -0.2123418310626054;
const CHI = -0.06626458266981849;

// Gravitational constant
const G = 10000;
export default class NumericalEngine extends Engine {
  constructor(bodies) {
    super(bodies);
  }
  update(bodies) {
    // Reset the bodies array and recalculate total mass
    this.bodies = bodies;
    this.checkCollisions();
    this.updateForces();
  }
  checkCollisions() {
    // We need to rerun collision checks if we get one collision
    let hadCollision = true;
    while (hadCollision) {
      hadCollision = false;
      for (let i = 0; i < this.bodies.length; i++) {
        const body1 = this.bodies[i];
        for (let j = i + 1; j < this.bodies.length; j++) {
          const body2 = this.bodies[j];
          if (body1.isOverlapping(body2)) {
            const isBody1Larger = body1.massProperty.value > body2.massProperty.value;
            const largerBody = isBody1Larger ? body1 : body2;
            const smallerBody = isBody1Larger ? body2 : body1;

            // Add this body's momentum into the body it is colliding into.
            largerBody.velocityProperty.value = largerBody.velocityProperty.value.plus(smallerBody.velocityProperty.value.times(smallerBody.massProperty.value / largerBody.massProperty.value));
            smallerBody.collidedEmitter.emit();
            smallerBody.isActiveProperty.value = false;
            hadCollision = true;
          }
        }
      }
    }
  }
  reset() {
    this.updateForces();
  }
  run(dt, updateProperties = true) {
    const iterationCount = 400 / this.bodies.length;
    const N = this.bodies.length;
    dt /= iterationCount;
    const masses = this.bodies.map(body => body.massProperty.value);
    const positions = this.bodies.map(body => body.positionProperty.value.copy());
    const velocities = this.bodies.map(body => body.velocityProperty.value.copy());
    const accelerations = this.bodies.map(body => body.accelerationProperty.value.copy());
    const forces = this.bodies.map(body => body.forceProperty.value.copy());
    for (let k = 0; k < iterationCount; k++) {
      // Zeroing out forces
      for (let i = 0; i < N; i++) {
        forces[i].setXY(0, 0);
      }

      // Iterate between all the bodies to add the forces and check collisions
      for (let i = 0; i < N; i++) {
        const mass1 = masses[i];
        for (let j = i + 1; j < N; j++) {
          const mass2 = masses[j];
          const direction = scratchVector.set(positions[j]).subtract(positions[i]);
          const distance = direction.magnitude;
          assert && assert(distance >= 0, 'Negative distances not allowed!!');
          const forceMagnitude = G * mass1 * mass2 * Math.pow(distance, -3);
          const force = direction.multiplyScalar(forceMagnitude);
          forces[i].add(force);
          forces[j].subtract(force);
        }
      }

      // Compute accelerations
      for (let i = 0; i < N; i++) {
        accelerations[i].set(forces[i]).multiplyScalar(1 / masses[i]);
      }

      // Position Extended Forest-Ruth Like algorithm (PEFRL) (Omelyan, Myrglod & Folk, 2001)

      for (let i = 0; i < N; i++) {
        //-------------
        // Step One
        //--------------

        // net time: XI dt
        positions[i].add(scratchVector.set(velocities[i]).multiplyScalar(XI * dt));

        // net time: (1 - 2 * LAMBDA) * dt / 2
        velocities[i].add(scratchVector.set(accelerations[i]).multiplyScalar((1 - 2 * LAMBDA) * dt / 2));

        //-------------
        // Step Two
        //--------------

        // net time: (XI+CHI) dt
        positions[i].add(scratchVector.set(velocities[i]).multiplyScalar(CHI * dt));

        // net time: dt / 2
        velocities[i].add(scratchVector.set(accelerations[i]).multiplyScalar(LAMBDA * dt));

        //-------------
        // Step Three
        //--------------

        // net time: (1-(XI+CHI)) dt
        positions[i].add(scratchVector.set(velocities[i]).multiplyScalar((1 - 2 * (CHI + XI)) * dt));

        // net time: (1/2 + LAMBDA) dt
        velocities[i].add(scratchVector.set(accelerations[i]).multiplyScalar(LAMBDA * dt));

        //-------------
        // Step Four
        //--------------

        // net time: (1-(XI)) dt
        positions[i].add(scratchVector.set(velocities[i]).multiplyScalar(CHI * dt));

        // no update in velocities // net time: (1/2 + LAMBDA) dt

        //-------------
        // Step Five: last step, these are the final positions and velocities i.e. r(t+dt) and v(t+dt)
        //--------------

        // IMPORTANT: we need to update the velocities first

        // net time:  dt;
        velocities[i].add(scratchVector.set(accelerations[i]).multiplyScalar((1 - 2 * LAMBDA) * dt / 2));

        // net time:  dt
        positions[i].add(scratchVector.set(velocities[i]).multiplyScalar(XI * dt));
      }
    }
    for (let i = 0; i < this.bodies.length; i++) {
      const body = this.bodies[i];
      if (updateProperties) {
        body.positionProperty.value = positions[i];
        body.velocityProperty.value = velocities[i];
        body.accelerationProperty.value = accelerations[i];
        body.forceProperty.value = forces[i];
      } else {
        body.positionProperty.value.set(positions[i]);
        body.velocityProperty.value.set(velocities[i]);
        body.accelerationProperty.value.set(accelerations[i]);
        body.forceProperty.value.set(forces[i]);
      }
    }
  }
  updateForces() {
    for (let i = 0; i < this.bodies.length; i++) {
      const body = this.bodies[i];
      body.accelerationProperty.value = new Vector2(0, 0);
      body.forceProperty.value = new Vector2(0, 0);
    }

    // Iterate between all the bodies to add the accelerations
    for (let i = 0; i < this.bodies.length; i++) {
      const body1 = this.bodies[i];
      const mass1 = body1.massProperty.value;
      for (let j = i + 1; j < this.bodies.length; j++) {
        const body2 = this.bodies[j];
        const mass2 = body2.massProperty.value;
        assert && assert(mass2 > 0, 'mass2 should not be 0');
        const force = this.getForce(body1, body2);

        // REVIEW: Can this scratchVector be removed?
        body1.forceProperty.value = body1.forceProperty.value.plus(scratchVector.set(force));
        body2.forceProperty.value = body2.forceProperty.value.minus(scratchVector.set(force));
        body1.accelerationProperty.value = body1.forceProperty.value.times(1 / mass1);
        body2.accelerationProperty.value = body2.forceProperty.value.times(1 / mass2);
      }
    }
  }

  /**
   * Calculate the force on body1 because of body2
   */
  getForce(body1, body2) {
    const direction = body2.positionProperty.value.minus(body1.positionProperty.value);
    const distance = direction.magnitude;
    assert && assert(distance > 0, 'Negative distances not allowed!!');
    const forceMagnitude = G * body1.massProperty.value * body2.massProperty.value * Math.pow(distance, -3);
    return direction.times(forceMagnitude);
  }
}
mySolarSystem.register('NumericalEngine', NumericalEngine);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJteVNvbGFyU3lzdGVtIiwiVmVjdG9yMiIsIkVuZ2luZSIsInNjcmF0Y2hWZWN0b3IiLCJYSSIsIkxBTUJEQSIsIkNISSIsIkciLCJOdW1lcmljYWxFbmdpbmUiLCJjb25zdHJ1Y3RvciIsImJvZGllcyIsInVwZGF0ZSIsImNoZWNrQ29sbGlzaW9ucyIsInVwZGF0ZUZvcmNlcyIsImhhZENvbGxpc2lvbiIsImkiLCJsZW5ndGgiLCJib2R5MSIsImoiLCJib2R5MiIsImlzT3ZlcmxhcHBpbmciLCJpc0JvZHkxTGFyZ2VyIiwibWFzc1Byb3BlcnR5IiwidmFsdWUiLCJsYXJnZXJCb2R5Iiwic21hbGxlckJvZHkiLCJ2ZWxvY2l0eVByb3BlcnR5IiwicGx1cyIsInRpbWVzIiwiY29sbGlkZWRFbWl0dGVyIiwiZW1pdCIsImlzQWN0aXZlUHJvcGVydHkiLCJyZXNldCIsInJ1biIsImR0IiwidXBkYXRlUHJvcGVydGllcyIsIml0ZXJhdGlvbkNvdW50IiwiTiIsIm1hc3NlcyIsIm1hcCIsImJvZHkiLCJwb3NpdGlvbnMiLCJwb3NpdGlvblByb3BlcnR5IiwiY29weSIsInZlbG9jaXRpZXMiLCJhY2NlbGVyYXRpb25zIiwiYWNjZWxlcmF0aW9uUHJvcGVydHkiLCJmb3JjZXMiLCJmb3JjZVByb3BlcnR5IiwiayIsInNldFhZIiwibWFzczEiLCJtYXNzMiIsImRpcmVjdGlvbiIsInNldCIsInN1YnRyYWN0IiwiZGlzdGFuY2UiLCJtYWduaXR1ZGUiLCJhc3NlcnQiLCJmb3JjZU1hZ25pdHVkZSIsIk1hdGgiLCJwb3ciLCJmb3JjZSIsIm11bHRpcGx5U2NhbGFyIiwiYWRkIiwiZ2V0Rm9yY2UiLCJtaW51cyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTnVtZXJpY2FsRW5naW5lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIyLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIExvZ2ljIHRoYXQgY29udHJvbHMgdGhlIGdyYXZpdGF0aW9uYWwgaW50ZXJhY3Rpb25zIGJldHdlZW4gYm9kaWVzLlxyXG4gKlxyXG4gKiBUaGUgZW5naW5lIHVwZGF0ZXMgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2RpZXMgb24gdGhlIHJ1bigpIGZ1bmN0aW9uLFxyXG4gKiBpbnNpZGUgaXQgdXNlcyBhIFBvc2l0aW9uIEV4dGVuZGVkIEZvcmVzdC1SdXRoIExpa2UgYWxnb3JpdGhtIChQRUZSTCkgKE9tZWx5YW4sIE15cmdsb2QgJiBGb2xrLCAyMDAxKVxyXG4gKlxyXG4gKlxyXG4gKiBAYXV0aG9yIEFndXN0w61uIFZhbGxlam8gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IG15U29sYXJTeXN0ZW0gZnJvbSAnLi4vLi4vbXlTb2xhclN5c3RlbS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZUFycmF5IH0gZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9jcmVhdGVPYnNlcnZhYmxlQXJyYXkuanMnO1xyXG5pbXBvcnQgQm9keSBmcm9tICcuLi8uLi8uLi8uLi9zb2xhci1zeXN0ZW0tY29tbW9uL2pzL21vZGVsL0JvZHkuanMnO1xyXG5pbXBvcnQgRW5naW5lIGZyb20gJy4uLy4uLy4uLy4uL3NvbGFyLXN5c3RlbS1jb21tb24vanMvbW9kZWwvRW5naW5lLmpzJztcclxuXHJcbmNvbnN0IHNjcmF0Y2hWZWN0b3IgPSBuZXcgVmVjdG9yMiggMCwgMCApO1xyXG5cclxuLy8gY29uc3RhbnRzIGZvciBQRUZSTCBhbGdvcml0aG1cclxuY29uc3QgWEkgPSAwLjE3ODYxNzg5NTg0NDgwOTE7XHJcbmNvbnN0IExBTUJEQSA9IC0wLjIxMjM0MTgzMTA2MjYwNTQ7XHJcbmNvbnN0IENISSA9IC0wLjA2NjI2NDU4MjY2OTgxODQ5O1xyXG5cclxuLy8gR3Jhdml0YXRpb25hbCBjb25zdGFudFxyXG5jb25zdCBHID0gMTAwMDA7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOdW1lcmljYWxFbmdpbmUgZXh0ZW5kcyBFbmdpbmUge1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGJvZGllczogT2JzZXJ2YWJsZUFycmF5PEJvZHk+ICkge1xyXG4gICAgc3VwZXIoIGJvZGllcyApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIHVwZGF0ZSggYm9kaWVzOiBPYnNlcnZhYmxlQXJyYXk8Qm9keT4gKTogdm9pZCB7XHJcblxyXG4gICAgLy8gUmVzZXQgdGhlIGJvZGllcyBhcnJheSBhbmQgcmVjYWxjdWxhdGUgdG90YWwgbWFzc1xyXG4gICAgdGhpcy5ib2RpZXMgPSBib2RpZXM7XHJcbiAgICB0aGlzLmNoZWNrQ29sbGlzaW9ucygpO1xyXG4gICAgdGhpcy51cGRhdGVGb3JjZXMoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBjaGVja0NvbGxpc2lvbnMoKTogdm9pZCB7XHJcblxyXG4gICAgLy8gV2UgbmVlZCB0byByZXJ1biBjb2xsaXNpb24gY2hlY2tzIGlmIHdlIGdldCBvbmUgY29sbGlzaW9uXHJcbiAgICBsZXQgaGFkQ29sbGlzaW9uID0gdHJ1ZTtcclxuICAgIHdoaWxlICggaGFkQ29sbGlzaW9uICkge1xyXG4gICAgICBoYWRDb2xsaXNpb24gPSBmYWxzZTtcclxuXHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuYm9kaWVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgIGNvbnN0IGJvZHkxID0gdGhpcy5ib2RpZXNbIGkgXTtcclxuICAgICAgICBmb3IgKCBsZXQgaiA9IGkgKyAxOyBqIDwgdGhpcy5ib2RpZXMubGVuZ3RoOyBqKysgKSB7XHJcbiAgICAgICAgICBjb25zdCBib2R5MiA9IHRoaXMuYm9kaWVzWyBqIF07XHJcbiAgICAgICAgICBpZiAoIGJvZHkxLmlzT3ZlcmxhcHBpbmcoIGJvZHkyICkgKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlzQm9keTFMYXJnZXIgPSBib2R5MS5tYXNzUHJvcGVydHkudmFsdWUgPiBib2R5Mi5tYXNzUHJvcGVydHkudmFsdWU7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhcmdlckJvZHkgPSBpc0JvZHkxTGFyZ2VyID8gYm9keTEgOiBib2R5MjtcclxuICAgICAgICAgICAgY29uc3Qgc21hbGxlckJvZHkgPSBpc0JvZHkxTGFyZ2VyID8gYm9keTIgOiBib2R5MTtcclxuXHJcbiAgICAgICAgICAgIC8vIEFkZCB0aGlzIGJvZHkncyBtb21lbnR1bSBpbnRvIHRoZSBib2R5IGl0IGlzIGNvbGxpZGluZyBpbnRvLlxyXG4gICAgICAgICAgICBsYXJnZXJCb2R5LnZlbG9jaXR5UHJvcGVydHkudmFsdWUgPSBsYXJnZXJCb2R5LnZlbG9jaXR5UHJvcGVydHkudmFsdWUucGx1cyggc21hbGxlckJvZHkudmVsb2NpdHlQcm9wZXJ0eS52YWx1ZS50aW1lcyggc21hbGxlckJvZHkubWFzc1Byb3BlcnR5LnZhbHVlIC8gbGFyZ2VyQm9keS5tYXNzUHJvcGVydHkudmFsdWUgKSApO1xyXG5cclxuICAgICAgICAgICAgc21hbGxlckJvZHkuY29sbGlkZWRFbWl0dGVyLmVtaXQoKTtcclxuICAgICAgICAgICAgc21hbGxlckJvZHkuaXNBY3RpdmVQcm9wZXJ0eS52YWx1ZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgaGFkQ29sbGlzaW9uID0gdHJ1ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMudXBkYXRlRm9yY2VzKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgcnVuKCBkdDogbnVtYmVyLCB1cGRhdGVQcm9wZXJ0aWVzID0gdHJ1ZSApOiB2b2lkIHtcclxuICAgIGNvbnN0IGl0ZXJhdGlvbkNvdW50ID0gNDAwIC8gdGhpcy5ib2RpZXMubGVuZ3RoO1xyXG4gICAgY29uc3QgTiA9IHRoaXMuYm9kaWVzLmxlbmd0aDtcclxuICAgIGR0IC89IGl0ZXJhdGlvbkNvdW50O1xyXG5cclxuICAgIGNvbnN0IG1hc3NlcyA9IHRoaXMuYm9kaWVzLm1hcCggYm9keSA9PiBib2R5Lm1hc3NQcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgY29uc3QgcG9zaXRpb25zID0gdGhpcy5ib2RpZXMubWFwKCBib2R5ID0+IGJvZHkucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS5jb3B5KCkgKTtcclxuICAgIGNvbnN0IHZlbG9jaXRpZXMgPSB0aGlzLmJvZGllcy5tYXAoIGJvZHkgPT4gYm9keS52ZWxvY2l0eVByb3BlcnR5LnZhbHVlLmNvcHkoKSApO1xyXG4gICAgY29uc3QgYWNjZWxlcmF0aW9ucyA9IHRoaXMuYm9kaWVzLm1hcCggYm9keSA9PiBib2R5LmFjY2VsZXJhdGlvblByb3BlcnR5LnZhbHVlLmNvcHkoKSApO1xyXG4gICAgY29uc3QgZm9yY2VzID0gdGhpcy5ib2RpZXMubWFwKCBib2R5ID0+IGJvZHkuZm9yY2VQcm9wZXJ0eS52YWx1ZS5jb3B5KCkgKTtcclxuXHJcbiAgICBmb3IgKCBsZXQgayA9IDA7IGsgPCBpdGVyYXRpb25Db3VudDsgaysrICkge1xyXG5cclxuICAgICAgLy8gWmVyb2luZyBvdXQgZm9yY2VzXHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IE47IGkrKyApIHtcclxuICAgICAgICBmb3JjZXNbIGkgXS5zZXRYWSggMCwgMCApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBJdGVyYXRlIGJldHdlZW4gYWxsIHRoZSBib2RpZXMgdG8gYWRkIHRoZSBmb3JjZXMgYW5kIGNoZWNrIGNvbGxpc2lvbnNcclxuICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgTjsgaSsrICkge1xyXG4gICAgICAgIGNvbnN0IG1hc3MxID0gbWFzc2VzWyBpIF07XHJcbiAgICAgICAgZm9yICggbGV0IGogPSBpICsgMTsgaiA8IE47IGorKyApIHtcclxuICAgICAgICAgIGNvbnN0IG1hc3MyID0gbWFzc2VzWyBqIF07XHJcblxyXG4gICAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gc2NyYXRjaFZlY3Rvci5zZXQoIHBvc2l0aW9uc1sgaiBdICkuc3VidHJhY3QoIHBvc2l0aW9uc1sgaSBdICk7XHJcbiAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IGRpcmVjdGlvbi5tYWduaXR1ZGU7XHJcbiAgICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBkaXN0YW5jZSA+PSAwLCAnTmVnYXRpdmUgZGlzdGFuY2VzIG5vdCBhbGxvd2VkISEnICk7XHJcbiAgICAgICAgICBjb25zdCBmb3JjZU1hZ25pdHVkZSA9IEcgKiBtYXNzMSAqIG1hc3MyICogKCBNYXRoLnBvdyggZGlzdGFuY2UsIC0zICkgKTtcclxuICAgICAgICAgIGNvbnN0IGZvcmNlID0gZGlyZWN0aW9uLm11bHRpcGx5U2NhbGFyKCBmb3JjZU1hZ25pdHVkZSApO1xyXG5cclxuICAgICAgICAgIGZvcmNlc1sgaSBdLmFkZCggZm9yY2UgKTtcclxuICAgICAgICAgIGZvcmNlc1sgaiBdLnN1YnRyYWN0KCBmb3JjZSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ29tcHV0ZSBhY2NlbGVyYXRpb25zXHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IE47IGkrKyApIHtcclxuICAgICAgICBhY2NlbGVyYXRpb25zWyBpIF0uc2V0KCBmb3JjZXNbIGkgXSApLm11bHRpcGx5U2NhbGFyKCAxIC8gbWFzc2VzWyBpIF0gKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gUG9zaXRpb24gRXh0ZW5kZWQgRm9yZXN0LVJ1dGggTGlrZSBhbGdvcml0aG0gKFBFRlJMKSAoT21lbHlhbiwgTXlyZ2xvZCAmIEZvbGssIDIwMDEpXHJcblxyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBOOyBpKysgKSB7XHJcblxyXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLVxyXG4gICAgICAgIC8vIFN0ZXAgT25lXHJcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgICAgICAvLyBuZXQgdGltZTogWEkgZHRcclxuICAgICAgICBwb3NpdGlvbnNbIGkgXS5hZGQoIHNjcmF0Y2hWZWN0b3Iuc2V0KCB2ZWxvY2l0aWVzWyBpIF0gKS5tdWx0aXBseVNjYWxhciggWEkgKiBkdCApICk7XHJcblxyXG4gICAgICAgIC8vIG5ldCB0aW1lOiAoMSAtIDIgKiBMQU1CREEpICogZHQgLyAyXHJcbiAgICAgICAgdmVsb2NpdGllc1sgaSBdLmFkZCggc2NyYXRjaFZlY3Rvci5zZXQoIGFjY2VsZXJhdGlvbnNbIGkgXSApLm11bHRpcGx5U2NhbGFyKCAoIDEgLSAyICogTEFNQkRBICkgKiBkdCAvIDIgKSApO1xyXG5cclxuICAgICAgICAvLy0tLS0tLS0tLS0tLS1cclxuICAgICAgICAvLyBTdGVwIFR3b1xyXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgICAgICAgLy8gbmV0IHRpbWU6IChYSStDSEkpIGR0XHJcbiAgICAgICAgcG9zaXRpb25zWyBpIF0uYWRkKCBzY3JhdGNoVmVjdG9yLnNldCggdmVsb2NpdGllc1sgaSBdICkubXVsdGlwbHlTY2FsYXIoIENISSAqIGR0ICkgKTtcclxuXHJcbiAgICAgICAgLy8gbmV0IHRpbWU6IGR0IC8gMlxyXG4gICAgICAgIHZlbG9jaXRpZXNbIGkgXS5hZGQoIHNjcmF0Y2hWZWN0b3Iuc2V0KCBhY2NlbGVyYXRpb25zWyBpIF0gKS5tdWx0aXBseVNjYWxhciggTEFNQkRBICogZHQgKSApO1xyXG5cclxuICAgICAgICAvLy0tLS0tLS0tLS0tLS1cclxuICAgICAgICAvLyBTdGVwIFRocmVlXHJcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgICAgICAvLyBuZXQgdGltZTogKDEtKFhJK0NISSkpIGR0XHJcbiAgICAgICAgcG9zaXRpb25zWyBpIF0uYWRkKCBzY3JhdGNoVmVjdG9yLnNldCggdmVsb2NpdGllc1sgaSBdICkubXVsdGlwbHlTY2FsYXIoICggMSAtIDIgKiAoIENISSArIFhJICkgKSAqIGR0ICkgKTtcclxuXHJcbiAgICAgICAgLy8gbmV0IHRpbWU6ICgxLzIgKyBMQU1CREEpIGR0XHJcbiAgICAgICAgdmVsb2NpdGllc1sgaSBdLmFkZCggc2NyYXRjaFZlY3Rvci5zZXQoIGFjY2VsZXJhdGlvbnNbIGkgXSApLm11bHRpcGx5U2NhbGFyKCBMQU1CREEgKiBkdCApICk7XHJcblxyXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLVxyXG4gICAgICAgIC8vIFN0ZXAgRm91clxyXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgICAgICAgLy8gbmV0IHRpbWU6ICgxLShYSSkpIGR0XHJcbiAgICAgICAgcG9zaXRpb25zWyBpIF0uYWRkKCBzY3JhdGNoVmVjdG9yLnNldCggdmVsb2NpdGllc1sgaSBdICkubXVsdGlwbHlTY2FsYXIoIENISSAqIGR0ICkgKTtcclxuXHJcbiAgICAgICAgLy8gbm8gdXBkYXRlIGluIHZlbG9jaXRpZXMgLy8gbmV0IHRpbWU6ICgxLzIgKyBMQU1CREEpIGR0XHJcblxyXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLVxyXG4gICAgICAgIC8vIFN0ZXAgRml2ZTogbGFzdCBzdGVwLCB0aGVzZSBhcmUgdGhlIGZpbmFsIHBvc2l0aW9ucyBhbmQgdmVsb2NpdGllcyBpLmUuIHIodCtkdCkgYW5kIHYodCtkdClcclxuICAgICAgICAvLy0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgICAgIC8vIElNUE9SVEFOVDogd2UgbmVlZCB0byB1cGRhdGUgdGhlIHZlbG9jaXRpZXMgZmlyc3RcclxuXHJcbiAgICAgICAgLy8gbmV0IHRpbWU6ICBkdDtcclxuICAgICAgICB2ZWxvY2l0aWVzWyBpIF0uYWRkKCBzY3JhdGNoVmVjdG9yLnNldCggYWNjZWxlcmF0aW9uc1sgaSBdICkubXVsdGlwbHlTY2FsYXIoICggMSAtIDIgKiBMQU1CREEgKSAqIGR0IC8gMiApICk7XHJcblxyXG4gICAgICAgIC8vIG5ldCB0aW1lOiAgZHRcclxuICAgICAgICBwb3NpdGlvbnNbIGkgXS5hZGQoIHNjcmF0Y2hWZWN0b3Iuc2V0KCB2ZWxvY2l0aWVzWyBpIF0gKS5tdWx0aXBseVNjYWxhciggWEkgKiBkdCApICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmJvZGllcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgYm9keSA9IHRoaXMuYm9kaWVzWyBpIF07XHJcblxyXG4gICAgICBpZiAoIHVwZGF0ZVByb3BlcnRpZXMgKSB7XHJcbiAgICAgICAgYm9keS5wb3NpdGlvblByb3BlcnR5LnZhbHVlID0gcG9zaXRpb25zWyBpIF07XHJcbiAgICAgICAgYm9keS52ZWxvY2l0eVByb3BlcnR5LnZhbHVlID0gdmVsb2NpdGllc1sgaSBdO1xyXG4gICAgICAgIGJvZHkuYWNjZWxlcmF0aW9uUHJvcGVydHkudmFsdWUgPSBhY2NlbGVyYXRpb25zWyBpIF07XHJcbiAgICAgICAgYm9keS5mb3JjZVByb3BlcnR5LnZhbHVlID0gZm9yY2VzWyBpIF07XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgYm9keS5wb3NpdGlvblByb3BlcnR5LnZhbHVlLnNldCggcG9zaXRpb25zWyBpIF0gKTtcclxuICAgICAgICBib2R5LnZlbG9jaXR5UHJvcGVydHkudmFsdWUuc2V0KCB2ZWxvY2l0aWVzWyBpIF0gKTtcclxuICAgICAgICBib2R5LmFjY2VsZXJhdGlvblByb3BlcnR5LnZhbHVlLnNldCggYWNjZWxlcmF0aW9uc1sgaSBdICk7XHJcbiAgICAgICAgYm9keS5mb3JjZVByb3BlcnR5LnZhbHVlLnNldCggZm9yY2VzWyBpIF0gKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVGb3JjZXMoKTogdm9pZCB7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmJvZGllcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgYm9keSA9IHRoaXMuYm9kaWVzWyBpIF07XHJcbiAgICAgIGJvZHkuYWNjZWxlcmF0aW9uUHJvcGVydHkudmFsdWUgPSBuZXcgVmVjdG9yMiggMCwgMCApO1xyXG4gICAgICBib2R5LmZvcmNlUHJvcGVydHkudmFsdWUgPSBuZXcgVmVjdG9yMiggMCwgMCApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEl0ZXJhdGUgYmV0d2VlbiBhbGwgdGhlIGJvZGllcyB0byBhZGQgdGhlIGFjY2VsZXJhdGlvbnNcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuYm9kaWVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBjb25zdCBib2R5MSA9IHRoaXMuYm9kaWVzWyBpIF07XHJcbiAgICAgIGNvbnN0IG1hc3MxID0gYm9keTEubWFzc1Byb3BlcnR5LnZhbHVlO1xyXG4gICAgICBmb3IgKCBsZXQgaiA9IGkgKyAxOyBqIDwgdGhpcy5ib2RpZXMubGVuZ3RoOyBqKysgKSB7XHJcbiAgICAgICAgY29uc3QgYm9keTIgPSB0aGlzLmJvZGllc1sgaiBdO1xyXG4gICAgICAgIGNvbnN0IG1hc3MyID0gYm9keTIubWFzc1Byb3BlcnR5LnZhbHVlO1xyXG4gICAgICAgIGFzc2VydCAmJiBhc3NlcnQoIG1hc3MyID4gMCwgJ21hc3MyIHNob3VsZCBub3QgYmUgMCcgKTtcclxuICAgICAgICBjb25zdCBmb3JjZTogVmVjdG9yMiA9IHRoaXMuZ2V0Rm9yY2UoIGJvZHkxLCBib2R5MiApO1xyXG5cclxuICAgICAgICAvLyBSRVZJRVc6IENhbiB0aGlzIHNjcmF0Y2hWZWN0b3IgYmUgcmVtb3ZlZD9cclxuICAgICAgICBib2R5MS5mb3JjZVByb3BlcnR5LnZhbHVlID0gYm9keTEuZm9yY2VQcm9wZXJ0eS52YWx1ZS5wbHVzKCBzY3JhdGNoVmVjdG9yLnNldCggZm9yY2UgKSApO1xyXG4gICAgICAgIGJvZHkyLmZvcmNlUHJvcGVydHkudmFsdWUgPSBib2R5Mi5mb3JjZVByb3BlcnR5LnZhbHVlLm1pbnVzKCBzY3JhdGNoVmVjdG9yLnNldCggZm9yY2UgKSApO1xyXG4gICAgICAgIGJvZHkxLmFjY2VsZXJhdGlvblByb3BlcnR5LnZhbHVlID0gYm9keTEuZm9yY2VQcm9wZXJ0eS52YWx1ZS50aW1lcyggMSAvIG1hc3MxICk7XHJcbiAgICAgICAgYm9keTIuYWNjZWxlcmF0aW9uUHJvcGVydHkudmFsdWUgPSBib2R5Mi5mb3JjZVByb3BlcnR5LnZhbHVlLnRpbWVzKCAxIC8gbWFzczIgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FsY3VsYXRlIHRoZSBmb3JjZSBvbiBib2R5MSBiZWNhdXNlIG9mIGJvZHkyXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRGb3JjZSggYm9keTE6IEJvZHksIGJvZHkyOiBCb2R5ICk6IFZlY3RvcjIge1xyXG4gICAgY29uc3QgZGlyZWN0aW9uOiBWZWN0b3IyID0gYm9keTIucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS5taW51cyggYm9keTEucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgY29uc3QgZGlzdGFuY2UgPSBkaXJlY3Rpb24ubWFnbml0dWRlO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZGlzdGFuY2UgPiAwLCAnTmVnYXRpdmUgZGlzdGFuY2VzIG5vdCBhbGxvd2VkISEnICk7XHJcbiAgICBjb25zdCBmb3JjZU1hZ25pdHVkZSA9IEcgKiBib2R5MS5tYXNzUHJvcGVydHkudmFsdWUgKiBib2R5Mi5tYXNzUHJvcGVydHkudmFsdWUgKiAoIE1hdGgucG93KCBkaXN0YW5jZSwgLTMgKSApO1xyXG4gICAgcmV0dXJuIGRpcmVjdGlvbi50aW1lcyggZm9yY2VNYWduaXR1ZGUgKTtcclxuICB9XHJcbn1cclxuXHJcbm15U29sYXJTeXN0ZW0ucmVnaXN0ZXIoICdOdW1lcmljYWxFbmdpbmUnLCBOdW1lcmljYWxFbmdpbmUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVB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