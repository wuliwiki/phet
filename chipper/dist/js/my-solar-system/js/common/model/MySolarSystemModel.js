// Copyright 2023, University of Colorado Boulder

/**
 * Main model for My Solar System sim.
 *
 * @author AgustÃ­n Vallejo (PhET Interactive Simulations)
 */

import mySolarSystem from '../../mySolarSystem.js';
import SolarSystemCommonModel from '../../../../solar-system-common/js/model/SolarSystemCommonModel.js';
import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import CenterOfMass from './CenterOfMass.js';
export default class MySolarSystemModel extends SolarSystemCommonModel {
  constructor(providedOptions) {
    super(providedOptions);
    const tandem = providedOptions.tandem;
    this.systemCenteredProperty = new BooleanProperty(true, {
      tandem: tandem.createTandem('systemCenteredProperty')
    });
    this.centerOfMass = new CenterOfMass(this.bodies);

    // Re-center the bodies and set Center of Mass speed to 0 when the systemCentered option is selected
    this.systemCenteredProperty.lazyLink(systemCentered => {
      if (systemCentered) {
        this.followAndCenterCenterOfMass();
      }
    });
    this.userInteractingEmitter.addListener(() => {
      this.systemCenteredProperty.value = false;
    });
  }

  // Calculates the position and velocity of the CoM and corrects the bodies position and velocities accordingly
  // After this, the CoM will be standing still and in the center of the sim.
  followAndCenterCenterOfMass() {
    const wasPlayingBefore = this.isPlayingProperty.value;
    this.isPlayingProperty.value = false; // Pause the sim
    this.centerOfMass.update();
    const centerOfMassPosition = this.centerOfMass.positionProperty.value;
    const centerOfMassVelocity = this.centerOfMass.velocityProperty.value;
    this.bodies.forEach(body => {
      body.clearPath();
      body.positionProperty.set(body.positionProperty.value.minus(centerOfMassPosition));
      body.velocityProperty.set(body.velocityProperty.value.minus(centerOfMassVelocity));
    });
    if (wasPlayingBefore) {
      this.isPlayingProperty.value = true; // Resume the sim
    }
  }

  followCenterOfMass() {
    this.centerOfMass.update();

    // Make the center of mass fixed, but not necessarily centered
    const centerOfMassVelocity = this.centerOfMass.velocityProperty.value;
    this.bodies.forEach(body => {
      body.velocityProperty.set(body.velocityProperty.value.minus(centerOfMassVelocity));
    });

    // Update Center of Mass to avoid system's initial movement
    this.centerOfMass.update();
  }
  update() {
    super.update();
    this.centerOfMass.update();
  }
  reset() {
    super.reset();
    this.centerOfMass.visibleProperty.reset();
  }
}
mySolarSystem.register('MySolarSystemModel', MySolarSystemModel);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJteVNvbGFyU3lzdGVtIiwiU29sYXJTeXN0ZW1Db21tb25Nb2RlbCIsIkJvb2xlYW5Qcm9wZXJ0eSIsIkNlbnRlck9mTWFzcyIsIk15U29sYXJTeXN0ZW1Nb2RlbCIsImNvbnN0cnVjdG9yIiwicHJvdmlkZWRPcHRpb25zIiwidGFuZGVtIiwic3lzdGVtQ2VudGVyZWRQcm9wZXJ0eSIsImNyZWF0ZVRhbmRlbSIsImNlbnRlck9mTWFzcyIsImJvZGllcyIsImxhenlMaW5rIiwic3lzdGVtQ2VudGVyZWQiLCJmb2xsb3dBbmRDZW50ZXJDZW50ZXJPZk1hc3MiLCJ1c2VySW50ZXJhY3RpbmdFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJ2YWx1ZSIsIndhc1BsYXlpbmdCZWZvcmUiLCJpc1BsYXlpbmdQcm9wZXJ0eSIsInVwZGF0ZSIsImNlbnRlck9mTWFzc1Bvc2l0aW9uIiwicG9zaXRpb25Qcm9wZXJ0eSIsImNlbnRlck9mTWFzc1ZlbG9jaXR5IiwidmVsb2NpdHlQcm9wZXJ0eSIsImZvckVhY2giLCJib2R5IiwiY2xlYXJQYXRoIiwic2V0IiwibWludXMiLCJmb2xsb3dDZW50ZXJPZk1hc3MiLCJyZXNldCIsInZpc2libGVQcm9wZXJ0eSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTXlTb2xhclN5c3RlbU1vZGVsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBNYWluIG1vZGVsIGZvciBNeSBTb2xhciBTeXN0ZW0gc2ltLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEFndXN0w61uIFZhbGxlam8gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IG15U29sYXJTeXN0ZW0gZnJvbSAnLi4vLi4vbXlTb2xhclN5c3RlbS5qcyc7XHJcbmltcG9ydCBTb2xhclN5c3RlbUNvbW1vbk1vZGVsLCB7IENvbW1vbk1vZGVsT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NvbGFyLXN5c3RlbS1jb21tb24vanMvbW9kZWwvU29sYXJTeXN0ZW1Db21tb25Nb2RlbC5qcyc7XHJcbmltcG9ydCBOdW1lcmljYWxFbmdpbmUgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL051bWVyaWNhbEVuZ2luZS5qcyc7XHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQ2VudGVyT2ZNYXNzIGZyb20gJy4vQ2VudGVyT2ZNYXNzLmpzJztcclxuXHJcbmV4cG9ydCB0eXBlIE15U29sYXJTeXN0ZW1Nb2RlbE9wdGlvbnMgPSBDb21tb25Nb2RlbE9wdGlvbnM8TnVtZXJpY2FsRW5naW5lPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE15U29sYXJTeXN0ZW1Nb2RlbCBleHRlbmRzIFNvbGFyU3lzdGVtQ29tbW9uTW9kZWw8TnVtZXJpY2FsRW5naW5lPiB7XHJcbiAgcHVibGljIHJlYWRvbmx5IHN5c3RlbUNlbnRlcmVkUHJvcGVydHk7XHJcbiAgcHVibGljIHJlYWRvbmx5IGNlbnRlck9mTWFzczogQ2VudGVyT2ZNYXNzO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3ZpZGVkT3B0aW9uczogTXlTb2xhclN5c3RlbU1vZGVsT3B0aW9ucyApIHtcclxuICAgIHN1cGVyKCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCB0YW5kZW0gPSBwcm92aWRlZE9wdGlvbnMudGFuZGVtO1xyXG5cclxuICAgIHRoaXMuc3lzdGVtQ2VudGVyZWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUsIHsgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnc3lzdGVtQ2VudGVyZWRQcm9wZXJ0eScgKSB9ICk7XHJcblxyXG4gICAgdGhpcy5jZW50ZXJPZk1hc3MgPSBuZXcgQ2VudGVyT2ZNYXNzKCB0aGlzLmJvZGllcyApO1xyXG5cclxuICAgIC8vIFJlLWNlbnRlciB0aGUgYm9kaWVzIGFuZCBzZXQgQ2VudGVyIG9mIE1hc3Mgc3BlZWQgdG8gMCB3aGVuIHRoZSBzeXN0ZW1DZW50ZXJlZCBvcHRpb24gaXMgc2VsZWN0ZWRcclxuICAgIHRoaXMuc3lzdGVtQ2VudGVyZWRQcm9wZXJ0eS5sYXp5TGluayggc3lzdGVtQ2VudGVyZWQgPT4ge1xyXG4gICAgICBpZiAoIHN5c3RlbUNlbnRlcmVkICkge1xyXG4gICAgICAgIHRoaXMuZm9sbG93QW5kQ2VudGVyQ2VudGVyT2ZNYXNzKCk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnVzZXJJbnRlcmFjdGluZ0VtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgICAgdGhpcy5zeXN0ZW1DZW50ZXJlZFByb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvLyBDYWxjdWxhdGVzIHRoZSBwb3NpdGlvbiBhbmQgdmVsb2NpdHkgb2YgdGhlIENvTSBhbmQgY29ycmVjdHMgdGhlIGJvZGllcyBwb3NpdGlvbiBhbmQgdmVsb2NpdGllcyBhY2NvcmRpbmdseVxyXG4gIC8vIEFmdGVyIHRoaXMsIHRoZSBDb00gd2lsbCBiZSBzdGFuZGluZyBzdGlsbCBhbmQgaW4gdGhlIGNlbnRlciBvZiB0aGUgc2ltLlxyXG4gIHB1YmxpYyBmb2xsb3dBbmRDZW50ZXJDZW50ZXJPZk1hc3MoKTogdm9pZCB7XHJcbiAgICBjb25zdCB3YXNQbGF5aW5nQmVmb3JlID0gdGhpcy5pc1BsYXlpbmdQcm9wZXJ0eS52YWx1ZTtcclxuICAgIHRoaXMuaXNQbGF5aW5nUHJvcGVydHkudmFsdWUgPSBmYWxzZTsgLy8gUGF1c2UgdGhlIHNpbVxyXG4gICAgdGhpcy5jZW50ZXJPZk1hc3MudXBkYXRlKCk7XHJcbiAgICBjb25zdCBjZW50ZXJPZk1hc3NQb3NpdGlvbiA9IHRoaXMuY2VudGVyT2ZNYXNzLnBvc2l0aW9uUHJvcGVydHkudmFsdWU7XHJcbiAgICBjb25zdCBjZW50ZXJPZk1hc3NWZWxvY2l0eSA9IHRoaXMuY2VudGVyT2ZNYXNzLnZlbG9jaXR5UHJvcGVydHkudmFsdWU7XHJcbiAgICB0aGlzLmJvZGllcy5mb3JFYWNoKCBib2R5ID0+IHtcclxuICAgICAgYm9keS5jbGVhclBhdGgoKTtcclxuICAgICAgYm9keS5wb3NpdGlvblByb3BlcnR5LnNldCggYm9keS5wb3NpdGlvblByb3BlcnR5LnZhbHVlLm1pbnVzKCBjZW50ZXJPZk1hc3NQb3NpdGlvbiApICk7XHJcbiAgICAgIGJvZHkudmVsb2NpdHlQcm9wZXJ0eS5zZXQoIGJvZHkudmVsb2NpdHlQcm9wZXJ0eS52YWx1ZS5taW51cyggY2VudGVyT2ZNYXNzVmVsb2NpdHkgKSApO1xyXG4gICAgfSApO1xyXG4gICAgaWYgKCB3YXNQbGF5aW5nQmVmb3JlICkge1xyXG4gICAgICB0aGlzLmlzUGxheWluZ1Byb3BlcnR5LnZhbHVlID0gdHJ1ZTsgLy8gUmVzdW1lIHRoZSBzaW1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBmb2xsb3dDZW50ZXJPZk1hc3MoKTogdm9pZCB7XHJcbiAgICB0aGlzLmNlbnRlck9mTWFzcy51cGRhdGUoKTtcclxuXHJcbiAgICAvLyBNYWtlIHRoZSBjZW50ZXIgb2YgbWFzcyBmaXhlZCwgYnV0IG5vdCBuZWNlc3NhcmlseSBjZW50ZXJlZFxyXG4gICAgY29uc3QgY2VudGVyT2ZNYXNzVmVsb2NpdHkgPSB0aGlzLmNlbnRlck9mTWFzcy52ZWxvY2l0eVByb3BlcnR5LnZhbHVlO1xyXG4gICAgdGhpcy5ib2RpZXMuZm9yRWFjaCggYm9keSA9PiB7XHJcbiAgICAgIGJvZHkudmVsb2NpdHlQcm9wZXJ0eS5zZXQoIGJvZHkudmVsb2NpdHlQcm9wZXJ0eS52YWx1ZS5taW51cyggY2VudGVyT2ZNYXNzVmVsb2NpdHkgKSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFVwZGF0ZSBDZW50ZXIgb2YgTWFzcyB0byBhdm9pZCBzeXN0ZW0ncyBpbml0aWFsIG1vdmVtZW50XHJcbiAgICB0aGlzLmNlbnRlck9mTWFzcy51cGRhdGUoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSB1cGRhdGUoKTogdm9pZCB7XHJcbiAgICBzdXBlci51cGRhdGUoKTtcclxuICAgIHRoaXMuY2VudGVyT2ZNYXNzLnVwZGF0ZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgc3VwZXIucmVzZXQoKTtcclxuICAgIHRoaXMuY2VudGVyT2ZNYXNzLnZpc2libGVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gIH1cclxufVxyXG5cclxubXlTb2xhclN5c3RlbS5yZWdpc3RlciggJ015U29sYXJTeXN0ZW1Nb2RlbCcsIE15U29sYXJTeXN0ZW1Nb2RlbCApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxhQUFhLE1BQU0sd0JBQXdCO0FBQ2xELE9BQU9DLHNCQUFzQixNQUE4QixvRUFBb0U7QUFFL0gsT0FBT0MsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxZQUFZLE1BQU0sbUJBQW1CO0FBSTVDLGVBQWUsTUFBTUMsa0JBQWtCLFNBQVNILHNCQUFzQixDQUFrQjtFQUkvRUksV0FBV0EsQ0FBRUMsZUFBMEMsRUFBRztJQUMvRCxLQUFLLENBQUVBLGVBQWdCLENBQUM7SUFFeEIsTUFBTUMsTUFBTSxHQUFHRCxlQUFlLENBQUNDLE1BQU07SUFFckMsSUFBSSxDQUFDQyxzQkFBc0IsR0FBRyxJQUFJTixlQUFlLENBQUUsSUFBSSxFQUFFO01BQUVLLE1BQU0sRUFBRUEsTUFBTSxDQUFDRSxZQUFZLENBQUUsd0JBQXlCO0lBQUUsQ0FBRSxDQUFDO0lBRXRILElBQUksQ0FBQ0MsWUFBWSxHQUFHLElBQUlQLFlBQVksQ0FBRSxJQUFJLENBQUNRLE1BQU8sQ0FBQzs7SUFFbkQ7SUFDQSxJQUFJLENBQUNILHNCQUFzQixDQUFDSSxRQUFRLENBQUVDLGNB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