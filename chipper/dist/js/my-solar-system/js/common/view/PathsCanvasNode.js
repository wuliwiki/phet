// Copyright 2022-2023, University of Colorado Boulder

/**
 * Shows the "trail" left behind by a Body as it moves over time, which disappears after about 2 orbits
 * This is named "Path" instead of "trail" since that is how it is supposed to appear to the students.
 *
 * Note: In the Java sim this was PathNode and there was one Node for each body. For performance reasons, it
 * has been changed so that there is just one CanvasNode shared between all of the bodies.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Aaron Davis (PhET Interactive Simulations)
 */

import Utils from '../../../../dot/js/Utils.js';
import { CanvasNode } from '../../../../scenery/js/imports.js';
import mySolarSystem from '../../mySolarSystem.js';
import optionize from '../../../../phet-core/js/optionize.js';
import stepTimer from '../../../../axon/js/stepTimer.js';
// constants
const STROKE_WIDTH = 3;
export default class PathsCanvasNode extends CanvasNode {
  constructor(bodies, transformProperty, visibleBoundsProperty, providedOptions) {
    const options = optionize()({
      preventFit: true
    }, providedOptions);
    super(options);
    visibleBoundsProperty.link(bounds => {
      this.canvasBounds = bounds;
    });
    this.transformProperty = transformProperty;
    this.bodies = bodies;
    stepTimer.addListener(() => this.invalidatePaint());
  }
  paintCanvas(context) {
    let j;

    // draw the path for each body one by one
    for (let i = 0; i < this.bodies.length; i++) {
      const body = this.bodies[i];
      const points = body.pathPoints.map(point => this.transformProperty.value.modelToViewPosition(point));

      // max path length in view coordinates
      const maxPathLength = this.transformProperty.get().modelToViewDeltaX(1200);
      const fadePathLength = maxPathLength * 0.15; // fade length is ~15% of the path

      context.strokeStyle = body.colorProperty.value.toCSS();
      context.lineWidth = STROKE_WIDTH;
      context.lineCap = 'round';
      context.lineJoin = 'round';
      context.beginPath();

      // Create and render the solid part as a path. New points are added at the tail of the list,
      // so easiest to render backwards for fade-out.
      if (points.length > 0) {
        context.moveTo(points[points.length - 1].x, points[points.length - 1].y);
      }
      j = points.length - 1;
      let pathLength = 0;
      while (pathLength < maxPathLength - fadePathLength && j > 0) {
        context.lineTo(points[j].x, points[j].y);
        if (j > 1) {
          // increment the path length by the length of the added segment
          const segDifX = points[j].x - points[j - 1].x;
          const segDifY = points[j].y - points[j - 1].y;

          // avoid using vector2 to prevent excess object allocation
          const segLength = Math.sqrt(segDifX * segDifX + segDifY * segDifY);
          pathLength += segLength;
        }
        j--;
      }
      context.stroke();

      // Draw the faded out part

      // Using "butt" is too "feathered" and makes the stroke look less bold than it should be
      context.lineCap = 'square';

      // Using "square" makes the stroke too wide, so we must trim it down accordingly.
      context.lineWidth = STROKE_WIDTH * 0.7;
      const faded = body.colorProperty.value;
      while (pathLength < maxPathLength && j > 0) {
        assert && assert(pathLength > maxPathLength - fadePathLength, 'the path length is too small to start fading');

        // fade out a little bit each segment
        const alpha = Utils.linear(maxPathLength - fadePathLength, maxPathLength, 1, 0, pathLength);

        // format without Color to avoid unnecessary allocation
        const fade = `rgba(${faded.r},${faded.g},${faded.b},${alpha})`;
        context.beginPath();
        context.strokeStyle = fade;
        context.moveTo(points[j + 1].x, points[j + 1].y);
        context.lineTo(points[j].x, points[j].y);
        context.stroke();

        // increment the path length by the length of the added segment
        const segDifX = points[j].x - points[j - 1].x;
        const segDifY = points[j].y - points[j - 1].y;

        // avoid using vector2 to prevent excess object allocation
        const segLength = Math.sqrt(segDifX * segDifX + segDifY * segDifY);
        pathLength += segLength;
        j--;
      }
      if (pathLength > maxPathLength) {
        while (j >= 0) {
          points.shift();
          j--;
        }
      }
    }
  }
}
mySolarSystem.register('PathsCanvasNode', PathsCanvasNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIkNhbnZhc05vZGUiLCJteVNvbGFyU3lzdGVtIiwib3B0aW9uaXplIiwic3RlcFRpbWVyIiwiU1RST0tFX1dJRFRIIiwiUGF0aHNDYW52YXNOb2RlIiwiY29uc3RydWN0b3IiLCJib2RpZXMiLCJ0cmFuc2Zvcm1Qcm9wZXJ0eSIsInZpc2libGVCb3VuZHNQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJwcmV2ZW50Rml0IiwibGluayIsImJvdW5kcyIsImNhbnZhc0JvdW5kcyIsImFkZExpc3RlbmVyIiwiaW52YWxpZGF0ZVBhaW50IiwicGFpbnRDYW52YXMiLCJjb250ZXh0IiwiaiIsImkiLCJsZW5ndGgiLCJib2R5IiwicG9pbnRzIiwicGF0aFBvaW50cyIsIm1hcCIsInBvaW50IiwidmFsdWUiLCJtb2RlbFRvVmlld1Bvc2l0aW9uIiwibWF4UGF0aExlbmd0aCIsImdldCIsIm1vZGVsVG9WaWV3RGVsdGFYIiwiZmFkZVBhdGhMZW5ndGgiLCJzdHJva2VTdHlsZSIsImNvbG9yUHJvcGVydHkiLCJ0b0NTUyIsImxpbmVXaWR0aCIsImxpbmVDYXAiLCJsaW5lSm9pbiIsImJlZ2luUGF0aCIsIm1vdmVUbyIsIngiLCJ5IiwicGF0aExlbmd0aCIsImxpbmVUbyIsInNlZ0RpZlgiLCJzZWdEaWZZIiwic2VnTGVuZ3RoIiwiTWF0aCIsInNxcnQiLCJzdHJva2UiLCJmYWRlZCIsImFzc2VydCIsImFscGhhIiwibGluZWFyIiwiZmFkZSIsInIiLCJnIiwiYiIsInNoaWZ0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQYXRoc0NhbnZhc05vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjItMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2hvd3MgdGhlIFwidHJhaWxcIiBsZWZ0IGJlaGluZCBieSBhIEJvZHkgYXMgaXQgbW92ZXMgb3ZlciB0aW1lLCB3aGljaCBkaXNhcHBlYXJzIGFmdGVyIGFib3V0IDIgb3JiaXRzXHJcbiAqIFRoaXMgaXMgbmFtZWQgXCJQYXRoXCIgaW5zdGVhZCBvZiBcInRyYWlsXCIgc2luY2UgdGhhdCBpcyBob3cgaXQgaXMgc3VwcG9zZWQgdG8gYXBwZWFyIHRvIHRoZSBzdHVkZW50cy5cclxuICpcclxuICogTm90ZTogSW4gdGhlIEphdmEgc2ltIHRoaXMgd2FzIFBhdGhOb2RlIGFuZCB0aGVyZSB3YXMgb25lIE5vZGUgZm9yIGVhY2ggYm9keS4gRm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMsIGl0XHJcbiAqIGhhcyBiZWVuIGNoYW5nZWQgc28gdGhhdCB0aGVyZSBpcyBqdXN0IG9uZSBDYW52YXNOb2RlIHNoYXJlZCBiZXR3ZWVuIGFsbCBvZiB0aGUgYm9kaWVzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIEFhcm9uIERhdmlzIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgeyBDYW52YXNOb2RlLCBDYW52YXNOb2RlT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBteVNvbGFyU3lzdGVtIGZyb20gJy4uLy4uL215U29sYXJTeXN0ZW0uanMnO1xyXG5pbXBvcnQgQm9keSBmcm9tICcuLi8uLi8uLi8uLi9zb2xhci1zeXN0ZW0tY29tbW9uL2pzL21vZGVsL0JvZHkuanMnO1xyXG5pbXBvcnQgTW9kZWxWaWV3VHJhbnNmb3JtMiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBzdGVwVGltZXIgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9zdGVwVGltZXIuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0gRW1wdHlTZWxmT3B0aW9ucztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBTVFJPS0VfV0lEVEggPSAzO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGF0aHNDYW52YXNOb2RlIGV4dGVuZHMgQ2FudmFzTm9kZSB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSB0cmFuc2Zvcm1Qcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8TW9kZWxWaWV3VHJhbnNmb3JtMj47XHJcbiAgcHJpdmF0ZSByZWFkb25seSBib2RpZXM6IEJvZHlbXTtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBib2RpZXM6IEJvZHlbXSwgdHJhbnNmb3JtUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PE1vZGVsVmlld1RyYW5zZm9ybTI+LCB2aXNpYmxlQm91bmRzUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PEJvdW5kczI+LCBwcm92aWRlZE9wdGlvbnM/OiBDYW52YXNOb2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPENhbnZhc05vZGVPcHRpb25zLCBTZWxmT3B0aW9ucywgQ2FudmFzTm9kZU9wdGlvbnM+KCkoIHtcclxuICAgICAgcHJldmVudEZpdDogdHJ1ZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICB2aXNpYmxlQm91bmRzUHJvcGVydHkubGluayggYm91bmRzID0+IHtcclxuICAgICAgdGhpcy5jYW52YXNCb3VuZHMgPSBib3VuZHM7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy50cmFuc2Zvcm1Qcm9wZXJ0eSA9IHRyYW5zZm9ybVByb3BlcnR5O1xyXG4gICAgdGhpcy5ib2RpZXMgPSBib2RpZXM7XHJcblxyXG4gICAgc3RlcFRpbWVyLmFkZExpc3RlbmVyKCAoKSA9PiB0aGlzLmludmFsaWRhdGVQYWludCgpICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcGFpbnRDYW52YXMoIGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCApOiB2b2lkIHtcclxuICAgIGxldCBqO1xyXG5cclxuICAgIC8vIGRyYXcgdGhlIHBhdGggZm9yIGVhY2ggYm9keSBvbmUgYnkgb25lXHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmJvZGllcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgYm9keSA9IHRoaXMuYm9kaWVzWyBpIF07XHJcblxyXG4gICAgICBjb25zdCBwb2ludHMgPSBib2R5LnBhdGhQb2ludHMubWFwKCBwb2ludCA9PiB0aGlzLnRyYW5zZm9ybVByb3BlcnR5LnZhbHVlLm1vZGVsVG9WaWV3UG9zaXRpb24oIHBvaW50ICkgKTtcclxuXHJcbiAgICAgIC8vIG1heCBwYXRoIGxlbmd0aCBpbiB2aWV3IGNvb3JkaW5hdGVzXHJcbiAgICAgIGNvbnN0IG1heFBhdGhMZW5ndGggPSB0aGlzLnRyYW5zZm9ybVByb3BlcnR5LmdldCgpLm1vZGVsVG9WaWV3RGVsdGFYKCAxMjAwICk7XHJcbiAgICAgIGNvbnN0IGZhZGVQYXRoTGVuZ3RoID0gbWF4UGF0aExlbmd0aCAqIDAuMTU7IC8vIGZhZGUgbGVuZ3RoIGlzIH4xNSUgb2YgdGhlIHBhdGhcclxuXHJcbiAgICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBib2R5LmNvbG9yUHJvcGVydHkudmFsdWUudG9DU1MoKTtcclxuICAgICAgY29udGV4dC5saW5lV2lkdGggPSBTVFJPS0VfV0lEVEg7XHJcbiAgICAgIGNvbnRleHQubGluZUNhcCA9ICdyb3VuZCc7XHJcbiAgICAgIGNvbnRleHQubGluZUpvaW4gPSAncm91bmQnO1xyXG4gICAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xyXG5cclxuICAgICAgLy8gQ3JlYXRlIGFuZCByZW5kZXIgdGhlIHNvbGlkIHBhcnQgYXMgYSBwYXRoLiBOZXcgcG9pbnRzIGFyZSBhZGRlZCBhdCB0aGUgdGFpbCBvZiB0aGUgbGlzdCxcclxuICAgICAgLy8gc28gZWFzaWVzdCB0byByZW5kZXIgYmFja3dhcmRzIGZvciBmYWRlLW91dC5cclxuICAgICAgaWYgKCBwb2ludHMubGVuZ3RoID4gMCApIHtcclxuICAgICAgICBjb250ZXh0Lm1vdmVUbyggcG9pbnRzWyBwb2ludHMubGVuZ3RoIC0gMSBdLngsIHBvaW50c1sgcG9pbnRzLmxlbmd0aCAtIDEgXS55ICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGogPSBwb2ludHMubGVuZ3RoIC0gMTtcclxuXHJcbiAgICAgIGxldCBwYXRoTGVuZ3RoID0gMDtcclxuICAgICAgd2hpbGUgKCBwYXRoTGVuZ3RoIDwgbWF4UGF0aExlbmd0aCAtIGZhZGVQYXRoTGVuZ3RoICYmIGogPiAwICkge1xyXG4gICAgICAgIGNvbnRleHQubGluZVRvKCBwb2ludHNbIGogXS54LCBwb2ludHNbIGogXS55ICk7XHJcbiAgICAgICAgaWYgKCBqID4gMSApIHtcclxuXHJcbiAgICAgICAgICAvLyBpbmNyZW1lbnQgdGhlIHBhdGggbGVuZ3RoIGJ5IHRoZSBsZW5ndGggb2YgdGhlIGFkZGVkIHNlZ21lbnRcclxuICAgICAgICAgIGNvbnN0IHNlZ0RpZlggPSBwb2ludHNbIGogXS54IC0gcG9pbnRzWyBqIC0gMSBdLng7XHJcbiAgICAgICAgICBjb25zdCBzZWdEaWZZID0gcG9pbnRzWyBqIF0ueSAtIHBvaW50c1sgaiAtIDEgXS55O1xyXG5cclxuICAgICAgICAgIC8vIGF2b2lkIHVzaW5nIHZlY3RvcjIgdG8gcHJldmVudCBleGNlc3Mgb2JqZWN0IGFsbG9jYXRpb25cclxuICAgICAgICAgIGNvbnN0IHNlZ0xlbmd0aCA9IE1hdGguc3FydCggc2VnRGlmWCAqIHNlZ0RpZlggKyBzZWdEaWZZICogc2VnRGlmWSApO1xyXG4gICAgICAgICAgcGF0aExlbmd0aCArPSBzZWdMZW5ndGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGotLTtcclxuICAgICAgfVxyXG4gICAgICBjb250ZXh0LnN0cm9rZSgpO1xyXG5cclxuICAgICAgLy8gRHJhdyB0aGUgZmFkZWQgb3V0IHBhcnRcclxuXHJcbiAgICAgIC8vIFVzaW5nIFwiYnV0dFwiIGlzIHRvbyBcImZlYXRoZXJlZFwiIGFuZCBtYWtlcyB0aGUgc3Ryb2tlIGxvb2sgbGVzcyBib2xkIHRoYW4gaXQgc2hvdWxkIGJlXHJcbiAgICAgIGNvbnRleHQubGluZUNhcCA9ICdzcXVhcmUnO1xyXG5cclxuICAgICAgLy8gVXNpbmcgXCJzcXVhcmVcIiBtYWtlcyB0aGUgc3Ryb2tlIHRvbyB3aWRlLCBzbyB3ZSBtdXN0IHRyaW0gaXQgZG93biBhY2NvcmRpbmdseS5cclxuICAgICAgY29udGV4dC5saW5lV2lkdGggPSBTVFJPS0VfV0lEVEggKiAwLjc7XHJcblxyXG4gICAgICBjb25zdCBmYWRlZCA9IGJvZHkuY29sb3JQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICAgIHdoaWxlICggcGF0aExlbmd0aCA8IG1heFBhdGhMZW5ndGggJiYgaiA+IDAgKSB7XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggcGF0aExlbmd0aCA+IG1heFBhdGhMZW5ndGggLSBmYWRlUGF0aExlbmd0aCwgJ3RoZSBwYXRoIGxlbmd0aCBpcyB0b28gc21hbGwgdG8gc3RhcnQgZmFkaW5nJyApO1xyXG5cclxuICAgICAgICAvLyBmYWRlIG91dCBhIGxpdHRsZSBiaXQgZWFjaCBzZWdtZW50XHJcbiAgICAgICAgY29uc3QgYWxwaGEgPSBVdGlscy5saW5lYXIoIG1heFBhdGhMZW5ndGggLSBmYWRlUGF0aExlbmd0aCwgbWF4UGF0aExlbmd0aCwgMSwgMCwgcGF0aExlbmd0aCApO1xyXG5cclxuICAgICAgICAvLyBmb3JtYXQgd2l0aG91dCBDb2xvciB0byBhdm9pZCB1bm5lY2Vzc2FyeSBhbGxvY2F0aW9uXHJcbiAgICAgICAgY29uc3QgZmFkZSA9IGByZ2JhKCR7ZmFkZWQucn0sJHtmYWRlZC5nfSwke2ZhZGVkLmJ9LCR7YWxwaGF9KWA7XHJcblxyXG4gICAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgY29udGV4dC5zdHJva2VTdHlsZSA9IGZhZGU7XHJcbiAgICAgICAgY29udGV4dC5tb3ZlVG8oIHBvaW50c1sgaiArIDEgXS54LCBwb2ludHNbIGogKyAxIF0ueSApO1xyXG4gICAgICAgIGNvbnRleHQubGluZVRvKCBwb2ludHNbIGogXS54LCBwb2ludHNbIGogXS55ICk7XHJcbiAgICAgICAgY29udGV4dC5zdHJva2UoKTtcclxuXHJcbiAgICAgICAgLy8gaW5jcmVtZW50IHRoZSBwYXRoIGxlbmd0aCBieSB0aGUgbGVuZ3RoIG9mIHRoZSBhZGRlZCBzZWdtZW50XHJcbiAgICAgICAgY29uc3Qgc2VnRGlmWCA9IHBvaW50c1sgaiBdLnggLSBwb2ludHNbIGogLSAxIF0ueDtcclxuICAgICAgICBjb25zdCBzZWdEaWZZID0gcG9pbnRzWyBqIF0ueSAtIHBvaW50c1sgaiAtIDEgXS55O1xyXG5cclxuICAgICAgICAvLyBhdm9pZCB1c2luZyB2ZWN0b3IyIHRvIHByZXZlbnQgZXhjZXNzIG9iamVjdCBhbGxvY2F0aW9uXHJcbiAgICAgICAgY29uc3Qgc2VnTGVuZ3RoID0gTWF0aC5zcXJ0KCBzZWdEaWZYICogc2VnRGlmWCArIHNlZ0RpZlkgKiBzZWdEaWZZICk7XHJcbiAgICAgICAgcGF0aExlbmd0aCArPSBzZWdMZW5ndGg7XHJcbiAgICAgICAgai0tO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIHBhdGhMZW5ndGggPiBtYXhQYXRoTGVuZ3RoICkge1xyXG4gICAgICAgIHdoaWxlICggaiA+PSAwICkge1xyXG4gICAgICAgICAgcG9pbnRzLnNoaWZ0KCk7XHJcbiAgICAgICAgICBqLS07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5teVNvbGFyU3lzdGVtLnJlZ2lzdGVyKCAnUGF0aHNDYW52YXNOb2RlJywgUGF0aHNDYW52YXNOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLFNBQVNDLFVBQVUsUUFBMkIsbUNBQW1DO0FBQ2pGLE9BQU9DLGFBQWEsTUFBTSx3QkFBd0I7QUFJbEQsT0FBT0MsU0FBUyxNQUE0Qix1Q0FBdUM7QUFDbkYsT0FBT0MsU0FBUyxNQUFNLGtDQUFrQztBQUt4RDtBQUNBLE1BQU1DLFlBQVksR0FBRyxDQUFDO0FBRXRCLGVBQWUsTUFBTUMsZUFBZSxTQUFTTCxVQUFVLENBQUM7RUFJL0NNLFdBQVdBLENBQUVDLE1BQWMsRUFBRUMsaUJBQXlELEVBQUVDLHFCQUFpRCxFQUFFQyxlQUFtQyxFQUFHO0lBRXRMLE1BQU1DLE9BQU8sR0FBR1QsU0FBUyxDQUFvRCxDQUFDLENBQUU7TUFDOUVVLFVBQVUsRUFBRTtJQUNkLENBQUMsRUFBRUYsZUFBZ0IsQ0FBQztJQUVwQixLQUFLLENBQUVDLE9BQVEsQ0FBQztJQUVoQkYscUJBQXFCLENBQUNJLElBQUksQ0FBRUMsTUFBTSxJQUFJO01BQ3BDLElBQUksQ0FBQ0MsWUFBWSxHQUFHRCxNQUFNO0lBQzVCLENBQUUsQ0FBQztJQUVILElBQUksQ0FBQ04saUJBQWlCLEdBQUdBLGlCQUFpQjtJQUMxQyxJQUFJLENBQUNELE1BQU0sR0FBR0EsTUFBTTtJQUVwQkosU0FBUyxDQUFDYSxXQUFXLENBQUUsTUFBTSxJQUFJLENBQUNDLGVBQWUsQ0FBQyxDQUFFLENBQUM7RUFDdkQ7RUFFT0MsV0FB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