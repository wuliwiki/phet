// Copyright 2022-2023, University of Colorado Boulder

/**
 * The panel that shows the numeric values of Mass, Position and Velocity.
 * Depending on model.moreDataProperty it will show either NumberDisplays or mass sliders.
 *
 * @author AgustÃ­n Vallejo (PhET Interactive Simulations)
 */

import mySolarSystem from '../../mySolarSystem.js';
import { AlignGroup, HBox, RichText, Text, VBox } from '../../../../scenery/js/imports.js';
import { combineOptions } from '../../../../phet-core/js/optionize.js';
import Panel from '../../../../sun/js/Panel.js';
import MySolarSystemStrings from '../../MySolarSystemStrings.js';
import SolarSystemCommonConstants from '../../../../solar-system-common/js/SolarSystemCommonConstants.js';
import ValuesColumnTypes from './ValuesColumnTypes.js';
import ValuesColumnNode from './ValuesColumnNode.js';
import PatternStringProperty from '../../../../axon/js/PatternStringProperty.js';
import SolarSystemCommonColors from '../../../../solar-system-common/js/SolarSystemCommonColors.js';
import SolarSystemCommonStrings from '../../../../solar-system-common/js/SolarSystemCommonStrings.js';
const COMPONENT_COLUMN_GROUP_ALIGN_GROUP = new AlignGroup({
  matchHorizontal: true,
  matchVertical: false
});

// AlignGroup for the title-labels that are placed above each group (like "Position (m)"). This is made to match the
// vertical height of each title-label across screens, regardless of their scaling.
const TITLE_ALIGN_GROUP = new AlignGroup({
  matchHorizontal: false,
  matchVertical: true
});
const TEXT_MAX_WIDTH = 150;
export default class FullDataPanel extends Panel {
  constructor(model) {
    const options = {
      xMargin: 12,
      stroke: null,
      fill: SolarSystemCommonColors.controlPanelFillProperty
    };

    //----------------------------------------------------------------------------------------
    // Create Values Columns for each ValuesColumnType available, for them to be later added to the panel
    const massColumnNode = new ValuesColumnNode(model, ValuesColumnTypes.MASS);
    const massSliderColumnNode = new ValuesColumnNode(model, ValuesColumnTypes.MASS_SLIDER);
    const positionXColumnNode = new ValuesColumnNode(model, ValuesColumnTypes.POSITION_X);
    const positionYColumnNode = new ValuesColumnNode(model, ValuesColumnTypes.POSITION_Y);
    const velocityXColumnNode = new ValuesColumnNode(model, ValuesColumnTypes.VELOCITY_X);
    const velocityYColumnNode = new ValuesColumnNode(model, ValuesColumnTypes.VELOCITY_Y);
    const ballIconsColumnNode = new ValuesColumnNode(model, ValuesColumnTypes.BODY_ICONS);
    const componentColumnsSpacing = 12;
    const positionColumnGroup = new HBox({
      children: [positionXColumnNode, positionYColumnNode],
      spacing: componentColumnsSpacing
    });
    const velocityColumnGroup = new HBox({
      children: [velocityXColumnNode, velocityYColumnNode],
      spacing: componentColumnsSpacing
    });
    //----------------------------------------------------------------------------------------

    // Convenience function to create the title-label that appears above each column group.
    const createTitleLabel = (label, units, useUnits = true) => {
      const titleStringProperty = new PatternStringProperty(MySolarSystemStrings.pattern.labelParenthesesUnitsStringProperty, {
        label: label,
        units: units
      });

      // Wrap the text in an AlignGroup to match height.
      return TITLE_ALIGN_GROUP.createBox(new RichText(titleStringProperty, combineOptions({
        maxWidth: TEXT_MAX_WIDTH
      }, SolarSystemCommonConstants.TEXT_OPTIONS)));
    };
    const massTitleWithoutUnits = TITLE_ALIGN_GROUP.createBox(new Text(MySolarSystemStrings.massStringProperty, combineOptions({
      maxWidth: TEXT_MAX_WIDTH
    }, SolarSystemCommonConstants.TEXT_OPTIONS)));
    const massTitleWithUnits = createTitleLabel(MySolarSystemStrings.dataPanel.massStringProperty, MySolarSystemStrings.units.kgStringProperty);
    const massTitleNode = model.isLab ? massTitleWithUnits : massTitleWithoutUnits;
    const positionTitleNode = createTitleLabel(MySolarSystemStrings.dataPanel.positionStringProperty, SolarSystemCommonStrings.units.AUStringProperty);
    const velocityTitleNode = createTitleLabel(MySolarSystemStrings.dataPanel.velocityStringProperty, SolarSystemCommonStrings.units.kmsStringProperty);

    //----------------------------------------------------------------------------------------

    // Convenience function to create each section of the Panel, which includes the column group and a title above it.
    const createSectionNode = (titleNode, columnGroup, isComponentColumnGroup = true) => {
      return new VBox({
        children: [titleNode,
        // If the group is a grouping of component columns, wrap the column group in an align group to match width.
        isComponentColumnGroup ? COMPONENT_COLUMN_GROUP_ALIGN_GROUP.createBox(columnGroup) : columnGroup],
        spacing: 0.5
      });
    };

    // Horizontally group the column groups with their respective title-labels.
    const massSectionNode = createSectionNode(massTitleNode, massColumnNode, false);
    const positionSectionNode = createSectionNode(positionTitleNode, positionColumnGroup);
    const velocitySectionNode = createSectionNode(velocityTitleNode, velocityColumnGroup);
    const columnGroupSpacing = 21;

    // The content of the entire Panel when "More Data" is checked.
    const moreDataBox = new HBox({
      children: [positionSectionNode, velocitySectionNode],
      bottom: 0,
      spacing: columnGroupSpacing
    });

    // The content of the entire Panel when "More Data" is not checked.
    const lessDataBox = massSliderColumnNode;
    lessDataBox.bottom = 0;
    moreDataBox.boundsProperty.link(bounds => {
      lessDataBox.preferredWidth = bounds.width;
    });

    // Observe when the moreDataVisibleProperty changes and update the visibility of the content of the Panel.
    // Link is not removed since BallValuesPanels are never disposed.
    model.moreDataProperty.link(moreDataVisible => {
      moreDataBox.visible = moreDataVisible && model.isLab;
      lessDataBox.visible = !moreDataVisible || !model.isLab;
    });
    const dataNode = new HBox({
      align: 'bottom',
      children: [moreDataBox, lessDataBox]
    });
    super(new HBox({
      spacing: 12,
      children: [ballIconsColumnNode, massSectionNode, dataNode],
      align: 'bottom'
    }), options);
  }
}
mySolarSystem.register('FullDataPanel', FullDataPanel);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJteVNvbGFyU3lzdGVtIiwiQWxpZ25Hcm91cCIsIkhCb3giLCJSaWNoVGV4dCIsIlRleHQiLCJWQm94IiwiY29tYmluZU9wdGlvbnMiLCJQYW5lbCIsIk15U29sYXJTeXN0ZW1TdHJpbmdzIiwiU29sYXJTeXN0ZW1Db21tb25Db25zdGFudHMiLCJWYWx1ZXNDb2x1bW5UeXBlcyIsIlZhbHVlc0NvbHVtbk5vZGUiLCJQYXR0ZXJuU3RyaW5nUHJvcGVydHkiLCJTb2xhclN5c3RlbUNvbW1vbkNvbG9ycyIsIlNvbGFyU3lzdGVtQ29tbW9uU3RyaW5ncyIsIkNPTVBPTkVOVF9DT0xVTU5fR1JPVVBfQUxJR05fR1JPVVAiLCJtYXRjaEhvcml6b250YWwiLCJtYXRjaFZlcnRpY2FsIiwiVElUTEVfQUxJR05fR1JPVVAiLCJURVhUX01BWF9XSURUSCIsIkZ1bGxEYXRhUGFuZWwiLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwib3B0aW9ucyIsInhNYXJnaW4iLCJzdHJva2UiLCJmaWxsIiwiY29udHJvbFBhbmVsRmlsbFByb3BlcnR5IiwibWFzc0NvbHVtbk5vZGUiLCJNQVNTIiwibWFzc1NsaWRlckNvbHVtbk5vZGUiLCJNQVNTX1NMSURFUiIsInBvc2l0aW9uWENvbHVtbk5vZGUiLCJQT1NJVElPTl9YIiwicG9zaXRpb25ZQ29sdW1uTm9kZSIsIlBPU0lUSU9OX1kiLCJ2ZWxvY2l0eVhDb2x1bW5Ob2RlIiwiVkVMT0NJVFlfWCIsInZlbG9jaXR5WUNvbHVtbk5vZGUiLCJWRUxPQ0lUWV9ZIiwiYmFsbEljb25zQ29sdW1uTm9kZSIsIkJPRFlfSUNPTlMiLCJjb21wb25lbnRDb2x1bW5zU3BhY2luZyIsInBvc2l0aW9uQ29sdW1uR3JvdXAiLCJjaGlsZHJlbiIsInNwYWNpbmciLCJ2ZWxvY2l0eUNvbHVtbkdyb3VwIiwiY3JlYXRlVGl0bGVMYWJlbCIsImxhYmVsIiwidW5pdHMiLCJ1c2VVbml0cyIsInRpdGxlU3RyaW5nUHJvcGVydHkiLCJwYXR0ZXJuIiwibGFiZWxQYXJlbnRoZXNlc1VuaXRzU3RyaW5nUHJvcGVydHkiLCJjcmVhdGVCb3giLCJtYXhXaWR0aCIsIlRFWFRfT1BUSU9OUyIsIm1hc3NUaXRsZVdpdGhvdXRVbml0cyIsIm1hc3NTdHJpbmdQcm9wZXJ0eSIsIm1hc3NUaXRsZVdpdGhVbml0cyIsImRhdGFQYW5lbCIsImtnU3RyaW5nUHJvcGVydHkiLCJtYXNzVGl0bGVOb2RlIiwiaXNMYWIiLCJwb3NpdGlvblRpdGxlTm9kZSIsInBvc2l0aW9uU3RyaW5nUHJvcGVydHkiLCJBVVN0cmluZ1Byb3BlcnR5IiwidmVsb2NpdHlUaXRsZU5vZGUiLCJ2ZWxvY2l0eVN0cmluZ1Byb3BlcnR5Iiwia21zU3RyaW5nUHJvcGVydHkiLCJjcmVhdGVTZWN0aW9uTm9kZSIsInRpdGxlTm9kZSIsImNvbHVtbkdyb3VwIiwiaXNDb21wb25lbnRDb2x1bW5Hcm91cCIsIm1hc3NTZWN0aW9uTm9kZSIsInBvc2l0aW9uU2VjdGlvbk5vZGUiLCJ2ZWxvY2l0eVNlY3Rpb25Ob2RlIiwiY29sdW1uR3JvdXBTcGFjaW5nIiwibW9yZURhdGFCb3giLCJib3R0b20iLCJsZXNzRGF0YUJveCIsImJvdW5kc1Byb3BlcnR5IiwibGluayIsImJvdW5kcyIsInByZWZlcnJlZFdpZHRoIiwid2lkdGgiLCJtb3JlRGF0YVByb3BlcnR5IiwibW9yZURhdGFWaXNpYmxlIiwidmlzaWJsZSIsImRhdGFOb2RlIiwiYWxpZ24iLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkZ1bGxEYXRhUGFuZWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjItMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhlIHBhbmVsIHRoYXQgc2hvd3MgdGhlIG51bWVyaWMgdmFsdWVzIG9mIE1hc3MsIFBvc2l0aW9uIGFuZCBWZWxvY2l0eS5cclxuICogRGVwZW5kaW5nIG9uIG1vZGVsLm1vcmVEYXRhUHJvcGVydHkgaXQgd2lsbCBzaG93IGVpdGhlciBOdW1iZXJEaXNwbGF5cyBvciBtYXNzIHNsaWRlcnMuXHJcbiAqXHJcbiAqIEBhdXRob3IgQWd1c3TDrW4gVmFsbGVqbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgbXlTb2xhclN5c3RlbSBmcm9tICcuLi8uLi9teVNvbGFyU3lzdGVtLmpzJztcclxuaW1wb3J0IHsgQWxpZ25Cb3gsIEFsaWduR3JvdXAsIEhCb3gsIE5vZGUsIFJpY2hUZXh0LCBUZXh0LCBUZXh0T3B0aW9ucywgVkJveCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBQYW5lbCBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvUGFuZWwuanMnO1xyXG5pbXBvcnQgTXlTb2xhclN5c3RlbVN0cmluZ3MgZnJvbSAnLi4vLi4vTXlTb2xhclN5c3RlbVN0cmluZ3MuanMnO1xyXG5pbXBvcnQgU29sYXJTeXN0ZW1Db21tb25Db25zdGFudHMgZnJvbSAnLi4vLi4vLi4vLi4vc29sYXItc3lzdGVtLWNvbW1vbi9qcy9Tb2xhclN5c3RlbUNvbW1vbkNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IFZhbHVlc0NvbHVtblR5cGVzIGZyb20gJy4vVmFsdWVzQ29sdW1uVHlwZXMuanMnO1xyXG5pbXBvcnQgVmFsdWVzQ29sdW1uTm9kZSBmcm9tICcuL1ZhbHVlc0NvbHVtbk5vZGUuanMnO1xyXG5pbXBvcnQgUGF0dGVyblN0cmluZ1Byb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUGF0dGVyblN0cmluZ1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFNvbGFyU3lzdGVtQ29tbW9uQ29sb3JzIGZyb20gJy4uLy4uLy4uLy4uL3NvbGFyLXN5c3RlbS1jb21tb24vanMvU29sYXJTeXN0ZW1Db21tb25Db2xvcnMuanMnO1xyXG5pbXBvcnQgTXlTb2xhclN5c3RlbU1vZGVsIGZyb20gJy4uL21vZGVsL015U29sYXJTeXN0ZW1Nb2RlbC5qcyc7XHJcbmltcG9ydCBTb2xhclN5c3RlbUNvbW1vblN0cmluZ3MgZnJvbSAnLi4vLi4vLi4vLi4vc29sYXItc3lzdGVtLWNvbW1vbi9qcy9Tb2xhclN5c3RlbUNvbW1vblN0cmluZ3MuanMnO1xyXG5cclxuY29uc3QgQ09NUE9ORU5UX0NPTFVNTl9HUk9VUF9BTElHTl9HUk9VUCA9IG5ldyBBbGlnbkdyb3VwKCB7IG1hdGNoSG9yaXpvbnRhbDogdHJ1ZSwgbWF0Y2hWZXJ0aWNhbDogZmFsc2UgfSApO1xyXG5cclxuLy8gQWxpZ25Hcm91cCBmb3IgdGhlIHRpdGxlLWxhYmVscyB0aGF0IGFyZSBwbGFjZWQgYWJvdmUgZWFjaCBncm91cCAobGlrZSBcIlBvc2l0aW9uIChtKVwiKS4gVGhpcyBpcyBtYWRlIHRvIG1hdGNoIHRoZVxyXG4vLyB2ZXJ0aWNhbCBoZWlnaHQgb2YgZWFjaCB0aXRsZS1sYWJlbCBhY3Jvc3Mgc2NyZWVucywgcmVnYXJkbGVzcyBvZiB0aGVpciBzY2FsaW5nLlxyXG5jb25zdCBUSVRMRV9BTElHTl9HUk9VUCA9IG5ldyBBbGlnbkdyb3VwKCB7IG1hdGNoSG9yaXpvbnRhbDogZmFsc2UsIG1hdGNoVmVydGljYWw6IHRydWUgfSApO1xyXG5jb25zdCBURVhUX01BWF9XSURUSCA9IDE1MDtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZ1bGxEYXRhUGFuZWwgZXh0ZW5kcyBQYW5lbCB7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBtb2RlbDogTXlTb2xhclN5c3RlbU1vZGVsICkge1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcclxuICAgICAgeE1hcmdpbjogMTIsXHJcbiAgICAgIHN0cm9rZTogbnVsbCxcclxuICAgICAgZmlsbDogU29sYXJTeXN0ZW1Db21tb25Db2xvcnMuY29udHJvbFBhbmVsRmlsbFByb3BlcnR5XHJcbiAgICB9O1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgLy8gQ3JlYXRlIFZhbHVlcyBDb2x1bW5zIGZvciBlYWNoIFZhbHVlc0NvbHVtblR5cGUgYXZhaWxhYmxlLCBmb3IgdGhlbSB0byBiZSBsYXRlciBhZGRlZCB0byB0aGUgcGFuZWxcclxuICAgIGNvbnN0IG1hc3NDb2x1bW5Ob2RlID0gbmV3IFZhbHVlc0NvbHVtbk5vZGUoIG1vZGVsLCBWYWx1ZXNDb2x1bW5UeXBlcy5NQVNTICk7XHJcbiAgICBjb25zdCBtYXNzU2xpZGVyQ29sdW1uTm9kZSA9IG5ldyBWYWx1ZXNDb2x1bW5Ob2RlKCBtb2RlbCwgVmFsdWVzQ29sdW1uVHlwZXMuTUFTU19TTElERVIgKTtcclxuICAgIGNvbnN0IHBvc2l0aW9uWENvbHVtbk5vZGUgPSBuZXcgVmFsdWVzQ29sdW1uTm9kZSggbW9kZWwsIFZhbHVlc0NvbHVtblR5cGVzLlBPU0lUSU9OX1ggKTtcclxuICAgIGNvbnN0IHBvc2l0aW9uWUNvbHVtbk5vZGUgPSBuZXcgVmFsdWVzQ29sdW1uTm9kZSggbW9kZWwsIFZhbHVlc0NvbHVtblR5cGVzLlBPU0lUSU9OX1kgKTtcclxuICAgIGNvbnN0IHZlbG9jaXR5WENvbHVtbk5vZGUgPSBuZXcgVmFsdWVzQ29sdW1uTm9kZSggbW9kZWwsIFZhbHVlc0NvbHVtblR5cGVzLlZFTE9DSVRZX1ggKTtcclxuICAgIGNvbnN0IHZlbG9jaXR5WUNvbHVtbk5vZGUgPSBuZXcgVmFsdWVzQ29sdW1uTm9kZSggbW9kZWwsIFZhbHVlc0NvbHVtblR5cGVzLlZFTE9DSVRZX1kgKTtcclxuICAgIGNvbnN0IGJhbGxJY29uc0NvbHVtbk5vZGUgPSBuZXcgVmFsdWVzQ29sdW1uTm9kZSggbW9kZWwsIFZhbHVlc0NvbHVtblR5cGVzLkJPRFlfSUNPTlMgKTtcclxuXHJcbiAgICBjb25zdCBjb21wb25lbnRDb2x1bW5zU3BhY2luZyA9IDEyO1xyXG4gICAgY29uc3QgcG9zaXRpb25Db2x1bW5Hcm91cCA9IG5ldyBIQm94KCB7IGNoaWxkcmVuOiBbIHBvc2l0aW9uWENvbHVtbk5vZGUsIHBvc2l0aW9uWUNvbHVtbk5vZGUgXSwgc3BhY2luZzogY29tcG9uZW50Q29sdW1uc1NwYWNpbmcgfSApO1xyXG4gICAgY29uc3QgdmVsb2NpdHlDb2x1bW5Hcm91cCA9IG5ldyBIQm94KCB7IGNoaWxkcmVuOiBbIHZlbG9jaXR5WENvbHVtbk5vZGUsIHZlbG9jaXR5WUNvbHVtbk5vZGUgXSwgc3BhY2luZzogY29tcG9uZW50Q29sdW1uc1NwYWNpbmcgfSApO1xyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgLy8gQ29udmVuaWVuY2UgZnVuY3Rpb24gdG8gY3JlYXRlIHRoZSB0aXRsZS1sYWJlbCB0aGF0IGFwcGVhcnMgYWJvdmUgZWFjaCBjb2x1bW4gZ3JvdXAuXHJcbiAgICBjb25zdCBjcmVhdGVUaXRsZUxhYmVsID0gKCBsYWJlbDogVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPiwgdW5pdHM6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4sIHVzZVVuaXRzOiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPiB8IGJvb2xlYW4gPSB0cnVlICkgPT4ge1xyXG4gICAgICBjb25zdCB0aXRsZVN0cmluZ1Byb3BlcnR5ID0gbmV3IFBhdHRlcm5TdHJpbmdQcm9wZXJ0eSggTXlTb2xhclN5c3RlbVN0cmluZ3MucGF0dGVybi5sYWJlbFBhcmVudGhlc2VzVW5pdHNTdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICAgIGxhYmVsOiBsYWJlbCxcclxuICAgICAgICB1bml0czogdW5pdHNcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgLy8gV3JhcCB0aGUgdGV4dCBpbiBhbiBBbGlnbkdyb3VwIHRvIG1hdGNoIGhlaWdodC5cclxuICAgICAgcmV0dXJuIFRJVExFX0FMSUdOX0dST1VQLmNyZWF0ZUJveCggbmV3IFJpY2hUZXh0KCB0aXRsZVN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICAgIGNvbWJpbmVPcHRpb25zPFRleHRPcHRpb25zPigge1xyXG4gICAgICAgICAgbWF4V2lkdGg6IFRFWFRfTUFYX1dJRFRIXHJcbiAgICAgICAgfSwgU29sYXJTeXN0ZW1Db21tb25Db25zdGFudHMuVEVYVF9PUFRJT05TICkgKSApO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBtYXNzVGl0bGVXaXRob3V0VW5pdHMgPSBUSVRMRV9BTElHTl9HUk9VUC5jcmVhdGVCb3goIG5ldyBUZXh0KCBNeVNvbGFyU3lzdGVtU3RyaW5ncy5tYXNzU3RyaW5nUHJvcGVydHksXHJcbiAgICAgIGNvbWJpbmVPcHRpb25zPFRleHRPcHRpb25zPigge1xyXG4gICAgICAgIG1heFdpZHRoOiBURVhUX01BWF9XSURUSFxyXG4gICAgICB9LCBTb2xhclN5c3RlbUNvbW1vbkNvbnN0YW50cy5URVhUX09QVElPTlMgKSApICk7XHJcbiAgICBjb25zdCBtYXNzVGl0bGVXaXRoVW5pdHMgPSBjcmVhdGVUaXRsZUxhYmVsKCBNeVNvbGFyU3lzdGVtU3RyaW5ncy5kYXRhUGFuZWwubWFzc1N0cmluZ1Byb3BlcnR5LCBNeVNvbGFyU3lzdGVtU3RyaW5ncy51bml0cy5rZ1N0cmluZ1Byb3BlcnR5ICk7XHJcbiAgICBjb25zdCBtYXNzVGl0bGVOb2RlID0gbW9kZWwuaXNMYWIgPyBtYXNzVGl0bGVXaXRoVW5pdHMgOiBtYXNzVGl0bGVXaXRob3V0VW5pdHM7XHJcbiAgICBjb25zdCBwb3NpdGlvblRpdGxlTm9kZSA9IGNyZWF0ZVRpdGxlTGFiZWwoIE15U29sYXJTeXN0ZW1TdHJpbmdzLmRhdGFQYW5lbC5wb3NpdGlvblN0cmluZ1Byb3BlcnR5LCBTb2xhclN5c3RlbUNvbW1vblN0cmluZ3MudW5pdHMuQVVTdHJpbmdQcm9wZXJ0eSApO1xyXG4gICAgY29uc3QgdmVsb2NpdHlUaXRsZU5vZGUgPSBjcmVhdGVUaXRsZUxhYmVsKCBNeVNvbGFyU3lzdGVtU3RyaW5ncy5kYXRhUGFuZWwudmVsb2NpdHlTdHJpbmdQcm9wZXJ0eSwgU29sYXJTeXN0ZW1Db21tb25TdHJpbmdzLnVuaXRzLmttc1N0cmluZ1Byb3BlcnR5ICk7XHJcblxyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgLy8gQ29udmVuaWVuY2UgZnVuY3Rpb24gdG8gY3JlYXRlIGVhY2ggc2VjdGlvbiBvZiB0aGUgUGFuZWwsIHdoaWNoIGluY2x1ZGVzIHRoZSBjb2x1bW4gZ3JvdXAgYW5kIGEgdGl0bGUgYWJvdmUgaXQuXHJcbiAgICBjb25zdCBjcmVhdGVTZWN0aW9uTm9kZSA9ICggdGl0bGVOb2RlOiBBbGlnbkJveCwgY29sdW1uR3JvdXA6IE5vZGUsIGlzQ29tcG9uZW50Q29sdW1uR3JvdXAgPSB0cnVlICkgPT4ge1xyXG4gICAgICByZXR1cm4gbmV3IFZCb3goIHtcclxuICAgICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgICAgdGl0bGVOb2RlLFxyXG5cclxuICAgICAgICAgIC8vIElmIHRoZSBncm91cCBpcyBhIGdyb3VwaW5nIG9mIGNvbXBvbmVudCBjb2x1bW5zLCB3cmFwIHRoZSBjb2x1bW4gZ3JvdXAgaW4gYW4gYWxpZ24gZ3JvdXAgdG8gbWF0Y2ggd2lkdGguXHJcbiAgICAgICAgICBpc0NvbXBvbmVudENvbHVtbkdyb3VwID8gQ09NUE9ORU5UX0NPTFVNTl9HUk9VUF9BTElHTl9HUk9VUC5jcmVhdGVCb3goIGNvbHVtbkdyb3VwICkgOiBjb2x1bW5Hcm91cFxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgc3BhY2luZzogMC41XHJcbiAgICAgIH0gKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gSG9yaXpvbnRhbGx5IGdyb3VwIHRoZSBjb2x1bW4gZ3JvdXBzIHdpdGggdGhlaXIgcmVzcGVjdGl2ZSB0aXRsZS1sYWJlbHMuXHJcbiAgICBjb25zdCBtYXNzU2VjdGlvbk5vZGUgPSBjcmVhdGVTZWN0aW9uTm9kZSggbWFzc1RpdGxlTm9kZSwgbWFzc0NvbHVtbk5vZGUsIGZhbHNlICk7XHJcbiAgICBjb25zdCBwb3NpdGlvblNlY3Rpb25Ob2RlID0gY3JlYXRlU2VjdGlvbk5vZGUoIHBvc2l0aW9uVGl0bGVOb2RlLCBwb3NpdGlvbkNvbHVtbkdyb3VwICk7XHJcbiAgICBjb25zdCB2ZWxvY2l0eVNlY3Rpb25Ob2RlID0gY3JlYXRlU2VjdGlvbk5vZGUoIHZlbG9jaXR5VGl0bGVOb2RlLCB2ZWxvY2l0eUNvbHVtbkdyb3VwICk7XHJcblxyXG4gICAgY29uc3QgY29sdW1uR3JvdXBTcGFjaW5nID0gMjE7XHJcblxyXG4gICAgLy8gVGhlIGNvbnRlbnQgb2YgdGhlIGVudGlyZSBQYW5lbCB3aGVuIFwiTW9yZSBEYXRhXCIgaXMgY2hlY2tlZC5cclxuICAgIGNvbnN0IG1vcmVEYXRhQm94ID0gbmV3IEhCb3goIHtcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBwb3NpdGlvblNlY3Rpb25Ob2RlLFxyXG4gICAgICAgIHZlbG9jaXR5U2VjdGlvbk5vZGVcclxuICAgICAgXSxcclxuICAgICAgYm90dG9tOiAwLFxyXG4gICAgICBzcGFjaW5nOiBjb2x1bW5Hcm91cFNwYWNpbmdcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBUaGUgY29udGVudCBvZiB0aGUgZW50aXJlIFBhbmVsIHdoZW4gXCJNb3JlIERhdGFcIiBpcyBub3QgY2hlY2tlZC5cclxuICAgIGNvbnN0IGxlc3NEYXRhQm94ID0gbWFzc1NsaWRlckNvbHVtbk5vZGU7XHJcbiAgICBsZXNzRGF0YUJveC5ib3R0b20gPSAwO1xyXG5cclxuICAgIG1vcmVEYXRhQm94LmJvdW5kc1Byb3BlcnR5LmxpbmsoIGJvdW5kcyA9PiB7XHJcbiAgICAgIGxlc3NEYXRhQm94LnByZWZlcnJlZFdpZHRoID0gYm91bmRzLndpZHRoO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIE9ic2VydmUgd2hlbiB0aGUgbW9yZURhdGFWaXNpYmxlUHJvcGVydHkgY2hhbmdlcyBhbmQgdXBkYXRlIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBjb250ZW50IG9mIHRoZSBQYW5lbC5cclxuICAgIC8vIExpbmsgaXMgbm90IHJlbW92ZWQgc2luY2UgQmFsbFZhbHVlc1BhbmVscyBhcmUgbmV2ZXIgZGlzcG9zZWQuXHJcbiAgICBtb2RlbC5tb3JlRGF0YVByb3BlcnR5LmxpbmsoIG1vcmVEYXRhVmlzaWJsZSA9PiB7XHJcbiAgICAgIG1vcmVEYXRhQm94LnZpc2libGUgPSBtb3JlRGF0YVZpc2libGUgJiYgbW9kZWwuaXNMYWI7XHJcbiAgICAgIGxlc3NEYXRhQm94LnZpc2libGUgPSAhbW9yZURhdGFWaXNpYmxlIHx8ICFtb2RlbC5pc0xhYjtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBkYXRhTm9kZSA9IG5ldyBIQm94KCB7XHJcbiAgICAgIGFsaWduOiAnYm90dG9tJyxcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBtb3JlRGF0YUJveCxcclxuICAgICAgICBsZXNzRGF0YUJveFxyXG4gICAgICBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgc3VwZXIoIG5ldyBIQm94KCB7XHJcbiAgICAgIHNwYWNpbmc6IDEyLFxyXG4gICAgICBjaGlsZHJlbjogWyBiYWxsSWNvbnNDb2x1bW5Ob2RlLCBtYXNzU2VjdGlvbk5vZGUsIGRhdGFOb2RlIF0sXHJcbiAgICAgIGFsaWduOiAnYm90dG9tJ1xyXG4gICAgfSApLCBvcHRpb25zICk7XHJcbiAgfVxyXG59XHJcblxyXG5teVNvbGFyU3lzdGVtLnJlZ2lzdGVyKCAnRnVsbERhdGFQYW5lbCcsIEZ1bGxEYXRhUGFu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