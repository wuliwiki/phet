// Copyright 2014-2021, University of Colorado Boulder

/**
 * For performance reasons, this sim uses a single canvasNode to render all the particles instead of having nodes that
 * represent each particle. This canvas node class is actually a fallback for when WebGL support is not available on
 * the device.
 *
 * @author Sharfudeen Ashraf (for Ghent University)
 * @author John Blanco
 */

import { CanvasNode } from '../../../../scenery/js/imports.js';
import neuron from '../../neuron.js';
import ParticleType from '../model/ParticleType.js';
class ParticlesCanvasNode extends CanvasNode {
  /**
   * @param {NeuronModel} neuronModel
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Shape} clipArea
   */
  constructor(neuronModel, modelViewTransform, clipArea) {
    super({
      pickable: false,
      canvasBounds: clipArea.bounds,
      clipArea: clipArea,
      layerSplit: true
    });
    this.modelViewTransform = modelViewTransform;
    this.neuronModel = neuronModel;

    // Monitor a property that indicates when a particle state has changed and initiate a redraw.
    neuronModel.particlesMoved.addListener(() => {
      this.invalidatePaint();
    });

    // monitor a property that indicates whether all ions are being depicted and initiate a redraw on a change
    neuronModel.allIonsSimulatedProperty.lazyLink(() => {
      this.invalidatePaint();
    });

    /**
     * There is an issue in Scenery where, if nothing is drawn, whatever was previously drawn stays there.  This was
     * causing problems in this sim when turning off the "Show All Ions" setting, see
     * https://github.com/phetsims/neuron/issues/100.  The Scenery issue is
     * https://github.com/phetsims/scenery/issues/503.  To work around this problem, a property was added to the model
     * and linked here that can be used to set the node invisible if there are no particles to be rendered.  This can
     * probably be removed if and when the Scenery issue is addressed.
     */
    neuronModel.atLeastOneParticlePresentProperty.lazyLink(atLeastOneParticlePresent => {
      this.visible = atLeastOneParticlePresent;
      this.invalidatePaint();
    });
  }

  // @private
  renderSodiumParticles(particles, context) {
    context.fillStyle = particles[0].getRepresentationColor().getCanvasStyle(); // All sodium ions are of the same color,
    const transformedRadius = this.modelViewTransform.modelToViewDeltaX(particles[0].getRadius());
    context.lineWidth = 0.3;
    context.strokeStyle = 'black';
    particles.forEach(particle => {
      context.globalAlpha = particle.getOpacity();
      context.beginPath();
      const x = this.modelViewTransform.modelToViewX(particle.getPositionX());
      const y = this.modelViewTransform.modelToViewY(particle.getPositionY());
      context.arc(x, y, transformedRadius, 0, 2 * Math.PI, true);
      context.closePath();
      context.stroke();
      context.fill();
    });
  }

  /**
   * @private
   * @param particles
   * @param context
   */
  renderPotassiumParticles(particles, context) {
    context.fillStyle = particles[0].getRepresentationColor().getCanvasStyle();
    const size = this.modelViewTransform.modelToViewDeltaX(particles[0].getRadius() * 2) * 0.55;
    context.lineWidth = 0.3;
    context.strokeStyle = 'black';
    particles.forEach(particle => {
      context.globalAlpha = particle.getOpacity();
      context.beginPath();
      const x = this.modelViewTransform.modelToViewX(particle.getPositionX());
      const y = this.modelViewTransform.modelToViewY(particle.getPositionY());
      context.moveTo(x - size, y);
      context.lineTo(x, y - size);
      context.lineTo(x + size, y);
      context.lineTo(x, y + size);
      context.closePath();
      context.stroke();
      context.fill();
    });
  }

  // @private
  renderParticles(particles, context) {
    // group by particle type, this way no need to set the fillStyle for every particle instance
    const particlesGroupedByType = _.groupBy(particles, particle => particle.getType());
    _.forOwn(particlesGroupedByType, (particlesOfSameType, particleType) => {
      switch (particleType) {
        case ParticleType.SODIUM_ION:
          this.renderSodiumParticles(particlesOfSameType, context);
          break;
        case ParticleType.POTASSIUM_ION:
          this.renderPotassiumParticles(particlesOfSameType, context);
          break;
        default:
          throw new Error(`invalid particleType: ${particleType}`);
      }
    });
  }

  /**
   * @param {CanvasRenderingContext2D} context
   * @override
   * @public
   */
  paintCanvas(context) {
    this.renderParticles(this.neuronModel.backgroundParticles, context);
    this.renderParticles(this.neuronModel.transientParticles, context);
    this.renderParticles(this.neuronModel.playbackParticles, context);
  }
}
neuron.register('ParticlesCanvasNode', ParticlesCanvasNode);
export default ParticlesCanvasNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDYW52YXNOb2RlIiwibmV1cm9uIiwiUGFydGljbGVUeXBlIiwiUGFydGljbGVzQ2FudmFzTm9kZSIsImNvbnN0cnVjdG9yIiwibmV1cm9uTW9kZWwiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJjbGlwQXJlYSIsInBpY2thYmxlIiwiY2FudmFzQm91bmRzIiwiYm91bmRzIiwibGF5ZXJTcGxpdCIsInBhcnRpY2xlc01vdmVkIiwiYWRkTGlzdGVuZXIiLCJpbnZhbGlkYXRlUGFpbnQiLCJhbGxJb25zU2ltdWxhdGVkUHJvcGVydHkiLCJsYXp5TGluayIsImF0TGVhc3RPbmVQYXJ0aWNsZVByZXNlbnRQcm9wZXJ0eSIsImF0TGVhc3RPbmVQYXJ0aWNsZVByZXNlbnQiLCJ2aXNpYmxlIiwicmVuZGVyU29kaXVtUGFydGljbGVzIiwicGFydGljbGVzIiwiY29udGV4dCIsImZpbGxTdHlsZSIsImdldFJlcHJlc2VudGF0aW9uQ29sb3IiLCJnZXRDYW52YXNTdHlsZSIsInRyYW5zZm9ybWVkUmFkaXVzIiwibW9kZWxUb1ZpZXdEZWx0YVgiLCJnZXRSYWRpdXMiLCJsaW5lV2lkdGgiLCJzdHJva2VTdHlsZSIsImZvckVhY2giLCJwYXJ0aWNsZSIsImdsb2JhbEFscGhhIiwiZ2V0T3BhY2l0eSIsImJlZ2luUGF0aCIsIngiLCJtb2RlbFRvVmlld1giLCJnZXRQb3NpdGlvblgiLCJ5IiwibW9kZWxUb1ZpZXdZIiwiZ2V0UG9zaXRpb25ZIiwiYXJjIiwiTWF0aCIsIlBJIiwiY2xvc2VQYXRoIiwic3Ryb2tlIiwiZmlsbCIsInJlbmRlclBvdGFzc2l1bVBhcnRpY2xlcyIsInNpemUiLCJtb3ZlVG8iLCJsaW5lVG8iLCJyZW5kZXJQYXJ0aWNsZXMiLCJwYXJ0aWNsZXNHcm91cGVkQnlUeXBlIiwiXyIsImdyb3VwQnkiLCJnZXRUeXBlIiwiZm9yT3duIiwicGFydGljbGVzT2ZTYW1lVHlwZSIsInBhcnRpY2xlVHlwZSIsIlNPRElVTV9JT04iLCJQT1RBU1NJVU1fSU9OIiwiRXJyb3IiLCJwYWludENhbnZhcyIsImJhY2tncm91bmRQYXJ0aWNsZXMiLCJ0cmFuc2llbnRQYXJ0aWNsZXMiLCJwbGF5YmFja1BhcnRpY2xlcyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUGFydGljbGVzQ2FudmFzTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIxLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBGb3IgcGVyZm9ybWFuY2UgcmVhc29ucywgdGhpcyBzaW0gdXNlcyBhIHNpbmdsZSBjYW52YXNOb2RlIHRvIHJlbmRlciBhbGwgdGhlIHBhcnRpY2xlcyBpbnN0ZWFkIG9mIGhhdmluZyBub2RlcyB0aGF0XHJcbiAqIHJlcHJlc2VudCBlYWNoIHBhcnRpY2xlLiBUaGlzIGNhbnZhcyBub2RlIGNsYXNzIGlzIGFjdHVhbGx5IGEgZmFsbGJhY2sgZm9yIHdoZW4gV2ViR0wgc3VwcG9ydCBpcyBub3QgYXZhaWxhYmxlIG9uXHJcbiAqIHRoZSBkZXZpY2UuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2hhcmZ1ZGVlbiBBc2hyYWYgKGZvciBHaGVudCBVbml2ZXJzaXR5KVxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgQ2FudmFzTm9kZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBuZXVyb24gZnJvbSAnLi4vLi4vbmV1cm9uLmpzJztcclxuaW1wb3J0IFBhcnRpY2xlVHlwZSBmcm9tICcuLi9tb2RlbC9QYXJ0aWNsZVR5cGUuanMnO1xyXG5cclxuY2xhc3MgUGFydGljbGVzQ2FudmFzTm9kZSBleHRlbmRzIENhbnZhc05vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge05ldXJvbk1vZGVsfSBuZXVyb25Nb2RlbFxyXG4gICAqIEBwYXJhbSB7TW9kZWxWaWV3VHJhbnNmb3JtMn0gbW9kZWxWaWV3VHJhbnNmb3JtXHJcbiAgICogQHBhcmFtIHtTaGFwZX0gY2xpcEFyZWFcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbmV1cm9uTW9kZWwsIG1vZGVsVmlld1RyYW5zZm9ybSwgY2xpcEFyZWEgKSB7XHJcbiAgICBzdXBlcigge1xyXG4gICAgICBwaWNrYWJsZTogZmFsc2UsXHJcbiAgICAgIGNhbnZhc0JvdW5kczogY2xpcEFyZWEuYm91bmRzLFxyXG4gICAgICBjbGlwQXJlYTogY2xpcEFyZWEsXHJcbiAgICAgIGxheWVyU3BsaXQ6IHRydWVcclxuICAgIH0gKTtcclxuICAgIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtID0gbW9kZWxWaWV3VHJhbnNmb3JtO1xyXG4gICAgdGhpcy5uZXVyb25Nb2RlbCA9IG5ldXJvbk1vZGVsO1xyXG5cclxuICAgIC8vIE1vbml0b3IgYSBwcm9wZXJ0eSB0aGF0IGluZGljYXRlcyB3aGVuIGEgcGFydGljbGUgc3RhdGUgaGFzIGNoYW5nZWQgYW5kIGluaXRpYXRlIGEgcmVkcmF3LlxyXG4gICAgbmV1cm9uTW9kZWwucGFydGljbGVzTW92ZWQuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgICAgdGhpcy5pbnZhbGlkYXRlUGFpbnQoKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBtb25pdG9yIGEgcHJvcGVydHkgdGhhdCBpbmRpY2F0ZXMgd2hldGhlciBhbGwgaW9ucyBhcmUgYmVpbmcgZGVwaWN0ZWQgYW5kIGluaXRpYXRlIGEgcmVkcmF3IG9uIGEgY2hhbmdlXHJcbiAgICBuZXVyb25Nb2RlbC5hbGxJb25zU2ltdWxhdGVkUHJvcGVydHkubGF6eUxpbmsoICgpID0+IHtcclxuICAgICAgdGhpcy5pbnZhbGlkYXRlUGFpbnQoKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFRoZXJlIGlzIGFuIGlzc3VlIGluIFNjZW5lcnkgd2hlcmUsIGlmIG5vdGhpbmcgaXMgZHJhd24sIHdoYXRldmVyIHdhcyBwcmV2aW91c2x5IGRyYXduIHN0YXlzIHRoZXJlLiAgVGhpcyB3YXNcclxuICAgICAqIGNhdXNpbmcgcHJvYmxlbXMgaW4gdGhpcyBzaW0gd2hlbiB0dXJuaW5nIG9mZiB0aGUgXCJTaG93IEFsbCBJb25zXCIgc2V0dGluZywgc2VlXHJcbiAgICAgKiBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbmV1cm9uL2lzc3Vlcy8xMDAuICBUaGUgU2NlbmVyeSBpc3N1ZSBpc1xyXG4gICAgICogaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnkvaXNzdWVzLzUwMy4gIFRvIHdvcmsgYXJvdW5kIHRoaXMgcHJvYmxlbSwgYSBwcm9wZXJ0eSB3YXMgYWRkZWQgdG8gdGhlIG1vZGVsXHJcbiAgICAgKiBhbmQgbGlua2VkIGhlcmUgdGhhdCBjYW4gYmUgdXNlZCB0byBzZXQgdGhlIG5vZGUgaW52aXNpYmxlIGlmIHRoZXJlIGFyZSBubyBwYXJ0aWNsZXMgdG8gYmUgcmVuZGVyZWQuICBUaGlzIGNhblxyXG4gICAgICogcHJvYmFibHkgYmUgcmVtb3ZlZCBpZiBhbmQgd2hlbiB0aGUgU2NlbmVyeSBpc3N1ZSBpcyBhZGRyZXNzZWQuXHJcbiAgICAgKi9cclxuICAgIG5ldXJvbk1vZGVsLmF0TGVhc3RPbmVQYXJ0aWNsZVByZXNlbnRQcm9wZXJ0eS5sYXp5TGluayggYXRMZWFzdE9uZVBhcnRpY2xlUHJlc2VudCA9PiB7XHJcbiAgICAgIHRoaXMudmlzaWJsZSA9IGF0TGVhc3RPbmVQYXJ0aWNsZVByZXNlbnQ7XHJcbiAgICAgIHRoaXMuaW52YWxpZGF0ZVBhaW50KCk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvLyBAcHJpdmF0ZVxyXG4gIHJlbmRlclNvZGl1bVBhcnRpY2xlcyggcGFydGljbGVzLCBjb250ZXh0ICkge1xyXG4gICAgY29udGV4dC5maWxsU3R5bGUgPSBwYXJ0aWNsZXNbIDAgXS5nZXRSZXByZXNlbnRhdGlvbkNvbG9yKCkuZ2V0Q2FudmFzU3R5bGUoKTsgLy8gQWxsIHNvZGl1bSBpb25zIGFyZSBvZiB0aGUgc2FtZSBjb2xvcixcclxuICAgIGNvbnN0IHRyYW5zZm9ybWVkUmFkaXVzID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YVgoIHBhcnRpY2xlc1sgMCBdLmdldFJhZGl1cygpICk7XHJcbiAgICBjb250ZXh0LmxpbmVXaWR0aCA9IDAuMztcclxuICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSAnYmxhY2snO1xyXG4gICAgcGFydGljbGVzLmZvckVhY2goIHBhcnRpY2xlID0+IHtcclxuICAgICAgY29udGV4dC5nbG9iYWxBbHBoYSA9IHBhcnRpY2xlLmdldE9wYWNpdHkoKTtcclxuICAgICAgY29udGV4dC5iZWdpblBhdGgoKTtcclxuICAgICAgY29uc3QgeCA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WCggcGFydGljbGUuZ2V0UG9zaXRpb25YKCkgKTtcclxuICAgICAgY29uc3QgeSA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggcGFydGljbGUuZ2V0UG9zaXRpb25ZKCkgKTtcclxuICAgICAgY29udGV4dC5hcmMoIHgsIHksIHRyYW5zZm9ybWVkUmFkaXVzLCAwLCAyICogTWF0aC5QSSwgdHJ1ZSApO1xyXG4gICAgICBjb250ZXh0LmNsb3NlUGF0aCgpO1xyXG4gICAgICBjb250ZXh0LnN0cm9rZSgpO1xyXG4gICAgICBjb250ZXh0LmZpbGwoKTtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHBhcmFtIHBhcnRpY2xlc1xyXG4gICAqIEBwYXJhbSBjb250ZXh0XHJcbiAgICovXHJcbiAgcmVuZGVyUG90YXNzaXVtUGFydGljbGVzKCBwYXJ0aWNsZXMsIGNvbnRleHQgKSB7XHJcbiAgICBjb250ZXh0LmZpbGxTdHlsZSA9IHBhcnRpY2xlc1sgMCBdLmdldFJlcHJlc2VudGF0aW9uQ29sb3IoKS5nZXRDYW52YXNTdHlsZSgpO1xyXG4gICAgY29uc3Qgc2l6ZSA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFYKCBwYXJ0aWNsZXNbIDAgXS5nZXRSYWRpdXMoKSAqIDIgKSAqIDAuNTU7XHJcbiAgICBjb250ZXh0LmxpbmVXaWR0aCA9IDAuMztcclxuICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSAnYmxhY2snO1xyXG4gICAgcGFydGljbGVzLmZvckVhY2goIHBhcnRpY2xlID0+IHtcclxuICAgICAgY29udGV4dC5nbG9iYWxBbHBoYSA9IHBhcnRpY2xlLmdldE9wYWNpdHkoKTtcclxuICAgICAgY29udGV4dC5iZWdpblBhdGgoKTtcclxuICAgICAgY29uc3QgeCA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WCggcGFydGljbGUuZ2V0UG9zaXRpb25YKCkgKTtcclxuICAgICAgY29uc3QgeSA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggcGFydGljbGUuZ2V0UG9zaXRpb25ZKCkgKTtcclxuICAgICAgY29udGV4dC5tb3ZlVG8oIHggLSBzaXplLCB5ICk7XHJcbiAgICAgIGNvbnRleHQubGluZVRvKCB4LCB5IC0gc2l6ZSApO1xyXG4gICAgICBjb250ZXh0LmxpbmVUbyggeCArIHNpemUsIHkgKTtcclxuICAgICAgY29udGV4dC5saW5lVG8oIHgsIHkgKyBzaXplICk7XHJcbiAgICAgIGNvbnRleHQuY2xvc2VQYXRoKCk7XHJcbiAgICAgIGNvbnRleHQuc3Ryb2tlKCk7XHJcbiAgICAgIGNvbnRleHQuZmlsbCgpO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLy8gQHByaXZhdGVcclxuICByZW5kZXJQYXJ0aWNsZXMoIHBhcnRpY2xlcywgY29udGV4dCApIHtcclxuICAgIC8vIGdyb3VwIGJ5IHBhcnRpY2xlIHR5cGUsIHRoaXMgd2F5IG5vIG5lZWQgdG8gc2V0IHRoZSBmaWxsU3R5bGUgZm9yIGV2ZXJ5IHBhcnRpY2xlIGluc3RhbmNlXHJcbiAgICBjb25zdCBwYXJ0aWNsZXNHcm91cGVkQnlUeXBlID0gXy5ncm91cEJ5KCBwYXJ0aWNsZXMsIHBhcnRpY2xlID0+IHBhcnRpY2xlLmdldFR5cGUoKSApO1xyXG5cclxuICAgIF8uZm9yT3duKCBwYXJ0aWNsZXNHcm91cGVkQnlUeXBlLCAoIHBhcnRpY2xlc09mU2FtZVR5cGUsIHBhcnRpY2xlVHlwZSApID0+IHtcclxuICAgICAgc3dpdGNoKCBwYXJ0aWNsZVR5cGUgKSB7XHJcbiAgICAgICAgY2FzZSBQYXJ0aWNsZVR5cGUuU09ESVVNX0lPTjpcclxuICAgICAgICAgIHRoaXMucmVuZGVyU29kaXVtUGFydGljbGVzKCBwYXJ0aWNsZXNPZlNhbWVUeXBlLCBjb250ZXh0ICk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFBhcnRpY2xlVHlwZS5QT1RBU1NJVU1fSU9OOlxyXG4gICAgICAgICAgdGhpcy5yZW5kZXJQb3Rhc3NpdW1QYXJ0aWNsZXMoIHBhcnRpY2xlc09mU2FtZVR5cGUsIGNvbnRleHQgKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIGBpbnZhbGlkIHBhcnRpY2xlVHlwZTogJHtwYXJ0aWNsZVR5cGV9YCApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dFxyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBwYWludENhbnZhcyggY29udGV4dCApIHtcclxuICAgIHRoaXMucmVuZGVyUGFydGljbGVzKCB0aGlzLm5ldXJvbk1vZGVsLmJhY2tncm91bmRQYXJ0aWNsZXMsIGNvbnRleHQgKTtcclxuICAgIHRoaXMucmVuZGVyUGFydGljbGVzKCB0aGlzLm5ldXJvbk1vZGVsLnRyYW5zaWVudFBhcnRpY2xlcywgY29udGV4dCApO1xyXG4gICAgdGhpcy5yZW5kZXJQYXJ0aWNsZXMoIHRoaXMubmV1cm9uTW9kZWwucGxheWJhY2tQYXJ0aWNsZXMsIGNvbnRleHQgKTtcclxuICB9XHJcbn1cclxuXHJcbm5ldXJvbi5yZWdpc3RlciggJ1BhcnRpY2xlc0NhbnZhc05vZGUnLCBQYXJ0aWNsZXNDYW52YXNOb2RlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBQYXJ0aWNsZXNDYW52YXNOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTQSxVQUFVLFFBQVEsbUNBQW1DO0FBQzlELE9BQU9DLE1BQU0sTUFBTSxpQkFBaUI7QUFDcEMsT0FBT0MsWUFBWSxNQUFNLDBCQUEwQjtBQUVuRCxNQUFNQyxtQkFBbUIsU0FBU0gsVUFBVSxDQUFDO0VBRTNDO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRUksV0FBV0EsQ0FBRUMsV0FBVyxFQUFFQyxrQkFBa0IsRUFBRUMsUUFBUSxFQUFHO0lBQ3ZELEtBQUssQ0FBRTtNQUNMQyxRQUFRLEVBQUUsS0FBSztNQUNmQyxZQUFZLEVBQUVGLFFBQVEsQ0FBQ0csTUFBTTtNQUM3QkgsUUFBUSxFQUFFQSxRQUFRO01BQ2xCSSxVQUFVLEVBQUU7SUFDZCxDQUFFLENBQUM7SUFDSCxJQUFJLENBQUNMLGtCQUFrQixHQUFHQSxrQkFBa0I7SUFDNUMsSUFBSSxDQUFDRCxXQUFXLEdBQUdBLFdBQVc7O0lBRTlCO0lBQ0FBLFdBQVcsQ0FBQ08sY0FBYyxDQUFDQyxXQUFXLENBQUUsTUFBTTtNQUM1QyxJQUFJLENBQUNDLGVBQWUsQ0FBQyxDQUFDO0lBQ3hCLENBQUUsQ0FBQzs7SUFFSDtJQUNBVCxXQUFXLENBQUNVLHdCQUF3QixDQUFDQyxRQUFRLENBQUUsTUFBTTtNQUNuRCxJQUFJLENBQUNGLGVBQWUsQ0FBQyxDQUFDO0lBQ3hCLENBQUUsQ0FBQzs7SUFFSDtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0lBQ0lULFdBQVcsQ0FBQ1ksaUNBQWlDLENBQUNELFFBQVEsQ0FB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