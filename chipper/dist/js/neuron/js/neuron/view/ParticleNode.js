// Copyright 2014-2022, University of Colorado Boulder
/**
 * Class that represents particles (generally ions) in the view.
 * @author John Blanco
 * @author Sharfudeen Ashraf (for Ghent University)
 */

import Matrix3 from '../../../../dot/js/Matrix3.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import { Color, Node, Path } from '../../../../scenery/js/imports.js';
import neuron from '../../neuron.js';
import ParticleType from '../model/ParticleType.js';

// constants
const PARTICLE_EDGE_STROKE = 1;
class ParticleNode extends Node {
  /**
   * @param {ViewableParticle} particle
   * @param {ModelViewTransform2D} modelViewTransform
   */
  constructor(particle, modelViewTransform) {
    super({});
    this.particle = particle;
    this.modelViewTransform = modelViewTransform;

    // Create the initial representation with the aspects that don't change.
    const representation = new Path(new Shape(), {
      lineWidth: PARTICLE_EDGE_STROKE,
      stroke: Color.BLACK
    });
    this.addChild(representation);
    const updateOffset = (x, y) => {
      this.translate(modelViewTransform.modelToViewPosition(new Vector2(x, y)));
    };
    const updateRepresentation = newOpacity => {
      let size;
      let representationShape;
      assert && assert(particle.getType() === ParticleType.SODIUM_ION || particle.getType() === ParticleType.POTASSIUM_ION);
      const particleType = particle.getType();
      if (particleType === ParticleType.SODIUM_ION) {
        const transformedRadius = modelViewTransform.modelToViewDeltaX(particle.getRadius());
        representationShape = new Shape().ellipse(0, 0, transformedRadius, transformedRadius);
      } else if (particleType === ParticleType.POTASSIUM_ION) {
        size = modelViewTransform.modelToViewDeltaX(particle.getRadius() * 2) * 0.85;
        representationShape = new Shape().rect(-size / 2, -size / 2, size, size);
        const rotationTransform = Matrix3.rotationAround(Math.PI / 4, 0, 0);
        representationShape = representationShape.transformed(rotationTransform);
      } else {
        // This should never happen, but if it does, use an arbitrary shape.
        const defaultSphereRadius = modelViewTransform.modelToViewDeltaX(particle.getRadius());
        representationShape = new Shape().ellipse(0, 0, defaultSphereRadius, defaultSphereRadius);
      }
      representation.setShape(representationShape);
      representation.fill = particle.getRepresentationColor();
      this.setOpacity(newOpacity);
    };
    updateOffset(particle.getPositionX(), particle.getPositionY());
    updateRepresentation(particle.getOpacity());
  }
}
neuron.register('ParticleNode', ParticleNode);
export default ParticleNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNYXRyaXgzIiwiVmVjdG9yMiIsIlNoYXBlIiwiQ29sb3IiLCJOb2RlIiwiUGF0aCIsIm5ldXJvbiIsIlBhcnRpY2xlVHlwZSIsIlBBUlRJQ0xFX0VER0VfU1RST0tFIiwiUGFydGljbGVOb2RlIiwiY29uc3RydWN0b3IiLCJwYXJ0aWNsZSIsIm1vZGVsVmlld1RyYW5zZm9ybSIsInJlcHJlc2VudGF0aW9uIiwibGluZVdpZHRoIiwic3Ryb2tlIiwiQkxBQ0siLCJhZGRDaGlsZCIsInVwZGF0ZU9mZnNldCIsIngiLCJ5IiwidHJhbnNsYXRlIiwibW9kZWxUb1ZpZXdQb3NpdGlvbiIsInVwZGF0ZVJlcHJlc2VudGF0aW9uIiwibmV3T3BhY2l0eSIsInNpemUiLCJyZXByZXNlbnRhdGlvblNoYXBlIiwiYXNzZXJ0IiwiZ2V0VHlwZSIsIlNPRElVTV9JT04iLCJQT1RBU1NJVU1fSU9OIiwicGFydGljbGVUeXBlIiwidHJhbnNmb3JtZWRSYWRpdXMiLCJtb2RlbFRvVmlld0RlbHRhWCIsImdldFJhZGl1cyIsImVsbGlwc2UiLCJyZWN0Iiwicm90YXRpb25UcmFuc2Zvcm0iLCJyb3RhdGlvbkFyb3VuZCIsIk1hdGgiLCJQSSIsInRyYW5zZm9ybWVkIiwiZGVmYXVsdFNwaGVyZVJhZGl1cyIsInNldFNoYXBlIiwiZmlsbCIsImdldFJlcHJlc2VudGF0aW9uQ29sb3IiLCJzZXRPcGFjaXR5IiwiZ2V0UG9zaXRpb25YIiwiZ2V0UG9zaXRpb25ZIiwiZ2V0T3BhY2l0eSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUGFydGljbGVOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG4vKipcclxuICogQ2xhc3MgdGhhdCByZXByZXNlbnRzIHBhcnRpY2xlcyAoZ2VuZXJhbGx5IGlvbnMpIGluIHRoZSB2aWV3LlxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvXHJcbiAqIEBhdXRob3IgU2hhcmZ1ZGVlbiBBc2hyYWYgKGZvciBHaGVudCBVbml2ZXJzaXR5KVxyXG4gKi9cclxuXHJcbmltcG9ydCBNYXRyaXgzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9NYXRyaXgzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBOb2RlLCBQYXRoIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG5ldXJvbiBmcm9tICcuLi8uLi9uZXVyb24uanMnO1xyXG5pbXBvcnQgUGFydGljbGVUeXBlIGZyb20gJy4uL21vZGVsL1BhcnRpY2xlVHlwZS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgUEFSVElDTEVfRURHRV9TVFJPS0UgPSAxO1xyXG5cclxuY2xhc3MgUGFydGljbGVOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7Vmlld2FibGVQYXJ0aWNsZX0gcGFydGljbGVcclxuICAgKiBAcGFyYW0ge01vZGVsVmlld1RyYW5zZm9ybTJEfSBtb2RlbFZpZXdUcmFuc2Zvcm1cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggcGFydGljbGUsIG1vZGVsVmlld1RyYW5zZm9ybSApIHtcclxuICAgIHN1cGVyKCB7fSApO1xyXG4gICAgdGhpcy5wYXJ0aWNsZSA9IHBhcnRpY2xlO1xyXG4gICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0gPSBtb2RlbFZpZXdUcmFuc2Zvcm07XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBpbml0aWFsIHJlcHJlc2VudGF0aW9uIHdpdGggdGhlIGFzcGVjdHMgdGhhdCBkb24ndCBjaGFuZ2UuXHJcbiAgICBjb25zdCByZXByZXNlbnRhdGlvbiA9IG5ldyBQYXRoKCBuZXcgU2hhcGUoKSwgeyBsaW5lV2lkdGg6IFBBUlRJQ0xFX0VER0VfU1RST0tFLCBzdHJva2U6IENvbG9yLkJMQUNLIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHJlcHJlc2VudGF0aW9uICk7XHJcblxyXG4gICAgY29uc3QgdXBkYXRlT2Zmc2V0ID0gKCB4LCB5ICkgPT4ge1xyXG4gICAgICB0aGlzLnRyYW5zbGF0ZSggbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIG5ldyBWZWN0b3IyKCB4LCB5ICkgKSApO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCB1cGRhdGVSZXByZXNlbnRhdGlvbiA9IG5ld09wYWNpdHkgPT4ge1xyXG5cclxuICAgICAgbGV0IHNpemU7XHJcbiAgICAgIGxldCByZXByZXNlbnRhdGlvblNoYXBlO1xyXG5cclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggcGFydGljbGUuZ2V0VHlwZSgpID09PSBQYXJ0aWNsZVR5cGUuU09ESVVNX0lPTiB8fCBwYXJ0aWNsZS5nZXRUeXBlKCkgPT09IFBhcnRpY2xlVHlwZS5QT1RBU1NJVU1fSU9OICk7XHJcblxyXG4gICAgICBjb25zdCBwYXJ0aWNsZVR5cGUgPSBwYXJ0aWNsZS5nZXRUeXBlKCk7XHJcbiAgICAgIGlmICggcGFydGljbGVUeXBlID09PSBQYXJ0aWNsZVR5cGUuU09ESVVNX0lPTiApIHtcclxuICAgICAgICBjb25zdCB0cmFuc2Zvcm1lZFJhZGl1cyA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggcGFydGljbGUuZ2V0UmFkaXVzKCkgKTtcclxuICAgICAgICByZXByZXNlbnRhdGlvblNoYXBlID0gbmV3IFNoYXBlKCkuZWxsaXBzZSggMCwgMCwgdHJhbnNmb3JtZWRSYWRpdXMsIHRyYW5zZm9ybWVkUmFkaXVzICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHBhcnRpY2xlVHlwZSA9PT0gUGFydGljbGVUeXBlLlBPVEFTU0lVTV9JT04gKSB7XHJcbiAgICAgICAgc2l6ZSA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggcGFydGljbGUuZ2V0UmFkaXVzKCkgKiAyICkgKiAwLjg1O1xyXG4gICAgICAgIHJlcHJlc2VudGF0aW9uU2hhcGUgPSBuZXcgU2hhcGUoKS5yZWN0KCAtc2l6ZSAvIDIsIC1zaXplIC8gMiwgc2l6ZSwgc2l6ZSApO1xyXG4gICAgICAgIGNvbnN0IHJvdGF0aW9uVHJhbnNmb3JtID0gTWF0cml4My5yb3RhdGlvbkFyb3VuZCggTWF0aC5QSSAvIDQsIDAsIDAgKTtcclxuICAgICAgICByZXByZXNlbnRhdGlvblNoYXBlID0gcmVwcmVzZW50YXRpb25TaGFwZS50cmFuc2Zvcm1lZCggcm90YXRpb25UcmFuc2Zvcm0gKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgLy8gVGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuLCBidXQgaWYgaXQgZG9lcywgdXNlIGFuIGFyYml0cmFyeSBzaGFwZS5cclxuICAgICAgICBjb25zdCBkZWZhdWx0U3BoZXJlUmFkaXVzID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFYKCBwYXJ0aWNsZS5nZXRSYWRpdXMoKSApO1xyXG4gICAgICAgIHJlcHJlc2VudGF0aW9uU2hhcGUgPSBuZXcgU2hhcGUoKS5lbGxpcHNlKCAwLCAwLCBkZWZhdWx0U3BoZXJlUmFkaXVzLCBkZWZhdWx0U3BoZXJlUmFkaXVzICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJlcHJlc2VudGF0aW9uLnNldFNoYXBlKCByZXByZXNlbnRhdGlvblNoYXBlICk7XHJcbiAgICAgIHJlcHJlc2VudGF0aW9uLmZpbGwgPSBwYXJ0aWNsZS5nZXRSZXByZXNlbnRhdGlvbkNvbG9yKCk7XHJcbiAgICAgIHRoaXMuc2V0T3BhY2l0eSggbmV3T3BhY2l0eSApO1xyXG4gICAgfTtcclxuXHJcbiAgICB1cGRhdGVPZmZzZXQoIHBhcnRpY2xlLmdldFBvc2l0aW9uWCgpLCBwYXJ0aWNsZS5nZXRQb3NpdGlvblkoKSApO1xyXG4gICAgdXBkYXRlUmVwcmVzZW50YXRpb24oIHBhcnRpY2xlLmdldE9wYWNpdHkoKSApO1xyXG4gIH1cclxufVxyXG5cclxubmV1cm9uLnJlZ2lzdGVyKCAnUGFydGljbGVOb2RlJywgUGFydGljbGVOb2RlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBQYXJ0aWNsZU5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDdEQsU0FBU0MsS0FBSyxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDckUsT0FBT0MsTUFBTSxNQUFNLGlCQUFpQjtBQUNwQyxPQUFPQyxZQUFZLE1BQU0sMEJBQTBCOztBQUVuRDtBQUNBLE1BQU1DLG9CQUFvQixHQUFHLENBQUM7QUFFOUIsTUFBTUMsWUFBWSxTQUFTTCxJQUFJLENBQUM7RUFFOUI7QUFDRjtBQUNBO0FBQ0E7RUFDRU0sV0FBV0EsQ0FBRUMsUUFBUSxFQUFFQyxrQkFBa0IsRUFBRztJQUMxQyxLQUFLLENBQUUsQ0FBQyxDQUFFLENBQUM7SUFDWCxJQUFJLENBQUNELFFBQVEsR0FBR0EsUUFBUTtJQUN4QixJQUFJLENBQUNDLGtCQUFrQixHQUFHQSxrQkFBa0I7O0lBRTVDO0lBQ0EsTUFBTUMsY0FBYyxHQUFHLElBQUlSLElBQUksQ0FBRSxJQUFJSCxLQUFLLENBQUMsQ0FBQyxFQUFFO01BQUVZLFNBQVMsRUFBRU4sb0JBQW9CO01BQUVPLE1BQU0sRUFBRVosS0FBSyxDQUFDYTtJQUFNLENBQUUsQ0FBQztJQUN4RyxJQUFJLENBQUNDLFFBQVEsQ0FBRUosY0FBZSxDQUFDO0lBRS9CLE1BQU1LLFlBQVksR0FBR0EsQ0FBRUMsQ0FBQyxFQUFFQyxDQUFDLEtBQU07TUFDL0IsSUFBSSxDQUFDQyxTQUFTLENB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