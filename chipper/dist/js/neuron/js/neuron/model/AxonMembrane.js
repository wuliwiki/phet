// Copyright 2014-2022, University of Colorado Boulder

/**
 * Model representation for the axon membrane.  Represents it as a cross section and a shape that is intended to look
 * like the body of the axon receding into the distance.
 *
 * @author John Blanco
 * @author Sharfudeen Ashraf (for Ghent University)
 */

import Emitter from '../../../../axon/js/Emitter.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Cubic, Shape } from '../../../../kite/js/imports.js';
import neuron from '../../neuron.js';
import NeuronConstants from '../common/NeuronConstants.js';
import AxonMembraneState from './AxonMembraneState.js';
import TravelingActionPotential from './TravelingActionPotential.js';

// Fixed membrane characteristics.
const BODY_LENGTH = NeuronConstants.DEFAULT_DIAMETER * 1.5;
const BODY_TILT_ANGLE = Math.PI / 4;
class AxonMembrane {
  constructor() {
    // @public - events emitted by instances of this type
    this.travelingActionPotentialStarted = new Emitter();
    this.travelingActionPotentialReachedCrossSection = new Emitter();
    this.lingeringCompleted = new Emitter();
    this.travelingActionPotentialEnded = new Emitter();

    // Traveling action potential that moves down the membrane.
    this.travelingActionPotential = null;

    //-----------------------------------------------------------------------------------------------------------------
    // Create the shape of the axon body
    //-----------------------------------------------------------------------------------------------------------------

    // @public - shape of the body of the axon
    this.axonBodyShape = new Shape();

    // points at which axon membrane would appear to vanish, used in shape creation
    const vanishingPoint = new Vector2(BODY_LENGTH * Math.cos(BODY_TILT_ANGLE), BODY_LENGTH * Math.sin(BODY_TILT_ANGLE));

    // Find the two points at which the shape will intersect the outer edge of the cross section.
    const r = NeuronConstants.DEFAULT_DIAMETER / 2 + this.getMembraneThickness() / 2;
    let theta = BODY_TILT_ANGLE + Math.PI * 0.45; // Multiplier tweaked a bit for improved appearance.
    const intersectionPointA = new Vector2(r * Math.cos(theta), r * Math.sin(theta));
    theta += Math.PI;
    const intersectionPointB = new Vector2(r * Math.cos(theta), r * Math.sin(theta));

    // Define the control points for the two curves.  Note that there is some tweaking in here, so change as needed
    // to get the desired look. If you can figure it out, that is.  Hints: The shape is drawn starting as a curve
    // from the vanishing point to intersection point A, then a line to intersection point B, then as a curve back to
    // the vanishing point.
    const angleToVanishingPt = Math.atan2(vanishingPoint.y - intersectionPointA.y, vanishingPoint.x - intersectionPointA.x);
    let controlPtRadius = intersectionPointA.distance(vanishingPoint) * 0.33;
    const controlPtA1 = new Vector2(intersectionPointA.x + controlPtRadius * Math.cos(angleToVanishingPt + 0.15), intersectionPointA.y + controlPtRadius * Math.sin(angleToVanishingPt + 0.15));
    controlPtRadius = intersectionPointA.distance(vanishingPoint) * 0.67;
    const controlPtA2 = new Vector2(intersectionPointA.x + controlPtRadius * Math.cos(angleToVanishingPt - 0.5), intersectionPointA.y + controlPtRadius * Math.sin(angleToVanishingPt - 0.5));
    const angleToIntersectionPt = Math.atan2(intersectionPointB.y - vanishingPoint.y, intersectionPointB.x - intersectionPointB.x);
    controlPtRadius = intersectionPointB.distance(vanishingPoint) * 0.33;
    const controlPtB1 = new Vector2(vanishingPoint.x + controlPtRadius * Math.cos(angleToIntersectionPt + 0.1), vanishingPoint.y + controlPtRadius * Math.sin(angleToIntersectionPt + 0.1));
    controlPtRadius = intersectionPointB.distance(vanishingPoint) * 0.67;
    const controlPtB2 = new Vector2(vanishingPoint.x + controlPtRadius * Math.cos(angleToIntersectionPt - 0.25), vanishingPoint.y + controlPtRadius * Math.sin(angleToIntersectionPt - 0.25));

    // @private - curves that define the boundaries of the body
    this.curveA = new Cubic(vanishingPoint, controlPtA2, controlPtA1, intersectionPointA);
    this.curveB = new Cubic(vanishingPoint, controlPtB1, controlPtB2, intersectionPointB);

    // In order to create the full shape, we reverse one of the curves and the connect the two curves together in
    // order to create the full shape of the axon body.
    this.axonBodyShape.moveTo(intersectionPointA.x, intersectionPointA.y);
    this.axonBodyShape.cubicCurveTo(controlPtA1.x, controlPtA1.y, controlPtA2.x, controlPtA2.y, vanishingPoint.x, vanishingPoint.y);
    this.axonBodyShape.cubicCurveTo(controlPtB1.x, controlPtB1.y, controlPtB2.x, controlPtB2.y, intersectionPointB.x, intersectionPointB.y);
    this.axonBodyShape.close();

    // @public - shape of the cross section of the membrane. For now, and unless there is some reason to do otherwise,
    // the center of the cross section is positioned at the origin.
    this.crossSectionCircleCenter = Vector2.ZERO;
    this.crossSectionCircleRadius = NeuronConstants.DEFAULT_DIAMETER / 2;

    // @private - In order to avoid creating new Vector2 instances during animation, these instances are declared and
    // reused in the evaluateCurve method.
    this.ab = new Vector2(0, 0);
    this.bc = new Vector2(0, 0);
    this.cd = new Vector2(0, 0);
    this.abbc = new Vector2(0, 0);
    this.bbcd = new Vector2(0, 0);
  }

  /**
   * Step this model element forward in time by the specified delta.
   * @param {number} dt - delta time, in seconds.
   * @public
   */
  stepInTime(dt) {
    if (this.travelingActionPotential) {
      this.travelingActionPotential.stepInTime(dt);
    }
  }

  /**
   * Start an action potential that will travel down the length of the membrane toward the transverse cross section.
   * @public
   */
  initiateTravelingActionPotential() {
    assert && assert(this.travelingActionPotential === null, 'Should not initiate a 2nd traveling action potential before prior one has completed.');
    this.travelingActionPotential = new TravelingActionPotential(this);
    this.travelingActionPotential.crossSectionReached.addListener(() => {
      this.travelingActionPotentialReachedCrossSection.emit();
    });
    this.travelingActionPotential.lingeringCompleted.addListener(() => {
      this.removeTravelingActionPotential();
    });
    this.travelingActionPotentialStarted.emit();
  }

  /**
   * Remove the traveling action potential, either because it has reached the cross section and is therefore no
   * longer needed, or for some other reason (such as a reset or jump in the playback state).
   * @public
   */
  removeTravelingActionPotential() {
    this.travelingActionPotentialEnded.emit();
    this.stimulusPulseInitiated = false;
    this.travelingActionPotential = null;
  }

  // @public
  getState() {
    return new AxonMembraneState(this.travelingActionPotential ? this.travelingActionPotential.getState() : null);
  }

  // @public
  setState(axonMembraneState) {
    if (!axonMembraneState.getTravelingActionPotentialState() && this.travelingActionPotential) {
      // Get rid of the existing TAP.
      this.removeTravelingActionPotential();
    } else if (axonMembraneState.getTravelingActionPotentialState() && !this.travelingActionPotential) {
      // A traveling action potential needs to be added.
      this.initiateTravelingActionPotential();
    }
    if (this.travelingActionPotential) {
      // Set the state to match the new given state.
      this.travelingActionPotential.setState(axonMembraneState.getTravelingActionPotentialState());
    }
  }

  /**
   * Get the object that defines the current traveling action potential, null if no action potential is happening.
   * @public
   */
  getTravelingActionPotential() {
    return this.travelingActionPotential;
  }

  // @public
  getMembraneThickness() {
    return NeuronConstants.MEMBRANE_THICKNESS;
  }

  // @public
  getCrossSectionDiameter() {
    return NeuronConstants.DEFAULT_DIAMETER;
  }

  // @public
  getCrossSectionEllipseShape() {
    return this.crossSectionEllipseShape;
  }

  // @public
  reset() {
    if (this.travelingActionPotential) {
      // Force premature termination of the action potential.
      this.removeTravelingActionPotential();
    }
  }

  // @public
  getCurveA() {
    return this.curveA;
  }

  // @public
  getCurveB() {
    return this.curveB;
  }

  /**
   * Evaluate the curve in order to locate a point given a distance along the curve.  This uses the DeCasteljau
   * algorithm.
   *
   * This method was converted from static to instance to prevent circular dependency between Traveling
   * Potential and AxonMembrane (Ashraf)
   *
   * @param {Cubic} curve - The curve shape that is being evaluated.
   * @param {number} proportion - proportional distance along the curve from the first control point, must be from 0 to 1.
   * @returns {Vector2} point corresponding to the position of the curve at the specified distance.
   * @public
   */
  evaluateCurve(curve, proportion) {
    if (proportion < 0 || proportion > 1) {
      throw new Error(`proportion is out of range: ${proportion}`);
    }
    this.linearInterpolation(curve.start, curve.control1, proportion, this.ab);
    this.linearInterpolation(curve.control1, curve.control2, proportion, this.bc);
    this.linearInterpolation(curve.control2, curve.end, proportion, this.cd);
    this.linearInterpolation(this.ab, this.bc, proportion, this.abbc);
    this.linearInterpolation(this.bc, this.cd, proportion, this.bbcd);
    return this.linearInterpolation(this.abbc, this.bbcd, proportion);
  }

  /**
   * Simple linear interpolation between two points.
   * @private
   * @param {Vector2} a
   * @param {Vector2} b
   * @param {number} t
   * @param {Vector2} out
   *
   * Vector2's blend creates a new Vector and returns, for performance/memory reasons
   * this code uses this interpolation method
   */
  linearInterpolation(a, b, t, out) {
    out = out || new Vector2(0, 0);
    out.x = a.x + (b.x - a.x) * t;
    out.y = a.y + (b.y - a.y) * t;
    return out;
  }
}
neuron.register('AxonMembrane', AxonMembrane);
export default AxonMembrane;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFbWl0dGVyIiwiVmVjdG9yMiIsIkN1YmljIiwiU2hhcGUiLCJuZXVyb24iLCJOZXVyb25Db25zdGFudHMiLCJBeG9uTWVtYnJhbmVTdGF0ZSIsIlRyYXZlbGluZ0FjdGlvblBvdGVudGlhbCIsIkJPRFlfTEVOR1RIIiwiREVGQVVMVF9ESUFNRVRFUiIsIkJPRFlfVElMVF9BTkdMRSIsIk1hdGgiLCJQSSIsIkF4b25NZW1icmFuZSIsImNvbnN0cnVjdG9yIiwidHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsU3RhcnRlZCIsInRyYXZlbGluZ0FjdGlvblBvdGVudGlhbFJlYWNoZWRDcm9zc1NlY3Rpb24iLCJsaW5nZXJpbmdDb21wbGV0ZWQiLCJ0cmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWxFbmRlZCIsInRyYXZlbGluZ0FjdGlvblBvdGVudGlhbCIsImF4b25Cb2R5U2hhcGUiLCJ2YW5pc2hpbmdQb2ludCIsImNvcyIsInNpbiIsInIiLCJnZXRNZW1icmFuZVRoaWNrbmVzcyIsInRoZXRhIiwiaW50ZXJzZWN0aW9uUG9pbnRBIiwiaW50ZXJzZWN0aW9uUG9pbnRCIiwiYW5nbGVUb1ZhbmlzaGluZ1B0IiwiYXRhbjIiLCJ5IiwieCIsImNvbnRyb2xQdFJhZGl1cyIsImRpc3RhbmNlIiwiY29udHJvbFB0QTEiLCJjb250cm9sUHRBMiIsImFuZ2xlVG9JbnRlcnNlY3Rpb25QdCIsImNvbnRyb2xQdEIxIiwiY29udHJvbFB0QjIiLCJjdXJ2ZUEiLCJjdXJ2ZUIiLCJtb3ZlVG8iLCJjdWJpY0N1cnZlVG8iLCJjbG9zZSIsImNyb3NzU2VjdGlvbkNpcmNsZUNlbnRlciIsIlpFUk8iLCJjcm9zc1NlY3Rpb25DaXJjbGVSYWRpdXMiLCJhYiIsImJjIiwiY2QiLCJhYmJjIiwiYmJjZCIsInN0ZXBJblRpbWUiLCJkdCIsImluaXRpYXRlVHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsIiwiYXNzZXJ0IiwiY3Jvc3NTZWN0aW9uUmVhY2hlZCIsImFkZExpc3RlbmVyIiwiZW1pdCIsInJlbW92ZVRyYXZlbGluZ0FjdGlvblBvdGVudGlhbCIsInN0aW11bHVzUHVsc2VJbml0aWF0ZWQiLCJnZXRTdGF0ZSIsInNldFN0YXRlIiwiYXhvbk1lbWJyYW5lU3RhdGUiLCJnZXRUcmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWxTdGF0ZSIsImdldFRyYXZlbGluZ0FjdGlvblBvdGVudGlhbCIsIk1FTUJSQU5FX1RISUNLTkVTUyIsImdldENyb3NzU2VjdGlvbkRpYW1ldGVyIiwiZ2V0Q3Jvc3NTZWN0aW9uRWxsaXBzZVNoYXBlIiwiY3Jvc3NTZWN0aW9uRWxsaXBzZVNoYXBlIiwicmVzZXQiLCJnZXRDdXJ2ZUEiLCJnZXRDdXJ2ZUIiLCJldmFsdWF0ZUN1cnZlIiwiY3VydmUiLCJwcm9wb3J0aW9uIiwiRXJyb3IiLCJsaW5lYXJJbnRlcnBvbGF0aW9uIiwic3RhcnQiLCJjb250cm9sMSIsImNvbnRyb2wyIiwiZW5kIiwiYSIsImIiLCJ0Iiwib3V0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJBeG9uTWVtYnJhbmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogTW9kZWwgcmVwcmVzZW50YXRpb24gZm9yIHRoZSBheG9uIG1lbWJyYW5lLiAgUmVwcmVzZW50cyBpdCBhcyBhIGNyb3NzIHNlY3Rpb24gYW5kIGEgc2hhcGUgdGhhdCBpcyBpbnRlbmRlZCB0byBsb29rXHJcbiAqIGxpa2UgdGhlIGJvZHkgb2YgdGhlIGF4b24gcmVjZWRpbmcgaW50byB0aGUgZGlzdGFuY2UuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICogQGF1dGhvciBTaGFyZnVkZWVuIEFzaHJhZiAoZm9yIEdoZW50IFVuaXZlcnNpdHkpXHJcbiAqL1xyXG5cclxuaW1wb3J0IEVtaXR0ZXIgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbWl0dGVyLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgeyBDdWJpYywgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbmV1cm9uIGZyb20gJy4uLy4uL25ldXJvbi5qcyc7XHJcbmltcG9ydCBOZXVyb25Db25zdGFudHMgZnJvbSAnLi4vY29tbW9uL05ldXJvbkNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBBeG9uTWVtYnJhbmVTdGF0ZSBmcm9tICcuL0F4b25NZW1icmFuZVN0YXRlLmpzJztcclxuaW1wb3J0IFRyYXZlbGluZ0FjdGlvblBvdGVudGlhbCBmcm9tICcuL1RyYXZlbGluZ0FjdGlvblBvdGVudGlhbC5qcyc7XHJcblxyXG4vLyBGaXhlZCBtZW1icmFuZSBjaGFyYWN0ZXJpc3RpY3MuXHJcbmNvbnN0IEJPRFlfTEVOR1RIID0gTmV1cm9uQ29uc3RhbnRzLkRFRkFVTFRfRElBTUVURVIgKiAxLjU7XHJcbmNvbnN0IEJPRFlfVElMVF9BTkdMRSA9IE1hdGguUEkgLyA0O1xyXG5cclxuY2xhc3MgQXhvbk1lbWJyYW5lIHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAtIGV2ZW50cyBlbWl0dGVkIGJ5IGluc3RhbmNlcyBvZiB0aGlzIHR5cGVcclxuICAgIHRoaXMudHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsU3RhcnRlZCA9IG5ldyBFbWl0dGVyKCk7XHJcbiAgICB0aGlzLnRyYXZlbGluZ0FjdGlvblBvdGVudGlhbFJlYWNoZWRDcm9zc1NlY3Rpb24gPSBuZXcgRW1pdHRlcigpO1xyXG4gICAgdGhpcy5saW5nZXJpbmdDb21wbGV0ZWQgPSBuZXcgRW1pdHRlcigpO1xyXG4gICAgdGhpcy50cmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWxFbmRlZCA9IG5ldyBFbWl0dGVyKCk7XHJcblxyXG4gICAgLy8gVHJhdmVsaW5nIGFjdGlvbiBwb3RlbnRpYWwgdGhhdCBtb3ZlcyBkb3duIHRoZSBtZW1icmFuZS5cclxuICAgIHRoaXMudHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsID0gbnVsbDtcclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAvLyBDcmVhdGUgdGhlIHNoYXBlIG9mIHRoZSBheG9uIGJvZHlcclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgICAvLyBAcHVibGljIC0gc2hhcGUgb2YgdGhlIGJvZHkgb2YgdGhlIGF4b25cclxuICAgIHRoaXMuYXhvbkJvZHlTaGFwZSA9IG5ldyBTaGFwZSgpO1xyXG5cclxuICAgIC8vIHBvaW50cyBhdCB3aGljaCBheG9uIG1lbWJyYW5lIHdvdWxkIGFwcGVhciB0byB2YW5pc2gsIHVzZWQgaW4gc2hhcGUgY3JlYXRpb25cclxuICAgIGNvbnN0IHZhbmlzaGluZ1BvaW50ID0gbmV3IFZlY3RvcjIoXHJcbiAgICAgIEJPRFlfTEVOR1RIICogTWF0aC5jb3MoIEJPRFlfVElMVF9BTkdMRSApLFxyXG4gICAgICBCT0RZX0xFTkdUSCAqIE1hdGguc2luKCBCT0RZX1RJTFRfQU5HTEUgKVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBGaW5kIHRoZSB0d28gcG9pbnRzIGF0IHdoaWNoIHRoZSBzaGFwZSB3aWxsIGludGVyc2VjdCB0aGUgb3V0ZXIgZWRnZSBvZiB0aGUgY3Jvc3Mgc2VjdGlvbi5cclxuICAgIGNvbnN0IHIgPSBOZXVyb25Db25zdGFudHMuREVGQVVMVF9ESUFNRVRFUiAvIDIgKyB0aGlzLmdldE1lbWJyYW5lVGhpY2tuZXNzKCkgLyAyO1xyXG4gICAgbGV0IHRoZXRhID0gQk9EWV9USUxUX0FOR0xFICsgTWF0aC5QSSAqIDAuNDU7IC8vIE11bHRpcGxpZXIgdHdlYWtlZCBhIGJpdCBmb3IgaW1wcm92ZWQgYXBwZWFyYW5jZS5cclxuICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50QSA9IG5ldyBWZWN0b3IyKCByICogTWF0aC5jb3MoIHRoZXRhICksIHIgKiBNYXRoLnNpbiggdGhldGEgKSApO1xyXG4gICAgdGhldGEgKz0gTWF0aC5QSTtcclxuICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50QiA9IG5ldyBWZWN0b3IyKCByICogTWF0aC5jb3MoIHRoZXRhICksIHIgKiBNYXRoLnNpbiggdGhldGEgKSApO1xyXG5cclxuICAgIC8vIERlZmluZSB0aGUgY29udHJvbCBwb2ludHMgZm9yIHRoZSB0d28gY3VydmVzLiAgTm90ZSB0aGF0IHRoZXJlIGlzIHNvbWUgdHdlYWtpbmcgaW4gaGVyZSwgc28gY2hhbmdlIGFzIG5lZWRlZFxyXG4gICAgLy8gdG8gZ2V0IHRoZSBkZXNpcmVkIGxvb2suIElmIHlvdSBjYW4gZmlndXJlIGl0IG91dCwgdGhhdCBpcy4gIEhpbnRzOiBUaGUgc2hhcGUgaXMgZHJhd24gc3RhcnRpbmcgYXMgYSBjdXJ2ZVxyXG4gICAgLy8gZnJvbSB0aGUgdmFuaXNoaW5nIHBvaW50IHRvIGludGVyc2VjdGlvbiBwb2ludCBBLCB0aGVuIGEgbGluZSB0byBpbnRlcnNlY3Rpb24gcG9pbnQgQiwgdGhlbiBhcyBhIGN1cnZlIGJhY2sgdG9cclxuICAgIC8vIHRoZSB2YW5pc2hpbmcgcG9pbnQuXHJcbiAgICBjb25zdCBhbmdsZVRvVmFuaXNoaW5nUHQgPSBNYXRoLmF0YW4yKFxyXG4gICAgICB2YW5pc2hpbmdQb2ludC55IC0gaW50ZXJzZWN0aW9uUG9pbnRBLnksXHJcbiAgICAgIHZhbmlzaGluZ1BvaW50LnggLSBpbnRlcnNlY3Rpb25Qb2ludEEueCApO1xyXG4gICAgbGV0IGNvbnRyb2xQdFJhZGl1cyA9IGludGVyc2VjdGlvblBvaW50QS5kaXN0YW5jZSggdmFuaXNoaW5nUG9pbnQgKSAqIDAuMzM7XHJcbiAgICBjb25zdCBjb250cm9sUHRBMSA9IG5ldyBWZWN0b3IyKFxyXG4gICAgICBpbnRlcnNlY3Rpb25Qb2ludEEueCArIGNvbnRyb2xQdFJhZGl1cyAqIE1hdGguY29zKCBhbmdsZVRvVmFuaXNoaW5nUHQgKyAwLjE1ICksXHJcbiAgICAgIGludGVyc2VjdGlvblBvaW50QS55ICsgY29udHJvbFB0UmFkaXVzICogTWF0aC5zaW4oIGFuZ2xlVG9WYW5pc2hpbmdQdCArIDAuMTUgKSApO1xyXG4gICAgY29udHJvbFB0UmFkaXVzID0gaW50ZXJzZWN0aW9uUG9pbnRBLmRpc3RhbmNlKCB2YW5pc2hpbmdQb2ludCApICogMC42NztcclxuICAgIGNvbnN0IGNvbnRyb2xQdEEyID0gbmV3IFZlY3RvcjIoXHJcbiAgICAgIGludGVyc2VjdGlvblBvaW50QS54ICsgY29udHJvbFB0UmFkaXVzICogTWF0aC5jb3MoIGFuZ2xlVG9WYW5pc2hpbmdQdCAtIDAuNSApLFxyXG4gICAgICBpbnRlcnNlY3Rpb25Qb2ludEEueSArIGNvbnRyb2xQdFJhZGl1cyAqIE1hdGguc2luKCBhbmdsZVRvVmFuaXNoaW5nUHQgLSAwLjUgKSApO1xyXG5cclxuICAgIGNvbnN0IGFuZ2xlVG9JbnRlcnNlY3Rpb25QdCA9IE1hdGguYXRhbjIoIGludGVyc2VjdGlvblBvaW50Qi55IC0gdmFuaXNoaW5nUG9pbnQueSxcclxuICAgICAgaW50ZXJzZWN0aW9uUG9pbnRCLnggLSBpbnRlcnNlY3Rpb25Qb2ludEIueCApO1xyXG4gICAgY29udHJvbFB0UmFkaXVzID0gaW50ZXJzZWN0aW9uUG9pbnRCLmRpc3RhbmNlKCB2YW5pc2hpbmdQb2ludCApICogMC4zMztcclxuICAgIGNvbnN0IGNvbnRyb2xQdEIxID0gbmV3IFZlY3RvcjIoXHJcbiAgICAgIHZhbmlzaGluZ1BvaW50LnggKyBjb250cm9sUHRSYWRpdXMgKiBNYXRoLmNvcyggYW5nbGVUb0ludGVyc2VjdGlvblB0ICsgMC4xICksXHJcbiAgICAgIHZhbmlzaGluZ1BvaW50LnkgKyBjb250cm9sUHRSYWRpdXMgKiBNYXRoLnNpbiggYW5nbGVUb0ludGVyc2VjdGlvblB0ICsgMC4xICkgKTtcclxuICAgIGNvbnRyb2xQdFJhZGl1cyA9IGludGVyc2VjdGlvblBvaW50Qi5kaXN0YW5jZSggdmFuaXNoaW5nUG9pbnQgKSAqIDAuNjc7XHJcbiAgICBjb25zdCBjb250cm9sUHRCMiA9IG5ldyBWZWN0b3IyKFxyXG4gICAgICB2YW5pc2hpbmdQb2ludC54ICsgY29udHJvbFB0UmFkaXVzICogTWF0aC5jb3MoIGFuZ2xlVG9JbnRlcnNlY3Rpb25QdCAtIDAuMjUgKSxcclxuICAgICAgdmFuaXNoaW5nUG9pbnQueSArIGNvbnRyb2xQdFJhZGl1cyAqIE1hdGguc2luKCBhbmdsZVRvSW50ZXJzZWN0aW9uUHQgLSAwLjI1ICkgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSAtIGN1cnZlcyB0aGF0IGRlZmluZSB0aGUgYm91bmRhcmllcyBvZiB0aGUgYm9keVxyXG4gICAgdGhpcy5jdXJ2ZUEgPSBuZXcgQ3ViaWMoXHJcbiAgICAgIHZhbmlzaGluZ1BvaW50LFxyXG4gICAgICBjb250cm9sUHRBMixcclxuICAgICAgY29udHJvbFB0QTEsXHJcbiAgICAgIGludGVyc2VjdGlvblBvaW50QVxyXG4gICAgKTtcclxuICAgIHRoaXMuY3VydmVCID0gbmV3IEN1YmljKFxyXG4gICAgICB2YW5pc2hpbmdQb2ludCxcclxuICAgICAgY29udHJvbFB0QjEsXHJcbiAgICAgIGNvbnRyb2xQdEIyLFxyXG4gICAgICBpbnRlcnNlY3Rpb25Qb2ludEJcclxuICAgICk7XHJcblxyXG4gICAgLy8gSW4gb3JkZXIgdG8gY3JlYXRlIHRoZSBmdWxsIHNoYXBlLCB3ZSByZXZlcnNlIG9uZSBvZiB0aGUgY3VydmVzIGFuZCB0aGUgY29ubmVjdCB0aGUgdHdvIGN1cnZlcyB0b2dldGhlciBpblxyXG4gICAgLy8gb3JkZXIgdG8gY3JlYXRlIHRoZSBmdWxsIHNoYXBlIG9mIHRoZSBheG9uIGJvZHkuXHJcbiAgICB0aGlzLmF4b25Cb2R5U2hhcGUubW92ZVRvKCBpbnRlcnNlY3Rpb25Qb2ludEEueCwgaW50ZXJzZWN0aW9uUG9pbnRBLnkgKTtcclxuICAgIHRoaXMuYXhvbkJvZHlTaGFwZS5jdWJpY0N1cnZlVG8oXHJcbiAgICAgIGNvbnRyb2xQdEExLngsXHJcbiAgICAgIGNvbnRyb2xQdEExLnksXHJcbiAgICAgIGNvbnRyb2xQdEEyLngsXHJcbiAgICAgIGNvbnRyb2xQdEEyLnksXHJcbiAgICAgIHZhbmlzaGluZ1BvaW50LngsXHJcbiAgICAgIHZhbmlzaGluZ1BvaW50LnlcclxuICAgICk7XHJcbiAgICB0aGlzLmF4b25Cb2R5U2hhcGUuY3ViaWNDdXJ2ZVRvKFxyXG4gICAgICBjb250cm9sUHRCMS54LFxyXG4gICAgICBjb250cm9sUHRCMS55LFxyXG4gICAgICBjb250cm9sUHRCMi54LFxyXG4gICAgICBjb250cm9sUHRCMi55LFxyXG4gICAgICBpbnRlcnNlY3Rpb25Qb2ludEIueCxcclxuICAgICAgaW50ZXJzZWN0aW9uUG9pbnRCLnlcclxuICAgICk7XHJcbiAgICB0aGlzLmF4b25Cb2R5U2hhcGUuY2xvc2UoKTtcclxuXHJcbiAgICAvLyBAcHVibGljIC0gc2hhcGUgb2YgdGhlIGNyb3NzIHNlY3Rpb24gb2YgdGhlIG1lbWJyYW5lLiBGb3Igbm93LCBhbmQgdW5sZXNzIHRoZXJlIGlzIHNvbWUgcmVhc29uIHRvIGRvIG90aGVyd2lzZSxcclxuICAgIC8vIHRoZSBjZW50ZXIgb2YgdGhlIGNyb3NzIHNlY3Rpb24gaXMgcG9zaXRpb25lZCBhdCB0aGUgb3JpZ2luLlxyXG4gICAgdGhpcy5jcm9zc1NlY3Rpb25DaXJjbGVDZW50ZXIgPSBWZWN0b3IyLlpFUk87XHJcbiAgICB0aGlzLmNyb3NzU2VjdGlvbkNpcmNsZVJhZGl1cyA9IE5ldXJvbkNvbnN0YW50cy5ERUZBVUxUX0RJQU1FVEVSIC8gMjtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSAtIEluIG9yZGVyIHRvIGF2b2lkIGNyZWF0aW5nIG5ldyBWZWN0b3IyIGluc3RhbmNlcyBkdXJpbmcgYW5pbWF0aW9uLCB0aGVzZSBpbnN0YW5jZXMgYXJlIGRlY2xhcmVkIGFuZFxyXG4gICAgLy8gcmV1c2VkIGluIHRoZSBldmFsdWF0ZUN1cnZlIG1ldGhvZC5cclxuICAgIHRoaXMuYWIgPSBuZXcgVmVjdG9yMiggMCwgMCApO1xyXG4gICAgdGhpcy5iYyA9IG5ldyBWZWN0b3IyKCAwLCAwICk7XHJcbiAgICB0aGlzLmNkID0gbmV3IFZlY3RvcjIoIDAsIDAgKTtcclxuICAgIHRoaXMuYWJiYyA9IG5ldyBWZWN0b3IyKCAwLCAwICk7XHJcbiAgICB0aGlzLmJiY2QgPSBuZXcgVmVjdG9yMiggMCwgMCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RlcCB0aGlzIG1vZGVsIGVsZW1lbnQgZm9yd2FyZCBpbiB0aW1lIGJ5IHRoZSBzcGVjaWZpZWQgZGVsdGEuXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGR0IC0gZGVsdGEgdGltZSwgaW4gc2Vjb25kcy5cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc3RlcEluVGltZSggZHQgKSB7XHJcbiAgICBpZiAoIHRoaXMudHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsICkge1xyXG4gICAgICB0aGlzLnRyYXZlbGluZ0FjdGlvblBvdGVudGlhbC5zdGVwSW5UaW1lKCBkdCApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgYW4gYWN0aW9uIHBvdGVudGlhbCB0aGF0IHdpbGwgdHJhdmVsIGRvd24gdGhlIGxlbmd0aCBvZiB0aGUgbWVtYnJhbmUgdG93YXJkIHRoZSB0cmFuc3ZlcnNlIGNyb3NzIHNlY3Rpb24uXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGluaXRpYXRlVHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsKCkge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy50cmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWwgPT09IG51bGwsICdTaG91bGQgbm90IGluaXRpYXRlIGEgMm5kIHRyYXZlbGluZyBhY3Rpb24gcG90ZW50aWFsIGJlZm9yZSBwcmlvciBvbmUgaGFzIGNvbXBsZXRlZC4nICk7XHJcbiAgICB0aGlzLnRyYXZlbGluZ0FjdGlvblBvdGVudGlhbCA9IG5ldyBUcmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWwoIHRoaXMgKTtcclxuICAgIHRoaXMudHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsLmNyb3NzU2VjdGlvblJlYWNoZWQuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgICAgdGhpcy50cmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWxSZWFjaGVkQ3Jvc3NTZWN0aW9uLmVtaXQoKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnRyYXZlbGluZ0FjdGlvblBvdGVudGlhbC5saW5nZXJpbmdDb21wbGV0ZWQuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgICAgdGhpcy5yZW1vdmVUcmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWwoKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnRyYXZlbGluZ0FjdGlvblBvdGVudGlhbFN0YXJ0ZWQuZW1pdCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVtb3ZlIHRoZSB0cmF2ZWxpbmcgYWN0aW9uIHBvdGVudGlhbCwgZWl0aGVyIGJlY2F1c2UgaXQgaGFzIHJlYWNoZWQgdGhlIGNyb3NzIHNlY3Rpb24gYW5kIGlzIHRoZXJlZm9yZSBub1xyXG4gICAqIGxvbmdlciBuZWVkZWQsIG9yIGZvciBzb21lIG90aGVyIHJlYXNvbiAoc3VjaCBhcyBhIHJlc2V0IG9yIGp1bXAgaW4gdGhlIHBsYXliYWNrIHN0YXRlKS5cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVtb3ZlVHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsKCkge1xyXG4gICAgdGhpcy50cmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWxFbmRlZC5lbWl0KCk7XHJcbiAgICB0aGlzLnN0aW11bHVzUHVsc2VJbml0aWF0ZWQgPSBmYWxzZTtcclxuICAgIHRoaXMudHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsID0gbnVsbDtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBnZXRTdGF0ZSgpIHtcclxuICAgIHJldHVybiBuZXcgQXhvbk1lbWJyYW5lU3RhdGUoIHRoaXMudHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsID8gdGhpcy50cmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWwuZ2V0U3RhdGUoKSA6IG51bGwgKTtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBzZXRTdGF0ZSggYXhvbk1lbWJyYW5lU3RhdGUgKSB7XHJcbiAgICBpZiAoICFheG9uTWVtYnJhbmVTdGF0ZS5nZXRUcmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWxTdGF0ZSgpICYmIHRoaXMudHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsICkge1xyXG4gICAgICAvLyBHZXQgcmlkIG9mIHRoZSBleGlzdGluZyBUQVAuXHJcbiAgICAgIHRoaXMucmVtb3ZlVHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggYXhvbk1lbWJyYW5lU3RhdGUuZ2V0VHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsU3RhdGUoKSAmJiAhdGhpcy50cmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWwgKSB7XHJcbiAgICAgIC8vIEEgdHJhdmVsaW5nIGFjdGlvbiBwb3RlbnRpYWwgbmVlZHMgdG8gYmUgYWRkZWQuXHJcbiAgICAgIHRoaXMuaW5pdGlhdGVUcmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWwoKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIHRoaXMudHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsICkge1xyXG4gICAgICAvLyBTZXQgdGhlIHN0YXRlIHRvIG1hdGNoIHRoZSBuZXcgZ2l2ZW4gc3RhdGUuXHJcbiAgICAgIHRoaXMudHJhdmVsaW5nQWN0aW9uUG90ZW50aWFsLnNldFN0YXRlKCBheG9uTWVtYnJhbmVTdGF0ZS5nZXRUcmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWxTdGF0ZSgpICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIG9iamVjdCB0aGF0IGRlZmluZXMgdGhlIGN1cnJlbnQgdHJhdmVsaW5nIGFjdGlvbiBwb3RlbnRpYWwsIG51bGwgaWYgbm8gYWN0aW9uIHBvdGVudGlhbCBpcyBoYXBwZW5pbmcuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGdldFRyYXZlbGluZ0FjdGlvblBvdGVudGlhbCgpIHtcclxuICAgIHJldHVybiB0aGlzLnRyYXZlbGluZ0FjdGlvblBvdGVudGlhbDtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBnZXRNZW1icmFuZVRoaWNrbmVzcygpIHtcclxuICAgIHJldHVybiBOZXVyb25Db25zdGFudHMuTUVNQlJBTkVfVEhJQ0tORVNTO1xyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIGdldENyb3NzU2VjdGlvbkRpYW1ldGVyKCkge1xyXG4gICAgcmV0dXJuIE5ldXJvbkNvbnN0YW50cy5ERUZBVUxUX0RJQU1FVEVSO1xyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIGdldENyb3NzU2VjdGlvbkVsbGlwc2VTaGFwZSgpIHtcclxuICAgIHJldHVybiB0aGlzLmNyb3NzU2VjdGlvbkVsbGlwc2VTaGFwZTtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICByZXNldCgpIHtcclxuICAgIGlmICggdGhpcy50cmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWwgKSB7XHJcbiAgICAgIC8vIEZvcmNlIHByZW1hdHVyZSB0ZXJtaW5hdGlvbiBvZiB0aGUgYWN0aW9uIHBvdGVudGlhbC5cclxuICAgICAgdGhpcy5yZW1vdmVUcmF2ZWxpbmdBY3Rpb25Qb3RlbnRpYWwoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBnZXRDdXJ2ZUEoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jdXJ2ZUE7XHJcbiAgfVxyXG5cclxuICAvLyBAcHVibGljXHJcbiAgZ2V0Q3VydmVCKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY3VydmVCO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRXZhbHVhdGUgdGhlIGN1cnZlIGluIG9yZGVyIHRvIGxvY2F0ZSBhIHBvaW50IGdpdmVuIGEgZGlzdGFuY2UgYWxvbmcgdGhlIGN1cnZlLiAgVGhpcyB1c2VzIHRoZSBEZUNhc3RlbGphdVxyXG4gICAqIGFsZ29yaXRobS5cclxuICAgKlxyXG4gICAqIFRoaXMgbWV0aG9kIHdhcyBjb252ZXJ0ZWQgZnJvbSBzdGF0aWMgdG8gaW5zdGFuY2UgdG8gcHJldmVudCBjaXJjdWxhciBkZXBlbmRlbmN5IGJldHdlZW4gVHJhdmVsaW5nXHJcbiAgICogUG90ZW50aWFsIGFuZCBBeG9uTWVtYnJhbmUgKEFzaHJhZilcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Q3ViaWN9IGN1cnZlIC0gVGhlIGN1cnZlIHNoYXBlIHRoYXQgaXMgYmVpbmcgZXZhbHVhdGVkLlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBwcm9wb3J0aW9uIC0gcHJvcG9ydGlvbmFsIGRpc3RhbmNlIGFsb25nIHRoZSBjdXJ2ZSBmcm9tIHRoZSBmaXJzdCBjb250cm9sIHBvaW50LCBtdXN0IGJlIGZyb20gMCB0byAxLlxyXG4gICAqIEByZXR1cm5zIHtWZWN0b3IyfSBwb2ludCBjb3JyZXNwb25kaW5nIHRvIHRoZSBwb3NpdGlvbiBvZiB0aGUgY3VydmUgYXQgdGhlIHNwZWNpZmllZCBkaXN0YW5jZS5cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZXZhbHVhdGVDdXJ2ZSggY3VydmUsIHByb3BvcnRpb24gKSB7XHJcbiAgICBpZiAoIHByb3BvcnRpb24gPCAwIHx8IHByb3BvcnRpb24gPiAxICkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoIGBwcm9wb3J0aW9uIGlzIG91dCBvZiByYW5nZTogJHtwcm9wb3J0aW9ufWAgKTtcclxuICAgIH1cclxuICAgIHRoaXMubGluZWFySW50ZXJwb2xhdGlvbiggY3VydmUuc3RhcnQsIGN1cnZlLmNvbnRyb2wxLCBwcm9wb3J0aW9uLCB0aGlzLmFiICk7XHJcbiAgICB0aGlzLmxpbmVhckludGVycG9sYXRpb24oIGN1cnZlLmNvbnRyb2wxLCBjdXJ2ZS5jb250cm9sMiwgcHJvcG9ydGlvbiwgdGhpcy5iYyApO1xyXG4gICAgdGhpcy5saW5lYXJJbnRlcnBvbGF0aW9uKCBjdXJ2ZS5jb250cm9sMiwgY3VydmUuZW5kLCBwcm9wb3J0aW9uLCB0aGlzLmNkICk7XHJcbiAgICB0aGlzLmxpbmVhckludGVycG9sYXRpb24oIHRoaXMuYWIsIHRoaXMuYmMsIHByb3BvcnRpb24sIHRoaXMuYWJiYyApO1xyXG4gICAgdGhpcy5saW5lYXJJbnRlcnBvbGF0aW9uKCB0aGlzLmJjLCB0aGlzLmNkLCBwcm9wb3J0aW9uLCB0aGlzLmJiY2QgKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5saW5lYXJJbnRlcnBvbGF0aW9uKCB0aGlzLmFiYmMsIHRoaXMuYmJjZCwgcHJvcG9ydGlvbiApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2ltcGxlIGxpbmVhciBpbnRlcnBvbGF0aW9uIGJldHdlZW4gdHdvIHBvaW50cy5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEBwYXJhbSB7VmVjdG9yMn0gYVxyXG4gICAqIEBwYXJhbSB7VmVjdG9yMn0gYlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0XHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBvdXRcclxuICAgKlxyXG4gICAqIFZlY3RvcjIncyBibGVuZCBjcmVhdGVzIGEgbmV3IFZlY3RvciBhbmQgcmV0dXJucywgZm9yIHBlcmZvcm1hbmNlL21lbW9yeSByZWFzb25zXHJcbiAgICogdGhpcyBjb2RlIHVzZXMgdGhpcyBpbnRlcnBvbGF0aW9uIG1ldGhvZFxyXG4gICAqL1xyXG4gIGxpbmVhckludGVycG9sYXRpb24oIGEsIGIsIHQsIG91dCApIHtcclxuICAgIG91dCA9IG91dCB8fCBuZXcgVmVjdG9yMiggMCwgMCApO1xyXG4gICAgb3V0LnggPSBhLnggKyAoIGIueCAtIGEueCApICogdDtcclxuICAgIG91dC55ID0gYS55ICsgKCBiLnkgLSBhLnkgKSAqIHQ7XHJcbiAgICByZXR1cm4gb3V0O1xyXG4gIH1cclxufVxyXG5cclxubmV1cm9uLnJlZ2lzdGVyKCAnQXhvbk1lbWJyYW5lJywgQXhvbk1lbWJyYW5lICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBBeG9uTWVtYnJhbmU7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsT0FBTyxNQUFNLGdDQUFnQztBQUNwRCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELFNBQVNDLEtBQUssRUFBRUMsS0FBSyxRQUFRLGdDQUFnQztBQUM3RCxPQUFPQyxNQUFNLE1BQU0saUJBQWlCO0FBQ3BDLE9BQU9DLGVBQWUsTUFBTSw4QkFBOEI7QUFDMUQsT0FBT0MsaUJBQWlCLE1BQU0sd0JBQXdCO0FBQ3RELE9BQU9DLHdCQUF3QixNQUFNLCtCQUErQjs7QUFFcEU7QUFDQSxNQUFNQyxXQUFXLEdBQUdILGVBQWUsQ0FBQ0ksZ0JBQWdCLEdBQUcsR0FBRztBQUMxRCxNQUFNQyxlQUFlLEdBQUdDLElBQUksQ0FBQ0MsRUFBRSxHQUFHLENBQUM7QUFFbkMsTUFBTUMsWUFBWSxDQUFDO0VBRWpCQyxXQUFXQSxDQUFBLEVBQUc7SUFFWjtJQUNBLElBQUksQ0FBQ0MsK0JBQStCLEdBQUcsSUFBSWYsT0FBTyxDQUFDLENBQUM7SUFDcEQsSUFBSSxDQUFDZ0IsMkNBQTJDLEdBQUcsSUFBSWhCLE9BQU8sQ0FBQyxDQUFDO0lBQ2hFLElBQUksQ0FBQ2lCLGtCQUFrQixHQUFHLElBQUlqQixPQUFPLENBQUMsQ0FBQztJQUN2QyxJQUFJLENBQUNrQiw2QkFBNkIsR0FBRyxJQUFJbEIsT0FBTyxDQUFDLENBQUM7O0lBRWxEO0lBQ0EsSUFBSSxDQUFDbUIsd0JBQXdCLEdBQUcsSUFB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