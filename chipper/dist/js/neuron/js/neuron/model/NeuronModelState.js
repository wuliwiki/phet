// Copyright 2014-2020, University of Colorado Boulder
/**
 * This class contains state information about the model for a given point in time.  It contains enough information for
 * the playback feature, but not necessarily enough to fully restore the simulation to an arbitrary point in time.

 * @author John Blanco
 * @author Sharfudeen Ashraf (for Ghent University)
 */

import neuron from '../../neuron.js';

/*
 * JavaScript object dictionary only supports String as keys, but the channel's state are stored against Membrane
 * Channel object(key). This "map" utility supports this functionality by allowing any object to be used as key.
 * @returns {{put: put, get: get}}
 */
function map() {
  const keys = [];
  const values = [];
  return {
    put: (key, value) => {
      const index = keys.indexOf(key);
      if (index === -1) {
        keys.push(key);
        values.push(value);
      } else {
        values[index] = value;
      }
    },
    get: key => values[keys.indexOf(key)]
  };
}
class NeuronModelState {
  /**
   * @param {NeuronModel} neuronModel
   */
  constructor(neuronModel) {
    // @private, accessed via getter methods
    this.axonMembraneState = neuronModel.getAxonMembrane().getState();
    this.hodgkinHuxleyModelState = neuronModel.hodgkinHuxleyModel.getState();
    this.membranePotential = neuronModel.getMembranePotential();
    this.sodiumExteriorConcentration = neuronModel.getSodiumExteriorConcentration();
    this.sodiumInteriorConcentration = neuronModel.getSodiumInteriorConcentration();
    this.potassiumExteriorConcentration = neuronModel.getPotassiumExteriorConcentration();
    this.potassiumInteriorConcentration = neuronModel.getPotassiumInteriorConcentration();

    // use c-style loops below for better performance

    let i;
    this.membraneChannelStateMap = map();
    for (i = 0; i < neuronModel.membraneChannels.length; i++) {
      const membraneChannel = neuronModel.membraneChannels.get(i);
      this.membraneChannelStateMap.put(membraneChannel, membraneChannel.getState());
    }
    this.particlePlaybackMementos = [];
    for (i = 0; i < neuronModel.transientParticles.length; i++) {
      const transientParticle = neuronModel.transientParticles.get(i);
      this.particlePlaybackMementos.push(transientParticle.getPlaybackMemento());
    }
  }

  // @public
  getAxonMembraneState() {
    return this.axonMembraneState;
  }

  // @public
  getHodgkinHuxleyModelState() {
    return this.hodgkinHuxleyModelState;
  }

  // @public
  getMembraneChannelStateMap() {
    return this.membraneChannelStateMap;
  }

  // @public
  getPlaybackParticleMementos() {
    return this.particlePlaybackMementos;
  }

  // @public
  getMembranePotential() {
    return this.membranePotential;
  }

  // @public
  getSodiumInteriorConcentration() {
    return this.sodiumInteriorConcentration;
  }

  // @public
  getSodiumExteriorConcentration() {
    return this.sodiumExteriorConcentration;
  }

  // @public
  getPotassiumInteriorConcentration() {
    return this.potassiumInteriorConcentration;
  }

  // @public
  getPotassiumExteriorConcentration() {
    return this.potassiumExteriorConcentration;
  }
}
neuron.register('NeuronModelState', NeuronModelState);
export default NeuronModelState;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJuZXVyb24iLCJtYXAiLCJrZXlzIiwidmFsdWVzIiwicHV0Iiwia2V5IiwidmFsdWUiLCJpbmRleCIsImluZGV4T2YiLCJwdXNoIiwiZ2V0IiwiTmV1cm9uTW9kZWxTdGF0ZSIsImNvbnN0cnVjdG9yIiwibmV1cm9uTW9kZWwiLCJheG9uTWVtYnJhbmVTdGF0ZSIsImdldEF4b25NZW1icmFuZSIsImdldFN0YXRlIiwiaG9kZ2tpbkh1eGxleU1vZGVsU3RhdGUiLCJob2Rna2luSHV4bGV5TW9kZWwiLCJtZW1icmFuZVBvdGVudGlhbCIsImdldE1lbWJyYW5lUG90ZW50aWFsIiwic29kaXVtRXh0ZXJpb3JDb25jZW50cmF0aW9uIiwiZ2V0U29kaXVtRXh0ZXJpb3JDb25jZW50cmF0aW9uIiwic29kaXVtSW50ZXJpb3JDb25jZW50cmF0aW9uIiwiZ2V0U29kaXVtSW50ZXJpb3JDb25jZW50cmF0aW9uIiwicG90YXNzaXVtRXh0ZXJpb3JDb25jZW50cmF0aW9uIiwiZ2V0UG90YXNzaXVtRXh0ZXJpb3JDb25jZW50cmF0aW9uIiwicG90YXNzaXVtSW50ZXJpb3JDb25jZW50cmF0aW9uIiwiZ2V0UG90YXNzaXVtSW50ZXJpb3JDb25jZW50cmF0aW9uIiwiaSIsIm1lbWJyYW5lQ2hhbm5lbFN0YXRlTWFwIiwibWVtYnJhbmVDaGFubmVscyIsImxlbmd0aCIsIm1lbWJyYW5lQ2hhbm5lbCIsInBhcnRpY2xlUGxheWJhY2tNZW1lbnRvcyIsInRyYW5zaWVudFBhcnRpY2xlcyIsInRyYW5zaWVudFBhcnRpY2xlIiwiZ2V0UGxheWJhY2tNZW1lbnRvIiwiZ2V0QXhvbk1lbWJyYW5lU3RhdGUiLCJnZXRIb2Rna2luSHV4bGV5TW9kZWxTdGF0ZSIsImdldE1lbWJyYW5lQ2hhbm5lbFN0YXRlTWFwIiwiZ2V0UGxheWJhY2tQYXJ0aWNsZU1lbWVudG9zIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJOZXVyb25Nb2RlbFN0YXRlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjAsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG4vKipcclxuICogVGhpcyBjbGFzcyBjb250YWlucyBzdGF0ZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgbW9kZWwgZm9yIGEgZ2l2ZW4gcG9pbnQgaW4gdGltZS4gIEl0IGNvbnRhaW5zIGVub3VnaCBpbmZvcm1hdGlvbiBmb3JcclxuICogdGhlIHBsYXliYWNrIGZlYXR1cmUsIGJ1dCBub3QgbmVjZXNzYXJpbHkgZW5vdWdoIHRvIGZ1bGx5IHJlc3RvcmUgdGhlIHNpbXVsYXRpb24gdG8gYW4gYXJiaXRyYXJ5IHBvaW50IGluIHRpbWUuXHJcblxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvXHJcbiAqIEBhdXRob3IgU2hhcmZ1ZGVlbiBBc2hyYWYgKGZvciBHaGVudCBVbml2ZXJzaXR5KVxyXG4gKi9cclxuXHJcbmltcG9ydCBuZXVyb24gZnJvbSAnLi4vLi4vbmV1cm9uLmpzJztcclxuXHJcbi8qXHJcbiAqIEphdmFTY3JpcHQgb2JqZWN0IGRpY3Rpb25hcnkgb25seSBzdXBwb3J0cyBTdHJpbmcgYXMga2V5cywgYnV0IHRoZSBjaGFubmVsJ3Mgc3RhdGUgYXJlIHN0b3JlZCBhZ2FpbnN0IE1lbWJyYW5lXHJcbiAqIENoYW5uZWwgb2JqZWN0KGtleSkuIFRoaXMgXCJtYXBcIiB1dGlsaXR5IHN1cHBvcnRzIHRoaXMgZnVuY3Rpb25hbGl0eSBieSBhbGxvd2luZyBhbnkgb2JqZWN0IHRvIGJlIHVzZWQgYXMga2V5LlxyXG4gKiBAcmV0dXJucyB7e3B1dDogcHV0LCBnZXQ6IGdldH19XHJcbiAqL1xyXG5mdW5jdGlvbiBtYXAoKSB7XHJcbiAgY29uc3Qga2V5cyA9IFtdO1xyXG4gIGNvbnN0IHZhbHVlcyA9IFtdO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgcHV0OiAoIGtleSwgdmFsdWUgKSA9PiB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0ga2V5cy5pbmRleE9mKCBrZXkgKTtcclxuICAgICAgaWYgKCBpbmRleCA9PT0gLTEgKSB7XHJcbiAgICAgICAga2V5cy5wdXNoKCBrZXkgKTtcclxuICAgICAgICB2YWx1ZXMucHVzaCggdmFsdWUgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB2YWx1ZXNbIGluZGV4IF0gPSB2YWx1ZTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIGdldDoga2V5ID0+IHZhbHVlc1sga2V5cy5pbmRleE9mKCBrZXkgKSBdXHJcbiAgfTtcclxufVxyXG5cclxuY2xhc3MgTmV1cm9uTW9kZWxTdGF0ZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7TmV1cm9uTW9kZWx9IG5ldXJvbk1vZGVsXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG5ldXJvbk1vZGVsICkge1xyXG5cclxuICAgIC8vIEBwcml2YXRlLCBhY2Nlc3NlZCB2aWEgZ2V0dGVyIG1ldGhvZHNcclxuICAgIHRoaXMuYXhvbk1lbWJyYW5lU3RhdGUgPSBuZXVyb25Nb2RlbC5nZXRBeG9uTWVtYnJhbmUoKS5nZXRTdGF0ZSgpO1xyXG4gICAgdGhpcy5ob2Rna2luSHV4bGV5TW9kZWxTdGF0ZSA9IG5ldXJvbk1vZGVsLmhvZGdraW5IdXhsZXlNb2RlbC5nZXRTdGF0ZSgpO1xyXG4gICAgdGhpcy5tZW1icmFuZVBvdGVudGlhbCA9IG5ldXJvbk1vZGVsLmdldE1lbWJyYW5lUG90ZW50aWFsKCk7XHJcbiAgICB0aGlzLnNvZGl1bUV4dGVyaW9yQ29uY2VudHJhdGlvbiA9IG5ldXJvbk1vZGVsLmdldFNvZGl1bUV4dGVyaW9yQ29uY2VudHJhdGlvbigpO1xyXG4gICAgdGhpcy5zb2RpdW1JbnRlcmlvckNvbmNlbnRyYXRpb24gPSBuZXVyb25Nb2RlbC5nZXRTb2RpdW1JbnRlcmlvckNvbmNlbnRyYXRpb24oKTtcclxuICAgIHRoaXMucG90YXNzaXVtRXh0ZXJpb3JDb25jZW50cmF0aW9uID0gbmV1cm9uTW9kZWwuZ2V0UG90YXNzaXVtRXh0ZXJpb3JDb25jZW50cmF0aW9uKCk7XHJcbiAgICB0aGlzLnBvdGFzc2l1bUludGVyaW9yQ29uY2VudHJhdGlvbiA9IG5ldXJvbk1vZGVsLmdldFBvdGFzc2l1bUludGVyaW9yQ29uY2VudHJhdGlvbigpO1xyXG5cclxuICAgIC8vIHVzZSBjLXN0eWxlIGxvb3BzIGJlbG93IGZvciBiZXR0ZXIgcGVyZm9ybWFuY2VcclxuXHJcbiAgICBsZXQgaTtcclxuICAgIHRoaXMubWVtYnJhbmVDaGFubmVsU3RhdGVNYXAgPSBtYXAoKTtcclxuICAgIGZvciAoIGkgPSAwOyBpIDwgbmV1cm9uTW9kZWwubWVtYnJhbmVDaGFubmVscy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgbWVtYnJhbmVDaGFubmVsID0gbmV1cm9uTW9kZWwubWVtYnJhbmVDaGFubmVscy5nZXQoIGkgKTtcclxuICAgICAgdGhpcy5tZW1icmFuZUNoYW5uZWxTdGF0ZU1hcC5wdXQoIG1lbWJyYW5lQ2hhbm5lbCwgbWVtYnJhbmVDaGFubmVsLmdldFN0YXRlKCkgKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnBhcnRpY2xlUGxheWJhY2tNZW1lbnRvcyA9IFtdO1xyXG5cclxuICAgIGZvciAoIGkgPSAwOyBpIDwgbmV1cm9uTW9kZWwudHJhbnNpZW50UGFydGljbGVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBjb25zdCB0cmFuc2llbnRQYXJ0aWNsZSA9IG5ldXJvbk1vZGVsLnRyYW5zaWVudFBhcnRpY2xlcy5nZXQoIGkgKTtcclxuICAgICAgdGhpcy5wYXJ0aWNsZVBsYXliYWNrTWVtZW50b3MucHVzaCggdHJhbnNpZW50UGFydGljbGUuZ2V0UGxheWJhY2tNZW1lbnRvKCkgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBnZXRBeG9uTWVtYnJhbmVTdGF0ZSgpIHtcclxuICAgIHJldHVybiB0aGlzLmF4b25NZW1icmFuZVN0YXRlO1xyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIGdldEhvZGdraW5IdXhsZXlNb2RlbFN0YXRlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaG9kZ2tpbkh1eGxleU1vZGVsU3RhdGU7XHJcbiAgfVxyXG5cclxuICAvLyBAcHVibGljXHJcbiAgZ2V0TWVtYnJhbmVDaGFubmVsU3RhdGVNYXAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5tZW1icmFuZUNoYW5uZWxTdGF0ZU1hcDtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBnZXRQbGF5YmFja1BhcnRpY2xlTWVtZW50b3MoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZVBsYXliYWNrTWVtZW50b3M7XHJcbiAgfVxyXG5cclxuICAvLyBAcHVibGljXHJcbiAgZ2V0TWVtYnJhbmVQb3RlbnRpYWwoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5tZW1icmFuZVBvdGVudGlhbDtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBnZXRTb2RpdW1JbnRlcmlvckNvbmNlbnRyYXRpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zb2RpdW1JbnRlcmlvckNvbmNlbnRyYXRpb247XHJcbiAgfVxyXG5cclxuICAvLyBAcHVibGljXHJcbiAgZ2V0U29kaXVtRXh0ZXJpb3JDb25jZW50cmF0aW9uKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuc29kaXVtRXh0ZXJpb3JDb25jZW50cmF0aW9uO1xyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIGdldFBvdGFzc2l1bUludGVyaW9yQ29uY2VudHJhdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLnBvdGFzc2l1bUludGVyaW9yQ29uY2VudHJhdGlvbjtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBnZXRQb3Rhc3NpdW1FeHRlcmlvckNvbmNlbnRyYXRpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wb3Rhc3NpdW1FeHRlcmlvckNvbmNlbnRyYXRpb247XHJcbiAgfVxyXG59XHJcblxyXG5uZXVyb24ucmVnaXN0ZXIoICdOZXVyb25Nb2RlbFN0YXRlJywgTmV1cm9uTW9k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