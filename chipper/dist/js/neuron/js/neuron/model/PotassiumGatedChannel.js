// Copyright 2014-2021, University of Colorado Boulder

/**
 * A gated channel through which potassium passes when the channel is open.
 *
 * @author John Blanco
 * @author Sharfudeen Ashraf (for Ghent University)
 */

import dotRandom from '../../../../dot/js/dotRandom.js';
import neuron from '../../neuron.js';
import MathUtils from '../common/MathUtils.js';
import NeuronConstants from '../common/NeuronConstants.js';
import GatedChannel from './GatedChannel.js';
import MembraneChannelTypes from './MembraneChannelTypes.js';
import MembraneCrossingDirection from './MembraneCrossingDirection.js';
import ParticleType from './ParticleType.js';
import PieSliceShapedCaptureZone from './PieSliceShapedCaptureZone.js';

// constants
const CHANNEL_HEIGHT = NeuronConstants.MEMBRANE_THICKNESS * 1.2; // In nanometers.
const CHANNEL_WIDTH = NeuronConstants.MEMBRANE_THICKNESS * 0.50; // In nanometers.

// constants that control the rate at which this channel will capture ions when it is open.  Smaller numbers here will
// increase the capture rate and thus make the flow appear to be faster.
const MIN_INTER_CAPTURE_TIME = 0.00006; // In seconds of sim time.
const MAX_INTER_CAPTURE_TIME = 0.00025; // In seconds of sim time.

// Constant used when calculating how open this gate should be based on a value that exists within the Hodgkin-Huxley
// model.  This was empirically determined.
const N4_WHEN_FULLY_OPEN = 0.35;

// Delay range - used to make the timing of the instances of this gate vary a little bit in terms of when they open
// and close.
const MAX_STAGGER_DELAY = NeuronConstants.MIN_ACTION_POTENTIAL_CLOCK_DT * 10; // In seconds of sim time.

class PotassiumGatedChannel extends GatedChannel {
  /**
   * @param {NeuronModel} modelContainingParticles
   * @param {ModifiedHodgkinHuxleyModel} hodgkinHuxleyModel
   */
  constructor(modelContainingParticles, hodgkinHuxleyModel) {
    super(CHANNEL_WIDTH, CHANNEL_HEIGHT, modelContainingParticles);
    this.staggerDelay = dotRandom.nextDouble() * MAX_STAGGER_DELAY;
    this.hodgkinHuxleyModel = hodgkinHuxleyModel;
    this.setInteriorCaptureZone(new PieSliceShapedCaptureZone(this.getCenterPosition(), CHANNEL_WIDTH * 5, Math.PI, Math.PI * 0.5));
    this.channelColor = NeuronConstants.POTASSIUM_COLOR.colorUtilsDarker(0.2);
    this.reset();
  }

  // @public
  stepInTime(dt) {
    const prevOpenness = this.openness;
    const prevInActivationAmt = this.inactivationAmount;
    super.stepInTime(dt);

    // Update the openness factor based on the state of the HH model. This is very specific to the model and the type
    // of channel.  Note the non-linear mapping of conductance to the openness factor for the channels.  This is to
    // make the gates appear to snap open and closed more rapidly, which was requested by the IPHY folks after seeing
    // some demos.
    const normalizedConductance = Math.min(Math.abs(this.hodgkinHuxleyModel.get_delayed_n4(this.staggerDelay)) / N4_WHEN_FULLY_OPEN, 1);
    let openness = 1 - Math.pow(normalizedConductance - 1, 2);
    if (openness > 0 && openness < 1) {
      // Trim off some digits, otherwise we are continuously making tiny changes to this value due to internal
      // gyrations of the HH model.
      openness = MathUtils.round(openness, 2);
    }
    if (openness !== this.getOpenness()) {
      this.setOpenness(openness);
      if (this.isOpen() && this.getCaptureCountdownTimer() === Number.POSITIVE_INFINITY) {
        // We have just transitioned to the open state, so it is time to start capturing ions.
        this.restartCaptureCountdownTimer(true);
      }
    }
    this.notifyIfMembraneStateChanged(prevOpenness, prevInActivationAmt);
  }

  // @public, @override
  reset() {
    super.reset();
    // Set up the capture time range, which will be used to control the rate of particle capture when this gate is
    // open.
    this.setMinInterCaptureTime(MIN_INTER_CAPTURE_TIME);
    this.setMaxInterCaptureTime(MAX_INTER_CAPTURE_TIME);
  }

  // @public
  getChannelColor() {
    return this.channelColor;
  }

  // @public
  getEdgeColor() {
    return NeuronConstants.POTASSIUM_COLOR;
  }

  // @public
  getParticleTypeToCapture() {
    return ParticleType.POTASSIUM_ION;
  }

  // @public
  chooseCrossingDirection() {
    return MembraneCrossingDirection.IN_TO_OUT;
  }

  // @public
  getChannelType() {
    return MembraneChannelTypes.POTASSIUM_GATED_CHANNEL;
  }
}
neuron.register('PotassiumGatedChannel', PotassiumGatedChannel);
export default PotassiumGatedChannel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJuZXVyb24iLCJNYXRoVXRpbHMiLCJOZXVyb25Db25zdGFudHMiLCJHYXRlZENoYW5uZWwiLCJNZW1icmFuZUNoYW5uZWxUeXBlcyIsIk1lbWJyYW5lQ3Jvc3NpbmdEaXJlY3Rpb24iLCJQYXJ0aWNsZVR5cGUiLCJQaWVTbGljZVNoYXBlZENhcHR1cmVab25lIiwiQ0hBTk5FTF9IRUlHSFQiLCJNRU1CUkFORV9USElDS05FU1MiLCJDSEFOTkVMX1dJRFRIIiwiTUlOX0lOVEVSX0NBUFRVUkVfVElNRSIsIk1BWF9JTlRFUl9DQVBUVVJFX1RJTUUiLCJONF9XSEVOX0ZVTExZX09QRU4iLCJNQVhfU1RBR0dFUl9ERUxBWSIsIk1JTl9BQ1RJT05fUE9URU5USUFMX0NMT0NLX0RUIiwiUG90YXNzaXVtR2F0ZWRDaGFubmVsIiwiY29uc3RydWN0b3IiLCJtb2RlbENvbnRhaW5pbmdQYXJ0aWNsZXMiLCJob2Rna2luSHV4bGV5TW9kZWwiLCJzdGFnZ2VyRGVsYXkiLCJuZXh0RG91YmxlIiwic2V0SW50ZXJpb3JDYXB0dXJlWm9uZSIsImdldENlbnRlclBvc2l0aW9uIiwiTWF0aCIsIlBJIiwiY2hhbm5lbENvbG9yIiwiUE9UQVNTSVVNX0NPTE9SIiwiY29sb3JVdGlsc0RhcmtlciIsInJlc2V0Iiwic3RlcEluVGltZSIsImR0IiwicHJldk9wZW5uZXNzIiwib3Blbm5lc3MiLCJwcmV2SW5BY3RpdmF0aW9uQW10IiwiaW5hY3RpdmF0aW9uQW1vdW50Iiwibm9ybWFsaXplZENvbmR1Y3RhbmNlIiwibWluIiwiYWJzIiwiZ2V0X2RlbGF5ZWRfbjQiLCJwb3ciLCJyb3VuZCIsImdldE9wZW5uZXNzIiwic2V0T3Blbm5lc3MiLCJpc09wZW4iLCJnZXRDYXB0dXJlQ291bnRkb3duVGltZXIiLCJOdW1iZXIiLCJQT1NJVElWRV9JTkZJTklUWSIsInJlc3RhcnRDYXB0dXJlQ291bnRkb3duVGltZXIiLCJub3RpZnlJZk1lbWJyYW5lU3RhdGVDaGFuZ2VkIiwic2V0TWluSW50ZXJDYXB0dXJlVGltZSIsInNldE1heEludGVyQ2FwdHVyZVRpbWUiLCJnZXRDaGFubmVsQ29sb3IiLCJnZXRFZGdlQ29sb3IiLCJnZXRQYXJ0aWNsZVR5cGVUb0NhcHR1cmUiLCJQT1RBU1NJVU1fSU9OIiwiY2hvb3NlQ3Jvc3NpbmdEaXJlY3Rpb24iLCJJTl9UT19PVVQiLCJnZXRDaGFubmVsVHlwZSIsIlBPVEFTU0lVTV9HQVRFRF9DSEFOTkVMIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQb3Rhc3NpdW1HYXRlZENoYW5uZWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQSBnYXRlZCBjaGFubmVsIHRocm91Z2ggd2hpY2ggcG90YXNzaXVtIHBhc3NlcyB3aGVuIHRoZSBjaGFubmVsIGlzIG9wZW4uXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICogQGF1dGhvciBTaGFyZnVkZWVuIEFzaHJhZiAoZm9yIEdoZW50IFVuaXZlcnNpdHkpXHJcbiAqL1xyXG5cclxuaW1wb3J0IGRvdFJhbmRvbSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvZG90UmFuZG9tLmpzJztcclxuaW1wb3J0IG5ldXJvbiBmcm9tICcuLi8uLi9uZXVyb24uanMnO1xyXG5pbXBvcnQgTWF0aFV0aWxzIGZyb20gJy4uL2NvbW1vbi9NYXRoVXRpbHMuanMnO1xyXG5pbXBvcnQgTmV1cm9uQ29uc3RhbnRzIGZyb20gJy4uL2NvbW1vbi9OZXVyb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgR2F0ZWRDaGFubmVsIGZyb20gJy4vR2F0ZWRDaGFubmVsLmpzJztcclxuaW1wb3J0IE1lbWJyYW5lQ2hhbm5lbFR5cGVzIGZyb20gJy4vTWVtYnJhbmVDaGFubmVsVHlwZXMuanMnO1xyXG5pbXBvcnQgTWVtYnJhbmVDcm9zc2luZ0RpcmVjdGlvbiBmcm9tICcuL01lbWJyYW5lQ3Jvc3NpbmdEaXJlY3Rpb24uanMnO1xyXG5pbXBvcnQgUGFydGljbGVUeXBlIGZyb20gJy4vUGFydGljbGVUeXBlLmpzJztcclxuaW1wb3J0IFBpZVNsaWNlU2hhcGVkQ2FwdHVyZVpvbmUgZnJvbSAnLi9QaWVTbGljZVNoYXBlZENhcHR1cmVab25lLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBDSEFOTkVMX0hFSUdIVCA9IE5ldXJvbkNvbnN0YW50cy5NRU1CUkFORV9USElDS05FU1MgKiAxLjI7IC8vIEluIG5hbm9tZXRlcnMuXHJcbmNvbnN0IENIQU5ORUxfV0lEVEggPSBOZXVyb25Db25zdGFudHMuTUVNQlJBTkVfVEhJQ0tORVNTICogMC41MDsgLy8gSW4gbmFub21ldGVycy5cclxuXHJcbi8vIGNvbnN0YW50cyB0aGF0IGNvbnRyb2wgdGhlIHJhdGUgYXQgd2hpY2ggdGhpcyBjaGFubmVsIHdpbGwgY2FwdHVyZSBpb25zIHdoZW4gaXQgaXMgb3Blbi4gIFNtYWxsZXIgbnVtYmVycyBoZXJlIHdpbGxcclxuLy8gaW5jcmVhc2UgdGhlIGNhcHR1cmUgcmF0ZSBhbmQgdGh1cyBtYWtlIHRoZSBmbG93IGFwcGVhciB0byBiZSBmYXN0ZXIuXHJcbmNvbnN0IE1JTl9JTlRFUl9DQVBUVVJFX1RJTUUgPSAwLjAwMDA2OyAvLyBJbiBzZWNvbmRzIG9mIHNpbSB0aW1lLlxyXG5jb25zdCBNQVhfSU5URVJfQ0FQVFVSRV9USU1FID0gMC4wMDAyNTsgLy8gSW4gc2Vjb25kcyBvZiBzaW0gdGltZS5cclxuXHJcbi8vIENvbnN0YW50IHVzZWQgd2hlbiBjYWxjdWxhdGluZyBob3cgb3BlbiB0aGlzIGdhdGUgc2hvdWxkIGJlIGJhc2VkIG9uIGEgdmFsdWUgdGhhdCBleGlzdHMgd2l0aGluIHRoZSBIb2Rna2luLUh1eGxleVxyXG4vLyBtb2RlbC4gIFRoaXMgd2FzIGVtcGlyaWNhbGx5IGRldGVybWluZWQuXHJcbmNvbnN0IE40X1dIRU5fRlVMTFlfT1BFTiA9IDAuMzU7XHJcblxyXG4vLyBEZWxheSByYW5nZSAtIHVzZWQgdG8gbWFrZSB0aGUgdGltaW5nIG9mIHRoZSBpbnN0YW5jZXMgb2YgdGhpcyBnYXRlIHZhcnkgYSBsaXR0bGUgYml0IGluIHRlcm1zIG9mIHdoZW4gdGhleSBvcGVuXHJcbi8vIGFuZCBjbG9zZS5cclxuY29uc3QgTUFYX1NUQUdHRVJfREVMQVkgPSBOZXVyb25Db25zdGFudHMuTUlOX0FDVElPTl9QT1RFTlRJQUxfQ0xPQ0tfRFQgKiAxMDsgLy8gSW4gc2Vjb25kcyBvZiBzaW0gdGltZS5cclxuXHJcbmNsYXNzIFBvdGFzc2l1bUdhdGVkQ2hhbm5lbCBleHRlbmRzIEdhdGVkQ2hhbm5lbCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7TmV1cm9uTW9kZWx9IG1vZGVsQ29udGFpbmluZ1BhcnRpY2xlc1xyXG4gICAqIEBwYXJhbSB7TW9kaWZpZWRIb2Rna2luSHV4bGV5TW9kZWx9IGhvZGdraW5IdXhsZXlNb2RlbFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBtb2RlbENvbnRhaW5pbmdQYXJ0aWNsZXMsIGhvZGdraW5IdXhsZXlNb2RlbCApIHtcclxuICAgIHN1cGVyKCBDSEFOTkVMX1dJRFRILCBDSEFOTkVMX0hFSUdIVCwgbW9kZWxDb250YWluaW5nUGFydGljbGVzICk7XHJcbiAgICB0aGlzLnN0YWdnZXJEZWxheSA9IGRvdFJhbmRvbS5uZXh0RG91YmxlKCkgKiBNQVhfU1RBR0dFUl9ERUxBWTtcclxuICAgIHRoaXMuaG9kZ2tpbkh1eGxleU1vZGVsID0gaG9kZ2tpbkh1eGxleU1vZGVsO1xyXG4gICAgdGhpcy5zZXRJbnRlcmlvckNhcHR1cmVab25lKCBuZXcgUGllU2xpY2VTaGFwZWRDYXB0dXJlWm9uZSggdGhpcy5nZXRDZW50ZXJQb3NpdGlvbigpLCBDSEFOTkVMX1dJRFRIICogNSwgTWF0aC5QSSwgTWF0aC5QSSAqIDAuNSApICk7XHJcbiAgICB0aGlzLmNoYW5uZWxDb2xvciA9IE5ldXJvbkNvbnN0YW50cy5QT1RBU1NJVU1fQ09MT1IuY29sb3JVdGlsc0RhcmtlciggMC4yICk7XHJcbiAgICB0aGlzLnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICAvLyBAcHVibGljXHJcbiAgc3RlcEluVGltZSggZHQgKSB7XHJcbiAgICBjb25zdCBwcmV2T3Blbm5lc3MgPSB0aGlzLm9wZW5uZXNzO1xyXG4gICAgY29uc3QgcHJldkluQWN0aXZhdGlvbkFtdCA9IHRoaXMuaW5hY3RpdmF0aW9uQW1vdW50O1xyXG4gICAgc3VwZXIuc3RlcEluVGltZSggZHQgKTtcclxuXHJcbiAgICAvLyBVcGRhdGUgdGhlIG9wZW5uZXNzIGZhY3RvciBiYXNlZCBvbiB0aGUgc3RhdGUgb2YgdGhlIEhIIG1vZGVsLiBUaGlzIGlzIHZlcnkgc3BlY2lmaWMgdG8gdGhlIG1vZGVsIGFuZCB0aGUgdHlwZVxyXG4gICAgLy8gb2YgY2hhbm5lbC4gIE5vdGUgdGhlIG5vbi1saW5lYXIgbWFwcGluZyBvZiBjb25kdWN0YW5jZSB0byB0aGUgb3Blbm5lc3MgZmFjdG9yIGZvciB0aGUgY2hhbm5lbHMuICBUaGlzIGlzIHRvXHJcbiAgICAvLyBtYWtlIHRoZSBnYXRlcyBhcHBlYXIgdG8gc25hcCBvcGVuIGFuZCBjbG9zZWQgbW9yZSByYXBpZGx5LCB3aGljaCB3YXMgcmVxdWVzdGVkIGJ5IHRoZSBJUEhZIGZvbGtzIGFmdGVyIHNlZWluZ1xyXG4gICAgLy8gc29tZSBkZW1vcy5cclxuICAgIGNvbnN0IG5vcm1hbGl6ZWRDb25kdWN0YW5jZSA9XHJcbiAgICAgIE1hdGgubWluKCBNYXRoLmFicyggdGhpcy5ob2Rna2luSHV4bGV5TW9kZWwuZ2V0X2RlbGF5ZWRfbjQoIHRoaXMuc3RhZ2dlckRlbGF5ICkgKSAvIE40X1dIRU5fRlVMTFlfT1BFTiwgMSApO1xyXG4gICAgbGV0IG9wZW5uZXNzID0gMSAtIE1hdGgucG93KCBub3JtYWxpemVkQ29uZHVjdGFuY2UgLSAxLCAyICk7XHJcbiAgICBpZiAoIG9wZW5uZXNzID4gMCAmJiBvcGVubmVzcyA8IDEgKSB7XHJcbiAgICAgIC8vIFRyaW0gb2ZmIHNvbWUgZGlnaXRzLCBvdGhlcndpc2Ugd2UgYXJlIGNvbnRpbnVvdXNseSBtYWtpbmcgdGlueSBjaGFuZ2VzIHRvIHRoaXMgdmFsdWUgZHVlIHRvIGludGVybmFsXHJcbiAgICAgIC8vIGd5cmF0aW9ucyBvZiB0aGUgSEggbW9kZWwuXHJcbiAgICAgIG9wZW5uZXNzID0gTWF0aFV0aWxzLnJvdW5kKCBvcGVubmVzcywgMiApO1xyXG4gICAgfVxyXG4gICAgaWYgKCBvcGVubmVzcyAhPT0gdGhpcy5nZXRPcGVubmVzcygpICkge1xyXG4gICAgICB0aGlzLnNldE9wZW5uZXNzKCBvcGVubmVzcyApO1xyXG4gICAgICBpZiAoIHRoaXMuaXNPcGVuKCkgJiYgdGhpcy5nZXRDYXB0dXJlQ291bnRkb3duVGltZXIoKSA9PT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZICkge1xyXG4gICAgICAgIC8vIFdlIGhhdmUganVzdCB0cmFuc2l0aW9uZWQgdG8gdGhlIG9wZW4gc3RhdGUsIHNvIGl0IGlzIHRpbWUgdG8gc3RhcnQgY2FwdHVyaW5nIGlvbnMuXHJcbiAgICAgICAgdGhpcy5yZXN0YXJ0Q2FwdHVyZUNvdW50ZG93blRpbWVyKCB0cnVlICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm5vdGlmeUlmTWVtYnJhbmVTdGF0ZUNoYW5nZWQoIHByZXZPcGVubmVzcywgcHJldkluQWN0aXZhdGlvbkFtdCApO1xyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpYywgQG92ZXJyaWRlXHJcbiAgcmVzZXQoKSB7XHJcbiAgICBzdXBlci5yZXNldCgpO1xyXG4gICAgLy8gU2V0IHVwIHRoZSBjYXB0dXJlIHRpbWUgcmFuZ2UsIHdoaWNoIHdpbGwgYmUgdXNlZCB0byBjb250cm9sIHRoZSByYXRlIG9mIHBhcnRpY2xlIGNhcHR1cmUgd2hlbiB0aGlzIGdhdGUgaXNcclxuICAgIC8vIG9wZW4uXHJcbiAgICB0aGlzLnNldE1pbkludGVyQ2FwdHVyZVRpbWUoIE1JTl9JTlRFUl9DQVBUVVJFX1RJTUUgKTtcclxuICAgIHRoaXMuc2V0TWF4SW50ZXJDYXB0dXJlVGltZSggTUFYX0lOVEVSX0NBUFRVUkVfVElNRSApO1xyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIGdldENoYW5uZWxDb2xvcigpIHtcclxuICAgIHJldHVybiB0aGlzLmNoYW5uZWxDb2xvcjtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBnZXRFZGdlQ29sb3IoKSB7XHJcbiAgICByZXR1cm4gTmV1cm9uQ29uc3RhbnRzLlBPVEFTU0lVTV9DT0xPUjtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBnZXRQYXJ0aWNsZVR5cGVUb0NhcHR1cmUoKSB7XHJcbiAgICByZXR1cm4gUGFydGljbGVUeXBlLlBPVEFTU0lVTV9JT047XHJcbiAgfVxyXG5cclxuICAvLyBAcHVibGljXHJcbiAgY2hvb3NlQ3Jvc3NpbmdEaXJlY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gTWVtYnJhbmVDcm9zc2luZ0RpcmVjdGlvbi5JTl9UT19PVVQ7XHJcbiAgfVxyXG5cclxuICAvLyBAcHVibGljXHJcbiAgZ2V0Q2hhbm5lbFR5cGUoKSB7XHJcbiAgICByZXR1cm4gTWVtYnJhbmVDaGFubmVsVHlwZXMuUE9UQVNTSVVNX0dBVEVEX0NIQU5ORUw7XHJcbiAgfVxyXG59XHJcblxyXG5uZXVyb24ucmVnaXN0ZXIoICdQb3Rhc3NpdW1HYXRlZENoYW5uZWwnLCBQb3Rhc3NpdW1HYXRlZENoYW5uZWwgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFBvdGFzc2l1bUdhdGVkQ2hhbm5lbDtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsU0FBUyxNQUFNLGlDQUFpQztBQUN2RCxPQUFPQyxNQUFNLE1BQU0saUJBQWlCO0FBQ3BDLE9BQU9DLFNBQVMsTUFBTSx3QkFBd0I7QUFDOUMsT0FBT0MsZUFBZSxNQUFNLDhCQUE4QjtBQUMxRCxPQUFPQyxZQUFZLE1BQU0sbUJB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