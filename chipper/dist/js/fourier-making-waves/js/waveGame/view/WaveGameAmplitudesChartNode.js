// Copyright 2021-2023, University of Colorado Boulder

/**
 * WaveGameAmplitudesChartNode is a specialization of InteractiveAmplitudesChartNode that allows the client to
 * show and hide the amplitude controls for each harmonic.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import dotRandom from '../../../../dot/js/dotRandom.js';
import merge from '../../../../phet-core/js/merge.js';
import AssertUtils from '../../../../phetcommon/js/AssertUtils.js';
import FMWConstants from '../../common/FMWConstants.js';
import InteractiveAmplitudesChartNode from '../../common/view/InteractiveAmplitudesChartNode.js';
import fourierMakingWaves from '../../fourierMakingWaves.js';
import WaveGameAmplitudesChart from '../model/WaveGameAmplitudesChart.js';
export default class WaveGameAmplitudesChartNode extends InteractiveAmplitudesChartNode {
  /**
   * @param {WaveGameAmplitudesChart} amplitudesChart
   * @param {AmplitudeKeypadDialog} amplitudeKeypadDialog - keypad for editing amplitude values
   * @param {Object} [options]
   */
  constructor(amplitudesChart, amplitudeKeypadDialog, options) {
    assert && assert(amplitudesChart instanceof WaveGameAmplitudesChart);
    options = merge({
      // For the Wave Game, we make it easier to match the pink waveform by using a larger interval and fewer
      // decimals places for the amplitude sliders and keypad.
      // See https://github.com/phetsims/fourier-making-waves/issues/97
      amplitudeSliderOptions: {
        mouseTouchStep: FMWConstants.WAVE_GAME_AMPLITUDE_STEP,
        keyboardStep: FMWConstants.WAVE_GAME_AMPLITUDE_KEYBOARD_STEP,
        shiftKeyboardStep: FMWConstants.WAVE_GAME_AMPLITUDE_SHIFT_KEYBOARD_STEP,
        pageKeyboardStep: FMWConstants.WAVE_GAME_AMPLITUDE_PAGE_KEYBOARD_STEP
      },
      amplitudeNumberDisplayOptions: {
        numberDisplayOptions: {
          decimalPlaces: FMWConstants.WAVE_GAME_AMPLITUDE_DECIMAL_PLACES
        }
      }
    }, options);
    super(amplitudesChart, amplitudeKeypadDialog, options);

    // Fields of interest in amplitudesChart
    const answerSeries = amplitudesChart.answerSeries;
    const guessSeries = amplitudesChart.guessSeries;
    const numberOfAmplitudeControlsProperty = amplitudesChart.numberOfAmplitudeControlsProperty;

    // @private
    this.amplitudeKeypadDialog = amplitudeKeypadDialog;

    // {Harmonic[]} harmonics with non-zero amplitude are first, followed by randomly-ordered harmonics with
    // zero amplitude. This makes amplitude controls appear and disappear in the same order as
    // numberOfAmplitudeControlsProperty changes.  If numberOfAmplitudeControlsProperty.value is N, then
    // the first N harmonics in this array will have their amplitude control made visible.
    let harmonics;

    // Update the visibility of amplitude controls.
    const updateAmplitudeControlsVisibility = numberOfAmplitudeControls => {
      for (let i = 0; i < harmonics.length; i++) {
        const harmonic = harmonics[i];
        const visible = i < numberOfAmplitudeControls;
        this.setAmplitudeVisible(harmonic.order, visible);

        // If a harmonic's slider is not visible, its amplitude must be zero in the guess.
        if (!visible) {
          guessSeries.harmonics[harmonic.order - 1].amplitudeProperty.value = 0;
        }
      }
    };

    // When the challenge changes, adjust visibility of amplitude controls. A challenge changes by calling
    // FourierSeries.setAmplitudes, and setAmplitudes defers notification of listeners until all harmonic
    // amplitudes are changed. So we can rely on this listener being called once when a challenge changes.
    answerSeries.amplitudesProperty.link(answerAmplitudes => {
      const nonZeroHarmonics = answerSeries.getNonZeroHarmonics();
      const zeroHarmonics = answerSeries.getZeroHarmonics();
      harmonics = [...nonZeroHarmonics, ...dotRandom.shuffle(zeroHarmonics)];
      updateAmplitudeControlsVisibility(numberOfAmplitudeControlsProperty.value);
    });

    // Adjust number of amplitude controls that are visible.
    numberOfAmplitudeControlsProperty.lazyLink(updateAmplitudeControlsVisibility);
  }

  /**
   * Sets the visibility of an amplitude slider and its associated NumberDisplay.
   * @param {number} order - order of the harmonic associated with the amplitude
   * @param {boolean} visible
   * @public
   */
  setAmplitudeVisible(order, visible) {
    assert && AssertUtils.assertPositiveNumber(order);
    assert && assert(order <= this.sliders.length, `invalid order: ${order}`);
    assert && assert(typeof visible === 'boolean');
    const index = order - 1;

    // Slider
    const slider = this.sliders[index];
    slider.interruptSubtreeInput();
    slider.visible = visible;

    // NumberDisplay
    const numberDisplay = this.numberDisplays[index];
    numberDisplay.interruptSubtreeInput();
    numberDisplay.visible = visible;

    // If the keypad associated with the NumberDisplay is visible, hide it.
    if (this.amplitudeKeypadDialog.isShowingProperty.value && this.amplitudeKeypadDialog.order === order) {
      this.amplitudeKeypadDialog.hide();
    }
  }
}
fourierMakingWaves.register('WaveGameAmplitudesChartNode', WaveGameAmplitudesChartNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJtZXJnZSIsIkFzc2VydFV0aWxzIiwiRk1XQ29uc3RhbnRzIiwiSW50ZXJhY3RpdmVBbXBsaXR1ZGVzQ2hhcnROb2RlIiwiZm91cmllck1ha2luZ1dhdmVzIiwiV2F2ZUdhbWVBbXBsaXR1ZGVzQ2hhcnQiLCJXYXZlR2FtZUFtcGxpdHVkZXNDaGFydE5vZGUiLCJjb25zdHJ1Y3RvciIsImFtcGxpdHVkZXNDaGFydCIsImFtcGxpdHVkZUtleXBhZERpYWxvZyIsIm9wdGlvbnMiLCJhc3NlcnQiLCJhbXBsaXR1ZGVTbGlkZXJPcHRpb25zIiwibW91c2VUb3VjaFN0ZXAiLCJXQVZFX0dBTUVfQU1QTElUVURFX1NURVAiLCJrZXlib2FyZFN0ZXAiLCJXQVZFX0dBTUVfQU1QTElUVURFX0tFWUJPQVJEX1NURVAiLCJzaGlmdEtleWJvYXJkU3RlcCIsIldBVkVfR0FNRV9BTVBMSVRVREVfU0hJRlRfS0VZQk9BUkRfU1RFUCIsInBhZ2VLZXlib2FyZFN0ZXAiLCJXQVZFX0dBTUVfQU1QTElUVURFX1BBR0VfS0VZQk9BUkRfU1RFUCIsImFtcGxpdHVkZU51bWJlckRpc3BsYXlPcHRpb25zIiwibnVtYmVyRGlzcGxheU9wdGlvbnMiLCJkZWNpbWFsUGxhY2VzIiwiV0FWRV9HQU1FX0FNUExJVFVERV9ERUNJTUFMX1BMQUNFUyIsImFuc3dlclNlcmllcyIsImd1ZXNzU2VyaWVzIiwibnVtYmVyT2ZBbXBsaXR1ZGVDb250cm9sc1Byb3BlcnR5IiwiaGFybW9uaWNzIiwidXBkYXRlQW1wbGl0dWRlQ29udHJvbHNWaXNpYmlsaXR5IiwibnVtYmVyT2ZBbXBsaXR1ZGVDb250cm9scyIsImkiLCJsZW5ndGgiLCJoYXJtb25pYyIsInZpc2libGUiLCJzZXRBbXBsaXR1ZGVWaXNpYmxlIiwib3JkZXIiLCJhbXBsaXR1ZGVQcm9wZXJ0eSIsInZhbHVlIiwiYW1wbGl0dWRlc1Byb3BlcnR5IiwibGluayIsImFuc3dlckFtcGxpdHVkZXMiLCJub25aZXJvSGFybW9uaWNzIiwiZ2V0Tm9uWmVyb0hhcm1vbmljcyIsInplcm9IYXJtb25pY3MiLCJnZXRaZXJvSGFybW9uaWNzIiwic2h1ZmZsZSIsImxhenlMaW5rIiwiYXNzZXJ0UG9zaXRpdmVOdW1iZXIiLCJzbGlkZXJzIiwiaW5kZXgiLCJzbGlkZXIiLCJpbnRlcnJ1cHRTdWJ0cmVlSW5wdXQiLCJudW1iZXJEaXNwbGF5IiwibnVtYmVyRGlzcGxheXMiLCJpc1Nob3dpbmdQcm9wZXJ0eSIsImhpZGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIldhdmVHYW1lQW1wbGl0dWRlc0NoYXJ0Tm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBXYXZlR2FtZUFtcGxpdHVkZXNDaGFydE5vZGUgaXMgYSBzcGVjaWFsaXphdGlvbiBvZiBJbnRlcmFjdGl2ZUFtcGxpdHVkZXNDaGFydE5vZGUgdGhhdCBhbGxvd3MgdGhlIGNsaWVudCB0b1xyXG4gKiBzaG93IGFuZCBoaWRlIHRoZSBhbXBsaXR1ZGUgY29udHJvbHMgZm9yIGVhY2ggaGFybW9uaWMuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IGRvdFJhbmRvbSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvZG90UmFuZG9tLmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBBc3NlcnRVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL0Fzc2VydFV0aWxzLmpzJztcclxuaW1wb3J0IEZNV0NvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vRk1XQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEludGVyYWN0aXZlQW1wbGl0dWRlc0NoYXJ0Tm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9JbnRlcmFjdGl2ZUFtcGxpdHVkZXNDaGFydE5vZGUuanMnO1xyXG5pbXBvcnQgZm91cmllck1ha2luZ1dhdmVzIGZyb20gJy4uLy4uL2ZvdXJpZXJNYWtpbmdXYXZlcy5qcyc7XHJcbmltcG9ydCBXYXZlR2FtZUFtcGxpdHVkZXNDaGFydCBmcm9tICcuLi9tb2RlbC9XYXZlR2FtZUFtcGxpdHVkZXNDaGFydC5qcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXYXZlR2FtZUFtcGxpdHVkZXNDaGFydE5vZGUgZXh0ZW5kcyBJbnRlcmFjdGl2ZUFtcGxpdHVkZXNDaGFydE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1dhdmVHYW1lQW1wbGl0dWRlc0NoYXJ0fSBhbXBsaXR1ZGVzQ2hhcnRcclxuICAgKiBAcGFyYW0ge0FtcGxpdHVkZUtleXBhZERpYWxvZ30gYW1wbGl0dWRlS2V5cGFkRGlhbG9nIC0ga2V5cGFkIGZvciBlZGl0aW5nIGFtcGxpdHVkZSB2YWx1ZXNcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGFtcGxpdHVkZXNDaGFydCwgYW1wbGl0dWRlS2V5cGFkRGlhbG9nLCBvcHRpb25zICkge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggYW1wbGl0dWRlc0NoYXJ0IGluc3RhbmNlb2YgV2F2ZUdhbWVBbXBsaXR1ZGVzQ2hhcnQgKTtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuXHJcbiAgICAgIC8vIEZvciB0aGUgV2F2ZSBHYW1lLCB3ZSBtYWtlIGl0IGVhc2llciB0byBtYXRjaCB0aGUgcGluayB3YXZlZm9ybSBieSB1c2luZyBhIGxhcmdlciBpbnRlcnZhbCBhbmQgZmV3ZXJcclxuICAgICAgLy8gZGVjaW1hbHMgcGxhY2VzIGZvciB0aGUgYW1wbGl0dWRlIHNsaWRlcnMgYW5kIGtleXBhZC5cclxuICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9mb3VyaWVyLW1ha2luZy13YXZlcy9pc3N1ZXMvOTdcclxuICAgICAgYW1wbGl0dWRlU2xpZGVyT3B0aW9uczoge1xyXG4gICAgICAgIG1vdXNlVG91Y2hTdGVwOiBGTVdDb25zdGFudHMuV0FWRV9HQU1FX0FNUExJVFVERV9TVEVQLFxyXG4gICAgICAgIGtleWJvYXJkU3RlcDogRk1XQ29uc3RhbnRzLldBVkVfR0FNRV9BTVBMSVRVREVfS0VZQk9BUkRfU1RFUCxcclxuICAgICAgICBzaGlmdEtleWJvYXJkU3RlcDogRk1XQ29uc3RhbnRzLldBVkVfR0FNRV9BTVBMSVRVREVfU0hJRlRfS0VZQk9BUkRfU1RFUCxcclxuICAgICAgICBwYWdlS2V5Ym9hcmRTdGVwOiBGTVdDb25zdGFudHMuV0FWRV9HQU1FX0FNUExJVFVERV9QQUdFX0tFWUJPQVJEX1NURVBcclxuICAgICAgfSxcclxuICAgICAgYW1wbGl0dWRlTnVtYmVyRGlzcGxheU9wdGlvbnM6IHtcclxuICAgICAgICBudW1iZXJEaXNwbGF5T3B0aW9uczoge1xyXG4gICAgICAgICAgZGVjaW1hbFBsYWNlczogRk1XQ29uc3RhbnRzLldBVkVfR0FNRV9BTVBMSVRVREVfREVDSU1BTF9QTEFDRVNcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggYW1wbGl0dWRlc0NoYXJ0LCBhbXBsaXR1ZGVLZXlwYWREaWFsb2csIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBGaWVsZHMgb2YgaW50ZXJlc3QgaW4gYW1wbGl0dWRlc0NoYXJ0XHJcbiAgICBjb25zdCBhbnN3ZXJTZXJpZXMgPSBhbXBsaXR1ZGVzQ2hhcnQuYW5zd2VyU2VyaWVzO1xyXG4gICAgY29uc3QgZ3Vlc3NTZXJpZXMgPSBhbXBsaXR1ZGVzQ2hhcnQuZ3Vlc3NTZXJpZXM7XHJcbiAgICBjb25zdCBudW1iZXJPZkFtcGxpdHVkZUNvbnRyb2xzUHJvcGVydHkgPSBhbXBsaXR1ZGVzQ2hhcnQubnVtYmVyT2ZBbXBsaXR1ZGVDb250cm9sc1Byb3BlcnR5O1xyXG5cclxuICAgIC8vIEBwcml2YXRlXHJcbiAgICB0aGlzLmFtcGxpdHVkZUtleXBhZERpYWxvZyA9IGFtcGxpdHVkZUtleXBhZERpYWxvZztcclxuXHJcbiAgICAvLyB7SGFybW9uaWNbXX0gaGFybW9uaWNzIHdpdGggbm9uLXplcm8gYW1wbGl0dWRlIGFyZSBmaXJzdCwgZm9sbG93ZWQgYnkgcmFuZG9tbHktb3JkZXJlZCBoYXJtb25pY3Mgd2l0aFxyXG4gICAgLy8gemVybyBhbXBsaXR1ZGUuIFRoaXMgbWFrZXMgYW1wbGl0dWRlIGNvbnRyb2xzIGFwcGVhciBhbmQgZGlzYXBwZWFyIGluIHRoZSBzYW1lIG9yZGVyIGFzXHJcbiAgICAvLyBudW1iZXJPZkFtcGxpdHVkZUNvbnRyb2xzUHJvcGVydHkgY2hhbmdlcy4gIElmIG51bWJlck9mQW1wbGl0dWRlQ29udHJvbHNQcm9wZXJ0eS52YWx1ZSBpcyBOLCB0aGVuXHJcbiAgICAvLyB0aGUgZmlyc3QgTiBoYXJtb25pY3MgaW4gdGhpcyBhcnJheSB3aWxsIGhhdmUgdGhlaXIgYW1wbGl0dWRlIGNvbnRyb2wgbWFkZSB2aXNpYmxlLlxyXG4gICAgbGV0IGhhcm1vbmljcztcclxuXHJcbiAgICAvLyBVcGRhdGUgdGhlIHZpc2liaWxpdHkgb2YgYW1wbGl0dWRlIGNvbnRyb2xzLlxyXG4gICAgY29uc3QgdXBkYXRlQW1wbGl0dWRlQ29udHJvbHNWaXNpYmlsaXR5ID0gbnVtYmVyT2ZBbXBsaXR1ZGVDb250cm9scyA9PiB7XHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGhhcm1vbmljcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICBjb25zdCBoYXJtb25pYyA9IGhhcm1vbmljc1sgaSBdO1xyXG4gICAgICAgIGNvbnN0IHZpc2libGUgPSAoIGkgPCBudW1iZXJPZkFtcGxpdHVkZUNvbnRyb2xzICk7XHJcbiAgICAgICAgdGhpcy5zZXRBbXBsaXR1ZGVWaXNpYmxlKCBoYXJtb25pYy5vcmRlciwgdmlzaWJsZSApO1xyXG5cclxuICAgICAgICAvLyBJZiBhIGhhcm1vbmljJ3Mgc2xpZGVyIGlzIG5vdCB2aXNpYmxlLCBpdHMgYW1wbGl0dWRlIG11c3QgYmUgemVybyBpbiB0aGUgZ3Vlc3MuXHJcbiAgICAgICAgaWYgKCAhdmlzaWJsZSApIHtcclxuICAgICAgICAgIGd1ZXNzU2VyaWVzLmhhcm1vbmljc1sgaGFybW9uaWMub3JkZXIgLSAxIF0uYW1wbGl0dWRlUHJvcGVydHkudmFsdWUgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBXaGVuIHRoZSBjaGFsbGVuZ2UgY2hhbmdlcywgYWRqdXN0IHZpc2liaWxpdHkgb2YgYW1wbGl0dWRlIGNvbnRyb2xzLiBBIGNoYWxsZW5nZSBjaGFuZ2VzIGJ5IGNhbGxpbmdcclxuICAgIC8vIEZvdXJpZXJTZXJpZXMuc2V0QW1wbGl0dWRlcywgYW5kIHNldEFtcGxpdHVkZXMgZGVmZXJzIG5vdGlmaWNhdGlvbiBvZiBsaXN0ZW5lcnMgdW50aWwgYWxsIGhhcm1vbmljXHJcbiAgICAvLyBhbXBsaXR1ZGVzIGFyZSBjaGFuZ2VkLiBTbyB3ZSBjYW4gcmVseSBvbiB0aGlzIGxpc3RlbmVyIGJlaW5nIGNhbGxlZCBvbmNlIHdoZW4gYSBjaGFsbGVuZ2UgY2hhbmdlcy5cclxuICAgIGFuc3dlclNlcmllcy5hbXBsaXR1ZGVzUHJvcGVydHkubGluayggYW5zd2VyQW1wbGl0dWRlcyA9PiB7XHJcbiAgICAgIGNvbnN0IG5vblplcm9IYXJtb25pY3MgPSBhbnN3ZXJTZXJpZXMuZ2V0Tm9uWmVyb0hhcm1vbmljcygpO1xyXG4gICAgICBjb25zdCB6ZXJvSGFybW9uaWNzID0gYW5zd2VyU2VyaWVzLmdldFplcm9IYXJtb25pY3MoKTtcclxuICAgICAgaGFybW9uaWNzID0gWyAuLi5ub25aZXJvSGFybW9uaWNzLCAuLi5kb3RSYW5kb20uc2h1ZmZsZSggemVyb0hhcm1vbmljcyApIF07XHJcbiAgICAgIHVwZGF0ZUFtcGxpdHVkZUNvbnRyb2xzVmlzaWJpbGl0eSggbnVtYmVyT2ZBbXBsaXR1ZGVDb250cm9sc1Byb3BlcnR5LnZhbHVlICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQWRqdXN0IG51bWJlciBvZiBhbXBsaXR1ZGUgY29udHJvbHMgdGhhdCBhcmUgdmlzaWJsZS5cclxuICAgIG51bWJlck9mQW1wbGl0dWRlQ29udHJvbHNQcm9wZXJ0eS5sYXp5TGluayggdXBkYXRlQW1wbGl0dWRlQ29udHJvbHNWaXNpYmlsaXR5ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSB2aXNpYmlsaXR5IG9mIGFuIGFtcGxpdHVkZSBzbGlkZXIgYW5kIGl0cyBhc3NvY2lhdGVkIE51bWJlckRpc3BsYXkuXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IG9yZGVyIC0gb3JkZXIgb2YgdGhlIGhhcm1vbmljIGFzc29jaWF0ZWQgd2l0aCB0aGUgYW1wbGl0dWRlXHJcbiAgICogQHBhcmFtIHtib29sZWFufSB2aXNpYmxlXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHNldEFtcGxpdHVkZVZpc2libGUoIG9yZGVyLCB2aXNpYmxlICkge1xyXG4gICAgYXNzZXJ0ICYmIEFzc2VydFV0aWxzLmFzc2VydFBvc2l0aXZlTnVtYmVyKCBvcmRlciApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3JkZXIgPD0gdGhpcy5zbGlkZXJzLmxlbmd0aCwgYGludmFsaWQgb3JkZXI6ICR7b3JkZXJ9YCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdHlwZW9mIHZpc2libGUgPT09ICdib29sZWFuJyApO1xyXG5cclxuICAgIGNvbnN0IGluZGV4ID0gb3JkZXIgLSAxO1xyXG5cclxuICAgIC8vIFNsaWRlclxyXG4gICAgY29uc3Qgc2xpZGVyID0gdGhpcy5zbGlkZXJzWyBpbmRleCBdO1xyXG4gICAgc2xpZGVyLmludGVycnVwdFN1YnRyZWVJbnB1dCgpO1xyXG4gICAgc2xpZGVyLnZpc2libGUgPSB2aXNpYmxlO1xyXG5cclxuICAgIC8vIE51bWJlckRpc3BsYXlcclxuICAgIGNvbnN0IG51bWJlckRpc3BsYXkgPSB0aGlzLm51bWJlckRpc3BsYXlzWyBpbmRleCBdO1xyXG4gICAgbnVtYmVyRGlzcGxheS5pbnRlcnJ1cHRTdWJ0cmVlSW5wdXQoKTtcclxuICAgIG51bWJlckRpc3BsYXkudmlzaWJsZSA9IHZpc2libGU7XHJcblxyXG4gICAgLy8gSWYgdGhlIGtleXBhZCBhc3NvY2lhdGVkIHdpdGggdGhlIE51bWJlckRpc3BsYXkgaXMgdmlzaWJsZSwgaGlkZSBpdC5cclxuICAgIGlmICggdGhpcy5hbXBsaXR1ZGVLZXlwYWREaWFsb2cuaXNTaG93aW5nUHJvcGVydHkudmFsdWUgJiYgdGhpcy5hbXBsaXR1ZGVLZXlwYWREaWFsb2cub3JkZXIgPT09IG9yZGVyICkge1xyXG4gICAgICB0aGlzLmFtcGxpdHVkZUtleXBhZERpYWxvZy5oaWRlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mb3VyaWVyTWFraW5nV2F2ZXMucmVnaXN0ZXIoICdXYXZlR2FtZUFtcGxpdHVkZXNDaGFydE5vZGUnLCBXYXZlR2FtZUFtcGxpdHVkZXNDaGFydE5vZGUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxTQUFTLE1BQU0saUNBQWlDO0FBQ3ZELE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsV0FBVyxNQUFNLDBDQUEwQztBQUNsRSxPQUFPQyxZQUFZLE1BQU0sOEJBQThCO0FBQ3ZELE9BQU9DLDhCQUE4QixNQUFNLHFEQUFxRDtBQUNoRyxPQUFPQyxrQkFBa0IsTUFBTSw2QkFBNkI7QUFDNUQsT0FBT0MsdUJBQXVCLE1BQU0scUNBQXFDO0FBRXpFLGVBQWUsTUFBTUMsMkJBQTJCLFNBQVNILDhCQUE4QixDQUFDO0VBRXRGO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRUksV0FBV0EsQ0FBRUMsZUFBZSxFQUFFQyxxQkFBcUIsRUFBRUMsT0FBTyxF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