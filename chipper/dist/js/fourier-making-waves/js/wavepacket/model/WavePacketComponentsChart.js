// Copyright 2021-2023, University of Colorado Boulder

/**
 * WavePacketComponentsChart is the model for the 'Fourier Components' chart in the 'Wave Packet' screen.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import FMWConstants from '../../common/FMWConstants.js';
import DomainChart from '../../common/model/DomainChart.js';
import Harmonic from '../../common/model/Harmonic.js';
import fourierMakingWaves from '../../fourierMakingWaves.js';
// We could use different numbers of points for different Fourier components, because lower-order components have a
// longer period, and therefore require fewer points to make them look smooth. But computing the same number of points
// for all components makes it easier and more efficient to compute the Sum of those components in the Wave Packet screen.
const POINTS_PER_DATA_SET = FMWConstants.MAX_POINTS_PER_DATA_SET;
const EMPTY_DATA_SET = FMWConstants.EMPTY_DATA_SET;
export default class WavePacketComponentsChart extends DomainChart {
  // A data set for each Fourier component's waveform, EMPTY_DATA_SET when the number of components is infinite.
  // Ordered by increasing order of Fourier component, i.e. the fundamental component has index=0.
  // This is loosely based on the update method in D2CComponentsView.java.

  constructor(wavePacket, domainProperty, seriesTypeProperty, xAxisDescriptionProperty, tandem) {
    super(domainProperty, xAxisDescriptionProperty, wavePacket.L, wavePacket.T, tandem);
    this.componentDataSetsProperty = new DerivedProperty([wavePacket.componentsProperty, domainProperty, seriesTypeProperty, xAxisDescriptionProperty], (components, domain, seriesType, xAxisDescription) => {
      let dataSets = EMPTY_DATA_SET;
      if (components.length > 0) {
        dataSets = WavePacketComponentsChart.createComponentsDataSets(components, wavePacket.componentSpacingProperty.value, domain, seriesType, xAxisDescription.range);
      }
      return dataSets;
    });

    // NOTE: This chart does not have a peakAmplitudeProperty because its more efficient for the view to determine
    // the y-axis range while iterating over componentDataSetsProperty.
  }

  /**
   * Creates data sets for the waveforms that correspond to a set of Fourier components.
   */
  static createComponentsDataSets(components, componentSpacing, domain, seriesType, xRange) {
    assert && assert(components.length > 0 && componentSpacing >= 0);
    const dataSets = [];
    const L = 2 * Math.PI / componentSpacing;
    const T = L; // because the WavePacket model is independent of Domain, and assumes that L === T
    const t = 0; // there is no animation in this screen, so time is always 0

    for (let order = 1; order <= components.length; order++) {
      const amplitude = components[order - 1].amplitude;
      dataSets.push(Harmonic.createDataSetStatic(order, amplitude, POINTS_PER_DATA_SET, L, T, xRange, domain, seriesType, t));
    }
    return dataSets;
  }
}
fourierMakingWaves.register('WavePacketComponentsChart', WavePacketComponentsChart);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJGTVdDb25zdGFudHMiLCJEb21haW5DaGFydCIsIkhhcm1vbmljIiwiZm91cmllck1ha2luZ1dhdmVzIiwiUE9JTlRTX1BFUl9EQVRBX1NFVCIsIk1BWF9QT0lOVFNfUEVSX0RBVEFfU0VUIiwiRU1QVFlfREFUQV9TRVQiLCJXYXZlUGFja2V0Q29tcG9uZW50c0NoYXJ0IiwiY29uc3RydWN0b3IiLCJ3YXZlUGFja2V0IiwiZG9tYWluUHJvcGVydHkiLCJzZXJpZXNUeXBlUHJvcGVydHkiLCJ4QXhpc0Rlc2NyaXB0aW9uUHJvcGVydHkiLCJ0YW5kZW0iLCJMIiwiVCIsImNvbXBvbmVudERhdGFTZXRzUHJvcGVydHkiLCJjb21wb25lbnRzUHJvcGVydHkiLCJjb21wb25lbnRzIiwiZG9tYWluIiwic2VyaWVzVHlwZSIsInhBeGlzRGVzY3JpcHRpb24iLCJkYXRhU2V0cyIsImxlbmd0aCIsImNyZWF0ZUNvbXBvbmVudHNEYXRhU2V0cyIsImNvbXBvbmVudFNwYWNpbmdQcm9wZXJ0eSIsInZhbHVlIiwicmFuZ2UiLCJjb21wb25lbnRTcGFjaW5nIiwieFJhbmdlIiwiYXNzZXJ0IiwiTWF0aCIsIlBJIiwidCIsIm9yZGVyIiwiYW1wbGl0dWRlIiwicHVzaCIsImNyZWF0ZURhdGFTZXRTdGF0aWMiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIldhdmVQYWNrZXRDb21wb25lbnRzQ2hhcnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjEtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogV2F2ZVBhY2tldENvbXBvbmVudHNDaGFydCBpcyB0aGUgbW9kZWwgZm9yIHRoZSAnRm91cmllciBDb21wb25lbnRzJyBjaGFydCBpbiB0aGUgJ1dhdmUgUGFja2V0JyBzY3JlZW4uXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBFbnVtZXJhdGlvblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRW51bWVyYXRpb25Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgRk1XQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9GTVdDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgRG9tYWluIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9Eb21haW4uanMnO1xyXG5pbXBvcnQgRG9tYWluQ2hhcnQgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL0RvbWFpbkNoYXJ0LmpzJztcclxuaW1wb3J0IEhhcm1vbmljIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9IYXJtb25pYy5qcyc7XHJcbmltcG9ydCBTZXJpZXNUeXBlIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9TZXJpZXNUeXBlLmpzJztcclxuaW1wb3J0IGZvdXJpZXJNYWtpbmdXYXZlcyBmcm9tICcuLi8uLi9mb3VyaWVyTWFraW5nV2F2ZXMuanMnO1xyXG5pbXBvcnQgRm91cmllckNvbXBvbmVudCBmcm9tICcuL0ZvdXJpZXJDb21wb25lbnQuanMnO1xyXG5pbXBvcnQgV2F2ZVBhY2tldCBmcm9tICcuL1dhdmVQYWNrZXQuanMnO1xyXG5pbXBvcnQgQXhpc0Rlc2NyaXB0aW9uIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9BeGlzRGVzY3JpcHRpb24uanMnO1xyXG5cclxuLy8gV2UgY291bGQgdXNlIGRpZmZlcmVudCBudW1iZXJzIG9mIHBvaW50cyBmb3IgZGlmZmVyZW50IEZvdXJpZXIgY29tcG9uZW50cywgYmVjYXVzZSBsb3dlci1vcmRlciBjb21wb25lbnRzIGhhdmUgYVxyXG4vLyBsb25nZXIgcGVyaW9kLCBhbmQgdGhlcmVmb3JlIHJlcXVpcmUgZmV3ZXIgcG9pbnRzIHRvIG1ha2UgdGhlbSBsb29rIHNtb290aC4gQnV0IGNvbXB1dGluZyB0aGUgc2FtZSBudW1iZXIgb2YgcG9pbnRzXHJcbi8vIGZvciBhbGwgY29tcG9uZW50cyBtYWtlcyBpdCBlYXNpZXIgYW5kIG1vcmUgZWZmaWNpZW50IHRvIGNvbXB1dGUgdGhlIFN1bSBvZiB0aG9zZSBjb21wb25lbnRzIGluIHRoZSBXYXZlIFBhY2tldCBzY3JlZW4uXHJcbmNvbnN0IFBPSU5UU19QRVJfREFUQV9TRVQgPSBGTVdDb25zdGFudHMuTUFYX1BPSU5UU19QRVJfREFUQV9TRVQ7XHJcbmNvbnN0IEVNUFRZX0RBVEFfU0VUID0gRk1XQ29uc3RhbnRzLkVNUFRZX0RBVEFfU0VUO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgV2F2ZVBhY2tldENvbXBvbmVudHNDaGFydCBleHRlbmRzIERvbWFpbkNoYXJ0IHtcclxuXHJcbiAgLy8gQSBkYXRhIHNldCBmb3IgZWFjaCBGb3VyaWVyIGNvbXBvbmVudCdzIHdhdmVmb3JtLCBFTVBUWV9EQVRBX1NFVCB3aGVuIHRoZSBudW1iZXIgb2YgY29tcG9uZW50cyBpcyBpbmZpbml0ZS5cclxuICAvLyBPcmRlcmVkIGJ5IGluY3JlYXNpbmcgb3JkZXIgb2YgRm91cmllciBjb21wb25lbnQsIGkuZS4gdGhlIGZ1bmRhbWVudGFsIGNvbXBvbmVudCBoYXMgaW5kZXg9MC5cclxuICAvLyBUaGlzIGlzIGxvb3NlbHkgYmFzZWQgb24gdGhlIHVwZGF0ZSBtZXRob2QgaW4gRDJDQ29tcG9uZW50c1ZpZXcuamF2YS5cclxuICBwdWJsaWMgcmVhZG9ubHkgY29tcG9uZW50RGF0YVNldHNQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8VmVjdG9yMltdW10+O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHdhdmVQYWNrZXQ6IFdhdmVQYWNrZXQsIGRvbWFpblByb3BlcnR5OiBFbnVtZXJhdGlvblByb3BlcnR5PERvbWFpbj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBzZXJpZXNUeXBlUHJvcGVydHk6IEVudW1lcmF0aW9uUHJvcGVydHk8U2VyaWVzVHlwZT4sXHJcbiAgICAgICAgICAgICAgICAgICAgICB4QXhpc0Rlc2NyaXB0aW9uUHJvcGVydHk6IFByb3BlcnR5PEF4aXNEZXNjcmlwdGlvbj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICB0YW5kZW06IFRhbmRlbSApIHtcclxuXHJcbiAgICBzdXBlciggZG9tYWluUHJvcGVydHksIHhBeGlzRGVzY3JpcHRpb25Qcm9wZXJ0eSwgd2F2ZVBhY2tldC5MLCB3YXZlUGFja2V0LlQsIHRhbmRlbSApO1xyXG5cclxuICAgIHRoaXMuY29tcG9uZW50RGF0YVNldHNQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgd2F2ZVBhY2tldC5jb21wb25lbnRzUHJvcGVydHksIGRvbWFpblByb3BlcnR5LCBzZXJpZXNUeXBlUHJvcGVydHksIHhBeGlzRGVzY3JpcHRpb25Qcm9wZXJ0eSBdLFxyXG4gICAgICAoIGNvbXBvbmVudHMsIGRvbWFpbiwgc2VyaWVzVHlwZSwgeEF4aXNEZXNjcmlwdGlvbiApID0+IHtcclxuICAgICAgICBsZXQgZGF0YVNldHM6IFZlY3RvcjJbXVtdID0gRU1QVFlfREFUQV9TRVQ7XHJcbiAgICAgICAgaWYgKCBjb21wb25lbnRzLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgICBkYXRhU2V0cyA9IFdhdmVQYWNrZXRDb21wb25lbnRzQ2hhcnQuY3JlYXRlQ29tcG9uZW50c0RhdGFTZXRzKCBjb21wb25lbnRzLFxyXG4gICAgICAgICAgICB3YXZlUGFja2V0LmNvbXBvbmVudFNwYWNpbmdQcm9wZXJ0eS52YWx1ZSwgZG9tYWluLCBzZXJpZXNUeXBlLCB4QXhpc0Rlc2NyaXB0aW9uLnJhbmdlICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRhU2V0cztcclxuICAgICAgfSApO1xyXG5cclxuICAgIC8vIE5PVEU6IFRoaXMgY2hhcnQgZG9lcyBub3QgaGF2ZSBhIHBlYWtBbXBsaXR1ZGVQcm9wZXJ0eSBiZWNhdXNlIGl0cyBtb3JlIGVmZmljaWVudCBmb3IgdGhlIHZpZXcgdG8gZGV0ZXJtaW5lXHJcbiAgICAvLyB0aGUgeS1heGlzIHJhbmdlIHdoaWxlIGl0ZXJhdGluZyBvdmVyIGNvbXBvbmVudERhdGFTZXRzUHJvcGVydHkuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGRhdGEgc2V0cyBmb3IgdGhlIHdhdmVmb3JtcyB0aGF0IGNvcnJlc3BvbmQgdG8gYSBzZXQgb2YgRm91cmllciBjb21wb25lbnRzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlQ29tcG9uZW50c0RhdGFTZXRzKCBjb21wb25lbnRzOiBGb3VyaWVyQ29tcG9uZW50W10sIGNvbXBvbmVudFNwYWNpbmc6IG51bWJlciwgZG9tYWluOiBEb21haW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcmllc1R5cGU6IFNlcmllc1R5cGUsIHhSYW5nZTogUmFuZ2UgKTogVmVjdG9yMltdW10ge1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbXBvbmVudHMubGVuZ3RoID4gMCAmJiBjb21wb25lbnRTcGFjaW5nID49IDAgKTtcclxuXHJcbiAgICBjb25zdCBkYXRhU2V0czogVmVjdG9yMltdW10gPSBbXTtcclxuICAgIGNvbnN0IEwgPSAyICogTWF0aC5QSSAvIGNvbXBvbmVudFNwYWNpbmc7XHJcbiAgICBjb25zdCBUID0gTDsgLy8gYmVjYXVzZSB0aGUgV2F2ZVBhY2tldCBtb2RlbCBpcyBpbmRlcGVuZGVudCBvZiBEb21haW4sIGFuZCBhc3N1bWVzIHRoYXQgTCA9PT0gVFxyXG4gICAgY29uc3QgdCA9IDA7IC8vIHRoZXJlIGlzIG5vIGFuaW1hdGlvbiBpbiB0aGlzIHNjcmVlbiwgc28gdGltZSBpcyBhbHdheXMgMFxyXG5cclxuICAgIGZvciAoIGxldCBvcmRlciA9IDE7IG9yZGVyIDw9IGNvbXBvbmVudHMubGVuZ3RoOyBvcmRlcisrICkge1xyXG4gICAgICBjb25zdCBhbXBsaXR1ZGUgPSBjb21wb25lbnRzWyBvcmRlciAtIDEgXS5hbXBsaXR1ZGU7XHJcbiAgICAgIGRhdGFTZXRzLnB1c2goIEhhcm1vbmljLmNyZWF0ZURhdGFTZXRTdGF0aWMoIG9yZGVyLCBhbXBsaXR1ZGUsIFBPSU5UU19QRVJfREFUQV9TRVQsIEwsIFQsIHhSYW5nZSwgZG9tYWluLCBzZXJpZXNUeXBlLCB0ICkgKTtcclxuICAgIH1cclxuICAgIHJldHVybiBkYXRhU2V0cztcclxuICB9XHJcbn1cclxuXHJcbmZvdXJpZXJNYWtpbmdXYXZlcy5yZWdpc3RlciggJ1dhdmVQYWNrZXRDb21wb25lbnRzQ2hhcnQnLCBXYXZlUGFja2V0Q29tcG9uZW50c0NoYXJ0ICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFPcEUsT0FBT0MsWUFBWSxNQUFNLDhCQUE4QjtBQUV2RCxPQUFPQyxXQUFXLE1BQU0sbUNBQW1DO0FBQzNELE9BQU9DLFFBQVEsTUFBTSxnQ0FBZ0M7QUFFckQsT0FBT0Msa0JBQWtCLE1BQU0sNkJBQTZCO0FBSzVEO0FBQ0E7QUFDQTtBQUNBLE1BQU1DLG1CQUFtQixHQUFHSixZQUFZLENBQUNLLHVCQUF1QjtBQUNoRSxNQUFNQyxjQUFjLEdBQUdOLFlBQVksQ0FBQ00sY0FBYztBQUVsRCxlQUFlLE1BQU1DLHlCQUF5QixTQUFTTixXQUFXLENBQUM7RUFFakU7RUFDQTtFQUNBOztFQUdPTyxXQUFXQSxDQUFFQyxVQUFzQixFQUFFQyxjQUEyQyxFQUNuRUMsa0JBQW1ELEVBQ25EQyx3QkFBbUQsRUFDbkRDLE1BQWMsRUFBRztJQUVuQyxLQUFLLENBQUVILGNBQWMsRUFBRUUsd0JBQXdCLEVBQUVILFVBQVUsQ0FBQ0ssQ0FBQyxFQUFFTCxVQUFVLENBQUNNLENBQUMsRUFBRUYsTUFBTyxDQUFDO0lBRXJGLElBQUksQ0FBQ0cseUJBQXlCLEdBQUcsSUFBSWpCLGVBQWUsQ0FDbEQsQ0FBRVUsVUFBVSxDQUFDUSxrQkFBa0IsRUFBRVAsY0FBYyxFQUFFQyxrQkFBa0IsRUFBRUMsd0JBQXdCLENBQUUsRUFDL0YsQ0FBRU0sVUFBVSxFQUFFQyxNQUFNLEVBQUVDLFVBQVUsRUFBRUMsZ0JBQWdCLEtBQU07TUFDdEQsSUFBSUMsUUFBcUIsR0FBR2hCLGNBQWM7TUFDMUMsSUFBS1ksVUFBVSxDQUFDSyxNQUFNLEdBQUcsQ0FBQyxFQUFHO1FBQzNCRCxRQUFRLEdBQUdmLHlCQUF5QixDQUFDaUIsd0JBQXdCLENBQUVOLFVBQVUsRUFDdkVULFVBQVUsQ0FBQ2dCLHdCQUF3QixDQUFDQyxLQUFLLEVBQUVQLE1BQU0sRUFBRUMsVUFBVSxFQUFFQyxnQkFBZ0IsQ0FBQ00sS0FBTSxDQUFDO01BQzNGO01BQ0EsT0FBT0wsUUFBUTtJQUNqQixDQUFFLENBQUM7O0lBRUw7SUFDQTtFQUNGOztFQUVBO0FBQ0Y7QUFDQTtFQUNFLE9BQWNFLHdCQUF3QkEsQ0FBRU4sVUFBOEIsRUFBRVUsZ0JBQXdCLEVBQUVULE1BQWMsRUFDeEVDLFVBQXNCLEVBQUVTLE1BQWEsRUFBZ0I7SUFFM0ZDLE1BQU0sSUFBSUEsTUFBTSxDQUFFWixVQUFVLENBQUNLLE1BQU0sR0FBRyxDQUFDLElBQUlLLGdCQUFnQixJQUFJLENBQUUsQ0FBQztJQUVsRSxNQUFNTixRQUFxQixHQUFHLEVBQUU7SUFDaEMsTUFBTVIsQ0FBQyxHQUFHLENBQUMsR0FBR2lCLElBQUksQ0FBQ0MsRUFBRSxHQUFHSixnQkFBZ0I7SUFDeEMsTUFBTWIsQ0FBQyxHQUFHRCxDQUFDLENBQUMsQ0FBQztJQUNiLE1BQU1tQixDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7O0lBRWIsS0FBTSxJQUFJQyxLQUFLLEdBQUcsQ0FBQyxFQUFFQSxLQUFLLElBQUloQixVQUFVLENBQUNLLE1BQU0sRUFBRVcsS0FBSyxFQUFFLEVBQUc7TUFDekQsTUFBTUMsU0FBUyxHQUFHakIsVUFBVSxDQUFFZ0IsS0FBSyxHQUFHLENBQUMsQ0FBRSxDQUFDQyxTQUFTO01BQ25EYixRQUFRLENBQUNjLElBQUksQ0FBRWxDLFFBQVEsQ0FBQ21DLG1CQUFtQixDQUFFSCxLQUFLLEVBQUVDLFNBQVMsRUFBRS9CLG1CQUFtQixFQUFFVSxDQUFDLEVBQUVDLENBQUMsRUFBRWMsTUFBTSxFQUFFVixNQUFNLEVBQUVDLFVBQVUsRUFBRWEsQ0FBRSxDQUFFLENBQUM7SUFDN0g7SUFDQSxPQUFPWCxRQUFRO0VBQ2pCO0FBQ0Y7QUFFQW5CLGtCQUFrQixDQUFDbUMsUUFBUSxDQUFFLDJCQUEyQixFQUFFL0IseUJBQTBCLENBQUMifQ==