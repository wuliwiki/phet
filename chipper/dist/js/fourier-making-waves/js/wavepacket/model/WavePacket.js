// Copyright 2021-2023, University of Colorado Boulder

/**
 * WavePacket is the model of a Gaussian wave packet.
 *
 * Note that many of the Properties herein have values that are the same for both the space and time Domain.
 * We can make this simplification (which originated in the Java version) because we assume that the values of L
 * (wavelength of the fundamental harmonic) and T (period of the fundamental harmonic) are the same. That is,
 * L=1 meter and T=1 millisecond. The units for these Properties are therefore dependent on the Domain, and changing
 * the Domain simply changes the symbols and units that appear in the user interface.  This also means that we can't
 * use Property's units option, so we describe the units in phetioDocumentation.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Range from '../../../../dot/js/Range.js';
import ArrayIO from '../../../../tandem/js/types/ArrayIO.js';
import InfiniteNumberIO from '../../../../tandem/js/types/InfiniteNumberIO.js';
import NumberIO from '../../../../tandem/js/types/NumberIO.js';
import fourierMakingWaves from '../../fourierMakingWaves.js';
import FourierComponent from './FourierComponent.js';

// valid values for component spacing
const COMPONENT_SPACING_VALUES = [0, Math.PI / 4, Math.PI / 2, Math.PI];
assert && assert(_.every(COMPONENT_SPACING_VALUES, (element, index, array) => index === 0 || array[index - 1] < element), 'COMPONENT_SPACING_VALUES must be unique and sorted in ascending order');
export default class WavePacket {
  // wavelength when component spacing is 2 * Math.PI, in m
  // period when component spacing is 2 * Math.PI, in ms

  // Range of the wave number for Fourier components.
  // k (rad/m) is spatial wave number, or omega (rad/ms) is angular wave number
  // See phetioDocumentation. The spacing between Fourier components, k1 (rad/m) or omega (rad/ms)
  // See phetioDocumentation
  // See phetioDocumentation.
  // See https://github.com/phetsims/fourier-making-waves/issues/105#issuecomment-889386852 for name decision.
  // This is sometimes referred to as a delta (dk, d<sub>omega</sub>) in literature and in code comments.
  // See phetioDocumentation.
  // This is the conjugate (different form) of standardDeviationProperty. Using 'conjugate' here is
  // PhET-specific terminology, not something that you'll find in the literature. It is sometimes referred to
  // as a delta (dx, dt) in literature and in code comments. For decisions about name and units, see
  // https://github.com/phetsims/fourier-making-waves/issues/105#issuecomment-889386852
  // The Fourier components used to approximate the wave packet. Ordered by increasing wave number.
  // This is loosely based on the addGeneralPathPlot method in D2CAmplitudesView.java.
  constructor(tandem) {
    this.L = 1;
    this.T = 1;
    assert && assert(this.L === this.T && this.L === 1 && this.T === 1, 'Many things in this implementation assume that L === T === 1, inherited from Java version.');
    this.waveNumberRange = new Range(0, 24 * Math.PI);
    assert && assert(this.waveNumberRange.min === 0);
    this.componentSpacingProperty = new NumberProperty(COMPONENT_SPACING_VALUES[3], {
      validValues: COMPONENT_SPACING_VALUES,
      range: new Range(COMPONENT_SPACING_VALUES[0], COMPONENT_SPACING_VALUES[COMPONENT_SPACING_VALUES.length - 1]),
      tandem: tandem.createTandem('componentSpacingProperty'),
      phetioDocumentation: 'The spacing of components in the Fourier series that is used to approximate the wave packet. ' + 'In the space domain, this is k<sub>1</sub> in rad/m. ' + 'In the time domain, this is \u03c9<sub>1</sub> in rad/ms.'
    });
    this.centerProperty = new NumberProperty(12 * Math.PI, {
      range: new Range(9 * Math.PI, 15 * Math.PI),
      tandem: tandem.createTandem('centerProperty'),
      phetioDocumentation: 'The center of the wave packet. ' + 'In the space domain, this is k<sub>0</sub> in rad/m. ' + 'In the time domain, this is \u03c9<sub>0</sub> in rad/ms.'
    });
    this.standardDeviationProperty = new NumberProperty(3 * Math.PI, {
      range: new Range(Math.PI, 4 * Math.PI),
      tandem: tandem.createTandem('standardDeviationProperty'),
      phetioDocumentation: 'Standard deviation, a measure of the wave packet width. ' + 'In the space domain, this is \u03c3<sub>k</sub> in rad/m. ' + 'In the time domain, this is \u03c3<sub>\u03c9</sub> in rad/ms.'
    });
    this.conjugateStandardDeviationProperty = new NumberProperty(1 / this.standardDeviationProperty.value, {
      range: new Range(1 / this.standardDeviationProperty.range.max, 1 / this.standardDeviationProperty.range.min),
      tandem: tandem.createTandem('conjugateStandardDeviationProperty'),
      phetioDocumentation: 'This Property and standardDeviationProperty are a conjugate pair, ' + 'where conjugateStandardDeviation = 1 / standardDeviation.' + 'They are both measures of the wave packet width. ' + 'In the space domain, this is \u03c3<sub>x</sub> in m. ' + 'In the time domain, this is \u03c3<sub>t</sub> in ms.'
    });

    // conjugateStandardDeviationProperty seems like a natural place to use DynamicProperty. But as of this writing,
    // DynamicProperty is not instrumented for PhET-iO, and it doesn't support range (needed by NumberControl).
    // So this next bit of code does the work that a bidirectional DynamicProperty would do - it keeps standardDeviation
    // and conjugateStandardDeviationProperty synchronized. And unlike DynamicProperty, it avoids reentrant behavior,
    // so neither Property requires reentrant:true.  See https://github.com/phetsims/axon/issues/358
    let isSynchronizing = false;
    this.standardDeviationProperty.lazyLink(standardDeviation => {
      if (!isSynchronizing) {
        isSynchronizing = true;
        this.conjugateStandardDeviationProperty.value = 1 / standardDeviation;
        isSynchronizing = false;
      }
    });
    this.conjugateStandardDeviationProperty.lazyLink(conjugateStandardDeviation => {
      if (!isSynchronizing) {
        isSynchronizing = true;
        this.standardDeviationProperty.value = 1 / conjugateStandardDeviation;
        isSynchronizing = false;
      }
    });
    this.widthProperty = new DerivedProperty([this.standardDeviationProperty], standardDeviation => 2 * standardDeviation, {
      tandem: tandem.createTandem('widthProperty'),
      phetioValueType: NumberIO,
      phetioDocumentation: 'The width of the wave packet, derived from standardDeviationProperty. ' + 'In the space domain, width is in rad/m. ' + 'In the time domain, width is in rad/ms.'
    });
    this.lengthProperty = new DerivedProperty([this.componentSpacingProperty], componentSpacing => {
      let period = Infinity;
      if (componentSpacing > 0) {
        period = 2 * Math.PI / componentSpacing;
      }
      return period;
    }, {
      tandem: tandem.createTandem('lengthProperty'),
      phetioValueType: InfiniteNumberIO,
      phetioDocumentation: 'A measure of the wave packet length. ' + 'In the space domain, wavelength \u03bb<sub>1</sub> in m. ' + 'In the time domain, period T<sub>1</sub> in ms.'
    });
    this.componentsProperty = new DerivedProperty([this.componentSpacingProperty, this.centerProperty, this.standardDeviationProperty], (componentSpacing, center, standardDeviation) => {
      const dataSet = []; // {Vector2[]}
      const numberOfComponents = this.getNumberOfComponents();
      if (numberOfComponents !== Infinity) {
        for (let i = 0; i < numberOfComponents; i++) {
          const waveNumber = i * componentSpacing; // spatial in rad/m, or angular in rad/ms
          const An = this.getComponentAmplitude(waveNumber) * componentSpacing;
          dataSet.push(new FourierComponent(waveNumber, An));
        }
      }
      return dataSet;
    }, {
      tandem: tandem.createTandem('componentsProperty'),
      phetioValueType: ArrayIO(FourierComponent.FourierComponentIO),
      phetioDocumentation: 'The set of Fourier components used to approximate the wave packet. ' + 'Each component has a wave number and an amplitude. ' + 'For the space domain, k is the spatial wave number in rad/m. ' + 'For the time domain, \u03c9 is the angular wave number in rad/ms. ' + 'Amplitude is unitless.'
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
  }
  reset() {
    this.componentSpacingProperty.reset();
    this.centerProperty.reset();
    this.standardDeviationProperty.reset();
    this.conjugateStandardDeviationProperty.reset();
  }

  /**
   * Gets the number of components in the Fourier series.
   */
  getNumberOfComponents() {
    const componentSpacing = this.componentSpacingProperty.value;
    if (componentSpacing === 0) {
      return Infinity;
    } else {
      return Math.floor(this.waveNumberRange.getLength() / componentSpacing) + 1;
    }
  }

  /**
   * Gets the amplitude of Fourier component k, using the standard Gaussian formula:
   *
   * A(k,k0,dk) = exp[ -((k-k0)^2) / (2 * (dk^2) )  ] / (dk * sqrt( 2pi ))
   * where k = wave number, k0 = wave packet center, dk = standard deviation of width
   *
   * Note that symbol k used in the formula above is specific to the space Domain, and is in rad/m.
   * But this method can also be used for the time Domain (omega, in rad/ms), because L === T === 1.
   *
   * This was ported from the getAmplitude method in GaussianWavePacket.java.
   */
  getComponentAmplitude(waveNumber) {
    const center = this.centerProperty.value;
    const sigma = this.standardDeviationProperty.value;
    return Math.exp(-((waveNumber - center) * (waveNumber - center)) / (2 * sigma * sigma)) / (sigma * Math.sqrt(2 * Math.PI));
  }
}
fourierMakingWaves.register('WavePacket', WavePacket);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIlJhbmdlIiwiQXJyYXlJTyIsIkluZmluaXRlTnVtYmVySU8iLCJOdW1iZXJJTyIsImZvdXJpZXJNYWtpbmdXYXZlcyIsIkZvdXJpZXJDb21wb25lbnQiLCJDT01QT05FTlRfU1BBQ0lOR19WQUxVRVMiLCJNYXRoIiwiUEkiLCJhc3NlcnQiLCJfIiwiZXZlcnkiLCJlbGVtZW50IiwiaW5kZXgiLCJhcnJheSIsIldhdmVQYWNrZXQiLCJjb25zdHJ1Y3RvciIsInRhbmRlbSIsIkwiLCJUIiwid2F2ZU51bWJlclJhbmdlIiwibWluIiwiY29tcG9uZW50U3BhY2luZ1Byb3BlcnR5IiwidmFsaWRWYWx1ZXMiLCJyYW5nZSIsImxlbmd0aCIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJjZW50ZXJQcm9wZXJ0eSIsInN0YW5kYXJkRGV2aWF0aW9uUHJvcGVydHkiLCJjb25qdWdhdGVTdGFuZGFyZERldmlhdGlvblByb3BlcnR5IiwidmFsdWUiLCJtYXgiLCJpc1N5bmNocm9uaXppbmciLCJsYXp5TGluayIsInN0YW5kYXJkRGV2aWF0aW9uIiwiY29uanVnYXRlU3RhbmRhcmREZXZpYXRpb24iLCJ3aWR0aFByb3BlcnR5IiwicGhldGlvVmFsdWVUeXBlIiwibGVuZ3RoUHJvcGVydHkiLCJjb21wb25lbnRTcGFjaW5nIiwicGVyaW9kIiwiSW5maW5pdHkiLCJjb21wb25lbnRzUHJvcGVydHkiLCJjZW50ZXIiLCJkYXRhU2V0IiwibnVtYmVyT2ZDb21wb25lbnRzIiwiZ2V0TnVtYmVyT2ZDb21wb25lbnRzIiwiaSIsIndhdmVOdW1iZXIiLCJBbiIsImdldENvbXBvbmVudEFtcGxpdHVkZSIsInB1c2giLCJGb3VyaWVyQ29tcG9uZW50SU8iLCJkaXNwb3NlIiwicmVzZXQiLCJmbG9vciIsImdldExlbmd0aCIsInNpZ21hIiwiZXhwIiwic3FydCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiV2F2ZVBhY2tldC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBXYXZlUGFja2V0IGlzIHRoZSBtb2RlbCBvZiBhIEdhdXNzaWFuIHdhdmUgcGFja2V0LlxyXG4gKlxyXG4gKiBOb3RlIHRoYXQgbWFueSBvZiB0aGUgUHJvcGVydGllcyBoZXJlaW4gaGF2ZSB2YWx1ZXMgdGhhdCBhcmUgdGhlIHNhbWUgZm9yIGJvdGggdGhlIHNwYWNlIGFuZCB0aW1lIERvbWFpbi5cclxuICogV2UgY2FuIG1ha2UgdGhpcyBzaW1wbGlmaWNhdGlvbiAod2hpY2ggb3JpZ2luYXRlZCBpbiB0aGUgSmF2YSB2ZXJzaW9uKSBiZWNhdXNlIHdlIGFzc3VtZSB0aGF0IHRoZSB2YWx1ZXMgb2YgTFxyXG4gKiAod2F2ZWxlbmd0aCBvZiB0aGUgZnVuZGFtZW50YWwgaGFybW9uaWMpIGFuZCBUIChwZXJpb2Qgb2YgdGhlIGZ1bmRhbWVudGFsIGhhcm1vbmljKSBhcmUgdGhlIHNhbWUuIFRoYXQgaXMsXHJcbiAqIEw9MSBtZXRlciBhbmQgVD0xIG1pbGxpc2Vjb25kLiBUaGUgdW5pdHMgZm9yIHRoZXNlIFByb3BlcnRpZXMgYXJlIHRoZXJlZm9yZSBkZXBlbmRlbnQgb24gdGhlIERvbWFpbiwgYW5kIGNoYW5naW5nXHJcbiAqIHRoZSBEb21haW4gc2ltcGx5IGNoYW5nZXMgdGhlIHN5bWJvbHMgYW5kIHVuaXRzIHRoYXQgYXBwZWFyIGluIHRoZSB1c2VyIGludGVyZmFjZS4gIFRoaXMgYWxzbyBtZWFucyB0aGF0IHdlIGNhbid0XHJcbiAqIHVzZSBQcm9wZXJ0eSdzIHVuaXRzIG9wdGlvbiwgc28gd2UgZGVzY3JpYmUgdGhlIHVuaXRzIGluIHBoZXRpb0RvY3VtZW50YXRpb24uXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IEFycmF5SU8gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0FycmF5SU8uanMnO1xyXG5pbXBvcnQgSW5maW5pdGVOdW1iZXJJTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvSW5maW5pdGVOdW1iZXJJTy5qcyc7XHJcbmltcG9ydCBOdW1iZXJJTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvTnVtYmVySU8uanMnO1xyXG5pbXBvcnQgZm91cmllck1ha2luZ1dhdmVzIGZyb20gJy4uLy4uL2ZvdXJpZXJNYWtpbmdXYXZlcy5qcyc7XHJcbmltcG9ydCBGb3VyaWVyQ29tcG9uZW50IGZyb20gJy4vRm91cmllckNvbXBvbmVudC5qcyc7XHJcblxyXG4vLyB2YWxpZCB2YWx1ZXMgZm9yIGNvbXBvbmVudCBzcGFjaW5nXHJcbmNvbnN0IENPTVBPTkVOVF9TUEFDSU5HX1ZBTFVFUyA9IFsgMCwgTWF0aC5QSSAvIDQsIE1hdGguUEkgLyAyLCBNYXRoLlBJIF07XHJcbmFzc2VydCAmJiBhc3NlcnQoXHJcbiAgXy5ldmVyeSggQ09NUE9ORU5UX1NQQUNJTkdfVkFMVUVTLCAoIGVsZW1lbnQsIGluZGV4LCBhcnJheSApID0+ICggaW5kZXggPT09IDAgfHwgYXJyYXlbIGluZGV4IC0gMSBdIDwgZWxlbWVudCApICksXHJcbiAgJ0NPTVBPTkVOVF9TUEFDSU5HX1ZBTFVFUyBtdXN0IGJlIHVuaXF1ZSBhbmQgc29ydGVkIGluIGFzY2VuZGluZyBvcmRlcidcclxuKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFdhdmVQYWNrZXQge1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgTDogbnVtYmVyOyAvLyB3YXZlbGVuZ3RoIHdoZW4gY29tcG9uZW50IHNwYWNpbmcgaXMgMiAqIE1hdGguUEksIGluIG1cclxuICBwdWJsaWMgcmVhZG9ubHkgVDogbnVtYmVyOyAvLyBwZXJpb2Qgd2hlbiBjb21wb25lbnQgc3BhY2luZyBpcyAyICogTWF0aC5QSSwgaW4gbXNcclxuXHJcbiAgLy8gUmFuZ2Ugb2YgdGhlIHdhdmUgbnVtYmVyIGZvciBGb3VyaWVyIGNvbXBvbmVudHMuXHJcbiAgLy8gayAocmFkL20pIGlzIHNwYXRpYWwgd2F2ZSBudW1iZXIsIG9yIG9tZWdhIChyYWQvbXMpIGlzIGFuZ3VsYXIgd2F2ZSBudW1iZXJcclxuICBwdWJsaWMgcmVhZG9ubHkgd2F2ZU51bWJlclJhbmdlOiBSYW5nZTtcclxuXHJcbiAgLy8gU2VlIHBoZXRpb0RvY3VtZW50YXRpb24uIFRoZSBzcGFjaW5nIGJldHdlZW4gRm91cmllciBjb21wb25lbnRzLCBrMSAocmFkL20pIG9yIG9tZWdhIChyYWQvbXMpXHJcbiAgcHVibGljIHJlYWRvbmx5IGNvbXBvbmVudFNwYWNpbmdQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHk7XHJcblxyXG4gIC8vIFNlZSBwaGV0aW9Eb2N1bWVudGF0aW9uXHJcbiAgcHVibGljIHJlYWRvbmx5IGNlbnRlclByb3BlcnR5OiBOdW1iZXJQcm9wZXJ0eTtcclxuXHJcbiAgLy8gU2VlIHBoZXRpb0RvY3VtZW50YXRpb24uXHJcbiAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9mb3VyaWVyLW1ha2luZy13YXZlcy9pc3N1ZXMvMTA1I2lzc3VlY29tbWVudC04ODkzODY4NTIgZm9yIG5hbWUgZGVjaXNpb24uXHJcbiAgLy8gVGhpcyBpcyBzb21ldGltZXMgcmVmZXJyZWQgdG8gYXMgYSBkZWx0YSAoZGssIGQ8c3ViPm9tZWdhPC9zdWI+KSBpbiBsaXRlcmF0dXJlIGFuZCBpbiBjb2RlIGNvbW1lbnRzLlxyXG4gIHB1YmxpYyByZWFkb25seSBzdGFuZGFyZERldmlhdGlvblByb3BlcnR5OiBOdW1iZXJQcm9wZXJ0eTtcclxuXHJcbiAgLy8gU2VlIHBoZXRpb0RvY3VtZW50YXRpb24uXHJcbiAgLy8gVGhpcyBpcyB0aGUgY29uanVnYXRlIChkaWZmZXJlbnQgZm9ybSkgb2Ygc3RhbmRhcmREZXZpYXRpb25Qcm9wZXJ0eS4gVXNpbmcgJ2Nvbmp1Z2F0ZScgaGVyZSBpc1xyXG4gIC8vIFBoRVQtc3BlY2lmaWMgdGVybWlub2xvZ3ksIG5vdCBzb21ldGhpbmcgdGhhdCB5b3UnbGwgZmluZCBpbiB0aGUgbGl0ZXJhdHVyZS4gSXQgaXMgc29tZXRpbWVzIHJlZmVycmVkIHRvXHJcbiAgLy8gYXMgYSBkZWx0YSAoZHgsIGR0KSBpbiBsaXRlcmF0dXJlIGFuZCBpbiBjb2RlIGNvbW1lbnRzLiBGb3IgZGVjaXNpb25zIGFib3V0IG5hbWUgYW5kIHVuaXRzLCBzZWVcclxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZm91cmllci1tYWtpbmctd2F2ZXMvaXNzdWVzLzEwNSNpc3N1ZWNvbW1lbnQtODg5Mzg2ODUyXHJcbiAgcHVibGljIHJlYWRvbmx5IGNvbmp1Z2F0ZVN0YW5kYXJkRGV2aWF0aW9uUHJvcGVydHk6IE51bWJlclByb3BlcnR5O1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgd2lkdGhQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgbGVuZ3RoUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PG51bWJlcj47XHJcblxyXG4gIC8vIFRoZSBGb3VyaWVyIGNvbXBvbmVudHMgdXNlZCB0byBhcHByb3hpbWF0ZSB0aGUgd2F2ZSBwYWNrZXQuIE9yZGVyZWQgYnkgaW5jcmVhc2luZyB3YXZlIG51bWJlci5cclxuICAvLyBUaGlzIGlzIGxvb3NlbHkgYmFzZWQgb24gdGhlIGFkZEdlbmVyYWxQYXRoUGxvdCBtZXRob2QgaW4gRDJDQW1wbGl0dWRlc1ZpZXcuamF2YS5cclxuICBwdWJsaWMgcmVhZG9ubHkgY29tcG9uZW50c1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxGb3VyaWVyQ29tcG9uZW50W10+O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHRhbmRlbTogVGFuZGVtICkge1xyXG5cclxuICAgIHRoaXMuTCA9IDE7XHJcbiAgICB0aGlzLlQgPSAxO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5MID09PSB0aGlzLlQgJiYgdGhpcy5MID09PSAxICYmIHRoaXMuVCA9PT0gMSxcclxuICAgICAgJ01hbnkgdGhpbmdzIGluIHRoaXMgaW1wbGVtZW50YXRpb24gYXNzdW1lIHRoYXQgTCA9PT0gVCA9PT0gMSwgaW5oZXJpdGVkIGZyb20gSmF2YSB2ZXJzaW9uLicgKTtcclxuXHJcbiAgICB0aGlzLndhdmVOdW1iZXJSYW5nZSA9IG5ldyBSYW5nZSggMCwgMjQgKiBNYXRoLlBJICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLndhdmVOdW1iZXJSYW5nZS5taW4gPT09IDAgKTtcclxuXHJcbiAgICB0aGlzLmNvbXBvbmVudFNwYWNpbmdQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggQ09NUE9ORU5UX1NQQUNJTkdfVkFMVUVTWyAzIF0sIHtcclxuICAgICAgdmFsaWRWYWx1ZXM6IENPTVBPTkVOVF9TUEFDSU5HX1ZBTFVFUyxcclxuICAgICAgcmFuZ2U6IG5ldyBSYW5nZSggQ09NUE9ORU5UX1NQQUNJTkdfVkFMVUVTWyAwIF0sIENPTVBPTkVOVF9TUEFDSU5HX1ZBTFVFU1sgQ09NUE9ORU5UX1NQQUNJTkdfVkFMVUVTLmxlbmd0aCAtIDEgXSApLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdjb21wb25lbnRTcGFjaW5nUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdUaGUgc3BhY2luZyBvZiBjb21wb25lbnRzIGluIHRoZSBGb3VyaWVyIHNlcmllcyB0aGF0IGlzIHVzZWQgdG8gYXBwcm94aW1hdGUgdGhlIHdhdmUgcGFja2V0LiAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0luIHRoZSBzcGFjZSBkb21haW4sIHRoaXMgaXMgazxzdWI+MTwvc3ViPiBpbiByYWQvbS4gJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICdJbiB0aGUgdGltZSBkb21haW4sIHRoaXMgaXMgXFx1MDNjOTxzdWI+MTwvc3ViPiBpbiByYWQvbXMuJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuY2VudGVyUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIDEyICogTWF0aC5QSSwge1xyXG4gICAgICByYW5nZTogbmV3IFJhbmdlKCA5ICogTWF0aC5QSSwgMTUgKiBNYXRoLlBJICksXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NlbnRlclByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnVGhlIGNlbnRlciBvZiB0aGUgd2F2ZSBwYWNrZXQuICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAnSW4gdGhlIHNwYWNlIGRvbWFpbiwgdGhpcyBpcyBrPHN1Yj4wPC9zdWI+IGluIHJhZC9tLiAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0luIHRoZSB0aW1lIGRvbWFpbiwgdGhpcyBpcyBcXHUwM2M5PHN1Yj4wPC9zdWI+IGluIHJhZC9tcy4nXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5zdGFuZGFyZERldmlhdGlvblByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCAzICogTWF0aC5QSSwge1xyXG4gICAgICByYW5nZTogbmV3IFJhbmdlKCBNYXRoLlBJLCA0ICogTWF0aC5QSSApLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdzdGFuZGFyZERldmlhdGlvblByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnU3RhbmRhcmQgZGV2aWF0aW9uLCBhIG1lYXN1cmUgb2YgdGhlIHdhdmUgcGFja2V0IHdpZHRoLiAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0luIHRoZSBzcGFjZSBkb21haW4sIHRoaXMgaXMgXFx1MDNjMzxzdWI+azwvc3ViPiBpbiByYWQvbS4gJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICdJbiB0aGUgdGltZSBkb21haW4sIHRoaXMgaXMgXFx1MDNjMzxzdWI+XFx1MDNjOTwvc3ViPiBpbiByYWQvbXMuJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuY29uanVnYXRlU3RhbmRhcmREZXZpYXRpb25Qcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggMSAvIHRoaXMuc3RhbmRhcmREZXZpYXRpb25Qcm9wZXJ0eS52YWx1ZSwge1xyXG4gICAgICByYW5nZTogbmV3IFJhbmdlKCAxIC8gdGhpcy5zdGFuZGFyZERldmlhdGlvblByb3BlcnR5LnJhbmdlLm1heCwgMSAvIHRoaXMuc3RhbmRhcmREZXZpYXRpb25Qcm9wZXJ0eS5yYW5nZS5taW4gKSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnY29uanVnYXRlU3RhbmRhcmREZXZpYXRpb25Qcm9wZXJ0eScgKSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ1RoaXMgUHJvcGVydHkgYW5kIHN0YW5kYXJkRGV2aWF0aW9uUHJvcGVydHkgYXJlIGEgY29uanVnYXRlIHBhaXIsICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAnd2hlcmUgY29uanVnYXRlU3RhbmRhcmREZXZpYXRpb24gPSAxIC8gc3RhbmRhcmREZXZpYXRpb24uJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICdUaGV5IGFyZSBib3RoIG1lYXN1cmVzIG9mIHRoZSB3YXZlIHBhY2tldCB3aWR0aC4gJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICdJbiB0aGUgc3BhY2UgZG9tYWluLCB0aGlzIGlzIFxcdTAzYzM8c3ViPng8L3N1Yj4gaW4gbS4gJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICdJbiB0aGUgdGltZSBkb21haW4sIHRoaXMgaXMgXFx1MDNjMzxzdWI+dDwvc3ViPiBpbiBtcy4nXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gY29uanVnYXRlU3RhbmRhcmREZXZpYXRpb25Qcm9wZXJ0eSBzZWVtcyBsaWtlIGEgbmF0dXJhbCBwbGFjZSB0byB1c2UgRHluYW1pY1Byb3BlcnR5LiBCdXQgYXMgb2YgdGhpcyB3cml0aW5nLFxyXG4gICAgLy8gRHluYW1pY1Byb3BlcnR5IGlzIG5vdCBpbnN0cnVtZW50ZWQgZm9yIFBoRVQtaU8sIGFuZCBpdCBkb2Vzbid0IHN1cHBvcnQgcmFuZ2UgKG5lZWRlZCBieSBOdW1iZXJDb250cm9sKS5cclxuICAgIC8vIFNvIHRoaXMgbmV4dCBiaXQgb2YgY29kZSBkb2VzIHRoZSB3b3JrIHRoYXQgYSBiaWRpcmVjdGlvbmFsIER5bmFtaWNQcm9wZXJ0eSB3b3VsZCBkbyAtIGl0IGtlZXBzIHN0YW5kYXJkRGV2aWF0aW9uXHJcbiAgICAvLyBhbmQgY29uanVnYXRlU3RhbmRhcmREZXZpYXRpb25Qcm9wZXJ0eSBzeW5jaHJvbml6ZWQuIEFuZCB1bmxpa2UgRHluYW1pY1Byb3BlcnR5LCBpdCBhdm9pZHMgcmVlbnRyYW50IGJlaGF2aW9yLFxyXG4gICAgLy8gc28gbmVpdGhlciBQcm9wZXJ0eSByZXF1aXJlcyByZWVudHJhbnQ6dHJ1ZS4gIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvYXhvbi9pc3N1ZXMvMzU4XHJcbiAgICBsZXQgaXNTeW5jaHJvbml6aW5nID0gZmFsc2U7XHJcbiAgICB0aGlzLnN0YW5kYXJkRGV2aWF0aW9uUHJvcGVydHkubGF6eUxpbmsoIHN0YW5kYXJkRGV2aWF0aW9uID0+IHtcclxuICAgICAgaWYgKCAhaXNTeW5jaHJvbml6aW5nICkge1xyXG4gICAgICAgIGlzU3luY2hyb25pemluZyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5jb25qdWdhdGVTdGFuZGFyZERldmlhdGlvblByb3BlcnR5LnZhbHVlID0gMSAvIHN0YW5kYXJkRGV2aWF0aW9uO1xyXG4gICAgICAgIGlzU3luY2hyb25pemluZyA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmNvbmp1Z2F0ZVN0YW5kYXJkRGV2aWF0aW9uUHJvcGVydHkubGF6eUxpbmsoIGNvbmp1Z2F0ZVN0YW5kYXJkRGV2aWF0aW9uID0+IHtcclxuICAgICAgaWYgKCAhaXNTeW5jaHJvbml6aW5nICkge1xyXG4gICAgICAgIGlzU3luY2hyb25pemluZyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5zdGFuZGFyZERldmlhdGlvblByb3BlcnR5LnZhbHVlID0gMSAvIGNvbmp1Z2F0ZVN0YW5kYXJkRGV2aWF0aW9uO1xyXG4gICAgICAgIGlzU3luY2hyb25pemluZyA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy53aWR0aFByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eShcclxuICAgICAgWyB0aGlzLnN0YW5kYXJkRGV2aWF0aW9uUHJvcGVydHkgXSxcclxuICAgICAgc3RhbmRhcmREZXZpYXRpb24gPT4gMiAqIHN0YW5kYXJkRGV2aWF0aW9uLCB7XHJcbiAgICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnd2lkdGhQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9WYWx1ZVR5cGU6IE51bWJlcklPLFxyXG4gICAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdUaGUgd2lkdGggb2YgdGhlIHdhdmUgcGFja2V0LCBkZXJpdmVkIGZyb20gc3RhbmRhcmREZXZpYXRpb25Qcm9wZXJ0eS4gJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0luIHRoZSBzcGFjZSBkb21haW4sIHdpZHRoIGlzIGluIHJhZC9tLiAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnSW4gdGhlIHRpbWUgZG9tYWluLCB3aWR0aCBpcyBpbiByYWQvbXMuJ1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5sZW5ndGhQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgdGhpcy5jb21wb25lbnRTcGFjaW5nUHJvcGVydHkgXSxcclxuICAgICAgY29tcG9uZW50U3BhY2luZyA9PiB7XHJcbiAgICAgICAgbGV0IHBlcmlvZCA9IEluZmluaXR5O1xyXG4gICAgICAgIGlmICggY29tcG9uZW50U3BhY2luZyA+IDAgKSB7XHJcbiAgICAgICAgICBwZXJpb2QgPSAyICogTWF0aC5QSSAvIGNvbXBvbmVudFNwYWNpbmc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwZXJpb2Q7XHJcbiAgICAgIH0sIHtcclxuICAgICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdsZW5ndGhQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9WYWx1ZVR5cGU6IEluZmluaXRlTnVtYmVySU8sXHJcbiAgICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ0EgbWVhc3VyZSBvZiB0aGUgd2F2ZSBwYWNrZXQgbGVuZ3RoLiAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnSW4gdGhlIHNwYWNlIGRvbWFpbiwgd2F2ZWxlbmd0aCBcXHUwM2JiPHN1Yj4xPC9zdWI+IGluIG0uICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJbiB0aGUgdGltZSBkb21haW4sIHBlcmlvZCBUPHN1Yj4xPC9zdWI+IGluIG1zLidcclxuICAgICAgfSApO1xyXG5cclxuICAgIHRoaXMuY29tcG9uZW50c1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eShcclxuICAgICAgWyB0aGlzLmNvbXBvbmVudFNwYWNpbmdQcm9wZXJ0eSwgdGhpcy5jZW50ZXJQcm9wZXJ0eSwgdGhpcy5zdGFuZGFyZERldmlhdGlvblByb3BlcnR5IF0sXHJcbiAgICAgICggY29tcG9uZW50U3BhY2luZywgY2VudGVyLCBzdGFuZGFyZERldmlhdGlvbiApID0+IHtcclxuICAgICAgICBjb25zdCBkYXRhU2V0ID0gW107IC8vIHtWZWN0b3IyW119XHJcbiAgICAgICAgY29uc3QgbnVtYmVyT2ZDb21wb25lbnRzID0gdGhpcy5nZXROdW1iZXJPZkNvbXBvbmVudHMoKTtcclxuICAgICAgICBpZiAoIG51bWJlck9mQ29tcG9uZW50cyAhPT0gSW5maW5pdHkgKSB7XHJcbiAgICAgICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBudW1iZXJPZkNvbXBvbmVudHM7IGkrKyApIHtcclxuICAgICAgICAgICAgY29uc3Qgd2F2ZU51bWJlciA9IGkgKiBjb21wb25lbnRTcGFjaW5nOyAvLyBzcGF0aWFsIGluIHJhZC9tLCBvciBhbmd1bGFyIGluIHJhZC9tc1xyXG4gICAgICAgICAgICBjb25zdCBBbiA9IHRoaXMuZ2V0Q29tcG9uZW50QW1wbGl0dWRlKCB3YXZlTnVtYmVyICkgKiBjb21wb25lbnRTcGFjaW5nO1xyXG4gICAgICAgICAgICBkYXRhU2V0LnB1c2goIG5ldyBGb3VyaWVyQ29tcG9uZW50KCB3YXZlTnVtYmVyLCBBbiApICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRhU2V0O1xyXG4gICAgICB9LCB7XHJcbiAgICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnY29tcG9uZW50c1Byb3BlcnR5JyApLFxyXG4gICAgICAgIHBoZXRpb1ZhbHVlVHlwZTogQXJyYXlJTyggRm91cmllckNvbXBvbmVudC5Gb3VyaWVyQ29tcG9uZW50SU8gKSxcclxuICAgICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnVGhlIHNldCBvZiBGb3VyaWVyIGNvbXBvbmVudHMgdXNlZCB0byBhcHByb3hpbWF0ZSB0aGUgd2F2ZSBwYWNrZXQuICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICdFYWNoIGNvbXBvbmVudCBoYXMgYSB3YXZlIG51bWJlciBhbmQgYW4gYW1wbGl0dWRlLiAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRm9yIHRoZSBzcGFjZSBkb21haW4sIGsgaXMgdGhlIHNwYXRpYWwgd2F2ZSBudW1iZXIgaW4gcmFkL20uICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGb3IgdGhlIHRpbWUgZG9tYWluLCBcXHUwM2M5IGlzIHRoZSBhbmd1bGFyIHdhdmUgbnVtYmVyIGluIHJhZC9tcy4gJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0FtcGxpdHVkZSBpcyB1bml0bGVzcy4nXHJcbiAgICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLmNvbXBvbmVudFNwYWNpbmdQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5jZW50ZXJQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5zdGFuZGFyZERldmlhdGlvblByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmNvbmp1Z2F0ZVN0YW5kYXJkRGV2aWF0aW9uUHJvcGVydHkucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIG51bWJlciBvZiBjb21wb25lbnRzIGluIHRoZSBGb3VyaWVyIHNlcmllcy5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TnVtYmVyT2ZDb21wb25lbnRzKCk6IG51bWJlciB7XHJcbiAgICBjb25zdCBjb21wb25lbnRTcGFjaW5nID0gdGhpcy5jb21wb25lbnRTcGFjaW5nUHJvcGVydHkudmFsdWU7XHJcbiAgICBpZiAoIGNvbXBvbmVudFNwYWNpbmcgPT09IDAgKSB7XHJcbiAgICAgIHJldHVybiBJbmZpbml0eTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICByZXR1cm4gTWF0aC5mbG9vciggdGhpcy53YXZlTnVtYmVyUmFuZ2UuZ2V0TGVuZ3RoKCkgLyBjb21wb25lbnRTcGFjaW5nICkgKyAxO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyB0aGUgYW1wbGl0dWRlIG9mIEZvdXJpZXIgY29tcG9uZW50IGssIHVzaW5nIHRoZSBzdGFuZGFyZCBHYXVzc2lhbiBmb3JtdWxhOlxyXG4gICAqXHJcbiAgICogQShrLGswLGRrKSA9IGV4cFsgLSgoay1rMCleMikgLyAoMiAqIChka14yKSApICBdIC8gKGRrICogc3FydCggMnBpICkpXHJcbiAgICogd2hlcmUgayA9IHdhdmUgbnVtYmVyLCBrMCA9IHdhdmUgcGFja2V0IGNlbnRlciwgZGsgPSBzdGFuZGFyZCBkZXZpYXRpb24gb2Ygd2lkdGhcclxuICAgKlxyXG4gICAqIE5vdGUgdGhhdCBzeW1ib2wgayB1c2VkIGluIHRoZSBmb3JtdWxhIGFib3ZlIGlzIHNwZWNpZmljIHRvIHRoZSBzcGFjZSBEb21haW4sIGFuZCBpcyBpbiByYWQvbS5cclxuICAgKiBCdXQgdGhpcyBtZXRob2QgY2FuIGFsc28gYmUgdXNlZCBmb3IgdGhlIHRpbWUgRG9tYWluIChvbWVnYSwgaW4gcmFkL21zKSwgYmVjYXVzZSBMID09PSBUID09PSAxLlxyXG4gICAqXHJcbiAgICogVGhpcyB3YXMgcG9ydGVkIGZyb20gdGhlIGdldEFtcGxpdHVkZSBtZXRob2QgaW4gR2F1c3NpYW5XYXZlUGFja2V0LmphdmEuXHJcbiAgICovXHJcbiAgcHVibGljIGdldENvbXBvbmVudEFtcGxpdHVkZSggd2F2ZU51bWJlcjogbnVtYmVyICk6IG51bWJlciB7XHJcbiAgICBjb25zdCBjZW50ZXIgPSB0aGlzLmNlbnRlclByb3BlcnR5LnZhbHVlO1xyXG4gICAgY29uc3Qgc2lnbWEgPSB0aGlzLnN0YW5kYXJkRGV2aWF0aW9uUHJvcGVydHkudmFsdWU7XHJcbiAgICByZXR1cm4gTWF0aC5leHAoIC0oICggd2F2ZU51bWJlciAtIGNlbnRlciApICogKCB3YXZlTnVtYmVyIC0gY2VudGVyICkgKSAvICggMiAqIHNpZ21hICogc2lnbWEgKSApIC9cclxuICAgICAgICAgICAoIHNpZ21hICogTWF0aC5zcXJ0KCAyICogTWF0aC5QSSApICk7XHJcbiAgfVxyXG59XHJcblxyXG5mb3VyaWVyTWFraW5nV2F2ZXMucmVnaXN0ZXIoICdXYXZlUGFja2V0JywgV2F2ZVBhY2tldCApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsY0FBYyxNQUFNLHVDQUF1QztBQUVsRSxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBRS9DLE9BQU9DLE9BQU8sTUFBTSx3Q0FBd0M7QUFDNUQsT0FBT0MsZ0JBQWdCLE1BQU0saURBQWlEO0FBQzlFLE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsT0FBT0Msa0JBQWtCLE1BQU0sNkJBQTZCO0FBQzVELE9BQU9DLGdCQUFnQixNQUFNLHVCQUF1Qjs7QUFFcEQ7QUFDQSxNQUFNQyx3QkFBd0IsR0FBRyxDQUFFLENBQUMsRUFBRUMsSUFBSSxDQUFDQyxFQUFFLEdBQUcsQ0FBQyxFQUFFRCxJQUFJLENBQUNDLEVBQUUsR0FBRyxDQUFDLEVBQUVELElBQUksQ0FBQ0MsRUFBRSxDQUFFO0FBQ3pFQyxNQUFNLElBQUlB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