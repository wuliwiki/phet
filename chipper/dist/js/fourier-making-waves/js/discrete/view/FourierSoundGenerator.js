// Copyright 2020-2023, University of Colorado Boulder

/**
 * FourierSoundGenerator generates sound for a Fourier series.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Multilink from '../../../../axon/js/Multilink.js';
import LinearFunction from '../../../../dot/js/LinearFunction.js';
import Range from '../../../../dot/js/Range.js';
import OscillatorSoundGenerator from '../../../../tambo/js/sound-generators/OscillatorSoundGenerator.js';
import SoundGenerator from '../../../../tambo/js/sound-generators/SoundGenerator.js';
import soundManager from '../../../../tambo/js/soundManager.js';
import FMWConstants from '../../common/FMWConstants.js';
import FourierSeries from '../../common/model/FourierSeries.js';
import fourierMakingWaves from '../../fourierMakingWaves.js';

// Output level range of each harmonic. These have a reduced range because harmonics are summed.
// See https://github.com/phetsims/fourier-making-waves/issues/45
const HARMONIC_OUTPUT_LEVEL_RANGE = new Range(-1 / FMWConstants.MAX_HARMONICS, 1 / FMWConstants.MAX_HARMONICS);
export default class FourierSoundGenerator extends SoundGenerator {
  /**
   * @param {FourierSeries} fourierSeries
   */
  constructor(fourierSeries) {
    assert && assert(fourierSeries instanceof FourierSeries);
    super({
      // OscillatorSoundGenerator options
      initialOutputLevel: fourierSeries.soundOutputLevelProperty.value
    });

    // Maps amplitude to an output level that is appropriate for SoundGenerator.
    const amplitudeToOutputLevel = new LinearFunction(fourierSeries.amplitudeRange.min, fourierSeries.amplitudeRange.max, HARMONIC_OUTPUT_LEVEL_RANGE.min, HARMONIC_OUTPUT_LEVEL_RANGE.max);

    // {OscillatorSoundGenerator[]} Create an oscillator for each harmonic.
    // Using for loop here instead of map, because we need to connect each OscillatorSoundGenerator to the
    // masterGainNode, and map should not have side-effects.
    const oscillatorSoundGenerators = [];
    for (let i = 0; i < fourierSeries.harmonics.length; i++) {
      const harmonic = fourierSeries.harmonics[i];
      const oscillatorSoundGenerator = new OscillatorSoundGenerator({
        initialFrequency: harmonic.frequency,
        initialOutputLevel: amplitudeToOutputLevel.evaluate(harmonic.amplitudeProperty.value)
      });
      oscillatorSoundGenerator.connect(this.masterGainNode);
      oscillatorSoundGenerators.push(oscillatorSoundGenerator);
    }

    // Set amplitudes for harmonics.
    fourierSeries.amplitudesProperty.lazyLink(amplitudes => {
      // If audio is disabled, update immediately by using optional timeConstant=0. This cancels scheduled values on
      // the master gain node. If we do not do this, then we'll briefly hear stale output levels the next time that
      // oscillatorSoundGenerator.play is called.
      // See https://github.com/phetsims/fourier-making-waves/issues/45
      const timeConstant = fourierSeries.soundEnabledProperty.value ? undefined : 0;

      // Set amplitudes for the harmonics.
      for (let i = 0; i < amplitudes.length; i++) {
        oscillatorSoundGenerators[i].setOutputLevel(amplitudeToOutputLevel.evaluate(amplitudes[i]), timeConstant);
      }
    });

    // Set the master output level.
    fourierSeries.soundOutputLevelProperty.link(outputLevel => {
      // See comment above about timeConstant.
      const timeConstant = fourierSeries.soundEnabledProperty.value ? undefined : 0;
      this.setOutputLevel(outputLevel, timeConstant);
    });

    // Turn sound on/off. We could have controlled this via options.enableControlProperties,
    // but stopping OscillatorSoundGenerators may use fewer resources.
    fourierSeries.soundEnabledProperty.link(enabled => {
      if (enabled) {
        oscillatorSoundGenerators.forEach(oscillatorSoundGenerator => oscillatorSoundGenerator.play());
      } else {
        oscillatorSoundGenerators.forEach(oscillatorSoundGenerator => oscillatorSoundGenerator.stop());
      }
    });

    // When the FourierSoundGenerator is producing audible sound, duck all user-interface sounds.
    const userInterfaceDefaultOutputLevel = soundManager.getOutputLevelForCategory('user-interface');
    Multilink.multilink([this.fullyEnabledProperty, fourierSeries.soundEnabledProperty], (soundGeneratorFullyEnabled, enabled) => {
      const soundIsAudible = soundGeneratorFullyEnabled && enabled;
      const outputLevel = soundIsAudible ? 0.1 * userInterfaceDefaultOutputLevel : userInterfaceDefaultOutputLevel;
      soundManager.setOutputLevelForCategory('user-interface', outputLevel);
    });
  }

  /**
   * @public
   * @override
   */
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
}
fourierMakingWaves.register('FourierSoundGenerator', FourierSoundGenerator);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJMaW5lYXJGdW5jdGlvbiIsIlJhbmdlIiwiT3NjaWxsYXRvclNvdW5kR2VuZXJhdG9yIiwiU291bmRHZW5lcmF0b3IiLCJzb3VuZE1hbmFnZXIiLCJGTVdDb25zdGFudHMiLCJGb3VyaWVyU2VyaWVzIiwiZm91cmllck1ha2luZ1dhdmVzIiwiSEFSTU9OSUNfT1VUUFVUX0xFVkVMX1JBTkdFIiwiTUFYX0hBUk1PTklDUyIsIkZvdXJpZXJTb3VuZEdlbmVyYXRvciIsImNvbnN0cnVjdG9yIiwiZm91cmllclNlcmllcyIsImFzc2VydCIsImluaXRpYWxPdXRwdXRMZXZlbCIsInNvdW5kT3V0cHV0TGV2ZWxQcm9wZXJ0eSIsInZhbHVlIiwiYW1wbGl0dWRlVG9PdXRwdXRMZXZlbCIsImFtcGxpdHVkZVJhbmdlIiwibWluIiwibWF4Iiwib3NjaWxsYXRvclNvdW5kR2VuZXJhdG9ycyIsImkiLCJoYXJtb25pY3MiLCJsZW5ndGgiLCJoYXJtb25pYyIsIm9zY2lsbGF0b3JTb3VuZEdlbmVyYXRvciIsImluaXRpYWxGcmVxdWVuY3kiLCJmcmVxdWVuY3kiLCJldmFsdWF0ZSIsImFtcGxpdHVkZVByb3BlcnR5IiwiY29ubmVjdCIsIm1hc3RlckdhaW5Ob2RlIiwicHVzaCIsImFtcGxpdHVkZXNQcm9wZXJ0eSIsImxhenlMaW5rIiwiYW1wbGl0dWRlcyIsInRpbWVDb25zdGFudCIsInNvdW5kRW5hYmxlZFByb3BlcnR5IiwidW5kZWZpbmVkIiwic2V0T3V0cHV0TGV2ZWwiLCJsaW5rIiwib3V0cHV0TGV2ZWwiLCJlbmFibGVkIiwiZm9yRWFjaCIsInBsYXkiLCJzdG9wIiwidXNlckludGVyZmFjZURlZmF1bHRPdXRwdXRMZXZlbCIsImdldE91dHB1dExldmVsRm9yQ2F0ZWdvcnkiLCJtdWx0aWxpbmsiLCJmdWxseUVuYWJsZWRQcm9wZXJ0eSIsInNvdW5kR2VuZXJhdG9yRnVsbHlFbmFibGVkIiwic291bmRJc0F1ZGlibGUiLCJzZXRPdXRwdXRMZXZlbEZvckNhdGVnb3J5IiwiZGlzcG9zZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRm91cmllclNvdW5kR2VuZXJhdG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIwLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEZvdXJpZXJTb3VuZEdlbmVyYXRvciBnZW5lcmF0ZXMgc291bmQgZm9yIGEgRm91cmllciBzZXJpZXMuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCBMaW5lYXJGdW5jdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvTGluZWFyRnVuY3Rpb24uanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IE9zY2lsbGF0b3JTb3VuZEdlbmVyYXRvciBmcm9tICcuLi8uLi8uLi8uLi90YW1iby9qcy9zb3VuZC1nZW5lcmF0b3JzL09zY2lsbGF0b3JTb3VuZEdlbmVyYXRvci5qcyc7XHJcbmltcG9ydCBTb3VuZEdlbmVyYXRvciBmcm9tICcuLi8uLi8uLi8uLi90YW1iby9qcy9zb3VuZC1nZW5lcmF0b3JzL1NvdW5kR2VuZXJhdG9yLmpzJztcclxuaW1wb3J0IHNvdW5kTWFuYWdlciBmcm9tICcuLi8uLi8uLi8uLi90YW1iby9qcy9zb3VuZE1hbmFnZXIuanMnO1xyXG5pbXBvcnQgRk1XQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9GTVdDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgRm91cmllclNlcmllcyBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvRm91cmllclNlcmllcy5qcyc7XHJcbmltcG9ydCBmb3VyaWVyTWFraW5nV2F2ZXMgZnJvbSAnLi4vLi4vZm91cmllck1ha2luZ1dhdmVzLmpzJztcclxuXHJcbi8vIE91dHB1dCBsZXZlbCByYW5nZSBvZiBlYWNoIGhhcm1vbmljLiBUaGVzZSBoYXZlIGEgcmVkdWNlZCByYW5nZSBiZWNhdXNlIGhhcm1vbmljcyBhcmUgc3VtbWVkLlxyXG4vLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2ZvdXJpZXItbWFraW5nLXdhdmVzL2lzc3Vlcy80NVxyXG5jb25zdCBIQVJNT05JQ19PVVRQVVRfTEVWRUxfUkFOR0UgPSBuZXcgUmFuZ2UoIC0xIC8gRk1XQ29uc3RhbnRzLk1BWF9IQVJNT05JQ1MsIDEgLyBGTVdDb25zdGFudHMuTUFYX0hBUk1PTklDUyApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm91cmllclNvdW5kR2VuZXJhdG9yIGV4dGVuZHMgU291bmRHZW5lcmF0b3Ige1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0ZvdXJpZXJTZXJpZXN9IGZvdXJpZXJTZXJpZXNcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggZm91cmllclNlcmllcyApIHtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmb3VyaWVyU2VyaWVzIGluc3RhbmNlb2YgRm91cmllclNlcmllcyApO1xyXG5cclxuICAgIHN1cGVyKCB7XHJcblxyXG4gICAgICAvLyBPc2NpbGxhdG9yU291bmRHZW5lcmF0b3Igb3B0aW9uc1xyXG4gICAgICBpbml0aWFsT3V0cHV0TGV2ZWw6IGZvdXJpZXJTZXJpZXMuc291bmRPdXRwdXRMZXZlbFByb3BlcnR5LnZhbHVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gTWFwcyBhbXBsaXR1ZGUgdG8gYW4gb3V0cHV0IGxldmVsIHRoYXQgaXMgYXBwcm9wcmlhdGUgZm9yIFNvdW5kR2VuZXJhdG9yLlxyXG4gICAgY29uc3QgYW1wbGl0dWRlVG9PdXRwdXRMZXZlbCA9IG5ldyBMaW5lYXJGdW5jdGlvbihcclxuICAgICAgZm91cmllclNlcmllcy5hbXBsaXR1ZGVSYW5nZS5taW4sIGZvdXJpZXJTZXJpZXMuYW1wbGl0dWRlUmFuZ2UubWF4LFxyXG4gICAgICBIQVJNT05JQ19PVVRQVVRfTEVWRUxfUkFOR0UubWluLCBIQVJNT05JQ19PVVRQVVRfTEVWRUxfUkFOR0UubWF4XHJcbiAgICApO1xyXG5cclxuICAgIC8vIHtPc2NpbGxhdG9yU291bmRHZW5lcmF0b3JbXX0gQ3JlYXRlIGFuIG9zY2lsbGF0b3IgZm9yIGVhY2ggaGFybW9uaWMuXHJcbiAgICAvLyBVc2luZyBmb3IgbG9vcCBoZXJlIGluc3RlYWQgb2YgbWFwLCBiZWNhdXNlIHdlIG5lZWQgdG8gY29ubmVjdCBlYWNoIE9zY2lsbGF0b3JTb3VuZEdlbmVyYXRvciB0byB0aGVcclxuICAgIC8vIG1hc3RlckdhaW5Ob2RlLCBhbmQgbWFwIHNob3VsZCBub3QgaGF2ZSBzaWRlLWVmZmVjdHMuXHJcbiAgICBjb25zdCBvc2NpbGxhdG9yU291bmRHZW5lcmF0b3JzID0gW107XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBmb3VyaWVyU2VyaWVzLmhhcm1vbmljcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgaGFybW9uaWMgPSBmb3VyaWVyU2VyaWVzLmhhcm1vbmljc1sgaSBdO1xyXG4gICAgICBjb25zdCBvc2NpbGxhdG9yU291bmRHZW5lcmF0b3IgPSBuZXcgT3NjaWxsYXRvclNvdW5kR2VuZXJhdG9yKCB7XHJcbiAgICAgICAgaW5pdGlhbEZyZXF1ZW5jeTogaGFybW9uaWMuZnJlcXVlbmN5LFxyXG4gICAgICAgIGluaXRpYWxPdXRwdXRMZXZlbDogYW1wbGl0dWRlVG9PdXRwdXRMZXZlbC5ldmFsdWF0ZSggaGFybW9uaWMuYW1wbGl0dWRlUHJvcGVydHkudmFsdWUgKVxyXG4gICAgICB9ICk7XHJcbiAgICAgIG9zY2lsbGF0b3JTb3VuZEdlbmVyYXRvci5jb25uZWN0KCB0aGlzLm1hc3RlckdhaW5Ob2RlICk7XHJcbiAgICAgIG9zY2lsbGF0b3JTb3VuZEdlbmVyYXRvcnMucHVzaCggb3NjaWxsYXRvclNvdW5kR2VuZXJhdG9yICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2V0IGFtcGxpdHVkZXMgZm9yIGhhcm1vbmljcy5cclxuICAgIGZvdXJpZXJTZXJpZXMuYW1wbGl0dWRlc1Byb3BlcnR5LmxhenlMaW5rKCBhbXBsaXR1ZGVzID0+IHtcclxuXHJcbiAgICAgIC8vIElmIGF1ZGlvIGlzIGRpc2FibGVkLCB1cGRhdGUgaW1tZWRpYXRlbHkgYnkgdXNpbmcgb3B0aW9uYWwgdGltZUNvbnN0YW50PTAuIFRoaXMgY2FuY2VscyBzY2hlZHVsZWQgdmFsdWVzIG9uXHJcbiAgICAgIC8vIHRoZSBtYXN0ZXIgZ2FpbiBub2RlLiBJZiB3ZSBkbyBub3QgZG8gdGhpcywgdGhlbiB3ZSdsbCBicmllZmx5IGhlYXIgc3RhbGUgb3V0cHV0IGxldmVscyB0aGUgbmV4dCB0aW1lIHRoYXRcclxuICAgICAgLy8gb3NjaWxsYXRvclNvdW5kR2VuZXJhdG9yLnBsYXkgaXMgY2FsbGVkLlxyXG4gICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2ZvdXJpZXItbWFraW5nLXdhdmVzL2lzc3Vlcy80NVxyXG4gICAgICBjb25zdCB0aW1lQ29uc3RhbnQgPSBmb3VyaWVyU2VyaWVzLnNvdW5kRW5hYmxlZFByb3BlcnR5LnZhbHVlID8gdW5kZWZpbmVkIDogMDtcclxuXHJcbiAgICAgIC8vIFNldCBhbXBsaXR1ZGVzIGZvciB0aGUgaGFybW9uaWNzLlxyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBhbXBsaXR1ZGVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgIG9zY2lsbGF0b3JTb3VuZEdlbmVyYXRvcnNbIGkgXS5zZXRPdXRwdXRMZXZlbCggYW1wbGl0dWRlVG9PdXRwdXRMZXZlbC5ldmFsdWF0ZSggYW1wbGl0dWRlc1sgaSBdICksIHRpbWVDb25zdGFudCApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gU2V0IHRoZSBtYXN0ZXIgb3V0cHV0IGxldmVsLlxyXG4gICAgZm91cmllclNlcmllcy5zb3VuZE91dHB1dExldmVsUHJvcGVydHkubGluayggb3V0cHV0TGV2ZWwgPT4ge1xyXG5cclxuICAgICAgLy8gU2VlIGNvbW1lbnQgYWJvdmUgYWJvdXQgdGltZUNvbnN0YW50LlxyXG4gICAgICBjb25zdCB0aW1lQ29uc3RhbnQgPSBmb3VyaWVyU2VyaWVzLnNvdW5kRW5hYmxlZFByb3BlcnR5LnZhbHVlID8gdW5kZWZpbmVkIDogMDtcclxuICAgICAgdGhpcy5zZXRPdXRwdXRMZXZlbCggb3V0cHV0TGV2ZWwsIHRpbWVDb25zdGFudCApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFR1cm4gc291bmQgb24vb2ZmLiBXZSBjb3VsZCBoYXZlIGNvbnRyb2xsZWQgdGhpcyB2aWEgb3B0aW9ucy5lbmFibGVDb250cm9sUHJvcGVydGllcyxcclxuICAgIC8vIGJ1dCBzdG9wcGluZyBPc2NpbGxhdG9yU291bmRHZW5lcmF0b3JzIG1heSB1c2UgZmV3ZXIgcmVzb3VyY2VzLlxyXG4gICAgZm91cmllclNlcmllcy5zb3VuZEVuYWJsZWRQcm9wZXJ0eS5saW5rKCBlbmFibGVkID0+IHtcclxuICAgICAgaWYgKCBlbmFibGVkICkge1xyXG4gICAgICAgIG9zY2lsbGF0b3JTb3VuZEdlbmVyYXRvcnMuZm9yRWFjaCggb3NjaWxsYXRvclNvdW5kR2VuZXJhdG9yID0+IG9zY2lsbGF0b3JTb3VuZEdlbmVyYXRvci5wbGF5KCkgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBvc2NpbGxhdG9yU291bmRHZW5lcmF0b3JzLmZvckVhY2goIG9zY2lsbGF0b3JTb3VuZEdlbmVyYXRvciA9PiBvc2NpbGxhdG9yU291bmRHZW5lcmF0b3Iuc3RvcCgpICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBXaGVuIHRoZSBGb3VyaWVyU291bmRHZW5lcmF0b3IgaXMgcHJvZHVjaW5nIGF1ZGlibGUgc291bmQsIGR1Y2sgYWxsIHVzZXItaW50ZXJmYWNlIHNvdW5kcy5cclxuICAgIGNvbnN0IHVzZXJJbnRlcmZhY2VEZWZhdWx0T3V0cHV0TGV2ZWwgPSBzb3VuZE1hbmFnZXIuZ2V0T3V0cHV0TGV2ZWxGb3JDYXRlZ29yeSggJ3VzZXItaW50ZXJmYWNlJyApO1xyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayhcclxuICAgICAgWyB0aGlzLmZ1bGx5RW5hYmxlZFByb3BlcnR5LCBmb3VyaWVyU2VyaWVzLnNvdW5kRW5hYmxlZFByb3BlcnR5IF0sXHJcbiAgICAgICggc291bmRHZW5lcmF0b3JGdWxseUVuYWJsZWQsIGVuYWJsZWQgKSA9PiB7XHJcbiAgICAgICAgY29uc3Qgc291bmRJc0F1ZGlibGUgPSAoIHNvdW5kR2VuZXJhdG9yRnVsbHlFbmFibGVkICYmIGVuYWJsZWQgKTtcclxuICAgICAgICBjb25zdCBvdXRwdXRMZXZlbCA9IHNvdW5kSXNBdWRpYmxlID8gMC4xICogdXNlckludGVyZmFjZURlZmF1bHRPdXRwdXRMZXZlbCA6IHVzZXJJbnRlcmZhY2VEZWZhdWx0T3V0cHV0TGV2ZWw7XHJcbiAgICAgICAgc291bmRNYW5hZ2VyLnNldE91dHB1dExldmVsRm9yQ2F0ZWdvcnkoICd1c2VyLWludGVyZmFjZScsIG91dHB1dExldmVsICk7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHVibGljXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICovXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuZm91cmllck1ha2luZ1dhdmVzLnJlZ2lzdGVyKCAnRm91cmllclNvdW5kR2VuZXJhdG9yJywgRm91cmllclNvdW5kR2VuZXJhdG9yICk7Il0sIm1hcHBpbmdz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