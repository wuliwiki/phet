// Copyright 2021-2023, University of Colorado Boulder

/**
 * CalipersNode is a tool used to measure a horizontal dimension. It consists of a horizontal "beam" with a pair of
 * "jaws" at the ends of the beam. The horizontal distance between the jaws is the measured dimension. It also has
 * a label whose position is (somewhat) customizable. The origin of CalipersNode is at the tip of the left jaw.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import { Shape } from '../../../../kite/js/imports.js';
import merge from '../../../../phet-core/js/merge.js';
import BackgroundNode from '../../../../scenery-phet/js/BackgroundNode.js';
import { Node, Path, Rectangle, RichText } from '../../../../scenery/js/imports.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import FMWConstants from '../../common/FMWConstants.js';
import fourierMakingWaves from '../../fourierMakingWaves.js';

// These constants determine the shape of the beam and jaws.
const BEAM_THICKNESS = 5;
const JAWS_THICKNESS = 5;
const JAWS_LENGTH = 20;

// Positions for the label, relative to the calipers.
const VALID_LABEL_POSITIONS = ['above',
// used for the interactive tools
'left' // used for icons in control panels, where we need to conserve vertical space
];

export default class CalipersNode extends Node {
  /**
   * @param {Object} [options]
   */
  constructor(options) {
    options = merge({
      measuredWidth: 100,
      labelPosition: 'above',
      // Path options, for the beamNode subcomponent
      pathOptions: {
        fill: 'white',
        stroke: 'black'
      },
      // RichText options
      richTextOptions: {
        font: FMWConstants.TOOL_LABEL_FONT,
        maxWidth: 50
      },
      // BackgroundNode options
      backgroundNodeOptions: {
        xMargin: 2,
        yMargin: 2
      },
      // phet-io options
      tandem: Tandem.OPTIONAL
    }, options);
    assert && assert(VALID_LABEL_POSITIONS.includes(options.labelPosition));

    // Beam, with jaws at ends.
    const beamAndJawsNode = new Path(null, options.pathOptions);

    // Transparent rectangle that covers beamAndJawsNode, so you can drag by clicking in the space between the calipers.
    // We do this instead of setting pointer areas, so that interactive calipers are also draggable by their label.
    const transparentRectangle = new Rectangle(0, 0, 1, 1, {
      fill: 'transparent'
    });

    // Label above the beam
    const labelText = new RichText('', merge({
      tandem: options.tandem.createTandem('labelText')
    }, options.richTextOptions));

    // Translucent background for the label
    const backgroundNode = new BackgroundNode(labelText, options.backgroundNodeOptions);
    const parentNode = new Node({
      children: [transparentRectangle, beamAndJawsNode, backgroundNode]
    });
    assert && assert(!options.children, 'CalipersNode sets children');
    options.children = [parentNode];
    super(options);

    // @private
    this.beamAndJawsNode = beamAndJawsNode; // {Path}
    this.transparentRectangle = transparentRectangle; // {Rectangle}
    this.labelText = labelText; // {RichText}
    this.backgroundNode = backgroundNode; // {BackgroundNode}
    this.labelPosition = options.labelPosition; // {string}

    this.setMeasuredWidth(options.measuredWidth);
  }

  /**
   * Sets width being measured by the calipers, the horizontal space between the left and right tips of the calipers.
   * @param {number} measuredWidth - in view coordinates
   * @public
   */
  setMeasuredWidth(measuredWidth) {
    // The horizontal beam has ends that are caliper-like.
    // The Shape is described clockwise from the origin (the tip of the left caliper).
    this.beamAndJawsNode.shape = new Shape().moveTo(0, 0).lineTo(-JAWS_THICKNESS, -(JAWS_LENGTH - BEAM_THICKNESS)).lineTo(-JAWS_THICKNESS, -JAWS_LENGTH).lineTo(measuredWidth + JAWS_THICKNESS, -JAWS_LENGTH).lineTo(measuredWidth + JAWS_THICKNESS, -(JAWS_LENGTH - BEAM_THICKNESS)).lineTo(measuredWidth, 0).lineTo(measuredWidth, -(JAWS_LENGTH - BEAM_THICKNESS)).lineTo(0, -(JAWS_LENGTH - BEAM_THICKNESS)).close();

    // Cover the beam with a transparent rectangle, so you can drag by clicking in the space between the calipers.
    this.transparentRectangle.setRect(0, 0, this.beamAndJawsNode.width, this.beamAndJawsNode.height);
    this.transparentRectangle.center = this.beamAndJawsNode.center;
    this.updateLabelPosition();
  }

  /**
   * Sets the fill for the beam and jaws.
   * @param {ColorDef} fill
   * @public
   */
  setBeamAndJawsFill(fill) {
    this.beamAndJawsNode.fill = fill;
  }

  /**
   * Sets the text for the label.
   * @param {string} text - string for RichText
   * @public
   */
  setLabel(text) {
    this.labelText.string = text;
    this.updateLabelPosition();
  }

  /**
   * Centers the label on the horizontal beam.
   * @private
   */
  updateLabelPosition() {
    if (this.labelPosition === 'above') {
      this.backgroundNode.centerX = this.beamAndJawsNode.centerX;
      this.backgroundNode.bottom = this.beamAndJawsNode.top - 2;
    } else {
      this.backgroundNode.right = this.beamAndJawsNode.left - 5;
      this.backgroundNode.centerY = this.beamAndJawsNode.centerY;
    }
  }
}
fourierMakingWaves.register('CalipersNode', CalipersNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaGFwZSIsIm1lcmdlIiwiQmFja2dyb3VuZE5vZGUiLCJOb2RlIiwiUGF0aCIsIlJlY3RhbmdsZSIsIlJpY2hUZXh0IiwiVGFuZGVtIiwiRk1XQ29uc3RhbnRzIiwiZm91cmllck1ha2luZ1dhdmVzIiwiQkVBTV9USElDS05FU1MiLCJKQVdTX1RISUNLTkVTUyIsIkpBV1NfTEVOR1RIIiwiVkFMSURfTEFCRUxfUE9TSVRJT05TIiwiQ2FsaXBlcnNOb2RlIiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwibWVhc3VyZWRXaWR0aCIsImxhYmVsUG9zaXRpb24iLCJwYXRoT3B0aW9ucyIsImZpbGwiLCJzdHJva2UiLCJyaWNoVGV4dE9wdGlvbnMiLCJmb250IiwiVE9PTF9MQUJFTF9GT05UIiwibWF4V2lkdGgiLCJiYWNrZ3JvdW5kTm9kZU9wdGlvbnMiLCJ4TWFyZ2luIiwieU1hcmdpbiIsInRhbmRlbSIsIk9QVElPTkFMIiwiYXNzZXJ0IiwiaW5jbHVkZXMiLCJiZWFtQW5kSmF3c05vZGUiLCJ0cmFuc3BhcmVudFJlY3RhbmdsZSIsImxhYmVsVGV4dCIsImNyZWF0ZVRhbmRlbSIsImJhY2tncm91bmROb2RlIiwicGFyZW50Tm9kZSIsImNoaWxkcmVuIiwic2V0TWVhc3VyZWRXaWR0aCIsInNoYXBlIiwibW92ZVRvIiwibGluZVRvIiwiY2xvc2UiLCJzZXRSZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJjZW50ZXIiLCJ1cGRhdGVMYWJlbFBvc2l0aW9uIiwic2V0QmVhbUFuZEphd3NGaWxsIiwic2V0TGFiZWwiLCJ0ZXh0Iiwic3RyaW5nIiwiY2VudGVyWCIsImJvdHRvbSIsInRvcCIsInJpZ2h0IiwibGVmdCIsImNlbnRlclkiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNhbGlwZXJzTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBDYWxpcGVyc05vZGUgaXMgYSB0b29sIHVzZWQgdG8gbWVhc3VyZSBhIGhvcml6b250YWwgZGltZW5zaW9uLiBJdCBjb25zaXN0cyBvZiBhIGhvcml6b250YWwgXCJiZWFtXCIgd2l0aCBhIHBhaXIgb2ZcclxuICogXCJqYXdzXCIgYXQgdGhlIGVuZHMgb2YgdGhlIGJlYW0uIFRoZSBob3Jpem9udGFsIGRpc3RhbmNlIGJldHdlZW4gdGhlIGphd3MgaXMgdGhlIG1lYXN1cmVkIGRpbWVuc2lvbi4gSXQgYWxzbyBoYXNcclxuICogYSBsYWJlbCB3aG9zZSBwb3NpdGlvbiBpcyAoc29tZXdoYXQpIGN1c3RvbWl6YWJsZS4gVGhlIG9yaWdpbiBvZiBDYWxpcGVyc05vZGUgaXMgYXQgdGhlIHRpcCBvZiB0aGUgbGVmdCBqYXcuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IEJhY2tncm91bmROb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9CYWNrZ3JvdW5kTm9kZS5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIFBhdGgsIFJlY3RhbmdsZSwgUmljaFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgRk1XQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9GTVdDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgZm91cmllck1ha2luZ1dhdmVzIGZyb20gJy4uLy4uL2ZvdXJpZXJNYWtpbmdXYXZlcy5qcyc7XHJcblxyXG4vLyBUaGVzZSBjb25zdGFudHMgZGV0ZXJtaW5lIHRoZSBzaGFwZSBvZiB0aGUgYmVhbSBhbmQgamF3cy5cclxuY29uc3QgQkVBTV9USElDS05FU1MgPSA1O1xyXG5jb25zdCBKQVdTX1RISUNLTkVTUyA9IDU7XHJcbmNvbnN0IEpBV1NfTEVOR1RIID0gMjA7XHJcblxyXG4vLyBQb3NpdGlvbnMgZm9yIHRoZSBsYWJlbCwgcmVsYXRpdmUgdG8gdGhlIGNhbGlwZXJzLlxyXG5jb25zdCBWQUxJRF9MQUJFTF9QT1NJVElPTlMgPSBbXHJcbiAgJ2Fib3ZlJywgLy8gdXNlZCBmb3IgdGhlIGludGVyYWN0aXZlIHRvb2xzXHJcbiAgJ2xlZnQnIC8vIHVzZWQgZm9yIGljb25zIGluIGNvbnRyb2wgcGFuZWxzLCB3aGVyZSB3ZSBuZWVkIHRvIGNvbnNlcnZlIHZlcnRpY2FsIHNwYWNlXHJcbl07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYWxpcGVyc05vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBvcHRpb25zICkge1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG5cclxuICAgICAgbWVhc3VyZWRXaWR0aDogMTAwLFxyXG4gICAgICBsYWJlbFBvc2l0aW9uOiAnYWJvdmUnLFxyXG5cclxuICAgICAgLy8gUGF0aCBvcHRpb25zLCBmb3IgdGhlIGJlYW1Ob2RlIHN1YmNvbXBvbmVudFxyXG4gICAgICBwYXRoT3B0aW9uczoge1xyXG4gICAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICAgICAgc3Ryb2tlOiAnYmxhY2snXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBSaWNoVGV4dCBvcHRpb25zXHJcbiAgICAgIHJpY2hUZXh0T3B0aW9uczoge1xyXG4gICAgICAgIGZvbnQ6IEZNV0NvbnN0YW50cy5UT09MX0xBQkVMX0ZPTlQsXHJcbiAgICAgICAgbWF4V2lkdGg6IDUwXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBCYWNrZ3JvdW5kTm9kZSBvcHRpb25zXHJcbiAgICAgIGJhY2tncm91bmROb2RlT3B0aW9uczoge1xyXG4gICAgICAgIHhNYXJnaW46IDIsXHJcbiAgICAgICAgeU1hcmdpbjogMlxyXG4gICAgICB9LFxyXG5cclxuICAgICAgLy8gcGhldC1pbyBvcHRpb25zXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLk9QVElPTkFMXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggVkFMSURfTEFCRUxfUE9TSVRJT05TLmluY2x1ZGVzKCBvcHRpb25zLmxhYmVsUG9zaXRpb24gKSApO1xyXG5cclxuICAgIC8vIEJlYW0sIHdpdGggamF3cyBhdCBlbmRzLlxyXG4gICAgY29uc3QgYmVhbUFuZEphd3NOb2RlID0gbmV3IFBhdGgoIG51bGwsIG9wdGlvbnMucGF0aE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBUcmFuc3BhcmVudCByZWN0YW5nbGUgdGhhdCBjb3ZlcnMgYmVhbUFuZEphd3NOb2RlLCBzbyB5b3UgY2FuIGRyYWcgYnkgY2xpY2tpbmcgaW4gdGhlIHNwYWNlIGJldHdlZW4gdGhlIGNhbGlwZXJzLlxyXG4gICAgLy8gV2UgZG8gdGhpcyBpbnN0ZWFkIG9mIHNldHRpbmcgcG9pbnRlciBhcmVhcywgc28gdGhhdCBpbnRlcmFjdGl2ZSBjYWxpcGVycyBhcmUgYWxzbyBkcmFnZ2FibGUgYnkgdGhlaXIgbGFiZWwuXHJcbiAgICBjb25zdCB0cmFuc3BhcmVudFJlY3RhbmdsZSA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIDEsIDEsIHtcclxuICAgICAgZmlsbDogJ3RyYW5zcGFyZW50J1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIExhYmVsIGFib3ZlIHRoZSBiZWFtXHJcbiAgICBjb25zdCBsYWJlbFRleHQgPSBuZXcgUmljaFRleHQoICcnLCBtZXJnZSgge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xhYmVsVGV4dCcgKVxyXG4gICAgfSwgb3B0aW9ucy5yaWNoVGV4dE9wdGlvbnMgKSApO1xyXG5cclxuICAgIC8vIFRyYW5zbHVjZW50IGJhY2tncm91bmQgZm9yIHRoZSBsYWJlbFxyXG4gICAgY29uc3QgYmFja2dyb3VuZE5vZGUgPSBuZXcgQmFja2dyb3VuZE5vZGUoIGxhYmVsVGV4dCwgb3B0aW9ucy5iYWNrZ3JvdW5kTm9kZU9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCBwYXJlbnROb2RlID0gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFsgdHJhbnNwYXJlbnRSZWN0YW5nbGUsIGJlYW1BbmRKYXdzTm9kZSwgYmFja2dyb3VuZE5vZGUgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICFvcHRpb25zLmNoaWxkcmVuLCAnQ2FsaXBlcnNOb2RlIHNldHMgY2hpbGRyZW4nICk7XHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gWyBwYXJlbnROb2RlIF07XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5iZWFtQW5kSmF3c05vZGUgPSBiZWFtQW5kSmF3c05vZGU7IC8vIHtQYXRofVxyXG4gICAgdGhpcy50cmFuc3BhcmVudFJlY3RhbmdsZSA9IHRyYW5zcGFyZW50UmVjdGFuZ2xlOyAvLyB7UmVjdGFuZ2xlfVxyXG4gICAgdGhpcy5sYWJlbFRleHQgPSBsYWJlbFRleHQ7IC8vIHtSaWNoVGV4dH1cclxuICAgIHRoaXMuYmFja2dyb3VuZE5vZGUgPSBiYWNrZ3JvdW5kTm9kZTsgLy8ge0JhY2tncm91bmROb2RlfVxyXG4gICAgdGhpcy5sYWJlbFBvc2l0aW9uID0gb3B0aW9ucy5sYWJlbFBvc2l0aW9uOyAvLyB7c3RyaW5nfVxyXG5cclxuICAgIHRoaXMuc2V0TWVhc3VyZWRXaWR0aCggb3B0aW9ucy5tZWFzdXJlZFdpZHRoICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHdpZHRoIGJlaW5nIG1lYXN1cmVkIGJ5IHRoZSBjYWxpcGVycywgdGhlIGhvcml6b250YWwgc3BhY2UgYmV0d2VlbiB0aGUgbGVmdCBhbmQgcmlnaHQgdGlwcyBvZiB0aGUgY2FsaXBlcnMuXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IG1lYXN1cmVkV2lkdGggLSBpbiB2aWV3IGNvb3JkaW5hdGVzXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHNldE1lYXN1cmVkV2lkdGgoIG1lYXN1cmVkV2lkdGggKSB7XHJcblxyXG4gICAgLy8gVGhlIGhvcml6b250YWwgYmVhbSBoYXMgZW5kcyB0aGF0IGFyZSBjYWxpcGVyLWxpa2UuXHJcbiAgICAvLyBUaGUgU2hhcGUgaXMgZGVzY3JpYmVkIGNsb2Nrd2lzZSBmcm9tIHRoZSBvcmlnaW4gKHRoZSB0aXAgb2YgdGhlIGxlZnQgY2FsaXBlcikuXHJcbiAgICB0aGlzLmJlYW1BbmRKYXdzTm9kZS5zaGFwZSA9IG5ldyBTaGFwZSgpXHJcbiAgICAgIC5tb3ZlVG8oIDAsIDAgKVxyXG4gICAgICAubGluZVRvKCAtSkFXU19USElDS05FU1MsIC0oIEpBV1NfTEVOR1RIIC0gQkVBTV9USElDS05FU1MgKSApXHJcbiAgICAgIC5saW5lVG8oIC1KQVdTX1RISUNLTkVTUywgLUpBV1NfTEVOR1RIIClcclxuICAgICAgLmxpbmVUbyggbWVhc3VyZWRXaWR0aCArIEpBV1NfVEhJQ0tORVNTLCAtSkFXU19MRU5HVEggKVxyXG4gICAgICAubGluZVRvKCBtZWFzdXJlZFdpZHRoICsgSkFXU19USElDS05FU1MsIC0oIEpBV1NfTEVOR1RIIC0gQkVBTV9USElDS05FU1MgKSApXHJcbiAgICAgIC5saW5lVG8oIG1lYXN1cmVkV2lkdGgsIDAgKVxyXG4gICAgICAubGluZVRvKCBtZWFzdXJlZFdpZHRoLCAtKCBKQVdTX0xFTkdUSCAtIEJFQU1fVEhJQ0tORVNTICkgKVxyXG4gICAgICAubGluZVRvKCAwLCAtKCBKQVdTX0xFTkdUSCAtIEJFQU1fVEhJQ0tORVNTICkgKVxyXG4gICAgICAuY2xvc2UoKTtcclxuXHJcbiAgICAvLyBDb3ZlciB0aGUgYmVhbSB3aXRoIGEgdHJhbnNwYXJlbnQgcmVjdGFuZ2xlLCBzbyB5b3UgY2FuIGRyYWcgYnkgY2xpY2tpbmcgaW4gdGhlIHNwYWNlIGJldHdlZW4gdGhlIGNhbGlwZXJzLlxyXG4gICAgdGhpcy50cmFuc3BhcmVudFJlY3RhbmdsZS5zZXRSZWN0KCAwLCAwLCB0aGlzLmJlYW1BbmRKYXdzTm9kZS53aWR0aCwgdGhpcy5iZWFtQW5kSmF3c05vZGUuaGVpZ2h0ICk7XHJcbiAgICB0aGlzLnRyYW5zcGFyZW50UmVjdGFuZ2xlLmNlbnRlciA9IHRoaXMuYmVhbUFuZEphd3NOb2RlLmNlbnRlcjtcclxuXHJcbiAgICB0aGlzLnVwZGF0ZUxhYmVsUG9zaXRpb24oKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIGZpbGwgZm9yIHRoZSBiZWFtIGFuZCBqYXdzLlxyXG4gICAqIEBwYXJhbSB7Q29sb3JEZWZ9IGZpbGxcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc2V0QmVhbUFuZEphd3NGaWxsKCBmaWxsICkge1xyXG4gICAgdGhpcy5iZWFtQW5kSmF3c05vZGUuZmlsbCA9IGZpbGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSB0ZXh0IGZvciB0aGUgbGFiZWwuXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQgLSBzdHJpbmcgZm9yIFJpY2hUZXh0XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHNldExhYmVsKCB0ZXh0ICkge1xyXG4gICAgdGhpcy5sYWJlbFRleHQuc3RyaW5nID0gdGV4dDtcclxuICAgIHRoaXMudXBkYXRlTGFiZWxQb3NpdGlvbigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2VudGVycyB0aGUgbGFiZWwgb24gdGhlIGhvcml6b250YWwgYmVhbS5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIHVwZGF0ZUxhYmVsUG9zaXRpb24oKSB7XHJcbiAgICBpZiAoIHRoaXMubGFiZWxQb3NpdGlvbiA9PT0gJ2Fib3ZlJyApIHtcclxuICAgICAgdGhpcy5iYWNrZ3JvdW5kTm9kZS5jZW50ZXJYID0gdGhpcy5iZWFtQW5kSmF3c05vZGUuY2VudGVyWDtcclxuICAgICAgdGhpcy5iYWNrZ3JvdW5kTm9kZS5ib3R0b20gPSB0aGlzLmJlYW1BbmRKYXdzTm9kZS50b3AgLSAyO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMuYmFja2dyb3VuZE5vZGUucmlnaHQgPSB0aGlzLmJlYW1BbmRKYXdzTm9kZS5sZWZ0IC0gNTtcclxuICAgICAgdGhpcy5iYWNrZ3JvdW5kTm9kZS5jZW50ZXJZID0gdGhpcy5iZWFtQW5kSmF3c05vZGUuY2VudGVyWTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZvdXJpZXJNYWtpbmdXYXZlcy5yZWdpc3RlciggJ0NhbGlwZXJzTm9kZScsIENhbGlwZXJzTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBU0EsS0FBSyxRQUFRLGdDQUFnQztBQUN0RCxPQUFPQyxLQUFLLE1BQU0sbUNBQW1DO0FBQ3JELE9BQU9DLGNBQWMsTUFBTSwrQ0FBK0M7QUFDMUUsU0FBU0MsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLFNBQVMsRUFBRUMsUUFBUSxRQUFRLG1DQUFtQztBQUNuRixPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBQ3BELE9BQU9DLFlBQVksTUFBTSw4QkFBOEI7QUFDdkQsT0FBT0Msa0JBQWtCLE1BQU0sNkJBQTZCOztBQUU1RDtBQUNBLE1BQU1DLGNBQWMsR0FBRyxDQUFDO0FBQ3hCLE1BQU1DLGNBQWMsR0FBRyxDQUFDO0FBQ3hCLE1BQU1DLFdBQVcsR0FBRyxFQUFFOztBQUV0QjtBQUNBLE1BQU1DLHFCQUFxQixHQUFHLENBQzVCLE9BQU87QUFBRTtBQUNULE1BQU0sQ0FBQztBQUFBLENBQ1I7O0FBRUQsZUFB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