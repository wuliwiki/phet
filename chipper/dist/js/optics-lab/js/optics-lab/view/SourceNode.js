// Copyright 2015-2022, University of Colorado Boulder

/**
 * Node for Source of light, which is either a fan of rays (point source)
 * or a parallel beam of rays
 *
 * @author Michael Dubson (PhET Interactive Simulations)
 */

import Property from '../../../../axon/js/Property.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import { Circle, Node, Path, Rectangle, SimpleDragHandler } from '../../../../scenery/js/imports.js';
import opticsLab from '../../opticsLab.js';
import Type from '../model/Type.js';
import OpticsLabConstants from '../OpticsLabConstants.js';

// constants
const MAXIMUM_LIGHT_RAYS = OpticsLabConstants.MAXIMUM_LIGHT_RAYS;
class SourceNode extends Node {
  /**
   * @param {OpticsLabModel} mainModel
   * @param {SourceModel} sourceModel
   * @param {OpticsLabScreenView} mainView
   */
  constructor(mainModel, sourceModel, mainView) {
    super({
      // Show a cursor hand over the bar magnet
      cursor: 'pointer'
    });
    this.colorProperty = new Property('white'); //sets color of rays
    this.mainModel = mainModel;
    this.pieceModel = sourceModel; //need generic name because need to loop over all pieces and have pieceModel
    this.type = sourceModel.type;
    this.relativeRayStarts = []; //starting positions, relative to source center, of each ray
    this.rayNodes = []; //array of rayNodes, a rayNode is a path of a ray from source through components to end
    this.counter = 0; //for testing only
    this.settingHeight = false; //flag used to prevent conflicting calls to set angle of translation handle
    // Call the super constructor

    // Draw a handle
    const height = sourceModel.height; //if type = Type.BEAM_SOURCE
    const angle = sourceModel.angleProperty.value;
    this.translationHandle;
    this.rotationHandle = new Node();
    if (sourceModel.type === Type.FAN_SOURCE) {
      this.translationHandle = new Circle(20, {
        x: 0,
        y: 0,
        fill: '#8F8'
      });
    } else if (sourceModel.type === Type.BEAM_SOURCE) {
      this.translationHandle = new Rectangle(-5, -height / 2, 10, height, {
        fill: '#8F8',
        cursor: 'pointer'
      });
      this.rotationHandle = new Circle(5, {
        x: Math.sin(angle) * height / 2,
        y: Math.cos(angle) * height / 2,
        fill: 'yellow'
      });
      this.addChild(this.rotationHandle);
    }
    this.insertChild(0, this.translationHandle);
    const rayOptionsObject = {
      stroke: 'black',
      lineWidth: 1.5,
      lineJoin: 'bevel'
    }; //, lineDash: [ 5, 1 ]
    for (let r = 0; r < MAXIMUM_LIGHT_RAYS; r++) {
      this.rayNodes[r] = new Path(new Shape(), rayOptionsObject);
      this.addChild(this.rayNodes[r]);
    }

    // When dragging, move the sample element
    let mouseDownPosition;
    this.translationHandle.addInputListener(new SimpleDragHandler({
      // When dragging across it in a mobile device, pick it up
      allowTouchSnag: true,
      start: e => {
        mainView.setSelectedPiece(this);
        const position = this.globalToParentPoint(e.pointer.point);
        const currentNodePos = this.pieceModel.positionProperty.value;
        mouseDownPosition = position.minus(currentNodePos);
      },
      drag: e => {
        let position = this.globalToParentPoint(e.pointer.point);
        position = position.minus(mouseDownPosition);
        this.pieceModel.setPosition(position);
      },
      end: e => {
        const position = this.globalToParentPoint(e.pointer.point);
        if (mainView.toolDrawerPanel.visibleBounds.containsCoordinates(position.x, position.y)) {
          mainView.removePiece(this);
        }
      }
    })); //end translationHandle.addInputListener()

    this.rotationHandle.addInputListener(new SimpleDragHandler({
      allowTouchSnag: true,
      //start function for testing only
      start: e => {
        mainView.setSelectedPiece(this);
      },
      drag: e => {
        const mousePosRelative = this.translationHandle.globalToParentPoint(e.pointer.point); //returns Vector2
        const angle = mousePosRelative.angle - Math.PI / 2; //angle = 0 when beam horizontal, CW is + angle
        this.pieceModel.setAngle(angle);
      }
    })); //end this.rotationHandle.addInputListener()

    // Register for synchronization with pieceModel and mainModel.
    sourceModel.positionProperty.link(position => {
      this.translation = position;
    });
    sourceModel.angleProperty.link(angle => {
      if (!this.settingHeight) {
        this.translationHandle.rotation = angle;
      }
      const cosAngle = Math.cos(angle);
      const sinAngle = Math.sin(angle);
      const height = this.pieceModel.height;
      this.rotationHandle.translation = new Vector2(-(height / 2) * sinAngle, height / 2 * cosAngle);
    });
    sourceModel.nbrOfRaysProperty.link(nbrOfRays => {
      this.setRayNodes(nbrOfRays);
      this.mainModel.processRays();
    });
    sourceModel.spreadProperty.link(() => {
      if (this.type === Type.FAN_SOURCE) {
        this.setRayNodes();
        this.mainModel.processRays();
      }
    });
    sourceModel.widthProperty.link(width => {
      if (this.type === Type.BEAM_SOURCE) {
        this.setWidth(width);
        this.setRayNodes();
        this.mainModel.processRays();
      }
    });
    this.mainModel.processRaysCountProperty.link(() => {
      this.drawRays();
    });
    this.colorProperty.link(color => {
      let colorCode; //switch ( color )
      switch (color) {
        case 'white':
          colorCode = '#fff';
          break;
        case 'green':
          colorCode = '#0f0';
          break;
        case 'red':
          colorCode = '#f00';
          break;
        case 'yellow':
          colorCode = '#ff0';
          break;
        default:
          throw new Error(`invalid color: ${color}`);
      }
      for (let i = 0; i < MAXIMUM_LIGHT_RAYS; i++) {
        this.rayNodes[i].strokeColor = colorCode;
      }
    });
  }

  /**
   *
   * @param {number} nbrOfRays
   * @private
   */
  setRayNodes(nbrOfRays) {
    //this.translationHandle.removeAllChildren();
    //this.rayNodes = [];
    nbrOfRays = Utils.roundSymmetric(nbrOfRays);
    for (let i = nbrOfRays; i < MAXIMUM_LIGHT_RAYS; i++) {
      this.rayNodes[i].visible = false;
    }
    const maxRayLength = OpticsLabConstants.MAXIMUM_RAY_LENGTH;
    //var rayFontObject = { stroke: 'white', lineWidth: 2 } ;
    for (let r = 0; r < this.pieceModel.rayPaths.length; r++) {
      this.rayNodes[r].visible = true;
      const dir = this.pieceModel.rayPaths[r].startDir;
      const sourceCenter = this.pieceModel.positionProperty.value;
      if (this.pieceModel.rayPaths[r].segments.length === 0) {
        return;
      }
      const AbsoluteRayStart = this.pieceModel.rayPaths[r].segments[0].getStart();
      const AbsoluteRayEnd = this.pieceModel.rayPaths[r].segments[0].getEnd();
      const relativeRayStart = AbsoluteRayStart.minus(sourceCenter);
      const relativeRayEnd = AbsoluteRayEnd.minus(sourceCenter);
      const rayShape = new Shape();
      rayShape.moveToPoint(relativeRayStart);
      if (this.pieceModel.type === Type.FAN_SOURCE) {
        this.relativeRayStarts[r] = relativeRayStart;
        const relativeEndPt = dir.timesScalar(maxRayLength);
        rayShape.lineToPoint(relativeEndPt);

        //var rayNode = new Line( new Vector2( 0, 0 ), dir.timesScalar( maxRayLength ), rayFontObject );
      } else if (this.pieceModel.type === Type.BEAM_SOURCE) {
        this.relativeRayStarts[r] = relativeRayStart;
        rayShape.lineToPoint(relativeRayEnd);
      }
      this.rayNodes[r].setShape(rayShape);
    } //end rayPath loop
  }

  /**
   * @private
   */
  drawRays() {
    for (let i = 0; i < this.pieceModel.rayPaths.length; i++) {
      const shape = this.pieceModel.rayPaths[i].getRelativeShape(); //getShape();
      this.rayNodes[i].setShape(shape);
    }
  }

  /**
   * Sets the width of the beam source
   * @param {number} height
   * @private
   */
  setWidth(height) {
    this.settingHeight = true;
    const cosAngle = Math.cos(this.pieceModel.angleProperty.value);
    const sinAngle = Math.sin(this.pieceModel.angleProperty.value);
    this.translationHandle.rotation = 0;
    //
    this.translationHandle.setRect(-5, -height / 2, 10, height);
    this.translationHandle.rotation = this.pieceModel.angleProperty.value;
    this.rotationHandle.translation = new Vector2(-height / 2 * sinAngle, height / 2 * cosAngle);
    this.settingHeight = false;
  }

  /**
   * sets the color of the light rays
   * @param {string|Color} color
   * @private
   */
  setColor(color) {
    for (let i = 0; i < this.pieceModel.rayPaths.length; i++) {
      this.rayNodes[i].strokeColor = color;
    }
  }
}
opticsLab.register('SourceNode', SourceNode);
export default SourceNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIlV0aWxzIiwiVmVjdG9yMiIsIlNoYXBlIiwiQ2lyY2xlIiwiTm9kZSIsIlBhdGgiLCJSZWN0YW5nbGUiLCJTaW1wbGVEcmFnSGFuZGxlciIsIm9wdGljc0xhYiIsIlR5cGUiLCJPcHRpY3NMYWJDb25zdGFudHMiLCJNQVhJTVVNX0xJR0hUX1JBWVMiLCJTb3VyY2VOb2RlIiwiY29uc3RydWN0b3IiLCJtYWluTW9kZWwiLCJzb3VyY2VNb2RlbCIsIm1haW5WaWV3IiwiY3Vyc29yIiwiY29sb3JQcm9wZXJ0eSIsInBpZWNlTW9kZWwiLCJ0eXBlIiwicmVsYXRpdmVSYXlTdGFydHMiLCJyYXlOb2RlcyIsImNvdW50ZXIiLCJzZXR0aW5nSGVpZ2h0IiwiaGVpZ2h0IiwiYW5nbGUiLCJhbmdsZVByb3BlcnR5IiwidmFsdWUiLCJ0cmFuc2xhdGlvbkhhbmRsZSIsInJvdGF0aW9uSGFuZGxlIiwiRkFOX1NPVVJDRSIsIngiLCJ5IiwiZmlsbCIsIkJFQU1fU09VUkNFIiwiTWF0aCIsInNpbiIsImNvcyIsImFkZENoaWxkIiwiaW5zZXJ0Q2hpbGQiLCJyYXlPcHRpb25zT2JqZWN0Iiwic3Ryb2tlIiwibGluZVdpZHRoIiwibGluZUpvaW4iLCJyIiwibW91c2VEb3duUG9zaXRpb24iLCJhZGRJbnB1dExpc3RlbmVyIiwiYWxsb3dUb3VjaFNuYWciLCJzdGFydCIsImUiLCJzZXRTZWxlY3RlZFBpZWNlIiwicG9zaXRpb24iLCJnbG9iYWxUb1BhcmVudFBvaW50IiwicG9pbnRlciIsInBvaW50IiwiY3VycmVudE5vZGVQb3MiLCJwb3NpdGlvblByb3BlcnR5IiwibWludXMiLCJkcmFnIiwic2V0UG9zaXRpb24iLCJlbmQiLCJ0b29sRHJhd2VyUGFuZWwiLCJ2aXNpYmxlQm91bmRzIiwiY29udGFpbnNDb29yZGluYXRlcyIsInJlbW92ZVBpZWNlIiwibW91c2VQb3NSZWxhdGl2ZSIsIlBJIiwic2V0QW5nbGUiLCJsaW5rIiwidHJhbnNsYXRpb24iLCJyb3RhdGlvbiIsImNvc0FuZ2xlIiwic2luQW5nbGUiLCJuYnJPZlJheXNQcm9wZXJ0eSIsIm5ick9mUmF5cyIsInNldFJheU5vZGVzIiwicHJvY2Vzc1JheXMiLCJzcHJlYWRQcm9wZXJ0eSIsIndpZHRoUHJvcGVydHkiLCJ3aWR0aCIsInNldFdpZHRoIiwicHJvY2Vzc1JheXNDb3VudFByb3BlcnR5IiwiZHJhd1JheXMiLCJjb2xvciIsImNvbG9yQ29kZSIsIkVycm9yIiwiaSIsInN0cm9rZUNvbG9yIiwicm91bmRTeW1tZXRyaWMiLCJ2aXNpYmxlIiwibWF4UmF5TGVuZ3RoIiwiTUFYSU1VTV9SQVlfTEVOR1RIIiwicmF5UGF0aHMiLCJsZW5ndGgiLCJkaXIiLCJzdGFydERpciIsInNvdXJjZUNlbnRlciIsInNlZ21lbnRzIiwiQWJzb2x1dGVSYXlTdGFydCIsImdldFN0YXJ0IiwiQWJzb2x1dGVSYXlFbmQiLCJnZXRFbmQiLCJyZWxhdGl2ZVJheVN0YXJ0IiwicmVsYXRpdmVSYXlFbmQiLCJyYXlTaGFwZSIsIm1vdmVUb1BvaW50IiwicmVsYXRpdmVFbmRQdCIsInRpbWVzU2NhbGFyIiwibGluZVRvUG9pbnQiLCJzZXRTaGFwZSIsInNoYXBlIiwiZ2V0UmVsYXRpdmVTaGFwZSIsInNldFJlY3QiLCJzZXRDb2xvciIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiU291cmNlTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBOb2RlIGZvciBTb3VyY2Ugb2YgbGlnaHQsIHdoaWNoIGlzIGVpdGhlciBhIGZhbiBvZiByYXlzIChwb2ludCBzb3VyY2UpXHJcbiAqIG9yIGEgcGFyYWxsZWwgYmVhbSBvZiByYXlzXHJcbiAqXHJcbiAqIEBhdXRob3IgTWljaGFlbCBEdWJzb24gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB7IENpcmNsZSwgTm9kZSwgUGF0aCwgUmVjdGFuZ2xlLCBTaW1wbGVEcmFnSGFuZGxlciB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBvcHRpY3NMYWIgZnJvbSAnLi4vLi4vb3B0aWNzTGFiLmpzJztcclxuaW1wb3J0IFR5cGUgZnJvbSAnLi4vbW9kZWwvVHlwZS5qcyc7XHJcbmltcG9ydCBPcHRpY3NMYWJDb25zdGFudHMgZnJvbSAnLi4vT3B0aWNzTGFiQ29uc3RhbnRzLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBNQVhJTVVNX0xJR0hUX1JBWVMgPSBPcHRpY3NMYWJDb25zdGFudHMuTUFYSU1VTV9MSUdIVF9SQVlTO1xyXG5cclxuY2xhc3MgU291cmNlTm9kZSBleHRlbmRzIE5vZGUge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7T3B0aWNzTGFiTW9kZWx9IG1haW5Nb2RlbFxyXG4gICAqIEBwYXJhbSB7U291cmNlTW9kZWx9IHNvdXJjZU1vZGVsXHJcbiAgICogQHBhcmFtIHtPcHRpY3NMYWJTY3JlZW5WaWV3fSBtYWluVmlld1xyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBtYWluTW9kZWwsIHNvdXJjZU1vZGVsLCBtYWluVmlldyApIHtcclxuXHJcbiAgICBzdXBlcigge1xyXG4gICAgICAvLyBTaG93IGEgY3Vyc29yIGhhbmQgb3ZlciB0aGUgYmFyIG1hZ25ldFxyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuY29sb3JQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggJ3doaXRlJyApOyAgLy9zZXRzIGNvbG9yIG9mIHJheXNcclxuICAgIHRoaXMubWFpbk1vZGVsID0gbWFpbk1vZGVsO1xyXG4gICAgdGhpcy5waWVjZU1vZGVsID0gc291cmNlTW9kZWw7ICAgLy9uZWVkIGdlbmVyaWMgbmFtZSBiZWNhdXNlIG5lZWQgdG8gbG9vcCBvdmVyIGFsbCBwaWVjZXMgYW5kIGhhdmUgcGllY2VNb2RlbFxyXG4gICAgdGhpcy50eXBlID0gc291cmNlTW9kZWwudHlwZTtcclxuICAgIHRoaXMucmVsYXRpdmVSYXlTdGFydHMgPSBbXTsgLy9zdGFydGluZyBwb3NpdGlvbnMsIHJlbGF0aXZlIHRvIHNvdXJjZSBjZW50ZXIsIG9mIGVhY2ggcmF5XHJcbiAgICB0aGlzLnJheU5vZGVzID0gW107ICAgLy9hcnJheSBvZiByYXlOb2RlcywgYSByYXlOb2RlIGlzIGEgcGF0aCBvZiBhIHJheSBmcm9tIHNvdXJjZSB0aHJvdWdoIGNvbXBvbmVudHMgdG8gZW5kXHJcbiAgICB0aGlzLmNvdW50ZXIgPSAwOyAvL2ZvciB0ZXN0aW5nIG9ubHlcclxuICAgIHRoaXMuc2V0dGluZ0hlaWdodCA9IGZhbHNlOyAvL2ZsYWcgdXNlZCB0byBwcmV2ZW50IGNvbmZsaWN0aW5nIGNhbGxzIHRvIHNldCBhbmdsZSBvZiB0cmFuc2xhdGlvbiBoYW5kbGVcclxuICAgIC8vIENhbGwgdGhlIHN1cGVyIGNvbnN0cnVjdG9yXHJcblxyXG4gICAgLy8gRHJhdyBhIGhhbmRsZVxyXG4gICAgY29uc3QgaGVpZ2h0ID0gc291cmNlTW9kZWwuaGVpZ2h0OyAgIC8vaWYgdHlwZSA9IFR5cGUuQkVBTV9TT1VSQ0VcclxuICAgIGNvbnN0IGFuZ2xlID0gc291cmNlTW9kZWwuYW5nbGVQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICB0aGlzLnRyYW5zbGF0aW9uSGFuZGxlO1xyXG4gICAgdGhpcy5yb3RhdGlvbkhhbmRsZSA9IG5ldyBOb2RlKCk7XHJcbiAgICBpZiAoIHNvdXJjZU1vZGVsLnR5cGUgPT09IFR5cGUuRkFOX1NPVVJDRSApIHtcclxuICAgICAgdGhpcy50cmFuc2xhdGlvbkhhbmRsZSA9IG5ldyBDaXJjbGUoIDIwLCB7IHg6IDAsIHk6IDAsIGZpbGw6ICcjOEY4JyB9ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggc291cmNlTW9kZWwudHlwZSA9PT0gVHlwZS5CRUFNX1NPVVJDRSApIHtcclxuICAgICAgdGhpcy50cmFuc2xhdGlvbkhhbmRsZSA9IG5ldyBSZWN0YW5nbGUoIC01LCAtaGVpZ2h0IC8gMiwgMTAsIGhlaWdodCwgeyBmaWxsOiAnIzhGOCcsIGN1cnNvcjogJ3BvaW50ZXInIH0gKTtcclxuICAgICAgdGhpcy5yb3RhdGlvbkhhbmRsZSA9IG5ldyBDaXJjbGUoIDUsIHtcclxuICAgICAgICB4OiBNYXRoLnNpbiggYW5nbGUgKSAqIGhlaWdodCAvIDIsXHJcbiAgICAgICAgeTogTWF0aC5jb3MoIGFuZ2xlICkgKiBoZWlnaHQgLyAyLFxyXG4gICAgICAgIGZpbGw6ICd5ZWxsb3cnXHJcbiAgICAgIH0gKTtcclxuICAgICAgdGhpcy5hZGRDaGlsZCggdGhpcy5yb3RhdGlvbkhhbmRsZSApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaW5zZXJ0Q2hpbGQoIDAsIHRoaXMudHJhbnNsYXRpb25IYW5kbGUgKTtcclxuXHJcbiAgICBjb25zdCByYXlPcHRpb25zT2JqZWN0ID0geyBzdHJva2U6ICdibGFjaycsIGxpbmVXaWR0aDogMS41LCBsaW5lSm9pbjogJ2JldmVsJyB9OyAvLywgbGluZURhc2g6IFsgNSwgMSBdXHJcbiAgICBmb3IgKCBsZXQgciA9IDA7IHIgPCBNQVhJTVVNX0xJR0hUX1JBWVM7IHIrKyApIHtcclxuICAgICAgdGhpcy5yYXlOb2Rlc1sgciBdID0gbmV3IFBhdGgoIG5ldyBTaGFwZSgpLCByYXlPcHRpb25zT2JqZWN0ICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMucmF5Tm9kZXNbIHIgXSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFdoZW4gZHJhZ2dpbmcsIG1vdmUgdGhlIHNhbXBsZSBlbGVtZW50XHJcbiAgICBsZXQgbW91c2VEb3duUG9zaXRpb247XHJcbiAgICB0aGlzLnRyYW5zbGF0aW9uSGFuZGxlLmFkZElucHV0TGlzdGVuZXIoIG5ldyBTaW1wbGVEcmFnSGFuZGxlcihcclxuICAgICAge1xyXG4gICAgICAgIC8vIFdoZW4gZHJhZ2dpbmcgYWNyb3NzIGl0IGluIGEgbW9iaWxlIGRldmljZSwgcGljayBpdCB1cFxyXG4gICAgICAgIGFsbG93VG91Y2hTbmFnOiB0cnVlLFxyXG5cclxuICAgICAgICBzdGFydDogZSA9PiB7XHJcbiAgICAgICAgICBtYWluVmlldy5zZXRTZWxlY3RlZFBpZWNlKCB0aGlzICk7XHJcbiAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuZ2xvYmFsVG9QYXJlbnRQb2ludCggZS5wb2ludGVyLnBvaW50ICk7XHJcbiAgICAgICAgICBjb25zdCBjdXJyZW50Tm9kZVBvcyA9IHRoaXMucGllY2VNb2RlbC5wb3NpdGlvblByb3BlcnR5LnZhbHVlO1xyXG4gICAgICAgICAgbW91c2VEb3duUG9zaXRpb24gPSBwb3NpdGlvbi5taW51cyggY3VycmVudE5vZGVQb3MgKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBkcmFnOiBlID0+IHtcclxuICAgICAgICAgIGxldCBwb3NpdGlvbiA9IHRoaXMuZ2xvYmFsVG9QYXJlbnRQb2ludCggZS5wb2ludGVyLnBvaW50ICk7XHJcbiAgICAgICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uLm1pbnVzKCBtb3VzZURvd25Qb3NpdGlvbiApO1xyXG4gICAgICAgICAgdGhpcy5waWVjZU1vZGVsLnNldFBvc2l0aW9uKCBwb3NpdGlvbiApO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW5kOiBlID0+IHtcclxuICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5nbG9iYWxUb1BhcmVudFBvaW50KCBlLnBvaW50ZXIucG9pbnQgKTtcclxuICAgICAgICAgIGlmICggbWFpblZpZXcudG9vbERyYXdlclBhbmVsLnZpc2libGVCb3VuZHMuY29udGFpbnNDb29yZGluYXRlcyggcG9zaXRpb24ueCwgcG9zaXRpb24ueSApICkge1xyXG4gICAgICAgICAgICBtYWluVmlldy5yZW1vdmVQaWVjZSggdGhpcyApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSApICk7Ly9lbmQgdHJhbnNsYXRpb25IYW5kbGUuYWRkSW5wdXRMaXN0ZW5lcigpXHJcblxyXG4gICAgdGhpcy5yb3RhdGlvbkhhbmRsZS5hZGRJbnB1dExpc3RlbmVyKCBuZXcgU2ltcGxlRHJhZ0hhbmRsZXIoIHtcclxuICAgICAgYWxsb3dUb3VjaFNuYWc6IHRydWUsXHJcbiAgICAgIC8vc3RhcnQgZnVuY3Rpb24gZm9yIHRlc3Rpbmcgb25seVxyXG4gICAgICBzdGFydDogZSA9PiB7XHJcbiAgICAgICAgbWFpblZpZXcuc2V0U2VsZWN0ZWRQaWVjZSggdGhpcyApO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgZHJhZzogZSA9PiB7XHJcbiAgICAgICAgY29uc3QgbW91c2VQb3NSZWxhdGl2ZSA9IHRoaXMudHJhbnNsYXRpb25IYW5kbGUuZ2xvYmFsVG9QYXJlbnRQb2ludCggZS5wb2ludGVyLnBvaW50ICk7ICAgLy9yZXR1cm5zIFZlY3RvcjJcclxuICAgICAgICBjb25zdCBhbmdsZSA9IG1vdXNlUG9zUmVsYXRpdmUuYW5nbGUgLSBNYXRoLlBJIC8gMjsgIC8vYW5nbGUgPSAwIHdoZW4gYmVhbSBob3Jpem9udGFsLCBDVyBpcyArIGFuZ2xlXHJcbiAgICAgICAgdGhpcy5waWVjZU1vZGVsLnNldEFuZ2xlKCBhbmdsZSApO1xyXG5cclxuICAgICAgfVxyXG4gICAgfSApICk7Ly9lbmQgdGhpcy5yb3RhdGlvbkhhbmRsZS5hZGRJbnB1dExpc3RlbmVyKClcclxuXHJcbiAgICAvLyBSZWdpc3RlciBmb3Igc3luY2hyb25pemF0aW9uIHdpdGggcGllY2VNb2RlbCBhbmQgbWFpbk1vZGVsLlxyXG4gICAgc291cmNlTW9kZWwucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCBwb3NpdGlvbiA9PiB7XHJcbiAgICAgIHRoaXMudHJhbnNsYXRpb24gPSBwb3NpdGlvbjtcclxuICAgIH0gKTtcclxuXHJcbiAgICBzb3VyY2VNb2RlbC5hbmdsZVByb3BlcnR5LmxpbmsoIGFuZ2xlID0+IHtcclxuICAgICAgaWYgKCAhdGhpcy5zZXR0aW5nSGVpZ2h0ICkge1xyXG4gICAgICAgIHRoaXMudHJhbnNsYXRpb25IYW5kbGUucm90YXRpb24gPSBhbmdsZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgY29zQW5nbGUgPSBNYXRoLmNvcyggYW5nbGUgKTtcclxuICAgICAgY29uc3Qgc2luQW5nbGUgPSBNYXRoLnNpbiggYW5nbGUgKTtcclxuICAgICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5waWVjZU1vZGVsLmhlaWdodDtcclxuICAgICAgdGhpcy5yb3RhdGlvbkhhbmRsZS50cmFuc2xhdGlvbiA9IG5ldyBWZWN0b3IyKCAtKCBoZWlnaHQgLyAyICkgKiBzaW5BbmdsZSwgKCBoZWlnaHQgLyAyICkgKiBjb3NBbmdsZSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHNvdXJjZU1vZGVsLm5ick9mUmF5c1Byb3BlcnR5LmxpbmsoIG5ick9mUmF5cyA9PiB7XHJcbiAgICAgIHRoaXMuc2V0UmF5Tm9kZXMoIG5ick9mUmF5cyApO1xyXG4gICAgICB0aGlzLm1haW5Nb2RlbC5wcm9jZXNzUmF5cygpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHNvdXJjZU1vZGVsLnNwcmVhZFByb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgICAgaWYgKCB0aGlzLnR5cGUgPT09IFR5cGUuRkFOX1NPVVJDRSApIHtcclxuICAgICAgICB0aGlzLnNldFJheU5vZGVzKCk7XHJcbiAgICAgICAgdGhpcy5tYWluTW9kZWwucHJvY2Vzc1JheXMoKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIHNvdXJjZU1vZGVsLndpZHRoUHJvcGVydHkubGluayggd2lkdGggPT4ge1xyXG4gICAgICBpZiAoIHRoaXMudHlwZSA9PT0gVHlwZS5CRUFNX1NPVVJDRSApIHtcclxuICAgICAgICB0aGlzLnNldFdpZHRoKCB3aWR0aCApO1xyXG4gICAgICAgIHRoaXMuc2V0UmF5Tm9kZXMoKTtcclxuICAgICAgICB0aGlzLm1haW5Nb2RlbC5wcm9jZXNzUmF5cygpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5tYWluTW9kZWwucHJvY2Vzc1JheXNDb3VudFByb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgICAgdGhpcy5kcmF3UmF5cygpO1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5jb2xvclByb3BlcnR5LmxpbmsoIGNvbG9yID0+IHtcclxuICAgICAgbGV0IGNvbG9yQ29kZTsgICAgICAgICAgICAvL3N3aXRjaCAoIGNvbG9yIClcclxuICAgICAgc3dpdGNoKCBjb2xvciApIHtcclxuICAgICAgICBjYXNlICd3aGl0ZSc6XHJcbiAgICAgICAgICBjb2xvckNvZGUgPSAnI2ZmZic7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdncmVlbic6XHJcbiAgICAgICAgICBjb2xvckNvZGUgPSAnIzBmMCc7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdyZWQnOlxyXG4gICAgICAgICAgY29sb3JDb2RlID0gJyNmMDAnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAneWVsbG93JzpcclxuICAgICAgICAgIGNvbG9yQ29kZSA9ICcjZmYwJztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIGBpbnZhbGlkIGNvbG9yOiAke2NvbG9yfWAgKTtcclxuICAgICAgfVxyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBNQVhJTVVNX0xJR0hUX1JBWVM7IGkrKyApIHtcclxuICAgICAgICB0aGlzLnJheU5vZGVzWyBpIF0uc3Ryb2tlQ29sb3IgPSBjb2xvckNvZGU7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBuYnJPZlJheXNcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIHNldFJheU5vZGVzKCBuYnJPZlJheXMgKSB7XHJcbiAgICAvL3RoaXMudHJhbnNsYXRpb25IYW5kbGUucmVtb3ZlQWxsQ2hpbGRyZW4oKTtcclxuICAgIC8vdGhpcy5yYXlOb2RlcyA9IFtdO1xyXG4gICAgbmJyT2ZSYXlzID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIG5ick9mUmF5cyApO1xyXG5cclxuICAgIGZvciAoIGxldCBpID0gbmJyT2ZSYXlzOyBpIDwgTUFYSU1VTV9MSUdIVF9SQVlTOyBpKysgKSB7XHJcbiAgICAgIHRoaXMucmF5Tm9kZXNbIGkgXS52aXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgfVxyXG4gICAgY29uc3QgbWF4UmF5TGVuZ3RoID0gT3B0aWNzTGFiQ29uc3RhbnRzLk1BWElNVU1fUkFZX0xFTkdUSDtcclxuICAgIC8vdmFyIHJheUZvbnRPYmplY3QgPSB7IHN0cm9rZTogJ3doaXRlJywgbGluZVdpZHRoOiAyIH0gO1xyXG4gICAgZm9yICggbGV0IHIgPSAwOyByIDwgdGhpcy5waWVjZU1vZGVsLnJheVBhdGhzLmxlbmd0aDsgcisrICkge1xyXG4gICAgICB0aGlzLnJheU5vZGVzWyByIF0udmlzaWJsZSA9IHRydWU7XHJcbiAgICAgIGNvbnN0IGRpciA9IHRoaXMucGllY2VNb2RlbC5yYXlQYXRoc1sgciBdLnN0YXJ0RGlyO1xyXG4gICAgICBjb25zdCBzb3VyY2VDZW50ZXIgPSB0aGlzLnBpZWNlTW9kZWwucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgaWYgKCB0aGlzLnBpZWNlTW9kZWwucmF5UGF0aHNbIHIgXS5zZWdtZW50cy5sZW5ndGggPT09IDAgKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IEFic29sdXRlUmF5U3RhcnQgPSB0aGlzLnBpZWNlTW9kZWwucmF5UGF0aHNbIHIgXS5zZWdtZW50c1sgMCBdLmdldFN0YXJ0KCk7XHJcbiAgICAgIGNvbnN0IEFic29sdXRlUmF5RW5kID0gdGhpcy5waWVjZU1vZGVsLnJheVBhdGhzWyByIF0uc2VnbWVudHNbIDAgXS5nZXRFbmQoKTtcclxuICAgICAgY29uc3QgcmVsYXRpdmVSYXlTdGFydCA9IEFic29sdXRlUmF5U3RhcnQubWludXMoIHNvdXJjZUNlbnRlciApO1xyXG4gICAgICBjb25zdCByZWxhdGl2ZVJheUVuZCA9IEFic29sdXRlUmF5RW5kLm1pbnVzKCBzb3VyY2VDZW50ZXIgKTtcclxuICAgICAgY29uc3QgcmF5U2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuICAgICAgcmF5U2hhcGUubW92ZVRvUG9pbnQoIHJlbGF0aXZlUmF5U3RhcnQgKTtcclxuICAgICAgaWYgKCB0aGlzLnBpZWNlTW9kZWwudHlwZSA9PT0gVHlwZS5GQU5fU09VUkNFICkge1xyXG4gICAgICAgIHRoaXMucmVsYXRpdmVSYXlTdGFydHNbIHIgXSA9IHJlbGF0aXZlUmF5U3RhcnQ7XHJcbiAgICAgICAgY29uc3QgcmVsYXRpdmVFbmRQdCA9IGRpci50aW1lc1NjYWxhciggbWF4UmF5TGVuZ3RoICk7XHJcbiAgICAgICAgcmF5U2hhcGUubGluZVRvUG9pbnQoIHJlbGF0aXZlRW5kUHQgKTtcclxuXHJcbiAgICAgICAgLy92YXIgcmF5Tm9kZSA9IG5ldyBMaW5lKCBuZXcgVmVjdG9yMiggMCwgMCApLCBkaXIudGltZXNTY2FsYXIoIG1heFJheUxlbmd0aCApLCByYXlGb250T2JqZWN0ICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHRoaXMucGllY2VNb2RlbC50eXBlID09PSBUeXBlLkJFQU1fU09VUkNFICkge1xyXG5cclxuICAgICAgICB0aGlzLnJlbGF0aXZlUmF5U3RhcnRzWyByIF0gPSByZWxhdGl2ZVJheVN0YXJ0O1xyXG4gICAgICAgIHJheVNoYXBlLmxpbmVUb1BvaW50KCByZWxhdGl2ZVJheUVuZCApO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMucmF5Tm9kZXNbIHIgXS5zZXRTaGFwZSggcmF5U2hhcGUgKTtcclxuICAgIH0vL2VuZCByYXlQYXRoIGxvb3BcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZHJhd1JheXMoKSB7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLnBpZWNlTW9kZWwucmF5UGF0aHMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IHNoYXBlID0gdGhpcy5waWVjZU1vZGVsLnJheVBhdGhzWyBpIF0uZ2V0UmVsYXRpdmVTaGFwZSgpOy8vZ2V0U2hhcGUoKTtcclxuICAgICAgdGhpcy5yYXlOb2Rlc1sgaSBdLnNldFNoYXBlKCBzaGFwZSApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgd2lkdGggb2YgdGhlIGJlYW0gc291cmNlXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodFxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgc2V0V2lkdGgoIGhlaWdodCApIHtcclxuICAgIHRoaXMuc2V0dGluZ0hlaWdodCA9IHRydWU7XHJcbiAgICBjb25zdCBjb3NBbmdsZSA9IE1hdGguY29zKCB0aGlzLnBpZWNlTW9kZWwuYW5nbGVQcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgY29uc3Qgc2luQW5nbGUgPSBNYXRoLnNpbiggdGhpcy5waWVjZU1vZGVsLmFuZ2xlUHJvcGVydHkudmFsdWUgKTtcclxuICAgIHRoaXMudHJhbnNsYXRpb25IYW5kbGUucm90YXRpb24gPSAwO1xyXG4gICAgLy9cclxuICAgIHRoaXMudHJhbnNsYXRpb25IYW5kbGUuc2V0UmVjdCggLTUsIC1oZWlnaHQgLyAyLCAxMCwgaGVpZ2h0ICk7XHJcbiAgICB0aGlzLnRyYW5zbGF0aW9uSGFuZGxlLnJvdGF0aW9uID0gdGhpcy5waWVjZU1vZGVsLmFuZ2xlUHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgdGhpcy5yb3RhdGlvbkhhbmRsZS50cmFuc2xhdGlvbiA9IG5ldyBWZWN0b3IyKCAoIC1oZWlnaHQgLyAyICkgKiBzaW5BbmdsZSwgKCBoZWlnaHQgLyAyICkgKiBjb3NBbmdsZSApO1xyXG4gICAgdGhpcy5zZXR0aW5nSGVpZ2h0ID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBzZXRzIHRoZSBjb2xvciBvZiB0aGUgbGlnaHQgcmF5c1xyXG4gICAqIEBwYXJhbSB7c3RyaW5nfENvbG9yfSBjb2xvclxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgc2V0Q29sb3IoIGNvbG9yICkge1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5waWVjZU1vZGVsLnJheVBhdGhzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICB0aGlzLnJheU5vZGVzWyBpIF0uc3Ryb2tlQ29sb3IgPSBjb2xvcjtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbm9wdGljc0xhYi5yZWdpc3RlciggJ1NvdXJjZU5vZGUnLCBTb3VyY2VOb2RlICk7XHJcbmV4cG9ydCBkZWZhdWx0IFNvdXJjZU5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsU0FBU0MsS0FBSyxRQUFRLGdDQUFnQztBQUN0RCxTQUFTQyxNQUFNLEVBQUVDLElBQUksRUFBRUMsSUFBSSxFQUFFQyxTQUFTLEVBQUVDLGlCQUFpQixRQUFRLG1DQUFtQztBQUNwRyxPQUFPQyxTQUFTLE1BQU0sb0JB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