// Copyright 2014-2022, University of Colorado Boulder

/**
 * Model for the 'Optics Lab' screen.
 *
 * @author Michael Dubson (PhET Interactive Simulations)
 */

import createObservableArray from '../../../../axon/js/createObservableArray.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import opticsLab from '../../opticsLab.js';
import OpticsLabConstants from '../OpticsLabConstants.js';
import Type from './Type.js';
class OpticsLabModel {
  constructor() {
    // @private {Property.<number>} number of times processRays() called, flag for further processing
    this.processRaysCountProperty = new NumberProperty(0);

    // @public (read-only) boolean
    this.processingRays = false; //true if rays are being processed,
    // needed to ensure current processing to end before new processing begins

    // @private {ObservableArrayDef.<SourceModel>}
    this.sources = createObservableArray(); //source of light rays

    // @private {ObservableArrayDef.<ComponentModel>}
    this.components = createObservableArray(); //component = lens, mirror, or mask

    // @private {ObservableArrayDef.<ComponentModel|SourceModel>}
    this.pieces = createObservableArray(); //piece = source or component
  }

  /**
   * @public
   */
  reset() {
    this.sources.clear();
    this.components.clear();
    this.pieces.clear();
    this.processRaysCountProperty.reset();
  }

  /**
   * Adds a source of light to the model
   * @param {SourceModel} source
   * @public
   */
  addSource(source) {
    this.sources.add(source);
    this.pieces.add(source);
    source.setPosition(source.positionProperty.value);
  }

  /**
   * Adds a component (lens/mirror) to the model
   * @param {ComponentModel} component
   * @public
   */
  addComponent(component) {
    this.components.add(component);
    this.pieces.add(component);
  }

  /**
   * Removes a source of light from the model
   * @param {SourceModel} source
   * @public
   */
  removeSource(source) {
    if (this.sources.includes(source)) {
      this.sources.remove(source);
    }
    this.processRays();
  }

  /**
   * Removes a component (mirror/lens) from the model
   * @param {ComponentModel} component
   * @public
   */
  removeComponent(component) {
    if (this.components.includes(component)) {
      this.components.remove(component);
    }
    this.processRays();
  }

  /**
   * @public
   */
  processRays() {
    //loop through all sources
    for (let i = 0; i < this.sources.length; i++) {
      this.updateSourceLines(this.sources.get(i)); //sources is an observable array, hence .get(i)
    }

    this.processRaysCountProperty.value += 1; //increment number of times processRays called
  }

  /**
   *
   * @param {SourceModel} source
   * @private
   */
  updateSourceLines(source) {
    this.processingRays = true;
    //loop thru all rayPaths of this source
    for (let r = 0; r < source.rayPaths.length; r++) {
      const rayPath = source.rayPaths[r];
      rayPath.clearPath();
      const startPoint = rayPath.startPos; //rayPath.segments[ 0 ].getStart();
      const direction = rayPath.startDir;
      this.launchRay(rayPath, startPoint, direction);
    } //end rayPath loop
    this.processingRays = false;
  } //end updateSourceLines()

  /**
   *
   * @param {RayPath} rayPath
   * @param {Vector2} startPoint
   * @param {Vector2} direction
   * @private
   */
  launchRay(rayPath, startPoint, direction) {
    const dir = direction;
    let intersection = null;
    let distanceToIntersection = OpticsLabConstants.MAXIMUM_RAY_LENGTH;
    const rayTip = startPoint.plus(dir.timesScalar(OpticsLabConstants.MAXIMUM_RAY_LENGTH));

    //loop thru all components, checking for intersection of ray and component
    let componentIntersectedIndex;
    for (let j = 0; j < this.components.length; j++) {
      const compDiameter = this.components.get(j).diameterProperty.value;
      const compCenter = this.components.get(j).positionProperty.value;
      const compAngle = -this.components.get(j).angleProperty.value;
      const sinAngle = Math.sin(compAngle);
      const cosAngle = Math.cos(compAngle);
      const thisIntersection = Utils.lineSegmentIntersection(startPoint.x, startPoint.y, rayTip.x, rayTip.y, compCenter.x - compDiameter / 2 * sinAngle, compCenter.y - compDiameter / 2 * cosAngle, compCenter.x + compDiameter / 2 * sinAngle, compCenter.y + compDiameter / 2 * cosAngle);
      if (thisIntersection !== null) {
        const dist = thisIntersection.distance(startPoint);
        if (dist > 2 && dist < distanceToIntersection) {
          //> 10 to be sure component does not intersect its own starting ray
          distanceToIntersection = dist;
          intersection = thisIntersection;
          componentIntersectedIndex = j;
        }
      }
    } //end component loop

    if (intersection !== null) {
      rayPath.addSegment(startPoint, intersection);
      const tailSegmentNbr = rayPath.segments.length - 1;
      this.processIntersection(rayPath, intersection, tailSegmentNbr, componentIntersectedIndex);
      rayPath.nbrSegments += 1; //increment segment counter to check for runaway raypath
    } else {
      rayPath.addSegment(startPoint, rayTip); //rayPath ends
    }
  } //end launchRay()

  /**
   *
   * @param {RayPath} rayPath
   * @param {Vector2} intersection
   * @param {number} segmentNbr
   * @param {number} componentNbr
   * @private
   */
  processIntersection(rayPath, intersection, segmentNbr, componentNbr) {
    const incomingRayDir = rayPath.dirs[segmentNbr];
    const incomingAngle = incomingRayDir.angle; //angle in rads between direction of ray and component normal
    let outgoingAngle;
    const component = this.components.get(componentNbr);
    const componentAngle = component.angleProperty.value; //tilt of component = angle between horizontal and component normal
    const componentNormal = new Vector2(Math.cos(componentAngle), Math.sin(componentAngle));
    const componentParallel = new Vector2(-Math.sin(componentAngle), Math.cos(componentAngle));
    const angleInRads = incomingAngle - componentAngle;
    let normalDirection = true;
    if (incomingRayDir.dot(componentNormal) < 0) {
      normalDirection = false;
    }
    const r = intersection.minus(component.positionProperty.value).dot(componentParallel);
    const f = component.fProperty.value; //f = focal length
    const tanTheta = Math.tan(angleInRads);
    let newDir;
    if (rayPath.nbrSegments > rayPath.maxNbrSegments) {
      //do nothing, ray terminates if too many segments, probably caught in infinite reflection loop
      console.log('Max number of raypath segments exceeded');
    } else if (component.type === Type.CONVERGING_LENS || component.type === Type.DIVERGING_LENS) {
      if (normalDirection) {
        outgoingAngle = -Math.atan(r / f - tanTheta) + componentAngle;
      } else {
        outgoingAngle = Math.PI + Math.atan(r / f + tanTheta) + componentAngle;
      }
      newDir = Vector2.createPolar(1, outgoingAngle);
      this.launchRay(rayPath, intersection, newDir);
    } else if (component.type === Type.CONVERGING_MIRROR) {
      if (normalDirection) {
        outgoingAngle = Math.PI + Math.atan(r / f - tanTheta) + componentAngle;
        newDir = Vector2.createPolar(1, outgoingAngle);
        this.launchRay(rayPath, intersection, newDir);
      }
    } else if (component.type === Type.DIVERGING_MIRROR) {
      if (normalDirection) {
        outgoingAngle = Math.PI + Math.atan(r / f - tanTheta) + componentAngle;
        newDir = Vector2.createPolar(1, outgoingAngle);
        this.launchRay(rayPath, intersection, newDir);
      }
    } else if (component.type === Type.PLANE_MIRROR) {
      if (normalDirection) {
        outgoingAngle = Math.PI - angleInRads + componentAngle;
        newDir = Vector2.createPolar(1, outgoingAngle);
        this.launchRay(rayPath, intersection, newDir);
      }
    } else if (component.type === Type.SIMPLE_MASK) {
      //Do nothing. The rayPath ends at a mask.
    } else {
      console.log('ERROR: intersection component is unknown.');
    }
  } //end processIntersection()
}

opticsLab.register('OpticsLabModel', OpticsLabModel);
export default OpticsLabModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVPYnNlcnZhYmxlQXJyYXkiLCJOdW1iZXJQcm9wZXJ0eSIsIlV0aWxzIiwiVmVjdG9yMiIsIm9wdGljc0xhYiIsIk9wdGljc0xhYkNvbnN0YW50cyIsIlR5cGUiLCJPcHRpY3NMYWJNb2RlbCIsImNvbnN0cnVjdG9yIiwicHJvY2Vzc1JheXNDb3VudFByb3BlcnR5IiwicHJvY2Vzc2luZ1JheXMiLCJzb3VyY2VzIiwiY29tcG9uZW50cyIsInBpZWNlcyIsInJlc2V0IiwiY2xlYXIiLCJhZGRTb3VyY2UiLCJzb3VyY2UiLCJhZGQiLCJzZXRQb3NpdGlvbiIsInBvc2l0aW9uUHJvcGVydHkiLCJ2YWx1ZSIsImFkZENvbXBvbmVudCIsImNvbXBvbmVudCIsInJlbW92ZVNvdXJjZSIsImluY2x1ZGVzIiwicmVtb3ZlIiwicHJvY2Vzc1JheXMiLCJyZW1vdmVDb21wb25lbnQiLCJpIiwibGVuZ3RoIiwidXBkYXRlU291cmNlTGluZXMiLCJnZXQiLCJyIiwicmF5UGF0aHMiLCJyYXlQYXRoIiwiY2xlYXJQYXRoIiwic3RhcnRQb2ludCIsInN0YXJ0UG9zIiwiZGlyZWN0aW9uIiwic3RhcnREaXIiLCJsYXVuY2hSYXkiLCJkaXIiLCJpbnRlcnNlY3Rpb24iLCJkaXN0YW5jZVRvSW50ZXJzZWN0aW9uIiwiTUFYSU1VTV9SQVlfTEVOR1RIIiwicmF5VGlwIiwicGx1cyIsInRpbWVzU2NhbGFyIiwiY29tcG9uZW50SW50ZXJzZWN0ZWRJbmRleCIsImoiLCJjb21wRGlhbWV0ZXIiLCJkaWFtZXRlclByb3BlcnR5IiwiY29tcENlbnRlciIsImNvbXBBbmdsZSIsImFuZ2xlUHJvcGVydHkiLCJzaW5BbmdsZSIsIk1hdGgiLCJzaW4iLCJjb3NBbmdsZSIsImNvcyIsInRoaXNJbnRlcnNlY3Rpb24iLCJsaW5lU2VnbWVudEludGVyc2VjdGlvbiIsIngiLCJ5IiwiZGlzdCIsImRpc3RhbmNlIiwiYWRkU2VnbWVudCIsInRhaWxTZWdtZW50TmJyIiwic2VnbWVudHMiLCJwcm9jZXNzSW50ZXJzZWN0aW9uIiwibmJyU2VnbWVudHMiLCJzZWdtZW50TmJyIiwiY29tcG9uZW50TmJyIiwiaW5jb21pbmdSYXlEaXIiLCJkaXJzIiwiaW5jb21pbmdBbmdsZSIsImFuZ2xlIiwib3V0Z29pbmdBbmdsZSIsImNvbXBvbmVudEFuZ2xlIiwiY29tcG9uZW50Tm9ybWFsIiwiY29tcG9uZW50UGFyYWxsZWwiLCJhbmdsZUluUmFkcyIsIm5vcm1hbERpcmVjdGlvbiIsImRvdCIsIm1pbnVzIiwiZiIsImZQcm9wZXJ0eSIsInRhblRoZXRhIiwidGFuIiwibmV3RGlyIiwibWF4TmJyU2VnbWVudHMiLCJjb25zb2xlIiwibG9nIiwidHlwZSIsIkNPTlZFUkdJTkdfTEVOUyIsIkRJVkVSR0lOR19MRU5TIiwiYXRhbiIsIlBJIiwiY3JlYXRlUG9sYXIiLCJDT05WRVJHSU5HX01JUlJPUiIsIkRJVkVSR0lOR19NSVJST1IiLCJQTEFORV9NSVJST1IiLCJTSU1QTEVfTUFTSyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiT3B0aWNzTGFiTW9kZWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogTW9kZWwgZm9yIHRoZSAnT3B0aWNzIExhYicgc2NyZWVuLlxyXG4gKlxyXG4gKiBAYXV0aG9yIE1pY2hhZWwgRHVic29uIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBjcmVhdGVPYnNlcnZhYmxlQXJyYXkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9jcmVhdGVPYnNlcnZhYmxlQXJyYXkuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBvcHRpY3NMYWIgZnJvbSAnLi4vLi4vb3B0aWNzTGFiLmpzJztcclxuaW1wb3J0IE9wdGljc0xhYkNvbnN0YW50cyBmcm9tICcuLi9PcHRpY3NMYWJDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgVHlwZSBmcm9tICcuL1R5cGUuanMnO1xyXG5cclxuY2xhc3MgT3B0aWNzTGFiTW9kZWwge1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7UHJvcGVydHkuPG51bWJlcj59IG51bWJlciBvZiB0aW1lcyBwcm9jZXNzUmF5cygpIGNhbGxlZCwgZmxhZyBmb3IgZnVydGhlciBwcm9jZXNzaW5nXHJcbiAgICB0aGlzLnByb2Nlc3NSYXlzQ291bnRQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggMCApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMgKHJlYWQtb25seSkgYm9vbGVhblxyXG4gICAgdGhpcy5wcm9jZXNzaW5nUmF5cyA9IGZhbHNlOyAgLy90cnVlIGlmIHJheXMgYXJlIGJlaW5nIHByb2Nlc3NlZCxcclxuICAgIC8vIG5lZWRlZCB0byBlbnN1cmUgY3VycmVudCBwcm9jZXNzaW5nIHRvIGVuZCBiZWZvcmUgbmV3IHByb2Nlc3NpbmcgYmVnaW5zXHJcblxyXG4gICAgLy8gQHByaXZhdGUge09ic2VydmFibGVBcnJheURlZi48U291cmNlTW9kZWw+fVxyXG4gICAgdGhpcy5zb3VyY2VzID0gY3JlYXRlT2JzZXJ2YWJsZUFycmF5KCk7ICAgICAvL3NvdXJjZSBvZiBsaWdodCByYXlzXHJcblxyXG4gICAgLy8gQHByaXZhdGUge09ic2VydmFibGVBcnJheURlZi48Q29tcG9uZW50TW9kZWw+fVxyXG4gICAgdGhpcy5jb21wb25lbnRzID0gY3JlYXRlT2JzZXJ2YWJsZUFycmF5KCk7ICAvL2NvbXBvbmVudCA9IGxlbnMsIG1pcnJvciwgb3IgbWFza1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtPYnNlcnZhYmxlQXJyYXlEZWYuPENvbXBvbmVudE1vZGVsfFNvdXJjZU1vZGVsPn1cclxuICAgIHRoaXMucGllY2VzID0gY3JlYXRlT2JzZXJ2YWJsZUFycmF5KCk7ICAgICAgLy9waWVjZSA9IHNvdXJjZSBvciBjb21wb25lbnRcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLnNvdXJjZXMuY2xlYXIoKTtcclxuICAgIHRoaXMuY29tcG9uZW50cy5jbGVhcigpO1xyXG4gICAgdGhpcy5waWVjZXMuY2xlYXIoKTtcclxuICAgIHRoaXMucHJvY2Vzc1JheXNDb3VudFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGRzIGEgc291cmNlIG9mIGxpZ2h0IHRvIHRoZSBtb2RlbFxyXG4gICAqIEBwYXJhbSB7U291cmNlTW9kZWx9IHNvdXJjZVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBhZGRTb3VyY2UoIHNvdXJjZSApIHtcclxuICAgIHRoaXMuc291cmNlcy5hZGQoIHNvdXJjZSApO1xyXG4gICAgdGhpcy5waWVjZXMuYWRkKCBzb3VyY2UgKTtcclxuICAgIHNvdXJjZS5zZXRQb3NpdGlvbiggc291cmNlLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZHMgYSBjb21wb25lbnQgKGxlbnMvbWlycm9yKSB0byB0aGUgbW9kZWxcclxuICAgKiBAcGFyYW0ge0NvbXBvbmVudE1vZGVsfSBjb21wb25lbnRcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgYWRkQ29tcG9uZW50KCBjb21wb25lbnQgKSB7XHJcbiAgICB0aGlzLmNvbXBvbmVudHMuYWRkKCBjb21wb25lbnQgKTtcclxuICAgIHRoaXMucGllY2VzLmFkZCggY29tcG9uZW50ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmVzIGEgc291cmNlIG9mIGxpZ2h0IGZyb20gdGhlIG1vZGVsXHJcbiAgICogQHBhcmFtIHtTb3VyY2VNb2RlbH0gc291cmNlXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHJlbW92ZVNvdXJjZSggc291cmNlICkge1xyXG4gICAgaWYgKCB0aGlzLnNvdXJjZXMuaW5jbHVkZXMoIHNvdXJjZSApICkge1xyXG4gICAgICB0aGlzLnNvdXJjZXMucmVtb3ZlKCBzb3VyY2UgKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnByb2Nlc3NSYXlzKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmVzIGEgY29tcG9uZW50IChtaXJyb3IvbGVucykgZnJvbSB0aGUgbW9kZWxcclxuICAgKiBAcGFyYW0ge0NvbXBvbmVudE1vZGVsfSBjb21wb25lbnRcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVtb3ZlQ29tcG9uZW50KCBjb21wb25lbnQgKSB7XHJcbiAgICBpZiAoIHRoaXMuY29tcG9uZW50cy5pbmNsdWRlcyggY29tcG9uZW50ICkgKSB7XHJcbiAgICAgIHRoaXMuY29tcG9uZW50cy5yZW1vdmUoIGNvbXBvbmVudCApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5wcm9jZXNzUmF5cygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHByb2Nlc3NSYXlzKCkge1xyXG4gICAgLy9sb29wIHRocm91Z2ggYWxsIHNvdXJjZXNcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuc291cmNlcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgdGhpcy51cGRhdGVTb3VyY2VMaW5lcyggdGhpcy5zb3VyY2VzLmdldCggaSApICk7ICAgLy9zb3VyY2VzIGlzIGFuIG9ic2VydmFibGUgYXJyYXksIGhlbmNlIC5nZXQoaSlcclxuICAgIH1cclxuICAgIHRoaXMucHJvY2Vzc1JheXNDb3VudFByb3BlcnR5LnZhbHVlICs9IDE7ICAvL2luY3JlbWVudCBudW1iZXIgb2YgdGltZXMgcHJvY2Vzc1JheXMgY2FsbGVkXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7U291cmNlTW9kZWx9IHNvdXJjZVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgdXBkYXRlU291cmNlTGluZXMoIHNvdXJjZSApIHtcclxuICAgIHRoaXMucHJvY2Vzc2luZ1JheXMgPSB0cnVlO1xyXG4gICAgLy9sb29wIHRocnUgYWxsIHJheVBhdGhzIG9mIHRoaXMgc291cmNlXHJcbiAgICBmb3IgKCBsZXQgciA9IDA7IHIgPCBzb3VyY2UucmF5UGF0aHMubGVuZ3RoOyByKysgKSB7XHJcbiAgICAgIGNvbnN0IHJheVBhdGggPSBzb3VyY2UucmF5UGF0aHNbIHIgXTtcclxuICAgICAgcmF5UGF0aC5jbGVhclBhdGgoKTtcclxuICAgICAgY29uc3Qgc3RhcnRQb2ludCA9IHJheVBhdGguc3RhcnRQb3M7IC8vcmF5UGF0aC5zZWdtZW50c1sgMCBdLmdldFN0YXJ0KCk7XHJcbiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHJheVBhdGguc3RhcnREaXI7XHJcbiAgICAgIHRoaXMubGF1bmNoUmF5KCByYXlQYXRoLCBzdGFydFBvaW50LCBkaXJlY3Rpb24gKTtcclxuXHJcbiAgICB9Ly9lbmQgcmF5UGF0aCBsb29wXHJcbiAgICB0aGlzLnByb2Nlc3NpbmdSYXlzID0gZmFsc2U7XHJcbiAgfSAvL2VuZCB1cGRhdGVTb3VyY2VMaW5lcygpXHJcblxyXG4gIC8qKlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtSYXlQYXRofSByYXlQYXRoXHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBzdGFydFBvaW50XHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBkaXJlY3Rpb25cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGxhdW5jaFJheSggcmF5UGF0aCwgc3RhcnRQb2ludCwgZGlyZWN0aW9uICkge1xyXG4gICAgY29uc3QgZGlyID0gZGlyZWN0aW9uO1xyXG4gICAgbGV0IGludGVyc2VjdGlvbiA9IG51bGw7XHJcbiAgICBsZXQgZGlzdGFuY2VUb0ludGVyc2VjdGlvbiA9IE9wdGljc0xhYkNvbnN0YW50cy5NQVhJTVVNX1JBWV9MRU5HVEg7XHJcbiAgICBjb25zdCByYXlUaXAgPSBzdGFydFBvaW50LnBsdXMoIGRpci50aW1lc1NjYWxhciggT3B0aWNzTGFiQ29uc3RhbnRzLk1BWElNVU1fUkFZX0xFTkdUSCApICk7XHJcblxyXG4gICAgLy9sb29wIHRocnUgYWxsIGNvbXBvbmVudHMsIGNoZWNraW5nIGZvciBpbnRlcnNlY3Rpb24gb2YgcmF5IGFuZCBjb21wb25lbnRcclxuICAgIGxldCBjb21wb25lbnRJbnRlcnNlY3RlZEluZGV4O1xyXG4gICAgZm9yICggbGV0IGogPSAwOyBqIDwgdGhpcy5jb21wb25lbnRzLmxlbmd0aDsgaisrICkge1xyXG4gICAgICBjb25zdCBjb21wRGlhbWV0ZXIgPSB0aGlzLmNvbXBvbmVudHMuZ2V0KCBqICkuZGlhbWV0ZXJQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgY29uc3QgY29tcENlbnRlciA9IHRoaXMuY29tcG9uZW50cy5nZXQoIGogKS5wb3NpdGlvblByb3BlcnR5LnZhbHVlO1xyXG4gICAgICBjb25zdCBjb21wQW5nbGUgPSAtdGhpcy5jb21wb25lbnRzLmdldCggaiApLmFuZ2xlUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIGNvbnN0IHNpbkFuZ2xlID0gTWF0aC5zaW4oIGNvbXBBbmdsZSApO1xyXG4gICAgICBjb25zdCBjb3NBbmdsZSA9IE1hdGguY29zKCBjb21wQW5nbGUgKTtcclxuICAgICAgY29uc3QgdGhpc0ludGVyc2VjdGlvbiA9IFV0aWxzLmxpbmVTZWdtZW50SW50ZXJzZWN0aW9uKFxyXG4gICAgICAgIHN0YXJ0UG9pbnQueCwgc3RhcnRQb2ludC55LCByYXlUaXAueCwgcmF5VGlwLnksXHJcbiAgICAgICAgY29tcENlbnRlci54IC0gKCBjb21wRGlhbWV0ZXIgLyAyICkgKiBzaW5BbmdsZSxcclxuICAgICAgICBjb21wQ2VudGVyLnkgLSAoIGNvbXBEaWFtZXRlciAvIDIgKSAqIGNvc0FuZ2xlLFxyXG4gICAgICAgIGNvbXBDZW50ZXIueCArICggY29tcERpYW1ldGVyIC8gMiApICogc2luQW5nbGUsXHJcbiAgICAgICAgY29tcENlbnRlci55ICsgKCBjb21wRGlhbWV0ZXIgLyAyICkgKiBjb3NBbmdsZSApO1xyXG4gICAgICBpZiAoIHRoaXNJbnRlcnNlY3Rpb24gIT09IG51bGwgKSB7XHJcbiAgICAgICAgY29uc3QgZGlzdCA9IHRoaXNJbnRlcnNlY3Rpb24uZGlzdGFuY2UoIHN0YXJ0UG9pbnQgKTtcclxuICAgICAgICBpZiAoIGRpc3QgPiAyICYmIGRpc3QgPCBkaXN0YW5jZVRvSW50ZXJzZWN0aW9uICkgeyAgICAvLz4gMTAgdG8gYmUgc3VyZSBjb21wb25lbnQgZG9lcyBub3QgaW50ZXJzZWN0IGl0cyBvd24gc3RhcnRpbmcgcmF5XHJcbiAgICAgICAgICBkaXN0YW5jZVRvSW50ZXJzZWN0aW9uID0gZGlzdDtcclxuICAgICAgICAgIGludGVyc2VjdGlvbiA9IHRoaXNJbnRlcnNlY3Rpb247XHJcbiAgICAgICAgICBjb21wb25lbnRJbnRlcnNlY3RlZEluZGV4ID0gajtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0vL2VuZCBjb21wb25lbnQgbG9vcFxyXG5cclxuICAgIGlmICggaW50ZXJzZWN0aW9uICE9PSBudWxsICkge1xyXG4gICAgICByYXlQYXRoLmFkZFNlZ21lbnQoIHN0YXJ0UG9pbnQsIGludGVyc2VjdGlvbiApO1xyXG4gICAgICBjb25zdCB0YWlsU2VnbWVudE5iciA9IHJheVBhdGguc2VnbWVudHMubGVuZ3RoIC0gMTtcclxuICAgICAgdGhpcy5wcm9jZXNzSW50ZXJzZWN0aW9uKCByYXlQYXRoLCBpbnRlcnNlY3Rpb24sIHRhaWxTZWdtZW50TmJyLCBjb21wb25lbnRJbnRlcnNlY3RlZEluZGV4ICk7XHJcbiAgICAgIHJheVBhdGgubmJyU2VnbWVudHMgKz0gMTsgIC8vaW5jcmVtZW50IHNlZ21lbnQgY291bnRlciB0byBjaGVjayBmb3IgcnVuYXdheSByYXlwYXRoXHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgcmF5UGF0aC5hZGRTZWdtZW50KCBzdGFydFBvaW50LCByYXlUaXAgKTsgICAvL3JheVBhdGggZW5kc1xyXG4gICAgfVxyXG5cclxuICB9IC8vZW5kIGxhdW5jaFJheSgpXHJcblxyXG4gIC8qKlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtSYXlQYXRofSByYXlQYXRoXHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBpbnRlcnNlY3Rpb25cclxuICAgKiBAcGFyYW0ge251bWJlcn0gc2VnbWVudE5iclxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBjb21wb25lbnROYnJcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIHByb2Nlc3NJbnRlcnNlY3Rpb24oIHJheVBhdGgsIGludGVyc2VjdGlvbiwgc2VnbWVudE5iciwgY29tcG9uZW50TmJyICkge1xyXG4gICAgY29uc3QgaW5jb21pbmdSYXlEaXIgPSByYXlQYXRoLmRpcnNbIHNlZ21lbnROYnIgXTtcclxuICAgIGNvbnN0IGluY29taW5nQW5nbGUgPSBpbmNvbWluZ1JheURpci5hbmdsZTsgICAvL2FuZ2xlIGluIHJhZHMgYmV0d2VlbiBkaXJlY3Rpb24gb2YgcmF5IGFuZCBjb21wb25lbnQgbm9ybWFsXHJcbiAgICBsZXQgb3V0Z29pbmdBbmdsZTtcclxuICAgIGNvbnN0IGNvbXBvbmVudCA9IHRoaXMuY29tcG9uZW50cy5nZXQoIGNvbXBvbmVudE5iciApO1xyXG4gICAgY29uc3QgY29tcG9uZW50QW5nbGUgPSBjb21wb25lbnQuYW5nbGVQcm9wZXJ0eS52YWx1ZTsgIC8vdGlsdCBvZiBjb21wb25lbnQgPSBhbmdsZSBiZXR3ZWVuIGhvcml6b250YWwgYW5kIGNvbXBvbmVudCBub3JtYWxcclxuICAgIGNvbnN0IGNvbXBvbmVudE5vcm1hbCA9IG5ldyBWZWN0b3IyKCBNYXRoLmNvcyggY29tcG9uZW50QW5nbGUgKSwgTWF0aC5zaW4oIGNvbXBvbmVudEFuZ2xlICkgKTtcclxuICAgIGNvbnN0IGNvbXBvbmVudFBhcmFsbGVsID0gbmV3IFZlY3RvcjIoIC1NYXRoLnNpbiggY29tcG9uZW50QW5nbGUgKSwgTWF0aC5jb3MoIGNvbXBvbmVudEFuZ2xlICkgKTtcclxuICAgIGNvbnN0IGFuZ2xlSW5SYWRzID0gaW5jb21pbmdBbmdsZSAtIGNvbXBvbmVudEFuZ2xlO1xyXG4gICAgbGV0IG5vcm1hbERpcmVjdGlvbiA9IHRydWU7XHJcbiAgICBpZiAoIGluY29taW5nUmF5RGlyLmRvdCggY29tcG9uZW50Tm9ybWFsICkgPCAwICkge1xyXG4gICAgICBub3JtYWxEaXJlY3Rpb24gPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByID0gKCBpbnRlcnNlY3Rpb24ubWludXMoIGNvbXBvbmVudC5wb3NpdGlvblByb3BlcnR5LnZhbHVlICkgKS5kb3QoIGNvbXBvbmVudFBhcmFsbGVsICk7XHJcblxyXG4gICAgY29uc3QgZiA9IGNvbXBvbmVudC5mUHJvcGVydHkudmFsdWU7ICAgLy9mID0gZm9jYWwgbGVuZ3RoXHJcbiAgICBjb25zdCB0YW5UaGV0YSA9IE1hdGgudGFuKCBhbmdsZUluUmFkcyApO1xyXG4gICAgbGV0IG5ld0RpcjtcclxuICAgIGlmICggcmF5UGF0aC5uYnJTZWdtZW50cyA+IHJheVBhdGgubWF4TmJyU2VnbWVudHMgKSB7XHJcbiAgICAgIC8vZG8gbm90aGluZywgcmF5IHRlcm1pbmF0ZXMgaWYgdG9vIG1hbnkgc2VnbWVudHMsIHByb2JhYmx5IGNhdWdodCBpbiBpbmZpbml0ZSByZWZsZWN0aW9uIGxvb3BcclxuICAgICAgY29uc29sZS5sb2coICdNYXggbnVtYmVyIG9mIHJheXBhdGggc2VnbWVudHMgZXhjZWVkZWQnICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggY29tcG9uZW50LnR5cGUgPT09IFR5cGUuQ09OVkVSR0lOR19MRU5TIHx8IGNvbXBvbmVudC50eXBlID09PSBUeXBlLkRJVkVSR0lOR19MRU5TICkge1xyXG4gICAgICBpZiAoIG5vcm1hbERpcmVjdGlvbiApIHtcclxuICAgICAgICBvdXRnb2luZ0FuZ2xlID0gLU1hdGguYXRhbiggKCByIC8gZiApIC0gdGFuVGhldGEgKSArIGNvbXBvbmVudEFuZ2xlO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIG91dGdvaW5nQW5nbGUgPSBNYXRoLlBJICsgTWF0aC5hdGFuKCAoIHIgLyBmICkgKyB0YW5UaGV0YSApICsgY29tcG9uZW50QW5nbGU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIG5ld0RpciA9IFZlY3RvcjIuY3JlYXRlUG9sYXIoIDEsIG91dGdvaW5nQW5nbGUgKTtcclxuICAgICAgdGhpcy5sYXVuY2hSYXkoIHJheVBhdGgsIGludGVyc2VjdGlvbiwgbmV3RGlyICk7XHJcblxyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIGNvbXBvbmVudC50eXBlID09PSBUeXBlLkNPTlZFUkdJTkdfTUlSUk9SICkge1xyXG4gICAgICBpZiAoIG5vcm1hbERpcmVjdGlvbiApIHtcclxuICAgICAgICBvdXRnb2luZ0FuZ2xlID0gTWF0aC5QSSArIE1hdGguYXRhbiggKCByIC8gZiApIC0gdGFuVGhldGEgKSArIGNvbXBvbmVudEFuZ2xlO1xyXG4gICAgICAgIG5ld0RpciA9IFZlY3RvcjIuY3JlYXRlUG9sYXIoIDEsIG91dGdvaW5nQW5nbGUgKTtcclxuICAgICAgICB0aGlzLmxhdW5jaFJheSggcmF5UGF0aCwgaW50ZXJzZWN0aW9uLCBuZXdEaXIgKTtcclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBjb21wb25lbnQudHlwZSA9PT0gVHlwZS5ESVZFUkdJTkdfTUlSUk9SICkge1xyXG4gICAgICBpZiAoIG5vcm1hbERpcmVjdGlvbiApIHtcclxuICAgICAgICBvdXRnb2luZ0FuZ2xlID0gTWF0aC5QSSArIE1hdGguYXRhbiggKCByIC8gZiApIC0gdGFuVGhldGEgKSArIGNvbXBvbmVudEFuZ2xlO1xyXG4gICAgICAgIG5ld0RpciA9IFZlY3RvcjIuY3JlYXRlUG9sYXIoIDEsIG91dGdvaW5nQW5nbGUgKTtcclxuICAgICAgICB0aGlzLmxhdW5jaFJheSggcmF5UGF0aCwgaW50ZXJzZWN0aW9uLCBuZXdEaXIgKTtcclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBjb21wb25lbnQudHlwZSA9PT0gVHlwZS5QTEFORV9NSVJST1IgKSB7XHJcbiAgICAgIGlmICggbm9ybWFsRGlyZWN0aW9uICkge1xyXG4gICAgICAgIG91dGdvaW5nQW5nbGUgPSBNYXRoLlBJIC0gYW5nbGVJblJhZHMgKyBjb21wb25lbnRBbmdsZTtcclxuICAgICAgICBuZXdEaXIgPSBWZWN0b3IyLmNyZWF0ZVBvbGFyKCAxLCBvdXRnb2luZ0FuZ2xlICk7XHJcbiAgICAgICAgdGhpcy5sYXVuY2hSYXkoIHJheVBhdGgsIGludGVyc2VjdGlvbiwgbmV3RGlyICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggY29tcG9uZW50LnR5cGUgPT09IFR5cGUuU0lNUExFX01BU0sgKSB7XHJcbiAgICAgIC8vRG8gbm90aGluZy4gVGhlIHJheVBhdGggZW5kcyBhdCBhIG1hc2suXHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgY29uc29sZS5sb2coICdFUlJPUjogaW50ZXJzZWN0aW9uIGNvbXBvbmVudCBpcyB1bmtub3duLicgKTtcclxuICAgIH1cclxuICB9Ly9lbmQgcHJvY2Vzc0ludGVyc2VjdGlvbigpXHJcbn1cclxuXHJcbm9wdGljc0xhYi5yZWdpc3RlciggJ09wdGljc0xhYk1vZGVsJywgT3B0aWNzTGFiTW9kZWwgKTtcclxuZXhwb3J0IGRlZmF1bHQgT3B0aWNzTGFiTW9kZWw7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9B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