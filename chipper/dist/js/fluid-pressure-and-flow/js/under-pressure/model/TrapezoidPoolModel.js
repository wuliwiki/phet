// Copyright 2013-2021, University of Colorado Boulder

/**
 * main Model for trapezoid pool screen.
 *
 * @author Vasily Shakhov (Mlearner)
 * @author Siddhartha Chinthapally (Actual Concepts)
 */

import LinearFunction from '../../../../dot/js/LinearFunction.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Constants from '../../common/Constants.js';
import fluidPressureAndFlow from '../../fluidPressureAndFlow.js';
import FaucetModel from './FaucetModel.js';
import PoolWithFaucetsModel from './PoolWithFaucetsModel.js';

// constants
// empirically determined to match the visual appearance from design document
const WIDTH_AT_TOP = 0.7; //meters,
const WIDTH_AT_BOTTOM = 3.15; //meters,
const LEFT_CHAMBER_TOP_CENTER = 3.2; //meters,
const SEPARATION = 3.22; //Between centers

class TrapezoidPoolModel extends PoolWithFaucetsModel {
  /**
   * @param {UnderPressureModel} underPressureModel
   */
  constructor(underPressureModel) {
    //constants
    const maxHeight = Constants.MAX_POOL_HEIGHT; // @public - meters

    //TODO this assignment makes no sense
    const maxVolume = maxHeight; // @public - Liters

    // empirically determined to make sure input faucet is above ground , output faucet is below ground and output
    // faucet is attached to the pool
    const inputFaucetX = 3.19;
    const inputFaucetY = 0.44;
    const outputFaucetX = 7.5;
    const outputFaucetY = -3.45;
    const inputFaucet = new FaucetModel(new Vector2(inputFaucetX, inputFaucetY), 1, 0.42); // @public
    const outputFaucet = new FaucetModel(new Vector2(outputFaucetX, outputFaucetY), 1, 0.3); // @public

    super(underPressureModel, inputFaucet, outputFaucet, maxVolume);
    this.maxHeight = maxHeight;
    this.maxVolume = maxVolume;
    this.underPressureModel = underPressureModel;
    this.inputFaucet = inputFaucet;
    this.outputFaucet = outputFaucet;

    // @public
    this.poolDimensions = {
      leftChamber: {
        centerTop: LEFT_CHAMBER_TOP_CENTER,
        widthTop: WIDTH_AT_TOP,
        widthBottom: WIDTH_AT_BOTTOM,
        y: 0,
        height: this.maxHeight,
        leftBorderFunction: new LinearFunction(0, this.maxHeight, LEFT_CHAMBER_TOP_CENTER - WIDTH_AT_BOTTOM / 2, LEFT_CHAMBER_TOP_CENTER - WIDTH_AT_TOP / 2),
        rightBorderFunction: new LinearFunction(0, this.maxHeight, LEFT_CHAMBER_TOP_CENTER + WIDTH_AT_BOTTOM / 2, LEFT_CHAMBER_TOP_CENTER + WIDTH_AT_TOP / 2)
      },
      rightChamber: {
        centerTop: LEFT_CHAMBER_TOP_CENTER + SEPARATION,
        widthTop: WIDTH_AT_BOTTOM,
        widthBottom: WIDTH_AT_TOP,
        y: 0,
        height: this.maxHeight,
        leftBorderFunction: new LinearFunction(0, this.maxHeight, LEFT_CHAMBER_TOP_CENTER + SEPARATION - WIDTH_AT_TOP / 2, LEFT_CHAMBER_TOP_CENTER + SEPARATION - WIDTH_AT_BOTTOM / 2),
        rightBorderFunction: new LinearFunction(0, this.maxHeight, LEFT_CHAMBER_TOP_CENTER + SEPARATION + WIDTH_AT_TOP / 2, LEFT_CHAMBER_TOP_CENTER + SEPARATION + WIDTH_AT_BOTTOM / 2)
      },
      bottomChamber: {
        x1: 4,
        y1: -this.maxHeight + 0.21,
        x2: 6,
        y2: -this.maxHeight
      }
    };

    // @public
    //key coordinates of complex figure
    this.verticles = {
      x1top: this.poolDimensions.leftChamber.centerTop - this.poolDimensions.leftChamber.widthTop / 2,
      x2top: this.poolDimensions.leftChamber.centerTop + this.poolDimensions.leftChamber.widthTop / 2,
      x3top: this.poolDimensions.rightChamber.centerTop - this.poolDimensions.rightChamber.widthTop / 2,
      x4top: this.poolDimensions.rightChamber.centerTop + this.poolDimensions.rightChamber.widthTop / 2,
      x1middle: this.poolDimensions.leftChamber.rightBorderFunction.evaluate(Math.abs(this.poolDimensions.bottomChamber.y2 - this.poolDimensions.bottomChamber.y1)),
      x2middle: this.poolDimensions.rightChamber.leftBorderFunction.evaluate(Math.abs(this.poolDimensions.bottomChamber.y2 - this.poolDimensions.bottomChamber.y1)),
      x1bottom: this.poolDimensions.leftChamber.centerTop - this.poolDimensions.leftChamber.widthBottom / 2,
      x2bottom: this.poolDimensions.leftChamber.centerTop + this.poolDimensions.leftChamber.widthBottom / 2,
      x3bottom: this.poolDimensions.rightChamber.centerTop - this.poolDimensions.rightChamber.widthBottom / 2,
      x4bottom: this.poolDimensions.rightChamber.centerTop + this.poolDimensions.rightChamber.widthBottom / 2,
      ymiddle: this.poolDimensions.bottomChamber.y1
    };
  }

  /**
   * @public
   * Returns height of the water above the given position
   * @param {number} x - position in meters
   * @param {number} y - position in meters
   * @returns {number} height of the water above the y
   */
  getWaterHeightAboveY(x, y) {
    return this.maxHeight * this.volumeProperty.value / this.maxVolume + this.poolDimensions.bottomChamber.y2 - y;
  }

  /**
   * @public
   * Returns true if the given point is inside the trapezoid pool, false otherwise.
   * @param {number} x - position in meters
   * @param {number} y - position in meters
   * @returns {boolean}
   */
  isPointInsidePool(x, y) {
    let isInside = false;
    if (x > this.poolDimensions.bottomChamber.x1 && x < this.poolDimensions.bottomChamber.x2 && y < this.poolDimensions.bottomChamber.y1 && y > this.poolDimensions.bottomChamber.y2) {
      //inside bottom chamber
      isInside = true;
    } else {
      const yDiffWithPoolBottom = y - this.poolDimensions.bottomChamber.y2;
      if (yDiffWithPoolBottom > 0) {
        const x1 = this.poolDimensions.leftChamber.leftBorderFunction.evaluate(yDiffWithPoolBottom);
        const x2 = this.poolDimensions.leftChamber.rightBorderFunction.evaluate(yDiffWithPoolBottom);
        const x3 = this.poolDimensions.rightChamber.leftBorderFunction.evaluate(yDiffWithPoolBottom);
        const x4 = this.poolDimensions.rightChamber.rightBorderFunction.evaluate(yDiffWithPoolBottom);

        //inside left or right chamber
        isInside = x1 < x && x < x2 || x3 < x && x < x4;
      }
    }
    return isInside;
  }
}
fluidPressureAndFlow.register('TrapezoidPoolModel', TrapezoidPoolModel);
export default TrapezoidPoolModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJMaW5lYXJGdW5jdGlvbiIsIlZlY3RvcjIiLCJDb25zdGFudHMiLCJmbHVpZFByZXNzdXJlQW5kRmxvdyIsIkZhdWNldE1vZGVsIiwiUG9vbFdpdGhGYXVjZXRzTW9kZWwiLCJXSURUSF9BVF9UT1AiLCJXSURUSF9BVF9CT1RUT00iLCJMRUZUX0NIQU1CRVJfVE9QX0NFTlRFUiIsIlNFUEFSQVRJT04iLCJUcmFwZXpvaWRQb29sTW9kZWwiLCJjb25zdHJ1Y3RvciIsInVuZGVyUHJlc3N1cmVNb2RlbCIsIm1heEhlaWdodCIsIk1BWF9QT09MX0hFSUdIVCIsIm1heFZvbHVtZSIsImlucHV0RmF1Y2V0WCIsImlucHV0RmF1Y2V0WSIsIm91dHB1dEZhdWNldFgiLCJvdXRwdXRGYXVjZXRZIiwiaW5wdXRGYXVjZXQiLCJvdXRwdXRGYXVjZXQiLCJwb29sRGltZW5zaW9ucyIsImxlZnRDaGFtYmVyIiwiY2VudGVyVG9wIiwid2lkdGhUb3AiLCJ3aWR0aEJvdHRvbSIsInkiLCJoZWlnaHQiLCJsZWZ0Qm9yZGVyRnVuY3Rpb24iLCJyaWdodEJvcmRlckZ1bmN0aW9uIiwicmlnaHRDaGFtYmVyIiwiYm90dG9tQ2hhbWJlciIsIngxIiwieTEiLCJ4MiIsInkyIiwidmVydGljbGVzIiwieDF0b3AiLCJ4MnRvcCIsIngzdG9wIiwieDR0b3AiLCJ4MW1pZGRsZSIsImV2YWx1YXRlIiwiTWF0aCIsImFicyIsIngybWlkZGxlIiwieDFib3R0b20iLCJ4MmJvdHRvbSIsIngzYm90dG9tIiwieDRib3R0b20iLCJ5bWlkZGxlIiwiZ2V0V2F0ZXJIZWlnaHRBYm92ZVkiLCJ4Iiwidm9sdW1lUHJvcGVydHkiLCJ2YWx1ZSIsImlzUG9pbnRJbnNpZGVQb29sIiwiaXNJbnNpZGUiLCJ5RGlmZldpdGhQb29sQm90dG9tIiwieDMiLCJ4NCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiVHJhcGV6b2lkUG9vbE1vZGVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDEzLTIwMjEsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIG1haW4gTW9kZWwgZm9yIHRyYXBlem9pZCBwb29sIHNjcmVlbi5cclxuICpcclxuICogQGF1dGhvciBWYXNpbHkgU2hha2hvdiAoTWxlYXJuZXIpXHJcbiAqIEBhdXRob3IgU2lkZGhhcnRoYSBDaGludGhhcGFsbHkgKEFjdHVhbCBDb25jZXB0cylcclxuICovXHJcblxyXG5pbXBvcnQgTGluZWFyRnVuY3Rpb24gZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0xpbmVhckZ1bmN0aW9uLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgZmx1aWRQcmVzc3VyZUFuZEZsb3cgZnJvbSAnLi4vLi4vZmx1aWRQcmVzc3VyZUFuZEZsb3cuanMnO1xyXG5pbXBvcnQgRmF1Y2V0TW9kZWwgZnJvbSAnLi9GYXVjZXRNb2RlbC5qcyc7XHJcbmltcG9ydCBQb29sV2l0aEZhdWNldHNNb2RlbCBmcm9tICcuL1Bvb2xXaXRoRmF1Y2V0c01vZGVsLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG4vLyBlbXBpcmljYWxseSBkZXRlcm1pbmVkIHRvIG1hdGNoIHRoZSB2aXN1YWwgYXBwZWFyYW5jZSBmcm9tIGRlc2lnbiBkb2N1bWVudFxyXG5jb25zdCBXSURUSF9BVF9UT1AgPSAwLjc7IC8vbWV0ZXJzLFxyXG5jb25zdCBXSURUSF9BVF9CT1RUT00gPSAzLjE1OyAvL21ldGVycyxcclxuY29uc3QgTEVGVF9DSEFNQkVSX1RPUF9DRU5URVIgPSAzLjI7IC8vbWV0ZXJzLFxyXG5jb25zdCBTRVBBUkFUSU9OID0gMy4yMjsvL0JldHdlZW4gY2VudGVyc1xyXG5cclxuY2xhc3MgVHJhcGV6b2lkUG9vbE1vZGVsIGV4dGVuZHMgUG9vbFdpdGhGYXVjZXRzTW9kZWwge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1VuZGVyUHJlc3N1cmVNb2RlbH0gdW5kZXJQcmVzc3VyZU1vZGVsXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIHVuZGVyUHJlc3N1cmVNb2RlbCApIHtcclxuXHJcbiAgICAvL2NvbnN0YW50c1xyXG4gICAgY29uc3QgbWF4SGVpZ2h0ID0gQ29uc3RhbnRzLk1BWF9QT09MX0hFSUdIVDsgLy8gQHB1YmxpYyAtIG1ldGVyc1xyXG5cclxuICAgIC8vVE9ETyB0aGlzIGFzc2lnbm1lbnQgbWFrZXMgbm8gc2Vuc2VcclxuICAgIGNvbnN0IG1heFZvbHVtZSA9IG1heEhlaWdodDsgLy8gQHB1YmxpYyAtIExpdGVyc1xyXG5cclxuICAgIC8vIGVtcGlyaWNhbGx5IGRldGVybWluZWQgdG8gbWFrZSBzdXJlIGlucHV0IGZhdWNldCBpcyBhYm92ZSBncm91bmQgLCBvdXRwdXQgZmF1Y2V0IGlzIGJlbG93IGdyb3VuZCBhbmQgb3V0cHV0XHJcbiAgICAvLyBmYXVjZXQgaXMgYXR0YWNoZWQgdG8gdGhlIHBvb2xcclxuICAgIGNvbnN0IGlucHV0RmF1Y2V0WCA9IDMuMTk7XHJcbiAgICBjb25zdCBpbnB1dEZhdWNldFkgPSAwLjQ0O1xyXG4gICAgY29uc3Qgb3V0cHV0RmF1Y2V0WCA9IDcuNTtcclxuICAgIGNvbnN0IG91dHB1dEZhdWNldFkgPSAtMy40NTtcclxuICAgIGNvbnN0IGlucHV0RmF1Y2V0ID0gbmV3IEZhdWNldE1vZGVsKCBuZXcgVmVjdG9yMiggaW5wdXRGYXVjZXRYLCBpbnB1dEZhdWNldFkgKSwgMSwgMC40MiApOyAvLyBAcHVibGljXHJcbiAgICBjb25zdCBvdXRwdXRGYXVjZXQgPSBuZXcgRmF1Y2V0TW9kZWwoIG5ldyBWZWN0b3IyKCBvdXRwdXRGYXVjZXRYLCBvdXRwdXRGYXVjZXRZICksIDEsIDAuMyApOyAvLyBAcHVibGljXHJcblxyXG4gICAgc3VwZXIoIHVuZGVyUHJlc3N1cmVNb2RlbCwgaW5wdXRGYXVjZXQsIG91dHB1dEZhdWNldCwgbWF4Vm9sdW1lICk7XHJcblxyXG4gICAgdGhpcy5tYXhIZWlnaHQgPSBtYXhIZWlnaHQ7XHJcbiAgICB0aGlzLm1heFZvbHVtZSA9IG1heFZvbHVtZTtcclxuICAgIHRoaXMudW5kZXJQcmVzc3VyZU1vZGVsID0gdW5kZXJQcmVzc3VyZU1vZGVsO1xyXG4gICAgdGhpcy5pbnB1dEZhdWNldCA9IGlucHV0RmF1Y2V0O1xyXG4gICAgdGhpcy5vdXRwdXRGYXVjZXQgPSBvdXRwdXRGYXVjZXQ7XHJcblxyXG4gICAgLy8gQHB1YmxpY1xyXG4gICAgdGhpcy5wb29sRGltZW5zaW9ucyA9IHtcclxuICAgICAgbGVmdENoYW1iZXI6IHtcclxuICAgICAgICBjZW50ZXJUb3A6IExFRlRfQ0hBTUJFUl9UT1BfQ0VOVEVSLFxyXG4gICAgICAgIHdpZHRoVG9wOiBXSURUSF9BVF9UT1AsXHJcbiAgICAgICAgd2lkdGhCb3R0b206IFdJRFRIX0FUX0JPVFRPTSxcclxuICAgICAgICB5OiAwLFxyXG4gICAgICAgIGhlaWdodDogdGhpcy5tYXhIZWlnaHQsXHJcbiAgICAgICAgbGVmdEJvcmRlckZ1bmN0aW9uOiBuZXcgTGluZWFyRnVuY3Rpb24oIDAsIHRoaXMubWF4SGVpZ2h0LFxyXG4gICAgICAgICAgTEVGVF9DSEFNQkVSX1RPUF9DRU5URVIgLSBXSURUSF9BVF9CT1RUT00gLyAyLCBMRUZUX0NIQU1CRVJfVE9QX0NFTlRFUiAtIFdJRFRIX0FUX1RPUCAvIDIgKSxcclxuICAgICAgICByaWdodEJvcmRlckZ1bmN0aW9uOiBuZXcgTGluZWFyRnVuY3Rpb24oIDAsIHRoaXMubWF4SGVpZ2h0LFxyXG4gICAgICAgICAgTEVGVF9DSEFNQkVSX1RPUF9DRU5URVIgKyBXSURUSF9BVF9CT1RUT00gLyAyLCBMRUZUX0NIQU1CRVJfVE9QX0NFTlRFUiArIFdJRFRIX0FUX1RPUCAvIDIgKVxyXG4gICAgICB9LFxyXG4gICAgICByaWdodENoYW1iZXI6IHtcclxuICAgICAgICBjZW50ZXJUb3A6IExFRlRfQ0hBTUJFUl9UT1BfQ0VOVEVSICsgU0VQQVJBVElPTixcclxuICAgICAgICB3aWR0aFRvcDogV0lEVEhfQVRfQk9UVE9NLFxyXG4gICAgICAgIHdpZHRoQm90dG9tOiBXSURUSF9BVF9UT1AsXHJcbiAgICAgICAgeTogMCxcclxuICAgICAgICBoZWlnaHQ6IHRoaXMubWF4SGVpZ2h0LFxyXG4gICAgICAgIGxlZnRCb3JkZXJGdW5jdGlvbjogbmV3IExpbmVhckZ1bmN0aW9uKCAwLCB0aGlzLm1heEhlaWdodCxcclxuICAgICAgICAgIExFRlRfQ0hBTUJFUl9UT1BfQ0VOVEVSICsgU0VQQVJBVElPTiAtIFdJRFRIX0FUX1RPUCAvIDIsXHJcbiAgICAgICAgICBMRUZUX0NIQU1CRVJfVE9QX0NFTlRFUiArIFNFUEFSQVRJT04gLSBXSURUSF9BVF9CT1RUT00gLyAyICksXHJcbiAgICAgICAgcmlnaHRCb3JkZXJGdW5jdGlvbjogbmV3IExpbmVhckZ1bmN0aW9uKCAwLCB0aGlzLm1heEhlaWdodCxcclxuICAgICAgICAgIExFRlRfQ0hBTUJFUl9UT1BfQ0VOVEVSICsgU0VQQVJBVElPTiArIFdJRFRIX0FUX1RPUCAvIDIsXHJcbiAgICAgICAgICBMRUZUX0NIQU1CRVJfVE9QX0NFTlRFUiArIFNFUEFSQVRJT04gKyBXSURUSF9BVF9CT1RUT00gLyAyIClcclxuICAgICAgfSxcclxuICAgICAgYm90dG9tQ2hhbWJlcjoge1xyXG4gICAgICAgIHgxOiA0LFxyXG4gICAgICAgIHkxOiAtdGhpcy5tYXhIZWlnaHQgKyAwLjIxLFxyXG4gICAgICAgIHgyOiA2LFxyXG4gICAgICAgIHkyOiAtdGhpcy5tYXhIZWlnaHRcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBAcHVibGljXHJcbiAgICAvL2tleSBjb29yZGluYXRlcyBvZiBjb21wbGV4IGZpZ3VyZVxyXG4gICAgdGhpcy52ZXJ0aWNsZXMgPSB7XHJcbiAgICAgIHgxdG9wOiB0aGlzLnBvb2xEaW1lbnNpb25zLmxlZnRDaGFtYmVyLmNlbnRlclRvcCAtIHRoaXMucG9vbERpbWVuc2lvbnMubGVmdENoYW1iZXIud2lkdGhUb3AgLyAyLFxyXG4gICAgICB4MnRvcDogdGhpcy5wb29sRGltZW5zaW9ucy5sZWZ0Q2hhbWJlci5jZW50ZXJUb3AgKyB0aGlzLnBvb2xEaW1lbnNpb25zLmxlZnRDaGFtYmVyLndpZHRoVG9wIC8gMixcclxuICAgICAgeDN0b3A6IHRoaXMucG9vbERpbWVuc2lvbnMucmlnaHRDaGFtYmVyLmNlbnRlclRvcCAtIHRoaXMucG9vbERpbWVuc2lvbnMucmlnaHRDaGFtYmVyLndpZHRoVG9wIC8gMixcclxuICAgICAgeDR0b3A6IHRoaXMucG9vbERpbWVuc2lvbnMucmlnaHRDaGFtYmVyLmNlbnRlclRvcCArIHRoaXMucG9vbERpbWVuc2lvbnMucmlnaHRDaGFtYmVyLndpZHRoVG9wIC8gMixcclxuXHJcbiAgICAgIHgxbWlkZGxlOiB0aGlzLnBvb2xEaW1lbnNpb25zLmxlZnRDaGFtYmVyLnJpZ2h0Qm9yZGVyRnVuY3Rpb24uZXZhbHVhdGUoIE1hdGguYWJzKCB0aGlzLnBvb2xEaW1lbnNpb25zLmJvdHRvbUNoYW1iZXIueTIgLVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb29sRGltZW5zaW9ucy5ib3R0b21DaGFtYmVyLnkxICkgKSxcclxuICAgICAgeDJtaWRkbGU6IHRoaXMucG9vbERpbWVuc2lvbnMucmlnaHRDaGFtYmVyLmxlZnRCb3JkZXJGdW5jdGlvbi5ldmFsdWF0ZSggTWF0aC5hYnMoIHRoaXMucG9vbERpbWVuc2lvbnMuYm90dG9tQ2hhbWJlci55MiAtXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvb2xEaW1lbnNpb25zLmJvdHRvbUNoYW1iZXIueTEgKSApLFxyXG5cclxuICAgICAgeDFib3R0b206IHRoaXMucG9vbERpbWVuc2lvbnMubGVmdENoYW1iZXIuY2VudGVyVG9wIC0gdGhpcy5wb29sRGltZW5zaW9ucy5sZWZ0Q2hhbWJlci53aWR0aEJvdHRvbSAvIDIsXHJcbiAgICAgIHgyYm90dG9tOiB0aGlzLnBvb2xEaW1lbnNpb25zLmxlZnRDaGFtYmVyLmNlbnRlclRvcCArIHRoaXMucG9vbERpbWVuc2lvbnMubGVmdENoYW1iZXIud2lkdGhCb3R0b20gLyAyLFxyXG4gICAgICB4M2JvdHRvbTogdGhpcy5wb29sRGltZW5zaW9ucy5yaWdodENoYW1iZXIuY2VudGVyVG9wIC0gdGhpcy5wb29sRGltZW5zaW9ucy5yaWdodENoYW1iZXIud2lkdGhCb3R0b20gLyAyLFxyXG4gICAgICB4NGJvdHRvbTogdGhpcy5wb29sRGltZW5zaW9ucy5yaWdodENoYW1iZXIuY2VudGVyVG9wICsgdGhpcy5wb29sRGltZW5zaW9ucy5yaWdodENoYW1iZXIud2lkdGhCb3R0b20gLyAyLFxyXG5cclxuICAgICAgeW1pZGRsZTogdGhpcy5wb29sRGltZW5zaW9ucy5ib3R0b21DaGFtYmVyLnkxXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqIFJldHVybnMgaGVpZ2h0IG9mIHRoZSB3YXRlciBhYm92ZSB0aGUgZ2l2ZW4gcG9zaXRpb25cclxuICAgKiBAcGFyYW0ge251bWJlcn0geCAtIHBvc2l0aW9uIGluIG1ldGVyc1xyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gcG9zaXRpb24gaW4gbWV0ZXJzXHJcbiAgICogQHJldHVybnMge251bWJlcn0gaGVpZ2h0IG9mIHRoZSB3YXRlciBhYm92ZSB0aGUgeVxyXG4gICAqL1xyXG4gIGdldFdhdGVySGVpZ2h0QWJvdmVZKCB4LCB5ICkge1xyXG4gICAgcmV0dXJuIHRoaXMubWF4SGVpZ2h0ICogdGhpcy52b2x1bWVQcm9wZXJ0eS52YWx1ZSAvIHRoaXMubWF4Vm9sdW1lICsgdGhpcy5wb29sRGltZW5zaW9ucy5ib3R0b21DaGFtYmVyLnkyIC0geTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIHBvaW50IGlzIGluc2lkZSB0aGUgdHJhcGV6b2lkIHBvb2wsIGZhbHNlIG90aGVyd2lzZS5cclxuICAgKiBAcGFyYW0ge251bWJlcn0geCAtIHBvc2l0aW9uIGluIG1ldGVyc1xyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gcG9zaXRpb24gaW4gbWV0ZXJzXHJcbiAgICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAgICovXHJcbiAgaXNQb2ludEluc2lkZVBvb2woIHgsIHkgKSB7XHJcbiAgICBsZXQgaXNJbnNpZGUgPSBmYWxzZTtcclxuICAgIGlmICggeCA+IHRoaXMucG9vbERpbWVuc2lvbnMuYm90dG9tQ2hhbWJlci54MSAmJiB4IDwgdGhpcy5wb29sRGltZW5zaW9ucy5ib3R0b21DaGFtYmVyLngyICYmXHJcbiAgICAgICAgIHkgPCB0aGlzLnBvb2xEaW1lbnNpb25zLmJvdHRvbUNoYW1iZXIueTEgJiYgeSA+IHRoaXMucG9vbERpbWVuc2lvbnMuYm90dG9tQ2hhbWJlci55MiApIHtcclxuICAgICAgLy9pbnNpZGUgYm90dG9tIGNoYW1iZXJcclxuICAgICAgaXNJbnNpZGUgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNvbnN0IHlEaWZmV2l0aFBvb2xCb3R0b20gPSB5IC0gdGhpcy5wb29sRGltZW5zaW9ucy5ib3R0b21DaGFtYmVyLnkyO1xyXG4gICAgICBpZiAoIHlEaWZmV2l0aFBvb2xCb3R0b20gPiAwICkge1xyXG4gICAgICAgIGNvbnN0IHgxID0gdGhpcy5wb29sRGltZW5zaW9ucy5sZWZ0Q2hhbWJlci5sZWZ0Qm9yZGVyRnVuY3Rpb24uZXZhbHVhdGUoIHlEaWZmV2l0aFBvb2xCb3R0b20gKTtcclxuICAgICAgICBjb25zdCB4MiA9IHRoaXMucG9vbERpbWVuc2lvbnMubGVmdENoYW1iZXIucmlnaHRCb3JkZXJGdW5jdGlvbi5ldmFsdWF0ZSggeURpZmZXaXRoUG9vbEJvdHRvbSApO1xyXG4gICAgICAgIGNvbnN0IHgzID0gdGhpcy5wb29sRGltZW5zaW9ucy5yaWdodENoYW1iZXIubGVmdEJvcmRlckZ1bmN0aW9uLmV2YWx1YXRlKCB5RGlmZldpdGhQb29sQm90dG9tICk7XHJcbiAgICAgICAgY29uc3QgeDQgPSB0aGlzLnBvb2xEaW1lbnNpb25zLnJpZ2h0Q2hhbWJlci5yaWdodEJvcmRlckZ1bmN0aW9uLmV2YWx1YXRlKCB5RGlmZldpdGhQb29sQm90dG9tICk7XHJcblxyXG4gICAgICAgIC8vaW5zaWRlIGxlZnQgb3IgcmlnaHQgY2hhbWJlclxyXG4gICAgICAgIGlzSW5zaWRlID0gKCB4MSA8IHggJiYgeCA8IHgyICkgfHwgKCB4MyA8IHggJiYgeCA8IHg0ICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBpc0luc2lkZTtcclxuICB9XHJcbn1cclxuXHJcbmZsdWlkUHJlc3N1cmVBbmRGbG93LnJlZ2lzdGVyKCAnVHJhcGV6b2lkUG9vbE1vZGVsJywgVHJhcGV6b2lkUG9vbE1vZGVsICk7XHJcbmV4cG9ydCBkZWZhdWx0IFRyYXBlem9pZFBvb2xNb2RlbDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxjQUFjLE1BQU0sc0NBQXNDO0FBQ2pFLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsU0FBUyxNQUFNLDJCQUEyQjtBQUNqRCxPQUFPQyxvQkFBb0IsTUFBTSwrQkFBK0I7QUFDaEUsT0FBT0MsV0FBVyxNQUFNLGtCQUFrQjtBQUMxQyxPQUFPQyxvQkFBb0IsTUFBTSwyQkFBMkI7O0FBRTVEO0FBQ0E7QUFDQSxNQUFNQyxZQUFZLEdBQUcsR0FBRyxDQUFDLENBQUM7QUFDMUIsTUFBTUMsZUFBZSxHQUFHLElBQUksQ0FBQyxDQUFDO0FBQzlCLE1BQU1DLHVCQUF1QixHQUFHLEdB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