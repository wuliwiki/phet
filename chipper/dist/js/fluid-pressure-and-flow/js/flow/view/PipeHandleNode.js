// Copyright 2014-2022, University of Colorado Boulder

/**
 * View for a single handle on the flexible middle pipe and the pipe head rims.
 *
 * @author Siddhartha Chinthapally (Actual Concepts).
 */

import Bounds2 from '../../../../dot/js/Bounds2.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Image, Node, SimpleDragHandler } from '../../../../scenery/js/imports.js';
import handleWithBar_png from '../../../images/handleWithBar_png.js';
import fluidPressureAndFlow from '../../fluidPressureAndFlow.js';

// constants
const CONTROL_HANDLE_OFFSET = 2;
const PIPE_INITIAL_HEIGHT = 2.1; //in meters
const PIPE_INITIAL_SCALE = 0.36;
const CROSS_SECTION_MIN_HEIGHT = 1; //meters
const HANDLE_TOUCH_AREA_X_DILATION = 30;
class PipeHandleNode extends Node {
  /**
   * @param {PipeHandlesNode} pipeHandlesNode
   * @param {boolean} isTop indicates whether this handle is on top or bottom of the pipe flow line
   * @param {number} controlPointIndex
   * @param {ModelViewTransform2} modelViewTransform to convert between model and view co-ordinate frames
   */
  constructor(pipeHandlesNode, isTop, controlPointIndex, modelViewTransform) {
    super();
    const flowModel = pipeHandlesNode.flowModel;
    const pipeNode = pipeHandlesNode.pipeNode;
    const pipe = flowModel.pipe;
    const leftTopControlPointIndex = 1;
    const leftBottomControlPointIndex = 1;
    const rightTopControlPointIndex = pipe.top.length - 2;
    const rightBottomControlPointIndex = pipe.bottom.length - 2;
    const controlPoint = isTop ? pipe.top[controlPointIndex] : pipe.bottom[controlPointIndex];
    let leftSpace = 0; // to vertically align the handles
    let imageRotation = 0;
    if (controlPoint.positionProperty.value.y < -2) {
      leftSpace = -13;
    } else {
      imageRotation = Math.PI;
      leftSpace = 19;
    }
    const handleNode = new Image(handleWithBar_png, {
      left: leftSpace,
      cursor: 'pointer',
      scale: 0.32
    });

    // expand the touch area upwards for the top handles and downwards for bottom handles
    if (isTop) {
      handleNode.touchArea = new Bounds2(handleNode.localBounds.minX - HANDLE_TOUCH_AREA_X_DILATION, handleNode.localBounds.minY, handleNode.localBounds.maxX + HANDLE_TOUCH_AREA_X_DILATION, handleNode.localBounds.maxY + 40);
    } else {
      handleNode.touchArea = new Bounds2(handleNode.localBounds.minX - HANDLE_TOUCH_AREA_X_DILATION, handleNode.localBounds.minY + 30, handleNode.localBounds.maxX + HANDLE_TOUCH_AREA_X_DILATION, handleNode.localBounds.maxY + 60);
    }
    handleNode.setRotation(imageRotation);

    // handleNode is in charge of performing the rotation for the top control handles, whereas
    // the parent node controlHandleNode is in change of doing the translations
    const controlHandleNode = new Node({
      children: [handleNode]
    });
    this.addChild(controlHandleNode);
    controlPoint.positionProperty.link(position => {
      controlHandleNode.setTranslation(modelViewTransform.modelToViewX(position.x), modelViewTransform.modelToViewY(position.y));
    });
    let dragStartY;
    let controlPointDragStartY; // the model y value of the control point at drag start

    controlHandleNode.addInputListener(new SimpleDragHandler({
      start: event => {
        dragStartY = controlHandleNode.globalToParentPoint(event.pointer.point).y;
        controlPointDragStartY = controlPoint.positionProperty.value.y;
      },
      drag: event => {
        const offSetY = controlHandleNode.globalToParentPoint(event.pointer.point).y - dragStartY;

        // x position is constant for a control point
        const pt = new Vector2(controlPoint.positionProperty.value.x, controlPointDragStartY + modelViewTransform.viewToModelDeltaY(offSetY));

        // limit the y to (-4,0)
        pt.y = Utils.clamp(pt.y, -4, 0);

        // Prevent the two ends of the cross sections from crossing each other. Set the cross section to
        // minimum when the user tries to move the handle beyond the opposite control point.
        const oppositeControlPoint = isTop ? pipe.bottom[controlPointIndex] : pipe.top[controlPointIndex];
        if (isTop && pt.y < oppositeControlPoint.positionProperty.value.y) {
          pt.y = oppositeControlPoint.positionProperty.value.y + CROSS_SECTION_MIN_HEIGHT;
        } else if (!isTop && pt.y > oppositeControlPoint.positionProperty.value.y) {
          pt.y = oppositeControlPoint.positionProperty.value.y - CROSS_SECTION_MIN_HEIGHT;
        }

        // ensure that the cross section is at least 1 meter
        const yDiff = Math.abs(oppositeControlPoint.positionProperty.value.y - pt.y);
        if (yDiff >= CROSS_SECTION_MIN_HEIGHT) {
          controlPoint.positionProperty.value = pt;
          // When a control point is dragged, mark the pipe as dirty and update the pipe flow line shape
          pipe.dirty = true;
          pipeNode.updatePipeFlowLineShape();
          pipeHandlesNode.gridInjectorNode.updateGridInjector();
        }

        // handle the left pipe scaling
        let pipeExpansionFactor;
        if (controlPointIndex === leftBottomControlPointIndex && !isTop || controlPointIndex === leftTopControlPointIndex && isTop) {
          // calculate the pipe scale
          pipeExpansionFactor = pipe.getCrossSection(pipe.top[leftTopControlPointIndex].positionProperty.value.x).getHeight() / PIPE_INITIAL_HEIGHT;

          // limit the scaling to 0.18 on the lower side
          pipe.leftPipeScaleProperty.value = Math.max(pipeExpansionFactor * PIPE_INITIAL_SCALE, 0.18);
          pipe.leftPipeYPositionProperty.value = modelViewTransform.modelToViewY(pipe.top[leftTopControlPointIndex].positionProperty.value.y) - pipeNode.leftPipeYOffset * pipe.leftPipeScaleProperty.value;
          flowModel.pipe.leftPipeMainHandleYPositionProperty.value = pipeNode.leftPipeNode.centerY;
        }

        // handle the right  pipe scaling
        if (controlPointIndex === rightBottomControlPointIndex && !isTop || controlPointIndex === rightTopControlPointIndex && isTop) {
          const pipeHeight = pipe.getCrossSection(pipe.top[rightTopControlPointIndex].positionProperty.value.x).getHeight();
          pipeExpansionFactor = pipeHeight / PIPE_INITIAL_HEIGHT;

          // limit the scaling to 0.18 on the lower side
          pipe.rightPipeScaleProperty.value = Math.max(pipeExpansionFactor * PIPE_INITIAL_SCALE, 0.18);
          pipe.rightPipeYPositionProperty.value = modelViewTransform.modelToViewY(pipe.top[rightTopControlPointIndex].positionProperty.value.y) - pipeNode.rightPipeYOffset * pipe.rightPipeScaleProperty.value;
          flowModel.pipe.rightPipeMainHandleYPositionProperty.value = pipeNode.rightPipeNode.centerY;
        }

        // reposition the particles when the sim is paused and the handle is dragged
        if (!flowModel.isPlayingProperty.value) {
          pipeNode.particlesLayer.step();
        }

        // setting the left/right  pipe top/bottom  control point handle positions when left/right pipe  scale.
        if (controlPointIndex === leftTopControlPointIndex || controlPointIndex === leftBottomControlPointIndex) {
          pipe.leftPipeTopHandleYProperty.value = pipeNode.leftPipeNode.top + CONTROL_HANDLE_OFFSET;
          pipe.leftPipeBottomHandleYProperty.value = pipeNode.leftPipeNode.bottom - CONTROL_HANDLE_OFFSET;
        } else if (controlPointIndex === rightTopControlPointIndex || controlPointIndex === rightBottomControlPointIndex) {
          pipe.rightPipeTopHandleYProperty.value = pipeNode.rightPipeNode.top + CONTROL_HANDLE_OFFSET;
          pipe.rightPipeBottomHandleYProperty.value = pipeNode.rightPipeNode.bottom - CONTROL_HANDLE_OFFSET;
        }
        // emit an update on the flux meter only if it is visible
        if (flowModel.isFluxMeterVisibleProperty.value) {
          flowModel.fluxMeter.updateEmitter.emit();
        }
        flowModel.speedometers.forEach(speedometer => {
          speedometer.updateEmitter.emit();
        });

        // update the barometers
        flowModel.barometers.forEach(barometer => {
          barometer.updateEmitter.emit();
        });
      }
    }));
  }
}
fluidPressureAndFlow.register('PipeHandleNode', PipeHandleNode);
export default PipeHandleNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb3VuZHMyIiwiVXRpbHMiLCJWZWN0b3IyIiwiSW1hZ2UiLCJOb2RlIiwiU2ltcGxlRHJhZ0hhbmRsZXIiLCJoYW5kbGVXaXRoQmFyX3BuZyIsImZsdWlkUHJlc3N1cmVBbmRGbG93IiwiQ09OVFJPTF9IQU5ETEVfT0ZGU0VUIiwiUElQRV9JTklUSUFMX0hFSUdIVCIsIlBJUEVfSU5JVElBTF9TQ0FMRSIsIkNST1NTX1NFQ1RJT05fTUlOX0hFSUdIVCIsIkhBTkRMRV9UT1VDSF9BUkVBX1hfRElMQVRJT04iLCJQaXBlSGFuZGxlTm9kZSIsImNvbnN0cnVjdG9yIiwicGlwZUhhbmRsZXNOb2RlIiwiaXNUb3AiLCJjb250cm9sUG9pbnRJbmRleCIsIm1vZGVsVmlld1RyYW5zZm9ybSIsImZsb3dNb2RlbCIsInBpcGVOb2RlIiwicGlwZSIsImxlZnRUb3BDb250cm9sUG9pbnRJbmRleCIsImxlZnRCb3R0b21Db250cm9sUG9pbnRJbmRleCIsInJpZ2h0VG9wQ29udHJvbFBvaW50SW5kZXgiLCJ0b3AiLCJsZW5ndGgiLCJyaWdodEJvdHRvbUNvbnRyb2xQb2ludEluZGV4IiwiYm90dG9tIiwiY29udHJvbFBvaW50IiwibGVmdFNwYWNlIiwiaW1hZ2VSb3RhdGlvbiIsInBvc2l0aW9uUHJvcGVydHkiLCJ2YWx1ZSIsInkiLCJNYXRoIiwiUEkiLCJoYW5kbGVOb2RlIiwibGVmdCIsImN1cnNvciIsInNjYWxlIiwidG91Y2hBcmVhIiwibG9jYWxCb3VuZHMiLCJtaW5YIiwibWluWSIsIm1heFgiLCJtYXhZIiwic2V0Um90YXRpb24iLCJjb250cm9sSGFuZGxlTm9kZSIsImNoaWxkcmVuIiwiYWRkQ2hpbGQiLCJsaW5rIiwicG9zaXRpb24iLCJzZXRUcmFuc2xhdGlvbiIsIm1vZGVsVG9WaWV3WCIsIngiLCJtb2RlbFRvVmlld1kiLCJkcmFnU3RhcnRZIiwiY29udHJvbFBvaW50RHJhZ1N0YXJ0WSIsImFkZElucHV0TGlzdGVuZXIiLCJzdGFydCIsImV2ZW50IiwiZ2xvYmFsVG9QYXJlbnRQb2ludCIsInBvaW50ZXIiLCJwb2ludCIsImRyYWciLCJvZmZTZXRZIiwicHQiLCJ2aWV3VG9Nb2RlbERlbHRhWSIsImNsYW1wIiwib3Bwb3NpdGVDb250cm9sUG9pbnQiLCJ5RGlmZiIsImFicyIsImRpcnR5IiwidXBkYXRlUGlwZUZsb3dMaW5lU2hhcGUiLCJncmlkSW5qZWN0b3JOb2RlIiwidXBkYXRlR3JpZEluamVjdG9yIiwicGlwZUV4cGFuc2lvbkZhY3RvciIsImdldENyb3NzU2VjdGlvbiIsImdldEhlaWdodCIsImxlZnRQaXBlU2NhbGVQcm9wZXJ0eSIsIm1heCIsImxlZnRQaXBlWVBvc2l0aW9uUHJvcGVydHkiLCJsZWZ0UGlwZVlPZmZzZXQiLCJsZWZ0UGlwZU1haW5IYW5kbGVZUG9zaXRpb25Qcm9wZXJ0eSIsImxlZnRQaXBlTm9kZSIsImNlbnRlclkiLCJwaXBlSGVpZ2h0IiwicmlnaHRQaXBlU2NhbGVQcm9wZXJ0eSIsInJpZ2h0UGlwZVlQb3NpdGlvblByb3BlcnR5IiwicmlnaHRQaXBlWU9mZnNldCIsInJpZ2h0UGlwZU1haW5IYW5kbGVZUG9zaXRpb25Qcm9wZXJ0eSIsInJpZ2h0UGlwZU5vZGUiLCJpc1BsYXlpbmdQcm9wZXJ0eSIsInBhcnRpY2xlc0xheWVyIiwic3RlcCIsImxlZnRQaXBlVG9wSGFuZGxlWVByb3BlcnR5IiwibGVmdFBpcGVCb3R0b21IYW5kbGVZUHJvcGVydHkiLCJyaWdodFBpcGVUb3BIYW5kbGVZUHJvcGVydHkiLCJyaWdodFBpcGVCb3R0b21IYW5kbGVZUHJvcGVydHkiLCJpc0ZsdXhNZXRlclZpc2libGVQcm9wZXJ0eSIsImZsdXhNZXRlciIsInVwZGF0ZUVtaXR0ZXIiLCJlbWl0Iiwic3BlZWRvbWV0ZXJzIiwiZm9yRWFjaCIsInNwZWVkb21ldGVyIiwiYmFyb21ldGVycyIsImJhcm9tZXRlciIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUGlwZUhhbmRsZU5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVmlldyBmb3IgYSBzaW5nbGUgaGFuZGxlIG9uIHRoZSBmbGV4aWJsZSBtaWRkbGUgcGlwZSBhbmQgdGhlIHBpcGUgaGVhZCByaW1zLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNpZGRoYXJ0aGEgQ2hpbnRoYXBhbGx5IChBY3R1YWwgQ29uY2VwdHMpLlxyXG4gKi9cclxuXHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgSW1hZ2UsIE5vZGUsIFNpbXBsZURyYWdIYW5kbGVyIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGhhbmRsZVdpdGhCYXJfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9oYW5kbGVXaXRoQmFyX3BuZy5qcyc7XHJcbmltcG9ydCBmbHVpZFByZXNzdXJlQW5kRmxvdyBmcm9tICcuLi8uLi9mbHVpZFByZXNzdXJlQW5kRmxvdy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgQ09OVFJPTF9IQU5ETEVfT0ZGU0VUID0gMjtcclxuY29uc3QgUElQRV9JTklUSUFMX0hFSUdIVCA9IDIuMTsgLy9pbiBtZXRlcnNcclxuY29uc3QgUElQRV9JTklUSUFMX1NDQUxFID0gMC4zNjtcclxuY29uc3QgQ1JPU1NfU0VDVElPTl9NSU5fSEVJR0hUID0gMTsgLy9tZXRlcnNcclxuY29uc3QgSEFORExFX1RPVUNIX0FSRUFfWF9ESUxBVElPTiA9IDMwO1xyXG5cclxuY2xhc3MgUGlwZUhhbmRsZU5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtQaXBlSGFuZGxlc05vZGV9IHBpcGVIYW5kbGVzTm9kZVxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNUb3AgaW5kaWNhdGVzIHdoZXRoZXIgdGhpcyBoYW5kbGUgaXMgb24gdG9wIG9yIGJvdHRvbSBvZiB0aGUgcGlwZSBmbG93IGxpbmVcclxuICAgKiBAcGFyYW0ge251bWJlcn0gY29udHJvbFBvaW50SW5kZXhcclxuICAgKiBAcGFyYW0ge01vZGVsVmlld1RyYW5zZm9ybTJ9IG1vZGVsVmlld1RyYW5zZm9ybSB0byBjb252ZXJ0IGJldHdlZW4gbW9kZWwgYW5kIHZpZXcgY28tb3JkaW5hdGUgZnJhbWVzXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIHBpcGVIYW5kbGVzTm9kZSwgaXNUb3AsIGNvbnRyb2xQb2ludEluZGV4LCBtb2RlbFZpZXdUcmFuc2Zvcm0gKSB7XHJcblxyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICBjb25zdCBmbG93TW9kZWwgPSBwaXBlSGFuZGxlc05vZGUuZmxvd01vZGVsO1xyXG4gICAgY29uc3QgcGlwZU5vZGUgPSBwaXBlSGFuZGxlc05vZGUucGlwZU5vZGU7XHJcblxyXG4gICAgY29uc3QgcGlwZSA9IGZsb3dNb2RlbC5waXBlO1xyXG5cclxuICAgIGNvbnN0IGxlZnRUb3BDb250cm9sUG9pbnRJbmRleCA9IDE7XHJcbiAgICBjb25zdCBsZWZ0Qm90dG9tQ29udHJvbFBvaW50SW5kZXggPSAxO1xyXG4gICAgY29uc3QgcmlnaHRUb3BDb250cm9sUG9pbnRJbmRleCA9IHBpcGUudG9wLmxlbmd0aCAtIDI7XHJcbiAgICBjb25zdCByaWdodEJvdHRvbUNvbnRyb2xQb2ludEluZGV4ID0gcGlwZS5ib3R0b20ubGVuZ3RoIC0gMjtcclxuXHJcbiAgICBjb25zdCBjb250cm9sUG9pbnQgPSAoIGlzVG9wICkgPyBwaXBlLnRvcFsgY29udHJvbFBvaW50SW5kZXggXSA6IHBpcGUuYm90dG9tWyBjb250cm9sUG9pbnRJbmRleCBdO1xyXG5cclxuICAgIGxldCBsZWZ0U3BhY2UgPSAwOyAvLyB0byB2ZXJ0aWNhbGx5IGFsaWduIHRoZSBoYW5kbGVzXHJcbiAgICBsZXQgaW1hZ2VSb3RhdGlvbiA9IDA7XHJcbiAgICBpZiAoIGNvbnRyb2xQb2ludC5wb3NpdGlvblByb3BlcnR5LnZhbHVlLnkgPCAtMiApIHtcclxuICAgICAgbGVmdFNwYWNlID0gLTEzO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGltYWdlUm90YXRpb24gPSBNYXRoLlBJO1xyXG4gICAgICBsZWZ0U3BhY2UgPSAxOTtcclxuICAgIH1cclxuICAgIGNvbnN0IGhhbmRsZU5vZGUgPSBuZXcgSW1hZ2UoIGhhbmRsZVdpdGhCYXJfcG5nLCB7IGxlZnQ6IGxlZnRTcGFjZSwgY3Vyc29yOiAncG9pbnRlcicsIHNjYWxlOiAwLjMyIH0gKTtcclxuXHJcbiAgICAvLyBleHBhbmQgdGhlIHRvdWNoIGFyZWEgdXB3YXJkcyBmb3IgdGhlIHRvcCBoYW5kbGVzIGFuZCBkb3dud2FyZHMgZm9yIGJvdHRvbSBoYW5kbGVzXHJcbiAgICBpZiAoIGlzVG9wICkge1xyXG4gICAgICBoYW5kbGVOb2RlLnRvdWNoQXJlYSA9IG5ldyBCb3VuZHMyKCBoYW5kbGVOb2RlLmxvY2FsQm91bmRzLm1pblggLSBIQU5ETEVfVE9VQ0hfQVJFQV9YX0RJTEFUSU9OLFxyXG4gICAgICAgIGhhbmRsZU5vZGUubG9jYWxCb3VuZHMubWluWSxcclxuICAgICAgICBoYW5kbGVOb2RlLmxvY2FsQm91bmRzLm1heFggKyBIQU5ETEVfVE9VQ0hfQVJFQV9YX0RJTEFUSU9OLCBoYW5kbGVOb2RlLmxvY2FsQm91bmRzLm1heFkgKyA0MCApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGhhbmRsZU5vZGUudG91Y2hBcmVhID0gbmV3IEJvdW5kczIoIGhhbmRsZU5vZGUubG9jYWxCb3VuZHMubWluWCAtIEhBTkRMRV9UT1VDSF9BUkVBX1hfRElMQVRJT04sXHJcbiAgICAgICAgaGFuZGxlTm9kZS5sb2NhbEJvdW5kcy5taW5ZICsgMzAsXHJcbiAgICAgICAgaGFuZGxlTm9kZS5sb2NhbEJvdW5kcy5tYXhYICsgSEFORExFX1RPVUNIX0FSRUFfWF9ESUxBVElPTiwgaGFuZGxlTm9kZS5sb2NhbEJvdW5kcy5tYXhZICsgNjAgKTtcclxuICAgIH1cclxuICAgIGhhbmRsZU5vZGUuc2V0Um90YXRpb24oIGltYWdlUm90YXRpb24gKTtcclxuXHJcbiAgICAvLyBoYW5kbGVOb2RlIGlzIGluIGNoYXJnZSBvZiBwZXJmb3JtaW5nIHRoZSByb3RhdGlvbiBmb3IgdGhlIHRvcCBjb250cm9sIGhhbmRsZXMsIHdoZXJlYXNcclxuICAgIC8vIHRoZSBwYXJlbnQgbm9kZSBjb250cm9sSGFuZGxlTm9kZSBpcyBpbiBjaGFuZ2Ugb2YgZG9pbmcgdGhlIHRyYW5zbGF0aW9uc1xyXG4gICAgY29uc3QgY29udHJvbEhhbmRsZU5vZGUgPSBuZXcgTm9kZSggeyBjaGlsZHJlbjogWyBoYW5kbGVOb2RlIF0gfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggY29udHJvbEhhbmRsZU5vZGUgKTtcclxuXHJcbiAgICBjb250cm9sUG9pbnQucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCBwb3NpdGlvbiA9PiB7XHJcbiAgICAgIGNvbnRyb2xIYW5kbGVOb2RlLnNldFRyYW5zbGF0aW9uKCBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCBwb3NpdGlvbi54ICksXHJcbiAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggcG9zaXRpb24ueSApICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgbGV0IGRyYWdTdGFydFk7XHJcbiAgICBsZXQgY29udHJvbFBvaW50RHJhZ1N0YXJ0WTsgLy8gdGhlIG1vZGVsIHkgdmFsdWUgb2YgdGhlIGNvbnRyb2wgcG9pbnQgYXQgZHJhZyBzdGFydFxyXG5cclxuICAgIGNvbnRyb2xIYW5kbGVOb2RlLmFkZElucHV0TGlzdGVuZXIoIG5ldyBTaW1wbGVEcmFnSGFuZGxlcihcclxuICAgICAge1xyXG4gICAgICAgIHN0YXJ0OiBldmVudCA9PiB7XHJcbiAgICAgICAgICBkcmFnU3RhcnRZID0gY29udHJvbEhhbmRsZU5vZGUuZ2xvYmFsVG9QYXJlbnRQb2ludCggZXZlbnQucG9pbnRlci5wb2ludCApLnk7XHJcbiAgICAgICAgICBjb250cm9sUG9pbnREcmFnU3RhcnRZID0gY29udHJvbFBvaW50LnBvc2l0aW9uUHJvcGVydHkudmFsdWUueTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBkcmFnOiBldmVudCA9PiB7XHJcbiAgICAgICAgICBjb25zdCBvZmZTZXRZID0gY29udHJvbEhhbmRsZU5vZGUuZ2xvYmFsVG9QYXJlbnRQb2ludCggZXZlbnQucG9pbnRlci5wb2ludCApLnkgLSBkcmFnU3RhcnRZO1xyXG5cclxuICAgICAgICAgIC8vIHggcG9zaXRpb24gaXMgY29uc3RhbnQgZm9yIGEgY29udHJvbCBwb2ludFxyXG4gICAgICAgICAgY29uc3QgcHQgPSBuZXcgVmVjdG9yMiggY29udHJvbFBvaW50LnBvc2l0aW9uUHJvcGVydHkudmFsdWUueCxcclxuICAgICAgICAgICAgY29udHJvbFBvaW50RHJhZ1N0YXJ0WSArIG1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbERlbHRhWSggb2ZmU2V0WSApICk7XHJcblxyXG4gICAgICAgICAgLy8gbGltaXQgdGhlIHkgdG8gKC00LDApXHJcbiAgICAgICAgICBwdC55ID0gVXRpbHMuY2xhbXAoIHB0LnksIC00LCAwICk7XHJcblxyXG4gICAgICAgICAgLy8gUHJldmVudCB0aGUgdHdvIGVuZHMgb2YgdGhlIGNyb3NzIHNlY3Rpb25zIGZyb20gY3Jvc3NpbmcgZWFjaCBvdGhlci4gU2V0IHRoZSBjcm9zcyBzZWN0aW9uIHRvXHJcbiAgICAgICAgICAvLyBtaW5pbXVtIHdoZW4gdGhlIHVzZXIgdHJpZXMgdG8gbW92ZSB0aGUgaGFuZGxlIGJleW9uZCB0aGUgb3Bwb3NpdGUgY29udHJvbCBwb2ludC5cclxuICAgICAgICAgIGNvbnN0IG9wcG9zaXRlQ29udHJvbFBvaW50ID0gKCBpc1RvcCApID8gcGlwZS5ib3R0b21bIGNvbnRyb2xQb2ludEluZGV4IF0gOiBwaXBlLnRvcFsgY29udHJvbFBvaW50SW5kZXggXTtcclxuICAgICAgICAgIGlmICggKCBpc1RvcCAmJiBwdC55IDwgb3Bwb3NpdGVDb250cm9sUG9pbnQucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS55ICkgKSB7XHJcbiAgICAgICAgICAgIHB0LnkgPSBvcHBvc2l0ZUNvbnRyb2xQb2ludC5wb3NpdGlvblByb3BlcnR5LnZhbHVlLnkgKyBDUk9TU19TRUNUSU9OX01JTl9IRUlHSFQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIGlmICggKCAhaXNUb3AgJiYgcHQueSA+IG9wcG9zaXRlQ29udHJvbFBvaW50LnBvc2l0aW9uUHJvcGVydHkudmFsdWUueSApICkge1xyXG4gICAgICAgICAgICBwdC55ID0gb3Bwb3NpdGVDb250cm9sUG9pbnQucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS55IC0gQ1JPU1NfU0VDVElPTl9NSU5fSEVJR0hUO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIGVuc3VyZSB0aGF0IHRoZSBjcm9zcyBzZWN0aW9uIGlzIGF0IGxlYXN0IDEgbWV0ZXJcclxuICAgICAgICAgIGNvbnN0IHlEaWZmID0gTWF0aC5hYnMoICggb3Bwb3NpdGVDb250cm9sUG9pbnQucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS55ICkgLSBwdC55ICk7XHJcbiAgICAgICAgICBpZiAoIHlEaWZmID49IENST1NTX1NFQ1RJT05fTUlOX0hFSUdIVCApIHtcclxuICAgICAgICAgICAgY29udHJvbFBvaW50LnBvc2l0aW9uUHJvcGVydHkudmFsdWUgPSBwdDtcclxuICAgICAgICAgICAgLy8gV2hlbiBhIGNvbnRyb2wgcG9pbnQgaXMgZHJhZ2dlZCwgbWFyayB0aGUgcGlwZSBhcyBkaXJ0eSBhbmQgdXBkYXRlIHRoZSBwaXBlIGZsb3cgbGluZSBzaGFwZVxyXG4gICAgICAgICAgICBwaXBlLmRpcnR5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgcGlwZU5vZGUudXBkYXRlUGlwZUZsb3dMaW5lU2hhcGUoKTtcclxuICAgICAgICAgICAgcGlwZUhhbmRsZXNOb2RlLmdyaWRJbmplY3Rvck5vZGUudXBkYXRlR3JpZEluamVjdG9yKCk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgLy8gaGFuZGxlIHRoZSBsZWZ0IHBpcGUgc2NhbGluZ1xyXG4gICAgICAgICAgbGV0IHBpcGVFeHBhbnNpb25GYWN0b3I7XHJcbiAgICAgICAgICBpZiAoICggY29udHJvbFBvaW50SW5kZXggPT09IGxlZnRCb3R0b21Db250cm9sUG9pbnRJbmRleCAmJiAhaXNUb3AgKSB8fFxyXG4gICAgICAgICAgICAgICAoIGNvbnRyb2xQb2ludEluZGV4ID09PSBsZWZ0VG9wQ29udHJvbFBvaW50SW5kZXggJiYgaXNUb3AgKSApIHtcclxuXHJcbiAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgcGlwZSBzY2FsZVxyXG4gICAgICAgICAgICBwaXBlRXhwYW5zaW9uRmFjdG9yID0gKCBwaXBlLmdldENyb3NzU2VjdGlvbiggcGlwZS50b3BbIGxlZnRUb3BDb250cm9sUG9pbnRJbmRleCBdLnBvc2l0aW9uUHJvcGVydHkudmFsdWUueCApLmdldEhlaWdodCgpICkgL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUElQRV9JTklUSUFMX0hFSUdIVDtcclxuXHJcbiAgICAgICAgICAgIC8vIGxpbWl0IHRoZSBzY2FsaW5nIHRvIDAuMTggb24gdGhlIGxvd2VyIHNpZGVcclxuICAgICAgICAgICAgcGlwZS5sZWZ0UGlwZVNjYWxlUHJvcGVydHkudmFsdWUgPSBNYXRoLm1heCggcGlwZUV4cGFuc2lvbkZhY3RvciAqIFBJUEVfSU5JVElBTF9TQ0FMRSwgMC4xOCApO1xyXG5cclxuICAgICAgICAgICAgcGlwZS5sZWZ0UGlwZVlQb3NpdGlvblByb3BlcnR5LnZhbHVlID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggcGlwZS50b3BbIGxlZnRUb3BDb250cm9sUG9pbnRJbmRleCBdLnBvc2l0aW9uUHJvcGVydHkudmFsdWUueSApIC1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlwZU5vZGUubGVmdFBpcGVZT2Zmc2V0ICogcGlwZS5sZWZ0UGlwZVNjYWxlUHJvcGVydHkudmFsdWU7XHJcblxyXG5cclxuICAgICAgICAgICAgZmxvd01vZGVsLnBpcGUubGVmdFBpcGVNYWluSGFuZGxlWVBvc2l0aW9uUHJvcGVydHkudmFsdWUgPSBwaXBlTm9kZS5sZWZ0UGlwZU5vZGUuY2VudGVyWTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAvLyBoYW5kbGUgdGhlIHJpZ2h0ICBwaXBlIHNjYWxpbmdcclxuICAgICAgICAgIGlmICggKCBjb250cm9sUG9pbnRJbmRleCA9PT0gcmlnaHRCb3R0b21Db250cm9sUG9pbnRJbmRleCAmJiAhaXNUb3AgKSB8fFxyXG4gICAgICAgICAgICAgICAoIGNvbnRyb2xQb2ludEluZGV4ID09PSByaWdodFRvcENvbnRyb2xQb2ludEluZGV4ICYmIGlzVG9wICkgKSB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBwaXBlSGVpZ2h0ID0gcGlwZS5nZXRDcm9zc1NlY3Rpb24oIHBpcGUudG9wWyByaWdodFRvcENvbnRyb2xQb2ludEluZGV4IF0ucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS54ICkuZ2V0SGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIHBpcGVFeHBhbnNpb25GYWN0b3IgPSBwaXBlSGVpZ2h0IC8gUElQRV9JTklUSUFMX0hFSUdIVDtcclxuXHJcbiAgICAgICAgICAgIC8vIGxpbWl0IHRoZSBzY2FsaW5nIHRvIDAuMTggb24gdGhlIGxvd2VyIHNpZGVcclxuICAgICAgICAgICAgcGlwZS5yaWdodFBpcGVTY2FsZVByb3BlcnR5LnZhbHVlID0gTWF0aC5tYXgoIHBpcGVFeHBhbnNpb25GYWN0b3IgKiBQSVBFX0lOSVRJQUxfU0NBTEUsIDAuMTggKTtcclxuXHJcbiAgICAgICAgICAgIHBpcGUucmlnaHRQaXBlWVBvc2l0aW9uUHJvcGVydHkudmFsdWUgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdZKCBwaXBlLnRvcFsgcmlnaHRUb3BDb250cm9sUG9pbnRJbmRleCBdLnBvc2l0aW9uUHJvcGVydHkudmFsdWUueSApIC1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICggcGlwZU5vZGUucmlnaHRQaXBlWU9mZnNldCAqIHBpcGUucmlnaHRQaXBlU2NhbGVQcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICAgICAgICAgICAgZmxvd01vZGVsLnBpcGUucmlnaHRQaXBlTWFpbkhhbmRsZVlQb3NpdGlvblByb3BlcnR5LnZhbHVlID0gcGlwZU5vZGUucmlnaHRQaXBlTm9kZS5jZW50ZXJZO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIHJlcG9zaXRpb24gdGhlIHBhcnRpY2xlcyB3aGVuIHRoZSBzaW0gaXMgcGF1c2VkIGFuZCB0aGUgaGFuZGxlIGlzIGRyYWdnZWRcclxuICAgICAgICAgIGlmICggIWZsb3dNb2RlbC5pc1BsYXlpbmdQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICAgICAgcGlwZU5vZGUucGFydGljbGVzTGF5ZXIuc3RlcCgpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIHNldHRpbmcgdGhlIGxlZnQvcmlnaHQgIHBpcGUgdG9wL2JvdHRvbSAgY29udHJvbCBwb2ludCBoYW5kbGUgcG9zaXRpb25zIHdoZW4gbGVmdC9yaWdodCBwaXBlICBzY2FsZS5cclxuICAgICAgICAgIGlmICggY29udHJvbFBvaW50SW5kZXggPT09IGxlZnRUb3BDb250cm9sUG9pbnRJbmRleCB8fCBjb250cm9sUG9pbnRJbmRleCA9PT0gbGVmdEJvdHRvbUNvbnRyb2xQb2ludEluZGV4ICkge1xyXG5cclxuICAgICAgICAgICAgcGlwZS5sZWZ0UGlwZVRvcEhhbmRsZVlQcm9wZXJ0eS52YWx1ZSA9IHBpcGVOb2RlLmxlZnRQaXBlTm9kZS50b3AgKyBDT05UUk9MX0hBTkRMRV9PRkZTRVQ7XHJcbiAgICAgICAgICAgIHBpcGUubGVmdFBpcGVCb3R0b21IYW5kbGVZUHJvcGVydHkudmFsdWUgPSBwaXBlTm9kZS5sZWZ0UGlwZU5vZGUuYm90dG9tIC0gQ09OVFJPTF9IQU5ETEVfT0ZGU0VUO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSBpZiAoIGNvbnRyb2xQb2ludEluZGV4ID09PSByaWdodFRvcENvbnRyb2xQb2ludEluZGV4IHx8XHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbFBvaW50SW5kZXggPT09IHJpZ2h0Qm90dG9tQ29udHJvbFBvaW50SW5kZXggKSB7XHJcbiAgICAgICAgICAgIHBpcGUucmlnaHRQaXBlVG9wSGFuZGxlWVByb3BlcnR5LnZhbHVlID0gcGlwZU5vZGUucmlnaHRQaXBlTm9kZS50b3AgKyBDT05UUk9MX0hBTkRMRV9PRkZTRVQ7XHJcbiAgICAgICAgICAgIHBpcGUucmlnaHRQaXBlQm90dG9tSGFuZGxlWVByb3BlcnR5LnZhbHVlID0gcGlwZU5vZGUucmlnaHRQaXBlTm9kZS5ib3R0b20gLSBDT05UUk9MX0hBTkRMRV9PRkZTRVQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyBlbWl0IGFuIHVwZGF0ZSBvbiB0aGUgZmx1eCBtZXRlciBvbmx5IGlmIGl0IGlzIHZpc2libGVcclxuICAgICAgICAgIGlmICggZmxvd01vZGVsLmlzRmx1eE1ldGVyVmlzaWJsZVByb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICAgICAgICBmbG93TW9kZWwuZmx1eE1ldGVyLnVwZGF0ZUVtaXR0ZXIuZW1pdCgpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGZsb3dNb2RlbC5zcGVlZG9tZXRlcnMuZm9yRWFjaCggc3BlZWRvbWV0ZXIgPT4ge1xyXG4gICAgICAgICAgICBzcGVlZG9tZXRlci51cGRhdGVFbWl0dGVyLmVtaXQoKTtcclxuICAgICAgICAgIH0gKTtcclxuXHJcbiAgICAgICAgICAvLyB1cGRhdGUgdGhlIGJhcm9tZXRlcnNcclxuICAgICAgICAgIGZsb3dNb2RlbC5iYXJvbWV0ZXJzLmZvckVhY2goIGJhcm9tZXRlciA9PiB7XHJcbiAgICAgICAgICAgIGJhcm9tZXRlci51cGRhdGVFbWl0dGVyLmVtaXQoKTtcclxuICAgICAgICAgIH0gKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKSApO1xyXG4gIH1cclxufVxyXG5cclxuZmx1aWRQcmVzc3VyZUFuZEZsb3cucmVnaXN0ZXIoICdQaXBlSGFuZGxlTm9kZScsIFBpcGVIYW5kbGVOb2RlICk7XHJcbmV4cG9ydCBkZWZhdWx0IFBpcGVIYW5kbGVOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxTQUFTQyxLQUFLLEVBQUVDLElBQUksRUFBRUMsaUJBQWlCLFFBQVEsbUNBQW1DO0FBQ2xGLE9BQU9DLGlCQUFpQixNQUFNLHNDQUFzQztBQUNwRSxPQUFPQyxvQkFBb0IsTUFBTSwrQkFBK0I7O0FBRWhFO0FBQ0EsTUFBTUMscUJBQXFCLEdBQUcsQ0FBQztBQUMvQixNQUFNQyxtQkFBbUIsR0FBRyxHQUFHLENBQUMsQ0FBQztBQUNqQyxNQUFNQyxrQkFBa0IsR0FBRyxJQUFJO0FBQy9CLE1BQU1DLHdCQUF3QixHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQ3BDLE1BQU1DLDRCQUE0QixHQUFHLEVBQUU7QUFFdkMsTUFBTUMsY0FBYyxTQUFTVCxJQUFJLENBQUM7RUFFaEM7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VVLFdBQVdBLENBQUVDLGVBQWUsRUFB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