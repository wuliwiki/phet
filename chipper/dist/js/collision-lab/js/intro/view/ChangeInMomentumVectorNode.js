// Copyright 2020-2022, University of Colorado Boulder

/**
 * A view that renders a 'Change in Momentum' vector for a Ball in the 'Intro' screen, using the IntroBallSystem's
 * corresponding changeInMomentumProperty. ChangeInMomentumVectorNodes are created for each Ball, meaning they are
 * created at the start of the sim and are never disposed, so no dispose method is necessary.
 *
 * The opacity and magnitude of the 'Change in Momentum' vectors are modeled in IntroBallSystem, so all this view has to
 * do is mirror the opacity and components that are modeled. However, the tail-x position of the change in momentum
 * vectors must match the x-position of the Ball, and the vector is at a constant y-position above the
 * Ball.
 *
 * NOTE: Do not translate this node. It's origin must be at the origin of the view coordinate frame.
 *
 * @author Brandon Li
 */

import Multilink from '../../../../axon/js/Multilink.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import merge from '../../../../phet-core/js/merge.js';
import AssertUtils from '../../../../phetcommon/js/AssertUtils.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import { Line, Node } from '../../../../scenery/js/imports.js';
import collisionLab from '../../collisionLab.js';
import CollisionLabColors from '../../common/CollisionLabColors.js';
import CollisionLabConstants from '../../common/CollisionLabConstants.js';
class ChangeInMomentumVectorNode extends Node {
  /**
   * @param {Property.<Vector2>} changeInMomentumProperty - the components of the 'Change in Momentum' vector.
   * @param {Property.<number>} opacityProperty - opacity of the 'Change in Momentum' vector.
   * @param {Property.<Vector2>} ballPositionProperty - the position of the corresponding Ball, in meters.
   * @param {Bounds2} playAreaBounds - bounds of the PlayArea, in meters.
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Object} [options]
   */
  constructor(changeInMomentumProperty, opacityProperty, ballPositionProperty, playAreaBounds, modelViewTransform, options) {
    assert && AssertUtils.assertPropertyOf(changeInMomentumProperty, Vector2);
    assert && AssertUtils.assertPropertyOf(opacityProperty, 'number');
    assert && AssertUtils.assertPropertyOf(ballPositionProperty, Vector2);
    assert && assert(playAreaBounds instanceof Bounds2, `invalid playAreaBounds: ${playAreaBounds}`);
    assert && assert(modelViewTransform instanceof ModelViewTransform2, `invalid modelViewTransform: ${modelViewTransform}`);
    options = merge({
      // {Object} - passed to the ArrowNode instance.
      arrowOptions: merge({
        fill: CollisionLabColors.MOMENTUM_VECTOR_FILL,
        stroke: CollisionLabColors.MOMENTUM_VECTOR_STROKE
      }, CollisionLabConstants.ARROW_OPTIONS),
      // {number[]} - line-dash pattern for the line that connects the Vector to the center of the Ball.
      connectingLineDash: [5, 4]
    }, options);
    super(options);

    //----------------------------------------------------------------------------------------

    // Create the ArrowNode that represents the Vector. Initialized at 0 for now. To be updated below.
    const arrowNode = new ArrowNode(0, 0, 0, 0, options.arrowOptions);

    // Create the dashed Line that connects the tail of the Vector to the center of the Ball.
    const connectingLine = new Line({
      lineDash: options.connectingLineDash,
      stroke: CollisionLabColors.CHANGE_IN_MOMENTUM_DASHED_LINE
    });

    // Get the Bounds of the PlayArea in view coordinates.
    const playAreaViewBounds = modelViewTransform.modelToViewBounds(playAreaBounds);

    // Set the children of this Node in the correct rendering order.
    this.children = [arrowNode, connectingLine];

    //----------------------------------------------------------------------------------------

    // Observe when either the position of the Ball changes or when the components of the Change in Momentum vector
    // changes and update the arrow and the connecting line. This Multilink is never disposed since
    // ChangeInMomentumVectorNodes and Balls are never disposed.
    Multilink.multilink([ballPositionProperty, changeInMomentumProperty], (ballPosition, changeInMomentum) => {
      // Get the position of the Ball in view coordinates.
      const ballViewPosition = modelViewTransform.modelToViewPosition(ballPosition);

      // Set the visibility of this Node to true if the Ball's center is inside the PlayArea and false otherwise.
      this.visible = playAreaViewBounds.containsPoint(ballViewPosition) && changeInMomentum.magnitude > CollisionLabConstants.ZERO_THRESHOLD;

      // Update the positioning of the arrow and the connecting line if this Node is visible.
      if (this.visible) {
        // Calculate the position of the Change in Momentum vector in view coordinates.
        const tailViewPosition = ballViewPosition.minusXY(0, ChangeInMomentumVectorNode.CHANGE_IN_MOMENTUM_Y_OFFSET);
        const tipViewPosition = tailViewPosition.plus(modelViewTransform.modelToViewDelta(changeInMomentum));

        // Update the positioning of the ArrowNode.
        arrowNode.setTailAndTip(tailViewPosition.x, tailViewPosition.y, tipViewPosition.x, tipViewPosition.y);

        // Update the positioning of the connecting line.
        connectingLine.setLine(ballViewPosition.x, ballViewPosition.y, tailViewPosition.x, tailViewPosition.y);
      }
    });

    // Observe when the opacityProperty changes and match the opacity of this Node. Link is never unlinked
    // since ChangeInMomentumVectorNodes are never disposed.
    opacityProperty.linkAttribute(this, 'opacity');
  }
}

// @public (read-only) {number} - vertical offset between the Ball's center and the Vectors.
ChangeInMomentumVectorNode.CHANGE_IN_MOMENTUM_Y_OFFSET = 120;
collisionLab.register('ChangeInMomentumVectorNode', ChangeInMomentumVectorNode);
export default ChangeInMomentumVectorNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJCb3VuZHMyIiwiVmVjdG9yMiIsIm1lcmdlIiwiQXNzZXJ0VXRpbHMiLCJNb2RlbFZpZXdUcmFuc2Zvcm0yIiwiQXJyb3dOb2RlIiwiTGluZSIsIk5vZGUiLCJjb2xsaXNpb25MYWIiLCJDb2xsaXNpb25MYWJDb2xvcnMiLCJDb2xsaXNpb25MYWJDb25zdGFudHMiLCJDaGFuZ2VJbk1vbWVudHVtVmVjdG9yTm9kZSIsImNvbnN0cnVjdG9yIiwiY2hhbmdlSW5Nb21lbnR1bVByb3BlcnR5Iiwib3BhY2l0eVByb3BlcnR5IiwiYmFsbFBvc2l0aW9uUHJvcGVydHkiLCJwbGF5QXJlYUJvdW5kcyIsIm1vZGVsVmlld1RyYW5zZm9ybSIsIm9wdGlvbnMiLCJhc3NlcnQiLCJhc3NlcnRQcm9wZXJ0eU9mIiwiYXJyb3dPcHRpb25zIiwiZmlsbCIsIk1PTUVOVFVNX1ZFQ1RPUl9GSUxMIiwic3Ryb2tlIiwiTU9NRU5UVU1fVkVDVE9SX1NUUk9LRSIsIkFSUk9XX09QVElPTlMiLCJjb25uZWN0aW5nTGluZURhc2giLCJhcnJvd05vZGUiLCJjb25uZWN0aW5nTGluZSIsImxpbmVEYXNoIiwiQ0hBTkdFX0lOX01PTUVOVFVNX0RBU0hFRF9MSU5FIiwicGxheUFyZWFWaWV3Qm91bmRzIiwibW9kZWxUb1ZpZXdCb3VuZHMiLCJjaGlsZHJlbiIsIm11bHRpbGluayIsImJhbGxQb3NpdGlvbiIsImNoYW5nZUluTW9tZW50dW0iLCJiYWxsVmlld1Bvc2l0aW9uIiwibW9kZWxUb1ZpZXdQb3NpdGlvbiIsInZpc2libGUiLCJjb250YWluc1BvaW50IiwibWFnbml0dWRlIiwiWkVST19USFJFU0hPTEQiLCJ0YWlsVmlld1Bvc2l0aW9uIiwibWludXNYWSIsIkNIQU5HRV9JTl9NT01FTlRVTV9ZX09GRlNFVCIsInRpcFZpZXdQb3NpdGlvbiIsInBsdXMiLCJtb2RlbFRvVmlld0RlbHRhIiwic2V0VGFpbEFuZFRpcCIsIngiLCJ5Iiwic2V0TGluZSIsImxpbmtBdHRyaWJ1dGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNoYW5nZUluTW9tZW50dW1WZWN0b3JOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIwLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEEgdmlldyB0aGF0IHJlbmRlcnMgYSAnQ2hhbmdlIGluIE1vbWVudHVtJyB2ZWN0b3IgZm9yIGEgQmFsbCBpbiB0aGUgJ0ludHJvJyBzY3JlZW4sIHVzaW5nIHRoZSBJbnRyb0JhbGxTeXN0ZW0nc1xyXG4gKiBjb3JyZXNwb25kaW5nIGNoYW5nZUluTW9tZW50dW1Qcm9wZXJ0eS4gQ2hhbmdlSW5Nb21lbnR1bVZlY3Rvck5vZGVzIGFyZSBjcmVhdGVkIGZvciBlYWNoIEJhbGwsIG1lYW5pbmcgdGhleSBhcmVcclxuICogY3JlYXRlZCBhdCB0aGUgc3RhcnQgb2YgdGhlIHNpbSBhbmQgYXJlIG5ldmVyIGRpc3Bvc2VkLCBzbyBubyBkaXNwb3NlIG1ldGhvZCBpcyBuZWNlc3NhcnkuXHJcbiAqXHJcbiAqIFRoZSBvcGFjaXR5IGFuZCBtYWduaXR1ZGUgb2YgdGhlICdDaGFuZ2UgaW4gTW9tZW50dW0nIHZlY3RvcnMgYXJlIG1vZGVsZWQgaW4gSW50cm9CYWxsU3lzdGVtLCBzbyBhbGwgdGhpcyB2aWV3IGhhcyB0b1xyXG4gKiBkbyBpcyBtaXJyb3IgdGhlIG9wYWNpdHkgYW5kIGNvbXBvbmVudHMgdGhhdCBhcmUgbW9kZWxlZC4gSG93ZXZlciwgdGhlIHRhaWwteCBwb3NpdGlvbiBvZiB0aGUgY2hhbmdlIGluIG1vbWVudHVtXHJcbiAqIHZlY3RvcnMgbXVzdCBtYXRjaCB0aGUgeC1wb3NpdGlvbiBvZiB0aGUgQmFsbCwgYW5kIHRoZSB2ZWN0b3IgaXMgYXQgYSBjb25zdGFudCB5LXBvc2l0aW9uIGFib3ZlIHRoZVxyXG4gKiBCYWxsLlxyXG4gKlxyXG4gKiBOT1RFOiBEbyBub3QgdHJhbnNsYXRlIHRoaXMgbm9kZS4gSXQncyBvcmlnaW4gbXVzdCBiZSBhdCB0aGUgb3JpZ2luIG9mIHRoZSB2aWV3IGNvb3JkaW5hdGUgZnJhbWUuXHJcbiAqXHJcbiAqIEBhdXRob3IgQnJhbmRvbiBMaVxyXG4gKi9cclxuXHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBBc3NlcnRVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL0Fzc2VydFV0aWxzLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgQXJyb3dOb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9BcnJvd05vZGUuanMnO1xyXG5pbXBvcnQgeyBMaW5lLCBOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGNvbGxpc2lvbkxhYiBmcm9tICcuLi8uLi9jb2xsaXNpb25MYWIuanMnO1xyXG5pbXBvcnQgQ29sbGlzaW9uTGFiQ29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi9Db2xsaXNpb25MYWJDb2xvcnMuanMnO1xyXG5pbXBvcnQgQ29sbGlzaW9uTGFiQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9Db2xsaXNpb25MYWJDb25zdGFudHMuanMnO1xyXG5cclxuY2xhc3MgQ2hhbmdlSW5Nb21lbnR1bVZlY3Rvck5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48VmVjdG9yMj59IGNoYW5nZUluTW9tZW50dW1Qcm9wZXJ0eSAtIHRoZSBjb21wb25lbnRzIG9mIHRoZSAnQ2hhbmdlIGluIE1vbWVudHVtJyB2ZWN0b3IuXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48bnVtYmVyPn0gb3BhY2l0eVByb3BlcnR5IC0gb3BhY2l0eSBvZiB0aGUgJ0NoYW5nZSBpbiBNb21lbnR1bScgdmVjdG9yLlxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPFZlY3RvcjI+fSBiYWxsUG9zaXRpb25Qcm9wZXJ0eSAtIHRoZSBwb3NpdGlvbiBvZiB0aGUgY29ycmVzcG9uZGluZyBCYWxsLCBpbiBtZXRlcnMuXHJcbiAgICogQHBhcmFtIHtCb3VuZHMyfSBwbGF5QXJlYUJvdW5kcyAtIGJvdW5kcyBvZiB0aGUgUGxheUFyZWEsIGluIG1ldGVycy5cclxuICAgKiBAcGFyYW0ge01vZGVsVmlld1RyYW5zZm9ybTJ9IG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggY2hhbmdlSW5Nb21lbnR1bVByb3BlcnR5LFxyXG4gICAgICAgICAgICAgICBvcGFjaXR5UHJvcGVydHksXHJcbiAgICAgICAgICAgICAgIGJhbGxQb3NpdGlvblByb3BlcnR5LFxyXG4gICAgICAgICAgICAgICBwbGF5QXJlYUJvdW5kcyxcclxuICAgICAgICAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLFxyXG4gICAgICAgICAgICAgICBvcHRpb25zICkge1xyXG4gICAgYXNzZXJ0ICYmIEFzc2VydFV0aWxzLmFzc2VydFByb3BlcnR5T2YoIGNoYW5nZUluTW9tZW50dW1Qcm9wZXJ0eSwgVmVjdG9yMiApO1xyXG4gICAgYXNzZXJ0ICYmIEFzc2VydFV0aWxzLmFzc2VydFByb3BlcnR5T2YoIG9wYWNpdHlQcm9wZXJ0eSwgJ251bWJlcicgKTtcclxuICAgIGFzc2VydCAmJiBBc3NlcnRVdGlscy5hc3NlcnRQcm9wZXJ0eU9mKCBiYWxsUG9zaXRpb25Qcm9wZXJ0eSwgVmVjdG9yMiApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggcGxheUFyZWFCb3VuZHMgaW5zdGFuY2VvZiBCb3VuZHMyLCBgaW52YWxpZCBwbGF5QXJlYUJvdW5kczogJHtwbGF5QXJlYUJvdW5kc31gICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBtb2RlbFZpZXdUcmFuc2Zvcm0gaW5zdGFuY2VvZiBNb2RlbFZpZXdUcmFuc2Zvcm0yLCBgaW52YWxpZCBtb2RlbFZpZXdUcmFuc2Zvcm06ICR7bW9kZWxWaWV3VHJhbnNmb3JtfWAgKTtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuXHJcbiAgICAgIC8vIHtPYmplY3R9IC0gcGFzc2VkIHRvIHRoZSBBcnJvd05vZGUgaW5zdGFuY2UuXHJcbiAgICAgIGFycm93T3B0aW9uczogbWVyZ2UoIHtcclxuICAgICAgICBmaWxsOiBDb2xsaXNpb25MYWJDb2xvcnMuTU9NRU5UVU1fVkVDVE9SX0ZJTEwsXHJcbiAgICAgICAgc3Ryb2tlOiBDb2xsaXNpb25MYWJDb2xvcnMuTU9NRU5UVU1fVkVDVE9SX1NUUk9LRVxyXG4gICAgICB9LCBDb2xsaXNpb25MYWJDb25zdGFudHMuQVJST1dfT1BUSU9OUyApLFxyXG5cclxuICAgICAgLy8ge251bWJlcltdfSAtIGxpbmUtZGFzaCBwYXR0ZXJuIGZvciB0aGUgbGluZSB0aGF0IGNvbm5lY3RzIHRoZSBWZWN0b3IgdG8gdGhlIGNlbnRlciBvZiB0aGUgQmFsbC5cclxuICAgICAgY29ubmVjdGluZ0xpbmVEYXNoOiBbIDUsIDQgXVxyXG5cclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgQXJyb3dOb2RlIHRoYXQgcmVwcmVzZW50cyB0aGUgVmVjdG9yLiBJbml0aWFsaXplZCBhdCAwIGZvciBub3cuIFRvIGJlIHVwZGF0ZWQgYmVsb3cuXHJcbiAgICBjb25zdCBhcnJvd05vZGUgPSBuZXcgQXJyb3dOb2RlKCAwLCAwLCAwLCAwLCBvcHRpb25zLmFycm93T3B0aW9ucyApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgZGFzaGVkIExpbmUgdGhhdCBjb25uZWN0cyB0aGUgdGFpbCBvZiB0aGUgVmVjdG9yIHRvIHRoZSBjZW50ZXIgb2YgdGhlIEJhbGwuXHJcbiAgICBjb25zdCBjb25uZWN0aW5nTGluZSA9IG5ldyBMaW5lKCB7XHJcbiAgICAgIGxpbmVEYXNoOiBvcHRpb25zLmNvbm5lY3RpbmdMaW5lRGFzaCxcclxuICAgICAgc3Ryb2tlOiBDb2xsaXNpb25MYWJDb2xvcnMuQ0hBTkdFX0lOX01PTUVOVFVNX0RBU0hFRF9MSU5FXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gR2V0IHRoZSBCb3VuZHMgb2YgdGhlIFBsYXlBcmVhIGluIHZpZXcgY29vcmRpbmF0ZXMuXHJcbiAgICBjb25zdCBwbGF5QXJlYVZpZXdCb3VuZHMgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdCb3VuZHMoIHBsYXlBcmVhQm91bmRzICk7XHJcblxyXG4gICAgLy8gU2V0IHRoZSBjaGlsZHJlbiBvZiB0aGlzIE5vZGUgaW4gdGhlIGNvcnJlY3QgcmVuZGVyaW5nIG9yZGVyLlxyXG4gICAgdGhpcy5jaGlsZHJlbiA9IFtcclxuICAgICAgYXJyb3dOb2RlLFxyXG4gICAgICBjb25uZWN0aW5nTGluZVxyXG4gICAgXTtcclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgICAvLyBPYnNlcnZlIHdoZW4gZWl0aGVyIHRoZSBwb3NpdGlvbiBvZiB0aGUgQmFsbCBjaGFuZ2VzIG9yIHdoZW4gdGhlIGNvbXBvbmVudHMgb2YgdGhlIENoYW5nZSBpbiBNb21lbnR1bSB2ZWN0b3JcclxuICAgIC8vIGNoYW5nZXMgYW5kIHVwZGF0ZSB0aGUgYXJyb3cgYW5kIHRoZSBjb25uZWN0aW5nIGxpbmUuIFRoaXMgTXVsdGlsaW5rIGlzIG5ldmVyIGRpc3Bvc2VkIHNpbmNlXHJcbiAgICAvLyBDaGFuZ2VJbk1vbWVudHVtVmVjdG9yTm9kZXMgYW5kIEJhbGxzIGFyZSBuZXZlciBkaXNwb3NlZC5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFsgYmFsbFBvc2l0aW9uUHJvcGVydHksIGNoYW5nZUluTW9tZW50dW1Qcm9wZXJ0eSBdLCAoIGJhbGxQb3NpdGlvbiwgY2hhbmdlSW5Nb21lbnR1bSApID0+IHtcclxuXHJcbiAgICAgIC8vIEdldCB0aGUgcG9zaXRpb24gb2YgdGhlIEJhbGwgaW4gdmlldyBjb29yZGluYXRlcy5cclxuICAgICAgY29uc3QgYmFsbFZpZXdQb3NpdGlvbiA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBiYWxsUG9zaXRpb24gKTtcclxuXHJcbiAgICAgIC8vIFNldCB0aGUgdmlzaWJpbGl0eSBvZiB0aGlzIE5vZGUgdG8gdHJ1ZSBpZiB0aGUgQmFsbCdzIGNlbnRlciBpcyBpbnNpZGUgdGhlIFBsYXlBcmVhIGFuZCBmYWxzZSBvdGhlcndpc2UuXHJcbiAgICAgIHRoaXMudmlzaWJsZSA9IHBsYXlBcmVhVmlld0JvdW5kcy5jb250YWluc1BvaW50KCBiYWxsVmlld1Bvc2l0aW9uIClcclxuICAgICAgICAgICAgICAgICAgICAgJiYgY2hhbmdlSW5Nb21lbnR1bS5tYWduaXR1ZGUgPiBDb2xsaXNpb25MYWJDb25zdGFudHMuWkVST19USFJFU0hPTEQ7XHJcblxyXG4gICAgICAvLyBVcGRhdGUgdGhlIHBvc2l0aW9uaW5nIG9mIHRoZSBhcnJvdyBhbmQgdGhlIGNvbm5lY3RpbmcgbGluZSBpZiB0aGlzIE5vZGUgaXMgdmlzaWJsZS5cclxuICAgICAgaWYgKCB0aGlzLnZpc2libGUgKSB7XHJcblxyXG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgcG9zaXRpb24gb2YgdGhlIENoYW5nZSBpbiBNb21lbnR1bSB2ZWN0b3IgaW4gdmlldyBjb29yZGluYXRlcy5cclxuICAgICAgICBjb25zdCB0YWlsVmlld1Bvc2l0aW9uID0gYmFsbFZpZXdQb3NpdGlvbi5taW51c1hZKCAwLCBDaGFuZ2VJbk1vbWVudHVtVmVjdG9yTm9kZS5DSEFOR0VfSU5fTU9NRU5UVU1fWV9PRkZTRVQgKTtcclxuICAgICAgICBjb25zdCB0aXBWaWV3UG9zaXRpb24gPSB0YWlsVmlld1Bvc2l0aW9uLnBsdXMoIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhKCBjaGFuZ2VJbk1vbWVudHVtICkgKTtcclxuXHJcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBwb3NpdGlvbmluZyBvZiB0aGUgQXJyb3dOb2RlLlxyXG4gICAgICAgIGFycm93Tm9kZS5zZXRUYWlsQW5kVGlwKCB0YWlsVmlld1Bvc2l0aW9uLngsIHRhaWxWaWV3UG9zaXRpb24ueSwgdGlwVmlld1Bvc2l0aW9uLngsIHRpcFZpZXdQb3NpdGlvbi55ICk7XHJcblxyXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgcG9zaXRpb25pbmcgb2YgdGhlIGNvbm5lY3RpbmcgbGluZS5cclxuICAgICAgICBjb25uZWN0aW5nTGluZS5zZXRMaW5lKCBiYWxsVmlld1Bvc2l0aW9uLngsIGJhbGxWaWV3UG9zaXRpb24ueSwgdGFpbFZpZXdQb3NpdGlvbi54LCB0YWlsVmlld1Bvc2l0aW9uLnkgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIE9ic2VydmUgd2hlbiB0aGUgb3BhY2l0eVByb3BlcnR5IGNoYW5nZXMgYW5kIG1hdGNoIHRoZSBvcGFjaXR5IG9mIHRoaXMgTm9kZS4gTGluayBpcyBuZXZlciB1bmxpbmtlZFxyXG4gICAgLy8gc2luY2UgQ2hhbmdlSW5Nb21lbnR1bVZlY3Rvck5vZGVzIGFyZSBuZXZlciBkaXNwb3NlZC5cclxuICAgIG9wYWNpdHlQcm9wZXJ0eS5saW5rQXR0cmlidXRlKCB0aGlzLCAnb3BhY2l0eScgKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIEBwdWJsaWMgKHJlYWQtb25seSkge251bWJlcn0gLSB2ZXJ0aWNhbCBvZmZzZXQgYmV0d2VlbiB0aGUgQmFsbCdzIGNlbnRlciBhbmQgdGhlIFZlY3RvcnMuXHJcbkNoYW5nZUluTW9tZW50dW1WZWN0b3JOb2RlLkNIQU5HRV9JTl9NT01FTlRVTV9ZX09GRlNFVCA9IDEyMDtcclxuXHJcbmNvbGxpc2lvbkxhYi5yZWdpc3RlciggJ0NoYW5nZUluTW9tZW50dW1WZWN0b3JOb2RlJywgQ2hhbmdlSW5Nb21lbnR1bVZlY3Rvck5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgQ2hhbmdlSW5Nb21lbnR1bVZlY3Rvck5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFNBQVMsTUFBTSxrQ0FBa0M7QUFDeEQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsV0FBVyxNQUFNLDBDQUEwQztBQUNsRSxPQUFPQyxtQkFBbUIsTUFBTSx1REFBdUQ7QUFDdkYsT0FBT0MsU0FBUyxNQUFNLDBDQUEwQztBQUNoRSxTQUFTQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDOUQsT0FBT0MsWUFBWSxNQUFNLHVCQUF1QjtBQUNoRCxPQUFPQyxrQkFBa0IsTUFBTSxvQ0FBb0M7QUFDbkUsT0FBT0MscUJBQXFCLE1BQU0sdUNBQXVDO0FBRXpFLE1BQU1DLDBCQUEwQixTQUFTSixJQUFJLENBQUM7RUFFNUM7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFSyxXQUFXQSxDQUFFQyx3QkFBd0IsRUFDeEJDLGVBQWUsRUFDZkMsb0JBQW9CLEVBQ3BCQyxjQUFjLEVBQ2RDLGtCQUFrQixFQUNsQkMsT0FBTyxFQUFHO0lBQ3JCQyxNQUFNLElBQUloQixXQUFXLENBQUNpQixnQkFBZ0IsQ0FBRVAsd0JBQXdCLEVBQUVaLE9BQVEsQ0FBQztJQUMzRWtCLE1BQU0sSUFBSWhCLFdBQVcsQ0FBQ2lCLGdCQUFnQixDQUFFTixlQUFlLEVBQUUsUUFBUyxDQUFDO0lBQ25FSyxNQUFNLElBQUloQixXQUFXLENBQUNpQixnQkFBZ0IsQ0FBRUwsb0JBQW9CLEVBQUVkLE9BQVEsQ0FBQztJQUN2RWtCLE1BQU0sSUFBSUEsTUFBTSxDQUFFSCxjQUFjLFlBQVloQixPQUFPLEVBQUcsMkJBQTBCZ0IsY0FBZSxFQUFFLENBQUM7SUFDbEdHLE1BQU0sSUFBSUEsTUFBTSxDQUFFRixrQkFBa0IsWUFBWWIsbUJBQW1CLEVBQUcsK0JBQThCYSxrQkFBbUIsRUFBRSxDQUFDO0lBRTFIQyxPQUFPLEdBQUdoQixLQUFLLENBQUU7TUFFZjtNQUNBbUIsWUFBWSxFQUFFbkIsS0FBSyxDQUFFO1FBQ25Cb0IsSUFBSSxFQUFFYixrQkFBa0IsQ0FBQ2Msb0JBQW9CO1FBQzdDQyxNQUFNLEVBQUVmLGtCQUFrQixDQUFDZ0I7TUFDN0IsQ0FBQyxFQUFFZixxQkFBcUIsQ0FBQ2dCLGFBQWMsQ0FBQztNQUV4QztNQUNBQyxrQkFBa0IsRUFBRSxDQUFFLENBQUMsRUFBRSxDQUFDO0lBRTVCLENBQUMsRUFBRVQsT0FBUSxDQUFDO0lBRVosS0FBSyxDQUFFQSxPQUFRLENBQUM7O0lBRWhCOztJQUVBO0lBQ0EsTUFBTVUsU0FBUyxHQUFHLElBQUl2QixTQUFTLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFYSxPQUFPLENBQUNHLFlBQWEsQ0FBQzs7SUFFbkU7SUFDQSxNQUFNUSxjQUFjLEdBQUcsSUFBSXZCLElBQUksQ0FBRTtNQUMvQndCLFFBQVEsRUFBRVosT0FBTyxDQUFDUyxrQkFBa0I7TUFDcENILE1BQU0sRUFBRWYsa0JBQWtCLENBQUNzQjtJQUM3QixDQUFFLENBQUM7O0lBRUg7SUFDQSxNQUFNQyxrQkFBa0IsR0FBR2Ysa0JBQWtCLENBQUNnQixpQkFBaUIsQ0FBRWpCLGNBQWUsQ0FBQzs7SUFFakY7SUFDQSxJQUFJLENBQUNrQixRQUFRLEdBQUcsQ0FDZE4sU0FBUyxFQUNUQyxjQUFjLENBQ2Y7O0lBRUQ7O0lBRUE7SUFDQTtJQUNBO0lBQ0E5QixTQUFTLENBQUNvQyxTQUFTLENBQUUsQ0FBRXBCLG9CQUFvQixFQUFFRix3QkFBd0IsQ0FBRSxFQUFFLENBQUV1QixZQUFZLEVBQUVDLGdCQUFnQixLQUFNO01BRTdHO01BQ0EsTUFBTUMsZ0JBQWdCLEdBQUdyQixrQkFBa0IsQ0FBQ3NCLG1CQUFtQixDQUFFSCxZQUFhLENBQUM7O01BRS9FO01BQ0EsSUFBSSxDQUFDSSxPQUFPLEdBQUdSLGtCQUFrQixDQUFDUyxhQUFhLENBQUVILGdCQUFpQixDQUFDLElBQ2pERCxnQkFBZ0IsQ0FBQ0ssU0FBUyxHQUFHaEMscUJBQXFCLENBQUNpQyxjQUFjOztNQUVuRjtNQUNBLElBQUssSUFBSSxDQUFDSCxPQUFPLEVBQUc7UUFFbEI7UUFDQSxNQUFNSSxnQkFBZ0IsR0FBR04sZ0JBQWdCLENBQUNPLE9BQU8sQ0FBRSxDQUFDLEVBQUVsQywwQkFBMEIsQ0FBQ21DLDJCQUE0QixDQUFDO1FBQzlHLE1BQU1DLGVBQWUsR0FBR0gsZ0JBQWdCLENBQUNJLElBQUksQ0FBRS9CLGtCQUFrQixDQUFDZ0MsZ0JBQWdCLENBQUVaLGdCQUFpQixDQUFFLENBQUM7O1FBRXhHO1FBQ0FULFNBQVMsQ0FBQ3NCLGFBQWEsQ0FBRU4sZ0JBQWdCLENBQUNPLENBQUMsRUFBRVAsZ0JBQWdCLENBQUNRLENBQUMsRUFBRUwsZUFBZSxDQUFDSSxDQUFDLEVBQUVKLGVBQWUsQ0FBQ0ssQ0FBRSxDQUFDOztRQUV2RztRQUNBdkIsY0FBYyxDQUFDd0IsT0FBTyxDQUFFZixnQkFBZ0IsQ0FBQ2EsQ0FBQyxFQUFFYixnQkFBZ0IsQ0FBQ2MsQ0FBQyxFQUFFUixnQkFBZ0IsQ0FBQ08sQ0FBQyxFQUFFUCxnQkFBZ0IsQ0FBQ1EsQ0FBRSxDQUFDO01BQzFHO0lBQ0YsQ0FBRSxDQUFDOztJQUVIO0lBQ0E7SUFDQXRDLGVBQWUsQ0FBQ3dDLGFBQWEsQ0FBRSxJQUFJLEVBQUUsU0FBVSxDQUFDO0VBQ2xEO0FBQ0Y7O0FBRUE7QUFDQTNDLDBCQUEwQixDQUFDbUMsMkJBQTJCLEdBQUcsR0FBRztBQUU1RHRDLFlBQVksQ0FBQytDLFFBQVEsQ0FBRSw0QkFBNEIsRUFBRTVDLDBCQUEyQixDQUFDO0FBQ2pGLGVBQWVBLDBCQUEwQiJ9