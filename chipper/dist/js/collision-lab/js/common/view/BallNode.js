// Copyright 2019-2022, University of Colorado Boulder

/**
 * BallNode is the view representation of a single spherical Ball, which appears in all screens of the 'Collision Lab'
 * simulation. BallNodes are implemented to work for both 1D and 2D screens, so no sub-types are needed.
 *
 * Primary responsibilities are:
 *  - Creating a Circle that represents the visual Ball object with a label that displays its index.
 *  - Updating the Circle's center location when the Ball's position changes.
 *  - Updating the Circle's radius when the Ball's radius changes.
 *  - Handling drag requests to change the position of the Ball and showing leader-lines.
 *  - Creating and positioning NumberDisplays for the speed and momentum values of the Ball.
 *  - Creating BallVectorNodes to allow the user to see/manipulate the momentum and velocity vectors of the Ball.
 *
 * For the 'Collision Lab' sim, Balls are instantiated at the start and the same Balls are used with the same
 * number of Balls in the system. They are never disposed even if they aren't in the system. Thus, BallNodes
 * persist for the lifetime of the simulation and links are left as-is. See BallSystemNode.js for more background.
 *
 * NOTE: Do not translate this node. It's origin must be at the origin of the view coordinate frame.
 *
 * @author Brandon Li
 * @author Martin Veillette
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Multilink from '../../../../axon/js/Multilink.js';
import Range from '../../../../dot/js/Range.js';
import Utils from '../../../../dot/js/Utils.js';
import { Shape } from '../../../../kite/js/imports.js';
import AssertUtils from '../../../../phetcommon/js/AssertUtils.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Circle, Color, DragListener, Node, Text } from '../../../../scenery/js/imports.js';
import collisionLab from '../../collisionLab.js';
import CollisionLabStrings from '../../CollisionLabStrings.js';
import CollisionLabColors from '../CollisionLabColors.js';
import CollisionLabConstants from '../CollisionLabConstants.js';
import CollisionLabUtils from '../CollisionLabUtils.js';
import Ball from '../model/Ball.js';
import BallUtils from '../model/BallUtils.js';
import BallMomentumVectorNode from './BallMomentumVectorNode.js';
import BallVelocityVectorNode from './BallVelocityVectorNode.js';
import LeaderLinesNode from './LeaderLinesNode.js';
import PlayAreaNumberDisplay from './PlayAreaNumberDisplay.js';

// constants
const MASS_RANGE = CollisionLabConstants.MASS_RANGE;
const ELASTICITY_PERCENT_RANGE = CollisionLabConstants.ELASTICITY_PERCENT_RANGE;
const LABEL_FONT = new PhetFont(20);
const LINE_WIDTH_RANGE = new Range(1, 3);
class BallNode extends Node {
  /**
   * @param {Ball} ball - the Ball model
   * @param {BallSystem} ballSystem
   * @param {Property.<boolean>} valuesVisibleProperty - indicates if the momentum and speed NumberDisplays are visible.
   * @param {Property.<boolean>} velocityVectorVisibleProperty - indicates if the velocity vector is visible.
   * @param {Property.<boolean>} momentumVectorVisibleProperty - indicates if the momentum vector is visible.
   * @param {Property.<number>} elasticityPercentProperty - elasticity of all collisions as a percentage
   * @param {Property.<boolean>} isPlayingProperty - indicates if simulation is playing or not.
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Object} [options]
   */
  constructor(ball, ballSystem, valuesVisibleProperty, velocityVectorVisibleProperty, momentumVectorVisibleProperty, elasticityPercentProperty, isPlayingProperty, modelViewTransform, options) {
    assert && assert(ball instanceof Ball, `invalid ball: ${ball}`);
    assert && AssertUtils.assertPropertyOf(valuesVisibleProperty, 'boolean');
    assert && AssertUtils.assertPropertyOf(velocityVectorVisibleProperty, 'boolean');
    assert && AssertUtils.assertPropertyOf(momentumVectorVisibleProperty, 'boolean');
    assert && AssertUtils.assertPropertyOf(isPlayingProperty, 'boolean');
    assert && assert(modelViewTransform instanceof ModelViewTransform2, `invalid modelViewTransform: ${modelViewTransform}`);
    super(options);

    // The fill color of the Ball. The color of the Ball is based on its index. If isConstantSizeProperty is true,
    // its brightnessFactor is increased based on the mass to indicate a denser ball (more dense = more saturated).
    // DerivedProperty is never disposed since BallNodes are never disposed.
    const fillProperty = new DerivedProperty([ball.massProperty, ballSystem.ballsConstantSizeProperty], (mass, isConstantSize) => {
      const brightnessFactor = isConstantSize ? Utils.linear(MASS_RANGE.min, MASS_RANGE.max, 0.7, 0, mass) : 0;
      return CollisionLabColors.BALL_COLORS[ball.index - 1].colorUtilsBrighter(brightnessFactor);
    });

    //----------------------------------------------------------------------------------------

    // Create the Circle Node that represents the visual aspect of a Ball. Radius and position to be updated later.
    const ballCircle = new Circle({
      fill: fillProperty,
      stroke: CollisionLabColors.BALL_STROKE_COLOR,
      cursor: 'pointer'
    });

    // Create the label that displays the index of the Ball. To be positioned later.
    const labelNode = new Text(ball.index, {
      font: LABEL_FONT,
      stroke: Color.BLACK,
      fill: Color.WHITE,
      pickable: false
    });

    // Create the Vector Node for the velocity vector of the Ball. To be positioned later.
    const velocityVectorNode = new BallVelocityVectorNode(ball, ball.playArea.dimension, velocityVectorVisibleProperty, isPlayingProperty, modelViewTransform);

    // Create the Vector Node for the momentum vector of the Ball. To be positioned later.
    const momentumVectorNode = new BallMomentumVectorNode(ball.positionProperty, ball.momentumProperty, momentumVectorVisibleProperty, modelViewTransform);

    // Create the number display for the speed of the Ball, which appears above the ball. To be positioned later.
    const speedNumberDisplay = new PlayAreaNumberDisplay(ball.speedProperty, {
      visibleProperty: valuesVisibleProperty,
      valuePattern: StringUtils.fillIn(CollisionLabStrings.pattern.vectorSymbolEqualsValueSpaceUnits, {
        symbol: CollisionLabStrings.symbol.velocity,
        units: 'm/s'
      })
    });

    // Create the number display for the momentum of the Ball, which appears below the ball. To be positioned later.
    const momentumNumberDisplay = new PlayAreaNumberDisplay(ball.momentumMagnitudeProperty, {
      visibleProperty: valuesVisibleProperty,
      valuePattern: StringUtils.fillIn(CollisionLabStrings.pattern.vectorSymbolEqualsValueSpaceUnits, {
        symbol: CollisionLabStrings.symbol.momentum,
        units: 'kg\u00b7m/s'
      })
    });

    // Reference the bounds of the PlayArea in view coordinates.
    const playAreaViewBounds = modelViewTransform.modelToViewBounds(ball.playArea.bounds);

    // Create the 'leader lines', which are displayed when the Ball is being dragged. To be drawn and positioned later.
    const leaderLinesNode = new LeaderLinesNode(playAreaViewBounds);

    //----------------------------------------------------------------------------------------

    // Wrap the BallCircle and the Label in a Node and apply a local ClipArea so that the Ball doesn't appear outside
    // of the PlayArea. This container is not translated so its local Bounds is the same as the parent bounds of the
    // BallCircle and Label. Note that this clip-area doesn't apply to any of the NumberDisplays or VectorNodes.
    const ballCircleAndLabelContainer = new Node({
      children: [ballCircle, labelNode],
      clipArea: Shape.bounds(playAreaViewBounds)
    });

    // Wrap the components that are only visible when the Ball is inside of the PlayArea.
    const ballInsideVisibleContainer = new Node({
      children: [momentumVectorNode, velocityVectorNode, speedNumberDisplay, momentumNumberDisplay]
    });

    // Set the children of the Ball Node in the correct rendering order.
    this.children = [leaderLinesNode, ballCircleAndLabelContainer, ballInsideVisibleContainer];

    //----------------------------------------------------------------------------------------

    // Listen to when the when the Ball's radius changes and update the radius of the ballCircle. It was decided
    // to decrease the line-width with elasticity; a thicker stroke could indicate a rubbery coating which would be
    // inelastic. See https://github.com/phetsims/collision-lab/issues/38. Link persists for the lifetime of the sim.
    Multilink.multilink([ball.radiusProperty, elasticityPercentProperty], (radius, elasticity) => {
      // Update the line-width based on the elasticity using a linear mapping.
      ballCircle.lineWidth = Utils.linear(ELASTICITY_PERCENT_RANGE.min, ELASTICITY_PERCENT_RANGE.max, LINE_WIDTH_RANGE.max, LINE_WIDTH_RANGE.min, elasticity);

      // Update the radius of the Ball, subtracting half of the line-width so that the stroke is directed 'inwards'.
      ballCircle.radius = modelViewTransform.modelToViewDeltaX(radius) - ballCircle.lineWidth / 2;
    });

    //----------------------------------------------------------------------------------------

    // Add a DragListener to the Ball Circle for translating the Ball. Listener is never removed since BallNodes are
    // never disposed.
    ballCircle.addInputListener(new DragListener({
      transform: modelViewTransform,
      drag: (event, listener) => {
        ball.dragToPosition(listener.modelPoint);

        // Now that the user is dragging the Ball, update the leader-lines.
        leaderLinesNode.setReticle(ballCircle.center);
      },
      // Set the positionUserControlledProperty of the ball and the visibility of the leader-lines when dragging.
      start: (event, listener) => {
        ball.dragToPosition(listener.modelPoint);
        leaderLinesNode.setReticle(ballCircle.center);
        leaderLinesNode.visible = true;
        ball.xPositionUserControlledProperty.value = true;
        ball.yPositionUserControlledProperty.value = true;
      },
      end: () => {
        leaderLinesNode.visible = false;
        const constrainedBounds = BallUtils.getBallGridSafeConstrainedBounds(ball.playArea.bounds, ball.radiusProperty.value, 10 ** -CollisionLabConstants.DISPLAY_DECIMAL_PLACES);

        // Round the position to match the displayed value on drag-release. See
        // https://github.com/phetsims/collision-lab/issues/136.
        ball.positionProperty.value = CollisionLabUtils.roundVectorToNearest(constrainedBounds.closestPointTo(ball.positionProperty.value), 10 ** -CollisionLabConstants.DISPLAY_DECIMAL_PLACES);
        // When the user is finished dragging the Ball, bump the Ball away from the other Balls that it is overlapping
        // with. See https://github.com/phetsims/collision-lab/issues/100.
        ballSystem.bumpBallAwayFromOthers(ball);
        ball.xPositionUserControlledProperty.value = false;
        ball.yPositionUserControlledProperty.value = false;
      }
    }));

    //----------------------------------------------------------------------------------------

    // Observe when the Ball's position changes to update the positioning of the BallCircle and the Vector Nodes.
    // Link persists for the lifetime of the simulation.
    ball.positionProperty.link(position => {
      const viewPosition = modelViewTransform.modelToViewPosition(position);

      // Update the positioning of view components.
      ballCircle.center = viewPosition;
      labelNode.center = viewPosition;

      // Set the ballInsideVisibleContainer to visible if the Ball's center is inside the PlayArea.
      ballInsideVisibleContainer.visible = playAreaViewBounds.containsPoint(viewPosition);
    });

    // Observe when either the position of the Ball changes or when the radius of the Ball changes, which changes
    // the positioning of the speed and momentum NumberDisplays. Link persists for the lifetime of the simulation.
    Multilink.multilink([valuesVisibleProperty, ball.positionProperty, ball.radiusProperty], valuesVisible => {
      if (valuesVisible) {
        // Only update positioning if the NumberDisplays are visible.

        // Update the position of the velocity and momentum NumberDisplays.
        speedNumberDisplay.centerBottom = ballCircle.centerTop.subtractXY(0, CollisionLabConstants.VALUE_DISPLAY_MARGIN);
        momentumNumberDisplay.centerTop = ballCircle.centerBottom.addXY(0, CollisionLabConstants.VALUE_DISPLAY_MARGIN);
      }
    });

    // Observe when the rotationProperty of the Ball changes and rotate the label of the BallNode. The ballCircle
    // doesn't need to be rotated. Link persists for the lifetime of the simulation.
    ball.rotationProperty.link(rotation => {
      labelNode.rotation = -rotation;
      labelNode.center = ballCircle.center;
    });
  }
}
collisionLab.register('BallNode', BallNode);
export default BallNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJNdWx0aWxpbmsiLCJSYW5nZSIsIlV0aWxzIiwiU2hhcGUiLCJBc3NlcnRVdGlscyIsIlN0cmluZ1V0aWxzIiwiTW9kZWxWaWV3VHJhbnNmb3JtMiIsIlBoZXRGb250IiwiQ2lyY2xlIiwiQ29sb3IiLCJEcmFnTGlzdGVuZXIiLCJOb2RlIiwiVGV4dCIsImNvbGxpc2lvbkxhYiIsIkNvbGxpc2lvbkxhYlN0cmluZ3MiLCJDb2xsaXNpb25MYWJDb2xvcnMiLCJDb2xsaXNpb25MYWJDb25zdGFudHMiLCJDb2xsaXNpb25MYWJVdGlscyIsIkJhbGwiLCJCYWxsVXRpbHMiLCJCYWxsTW9tZW50dW1WZWN0b3JOb2RlIiwiQmFsbFZlbG9jaXR5VmVjdG9yTm9kZSIsIkxlYWRlckxpbmVzTm9kZSIsIlBsYXlBcmVhTnVtYmVyRGlzcGxheSIsIk1BU1NfUkFOR0UiLCJFTEFTVElDSVRZX1BFUkNFTlRfUkFOR0UiLCJMQUJFTF9GT05UIiwiTElORV9XSURUSF9SQU5HRSIsIkJhbGxOb2RlIiwiY29uc3RydWN0b3IiLCJiYWxsIiwiYmFsbFN5c3RlbSIsInZhbHVlc1Zpc2libGVQcm9wZXJ0eSIsInZlbG9jaXR5VmVjdG9yVmlzaWJsZVByb3BlcnR5IiwibW9tZW50dW1WZWN0b3JWaXNpYmxlUHJvcGVydHkiLCJlbGFzdGljaXR5UGVyY2VudFByb3BlcnR5IiwiaXNQbGF5aW5nUHJvcGVydHkiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJvcHRpb25zIiwiYXNzZXJ0IiwiYXNzZXJ0UHJvcGVydHlPZiIsImZpbGxQcm9wZXJ0eSIsIm1hc3NQcm9wZXJ0eSIsImJhbGxzQ29uc3RhbnRTaXplUHJvcGVydHkiLCJtYXNzIiwiaXNDb25zdGFudFNpemUiLCJicmlnaHRuZXNzRmFjdG9yIiwibGluZWFyIiwibWluIiwibWF4IiwiQkFMTF9DT0xPUlMiLCJpbmRleCIsImNvbG9yVXRpbHNCcmlnaHRlciIsImJhbGxDaXJjbGUiLCJmaWxsIiwic3Ryb2tlIiwiQkFMTF9TVFJPS0VfQ09MT1IiLCJjdXJzb3IiLCJsYWJlbE5vZGUiLCJmb250IiwiQkxBQ0siLCJXSElURSIsInBpY2thYmxlIiwidmVsb2NpdHlWZWN0b3JOb2RlIiwicGxheUFyZWEiLCJkaW1lbnNpb24iLCJtb21lbnR1bVZlY3Rvck5vZGUiLCJwb3NpdGlvblByb3BlcnR5IiwibW9tZW50dW1Qcm9wZXJ0eSIsInNwZWVkTnVtYmVyRGlzcGxheSIsInNwZWVkUHJvcGVydHkiLCJ2aXNpYmxlUHJvcGVydHkiLCJ2YWx1ZVBhdHRlcm4iLCJmaWxsSW4iLCJwYXR0ZXJuIiwidmVjdG9yU3ltYm9sRXF1YWxzVmFsdWVTcGFjZVVuaXRzIiwic3ltYm9sIiwidmVsb2NpdHkiLCJ1bml0cyIsIm1vbWVudHVtTnVtYmVyRGlzcGxheSIsIm1vbWVudHVtTWFnbml0dWRlUHJvcGVydHkiLCJtb21lbnR1bSIsInBsYXlBcmVhVmlld0JvdW5kcyIsIm1vZGVsVG9WaWV3Qm91bmRzIiwiYm91bmRzIiwibGVhZGVyTGluZXNOb2RlIiwiYmFsbENpcmNsZUFuZExhYmVsQ29udGFpbmVyIiwiY2hpbGRyZW4iLCJjbGlwQXJlYSIsImJhbGxJbnNpZGVWaXNpYmxlQ29udGFpbmVyIiwibXVsdGlsaW5rIiwicmFkaXVzUHJvcGVydHkiLCJyYWRpdXMiLCJlbGFzdGljaXR5IiwibGluZVdpZHRoIiwibW9kZWxUb1ZpZXdEZWx0YVgiLCJhZGRJbnB1dExpc3RlbmVyIiwidHJhbnNmb3JtIiwiZHJhZyIsImV2ZW50IiwibGlzdGVuZXIiLCJkcmFnVG9Qb3NpdGlvbiIsIm1vZGVsUG9pbnQiLCJzZXRSZXRpY2xlIiwiY2VudGVyIiwic3RhcnQiLCJ2aXNpYmxlIiwieFBvc2l0aW9uVXNlckNvbnRyb2xsZWRQcm9wZXJ0eSIsInZhbHVlIiwieVBvc2l0aW9uVXNlckNvbnRyb2xsZWRQcm9wZXJ0eSIsImVuZCIsImNvbnN0cmFpbmVkQm91bmRzIiwiZ2V0QmFsbEdyaWRTYWZlQ29uc3RyYWluZWRCb3VuZHMiLCJESVNQTEFZX0RFQ0lNQUxfUExBQ0VTIiwicm91bmRWZWN0b3JUb05lYXJlc3QiLCJjbG9zZXN0UG9pbnRUbyIsImJ1bXBCYWxsQXdheUZyb21PdGhlcnMiLCJsaW5rIiwicG9zaXRpb24iLCJ2aWV3UG9zaXRpb24iLCJtb2RlbFRvVmlld1Bvc2l0aW9uIiwiY29udGFpbnNQb2ludCIsInZhbHVlc1Zpc2libGUiLCJjZW50ZXJCb3R0b20iLCJjZW50ZXJUb3AiLCJzdWJ0cmFjdFhZIiwiVkFMVUVfRElTUExBWV9NQVJHSU4iLCJhZGRYWSIsInJvdGF0aW9uUHJvcGVydHkiLCJyb3RhdGlvbiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQmFsbE5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQmFsbE5vZGUgaXMgdGhlIHZpZXcgcmVwcmVzZW50YXRpb24gb2YgYSBzaW5nbGUgc3BoZXJpY2FsIEJhbGwsIHdoaWNoIGFwcGVhcnMgaW4gYWxsIHNjcmVlbnMgb2YgdGhlICdDb2xsaXNpb24gTGFiJ1xyXG4gKiBzaW11bGF0aW9uLiBCYWxsTm9kZXMgYXJlIGltcGxlbWVudGVkIHRvIHdvcmsgZm9yIGJvdGggMUQgYW5kIDJEIHNjcmVlbnMsIHNvIG5vIHN1Yi10eXBlcyBhcmUgbmVlZGVkLlxyXG4gKlxyXG4gKiBQcmltYXJ5IHJlc3BvbnNpYmlsaXRpZXMgYXJlOlxyXG4gKiAgLSBDcmVhdGluZyBhIENpcmNsZSB0aGF0IHJlcHJlc2VudHMgdGhlIHZpc3VhbCBCYWxsIG9iamVjdCB3aXRoIGEgbGFiZWwgdGhhdCBkaXNwbGF5cyBpdHMgaW5kZXguXHJcbiAqICAtIFVwZGF0aW5nIHRoZSBDaXJjbGUncyBjZW50ZXIgbG9jYXRpb24gd2hlbiB0aGUgQmFsbCdzIHBvc2l0aW9uIGNoYW5nZXMuXHJcbiAqICAtIFVwZGF0aW5nIHRoZSBDaXJjbGUncyByYWRpdXMgd2hlbiB0aGUgQmFsbCdzIHJhZGl1cyBjaGFuZ2VzLlxyXG4gKiAgLSBIYW5kbGluZyBkcmFnIHJlcXVlc3RzIHRvIGNoYW5nZSB0aGUgcG9zaXRpb24gb2YgdGhlIEJhbGwgYW5kIHNob3dpbmcgbGVhZGVyLWxpbmVzLlxyXG4gKiAgLSBDcmVhdGluZyBhbmQgcG9zaXRpb25pbmcgTnVtYmVyRGlzcGxheXMgZm9yIHRoZSBzcGVlZCBhbmQgbW9tZW50dW0gdmFsdWVzIG9mIHRoZSBCYWxsLlxyXG4gKiAgLSBDcmVhdGluZyBCYWxsVmVjdG9yTm9kZXMgdG8gYWxsb3cgdGhlIHVzZXIgdG8gc2VlL21hbmlwdWxhdGUgdGhlIG1vbWVudHVtIGFuZCB2ZWxvY2l0eSB2ZWN0b3JzIG9mIHRoZSBCYWxsLlxyXG4gKlxyXG4gKiBGb3IgdGhlICdDb2xsaXNpb24gTGFiJyBzaW0sIEJhbGxzIGFyZSBpbnN0YW50aWF0ZWQgYXQgdGhlIHN0YXJ0IGFuZCB0aGUgc2FtZSBCYWxscyBhcmUgdXNlZCB3aXRoIHRoZSBzYW1lXHJcbiAqIG51bWJlciBvZiBCYWxscyBpbiB0aGUgc3lzdGVtLiBUaGV5IGFyZSBuZXZlciBkaXNwb3NlZCBldmVuIGlmIHRoZXkgYXJlbid0IGluIHRoZSBzeXN0ZW0uIFRodXMsIEJhbGxOb2Rlc1xyXG4gKiBwZXJzaXN0IGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIHNpbXVsYXRpb24gYW5kIGxpbmtzIGFyZSBsZWZ0IGFzLWlzLiBTZWUgQmFsbFN5c3RlbU5vZGUuanMgZm9yIG1vcmUgYmFja2dyb3VuZC5cclxuICpcclxuICogTk9URTogRG8gbm90IHRyYW5zbGF0ZSB0aGlzIG5vZGUuIEl0J3Mgb3JpZ2luIG11c3QgYmUgYXQgdGhlIG9yaWdpbiBvZiB0aGUgdmlldyBjb29yZGluYXRlIGZyYW1lLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEJyYW5kb24gTGlcclxuICogQGF1dGhvciBNYXJ0aW4gVmVpbGxldHRlXHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEFzc2VydFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvQXNzZXJ0VXRpbHMuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgQ2lyY2xlLCBDb2xvciwgRHJhZ0xpc3RlbmVyLCBOb2RlLCBUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGNvbGxpc2lvbkxhYiBmcm9tICcuLi8uLi9jb2xsaXNpb25MYWIuanMnO1xyXG5pbXBvcnQgQ29sbGlzaW9uTGFiU3RyaW5ncyBmcm9tICcuLi8uLi9Db2xsaXNpb25MYWJTdHJpbmdzLmpzJztcclxuaW1wb3J0IENvbGxpc2lvbkxhYkNvbG9ycyBmcm9tICcuLi9Db2xsaXNpb25MYWJDb2xvcnMuanMnO1xyXG5pbXBvcnQgQ29sbGlzaW9uTGFiQ29uc3RhbnRzIGZyb20gJy4uL0NvbGxpc2lvbkxhYkNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBDb2xsaXNpb25MYWJVdGlscyBmcm9tICcuLi9Db2xsaXNpb25MYWJVdGlscy5qcyc7XHJcbmltcG9ydCBCYWxsIGZyb20gJy4uL21vZGVsL0JhbGwuanMnO1xyXG5pbXBvcnQgQmFsbFV0aWxzIGZyb20gJy4uL21vZGVsL0JhbGxVdGlscy5qcyc7XHJcbmltcG9ydCBCYWxsTW9tZW50dW1WZWN0b3JOb2RlIGZyb20gJy4vQmFsbE1vbWVudHVtVmVjdG9yTm9kZS5qcyc7XHJcbmltcG9ydCBCYWxsVmVsb2NpdHlWZWN0b3JOb2RlIGZyb20gJy4vQmFsbFZlbG9jaXR5VmVjdG9yTm9kZS5qcyc7XHJcbmltcG9ydCBMZWFkZXJMaW5lc05vZGUgZnJvbSAnLi9MZWFkZXJMaW5lc05vZGUuanMnO1xyXG5pbXBvcnQgUGxheUFyZWFOdW1iZXJEaXNwbGF5IGZyb20gJy4vUGxheUFyZWFOdW1iZXJEaXNwbGF5LmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBNQVNTX1JBTkdFID0gQ29sbGlzaW9uTGFiQ29uc3RhbnRzLk1BU1NfUkFOR0U7XHJcbmNvbnN0IEVMQVNUSUNJVFlfUEVSQ0VOVF9SQU5HRSA9IENvbGxpc2lvbkxhYkNvbnN0YW50cy5FTEFTVElDSVRZX1BFUkNFTlRfUkFOR0U7XHJcbmNvbnN0IExBQkVMX0ZPTlQgPSBuZXcgUGhldEZvbnQoIDIwICk7XHJcbmNvbnN0IExJTkVfV0lEVEhfUkFOR0UgPSBuZXcgUmFuZ2UoIDEsIDMgKTtcclxuXHJcbmNsYXNzIEJhbGxOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7QmFsbH0gYmFsbCAtIHRoZSBCYWxsIG1vZGVsXHJcbiAgICogQHBhcmFtIHtCYWxsU3lzdGVtfSBiYWxsU3lzdGVtXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IHZhbHVlc1Zpc2libGVQcm9wZXJ0eSAtIGluZGljYXRlcyBpZiB0aGUgbW9tZW50dW0gYW5kIHNwZWVkIE51bWJlckRpc3BsYXlzIGFyZSB2aXNpYmxlLlxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPGJvb2xlYW4+fSB2ZWxvY2l0eVZlY3RvclZpc2libGVQcm9wZXJ0eSAtIGluZGljYXRlcyBpZiB0aGUgdmVsb2NpdHkgdmVjdG9yIGlzIHZpc2libGUuXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IG1vbWVudHVtVmVjdG9yVmlzaWJsZVByb3BlcnR5IC0gaW5kaWNhdGVzIGlmIHRoZSBtb21lbnR1bSB2ZWN0b3IgaXMgdmlzaWJsZS5cclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5LjxudW1iZXI+fSBlbGFzdGljaXR5UGVyY2VudFByb3BlcnR5IC0gZWxhc3RpY2l0eSBvZiBhbGwgY29sbGlzaW9ucyBhcyBhIHBlcmNlbnRhZ2VcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5Ljxib29sZWFuPn0gaXNQbGF5aW5nUHJvcGVydHkgLSBpbmRpY2F0ZXMgaWYgc2ltdWxhdGlvbiBpcyBwbGF5aW5nIG9yIG5vdC5cclxuICAgKiBAcGFyYW0ge01vZGVsVmlld1RyYW5zZm9ybTJ9IG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggYmFsbCxcclxuICAgICAgICAgICAgICAgYmFsbFN5c3RlbSxcclxuICAgICAgICAgICAgICAgdmFsdWVzVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICAgICAgICAgICB2ZWxvY2l0eVZlY3RvclZpc2libGVQcm9wZXJ0eSxcclxuICAgICAgICAgICAgICAgbW9tZW50dW1WZWN0b3JWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgICAgICAgICAgIGVsYXN0aWNpdHlQZXJjZW50UHJvcGVydHksXHJcbiAgICAgICAgICAgICAgIGlzUGxheWluZ1Byb3BlcnR5LFxyXG4gICAgICAgICAgICAgICBtb2RlbFZpZXdUcmFuc2Zvcm0sXHJcbiAgICAgICAgICAgICAgIG9wdGlvbnMgKSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBiYWxsIGluc3RhbmNlb2YgQmFsbCwgYGludmFsaWQgYmFsbDogJHtiYWxsfWAgKTtcclxuICAgIGFzc2VydCAmJiBBc3NlcnRVdGlscy5hc3NlcnRQcm9wZXJ0eU9mKCB2YWx1ZXNWaXNpYmxlUHJvcGVydHksICdib29sZWFuJyApO1xyXG4gICAgYXNzZXJ0ICYmIEFzc2VydFV0aWxzLmFzc2VydFByb3BlcnR5T2YoIHZlbG9jaXR5VmVjdG9yVmlzaWJsZVByb3BlcnR5LCAnYm9vbGVhbicgKTtcclxuICAgIGFzc2VydCAmJiBBc3NlcnRVdGlscy5hc3NlcnRQcm9wZXJ0eU9mKCBtb21lbnR1bVZlY3RvclZpc2libGVQcm9wZXJ0eSwgJ2Jvb2xlYW4nICk7XHJcbiAgICBhc3NlcnQgJiYgQXNzZXJ0VXRpbHMuYXNzZXJ0UHJvcGVydHlPZiggaXNQbGF5aW5nUHJvcGVydHksICdib29sZWFuJyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggbW9kZWxWaWV3VHJhbnNmb3JtIGluc3RhbmNlb2YgTW9kZWxWaWV3VHJhbnNmb3JtMiwgYGludmFsaWQgbW9kZWxWaWV3VHJhbnNmb3JtOiAke21vZGVsVmlld1RyYW5zZm9ybX1gICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBUaGUgZmlsbCBjb2xvciBvZiB0aGUgQmFsbC4gVGhlIGNvbG9yIG9mIHRoZSBCYWxsIGlzIGJhc2VkIG9uIGl0cyBpbmRleC4gSWYgaXNDb25zdGFudFNpemVQcm9wZXJ0eSBpcyB0cnVlLFxyXG4gICAgLy8gaXRzIGJyaWdodG5lc3NGYWN0b3IgaXMgaW5jcmVhc2VkIGJhc2VkIG9uIHRoZSBtYXNzIHRvIGluZGljYXRlIGEgZGVuc2VyIGJhbGwgKG1vcmUgZGVuc2UgPSBtb3JlIHNhdHVyYXRlZCkuXHJcbiAgICAvLyBEZXJpdmVkUHJvcGVydHkgaXMgbmV2ZXIgZGlzcG9zZWQgc2luY2UgQmFsbE5vZGVzIGFyZSBuZXZlciBkaXNwb3NlZC5cclxuICAgIGNvbnN0IGZpbGxQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgYmFsbC5tYXNzUHJvcGVydHksIGJhbGxTeXN0ZW0uYmFsbHNDb25zdGFudFNpemVQcm9wZXJ0eSBdLFxyXG4gICAgICAoIG1hc3MsIGlzQ29uc3RhbnRTaXplICkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGJyaWdodG5lc3NGYWN0b3IgPSBpc0NvbnN0YW50U2l6ZSA/IFV0aWxzLmxpbmVhciggTUFTU19SQU5HRS5taW4sIE1BU1NfUkFOR0UubWF4LCAwLjcsIDAsIG1hc3MgKSA6IDA7XHJcbiAgICAgICAgcmV0dXJuIENvbGxpc2lvbkxhYkNvbG9ycy5CQUxMX0NPTE9SU1sgYmFsbC5pbmRleCAtIDEgXS5jb2xvclV0aWxzQnJpZ2h0ZXIoIGJyaWdodG5lc3NGYWN0b3IgKTtcclxuICAgICAgfSApO1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgQ2lyY2xlIE5vZGUgdGhhdCByZXByZXNlbnRzIHRoZSB2aXN1YWwgYXNwZWN0IG9mIGEgQmFsbC4gUmFkaXVzIGFuZCBwb3NpdGlvbiB0byBiZSB1cGRhdGVkIGxhdGVyLlxyXG4gICAgY29uc3QgYmFsbENpcmNsZSA9IG5ldyBDaXJjbGUoIHtcclxuICAgICAgZmlsbDogZmlsbFByb3BlcnR5LFxyXG4gICAgICBzdHJva2U6IENvbGxpc2lvbkxhYkNvbG9ycy5CQUxMX1NUUk9LRV9DT0xPUixcclxuICAgICAgY3Vyc29yOiAncG9pbnRlcidcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIGxhYmVsIHRoYXQgZGlzcGxheXMgdGhlIGluZGV4IG9mIHRoZSBCYWxsLiBUbyBiZSBwb3NpdGlvbmVkIGxhdGVyLlxyXG4gICAgY29uc3QgbGFiZWxOb2RlID0gbmV3IFRleHQoIGJhbGwuaW5kZXgsIHtcclxuICAgICAgZm9udDogTEFCRUxfRk9OVCxcclxuICAgICAgc3Ryb2tlOiBDb2xvci5CTEFDSyxcclxuICAgICAgZmlsbDogQ29sb3IuV0hJVEUsXHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgVmVjdG9yIE5vZGUgZm9yIHRoZSB2ZWxvY2l0eSB2ZWN0b3Igb2YgdGhlIEJhbGwuIFRvIGJlIHBvc2l0aW9uZWQgbGF0ZXIuXHJcbiAgICBjb25zdCB2ZWxvY2l0eVZlY3Rvck5vZGUgPSBuZXcgQmFsbFZlbG9jaXR5VmVjdG9yTm9kZSggYmFsbCxcclxuICAgICAgYmFsbC5wbGF5QXJlYS5kaW1lbnNpb24sXHJcbiAgICAgIHZlbG9jaXR5VmVjdG9yVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICBpc1BsYXlpbmdQcm9wZXJ0eSxcclxuICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBWZWN0b3IgTm9kZSBmb3IgdGhlIG1vbWVudHVtIHZlY3RvciBvZiB0aGUgQmFsbC4gVG8gYmUgcG9zaXRpb25lZCBsYXRlci5cclxuICAgIGNvbnN0IG1vbWVudHVtVmVjdG9yTm9kZSA9IG5ldyBCYWxsTW9tZW50dW1WZWN0b3JOb2RlKCBiYWxsLnBvc2l0aW9uUHJvcGVydHksXHJcbiAgICAgIGJhbGwubW9tZW50dW1Qcm9wZXJ0eSxcclxuICAgICAgbW9tZW50dW1WZWN0b3JWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgIG1vZGVsVmlld1RyYW5zZm9ybSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgbnVtYmVyIGRpc3BsYXkgZm9yIHRoZSBzcGVlZCBvZiB0aGUgQmFsbCwgd2hpY2ggYXBwZWFycyBhYm92ZSB0aGUgYmFsbC4gVG8gYmUgcG9zaXRpb25lZCBsYXRlci5cclxuICAgIGNvbnN0IHNwZWVkTnVtYmVyRGlzcGxheSA9IG5ldyBQbGF5QXJlYU51bWJlckRpc3BsYXkoIGJhbGwuc3BlZWRQcm9wZXJ0eSwge1xyXG4gICAgICB2aXNpYmxlUHJvcGVydHk6IHZhbHVlc1Zpc2libGVQcm9wZXJ0eSxcclxuICAgICAgdmFsdWVQYXR0ZXJuOiBTdHJpbmdVdGlscy5maWxsSW4oIENvbGxpc2lvbkxhYlN0cmluZ3MucGF0dGVybi52ZWN0b3JTeW1ib2xFcXVhbHNWYWx1ZVNwYWNlVW5pdHMsIHtcclxuICAgICAgICBzeW1ib2w6IENvbGxpc2lvbkxhYlN0cmluZ3Muc3ltYm9sLnZlbG9jaXR5LFxyXG4gICAgICAgIHVuaXRzOiAnbS9zJ1xyXG4gICAgICB9IClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIG51bWJlciBkaXNwbGF5IGZvciB0aGUgbW9tZW50dW0gb2YgdGhlIEJhbGwsIHdoaWNoIGFwcGVhcnMgYmVsb3cgdGhlIGJhbGwuIFRvIGJlIHBvc2l0aW9uZWQgbGF0ZXIuXHJcbiAgICBjb25zdCBtb21lbnR1bU51bWJlckRpc3BsYXkgPSBuZXcgUGxheUFyZWFOdW1iZXJEaXNwbGF5KCBiYWxsLm1vbWVudHVtTWFnbml0dWRlUHJvcGVydHksIHtcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiB2YWx1ZXNWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgIHZhbHVlUGF0dGVybjogU3RyaW5nVXRpbHMuZmlsbEluKCBDb2xsaXNpb25MYWJTdHJpbmdzLnBhdHRlcm4udmVjdG9yU3ltYm9sRXF1YWxzVmFsdWVTcGFjZVVuaXRzLCB7XHJcbiAgICAgICAgc3ltYm9sOiBDb2xsaXNpb25MYWJTdHJpbmdzLnN5bWJvbC5tb21lbnR1bSxcclxuICAgICAgICB1bml0czogJ2tnXFx1MDBiN20vcydcclxuICAgICAgfSApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gUmVmZXJlbmNlIHRoZSBib3VuZHMgb2YgdGhlIFBsYXlBcmVhIGluIHZpZXcgY29vcmRpbmF0ZXMuXHJcbiAgICBjb25zdCBwbGF5QXJlYVZpZXdCb3VuZHMgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdCb3VuZHMoIGJhbGwucGxheUFyZWEuYm91bmRzICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSAnbGVhZGVyIGxpbmVzJywgd2hpY2ggYXJlIGRpc3BsYXllZCB3aGVuIHRoZSBCYWxsIGlzIGJlaW5nIGRyYWdnZWQuIFRvIGJlIGRyYXduIGFuZCBwb3NpdGlvbmVkIGxhdGVyLlxyXG4gICAgY29uc3QgbGVhZGVyTGluZXNOb2RlID0gbmV3IExlYWRlckxpbmVzTm9kZSggcGxheUFyZWFWaWV3Qm91bmRzICk7XHJcblxyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgLy8gV3JhcCB0aGUgQmFsbENpcmNsZSBhbmQgdGhlIExhYmVsIGluIGEgTm9kZSBhbmQgYXBwbHkgYSBsb2NhbCBDbGlwQXJlYSBzbyB0aGF0IHRoZSBCYWxsIGRvZXNuJ3QgYXBwZWFyIG91dHNpZGVcclxuICAgIC8vIG9mIHRoZSBQbGF5QXJlYS4gVGhpcyBjb250YWluZXIgaXMgbm90IHRyYW5zbGF0ZWQgc28gaXRzIGxvY2FsIEJvdW5kcyBpcyB0aGUgc2FtZSBhcyB0aGUgcGFyZW50IGJvdW5kcyBvZiB0aGVcclxuICAgIC8vIEJhbGxDaXJjbGUgYW5kIExhYmVsLiBOb3RlIHRoYXQgdGhpcyBjbGlwLWFyZWEgZG9lc24ndCBhcHBseSB0byBhbnkgb2YgdGhlIE51bWJlckRpc3BsYXlzIG9yIFZlY3Rvck5vZGVzLlxyXG4gICAgY29uc3QgYmFsbENpcmNsZUFuZExhYmVsQ29udGFpbmVyID0gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFsgYmFsbENpcmNsZSwgbGFiZWxOb2RlIF0sXHJcbiAgICAgIGNsaXBBcmVhOiBTaGFwZS5ib3VuZHMoIHBsYXlBcmVhVmlld0JvdW5kcyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gV3JhcCB0aGUgY29tcG9uZW50cyB0aGF0IGFyZSBvbmx5IHZpc2libGUgd2hlbiB0aGUgQmFsbCBpcyBpbnNpZGUgb2YgdGhlIFBsYXlBcmVhLlxyXG4gICAgY29uc3QgYmFsbEluc2lkZVZpc2libGVDb250YWluZXIgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIG1vbWVudHVtVmVjdG9yTm9kZSxcclxuICAgICAgICB2ZWxvY2l0eVZlY3Rvck5vZGUsXHJcbiAgICAgICAgc3BlZWROdW1iZXJEaXNwbGF5LFxyXG4gICAgICAgIG1vbWVudHVtTnVtYmVyRGlzcGxheVxyXG4gICAgICBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gU2V0IHRoZSBjaGlsZHJlbiBvZiB0aGUgQmFsbCBOb2RlIGluIHRoZSBjb3JyZWN0IHJlbmRlcmluZyBvcmRlci5cclxuICAgIHRoaXMuY2hpbGRyZW4gPSBbXHJcbiAgICAgIGxlYWRlckxpbmVzTm9kZSxcclxuICAgICAgYmFsbENpcmNsZUFuZExhYmVsQ29udGFpbmVyLFxyXG4gICAgICBiYWxsSW5zaWRlVmlzaWJsZUNvbnRhaW5lclxyXG4gICAgXTtcclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgICAvLyBMaXN0ZW4gdG8gd2hlbiB0aGUgd2hlbiB0aGUgQmFsbCdzIHJhZGl1cyBjaGFuZ2VzIGFuZCB1cGRhdGUgdGhlIHJhZGl1cyBvZiB0aGUgYmFsbENpcmNsZS4gSXQgd2FzIGRlY2lkZWRcclxuICAgIC8vIHRvIGRlY3JlYXNlIHRoZSBsaW5lLXdpZHRoIHdpdGggZWxhc3RpY2l0eTsgYSB0aGlja2VyIHN0cm9rZSBjb3VsZCBpbmRpY2F0ZSBhIHJ1YmJlcnkgY29hdGluZyB3aGljaCB3b3VsZCBiZVxyXG4gICAgLy8gaW5lbGFzdGljLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NvbGxpc2lvbi1sYWIvaXNzdWVzLzM4LiBMaW5rIHBlcnNpc3RzIGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIHNpbS5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFsgYmFsbC5yYWRpdXNQcm9wZXJ0eSwgZWxhc3RpY2l0eVBlcmNlbnRQcm9wZXJ0eSBdLCAoIHJhZGl1cywgZWxhc3RpY2l0eSApID0+IHtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZSB0aGUgbGluZS13aWR0aCBiYXNlZCBvbiB0aGUgZWxhc3RpY2l0eSB1c2luZyBhIGxpbmVhciBtYXBwaW5nLlxyXG4gICAgICBiYWxsQ2lyY2xlLmxpbmVXaWR0aCA9IFV0aWxzLmxpbmVhciggRUxBU1RJQ0lUWV9QRVJDRU5UX1JBTkdFLm1pbixcclxuICAgICAgICBFTEFTVElDSVRZX1BFUkNFTlRfUkFOR0UubWF4LFxyXG4gICAgICAgIExJTkVfV0lEVEhfUkFOR0UubWF4LFxyXG4gICAgICAgIExJTkVfV0lEVEhfUkFOR0UubWluLFxyXG4gICAgICAgIGVsYXN0aWNpdHkgKTtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZSB0aGUgcmFkaXVzIG9mIHRoZSBCYWxsLCBzdWJ0cmFjdGluZyBoYWxmIG9mIHRoZSBsaW5lLXdpZHRoIHNvIHRoYXQgdGhlIHN0cm9rZSBpcyBkaXJlY3RlZCAnaW53YXJkcycuXHJcbiAgICAgIGJhbGxDaXJjbGUucmFkaXVzID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFYKCByYWRpdXMgKSAtIGJhbGxDaXJjbGUubGluZVdpZHRoIC8gMjtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgICAvLyBBZGQgYSBEcmFnTGlzdGVuZXIgdG8gdGhlIEJhbGwgQ2lyY2xlIGZvciB0cmFuc2xhdGluZyB0aGUgQmFsbC4gTGlzdGVuZXIgaXMgbmV2ZXIgcmVtb3ZlZCBzaW5jZSBCYWxsTm9kZXMgYXJlXHJcbiAgICAvLyBuZXZlciBkaXNwb3NlZC5cclxuICAgIGJhbGxDaXJjbGUuYWRkSW5wdXRMaXN0ZW5lciggbmV3IERyYWdMaXN0ZW5lcigge1xyXG4gICAgICB0cmFuc2Zvcm06IG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgZHJhZzogKCBldmVudCwgbGlzdGVuZXIgKSA9PiB7XHJcbiAgICAgICAgYmFsbC5kcmFnVG9Qb3NpdGlvbiggbGlzdGVuZXIubW9kZWxQb2ludCApO1xyXG5cclxuICAgICAgICAvLyBOb3cgdGhhdCB0aGUgdXNlciBpcyBkcmFnZ2luZyB0aGUgQmFsbCwgdXBkYXRlIHRoZSBsZWFkZXItbGluZXMuXHJcbiAgICAgICAgbGVhZGVyTGluZXNOb2RlLnNldFJldGljbGUoIGJhbGxDaXJjbGUuY2VudGVyICk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBTZXQgdGhlIHBvc2l0aW9uVXNlckNvbnRyb2xsZWRQcm9wZXJ0eSBvZiB0aGUgYmFsbCBhbmQgdGhlIHZpc2liaWxpdHkgb2YgdGhlIGxlYWRlci1saW5lcyB3aGVuIGRyYWdnaW5nLlxyXG4gICAgICBzdGFydDogKCBldmVudCwgbGlzdGVuZXIgKSA9PiB7XHJcbiAgICAgICAgYmFsbC5kcmFnVG9Qb3NpdGlvbiggbGlzdGVuZXIubW9kZWxQb2ludCApO1xyXG4gICAgICAgIGxlYWRlckxpbmVzTm9kZS5zZXRSZXRpY2xlKCBiYWxsQ2lyY2xlLmNlbnRlciApO1xyXG5cclxuICAgICAgICBsZWFkZXJMaW5lc05vZGUudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgYmFsbC54UG9zaXRpb25Vc2VyQ29udHJvbGxlZFByb3BlcnR5LnZhbHVlID0gdHJ1ZTtcclxuICAgICAgICBiYWxsLnlQb3NpdGlvblVzZXJDb250cm9sbGVkUHJvcGVydHkudmFsdWUgPSB0cnVlO1xyXG4gICAgICB9LFxyXG4gICAgICBlbmQ6ICgpID0+IHtcclxuICAgICAgICBsZWFkZXJMaW5lc05vZGUudmlzaWJsZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICBjb25zdCBjb25zdHJhaW5lZEJvdW5kcyA9IEJhbGxVdGlscy5nZXRCYWxsR3JpZFNhZmVDb25zdHJhaW5lZEJvdW5kcyhcclxuICAgICAgICAgIGJhbGwucGxheUFyZWEuYm91bmRzLFxyXG4gICAgICAgICAgYmFsbC5yYWRpdXNQcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgICAgIDEwICoqIC1Db2xsaXNpb25MYWJDb25zdGFudHMuRElTUExBWV9ERUNJTUFMX1BMQUNFU1xyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIC8vIFJvdW5kIHRoZSBwb3NpdGlvbiB0byBtYXRjaCB0aGUgZGlzcGxheWVkIHZhbHVlIG9uIGRyYWctcmVsZWFzZS4gU2VlXHJcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NvbGxpc2lvbi1sYWIvaXNzdWVzLzEzNi5cclxuICAgICAgICBiYWxsLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgPSBDb2xsaXNpb25MYWJVdGlscy5yb3VuZFZlY3RvclRvTmVhcmVzdChcclxuICAgICAgICAgIGNvbnN0cmFpbmVkQm91bmRzLmNsb3Nlc3RQb2ludFRvKCBiYWxsLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgKSxcclxuICAgICAgICAgIDEwICoqIC1Db2xsaXNpb25MYWJDb25zdGFudHMuRElTUExBWV9ERUNJTUFMX1BMQUNFU1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgLy8gV2hlbiB0aGUgdXNlciBpcyBmaW5pc2hlZCBkcmFnZ2luZyB0aGUgQmFsbCwgYnVtcCB0aGUgQmFsbCBhd2F5IGZyb20gdGhlIG90aGVyIEJhbGxzIHRoYXQgaXQgaXMgb3ZlcmxhcHBpbmdcclxuICAgICAgICAvLyB3aXRoLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NvbGxpc2lvbi1sYWIvaXNzdWVzLzEwMC5cclxuICAgICAgICBiYWxsU3lzdGVtLmJ1bXBCYWxsQXdheUZyb21PdGhlcnMoIGJhbGwgKTtcclxuXHJcbiAgICAgICAgYmFsbC54UG9zaXRpb25Vc2VyQ29udHJvbGxlZFByb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcbiAgICAgICAgYmFsbC55UG9zaXRpb25Vc2VyQ29udHJvbGxlZFByb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0gKSApO1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgIC8vIE9ic2VydmUgd2hlbiB0aGUgQmFsbCdzIHBvc2l0aW9uIGNoYW5nZXMgdG8gdXBkYXRlIHRoZSBwb3NpdGlvbmluZyBvZiB0aGUgQmFsbENpcmNsZSBhbmQgdGhlIFZlY3RvciBOb2Rlcy5cclxuICAgIC8vIExpbmsgcGVyc2lzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltdWxhdGlvbi5cclxuICAgIGJhbGwucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCBwb3NpdGlvbiA9PiB7XHJcbiAgICAgIGNvbnN0IHZpZXdQb3NpdGlvbiA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBwb3NpdGlvbiApO1xyXG5cclxuICAgICAgLy8gVXBkYXRlIHRoZSBwb3NpdGlvbmluZyBvZiB2aWV3IGNvbXBvbmVudHMuXHJcbiAgICAgIGJhbGxDaXJjbGUuY2VudGVyID0gdmlld1Bvc2l0aW9uO1xyXG4gICAgICBsYWJlbE5vZGUuY2VudGVyID0gdmlld1Bvc2l0aW9uO1xyXG5cclxuICAgICAgLy8gU2V0IHRoZSBiYWxsSW5zaWRlVmlzaWJsZUNvbnRhaW5lciB0byB2aXNpYmxlIGlmIHRoZSBCYWxsJ3MgY2VudGVyIGlzIGluc2lkZSB0aGUgUGxheUFyZWEuXHJcbiAgICAgIGJhbGxJbnNpZGVWaXNpYmxlQ29udGFpbmVyLnZpc2libGUgPSBwbGF5QXJlYVZpZXdCb3VuZHMuY29udGFpbnNQb2ludCggdmlld1Bvc2l0aW9uICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gT2JzZXJ2ZSB3aGVuIGVpdGhlciB0aGUgcG9zaXRpb24gb2YgdGhlIEJhbGwgY2hhbmdlcyBvciB3aGVuIHRoZSByYWRpdXMgb2YgdGhlIEJhbGwgY2hhbmdlcywgd2hpY2ggY2hhbmdlc1xyXG4gICAgLy8gdGhlIHBvc2l0aW9uaW5nIG9mIHRoZSBzcGVlZCBhbmQgbW9tZW50dW0gTnVtYmVyRGlzcGxheXMuIExpbmsgcGVyc2lzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltdWxhdGlvbi5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFsgdmFsdWVzVmlzaWJsZVByb3BlcnR5LCBiYWxsLnBvc2l0aW9uUHJvcGVydHksIGJhbGwucmFkaXVzUHJvcGVydHkgXSwgdmFsdWVzVmlzaWJsZSA9PiB7XHJcblxyXG4gICAgICBpZiAoIHZhbHVlc1Zpc2libGUgKSB7IC8vIE9ubHkgdXBkYXRlIHBvc2l0aW9uaW5nIGlmIHRoZSBOdW1iZXJEaXNwbGF5cyBhcmUgdmlzaWJsZS5cclxuXHJcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgdmVsb2NpdHkgYW5kIG1vbWVudHVtIE51bWJlckRpc3BsYXlzLlxyXG4gICAgICAgIHNwZWVkTnVtYmVyRGlzcGxheS5jZW50ZXJCb3R0b20gPSBiYWxsQ2lyY2xlLmNlbnRlclRvcC5zdWJ0cmFjdFhZKCAwLCBDb2xsaXNpb25MYWJDb25zdGFudHMuVkFMVUVfRElTUExBWV9NQVJHSU4gKTtcclxuICAgICAgICBtb21lbnR1bU51bWJlckRpc3BsYXkuY2VudGVyVG9wID0gYmFsbENpcmNsZS5jZW50ZXJCb3R0b20uYWRkWFkoIDAsIENvbGxpc2lvbkxhYkNvbnN0YW50cy5WQUxVRV9ESVNQTEFZX01BUkdJTiApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gT2JzZXJ2ZSB3aGVuIHRoZSByb3RhdGlvblByb3BlcnR5IG9mIHRoZSBCYWxsIGNoYW5nZXMgYW5kIHJvdGF0ZSB0aGUgbGFiZWwgb2YgdGhlIEJhbGxOb2RlLiBUaGUgYmFsbENpcmNsZVxyXG4gICAgLy8gZG9lc24ndCBuZWVkIHRvIGJlIHJvdGF0ZWQuIExpbmsgcGVyc2lzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltdWxhdGlvbi5cclxuICAgIGJhbGwucm90YXRpb25Qcm9wZXJ0eS5saW5rKCByb3RhdGlvbiA9PiB7XHJcbiAgICAgIGxhYmVsTm9kZS5yb3RhdGlvbiA9IC1yb3RhdGlvbjtcclxuICAgICAgbGFiZWxOb2RlLmNlbnRlciA9IGJhbGxDaXJjbGUuY2VudGVyO1xyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxuY29sbGlzaW9uTGFiLnJlZ2lzdGVyKCAnQmFsbE5vZGUnLCBCYWxsTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBCYWxsTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLFNBQVMsTUFBTSxrQ0FBa0M7QUFDeEQsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDdEQsT0FBT0MsV0FBVyxNQUFNLDBDQUEwQztBQUNsRSxPQUFPQyxXQUFXLE1BQU0sK0NBQStDO0FBQ3ZFLE9BQU9DLG1CQUFtQixNQUFNLHVEQUF1RDtBQUN2RixPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLE1BQU0sRUFBRUMsS0FBSyxFQUFFQyxZQUFZLEVBQUVDLElBQUksRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUMzRixPQUFPQyxZQUFZ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