// Copyright 2020-2022, University of Colorado Boulder

/**
 * BallSystemNode is the corresponding view for BallSystems for displaying a collection of Balls. They appear inside of
 * PlayAreaNodes in all screens.
 *
 * The BallSystemNode displays:
 *   - BallNodes for each Ball in the system.
 *   - Displaying the Center of Mass.
 *   - PathsNode for all 'paths'.
 *
 * BallSystemNode takes advantage of the prepopulatedBalls in the BallSystem, which all Balls in the system must be
 * apart of. Instead of creating a BallNode each time a Ball is added to the system, it creates a BallNode for each
 * prepopulatedBall and adjusts its visibility based on whether or not it is in the system. There is no performance loss
 * since Balls not in the BallSystem are not stepped or updated. Thus, BallNodes and BallSystemNodes are never disposed.
 *
 * NOTE: Do not translate this node. It's origin must be at the origin of the view coordinate frame.
 *
 * @author Brandon Li
 */

import { Shape } from '../../../../kite/js/imports.js';
import merge from '../../../../phet-core/js/merge.js';
import AssertUtils from '../../../../phetcommon/js/AssertUtils.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import { Node } from '../../../../scenery/js/imports.js';
import collisionLab from '../../collisionLab.js';
import BallSystem from '../model/BallSystem.js';
import PlayArea from '../model/PlayArea.js';
import BallNode from './BallNode.js';
import CenterOfMassNode from './CenterOfMassNode.js';
import PathsNode from './PathsNode.js';
class BallSystemNode extends Node {
  /**
   * @param {BallSystem} ballSystem
   * @param {PlayArea} playArea
   * @param {Property.<boolean>} valuesVisibleProperty
   * @param {Property.<boolean>} velocityVectorVisibleProperty
   * @param {Property.<boolean>} momentumVectorVisibleProperty
   * @param {Property.<boolean>} isPlayingProperty
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Object} [options]
   */
  constructor(ballSystem, playArea, valuesVisibleProperty, velocityVectorVisibleProperty, momentumVectorVisibleProperty, isPlayingProperty, modelViewTransform, options) {
    assert && assert(ballSystem instanceof BallSystem, `invalid ballSystem: ${ballSystem}`);
    assert && assert(playArea instanceof PlayArea, `invalid playArea: ${playArea}`);
    assert && AssertUtils.assertPropertyOf(valuesVisibleProperty, 'boolean');
    assert && AssertUtils.assertPropertyOf(velocityVectorVisibleProperty, 'boolean');
    assert && AssertUtils.assertPropertyOf(momentumVectorVisibleProperty, 'boolean');
    assert && AssertUtils.assertPropertyOf(isPlayingProperty, 'boolean');
    assert && assert(modelViewTransform instanceof ModelViewTransform2, `invalid modelViewTransform: ${modelViewTransform}`);
    options = merge({
      preventFit: true
    }, options);
    super(options);

    //----------------------------------------------------------------------------------------

    // Create the container for all Ball Nodes.
    const ballNodeContainer = new Node();

    // @private {Array.<Node>} - Ordered ball nodes, so we can reset ordering.
    this.ballNodes = [];

    // Loop through each possible Ball. These Balls are NOT necessarily the Balls currently within the BallSystem,
    // so we are responsible for updating its visibility based on whether or not it is the system.
    ballSystem.prepopulatedBalls.forEach(ball => {
      // Create the corresponding BallNode for each prepopulatedBall.
      const ballNode = new BallNode(ball, ballSystem, valuesVisibleProperty, velocityVectorVisibleProperty, momentumVectorVisibleProperty, playArea.elasticityPercentProperty, isPlayingProperty, modelViewTransform);

      // Add the BallNode to the container.
      ballNodeContainer.addChild(ballNode);
      this.ballNodes.push(ballNode);

      // Observe when Balls are added or removed from the BallSystem, meaning its visibility could change if it is
      // added or removed from the system. It should only be visible if the ball is in the BallSystem.
      ballSystem.balls.lengthProperty.link(() => {
        ballNode.visible = ballSystem.balls.includes(ball);
      });

      // Observe when the user controls the Ball and move the BallNode to the front of its layer. Link is never
      // unlinked since Balls are never disposed.
      ball.userControlledProperty.link(userControlled => {
        userControlled && ballNode.moveToFront();
      });
    });

    //----------------------------------------------------------------------------------------

    // Create the corresponding view for the Center of Mass.
    const centerOfMassNode = new CenterOfMassNode(ballSystem.centerOfMass, ballSystem.centerOfMassVisibleProperty, valuesVisibleProperty, playArea.bounds, modelViewTransform);

    // Create the PathsNode for the trailing 'Path' behind the Balls and the center of mass.
    const pathsNode = new PathsNode(ballSystem.prepopulatedBalls, ballSystem.centerOfMass.path, playArea.bounds, modelViewTransform, {
      clipArea: Shape.bounds(modelViewTransform.modelToViewBounds(playArea.bounds))
    });

    //----------------------------------------------------------------------------------------

    // Set the children of this Node to the correct rendering order.
    this.children = [pathsNode, ballNodeContainer, centerOfMassNode];
  }

  /**
   * Resets values to their original state
   * @public
   */
  reset() {
    this.ballNodes.forEach(node => node.moveToFront());
  }
}
collisionLab.register('BallSystemNode', BallSystemNode);
export default BallSystemNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaGFwZSIsIm1lcmdlIiwiQXNzZXJ0VXRpbHMiLCJNb2RlbFZpZXdUcmFuc2Zvcm0yIiwiTm9kZSIsImNvbGxpc2lvbkxhYiIsIkJhbGxTeXN0ZW0iLCJQbGF5QXJlYSIsIkJhbGxOb2RlIiwiQ2VudGVyT2ZNYXNzTm9kZSIsIlBhdGhzTm9kZSIsIkJhbGxTeXN0ZW1Ob2RlIiwiY29uc3RydWN0b3IiLCJiYWxsU3lzdGVtIiwicGxheUFyZWEiLCJ2YWx1ZXNWaXNpYmxlUHJvcGVydHkiLCJ2ZWxvY2l0eVZlY3RvclZpc2libGVQcm9wZXJ0eSIsIm1vbWVudHVtVmVjdG9yVmlzaWJsZVByb3BlcnR5IiwiaXNQbGF5aW5nUHJvcGVydHkiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJvcHRpb25zIiwiYXNzZXJ0IiwiYXNzZXJ0UHJvcGVydHlPZiIsInByZXZlbnRGaXQiLCJiYWxsTm9kZUNvbnRhaW5lciIsImJhbGxOb2RlcyIsInByZXBvcHVsYXRlZEJhbGxzIiwiZm9yRWFjaCIsImJhbGwiLCJiYWxsTm9kZSIsImVsYXN0aWNpdHlQZXJjZW50UHJvcGVydHkiLCJhZGRDaGlsZCIsInB1c2giLCJiYWxscyIsImxlbmd0aFByb3BlcnR5IiwibGluayIsInZpc2libGUiLCJpbmNsdWRlcyIsInVzZXJDb250cm9sbGVkUHJvcGVydHkiLCJ1c2VyQ29udHJvbGxlZCIsIm1vdmVUb0Zyb250IiwiY2VudGVyT2ZNYXNzTm9kZSIsImNlbnRlck9mTWFzcyIsImNlbnRlck9mTWFzc1Zpc2libGVQcm9wZXJ0eSIsImJvdW5kcyIsInBhdGhzTm9kZSIsInBhdGgiLCJjbGlwQXJlYSIsIm1vZGVsVG9WaWV3Qm91bmRzIiwiY2hpbGRyZW4iLCJyZXNldCIsIm5vZGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkJhbGxTeXN0ZW1Ob2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIwLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEJhbGxTeXN0ZW1Ob2RlIGlzIHRoZSBjb3JyZXNwb25kaW5nIHZpZXcgZm9yIEJhbGxTeXN0ZW1zIGZvciBkaXNwbGF5aW5nIGEgY29sbGVjdGlvbiBvZiBCYWxscy4gVGhleSBhcHBlYXIgaW5zaWRlIG9mXHJcbiAqIFBsYXlBcmVhTm9kZXMgaW4gYWxsIHNjcmVlbnMuXHJcbiAqXHJcbiAqIFRoZSBCYWxsU3lzdGVtTm9kZSBkaXNwbGF5czpcclxuICogICAtIEJhbGxOb2RlcyBmb3IgZWFjaCBCYWxsIGluIHRoZSBzeXN0ZW0uXHJcbiAqICAgLSBEaXNwbGF5aW5nIHRoZSBDZW50ZXIgb2YgTWFzcy5cclxuICogICAtIFBhdGhzTm9kZSBmb3IgYWxsICdwYXRocycuXHJcbiAqXHJcbiAqIEJhbGxTeXN0ZW1Ob2RlIHRha2VzIGFkdmFudGFnZSBvZiB0aGUgcHJlcG9wdWxhdGVkQmFsbHMgaW4gdGhlIEJhbGxTeXN0ZW0sIHdoaWNoIGFsbCBCYWxscyBpbiB0aGUgc3lzdGVtIG11c3QgYmVcclxuICogYXBhcnQgb2YuIEluc3RlYWQgb2YgY3JlYXRpbmcgYSBCYWxsTm9kZSBlYWNoIHRpbWUgYSBCYWxsIGlzIGFkZGVkIHRvIHRoZSBzeXN0ZW0sIGl0IGNyZWF0ZXMgYSBCYWxsTm9kZSBmb3IgZWFjaFxyXG4gKiBwcmVwb3B1bGF0ZWRCYWxsIGFuZCBhZGp1c3RzIGl0cyB2aXNpYmlsaXR5IGJhc2VkIG9uIHdoZXRoZXIgb3Igbm90IGl0IGlzIGluIHRoZSBzeXN0ZW0uIFRoZXJlIGlzIG5vIHBlcmZvcm1hbmNlIGxvc3NcclxuICogc2luY2UgQmFsbHMgbm90IGluIHRoZSBCYWxsU3lzdGVtIGFyZSBub3Qgc3RlcHBlZCBvciB1cGRhdGVkLiBUaHVzLCBCYWxsTm9kZXMgYW5kIEJhbGxTeXN0ZW1Ob2RlcyBhcmUgbmV2ZXIgZGlzcG9zZWQuXHJcbiAqXHJcbiAqIE5PVEU6IERvIG5vdCB0cmFuc2xhdGUgdGhpcyBub2RlLiBJdCdzIG9yaWdpbiBtdXN0IGJlIGF0IHRoZSBvcmlnaW4gb2YgdGhlIHZpZXcgY29vcmRpbmF0ZSBmcmFtZS5cclxuICpcclxuICogQGF1dGhvciBCcmFuZG9uIExpXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IEFzc2VydFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvQXNzZXJ0VXRpbHMuanMnO1xyXG5pbXBvcnQgTW9kZWxWaWV3VHJhbnNmb3JtMiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qcyc7XHJcbmltcG9ydCB7IE5vZGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgY29sbGlzaW9uTGFiIGZyb20gJy4uLy4uL2NvbGxpc2lvbkxhYi5qcyc7XHJcbmltcG9ydCBCYWxsU3lzdGVtIGZyb20gJy4uL21vZGVsL0JhbGxTeXN0ZW0uanMnO1xyXG5pbXBvcnQgUGxheUFyZWEgZnJvbSAnLi4vbW9kZWwvUGxheUFyZWEuanMnO1xyXG5pbXBvcnQgQmFsbE5vZGUgZnJvbSAnLi9CYWxsTm9kZS5qcyc7XHJcbmltcG9ydCBDZW50ZXJPZk1hc3NOb2RlIGZyb20gJy4vQ2VudGVyT2ZNYXNzTm9kZS5qcyc7XHJcbmltcG9ydCBQYXRoc05vZGUgZnJvbSAnLi9QYXRoc05vZGUuanMnO1xyXG5cclxuY2xhc3MgQmFsbFN5c3RlbU5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtCYWxsU3lzdGVtfSBiYWxsU3lzdGVtXHJcbiAgICogQHBhcmFtIHtQbGF5QXJlYX0gcGxheUFyZWFcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5Ljxib29sZWFuPn0gdmFsdWVzVmlzaWJsZVByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IHZlbG9jaXR5VmVjdG9yVmlzaWJsZVByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IG1vbWVudHVtVmVjdG9yVmlzaWJsZVByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IGlzUGxheWluZ1Byb3BlcnR5XHJcbiAgICogQHBhcmFtIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfSBtb2RlbFZpZXdUcmFuc2Zvcm1cclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGJhbGxTeXN0ZW0sXHJcbiAgICAgICAgICAgICAgIHBsYXlBcmVhLFxyXG4gICAgICAgICAgICAgICB2YWx1ZXNWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgICAgICAgICAgIHZlbG9jaXR5VmVjdG9yVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICAgICAgICAgICBtb21lbnR1bVZlY3RvclZpc2libGVQcm9wZXJ0eSxcclxuICAgICAgICAgICAgICAgaXNQbGF5aW5nUHJvcGVydHksXHJcbiAgICAgICAgICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgICAgICAgICAgb3B0aW9ucyApIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGJhbGxTeXN0ZW0gaW5zdGFuY2VvZiBCYWxsU3lzdGVtLCBgaW52YWxpZCBiYWxsU3lzdGVtOiAke2JhbGxTeXN0ZW19YCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggcGxheUFyZWEgaW5zdGFuY2VvZiBQbGF5QXJlYSwgYGludmFsaWQgcGxheUFyZWE6ICR7cGxheUFyZWF9YCApO1xyXG4gICAgYXNzZXJ0ICYmIEFzc2VydFV0aWxzLmFzc2VydFByb3BlcnR5T2YoIHZhbHVlc1Zpc2libGVQcm9wZXJ0eSwgJ2Jvb2xlYW4nICk7XHJcbiAgICBhc3NlcnQgJiYgQXNzZXJ0VXRpbHMuYXNzZXJ0UHJvcGVydHlPZiggdmVsb2NpdHlWZWN0b3JWaXNpYmxlUHJvcGVydHksICdib29sZWFuJyApO1xyXG4gICAgYXNzZXJ0ICYmIEFzc2VydFV0aWxzLmFzc2VydFByb3BlcnR5T2YoIG1vbWVudHVtVmVjdG9yVmlzaWJsZVByb3BlcnR5LCAnYm9vbGVhbicgKTtcclxuICAgIGFzc2VydCAmJiBBc3NlcnRVdGlscy5hc3NlcnRQcm9wZXJ0eU9mKCBpc1BsYXlpbmdQcm9wZXJ0eSwgJ2Jvb2xlYW4nICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBtb2RlbFZpZXdUcmFuc2Zvcm0gaW5zdGFuY2VvZiBNb2RlbFZpZXdUcmFuc2Zvcm0yLCBgaW52YWxpZCBtb2RlbFZpZXdUcmFuc2Zvcm06ICR7bW9kZWxWaWV3VHJhbnNmb3JtfWAgKTtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuICAgICAgcHJldmVudEZpdDogdHJ1ZVxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBjb250YWluZXIgZm9yIGFsbCBCYWxsIE5vZGVzLlxyXG4gICAgY29uc3QgYmFsbE5vZGVDb250YWluZXIgPSBuZXcgTm9kZSgpO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtBcnJheS48Tm9kZT59IC0gT3JkZXJlZCBiYWxsIG5vZGVzLCBzbyB3ZSBjYW4gcmVzZXQgb3JkZXJpbmcuXHJcbiAgICB0aGlzLmJhbGxOb2RlcyA9IFtdO1xyXG5cclxuICAgIC8vIExvb3AgdGhyb3VnaCBlYWNoIHBvc3NpYmxlIEJhbGwuIFRoZXNlIEJhbGxzIGFyZSBOT1QgbmVjZXNzYXJpbHkgdGhlIEJhbGxzIGN1cnJlbnRseSB3aXRoaW4gdGhlIEJhbGxTeXN0ZW0sXHJcbiAgICAvLyBzbyB3ZSBhcmUgcmVzcG9uc2libGUgZm9yIHVwZGF0aW5nIGl0cyB2aXNpYmlsaXR5IGJhc2VkIG9uIHdoZXRoZXIgb3Igbm90IGl0IGlzIHRoZSBzeXN0ZW0uXHJcbiAgICBiYWxsU3lzdGVtLnByZXBvcHVsYXRlZEJhbGxzLmZvckVhY2goIGJhbGwgPT4ge1xyXG5cclxuICAgICAgLy8gQ3JlYXRlIHRoZSBjb3JyZXNwb25kaW5nIEJhbGxOb2RlIGZvciBlYWNoIHByZXBvcHVsYXRlZEJhbGwuXHJcbiAgICAgIGNvbnN0IGJhbGxOb2RlID0gbmV3IEJhbGxOb2RlKCBiYWxsLFxyXG4gICAgICAgIGJhbGxTeXN0ZW0sXHJcbiAgICAgICAgdmFsdWVzVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICAgIHZlbG9jaXR5VmVjdG9yVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICAgIG1vbWVudHVtVmVjdG9yVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICAgIHBsYXlBcmVhLmVsYXN0aWNpdHlQZXJjZW50UHJvcGVydHksXHJcbiAgICAgICAgaXNQbGF5aW5nUHJvcGVydHksXHJcbiAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtICk7XHJcblxyXG4gICAgICAvLyBBZGQgdGhlIEJhbGxOb2RlIHRvIHRoZSBjb250YWluZXIuXHJcbiAgICAgIGJhbGxOb2RlQ29udGFpbmVyLmFkZENoaWxkKCBiYWxsTm9kZSApO1xyXG4gICAgICB0aGlzLmJhbGxOb2Rlcy5wdXNoKCBiYWxsTm9kZSApO1xyXG5cclxuICAgICAgLy8gT2JzZXJ2ZSB3aGVuIEJhbGxzIGFyZSBhZGRlZCBvciByZW1vdmVkIGZyb20gdGhlIEJhbGxTeXN0ZW0sIG1lYW5pbmcgaXRzIHZpc2liaWxpdHkgY291bGQgY2hhbmdlIGlmIGl0IGlzXHJcbiAgICAgIC8vIGFkZGVkIG9yIHJlbW92ZWQgZnJvbSB0aGUgc3lzdGVtLiBJdCBzaG91bGQgb25seSBiZSB2aXNpYmxlIGlmIHRoZSBiYWxsIGlzIGluIHRoZSBCYWxsU3lzdGVtLlxyXG4gICAgICBiYWxsU3lzdGVtLmJhbGxzLmxlbmd0aFByb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgICAgICBiYWxsTm9kZS52aXNpYmxlID0gYmFsbFN5c3RlbS5iYWxscy5pbmNsdWRlcyggYmFsbCApO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBPYnNlcnZlIHdoZW4gdGhlIHVzZXIgY29udHJvbHMgdGhlIEJhbGwgYW5kIG1vdmUgdGhlIEJhbGxOb2RlIHRvIHRoZSBmcm9udCBvZiBpdHMgbGF5ZXIuIExpbmsgaXMgbmV2ZXJcclxuICAgICAgLy8gdW5saW5rZWQgc2luY2UgQmFsbHMgYXJlIG5ldmVyIGRpc3Bvc2VkLlxyXG4gICAgICBiYWxsLnVzZXJDb250cm9sbGVkUHJvcGVydHkubGluayggdXNlckNvbnRyb2xsZWQgPT4geyB1c2VyQ29udHJvbGxlZCAmJiBiYWxsTm9kZS5tb3ZlVG9Gcm9udCgpOyB9ICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBjb3JyZXNwb25kaW5nIHZpZXcgZm9yIHRoZSBDZW50ZXIgb2YgTWFzcy5cclxuICAgIGNvbnN0IGNlbnRlck9mTWFzc05vZGUgPSBuZXcgQ2VudGVyT2ZNYXNzTm9kZShcclxuICAgICAgYmFsbFN5c3RlbS5jZW50ZXJPZk1hc3MsXHJcbiAgICAgIGJhbGxTeXN0ZW0uY2VudGVyT2ZNYXNzVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICB2YWx1ZXNWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgIHBsYXlBcmVhLmJvdW5kcyxcclxuICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtXHJcbiAgICApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgUGF0aHNOb2RlIGZvciB0aGUgdHJhaWxpbmcgJ1BhdGgnIGJlaGluZCB0aGUgQmFsbHMgYW5kIHRoZSBjZW50ZXIgb2YgbWFzcy5cclxuICAgIGNvbnN0IHBhdGhzTm9kZSA9IG5ldyBQYXRoc05vZGUoXHJcbiAgICAgIGJhbGxTeXN0ZW0ucHJlcG9wdWxhdGVkQmFsbHMsXHJcbiAgICAgIGJhbGxTeXN0ZW0uY2VudGVyT2ZNYXNzLnBhdGgsXHJcbiAgICAgIHBsYXlBcmVhLmJvdW5kcyxcclxuICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLCB7XHJcbiAgICAgICAgY2xpcEFyZWE6IFNoYXBlLmJvdW5kcyggbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3Qm91bmRzKCBwbGF5QXJlYS5ib3VuZHMgKSApXHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgLy8gU2V0IHRoZSBjaGlsZHJlbiBvZiB0aGlzIE5vZGUgdG8gdGhlIGNvcnJlY3QgcmVuZGVyaW5nIG9yZGVyLlxyXG4gICAgdGhpcy5jaGlsZHJlbiA9IFtcclxuICAgICAgcGF0aHNOb2RlLFxyXG4gICAgICBiYWxsTm9kZUNvbnRhaW5lcixcclxuICAgICAgY2VudGVyT2ZNYXNzTm9kZVxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc2V0cyB2YWx1ZXMgdG8gdGhlaXIgb3JpZ2luYWwgc3RhdGVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLmJhbGxOb2Rlcy5mb3JFYWNoKCBub2RlID0+IG5vZGUubW92ZVRvRnJvbnQoKSApO1xyXG4gIH1cclxufVxyXG5cclxuY29sbGlzaW9uTGFiLnJlZ2lzdGVyKCAnQmFsbFN5c3RlbU5vZGUnLCBCYWxsU3lzdGVtTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBCYWxsU3lzdGVtTm9kZTsiXSwibWFwcGluZ3MiOiJB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