// Copyright 2017-2022, University of Colorado Boulder

/**
 * Supertype screenview for proportional screens.
 *
 * NOTE: This type is designed to be persistent, and will not need to release references to avoid memory leaks.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import DynamicProperty from '../../../../axon/js/DynamicProperty.js';
import { Shape } from '../../../../kite/js/imports.js';
import merge from '../../../../phet-core/js/merge.js';
import { AlignGroup, HBox, Path, Rectangle, Text, VBox } from '../../../../scenery/js/imports.js';
import Checkbox from '../../../../sun/js/Checkbox.js';
import areaModelCommon from '../../areaModelCommon.js';
import AreaModelCommonStrings from '../../AreaModelCommonStrings.js';
import AreaModelCommonConstants from '../../common/AreaModelCommonConstants.js';
import AreaModelCommonGlobals from '../../common/AreaModelCommonGlobals.js';
import AreaModelCommonColors from '../../common/view/AreaModelCommonColors.js';
import AreaScreenView from '../../common/view/AreaScreenView.js';
import PartitionLineChoice from '../model/PartitionLineChoice.js';
import ProportionalAreaModel from '../model/ProportionalAreaModel.js';
import PartitionRadioButtonGroup from './PartitionRadioButtonGroup.js';
import ProportionalAreaDisplayNode from './ProportionalAreaDisplayNode.js';
import ProportionalFactorsNode from './ProportionalFactorsNode.js';
import SceneRadioButtonGroup from './SceneRadioButtonGroup.js';
const partitionString = AreaModelCommonStrings.partition;
const base10AreaTilesString = AreaModelCommonStrings.a11y.base10AreaTiles;
const countingNumbersDescriptionString = AreaModelCommonStrings.a11y.countingNumbersDescription;
const countingNumbersLabelString = AreaModelCommonStrings.a11y.countingNumbersLabel;
const gridLinesLabelString = AreaModelCommonStrings.a11y.gridLinesLabel;

// constants
const RADIO_ICON_SIZE = 30;
class ProportionalAreaScreenView extends AreaScreenView {
  /**
   * @extends {AreaScreenView}
   *
   * @param {ProportionalAreaModel} model
   * @param {Object} [options]
   */
  constructor(model, options) {
    assert && assert(model instanceof ProportionalAreaModel);
    let sceneSelectionNode;
    let partitionSelectionPanel;
    const currentAreaOrientationProperty = new DynamicProperty(model.currentAreaProperty, {
      derive: 'visiblePartitionOrientationProperty',
      bidirectional: true
    });

    // Should have its own align group, so we don't modify other sizes
    const partitionSelectionAlignGroup = new AlignGroup();
    options = merge({
      decimalPlaces: 0,
      isProportional: true,
      getRightAlignNodes: nodes => {
        sceneSelectionNode = new SceneRadioButtonGroup(model);
        return [...nodes, sceneSelectionNode];
      },
      getSelectionNodesExtras: screenView => {
        partitionSelectionPanel = screenView.createPanelContent(partitionString, AreaModelCommonGlobals.panelAlignGroup, new PartitionRadioButtonGroup(currentAreaOrientationProperty, partitionSelectionAlignGroup));
        return partitionSelectionPanel;
      }
    }, options);
    super(model, options);

    // @private {Node} - Scene selection, created before super call since it will be added in it.
    this.sceneSelectionNode = sceneSelectionNode;

    // @private {Node} - Allows controlling which partition is currently visible (if we only show one)
    this.partitionSelectionPanel = partitionSelectionPanel;

    // Checkboxes
    const gridCheckbox = new Checkbox(model.gridLinesVisibleProperty, this.createGridIconNode(), {
      // pdom
      labelTagName: 'label',
      labelContent: gridLinesLabelString
    });
    const tileCheckbox = new Checkbox(model.tilesVisibleProperty, this.createTileIconNode(), {
      // pdom
      labelTagName: 'label',
      labelContent: base10AreaTilesString
    });
    const countingCheckbox = new Checkbox(model.countingVisibleProperty, this.createCountingIconNode(), {
      // pdom
      labelTagName: 'label',
      labelContent: countingNumbersLabelString,
      descriptionContent: countingNumbersDescriptionString
    });
    const checkboxContainer = new VBox({
      children: [gridCheckbox, countingCheckbox, tileCheckbox],
      align: 'left',
      spacing: 20,
      // Manual positioning works best here
      top: 50,
      left: 600
    });
    this.addChild(checkboxContainer);
    model.currentAreaProperty.link(area => {
      checkboxContainer.removeAllChildren();

      // Don't show the grid/tiles checkboxes if counting is enabled
      if (!area.countingAvailable) {
        checkboxContainer.addChild(gridCheckbox);
        if (area.tilesAvailable) {
          checkboxContainer.addChild(tileCheckbox);
        }
      } else {
        checkboxContainer.addChild(countingCheckbox);
      }
    });

    // "Play Area" (a11y)
    this.pdomPlayAreaNode.pdomOrder = [this.areaDisplayNode, this.factorsBox, this.areaBox, this.productsSelectionPanel, this.calculationSelectionPanel, this.partitionSelectionPanel, this.calculationNode].filter(node => node !== undefined); // this.partitionSelectionPanel may not exist

    // "Control Panel" (a11y)
    this.pdomControlAreaNode.pdomOrder = [gridCheckbox, tileCheckbox, countingCheckbox, this.sceneSelectionNode, this.resetAllButton];
  }

  /**
   * @protected
   * @override
   *
   * @param {*} partitionSelectionPanel
   * @returns {Property.<Array.<Node>>}
   */
  getSelectionNodesProperty(partitionSelectionPanel) {
    // Use a Property here so we don't recreate when we don't have to (just on area changes)
    const hasPartitionSelectionProperty = new DerivedProperty([this.model.currentAreaProperty], area => area.partitionLineChoice === PartitionLineChoice.ONE);

    // Conditionally include our partition selection on top of what else is included
    return new DerivedProperty([super.getSelectionNodesProperty(), hasPartitionSelectionProperty], (selectionNodes, hasPartitionSelection) => hasPartitionSelection ? selectionNodes.concat([partitionSelectionPanel]) : selectionNodes);
  }

  /**
   * Creates the main area display view for the screen.
   * @public
   * @override
   *
   * @param {ProportionalAreaModel} model
   * @returns {ProportionalAreaDisplayNode}
   */
  createAreaDisplayNode(model) {
    return new ProportionalAreaDisplayNode(model.areaDisplay, model.partialProductsChoiceProperty, {
      gridLinesVisibleProperty: model.gridLinesVisibleProperty,
      tilesVisibleProperty: model.tilesVisibleProperty,
      countingVisibleProperty: model.countingVisibleProperty,
      useTileLikeBackground: this.useTileLikeBackground,
      useLargeArea: this.useLargeArea
    }, {
      translation: this.getDisplayTranslation()
    });
  }

  /**
   * Creates the "factors" (dimensions) content for the accordion box.
   * @public
   * @override
   *
   * @param {ProportionalAreaModel} model
   * @param {number} decimalPlaces
   * @returns {Node}
   */
  createFactorsNode(model, decimalPlaces) {
    return new ProportionalFactorsNode(model.currentAreaProperty, model.areaDisplay.activeTotalProperties, decimalPlaces);
  }

  /**
   * Creates a grid icon.
   * @private
   *
   * @returns {Node}
   */
  createGridIconNode() {
    const gridIconShape = new Shape().moveTo(RADIO_ICON_SIZE / 4, 0).lineTo(RADIO_ICON_SIZE / 4, RADIO_ICON_SIZE).moveTo(RADIO_ICON_SIZE / 2, 0).lineTo(RADIO_ICON_SIZE / 2, RADIO_ICON_SIZE).moveTo(RADIO_ICON_SIZE * 3 / 4, 0).lineTo(RADIO_ICON_SIZE * 3 / 4, RADIO_ICON_SIZE).moveTo(0, RADIO_ICON_SIZE / 4).lineTo(RADIO_ICON_SIZE, RADIO_ICON_SIZE / 4).moveTo(0, RADIO_ICON_SIZE / 2).lineTo(RADIO_ICON_SIZE, RADIO_ICON_SIZE / 2).moveTo(0, RADIO_ICON_SIZE * 3 / 4).lineTo(RADIO_ICON_SIZE, RADIO_ICON_SIZE * 3 / 4);
    return new Path(gridIconShape, {
      stroke: AreaModelCommonColors.gridIconProperty
    });
  }

  /**
   * Creates a tile icon.
   * @private
   *
   * @returns {Node}
   */
  createTileIconNode() {
    const tileIconOptions = {
      fill: AreaModelCommonColors.smallTileProperty,
      stroke: AreaModelCommonColors.tileIconStrokeProperty,
      lineWidth: 0.5
    };
    const SMALL_TILE_ICON_SIZE = RADIO_ICON_SIZE / 10;
    return new HBox({
      children: [new Rectangle(0, 0, RADIO_ICON_SIZE, RADIO_ICON_SIZE, tileIconOptions), new Rectangle(0, 0, SMALL_TILE_ICON_SIZE, RADIO_ICON_SIZE, tileIconOptions), new VBox({
        children: [new Rectangle(0, 0, SMALL_TILE_ICON_SIZE, SMALL_TILE_ICON_SIZE, tileIconOptions), new Rectangle(0, 0, SMALL_TILE_ICON_SIZE, SMALL_TILE_ICON_SIZE, tileIconOptions), new Rectangle(0, 0, SMALL_TILE_ICON_SIZE, SMALL_TILE_ICON_SIZE, tileIconOptions)],
        spacing: 0
      })],
      align: 'top',
      spacing: RADIO_ICON_SIZE / 8
    });
  }

  /**
   * Creates a counting icon.
   * @private
   *
   * @returns {Node}
   */
  createCountingIconNode() {
    // Hardcoded string, see https://github.com/phetsims/area-model-common/issues/104
    return new Text('123', {
      font: AreaModelCommonConstants.COUNTING_ICON_FONT
    });
  }
}
areaModelCommon.register('ProportionalAreaScreenView', ProportionalAreaScreenView);
export default ProportionalAreaScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJEeW5hbWljUHJvcGVydHkiLCJTaGFwZSIsIm1lcmdlIiwiQWxpZ25Hcm91cCIsIkhCb3giLCJQYXRoIiwiUmVjdGFuZ2xlIiwiVGV4dCIsIlZCb3giLCJDaGVja2JveCIsImFyZWFNb2RlbENvbW1vbiIsIkFyZWFNb2RlbENvbW1vblN0cmluZ3MiLCJBcmVhTW9kZWxDb21tb25Db25zdGFudHMiLCJBcmVhTW9kZWxDb21tb25HbG9iYWxzIiwiQXJlYU1vZGVsQ29tbW9uQ29sb3JzIiwiQXJlYVNjcmVlblZpZXciLCJQYXJ0aXRpb25MaW5lQ2hvaWNlIiwiUHJvcG9ydGlvbmFsQXJlYU1vZGVsIiwiUGFydGl0aW9uUmFkaW9CdXR0b25Hcm91cCIsIlByb3BvcnRpb25hbEFyZWFEaXNwbGF5Tm9kZSIsIlByb3BvcnRpb25hbEZhY3RvcnNOb2RlIiwiU2NlbmVSYWRpb0J1dHRvbkdyb3VwIiwicGFydGl0aW9uU3RyaW5nIiwicGFydGl0aW9uIiwiYmFzZTEwQXJlYVRpbGVzU3RyaW5nIiwiYTExeSIsImJhc2UxMEFyZWFUaWxlcyIsImNvdW50aW5nTnVtYmVyc0Rlc2NyaXB0aW9uU3RyaW5nIiwiY291bnRpbmdOdW1iZXJzRGVzY3JpcHRpb24iLCJjb3VudGluZ051bWJlcnNMYWJlbFN0cmluZyIsImNvdW50aW5nTnVtYmVyc0xhYmVsIiwiZ3JpZExpbmVzTGFiZWxTdHJpbmciLCJncmlkTGluZXNMYWJlbCIsIlJBRElPX0lDT05fU0laRSIsIlByb3BvcnRpb25hbEFyZWFTY3JlZW5WaWV3IiwiY29uc3RydWN0b3IiLCJtb2RlbCIsIm9wdGlvbnMiLCJhc3NlcnQiLCJzY2VuZVNlbGVjdGlvbk5vZGUiLCJwYXJ0aXRpb25TZWxlY3Rpb25QYW5lbCIsImN1cnJlbnRBcmVhT3JpZW50YXRpb25Qcm9wZXJ0eSIsImN1cnJlbnRBcmVhUHJvcGVydHkiLCJkZXJpdmUiLCJiaWRpcmVjdGlvbmFsIiwicGFydGl0aW9uU2VsZWN0aW9uQWxpZ25Hcm91cCIsImRlY2ltYWxQbGFjZXMiLCJpc1Byb3BvcnRpb25hbCIsImdldFJpZ2h0QWxpZ25Ob2RlcyIsIm5vZGVzIiwiZ2V0U2VsZWN0aW9uTm9kZXNFeHRyYXMiLCJzY3JlZW5WaWV3IiwiY3JlYXRlUGFuZWxDb250ZW50IiwicGFuZWxBbGlnbkdyb3VwIiwiZ3JpZENoZWNrYm94IiwiZ3JpZExpbmVzVmlzaWJsZVByb3BlcnR5IiwiY3JlYXRlR3JpZEljb25Ob2RlIiwibGFiZWxUYWdOYW1lIiwibGFiZWxDb250ZW50IiwidGlsZUNoZWNrYm94IiwidGlsZXNWaXNpYmxlUHJvcGVydHkiLCJjcmVhdGVUaWxlSWNvbk5vZGUiLCJjb3VudGluZ0NoZWNrYm94IiwiY291bnRpbmdWaXNpYmxlUHJvcGVydHkiLCJjcmVhdGVDb3VudGluZ0ljb25Ob2RlIiwiZGVzY3JpcHRpb25Db250ZW50IiwiY2hlY2tib3hDb250YWluZXIiLCJjaGlsZHJlbiIsImFsaWduIiwic3BhY2luZyIsInRvcCIsImxlZnQiLCJhZGRDaGlsZCIsImxpbmsiLCJhcmVhIiwicmVtb3ZlQWxsQ2hpbGRyZW4iLCJjb3VudGluZ0F2YWlsYWJsZSIsInRpbGVzQXZhaWxhYmxlIiwicGRvbVBsYXlBcmVhTm9kZSIsInBkb21PcmRlciIsImFyZWFEaXNwbGF5Tm9kZSIsImZhY3RvcnNCb3giLCJhcmVhQm94IiwicHJvZHVjdHNTZWxlY3Rpb25QYW5lbCIsImNhbGN1bGF0aW9uU2VsZWN0aW9uUGFuZWwiLCJjYWxjdWxhdGlvbk5vZGUiLCJmaWx0ZXIiLCJub2RlIiwidW5kZWZpbmVkIiwicGRvbUNvbnRyb2xBcmVhTm9kZSIsInJlc2V0QWxsQnV0dG9uIiwiZ2V0U2VsZWN0aW9uTm9kZXNQcm9wZXJ0eSIsImhhc1BhcnRpdGlvblNlbGVjdGlvblByb3BlcnR5IiwicGFydGl0aW9uTGluZUNob2ljZSIsIk9ORSIsInNlbGVjdGlvbk5vZGVzIiwiaGFzUGFydGl0aW9uU2VsZWN0aW9uIiwiY29uY2F0IiwiY3JlYXRlQXJlYURpc3BsYXlOb2RlIiwiYXJlYURpc3BsYXkiLCJwYXJ0aWFsUHJvZHVjdHNDaG9pY2VQcm9wZXJ0eSIsInVzZVRpbGVMaWtlQmFja2dyb3VuZCIsInVzZUxhcmdlQXJlYSIsInRyYW5zbGF0aW9uIiwiZ2V0RGlzcGxheVRyYW5zbGF0aW9uIiwiY3JlYXRlRmFjdG9yc05vZGUiLCJhY3RpdmVUb3RhbFByb3BlcnRpZXMiLCJncmlkSWNvblNoYXBlIiwibW92ZVRvIiwibGluZVRvIiwic3Ryb2tlIiwiZ3JpZEljb25Qcm9wZXJ0eSIsInRpbGVJY29uT3B0aW9ucyIsImZpbGwiLCJzbWFsbFRpbGVQcm9wZXJ0eSIsInRpbGVJY29uU3Ryb2tlUHJvcGVydHkiLCJsaW5lV2lkdGgiLCJTTUFMTF9USUxFX0lDT05fU0laRSIsImZvbnQiLCJDT1VOVElOR19JQ09OX0ZPTlQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlByb3BvcnRpb25hbEFyZWFTY3JlZW5WaWV3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFN1cGVydHlwZSBzY3JlZW52aWV3IGZvciBwcm9wb3J0aW9uYWwgc2NyZWVucy5cclxuICpcclxuICogTk9URTogVGhpcyB0eXBlIGlzIGRlc2lnbmVkIHRvIGJlIHBlcnNpc3RlbnQsIGFuZCB3aWxsIG5vdCBuZWVkIHRvIHJlbGVhc2UgcmVmZXJlbmNlcyB0byBhdm9pZCBtZW1vcnkgbGVha3MuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IER5bmFtaWNQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0R5bmFtaWNQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCB7IEFsaWduR3JvdXAsIEhCb3gsIFBhdGgsIFJlY3RhbmdsZSwgVGV4dCwgVkJveCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBDaGVja2JveCBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvQ2hlY2tib3guanMnO1xyXG5pbXBvcnQgYXJlYU1vZGVsQ29tbW9uIGZyb20gJy4uLy4uL2FyZWFNb2RlbENvbW1vbi5qcyc7XHJcbmltcG9ydCBBcmVhTW9kZWxDb21tb25TdHJpbmdzIGZyb20gJy4uLy4uL0FyZWFNb2RlbENvbW1vblN0cmluZ3MuanMnO1xyXG5pbXBvcnQgQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9BcmVhTW9kZWxDb21tb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgQXJlYU1vZGVsQ29tbW9uR2xvYmFscyBmcm9tICcuLi8uLi9jb21tb24vQXJlYU1vZGVsQ29tbW9uR2xvYmFscy5qcyc7XHJcbmltcG9ydCBBcmVhTW9kZWxDb21tb25Db2xvcnMgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvQXJlYU1vZGVsQ29tbW9uQ29sb3JzLmpzJztcclxuaW1wb3J0IEFyZWFTY3JlZW5WaWV3IGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0FyZWFTY3JlZW5WaWV3LmpzJztcclxuaW1wb3J0IFBhcnRpdGlvbkxpbmVDaG9pY2UgZnJvbSAnLi4vbW9kZWwvUGFydGl0aW9uTGluZUNob2ljZS5qcyc7XHJcbmltcG9ydCBQcm9wb3J0aW9uYWxBcmVhTW9kZWwgZnJvbSAnLi4vbW9kZWwvUHJvcG9ydGlvbmFsQXJlYU1vZGVsLmpzJztcclxuaW1wb3J0IFBhcnRpdGlvblJhZGlvQnV0dG9uR3JvdXAgZnJvbSAnLi9QYXJ0aXRpb25SYWRpb0J1dHRvbkdyb3VwLmpzJztcclxuaW1wb3J0IFByb3BvcnRpb25hbEFyZWFEaXNwbGF5Tm9kZSBmcm9tICcuL1Byb3BvcnRpb25hbEFyZWFEaXNwbGF5Tm9kZS5qcyc7XHJcbmltcG9ydCBQcm9wb3J0aW9uYWxGYWN0b3JzTm9kZSBmcm9tICcuL1Byb3BvcnRpb25hbEZhY3RvcnNOb2RlLmpzJztcclxuaW1wb3J0IFNjZW5lUmFkaW9CdXR0b25Hcm91cCBmcm9tICcuL1NjZW5lUmFkaW9CdXR0b25Hcm91cC5qcyc7XHJcblxyXG5jb25zdCBwYXJ0aXRpb25TdHJpbmcgPSBBcmVhTW9kZWxDb21tb25TdHJpbmdzLnBhcnRpdGlvbjtcclxuY29uc3QgYmFzZTEwQXJlYVRpbGVzU3RyaW5nID0gQXJlYU1vZGVsQ29tbW9uU3RyaW5ncy5hMTF5LmJhc2UxMEFyZWFUaWxlcztcclxuY29uc3QgY291bnRpbmdOdW1iZXJzRGVzY3JpcHRpb25TdHJpbmcgPSBBcmVhTW9kZWxDb21tb25TdHJpbmdzLmExMXkuY291bnRpbmdOdW1iZXJzRGVzY3JpcHRpb247XHJcbmNvbnN0IGNvdW50aW5nTnVtYmVyc0xhYmVsU3RyaW5nID0gQXJlYU1vZGVsQ29tbW9uU3RyaW5ncy5hMTF5LmNvdW50aW5nTnVtYmVyc0xhYmVsO1xyXG5jb25zdCBncmlkTGluZXNMYWJlbFN0cmluZyA9IEFyZWFNb2RlbENvbW1vblN0cmluZ3MuYTExeS5ncmlkTGluZXNMYWJlbDtcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBSQURJT19JQ09OX1NJWkUgPSAzMDtcclxuXHJcbmNsYXNzIFByb3BvcnRpb25hbEFyZWFTY3JlZW5WaWV3IGV4dGVuZHMgQXJlYVNjcmVlblZpZXcge1xyXG4gIC8qKlxyXG4gICAqIEBleHRlbmRzIHtBcmVhU2NyZWVuVmlld31cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7UHJvcG9ydGlvbmFsQXJlYU1vZGVsfSBtb2RlbFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbW9kZWwsIG9wdGlvbnMgKSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBtb2RlbCBpbnN0YW5jZW9mIFByb3BvcnRpb25hbEFyZWFNb2RlbCApO1xyXG5cclxuICAgIGxldCBzY2VuZVNlbGVjdGlvbk5vZGU7XHJcbiAgICBsZXQgcGFydGl0aW9uU2VsZWN0aW9uUGFuZWw7XHJcblxyXG4gICAgY29uc3QgY3VycmVudEFyZWFPcmllbnRhdGlvblByb3BlcnR5ID0gbmV3IER5bmFtaWNQcm9wZXJ0eSggbW9kZWwuY3VycmVudEFyZWFQcm9wZXJ0eSwge1xyXG4gICAgICBkZXJpdmU6ICd2aXNpYmxlUGFydGl0aW9uT3JpZW50YXRpb25Qcm9wZXJ0eScsXHJcbiAgICAgIGJpZGlyZWN0aW9uYWw6IHRydWVcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBTaG91bGQgaGF2ZSBpdHMgb3duIGFsaWduIGdyb3VwLCBzbyB3ZSBkb24ndCBtb2RpZnkgb3RoZXIgc2l6ZXNcclxuICAgIGNvbnN0IHBhcnRpdGlvblNlbGVjdGlvbkFsaWduR3JvdXAgPSBuZXcgQWxpZ25Hcm91cCgpO1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG4gICAgICBkZWNpbWFsUGxhY2VzOiAwLFxyXG4gICAgICBpc1Byb3BvcnRpb25hbDogdHJ1ZSxcclxuICAgICAgZ2V0UmlnaHRBbGlnbk5vZGVzOiBub2RlcyA9PiB7XHJcbiAgICAgICAgc2NlbmVTZWxlY3Rpb25Ob2RlID0gbmV3IFNjZW5lUmFkaW9CdXR0b25Hcm91cCggbW9kZWwgKTtcclxuICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgLi4ubm9kZXMsXHJcbiAgICAgICAgICBzY2VuZVNlbGVjdGlvbk5vZGVcclxuICAgICAgICBdO1xyXG4gICAgICB9LFxyXG4gICAgICBnZXRTZWxlY3Rpb25Ob2Rlc0V4dHJhczogc2NyZWVuVmlldyA9PiB7XHJcbiAgICAgICAgcGFydGl0aW9uU2VsZWN0aW9uUGFuZWwgPSBzY3JlZW5WaWV3LmNyZWF0ZVBhbmVsQ29udGVudChcclxuICAgICAgICAgIHBhcnRpdGlvblN0cmluZyxcclxuICAgICAgICAgIEFyZWFNb2RlbENvbW1vbkdsb2JhbHMucGFuZWxBbGlnbkdyb3VwLFxyXG4gICAgICAgICAgbmV3IFBhcnRpdGlvblJhZGlvQnV0dG9uR3JvdXAoIGN1cnJlbnRBcmVhT3JpZW50YXRpb25Qcm9wZXJ0eSwgcGFydGl0aW9uU2VsZWN0aW9uQWxpZ25Hcm91cCApXHJcbiAgICAgICAgKTtcclxuICAgICAgICByZXR1cm4gcGFydGl0aW9uU2VsZWN0aW9uUGFuZWw7XHJcbiAgICAgIH1cclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggbW9kZWwsIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7Tm9kZX0gLSBTY2VuZSBzZWxlY3Rpb24sIGNyZWF0ZWQgYmVmb3JlIHN1cGVyIGNhbGwgc2luY2UgaXQgd2lsbCBiZSBhZGRlZCBpbiBpdC5cclxuICAgIHRoaXMuc2NlbmVTZWxlY3Rpb25Ob2RlID0gc2NlbmVTZWxlY3Rpb25Ob2RlO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtOb2RlfSAtIEFsbG93cyBjb250cm9sbGluZyB3aGljaCBwYXJ0aXRpb24gaXMgY3VycmVudGx5IHZpc2libGUgKGlmIHdlIG9ubHkgc2hvdyBvbmUpXHJcbiAgICB0aGlzLnBhcnRpdGlvblNlbGVjdGlvblBhbmVsID0gcGFydGl0aW9uU2VsZWN0aW9uUGFuZWw7XHJcblxyXG4gICAgLy8gQ2hlY2tib3hlc1xyXG4gICAgY29uc3QgZ3JpZENoZWNrYm94ID0gbmV3IENoZWNrYm94KCBtb2RlbC5ncmlkTGluZXNWaXNpYmxlUHJvcGVydHksIHRoaXMuY3JlYXRlR3JpZEljb25Ob2RlKCksIHtcclxuICAgICAgLy8gcGRvbVxyXG4gICAgICBsYWJlbFRhZ05hbWU6ICdsYWJlbCcsXHJcbiAgICAgIGxhYmVsQ29udGVudDogZ3JpZExpbmVzTGFiZWxTdHJpbmdcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IHRpbGVDaGVja2JveCA9IG5ldyBDaGVja2JveCggbW9kZWwudGlsZXNWaXNpYmxlUHJvcGVydHksIHRoaXMuY3JlYXRlVGlsZUljb25Ob2RlKCksIHtcclxuICAgICAgLy8gcGRvbVxyXG4gICAgICBsYWJlbFRhZ05hbWU6ICdsYWJlbCcsXHJcbiAgICAgIGxhYmVsQ29udGVudDogYmFzZTEwQXJlYVRpbGVzU3RyaW5nXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBjb3VudGluZ0NoZWNrYm94ID0gbmV3IENoZWNrYm94KCBtb2RlbC5jb3VudGluZ1Zpc2libGVQcm9wZXJ0eSwgdGhpcy5jcmVhdGVDb3VudGluZ0ljb25Ob2RlKCksIHtcclxuICAgICAgLy8gcGRvbVxyXG4gICAgICBsYWJlbFRhZ05hbWU6ICdsYWJlbCcsXHJcbiAgICAgIGxhYmVsQ29udGVudDogY291bnRpbmdOdW1iZXJzTGFiZWxTdHJpbmcsXHJcbiAgICAgIGRlc2NyaXB0aW9uQ29udGVudDogY291bnRpbmdOdW1iZXJzRGVzY3JpcHRpb25TdHJpbmdcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBjaGVja2JveENvbnRhaW5lciA9IG5ldyBWQm94KCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbIGdyaWRDaGVja2JveCwgY291bnRpbmdDaGVja2JveCwgdGlsZUNoZWNrYm94IF0sXHJcbiAgICAgIGFsaWduOiAnbGVmdCcsXHJcbiAgICAgIHNwYWNpbmc6IDIwLFxyXG4gICAgICAvLyBNYW51YWwgcG9zaXRpb25pbmcgd29ya3MgYmVzdCBoZXJlXHJcbiAgICAgIHRvcDogNTAsXHJcbiAgICAgIGxlZnQ6IDYwMFxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggY2hlY2tib3hDb250YWluZXIgKTtcclxuXHJcbiAgICBtb2RlbC5jdXJyZW50QXJlYVByb3BlcnR5LmxpbmsoIGFyZWEgPT4ge1xyXG4gICAgICBjaGVja2JveENvbnRhaW5lci5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG5cclxuICAgICAgLy8gRG9uJ3Qgc2hvdyB0aGUgZ3JpZC90aWxlcyBjaGVja2JveGVzIGlmIGNvdW50aW5nIGlzIGVuYWJsZWRcclxuICAgICAgaWYgKCAhYXJlYS5jb3VudGluZ0F2YWlsYWJsZSApIHtcclxuICAgICAgICBjaGVja2JveENvbnRhaW5lci5hZGRDaGlsZCggZ3JpZENoZWNrYm94ICk7XHJcbiAgICAgICAgaWYgKCBhcmVhLnRpbGVzQXZhaWxhYmxlICkge1xyXG4gICAgICAgICAgY2hlY2tib3hDb250YWluZXIuYWRkQ2hpbGQoIHRpbGVDaGVja2JveCApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBjaGVja2JveENvbnRhaW5lci5hZGRDaGlsZCggY291bnRpbmdDaGVja2JveCApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gXCJQbGF5IEFyZWFcIiAoYTExeSlcclxuICAgIHRoaXMucGRvbVBsYXlBcmVhTm9kZS5wZG9tT3JkZXIgPSBbXHJcbiAgICAgIHRoaXMuYXJlYURpc3BsYXlOb2RlLFxyXG4gICAgICB0aGlzLmZhY3RvcnNCb3gsXHJcbiAgICAgIHRoaXMuYXJlYUJveCxcclxuICAgICAgdGhpcy5wcm9kdWN0c1NlbGVjdGlvblBhbmVsLFxyXG4gICAgICB0aGlzLmNhbGN1bGF0aW9uU2VsZWN0aW9uUGFuZWwsXHJcbiAgICAgIHRoaXMucGFydGl0aW9uU2VsZWN0aW9uUGFuZWwsXHJcbiAgICAgIHRoaXMuY2FsY3VsYXRpb25Ob2RlXHJcbiAgICBdLmZpbHRlciggbm9kZSA9PiBub2RlICE9PSB1bmRlZmluZWQgKTsgLy8gdGhpcy5wYXJ0aXRpb25TZWxlY3Rpb25QYW5lbCBtYXkgbm90IGV4aXN0XHJcblxyXG4gICAgLy8gXCJDb250cm9sIFBhbmVsXCIgKGExMXkpXHJcbiAgICB0aGlzLnBkb21Db250cm9sQXJlYU5vZGUucGRvbU9yZGVyID0gW1xyXG4gICAgICBncmlkQ2hlY2tib3gsXHJcbiAgICAgIHRpbGVDaGVja2JveCxcclxuICAgICAgY291bnRpbmdDaGVja2JveCxcclxuICAgICAgdGhpcy5zY2VuZVNlbGVjdGlvbk5vZGUsXHJcbiAgICAgIHRoaXMucmVzZXRBbGxCdXR0b25cclxuICAgIF07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHJvdGVjdGVkXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICpcclxuICAgKiBAcGFyYW0geyp9IHBhcnRpdGlvblNlbGVjdGlvblBhbmVsXHJcbiAgICogQHJldHVybnMge1Byb3BlcnR5LjxBcnJheS48Tm9kZT4+fVxyXG4gICAqL1xyXG4gIGdldFNlbGVjdGlvbk5vZGVzUHJvcGVydHkoIHBhcnRpdGlvblNlbGVjdGlvblBhbmVsICkge1xyXG4gICAgLy8gVXNlIGEgUHJvcGVydHkgaGVyZSBzbyB3ZSBkb24ndCByZWNyZWF0ZSB3aGVuIHdlIGRvbid0IGhhdmUgdG8gKGp1c3Qgb24gYXJlYSBjaGFuZ2VzKVxyXG4gICAgY29uc3QgaGFzUGFydGl0aW9uU2VsZWN0aW9uUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIHRoaXMubW9kZWwuY3VycmVudEFyZWFQcm9wZXJ0eSBdLCBhcmVhID0+IGFyZWEucGFydGl0aW9uTGluZUNob2ljZSA9PT0gUGFydGl0aW9uTGluZUNob2ljZS5PTkUgKTtcclxuXHJcbiAgICAvLyBDb25kaXRpb25hbGx5IGluY2x1ZGUgb3VyIHBhcnRpdGlvbiBzZWxlY3Rpb24gb24gdG9wIG9mIHdoYXQgZWxzZSBpcyBpbmNsdWRlZFxyXG4gICAgcmV0dXJuIG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgc3VwZXIuZ2V0U2VsZWN0aW9uTm9kZXNQcm9wZXJ0eSgpLCBoYXNQYXJ0aXRpb25TZWxlY3Rpb25Qcm9wZXJ0eSBdLFxyXG4gICAgICAoIHNlbGVjdGlvbk5vZGVzLCBoYXNQYXJ0aXRpb25TZWxlY3Rpb24gKSA9PiBoYXNQYXJ0aXRpb25TZWxlY3Rpb24gPyBzZWxlY3Rpb25Ob2Rlcy5jb25jYXQoIFsgcGFydGl0aW9uU2VsZWN0aW9uUGFuZWwgXSApIDogc2VsZWN0aW9uTm9kZXMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgdGhlIG1haW4gYXJlYSBkaXNwbGF5IHZpZXcgZm9yIHRoZSBzY3JlZW4uXHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtQcm9wb3J0aW9uYWxBcmVhTW9kZWx9IG1vZGVsXHJcbiAgICogQHJldHVybnMge1Byb3BvcnRpb25hbEFyZWFEaXNwbGF5Tm9kZX1cclxuICAgKi9cclxuICBjcmVhdGVBcmVhRGlzcGxheU5vZGUoIG1vZGVsICkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9wb3J0aW9uYWxBcmVhRGlzcGxheU5vZGUoIG1vZGVsLmFyZWFEaXNwbGF5LCBtb2RlbC5wYXJ0aWFsUHJvZHVjdHNDaG9pY2VQcm9wZXJ0eSwge1xyXG4gICAgICBncmlkTGluZXNWaXNpYmxlUHJvcGVydHk6IG1vZGVsLmdyaWRMaW5lc1Zpc2libGVQcm9wZXJ0eSxcclxuICAgICAgdGlsZXNWaXNpYmxlUHJvcGVydHk6IG1vZGVsLnRpbGVzVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICBjb3VudGluZ1Zpc2libGVQcm9wZXJ0eTogbW9kZWwuY291bnRpbmdWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgIHVzZVRpbGVMaWtlQmFja2dyb3VuZDogdGhpcy51c2VUaWxlTGlrZUJhY2tncm91bmQsXHJcbiAgICAgIHVzZUxhcmdlQXJlYTogdGhpcy51c2VMYXJnZUFyZWFcclxuICAgIH0sIHtcclxuICAgICAgdHJhbnNsYXRpb246IHRoaXMuZ2V0RGlzcGxheVRyYW5zbGF0aW9uKClcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgdGhlIFwiZmFjdG9yc1wiIChkaW1lbnNpb25zKSBjb250ZW50IGZvciB0aGUgYWNjb3JkaW9uIGJveC5cclxuICAgKiBAcHVibGljXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge1Byb3BvcnRpb25hbEFyZWFNb2RlbH0gbW9kZWxcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZGVjaW1hbFBsYWNlc1xyXG4gICAqIEByZXR1cm5zIHtOb2RlfVxyXG4gICAqL1xyXG4gIGNyZWF0ZUZhY3RvcnNOb2RlKCBtb2RlbCwgZGVjaW1hbFBsYWNlcyApIHtcclxuICAgIHJldHVybiBuZXcgUHJvcG9ydGlvbmFsRmFjdG9yc05vZGUoIG1vZGVsLmN1cnJlbnRBcmVhUHJvcGVydHksIG1vZGVsLmFyZWFEaXNwbGF5LmFjdGl2ZVRvdGFsUHJvcGVydGllcywgZGVjaW1hbFBsYWNlcyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhIGdyaWQgaWNvbi5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqXHJcbiAgICogQHJldHVybnMge05vZGV9XHJcbiAgICovXHJcbiAgY3JlYXRlR3JpZEljb25Ob2RlKCkge1xyXG4gICAgY29uc3QgZ3JpZEljb25TaGFwZSA9IG5ldyBTaGFwZSgpXHJcbiAgICAgIC5tb3ZlVG8oIFJBRElPX0lDT05fU0laRSAvIDQsIDAgKVxyXG4gICAgICAubGluZVRvKCBSQURJT19JQ09OX1NJWkUgLyA0LCBSQURJT19JQ09OX1NJWkUgKVxyXG4gICAgICAubW92ZVRvKCBSQURJT19JQ09OX1NJWkUgLyAyLCAwIClcclxuICAgICAgLmxpbmVUbyggUkFESU9fSUNPTl9TSVpFIC8gMiwgUkFESU9fSUNPTl9TSVpFIClcclxuICAgICAgLm1vdmVUbyggUkFESU9fSUNPTl9TSVpFICogMyAvIDQsIDAgKVxyXG4gICAgICAubGluZVRvKCBSQURJT19JQ09OX1NJWkUgKiAzIC8gNCwgUkFESU9fSUNPTl9TSVpFIClcclxuICAgICAgLm1vdmVUbyggMCwgUkFESU9fSUNPTl9TSVpFIC8gNCApXHJcbiAgICAgIC5saW5lVG8oIFJBRElPX0lDT05fU0laRSwgUkFESU9fSUNPTl9TSVpFIC8gNCApXHJcbiAgICAgIC5tb3ZlVG8oIDAsIFJBRElPX0lDT05fU0laRSAvIDIgKVxyXG4gICAgICAubGluZVRvKCBSQURJT19JQ09OX1NJWkUsIFJBRElPX0lDT05fU0laRSAvIDIgKVxyXG4gICAgICAubW92ZVRvKCAwLCBSQURJT19JQ09OX1NJWkUgKiAzIC8gNCApXHJcbiAgICAgIC5saW5lVG8oIFJBRElPX0lDT05fU0laRSwgUkFESU9fSUNPTl9TSVpFICogMyAvIDQgKTtcclxuICAgIHJldHVybiBuZXcgUGF0aCggZ3JpZEljb25TaGFwZSwge1xyXG4gICAgICBzdHJva2U6IEFyZWFNb2RlbENvbW1vbkNvbG9ycy5ncmlkSWNvblByb3BlcnR5XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgdGlsZSBpY29uLlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7Tm9kZX1cclxuICAgKi9cclxuICBjcmVhdGVUaWxlSWNvbk5vZGUoKSB7XHJcbiAgICBjb25zdCB0aWxlSWNvbk9wdGlvbnMgPSB7XHJcbiAgICAgIGZpbGw6IEFyZWFNb2RlbENvbW1vbkNvbG9ycy5zbWFsbFRpbGVQcm9wZXJ0eSxcclxuICAgICAgc3Ryb2tlOiBBcmVhTW9kZWxDb21tb25Db2xvcnMudGlsZUljb25TdHJva2VQcm9wZXJ0eSxcclxuICAgICAgbGluZVdpZHRoOiAwLjVcclxuICAgIH07XHJcbiAgICBjb25zdCBTTUFMTF9USUxFX0lDT05fU0laRSA9IFJBRElPX0lDT05fU0laRSAvIDEwO1xyXG4gICAgcmV0dXJuIG5ldyBIQm94KCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgbmV3IFJlY3RhbmdsZSggMCwgMCwgUkFESU9fSUNPTl9TSVpFLCBSQURJT19JQ09OX1NJWkUsIHRpbGVJY29uT3B0aW9ucyApLFxyXG4gICAgICAgIG5ldyBSZWN0YW5nbGUoIDAsIDAsIFNNQUxMX1RJTEVfSUNPTl9TSVpFLCBSQURJT19JQ09OX1NJWkUsIHRpbGVJY29uT3B0aW9ucyApLFxyXG4gICAgICAgIG5ldyBWQm94KCB7XHJcbiAgICAgICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgICAgICBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBTTUFMTF9USUxFX0lDT05fU0laRSwgU01BTExfVElMRV9JQ09OX1NJWkUsIHRpbGVJY29uT3B0aW9ucyApLFxyXG4gICAgICAgICAgICBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBTTUFMTF9USUxFX0lDT05fU0laRSwgU01BTExfVElMRV9JQ09OX1NJWkUsIHRpbGVJY29uT3B0aW9ucyApLFxyXG4gICAgICAgICAgICBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBTTUFMTF9USUxFX0lDT05fU0laRSwgU01BTExfVElMRV9JQ09OX1NJWkUsIHRpbGVJY29uT3B0aW9ucyApXHJcbiAgICAgICAgICBdLFxyXG4gICAgICAgICAgc3BhY2luZzogMFxyXG4gICAgICAgIH0gKVxyXG4gICAgICBdLFxyXG4gICAgICBhbGlnbjogJ3RvcCcsXHJcbiAgICAgIHNwYWNpbmc6IFJBRElPX0lDT05fU0laRSAvIDhcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBjb3VudGluZyBpY29uLlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7Tm9kZX1cclxuICAgKi9cclxuICBjcmVhdGVDb3VudGluZ0ljb25Ob2RlKCkge1xyXG4gICAgLy8gSGFyZGNvZGVkIHN0cmluZywgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9hcmVhLW1vZGVsLWNvbW1vbi9pc3N1ZXMvMTA0XHJcbiAgICByZXR1cm4gbmV3IFRleHQoICcxMjMnLCB7XHJcbiAgICAgIGZvbnQ6IEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5DT1VOVElOR19JQ09OX0ZPTlRcclxuICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbmFyZWFNb2RlbENvbW1vbi5yZWdpc3RlciggJ1Byb3BvcnRpb25hbEFyZWFTY3JlZW5WaWV3JywgUHJvcG9ydGlvbmFsQXJlYVNjcmVlblZpZXcgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFByb3BvcnRpb25hbEFyZWFTY3JlZW5WaWV3OyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDdEQsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxTQUFTQyxVQUFVLEVBQUVDLElBQUksRUFBRUMsSUFBSSxFQUFFQyxTQUFTLEVBQUVDLElBQUksRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUNqRyxPQUFPQyxRQUFRLE1BQU0sZ0NBQWdDO0FBQ3JELE9BQU9DLGVBQWUsTUFBTSwwQkFBMEI7QUFDdEQsT0FBT0Msc0JBQXNCLE1BQU0saUNBQWlDO0FBQ3BFLE9BQU9DLHdCQUF3QixNQUFNLDBDQUEwQztBQUMvRSxPQUFPQyxzQkFBc0IsTUFBTSx3Q0FBd0M7QUFDM0UsT0FBT0MscUJBQXFCLE1BQU0sNENBQTRDO0FBQzlFLE9BQU9DLGNBQWMsTUFBTSxxQ0FBcUM7QUFDaEUsT0FBT0MsbUJBQW1CLE1BQU0saUNBQWlDO0FBQ2pFLE9BQU9DLHFCQUFxQixNQUFNLG1DQUFtQztBQUNyRSxPQUFPQyx5QkFBeUIsTUFBTSxnQ0FBZ0M7QUFDdEUsT0FBT0MsMkJBQTJCLE1BQU0sa0NBQWtDO0FBQzFFLE9BQU9DLHVCQUF1QixNQUFNLDhCQUE4QjtBQUNsRSxPQUFPQyxxQkFBcUIsTUFBTSw0QkFBNEI7QUFFOUQsTUFBTUMsZUFBZSxHQUFHWCxzQkFBc0IsQ0FBQ1ksU0FBUztBQUN4RCxNQUFNQyxxQkFBcUIsR0FBR2Isc0JBQXNCLENBQUNjLElBQUksQ0FBQ0MsZUFBZTtBQUN6RSxNQUFNQyxnQ0FBZ0MsR0FB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