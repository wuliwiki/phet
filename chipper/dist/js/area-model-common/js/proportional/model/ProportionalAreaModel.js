// Copyright 2017-2021, University of Colorado Boulder

/**
 * Supertype for proportional (to-scale, not generic) area-model models.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import Utils from '../../../../dot/js/Utils.js';
import merge from '../../../../phet-core/js/merge.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { TextBounds } from '../../../../scenery/js/imports.js';
import areaModelCommon from '../../areaModelCommon.js';
import AreaModelCommonModel from '../../common/model/AreaModelCommonModel.js';
import ProportionalArea from './ProportionalArea.js';
import ProportionalAreaDisplay from './ProportionalAreaDisplay.js';

// constants
const TEST_FONT = new PhetFont(12);
class ProportionalAreaModel extends AreaModelCommonModel {
  /**
   * @param {Array.<Object>} areaOptionObjects - An array of options objects to be passed to the ProportionalArea
   *                         constructors.
   * @param {Object} [options]
   */
  constructor(areaOptionObjects, options) {
    options = merge({
      isProportional: true,
      initialAreaBoxExpanded: true
    }, options);
    const areas = areaOptionObjects.map(options => new ProportionalArea(options));
    super(areas, areas[0], options);

    // @public {BooleanProperty}
    this.gridLinesVisibleProperty = new BooleanProperty(true);

    // @public {BooleanProperty}
    this.tilesVisibleProperty = new BooleanProperty(false);

    // @public {BooleanProperty}
    this.countingVisibleProperty = new BooleanProperty(true);

    // @public {BooleanProperty}
    this.calculationBoxVisibleProperty = new BooleanProperty(false);
  }

  /**
   * Returns a concrete AreaDisplay subtype
   * @protected
   *
   * @param {Property.<Area>} areaProperty
   * @returns {ProportionalAreaDisplay}
   */
  createAreaDisplay(areaProperty) {
    return new ProportionalAreaDisplay(areaProperty);
  }

  /**
   * Returns a string that should be the longest string possible for our given areas.
   * @public
   *
   * @returns {string}
   */
  getMaximumAreaString() {
    let maxString = '9';
    let maxLength = 0;
    this.areas.forEach(area => {
      const representativeSize = area.snapSize + area.maximumSize;
      // Round because of floating point precision
      const string = `${Utils.toFixedNumber(representativeSize * representativeSize, 8)}`; // Square for area
      const length = TextBounds.approximateCanvasWidth(TEST_FONT, string);
      if (length > maxLength) {
        maxLength = length;
        maxString = string;
      }
    });
    return maxString;
  }

  /**
   * Returns the model to its initial state.
   * @public
   * @override
   */
  reset() {
    super.reset();
    this.gridLinesVisibleProperty.reset();
    this.tilesVisibleProperty.reset();
    this.countingVisibleProperty.reset();
    this.calculationBoxVisibleProperty.reset();
  }
}
areaModelCommon.register('ProportionalAreaModel', ProportionalAreaModel);
export default ProportionalAreaModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJVdGlscyIsIm1lcmdlIiwiUGhldEZvbnQiLCJUZXh0Qm91bmRzIiwiYXJlYU1vZGVsQ29tbW9uIiwiQXJlYU1vZGVsQ29tbW9uTW9kZWwiLCJQcm9wb3J0aW9uYWxBcmVhIiwiUHJvcG9ydGlvbmFsQXJlYURpc3BsYXkiLCJURVNUX0ZPTlQiLCJQcm9wb3J0aW9uYWxBcmVhTW9kZWwiLCJjb25zdHJ1Y3RvciIsImFyZWFPcHRpb25PYmplY3RzIiwib3B0aW9ucyIsImlzUHJvcG9ydGlvbmFsIiwiaW5pdGlhbEFyZWFCb3hFeHBhbmRlZCIsImFyZWFzIiwibWFwIiwiZ3JpZExpbmVzVmlzaWJsZVByb3BlcnR5IiwidGlsZXNWaXNpYmxlUHJvcGVydHkiLCJjb3VudGluZ1Zpc2libGVQcm9wZXJ0eSIsImNhbGN1bGF0aW9uQm94VmlzaWJsZVByb3BlcnR5IiwiY3JlYXRlQXJlYURpc3BsYXkiLCJhcmVhUHJvcGVydHkiLCJnZXRNYXhpbXVtQXJlYVN0cmluZyIsIm1heFN0cmluZyIsIm1heExlbmd0aCIsImZvckVhY2giLCJhcmVhIiwicmVwcmVzZW50YXRpdmVTaXplIiwic25hcFNpemUiLCJtYXhpbXVtU2l6ZSIsInN0cmluZyIsInRvRml4ZWROdW1iZXIiLCJsZW5ndGgiLCJhcHByb3hpbWF0ZUNhbnZhc1dpZHRoIiwicmVzZXQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlByb3BvcnRpb25hbEFyZWFNb2RlbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNy0yMDIxLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTdXBlcnR5cGUgZm9yIHByb3BvcnRpb25hbCAodG8tc2NhbGUsIG5vdCBnZW5lcmljKSBhcmVhLW1vZGVsIG1vZGVscy5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUGhldEZvbnQuanMnO1xyXG5pbXBvcnQgeyBUZXh0Qm91bmRzIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGFyZWFNb2RlbENvbW1vbiBmcm9tICcuLi8uLi9hcmVhTW9kZWxDb21tb24uanMnO1xyXG5pbXBvcnQgQXJlYU1vZGVsQ29tbW9uTW9kZWwgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL0FyZWFNb2RlbENvbW1vbk1vZGVsLmpzJztcclxuaW1wb3J0IFByb3BvcnRpb25hbEFyZWEgZnJvbSAnLi9Qcm9wb3J0aW9uYWxBcmVhLmpzJztcclxuaW1wb3J0IFByb3BvcnRpb25hbEFyZWFEaXNwbGF5IGZyb20gJy4vUHJvcG9ydGlvbmFsQXJlYURpc3BsYXkuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IFRFU1RfRk9OVCA9IG5ldyBQaGV0Rm9udCggMTIgKTtcclxuXHJcbmNsYXNzIFByb3BvcnRpb25hbEFyZWFNb2RlbCBleHRlbmRzIEFyZWFNb2RlbENvbW1vbk1vZGVsIHtcclxuICAvKipcclxuICAgKiBAcGFyYW0ge0FycmF5LjxPYmplY3Q+fSBhcmVhT3B0aW9uT2JqZWN0cyAtIEFuIGFycmF5IG9mIG9wdGlvbnMgb2JqZWN0cyB0byBiZSBwYXNzZWQgdG8gdGhlIFByb3BvcnRpb25hbEFyZWFcclxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdHJ1Y3RvcnMuXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBhcmVhT3B0aW9uT2JqZWN0cywgb3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuICAgICAgaXNQcm9wb3J0aW9uYWw6IHRydWUsXHJcbiAgICAgIGluaXRpYWxBcmVhQm94RXhwYW5kZWQ6IHRydWVcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCBhcmVhcyA9IGFyZWFPcHRpb25PYmplY3RzLm1hcCggb3B0aW9ucyA9PiBuZXcgUHJvcG9ydGlvbmFsQXJlYSggb3B0aW9ucyApICk7XHJcblxyXG4gICAgc3VwZXIoIGFyZWFzLCBhcmVhc1sgMCBdLCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7Qm9vbGVhblByb3BlcnR5fVxyXG4gICAgdGhpcy5ncmlkTGluZXNWaXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7Qm9vbGVhblByb3BlcnR5fVxyXG4gICAgdGhpcy50aWxlc1Zpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7Qm9vbGVhblByb3BlcnR5fVxyXG4gICAgdGhpcy5jb3VudGluZ1Zpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUgKTtcclxuXHJcbiAgICAvLyBAcHVibGljIHtCb29sZWFuUHJvcGVydHl9XHJcbiAgICB0aGlzLmNhbGN1bGF0aW9uQm94VmlzaWJsZVByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgYSBjb25jcmV0ZSBBcmVhRGlzcGxheSBzdWJ0eXBlXHJcbiAgICogQHByb3RlY3RlZFxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48QXJlYT59IGFyZWFQcm9wZXJ0eVxyXG4gICAqIEByZXR1cm5zIHtQcm9wb3J0aW9uYWxBcmVhRGlzcGxheX1cclxuICAgKi9cclxuICBjcmVhdGVBcmVhRGlzcGxheSggYXJlYVByb3BlcnR5ICkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9wb3J0aW9uYWxBcmVhRGlzcGxheSggYXJlYVByb3BlcnR5ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIGEgc3RyaW5nIHRoYXQgc2hvdWxkIGJlIHRoZSBsb25nZXN0IHN0cmluZyBwb3NzaWJsZSBmb3Igb3VyIGdpdmVuIGFyZWFzLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAgICovXHJcbiAgZ2V0TWF4aW11bUFyZWFTdHJpbmcoKSB7XHJcbiAgICBsZXQgbWF4U3RyaW5nID0gJzknO1xyXG4gICAgbGV0IG1heExlbmd0aCA9IDA7XHJcbiAgICB0aGlzLmFyZWFzLmZvckVhY2goIGFyZWEgPT4ge1xyXG4gICAgICBjb25zdCByZXByZXNlbnRhdGl2ZVNpemUgPSBhcmVhLnNuYXBTaXplICsgYXJlYS5tYXhpbXVtU2l6ZTtcclxuICAgICAgLy8gUm91bmQgYmVjYXVzZSBvZiBmbG9hdGluZyBwb2ludCBwcmVjaXNpb25cclxuICAgICAgY29uc3Qgc3RyaW5nID0gYCR7VXRpbHMudG9GaXhlZE51bWJlciggcmVwcmVzZW50YXRpdmVTaXplICogcmVwcmVzZW50YXRpdmVTaXplLCA4ICl9YDsgLy8gU3F1YXJlIGZvciBhcmVhXHJcbiAgICAgIGNvbnN0IGxlbmd0aCA9IFRleHRCb3VuZHMuYXBwcm94aW1hdGVDYW52YXNXaWR0aCggVEVTVF9GT05ULCBzdHJpbmcgKTtcclxuICAgICAgaWYgKCBsZW5ndGggPiBtYXhMZW5ndGggKSB7XHJcbiAgICAgICAgbWF4TGVuZ3RoID0gbGVuZ3RoO1xyXG4gICAgICAgIG1heFN0cmluZyA9IHN0cmluZztcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gICAgcmV0dXJuIG1heFN0cmluZztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIG1vZGVsIHRvIGl0cyBpbml0aWFsIHN0YXRlLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKi9cclxuICByZXNldCgpIHtcclxuICAgIHN1cGVyLnJlc2V0KCk7XHJcblxyXG4gICAgdGhpcy5ncmlkTGluZXNWaXNpYmxlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMudGlsZXNWaXNpYmxlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuY291bnRpbmdWaXNpYmxlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuY2FsY3VsYXRpb25Cb3hWaXNpYmxlUHJvcGVydHkucmVzZXQoKTtcclxuICB9XHJcbn1cclxuXHJcbmFyZWFNb2RlbENvbW1vbi5yZWdpc3RlciggJ1Byb3BvcnRpb25hbEFyZWFNb2RlbCcsIFByb3BvcnRpb25hbEFyZWFNb2RlbCApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgUHJvcG9ydGlvbmFsQXJlYU1vZGVsOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLFVBQVUsUUFBUSxtQ0FBbUM7QUFDOUQsT0FBT0MsZUFBZSxNQUFNLDBCQUEwQjtBQUN0RCxPQUFPQyxvQkFBb0IsTUFBTSw0Q0FBNEM7QUFDN0UsT0FBT0MsZ0JBQWdCLE1BQU0sdUJBQXVCO0FBQ3BELE9BQU9DLHVCQUF1QixNQUFNLDhCQUE4Qjs7QUFFbEU7QUFDQSxNQUFNQyxTQUFTLEdBQUcsSUFBSU4sUUFBUSxDQUFFLEVBQUcsQ0FBQztBQUVwQyxNQUFNTyxxQkFBcUIsU0FBU0osb0JB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