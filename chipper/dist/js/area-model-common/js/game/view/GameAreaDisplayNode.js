// Copyright 2017-2022, University of Colorado Boulder

/**
 * Supertype for view of Area objects.
 *
 * NOTE: This type is designed to be persistent, and will not need to release references to avoid memory leaks.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Property from '../../../../axon/js/Property.js';
import Orientation from '../../../../phet-core/js/Orientation.js';
import { Node, Rectangle } from '../../../../scenery/js/imports.js';
import areaModelCommon from '../../areaModelCommon.js';
import AreaModelCommonConstants from '../../common/AreaModelCommonConstants.js';
import OrientationPair from '../../common/model/OrientationPair.js';
import AreaModelCommonColors from '../../common/view/AreaModelCommonColors.js';
import RangeLabelNode from '../../common/view/RangeLabelNode.js';
import GenericAreaDisplayNode from '../../generic/view/GenericAreaDisplayNode.js';
import TermKeypadPanel from '../../generic/view/TermKeypadPanel.js';
import Entry from '../model/Entry.js';
import EntryType from '../model/EntryType.js';
import InputMethod from '../model/InputMethod.js';
import GameEditableLabelNode from './GameEditableLabelNode.js';

// constants
const MAX_PARTITIONS = 3; // The maximum number of partitions for a specific dimension

class GameAreaDisplayNode extends Node {
  /**
   * @param {GameAreaDisplay} areaDisplay
   * @param {Property.<Entry|null>} activeEntryProperty
   * @param {Property.<GameState>} gameStateProperty
   * @param {function} setActiveTerm - function( {Term|null} ) - Called when the value of the edited term should be set.
   */
  constructor(areaDisplay, activeEntryProperty, gameStateProperty, setActiveTerm) {
    super();
    const singleOffset = AreaModelCommonConstants.AREA_SIZE * AreaModelCommonConstants.GENERIC_SINGLE_OFFSET;
    const firstOffset = AreaModelCommonConstants.AREA_SIZE * AreaModelCommonConstants.GENERIC_FIRST_OFFSET;
    const secondOffset = AreaModelCommonConstants.AREA_SIZE * AreaModelCommonConstants.GENERIC_SECOND_OFFSET;
    const fullOffset = AreaModelCommonConstants.AREA_SIZE;

    // Background fill and stroke
    this.addChild(new Rectangle(0, 0, AreaModelCommonConstants.AREA_SIZE, AreaModelCommonConstants.AREA_SIZE, {
      fill: AreaModelCommonColors.areaBackgroundProperty,
      stroke: AreaModelCommonColors.areaBorderProperty
    }));
    this.addChild(GenericAreaDisplayNode.createPartitionLines(areaDisplay.layoutProperty, AreaModelCommonConstants.AREA_SIZE));

    // Range views
    const tickVariations = {
      1: [0, fullOffset],
      2: [0, singleOffset, fullOffset],
      3: [0, firstOffset, secondOffset, fullOffset]
    };
    Orientation.enumeration.values.forEach(orientation => {
      const colorProperty = AreaModelCommonColors.genericColorProperties.get(orientation);
      const termListProperty = areaDisplay.totalProperties.get(orientation);
      const tickPositionsProperty = new DerivedProperty([areaDisplay.layoutProperty], layout => tickVariations[layout.getPartitionQuantity(orientation)]);
      this.addChild(new RangeLabelNode(termListProperty, orientation, tickPositionsProperty, colorProperty, false));
    });

    // {OrientationPair.<Array.<Property.<number>>>} - The visual centers of all of the partitions.
    // This duplicates some logic from GenericArea's coordinateRangeProperty handling, but here we need the full-length
    // array every time.
    const centerProperties = OrientationPair.create(orientation => [new DerivedProperty([areaDisplay.layoutProperty], layout => {
      const partitionCount = layout.getPartitionQuantity(orientation);
      if (partitionCount === 1) {
        return fullOffset / 2;
      } else if (partitionCount === 2) {
        return singleOffset / 2;
      } else if (partitionCount === 3) {
        return firstOffset / 2;
      } else {
        throw new Error(`unsupported value for partitionCount: ${partitionCount}`);
      }
    }), new DerivedProperty([areaDisplay.layoutProperty], layout => {
      const partitionCount = layout.getPartitionQuantity(orientation);
      if (partitionCount === 2) {
        return (fullOffset + singleOffset) / 2;
      } else if (partitionCount === 3) {
        return (secondOffset + firstOffset) / 2;
      } else {
        return 0; // no need to position here, since this will never be used with a partitionCount of 1
      }
    }), new Property((fullOffset + secondOffset) / 2)]);

    // Partition size labels
    Orientation.enumeration.values.forEach(orientation => {
      _.range(0, MAX_PARTITIONS).forEach(partitionIndex => {
        const entryProperty = new DerivedProperty([areaDisplay.partitionSizeEntriesProperties.get(orientation)], entries => entries[partitionIndex] ? entries[partitionIndex] : new Entry(null));
        const colorProperty = AreaModelCommonColors.genericColorProperties.get(orientation);
        const label = new GameEditableLabelNode({
          entryProperty: entryProperty,
          gameStateProperty: gameStateProperty,
          activeEntryProperty: activeEntryProperty,
          colorProperty: colorProperty,
          allowExponentsProperty: areaDisplay.allowExponentsProperty,
          orientation: orientation
        });
        label[orientation.opposite.coordinate] = AreaModelCommonConstants.PARTITION_OFFSET.get(orientation);
        this.addChild(label);
        centerProperties.get(orientation)[partitionIndex].link(position => {
          label[orientation.coordinate] = position;
        });
      });
    });

    // Labels for each partitioned area
    _.range(0, MAX_PARTITIONS).forEach(horizontalIndex => {
      _.range(0, MAX_PARTITIONS).forEach(verticalIndex => {
        const entryProperty = new DerivedProperty([areaDisplay.partialProductEntriesProperty], values => values[verticalIndex] && values[verticalIndex][horizontalIndex] ? values[verticalIndex][horizontalIndex] : new Entry(null));
        const colorProperty = new DerivedProperty([entryProperty, AreaModelCommonColors.dynamicPartialProductProperty, AreaModelCommonColors.fixedPartialProductProperty], (entry, dynamicColor, fixedColor) => {
          if (entry && entry.type === EntryType.DYNAMIC) {
            return dynamicColor;
          } else {
            return fixedColor;
          }
        });
        const label = new GameEditableLabelNode({
          entryProperty: entryProperty,
          gameStateProperty: gameStateProperty,
          activeEntryProperty: activeEntryProperty,
          colorProperty: colorProperty,
          allowExponentsProperty: areaDisplay.allowExponentsProperty,
          orientation: Orientation.VERTICAL,
          labelFont: AreaModelCommonConstants.GAME_PARTIAL_PRODUCT_LABEL_FONT,
          editFont: AreaModelCommonConstants.GAME_PARTIAL_PRODUCT_EDIT_FONT
        });
        this.addChild(label);
        centerProperties.horizontal[horizontalIndex].linkAttribute(label, 'x');
        centerProperties.vertical[verticalIndex].linkAttribute(label, 'y');
      });
    });
    const digitsProperty = new DerivedProperty([activeEntryProperty], entry => entry ? entry.digits : 1);
    const keypadOptions = {
      // padding constant allows it to fit between the area and the other panels
      x: AreaModelCommonConstants.AREA_SIZE + AreaModelCommonConstants.KEYPAD_LEFT_PADDING,
      top: 0
    };
    const noExponentKeypadPanel = new TermKeypadPanel(digitsProperty, false, false, setActiveTerm, keypadOptions);
    const exponentKeypadPanel = new TermKeypadPanel(digitsProperty, true, true, setActiveTerm, keypadOptions);
    this.addChild(noExponentKeypadPanel);
    this.addChild(exponentKeypadPanel);
    activeEntryProperty.link(newEntry => {
      noExponentKeypadPanel.clear();
      exponentKeypadPanel.clear();
      noExponentKeypadPanel.visible = newEntry !== null && newEntry.inputMethod === InputMethod.CONSTANT;
      exponentKeypadPanel.visible = newEntry !== null && newEntry.inputMethod === InputMethod.TERM;
    });
  }
}
areaModelCommon.register('GameAreaDisplayNode', GameAreaDisplayNode);
export default GameAreaDisplayNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJQcm9wZXJ0eSIsIk9yaWVudGF0aW9uIiwiTm9kZSIsIlJlY3RhbmdsZSIsImFyZWFNb2RlbENvbW1vbiIsIkFyZWFNb2RlbENvbW1vbkNvbnN0YW50cyIsIk9yaWVudGF0aW9uUGFpciIsIkFyZWFNb2RlbENvbW1vbkNvbG9ycyIsIlJhbmdlTGFiZWxOb2RlIiwiR2VuZXJpY0FyZWFEaXNwbGF5Tm9kZSIsIlRlcm1LZXlwYWRQYW5lbCIsIkVudHJ5IiwiRW50cnlUeXBlIiwiSW5wdXRNZXRob2QiLCJHYW1lRWRpdGFibGVMYWJlbE5vZGUiLCJNQVhfUEFSVElUSU9OUyIsIkdhbWVBcmVhRGlzcGxheU5vZGUiLCJjb25zdHJ1Y3RvciIsImFyZWFEaXNwbGF5IiwiYWN0aXZlRW50cnlQcm9wZXJ0eSIsImdhbWVTdGF0ZVByb3BlcnR5Iiwic2V0QWN0aXZlVGVybSIsInNpbmdsZU9mZnNldCIsIkFSRUFfU0laRSIsIkdFTkVSSUNfU0lOR0xFX09GRlNFVCIsImZpcnN0T2Zmc2V0IiwiR0VORVJJQ19GSVJTVF9PRkZTRVQiLCJzZWNvbmRPZmZzZXQiLCJHRU5FUklDX1NFQ09ORF9PRkZTRVQiLCJmdWxsT2Zmc2V0IiwiYWRkQ2hpbGQiLCJmaWxsIiwiYXJlYUJhY2tncm91bmRQcm9wZXJ0eSIsInN0cm9rZSIsImFyZWFCb3JkZXJQcm9wZXJ0eSIsImNyZWF0ZVBhcnRpdGlvbkxpbmVzIiwibGF5b3V0UHJvcGVydHkiLCJ0aWNrVmFyaWF0aW9ucyIsImVudW1lcmF0aW9uIiwidmFsdWVzIiwiZm9yRWFjaCIsIm9yaWVudGF0aW9uIiwiY29sb3JQcm9wZXJ0eSIsImdlbmVyaWNDb2xvclByb3BlcnRpZXMiLCJnZXQiLCJ0ZXJtTGlzdFByb3BlcnR5IiwidG90YWxQcm9wZXJ0aWVzIiwidGlja1Bvc2l0aW9uc1Byb3BlcnR5IiwibGF5b3V0IiwiZ2V0UGFydGl0aW9uUXVhbnRpdHkiLCJjZW50ZXJQcm9wZXJ0aWVzIiwiY3JlYXRlIiwicGFydGl0aW9uQ291bnQiLCJFcnJvciIsIl8iLCJyYW5nZSIsInBhcnRpdGlvbkluZGV4IiwiZW50cnlQcm9wZXJ0eSIsInBhcnRpdGlvblNpemVFbnRyaWVzUHJvcGVydGllcyIsImVudHJpZXMiLCJsYWJlbCIsImFsbG93RXhwb25lbnRzUHJvcGVydHkiLCJvcHBvc2l0ZSIsImNvb3JkaW5hdGUiLCJQQVJUSVRJT05fT0ZGU0VUIiwibGluayIsInBvc2l0aW9uIiwiaG9yaXpvbnRhbEluZGV4IiwidmVydGljYWxJbmRleCIsInBhcnRpYWxQcm9kdWN0RW50cmllc1Byb3BlcnR5IiwiZHluYW1pY1BhcnRpYWxQcm9kdWN0UHJvcGVydHkiLCJmaXhlZFBhcnRpYWxQcm9kdWN0UHJvcGVydHkiLCJlbnRyeSIsImR5bmFtaWNDb2xvciIsImZpeGVkQ29sb3IiLCJ0eXBlIiwiRFlOQU1JQyIsIlZFUlRJQ0FMIiwibGFiZWxGb250IiwiR0FNRV9QQVJUSUFMX1BST0RVQ1RfTEFCRUxfRk9OVCIsImVkaXRGb250IiwiR0FNRV9QQVJUSUFMX1BST0RVQ1RfRURJVF9GT05UIiwiaG9yaXpvbnRhbCIsImxpbmtBdHRyaWJ1dGUiLCJ2ZXJ0aWNhbCIsImRpZ2l0c1Byb3BlcnR5IiwiZGlnaXRzIiwia2V5cGFkT3B0aW9ucyIsIngiLCJLRVlQQURfTEVGVF9QQURESU5HIiwidG9wIiwibm9FeHBvbmVudEtleXBhZFBhbmVsIiwiZXhwb25lbnRLZXlwYWRQYW5lbCIsIm5ld0VudHJ5IiwiY2xlYXIiLCJ2aXNpYmxlIiwiaW5wdXRNZXRob2QiLCJDT05TVEFOVCIsIlRFUk0iLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkdhbWVBcmVhRGlzcGxheU5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTctMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU3VwZXJ0eXBlIGZvciB2aWV3IG9mIEFyZWEgb2JqZWN0cy5cclxuICpcclxuICogTk9URTogVGhpcyB0eXBlIGlzIGRlc2lnbmVkIHRvIGJlIHBlcnNpc3RlbnQsIGFuZCB3aWxsIG5vdCBuZWVkIHRvIHJlbGVhc2UgcmVmZXJlbmNlcyB0byBhdm9pZCBtZW1vcnkgbGVha3MuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgT3JpZW50YXRpb24gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL09yaWVudGF0aW9uLmpzJztcclxuaW1wb3J0IHsgTm9kZSwgUmVjdGFuZ2xlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGFyZWFNb2RlbENvbW1vbiBmcm9tICcuLi8uLi9hcmVhTW9kZWxDb21tb24uanMnO1xyXG5pbXBvcnQgQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9BcmVhTW9kZWxDb21tb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgT3JpZW50YXRpb25QYWlyIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9PcmllbnRhdGlvblBhaXIuanMnO1xyXG5pbXBvcnQgQXJlYU1vZGVsQ29tbW9uQ29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0FyZWFNb2RlbENvbW1vbkNvbG9ycy5qcyc7XHJcbmltcG9ydCBSYW5nZUxhYmVsTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9SYW5nZUxhYmVsTm9kZS5qcyc7XHJcbmltcG9ydCBHZW5lcmljQXJlYURpc3BsYXlOb2RlIGZyb20gJy4uLy4uL2dlbmVyaWMvdmlldy9HZW5lcmljQXJlYURpc3BsYXlOb2RlLmpzJztcclxuaW1wb3J0IFRlcm1LZXlwYWRQYW5lbCBmcm9tICcuLi8uLi9nZW5lcmljL3ZpZXcvVGVybUtleXBhZFBhbmVsLmpzJztcclxuaW1wb3J0IEVudHJ5IGZyb20gJy4uL21vZGVsL0VudHJ5LmpzJztcclxuaW1wb3J0IEVudHJ5VHlwZSBmcm9tICcuLi9tb2RlbC9FbnRyeVR5cGUuanMnO1xyXG5pbXBvcnQgSW5wdXRNZXRob2QgZnJvbSAnLi4vbW9kZWwvSW5wdXRNZXRob2QuanMnO1xyXG5pbXBvcnQgR2FtZUVkaXRhYmxlTGFiZWxOb2RlIGZyb20gJy4vR2FtZUVkaXRhYmxlTGFiZWxOb2RlLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBNQVhfUEFSVElUSU9OUyA9IDM7IC8vIFRoZSBtYXhpbXVtIG51bWJlciBvZiBwYXJ0aXRpb25zIGZvciBhIHNwZWNpZmljIGRpbWVuc2lvblxyXG5cclxuY2xhc3MgR2FtZUFyZWFEaXNwbGF5Tm9kZSBleHRlbmRzIE5vZGUge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7R2FtZUFyZWFEaXNwbGF5fSBhcmVhRGlzcGxheVxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPEVudHJ5fG51bGw+fSBhY3RpdmVFbnRyeVByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48R2FtZVN0YXRlPn0gZ2FtZVN0YXRlUHJvcGVydHlcclxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzZXRBY3RpdmVUZXJtIC0gZnVuY3Rpb24oIHtUZXJtfG51bGx9ICkgLSBDYWxsZWQgd2hlbiB0aGUgdmFsdWUgb2YgdGhlIGVkaXRlZCB0ZXJtIHNob3VsZCBiZSBzZXQuXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGFyZWFEaXNwbGF5LCBhY3RpdmVFbnRyeVByb3BlcnR5LCBnYW1lU3RhdGVQcm9wZXJ0eSwgc2V0QWN0aXZlVGVybSApIHtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIGNvbnN0IHNpbmdsZU9mZnNldCA9IEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5BUkVBX1NJWkUgKiBBcmVhTW9kZWxDb21tb25Db25zdGFudHMuR0VORVJJQ19TSU5HTEVfT0ZGU0VUO1xyXG4gICAgY29uc3QgZmlyc3RPZmZzZXQgPSBBcmVhTW9kZWxDb21tb25Db25zdGFudHMuQVJFQV9TSVpFICogQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkdFTkVSSUNfRklSU1RfT0ZGU0VUO1xyXG4gICAgY29uc3Qgc2Vjb25kT2Zmc2V0ID0gQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkFSRUFfU0laRSAqIEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5HRU5FUklDX1NFQ09ORF9PRkZTRVQ7XHJcbiAgICBjb25zdCBmdWxsT2Zmc2V0ID0gQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkFSRUFfU0laRTtcclxuXHJcbiAgICAvLyBCYWNrZ3JvdW5kIGZpbGwgYW5kIHN0cm9rZVxyXG4gICAgdGhpcy5hZGRDaGlsZCggbmV3IFJlY3RhbmdsZSggMCwgMCwgQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkFSRUFfU0laRSwgQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkFSRUFfU0laRSwge1xyXG4gICAgICBmaWxsOiBBcmVhTW9kZWxDb21tb25Db2xvcnMuYXJlYUJhY2tncm91bmRQcm9wZXJ0eSxcclxuICAgICAgc3Ryb2tlOiBBcmVhTW9kZWxDb21tb25Db2xvcnMuYXJlYUJvcmRlclByb3BlcnR5XHJcbiAgICB9ICkgKTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBHZW5lcmljQXJlYURpc3BsYXlOb2RlLmNyZWF0ZVBhcnRpdGlvbkxpbmVzKCBhcmVhRGlzcGxheS5sYXlvdXRQcm9wZXJ0eSwgQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkFSRUFfU0laRSApICk7XHJcblxyXG4gICAgLy8gUmFuZ2Ugdmlld3NcclxuICAgIGNvbnN0IHRpY2tWYXJpYXRpb25zID0ge1xyXG4gICAgICAxOiBbIDAsIGZ1bGxPZmZzZXQgXSxcclxuICAgICAgMjogWyAwLCBzaW5nbGVPZmZzZXQsIGZ1bGxPZmZzZXQgXSxcclxuICAgICAgMzogWyAwLCBmaXJzdE9mZnNldCwgc2Vjb25kT2Zmc2V0LCBmdWxsT2Zmc2V0IF1cclxuICAgIH07XHJcbiAgICBPcmllbnRhdGlvbi5lbnVtZXJhdGlvbi52YWx1ZXMuZm9yRWFjaCggb3JpZW50YXRpb24gPT4ge1xyXG4gICAgICBjb25zdCBjb2xvclByb3BlcnR5ID0gQXJlYU1vZGVsQ29tbW9uQ29sb3JzLmdlbmVyaWNDb2xvclByb3BlcnRpZXMuZ2V0KCBvcmllbnRhdGlvbiApO1xyXG4gICAgICBjb25zdCB0ZXJtTGlzdFByb3BlcnR5ID0gYXJlYURpc3BsYXkudG90YWxQcm9wZXJ0aWVzLmdldCggb3JpZW50YXRpb24gKTtcclxuICAgICAgY29uc3QgdGlja1Bvc2l0aW9uc1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBhcmVhRGlzcGxheS5sYXlvdXRQcm9wZXJ0eSBdLCBsYXlvdXQgPT4gdGlja1ZhcmlhdGlvbnNbIGxheW91dC5nZXRQYXJ0aXRpb25RdWFudGl0eSggb3JpZW50YXRpb24gKSBdICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIG5ldyBSYW5nZUxhYmVsTm9kZSggdGVybUxpc3RQcm9wZXJ0eSwgb3JpZW50YXRpb24sIHRpY2tQb3NpdGlvbnNQcm9wZXJ0eSwgY29sb3JQcm9wZXJ0eSwgZmFsc2UgKSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHtPcmllbnRhdGlvblBhaXIuPEFycmF5LjxQcm9wZXJ0eS48bnVtYmVyPj4+fSAtIFRoZSB2aXN1YWwgY2VudGVycyBvZiBhbGwgb2YgdGhlIHBhcnRpdGlvbnMuXHJcbiAgICAvLyBUaGlzIGR1cGxpY2F0ZXMgc29tZSBsb2dpYyBmcm9tIEdlbmVyaWNBcmVhJ3MgY29vcmRpbmF0ZVJhbmdlUHJvcGVydHkgaGFuZGxpbmcsIGJ1dCBoZXJlIHdlIG5lZWQgdGhlIGZ1bGwtbGVuZ3RoXHJcbiAgICAvLyBhcnJheSBldmVyeSB0aW1lLlxyXG4gICAgY29uc3QgY2VudGVyUHJvcGVydGllcyA9IE9yaWVudGF0aW9uUGFpci5jcmVhdGUoIG9yaWVudGF0aW9uID0+IFtcclxuICAgICAgbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBhcmVhRGlzcGxheS5sYXlvdXRQcm9wZXJ0eSBdLCBsYXlvdXQgPT4ge1xyXG4gICAgICAgIGNvbnN0IHBhcnRpdGlvbkNvdW50ID0gbGF5b3V0LmdldFBhcnRpdGlvblF1YW50aXR5KCBvcmllbnRhdGlvbiApO1xyXG4gICAgICAgIGlmICggcGFydGl0aW9uQ291bnQgPT09IDEgKSB7XHJcbiAgICAgICAgICByZXR1cm4gZnVsbE9mZnNldCAvIDI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCBwYXJ0aXRpb25Db3VudCA9PT0gMiApIHtcclxuICAgICAgICAgIHJldHVybiBzaW5nbGVPZmZzZXQgLyAyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICggcGFydGl0aW9uQ291bnQgPT09IDMgKSB7XHJcbiAgICAgICAgICByZXR1cm4gZmlyc3RPZmZzZXQgLyAyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvciggYHVuc3VwcG9ydGVkIHZhbHVlIGZvciBwYXJ0aXRpb25Db3VudDogJHtwYXJ0aXRpb25Db3VudH1gICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICksXHJcbiAgICAgIG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgYXJlYURpc3BsYXkubGF5b3V0UHJvcGVydHkgXSwgbGF5b3V0ID0+IHtcclxuICAgICAgICBjb25zdCBwYXJ0aXRpb25Db3VudCA9IGxheW91dC5nZXRQYXJ0aXRpb25RdWFudGl0eSggb3JpZW50YXRpb24gKTtcclxuICAgICAgICBpZiAoIHBhcnRpdGlvbkNvdW50ID09PSAyICkge1xyXG4gICAgICAgICAgcmV0dXJuICggZnVsbE9mZnNldCArIHNpbmdsZU9mZnNldCApIC8gMjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIHBhcnRpdGlvbkNvdW50ID09PSAzICkge1xyXG4gICAgICAgICAgcmV0dXJuICggc2Vjb25kT2Zmc2V0ICsgZmlyc3RPZmZzZXQgKSAvIDI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIDA7IC8vIG5vIG5lZWQgdG8gcG9zaXRpb24gaGVyZSwgc2luY2UgdGhpcyB3aWxsIG5ldmVyIGJlIHVzZWQgd2l0aCBhIHBhcnRpdGlvbkNvdW50IG9mIDFcclxuICAgICAgICB9XHJcbiAgICAgIH0gKSxcclxuICAgICAgbmV3IFByb3BlcnR5KCAoIGZ1bGxPZmZzZXQgKyBzZWNvbmRPZmZzZXQgKSAvIDIgKVxyXG4gICAgXSApO1xyXG5cclxuICAgIC8vIFBhcnRpdGlvbiBzaXplIGxhYmVsc1xyXG4gICAgT3JpZW50YXRpb24uZW51bWVyYXRpb24udmFsdWVzLmZvckVhY2goIG9yaWVudGF0aW9uID0+IHtcclxuICAgICAgXy5yYW5nZSggMCwgTUFYX1BBUlRJVElPTlMgKS5mb3JFYWNoKCBwYXJ0aXRpb25JbmRleCA9PiB7XHJcbiAgICAgICAgY29uc3QgZW50cnlQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgICAgICBbIGFyZWFEaXNwbGF5LnBhcnRpdGlvblNpemVFbnRyaWVzUHJvcGVydGllcy5nZXQoIG9yaWVudGF0aW9uICkgXSxcclxuICAgICAgICAgIGVudHJpZXMgPT4gZW50cmllc1sgcGFydGl0aW9uSW5kZXggXSA/IGVudHJpZXNbIHBhcnRpdGlvbkluZGV4IF0gOiBuZXcgRW50cnkoIG51bGwgKSApO1xyXG4gICAgICAgIGNvbnN0IGNvbG9yUHJvcGVydHkgPSBBcmVhTW9kZWxDb21tb25Db2xvcnMuZ2VuZXJpY0NvbG9yUHJvcGVydGllcy5nZXQoIG9yaWVudGF0aW9uICk7XHJcblxyXG4gICAgICAgIGNvbnN0IGxhYmVsID0gbmV3IEdhbWVFZGl0YWJsZUxhYmVsTm9kZSgge1xyXG4gICAgICAgICAgZW50cnlQcm9wZXJ0eTogZW50cnlQcm9wZXJ0eSxcclxuICAgICAgICAgIGdhbWVTdGF0ZVByb3BlcnR5OiBnYW1lU3RhdGVQcm9wZXJ0eSxcclxuICAgICAgICAgIGFjdGl2ZUVudHJ5UHJvcGVydHk6IGFjdGl2ZUVudHJ5UHJvcGVydHksXHJcbiAgICAgICAgICBjb2xvclByb3BlcnR5OiBjb2xvclByb3BlcnR5LFxyXG4gICAgICAgICAgYWxsb3dFeHBvbmVudHNQcm9wZXJ0eTogYXJlYURpc3BsYXkuYWxsb3dFeHBvbmVudHNQcm9wZXJ0eSxcclxuICAgICAgICAgIG9yaWVudGF0aW9uOiBvcmllbnRhdGlvblxyXG4gICAgICAgIH0gKTtcclxuXHJcbiAgICAgICAgbGFiZWxbIG9yaWVudGF0aW9uLm9wcG9zaXRlLmNvb3JkaW5hdGUgXSA9IEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5QQVJUSVRJT05fT0ZGU0VULmdldCggb3JpZW50YXRpb24gKTtcclxuICAgICAgICB0aGlzLmFkZENoaWxkKCBsYWJlbCApO1xyXG5cclxuICAgICAgICBjZW50ZXJQcm9wZXJ0aWVzLmdldCggb3JpZW50YXRpb24gKVsgcGFydGl0aW9uSW5kZXggXS5saW5rKCBwb3NpdGlvbiA9PiB7XHJcbiAgICAgICAgICBsYWJlbFsgb3JpZW50YXRpb24uY29vcmRpbmF0ZSBdID0gcG9zaXRpb247XHJcbiAgICAgICAgfSApO1xyXG4gICAgICB9ICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gTGFiZWxzIGZvciBlYWNoIHBhcnRpdGlvbmVkIGFyZWFcclxuICAgIF8ucmFuZ2UoIDAsIE1BWF9QQVJUSVRJT05TICkuZm9yRWFjaCggaG9yaXpvbnRhbEluZGV4ID0+IHtcclxuICAgICAgXy5yYW5nZSggMCwgTUFYX1BBUlRJVElPTlMgKS5mb3JFYWNoKCB2ZXJ0aWNhbEluZGV4ID0+IHtcclxuICAgICAgICBjb25zdCBlbnRyeVByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBhcmVhRGlzcGxheS5wYXJ0aWFsUHJvZHVjdEVudHJpZXNQcm9wZXJ0eSBdLCB2YWx1ZXMgPT4gKCB2YWx1ZXNbIHZlcnRpY2FsSW5kZXggXSAmJiB2YWx1ZXNbIHZlcnRpY2FsSW5kZXggXVsgaG9yaXpvbnRhbEluZGV4IF0gKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHZhbHVlc1sgdmVydGljYWxJbmRleCBdWyBob3Jpem9udGFsSW5kZXggXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IG5ldyBFbnRyeSggbnVsbCApICk7XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbG9yUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbXHJcbiAgICAgICAgICBlbnRyeVByb3BlcnR5LFxyXG4gICAgICAgICAgQXJlYU1vZGVsQ29tbW9uQ29sb3JzLmR5bmFtaWNQYXJ0aWFsUHJvZHVjdFByb3BlcnR5LFxyXG4gICAgICAgICAgQXJlYU1vZGVsQ29tbW9uQ29sb3JzLmZpeGVkUGFydGlhbFByb2R1Y3RQcm9wZXJ0eVxyXG4gICAgICAgIF0sICggZW50cnksIGR5bmFtaWNDb2xvciwgZml4ZWRDb2xvciApID0+IHtcclxuICAgICAgICAgIGlmICggZW50cnkgJiYgZW50cnkudHlwZSA9PT0gRW50cnlUeXBlLkRZTkFNSUMgKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkeW5hbWljQ29sb3I7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZpeGVkQ29sb3I7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSApO1xyXG5cclxuICAgICAgICBjb25zdCBsYWJlbCA9IG5ldyBHYW1lRWRpdGFibGVMYWJlbE5vZGUoIHtcclxuICAgICAgICAgIGVudHJ5UHJvcGVydHk6IGVudHJ5UHJvcGVydHksXHJcbiAgICAgICAgICBnYW1lU3RhdGVQcm9wZXJ0eTogZ2FtZVN0YXRlUHJvcGVydHksXHJcbiAgICAgICAgICBhY3RpdmVFbnRyeVByb3BlcnR5OiBhY3RpdmVFbnRyeVByb3BlcnR5LFxyXG4gICAgICAgICAgY29sb3JQcm9wZXJ0eTogY29sb3JQcm9wZXJ0eSxcclxuICAgICAgICAgIGFsbG93RXhwb25lbnRzUHJvcGVydHk6IGFyZWFEaXNwbGF5LmFsbG93RXhwb25lbnRzUHJvcGVydHksXHJcbiAgICAgICAgICBvcmllbnRhdGlvbjogT3JpZW50YXRpb24uVkVSVElDQUwsXHJcbiAgICAgICAgICBsYWJlbEZvbnQ6IEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5HQU1FX1BBUlRJQUxfUFJPRFVDVF9MQUJFTF9GT05ULFxyXG4gICAgICAgICAgZWRpdEZvbnQ6IEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5HQU1FX1BBUlRJQUxfUFJPRFVDVF9FRElUX0ZPTlRcclxuICAgICAgICB9ICk7XHJcbiAgICAgICAgdGhpcy5hZGRDaGlsZCggbGFiZWwgKTtcclxuXHJcbiAgICAgICAgY2VudGVyUHJvcGVydGllcy5ob3Jpem9udGFsWyBob3Jpem9udGFsSW5kZXggXS5saW5rQXR0cmlidXRlKCBsYWJlbCwgJ3gnICk7XHJcbiAgICAgICAgY2VudGVyUHJvcGVydGllcy52ZXJ0aWNhbFsgdmVydGljYWxJbmRleCBdLmxpbmtBdHRyaWJ1dGUoIGxhYmVsLCAneScgKTtcclxuICAgICAgfSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGRpZ2l0c1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBhY3RpdmVFbnRyeVByb3BlcnR5IF0sIGVudHJ5ID0+IGVudHJ5ID8gZW50cnkuZGlnaXRzIDogMSApO1xyXG5cclxuICAgIGNvbnN0IGtleXBhZE9wdGlvbnMgPSB7XHJcbiAgICAgIC8vIHBhZGRpbmcgY29uc3RhbnQgYWxsb3dzIGl0IHRvIGZpdCBiZXR3ZWVuIHRoZSBhcmVhIGFuZCB0aGUgb3RoZXIgcGFuZWxzXHJcbiAgICAgIHg6IEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5BUkVBX1NJWkUgKyBBcmVhTW9kZWxDb21tb25Db25zdGFudHMuS0VZUEFEX0xFRlRfUEFERElORyxcclxuICAgICAgdG9wOiAwXHJcbiAgICB9O1xyXG4gICAgY29uc3Qgbm9FeHBvbmVudEtleXBhZFBhbmVsID0gbmV3IFRlcm1LZXlwYWRQYW5lbCggZGlnaXRzUHJvcGVydHksIGZhbHNlLCBmYWxzZSwgc2V0QWN0aXZlVGVybSwga2V5cGFkT3B0aW9ucyApO1xyXG4gICAgY29uc3QgZXhwb25lbnRLZXlwYWRQYW5lbCA9IG5ldyBUZXJtS2V5cGFkUGFuZWwoIGRpZ2l0c1Byb3BlcnR5LCB0cnVlLCB0cnVlLCBzZXRBY3RpdmVUZXJtLCBrZXlwYWRPcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5hZGRDaGlsZCggbm9FeHBvbmVudEtleXBhZFBhbmVsICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBleHBvbmVudEtleXBhZFBhbmVsICk7XHJcblxyXG4gICAgYWN0aXZlRW50cnlQcm9wZXJ0eS5saW5rKCBuZXdFbnRyeSA9PiB7XHJcbiAgICAgIG5vRXhwb25lbnRLZXlwYWRQYW5lbC5jbGVhcigpO1xyXG4gICAgICBleHBvbmVudEtleXBhZFBhbmVsLmNsZWFyKCk7XHJcblxyXG4gICAgICBub0V4cG9uZW50S2V5cGFkUGFuZWwudmlzaWJsZSA9IG5ld0VudHJ5ICE9PSBudWxsICYmIG5ld0VudHJ5LmlucHV0TWV0aG9kID09PSBJbnB1dE1ldGhvZC5DT05TVEFOVDtcclxuICAgICAgZXhwb25lbnRLZXlwYWRQYW5lbC52aXNpYmxlID0gbmV3RW50cnkgIT09IG51bGwgJiYgbmV3RW50cnkuaW5wdXRNZXRob2QgPT09IElucHV0TWV0aG9kLlRFUk07XHJcbiAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5hcmVhTW9kZWxDb21tb24ucmVnaXN0ZXIoICdHYW1lQXJlYURpc3BsYXlOb2RlJywgR2FtZUFyZWFEaXNwbGF5Tm9kZSApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgR2FtZUFyZWFEaXNwbGF5Tm9kZTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLFFBQVEsTUFBTSxpQ0FBaUM7QUFDdEQsT0FBT0MsV0FBVyxNQUFNLHlDQUF5QztBQUNqRSxTQUFTQyxJQUFJLEVBQUVDLFNBQVMsUUFBUSxtQ0FBbUM7QUFDbkUsT0FBT0MsZUFBZSxNQUFNLDBCQUEwQjtBQUN0RCxPQUFPQyx3QkFBd0IsTUFBTSwwQ0FBMEM7QUFDL0UsT0FBT0MsZUFBZSxNQUFNLHVDQUF1QztBQUNuRSxPQUFPQyxxQkFBcUIsTUFBTSw0Q0FBNEM7QUFDOUUsT0FBT0MsY0FBYyxNQUFNLHFDQUFxQztBQUNoRSxPQUFPQyxzQkFBc0IsTUFBTSw4Q0FBOEM7QUFDakYsT0FBT0MsZUFBZSxNQUFNLHVDQUF1QztBQUNuRSxPQUFPQyxLQUFLLE1BQU0sbUJBQW1CO0FBQ3JDLE9BQU9DLFNBQVMsTUFBTSx1QkFBdUI7QUFDN0MsT0FBT0MsV0FBVyxNQUFNLHlCQUF5QjtBQUNqRCxPQUFPQyxxQkFBcUIsTUFBTSw0QkFBNEI7O0FBRTlEO0FBQ0EsTUFBTUMsY0FBYyxHQUFHLENBQUMsQ0FBQyxDQUFDOztBQUUxQixNQUFNQyxtQkFBbUIsU0FBU2QsSUFBSSxDQUFDO0VBQ3JDO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFZSxXQUFXQSxDQUFFQyxXQUFXLEVBQUVDLG1CQUFtQixFQUFFQyxpQkFBaUIsRUFBRUMsYUFBYSxFQUFHO0lBRWhGLEtBQUssQ0FBQyxDQUFDO0lBRVAsTUFBTUMsWUFBWSxHQUFHakIsd0JBQXdCLENBQUNrQixT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