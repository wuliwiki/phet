// Copyright 2017-2022, University of Colorado Boulder

/**
 * Either a label or an edit readout/button, centered around the origin.
 *
 * NOTE: This type is designed to be persistent, and will not need to release references to avoid memory leaks.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import DynamicProperty from '../../../../axon/js/DynamicProperty.js';
import Multilink from '../../../../axon/js/Multilink.js';
import Property from '../../../../axon/js/Property.js';
import ReadOnlyProperty from '../../../../axon/js/ReadOnlyProperty.js';
import validate from '../../../../axon/js/validate.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import merge from '../../../../phet-core/js/merge.js';
import Orientation from '../../../../phet-core/js/Orientation.js';
import { Node, RichText } from '../../../../scenery/js/imports.js';
import areaModelCommon from '../../areaModelCommon.js';
import AreaModelCommonConstants from '../../common/AreaModelCommonConstants.js';
import AreaModelCommonColors from '../../common/view/AreaModelCommonColors.js';
import TermEditNode from '../../generic/view/TermEditNode.js';
import EntryDisplayType from '../model/EntryDisplayType.js';
import EntryStatus from '../model/EntryStatus.js';
import GameState from '../model/GameState.js';
class GameEditableLabelNode extends Node {
  /**
   * @param {Object} config - See constructor
   */
  constructor(config) {
    config = merge({
      // required
      entryProperty: null,
      // {Property.<Entry>}
      gameStateProperty: null,
      // {Property.<GameState>}
      activeEntryProperty: null,
      // {Property.<Entry|null>}
      colorProperty: null,
      // {Property.<Color>}
      allowExponentsProperty: null,
      // {Property.<boolean>}
      orientation: null,
      // {Orientation}

      // optional
      labelFont: AreaModelCommonConstants.GAME_MAIN_LABEL_FONT,
      editFont: AreaModelCommonConstants.GAME_MAIN_EDIT_FONT
    }, config);
    assert && assert(config.entryProperty instanceof ReadOnlyProperty);
    assert && assert(config.gameStateProperty instanceof ReadOnlyProperty);
    assert && assert(config.activeEntryProperty instanceof ReadOnlyProperty);
    assert && assert(config.colorProperty instanceof ReadOnlyProperty);
    assert && assert(config.allowExponentsProperty instanceof ReadOnlyProperty);
    validate(config.orientation, {
      validValues: Orientation.enumeration.values
    });
    super();

    // Helpful to break out some values
    const entryProperty = config.entryProperty;
    const gameStateProperty = config.gameStateProperty;
    const activeEntryProperty = config.activeEntryProperty;
    const colorProperty = config.colorProperty;
    const allowExponentsProperty = config.allowExponentsProperty;
    const orientation = config.orientation;
    const valueProperty = new DynamicProperty(entryProperty, {
      derive: 'valueProperty',
      bidirectional: true
    });
    const digitsProperty = new DerivedProperty([entryProperty], _.property('digits'));
    const statusProperty = new DynamicProperty(entryProperty, {
      derive: 'statusProperty'
    });
    const isActiveProperty = new DerivedProperty([entryProperty, activeEntryProperty], (entry, activeEntry) => entry === activeEntry);
    const readoutText = new RichText('?', {
      fill: colorProperty,
      font: config.labelFont
    });
    this.addChild(readoutText);
    valueProperty.link(termOrList => {
      readoutText.string = termOrList === null ? '?' : termOrList.toRichString(false);
      readoutText.center = Vector2.ZERO;
    });
    const textColorProperty = new DerivedProperty([statusProperty, colorProperty, AreaModelCommonColors.errorStatusProperty], (highlight, color, errorColor) => {
      if (highlight === EntryStatus.INCORRECT) {
        return errorColor;
      } else {
        return color;
      }
    });
    const borderColorProperty = new DerivedProperty([statusProperty, colorProperty, AreaModelCommonColors.errorStatusProperty, AreaModelCommonColors.dirtyStatusProperty], (highlight, color, errorColor, dirtyColor) => {
      if (highlight === EntryStatus.NORMAL) {
        return color;
      } else if (highlight === EntryStatus.DIRTY) {
        return dirtyColor;
      } else {
        return errorColor;
      }
    });
    const termEditNode = new TermEditNode(new Property(orientation), valueProperty, {
      textColorProperty: textColorProperty,
      borderColorProperty: borderColorProperty,
      isActiveProperty: isActiveProperty,
      digitCountProperty: digitsProperty,
      allowExponentsProperty: allowExponentsProperty,
      editCallback: () => {
        if (gameStateProperty.value === GameState.WRONG_FIRST_ANSWER) {
          gameStateProperty.value = GameState.SECOND_ATTEMPT;
        }
        if (activeEntryProperty.value !== entryProperty.value) {
          activeEntryProperty.value = entryProperty.value;
        } else {
          // Pressing on the edit button when that keypad is already open will instead close the keypad.
          // See https://github.com/phetsims/area-model-common/issues/127
          activeEntryProperty.value = null;
        }
      },
      font: config.editFont
    });
    this.addChild(termEditNode);
    function centerTermEditNode() {
      termEditNode.center = Vector2.ZERO;
    }
    digitsProperty.link(centerTermEditNode);
    allowExponentsProperty.link(centerTermEditNode);
    Multilink.multilink([entryProperty, gameStateProperty], (entry, gameState) => {
      const isReadoutOverride = gameState === GameState.CORRECT_ANSWER || gameState === GameState.SHOW_SOLUTION;
      readoutText.visible = entry.displayType === EntryDisplayType.READOUT || isReadoutOverride && entry.displayType === EntryDisplayType.EDITABLE;
      termEditNode.visible = entry.displayType === EntryDisplayType.EDITABLE && !isReadoutOverride;
    });
  }
}
areaModelCommon.register('GameEditableLabelNode', GameEditableLabelNode);
export default GameEditableLabelNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJEeW5hbWljUHJvcGVydHkiLCJNdWx0aWxpbmsiLCJQcm9wZXJ0eSIsIlJlYWRPbmx5UHJvcGVydHkiLCJ2YWxpZGF0ZSIsIlZlY3RvcjIiLCJtZXJnZSIsIk9yaWVudGF0aW9uIiwiTm9kZSIsIlJpY2hUZXh0IiwiYXJlYU1vZGVsQ29tbW9uIiwiQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzIiwiQXJlYU1vZGVsQ29tbW9uQ29sb3JzIiwiVGVybUVkaXROb2RlIiwiRW50cnlEaXNwbGF5VHlwZSIsIkVudHJ5U3RhdHVzIiwiR2FtZVN0YXRlIiwiR2FtZUVkaXRhYmxlTGFiZWxOb2RlIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJlbnRyeVByb3BlcnR5IiwiZ2FtZVN0YXRlUHJvcGVydHkiLCJhY3RpdmVFbnRyeVByb3BlcnR5IiwiY29sb3JQcm9wZXJ0eSIsImFsbG93RXhwb25lbnRzUHJvcGVydHkiLCJvcmllbnRhdGlvbiIsImxhYmVsRm9udCIsIkdBTUVfTUFJTl9MQUJFTF9GT05UIiwiZWRpdEZvbnQiLCJHQU1FX01BSU5fRURJVF9GT05UIiwiYXNzZXJ0IiwidmFsaWRWYWx1ZXMiLCJlbnVtZXJhdGlvbiIsInZhbHVlcyIsInZhbHVlUHJvcGVydHkiLCJkZXJpdmUiLCJiaWRpcmVjdGlvbmFsIiwiZGlnaXRzUHJvcGVydHkiLCJfIiwicHJvcGVydHkiLCJzdGF0dXNQcm9wZXJ0eSIsImlzQWN0aXZlUHJvcGVydHkiLCJlbnRyeSIsImFjdGl2ZUVudHJ5IiwicmVhZG91dFRleHQiLCJmaWxsIiwiZm9udCIsImFkZENoaWxkIiwibGluayIsInRlcm1Pckxpc3QiLCJzdHJpbmciLCJ0b1JpY2hTdHJpbmciLCJjZW50ZXIiLCJaRVJPIiwidGV4dENvbG9yUHJvcGVydHkiLCJlcnJvclN0YXR1c1Byb3BlcnR5IiwiaGlnaGxpZ2h0IiwiY29sb3IiLCJlcnJvckNvbG9yIiwiSU5DT1JSRUNUIiwiYm9yZGVyQ29sb3JQcm9wZXJ0eSIsImRpcnR5U3RhdHVzUHJvcGVydHkiLCJkaXJ0eUNvbG9yIiwiTk9STUFMIiwiRElSVFkiLCJ0ZXJtRWRpdE5vZGUiLCJkaWdpdENvdW50UHJvcGVydHkiLCJlZGl0Q2FsbGJhY2siLCJ2YWx1ZSIsIldST05HX0ZJUlNUX0FOU1dFUiIsIlNFQ09ORF9BVFRFTVBUIiwiY2VudGVyVGVybUVkaXROb2RlIiwibXVsdGlsaW5rIiwiZ2FtZVN0YXRlIiwiaXNSZWFkb3V0T3ZlcnJpZGUiLCJDT1JSRUNUX0FOU1dFUiIsIlNIT1dfU09MVVRJT04iLCJ2aXNpYmxlIiwiZGlzcGxheVR5cGUiLCJSRUFET1VUIiwiRURJVEFCTEUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkdhbWVFZGl0YWJsZUxhYmVsTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNy0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBFaXRoZXIgYSBsYWJlbCBvciBhbiBlZGl0IHJlYWRvdXQvYnV0dG9uLCBjZW50ZXJlZCBhcm91bmQgdGhlIG9yaWdpbi5cclxuICpcclxuICogTk9URTogVGhpcyB0eXBlIGlzIGRlc2lnbmVkIHRvIGJlIHBlcnNpc3RlbnQsIGFuZCB3aWxsIG5vdCBuZWVkIHRvIHJlbGVhc2UgcmVmZXJlbmNlcyB0byBhdm9pZCBtZW1vcnkgbGVha3MuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IER5bmFtaWNQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0R5bmFtaWNQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCB2YWxpZGF0ZSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL3ZhbGlkYXRlLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IE9yaWVudGF0aW9uIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9PcmllbnRhdGlvbi5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIFJpY2hUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGFyZWFNb2RlbENvbW1vbiBmcm9tICcuLi8uLi9hcmVhTW9kZWxDb21tb24uanMnO1xyXG5pbXBvcnQgQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9BcmVhTW9kZWxDb21tb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgQXJlYU1vZGVsQ29tbW9uQ29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0FyZWFNb2RlbENvbW1vbkNvbG9ycy5qcyc7XHJcbmltcG9ydCBUZXJtRWRpdE5vZGUgZnJvbSAnLi4vLi4vZ2VuZXJpYy92aWV3L1Rlcm1FZGl0Tm9kZS5qcyc7XHJcbmltcG9ydCBFbnRyeURpc3BsYXlUeXBlIGZyb20gJy4uL21vZGVsL0VudHJ5RGlzcGxheVR5cGUuanMnO1xyXG5pbXBvcnQgRW50cnlTdGF0dXMgZnJvbSAnLi4vbW9kZWwvRW50cnlTdGF0dXMuanMnO1xyXG5pbXBvcnQgR2FtZVN0YXRlIGZyb20gJy4uL21vZGVsL0dhbWVTdGF0ZS5qcyc7XHJcblxyXG5jbGFzcyBHYW1lRWRpdGFibGVMYWJlbE5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuICAvKipcclxuICAgKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIC0gU2VlIGNvbnN0cnVjdG9yXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGNvbmZpZyApIHtcclxuXHJcbiAgICBjb25maWcgPSBtZXJnZSgge1xyXG4gICAgICAvLyByZXF1aXJlZFxyXG4gICAgICBlbnRyeVByb3BlcnR5OiBudWxsLCAvLyB7UHJvcGVydHkuPEVudHJ5Pn1cclxuICAgICAgZ2FtZVN0YXRlUHJvcGVydHk6IG51bGwsIC8vIHtQcm9wZXJ0eS48R2FtZVN0YXRlPn1cclxuICAgICAgYWN0aXZlRW50cnlQcm9wZXJ0eTogbnVsbCwgLy8ge1Byb3BlcnR5LjxFbnRyeXxudWxsPn1cclxuICAgICAgY29sb3JQcm9wZXJ0eTogbnVsbCwgLy8ge1Byb3BlcnR5LjxDb2xvcj59XHJcbiAgICAgIGFsbG93RXhwb25lbnRzUHJvcGVydHk6IG51bGwsIC8vIHtQcm9wZXJ0eS48Ym9vbGVhbj59XHJcbiAgICAgIG9yaWVudGF0aW9uOiBudWxsLCAvLyB7T3JpZW50YXRpb259XHJcblxyXG4gICAgICAvLyBvcHRpb25hbFxyXG4gICAgICBsYWJlbEZvbnQ6IEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5HQU1FX01BSU5fTEFCRUxfRk9OVCxcclxuICAgICAgZWRpdEZvbnQ6IEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5HQU1FX01BSU5fRURJVF9GT05UXHJcbiAgICB9LCBjb25maWcgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjb25maWcuZW50cnlQcm9wZXJ0eSBpbnN0YW5jZW9mIFJlYWRPbmx5UHJvcGVydHkgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbmZpZy5nYW1lU3RhdGVQcm9wZXJ0eSBpbnN0YW5jZW9mIFJlYWRPbmx5UHJvcGVydHkgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbmZpZy5hY3RpdmVFbnRyeVByb3BlcnR5IGluc3RhbmNlb2YgUmVhZE9ubHlQcm9wZXJ0eSApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY29uZmlnLmNvbG9yUHJvcGVydHkgaW5zdGFuY2VvZiBSZWFkT25seVByb3BlcnR5ICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjb25maWcuYWxsb3dFeHBvbmVudHNQcm9wZXJ0eSBpbnN0YW5jZW9mIFJlYWRPbmx5UHJvcGVydHkgKTtcclxuICAgIHZhbGlkYXRlKCBjb25maWcub3JpZW50YXRpb24sIHsgdmFsaWRWYWx1ZXM6IE9yaWVudGF0aW9uLmVudW1lcmF0aW9uLnZhbHVlcyB9ICk7XHJcblxyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICAvLyBIZWxwZnVsIHRvIGJyZWFrIG91dCBzb21lIHZhbHVlc1xyXG4gICAgY29uc3QgZW50cnlQcm9wZXJ0eSA9IGNvbmZpZy5lbnRyeVByb3BlcnR5O1xyXG4gICAgY29uc3QgZ2FtZVN0YXRlUHJvcGVydHkgPSBjb25maWcuZ2FtZVN0YXRlUHJvcGVydHk7XHJcbiAgICBjb25zdCBhY3RpdmVFbnRyeVByb3BlcnR5ID0gY29uZmlnLmFjdGl2ZUVudHJ5UHJvcGVydHk7XHJcbiAgICBjb25zdCBjb2xvclByb3BlcnR5ID0gY29uZmlnLmNvbG9yUHJvcGVydHk7XHJcbiAgICBjb25zdCBhbGxvd0V4cG9uZW50c1Byb3BlcnR5ID0gY29uZmlnLmFsbG93RXhwb25lbnRzUHJvcGVydHk7XHJcbiAgICBjb25zdCBvcmllbnRhdGlvbiA9IGNvbmZpZy5vcmllbnRhdGlvbjtcclxuXHJcbiAgICBjb25zdCB2YWx1ZVByb3BlcnR5ID0gbmV3IER5bmFtaWNQcm9wZXJ0eSggZW50cnlQcm9wZXJ0eSwge1xyXG4gICAgICBkZXJpdmU6ICd2YWx1ZVByb3BlcnR5JyxcclxuICAgICAgYmlkaXJlY3Rpb25hbDogdHJ1ZVxyXG4gICAgfSApO1xyXG4gICAgY29uc3QgZGlnaXRzUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIGVudHJ5UHJvcGVydHkgXSwgXy5wcm9wZXJ0eSggJ2RpZ2l0cycgKSApO1xyXG4gICAgY29uc3Qgc3RhdHVzUHJvcGVydHkgPSBuZXcgRHluYW1pY1Byb3BlcnR5KCBlbnRyeVByb3BlcnR5LCB7XHJcbiAgICAgIGRlcml2ZTogJ3N0YXR1c1Byb3BlcnR5J1xyXG4gICAgfSApO1xyXG4gICAgY29uc3QgaXNBY3RpdmVQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgZW50cnlQcm9wZXJ0eSwgYWN0aXZlRW50cnlQcm9wZXJ0eSBdLFxyXG4gICAgICAoIGVudHJ5LCBhY3RpdmVFbnRyeSApID0+IGVudHJ5ID09PSBhY3RpdmVFbnRyeSApO1xyXG5cclxuICAgIGNvbnN0IHJlYWRvdXRUZXh0ID0gbmV3IFJpY2hUZXh0KCAnPycsIHtcclxuICAgICAgZmlsbDogY29sb3JQcm9wZXJ0eSxcclxuICAgICAgZm9udDogY29uZmlnLmxhYmVsRm9udFxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggcmVhZG91dFRleHQgKTtcclxuXHJcbiAgICB2YWx1ZVByb3BlcnR5LmxpbmsoIHRlcm1Pckxpc3QgPT4ge1xyXG4gICAgICByZWFkb3V0VGV4dC5zdHJpbmcgPSB0ZXJtT3JMaXN0ID09PSBudWxsID8gJz8nIDogdGVybU9yTGlzdC50b1JpY2hTdHJpbmcoIGZhbHNlICk7XHJcbiAgICAgIHJlYWRvdXRUZXh0LmNlbnRlciA9IFZlY3RvcjIuWkVSTztcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCB0ZXh0Q29sb3JQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgc3RhdHVzUHJvcGVydHksIGNvbG9yUHJvcGVydHksIEFyZWFNb2RlbENvbW1vbkNvbG9ycy5lcnJvclN0YXR1c1Byb3BlcnR5IF0sXHJcbiAgICAgICggaGlnaGxpZ2h0LCBjb2xvciwgZXJyb3JDb2xvciApID0+IHtcclxuICAgICAgICBpZiAoIGhpZ2hsaWdodCA9PT0gRW50cnlTdGF0dXMuSU5DT1JSRUNUICkge1xyXG4gICAgICAgICAgcmV0dXJuIGVycm9yQ29sb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIGNvbG9yO1xyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG4gICAgY29uc3QgYm9yZGVyQ29sb3JQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFtcclxuICAgICAgc3RhdHVzUHJvcGVydHksXHJcbiAgICAgIGNvbG9yUHJvcGVydHksXHJcbiAgICAgIEFyZWFNb2RlbENvbW1vbkNvbG9ycy5lcnJvclN0YXR1c1Byb3BlcnR5LFxyXG4gICAgICBBcmVhTW9kZWxDb21tb25Db2xvcnMuZGlydHlTdGF0dXNQcm9wZXJ0eVxyXG4gICAgXSwgKCBoaWdobGlnaHQsIGNvbG9yLCBlcnJvckNvbG9yLCBkaXJ0eUNvbG9yICkgPT4ge1xyXG4gICAgICBpZiAoIGhpZ2hsaWdodCA9PT0gRW50cnlTdGF0dXMuTk9STUFMICkge1xyXG4gICAgICAgIHJldHVybiBjb2xvcjtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggaGlnaGxpZ2h0ID09PSBFbnRyeVN0YXR1cy5ESVJUWSApIHtcclxuICAgICAgICByZXR1cm4gZGlydHlDb2xvcjtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZXJyb3JDb2xvcjtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gICAgY29uc3QgdGVybUVkaXROb2RlID0gbmV3IFRlcm1FZGl0Tm9kZSggbmV3IFByb3BlcnR5KCBvcmllbnRhdGlvbiApLCB2YWx1ZVByb3BlcnR5LCB7XHJcbiAgICAgIHRleHRDb2xvclByb3BlcnR5OiB0ZXh0Q29sb3JQcm9wZXJ0eSxcclxuICAgICAgYm9yZGVyQ29sb3JQcm9wZXJ0eTogYm9yZGVyQ29sb3JQcm9wZXJ0eSxcclxuICAgICAgaXNBY3RpdmVQcm9wZXJ0eTogaXNBY3RpdmVQcm9wZXJ0eSxcclxuICAgICAgZGlnaXRDb3VudFByb3BlcnR5OiBkaWdpdHNQcm9wZXJ0eSxcclxuICAgICAgYWxsb3dFeHBvbmVudHNQcm9wZXJ0eTogYWxsb3dFeHBvbmVudHNQcm9wZXJ0eSxcclxuICAgICAgZWRpdENhbGxiYWNrOiAoKSA9PiB7XHJcbiAgICAgICAgaWYgKCBnYW1lU3RhdGVQcm9wZXJ0eS52YWx1ZSA9PT0gR2FtZVN0YXRlLldST05HX0ZJUlNUX0FOU1dFUiApIHtcclxuICAgICAgICAgIGdhbWVTdGF0ZVByb3BlcnR5LnZhbHVlID0gR2FtZVN0YXRlLlNFQ09ORF9BVFRFTVBUO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIGFjdGl2ZUVudHJ5UHJvcGVydHkudmFsdWUgIT09IGVudHJ5UHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgICBhY3RpdmVFbnRyeVByb3BlcnR5LnZhbHVlID0gZW50cnlQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAvLyBQcmVzc2luZyBvbiB0aGUgZWRpdCBidXR0b24gd2hlbiB0aGF0IGtleXBhZCBpcyBhbHJlYWR5IG9wZW4gd2lsbCBpbnN0ZWFkIGNsb3NlIHRoZSBrZXlwYWQuXHJcbiAgICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2FyZWEtbW9kZWwtY29tbW9uL2lzc3Vlcy8xMjdcclxuICAgICAgICAgIGFjdGl2ZUVudHJ5UHJvcGVydHkudmFsdWUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgZm9udDogY29uZmlnLmVkaXRGb250XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0ZXJtRWRpdE5vZGUgKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjZW50ZXJUZXJtRWRpdE5vZGUoKSB7XHJcbiAgICAgIHRlcm1FZGl0Tm9kZS5jZW50ZXIgPSBWZWN0b3IyLlpFUk87XHJcbiAgICB9XHJcblxyXG4gICAgZGlnaXRzUHJvcGVydHkubGluayggY2VudGVyVGVybUVkaXROb2RlICk7XHJcbiAgICBhbGxvd0V4cG9uZW50c1Byb3BlcnR5LmxpbmsoIGNlbnRlclRlcm1FZGl0Tm9kZSApO1xyXG5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFsgZW50cnlQcm9wZXJ0eSwgZ2FtZVN0YXRlUHJvcGVydHkgXSwgKCBlbnRyeSwgZ2FtZVN0YXRlICkgPT4ge1xyXG4gICAgICBjb25zdCBpc1JlYWRvdXRPdmVycmlkZSA9IGdhbWVTdGF0ZSA9PT0gR2FtZVN0YXRlLkNPUlJFQ1RfQU5TV0VSIHx8IGdhbWVTdGF0ZSA9PT0gR2FtZVN0YXRlLlNIT1dfU09MVVRJT047XHJcbiAgICAgIHJlYWRvdXRUZXh0LnZpc2libGUgPSBlbnRyeS5kaXNwbGF5VHlwZSA9PT0gRW50cnlEaXNwbGF5VHlwZS5SRUFET1VUIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIGlzUmVhZG91dE92ZXJyaWRlICYmIGVudHJ5LmRpc3BsYXlUeXBlID09PSBFbnRyeURpc3BsYXlUeXBlLkVESVRBQkxFICk7XHJcbiAgICAgIHRlcm1FZGl0Tm9kZS52aXNpYmxlID0gZW50cnkuZGlzcGxheVR5cGUgPT09IEVudHJ5RGlzcGxheVR5cGUuRURJVEFCTEUgJiYgIWlzUmVhZG91dE92ZXJyaWRlO1xyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxuYXJlYU1vZGVsQ29tbW9uLnJlZ2lzdGVyKCAnR2FtZUVkaXRhYmxlTGFiZWxOb2RlJywgR2FtZUVkaXRhYmxlTGFiZWxOb2RlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBHYW1lRWRpdGFibGVMYWJlbE5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FB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