// Copyright 2017-2022, University of Colorado Boulder

/**
 * Shows the calculation of total area from each of the partitions' sizes. Allows line-by-line, and is meant to go in
 * the panel (not for the "Partition" screen)
 *
 * NOTE: This type is designed to be persistent, and will not need to release references to avoid memory leaks.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import { Shape } from '../../../../kite/js/imports.js';
import { FireListener, Node, Path, Rectangle } from '../../../../scenery/js/imports.js';
import areaModelCommon from '../../areaModelCommon.js';
import AreaModelCommonConstants from '../AreaModelCommonConstants.js';
import AreaCalculationChoice from '../model/AreaCalculationChoice.js';
import AreaModelCommonColors from './AreaModelCommonColors.js';
import CalculationLinesNode from './calculation/CalculationLinesNode.js';

// constants
const MAX_LINE_WIDTH = 680; // may need to be updated if the panel size is changed.
const LINE_BY_LINE_EXPANSION = 25;
const ARROW_SIZE = 18;
const ARROW_TOUCH_DILATION = 8;
class CalculationNode extends Node {
  /**
   * @param {AreaModelCommonModel} model
   * @param {Object} [nodeOptions]
   */
  constructor(model, nodeOptions) {
    super();

    // @private {CalculationLinesNode}
    this.calculationLinesNode = new CalculationLinesNode(model);
    const background = new Rectangle({
      cornerRadius: AreaModelCommonConstants.PANEL_CORNER_RADIUS,
      fill: AreaModelCommonColors.panelBackgroundProperty,
      stroke: AreaModelCommonColors.panelBorderProperty
    });
    this.addChild(background);
    const previousShape = new Shape().moveTo(0, 0).lineTo(ARROW_SIZE, 0).lineTo(ARROW_SIZE / 2, -ARROW_SIZE * 0.8).close();
    const previousArrow = new Path(previousShape, {
      fill: AreaModelCommonColors.calculationArrowUpProperty,
      cursor: 'pointer'
    });
    previousArrow.mouseArea = previousArrow.localBounds;
    previousArrow.touchArea = previousArrow.localBounds.dilated(ARROW_TOUCH_DILATION);
    const previousListener = new FireListener({
      fire: () => {
        this.calculationLinesNode.moveToPreviousLine();
      }
    });
    previousArrow.addInputListener(previousListener);
    this.calculationLinesNode.previousEnabledProperty.link(enabled => {
      previousListener.interrupt();
      previousArrow.pickable = enabled;
      previousArrow.fill = enabled ? AreaModelCommonColors.calculationArrowUpProperty : AreaModelCommonColors.calculationArrowDisabledProperty;
    });
    this.addChild(previousArrow);
    const nextShape = new Shape().moveTo(0, 0).lineTo(ARROW_SIZE, 0).lineTo(ARROW_SIZE / 2, ARROW_SIZE * 0.8).close();
    const nextArrow = new Path(nextShape, {
      fill: AreaModelCommonColors.calculationArrowUpProperty,
      cursor: 'pointer'
    });
    nextArrow.mouseArea = nextArrow.localBounds;
    nextArrow.touchArea = nextArrow.localBounds.dilated(ARROW_TOUCH_DILATION);
    this.addChild(nextArrow);
    const nextListener = new FireListener({
      fire: () => {
        this.calculationLinesNode.moveToNextLine();
      }
    });
    nextArrow.addInputListener(nextListener);
    this.calculationLinesNode.nextEnabledProperty.link(enabled => {
      nextListener.interrupt();
      nextArrow.pickable = enabled;
      nextArrow.fill = enabled ? AreaModelCommonColors.calculationArrowUpProperty : AreaModelCommonColors.calculationArrowDisabledProperty;
    });
    model.areaCalculationChoiceProperty.link(choice => {
      previousArrow.visible = nextArrow.visible = choice === AreaCalculationChoice.LINE_BY_LINE;
    });
    this.mutate(nodeOptions);
    this.addChild(this.calculationLinesNode);
    model.areaCalculationChoiceProperty.link(choice => {
      this.visible = choice !== AreaCalculationChoice.HIDDEN;
    });
    const update = () => {
      if (!this.calculationLinesNode.calculationLinesProperty.value.length) {
        return;
      }
      const isLineByLine = model.areaCalculationChoiceProperty.value === AreaCalculationChoice.LINE_BY_LINE;
      let maxLineWidth = _.reduce(this.calculationLinesNode.calculationLinesProperty.value, (max, line) => Math.max(max, line.node.width), 0);

      // If we are LINE_BY_LINE, we won't have as much room because of the buttons
      const availableLineWidth = MAX_LINE_WIDTH + (isLineByLine ? 0 : LINE_BY_LINE_EXPANSION);

      // Scale the calculation down if necessary, so we can fit within our MAX_LINE_WIDTH
      this.calculationLinesNode.setScaleMagnitude(maxLineWidth > availableLineWidth ? availableLineWidth / maxLineWidth : 1);

      // If we scaled things down, our maxLineWidth will be the available width (we don't want our 'panel' larger)
      maxLineWidth = Math.min(maxLineWidth, availableLineWidth);
      let backgroundBounds = this.calculationLinesNode.bounds;

      // If we removed lines for the "line-by-line", make sure we take up enough room to not change size.
      if (backgroundBounds.width < maxLineWidth) {
        backgroundBounds = backgroundBounds.dilatedX((maxLineWidth - backgroundBounds.width) / 2);
      }

      // Add some space around the lines
      backgroundBounds = backgroundBounds.dilated(5);

      // Add some space for the next/previous buttons
      if (isLineByLine) {
        backgroundBounds.maxX += LINE_BY_LINE_EXPANSION;
      }

      // Minimum width of the area size
      if (backgroundBounds.width < AreaModelCommonConstants.AREA_SIZE) {
        backgroundBounds = backgroundBounds.dilatedX((AreaModelCommonConstants.AREA_SIZE - backgroundBounds.width) / 2);
      }

      // Minimum height
      if (backgroundBounds.height < 120) {
        backgroundBounds = backgroundBounds.dilatedY((120 - backgroundBounds.height) / 2);
      }

      // If we support decimals, use a slightly larger minimum.
      // See https://github.com/phetsims/area-model-decimals/issues/6
      const decimalsLineByLineWidth = AreaModelCommonConstants.AREA_SIZE + 40;
      if (isLineByLine && model.currentAreaProperty.value.partitionSnapSize && model.currentAreaProperty.value.partitionSnapSize < 1 && backgroundBounds.width < decimalsLineByLineWidth) {
        backgroundBounds = backgroundBounds.dilatedX((decimalsLineByLineWidth - backgroundBounds.width) / 2);
      }
      background.rectBounds = backgroundBounds;
      previousArrow.rightTop = backgroundBounds.eroded(5).rightTop;
      nextArrow.rightBottom = backgroundBounds.eroded(5).rightBottom;

      // Empirically determined to be the best Y position given all of the combinations. Hard to determine with
      // computation, so left here.
      this.centerY = 543 - AreaModelCommonConstants.LAYOUT_SPACING;

      // First try to center
      this.centerX = AreaModelCommonConstants.MAIN_AREA_OFFSET.x + AreaModelCommonConstants.AREA_SIZE / 2;
      if (this.left < AreaModelCommonConstants.LAYOUT_SPACING) {
        // If that doesn't work, don't let it go out of bounds left-side.
        this.left = AreaModelCommonConstants.LAYOUT_SPACING;
      }
    };
    this.calculationLinesNode.displayUpdatedEmitter.addListener(update);
    update();
  }

  /**
   * Updates the calculation lines.
   * @public
   */
  update() {
    this.calculationLinesNode.update();
  }
}
areaModelCommon.register('CalculationNode', CalculationNode);
export default CalculationNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaGFwZSIsIkZpcmVMaXN0ZW5lciIsIk5vZGUiLCJQYXRoIiwiUmVjdGFuZ2xlIiwiYXJlYU1vZGVsQ29tbW9uIiwiQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzIiwiQXJlYUNhbGN1bGF0aW9uQ2hvaWNlIiwiQXJlYU1vZGVsQ29tbW9uQ29sb3JzIiwiQ2FsY3VsYXRpb25MaW5lc05vZGUiLCJNQVhfTElORV9XSURUSCIsIkxJTkVfQllfTElORV9FWFBBTlNJT04iLCJBUlJPV19TSVpFIiwiQVJST1dfVE9VQ0hfRElMQVRJT04iLCJDYWxjdWxhdGlvbk5vZGUiLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwibm9kZU9wdGlvbnMiLCJjYWxjdWxhdGlvbkxpbmVzTm9kZSIsImJhY2tncm91bmQiLCJjb3JuZXJSYWRpdXMiLCJQQU5FTF9DT1JORVJfUkFESVVTIiwiZmlsbCIsInBhbmVsQmFja2dyb3VuZFByb3BlcnR5Iiwic3Ryb2tlIiwicGFuZWxCb3JkZXJQcm9wZXJ0eSIsImFkZENoaWxkIiwicHJldmlvdXNTaGFwZSIsIm1vdmVUbyIsImxpbmVUbyIsImNsb3NlIiwicHJldmlvdXNBcnJvdyIsImNhbGN1bGF0aW9uQXJyb3dVcFByb3BlcnR5IiwiY3Vyc29yIiwibW91c2VBcmVhIiwibG9jYWxCb3VuZHMiLCJ0b3VjaEFyZWEiLCJkaWxhdGVkIiwicHJldmlvdXNMaXN0ZW5lciIsImZpcmUiLCJtb3ZlVG9QcmV2aW91c0xpbmUiLCJhZGRJbnB1dExpc3RlbmVyIiwicHJldmlvdXNFbmFibGVkUHJvcGVydHkiLCJsaW5rIiwiZW5hYmxlZCIsImludGVycnVwdCIsInBpY2thYmxlIiwiY2FsY3VsYXRpb25BcnJvd0Rpc2FibGVkUHJvcGVydHkiLCJuZXh0U2hhcGUiLCJuZXh0QXJyb3ciLCJuZXh0TGlzdGVuZXIiLCJtb3ZlVG9OZXh0TGluZSIsIm5leHRFbmFibGVkUHJvcGVydHkiLCJhcmVhQ2FsY3VsYXRpb25DaG9pY2VQcm9wZXJ0eSIsImNob2ljZSIsInZpc2libGUiLCJMSU5FX0JZX0xJTkUiLCJtdXRhdGUiLCJISURERU4iLCJ1cGRhdGUiLCJjYWxjdWxhdGlvbkxpbmVzUHJvcGVydHkiLCJ2YWx1ZSIsImxlbmd0aCIsImlzTGluZUJ5TGluZSIsIm1heExpbmVXaWR0aCIsIl8iLCJyZWR1Y2UiLCJtYXgiLCJsaW5lIiwiTWF0aCIsIm5vZGUiLCJ3aWR0aCIsImF2YWlsYWJsZUxpbmVXaWR0aCIsInNldFNjYWxlTWFnbml0dWRlIiwibWluIiwiYmFja2dyb3VuZEJvdW5kcyIsImJvdW5kcyIsImRpbGF0ZWRYIiwibWF4WCIsIkFSRUFfU0laRSIsImhlaWdodCIsImRpbGF0ZWRZIiwiZGVjaW1hbHNMaW5lQnlMaW5lV2lkdGgiLCJjdXJyZW50QXJlYVByb3BlcnR5IiwicGFydGl0aW9uU25hcFNpemUiLCJyZWN0Qm91bmRzIiwicmlnaHRUb3AiLCJlcm9kZWQiLCJyaWdodEJvdHRvbSIsImNlbnRlclkiLCJMQVlPVVRfU1BBQ0lORyIsImNlbnRlclgiLCJNQUlOX0FSRUFfT0ZGU0VUIiwieCIsImxlZnQiLCJkaXNwbGF5VXBkYXRlZEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQ2FsY3VsYXRpb25Ob2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFNob3dzIHRoZSBjYWxjdWxhdGlvbiBvZiB0b3RhbCBhcmVhIGZyb20gZWFjaCBvZiB0aGUgcGFydGl0aW9ucycgc2l6ZXMuIEFsbG93cyBsaW5lLWJ5LWxpbmUsIGFuZCBpcyBtZWFudCB0byBnbyBpblxyXG4gKiB0aGUgcGFuZWwgKG5vdCBmb3IgdGhlIFwiUGFydGl0aW9uXCIgc2NyZWVuKVxyXG4gKlxyXG4gKiBOT1RFOiBUaGlzIHR5cGUgaXMgZGVzaWduZWQgdG8gYmUgcGVyc2lzdGVudCwgYW5kIHdpbGwgbm90IG5lZWQgdG8gcmVsZWFzZSByZWZlcmVuY2VzIHRvIGF2b2lkIG1lbW9yeSBsZWFrcy5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHsgRmlyZUxpc3RlbmVyLCBOb2RlLCBQYXRoLCBSZWN0YW5nbGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgYXJlYU1vZGVsQ29tbW9uIGZyb20gJy4uLy4uL2FyZWFNb2RlbENvbW1vbi5qcyc7XHJcbmltcG9ydCBBcmVhTW9kZWxDb21tb25Db25zdGFudHMgZnJvbSAnLi4vQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEFyZWFDYWxjdWxhdGlvbkNob2ljZSBmcm9tICcuLi9tb2RlbC9BcmVhQ2FsY3VsYXRpb25DaG9pY2UuanMnO1xyXG5pbXBvcnQgQXJlYU1vZGVsQ29tbW9uQ29sb3JzIGZyb20gJy4vQXJlYU1vZGVsQ29tbW9uQ29sb3JzLmpzJztcclxuaW1wb3J0IENhbGN1bGF0aW9uTGluZXNOb2RlIGZyb20gJy4vY2FsY3VsYXRpb24vQ2FsY3VsYXRpb25MaW5lc05vZGUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE1BWF9MSU5FX1dJRFRIID0gNjgwOyAvLyBtYXkgbmVlZCB0byBiZSB1cGRhdGVkIGlmIHRoZSBwYW5lbCBzaXplIGlzIGNoYW5nZWQuXHJcbmNvbnN0IExJTkVfQllfTElORV9FWFBBTlNJT04gPSAyNTtcclxuY29uc3QgQVJST1dfU0laRSA9IDE4O1xyXG5jb25zdCBBUlJPV19UT1VDSF9ESUxBVElPTiA9IDg7XHJcblxyXG5jbGFzcyBDYWxjdWxhdGlvbk5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuICAvKipcclxuICAgKiBAcGFyYW0ge0FyZWFNb2RlbENvbW1vbk1vZGVsfSBtb2RlbFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbbm9kZU9wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1vZGVsLCBub2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtDYWxjdWxhdGlvbkxpbmVzTm9kZX1cclxuICAgIHRoaXMuY2FsY3VsYXRpb25MaW5lc05vZGUgPSBuZXcgQ2FsY3VsYXRpb25MaW5lc05vZGUoIG1vZGVsICk7XHJcblxyXG4gICAgY29uc3QgYmFja2dyb3VuZCA9IG5ldyBSZWN0YW5nbGUoIHtcclxuICAgICAgY29ybmVyUmFkaXVzOiBBcmVhTW9kZWxDb21tb25Db25zdGFudHMuUEFORUxfQ09STkVSX1JBRElVUyxcclxuICAgICAgZmlsbDogQXJlYU1vZGVsQ29tbW9uQ29sb3JzLnBhbmVsQmFja2dyb3VuZFByb3BlcnR5LFxyXG4gICAgICBzdHJva2U6IEFyZWFNb2RlbENvbW1vbkNvbG9ycy5wYW5lbEJvcmRlclByb3BlcnR5XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBiYWNrZ3JvdW5kICk7XHJcblxyXG4gICAgY29uc3QgcHJldmlvdXNTaGFwZSA9IG5ldyBTaGFwZSgpLm1vdmVUbyggMCwgMCApXHJcbiAgICAgIC5saW5lVG8oIEFSUk9XX1NJWkUsIDAgKVxyXG4gICAgICAubGluZVRvKCBBUlJPV19TSVpFIC8gMiwgLUFSUk9XX1NJWkUgKiAwLjggKVxyXG4gICAgICAuY2xvc2UoKTtcclxuICAgIGNvbnN0IHByZXZpb3VzQXJyb3cgPSBuZXcgUGF0aCggcHJldmlvdXNTaGFwZSwge1xyXG4gICAgICBmaWxsOiBBcmVhTW9kZWxDb21tb25Db2xvcnMuY2FsY3VsYXRpb25BcnJvd1VwUHJvcGVydHksXHJcbiAgICAgIGN1cnNvcjogJ3BvaW50ZXInXHJcbiAgICB9ICk7XHJcbiAgICBwcmV2aW91c0Fycm93Lm1vdXNlQXJlYSA9IHByZXZpb3VzQXJyb3cubG9jYWxCb3VuZHM7XHJcbiAgICBwcmV2aW91c0Fycm93LnRvdWNoQXJlYSA9IHByZXZpb3VzQXJyb3cubG9jYWxCb3VuZHMuZGlsYXRlZCggQVJST1dfVE9VQ0hfRElMQVRJT04gKTtcclxuICAgIGNvbnN0IHByZXZpb3VzTGlzdGVuZXIgPSBuZXcgRmlyZUxpc3RlbmVyKCB7XHJcbiAgICAgIGZpcmU6ICgpID0+IHtcclxuICAgICAgICB0aGlzLmNhbGN1bGF0aW9uTGluZXNOb2RlLm1vdmVUb1ByZXZpb3VzTGluZSgpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICBwcmV2aW91c0Fycm93LmFkZElucHV0TGlzdGVuZXIoIHByZXZpb3VzTGlzdGVuZXIgKTtcclxuICAgIHRoaXMuY2FsY3VsYXRpb25MaW5lc05vZGUucHJldmlvdXNFbmFibGVkUHJvcGVydHkubGluayggZW5hYmxlZCA9PiB7XHJcbiAgICAgIHByZXZpb3VzTGlzdGVuZXIuaW50ZXJydXB0KCk7XHJcbiAgICAgIHByZXZpb3VzQXJyb3cucGlja2FibGUgPSBlbmFibGVkO1xyXG4gICAgICBwcmV2aW91c0Fycm93LmZpbGwgPSBlbmFibGVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgID8gQXJlYU1vZGVsQ29tbW9uQ29sb3JzLmNhbGN1bGF0aW9uQXJyb3dVcFByb3BlcnR5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIDogQXJlYU1vZGVsQ29tbW9uQ29sb3JzLmNhbGN1bGF0aW9uQXJyb3dEaXNhYmxlZFByb3BlcnR5O1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIHByZXZpb3VzQXJyb3cgKTtcclxuICAgIGNvbnN0IG5leHRTaGFwZSA9IG5ldyBTaGFwZSgpLm1vdmVUbyggMCwgMCApXHJcbiAgICAgIC5saW5lVG8oIEFSUk9XX1NJWkUsIDAgKVxyXG4gICAgICAubGluZVRvKCBBUlJPV19TSVpFIC8gMiwgQVJST1dfU0laRSAqIDAuOCApXHJcbiAgICAgIC5jbG9zZSgpO1xyXG4gICAgY29uc3QgbmV4dEFycm93ID0gbmV3IFBhdGgoIG5leHRTaGFwZSwge1xyXG4gICAgICBmaWxsOiBBcmVhTW9kZWxDb21tb25Db2xvcnMuY2FsY3VsYXRpb25BcnJvd1VwUHJvcGVydHksXHJcbiAgICAgIGN1cnNvcjogJ3BvaW50ZXInXHJcbiAgICB9ICk7XHJcbiAgICBuZXh0QXJyb3cubW91c2VBcmVhID0gbmV4dEFycm93LmxvY2FsQm91bmRzO1xyXG4gICAgbmV4dEFycm93LnRvdWNoQXJlYSA9IG5leHRBcnJvdy5sb2NhbEJvdW5kcy5kaWxhdGVkKCBBUlJPV19UT1VDSF9ESUxBVElPTiApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbmV4dEFycm93ICk7XHJcbiAgICBjb25zdCBuZXh0TGlzdGVuZXIgPSBuZXcgRmlyZUxpc3RlbmVyKCB7XHJcbiAgICAgIGZpcmU6ICgpID0+IHtcclxuICAgICAgICB0aGlzLmNhbGN1bGF0aW9uTGluZXNOb2RlLm1vdmVUb05leHRMaW5lKCk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIG5leHRBcnJvdy5hZGRJbnB1dExpc3RlbmVyKCBuZXh0TGlzdGVuZXIgKTtcclxuICAgIHRoaXMuY2FsY3VsYXRpb25MaW5lc05vZGUubmV4dEVuYWJsZWRQcm9wZXJ0eS5saW5rKCBlbmFibGVkID0+IHtcclxuICAgICAgbmV4dExpc3RlbmVyLmludGVycnVwdCgpO1xyXG4gICAgICBuZXh0QXJyb3cucGlja2FibGUgPSBlbmFibGVkO1xyXG4gICAgICBuZXh0QXJyb3cuZmlsbCA9IGVuYWJsZWRcclxuICAgICAgICAgICAgICAgICAgICAgICA/IEFyZWFNb2RlbENvbW1vbkNvbG9ycy5jYWxjdWxhdGlvbkFycm93VXBQcm9wZXJ0eVxyXG4gICAgICAgICAgICAgICAgICAgICAgIDogQXJlYU1vZGVsQ29tbW9uQ29sb3JzLmNhbGN1bGF0aW9uQXJyb3dEaXNhYmxlZFByb3BlcnR5O1xyXG4gICAgfSApO1xyXG5cclxuICAgIG1vZGVsLmFyZWFDYWxjdWxhdGlvbkNob2ljZVByb3BlcnR5LmxpbmsoIGNob2ljZSA9PiB7XHJcbiAgICAgIHByZXZpb3VzQXJyb3cudmlzaWJsZSA9IG5leHRBcnJvdy52aXNpYmxlID0gY2hvaWNlID09PSBBcmVhQ2FsY3VsYXRpb25DaG9pY2UuTElORV9CWV9MSU5FO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMubXV0YXRlKCBub2RlT3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuY2FsY3VsYXRpb25MaW5lc05vZGUgKTtcclxuXHJcbiAgICBtb2RlbC5hcmVhQ2FsY3VsYXRpb25DaG9pY2VQcm9wZXJ0eS5saW5rKCBjaG9pY2UgPT4ge1xyXG4gICAgICB0aGlzLnZpc2libGUgPSBjaG9pY2UgIT09IEFyZWFDYWxjdWxhdGlvbkNob2ljZS5ISURERU47XHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgdXBkYXRlID0gKCkgPT4ge1xyXG4gICAgICBpZiAoICF0aGlzLmNhbGN1bGF0aW9uTGluZXNOb2RlLmNhbGN1bGF0aW9uTGluZXNQcm9wZXJ0eS52YWx1ZS5sZW5ndGggKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBpc0xpbmVCeUxpbmUgPSBtb2RlbC5hcmVhQ2FsY3VsYXRpb25DaG9pY2VQcm9wZXJ0eS52YWx1ZSA9PT0gQXJlYUNhbGN1bGF0aW9uQ2hvaWNlLkxJTkVfQllfTElORTtcclxuICAgICAgbGV0IG1heExpbmVXaWR0aCA9IF8ucmVkdWNlKCB0aGlzLmNhbGN1bGF0aW9uTGluZXNOb2RlLmNhbGN1bGF0aW9uTGluZXNQcm9wZXJ0eS52YWx1ZSwgKCBtYXgsIGxpbmUgKSA9PiBNYXRoLm1heCggbWF4LCBsaW5lLm5vZGUud2lkdGggKSwgMCApO1xyXG5cclxuICAgICAgLy8gSWYgd2UgYXJlIExJTkVfQllfTElORSwgd2Ugd29uJ3QgaGF2ZSBhcyBtdWNoIHJvb20gYmVjYXVzZSBvZiB0aGUgYnV0dG9uc1xyXG4gICAgICBjb25zdCBhdmFpbGFibGVMaW5lV2lkdGggPSBNQVhfTElORV9XSURUSCArICggaXNMaW5lQnlMaW5lID8gMCA6IExJTkVfQllfTElORV9FWFBBTlNJT04gKTtcclxuXHJcbiAgICAgIC8vIFNjYWxlIHRoZSBjYWxjdWxhdGlvbiBkb3duIGlmIG5lY2Vzc2FyeSwgc28gd2UgY2FuIGZpdCB3aXRoaW4gb3VyIE1BWF9MSU5FX1dJRFRIXHJcbiAgICAgIHRoaXMuY2FsY3VsYXRpb25MaW5lc05vZGUuc2V0U2NhbGVNYWduaXR1ZGUoIG1heExpbmVXaWR0aCA+IGF2YWlsYWJsZUxpbmVXaWR0aCA/ICggYXZhaWxhYmxlTGluZVdpZHRoIC8gbWF4TGluZVdpZHRoICkgOiAxICk7XHJcblxyXG4gICAgICAvLyBJZiB3ZSBzY2FsZWQgdGhpbmdzIGRvd24sIG91ciBtYXhMaW5lV2lkdGggd2lsbCBiZSB0aGUgYXZhaWxhYmxlIHdpZHRoICh3ZSBkb24ndCB3YW50IG91ciAncGFuZWwnIGxhcmdlcilcclxuICAgICAgbWF4TGluZVdpZHRoID0gTWF0aC5taW4oIG1heExpbmVXaWR0aCwgYXZhaWxhYmxlTGluZVdpZHRoICk7XHJcblxyXG4gICAgICBsZXQgYmFja2dyb3VuZEJvdW5kcyA9IHRoaXMuY2FsY3VsYXRpb25MaW5lc05vZGUuYm91bmRzO1xyXG5cclxuICAgICAgLy8gSWYgd2UgcmVtb3ZlZCBsaW5lcyBmb3IgdGhlIFwibGluZS1ieS1saW5lXCIsIG1ha2Ugc3VyZSB3ZSB0YWtlIHVwIGVub3VnaCByb29tIHRvIG5vdCBjaGFuZ2Ugc2l6ZS5cclxuICAgICAgaWYgKCBiYWNrZ3JvdW5kQm91bmRzLndpZHRoIDwgbWF4TGluZVdpZHRoICkge1xyXG4gICAgICAgIGJhY2tncm91bmRCb3VuZHMgPSBiYWNrZ3JvdW5kQm91bmRzLmRpbGF0ZWRYKCAoIG1heExpbmVXaWR0aCAtIGJhY2tncm91bmRCb3VuZHMud2lkdGggKSAvIDIgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQWRkIHNvbWUgc3BhY2UgYXJvdW5kIHRoZSBsaW5lc1xyXG4gICAgICBiYWNrZ3JvdW5kQm91bmRzID0gYmFja2dyb3VuZEJvdW5kcy5kaWxhdGVkKCA1ICk7XHJcblxyXG4gICAgICAvLyBBZGQgc29tZSBzcGFjZSBmb3IgdGhlIG5leHQvcHJldmlvdXMgYnV0dG9uc1xyXG4gICAgICBpZiAoIGlzTGluZUJ5TGluZSApIHtcclxuICAgICAgICBiYWNrZ3JvdW5kQm91bmRzLm1heFggKz0gTElORV9CWV9MSU5FX0VYUEFOU0lPTjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gTWluaW11bSB3aWR0aCBvZiB0aGUgYXJlYSBzaXplXHJcbiAgICAgIGlmICggYmFja2dyb3VuZEJvdW5kcy53aWR0aCA8IEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5BUkVBX1NJWkUgKSB7XHJcbiAgICAgICAgYmFja2dyb3VuZEJvdW5kcyA9IGJhY2tncm91bmRCb3VuZHMuZGlsYXRlZFgoICggQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkFSRUFfU0laRSAtIGJhY2tncm91bmRCb3VuZHMud2lkdGggKSAvIDIgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gTWluaW11bSBoZWlnaHRcclxuICAgICAgaWYgKCBiYWNrZ3JvdW5kQm91bmRzLmhlaWdodCA8IDEyMCApIHtcclxuICAgICAgICBiYWNrZ3JvdW5kQm91bmRzID0gYmFja2dyb3VuZEJvdW5kcy5kaWxhdGVkWSggKCAxMjAgLSBiYWNrZ3JvdW5kQm91bmRzLmhlaWdodCApIC8gMiApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBJZiB3ZSBzdXBwb3J0IGRlY2ltYWxzLCB1c2UgYSBzbGlnaHRseSBsYXJnZXIgbWluaW11bS5cclxuICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9hcmVhLW1vZGVsLWRlY2ltYWxzL2lzc3Vlcy82XHJcbiAgICAgIGNvbnN0IGRlY2ltYWxzTGluZUJ5TGluZVdpZHRoID0gQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkFSRUFfU0laRSArIDQwO1xyXG4gICAgICBpZiAoIGlzTGluZUJ5TGluZSAmJlxyXG4gICAgICAgICAgIG1vZGVsLmN1cnJlbnRBcmVhUHJvcGVydHkudmFsdWUucGFydGl0aW9uU25hcFNpemUgJiZcclxuICAgICAgICAgICBtb2RlbC5jdXJyZW50QXJlYVByb3BlcnR5LnZhbHVlLnBhcnRpdGlvblNuYXBTaXplIDwgMSAmJlxyXG4gICAgICAgICAgIGJhY2tncm91bmRCb3VuZHMud2lkdGggPCBkZWNpbWFsc0xpbmVCeUxpbmVXaWR0aCApIHtcclxuICAgICAgICBiYWNrZ3JvdW5kQm91bmRzID0gYmFja2dyb3VuZEJvdW5kcy5kaWxhdGVkWCggKCBkZWNpbWFsc0xpbmVCeUxpbmVXaWR0aCAtIGJhY2tncm91bmRCb3VuZHMud2lkdGggKSAvIDIgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYmFja2dyb3VuZC5yZWN0Qm91bmRzID0gYmFja2dyb3VuZEJvdW5kcztcclxuICAgICAgcHJldmlvdXNBcnJvdy5yaWdodFRvcCA9IGJhY2tncm91bmRCb3VuZHMuZXJvZGVkKCA1ICkucmlnaHRUb3A7XHJcbiAgICAgIG5leHRBcnJvdy5yaWdodEJvdHRvbSA9IGJhY2tncm91bmRCb3VuZHMuZXJvZGVkKCA1ICkucmlnaHRCb3R0b207XHJcblxyXG4gICAgICAvLyBFbXBpcmljYWxseSBkZXRlcm1pbmVkIHRvIGJlIHRoZSBiZXN0IFkgcG9zaXRpb24gZ2l2ZW4gYWxsIG9mIHRoZSBjb21iaW5hdGlvbnMuIEhhcmQgdG8gZGV0ZXJtaW5lIHdpdGhcclxuICAgICAgLy8gY29tcHV0YXRpb24sIHNvIGxlZnQgaGVyZS5cclxuICAgICAgdGhpcy5jZW50ZXJZID0gNTQzIC0gQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkxBWU9VVF9TUEFDSU5HO1xyXG5cclxuICAgICAgLy8gRmlyc3QgdHJ5IHRvIGNlbnRlclxyXG4gICAgICB0aGlzLmNlbnRlclggPSBBcmVhTW9kZWxDb21tb25Db25zdGFudHMuTUFJTl9BUkVBX09GRlNFVC54ICsgQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkFSRUFfU0laRSAvIDI7XHJcbiAgICAgIGlmICggdGhpcy5sZWZ0IDwgQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkxBWU9VVF9TUEFDSU5HICkge1xyXG5cclxuICAgICAgICAvLyBJZiB0aGF0IGRvZXNuJ3Qgd29yaywgZG9uJ3QgbGV0IGl0IGdvIG91dCBvZiBib3VuZHMgbGVmdC1zaWRlLlxyXG4gICAgICAgIHRoaXMubGVmdCA9IEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5MQVlPVVRfU1BBQ0lORztcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmNhbGN1bGF0aW9uTGluZXNOb2RlLmRpc3BsYXlVcGRhdGVkRW1pdHRlci5hZGRMaXN0ZW5lciggdXBkYXRlICk7XHJcbiAgICB1cGRhdGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZXMgdGhlIGNhbGN1bGF0aW9uIGxpbmVzLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICB1cGRhdGUoKSB7XHJcbiAgICB0aGlzLmNhbGN1bGF0aW9uTGluZXNOb2RlLnVwZGF0ZSgpO1xyXG4gIH1cclxufVxyXG5cclxuYXJlYU1vZGVsQ29tbW9uLnJlZ2lzdGVyKCAnQ2FsY3VsYXRpb25Ob2RlJywgQ2FsY3VsYXRpb25Ob2RlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBDYWxjdWxhdGlvbk5vZGU7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTQSxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELFNBQVNDLFlBQVksRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLFNBQVMsUUFBUSxtQ0FBbUM7QUFDdkYsT0FBT0MsZUFBZSxNQUFNLDBCQUEwQjtBQUN0RCxPQUFPQyx3QkFBd0IsTUFBTSxnQ0FBZ0M7QUFDckUsT0FBT0MscUJBQXFC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