// Copyright 2017-2022, University of Colorado Boulder

/**
 * Supertype for view of AreaDisplay objects.
 *
 * NOTE: This type is designed to be persistent, and will not need to release references to avoid memory leaks.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Multilink from '../../../../axon/js/Multilink.js';
import Property from '../../../../axon/js/Property.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import merge from '../../../../phet-core/js/merge.js';
import Orientation from '../../../../phet-core/js/Orientation.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import EraserButton from '../../../../scenery-phet/js/buttons/EraserButton.js';
import { Node, Rectangle } from '../../../../scenery/js/imports.js';
import areaModelCommon from '../../areaModelCommon.js';
import AreaModelCommonStrings from '../../AreaModelCommonStrings.js';
import AreaModelCommonConstants from '../AreaModelCommonConstants.js';
import OrientationPair from '../model/OrientationPair.js';
import PartialProductsChoice from '../model/PartialProductsChoice.js';
import AreaModelCommonColors from './AreaModelCommonColors.js';
import PartialProductLabelNode from './PartialProductLabelNode.js';
import PoolableLayerNode from './PoolableLayerNode.js';
import RangeLabelNode from './RangeLabelNode.js';
const eraseString = AreaModelCommonStrings.a11y.erase;
const eraseDescriptionString = AreaModelCommonStrings.a11y.eraseDescription;
const horizontalDimensionCapitalizedString = AreaModelCommonStrings.a11y.horizontalDimensionCapitalized;
const onePartialProductFactorPatternString = AreaModelCommonStrings.a11y.onePartialProductFactorPattern;
const onePartialProductPatternString = AreaModelCommonStrings.a11y.onePartialProductPattern;
const productTimesPatternString = AreaModelCommonStrings.a11y.productTimesPattern;
const threePartitionsSplitPatternString = AreaModelCommonStrings.a11y.threePartitionsSplitPattern;
const twoPartialProductFactorsPatternString = AreaModelCommonStrings.a11y.twoPartialProductFactorsPattern;
const twoPartialProductsPatternString = AreaModelCommonStrings.a11y.twoPartialProductsPattern;
const twoPartitionsSplitPatternString = AreaModelCommonStrings.a11y.twoPartitionsSplitPattern;
const verticalDimensionCapitalizedString = AreaModelCommonStrings.a11y.verticalDimensionCapitalized;
class AreaDisplayNode extends Node {
  /**
   * @param {AreaDisplay} areaDisplay
   * @param {Property.<PartialProductsChoice>} partialProductsChoiceProperty
   * @param {Object} [options]
   */
  constructor(areaDisplay, partialProductsChoiceProperty, options) {
    options = merge({
      // These do not change for a given AreaDisplayNode
      allowExponents: false,
      isProportional: false,
      useLargeArea: false
    }, options);
    super();

    // @public {AreaDisplay}
    this.areaDisplay = areaDisplay;

    // @public {Node} - Layers (a11y)
    this.pdomParagraphNode = new Node({
      tagName: 'p'
    });
    this.areaLayer = new Node();
    this.labelLayer = new Node();
    this.addChild(this.pdomParagraphNode);
    this.addChild(this.areaLayer);
    this.addChild(this.labelLayer);

    // @public {number}
    this.viewSize = options.useLargeArea ? AreaModelCommonConstants.LARGE_AREA_SIZE : AreaModelCommonConstants.AREA_SIZE;

    // A11y description for the partitions for each orientation
    const accessiblePartitionNodes = OrientationPair.create(orientation => {
      const partitionLabel = new Node({
        tagName: 'span'
      });
      Multilink.multilink([areaDisplay.partitionsProperties.get(orientation), areaDisplay.totalProperties.get(orientation)], (partitions, total) => {
        partitions = partitions.filter(partition => partition.sizeProperty.value !== null && partition.visibleProperty.value === true);
        if (partitions.length < 2 || total === null) {
          partitionLabel.innerContent = '';
        } else if (partitions.length === 2) {
          partitionLabel.innerContent = StringUtils.fillIn(twoPartitionsSplitPatternString, {
            partition: orientation === Orientation.HORIZONTAL ? horizontalDimensionCapitalizedString : verticalDimensionCapitalizedString,
            size: total.toRichString(),
            size1: partitions[0].sizeProperty.value.toRichString(false),
            size2: partitions[1].sizeProperty.value.toRichString(false)
          });
        } else if (partitions.length === 3) {
          partitionLabel.innerContent = StringUtils.fillIn(threePartitionsSplitPatternString, {
            partition: orientation === Orientation.HORIZONTAL ? horizontalDimensionCapitalizedString : verticalDimensionCapitalizedString,
            size: total.toRichString(),
            size1: partitions[0].sizeProperty.value.toRichString(false),
            size2: partitions[1].sizeProperty.value.toRichString(false),
            size3: partitions[2].sizeProperty.value.toRichString(false)
          });
        } else {
          throw new Error('unexpected number of partitions for a11y');
        }
      });
      return partitionLabel;
    });
    this.pdomParagraphNode.addChild(accessiblePartitionNodes.vertical);
    this.pdomParagraphNode.addChild(accessiblePartitionNodes.horizontal);

    // A11y description for the partial products
    const accessiblePartialProductNode = new Node({
      tagName: 'span'
    });
    let accessiblePartialMultilink = null;
    areaDisplay.partitionedAreasProperty.link(partitionedAreas => {
      if (accessiblePartialMultilink) {
        accessiblePartialMultilink.dispose();
      }
      const properties = [partialProductsChoiceProperty].concat(partitionedAreas.map(partitionedArea => partitionedArea.areaProperty)).concat(partitionedAreas.map(partitionedArea => partitionedArea.visibleProperty));
      accessiblePartialMultilink = Multilink.multilink(properties, () => {
        const activePartitionedAreas = areaDisplay.partitionedAreasProperty.value.filter(partitionedArea => partitionedArea.visibleProperty.value && partitionedArea.areaProperty.value !== null && partitionedArea.partitions.vertical.sizeProperty.value !== null && partitionedArea.partitions.horizontal.sizeProperty.value !== null);
        const fillObject = {};
        let fillString;
        if (activePartitionedAreas.length > 2 || activePartitionedAreas.length === 0 || partialProductsChoiceProperty.value === PartialProductsChoice.HIDDEN) {
          accessiblePartialProductNode.innerContent = '';
        } else if (partialProductsChoiceProperty.value === PartialProductsChoice.PRODUCTS) {
          fillString = onePartialProductPatternString;
          fillObject.first = activePartitionedAreas[0].areaProperty.value.toRichString(false);
          if (activePartitionedAreas.length === 2) {
            fillString = twoPartialProductsPatternString;
            fillObject.second = activePartitionedAreas[1].areaProperty.value.toRichString(false);
          }
          accessiblePartialProductNode.innerContent = StringUtils.fillIn(fillString, fillObject);
        } else if (partialProductsChoiceProperty.value === PartialProductsChoice.FACTORS) {
          fillString = onePartialProductFactorPatternString;
          fillObject.first = StringUtils.fillIn(productTimesPatternString, {
            left: activePartitionedAreas[0].partitions.vertical.sizeProperty.value.toRichString(false),
            right: activePartitionedAreas[0].partitions.horizontal.sizeProperty.value.toRichString(false)
          });
          if (activePartitionedAreas.length === 2) {
            fillString = twoPartialProductFactorsPatternString;
            fillObject.second = StringUtils.fillIn(productTimesPatternString, {
              left: activePartitionedAreas[1].partitions.vertical.sizeProperty.value.toRichString(false),
              right: activePartitionedAreas[1].partitions.horizontal.sizeProperty.value.toRichString(false)
            });
          }
          accessiblePartialProductNode.innerContent = StringUtils.fillIn(fillString, fillObject);
        } else {
          throw new Error('unknown situation for a11y partial products');
        }
      });
    });
    this.pdomParagraphNode.addChild(accessiblePartialProductNode);
    const modelBoundsProperty = new DerivedProperty([areaDisplay.coordinateRangeMaxProperty], coordinateRangeMax => new Bounds2(0, 0, coordinateRangeMax, coordinateRangeMax));
    const viewBounds = new Bounds2(0, 0, this.viewSize, this.viewSize);

    // @protected {Property.<ModelViewTransform2>} - Maps from coordinate range values to view values.
    this.modelViewTransformProperty = new DerivedProperty([modelBoundsProperty], modelBounds => ModelViewTransform2.createRectangleMapping(modelBounds, viewBounds));

    // Dimension line views
    Orientation.enumeration.values.forEach(orientation => {
      const colorProperty = this.areaDisplay.colorProperties.get(orientation);
      const termListProperty = this.areaDisplay.displayProperties.get(orientation);
      const tickPositionsProperty = new DerivedProperty([areaDisplay.partitionBoundariesProperties.get(orientation)], partitionBoundaries => partitionBoundaries.map(boundary => orientation.modelToView(this.modelViewTransformProperty.value, boundary)));
      this.labelLayer.addChild(new RangeLabelNode(termListProperty, orientation, tickPositionsProperty, colorProperty, options.isProportional));
    });

    // @private {boolean} - Whether we need to update the labels. It's expensive, so we only do it at most once a frame.
    this.productPositionLabelsDirty = true;
    const invalidateProductLabels = () => {
      this.productPositionLabelsDirty = true;
    };

    // @protected {Array.<PartialProductLabelNode>}
    this.productLabels = [];

    // Create pooled partial product labels
    this.labelLayer.addChild(new PoolableLayerNode({
      usedArray: this.productLabels,
      updatedCallback: invalidateProductLabels,
      arrayProperty: areaDisplay.partitionedAreasProperty,
      createNode: partitionedArea => new PartialProductLabelNode(partialProductsChoiceProperty, new Property(partitionedArea), options.allowExponents),
      getItemProperty: productLabel => productLabel.partitionedAreaProperty
    }));

    // Note this needs to be linked after the product labels are created, so the order dependency works
    areaDisplay.allPartitionsProperty.link((newAllPartitions, oldAllPartitions) => {
      oldAllPartitions && oldAllPartitions.forEach(partition => {
        partition.coordinateRangeProperty.unlink(invalidateProductLabels);
      });
      newAllPartitions.forEach(partition => {
        partition.coordinateRangeProperty.lazyLink(invalidateProductLabels);
      });
      invalidateProductLabels();
    });

    // Also invalidate our label positions when the label type changes.
    // See https://github.com/phetsims/area-model-common/issues/109
    partialProductsChoiceProperty.lazyLink(invalidateProductLabels);

    // Do it once initially for proper layout at the start
    this.positionProductLabels();

    // @public {Node} - Exposed publicly for a11y, and used in subclasses
    this.eraseButton = new EraserButton({
      listener: () => {
        areaDisplay.areaProperty.value.erase();
      },
      center: options.isProportional ? AreaModelCommonConstants.PROPORTIONAL_RANGE_OFFSET : AreaModelCommonConstants.GENERIC_RANGE_OFFSET,
      touchAreaXDilation: 8,
      touchAreaYDilation: 8,
      // pdom
      innerContent: eraseString,
      descriptionContent: eraseDescriptionString
    });

    // @protected {Node}
    this.backgroundNode = new Rectangle(0, 0, this.viewSize, this.viewSize, {
      fill: AreaModelCommonColors.areaBackgroundProperty
    });

    // @protected {Node}
    this.borderNode = new Rectangle(0, 0, this.viewSize, this.viewSize, {
      stroke: AreaModelCommonColors.areaBorderProperty
    });
    this.labelLayer.addChild(this.eraseButton);
  }

  /**
   * Updates expensive-to-update things only once a frame (for performance).
   * @public
   */
  update() {
    if (!this.productPositionLabelsDirty) {
      return;
    }
    this.productPositionLabelsDirty = false;
    this.positionProductLabels();
  }

  /**
   * Positions all of the partial products labels.
   * @protected
   */
  positionProductLabels() {
    throw new Error('abstract method');
  }
}
areaModelCommon.register('AreaDisplayNode', AreaDisplayNode);
export default AreaDisplayNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJNdWx0aWxpbmsiLCJQcm9wZXJ0eSIsIkJvdW5kczIiLCJtZXJnZSIsIk9yaWVudGF0aW9uIiwiU3RyaW5nVXRpbHMiLCJNb2RlbFZpZXdUcmFuc2Zvcm0yIiwiRXJhc2VyQnV0dG9uIiwiTm9kZSIsIlJlY3RhbmdsZSIsImFyZWFNb2RlbENvbW1vbiIsIkFyZWFNb2RlbENvbW1vblN0cmluZ3MiLCJBcmVhTW9kZWxDb21tb25Db25zdGFudHMiLCJPcmllbnRhdGlvblBhaXIiLCJQYXJ0aWFsUHJvZHVjdHNDaG9pY2UiLCJBcmVhTW9kZWxDb21tb25Db2xvcnMiLCJQYXJ0aWFsUHJvZHVjdExhYmVsTm9kZSIsIlBvb2xhYmxlTGF5ZXJOb2RlIiwiUmFuZ2VMYWJlbE5vZGUiLCJlcmFzZVN0cmluZyIsImExMXkiLCJlcmFzZSIsImVyYXNlRGVzY3JpcHRpb25TdHJpbmciLCJlcmFzZURlc2NyaXB0aW9uIiwiaG9yaXpvbnRhbERpbWVuc2lvbkNhcGl0YWxpemVkU3RyaW5nIiwiaG9yaXpvbnRhbERpbWVuc2lvbkNhcGl0YWxpemVkIiwib25lUGFydGlhbFByb2R1Y3RGYWN0b3JQYXR0ZXJuU3RyaW5nIiwib25lUGFydGlhbFByb2R1Y3RGYWN0b3JQYXR0ZXJuIiwib25lUGFydGlhbFByb2R1Y3RQYXR0ZXJuU3RyaW5nIiwib25lUGFydGlhbFByb2R1Y3RQYXR0ZXJuIiwicHJvZHVjdFRpbWVzUGF0dGVyblN0cmluZyIsInByb2R1Y3RUaW1lc1BhdHRlcm4iLCJ0aHJlZVBhcnRpdGlvbnNTcGxpdFBhdHRlcm5TdHJpbmciLCJ0aHJlZVBhcnRpdGlvbnNTcGxpdFBhdHRlcm4iLCJ0d29QYXJ0aWFsUHJvZHVjdEZhY3RvcnNQYXR0ZXJuU3RyaW5nIiwidHdvUGFydGlhbFByb2R1Y3RGYWN0b3JzUGF0dGVybiIsInR3b1BhcnRpYWxQcm9kdWN0c1BhdHRlcm5TdHJpbmciLCJ0d29QYXJ0aWFsUHJvZHVjdHNQYXR0ZXJuIiwidHdvUGFydGl0aW9uc1NwbGl0UGF0dGVyblN0cmluZyIsInR3b1BhcnRpdGlvbnNTcGxpdFBhdHRlcm4iLCJ2ZXJ0aWNhbERpbWVuc2lvbkNhcGl0YWxpemVkU3RyaW5nIiwidmVydGljYWxEaW1lbnNpb25DYXBpdGFsaXplZCIsIkFyZWFEaXNwbGF5Tm9kZSIsImNvbnN0cnVjdG9yIiwiYXJlYURpc3BsYXkiLCJwYXJ0aWFsUHJvZHVjdHNDaG9pY2VQcm9wZXJ0eSIsIm9wdGlvbnMiLCJhbGxvd0V4cG9uZW50cyIsImlzUHJvcG9ydGlvbmFsIiwidXNlTGFyZ2VBcmVhIiwicGRvbVBhcmFncmFwaE5vZGUiLCJ0YWdOYW1lIiwiYXJlYUxheWVyIiwibGFiZWxMYXllciIsImFkZENoaWxkIiwidmlld1NpemUiLCJMQVJHRV9BUkVBX1NJWkUiLCJBUkVBX1NJWkUiLCJhY2Nlc3NpYmxlUGFydGl0aW9uTm9kZXMiLCJjcmVhdGUiLCJvcmllbnRhdGlvbiIsInBhcnRpdGlvbkxhYmVsIiwibXVsdGlsaW5rIiwicGFydGl0aW9uc1Byb3BlcnRpZXMiLCJnZXQiLCJ0b3RhbFByb3BlcnRpZXMiLCJwYXJ0aXRpb25zIiwidG90YWwiLCJmaWx0ZXIiLCJwYXJ0aXRpb24iLCJzaXplUHJvcGVydHkiLCJ2YWx1ZSIsInZpc2libGVQcm9wZXJ0eSIsImxlbmd0aCIsImlubmVyQ29udGVudCIsImZpbGxJbiIsIkhPUklaT05UQUwiLCJzaXplIiwidG9SaWNoU3RyaW5nIiwic2l6ZTEiLCJzaXplMiIsInNpemUzIiwiRXJyb3IiLCJ2ZXJ0aWNhbCIsImhvcml6b250YWwiLCJhY2Nlc3NpYmxlUGFydGlhbFByb2R1Y3ROb2RlIiwiYWNjZXNzaWJsZVBhcnRpYWxNdWx0aWxpbmsiLCJwYXJ0aXRpb25lZEFyZWFzUHJvcGVydHkiLCJsaW5rIiwicGFydGl0aW9uZWRBcmVhcyIsImRpc3Bvc2UiLCJwcm9wZXJ0aWVzIiwiY29uY2F0IiwibWFwIiwicGFydGl0aW9uZWRBcmVhIiwiYXJlYVByb3BlcnR5IiwiYWN0aXZlUGFydGl0aW9uZWRBcmVhcyIsImZpbGxPYmplY3QiLCJmaWxsU3RyaW5nIiwiSElEREVOIiwiUFJPRFVDVFMiLCJmaXJzdCIsInNlY29uZCIsIkZBQ1RPUlMiLCJsZWZ0IiwicmlnaHQiLCJtb2RlbEJvdW5kc1Byb3BlcnR5IiwiY29vcmRpbmF0ZVJhbmdlTWF4UHJvcGVydHkiLCJjb29yZGluYXRlUmFuZ2VNYXgiLCJ2aWV3Qm91bmRzIiwibW9kZWxWaWV3VHJhbnNmb3JtUHJvcGVydHkiLCJtb2RlbEJvdW5kcyIsImNyZWF0ZVJlY3RhbmdsZU1hcHBpbmciLCJlbnVtZXJhdGlvbiIsInZhbHVlcyIsImZvckVhY2giLCJjb2xvclByb3BlcnR5IiwiY29sb3JQcm9wZXJ0aWVzIiwidGVybUxpc3RQcm9wZXJ0eSIsImRpc3BsYXlQcm9wZXJ0aWVzIiwidGlja1Bvc2l0aW9uc1Byb3BlcnR5IiwicGFydGl0aW9uQm91bmRhcmllc1Byb3BlcnRpZXMiLCJwYXJ0aXRpb25Cb3VuZGFyaWVzIiwiYm91bmRhcnkiLCJtb2RlbFRvVmlldyIsInByb2R1Y3RQb3NpdGlvbkxhYmVsc0RpcnR5IiwiaW52YWxpZGF0ZVByb2R1Y3RMYWJlbHMiLCJwcm9kdWN0TGFiZWxzIiwidXNlZEFycmF5IiwidXBkYXRlZENhbGxiYWNrIiwiYXJyYXlQcm9wZXJ0eSIsImNyZWF0ZU5vZGUiLCJnZXRJdGVtUHJvcGVydHkiLCJwcm9kdWN0TGFiZWwiLCJwYXJ0aXRpb25lZEFyZWFQcm9wZXJ0eSIsImFsbFBhcnRpdGlvbnNQcm9wZXJ0eSIsIm5ld0FsbFBhcnRpdGlvbnMiLCJvbGRBbGxQYXJ0aXRpb25zIiwiY29vcmRpbmF0ZVJhbmdlUHJvcGVydHkiLCJ1bmxpbmsiLCJsYXp5TGluayIsInBvc2l0aW9uUHJvZHVjdExhYmVscyIsImVyYXNlQnV0dG9uIiwibGlzdGVuZXIiLCJjZW50ZXIiLCJQUk9QT1JUSU9OQUxfUkFOR0VfT0ZGU0VUIiwiR0VORVJJQ19SQU5HRV9PRkZTRVQiLCJ0b3VjaEFyZWFYRGlsYXRpb24iLCJ0b3VjaEFyZWFZRGlsYXRpb24iLCJkZXNjcmlwdGlvbkNvbnRlbnQiLCJiYWNrZ3JvdW5kTm9kZSIsImZpbGwiLCJhcmVhQmFja2dyb3VuZFByb3BlcnR5IiwiYm9yZGVyTm9kZSIsInN0cm9rZSIsImFyZWFCb3JkZXJQcm9wZXJ0eSIsInVwZGF0ZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQXJlYURpc3BsYXlOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFN1cGVydHlwZSBmb3IgdmlldyBvZiBBcmVhRGlzcGxheSBvYmplY3RzLlxyXG4gKlxyXG4gKiBOT1RFOiBUaGlzIHR5cGUgaXMgZGVzaWduZWQgdG8gYmUgcGVyc2lzdGVudCwgYW5kIHdpbGwgbm90IG5lZWQgdG8gcmVsZWFzZSByZWZlcmVuY2VzIHRvIGF2b2lkIG1lbW9yeSBsZWFrcy5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgT3JpZW50YXRpb24gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL09yaWVudGF0aW9uLmpzJztcclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCBNb2RlbFZpZXdUcmFuc2Zvcm0yIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdmlldy9Nb2RlbFZpZXdUcmFuc2Zvcm0yLmpzJztcclxuaW1wb3J0IEVyYXNlckJ1dHRvbiBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvYnV0dG9ucy9FcmFzZXJCdXR0b24uanMnO1xyXG5pbXBvcnQgeyBOb2RlLCBSZWN0YW5nbGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgYXJlYU1vZGVsQ29tbW9uIGZyb20gJy4uLy4uL2FyZWFNb2RlbENvbW1vbi5qcyc7XHJcbmltcG9ydCBBcmVhTW9kZWxDb21tb25TdHJpbmdzIGZyb20gJy4uLy4uL0FyZWFNb2RlbENvbW1vblN0cmluZ3MuanMnO1xyXG5pbXBvcnQgQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzIGZyb20gJy4uL0FyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBPcmllbnRhdGlvblBhaXIgZnJvbSAnLi4vbW9kZWwvT3JpZW50YXRpb25QYWlyLmpzJztcclxuaW1wb3J0IFBhcnRpYWxQcm9kdWN0c0Nob2ljZSBmcm9tICcuLi9tb2RlbC9QYXJ0aWFsUHJvZHVjdHNDaG9pY2UuanMnO1xyXG5pbXBvcnQgQXJlYU1vZGVsQ29tbW9uQ29sb3JzIGZyb20gJy4vQXJlYU1vZGVsQ29tbW9uQ29sb3JzLmpzJztcclxuaW1wb3J0IFBhcnRpYWxQcm9kdWN0TGFiZWxOb2RlIGZyb20gJy4vUGFydGlhbFByb2R1Y3RMYWJlbE5vZGUuanMnO1xyXG5pbXBvcnQgUG9vbGFibGVMYXllck5vZGUgZnJvbSAnLi9Qb29sYWJsZUxheWVyTm9kZS5qcyc7XHJcbmltcG9ydCBSYW5nZUxhYmVsTm9kZSBmcm9tICcuL1JhbmdlTGFiZWxOb2RlLmpzJztcclxuXHJcbmNvbnN0IGVyYXNlU3RyaW5nID0gQXJlYU1vZGVsQ29tbW9uU3RyaW5ncy5hMTF5LmVyYXNlO1xyXG5jb25zdCBlcmFzZURlc2NyaXB0aW9uU3RyaW5nID0gQXJlYU1vZGVsQ29tbW9uU3RyaW5ncy5hMTF5LmVyYXNlRGVzY3JpcHRpb247XHJcbmNvbnN0IGhvcml6b250YWxEaW1lbnNpb25DYXBpdGFsaXplZFN0cmluZyA9IEFyZWFNb2RlbENvbW1vblN0cmluZ3MuYTExeS5ob3Jpem9udGFsRGltZW5zaW9uQ2FwaXRhbGl6ZWQ7XHJcbmNvbnN0IG9uZVBhcnRpYWxQcm9kdWN0RmFjdG9yUGF0dGVyblN0cmluZyA9IEFyZWFNb2RlbENvbW1vblN0cmluZ3MuYTExeS5vbmVQYXJ0aWFsUHJvZHVjdEZhY3RvclBhdHRlcm47XHJcbmNvbnN0IG9uZVBhcnRpYWxQcm9kdWN0UGF0dGVyblN0cmluZyA9IEFyZWFNb2RlbENvbW1vblN0cmluZ3MuYTExeS5vbmVQYXJ0aWFsUHJvZHVjdFBhdHRlcm47XHJcbmNvbnN0IHByb2R1Y3RUaW1lc1BhdHRlcm5TdHJpbmcgPSBBcmVhTW9kZWxDb21tb25TdHJpbmdzLmExMXkucHJvZHVjdFRpbWVzUGF0dGVybjtcclxuY29uc3QgdGhyZWVQYXJ0aXRpb25zU3BsaXRQYXR0ZXJuU3RyaW5nID0gQXJlYU1vZGVsQ29tbW9uU3RyaW5ncy5hMTF5LnRocmVlUGFydGl0aW9uc1NwbGl0UGF0dGVybjtcclxuY29uc3QgdHdvUGFydGlhbFByb2R1Y3RGYWN0b3JzUGF0dGVyblN0cmluZyA9IEFyZWFNb2RlbENvbW1vblN0cmluZ3MuYTExeS50d29QYXJ0aWFsUHJvZHVjdEZhY3RvcnNQYXR0ZXJuO1xyXG5jb25zdCB0d29QYXJ0aWFsUHJvZHVjdHNQYXR0ZXJuU3RyaW5nID0gQXJlYU1vZGVsQ29tbW9uU3RyaW5ncy5hMTF5LnR3b1BhcnRpYWxQcm9kdWN0c1BhdHRlcm47XHJcbmNvbnN0IHR3b1BhcnRpdGlvbnNTcGxpdFBhdHRlcm5TdHJpbmcgPSBBcmVhTW9kZWxDb21tb25TdHJpbmdzLmExMXkudHdvUGFydGl0aW9uc1NwbGl0UGF0dGVybjtcclxuY29uc3QgdmVydGljYWxEaW1lbnNpb25DYXBpdGFsaXplZFN0cmluZyA9IEFyZWFNb2RlbENvbW1vblN0cmluZ3MuYTExeS52ZXJ0aWNhbERpbWVuc2lvbkNhcGl0YWxpemVkO1xyXG5cclxuY2xhc3MgQXJlYURpc3BsYXlOb2RlIGV4dGVuZHMgTm9kZSB7XHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtBcmVhRGlzcGxheX0gYXJlYURpc3BsYXlcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5LjxQYXJ0aWFsUHJvZHVjdHNDaG9pY2U+fSBwYXJ0aWFsUHJvZHVjdHNDaG9pY2VQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggYXJlYURpc3BsYXksIHBhcnRpYWxQcm9kdWN0c0Nob2ljZVByb3BlcnR5LCBvcHRpb25zICkge1xyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcblxyXG4gICAgICAvLyBUaGVzZSBkbyBub3QgY2hhbmdlIGZvciBhIGdpdmVuIEFyZWFEaXNwbGF5Tm9kZVxyXG4gICAgICBhbGxvd0V4cG9uZW50czogZmFsc2UsXHJcbiAgICAgIGlzUHJvcG9ydGlvbmFsOiBmYWxzZSxcclxuICAgICAgdXNlTGFyZ2VBcmVhOiBmYWxzZVxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7QXJlYURpc3BsYXl9XHJcbiAgICB0aGlzLmFyZWFEaXNwbGF5ID0gYXJlYURpc3BsYXk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7Tm9kZX0gLSBMYXllcnMgKGExMXkpXHJcbiAgICB0aGlzLnBkb21QYXJhZ3JhcGhOb2RlID0gbmV3IE5vZGUoIHtcclxuICAgICAgdGFnTmFtZTogJ3AnXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFyZWFMYXllciA9IG5ldyBOb2RlKCk7XHJcbiAgICB0aGlzLmxhYmVsTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMucGRvbVBhcmFncmFwaE5vZGUgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuYXJlYUxheWVyICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLmxhYmVsTGF5ZXIgKTtcclxuXHJcbiAgICAvLyBAcHVibGljIHtudW1iZXJ9XHJcbiAgICB0aGlzLnZpZXdTaXplID0gb3B0aW9ucy51c2VMYXJnZUFyZWEgPyBBcmVhTW9kZWxDb21tb25Db25zdGFudHMuTEFSR0VfQVJFQV9TSVpFIDogQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkFSRUFfU0laRTtcclxuXHJcbiAgICAvLyBBMTF5IGRlc2NyaXB0aW9uIGZvciB0aGUgcGFydGl0aW9ucyBmb3IgZWFjaCBvcmllbnRhdGlvblxyXG4gICAgY29uc3QgYWNjZXNzaWJsZVBhcnRpdGlvbk5vZGVzID0gT3JpZW50YXRpb25QYWlyLmNyZWF0ZSggb3JpZW50YXRpb24gPT4ge1xyXG4gICAgICBjb25zdCBwYXJ0aXRpb25MYWJlbCA9IG5ldyBOb2RlKCB7XHJcbiAgICAgICAgdGFnTmFtZTogJ3NwYW4nXHJcbiAgICAgIH0gKTtcclxuICAgICAgTXVsdGlsaW5rLm11bHRpbGluayggW1xyXG4gICAgICAgIGFyZWFEaXNwbGF5LnBhcnRpdGlvbnNQcm9wZXJ0aWVzLmdldCggb3JpZW50YXRpb24gKSxcclxuICAgICAgICBhcmVhRGlzcGxheS50b3RhbFByb3BlcnRpZXMuZ2V0KCBvcmllbnRhdGlvbiApXHJcbiAgICAgIF0sICggcGFydGl0aW9ucywgdG90YWwgKSA9PiB7XHJcbiAgICAgICAgcGFydGl0aW9ucyA9IHBhcnRpdGlvbnMuZmlsdGVyKCBwYXJ0aXRpb24gPT4gcGFydGl0aW9uLnNpemVQcm9wZXJ0eS52YWx1ZSAhPT0gbnVsbCAmJiBwYXJ0aXRpb24udmlzaWJsZVByb3BlcnR5LnZhbHVlID09PSB0cnVlICk7XHJcbiAgICAgICAgaWYgKCBwYXJ0aXRpb25zLmxlbmd0aCA8IDIgfHwgdG90YWwgPT09IG51bGwgKSB7XHJcbiAgICAgICAgICBwYXJ0aXRpb25MYWJlbC5pbm5lckNvbnRlbnQgPSAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIHBhcnRpdGlvbnMubGVuZ3RoID09PSAyICkge1xyXG4gICAgICAgICAgcGFydGl0aW9uTGFiZWwuaW5uZXJDb250ZW50ID0gU3RyaW5nVXRpbHMuZmlsbEluKCB0d29QYXJ0aXRpb25zU3BsaXRQYXR0ZXJuU3RyaW5nLCB7XHJcbiAgICAgICAgICAgIHBhcnRpdGlvbjogb3JpZW50YXRpb24gPT09IE9yaWVudGF0aW9uLkhPUklaT05UQUwgPyBob3Jpem9udGFsRGltZW5zaW9uQ2FwaXRhbGl6ZWRTdHJpbmcgOiB2ZXJ0aWNhbERpbWVuc2lvbkNhcGl0YWxpemVkU3RyaW5nLFxyXG4gICAgICAgICAgICBzaXplOiB0b3RhbC50b1JpY2hTdHJpbmcoKSxcclxuICAgICAgICAgICAgc2l6ZTE6IHBhcnRpdGlvbnNbIDAgXS5zaXplUHJvcGVydHkudmFsdWUudG9SaWNoU3RyaW5nKCBmYWxzZSApLFxyXG4gICAgICAgICAgICBzaXplMjogcGFydGl0aW9uc1sgMSBdLnNpemVQcm9wZXJ0eS52YWx1ZS50b1JpY2hTdHJpbmcoIGZhbHNlIClcclxuICAgICAgICAgIH0gKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIHBhcnRpdGlvbnMubGVuZ3RoID09PSAzICkge1xyXG4gICAgICAgICAgcGFydGl0aW9uTGFiZWwuaW5uZXJDb250ZW50ID0gU3RyaW5nVXRpbHMuZmlsbEluKCB0aHJlZVBhcnRpdGlvbnNTcGxpdFBhdHRlcm5TdHJpbmcsIHtcclxuICAgICAgICAgICAgcGFydGl0aW9uOiBvcmllbnRhdGlvbiA9PT0gT3JpZW50YXRpb24uSE9SSVpPTlRBTCA/IGhvcml6b250YWxEaW1lbnNpb25DYXBpdGFsaXplZFN0cmluZyA6IHZlcnRpY2FsRGltZW5zaW9uQ2FwaXRhbGl6ZWRTdHJpbmcsXHJcbiAgICAgICAgICAgIHNpemU6IHRvdGFsLnRvUmljaFN0cmluZygpLFxyXG4gICAgICAgICAgICBzaXplMTogcGFydGl0aW9uc1sgMCBdLnNpemVQcm9wZXJ0eS52YWx1ZS50b1JpY2hTdHJpbmcoIGZhbHNlICksXHJcbiAgICAgICAgICAgIHNpemUyOiBwYXJ0aXRpb25zWyAxIF0uc2l6ZVByb3BlcnR5LnZhbHVlLnRvUmljaFN0cmluZyggZmFsc2UgKSxcclxuICAgICAgICAgICAgc2l6ZTM6IHBhcnRpdGlvbnNbIDIgXS5zaXplUHJvcGVydHkudmFsdWUudG9SaWNoU3RyaW5nKCBmYWxzZSApXHJcbiAgICAgICAgICB9ICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAndW5leHBlY3RlZCBudW1iZXIgb2YgcGFydGl0aW9ucyBmb3IgYTExeScgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgICAgcmV0dXJuIHBhcnRpdGlvbkxhYmVsO1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5wZG9tUGFyYWdyYXBoTm9kZS5hZGRDaGlsZCggYWNjZXNzaWJsZVBhcnRpdGlvbk5vZGVzLnZlcnRpY2FsICk7XHJcbiAgICB0aGlzLnBkb21QYXJhZ3JhcGhOb2RlLmFkZENoaWxkKCBhY2Nlc3NpYmxlUGFydGl0aW9uTm9kZXMuaG9yaXpvbnRhbCApO1xyXG5cclxuICAgIC8vIEExMXkgZGVzY3JpcHRpb24gZm9yIHRoZSBwYXJ0aWFsIHByb2R1Y3RzXHJcbiAgICBjb25zdCBhY2Nlc3NpYmxlUGFydGlhbFByb2R1Y3ROb2RlID0gbmV3IE5vZGUoIHtcclxuICAgICAgdGFnTmFtZTogJ3NwYW4nXHJcbiAgICB9ICk7XHJcbiAgICBsZXQgYWNjZXNzaWJsZVBhcnRpYWxNdWx0aWxpbmsgPSBudWxsO1xyXG4gICAgYXJlYURpc3BsYXkucGFydGl0aW9uZWRBcmVhc1Byb3BlcnR5LmxpbmsoIHBhcnRpdGlvbmVkQXJlYXMgPT4ge1xyXG4gICAgICBpZiAoIGFjY2Vzc2libGVQYXJ0aWFsTXVsdGlsaW5rICkge1xyXG4gICAgICAgIGFjY2Vzc2libGVQYXJ0aWFsTXVsdGlsaW5rLmRpc3Bvc2UoKTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBwcm9wZXJ0aWVzID0gW1xyXG4gICAgICAgIHBhcnRpYWxQcm9kdWN0c0Nob2ljZVByb3BlcnR5XHJcbiAgICAgIF0uY29uY2F0KCBwYXJ0aXRpb25lZEFyZWFzLm1hcCggcGFydGl0aW9uZWRBcmVhID0+IHBhcnRpdGlvbmVkQXJlYS5hcmVhUHJvcGVydHkgKSApXHJcbiAgICAgICAgLmNvbmNhdCggcGFydGl0aW9uZWRBcmVhcy5tYXAoIHBhcnRpdGlvbmVkQXJlYSA9PiBwYXJ0aXRpb25lZEFyZWEudmlzaWJsZVByb3BlcnR5ICkgKTtcclxuICAgICAgYWNjZXNzaWJsZVBhcnRpYWxNdWx0aWxpbmsgPSBNdWx0aWxpbmsubXVsdGlsaW5rKCBwcm9wZXJ0aWVzLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYWN0aXZlUGFydGl0aW9uZWRBcmVhcyA9IGFyZWFEaXNwbGF5LnBhcnRpdGlvbmVkQXJlYXNQcm9wZXJ0eS52YWx1ZS5maWx0ZXIoIHBhcnRpdGlvbmVkQXJlYSA9PiBwYXJ0aXRpb25lZEFyZWEudmlzaWJsZVByb3BlcnR5LnZhbHVlICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aXRpb25lZEFyZWEuYXJlYVByb3BlcnR5LnZhbHVlICE9PSBudWxsICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aXRpb25lZEFyZWEucGFydGl0aW9ucy52ZXJ0aWNhbC5zaXplUHJvcGVydHkudmFsdWUgIT09IG51bGwgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpdGlvbmVkQXJlYS5wYXJ0aXRpb25zLmhvcml6b250YWwuc2l6ZVByb3BlcnR5LnZhbHVlICE9PSBudWxsICk7XHJcbiAgICAgICAgY29uc3QgZmlsbE9iamVjdCA9IHt9O1xyXG4gICAgICAgIGxldCBmaWxsU3RyaW5nO1xyXG4gICAgICAgIGlmICggYWN0aXZlUGFydGl0aW9uZWRBcmVhcy5sZW5ndGggPiAyIHx8XHJcbiAgICAgICAgICAgICBhY3RpdmVQYXJ0aXRpb25lZEFyZWFzLmxlbmd0aCA9PT0gMCB8fFxyXG4gICAgICAgICAgICAgcGFydGlhbFByb2R1Y3RzQ2hvaWNlUHJvcGVydHkudmFsdWUgPT09IFBhcnRpYWxQcm9kdWN0c0Nob2ljZS5ISURERU4gKSB7XHJcbiAgICAgICAgICBhY2Nlc3NpYmxlUGFydGlhbFByb2R1Y3ROb2RlLmlubmVyQ29udGVudCA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICggcGFydGlhbFByb2R1Y3RzQ2hvaWNlUHJvcGVydHkudmFsdWUgPT09IFBhcnRpYWxQcm9kdWN0c0Nob2ljZS5QUk9EVUNUUyApIHtcclxuICAgICAgICAgIGZpbGxTdHJpbmcgPSBvbmVQYXJ0aWFsUHJvZHVjdFBhdHRlcm5TdHJpbmc7XHJcbiAgICAgICAgICBmaWxsT2JqZWN0LmZpcnN0ID0gYWN0aXZlUGFydGl0aW9uZWRBcmVhc1sgMCBdLmFyZWFQcm9wZXJ0eS52YWx1ZS50b1JpY2hTdHJpbmcoIGZhbHNlICk7XHJcblxyXG4gICAgICAgICAgaWYgKCBhY3RpdmVQYXJ0aXRpb25lZEFyZWFzLmxlbmd0aCA9PT0gMiApIHtcclxuICAgICAgICAgICAgZmlsbFN0cmluZyA9IHR3b1BhcnRpYWxQcm9kdWN0c1BhdHRlcm5TdHJpbmc7XHJcbiAgICAgICAgICAgIGZpbGxPYmplY3Quc2Vjb25kID0gYWN0aXZlUGFydGl0aW9uZWRBcmVhc1sgMSBdLmFyZWFQcm9wZXJ0eS52YWx1ZS50b1JpY2hTdHJpbmcoIGZhbHNlICk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgYWNjZXNzaWJsZVBhcnRpYWxQcm9kdWN0Tm9kZS5pbm5lckNvbnRlbnQgPSBTdHJpbmdVdGlscy5maWxsSW4oIGZpbGxTdHJpbmcsIGZpbGxPYmplY3QgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIHBhcnRpYWxQcm9kdWN0c0Nob2ljZVByb3BlcnR5LnZhbHVlID09PSBQYXJ0aWFsUHJvZHVjdHNDaG9pY2UuRkFDVE9SUyApIHtcclxuICAgICAgICAgIGZpbGxTdHJpbmcgPSBvbmVQYXJ0aWFsUHJvZHVjdEZhY3RvclBhdHRlcm5TdHJpbmc7XHJcbiAgICAgICAgICBmaWxsT2JqZWN0LmZpcnN0ID0gU3RyaW5nVXRpbHMuZmlsbEluKCBwcm9kdWN0VGltZXNQYXR0ZXJuU3RyaW5nLCB7XHJcbiAgICAgICAgICAgIGxlZnQ6IGFjdGl2ZVBhcnRpdGlvbmVkQXJlYXNbIDAgXS5wYXJ0aXRpb25zLnZlcnRpY2FsLnNpemVQcm9wZXJ0eS52YWx1ZS50b1JpY2hTdHJpbmcoIGZhbHNlICksXHJcbiAgICAgICAgICAgIHJpZ2h0OiBhY3RpdmVQYXJ0aXRpb25lZEFyZWFzWyAwIF0ucGFydGl0aW9ucy5ob3Jpem9udGFsLnNpemVQcm9wZXJ0eS52YWx1ZS50b1JpY2hTdHJpbmcoIGZhbHNlIClcclxuICAgICAgICAgIH0gKTtcclxuXHJcbiAgICAgICAgICBpZiAoIGFjdGl2ZVBhcnRpdGlvbmVkQXJlYXMubGVuZ3RoID09PSAyICkge1xyXG4gICAgICAgICAgICBmaWxsU3RyaW5nID0gdHdvUGFydGlhbFByb2R1Y3RGYWN0b3JzUGF0dGVyblN0cmluZztcclxuICAgICAgICAgICAgZmlsbE9iamVjdC5zZWNvbmQgPSBTdHJpbmdVdGlscy5maWxsSW4oIHByb2R1Y3RUaW1lc1BhdHRlcm5TdHJpbmcsIHtcclxuICAgICAgICAgICAgICBsZWZ0OiBhY3RpdmVQYXJ0aXRpb25lZEFyZWFzWyAxIF0ucGFydGl0aW9ucy52ZXJ0aWNhbC5zaXplUHJvcGVydHkudmFsdWUudG9SaWNoU3RyaW5nKCBmYWxzZSApLFxyXG4gICAgICAgICAgICAgIHJpZ2h0OiBhY3RpdmVQYXJ0aXRpb25lZEFyZWFzWyAxIF0ucGFydGl0aW9ucy5ob3Jpem9udGFsLnNpemVQcm9wZXJ0eS52YWx1ZS50b1JpY2hTdHJpbmcoIGZhbHNlIClcclxuICAgICAgICAgICAgfSApO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGFjY2Vzc2libGVQYXJ0aWFsUHJvZHVjdE5vZGUuaW5uZXJDb250ZW50ID0gU3RyaW5nVXRpbHMuZmlsbEluKCBmaWxsU3RyaW5nLCBmaWxsT2JqZWN0ICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCAndW5rbm93biBzaXR1YXRpb24gZm9yIGExMXkgcGFydGlhbCBwcm9kdWN0cycgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgIH0gKTtcclxuICAgIHRoaXMucGRvbVBhcmFncmFwaE5vZGUuYWRkQ2hpbGQoIGFjY2Vzc2libGVQYXJ0aWFsUHJvZHVjdE5vZGUgKTtcclxuXHJcbiAgICBjb25zdCBtb2RlbEJvdW5kc1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBhcmVhRGlzcGxheS5jb29yZGluYXRlUmFuZ2VNYXhQcm9wZXJ0eSBdLCBjb29yZGluYXRlUmFuZ2VNYXggPT4gbmV3IEJvdW5kczIoIDAsIDAsIGNvb3JkaW5hdGVSYW5nZU1heCwgY29vcmRpbmF0ZVJhbmdlTWF4ICkgKTtcclxuICAgIGNvbnN0IHZpZXdCb3VuZHMgPSBuZXcgQm91bmRzMiggMCwgMCwgdGhpcy52aWV3U2l6ZSwgdGhpcy52aWV3U2l6ZSApO1xyXG5cclxuICAgIC8vIEBwcm90ZWN0ZWQge1Byb3BlcnR5LjxNb2RlbFZpZXdUcmFuc2Zvcm0yPn0gLSBNYXBzIGZyb20gY29vcmRpbmF0ZSByYW5nZSB2YWx1ZXMgdG8gdmlldyB2YWx1ZXMuXHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybVByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBtb2RlbEJvdW5kc1Byb3BlcnR5IF0sIG1vZGVsQm91bmRzID0+IE1vZGVsVmlld1RyYW5zZm9ybTIuY3JlYXRlUmVjdGFuZ2xlTWFwcGluZyggbW9kZWxCb3VuZHMsIHZpZXdCb3VuZHMgKSApO1xyXG5cclxuICAgIC8vIERpbWVuc2lvbiBsaW5lIHZpZXdzXHJcbiAgICBPcmllbnRhdGlvbi5lbnVtZXJhdGlvbi52YWx1ZXMuZm9yRWFjaCggb3JpZW50YXRpb24gPT4ge1xyXG4gICAgICBjb25zdCBjb2xvclByb3BlcnR5ID0gdGhpcy5hcmVhRGlzcGxheS5jb2xvclByb3BlcnRpZXMuZ2V0KCBvcmllbnRhdGlvbiApO1xyXG4gICAgICBjb25zdCB0ZXJtTGlzdFByb3BlcnR5ID0gdGhpcy5hcmVhRGlzcGxheS5kaXNwbGF5UHJvcGVydGllcy5nZXQoIG9yaWVudGF0aW9uICk7XHJcbiAgICAgIGNvbnN0IHRpY2tQb3NpdGlvbnNQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgICAgWyBhcmVhRGlzcGxheS5wYXJ0aXRpb25Cb3VuZGFyaWVzUHJvcGVydGllcy5nZXQoIG9yaWVudGF0aW9uICkgXSxcclxuICAgICAgICBwYXJ0aXRpb25Cb3VuZGFyaWVzID0+IHBhcnRpdGlvbkJvdW5kYXJpZXMubWFwKCBib3VuZGFyeSA9PiBvcmllbnRhdGlvbi5tb2RlbFRvVmlldyggdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eS52YWx1ZSwgYm91bmRhcnkgKSApICk7XHJcbiAgICAgIHRoaXMubGFiZWxMYXllci5hZGRDaGlsZCggbmV3IFJhbmdlTGFiZWxOb2RlKFxyXG4gICAgICAgIHRlcm1MaXN0UHJvcGVydHksXHJcbiAgICAgICAgb3JpZW50YXRpb24sXHJcbiAgICAgICAgdGlja1Bvc2l0aW9uc1Byb3BlcnR5LFxyXG4gICAgICAgIGNvbG9yUHJvcGVydHksXHJcbiAgICAgICAgb3B0aW9ucy5pc1Byb3BvcnRpb25hbFxyXG4gICAgICApICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge2Jvb2xlYW59IC0gV2hldGhlciB3ZSBuZWVkIHRvIHVwZGF0ZSB0aGUgbGFiZWxzLiBJdCdzIGV4cGVuc2l2ZSwgc28gd2Ugb25seSBkbyBpdCBhdCBtb3N0IG9uY2UgYSBmcmFtZS5cclxuICAgIHRoaXMucHJvZHVjdFBvc2l0aW9uTGFiZWxzRGlydHkgPSB0cnVlO1xyXG4gICAgY29uc3QgaW52YWxpZGF0ZVByb2R1Y3RMYWJlbHMgPSAoKSA9PiB7XHJcbiAgICAgIHRoaXMucHJvZHVjdFBvc2l0aW9uTGFiZWxzRGlydHkgPSB0cnVlO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBAcHJvdGVjdGVkIHtBcnJheS48UGFydGlhbFByb2R1Y3RMYWJlbE5vZGU+fVxyXG4gICAgdGhpcy5wcm9kdWN0TGFiZWxzID0gW107XHJcblxyXG4gICAgLy8gQ3JlYXRlIHBvb2xlZCBwYXJ0aWFsIHByb2R1Y3QgbGFiZWxzXHJcbiAgICB0aGlzLmxhYmVsTGF5ZXIuYWRkQ2hpbGQoIG5ldyBQb29sYWJsZUxheWVyTm9kZSgge1xyXG4gICAgICB1c2VkQXJyYXk6IHRoaXMucHJvZHVjdExhYmVscyxcclxuICAgICAgdXBkYXRlZENhbGxiYWNrOiBpbnZhbGlkYXRlUHJvZHVjdExhYmVscyxcclxuICAgICAgYXJyYXlQcm9wZXJ0eTogYXJlYURpc3BsYXkucGFydGl0aW9uZWRBcmVhc1Byb3BlcnR5LFxyXG4gICAgICBjcmVhdGVOb2RlOiBwYXJ0aXRpb25lZEFyZWEgPT4gbmV3IFBhcnRpYWxQcm9kdWN0TGFiZWxOb2RlKFxyXG4gICAgICAgIHBhcnRpYWxQcm9kdWN0c0Nob2ljZVByb3BlcnR5LFxyXG4gICAgICAgIG5ldyBQcm9wZXJ0eSggcGFydGl0aW9uZWRBcmVhICksXHJcbiAgICAgICAgb3B0aW9ucy5hbGxvd0V4cG9uZW50c1xyXG4gICAgICApLFxyXG4gICAgICBnZXRJdGVtUHJvcGVydHk6IHByb2R1Y3RMYWJlbCA9PiBwcm9kdWN0TGFiZWwucGFydGl0aW9uZWRBcmVhUHJvcGVydHlcclxuICAgIH0gKSApO1xyXG5cclxuICAgIC8vIE5vdGUgdGhpcyBuZWVkcyB0byBiZSBsaW5rZWQgYWZ0ZXIgdGhlIHByb2R1Y3QgbGFiZWxzIGFyZSBjcmVhdGVkLCBzbyB0aGUgb3JkZXIgZGVwZW5kZW5jeSB3b3Jrc1xyXG4gICAgYXJlYURpc3BsYXkuYWxsUGFydGl0aW9uc1Byb3BlcnR5LmxpbmsoICggbmV3QWxsUGFydGl0aW9ucywgb2xkQWxsUGFydGl0aW9ucyApID0+IHtcclxuICAgICAgb2xkQWxsUGFydGl0aW9ucyAmJiBvbGRBbGxQYXJ0aXRpb25zLmZvckVhY2goIHBhcnRpdGlvbiA9PiB7XHJcbiAgICAgICAgcGFydGl0aW9uLmNvb3JkaW5hdGVSYW5nZVByb3BlcnR5LnVubGluayggaW52YWxpZGF0ZVByb2R1Y3RMYWJlbHMgKTtcclxuICAgICAgfSApO1xyXG4gICAgICBuZXdBbGxQYXJ0aXRpb25zLmZvckVhY2goIHBhcnRpdGlvbiA9PiB7XHJcbiAgICAgICAgcGFydGl0aW9uLmNvb3JkaW5hdGVSYW5nZVByb3BlcnR5LmxhenlMaW5rKCBpbnZhbGlkYXRlUHJvZHVjdExhYmVscyApO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICBpbnZhbGlkYXRlUHJvZHVjdExhYmVscygpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEFsc28gaW52YWxpZGF0ZSBvdXIgbGFiZWwgcG9zaXRpb25zIHdoZW4gdGhlIGxhYmVsIHR5cGUgY2hhbmdlcy5cclxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvYXJlYS1tb2RlbC1jb21tb24vaXNzdWVzLzEwOVxyXG4gICAgcGFydGlhbFByb2R1Y3RzQ2hvaWNlUHJvcGVydHkubGF6eUxpbmsoIGludmFsaWRhdGVQcm9kdWN0TGFiZWxzICk7XHJcblxyXG4gICAgLy8gRG8gaXQgb25jZSBpbml0aWFsbHkgZm9yIHByb3BlciBsYXlvdXQgYXQgdGhlIHN0YXJ0XHJcbiAgICB0aGlzLnBvc2l0aW9uUHJvZHVjdExhYmVscygpO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge05vZGV9IC0gRXhwb3NlZCBwdWJsaWNseSBmb3IgYTExeSwgYW5kIHVzZWQgaW4gc3ViY2xhc3Nlc1xyXG4gICAgdGhpcy5lcmFzZUJ1dHRvbiA9IG5ldyBFcmFzZXJCdXR0b24oIHtcclxuICAgICAgbGlzdGVuZXI6ICgpID0+IHtcclxuICAgICAgICBhcmVhRGlzcGxheS5hcmVhUHJvcGVydHkudmFsdWUuZXJhc2UoKTtcclxuICAgICAgfSxcclxuICAgICAgY2VudGVyOiBvcHRpb25zLmlzUHJvcG9ydGlvbmFsXHJcbiAgICAgICAgICAgICAgPyBBcmVhTW9kZWxDb21tb25Db25zdGFudHMuUFJPUE9SVElPTkFMX1JBTkdFX09GRlNFVFxyXG4gICAgICAgICAgICAgIDogQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLkdFTkVSSUNfUkFOR0VfT0ZGU0VULFxyXG4gICAgICB0b3VjaEFyZWFYRGlsYXRpb246IDgsXHJcbiAgICAgIHRvdWNoQXJlYVlEaWxhdGlvbjogOCxcclxuXHJcbiAgICAgIC8vIHBkb21cclxuICAgICAgaW5uZXJDb250ZW50OiBlcmFzZVN0cmluZyxcclxuICAgICAgZGVzY3JpcHRpb25Db250ZW50OiBlcmFzZURlc2NyaXB0aW9uU3RyaW5nXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHByb3RlY3RlZCB7Tm9kZX1cclxuICAgIHRoaXMuYmFja2dyb3VuZE5vZGUgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCB0aGlzLnZpZXdTaXplLCB0aGlzLnZpZXdTaXplLCB7XHJcbiAgICAgIGZpbGw6IEFyZWFNb2RlbENvbW1vbkNvbG9ycy5hcmVhQmFja2dyb3VuZFByb3BlcnR5XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHByb3RlY3RlZCB7Tm9kZX1cclxuICAgIHRoaXMuYm9yZGVyTm9kZSA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIHRoaXMudmlld1NpemUsIHRoaXMudmlld1NpemUsIHtcclxuICAgICAgc3Ryb2tlOiBBcmVhTW9kZWxDb21tb25Db2xvcnMuYXJlYUJvcmRlclByb3BlcnR5XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5sYWJlbExheWVyLmFkZENoaWxkKCB0aGlzLmVyYXNlQnV0dG9uICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIGV4cGVuc2l2ZS10by11cGRhdGUgdGhpbmdzIG9ubHkgb25jZSBhIGZyYW1lIChmb3IgcGVyZm9ybWFuY2UpLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICB1cGRhdGUoKSB7XHJcbiAgICBpZiAoICF0aGlzLnByb2R1Y3RQb3NpdGlvbkxhYmVsc0RpcnR5ICkgeyByZXR1cm47IH1cclxuICAgIHRoaXMucHJvZHVjdFBvc2l0aW9uTGFiZWxzRGlydHkgPSBmYWxzZTtcclxuXHJcbiAgICB0aGlzLnBvc2l0aW9uUHJvZHVjdExhYmVscygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUG9zaXRpb25zIGFsbCBvZiB0aGUgcGFydGlhbCBwcm9kdWN0cyBsYWJlbHMuXHJcbiAgICogQHByb3RlY3RlZFxyXG4gICAqL1xyXG4gIHBvc2l0aW9uUHJvZHVjdExhYmVscygpIHtcclxuICAgIHRocm93IG5ldyBFcnJvciggJ2Fic3RyYWN0IG1ldGhvZCcgKTtcclxuICB9XHJcbn1cclxuXHJcbmFyZWFNb2RlbENvbW1vbi5yZWdpc3RlciggJ0FyZWFEaXNwbGF5Tm9kZScsIEFyZWFEaXNwbGF5Tm9kZSApO1xyXG5cclxu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