// Copyright 2017-2023, University of Colorado Boulder

/**
 * Shows a node that allows selecting between different layouts
 *
 * NOTE: This type is designed to be persistent, and will not need to release references to avoid memory leaks.
 *
 * NOTE: May be generalized in the future, see https://github.com/phetsims/sun/issues/363
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import { Shape } from '../../../../kite/js/imports.js';
import { FireListener, HBox, Line, Node, Path, Rectangle, Text, VBox } from '../../../../scenery/js/imports.js';
import areaModelCommon from '../../areaModelCommon.js';
import AreaModelCommonConstants from '../../common/AreaModelCommonConstants.js';
import AreaModelCommonColors from '../../common/view/AreaModelCommonColors.js';
import GenericLayout from '../model/GenericLayout.js';
class GenericLayoutSelectionNode extends Node {
  /**
   * @param {Property.<GenericLayout>} genericLayoutProperty
   * @param {Node} listParent
   * @param {number} width
   */
  constructor(genericLayoutProperty, listParent, width) {
    super();

    // Our rectangles will be stroked, so we need to subtract 1 due to the lineWidth
    width -= 1;
    const items = GenericLayout.VALUES.map(layout => {
      return {
        node: new HBox({
          children: [createLayoutIcon(layout.size, 0.7), new Text(`${layout.size.height}x${layout.size.width}`, {
            font: AreaModelCommonConstants.LAYOUT_FONT
          })],
          spacing: 14
        }),
        value: layout
      };
    });

    // eslint-disable-next-line prefer-spread
    const maxItemHeight = Math.max.apply(Math, _.map(_.map(items, 'node'), 'height'));
    const itemMargin = 6;
    const arrowMargin = 8;
    const rectHeight = maxItemHeight + 2 * itemMargin;
    const rectangle = new Rectangle({
      rectWidth: width,
      rectHeight: maxItemHeight + 2 * itemMargin,
      fill: 'white',
      stroke: 'black',
      cornerRadius: AreaModelCommonConstants.PANEL_CORNER_RADIUS,
      cursor: 'pointer'
    });
    this.addChild(rectangle);
    const arrowSize = 15;
    const arrow = new Path(new Shape().moveTo(0, 0).lineTo(arrowSize, 0).lineTo(arrowSize * 0.5, arrowSize * 0.9).close(), {
      fill: 'black',
      right: rectangle.right - arrowMargin,
      centerY: rectangle.centerY,
      pickable: false
    });
    this.addChild(arrow);
    const separatorX = arrow.left - arrowMargin;
    this.addChild(new Line({
      x1: separatorX,
      y1: 0,
      x2: separatorX,
      y2: rectHeight,
      lineWidth: 0.5,
      stroke: 'black',
      pickable: false
    }));
    const currentLabel = new Node({
      pickable: false
    });
    genericLayoutProperty.link(layout => {
      currentLabel.children = [_.find(items, item => item.value === layout).node];
      currentLabel.left = itemMargin;
      currentLabel.centerY = rectangle.centerY;
    });
    this.addChild(currentLabel);
    const popup = new Rectangle({
      rectWidth: separatorX,
      rectHeight: separatorX,
      fill: 'white',
      stroke: 'black',
      cornerRadius: AreaModelCommonConstants.PANEL_CORNER_RADIUS,
      pickable: true
    });
    const buttonSpacing = 12;
    const buttonsNode = new VBox({
      children: [1, 2, 3].map(numVertical => new HBox({
        children: [1, 2, 3].map(numHorizontal => {
          const layout = GenericLayout.fromValues(numHorizontal, numVertical);
          // NOTE: Yes, it's weird this constant is here. We used to scale most things down by this amount. Now we
          // want the same appearance (but without the scaling, because it was bad practice), so to get the icon to
          // have the same appearance, a scale factor is needed.
          const oldScale = 0.7;
          const icon = createLayoutIcon(layout.size, oldScale * oldScale);
          icon.scale(1 / oldScale);
          icon.pickable = false;
          const cornerRadius = 3;
          const background = Rectangle.roundedBounds(icon.bounds.dilated(cornerRadius), cornerRadius, cornerRadius, {
            cursor: 'pointer'
          });
          background.touchArea = background.localBounds.dilated(buttonSpacing / 2);
          const listener = new FireListener({
            fire: () => {
              genericLayoutProperty.value = layout;
              visibleProperty.value = false; // hide
            }
          });

          background.stroke = new DerivedProperty([genericLayoutProperty, AreaModelCommonColors.radioBorderProperty], (currentLayout, highlightColor) => {
            if (currentLayout === layout) {
              return highlightColor;
            } else {
              return 'transparent';
            }
          });
          background.fill = new DerivedProperty([listener.isHoveringProperty, AreaModelCommonColors.layoutHoverProperty], (isHovering, hoverColor) => {
            if (isHovering) {
              return hoverColor;
            } else {
              return 'transparent';
            }
          });
          return new Node({
            children: [background, icon],
            inputListeners: [listener]
          });
        }),
        spacing: buttonSpacing
      })),
      spacing: buttonSpacing
    });
    const panelMargin = 20;
    buttonsNode.scale((popup.width - 2 * panelMargin) / buttonsNode.width);
    buttonsNode.center = popup.center;
    popup.addChild(buttonsNode);
    const visibleProperty = new BooleanProperty(false);
    popup.addInputListener({
      down: event => {
        event.handle();
      }
    });

    // Handle dismissing the selection if the user clicks outside
    const dismissListener = {
      down: event => {
        if (!event.trail.isExtensionOf(this.getUniqueTrail())) {
          visibleProperty.value = false;
        }
      }
    };
    visibleProperty.lazyLink(visible => {
      if (visible) {
        const matrix = this.getUniqueTrail().getMatrixTo(listParent.getUniqueTrail());
        popup.setScaleMagnitude(matrix.getScaleVector().x);
        // We subtract 1 off so that the strokes line up, and we don't get a "double-stroked" effect.
        popup.leftTop = matrix.timesVector2(rectangle.leftBottom.plusXY(0, -1));
        listParent.addChild(popup);
        phet.joist.display.addInputListener(dismissListener);
      } else {
        listParent.removeChild(popup);
        phet.joist.display.removeInputListener(dismissListener);
      }
    });
    rectangle.addInputListener({
      down: event => {
        visibleProperty.toggle();
      }
    });
  }
}
areaModelCommon.register('GenericLayoutSelectionNode', GenericLayoutSelectionNode);

/**
 * Creates a layout icon based on the given size.
 * @private
 *
 * @param {Dimension2} size
 * @param {number} lineWidth
 * @returns {Node}
 */
function createLayoutIcon(size, lineWidth) {
  const length = 21;
  const shape = new Shape().rect(0, 0, length, length);
  if (size.width === 2) {
    shape.moveTo(length * AreaModelCommonConstants.GENERIC_ICON_SINGLE_OFFSET, 0).verticalLineTo(length);
  } else if (size.width === 3) {
    shape.moveTo(length * AreaModelCommonConstants.GENERIC_ICON_FIRST_OFFSET, 0).verticalLineTo(length);
    shape.moveTo(length * AreaModelCommonConstants.GENERIC_ICON_SECOND_OFFSET, 0).verticalLineTo(length);
  }
  if (size.height === 2) {
    shape.moveTo(0, length * AreaModelCommonConstants.GENERIC_ICON_SINGLE_OFFSET).horizontalLineTo(length);
  } else if (size.height === 3) {
    shape.moveTo(0, length * AreaModelCommonConstants.GENERIC_ICON_FIRST_OFFSET).horizontalLineTo(length);
    shape.moveTo(0, length * AreaModelCommonConstants.GENERIC_ICON_SECOND_OFFSET).horizontalLineTo(length);
  }
  return new Path(shape, {
    lineWidth: lineWidth,
    stroke: AreaModelCommonColors.layoutGridProperty,
    fill: AreaModelCommonColors.layoutIconFillProperty
  });
}
export default GenericLayoutSelectionNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJTaGFwZSIsIkZpcmVMaXN0ZW5lciIsIkhCb3giLCJMaW5lIiwiTm9kZSIsIlBhdGgiLCJSZWN0YW5nbGUiLCJUZXh0IiwiVkJveCIsImFyZWFNb2RlbENvbW1vbiIsIkFyZWFNb2RlbENvbW1vbkNvbnN0YW50cyIsIkFyZWFNb2RlbENvbW1vbkNvbG9ycyIsIkdlbmVyaWNMYXlvdXQiLCJHZW5lcmljTGF5b3V0U2VsZWN0aW9uTm9kZSIsImNvbnN0cnVjdG9yIiwiZ2VuZXJpY0xheW91dFByb3BlcnR5IiwibGlzdFBhcmVudCIsIndpZHRoIiwiaXRlbXMiLCJWQUxVRVMiLCJtYXAiLCJsYXlvdXQiLCJub2RlIiwiY2hpbGRyZW4iLCJjcmVhdGVMYXlvdXRJY29uIiwic2l6ZSIsImhlaWdodCIsImZvbnQiLCJMQVlPVVRfRk9OVCIsInNwYWNpbmciLCJ2YWx1ZSIsIm1heEl0ZW1IZWlnaHQiLCJNYXRoIiwibWF4IiwiYXBwbHkiLCJfIiwiaXRlbU1hcmdpbiIsImFycm93TWFyZ2luIiwicmVjdEhlaWdodCIsInJlY3RhbmdsZSIsInJlY3RXaWR0aCIsImZpbGwiLCJzdHJva2UiLCJjb3JuZXJSYWRpdXMiLCJQQU5FTF9DT1JORVJfUkFESVVTIiwiY3Vyc29yIiwiYWRkQ2hpbGQiLCJhcnJvd1NpemUiLCJhcnJvdyIsIm1vdmVUbyIsImxpbmVUbyIsImNsb3NlIiwicmlnaHQiLCJjZW50ZXJZIiwicGlja2FibGUiLCJzZXBhcmF0b3JYIiwibGVmdCIsIngxIiwieTEiLCJ4MiIsInkyIiwibGluZVdpZHRoIiwiY3VycmVudExhYmVsIiwibGluayIsImZpbmQiLCJpdGVtIiwicG9wdXAiLCJidXR0b25TcGFjaW5nIiwiYnV0dG9uc05vZGUiLCJudW1WZXJ0aWNhbCIsIm51bUhvcml6b250YWwiLCJmcm9tVmFsdWVzIiwib2xkU2NhbGUiLCJpY29uIiwic2NhbGUiLCJiYWNrZ3JvdW5kIiwicm91bmRlZEJvdW5kcyIsImJvdW5kcyIsImRpbGF0ZWQiLCJ0b3VjaEFyZWEiLCJsb2NhbEJvdW5kcyIsImxpc3RlbmVyIiwiZmlyZSIsInZpc2libGVQcm9wZXJ0eSIsInJhZGlvQm9yZGVyUHJvcGVydHkiLCJjdXJyZW50TGF5b3V0IiwiaGlnaGxpZ2h0Q29sb3IiLCJpc0hvdmVyaW5nUHJvcGVydHkiLCJsYXlvdXRIb3ZlclByb3BlcnR5IiwiaXNIb3ZlcmluZyIsImhvdmVyQ29sb3IiLCJpbnB1dExpc3RlbmVycyIsInBhbmVsTWFyZ2luIiwiY2VudGVyIiwiYWRkSW5wdXRMaXN0ZW5lciIsImRvd24iLCJldmVudCIsImhhbmRsZSIsImRpc21pc3NMaXN0ZW5lciIsInRyYWlsIiwiaXNFeHRlbnNpb25PZiIsImdldFVuaXF1ZVRyYWlsIiwibGF6eUxpbmsiLCJ2aXNpYmxlIiwibWF0cml4IiwiZ2V0TWF0cml4VG8iLCJzZXRTY2FsZU1hZ25pdHVkZSIsImdldFNjYWxlVmVjdG9yIiwieCIsImxlZnRUb3AiLCJ0aW1lc1ZlY3RvcjIiLCJsZWZ0Qm90dG9tIiwicGx1c1hZIiwicGhldCIsImpvaXN0IiwiZGlzcGxheSIsInJlbW92ZUNoaWxkIiwicmVtb3ZlSW5wdXRMaXN0ZW5lciIsInRvZ2dsZSIsInJlZ2lzdGVyIiwibGVuZ3RoIiwic2hhcGUiLCJyZWN0IiwiR0VORVJJQ19JQ09OX1NJTkdMRV9PRkZTRVQiLCJ2ZXJ0aWNhbExpbmVUbyIsIkdFTkVSSUNfSUNPTl9GSVJTVF9PRkZTRVQiLCJHRU5FUklDX0lDT05fU0VDT05EX09GRlNFVCIsImhvcml6b250YWxMaW5lVG8iLCJsYXlvdXRHcmlkUHJvcGVydHkiLCJsYXlvdXRJY29uRmlsbFByb3BlcnR5Il0sInNvdXJjZXMiOlsiR2VuZXJpY0xheW91dFNlbGVjdGlvbk5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTctMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2hvd3MgYSBub2RlIHRoYXQgYWxsb3dzIHNlbGVjdGluZyBiZXR3ZWVuIGRpZmZlcmVudCBsYXlvdXRzXHJcbiAqXHJcbiAqIE5PVEU6IFRoaXMgdHlwZSBpcyBkZXNpZ25lZCB0byBiZSBwZXJzaXN0ZW50LCBhbmQgd2lsbCBub3QgbmVlZCB0byByZWxlYXNlIHJlZmVyZW5jZXMgdG8gYXZvaWQgbWVtb3J5IGxlYWtzLlxyXG4gKlxyXG4gKiBOT1RFOiBNYXkgYmUgZ2VuZXJhbGl6ZWQgaW4gdGhlIGZ1dHVyZSwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzM2M1xyXG4gKlxyXG4gKiBAYXV0aG9yIEpvbmF0aGFuIE9sc29uIDxqb25hdGhhbi5vbHNvbkBjb2xvcmFkby5lZHU+XHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB7IEZpcmVMaXN0ZW5lciwgSEJveCwgTGluZSwgTm9kZSwgUGF0aCwgUmVjdGFuZ2xlLCBUZXh0LCBWQm94IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGFyZWFNb2RlbENvbW1vbiBmcm9tICcuLi8uLi9hcmVhTW9kZWxDb21tb24uanMnO1xyXG5pbXBvcnQgQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9BcmVhTW9kZWxDb21tb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgQXJlYU1vZGVsQ29tbW9uQ29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0FyZWFNb2RlbENvbW1vbkNvbG9ycy5qcyc7XHJcbmltcG9ydCBHZW5lcmljTGF5b3V0IGZyb20gJy4uL21vZGVsL0dlbmVyaWNMYXlvdXQuanMnO1xyXG5cclxuY2xhc3MgR2VuZXJpY0xheW91dFNlbGVjdGlvbk5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuICAvKipcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5LjxHZW5lcmljTGF5b3V0Pn0gZ2VuZXJpY0xheW91dFByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtOb2RlfSBsaXN0UGFyZW50XHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGdlbmVyaWNMYXlvdXRQcm9wZXJ0eSwgbGlzdFBhcmVudCwgd2lkdGggKSB7XHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIC8vIE91ciByZWN0YW5nbGVzIHdpbGwgYmUgc3Ryb2tlZCwgc28gd2UgbmVlZCB0byBzdWJ0cmFjdCAxIGR1ZSB0byB0aGUgbGluZVdpZHRoXHJcbiAgICB3aWR0aCAtPSAxO1xyXG5cclxuICAgIGNvbnN0IGl0ZW1zID0gR2VuZXJpY0xheW91dC5WQUxVRVMubWFwKCBsYXlvdXQgPT4ge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIG5vZGU6IG5ldyBIQm94KCB7XHJcbiAgICAgICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgICAgICBjcmVhdGVMYXlvdXRJY29uKCBsYXlvdXQuc2l6ZSwgMC43ICksXHJcbiAgICAgICAgICAgIG5ldyBUZXh0KCBgJHtsYXlvdXQuc2l6ZS5oZWlnaHR9eCR7bGF5b3V0LnNpemUud2lkdGh9YCwge1xyXG4gICAgICAgICAgICAgIGZvbnQ6IEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5MQVlPVVRfRk9OVFxyXG4gICAgICAgICAgICB9IClcclxuICAgICAgICAgIF0sXHJcbiAgICAgICAgICBzcGFjaW5nOiAxNFxyXG4gICAgICAgIH0gKSxcclxuICAgICAgICB2YWx1ZTogbGF5b3V0XHJcbiAgICAgIH07XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZWZlci1zcHJlYWRcclxuICAgIGNvbnN0IG1heEl0ZW1IZWlnaHQgPSBNYXRoLm1heC5hcHBseSggTWF0aCwgXy5tYXAoIF8ubWFwKCBpdGVtcywgJ25vZGUnICksICdoZWlnaHQnICkgKTtcclxuICAgIGNvbnN0IGl0ZW1NYXJnaW4gPSA2O1xyXG4gICAgY29uc3QgYXJyb3dNYXJnaW4gPSA4O1xyXG5cclxuICAgIGNvbnN0IHJlY3RIZWlnaHQgPSBtYXhJdGVtSGVpZ2h0ICsgMiAqIGl0ZW1NYXJnaW47XHJcbiAgICBjb25zdCByZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKCB7XHJcbiAgICAgIHJlY3RXaWR0aDogd2lkdGgsXHJcbiAgICAgIHJlY3RIZWlnaHQ6IG1heEl0ZW1IZWlnaHQgKyAyICogaXRlbU1hcmdpbixcclxuICAgICAgZmlsbDogJ3doaXRlJyxcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBjb3JuZXJSYWRpdXM6IEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5QQU5FTF9DT1JORVJfUkFESVVTLFxyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJ1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggcmVjdGFuZ2xlICk7XHJcblxyXG4gICAgY29uc3QgYXJyb3dTaXplID0gMTU7XHJcbiAgICBjb25zdCBhcnJvdyA9IG5ldyBQYXRoKCBuZXcgU2hhcGUoKS5tb3ZlVG8oIDAsIDAgKS5saW5lVG8oIGFycm93U2l6ZSwgMCApLmxpbmVUbyggYXJyb3dTaXplICogMC41LCBhcnJvd1NpemUgKiAwLjkgKS5jbG9zZSgpLCB7XHJcbiAgICAgIGZpbGw6ICdibGFjaycsXHJcbiAgICAgIHJpZ2h0OiByZWN0YW5nbGUucmlnaHQgLSBhcnJvd01hcmdpbixcclxuICAgICAgY2VudGVyWTogcmVjdGFuZ2xlLmNlbnRlclksXHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggYXJyb3cgKTtcclxuXHJcbiAgICBjb25zdCBzZXBhcmF0b3JYID0gYXJyb3cubGVmdCAtIGFycm93TWFyZ2luO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbmV3IExpbmUoIHtcclxuICAgICAgeDE6IHNlcGFyYXRvclgsXHJcbiAgICAgIHkxOiAwLFxyXG4gICAgICB4Mjogc2VwYXJhdG9yWCxcclxuICAgICAgeTI6IHJlY3RIZWlnaHQsXHJcbiAgICAgIGxpbmVXaWR0aDogMC41LFxyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZVxyXG4gICAgfSApICk7XHJcblxyXG4gICAgY29uc3QgY3VycmVudExhYmVsID0gbmV3IE5vZGUoIHtcclxuICAgICAgcGlja2FibGU6IGZhbHNlXHJcbiAgICB9ICk7XHJcbiAgICBnZW5lcmljTGF5b3V0UHJvcGVydHkubGluayggbGF5b3V0ID0+IHtcclxuICAgICAgY3VycmVudExhYmVsLmNoaWxkcmVuID0gW1xyXG4gICAgICAgIF8uZmluZCggaXRlbXMsIGl0ZW0gPT4gaXRlbS52YWx1ZSA9PT0gbGF5b3V0ICkubm9kZVxyXG4gICAgICBdO1xyXG4gICAgICBjdXJyZW50TGFiZWwubGVmdCA9IGl0ZW1NYXJnaW47XHJcbiAgICAgIGN1cnJlbnRMYWJlbC5jZW50ZXJZID0gcmVjdGFuZ2xlLmNlbnRlclk7XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBjdXJyZW50TGFiZWwgKTtcclxuXHJcbiAgICBjb25zdCBwb3B1cCA9IG5ldyBSZWN0YW5nbGUoIHtcclxuICAgICAgcmVjdFdpZHRoOiBzZXBhcmF0b3JYLFxyXG4gICAgICByZWN0SGVpZ2h0OiBzZXBhcmF0b3JYLFxyXG4gICAgICBmaWxsOiAnd2hpdGUnLFxyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGNvcm5lclJhZGl1czogQXJlYU1vZGVsQ29tbW9uQ29uc3RhbnRzLlBBTkVMX0NPUk5FUl9SQURJVVMsXHJcbiAgICAgIHBpY2thYmxlOiB0cnVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgYnV0dG9uU3BhY2luZyA9IDEyO1xyXG4gICAgY29uc3QgYnV0dG9uc05vZGUgPSBuZXcgVkJveCgge1xyXG4gICAgICBjaGlsZHJlbjogWyAxLCAyLCAzIF0ubWFwKCBudW1WZXJ0aWNhbCA9PiBuZXcgSEJveCgge1xyXG4gICAgICAgIGNoaWxkcmVuOiBbIDEsIDIsIDMgXS5tYXAoIG51bUhvcml6b250YWwgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbGF5b3V0ID0gR2VuZXJpY0xheW91dC5mcm9tVmFsdWVzKCBudW1Ib3Jpem9udGFsLCBudW1WZXJ0aWNhbCApO1xyXG4gICAgICAgICAgLy8gTk9URTogWWVzLCBpdCdzIHdlaXJkIHRoaXMgY29uc3RhbnQgaXMgaGVyZS4gV2UgdXNlZCB0byBzY2FsZSBtb3N0IHRoaW5ncyBkb3duIGJ5IHRoaXMgYW1vdW50LiBOb3cgd2VcclxuICAgICAgICAgIC8vIHdhbnQgdGhlIHNhbWUgYXBwZWFyYW5jZSAoYnV0IHdpdGhvdXQgdGhlIHNjYWxpbmcsIGJlY2F1c2UgaXQgd2FzIGJhZCBwcmFjdGljZSksIHNvIHRvIGdldCB0aGUgaWNvbiB0b1xyXG4gICAgICAgICAgLy8gaGF2ZSB0aGUgc2FtZSBhcHBlYXJhbmNlLCBhIHNjYWxlIGZhY3RvciBpcyBuZWVkZWQuXHJcbiAgICAgICAgICBjb25zdCBvbGRTY2FsZSA9IDAuNztcclxuICAgICAgICAgIGNvbnN0IGljb24gPSBjcmVhdGVMYXlvdXRJY29uKCBsYXlvdXQuc2l6ZSwgb2xkU2NhbGUgKiBvbGRTY2FsZSApO1xyXG4gICAgICAgICAgaWNvbi5zY2FsZSggMSAvIG9sZFNjYWxlICk7XHJcbiAgICAgICAgICBpY29uLnBpY2thYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICBjb25zdCBjb3JuZXJSYWRpdXMgPSAzO1xyXG4gICAgICAgICAgY29uc3QgYmFja2dyb3VuZCA9IFJlY3RhbmdsZS5yb3VuZGVkQm91bmRzKCBpY29uLmJvdW5kcy5kaWxhdGVkKCBjb3JuZXJSYWRpdXMgKSwgY29ybmVyUmFkaXVzLCBjb3JuZXJSYWRpdXMsIHtcclxuICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcidcclxuICAgICAgICAgIH0gKTtcclxuICAgICAgICAgIGJhY2tncm91bmQudG91Y2hBcmVhID0gYmFja2dyb3VuZC5sb2NhbEJvdW5kcy5kaWxhdGVkKCBidXR0b25TcGFjaW5nIC8gMiApO1xyXG4gICAgICAgICAgY29uc3QgbGlzdGVuZXIgPSBuZXcgRmlyZUxpc3RlbmVyKCB7XHJcbiAgICAgICAgICAgIGZpcmU6ICgpID0+IHtcclxuICAgICAgICAgICAgICBnZW5lcmljTGF5b3V0UHJvcGVydHkudmFsdWUgPSBsYXlvdXQ7XHJcbiAgICAgICAgICAgICAgdmlzaWJsZVByb3BlcnR5LnZhbHVlID0gZmFsc2U7IC8vIGhpZGVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSApO1xyXG4gICAgICAgICAgYmFja2dyb3VuZC5zdHJva2UgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgICAgICAgICBbIGdlbmVyaWNMYXlvdXRQcm9wZXJ0eSwgQXJlYU1vZGVsQ29tbW9uQ29sb3JzLnJhZGlvQm9yZGVyUHJvcGVydHkgXSxcclxuICAgICAgICAgICAgKCBjdXJyZW50TGF5b3V0LCBoaWdobGlnaHRDb2xvciApID0+IHtcclxuICAgICAgICAgICAgICBpZiAoIGN1cnJlbnRMYXlvdXQgPT09IGxheW91dCApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBoaWdobGlnaHRDb2xvcjtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJ3RyYW5zcGFyZW50JztcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gKTtcclxuICAgICAgICAgIGJhY2tncm91bmQuZmlsbCA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgICAgICAgIFsgbGlzdGVuZXIuaXNIb3ZlcmluZ1Byb3BlcnR5LCBBcmVhTW9kZWxDb21tb25Db2xvcnMubGF5b3V0SG92ZXJQcm9wZXJ0eSBdLFxyXG4gICAgICAgICAgICAoIGlzSG92ZXJpbmcsIGhvdmVyQ29sb3IgKSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKCBpc0hvdmVyaW5nICkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGhvdmVyQ29sb3I7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICd0cmFuc3BhcmVudCc7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ICk7XHJcblxyXG4gICAgICAgICAgcmV0dXJuIG5ldyBOb2RlKCB7XHJcbiAgICAgICAgICAgIGNoaWxkcmVuOiBbIGJhY2tncm91bmQsIGljb24gXSxcclxuICAgICAgICAgICAgaW5wdXRMaXN0ZW5lcnM6IFsgbGlzdGVuZXIgXVxyXG4gICAgICAgICAgfSApO1xyXG4gICAgICAgIH0gKSxcclxuICAgICAgICBzcGFjaW5nOiBidXR0b25TcGFjaW5nXHJcbiAgICAgIH0gKSApLFxyXG4gICAgICBzcGFjaW5nOiBidXR0b25TcGFjaW5nXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBwYW5lbE1hcmdpbiA9IDIwO1xyXG4gICAgYnV0dG9uc05vZGUuc2NhbGUoICggcG9wdXAud2lkdGggLSAyICogcGFuZWxNYXJnaW4gKSAvIGJ1dHRvbnNOb2RlLndpZHRoICk7XHJcbiAgICBidXR0b25zTm9kZS5jZW50ZXIgPSBwb3B1cC5jZW50ZXI7XHJcbiAgICBwb3B1cC5hZGRDaGlsZCggYnV0dG9uc05vZGUgKTtcclxuXHJcbiAgICBjb25zdCB2aXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG4gICAgcG9wdXAuYWRkSW5wdXRMaXN0ZW5lcigge1xyXG4gICAgICBkb3duOiBldmVudCA9PiB7XHJcbiAgICAgICAgZXZlbnQuaGFuZGxlKCk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBIYW5kbGUgZGlzbWlzc2luZyB0aGUgc2VsZWN0aW9uIGlmIHRoZSB1c2VyIGNsaWNrcyBvdXRzaWRlXHJcbiAgICBjb25zdCBkaXNtaXNzTGlzdGVuZXIgPSB7XHJcbiAgICAgIGRvd246IGV2ZW50ID0+IHtcclxuICAgICAgICBpZiAoICFldmVudC50cmFpbC5pc0V4dGVuc2lvbk9mKCB0aGlzLmdldFVuaXF1ZVRyYWlsKCkgKSApIHtcclxuICAgICAgICAgIHZpc2libGVQcm9wZXJ0eS52YWx1ZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHZpc2libGVQcm9wZXJ0eS5sYXp5TGluayggdmlzaWJsZSA9PiB7XHJcbiAgICAgIGlmICggdmlzaWJsZSApIHtcclxuICAgICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmdldFVuaXF1ZVRyYWlsKCkuZ2V0TWF0cml4VG8oIGxpc3RQYXJlbnQuZ2V0VW5pcXVlVHJhaWwoKSApO1xyXG4gICAgICAgIHBvcHVwLnNldFNjYWxlTWFnbml0dWRlKCBtYXRyaXguZ2V0U2NhbGVWZWN0b3IoKS54ICk7XHJcbiAgICAgICAgLy8gV2Ugc3VidHJhY3QgMSBvZmYgc28gdGhhdCB0aGUgc3Ryb2tlcyBsaW5lIHVwLCBhbmQgd2UgZG9uJ3QgZ2V0IGEgXCJkb3VibGUtc3Ryb2tlZFwiIGVmZmVjdC5cclxuICAgICAgICBwb3B1cC5sZWZ0VG9wID0gbWF0cml4LnRpbWVzVmVjdG9yMiggcmVjdGFuZ2xlLmxlZnRCb3R0b20ucGx1c1hZKCAwLCAtMSApICk7XHJcbiAgICAgICAgbGlzdFBhcmVudC5hZGRDaGlsZCggcG9wdXAgKTtcclxuXHJcbiAgICAgICAgcGhldC5qb2lzdC5kaXNwbGF5LmFkZElucHV0TGlzdGVuZXIoIGRpc21pc3NMaXN0ZW5lciApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGxpc3RQYXJlbnQucmVtb3ZlQ2hpbGQoIHBvcHVwICk7XHJcblxyXG4gICAgICAgIHBoZXQuam9pc3QuZGlzcGxheS5yZW1vdmVJbnB1dExpc3RlbmVyKCBkaXNtaXNzTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIHJlY3RhbmdsZS5hZGRJbnB1dExpc3RlbmVyKCB7XHJcbiAgICAgIGRvd246IGV2ZW50ID0+IHtcclxuICAgICAgICB2aXNpYmxlUHJvcGVydHkudG9nZ2xlKCk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbmFyZWFNb2RlbENvbW1vbi5yZWdpc3RlciggJ0dlbmVyaWNMYXlvdXRTZWxlY3Rpb25Ob2RlJywgR2VuZXJpY0xheW91dFNlbGVjdGlvbk5vZGUgKTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIGEgbGF5b3V0IGljb24gYmFzZWQgb24gdGhlIGdpdmVuIHNpemUuXHJcbiAqIEBwcml2YXRlXHJcbiAqXHJcbiAqIEBwYXJhbSB7RGltZW5zaW9uMn0gc2l6ZVxyXG4gKiBAcGFyYW0ge251bWJlcn0gbGluZVdpZHRoXHJcbiAqIEByZXR1cm5zIHtOb2RlfVxyXG4gKi9cclxuZnVuY3Rpb24gY3JlYXRlTGF5b3V0SWNvbiggc2l6ZSwgbGluZVdpZHRoICkge1xyXG4gIGNvbnN0IGxlbmd0aCA9IDIxO1xyXG4gIGNvbnN0IHNoYXBlID0gbmV3IFNoYXBlKCkucmVjdCggMCwgMCwgbGVuZ3RoLCBsZW5ndGggKTtcclxuICBpZiAoIHNpemUud2lkdGggPT09IDIgKSB7XHJcbiAgICBzaGFwZS5tb3ZlVG8oIGxlbmd0aCAqIEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5HRU5FUklDX0lDT05fU0lOR0xFX09GRlNFVCwgMCApLnZlcnRpY2FsTGluZVRvKCBsZW5ndGggKTtcclxuICB9XHJcbiAgZWxzZSBpZiAoIHNpemUud2lkdGggPT09IDMgKSB7XHJcbiAgICBzaGFwZS5tb3ZlVG8oIGxlbmd0aCAqIEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5HRU5FUklDX0lDT05fRklSU1RfT0ZGU0VULCAwICkudmVydGljYWxMaW5lVG8oIGxlbmd0aCApO1xyXG4gICAgc2hhcGUubW92ZVRvKCBsZW5ndGggKiBBcmVhTW9kZWxDb21tb25Db25zdGFudHMuR0VORVJJQ19JQ09OX1NFQ09ORF9PRkZTRVQsIDAgKS52ZXJ0aWNhbExpbmVUbyggbGVuZ3RoICk7XHJcbiAgfVxyXG4gIGlmICggc2l6ZS5oZWlnaHQgPT09IDIgKSB7XHJcbiAgICBzaGFwZS5tb3ZlVG8oIDAsIGxlbmd0aCAqIEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5HRU5FUklDX0lDT05fU0lOR0xFX09GRlNFVCApLmhvcml6b250YWxMaW5lVG8oIGxlbmd0aCApO1xyXG4gIH1cclxuICBlbHNlIGlmICggc2l6ZS5oZWlnaHQgPT09IDMgKSB7XHJcbiAgICBzaGFwZS5tb3ZlVG8oIDAsIGxlbmd0aCAqIEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5HRU5FUklDX0lDT05fRklSU1RfT0ZGU0VUICkuaG9yaXpvbnRhbExpbmVUbyggbGVuZ3RoICk7XHJcbiAgICBzaGFwZS5tb3ZlVG8oIDAsIGxlbmd0aCAqIEFyZWFNb2RlbENvbW1vbkNvbnN0YW50cy5HRU5FUklDX0lDT05fU0VDT05EX09GRlNFVCApLmhvcml6b250YWxMaW5lVG8oIGxlbmd0aCApO1xyXG4gIH1cclxuICByZXR1cm4gbmV3IFBhdGgoIHNoYXBlLCB7XHJcbiAgICBsaW5lV2lkdGg6IGxpbmVXaWR0aCxcclxuICAgIHN0cm9rZTogQXJlYU1vZGVsQ29tbW9uQ29sb3JzLmxheW91dEdyaWRQcm9wZXJ0eSxcclxuICAgIGZpbGw6IEFyZWFNb2RlbENvbW1vbkNvbG9ycy5sYXlvdXRJY29uRmlsbFByb3BlcnR5XHJcbiAgfSApO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBHZW5lcmljTGF5b3V0U2VsZWN0aW9uTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVB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