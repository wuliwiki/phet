// Copyright 2018-2023, University of Colorado Boulder

/**
 * This alert manager is responsible for all gravity-force-lab specific aria-live alerts.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import InverseSquareLawCommonStrings from '../../../inverse-square-law-common/js/InverseSquareLawCommonStrings.js';
import ForceValuesDisplayEnum from '../../../inverse-square-law-common/js/model/ForceValuesDisplayEnum.js';
import ISLCAlertManager from '../../../inverse-square-law-common/js/view/ISLCAlertManager.js';
import ISLCObjectEnum from '../../../inverse-square-law-common/js/model/ISLCObjectEnum.js';
import merge from '../../../phet-core/js/merge.js';
import StringUtils from '../../../phetcommon/js/util/StringUtils.js';
import { Voicing } from '../../../scenery/js/imports.js';
import ActivationUtterance from '../../../utterance-queue/js/ActivationUtterance.js';
import responseCollector from '../../../utterance-queue/js/responseCollector.js';
import Utterance from '../../../utterance-queue/js/Utterance.js';
import ValueChangeUtterance from '../../../utterance-queue/js/ValueChangeUtterance.js';
import gravityForceLab from '../gravityForceLab.js';
import GravityForceLabStrings from '../GravityForceLabStrings.js';
import GravityForceLabModel from '../model/GravityForceLabModel.js';
const constantRadiusThinkDensityPatternString = GravityForceLabStrings.a11y.controls.constantRadiusThinkDensityPattern;
const massAndForceClausesPatternString = GravityForceLabStrings.a11y.qualitative.massAndForceClausesPattern;
const sentencePatternString = GravityForceLabStrings.a11y.sentencePattern;
const voicingBriefMassChangeForceAlertWithValuePatternString = GravityForceLabStrings.a11y.voicing.briefMassChangeForceAlertWithValuePattern;
const voicingBriefMassChangeForceAlertPatternString = GravityForceLabStrings.a11y.voicing.briefMassChangeForceAlertPattern;
const voicingBiggerString = InverseSquareLawCommonStrings.a11y.voicing.bigger;
const voicingBriefMassPushAlertPatternString = GravityForceLabStrings.a11y.voicing.briefMassPushAlertPattern;
const voicingBriefPositionChangeInteractionPatternString = GravityForceLabStrings.a11y.voicing.briefPositionChangeInteractionPattern;
class GravityForceLabAlertManager extends ISLCAlertManager {
  /**
   * @param {GravityForceLabModel|GFLBModel} model
   * @param {MassDescriber} massDescriber
   * @param {ForceDescriber} forceDescriber - GFLBForceDescriber inherits directly from ForceDescriber
   * @param {Object} [options]
   */
  constructor(model, massDescriber, forceDescriber, options) {
    // Basically these options try to support BASICS and REGULAR logic duplication.
    options = merge({
      // {boolean} This should only used for gravity-force-lab
      linkToForceValuesDisplayProperty: true,
      // {function} - listener to link to the showForceValuesProperty, default listener for REGULAR is null because
      // this is only used in BASICS
      showForceValuesListener: null
    }, options);
    super(model, forceDescriber, options);

    // @private
    this.massDescriber = massDescriber;

    // @private {Utterance} - utterances for various channels of information
    this.massChangedUtterance = new ValueChangeUtterance();
    this.scientificNotationUtterance = new ActivationUtterance();

    // @public {Utterance} - When the 'constant size' changes and masses push each other away. Needs to be an Utterance
    // that does not interrupt the response from the UI control that triggered that.
    this.constantSizeChangedContextResponseUtterance = new Utterance({
      announcerOptions: {
        cancelOther: false
      }
    });
    const constantRadiusUtterance = new ActivationUtterance();
    model.constantRadiusProperty.lazyLink(constantRadius => {
      constantRadiusUtterance.alert = this.getConstantRadiusAlert(constantRadius);
      this.alertDescriptionUtterance(constantRadiusUtterance);
    });

    // use an option to support REGULAR and BASICS
    if (options.linkToForceValuesDisplayProperty) {
      assert && assert(model instanceof GravityForceLabModel, 'unsupported model for scientific notation');
      options.linkToForceValuesDisplayProperty && model.forceValuesDisplayProperty.lazyLink(() => {
        if (model.forceValuesDisplayProperty.value === ForceValuesDisplayEnum.SCIENTIFIC) {
          this.alertScientificNotation();
        } else {
          this.alertShowForceValues(model.forceValuesDisplayProperty.value !== ForceValuesDisplayEnum.HIDDEN);
        }
      });
    } else {
      assert && assert(options.showForceValuesListener, 'showForceValuesProperty is linked to if not linking to forceValuesDisplayProperty.');
      model.showForceValuesProperty.lazyLink(options.showForceValuesListener);
    }

    // link to alert when the value changes
    model.object1.valueProperty.lazyLink(() => this.alertMassValueChanged(model.object1.enum));
    model.object2.valueProperty.lazyLink(() => this.alertMassValueChanged(model.object2.enum));

    // When the value changes position, the position will change after the valueProperty has, so link a listener to
    // alert one the positions are correct, this is important to get the alerts like
    // "mass 1 gets bigger and moves mass 2 right"
    const secondaryPositionChangedListener = objectEnum => {
      // handle the case where the position changed from the constant radius being toggled
      if (model.object1.constantRadiusChangedSinceLastStep || model.object2.constantRadiusChangedSinceLastStep) {
        this.alertConstantSizeChangedPosition();
      } else {
        // value specific assumption
        this.alertMassValueChanged(objectEnum, true);
      }
    };
    model.object1.positionChangedFromSecondarySourceEmitter.addListener(secondaryPositionChangedListener);
    model.object2.positionChangedFromSecondarySourceEmitter.addListener(secondaryPositionChangedListener);
  }

  /**
   * @private
   */
  alertScientificNotation() {
    this.scientificNotationUtterance.alert = this.forceDescriber.getScientificNotationAlertText();
    this.alertDescriptionUtterance(this.scientificNotationUtterance);
  }

  /**
   * @param {ISLCObjectEnum} objectEnum
   * @param {boolean} [forceBiggerOverride] - when true, manually override the value of the force "direction change"
   *                                          from the model. This is to solve a bug where the model decreases force
   *                                          after a mass pushes the other away, see https://github.com/phetsims/gravity-force-lab-basics/issues/151
   * @private
   */
  alertMassValueChanged(objectEnum, forceBiggerOverride) {
    const contextResponse = this.getMassValueChangedAlert(objectEnum, forceBiggerOverride);
    this.alertDescriptionUtterance(contextResponse);
  }

  /**
   * Get the alert content for when the mass value changes.
   * @public
   *
   * @param {ISLCObjectEnum} objectEnum
   * @param {boolean} [forceBiggerOverride]
   * @returns {Utterance}
   */
  getMassValueChangedAlert(objectEnum, forceBiggerOverride) {
    let massClause = this.massDescriber.getMassOrDensityChangeClause(objectEnum);

    // if changing the mass of an object caused one of the masses to move position
    if (this.model.massWasPushed()) {
      massClause = this.massDescriber.getMassChangesAndMovesClause(objectEnum);
      if (this.model.pushedObjectEnumProperty.value !== objectEnum) {
        massClause = this.massDescriber.getMassChangesAndMovesOtherClause(objectEnum);
      }
    }
    this.massChangedUtterance.alert = StringUtils.fillIn(massAndForceClausesPatternString, {
      massClause: massClause,
      forceClause: this.forceDescriber.getVectorChangeClause(forceBiggerOverride, false)
    });
    return this.massChangedUtterance;
  }

  /**
   * PROTOTYPE CODE: Gets an alert to be read when the mass changes AND due to increasing size pushes the other mass a bit.
   * This is used in the voicing prototype, when in "brief interactive" output.
   * @private
   *
   * @param {ISLCObjectEnum} objectEnum
   * @returns {string}
   */
  getVoicingForceChangeFromMassWithPushAlert(objectEnum) {
    const forceValuesShown = this.model.showForceValuesProperty.get();
    const valueString = this.forceDescriber.getFormattedForce();
    let newForceString;
    if (forceValuesShown) {
      newForceString = StringUtils.fillIn(voicingBriefMassChangeForceAlertWithValuePatternString, {
        forceChange: voicingBiggerString,
        value: valueString
      });
    } else {
      newForceString = StringUtils.fillIn(voicingBriefMassChangeForceAlertPatternString, {
        forceChange: voicingBiggerString
      });
    }
    const pushAlertString = StringUtils.fillIn(voicingBriefMassPushAlertPatternString, {
      object1: this.forceDescriber.getObjectLabelFromEnum(objectEnum),
      object2: this.forceDescriber.getOtherObjectLabelFromEnum(objectEnum),
      direction: this.massDescriber.getPushDirectionText(ISLCObjectEnum.getOtherObjectEnum(objectEnum)),
      forceAlert: newForceString
    });
    const valueText = this.massDescriber.getMassAndUnit(objectEnum);
    return StringUtils.fillIn(voicingBriefPositionChangeInteractionPatternString, {
      valueText: valueText,
      forceAlert: pushAlertString
    });
  }

  /**
   * Get an alert for when masses radius becomes constant or dynamic.
   * @public
   *
   * @param {boolean} constantRadius
   * @returns {string}
   */
  getConstantRadiusAlert(constantRadius) {
    const constantRadiusAlert = StringUtils.fillIn(constantRadiusThinkDensityPatternString, {
      // use forceDescriber just for the sim specific object labels, could be any ISLCDescriber
      mass1: this.forceDescriber.object1Label,
      mass2: this.forceDescriber.object2Label
    });
    return constantRadius ? constantRadiusAlert : this.massDescriber.getM1RelativeSize();
  }

  /**
   * Alert the "border" alert when attempting to change the mass, but already at the min or max of it, see https://github.com/phetsims/gravity-force-lab/issues/155
   * @private
   * @param {ISLCObjectEnum} thisObjectEnum
   */
  alertMassMinMaxEdge(thisObjectEnum) {
    this.massChangedUtterance.alert = this.massDescriber.getMassMaxMinText(thisObjectEnum);
    this.alertDescriptionUtterance(this.massChangedUtterance);
  }

  /**
   * @private
   */
  alertConstantSizeChangedPosition() {
    const contextResponse = StringUtils.fillIn(sentencePatternString, {
      sentence: this.forceDescriber.getVectorChangeClause(false, true)
    });
    this.massChangedUtterance.alert = contextResponse;
    this.alertDescriptionUtterance(this.massChangedUtterance);

    // voicing - Create the alert to be used with voicing. Ideally this would be the context response for the
    // UI component that controls whether masses are of constant size. But this alert needs information about
    // whether positions were changed, which happens later in the model during step, so it needs to be
    // created here.

    // include information as selected by user preferences
    const voicingAlertString = responseCollector.collectResponses({
      contextResponse: contextResponse
    });
    this.constantSizeChangedContextResponseUtterance.alert = voicingAlertString;
    Voicing.alertUtterance(this.constantSizeChangedContextResponseUtterance);
  }
}
gravityForceLab.register('GravityForceLabAlertManager', GravityForceLabAlertManager);
export default GravityForceLabAlertManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJJbnZlcnNlU3F1YXJlTGF3Q29tbW9uU3RyaW5ncyIsIkZvcmNlVmFsdWVzRGlzcGxheUVudW0iLCJJU0xDQWxlcnRNYW5hZ2VyIiwiSVNMQ09iamVjdEVudW0iLCJtZXJnZSIsIlN0cmluZ1V0aWxzIiwiVm9pY2luZyIsIkFjdGl2YXRpb25VdHRlcmFuY2UiLCJyZXNwb25zZUNvbGxlY3RvciIsIlV0dGVyYW5jZSIsIlZhbHVlQ2hhbmdlVXR0ZXJhbmNlIiwiZ3Jhdml0eUZvcmNlTGFiIiwiR3Jhdml0eUZvcmNlTGFiU3RyaW5ncyIsIkdyYXZpdHlGb3JjZUxhYk1vZGVsIiwiY29uc3RhbnRSYWRpdXNUaGlua0RlbnNpdHlQYXR0ZXJuU3RyaW5nIiwiYTExeSIsImNvbnRyb2xzIiwiY29uc3RhbnRSYWRpdXNUaGlua0RlbnNpdHlQYXR0ZXJuIiwibWFzc0FuZEZvcmNlQ2xhdXNlc1BhdHRlcm5TdHJpbmciLCJxdWFsaXRhdGl2ZSIsIm1hc3NBbmRGb3JjZUNsYXVzZXNQYXR0ZXJuIiwic2VudGVuY2VQYXR0ZXJuU3RyaW5nIiwic2VudGVuY2VQYXR0ZXJuIiwidm9pY2luZ0JyaWVmTWFzc0NoYW5nZUZvcmNlQWxlcnRXaXRoVmFsdWVQYXR0ZXJuU3RyaW5nIiwidm9pY2luZyIsImJyaWVmTWFzc0NoYW5nZUZvcmNlQWxlcnRXaXRoVmFsdWVQYXR0ZXJuIiwidm9pY2luZ0JyaWVmTWFzc0NoYW5nZUZvcmNlQWxlcnRQYXR0ZXJuU3RyaW5nIiwiYnJpZWZNYXNzQ2hhbmdlRm9yY2VBbGVydFBhdHRlcm4iLCJ2b2ljaW5nQmlnZ2VyU3RyaW5nIiwiYmlnZ2VyIiwidm9pY2luZ0JyaWVmTWFzc1B1c2hBbGVydFBhdHRlcm5TdHJpbmciLCJicmllZk1hc3NQdXNoQWxlcnRQYXR0ZXJuIiwidm9pY2luZ0JyaWVmUG9zaXRpb25DaGFuZ2VJbnRlcmFjdGlvblBhdHRlcm5TdHJpbmciLCJicmllZlBvc2l0aW9uQ2hhbmdlSW50ZXJhY3Rpb25QYXR0ZXJuIiwiR3Jhdml0eUZvcmNlTGFiQWxlcnRNYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJtb2RlbCIsIm1hc3NEZXNjcmliZXIiLCJmb3JjZURlc2NyaWJlciIsIm9wdGlvbnMiLCJsaW5rVG9Gb3JjZVZhbHVlc0Rpc3BsYXlQcm9wZXJ0eSIsInNob3dGb3JjZVZhbHVlc0xpc3RlbmVyIiwibWFzc0NoYW5nZWRVdHRlcmFuY2UiLCJzY2llbnRpZmljTm90YXRpb25VdHRlcmFuY2UiLCJjb25zdGFudFNpemVDaGFuZ2VkQ29udGV4dFJlc3BvbnNlVXR0ZXJhbmNlIiwiYW5ub3VuY2VyT3B0aW9ucyIsImNhbmNlbE90aGVyIiwiY29uc3RhbnRSYWRpdXNVdHRlcmFuY2UiLCJjb25zdGFudFJhZGl1c1Byb3BlcnR5IiwibGF6eUxpbmsiLCJjb25zdGFudFJhZGl1cyIsImFsZXJ0IiwiZ2V0Q29uc3RhbnRSYWRpdXNBbGVydCIsImFsZXJ0RGVzY3JpcHRpb25VdHRlcmFuY2UiLCJhc3NlcnQiLCJmb3JjZVZhbHVlc0Rpc3BsYXlQcm9wZXJ0eSIsInZhbHVlIiwiU0NJRU5USUZJQyIsImFsZXJ0U2NpZW50aWZpY05vdGF0aW9uIiwiYWxlcnRTaG93Rm9yY2VWYWx1ZXMiLCJISURERU4iLCJzaG93Rm9yY2VWYWx1ZXNQcm9wZXJ0eSIsIm9iamVjdDEiLCJ2YWx1ZVByb3BlcnR5IiwiYWxlcnRNYXNzVmFsdWVDaGFuZ2VkIiwiZW51bSIsIm9iamVjdDIiLCJzZWNvbmRhcnlQb3NpdGlvbkNoYW5nZWRMaXN0ZW5lciIsIm9iamVjdEVudW0iLCJjb25zdGFudFJhZGl1c0NoYW5nZWRTaW5jZUxhc3RTdGVwIiwiYWxlcnRDb25zdGFudFNpemVDaGFuZ2VkUG9zaXRpb24iLCJwb3NpdGlvbkNoYW5nZWRGcm9tU2Vjb25kYXJ5U291cmNlRW1pdHRlciIsImFkZExpc3RlbmVyIiwiZ2V0U2NpZW50aWZpY05vdGF0aW9uQWxlcnRUZXh0IiwiZm9yY2VCaWdnZXJPdmVycmlkZSIsImNvbnRleHRSZXNwb25zZSIsImdldE1hc3NWYWx1ZUNoYW5nZWRBbGVydCIsIm1hc3NDbGF1c2UiLCJnZXRNYXNzT3JEZW5zaXR5Q2hhbmdlQ2xhdXNlIiwibWFzc1dhc1B1c2hlZCIsImdldE1hc3NDaGFuZ2VzQW5kTW92ZXNDbGF1c2UiLCJwdXNoZWRPYmplY3RFbnVtUHJvcGVydHkiLCJnZXRNYXNzQ2hhbmdlc0FuZE1vdmVzT3RoZXJDbGF1c2UiLCJmaWxsSW4iLCJmb3JjZUNsYXVzZSIsImdldFZlY3RvckNoYW5nZUNsYXVzZSIsImdldFZvaWNpbmdGb3JjZUNoYW5nZUZyb21NYXNzV2l0aFB1c2hBbGVydCIsImZvcmNlVmFsdWVzU2hvd24iLCJnZXQiLCJ2YWx1ZVN0cmluZyIsImdldEZvcm1hdHRlZEZvcmNlIiwibmV3Rm9yY2VTdHJpbmciLCJmb3JjZUNoYW5nZSIsInB1c2hBbGVydFN0cmluZyIsImdldE9iamVjdExhYmVsRnJvbUVudW0iLCJnZXRPdGhlck9iamVjdExhYmVsRnJvbUVudW0iLCJkaXJlY3Rpb24iLCJnZXRQdXNoRGlyZWN0aW9uVGV4dCIsImdldE90aGVyT2JqZWN0RW51bSIsImZvcmNlQWxlcnQiLCJ2YWx1ZVRleHQiLCJnZXRNYXNzQW5kVW5pdCIsImNvbnN0YW50UmFkaXVzQWxlcnQiLCJtYXNzMSIsIm9iamVjdDFMYWJlbCIsIm1hc3MyIiwib2JqZWN0MkxhYmVsIiwiZ2V0TTFSZWxhdGl2ZVNpemUiLCJhbGVydE1hc3NNaW5NYXhFZGdlIiwidGhpc09iamVjdEVudW0iLCJnZXRNYXNzTWF4TWluVGV4dCIsInNlbnRlbmNlIiwidm9pY2luZ0FsZXJ0U3RyaW5nIiwiY29sbGVjdFJlc3BvbnNlcyIsImFsZXJ0VXR0ZXJhbmNlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJHcmF2aXR5Rm9yY2VMYWJBbGVydE1hbmFnZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhpcyBhbGVydCBtYW5hZ2VyIGlzIHJlc3BvbnNpYmxlIGZvciBhbGwgZ3Jhdml0eS1mb3JjZS1sYWIgc3BlY2lmaWMgYXJpYS1saXZlIGFsZXJ0cy5cclxuICpcclxuICogQGF1dGhvciBNaWNoYWVsIEthdXptYW5uIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBJbnZlcnNlU3F1YXJlTGF3Q29tbW9uU3RyaW5ncyBmcm9tICcuLi8uLi8uLi9pbnZlcnNlLXNxdWFyZS1sYXctY29tbW9uL2pzL0ludmVyc2VTcXVhcmVMYXdDb21tb25TdHJpbmdzLmpzJztcclxuaW1wb3J0IEZvcmNlVmFsdWVzRGlzcGxheUVudW0gZnJvbSAnLi4vLi4vLi4vaW52ZXJzZS1zcXVhcmUtbGF3LWNvbW1vbi9qcy9tb2RlbC9Gb3JjZVZhbHVlc0Rpc3BsYXlFbnVtLmpzJztcclxuaW1wb3J0IElTTENBbGVydE1hbmFnZXIgZnJvbSAnLi4vLi4vLi4vaW52ZXJzZS1zcXVhcmUtbGF3LWNvbW1vbi9qcy92aWV3L0lTTENBbGVydE1hbmFnZXIuanMnO1xyXG5pbXBvcnQgSVNMQ09iamVjdEVudW0gZnJvbSAnLi4vLi4vLi4vaW52ZXJzZS1zcXVhcmUtbGF3LWNvbW1vbi9qcy9tb2RlbC9JU0xDT2JqZWN0RW51bS5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IHsgVm9pY2luZyB9IGZyb20gJy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBBY3RpdmF0aW9uVXR0ZXJhbmNlIGZyb20gJy4uLy4uLy4uL3V0dGVyYW5jZS1xdWV1ZS9qcy9BY3RpdmF0aW9uVXR0ZXJhbmNlLmpzJztcclxuaW1wb3J0IHJlc3BvbnNlQ29sbGVjdG9yIGZyb20gJy4uLy4uLy4uL3V0dGVyYW5jZS1xdWV1ZS9qcy9yZXNwb25zZUNvbGxlY3Rvci5qcyc7XHJcbmltcG9ydCBVdHRlcmFuY2UgZnJvbSAnLi4vLi4vLi4vdXR0ZXJhbmNlLXF1ZXVlL2pzL1V0dGVyYW5jZS5qcyc7XHJcbmltcG9ydCBWYWx1ZUNoYW5nZVV0dGVyYW5jZSBmcm9tICcuLi8uLi8uLi91dHRlcmFuY2UtcXVldWUvanMvVmFsdWVDaGFuZ2VVdHRlcmFuY2UuanMnO1xyXG5pbXBvcnQgZ3Jhdml0eUZvcmNlTGFiIGZyb20gJy4uL2dyYXZpdHlGb3JjZUxhYi5qcyc7XHJcbmltcG9ydCBHcmF2aXR5Rm9yY2VMYWJTdHJpbmdzIGZyb20gJy4uL0dyYXZpdHlGb3JjZUxhYlN0cmluZ3MuanMnO1xyXG5pbXBvcnQgR3Jhdml0eUZvcmNlTGFiTW9kZWwgZnJvbSAnLi4vbW9kZWwvR3Jhdml0eUZvcmNlTGFiTW9kZWwuanMnO1xyXG5cclxuY29uc3QgY29uc3RhbnRSYWRpdXNUaGlua0RlbnNpdHlQYXR0ZXJuU3RyaW5nID0gR3Jhdml0eUZvcmNlTGFiU3RyaW5ncy5hMTF5LmNvbnRyb2xzLmNvbnN0YW50UmFkaXVzVGhpbmtEZW5zaXR5UGF0dGVybjtcclxuY29uc3QgbWFzc0FuZEZvcmNlQ2xhdXNlc1BhdHRlcm5TdHJpbmcgPSBHcmF2aXR5Rm9yY2VMYWJTdHJpbmdzLmExMXkucXVhbGl0YXRpdmUubWFzc0FuZEZvcmNlQ2xhdXNlc1BhdHRlcm47XHJcbmNvbnN0IHNlbnRlbmNlUGF0dGVyblN0cmluZyA9IEdyYXZpdHlGb3JjZUxhYlN0cmluZ3MuYTExeS5zZW50ZW5jZVBhdHRlcm47XHJcbmNvbnN0IHZvaWNpbmdCcmllZk1hc3NDaGFuZ2VGb3JjZUFsZXJ0V2l0aFZhbHVlUGF0dGVyblN0cmluZyA9IEdyYXZpdHlGb3JjZUxhYlN0cmluZ3MuYTExeS52b2ljaW5nLmJyaWVmTWFzc0NoYW5nZUZvcmNlQWxlcnRXaXRoVmFsdWVQYXR0ZXJuO1xyXG5jb25zdCB2b2ljaW5nQnJpZWZNYXNzQ2hhbmdlRm9yY2VBbGVydFBhdHRlcm5TdHJpbmcgPSBHcmF2aXR5Rm9yY2VMYWJTdHJpbmdzLmExMXkudm9pY2luZy5icmllZk1hc3NDaGFuZ2VGb3JjZUFsZXJ0UGF0dGVybjtcclxuY29uc3Qgdm9pY2luZ0JpZ2dlclN0cmluZyA9IEludmVyc2VTcXVhcmVMYXdDb21tb25TdHJpbmdzLmExMXkudm9pY2luZy5iaWdnZXI7XHJcbmNvbnN0IHZvaWNpbmdCcmllZk1hc3NQdXNoQWxlcnRQYXR0ZXJuU3RyaW5nID0gR3Jhdml0eUZvcmNlTGFiU3RyaW5ncy5hMTF5LnZvaWNpbmcuYnJpZWZNYXNzUHVzaEFsZXJ0UGF0dGVybjtcclxuY29uc3Qgdm9pY2luZ0JyaWVmUG9zaXRpb25DaGFuZ2VJbnRlcmFjdGlvblBhdHRlcm5TdHJpbmcgPSBHcmF2aXR5Rm9yY2VMYWJTdHJpbmdzLmExMXkudm9pY2luZy5icmllZlBvc2l0aW9uQ2hhbmdlSW50ZXJhY3Rpb25QYXR0ZXJuO1xyXG5cclxuY2xhc3MgR3Jhdml0eUZvcmNlTGFiQWxlcnRNYW5hZ2VyIGV4dGVuZHMgSVNMQ0FsZXJ0TWFuYWdlciB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7R3Jhdml0eUZvcmNlTGFiTW9kZWx8R0ZMQk1vZGVsfSBtb2RlbFxyXG4gICAqIEBwYXJhbSB7TWFzc0Rlc2NyaWJlcn0gbWFzc0Rlc2NyaWJlclxyXG4gICAqIEBwYXJhbSB7Rm9yY2VEZXNjcmliZXJ9IGZvcmNlRGVzY3JpYmVyIC0gR0ZMQkZvcmNlRGVzY3JpYmVyIGluaGVyaXRzIGRpcmVjdGx5IGZyb20gRm9yY2VEZXNjcmliZXJcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1vZGVsLCBtYXNzRGVzY3JpYmVyLCBmb3JjZURlc2NyaWJlciwgb3B0aW9ucyApIHtcclxuXHJcbiAgICAvLyBCYXNpY2FsbHkgdGhlc2Ugb3B0aW9ucyB0cnkgdG8gc3VwcG9ydCBCQVNJQ1MgYW5kIFJFR1VMQVIgbG9naWMgZHVwbGljYXRpb24uXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuXHJcbiAgICAgIC8vIHtib29sZWFufSBUaGlzIHNob3VsZCBvbmx5IHVzZWQgZm9yIGdyYXZpdHktZm9yY2UtbGFiXHJcbiAgICAgIGxpbmtUb0ZvcmNlVmFsdWVzRGlzcGxheVByb3BlcnR5OiB0cnVlLFxyXG5cclxuICAgICAgLy8ge2Z1bmN0aW9ufSAtIGxpc3RlbmVyIHRvIGxpbmsgdG8gdGhlIHNob3dGb3JjZVZhbHVlc1Byb3BlcnR5LCBkZWZhdWx0IGxpc3RlbmVyIGZvciBSRUdVTEFSIGlzIG51bGwgYmVjYXVzZVxyXG4gICAgICAvLyB0aGlzIGlzIG9ubHkgdXNlZCBpbiBCQVNJQ1NcclxuICAgICAgc2hvd0ZvcmNlVmFsdWVzTGlzdGVuZXI6IG51bGxcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggbW9kZWwsIGZvcmNlRGVzY3JpYmVyLCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMubWFzc0Rlc2NyaWJlciA9IG1hc3NEZXNjcmliZXI7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge1V0dGVyYW5jZX0gLSB1dHRlcmFuY2VzIGZvciB2YXJpb3VzIGNoYW5uZWxzIG9mIGluZm9ybWF0aW9uXHJcbiAgICB0aGlzLm1hc3NDaGFuZ2VkVXR0ZXJhbmNlID0gbmV3IFZhbHVlQ2hhbmdlVXR0ZXJhbmNlKCk7XHJcbiAgICB0aGlzLnNjaWVudGlmaWNOb3RhdGlvblV0dGVyYW5jZSA9IG5ldyBBY3RpdmF0aW9uVXR0ZXJhbmNlKCk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7VXR0ZXJhbmNlfSAtIFdoZW4gdGhlICdjb25zdGFudCBzaXplJyBjaGFuZ2VzIGFuZCBtYXNzZXMgcHVzaCBlYWNoIG90aGVyIGF3YXkuIE5lZWRzIHRvIGJlIGFuIFV0dGVyYW5jZVxyXG4gICAgLy8gdGhhdCBkb2VzIG5vdCBpbnRlcnJ1cHQgdGhlIHJlc3BvbnNlIGZyb20gdGhlIFVJIGNvbnRyb2wgdGhhdCB0cmlnZ2VyZWQgdGhhdC5cclxuICAgIHRoaXMuY29uc3RhbnRTaXplQ2hhbmdlZENvbnRleHRSZXNwb25zZVV0dGVyYW5jZSA9IG5ldyBVdHRlcmFuY2UoIHtcclxuICAgICAgYW5ub3VuY2VyT3B0aW9uczoge1xyXG4gICAgICAgIGNhbmNlbE90aGVyOiBmYWxzZVxyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgY29uc3RhbnRSYWRpdXNVdHRlcmFuY2UgPSBuZXcgQWN0aXZhdGlvblV0dGVyYW5jZSgpO1xyXG5cclxuICAgIG1vZGVsLmNvbnN0YW50UmFkaXVzUHJvcGVydHkubGF6eUxpbmsoIGNvbnN0YW50UmFkaXVzID0+IHtcclxuICAgICAgY29uc3RhbnRSYWRpdXNVdHRlcmFuY2UuYWxlcnQgPSB0aGlzLmdldENvbnN0YW50UmFkaXVzQWxlcnQoIGNvbnN0YW50UmFkaXVzICk7XHJcbiAgICAgIHRoaXMuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggY29uc3RhbnRSYWRpdXNVdHRlcmFuY2UgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB1c2UgYW4gb3B0aW9uIHRvIHN1cHBvcnQgUkVHVUxBUiBhbmQgQkFTSUNTXHJcbiAgICBpZiAoIG9wdGlvbnMubGlua1RvRm9yY2VWYWx1ZXNEaXNwbGF5UHJvcGVydHkgKSB7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIG1vZGVsIGluc3RhbmNlb2YgR3Jhdml0eUZvcmNlTGFiTW9kZWwsICd1bnN1cHBvcnRlZCBtb2RlbCBmb3Igc2NpZW50aWZpYyBub3RhdGlvbicgKTtcclxuICAgICAgb3B0aW9ucy5saW5rVG9Gb3JjZVZhbHVlc0Rpc3BsYXlQcm9wZXJ0eSAmJiBtb2RlbC5mb3JjZVZhbHVlc0Rpc3BsYXlQcm9wZXJ0eS5sYXp5TGluayggKCkgPT4ge1xyXG5cclxuICAgICAgICBpZiAoIG1vZGVsLmZvcmNlVmFsdWVzRGlzcGxheVByb3BlcnR5LnZhbHVlID09PSBGb3JjZVZhbHVlc0Rpc3BsYXlFbnVtLlNDSUVOVElGSUMgKSB7XHJcbiAgICAgICAgICB0aGlzLmFsZXJ0U2NpZW50aWZpY05vdGF0aW9uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5hbGVydFNob3dGb3JjZVZhbHVlcyggbW9kZWwuZm9yY2VWYWx1ZXNEaXNwbGF5UHJvcGVydHkudmFsdWUgIT09IEZvcmNlVmFsdWVzRGlzcGxheUVudW0uSElEREVOICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5zaG93Rm9yY2VWYWx1ZXNMaXN0ZW5lcixcclxuICAgICAgICAnc2hvd0ZvcmNlVmFsdWVzUHJvcGVydHkgaXMgbGlua2VkIHRvIGlmIG5vdCBsaW5raW5nIHRvIGZvcmNlVmFsdWVzRGlzcGxheVByb3BlcnR5LicgKTtcclxuICAgICAgbW9kZWwuc2hvd0ZvcmNlVmFsdWVzUHJvcGVydHkubGF6eUxpbmsoIG9wdGlvbnMuc2hvd0ZvcmNlVmFsdWVzTGlzdGVuZXIgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBsaW5rIHRvIGFsZXJ0IHdoZW4gdGhlIHZhbHVlIGNoYW5nZXNcclxuICAgIG1vZGVsLm9iamVjdDEudmFsdWVQcm9wZXJ0eS5sYXp5TGluayggKCkgPT4gdGhpcy5hbGVydE1hc3NWYWx1ZUNoYW5nZWQoIG1vZGVsLm9iamVjdDEuZW51bSApICk7XHJcbiAgICBtb2RlbC5vYmplY3QyLnZhbHVlUHJvcGVydHkubGF6eUxpbmsoICgpID0+IHRoaXMuYWxlcnRNYXNzVmFsdWVDaGFuZ2VkKCBtb2RlbC5vYmplY3QyLmVudW0gKSApO1xyXG5cclxuICAgIC8vIFdoZW4gdGhlIHZhbHVlIGNoYW5nZXMgcG9zaXRpb24sIHRoZSBwb3NpdGlvbiB3aWxsIGNoYW5nZSBhZnRlciB0aGUgdmFsdWVQcm9wZXJ0eSBoYXMsIHNvIGxpbmsgYSBsaXN0ZW5lciB0b1xyXG4gICAgLy8gYWxlcnQgb25lIHRoZSBwb3NpdGlvbnMgYXJlIGNvcnJlY3QsIHRoaXMgaXMgaW1wb3J0YW50IHRvIGdldCB0aGUgYWxlcnRzIGxpa2VcclxuICAgIC8vIFwibWFzcyAxIGdldHMgYmlnZ2VyIGFuZCBtb3ZlcyBtYXNzIDIgcmlnaHRcIlxyXG4gICAgY29uc3Qgc2Vjb25kYXJ5UG9zaXRpb25DaGFuZ2VkTGlzdGVuZXIgPSBvYmplY3RFbnVtID0+IHtcclxuXHJcbiAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgcG9zaXRpb24gY2hhbmdlZCBmcm9tIHRoZSBjb25zdGFudCByYWRpdXMgYmVpbmcgdG9nZ2xlZFxyXG4gICAgICBpZiAoIG1vZGVsLm9iamVjdDEuY29uc3RhbnRSYWRpdXNDaGFuZ2VkU2luY2VMYXN0U3RlcCB8fCBtb2RlbC5vYmplY3QyLmNvbnN0YW50UmFkaXVzQ2hhbmdlZFNpbmNlTGFzdFN0ZXAgKSB7XHJcbiAgICAgICAgdGhpcy5hbGVydENvbnN0YW50U2l6ZUNoYW5nZWRQb3NpdGlvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgeyAvLyB2YWx1ZSBzcGVjaWZpYyBhc3N1bXB0aW9uXHJcbiAgICAgICAgdGhpcy5hbGVydE1hc3NWYWx1ZUNoYW5nZWQoIG9iamVjdEVudW0sIHRydWUgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIG1vZGVsLm9iamVjdDEucG9zaXRpb25DaGFuZ2VkRnJvbVNlY29uZGFyeVNvdXJjZUVtaXR0ZXIuYWRkTGlzdGVuZXIoIHNlY29uZGFyeVBvc2l0aW9uQ2hhbmdlZExpc3RlbmVyICk7XHJcbiAgICBtb2RlbC5vYmplY3QyLnBvc2l0aW9uQ2hhbmdlZEZyb21TZWNvbmRhcnlTb3VyY2VFbWl0dGVyLmFkZExpc3RlbmVyKCBzZWNvbmRhcnlQb3NpdGlvbkNoYW5nZWRMaXN0ZW5lciApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBhbGVydFNjaWVudGlmaWNOb3RhdGlvbigpIHtcclxuICAgIHRoaXMuc2NpZW50aWZpY05vdGF0aW9uVXR0ZXJhbmNlLmFsZXJ0ID0gdGhpcy5mb3JjZURlc2NyaWJlci5nZXRTY2llbnRpZmljTm90YXRpb25BbGVydFRleHQoKTtcclxuICAgIHRoaXMuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggdGhpcy5zY2llbnRpZmljTm90YXRpb25VdHRlcmFuY2UgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7SVNMQ09iamVjdEVudW19IG9iamVjdEVudW1cclxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtmb3JjZUJpZ2dlck92ZXJyaWRlXSAtIHdoZW4gdHJ1ZSwgbWFudWFsbHkgb3ZlcnJpZGUgdGhlIHZhbHVlIG9mIHRoZSBmb3JjZSBcImRpcmVjdGlvbiBjaGFuZ2VcIlxyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSB0aGUgbW9kZWwuIFRoaXMgaXMgdG8gc29sdmUgYSBidWcgd2hlcmUgdGhlIG1vZGVsIGRlY3JlYXNlcyBmb3JjZVxyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXIgYSBtYXNzIHB1c2hlcyB0aGUgb3RoZXIgYXdheSwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmF2aXR5LWZvcmNlLWxhYi1iYXNpY3MvaXNzdWVzLzE1MVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgYWxlcnRNYXNzVmFsdWVDaGFuZ2VkKCBvYmplY3RFbnVtLCBmb3JjZUJpZ2dlck92ZXJyaWRlICkge1xyXG4gICAgY29uc3QgY29udGV4dFJlc3BvbnNlID0gdGhpcy5nZXRNYXNzVmFsdWVDaGFuZ2VkQWxlcnQoIG9iamVjdEVudW0sIGZvcmNlQmlnZ2VyT3ZlcnJpZGUgKTtcclxuICAgIHRoaXMuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggY29udGV4dFJlc3BvbnNlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIGFsZXJ0IGNvbnRlbnQgZm9yIHdoZW4gdGhlIG1hc3MgdmFsdWUgY2hhbmdlcy5cclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge0lTTENPYmplY3RFbnVtfSBvYmplY3RFbnVtXHJcbiAgICogQHBhcmFtIHtib29sZWFufSBbZm9yY2VCaWdnZXJPdmVycmlkZV1cclxuICAgKiBAcmV0dXJucyB7VXR0ZXJhbmNlfVxyXG4gICAqL1xyXG4gIGdldE1hc3NWYWx1ZUNoYW5nZWRBbGVydCggb2JqZWN0RW51bSwgZm9yY2VCaWdnZXJPdmVycmlkZSApIHtcclxuICAgIGxldCBtYXNzQ2xhdXNlID0gdGhpcy5tYXNzRGVzY3JpYmVyLmdldE1hc3NPckRlbnNpdHlDaGFuZ2VDbGF1c2UoIG9iamVjdEVudW0gKTtcclxuXHJcbiAgICAvLyBpZiBjaGFuZ2luZyB0aGUgbWFzcyBvZiBhbiBvYmplY3QgY2F1c2VkIG9uZSBvZiB0aGUgbWFzc2VzIHRvIG1vdmUgcG9zaXRpb25cclxuICAgIGlmICggdGhpcy5tb2RlbC5tYXNzV2FzUHVzaGVkKCkgKSB7XHJcbiAgICAgIG1hc3NDbGF1c2UgPSB0aGlzLm1hc3NEZXNjcmliZXIuZ2V0TWFzc0NoYW5nZXNBbmRNb3Zlc0NsYXVzZSggb2JqZWN0RW51bSApO1xyXG4gICAgICBpZiAoIHRoaXMubW9kZWwucHVzaGVkT2JqZWN0RW51bVByb3BlcnR5LnZhbHVlICE9PSBvYmplY3RFbnVtICkge1xyXG4gICAgICAgIG1hc3NDbGF1c2UgPSB0aGlzLm1hc3NEZXNjcmliZXIuZ2V0TWFzc0NoYW5nZXNBbmRNb3Zlc090aGVyQ2xhdXNlKCBvYmplY3RFbnVtICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm1hc3NDaGFuZ2VkVXR0ZXJhbmNlLmFsZXJ0ID0gU3RyaW5nVXRpbHMuZmlsbEluKCBtYXNzQW5kRm9yY2VDbGF1c2VzUGF0dGVyblN0cmluZywge1xyXG4gICAgICBtYXNzQ2xhdXNlOiBtYXNzQ2xhdXNlLFxyXG4gICAgICBmb3JjZUNsYXVzZTogdGhpcy5mb3JjZURlc2NyaWJlci5nZXRWZWN0b3JDaGFuZ2VDbGF1c2UoIGZvcmNlQmlnZ2VyT3ZlcnJpZGUsIGZhbHNlIClcclxuICAgIH0gKTtcclxuICAgIHJldHVybiB0aGlzLm1hc3NDaGFuZ2VkVXR0ZXJhbmNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUFJPVE9UWVBFIENPREU6IEdldHMgYW4gYWxlcnQgdG8gYmUgcmVhZCB3aGVuIHRoZSBtYXNzIGNoYW5nZXMgQU5EIGR1ZSB0byBpbmNyZWFzaW5nIHNpemUgcHVzaGVzIHRoZSBvdGhlciBtYXNzIGEgYml0LlxyXG4gICAqIFRoaXMgaXMgdXNlZCBpbiB0aGUgdm9pY2luZyBwcm90b3R5cGUsIHdoZW4gaW4gXCJicmllZiBpbnRlcmFjdGl2ZVwiIG91dHB1dC5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtJU0xDT2JqZWN0RW51bX0gb2JqZWN0RW51bVxyXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAgICovXHJcbiAgZ2V0Vm9pY2luZ0ZvcmNlQ2hhbmdlRnJvbU1hc3NXaXRoUHVzaEFsZXJ0KCBvYmplY3RFbnVtICkge1xyXG5cclxuICAgIGNvbnN0IGZvcmNlVmFsdWVzU2hvd24gPSB0aGlzLm1vZGVsLnNob3dGb3JjZVZhbHVlc1Byb3BlcnR5LmdldCgpO1xyXG4gICAgY29uc3QgdmFsdWVTdHJpbmcgPSB0aGlzLmZvcmNlRGVzY3JpYmVyLmdldEZvcm1hdHRlZEZvcmNlKCk7XHJcblxyXG4gICAgbGV0IG5ld0ZvcmNlU3RyaW5nO1xyXG4gICAgaWYgKCBmb3JjZVZhbHVlc1Nob3duICkge1xyXG4gICAgICBuZXdGb3JjZVN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggdm9pY2luZ0JyaWVmTWFzc0NoYW5nZUZvcmNlQWxlcnRXaXRoVmFsdWVQYXR0ZXJuU3RyaW5nLCB7XHJcbiAgICAgICAgZm9yY2VDaGFuZ2U6IHZvaWNpbmdCaWdnZXJTdHJpbmcsXHJcbiAgICAgICAgdmFsdWU6IHZhbHVlU3RyaW5nXHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBuZXdGb3JjZVN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggdm9pY2luZ0JyaWVmTWFzc0NoYW5nZUZvcmNlQWxlcnRQYXR0ZXJuU3RyaW5nLCB7XHJcbiAgICAgICAgZm9yY2VDaGFuZ2U6IHZvaWNpbmdCaWdnZXJTdHJpbmdcclxuICAgICAgfSApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHB1c2hBbGVydFN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggdm9pY2luZ0JyaWVmTWFzc1B1c2hBbGVydFBhdHRlcm5TdHJpbmcsIHtcclxuICAgICAgb2JqZWN0MTogdGhpcy5mb3JjZURlc2NyaWJlci5nZXRPYmplY3RMYWJlbEZyb21FbnVtKCBvYmplY3RFbnVtICksXHJcbiAgICAgIG9iamVjdDI6IHRoaXMuZm9yY2VEZXNjcmliZXIuZ2V0T3RoZXJPYmplY3RMYWJlbEZyb21FbnVtKCBvYmplY3RFbnVtICksXHJcbiAgICAgIGRpcmVjdGlvbjogdGhpcy5tYXNzRGVzY3JpYmVyLmdldFB1c2hEaXJlY3Rpb25UZXh0KCBJU0xDT2JqZWN0RW51bS5nZXRPdGhlck9iamVjdEVudW0oIG9iamVjdEVudW0gKSApLFxyXG4gICAgICBmb3JjZUFsZXJ0OiBuZXdGb3JjZVN0cmluZ1xyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHZhbHVlVGV4dCA9IHRoaXMubWFzc0Rlc2NyaWJlci5nZXRNYXNzQW5kVW5pdCggb2JqZWN0RW51bSApO1xyXG4gICAgcmV0dXJuIFN0cmluZ1V0aWxzLmZpbGxJbiggdm9pY2luZ0JyaWVmUG9zaXRpb25DaGFuZ2VJbnRlcmFjdGlvblBhdHRlcm5TdHJpbmcsIHtcclxuICAgICAgdmFsdWVUZXh0OiB2YWx1ZVRleHQsXHJcbiAgICAgIGZvcmNlQWxlcnQ6IHB1c2hBbGVydFN0cmluZ1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGFuIGFsZXJ0IGZvciB3aGVuIG1hc3NlcyByYWRpdXMgYmVjb21lcyBjb25zdGFudCBvciBkeW5hbWljLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gY29uc3RhbnRSYWRpdXNcclxuICAgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gICAqL1xyXG4gIGdldENvbnN0YW50UmFkaXVzQWxlcnQoIGNvbnN0YW50UmFkaXVzICkge1xyXG4gICAgY29uc3QgY29uc3RhbnRSYWRpdXNBbGVydCA9IFN0cmluZ1V0aWxzLmZpbGxJbiggY29uc3RhbnRSYWRpdXNUaGlua0RlbnNpdHlQYXR0ZXJuU3RyaW5nLCB7XHJcblxyXG4gICAgICAvLyB1c2UgZm9yY2VEZXNjcmliZXIganVzdCBmb3IgdGhlIHNpbSBzcGVjaWZpYyBvYmplY3QgbGFiZWxzLCBjb3VsZCBiZSBhbnkgSVNMQ0Rlc2NyaWJlclxyXG4gICAgICBtYXNzMTogdGhpcy5mb3JjZURlc2NyaWJlci5vYmplY3QxTGFiZWwsXHJcbiAgICAgIG1hc3MyOiB0aGlzLmZvcmNlRGVzY3JpYmVyLm9iamVjdDJMYWJlbFxyXG4gICAgfSApO1xyXG5cclxuICAgIHJldHVybiBjb25zdGFudFJhZGl1cyA/IGNvbnN0YW50UmFkaXVzQWxlcnQgOiB0aGlzLm1hc3NEZXNjcmliZXIuZ2V0TTFSZWxhdGl2ZVNpemUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFsZXJ0IHRoZSBcImJvcmRlclwiIGFsZXJ0IHdoZW4gYXR0ZW1wdGluZyB0byBjaGFuZ2UgdGhlIG1hc3MsIGJ1dCBhbHJlYWR5IGF0IHRoZSBtaW4gb3IgbWF4IG9mIGl0LCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2dyYXZpdHktZm9yY2UtbGFiL2lzc3Vlcy8xNTVcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEBwYXJhbSB7SVNMQ09iamVjdEVudW19IHRoaXNPYmplY3RFbnVtXHJcbiAgICovXHJcbiAgYWxlcnRNYXNzTWluTWF4RWRnZSggdGhpc09iamVjdEVudW0gKSB7XHJcbiAgICB0aGlzLm1hc3NDaGFuZ2VkVXR0ZXJhbmNlLmFsZXJ0ID0gdGhpcy5tYXNzRGVzY3JpYmVyLmdldE1hc3NNYXhNaW5UZXh0KCB0aGlzT2JqZWN0RW51bSApO1xyXG4gICAgdGhpcy5hbGVydERlc2NyaXB0aW9uVXR0ZXJhbmNlKCB0aGlzLm1hc3NDaGFuZ2VkVXR0ZXJhbmNlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGFsZXJ0Q29uc3RhbnRTaXplQ2hhbmdlZFBvc2l0aW9uKCkge1xyXG4gICAgY29uc3QgY29udGV4dFJlc3BvbnNlID0gU3RyaW5nVXRpbHMuZmlsbEluKCBzZW50ZW5jZVBhdHRlcm5TdHJpbmcsIHtcclxuICAgICAgc2VudGVuY2U6IHRoaXMuZm9yY2VEZXNjcmliZXIuZ2V0VmVjdG9yQ2hhbmdlQ2xhdXNlKCBmYWxzZSwgdHJ1ZSApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5tYXNzQ2hhbmdlZFV0dGVyYW5jZS5hbGVydCA9IGNvbnRleHRSZXNwb25zZTtcclxuICAgIHRoaXMuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggdGhpcy5tYXNzQ2hhbmdlZFV0dGVyYW5jZSApO1xyXG5cclxuICAgIC8vIHZvaWNpbmcgLSBDcmVhdGUgdGhlIGFsZXJ0IHRvIGJlIHVzZWQgd2l0aCB2b2ljaW5nLiBJZGVhbGx5IHRoaXMgd291bGQgYmUgdGhlIGNvbnRleHQgcmVzcG9uc2UgZm9yIHRoZVxyXG4gICAgLy8gVUkgY29tcG9uZW50IHRoYXQgY29udHJvbHMgd2hldGhlciBtYXNzZXMgYXJlIG9mIGNvbnN0YW50IHNpemUuIEJ1dCB0aGlzIGFsZXJ0IG5lZWRzIGluZm9ybWF0aW9uIGFib3V0XHJcbiAgICAvLyB3aGV0aGVyIHBvc2l0aW9ucyB3ZXJlIGNoYW5nZWQsIHdoaWNoIGhhcHBlbnMgbGF0ZXIgaW4gdGhlIG1vZGVsIGR1cmluZyBzdGVwLCBzbyBpdCBuZWVkcyB0byBiZVxyXG4gICAgLy8gY3JlYXRlZCBoZXJlLlxyXG5cclxuICAgIC8vIGluY2x1ZGUgaW5mb3JtYXRpb24gYXMgc2VsZWN0ZWQgYnkgdXNlciBwcmVmZXJlbmNlc1xyXG4gICAgY29uc3Qgdm9pY2luZ0FsZXJ0U3RyaW5nID0gcmVzcG9uc2VDb2xsZWN0b3IuY29sbGVjdFJlc3BvbnNlcygge1xyXG4gICAgICBjb250ZXh0UmVzcG9uc2U6IGNvbnRleHRSZXNwb25zZVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuY29uc3RhbnRTaXplQ2hhbmdlZENvbnRleHRSZXNwb25zZVV0dGVyYW5jZS5hbGVydCA9IHZvaWNpbmdBbGVydFN0cmluZztcclxuICAgIFZvaWNpbmcuYWxlcnRVdHRlcmFuY2UoIHRoaXMuY29uc3RhbnRTaXplQ2hhbmdlZENvbnRleHRSZXNwb25zZVV0dGVyYW5jZSApO1xyXG4gIH1cclxufVxyXG5cclxuZ3Jhdml0eUZvcmNlTGFiLnJlZ2lzdGVyKCAnR3Jhdml0eUZvcmNlTGFiQWxlcnRNYW5hZ2VyJywgR3Jhdml0eUZvcmNlTGFiQWxlcnRNYW5hZ2VyICk7XHJcbmV4cG9ydCBkZWZhdWx0IEdyYXZpdHlGb3JjZUxhYkFsZXJ0TWFuYWdlcjsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsNkJBQTZCLE1BQU0sd0VBQXdFO0FBQ2xILE9BQU9DLHNCQUFzQixNQUFNLHVFQUF1RTtBQUMxRyxPQUFPQyxnQkFBZ0IsTUFBTSxnRUFBZ0U7QUFDN0YsT0FBT0MsY0FBYyxNQUFNLCtEQUErRDtBQUMxRixPQUFPQyxLQUFLLE1BQU0sZ0NBQWdDO0FBQ2xELE9BQU9DLFdBQVcsTUFBTSw0Q0FBNEM7QUFDcEUsU0FBU0MsT0FBTyxRQUFRLGdDQUFnQztBQUN4RCxPQUFPQyxtQkFBbUIsTUFBTSxvREFBb0Q7QUFDcEYsT0FBT0MsaUJBQWlCLE1BQU0sa0RBQWtEO0FBQ2hGLE9BQU9DLFNBQVMsTUFBTSwwQ0FBMEM7QUFDaEUsT0FBT0Msb0JBQW9CLE1BQU0scURBQXFEO0FBQ3RGLE9BQU9DLGVBQWUsTUFBTSx1QkFBdUI7QUFDbkQsT0FBT0Msc0JBQXNCLE1BQU0sOEJBQThCO0FBQ2pFLE9BQU9DLG9CQUFvQixNQUFNLGtDQUFrQztBQUVuRSxNQUFNQyx1Q0FBdUMsR0FBR0Ysc0JBQXNCLENBQUNHLElBQUksQ0FBQ0MsUUFBUSxDQUFDQyxpQ0FBaUM7QUFDdEgsTUFBTUMsZ0NBQWdDLEdBQUdOLHNCQUFzQixDQUFDRyxJQUFJLENBQUNJLFdBQVcsQ0FBQ0MsMEJBQTBCO0FBQzNHLE1BQU1DLHFCQUFxQixHQUFHVCxzQkFBc0IsQ0FBQ0csSUFBSSxDQUFDTyxlQUFlO0FBQ3pFLE1BQU1DLHNEQUFzRCxHQUFHWCxzQkFBc0IsQ0FBQ0csSUFBSSxDQUFDUyxPQUFPLENBQUNDLHlDQUF5QztBQUM1SSxNQUFNQyw2Q0FBNkMsR0FBR2Qsc0JBQXNCLENBQUNHLElBQUksQ0FBQ1MsT0FBTyxDQUFDRyxnQ0FBZ0M7QUFDMUgsTUFBTUMsbUJBQW1CLEdBQUc1Qiw2QkFBNkIsQ0FBQ2UsSUFBSSxDQUFDUyxPQUFPLENBQUNLLE1BQU07QUFDN0UsTUFBTUMsc0NBQXNDLEdBQUdsQixzQkFBc0IsQ0FBQ0csSUFBSSxDQUFDUyxPQUFPLENBQUNPLHlCQUF5QjtBQUM1RyxNQUFNQyxrREFBa0QsR0FBR3BCLHNCQUFzQixDQUFDRyxJQUFJLENBQUNTLE9BQU8sQ0FBQ1MscUNBQXFDO0FBRXBJLE1BQU1DLDJCQUEyQixTQUFTaEMsZ0JBQWdCLENBQUM7RUFFekQ7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VpQyxXQUFXQSxDQUFFQyxLQUFLLEVBQUVDLGFBQWEsRUFBRUMsY0FBYyxFQUFFQyxPQUFPLEVBQUc7SUFFM0Q7SUFDQUEsT0FBTyxHQUFHbkMsS0FBSyxDQUFFO01BRWY7TUFDQW9DLGdDQUFnQyxFQUFFLElBQUk7TUFFdEM7TUFDQTtNQUNBQyx1QkFBdUIsRUFBRTtJQUMzQixDQUFDLEVBQUVGLE9BQVEsQ0FBQztJQUVaLEtBQUssQ0FBRUgsS0FBSyxFQUFFRSxjQUFjLEVBQUVDLE9BQVEsQ0FBQzs7SUFFdkM7SUFDQSxJQUFJLENBQUNGLGFBQWEsR0FBR0EsYUFBYTs7SUFFbEM7SUFDQSxJQUFJLENBQUNLLG9CQUFvQixHQUFHLElBQUloQyxvQkFBb0IsQ0FBQyxDQUFDO0lBQ3RELElBQUksQ0FBQ2lDLDJCQUEyQixHQUFHLElBQUlwQyxtQkFBbUIsQ0FBQyxDQUFDOztJQUU1RDtJQUNBO0lBQ0EsSUFBSSxDQUFDcUMsMkNBQTJDLEdBQUcsSUFBSW5DLFNBQVMsQ0FBRTtNQUNoRW9DLGdCQUFnQixFQUFFO1FBQ2hCQyxXQUFXLEVBQUU7TUFDZjtJQUNGLENBQUUsQ0FBQztJQUVILE1BQU1DLHVCQUF1QixHQUFHLElBQUl4QyxtQkFBbUIsQ0FBQyxDQUFDO0lBRXpENkIsS0FBSyxDQUFDWSxzQkFBc0IsQ0FBQ0MsUUFBUSxDQUFFQyxjQUFjLElBQUk7TUFDdkRILHVCQUF1QixDQUFDSSxLQUFLLEdBQUcsSUFBSSxDQUFDQyxzQkFBc0IsQ0FBRUYsY0FBZSxDQUFDO01BQzdFLElBQUksQ0FBQ0cseUJBQXlCLENBQUVOLHVCQUF3QixDQUFDO0lBQzNELENBQUUsQ0FBQzs7SUFFSDtJQUNBLElBQUtSLE9BQU8sQ0FBQ0MsZ0NBQWdDLEVBQUc7TUFDOUNjLE1BQU0sSUFBSUEsTUFBTSxDQUFFbEIsS0FBSyxZQUFZdkIsb0JBQW9CLEVBQUUsMkNBQTRDLENBQUM7TUFDdEcwQixPQUFPLENBQUNDLGdDQUFnQyxJQUFJSixLQUFLLENBQUNtQiwwQkFBMEIsQ0FBQ04sUUFBUSxDQUFFLE1BQU07UUFFM0YsSUFBS2IsS0FBSyxDQUFDbUIsMEJBQTBCLENBQUNDLEtBQUssS0FBS3ZELHNCQUFzQixDQUFDd0QsVUFBVSxFQUFHO1VBQ2xGLElBQUksQ0FBQ0MsdUJBQXVCLENBQUMsQ0FBQztRQUNoQyxDQUFDLE1BQ0k7VUFDSCxJQUFJLENBQUNDLG9CQUFvQixDQUFFdkIsS0FBSyxDQUFDbUIsMEJBQTBCLENBQUNDLEtBQUssS0FBS3ZELHNCQUFzQixDQUFDMkQsTUFBTyxDQUFDO1FBQ3ZHO01BQ0YsQ0FBRSxDQUFDO0lBQ0wsQ0FBQyxNQUNJO01BQ0hOLE1BQU0sSUFBSUEsTUFBTSxDQUFFZixPQUFPLENBQUNFLHVCQUF1QixFQUMvQyxvRkFBcUYsQ0FBQztNQUN4RkwsS0FBSyxDQUFDeUIsdUJBQXVCLENBQUNaLFFBQVEsQ0FBRVYsT0FBTyxDQUFDRSx1QkFBd0IsQ0FBQztJQUMzRTs7SUFFQTtJQUNBTCxLQUFLLENBQUMwQixPQUFPLENBQUNDLGFBQWEsQ0FBQ2QsUUFBUSxDQUFFLE1BQU0sSUFBSSxDQUFDZSxxQkFBcUIsQ0FBRTVCLEtBQUssQ0FBQzBCLE9BQU8sQ0FBQ0csSUFBSyxDQUFFLENBQUM7SUFDOUY3QixLQUFLLENBQUM4QixPQUFPLENBQUNILGFBQWEsQ0FBQ2QsUUFBUSxDQUFFLE1BQU0sSUFBSSxDQUFDZSxxQkFBcUIsQ0FBRTVCLEtBQUssQ0FBQzhCLE9BQU8sQ0FBQ0QsSUFBSyxDQUFFLENBQUM7O0lBRTlGO0lBQ0E7SUFDQTtJQUNBLE1BQU1FLGdDQUFnQyxHQUFHQyxVQUFVLElBQUk7TUFFckQ7TUFDQSxJQUFLaEMsS0FBSyxDQUFDMEIsT0FBTyxDQUFDTyxrQ0FBa0MsSUFBSWpDLEtBQUssQ0FBQzhCLE9BQU8sQ0FBQ0csa0NBQWtDLEVBQUc7UUFDMUcsSUFBSSxDQUFDQyxnQ0FBZ0MsQ0FBQyxDQUFDO01BQ3pDLENBQUMsTUFDSTtRQUFFO1FBQ0wsSUFBSSxDQUFDTixxQkFBcUIsQ0FBRUksVUFBVSxFQUFFLElBQUssQ0FBQztNQUNoRDtJQUNGLENBQUM7SUFDRGhDLEtBQUssQ0FBQzBCLE9BQU8sQ0FBQ1MseUNBQXlDLENBQUNDLFdBQVcsQ0FBRUwsZ0NBQWlDLENBQUM7SUFDdkcvQixLQUFLLENBQUM4QixPQUFPLENBQUNLLHlDQUF5QyxDQUFDQyxXQUFXLENBQUVMLGdDQUFpQyxDQUFDO0VBQ3pHOztFQUVBO0FBQ0Y7QUFDQTtFQUNFVCx1QkFBdUJBLENBQUEsRUFBRztJQUN4QixJQUFJLENBQUNmLDJCQUEyQixDQUFDUSxLQUFLLEdBQUcsSUFBSSxDQUFDYixjQUFjLENBQUNtQyw4QkFBOEIsQ0FBQyxDQUFDO0lBQzdGLElBQUksQ0FBQ3BCLHlCQUF5QixDQUFFLElBQUksQ0FBQ1YsMkJBQTRCLENBQUM7RUFDcEU7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRXFCLHFCQUFxQkEsQ0FBRUksVUFBVSxFQUFFTSxtQkFBbUIsRUFBRztJQUN2RCxNQUFNQyxlQUFlLEdBQUcsSUFBSSxDQUFDQyx3QkFBd0IsQ0FBRVIsVUFBVSxFQUFFTSxtQkFBb0IsQ0FBQztJQUN4RixJQUFJLENBQUNyQix5QkFBeUIsQ0FBRXNCLGVBQWdCLENBQUM7RUFDbkQ7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFQyx3QkFBd0JBLENBQUVSLFVBQVUsRUFBRU0sbUJBQW1CLEVBQUc7SUFDMUQsSUFBSUcsVUFBVSxHQUFHLElBQUksQ0FBQ3hDLGFBQWEsQ0FBQ3lDLDRCQUE0QixDQUFFVixVQUFXLENBQUM7O0lBRTlFO0lBQ0EsSUFBSyxJQUFJLENBQUNoQyxLQUFLLENBQUMyQyxhQUFhLENBQUMsQ0FBQyxFQUFHO01BQ2hDRixVQUFVLEdBQUcsSUFBSSxDQUFDeEMsYUFBYSxDQUFDMkMsNEJBQTRCLENBQUVaLFVBQVcsQ0FBQztNQUMxRSxJQUFLLElBQUksQ0FBQ2hDLEtBQUssQ0FBQzZDLHdCQUF3QixDQUFDekIsS0FBSyxLQUFLWSxVQUFVLEVBQUc7UUFDOURTLFVBQVUsR0FBRyxJQUFJLENBQUN4QyxhQUFhLENBQUM2QyxpQ0FBaUMsQ0FBRWQsVUFBVyxDQUFDO01BQ2pGO0lBQ0Y7SUFFQSxJQUFJLENBQUMxQixvQkFBb0IsQ0FBQ1MsS0FBSyxHQUFHOUMsV0FBVyxDQUFDOEUsTUFBTSxDQUFFakUsZ0NBQWdDLEVBQUU7TUFDdEYyRCxVQUFVLEVBQUVBLFVBQVU7TUFDdEJPLFdBQVcsRUFBRSxJQUFJLENBQUM5QyxjQUFjLENBQUMrQyxxQkFBcUIsQ0FBRVgsbUJBQW1CLEVBQUUsS0FBTTtJQUNyRixDQUFFLENBQUM7SUFDSCxPQUFPLElBQUksQ0FBQ2hDLG9CQUFvQjtFQUNsQzs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0U0QywwQ0FBMENBLENBQUVsQixVQUFVLEVBQUc7SUFFdkQsTUFBTW1CLGdCQUFnQixHQUFHLElBQUksQ0FBQ25ELEtBQUssQ0FBQ3lCLHVCQUF1QixDQUFDMkIsR0FBRyxDQUFDLENBQUM7SUFDakUsTUFBTUMsV0FBVyxHQUFHLElBQUksQ0FBQ25ELGNBQWMsQ0FBQ29ELGlCQUFpQixDQUFDLENBQUM7SUFFM0QsSUFBSUMsY0FBYztJQUNsQixJQUFLSixnQkFBZ0IsRUFBRztNQUN0QkksY0FBYyxHQUFHdEYsV0FBVyxDQUFDOEUsTUFBTSxDQUFFNUQsc0RBQXNELEVBQUU7UUFDM0ZxRSxXQUFXLEVBQUVoRSxtQkFBbUI7UUFDaEM0QixLQUFLLEVBQUVpQztNQUNULENBQUUsQ0FBQztJQUNMLENBQUMsTUFDSTtNQUNIRSxjQUFjLEdBQUd0RixXQUFXLENBQUM4RSxNQUFNLENBQUV6RCw2Q0FBNkMsRUFBRTtRQUNsRmtFLFdBQVcsRUFBRWhFO01BQ2YsQ0FBRSxDQUFDO0lBQ0w7SUFFQSxNQUFNaUUsZUFBZSxHQUFHeEYsV0FBVyxDQUFDOEUsTUFBTSxDQUFFckQsc0NBQXNDLEVBQUU7TUFDbEZnQyxPQUFPLEVBQUUsSUFBSSxDQUFDeEIsY0FBYyxDQUFDd0Qsc0JBQXNCLENBQUUxQixVQUFXLENBQUM7TUFDakVGLE9BQU8sRUFBRSxJQUFJLENBQUM1QixjQUFjLENBQUN5RCwyQkFBMkIsQ0FBRTNCLFVBQVcsQ0FBQztNQUN0RTRCLFNBQVMsRUFBRSxJQUFJLENBQUMzRCxhQUFhLENBQUM0RCxvQkFBb0IsQ0FBRTlGLGNBQWMsQ0FBQytGLGtCQUFrQixDQUFFOUIsVUFBVyxDQUFFLENBQUM7TUFDckcrQixVQUFVLEVBQUVSO0lBQ2QsQ0FBRSxDQUFDO0lBRUgsTUFBTVMsU0FBUyxHQUFHLElBQUksQ0FBQy9ELGFBQWEsQ0FBQ2dFLGNBQWMsQ0FBRWpDLFVBQVcsQ0FBQztJQUNqRSxPQUFPL0QsV0FBVyxDQUFDOEUsTUFBTSxDQUFFbkQsa0RBQWtELEVBQUU7TUFDN0VvRSxTQUFTLEVBQUVBLFNBQVM7TUFDcEJELFVBQVUsRUFBRU47SUFDZCxDQUFFLENBQUM7RUFDTDs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFekMsc0JBQXNCQSxDQUFFRixjQUFjLEVBQUc7SUFDdkMsTUFBTW9ELG1CQUFtQixHQUFHakcsV0FBVyxDQUFDOEUsTUFBTSxDQUFFckUsdUNBQXVDLEVBQUU7TUFFdkY7TUFDQXlGLEtBQUssRUFBRSxJQUFJLENBQUNqRSxjQUFjLENBQUNrRSxZQUFZO01BQ3ZDQyxLQUFLLEVBQUUsSUFBSSxDQUFDbkUsY0FBYyxDQUFDb0U7SUFDN0IsQ0FBRSxDQUFDO0lBRUgsT0FBT3hELGNBQWMsR0FBR29ELG1CQUFtQixHQUFHLElBQUksQ0FBQ2pFLGFBQWEsQ0FBQ3NFLGlCQUFpQixDQUFDLENBQUM7RUFDdEY7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNFQyxtQkFBbUJBLENBQUVDLGNBQWMsRUFBRztJQUNwQyxJQUFJLENBQUNuRSxvQkFBb0IsQ0FBQ1MsS0FBSyxHQUFHLElBQUksQ0FBQ2QsYUFBYSxDQUFDeUUsaUJBQWlCLENBQUVELGNBQWUsQ0FBQztJQUN4RixJQUFJLENBQUN4RCx5QkFBeUIsQ0FBRSxJQUFJLENBQUNYLG9CQUFxQixDQUFDO0VBQzdEOztFQUVBO0FBQ0Y7QUFDQTtFQUNFNEIsZ0NBQWdDQSxDQUFBLEVBQUc7SUFDakMsTUFBTUssZUFBZSxHQUFHdEUsV0FBVyxDQUFDOEUsTUFBTSxDQUFFOUQscUJBQXFCLEVBQUU7TUFDakUwRixRQUFRLEVBQUUsSUFBSSxDQUFDekUsY0FBYyxDQUFDK0MscUJBQXFCLENBQUUsS0FBSyxFQUFFLElBQUs7SUFDbkUsQ0FBRSxDQUFDO0lBRUgsSUFBSSxDQUFDM0Msb0JBQW9CLENBQUNTLEtBQUssR0FBR3dCLGVBQWU7SUFDakQsSUFBSSxDQUFDdEIseUJBQXlCLENBQUUsSUFBSSxDQUFDWCxvQkFBcUIsQ0FBQzs7SUFFM0Q7SUFDQTtJQUNBO0lBQ0E7O0lBRUE7SUFDQSxNQUFNc0Usa0JBQWtCLEdBQUd4RyxpQkFBaUIsQ0FBQ3lHLGdCQUFnQixDQUFFO01BQzdEdEMsZUFBZSxFQUFFQTtJQUNuQixDQUFFLENBQUM7SUFFSCxJQUFJLENBQUMvQiwyQ0FBMkMsQ0FBQ08sS0FBSyxHQUFHNkQsa0JBQWtCO0lBQzNFMUcsT0FBTyxDQUFDNEcsY0FBYyxDQUFFLElBQUksQ0FBQ3RFLDJDQUE0QyxDQUFDO0VBQzVFO0FBQ0Y7QUFFQWpDLGVBQWUsQ0FBQ3dHLFFBQVEsQ0FBRSw2QkFBNkIsRUFBRWpGLDJCQUE0QixDQUFDO0FBQ3RGLGVBQWVBLDJCQUEyQiJ9