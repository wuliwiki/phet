// Copyright 2022, University of Colorado Boulder

/**
 * Supertype for layout Nodes
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import Vector2Property from '../../../../dot/js/Vector2Property.js';
import { Node, scenery, Sizable } from '../../imports.js';
export const LAYOUT_NODE_OPTION_KEYS = ['resize', 'layoutOrigin'];
export default class LayoutNode extends Sizable(Node) {
  // Can't be readonly because the subtype sets this

  layoutOriginProperty = new Vector2Property(Vector2.ZERO);
  constructor(providedOptions) {
    super(providedOptions);
  }
  linkLayoutBounds() {
    // Adjust the localBounds to be the laid-out area (defined by the constraint)
    this._constraint.layoutBoundsProperty.link(layoutBounds => {
      this.localBounds = layoutBounds;
    });
  }
  setExcludeInvisibleChildrenFromBounds(excludeInvisibleChildrenFromBounds) {
    super.setExcludeInvisibleChildrenFromBounds(excludeInvisibleChildrenFromBounds);
    this._constraint.excludeInvisible = excludeInvisibleChildrenFromBounds;
  }
  setChildren(children) {
    // If the layout is already locked, we need to bail and only call Node's setChildren. This is fine, our layout will
    // be handled once whatever locked us unlocks (so we don't have to override to handle layout or locking/unlocking.
    if (this.constraint.isLocked) {
      return super.setChildren(children);
    }
    const oldChildren = this.getChildren(); // defensive copy

    // Lock layout while the children are removed and added
    this.constraint.lock();
    super.setChildren(children);
    this.constraint.unlock();

    // Determine if the children array has changed. We'll gain a performance benefit by not triggering layout when
    // the children haven't changed.
    if (!_.isEqual(oldChildren, children)) {
      this.constraint.updateLayoutAutomatically();
    }
    return this;
  }

  /**
   * Manually run the layout (for instance, if resize:false is currently set, or if there is other hackery going on).
   */
  updateLayout() {
    this._constraint.updateLayout();
  }
  get resize() {
    return this._constraint.enabled;
  }
  set resize(value) {
    this._constraint.enabled = value;
  }
  get layoutOrigin() {
    return this.layoutOriginProperty.value;
  }
  set layoutOrigin(value) {
    this.layoutOriginProperty.value = value;
  }

  /**
   * Manual access to the constraint. This is needed by subtypes to lock/unlock or force layout updates, but may also
   * be needed to read layout information out (for overlays, GridBackgroundNode, etc.)
   */
  get constraint() {
    return this._constraint;
  }

  /**
   * Releases references
   */
  dispose() {
    this._constraint.dispose();
    super.dispose();
  }
}
scenery.register('LayoutNode', LayoutNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiVmVjdG9yMlByb3BlcnR5IiwiTm9kZSIsInNjZW5lcnkiLCJTaXphYmxlIiwiTEFZT1VUX05PREVfT1BUSU9OX0tFWVMiLCJMYXlvdXROb2RlIiwibGF5b3V0T3JpZ2luUHJvcGVydHkiLCJaRVJPIiwiY29uc3RydWN0b3IiLCJwcm92aWRlZE9wdGlvbnMiLCJsaW5rTGF5b3V0Qm91bmRzIiwiX2NvbnN0cmFpbnQiLCJsYXlvdXRCb3VuZHNQcm9wZXJ0eSIsImxpbmsiLCJsYXlvdXRCb3VuZHMiLCJsb2NhbEJvdW5kcyIsInNldEV4Y2x1ZGVJbnZpc2libGVDaGlsZHJlbkZyb21Cb3VuZHMiLCJleGNsdWRlSW52aXNpYmxlQ2hpbGRyZW5Gcm9tQm91bmRzIiwiZXhjbHVkZUludmlzaWJsZSIsInNldENoaWxkcmVuIiwiY2hpbGRyZW4iLCJjb25zdHJhaW50IiwiaXNMb2NrZWQiLCJvbGRDaGlsZHJlbiIsImdldENoaWxkcmVuIiwibG9jayIsInVubG9jayIsIl8iLCJpc0VxdWFsIiwidXBkYXRlTGF5b3V0QXV0b21hdGljYWxseSIsInVwZGF0ZUxheW91dCIsInJlc2l6ZSIsImVuYWJsZWQiLCJ2YWx1ZSIsImxheW91dE9yaWdpbiIsImRpc3Bvc2UiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkxheW91dE5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFN1cGVydHlwZSBmb3IgbGF5b3V0IE5vZGVzXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgVFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMlByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgeyBOb2RlLCBOb2RlTGF5b3V0Q29uc3RyYWludCwgTm9kZU9wdGlvbnMsIHNjZW5lcnksIFNpemFibGUsIFNpemFibGVPcHRpb25zIH0gZnJvbSAnLi4vLi4vaW1wb3J0cy5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIC8vIENvbnRyb2xzIHdoZXRoZXIgdGhlIGxheW91dCBjb250YWluZXIgd2lsbCByZS10cmlnZ2VyIGxheW91dCBhdXRvbWF0aWNhbGx5IGFmdGVyIHRoZSBcImZpcnN0XCIgbGF5b3V0IGR1cmluZ1xyXG4gIC8vIGNvbnN0cnVjdGlvbi4gVGhlIGxheW91dCBjb250YWluZXIgd2lsbCBsYXlvdXQgb25jZSBhZnRlciBwcm9jZXNzaW5nIHRoZSBvcHRpb25zIG9iamVjdCwgYnV0IGlmIHJlc2l6ZTpmYWxzZSxcclxuICAvLyB0aGVuIGFmdGVyIHRoYXQgbWFudWFsIGxheW91dCBjYWxscyB3aWxsIG5lZWQgdG8gYmUgZG9uZSAod2l0aCB1cGRhdGVMYXlvdXQoKSlcclxuICByZXNpemU/OiBib29sZWFuO1xyXG5cclxuICAvLyBDb250cm9scyB3aGVyZSB0aGUgb3JpZ2luIG9mIHRoZSBcImxheW91dFwiIGlzIHBsYWNlZCAodXN1YWxseSB3aXRoaW4gdGhlIE5vZGUgaXRzZWxmKS4gRm9yIHR5cGljYWwgdXNhZ2VzLCB0aGlzIHdpbGxcclxuICAvLyBiZSAoMCwwKSBhbmQgdGhlIHVwcGVyLWxlZnQgb2YgdGhlIGNvbnRlbnQgd2lsbCBiZSBwbGFjZWQgdGhlcmUuIGBsYXlvdXRPcmlnaW5gIHdpbGwgYWRqdXN0IHRoaXMgcG9pbnQuXHJcbiAgLy8gTk9URTogSWYgdGhlcmUgaXMgb3JpZ2luLWJhc2VkIGNvbnRlbnQsIHRoYXQgY29udGVudCB3aWxsIGJlIHBsYWNlZCBhdCB0aGlzIG9yaWdpbiAoYW5kIG1heSBnbyB0byB0aGUgdG9wL2xlZnQgb2ZcclxuICAvLyB0aGlzIGxheW91dE9yaWdpbikuXHJcbiAgbGF5b3V0T3JpZ2luPzogVmVjdG9yMjtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBMQVlPVVRfTk9ERV9PUFRJT05fS0VZUyA9IFsgJ3Jlc2l6ZScsICdsYXlvdXRPcmlnaW4nIF0gYXMgY29uc3Q7XHJcblxyXG50eXBlIFBhcmVudE9wdGlvbnMgPSBOb2RlT3B0aW9ucyAmIFNpemFibGVPcHRpb25zO1xyXG5cclxuZXhwb3J0IHR5cGUgTGF5b3V0Tm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFBhcmVudE9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhYnN0cmFjdCBjbGFzcyBMYXlvdXROb2RlPENvbnN0cmFpbnQgZXh0ZW5kcyBOb2RlTGF5b3V0Q29uc3RyYWludD4gZXh0ZW5kcyBTaXphYmxlKCBOb2RlICkge1xyXG5cclxuICBwcm90ZWN0ZWQgX2NvbnN0cmFpbnQhOiBDb25zdHJhaW50OyAvLyBDYW4ndCBiZSByZWFkb25seSBiZWNhdXNlIHRoZSBzdWJ0eXBlIHNldHMgdGhpc1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgbGF5b3V0T3JpZ2luUHJvcGVydHk6IFRQcm9wZXJ0eTxWZWN0b3IyPiA9IG5ldyBWZWN0b3IyUHJvcGVydHkoIFZlY3RvcjIuWkVSTyApO1xyXG5cclxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoIHByb3ZpZGVkT3B0aW9ucz86IExheW91dE5vZGVPcHRpb25zICkge1xyXG4gICAgc3VwZXIoIHByb3ZpZGVkT3B0aW9ucyApO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGxpbmtMYXlvdXRCb3VuZHMoKTogdm9pZCB7XHJcbiAgICAvLyBBZGp1c3QgdGhlIGxvY2FsQm91bmRzIHRvIGJlIHRoZSBsYWlkLW91dCBhcmVhIChkZWZpbmVkIGJ5IHRoZSBjb25zdHJhaW50KVxyXG4gICAgdGhpcy5fY29uc3RyYWludC5sYXlvdXRCb3VuZHNQcm9wZXJ0eS5saW5rKCBsYXlvdXRCb3VuZHMgPT4ge1xyXG4gICAgICB0aGlzLmxvY2FsQm91bmRzID0gbGF5b3V0Qm91bmRzO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIHNldEV4Y2x1ZGVJbnZpc2libGVDaGlsZHJlbkZyb21Cb3VuZHMoIGV4Y2x1ZGVJbnZpc2libGVDaGlsZHJlbkZyb21Cb3VuZHM6IGJvb2xlYW4gKTogdm9pZCB7XHJcbiAgICBzdXBlci5zZXRFeGNsdWRlSW52aXNpYmxlQ2hpbGRyZW5Gcm9tQm91bmRzKCBleGNsdWRlSW52aXNpYmxlQ2hpbGRyZW5Gcm9tQm91bmRzICk7XHJcblxyXG4gICAgdGhpcy5fY29uc3RyYWludC5leGNsdWRlSW52aXNpYmxlID0gZXhjbHVkZUludmlzaWJsZUNoaWxkcmVuRnJvbUJvdW5kcztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBzZXRDaGlsZHJlbiggY2hpbGRyZW46IE5vZGVbXSApOiB0aGlzIHtcclxuXHJcbiAgICAvLyBJZiB0aGUgbGF5b3V0IGlzIGFscmVhZHkgbG9ja2VkLCB3ZSBuZWVkIHRvIGJhaWwgYW5kIG9ubHkgY2FsbCBOb2RlJ3Mgc2V0Q2hpbGRyZW4uIFRoaXMgaXMgZmluZSwgb3VyIGxheW91dCB3aWxsXHJcbiAgICAvLyBiZSBoYW5kbGVkIG9uY2Ugd2hhdGV2ZXIgbG9ja2VkIHVzIHVubG9ja3MgKHNvIHdlIGRvbid0IGhhdmUgdG8gb3ZlcnJpZGUgdG8gaGFuZGxlIGxheW91dCBvciBsb2NraW5nL3VubG9ja2luZy5cclxuICAgIGlmICggdGhpcy5jb25zdHJhaW50LmlzTG9ja2VkICkge1xyXG4gICAgICByZXR1cm4gc3VwZXIuc2V0Q2hpbGRyZW4oIGNoaWxkcmVuICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb2xkQ2hpbGRyZW4gPSB0aGlzLmdldENoaWxkcmVuKCk7IC8vIGRlZmVuc2l2ZSBjb3B5XHJcblxyXG4gICAgLy8gTG9jayBsYXlvdXQgd2hpbGUgdGhlIGNoaWxkcmVuIGFyZSByZW1vdmVkIGFuZCBhZGRlZFxyXG4gICAgdGhpcy5jb25zdHJhaW50LmxvY2soKTtcclxuICAgIHN1cGVyLnNldENoaWxkcmVuKCBjaGlsZHJlbiApO1xyXG4gICAgdGhpcy5jb25zdHJhaW50LnVubG9jaygpO1xyXG5cclxuICAgIC8vIERldGVybWluZSBpZiB0aGUgY2hpbGRyZW4gYXJyYXkgaGFzIGNoYW5nZWQuIFdlJ2xsIGdhaW4gYSBwZXJmb3JtYW5jZSBiZW5lZml0IGJ5IG5vdCB0cmlnZ2VyaW5nIGxheW91dCB3aGVuXHJcbiAgICAvLyB0aGUgY2hpbGRyZW4gaGF2ZW4ndCBjaGFuZ2VkLlxyXG4gICAgaWYgKCAhXy5pc0VxdWFsKCBvbGRDaGlsZHJlbiwgY2hpbGRyZW4gKSApIHtcclxuICAgICAgdGhpcy5jb25zdHJhaW50LnVwZGF0ZUxheW91dEF1dG9tYXRpY2FsbHkoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hbnVhbGx5IHJ1biB0aGUgbGF5b3V0IChmb3IgaW5zdGFuY2UsIGlmIHJlc2l6ZTpmYWxzZSBpcyBjdXJyZW50bHkgc2V0LCBvciBpZiB0aGVyZSBpcyBvdGhlciBoYWNrZXJ5IGdvaW5nIG9uKS5cclxuICAgKi9cclxuICBwdWJsaWMgdXBkYXRlTGF5b3V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5fY29uc3RyYWludC51cGRhdGVMYXlvdXQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgcmVzaXplKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX2NvbnN0cmFpbnQuZW5hYmxlZDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgcmVzaXplKCB2YWx1ZTogYm9vbGVhbiApIHtcclxuICAgIHRoaXMuX2NvbnN0cmFpbnQuZW5hYmxlZCA9IHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBsYXlvdXRPcmlnaW4oKTogVmVjdG9yMiB7XHJcbiAgICByZXR1cm4gdGhpcy5sYXlvdXRPcmlnaW5Qcm9wZXJ0eS52YWx1ZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgbGF5b3V0T3JpZ2luKCB2YWx1ZTogVmVjdG9yMiApIHtcclxuICAgIHRoaXMubGF5b3V0T3JpZ2luUHJvcGVydHkudmFsdWUgPSB2YWx1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hbnVhbCBhY2Nlc3MgdG8gdGhlIGNvbnN0cmFpbnQuIFRoaXMgaXMgbmVlZGVkIGJ5IHN1YnR5cGVzIHRvIGxvY2svdW5sb2NrIG9yIGZvcmNlIGxheW91dCB1cGRhdGVzLCBidXQgbWF5IGFsc29cclxuICAgKiBiZSBuZWVkZWQgdG8gcmVhZCBsYXlvdXQgaW5mb3JtYXRpb24gb3V0IChmb3Igb3ZlcmxheXMsIEdyaWRCYWNrZ3JvdW5kTm9kZSwgZXRjLilcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGNvbnN0cmFpbnQoKTogQ29uc3RyYWludCB7XHJcbiAgICByZXR1cm4gdGhpcy5fY29uc3RyYWludDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbGVhc2VzIHJlZmVyZW5jZXNcclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuX2NvbnN0cmFpbnQuZGlzcG9zZSgpO1xyXG5cclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbnNjZW5lcnkucmVnaXN0ZXIoICdMYXlvdXROb2RlJywgTGF5b3V0Tm9kZSApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0EsT0FBT0EsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxlQUFlLE1BQU0sdUNBQXVDO0FBQ25FLFNBQVNDLElBQUksRUFBcUNDLE9BQU8sRUFBRUMsT0FBTyxRQUF3QixrQkFBa0I7QUFlNUcsT0FBTyxNQUFNQyx1QkFBdUIsR0FBRyxDQUFFLFFBQVEs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