// Copyright 2016-2023, University of Colorado Boulder

/**
 * A group of alignment boxes that follow the constraints:
 * 1. Every box will have the same bounds, with an upper-left of (0,0)
 * 2. The box sizes will be the smallest possible to fit every box's content (with respective padding).
 * 3. Each box is responsible for positioning its content in its bounds (with customizable alignment and padding).
 *
 * Align boxes can be dynamically created and disposed, and only active boxes will be considered for the bounds.
 *
 * Since many sun components do not support resizing their contents dynamically, you may need to populate the AlignGroup
 * in the order of largest to smallest so that a fixed size container is large enough to contain the largest item.
 *
 * NOTE: Align box resizes may not happen immediately, and may be delayed until bounds of a align box's child occurs.
 *       layout updates can be forced with group.updateLayout(). If the align box's content that changed is connected
 *       to a Scenery display, its bounds will update when Display.updateDisplay() will called, so this will guarantee
 *       that the layout will be applied before it is displayed.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import arrayRemove from '../../../../phet-core/js/arrayRemove.js';
import { combineOptions, optionize3 } from '../../../../phet-core/js/optionize.js';
import { AlignBox, scenery } from '../../imports.js';
import Disposable from '../../../../axon/js/Disposable.js';
import Orientation from '../../../../phet-core/js/Orientation.js';
let globalId = 1;
const DEFAULT_OPTIONS = {
  matchHorizontal: true,
  matchVertical: true
};
export default class AlignGroup extends Disposable {
  // Gets locked when certain layout is performed.

  /**
   * Creates an alignment group that can be composed of multiple boxes.
   *
   * Use createBox() to create alignment boxes. You can dispose() individual boxes, or call dispose() on this
   * group to dispose all of them.
   *
   * It is also possible to create AlignBox instances independently and assign their 'group' to this AlignGroup.
   */
  constructor(providedOptions) {
    assert && assert(providedOptions === undefined || Object.getPrototypeOf(providedOptions) === Object.prototype, 'Extra prototype on options object is a code smell');
    const options = optionize3()({}, DEFAULT_OPTIONS, providedOptions);
    assert && assert(typeof options.matchHorizontal === 'boolean');
    assert && assert(typeof options.matchVertical === 'boolean');
    super();
    this._alignBoxes = [];
    this._matchHorizontal = options.matchHorizontal;
    this._matchVertical = options.matchVertical;

    // Gets locked when certain layout is performed.
    this._resizeLock = false;
    this._maxWidthProperty = new NumberProperty(0);
    this._maxHeightProperty = new NumberProperty(0);
    this.id = globalId++;
  }

  /**
   * Returns the current maximum width of the grouped content.
   */
  getMaxWidth() {
    return this._maxWidthProperty.value;
  }
  get maxWidth() {
    return this.getMaxWidth();
  }

  /**
   * Returns the Property holding the current maximum width of the grouped content.
   */
  getMaxWidthProperty() {
    return this._maxWidthProperty;
  }
  get maxWidthProperty() {
    return this.getMaxWidthProperty();
  }

  /**
   * Returns the current maximum height of the grouped content.
   */
  getMaxHeight() {
    return this._maxHeightProperty.value;
  }
  get maxHeight() {
    return this.getMaxHeight();
  }

  /**
   * Returns the Property holding the current maximum height of the grouped content.
   */
  getMaxHeightProperty() {
    return this._maxHeightProperty;
  }
  get maxHeightProperty() {
    return this.getMaxHeightProperty();
  }
  getMaxSizeProperty(orientation) {
    return orientation === Orientation.HORIZONTAL ? this._maxWidthProperty : this._maxHeightProperty;
  }

  /**
   * Creates an alignment box with the given content and options.
   */
  createBox(content, options) {
    // Setting the group should call our addAlignBox()
    return new AlignBox(content, combineOptions({
      group: this
    }, options));
  }

  /**
   * Sets whether the widths of the align boxes should all match. If false, each box will use its preferred width
   * (usually equal to the content width + horizontal margins).
   */
  setMatchHorizontal(matchHorizontal) {
    if (this._matchHorizontal !== matchHorizontal) {
      this._matchHorizontal = matchHorizontal;

      // Update layout, since it will probably change
      this.updateLayout();
    }
    return this;
  }
  set matchHorizontal(value) {
    this.setMatchHorizontal(value);
  }
  get matchHorizontal() {
    return this.getMatchHorizontal();
  }

  /**
   * Returns whether boxes currently are horizontally matched. See setMatchHorizontal() for details.
   */
  getMatchHorizontal() {
    return this._matchHorizontal;
  }

  /**
   * Sets whether the heights of the align boxes should all match. If false, each box will use its preferred height
   * (usually equal to the content height + vertical margins).
   */
  setMatchVertical(matchVertical) {
    if (this._matchVertical !== matchVertical) {
      this._matchVertical = matchVertical;

      // Update layout, since it will probably change
      this.updateLayout();
    }
    return this;
  }
  set matchVertical(value) {
    this.setMatchVertical(value);
  }
  get matchVertical() {
    return this.getMatchVertical();
  }

  /**
   * Returns whether boxes currently are vertically matched. See setMatchVertical() for details.
   */
  getMatchVertical() {
    return this._matchVertical;
  }

  /**
   * Updates the localBounds and alignment for each alignBox.
   *
   * NOTE: Calling this will usually not be necessary outside of Scenery, but this WILL trigger bounds revalidation
   *       for every alignBox, which can force the layout code to run.
   */
  updateLayout() {
    if (this._resizeLock) {
      return;
    }
    this._resizeLock = true;
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.AlignGroup(`AlignGroup#${this.id} updateLayout`);
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.push();
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.AlignGroup('AlignGroup computing maximum dimension');
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.push();

    // Compute the maximum dimension of our alignBoxs' content
    let maxWidth = 0;
    let maxHeight = 0;
    for (let i = 0; i < this._alignBoxes.length; i++) {
      const alignBox = this._alignBoxes[i];
      const bounds = alignBox.getContentBounds();

      // Ignore bad bounds
      if (bounds.isEmpty() || !bounds.isFinite()) {
        continue;
      }
      maxWidth = Math.max(maxWidth, bounds.width);
      maxHeight = Math.max(maxHeight, bounds.height);
    }
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.pop();
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.AlignGroup('AlignGroup applying to boxes');
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.push();
    this._maxWidthProperty.value = maxWidth;
    this._maxHeightProperty.value = maxHeight;
    if (maxWidth > 0 && maxHeight > 0) {
      // Apply that maximum dimension for each alignBox
      for (let i = 0; i < this._alignBoxes.length; i++) {
        this.setBoxBounds(this._alignBoxes[i], maxWidth, maxHeight);
      }
    }
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.pop();
    sceneryLog && sceneryLog.AlignGroup && sceneryLog.pop();
    this._resizeLock = false;
  }

  /**
   * Sets a box's bounds based on our maximum dimensions.
   */
  setBoxBounds(alignBox, maxWidth, maxHeight) {
    let alignBounds;

    // If we match both dimensions, we don't have to inspect the box's preferred size
    if (this._matchVertical && this._matchHorizontal) {
      alignBounds = new Bounds2(0, 0, maxWidth, maxHeight);
    } else {
      // Grab the preferred size
      const contentBounds = alignBox.getContentBounds();

      // Match one orientation
      if (this._matchVertical) {
        alignBounds = new Bounds2(0, 0, isFinite(contentBounds.width) ? contentBounds.width : maxWidth, maxHeight);
      } else if (this._matchHorizontal) {
        alignBounds = new Bounds2(0, 0, maxWidth, isFinite(contentBounds.height) ? contentBounds.height : maxHeight);
      }
      // If not matching anything, just use its preferred size
      else {
        alignBounds = contentBounds;
      }
    }
    alignBox.alignBounds = alignBounds;
  }

  /**
   * Lets the group know that the alignBox has had its content resized. Called by the AlignBox
   * (scenery-internal)
   */
  onAlignBoxResized(alignBox) {
    // NOTE: in the future, we could only update this specific alignBox if the others don't need updating.
    this.updateLayout();
  }

  /**
   * Adds the AlignBox to the group -- Used in AlignBox --- do NOT use in public code
   * (scenery-internal)
   */
  addAlignBox(alignBox) {
    this._alignBoxes.push(alignBox);

    // Trigger an update when a alignBox is added
    this.updateLayout();
  }

  /**
   * Removes the AlignBox from the group
   * (scenery-internal)
   */
  removeAlignBox(alignBox) {
    arrayRemove(this._alignBoxes, alignBox);

    // Trigger an update when a alignBox is removed
    this.updateLayout();
  }

  /**
   * Dispose all the boxes.
   */
  dispose() {
    for (let i = this._alignBoxes.length - 1; i >= 0; i--) {
      this._alignBoxes[i].dispose();
    }
    super.dispose();
  }
}
scenery.register('AlignGroup', AlignGroup);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOdW1iZXJQcm9wZXJ0eSIsIkJvdW5kczIiLCJhcnJheVJlbW92ZSIsImNvbWJpbmVPcHRpb25zIiwib3B0aW9uaXplMyIsIkFsaWduQm94Iiwic2NlbmVyeSIsIkRpc3Bvc2FibGUiLCJPcmllbnRhdGlvbiIsImdsb2JhbElkIiwiREVGQVVMVF9PUFRJT05TIiwibWF0Y2hIb3Jpem9udGFsIiwibWF0Y2hWZXJ0aWNhbCIsIkFsaWduR3JvdXAiLCJjb25zdHJ1Y3RvciIsInByb3ZpZGVkT3B0aW9ucyIsImFzc2VydCIsInVuZGVmaW5lZCIsIk9iamVjdCIsImdldFByb3RvdHlwZU9mIiwicHJvdG90eXBlIiwib3B0aW9ucyIsIl9hbGlnbkJveGVzIiwiX21hdGNoSG9yaXpvbnRhbCIsIl9tYXRjaFZlcnRpY2FsIiwiX3Jlc2l6ZUxvY2siLCJfbWF4V2lkdGhQcm9wZXJ0eSIsIl9tYXhIZWlnaHRQcm9wZXJ0eSIsImlkIiwiZ2V0TWF4V2lkdGgiLCJ2YWx1ZSIsIm1heFdpZHRoIiwiZ2V0TWF4V2lkdGhQcm9wZXJ0eSIsIm1heFdpZHRoUHJvcGVydHkiLCJnZXRNYXhIZWlnaHQiLCJtYXhIZWlnaHQiLCJnZXRNYXhIZWlnaHRQcm9wZXJ0eSIsIm1heEhlaWdodFByb3BlcnR5IiwiZ2V0TWF4U2l6ZVByb3BlcnR5Iiwib3JpZW50YXRpb24iLCJIT1JJWk9OVEFMIiwiY3JlYXRlQm94IiwiY29udGVudCIsImdyb3VwIiwic2V0TWF0Y2hIb3Jpem9udGFsIiwidXBkYXRlTGF5b3V0IiwiZ2V0TWF0Y2hIb3Jpem9udGFsIiwic2V0TWF0Y2hWZXJ0aWNhbCIsImdldE1hdGNoVmVydGljYWwiLCJzY2VuZXJ5TG9nIiwicHVzaCIsImkiLCJsZW5ndGgiLCJhbGlnbkJveCIsImJvdW5kcyIsImdldENvbnRlbnRCb3VuZHMiLCJpc0VtcHR5IiwiaXNGaW5pdGUiLCJNYXRoIiwibWF4Iiwid2lkdGgiLCJoZWlnaHQiLCJwb3AiLCJzZXRCb3hCb3VuZHMiLCJhbGlnbkJvdW5kcyIsImNvbnRlbnRCb3VuZHMiLCJvbkFsaWduQm94UmVzaXplZCIsImFkZEFsaWduQm94IiwicmVtb3ZlQWxpZ25Cb3giLCJkaXNwb3NlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJBbGlnbkdyb3VwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEEgZ3JvdXAgb2YgYWxpZ25tZW50IGJveGVzIHRoYXQgZm9sbG93IHRoZSBjb25zdHJhaW50czpcclxuICogMS4gRXZlcnkgYm94IHdpbGwgaGF2ZSB0aGUgc2FtZSBib3VuZHMsIHdpdGggYW4gdXBwZXItbGVmdCBvZiAoMCwwKVxyXG4gKiAyLiBUaGUgYm94IHNpemVzIHdpbGwgYmUgdGhlIHNtYWxsZXN0IHBvc3NpYmxlIHRvIGZpdCBldmVyeSBib3gncyBjb250ZW50ICh3aXRoIHJlc3BlY3RpdmUgcGFkZGluZykuXHJcbiAqIDMuIEVhY2ggYm94IGlzIHJlc3BvbnNpYmxlIGZvciBwb3NpdGlvbmluZyBpdHMgY29udGVudCBpbiBpdHMgYm91bmRzICh3aXRoIGN1c3RvbWl6YWJsZSBhbGlnbm1lbnQgYW5kIHBhZGRpbmcpLlxyXG4gKlxyXG4gKiBBbGlnbiBib3hlcyBjYW4gYmUgZHluYW1pY2FsbHkgY3JlYXRlZCBhbmQgZGlzcG9zZWQsIGFuZCBvbmx5IGFjdGl2ZSBib3hlcyB3aWxsIGJlIGNvbnNpZGVyZWQgZm9yIHRoZSBib3VuZHMuXHJcbiAqXHJcbiAqIFNpbmNlIG1hbnkgc3VuIGNvbXBvbmVudHMgZG8gbm90IHN1cHBvcnQgcmVzaXppbmcgdGhlaXIgY29udGVudHMgZHluYW1pY2FsbHksIHlvdSBtYXkgbmVlZCB0byBwb3B1bGF0ZSB0aGUgQWxpZ25Hcm91cFxyXG4gKiBpbiB0aGUgb3JkZXIgb2YgbGFyZ2VzdCB0byBzbWFsbGVzdCBzbyB0aGF0IGEgZml4ZWQgc2l6ZSBjb250YWluZXIgaXMgbGFyZ2UgZW5vdWdoIHRvIGNvbnRhaW4gdGhlIGxhcmdlc3QgaXRlbS5cclxuICpcclxuICogTk9URTogQWxpZ24gYm94IHJlc2l6ZXMgbWF5IG5vdCBoYXBwZW4gaW1tZWRpYXRlbHksIGFuZCBtYXkgYmUgZGVsYXllZCB1bnRpbCBib3VuZHMgb2YgYSBhbGlnbiBib3gncyBjaGlsZCBvY2N1cnMuXHJcbiAqICAgICAgIGxheW91dCB1cGRhdGVzIGNhbiBiZSBmb3JjZWQgd2l0aCBncm91cC51cGRhdGVMYXlvdXQoKS4gSWYgdGhlIGFsaWduIGJveCdzIGNvbnRlbnQgdGhhdCBjaGFuZ2VkIGlzIGNvbm5lY3RlZFxyXG4gKiAgICAgICB0byBhIFNjZW5lcnkgZGlzcGxheSwgaXRzIGJvdW5kcyB3aWxsIHVwZGF0ZSB3aGVuIERpc3BsYXkudXBkYXRlRGlzcGxheSgpIHdpbGwgY2FsbGVkLCBzbyB0aGlzIHdpbGwgZ3VhcmFudGVlXHJcbiAqICAgICAgIHRoYXQgdGhlIGxheW91dCB3aWxsIGJlIGFwcGxpZWQgYmVmb3JlIGl0IGlzIGRpc3BsYXllZC5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IGFycmF5UmVtb3ZlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9hcnJheVJlbW92ZS5qcyc7XHJcbmltcG9ydCB7IGNvbWJpbmVPcHRpb25zLCBvcHRpb25pemUzIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCB7IEFsaWduQm94LCBOb2RlLCBzY2VuZXJ5IH0gZnJvbSAnLi4vLi4vaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB7IEFsaWduQm94T3B0aW9ucyB9IGZyb20gJy4uL25vZGVzL0FsaWduQm94LmpzJztcclxuaW1wb3J0IERpc3Bvc2FibGUgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EaXNwb3NhYmxlLmpzJztcclxuaW1wb3J0IE9yaWVudGF0aW9uIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9PcmllbnRhdGlvbi5qcyc7XHJcblxyXG5sZXQgZ2xvYmFsSWQgPSAxO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICAvLyBXaGV0aGVyIHRoZSBib3hlcyBzaG91bGQgaGF2ZSBhbGwgbWF0Y2hpbmcgd2lkdGhzIChvdGhlcndpc2UgaXQgZml0cyB0byBzaXplKVxyXG4gIG1hdGNoSG9yaXpvbnRhbD86IGJvb2xlYW47XHJcblxyXG4gIC8vIFdoZXRoZXIgdGhlIGJveGVzIHNob3VsZCBoYXZlIGFsbCBtYXRjaGluZyBoZWlnaHRzIChvdGhlcndpc2UgaXQgZml0cyB0byBzaXplKVxyXG4gIG1hdGNoVmVydGljYWw/OiBib29sZWFuO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgQWxpZ25Hcm91cE9wdGlvbnMgPSBTZWxmT3B0aW9ucztcclxuXHJcbmNvbnN0IERFRkFVTFRfT1BUSU9OUyA9IHtcclxuICBtYXRjaEhvcml6b250YWw6IHRydWUsXHJcbiAgbWF0Y2hWZXJ0aWNhbDogdHJ1ZVxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQWxpZ25Hcm91cCBleHRlbmRzIERpc3Bvc2FibGUge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IF9hbGlnbkJveGVzOiBBbGlnbkJveFtdO1xyXG4gIHByaXZhdGUgX21hdGNoSG9yaXpvbnRhbDogYm9vbGVhbjtcclxuICBwcml2YXRlIF9tYXRjaFZlcnRpY2FsOiBib29sZWFuO1xyXG5cclxuICAvLyBHZXRzIGxvY2tlZCB3aGVuIGNlcnRhaW4gbGF5b3V0IGlzIHBlcmZvcm1lZC5cclxuICBwcml2YXRlIF9yZXNpemVMb2NrOiBib29sZWFuO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IF9tYXhXaWR0aFByb3BlcnR5OiBOdW1iZXJQcm9wZXJ0eTtcclxuICBwcml2YXRlIHJlYWRvbmx5IF9tYXhIZWlnaHRQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHk7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBpZDogbnVtYmVyO1xyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGFuIGFsaWdubWVudCBncm91cCB0aGF0IGNhbiBiZSBjb21wb3NlZCBvZiBtdWx0aXBsZSBib3hlcy5cclxuICAgKlxyXG4gICAqIFVzZSBjcmVhdGVCb3goKSB0byBjcmVhdGUgYWxpZ25tZW50IGJveGVzLiBZb3UgY2FuIGRpc3Bvc2UoKSBpbmRpdmlkdWFsIGJveGVzLCBvciBjYWxsIGRpc3Bvc2UoKSBvbiB0aGlzXHJcbiAgICogZ3JvdXAgdG8gZGlzcG9zZSBhbGwgb2YgdGhlbS5cclxuICAgKlxyXG4gICAqIEl0IGlzIGFsc28gcG9zc2libGUgdG8gY3JlYXRlIEFsaWduQm94IGluc3RhbmNlcyBpbmRlcGVuZGVudGx5IGFuZCBhc3NpZ24gdGhlaXIgJ2dyb3VwJyB0byB0aGlzIEFsaWduR3JvdXAuXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM/OiBBbGlnbkdyb3VwT3B0aW9ucyApIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHByb3ZpZGVkT3B0aW9ucyA9PT0gdW5kZWZpbmVkIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZiggcHJvdmlkZWRPcHRpb25zICkgPT09IE9iamVjdC5wcm90b3R5cGUsXHJcbiAgICAgICdFeHRyYSBwcm90b3R5cGUgb24gb3B0aW9ucyBvYmplY3QgaXMgYSBjb2RlIHNtZWxsJyApO1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemUzPEFsaWduR3JvdXBPcHRpb25zLCBTZWxmT3B0aW9ucz4oKSgge30sIERFRkFVTFRfT1BUSU9OUywgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdHlwZW9mIG9wdGlvbnMubWF0Y2hIb3Jpem9udGFsID09PSAnYm9vbGVhbicgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHR5cGVvZiBvcHRpb25zLm1hdGNoVmVydGljYWwgPT09ICdib29sZWFuJyApO1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5fYWxpZ25Cb3hlcyA9IFtdO1xyXG5cclxuICAgIHRoaXMuX21hdGNoSG9yaXpvbnRhbCA9IG9wdGlvbnMubWF0Y2hIb3Jpem9udGFsO1xyXG5cclxuICAgIHRoaXMuX21hdGNoVmVydGljYWwgPSBvcHRpb25zLm1hdGNoVmVydGljYWw7XHJcblxyXG4gICAgLy8gR2V0cyBsb2NrZWQgd2hlbiBjZXJ0YWluIGxheW91dCBpcyBwZXJmb3JtZWQuXHJcbiAgICB0aGlzLl9yZXNpemVMb2NrID0gZmFsc2U7XHJcblxyXG4gICAgdGhpcy5fbWF4V2lkdGhQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggMCApO1xyXG5cclxuICAgIHRoaXMuX21heEhlaWdodFByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCAwICk7XHJcblxyXG4gICAgdGhpcy5pZCA9IGdsb2JhbElkKys7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IG1heGltdW0gd2lkdGggb2YgdGhlIGdyb3VwZWQgY29udGVudC5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TWF4V2lkdGgoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLl9tYXhXaWR0aFByb3BlcnR5LnZhbHVlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBtYXhXaWR0aCgpOiBudW1iZXIgeyByZXR1cm4gdGhpcy5nZXRNYXhXaWR0aCgpOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIFByb3BlcnR5IGhvbGRpbmcgdGhlIGN1cnJlbnQgbWF4aW11bSB3aWR0aCBvZiB0aGUgZ3JvdXBlZCBjb250ZW50LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRNYXhXaWR0aFByb3BlcnR5KCk6IFRQcm9wZXJ0eTxudW1iZXI+IHtcclxuICAgIHJldHVybiB0aGlzLl9tYXhXaWR0aFByb3BlcnR5O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBtYXhXaWR0aFByb3BlcnR5KCk6IFRQcm9wZXJ0eTxudW1iZXI+IHsgcmV0dXJuIHRoaXMuZ2V0TWF4V2lkdGhQcm9wZXJ0eSgpOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIGN1cnJlbnQgbWF4aW11bSBoZWlnaHQgb2YgdGhlIGdyb3VwZWQgY29udGVudC5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TWF4SGVpZ2h0KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5fbWF4SGVpZ2h0UHJvcGVydHkudmFsdWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IG1heEhlaWdodCgpOiBudW1iZXIgeyByZXR1cm4gdGhpcy5nZXRNYXhIZWlnaHQoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSBQcm9wZXJ0eSBob2xkaW5nIHRoZSBjdXJyZW50IG1heGltdW0gaGVpZ2h0IG9mIHRoZSBncm91cGVkIGNvbnRlbnQuXHJcbiAgICovXHJcbiAgcHVibGljIGdldE1heEhlaWdodFByb3BlcnR5KCk6IFRQcm9wZXJ0eTxudW1iZXI+IHtcclxuICAgIHJldHVybiB0aGlzLl9tYXhIZWlnaHRQcm9wZXJ0eTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgbWF4SGVpZ2h0UHJvcGVydHkoKTogVFByb3BlcnR5PG51bWJlcj4geyByZXR1cm4gdGhpcy5nZXRNYXhIZWlnaHRQcm9wZXJ0eSgpOyB9XHJcblxyXG4gIHB1YmxpYyBnZXRNYXhTaXplUHJvcGVydHkoIG9yaWVudGF0aW9uOiBPcmllbnRhdGlvbiApOiBUUHJvcGVydHk8bnVtYmVyPiB7XHJcbiAgICByZXR1cm4gb3JpZW50YXRpb24gPT09IE9yaWVudGF0aW9uLkhPUklaT05UQUwgPyB0aGlzLl9tYXhXaWR0aFByb3BlcnR5IDogdGhpcy5fbWF4SGVpZ2h0UHJvcGVydHk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGFuIGFsaWdubWVudCBib3ggd2l0aCB0aGUgZ2l2ZW4gY29udGVudCBhbmQgb3B0aW9ucy5cclxuICAgKi9cclxuICBwdWJsaWMgY3JlYXRlQm94KCBjb250ZW50OiBOb2RlLCBvcHRpb25zPzogQWxpZ25Cb3hPcHRpb25zICk6IEFsaWduQm94IHtcclxuXHJcbiAgICAvLyBTZXR0aW5nIHRoZSBncm91cCBzaG91bGQgY2FsbCBvdXIgYWRkQWxpZ25Cb3goKVxyXG4gICAgcmV0dXJuIG5ldyBBbGlnbkJveCggY29udGVudCwgY29tYmluZU9wdGlvbnM8QWxpZ25Cb3hPcHRpb25zPigge1xyXG4gICAgICBncm91cDogdGhpc1xyXG4gICAgfSwgb3B0aW9ucyApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHdoZXRoZXIgdGhlIHdpZHRocyBvZiB0aGUgYWxpZ24gYm94ZXMgc2hvdWxkIGFsbCBtYXRjaC4gSWYgZmFsc2UsIGVhY2ggYm94IHdpbGwgdXNlIGl0cyBwcmVmZXJyZWQgd2lkdGhcclxuICAgKiAodXN1YWxseSBlcXVhbCB0byB0aGUgY29udGVudCB3aWR0aCArIGhvcml6b250YWwgbWFyZ2lucykuXHJcbiAgICovXHJcbiAgcHVibGljIHNldE1hdGNoSG9yaXpvbnRhbCggbWF0Y2hIb3Jpem9udGFsOiBib29sZWFuICk6IHRoaXMge1xyXG5cclxuICAgIGlmICggdGhpcy5fbWF0Y2hIb3Jpem9udGFsICE9PSBtYXRjaEhvcml6b250YWwgKSB7XHJcbiAgICAgIHRoaXMuX21hdGNoSG9yaXpvbnRhbCA9IG1hdGNoSG9yaXpvbnRhbDtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBsYXlvdXQsIHNpbmNlIGl0IHdpbGwgcHJvYmFibHkgY2hhbmdlXHJcbiAgICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IG1hdGNoSG9yaXpvbnRhbCggdmFsdWU6IGJvb2xlYW4gKSB7IHRoaXMuc2V0TWF0Y2hIb3Jpem9udGFsKCB2YWx1ZSApOyB9XHJcblxyXG4gIHB1YmxpYyBnZXQgbWF0Y2hIb3Jpem9udGFsKCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy5nZXRNYXRjaEhvcml6b250YWwoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHdoZXRoZXIgYm94ZXMgY3VycmVudGx5IGFyZSBob3Jpem9udGFsbHkgbWF0Y2hlZC4gU2VlIHNldE1hdGNoSG9yaXpvbnRhbCgpIGZvciBkZXRhaWxzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRNYXRjaEhvcml6b250YWwoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5fbWF0Y2hIb3Jpem9udGFsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB3aGV0aGVyIHRoZSBoZWlnaHRzIG9mIHRoZSBhbGlnbiBib3hlcyBzaG91bGQgYWxsIG1hdGNoLiBJZiBmYWxzZSwgZWFjaCBib3ggd2lsbCB1c2UgaXRzIHByZWZlcnJlZCBoZWlnaHRcclxuICAgKiAodXN1YWxseSBlcXVhbCB0byB0aGUgY29udGVudCBoZWlnaHQgKyB2ZXJ0aWNhbCBtYXJnaW5zKS5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0TWF0Y2hWZXJ0aWNhbCggbWF0Y2hWZXJ0aWNhbDogYm9vbGVhbiApOiB0aGlzIHtcclxuXHJcbiAgICBpZiAoIHRoaXMuX21hdGNoVmVydGljYWwgIT09IG1hdGNoVmVydGljYWwgKSB7XHJcbiAgICAgIHRoaXMuX21hdGNoVmVydGljYWwgPSBtYXRjaFZlcnRpY2FsO1xyXG5cclxuICAgICAgLy8gVXBkYXRlIGxheW91dCwgc2luY2UgaXQgd2lsbCBwcm9iYWJseSBjaGFuZ2VcclxuICAgICAgdGhpcy51cGRhdGVMYXlvdXQoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgbWF0Y2hWZXJ0aWNhbCggdmFsdWU6IGJvb2xlYW4gKSB7IHRoaXMuc2V0TWF0Y2hWZXJ0aWNhbCggdmFsdWUgKTsgfVxyXG5cclxuICBwdWJsaWMgZ2V0IG1hdGNoVmVydGljYWwoKTogYm9vbGVhbiB7IHJldHVybiB0aGlzLmdldE1hdGNoVmVydGljYWwoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHdoZXRoZXIgYm94ZXMgY3VycmVudGx5IGFyZSB2ZXJ0aWNhbGx5IG1hdGNoZWQuIFNlZSBzZXRNYXRjaFZlcnRpY2FsKCkgZm9yIGRldGFpbHMuXHJcbiAgICovXHJcbiAgcHVibGljIGdldE1hdGNoVmVydGljYWwoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5fbWF0Y2hWZXJ0aWNhbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZXMgdGhlIGxvY2FsQm91bmRzIGFuZCBhbGlnbm1lbnQgZm9yIGVhY2ggYWxpZ25Cb3guXHJcbiAgICpcclxuICAgKiBOT1RFOiBDYWxsaW5nIHRoaXMgd2lsbCB1c3VhbGx5IG5vdCBiZSBuZWNlc3Nhcnkgb3V0c2lkZSBvZiBTY2VuZXJ5LCBidXQgdGhpcyBXSUxMIHRyaWdnZXIgYm91bmRzIHJldmFsaWRhdGlvblxyXG4gICAqICAgICAgIGZvciBldmVyeSBhbGlnbkJveCwgd2hpY2ggY2FuIGZvcmNlIHRoZSBsYXlvdXQgY29kZSB0byBydW4uXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZUxheW91dCgpOiB2b2lkIHtcclxuICAgIGlmICggdGhpcy5fcmVzaXplTG9jayApIHsgcmV0dXJuOyB9XHJcbiAgICB0aGlzLl9yZXNpemVMb2NrID0gdHJ1ZTtcclxuXHJcbiAgICBzY2VuZXJ5TG9nICYmIHNjZW5lcnlMb2cuQWxpZ25Hcm91cCAmJiBzY2VuZXJ5TG9nLkFsaWduR3JvdXAoXHJcbiAgICAgIGBBbGlnbkdyb3VwIyR7dGhpcy5pZH0gdXBkYXRlTGF5b3V0YCApO1xyXG4gICAgc2NlbmVyeUxvZyAmJiBzY2VuZXJ5TG9nLkFsaWduR3JvdXAgJiYgc2NlbmVyeUxvZy5wdXNoKCk7XHJcblxyXG4gICAgc2NlbmVyeUxvZyAmJiBzY2VuZXJ5TG9nLkFsaWduR3JvdXAgJiYgc2NlbmVyeUxvZy5BbGlnbkdyb3VwKCAnQWxpZ25Hcm91cCBjb21wdXRpbmcgbWF4aW11bSBkaW1lbnNpb24nICk7XHJcbiAgICBzY2VuZXJ5TG9nICYmIHNjZW5lcnlMb2cuQWxpZ25Hcm91cCAmJiBzY2VuZXJ5TG9nLnB1c2goKTtcclxuXHJcbiAgICAvLyBDb21wdXRlIHRoZSBtYXhpbXVtIGRpbWVuc2lvbiBvZiBvdXIgYWxpZ25Cb3hzJyBjb250ZW50XHJcbiAgICBsZXQgbWF4V2lkdGggPSAwO1xyXG4gICAgbGV0IG1heEhlaWdodCA9IDA7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLl9hbGlnbkJveGVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBjb25zdCBhbGlnbkJveCA9IHRoaXMuX2FsaWduQm94ZXNbIGkgXTtcclxuXHJcbiAgICAgIGNvbnN0IGJvdW5kcyA9IGFsaWduQm94LmdldENvbnRlbnRCb3VuZHMoKTtcclxuXHJcbiAgICAgIC8vIElnbm9yZSBiYWQgYm91bmRzXHJcbiAgICAgIGlmICggYm91bmRzLmlzRW1wdHkoKSB8fCAhYm91bmRzLmlzRmluaXRlKCkgKSB7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIG1heFdpZHRoID0gTWF0aC5tYXgoIG1heFdpZHRoLCBib3VuZHMud2lkdGggKTtcclxuICAgICAgbWF4SGVpZ2h0ID0gTWF0aC5tYXgoIG1heEhlaWdodCwgYm91bmRzLmhlaWdodCApO1xyXG4gICAgfVxyXG5cclxuICAgIHNjZW5lcnlMb2cgJiYgc2NlbmVyeUxvZy5BbGlnbkdyb3VwICYmIHNjZW5lcnlMb2cucG9wKCk7XHJcbiAgICBzY2VuZXJ5TG9nICYmIHNjZW5lcnlMb2cuQWxpZ25Hcm91cCAmJiBzY2VuZXJ5TG9nLkFsaWduR3JvdXAoICdBbGlnbkdyb3VwIGFwcGx5aW5nIHRvIGJveGVzJyApO1xyXG4gICAgc2NlbmVyeUxvZyAmJiBzY2VuZXJ5TG9nLkFsaWduR3JvdXAgJiYgc2NlbmVyeUxvZy5wdXNoKCk7XHJcblxyXG4gICAgdGhpcy5fbWF4V2lkdGhQcm9wZXJ0eS52YWx1ZSA9IG1heFdpZHRoO1xyXG4gICAgdGhpcy5fbWF4SGVpZ2h0UHJvcGVydHkudmFsdWUgPSBtYXhIZWlnaHQ7XHJcblxyXG4gICAgaWYgKCBtYXhXaWR0aCA+IDAgJiYgbWF4SGVpZ2h0ID4gMCApIHtcclxuICAgICAgLy8gQXBwbHkgdGhhdCBtYXhpbXVtIGRpbWVuc2lvbiBmb3IgZWFjaCBhbGlnbkJveFxyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLl9hbGlnbkJveGVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgIHRoaXMuc2V0Qm94Qm91bmRzKCB0aGlzLl9hbGlnbkJveGVzWyBpIF0sIG1heFdpZHRoLCBtYXhIZWlnaHQgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNjZW5lcnlMb2cgJiYgc2NlbmVyeUxvZy5BbGlnbkdyb3VwICYmIHNjZW5lcnlMb2cucG9wKCk7XHJcbiAgICBzY2VuZXJ5TG9nICYmIHNjZW5lcnlMb2cuQWxpZ25Hcm91cCAmJiBzY2VuZXJ5TG9nLnBvcCgpO1xyXG5cclxuICAgIHRoaXMuX3Jlc2l6ZUxvY2sgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgYSBib3gncyBib3VuZHMgYmFzZWQgb24gb3VyIG1heGltdW0gZGltZW5zaW9ucy5cclxuICAgKi9cclxuICBwcml2YXRlIHNldEJveEJvdW5kcyggYWxpZ25Cb3g6IEFsaWduQm94LCBtYXhXaWR0aDogbnVtYmVyLCBtYXhIZWlnaHQ6IG51bWJlciApOiB2b2lkIHtcclxuICAgIGxldCBhbGlnbkJvdW5kcztcclxuXHJcbiAgICAvLyBJZiB3ZSBtYXRjaCBib3RoIGRpbWVuc2lvbnMsIHdlIGRvbid0IGhhdmUgdG8gaW5zcGVjdCB0aGUgYm94J3MgcHJlZmVycmVkIHNpemVcclxuICAgIGlmICggdGhpcy5fbWF0Y2hWZXJ0aWNhbCAmJiB0aGlzLl9tYXRjaEhvcml6b250YWwgKSB7XHJcbiAgICAgIGFsaWduQm91bmRzID0gbmV3IEJvdW5kczIoIDAsIDAsIG1heFdpZHRoLCBtYXhIZWlnaHQgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAvLyBHcmFiIHRoZSBwcmVmZXJyZWQgc2l6ZVxyXG4gICAgICBjb25zdCBjb250ZW50Qm91bmRzID0gYWxpZ25Cb3guZ2V0Q29udGVudEJvdW5kcygpO1xyXG5cclxuICAgICAgLy8gTWF0Y2ggb25lIG9yaWVudGF0aW9uXHJcbiAgICAgIGlmICggdGhpcy5fbWF0Y2hWZXJ0aWNhbCApIHtcclxuICAgICAgICBhbGlnbkJvdW5kcyA9IG5ldyBCb3VuZHMyKCAwLCAwLCBpc0Zpbml0ZSggY29udGVudEJvdW5kcy53aWR0aCApID8gY29udGVudEJvdW5kcy53aWR0aCA6IG1heFdpZHRoLCBtYXhIZWlnaHQgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggdGhpcy5fbWF0Y2hIb3Jpem9udGFsICkge1xyXG4gICAgICAgIGFsaWduQm91bmRzID0gbmV3IEJvdW5kczIoIDAsIDAsIG1heFdpZHRoLCBpc0Zpbml0ZSggY29udGVudEJvdW5kcy5oZWlnaHQgKSA/IGNvbnRlbnRCb3VuZHMuaGVpZ2h0IDogbWF4SGVpZ2h0ICk7XHJcbiAgICAgIH1cclxuICAgICAgLy8gSWYgbm90IG1hdGNoaW5nIGFueXRoaW5nLCBqdXN0IHVzZSBpdHMgcHJlZmVycmVkIHNpemVcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgYWxpZ25Cb3VuZHMgPSBjb250ZW50Qm91bmRzO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYWxpZ25Cb3guYWxpZ25Cb3VuZHMgPSBhbGlnbkJvdW5kcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExldHMgdGhlIGdyb3VwIGtub3cgdGhhdCB0aGUgYWxpZ25Cb3ggaGFzIGhhZCBpdHMgY29udGVudCByZXNpemVkLiBDYWxsZWQgYnkgdGhlIEFsaWduQm94XHJcbiAgICogKHNjZW5lcnktaW50ZXJuYWwpXHJcbiAgICovXHJcbiAgcHVibGljIG9uQWxpZ25Cb3hSZXNpemVkKCBhbGlnbkJveDogQWxpZ25Cb3ggKTogdm9pZCB7XHJcbiAgICAvLyBOT1RFOiBpbiB0aGUgZnV0dXJlLCB3ZSBjb3VsZCBvbmx5IHVwZGF0ZSB0aGlzIHNwZWNpZmljIGFsaWduQm94IGlmIHRoZSBvdGhlcnMgZG9uJ3QgbmVlZCB1cGRhdGluZy5cclxuICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGRzIHRoZSBBbGlnbkJveCB0byB0aGUgZ3JvdXAgLS0gVXNlZCBpbiBBbGlnbkJveCAtLS0gZG8gTk9UIHVzZSBpbiBwdWJsaWMgY29kZVxyXG4gICAqIChzY2VuZXJ5LWludGVybmFsKVxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRBbGlnbkJveCggYWxpZ25Cb3g6IEFsaWduQm94ICk6IHZvaWQge1xyXG4gICAgdGhpcy5fYWxpZ25Cb3hlcy5wdXNoKCBhbGlnbkJveCApO1xyXG5cclxuICAgIC8vIFRyaWdnZXIgYW4gdXBkYXRlIHdoZW4gYSBhbGlnbkJveCBpcyBhZGRlZFxyXG4gICAgdGhpcy51cGRhdGVMYXlvdXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbW92ZXMgdGhlIEFsaWduQm94IGZyb20gdGhlIGdyb3VwXHJcbiAgICogKHNjZW5lcnktaW50ZXJuYWwpXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUFsaWduQm94KCBhbGlnbkJveDogQWxpZ25Cb3ggKTogdm9pZCB7XHJcbiAgICBhcnJheVJlbW92ZSggdGhpcy5fYWxpZ25Cb3hlcywgYWxpZ25Cb3ggKTtcclxuXHJcbiAgICAvLyBUcmlnZ2VyIGFuIHVwZGF0ZSB3aGVuIGEgYWxpZ25Cb3ggaXMgcmVtb3ZlZFxyXG4gICAgdGhpcy51cGRhdGVMYXlvdXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERpc3Bvc2UgYWxsIHRoZSBib3hlcy5cclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGZvciAoIGxldCBpID0gdGhpcy5fYWxpZ25Cb3hlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSApIHtcclxuICAgICAgdGhpcy5fYWxpZ25Cb3hlc1sgaSBdLmRpc3Bvc2UoKTtcclxuICAgIH1cclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbnNjZW5lcnkucmVnaXN0ZXIoICdBbGlnbkdyb3VwJywgQWxpZ25Hcm91cCApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFHQSxPQUFPQSxjQUFjLE1BQU0sdUNBQXVDO0FBQ2xFLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsV0FBVyxNQUFNLHlDQUF5QztBQUNqRSxTQUFTQyxjQUFjLEVBQUVDLFVBQVUsUUFBUSx1Q0FBdUM7QUFDbEYsU0FBU0MsUUFBUSxFQUFRQyxPQUFPLFFBQVEsa0JBQWtCO0FBRTFELE9BQU9DLFVBQVUsTUFBTSxtQ0FBbUM7QUFDMUQsT0FBT0MsV0FBVyxNQUFNLHlDQUF5QztBQUVqRSxJQUFJQyxRQUFRLEdBQUcsQ0FBQztBQVloQixNQUFNQyxlQUFlLEdBQUc7RUFDdEJDLGVBQWUsRUFBRSxJQUFJO0VBQ3JCQyxhQUFhLEVB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