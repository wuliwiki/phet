// Copyright 2021-2022, University of Colorado Boulder

/**
 * A configurable cell containing a Node used for GridConstraint layout
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Orientation from '../../../../phet-core/js/Orientation.js';
import OrientationPair from '../../../../phet-core/js/OrientationPair.js';
import { GridConfigurable, GRID_CONFIGURABLE_OPTION_KEYS, MarginLayoutCell, scenery } from '../../imports.js';
import optionize from '../../../../phet-core/js/optionize.js';
const GRID_CELL_KEYS = [...GRID_CONFIGURABLE_OPTION_KEYS, 'row', 'column', 'horizontalSpan', 'verticalSpan'];
export default class GridCell extends GridConfigurable(MarginLayoutCell) {
  // (scenery-internal) These are only set initially, and ignored for the future

  /**
   * (scenery-internal)
   */
  constructor(constraint, node, proxy) {
    super(constraint, node, proxy);
    this.gridConstraint = constraint;
    this.setOptions(node.layoutOptions);
    this.onLayoutOptionsChange();
  }

  /**
   * Return the used value, with this cell's value taking precedence over the constraint's default
   * (scenery-internal)
   */
  get effectiveXAlign() {
    return this._xAlign !== null ? this._xAlign : this.gridConstraint._xAlign;
  }

  /**
   * Return the used value, with this cell's value taking precedence over the constraint's default
   * (scenery-internal)
   */
  get effectiveYAlign() {
    return this._yAlign !== null ? this._yAlign : this.gridConstraint._yAlign;
  }

  /**
   * (scenery-internal)
   */
  getEffectiveAlign(orientation) {
    return orientation === Orientation.HORIZONTAL ? this.effectiveXAlign : this.effectiveYAlign;
  }

  /**
   * Return the used value, with this cell's value taking precedence over the constraint's default
   * (scenery-internal)
   */
  get effectiveXGrow() {
    return this._xGrow !== null ? this._xGrow : this.gridConstraint._xGrow;
  }

  /**
   * Return the used value, with this cell's value taking precedence over the constraint's default
   * (scenery-internal)
   */
  get effectiveYGrow() {
    return this._yGrow !== null ? this._yGrow : this.gridConstraint._yGrow;
  }

  /**
   * (scenery-internal)
   */
  getEffectiveGrow(orientation) {
    return orientation === Orientation.HORIZONTAL ? this.effectiveXGrow : this.effectiveYGrow;
  }

  /**
   * Return the used value, with this cell's value taking precedence over the constraint's default
   * (scenery-internal)
   */
  get effectiveXStretch() {
    return this._xStretch !== null ? this._xStretch : this.gridConstraint._xStretch;
  }

  /**
   * Return the used value, with this cell's value taking precedence over the constraint's default
   * (scenery-internal)
   */
  get effectiveYStretch() {
    return this._yStretch !== null ? this._yStretch : this.gridConstraint._yStretch;
  }

  /**
   * (scenery-internal)
   */
  getEffectiveStretch(orientation) {
    return orientation === Orientation.HORIZONTAL ? this.effectiveXStretch : this.effectiveYStretch;
  }
  onLayoutOptionsChange() {
    this.setOptions(this.node.layoutOptions);
    super.onLayoutOptionsChange();
  }
  setOptions(providedOptions) {
    // We'll have defaults for cells (the horizontalSpan/verticalSpan are especially relevant)
    const options = optionize()({
      column: 0,
      row: 0,
      horizontalSpan: 1,
      verticalSpan: 1
    }, providedOptions);
    assert && Object.keys(options).forEach(key => {
      assert && assert(GRID_CELL_KEYS.includes(key), `Cannot provide key ${key} to a GridCell's layoutOptions. Perhaps this is a Flow-style layout option?`);
    });
    assert && assert(typeof options.column === 'number' && Number.isInteger(options.column) && isFinite(options.column) && options.column >= 0);
    assert && assert(typeof options.row === 'number' && Number.isInteger(options.row) && isFinite(options.row) && options.row >= 0);
    assert && assert(typeof options.horizontalSpan === 'number' && Number.isInteger(options.horizontalSpan) && isFinite(options.horizontalSpan) && options.horizontalSpan >= 1);
    assert && assert(typeof options.verticalSpan === 'number' && Number.isInteger(options.verticalSpan) && isFinite(options.verticalSpan) && options.verticalSpan >= 1);
    this.setConfigToInherit();
    this.position = new OrientationPair(options.column, options.row);
    this.size = new OrientationPair(options.horizontalSpan, options.verticalSpan);
    this.mutateConfigurable(options);
  }

  /**
   * Whether this cell contains the given row/column (based on the orientation). Due to horizontalSpan/verticalSpan of the cell,
   * this could be true for multiple indices.
   * (scenery-internal)
   */
  containsIndex(orientation, index) {
    const position = this.position.get(orientation);
    const size = this.size.get(orientation);
    return index >= position && index < position + size;
  }

  /**
   * Whether this cell contains the given row.
   * (scenery-internal)
   */
  containsRow(row) {
    return this.containsIndex(Orientation.VERTICAL, row);
  }

  /**
   * Whether this cell contains the given column.
   * (scenery-internal)
   */
  containsColumn(column) {
    return this.containsIndex(Orientation.HORIZONTAL, column);
  }

  /**
   * Returns the row/column indices that this cell spans (based on the orientation)
   * (scenery-internal)
   */
  getIndices(orientation) {
    const position = this.position.get(orientation);
    const size = this.size.get(orientation);
    return _.range(position, position + size);
  }
}
scenery.register('GridCell', GridCell);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPcmllbnRhdGlvbiIsIk9yaWVudGF0aW9uUGFpciIsIkdyaWRDb25maWd1cmFibGUiLCJHUklEX0NPTkZJR1VSQUJMRV9PUFRJT05fS0VZUyIsIk1hcmdpbkxheW91dENlbGwiLCJzY2VuZXJ5Iiwib3B0aW9uaXplIiwiR1JJRF9DRUxMX0tFWVMiLCJHcmlkQ2VsbCIsImNvbnN0cnVjdG9yIiwiY29uc3RyYWludCIsIm5vZGUiLCJwcm94eSIsImdyaWRDb25zdHJhaW50Iiwic2V0T3B0aW9ucyIsImxheW91dE9wdGlvbnMiLCJvbkxheW91dE9wdGlvbnNDaGFuZ2UiLCJlZmZlY3RpdmVYQWxpZ24iLCJfeEFsaWduIiwiZWZmZWN0aXZlWUFsaWduIiwiX3lBbGlnbiIsImdldEVmZmVjdGl2ZUFsaWduIiwib3JpZW50YXRpb24iLCJIT1JJWk9OVEFMIiwiZWZmZWN0aXZlWEdyb3ciLCJfeEdyb3ciLCJlZmZlY3RpdmVZR3JvdyIsIl95R3JvdyIsImdldEVmZmVjdGl2ZUdyb3ciLCJlZmZlY3RpdmVYU3RyZXRjaCIsIl94U3RyZXRjaCIsImVmZmVjdGl2ZVlTdHJldGNoIiwiX3lTdHJldGNoIiwiZ2V0RWZmZWN0aXZlU3RyZXRjaCIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJjb2x1bW4iLCJyb3ciLCJob3Jpem9udGFsU3BhbiIsInZlcnRpY2FsU3BhbiIsImFzc2VydCIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwia2V5IiwiaW5jbHVkZXMiLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJpc0Zpbml0ZSIsInNldENvbmZpZ1RvSW5oZXJpdCIsInBvc2l0aW9uIiwic2l6ZSIsIm11dGF0ZUNvbmZpZ3VyYWJsZSIsImNvbnRhaW5zSW5kZXgiLCJpbmRleCIsImdldCIsImNvbnRhaW5zUm93IiwiVkVSVElDQUwiLCJjb250YWluc0NvbHVtbiIsImdldEluZGljZXMiLCJfIiwicmFuZ2UiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkdyaWRDZWxsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEEgY29uZmlndXJhYmxlIGNlbGwgY29udGFpbmluZyBhIE5vZGUgdXNlZCBmb3IgR3JpZENvbnN0cmFpbnQgbGF5b3V0XHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgT3JpZW50YXRpb24gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL09yaWVudGF0aW9uLmpzJztcclxuaW1wb3J0IE9yaWVudGF0aW9uUGFpciBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvT3JpZW50YXRpb25QYWlyLmpzJztcclxuaW1wb3J0IHsgRXh0ZXJuYWxHcmlkQ29uZmlndXJhYmxlT3B0aW9ucywgR3JpZENvbmZpZ3VyYWJsZSwgR3JpZENvbnN0cmFpbnQsIEdSSURfQ09ORklHVVJBQkxFX09QVElPTl9LRVlTLCBMYXlvdXRBbGlnbiwgTGF5b3V0UHJveHksIE1hcmdpbkxheW91dENlbGwsIE5vZGUsIHNjZW5lcnkgfSBmcm9tICcuLi8uLi9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuXHJcbmNvbnN0IEdSSURfQ0VMTF9LRVlTID0gW1xyXG4gIC4uLkdSSURfQ09ORklHVVJBQkxFX09QVElPTl9LRVlTLFxyXG4gICdyb3cnLFxyXG4gICdjb2x1bW4nLFxyXG4gICdob3Jpem9udGFsU3BhbicsXHJcbiAgJ3ZlcnRpY2FsU3BhbidcclxuXTtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcblxyXG4gIC8vIERlZmluZXMgdGhlIHJvdyAob3IgaWYgaGVpZ2h0PjEsIHRoZSB0b3AtbW9zdCByb3cpIGluZGV4IG9mIHRoZSBjZWxsLiByb3c6MCBpcyB0aGUgdG9wLW1vc3Qgcm93XHJcbiAgcm93PzogbnVtYmVyO1xyXG5cclxuICAvLyBEZWZpbmVzIHRoZSBjb2x1bW4gKG9yIGlmIHdpZHRoPjEsIHRoZSBsZWZ0LW1vc3QgY29sdW1uKSBpbmRleCBvZiB0aGUgY2VsbC4gY29sdW1uOjAgaXMgdGhlIGxlZnQtbW9zdCBjb2x1bW4uXHJcbiAgY29sdW1uPzogbnVtYmVyO1xyXG5cclxuICAvLyBIb3cgbWFueSBjb2x1bW5zIHRoaXMgb25lIGNlbGwgc3BhbnMuXHJcbiAgaG9yaXpvbnRhbFNwYW4/OiBudW1iZXI7XHJcblxyXG4gIC8vIEhvdyBtYW55IHJvd3MgdGhpcyBvbmUgY2VsbCBzcGFuc1xyXG4gIHZlcnRpY2FsU3Bhbj86IG51bWJlcjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEdyaWRDZWxsT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgRXh0ZXJuYWxHcmlkQ29uZmlndXJhYmxlT3B0aW9ucztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdyaWRDZWxsIGV4dGVuZHMgR3JpZENvbmZpZ3VyYWJsZSggTWFyZ2luTGF5b3V0Q2VsbCApIHtcclxuXHJcbiAgLy8gKHNjZW5lcnktaW50ZXJuYWwpIFRoZXNlIGFyZSBvbmx5IHNldCBpbml0aWFsbHksIGFuZCBpZ25vcmVkIGZvciB0aGUgZnV0dXJlXHJcbiAgcHVibGljIHBvc2l0aW9uITogT3JpZW50YXRpb25QYWlyPG51bWJlcj47XHJcbiAgcHVibGljIHNpemUhOiBPcmllbnRhdGlvblBhaXI8bnVtYmVyPjtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBncmlkQ29uc3RyYWludDogR3JpZENvbnN0cmFpbnQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIChzY2VuZXJ5LWludGVybmFsKVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggY29uc3RyYWludDogR3JpZENvbnN0cmFpbnQsIG5vZGU6IE5vZGUsIHByb3h5OiBMYXlvdXRQcm94eSB8IG51bGwgKSB7XHJcblxyXG4gICAgc3VwZXIoIGNvbnN0cmFpbnQsIG5vZGUsIHByb3h5ICk7XHJcblxyXG4gICAgdGhpcy5ncmlkQ29uc3RyYWludCA9IGNvbnN0cmFpbnQ7XHJcblxyXG4gICAgdGhpcy5zZXRPcHRpb25zKCBub2RlLmxheW91dE9wdGlvbnMgYXMgRXh0ZXJuYWxHcmlkQ29uZmlndXJhYmxlT3B0aW9ucyApO1xyXG4gICAgdGhpcy5vbkxheW91dE9wdGlvbnNDaGFuZ2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybiB0aGUgdXNlZCB2YWx1ZSwgd2l0aCB0aGlzIGNlbGwncyB2YWx1ZSB0YWtpbmcgcHJlY2VkZW5jZSBvdmVyIHRoZSBjb25zdHJhaW50J3MgZGVmYXVsdFxyXG4gICAqIChzY2VuZXJ5LWludGVybmFsKVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgZWZmZWN0aXZlWEFsaWduKCk6IExheW91dEFsaWduIHtcclxuICAgIHJldHVybiB0aGlzLl94QWxpZ24gIT09IG51bGwgPyB0aGlzLl94QWxpZ24gOiB0aGlzLmdyaWRDb25zdHJhaW50Ll94QWxpZ24hO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJuIHRoZSB1c2VkIHZhbHVlLCB3aXRoIHRoaXMgY2VsbCdzIHZhbHVlIHRha2luZyBwcmVjZWRlbmNlIG92ZXIgdGhlIGNvbnN0cmFpbnQncyBkZWZhdWx0XHJcbiAgICogKHNjZW5lcnktaW50ZXJuYWwpXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBlZmZlY3RpdmVZQWxpZ24oKTogTGF5b3V0QWxpZ24ge1xyXG4gICAgcmV0dXJuIHRoaXMuX3lBbGlnbiAhPT0gbnVsbCA/IHRoaXMuX3lBbGlnbiA6IHRoaXMuZ3JpZENvbnN0cmFpbnQuX3lBbGlnbiE7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiAoc2NlbmVyeS1pbnRlcm5hbClcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RWZmZWN0aXZlQWxpZ24oIG9yaWVudGF0aW9uOiBPcmllbnRhdGlvbiApOiBMYXlvdXRBbGlnbiB7XHJcbiAgICByZXR1cm4gb3JpZW50YXRpb24gPT09IE9yaWVudGF0aW9uLkhPUklaT05UQUwgPyB0aGlzLmVmZmVjdGl2ZVhBbGlnbiA6IHRoaXMuZWZmZWN0aXZlWUFsaWduO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJuIHRoZSB1c2VkIHZhbHVlLCB3aXRoIHRoaXMgY2VsbCdzIHZhbHVlIHRha2luZyBwcmVjZWRlbmNlIG92ZXIgdGhlIGNvbnN0cmFpbnQncyBkZWZhdWx0XHJcbiAgICogKHNjZW5lcnktaW50ZXJuYWwpXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBlZmZlY3RpdmVYR3JvdygpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX3hHcm93ICE9PSBudWxsID8gdGhpcy5feEdyb3cgOiB0aGlzLmdyaWRDb25zdHJhaW50Ll94R3JvdyE7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm4gdGhlIHVzZWQgdmFsdWUsIHdpdGggdGhpcyBjZWxsJ3MgdmFsdWUgdGFraW5nIHByZWNlZGVuY2Ugb3ZlciB0aGUgY29uc3RyYWludCdzIGRlZmF1bHRcclxuICAgKiAoc2NlbmVyeS1pbnRlcm5hbClcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGVmZmVjdGl2ZVlHcm93KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5feUdyb3cgIT09IG51bGwgPyB0aGlzLl95R3JvdyA6IHRoaXMuZ3JpZENvbnN0cmFpbnQuX3lHcm93ITtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIChzY2VuZXJ5LWludGVybmFsKVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRFZmZlY3RpdmVHcm93KCBvcmllbnRhdGlvbjogT3JpZW50YXRpb24gKTogbnVtYmVyIHtcclxuICAgIHJldHVybiBvcmllbnRhdGlvbiA9PT0gT3JpZW50YXRpb24uSE9SSVpPTlRBTCA/IHRoaXMuZWZmZWN0aXZlWEdyb3cgOiB0aGlzLmVmZmVjdGl2ZVlHcm93O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJuIHRoZSB1c2VkIHZhbHVlLCB3aXRoIHRoaXMgY2VsbCdzIHZhbHVlIHRha2luZyBwcmVjZWRlbmNlIG92ZXIgdGhlIGNvbnN0cmFpbnQncyBkZWZhdWx0XHJcbiAgICogKHNjZW5lcnktaW50ZXJuYWwpXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBlZmZlY3RpdmVYU3RyZXRjaCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLl94U3RyZXRjaCAhPT0gbnVsbCA/IHRoaXMuX3hTdHJldGNoIDogdGhpcy5ncmlkQ29uc3RyYWludC5feFN0cmV0Y2ghO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJuIHRoZSB1c2VkIHZhbHVlLCB3aXRoIHRoaXMgY2VsbCdzIHZhbHVlIHRha2luZyBwcmVjZWRlbmNlIG92ZXIgdGhlIGNvbnN0cmFpbnQncyBkZWZhdWx0XHJcbiAgICogKHNjZW5lcnktaW50ZXJuYWwpXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBlZmZlY3RpdmVZU3RyZXRjaCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLl95U3RyZXRjaCAhPT0gbnVsbCA/IHRoaXMuX3lTdHJldGNoIDogdGhpcy5ncmlkQ29uc3RyYWludC5feVN0cmV0Y2ghO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogKHNjZW5lcnktaW50ZXJuYWwpXHJcbiAgICovXHJcbiAgcHVibGljIGdldEVmZmVjdGl2ZVN0cmV0Y2goIG9yaWVudGF0aW9uOiBPcmllbnRhdGlvbiApOiBib29sZWFuIHtcclxuICAgIHJldHVybiBvcmllbnRhdGlvbiA9PT0gT3JpZW50YXRpb24uSE9SSVpPTlRBTCA/IHRoaXMuZWZmZWN0aXZlWFN0cmV0Y2ggOiB0aGlzLmVmZmVjdGl2ZVlTdHJldGNoO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIG92ZXJyaWRlIG9uTGF5b3V0T3B0aW9uc0NoYW5nZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuc2V0T3B0aW9ucyggdGhpcy5ub2RlLmxheW91dE9wdGlvbnMgYXMgRXh0ZXJuYWxHcmlkQ29uZmlndXJhYmxlT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyLm9uTGF5b3V0T3B0aW9uc0NoYW5nZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXRPcHRpb25zKCBwcm92aWRlZE9wdGlvbnM/OiBFeHRlcm5hbEdyaWRDb25maWd1cmFibGVPcHRpb25zICk6IHZvaWQge1xyXG5cclxuICAgIC8vIFdlJ2xsIGhhdmUgZGVmYXVsdHMgZm9yIGNlbGxzICh0aGUgaG9yaXpvbnRhbFNwYW4vdmVydGljYWxTcGFuIGFyZSBlc3BlY2lhbGx5IHJlbGV2YW50KVxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxHcmlkQ2VsbE9wdGlvbnMsIFNlbGZPcHRpb25zLCBFeHRlcm5hbEdyaWRDb25maWd1cmFibGVPcHRpb25zPigpKCB7XHJcbiAgICAgIGNvbHVtbjogMCxcclxuICAgICAgcm93OiAwLFxyXG4gICAgICBob3Jpem9udGFsU3BhbjogMSxcclxuICAgICAgdmVydGljYWxTcGFuOiAxXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgT2JqZWN0LmtleXMoIG9wdGlvbnMgKS5mb3JFYWNoKCBrZXkgPT4ge1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBHUklEX0NFTExfS0VZUy5pbmNsdWRlcygga2V5ICksIGBDYW5ub3QgcHJvdmlkZSBrZXkgJHtrZXl9IHRvIGEgR3JpZENlbGwncyBsYXlvdXRPcHRpb25zLiBQZXJoYXBzIHRoaXMgaXMgYSBGbG93LXN0eWxlIGxheW91dCBvcHRpb24/YCApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHR5cGVvZiBvcHRpb25zLmNvbHVtbiA9PT0gJ251bWJlcicgJiYgTnVtYmVyLmlzSW50ZWdlciggb3B0aW9ucy5jb2x1bW4gKSAmJiBpc0Zpbml0ZSggb3B0aW9ucy5jb2x1bW4gKSAmJiBvcHRpb25zLmNvbHVtbiA+PSAwICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0eXBlb2Ygb3B0aW9ucy5yb3cgPT09ICdudW1iZXInICYmIE51bWJlci5pc0ludGVnZXIoIG9wdGlvbnMucm93ICkgJiYgaXNGaW5pdGUoIG9wdGlvbnMucm93ICkgJiYgb3B0aW9ucy5yb3cgPj0gMCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdHlwZW9mIG9wdGlvbnMuaG9yaXpvbnRhbFNwYW4gPT09ICdudW1iZXInICYmIE51bWJlci5pc0ludGVnZXIoIG9wdGlvbnMuaG9yaXpvbnRhbFNwYW4gKSAmJiBpc0Zpbml0ZSggb3B0aW9ucy5ob3Jpem9udGFsU3BhbiApICYmIG9wdGlvbnMuaG9yaXpvbnRhbFNwYW4gPj0gMSApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdHlwZW9mIG9wdGlvbnMudmVydGljYWxTcGFuID09PSAnbnVtYmVyJyAmJiBOdW1iZXIuaXNJbnRlZ2VyKCBvcHRpb25zLnZlcnRpY2FsU3BhbiApICYmIGlzRmluaXRlKCBvcHRpb25zLnZlcnRpY2FsU3BhbiApICYmIG9wdGlvbnMudmVydGljYWxTcGFuID49IDEgKTtcclxuXHJcbiAgICB0aGlzLnNldENvbmZpZ1RvSW5oZXJpdCgpO1xyXG5cclxuICAgIHRoaXMucG9zaXRpb24gPSBuZXcgT3JpZW50YXRpb25QYWlyKCBvcHRpb25zLmNvbHVtbiwgb3B0aW9ucy5yb3cgKTtcclxuICAgIHRoaXMuc2l6ZSA9IG5ldyBPcmllbnRhdGlvblBhaXIoIG9wdGlvbnMuaG9yaXpvbnRhbFNwYW4sIG9wdGlvbnMudmVydGljYWxTcGFuICk7XHJcblxyXG4gICAgdGhpcy5tdXRhdGVDb25maWd1cmFibGUoIG9wdGlvbnMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFdoZXRoZXIgdGhpcyBjZWxsIGNvbnRhaW5zIHRoZSBnaXZlbiByb3cvY29sdW1uIChiYXNlZCBvbiB0aGUgb3JpZW50YXRpb24pLiBEdWUgdG8gaG9yaXpvbnRhbFNwYW4vdmVydGljYWxTcGFuIG9mIHRoZSBjZWxsLFxyXG4gICAqIHRoaXMgY291bGQgYmUgdHJ1ZSBmb3IgbXVsdGlwbGUgaW5kaWNlcy5cclxuICAgKiAoc2NlbmVyeS1pbnRlcm5hbClcclxuICAgKi9cclxuICBwdWJsaWMgY29udGFpbnNJbmRleCggb3JpZW50YXRpb246IE9yaWVudGF0aW9uLCBpbmRleDogbnVtYmVyICk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLnBvc2l0aW9uLmdldCggb3JpZW50YXRpb24gKTtcclxuICAgIGNvbnN0IHNpemUgPSB0aGlzLnNpemUuZ2V0KCBvcmllbnRhdGlvbiApO1xyXG4gICAgcmV0dXJuIGluZGV4ID49IHBvc2l0aW9uICYmIGluZGV4IDwgcG9zaXRpb24gKyBzaXplO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogV2hldGhlciB0aGlzIGNlbGwgY29udGFpbnMgdGhlIGdpdmVuIHJvdy5cclxuICAgKiAoc2NlbmVyeS1pbnRlcm5hbClcclxuICAgKi9cclxuICBwdWJsaWMgY29udGFpbnNSb3coIHJvdzogbnVtYmVyICk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY29udGFpbnNJbmRleCggT3JpZW50YXRpb24uVkVSVElDQUwsIHJvdyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogV2hldGhlciB0aGlzIGNlbGwgY29udGFpbnMgdGhlIGdpdmVuIGNvbHVtbi5cclxuICAgKiAoc2NlbmVyeS1pbnRlcm5hbClcclxuICAgKi9cclxuICBwdWJsaWMgY29udGFpbnNDb2x1bW4oIGNvbHVtbjogbnVtYmVyICk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY29udGFpbnNJbmRleCggT3JpZW50YXRpb24uSE9SSVpPTlRBTCwgY29sdW1uICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSByb3cvY29sdW1uIGluZGljZXMgdGhhdCB0aGlzIGNlbGwgc3BhbnMgKGJhc2VkIG9uIHRoZSBvcmllbnRhdGlvbilcclxuICAgKiAoc2NlbmVyeS1pbnRlcm5hbClcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0SW5kaWNlcyggb3JpZW50YXRpb246IE9yaWVudGF0aW9uICk6IG51bWJlcltdIHtcclxuICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5wb3NpdGlvbi5nZXQoIG9yaWVudGF0aW9uICk7XHJcbiAgICBjb25zdCBzaXplID0gdGhpcy5zaXplLmdldCggb3JpZW50YXRpb24gKTtcclxuICAgIHJldHVybiBfLnJhbmdlKCBwb3NpdGlvbiwgcG9zaXRpb24gKyBzaXplICk7XHJcbiAgfVxyXG59XHJcblxyXG5zY2VuZXJ5LnJlZ2lzdGVyKCAnR3JpZENlbGwnLCBHcmlkQ2VsbCApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsV0FBVyxNQUFNLHlDQUF5QztBQUNqRSxPQUFPQyxlQUFlLE1BQU0sNkNBQTZDO0FBQ3pFLFNBQTBDQyxnQkFBZ0IsRUFBa0JDLDZCQUE2QixFQUE0QkMsZ0JBQWdCLEVBQVFDLE9BQU8sUUFBUSxrQkFBa0I7QUFDOUwsT0FBT0MsU0FBUyxNQUFNLHVDQUF1QztBQUU3RCxNQUFNQyxjQUFjLEdBQUcsQ0FDckIsR0FBR0osNkJBQTZCLEVBQ2hDLEtBQUssRUFDTCxRQUFRLEVBQ1IsZ0JBQWdCLEVBQ2hCLGNBQWMsQ0FDZjtBQW1CRCxlQUFlLE1BQU1LLFFBQVEsU0FBU04sZ0JBQWdCLENBQUVFLGdCQUFpQixDQUFDLENBQUM7RUFFekU7O0VBTUE7QUFDRjtBQUNBO0VBQ1NLLFdBQVdBLENBQUVDLFVBQTBCLEVBQUVDLElBQVUsRUFBRUMsS0FBeUIsRUFBRztJQUV0RixLQUFLLENBQUVGLFVBQVUsRUFBRUMsSUFBSSxFQUFFQyxLQUFNLENBQUM7SUFFaEMsSUFBSSxDQUFDQyxjQUFjLEdBQUdILFVBQVU7SUFFaEMsSUFBSSxDQUFDSSxVQUFVLENBQUVILElBQUks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