// Copyright 2016-2022, University of Colorado Boulder

/**
 * Canvas drawable for Rectangle nodes.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Poolable from '../../../../phet-core/js/Poolable.js';
import { CanvasSelfDrawable, PaintableStatelessDrawable, scenery } from '../../imports.js';
class RectangleCanvasDrawable extends PaintableStatelessDrawable(CanvasSelfDrawable) {
  /**
   * Convenience function for drawing a rectangular path (with our Rectangle node's parameters) to the Canvas context.
   * @private
   *
   * @param {CanvasRenderingContext2D} context - To execute drawing commands on.
   * @param {Node} node - The node whose rectangle we want to draw
   */
  writeRectangularPath(context, node) {
    context.beginPath();
    context.moveTo(node._rectX, node._rectY);
    context.lineTo(node._rectX + node._rectWidth, node._rectY);
    context.lineTo(node._rectX + node._rectWidth, node._rectY + node._rectHeight);
    context.lineTo(node._rectX, node._rectY + node._rectHeight);
    context.closePath();
  }

  /**
   * Paints this drawable to a Canvas (the wrapper contains both a Canvas reference and its drawing context).
   * @public
   *
   * Assumes that the Canvas's context is already in the proper local coordinate frame for the node, and that any
   * other required effects (opacity, clipping, etc.) have already been prepared.
   *
   * This is part of the CanvasSelfDrawable API required to be implemented for subtypes.
   *
   * @param {CanvasContextWrapper} wrapper - Contains the Canvas and its drawing context
   * @param {scenery.Node} node - Our node that is being drawn
   * @param {Matrix3} matrix - The transformation matrix applied for this node's coordinate system.
   */
  paintCanvas(wrapper, node, matrix) {
    const context = wrapper.context;

    // use the standard version if it's a rounded rectangle, since there is no Canvas-optimized version for that
    if (node.isRounded()) {
      context.beginPath();
      const maximumArcSize = node.getMaximumArcSize();
      const arcw = Math.min(node._cornerXRadius, maximumArcSize);
      const arch = Math.min(node._cornerYRadius, maximumArcSize);
      const lowX = node._rectX + arcw;
      const highX = node._rectX + node._rectWidth - arcw;
      const lowY = node._rectY + arch;
      const highY = node._rectY + node._rectHeight - arch;
      if (arcw === arch) {
        // we can use circular arcs, which have well defined stroked offsets
        context.arc(highX, lowY, arcw, -Math.PI / 2, 0, false);
        context.arc(highX, highY, arcw, 0, Math.PI / 2, false);
        context.arc(lowX, highY, arcw, Math.PI / 2, Math.PI, false);
        context.arc(lowX, lowY, arcw, Math.PI, Math.PI * 3 / 2, false);
      } else {
        // we have to resort to elliptical arcs
        context.ellipse(highX, lowY, arcw, arch, 0, -Math.PI / 2, 0, false);
        context.ellipse(highX, highY, arcw, arch, 0, 0, Math.PI / 2, false);
        context.ellipse(lowX, highY, arcw, arch, 0, Math.PI / 2, Math.PI, false);
        context.ellipse(lowX, lowY, arcw, arch, 0, Math.PI, Math.PI * 3 / 2, false);
      }
      context.closePath();
      if (node.hasFill()) {
        node.beforeCanvasFill(wrapper); // defined in Paintable
        context.fill();
        node.afterCanvasFill(wrapper); // defined in Paintable
      }

      if (node.hasPaintableStroke()) {
        node.beforeCanvasStroke(wrapper); // defined in Paintable
        context.stroke();
        node.afterCanvasStroke(wrapper); // defined in Paintable
      }
    } else {
      // TODO: how to handle fill/stroke delay optimizations here?
      if (node.hasFill()) {
        // If we need the fill pattern/gradient to have a different transformation, we can't use fillRect.
        // See https://github.com/phetsims/scenery/issues/543
        if (node.getFillValue().transformMatrix) {
          this.writeRectangularPath(context, node);
          node.beforeCanvasFill(wrapper); // defined in Paintable
          context.fill();
          node.afterCanvasFill(wrapper); // defined in Paintable
        } else {
          node.beforeCanvasFill(wrapper); // defined in Paintable
          context.fillRect(node._rectX, node._rectY, node._rectWidth, node._rectHeight);
          node.afterCanvasFill(wrapper); // defined in Paintable
        }
      }

      if (node.hasPaintableStroke()) {
        // If we need the fill pattern/gradient to have a different transformation, we can't use fillRect.
        // See https://github.com/phetsims/scenery/issues/543
        if (node.getStrokeValue().transformMatrix) {
          this.writeRectangularPath(context, node);
          node.beforeCanvasStroke(wrapper); // defined in Paintable
          context.stroke();
          node.afterCanvasStroke(wrapper); // defined in Paintable
        } else {
          node.beforeCanvasStroke(wrapper); // defined in Paintable
          context.strokeRect(node._rectX, node._rectY, node._rectWidth, node._rectHeight);
          node.afterCanvasStroke(wrapper); // defined in Paintable
        }
      }
    }
  }

  /**
   * @public
   */
  markDirtyRectangle() {
    this.markPaintDirty();
  }

  /**
   * @public
   */
  markDirtyX() {
    this.markDirtyRectangle();
  }

  /**
   * @public
   */
  markDirtyY() {
    this.markDirtyRectangle();
  }

  /**
   * @public
   */
  markDirtyWidth() {
    this.markDirtyRectangle();
  }

  /**
   * @public
   */
  markDirtyHeight() {
    this.markDirtyRectangle();
  }

  /**
   * @public
   */
  markDirtyCornerXRadius() {
    this.markDirtyRectangle();
  }

  /**
   * @public
   */
  markDirtyCornerYRadius() {
    this.markDirtyRectangle();
  }
}
scenery.register('RectangleCanvasDrawable', RectangleCanvasDrawable);
Poolable.mixInto(RectangleCanvasDrawable);
export default RectangleCanvasDrawable;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQb29sYWJsZSIsIkNhbnZhc1NlbGZEcmF3YWJsZSIsIlBhaW50YWJsZVN0YXRlbGVzc0RyYXdhYmxlIiwic2NlbmVyeSIsIlJlY3RhbmdsZUNhbnZhc0RyYXdhYmxlIiwid3JpdGVSZWN0YW5ndWxhclBhdGgiLCJjb250ZXh0Iiwibm9kZSIsImJlZ2luUGF0aCIsIm1vdmVUbyIsIl9yZWN0WCIsIl9yZWN0WSIsImxpbmVUbyIsIl9yZWN0V2lkdGgiLCJfcmVjdEhlaWdodCIsImNsb3NlUGF0aCIsInBhaW50Q2FudmFzIiwid3JhcHBlciIsIm1hdHJpeCIsImlzUm91bmRlZCIsIm1heGltdW1BcmNTaXplIiwiZ2V0TWF4aW11bUFyY1NpemUiLCJhcmN3IiwiTWF0aCIsIm1pbiIsIl9jb3JuZXJYUmFkaXVzIiwiYXJjaCIsIl9jb3JuZXJZUmFkaXVzIiwibG93WCIsImhpZ2hYIiwibG93WSIsImhpZ2hZIiwiYXJjIiwiUEkiLCJlbGxpcHNlIiwiaGFzRmlsbCIsImJlZm9yZUNhbnZhc0ZpbGwiLCJmaWxsIiwiYWZ0ZXJDYW52YXNGaWxsIiwiaGFzUGFpbnRhYmxlU3Ryb2tlIiwiYmVmb3JlQ2FudmFzU3Ryb2tlIiwic3Ryb2tlIiwiYWZ0ZXJDYW52YXNTdHJva2UiLCJnZXRGaWxsVmFsdWUiLCJ0cmFuc2Zvcm1NYXRyaXgiLCJmaWxsUmVjdCIsImdldFN0cm9rZVZhbHVlIiwic3Ryb2tlUmVjdCIsIm1hcmtEaXJ0eVJlY3RhbmdsZSIsIm1hcmtQYWludERpcnR5IiwibWFya0RpcnR5WCIsIm1hcmtEaXJ0eVkiLCJtYXJrRGlydHlXaWR0aCIsIm1hcmtEaXJ0eUhlaWdodCIsIm1hcmtEaXJ0eUNvcm5lclhSYWRpdXMiLCJtYXJrRGlydHlDb3JuZXJZUmFkaXVzIiwicmVnaXN0ZXIiLCJtaXhJbnRvIl0sInNvdXJjZXMiOlsiUmVjdGFuZ2xlQ2FudmFzRHJhd2FibGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQ2FudmFzIGRyYXdhYmxlIGZvciBSZWN0YW5nbGUgbm9kZXMuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgUG9vbGFibGUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL1Bvb2xhYmxlLmpzJztcclxuaW1wb3J0IHsgQ2FudmFzU2VsZkRyYXdhYmxlLCBQYWludGFibGVTdGF0ZWxlc3NEcmF3YWJsZSwgc2NlbmVyeSB9IGZyb20gJy4uLy4uL2ltcG9ydHMuanMnO1xyXG5cclxuY2xhc3MgUmVjdGFuZ2xlQ2FudmFzRHJhd2FibGUgZXh0ZW5kcyBQYWludGFibGVTdGF0ZWxlc3NEcmF3YWJsZSggQ2FudmFzU2VsZkRyYXdhYmxlICkge1xyXG4gIC8qKlxyXG4gICAqIENvbnZlbmllbmNlIGZ1bmN0aW9uIGZvciBkcmF3aW5nIGEgcmVjdGFuZ3VsYXIgcGF0aCAod2l0aCBvdXIgUmVjdGFuZ2xlIG5vZGUncyBwYXJhbWV0ZXJzKSB0byB0aGUgQ2FudmFzIGNvbnRleHQuXHJcbiAgICogQHByaXZhdGVcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjb250ZXh0IC0gVG8gZXhlY3V0ZSBkcmF3aW5nIGNvbW1hbmRzIG9uLlxyXG4gICAqIEBwYXJhbSB7Tm9kZX0gbm9kZSAtIFRoZSBub2RlIHdob3NlIHJlY3RhbmdsZSB3ZSB3YW50IHRvIGRyYXdcclxuICAgKi9cclxuICB3cml0ZVJlY3Rhbmd1bGFyUGF0aCggY29udGV4dCwgbm9kZSApIHtcclxuICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XHJcbiAgICBjb250ZXh0Lm1vdmVUbyggbm9kZS5fcmVjdFgsIG5vZGUuX3JlY3RZICk7XHJcbiAgICBjb250ZXh0LmxpbmVUbyggbm9kZS5fcmVjdFggKyBub2RlLl9yZWN0V2lkdGgsIG5vZGUuX3JlY3RZICk7XHJcbiAgICBjb250ZXh0LmxpbmVUbyggbm9kZS5fcmVjdFggKyBub2RlLl9yZWN0V2lkdGgsIG5vZGUuX3JlY3RZICsgbm9kZS5fcmVjdEhlaWdodCApO1xyXG4gICAgY29udGV4dC5saW5lVG8oIG5vZGUuX3JlY3RYLCBub2RlLl9yZWN0WSArIG5vZGUuX3JlY3RIZWlnaHQgKTtcclxuICAgIGNvbnRleHQuY2xvc2VQYXRoKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQYWludHMgdGhpcyBkcmF3YWJsZSB0byBhIENhbnZhcyAodGhlIHdyYXBwZXIgY29udGFpbnMgYm90aCBhIENhbnZhcyByZWZlcmVuY2UgYW5kIGl0cyBkcmF3aW5nIGNvbnRleHQpLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEFzc3VtZXMgdGhhdCB0aGUgQ2FudmFzJ3MgY29udGV4dCBpcyBhbHJlYWR5IGluIHRoZSBwcm9wZXIgbG9jYWwgY29vcmRpbmF0ZSBmcmFtZSBmb3IgdGhlIG5vZGUsIGFuZCB0aGF0IGFueVxyXG4gICAqIG90aGVyIHJlcXVpcmVkIGVmZmVjdHMgKG9wYWNpdHksIGNsaXBwaW5nLCBldGMuKSBoYXZlIGFscmVhZHkgYmVlbiBwcmVwYXJlZC5cclxuICAgKlxyXG4gICAqIFRoaXMgaXMgcGFydCBvZiB0aGUgQ2FudmFzU2VsZkRyYXdhYmxlIEFQSSByZXF1aXJlZCB0byBiZSBpbXBsZW1lbnRlZCBmb3Igc3VidHlwZXMuXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge0NhbnZhc0NvbnRleHRXcmFwcGVyfSB3cmFwcGVyIC0gQ29udGFpbnMgdGhlIENhbnZhcyBhbmQgaXRzIGRyYXdpbmcgY29udGV4dFxyXG4gICAqIEBwYXJhbSB7c2NlbmVyeS5Ob2RlfSBub2RlIC0gT3VyIG5vZGUgdGhhdCBpcyBiZWluZyBkcmF3blxyXG4gICAqIEBwYXJhbSB7TWF0cml4M30gbWF0cml4IC0gVGhlIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBhcHBsaWVkIGZvciB0aGlzIG5vZGUncyBjb29yZGluYXRlIHN5c3RlbS5cclxuICAgKi9cclxuICBwYWludENhbnZhcyggd3JhcHBlciwgbm9kZSwgbWF0cml4ICkge1xyXG4gICAgY29uc3QgY29udGV4dCA9IHdyYXBwZXIuY29udGV4dDtcclxuXHJcbiAgICAvLyB1c2UgdGhlIHN0YW5kYXJkIHZlcnNpb24gaWYgaXQncyBhIHJvdW5kZWQgcmVjdGFuZ2xlLCBzaW5jZSB0aGVyZSBpcyBubyBDYW52YXMtb3B0aW1pemVkIHZlcnNpb24gZm9yIHRoYXRcclxuICAgIGlmICggbm9kZS5pc1JvdW5kZWQoKSApIHtcclxuICAgICAgY29udGV4dC5iZWdpblBhdGgoKTtcclxuICAgICAgY29uc3QgbWF4aW11bUFyY1NpemUgPSBub2RlLmdldE1heGltdW1BcmNTaXplKCk7XHJcbiAgICAgIGNvbnN0IGFyY3cgPSBNYXRoLm1pbiggbm9kZS5fY29ybmVyWFJhZGl1cywgbWF4aW11bUFyY1NpemUgKTtcclxuICAgICAgY29uc3QgYXJjaCA9IE1hdGgubWluKCBub2RlLl9jb3JuZXJZUmFkaXVzLCBtYXhpbXVtQXJjU2l6ZSApO1xyXG4gICAgICBjb25zdCBsb3dYID0gbm9kZS5fcmVjdFggKyBhcmN3O1xyXG4gICAgICBjb25zdCBoaWdoWCA9IG5vZGUuX3JlY3RYICsgbm9kZS5fcmVjdFdpZHRoIC0gYXJjdztcclxuICAgICAgY29uc3QgbG93WSA9IG5vZGUuX3JlY3RZICsgYXJjaDtcclxuICAgICAgY29uc3QgaGlnaFkgPSBub2RlLl9yZWN0WSArIG5vZGUuX3JlY3RIZWlnaHQgLSBhcmNoO1xyXG4gICAgICBpZiAoIGFyY3cgPT09IGFyY2ggKSB7XHJcbiAgICAgICAgLy8gd2UgY2FuIHVzZSBjaXJjdWxhciBhcmNzLCB3aGljaCBoYXZlIHdlbGwgZGVmaW5lZCBzdHJva2VkIG9mZnNldHNcclxuICAgICAgICBjb250ZXh0LmFyYyggaGlnaFgsIGxvd1ksIGFyY3csIC1NYXRoLlBJIC8gMiwgMCwgZmFsc2UgKTtcclxuICAgICAgICBjb250ZXh0LmFyYyggaGlnaFgsIGhpZ2hZLCBhcmN3LCAwLCBNYXRoLlBJIC8gMiwgZmFsc2UgKTtcclxuICAgICAgICBjb250ZXh0LmFyYyggbG93WCwgaGlnaFksIGFyY3csIE1hdGguUEkgLyAyLCBNYXRoLlBJLCBmYWxzZSApO1xyXG4gICAgICAgIGNvbnRleHQuYXJjKCBsb3dYLCBsb3dZLCBhcmN3LCBNYXRoLlBJLCBNYXRoLlBJICogMyAvIDIsIGZhbHNlICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgLy8gd2UgaGF2ZSB0byByZXNvcnQgdG8gZWxsaXB0aWNhbCBhcmNzXHJcbiAgICAgICAgY29udGV4dC5lbGxpcHNlKCBoaWdoWCwgbG93WSwgYXJjdywgYXJjaCwgMCwgLU1hdGguUEkgLyAyLCAwLCBmYWxzZSApO1xyXG4gICAgICAgIGNvbnRleHQuZWxsaXBzZSggaGlnaFgsIGhpZ2hZLCBhcmN3LCBhcmNoLCAwLCAwLCBNYXRoLlBJIC8gMiwgZmFsc2UgKTtcclxuICAgICAgICBjb250ZXh0LmVsbGlwc2UoIGxvd1gsIGhpZ2hZLCBhcmN3LCBhcmNoLCAwLCBNYXRoLlBJIC8gMiwgTWF0aC5QSSwgZmFsc2UgKTtcclxuICAgICAgICBjb250ZXh0LmVsbGlwc2UoIGxvd1gsIGxvd1ksIGFyY3csIGFyY2gsIDAsIE1hdGguUEksIE1hdGguUEkgKiAzIC8gMiwgZmFsc2UgKTtcclxuICAgICAgfVxyXG4gICAgICBjb250ZXh0LmNsb3NlUGF0aCgpO1xyXG5cclxuICAgICAgaWYgKCBub2RlLmhhc0ZpbGwoKSApIHtcclxuICAgICAgICBub2RlLmJlZm9yZUNhbnZhc0ZpbGwoIHdyYXBwZXIgKTsgLy8gZGVmaW5lZCBpbiBQYWludGFibGVcclxuICAgICAgICBjb250ZXh0LmZpbGwoKTtcclxuICAgICAgICBub2RlLmFmdGVyQ2FudmFzRmlsbCggd3JhcHBlciApOyAvLyBkZWZpbmVkIGluIFBhaW50YWJsZVxyXG4gICAgICB9XHJcbiAgICAgIGlmICggbm9kZS5oYXNQYWludGFibGVTdHJva2UoKSApIHtcclxuICAgICAgICBub2RlLmJlZm9yZUNhbnZhc1N0cm9rZSggd3JhcHBlciApOyAvLyBkZWZpbmVkIGluIFBhaW50YWJsZVxyXG4gICAgICAgIGNvbnRleHQuc3Ryb2tlKCk7XHJcbiAgICAgICAgbm9kZS5hZnRlckNhbnZhc1N0cm9rZSggd3JhcHBlciApOyAvLyBkZWZpbmVkIGluIFBhaW50YWJsZVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgLy8gVE9ETzogaG93IHRvIGhhbmRsZSBmaWxsL3N0cm9rZSBkZWxheSBvcHRpbWl6YXRpb25zIGhlcmU/XHJcbiAgICAgIGlmICggbm9kZS5oYXNGaWxsKCkgKSB7XHJcbiAgICAgICAgLy8gSWYgd2UgbmVlZCB0aGUgZmlsbCBwYXR0ZXJuL2dyYWRpZW50IHRvIGhhdmUgYSBkaWZmZXJlbnQgdHJhbnNmb3JtYXRpb24sIHdlIGNhbid0IHVzZSBmaWxsUmVjdC5cclxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnkvaXNzdWVzLzU0M1xyXG4gICAgICAgIGlmICggbm9kZS5nZXRGaWxsVmFsdWUoKS50cmFuc2Zvcm1NYXRyaXggKSB7XHJcbiAgICAgICAgICB0aGlzLndyaXRlUmVjdGFuZ3VsYXJQYXRoKCBjb250ZXh0LCBub2RlICk7XHJcbiAgICAgICAgICBub2RlLmJlZm9yZUNhbnZhc0ZpbGwoIHdyYXBwZXIgKTsgLy8gZGVmaW5lZCBpbiBQYWludGFibGVcclxuICAgICAgICAgIGNvbnRleHQuZmlsbCgpO1xyXG4gICAgICAgICAgbm9kZS5hZnRlckNhbnZhc0ZpbGwoIHdyYXBwZXIgKTsgLy8gZGVmaW5lZCBpbiBQYWludGFibGVcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBub2RlLmJlZm9yZUNhbnZhc0ZpbGwoIHdyYXBwZXIgKTsgLy8gZGVmaW5lZCBpbiBQYWludGFibGVcclxuICAgICAgICAgIGNvbnRleHQuZmlsbFJlY3QoIG5vZGUuX3JlY3RYLCBub2RlLl9yZWN0WSwgbm9kZS5fcmVjdFdpZHRoLCBub2RlLl9yZWN0SGVpZ2h0ICk7XHJcbiAgICAgICAgICBub2RlLmFmdGVyQ2FudmFzRmlsbCggd3JhcHBlciApOyAvLyBkZWZpbmVkIGluIFBhaW50YWJsZVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpZiAoIG5vZGUuaGFzUGFpbnRhYmxlU3Ryb2tlKCkgKSB7XHJcbiAgICAgICAgLy8gSWYgd2UgbmVlZCB0aGUgZmlsbCBwYXR0ZXJuL2dyYWRpZW50IHRvIGhhdmUgYSBkaWZmZXJlbnQgdHJhbnNmb3JtYXRpb24sIHdlIGNhbid0IHVzZSBmaWxsUmVjdC5cclxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnkvaXNzdWVzLzU0M1xyXG4gICAgICAgIGlmICggbm9kZS5nZXRTdHJva2VWYWx1ZSgpLnRyYW5zZm9ybU1hdHJpeCApIHtcclxuICAgICAgICAgIHRoaXMud3JpdGVSZWN0YW5ndWxhclBhdGgoIGNvbnRleHQsIG5vZGUgKTtcclxuICAgICAgICAgIG5vZGUuYmVmb3JlQ2FudmFzU3Ryb2tlKCB3cmFwcGVyICk7IC8vIGRlZmluZWQgaW4gUGFpbnRhYmxlXHJcbiAgICAgICAgICBjb250ZXh0LnN0cm9rZSgpO1xyXG4gICAgICAgICAgbm9kZS5hZnRlckNhbnZhc1N0cm9rZSggd3JhcHBlciApOyAvLyBkZWZpbmVkIGluIFBhaW50YWJsZVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIG5vZGUuYmVmb3JlQ2FudmFzU3Ryb2tlKCB3cmFwcGVyICk7IC8vIGRlZmluZWQgaW4gUGFpbnRhYmxlXHJcbiAgICAgICAgICBjb250ZXh0LnN0cm9rZVJlY3QoIG5vZGUuX3JlY3RYLCBub2RlLl9yZWN0WSwgbm9kZS5fcmVjdFdpZHRoLCBub2RlLl9yZWN0SGVpZ2h0ICk7XHJcbiAgICAgICAgICBub2RlLmFmdGVyQ2FudmFzU3Ryb2tlKCB3cmFwcGVyICk7IC8vIGRlZmluZWQgaW4gUGFpbnRhYmxlXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgbWFya0RpcnR5UmVjdGFuZ2xlKCkge1xyXG4gICAgdGhpcy5tYXJrUGFpbnREaXJ0eSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIG1hcmtEaXJ0eVgoKSB7XHJcbiAgICB0aGlzLm1hcmtEaXJ0eVJlY3RhbmdsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIG1hcmtEaXJ0eVkoKSB7XHJcbiAgICB0aGlzLm1hcmtEaXJ0eVJlY3RhbmdsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIG1hcmtEaXJ0eVdpZHRoKCkge1xyXG4gICAgdGhpcy5tYXJrRGlydHlSZWN0YW5nbGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBtYXJrRGlydHlIZWlnaHQoKSB7XHJcbiAgICB0aGlzLm1hcmtEaXJ0eVJlY3RhbmdsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIG1hcmtEaXJ0eUNvcm5lclhSYWRpdXMoKSB7XHJcbiAgICB0aGlzLm1hcmtEaXJ0eVJlY3RhbmdsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIG1hcmtEaXJ0eUNvcm5lcllSYWRpdXMoKSB7XHJcbiAgICB0aGlzLm1hcmtEaXJ0eVJlY3RhbmdsZSgpO1xyXG4gIH1cclxufVxyXG5cclxuc2NlbmVyeS5yZWdpc3RlciggJ1JlY3RhbmdsZUNhbnZhc0RyYXdhYmxlJywgUmVjdGFuZ2xlQ2FudmFzRHJhd2FibGUgKTtcclxuXHJcblBvb2xhYmxlLm1peEludG8oIFJlY3RhbmdsZUNhbnZhc0RyYXdhYmxlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBSZWN0YW5nbGVDYW52YXNEcmF3YWJsZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLHNDQUFzQztBQUMzRCxTQUFTQyxrQkFBa0IsRUFBRUMsMEJBQTBCLEVBQUVDLE9BQU8sUUFBUSxrQkFBa0I7QUFFMUYsTUFBTUMsdUJBQXVCLFNBQVNGLDBCQUEwQixDQUFFRCxrQkFBbUIsQ0FBQyxDQUFDO0VBQ3JGO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VJLG9CQUFvQkEsQ0FBRUMsT0FBTyxFQUFFQyxJQUFJLEVBQUc7SUFDcENELE9BQU8sQ0FBQ0UsU0FBUyxDQUFDLENBQUM7SUFDbkJGLE9BQU8sQ0FBQ0csTUFBTSxDQUFFRixJQUFJLENBQUNHLE1BQU0sRUFBRUgsSUFBSSxDQUFDSSxNQUFPLENBQUM7SUFDMUNMLE9BQU8sQ0FBQ00sTUFBTSxDQUFFTCxJQUFJLENBQUNHLE1BQU0sR0FBR0gsSUFBSSxDQUFDTSxVQUFVLEVBQUVOLElBQUksQ0FBQ0ksTUFBTyxDQUFDO0lBQzVETCxPQUFPLENBQUNNLE1BQU0sQ0FBRUwsSUFBSSxDQUFDRyxNQUFNLEdBQUdILElBQUksQ0FBQ00sVUFBVSxFQUFFTixJQUFJLENBQUNJLE1BQU0sR0FBR0osSUFBSSxDQUFDTyxXQUFZLENBQUM7SUFDL0VSLE9BQU8sQ0FBQ00sTUFBTSxDQUFFTCxJQUFJLENBQUNHLE1BQU0sRUFBRUgsSUFBSSxDQUFDSSxNQUFNLEdBQUdKLElBQUksQ0FBQ08sV0FBWSxDQUFDO0lBQzdEUixPQUFPLENBQUNTLFNBQVMsQ0FBQyxDQUFDO0VBQ3JCOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLFdBQVdBLENBQUVDLE9BQU8sRUFBRVYsSUFBSSxFQUFFVyxNQUFNLEVBQUc7SUFDbkMsTUFBTVosT0FBTyxHQUFHVyxPQUFPLENBQUNYLE9BQU87O0lBRS9CO0lBQ0EsSUFBS0MsSUFBSSxDQUFDWSxTQUFTLENBQUMsQ0FBQyxFQUFHO01BQ3RCYixPQUFPLENBQUNFLFNBQVMsQ0FBQyxDQUFDO01BQ25CLE1BQU1ZLGNBQWMsR0FBR2IsSUFBSSxDQUFDYyxpQkFBaUIsQ0FBQyxDQUFDO01BQy9DLE1BQU1DLElBQUksR0FBR0MsSUFBSSxDQUFDQyxHQUFHLENBQUVqQixJQUFJLENBQUNrQixjQUFjLEVBQUVMLGNBQWUsQ0FBQztNQUM1RCxNQUFNTSxJQUFJLEdBQUdILElBQUksQ0FBQ0MsR0FBRyxDQUFFakIsSUFBSSxDQUFDb0IsY0FBYyxFQUFFUCxjQUFlLENBQUM7TUFDNUQsTUFBTVEsSUFBSSxHQUFHckIsSUFBSSxDQUFDRyxNQUFNLEdBQUdZLElBQUk7TUFDL0IsTUFBTU8sS0FBSyxHQUFHdEIsSUFBSSxDQUFDRyxNQUFNLEdBQUdILElBQUksQ0FBQ00sVUFBVSxHQUFHUyxJQUFJO01BQ2xELE1BQU1RLElBQUksR0FBR3ZCLElBQUksQ0FBQ0ksTUFBTSxHQUFHZSxJQUFJO01BQy9CLE1BQU1LLEtBQUssR0FBR3hCLElBQUksQ0FBQ0ksTUFBTSxHQUFHSixJQUFJLENBQUNPLFdBQVcsR0FBR1ksSUFBSTtNQUNuRCxJQUFLSixJQUFJLEtBQUtJLElBQUksRUFBRztRQUNuQjtRQUNBcEIsT0FBTyxDQUFDMEIsR0FBRyxDQUFFSCxLQUFLLEVBQUVDLElBQUksRUFBRVIsSUFBSSxFQUFFLENBQUNDLElBQUksQ0FBQ1UsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBTSxDQUFDO1FBQ3hEM0IsT0FBTyxDQUFDMEIsR0FBRyxDQUFFSCxLQUFLLEVBQUVFLEtBQUssRUFBRVQsSUFBSSxFQUFFLENBQUMsRUFBRUMsSUFBSSxDQUFDVSxFQUFFLEdBQUcsQ0FBQyxFQUFFLEtBQU0sQ0FBQztRQUN4RDNCLE9BQU8sQ0FBQzBCLEdBQUcsQ0FBRUosSUFBSSxFQUFFRyxLQUFLLEVBQUVULElBQUksRUFBRUMsSUFBSSxDQUFDVSxFQUFFLEdBQUcsQ0FBQyxFQUFFVixJQUFJLENBQUNVLEVBQUUsRUFBRSxLQUFNLENBQUM7UUFDN0QzQixPQUFPLENBQUMwQixHQUFHLENBQUVKLElBQUksRUFBRUUsSUFBSSxFQUFFUixJQUFJLEVBQUVDLElBQUksQ0FBQ1UsRUFBRSxFQUFFVixJQUFJLENBQUNVLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEtBQU0sQ0FBQztNQUNsRSxDQUFDLE1BQ0k7UUFDSDtRQUNBM0IsT0FBTyxDQUFDNEIsT0FBTyxDQUFFTCxLQUFLLEVBQUVDLElBQUksRUFBRVIsSUFBSSxFQUFFSSxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUNILElBQUksQ0FBQ1UsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBTSxDQUFDO1FBQ3JFM0IsT0FBTyxDQUFDNEIsT0FBTyxDQUFFTCxLQUFLLEVBQUVFLEtBQUssRUFBRVQsSUFBSSxFQUFFSSxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRUgsSUFBSSxDQUFDVSxFQUFFLEdBQUcsQ0FBQyxFQUFFLEtBQU0sQ0FBQztRQUNyRTNCLE9BQU8sQ0FBQzRCLE9BQU8sQ0FBRU4sSUFBSSxFQUFFRyxLQUFLLEVBQUVULElBQUksRUFBRUksSUFBSSxFQUFFLENBQUMsRUFBRUgsSUFBSSxDQUFDVSxFQUFFLEdBQUcsQ0FBQyxFQUFFVixJQUFJLENBQUNVLEVBQUUsRUFBRSxLQUFNLENBQUM7UUFDMUUzQixPQUFPLENBQUM0QixPQUFPLENBQUVOLElBQUksRUFBRUUsSUFBSSxFQUFFUixJQUFJLEVBQUVJLElBQUksRUFBRSxDQUFDLEVBQUVILElBQUksQ0FBQ1UsRUFBRSxFQUFFVixJQUFJLENBQUNVLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEtBQU0sQ0FBQztNQUMvRTtNQUNBM0IsT0FBTyxDQUFDUyxTQUFTLENBQUMsQ0FBQztNQUVuQixJQUFLUixJQUFJLENBQUM0QixPQUFPLENBQUMsQ0FBQyxFQUFHO1FBQ3BCNUIsSUFBSSxDQUFDNkIsZ0JBQWdCLENBQUVuQixPQUFRLENBQUMsQ0FBQyxDQUFDO1FBQ2xDWCxPQUFPLENBQUMrQixJQUFJLENBQUMsQ0FBQztRQUNkOUIsSUFBSSxDQUFDK0IsZUFBZSxDQUFFckIsT0FBUSxDQUFDLENBQUMsQ0FBQztNQUNuQzs7TUFDQSxJQUFLVixJQUFJLENBQUNnQyxrQkFBa0IsQ0FBQyxDQUFDLEVBQUc7UUFDL0JoQyxJQUFJLENBQUNpQyxrQkFBa0IsQ0FBRXZCLE9BQVEsQ0FBQyxDQUFDLENBQUM7UUFDcENYLE9BQU8sQ0FBQ21DLE1BQU0sQ0FBQyxDQUFDO1FBQ2hCbEMsSUFBSSxDQUFDbUMsaUJBQWlCLENBQUV6QixPQUFRLENBQUMsQ0FBQyxDQUFDO01BQ3JDO0lBQ0YsQ0FBQyxNQUNJO01BQ0g7TUFDQSxJQUFLVixJQUFJLENBQUM0QixPQUFPLENBQUMsQ0FBQyxFQUFHO1FBQ3BCO1FBQ0E7UUFDQSxJQUFLNUIsSUFBSSxDQUFDb0MsWUFBWSxDQUFDLENBQUMsQ0FBQ0MsZUFBZSxFQUFHO1VBQ3pDLElBQUksQ0FBQ3ZDLG9CQUFvQixDQUFFQyxPQUFPLEVBQUVDLElBQUssQ0FBQztVQUMxQ0EsSUFBSSxDQUFDNkIsZ0JBQWdCLENBQUVuQixPQUFRLENBQUMsQ0FBQyxDQUFDO1VBQ2xDWCxPQUFPLENBQUMrQixJQUFJLENBQUMsQ0FBQztVQUNkOUIsSUFBSSxDQUFDK0IsZUFBZSxDQUFFckIsT0FBUSxDQUFDLENBQUMsQ0FBQztRQUNuQyxDQUFDLE1BQ0k7VUFDSFYsSUFBSSxDQUFDNkIsZ0JBQWdCLENBQUVuQixPQUFRLENBQUMsQ0FBQyxDQUFDO1VBQ2xDWCxPQUFPLENBQUN1QyxRQUFRLENBQUV0QyxJQUFJLENBQUNHLE1BQU0sRUFBRUgsSUFBSSxDQUFDSSxNQUFNLEVBQUVKLElBQUksQ0FBQ00sVUFBVSxFQUFFTixJQUFJLENBQUNPLFdBQVksQ0FBQztVQUMvRVAsSUFBSSxDQUFDK0IsZUFBZSxDQUFFckIsT0FBUSxDQUFDLENBQUMsQ0FBQztRQUNuQztNQUNGOztNQUNBLElBQUtWLElBQUksQ0FBQ2dDLGtCQUFrQixDQUFDLENBQUMsRUFBRztRQUMvQjtRQUNBO1FBQ0EsSUFBS2hDLElBQUksQ0FBQ3VDLGNBQWMsQ0FBQyxDQUFDLENBQUNGLGVBQWUsRUFBRztVQUMzQyxJQUFJLENBQUN2QyxvQkFBb0IsQ0FBRUMsT0FBTyxFQUFFQyxJQUFLLENBQUM7VUFDMUNBLElBQUksQ0FBQ2lDLGtCQUFrQixDQUFFdkIsT0FBUSxDQUFDLENBQUMsQ0FBQztVQUNwQ1gsT0FBTyxDQUFDbUMsTUFBTSxDQUFDLENBQUM7VUFDaEJsQyxJQUFJLENBQUNtQyxpQkFBaUIsQ0FBRXpCLE9BQVEsQ0FBQyxDQUFDLENBQUM7UUFDckMsQ0FBQyxNQUNJO1VBQ0hWLElBQUksQ0FBQ2lDLGtCQUFrQixDQUFFdkIsT0FBUSxDQUFDLENBQUMsQ0FBQztVQUNwQ1gsT0FBTyxDQUFDeUMsVUFBVSxDQUFFeEMsSUFBSSxDQUFDRyxNQUFNLEVBQUVILElBQUksQ0FBQ0ksTUFBTSxFQUFFSixJQUFJLENBQUNNLFVBQVUsRUFBRU4sSUFBSSxDQUFDTyxXQUFZLENBQUM7VUFDakZQLElBQUksQ0FBQ21DLGlCQUFpQixDQUFFekIsT0FBUSxDQUFDLENBQUMsQ0FBQztRQUNyQztNQUNGO0lBQ0Y7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7RUFDRStCLGtCQUFrQkEsQ0FBQSxFQUFHO0lBQ25CLElBQUksQ0FBQ0MsY0FBYyxDQUFDLENBQUM7RUFDdkI7O0VBRUE7QUFDRjtBQUNBO0VBQ0VDLFVBQVVBLENBQUEsRUFBRztJQUNYLElBQUksQ0FBQ0Ysa0JBQWtCLENBQUMsQ0FBQztFQUMzQjs7RUFFQTtBQUNGO0FBQ0E7RUFDRUcsVUFBVUEsQ0FBQSxFQUFHO0lBQ1gsSUFBSSxDQUFDSCxrQkFBa0IsQ0FBQyxDQUFDO0VBQzNCOztFQUVBO0FBQ0Y7QUFDQTtFQUNFSSxjQUFjQSxDQUFBLEVBQUc7SUFDZixJQUFJLENBQUNKLGtCQUFrQixDQUFDLENBQUM7RUFDM0I7O0VBRUE7QUFDRjtBQUNBO0VBQ0VLLGVBQWVBLENBQUEsRUFBRztJQUNoQixJQUFJLENBQUNMLGtCQUFrQixDQUFDLENBQUM7RUFDM0I7O0VBRUE7QUFDRjtBQUNBO0VBQ0VNLHNCQUFzQkEsQ0FBQSxFQUFHO0lBQ3ZCLElBQUksQ0FBQ04sa0JBQWtCLENBQUMsQ0FBQztFQUMzQjs7RUFFQTtBQUNGO0FBQ0E7RUFDRU8sc0JBQXNCQSxDQUFBLEVBQUc7SUFDdkIsSUFBSSxDQUFDUCxrQkFBa0IsQ0FBQyxDQUFDO0VBQzNCO0FBQ0Y7QUFFQTdDLE9BQU8sQ0FBQ3FELFFBQVEsQ0FBRSx5QkFBeUIsRUFBRXBELHVCQUF3QixDQUFDO0FBRXRFSixRQUFRLENBQUN5RCxPQUFPLENBQUVyRCx1QkFBd0IsQ0FBQztBQUUzQyxlQUFlQSx1QkFBdUIifQ==