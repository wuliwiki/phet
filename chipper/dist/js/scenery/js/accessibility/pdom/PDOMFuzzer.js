// Copyright 2018-2022, University of Colorado Boulder

/**
 * Runs PDOM-tree-related scenery operations randomly (with assertions) to try to find any bugs.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Permutation from '../../../../dot/js/Permutation.js';
import Random from '../../../../dot/js/Random.js';
import arrayDifference from '../../../../phet-core/js/arrayDifference.js';
import { Display, Node, PDOMTree, scenery } from '../../imports.js';
class PDOMFuzzer {
  /**
   * @param {number} nodeCount
   * @param {boolean} logToConsole
   * @param {number} [seed]
   */
  constructor(nodeCount, logToConsole, seed) {
    assert && assert(nodeCount >= 2);
    seed = seed || null;

    // @private {number}
    this.nodeCount = nodeCount;

    // @private {boolean}
    this.logToConsole = logToConsole;

    // @private {Array.<Node>}
    this.nodes = _.range(0, nodeCount).map(() => new Node());

    // @private {Display}
    this.display = new Display(this.nodes[0]);

    // @private {Random}
    this.random = new Random({
      seed: seed
    });

    // @private {Array.<Action>}
    this.actionsTaken = [];
  }

  /**
   * Runs one action randomly (printing out the action and result).
   * @public
   */
  step() {
    const action = this.random.sample(this.enumerateActions());
    this.logToConsole && console.log(action.text);
    this.actionsTaken.push(action);
    action.execute();
    this.display._rootPDOMInstance.auditRoot();
    PDOMTree.auditPDOMDisplays(this.display.rootNode);
    if (this.logToConsole) {
      for (let i = 0; i < this.nodes.length; i++) {
        const node = this.nodes[i];
        console.log(`${i}#${node.id} ${node.tagName} ch:${PDOMTree.debugOrder(node.children)} or:${PDOMTree.debugOrder(node.pdomOrder)} vis:${node.visible} avis:${node.pdomVisible}`);
      }
    }
  }

  /**
   * Find all of the possible actions that are legal.
   * @private
   *
   * @returns {Array.<Object>} - like { text: {string}, execute: {function} }
   */
  enumerateActions() {
    const actions = [];
    this.nodes.forEach(a => {
      actions.push({
        text: `#${a.id}.visible = ${!a.visible}`,
        execute: () => {
          a.visible = !a.visible;
        }
      });
      actions.push({
        text: `#${a.id}.pdomVisible = ${!a.pdomVisible}`,
        execute: () => {
          a.pdomVisible = !a.pdomVisible;
        }
      });
      ['span', 'div', null].forEach(tagName => {
        if (a.tagName !== tagName) {
          actions.push({
            text: `#${a.id}.tagName = ${tagName}`,
            execute: () => {
              a.tagName = tagName;
            }
          });
        }
      });
      this.powerSet(arrayDifference(this.nodes, [a]).concat([null])).forEach(subset => {
        Permutation.forEachPermutation(subset, order => {
          // TODO: Make sure it's not the CURRENT order?
          if (this.isPDOMOrderChangeLegal(a, order)) {
            actions.push({
              text: `#${a.id}.pdomOrder = ${PDOMTree.debugOrder(order)}`,
              execute: () => {
                a.pdomOrder = order;
              }
            });
          }
        });
      });
      this.nodes.forEach(b => {
        if (this.isAddChildLegal(a, b)) {
          _.range(0, a.children.length + 1).forEach(i => {
            actions.push({
              text: `#${a.id}.insertChild(${i},#${b.id})`,
              execute: () => {
                a.insertChild(i, b);
              }
            });
          });
        }
        if (a.hasChild(b)) {
          actions.push({
            text: `#${a.id}.removeChild(#${b.id})`,
            execute: () => {
              a.removeChild(b);
            }
          });
        }
      });
    });
    return actions;
  }

  /**
   * Checks whether the child can be added (as a child) to the parent.
   * @private
   *
   * @param {Node} parent
   * @param {Node} child
   * @returns {boolean}
   */
  isAddChildLegal(parent, child) {
    return !parent.hasChild(child) && this.isAcyclic(parent, child);
  }

  /**
   * Returns the power set of a set (all subsets).
   * @private
   *
   * @param {Array.<*>} list
   * @returns {Array.<Array.<*>>}
   */
  powerSet(list) {
    if (list.length === 0) {
      return [[]];
    } else {
      const lists = this.powerSet(list.slice(1));
      return lists.concat(lists.map(subList => [list[0]].concat(subList)));
    }
  }

  /**
   * Returns whether an accessible order change is legal.
   * @private
   *
   * @param {Node} node
   * @param {Array.<Node|null>|null} order
   */
  isPDOMOrderChangeLegal(node, order) {
    // remap for equivalence, so it's an array of nodes
    if (order === null) {
      order = [];
    }
    order = order.filter(n => n !== null);
    if (_.includes(order, node) || _.uniq(order).length < order.length) {
      return false;
    }

    // Can't include nodes that are included in other accessible orders
    for (let i = 0; i < order.length; i++) {
      if (order[i]._pdomParent && order[i]._pdomParent !== node) {
        return false;
      }
    }
    const hasConnection = (a, b) => {
      if (a === node) {
        return a.hasChild(b) || _.includes(order, b);
      } else {
        return a.hasChild(b) || !!a.pdomOrder && _.includes(a.pdomOrder, b);
      }
    };
    const effectiveChildren = node.children.concat(order);
    return _.every(effectiveChildren, child => this.isAcyclic(node, child, hasConnection));
  }

  /**
   * Checks whether a connection (parent-child or accessible order) is legal (doesn't cause a cycle).
   * @private
   *
   * @param {Node} parent
   * @param {Node} child
   * @param {function} hasConnection - determines whether there is a parent-child-style relationship between params
   * @returns {boolean}
   */
  isAcyclic(parent, child, hasConnection) {
    if (parent === child) {
      return false;
    }
    const nodes = child.children.concat(child.pdomOrder).filter(n => n !== null); // super defensive

    while (nodes.length) {
      const node = nodes.pop();
      if (node === parent) {
        return false;
      }
      if (hasConnection) {
        this.nodes.forEach(potentialChild => {
          if (hasConnection(node, potentialChild)) {
            nodes.push(potentialChild);
          }
        });
      } else {
        // Add in children and accessible children (don't worry about duplicates since perf isn't critical)
        Array.prototype.push.apply(nodes, node.children);
        if (node.pdomOrder) {
          Array.prototype.push.apply(nodes, node.pdomOrder.filter(n => n !== null));
        }
      }
    }
    return true;
  }

  /**
   * Releases references
   * @public
   */
  dispose() {
    this.display.dispose();
  }
}
scenery.register('PDOMFuzzer', PDOMFuzzer);
export default PDOMFuzzer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQZXJtdXRhdGlvbiIsIlJhbmRvbSIsImFycmF5RGlmZmVyZW5jZSIsIkRpc3BsYXkiLCJOb2RlIiwiUERPTVRyZWUiLCJzY2VuZXJ5IiwiUERPTUZ1enplciIsImNvbnN0cnVjdG9yIiwibm9kZUNvdW50IiwibG9nVG9Db25zb2xlIiwic2VlZCIsImFzc2VydCIsIm5vZGVzIiwiXyIsInJhbmdlIiwibWFwIiwiZGlzcGxheSIsInJhbmRvbSIsImFjdGlvbnNUYWtlbiIsInN0ZXAiLCJhY3Rpb24iLCJzYW1wbGUiLCJlbnVtZXJhdGVBY3Rpb25zIiwiY29uc29sZSIsImxvZyIsInRleHQiLCJwdXNoIiwiZXhlY3V0ZSIsIl9yb290UERPTUluc3RhbmNlIiwiYXVkaXRSb290IiwiYXVkaXRQRE9NRGlzcGxheXMiLCJyb290Tm9kZSIsImkiLCJsZW5ndGgiLCJub2RlIiwiaWQiLCJ0YWdOYW1lIiwiZGVidWdPcmRlciIsImNoaWxkcmVuIiwicGRvbU9yZGVyIiwidmlzaWJsZSIsInBkb21WaXNpYmxlIiwiYWN0aW9ucyIsImZvckVhY2giLCJhIiwicG93ZXJTZXQiLCJjb25jYXQiLCJzdWJzZXQiLCJmb3JFYWNoUGVybXV0YXRpb24iLCJvcmRlciIsImlzUERPTU9yZGVyQ2hhbmdlTGVnYWwiLCJiIiwiaXNBZGRDaGlsZExlZ2FsIiwiaW5zZXJ0Q2hpbGQiLCJoYXNDaGlsZCIsInJlbW92ZUNoaWxkIiwicGFyZW50IiwiY2hpbGQiLCJpc0FjeWNsaWMiLCJsaXN0IiwibGlzdHMiLCJzbGljZSIsInN1Ykxpc3QiLCJmaWx0ZXIiLCJuIiwiaW5jbHVkZXMiLCJ1bmlxIiwiX3Bkb21QYXJlbnQiLCJoYXNDb25uZWN0aW9uIiwiZWZmZWN0aXZlQ2hpbGRyZW4iLCJldmVyeSIsInBvcCIsInBvdGVudGlhbENoaWxkIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJhcHBseSIsImRpc3Bvc2UiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlBET01GdXp6ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogUnVucyBQRE9NLXRyZWUtcmVsYXRlZCBzY2VuZXJ5IG9wZXJhdGlvbnMgcmFuZG9tbHkgKHdpdGggYXNzZXJ0aW9ucykgdG8gdHJ5IHRvIGZpbmQgYW55IGJ1Z3MuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgUGVybXV0YXRpb24gZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1Blcm11dGF0aW9uLmpzJztcclxuaW1wb3J0IFJhbmRvbSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZG9tLmpzJztcclxuaW1wb3J0IGFycmF5RGlmZmVyZW5jZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvYXJyYXlEaWZmZXJlbmNlLmpzJztcclxuaW1wb3J0IHsgRGlzcGxheSwgTm9kZSwgUERPTVRyZWUsIHNjZW5lcnkgfSBmcm9tICcuLi8uLi9pbXBvcnRzLmpzJztcclxuXHJcbmNsYXNzIFBET01GdXp6ZXIge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBub2RlQ291bnRcclxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGxvZ1RvQ29uc29sZVxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbc2VlZF1cclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvciggbm9kZUNvdW50LCBsb2dUb0NvbnNvbGUsIHNlZWQgKSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBub2RlQ291bnQgPj0gMiApO1xyXG5cclxuICAgIHNlZWQgPSBzZWVkIHx8IG51bGw7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge251bWJlcn1cclxuICAgIHRoaXMubm9kZUNvdW50ID0gbm9kZUNvdW50O1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtib29sZWFufVxyXG4gICAgdGhpcy5sb2dUb0NvbnNvbGUgPSBsb2dUb0NvbnNvbGU7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge0FycmF5LjxOb2RlPn1cclxuICAgIHRoaXMubm9kZXMgPSBfLnJhbmdlKCAwLCBub2RlQ291bnQgKS5tYXAoICgpID0+IG5ldyBOb2RlKCkgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7RGlzcGxheX1cclxuICAgIHRoaXMuZGlzcGxheSA9IG5ldyBEaXNwbGF5KCB0aGlzLm5vZGVzWyAwIF0gKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7UmFuZG9tfVxyXG4gICAgdGhpcy5yYW5kb20gPSBuZXcgUmFuZG9tKCB7IHNlZWQ6IHNlZWQgfSApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtBcnJheS48QWN0aW9uPn1cclxuICAgIHRoaXMuYWN0aW9uc1Rha2VuID0gW107XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSdW5zIG9uZSBhY3Rpb24gcmFuZG9tbHkgKHByaW50aW5nIG91dCB0aGUgYWN0aW9uIGFuZCByZXN1bHQpLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBzdGVwKCkge1xyXG4gICAgY29uc3QgYWN0aW9uID0gdGhpcy5yYW5kb20uc2FtcGxlKCB0aGlzLmVudW1lcmF0ZUFjdGlvbnMoKSApO1xyXG4gICAgdGhpcy5sb2dUb0NvbnNvbGUgJiYgY29uc29sZS5sb2coIGFjdGlvbi50ZXh0ICk7XHJcbiAgICB0aGlzLmFjdGlvbnNUYWtlbi5wdXNoKCBhY3Rpb24gKTtcclxuICAgIGFjdGlvbi5leGVjdXRlKCk7XHJcbiAgICB0aGlzLmRpc3BsYXkuX3Jvb3RQRE9NSW5zdGFuY2UuYXVkaXRSb290KCk7XHJcbiAgICBQRE9NVHJlZS5hdWRpdFBET01EaXNwbGF5cyggdGhpcy5kaXNwbGF5LnJvb3ROb2RlICk7XHJcbiAgICBpZiAoIHRoaXMubG9nVG9Db25zb2xlICkge1xyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLm5vZGVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLm5vZGVzWyBpIF07XHJcbiAgICAgICAgY29uc29sZS5sb2coIGAke2l9IyR7bm9kZS5pZH0gJHtub2RlLnRhZ05hbWV9IGNoOiR7UERPTVRyZWUuZGVidWdPcmRlciggbm9kZS5jaGlsZHJlbiApfSBvcjoke1BET01UcmVlLmRlYnVnT3JkZXIoIG5vZGUucGRvbU9yZGVyICl9IHZpczoke25vZGUudmlzaWJsZX0gYXZpczoke25vZGUucGRvbVZpc2libGV9YCApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGaW5kIGFsbCBvZiB0aGUgcG9zc2libGUgYWN0aW9ucyB0aGF0IGFyZSBsZWdhbC5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqXHJcbiAgICogQHJldHVybnMge0FycmF5LjxPYmplY3Q+fSAtIGxpa2UgeyB0ZXh0OiB7c3RyaW5nfSwgZXhlY3V0ZToge2Z1bmN0aW9ufSB9XHJcbiAgICovXHJcbiAgZW51bWVyYXRlQWN0aW9ucygpIHtcclxuICAgIGNvbnN0IGFjdGlvbnMgPSBbXTtcclxuXHJcbiAgICB0aGlzLm5vZGVzLmZvckVhY2goIGEgPT4ge1xyXG4gICAgICBhY3Rpb25zLnB1c2goIHtcclxuICAgICAgICB0ZXh0OiBgIyR7YS5pZH0udmlzaWJsZSA9ICR7IWEudmlzaWJsZX1gLFxyXG4gICAgICAgIGV4ZWN1dGU6ICgpID0+IHtcclxuICAgICAgICAgIGEudmlzaWJsZSA9ICFhLnZpc2libGU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgICAgIGFjdGlvbnMucHVzaCgge1xyXG4gICAgICAgIHRleHQ6IGAjJHthLmlkfS5wZG9tVmlzaWJsZSA9ICR7IWEucGRvbVZpc2libGV9YCxcclxuICAgICAgICBleGVjdXRlOiAoKSA9PiB7XHJcbiAgICAgICAgICBhLnBkb21WaXNpYmxlID0gIWEucGRvbVZpc2libGU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgICAgIFsgJ3NwYW4nLCAnZGl2JywgbnVsbCBdLmZvckVhY2goIHRhZ05hbWUgPT4ge1xyXG4gICAgICAgIGlmICggYS50YWdOYW1lICE9PSB0YWdOYW1lICkge1xyXG4gICAgICAgICAgYWN0aW9ucy5wdXNoKCB7XHJcbiAgICAgICAgICAgIHRleHQ6IGAjJHthLmlkfS50YWdOYW1lID0gJHt0YWdOYW1lfWAsXHJcbiAgICAgICAgICAgIGV4ZWN1dGU6ICgpID0+IHtcclxuICAgICAgICAgICAgICBhLnRhZ05hbWUgPSB0YWdOYW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9ICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICB0aGlzLnBvd2VyU2V0KCBhcnJheURpZmZlcmVuY2UoIHRoaXMubm9kZXMsIFsgYSBdICkuY29uY2F0KCBbIG51bGwgXSApICkuZm9yRWFjaCggc3Vic2V0ID0+IHtcclxuICAgICAgICBQZXJtdXRhdGlvbi5mb3JFYWNoUGVybXV0YXRpb24oIHN1YnNldCwgb3JkZXIgPT4ge1xyXG4gICAgICAgICAgLy8gVE9ETzogTWFrZSBzdXJlIGl0J3Mgbm90IHRoZSBDVVJSRU5UIG9yZGVyP1xyXG4gICAgICAgICAgaWYgKCB0aGlzLmlzUERPTU9yZGVyQ2hhbmdlTGVnYWwoIGEsIG9yZGVyICkgKSB7XHJcbiAgICAgICAgICAgIGFjdGlvbnMucHVzaCgge1xyXG4gICAgICAgICAgICAgIHRleHQ6IGAjJHthLmlkfS5wZG9tT3JkZXIgPSAke1BET01UcmVlLmRlYnVnT3JkZXIoIG9yZGVyICl9YCxcclxuICAgICAgICAgICAgICBleGVjdXRlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhLnBkb21PcmRlciA9IG9yZGVyO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gKTtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgdGhpcy5ub2Rlcy5mb3JFYWNoKCBiID0+IHtcclxuICAgICAgICBpZiAoIHRoaXMuaXNBZGRDaGlsZExlZ2FsKCBhLCBiICkgKSB7XHJcbiAgICAgICAgICBfLnJhbmdlKCAwLCBhLmNoaWxkcmVuLmxlbmd0aCArIDEgKS5mb3JFYWNoKCBpID0+IHtcclxuICAgICAgICAgICAgYWN0aW9ucy5wdXNoKCB7XHJcbiAgICAgICAgICAgICAgdGV4dDogYCMke2EuaWR9Lmluc2VydENoaWxkKCR7aX0sIyR7Yi5pZH0pYCxcclxuICAgICAgICAgICAgICBleGVjdXRlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhLmluc2VydENoaWxkKCBpLCBiICk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ICk7XHJcbiAgICAgICAgICB9ICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICggYS5oYXNDaGlsZCggYiApICkge1xyXG4gICAgICAgICAgYWN0aW9ucy5wdXNoKCB7XHJcbiAgICAgICAgICAgIHRleHQ6IGAjJHthLmlkfS5yZW1vdmVDaGlsZCgjJHtiLmlkfSlgLFxyXG4gICAgICAgICAgICBleGVjdXRlOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgYS5yZW1vdmVDaGlsZCggYiApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9ICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgcmV0dXJuIGFjdGlvbnM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVja3Mgd2hldGhlciB0aGUgY2hpbGQgY2FuIGJlIGFkZGVkIChhcyBhIGNoaWxkKSB0byB0aGUgcGFyZW50LlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge05vZGV9IHBhcmVudFxyXG4gICAqIEBwYXJhbSB7Tm9kZX0gY2hpbGRcclxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuICAgKi9cclxuICBpc0FkZENoaWxkTGVnYWwoIHBhcmVudCwgY2hpbGQgKSB7XHJcbiAgICByZXR1cm4gIXBhcmVudC5oYXNDaGlsZCggY2hpbGQgKSAmJiB0aGlzLmlzQWN5Y2xpYyggcGFyZW50LCBjaGlsZCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgcG93ZXIgc2V0IG9mIGEgc2V0IChhbGwgc3Vic2V0cykuXHJcbiAgICogQHByaXZhdGVcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7QXJyYXkuPCo+fSBsaXN0XHJcbiAgICogQHJldHVybnMge0FycmF5LjxBcnJheS48Kj4+fVxyXG4gICAqL1xyXG4gIHBvd2VyU2V0KCBsaXN0ICkge1xyXG4gICAgaWYgKCBsaXN0Lmxlbmd0aCA9PT0gMCApIHtcclxuICAgICAgcmV0dXJuIFsgW10gXTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjb25zdCBsaXN0cyA9IHRoaXMucG93ZXJTZXQoIGxpc3Quc2xpY2UoIDEgKSApO1xyXG4gICAgICByZXR1cm4gbGlzdHMuY29uY2F0KCBsaXN0cy5tYXAoIHN1Ykxpc3QgPT4gWyBsaXN0WyAwIF0gXS5jb25jYXQoIHN1Ykxpc3QgKSApICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHdoZXRoZXIgYW4gYWNjZXNzaWJsZSBvcmRlciBjaGFuZ2UgaXMgbGVnYWwuXHJcbiAgICogQHByaXZhdGVcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxyXG4gICAqIEBwYXJhbSB7QXJyYXkuPE5vZGV8bnVsbD58bnVsbH0gb3JkZXJcclxuICAgKi9cclxuICBpc1BET01PcmRlckNoYW5nZUxlZ2FsKCBub2RlLCBvcmRlciApIHtcclxuICAgIC8vIHJlbWFwIGZvciBlcXVpdmFsZW5jZSwgc28gaXQncyBhbiBhcnJheSBvZiBub2Rlc1xyXG4gICAgaWYgKCBvcmRlciA9PT0gbnVsbCApIHsgb3JkZXIgPSBbXTsgfVxyXG4gICAgb3JkZXIgPSBvcmRlci5maWx0ZXIoIG4gPT4gbiAhPT0gbnVsbCApO1xyXG5cclxuICAgIGlmICggXy5pbmNsdWRlcyggb3JkZXIsIG5vZGUgKSB8fFxyXG4gICAgICAgICBfLnVuaXEoIG9yZGVyICkubGVuZ3RoIDwgb3JkZXIubGVuZ3RoICkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2FuJ3QgaW5jbHVkZSBub2RlcyB0aGF0IGFyZSBpbmNsdWRlZCBpbiBvdGhlciBhY2Nlc3NpYmxlIG9yZGVyc1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgb3JkZXIubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGlmICggb3JkZXJbIGkgXS5fcGRvbVBhcmVudCAmJiBvcmRlclsgaSBdLl9wZG9tUGFyZW50ICE9PSBub2RlICkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGhhc0Nvbm5lY3Rpb24gPSAoIGEsIGIgKSA9PiB7XHJcbiAgICAgIGlmICggYSA9PT0gbm9kZSApIHtcclxuICAgICAgICByZXR1cm4gYS5oYXNDaGlsZCggYiApIHx8IF8uaW5jbHVkZXMoIG9yZGVyLCBiICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGEuaGFzQ2hpbGQoIGIgKSB8fCAoICEhYS5wZG9tT3JkZXIgJiYgXy5pbmNsdWRlcyggYS5wZG9tT3JkZXIsIGIgKSApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGVmZmVjdGl2ZUNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbi5jb25jYXQoIG9yZGVyICk7XHJcbiAgICByZXR1cm4gXy5ldmVyeSggZWZmZWN0aXZlQ2hpbGRyZW4sIGNoaWxkID0+IHRoaXMuaXNBY3ljbGljKCBub2RlLCBjaGlsZCwgaGFzQ29ubmVjdGlvbiApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVja3Mgd2hldGhlciBhIGNvbm5lY3Rpb24gKHBhcmVudC1jaGlsZCBvciBhY2Nlc3NpYmxlIG9yZGVyKSBpcyBsZWdhbCAoZG9lc24ndCBjYXVzZSBhIGN5Y2xlKS5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtOb2RlfSBwYXJlbnRcclxuICAgKiBAcGFyYW0ge05vZGV9IGNoaWxkXHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gaGFzQ29ubmVjdGlvbiAtIGRldGVybWluZXMgd2hldGhlciB0aGVyZSBpcyBhIHBhcmVudC1jaGlsZC1zdHlsZSByZWxhdGlvbnNoaXAgYmV0d2VlbiBwYXJhbXNcclxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuICAgKi9cclxuICBpc0FjeWNsaWMoIHBhcmVudCwgY2hpbGQsIGhhc0Nvbm5lY3Rpb24gKSB7XHJcbiAgICBpZiAoIHBhcmVudCA9PT0gY2hpbGQgKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBub2RlcyA9IGNoaWxkLmNoaWxkcmVuLmNvbmNhdCggY2hpbGQucGRvbU9yZGVyICkuZmlsdGVyKCBuID0+IG4gIT09IG51bGwgKTsgLy8gc3VwZXIgZGVmZW5zaXZlXHJcblxyXG4gICAgd2hpbGUgKCBub2Rlcy5sZW5ndGggKSB7XHJcbiAgICAgIGNvbnN0IG5vZGUgPSBub2Rlcy5wb3AoKTtcclxuICAgICAgaWYgKCBub2RlID09PSBwYXJlbnQgKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIGhhc0Nvbm5lY3Rpb24gKSB7XHJcbiAgICAgICAgdGhpcy5ub2Rlcy5mb3JFYWNoKCBwb3RlbnRpYWxDaGlsZCA9PiB7XHJcbiAgICAgICAgICBpZiAoIGhhc0Nvbm5lY3Rpb24oIG5vZGUsIHBvdGVudGlhbENoaWxkICkgKSB7XHJcbiAgICAgICAgICAgIG5vZGVzLnB1c2goIHBvdGVudGlhbENoaWxkICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIEFkZCBpbiBjaGlsZHJlbiBhbmQgYWNjZXNzaWJsZSBjaGlsZHJlbiAoZG9uJ3Qgd29ycnkgYWJvdXQgZHVwbGljYXRlcyBzaW5jZSBwZXJmIGlzbid0IGNyaXRpY2FsKVxyXG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KCBub2Rlcywgbm9kZS5jaGlsZHJlbiApO1xyXG4gICAgICAgIGlmICggbm9kZS5wZG9tT3JkZXIgKSB7XHJcbiAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseSggbm9kZXMsIG5vZGUucGRvbU9yZGVyLmZpbHRlciggbiA9PiBuICE9PSBudWxsICkgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbGVhc2VzIHJlZmVyZW5jZXNcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIHRoaXMuZGlzcGxheS5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5zY2VuZXJ5LnJlZ2lzdGVyKCAnUERPTUZ1enplcicsIFBET01GdXp6ZXIgKTtcclxuZXhwb3J0IGRlZmF1bHQgUERPTUZ1enplcjsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsV0FBVyxNQUFNLG1DQUFtQztBQUMzRCxPQUFPQyxNQUFNLE1BQU0sOEJBQThCO0FBQ2pELE9BQU9DLGVBQWUsTUFBTSw2Q0FBNkM7QUFDekUsU0FBU0MsT0FBTyxFQUFFQyxJQUFJLEVBQUVDLFFBQVEsRUFBRUMsT0FBTyxRQUFRLGtCQUFrQjtBQUVuRSxNQUFNQyxVQUFVLENBQUM7RUFDZjtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLFdBQVdBLENBQUVDLFNBQVMsRUFBRUMsWUFBWSxFQUFFQyxJQUFJLEVBQUc7SUFDM0NDLE1BQU0sSUFBSUEsTUFBTSxDQUFFSCxT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