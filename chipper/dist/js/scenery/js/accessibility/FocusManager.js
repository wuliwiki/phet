// Copyright 2021-2023, University of Colorado Boulder

/**
 * Manages the Properties which signify and control where various forms of focus are. A Focus
 * just contains the Trail pointing to the Node with focus and a Display whose root is at the
 * root of that Trail. So it can be used for more than just DOM focus. At the time of this writing,
 * the forms of Focus include
 *
 *  - DOM Focus - The Focus Trail points to the Node whose element has DOM focus in the Parallel DOM.
 *                Only one element can have focus at a time (DOM limitation) so this is managed by a static on
 *                FocusManager.
 *  - Pointer Focus - The Focus trail points to a Node that supports Highlighting with pointer events.
 *  - Reading Block Focus - The Focus Trail points to a Node that supports ReadingBlocks, and is active
 *                          while the ReadingBlock content is being spoken for Voicing. See ReadingBlock.ts
 *
 * There may be other forms of Focus in the future.
 *
 * This class also controls setting and clearing of several (but not all) of these Properties. It does not set the
 * pdomFocusProperty because that Property is set only when the browser's focus changes. Some of the focus
 * Properties are set in feature traits, such as pointerFocusProperty which is set by InteractiveHighlighting because it is
 * set through listeners on each individual Node.
 *
 * This class also has a few Properties that control the behavior of the Display's HighlightOverlay.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import Property from '../../../axon/js/Property.js';
import Tandem from '../../../tandem/js/Tandem.js';
import NullableIO from '../../../tandem/js/types/NullableIO.js';
import { Focus, FocusDisplayedController, ReadingBlockUtterance, scenery, voicingManager } from '../imports.js';
export default class FocusManager {
  // This Property whose Focus Trail points to the Node under the pointer to
  // support features of Voicing and Interactive Highlights. Nodes that compose InteractiveHighlighting can
  // receive this Focus and a highlight may appear around it.

  // The Property that indicates which Node that uses ReadingBlock is currently
  // active. Used by the HighlightOverlay to highlight ReadingBlock Nodes whose content is being spoken.
  // A Property whose value is either null or a Focus with Trail and Display equal
  // to the pointerFocusProperty. When this Property has a value, the HighlightOverlay will wait to update the
  // highlight for the pointerFocusProperty. This is useful when the pointer has begun to interact with a Node
  // that uses InteractiveHighlighting, but the mouse has moved out of it or over another during interaction. Thehighlight
  // should remain on the Node receiving interaction and wait to update until interaction completes.
  // Controls whether or not highlights related to PDOM focus are visible.
  // Controls whether "Interactive Highlights" are visible.
  // Controls whether "Reading Block" highlights will be visible around Nodes
  // that use ReadingBlock.
  // Indicates whether any highlights should appear from pointer
  // input (mouse/touch). If false, we will try to avoid doing expensive work in PointerHighlighting.js.
  // Whenever the readingBlockFocusProperty's Focused Node is removed from
  // the scene graph or its Trail becomes invisible this removes focus.
  // If the voicingManager starts speaking an Utterance for a ReadingBLock, set the readingBlockFocusProperty and
  // add listeners to clear it when the Node is removed or becomes invisible
  // Whenever the voicingManager stops speaking an utterance for the ReadingBlock that has focus, clear it
  // References to the window listeners that update when the window has focus. So they can be removed if needed.
  static attachedWindowFocusListener = null;
  static attachedWindowBlurListener = null;
  static globallyAttached = false;
  constructor() {
    this.pointerFocusProperty = new Property(null);
    this.readingBlockFocusProperty = new Property(null);
    this.lockedPointerFocusProperty = new Property(null);
    this.pdomFocusHighlightsVisibleProperty = new BooleanProperty(true);
    this.interactiveHighlightsVisibleProperty = new BooleanProperty(false);
    this.readingBlockHighlightsVisibleProperty = new BooleanProperty(false);

    // TODO: perhaps remove once reading blocks are set up to listen instead to Node.canSpeakProperty (voicingVisible), https://github.com/phetsims/scenery/issues/1343
    this.voicingFullyEnabledListener = enabled => {
      this.readingBlockHighlightsVisibleProperty.value = enabled;
    };
    voicingManager.voicingFullyEnabledProperty.link(this.voicingFullyEnabledListener);
    this.pointerHighlightsVisibleProperty = new DerivedProperty([this.interactiveHighlightsVisibleProperty, this.readingBlockHighlightsVisibleProperty], (interactiveHighlightsVisible, voicingEnabled) => {
      return interactiveHighlightsVisible || voicingEnabled;
    });

    //-----------------------------------------------------------------------------------------------------------------
    // The following section manages control of ReadingBlockFocusProperty. It takes a value whenever the
    // voicingManager starts speaking and the value is cleared when it stops speaking. Focus is also cleared
    // by the FocusDisplayedController.

    this.readingBlockFocusController = new FocusDisplayedController(this.readingBlockFocusProperty);
    this.startSpeakingListener = (text, utterance) => {
      this.readingBlockFocusProperty.value = utterance instanceof ReadingBlockUtterance ? utterance.readingBlockFocus : null;
    };

    // @ts-expect-error
    voicingManager.startSpeakingEmitter.addListener(this.startSpeakingListener);
    this.endSpeakingListener = (text, utterance) => {
      if (utterance instanceof ReadingBlockUtterance && this.readingBlockFocusProperty.value) {
        assert && assert(utterance.readingBlockFocus, 'should be non null focus');

        // only clear the readingBlockFocusProperty if the ReadingBlockUtterance has a Focus that matches the
        // current value for readingBlockFocusProperty so that the highlight doesn't disappear every time
        // the speaker stops talking
        if (utterance.readingBlockFocus.trail.equals(this.readingBlockFocusProperty.value.trail)) {
          this.readingBlockFocusProperty.value = null;
        }
      }
    };

    // @ts-expect-error
    voicingManager.endSpeakingEmitter.addListener(this.endSpeakingListener);

    //-----------------------------------------------------------------------------------------------------------------
    // The following section manages control of pointerFocusProperty - pointerFocusProperty is set with a Focus
    // by InteractiveHighlighting from listeners on Nodes that use that Trait. But it uses a FocusDisplayedController
    // to remove the focus at the right time.

    this.pointerFocusDisplayedController = new FocusDisplayedController(this.pointerFocusProperty, {
      // whenever focus is removed because the last Node of the Focus Trail is no
      // longer displayed, the highlight for Pointer Focus should no longer be locked
      onRemoveFocus: () => {
        this.lockedPointerFocusProperty.value = null;
      }
    });
  }
  dispose() {
    this.readingBlockFocusController.dispose();
    this.pointerFocusDisplayedController.dispose();
    this.pointerHighlightsVisibleProperty.dispose();

    // @ts-expect-error
    voicingManager.startSpeakingEmitter.removeListener(this.startSpeakingListener);

    // @ts-expect-error
    voicingManager.endSpeakingEmitter.removeListener(this.endSpeakingListener);
    voicingManager.voicingFullyEnabledProperty.unlink(this.voicingFullyEnabledListener);
  }

  /**
   * Set the DOM focus. A DOM limitation is that there can only be one element with focus at a time so this must
   * be a static for the FocusManager.
   */
  static set pdomFocus(value) {
    if (FocusManager.pdomFocusProperty.value !== value) {
      let previousFocus;
      if (FocusManager.pdomFocusProperty.value) {
        previousFocus = FocusManager.pdomFocusedNode;
      }
      FocusManager.pdomFocusProperty.value = value;

      // if set to null, make sure that the active element is no longer focused
      if (previousFocus && !value) {
        previousFocus.blur();
      }
    }
  }

  /**
   * Get the Focus pointing to the Node whose Parallel DOM element has DOM focus.
   */
  static get pdomFocus() {
    return FocusManager.pdomFocusProperty.value;
  }

  /**
   * Get the Node that currently has DOM focus, the leaf-most Node of the Focus Trail. Null if no
   * Node has focus.
   */
  static getPDOMFocusedNode() {
    let focusedNode = null;
    const focus = FocusManager.pdomFocusProperty.get();
    if (focus) {
      focusedNode = focus.trail.lastNode();
    }
    return focusedNode;
  }
  static get pdomFocusedNode() {
    return this.getPDOMFocusedNode();
  }

  // Display has an axon `Property to indicate which component is focused (or null if no
  // scenery Node has focus). By passing the tandem and phetioTye, PhET-iO is able to interoperate (save, restore,
  // control, observe what is currently focused). See FocusManager.pdomFocus for setting the focus. Don't set the value
  // of this Property directly.
  static pdomFocusProperty = new Property(null, {
    tandem: Tandem.GENERAL_MODEL.createTandem('pdomFocusProperty'),
    phetioDocumentation: 'Stores the current focus in the Parallel DOM, null if nothing has focus. This is not updated ' + 'based on mouse or touch input, only keyboard and other alternative inputs. Note that this only ' + 'applies to simulations that support alternative input.',
    phetioValueType: NullableIO(Focus.FocusIO),
    phetioState: false,
    phetioFeatured: true,
    phetioReadOnly: true
  });

  /**
   * A Property that lets you know when the window has focus. When the window has focus, it is in the user's foreground.
   * When in the background, the window does not receive keyboard input (important for global keyboard events).
   */
  static _windowHasFocusProperty = new BooleanProperty(false);
  static windowHasFocusProperty = FocusManager._windowHasFocusProperty;

  /**
   * Updates the _windowHasFocusProperty when the window receives/loses focus. When the window has focus
   * it is in the foreground of the user. When in the background, the window will not receive keyboard input.
   * https://developer.mozilla.org/en-US/docs/Web/API/Window/focus_event.
   *
   * This will be called by scenery for you when you use Display.initializeEvents().
   */
  static attachToWindow() {
    assert && assert(!FocusManager.globallyAttached, 'Can only be attached statically once.');
    FocusManager.attachedWindowFocusListener = () => {
      FocusManager._windowHasFocusProperty.value = true;
    };
    FocusManager.attachedWindowBlurListener = () => {
      FocusManager._windowHasFocusProperty.value = false;
    };
    window.addEventListener('focus', FocusManager.attachedWindowFocusListener);
    window.addEventListener('blur', FocusManager.attachedWindowBlurListener);

    // value will be updated with window, but we need a proper initial value (this function may be called while
    // the window is not in the foreground).
    FocusManager._windowHasFocusProperty.value = document.hasFocus();
    FocusManager.globallyAttached = true;
  }

  /**
   * Detach all window focus/blur listeners from FocusManager watching for when the window loses focus.
   */
  static detachFromWindow() {
    window.removeEventListener('focus', FocusManager.attachedWindowFocusListener);
    window.removeEventListener('blur', FocusManager.attachedWindowBlurListener);

    // For cleanup, this Property becomes false again when detaching because we will no longer be watching for changes.
    FocusManager._windowHasFocusProperty.value = false;
    FocusManager.globallyAttached = false;
  }
}
scenery.register('FocusManager', FocusManager);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJQcm9wZXJ0eSIsIlRhbmRlbSIsIk51bGxhYmxlSU8iLCJGb2N1cyIsIkZvY3VzRGlzcGxheWVkQ29udHJvbGxlciIsIlJlYWRpbmdCbG9ja1V0dGVyYW5jZSIsInNjZW5lcnkiLCJ2b2ljaW5nTWFuYWdlciIsIkZvY3VzTWFuYWdlciIsImF0dGFjaGVkV2luZG93Rm9jdXNMaXN0ZW5lciIsImF0dGFjaGVkV2luZG93Qmx1ckxpc3RlbmVyIiwiZ2xvYmFsbHlBdHRhY2hlZCIsImNvbnN0cnVjdG9yIiwicG9pbnRlckZvY3VzUHJvcGVydHkiLCJyZWFkaW5nQmxvY2tGb2N1c1Byb3BlcnR5IiwibG9ja2VkUG9pbnRlckZvY3VzUHJvcGVydHkiLCJwZG9tRm9jdXNIaWdobGlnaHRzVmlzaWJsZVByb3BlcnR5IiwiaW50ZXJhY3RpdmVIaWdobGlnaHRzVmlzaWJsZVByb3BlcnR5IiwicmVhZGluZ0Jsb2NrSGlnaGxpZ2h0c1Zpc2libGVQcm9wZXJ0eSIsInZvaWNpbmdGdWxseUVuYWJsZWRMaXN0ZW5lciIsImVuYWJsZWQiLCJ2YWx1ZSIsInZvaWNpbmdGdWxseUVuYWJsZWRQcm9wZXJ0eSIsImxpbmsiLCJwb2ludGVySGlnaGxpZ2h0c1Zpc2libGVQcm9wZXJ0eSIsImludGVyYWN0aXZlSGlnaGxpZ2h0c1Zpc2libGUiLCJ2b2ljaW5nRW5hYmxlZCIsInJlYWRpbmdCbG9ja0ZvY3VzQ29udHJvbGxlciIsInN0YXJ0U3BlYWtpbmdMaXN0ZW5lciIsInRleHQiLCJ1dHRlcmFuY2UiLCJyZWFkaW5nQmxvY2tGb2N1cyIsInN0YXJ0U3BlYWtpbmdFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJlbmRTcGVha2luZ0xpc3RlbmVyIiwiYXNzZXJ0IiwidHJhaWwiLCJlcXVhbHMiLCJlbmRTcGVha2luZ0VtaXR0ZXIiLCJwb2ludGVyRm9jdXNEaXNwbGF5ZWRDb250cm9sbGVyIiwib25SZW1vdmVGb2N1cyIsImRpc3Bvc2UiLCJyZW1vdmVMaXN0ZW5lciIsInVubGluayIsInBkb21Gb2N1cyIsInBkb21Gb2N1c1Byb3BlcnR5IiwicHJldmlvdXNGb2N1cyIsInBkb21Gb2N1c2VkTm9kZSIsImJsdXIiLCJnZXRQRE9NRm9jdXNlZE5vZGUiLCJmb2N1c2VkTm9kZSIsImZvY3VzIiwiZ2V0IiwibGFzdE5vZGUiLCJ0YW5kZW0iLCJHRU5FUkFMX01PREVMIiwiY3JlYXRlVGFuZGVtIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsInBoZXRpb1ZhbHVlVHlwZSIsIkZvY3VzSU8iLCJwaGV0aW9TdGF0ZSIsInBoZXRpb0ZlYXR1cmVkIiwicGhldGlvUmVhZE9ubHkiLCJfd2luZG93SGFzRm9jdXNQcm9wZXJ0eSIsIndpbmRvd0hhc0ZvY3VzUHJvcGVydHkiLCJhdHRhY2hUb1dpbmRvdyIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJkb2N1bWVudCIsImhhc0ZvY3VzIiwiZGV0YWNoRnJvbVdpbmRvdyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkZvY3VzTWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBNYW5hZ2VzIHRoZSBQcm9wZXJ0aWVzIHdoaWNoIHNpZ25pZnkgYW5kIGNvbnRyb2wgd2hlcmUgdmFyaW91cyBmb3JtcyBvZiBmb2N1cyBhcmUuIEEgRm9jdXNcclxuICoganVzdCBjb250YWlucyB0aGUgVHJhaWwgcG9pbnRpbmcgdG8gdGhlIE5vZGUgd2l0aCBmb2N1cyBhbmQgYSBEaXNwbGF5IHdob3NlIHJvb3QgaXMgYXQgdGhlXHJcbiAqIHJvb3Qgb2YgdGhhdCBUcmFpbC4gU28gaXQgY2FuIGJlIHVzZWQgZm9yIG1vcmUgdGhhbiBqdXN0IERPTSBmb2N1cy4gQXQgdGhlIHRpbWUgb2YgdGhpcyB3cml0aW5nLFxyXG4gKiB0aGUgZm9ybXMgb2YgRm9jdXMgaW5jbHVkZVxyXG4gKlxyXG4gKiAgLSBET00gRm9jdXMgLSBUaGUgRm9jdXMgVHJhaWwgcG9pbnRzIHRvIHRoZSBOb2RlIHdob3NlIGVsZW1lbnQgaGFzIERPTSBmb2N1cyBpbiB0aGUgUGFyYWxsZWwgRE9NLlxyXG4gKiAgICAgICAgICAgICAgICBPbmx5IG9uZSBlbGVtZW50IGNhbiBoYXZlIGZvY3VzIGF0IGEgdGltZSAoRE9NIGxpbWl0YXRpb24pIHNvIHRoaXMgaXMgbWFuYWdlZCBieSBhIHN0YXRpYyBvblxyXG4gKiAgICAgICAgICAgICAgICBGb2N1c01hbmFnZXIuXHJcbiAqICAtIFBvaW50ZXIgRm9jdXMgLSBUaGUgRm9jdXMgdHJhaWwgcG9pbnRzIHRvIGEgTm9kZSB0aGF0IHN1cHBvcnRzIEhpZ2hsaWdodGluZyB3aXRoIHBvaW50ZXIgZXZlbnRzLlxyXG4gKiAgLSBSZWFkaW5nIEJsb2NrIEZvY3VzIC0gVGhlIEZvY3VzIFRyYWlsIHBvaW50cyB0byBhIE5vZGUgdGhhdCBzdXBwb3J0cyBSZWFkaW5nQmxvY2tzLCBhbmQgaXMgYWN0aXZlXHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSB0aGUgUmVhZGluZ0Jsb2NrIGNvbnRlbnQgaXMgYmVpbmcgc3Bva2VuIGZvciBWb2ljaW5nLiBTZWUgUmVhZGluZ0Jsb2NrLnRzXHJcbiAqXHJcbiAqIFRoZXJlIG1heSBiZSBvdGhlciBmb3JtcyBvZiBGb2N1cyBpbiB0aGUgZnV0dXJlLlxyXG4gKlxyXG4gKiBUaGlzIGNsYXNzIGFsc28gY29udHJvbHMgc2V0dGluZyBhbmQgY2xlYXJpbmcgb2Ygc2V2ZXJhbCAoYnV0IG5vdCBhbGwpIG9mIHRoZXNlIFByb3BlcnRpZXMuIEl0IGRvZXMgbm90IHNldCB0aGVcclxuICogcGRvbUZvY3VzUHJvcGVydHkgYmVjYXVzZSB0aGF0IFByb3BlcnR5IGlzIHNldCBvbmx5IHdoZW4gdGhlIGJyb3dzZXIncyBmb2N1cyBjaGFuZ2VzLiBTb21lIG9mIHRoZSBmb2N1c1xyXG4gKiBQcm9wZXJ0aWVzIGFyZSBzZXQgaW4gZmVhdHVyZSB0cmFpdHMsIHN1Y2ggYXMgcG9pbnRlckZvY3VzUHJvcGVydHkgd2hpY2ggaXMgc2V0IGJ5IEludGVyYWN0aXZlSGlnaGxpZ2h0aW5nIGJlY2F1c2UgaXQgaXNcclxuICogc2V0IHRocm91Z2ggbGlzdGVuZXJzIG9uIGVhY2ggaW5kaXZpZHVhbCBOb2RlLlxyXG4gKlxyXG4gKiBUaGlzIGNsYXNzIGFsc28gaGFzIGEgZmV3IFByb3BlcnRpZXMgdGhhdCBjb250cm9sIHRoZSBiZWhhdmlvciBvZiB0aGUgRGlzcGxheSdzIEhpZ2hsaWdodE92ZXJsYXkuXHJcbiAqXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1RQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgTnVsbGFibGVJTyBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvTnVsbGFibGVJTy5qcyc7XHJcbmltcG9ydCBVdHRlcmFuY2UgZnJvbSAnLi4vLi4vLi4vdXR0ZXJhbmNlLXF1ZXVlL2pzL1V0dGVyYW5jZS5qcyc7XHJcbmltcG9ydCB7IEZvY3VzLCBGb2N1c0Rpc3BsYXllZENvbnRyb2xsZXIsIE5vZGUsIFJlYWRpbmdCbG9ja1V0dGVyYW5jZSwgc2NlbmVyeSwgdm9pY2luZ01hbmFnZXIgfSBmcm9tICcuLi9pbXBvcnRzLmpzJztcclxuXHJcbnR5cGUgU3BlYWtpbmdMaXN0ZW5lciA9ICggdGV4dDogc3RyaW5nLCB1dHRlcmFuY2U6IFV0dGVyYW5jZSApID0+IHZvaWQ7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGb2N1c01hbmFnZXIge1xyXG5cclxuICAvLyBUaGlzIFByb3BlcnR5IHdob3NlIEZvY3VzIFRyYWlsIHBvaW50cyB0byB0aGUgTm9kZSB1bmRlciB0aGUgcG9pbnRlciB0b1xyXG4gIC8vIHN1cHBvcnQgZmVhdHVyZXMgb2YgVm9pY2luZyBhbmQgSW50ZXJhY3RpdmUgSGlnaGxpZ2h0cy4gTm9kZXMgdGhhdCBjb21wb3NlIEludGVyYWN0aXZlSGlnaGxpZ2h0aW5nIGNhblxyXG4gIC8vIHJlY2VpdmUgdGhpcyBGb2N1cyBhbmQgYSBoaWdobGlnaHQgbWF5IGFwcGVhciBhcm91bmQgaXQuXHJcbiAgcHVibGljIHJlYWRvbmx5IHBvaW50ZXJGb2N1c1Byb3BlcnR5OiBUUHJvcGVydHk8Rm9jdXMgfCBudWxsPjtcclxuXHJcbiAgLy8gVGhlIFByb3BlcnR5IHRoYXQgaW5kaWNhdGVzIHdoaWNoIE5vZGUgdGhhdCB1c2VzIFJlYWRpbmdCbG9jayBpcyBjdXJyZW50bHlcclxuICAvLyBhY3RpdmUuIFVzZWQgYnkgdGhlIEhpZ2hsaWdodE92ZXJsYXkgdG8gaGlnaGxpZ2h0IFJlYWRpbmdCbG9jayBOb2RlcyB3aG9zZSBjb250ZW50IGlzIGJlaW5nIHNwb2tlbi5cclxuICBwdWJsaWMgcmVhZG9ubHkgcmVhZGluZ0Jsb2NrRm9jdXNQcm9wZXJ0eTogVFByb3BlcnR5PEZvY3VzIHwgbnVsbD47XHJcblxyXG4gIC8vIEEgUHJvcGVydHkgd2hvc2UgdmFsdWUgaXMgZWl0aGVyIG51bGwgb3IgYSBGb2N1cyB3aXRoIFRyYWlsIGFuZCBEaXNwbGF5IGVxdWFsXHJcbiAgLy8gdG8gdGhlIHBvaW50ZXJGb2N1c1Byb3BlcnR5LiBXaGVuIHRoaXMgUHJvcGVydHkgaGFzIGEgdmFsdWUsIHRoZSBIaWdobGlnaHRPdmVybGF5IHdpbGwgd2FpdCB0byB1cGRhdGUgdGhlXHJcbiAgLy8gaGlnaGxpZ2h0IGZvciB0aGUgcG9pbnRlckZvY3VzUHJvcGVydHkuIFRoaXMgaXMgdXNlZnVsIHdoZW4gdGhlIHBvaW50ZXIgaGFzIGJlZ3VuIHRvIGludGVyYWN0IHdpdGggYSBOb2RlXHJcbiAgLy8gdGhhdCB1c2VzIEludGVyYWN0aXZlSGlnaGxpZ2h0aW5nLCBidXQgdGhlIG1vdXNlIGhhcyBtb3ZlZCBvdXQgb2YgaXQgb3Igb3ZlciBhbm90aGVyIGR1cmluZyBpbnRlcmFjdGlvbi4gVGhlaGlnaGxpZ2h0XHJcbiAgLy8gc2hvdWxkIHJlbWFpbiBvbiB0aGUgTm9kZSByZWNlaXZpbmcgaW50ZXJhY3Rpb24gYW5kIHdhaXQgdG8gdXBkYXRlIHVudGlsIGludGVyYWN0aW9uIGNvbXBsZXRlcy5cclxuICBwdWJsaWMgcmVhZG9ubHkgbG9ja2VkUG9pbnRlckZvY3VzUHJvcGVydHk6IFRQcm9wZXJ0eTxGb2N1cyB8IG51bGw+O1xyXG5cclxuICAvLyBDb250cm9scyB3aGV0aGVyIG9yIG5vdCBoaWdobGlnaHRzIHJlbGF0ZWQgdG8gUERPTSBmb2N1cyBhcmUgdmlzaWJsZS5cclxuICBwdWJsaWMgcmVhZG9ubHkgcGRvbUZvY3VzSGlnaGxpZ2h0c1Zpc2libGVQcm9wZXJ0eTogVFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyBDb250cm9scyB3aGV0aGVyIFwiSW50ZXJhY3RpdmUgSGlnaGxpZ2h0c1wiIGFyZSB2aXNpYmxlLlxyXG4gIHB1YmxpYyByZWFkb25seSBpbnRlcmFjdGl2ZUhpZ2hsaWdodHNWaXNpYmxlUHJvcGVydHk6IFRQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gQ29udHJvbHMgd2hldGhlciBcIlJlYWRpbmcgQmxvY2tcIiBoaWdobGlnaHRzIHdpbGwgYmUgdmlzaWJsZSBhcm91bmQgTm9kZXNcclxuICAvLyB0aGF0IHVzZSBSZWFkaW5nQmxvY2suXHJcbiAgcHVibGljIHJlYWRvbmx5IHJlYWRpbmdCbG9ja0hpZ2hsaWdodHNWaXNpYmxlUHJvcGVydHk6IFRQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gSW5kaWNhdGVzIHdoZXRoZXIgYW55IGhpZ2hsaWdodHMgc2hvdWxkIGFwcGVhciBmcm9tIHBvaW50ZXJcclxuICAvLyBpbnB1dCAobW91c2UvdG91Y2gpLiBJZiBmYWxzZSwgd2Ugd2lsbCB0cnkgdG8gYXZvaWQgZG9pbmcgZXhwZW5zaXZlIHdvcmsgaW4gUG9pbnRlckhpZ2hsaWdodGluZy5qcy5cclxuICBwdWJsaWMgcmVhZG9ubHkgcG9pbnRlckhpZ2hsaWdodHNWaXNpYmxlUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyBXaGVuZXZlciB0aGUgcmVhZGluZ0Jsb2NrRm9jdXNQcm9wZXJ0eSdzIEZvY3VzZWQgTm9kZSBpcyByZW1vdmVkIGZyb21cclxuICAvLyB0aGUgc2NlbmUgZ3JhcGggb3IgaXRzIFRyYWlsIGJlY29tZXMgaW52aXNpYmxlIHRoaXMgcmVtb3ZlcyBmb2N1cy5cclxuICBwcml2YXRlIHJlYWRvbmx5IHJlYWRpbmdCbG9ja0ZvY3VzQ29udHJvbGxlcjogRm9jdXNEaXNwbGF5ZWRDb250cm9sbGVyO1xyXG5cclxuICAvLyBJZiB0aGUgdm9pY2luZ01hbmFnZXIgc3RhcnRzIHNwZWFraW5nIGFuIFV0dGVyYW5jZSBmb3IgYSBSZWFkaW5nQkxvY2ssIHNldCB0aGUgcmVhZGluZ0Jsb2NrRm9jdXNQcm9wZXJ0eSBhbmRcclxuICAvLyBhZGQgbGlzdGVuZXJzIHRvIGNsZWFyIGl0IHdoZW4gdGhlIE5vZGUgaXMgcmVtb3ZlZCBvciBiZWNvbWVzIGludmlzaWJsZVxyXG4gIHByaXZhdGUgcmVhZG9ubHkgc3RhcnRTcGVha2luZ0xpc3RlbmVyOiBTcGVha2luZ0xpc3RlbmVyO1xyXG5cclxuICAvLyBXaGVuZXZlciB0aGUgdm9pY2luZ01hbmFnZXIgc3RvcHMgc3BlYWtpbmcgYW4gdXR0ZXJhbmNlIGZvciB0aGUgUmVhZGluZ0Jsb2NrIHRoYXQgaGFzIGZvY3VzLCBjbGVhciBpdFxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZW5kU3BlYWtpbmdMaXN0ZW5lcjogU3BlYWtpbmdMaXN0ZW5lcjtcclxuICBwcml2YXRlIHJlYWRvbmx5IHBvaW50ZXJGb2N1c0Rpc3BsYXllZENvbnRyb2xsZXI6IEZvY3VzRGlzcGxheWVkQ29udHJvbGxlcjtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSB2b2ljaW5nRnVsbHlFbmFibGVkTGlzdGVuZXI6ICggZW5hYmxlZDogYm9vbGVhbiApID0+IHZvaWQ7XHJcblxyXG4gIC8vIFJlZmVyZW5jZXMgdG8gdGhlIHdpbmRvdyBsaXN0ZW5lcnMgdGhhdCB1cGRhdGUgd2hlbiB0aGUgd2luZG93IGhhcyBmb2N1cy4gU28gdGhleSBjYW4gYmUgcmVtb3ZlZCBpZiBuZWVkZWQuXHJcbiAgcHJpdmF0ZSBzdGF0aWMgYXR0YWNoZWRXaW5kb3dGb2N1c0xpc3RlbmVyOiBudWxsIHwgKCAoKSA9PiB2b2lkICkgPSBudWxsO1xyXG4gIHByaXZhdGUgc3RhdGljIGF0dGFjaGVkV2luZG93Qmx1ckxpc3RlbmVyOiBudWxsIHwgKCAoKSA9PiB2b2lkICkgPSBudWxsO1xyXG4gIHByaXZhdGUgc3RhdGljIGdsb2JhbGx5QXR0YWNoZWQgPSBmYWxzZTtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5wb2ludGVyRm9jdXNQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggbnVsbCApO1xyXG4gICAgdGhpcy5yZWFkaW5nQmxvY2tGb2N1c1Byb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBudWxsICk7XHJcbiAgICB0aGlzLmxvY2tlZFBvaW50ZXJGb2N1c1Byb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBudWxsICk7XHJcbiAgICB0aGlzLnBkb21Gb2N1c0hpZ2hsaWdodHNWaXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlICk7XHJcbiAgICB0aGlzLmludGVyYWN0aXZlSGlnaGxpZ2h0c1Zpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlICk7XHJcbiAgICB0aGlzLnJlYWRpbmdCbG9ja0hpZ2hsaWdodHNWaXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG5cclxuICAgIC8vIFRPRE86IHBlcmhhcHMgcmVtb3ZlIG9uY2UgcmVhZGluZyBibG9ja3MgYXJlIHNldCB1cCB0byBsaXN0ZW4gaW5zdGVhZCB0byBOb2RlLmNhblNwZWFrUHJvcGVydHkgKHZvaWNpbmdWaXNpYmxlKSwgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnkvaXNzdWVzLzEzNDNcclxuICAgIHRoaXMudm9pY2luZ0Z1bGx5RW5hYmxlZExpc3RlbmVyID0gZW5hYmxlZCA9PiB7XHJcbiAgICAgIHRoaXMucmVhZGluZ0Jsb2NrSGlnaGxpZ2h0c1Zpc2libGVQcm9wZXJ0eS52YWx1ZSA9IGVuYWJsZWQ7XHJcbiAgICB9O1xyXG4gICAgdm9pY2luZ01hbmFnZXIudm9pY2luZ0Z1bGx5RW5hYmxlZFByb3BlcnR5LmxpbmsoIHRoaXMudm9pY2luZ0Z1bGx5RW5hYmxlZExpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5wb2ludGVySGlnaGxpZ2h0c1Zpc2libGVQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgdGhpcy5pbnRlcmFjdGl2ZUhpZ2hsaWdodHNWaXNpYmxlUHJvcGVydHksIHRoaXMucmVhZGluZ0Jsb2NrSGlnaGxpZ2h0c1Zpc2libGVQcm9wZXJ0eSBdLFxyXG4gICAgICAoIGludGVyYWN0aXZlSGlnaGxpZ2h0c1Zpc2libGUsIHZvaWNpbmdFbmFibGVkICkgPT4ge1xyXG4gICAgICAgIHJldHVybiBpbnRlcmFjdGl2ZUhpZ2hsaWdodHNWaXNpYmxlIHx8IHZvaWNpbmdFbmFibGVkO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgLy8gVGhlIGZvbGxvd2luZyBzZWN0aW9uIG1hbmFnZXMgY29udHJvbCBvZiBSZWFkaW5nQmxvY2tGb2N1c1Byb3BlcnR5LiBJdCB0YWtlcyBhIHZhbHVlIHdoZW5ldmVyIHRoZVxyXG4gICAgLy8gdm9pY2luZ01hbmFnZXIgc3RhcnRzIHNwZWFraW5nIGFuZCB0aGUgdmFsdWUgaXMgY2xlYXJlZCB3aGVuIGl0IHN0b3BzIHNwZWFraW5nLiBGb2N1cyBpcyBhbHNvIGNsZWFyZWRcclxuICAgIC8vIGJ5IHRoZSBGb2N1c0Rpc3BsYXllZENvbnRyb2xsZXIuXHJcblxyXG4gICAgdGhpcy5yZWFkaW5nQmxvY2tGb2N1c0NvbnRyb2xsZXIgPSBuZXcgRm9jdXNEaXNwbGF5ZWRDb250cm9sbGVyKCB0aGlzLnJlYWRpbmdCbG9ja0ZvY3VzUHJvcGVydHkgKTtcclxuXHJcbiAgICB0aGlzLnN0YXJ0U3BlYWtpbmdMaXN0ZW5lciA9ICggdGV4dCwgdXR0ZXJhbmNlICkgPT4ge1xyXG4gICAgICB0aGlzLnJlYWRpbmdCbG9ja0ZvY3VzUHJvcGVydHkudmFsdWUgPSB1dHRlcmFuY2UgaW5zdGFuY2VvZiBSZWFkaW5nQmxvY2tVdHRlcmFuY2UgPyB1dHRlcmFuY2UucmVhZGluZ0Jsb2NrRm9jdXMgOiBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBAdHMtZXhwZWN0LWVycm9yXHJcbiAgICB2b2ljaW5nTWFuYWdlci5zdGFydFNwZWFraW5nRW1pdHRlci5hZGRMaXN0ZW5lciggdGhpcy5zdGFydFNwZWFraW5nTGlzdGVuZXIgKTtcclxuXHJcbiAgICB0aGlzLmVuZFNwZWFraW5nTGlzdGVuZXIgPSAoIHRleHQsIHV0dGVyYW5jZSApID0+IHtcclxuICAgICAgaWYgKCB1dHRlcmFuY2UgaW5zdGFuY2VvZiBSZWFkaW5nQmxvY2tVdHRlcmFuY2UgJiYgdGhpcy5yZWFkaW5nQmxvY2tGb2N1c1Byb3BlcnR5LnZhbHVlICkge1xyXG5cclxuICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCB1dHRlcmFuY2UucmVhZGluZ0Jsb2NrRm9jdXMsICdzaG91bGQgYmUgbm9uIG51bGwgZm9jdXMnICk7XHJcblxyXG4gICAgICAgIC8vIG9ubHkgY2xlYXIgdGhlIHJlYWRpbmdCbG9ja0ZvY3VzUHJvcGVydHkgaWYgdGhlIFJlYWRpbmdCbG9ja1V0dGVyYW5jZSBoYXMgYSBGb2N1cyB0aGF0IG1hdGNoZXMgdGhlXHJcbiAgICAgICAgLy8gY3VycmVudCB2YWx1ZSBmb3IgcmVhZGluZ0Jsb2NrRm9jdXNQcm9wZXJ0eSBzbyB0aGF0IHRoZSBoaWdobGlnaHQgZG9lc24ndCBkaXNhcHBlYXIgZXZlcnkgdGltZVxyXG4gICAgICAgIC8vIHRoZSBzcGVha2VyIHN0b3BzIHRhbGtpbmdcclxuICAgICAgICBpZiAoIHV0dGVyYW5jZS5yZWFkaW5nQmxvY2tGb2N1cyEudHJhaWwuZXF1YWxzKCB0aGlzLnJlYWRpbmdCbG9ja0ZvY3VzUHJvcGVydHkudmFsdWUudHJhaWwgKSApIHtcclxuICAgICAgICAgIHRoaXMucmVhZGluZ0Jsb2NrRm9jdXNQcm9wZXJ0eS52YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcclxuICAgIHZvaWNpbmdNYW5hZ2VyLmVuZFNwZWFraW5nRW1pdHRlci5hZGRMaXN0ZW5lciggdGhpcy5lbmRTcGVha2luZ0xpc3RlbmVyICk7XHJcblxyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgLy8gVGhlIGZvbGxvd2luZyBzZWN0aW9uIG1hbmFnZXMgY29udHJvbCBvZiBwb2ludGVyRm9jdXNQcm9wZXJ0eSAtIHBvaW50ZXJGb2N1c1Byb3BlcnR5IGlzIHNldCB3aXRoIGEgRm9jdXNcclxuICAgIC8vIGJ5IEludGVyYWN0aXZlSGlnaGxpZ2h0aW5nIGZyb20gbGlzdGVuZXJzIG9uIE5vZGVzIHRoYXQgdXNlIHRoYXQgVHJhaXQuIEJ1dCBpdCB1c2VzIGEgRm9jdXNEaXNwbGF5ZWRDb250cm9sbGVyXHJcbiAgICAvLyB0byByZW1vdmUgdGhlIGZvY3VzIGF0IHRoZSByaWdodCB0aW1lLlxyXG5cclxuICAgIHRoaXMucG9pbnRlckZvY3VzRGlzcGxheWVkQ29udHJvbGxlciA9IG5ldyBGb2N1c0Rpc3BsYXllZENvbnRyb2xsZXIoIHRoaXMucG9pbnRlckZvY3VzUHJvcGVydHksIHtcclxuXHJcbiAgICAgIC8vIHdoZW5ldmVyIGZvY3VzIGlzIHJlbW92ZWQgYmVjYXVzZSB0aGUgbGFzdCBOb2RlIG9mIHRoZSBGb2N1cyBUcmFpbCBpcyBub1xyXG4gICAgICAvLyBsb25nZXIgZGlzcGxheWVkLCB0aGUgaGlnaGxpZ2h0IGZvciBQb2ludGVyIEZvY3VzIHNob3VsZCBubyBsb25nZXIgYmUgbG9ja2VkXHJcbiAgICAgIG9uUmVtb3ZlRm9jdXM6ICgpID0+IHtcclxuICAgICAgICB0aGlzLmxvY2tlZFBvaW50ZXJGb2N1c1Byb3BlcnR5LnZhbHVlID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLnJlYWRpbmdCbG9ja0ZvY3VzQ29udHJvbGxlci5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLnBvaW50ZXJGb2N1c0Rpc3BsYXllZENvbnRyb2xsZXIuZGlzcG9zZSgpO1xyXG4gICAgdGhpcy5wb2ludGVySGlnaGxpZ2h0c1Zpc2libGVQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcblxyXG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvclxyXG4gICAgdm9pY2luZ01hbmFnZXIuc3RhcnRTcGVha2luZ0VtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoIHRoaXMuc3RhcnRTcGVha2luZ0xpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvclxyXG4gICAgdm9pY2luZ01hbmFnZXIuZW5kU3BlYWtpbmdFbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCB0aGlzLmVuZFNwZWFraW5nTGlzdGVuZXIgKTtcclxuXHJcbiAgICB2b2ljaW5nTWFuYWdlci52b2ljaW5nRnVsbHlFbmFibGVkUHJvcGVydHkudW5saW5rKCB0aGlzLnZvaWNpbmdGdWxseUVuYWJsZWRMaXN0ZW5lciApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHRoZSBET00gZm9jdXMuIEEgRE9NIGxpbWl0YXRpb24gaXMgdGhhdCB0aGVyZSBjYW4gb25seSBiZSBvbmUgZWxlbWVudCB3aXRoIGZvY3VzIGF0IGEgdGltZSBzbyB0aGlzIG11c3RcclxuICAgKiBiZSBhIHN0YXRpYyBmb3IgdGhlIEZvY3VzTWFuYWdlci5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIHNldCBwZG9tRm9jdXMoIHZhbHVlOiBGb2N1cyB8IG51bGwgKSB7XHJcbiAgICBpZiAoIEZvY3VzTWFuYWdlci5wZG9tRm9jdXNQcm9wZXJ0eS52YWx1ZSAhPT0gdmFsdWUgKSB7XHJcblxyXG4gICAgICBsZXQgcHJldmlvdXNGb2N1cztcclxuICAgICAgaWYgKCBGb2N1c01hbmFnZXIucGRvbUZvY3VzUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgcHJldmlvdXNGb2N1cyA9IEZvY3VzTWFuYWdlci5wZG9tRm9jdXNlZE5vZGU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIEZvY3VzTWFuYWdlci5wZG9tRm9jdXNQcm9wZXJ0eS52YWx1ZSA9IHZhbHVlO1xyXG5cclxuICAgICAgLy8gaWYgc2V0IHRvIG51bGwsIG1ha2Ugc3VyZSB0aGF0IHRoZSBhY3RpdmUgZWxlbWVudCBpcyBubyBsb25nZXIgZm9jdXNlZFxyXG4gICAgICBpZiAoIHByZXZpb3VzRm9jdXMgJiYgIXZhbHVlICkge1xyXG4gICAgICAgIHByZXZpb3VzRm9jdXMuYmx1cigpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIEZvY3VzIHBvaW50aW5nIHRvIHRoZSBOb2RlIHdob3NlIFBhcmFsbGVsIERPTSBlbGVtZW50IGhhcyBET00gZm9jdXMuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBnZXQgcGRvbUZvY3VzKCk6IEZvY3VzIHwgbnVsbCB7XHJcbiAgICByZXR1cm4gRm9jdXNNYW5hZ2VyLnBkb21Gb2N1c1Byb3BlcnR5LnZhbHVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHRoZSBOb2RlIHRoYXQgY3VycmVudGx5IGhhcyBET00gZm9jdXMsIHRoZSBsZWFmLW1vc3QgTm9kZSBvZiB0aGUgRm9jdXMgVHJhaWwuIE51bGwgaWYgbm9cclxuICAgKiBOb2RlIGhhcyBmb2N1cy5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGdldFBET01Gb2N1c2VkTm9kZSgpOiBOb2RlIHwgbnVsbCB7XHJcbiAgICBsZXQgZm9jdXNlZE5vZGUgPSBudWxsO1xyXG4gICAgY29uc3QgZm9jdXMgPSBGb2N1c01hbmFnZXIucGRvbUZvY3VzUHJvcGVydHkuZ2V0KCk7XHJcbiAgICBpZiAoIGZvY3VzICkge1xyXG4gICAgICBmb2N1c2VkTm9kZSA9IGZvY3VzLnRyYWlsLmxhc3ROb2RlKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZm9jdXNlZE5vZGU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RhdGljIGdldCBwZG9tRm9jdXNlZE5vZGUoKTogTm9kZSB8IG51bGwgeyByZXR1cm4gdGhpcy5nZXRQRE9NRm9jdXNlZE5vZGUoKTsgfVxyXG5cclxuICAvLyBEaXNwbGF5IGhhcyBhbiBheG9uIGBQcm9wZXJ0eSB0byBpbmRpY2F0ZSB3aGljaCBjb21wb25lbnQgaXMgZm9jdXNlZCAob3IgbnVsbCBpZiBub1xyXG4gIC8vIHNjZW5lcnkgTm9kZSBoYXMgZm9jdXMpLiBCeSBwYXNzaW5nIHRoZSB0YW5kZW0gYW5kIHBoZXRpb1R5ZSwgUGhFVC1pTyBpcyBhYmxlIHRvIGludGVyb3BlcmF0ZSAoc2F2ZSwgcmVzdG9yZSxcclxuICAvLyBjb250cm9sLCBvYnNlcnZlIHdoYXQgaXMgY3VycmVudGx5IGZvY3VzZWQpLiBTZWUgRm9jdXNNYW5hZ2VyLnBkb21Gb2N1cyBmb3Igc2V0dGluZyB0aGUgZm9jdXMuIERvbid0IHNldCB0aGUgdmFsdWVcclxuICAvLyBvZiB0aGlzIFByb3BlcnR5IGRpcmVjdGx5LlxyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgcGRvbUZvY3VzUHJvcGVydHkgPSBuZXcgUHJvcGVydHk8Rm9jdXMgfCBudWxsPiggbnVsbCwge1xyXG4gICAgdGFuZGVtOiBUYW5kZW0uR0VORVJBTF9NT0RFTC5jcmVhdGVUYW5kZW0oICdwZG9tRm9jdXNQcm9wZXJ0eScgKSxcclxuICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdTdG9yZXMgdGhlIGN1cnJlbnQgZm9jdXMgaW4gdGhlIFBhcmFsbGVsIERPTSwgbnVsbCBpZiBub3RoaW5nIGhhcyBmb2N1cy4gVGhpcyBpcyBub3QgdXBkYXRlZCAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICdiYXNlZCBvbiBtb3VzZSBvciB0b3VjaCBpbnB1dCwgb25seSBrZXlib2FyZCBhbmQgb3RoZXIgYWx0ZXJuYXRpdmUgaW5wdXRzLiBOb3RlIHRoYXQgdGhpcyBvbmx5ICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgJ2FwcGxpZXMgdG8gc2ltdWxhdGlvbnMgdGhhdCBzdXBwb3J0IGFsdGVybmF0aXZlIGlucHV0LicsXHJcbiAgICBwaGV0aW9WYWx1ZVR5cGU6IE51bGxhYmxlSU8oIEZvY3VzLkZvY3VzSU8gKSxcclxuICAgIHBoZXRpb1N0YXRlOiBmYWxzZSxcclxuICAgIHBoZXRpb0ZlYXR1cmVkOiB0cnVlLFxyXG4gICAgcGhldGlvUmVhZE9ubHk6IHRydWVcclxuICB9ICk7XHJcblxyXG5cclxuICAvKipcclxuICAgKiBBIFByb3BlcnR5IHRoYXQgbGV0cyB5b3Uga25vdyB3aGVuIHRoZSB3aW5kb3cgaGFzIGZvY3VzLiBXaGVuIHRoZSB3aW5kb3cgaGFzIGZvY3VzLCBpdCBpcyBpbiB0aGUgdXNlcidzIGZvcmVncm91bmQuXHJcbiAgICogV2hlbiBpbiB0aGUgYmFja2dyb3VuZCwgdGhlIHdpbmRvdyBkb2VzIG5vdCByZWNlaXZlIGtleWJvYXJkIGlucHV0IChpbXBvcnRhbnQgZm9yIGdsb2JhbCBrZXlib2FyZCBldmVudHMpLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIF93aW5kb3dIYXNGb2N1c1Byb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuICBwdWJsaWMgc3RhdGljIHdpbmRvd0hhc0ZvY3VzUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+ID0gRm9jdXNNYW5hZ2VyLl93aW5kb3dIYXNGb2N1c1Byb3BlcnR5O1xyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHRoZSBfd2luZG93SGFzRm9jdXNQcm9wZXJ0eSB3aGVuIHRoZSB3aW5kb3cgcmVjZWl2ZXMvbG9zZXMgZm9jdXMuIFdoZW4gdGhlIHdpbmRvdyBoYXMgZm9jdXNcclxuICAgKiBpdCBpcyBpbiB0aGUgZm9yZWdyb3VuZCBvZiB0aGUgdXNlci4gV2hlbiBpbiB0aGUgYmFja2dyb3VuZCwgdGhlIHdpbmRvdyB3aWxsIG5vdCByZWNlaXZlIGtleWJvYXJkIGlucHV0LlxyXG4gICAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9XaW5kb3cvZm9jdXNfZXZlbnQuXHJcbiAgICpcclxuICAgKiBUaGlzIHdpbGwgYmUgY2FsbGVkIGJ5IHNjZW5lcnkgZm9yIHlvdSB3aGVuIHlvdSB1c2UgRGlzcGxheS5pbml0aWFsaXplRXZlbnRzKCkuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBhdHRhY2hUb1dpbmRvdygpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICFGb2N1c01hbmFnZXIuZ2xvYmFsbHlBdHRhY2hlZCwgJ0NhbiBvbmx5IGJlIGF0dGFjaGVkIHN0YXRpY2FsbHkgb25jZS4nICk7XHJcbiAgICBGb2N1c01hbmFnZXIuYXR0YWNoZWRXaW5kb3dGb2N1c0xpc3RlbmVyID0gKCkgPT4ge1xyXG4gICAgICBGb2N1c01hbmFnZXIuX3dpbmRvd0hhc0ZvY3VzUHJvcGVydHkudmFsdWUgPSB0cnVlO1xyXG4gICAgfTtcclxuXHJcbiAgICBGb2N1c01hbmFnZXIuYXR0YWNoZWRXaW5kb3dCbHVyTGlzdGVuZXIgPSAoKSA9PiB7XHJcbiAgICAgIEZvY3VzTWFuYWdlci5fd2luZG93SGFzRm9jdXNQcm9wZXJ0eS52YWx1ZSA9IGZhbHNlO1xyXG4gICAgfTtcclxuXHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggJ2ZvY3VzJywgRm9jdXNNYW5hZ2VyLmF0dGFjaGVkV2luZG93Rm9jdXNMaXN0ZW5lciApO1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICdibHVyJywgRm9jdXNNYW5hZ2VyLmF0dGFjaGVkV2luZG93Qmx1ckxpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gdmFsdWUgd2lsbCBiZSB1cGRhdGVkIHdpdGggd2luZG93LCBidXQgd2UgbmVlZCBhIHByb3BlciBpbml0aWFsIHZhbHVlICh0aGlzIGZ1bmN0aW9uIG1heSBiZSBjYWxsZWQgd2hpbGVcclxuICAgIC8vIHRoZSB3aW5kb3cgaXMgbm90IGluIHRoZSBmb3JlZ3JvdW5kKS5cclxuICAgIEZvY3VzTWFuYWdlci5fd2luZG93SGFzRm9jdXNQcm9wZXJ0eS52YWx1ZSA9IGRvY3VtZW50Lmhhc0ZvY3VzKCk7XHJcblxyXG4gICAgRm9jdXNNYW5hZ2VyLmdsb2JhbGx5QXR0YWNoZWQgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGV0YWNoIGFsbCB3aW5kb3cgZm9jdXMvYmx1ciBsaXN0ZW5lcnMgZnJvbSBGb2N1c01hbmFnZXIgd2F0Y2hpbmcgZm9yIHdoZW4gdGhlIHdpbmRvdyBsb3NlcyBmb2N1cy5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGRldGFjaEZyb21XaW5kb3coKTogdm9pZCB7XHJcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2ZvY3VzJywgRm9jdXNNYW5hZ2VyLmF0dGFjaGVkV2luZG93Rm9jdXNMaXN0ZW5lciEgKTtcclxuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCAnYmx1cicsIEZvY3VzTWFuYWdlci5hdHRhY2hlZFdpbmRvd0JsdXJMaXN0ZW5lciEgKTtcclxuXHJcbiAgICAvLyBGb3IgY2xlYW51cCwgdGhpcyBQcm9wZXJ0eSBiZWNvbWVzIGZhbHNlIGFnYWluIHdoZW4gZGV0YWNoaW5nIGJlY2F1c2Ugd2Ugd2lsbCBubyBsb25nZXIgYmUgd2F0Y2hpbmcgZm9yIGNoYW5nZXMuXHJcbiAgICBGb2N1c01hbmFnZXIuX3dpbmRvd0hhc0ZvY3VzUHJvcGVydHkudmFsdWUgPSBmYWxzZTtcclxuXHJcbiAgICBGb2N1c01hbmFnZXIuZ2xvYmFsbHlBdHRhY2hlZCA9IGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuc2NlbmVyeS5yZWdpc3RlciggJ0ZvY3VzTWFuYWdlcicsIEZvY3VzTWFuYWdlciApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0scUNBQXFDO0FBQ2pFLE9BQU9DLGVBQWUsTUFBTSxxQ0FBcUM7QUFHakUs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