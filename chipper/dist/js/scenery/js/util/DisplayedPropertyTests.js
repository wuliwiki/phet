// Copyright 2021-2022, University of Colorado Boulder

/**
 * DisplayedProperty Tests
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import Display from '../display/Display.js';
import Node from '../nodes/Node.js';
import DisplayedProperty from './DisplayedProperty.js';
QUnit.module('DisplayedProperty');
QUnit.test('basics', assert => {
  const rootNode = new Node();
  var display = new Display(rootNode); // eslint-disable-line no-var
  display.initializeEvents();
  document.body.appendChild(display.domElement);
  const aNode = new Node();
  const aDisplayedProperty = new DisplayedProperty(aNode);
  assert.ok(aDisplayedProperty.value === false, 'not connected, not displayed');
  rootNode.addChild(aNode);
  display.updateDisplay();
  assert.ok(aDisplayedProperty.value === true, 'connected, displayed');
  rootNode.visible = false;
  display.updateDisplay();
  assert.ok(aDisplayedProperty.value === false, 'connected, parent not visible, not displayed');
  aNode.visible = false;
  rootNode.visible = true;
  display.updateDisplay();
  assert.ok(aDisplayedProperty.value === false, 'connected, not visible, not displayed');
  aNode.visible = true;
  display.updateDisplay();
  assert.ok(aDisplayedProperty.value === true, 'back to visible, displayed');
  display.dispose();
  display.domElement.parentElement.removeChild(display.domElement);
});
QUnit.test('pdom visibility', assert => {
  const rootNode = new Node();
  var display = new Display(rootNode); // eslint-disable-line no-var
  display.initializeEvents();
  document.body.appendChild(display.domElement);
  const aNode = new Node({
    tagName: 'p'
  });
  const aDisplayedProperty = new DisplayedProperty(aNode);
  const aParent = new Node({
    children: [aNode]
  });
  rootNode.addChild(aParent);
  const pdomParentForA = new Node({
    tagName: 'div'
  });
  rootNode.addChild(pdomParentForA);
  pdomParentForA.pdomOrder = [aNode];
  display.updateDisplay();
  assert.ok(aDisplayedProperty.value === true, 'visible even with pdomOrder, displayed');
  aParent.visible = false;
  display.updateDisplay();

  // This test fails and @zepumph doesn't think it should! // TODO support pdom visibility, https://github.com/phetsims/scenery/issues/1167
  // assert.ok( aDisplayedProperty.value === true, 'pdomOrder makes it visible, displayed' );

  // Some more tests to run:

  // toggle instance visibility in the PDOM trail

  // swap pdom order and make sure DisplayedProperty updates

  display.dispose();
  display.domElement.parentElement.removeChild(display.domElement);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEaXNwbGF5IiwiTm9kZSIsIkRpc3BsYXllZFByb3BlcnR5IiwiUVVuaXQiLCJtb2R1bGUiLCJ0ZXN0IiwiYXNzZXJ0Iiwicm9vdE5vZGUiLCJkaXNwbGF5IiwiaW5pdGlhbGl6ZUV2ZW50cyIsImRvY3VtZW50IiwiYm9keSIsImFwcGVuZENoaWxkIiwiZG9tRWxlbWVudCIsImFOb2RlIiwiYURpc3BsYXllZFByb3BlcnR5Iiwib2siLCJ2YWx1ZSIsImFkZENoaWxkIiwidXBkYXRlRGlzcGxheSIsInZpc2libGUiLCJkaXNwb3NlIiwicGFyZW50RWxlbWVudCIsInJlbW92ZUNoaWxkIiwidGFnTmFtZSIsImFQYXJlbnQiLCJjaGlsZHJlbiIsInBkb21QYXJlbnRGb3JBIiwicGRvbU9yZGVyIl0sInNvdXJjZXMiOlsiRGlzcGxheWVkUHJvcGVydHlUZXN0cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBEaXNwbGF5ZWRQcm9wZXJ0eSBUZXN0c1xyXG4gKlxyXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IERpc3BsYXkgZnJvbSAnLi4vZGlzcGxheS9EaXNwbGF5LmpzJztcclxuaW1wb3J0IE5vZGUgZnJvbSAnLi4vbm9kZXMvTm9kZS5qcyc7XHJcbmltcG9ydCBEaXNwbGF5ZWRQcm9wZXJ0eSBmcm9tICcuL0Rpc3BsYXllZFByb3BlcnR5LmpzJztcclxuXHJcblFVbml0Lm1vZHVsZSggJ0Rpc3BsYXllZFByb3BlcnR5JyApO1xyXG5cclxuUVVuaXQudGVzdCggJ2Jhc2ljcycsIGFzc2VydCA9PiB7XHJcblxyXG4gIGNvbnN0IHJvb3ROb2RlID0gbmV3IE5vZGUoKTtcclxuICB2YXIgZGlzcGxheSA9IG5ldyBEaXNwbGF5KCByb290Tm9kZSApOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXZhclxyXG4gIGRpc3BsYXkuaW5pdGlhbGl6ZUV2ZW50cygpO1xyXG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoIGRpc3BsYXkuZG9tRWxlbWVudCApO1xyXG5cclxuICBjb25zdCBhTm9kZSA9IG5ldyBOb2RlKCk7XHJcbiAgY29uc3QgYURpc3BsYXllZFByb3BlcnR5ID0gbmV3IERpc3BsYXllZFByb3BlcnR5KCBhTm9kZSApO1xyXG4gIGFzc2VydC5vayggYURpc3BsYXllZFByb3BlcnR5LnZhbHVlID09PSBmYWxzZSwgJ25vdCBjb25uZWN0ZWQsIG5vdCBkaXNwbGF5ZWQnICk7XHJcblxyXG4gIHJvb3ROb2RlLmFkZENoaWxkKCBhTm9kZSApO1xyXG4gIGRpc3BsYXkudXBkYXRlRGlzcGxheSgpO1xyXG5cclxuICBhc3NlcnQub2soIGFEaXNwbGF5ZWRQcm9wZXJ0eS52YWx1ZSA9PT0gdHJ1ZSwgJ2Nvbm5lY3RlZCwgZGlzcGxheWVkJyApO1xyXG5cclxuICByb290Tm9kZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgZGlzcGxheS51cGRhdGVEaXNwbGF5KCk7XHJcblxyXG4gIGFzc2VydC5vayggYURpc3BsYXllZFByb3BlcnR5LnZhbHVlID09PSBmYWxzZSwgJ2Nvbm5lY3RlZCwgcGFyZW50IG5vdCB2aXNpYmxlLCBub3QgZGlzcGxheWVkJyApO1xyXG5cclxuICBhTm9kZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgcm9vdE5vZGUudmlzaWJsZSA9IHRydWU7XHJcbiAgZGlzcGxheS51cGRhdGVEaXNwbGF5KCk7XHJcblxyXG4gIGFzc2VydC5vayggYURpc3BsYXllZFByb3BlcnR5LnZhbHVlID09PSBmYWxzZSwgJ2Nvbm5lY3RlZCwgbm90IHZpc2libGUsIG5vdCBkaXNwbGF5ZWQnICk7XHJcblxyXG4gIGFOb2RlLnZpc2libGUgPSB0cnVlO1xyXG4gIGRpc3BsYXkudXBkYXRlRGlzcGxheSgpO1xyXG5cclxuICBhc3NlcnQub2soIGFEaXNwbGF5ZWRQcm9wZXJ0eS52YWx1ZSA9PT0gdHJ1ZSwgJ2JhY2sgdG8gdmlzaWJsZSwgZGlzcGxheWVkJyApO1xyXG5cclxuICBkaXNwbGF5LmRpc3Bvc2UoKTtcclxuICBkaXNwbGF5LmRvbUVsZW1lbnQucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZCggZGlzcGxheS5kb21FbGVtZW50ICk7XHJcbn0gKTtcclxuXHJcblxyXG5RVW5pdC50ZXN0KCAncGRvbSB2aXNpYmlsaXR5JywgYXNzZXJ0ID0+IHtcclxuXHJcbiAgY29uc3Qgcm9vdE5vZGUgPSBuZXcgTm9kZSgpO1xyXG4gIHZhciBkaXNwbGF5ID0gbmV3IERpc3BsYXkoIHJvb3ROb2RlICk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdmFyXHJcbiAgZGlzcGxheS5pbml0aWFsaXplRXZlbnRzKCk7XHJcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCggZGlzcGxheS5kb21FbGVtZW50ICk7XHJcblxyXG4gIGNvbnN0IGFOb2RlID0gbmV3IE5vZGUoIHsgdGFnTmFtZTogJ3AnIH0gKTtcclxuICBjb25zdCBhRGlzcGxheWVkUHJvcGVydHkgPSBuZXcgRGlzcGxheWVkUHJvcGVydHkoIGFOb2RlICk7XHJcblxyXG4gIGNvbnN0IGFQYXJlbnQgPSBuZXcgTm9kZSggeyBjaGlsZHJlbjogWyBhTm9kZSBdIH0gKTtcclxuICByb290Tm9kZS5hZGRDaGlsZCggYVBhcmVudCApO1xyXG5cclxuICBjb25zdCBwZG9tUGFyZW50Rm9yQSA9IG5ldyBOb2RlKCB7IHRhZ05hbWU6ICdkaXYnIH0gKTtcclxuICByb290Tm9kZS5hZGRDaGlsZCggcGRvbVBhcmVudEZvckEgKTtcclxuXHJcbiAgcGRvbVBhcmVudEZvckEucGRvbU9yZGVyID0gWyBhTm9kZSBdO1xyXG4gIGRpc3BsYXkudXBkYXRlRGlzcGxheSgpO1xyXG5cclxuICBhc3NlcnQub2soIGFEaXNwbGF5ZWRQcm9wZXJ0eS52YWx1ZSA9PT0gdHJ1ZSwgJ3Zpc2libGUgZXZlbiB3aXRoIHBkb21PcmRlciwgZGlzcGxheWVkJyApO1xyXG5cclxuICBhUGFyZW50LnZpc2libGUgPSBmYWxzZTtcclxuICBkaXNwbGF5LnVwZGF0ZURpc3BsYXkoKTtcclxuXHJcblxyXG4gIC8vIFRoaXMgdGVzdCBmYWlscyBhbmQgQHplcHVtcGggZG9lc24ndCB0aGluayBpdCBzaG91bGQhIC8vIFRPRE8gc3VwcG9ydCBwZG9tIHZpc2liaWxpdHksIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zY2VuZXJ5L2lzc3Vlcy8xMTY3XHJcbiAgLy8gYXNzZXJ0Lm9rKCBhRGlzcGxheWVkUHJvcGVydHkudmFsdWUgPT09IHRydWUsICdwZG9tT3JkZXIgbWFrZXMgaXQgdmlzaWJsZSwgZGlzcGxheWVkJyApO1xyXG5cclxuXHJcbiAgLy8gU29tZSBtb3JlIHRlc3RzIHRvIHJ1bjpcclxuXHJcbiAgLy8gdG9nZ2xlIGluc3RhbmNlIHZpc2liaWxpdHkgaW4gdGhlIFBET00gdHJhaWxcclxuXHJcbiAgLy8gc3dhcCBwZG9tIG9yZGVyIGFuZCBtYWtlIHN1cmUgRGlzcGxheWVkUHJvcGVydHkgdXBkYXRlc1xyXG5cclxuICBkaXNwbGF5LmRpc3Bvc2UoKTtcclxuICBkaXNwbGF5LmRvbUVsZW1lbnQucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZCggZGlzcGxheS5kb21FbGVtZW50ICk7XHJcbn0gKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsT0FBTyxNQUFNLHVCQUF1QjtBQUMzQyxPQUFPQyxJQUFJLE1BQU0sa0JBQWtCO0FBQ25DLE9BQU9DLGlCQUFpQixNQUFNLHdCQUF3QjtBQUV0REMsS0FBSyxDQUFDQyxNQUFNLENBQUUsbUJBQW9CLENBQUM7QUFFbkNELEtBQUssQ0FBQ0UsSUFBSSxDQUFFLFFBQVEsRUFBRUMsTUFBTSxJQUFJO0VBRTlCLE1BQU1DLFFBQVEsR0FBRyxJQUFJTixJQUFJLENBQUMsQ0FBQztFQUMzQixJQUFJTyxPQUFPLEdBQUcsSUFBSVIsT0FBTyxDQUFFTyxRQUFTLENBQUMsQ0FBQyxDQUFDO0VBQ3ZDQyxPQUFPLENBQUNDLGdCQUFnQixDQUFDLENBQUM7RUFDMUJDLFFBQVEsQ0FBQ0MsSUFBSSxDQUFDQyxXQUFXLENBQUVKLE9BQU8sQ0FBQ0ssVUFBVyxDQUFDO0VBRS9DLE1BQU1DLEtBQUssR0FBRyxJQUFJYixJQUFJLENBQUMsQ0FBQztFQUN4QixNQUFNYyxrQkFBa0IsR0FBRyxJQUFJYixpQkFBaUIsQ0FBRVksS0FBTSxDQUFDO0VBQ3pEUixNQUFNLENBQUNVLEVBQUUsQ0FBRUQsa0JBQWtCLENBQUNFLEtBQUssS0FBSyxLQUFLLEVBQUUsOEJBQStCLENBQUM7RUFFL0VWLFFBQVEsQ0FBQ1csUUFBUSxDQUFFSixLQUFNLENBQUM7RUFDMUJOLE9BQU8sQ0FBQ1csYUFBYSxDQUFDLENBQUM7RUFFdkJiLE1BQU0sQ0FBQ1UsRUFBRSxDQUFFRCxrQkFBa0IsQ0FBQ0UsS0FBSyxLQUFLLElBQUksRUFBRSxzQkFBdUIsQ0FBQztFQUV0RVYsUUFBUSxDQUFDYSxPQUFPLEdBQUcsS0FBSztFQUN4QlosT0FBTyxDQUFDVyxhQUFhLENBQUMsQ0FBQztFQUV2QmIsTUFBTSxDQUFDVSxFQUFFLENBQUVELGtCQUFrQixDQUFDRSxLQUFLLEtBQUssS0FBSyxFQUFFLDhDQUErQyxDQUFDO0VBRS9GSCxLQUFLLENBQUNNLE9BQU8sR0FBRyxLQUFLO0VBQ3JCYixRQUFRLENBQUNhLE9BQU8sR0FBRyxJQUFJO0VBQ3ZCWixPQUFPLENBQUNXLGFBQWEsQ0FBQyxDQUFDO0VBRXZCYixNQUFNLENBQUNVLEVBQUUsQ0FBRUQsa0JBQWtCLENBQUNFLEtBQUssS0FBSyxLQUFLLEVBQUUsdUNBQXdDLENBQUM7RUFFeEZILEtBQUssQ0FBQ00sT0FBTyxHQUFHLElBQUk7RUFDcEJaLE9BQU8sQ0FBQ1csYUFBYSxDQUFDLENBQUM7RUFFdkJiLE1BQU0sQ0FBQ1UsRUFBRSxDQUFFRCxrQkFBa0IsQ0FBQ0UsS0FBSyxLQUFLLElBQUksRUFBRSw0QkFBNkIsQ0FBQztFQUU1RVQsT0FBTyxDQUFDYSxPQUFPLENBQUMsQ0FBQztFQUNqQmIsT0FBTyxDQUFDSyxVQUFVLENBQUNTLGFBQWEsQ0FBQ0MsV0FBVyxDQUFFZixPQUFPLENBQUNLLFVBQVcsQ0FBQztBQUNwRSxDQUFFLENBQUM7QUFHSFYsS0FBSyxDQUFDRSxJQUFJLENBQUUsaUJBQWlCLEVBQUVDLE1BQU0sSUFBSTtFQUV2QyxNQUFNQyxRQUFRLEdBQUcsSUFBSU4sSUFBSSxDQUFDLENBQUM7RUFDM0IsSUFBSU8sT0FBTyxHQUFHLElBQUlSLE9BQU8sQ0FBRU8sUUFBUyxDQUFDLENBQUMsQ0FBQztFQUN2Q0MsT0FBTyxDQUFDQyxnQkFBZ0IsQ0FBQyxDQUFDO0VBQzFCQyxRQUFRLENBQUNDLElBQUksQ0FBQ0MsV0FBVyxDQUFFSixPQUFPLENBQUNLLFVBQVcsQ0FBQztFQUUvQyxNQUFNQyxLQUFLLEdBQUcsSUFBSWIsSUFBSSxDQUFFO0lBQUV1QixPQUFPLEVBQUU7RUFBSSxDQUFFLENBQUM7RUFDMUMsTUFBTVQsa0JBQWtCLEdBQUcsSUFBSWIsaUJBQWlCLENBQUVZLEtBQU0sQ0FBQztFQUV6RCxNQUFNVyxPQUFPLEdBQUcsSUFBSXhCLElBQUksQ0FBRTtJQUFFeUIsUUFBUSxFQUFFLENBQUVaLEtBQUs7RUFBRyxDQUFFLENBQUM7RUFDbkRQLFFBQVEsQ0FBQ1csUUFBUSxDQUFFTyxPQUFRLENBQUM7RUFFNUIsTUFBTUUsY0FBYyxHQUFHLElBQUkxQixJQUFJLENBQUU7SUFBRXVCLE9BQU8sRUFBRTtFQUFNLENBQUUsQ0FBQztFQUNyRGpCLFFBQVEsQ0FBQ1csUUFBUSxDQUFFUyxjQUFlLENBQUM7RUFFbkNBLGNBQWMsQ0FBQ0MsU0FBUyxHQUFHLENBQUVkLEtBQUssQ0FBRTtFQUNwQ04sT0FBTyxDQUFDVyxhQUFhLENBQUMsQ0FBQztFQUV2QmIsTUFBTSxDQUFDVSxFQUFFLENBQUVELGtCQUFrQixDQUFDRSxLQUFLLEtBQUssSUFBSSxFQUFFLHdDQUF5QyxDQUFDO0VBRXhGUSxPQUFPLENBQUNMLE9BQU8sR0FBRyxLQUFLO0VBQ3ZCWixPQUFPLENBQUNXLGFBQWEsQ0FBQyxDQUFDOztFQUd2QjtFQUNBOztFQUdBOztFQUVBOztFQUVBOztFQUVBWCxPQUFPLENBQUNhLE9BQU8sQ0FBQyxDQUFDO0VBQ2pCYixPQUFPLENBQUNLLFVBQVUsQ0FBQ1MsYUFBYSxDQUFDQyxXQUFXLENBQUVmLE9BQU8sQ0FBQ0ssVUFBVyxDQUFDO0FBQ3BFLENBQUUsQ0FBQyJ9