// Copyright 2013-2022, University of Colorado Boulder

/**
 * Abstract base type for LinearGradient and RadialGradient.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import ReadOnlyProperty from '../../../axon/js/ReadOnlyProperty.js';
import cleanArray from '../../../phet-core/js/cleanArray.js';
import { Color, Paint, scenery } from '../imports.js';
export default class Gradient extends Paint {
  // (scenery-internal)

  // lazily created
  // Whether we should force a check of whether stops have changed
  // Used to check to see if colors have changed since last time
  /**
   * TODO: add the ability to specify the color-stops inline. possibly [ [0,color1], [0.5,color2], [1,color3] ]
   */
  constructor() {
    super();
    assert && assert(this.constructor.name !== 'Gradient', 'Please create a LinearGradient or RadialGradient. Do not directly use the supertype Gradient.');
    this.stops = [];
    this.lastStopRatio = 0;
    this.canvasGradient = null;
    this.colorStopsDirty = false;
    this.lastColorStopValues = [];
  }

  /**
   * Adds a color stop to the gradient.
   *
   * Color stops should be added in order (monotonically increasing ratio values).
   *
   * NOTE: Color stops should only be added before using the gradient as a fill/stroke. Adding stops afterwards
   *       will result in undefined behavior.
   * TODO: Catch attempts to do the above.
   *
   * @param ratio - Monotonically increasing value in the range of 0 to 1
   * @param color
   * @returns - for chaining
   */
  addColorStop(ratio, color) {
    assert && assert(ratio >= 0 && ratio <= 1, 'Ratio needs to be between 0,1 inclusively');
    assert && assert(color === null || typeof color === 'string' || color instanceof Color || color instanceof ReadOnlyProperty && (color.value === null || typeof color.value === 'string' || color.value instanceof Color), 'Color should match the addColorStop type specification');
    if (this.lastStopRatio > ratio) {
      // fail out, since browser quirks go crazy for this case
      throw new Error('Color stops not specified in the order of increasing ratios');
    } else {
      this.lastStopRatio = ratio;
    }
    this.stops.push({
      ratio: ratio,
      color: color
    });

    // Easiest to just push a value here, so that it is always the same length as the stops array.
    this.lastColorStopValues.push('');
    return this;
  }

  /**
   * Subtypes should return a fresh CanvasGradient type.
   */

  /**
   * Returns stops suitable for direct SVG use.
   */
  getSVGStops() {
    return this.stops;
  }

  /**
   * Forces a re-check of whether colors have changed, so that the Canvas gradient can be regenerated if
   * necessary.
   */
  invalidateCanvasGradient() {
    sceneryLog && sceneryLog.Paints && sceneryLog.Paints(`Invalidated Canvas Gradient for #${this.id}`);
    this.colorStopsDirty = true;
  }

  /**
   * Compares the current color values with the last-recorded values for the current Canvas gradient.
   *
   * This is needed since the values of color properties (or the color itself) may change.
   */
  haveCanvasColorStopsChanged() {
    if (this.lastColorStopValues === null) {
      return true;
    }
    for (let i = 0; i < this.stops.length; i++) {
      if (Gradient.colorToString(this.stops[i].color) !== this.lastColorStopValues[i]) {
        return true;
      }
    }
    return false;
  }

  /**
   * Returns an object that can be passed to a Canvas context's fillStyle or strokeStyle.
   */
  getCanvasStyle() {
    // Check if we need to regenerate the Canvas gradient
    if (!this.canvasGradient || this.colorStopsDirty && this.haveCanvasColorStopsChanged()) {
      sceneryLog && sceneryLog.Paints && sceneryLog.Paints(`Regenerating Canvas Gradient for #${this.id}`);
      sceneryLog && sceneryLog.Paints && sceneryLog.push();
      this.colorStopsDirty = false;
      cleanArray(this.lastColorStopValues);
      this.canvasGradient = this.createCanvasGradient();
      for (let i = 0; i < this.stops.length; i++) {
        const stop = this.stops[i];
        const colorString = Gradient.colorToString(stop.color);
        this.canvasGradient.addColorStop(stop.ratio, colorString);

        // Save it so we can compare next time whether our generated gradient would have changed
        this.lastColorStopValues.push(colorString);
      }
      sceneryLog && sceneryLog.Paints && sceneryLog.pop();
    }
    return this.canvasGradient;
  }

  /**
   * Returns the current value of the generally-allowed color types for Gradient, as a string.
   */
  static colorToString(color) {
    // to {Color|string|null}
    if (color instanceof ReadOnlyProperty) {
      color = color.value;
    }

    // to {Color|string}
    if (color === null) {
      color = 'transparent';
    }

    // to {string}
    if (color instanceof Color) {
      color = color.toCSS();
    }
    return color;
  }
}
Gradient.prototype.isGradient = true;
scenery.register('Gradient', Gradient);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSZWFkT25seVByb3BlcnR5IiwiY2xlYW5BcnJheSIsIkNvbG9yIiwiUGFpbnQiLCJzY2VuZXJ5IiwiR3JhZGllbnQiLCJjb25zdHJ1Y3RvciIsImFzc2VydCIsIm5hbWUiLCJzdG9wcyIsImxhc3RTdG9wUmF0aW8iLCJjYW52YXNHcmFkaWVudCIsImNvbG9yU3RvcHNEaXJ0eSIsImxhc3RDb2xvclN0b3BWYWx1ZXMiLCJhZGRDb2xvclN0b3AiLCJyYXRpbyIsImNvbG9yIiwidmFsdWUiLCJFcnJvciIsInB1c2giLCJnZXRTVkdTdG9wcyIsImludmFsaWRhdGVDYW52YXNHcmFkaWVudCIsInNjZW5lcnlMb2ciLCJQYWludHMiLCJpZCIsImhhdmVDYW52YXNDb2xvclN0b3BzQ2hhbmdlZCIsImkiLCJsZW5ndGgiLCJjb2xvclRvU3RyaW5nIiwiZ2V0Q2FudmFzU3R5bGUiLCJjcmVhdGVDYW52YXNHcmFkaWVudCIsInN0b3AiLCJjb2xvclN0cmluZyIsInBvcCIsInRvQ1NTIiwicHJvdG90eXBlIiwiaXNHcmFkaWVudCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiR3JhZGllbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQWJzdHJhY3QgYmFzZSB0eXBlIGZvciBMaW5lYXJHcmFkaWVudCBhbmQgUmFkaWFsR3JhZGllbnQuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1JlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgY2xlYW5BcnJheSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvY2xlYW5BcnJheS5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBUQ29sb3IsIFBhaW50LCBzY2VuZXJ5IH0gZnJvbSAnLi4vaW1wb3J0cy5qcyc7XHJcblxyXG5leHBvcnQgdHlwZSBHcmFkaWVudFN0b3AgPSB7XHJcbiAgcmF0aW86IG51bWJlcjtcclxuICBjb2xvcjogVENvbG9yO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYWJzdHJhY3QgY2xhc3MgR3JhZGllbnQgZXh0ZW5kcyBQYWludCB7XHJcblxyXG4gIHB1YmxpYyBzdG9wczogR3JhZGllbnRTdG9wW107IC8vIChzY2VuZXJ5LWludGVybmFsKVxyXG4gIHByaXZhdGUgbGFzdFN0b3BSYXRpbzogbnVtYmVyO1xyXG4gIHByaXZhdGUgY2FudmFzR3JhZGllbnQ6IENhbnZhc0dyYWRpZW50IHwgbnVsbDsgLy8gbGF6aWx5IGNyZWF0ZWRcclxuXHJcbiAgLy8gV2hldGhlciB3ZSBzaG91bGQgZm9yY2UgYSBjaGVjayBvZiB3aGV0aGVyIHN0b3BzIGhhdmUgY2hhbmdlZFxyXG4gIHByaXZhdGUgY29sb3JTdG9wc0RpcnR5OiBib29sZWFuO1xyXG5cclxuICAvLyBVc2VkIHRvIGNoZWNrIHRvIHNlZSBpZiBjb2xvcnMgaGF2ZSBjaGFuZ2VkIHNpbmNlIGxhc3QgdGltZVxyXG4gIHByaXZhdGUgbGFzdENvbG9yU3RvcFZhbHVlczogc3RyaW5nW107XHJcblxyXG4gIC8qKlxyXG4gICAqIFRPRE86IGFkZCB0aGUgYWJpbGl0eSB0byBzcGVjaWZ5IHRoZSBjb2xvci1zdG9wcyBpbmxpbmUuIHBvc3NpYmx5IFsgWzAsY29sb3IxXSwgWzAuNSxjb2xvcjJdLCBbMSxjb2xvcjNdIF1cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuY29uc3RydWN0b3IubmFtZSAhPT0gJ0dyYWRpZW50JyxcclxuICAgICAgJ1BsZWFzZSBjcmVhdGUgYSBMaW5lYXJHcmFkaWVudCBvciBSYWRpYWxHcmFkaWVudC4gRG8gbm90IGRpcmVjdGx5IHVzZSB0aGUgc3VwZXJ0eXBlIEdyYWRpZW50LicgKTtcclxuXHJcbiAgICB0aGlzLnN0b3BzID0gW107XHJcbiAgICB0aGlzLmxhc3RTdG9wUmF0aW8gPSAwO1xyXG4gICAgdGhpcy5jYW52YXNHcmFkaWVudCA9IG51bGw7XHJcbiAgICB0aGlzLmNvbG9yU3RvcHNEaXJ0eSA9IGZhbHNlO1xyXG4gICAgdGhpcy5sYXN0Q29sb3JTdG9wVmFsdWVzID0gW107XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogQWRkcyBhIGNvbG9yIHN0b3AgdG8gdGhlIGdyYWRpZW50LlxyXG4gICAqXHJcbiAgICogQ29sb3Igc3RvcHMgc2hvdWxkIGJlIGFkZGVkIGluIG9yZGVyIChtb25vdG9uaWNhbGx5IGluY3JlYXNpbmcgcmF0aW8gdmFsdWVzKS5cclxuICAgKlxyXG4gICAqIE5PVEU6IENvbG9yIHN0b3BzIHNob3VsZCBvbmx5IGJlIGFkZGVkIGJlZm9yZSB1c2luZyB0aGUgZ3JhZGllbnQgYXMgYSBmaWxsL3N0cm9rZS4gQWRkaW5nIHN0b3BzIGFmdGVyd2FyZHNcclxuICAgKiAgICAgICB3aWxsIHJlc3VsdCBpbiB1bmRlZmluZWQgYmVoYXZpb3IuXHJcbiAgICogVE9ETzogQ2F0Y2ggYXR0ZW1wdHMgdG8gZG8gdGhlIGFib3ZlLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHJhdGlvIC0gTW9ub3RvbmljYWxseSBpbmNyZWFzaW5nIHZhbHVlIGluIHRoZSByYW5nZSBvZiAwIHRvIDFcclxuICAgKiBAcGFyYW0gY29sb3JcclxuICAgKiBAcmV0dXJucyAtIGZvciBjaGFpbmluZ1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRDb2xvclN0b3AoIHJhdGlvOiBudW1iZXIsIGNvbG9yOiBUQ29sb3IgKTogdGhpcyB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCByYXRpbyA+PSAwICYmIHJhdGlvIDw9IDEsICdSYXRpbyBuZWVkcyB0byBiZSBiZXR3ZWVuIDAsMSBpbmNsdXNpdmVseScgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbG9yID09PSBudWxsIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgY29sb3IgPT09ICdzdHJpbmcnIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICBjb2xvciBpbnN0YW5jZW9mIENvbG9yIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAoIGNvbG9yIGluc3RhbmNlb2YgUmVhZE9ubHlQcm9wZXJ0eSAmJiAoIGNvbG9yLnZhbHVlID09PSBudWxsIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBjb2xvci52YWx1ZSA9PT0gJ3N0cmluZycgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IudmFsdWUgaW5zdGFuY2VvZiBDb2xvciApICksXHJcbiAgICAgICdDb2xvciBzaG91bGQgbWF0Y2ggdGhlIGFkZENvbG9yU3RvcCB0eXBlIHNwZWNpZmljYXRpb24nICk7XHJcblxyXG4gICAgaWYgKCB0aGlzLmxhc3RTdG9wUmF0aW8gPiByYXRpbyApIHtcclxuICAgICAgLy8gZmFpbCBvdXQsIHNpbmNlIGJyb3dzZXIgcXVpcmtzIGdvIGNyYXp5IGZvciB0aGlzIGNhc2VcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCAnQ29sb3Igc3RvcHMgbm90IHNwZWNpZmllZCBpbiB0aGUgb3JkZXIgb2YgaW5jcmVhc2luZyByYXRpb3MnICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5sYXN0U3RvcFJhdGlvID0gcmF0aW87XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zdG9wcy5wdXNoKCB7XHJcbiAgICAgIHJhdGlvOiByYXRpbyxcclxuICAgICAgY29sb3I6IGNvbG9yXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gRWFzaWVzdCB0byBqdXN0IHB1c2ggYSB2YWx1ZSBoZXJlLCBzbyB0aGF0IGl0IGlzIGFsd2F5cyB0aGUgc2FtZSBsZW5ndGggYXMgdGhlIHN0b3BzIGFycmF5LlxyXG4gICAgdGhpcy5sYXN0Q29sb3JTdG9wVmFsdWVzLnB1c2goICcnICk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdWJ0eXBlcyBzaG91bGQgcmV0dXJuIGEgZnJlc2ggQ2FudmFzR3JhZGllbnQgdHlwZS5cclxuICAgKi9cclxuICBwdWJsaWMgYWJzdHJhY3QgY3JlYXRlQ2FudmFzR3JhZGllbnQoKTogQ2FudmFzR3JhZGllbnQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgc3RvcHMgc3VpdGFibGUgZm9yIGRpcmVjdCBTVkcgdXNlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRTVkdTdG9wcygpOiBHcmFkaWVudFN0b3BbXSB7XHJcbiAgICByZXR1cm4gdGhpcy5zdG9wcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZvcmNlcyBhIHJlLWNoZWNrIG9mIHdoZXRoZXIgY29sb3JzIGhhdmUgY2hhbmdlZCwgc28gdGhhdCB0aGUgQ2FudmFzIGdyYWRpZW50IGNhbiBiZSByZWdlbmVyYXRlZCBpZlxyXG4gICAqIG5lY2Vzc2FyeS5cclxuICAgKi9cclxuICBwdWJsaWMgaW52YWxpZGF0ZUNhbnZhc0dyYWRpZW50KCk6IHZvaWQge1xyXG4gICAgc2NlbmVyeUxvZyAmJiBzY2VuZXJ5TG9nLlBhaW50cyAmJiBzY2VuZXJ5TG9nLlBhaW50cyggYEludmFsaWRhdGVkIENhbnZhcyBHcmFkaWVudCBmb3IgIyR7dGhpcy5pZH1gICk7XHJcbiAgICB0aGlzLmNvbG9yU3RvcHNEaXJ0eSA9IHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb21wYXJlcyB0aGUgY3VycmVudCBjb2xvciB2YWx1ZXMgd2l0aCB0aGUgbGFzdC1yZWNvcmRlZCB2YWx1ZXMgZm9yIHRoZSBjdXJyZW50IENhbnZhcyBncmFkaWVudC5cclxuICAgKlxyXG4gICAqIFRoaXMgaXMgbmVlZGVkIHNpbmNlIHRoZSB2YWx1ZXMgb2YgY29sb3IgcHJvcGVydGllcyAob3IgdGhlIGNvbG9yIGl0c2VsZikgbWF5IGNoYW5nZS5cclxuICAgKi9cclxuICBwcml2YXRlIGhhdmVDYW52YXNDb2xvclN0b3BzQ2hhbmdlZCgpOiBib29sZWFuIHtcclxuICAgIGlmICggdGhpcy5sYXN0Q29sb3JTdG9wVmFsdWVzID09PSBudWxsICkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLnN0b3BzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBpZiAoIEdyYWRpZW50LmNvbG9yVG9TdHJpbmcoIHRoaXMuc3RvcHNbIGkgXS5jb2xvciApICE9PSB0aGlzLmxhc3RDb2xvclN0b3BWYWx1ZXNbIGkgXSApIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgYW4gb2JqZWN0IHRoYXQgY2FuIGJlIHBhc3NlZCB0byBhIENhbnZhcyBjb250ZXh0J3MgZmlsbFN0eWxlIG9yIHN0cm9rZVN0eWxlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRDYW52YXNTdHlsZSgpOiBDYW52YXNHcmFkaWVudCB7XHJcbiAgICAvLyBDaGVjayBpZiB3ZSBuZWVkIHRvIHJlZ2VuZXJhdGUgdGhlIENhbnZhcyBncmFkaWVudFxyXG4gICAgaWYgKCAhdGhpcy5jYW52YXNHcmFkaWVudCB8fCAoIHRoaXMuY29sb3JTdG9wc0RpcnR5ICYmIHRoaXMuaGF2ZUNhbnZhc0NvbG9yU3RvcHNDaGFuZ2VkKCkgKSApIHtcclxuICAgICAgc2NlbmVyeUxvZyAmJiBzY2VuZXJ5TG9nLlBhaW50cyAmJiBzY2VuZXJ5TG9nLlBhaW50cyggYFJlZ2VuZXJhdGluZyBDYW52YXMgR3JhZGllbnQgZm9yICMke3RoaXMuaWR9YCApO1xyXG4gICAgICBzY2VuZXJ5TG9nICYmIHNjZW5lcnlMb2cuUGFpbnRzICYmIHNjZW5lcnlMb2cucHVzaCgpO1xyXG5cclxuICAgICAgdGhpcy5jb2xvclN0b3BzRGlydHkgPSBmYWxzZTtcclxuXHJcbiAgICAgIGNsZWFuQXJyYXkoIHRoaXMubGFzdENvbG9yU3RvcFZhbHVlcyApO1xyXG4gICAgICB0aGlzLmNhbnZhc0dyYWRpZW50ID0gdGhpcy5jcmVhdGVDYW52YXNHcmFkaWVudCgpO1xyXG5cclxuICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5zdG9wcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICBjb25zdCBzdG9wID0gdGhpcy5zdG9wc1sgaSBdO1xyXG5cclxuICAgICAgICBjb25zdCBjb2xvclN0cmluZyA9IEdyYWRpZW50LmNvbG9yVG9TdHJpbmcoIHN0b3AuY29sb3IgKTtcclxuICAgICAgICB0aGlzLmNhbnZhc0dyYWRpZW50LmFkZENvbG9yU3RvcCggc3RvcC5yYXRpbywgY29sb3JTdHJpbmcgKTtcclxuXHJcbiAgICAgICAgLy8gU2F2ZSBpdCBzbyB3ZSBjYW4gY29tcGFyZSBuZXh0IHRpbWUgd2hldGhlciBvdXIgZ2VuZXJhdGVkIGdyYWRpZW50IHdvdWxkIGhhdmUgY2hhbmdlZFxyXG4gICAgICAgIHRoaXMubGFzdENvbG9yU3RvcFZhbHVlcy5wdXNoKCBjb2xvclN0cmluZyApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBzY2VuZXJ5TG9nICYmIHNjZW5lcnlMb2cuUGFpbnRzICYmIHNjZW5lcnlMb2cucG9wKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuY2FudmFzR3JhZGllbnQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSBnZW5lcmFsbHktYWxsb3dlZCBjb2xvciB0eXBlcyBmb3IgR3JhZGllbnQsIGFzIGEgc3RyaW5nLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY29sb3JUb1N0cmluZyggY29sb3I6IFRDb2xvciApOiBzdHJpbmcge1xyXG4gICAgLy8gdG8ge0NvbG9yfHN0cmluZ3xudWxsfVxyXG4gICAgaWYgKCBjb2xvciBpbnN0YW5jZW9mIFJlYWRPbmx5UHJvcGVydHkgKSB7XHJcbiAgICAgIGNvbG9yID0gY29sb3IudmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gdG8ge0NvbG9yfHN0cmluZ31cclxuICAgIGlmICggY29sb3IgPT09IG51bGwgKSB7XHJcbiAgICAgIGNvbG9yID0gJ3RyYW5zcGFyZW50JztcclxuICAgIH1cclxuXHJcbiAgICAvLyB0byB7c3RyaW5nfVxyXG4gICAgaWYgKCBjb2xvciBpbnN0YW5jZW9mIENvbG9yICkge1xyXG4gICAgICBjb2xvciA9IGNvbG9yLnRvQ1NTKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGNvbG9yIGFzIHN0cmluZztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBpc0dyYWRpZW50ITogYm9vbGVhbjtcclxufVxyXG5cclxuR3JhZGllbnQucHJvdG90eXBlLmlzR3JhZGllbnQgPSB0cnVlO1xyXG5cclxuc2NlbmVyeS5yZWdpc3RlciggJ0dyYWRpZW50JywgR3JhZGllbnQgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGdCQUFnQixNQUFNLHNDQUFzQztBQUNuRSxPQUFPQyxVQUFVLE1BQU0scUNBQXFDO0FBQzVELFNBQVNDLEtBQUssRUFBVUMsS0FBSyxFQUFFQyxPQUFPLFFBQVEsZUFBZTtBQU83RCxlQUFlLE1BQWVDLFFBQVEsU0FBU0YsS0FBSyxDQUFDO0VBRXJCOztFQUVpQjtFQUUvQztFQUdBO0VBR0E7QUFDRjtBQUNBO0VBQ1NHLFdBQVdBLENBQUEsRUFBRztJQUNuQixLQUFLLENBQUMsQ0FBQztJQUVQQyxNQUFNLElBQUlBLE1BQU0sQ0FBRSxJQUFJLENBQUNELFdB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