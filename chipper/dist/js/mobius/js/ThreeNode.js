// Copyright 2019-2022, University of Colorado Boulder

/**
 * Shows three.js content within a rectangle, displayed to be inside of a rectangle in arbitrary places in the scene
 * graph.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Bounds2 from '../../dot/js/Bounds2.js';
import Matrix3 from '../../dot/js/Matrix3.js';
import Vector2 from '../../dot/js/Vector2.js';
import Vector2Property from '../../dot/js/Vector2Property.js';
import { DOM, Node, Rectangle, Utils } from '../../scenery/js/imports.js';
import MobiusQueryParameters from './MobiusQueryParameters.js';
import ThreeStage from './ThreeStage.js';
import mobius from './mobius.js';
import optionize from '../../phet-core/js/optionize.js';
export default class ThreeNode extends Node {
  constructor(width, height, providedOptions) {
    const options = optionize()({
      fov: 50

      // positioned or transformed pixels, or full scenery-transformed?
      // can use https://threejs.org/docs/#api/en/cameras/PerspectiveCamera.setViewOffset to handle sub-pixel stuff?
    }, providedOptions);
    super();
    this.stage = new ThreeStage(options);
    this.layoutWidth = width;
    this.layoutHeight = height;

    // static camera properties
    this.stage.threeCamera.fov = options.fov;
    this.stage.threeCamera.aspect = width / height;
    this.offsetProperty = new Vector2Property(Vector2.ZERO);

    // {Node} - our target for drags that don't hit other UI components
    this.backgroundEventTarget = new Rectangle(0, 0, width, height);
    this.addChild(this.backgroundEventTarget);

    // Handle fallback for when we don't have WebGL, see https://github.com/phetsims/density/issues/105
    if (this.stage.threeRenderer) {
      // add the Canvas in with a DOM node that prevents Scenery from applying transformations on it
      this.domNode = new DOM(this.stage.threeRenderer.domElement, {
        preventTransform: true,
        // Scenery override for transformation
        pickable: false
      });

      // don't do bounds detection, it's too expensive. We're not pickable anyways
      this.domNode.invalidateDOM = () => this.domNode.invalidateSelf(new Bounds2(0, 0, 0, 0));
      this.domNode.invalidateDOM();
      const offsetMatrix = new Matrix3();
      Utils.prepareForTransform(this.stage.threeRenderer.domElement);
      this.offsetProperty.link(offset => {
        offsetMatrix.setToTranslation(offset.x, offset.y);
        Utils.applyPreparedTransform(offsetMatrix, this.stage.threeRenderer.domElement);
      });

      // support Scenery/Joist 0.2 screenshot (takes extra work to output)
      this.domNode.renderToCanvasSelf = wrapper => {
        const canvas = this.stage.renderToCanvas(MobiusQueryParameters.mobiusCanvasSupersampling);
        const context = wrapper.context;
        context.save();
        context.setTransform(1, 0, this.offsetProperty.value.x, -1, 0, this.stage.canvasHeight + this.offsetProperty.value.y); // no need to take pixel scaling into account

        context.drawImage(canvas, 0, 0);
        context.restore();
      };
      this.addChild(this.domNode);
    }
    this.mutate(options);
  }

  /**
   * Projects a 3d point in the global coordinate frame to one within the 2d global coordinate frame.
   */
  projectPoint(point) {
    return this.stage.projectPoint(point);
  }

  /**
   * Given a screen point, returns a 3D ray representing the camera's position and direction that point would be in the
   * 3D scene.
   */
  getRayFromScreenPoint(screenPoint) {
    return this.stage.getRayFromScreenPoint(screenPoint);
  }
  layout() {
    const globalBounds = this.localToGlobalBounds(this.backgroundEventTarget.bounds);
    const roundedBounds = globalBounds.roundedOut();
    this.stage.setDimensions(roundedBounds.width, roundedBounds.height);
    this.offsetProperty.value = roundedBounds.leftTop;

    // three.js requires this to be called after changing the parameters
    this.stage.threeCamera.updateProjectionMatrix();
    if (this.stage.threeRenderer) {
      this.domNode.invalidateDOM();
    }
  }

  /**
   * Renders the simulation to a specific rendering target
   *
   * @param target - undefined for the default target
   */
  render(target) {
    this.stage.render(target);
  }

  /**
   * Releases references.
   */
  dispose() {
    super.dispose();
    this.stage.dispose();
  }
}
mobius.register('ThreeNode', ThreeNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb3VuZHMyIiwiTWF0cml4MyIsIlZlY3RvcjIiLCJWZWN0b3IyUHJvcGVydHkiLCJET00iLCJOb2RlIiwiUmVjdGFuZ2xlIiwiVXRpbHMiLCJNb2JpdXNRdWVyeVBhcmFtZXRlcnMiLCJUaHJlZVN0YWdlIiwibW9iaXVzIiwib3B0aW9uaXplIiwiVGhyZWVOb2RlIiwiY29uc3RydWN0b3IiLCJ3aWR0aCIsImhlaWdodCIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJmb3YiLCJzdGFnZSIsImxheW91dFdpZHRoIiwibGF5b3V0SGVpZ2h0IiwidGhyZWVDYW1lcmEiLCJhc3BlY3QiLCJvZmZzZXRQcm9wZXJ0eSIsIlpFUk8iLCJiYWNrZ3JvdW5kRXZlbnRUYXJnZXQiLCJhZGRDaGlsZCIsInRocmVlUmVuZGVyZXIiLCJkb21Ob2RlIiwiZG9tRWxlbWVudCIsInByZXZlbnRUcmFuc2Zvcm0iLCJwaWNrYWJsZSIsImludmFsaWRhdGVET00iLCJpbnZhbGlkYXRlU2VsZiIsIm9mZnNldE1hdHJpeCIsInByZXBhcmVGb3JUcmFuc2Zvcm0iLCJsaW5rIiwib2Zmc2V0Iiwic2V0VG9UcmFuc2xhdGlvbiIsIngiLCJ5IiwiYXBwbHlQcmVwYXJlZFRyYW5zZm9ybSIsInJlbmRlclRvQ2FudmFzU2VsZiIsIndyYXBwZXIiLCJjYW52YXMiLCJyZW5kZXJUb0NhbnZhcyIsIm1vYml1c0NhbnZhc1N1cGVyc2FtcGxpbmciLCJjb250ZXh0Iiwic2F2ZSIsInNldFRyYW5zZm9ybSIsInZhbHVlIiwiY2FudmFzSGVpZ2h0IiwiZHJhd0ltYWdlIiwicmVzdG9yZSIsIm11dGF0ZSIsInByb2plY3RQb2ludCIsInBvaW50IiwiZ2V0UmF5RnJvbVNjcmVlblBvaW50Iiwic2NyZWVuUG9pbnQiLCJsYXlvdXQiLCJnbG9iYWxCb3VuZHMiLCJsb2NhbFRvR2xvYmFsQm91bmRzIiwiYm91bmRzIiwicm91bmRlZEJvdW5kcyIsInJvdW5kZWRPdXQiLCJzZXREaW1lbnNpb25zIiwibGVmdFRvcCIsInVwZGF0ZVByb2plY3Rpb25NYXRyaXgiLCJyZW5kZXIiLCJ0YXJnZXQiLCJkaXNwb3NlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJUaHJlZU5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2hvd3MgdGhyZWUuanMgY29udGVudCB3aXRoaW4gYSByZWN0YW5nbGUsIGRpc3BsYXllZCB0byBiZSBpbnNpZGUgb2YgYSByZWN0YW5nbGUgaW4gYXJiaXRyYXJ5IHBsYWNlcyBpbiB0aGUgc2NlbmVcclxuICogZ3JhcGguXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCBNYXRyaXgzIGZyb20gJy4uLy4uL2RvdC9qcy9NYXRyaXgzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMlByb3BlcnR5IGZyb20gJy4uLy4uL2RvdC9qcy9WZWN0b3IyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgeyBET00sIE5vZGUsIE5vZGVPcHRpb25zLCBSZWN0YW5nbGUsIFV0aWxzIH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IE1vYml1c1F1ZXJ5UGFyYW1ldGVycyBmcm9tICcuL01vYml1c1F1ZXJ5UGFyYW1ldGVycy5qcyc7XHJcbmltcG9ydCBUaHJlZVN0YWdlLCB7IFRocmVlU3RhZ2VPcHRpb25zIH0gZnJvbSAnLi9UaHJlZVN0YWdlLmpzJztcclxuaW1wb3J0IG1vYml1cyBmcm9tICcuL21vYml1cy5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFJheTMgZnJvbSAnLi4vLi4vZG90L2pzL1JheTMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMyBmcm9tICcuLi8uLi9kb3QvanMvVmVjdG9yMy5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIGZvdj86IG51bWJlcjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFRocmVlTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFRocmVlU3RhZ2VPcHRpb25zICYgTm9kZU9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUaHJlZU5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IHN0YWdlOiBUaHJlZVN0YWdlO1xyXG4gIHByaXZhdGUgbGF5b3V0V2lkdGg6IG51bWJlcjtcclxuICBwcml2YXRlIGxheW91dEhlaWdodDogbnVtYmVyO1xyXG4gIHByaXZhdGUgb2Zmc2V0UHJvcGVydHk6IFByb3BlcnR5PFZlY3RvcjI+O1xyXG4gIHB1YmxpYyByZWFkb25seSBiYWNrZ3JvdW5kRXZlbnRUYXJnZXQ6IE5vZGU7XHJcbiAgcHJpdmF0ZSBkb21Ob2RlITogRE9NO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBwcm92aWRlZE9wdGlvbnM/OiBUaHJlZU5vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8VGhyZWVOb2RlT3B0aW9ucywgU2VsZk9wdGlvbnMsIFRocmVlU3RhZ2VPcHRpb25zICYgTm9kZU9wdGlvbnM+KCkoIHtcclxuICAgICAgZm92OiA1MFxyXG5cclxuICAgICAgLy8gcG9zaXRpb25lZCBvciB0cmFuc2Zvcm1lZCBwaXhlbHMsIG9yIGZ1bGwgc2NlbmVyeS10cmFuc2Zvcm1lZD9cclxuICAgICAgLy8gY2FuIHVzZSBodHRwczovL3RocmVlanMub3JnL2RvY3MvI2FwaS9lbi9jYW1lcmFzL1BlcnNwZWN0aXZlQ2FtZXJhLnNldFZpZXdPZmZzZXQgdG8gaGFuZGxlIHN1Yi1waXhlbCBzdHVmZj9cclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5zdGFnZSA9IG5ldyBUaHJlZVN0YWdlKCBvcHRpb25zICk7XHJcbiAgICB0aGlzLmxheW91dFdpZHRoID0gd2lkdGg7XHJcbiAgICB0aGlzLmxheW91dEhlaWdodCA9IGhlaWdodDtcclxuXHJcbiAgICAvLyBzdGF0aWMgY2FtZXJhIHByb3BlcnRpZXNcclxuICAgIHRoaXMuc3RhZ2UudGhyZWVDYW1lcmEuZm92ID0gb3B0aW9ucy5mb3Y7XHJcbiAgICB0aGlzLnN0YWdlLnRocmVlQ2FtZXJhLmFzcGVjdCA9IHdpZHRoIC8gaGVpZ2h0O1xyXG5cclxuICAgIHRoaXMub2Zmc2V0UHJvcGVydHkgPSBuZXcgVmVjdG9yMlByb3BlcnR5KCBWZWN0b3IyLlpFUk8gKTtcclxuXHJcbiAgICAvLyB7Tm9kZX0gLSBvdXIgdGFyZ2V0IGZvciBkcmFncyB0aGF0IGRvbid0IGhpdCBvdGhlciBVSSBjb21wb25lbnRzXHJcbiAgICB0aGlzLmJhY2tncm91bmRFdmVudFRhcmdldCA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuYmFja2dyb3VuZEV2ZW50VGFyZ2V0ICk7XHJcblxyXG4gICAgLy8gSGFuZGxlIGZhbGxiYWNrIGZvciB3aGVuIHdlIGRvbid0IGhhdmUgV2ViR0wsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZGVuc2l0eS9pc3N1ZXMvMTA1XHJcbiAgICBpZiAoIHRoaXMuc3RhZ2UudGhyZWVSZW5kZXJlciApIHtcclxuICAgICAgLy8gYWRkIHRoZSBDYW52YXMgaW4gd2l0aCBhIERPTSBub2RlIHRoYXQgcHJldmVudHMgU2NlbmVyeSBmcm9tIGFwcGx5aW5nIHRyYW5zZm9ybWF0aW9ucyBvbiBpdFxyXG4gICAgICB0aGlzLmRvbU5vZGUgPSBuZXcgRE9NKCB0aGlzLnN0YWdlLnRocmVlUmVuZGVyZXIuZG9tRWxlbWVudCwge1xyXG4gICAgICAgIHByZXZlbnRUcmFuc2Zvcm06IHRydWUsIC8vIFNjZW5lcnkgb3ZlcnJpZGUgZm9yIHRyYW5zZm9ybWF0aW9uXHJcbiAgICAgICAgcGlja2FibGU6IGZhbHNlXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIC8vIGRvbid0IGRvIGJvdW5kcyBkZXRlY3Rpb24sIGl0J3MgdG9vIGV4cGVuc2l2ZS4gV2UncmUgbm90IHBpY2thYmxlIGFueXdheXNcclxuICAgICAgdGhpcy5kb21Ob2RlLmludmFsaWRhdGVET00gPSAoKSA9PiB0aGlzLmRvbU5vZGUuaW52YWxpZGF0ZVNlbGYoIG5ldyBCb3VuZHMyKCAwLCAwLCAwLCAwICkgKTtcclxuICAgICAgdGhpcy5kb21Ob2RlLmludmFsaWRhdGVET00oKTtcclxuXHJcbiAgICAgIGNvbnN0IG9mZnNldE1hdHJpeCA9IG5ldyBNYXRyaXgzKCk7XHJcbiAgICAgIFV0aWxzLnByZXBhcmVGb3JUcmFuc2Zvcm0oIHRoaXMuc3RhZ2UudGhyZWVSZW5kZXJlci5kb21FbGVtZW50ICk7XHJcbiAgICAgIHRoaXMub2Zmc2V0UHJvcGVydHkubGluayggb2Zmc2V0ID0+IHtcclxuICAgICAgICBvZmZzZXRNYXRyaXguc2V0VG9UcmFuc2xhdGlvbiggb2Zmc2V0LngsIG9mZnNldC55ICk7XHJcbiAgICAgICAgVXRpbHMuYXBwbHlQcmVwYXJlZFRyYW5zZm9ybSggb2Zmc2V0TWF0cml4LCB0aGlzLnN0YWdlLnRocmVlUmVuZGVyZXIhLmRvbUVsZW1lbnQgKTtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgLy8gc3VwcG9ydCBTY2VuZXJ5L0pvaXN0IDAuMiBzY3JlZW5zaG90ICh0YWtlcyBleHRyYSB3b3JrIHRvIG91dHB1dClcclxuICAgICAgdGhpcy5kb21Ob2RlLnJlbmRlclRvQ2FudmFzU2VsZiA9IHdyYXBwZXIgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNhbnZhcyA9IHRoaXMuc3RhZ2UucmVuZGVyVG9DYW52YXMoIE1vYml1c1F1ZXJ5UGFyYW1ldGVycy5tb2JpdXNDYW52YXNTdXBlcnNhbXBsaW5nICk7XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSB3cmFwcGVyLmNvbnRleHQ7XHJcbiAgICAgICAgY29udGV4dC5zYXZlKCk7XHJcblxyXG4gICAgICAgIGNvbnRleHQuc2V0VHJhbnNmb3JtKCAxLCAwLCB0aGlzLm9mZnNldFByb3BlcnR5LnZhbHVlLngsIC0xLCAwLCB0aGlzLnN0YWdlLmNhbnZhc0hlaWdodCArIHRoaXMub2Zmc2V0UHJvcGVydHkudmFsdWUueSApOyAvLyBubyBuZWVkIHRvIHRha2UgcGl4ZWwgc2NhbGluZyBpbnRvIGFjY291bnRcclxuXHJcbiAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoIGNhbnZhcywgMCwgMCApO1xyXG4gICAgICAgIGNvbnRleHQucmVzdG9yZSgpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgdGhpcy5hZGRDaGlsZCggdGhpcy5kb21Ob2RlICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFByb2plY3RzIGEgM2QgcG9pbnQgaW4gdGhlIGdsb2JhbCBjb29yZGluYXRlIGZyYW1lIHRvIG9uZSB3aXRoaW4gdGhlIDJkIGdsb2JhbCBjb29yZGluYXRlIGZyYW1lLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBwcm9qZWN0UG9pbnQoIHBvaW50OiBWZWN0b3IzICk6IFZlY3RvcjIge1xyXG4gICAgcmV0dXJuIHRoaXMuc3RhZ2UucHJvamVjdFBvaW50KCBwb2ludCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2l2ZW4gYSBzY3JlZW4gcG9pbnQsIHJldHVybnMgYSAzRCByYXkgcmVwcmVzZW50aW5nIHRoZSBjYW1lcmEncyBwb3NpdGlvbiBhbmQgZGlyZWN0aW9uIHRoYXQgcG9pbnQgd291bGQgYmUgaW4gdGhlXHJcbiAgICogM0Qgc2NlbmUuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRSYXlGcm9tU2NyZWVuUG9pbnQoIHNjcmVlblBvaW50OiBWZWN0b3IyICk6IFJheTMge1xyXG4gICAgcmV0dXJuIHRoaXMuc3RhZ2UuZ2V0UmF5RnJvbVNjcmVlblBvaW50KCBzY3JlZW5Qb2ludCApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGxheW91dCgpOiB2b2lkIHtcclxuICAgIGNvbnN0IGdsb2JhbEJvdW5kcyA9IHRoaXMubG9jYWxUb0dsb2JhbEJvdW5kcyggdGhpcy5iYWNrZ3JvdW5kRXZlbnRUYXJnZXQuYm91bmRzICk7XHJcbiAgICBjb25zdCByb3VuZGVkQm91bmRzID0gZ2xvYmFsQm91bmRzLnJvdW5kZWRPdXQoKTtcclxuXHJcbiAgICB0aGlzLnN0YWdlLnNldERpbWVuc2lvbnMoIHJvdW5kZWRCb3VuZHMud2lkdGgsIHJvdW5kZWRCb3VuZHMuaGVpZ2h0ICk7XHJcbiAgICB0aGlzLm9mZnNldFByb3BlcnR5LnZhbHVlID0gcm91bmRlZEJvdW5kcy5sZWZ0VG9wO1xyXG5cclxuICAgIC8vIHRocmVlLmpzIHJlcXVpcmVzIHRoaXMgdG8gYmUgY2FsbGVkIGFmdGVyIGNoYW5naW5nIHRoZSBwYXJhbWV0ZXJzXHJcbiAgICB0aGlzLnN0YWdlLnRocmVlQ2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcclxuXHJcbiAgICBpZiAoIHRoaXMuc3RhZ2UudGhyZWVSZW5kZXJlciApIHtcclxuICAgICAgdGhpcy5kb21Ob2RlLmludmFsaWRhdGVET00oKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbmRlcnMgdGhlIHNpbXVsYXRpb24gdG8gYSBzcGVjaWZpYyByZW5kZXJpbmcgdGFyZ2V0XHJcbiAgICpcclxuICAgKiBAcGFyYW0gdGFyZ2V0IC0gdW5kZWZpbmVkIGZvciB0aGUgZGVmYXVsdCB0YXJnZXRcclxuICAgKi9cclxuICBwdWJsaWMgcmVuZGVyKCB0YXJnZXQ6IFRIUkVFLldlYkdMUmVuZGVyVGFyZ2V0IHwgdW5kZWZpbmVkICk6IHZvaWQge1xyXG4gICAgdGhpcy5zdGFnZS5yZW5kZXIoIHRhcmdldCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVsZWFzZXMgcmVmZXJlbmNlcy5cclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuXHJcbiAgICB0aGlzLnN0YWdlLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbm1vYml1cy5yZWdpc3RlciggJ1RocmVlTm9kZScsIFRocmVlTm9kZSApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0seUJBQXlCO0FBQzdDLE9BQU9DLE9BQU8sTUFBTSx5QkFBeUI7QUFDN0MsT0FBT0MsT0FBTyxNQUFNLHlCQUF5QjtBQUM3QyxPQUFPQyxlQUFlLE1BQU0saUNBQWlDO0FBQzdELFNBQVNDLEdBQUcsRUFBRUMsSUFBSSxFQUFlQyxTQUFTLEVBQUVDLEtBQUssUUFBUSw2QkFBNkI7QUFDdEYsT0FBT0MscUJBQXFCLE1BQU0sNEJBQTRCO0FBQzlELE9BQU9DLFVBQVUsTUFBNkIsaUJBQWlCO0FBQy9ELE9BQU9DLE1BQU0sTUFBTSxhQUFhO0FBQ2hDLE9BQU9DLFNBQVMsTUFBTSxpQ0FBaUM7QUFXdkQsZUFBZSxNQUFNQyxTQUFTLFNBQVNQLElBQUksQ0FBQztFQVNuQ1EsV0FBV0EsQ0FBRUMsS0FBYSxFQUFFQyxNQUFjLEVBQUVDLGVBQWtDLEVBQUc7SUFFdEYsTUFBTUMsT0FBTyxHQUFHTixTQUFTLENBQWlFLENBQUMsQ0FBRTtNQUMzRk8sR0FBRyxFQUFFOztNQUVMO01BQ0E7SUFD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