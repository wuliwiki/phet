// Copyright 2020-2022, University of Colorado Boulder

/**
 * Subtype of BAMScreenView that shows kits, but also has a collection area to the right-hand side
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 * @author Denzell Barnett (PhET Interactive Simulations)
 */

import Multilink from '../../../../axon/js/Multilink.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Color } from '../../../../scenery/js/imports.js';
import TextPushButton from '../../../../sun/js/buttons/TextPushButton.js';
import nullSoundPlayer from '../../../../tambo/js/shared-sound-players/nullSoundPlayer.js';
import buildAMolecule from '../../buildAMolecule.js';
import BuildAMoleculeStrings from '../../BuildAMoleculeStrings.js';
import BAMConstants from '../BAMConstants.js';
import AllFilledDialog from './AllFilledDialog.js';
import BAMScreenView from './BAMScreenView.js';
import CollectionPanel from './CollectionPanel.js';
class MoleculeCollectingScreenView extends BAMScreenView {
  /**
   * @param {BAMModel} bamModel
   * @param {boolean} isSingleCollectionMode
   */
  constructor(bamModel, isSingleCollectionMode) {
    super(bamModel);

    // @public {BAMModel}
    this.bamModel = bamModel;

    // @private {boolean}
    this.hasShownOnce = false;

    // @private {TextPushButton} Create a next collection button
    this.nextCollectionButton = new TextPushButton(BuildAMoleculeStrings.nextCollection, {
      centerX: this.layoutBounds.centerX - 100,
      top: this.layoutBounds.top + BAMConstants.VIEW_PADDING,
      font: new PhetFont({
        size: 18,
        weight: 'bold'
      }),
      maxWidth: BAMConstants.TEXT_MAX_WIDTH,
      baseColor: Color.ORANGE,
      soundPlayer: nullSoundPlayer
    });
    this.nextCollectionButton.touchArea = Shape.bounds(this.nextCollectionButton.localBounds.dilated(20));
    this.nextCollectionButton.addListener(() => {
      bamModel.regenerateCallback();
      bamModel.buttonClickedProperty.value = false;
      this.nextCollectionButton.visible = false;
    });
    this.addChild(this.nextCollectionButton);
    this.nextCollectionButton.visible = false;

    // @private {Dialog} Dialog that shows when all the boxes are filled.
    this.allFilledDialog = new AllFilledDialog(bamModel.buttonClickedProperty, bamModel.regenerateCallback, {
      showCallback: () => {
        this.bamModel.buttonClickedProperty.value = false;
      }
    });
    Multilink.lazyMultilink([this.allFilledDialog.isShowingProperty, this.bamModel.buttonClickedProperty], (isShowing, buttonClicked) => {
      this.nextCollectionButton.visible = !isShowing && !buttonClicked;
    });

    // @public {Bounds2} Adjust play area and carousel bounds to compensate for CollectionPanel
    this.mappedKitCollectionBounds = this.kitCollectionMap[this.bamModel.currentCollectionProperty.value.id].bounds.dilatedX(15);
    const collectionAttachmentCallbacks = [];
    const collectionPanel = new CollectionPanel(this.bamModel, isSingleCollectionMode, collectionAttachmentCallbacks, node => {
      // returns model bounds from a node, given local coordinates on a node
      const viewBounds = node.getParent().getUniqueTrail().getTransformTo(this.getUniqueTrail()).transformBounds2(node.bounds);
      return BAMConstants.MODEL_VIEW_TRANSFORM.viewToModelBounds(viewBounds);
    }, this.showDialogCallback, this.updateRefillButton, {
      xMargin: 10,
      yMargin: 7,
      minWidth: 250,
      align: 'center'
    });
    collectionPanel.setRightTop(new Vector2(this.layoutBounds.width - BAMConstants.VIEW_PADDING / 2, this.layoutBounds.top + BAMConstants.VIEW_PADDING / 2));
    this.addChild(collectionPanel);
    collectionPanel.moveToBack();

    // notify attachment
    collectionAttachmentCallbacks.forEach(callback => {
      callback();
    });

    // Affects whether the AllFilledDialog will show after resetting.
    this.resetAllButton.addListener(() => {
      this.hasShownOnce = false;
    });

    // Adjust the center of the AllFilledDialog
    this.visibleBoundsProperty.link(() => {
      this.allFilledDialog.center = this.layoutBounds.center;
    });
  }

  /**
   * @param {KitCollection} collection
   *
   * @override
   * @public
   * @returns {Node}
   */
  addCollection(collection) {
    const kitCollectionNode = super.addCollection(collection, true);
    this.hasShownOnce = false;

    // show dialog the 1st time all collection boxes are filled
    collection.allCollectionBoxesFilledProperty.link(filled => {
      if (filled) {
        if (!this.hasShownOnce && !this.bamModel.hasNextCollection()) {
          this.allFilledDialog.show();
          this.hasShownOnce = true;
        }
      }
    });
    return kitCollectionNode;
  }
}
buildAMolecule.register('MoleculeCollectingScreenView', MoleculeCollectingScreenView);
export default MoleculeCollectingScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJWZWN0b3IyIiwiU2hhcGUiLCJQaGV0Rm9udCIsIkNvbG9yIiwiVGV4dFB1c2hCdXR0b24iLCJudWxsU291bmRQbGF5ZXIiLCJidWlsZEFNb2xlY3VsZSIsIkJ1aWxkQU1vbGVjdWxlU3RyaW5ncyIsIkJBTUNvbnN0YW50cyIsIkFsbEZpbGxlZERpYWxvZyIsIkJBTVNjcmVlblZpZXciLCJDb2xsZWN0aW9uUGFuZWwiLCJNb2xlY3VsZUNvbGxlY3RpbmdTY3JlZW5WaWV3IiwiY29uc3RydWN0b3IiLCJiYW1Nb2RlbCIsImlzU2luZ2xlQ29sbGVjdGlvbk1vZGUiLCJoYXNTaG93bk9uY2UiLCJuZXh0Q29sbGVjdGlvbkJ1dHRvbiIsIm5leHRDb2xsZWN0aW9uIiwiY2VudGVyWCIsImxheW91dEJvdW5kcyIsInRvcCIsIlZJRVdfUEFERElORyIsImZvbnQiLCJzaXplIiwid2VpZ2h0IiwibWF4V2lkdGgiLCJURVhUX01BWF9XSURUSCIsImJhc2VDb2xvciIsIk9SQU5HRSIsInNvdW5kUGxheWVyIiwidG91Y2hBcmVhIiwiYm91bmRzIiwibG9jYWxCb3VuZHMiLCJkaWxhdGVkIiwiYWRkTGlzdGVuZXIiLCJyZWdlbmVyYXRlQ2FsbGJhY2siLCJidXR0b25DbGlja2VkUHJvcGVydHkiLCJ2YWx1ZSIsInZpc2libGUiLCJhZGRDaGlsZCIsImFsbEZpbGxlZERpYWxvZyIsInNob3dDYWxsYmFjayIsImxhenlNdWx0aWxpbmsiLCJpc1Nob3dpbmdQcm9wZXJ0eSIsImlzU2hvd2luZyIsImJ1dHRvbkNsaWNrZWQiLCJtYXBwZWRLaXRDb2xsZWN0aW9uQm91bmRzIiwia2l0Q29sbGVjdGlvbk1hcCIsImN1cnJlbnRDb2xsZWN0aW9uUHJvcGVydHkiLCJpZCIsImRpbGF0ZWRYIiwiY29sbGVjdGlvbkF0dGFjaG1lbnRDYWxsYmFja3MiLCJjb2xsZWN0aW9uUGFuZWwiLCJub2RlIiwidmlld0JvdW5kcyIsImdldFBhcmVudCIsImdldFVuaXF1ZVRyYWlsIiwiZ2V0VHJhbnNmb3JtVG8iLCJ0cmFuc2Zvcm1Cb3VuZHMyIiwiTU9ERUxfVklFV19UUkFOU0ZPUk0iLCJ2aWV3VG9Nb2RlbEJvdW5kcyIsInNob3dEaWFsb2dDYWxsYmFjayIsInVwZGF0ZVJlZmlsbEJ1dHRvbiIsInhNYXJnaW4iLCJ5TWFyZ2luIiwibWluV2lkdGgiLCJhbGlnbiIsInNldFJpZ2h0VG9wIiwid2lkdGgiLCJtb3ZlVG9CYWNrIiwiZm9yRWFjaCIsImNhbGxiYWNrIiwicmVzZXRBbGxCdXR0b24iLCJ2aXNpYmxlQm91bmRzUHJvcGVydHkiLCJsaW5rIiwiY2VudGVyIiwiYWRkQ29sbGVjdGlvbiIsImNvbGxlY3Rpb24iLCJraXRDb2xsZWN0aW9uTm9kZSIsImFsbENvbGxlY3Rpb25Cb3hlc0ZpbGxlZFByb3BlcnR5IiwiZmlsbGVkIiwiaGFzTmV4dENvbGxlY3Rpb24iLCJzaG93IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJNb2xlY3VsZUNvbGxlY3RpbmdTY3JlZW5WaWV3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIwLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFN1YnR5cGUgb2YgQkFNU2NyZWVuVmlldyB0aGF0IHNob3dzIGtpdHMsIGJ1dCBhbHNvIGhhcyBhIGNvbGxlY3Rpb24gYXJlYSB0byB0aGUgcmlnaHQtaGFuZCBzaWRlXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICogQGF1dGhvciBEZW56ZWxsIEJhcm5ldHQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgQ29sb3IgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgVGV4dFB1c2hCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL2J1dHRvbnMvVGV4dFB1c2hCdXR0b24uanMnO1xyXG5pbXBvcnQgbnVsbFNvdW5kUGxheWVyIGZyb20gJy4uLy4uLy4uLy4uL3RhbWJvL2pzL3NoYXJlZC1zb3VuZC1wbGF5ZXJzL251bGxTb3VuZFBsYXllci5qcyc7XHJcbmltcG9ydCBidWlsZEFNb2xlY3VsZSBmcm9tICcuLi8uLi9idWlsZEFNb2xlY3VsZS5qcyc7XHJcbmltcG9ydCBCdWlsZEFNb2xlY3VsZVN0cmluZ3MgZnJvbSAnLi4vLi4vQnVpbGRBTW9sZWN1bGVTdHJpbmdzLmpzJztcclxuaW1wb3J0IEJBTUNvbnN0YW50cyBmcm9tICcuLi9CQU1Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgQWxsRmlsbGVkRGlhbG9nIGZyb20gJy4vQWxsRmlsbGVkRGlhbG9nLmpzJztcclxuaW1wb3J0IEJBTVNjcmVlblZpZXcgZnJvbSAnLi9CQU1TY3JlZW5WaWV3LmpzJztcclxuaW1wb3J0IENvbGxlY3Rpb25QYW5lbCBmcm9tICcuL0NvbGxlY3Rpb25QYW5lbC5qcyc7XHJcblxyXG5jbGFzcyBNb2xlY3VsZUNvbGxlY3RpbmdTY3JlZW5WaWV3IGV4dGVuZHMgQkFNU2NyZWVuVmlldyB7XHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtCQU1Nb2RlbH0gYmFtTW9kZWxcclxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzU2luZ2xlQ29sbGVjdGlvbk1vZGVcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggYmFtTW9kZWwsIGlzU2luZ2xlQ29sbGVjdGlvbk1vZGUgKSB7XHJcbiAgICBzdXBlciggYmFtTW9kZWwgKTtcclxuXHJcbiAgICAvLyBAcHVibGljIHtCQU1Nb2RlbH1cclxuICAgIHRoaXMuYmFtTW9kZWwgPSBiYW1Nb2RlbDtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7Ym9vbGVhbn1cclxuICAgIHRoaXMuaGFzU2hvd25PbmNlID0gZmFsc2U7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge1RleHRQdXNoQnV0dG9ufSBDcmVhdGUgYSBuZXh0IGNvbGxlY3Rpb24gYnV0dG9uXHJcbiAgICB0aGlzLm5leHRDb2xsZWN0aW9uQnV0dG9uID0gbmV3IFRleHRQdXNoQnV0dG9uKCBCdWlsZEFNb2xlY3VsZVN0cmluZ3MubmV4dENvbGxlY3Rpb24sIHtcclxuICAgICAgY2VudGVyWDogdGhpcy5sYXlvdXRCb3VuZHMuY2VudGVyWCAtIDEwMCxcclxuICAgICAgdG9wOiB0aGlzLmxheW91dEJvdW5kcy50b3AgKyBCQU1Db25zdGFudHMuVklFV19QQURESU5HLFxyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIHtcclxuICAgICAgICBzaXplOiAxOCxcclxuICAgICAgICB3ZWlnaHQ6ICdib2xkJ1xyXG4gICAgICB9ICksXHJcbiAgICAgIG1heFdpZHRoOiBCQU1Db25zdGFudHMuVEVYVF9NQVhfV0lEVEgsXHJcbiAgICAgIGJhc2VDb2xvcjogQ29sb3IuT1JBTkdFLFxyXG4gICAgICBzb3VuZFBsYXllcjogbnVsbFNvdW5kUGxheWVyXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLm5leHRDb2xsZWN0aW9uQnV0dG9uLnRvdWNoQXJlYSA9IFNoYXBlLmJvdW5kcyggdGhpcy5uZXh0Q29sbGVjdGlvbkJ1dHRvbi5sb2NhbEJvdW5kcy5kaWxhdGVkKCAyMCApICk7XHJcbiAgICB0aGlzLm5leHRDb2xsZWN0aW9uQnV0dG9uLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgIGJhbU1vZGVsLnJlZ2VuZXJhdGVDYWxsYmFjaygpO1xyXG4gICAgICBiYW1Nb2RlbC5idXR0b25DbGlja2VkUHJvcGVydHkudmFsdWUgPSBmYWxzZTtcclxuICAgICAgdGhpcy5uZXh0Q29sbGVjdGlvbkJ1dHRvbi52aXNpYmxlID0gZmFsc2U7XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLm5leHRDb2xsZWN0aW9uQnV0dG9uICk7XHJcbiAgICB0aGlzLm5leHRDb2xsZWN0aW9uQnV0dG9uLnZpc2libGUgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7RGlhbG9nfSBEaWFsb2cgdGhhdCBzaG93cyB3aGVuIGFsbCB0aGUgYm94ZXMgYXJlIGZpbGxlZC5cclxuICAgIHRoaXMuYWxsRmlsbGVkRGlhbG9nID0gbmV3IEFsbEZpbGxlZERpYWxvZyhcclxuICAgICAgYmFtTW9kZWwuYnV0dG9uQ2xpY2tlZFByb3BlcnR5LFxyXG4gICAgICBiYW1Nb2RlbC5yZWdlbmVyYXRlQ2FsbGJhY2ssIHtcclxuICAgICAgICBzaG93Q2FsbGJhY2s6ICgpID0+IHtcclxuICAgICAgICAgIHRoaXMuYmFtTW9kZWwuYnV0dG9uQ2xpY2tlZFByb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICApO1xyXG5cclxuICAgIE11bHRpbGluay5sYXp5TXVsdGlsaW5rKCBbIHRoaXMuYWxsRmlsbGVkRGlhbG9nLmlzU2hvd2luZ1Byb3BlcnR5LCB0aGlzLmJhbU1vZGVsLmJ1dHRvbkNsaWNrZWRQcm9wZXJ0eSBdLFxyXG4gICAgICAoIGlzU2hvd2luZywgYnV0dG9uQ2xpY2tlZCApID0+IHtcclxuICAgICAgICB0aGlzLm5leHRDb2xsZWN0aW9uQnV0dG9uLnZpc2libGUgPSAhaXNTaG93aW5nICYmICFidXR0b25DbGlja2VkO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7Qm91bmRzMn0gQWRqdXN0IHBsYXkgYXJlYSBhbmQgY2Fyb3VzZWwgYm91bmRzIHRvIGNvbXBlbnNhdGUgZm9yIENvbGxlY3Rpb25QYW5lbFxyXG4gICAgdGhpcy5tYXBwZWRLaXRDb2xsZWN0aW9uQm91bmRzID0gdGhpcy5raXRDb2xsZWN0aW9uTWFwWyB0aGlzLmJhbU1vZGVsLmN1cnJlbnRDb2xsZWN0aW9uUHJvcGVydHkudmFsdWUuaWQgXS5ib3VuZHMuZGlsYXRlZFgoIDE1ICk7XHJcbiAgICBjb25zdCBjb2xsZWN0aW9uQXR0YWNobWVudENhbGxiYWNrcyA9IFtdO1xyXG4gICAgY29uc3QgY29sbGVjdGlvblBhbmVsID0gbmV3IENvbGxlY3Rpb25QYW5lbChcclxuICAgICAgdGhpcy5iYW1Nb2RlbCxcclxuICAgICAgaXNTaW5nbGVDb2xsZWN0aW9uTW9kZSxcclxuICAgICAgY29sbGVjdGlvbkF0dGFjaG1lbnRDYWxsYmFja3MsXHJcbiAgICAgIG5vZGUgPT4ge1xyXG5cclxuICAgICAgICAvLyByZXR1cm5zIG1vZGVsIGJvdW5kcyBmcm9tIGEgbm9kZSwgZ2l2ZW4gbG9jYWwgY29vcmRpbmF0ZXMgb24gYSBub2RlXHJcbiAgICAgICAgY29uc3Qgdmlld0JvdW5kcyA9IG5vZGUuZ2V0UGFyZW50KCkuZ2V0VW5pcXVlVHJhaWwoKS5nZXRUcmFuc2Zvcm1UbyggdGhpcy5nZXRVbmlxdWVUcmFpbCgpICkudHJhbnNmb3JtQm91bmRzMiggbm9kZS5ib3VuZHMgKTtcclxuICAgICAgICByZXR1cm4gQkFNQ29uc3RhbnRzLk1PREVMX1ZJRVdfVFJBTlNGT1JNLnZpZXdUb01vZGVsQm91bmRzKCB2aWV3Qm91bmRzICk7XHJcbiAgICAgIH0sXHJcbiAgICAgIHRoaXMuc2hvd0RpYWxvZ0NhbGxiYWNrLFxyXG4gICAgICB0aGlzLnVwZGF0ZVJlZmlsbEJ1dHRvbiwge1xyXG4gICAgICAgIHhNYXJnaW46IDEwLFxyXG4gICAgICAgIHlNYXJnaW46IDcsXHJcbiAgICAgICAgbWluV2lkdGg6IDI1MCxcclxuICAgICAgICBhbGlnbjogJ2NlbnRlcidcclxuICAgICAgfSApO1xyXG5cclxuICAgIGNvbGxlY3Rpb25QYW5lbC5zZXRSaWdodFRvcCggbmV3IFZlY3RvcjIoXHJcbiAgICAgIHRoaXMubGF5b3V0Qm91bmRzLndpZHRoIC0gQkFNQ29uc3RhbnRzLlZJRVdfUEFERElORyAvIDIsXHJcbiAgICAgIHRoaXMubGF5b3V0Qm91bmRzLnRvcCArIEJBTUNvbnN0YW50cy5WSUVXX1BBRERJTkcgLyAyXHJcbiAgICApICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBjb2xsZWN0aW9uUGFuZWwgKTtcclxuICAgIGNvbGxlY3Rpb25QYW5lbC5tb3ZlVG9CYWNrKCk7XHJcblxyXG4gICAgLy8gbm90aWZ5IGF0dGFjaG1lbnRcclxuICAgIGNvbGxlY3Rpb25BdHRhY2htZW50Q2FsbGJhY2tzLmZvckVhY2goIGNhbGxiYWNrID0+IHsgY2FsbGJhY2soKTsgfSApO1xyXG5cclxuICAgIC8vIEFmZmVjdHMgd2hldGhlciB0aGUgQWxsRmlsbGVkRGlhbG9nIHdpbGwgc2hvdyBhZnRlciByZXNldHRpbmcuXHJcbiAgICB0aGlzLnJlc2V0QWxsQnV0dG9uLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuaGFzU2hvd25PbmNlID0gZmFsc2U7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQWRqdXN0IHRoZSBjZW50ZXIgb2YgdGhlIEFsbEZpbGxlZERpYWxvZ1xyXG4gICAgdGhpcy52aXNpYmxlQm91bmRzUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICB0aGlzLmFsbEZpbGxlZERpYWxvZy5jZW50ZXIgPSB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXI7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0tpdENvbGxlY3Rpb259IGNvbGxlY3Rpb25cclxuICAgKlxyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAcmV0dXJucyB7Tm9kZX1cclxuICAgKi9cclxuICBhZGRDb2xsZWN0aW9uKCBjb2xsZWN0aW9uICkge1xyXG4gICAgY29uc3Qga2l0Q29sbGVjdGlvbk5vZGUgPSBzdXBlci5hZGRDb2xsZWN0aW9uKCBjb2xsZWN0aW9uLCB0cnVlICk7XHJcbiAgICB0aGlzLmhhc1Nob3duT25jZSA9IGZhbHNlO1xyXG5cclxuICAgIC8vIHNob3cgZGlhbG9nIHRoZSAxc3QgdGltZSBhbGwgY29sbGVjdGlvbiBib3hlcyBhcmUgZmlsbGVkXHJcbiAgICBjb2xsZWN0aW9uLmFsbENvbGxlY3Rpb25Cb3hlc0ZpbGxlZFByb3BlcnR5LmxpbmsoIGZpbGxlZCA9PiB7XHJcbiAgICAgIGlmICggZmlsbGVkICkge1xyXG4gICAgICAgIGlmICggIXRoaXMuaGFzU2hvd25PbmNlICYmICF0aGlzLmJhbU1vZGVsLmhhc05leHRDb2xsZWN0aW9uKCkgKSB7XHJcbiAgICAgICAgICB0aGlzLmFsbEZpbGxlZERpYWxvZy5zaG93KCk7XHJcbiAgICAgICAgICB0aGlzLmhhc1Nob3duT25jZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICByZXR1cm4ga2l0Q29sbGVjdGlvbk5vZGU7XHJcbiAgfVxyXG59XHJcblxyXG5idWlsZEFNb2xlY3VsZS5yZWdpc3RlciggJ01vbGVjdWxlQ29sbGVjdGluZ1NjcmVlblZpZXcnLCBNb2xlY3VsZUNvbGxlY3RpbmdTY3JlZW5WaWV3ICk7XHJcbmV4cG9ydCBkZWZhdWx0IE1vbGVjdWxlQ29sbGVjdGluZ1NjcmVlblZpZXc7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsU0FBUyxNQUFNLGtDQUFrQztBQUN4RCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDdEQsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxTQUFTQyxLQUFLLFFBQVEsbUNBQW1DO0FBQ3pELE9BQU9DLGNBQWMsTUFBTSw4Q0FBOEM7QUFDekUsT0FBT0MsZUFBZSxNQUFNLDhEQUE4RDtBQUMxRixPQUFPQyxjQUFjLE1B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