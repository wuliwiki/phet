// Copyright 2020-2022, University of Colorado Boulder

/**
 * Contains "bond breaking" nodes for a single molecule, so they can be cut apart with scissors
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 * @author Denzell Barnett (PhET Interactive Simulations)
 */

import { Circle, FireListener, Line, Node } from '../../../../scenery/js/imports.js';
import scissors_cur from '../../../images/scissors_cur.js';
import scissors_png from '../../../images/scissors_png.js';
import scissorsClosed_cur from '../../../images/scissorsClosed_cur.js';
import scissorsClosed_png from '../../../images/scissorsClosed_png.js';
import scissorsClosedUp_cur from '../../../images/scissorsClosedUp_cur.js';
import scissorsClosedUp_png from '../../../images/scissorsClosedUp_png.js';
import scissorsUp_cur from '../../../images/scissorsUp_cur.js';
import scissorsUp_png from '../../../images/scissorsUp_png.js';
import buildAMolecule from '../../buildAMolecule.js';
import BAMConstants from '../BAMConstants.js';
import Direction from '../model/Direction.js';

/* Notes on .cur file generation, all from the images directory, with "sudo apt-get install icoutils" for icotool:
 icotool -c -o scissors.ico scissors.png
 icotool -c -o scissors-closed.ico scissors-closed.png
 icotool -c -o scissors-up.ico scissors-up.png
 icotool -c -o scissors-closed-up.ico scissors-closed-up.png

 ./ico2cur.py scissors.ico -x 11 -y 10
 ./ico2cur.py scissors-closed.ico -x 13 -y 7
 ./ico2cur.py scissors-up.ico -x 10 -y 11
 ./ico2cur.py scissors-closed-up.ico -x 7 -y 13
 */

const images = {
  'scissors.png': scissors_png,
  'scissors-closed.png': scissorsClosed_png,
  'scissors-up.png': scissorsUp_png,
  'scissors-closed-up.png': scissorsClosedUp_png,
  'scissors.cur': scissors_cur,
  'scissors-closed.cur': scissorsClosed_cur,
  'scissors-up.cur': scissorsUp_cur,
  'scissors-closed-up.cur': scissorsClosedUp_cur
};
const bondRadius = 6; // "Radius" of the bond target that will break the bond

class MoleculeBondNode extends Node {
  /**
   * @param {Bond} bond
   * @param {Kit} kit
   */
  constructor(bond, kit) {
    super({});

    // @private {Atom2}
    this.a = bond.a;

    // @private {Atom2}
    this.b = bond.b;

    // @private {Kit}
    this.kit = kit;

    // Use the lewis dot model to get our bond direction
    const bondDirection = kit.getBondDirection(this.a, this.b);
    const isHorizontal = bondDirection === Direction.WEST || bondDirection === Direction.EAST;

    // Define images for opened and closed scissors
    let openFile = 'scissors';
    let closedFile = 'scissors-closed';
    if (isHorizontal) {
      openFile += '-up';
      closedFile += '-up';
    }
    openFile += '.png';
    closedFile += '.png';
    const scissorsOpen = images[openFile]; // 23x20 or 20x23
    const scissorsClosed = images[closedFile]; //26x15 or 15x26
    const backup = isHorizontal ? 'col-resize' : 'row-resize';

    // Offsets should center this
    const openCursor = `url(${scissorsOpen.src}) ${isHorizontal ? '10 11' : '11 10'}, ${backup}`;
    const closedCursor = `url(${scissorsClosed.src}) ${isHorizontal ? '7 13' : '13 7'}, ${backup}`;

    // Cut here icon is subject to change. See https://github.com/phetsims/build-a-molecule/issues/113
    const cutTargetNode = new Node();

    // Add dashed line
    const dashedLine = new Line(-15, 0, 15, 0, {
      stroke: 'black',
      lineDash: [4.5, 2],
      lineWidth: 1
    });
    cutTargetNode.addChild(dashedLine);
    if (isHorizontal) {
      dashedLine.rotate(Math.PI / 2);
    }

    // Add inner circle
    cutTargetNode.addChild(new Circle(bondRadius, {
      fill: 'rgb(253,225,49)',
      stroke: 'rgb(253,225,49)',
      cursor: openCursor,
      visible: true
    }));

    // Add outer circle
    cutTargetNode.addChild(new Circle(bondRadius * 1.5, {
      fill: 'rgba(253,225,49,0.4)',
      cursor: openCursor,
      visible: true
    }));
    cutTargetNode.addInputListener(new FireListener({
      fireOnDown: true,
      fire() {
        cutTargetNode.cursor = closedCursor;
        kit.breakBond(bond.a, bond.b);
      }
    }));
    this.addChild(cutTargetNode);

    // @private {function} Listener that will update the position of our hit target
    this.positionListener = () => {
      const orientation = this.b.positionProperty.value.minus(this.a.positionProperty.value);
      if (orientation.magnitude > 0) {
        orientation.normalize();
      }
      const position = orientation.times(this.a.covalentRadius).plus(this.a.positionProperty.value);
      this.setTranslation(BAMConstants.MODEL_VIEW_TRANSFORM.modelToViewPosition(position));
    };

    // @private {function(Atom2)}
    this.toggleTargetVisibility = selectedAtom => {
      cutTargetNode.visible = selectedAtom === this.a || selectedAtom === this.b;
    };

    // Link relevant elements
    this.kit.selectedAtomProperty.link(this.toggleTargetVisibility);
    this.a.positionProperty.link(this.positionListener);
    this.b.positionProperty.link(this.positionListener);
  }

  /**
   * @override
   * @public
   */
  dispose() {
    this.kit.selectedAtomProperty.unlink(this.toggleTargetVisibility);
    this.a.positionProperty.unlink(this.positionListener);
    this.b.positionProperty.unlink(this.positionListener);
    super.dispose();
  }
}
buildAMolecule.register('MoleculeBondNode', MoleculeBondNode);
export default MoleculeBondNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDaXJjbGUiLCJGaXJlTGlzdGVuZXIiLCJMaW5lIiwiTm9kZSIsInNjaXNzb3JzX2N1ciIsInNjaXNzb3JzX3BuZyIsInNjaXNzb3JzQ2xvc2VkX2N1ciIsInNjaXNzb3JzQ2xvc2VkX3BuZyIsInNjaXNzb3JzQ2xvc2VkVXBfY3VyIiwic2Npc3NvcnNDbG9zZWRVcF9wbmciLCJzY2lzc29yc1VwX2N1ciIsInNjaXNzb3JzVXBfcG5nIiwiYnVpbGRBTW9sZWN1bGUiLCJCQU1Db25zdGFudHMiLCJEaXJlY3Rpb24iLCJpbWFnZXMiLCJib25kUmFkaXVzIiwiTW9sZWN1bGVCb25kTm9kZSIsImNvbnN0cnVjdG9yIiwiYm9uZCIsImtpdCIsImEiLCJiIiwiYm9uZERpcmVjdGlvbiIsImdldEJvbmREaXJlY3Rpb24iLCJpc0hvcml6b250YWwiLCJXRVNUIiwiRUFTVCIsIm9wZW5GaWxlIiwiY2xvc2VkRmlsZSIsInNjaXNzb3JzT3BlbiIsInNjaXNzb3JzQ2xvc2VkIiwiYmFja3VwIiwib3BlbkN1cnNvciIsInNyYyIsImNsb3NlZEN1cnNvciIsImN1dFRhcmdldE5vZGUiLCJkYXNoZWRMaW5lIiwic3Ryb2tlIiwibGluZURhc2giLCJsaW5lV2lkdGgiLCJhZGRDaGlsZCIsInJvdGF0ZSIsIk1hdGgiLCJQSSIsImZpbGwiLCJjdXJzb3IiLCJ2aXNpYmxlIiwiYWRkSW5wdXRMaXN0ZW5lciIsImZpcmVPbkRvd24iLCJmaXJlIiwiYnJlYWtCb25kIiwicG9zaXRpb25MaXN0ZW5lciIsIm9yaWVudGF0aW9uIiwicG9zaXRpb25Qcm9wZXJ0eSIsInZhbHVlIiwibWludXMiLCJtYWduaXR1ZGUiLCJub3JtYWxpemUiLCJwb3NpdGlvbiIsInRpbWVzIiwiY292YWxlbnRSYWRpdXMiLCJwbHVzIiwic2V0VHJhbnNsYXRpb24iLCJNT0RFTF9WSUVXX1RSQU5TRk9STSIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJ0b2dnbGVUYXJnZXRWaXNpYmlsaXR5Iiwic2VsZWN0ZWRBdG9tIiwic2VsZWN0ZWRBdG9tUHJvcGVydHkiLCJsaW5rIiwiZGlzcG9zZSIsInVubGluayIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTW9sZWN1bGVCb25kTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBDb250YWlucyBcImJvbmQgYnJlYWtpbmdcIiBub2RlcyBmb3IgYSBzaW5nbGUgbW9sZWN1bGUsIHNvIHRoZXkgY2FuIGJlIGN1dCBhcGFydCB3aXRoIHNjaXNzb3JzXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICogQGF1dGhvciBEZW56ZWxsIEJhcm5ldHQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgQ2lyY2xlLCBGaXJlTGlzdGVuZXIsIExpbmUsIE5vZGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgc2Npc3NvcnNfY3VyIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9zY2lzc29yc19jdXIuanMnO1xyXG5pbXBvcnQgc2Npc3NvcnNfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9zY2lzc29yc19wbmcuanMnO1xyXG5pbXBvcnQgc2Npc3NvcnNDbG9zZWRfY3VyIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9zY2lzc29yc0Nsb3NlZF9jdXIuanMnO1xyXG5pbXBvcnQgc2Npc3NvcnNDbG9zZWRfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9zY2lzc29yc0Nsb3NlZF9wbmcuanMnO1xyXG5pbXBvcnQgc2Npc3NvcnNDbG9zZWRVcF9jdXIgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL3NjaXNzb3JzQ2xvc2VkVXBfY3VyLmpzJztcclxuaW1wb3J0IHNjaXNzb3JzQ2xvc2VkVXBfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9zY2lzc29yc0Nsb3NlZFVwX3BuZy5qcyc7XHJcbmltcG9ydCBzY2lzc29yc1VwX2N1ciBmcm9tICcuLi8uLi8uLi9pbWFnZXMvc2Npc3NvcnNVcF9jdXIuanMnO1xyXG5pbXBvcnQgc2Npc3NvcnNVcF9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL3NjaXNzb3JzVXBfcG5nLmpzJztcclxuaW1wb3J0IGJ1aWxkQU1vbGVjdWxlIGZyb20gJy4uLy4uL2J1aWxkQU1vbGVjdWxlLmpzJztcclxuaW1wb3J0IEJBTUNvbnN0YW50cyBmcm9tICcuLi9CQU1Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgRGlyZWN0aW9uIGZyb20gJy4uL21vZGVsL0RpcmVjdGlvbi5qcyc7XHJcblxyXG4vKiBOb3RlcyBvbiAuY3VyIGZpbGUgZ2VuZXJhdGlvbiwgYWxsIGZyb20gdGhlIGltYWdlcyBkaXJlY3RvcnksIHdpdGggXCJzdWRvIGFwdC1nZXQgaW5zdGFsbCBpY291dGlsc1wiIGZvciBpY290b29sOlxyXG4gaWNvdG9vbCAtYyAtbyBzY2lzc29ycy5pY28gc2Npc3NvcnMucG5nXHJcbiBpY290b29sIC1jIC1vIHNjaXNzb3JzLWNsb3NlZC5pY28gc2Npc3NvcnMtY2xvc2VkLnBuZ1xyXG4gaWNvdG9vbCAtYyAtbyBzY2lzc29ycy11cC5pY28gc2Npc3NvcnMtdXAucG5nXHJcbiBpY290b29sIC1jIC1vIHNjaXNzb3JzLWNsb3NlZC11cC5pY28gc2Npc3NvcnMtY2xvc2VkLXVwLnBuZ1xyXG5cclxuIC4vaWNvMmN1ci5weSBzY2lzc29ycy5pY28gLXggMTEgLXkgMTBcclxuIC4vaWNvMmN1ci5weSBzY2lzc29ycy1jbG9zZWQuaWNvIC14IDEzIC15IDdcclxuIC4vaWNvMmN1ci5weSBzY2lzc29ycy11cC5pY28gLXggMTAgLXkgMTFcclxuIC4vaWNvMmN1ci5weSBzY2lzc29ycy1jbG9zZWQtdXAuaWNvIC14IDcgLXkgMTNcclxuICovXHJcblxyXG5jb25zdCBpbWFnZXMgPSB7XHJcbiAgJ3NjaXNzb3JzLnBuZyc6IHNjaXNzb3JzX3BuZyxcclxuICAnc2Npc3NvcnMtY2xvc2VkLnBuZyc6IHNjaXNzb3JzQ2xvc2VkX3BuZyxcclxuICAnc2Npc3NvcnMtdXAucG5nJzogc2Npc3NvcnNVcF9wbmcsXHJcbiAgJ3NjaXNzb3JzLWNsb3NlZC11cC5wbmcnOiBzY2lzc29yc0Nsb3NlZFVwX3BuZyxcclxuICAnc2Npc3NvcnMuY3VyJzogc2Npc3NvcnNfY3VyLFxyXG4gICdzY2lzc29ycy1jbG9zZWQuY3VyJzogc2Npc3NvcnNDbG9zZWRfY3VyLFxyXG4gICdzY2lzc29ycy11cC5jdXInOiBzY2lzc29yc1VwX2N1cixcclxuICAnc2Npc3NvcnMtY2xvc2VkLXVwLmN1cic6IHNjaXNzb3JzQ2xvc2VkVXBfY3VyXHJcbn07XHJcbmNvbnN0IGJvbmRSYWRpdXMgPSA2OyAvLyBcIlJhZGl1c1wiIG9mIHRoZSBib25kIHRhcmdldCB0aGF0IHdpbGwgYnJlYWsgdGhlIGJvbmRcclxuXHJcbmNsYXNzIE1vbGVjdWxlQm9uZE5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuICAvKipcclxuICAgKiBAcGFyYW0ge0JvbmR9IGJvbmRcclxuICAgKiBAcGFyYW0ge0tpdH0ga2l0XHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGJvbmQsIGtpdCApIHtcclxuICAgIHN1cGVyKCB7fSApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtBdG9tMn1cclxuICAgIHRoaXMuYSA9IGJvbmQuYTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7QXRvbTJ9XHJcbiAgICB0aGlzLmIgPSBib25kLmI7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge0tpdH1cclxuICAgIHRoaXMua2l0ID0ga2l0O1xyXG5cclxuICAgIC8vIFVzZSB0aGUgbGV3aXMgZG90IG1vZGVsIHRvIGdldCBvdXIgYm9uZCBkaXJlY3Rpb25cclxuICAgIGNvbnN0IGJvbmREaXJlY3Rpb24gPSBraXQuZ2V0Qm9uZERpcmVjdGlvbiggdGhpcy5hLCB0aGlzLmIgKTtcclxuICAgIGNvbnN0IGlzSG9yaXpvbnRhbCA9IGJvbmREaXJlY3Rpb24gPT09IERpcmVjdGlvbi5XRVNUIHx8IGJvbmREaXJlY3Rpb24gPT09IERpcmVjdGlvbi5FQVNUO1xyXG5cclxuICAgIC8vIERlZmluZSBpbWFnZXMgZm9yIG9wZW5lZCBhbmQgY2xvc2VkIHNjaXNzb3JzXHJcbiAgICBsZXQgb3BlbkZpbGUgPSAnc2Npc3NvcnMnO1xyXG4gICAgbGV0IGNsb3NlZEZpbGUgPSAnc2Npc3NvcnMtY2xvc2VkJztcclxuICAgIGlmICggaXNIb3Jpem9udGFsICkge1xyXG4gICAgICBvcGVuRmlsZSArPSAnLXVwJztcclxuICAgICAgY2xvc2VkRmlsZSArPSAnLXVwJztcclxuICAgIH1cclxuICAgIG9wZW5GaWxlICs9ICcucG5nJztcclxuICAgIGNsb3NlZEZpbGUgKz0gJy5wbmcnO1xyXG5cclxuICAgIGNvbnN0IHNjaXNzb3JzT3BlbiA9IGltYWdlc1sgb3BlbkZpbGUgXTsgLy8gMjN4MjAgb3IgMjB4MjNcclxuICAgIGNvbnN0IHNjaXNzb3JzQ2xvc2VkID0gaW1hZ2VzWyBjbG9zZWRGaWxlIF07IC8vMjZ4MTUgb3IgMTV4MjZcclxuICAgIGNvbnN0IGJhY2t1cCA9ICggaXNIb3Jpem9udGFsID8gJ2NvbC1yZXNpemUnIDogJ3Jvdy1yZXNpemUnICk7XHJcblxyXG4gICAgLy8gT2Zmc2V0cyBzaG91bGQgY2VudGVyIHRoaXNcclxuICAgIGNvbnN0IG9wZW5DdXJzb3IgPSBgdXJsKCR7c2Npc3NvcnNPcGVuLnNyY30pICR7aXNIb3Jpem9udGFsID8gJzEwIDExJyA6ICcxMSAxMCd9LCAke2JhY2t1cH1gO1xyXG4gICAgY29uc3QgY2xvc2VkQ3Vyc29yID0gYHVybCgke3NjaXNzb3JzQ2xvc2VkLnNyY30pICR7aXNIb3Jpem9udGFsID8gJzcgMTMnIDogJzEzIDcnfSwgJHtiYWNrdXB9YDtcclxuXHJcbiAgICAvLyBDdXQgaGVyZSBpY29uIGlzIHN1YmplY3QgdG8gY2hhbmdlLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2J1aWxkLWEtbW9sZWN1bGUvaXNzdWVzLzExM1xyXG4gICAgY29uc3QgY3V0VGFyZ2V0Tm9kZSA9IG5ldyBOb2RlKCk7XHJcblxyXG4gICAgLy8gQWRkIGRhc2hlZCBsaW5lXHJcbiAgICBjb25zdCBkYXNoZWRMaW5lID0gbmV3IExpbmUoIC0xNSwgMCwgMTUsIDAsIHtcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBsaW5lRGFzaDogWyA0LjUsIDIgXSxcclxuICAgICAgbGluZVdpZHRoOiAxXHJcbiAgICB9ICk7XHJcbiAgICBjdXRUYXJnZXROb2RlLmFkZENoaWxkKCBkYXNoZWRMaW5lICk7XHJcbiAgICBpZiAoIGlzSG9yaXpvbnRhbCApIHtcclxuICAgICAgZGFzaGVkTGluZS5yb3RhdGUoIE1hdGguUEkgLyAyICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQWRkIGlubmVyIGNpcmNsZVxyXG4gICAgY3V0VGFyZ2V0Tm9kZS5hZGRDaGlsZCggbmV3IENpcmNsZSggYm9uZFJhZGl1cywge1xyXG4gICAgICBmaWxsOiAncmdiKDI1MywyMjUsNDkpJyxcclxuICAgICAgc3Ryb2tlOiAncmdiKDI1MywyMjUsNDkpJyxcclxuICAgICAgY3Vyc29yOiBvcGVuQ3Vyc29yLFxyXG4gICAgICB2aXNpYmxlOiB0cnVlXHJcbiAgICB9ICkgKTtcclxuXHJcbiAgICAvLyBBZGQgb3V0ZXIgY2lyY2xlXHJcbiAgICBjdXRUYXJnZXROb2RlLmFkZENoaWxkKCBuZXcgQ2lyY2xlKCBib25kUmFkaXVzICogMS41LCB7XHJcbiAgICAgIGZpbGw6ICdyZ2JhKDI1MywyMjUsNDksMC40KScsXHJcbiAgICAgIGN1cnNvcjogb3BlbkN1cnNvcixcclxuICAgICAgdmlzaWJsZTogdHJ1ZVxyXG4gICAgfSApICk7XHJcblxyXG4gICAgY3V0VGFyZ2V0Tm9kZS5hZGRJbnB1dExpc3RlbmVyKCBuZXcgRmlyZUxpc3RlbmVyKCB7XHJcbiAgICAgIGZpcmVPbkRvd246IHRydWUsXHJcbiAgICAgIGZpcmUoKSB7XHJcbiAgICAgICAgY3V0VGFyZ2V0Tm9kZS5jdXJzb3IgPSBjbG9zZWRDdXJzb3I7XHJcbiAgICAgICAga2l0LmJyZWFrQm9uZCggYm9uZC5hLCBib25kLmIgKTtcclxuICAgICAgfVxyXG4gICAgfSApICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBjdXRUYXJnZXROb2RlICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge2Z1bmN0aW9ufSBMaXN0ZW5lciB0aGF0IHdpbGwgdXBkYXRlIHRoZSBwb3NpdGlvbiBvZiBvdXIgaGl0IHRhcmdldFxyXG4gICAgdGhpcy5wb3NpdGlvbkxpc3RlbmVyID0gKCkgPT4ge1xyXG4gICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRoaXMuYi5wb3NpdGlvblByb3BlcnR5LnZhbHVlLm1pbnVzKCB0aGlzLmEucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgICBpZiAoIG9yaWVudGF0aW9uLm1hZ25pdHVkZSA+IDAgKSB7XHJcbiAgICAgICAgb3JpZW50YXRpb24ubm9ybWFsaXplKCk7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgcG9zaXRpb24gPSBvcmllbnRhdGlvbi50aW1lcyggdGhpcy5hLmNvdmFsZW50UmFkaXVzICkucGx1cyggdGhpcy5hLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgKTtcclxuICAgICAgdGhpcy5zZXRUcmFuc2xhdGlvbiggQkFNQ29uc3RhbnRzLk1PREVMX1ZJRVdfVFJBTlNGT1JNLm1vZGVsVG9WaWV3UG9zaXRpb24oIHBvc2l0aW9uICkgKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQHByaXZhdGUge2Z1bmN0aW9uKEF0b20yKX1cclxuICAgIHRoaXMudG9nZ2xlVGFyZ2V0VmlzaWJpbGl0eSA9IHNlbGVjdGVkQXRvbSA9PiB7XHJcbiAgICAgIGN1dFRhcmdldE5vZGUudmlzaWJsZSA9IHNlbGVjdGVkQXRvbSA9PT0gdGhpcy5hIHx8IHNlbGVjdGVkQXRvbSA9PT0gdGhpcy5iO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBMaW5rIHJlbGV2YW50IGVsZW1lbnRzXHJcbiAgICB0aGlzLmtpdC5zZWxlY3RlZEF0b21Qcm9wZXJ0eS5saW5rKCB0aGlzLnRvZ2dsZVRhcmdldFZpc2liaWxpdHkgKTtcclxuICAgIHRoaXMuYS5wb3NpdGlvblByb3BlcnR5LmxpbmsoIHRoaXMucG9zaXRpb25MaXN0ZW5lciApO1xyXG4gICAgdGhpcy5iLnBvc2l0aW9uUHJvcGVydHkubGluayggdGhpcy5wb3NpdGlvbkxpc3RlbmVyICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIHRoaXMua2l0LnNlbGVjdGVkQXRvbVByb3BlcnR5LnVubGluayggdGhpcy50b2dnbGVUYXJnZXRWaXNpYmlsaXR5ICk7XHJcbiAgICB0aGlzLmEucG9zaXRpb25Qcm9wZXJ0eS51bmxpbmsoIHRoaXMucG9zaXRpb25MaXN0ZW5lciApO1xyXG4gICAgdGhpcy5iLnBvc2l0aW9uUHJvcGVydHkudW5saW5rKCB0aGlzLnBvc2l0aW9uTGlzdGVuZXIgKTtcclxuXHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5idWlsZEFNb2xlY3VsZS5yZWdpc3RlciggJ01vbGVjdWxlQm9uZE5vZGUnLCBNb2xlY3VsZUJvbmROb2RlICk7XHJcbmV4cG9ydCBkZWZhdWx0IE1vbGVjdWxlQm9uZE5vZGU7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFNBQVNBLE1BQU0sRUFBRUMsWUFBWSxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDcEYsT0FBT0MsWUFBWSxNQUFNLGlDQUFpQztBQUMxRCxPQUFPQyxZQUFZLE1BQU0saUNBQWlDO0FBQzFELE9BQU9DLGtCQUFrQixNQUFNLHVDQUF1QztBQUN0RSxPQUFPQyxrQkFBa0IsTUFBTSx1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