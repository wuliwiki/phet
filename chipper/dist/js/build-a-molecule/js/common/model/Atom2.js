// Copyright 2020-2021, University of Colorado Boulder

/**
 * An atom, extended with position/destination information that is animated
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 * @author Denzell Barnett (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import Emitter from '../../../../axon/js/Emitter.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Vector2Property from '../../../../dot/js/Vector2Property.js';
import Atom from '../../../../nitroglycerin/js/Atom.js';
import buildAMolecule from '../../buildAMolecule.js';

// constants
const MOTION_VELOCITY = 800; // In picometers per second of sim time.

class Atom2 extends Atom {
  /**
   * @param {Element} element
   * @param {Emitter} stepEmitter
   */
  constructor(element, stepEmitter) {
    super(element);

    // @public {Vector2Property} Position of atom
    this.positionProperty = new Vector2Property(Vector2.ZERO);

    // @public {Vector2Property} Destination of atom
    this.destinationProperty = new Vector2Property(Vector2.ZERO);

    // @public {BooleanProperty}
    this.userControlledProperty = new BooleanProperty(false);
    this.visibleProperty = new BooleanProperty(true);

    // @public {Emitter} Responsible for grabbing and dropping an atom
    this.grabbedByUserEmitter = new Emitter({
      parameters: [{
        valueType: Atom2
      }]
    });
    this.droppedByUserEmitter = new Emitter({
      parameters: [{
        valueType: Atom2
      }]
    });

    // Atom exists for entire sim lifetime. No need to dispose.
    stepEmitter.addListener(this.step.bind(this));

    // Atom exists for entire sim life cycle. No need to dispose.
    this.userControlledProperty.lazyLink(controlled => {
      if (controlled) {
        this.grabbedByUserEmitter.emit(this);
      } else {
        this.droppedByUserEmitter.emit(this);
      }
    });
  }

  /**
   * Returns bounds of atom's position considering its covalent radius
   *
   * @public
   * @returns {Bounds2}
   */
  get positionBounds() {
    return Bounds2.point(this.positionProperty.value.x, this.positionProperty.value.y).dilated(this.covalentRadius);
  }

  /**
   * Returns bounds of atom's destination considering its covalent radius
   *
   * @public
   * @returns {Bounds2}
   */
  get destinationBounds() {
    return Bounds2.point(this.destinationProperty.value.x, this.destinationProperty.value.y).dilated(this.covalentRadius);
  }

  /**
   * @param {number} dt - time elapsed in seconds
   *
   * @public
   */
  step(dt) {
    this.stepAtomTowardsDestination(dt);
  }

  /**
   * Responsible stepping an atom towards its destination. Velocity of step is modified based on distance to destination.
   *
   * @param {number} dt
   * @private
   */
  stepAtomTowardsDestination(dt) {
    const distance = this.positionProperty.value.distance(this.destinationProperty.value);
    if (!this.userControlledProperty.value && distance !== 0) {
      // Move towards the current destination
      let distanceToTravel = MOTION_VELOCITY * dt;
      const distanceToTarget = distance;
      const farDistanceMultiple = 10; // if we are this many times away, we speed up

      // if we are far from the target, let's speed up the velocity
      if (distanceToTarget > distanceToTravel * farDistanceMultiple) {
        const extraDistance = distanceToTarget - distanceToTravel * farDistanceMultiple;
        distanceToTravel *= 1 + extraDistance / 300;
      }
      if (distanceToTravel >= distanceToTarget) {
        // Closer than one step, so just go there.
        this.positionProperty.value = this.destinationProperty.value;
      } else {
        // Move towards the destination.
        const angle = Math.atan2(this.destinationProperty.value.y - this.positionProperty.value.y, this.destinationProperty.value.x - this.positionProperty.value.x);
        this.translate(distanceToTravel * Math.cos(angle), distanceToTravel * Math.sin(angle));
      }
    }
  }

  /**
   * Add a vector to the current position and destination of the atom
   * @param {Vector2} delta
   *
   * @public
   */
  translatePositionAndDestination(delta) {
    this.positionProperty.value = this.positionProperty.value.plus(delta);
    this.destinationProperty.value = this.destinationProperty.value.plus(delta);
  }

  /**
   * Update the position and destination to a specific point
   * @param {Vector2} point
   *
   * @public
   */
  setPositionAndDestination(point) {
    this.positionProperty.value = point;
    this.destinationProperty.value = point;
  }

  /**
   * Update the position property to a new point
   * @param {number} x
   * @param {number} y
   *
   * @public
   */
  translate(x, y) {
    this.positionProperty.value = new Vector2(this.positionProperty.value.x + x, this.positionProperty.value.y + y);
  }

  /**
   * Reset the atom
   *
   * @public
   */
  reset() {
    this.positionProperty.reset();
    this.destinationProperty.reset();
    this.userControlledProperty.reset();
    this.visibleProperty.reset();
  }
}
buildAMolecule.register('Atom2', Atom2);
export default Atom2;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJFbWl0dGVyIiwiQm91bmRzMiIsIlZlY3RvcjIiLCJWZWN0b3IyUHJvcGVydHkiLCJBdG9tIiwiYnVpbGRBTW9sZWN1bGUiLCJNT1RJT05fVkVMT0NJVFkiLCJBdG9tMiIsImNvbnN0cnVjdG9yIiwiZWxlbWVudCIsInN0ZXBFbWl0dGVyIiwicG9zaXRpb25Qcm9wZXJ0eSIsIlpFUk8iLCJkZXN0aW5hdGlvblByb3BlcnR5IiwidXNlckNvbnRyb2xsZWRQcm9wZXJ0eSIsInZpc2libGVQcm9wZXJ0eSIsImdyYWJiZWRCeVVzZXJFbWl0dGVyIiwicGFyYW1ldGVycyIsInZhbHVlVHlwZSIsImRyb3BwZWRCeVVzZXJFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJzdGVwIiwiYmluZCIsImxhenlMaW5rIiwiY29udHJvbGxlZCIsImVtaXQiLCJwb3NpdGlvbkJvdW5kcyIsInBvaW50IiwidmFsdWUiLCJ4IiwieSIsImRpbGF0ZWQiLCJjb3ZhbGVudFJhZGl1cyIsImRlc3RpbmF0aW9uQm91bmRzIiwiZHQiLCJzdGVwQXRvbVRvd2FyZHNEZXN0aW5hdGlvbiIsImRpc3RhbmNlIiwiZGlzdGFuY2VUb1RyYXZlbCIsImRpc3RhbmNlVG9UYXJnZXQiLCJmYXJEaXN0YW5jZU11bHRpcGxlIiwiZXh0cmFEaXN0YW5jZSIsImFuZ2xlIiwiTWF0aCIsImF0YW4yIiwidHJhbnNsYXRlIiwiY29zIiwic2luIiwidHJhbnNsYXRlUG9zaXRpb25BbmREZXN0aW5hdGlvbiIsImRlbHRhIiwicGx1cyIsInNldFBvc2l0aW9uQW5kRGVzdGluYXRpb24iLCJyZXNldCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQXRvbTIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjAtMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQW4gYXRvbSwgZXh0ZW5kZWQgd2l0aCBwb3NpdGlvbi9kZXN0aW5hdGlvbiBpbmZvcm1hdGlvbiB0aGF0IGlzIGFuaW1hdGVkXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICogQGF1dGhvciBEZW56ZWxsIEJhcm5ldHQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBFbWl0dGVyIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRW1pdHRlci5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMlByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQXRvbSBmcm9tICcuLi8uLi8uLi8uLi9uaXRyb2dseWNlcmluL2pzL0F0b20uanMnO1xyXG5pbXBvcnQgYnVpbGRBTW9sZWN1bGUgZnJvbSAnLi4vLi4vYnVpbGRBTW9sZWN1bGUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE1PVElPTl9WRUxPQ0lUWSA9IDgwMDsgLy8gSW4gcGljb21ldGVycyBwZXIgc2Vjb25kIG9mIHNpbSB0aW1lLlxyXG5cclxuY2xhc3MgQXRvbTIgZXh0ZW5kcyBBdG9tIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50XHJcbiAgICogQHBhcmFtIHtFbWl0dGVyfSBzdGVwRW1pdHRlclxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBlbGVtZW50LCBzdGVwRW1pdHRlciApIHtcclxuICAgIHN1cGVyKCBlbGVtZW50ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7VmVjdG9yMlByb3BlcnR5fSBQb3NpdGlvbiBvZiBhdG9tXHJcbiAgICB0aGlzLnBvc2l0aW9uUHJvcGVydHkgPSBuZXcgVmVjdG9yMlByb3BlcnR5KCBWZWN0b3IyLlpFUk8gKTtcclxuXHJcbiAgICAvLyBAcHVibGljIHtWZWN0b3IyUHJvcGVydHl9IERlc3RpbmF0aW9uIG9mIGF0b21cclxuICAgIHRoaXMuZGVzdGluYXRpb25Qcm9wZXJ0eSA9IG5ldyBWZWN0b3IyUHJvcGVydHkoIFZlY3RvcjIuWkVSTyApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge0Jvb2xlYW5Qcm9wZXJ0eX1cclxuICAgIHRoaXMudXNlckNvbnRyb2xsZWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlICk7XHJcbiAgICB0aGlzLnZpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUgKTtcclxuXHJcbiAgICAvLyBAcHVibGljIHtFbWl0dGVyfSBSZXNwb25zaWJsZSBmb3IgZ3JhYmJpbmcgYW5kIGRyb3BwaW5nIGFuIGF0b21cclxuICAgIHRoaXMuZ3JhYmJlZEJ5VXNlckVtaXR0ZXIgPSBuZXcgRW1pdHRlciggeyBwYXJhbWV0ZXJzOiBbIHsgdmFsdWVUeXBlOiBBdG9tMiB9IF0gfSApO1xyXG4gICAgdGhpcy5kcm9wcGVkQnlVc2VyRW1pdHRlciA9IG5ldyBFbWl0dGVyKCB7IHBhcmFtZXRlcnM6IFsgeyB2YWx1ZVR5cGU6IEF0b20yIH0gXSB9ICk7XHJcblxyXG4gICAgLy8gQXRvbSBleGlzdHMgZm9yIGVudGlyZSBzaW0gbGlmZXRpbWUuIE5vIG5lZWQgdG8gZGlzcG9zZS5cclxuICAgIHN0ZXBFbWl0dGVyLmFkZExpc3RlbmVyKCB0aGlzLnN0ZXAuYmluZCggdGhpcyApICk7XHJcblxyXG4gICAgLy8gQXRvbSBleGlzdHMgZm9yIGVudGlyZSBzaW0gbGlmZSBjeWNsZS4gTm8gbmVlZCB0byBkaXNwb3NlLlxyXG4gICAgdGhpcy51c2VyQ29udHJvbGxlZFByb3BlcnR5LmxhenlMaW5rKCBjb250cm9sbGVkID0+IHtcclxuICAgICAgaWYgKCBjb250cm9sbGVkICkge1xyXG4gICAgICAgIHRoaXMuZ3JhYmJlZEJ5VXNlckVtaXR0ZXIuZW1pdCggdGhpcyApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMuZHJvcHBlZEJ5VXNlckVtaXR0ZXIuZW1pdCggdGhpcyApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIGJvdW5kcyBvZiBhdG9tJ3MgcG9zaXRpb24gY29uc2lkZXJpbmcgaXRzIGNvdmFsZW50IHJhZGl1c1xyXG4gICAqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEByZXR1cm5zIHtCb3VuZHMyfVxyXG4gICAqL1xyXG4gIGdldCBwb3NpdGlvbkJvdW5kcygpIHtcclxuICAgIHJldHVybiBCb3VuZHMyLnBvaW50KCB0aGlzLnBvc2l0aW9uUHJvcGVydHkudmFsdWUueCwgdGhpcy5wb3NpdGlvblByb3BlcnR5LnZhbHVlLnkgKS5kaWxhdGVkKCB0aGlzLmNvdmFsZW50UmFkaXVzICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIGJvdW5kcyBvZiBhdG9tJ3MgZGVzdGluYXRpb24gY29uc2lkZXJpbmcgaXRzIGNvdmFsZW50IHJhZGl1c1xyXG4gICAqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEByZXR1cm5zIHtCb3VuZHMyfVxyXG4gICAqL1xyXG4gIGdldCBkZXN0aW5hdGlvbkJvdW5kcygpIHtcclxuICAgIHJldHVybiBCb3VuZHMyLnBvaW50KCB0aGlzLmRlc3RpbmF0aW9uUHJvcGVydHkudmFsdWUueCwgdGhpcy5kZXN0aW5hdGlvblByb3BlcnR5LnZhbHVlLnkgKS5kaWxhdGVkKCB0aGlzLmNvdmFsZW50UmFkaXVzICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHQgLSB0aW1lIGVsYXBzZWQgaW4gc2Vjb25kc1xyXG4gICAqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHN0ZXAoIGR0ICkge1xyXG4gICAgdGhpcy5zdGVwQXRvbVRvd2FyZHNEZXN0aW5hdGlvbiggZHQgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3BvbnNpYmxlIHN0ZXBwaW5nIGFuIGF0b20gdG93YXJkcyBpdHMgZGVzdGluYXRpb24uIFZlbG9jaXR5IG9mIHN0ZXAgaXMgbW9kaWZpZWQgYmFzZWQgb24gZGlzdGFuY2UgdG8gZGVzdGluYXRpb24uXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHRcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIHN0ZXBBdG9tVG93YXJkc0Rlc3RpbmF0aW9uKCBkdCApIHtcclxuICAgIGNvbnN0IGRpc3RhbmNlID0gdGhpcy5wb3NpdGlvblByb3BlcnR5LnZhbHVlLmRpc3RhbmNlKCB0aGlzLmRlc3RpbmF0aW9uUHJvcGVydHkudmFsdWUgKTtcclxuICAgIGlmICggIXRoaXMudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS52YWx1ZSAmJiBkaXN0YW5jZSAhPT0gMCApIHtcclxuXHJcbiAgICAgIC8vIE1vdmUgdG93YXJkcyB0aGUgY3VycmVudCBkZXN0aW5hdGlvblxyXG4gICAgICBsZXQgZGlzdGFuY2VUb1RyYXZlbCA9IE1PVElPTl9WRUxPQ0lUWSAqIGR0O1xyXG4gICAgICBjb25zdCBkaXN0YW5jZVRvVGFyZ2V0ID0gZGlzdGFuY2U7XHJcblxyXG4gICAgICBjb25zdCBmYXJEaXN0YW5jZU11bHRpcGxlID0gMTA7IC8vIGlmIHdlIGFyZSB0aGlzIG1hbnkgdGltZXMgYXdheSwgd2Ugc3BlZWQgdXBcclxuXHJcbiAgICAgIC8vIGlmIHdlIGFyZSBmYXIgZnJvbSB0aGUgdGFyZ2V0LCBsZXQncyBzcGVlZCB1cCB0aGUgdmVsb2NpdHlcclxuICAgICAgaWYgKCBkaXN0YW5jZVRvVGFyZ2V0ID4gZGlzdGFuY2VUb1RyYXZlbCAqIGZhckRpc3RhbmNlTXVsdGlwbGUgKSB7XHJcbiAgICAgICAgY29uc3QgZXh0cmFEaXN0YW5jZSA9IGRpc3RhbmNlVG9UYXJnZXQgLSBkaXN0YW5jZVRvVHJhdmVsICogZmFyRGlzdGFuY2VNdWx0aXBsZTtcclxuICAgICAgICBkaXN0YW5jZVRvVHJhdmVsICo9IDEgKyBleHRyYURpc3RhbmNlIC8gMzAwO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICggZGlzdGFuY2VUb1RyYXZlbCA+PSBkaXN0YW5jZVRvVGFyZ2V0ICkge1xyXG5cclxuICAgICAgICAvLyBDbG9zZXIgdGhhbiBvbmUgc3RlcCwgc28ganVzdCBnbyB0aGVyZS5cclxuICAgICAgICB0aGlzLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgPSB0aGlzLmRlc3RpbmF0aW9uUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgIC8vIE1vdmUgdG93YXJkcyB0aGUgZGVzdGluYXRpb24uXHJcbiAgICAgICAgY29uc3QgYW5nbGUgPSBNYXRoLmF0YW4yKCB0aGlzLmRlc3RpbmF0aW9uUHJvcGVydHkudmFsdWUueSAtIHRoaXMucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS55LFxyXG4gICAgICAgICAgdGhpcy5kZXN0aW5hdGlvblByb3BlcnR5LnZhbHVlLnggLSB0aGlzLnBvc2l0aW9uUHJvcGVydHkudmFsdWUueCApO1xyXG4gICAgICAgIHRoaXMudHJhbnNsYXRlKCBkaXN0YW5jZVRvVHJhdmVsICogTWF0aC5jb3MoIGFuZ2xlICksIGRpc3RhbmNlVG9UcmF2ZWwgKiBNYXRoLnNpbiggYW5nbGUgKSApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGQgYSB2ZWN0b3IgdG8gdGhlIGN1cnJlbnQgcG9zaXRpb24gYW5kIGRlc3RpbmF0aW9uIG9mIHRoZSBhdG9tXHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBkZWx0YVxyXG4gICAqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHRyYW5zbGF0ZVBvc2l0aW9uQW5kRGVzdGluYXRpb24oIGRlbHRhICkge1xyXG4gICAgdGhpcy5wb3NpdGlvblByb3BlcnR5LnZhbHVlID0gdGhpcy5wb3NpdGlvblByb3BlcnR5LnZhbHVlLnBsdXMoIGRlbHRhICk7XHJcbiAgICB0aGlzLmRlc3RpbmF0aW9uUHJvcGVydHkudmFsdWUgPSB0aGlzLmRlc3RpbmF0aW9uUHJvcGVydHkudmFsdWUucGx1cyggZGVsdGEgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSB0aGUgcG9zaXRpb24gYW5kIGRlc3RpbmF0aW9uIHRvIGEgc3BlY2lmaWMgcG9pbnRcclxuICAgKiBAcGFyYW0ge1ZlY3RvcjJ9IHBvaW50XHJcbiAgICpcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc2V0UG9zaXRpb25BbmREZXN0aW5hdGlvbiggcG9pbnQgKSB7XHJcbiAgICB0aGlzLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgPSBwb2ludDtcclxuICAgIHRoaXMuZGVzdGluYXRpb25Qcm9wZXJ0eS52YWx1ZSA9IHBvaW50O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIHRoZSBwb3NpdGlvbiBwcm9wZXJ0eSB0byBhIG5ldyBwb2ludFxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB4XHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHlcclxuICAgKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICB0cmFuc2xhdGUoIHgsIHkgKSB7XHJcbiAgICB0aGlzLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgPSBuZXcgVmVjdG9yMiggdGhpcy5wb3NpdGlvblByb3BlcnR5LnZhbHVlLnggKyB4LCB0aGlzLnBvc2l0aW9uUHJvcGVydHkudmFsdWUueSArIHkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc2V0IHRoZSBhdG9tXHJcbiAgICpcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLnBvc2l0aW9uUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuZGVzdGluYXRpb25Qcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy51c2VyQ29udHJvbGxlZFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnZpc2libGVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gIH1cclxufVxyXG5cclxuYnVpbGRBTW9sZWN1bGUucmVnaXN0ZXIoICdBdG9tMicsIEF0b20yICk7XHJcbmV4cG9ydCBkZWZhdWx0IEF0b20yOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsT0FBTyxNQUFNLGdDQUFnQztBQUNwRCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsZUFBZSxNQUFNLHVDQUF1QztBQUNuRSxPQUFPQyxJQUFJLE1BQU0sc0NBQXNDO0FBQ3ZELE9BQU9DLGNBQWMsTUFBTSx5QkFBeUI7O0FBRXBEO0FBQ0EsTUFBTUMsZUFBZSxHQUFHLEdBQUcsQ0FBQyxDQUFDOztBQUU3QixNQUFNQyxLQUFLLFNBQVNILElBQUksQ0FBQztFQUV2QjtBQUNGO0FBQ0E7QUFDQTtFQUNFSSxXQUFXQSxDQUFFQyxPQUFPLEVBQUVDLFdBQVcsRUFBRztJQUNsQyxLQUFLLENBQUVELE9BQVEsQ0FBQzs7SUFFaEI7SUFDQSxJQUFJLENBQUNFLGdCQUFnQixHQUFHLElBQUlSLGVBQWUsQ0FBRUQsT0FBTyxDQUFDVSxJQUFLLENBQUM7O0lBRTNEO0lBQ0EsSUFBSSxDQUFDQyxtQkFBbUIsR0FBRyxJQUFJVixlQUFlLENBQUVELE9BQU8sQ0FBQ1UsSUFBSyxDQUFDOztJQUU5RDtJQUNBLElBQUksQ0FBQ0Usc0JBQXNCLEdBQUcsSUFBSWYsZUFBZSxDQUFFLEtBQU0sQ0FBQztJQUMxRCxJQUFJLENBQUNnQixlQUFlLEdBQUcsSUFBSWhC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