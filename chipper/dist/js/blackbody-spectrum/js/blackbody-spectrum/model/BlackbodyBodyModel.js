// Copyright 2014-2022, University of Colorado Boulder

/**
 * Model that holds and calculates all the numerical data for a Blackbody spectrum at a given temperature
 *
 * @author Martin Veillette (Berea College)
 * @author Saurabh Totey
 * @author Arnab Purkayastha
 */

import Property from '../../../../axon/js/Property.js';
import Range from '../../../../dot/js/Range.js';
import Utils from '../../../../dot/js/Utils.js';
import { Color } from '../../../../scenery/js/imports.js';
import NullableIO from '../../../../tandem/js/types/NullableIO.js';
import NumberIO from '../../../../tandem/js/types/NumberIO.js';
import BlackbodyConstants from '../../BlackbodyConstants.js';
import blackbodySpectrum from '../../blackbodySpectrum.js';

// constants
// colors used for glowing star and circles
const RED_WAVELENGTH = 650; // red wavelength in nanometers
const GREEN_WAVELENGTH = 550; // green wavelength in nanometers
const BLUE_WAVELENGTH = 450; // blue wavelength in nanometers
const GLOWING_STAR_HALO_MINIMUM_RADIUS = 5; // in pixels
const GLOWING_STAR_HALO_MAXIMUM_RADIUS = 100; // in pixels

class BlackbodyBodyModel {
  /**
   * Constructs a Blackbody body at the given temperature
   * @param {number|null} temperature
   * @param {Tandem} tandem
   */
  constructor(temperature, tandem) {
    // @public {Property.<number|null>}
    this.temperatureProperty = new Property(temperature, {
      tandem: tandem.createTandem('temperatureProperty'),
      phetioValueType: NullableIO(NumberIO),
      phetioDocumentation: 'Determines the temperature of the blackbody. Saved bodies have a null temperature when ' + 'they don\'t exist in the simulation.'
    });

    // guard for performance
    if (assert) {
      const validTemperatureRange = new Range(BlackbodyConstants.minTemperature, BlackbodyConstants.maxTemperature);

      // validate the temperature since we can't use NumberProperty validation
      this.temperatureProperty.link(temperature => {
        temperature !== null && assert(validTemperatureRange.contains(temperature), `temperature out of range: ${temperature}`);
      });
    }
  }

  /**
   * Resets the model's temperature and settings
   * @public
   */
  reset() {
    this.temperatureProperty.reset();
  }

  /**
   * Function that returns the spectral power density at a given wavelength (in nm)
   * The units of spectral power density are in megaWatts per meter^2 per micrometer
   * Equation in use is Planck's Law which returns a spectral radiance of a Blackbody given a temperature and wavelength
   * Planck's law is that spectral radiance = 2hc^2 / ( l^5 * ( e^( hc / lkt ) - 1 ) )
   * This spectral radiance is multiplied by pi to retrieve the spectral power density
   * h is Planck's constant, c is the speed of light, l is wavelength, k is the Boltzmann constant, and t is the temperature
   * @public
   * @param {number} wavelength
   * @returns {number}
   */
  getSpectralPowerDensityAt(wavelength) {
    // Avoiding division by 0
    if (wavelength === 0) {
      return 0;
    }
    const A = 3.74192e-16; // is 2πhc^2 in units of watts*m^2
    const B = 1.438770e7; // is hc/k in units of nanometer-kelvin
    return A / (Math.pow(wavelength, 5) * (Math.exp(B / (wavelength * this.temperatureProperty.value)) - 1));
  }

  /**
   * Returns a dimensionless temperature parameter
   * Equation uses a standard normalization function with an additional power exponent to help low temperatures be
   * more visible.
   * @private
   * @returns {number}
   */
  getRenormalizedTemperature() {
    assert && assert(this.temperatureProperty.value >= BlackbodyConstants.minTemperature, `Temperature set lower than minimum: ${BlackbodyConstants.minTemperature}`);
    const powerExponent = 0.5; // used to minimize scaling of halo at high temperatures
    const draperPoint = 798; // in Kelvin
    const normalizationScaling = 0.02; // determined empirically

    const relativeTemp = Math.max(this.temperatureProperty.value, draperPoint) - draperPoint;
    return normalizationScaling * Math.pow(relativeTemp, powerExponent);
  }
  get renormalizedTemperature() {
    return this.getRenormalizedTemperature();
  }

  /**
   * Function that returns a color intensity (an integer ranging from 0 to 255) for a given wavelength
   * @private
   * @param {number} wavelength - in nanometers
   * @returns {number}
   */
  getRenormalizedColorIntensity(wavelength) {
    const red = this.getSpectralPowerDensityAt(RED_WAVELENGTH); // intensity as a function of wavelength in nm
    const green = this.getSpectralPowerDensityAt(GREEN_WAVELENGTH);
    const blue = this.getSpectralPowerDensityAt(BLUE_WAVELENGTH);
    const largestColorIntensity = Math.max(red, green, blue);
    const colorIntensity = this.getSpectralPowerDensityAt(wavelength);
    const boundedRenormalizedTemp = Math.min(this.renormalizedTemperature, 1);
    return Math.floor(255 * boundedRenormalizedTemp * colorIntensity / largestColorIntensity);
  }

  /**
   * Function that returns the total intensity (area under the curve) of the blackbody
   * Equation in use is the Stefan–Boltzmann Law: Intensity = σT^4
   * σ is the Stefan-Boltzmann constant, T is the temperature
   * @public
   * @returns {number}
   */
  getTotalIntensity() {
    const STEFAN_BOLTZMANN_CONSTANT = 5.670373e-8; // is equal to sigma in units of watts/(m^2*K^4)
    return STEFAN_BOLTZMANN_CONSTANT * Math.pow(this.temperatureProperty.value, 4);
  }
  get totalIntensity() {
    return this.getTotalIntensity();
  }

  /**
   * Function that returns the peak wavelength (in nanometers) of the blackbody
   * Equation in use is Wien's displacement Law: Peak wavelength = b / T
   * b is Wien's displacement constant, T is the temperature
   * @public
   * @returns {number}
   */
  getPeakWavelength() {
    assert && assert(this.temperatureProperty.value > 0, 'Temperature must be positive');
    const WIEN_CONSTANT = 2.897773e-3; // is equal to b in units of meters-kelvin
    return 1e9 * WIEN_CONSTANT / this.temperatureProperty.value;
  }
  get peakWavelength() {
    return this.getPeakWavelength();
  }

  /**
   * Function that returns a red color with an intensity that matches the blackbody temperature
   * @public
   * @returns {Color}
   */
  getRedColor() {
    const colorIntensity = this.getRenormalizedColorIntensity(RED_WAVELENGTH);
    return new Color(colorIntensity, 0, 0, 1);
  }
  get redColor() {
    return this.getRedColor();
  }

  /**
   * Function that returns a blue color with an intensity that matches the blackbody temperature
   * @public
   * @returns {Color}
   */
  getBlueColor() {
    const colorIntensity = this.getRenormalizedColorIntensity(BLUE_WAVELENGTH);
    return new Color(0, 0, colorIntensity, 1);
  }
  get blueColor() {
    return this.getBlueColor();
  }

  /**
   * Function that returns a green color with an intensity that matches the blackbody temperature
   * @public
   * @returns {Color}
   */
  getGreenColor() {
    const colorIntensity = this.getRenormalizedColorIntensity(GREEN_WAVELENGTH);
    return new Color(0, colorIntensity, 0, 1);
  }
  get greenColor() {
    return this.getGreenColor();
  }

  /**
   * Function that returns a radius (in scenery coordinates) for a given temperature.
   * The radius increases as the temperature increases
   * @public
   * @returns {number}
   */
  getGlowingStarHaloRadius() {
    return Utils.linear(0, 2, GLOWING_STAR_HALO_MINIMUM_RADIUS, GLOWING_STAR_HALO_MAXIMUM_RADIUS, this.renormalizedTemperature);
  }
  get glowingStarHaloRadius() {
    return this.getGlowingStarHaloRadius();
  }

  /**
   * Function that returns a color corresponding to the temperature of the star.
   * In addition, it sets the transparency (less transparent as the temperature increases)
   * @public
   * @returns {Color}
   */
  getGlowingStarHaloColor() {
    const alpha = Utils.linear(0, 1, 0, 0.3, this.renormalizedTemperature); // temperature -> transparency
    return this.starColor.withAlpha(alpha);
  }
  get glowingStarHaloColor() {
    return this.getGlowingStarHaloColor();
  }

  /**
   * Function that returns a color corresponding the temperature of a star
   * The star is approximated as a blackbody
   * @public
   * @returns {Color}
   */
  getStarColor() {
    const red = this.getRenormalizedColorIntensity(RED_WAVELENGTH);
    const green = this.getRenormalizedColorIntensity(GREEN_WAVELENGTH);
    const blue = this.getRenormalizedColorIntensity(BLUE_WAVELENGTH);
    return new Color(red, green, blue, 1);
  }
  get starColor() {
    return this.getStarColor();
  }
}
blackbodySpectrum.register('BlackbodyBodyModel', BlackbodyBodyModel);
export default BlackbodyBodyModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIlJhbmdlIiwiVXRpbHMiLCJDb2xvciIsIk51bGxhYmxlSU8iLCJOdW1iZXJJTyIsIkJsYWNrYm9keUNvbnN0YW50cyIsImJsYWNrYm9keVNwZWN0cnVtIiwiUkVEX1dBVkVMRU5HVEgiLCJHUkVFTl9XQVZFTEVOR1RIIiwiQkxVRV9XQVZFTEVOR1RIIiwiR0xPV0lOR19TVEFSX0hBTE9fTUlOSU1VTV9SQURJVVMiLCJHTE9XSU5HX1NUQVJfSEFMT19NQVhJTVVNX1JBRElVUyIsIkJsYWNrYm9keUJvZHlNb2RlbCIsImNvbnN0cnVjdG9yIiwidGVtcGVyYXR1cmUiLCJ0YW5kZW0iLCJ0ZW1wZXJhdHVyZVByb3BlcnR5IiwiY3JlYXRlVGFuZGVtIiwicGhldGlvVmFsdWVUeXBlIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsImFzc2VydCIsInZhbGlkVGVtcGVyYXR1cmVSYW5nZSIsIm1pblRlbXBlcmF0dXJlIiwibWF4VGVtcGVyYXR1cmUiLCJsaW5rIiwiY29udGFpbnMiLCJyZXNldCIsImdldFNwZWN0cmFsUG93ZXJEZW5zaXR5QXQiLCJ3YXZlbGVuZ3RoIiwiQSIsIkIiLCJNYXRoIiwicG93IiwiZXhwIiwidmFsdWUiLCJnZXRSZW5vcm1hbGl6ZWRUZW1wZXJhdHVyZSIsInBvd2VyRXhwb25lbnQiLCJkcmFwZXJQb2ludCIsIm5vcm1hbGl6YXRpb25TY2FsaW5nIiwicmVsYXRpdmVUZW1wIiwibWF4IiwicmVub3JtYWxpemVkVGVtcGVyYXR1cmUiLCJnZXRSZW5vcm1hbGl6ZWRDb2xvckludGVuc2l0eSIsInJlZCIsImdyZWVuIiwiYmx1ZSIsImxhcmdlc3RDb2xvckludGVuc2l0eSIsImNvbG9ySW50ZW5zaXR5IiwiYm91bmRlZFJlbm9ybWFsaXplZFRlbXAiLCJtaW4iLCJmbG9vciIsImdldFRvdGFsSW50ZW5zaXR5IiwiU1RFRkFOX0JPTFRaTUFOTl9DT05TVEFOVCIsInRvdGFsSW50ZW5zaXR5IiwiZ2V0UGVha1dhdmVsZW5ndGgiLCJXSUVOX0NPTlNUQU5UIiwicGVha1dhdmVsZW5ndGgiLCJnZXRSZWRDb2xvciIsInJlZENvbG9yIiwiZ2V0Qmx1ZUNvbG9yIiwiYmx1ZUNvbG9yIiwiZ2V0R3JlZW5Db2xvciIsImdyZWVuQ29sb3IiLCJnZXRHbG93aW5nU3RhckhhbG9SYWRpdXMiLCJsaW5lYXIiLCJnbG93aW5nU3RhckhhbG9SYWRpdXMiLCJnZXRHbG93aW5nU3RhckhhbG9Db2xvciIsImFscGhhIiwic3RhckNvbG9yIiwid2l0aEFscGhhIiwiZ2xvd2luZ1N0YXJIYWxvQ29sb3IiLCJnZXRTdGFyQ29sb3IiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkJsYWNrYm9keUJvZHlNb2RlbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBNb2RlbCB0aGF0IGhvbGRzIGFuZCBjYWxjdWxhdGVzIGFsbCB0aGUgbnVtZXJpY2FsIGRhdGEgZm9yIGEgQmxhY2tib2R5IHNwZWN0cnVtIGF0IGEgZ2l2ZW4gdGVtcGVyYXR1cmVcclxuICpcclxuICogQGF1dGhvciBNYXJ0aW4gVmVpbGxldHRlIChCZXJlYSBDb2xsZWdlKVxyXG4gKiBAYXV0aG9yIFNhdXJhYmggVG90ZXlcclxuICogQGF1dGhvciBBcm5hYiBQdXJrYXlhc3RoYVxyXG4gKi9cclxuXHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFJhbmdlIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgeyBDb2xvciB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBOdWxsYWJsZUlPIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdWxsYWJsZUlPLmpzJztcclxuaW1wb3J0IE51bWJlcklPIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdW1iZXJJTy5qcyc7XHJcbmltcG9ydCBCbGFja2JvZHlDb25zdGFudHMgZnJvbSAnLi4vLi4vQmxhY2tib2R5Q29uc3RhbnRzLmpzJztcclxuaW1wb3J0IGJsYWNrYm9keVNwZWN0cnVtIGZyb20gJy4uLy4uL2JsYWNrYm9keVNwZWN0cnVtLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG4vLyBjb2xvcnMgdXNlZCBmb3IgZ2xvd2luZyBzdGFyIGFuZCBjaXJjbGVzXHJcbmNvbnN0IFJFRF9XQVZFTEVOR1RIID0gNjUwOyAvLyByZWQgd2F2ZWxlbmd0aCBpbiBuYW5vbWV0ZXJzXHJcbmNvbnN0IEdSRUVOX1dBVkVMRU5HVEggPSA1NTA7IC8vIGdyZWVuIHdhdmVsZW5ndGggaW4gbmFub21ldGVyc1xyXG5jb25zdCBCTFVFX1dBVkVMRU5HVEggPSA0NTA7IC8vIGJsdWUgd2F2ZWxlbmd0aCBpbiBuYW5vbWV0ZXJzXHJcbmNvbnN0IEdMT1dJTkdfU1RBUl9IQUxPX01JTklNVU1fUkFESVVTID0gNTsgLy8gaW4gcGl4ZWxzXHJcbmNvbnN0IEdMT1dJTkdfU1RBUl9IQUxPX01BWElNVU1fUkFESVVTID0gMTAwOyAvLyBpbiBwaXhlbHNcclxuXHJcbmNsYXNzIEJsYWNrYm9keUJvZHlNb2RlbCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnN0cnVjdHMgYSBCbGFja2JvZHkgYm9keSBhdCB0aGUgZ2l2ZW4gdGVtcGVyYXR1cmVcclxuICAgKiBAcGFyYW0ge251bWJlcnxudWxsfSB0ZW1wZXJhdHVyZVxyXG4gICAqIEBwYXJhbSB7VGFuZGVtfSB0YW5kZW1cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggdGVtcGVyYXR1cmUsIHRhbmRlbSApIHtcclxuXHJcbiAgICAvLyBAcHVibGljIHtQcm9wZXJ0eS48bnVtYmVyfG51bGw+fVxyXG4gICAgdGhpcy50ZW1wZXJhdHVyZVByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCB0ZW1wZXJhdHVyZSwge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd0ZW1wZXJhdHVyZVByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9WYWx1ZVR5cGU6IE51bGxhYmxlSU8oIE51bWJlcklPICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdEZXRlcm1pbmVzIHRoZSB0ZW1wZXJhdHVyZSBvZiB0aGUgYmxhY2tib2R5LiBTYXZlZCBib2RpZXMgaGF2ZSBhIG51bGwgdGVtcGVyYXR1cmUgd2hlbiAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RoZXkgZG9uXFwndCBleGlzdCBpbiB0aGUgc2ltdWxhdGlvbi4nXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gZ3VhcmQgZm9yIHBlcmZvcm1hbmNlXHJcbiAgICBpZiAoIGFzc2VydCApIHtcclxuICAgICAgY29uc3QgdmFsaWRUZW1wZXJhdHVyZVJhbmdlID0gbmV3IFJhbmdlKCBCbGFja2JvZHlDb25zdGFudHMubWluVGVtcGVyYXR1cmUsIEJsYWNrYm9keUNvbnN0YW50cy5tYXhUZW1wZXJhdHVyZSApO1xyXG5cclxuICAgICAgLy8gdmFsaWRhdGUgdGhlIHRlbXBlcmF0dXJlIHNpbmNlIHdlIGNhbid0IHVzZSBOdW1iZXJQcm9wZXJ0eSB2YWxpZGF0aW9uXHJcbiAgICAgIHRoaXMudGVtcGVyYXR1cmVQcm9wZXJ0eS5saW5rKCB0ZW1wZXJhdHVyZSA9PiB7XHJcbiAgICAgICAgdGVtcGVyYXR1cmUgIT09IG51bGwgJiZcclxuICAgICAgICBhc3NlcnQoIHZhbGlkVGVtcGVyYXR1cmVSYW5nZS5jb250YWlucyggdGVtcGVyYXR1cmUgKSwgYHRlbXBlcmF0dXJlIG91dCBvZiByYW5nZTogJHt0ZW1wZXJhdHVyZX1gICk7XHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc2V0cyB0aGUgbW9kZWwncyB0ZW1wZXJhdHVyZSBhbmQgc2V0dGluZ3NcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLnRlbXBlcmF0dXJlUHJvcGVydHkucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgc3BlY3RyYWwgcG93ZXIgZGVuc2l0eSBhdCBhIGdpdmVuIHdhdmVsZW5ndGggKGluIG5tKVxyXG4gICAqIFRoZSB1bml0cyBvZiBzcGVjdHJhbCBwb3dlciBkZW5zaXR5IGFyZSBpbiBtZWdhV2F0dHMgcGVyIG1ldGVyXjIgcGVyIG1pY3JvbWV0ZXJcclxuICAgKiBFcXVhdGlvbiBpbiB1c2UgaXMgUGxhbmNrJ3MgTGF3IHdoaWNoIHJldHVybnMgYSBzcGVjdHJhbCByYWRpYW5jZSBvZiBhIEJsYWNrYm9keSBnaXZlbiBhIHRlbXBlcmF0dXJlIGFuZCB3YXZlbGVuZ3RoXHJcbiAgICogUGxhbmNrJ3MgbGF3IGlzIHRoYXQgc3BlY3RyYWwgcmFkaWFuY2UgPSAyaGNeMiAvICggbF41ICogKCBlXiggaGMgLyBsa3QgKSAtIDEgKSApXHJcbiAgICogVGhpcyBzcGVjdHJhbCByYWRpYW5jZSBpcyBtdWx0aXBsaWVkIGJ5IHBpIHRvIHJldHJpZXZlIHRoZSBzcGVjdHJhbCBwb3dlciBkZW5zaXR5XHJcbiAgICogaCBpcyBQbGFuY2sncyBjb25zdGFudCwgYyBpcyB0aGUgc3BlZWQgb2YgbGlnaHQsIGwgaXMgd2F2ZWxlbmd0aCwgayBpcyB0aGUgQm9sdHptYW5uIGNvbnN0YW50LCBhbmQgdCBpcyB0aGUgdGVtcGVyYXR1cmVcclxuICAgKiBAcHVibGljXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHdhdmVsZW5ndGhcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqL1xyXG4gIGdldFNwZWN0cmFsUG93ZXJEZW5zaXR5QXQoIHdhdmVsZW5ndGggKSB7XHJcblxyXG4gICAgLy8gQXZvaWRpbmcgZGl2aXNpb24gYnkgMFxyXG4gICAgaWYgKCB3YXZlbGVuZ3RoID09PSAwICkge1xyXG4gICAgICByZXR1cm4gMDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBBID0gMy43NDE5MmUtMTY7IC8vIGlzIDLPgGhjXjIgaW4gdW5pdHMgb2Ygd2F0dHMqbV4yXHJcbiAgICBjb25zdCBCID0gMS40Mzg3NzBlNzsgLy8gaXMgaGMvayBpbiB1bml0cyBvZiBuYW5vbWV0ZXIta2VsdmluXHJcbiAgICByZXR1cm4gQSAvICggTWF0aC5wb3coIHdhdmVsZW5ndGgsIDUgKSAqICggTWF0aC5leHAoIEIgLyAoIHdhdmVsZW5ndGggKiB0aGlzLnRlbXBlcmF0dXJlUHJvcGVydHkudmFsdWUgKSApIC0gMSApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIGEgZGltZW5zaW9ubGVzcyB0ZW1wZXJhdHVyZSBwYXJhbWV0ZXJcclxuICAgKiBFcXVhdGlvbiB1c2VzIGEgc3RhbmRhcmQgbm9ybWFsaXphdGlvbiBmdW5jdGlvbiB3aXRoIGFuIGFkZGl0aW9uYWwgcG93ZXIgZXhwb25lbnQgdG8gaGVscCBsb3cgdGVtcGVyYXR1cmVzIGJlXHJcbiAgICogbW9yZSB2aXNpYmxlLlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHJldHVybnMge251bWJlcn1cclxuICAgKi9cclxuICBnZXRSZW5vcm1hbGl6ZWRUZW1wZXJhdHVyZSgpIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMudGVtcGVyYXR1cmVQcm9wZXJ0eS52YWx1ZSA+PSBCbGFja2JvZHlDb25zdGFudHMubWluVGVtcGVyYXR1cmUsXHJcbiAgICAgIGBUZW1wZXJhdHVyZSBzZXQgbG93ZXIgdGhhbiBtaW5pbXVtOiAke0JsYWNrYm9keUNvbnN0YW50cy5taW5UZW1wZXJhdHVyZX1gICk7XHJcbiAgICBjb25zdCBwb3dlckV4cG9uZW50ID0gMC41OyAvLyB1c2VkIHRvIG1pbmltaXplIHNjYWxpbmcgb2YgaGFsbyBhdCBoaWdoIHRlbXBlcmF0dXJlc1xyXG4gICAgY29uc3QgZHJhcGVyUG9pbnQgPSA3OTg7IC8vIGluIEtlbHZpblxyXG4gICAgY29uc3Qgbm9ybWFsaXphdGlvblNjYWxpbmcgPSAwLjAyOyAvLyBkZXRlcm1pbmVkIGVtcGlyaWNhbGx5XHJcblxyXG4gICAgY29uc3QgcmVsYXRpdmVUZW1wID0gTWF0aC5tYXgoIHRoaXMudGVtcGVyYXR1cmVQcm9wZXJ0eS52YWx1ZSwgZHJhcGVyUG9pbnQgKSAtIGRyYXBlclBvaW50O1xyXG4gICAgcmV0dXJuIG5vcm1hbGl6YXRpb25TY2FsaW5nICogTWF0aC5wb3coIHJlbGF0aXZlVGVtcCwgcG93ZXJFeHBvbmVudCApO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHJlbm9ybWFsaXplZFRlbXBlcmF0dXJlKCkgeyByZXR1cm4gdGhpcy5nZXRSZW5vcm1hbGl6ZWRUZW1wZXJhdHVyZSgpOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIGNvbG9yIGludGVuc2l0eSAoYW4gaW50ZWdlciByYW5naW5nIGZyb20gMCB0byAyNTUpIGZvciBhIGdpdmVuIHdhdmVsZW5ndGhcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB3YXZlbGVuZ3RoIC0gaW4gbmFub21ldGVyc1xyXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9XHJcbiAgICovXHJcbiAgZ2V0UmVub3JtYWxpemVkQ29sb3JJbnRlbnNpdHkoIHdhdmVsZW5ndGggKSB7XHJcbiAgICBjb25zdCByZWQgPSB0aGlzLmdldFNwZWN0cmFsUG93ZXJEZW5zaXR5QXQoIFJFRF9XQVZFTEVOR1RIICk7IC8vIGludGVuc2l0eSBhcyBhIGZ1bmN0aW9uIG9mIHdhdmVsZW5ndGggaW4gbm1cclxuICAgIGNvbnN0IGdyZWVuID0gdGhpcy5nZXRTcGVjdHJhbFBvd2VyRGVuc2l0eUF0KCBHUkVFTl9XQVZFTEVOR1RIICk7XHJcbiAgICBjb25zdCBibHVlID0gdGhpcy5nZXRTcGVjdHJhbFBvd2VyRGVuc2l0eUF0KCBCTFVFX1dBVkVMRU5HVEggKTtcclxuICAgIGNvbnN0IGxhcmdlc3RDb2xvckludGVuc2l0eSA9IE1hdGgubWF4KCByZWQsIGdyZWVuLCBibHVlICk7XHJcbiAgICBjb25zdCBjb2xvckludGVuc2l0eSA9IHRoaXMuZ2V0U3BlY3RyYWxQb3dlckRlbnNpdHlBdCggd2F2ZWxlbmd0aCApO1xyXG4gICAgY29uc3QgYm91bmRlZFJlbm9ybWFsaXplZFRlbXAgPSBNYXRoLm1pbiggdGhpcy5yZW5vcm1hbGl6ZWRUZW1wZXJhdHVyZSwgMSApO1xyXG4gICAgcmV0dXJuIE1hdGguZmxvb3IoIDI1NSAqIGJvdW5kZWRSZW5vcm1hbGl6ZWRUZW1wICogY29sb3JJbnRlbnNpdHkgLyBsYXJnZXN0Q29sb3JJbnRlbnNpdHkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgdG90YWwgaW50ZW5zaXR5IChhcmVhIHVuZGVyIHRoZSBjdXJ2ZSkgb2YgdGhlIGJsYWNrYm9keVxyXG4gICAqIEVxdWF0aW9uIGluIHVzZSBpcyB0aGUgU3RlZmFu4oCTQm9sdHptYW5uIExhdzogSW50ZW5zaXR5ID0gz4NUXjRcclxuICAgKiDPgyBpcyB0aGUgU3RlZmFuLUJvbHR6bWFubiBjb25zdGFudCwgVCBpcyB0aGUgdGVtcGVyYXR1cmVcclxuICAgKiBAcHVibGljXHJcbiAgICogQHJldHVybnMge251bWJlcn1cclxuICAgKi9cclxuICBnZXRUb3RhbEludGVuc2l0eSgpIHtcclxuICAgIGNvbnN0IFNURUZBTl9CT0xUWk1BTk5fQ09OU1RBTlQgPSA1LjY3MDM3M2UtODsgLy8gaXMgZXF1YWwgdG8gc2lnbWEgaW4gdW5pdHMgb2Ygd2F0dHMvKG1eMipLXjQpXHJcbiAgICByZXR1cm4gU1RFRkFOX0JPTFRaTUFOTl9DT05TVEFOVCAqIE1hdGgucG93KCB0aGlzLnRlbXBlcmF0dXJlUHJvcGVydHkudmFsdWUsIDQgKTtcclxuICB9XHJcblxyXG4gIGdldCB0b3RhbEludGVuc2l0eSgpIHsgcmV0dXJuIHRoaXMuZ2V0VG90YWxJbnRlbnNpdHkoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBGdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlIHBlYWsgd2F2ZWxlbmd0aCAoaW4gbmFub21ldGVycykgb2YgdGhlIGJsYWNrYm9keVxyXG4gICAqIEVxdWF0aW9uIGluIHVzZSBpcyBXaWVuJ3MgZGlzcGxhY2VtZW50IExhdzogUGVhayB3YXZlbGVuZ3RoID0gYiAvIFRcclxuICAgKiBiIGlzIFdpZW4ncyBkaXNwbGFjZW1lbnQgY29uc3RhbnQsIFQgaXMgdGhlIHRlbXBlcmF0dXJlXHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9XHJcbiAgICovXHJcbiAgZ2V0UGVha1dhdmVsZW5ndGgoKSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLnRlbXBlcmF0dXJlUHJvcGVydHkudmFsdWUgPiAwLCAnVGVtcGVyYXR1cmUgbXVzdCBiZSBwb3NpdGl2ZScgKTtcclxuICAgIGNvbnN0IFdJRU5fQ09OU1RBTlQgPSAyLjg5Nzc3M2UtMzsgLy8gaXMgZXF1YWwgdG8gYiBpbiB1bml0cyBvZiBtZXRlcnMta2VsdmluXHJcbiAgICByZXR1cm4gMWU5ICogV0lFTl9DT05TVEFOVCAvIHRoaXMudGVtcGVyYXR1cmVQcm9wZXJ0eS52YWx1ZTtcclxuICB9XHJcblxyXG4gIGdldCBwZWFrV2F2ZWxlbmd0aCgpIHsgcmV0dXJuIHRoaXMuZ2V0UGVha1dhdmVsZW5ndGgoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBGdW5jdGlvbiB0aGF0IHJldHVybnMgYSByZWQgY29sb3Igd2l0aCBhbiBpbnRlbnNpdHkgdGhhdCBtYXRjaGVzIHRoZSBibGFja2JvZHkgdGVtcGVyYXR1cmVcclxuICAgKiBAcHVibGljXHJcbiAgICogQHJldHVybnMge0NvbG9yfVxyXG4gICAqL1xyXG4gIGdldFJlZENvbG9yKCkge1xyXG4gICAgY29uc3QgY29sb3JJbnRlbnNpdHkgPSB0aGlzLmdldFJlbm9ybWFsaXplZENvbG9ySW50ZW5zaXR5KCBSRURfV0FWRUxFTkdUSCApO1xyXG4gICAgcmV0dXJuIG5ldyBDb2xvciggY29sb3JJbnRlbnNpdHksIDAsIDAsIDEgKTtcclxuICB9XHJcblxyXG4gIGdldCByZWRDb2xvcigpIHsgcmV0dXJuIHRoaXMuZ2V0UmVkQ29sb3IoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBGdW5jdGlvbiB0aGF0IHJldHVybnMgYSBibHVlIGNvbG9yIHdpdGggYW4gaW50ZW5zaXR5IHRoYXQgbWF0Y2hlcyB0aGUgYmxhY2tib2R5IHRlbXBlcmF0dXJlXHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEByZXR1cm5zIHtDb2xvcn1cclxuICAgKi9cclxuICBnZXRCbHVlQ29sb3IoKSB7XHJcbiAgICBjb25zdCBjb2xvckludGVuc2l0eSA9IHRoaXMuZ2V0UmVub3JtYWxpemVkQ29sb3JJbnRlbnNpdHkoIEJMVUVfV0FWRUxFTkdUSCApO1xyXG4gICAgcmV0dXJuIG5ldyBDb2xvciggMCwgMCwgY29sb3JJbnRlbnNpdHksIDEgKTtcclxuICB9XHJcblxyXG4gIGdldCBibHVlQ29sb3IoKSB7IHJldHVybiB0aGlzLmdldEJsdWVDb2xvcigpOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIGdyZWVuIGNvbG9yIHdpdGggYW4gaW50ZW5zaXR5IHRoYXQgbWF0Y2hlcyB0aGUgYmxhY2tib2R5IHRlbXBlcmF0dXJlXHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEByZXR1cm5zIHtDb2xvcn1cclxuICAgKi9cclxuICBnZXRHcmVlbkNvbG9yKCkge1xyXG4gICAgY29uc3QgY29sb3JJbnRlbnNpdHkgPSB0aGlzLmdldFJlbm9ybWFsaXplZENvbG9ySW50ZW5zaXR5KCBHUkVFTl9XQVZFTEVOR1RIICk7XHJcbiAgICByZXR1cm4gbmV3IENvbG9yKCAwLCBjb2xvckludGVuc2l0eSwgMCwgMSApO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGdyZWVuQ29sb3IoKSB7IHJldHVybiB0aGlzLmdldEdyZWVuQ29sb3IoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBGdW5jdGlvbiB0aGF0IHJldHVybnMgYSByYWRpdXMgKGluIHNjZW5lcnkgY29vcmRpbmF0ZXMpIGZvciBhIGdpdmVuIHRlbXBlcmF0dXJlLlxyXG4gICAqIFRoZSByYWRpdXMgaW5jcmVhc2VzIGFzIHRoZSB0ZW1wZXJhdHVyZSBpbmNyZWFzZXNcclxuICAgKiBAcHVibGljXHJcbiAgICogQHJldHVybnMge251bWJlcn1cclxuICAgKi9cclxuICBnZXRHbG93aW5nU3RhckhhbG9SYWRpdXMoKSB7XHJcbiAgICByZXR1cm4gVXRpbHMubGluZWFyKFxyXG4gICAgICAwLFxyXG4gICAgICAyLFxyXG4gICAgICBHTE9XSU5HX1NUQVJfSEFMT19NSU5JTVVNX1JBRElVUyxcclxuICAgICAgR0xPV0lOR19TVEFSX0hBTE9fTUFYSU1VTV9SQURJVVMsXHJcbiAgICAgIHRoaXMucmVub3JtYWxpemVkVGVtcGVyYXR1cmVcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXQgZ2xvd2luZ1N0YXJIYWxvUmFkaXVzKCkgeyByZXR1cm4gdGhpcy5nZXRHbG93aW5nU3RhckhhbG9SYWRpdXMoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBGdW5jdGlvbiB0aGF0IHJldHVybnMgYSBjb2xvciBjb3JyZXNwb25kaW5nIHRvIHRoZSB0ZW1wZXJhdHVyZSBvZiB0aGUgc3Rhci5cclxuICAgKiBJbiBhZGRpdGlvbiwgaXQgc2V0cyB0aGUgdHJhbnNwYXJlbmN5IChsZXNzIHRyYW5zcGFyZW50IGFzIHRoZSB0ZW1wZXJhdHVyZSBpbmNyZWFzZXMpXHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEByZXR1cm5zIHtDb2xvcn1cclxuICAgKi9cclxuICBnZXRHbG93aW5nU3RhckhhbG9Db2xvcigpIHtcclxuICAgIGNvbnN0IGFscGhhID0gVXRpbHMubGluZWFyKCAwLCAxLCAwLCAwLjMsIHRoaXMucmVub3JtYWxpemVkVGVtcGVyYXR1cmUgKTsgLy8gdGVtcGVyYXR1cmUgLT4gdHJhbnNwYXJlbmN5XHJcbiAgICByZXR1cm4gdGhpcy5zdGFyQ29sb3Iud2l0aEFscGhhKCBhbHBoYSApO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGdsb3dpbmdTdGFySGFsb0NvbG9yKCkgeyByZXR1cm4gdGhpcy5nZXRHbG93aW5nU3RhckhhbG9Db2xvcigpOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIGNvbG9yIGNvcnJlc3BvbmRpbmcgdGhlIHRlbXBlcmF0dXJlIG9mIGEgc3RhclxyXG4gICAqIFRoZSBzdGFyIGlzIGFwcHJveGltYXRlZCBhcyBhIGJsYWNrYm9keVxyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAcmV0dXJucyB7Q29sb3J9XHJcbiAgICovXHJcbiAgZ2V0U3RhckNvbG9yKCkge1xyXG4gICAgY29uc3QgcmVkID0gdGhpcy5nZXRSZW5vcm1hbGl6ZWRDb2xvckludGVuc2l0eSggUkVEX1dBVkVMRU5HVEggKTtcclxuICAgIGNvbnN0IGdyZWVuID0gdGhpcy5nZXRSZW5vcm1hbGl6ZWRDb2xvckludGVuc2l0eSggR1JFRU5fV0FWRUxFTkdUSCApO1xyXG4gICAgY29uc3QgYmx1ZSA9IHRoaXMuZ2V0UmVub3JtYWxpemVkQ29sb3JJbnRlbnNpdHkoIEJMVUVfV0FWRUxFTkdUSCApO1xyXG4gICAgcmV0dXJuIG5ldyBDb2xvciggcmVkLCBncmVlbiwgYmx1ZSwgMSApO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHN0YXJDb2xvcigpIHsgcmV0dXJuIHRoaXMuZ2V0U3RhckNvbG9yKCk7IH1cclxuXHJcbn1cclxuXHJcbmJsYWNrYm9keVNwZWN0cnVtLnJlZ2lzdGVyKCAnQmxhY2tib2R5Qm9keU1vZGVsJywgQmxhY2tib2R5Qm9keU1vZGVsICk7XHJcbmV4cG9ydCBkZWZhdWx0IEJsYWNrYm9keUJvZHlNb2RlbDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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