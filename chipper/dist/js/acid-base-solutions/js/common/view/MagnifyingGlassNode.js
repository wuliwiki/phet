// Copyright 2014-2022, University of Colorado Boulder

/**
 * MagnifyingGlass view.
 * For performance, draws particle directly to Canvas using drawImage.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import { Shape } from '../../../../kite/js/imports.js';
import { Circle, Image, Node, Path, Rectangle } from '../../../../scenery/js/imports.js';
import solvent_png from '../../../images/solvent_png.js';
import acidBaseSolutions from '../../acidBaseSolutions.js';
import ParticlesNode from './ParticlesNode.js';
import BooleanIO from '../../../../tandem/js/types/BooleanIO.js';

// constants
const SHOW_ORIGIN = false; // draws a red circle at the origin, for debugging
const CLIPPING_ENABLED = true; // set to false for debugging particle positions
const LENS_LINE_WIDTH = 8;
export default class MagnifyingGlassNode extends Node {
  constructor(magnifyingGlass, viewModeProperty, solventVisibleProperty, tandem) {
    // lens
    const RADIUS = magnifyingGlass.radius;
    const lensShape = Shape.circle(0, 0, RADIUS);
    const lensNode = new Path(lensShape, {
      stroke: 'black',
      lineWidth: LENS_LINE_WIDTH
    });

    // handle
    const handleNode = new Rectangle(RADIUS + 2, -RADIUS / 7, RADIUS * 0.9, RADIUS / 4, 5, 5, {
      fill: 'rgb( 85, 55, 33 )',
      stroke: 'black',
      lineWidth: 1
    });
    handleNode.rotate(Math.PI / 6);

    // opaque background, so we don't see things like pH paper in magnifyingGlass
    const waterNode = new Circle(RADIUS, {
      fill: 'rgb(210,231,235)'
    });

    // solvent (H2O)
    const solventNode = new Image(solvent_png, {
      visibleProperty: solventVisibleProperty,
      imageOpacity: 0.6,
      // reduce opacity so that other particles stand out more
      centerX: 0,
      centerY: 0
    });

    // particles
    const particlesNode = new ParticlesNode(magnifyingGlass, new Bounds2(-RADIUS, -RADIUS, RADIUS, RADIUS), LENS_LINE_WIDTH, tandem.createTandem('particlesNode'));

    // stuff that's visible through (and therefore clipped to) the lens
    const viewportNode = new Node({
      children: [solventNode, particlesNode]
    });
    if (CLIPPING_ENABLED) {
      viewportNode.clipArea = lensShape;
    }
    const children = [waterNode, viewportNode, handleNode, lensNode];
    if (SHOW_ORIGIN) {
      children.push(new Circle(10, {
        fill: 'red'
      }));
    }
    super({
      children: children,
      translation: magnifyingGlass.position,
      visibleProperty: new DerivedProperty([viewModeProperty], viewMode => viewMode === 'particles', {
        tandem: tandem.createTandem('visibleProperty'),
        phetioValueType: BooleanIO
      }),
      tandem: tandem
    });
    this.particlesNode = particlesNode;
    this.solventNode = solventNode;

    // Observe the strength and concentration Properties for the selected solution.
    const updateParticlesBound = this.updateParticles.bind(this);
    magnifyingGlass.solutionTypeProperty.link((newSolutionType, previousSolutionType) => {
      this.particlesNode.reset();

      // unlink from previous solution
      if (previousSolutionType) {
        const previousSolution = magnifyingGlass.solutionsMap.get(previousSolutionType);
        assert && assert(previousSolution);
        previousSolution.strengthProperty.unlink(updateParticlesBound);
        previousSolution.concentrationProperty.unlink(updateParticlesBound);
      }

      // link to new solution
      const newSolution = magnifyingGlass.solutionsMap.get(newSolutionType);
      assert && assert(newSolution);
      newSolution.strengthProperty.link(updateParticlesBound);
      newSolution.concentrationProperty.link(updateParticlesBound);
    });

    // Update when this Node becomes visible.
    this.visibleProperty.link(visible => visible && this.updateParticles());
    this.addLinkedElement(magnifyingGlass, {
      tandem: tandem.createTandem(magnifyingGlass.tandem.name)
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }

  /*
   * Updates the number of particles visible.
   * To improve performance, updates only when this node is visible.
   */
  updateParticles() {
    if (this.visible) {
      this.particlesNode.update();
    }
  }
}
acidBaseSolutions.register('MagnifyingGlassNode', MagnifyingGlassNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJCb3VuZHMyIiwiU2hhcGUiLCJDaXJjbGUiLCJJbWFnZSIsIk5vZGUiLCJQYXRoIiwiUmVjdGFuZ2xlIiwic29sdmVudF9wbmciLCJhY2lkQmFzZVNvbHV0aW9ucyIsIlBhcnRpY2xlc05vZGUiLCJCb29sZWFuSU8iLCJTSE9XX09SSUdJTiIsIkNMSVBQSU5HX0VOQUJMRUQiLCJMRU5TX0xJTkVfV0lEVEgiLCJNYWduaWZ5aW5nR2xhc3NOb2RlIiwiY29uc3RydWN0b3IiLCJtYWduaWZ5aW5nR2xhc3MiLCJ2aWV3TW9kZVByb3BlcnR5Iiwic29sdmVudFZpc2libGVQcm9wZXJ0eSIsInRhbmRlbSIsIlJBRElVUyIsInJhZGl1cyIsImxlbnNTaGFwZSIsImNpcmNsZSIsImxlbnNOb2RlIiwic3Ryb2tlIiwibGluZVdpZHRoIiwiaGFuZGxlTm9kZSIsImZpbGwiLCJyb3RhdGUiLCJNYXRoIiwiUEkiLCJ3YXRlck5vZGUiLCJzb2x2ZW50Tm9kZSIsInZpc2libGVQcm9wZXJ0eSIsImltYWdlT3BhY2l0eSIsImNlbnRlclgiLCJjZW50ZXJZIiwicGFydGljbGVzTm9kZSIsImNyZWF0ZVRhbmRlbSIsInZpZXdwb3J0Tm9kZSIsImNoaWxkcmVuIiwiY2xpcEFyZWEiLCJwdXNoIiwidHJhbnNsYXRpb24iLCJwb3NpdGlvbiIsInZpZXdNb2RlIiwicGhldGlvVmFsdWVUeXBlIiwidXBkYXRlUGFydGljbGVzQm91bmQiLCJ1cGRhdGVQYXJ0aWNsZXMiLCJiaW5kIiwic29sdXRpb25UeXBlUHJvcGVydHkiLCJsaW5rIiwibmV3U29sdXRpb25UeXBlIiwicHJldmlvdXNTb2x1dGlvblR5cGUiLCJyZXNldCIsInByZXZpb3VzU29sdXRpb24iLCJzb2x1dGlvbnNNYXAiLCJnZXQiLCJhc3NlcnQiLCJzdHJlbmd0aFByb3BlcnR5IiwidW5saW5rIiwiY29uY2VudHJhdGlvblByb3BlcnR5IiwibmV3U29sdXRpb24iLCJ2aXNpYmxlIiwiYWRkTGlua2VkRWxlbWVudCIsIm5hbWUiLCJkaXNwb3NlIiwidXBkYXRlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJNYWduaWZ5aW5nR2xhc3NOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIE1hZ25pZnlpbmdHbGFzcyB2aWV3LlxyXG4gKiBGb3IgcGVyZm9ybWFuY2UsIGRyYXdzIHBhcnRpY2xlIGRpcmVjdGx5IHRvIENhbnZhcyB1c2luZyBkcmF3SW1hZ2UuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgeyBDaXJjbGUsIEltYWdlLCBOb2RlLCBQYXRoLCBSZWN0YW5nbGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgc29sdmVudF9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL3NvbHZlbnRfcG5nLmpzJztcclxuaW1wb3J0IGFjaWRCYXNlU29sdXRpb25zIGZyb20gJy4uLy4uL2FjaWRCYXNlU29sdXRpb25zLmpzJztcclxuaW1wb3J0IE1hZ25pZnlpbmdHbGFzcyBmcm9tICcuLi9tb2RlbC9NYWduaWZ5aW5nR2xhc3MuanMnO1xyXG5pbXBvcnQgUGFydGljbGVzTm9kZSBmcm9tICcuL1BhcnRpY2xlc05vZGUuanMnO1xyXG5pbXBvcnQgeyBWaWV3TW9kZSB9IGZyb20gJy4vVmlld01vZGUuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgU3RyaW5nVW5pb25Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1N0cmluZ1VuaW9uUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb29sZWFuSU8gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0Jvb2xlYW5JTy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgU0hPV19PUklHSU4gPSBmYWxzZTsgLy8gZHJhd3MgYSByZWQgY2lyY2xlIGF0IHRoZSBvcmlnaW4sIGZvciBkZWJ1Z2dpbmdcclxuY29uc3QgQ0xJUFBJTkdfRU5BQkxFRCA9IHRydWU7IC8vIHNldCB0byBmYWxzZSBmb3IgZGVidWdnaW5nIHBhcnRpY2xlIHBvc2l0aW9uc1xyXG5jb25zdCBMRU5TX0xJTkVfV0lEVEggPSA4O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWFnbmlmeWluZ0dsYXNzTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IHNvbHZlbnROb2RlOiBOb2RlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcGFydGljbGVzTm9kZTogUGFydGljbGVzTm9kZTtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBtYWduaWZ5aW5nR2xhc3M6IE1hZ25pZnlpbmdHbGFzcywgdmlld01vZGVQcm9wZXJ0eTogU3RyaW5nVW5pb25Qcm9wZXJ0eTxWaWV3TW9kZT4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBzb2x2ZW50VmlzaWJsZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPiwgdGFuZGVtOiBUYW5kZW0gKSB7XHJcblxyXG4gICAgLy8gbGVuc1xyXG4gICAgY29uc3QgUkFESVVTID0gbWFnbmlmeWluZ0dsYXNzLnJhZGl1cztcclxuICAgIGNvbnN0IGxlbnNTaGFwZSA9IFNoYXBlLmNpcmNsZSggMCwgMCwgUkFESVVTICk7XHJcbiAgICBjb25zdCBsZW5zTm9kZSA9IG5ldyBQYXRoKCBsZW5zU2hhcGUsIHsgc3Ryb2tlOiAnYmxhY2snLCBsaW5lV2lkdGg6IExFTlNfTElORV9XSURUSCB9ICk7XHJcblxyXG4gICAgLy8gaGFuZGxlXHJcbiAgICBjb25zdCBoYW5kbGVOb2RlID0gbmV3IFJlY3RhbmdsZSggUkFESVVTICsgMiwgLVJBRElVUyAvIDcsIFJBRElVUyAqIDAuOSwgUkFESVVTIC8gNCwgNSwgNSwge1xyXG4gICAgICBmaWxsOiAncmdiKCA4NSwgNTUsIDMzICknLFxyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGxpbmVXaWR0aDogMVxyXG4gICAgfSApO1xyXG4gICAgaGFuZGxlTm9kZS5yb3RhdGUoIE1hdGguUEkgLyA2ICk7XHJcblxyXG4gICAgLy8gb3BhcXVlIGJhY2tncm91bmQsIHNvIHdlIGRvbid0IHNlZSB0aGluZ3MgbGlrZSBwSCBwYXBlciBpbiBtYWduaWZ5aW5nR2xhc3NcclxuICAgIGNvbnN0IHdhdGVyTm9kZSA9IG5ldyBDaXJjbGUoIFJBRElVUywgeyBmaWxsOiAncmdiKDIxMCwyMzEsMjM1KScgfSApO1xyXG5cclxuICAgIC8vIHNvbHZlbnQgKEgyTylcclxuICAgIGNvbnN0IHNvbHZlbnROb2RlID0gbmV3IEltYWdlKCBzb2x2ZW50X3BuZywge1xyXG4gICAgICB2aXNpYmxlUHJvcGVydHk6IHNvbHZlbnRWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgIGltYWdlT3BhY2l0eTogMC42LCAgLy8gcmVkdWNlIG9wYWNpdHkgc28gdGhhdCBvdGhlciBwYXJ0aWNsZXMgc3RhbmQgb3V0IG1vcmVcclxuICAgICAgY2VudGVyWDogMCxcclxuICAgICAgY2VudGVyWTogMFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHBhcnRpY2xlc1xyXG4gICAgY29uc3QgcGFydGljbGVzTm9kZSA9IG5ldyBQYXJ0aWNsZXNOb2RlKCBtYWduaWZ5aW5nR2xhc3MsIG5ldyBCb3VuZHMyKCAtUkFESVVTLCAtUkFESVVTLCBSQURJVVMsIFJBRElVUyApLFxyXG4gICAgICBMRU5TX0xJTkVfV0lEVEgsIHRhbmRlbS5jcmVhdGVUYW5kZW0oICdwYXJ0aWNsZXNOb2RlJyApICk7XHJcblxyXG4gICAgLy8gc3R1ZmYgdGhhdCdzIHZpc2libGUgdGhyb3VnaCAoYW5kIHRoZXJlZm9yZSBjbGlwcGVkIHRvKSB0aGUgbGVuc1xyXG4gICAgY29uc3Qgdmlld3BvcnROb2RlID0gbmV3IE5vZGUoIHsgY2hpbGRyZW46IFsgc29sdmVudE5vZGUsIHBhcnRpY2xlc05vZGUgXSB9ICk7XHJcbiAgICBpZiAoIENMSVBQSU5HX0VOQUJMRUQgKSB7XHJcbiAgICAgIHZpZXdwb3J0Tm9kZS5jbGlwQXJlYSA9IGxlbnNTaGFwZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjaGlsZHJlbjogTm9kZVtdID0gWyB3YXRlck5vZGUsIHZpZXdwb3J0Tm9kZSwgaGFuZGxlTm9kZSwgbGVuc05vZGUgXTtcclxuICAgIGlmICggU0hPV19PUklHSU4gKSB7XHJcbiAgICAgIGNoaWxkcmVuLnB1c2goIG5ldyBDaXJjbGUoIDEwLCB7IGZpbGw6ICdyZWQnIH0gKSApO1xyXG4gICAgfVxyXG5cclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbixcclxuICAgICAgdHJhbnNsYXRpb246IG1hZ25pZnlpbmdHbGFzcy5wb3NpdGlvbixcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIHZpZXdNb2RlUHJvcGVydHkgXSwgdmlld01vZGUgPT4gKCB2aWV3TW9kZSA9PT0gJ3BhcnRpY2xlcycgKSwge1xyXG4gICAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Zpc2libGVQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9WYWx1ZVR5cGU6IEJvb2xlYW5JT1xyXG4gICAgICB9ICksXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5wYXJ0aWNsZXNOb2RlID0gcGFydGljbGVzTm9kZTtcclxuICAgIHRoaXMuc29sdmVudE5vZGUgPSBzb2x2ZW50Tm9kZTtcclxuXHJcbiAgICAvLyBPYnNlcnZlIHRoZSBzdHJlbmd0aCBhbmQgY29uY2VudHJhdGlvbiBQcm9wZXJ0aWVzIGZvciB0aGUgc2VsZWN0ZWQgc29sdXRpb24uXHJcbiAgICBjb25zdCB1cGRhdGVQYXJ0aWNsZXNCb3VuZCA9IHRoaXMudXBkYXRlUGFydGljbGVzLmJpbmQoIHRoaXMgKTtcclxuICAgIG1hZ25pZnlpbmdHbGFzcy5zb2x1dGlvblR5cGVQcm9wZXJ0eS5saW5rKCAoIG5ld1NvbHV0aW9uVHlwZSwgcHJldmlvdXNTb2x1dGlvblR5cGUgKSA9PiB7XHJcblxyXG4gICAgICB0aGlzLnBhcnRpY2xlc05vZGUucmVzZXQoKTtcclxuXHJcbiAgICAgIC8vIHVubGluayBmcm9tIHByZXZpb3VzIHNvbHV0aW9uXHJcbiAgICAgIGlmICggcHJldmlvdXNTb2x1dGlvblR5cGUgKSB7XHJcbiAgICAgICAgY29uc3QgcHJldmlvdXNTb2x1dGlvbiA9IG1hZ25pZnlpbmdHbGFzcy5zb2x1dGlvbnNNYXAuZ2V0KCBwcmV2aW91c1NvbHV0aW9uVHlwZSApITtcclxuICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBwcmV2aW91c1NvbHV0aW9uICk7XHJcbiAgICAgICAgcHJldmlvdXNTb2x1dGlvbi5zdHJlbmd0aFByb3BlcnR5LnVubGluayggdXBkYXRlUGFydGljbGVzQm91bmQgKTtcclxuICAgICAgICBwcmV2aW91c1NvbHV0aW9uLmNvbmNlbnRyYXRpb25Qcm9wZXJ0eS51bmxpbmsoIHVwZGF0ZVBhcnRpY2xlc0JvdW5kICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGxpbmsgdG8gbmV3IHNvbHV0aW9uXHJcbiAgICAgIGNvbnN0IG5ld1NvbHV0aW9uID0gbWFnbmlmeWluZ0dsYXNzLnNvbHV0aW9uc01hcC5nZXQoIG5ld1NvbHV0aW9uVHlwZSApITtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggbmV3U29sdXRpb24gKTtcclxuICAgICAgbmV3U29sdXRpb24uc3RyZW5ndGhQcm9wZXJ0eS5saW5rKCB1cGRhdGVQYXJ0aWNsZXNCb3VuZCApO1xyXG4gICAgICBuZXdTb2x1dGlvbi5jb25jZW50cmF0aW9uUHJvcGVydHkubGluayggdXBkYXRlUGFydGljbGVzQm91bmQgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBVcGRhdGUgd2hlbiB0aGlzIE5vZGUgYmVjb21lcyB2aXNpYmxlLlxyXG4gICAgdGhpcy52aXNpYmxlUHJvcGVydHkubGluayggdmlzaWJsZSA9PiB2aXNpYmxlICYmIHRoaXMudXBkYXRlUGFydGljbGVzKCkgKTtcclxuXHJcbiAgICB0aGlzLmFkZExpbmtlZEVsZW1lbnQoIG1hZ25pZnlpbmdHbGFzcywge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oIG1hZ25pZnlpbmdHbGFzcy50YW5kZW0ubmFtZSApXHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiBVcGRhdGVzIHRoZSBudW1iZXIgb2YgcGFydGljbGVzIHZpc2libGUuXHJcbiAgICogVG8gaW1wcm92ZSBwZXJmb3JtYW5jZSwgdXBkYXRlcyBvbmx5IHdoZW4gdGhpcyBub2RlIGlzIHZpc2libGUuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVQYXJ0aWNsZXMoKTogdm9pZCB7XHJcbiAgICBpZiAoIHRoaXMudmlzaWJsZSApIHtcclxuICAgICAgdGhpcy5wYXJ0aWNsZXNOb2RlLnVwZGF0ZSgpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuYWNpZEJhc2VTb2x1dGlvbnMucmVnaXN0ZXIoICdNYWduaWZ5aW5nR2xhc3NOb2RlJywgTWFnbmlmeWluZ0dsYXNzTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxTQUFTQyxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELFNBQVNDLE1BQU0sRUFBRUMsS0FBSyxFQUFFQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsU0FBUyxRQUFRLG1DQUFtQztBQUN4RixPQUFPQyxXQUFXLE1BQU0sZ0NBQWdDO0FBQ3hELE9BQU9DLGlCQUFpQixNQUFNLDRCQUE0QjtBQUUxRCxPQUFPQyxhQUFhLE1BQU0sb0JBQW9CO0FBSzlDLE9BQU9DLFNBQVMsTUFBTSwwQ0FBMEM7O0FBRWhFO0FBQ0EsTUFBTUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxDQUFDO0FBQzNCLE1BQU1DLGdCQUFnQixHQUFHLElBQUksQ0FBQyxDQUFDO0FBQy9CLE1BQU1DLGVBQWUsR0FBRyxDQUFDO0FBRXpCLGVBQWUsTUFBTUMsbUJBQW1CLFNBQVNWLElBQUksQ0FBQztFQUs3Q1csV0FBV0EsQ0FBRUMsZUFBZ0MsRUFBRUMsZ0JBQStDLEVBQ2pGQyxzQkFBa0QsRUFBRUMsTUFBYyxFQUFHO0lBRXZGO0lBQ0EsTUFBTUMsTUFBTSxHQUFHSixlQUFlLENBQUNLLE1BQU07SUFDckMsTUFBTUMsU0FBUyxHQUFHckIsS0FBSyxDQUFDc0IsTUFBTSxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUVILE1BQU8sQ0FBQztJQUM5QyxNQUFNSSxRQUFRLEdBQUcsSUFBSW5CLElBQUksQ0FBRWlCLFNBQVMsRUFBRTtNQUFFRyxNQUFN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