// Copyright 2014-2023, University of Colorado Boulder

/**
 * ConcentrationGraphNode is the graph of 'Equilibrium Concentration' for each particle species.
 * To improve performance, updates only when this node is visible.
 *
 * @author Andrey Zelenkov (Mlearner)
 * @author Chris Malley (PixelZoom, Inc.)
 */

import { HBox, Line, Node, Rectangle, RichText, Text } from '../../../../scenery/js/imports.js';
import acidBaseSolutions from '../../acidBaseSolutions.js';
import ABSColors from '../ABSColors.js';
import ConcentrationBarNode from './ConcentrationBarNode.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import AcidBaseSolutionsStrings from '../../AcidBaseSolutionsStrings.js';
import Multilink from '../../../../axon/js/Multilink.js';
import BooleanIO from '../../../../tandem/js/types/BooleanIO.js';
const TICK_LABEL_FONT = new PhetFont(11);
export default class ConcentrationGraphNode extends Node {
  constructor(graph, viewModeProperty, tandem) {
    const backgroundFillNode = new Rectangle(0, 0, graph.width, graph.height, {
      fill: 'white'
    });
    const backgroundStrokeNode = new Rectangle(0, 0, graph.width, graph.height, {
      stroke: 'black',
      lineWidth: 0.5
    });

    // tick marks and horizontal dashed lines
    const dy = graph.height / 10 - 1;
    const tickLineOptions = {
      stroke: 'black',
      lineWidth: 0.5
    };
    const gridLineOptions = {
      stroke: 'gray',
      lineWidth: 0.5,
      lineDash: [2, 1]
    };
    const tickMarksChildren = [];
    const gridLinesChildren = [];
    for (let i = 0, y; i < 11; i++) {
      y = graph.height - dy * i;

      // dashed line (no dash on bottom tick)
      if (i > 0) {
        gridLinesChildren.push(new Line(0, y, graph.width, y, gridLineOptions));
      }

      // tick line
      const tickLine = new Line(-2, y, 2, y, tickLineOptions);
      tickMarksChildren.push(tickLine);

      // tick label
      tickMarksChildren.push(new RichText(`10<sup>${i - 8}</sup>`, {
        font: TICK_LABEL_FONT,
        right: tickLine.left - 4,
        centerY: y
      }));
    }
    const gridLines = new Node({
      children: gridLinesChildren,
      tandem: tandem.createTandem('gridLines')
    });
    const tickMarks = new Node({
      children: tickMarksChildren,
      tandem: tandem.createTandem('tickMarks')
    });

    // y-axis label
    const yAxisText = new Text(AcidBaseSolutionsStrings.concentrationGraph.yAxisStringProperty, {
      font: new PhetFont(13),
      maxWidth: graph.height,
      // graph.height because we're rotating to vertical
      rotation: -Math.PI / 2,
      tandem: tandem.createTandem('yAxisText'),
      phetioVisiblePropertyInstrumented: true
    });
    Multilink.multilink([yAxisText.boundsProperty, tickMarks.visibleProperty], (bounds, tickMarksVisible) => {
      yAxisText.right = (tickMarksVisible ? tickMarks.left : backgroundFillNode.left) - 16;
      yAxisText.centerY = graph.height / 2;
    });

    // Create a bar for each particle species.
    const barsTandem = tandem.createTandem('bars');
    const barNodes = [];
    const particlesMap = new Map();

    // SERIOUS HACK ALERT!! These keys are ordered such that the visible bars will be in the same left-to-right order
    // as the reaction equation that appears under the beaker.
    const particleKeys = ['B', 'HA', 'H2O', 'MOH', 'M', 'BH', 'A', 'H3O', 'OH'];
    particleKeys.forEach(particleKey => {
      const barNode = new ConcentrationBarNode(graph.height - 10, barsTandem.createTandem(`${particleKey}BarNode`));
      barNodes.push(barNode);
      particlesMap.set(particleKey, barNode);
    });
    const barsParent = new HBox({
      children: barNodes,
      align: 'bottom',
      spacing: 16
    });
    barsParent.boundsProperty.link(bounds => {
      barsParent.centerX = backgroundFillNode.centerX;
      barsParent.bottom = backgroundFillNode.bottom;
    });
    super({
      children: [backgroundFillNode, gridLines, tickMarks, yAxisText, barsParent, backgroundStrokeNode],
      translation: graph.position,
      visibleProperty: new DerivedProperty([viewModeProperty], viewMode => viewMode === 'graph', {
        tandem: tandem.createTandem('visibleProperty'),
        phetioValueType: BooleanIO
      }),
      tandem: tandem
    });
    this.graph = graph;
    this.particlesMap = particlesMap;

    // Observe the strength and concentration Properties for the selected solution.
    const updateValuesBound = this.updateValues.bind(this);
    graph.solutionTypeProperty.link((newSolutionType, previousSolutionType) => {
      // unlink from previous solution
      if (previousSolutionType) {
        const previousSolution = graph.solutionsMap.get(previousSolutionType);
        assert && assert(previousSolution);
        previousSolution.strengthProperty.unlink(updateValuesBound);
        previousSolution.concentrationProperty.unlink(updateValuesBound);
      }

      // link to new solution
      const newSolution = graph.solutionsMap.get(newSolutionType);
      assert && assert(newSolution);
      newSolution.strengthProperty.lazyLink(updateValuesBound);
      newSolution.concentrationProperty.lazyLink(updateValuesBound);
      this.updateBars();
    });

    // Update when this Node becomes visible.
    this.visibleProperty.link(visible => {
      visible && this.updateBars();
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }

  /*
   * Adjusts visibility and concentration of bars to match the particles in the current solution.
   * To improve performance, updates only when this node is visible.
   */
  updateBars() {
    if (this.visible) {
      const solutionType = this.graph.solutionTypeProperty.value;
      const solution = this.graph.solutionsMap.get(solutionType);
      assert && assert(solution);
      this.particlesMap.forEach((barNode, particleKey) => {
        const particle = solution.getParticleWithKey(particleKey);
        if (particle) {
          barNode.concentrationProperty.value = particle.getConcentration();
          barNode.setBarFill(particle.color);
          barNode.visible = true;
        } else {
          barNode.concentrationProperty.value = null;
          barNode.visible = false;
        }
      });
    }
  }

  /**
   * Adjusts concentration of bars to match the particles in the current solution.
   * To improve performance, updates only when this node is visible.
   */
  updateValues() {
    if (this.visible) {
      const solutionType = this.graph.solutionTypeProperty.value;
      const solution = this.graph.solutionsMap.get(solutionType);
      assert && assert(solution);
      this.particlesMap.forEach((barNode, particleKey) => {
        const particle = solution.getParticleWithKey(particleKey);
        if (particle) {
          barNode.concentrationProperty.value = particle.getConcentration();
        }
      });
    }
  }

  /**
   * Creates an icon of the graph, with 4 bars (similar to weak acid).
   */
  static createIcon() {
    return new Node({
      children: [
      // graph background
      new Rectangle(0, 0, 22, 18, {
        fill: 'white'
      }),
      // bars for weak acid: HA + H2O <=> A- + H3O+
      new Rectangle(2, 6, 3, 12, {
        fill: ABSColors.HA
      }), new Rectangle(7, 3, 3, 15, {
        fill: ABSColors.H2O
      }), new Rectangle(12, 9, 3, 9, {
        fill: ABSColors.A
      }), new Rectangle(17, 9, 3, 9, {
        fill: ABSColors.H3O
      }),
      // background stroke on top
      new Rectangle(0, 0, 22, 18, {
        stroke: 'black',
        lineWidth: 0.5
      })]
    });
  }
}
acidBaseSolutions.register('ConcentrationGraphNode', ConcentrationGraphNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJIQm94IiwiTGluZSIsIk5vZGUiLCJSZWN0YW5nbGUiLCJSaWNoVGV4dCIsIlRleHQiLCJhY2lkQmFzZVNvbHV0aW9ucyIsIkFCU0NvbG9ycyIsIkNvbmNlbnRyYXRpb25CYXJOb2RlIiwiRGVyaXZlZFByb3BlcnR5IiwiUGhldEZvbnQiLCJBY2lkQmFzZVNvbHV0aW9uc1N0cmluZ3MiLCJNdWx0aWxpbmsiLCJCb29sZWFuSU8iLCJUSUNLX0xBQkVMX0ZPTlQiLCJDb25jZW50cmF0aW9uR3JhcGhOb2RlIiwiY29uc3RydWN0b3IiLCJncmFwaCIsInZpZXdNb2RlUHJvcGVydHkiLCJ0YW5kZW0iLCJiYWNrZ3JvdW5kRmlsbE5vZGUiLCJ3aWR0aCIsImhlaWdodCIsImZpbGwiLCJiYWNrZ3JvdW5kU3Ryb2tlTm9kZSIsInN0cm9rZSIsImxpbmVXaWR0aCIsImR5IiwidGlja0xpbmVPcHRpb25zIiwiZ3JpZExpbmVPcHRpb25zIiwibGluZURhc2giLCJ0aWNrTWFya3NDaGlsZHJlbiIsImdyaWRMaW5lc0NoaWxkcmVuIiwiaSIsInkiLCJwdXNoIiwidGlja0xpbmUiLCJmb250IiwicmlnaHQiLCJsZWZ0IiwiY2VudGVyWSIsImdyaWRMaW5lcyIsImNoaWxkcmVuIiwiY3JlYXRlVGFuZGVtIiwidGlja01hcmtzIiwieUF4aXNUZXh0IiwiY29uY2VudHJhdGlvbkdyYXBoIiwieUF4aXNTdHJpbmdQcm9wZXJ0eSIsIm1heFdpZHRoIiwicm90YXRpb24iLCJNYXRoIiwiUEkiLCJwaGV0aW9WaXNpYmxlUHJvcGVydHlJbnN0cnVtZW50ZWQiLCJtdWx0aWxpbmsiLCJib3VuZHNQcm9wZXJ0eSIsInZpc2libGVQcm9wZXJ0eSIsImJvdW5kcyIsInRpY2tNYXJrc1Zpc2libGUiLCJiYXJzVGFuZGVtIiwiYmFyTm9kZXMiLCJwYXJ0aWNsZXNNYXAiLCJNYXAiLCJwYXJ0aWNsZUtleXMiLCJmb3JFYWNoIiwicGFydGljbGVLZXkiLCJiYXJOb2RlIiwic2V0IiwiYmFyc1BhcmVudCIsImFsaWduIiwic3BhY2luZyIsImxpbmsiLCJjZW50ZXJYIiwiYm90dG9tIiwidHJhbnNsYXRpb24iLCJwb3NpdGlvbiIsInZpZXdNb2RlIiwicGhldGlvVmFsdWVUeXBlIiwidXBkYXRlVmFsdWVzQm91bmQiLCJ1cGRhdGVWYWx1ZXMiLCJiaW5kIiwic29sdXRpb25UeXBlUHJvcGVydHkiLCJuZXdTb2x1dGlvblR5cGUiLCJwcmV2aW91c1NvbHV0aW9uVHlwZSIsInByZXZpb3VzU29sdXRpb24iLCJzb2x1dGlvbnNNYXAiLCJnZXQiLCJhc3NlcnQiLCJzdHJlbmd0aFByb3BlcnR5IiwidW5saW5rIiwiY29uY2VudHJhdGlvblByb3BlcnR5IiwibmV3U29sdXRpb24iLCJsYXp5TGluayIsInVwZGF0ZUJhcnMiLCJ2aXNpYmxlIiwiZGlzcG9zZSIsInNvbHV0aW9uVHlwZSIsInZhbHVlIiwic29sdXRpb24iLCJwYXJ0aWNsZSIsImdldFBhcnRpY2xlV2l0aEtleSIsImdldENvbmNlbnRyYXRpb24iLCJzZXRCYXJGaWxsIiwiY29sb3IiLCJjcmVhdGVJY29uIiwiSEEiLCJIMk8iLCJBIiwiSDNPIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJDb25jZW50cmF0aW9uR3JhcGhOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIENvbmNlbnRyYXRpb25HcmFwaE5vZGUgaXMgdGhlIGdyYXBoIG9mICdFcXVpbGlicml1bSBDb25jZW50cmF0aW9uJyBmb3IgZWFjaCBwYXJ0aWNsZSBzcGVjaWVzLlxyXG4gKiBUbyBpbXByb3ZlIHBlcmZvcm1hbmNlLCB1cGRhdGVzIG9ubHkgd2hlbiB0aGlzIG5vZGUgaXMgdmlzaWJsZS5cclxuICpcclxuICogQGF1dGhvciBBbmRyZXkgWmVsZW5rb3YgKE1sZWFybmVyKVxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IEhCb3gsIExpbmUsIE5vZGUsIFJlY3RhbmdsZSwgUmljaFRleHQsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgYWNpZEJhc2VTb2x1dGlvbnMgZnJvbSAnLi4vLi4vYWNpZEJhc2VTb2x1dGlvbnMuanMnO1xyXG5pbXBvcnQgQUJTQ29sb3JzIGZyb20gJy4uL0FCU0NvbG9ycy5qcyc7XHJcbmltcG9ydCBDb25jZW50cmF0aW9uR3JhcGggZnJvbSAnLi4vbW9kZWwvQ29uY2VudHJhdGlvbkdyYXBoLmpzJztcclxuaW1wb3J0IENvbmNlbnRyYXRpb25CYXJOb2RlIGZyb20gJy4vQ29uY2VudHJhdGlvbkJhck5vZGUuanMnO1xyXG5pbXBvcnQgeyBWaWV3TW9kZSB9IGZyb20gJy4vVmlld01vZGUuanMnO1xyXG5pbXBvcnQgU3RyaW5nVW5pb25Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1N0cmluZ1VuaW9uUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCBBY2lkQmFzZVNvbHV0aW9uc1N0cmluZ3MgZnJvbSAnLi4vLi4vQWNpZEJhc2VTb2x1dGlvbnNTdHJpbmdzLmpzJztcclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCB7IFBhcnRpY2xlS2V5IH0gZnJvbSAnLi4vbW9kZWwvc29sdXRpb25zL1BhcnRpY2xlLmpzJztcclxuaW1wb3J0IEJvb2xlYW5JTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvQm9vbGVhbklPLmpzJztcclxuXHJcbmNvbnN0IFRJQ0tfTEFCRUxfRk9OVCA9IG5ldyBQaGV0Rm9udCggMTEgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbmNlbnRyYXRpb25HcmFwaE5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBncmFwaDogQ29uY2VudHJhdGlvbkdyYXBoO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcGFydGljbGVzTWFwOiBNYXA8UGFydGljbGVLZXksIENvbmNlbnRyYXRpb25CYXJOb2RlPjtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBncmFwaDogQ29uY2VudHJhdGlvbkdyYXBoLCB2aWV3TW9kZVByb3BlcnR5OiBTdHJpbmdVbmlvblByb3BlcnR5PFZpZXdNb2RlPiwgdGFuZGVtOiBUYW5kZW0gKSB7XHJcblxyXG4gICAgY29uc3QgYmFja2dyb3VuZEZpbGxOb2RlID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgZ3JhcGgud2lkdGgsIGdyYXBoLmhlaWdodCwge1xyXG4gICAgICBmaWxsOiAnd2hpdGUnXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgYmFja2dyb3VuZFN0cm9rZU5vZGUgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBncmFwaC53aWR0aCwgZ3JhcGguaGVpZ2h0LCB7XHJcbiAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgbGluZVdpZHRoOiAwLjVcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB0aWNrIG1hcmtzIGFuZCBob3Jpem9udGFsIGRhc2hlZCBsaW5lc1xyXG4gICAgY29uc3QgZHkgPSAoIGdyYXBoLmhlaWdodCAvIDEwICkgLSAxO1xyXG4gICAgY29uc3QgdGlja0xpbmVPcHRpb25zID0geyBzdHJva2U6ICdibGFjaycsIGxpbmVXaWR0aDogMC41IH07XHJcbiAgICBjb25zdCBncmlkTGluZU9wdGlvbnMgPSB7IHN0cm9rZTogJ2dyYXknLCBsaW5lV2lkdGg6IDAuNSwgbGluZURhc2g6IFsgMiwgMSBdIH07XHJcbiAgICBjb25zdCB0aWNrTWFya3NDaGlsZHJlbiA9IFtdO1xyXG4gICAgY29uc3QgZ3JpZExpbmVzQ2hpbGRyZW4gPSBbXTtcclxuICAgIGZvciAoIGxldCBpID0gMCwgeTsgaSA8IDExOyBpKysgKSB7XHJcblxyXG4gICAgICB5ID0gZ3JhcGguaGVpZ2h0IC0gKCBkeSAqIGkgKTtcclxuXHJcbiAgICAgIC8vIGRhc2hlZCBsaW5lIChubyBkYXNoIG9uIGJvdHRvbSB0aWNrKVxyXG4gICAgICBpZiAoIGkgPiAwICkge1xyXG4gICAgICAgIGdyaWRMaW5lc0NoaWxkcmVuLnB1c2goIG5ldyBMaW5lKCAwLCB5LCBncmFwaC53aWR0aCwgeSwgZ3JpZExpbmVPcHRpb25zICkgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gdGljayBsaW5lXHJcbiAgICAgIGNvbnN0IHRpY2tMaW5lID0gbmV3IExpbmUoIC0yLCB5LCAyLCB5LCB0aWNrTGluZU9wdGlvbnMgKTtcclxuICAgICAgdGlja01hcmtzQ2hpbGRyZW4ucHVzaCggdGlja0xpbmUgKTtcclxuXHJcbiAgICAgIC8vIHRpY2sgbGFiZWxcclxuICAgICAgdGlja01hcmtzQ2hpbGRyZW4ucHVzaCggbmV3IFJpY2hUZXh0KCBgMTA8c3VwPiR7aSAtIDh9PC9zdXA+YCwge1xyXG4gICAgICAgIGZvbnQ6IFRJQ0tfTEFCRUxfRk9OVCxcclxuICAgICAgICByaWdodDogdGlja0xpbmUubGVmdCAtIDQsXHJcbiAgICAgICAgY2VudGVyWTogeVxyXG4gICAgICB9ICkgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBncmlkTGluZXMgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogZ3JpZExpbmVzQ2hpbGRyZW4sXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2dyaWRMaW5lcycgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHRpY2tNYXJrcyA9IG5ldyBOb2RlKCB7XHJcbiAgICAgIGNoaWxkcmVuOiB0aWNrTWFya3NDaGlsZHJlbixcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAndGlja01hcmtzJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8geS1heGlzIGxhYmVsXHJcbiAgICBjb25zdCB5QXhpc1RleHQgPSBuZXcgVGV4dCggQWNpZEJhc2VTb2x1dGlvbnNTdHJpbmdzLmNvbmNlbnRyYXRpb25HcmFwaC55QXhpc1N0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTMgKSxcclxuICAgICAgbWF4V2lkdGg6IGdyYXBoLmhlaWdodCwgLy8gZ3JhcGguaGVpZ2h0IGJlY2F1c2Ugd2UncmUgcm90YXRpbmcgdG8gdmVydGljYWxcclxuICAgICAgcm90YXRpb246IC1NYXRoLlBJIC8gMixcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAneUF4aXNUZXh0JyApLFxyXG4gICAgICBwaGV0aW9WaXNpYmxlUHJvcGVydHlJbnN0cnVtZW50ZWQ6IHRydWVcclxuICAgIH0gKTtcclxuXHJcbiAgICBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIHlBeGlzVGV4dC5ib3VuZHNQcm9wZXJ0eSwgdGlja01hcmtzLnZpc2libGVQcm9wZXJ0eSBdLFxyXG4gICAgICAoIGJvdW5kcywgdGlja01hcmtzVmlzaWJsZSApID0+IHtcclxuICAgICAgICB5QXhpc1RleHQucmlnaHQgPSAoIHRpY2tNYXJrc1Zpc2libGUgPyB0aWNrTWFya3MubGVmdCA6IGJhY2tncm91bmRGaWxsTm9kZS5sZWZ0ICkgLSAxNjtcclxuICAgICAgICB5QXhpc1RleHQuY2VudGVyWSA9IGdyYXBoLmhlaWdodCAvIDI7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSBiYXIgZm9yIGVhY2ggcGFydGljbGUgc3BlY2llcy5cclxuICAgIGNvbnN0IGJhcnNUYW5kZW0gPSB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnYmFycycgKTtcclxuICAgIGNvbnN0IGJhck5vZGVzOiBDb25jZW50cmF0aW9uQmFyTm9kZVtdID0gW107XHJcbiAgICBjb25zdCBwYXJ0aWNsZXNNYXAgPSBuZXcgTWFwPFBhcnRpY2xlS2V5LCBDb25jZW50cmF0aW9uQmFyTm9kZT4oKTtcclxuXHJcbiAgICAvLyBTRVJJT1VTIEhBQ0sgQUxFUlQhISBUaGVzZSBrZXlzIGFyZSBvcmRlcmVkIHN1Y2ggdGhhdCB0aGUgdmlzaWJsZSBiYXJzIHdpbGwgYmUgaW4gdGhlIHNhbWUgbGVmdC10by1yaWdodCBvcmRlclxyXG4gICAgLy8gYXMgdGhlIHJlYWN0aW9uIGVxdWF0aW9uIHRoYXQgYXBwZWFycyB1bmRlciB0aGUgYmVha2VyLlxyXG4gICAgY29uc3QgcGFydGljbGVLZXlzOiBQYXJ0aWNsZUtleVtdID0gW1xyXG4gICAgICAnQicsICdIQScsICdIMk8nLCAnTU9IJywgJ00nLCAnQkgnLCAnQScsICdIM08nLCAnT0gnXHJcbiAgICBdO1xyXG4gICAgcGFydGljbGVLZXlzLmZvckVhY2goIHBhcnRpY2xlS2V5ID0+IHtcclxuICAgICAgY29uc3QgYmFyTm9kZSA9IG5ldyBDb25jZW50cmF0aW9uQmFyTm9kZSggZ3JhcGguaGVpZ2h0IC0gMTAsIGJhcnNUYW5kZW0uY3JlYXRlVGFuZGVtKCBgJHtwYXJ0aWNsZUtleX1CYXJOb2RlYCApICk7XHJcbiAgICAgIGJhck5vZGVzLnB1c2goIGJhck5vZGUgKTtcclxuICAgICAgcGFydGljbGVzTWFwLnNldCggcGFydGljbGVLZXksIGJhck5vZGUgKTtcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IGJhcnNQYXJlbnQgPSBuZXcgSEJveCgge1xyXG4gICAgICBjaGlsZHJlbjogYmFyTm9kZXMsXHJcbiAgICAgIGFsaWduOiAnYm90dG9tJyxcclxuICAgICAgc3BhY2luZzogMTZcclxuICAgIH0gKTtcclxuICAgIGJhcnNQYXJlbnQuYm91bmRzUHJvcGVydHkubGluayggYm91bmRzID0+IHtcclxuICAgICAgYmFyc1BhcmVudC5jZW50ZXJYID0gYmFja2dyb3VuZEZpbGxOb2RlLmNlbnRlclg7XHJcbiAgICAgIGJhcnNQYXJlbnQuYm90dG9tID0gYmFja2dyb3VuZEZpbGxOb2RlLmJvdHRvbTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBzdXBlcigge1xyXG4gICAgICBjaGlsZHJlbjogWyBiYWNrZ3JvdW5kRmlsbE5vZGUsIGdyaWRMaW5lcywgdGlja01hcmtzLCB5QXhpc1RleHQsIGJhcnNQYXJlbnQsIGJhY2tncm91bmRTdHJva2VOb2RlIF0sXHJcbiAgICAgIHRyYW5zbGF0aW9uOiBncmFwaC5wb3NpdGlvbixcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIHZpZXdNb2RlUHJvcGVydHkgXSwgdmlld01vZGUgPT4gKCB2aWV3TW9kZSA9PT0gJ2dyYXBoJyApLCB7XHJcbiAgICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAndmlzaWJsZVByb3BlcnR5JyApLFxyXG4gICAgICAgIHBoZXRpb1ZhbHVlVHlwZTogQm9vbGVhbklPXHJcbiAgICAgIH0gKSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW1cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmdyYXBoID0gZ3JhcGg7XHJcbiAgICB0aGlzLnBhcnRpY2xlc01hcCA9IHBhcnRpY2xlc01hcDtcclxuXHJcbiAgICAvLyBPYnNlcnZlIHRoZSBzdHJlbmd0aCBhbmQgY29uY2VudHJhdGlvbiBQcm9wZXJ0aWVzIGZvciB0aGUgc2VsZWN0ZWQgc29sdXRpb24uXHJcbiAgICBjb25zdCB1cGRhdGVWYWx1ZXNCb3VuZCA9IHRoaXMudXBkYXRlVmFsdWVzLmJpbmQoIHRoaXMgKTtcclxuICAgIGdyYXBoLnNvbHV0aW9uVHlwZVByb3BlcnR5LmxpbmsoICggbmV3U29sdXRpb25UeXBlLCBwcmV2aW91c1NvbHV0aW9uVHlwZSApID0+IHtcclxuXHJcbiAgICAgIC8vIHVubGluayBmcm9tIHByZXZpb3VzIHNvbHV0aW9uXHJcbiAgICAgIGlmICggcHJldmlvdXNTb2x1dGlvblR5cGUgKSB7XHJcbiAgICAgICAgY29uc3QgcHJldmlvdXNTb2x1dGlvbiA9IGdyYXBoLnNvbHV0aW9uc01hcC5nZXQoIHByZXZpb3VzU29sdXRpb25UeXBlICkhO1xyXG4gICAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHByZXZpb3VzU29sdXRpb24gKTtcclxuICAgICAgICBwcmV2aW91c1NvbHV0aW9uLnN0cmVuZ3RoUHJvcGVydHkudW5saW5rKCB1cGRhdGVWYWx1ZXNCb3VuZCApO1xyXG4gICAgICAgIHByZXZpb3VzU29sdXRpb24uY29uY2VudHJhdGlvblByb3BlcnR5LnVubGluayggdXBkYXRlVmFsdWVzQm91bmQgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gbGluayB0byBuZXcgc29sdXRpb25cclxuICAgICAgY29uc3QgbmV3U29sdXRpb24gPSBncmFwaC5zb2x1dGlvbnNNYXAuZ2V0KCBuZXdTb2x1dGlvblR5cGUgKSE7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIG5ld1NvbHV0aW9uICk7XHJcbiAgICAgIG5ld1NvbHV0aW9uLnN0cmVuZ3RoUHJvcGVydHkubGF6eUxpbmsoIHVwZGF0ZVZhbHVlc0JvdW5kICk7XHJcbiAgICAgIG5ld1NvbHV0aW9uLmNvbmNlbnRyYXRpb25Qcm9wZXJ0eS5sYXp5TGluayggdXBkYXRlVmFsdWVzQm91bmQgKTtcclxuXHJcbiAgICAgIHRoaXMudXBkYXRlQmFycygpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFVwZGF0ZSB3aGVuIHRoaXMgTm9kZSBiZWNvbWVzIHZpc2libGUuXHJcbiAgICB0aGlzLnZpc2libGVQcm9wZXJ0eS5saW5rKCB2aXNpYmxlID0+IHtcclxuICAgICAgdmlzaWJsZSAmJiB0aGlzLnVwZGF0ZUJhcnMoKTtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIEFkanVzdHMgdmlzaWJpbGl0eSBhbmQgY29uY2VudHJhdGlvbiBvZiBiYXJzIHRvIG1hdGNoIHRoZSBwYXJ0aWNsZXMgaW4gdGhlIGN1cnJlbnQgc29sdXRpb24uXHJcbiAgICogVG8gaW1wcm92ZSBwZXJmb3JtYW5jZSwgdXBkYXRlcyBvbmx5IHdoZW4gdGhpcyBub2RlIGlzIHZpc2libGUuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVCYXJzKCk6IHZvaWQge1xyXG5cclxuICAgIGlmICggdGhpcy52aXNpYmxlICkge1xyXG5cclxuICAgICAgY29uc3Qgc29sdXRpb25UeXBlID0gdGhpcy5ncmFwaC5zb2x1dGlvblR5cGVQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgY29uc3Qgc29sdXRpb24gPSB0aGlzLmdyYXBoLnNvbHV0aW9uc01hcC5nZXQoIHNvbHV0aW9uVHlwZSApITtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggc29sdXRpb24gKTtcclxuXHJcbiAgICAgIHRoaXMucGFydGljbGVzTWFwLmZvckVhY2goICggYmFyTm9kZSwgcGFydGljbGVLZXkgKSA9PiB7XHJcbiAgICAgICAgY29uc3QgcGFydGljbGUgPSBzb2x1dGlvbi5nZXRQYXJ0aWNsZVdpdGhLZXkoIHBhcnRpY2xlS2V5ICk7XHJcbiAgICAgICAgaWYgKCBwYXJ0aWNsZSApIHtcclxuICAgICAgICAgIGJhck5vZGUuY29uY2VudHJhdGlvblByb3BlcnR5LnZhbHVlID0gcGFydGljbGUuZ2V0Q29uY2VudHJhdGlvbigpO1xyXG4gICAgICAgICAgYmFyTm9kZS5zZXRCYXJGaWxsKCBwYXJ0aWNsZS5jb2xvciApO1xyXG4gICAgICAgICAgYmFyTm9kZS52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBiYXJOb2RlLmNvbmNlbnRyYXRpb25Qcm9wZXJ0eS52YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICBiYXJOb2RlLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkanVzdHMgY29uY2VudHJhdGlvbiBvZiBiYXJzIHRvIG1hdGNoIHRoZSBwYXJ0aWNsZXMgaW4gdGhlIGN1cnJlbnQgc29sdXRpb24uXHJcbiAgICogVG8gaW1wcm92ZSBwZXJmb3JtYW5jZSwgdXBkYXRlcyBvbmx5IHdoZW4gdGhpcyBub2RlIGlzIHZpc2libGUuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVWYWx1ZXMoKTogdm9pZCB7XHJcblxyXG4gICAgaWYgKCB0aGlzLnZpc2libGUgKSB7XHJcblxyXG4gICAgICBjb25zdCBzb2x1dGlvblR5cGUgPSB0aGlzLmdyYXBoLnNvbHV0aW9uVHlwZVByb3BlcnR5LnZhbHVlO1xyXG4gICAgICBjb25zdCBzb2x1dGlvbiA9IHRoaXMuZ3JhcGguc29sdXRpb25zTWFwLmdldCggc29sdXRpb25UeXBlICkhO1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBzb2x1dGlvbiApO1xyXG5cclxuICAgICAgdGhpcy5wYXJ0aWNsZXNNYXAuZm9yRWFjaCggKCBiYXJOb2RlLCBwYXJ0aWNsZUtleSApID0+IHtcclxuICAgICAgICBjb25zdCBwYXJ0aWNsZSA9IHNvbHV0aW9uLmdldFBhcnRpY2xlV2l0aEtleSggcGFydGljbGVLZXkgKTtcclxuICAgICAgICBpZiAoIHBhcnRpY2xlICkge1xyXG4gICAgICAgICAgYmFyTm9kZS5jb25jZW50cmF0aW9uUHJvcGVydHkudmFsdWUgPSBwYXJ0aWNsZS5nZXRDb25jZW50cmF0aW9uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGFuIGljb24gb2YgdGhlIGdyYXBoLCB3aXRoIDQgYmFycyAoc2ltaWxhciB0byB3ZWFrIGFjaWQpLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlSWNvbigpOiBOb2RlIHtcclxuICAgIHJldHVybiBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogW1xyXG5cclxuICAgICAgICAvLyBncmFwaCBiYWNrZ3JvdW5kXHJcbiAgICAgICAgbmV3IFJlY3RhbmdsZSggMCwgMCwgMjIsIDE4LCB7IGZpbGw6ICd3aGl0ZScgfSApLFxyXG5cclxuICAgICAgICAvLyBiYXJzIGZvciB3ZWFrIGFjaWQ6IEhBICsgSDJPIDw9PiBBLSArIEgzTytcclxuICAgICAgICBuZXcgUmVjdGFuZ2xlKCAyLCA2LCAzLCAxMiwgeyBmaWxsOiBBQlNDb2xvcnMuSEEgfSApLFxyXG4gICAgICAgIG5ldyBSZWN0YW5nbGUoIDcsIDMsIDMsIDE1LCB7IGZpbGw6IEFCU0NvbG9ycy5IMk8gfSApLFxyXG4gICAgICAgIG5ldyBSZWN0YW5nbGUoIDEyLCA5LCAzLCA5LCB7IGZpbGw6IEFCU0NvbG9ycy5BIH0gKSxcclxuICAgICAgICBuZXcgUmVjdGFuZ2xlKCAxNywgOSwgMywgOSwgeyBmaWxsOiBBQlNDb2xvcnMuSDNPIH0gKSxcclxuXHJcbiAgICAgICAgLy8gYmFja2dyb3VuZCBzdHJva2Ugb24gdG9wXHJcbiAgICAgICAgbmV3IFJlY3RhbmdsZSggMCwgMCwgMjIsIDE4LCB7IHN0cm9rZTogJ2JsYWNrJywgbGluZVdpZHRoOiAwLjUgfSApXHJcbiAgICAgIF1cclxuICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbmFjaWRCYXNlU29sdXRpb25zLnJlZ2lzdGVyKCAnQ29uY2VudHJhdGlvbkdyYXBoTm9kZScsIENvbmNlbnRyYXRpb25HcmFwaE5vZGUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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