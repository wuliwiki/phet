// Copyright 2014-2023, University of Colorado Boulder

/**
 * Visual representation for pH meter in the 'Acid-Base Solutions' sim.
 *
 * @author Andrey Zelenkov (Mlearner)
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Circle, DragListener, Node, Path, Rectangle, Text } from '../../../../scenery/js/imports.js';
import acidBaseSolutions from '../../acidBaseSolutions.js';
import AcidBaseSolutionsStrings from '../../AcidBaseSolutionsStrings.js';
import BooleanIO from '../../../../tandem/js/types/BooleanIO.js';

// constants
const SHOW_ORIGIN = false; // draws a red circle at the origin, for debugging
const DECIMAL_PLACES = 2;
const FONT = new PhetFont({
  size: 15,
  weight: 'bold'
});
const X_MARGIN = 12;
const Y_MARGIN = 8;
const BACKGROUND_FILL = 'rgb( 225, 225, 225 )';
const BACKGROUND_STROKE = 'rgb( 64, 64, 64 )';
const PH_TEXT_MAX_WIDTH = 70;
export default class PHMeterNode extends Node {
  constructor(pHMeter, toolModeProperty, tandem) {
    // probe
    const probeNode = new ProbeNode(5, 40, 14, 36);
    const pHStringProperty = new DerivedProperty([AcidBaseSolutionsStrings.pattern['0label']['1valueStringProperty'], AcidBaseSolutionsStrings.pHStringProperty, pHMeter.pHProperty, pHMeter.isInSolutionProperty], (patternString, pHString, pH, isInSolution) => {
      const pHValueString = isInSolution ? Utils.toFixed(pH, DECIMAL_PLACES) : '';
      return StringUtils.format(patternString, pHString, pHValueString);
    });
    const pHText = new Text(pHStringProperty, {
      font: FONT,
      maxWidth: PH_TEXT_MAX_WIDTH
    });

    // background sized to fit text
    const backgroundNode = new Rectangle(0, 0, PH_TEXT_MAX_WIDTH + 2 * X_MARGIN, pHText.height + 2 * Y_MARGIN, {
      cornerRadius: 5,
      fill: BACKGROUND_FILL,
      stroke: BACKGROUND_STROKE,
      lineWidth: 1.5
    });

    // layout, origin at probe tip
    probeNode.centerX = 0;
    probeNode.bottom = 0;
    backgroundNode.left = probeNode.centerX - 0.25 * backgroundNode.width;
    backgroundNode.bottom = probeNode.top + 1; // hide seam
    pHText.boundsProperty.link(bounds => {
      pHText.left = backgroundNode.left + X_MARGIN;
      pHText.centerY = backgroundNode.centerY;
    });
    const children = [probeNode, backgroundNode, pHText];
    if (SHOW_ORIGIN) {
      children.push(new Circle(2, {
        fill: 'red'
      }));
    }
    super({
      children: children,
      cursor: 'pointer',
      visibleProperty: new DerivedProperty([toolModeProperty], toolMode => toolMode === 'pHMeter', {
        tandem: tandem.createTandem('visibleProperty'),
        phetioValueType: BooleanIO
      }),
      tandem: tandem
    });

    // Constrained dragging
    let clickYOffset = 0;
    this.addInputListener(new DragListener({
      start: event => {
        clickYOffset = this.globalToParentPoint(event.pointer.point).y - event.currentTarget.y;
      },
      drag: event => {
        const y = this.globalToParentPoint(event.pointer.point).y - clickYOffset;
        pHMeter.positionProperty.value = new Vector2(pHMeter.positionProperty.value.x, Utils.clamp(y, pHMeter.dragYRange.min, pHMeter.dragYRange.max));
      },
      tandem: tandem.createTandem('dragListener')
    }));
    pHMeter.positionProperty.link(position => {
      this.translation = position;
    });
    this.addLinkedElement(pHMeter, {
      tandem: tandem.createTandem(pHMeter.tandem.name)
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }

  /**
   * Creates an icon for the pH meter.
   */
  static createIcon() {
    const probeNode = new ProbeNode(2, 10, 5, 12);
    const backgroundNode = new Rectangle(0, 0, 30, 10, 2, 2, {
      fill: BACKGROUND_FILL,
      stroke: BACKGROUND_STROKE,
      lineWidth: 0.5,
      left: probeNode.centerX - 7,
      bottom: probeNode.top + 1
    });
    return new Node({
      children: [probeNode, backgroundNode]
    });
  }
}

/**
 * pH Probe, consists of a shaft attached to a tip.
 */
class ProbeNode extends Node {
  constructor(shaftWidth, shaftHeight, tipWidth, tipHeight) {
    const overlap = 1; // overlap, to hide seam

    // probe shaft
    const shaftNode = new Rectangle(0, 0, shaftWidth, shaftHeight + overlap, {
      fill: 'rgb( 192, 192, 192 )',
      stroke: 'rgb( 160, 160, 160 )',
      lineWidth: 0.5
    });

    // probe tip: clockwise from tip of probe, origin at upper-left of shape
    const cornerRadius = tipHeight / 9;
    const tipShape = new Shape().moveTo(tipWidth / 2, tipHeight).lineTo(0, 0.6 * tipHeight).lineTo(0, cornerRadius).arc(cornerRadius, cornerRadius, cornerRadius, Math.PI, 1.5 * Math.PI).lineTo(cornerRadius, 0).lineTo(tipWidth - cornerRadius, 0).arc(tipWidth - cornerRadius, cornerRadius, cornerRadius, -0.5 * Math.PI, 0).lineTo(tipWidth, 0.6 * tipHeight).close();
    const tipNode = new Path(tipShape, {
      fill: 'black',
      centerX: shaftNode.centerX,
      top: shaftNode.bottom - overlap
    });
    super({
      children: [shaftNode, tipNode]
    });
  }
}
acidBaseSolutions.register('PHMeterNode', PHMeterNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJVdGlscyIsIlZlY3RvcjIiLCJTaGFwZSIsIlN0cmluZ1V0aWxzIiwiUGhldEZvbnQiLCJDaXJjbGUiLCJEcmFnTGlzdGVuZXIiLCJOb2RlIiwiUGF0aCIsIlJlY3RhbmdsZSIsIlRleHQiLCJhY2lkQmFzZVNvbHV0aW9ucyIsIkFjaWRCYXNlU29sdXRpb25zU3RyaW5ncyIsIkJvb2xlYW5JTyIsIlNIT1dfT1JJR0lOIiwiREVDSU1BTF9QTEFDRVMiLCJGT05UIiwic2l6ZSIsIndlaWdodCIsIlhfTUFSR0lOIiwiWV9NQVJHSU4iLCJCQUNLR1JPVU5EX0ZJTEwiLCJCQUNLR1JPVU5EX1NUUk9LRSIsIlBIX1RFWFRfTUFYX1dJRFRIIiwiUEhNZXRlck5vZGUiLCJjb25zdHJ1Y3RvciIsInBITWV0ZXIiLCJ0b29sTW9kZVByb3BlcnR5IiwidGFuZGVtIiwicHJvYmVOb2RlIiwiUHJvYmVOb2RlIiwicEhTdHJpbmdQcm9wZXJ0eSIsInBhdHRlcm4iLCJwSFByb3BlcnR5IiwiaXNJblNvbHV0aW9uUHJvcGVydHkiLCJwYXR0ZXJuU3RyaW5nIiwicEhTdHJpbmciLCJwSCIsImlzSW5Tb2x1dGlvbiIsInBIVmFsdWVTdHJpbmciLCJ0b0ZpeGVkIiwiZm9ybWF0IiwicEhUZXh0IiwiZm9udCIsIm1heFdpZHRoIiwiYmFja2dyb3VuZE5vZGUiLCJoZWlnaHQiLCJjb3JuZXJSYWRpdXMiLCJmaWxsIiwic3Ryb2tlIiwibGluZVdpZHRoIiwiY2VudGVyWCIsImJvdHRvbSIsImxlZnQiLCJ3aWR0aCIsInRvcCIsImJvdW5kc1Byb3BlcnR5IiwibGluayIsImJvdW5kcyIsImNlbnRlclkiLCJjaGlsZHJlbiIsInB1c2giLCJjdXJzb3IiLCJ2aXNpYmxlUHJvcGVydHkiLCJ0b29sTW9kZSIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb1ZhbHVlVHlwZSIsImNsaWNrWU9mZnNldCIsImFkZElucHV0TGlzdGVuZXIiLCJzdGFydCIsImV2ZW50IiwiZ2xvYmFsVG9QYXJlbnRQb2ludCIsInBvaW50ZXIiLCJwb2ludCIsInkiLCJjdXJyZW50VGFyZ2V0IiwiZHJhZyIsInBvc2l0aW9uUHJvcGVydHkiLCJ2YWx1ZSIsIngiLCJjbGFtcCIsImRyYWdZUmFuZ2UiLCJtaW4iLCJtYXgiLCJwb3NpdGlvbiIsInRyYW5zbGF0aW9uIiwiYWRkTGlua2VkRWxlbWVudCIsIm5hbWUiLCJkaXNwb3NlIiwiYXNzZXJ0IiwiY3JlYXRlSWNvbiIsInNoYWZ0V2lkdGgiLCJzaGFmdEhlaWdodCIsInRpcFdpZHRoIiwidGlwSGVpZ2h0Iiwib3ZlcmxhcCIsInNoYWZ0Tm9kZSIsInRpcFNoYXBlIiwibW92ZVRvIiwibGluZVRvIiwiYXJjIiwiTWF0aCIsIlBJIiwiY2xvc2UiLCJ0aXBOb2RlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQSE1ldGVyTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBWaXN1YWwgcmVwcmVzZW50YXRpb24gZm9yIHBIIG1ldGVyIGluIHRoZSAnQWNpZC1CYXNlIFNvbHV0aW9ucycgc2ltLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEFuZHJleSBaZWxlbmtvdiAoTWxlYXJuZXIpXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUGhldEZvbnQuanMnO1xyXG5pbXBvcnQgeyBDaXJjbGUsIERyYWdMaXN0ZW5lciwgTm9kZSwgUGF0aCwgUmVjdGFuZ2xlLCBUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGFjaWRCYXNlU29sdXRpb25zIGZyb20gJy4uLy4uL2FjaWRCYXNlU29sdXRpb25zLmpzJztcclxuaW1wb3J0IEFjaWRCYXNlU29sdXRpb25zU3RyaW5ncyBmcm9tICcuLi8uLi9BY2lkQmFzZVNvbHV0aW9uc1N0cmluZ3MuanMnO1xyXG5pbXBvcnQgUEhNZXRlciBmcm9tICcuLi9tb2RlbC9QSE1ldGVyLmpzJztcclxuaW1wb3J0IHsgVG9vbE1vZGUgfSBmcm9tICcuL1Rvb2xNb2RlLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IFN0cmluZ1VuaW9uUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9TdHJpbmdVbmlvblByb3BlcnR5LmpzJztcclxuaW1wb3J0IEJvb2xlYW5JTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvQm9vbGVhbklPLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBTSE9XX09SSUdJTiA9IGZhbHNlOyAvLyBkcmF3cyBhIHJlZCBjaXJjbGUgYXQgdGhlIG9yaWdpbiwgZm9yIGRlYnVnZ2luZ1xyXG5jb25zdCBERUNJTUFMX1BMQUNFUyA9IDI7XHJcbmNvbnN0IEZPTlQgPSBuZXcgUGhldEZvbnQoIHsgc2l6ZTogMTUsIHdlaWdodDogJ2JvbGQnIH0gKTtcclxuY29uc3QgWF9NQVJHSU4gPSAxMjtcclxuY29uc3QgWV9NQVJHSU4gPSA4O1xyXG5jb25zdCBCQUNLR1JPVU5EX0ZJTEwgPSAncmdiKCAyMjUsIDIyNSwgMjI1ICknO1xyXG5jb25zdCBCQUNLR1JPVU5EX1NUUk9LRSA9ICdyZ2IoIDY0LCA2NCwgNjQgKSc7XHJcbmNvbnN0IFBIX1RFWFRfTUFYX1dJRFRIID0gNzA7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQSE1ldGVyTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHBITWV0ZXI6IFBITWV0ZXIsIHRvb2xNb2RlUHJvcGVydHk6IFN0cmluZ1VuaW9uUHJvcGVydHk8VG9vbE1vZGU+LCB0YW5kZW06IFRhbmRlbSApIHtcclxuXHJcbiAgICAvLyBwcm9iZVxyXG4gICAgY29uc3QgcHJvYmVOb2RlID0gbmV3IFByb2JlTm9kZSggNSwgNDAsIDE0LCAzNiApO1xyXG5cclxuICAgIGNvbnN0IHBIU3RyaW5nUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgICBbXHJcbiAgICAgICAgQWNpZEJhc2VTb2x1dGlvbnNTdHJpbmdzLnBhdHRlcm5bICcwbGFiZWwnIF1bICcxdmFsdWVTdHJpbmdQcm9wZXJ0eScgXSxcclxuICAgICAgICBBY2lkQmFzZVNvbHV0aW9uc1N0cmluZ3MucEhTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgICBwSE1ldGVyLnBIUHJvcGVydHksXHJcbiAgICAgICAgcEhNZXRlci5pc0luU29sdXRpb25Qcm9wZXJ0eVxyXG4gICAgICBdLFxyXG4gICAgICAoIHBhdHRlcm5TdHJpbmcsIHBIU3RyaW5nLCBwSCwgaXNJblNvbHV0aW9uICkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHBIVmFsdWVTdHJpbmcgPSBpc0luU29sdXRpb24gPyBVdGlscy50b0ZpeGVkKCBwSCwgREVDSU1BTF9QTEFDRVMgKSA6ICcnO1xyXG4gICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5mb3JtYXQoIHBhdHRlcm5TdHJpbmcsIHBIU3RyaW5nLCBwSFZhbHVlU3RyaW5nICk7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBwSFRleHQgPSBuZXcgVGV4dCggcEhTdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICBmb250OiBGT05ULFxyXG4gICAgICBtYXhXaWR0aDogUEhfVEVYVF9NQVhfV0lEVEhcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBiYWNrZ3JvdW5kIHNpemVkIHRvIGZpdCB0ZXh0XHJcbiAgICBjb25zdCBiYWNrZ3JvdW5kTm9kZSA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIFBIX1RFWFRfTUFYX1dJRFRIICsgKCAyICogWF9NQVJHSU4gKSwgcEhUZXh0LmhlaWdodCArICggMiAqIFlfTUFSR0lOICksIHtcclxuICAgICAgY29ybmVyUmFkaXVzOiA1LFxyXG4gICAgICBmaWxsOiBCQUNLR1JPVU5EX0ZJTEwsXHJcbiAgICAgIHN0cm9rZTogQkFDS0dST1VORF9TVFJPS0UsXHJcbiAgICAgIGxpbmVXaWR0aDogMS41XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gbGF5b3V0LCBvcmlnaW4gYXQgcHJvYmUgdGlwXHJcbiAgICBwcm9iZU5vZGUuY2VudGVyWCA9IDA7XHJcbiAgICBwcm9iZU5vZGUuYm90dG9tID0gMDtcclxuICAgIGJhY2tncm91bmROb2RlLmxlZnQgPSBwcm9iZU5vZGUuY2VudGVyWCAtICggMC4yNSAqIGJhY2tncm91bmROb2RlLndpZHRoICk7XHJcbiAgICBiYWNrZ3JvdW5kTm9kZS5ib3R0b20gPSBwcm9iZU5vZGUudG9wICsgMTsgLy8gaGlkZSBzZWFtXHJcbiAgICBwSFRleHQuYm91bmRzUHJvcGVydHkubGluayggYm91bmRzID0+IHtcclxuICAgICAgcEhUZXh0LmxlZnQgPSBiYWNrZ3JvdW5kTm9kZS5sZWZ0ICsgWF9NQVJHSU47XHJcbiAgICAgIHBIVGV4dC5jZW50ZXJZID0gYmFja2dyb3VuZE5vZGUuY2VudGVyWTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBjaGlsZHJlbjogTm9kZVtdID0gWyBwcm9iZU5vZGUsIGJhY2tncm91bmROb2RlLCBwSFRleHQgXTtcclxuICAgIGlmICggU0hPV19PUklHSU4gKSB7XHJcbiAgICAgIGNoaWxkcmVuLnB1c2goIG5ldyBDaXJjbGUoIDIsIHsgZmlsbDogJ3JlZCcgfSApICk7XHJcbiAgICB9XHJcblxyXG4gICAgc3VwZXIoIHtcclxuICAgICAgY2hpbGRyZW46IGNoaWxkcmVuLFxyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIHRvb2xNb2RlUHJvcGVydHkgXSwgdG9vbE1vZGUgPT4gKCB0b29sTW9kZSA9PT0gJ3BITWV0ZXInICksIHtcclxuICAgICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd2aXNpYmxlUHJvcGVydHknICksXHJcbiAgICAgICAgcGhldGlvVmFsdWVUeXBlOiBCb29sZWFuSU9cclxuICAgICAgfSApLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIENvbnN0cmFpbmVkIGRyYWdnaW5nXHJcbiAgICBsZXQgY2xpY2tZT2Zmc2V0ID0gMDtcclxuICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggbmV3IERyYWdMaXN0ZW5lcigge1xyXG5cclxuICAgICAgc3RhcnQ6IGV2ZW50ID0+IHtcclxuICAgICAgICBjbGlja1lPZmZzZXQgPSB0aGlzLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKS55IC0gZXZlbnQuY3VycmVudFRhcmdldCEueTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGRyYWc6IGV2ZW50ID0+IHtcclxuICAgICAgICBjb25zdCB5ID0gdGhpcy5nbG9iYWxUb1BhcmVudFBvaW50KCBldmVudC5wb2ludGVyLnBvaW50ICkueSAtIGNsaWNrWU9mZnNldDtcclxuICAgICAgICBwSE1ldGVyLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgPSBuZXcgVmVjdG9yMihcclxuICAgICAgICAgIHBITWV0ZXIucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS54LFxyXG4gICAgICAgICAgVXRpbHMuY2xhbXAoIHksIHBITWV0ZXIuZHJhZ1lSYW5nZS5taW4sIHBITWV0ZXIuZHJhZ1lSYW5nZS5tYXggKSApO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZHJhZ0xpc3RlbmVyJyApXHJcbiAgICB9ICkgKTtcclxuXHJcbiAgICBwSE1ldGVyLnBvc2l0aW9uUHJvcGVydHkubGluayggcG9zaXRpb24gPT4ge1xyXG4gICAgICB0aGlzLnRyYW5zbGF0aW9uID0gcG9zaXRpb247XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5hZGRMaW5rZWRFbGVtZW50KCBwSE1ldGVyLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggcEhNZXRlci50YW5kZW0ubmFtZSApXHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhbiBpY29uIGZvciB0aGUgcEggbWV0ZXIuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVJY29uKCk6IE5vZGUge1xyXG4gICAgY29uc3QgcHJvYmVOb2RlID0gbmV3IFByb2JlTm9kZSggMiwgMTAsIDUsIDEyICk7XHJcbiAgICBjb25zdCBiYWNrZ3JvdW5kTm9kZSA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIDMwLCAxMCwgMiwgMiwge1xyXG4gICAgICBmaWxsOiBCQUNLR1JPVU5EX0ZJTEwsXHJcbiAgICAgIHN0cm9rZTogQkFDS0dST1VORF9TVFJPS0UsXHJcbiAgICAgIGxpbmVXaWR0aDogMC41LFxyXG4gICAgICBsZWZ0OiBwcm9iZU5vZGUuY2VudGVyWCAtIDcsXHJcbiAgICAgIGJvdHRvbTogcHJvYmVOb2RlLnRvcCArIDFcclxuICAgIH0gKTtcclxuICAgIHJldHVybiBuZXcgTm9kZSggeyBjaGlsZHJlbjogWyBwcm9iZU5vZGUsIGJhY2tncm91bmROb2RlIF0gfSApO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIHBIIFByb2JlLCBjb25zaXN0cyBvZiBhIHNoYWZ0IGF0dGFjaGVkIHRvIGEgdGlwLlxyXG4gKi9cclxuY2xhc3MgUHJvYmVOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvciggc2hhZnRXaWR0aDogbnVtYmVyLCBzaGFmdEhlaWdodDogbnVtYmVyLCB0aXBXaWR0aDogbnVtYmVyLCB0aXBIZWlnaHQ6IG51bWJlciApIHtcclxuXHJcbiAgICBjb25zdCBvdmVybGFwID0gMTsgLy8gb3ZlcmxhcCwgdG8gaGlkZSBzZWFtXHJcblxyXG4gICAgLy8gcHJvYmUgc2hhZnRcclxuICAgIGNvbnN0IHNoYWZ0Tm9kZSA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIHNoYWZ0V2lkdGgsIHNoYWZ0SGVpZ2h0ICsgb3ZlcmxhcCwge1xyXG4gICAgICBmaWxsOiAncmdiKCAxOTIsIDE5MiwgMTkyICknLFxyXG4gICAgICBzdHJva2U6ICdyZ2IoIDE2MCwgMTYwLCAxNjAgKScsXHJcbiAgICAgIGxpbmVXaWR0aDogMC41XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gcHJvYmUgdGlwOiBjbG9ja3dpc2UgZnJvbSB0aXAgb2YgcHJvYmUsIG9yaWdpbiBhdCB1cHBlci1sZWZ0IG9mIHNoYXBlXHJcbiAgICBjb25zdCBjb3JuZXJSYWRpdXMgPSB0aXBIZWlnaHQgLyA5O1xyXG4gICAgY29uc3QgdGlwU2hhcGUgPSBuZXcgU2hhcGUoKVxyXG4gICAgICAubW92ZVRvKCB0aXBXaWR0aCAvIDIsIHRpcEhlaWdodCApXHJcbiAgICAgIC5saW5lVG8oIDAsIDAuNiAqIHRpcEhlaWdodCApXHJcbiAgICAgIC5saW5lVG8oIDAsIGNvcm5lclJhZGl1cyApXHJcbiAgICAgIC5hcmMoIGNvcm5lclJhZGl1cywgY29ybmVyUmFkaXVzLCBjb3JuZXJSYWRpdXMsIE1hdGguUEksIDEuNSAqIE1hdGguUEkgKVxyXG4gICAgICAubGluZVRvKCBjb3JuZXJSYWRpdXMsIDAgKVxyXG4gICAgICAubGluZVRvKCB0aXBXaWR0aCAtIGNvcm5lclJhZGl1cywgMCApXHJcbiAgICAgIC5hcmMoIHRpcFdpZHRoIC0gY29ybmVyUmFkaXVzLCBjb3JuZXJSYWRpdXMsIGNvcm5lclJhZGl1cywgLTAuNSAqIE1hdGguUEksIDAgKVxyXG4gICAgICAubGluZVRvKCB0aXBXaWR0aCwgMC42ICogdGlwSGVpZ2h0IClcclxuICAgICAgLmNsb3NlKCk7XHJcbiAgICBjb25zdCB0aXBOb2RlID0gbmV3IFBhdGgoIHRpcFNoYXBlLCB7XHJcbiAgICAgIGZpbGw6ICdibGFjaycsXHJcbiAgICAgIGNlbnRlclg6IHNoYWZ0Tm9kZS5jZW50ZXJYLFxyXG4gICAgICB0b3A6IHNoYWZ0Tm9kZS5ib3R0b20gLSBvdmVybGFwXHJcbiAgICB9ICk7XHJcblxyXG4gICAgc3VwZXIoIHsgY2hpbGRyZW46IFsgc2hhZnROb2RlLCB0aXBOb2RlIF0gfSApO1xyXG4gIH1cclxufVxyXG5cclxuYWNpZEJhc2VTb2x1dGlvbnMucmVnaXN0ZXIoICdQSE1ldGVyTm9kZScsIFBITWV0ZXJOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsU0FBU0MsS0FBSyxRQUFRLGdDQUFnQztBQUN0RCxPQUFPQyxXQUFXLE1BQU0sK0NBQStDO0FBQ3ZF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