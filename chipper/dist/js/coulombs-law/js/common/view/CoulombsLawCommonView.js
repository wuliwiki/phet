// Copyright 2017-2022, University of Colorado Boulder

/**
 * Parent screen view that allows for different model to view scaling for each child sim. Adds controls, checkboxes, and
 * reset buttons to the screens.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 * @author Michael Barlow (PhET Interactive Simulations)
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Bounds2 from '../../../../dot/js/Bounds2.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import ISLCQueryParameters from '../../../../inverse-square-law-common/js/ISLCQueryParameters.js';
import ISLCForceValuesDisplayControl from '../../../../inverse-square-law-common/js/view/ISLCForceValuesDisplayControl.js';
import ISLCGridNode from '../../../../inverse-square-law-common/js/view/ISLCGridNode.js';
import ISLCPanel from '../../../../inverse-square-law-common/js/view/ISLCPanel.js';
import ISLCRulerNode from '../../../../inverse-square-law-common/js/view/ISLCRulerNode.js';
import ScreenView from '../../../../joist/js/ScreenView.js';
import merge from '../../../../phet-core/js/merge.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import coulombsLaw from '../../coulombsLaw.js';
import CoulombsLawStrings from '../../CoulombsLawStrings.js';
import ChargeControl from './ChargeControl.js';
import CoulombsLawRulerDescriber from './describers/CoulombsLawRulerDescriber.js';
const charge1String = CoulombsLawStrings.charge1;
const charge2String = CoulombsLawStrings.charge2;

// constants
const SHOW_GRID = ISLCQueryParameters.showGrid;
class CoulombsLawCommonView extends ScreenView {
  /**
   * @param {CoulombsLawModel} coulombsLawModel
   * @param {number} scaleFactor - multiplicative constant to distinguish between Macro and Atomic scales
   * @param {string} unitString
   * @param {number} modelViewTransformScale - allows for distinct layout scales between Macro and Atomic screens
   * @param {Object} [options]
   * @param {Tandem} tandem
   */
  constructor(coulombsLawModel, scaleFactor, unitString, modelViewTransformScale, options, tandem) {
    super({
      tandem: tandem,
      layoutBounds: new Bounds2(0, 0, 768, 464)
    });
    const rightAlignment = this.layoutBounds.maxX - 10;
    const bottomAlignment = this.layoutBounds.maxY - 10;

    // Create the model-view transform.  The primary units used in the model are meters, so significant zoom is used.
    // The multipliers for the 2nd parameter can be used to adjust where the point (0, 0) in the model, which is
    // between the two masses.
    const modelViewTransform = ModelViewTransform2.createSinglePointScaleInvertedYMapping(Vector2.ZERO, new Vector2(this.layoutBounds.width / 2, this.layoutBounds.height / 2), modelViewTransformScale);

    // @private
    this.modelViewTransform = modelViewTransform;
    const coulombsLawParameterPanel = new ISLCPanel(new ISLCForceValuesDisplayControl(coulombsLawModel.forceValuesDisplayProperty, {
      tandem: tandem.createTandem('forceValuesDisplayControl')
    }), {
      tandem: tandem.createTandem('coulombsLawParameterPanel'),
      fill: '#EDEDED',
      right: rightAlignment,
      bottom: bottomAlignment - 43 // empirically determined
    });

    const charge1Control = new ChargeControl(charge1String, unitString, coulombsLawModel.object1.valueProperty, coulombsLawModel.object1.valueRange, scaleFactor, {
      tandem: tandem.createTandem('charge1Control')
    });
    charge1Control.right = this.layoutBounds.centerX - 5;
    charge1Control.top = coulombsLawParameterPanel.top;
    const charge2Control = new ChargeControl(charge2String, unitString, coulombsLawModel.object2.valueProperty, coulombsLawModel.object2.valueRange, scaleFactor, {
      tandem: tandem.createTandem('charge2Control')
    });
    charge2Control.left = this.layoutBounds.centerX + 5;
    charge2Control.top = coulombsLawParameterPanel.top;
    const rulerDescriber = new CoulombsLawRulerDescriber(coulombsLawModel, 'label1', 'label2', {
      descriptionAlertNode: this
    });

    // ruler drag bounds (in model coordinate frame) - assumes a single point scale inverted Y mapping
    const minX = coulombsLawModel.leftObjectBoundary;
    const minY = modelViewTransform.viewToModelY(coulombsLawParameterPanel.top + 10); // bottom bound because Y is inverted
    const maxX = coulombsLawModel.rightObjectBoundary;
    const maxY = -modelViewTransform.viewToModelDeltaY(this.layoutBounds.height / 2); // top bound because Y is inverted

    // create and add macro ruler
    const coulombsLawRuler = new ISLCRulerNode(coulombsLawModel.rulerPositionProperty, new Bounds2(minX, minY, maxX, maxY), this.modelViewTransform, () => coulombsLawModel.object1.positionProperty.value,
    // wrap this in a closure instead of exposing this all to the ruler.
    rulerDescriber, merge(_.pick(options, ['snapToNearest', 'majorTickLabels', 'unitString', 'rulerInset', 'moveOnHoldDelay', 'moveOnHoldInterval']), {
      grabDragInteractionOptions: {
        grabCueOptions: {
          x: 155
        }
      },
      tandem: tandem.createTandem('rulerNode')
    }));

    // Reset All button
    // buttons are never disposed in this sim
    const resetAllButton = new ResetAllButton({
      listener: () => {
        coulombsLawModel.reset();
        charge1Control.reset();
        charge2Control.reset();
        coulombsLawRuler.reset();
      },
      radius: 18,
      right: rightAlignment,
      bottom: bottomAlignment,
      tandem: tandem.createTandem('resetAllButton')
    });
    this.children = [coulombsLawRuler, coulombsLawParameterPanel, charge1Control, charge2Control, resetAllButton];

    // pdom - accessible order of controls, charge objects will come first in subtypes
    this.pdomPlayAreaNode.pdomOrder = [coulombsLawRuler, charge1Control, charge2Control, coulombsLawParameterPanel, resetAllButton];

    //------------------------------------------------
    // debugging
    //------------------------------------------------

    if (SHOW_GRID) {
      const gridNode = new ISLCGridNode(coulombsLawModel.snapObjectsToNearest, this.layoutBounds, modelViewTransform, {
        stroke: 'rgba( 250, 100, 100, 0.6 )'
      });
      this.addChild(gridNode);
    }
  }
}
coulombsLaw.register('CoulombsLawCommonView', CoulombsLawCommonView);
export default CoulombsLawCommonView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb3VuZHMyIiwiVmVjdG9yMiIsIklTTENRdWVyeVBhcmFtZXRlcnMiLCJJU0xDRm9yY2VWYWx1ZXNEaXNwbGF5Q29udHJvbCIsIklTTENHcmlkTm9kZSIsIklTTENQYW5lbCIsIklTTENSdWxlck5vZGUiLCJTY3JlZW5WaWV3IiwibWVyZ2UiLCJNb2RlbFZpZXdUcmFuc2Zvcm0yIiwiUmVzZXRBbGxCdXR0b24iLCJjb3Vsb21ic0xhdyIsIkNvdWxvbWJzTGF3U3RyaW5ncyIsIkNoYXJnZUNvbnRyb2wiLCJDb3Vsb21ic0xhd1J1bGVyRGVzY3JpYmVyIiwiY2hhcmdlMVN0cmluZyIsImNoYXJnZTEiLCJjaGFyZ2UyU3RyaW5nIiwiY2hhcmdlMiIsIlNIT1dfR1JJRCIsInNob3dHcmlkIiwiQ291bG9tYnNMYXdDb21tb25WaWV3IiwiY29uc3RydWN0b3IiLCJjb3Vsb21ic0xhd01vZGVsIiwic2NhbGVGYWN0b3IiLCJ1bml0U3RyaW5nIiwibW9kZWxWaWV3VHJhbnNmb3JtU2NhbGUiLCJvcHRpb25zIiwidGFuZGVtIiwibGF5b3V0Qm91bmRzIiwicmlnaHRBbGlnbm1lbnQiLCJtYXhYIiwiYm90dG9tQWxpZ25tZW50IiwibWF4WSIsIm1vZGVsVmlld1RyYW5zZm9ybSIsImNyZWF0ZVNpbmdsZVBvaW50U2NhbGVJbnZlcnRlZFlNYXBwaW5nIiwiWkVSTyIsIndpZHRoIiwiaGVpZ2h0IiwiY291bG9tYnNMYXdQYXJhbWV0ZXJQYW5lbCIsImZvcmNlVmFsdWVzRGlzcGxheVByb3BlcnR5IiwiY3JlYXRlVGFuZGVtIiwiZmlsbCIsInJpZ2h0IiwiYm90dG9tIiwiY2hhcmdlMUNvbnRyb2wiLCJvYmplY3QxIiwidmFsdWVQcm9wZXJ0eSIsInZhbHVlUmFuZ2UiLCJjZW50ZXJYIiwidG9wIiwiY2hhcmdlMkNvbnRyb2wiLCJvYmplY3QyIiwibGVmdCIsInJ1bGVyRGVzY3JpYmVyIiwiZGVzY3JpcHRpb25BbGVydE5vZGUiLCJtaW5YIiwibGVmdE9iamVjdEJvdW5kYXJ5IiwibWluWSIsInZpZXdUb01vZGVsWSIsInJpZ2h0T2JqZWN0Qm91bmRhcnkiLCJ2aWV3VG9Nb2RlbERlbHRhWSIsImNvdWxvbWJzTGF3UnVsZXIiLCJydWxlclBvc2l0aW9uUHJvcGVydHkiLCJwb3NpdGlvblByb3BlcnR5IiwidmFsdWUiLCJfIiwicGljayIsImdyYWJEcmFnSW50ZXJhY3Rpb25PcHRpb25zIiwiZ3JhYkN1ZU9wdGlvbnMiLCJ4IiwicmVzZXRBbGxCdXR0b24iLCJsaXN0ZW5lciIsInJlc2V0IiwicmFkaXVzIiwiY2hpbGRyZW4iLCJwZG9tUGxheUFyZWFOb2RlIiwicGRvbU9yZGVyIiwiZ3JpZE5vZGUiLCJzbmFwT2JqZWN0c1RvTmVhcmVzdCIsInN0cm9rZSIsImFkZENoaWxkIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJDb3Vsb21ic0xhd0NvbW1vblZpZXcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTctMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogUGFyZW50IHNjcmVlbiB2aWV3IHRoYXQgYWxsb3dzIGZvciBkaWZmZXJlbnQgbW9kZWwgdG8gdmlldyBzY2FsaW5nIGZvciBlYWNoIGNoaWxkIHNpbS4gQWRkcyBjb250cm9scywgY2hlY2tib3hlcywgYW5kXHJcbiAqIHJlc2V0IGJ1dHRvbnMgdG8gdGhlIHNjcmVlbnMuXHJcbiAqXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIE1pY2hhZWwgQmFybG93IChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgSVNMQ1F1ZXJ5UGFyYW1ldGVycyBmcm9tICcuLi8uLi8uLi8uLi9pbnZlcnNlLXNxdWFyZS1sYXctY29tbW9uL2pzL0lTTENRdWVyeVBhcmFtZXRlcnMuanMnO1xyXG5pbXBvcnQgSVNMQ0ZvcmNlVmFsdWVzRGlzcGxheUNvbnRyb2wgZnJvbSAnLi4vLi4vLi4vLi4vaW52ZXJzZS1zcXVhcmUtbGF3LWNvbW1vbi9qcy92aWV3L0lTTENGb3JjZVZhbHVlc0Rpc3BsYXlDb250cm9sLmpzJztcclxuaW1wb3J0IElTTENHcmlkTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9pbnZlcnNlLXNxdWFyZS1sYXctY29tbW9uL2pzL3ZpZXcvSVNMQ0dyaWROb2RlLmpzJztcclxuaW1wb3J0IElTTENQYW5lbCBmcm9tICcuLi8uLi8uLi8uLi9pbnZlcnNlLXNxdWFyZS1sYXctY29tbW9uL2pzL3ZpZXcvSVNMQ1BhbmVsLmpzJztcclxuaW1wb3J0IElTTENSdWxlck5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vaW52ZXJzZS1zcXVhcmUtbGF3LWNvbW1vbi9qcy92aWV3L0lTTENSdWxlck5vZGUuanMnO1xyXG5pbXBvcnQgU2NyZWVuVmlldyBmcm9tICcuLi8uLi8uLi8uLi9qb2lzdC9qcy9TY3JlZW5WaWV3LmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBNb2RlbFZpZXdUcmFuc2Zvcm0yIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdmlldy9Nb2RlbFZpZXdUcmFuc2Zvcm0yLmpzJztcclxuaW1wb3J0IFJlc2V0QWxsQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL1Jlc2V0QWxsQnV0dG9uLmpzJztcclxuaW1wb3J0IGNvdWxvbWJzTGF3IGZyb20gJy4uLy4uL2NvdWxvbWJzTGF3LmpzJztcclxuaW1wb3J0IENvdWxvbWJzTGF3U3RyaW5ncyBmcm9tICcuLi8uLi9Db3Vsb21ic0xhd1N0cmluZ3MuanMnO1xyXG5pbXBvcnQgQ2hhcmdlQ29udHJvbCBmcm9tICcuL0NoYXJnZUNvbnRyb2wuanMnO1xyXG5pbXBvcnQgQ291bG9tYnNMYXdSdWxlckRlc2NyaWJlciBmcm9tICcuL2Rlc2NyaWJlcnMvQ291bG9tYnNMYXdSdWxlckRlc2NyaWJlci5qcyc7XHJcblxyXG5jb25zdCBjaGFyZ2UxU3RyaW5nID0gQ291bG9tYnNMYXdTdHJpbmdzLmNoYXJnZTE7XHJcbmNvbnN0IGNoYXJnZTJTdHJpbmcgPSBDb3Vsb21ic0xhd1N0cmluZ3MuY2hhcmdlMjtcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBTSE9XX0dSSUQgPSBJU0xDUXVlcnlQYXJhbWV0ZXJzLnNob3dHcmlkO1xyXG5cclxuY2xhc3MgQ291bG9tYnNMYXdDb21tb25WaWV3IGV4dGVuZHMgU2NyZWVuVmlldyB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7Q291bG9tYnNMYXdNb2RlbH0gY291bG9tYnNMYXdNb2RlbFxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsZUZhY3RvciAtIG11bHRpcGxpY2F0aXZlIGNvbnN0YW50IHRvIGRpc3Rpbmd1aXNoIGJldHdlZW4gTWFjcm8gYW5kIEF0b21pYyBzY2FsZXNcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdW5pdFN0cmluZ1xyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBtb2RlbFZpZXdUcmFuc2Zvcm1TY2FsZSAtIGFsbG93cyBmb3IgZGlzdGluY3QgbGF5b3V0IHNjYWxlcyBiZXR3ZWVuIE1hY3JvIGFuZCBBdG9taWMgc2NyZWVuc1xyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGNvdWxvbWJzTGF3TW9kZWwsIHNjYWxlRmFjdG9yLCB1bml0U3RyaW5nLCBtb2RlbFZpZXdUcmFuc2Zvcm1TY2FsZSwgb3B0aW9ucywgdGFuZGVtICkge1xyXG5cclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLFxyXG4gICAgICBsYXlvdXRCb3VuZHM6IG5ldyBCb3VuZHMyKCAwLCAwLCA3NjgsIDQ2NCApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgcmlnaHRBbGlnbm1lbnQgPSB0aGlzLmxheW91dEJvdW5kcy5tYXhYIC0gMTA7XHJcbiAgICBjb25zdCBib3R0b21BbGlnbm1lbnQgPSB0aGlzLmxheW91dEJvdW5kcy5tYXhZIC0gMTA7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBtb2RlbC12aWV3IHRyYW5zZm9ybS4gIFRoZSBwcmltYXJ5IHVuaXRzIHVzZWQgaW4gdGhlIG1vZGVsIGFyZSBtZXRlcnMsIHNvIHNpZ25pZmljYW50IHpvb20gaXMgdXNlZC5cclxuICAgIC8vIFRoZSBtdWx0aXBsaWVycyBmb3IgdGhlIDJuZCBwYXJhbWV0ZXIgY2FuIGJlIHVzZWQgdG8gYWRqdXN0IHdoZXJlIHRoZSBwb2ludCAoMCwgMCkgaW4gdGhlIG1vZGVsLCB3aGljaCBpc1xyXG4gICAgLy8gYmV0d2VlbiB0aGUgdHdvIG1hc3Nlcy5cclxuICAgIGNvbnN0IG1vZGVsVmlld1RyYW5zZm9ybSA9IE1vZGVsVmlld1RyYW5zZm9ybTIuY3JlYXRlU2luZ2xlUG9pbnRTY2FsZUludmVydGVkWU1hcHBpbmcoXHJcbiAgICAgIFZlY3RvcjIuWkVSTyxcclxuICAgICAgbmV3IFZlY3RvcjIoIHRoaXMubGF5b3V0Qm91bmRzLndpZHRoIC8gMiwgdGhpcy5sYXlvdXRCb3VuZHMuaGVpZ2h0IC8gMiApLFxyXG4gICAgICBtb2RlbFZpZXdUcmFuc2Zvcm1TY2FsZVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0gPSBtb2RlbFZpZXdUcmFuc2Zvcm07XHJcblxyXG4gICAgY29uc3QgY291bG9tYnNMYXdQYXJhbWV0ZXJQYW5lbCA9IG5ldyBJU0xDUGFuZWwoXHJcbiAgICAgIG5ldyBJU0xDRm9yY2VWYWx1ZXNEaXNwbGF5Q29udHJvbCggY291bG9tYnNMYXdNb2RlbC5mb3JjZVZhbHVlc0Rpc3BsYXlQcm9wZXJ0eSwge1xyXG4gICAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2ZvcmNlVmFsdWVzRGlzcGxheUNvbnRyb2wnIClcclxuICAgICAgfSApLCB7XHJcbiAgICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnY291bG9tYnNMYXdQYXJhbWV0ZXJQYW5lbCcgKSxcclxuICAgICAgICBmaWxsOiAnI0VERURFRCcsXHJcbiAgICAgICAgcmlnaHQ6IHJpZ2h0QWxpZ25tZW50LFxyXG4gICAgICAgIGJvdHRvbTogYm90dG9tQWxpZ25tZW50IC0gNDMgLy8gZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgY2hhcmdlMUNvbnRyb2wgPSBuZXcgQ2hhcmdlQ29udHJvbChcclxuICAgICAgY2hhcmdlMVN0cmluZyxcclxuICAgICAgdW5pdFN0cmluZyxcclxuICAgICAgY291bG9tYnNMYXdNb2RlbC5vYmplY3QxLnZhbHVlUHJvcGVydHksXHJcbiAgICAgIGNvdWxvbWJzTGF3TW9kZWwub2JqZWN0MS52YWx1ZVJhbmdlLFxyXG4gICAgICBzY2FsZUZhY3RvcixcclxuICAgICAgeyB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdjaGFyZ2UxQ29udHJvbCcgKSB9XHJcbiAgICApO1xyXG4gICAgY2hhcmdlMUNvbnRyb2wucmlnaHQgPSB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJYIC0gNTtcclxuICAgIGNoYXJnZTFDb250cm9sLnRvcCA9IGNvdWxvbWJzTGF3UGFyYW1ldGVyUGFuZWwudG9wO1xyXG5cclxuICAgIGNvbnN0IGNoYXJnZTJDb250cm9sID0gbmV3IENoYXJnZUNvbnRyb2woXHJcbiAgICAgIGNoYXJnZTJTdHJpbmcsXHJcbiAgICAgIHVuaXRTdHJpbmcsXHJcbiAgICAgIGNvdWxvbWJzTGF3TW9kZWwub2JqZWN0Mi52YWx1ZVByb3BlcnR5LFxyXG4gICAgICBjb3Vsb21ic0xhd01vZGVsLm9iamVjdDIudmFsdWVSYW5nZSxcclxuICAgICAgc2NhbGVGYWN0b3IsXHJcbiAgICAgIHtcclxuICAgICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdjaGFyZ2UyQ29udHJvbCcgKVxyXG4gICAgICB9XHJcbiAgICApO1xyXG5cclxuICAgIGNoYXJnZTJDb250cm9sLmxlZnQgPSB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJYICsgNTtcclxuICAgIGNoYXJnZTJDb250cm9sLnRvcCA9IGNvdWxvbWJzTGF3UGFyYW1ldGVyUGFuZWwudG9wO1xyXG5cclxuICAgIGNvbnN0IHJ1bGVyRGVzY3JpYmVyID0gbmV3IENvdWxvbWJzTGF3UnVsZXJEZXNjcmliZXIoIGNvdWxvbWJzTGF3TW9kZWwsICdsYWJlbDEnLCAnbGFiZWwyJywge1xyXG4gICAgICBkZXNjcmlwdGlvbkFsZXJ0Tm9kZTogdGhpc1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHJ1bGVyIGRyYWcgYm91bmRzIChpbiBtb2RlbCBjb29yZGluYXRlIGZyYW1lKSAtIGFzc3VtZXMgYSBzaW5nbGUgcG9pbnQgc2NhbGUgaW52ZXJ0ZWQgWSBtYXBwaW5nXHJcbiAgICBjb25zdCBtaW5YID0gY291bG9tYnNMYXdNb2RlbC5sZWZ0T2JqZWN0Qm91bmRhcnk7XHJcbiAgICBjb25zdCBtaW5ZID0gbW9kZWxWaWV3VHJhbnNmb3JtLnZpZXdUb01vZGVsWSggY291bG9tYnNMYXdQYXJhbWV0ZXJQYW5lbC50b3AgKyAxMCApOyAvLyBib3R0b20gYm91bmQgYmVjYXVzZSBZIGlzIGludmVydGVkXHJcbiAgICBjb25zdCBtYXhYID0gY291bG9tYnNMYXdNb2RlbC5yaWdodE9iamVjdEJvdW5kYXJ5O1xyXG4gICAgY29uc3QgbWF4WSA9IC1tb2RlbFZpZXdUcmFuc2Zvcm0udmlld1RvTW9kZWxEZWx0YVkoIHRoaXMubGF5b3V0Qm91bmRzLmhlaWdodCAvIDIgKTsgLy8gdG9wIGJvdW5kIGJlY2F1c2UgWSBpcyBpbnZlcnRlZFxyXG5cclxuICAgIC8vIGNyZWF0ZSBhbmQgYWRkIG1hY3JvIHJ1bGVyXHJcbiAgICBjb25zdCBjb3Vsb21ic0xhd1J1bGVyID0gbmV3IElTTENSdWxlck5vZGUoXHJcbiAgICAgIGNvdWxvbWJzTGF3TW9kZWwucnVsZXJQb3NpdGlvblByb3BlcnR5LFxyXG4gICAgICBuZXcgQm91bmRzMiggbWluWCwgbWluWSwgbWF4WCwgbWF4WSApLFxyXG4gICAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgKCkgPT4gY291bG9tYnNMYXdNb2RlbC5vYmplY3QxLnBvc2l0aW9uUHJvcGVydHkudmFsdWUsIC8vIHdyYXAgdGhpcyBpbiBhIGNsb3N1cmUgaW5zdGVhZCBvZiBleHBvc2luZyB0aGlzIGFsbCB0byB0aGUgcnVsZXIuXHJcbiAgICAgIHJ1bGVyRGVzY3JpYmVyLFxyXG4gICAgICBtZXJnZSggXy5waWNrKCBvcHRpb25zLCBbXHJcbiAgICAgICAgJ3NuYXBUb05lYXJlc3QnLFxyXG4gICAgICAgICdtYWpvclRpY2tMYWJlbHMnLFxyXG4gICAgICAgICd1bml0U3RyaW5nJyxcclxuICAgICAgICAncnVsZXJJbnNldCcsXHJcbiAgICAgICAgJ21vdmVPbkhvbGREZWxheScsXHJcbiAgICAgICAgJ21vdmVPbkhvbGRJbnRlcnZhbCdcclxuICAgICAgXSApLCB7XHJcbiAgICAgICAgZ3JhYkRyYWdJbnRlcmFjdGlvbk9wdGlvbnM6IHsgZ3JhYkN1ZU9wdGlvbnM6IHsgeDogMTU1IH0gfSxcclxuICAgICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdydWxlck5vZGUnIClcclxuICAgICAgfSApICk7XHJcblxyXG4gICAgLy8gUmVzZXQgQWxsIGJ1dHRvblxyXG4gICAgLy8gYnV0dG9ucyBhcmUgbmV2ZXIgZGlzcG9zZWQgaW4gdGhpcyBzaW1cclxuICAgIGNvbnN0IHJlc2V0QWxsQnV0dG9uID0gbmV3IFJlc2V0QWxsQnV0dG9uKCB7XHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgY291bG9tYnNMYXdNb2RlbC5yZXNldCgpO1xyXG4gICAgICAgIGNoYXJnZTFDb250cm9sLnJlc2V0KCk7XHJcbiAgICAgICAgY2hhcmdlMkNvbnRyb2wucmVzZXQoKTtcclxuICAgICAgICBjb3Vsb21ic0xhd1J1bGVyLnJlc2V0KCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIHJhZGl1czogMTgsXHJcbiAgICAgIHJpZ2h0OiByaWdodEFsaWdubWVudCxcclxuICAgICAgYm90dG9tOiBib3R0b21BbGlnbm1lbnQsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Jlc2V0QWxsQnV0dG9uJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5jaGlsZHJlbiA9IFtcclxuICAgICAgY291bG9tYnNMYXdSdWxlcixcclxuICAgICAgY291bG9tYnNMYXdQYXJhbWV0ZXJQYW5lbCxcclxuICAgICAgY2hhcmdlMUNvbnRyb2wsXHJcbiAgICAgIGNoYXJnZTJDb250cm9sLFxyXG4gICAgICByZXNldEFsbEJ1dHRvblxyXG4gICAgXTtcclxuXHJcbiAgICAvLyBwZG9tIC0gYWNjZXNzaWJsZSBvcmRlciBvZiBjb250cm9scywgY2hhcmdlIG9iamVjdHMgd2lsbCBjb21lIGZpcnN0IGluIHN1YnR5cGVzXHJcbiAgICB0aGlzLnBkb21QbGF5QXJlYU5vZGUucGRvbU9yZGVyID0gW1xyXG4gICAgICBjb3Vsb21ic0xhd1J1bGVyLFxyXG4gICAgICBjaGFyZ2UxQ29udHJvbCxcclxuICAgICAgY2hhcmdlMkNvbnRyb2wsXHJcbiAgICAgIGNvdWxvbWJzTGF3UGFyYW1ldGVyUGFuZWwsXHJcbiAgICAgIHJlc2V0QWxsQnV0dG9uXHJcbiAgICBdO1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAvLyBkZWJ1Z2dpbmdcclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgaWYgKCBTSE9XX0dSSUQgKSB7XHJcbiAgICAgIGNvbnN0IGdyaWROb2RlID0gbmV3IElTTENHcmlkTm9kZShcclxuICAgICAgICBjb3Vsb21ic0xhd01vZGVsLnNuYXBPYmplY3RzVG9OZWFyZXN0LFxyXG4gICAgICAgIHRoaXMubGF5b3V0Qm91bmRzLFxyXG4gICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgICB7IHN0cm9rZTogJ3JnYmEoIDI1MCwgMTAwLCAxMDAsIDAuNiApJyB9ICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIGdyaWROb2RlICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5jb3Vsb21ic0xhdy5yZWdpc3RlciggJ0NvdWxvbWJzTGF3Q29tbW9uVmlldycsIENvdWxvbWJzTGF3Q29tbW9uVmlldyApO1xyXG5leHBvcnQgZGVmYXVsdCBDb3Vsb21ic0xhd0NvbW1vblZpZXc7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxtQkFBbUIsTUFBTSxpRUFBaUU7QUFDakcsT0FBT0MsNkJBQTZCLE1BQU0sZ0ZBQWdGO0FBQzFILE9BQU9DLFlBQVksTUFBTSwrREFBK0Q7QUFDeEYsT0FBT0MsU0FBUyxNQUFNLDREQUE0RDtBQUNsRixPQUFPQyxhQUFhLE1BQU0sZ0VBQWdFO0FBQzFGLE9BQU9DLFVBQVUsTUFBTSxvQ0FBb0M7QUFDM0QsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxPQUFPQyxtQkFBbUIsTUFBTSx1REFBdUQ7QUFDdkYsT0FBT0MsY0FBYyxNQUFNLHVEQUF1RDtB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