// Copyright 2017-2022, University of Colorado Boulder

/**
 * Atomic scale specific screen view. Adds charge, ruler, and legend nodes that all require scale-specific instantiation.
 * Also creates the proper model/view scaling.
 *
 * @author Jesse Greenberg
 * @author Michael Barlow
 */

import InverseSquareLawCommonStrings from '../../../../inverse-square-law-common/js/InverseSquareLawCommonStrings.js';
import ISLCConstants from '../../../../inverse-square-law-common/js/ISLCConstants.js';
import DefaultDirection from '../../../../inverse-square-law-common/js/view/DefaultDirection.js';
import ISLCAlertManager from '../../../../inverse-square-law-common/js/view/ISLCAlertManager.js';
import ISLCLegendNode from '../../../../inverse-square-law-common/js/view/ISLCLegendNode.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { RichText } from '../../../../scenery/js/imports.js';
import CoulombsLawColors from '../../common/CoulombsLawColors.js';
import ChargeNode from '../../common/view/ChargeNode.js';
import CoulombsLawCommonView from '../../common/view/CoulombsLawCommonView.js';
import CoulombsLawForceDescriber from '../../common/view/describers/CoulombsLawForceDescriber.js';
import CoulombsLawPositionDescriber from '../../common/view/describers/CoulombsLawPositionDescriber.js';
import coulombsLaw from '../../coulombsLaw.js';
import CoulombsLawStrings from '../../CoulombsLawStrings.js';
const charge1AbbreviatedString = CoulombsLawStrings.charge1Abbreviated;
const charge2AbbreviatedString = CoulombsLawStrings.charge2Abbreviated;
const pmScaleString = CoulombsLawStrings.pmScale;
const unitsAtomicLegendScaleString = CoulombsLawStrings.units.atomicLegendScale;
const unitsAtomicUnitsString = CoulombsLawStrings.units.atomicUnits;
const unitsPicometersString = InverseSquareLawCommonStrings.units.picometers;

// constants
const SCALE_FACTOR = 1 / ISLCConstants.coulombsPerAtomicUnit; // number of e in one C
const MODEL_VIEW_TRANSFORM_SCALE = 5E12; // scales the modelViewTransform for accurate positioning on Macro and Atomic screens
const ARROW_MAX_WIDTH = 10000;
class CoulombsLawAtomicView extends CoulombsLawCommonView {
  /**
   * @param {CoulombsLawModel} coulombsLawModel
   * @param {Tandem} tandem
   */
  constructor(coulombsLawModel, tandem) {
    const rulerOptions = {
      snapToNearest: 1E-12,
      // in model coordinates
      majorTickLabels: ['0', '10', '20', '30', '40', '50', '60', '70', '80', '90', '100'],
      unitString: unitsPicometersString,
      rulerInset: 15
    };
    const positionDescriber = new CoulombsLawPositionDescriber(coulombsLawModel, 'label1', 'label2');
    const forceDescriber = new CoulombsLawForceDescriber(coulombsLawModel, 'label1', 'label2', positionDescriber);
    const alertManager = new ISLCAlertManager(coulombsLawModel, forceDescriber);
    super(coulombsLawModel, SCALE_FACTOR, unitsAtomicUnitsString, MODEL_VIEW_TRANSFORM_SCALE, rulerOptions, tandem);

    // charge nodes added in each screen to allow for different decimal precision and arrow height
    const chargeNode1 = new ChargeNode(coulombsLawModel, coulombsLawModel.object1, this.layoutBounds, this.modelViewTransform, alertManager, forceDescriber, positionDescriber, {
      label: charge1AbbreviatedString,
      otherObjectLabel: charge2AbbreviatedString,
      defaultDirection: DefaultDirection.LEFT,
      arrowColor: '#66f',
      forceArrowHeight: 70,
      pullerNodeOptions: {
        atomicScale: true
      },
      arrowNodeOptions: {
        forceReadoutDecimalPlaces: 9,
        maxArrowWidth: ARROW_MAX_WIDTH
      },
      tandem: tandem.createTandem('chargeNode1')
    });
    const chargeNode2 = new ChargeNode(coulombsLawModel, coulombsLawModel.object2, this.layoutBounds, this.modelViewTransform, alertManager, forceDescriber, positionDescriber, {
      label: charge2AbbreviatedString,
      otherObjectLabel: charge1AbbreviatedString,
      defaultDirection: DefaultDirection.RIGHT,
      arrowColor: '#f66',
      forceArrowHeight: 120,
      pullerNodeOptions: {
        atomicScale: true
      },
      arrowNodeOptions: {
        forceReadoutDecimalPlaces: 9,
        maxArrowWidth: ARROW_MAX_WIDTH
      },
      tandem: tandem.createTandem('chargeNode2')
    });

    // charge nodes and arrows are added to the bottom of the scene graph so that the ruler will appear above them yet
    // still below the control panels (which are added in the CommonView)
    this.insertChild(0, chargeNode1);
    this.insertChild(0, chargeNode2);

    // the arrows and their labels should be above both charges (and their markers) but below
    // the ruler and control panels
    this.insertChild(1, chargeNode1.arrowNode);
    this.insertChild(1, chargeNode2.arrowNode);

    // create a line the length of 1 picometer
    const legendNodeLineLength = this.modelViewTransform.modelToViewDeltaX(10E-12);
    const legendNode = new ISLCLegendNode(legendNodeLineLength,
    // length of the line
    unitsAtomicLegendScaleString,
    // unit string
    {
      fill: CoulombsLawColors.legendNodeFillProperty,
      bottom: this.layoutBounds.maxY - 10,
      left: this.layoutBounds.minX + 9.35,
      tandem: tandem.createTandem('atomicLegendNode')
    });
    this.addChild(legendNode);

    // add picometer conversion string
    const picometerScaleText = new RichText(pmScaleString, {
      fill: CoulombsLawColors.legendNodeFillProperty,
      font: new PhetFont(12),
      maxWidth: 180,
      centerY: legendNode.localToParentPoint(legendNode.legendArrowLine.center).y,
      left: legendNode.right + 10,
      tandem: tandem.createTandem('picometerScaleText')
    });
    this.addChild(picometerScaleText);

    // pdom - charges are first in focus order
    const charges = [chargeNode1, chargeNode2];

    // pdom - traversal order for the screenview (ParallelDOM.js setter)
    this.pdomPlayAreaNode.pdomOrder = charges.concat(this.pdomPlayAreaNode.pdomOrder);
  }
}
coulombsLaw.register('CoulombsLawAtomicView', CoulombsLawAtomicView);
export default CoulombsLawAtomicView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJJbnZlcnNlU3F1YXJlTGF3Q29tbW9uU3RyaW5ncyIsIklTTENDb25zdGFudHMiLCJEZWZhdWx0RGlyZWN0aW9uIiwiSVNMQ0FsZXJ0TWFuYWdlciIsIklTTENMZWdlbmROb2RlIiwiUGhldEZvbnQiLCJSaWNoVGV4dCIsIkNvdWxvbWJzTGF3Q29sb3JzIiwiQ2hhcmdlTm9kZSIsIkNvdWxvbWJzTGF3Q29tbW9uVmlldyIsIkNvdWxvbWJzTGF3Rm9yY2VEZXNjcmliZXIiLCJDb3Vsb21ic0xhd1Bvc2l0aW9uRGVzY3JpYmVyIiwiY291bG9tYnNMYXciLCJDb3Vsb21ic0xhd1N0cmluZ3MiLCJjaGFyZ2UxQWJicmV2aWF0ZWRTdHJpbmciLCJjaGFyZ2UxQWJicmV2aWF0ZWQiLCJjaGFyZ2UyQWJicmV2aWF0ZWRTdHJpbmciLCJjaGFyZ2UyQWJicmV2aWF0ZWQiLCJwbVNjYWxlU3RyaW5nIiwicG1TY2FsZSIsInVuaXRzQXRvbWljTGVnZW5kU2NhbGVTdHJpbmciLCJ1bml0cyIsImF0b21pY0xlZ2VuZFNjYWxlIiwidW5pdHNBdG9taWNVbml0c1N0cmluZyIsImF0b21pY1VuaXRzIiwidW5pdHNQaWNvbWV0ZXJzU3RyaW5nIiwicGljb21ldGVycyIsIlNDQUxFX0ZBQ1RPUiIsImNvdWxvbWJzUGVyQXRvbWljVW5pdCIsIk1PREVMX1ZJRVdfVFJBTlNGT1JNX1NDQUxFIiwiQVJST1dfTUFYX1dJRFRIIiwiQ291bG9tYnNMYXdBdG9taWNWaWV3IiwiY29uc3RydWN0b3IiLCJjb3Vsb21ic0xhd01vZGVsIiwidGFuZGVtIiwicnVsZXJPcHRpb25zIiwic25hcFRvTmVhcmVzdCIsIm1ham9yVGlja0xhYmVscyIsInVuaXRTdHJpbmciLCJydWxlckluc2V0IiwicG9zaXRpb25EZXNjcmliZXIiLCJmb3JjZURlc2NyaWJlciIsImFsZXJ0TWFuYWdlciIsImNoYXJnZU5vZGUxIiwib2JqZWN0MSIsImxheW91dEJvdW5kcyIsIm1vZGVsVmlld1RyYW5zZm9ybSIsImxhYmVsIiwib3RoZXJPYmplY3RMYWJlbCIsImRlZmF1bHREaXJlY3Rpb24iLCJMRUZUIiwiYXJyb3dDb2xvciIsImZvcmNlQXJyb3dIZWlnaHQiLCJwdWxsZXJOb2RlT3B0aW9ucyIsImF0b21pY1NjYWxlIiwiYXJyb3dOb2RlT3B0aW9ucyIsImZvcmNlUmVhZG91dERlY2ltYWxQbGFjZXMiLCJtYXhBcnJvd1dpZHRoIiwiY3JlYXRlVGFuZGVtIiwiY2hhcmdlTm9kZTIiLCJvYmplY3QyIiwiUklHSFQiLCJpbnNlcnRDaGlsZCIsImFycm93Tm9kZSIsImxlZ2VuZE5vZGVMaW5lTGVuZ3RoIiwibW9kZWxUb1ZpZXdEZWx0YVgiLCJsZWdlbmROb2RlIiwiZmlsbCIsImxlZ2VuZE5vZGVGaWxsUHJvcGVydHkiLCJib3R0b20iLCJtYXhZIiwibGVmdCIsIm1pblgiLCJhZGRDaGlsZCIsInBpY29tZXRlclNjYWxlVGV4dCIsImZvbnQiLCJtYXhXaWR0aCIsImNlbnRlclkiLCJsb2NhbFRvUGFyZW50UG9pbnQiLCJsZWdlbmRBcnJvd0xpbmUiLCJjZW50ZXIiLCJ5IiwicmlnaHQiLCJjaGFyZ2VzIiwicGRvbVBsYXlBcmVhTm9kZSIsInBkb21PcmRlciIsImNvbmNhdCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQ291bG9tYnNMYXdBdG9taWNWaWV3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEF0b21pYyBzY2FsZSBzcGVjaWZpYyBzY3JlZW4gdmlldy4gQWRkcyBjaGFyZ2UsIHJ1bGVyLCBhbmQgbGVnZW5kIG5vZGVzIHRoYXQgYWxsIHJlcXVpcmUgc2NhbGUtc3BlY2lmaWMgaW5zdGFudGlhdGlvbi5cclxuICogQWxzbyBjcmVhdGVzIHRoZSBwcm9wZXIgbW9kZWwvdmlldyBzY2FsaW5nLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZ1xyXG4gKiBAYXV0aG9yIE1pY2hhZWwgQmFybG93XHJcbiAqL1xyXG5cclxuaW1wb3J0IEludmVyc2VTcXVhcmVMYXdDb21tb25TdHJpbmdzIGZyb20gJy4uLy4uLy4uLy4uL2ludmVyc2Utc3F1YXJlLWxhdy1jb21tb24vanMvSW52ZXJzZVNxdWFyZUxhd0NvbW1vblN0cmluZ3MuanMnO1xyXG5pbXBvcnQgSVNMQ0NvbnN0YW50cyBmcm9tICcuLi8uLi8uLi8uLi9pbnZlcnNlLXNxdWFyZS1sYXctY29tbW9uL2pzL0lTTENDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgRGVmYXVsdERpcmVjdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9pbnZlcnNlLXNxdWFyZS1sYXctY29tbW9uL2pzL3ZpZXcvRGVmYXVsdERpcmVjdGlvbi5qcyc7XHJcbmltcG9ydCBJU0xDQWxlcnRNYW5hZ2VyIGZyb20gJy4uLy4uLy4uLy4uL2ludmVyc2Utc3F1YXJlLWxhdy1jb21tb24vanMvdmlldy9JU0xDQWxlcnRNYW5hZ2VyLmpzJztcclxuaW1wb3J0IElTTENMZWdlbmROb2RlIGZyb20gJy4uLy4uLy4uLy4uL2ludmVyc2Utc3F1YXJlLWxhdy1jb21tb24vanMvdmlldy9JU0xDTGVnZW5kTm9kZS5qcyc7XHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUGhldEZvbnQuanMnO1xyXG5pbXBvcnQgeyBSaWNoVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBDb3Vsb21ic0xhd0NvbG9ycyBmcm9tICcuLi8uLi9jb21tb24vQ291bG9tYnNMYXdDb2xvcnMuanMnO1xyXG5pbXBvcnQgQ2hhcmdlTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9DaGFyZ2VOb2RlLmpzJztcclxuaW1wb3J0IENvdWxvbWJzTGF3Q29tbW9uVmlldyBmcm9tICcuLi8uLi9jb21tb24vdmlldy9Db3Vsb21ic0xhd0NvbW1vblZpZXcuanMnO1xyXG5pbXBvcnQgQ291bG9tYnNMYXdGb3JjZURlc2NyaWJlciBmcm9tICcuLi8uLi9jb21tb24vdmlldy9kZXNjcmliZXJzL0NvdWxvbWJzTGF3Rm9yY2VEZXNjcmliZXIuanMnO1xyXG5pbXBvcnQgQ291bG9tYnNMYXdQb3NpdGlvbkRlc2NyaWJlciBmcm9tICcuLi8uLi9jb21tb24vdmlldy9kZXNjcmliZXJzL0NvdWxvbWJzTGF3UG9zaXRpb25EZXNjcmliZXIuanMnO1xyXG5pbXBvcnQgY291bG9tYnNMYXcgZnJvbSAnLi4vLi4vY291bG9tYnNMYXcuanMnO1xyXG5pbXBvcnQgQ291bG9tYnNMYXdTdHJpbmdzIGZyb20gJy4uLy4uL0NvdWxvbWJzTGF3U3RyaW5ncy5qcyc7XHJcblxyXG5jb25zdCBjaGFyZ2UxQWJicmV2aWF0ZWRTdHJpbmcgPSBDb3Vsb21ic0xhd1N0cmluZ3MuY2hhcmdlMUFiYnJldmlhdGVkO1xyXG5jb25zdCBjaGFyZ2UyQWJicmV2aWF0ZWRTdHJpbmcgPSBDb3Vsb21ic0xhd1N0cmluZ3MuY2hhcmdlMkFiYnJldmlhdGVkO1xyXG5jb25zdCBwbVNjYWxlU3RyaW5nID0gQ291bG9tYnNMYXdTdHJpbmdzLnBtU2NhbGU7XHJcbmNvbnN0IHVuaXRzQXRvbWljTGVnZW5kU2NhbGVTdHJpbmcgPSBDb3Vsb21ic0xhd1N0cmluZ3MudW5pdHMuYXRvbWljTGVnZW5kU2NhbGU7XHJcbmNvbnN0IHVuaXRzQXRvbWljVW5pdHNTdHJpbmcgPSBDb3Vsb21ic0xhd1N0cmluZ3MudW5pdHMuYXRvbWljVW5pdHM7XHJcbmNvbnN0IHVuaXRzUGljb21ldGVyc1N0cmluZyA9IEludmVyc2VTcXVhcmVMYXdDb21tb25TdHJpbmdzLnVuaXRzLnBpY29tZXRlcnM7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgU0NBTEVfRkFDVE9SID0gMSAvIElTTENDb25zdGFudHMuY291bG9tYnNQZXJBdG9taWNVbml0OyAgLy8gbnVtYmVyIG9mIGUgaW4gb25lIENcclxuY29uc3QgTU9ERUxfVklFV19UUkFOU0ZPUk1fU0NBTEUgPSA1RTEyOyAvLyBzY2FsZXMgdGhlIG1vZGVsVmlld1RyYW5zZm9ybSBmb3IgYWNjdXJhdGUgcG9zaXRpb25pbmcgb24gTWFjcm8gYW5kIEF0b21pYyBzY3JlZW5zXHJcbmNvbnN0IEFSUk9XX01BWF9XSURUSCA9IDEwMDAwO1xyXG5cclxuY2xhc3MgQ291bG9tYnNMYXdBdG9taWNWaWV3IGV4dGVuZHMgQ291bG9tYnNMYXdDb21tb25WaWV3IHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtDb3Vsb21ic0xhd01vZGVsfSBjb3Vsb21ic0xhd01vZGVsXHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBjb3Vsb21ic0xhd01vZGVsLCB0YW5kZW0gKSB7XHJcblxyXG4gICAgY29uc3QgcnVsZXJPcHRpb25zID0ge1xyXG4gICAgICBzbmFwVG9OZWFyZXN0OiAxRS0xMiwgLy8gaW4gbW9kZWwgY29vcmRpbmF0ZXNcclxuICAgICAgbWFqb3JUaWNrTGFiZWxzOiBbICcwJywgJzEwJywgJzIwJywgJzMwJywgJzQwJywgJzUwJywgJzYwJywgJzcwJywgJzgwJywgJzkwJywgJzEwMCcgXSxcclxuICAgICAgdW5pdFN0cmluZzogdW5pdHNQaWNvbWV0ZXJzU3RyaW5nLFxyXG4gICAgICBydWxlckluc2V0OiAxNVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBwb3NpdGlvbkRlc2NyaWJlciA9IG5ldyBDb3Vsb21ic0xhd1Bvc2l0aW9uRGVzY3JpYmVyKCBjb3Vsb21ic0xhd01vZGVsLCAnbGFiZWwxJywgJ2xhYmVsMicgKTtcclxuICAgIGNvbnN0IGZvcmNlRGVzY3JpYmVyID0gbmV3IENvdWxvbWJzTGF3Rm9yY2VEZXNjcmliZXIoIGNvdWxvbWJzTGF3TW9kZWwsICdsYWJlbDEnLCAnbGFiZWwyJywgcG9zaXRpb25EZXNjcmliZXIgKTtcclxuICAgIGNvbnN0IGFsZXJ0TWFuYWdlciA9IG5ldyBJU0xDQWxlcnRNYW5hZ2VyKCBjb3Vsb21ic0xhd01vZGVsLCBmb3JjZURlc2NyaWJlciApO1xyXG5cclxuICAgIHN1cGVyKCBjb3Vsb21ic0xhd01vZGVsLCBTQ0FMRV9GQUNUT1IsIHVuaXRzQXRvbWljVW5pdHNTdHJpbmcsIE1PREVMX1ZJRVdfVFJBTlNGT1JNX1NDQUxFLCBydWxlck9wdGlvbnMsIHRhbmRlbSApO1xyXG5cclxuICAgIC8vIGNoYXJnZSBub2RlcyBhZGRlZCBpbiBlYWNoIHNjcmVlbiB0byBhbGxvdyBmb3IgZGlmZmVyZW50IGRlY2ltYWwgcHJlY2lzaW9uIGFuZCBhcnJvdyBoZWlnaHRcclxuICAgIGNvbnN0IGNoYXJnZU5vZGUxID0gbmV3IENoYXJnZU5vZGUoXHJcbiAgICAgIGNvdWxvbWJzTGF3TW9kZWwsXHJcbiAgICAgIGNvdWxvbWJzTGF3TW9kZWwub2JqZWN0MSxcclxuICAgICAgdGhpcy5sYXlvdXRCb3VuZHMsXHJcbiAgICAgIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLFxyXG4gICAgICBhbGVydE1hbmFnZXIsXHJcbiAgICAgIGZvcmNlRGVzY3JpYmVyLFxyXG4gICAgICBwb3NpdGlvbkRlc2NyaWJlcixcclxuICAgICAge1xyXG4gICAgICAgIGxhYmVsOiBjaGFyZ2UxQWJicmV2aWF0ZWRTdHJpbmcsXHJcbiAgICAgICAgb3RoZXJPYmplY3RMYWJlbDogY2hhcmdlMkFiYnJldmlhdGVkU3RyaW5nLFxyXG4gICAgICAgIGRlZmF1bHREaXJlY3Rpb246IERlZmF1bHREaXJlY3Rpb24uTEVGVCxcclxuICAgICAgICBhcnJvd0NvbG9yOiAnIzY2ZicsXHJcbiAgICAgICAgZm9yY2VBcnJvd0hlaWdodDogNzAsXHJcbiAgICAgICAgcHVsbGVyTm9kZU9wdGlvbnM6IHtcclxuICAgICAgICAgIGF0b21pY1NjYWxlOiB0cnVlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBhcnJvd05vZGVPcHRpb25zOiB7XHJcbiAgICAgICAgICBmb3JjZVJlYWRvdXREZWNpbWFsUGxhY2VzOiA5LFxyXG4gICAgICAgICAgbWF4QXJyb3dXaWR0aDogQVJST1dfTUFYX1dJRFRIXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdjaGFyZ2VOb2RlMScgKVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgY2hhcmdlTm9kZTIgPSBuZXcgQ2hhcmdlTm9kZShcclxuICAgICAgY291bG9tYnNMYXdNb2RlbCxcclxuICAgICAgY291bG9tYnNMYXdNb2RlbC5vYmplY3QyLFxyXG4gICAgICB0aGlzLmxheW91dEJvdW5kcyxcclxuICAgICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0sXHJcbiAgICAgIGFsZXJ0TWFuYWdlcixcclxuICAgICAgZm9yY2VEZXNjcmliZXIsXHJcbiAgICAgIHBvc2l0aW9uRGVzY3JpYmVyLFxyXG4gICAgICB7XHJcbiAgICAgICAgbGFiZWw6IGNoYXJnZTJBYmJyZXZpYXRlZFN0cmluZyxcclxuICAgICAgICBvdGhlck9iamVjdExhYmVsOiBjaGFyZ2UxQWJicmV2aWF0ZWRTdHJpbmcsXHJcbiAgICAgICAgZGVmYXVsdERpcmVjdGlvbjogRGVmYXVsdERpcmVjdGlvbi5SSUdIVCxcclxuICAgICAgICBhcnJvd0NvbG9yOiAnI2Y2NicsXHJcbiAgICAgICAgZm9yY2VBcnJvd0hlaWdodDogMTIwLFxyXG4gICAgICAgIHB1bGxlck5vZGVPcHRpb25zOiB7XHJcbiAgICAgICAgICBhdG9taWNTY2FsZTogdHJ1ZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXJyb3dOb2RlT3B0aW9uczoge1xyXG4gICAgICAgICAgZm9yY2VSZWFkb3V0RGVjaW1hbFBsYWNlczogOSxcclxuICAgICAgICAgIG1heEFycm93V2lkdGg6IEFSUk9XX01BWF9XSURUSFxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NoYXJnZU5vZGUyJyApXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBjaGFyZ2Ugbm9kZXMgYW5kIGFycm93cyBhcmUgYWRkZWQgdG8gdGhlIGJvdHRvbSBvZiB0aGUgc2NlbmUgZ3JhcGggc28gdGhhdCB0aGUgcnVsZXIgd2lsbCBhcHBlYXIgYWJvdmUgdGhlbSB5ZXRcclxuICAgIC8vIHN0aWxsIGJlbG93IHRoZSBjb250cm9sIHBhbmVscyAod2hpY2ggYXJlIGFkZGVkIGluIHRoZSBDb21tb25WaWV3KVxyXG4gICAgdGhpcy5pbnNlcnRDaGlsZCggMCwgY2hhcmdlTm9kZTEgKTtcclxuICAgIHRoaXMuaW5zZXJ0Q2hpbGQoIDAsIGNoYXJnZU5vZGUyICk7XHJcblxyXG4gICAgLy8gdGhlIGFycm93cyBhbmQgdGhlaXIgbGFiZWxzIHNob3VsZCBiZSBhYm92ZSBib3RoIGNoYXJnZXMgKGFuZCB0aGVpciBtYXJrZXJzKSBidXQgYmVsb3dcclxuICAgIC8vIHRoZSBydWxlciBhbmQgY29udHJvbCBwYW5lbHNcclxuICAgIHRoaXMuaW5zZXJ0Q2hpbGQoIDEsIGNoYXJnZU5vZGUxLmFycm93Tm9kZSApO1xyXG4gICAgdGhpcy5pbnNlcnRDaGlsZCggMSwgY2hhcmdlTm9kZTIuYXJyb3dOb2RlICk7XHJcblxyXG4gICAgLy8gY3JlYXRlIGEgbGluZSB0aGUgbGVuZ3RoIG9mIDEgcGljb21ldGVyXHJcbiAgICBjb25zdCBsZWdlbmROb2RlTGluZUxlbmd0aCA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFYKCAxMEUtMTIgKTtcclxuXHJcbiAgICBjb25zdCBsZWdlbmROb2RlID0gbmV3IElTTENMZWdlbmROb2RlKFxyXG4gICAgICBsZWdlbmROb2RlTGluZUxlbmd0aCwgLy8gbGVuZ3RoIG9mIHRoZSBsaW5lXHJcbiAgICAgIHVuaXRzQXRvbWljTGVnZW5kU2NhbGVTdHJpbmcsIC8vIHVuaXQgc3RyaW5nXHJcbiAgICAgIHtcclxuICAgICAgICBmaWxsOiBDb3Vsb21ic0xhd0NvbG9ycy5sZWdlbmROb2RlRmlsbFByb3BlcnR5LFxyXG4gICAgICAgIGJvdHRvbTogdGhpcy5sYXlvdXRCb3VuZHMubWF4WSAtIDEwLFxyXG4gICAgICAgIGxlZnQ6IHRoaXMubGF5b3V0Qm91bmRzLm1pblggKyA5LjM1LFxyXG4gICAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2F0b21pY0xlZ2VuZE5vZGUnIClcclxuICAgICAgfSApO1xyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIGxlZ2VuZE5vZGUgKTtcclxuXHJcbiAgICAvLyBhZGQgcGljb21ldGVyIGNvbnZlcnNpb24gc3RyaW5nXHJcbiAgICBjb25zdCBwaWNvbWV0ZXJTY2FsZVRleHQgPSBuZXcgUmljaFRleHQoIHBtU2NhbGVTdHJpbmcsIHtcclxuICAgICAgZmlsbDogQ291bG9tYnNMYXdDb2xvcnMubGVnZW5kTm9kZUZpbGxQcm9wZXJ0eSxcclxuICAgICAgZm9udDogbmV3IFBoZXRGb250KCAxMiApLFxyXG4gICAgICBtYXhXaWR0aDogMTgwLFxyXG4gICAgICBjZW50ZXJZOiBsZWdlbmROb2RlLmxvY2FsVG9QYXJlbnRQb2ludCggbGVnZW5kTm9kZS5sZWdlbmRBcnJvd0xpbmUuY2VudGVyICkueSxcclxuICAgICAgbGVmdDogbGVnZW5kTm9kZS5yaWdodCArIDEwLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdwaWNvbWV0ZXJTY2FsZVRleHQnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBwaWNvbWV0ZXJTY2FsZVRleHQgKTtcclxuXHJcbiAgICAvLyBwZG9tIC0gY2hhcmdlcyBhcmUgZmlyc3QgaW4gZm9jdXMgb3JkZXJcclxuICAgIGNvbnN0IGNoYXJnZXMgPSBbIGNoYXJnZU5vZGUxLCBjaGFyZ2VOb2RlMiBdO1xyXG5cclxuICAgIC8vIHBkb20gLSB0cmF2ZXJzYWwgb3JkZXIgZm9yIHRoZSBzY3JlZW52aWV3IChQYXJhbGxlbERPTS5qcyBzZXR0ZXIpXHJcbiAgICB0aGlzLnBkb21QbGF5QXJlYU5vZGUucGRvbU9yZGVyID0gY2hhcmdlcy5jb25jYXQoIHRoaXMucGRvbVBsYXlBcmVhTm9kZS5wZG9tT3JkZXIgKTtcclxuICB9XHJcbn1cclxuXHJcbmNvdWxvbWJzTGF3LnJlZ2lzdGVyKCAnQ291bG9tYnNMYXdBdG9taWNWaWV3JywgQ291bG9tYnNMYXdBdG9taWNWaWV3ICk7XHJcbmV4cG9ydCBkZWZhdWx0IENvdWxvbWJzTGF3QXRvbWljVmlldzsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLDZCQUE2QixNQUFNLDJFQUEyRTtBQUNySCxPQUFPQyxhQUFhLE1BQU0sMkRBQTJEO0FBQ3JGLE9BQU9DLGdCQUFnQixNQUFNLG1FQUFtRTtBQUNoRyxPQUFPQyxnQkFBZ0IsTUFBTSxtRUFBbUU7QUFDaEcsT0FBT0MsY0FBYyxNQUFNLGlFQUFpRTtBQUM1RixPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLFFBQVEsUUFBUSxtQ0FBbUM7QUFDNUQsT0FBT0MsaUJBQWlCLE1BQU0sbUNBQW1DO0FBQ2pFLE9BQU9DLFVBQVUsTUFBTSxpQ0FBaUM7QUFDeEQsT0FBT0MscUJBQXFCLE1BQU0sNENBQTRDO0FBQzlFLE9BQU9DLHlCQUF5QixNQUFNLDJEQUEyRDtBQUNqRyxPQUFPQyw0QkFBNEIsTUFBTSw4REFBOEQ7QUFDdkcsT0FBT0MsV0FBVyxNQUFNLHNCQUFzQjtBQUM5QyxPQUFPQyxrQkFBa0IsTUFBTSw2QkFBNkI7QUFFNUQsTUFBTUMsd0JBQXdCLEdBQUdELGtCQUFrQixDQUFDRSxrQkFBa0I7QUFDdEUsTUFBTUMsd0JBQXdCLEdBQUdILGtCQUFrQixDQUFDSSxrQkFBa0I7QUFDdEUsTUFBTUMsYUFBYSxHQUFHTCxrQkFBa0IsQ0FBQ00sT0FBTztBQUNoRCxNQUFNQyw0QkFBNEIsR0FBR1Asa0JBQWtCLENBQUNRLEtBQUssQ0FBQ0MsaUJBQWlCO0FBQy9FLE1BQU1DLHNCQUFzQixHQUFHVixrQkFBa0IsQ0FBQ1EsS0FBSyxDQUFDRyxXQUFXO0FBQ25FLE1BQU1DLHFCQUFxQixH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