// Copyright 2013-2023, University of Colorado Boulder

/**
 * Shows the graphic for the puller, which can be dragged from the toolbox to the rope to apply force.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import { Image, SimpleDragHandler } from '../../../../scenery/js/imports.js';
import forcesAndMotionBasics from '../../forcesAndMotionBasics.js';
class PullerNode extends Image {
  /**
   * Create a PullerNode for the specified puller
   *
   * @param {Puller} puller
   * @param {NetForceModel} model
   * @param {Image} image image of the puller standing upright
   * @param {Image} pullImage image of the puller exerting a force
   * @param {PullerToolboxNode} pullerToolboxNode
   * @param {Tandem} tandem
   * @param {Object} [options]
   */
  constructor(puller, model, image, pullImage, pullerToolboxNode, tandem, options) {
    const x = puller.positionProperty.get().x;
    const y = puller.positionProperty.get().y;
    super(image, {
      tandem: tandem,
      x: x,
      y: y,
      cursor: 'pointer',
      scale: 0.86
    });
    this.puller = puller;
    this.puller.node = this; //Wire up so node can be looked up by model element.
    this.standImage = image; // @private
    this.pullImage = pullImage; // @private

    model.startedProperty.link(() => {
      this.updateImage(puller, model);
      this.updatePosition(puller, model);
    });
    puller.positionProperty.link(() => {
      this.updateImage(puller, model);
      this.updatePosition(puller, model);
    });
    model.startedProperty.link(() => {
      this.updateImage(puller, model);
      this.updatePosition(puller, model);
    });
    model.runningProperty.link(() => {
      this.updateImage(puller, model);
      this.updatePosition(puller, model);
    });
    model.stateProperty.link(() => {
      this.updateImage(puller, model);
      this.updatePosition(puller, model);
    });
    const dragHandler = new SimpleDragHandler({
      tandem: tandem.createTandem('dragListener'),
      allowTouchSnag: true,
      start: event => {
        // check to see if a puller is knotted - if it is, store the knot
        const knot = puller.knotProperty.get();

        // disconnect the puller from the knot and update the image
        puller.disconnect();
        this.updateImage(puller, model);

        // fire updates
        puller.draggingProperty.set(true);
        this.moveToFront();
        puller.draggedEmitter.emit();

        // if the puller was knotted, update the image position so that it is centered on the knot it was previously
        // grabbing
        if (knot) {
          this.updatePositionKnotted(puller, model, knot);
        }
      },
      end: () => {
        this.updatePosition(puller, model);
        puller.draggingProperty.set(false);
        puller.droppedEmitter.emit();
        this.updateImage(puller, model);
      },
      translate: event => {
        this.updateImage(puller, model);
        this.puller.positionProperty.set(event.position);
      }
    });
    this.addInputListener(dragHandler);
    model.resetAllEmitter.addListener(() => {
      this.updatePosition(puller, model);

      // cancel the drag
      if (puller.draggingProperty.get()) {
        dragHandler.interrupt();
        puller.reset();
      }
    });
    this.mutate(options);
  }

  /**
   * Update the position of the puller immediately after it has been clicked on after being removed from a knot
   * position.  Sets the translation of the puller relative to its previous knot position.  This knot position is
   * lost in updatePosition because the puller has already been disconnected from the knot by the time those functions
   * are called.
   * @public
   *
   * @param {Puller} puller
   * @param {NetForceModel} model
   * @param {Knot} knot - the last knot that the puller was holding on to
   */
  updatePositionKnotted(puller, model, knot) {
    const blueOffset = this.puller.type === 'blue' ? -60 : 0;
    puller.positionProperty.set(new Vector2(knot.xProperty.get() + blueOffset, knot.y - this.height + 90));
  }

  /**
   * Update the image puller image depending on whether the puller is knotted and pulling
   * @public
   *
   * @param {Puller} puller
   * @param {NetForceModel} model
   */
  updateImage(puller, model) {
    const knotted = puller.knotProperty.get();
    const pulling = model.startedProperty.get() && knotted && model.stateProperty.get() !== 'completed';
    this.image = pulling ? this.pullImage : this.standImage;
  }

  /**
   * Update the position of a puller depending on whether it is knotted and pulling.
   * @public
   *
   * @param {Puller} puller
   * @param {NetForceModel} model
   */
  updatePosition(puller, model) {
    const knotted = puller.knotProperty.get();
    const pulling = model.startedProperty.get() && knotted && model.stateProperty.get() !== 'completed';
    if (knotted) {
      const pullingOffset = pulling ? -puller.dragOffsetX : puller.standOffsetX;
      const blueOffset = this.puller.type === 'blue' ? -60 + 10 : 0;
      this.setTranslation(puller.knotProperty.get().xProperty.get() + pullingOffset + blueOffset, puller.knotProperty.get().y - this.height + 90);
    } else {
      this.setTranslation(puller.positionProperty.get());
    }
  }
}
forcesAndMotionBasics.register('PullerNode', PullerNode);
export default PullerNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiSW1hZ2UiLCJTaW1wbGVEcmFnSGFuZGxlciIsImZvcmNlc0FuZE1vdGlvbkJhc2ljcyIsIlB1bGxlck5vZGUiLCJjb25zdHJ1Y3RvciIsInB1bGxlciIsIm1vZGVsIiwiaW1hZ2UiLCJwdWxsSW1hZ2UiLCJwdWxsZXJUb29sYm94Tm9kZSIsInRhbmRlbSIsIm9wdGlvbnMiLCJ4IiwicG9zaXRpb25Qcm9wZXJ0eSIsImdldCIsInkiLCJjdXJzb3IiLCJzY2FsZSIsIm5vZGUiLCJzdGFuZEltYWdlIiwic3RhcnRlZFByb3BlcnR5IiwibGluayIsInVwZGF0ZUltYWdlIiwidXBkYXRlUG9zaXRpb24iLCJydW5uaW5nUHJvcGVydHkiLCJzdGF0ZVByb3BlcnR5IiwiZHJhZ0hhbmRsZXIiLCJjcmVhdGVUYW5kZW0iLCJhbGxvd1RvdWNoU25hZyIsInN0YXJ0IiwiZXZlbnQiLCJrbm90Iiwia25vdFByb3BlcnR5IiwiZGlzY29ubmVjdCIsImRyYWdnaW5nUHJvcGVydHkiLCJzZXQiLCJtb3ZlVG9Gcm9udCIsImRyYWdnZWRFbWl0dGVyIiwiZW1pdCIsInVwZGF0ZVBvc2l0aW9uS25vdHRlZCIsImVuZCIsImRyb3BwZWRFbWl0dGVyIiwidHJhbnNsYXRlIiwicG9zaXRpb24iLCJhZGRJbnB1dExpc3RlbmVyIiwicmVzZXRBbGxFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJpbnRlcnJ1cHQiLCJyZXNldCIsIm11dGF0ZSIsImJsdWVPZmZzZXQiLCJ0eXBlIiwieFByb3BlcnR5IiwiaGVpZ2h0Iiwia25vdHRlZCIsInB1bGxpbmciLCJwdWxsaW5nT2Zmc2V0IiwiZHJhZ09mZnNldFgiLCJzdGFuZE9mZnNldFgiLCJzZXRUcmFuc2xhdGlvbiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUHVsbGVyTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxMy0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTaG93cyB0aGUgZ3JhcGhpYyBmb3IgdGhlIHB1bGxlciwgd2hpY2ggY2FuIGJlIGRyYWdnZWQgZnJvbSB0aGUgdG9vbGJveCB0byB0aGUgcm9wZSB0byBhcHBseSBmb3JjZS5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCB7IEltYWdlLCBTaW1wbGVEcmFnSGFuZGxlciB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBmb3JjZXNBbmRNb3Rpb25CYXNpY3MgZnJvbSAnLi4vLi4vZm9yY2VzQW5kTW90aW9uQmFzaWNzLmpzJztcclxuXHJcbmNsYXNzIFB1bGxlck5vZGUgZXh0ZW5kcyBJbWFnZSB7XHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGEgUHVsbGVyTm9kZSBmb3IgdGhlIHNwZWNpZmllZCBwdWxsZXJcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7UHVsbGVyfSBwdWxsZXJcclxuICAgKiBAcGFyYW0ge05ldEZvcmNlTW9kZWx9IG1vZGVsXHJcbiAgICogQHBhcmFtIHtJbWFnZX0gaW1hZ2UgaW1hZ2Ugb2YgdGhlIHB1bGxlciBzdGFuZGluZyB1cHJpZ2h0XHJcbiAgICogQHBhcmFtIHtJbWFnZX0gcHVsbEltYWdlIGltYWdlIG9mIHRoZSBwdWxsZXIgZXhlcnRpbmcgYSBmb3JjZVxyXG4gICAqIEBwYXJhbSB7UHVsbGVyVG9vbGJveE5vZGV9IHB1bGxlclRvb2xib3hOb2RlXHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggcHVsbGVyLCBtb2RlbCwgaW1hZ2UsIHB1bGxJbWFnZSwgcHVsbGVyVG9vbGJveE5vZGUsIHRhbmRlbSwgb3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCB4ID0gcHVsbGVyLnBvc2l0aW9uUHJvcGVydHkuZ2V0KCkueDtcclxuICAgIGNvbnN0IHkgPSBwdWxsZXIucG9zaXRpb25Qcm9wZXJ0eS5nZXQoKS55O1xyXG5cclxuICAgIHN1cGVyKCBpbWFnZSwge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbSxcclxuICAgICAgeDogeCxcclxuICAgICAgeTogeSxcclxuICAgICAgY3Vyc29yOiAncG9pbnRlcicsXHJcbiAgICAgIHNjYWxlOiAwLjg2XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5wdWxsZXIgPSBwdWxsZXI7XHJcbiAgICB0aGlzLnB1bGxlci5ub2RlID0gdGhpczsgLy9XaXJlIHVwIHNvIG5vZGUgY2FuIGJlIGxvb2tlZCB1cCBieSBtb2RlbCBlbGVtZW50LlxyXG4gICAgdGhpcy5zdGFuZEltYWdlID0gaW1hZ2U7IC8vIEBwcml2YXRlXHJcbiAgICB0aGlzLnB1bGxJbWFnZSA9IHB1bGxJbWFnZTsgLy8gQHByaXZhdGVcclxuXHJcbiAgICBtb2RlbC5zdGFydGVkUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICB0aGlzLnVwZGF0ZUltYWdlKCBwdWxsZXIsIG1vZGVsICk7XHJcbiAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24oIHB1bGxlciwgbW9kZWwgKTtcclxuICAgIH0gKTtcclxuICAgIHB1bGxlci5wb3NpdGlvblByb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgICAgdGhpcy51cGRhdGVJbWFnZSggcHVsbGVyLCBtb2RlbCApO1xyXG4gICAgICB0aGlzLnVwZGF0ZVBvc2l0aW9uKCBwdWxsZXIsIG1vZGVsICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgbW9kZWwuc3RhcnRlZFByb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgICAgdGhpcy51cGRhdGVJbWFnZSggcHVsbGVyLCBtb2RlbCApO1xyXG4gICAgICB0aGlzLnVwZGF0ZVBvc2l0aW9uKCBwdWxsZXIsIG1vZGVsICk7XHJcbiAgICB9ICk7XHJcbiAgICBtb2RlbC5ydW5uaW5nUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICB0aGlzLnVwZGF0ZUltYWdlKCBwdWxsZXIsIG1vZGVsICk7XHJcbiAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24oIHB1bGxlciwgbW9kZWwgKTtcclxuICAgIH0gKTtcclxuICAgIG1vZGVsLnN0YXRlUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICB0aGlzLnVwZGF0ZUltYWdlKCBwdWxsZXIsIG1vZGVsICk7XHJcbiAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24oIHB1bGxlciwgbW9kZWwgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBkcmFnSGFuZGxlciA9IG5ldyBTaW1wbGVEcmFnSGFuZGxlcigge1xyXG4gICAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RyYWdMaXN0ZW5lcicgKSxcclxuICAgICAgICBhbGxvd1RvdWNoU25hZzogdHJ1ZSxcclxuICAgICAgICBzdGFydDogZXZlbnQgPT4ge1xyXG5cclxuICAgICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiBhIHB1bGxlciBpcyBrbm90dGVkIC0gaWYgaXQgaXMsIHN0b3JlIHRoZSBrbm90XHJcbiAgICAgICAgICBjb25zdCBrbm90ID0gcHVsbGVyLmtub3RQcm9wZXJ0eS5nZXQoKTtcclxuXHJcbiAgICAgICAgICAvLyBkaXNjb25uZWN0IHRoZSBwdWxsZXIgZnJvbSB0aGUga25vdCBhbmQgdXBkYXRlIHRoZSBpbWFnZVxyXG4gICAgICAgICAgcHVsbGVyLmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICAgIHRoaXMudXBkYXRlSW1hZ2UoIHB1bGxlciwgbW9kZWwgKTtcclxuXHJcbiAgICAgICAgICAvLyBmaXJlIHVwZGF0ZXNcclxuICAgICAgICAgIHB1bGxlci5kcmFnZ2luZ1Byb3BlcnR5LnNldCggdHJ1ZSApO1xyXG4gICAgICAgICAgdGhpcy5tb3ZlVG9Gcm9udCgpO1xyXG4gICAgICAgICAgcHVsbGVyLmRyYWdnZWRFbWl0dGVyLmVtaXQoKTtcclxuXHJcbiAgICAgICAgICAvLyBpZiB0aGUgcHVsbGVyIHdhcyBrbm90dGVkLCB1cGRhdGUgdGhlIGltYWdlIHBvc2l0aW9uIHNvIHRoYXQgaXQgaXMgY2VudGVyZWQgb24gdGhlIGtub3QgaXQgd2FzIHByZXZpb3VzbHlcclxuICAgICAgICAgIC8vIGdyYWJiaW5nXHJcbiAgICAgICAgICBpZiAoIGtub3QgKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUG9zaXRpb25Lbm90dGVkKCBwdWxsZXIsIG1vZGVsLCBrbm90ICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbmQ6ICgpID0+IHtcclxuICAgICAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24oIHB1bGxlciwgbW9kZWwgKTtcclxuICAgICAgICAgIHB1bGxlci5kcmFnZ2luZ1Byb3BlcnR5LnNldCggZmFsc2UgKTtcclxuICAgICAgICAgIHB1bGxlci5kcm9wcGVkRW1pdHRlci5lbWl0KCk7XHJcbiAgICAgICAgICB0aGlzLnVwZGF0ZUltYWdlKCBwdWxsZXIsIG1vZGVsICk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB0cmFuc2xhdGU6IGV2ZW50ID0+IHtcclxuICAgICAgICAgIHRoaXMudXBkYXRlSW1hZ2UoIHB1bGxlciwgbW9kZWwgKTtcclxuICAgICAgICAgIHRoaXMucHVsbGVyLnBvc2l0aW9uUHJvcGVydHkuc2V0KCBldmVudC5wb3NpdGlvbiApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgKTtcclxuICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggZHJhZ0hhbmRsZXIgKTtcclxuXHJcbiAgICBtb2RlbC5yZXNldEFsbEVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbiggcHVsbGVyLCBtb2RlbCApO1xyXG5cclxuICAgICAgLy8gY2FuY2VsIHRoZSBkcmFnXHJcbiAgICAgIGlmICggcHVsbGVyLmRyYWdnaW5nUHJvcGVydHkuZ2V0KCkgKSB7XHJcbiAgICAgICAgZHJhZ0hhbmRsZXIuaW50ZXJydXB0KCk7XHJcblxyXG4gICAgICAgIHB1bGxlci5yZXNldCgpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBwdWxsZXIgaW1tZWRpYXRlbHkgYWZ0ZXIgaXQgaGFzIGJlZW4gY2xpY2tlZCBvbiBhZnRlciBiZWluZyByZW1vdmVkIGZyb20gYSBrbm90XHJcbiAgICogcG9zaXRpb24uICBTZXRzIHRoZSB0cmFuc2xhdGlvbiBvZiB0aGUgcHVsbGVyIHJlbGF0aXZlIHRvIGl0cyBwcmV2aW91cyBrbm90IHBvc2l0aW9uLiAgVGhpcyBrbm90IHBvc2l0aW9uIGlzXHJcbiAgICogbG9zdCBpbiB1cGRhdGVQb3NpdGlvbiBiZWNhdXNlIHRoZSBwdWxsZXIgaGFzIGFscmVhZHkgYmVlbiBkaXNjb25uZWN0ZWQgZnJvbSB0aGUga25vdCBieSB0aGUgdGltZSB0aG9zZSBmdW5jdGlvbnNcclxuICAgKiBhcmUgY2FsbGVkLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7UHVsbGVyfSBwdWxsZXJcclxuICAgKiBAcGFyYW0ge05ldEZvcmNlTW9kZWx9IG1vZGVsXHJcbiAgICogQHBhcmFtIHtLbm90fSBrbm90IC0gdGhlIGxhc3Qga25vdCB0aGF0IHRoZSBwdWxsZXIgd2FzIGhvbGRpbmcgb24gdG9cclxuICAgKi9cclxuICB1cGRhdGVQb3NpdGlvbktub3R0ZWQoIHB1bGxlciwgbW9kZWwsIGtub3QgKSB7XHJcbiAgICBjb25zdCBibHVlT2Zmc2V0ID0gdGhpcy5wdWxsZXIudHlwZSA9PT0gJ2JsdWUnID8gLTYwIDogMDtcclxuICAgIHB1bGxlci5wb3NpdGlvblByb3BlcnR5LnNldCggbmV3IFZlY3RvcjIoIGtub3QueFByb3BlcnR5LmdldCgpICsgYmx1ZU9mZnNldCwga25vdC55IC0gdGhpcy5oZWlnaHQgKyA5MCApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgdGhlIGltYWdlIHB1bGxlciBpbWFnZSBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgcHVsbGVyIGlzIGtub3R0ZWQgYW5kIHB1bGxpbmdcclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge1B1bGxlcn0gcHVsbGVyXHJcbiAgICogQHBhcmFtIHtOZXRGb3JjZU1vZGVsfSBtb2RlbFxyXG4gICAqL1xyXG4gIHVwZGF0ZUltYWdlKCBwdWxsZXIsIG1vZGVsICkge1xyXG4gICAgY29uc3Qga25vdHRlZCA9IHB1bGxlci5rbm90UHJvcGVydHkuZ2V0KCk7XHJcbiAgICBjb25zdCBwdWxsaW5nID0gbW9kZWwuc3RhcnRlZFByb3BlcnR5LmdldCgpICYmIGtub3R0ZWQgJiYgbW9kZWwuc3RhdGVQcm9wZXJ0eS5nZXQoKSAhPT0gJ2NvbXBsZXRlZCc7XHJcbiAgICB0aGlzLmltYWdlID0gcHVsbGluZyA/IHRoaXMucHVsbEltYWdlIDogdGhpcy5zdGFuZEltYWdlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIHRoZSBwb3NpdGlvbiBvZiBhIHB1bGxlciBkZXBlbmRpbmcgb24gd2hldGhlciBpdCBpcyBrbm90dGVkIGFuZCBwdWxsaW5nLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7UHVsbGVyfSBwdWxsZXJcclxuICAgKiBAcGFyYW0ge05ldEZvcmNlTW9kZWx9IG1vZGVsXHJcbiAgICovXHJcbiAgdXBkYXRlUG9zaXRpb24oIHB1bGxlciwgbW9kZWwgKSB7XHJcbiAgICBjb25zdCBrbm90dGVkID0gcHVsbGVyLmtub3RQcm9wZXJ0eS5nZXQoKTtcclxuICAgIGNvbnN0IHB1bGxpbmcgPSBtb2RlbC5zdGFydGVkUHJvcGVydHkuZ2V0KCkgJiYga25vdHRlZCAmJiBtb2RlbC5zdGF0ZVByb3BlcnR5LmdldCgpICE9PSAnY29tcGxldGVkJztcclxuICAgIGlmICgga25vdHRlZCApIHtcclxuICAgICAgY29uc3QgcHVsbGluZ09mZnNldCA9IHB1bGxpbmcgPyAtcHVsbGVyLmRyYWdPZmZzZXRYIDogcHVsbGVyLnN0YW5kT2Zmc2V0WDtcclxuICAgICAgY29uc3QgYmx1ZU9mZnNldCA9IHRoaXMucHVsbGVyLnR5cGUgPT09ICdibHVlJyA/IC02MCArIDEwIDogMDtcclxuICAgICAgdGhpcy5zZXRUcmFuc2xhdGlvbiggcHVsbGVyLmtub3RQcm9wZXJ0eS5nZXQoKS54UHJvcGVydHkuZ2V0KCkgKyBwdWxsaW5nT2Zmc2V0ICsgYmx1ZU9mZnNldCwgcHVsbGVyLmtub3RQcm9wZXJ0eS5nZXQoKS55IC0gdGhpcy5oZWlnaHQgKyA5MCApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMuc2V0VHJhbnNsYXRpb24oIHB1bGxlci5wb3NpdGlvblByb3BlcnR5LmdldCgpICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mb3JjZXNBbmRNb3Rpb25CYXNpY3MucmVnaXN0ZXIoICdQdWxsZXJOb2RlJywgUHVsbGVyTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBQdWxsZXJOb2RlO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxTQUFTQyxLQUFLLEVBQUVDLGlCQUFpQixRQUFRLG1DQUFtQztBQUM1RSxPQUFPQyxxQkFBcUIsTUFBTSxnQ0FBZ0M7QUFFbEUsTUFBTUMsVUFBVSxTQUFTSCxLQUFLLENBQUM7RUFDN0I7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFSSxXQUFXQSxDQUFFQyxNQUFNLEVBQUVDLEtBQUssRUFBRUMsS0FBSyxFQUFFQyxTQUFTLEVB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