// Copyright 2013-2022, University of Colorado Boulder

/**
 * This class shows all of the moving background, including the mountains, clouds and brick tile on the ground.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import dotRandom from '../../../../dot/js/dotRandom.js';
// modules
import Utils from '../../../../dot/js/Utils.js';
import { Image, Node, Pattern, Rectangle } from '../../../../scenery/js/imports.js';
import brickTile_png from '../../../images/brickTile_png.js';
import cloud1_png from '../../../images/cloud1_png.js';
import icicle_png from '../../../images/icicle_png.js';
import mountains_png from '../../../images/mountains_png.js';
import forcesAndMotionBasics from '../../forcesAndMotionBasics.js';
import MotionConstants from '../MotionConstants.js';

// constants
const linear = Utils.linear;
class MovingBackgroundNode extends Node {
  /**
   * Constructor for MovingBackgroundNode
   *
   * @param {MotionModel} model the model for the entire 'motion', 'friction' or 'acceleration' screen
   * @param {number} layoutCenterX the position where the node should be centered horizontally
   * @param {Tandem} tandem
   */
  constructor(model, layoutCenterX, tandem) {
    super({
      pickable: false,
      preventFit: true,
      tandem: tandem
    });
    this.model = model;
    const L = 900;

    //Add a background node at the specified X offset (pixels).  The distanceScale signifies how quickly it will scroll (mountains are far away so have a lower distanceScale)
    const toBackgroundImage = (offset, image, y, scale, tandemName) => {
      const node = new Image(image, {
        scale: scale,
        x: offset,
        y: y,
        tandem: tandem.createTandem(tandemName)
      });
      node.offsetX = offset;
      node.scaleFactor = scale;
      return node;
    };
    const stageWidth = L * 2;
    const mountainY = 311;

    //TODO: It would be good to use cssTransforms here but they are a bit buggy
    const mountainAndCloudLayer = new Node({
      tandem: tandem.createTandem('mountainAndCloudLayer'),
      x: layoutCenterX,
      children: [toBackgroundImage(L / 2, mountains_png, mountainY, 1, 'mountainImage1'), toBackgroundImage(L, mountains_png, mountainY, 1, 'mountainImage2'), toBackgroundImage(-L / 3, mountains_png, mountainY, 1, 'mountainImage3'), toBackgroundImage(0, cloud1_png, 10, 0.7, 'cloudImage1'), toBackgroundImage(L - 100, cloud1_png, -30, 0.8, 'cloudImage2'), toBackgroundImage(-L / 3 - 100, cloud1_png, 5, 1, 'cloudImage3')]
    });
    this.addChild(mountainAndCloudLayer);

    //Move the background objects
    //TODO: support background objects with scale !== 1

    const getLayerUpdater = (layer, motionScale) => {
      let netDelta = 0;
      const children = layer.children;
      return (position, oldPosition) => {
        const delta = -(position - oldPosition) * MotionConstants.POSITION_SCALE / motionScale;
        netDelta += delta;
        layer.translate(delta, 0);
        const sign = position > oldPosition ? 1 : -1;
        for (let i = 0; i < children.length; i++) {
          const child = children[i];

          //        console.log( child.offsetX + netDelta );
          //model moving right
          if (sign === 1) {
            //            console.log( child.offsetX + netDelta, -800 );

            //TODO: use modulus instead of while loop
            while (child.offsetX + netDelta < -L) {
              //              console.log( 'jump 1' );
              child.offsetX += stageWidth;
              child.translate(stageWidth / child.scaleFactor, 0);
            }
          }

          //model moving left
          else {
            //          console.log( child.offsetX + netDelta, L );

            //TODO: use modulus instead of while loop
            while (child.offsetX + netDelta > L) {
              //              console.log( 'jump 2' );
              child.offsetX -= stageWidth;
              child.translate(-stageWidth / child.scaleFactor, 0);
            }
          }
        }
      };
    };
    model.positionProperty.link(getLayerUpdater(mountainAndCloudLayer, 10));
    const tileWidth = brickTile_png.width;

    //Add the ground, offset the pattern so that the it aligns with the brick image
    const tilePattern = new Pattern(brickTile_png);
    const ground = new Rectangle(0, 0, brickTile_png.width * 14, brickTile_png.height, {
      fill: tilePattern
    });
    const mod = ground.width / 14;
    const centerX = layoutCenterX - ground.width / 2;

    //Rendering as a single image instead of a Pattern significantly improves performance on both iPad and Win8/Chrome
    const showGround = true;
    if (showGround) {
      ground.toImage(image => {
        const groundY = mountainY + 50;
        const groundImageNode = new Image(image, {
          y: groundY,
          tandem: tandem.createTandem('groundImageNode')
        });
        this.addChild(groundImageNode);
        model.positionProperty.link(position => {
          groundImageNode.setTranslation(-position * MotionConstants.POSITION_SCALE % mod + centerX, groundY);
        });

        //Add the gravel and ice.  Do this in the ground callback to keep the z-ordering correct
        if (!model.skateboard) {
          //Add the gravel
          const gravel = new Rectangle(0, 0, brickTile_png.width * 14, 4, {
            y: -2
          });

          //Adding the gravel directly to the moving ground makes the performance significantly faster on iPad3
          groundImageNode.addChild(gravel);

          //Add the ice
          const iceOverlay = new Rectangle(-400, groundY, brickTile_png.width * 15, brickTile_png.height, {
            fill: 'rgba(189,227,249,0.87)'
          });
          this.addChild(iceOverlay);
          model.frictionZeroProperty.linkAttribute(iceOverlay, 'visible');

          //make sure gravel gets exactly removed if friction is zero, in case it improves performance.
          model.frictionNonZeroProperty.linkAttribute(gravel, 'visible');
          const iceLayer = new Node({
            tandem: tandem.createTandem('iceLayer'),
            children: [toBackgroundImage(0, icicle_png, 0, 0.8, 'iceImageNode1'), toBackgroundImage(300, icicle_png, 0, 0.8, 'iceImageNode2')],
            x: layoutCenterX,
            y: groundY + ground.height
          });
          model.frictionZeroProperty.linkAttribute(iceLayer, 'visible');
          this.addChild(iceLayer);

          //TODO: could prevent updater from firing if ice is not visible
          model.positionProperty.link(getLayerUpdater(iceLayer, 1));
          this.lastNumSpecks = 0;
          const gravelSource = new Node({
            tandem: tandem.createTandem('gravelSource')
          });
          let numBlack = 0;
          let numGray = 0;
          let numWhite = 0;

          //Create the gravel for nonzero friction.
          model.frictionProperty.link((newFriction, oldFriction) => {
            //Discretize the friction so that the new nodes/images are not created at every step
            newFriction = newFriction * 100;
            newFriction = Utils.roundSymmetric(newFriction / 2) * 2;
            newFriction = newFriction / 100;
            const height = 3;
            let numSpecks = linear(MotionConstants.MAX_FRICTION * 0.1, MotionConstants.MAX_FRICTION, 0, 400, newFriction);
            numSpecks = numSpecks < 0 ? 0 : numSpecks;
            const desiredBlack = Utils.roundSymmetric(numSpecks / 2);
            const desiredGray = Utils.roundSymmetric(numSpecks / 2);
            const desiredWhite = Utils.roundSymmetric(numSpecks / 10);
            if (desiredBlack === numBlack && desiredGray === numGray && desiredWhite === numWhite) {
              return;
            }
            while (numBlack < desiredBlack) {
              gravelSource.addChild(new Rectangle(Math.floor(dotRandom.nextDouble() * (tileWidth + 1)), Math.floor(dotRandom.nextDouble() * (height + 1)), 1, 1, {
                fill: 'black'
              }));
              numBlack++;
            }
            while (numGray < desiredGray) {
              gravelSource.addChild(new Rectangle(Math.floor(dotRandom.nextDouble() * (tileWidth + 1)), Math.floor(dotRandom.nextDouble() * (height + 1)), 1, 1, {
                fill: 'gray'
              }));
              numGray++;
            }
            while (numWhite < desiredWhite) {
              gravelSource.addChild(new Rectangle(Math.floor(dotRandom.nextDouble() * (tileWidth + 1)), Math.floor(dotRandom.nextDouble() * (height + 1)), 1, 1, {
                fill: 'white'
              }));
              numWhite++;
            }
            let children;
            let i;
            while (numBlack > desiredBlack) {
              children = gravelSource.getChildren();
              for (i = children.length - 1; i >= 0; i--) {
                if (children[i].fill === 'black') {
                  gravelSource.removeChildAt(i);
                  break;
                }
              }
              numBlack--;
            }
            while (numGray > desiredGray) {
              children = gravelSource.getChildren();
              for (i = children.length - 1; i >= 0; i--) {
                if (children[i].fill === 'gray') {
                  gravelSource.removeChildAt(i);
                  break;
                }
              }
              numGray--;
            }
            while (numWhite > desiredWhite) {
              children = gravelSource.getChildren();
              for (i = children.length - 1; i >= 0; i--) {
                if (children[i].fill === 'white') {
                  gravelSource.removeChildAt(i);
                  break;
                }
              }
              numWhite--;
            }

            //TODO: get rid of pattern here, possibly by converting it too to an image?
            gravelSource.toImage(image => {
              gravel.fill = new Pattern(image);
            }, 0, 0, tileWidth, height);
          });
        }
      }, 0, 0, ground.width, ground.height);
    }
  }
}
forcesAndMotionBasics.register('MovingBackgroundNode', MovingBackgroundNode);
export default MovingBackgroundNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJVdGlscyIsIkltYWdlIiwiTm9kZSIsIlBhdHRlcm4iLCJSZWN0YW5nbGUiLCJicmlja1RpbGVfcG5nIiwiY2xvdWQxX3BuZyIsImljaWNsZV9wbmciLCJtb3VudGFpbnNfcG5nIiwiZm9yY2VzQW5kTW90aW9uQmFzaWNzIiwiTW90aW9uQ29uc3RhbnRzIiwibGluZWFyIiwiTW92aW5nQmFja2dyb3VuZE5vZGUiLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwibGF5b3V0Q2VudGVyWCIsInRhbmRlbSIsInBpY2thYmxlIiwicHJldmVudEZpdCIsIkwiLCJ0b0JhY2tncm91bmRJbWFnZSIsIm9mZnNldCIsImltYWdlIiwieSIsInNjYWxlIiwidGFuZGVtTmFtZSIsIm5vZGUiLCJ4IiwiY3JlYXRlVGFuZGVtIiwib2Zmc2V0WCIsInNjYWxlRmFjdG9yIiwic3RhZ2VXaWR0aCIsIm1vdW50YWluWSIsIm1vdW50YWluQW5kQ2xvdWRMYXllciIsImNoaWxkcmVuIiwiYWRkQ2hpbGQiLCJnZXRMYXllclVwZGF0ZXIiLCJsYXllciIsIm1vdGlvblNjYWxlIiwibmV0RGVsdGEiLCJwb3NpdGlvbiIsIm9sZFBvc2l0aW9uIiwiZGVsdGEiLCJQT1NJVElPTl9TQ0FMRSIsInRyYW5zbGF0ZSIsInNpZ24iLCJpIiwibGVuZ3RoIiwiY2hpbGQiLCJwb3NpdGlvblByb3BlcnR5IiwibGluayIsInRpbGVXaWR0aCIsIndpZHRoIiwidGlsZVBhdHRlcm4iLCJncm91bmQiLCJoZWlnaHQiLCJmaWxsIiwibW9kIiwiY2VudGVyWCIsInNob3dHcm91bmQiLCJ0b0ltYWdlIiwiZ3JvdW5kWSIsImdyb3VuZEltYWdlTm9kZSIsInNldFRyYW5zbGF0aW9uIiwic2thdGVib2FyZCIsImdyYXZlbCIsImljZU92ZXJsYXkiLCJmcmljdGlvblplcm9Qcm9wZXJ0eSIsImxpbmtBdHRyaWJ1dGUiLCJmcmljdGlvbk5vblplcm9Qcm9wZXJ0eSIsImljZUxheWVyIiwibGFzdE51bVNwZWNrcyIsImdyYXZlbFNvdXJjZSIsIm51bUJsYWNrIiwibnVtR3JheSIsIm51bVdoaXRlIiwiZnJpY3Rpb25Qcm9wZXJ0eSIsIm5ld0ZyaWN0aW9uIiwib2xkRnJpY3Rpb24iLCJyb3VuZFN5bW1ldHJpYyIsIm51bVNwZWNrcyIsIk1BWF9GUklDVElPTiIsImRlc2lyZWRCbGFjayIsImRlc2lyZWRHcmF5IiwiZGVzaXJlZFdoaXRlIiwiTWF0aCIsImZsb29yIiwibmV4dERvdWJsZSIsImdldENoaWxkcmVuIiwicmVtb3ZlQ2hpbGRBdCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTW92aW5nQmFja2dyb3VuZE5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhpcyBjbGFzcyBzaG93cyBhbGwgb2YgdGhlIG1vdmluZyBiYWNrZ3JvdW5kLCBpbmNsdWRpbmcgdGhlIG1vdW50YWlucywgY2xvdWRzIGFuZCBicmljayB0aWxlIG9uIHRoZSBncm91bmQuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuXHJcbmltcG9ydCBkb3RSYW5kb20gZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL2RvdFJhbmRvbS5qcyc7XHJcbi8vIG1vZHVsZXNcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCB7IEltYWdlLCBOb2RlLCBQYXR0ZXJuLCBSZWN0YW5nbGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgYnJpY2tUaWxlX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvYnJpY2tUaWxlX3BuZy5qcyc7XHJcbmltcG9ydCBjbG91ZDFfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9jbG91ZDFfcG5nLmpzJztcclxuaW1wb3J0IGljaWNsZV9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2ljaWNsZV9wbmcuanMnO1xyXG5pbXBvcnQgbW91bnRhaW5zX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvbW91bnRhaW5zX3BuZy5qcyc7XHJcbmltcG9ydCBmb3JjZXNBbmRNb3Rpb25CYXNpY3MgZnJvbSAnLi4vLi4vZm9yY2VzQW5kTW90aW9uQmFzaWNzLmpzJztcclxuaW1wb3J0IE1vdGlvbkNvbnN0YW50cyBmcm9tICcuLi9Nb3Rpb25Db25zdGFudHMuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IGxpbmVhciA9IFV0aWxzLmxpbmVhcjtcclxuXHJcbmNsYXNzIE1vdmluZ0JhY2tncm91bmROb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnN0cnVjdG9yIGZvciBNb3ZpbmdCYWNrZ3JvdW5kTm9kZVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtNb3Rpb25Nb2RlbH0gbW9kZWwgdGhlIG1vZGVsIGZvciB0aGUgZW50aXJlICdtb3Rpb24nLCAnZnJpY3Rpb24nIG9yICdhY2NlbGVyYXRpb24nIHNjcmVlblxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBsYXlvdXRDZW50ZXJYIHRoZSBwb3NpdGlvbiB3aGVyZSB0aGUgbm9kZSBzaG91bGQgYmUgY2VudGVyZWQgaG9yaXpvbnRhbGx5XHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBtb2RlbCwgbGF5b3V0Q2VudGVyWCwgdGFuZGVtICkge1xyXG5cclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZSxcclxuICAgICAgcHJldmVudEZpdDogdHJ1ZSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW1cclxuICAgIH0gKTtcclxuICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcclxuXHJcbiAgICBjb25zdCBMID0gOTAwO1xyXG5cclxuICAgIC8vQWRkIGEgYmFja2dyb3VuZCBub2RlIGF0IHRoZSBzcGVjaWZpZWQgWCBvZmZzZXQgKHBpeGVscykuICBUaGUgZGlzdGFuY2VTY2FsZSBzaWduaWZpZXMgaG93IHF1aWNrbHkgaXQgd2lsbCBzY3JvbGwgKG1vdW50YWlucyBhcmUgZmFyIGF3YXkgc28gaGF2ZSBhIGxvd2VyIGRpc3RhbmNlU2NhbGUpXHJcbiAgICBjb25zdCB0b0JhY2tncm91bmRJbWFnZSA9ICggb2Zmc2V0LCBpbWFnZSwgeSwgc2NhbGUsIHRhbmRlbU5hbWUgKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5vZGUgPSBuZXcgSW1hZ2UoIGltYWdlLCB7XHJcbiAgICAgICAgc2NhbGU6IHNjYWxlLFxyXG4gICAgICAgIHg6IG9mZnNldCxcclxuICAgICAgICB5OiB5LFxyXG4gICAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggdGFuZGVtTmFtZSApXHJcbiAgICAgIH0gKTtcclxuICAgICAgbm9kZS5vZmZzZXRYID0gb2Zmc2V0O1xyXG4gICAgICBub2RlLnNjYWxlRmFjdG9yID0gc2NhbGU7XHJcbiAgICAgIHJldHVybiBub2RlO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBzdGFnZVdpZHRoID0gTCAqIDI7XHJcblxyXG4gICAgY29uc3QgbW91bnRhaW5ZID0gMzExO1xyXG5cclxuICAgIC8vVE9ETzogSXQgd291bGQgYmUgZ29vZCB0byB1c2UgY3NzVHJhbnNmb3JtcyBoZXJlIGJ1dCB0aGV5IGFyZSBhIGJpdCBidWdneVxyXG4gICAgY29uc3QgbW91bnRhaW5BbmRDbG91ZExheWVyID0gbmV3IE5vZGUoIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnbW91bnRhaW5BbmRDbG91ZExheWVyJyApLFxyXG4gICAgICB4OiBsYXlvdXRDZW50ZXJYLFxyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIHRvQmFja2dyb3VuZEltYWdlKCBMIC8gMiwgbW91bnRhaW5zX3BuZywgbW91bnRhaW5ZLCAxLCAnbW91bnRhaW5JbWFnZTEnICksXHJcbiAgICAgICAgdG9CYWNrZ3JvdW5kSW1hZ2UoIEwsIG1vdW50YWluc19wbmcsIG1vdW50YWluWSwgMSwgJ21vdW50YWluSW1hZ2UyJyApLFxyXG4gICAgICAgIHRvQmFja2dyb3VuZEltYWdlKCAtTCAvIDMsIG1vdW50YWluc19wbmcsIG1vdW50YWluWSwgMSwgJ21vdW50YWluSW1hZ2UzJyApLFxyXG4gICAgICAgIHRvQmFja2dyb3VuZEltYWdlKCAwLCBjbG91ZDFfcG5nLCAxMCwgMC43LCAnY2xvdWRJbWFnZTEnICksXHJcbiAgICAgICAgdG9CYWNrZ3JvdW5kSW1hZ2UoIEwgLSAxMDAsIGNsb3VkMV9wbmcsIC0zMCwgMC44LCAnY2xvdWRJbWFnZTInICksXHJcbiAgICAgICAgdG9CYWNrZ3JvdW5kSW1hZ2UoIC1MIC8gMyAtIDEwMCwgY2xvdWQxX3BuZywgNSwgMSwgJ2Nsb3VkSW1hZ2UzJyApXHJcbiAgICAgIF1cclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIG1vdW50YWluQW5kQ2xvdWRMYXllciApO1xyXG5cclxuICAgIC8vTW92ZSB0aGUgYmFja2dyb3VuZCBvYmplY3RzXHJcbiAgICAvL1RPRE86IHN1cHBvcnQgYmFja2dyb3VuZCBvYmplY3RzIHdpdGggc2NhbGUgIT09IDFcclxuXHJcbiAgICBjb25zdCBnZXRMYXllclVwZGF0ZXIgPSAoIGxheWVyLCBtb3Rpb25TY2FsZSApID0+IHtcclxuICAgICAgbGV0IG5ldERlbHRhID0gMDtcclxuICAgICAgY29uc3QgY2hpbGRyZW4gPSBsYXllci5jaGlsZHJlbjtcclxuICAgICAgcmV0dXJuICggcG9zaXRpb24sIG9sZFBvc2l0aW9uICkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRlbHRhID0gLSggcG9zaXRpb24gLSBvbGRQb3NpdGlvbiApICogTW90aW9uQ29uc3RhbnRzLlBPU0lUSU9OX1NDQUxFIC8gbW90aW9uU2NhbGU7XHJcbiAgICAgICAgbmV0RGVsdGEgKz0gZGVsdGE7XHJcbiAgICAgICAgbGF5ZXIudHJhbnNsYXRlKCBkZWx0YSwgMCApO1xyXG5cclxuICAgICAgICBjb25zdCBzaWduID0gcG9zaXRpb24gPiBvbGRQb3NpdGlvbiA/IDEgOiAtMTtcclxuICAgICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5bIGkgXTtcclxuXHJcbiAgICAgICAgICAvLyAgICAgICAgY29uc29sZS5sb2coIGNoaWxkLm9mZnNldFggKyBuZXREZWx0YSApO1xyXG4gICAgICAgICAgLy9tb2RlbCBtb3ZpbmcgcmlnaHRcclxuICAgICAgICAgIGlmICggc2lnbiA9PT0gMSApIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICBjb25zb2xlLmxvZyggY2hpbGQub2Zmc2V0WCArIG5ldERlbHRhLCAtODAwICk7XHJcblxyXG4gICAgICAgICAgICAvL1RPRE86IHVzZSBtb2R1bHVzIGluc3RlYWQgb2Ygd2hpbGUgbG9vcFxyXG4gICAgICAgICAgICB3aGlsZSAoIGNoaWxkLm9mZnNldFggKyBuZXREZWx0YSA8IC1MICkge1xyXG4gICAgICAgICAgICAgIC8vICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ2p1bXAgMScgKTtcclxuICAgICAgICAgICAgICBjaGlsZC5vZmZzZXRYICs9IHN0YWdlV2lkdGg7XHJcbiAgICAgICAgICAgICAgY2hpbGQudHJhbnNsYXRlKCBzdGFnZVdpZHRoIC8gY2hpbGQuc2NhbGVGYWN0b3IsIDAgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vbW9kZWwgbW92aW5nIGxlZnRcclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICBjb25zb2xlLmxvZyggY2hpbGQub2Zmc2V0WCArIG5ldERlbHRhLCBMICk7XHJcblxyXG4gICAgICAgICAgICAvL1RPRE86IHVzZSBtb2R1bHVzIGluc3RlYWQgb2Ygd2hpbGUgbG9vcFxyXG4gICAgICAgICAgICB3aGlsZSAoIGNoaWxkLm9mZnNldFggKyBuZXREZWx0YSA+IEwgKSB7XHJcbiAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnanVtcCAyJyApO1xyXG4gICAgICAgICAgICAgIGNoaWxkLm9mZnNldFggLT0gc3RhZ2VXaWR0aDtcclxuICAgICAgICAgICAgICBjaGlsZC50cmFuc2xhdGUoIC1zdGFnZVdpZHRoIC8gY2hpbGQuc2NhbGVGYWN0b3IsIDAgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgbW9kZWwucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCBnZXRMYXllclVwZGF0ZXIoIG1vdW50YWluQW5kQ2xvdWRMYXllciwgMTAgKSApO1xyXG5cclxuICAgIGNvbnN0IHRpbGVXaWR0aCA9IGJyaWNrVGlsZV9wbmcud2lkdGg7XHJcblxyXG4gICAgLy9BZGQgdGhlIGdyb3VuZCwgb2Zmc2V0IHRoZSBwYXR0ZXJuIHNvIHRoYXQgdGhlIGl0IGFsaWducyB3aXRoIHRoZSBicmljayBpbWFnZVxyXG4gICAgY29uc3QgdGlsZVBhdHRlcm4gPSBuZXcgUGF0dGVybiggYnJpY2tUaWxlX3BuZyApO1xyXG4gICAgY29uc3QgZ3JvdW5kID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgYnJpY2tUaWxlX3BuZy53aWR0aCAqIDE0LCBicmlja1RpbGVfcG5nLmhlaWdodCwgeyBmaWxsOiB0aWxlUGF0dGVybiB9ICk7XHJcbiAgICBjb25zdCBtb2QgPSBncm91bmQud2lkdGggLyAxNDtcclxuICAgIGNvbnN0IGNlbnRlclggPSBsYXlvdXRDZW50ZXJYIC0gZ3JvdW5kLndpZHRoIC8gMjtcclxuXHJcbiAgICAvL1JlbmRlcmluZyBhcyBhIHNpbmdsZSBpbWFnZSBpbnN0ZWFkIG9mIGEgUGF0dGVybiBzaWduaWZpY2FudGx5IGltcHJvdmVzIHBlcmZvcm1hbmNlIG9uIGJvdGggaVBhZCBhbmQgV2luOC9DaHJvbWVcclxuICAgIGNvbnN0IHNob3dHcm91bmQgPSB0cnVlO1xyXG4gICAgaWYgKCBzaG93R3JvdW5kICkge1xyXG4gICAgICBncm91bmQudG9JbWFnZSggaW1hZ2UgPT4ge1xyXG4gICAgICAgIGNvbnN0IGdyb3VuZFkgPSBtb3VudGFpblkgKyA1MDtcclxuICAgICAgICBjb25zdCBncm91bmRJbWFnZU5vZGUgPSBuZXcgSW1hZ2UoIGltYWdlLCB7XHJcbiAgICAgICAgICB5OiBncm91bmRZLFxyXG4gICAgICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZ3JvdW5kSW1hZ2VOb2RlJyApXHJcbiAgICAgICAgfSApO1xyXG4gICAgICAgIHRoaXMuYWRkQ2hpbGQoIGdyb3VuZEltYWdlTm9kZSApO1xyXG4gICAgICAgIG1vZGVsLnBvc2l0aW9uUHJvcGVydHkubGluayggcG9zaXRpb24gPT4ge1xyXG4gICAgICAgICAgZ3JvdW5kSW1hZ2VOb2RlLnNldFRyYW5zbGF0aW9uKCAtcG9zaXRpb24gKiBNb3Rpb25Db25zdGFudHMuUE9TSVRJT05fU0NBTEUgJSBtb2QgKyBjZW50ZXJYLCBncm91bmRZICk7XHJcbiAgICAgICAgfSApO1xyXG5cclxuICAgICAgICAvL0FkZCB0aGUgZ3JhdmVsIGFuZCBpY2UuICBEbyB0aGlzIGluIHRoZSBncm91bmQgY2FsbGJhY2sgdG8ga2VlcCB0aGUgei1vcmRlcmluZyBjb3JyZWN0XHJcbiAgICAgICAgaWYgKCAhbW9kZWwuc2thdGVib2FyZCApIHtcclxuXHJcbiAgICAgICAgICAvL0FkZCB0aGUgZ3JhdmVsXHJcbiAgICAgICAgICBjb25zdCBncmF2ZWwgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBicmlja1RpbGVfcG5nLndpZHRoICogMTQsIDQsIHsgeTogLTIgfSApO1xyXG5cclxuICAgICAgICAgIC8vQWRkaW5nIHRoZSBncmF2ZWwgZGlyZWN0bHkgdG8gdGhlIG1vdmluZyBncm91bmQgbWFrZXMgdGhlIHBlcmZvcm1hbmNlIHNpZ25pZmljYW50bHkgZmFzdGVyIG9uIGlQYWQzXHJcbiAgICAgICAgICBncm91bmRJbWFnZU5vZGUuYWRkQ2hpbGQoIGdyYXZlbCApO1xyXG5cclxuICAgICAgICAgIC8vQWRkIHRoZSBpY2VcclxuICAgICAgICAgIGNvbnN0IGljZU92ZXJsYXkgPSBuZXcgUmVjdGFuZ2xlKCAtNDAwLCBncm91bmRZLCBicmlja1RpbGVfcG5nLndpZHRoICogMTUsIGJyaWNrVGlsZV9wbmcuaGVpZ2h0LCB7IGZpbGw6ICdyZ2JhKDE4OSwyMjcsMjQ5LDAuODcpJyB9ICk7XHJcbiAgICAgICAgICB0aGlzLmFkZENoaWxkKCBpY2VPdmVybGF5ICk7XHJcbiAgICAgICAgICBtb2RlbC5mcmljdGlvblplcm9Qcm9wZXJ0eS5saW5rQXR0cmlidXRlKCBpY2VPdmVybGF5LCAndmlzaWJsZScgKTtcclxuXHJcbiAgICAgICAgICAvL21ha2Ugc3VyZSBncmF2ZWwgZ2V0cyBleGFjdGx5IHJlbW92ZWQgaWYgZnJpY3Rpb24gaXMgemVybywgaW4gY2FzZSBpdCBpbXByb3ZlcyBwZXJmb3JtYW5jZS5cclxuICAgICAgICAgIG1vZGVsLmZyaWN0aW9uTm9uWmVyb1Byb3BlcnR5LmxpbmtBdHRyaWJ1dGUoIGdyYXZlbCwgJ3Zpc2libGUnICk7XHJcblxyXG4gICAgICAgICAgY29uc3QgaWNlTGF5ZXIgPSBuZXcgTm9kZSgge1xyXG4gICAgICAgICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdpY2VMYXllcicgKSxcclxuICAgICAgICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICAgICAgICB0b0JhY2tncm91bmRJbWFnZSggMCwgaWNpY2xlX3BuZywgMCwgMC44LCAnaWNlSW1hZ2VOb2RlMScgKSxcclxuICAgICAgICAgICAgICB0b0JhY2tncm91bmRJbWFnZSggMzAwLCBpY2ljbGVfcG5nLCAwLCAwLjgsICdpY2VJbWFnZU5vZGUyJyApXHJcbiAgICAgICAgICAgIF0sIHg6IGxheW91dENlbnRlclgsIHk6IGdyb3VuZFkgKyBncm91bmQuaGVpZ2h0XHJcbiAgICAgICAgICB9ICk7XHJcbiAgICAgICAgICBtb2RlbC5mcmljdGlvblplcm9Qcm9wZXJ0eS5saW5rQXR0cmlidXRlKCBpY2VMYXllciwgJ3Zpc2libGUnICk7XHJcbiAgICAgICAgICB0aGlzLmFkZENoaWxkKCBpY2VMYXllciApO1xyXG5cclxuICAgICAgICAgIC8vVE9ETzogY291bGQgcHJldmVudCB1cGRhdGVyIGZyb20gZmlyaW5nIGlmIGljZSBpcyBub3QgdmlzaWJsZVxyXG4gICAgICAgICAgbW9kZWwucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCBnZXRMYXllclVwZGF0ZXIoIGljZUxheWVyLCAxICkgKTtcclxuXHJcbiAgICAgICAgICB0aGlzLmxhc3ROdW1TcGVja3MgPSAwO1xyXG5cclxuICAgICAgICAgIGNvbnN0IGdyYXZlbFNvdXJjZSA9IG5ldyBOb2RlKCB7XHJcbiAgICAgICAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2dyYXZlbFNvdXJjZScgKVxyXG4gICAgICAgICAgfSApO1xyXG5cclxuICAgICAgICAgIGxldCBudW1CbGFjayA9IDA7XHJcbiAgICAgICAgICBsZXQgbnVtR3JheSA9IDA7XHJcbiAgICAgICAgICBsZXQgbnVtV2hpdGUgPSAwO1xyXG5cclxuICAgICAgICAgIC8vQ3JlYXRlIHRoZSBncmF2ZWwgZm9yIG5vbnplcm8gZnJpY3Rpb24uXHJcbiAgICAgICAgICBtb2RlbC5mcmljdGlvblByb3BlcnR5LmxpbmsoICggbmV3RnJpY3Rpb24sIG9sZEZyaWN0aW9uICkgPT4ge1xyXG5cclxuICAgICAgICAgICAgLy9EaXNjcmV0aXplIHRoZSBmcmljdGlvbiBzbyB0aGF0IHRoZSBuZXcgbm9kZXMvaW1hZ2VzIGFyZSBub3QgY3JlYXRlZCBhdCBldmVyeSBzdGVwXHJcbiAgICAgICAgICAgIG5ld0ZyaWN0aW9uID0gbmV3RnJpY3Rpb24gKiAxMDA7XHJcbiAgICAgICAgICAgIG5ld0ZyaWN0aW9uID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIG5ld0ZyaWN0aW9uIC8gMiApICogMjtcclxuICAgICAgICAgICAgbmV3RnJpY3Rpb24gPSBuZXdGcmljdGlvbiAvIDEwMDtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9IDM7XHJcbiAgICAgICAgICAgIGxldCBudW1TcGVja3MgPSBsaW5lYXIoIE1vdGlvbkNvbnN0YW50cy5NQVhfRlJJQ1RJT04gKiAwLjEsIE1vdGlvbkNvbnN0YW50cy5NQVhfRlJJQ1RJT04sIDAsIDQwMCwgbmV3RnJpY3Rpb24gKTtcclxuICAgICAgICAgICAgbnVtU3BlY2tzID0gbnVtU3BlY2tzIDwgMCA/IDAgOiBudW1TcGVja3M7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBkZXNpcmVkQmxhY2sgPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggbnVtU3BlY2tzIC8gMiApO1xyXG4gICAgICAgICAgICBjb25zdCBkZXNpcmVkR3JheSA9IFV0aWxzLnJvdW5kU3ltbWV0cmljKCBudW1TcGVja3MgLyAyICk7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlc2lyZWRXaGl0ZSA9IFV0aWxzLnJvdW5kU3ltbWV0cmljKCBudW1TcGVja3MgLyAxMCApO1xyXG5cclxuICAgICAgICAgICAgaWYgKCBkZXNpcmVkQmxhY2sgPT09IG51bUJsYWNrICYmIGRlc2lyZWRHcmF5ID09PSBudW1HcmF5ICYmIGRlc2lyZWRXaGl0ZSA9PT0gbnVtV2hpdGUgKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB3aGlsZSAoIG51bUJsYWNrIDwgZGVzaXJlZEJsYWNrICkge1xyXG4gICAgICAgICAgICAgIGdyYXZlbFNvdXJjZS5hZGRDaGlsZCggbmV3IFJlY3RhbmdsZSggTWF0aC5mbG9vciggZG90UmFuZG9tLm5leHREb3VibGUoKSAqICggdGlsZVdpZHRoICsgMSApICksIE1hdGguZmxvb3IoIGRvdFJhbmRvbS5uZXh0RG91YmxlKCkgKiAoIGhlaWdodCArIDEgKSApLCAxLCAxLCB7IGZpbGw6ICdibGFjaycgfSApICk7XHJcbiAgICAgICAgICAgICAgbnVtQmxhY2srKztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgd2hpbGUgKCBudW1HcmF5IDwgZGVzaXJlZEdyYXkgKSB7XHJcbiAgICAgICAgICAgICAgZ3JhdmVsU291cmNlLmFkZENoaWxkKCBuZXcgUmVjdGFuZ2xlKCBNYXRoLmZsb29yKCBkb3RSYW5kb20ubmV4dERvdWJsZSgpICogKCB0aWxlV2lkdGggKyAxICkgKSwgTWF0aC5mbG9vciggZG90UmFuZG9tLm5leHREb3VibGUoKSAqICggaGVpZ2h0ICsgMSApICksIDEsIDEsIHsgZmlsbDogJ2dyYXknIH0gKSApO1xyXG4gICAgICAgICAgICAgIG51bUdyYXkrKztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgd2hpbGUgKCBudW1XaGl0ZSA8IGRlc2lyZWRXaGl0ZSApIHtcclxuICAgICAgICAgICAgICBncmF2ZWxTb3VyY2UuYWRkQ2hpbGQoIG5ldyBSZWN0YW5nbGUoIE1hdGguZmxvb3IoIGRvdFJhbmRvbS5uZXh0RG91YmxlKCkgKiAoIHRpbGVXaWR0aCArIDEgKSApLCBNYXRoLmZsb29yKCBkb3RSYW5kb20ubmV4dERvdWJsZSgpICogKCBoZWlnaHQgKyAxICkgKSwgMSwgMSwgeyBmaWxsOiAnd2hpdGUnIH0gKSApO1xyXG4gICAgICAgICAgICAgIG51bVdoaXRlKys7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxldCBjaGlsZHJlbjtcclxuICAgICAgICAgICAgbGV0IGk7XHJcbiAgICAgICAgICAgIHdoaWxlICggbnVtQmxhY2sgPiBkZXNpcmVkQmxhY2sgKSB7XHJcbiAgICAgICAgICAgICAgY2hpbGRyZW4gPSBncmF2ZWxTb3VyY2UuZ2V0Q2hpbGRyZW4oKTtcclxuICAgICAgICAgICAgICBmb3IgKCBpID0gY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0gKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIGNoaWxkcmVuWyBpIF0uZmlsbCA9PT0gJ2JsYWNrJyApIHtcclxuICAgICAgICAgICAgICAgICAgZ3JhdmVsU291cmNlLnJlbW92ZUNoaWxkQXQoIGkgKTtcclxuICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIG51bUJsYWNrLS07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHdoaWxlICggbnVtR3JheSA+IGRlc2lyZWRHcmF5ICkge1xyXG4gICAgICAgICAgICAgIGNoaWxkcmVuID0gZ3JhdmVsU291cmNlLmdldENoaWxkcmVuKCk7XHJcbiAgICAgICAgICAgICAgZm9yICggaSA9IGNoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tICkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCBjaGlsZHJlblsgaSBdLmZpbGwgPT09ICdncmF5JyApIHtcclxuICAgICAgICAgICAgICAgICAgZ3JhdmVsU291cmNlLnJlbW92ZUNoaWxkQXQoIGkgKTtcclxuICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIG51bUdyYXktLTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgd2hpbGUgKCBudW1XaGl0ZSA+IGRlc2lyZWRXaGl0ZSApIHtcclxuICAgICAgICAgICAgICBjaGlsZHJlbiA9IGdyYXZlbFNvdXJjZS5nZXRDaGlsZHJlbigpO1xyXG4gICAgICAgICAgICAgIGZvciAoIGkgPSBjaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSApIHtcclxuICAgICAgICAgICAgICAgIGlmICggY2hpbGRyZW5bIGkgXS5maWxsID09PSAnd2hpdGUnICkge1xyXG4gICAgICAgICAgICAgICAgICBncmF2ZWxTb3VyY2UucmVtb3ZlQ2hpbGRBdCggaSApO1xyXG4gICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgbnVtV2hpdGUtLTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9UT0RPOiBnZXQgcmlkIG9mIHBhdHRlcm4gaGVyZSwgcG9zc2libHkgYnkgY29udmVydGluZyBpdCB0b28gdG8gYW4gaW1hZ2U/XHJcbiAgICAgICAgICAgIGdyYXZlbFNvdXJjZS50b0ltYWdlKCBpbWFnZSA9PiB7IGdyYXZlbC5maWxsID0gbmV3IFBhdHRlcm4oIGltYWdlICk7IH0sIDAsIDAsIHRpbGVXaWR0aCwgaGVpZ2h0ICk7XHJcbiAgICAgICAgICB9ICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LCAwLCAwLCBncm91bmQud2lkdGgsIGdyb3VuZC5oZWlnaHQgKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZvcmNlc0FuZE1vdGlvbkJhc2ljcy5yZWdpc3RlciggJ01vdmluZ0JhY2tncm91bmROb2RlJywgTW92aW5nQmFja2dyb3VuZE5vZGUgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IE1vdmluZ0JhY2tncm91bmROb2RlO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0EsT0FBT0EsU0FBUyxNQUFNLGlDQUFpQztBQUN2RDtBQUNBLE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsU0FBU0MsS0FBSyxFQUFFQyxJQUFJLEVBQUVDLE9BQU8sRUFBRUMsU0FBUyxRQUFRLG1DQUFtQztBQUNuRixPQUFPQyxhQUFhLE1BQU0sa0NBQWtDO0FBQzVELE9BQU9DLFVBQVUsTUFBTSwrQkFBK0I7QUFDdEQsT0FBT0MsVUFBVSxNQUFNLCtCQUErQjtBQUN0RCxPQUFPQyxhQUFhLE1BQU0sa0NBQWtDO0FBQzVE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