// Copyright 2019-2023, University of Colorado Boulder

/**
 * EquationTypeNode displays an interactive equation for one of the EquationTypes enumeration values.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Property from '../../../../axon/js/Property.js';
import merge from '../../../../phet-core/js/merge.js';
import MathSymbols from '../../../../scenery-phet/js/MathSymbols.js';
import { Node, Text } from '../../../../scenery/js/imports.js';
import NumberPicker from '../../../../sun/js/NumberPicker.js';
import VectorAdditionConstants from '../../common/VectorAdditionConstants.js';
import VectorSymbolNode from '../../common/view/VectorSymbolNode.js';
import vectorAddition from '../../vectorAddition.js';
import EquationsVectorSet from '../model/EquationsVectorSet.js';
import EquationTypes from '../model/EquationTypes.js';

// constants
const TEXT_OPTIONS = {
  font: VectorAdditionConstants.INTERACTIVE_EQUATION_FONT
};
export default class EquationTypeNode extends Node {
  /**
   * @param {EquationsVectorSet} vectorSet
   * @param {EquationTypes} equationType
   * @param {Object} [options]
   */
  constructor(vectorSet, equationType, options) {
    assert && assert(vectorSet instanceof EquationsVectorSet, `invalid vectorSet: ${vectorSet}`);
    assert && assert(EquationTypes.enumeration.includes(equationType), `invalid equationType: ${equationType}`);
    assert && assert(!options || Object.getPrototypeOf(options) === Object.prototype, `Extra prototype on options: ${options}`);
    options = merge({
      // {number} spacing between the NumberPicker and the VectorSymbolNode
      labelNumberPickerSpacing: 7,
      // {number} spacing between text of the equation
      textSpacing: 13.5,
      // {number} align width of the sign texts (ie. '+', '-'). The 'sign' text is
      // aligned in an AlignBox to ensure that they are the same width.
      signTextWidth: 4
    }, options);

    // Create all of the pieces of the equation
    const equationChildren = [];
    let maxVectorSymbolHeight = 0;
    const numberPickerOptions = merge({}, VectorAdditionConstants.NUMBER_PICKER_OPTIONS, {
      touchAreaXDilation: 20,
      touchAreaYDilation: 14,
      font: VectorAdditionConstants.INTERACTIVE_EQUATION_FONT,
      color: vectorSet.vectorColorPalette.mainFill
    });

    // Left side
    for (let i = 0; i < vectorSet.vectors.length; i++) {
      if (i > 0) {
        const signText = equationType === EquationTypes.SUBTRACTION ? MathSymbols.MINUS : MathSymbols.PLUS;
        equationChildren.push(new Text(signText, TEXT_OPTIONS));
      }
      const vector = vectorSet.vectors.get(i);
      assert && assert(vector.coefficientProperty.range, 'coefficientProperty must have an associated range');
      equationChildren.push(new NumberPicker(vector.coefficientProperty, new Property(vector.coefficientProperty.range), numberPickerOptions));
      const vectorSymbolNode = new VectorSymbolNode({
        symbol: vector.symbol,
        symbolFont: VectorAdditionConstants.INTERACTIVE_EQUATION_SYMBOL_FONT
      });
      equationChildren.push(vectorSymbolNode);
      maxVectorSymbolHeight = Math.max(maxVectorSymbolHeight, vectorSymbolNode.height);
    }
    if (equationType === EquationTypes.NEGATION) {
      const signText = equationType === EquationTypes.SUBTRACTION ? MathSymbols.MINUS : MathSymbols.PLUS;
      equationChildren.push(new Text(signText, TEXT_OPTIONS));
      const vectorSymbolNode = new VectorSymbolNode({
        symbol: vectorSet.sumVector.symbol,
        symbolFont: VectorAdditionConstants.INTERACTIVE_EQUATION_SYMBOL_FONT
      });
      equationChildren.push(vectorSymbolNode);
      maxVectorSymbolHeight = Math.max(maxVectorSymbolHeight, vectorSymbolNode.height);
    }

    // =
    equationChildren.push(new Text(MathSymbols.EQUAL_TO, TEXT_OPTIONS));

    // Right size
    if (equationType === EquationTypes.NEGATION) {
      equationChildren.push(new Text('0', TEXT_OPTIONS));
    } else {
      const vectorSymbolNode = new VectorSymbolNode({
        symbol: vectorSet.sumVector.symbol,
        symbolFont: VectorAdditionConstants.INTERACTIVE_EQUATION_SYMBOL_FONT
      });
      equationChildren.push(vectorSymbolNode);
      maxVectorSymbolHeight = Math.max(maxVectorSymbolHeight, vectorSymbolNode.height);
    }

    // This layout algorithm keeps text Nodes aligned on their baselines, and empirically adjusts the
    // vertical position of NumberPickers. See https://github.com/phetsims/vector-addition/issues/128
    for (let i = 0; i < equationChildren.length; i++) {
      const child = equationChildren[i];
      if (child instanceof NumberPicker) {
        child.centerY = -maxVectorSymbolHeight / 3;
      }
      if (i > 0) {
        const previousChild = equationChildren[i - 1];
        if (previousChild instanceof NumberPicker) {
          child.left = previousChild.right + options.labelNumberPickerSpacing;
        } else {
          child.left = previousChild.right + options.textSpacing;
        }
      }
    }
    assert && assert(!options.children, 'EquationTypeNode sets children');
    options.children = equationChildren;
    super(options);
  }
}
vectorAddition.register('EquationTypeNode', EquationTypeNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIm1lcmdlIiwiTWF0aFN5bWJvbHMiLCJOb2RlIiwiVGV4dCIsIk51bWJlclBpY2tlciIsIlZlY3RvckFkZGl0aW9uQ29uc3RhbnRzIiwiVmVjdG9yU3ltYm9sTm9kZSIsInZlY3RvckFkZGl0aW9uIiwiRXF1YXRpb25zVmVjdG9yU2V0IiwiRXF1YXRpb25UeXBlcyIsIlRFWFRfT1BUSU9OUyIsImZvbnQiLCJJTlRFUkFDVElWRV9FUVVBVElPTl9GT05UIiwiRXF1YXRpb25UeXBlTm9kZSIsImNvbnN0cnVjdG9yIiwidmVjdG9yU2V0IiwiZXF1YXRpb25UeXBlIiwib3B0aW9ucyIsImFzc2VydCIsImVudW1lcmF0aW9uIiwiaW5jbHVkZXMiLCJPYmplY3QiLCJnZXRQcm90b3R5cGVPZiIsInByb3RvdHlwZSIsImxhYmVsTnVtYmVyUGlja2VyU3BhY2luZyIsInRleHRTcGFjaW5nIiwic2lnblRleHRXaWR0aCIsImVxdWF0aW9uQ2hpbGRyZW4iLCJtYXhWZWN0b3JTeW1ib2xIZWlnaHQiLCJudW1iZXJQaWNrZXJPcHRpb25zIiwiTlVNQkVSX1BJQ0tFUl9PUFRJT05TIiwidG91Y2hBcmVhWERpbGF0aW9uIiwidG91Y2hBcmVhWURpbGF0aW9uIiwiY29sb3IiLCJ2ZWN0b3JDb2xvclBhbGV0dGUiLCJtYWluRmlsbCIsImkiLCJ2ZWN0b3JzIiwibGVuZ3RoIiwic2lnblRleHQiLCJTVUJUUkFDVElPTiIsIk1JTlVTIiwiUExVUyIsInB1c2giLCJ2ZWN0b3IiLCJnZXQiLCJjb2VmZmljaWVudFByb3BlcnR5IiwicmFuZ2UiLCJ2ZWN0b3JTeW1ib2xOb2RlIiwic3ltYm9sIiwic3ltYm9sRm9udCIsIklOVEVSQUNUSVZFX0VRVUFUSU9OX1NZTUJPTF9GT05UIiwiTWF0aCIsIm1heCIsImhlaWdodCIsIk5FR0FUSU9OIiwic3VtVmVjdG9yIiwiRVFVQUxfVE8iLCJjaGlsZCIsImNlbnRlclkiLCJwcmV2aW91c0NoaWxkIiwibGVmdCIsInJpZ2h0IiwiY2hpbGRyZW4iLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkVxdWF0aW9uVHlwZU5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogRXF1YXRpb25UeXBlTm9kZSBkaXNwbGF5cyBhbiBpbnRlcmFjdGl2ZSBlcXVhdGlvbiBmb3Igb25lIG9mIHRoZSBFcXVhdGlvblR5cGVzIGVudW1lcmF0aW9uIHZhbHVlcy5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgTWF0aFN5bWJvbHMgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL01hdGhTeW1ib2xzLmpzJztcclxuaW1wb3J0IHsgTm9kZSwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBOdW1iZXJQaWNrZXIgZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL051bWJlclBpY2tlci5qcyc7XHJcbmltcG9ydCBWZWN0b3JBZGRpdGlvbkNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vVmVjdG9yQWRkaXRpb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yU3ltYm9sTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9WZWN0b3JTeW1ib2xOb2RlLmpzJztcclxuaW1wb3J0IHZlY3RvckFkZGl0aW9uIGZyb20gJy4uLy4uL3ZlY3RvckFkZGl0aW9uLmpzJztcclxuaW1wb3J0IEVxdWF0aW9uc1ZlY3RvclNldCBmcm9tICcuLi9tb2RlbC9FcXVhdGlvbnNWZWN0b3JTZXQuanMnO1xyXG5pbXBvcnQgRXF1YXRpb25UeXBlcyBmcm9tICcuLi9tb2RlbC9FcXVhdGlvblR5cGVzLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBURVhUX09QVElPTlMgPSB7XHJcbiAgZm9udDogVmVjdG9yQWRkaXRpb25Db25zdGFudHMuSU5URVJBQ1RJVkVfRVFVQVRJT05fRk9OVFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRXF1YXRpb25UeXBlTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0VxdWF0aW9uc1ZlY3RvclNldH0gdmVjdG9yU2V0XHJcbiAgICogQHBhcmFtIHtFcXVhdGlvblR5cGVzfSBlcXVhdGlvblR5cGVcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIHZlY3RvclNldCwgZXF1YXRpb25UeXBlLCBvcHRpb25zICkge1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHZlY3RvclNldCBpbnN0YW5jZW9mIEVxdWF0aW9uc1ZlY3RvclNldCwgYGludmFsaWQgdmVjdG9yU2V0OiAke3ZlY3RvclNldH1gICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBFcXVhdGlvblR5cGVzLmVudW1lcmF0aW9uLmluY2x1ZGVzKCBlcXVhdGlvblR5cGUgKSwgYGludmFsaWQgZXF1YXRpb25UeXBlOiAke2VxdWF0aW9uVHlwZX1gICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhb3B0aW9ucyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoIG9wdGlvbnMgKSA9PT0gT2JqZWN0LnByb3RvdHlwZSwgYEV4dHJhIHByb3RvdHlwZSBvbiBvcHRpb25zOiAke29wdGlvbnN9YCApO1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG5cclxuICAgICAgLy8ge251bWJlcn0gc3BhY2luZyBiZXR3ZWVuIHRoZSBOdW1iZXJQaWNrZXIgYW5kIHRoZSBWZWN0b3JTeW1ib2xOb2RlXHJcbiAgICAgIGxhYmVsTnVtYmVyUGlja2VyU3BhY2luZzogNyxcclxuXHJcbiAgICAgIC8vIHtudW1iZXJ9IHNwYWNpbmcgYmV0d2VlbiB0ZXh0IG9mIHRoZSBlcXVhdGlvblxyXG4gICAgICB0ZXh0U3BhY2luZzogMTMuNSxcclxuXHJcbiAgICAgIC8vIHtudW1iZXJ9IGFsaWduIHdpZHRoIG9mIHRoZSBzaWduIHRleHRzIChpZS4gJysnLCAnLScpLiBUaGUgJ3NpZ24nIHRleHQgaXNcclxuICAgICAgLy8gYWxpZ25lZCBpbiBhbiBBbGlnbkJveCB0byBlbnN1cmUgdGhhdCB0aGV5IGFyZSB0aGUgc2FtZSB3aWR0aC5cclxuICAgICAgc2lnblRleHRXaWR0aDogNFxyXG5cclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYWxsIG9mIHRoZSBwaWVjZXMgb2YgdGhlIGVxdWF0aW9uXHJcbiAgICBjb25zdCBlcXVhdGlvbkNoaWxkcmVuID0gW107XHJcbiAgICBsZXQgbWF4VmVjdG9yU3ltYm9sSGVpZ2h0ID0gMDtcclxuXHJcbiAgICBjb25zdCBudW1iZXJQaWNrZXJPcHRpb25zID0gbWVyZ2UoIHt9LCBWZWN0b3JBZGRpdGlvbkNvbnN0YW50cy5OVU1CRVJfUElDS0VSX09QVElPTlMsIHtcclxuICAgICAgdG91Y2hBcmVhWERpbGF0aW9uOiAyMCxcclxuICAgICAgdG91Y2hBcmVhWURpbGF0aW9uOiAxNCxcclxuICAgICAgZm9udDogVmVjdG9yQWRkaXRpb25Db25zdGFudHMuSU5URVJBQ1RJVkVfRVFVQVRJT05fRk9OVCxcclxuICAgICAgY29sb3I6IHZlY3RvclNldC52ZWN0b3JDb2xvclBhbGV0dGUubWFpbkZpbGxcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBMZWZ0IHNpZGVcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHZlY3RvclNldC52ZWN0b3JzLmxlbmd0aDsgaSsrICkge1xyXG5cclxuICAgICAgaWYgKCBpID4gMCApIHtcclxuICAgICAgICBjb25zdCBzaWduVGV4dCA9ICggZXF1YXRpb25UeXBlID09PSBFcXVhdGlvblR5cGVzLlNVQlRSQUNUSU9OICkgPyBNYXRoU3ltYm9scy5NSU5VUyA6IE1hdGhTeW1ib2xzLlBMVVM7XHJcbiAgICAgICAgZXF1YXRpb25DaGlsZHJlbi5wdXNoKCBuZXcgVGV4dCggc2lnblRleHQsIFRFWFRfT1BUSU9OUyApICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHZlY3RvciA9IHZlY3RvclNldC52ZWN0b3JzLmdldCggaSApO1xyXG5cclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggdmVjdG9yLmNvZWZmaWNpZW50UHJvcGVydHkucmFuZ2UsXHJcbiAgICAgICAgJ2NvZWZmaWNpZW50UHJvcGVydHkgbXVzdCBoYXZlIGFuIGFzc29jaWF0ZWQgcmFuZ2UnICk7XHJcblxyXG4gICAgICBlcXVhdGlvbkNoaWxkcmVuLnB1c2goIG5ldyBOdW1iZXJQaWNrZXIoIHZlY3Rvci5jb2VmZmljaWVudFByb3BlcnR5LFxyXG4gICAgICAgIG5ldyBQcm9wZXJ0eSggdmVjdG9yLmNvZWZmaWNpZW50UHJvcGVydHkucmFuZ2UgKSxcclxuICAgICAgICBudW1iZXJQaWNrZXJPcHRpb25zICkgKTtcclxuXHJcbiAgICAgIGNvbnN0IHZlY3RvclN5bWJvbE5vZGUgPSBuZXcgVmVjdG9yU3ltYm9sTm9kZSgge1xyXG4gICAgICAgIHN5bWJvbDogdmVjdG9yLnN5bWJvbCxcclxuICAgICAgICBzeW1ib2xGb250OiBWZWN0b3JBZGRpdGlvbkNvbnN0YW50cy5JTlRFUkFDVElWRV9FUVVBVElPTl9TWU1CT0xfRk9OVFxyXG4gICAgICB9ICk7XHJcbiAgICAgIGVxdWF0aW9uQ2hpbGRyZW4ucHVzaCggdmVjdG9yU3ltYm9sTm9kZSApO1xyXG4gICAgICBtYXhWZWN0b3JTeW1ib2xIZWlnaHQgPSBNYXRoLm1heCggbWF4VmVjdG9yU3ltYm9sSGVpZ2h0LCB2ZWN0b3JTeW1ib2xOb2RlLmhlaWdodCApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICggZXF1YXRpb25UeXBlID09PSBFcXVhdGlvblR5cGVzLk5FR0FUSU9OICkge1xyXG4gICAgICBjb25zdCBzaWduVGV4dCA9ICggZXF1YXRpb25UeXBlID09PSBFcXVhdGlvblR5cGVzLlNVQlRSQUNUSU9OICkgPyBNYXRoU3ltYm9scy5NSU5VUyA6IE1hdGhTeW1ib2xzLlBMVVM7XHJcbiAgICAgIGVxdWF0aW9uQ2hpbGRyZW4ucHVzaCggbmV3IFRleHQoIHNpZ25UZXh0LCBURVhUX09QVElPTlMgKSApO1xyXG5cclxuICAgICAgY29uc3QgdmVjdG9yU3ltYm9sTm9kZSA9IG5ldyBWZWN0b3JTeW1ib2xOb2RlKCB7XHJcbiAgICAgICAgc3ltYm9sOiB2ZWN0b3JTZXQuc3VtVmVjdG9yLnN5bWJvbCxcclxuICAgICAgICBzeW1ib2xGb250OiBWZWN0b3JBZGRpdGlvbkNvbnN0YW50cy5JTlRFUkFDVElWRV9FUVVBVElPTl9TWU1CT0xfRk9OVFxyXG4gICAgICB9ICk7XHJcbiAgICAgIGVxdWF0aW9uQ2hpbGRyZW4ucHVzaCggdmVjdG9yU3ltYm9sTm9kZSApO1xyXG4gICAgICBtYXhWZWN0b3JTeW1ib2xIZWlnaHQgPSBNYXRoLm1heCggbWF4VmVjdG9yU3ltYm9sSGVpZ2h0LCB2ZWN0b3JTeW1ib2xOb2RlLmhlaWdodCApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vID1cclxuICAgIGVxdWF0aW9uQ2hpbGRyZW4ucHVzaCggbmV3IFRleHQoIE1hdGhTeW1ib2xzLkVRVUFMX1RPLCBURVhUX09QVElPTlMgKSApO1xyXG5cclxuICAgIC8vIFJpZ2h0IHNpemVcclxuICAgIGlmICggZXF1YXRpb25UeXBlID09PSBFcXVhdGlvblR5cGVzLk5FR0FUSU9OICkge1xyXG4gICAgICBlcXVhdGlvbkNoaWxkcmVuLnB1c2goIG5ldyBUZXh0KCAnMCcsIFRFWFRfT1BUSU9OUyApICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgY29uc3QgdmVjdG9yU3ltYm9sTm9kZSA9IG5ldyBWZWN0b3JTeW1ib2xOb2RlKCB7XHJcbiAgICAgICAgc3ltYm9sOiB2ZWN0b3JTZXQuc3VtVmVjdG9yLnN5bWJvbCxcclxuICAgICAgICBzeW1ib2xGb250OiBWZWN0b3JBZGRpdGlvbkNvbnN0YW50cy5JTlRFUkFDVElWRV9FUVVBVElPTl9TWU1CT0xfRk9OVFxyXG4gICAgICB9ICk7XHJcbiAgICAgIGVxdWF0aW9uQ2hpbGRyZW4ucHVzaCggdmVjdG9yU3ltYm9sTm9kZSApO1xyXG4gICAgICBtYXhWZWN0b3JTeW1ib2xIZWlnaHQgPSBNYXRoLm1heCggbWF4VmVjdG9yU3ltYm9sSGVpZ2h0LCB2ZWN0b3JTeW1ib2xOb2RlLmhlaWdodCApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRoaXMgbGF5b3V0IGFsZ29yaXRobSBrZWVwcyB0ZXh0IE5vZGVzIGFsaWduZWQgb24gdGhlaXIgYmFzZWxpbmVzLCBhbmQgZW1waXJpY2FsbHkgYWRqdXN0cyB0aGVcclxuICAgIC8vIHZlcnRpY2FsIHBvc2l0aW9uIG9mIE51bWJlclBpY2tlcnMuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvdmVjdG9yLWFkZGl0aW9uL2lzc3Vlcy8xMjhcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGVxdWF0aW9uQ2hpbGRyZW4ubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IGNoaWxkID0gZXF1YXRpb25DaGlsZHJlblsgaSBdO1xyXG4gICAgICBpZiAoIGNoaWxkIGluc3RhbmNlb2YgTnVtYmVyUGlja2VyICkge1xyXG4gICAgICAgIGNoaWxkLmNlbnRlclkgPSAtbWF4VmVjdG9yU3ltYm9sSGVpZ2h0IC8gMztcclxuICAgICAgfVxyXG4gICAgICBpZiAoIGkgPiAwICkge1xyXG4gICAgICAgIGNvbnN0IHByZXZpb3VzQ2hpbGQgPSBlcXVhdGlvbkNoaWxkcmVuWyBpIC0gMSBdO1xyXG4gICAgICAgIGlmICggcHJldmlvdXNDaGlsZCBpbnN0YW5jZW9mIE51bWJlclBpY2tlciApIHtcclxuICAgICAgICAgIGNoaWxkLmxlZnQgPSBwcmV2aW91c0NoaWxkLnJpZ2h0ICsgb3B0aW9ucy5sYWJlbE51bWJlclBpY2tlclNwYWNpbmc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgY2hpbGQubGVmdCA9IHByZXZpb3VzQ2hpbGQucmlnaHQgKyBvcHRpb25zLnRleHRTcGFjaW5nO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICFvcHRpb25zLmNoaWxkcmVuLCAnRXF1YXRpb25UeXBlTm9kZSBzZXRzIGNoaWxkcmVuJyApO1xyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IGVxdWF0aW9uQ2hpbGRyZW47XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuICB9XHJcbn1cclxuXHJcbnZlY3RvckFkZGl0aW9uLnJlZ2lzdGVyKCAnRXF1YXRpb25UeXBlTm9kZScsIEVxdWF0aW9uVHlwZU5vZGUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxLQUFLLE1BQU0sbUNBQW1DO0FBQ3JELE9BQU9DLFdBQVcsTUFBTSw0Q0FBNEM7QUFDcEUsU0FBU0MsSUFBSSxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQzlELE9BQU9DLFlBQVksTUFBTSxvQ0FBb0M7QUFDN0QsT0FBT0MsdUJBQXVCLE1BQU0seUNBQXlDO0FBQzdFLE9BQU9DLGdCQUFnQixNQUFNLHVDQUF1QztBQUNwRSxPQUFPQyxjQUFjLE1BQU0seUJBQXlCO0FBQ3BELE9BQU9DLGtCQUFrQixNQUFNLGdDQUFnQztBQUMvRCxPQUFPQyxhQUFhLE1BQU0sMkJBQTJCOztBQUVyRDtBQUNBLE1BQU1DLFlBQVksR0FBRztFQUNuQkMsSUFBSSxFQUFFTix1QkFBdUIsQ0FBQ087QUFDaEMsQ0FBQztBQUVELGVBQWUsTUFBTUMs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