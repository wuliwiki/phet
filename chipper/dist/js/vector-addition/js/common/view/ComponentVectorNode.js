// Copyright 2019-2023, University of Colorado Boulder

/**
 * View for a ComponentVector
 *
 * Extends RootVectorNode but add the following functionality:
 *  - determines visibility by the component style (i.e. should be invisible on ComponentVectorStyles.INVISIBLE)
 *  - draws lines for the PROJECTION component vector style
 *  - custom label positioning
 *  - distinct appearance
 *
 * @author Brandon Li
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import EnumerationProperty from '../../../../axon/js/EnumerationProperty.js';
import Multilink from '../../../../axon/js/Multilink.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import merge from '../../../../phet-core/js/merge.js';
import { Path } from '../../../../scenery/js/imports.js';
import vectorAddition from '../../vectorAddition.js';
import ComponentVector from '../model/ComponentVector.js';
import ComponentVectorStyles from '../model/ComponentVectorStyles.js';
import ComponentVectorTypes from '../model/ComponentVectorTypes.js';
import Graph from '../model/Graph.js';
import VectorAdditionColors from '../VectorAdditionColors.js';
import VectorAdditionConstants from '../VectorAdditionConstants.js';
import RootVectorNode from './RootVectorNode.js';

// constants

// offset of the label
const COMPONENT_LABEL_OFFSET = VectorAdditionConstants.VECTOR_LABEL_OFFSET;

// Line dash for leader lines, displayed when component vectors are projected onto axes
const NON_ACTIVE_LEADER_LINES_DASH = [3, 10];
const ACTIVE_LEADER_LINES_DASH = [];
export default class ComponentVectorNode extends RootVectorNode {
  /**
   * @param {ComponentVector} componentVector - the component vector model the node represents
   * @param {Graph} graph - the graph the component vector belongs to
   * @param {EnumerationProperty.<ComponentVectorStyles>} componentStyleProperty
   * @param {BooleanProperty} valuesVisibleProperty
   * @param {Object} [options]
   */
  constructor(componentVector, graph, componentStyleProperty, valuesVisibleProperty, options) {
    assert && assert(componentVector instanceof ComponentVector, `invalid componentVector: ${componentVector}`);
    assert && assert(graph instanceof Graph, `invalid graph: ${graph}`);
    assert && assert(componentStyleProperty instanceof EnumerationProperty && ComponentVectorStyles.enumeration.includes(componentStyleProperty.value), `invalid componentStyleProperty: ${componentStyleProperty}`);
    assert && assert(valuesVisibleProperty instanceof BooleanProperty, `invalid valuesVisibleProperty: ${valuesVisibleProperty}`);
    assert && assert(!options || Object.getPrototypeOf(options) === Object.prototype, `Extra prototype on options: ${options}`);

    //----------------------------------------------------------------------------------------

    options = merge({
      arrowType: 'dashed',
      // {Object} - options passed to the super class to stylize the arrowOptions.
      arrowOptions: merge({}, VectorAdditionConstants.COMPONENT_VECTOR_ARROW_OPTIONS, {
        fill: componentVector.vectorColorPalette.componentFill
      })
    }, options);
    super(componentVector, graph.modelViewTransformProperty, valuesVisibleProperty, graph.activeVectorProperty, options);

    //----------------------------------------------------------------------------------------

    // Create a path that represents the dashed lines corresponding to the PROJECTION style.
    // The shape of the path will be updated later.

    // @private {Path} leader lines, displayed when component vectors are projected onto axes
    this.leaderLinesPath = new Path(new Shape(), {
      lineWidth: 0.5,
      lineDash: NON_ACTIVE_LEADER_LINES_DASH
    });
    this.addChild(this.leaderLinesPath);

    //----------------------------------------------------------------------------------------
    // Create a multilink to observe:
    //  - componentStyleProperty - to determine visibility (i.e. components shouldn't be visible on INVISIBLE)
    //                             and to draw lines on the PROJECTION componentStyle
    //  - isOnGraphProperty - components shouldn't be visible if the vector isn't on the graph
    //  - vectorComponentsProperty - to update the leader lines drawings positions
    //
    // unmultilink is required on dispose.
    //
    // @private {Multilink} componentVectorMultilink
    this.componentVectorMultilink = Multilink.multilink([componentStyleProperty, componentVector.isParentVectorActiveProperty, componentVector.isOnGraphProperty, componentVector.vectorComponentsProperty], (componentStyle, isParentActive) => {
      this.updateComponentVector(componentVector, graph.modelViewTransformProperty.value, componentStyle, isParentActive);
    });

    // Highlight the component vector's label when its parent vector is selected.
    // unlink is required on dispose.
    const activeVectorListener = activeVector => {
      this.labelNode.setHighlighted(activeVector === componentVector.parentVector);
    };
    graph.activeVectorProperty.link(activeVectorListener);

    // @private
    this.disposeComponentVectorNode = () => {
      Multilink.unmultilink(this.componentVectorMultilink);
      graph.activeVectorProperty.unlink(activeVectorListener);
    };
  }

  /**
   * @override
   * @public
   */
  dispose() {
    this.disposeComponentVectorNode();
    super.dispose();
  }

  /**
   * Updates the component vector node:
   *  - Draws leader lines when componentStyle is ON_AXIS
   *  - Determines visibility (i.e. components shouldn't be visible on INVISIBLE)
   * @protected
   *
   * @param {ComponentVector} componentVector
   * @param {ModelViewTransform2} modelViewTransform
   * @param {ComponentVectorStyles} componentStyle
   * @param {boolean} isParentActive
   */
  updateComponentVector(componentVector, modelViewTransform, componentStyle, isParentActive) {
    // Component vectors are visible when it isn't INVISIBLE and it is on the graph.
    this.visible = componentVector.isOnGraphProperty.value && componentStyle !== ComponentVectorStyles.INVISIBLE;
    if (componentStyle === ComponentVectorStyles.PROJECTION) {
      this.labelNode.visible = componentVector.magnitude !== 0;
    } else {
      // Hide the label if either of the parent vector's components is zero,
      // see https://github.com/phetsims/vector-addition/issues/264
      this.labelNode.visible = !componentVector.parentVector.hasZeroComponent();
    }

    // Leader lines are only visible when component vectors are projected onto axes
    this.leaderLinesPath.visible = componentStyle === ComponentVectorStyles.PROJECTION;

    // Update leader lines only if they are visible (with PROJECTION style)
    if (this.leaderLinesPath.visible) {
      // Since the leader lines are a child of this view, the origin of the view is at the tail of the component
      // vector. Get the tip position relative to the tail of the component vector (which is the components)
      const tipPosition = modelViewTransform.modelToViewDelta(componentVector.vectorComponents);

      // Get the parent tail position relative to the origin of the view (the tail of the component vector)
      const parentTailPosition = modelViewTransform.modelToViewDelta(componentVector.parentTail.minus(componentVector.tail));

      // Get the parent tip position relative to the origin of the view (the tail of the component vector)
      const parentTipPosition = modelViewTransform.modelToViewDelta(componentVector.parentTip.minus(componentVector.tail));

      // Create new shape for the leader lines
      this.leaderLinesPath.shape = new Shape().moveToPoint(Vector2.ZERO).lineToPoint(parentTailPosition).moveToPoint(tipPosition).lineToPoint(parentTipPosition);
      if (isParentActive) {
        this.leaderLinesPath.stroke = VectorAdditionColors.LEADER_LINES_ACTIVE_STROKE;
        this.leaderLinesPath.lineDash = ACTIVE_LEADER_LINES_DASH;
      } else {
        this.leaderLinesPath.stroke = VectorAdditionColors.LEADER_LINES_NON_ACTIVE_STROKE;
        this.leaderLinesPath.lineDash = NON_ACTIVE_LEADER_LINES_DASH;
      }
    }
  }

  /**
   * Updates the label positioning of the vector component. Vector components have a unique label positioning.
   * @override
   * @protected
   *
   * @param {ComponentVector} componentVector
   * @param {ModelViewTransform2} modelViewTransform
   * @param {boolean} valuesVisible
   */
  updateLabelPositioning(componentVector, modelViewTransform, valuesVisible) {
    // If the magnitude of the componentVector is 0, then position the label node on the 'tail'
    if (componentVector.magnitude === 0) {
      this.labelNode.center = Vector2.ZERO;
      return;
    }

    // Flag to indicate the label offset translation.
    const labelOffset = new Vector2(0, 0);

    // Convenience variables
    const componentMidPoint = componentVector.midPoint;
    const parentMidPoint = componentVector.parentMidPoint;
    if (componentVector.componentType === ComponentVectorTypes.X_COMPONENT) {
      // Get the label height. Negative since the y axis is inverted in the view
      const labelHeight = modelViewTransform.viewToModelDeltaY(-this.labelNode.height);

      // If the component is below the parent, position the label below, otherwise position it above
      if (componentMidPoint.y <= parentMidPoint.y) {
        labelOffset.setXY(0, -COMPONENT_LABEL_OFFSET - labelHeight / 2);
      } else {
        labelOffset.setXY(0, COMPONENT_LABEL_OFFSET + labelHeight / 2);
      }
    } else if (componentVector.componentType === ComponentVectorTypes.Y_COMPONENT) {
      const labelWidth = modelViewTransform.viewToModelDeltaX(this.labelNode.width);

      // If the component is to the left of the parent, position the label to the left, otherwise to the right
      if (componentMidPoint.x < parentMidPoint.x) {
        labelOffset.setXY(-COMPONENT_LABEL_OFFSET - labelWidth / 2, 0);
      } else {
        labelOffset.setXY(COMPONENT_LABEL_OFFSET + labelWidth / 2, 0);
      }
    }

    // Position the label
    this.labelNode.center = RootVectorNode.computeLabelCenter(componentVector, modelViewTransform, labelOffset);
  }
}
vectorAddition.register('ComponentVectorNode', ComponentVectorNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJFbnVtZXJhdGlvblByb3BlcnR5IiwiTXVsdGlsaW5rIiwiVmVjdG9yMiIsIlNoYXBlIiwibWVyZ2UiLCJQYXRoIiwidmVjdG9yQWRkaXRpb24iLCJDb21wb25lbnRWZWN0b3IiLCJDb21wb25lbnRWZWN0b3JTdHlsZXMiLCJDb21wb25lbnRWZWN0b3JUeXBlcyIsIkdyYXBoIiwiVmVjdG9yQWRkaXRpb25Db2xvcnMiLCJWZWN0b3JBZGRpdGlvbkNvbnN0YW50cyIsIlJvb3RWZWN0b3JOb2RlIiwiQ09NUE9ORU5UX0xBQkVMX09GRlNFVCIsIlZFQ1RPUl9MQUJFTF9PRkZTRVQiLCJOT05fQUNUSVZFX0xFQURFUl9MSU5FU19EQVNIIiwiQUNUSVZFX0xFQURFUl9MSU5FU19EQVNIIiwiQ29tcG9uZW50VmVjdG9yTm9kZSIsImNvbnN0cnVjdG9yIiwiY29tcG9uZW50VmVjdG9yIiwiZ3JhcGgiLCJjb21wb25lbnRTdHlsZVByb3BlcnR5IiwidmFsdWVzVmlzaWJsZVByb3BlcnR5Iiwib3B0aW9ucyIsImFzc2VydCIsImVudW1lcmF0aW9uIiwiaW5jbHVkZXMiLCJ2YWx1ZSIsIk9iamVjdCIsImdldFByb3RvdHlwZU9mIiwicHJvdG90eXBlIiwiYXJyb3dUeXBlIiwiYXJyb3dPcHRpb25zIiwiQ09NUE9ORU5UX1ZFQ1RPUl9BUlJPV19PUFRJT05TIiwiZmlsbCIsInZlY3RvckNvbG9yUGFsZXR0ZSIsImNvbXBvbmVudEZpbGwiLCJtb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eSIsImFjdGl2ZVZlY3RvclByb3BlcnR5IiwibGVhZGVyTGluZXNQYXRoIiwibGluZVdpZHRoIiwibGluZURhc2giLCJhZGRDaGlsZCIsImNvbXBvbmVudFZlY3Rvck11bHRpbGluayIsIm11bHRpbGluayIsImlzUGFyZW50VmVjdG9yQWN0aXZlUHJvcGVydHkiLCJpc09uR3JhcGhQcm9wZXJ0eSIsInZlY3RvckNvbXBvbmVudHNQcm9wZXJ0eSIsImNvbXBvbmVudFN0eWxlIiwiaXNQYXJlbnRBY3RpdmUiLCJ1cGRhdGVDb21wb25lbnRWZWN0b3IiLCJhY3RpdmVWZWN0b3JMaXN0ZW5lciIsImFjdGl2ZVZlY3RvciIsImxhYmVsTm9kZSIsInNldEhpZ2hsaWdodGVkIiwicGFyZW50VmVjdG9yIiwibGluayIsImRpc3Bvc2VDb21wb25lbnRWZWN0b3JOb2RlIiwidW5tdWx0aWxpbmsiLCJ1bmxpbmsiLCJkaXNwb3NlIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwidmlzaWJsZSIsIklOVklTSUJMRSIsIlBST0pFQ1RJT04iLCJtYWduaXR1ZGUiLCJoYXNaZXJvQ29tcG9uZW50IiwidGlwUG9zaXRpb24iLCJtb2RlbFRvVmlld0RlbHRhIiwidmVjdG9yQ29tcG9uZW50cyIsInBhcmVudFRhaWxQb3NpdGlvbiIsInBhcmVudFRhaWwiLCJtaW51cyIsInRhaWwiLCJwYXJlbnRUaXBQb3NpdGlvbiIsInBhcmVudFRpcCIsInNoYXBlIiwibW92ZVRvUG9pbnQiLCJaRVJPIiwibGluZVRvUG9pbnQiLCJzdHJva2UiLCJMRUFERVJfTElORVNfQUNUSVZFX1NUUk9LRSIsIkxFQURFUl9MSU5FU19OT05fQUNUSVZFX1NUUk9LRSIsInVwZGF0ZUxhYmVsUG9zaXRpb25pbmciLCJ2YWx1ZXNWaXNpYmxlIiwiY2VudGVyIiwibGFiZWxPZmZzZXQiLCJjb21wb25lbnRNaWRQb2ludCIsIm1pZFBvaW50IiwicGFyZW50TWlkUG9pbnQiLCJjb21wb25lbnRUeXBlIiwiWF9DT01QT05FTlQiLCJsYWJlbEhlaWdodCIsInZpZXdUb01vZGVsRGVsdGFZIiwiaGVpZ2h0IiwieSIsInNldFhZIiwiWV9DT01QT05FTlQiLCJsYWJlbFdpZHRoIiwidmlld1RvTW9kZWxEZWx0YVgiLCJ3aWR0aCIsIngiLCJjb21wdXRlTGFiZWxDZW50ZXIiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNvbXBvbmVudFZlY3Rvck5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVmlldyBmb3IgYSBDb21wb25lbnRWZWN0b3JcclxuICpcclxuICogRXh0ZW5kcyBSb290VmVjdG9yTm9kZSBidXQgYWRkIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb25hbGl0eTpcclxuICogIC0gZGV0ZXJtaW5lcyB2aXNpYmlsaXR5IGJ5IHRoZSBjb21wb25lbnQgc3R5bGUgKGkuZS4gc2hvdWxkIGJlIGludmlzaWJsZSBvbiBDb21wb25lbnRWZWN0b3JTdHlsZXMuSU5WSVNJQkxFKVxyXG4gKiAgLSBkcmF3cyBsaW5lcyBmb3IgdGhlIFBST0pFQ1RJT04gY29tcG9uZW50IHZlY3RvciBzdHlsZVxyXG4gKiAgLSBjdXN0b20gbGFiZWwgcG9zaXRpb25pbmdcclxuICogIC0gZGlzdGluY3QgYXBwZWFyYW5jZVxyXG4gKlxyXG4gKiBAYXV0aG9yIEJyYW5kb24gTGlcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IEVudW1lcmF0aW9uUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbnVtZXJhdGlvblByb3BlcnR5LmpzJztcclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IHsgUGF0aCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB2ZWN0b3JBZGRpdGlvbiBmcm9tICcuLi8uLi92ZWN0b3JBZGRpdGlvbi5qcyc7XHJcbmltcG9ydCBDb21wb25lbnRWZWN0b3IgZnJvbSAnLi4vbW9kZWwvQ29tcG9uZW50VmVjdG9yLmpzJztcclxuaW1wb3J0IENvbXBvbmVudFZlY3RvclN0eWxlcyBmcm9tICcuLi9tb2RlbC9Db21wb25lbnRWZWN0b3JTdHlsZXMuanMnO1xyXG5pbXBvcnQgQ29tcG9uZW50VmVjdG9yVHlwZXMgZnJvbSAnLi4vbW9kZWwvQ29tcG9uZW50VmVjdG9yVHlwZXMuanMnO1xyXG5pbXBvcnQgR3JhcGggZnJvbSAnLi4vbW9kZWwvR3JhcGguanMnO1xyXG5pbXBvcnQgVmVjdG9yQWRkaXRpb25Db2xvcnMgZnJvbSAnLi4vVmVjdG9yQWRkaXRpb25Db2xvcnMuanMnO1xyXG5pbXBvcnQgVmVjdG9yQWRkaXRpb25Db25zdGFudHMgZnJvbSAnLi4vVmVjdG9yQWRkaXRpb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgUm9vdFZlY3Rvck5vZGUgZnJvbSAnLi9Sb290VmVjdG9yTm9kZS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuXHJcbi8vIG9mZnNldCBvZiB0aGUgbGFiZWxcclxuY29uc3QgQ09NUE9ORU5UX0xBQkVMX09GRlNFVCA9IFZlY3RvckFkZGl0aW9uQ29uc3RhbnRzLlZFQ1RPUl9MQUJFTF9PRkZTRVQ7XHJcblxyXG4vLyBMaW5lIGRhc2ggZm9yIGxlYWRlciBsaW5lcywgZGlzcGxheWVkIHdoZW4gY29tcG9uZW50IHZlY3RvcnMgYXJlIHByb2plY3RlZCBvbnRvIGF4ZXNcclxuY29uc3QgTk9OX0FDVElWRV9MRUFERVJfTElORVNfREFTSCA9IFsgMywgMTAgXTtcclxuY29uc3QgQUNUSVZFX0xFQURFUl9MSU5FU19EQVNIID0gW107XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb21wb25lbnRWZWN0b3JOb2RlIGV4dGVuZHMgUm9vdFZlY3Rvck5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0NvbXBvbmVudFZlY3Rvcn0gY29tcG9uZW50VmVjdG9yIC0gdGhlIGNvbXBvbmVudCB2ZWN0b3IgbW9kZWwgdGhlIG5vZGUgcmVwcmVzZW50c1xyXG4gICAqIEBwYXJhbSB7R3JhcGh9IGdyYXBoIC0gdGhlIGdyYXBoIHRoZSBjb21wb25lbnQgdmVjdG9yIGJlbG9uZ3MgdG9cclxuICAgKiBAcGFyYW0ge0VudW1lcmF0aW9uUHJvcGVydHkuPENvbXBvbmVudFZlY3RvclN0eWxlcz59IGNvbXBvbmVudFN0eWxlUHJvcGVydHlcclxuICAgKiBAcGFyYW0ge0Jvb2xlYW5Qcm9wZXJ0eX0gdmFsdWVzVmlzaWJsZVByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBjb21wb25lbnRWZWN0b3IsIGdyYXBoLCBjb21wb25lbnRTdHlsZVByb3BlcnR5LCB2YWx1ZXNWaXNpYmxlUHJvcGVydHksIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY29tcG9uZW50VmVjdG9yIGluc3RhbmNlb2YgQ29tcG9uZW50VmVjdG9yLCBgaW52YWxpZCBjb21wb25lbnRWZWN0b3I6ICR7Y29tcG9uZW50VmVjdG9yfWAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGdyYXBoIGluc3RhbmNlb2YgR3JhcGgsIGBpbnZhbGlkIGdyYXBoOiAke2dyYXBofWAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbXBvbmVudFN0eWxlUHJvcGVydHkgaW5zdGFuY2VvZiBFbnVtZXJhdGlvblByb3BlcnR5ICYmIENvbXBvbmVudFZlY3RvclN0eWxlcy5lbnVtZXJhdGlvbi5pbmNsdWRlcyggY29tcG9uZW50U3R5bGVQcm9wZXJ0eS52YWx1ZSApLFxyXG4gICAgICBgaW52YWxpZCBjb21wb25lbnRTdHlsZVByb3BlcnR5OiAke2NvbXBvbmVudFN0eWxlUHJvcGVydHl9YCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdmFsdWVzVmlzaWJsZVByb3BlcnR5IGluc3RhbmNlb2YgQm9vbGVhblByb3BlcnR5LCBgaW52YWxpZCB2YWx1ZXNWaXNpYmxlUHJvcGVydHk6ICR7dmFsdWVzVmlzaWJsZVByb3BlcnR5fWAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICFvcHRpb25zIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZiggb3B0aW9ucyApID09PSBPYmplY3QucHJvdG90eXBlLCBgRXh0cmEgcHJvdG90eXBlIG9uIG9wdGlvbnM6ICR7b3B0aW9uc31gICk7XHJcblxyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcblxyXG4gICAgICBhcnJvd1R5cGU6ICdkYXNoZWQnLFxyXG5cclxuICAgICAgLy8ge09iamVjdH0gLSBvcHRpb25zIHBhc3NlZCB0byB0aGUgc3VwZXIgY2xhc3MgdG8gc3R5bGl6ZSB0aGUgYXJyb3dPcHRpb25zLlxyXG4gICAgICBhcnJvd09wdGlvbnM6IG1lcmdlKCB7fSwgVmVjdG9yQWRkaXRpb25Db25zdGFudHMuQ09NUE9ORU5UX1ZFQ1RPUl9BUlJPV19PUFRJT05TLCB7XHJcbiAgICAgICAgZmlsbDogY29tcG9uZW50VmVjdG9yLnZlY3RvckNvbG9yUGFsZXR0ZS5jb21wb25lbnRGaWxsXHJcbiAgICAgIH0gKVxyXG5cclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggY29tcG9uZW50VmVjdG9yLFxyXG4gICAgICBncmFwaC5tb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eSxcclxuICAgICAgdmFsdWVzVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICBncmFwaC5hY3RpdmVWZWN0b3JQcm9wZXJ0eSxcclxuICAgICAgb3B0aW9ucyApO1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgIC8vIENyZWF0ZSBhIHBhdGggdGhhdCByZXByZXNlbnRzIHRoZSBkYXNoZWQgbGluZXMgY29ycmVzcG9uZGluZyB0byB0aGUgUFJPSkVDVElPTiBzdHlsZS5cclxuICAgIC8vIFRoZSBzaGFwZSBvZiB0aGUgcGF0aCB3aWxsIGJlIHVwZGF0ZWQgbGF0ZXIuXHJcblxyXG4gICAgLy8gQHByaXZhdGUge1BhdGh9IGxlYWRlciBsaW5lcywgZGlzcGxheWVkIHdoZW4gY29tcG9uZW50IHZlY3RvcnMgYXJlIHByb2plY3RlZCBvbnRvIGF4ZXNcclxuICAgIHRoaXMubGVhZGVyTGluZXNQYXRoID0gbmV3IFBhdGgoIG5ldyBTaGFwZSgpLCB7XHJcbiAgICAgIGxpbmVXaWR0aDogMC41LFxyXG4gICAgICBsaW5lRGFzaDogTk9OX0FDVElWRV9MRUFERVJfTElORVNfREFTSFxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5sZWFkZXJMaW5lc1BhdGggKTtcclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAgIC8vIENyZWF0ZSBhIG11bHRpbGluayB0byBvYnNlcnZlOlxyXG4gICAgLy8gIC0gY29tcG9uZW50U3R5bGVQcm9wZXJ0eSAtIHRvIGRldGVybWluZSB2aXNpYmlsaXR5IChpLmUuIGNvbXBvbmVudHMgc2hvdWxkbid0IGJlIHZpc2libGUgb24gSU5WSVNJQkxFKVxyXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCB0byBkcmF3IGxpbmVzIG9uIHRoZSBQUk9KRUNUSU9OIGNvbXBvbmVudFN0eWxlXHJcbiAgICAvLyAgLSBpc09uR3JhcGhQcm9wZXJ0eSAtIGNvbXBvbmVudHMgc2hvdWxkbid0IGJlIHZpc2libGUgaWYgdGhlIHZlY3RvciBpc24ndCBvbiB0aGUgZ3JhcGhcclxuICAgIC8vICAtIHZlY3RvckNvbXBvbmVudHNQcm9wZXJ0eSAtIHRvIHVwZGF0ZSB0aGUgbGVhZGVyIGxpbmVzIGRyYXdpbmdzIHBvc2l0aW9uc1xyXG4gICAgLy9cclxuICAgIC8vIHVubXVsdGlsaW5rIGlzIHJlcXVpcmVkIG9uIGRpc3Bvc2UuXHJcbiAgICAvL1xyXG4gICAgLy8gQHByaXZhdGUge011bHRpbGlua30gY29tcG9uZW50VmVjdG9yTXVsdGlsaW5rXHJcbiAgICB0aGlzLmNvbXBvbmVudFZlY3Rvck11bHRpbGluayA9IE11bHRpbGluay5tdWx0aWxpbmsoXHJcbiAgICAgIFsgY29tcG9uZW50U3R5bGVQcm9wZXJ0eSwgY29tcG9uZW50VmVjdG9yLmlzUGFyZW50VmVjdG9yQWN0aXZlUHJvcGVydHksXHJcbiAgICAgICAgY29tcG9uZW50VmVjdG9yLmlzT25HcmFwaFByb3BlcnR5LCBjb21wb25lbnRWZWN0b3IudmVjdG9yQ29tcG9uZW50c1Byb3BlcnR5IF0sXHJcbiAgICAgICggY29tcG9uZW50U3R5bGUsIGlzUGFyZW50QWN0aXZlICkgPT4ge1xyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZUNvbXBvbmVudFZlY3RvciggY29tcG9uZW50VmVjdG9yLFxyXG4gICAgICAgICAgZ3JhcGgubW9kZWxWaWV3VHJhbnNmb3JtUHJvcGVydHkudmFsdWUsXHJcbiAgICAgICAgICBjb21wb25lbnRTdHlsZSxcclxuICAgICAgICAgIGlzUGFyZW50QWN0aXZlICk7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBIaWdobGlnaHQgdGhlIGNvbXBvbmVudCB2ZWN0b3IncyBsYWJlbCB3aGVuIGl0cyBwYXJlbnQgdmVjdG9yIGlzIHNlbGVjdGVkLlxyXG4gICAgLy8gdW5saW5rIGlzIHJlcXVpcmVkIG9uIGRpc3Bvc2UuXHJcbiAgICBjb25zdCBhY3RpdmVWZWN0b3JMaXN0ZW5lciA9IGFjdGl2ZVZlY3RvciA9PiB7XHJcbiAgICAgIHRoaXMubGFiZWxOb2RlLnNldEhpZ2hsaWdodGVkKCBhY3RpdmVWZWN0b3IgPT09IGNvbXBvbmVudFZlY3Rvci5wYXJlbnRWZWN0b3IgKTtcclxuICAgIH07XHJcbiAgICBncmFwaC5hY3RpdmVWZWN0b3JQcm9wZXJ0eS5saW5rKCBhY3RpdmVWZWN0b3JMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlXHJcbiAgICB0aGlzLmRpc3Bvc2VDb21wb25lbnRWZWN0b3JOb2RlID0gKCkgPT4ge1xyXG4gICAgICBNdWx0aWxpbmsudW5tdWx0aWxpbmsoIHRoaXMuY29tcG9uZW50VmVjdG9yTXVsdGlsaW5rICk7XHJcbiAgICAgIGdyYXBoLmFjdGl2ZVZlY3RvclByb3BlcnR5LnVubGluayggYWN0aXZlVmVjdG9yTGlzdGVuZXIgKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIHRoaXMuZGlzcG9zZUNvbXBvbmVudFZlY3Rvck5vZGUoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZXMgdGhlIGNvbXBvbmVudCB2ZWN0b3Igbm9kZTpcclxuICAgKiAgLSBEcmF3cyBsZWFkZXIgbGluZXMgd2hlbiBjb21wb25lbnRTdHlsZSBpcyBPTl9BWElTXHJcbiAgICogIC0gRGV0ZXJtaW5lcyB2aXNpYmlsaXR5IChpLmUuIGNvbXBvbmVudHMgc2hvdWxkbid0IGJlIHZpc2libGUgb24gSU5WSVNJQkxFKVxyXG4gICAqIEBwcm90ZWN0ZWRcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Q29tcG9uZW50VmVjdG9yfSBjb21wb25lbnRWZWN0b3JcclxuICAgKiBAcGFyYW0ge01vZGVsVmlld1RyYW5zZm9ybTJ9IG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAqIEBwYXJhbSB7Q29tcG9uZW50VmVjdG9yU3R5bGVzfSBjb21wb25lbnRTdHlsZVxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNQYXJlbnRBY3RpdmVcclxuICAgKi9cclxuICB1cGRhdGVDb21wb25lbnRWZWN0b3IoIGNvbXBvbmVudFZlY3RvciwgbW9kZWxWaWV3VHJhbnNmb3JtLCBjb21wb25lbnRTdHlsZSwgaXNQYXJlbnRBY3RpdmUgKSB7XHJcblxyXG4gICAgLy8gQ29tcG9uZW50IHZlY3RvcnMgYXJlIHZpc2libGUgd2hlbiBpdCBpc24ndCBJTlZJU0lCTEUgYW5kIGl0IGlzIG9uIHRoZSBncmFwaC5cclxuICAgIHRoaXMudmlzaWJsZSA9IGNvbXBvbmVudFZlY3Rvci5pc09uR3JhcGhQcm9wZXJ0eS52YWx1ZSAmJlxyXG4gICAgICAgICAgICAgICAgICAgY29tcG9uZW50U3R5bGUgIT09IENvbXBvbmVudFZlY3RvclN0eWxlcy5JTlZJU0lCTEU7XHJcblxyXG4gICAgaWYgKCBjb21wb25lbnRTdHlsZSA9PT0gQ29tcG9uZW50VmVjdG9yU3R5bGVzLlBST0pFQ1RJT04gKSB7XHJcbiAgICAgIHRoaXMubGFiZWxOb2RlLnZpc2libGUgPSAoIGNvbXBvbmVudFZlY3Rvci5tYWduaXR1ZGUgIT09IDAgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG5cclxuICAgICAgLy8gSGlkZSB0aGUgbGFiZWwgaWYgZWl0aGVyIG9mIHRoZSBwYXJlbnQgdmVjdG9yJ3MgY29tcG9uZW50cyBpcyB6ZXJvLFxyXG4gICAgICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3ZlY3Rvci1hZGRpdGlvbi9pc3N1ZXMvMjY0XHJcbiAgICAgIHRoaXMubGFiZWxOb2RlLnZpc2libGUgPSAhY29tcG9uZW50VmVjdG9yLnBhcmVudFZlY3Rvci5oYXNaZXJvQ29tcG9uZW50KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTGVhZGVyIGxpbmVzIGFyZSBvbmx5IHZpc2libGUgd2hlbiBjb21wb25lbnQgdmVjdG9ycyBhcmUgcHJvamVjdGVkIG9udG8gYXhlc1xyXG4gICAgdGhpcy5sZWFkZXJMaW5lc1BhdGgudmlzaWJsZSA9ICggY29tcG9uZW50U3R5bGUgPT09IENvbXBvbmVudFZlY3RvclN0eWxlcy5QUk9KRUNUSU9OICk7XHJcblxyXG4gICAgLy8gVXBkYXRlIGxlYWRlciBsaW5lcyBvbmx5IGlmIHRoZXkgYXJlIHZpc2libGUgKHdpdGggUFJPSkVDVElPTiBzdHlsZSlcclxuICAgIGlmICggdGhpcy5sZWFkZXJMaW5lc1BhdGgudmlzaWJsZSApIHtcclxuXHJcbiAgICAgIC8vIFNpbmNlIHRoZSBsZWFkZXIgbGluZXMgYXJlIGEgY2hpbGQgb2YgdGhpcyB2aWV3LCB0aGUgb3JpZ2luIG9mIHRoZSB2aWV3IGlzIGF0IHRoZSB0YWlsIG9mIHRoZSBjb21wb25lbnRcclxuICAgICAgLy8gdmVjdG9yLiBHZXQgdGhlIHRpcCBwb3NpdGlvbiByZWxhdGl2ZSB0byB0aGUgdGFpbCBvZiB0aGUgY29tcG9uZW50IHZlY3RvciAod2hpY2ggaXMgdGhlIGNvbXBvbmVudHMpXHJcbiAgICAgIGNvbnN0IHRpcFBvc2l0aW9uID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGEoIGNvbXBvbmVudFZlY3Rvci52ZWN0b3JDb21wb25lbnRzICk7XHJcblxyXG4gICAgICAvLyBHZXQgdGhlIHBhcmVudCB0YWlsIHBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZSBvcmlnaW4gb2YgdGhlIHZpZXcgKHRoZSB0YWlsIG9mIHRoZSBjb21wb25lbnQgdmVjdG9yKVxyXG4gICAgICBjb25zdCBwYXJlbnRUYWlsUG9zaXRpb24gPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YSggY29tcG9uZW50VmVjdG9yLnBhcmVudFRhaWxcclxuICAgICAgICAubWludXMoIGNvbXBvbmVudFZlY3Rvci50YWlsICkgKTtcclxuXHJcbiAgICAgIC8vIEdldCB0aGUgcGFyZW50IHRpcCBwb3NpdGlvbiByZWxhdGl2ZSB0byB0aGUgb3JpZ2luIG9mIHRoZSB2aWV3ICh0aGUgdGFpbCBvZiB0aGUgY29tcG9uZW50IHZlY3RvcilcclxuICAgICAgY29uc3QgcGFyZW50VGlwUG9zaXRpb24gPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YSggY29tcG9uZW50VmVjdG9yLnBhcmVudFRpcFxyXG4gICAgICAgIC5taW51cyggY29tcG9uZW50VmVjdG9yLnRhaWwgKSApO1xyXG5cclxuICAgICAgLy8gQ3JlYXRlIG5ldyBzaGFwZSBmb3IgdGhlIGxlYWRlciBsaW5lc1xyXG4gICAgICB0aGlzLmxlYWRlckxpbmVzUGF0aC5zaGFwZSA9IG5ldyBTaGFwZSgpXHJcbiAgICAgICAgLm1vdmVUb1BvaW50KCBWZWN0b3IyLlpFUk8gKVxyXG4gICAgICAgIC5saW5lVG9Qb2ludCggcGFyZW50VGFpbFBvc2l0aW9uIClcclxuICAgICAgICAubW92ZVRvUG9pbnQoIHRpcFBvc2l0aW9uIClcclxuICAgICAgICAubGluZVRvUG9pbnQoIHBhcmVudFRpcFBvc2l0aW9uICk7XHJcblxyXG4gICAgICBpZiAoIGlzUGFyZW50QWN0aXZlICkge1xyXG4gICAgICAgIHRoaXMubGVhZGVyTGluZXNQYXRoLnN0cm9rZSA9IFZlY3RvckFkZGl0aW9uQ29sb3JzLkxFQURFUl9MSU5FU19BQ1RJVkVfU1RST0tFO1xyXG4gICAgICAgIHRoaXMubGVhZGVyTGluZXNQYXRoLmxpbmVEYXNoID0gQUNUSVZFX0xFQURFUl9MSU5FU19EQVNIO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMubGVhZGVyTGluZXNQYXRoLnN0cm9rZSA9IFZlY3RvckFkZGl0aW9uQ29sb3JzLkxFQURFUl9MSU5FU19OT05fQUNUSVZFX1NUUk9LRTtcclxuICAgICAgICB0aGlzLmxlYWRlckxpbmVzUGF0aC5saW5lRGFzaCA9IE5PTl9BQ1RJVkVfTEVBREVSX0xJTkVTX0RBU0g7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZXMgdGhlIGxhYmVsIHBvc2l0aW9uaW5nIG9mIHRoZSB2ZWN0b3IgY29tcG9uZW50LiBWZWN0b3IgY29tcG9uZW50cyBoYXZlIGEgdW5pcXVlIGxhYmVsIHBvc2l0aW9uaW5nLlxyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqIEBwcm90ZWN0ZWRcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Q29tcG9uZW50VmVjdG9yfSBjb21wb25lbnRWZWN0b3JcclxuICAgKiBAcGFyYW0ge01vZGVsVmlld1RyYW5zZm9ybTJ9IG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWVzVmlzaWJsZVxyXG4gICAqL1xyXG4gIHVwZGF0ZUxhYmVsUG9zaXRpb25pbmcoIGNvbXBvbmVudFZlY3RvciwgbW9kZWxWaWV3VHJhbnNmb3JtLCB2YWx1ZXNWaXNpYmxlICkge1xyXG5cclxuICAgIC8vIElmIHRoZSBtYWduaXR1ZGUgb2YgdGhlIGNvbXBvbmVudFZlY3RvciBpcyAwLCB0aGVuIHBvc2l0aW9uIHRoZSBsYWJlbCBub2RlIG9uIHRoZSAndGFpbCdcclxuICAgIGlmICggY29tcG9uZW50VmVjdG9yLm1hZ25pdHVkZSA9PT0gMCApIHtcclxuICAgICAgdGhpcy5sYWJlbE5vZGUuY2VudGVyID0gVmVjdG9yMi5aRVJPO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRmxhZyB0byBpbmRpY2F0ZSB0aGUgbGFiZWwgb2Zmc2V0IHRyYW5zbGF0aW9uLlxyXG4gICAgY29uc3QgbGFiZWxPZmZzZXQgPSBuZXcgVmVjdG9yMiggMCwgMCApO1xyXG5cclxuICAgIC8vIENvbnZlbmllbmNlIHZhcmlhYmxlc1xyXG4gICAgY29uc3QgY29tcG9uZW50TWlkUG9pbnQgPSBjb21wb25lbnRWZWN0b3IubWlkUG9pbnQ7XHJcbiAgICBjb25zdCBwYXJlbnRNaWRQb2ludCA9IGNvbXBvbmVudFZlY3Rvci5wYXJlbnRNaWRQb2ludDtcclxuXHJcbiAgICBpZiAoIGNvbXBvbmVudFZlY3Rvci5jb21wb25lbnRUeXBlID09PSBDb21wb25lbnRWZWN0b3JUeXBlcy5YX0NPTVBPTkVOVCApIHtcclxuXHJcbiAgICAgIC8vIEdldCB0aGUgbGFiZWwgaGVpZ2h0LiBOZWdhdGl2ZSBzaW5jZSB0aGUgeSBheGlzIGlzIGludmVydGVkIGluIHRoZSB2aWV3XHJcbiAgICAgIGNvbnN0IGxhYmVsSGVpZ2h0ID0gbW9kZWxWaWV3VHJhbnNmb3JtLnZpZXdUb01vZGVsRGVsdGFZKCAtdGhpcy5sYWJlbE5vZGUuaGVpZ2h0ICk7XHJcblxyXG4gICAgICAvLyBJZiB0aGUgY29tcG9uZW50IGlzIGJlbG93IHRoZSBwYXJlbnQsIHBvc2l0aW9uIHRoZSBsYWJlbCBiZWxvdywgb3RoZXJ3aXNlIHBvc2l0aW9uIGl0IGFib3ZlXHJcbiAgICAgIGlmICggY29tcG9uZW50TWlkUG9pbnQueSA8PSBwYXJlbnRNaWRQb2ludC55ICkge1xyXG4gICAgICAgIGxhYmVsT2Zmc2V0LnNldFhZKCAwLCAtQ09NUE9ORU5UX0xBQkVMX09GRlNFVCAtIGxhYmVsSGVpZ2h0IC8gMiApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGxhYmVsT2Zmc2V0LnNldFhZKCAwLCBDT01QT05FTlRfTEFCRUxfT0ZGU0VUICsgbGFiZWxIZWlnaHQgLyAyICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBjb21wb25lbnRWZWN0b3IuY29tcG9uZW50VHlwZSA9PT0gQ29tcG9uZW50VmVjdG9yVHlwZXMuWV9DT01QT05FTlQgKSB7XHJcblxyXG4gICAgICBjb25zdCBsYWJlbFdpZHRoID0gbW9kZWxWaWV3VHJhbnNmb3JtLnZpZXdUb01vZGVsRGVsdGFYKCB0aGlzLmxhYmVsTm9kZS53aWR0aCApO1xyXG5cclxuICAgICAgLy8gSWYgdGhlIGNvbXBvbmVudCBpcyB0byB0aGUgbGVmdCBvZiB0aGUgcGFyZW50LCBwb3NpdGlvbiB0aGUgbGFiZWwgdG8gdGhlIGxlZnQsIG90aGVyd2lzZSB0byB0aGUgcmlnaHRcclxuICAgICAgaWYgKCBjb21wb25lbnRNaWRQb2ludC54IDwgcGFyZW50TWlkUG9pbnQueCApIHtcclxuICAgICAgICBsYWJlbE9mZnNldC5zZXRYWSggLUNPTVBPTkVOVF9MQUJFTF9PRkZTRVQgLSBsYWJlbFdpZHRoIC8gMiwgMCApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGxhYmVsT2Zmc2V0LnNldFhZKCBDT01QT05FTlRfTEFCRUxfT0ZGU0VUICsgbGFiZWxXaWR0aCAvIDIsIDAgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFBvc2l0aW9uIHRoZSBsYWJlbFxyXG4gICAgdGhpcy5sYWJlbE5vZGUuY2VudGVyID0gUm9vdFZlY3Rvck5vZGUuY29tcHV0ZUxhYmVsQ2VudGVyKCBjb21wb25lbnRWZWN0b3IsIG1vZGVsVmlld1RyYW5zZm9ybSwgbGFiZWxPZmZzZXQgKTtcclxuICB9XHJcbn1cclxuXHJcbnZlY3RvckFkZGl0aW9uLnJlZ2lzdGVyKCAnQ29tcG9uZW50VmVjdG9yTm9kZScsIENvbXBvbmVudFZlY3Rvck5vZGUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxtQkFBbUIsTUFBTSw0Q0FBNEM7QUFDNUUsT0FBT0MsU0FBUyxNQUFNLGtDQUFrQztBQUN4RCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDdEQsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxTQUFTQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ3hELE9BQU9DLGNBQWMsTUFBTSx5QkFBeUI7QUFDcEQsT0FBT0MsZUFBZSxNQUFNLDZCQUE2QjtBQUN6RCxPQUFPQyxxQkFBcUIsTUFBTSxtQ0FBbUM7QUFDckUsT0FBT0Msb0JBQW9CLE1B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