// Copyright 2017-2023, University of Colorado Boulder

/**
 * Panel for sliders, readouts and adjacent text
 * @author Vasily Shakhov (Mlearner)
 * @author Anton Ulyanov (Mlearner)
 * @author John Blanco (PhET Interactive Simulations)
 */

import Utils from '../../../../dot/js/Utils.js';
import merge from '../../../../phet-core/js/merge.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import SceneryPhetStrings from '../../../../scenery-phet/js/SceneryPhetStrings.js';
import { Node, Text } from '../../../../scenery/js/imports.js';
import Panel from '../../../../sun/js/Panel.js';
import soundManager from '../../../../tambo/js/soundManager.js';
import Utterance from '../../../../utterance-queue/js/Utterance.js';
import resistanceInAWire from '../../resistanceInAWire.js';
import ResistanceInAWireStrings from '../../ResistanceInAWireStrings.js';
import ResistanceInAWireModel from '../model/ResistanceInAWireModel.js';
import ResistanceInAWireConstants from '../ResistanceInAWireConstants.js';
import ResistanceSoundGenerator from './ResistanceSoundGenerator.js';
import SliderUnit from './SliderUnit.js';
const areaString = ResistanceInAWireStrings.area;
const areaSymbolString = ResistanceInAWireStrings.areaSymbol;
const cmString = ResistanceInAWireStrings.cm;
const lengthString = ResistanceInAWireStrings.length;
const lengthSymbolString = ResistanceInAWireStrings.lengthSymbol;
const ohmString = ResistanceInAWireStrings.ohm;
const pattern0Label1Value2UnitsString = ResistanceInAWireStrings.pattern['0label']['1value']['2units'];
const pattern0ResistanceUnits1LengthUnitsString = ResistanceInAWireStrings.pattern['0resistanceUnits']['1lengthUnits'];
const resistanceString = ResistanceInAWireStrings.resistance;
const resistivityString = ResistanceInAWireStrings.resistivity;
const symbolOhmsStringProperty = SceneryPhetStrings.symbol.ohmsStringProperty;
const symbolResistivityStringProperty = SceneryPhetStrings.symbol.resistivityStringProperty;
const resistivityUnitsPatternString = ResistanceInAWireStrings.a11y.wire.resistivityUnitsPattern;
const lengthUnitsPatternString = ResistanceInAWireStrings.a11y.controls.lengthUnitsPattern;
const areaUnitsPatternString = ResistanceInAWireStrings.a11y.controls.areaUnitsPattern;
const resistivitySliderLabelString = ResistanceInAWireStrings.a11y.controls.resistivitySliderLabel;
const lengthSliderLabelString = ResistanceInAWireStrings.a11y.controls.lengthSliderLabel;
const areaSliderLabelString = ResistanceInAWireStrings.a11y.controls.areaSliderLabel;
const sliderControlsString = ResistanceInAWireStrings.a11y.controls.sliderControls;
const slidersDescriptionString = ResistanceInAWireStrings.a11y.controls.slidersDescription;
const sizeChangeAlertPatternString = ResistanceInAWireStrings.a11y.controls.sizeChangeAlertPattern;
const letterRhoString = ResistanceInAWireStrings.a11y.controls.letterRho;
const letterLString = ResistanceInAWireStrings.a11y.controls.letterL;
const letterAString = ResistanceInAWireStrings.a11y.controls.letterA;
const growsString = ResistanceInAWireStrings.a11y.equation.alerts.grows;
const shrinksString = ResistanceInAWireStrings.a11y.equation.alerts.shrinks;
const growsALotString = ResistanceInAWireStrings.a11y.equation.alerts.growsALot;
const shrinksALotString = ResistanceInAWireStrings.a11y.equation.alerts.shrinksALot;

// constants
const SLIDER_SPACING = 50;

// pdom - if resistance changes 2 * the range of the resistance / the number of relative size descriptions, larger change
// is signified in description
const LARGE_RESISTANCE_DELTA = (ResistanceInAWireModel.getResistanceRange().max - ResistanceInAWireModel.getResistanceRange().min) / ResistanceInAWireConstants.RELATIVE_SIZE_STRINGS.length * 2;
class ControlPanel extends Panel {
  /**
   * @param {ResistanceInAWireModel} model
   * @param {Tandem} tandem
   * @param {Object} [options]
   */
  constructor(model, tandem, options) {
    options = merge({
      xMargin: 30,
      yMargin: 20,
      lineWidth: 3,
      resize: false,
      tandem: tandem,
      preventFit: true,
      // pdom
      tagName: 'ul',
      labelTagName: 'h3',
      labelContent: sliderControlsString,
      descriptionContent: slidersDescriptionString
    }, options);

    // Add the dynamic title that indicates the resistance.
    const resistanceText = new Text('', {
      font: ResistanceInAWireConstants.READOUT_FONT,
      fill: ResistanceInAWireConstants.RED_COLOR,
      maxWidth: ResistanceInAWireConstants.SLIDER_WIDTH * 4.7,
      tandem: tandem.createTandem('resistanceText')
    });

    // Set the resistance readout to its initial value, then set the position.  Previously, the readout position was
    // re-centered every time the resistance changed, but it was decided that this looked too jumpy, so now it's
    // positioned only once, see https://github.com/phetsims/resistance-in-a-wire/issues/181.
    resistanceText.string = getResistanceReadoutText(model.resistanceProperty.value);
    resistanceText.centerX = 0;

    // Update the resistance readout when the resistance changes.
    model.resistanceProperty.link(resistance => {
      resistanceText.string = getResistanceReadoutText(resistance);
    });

    // pdom - when using a slider, we store the initial value on start drag so that we can describe size change after
    // interaction
    let resistanceOnStart = model.resistanceProperty.get();

    // pdom - an utterance for whenever physical values change
    const changeUtterance = new Utterance();

    // Create and add the resistivity slider with readout and labels.
    let rhoOnStart = model.resistivityProperty.get();
    const resistivitySlider = new SliderUnit(model.resistivityProperty, ResistanceInAWireConstants.RESISTIVITY_RANGE, symbolResistivityStringProperty, resistivityString, StringUtils.format(pattern0ResistanceUnits1LengthUnitsString, symbolOhmsStringProperty, cmString), resistivitySliderLabelString, tandem.createTandem('resistivitySlider'), {
      startDrag: () => {
        rhoOnStart = model.resistivityProperty.get();
        resistanceOnStart = model.resistanceProperty.get();
      },
      endDrag: () => {
        const resistance = model.resistanceProperty.get();
        const deltaRho = model.resistivityProperty.get() - rhoOnStart;
        const deltaResistance = resistance - resistanceOnStart;

        // announce to assistive technology if there is a change - no need to queue many alerts when pressing keys
        // rapidly
        if (deltaRho && deltaResistance) {
          changeUtterance.alert = getSizeChangeAlert(resistance, deltaResistance, deltaRho, letterRhoString);
          resistivitySlider.alertDescriptionUtterance(changeUtterance);
        }
      },
      sliderOptions: {
        keyboardStep: 0.05,
        // ohm-cm
        a11yCreateAriaValueText: value => StringUtils.fillIn(resistivityUnitsPatternString, {
          value: value
        })
      }
    });

    // Create and add the length slider with readout and labels.
    let lengthOnStart = model.lengthProperty.get();
    const lengthSlider = new SliderUnit(model.lengthProperty, ResistanceInAWireConstants.LENGTH_RANGE, lengthSymbolString, lengthString, cmString, lengthSliderLabelString, tandem.createTandem('lengthSlider'), {
      startDrag: () => {
        lengthOnStart = model.lengthProperty.get();
        resistanceOnStart = model.resistanceProperty.get();
      },
      endDrag: () => {
        const resistance = model.resistanceProperty.get();
        const deltaLength = model.lengthProperty.get() - lengthOnStart;
        const deltaResistance = resistance - resistanceOnStart;

        // announce to assistive technology if there is a change - no need to queue many alerts when pressing keys
        // rapidly
        if (deltaLength && deltaResistance) {
          changeUtterance.alert = getSizeChangeAlert(resistance, deltaResistance, deltaLength, letterLString);
          lengthSlider.alertDescriptionUtterance(changeUtterance);
        }
      },
      sliderOptions: {
        a11yCreateAriaValueText: value => StringUtils.fillIn(lengthUnitsPatternString, {
          value: value
        })
      }
    });

    // Create and add the area slider with readout and labels. For keyboard dragging, the range ranges doesn't split into even steps,
    // so we calculate a keyboard step by breaking the range into 100.
    let areaOnStart = model.areaProperty.get();
    const areaSlider = new SliderUnit(model.areaProperty, ResistanceInAWireConstants.AREA_RANGE, areaSymbolString, areaString, `${cmString}<sup>2</sup>`, areaSliderLabelString, tandem.createTandem('areaSlider'), {
      startDrag: () => {
        areaOnStart = model.areaProperty.get();
        resistanceOnStart = model.resistanceProperty.get();
      },
      endDrag: () => {
        const resistance = model.resistanceProperty.get();
        const deltaArea = model.areaProperty.get() - areaOnStart;
        const deltaResistance = resistance - resistanceOnStart;

        // announce to assistive technology if there is a change - no need to queue many alerts when pressing keys
        // rapidly
        if (deltaArea && deltaResistance) {
          changeUtterance.alert = getSizeChangeAlert(resistance, deltaResistance, deltaArea, letterAString);
          areaSlider.alertDescriptionUtterance(changeUtterance);
        }
      },
      sliderOptions: {
        a11yCreateAriaValueText: value => StringUtils.fillIn(areaUnitsPatternString, {
          value: value
        })
      }
    });
    const sliders = new Node({
      children: [resistivitySlider, lengthSlider, areaSlider]
    });

    // add the sound generator for the resistance level
    soundManager.addSoundGenerator(new ResistanceSoundGenerator({
      resistanceProperty: model.resistanceProperty,
      resistivityProperty: model.resistivityProperty,
      resistivitySlider: resistivitySlider,
      lengthProperty: model.lengthProperty,
      lengthSlider: lengthSlider,
      areaProperty: model.areaProperty,
      areaSlider: areaSlider,
      resetInProgressProperty: model.resetInProgressProperty
    }));

    // layout for the panel, HBox cannot be used because 'bottom' alignment cannot align RichText in SliderUnit
    lengthSlider.left = resistivitySlider.right + SLIDER_SPACING;
    areaSlider.left = lengthSlider.right + SLIDER_SPACING;
    sliders.centerX = 0;
    resistanceText.bottom = sliders.top - 12;

    // Because ControlPanel extends Panel, it needs pass a content node into its constructor to surround.
    // Add everything to the content node, then pass content to the Panel.call().
    const content = new Node({
      children: [resistanceText, sliders],
      tandem: tandem.createTandem('content')
    });
    super(content, options);
  }
}

/**
 * Get a description for whether a letter grows or shrinks. Optionally, if the size changes enough, an additional
 * fragment is included that signifies this. Will return something like
 *
 * 'grows'
 * 'shrinks'
 * 'grows a lot'
 * 'shrinks a lot'
 *
 * @param {number} delta
 * @param {boolean} describeLargeChanges
 * @returns {string}
 */
function getSizeChangeFromDelta(delta, describeLargeChanges) {
  assert && assert(delta !== 0, 'trying to describe no change in size');
  let description;
  const useALot = describeLargeChanges && Math.abs(delta) > LARGE_RESISTANCE_DELTA;
  if (delta > 0) {
    description = useALot ? growsALotString : growsString;
  } else if (delta < 0) {
    description = useALot ? shrinksALotString : shrinksString;
  }
  return description;
}

/**
 * Get a full alert for size letter size and how R changes as well. Will return something like
 *
 * "As letter rho grows, letter R grows. Resistance no 0.667 ohms." or
 * "As letter A grows, letter R shrinks a lot. Resistance now 1.20 ohms"
 *
 * @param {number} resistance - current value of resistance
 * @param {number} deltaResistance - change in
 * @param {number} otherDelta - change in other variable, resistivity, length, or area
 * @param {string} letterString - the letter with size changes to describe
 * @returns {string}
 */
function getSizeChangeAlert(resistance, deltaResistance, otherDelta, letterString) {
  const resistanceChangeString = getSizeChangeFromDelta(deltaResistance, true /* include 'a lot' */);
  const letterChangeString = getSizeChangeFromDelta(otherDelta, false /* don't include 'a lot */);

  return StringUtils.fillIn(sizeChangeAlertPatternString, {
    letter: letterString,
    letterChange: letterChangeString,
    rChange: resistanceChangeString,
    resistance: ResistanceInAWireConstants.getFormattedResistanceValue(resistance)
  });
}

/**
 * get the string that should be shown on the resistance readout for a given resistance value
 * @param {number} resistance
 * @returns {string}
 */
function getResistanceReadoutText(resistance) {
  // the number of digits shown varies based on the range
  const numDecimalDigits = resistance >= 100 ? 0 :
  // Over 100, show no decimal points, like 102
  resistance >= 10 ? 1 :
  // between 10.0 and 99.9, show 2 decimal points
  resistance < 0.001 ? 4 :
  // when less than 0.001, show 4 decimals, see #125
  resistance < 1 ? 3 :
  // when less than 1, show 3 decimal places, see #125
  2; // Numbers less than 10 show 2 decimal points, like 8.35

  return StringUtils.format(pattern0Label1Value2UnitsString, resistanceString, Utils.toFixed(resistance, numDecimalDigits), ohmString);
}
resistanceInAWire.register('ControlPanel', ControlPanel);
export default ControlPanel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIm1lcmdlIiwiU3RyaW5nVXRpbHMiLCJTY2VuZXJ5UGhldFN0cmluZ3MiLCJOb2RlIiwiVGV4dCIsIlBhbmVsIiwic291bmRNYW5hZ2VyIiwiVXR0ZXJhbmNlIiwicmVzaXN0YW5jZUluQVdpcmUiLCJSZXNpc3RhbmNlSW5BV2lyZVN0cmluZ3MiLCJSZXNpc3RhbmNlSW5BV2lyZU1vZGVsIiwiUmVzaXN0YW5jZUluQVdpcmVDb25zdGFudHMiLCJSZXNpc3RhbmNlU291bmRHZW5lcmF0b3IiLCJTbGlkZXJVbml0IiwiYXJlYVN0cmluZyIsImFyZWEiLCJhcmVhU3ltYm9sU3RyaW5nIiwiYXJlYVN5bWJvbCIsImNtU3RyaW5nIiwiY20iLCJsZW5ndGhTdHJpbmciLCJsZW5ndGgiLCJsZW5ndGhTeW1ib2xTdHJpbmciLCJsZW5ndGhTeW1ib2wiLCJvaG1TdHJpbmciLCJvaG0iLCJwYXR0ZXJuMExhYmVsMVZhbHVlMlVuaXRzU3RyaW5nIiwicGF0dGVybiIsInBhdHRlcm4wUmVzaXN0YW5jZVVuaXRzMUxlbmd0aFVuaXRzU3RyaW5nIiwicmVzaXN0YW5jZVN0cmluZyIsInJlc2lzdGFuY2UiLCJyZXNpc3Rpdml0eVN0cmluZyIsInJlc2lzdGl2aXR5Iiwic3ltYm9sT2htc1N0cmluZ1Byb3BlcnR5Iiwic3ltYm9sIiwib2htc1N0cmluZ1Byb3BlcnR5Iiwic3ltYm9sUmVzaXN0aXZpdHlTdHJpbmdQcm9wZXJ0eSIsInJlc2lzdGl2aXR5U3RyaW5nUHJvcGVydHkiLCJyZXNpc3Rpdml0eVVuaXRzUGF0dGVyblN0cmluZyIsImExMXkiLCJ3aXJlIiwicmVzaXN0aXZpdHlVbml0c1BhdHRlcm4iLCJsZW5ndGhVbml0c1BhdHRlcm5TdHJpbmciLCJjb250cm9scyIsImxlbmd0aFVuaXRzUGF0dGVybiIsImFyZWFVbml0c1BhdHRlcm5TdHJpbmciLCJhcmVhVW5pdHNQYXR0ZXJuIiwicmVzaXN0aXZpdHlTbGlkZXJMYWJlbFN0cmluZyIsInJlc2lzdGl2aXR5U2xpZGVyTGFiZWwiLCJsZW5ndGhTbGlkZXJMYWJlbFN0cmluZyIsImxlbmd0aFNsaWRlckxhYmVsIiwiYXJlYVNsaWRlckxhYmVsU3RyaW5nIiwiYXJlYVNsaWRlckxhYmVsIiwic2xpZGVyQ29udHJvbHNTdHJpbmciLCJzbGlkZXJDb250cm9scyIsInNsaWRlcnNEZXNjcmlwdGlvblN0cmluZyIsInNsaWRlcnNEZXNjcmlwdGlvbiIsInNpemVDaGFuZ2VBbGVydFBhdHRlcm5TdHJpbmciLCJzaXplQ2hhbmdlQWxlcnRQYXR0ZXJuIiwibGV0dGVyUmhvU3RyaW5nIiwibGV0dGVyUmhvIiwibGV0dGVyTFN0cmluZyIsImxldHRlckwiLCJsZXR0ZXJBU3RyaW5nIiwibGV0dGVyQSIsImdyb3dzU3RyaW5nIiwiZXF1YXRpb24iLCJhbGVydHMiLCJncm93cyIsInNocmlua3NTdHJpbmciLCJzaHJpbmtzIiwiZ3Jvd3NBTG90U3RyaW5nIiwiZ3Jvd3NBTG90Iiwic2hyaW5rc0FMb3RTdHJpbmciLCJzaHJpbmtzQUxvdCIsIlNMSURFUl9TUEFDSU5HIiwiTEFSR0VfUkVTSVNUQU5DRV9ERUxUQSIsImdldFJlc2lzdGFuY2VSYW5nZSIsIm1heCIsIm1pbiIsIlJFTEFUSVZFX1NJWkVfU1RSSU5HUyIsIkNvbnRyb2xQYW5lbCIsImNvbnN0cnVjdG9yIiwibW9kZWwiLCJ0YW5kZW0iLCJvcHRpb25zIiwieE1hcmdpbiIsInlNYXJnaW4iLCJsaW5lV2lkdGgiLCJyZXNpemUiLCJwcmV2ZW50Rml0IiwidGFnTmFtZSIsImxhYmVsVGFnTmFtZSIsImxhYmVsQ29udGVudCIsImRlc2NyaXB0aW9uQ29udGVudCIsInJlc2lzdGFuY2VUZXh0IiwiZm9udCIsIlJFQURPVVRfRk9OVCIsImZpbGwiLCJSRURfQ09MT1IiLCJtYXhXaWR0aCIsIlNMSURFUl9XSURUSCIsImNyZWF0ZVRhbmRlbSIsInN0cmluZyIsImdldFJlc2lzdGFuY2VSZWFkb3V0VGV4dCIsInJlc2lzdGFuY2VQcm9wZXJ0eSIsInZhbHVlIiwiY2VudGVyWCIsImxpbmsiLCJyZXNpc3RhbmNlT25TdGFydCIsImdldCIsImNoYW5nZVV0dGVyYW5jZSIsInJob09uU3RhcnQiLCJyZXNpc3Rpdml0eVByb3BlcnR5IiwicmVzaXN0aXZpdHlTbGlkZXIiLCJSRVNJU1RJVklUWV9SQU5HRSIsImZvcm1hdCIsInN0YXJ0RHJhZyIsImVuZERyYWciLCJkZWx0YVJobyIsImRlbHRhUmVzaXN0YW5jZSIsImFsZXJ0IiwiZ2V0U2l6ZUNoYW5nZUFsZXJ0IiwiYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSIsInNsaWRlck9wdGlvbnMiLCJrZXlib2FyZFN0ZXAiLCJhMTF5Q3JlYXRlQXJpYVZhbHVlVGV4dCIsImZpbGxJbiIsImxlbmd0aE9uU3RhcnQiLCJsZW5ndGhQcm9wZXJ0eSIsImxlbmd0aFNsaWRlciIsIkxFTkdUSF9SQU5HRSIsImRlbHRhTGVuZ3RoIiwiYXJlYU9uU3RhcnQiLCJhcmVhUHJvcGVydHkiLCJhcmVhU2xpZGVyIiwiQVJFQV9SQU5HRSIsImRlbHRhQXJlYSIsInNsaWRlcnMiLCJjaGlsZHJlbiIsImFkZFNvdW5kR2VuZXJhdG9yIiwicmVzZXRJblByb2dyZXNzUHJvcGVydHkiLCJsZWZ0IiwicmlnaHQiLCJib3R0b20iLCJ0b3AiLCJjb250ZW50IiwiZ2V0U2l6ZUNoYW5nZUZyb21EZWx0YSIsImRlbHRhIiwiZGVzY3JpYmVMYXJnZUNoYW5nZXMiLCJhc3NlcnQiLCJkZXNjcmlwdGlvbiIsInVzZUFMb3QiLCJNYXRoIiwiYWJzIiwib3RoZXJEZWx0YSIsImxldHRlclN0cmluZyIsInJlc2lzdGFuY2VDaGFuZ2VTdHJpbmciLCJsZXR0ZXJDaGFuZ2VTdHJpbmciLCJsZXR0ZXIiLCJsZXR0ZXJDaGFuZ2UiLCJyQ2hhbmdlIiwiZ2V0Rm9ybWF0dGVkUmVzaXN0YW5jZVZhbHVlIiwibnVtRGVjaW1hbERpZ2l0cyIsInRvRml4ZWQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNvbnRyb2xQYW5lbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNy0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBQYW5lbCBmb3Igc2xpZGVycywgcmVhZG91dHMgYW5kIGFkamFjZW50IHRleHRcclxuICogQGF1dGhvciBWYXNpbHkgU2hha2hvdiAoTWxlYXJuZXIpXHJcbiAqIEBhdXRob3IgQW50b24gVWx5YW5vdiAoTWxlYXJuZXIpXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IFNjZW5lcnlQaGV0U3RyaW5ncyBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvU2NlbmVyeVBoZXRTdHJpbmdzLmpzJztcclxuaW1wb3J0IHsgTm9kZSwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBQYW5lbCBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvUGFuZWwuanMnO1xyXG5pbXBvcnQgc291bmRNYW5hZ2VyIGZyb20gJy4uLy4uLy4uLy4uL3RhbWJvL2pzL3NvdW5kTWFuYWdlci5qcyc7XHJcbmltcG9ydCBVdHRlcmFuY2UgZnJvbSAnLi4vLi4vLi4vLi4vdXR0ZXJhbmNlLXF1ZXVlL2pzL1V0dGVyYW5jZS5qcyc7XHJcbmltcG9ydCByZXNpc3RhbmNlSW5BV2lyZSBmcm9tICcuLi8uLi9yZXNpc3RhbmNlSW5BV2lyZS5qcyc7XHJcbmltcG9ydCBSZXNpc3RhbmNlSW5BV2lyZVN0cmluZ3MgZnJvbSAnLi4vLi4vUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmpzJztcclxuaW1wb3J0IFJlc2lzdGFuY2VJbkFXaXJlTW9kZWwgZnJvbSAnLi4vbW9kZWwvUmVzaXN0YW5jZUluQVdpcmVNb2RlbC5qcyc7XHJcbmltcG9ydCBSZXNpc3RhbmNlSW5BV2lyZUNvbnN0YW50cyBmcm9tICcuLi9SZXNpc3RhbmNlSW5BV2lyZUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBSZXNpc3RhbmNlU291bmRHZW5lcmF0b3IgZnJvbSAnLi9SZXNpc3RhbmNlU291bmRHZW5lcmF0b3IuanMnO1xyXG5pbXBvcnQgU2xpZGVyVW5pdCBmcm9tICcuL1NsaWRlclVuaXQuanMnO1xyXG5cclxuY29uc3QgYXJlYVN0cmluZyA9IFJlc2lzdGFuY2VJbkFXaXJlU3RyaW5ncy5hcmVhO1xyXG5jb25zdCBhcmVhU3ltYm9sU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmFyZWFTeW1ib2w7XHJcbmNvbnN0IGNtU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmNtO1xyXG5jb25zdCBsZW5ndGhTdHJpbmcgPSBSZXNpc3RhbmNlSW5BV2lyZVN0cmluZ3MubGVuZ3RoO1xyXG5jb25zdCBsZW5ndGhTeW1ib2xTdHJpbmcgPSBSZXNpc3RhbmNlSW5BV2lyZVN0cmluZ3MubGVuZ3RoU3ltYm9sO1xyXG5jb25zdCBvaG1TdHJpbmcgPSBSZXNpc3RhbmNlSW5BV2lyZVN0cmluZ3Mub2htO1xyXG5jb25zdCBwYXR0ZXJuMExhYmVsMVZhbHVlMlVuaXRzU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLnBhdHRlcm5bICcwbGFiZWwnIF1bICcxdmFsdWUnIF1bICcydW5pdHMnIF07XHJcbmNvbnN0IHBhdHRlcm4wUmVzaXN0YW5jZVVuaXRzMUxlbmd0aFVuaXRzU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLnBhdHRlcm5bICcwcmVzaXN0YW5jZVVuaXRzJyBdWyAnMWxlbmd0aFVuaXRzJyBdO1xyXG5jb25zdCByZXNpc3RhbmNlU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLnJlc2lzdGFuY2U7XHJcbmNvbnN0IHJlc2lzdGl2aXR5U3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLnJlc2lzdGl2aXR5O1xyXG5jb25zdCBzeW1ib2xPaG1zU3RyaW5nUHJvcGVydHkgPSBTY2VuZXJ5UGhldFN0cmluZ3Muc3ltYm9sLm9obXNTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3Qgc3ltYm9sUmVzaXN0aXZpdHlTdHJpbmdQcm9wZXJ0eSA9IFNjZW5lcnlQaGV0U3RyaW5ncy5zeW1ib2wucmVzaXN0aXZpdHlTdHJpbmdQcm9wZXJ0eTtcclxuXHJcbmNvbnN0IHJlc2lzdGl2aXR5VW5pdHNQYXR0ZXJuU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkud2lyZS5yZXNpc3Rpdml0eVVuaXRzUGF0dGVybjtcclxuY29uc3QgbGVuZ3RoVW5pdHNQYXR0ZXJuU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkuY29udHJvbHMubGVuZ3RoVW5pdHNQYXR0ZXJuO1xyXG5jb25zdCBhcmVhVW5pdHNQYXR0ZXJuU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkuY29udHJvbHMuYXJlYVVuaXRzUGF0dGVybjtcclxuY29uc3QgcmVzaXN0aXZpdHlTbGlkZXJMYWJlbFN0cmluZyA9IFJlc2lzdGFuY2VJbkFXaXJlU3RyaW5ncy5hMTF5LmNvbnRyb2xzLnJlc2lzdGl2aXR5U2xpZGVyTGFiZWw7XHJcbmNvbnN0IGxlbmd0aFNsaWRlckxhYmVsU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkuY29udHJvbHMubGVuZ3RoU2xpZGVyTGFiZWw7XHJcbmNvbnN0IGFyZWFTbGlkZXJMYWJlbFN0cmluZyA9IFJlc2lzdGFuY2VJbkFXaXJlU3RyaW5ncy5hMTF5LmNvbnRyb2xzLmFyZWFTbGlkZXJMYWJlbDtcclxuY29uc3Qgc2xpZGVyQ29udHJvbHNTdHJpbmcgPSBSZXNpc3RhbmNlSW5BV2lyZVN0cmluZ3MuYTExeS5jb250cm9scy5zbGlkZXJDb250cm9scztcclxuY29uc3Qgc2xpZGVyc0Rlc2NyaXB0aW9uU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkuY29udHJvbHMuc2xpZGVyc0Rlc2NyaXB0aW9uO1xyXG5jb25zdCBzaXplQ2hhbmdlQWxlcnRQYXR0ZXJuU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkuY29udHJvbHMuc2l6ZUNoYW5nZUFsZXJ0UGF0dGVybjtcclxuY29uc3QgbGV0dGVyUmhvU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkuY29udHJvbHMubGV0dGVyUmhvO1xyXG5jb25zdCBsZXR0ZXJMU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkuY29udHJvbHMubGV0dGVyTDtcclxuY29uc3QgbGV0dGVyQVN0cmluZyA9IFJlc2lzdGFuY2VJbkFXaXJlU3RyaW5ncy5hMTF5LmNvbnRyb2xzLmxldHRlckE7XHJcbmNvbnN0IGdyb3dzU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkuZXF1YXRpb24uYWxlcnRzLmdyb3dzO1xyXG5jb25zdCBzaHJpbmtzU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkuZXF1YXRpb24uYWxlcnRzLnNocmlua3M7XHJcbmNvbnN0IGdyb3dzQUxvdFN0cmluZyA9IFJlc2lzdGFuY2VJbkFXaXJlU3RyaW5ncy5hMTF5LmVxdWF0aW9uLmFsZXJ0cy5ncm93c0FMb3Q7XHJcbmNvbnN0IHNocmlua3NBTG90U3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkuZXF1YXRpb24uYWxlcnRzLnNocmlua3NBTG90O1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IFNMSURFUl9TUEFDSU5HID0gNTA7XHJcblxyXG4vLyBwZG9tIC0gaWYgcmVzaXN0YW5jZSBjaGFuZ2VzIDIgKiB0aGUgcmFuZ2Ugb2YgdGhlIHJlc2lzdGFuY2UgLyB0aGUgbnVtYmVyIG9mIHJlbGF0aXZlIHNpemUgZGVzY3JpcHRpb25zLCBsYXJnZXIgY2hhbmdlXHJcbi8vIGlzIHNpZ25pZmllZCBpbiBkZXNjcmlwdGlvblxyXG5jb25zdCBMQVJHRV9SRVNJU1RBTkNFX0RFTFRBID0gKCAoIFJlc2lzdGFuY2VJbkFXaXJlTW9kZWwuZ2V0UmVzaXN0YW5jZVJhbmdlKCkubWF4IC0gUmVzaXN0YW5jZUluQVdpcmVNb2RlbC5nZXRSZXNpc3RhbmNlUmFuZ2UoKS5taW4gKSAvIFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLlJFTEFUSVZFX1NJWkVfU1RSSU5HUy5sZW5ndGggKSAqIDI7XHJcblxyXG5jbGFzcyBDb250cm9sUGFuZWwgZXh0ZW5kcyBQYW5lbCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7UmVzaXN0YW5jZUluQVdpcmVNb2RlbH0gbW9kZWxcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBtb2RlbCwgdGFuZGVtLCBvcHRpb25zICkge1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG4gICAgICB4TWFyZ2luOiAzMCxcclxuICAgICAgeU1hcmdpbjogMjAsXHJcbiAgICAgIGxpbmVXaWR0aDogMyxcclxuICAgICAgcmVzaXplOiBmYWxzZSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0sXHJcbiAgICAgIHByZXZlbnRGaXQ6IHRydWUsXHJcblxyXG4gICAgICAvLyBwZG9tXHJcbiAgICAgIHRhZ05hbWU6ICd1bCcsXHJcbiAgICAgIGxhYmVsVGFnTmFtZTogJ2gzJyxcclxuICAgICAgbGFiZWxDb250ZW50OiBzbGlkZXJDb250cm9sc1N0cmluZyxcclxuICAgICAgZGVzY3JpcHRpb25Db250ZW50OiBzbGlkZXJzRGVzY3JpcHRpb25TdHJpbmdcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGR5bmFtaWMgdGl0bGUgdGhhdCBpbmRpY2F0ZXMgdGhlIHJlc2lzdGFuY2UuXHJcbiAgICBjb25zdCByZXNpc3RhbmNlVGV4dCA9IG5ldyBUZXh0KCAnJywge1xyXG4gICAgICBmb250OiBSZXNpc3RhbmNlSW5BV2lyZUNvbnN0YW50cy5SRUFET1VUX0ZPTlQsXHJcbiAgICAgIGZpbGw6IFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLlJFRF9DT0xPUixcclxuICAgICAgbWF4V2lkdGg6IFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLlNMSURFUl9XSURUSCAqIDQuNyxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAncmVzaXN0YW5jZVRleHQnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBTZXQgdGhlIHJlc2lzdGFuY2UgcmVhZG91dCB0byBpdHMgaW5pdGlhbCB2YWx1ZSwgdGhlbiBzZXQgdGhlIHBvc2l0aW9uLiAgUHJldmlvdXNseSwgdGhlIHJlYWRvdXQgcG9zaXRpb24gd2FzXHJcbiAgICAvLyByZS1jZW50ZXJlZCBldmVyeSB0aW1lIHRoZSByZXNpc3RhbmNlIGNoYW5nZWQsIGJ1dCBpdCB3YXMgZGVjaWRlZCB0aGF0IHRoaXMgbG9va2VkIHRvbyBqdW1weSwgc28gbm93IGl0J3NcclxuICAgIC8vIHBvc2l0aW9uZWQgb25seSBvbmNlLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3Jlc2lzdGFuY2UtaW4tYS13aXJlL2lzc3Vlcy8xODEuXHJcbiAgICByZXNpc3RhbmNlVGV4dC5zdHJpbmcgPSBnZXRSZXNpc3RhbmNlUmVhZG91dFRleHQoIG1vZGVsLnJlc2lzdGFuY2VQcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgcmVzaXN0YW5jZVRleHQuY2VudGVyWCA9IDA7XHJcblxyXG4gICAgLy8gVXBkYXRlIHRoZSByZXNpc3RhbmNlIHJlYWRvdXQgd2hlbiB0aGUgcmVzaXN0YW5jZSBjaGFuZ2VzLlxyXG4gICAgbW9kZWwucmVzaXN0YW5jZVByb3BlcnR5LmxpbmsoIHJlc2lzdGFuY2UgPT4ge1xyXG4gICAgICByZXNpc3RhbmNlVGV4dC5zdHJpbmcgPSBnZXRSZXNpc3RhbmNlUmVhZG91dFRleHQoIHJlc2lzdGFuY2UgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBwZG9tIC0gd2hlbiB1c2luZyBhIHNsaWRlciwgd2Ugc3RvcmUgdGhlIGluaXRpYWwgdmFsdWUgb24gc3RhcnQgZHJhZyBzbyB0aGF0IHdlIGNhbiBkZXNjcmliZSBzaXplIGNoYW5nZSBhZnRlclxyXG4gICAgLy8gaW50ZXJhY3Rpb25cclxuICAgIGxldCByZXNpc3RhbmNlT25TdGFydCA9IG1vZGVsLnJlc2lzdGFuY2VQcm9wZXJ0eS5nZXQoKTtcclxuXHJcbiAgICAvLyBwZG9tIC0gYW4gdXR0ZXJhbmNlIGZvciB3aGVuZXZlciBwaHlzaWNhbCB2YWx1ZXMgY2hhbmdlXHJcbiAgICBjb25zdCBjaGFuZ2VVdHRlcmFuY2UgPSBuZXcgVXR0ZXJhbmNlKCk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGFuZCBhZGQgdGhlIHJlc2lzdGl2aXR5IHNsaWRlciB3aXRoIHJlYWRvdXQgYW5kIGxhYmVscy5cclxuICAgIGxldCByaG9PblN0YXJ0ID0gbW9kZWwucmVzaXN0aXZpdHlQcm9wZXJ0eS5nZXQoKTtcclxuICAgIGNvbnN0IHJlc2lzdGl2aXR5U2xpZGVyID0gbmV3IFNsaWRlclVuaXQoXHJcbiAgICAgIG1vZGVsLnJlc2lzdGl2aXR5UHJvcGVydHksXHJcbiAgICAgIFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLlJFU0lTVElWSVRZX1JBTkdFLFxyXG4gICAgICBzeW1ib2xSZXNpc3Rpdml0eVN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICByZXNpc3Rpdml0eVN0cmluZyxcclxuICAgICAgU3RyaW5nVXRpbHMuZm9ybWF0KCBwYXR0ZXJuMFJlc2lzdGFuY2VVbml0czFMZW5ndGhVbml0c1N0cmluZywgc3ltYm9sT2htc1N0cmluZ1Byb3BlcnR5LCBjbVN0cmluZyApLFxyXG4gICAgICByZXNpc3Rpdml0eVNsaWRlckxhYmVsU3RyaW5nLFxyXG4gICAgICB0YW5kZW0uY3JlYXRlVGFuZGVtKCAncmVzaXN0aXZpdHlTbGlkZXInICksIHtcclxuICAgICAgICBzdGFydERyYWc6ICgpID0+IHtcclxuICAgICAgICAgIHJob09uU3RhcnQgPSBtb2RlbC5yZXNpc3Rpdml0eVByb3BlcnR5LmdldCgpO1xyXG4gICAgICAgICAgcmVzaXN0YW5jZU9uU3RhcnQgPSBtb2RlbC5yZXNpc3RhbmNlUHJvcGVydHkuZ2V0KCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbmREcmFnOiAoKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCByZXNpc3RhbmNlID0gbW9kZWwucmVzaXN0YW5jZVByb3BlcnR5LmdldCgpO1xyXG4gICAgICAgICAgY29uc3QgZGVsdGFSaG8gPSBtb2RlbC5yZXNpc3Rpdml0eVByb3BlcnR5LmdldCgpIC0gcmhvT25TdGFydDtcclxuICAgICAgICAgIGNvbnN0IGRlbHRhUmVzaXN0YW5jZSA9IHJlc2lzdGFuY2UgLSByZXNpc3RhbmNlT25TdGFydDtcclxuXHJcbiAgICAgICAgICAvLyBhbm5vdW5jZSB0byBhc3Npc3RpdmUgdGVjaG5vbG9neSBpZiB0aGVyZSBpcyBhIGNoYW5nZSAtIG5vIG5lZWQgdG8gcXVldWUgbWFueSBhbGVydHMgd2hlbiBwcmVzc2luZyBrZXlzXHJcbiAgICAgICAgICAvLyByYXBpZGx5XHJcbiAgICAgICAgICBpZiAoIGRlbHRhUmhvICYmIGRlbHRhUmVzaXN0YW5jZSApIHtcclxuICAgICAgICAgICAgY2hhbmdlVXR0ZXJhbmNlLmFsZXJ0ID0gZ2V0U2l6ZUNoYW5nZUFsZXJ0KCByZXNpc3RhbmNlLCBkZWx0YVJlc2lzdGFuY2UsIGRlbHRhUmhvLCBsZXR0ZXJSaG9TdHJpbmcgKTtcclxuICAgICAgICAgICAgcmVzaXN0aXZpdHlTbGlkZXIuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggY2hhbmdlVXR0ZXJhbmNlICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzbGlkZXJPcHRpb25zOiB7XHJcbiAgICAgICAgICBrZXlib2FyZFN0ZXA6IDAuMDUsIC8vIG9obS1jbVxyXG4gICAgICAgICAgYTExeUNyZWF0ZUFyaWFWYWx1ZVRleHQ6IHZhbHVlID0+IFN0cmluZ1V0aWxzLmZpbGxJbiggcmVzaXN0aXZpdHlVbml0c1BhdHRlcm5TdHJpbmcsIHsgdmFsdWU6IHZhbHVlIH0gKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYW5kIGFkZCB0aGUgbGVuZ3RoIHNsaWRlciB3aXRoIHJlYWRvdXQgYW5kIGxhYmVscy5cclxuICAgIGxldCBsZW5ndGhPblN0YXJ0ID0gbW9kZWwubGVuZ3RoUHJvcGVydHkuZ2V0KCk7XHJcbiAgICBjb25zdCBsZW5ndGhTbGlkZXIgPSBuZXcgU2xpZGVyVW5pdChcclxuICAgICAgbW9kZWwubGVuZ3RoUHJvcGVydHksXHJcbiAgICAgIFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLkxFTkdUSF9SQU5HRSxcclxuICAgICAgbGVuZ3RoU3ltYm9sU3RyaW5nLFxyXG4gICAgICBsZW5ndGhTdHJpbmcsXHJcbiAgICAgIGNtU3RyaW5nLFxyXG4gICAgICBsZW5ndGhTbGlkZXJMYWJlbFN0cmluZyxcclxuICAgICAgdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xlbmd0aFNsaWRlcicgKSwge1xyXG4gICAgICAgIHN0YXJ0RHJhZzogKCkgPT4ge1xyXG4gICAgICAgICAgbGVuZ3RoT25TdGFydCA9IG1vZGVsLmxlbmd0aFByb3BlcnR5LmdldCgpO1xyXG4gICAgICAgICAgcmVzaXN0YW5jZU9uU3RhcnQgPSBtb2RlbC5yZXNpc3RhbmNlUHJvcGVydHkuZ2V0KCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbmREcmFnOiAoKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCByZXNpc3RhbmNlID0gbW9kZWwucmVzaXN0YW5jZVByb3BlcnR5LmdldCgpO1xyXG4gICAgICAgICAgY29uc3QgZGVsdGFMZW5ndGggPSBtb2RlbC5sZW5ndGhQcm9wZXJ0eS5nZXQoKSAtIGxlbmd0aE9uU3RhcnQ7XHJcbiAgICAgICAgICBjb25zdCBkZWx0YVJlc2lzdGFuY2UgPSByZXNpc3RhbmNlIC0gcmVzaXN0YW5jZU9uU3RhcnQ7XHJcblxyXG4gICAgICAgICAgLy8gYW5ub3VuY2UgdG8gYXNzaXN0aXZlIHRlY2hub2xvZ3kgaWYgdGhlcmUgaXMgYSBjaGFuZ2UgLSBubyBuZWVkIHRvIHF1ZXVlIG1hbnkgYWxlcnRzIHdoZW4gcHJlc3Npbmcga2V5c1xyXG4gICAgICAgICAgLy8gcmFwaWRseVxyXG4gICAgICAgICAgaWYgKCBkZWx0YUxlbmd0aCAmJiBkZWx0YVJlc2lzdGFuY2UgKSB7XHJcbiAgICAgICAgICAgIGNoYW5nZVV0dGVyYW5jZS5hbGVydCA9IGdldFNpemVDaGFuZ2VBbGVydCggcmVzaXN0YW5jZSwgZGVsdGFSZXNpc3RhbmNlLCBkZWx0YUxlbmd0aCwgbGV0dGVyTFN0cmluZyApO1xyXG4gICAgICAgICAgICBsZW5ndGhTbGlkZXIuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggY2hhbmdlVXR0ZXJhbmNlICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzbGlkZXJPcHRpb25zOiB7XHJcbiAgICAgICAgICBhMTF5Q3JlYXRlQXJpYVZhbHVlVGV4dDogdmFsdWUgPT4gU3RyaW5nVXRpbHMuZmlsbEluKCBsZW5ndGhVbml0c1BhdHRlcm5TdHJpbmcsIHsgdmFsdWU6IHZhbHVlIH0gKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYW5kIGFkZCB0aGUgYXJlYSBzbGlkZXIgd2l0aCByZWFkb3V0IGFuZCBsYWJlbHMuIEZvciBrZXlib2FyZCBkcmFnZ2luZywgdGhlIHJhbmdlIHJhbmdlcyBkb2Vzbid0IHNwbGl0IGludG8gZXZlbiBzdGVwcyxcclxuICAgIC8vIHNvIHdlIGNhbGN1bGF0ZSBhIGtleWJvYXJkIHN0ZXAgYnkgYnJlYWtpbmcgdGhlIHJhbmdlIGludG8gMTAwLlxyXG4gICAgbGV0IGFyZWFPblN0YXJ0ID0gbW9kZWwuYXJlYVByb3BlcnR5LmdldCgpO1xyXG4gICAgY29uc3QgYXJlYVNsaWRlciA9IG5ldyBTbGlkZXJVbml0KFxyXG4gICAgICBtb2RlbC5hcmVhUHJvcGVydHksXHJcbiAgICAgIFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLkFSRUFfUkFOR0UsXHJcbiAgICAgIGFyZWFTeW1ib2xTdHJpbmcsXHJcbiAgICAgIGFyZWFTdHJpbmcsXHJcbiAgICAgIGAke2NtU3RyaW5nfTxzdXA+Mjwvc3VwPmAsXHJcbiAgICAgIGFyZWFTbGlkZXJMYWJlbFN0cmluZyxcclxuICAgICAgdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2FyZWFTbGlkZXInICksIHtcclxuICAgICAgICBzdGFydERyYWc6ICgpID0+IHtcclxuICAgICAgICAgIGFyZWFPblN0YXJ0ID0gbW9kZWwuYXJlYVByb3BlcnR5LmdldCgpO1xyXG4gICAgICAgICAgcmVzaXN0YW5jZU9uU3RhcnQgPSBtb2RlbC5yZXNpc3RhbmNlUHJvcGVydHkuZ2V0KCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbmREcmFnOiAoKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCByZXNpc3RhbmNlID0gbW9kZWwucmVzaXN0YW5jZVByb3BlcnR5LmdldCgpO1xyXG4gICAgICAgICAgY29uc3QgZGVsdGFBcmVhID0gbW9kZWwuYXJlYVByb3BlcnR5LmdldCgpIC0gYXJlYU9uU3RhcnQ7XHJcbiAgICAgICAgICBjb25zdCBkZWx0YVJlc2lzdGFuY2UgPSByZXNpc3RhbmNlIC0gcmVzaXN0YW5jZU9uU3RhcnQ7XHJcblxyXG4gICAgICAgICAgLy8gYW5ub3VuY2UgdG8gYXNzaXN0aXZlIHRlY2hub2xvZ3kgaWYgdGhlcmUgaXMgYSBjaGFuZ2UgLSBubyBuZWVkIHRvIHF1ZXVlIG1hbnkgYWxlcnRzIHdoZW4gcHJlc3Npbmcga2V5c1xyXG4gICAgICAgICAgLy8gcmFwaWRseVxyXG4gICAgICAgICAgaWYgKCBkZWx0YUFyZWEgJiYgZGVsdGFSZXNpc3RhbmNlICkge1xyXG4gICAgICAgICAgICBjaGFuZ2VVdHRlcmFuY2UuYWxlcnQgPSBnZXRTaXplQ2hhbmdlQWxlcnQoIHJlc2lzdGFuY2UsIGRlbHRhUmVzaXN0YW5jZSwgZGVsdGFBcmVhLCBsZXR0ZXJBU3RyaW5nICk7XHJcbiAgICAgICAgICAgIGFyZWFTbGlkZXIuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggY2hhbmdlVXR0ZXJhbmNlICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzbGlkZXJPcHRpb25zOiB7XHJcbiAgICAgICAgICBhMTF5Q3JlYXRlQXJpYVZhbHVlVGV4dDogdmFsdWUgPT4gU3RyaW5nVXRpbHMuZmlsbEluKCBhcmVhVW5pdHNQYXR0ZXJuU3RyaW5nLCB7IHZhbHVlOiB2YWx1ZSB9IClcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgY29uc3Qgc2xpZGVycyA9IG5ldyBOb2RlKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbIHJlc2lzdGl2aXR5U2xpZGVyLCBsZW5ndGhTbGlkZXIsIGFyZWFTbGlkZXIgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGFkZCB0aGUgc291bmQgZ2VuZXJhdG9yIGZvciB0aGUgcmVzaXN0YW5jZSBsZXZlbFxyXG4gICAgc291bmRNYW5hZ2VyLmFkZFNvdW5kR2VuZXJhdG9yKCBuZXcgUmVzaXN0YW5jZVNvdW5kR2VuZXJhdG9yKCB7XHJcbiAgICAgIHJlc2lzdGFuY2VQcm9wZXJ0eTogbW9kZWwucmVzaXN0YW5jZVByb3BlcnR5LFxyXG4gICAgICByZXNpc3Rpdml0eVByb3BlcnR5OiBtb2RlbC5yZXNpc3Rpdml0eVByb3BlcnR5LFxyXG4gICAgICByZXNpc3Rpdml0eVNsaWRlcjogcmVzaXN0aXZpdHlTbGlkZXIsXHJcbiAgICAgIGxlbmd0aFByb3BlcnR5OiBtb2RlbC5sZW5ndGhQcm9wZXJ0eSxcclxuICAgICAgbGVuZ3RoU2xpZGVyOiBsZW5ndGhTbGlkZXIsXHJcbiAgICAgIGFyZWFQcm9wZXJ0eTogbW9kZWwuYXJlYVByb3BlcnR5LFxyXG4gICAgICBhcmVhU2xpZGVyOiBhcmVhU2xpZGVyLFxyXG4gICAgICByZXNldEluUHJvZ3Jlc3NQcm9wZXJ0eTogbW9kZWwucmVzZXRJblByb2dyZXNzUHJvcGVydHlcclxuICAgIH0gKSApO1xyXG5cclxuICAgIC8vIGxheW91dCBmb3IgdGhlIHBhbmVsLCBIQm94IGNhbm5vdCBiZSB1c2VkIGJlY2F1c2UgJ2JvdHRvbScgYWxpZ25tZW50IGNhbm5vdCBhbGlnbiBSaWNoVGV4dCBpbiBTbGlkZXJVbml0XHJcbiAgICBsZW5ndGhTbGlkZXIubGVmdCA9IHJlc2lzdGl2aXR5U2xpZGVyLnJpZ2h0ICsgU0xJREVSX1NQQUNJTkc7XHJcbiAgICBhcmVhU2xpZGVyLmxlZnQgPSBsZW5ndGhTbGlkZXIucmlnaHQgKyBTTElERVJfU1BBQ0lORztcclxuICAgIHNsaWRlcnMuY2VudGVyWCA9IDA7XHJcbiAgICByZXNpc3RhbmNlVGV4dC5ib3R0b20gPSBzbGlkZXJzLnRvcCAtIDEyO1xyXG5cclxuICAgIC8vIEJlY2F1c2UgQ29udHJvbFBhbmVsIGV4dGVuZHMgUGFuZWwsIGl0IG5lZWRzIHBhc3MgYSBjb250ZW50IG5vZGUgaW50byBpdHMgY29uc3RydWN0b3IgdG8gc3Vycm91bmQuXHJcbiAgICAvLyBBZGQgZXZlcnl0aGluZyB0byB0aGUgY29udGVudCBub2RlLCB0aGVuIHBhc3MgY29udGVudCB0byB0aGUgUGFuZWwuY2FsbCgpLlxyXG4gICAgY29uc3QgY29udGVudCA9IG5ldyBOb2RlKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbIHJlc2lzdGFuY2VUZXh0LCBzbGlkZXJzIF0sXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NvbnRlbnQnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBzdXBlciggY29udGVudCwgb3B0aW9ucyApO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBhIGRlc2NyaXB0aW9uIGZvciB3aGV0aGVyIGEgbGV0dGVyIGdyb3dzIG9yIHNocmlua3MuIE9wdGlvbmFsbHksIGlmIHRoZSBzaXplIGNoYW5nZXMgZW5vdWdoLCBhbiBhZGRpdGlvbmFsXHJcbiAqIGZyYWdtZW50IGlzIGluY2x1ZGVkIHRoYXQgc2lnbmlmaWVzIHRoaXMuIFdpbGwgcmV0dXJuIHNvbWV0aGluZyBsaWtlXHJcbiAqXHJcbiAqICdncm93cydcclxuICogJ3Nocmlua3MnXHJcbiAqICdncm93cyBhIGxvdCdcclxuICogJ3Nocmlua3MgYSBsb3QnXHJcbiAqXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBkZWx0YVxyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGRlc2NyaWJlTGFyZ2VDaGFuZ2VzXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRTaXplQ2hhbmdlRnJvbURlbHRhKCBkZWx0YSwgZGVzY3JpYmVMYXJnZUNoYW5nZXMgKSB7XHJcbiAgYXNzZXJ0ICYmIGFzc2VydCggZGVsdGEgIT09IDAsICd0cnlpbmcgdG8gZGVzY3JpYmUgbm8gY2hhbmdlIGluIHNpemUnICk7XHJcbiAgbGV0IGRlc2NyaXB0aW9uO1xyXG5cclxuICBjb25zdCB1c2VBTG90ID0gKCBkZXNjcmliZUxhcmdlQ2hhbmdlcyAmJiBNYXRoLmFicyggZGVsdGEgKSA+IExBUkdFX1JFU0lTVEFOQ0VfREVMVEEgKTtcclxuXHJcbiAgaWYgKCBkZWx0YSA+IDAgKSB7XHJcbiAgICBkZXNjcmlwdGlvbiA9IHVzZUFMb3QgPyBncm93c0FMb3RTdHJpbmcgOiBncm93c1N0cmluZztcclxuICB9XHJcbiAgZWxzZSBpZiAoIGRlbHRhIDwgMCApIHtcclxuICAgIGRlc2NyaXB0aW9uID0gdXNlQUxvdCA/IHNocmlua3NBTG90U3RyaW5nIDogc2hyaW5rc1N0cmluZztcclxuICB9XHJcblxyXG4gIHJldHVybiBkZXNjcmlwdGlvbjtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBhIGZ1bGwgYWxlcnQgZm9yIHNpemUgbGV0dGVyIHNpemUgYW5kIGhvdyBSIGNoYW5nZXMgYXMgd2VsbC4gV2lsbCByZXR1cm4gc29tZXRoaW5nIGxpa2VcclxuICpcclxuICogXCJBcyBsZXR0ZXIgcmhvIGdyb3dzLCBsZXR0ZXIgUiBncm93cy4gUmVzaXN0YW5jZSBubyAwLjY2NyBvaG1zLlwiIG9yXHJcbiAqIFwiQXMgbGV0dGVyIEEgZ3Jvd3MsIGxldHRlciBSIHNocmlua3MgYSBsb3QuIFJlc2lzdGFuY2Ugbm93IDEuMjAgb2htc1wiXHJcbiAqXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSByZXNpc3RhbmNlIC0gY3VycmVudCB2YWx1ZSBvZiByZXNpc3RhbmNlXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBkZWx0YVJlc2lzdGFuY2UgLSBjaGFuZ2UgaW5cclxuICogQHBhcmFtIHtudW1iZXJ9IG90aGVyRGVsdGEgLSBjaGFuZ2UgaW4gb3RoZXIgdmFyaWFibGUsIHJlc2lzdGl2aXR5LCBsZW5ndGgsIG9yIGFyZWFcclxuICogQHBhcmFtIHtzdHJpbmd9IGxldHRlclN0cmluZyAtIHRoZSBsZXR0ZXIgd2l0aCBzaXplIGNoYW5nZXMgdG8gZGVzY3JpYmVcclxuICogQHJldHVybnMge3N0cmluZ31cclxuICovXHJcbmZ1bmN0aW9uIGdldFNpemVDaGFuZ2VBbGVydCggcmVzaXN0YW5jZSwgZGVsdGFSZXNpc3RhbmNlLCBvdGhlckRlbHRhLCBsZXR0ZXJTdHJpbmcgKSB7XHJcbiAgY29uc3QgcmVzaXN0YW5jZUNoYW5nZVN0cmluZyA9IGdldFNpemVDaGFuZ2VGcm9tRGVsdGEoIGRlbHRhUmVzaXN0YW5jZSwgdHJ1ZSAvKiBpbmNsdWRlICdhIGxvdCcgKi8gKTtcclxuICBjb25zdCBsZXR0ZXJDaGFuZ2VTdHJpbmcgPSBnZXRTaXplQ2hhbmdlRnJvbURlbHRhKCBvdGhlckRlbHRhLCBmYWxzZSAvKiBkb24ndCBpbmNsdWRlICdhIGxvdCAqLyApO1xyXG5cclxuICByZXR1cm4gU3RyaW5nVXRpbHMuZmlsbEluKCBzaXplQ2hhbmdlQWxlcnRQYXR0ZXJuU3RyaW5nLCB7XHJcbiAgICBsZXR0ZXI6IGxldHRlclN0cmluZyxcclxuICAgIGxldHRlckNoYW5nZTogbGV0dGVyQ2hhbmdlU3RyaW5nLFxyXG4gICAgckNoYW5nZTogcmVzaXN0YW5jZUNoYW5nZVN0cmluZyxcclxuICAgIHJlc2lzdGFuY2U6IFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLmdldEZvcm1hdHRlZFJlc2lzdGFuY2VWYWx1ZSggcmVzaXN0YW5jZSApXHJcbiAgfSApO1xyXG59XHJcblxyXG4vKipcclxuICogZ2V0IHRoZSBzdHJpbmcgdGhhdCBzaG91bGQgYmUgc2hvd24gb24gdGhlIHJlc2lzdGFuY2UgcmVhZG91dCBmb3IgYSBnaXZlbiByZXNpc3RhbmNlIHZhbHVlXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSByZXNpc3RhbmNlXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRSZXNpc3RhbmNlUmVhZG91dFRleHQoIHJlc2lzdGFuY2UgKSB7XHJcblxyXG4gIC8vIHRoZSBudW1iZXIgb2YgZGlnaXRzIHNob3duIHZhcmllcyBiYXNlZCBvbiB0aGUgcmFuZ2VcclxuICBjb25zdCBudW1EZWNpbWFsRGlnaXRzID0gcmVzaXN0YW5jZSA+PSAxMDAgPyAwIDogLy8gT3ZlciAxMDAsIHNob3cgbm8gZGVjaW1hbCBwb2ludHMsIGxpa2UgMTAyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2lzdGFuY2UgPj0gMTAgPyAxIDogLy8gYmV0d2VlbiAxMC4wIGFuZCA5OS45LCBzaG93IDIgZGVjaW1hbCBwb2ludHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXN0YW5jZSA8IDAuMDAxID8gNCA6IC8vIHdoZW4gbGVzcyB0aGFuIDAuMDAxLCBzaG93IDQgZGVjaW1hbHMsIHNlZSAjMTI1XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2lzdGFuY2UgPCAxID8gMyA6IC8vIHdoZW4gbGVzcyB0aGFuIDEsIHNob3cgMyBkZWNpbWFsIHBsYWNlcywgc2VlICMxMjVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgMjsgLy8gTnVtYmVycyBsZXNzIHRoYW4gMTAgc2hvdyAyIGRlY2ltYWwgcG9pbnRzLCBsaWtlIDguMzVcclxuXHJcbiAgcmV0dXJuIFN0cmluZ1V0aWxzLmZvcm1hdChcclxuICAgIHBhdHRlcm4wTGFiZWwxVmFsdWUyVW5pdHNTdHJpbmcsXHJcbiAgICByZXNpc3RhbmNlU3RyaW5nLFxyXG4gICAgVXRpbHMudG9GaXhlZCggcmVzaXN0YW5jZSwgbnVtRGVjaW1hbERpZ2l0cyApLFxyXG4gICAgb2htU3RyaW5nXHJcbiAgKTtcclxufVxyXG5cclxucmVzaXN0YW5jZUluQVdpcmUucmVnaXN0ZXIoICdDb250cm9sUGFuZWwnLCBDb250cm9sUGFuZWwgKTtcclxuZXhwb3J0IGRlZmF1bHQgQ29udHJvbFBhbmVsOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxPQUFPQyxXQUFXLE1BQU0sK0NBQStDO0FBQ3ZFLE9BQU9DLGtCQUFrQixNQUFNLG1EQUFtRDtBQUNsRixTQUFTQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDOUQsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxZQUFZLE1BQU0sc0NBQXNDO0FBQy9ELE9BQU9DLFNBQVMsTUFBTSw2Q0FBNkM7QUFDbkUsT0FBT0MsaUJBQWlCLE1BQU0sNEJBQTRCO0FBQzFELE9BQU9DLHdCQUF3QixNQUFNLG1DQUFtQztBQUN4RSxPQUFPQyxzQkFBc0IsTUFBTSxvQ0FBb0M7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