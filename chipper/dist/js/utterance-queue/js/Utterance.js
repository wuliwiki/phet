// Copyright 2022-2023, University of Colorado Boulder

/**
 * An utterance to be handed off to the AlertQueue, which manages the order of accessibility alerts
 * read by a screen reader.
 *
 * An utterance to be provided to the AlertQueue. An utterance can be one of TAlertable.
 *
 * A single Utterance can be added to the utteranceQueue multiple times. This may be so that a
 * number of alerts associated with the utterance get read in order (see alert in options). Or it
 * may be that changes are being alerted rapidly from the same source. An Utterance is considered
 * "unstable" if it is being added rapidly to the utteranceQueue. By default, utterances are only
 * announced when they are "stable", and stop getting added to the queue. This will prevent
 * a large number of alerts from the same interaction from spamming the user. See related options alertStableDelay,
 * and alertMaximumDelay.
 *
 * @author Jesse Greenberg
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import DerivedProperty from '../../axon/js/DerivedProperty.js';
import ReadOnlyProperty from '../../axon/js/ReadOnlyProperty.js';
import TinyProperty from '../../axon/js/TinyProperty.js';
import DynamicProperty from '../../axon/js/DynamicProperty.js';
import NumberProperty from '../../axon/js/NumberProperty.js';
import optionize from '../../phet-core/js/optionize.js';
import IOType from '../../tandem/js/types/IOType.js';
import StringIO from '../../tandem/js/types/StringIO.js';
import responseCollector from './responseCollector.js';
import ResponsePacket from './ResponsePacket.js';
import utteranceQueueNamespace from './utteranceQueueNamespace.js';
import NullableIO from '../../tandem/js/types/NullableIO.js';
import NumberIO from '../../tandem/js/types/NumberIO.js';
import OrIO from '../../tandem/js/types/OrIO.js';
import Property from '../../axon/js/Property.js';
import Disposable from '../../axon/js/Disposable.js';

// constants
const DEFAULT_PRIORITY = 1;

// The names of Properties that can be accessed on Utterance that are AnnouncingControlProperties for specific Announcing
// features.
let globalIdCounter = 1;
class Utterance extends Disposable {
  // If the value of this Property is false, this Utterance will never be announced by an Announcer. See
  // documentation for canAnnounceImplementationProperty for implementation details and why we use a DynamicProperty.
  // If the value of this Property is false, this Utterance will never be announced by AriaLiveAnnouncer.
  // If the value of this Property is false, this Utterance will never be announced by SpeechSynthesisAnnouncer.
  // (utterance-queue-internal)
  // (utterance-queue-internal)
  // (utterance-queue-internal)
  // (utterance-queue-internal)
  // observable for the priority, can be set to change the priority of this Utterance
  // while it is still in the UtteranceQueue. See options documentation for behavior of priority.
  // the previous value of the resolved "alert". See getAlertText().
  constructor(providedOptions) {
    const options = optionize()({
      alert: null,
      predicate: function () {
        return true;
      },
      canAnnounceProperties: [],
      descriptionCanAnnounceProperties: [],
      voicingCanAnnounceProperties: [],
      alertStableDelay: 200,
      alertMaximumDelay: Number.MAX_VALUE,
      announcerOptions: {},
      priority: DEFAULT_PRIORITY
    }, providedOptions);
    super();
    this.id = globalIdCounter++;
    this._alert = options.alert;
    this.predicate = options.predicate;
    this.canAnnounceProperty = new AnnouncingControlProperty({
      dependentProperties: options.canAnnounceProperties
    });
    this.descriptionCanAnnounceProperty = new AnnouncingControlProperty({
      dependentProperties: options.descriptionCanAnnounceProperties
    });
    this.voicingCanAnnounceProperty = new AnnouncingControlProperty({
      dependentProperties: options.voicingCanAnnounceProperties
    });
    this.alertStableDelay = options.alertStableDelay;
    this.alertMaximumDelay = options.alertMaximumDelay;
    this.announcerOptions = options.announcerOptions;
    this.priorityProperty = new NumberProperty(options.priority);
    this.previousAlertText = null;
  }

  /**
   * @param alert
   * @param respectResponseCollectorProperties - if false, then do not listen to the value of responseCollector
   *                                              for creating the ResponsePacket conglomerate (just combine all available).
   */
  static getAlertStringFromResponsePacket(alert, respectResponseCollectorProperties) {
    const responsePacketOptions = alert.serialize();
    if (!respectResponseCollectorProperties) {
      responsePacketOptions.ignoreProperties = true;
    }
    return responseCollector.collectResponses(responsePacketOptions);
  }

  /**
   * Get the string to alert. This function has potential to run a function to generate the string. Use this with caution.
   * Most often UtteranceQueue should be the only spot calling this.
   * @param respectResponseCollectorProperties=false - if false, then do not listen to the value of responseCollector
   *                                              for creating the ResponsePacket conglomerate (just combine all that are supplied).
   */
  getAlertText(respectResponseCollectorProperties = false) {
    const alert = Utterance.alertableToText(this._alert, respectResponseCollectorProperties);
    this.previousAlertText = alert;
    return alert;
  }
  getAlert() {
    return this._alert;
  }
  get alert() {
    return this.getAlert();
  }
  set alert(alert) {
    this.setAlert(alert);
  }
  setAlert(alert) {
    this._alert = alert;
  }

  /**
   * Set the alertStableDelay time, see alertStableDelay option for more information.
   *
   * BEWARE! Why does the delay time need to be changed during the lifetime of an Utterance? It did for
   * https://github.com/phetsims/gravity-force-lab-basics/issues/146, but does it for you? Be sure there is good
   * reason changing this value.
   */
  setAlertStableDelay(delay) {
    this.alertStableDelay = delay;
  }
  toString() {
    return `Utterance_${this.id}#${this.getAlertText()}`;
  }
  toStateObject() {
    return {
      alert: NullableIO(OrIO([StringIO, NumberIO])).toStateObject(this.getAlertText())
    };
  }
  reset() {
    this.previousAlertText = null;
  }

  /**
   * Set the Properties controlling whether this Utterance can announce. All Properties must be
   * true for the alert content of this Utterance to be announced. These Properties are used in the implementation
   * of this.canAnnounceProperty. Setting new canAnnounceProperties has no impact on the listeners added to
   * this.canAnnounceProperty.
   */
  setCanAnnounceProperties(canAnnounceProperties) {
    this.canAnnounceProperty.setDependentProperties(canAnnounceProperties);
  }
  set canAnnounceProperties(canAnnounceProperties) {
    this.setCanAnnounceProperties(canAnnounceProperties);
  }
  get canAnnounceProperties() {
    return this.getCanAnnounceProperties();
  }

  /**
   * Get the Properties that control whether the alert content for this Utterance can be announced.
   * All must be true for the announcement to occur.
   */
  getCanAnnounceProperties() {
    return this.canAnnounceProperty.getDependentProperties();
  }

  /**
   * Set the Properties controlling whether this Utterance can announce to AriaLiveAnnouncer. All Properties must be
   * true for the alert content of this Utterance to be announced. These Properties are used in the implementation
   * of this.descriptionCanAnnounceProperty. Setting new descriptionCanAnnounceProperties has no impact on the
   * listeners added to this.descriptionCanAnnounceProperty. To announce to AriaLiveAnnouncer, this.canAnnounceProperty
   * must also be true
   */
  setDescriptionCanAnnounceProperties(descriptionCanAnnounceProperties) {
    this.descriptionCanAnnounceProperty.setDependentProperties(descriptionCanAnnounceProperties);
  }
  set descriptionCanAnnounceProperties(descriptionCanAnnounceProperties) {
    this.setDescriptionCanAnnounceProperties(descriptionCanAnnounceProperties);
  }
  get descriptionCanAnnounceProperties() {
    return this.getDescriptionCanAnnounceProperties();
  }

  /**
   * Get the Properties that control whether the alert content for this Utterance can be announced.
   * All must be true for the announcement to occur.
   */
  getDescriptionCanAnnounceProperties() {
    return this.descriptionCanAnnounceProperty.getDependentProperties();
  }

  /**
   * Set the Properties controlling whether this Utterance can announce to SpeechSynthesisAnnouncer. All Properties
   * must be true for the alert content of this Utterance to be announced. These Properties are used in the
   * implementation of this.voicingCanAnnounceProperty. Setting new voicingCanAnnounceProperties has no impact
   * on the listeners added to this.voicingCanAnnounceProperty. To announce to SpeechSynthesisAnnouncer,
   * this.canAnnounceProperty must also be true.
   */
  setVoicingCanAnnounceProperties(voicingCanAnnounceProperties) {
    this.voicingCanAnnounceProperty.setDependentProperties(voicingCanAnnounceProperties);
  }
  set voicingCanAnnounceProperties(voicingCanAnnounceProperties) {
    this.setVoicingCanAnnounceProperties(voicingCanAnnounceProperties);
  }
  get voicingCanAnnounceProperties() {
    return this.getVoicingCanAnnounceProperties();
  }

  /**
   * Get the Properties that control whether the alert content for this Utterance can be announced.
   * All must be true for the announcement to occur.
   */
  getVoicingCanAnnounceProperties() {
    return this.voicingCanAnnounceProperty.getDependentProperties();
  }

  /**
   * Make eligible for garbage collection.
   */
  dispose() {
    this.canAnnounceProperty.dispose();
    this.descriptionCanAnnounceProperty.dispose();
    this.voicingCanAnnounceProperty.dispose();
    this.priorityProperty.dispose();
    super.dispose();
  }

  /**
   * @param alertable
   * @param respectResponseCollectorProperties=false - if false, then do not listen to the value of responseCollector
   *                                              for creating the ResponsePacket conglomerate (just combine all that are supplied).
   */
  static alertableToText(alertable, respectResponseCollectorProperties = false) {
    let alert;
    if (typeof alertable === 'function') {
      alert = alertable();
    } else if (alertable instanceof ResponsePacket) {
      alert = Utterance.getAlertStringFromResponsePacket(alertable, respectResponseCollectorProperties);
    } else if (alertable instanceof Utterance) {
      return alertable.getAlertText(respectResponseCollectorProperties);
    } else if (alertable instanceof ReadOnlyProperty || alertable instanceof TinyProperty) {
      alert = alertable.value;
    } else {
      // Nothing to process from the TAlertable, it is raw content
      alert = alertable;
    }
    return alert;
  }

  // Priority levels that can be used by Utterances providing the `announcerOptions.priority` option.
  static TOP_PRIORITY = 10;
  static HIGH_PRIORITY = 5;
  static MEDIUM_PRIORITY = 2;
  static DEFAULT_PRIORITY = DEFAULT_PRIORITY;
  static LOW_PRIORITY = 0;
  static UtteranceIO = new IOType('UtteranceIO', {
    valueType: Utterance,
    documentation: 'Announces text to a specific browser technology (like aria-live or web speech)',
    toStateObject: utterance => utterance.toStateObject(),
    stateSchema: {
      alert: NullableIO(OrIO([StringIO, NumberIO]))
    }
  });
}
class AnnouncingControlProperty extends DynamicProperty {
  // List of Properties that must all be true in order for the Utterance to be announced by the Announcer.

  // A Property for the DynamicProperty. The value of this Property is the DerivedProperty.and of all
  // canAnnounceProperties. The benefit of using a DynamicProperty is that dependency Properties of the
  // implementation can change (new DerivedProperty in setDependentProperties) but the listeners will remain
  // unaffected on the canAnnounceProperty.
  constructor(providedOptions) {
    const options = optionize()({
      dependentProperties: []
    }, providedOptions);
    const implementationProperty = new Property(new TinyProperty(false));
    super(implementationProperty);
    this._dependentProperties = [];
    this.implementationProperty = implementationProperty;
    this.setDependentProperties(options.dependentProperties);
  }

  /**
   * Set the Properties controlling this Property's value. All Properties must be true for this Property to be true.
   */
  setDependentProperties(dependentProperties) {
    if (this.implementationProperty.value) {
      this.implementationProperty.value.dispose();
    }

    // If no dependentProperties provided, use a dummy Property that will always allow this Utterance to announce.
    const dependencyProperties = dependentProperties.length === 0 ? [new TinyProperty(true)] : dependentProperties;
    this.implementationProperty.value = DerivedProperty.and(dependencyProperties);
    this._dependentProperties = dependentProperties;
  }
  set dependentProperties(dependentProperties) {
    this.setDependentProperties(dependentProperties);
  }
  get dependentProperties() {
    return this.getDependentProperties();
  }

  /**
   * Get the Properties that control whether the alert content for this Utterance can be announced.
   * All must be true for the announcement to occur.
   */
  getDependentProperties() {
    return this._dependentProperties.slice(0); // defensive copy
  }

  dispose() {
    this.implementationProperty.dispose();
    this._dependentProperties = [];
    super.dispose();
  }
}
utteranceQueueNamespace.register('Utterance', Utterance);
export default Utterance;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJSZWFkT25seVByb3BlcnR5IiwiVGlueVByb3BlcnR5IiwiRHluYW1pY1Byb3BlcnR5IiwiTnVtYmVyUHJvcGVydHkiLCJvcHRpb25pemUiLCJJT1R5cGUiLCJTdHJpbmdJTyIsInJlc3BvbnNlQ29sbGVjdG9yIiwiUmVzcG9uc2VQYWNrZXQiLCJ1dHRlcmFuY2VRdWV1ZU5hbWVzcGFjZSIsIk51bGxhYmxlSU8iLCJOdW1iZXJJTyIsIk9ySU8iLCJQcm9wZXJ0eSIsIkRpc3Bvc2FibGUiLCJERUZBVUxUX1BSSU9SSVRZIiwiZ2xvYmFsSWRDb3VudGVyIiwiVXR0ZXJhbmNlIiwiY29uc3RydWN0b3IiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiYWxlcnQiLCJwcmVkaWNhdGUiLCJjYW5Bbm5vdW5jZVByb3BlcnRpZXMiLCJkZXNjcmlwdGlvbkNhbkFubm91bmNlUHJvcGVydGllcyIsInZvaWNpbmdDYW5Bbm5vdW5jZVByb3BlcnRpZXMiLCJhbGVydFN0YWJsZURlbGF5IiwiYWxlcnRNYXhpbXVtRGVsYXkiLCJOdW1iZXIiLCJNQVhfVkFMVUUiLCJhbm5vdW5jZXJPcHRpb25zIiwicHJpb3JpdHkiLCJpZCIsIl9hbGVydCIsImNhbkFubm91bmNlUHJvcGVydHkiLCJBbm5vdW5jaW5nQ29udHJvbFByb3BlcnR5IiwiZGVwZW5kZW50UHJvcGVydGllcyIsImRlc2NyaXB0aW9uQ2FuQW5ub3VuY2VQcm9wZXJ0eSIsInZvaWNpbmdDYW5Bbm5vdW5jZVByb3BlcnR5IiwicHJpb3JpdHlQcm9wZXJ0eSIsInByZXZpb3VzQWxlcnRUZXh0IiwiZ2V0QWxlcnRTdHJpbmdGcm9tUmVzcG9uc2VQYWNrZXQiLCJyZXNwZWN0UmVzcG9uc2VDb2xsZWN0b3JQcm9wZXJ0aWVzIiwicmVzcG9uc2VQYWNrZXRPcHRpb25zIiwic2VyaWFsaXplIiwiaWdub3JlUHJvcGVydGllcyIsImNvbGxlY3RSZXNwb25zZXMiLCJnZXRBbGVydFRleHQiLCJhbGVydGFibGVUb1RleHQiLCJnZXRBbGVydCIsInNldEFsZXJ0Iiwic2V0QWxlcnRTdGFibGVEZWxheSIsImRlbGF5IiwidG9TdHJpbmciLCJ0b1N0YXRlT2JqZWN0IiwicmVzZXQiLCJzZXRDYW5Bbm5vdW5jZVByb3BlcnRpZXMiLCJzZXREZXBlbmRlbnRQcm9wZXJ0aWVzIiwiZ2V0Q2FuQW5ub3VuY2VQcm9wZXJ0aWVzIiwiZ2V0RGVwZW5kZW50UHJvcGVydGllcyIsInNldERlc2NyaXB0aW9uQ2FuQW5ub3VuY2VQcm9wZXJ0aWVzIiwiZ2V0RGVzY3JpcHRpb25DYW5Bbm5vdW5jZVByb3BlcnRpZXMiLCJzZXRWb2ljaW5nQ2FuQW5ub3VuY2VQcm9wZXJ0aWVzIiwiZ2V0Vm9pY2luZ0NhbkFubm91bmNlUHJvcGVydGllcyIsImRpc3Bvc2UiLCJhbGVydGFibGUiLCJ2YWx1ZSIsIlRPUF9QUklPUklUWSIsIkhJR0hfUFJJT1JJVFkiLCJNRURJVU1fUFJJT1JJVFkiLCJMT1dfUFJJT1JJVFkiLCJVdHRlcmFuY2VJTyIsInZhbHVlVHlwZSIsImRvY3VtZW50YXRpb24iLCJ1dHRlcmFuY2UiLCJzdGF0ZVNjaGVtYSIsImltcGxlbWVudGF0aW9uUHJvcGVydHkiLCJfZGVwZW5kZW50UHJvcGVydGllcyIsImRlcGVuZGVuY3lQcm9wZXJ0aWVzIiwibGVuZ3RoIiwiYW5kIiwic2xpY2UiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlV0dGVyYW5jZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMi0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBbiB1dHRlcmFuY2UgdG8gYmUgaGFuZGVkIG9mZiB0byB0aGUgQWxlcnRRdWV1ZSwgd2hpY2ggbWFuYWdlcyB0aGUgb3JkZXIgb2YgYWNjZXNzaWJpbGl0eSBhbGVydHNcclxuICogcmVhZCBieSBhIHNjcmVlbiByZWFkZXIuXHJcbiAqXHJcbiAqIEFuIHV0dGVyYW5jZSB0byBiZSBwcm92aWRlZCB0byB0aGUgQWxlcnRRdWV1ZS4gQW4gdXR0ZXJhbmNlIGNhbiBiZSBvbmUgb2YgVEFsZXJ0YWJsZS5cclxuICpcclxuICogQSBzaW5nbGUgVXR0ZXJhbmNlIGNhbiBiZSBhZGRlZCB0byB0aGUgdXR0ZXJhbmNlUXVldWUgbXVsdGlwbGUgdGltZXMuIFRoaXMgbWF5IGJlIHNvIHRoYXQgYVxyXG4gKiBudW1iZXIgb2YgYWxlcnRzIGFzc29jaWF0ZWQgd2l0aCB0aGUgdXR0ZXJhbmNlIGdldCByZWFkIGluIG9yZGVyIChzZWUgYWxlcnQgaW4gb3B0aW9ucykuIE9yIGl0XHJcbiAqIG1heSBiZSB0aGF0IGNoYW5nZXMgYXJlIGJlaW5nIGFsZXJ0ZWQgcmFwaWRseSBmcm9tIHRoZSBzYW1lIHNvdXJjZS4gQW4gVXR0ZXJhbmNlIGlzIGNvbnNpZGVyZWRcclxuICogXCJ1bnN0YWJsZVwiIGlmIGl0IGlzIGJlaW5nIGFkZGVkIHJhcGlkbHkgdG8gdGhlIHV0dGVyYW5jZVF1ZXVlLiBCeSBkZWZhdWx0LCB1dHRlcmFuY2VzIGFyZSBvbmx5XHJcbiAqIGFubm91bmNlZCB3aGVuIHRoZXkgYXJlIFwic3RhYmxlXCIsIGFuZCBzdG9wIGdldHRpbmcgYWRkZWQgdG8gdGhlIHF1ZXVlLiBUaGlzIHdpbGwgcHJldmVudFxyXG4gKiBhIGxhcmdlIG51bWJlciBvZiBhbGVydHMgZnJvbSB0aGUgc2FtZSBpbnRlcmFjdGlvbiBmcm9tIHNwYW1taW5nIHRoZSB1c2VyLiBTZWUgcmVsYXRlZCBvcHRpb25zIGFsZXJ0U3RhYmxlRGVsYXksXHJcbiAqIGFuZCBhbGVydE1heGltdW1EZWxheS5cclxuICpcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmdcclxuICogQGF1dGhvciBNaWNoYWVsIEthdXptYW5uIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1JlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVGlueVByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvVGlueVByb3BlcnR5LmpzJztcclxuaW1wb3J0IER5bmFtaWNQcm9wZXJ0eSwgeyBEeW5hbWljUHJvcGVydHlPcHRpb25zIH0gZnJvbSAnLi4vLi4vYXhvbi9qcy9EeW5hbWljUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBJT1R5cGUgZnJvbSAnLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0lPVHlwZS5qcyc7XHJcbmltcG9ydCBTdHJpbmdJTyBmcm9tICcuLi8uLi90YW5kZW0vanMvdHlwZXMvU3RyaW5nSU8uanMnO1xyXG5pbXBvcnQgcmVzcG9uc2VDb2xsZWN0b3IgZnJvbSAnLi9yZXNwb25zZUNvbGxlY3Rvci5qcyc7XHJcbmltcG9ydCBSZXNwb25zZVBhY2tldCwgeyBSZXNvbHZlZFJlc3BvbnNlIH0gZnJvbSAnLi9SZXNwb25zZVBhY2tldC5qcyc7XHJcbmltcG9ydCB1dHRlcmFuY2VRdWV1ZU5hbWVzcGFjZSBmcm9tICcuL3V0dGVyYW5jZVF1ZXVlTmFtZXNwYWNlLmpzJztcclxuaW1wb3J0IFRQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1RQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdWxsYWJsZUlPIGZyb20gJy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdWxsYWJsZUlPLmpzJztcclxuaW1wb3J0IE51bWJlcklPIGZyb20gJy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdW1iZXJJTy5qcyc7XHJcbmltcG9ydCBPcklPIGZyb20gJy4uLy4uL3RhbmRlbS9qcy90eXBlcy9PcklPLmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBEaXNwb3NhYmxlIGZyb20gJy4uLy4uL2F4b24vanMvRGlzcG9zYWJsZS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgREVGQVVMVF9QUklPUklUWSA9IDE7XHJcblxyXG5leHBvcnQgdHlwZSBUQWxlcnRhYmxlID0gUmVzb2x2ZWRSZXNwb25zZSB8ICggKCkgPT4gc3RyaW5nICkgfCBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+IHwgUmVzcG9uc2VQYWNrZXQgfCBVdHRlcmFuY2U7XHJcblxyXG50eXBlIEFsZXJ0YWJsZU5vVXR0ZXJhbmNlID0gRXhjbHVkZTxUQWxlcnRhYmxlLCBVdHRlcmFuY2U+O1xyXG5cclxudHlwZSBTZXJpYWxpemVkVXR0ZXJhbmNlID0ge1xyXG4gIGFsZXJ0OiBSZXNvbHZlZFJlc3BvbnNlO1xyXG59O1xyXG5cclxuLy8gVGhlIG5hbWVzIG9mIFByb3BlcnRpZXMgdGhhdCBjYW4gYmUgYWNjZXNzZWQgb24gVXR0ZXJhbmNlIHRoYXQgYXJlIEFubm91bmNpbmdDb250cm9sUHJvcGVydGllcyBmb3Igc3BlY2lmaWMgQW5ub3VuY2luZ1xyXG4vLyBmZWF0dXJlcy5cclxuZXhwb3J0IHR5cGUgRmVhdHVyZVNwZWNpZmljQW5ub3VuY2luZ0NvbnRyb2xQcm9wZXJ0eSA9ICdkZXNjcmlwdGlvbkNhbkFubm91bmNlUHJvcGVydHknIHwgJ3ZvaWNpbmdDYW5Bbm5vdW5jZVByb3BlcnR5JztcclxuXHJcbnR5cGUgRmVhdHVyZVNwZWNpZmljQW5ub3VuY2luZ0NvbnRyb2xQcm9wZXJ0eVN1cHBvcnRlZCA9IHtcclxuICBbUHJvcGVydHkgaW4gRmVhdHVyZVNwZWNpZmljQW5ub3VuY2luZ0NvbnRyb2xQcm9wZXJ0eV06IEFubm91bmNpbmdDb250cm9sUHJvcGVydHlcclxufTtcclxuXHJcbmxldCBnbG9iYWxJZENvdW50ZXIgPSAxO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gVGhlIGNvbnRlbnQgb2YgdGhlIGFsZXJ0IHRoYXQgdGhpcyBVdHRlcmFuY2UgaXMgd3JhcHBpbmcuXHJcbiAgYWxlcnQ/OiBBbGVydGFibGVOb1V0dGVyYW5jZTtcclxuXHJcbiAgLy8gTGlzdCBvZiBQcm9wZXJ0aWVzIHRoYXQgbXVzdCBhbGwgYmUgdHJ1ZSBpbiBvcmRlciBmb3IgdGhlIFV0dGVyYW5jZSB0byBiZSBhbm5vdW5jZWQgYnkgdGhlIEFubm91bmNlci4gU2VlXHJcbiAgLy8gc2V0Q2FuQW5ub3VuY2VQcm9wZXJ0aWVzKCkgZm9yIG1vcmUgaW5mb3JtYXRpb24uXHJcbiAgY2FuQW5ub3VuY2VQcm9wZXJ0aWVzPzogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj5bXTtcclxuXHJcbiAgLy8gTGlzdCBvZiBQcm9wZXJ0aWVzIHRoYXQgbXVzdCBhbGwgYmUgdHJ1ZSBpbiBvcmRlciBmb3IgdGhlIFV0dGVyYW5jZSB0byBiZSBhbm5vdW5jZWQgdG8gdGhlIEludGVyYWN0aXZlIERlc2NyaXB0aW9uXHJcbiAgLy8gZmVhdHVyZSBvZiBQaEVUIFNpbXVsYXRpb25zLiBjYW5Bbm5vdW5jZVByb3BlcnRpZXMgYWxzbyBhcHBseSAoYW5kIHNvIG11c3QgYWxsIGJlIHRydWUpIHRvIGFubm91bmNlIHdpdGggdGhpc1xyXG4gIC8vIHNwZWNpZmljIGZlYXR1cmUuXHJcbiAgZGVzY3JpcHRpb25DYW5Bbm5vdW5jZVByb3BlcnRpZXM/OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPltdO1xyXG5cclxuICAvLyBMaXN0IG9mIFByb3BlcnRpZXMgdGhhdCBtdXN0IGFsbCBiZSB0cnVlIGluIG9yZGVyIGZvciB0aGUgVXR0ZXJhbmNlIHRvIGJlIGFubm91bmNlZCB0byB0aGUgVm9pY2luZ1xyXG4gIC8vIGZlYXR1cmUgb2YgUGhFVCBTaW11bGF0aW9ucy4gY2FuQW5ub3VuY2VQcm9wZXJ0aWVzIGFsc28gYXBwbHkgKGFuZCBzbyBtdXN0IGFsbCBiZSB0cnVlKSB0byBhbm5vdW5jZSB3aXRoIHRoaXNcclxuICAvLyBzcGVjaWZpYyBmZWF0dXJlLlxyXG4gIHZvaWNpbmdDYW5Bbm5vdW5jZVByb3BlcnRpZXM/OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPltdO1xyXG5cclxuICAvLyBpZiBwcmVkaWNhdGUgcmV0dXJucyBmYWxzZSwgdGhlIGFsZXJ0IGNvbnRlbnQgYXNzb2NpYXRlZFxyXG4gIC8vIHdpdGggdGhpcyB1dHRlcmFuY2Ugd2lsbCBub3QgYmUgYW5ub3VuY2VkIGJ5IHRoZSB1dHRlcmFuY2UtcXVldWUuIEFubm91bmNlcnMgYWxzbyBvcHRpb25hbGx5IGhhdmUgdGhlIGFiaWxpdHlcclxuICAvLyB0byByZXNwZWN0IHRoaXMgcHJlZGljYXRlIGJlZm9yZSB0aGV5IGZpbmFsbHkgYWxlcnQgdGhlIFV0dGVyYW5jZS4gVGhpcyBjYW4gYmUgaGVscGZ1bCBpZiB1dHRlcmFuY2VzIHNpdCBhbmRcclxuICAvLyB3YWl0IGluIHRoZSBhbm5vdW5jZXIgYmVmb3JlIGJlaW5nIGFsZXJ0ZWQuIElmIHRoZSBwcmVkaWNhdGUgZmFpbHMgdGhlcmUgaXMgbm8gcmV0cnkuIFRoZSB1dHRlcmFuY2Ugd2lsbCBiZVxyXG4gIC8vIHJlbW92ZWQgZnJvbSB0aGUgcXVldWUgd2l0aG91dCBhbm5vdW5jaW5nLlxyXG4gIHByZWRpY2F0ZT86ICgpID0+IGJvb2xlYW47XHJcblxyXG4gIC8vIGluIG1zLCBob3cgbG9uZyB0byB3YWl0IGJlZm9yZSB0aGUgdXR0ZXJhbmNlIGlzIGNvbnNpZGVyZWQgXCJzdGFibGVcIiBhbmQgc3RvcHMgYmVpbmdcclxuICAvLyBhZGRlZCB0byB0aGUgcXVldWUsIGF0IHdoaWNoIHBvaW50IGl0IHdpbGwgYmUgc3Bva2VuLiBEZWZhdWx0IHZhbHVlIGNob3NlbiBiZWNhdXNlXHJcbiAgLy8gaXQgc291bmRzIG5pY2UgaW4gbW9zdCB1c2FnZXMgb2YgVXR0ZXJhbmNlIHdpdGggYWxlcnRTdGFibGVEZWxheS4gSWYgeW91IHdhbnQgdG8gaGVhciB0aGUgdXR0ZXJhbmNlIGFzIGZhc3RcclxuICAvLyBhcyBwb3NzaWJsZSwgcmVkdWNlIHRoaXMgZGVsYXkgdG8gMC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zY2VuZXJ5LXBoZXQvaXNzdWVzLzQ5MVxyXG4gIGFsZXJ0U3RhYmxlRGVsYXk/OiBudW1iZXI7XHJcblxyXG4gIC8vIGluIG1zLCB0aGUgbWF4aW11bSBhbW91bnQgb2YgdGltZSB0aGF0IHNob3VsZFxyXG4gIC8vIHBhc3MgYmVmb3JlIHRoaXMgYWxlcnQgc2hvdWxkIGJlIHNwb2tlbiwgZXZlbiBpZiB0aGUgdXR0ZXJhbmNlIGlzIHJhcGlkbHkgYWRkZWQgdG8gdGhlIHF1ZXVlXHJcbiAgLy8gYW5kIGlzIG5vdCBxdWl0ZSBcInN0YWJsZVwiXHJcbiAgYWxlcnRNYXhpbXVtRGVsYXk/OiBudW1iZXI7XHJcblxyXG4gIC8vIE9wdGlvbnMgc3BlY2lmaWMgdG8gdGhlIEFubm91bmNlciBvZiB0aGUgVXR0ZXJhbmNlLiBTZWUgc3VwcG9ydGVkIG9wdGlvbnMgaW4geW91ciBzcGVjaWZpYyBBbm5vdW5jZXInc1xyXG4gIC8vIGFubm91bmNlKCkgZnVuY3Rpb24gKGZvciBleGFtcGxlIEFyaWFMaXZlQW5ub3VuY2VyLmFubm91bmNlKCkpXHJcbiAgYW5ub3VuY2VyT3B0aW9ucz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xyXG5cclxuICAvLyB7bnVtYmVyfSAtIFVzZWQgdG8gZGV0ZXJtaW5lIHdoaWNoIHV0dGVyYW5jZSBtaWdodCBpbnRlcnJ1cHQgYW5vdGhlciB1dHRlcmFuY2UuIFBsZWFzZSBvbmx5IHVzZSBwcmlvcml0eSBzdGF0aWNzXHJcbiAgLy8gb24gVXR0ZXJhbmNlIHdoZW4gc2V0dGluZyB0aGlzIHZhbHVlIGxpa2UgVXR0ZXJhbmNlLk1FRElVTV9QUklPUklUWS5cclxuICAvLyBBbnkgdXR0ZXJhbmNlICgxKSB3aXRoIGEgaGlnaGVyIHByaW9yaXR5IHRoYW4gYW5vdGhlciB1dHRlcmFuY2UgKDIpIHdpbGwgYmVoYXZlIGFzIHN1Y2g6XHJcbiAgLy8gLSAoMSkgd2lsbCBpbnRlcnJ1cHQgKDIpIHdoZW4gKDIpIGlzIGN1cnJlbnRseSBiZWluZyBzcG9rZW4sIGFuZCAoMSkgaXMgYW5ub3VuY2VkIGJ5IHRoZSB2b2ljaW5nTWFuYWdlci4gSW4gdGhpc1xyXG4gIC8vICAgICAgIGNhc2UsICgyKSBpcyBpbnRlcnJ1cHRlZCwgYW5kIG5ldmVyIGZpbmlzaGVkLlxyXG4gIC8vIC0gKDEpIHdpbGwgY29udGludWUgc3BlYWtpbmcgaWYgKDEpIHdhcyBzcGVha2luZywgYW5kICgyKSBpcyBhZGRlZCB0byB0aGUgVXR0ZXJhbmNlUXVldWUuIEluIHRoaXMgY2FzZSAoMilcclxuICAvLyAgICAgICB3aWxsIGJlIHNwb2tlbiB3aGVuICgxKSBpcyBkb25lLiBJbiB0aGlzIGNhc2UgKDIpIHdpbGwgcmVtYWluIGluIHRoZSBxdWV1ZSB3aGlsZSB3YWl0aW5nIGZvciAoMSkgdG8gZmluaXNoLlxyXG4gIHByaW9yaXR5PzogbnVtYmVyO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgVXR0ZXJhbmNlT3B0aW9ucyA9IFNlbGZPcHRpb25zO1xyXG5cclxuY2xhc3MgVXR0ZXJhbmNlIGV4dGVuZHMgRGlzcG9zYWJsZSBpbXBsZW1lbnRzIEZlYXR1cmVTcGVjaWZpY0Fubm91bmNpbmdDb250cm9sUHJvcGVydHlTdXBwb3J0ZWQge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgaWQ6IG51bWJlcjtcclxuICBwcml2YXRlIF9hbGVydDogQWxlcnRhYmxlTm9VdHRlcmFuY2U7XHJcblxyXG4gIC8vIElmIHRoZSB2YWx1ZSBvZiB0aGlzIFByb3BlcnR5IGlzIGZhbHNlLCB0aGlzIFV0dGVyYW5jZSB3aWxsIG5ldmVyIGJlIGFubm91bmNlZCBieSBhbiBBbm5vdW5jZXIuIFNlZVxyXG4gIC8vIGRvY3VtZW50YXRpb24gZm9yIGNhbkFubm91bmNlSW1wbGVtZW50YXRpb25Qcm9wZXJ0eSBmb3IgaW1wbGVtZW50YXRpb24gZGV0YWlscyBhbmQgd2h5IHdlIHVzZSBhIER5bmFtaWNQcm9wZXJ0eS5cclxuICBwdWJsaWMgcmVhZG9ubHkgY2FuQW5ub3VuY2VQcm9wZXJ0eTogQW5ub3VuY2luZ0NvbnRyb2xQcm9wZXJ0eTtcclxuXHJcbiAgLy8gSWYgdGhlIHZhbHVlIG9mIHRoaXMgUHJvcGVydHkgaXMgZmFsc2UsIHRoaXMgVXR0ZXJhbmNlIHdpbGwgbmV2ZXIgYmUgYW5ub3VuY2VkIGJ5IEFyaWFMaXZlQW5ub3VuY2VyLlxyXG4gIHB1YmxpYyByZWFkb25seSBkZXNjcmlwdGlvbkNhbkFubm91bmNlUHJvcGVydHk6IEFubm91bmNpbmdDb250cm9sUHJvcGVydHk7XHJcblxyXG4gIC8vIElmIHRoZSB2YWx1ZSBvZiB0aGlzIFByb3BlcnR5IGlzIGZhbHNlLCB0aGlzIFV0dGVyYW5jZSB3aWxsIG5ldmVyIGJlIGFubm91bmNlZCBieSBTcGVlY2hTeW50aGVzaXNBbm5vdW5jZXIuXHJcbiAgcHVibGljIHJlYWRvbmx5IHZvaWNpbmdDYW5Bbm5vdW5jZVByb3BlcnR5OiBBbm5vdW5jaW5nQ29udHJvbFByb3BlcnR5O1xyXG5cclxuICAvLyAodXR0ZXJhbmNlLXF1ZXVlLWludGVybmFsKVxyXG4gIHB1YmxpYyByZWFkb25seSBwcmVkaWNhdGU6ICgpID0+IGJvb2xlYW47XHJcblxyXG4gIC8vICh1dHRlcmFuY2UtcXVldWUtaW50ZXJuYWwpXHJcbiAgcHVibGljIGFsZXJ0U3RhYmxlRGVsYXk6IG51bWJlcjtcclxuXHJcbiAgLy8gKHV0dGVyYW5jZS1xdWV1ZS1pbnRlcm5hbClcclxuICBwdWJsaWMgYWxlcnRNYXhpbXVtRGVsYXk6IG51bWJlcjtcclxuXHJcbiAgLy8gKHV0dGVyYW5jZS1xdWV1ZS1pbnRlcm5hbClcclxuICBwdWJsaWMgYW5ub3VuY2VyT3B0aW9uczogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XHJcblxyXG4gIC8vIG9ic2VydmFibGUgZm9yIHRoZSBwcmlvcml0eSwgY2FuIGJlIHNldCB0byBjaGFuZ2UgdGhlIHByaW9yaXR5IG9mIHRoaXMgVXR0ZXJhbmNlXHJcbiAgLy8gd2hpbGUgaXQgaXMgc3RpbGwgaW4gdGhlIFV0dGVyYW5jZVF1ZXVlLiBTZWUgb3B0aW9ucyBkb2N1bWVudGF0aW9uIGZvciBiZWhhdmlvciBvZiBwcmlvcml0eS5cclxuICBwdWJsaWMgcHJpb3JpdHlQcm9wZXJ0eTogVFByb3BlcnR5PG51bWJlcj47XHJcblxyXG4gIC8vIHRoZSBwcmV2aW91cyB2YWx1ZSBvZiB0aGUgcmVzb2x2ZWQgXCJhbGVydFwiLiBTZWUgZ2V0QWxlcnRUZXh0KCkuXHJcbiAgcHJpdmF0ZSBwcmV2aW91c0FsZXJ0VGV4dDogUmVzb2x2ZWRSZXNwb25zZTtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM/OiBVdHRlcmFuY2VPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8VXR0ZXJhbmNlT3B0aW9ucywgU2VsZk9wdGlvbnM+KCkoIHtcclxuICAgICAgYWxlcnQ6IG51bGwsXHJcbiAgICAgIHByZWRpY2F0ZTogZnVuY3Rpb24oKSB7IHJldHVybiB0cnVlOyB9LFxyXG4gICAgICBjYW5Bbm5vdW5jZVByb3BlcnRpZXM6IFtdLFxyXG4gICAgICBkZXNjcmlwdGlvbkNhbkFubm91bmNlUHJvcGVydGllczogW10sXHJcbiAgICAgIHZvaWNpbmdDYW5Bbm5vdW5jZVByb3BlcnRpZXM6IFtdLFxyXG4gICAgICBhbGVydFN0YWJsZURlbGF5OiAyMDAsXHJcbiAgICAgIGFsZXJ0TWF4aW11bURlbGF5OiBOdW1iZXIuTUFYX1ZBTFVFLFxyXG4gICAgICBhbm5vdW5jZXJPcHRpb25zOiB7fSxcclxuICAgICAgcHJpb3JpdHk6IERFRkFVTFRfUFJJT1JJVFlcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5pZCA9IGdsb2JhbElkQ291bnRlcisrO1xyXG5cclxuICAgIHRoaXMuX2FsZXJ0ID0gb3B0aW9ucy5hbGVydDtcclxuXHJcbiAgICB0aGlzLnByZWRpY2F0ZSA9IG9wdGlvbnMucHJlZGljYXRlO1xyXG5cclxuICAgIHRoaXMuY2FuQW5ub3VuY2VQcm9wZXJ0eSA9IG5ldyBBbm5vdW5jaW5nQ29udHJvbFByb3BlcnR5KCB7XHJcbiAgICAgIGRlcGVuZGVudFByb3BlcnRpZXM6IG9wdGlvbnMuY2FuQW5ub3VuY2VQcm9wZXJ0aWVzXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmRlc2NyaXB0aW9uQ2FuQW5ub3VuY2VQcm9wZXJ0eSA9IG5ldyBBbm5vdW5jaW5nQ29udHJvbFByb3BlcnR5KCB7XHJcbiAgICAgIGRlcGVuZGVudFByb3BlcnRpZXM6IG9wdGlvbnMuZGVzY3JpcHRpb25DYW5Bbm5vdW5jZVByb3BlcnRpZXNcclxuICAgIH0gKTtcclxuICAgIHRoaXMudm9pY2luZ0NhbkFubm91bmNlUHJvcGVydHkgPSBuZXcgQW5ub3VuY2luZ0NvbnRyb2xQcm9wZXJ0eSgge1xyXG4gICAgICBkZXBlbmRlbnRQcm9wZXJ0aWVzOiBvcHRpb25zLnZvaWNpbmdDYW5Bbm5vdW5jZVByb3BlcnRpZXNcclxuXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFsZXJ0U3RhYmxlRGVsYXkgPSBvcHRpb25zLmFsZXJ0U3RhYmxlRGVsYXk7XHJcblxyXG4gICAgdGhpcy5hbGVydE1heGltdW1EZWxheSA9IG9wdGlvbnMuYWxlcnRNYXhpbXVtRGVsYXk7XHJcblxyXG4gICAgdGhpcy5hbm5vdW5jZXJPcHRpb25zID0gb3B0aW9ucy5hbm5vdW5jZXJPcHRpb25zO1xyXG5cclxuICAgIHRoaXMucHJpb3JpdHlQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggb3B0aW9ucy5wcmlvcml0eSApO1xyXG5cclxuICAgIHRoaXMucHJldmlvdXNBbGVydFRleHQgPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIGFsZXJ0XHJcbiAgICogQHBhcmFtIHJlc3BlY3RSZXNwb25zZUNvbGxlY3RvclByb3BlcnRpZXMgLSBpZiBmYWxzZSwgdGhlbiBkbyBub3QgbGlzdGVuIHRvIHRoZSB2YWx1ZSBvZiByZXNwb25zZUNvbGxlY3RvclxyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBjcmVhdGluZyB0aGUgUmVzcG9uc2VQYWNrZXQgY29uZ2xvbWVyYXRlIChqdXN0IGNvbWJpbmUgYWxsIGF2YWlsYWJsZSkuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0QWxlcnRTdHJpbmdGcm9tUmVzcG9uc2VQYWNrZXQoIGFsZXJ0OiBSZXNwb25zZVBhY2tldCwgcmVzcGVjdFJlc3BvbnNlQ29sbGVjdG9yUHJvcGVydGllczogYm9vbGVhbiApOiBzdHJpbmcge1xyXG5cclxuICAgIGNvbnN0IHJlc3BvbnNlUGFja2V0T3B0aW9ucyA9IGFsZXJ0LnNlcmlhbGl6ZSgpO1xyXG5cclxuICAgIGlmICggIXJlc3BlY3RSZXNwb25zZUNvbGxlY3RvclByb3BlcnRpZXMgKSB7XHJcbiAgICAgIHJlc3BvbnNlUGFja2V0T3B0aW9ucy5pZ25vcmVQcm9wZXJ0aWVzID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXNwb25zZUNvbGxlY3Rvci5jb2xsZWN0UmVzcG9uc2VzKCByZXNwb25zZVBhY2tldE9wdGlvbnMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgc3RyaW5nIHRvIGFsZXJ0LiBUaGlzIGZ1bmN0aW9uIGhhcyBwb3RlbnRpYWwgdG8gcnVuIGEgZnVuY3Rpb24gdG8gZ2VuZXJhdGUgdGhlIHN0cmluZy4gVXNlIHRoaXMgd2l0aCBjYXV0aW9uLlxyXG4gICAqIE1vc3Qgb2Z0ZW4gVXR0ZXJhbmNlUXVldWUgc2hvdWxkIGJlIHRoZSBvbmx5IHNwb3QgY2FsbGluZyB0aGlzLlxyXG4gICAqIEBwYXJhbSByZXNwZWN0UmVzcG9uc2VDb2xsZWN0b3JQcm9wZXJ0aWVzPWZhbHNlIC0gaWYgZmFsc2UsIHRoZW4gZG8gbm90IGxpc3RlbiB0byB0aGUgdmFsdWUgb2YgcmVzcG9uc2VDb2xsZWN0b3JcclxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgY3JlYXRpbmcgdGhlIFJlc3BvbnNlUGFja2V0IGNvbmdsb21lcmF0ZSAoanVzdCBjb21iaW5lIGFsbCB0aGF0IGFyZSBzdXBwbGllZCkuXHJcbiAgICovXHJcbiAgcHVibGljIGdldEFsZXJ0VGV4dCggcmVzcGVjdFJlc3BvbnNlQ29sbGVjdG9yUHJvcGVydGllcyA9IGZhbHNlICk6IFJlc29sdmVkUmVzcG9uc2Uge1xyXG5cclxuICAgIGNvbnN0IGFsZXJ0ID0gVXR0ZXJhbmNlLmFsZXJ0YWJsZVRvVGV4dCggdGhpcy5fYWxlcnQsIHJlc3BlY3RSZXNwb25zZUNvbGxlY3RvclByb3BlcnRpZXMgKTtcclxuXHJcbiAgICB0aGlzLnByZXZpb3VzQWxlcnRUZXh0ID0gYWxlcnQ7XHJcbiAgICByZXR1cm4gYWxlcnQ7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0QWxlcnQoKTogQWxlcnRhYmxlTm9VdHRlcmFuY2Uge1xyXG4gICAgcmV0dXJuIHRoaXMuX2FsZXJ0O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBhbGVydCgpOiBBbGVydGFibGVOb1V0dGVyYW5jZSB7cmV0dXJuIHRoaXMuZ2V0QWxlcnQoKTsgfVxyXG5cclxuICBwdWJsaWMgc2V0IGFsZXJ0KCBhbGVydDogQWxlcnRhYmxlTm9VdHRlcmFuY2UgKSB7IHRoaXMuc2V0QWxlcnQoIGFsZXJ0ICk7IH1cclxuXHJcbiAgcHVibGljIHNldEFsZXJ0KCBhbGVydDogQWxlcnRhYmxlTm9VdHRlcmFuY2UgKTogdm9pZCB7XHJcbiAgICB0aGlzLl9hbGVydCA9IGFsZXJ0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHRoZSBhbGVydFN0YWJsZURlbGF5IHRpbWUsIHNlZSBhbGVydFN0YWJsZURlbGF5IG9wdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cclxuICAgKlxyXG4gICAqIEJFV0FSRSEgV2h5IGRvZXMgdGhlIGRlbGF5IHRpbWUgbmVlZCB0byBiZSBjaGFuZ2VkIGR1cmluZyB0aGUgbGlmZXRpbWUgb2YgYW4gVXR0ZXJhbmNlPyBJdCBkaWQgZm9yXHJcbiAgICogaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2dyYXZpdHktZm9yY2UtbGFiLWJhc2ljcy9pc3N1ZXMvMTQ2LCBidXQgZG9lcyBpdCBmb3IgeW91PyBCZSBzdXJlIHRoZXJlIGlzIGdvb2RcclxuICAgKiByZWFzb24gY2hhbmdpbmcgdGhpcyB2YWx1ZS5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0QWxlcnRTdGFibGVEZWxheSggZGVsYXk6IG51bWJlciApOiB2b2lkIHtcclxuICAgIHRoaXMuYWxlcnRTdGFibGVEZWxheSA9IGRlbGF5O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIHRvU3RyaW5nKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gYFV0dGVyYW5jZV8ke3RoaXMuaWR9IyR7dGhpcy5nZXRBbGVydFRleHQoKX1gO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHRvU3RhdGVPYmplY3QoKTogU2VyaWFsaXplZFV0dGVyYW5jZSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBhbGVydDogTnVsbGFibGVJTyggT3JJTyggWyBTdHJpbmdJTywgTnVtYmVySU8gXSApICkudG9TdGF0ZU9iamVjdCggdGhpcy5nZXRBbGVydFRleHQoKSApXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5wcmV2aW91c0FsZXJ0VGV4dCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIFByb3BlcnRpZXMgY29udHJvbGxpbmcgd2hldGhlciB0aGlzIFV0dGVyYW5jZSBjYW4gYW5ub3VuY2UuIEFsbCBQcm9wZXJ0aWVzIG11c3QgYmVcclxuICAgKiB0cnVlIGZvciB0aGUgYWxlcnQgY29udGVudCBvZiB0aGlzIFV0dGVyYW5jZSB0byBiZSBhbm5vdW5jZWQuIFRoZXNlIFByb3BlcnRpZXMgYXJlIHVzZWQgaW4gdGhlIGltcGxlbWVudGF0aW9uXHJcbiAgICogb2YgdGhpcy5jYW5Bbm5vdW5jZVByb3BlcnR5LiBTZXR0aW5nIG5ldyBjYW5Bbm5vdW5jZVByb3BlcnRpZXMgaGFzIG5vIGltcGFjdCBvbiB0aGUgbGlzdGVuZXJzIGFkZGVkIHRvXHJcbiAgICogdGhpcy5jYW5Bbm5vdW5jZVByb3BlcnR5LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRDYW5Bbm5vdW5jZVByb3BlcnRpZXMoIGNhbkFubm91bmNlUHJvcGVydGllczogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj5bXSApOiB2b2lkIHtcclxuICAgIHRoaXMuY2FuQW5ub3VuY2VQcm9wZXJ0eS5zZXREZXBlbmRlbnRQcm9wZXJ0aWVzKCBjYW5Bbm5vdW5jZVByb3BlcnRpZXMgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgY2FuQW5ub3VuY2VQcm9wZXJ0aWVzKCBjYW5Bbm5vdW5jZVByb3BlcnRpZXM6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+W10gKSB7XHJcbiAgICB0aGlzLnNldENhbkFubm91bmNlUHJvcGVydGllcyggY2FuQW5ub3VuY2VQcm9wZXJ0aWVzICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGNhbkFubm91bmNlUHJvcGVydGllcygpOiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPltdIHsgcmV0dXJuIHRoaXMuZ2V0Q2FuQW5ub3VuY2VQcm9wZXJ0aWVzKCk7IH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHRoZSBQcm9wZXJ0aWVzIHRoYXQgY29udHJvbCB3aGV0aGVyIHRoZSBhbGVydCBjb250ZW50IGZvciB0aGlzIFV0dGVyYW5jZSBjYW4gYmUgYW5ub3VuY2VkLlxyXG4gICAqIEFsbCBtdXN0IGJlIHRydWUgZm9yIHRoZSBhbm5vdW5jZW1lbnQgdG8gb2NjdXIuXHJcbiAgICovXHJcbiAgcHVibGljIGdldENhbkFubm91bmNlUHJvcGVydGllcygpOiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPltdIHtcclxuICAgIHJldHVybiB0aGlzLmNhbkFubm91bmNlUHJvcGVydHkuZ2V0RGVwZW5kZW50UHJvcGVydGllcygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHRoZSBQcm9wZXJ0aWVzIGNvbnRyb2xsaW5nIHdoZXRoZXIgdGhpcyBVdHRlcmFuY2UgY2FuIGFubm91bmNlIHRvIEFyaWFMaXZlQW5ub3VuY2VyLiBBbGwgUHJvcGVydGllcyBtdXN0IGJlXHJcbiAgICogdHJ1ZSBmb3IgdGhlIGFsZXJ0IGNvbnRlbnQgb2YgdGhpcyBVdHRlcmFuY2UgdG8gYmUgYW5ub3VuY2VkLiBUaGVzZSBQcm9wZXJ0aWVzIGFyZSB1c2VkIGluIHRoZSBpbXBsZW1lbnRhdGlvblxyXG4gICAqIG9mIHRoaXMuZGVzY3JpcHRpb25DYW5Bbm5vdW5jZVByb3BlcnR5LiBTZXR0aW5nIG5ldyBkZXNjcmlwdGlvbkNhbkFubm91bmNlUHJvcGVydGllcyBoYXMgbm8gaW1wYWN0IG9uIHRoZVxyXG4gICAqIGxpc3RlbmVycyBhZGRlZCB0byB0aGlzLmRlc2NyaXB0aW9uQ2FuQW5ub3VuY2VQcm9wZXJ0eS4gVG8gYW5ub3VuY2UgdG8gQXJpYUxpdmVBbm5vdW5jZXIsIHRoaXMuY2FuQW5ub3VuY2VQcm9wZXJ0eVxyXG4gICAqIG11c3QgYWxzbyBiZSB0cnVlXHJcbiAgICovXHJcbiAgcHVibGljIHNldERlc2NyaXB0aW9uQ2FuQW5ub3VuY2VQcm9wZXJ0aWVzKCBkZXNjcmlwdGlvbkNhbkFubm91bmNlUHJvcGVydGllczogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj5bXSApOiB2b2lkIHtcclxuICAgIHRoaXMuZGVzY3JpcHRpb25DYW5Bbm5vdW5jZVByb3BlcnR5LnNldERlcGVuZGVudFByb3BlcnRpZXMoIGRlc2NyaXB0aW9uQ2FuQW5ub3VuY2VQcm9wZXJ0aWVzICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IGRlc2NyaXB0aW9uQ2FuQW5ub3VuY2VQcm9wZXJ0aWVzKCBkZXNjcmlwdGlvbkNhbkFubm91bmNlUHJvcGVydGllczogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj5bXSApIHtcclxuICAgIHRoaXMuc2V0RGVzY3JpcHRpb25DYW5Bbm5vdW5jZVByb3BlcnRpZXMoIGRlc2NyaXB0aW9uQ2FuQW5ub3VuY2VQcm9wZXJ0aWVzICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGRlc2NyaXB0aW9uQ2FuQW5ub3VuY2VQcm9wZXJ0aWVzKCk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+W10geyByZXR1cm4gdGhpcy5nZXREZXNjcmlwdGlvbkNhbkFubm91bmNlUHJvcGVydGllcygpOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgUHJvcGVydGllcyB0aGF0IGNvbnRyb2wgd2hldGhlciB0aGUgYWxlcnQgY29udGVudCBmb3IgdGhpcyBVdHRlcmFuY2UgY2FuIGJlIGFubm91bmNlZC5cclxuICAgKiBBbGwgbXVzdCBiZSB0cnVlIGZvciB0aGUgYW5ub3VuY2VtZW50IHRvIG9jY3VyLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXREZXNjcmlwdGlvbkNhbkFubm91bmNlUHJvcGVydGllcygpOiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPltdIHtcclxuICAgIHJldHVybiB0aGlzLmRlc2NyaXB0aW9uQ2FuQW5ub3VuY2VQcm9wZXJ0eS5nZXREZXBlbmRlbnRQcm9wZXJ0aWVzKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIFByb3BlcnRpZXMgY29udHJvbGxpbmcgd2hldGhlciB0aGlzIFV0dGVyYW5jZSBjYW4gYW5ub3VuY2UgdG8gU3BlZWNoU3ludGhlc2lzQW5ub3VuY2VyLiBBbGwgUHJvcGVydGllc1xyXG4gICAqIG11c3QgYmUgdHJ1ZSBmb3IgdGhlIGFsZXJ0IGNvbnRlbnQgb2YgdGhpcyBVdHRlcmFuY2UgdG8gYmUgYW5ub3VuY2VkLiBUaGVzZSBQcm9wZXJ0aWVzIGFyZSB1c2VkIGluIHRoZVxyXG4gICAqIGltcGxlbWVudGF0aW9uIG9mIHRoaXMudm9pY2luZ0NhbkFubm91bmNlUHJvcGVydHkuIFNldHRpbmcgbmV3IHZvaWNpbmdDYW5Bbm5vdW5jZVByb3BlcnRpZXMgaGFzIG5vIGltcGFjdFxyXG4gICAqIG9uIHRoZSBsaXN0ZW5lcnMgYWRkZWQgdG8gdGhpcy52b2ljaW5nQ2FuQW5ub3VuY2VQcm9wZXJ0eS4gVG8gYW5ub3VuY2UgdG8gU3BlZWNoU3ludGhlc2lzQW5ub3VuY2VyLFxyXG4gICAqIHRoaXMuY2FuQW5ub3VuY2VQcm9wZXJ0eSBtdXN0IGFsc28gYmUgdHJ1ZS5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0Vm9pY2luZ0NhbkFubm91bmNlUHJvcGVydGllcyggdm9pY2luZ0NhbkFubm91bmNlUHJvcGVydGllczogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj5bXSApOiB2b2lkIHtcclxuICAgIHRoaXMudm9pY2luZ0NhbkFubm91bmNlUHJvcGVydHkuc2V0RGVwZW5kZW50UHJvcGVydGllcyggdm9pY2luZ0NhbkFubm91bmNlUHJvcGVydGllcyApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCB2b2ljaW5nQ2FuQW5ub3VuY2VQcm9wZXJ0aWVzKCB2b2ljaW5nQ2FuQW5ub3VuY2VQcm9wZXJ0aWVzOiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPltdICkge1xyXG4gICAgdGhpcy5zZXRWb2ljaW5nQ2FuQW5ub3VuY2VQcm9wZXJ0aWVzKCB2b2ljaW5nQ2FuQW5ub3VuY2VQcm9wZXJ0aWVzICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IHZvaWNpbmdDYW5Bbm5vdW5jZVByb3BlcnRpZXMoKTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj5bXSB7IHJldHVybiB0aGlzLmdldFZvaWNpbmdDYW5Bbm5vdW5jZVByb3BlcnRpZXMoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIFByb3BlcnRpZXMgdGhhdCBjb250cm9sIHdoZXRoZXIgdGhlIGFsZXJ0IGNvbnRlbnQgZm9yIHRoaXMgVXR0ZXJhbmNlIGNhbiBiZSBhbm5vdW5jZWQuXHJcbiAgICogQWxsIG11c3QgYmUgdHJ1ZSBmb3IgdGhlIGFubm91bmNlbWVudCB0byBvY2N1ci5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Vm9pY2luZ0NhbkFubm91bmNlUHJvcGVydGllcygpOiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPltdIHtcclxuICAgIHJldHVybiB0aGlzLnZvaWNpbmdDYW5Bbm5vdW5jZVByb3BlcnR5LmdldERlcGVuZGVudFByb3BlcnRpZXMoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1ha2UgZWxpZ2libGUgZm9yIGdhcmJhZ2UgY29sbGVjdGlvbi5cclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuY2FuQW5ub3VuY2VQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLmRlc2NyaXB0aW9uQ2FuQW5ub3VuY2VQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLnZvaWNpbmdDYW5Bbm5vdW5jZVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuXHJcbiAgICB0aGlzLnByaW9yaXR5UHJvcGVydHkuZGlzcG9zZSgpO1xyXG5cclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBhbGVydGFibGVcclxuICAgKiBAcGFyYW0gcmVzcGVjdFJlc3BvbnNlQ29sbGVjdG9yUHJvcGVydGllcz1mYWxzZSAtIGlmIGZhbHNlLCB0aGVuIGRvIG5vdCBsaXN0ZW4gdG8gdGhlIHZhbHVlIG9mIHJlc3BvbnNlQ29sbGVjdG9yXHJcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGNyZWF0aW5nIHRoZSBSZXNwb25zZVBhY2tldCBjb25nbG9tZXJhdGUgKGp1c3QgY29tYmluZSBhbGwgdGhhdCBhcmUgc3VwcGxpZWQpLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgYWxlcnRhYmxlVG9UZXh0KCBhbGVydGFibGU6IFRBbGVydGFibGUsIHJlc3BlY3RSZXNwb25zZUNvbGxlY3RvclByb3BlcnRpZXMgPSBmYWxzZSApOiBSZXNvbHZlZFJlc3BvbnNlIHtcclxuICAgIGxldCBhbGVydDogUmVzb2x2ZWRSZXNwb25zZTtcclxuXHJcbiAgICBpZiAoIHR5cGVvZiBhbGVydGFibGUgPT09ICdmdW5jdGlvbicgKSB7XHJcbiAgICAgIGFsZXJ0ID0gYWxlcnRhYmxlKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggYWxlcnRhYmxlIGluc3RhbmNlb2YgUmVzcG9uc2VQYWNrZXQgKSB7XHJcbiAgICAgIGFsZXJ0ID0gVXR0ZXJhbmNlLmdldEFsZXJ0U3RyaW5nRnJvbVJlc3BvbnNlUGFja2V0KCBhbGVydGFibGUsIHJlc3BlY3RSZXNwb25zZUNvbGxlY3RvclByb3BlcnRpZXMgKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBhbGVydGFibGUgaW5zdGFuY2VvZiBVdHRlcmFuY2UgKSB7XHJcbiAgICAgIHJldHVybiBhbGVydGFibGUuZ2V0QWxlcnRUZXh0KCByZXNwZWN0UmVzcG9uc2VDb2xsZWN0b3JQcm9wZXJ0aWVzICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggYWxlcnRhYmxlIGluc3RhbmNlb2YgUmVhZE9ubHlQcm9wZXJ0eSB8fCBhbGVydGFibGUgaW5zdGFuY2VvZiBUaW55UHJvcGVydHkgKSB7XHJcbiAgICAgIGFsZXJ0ID0gYWxlcnRhYmxlLnZhbHVlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcblxyXG4gICAgICAvLyBOb3RoaW5nIHRvIHByb2Nlc3MgZnJvbSB0aGUgVEFsZXJ0YWJsZSwgaXQgaXMgcmF3IGNvbnRlbnRcclxuICAgICAgYWxlcnQgPSBhbGVydGFibGUgYXMgUmVzb2x2ZWRSZXNwb25zZTtcclxuICAgIH1cclxuICAgIHJldHVybiBhbGVydDtcclxuICB9XHJcblxyXG4gIC8vIFByaW9yaXR5IGxldmVscyB0aGF0IGNhbiBiZSB1c2VkIGJ5IFV0dGVyYW5jZXMgcHJvdmlkaW5nIHRoZSBgYW5ub3VuY2VyT3B0aW9ucy5wcmlvcml0eWAgb3B0aW9uLlxyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgVE9QX1BSSU9SSVRZID0gMTA7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBISUdIX1BSSU9SSVRZID0gNTtcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IE1FRElVTV9QUklPUklUWSA9IDI7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBERUZBVUxUX1BSSU9SSVRZID0gREVGQVVMVF9QUklPUklUWTtcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IExPV19QUklPUklUWSA9IDA7XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgVXR0ZXJhbmNlSU8gPSBuZXcgSU9UeXBlKCAnVXR0ZXJhbmNlSU8nLCB7XHJcbiAgICB2YWx1ZVR5cGU6IFV0dGVyYW5jZSxcclxuICAgIGRvY3VtZW50YXRpb246ICdBbm5vdW5jZXMgdGV4dCB0byBhIHNwZWNpZmljIGJyb3dzZXIgdGVjaG5vbG9neSAobGlrZSBhcmlhLWxpdmUgb3Igd2ViIHNwZWVjaCknLFxyXG4gICAgdG9TdGF0ZU9iamVjdDogKCB1dHRlcmFuY2U6IFV0dGVyYW5jZSApID0+IHV0dGVyYW5jZS50b1N0YXRlT2JqZWN0KCksXHJcbiAgICBzdGF0ZVNjaGVtYToge1xyXG4gICAgICBhbGVydDogTnVsbGFibGVJTyggT3JJTyggWyBTdHJpbmdJTywgTnVtYmVySU8gXSApIClcclxuICAgIH1cclxuICB9ICk7XHJcbn1cclxuXHJcbnR5cGUgQW5ub3VuY2luZ0NvbnRyb2xQcm9wZXJ0eVNlbGZPcHRpb25zID0ge1xyXG4gIGRlcGVuZGVudFByb3BlcnRpZXM/OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPltdO1xyXG59O1xyXG5cclxudHlwZSBBbm5vdW5jaW5nQ29udHJvbFByb3BlcnR5UGFyZW50T3B0aW9ucyA9IER5bmFtaWNQcm9wZXJ0eU9wdGlvbnM8Ym9vbGVhbiwgYm9vbGVhbiwgVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4+O1xyXG50eXBlIEFubm91bmNpbmdDb250cm9sUHJvcGVydHlPcHRpb25zID0gQW5ub3VuY2luZ0NvbnRyb2xQcm9wZXJ0eVNlbGZPcHRpb25zICYgQW5ub3VuY2luZ0NvbnRyb2xQcm9wZXJ0eVBhcmVudE9wdGlvbnM7XHJcblxyXG5jbGFzcyBBbm5vdW5jaW5nQ29udHJvbFByb3BlcnR5IGV4dGVuZHMgRHluYW1pY1Byb3BlcnR5PGJvb2xlYW4sIGJvb2xlYW4sIFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+PiB7XHJcblxyXG4gIC8vIExpc3Qgb2YgUHJvcGVydGllcyB0aGF0IG11c3QgYWxsIGJlIHRydWUgaW4gb3JkZXIgZm9yIHRoZSBVdHRlcmFuY2UgdG8gYmUgYW5ub3VuY2VkIGJ5IHRoZSBBbm5vdW5jZXIuXHJcbiAgcHJpdmF0ZSBfZGVwZW5kZW50UHJvcGVydGllczogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj5bXTtcclxuXHJcbiAgLy8gQSBQcm9wZXJ0eSBmb3IgdGhlIER5bmFtaWNQcm9wZXJ0eS4gVGhlIHZhbHVlIG9mIHRoaXMgUHJvcGVydHkgaXMgdGhlIERlcml2ZWRQcm9wZXJ0eS5hbmQgb2YgYWxsXHJcbiAgLy8gY2FuQW5ub3VuY2VQcm9wZXJ0aWVzLiBUaGUgYmVuZWZpdCBvZiB1c2luZyBhIER5bmFtaWNQcm9wZXJ0eSBpcyB0aGF0IGRlcGVuZGVuY3kgUHJvcGVydGllcyBvZiB0aGVcclxuICAvLyBpbXBsZW1lbnRhdGlvbiBjYW4gY2hhbmdlIChuZXcgRGVyaXZlZFByb3BlcnR5IGluIHNldERlcGVuZGVudFByb3BlcnRpZXMpIGJ1dCB0aGUgbGlzdGVuZXJzIHdpbGwgcmVtYWluXHJcbiAgLy8gdW5hZmZlY3RlZCBvbiB0aGUgY2FuQW5ub3VuY2VQcm9wZXJ0eS5cclxuICBwcml2YXRlIHJlYWRvbmx5IGltcGxlbWVudGF0aW9uUHJvcGVydHk6IFByb3BlcnR5PFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+PjtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM/OiBBbm5vdW5jaW5nQ29udHJvbFByb3BlcnR5T3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPEFubm91bmNpbmdDb250cm9sUHJvcGVydHlPcHRpb25zLCBBbm5vdW5jaW5nQ29udHJvbFByb3BlcnR5U2VsZk9wdGlvbnMsIEFubm91bmNpbmdDb250cm9sUHJvcGVydHlQYXJlbnRPcHRpb25zPigpKCB7XHJcbiAgICAgIGRlcGVuZGVudFByb3BlcnRpZXM6IFtdXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCBpbXBsZW1lbnRhdGlvblByb3BlcnR5ID0gbmV3IFByb3BlcnR5PFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+PiggbmV3IFRpbnlQcm9wZXJ0eSggZmFsc2UgKSApO1xyXG5cclxuICAgIHN1cGVyKCBpbXBsZW1lbnRhdGlvblByb3BlcnR5ICk7XHJcblxyXG4gICAgdGhpcy5fZGVwZW5kZW50UHJvcGVydGllcyA9IFtdO1xyXG4gICAgdGhpcy5pbXBsZW1lbnRhdGlvblByb3BlcnR5ID0gaW1wbGVtZW50YXRpb25Qcm9wZXJ0eTtcclxuICAgIHRoaXMuc2V0RGVwZW5kZW50UHJvcGVydGllcyggb3B0aW9ucy5kZXBlbmRlbnRQcm9wZXJ0aWVzICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIFByb3BlcnRpZXMgY29udHJvbGxpbmcgdGhpcyBQcm9wZXJ0eSdzIHZhbHVlLiBBbGwgUHJvcGVydGllcyBtdXN0IGJlIHRydWUgZm9yIHRoaXMgUHJvcGVydHkgdG8gYmUgdHJ1ZS5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0RGVwZW5kZW50UHJvcGVydGllcyggZGVwZW5kZW50UHJvcGVydGllczogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj5bXSApOiB2b2lkIHtcclxuICAgIGlmICggdGhpcy5pbXBsZW1lbnRhdGlvblByb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICB0aGlzLmltcGxlbWVudGF0aW9uUHJvcGVydHkudmFsdWUuZGlzcG9zZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIG5vIGRlcGVuZGVudFByb3BlcnRpZXMgcHJvdmlkZWQsIHVzZSBhIGR1bW15IFByb3BlcnR5IHRoYXQgd2lsbCBhbHdheXMgYWxsb3cgdGhpcyBVdHRlcmFuY2UgdG8gYW5ub3VuY2UuXHJcbiAgICBjb25zdCBkZXBlbmRlbmN5UHJvcGVydGllcyA9IGRlcGVuZGVudFByb3BlcnRpZXMubGVuZ3RoID09PSAwID8gWyBuZXcgVGlueVByb3BlcnR5KCB0cnVlICkgXSA6IGRlcGVuZGVudFByb3BlcnRpZXM7XHJcblxyXG4gICAgdGhpcy5pbXBsZW1lbnRhdGlvblByb3BlcnR5LnZhbHVlID0gRGVyaXZlZFByb3BlcnR5LmFuZCggZGVwZW5kZW5jeVByb3BlcnRpZXMgKTtcclxuXHJcbiAgICB0aGlzLl9kZXBlbmRlbnRQcm9wZXJ0aWVzID0gZGVwZW5kZW50UHJvcGVydGllcztcclxuICB9XHJcblxyXG5cclxuICBwdWJsaWMgc2V0IGRlcGVuZGVudFByb3BlcnRpZXMoIGRlcGVuZGVudFByb3BlcnRpZXM6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+W10gKSB7IHRoaXMuc2V0RGVwZW5kZW50UHJvcGVydGllcyggZGVwZW5kZW50UHJvcGVydGllcyApOyB9XHJcblxyXG4gIHB1YmxpYyBnZXQgZGVwZW5kZW50UHJvcGVydGllcygpIHsgcmV0dXJuIHRoaXMuZ2V0RGVwZW5kZW50UHJvcGVydGllcygpOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgUHJvcGVydGllcyB0aGF0IGNvbnRyb2wgd2hldGhlciB0aGUgYWxlcnQgY29udGVudCBmb3IgdGhpcyBVdHRlcmFuY2UgY2FuIGJlIGFubm91bmNlZC5cclxuICAgKiBBbGwgbXVzdCBiZSB0cnVlIGZvciB0aGUgYW5ub3VuY2VtZW50IHRvIG9jY3VyLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXREZXBlbmRlbnRQcm9wZXJ0aWVzKCk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+W10ge1xyXG4gICAgcmV0dXJuIHRoaXMuX2RlcGVuZGVudFByb3BlcnRpZXMuc2xpY2UoIDAgKTsgLy8gZGVmZW5zaXZlIGNvcHlcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5pbXBsZW1lbnRhdGlvblByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgIHRoaXMuX2RlcGVuZGVudFByb3BlcnRpZXMgPSBbXTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbnV0dGVyYW5jZVF1ZXVlTmFtZXNwYWNlLnJlZ2lzdGVyKCAnVXR0ZXJhbmNlJywgVXR0ZXJhbmNlICk7XHJcbmV4cG9ydCBkZWZhdWx0IFV0dGVyYW5jZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLGtDQUFrQztBQUM5RCxPQUFPQyxnQkFBZ0IsTUFBTSxtQ0FBbUM7QUFDaEUsT0FBT0MsWUFBWSxNQUFNLCtCQUErQjtBQUN4RCxPQUFPQyxlQUFlLE1BQWtDLGtDQUFrQztBQUMxRixPQUFPQyxjQUFjLE1BQU0saUNBQWlDO0FBQzVELE9BQU9DLFNBQVMsTUFBTSxpQ0FBaUM7QUFDdkQsT0FBT0MsTUFBTSxNQUFNLGlDQUFpQztBQUNwRCxPQUFPQyxRQUFRLE1BQU0sbUNBQW1DO0FB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