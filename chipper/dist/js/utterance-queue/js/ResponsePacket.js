// Copyright 2021-2022, University of Colorado Boulder

/**
 * The ResponsePacket collects the categories of a single "response" into the following sections:
 * "Name Response" - A response that labels (names) some element to describe.
 * "Object Response" - A response directly describing the state of the named element.
 * "Context Response" - A response that describes surrounding context related to the named element or changes to it.
 * "Hint Response" - A response that gives a hint about what en element is for or how to interact with it.
 *
 * A response is most often tied to an element, or an object that is being described/voiced.
 *
 * Individual categories of responses can be enabled or disabled. The ResponsePacket keeps track of all these
 * responses. When it is time to alert the responses of this ResponsePacket, the ResponseCollector will assemble
 * a final string depending on which categories of responses are enabled.
 *
 * @author Jesse Greenberg
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import ReadOnlyProperty from '../../axon/js/ReadOnlyProperty.js';
import TinyProperty from '../../axon/js/TinyProperty.js';
import { optionize3 } from '../../phet-core/js/optionize.js';
import ResponsePatternCollection from './ResponsePatternCollection.js';
import utteranceQueueNamespace from './utteranceQueueNamespace.js';

// The text sent to an Announcer technology, after resolving it from potentially more complicated structures holding a response

// No function creator because we don't want to support the execution of that function.

// Add null support for certain cases

// Defaults can't be functions, it makes it easier for certain cases, like in responseCollector.
const DEFAULT_OPTIONS = {
  nameResponse: null,
  objectResponse: null,
  contextResponse: null,
  hintResponse: null,
  ignoreProperties: false,
  // The collection of string patterns to use when assembling responses based on which
  // responses are provided and which responseCollector Properties are true. See ResponsePatternCollection
  // if you do not want to use the default.
  responsePatternCollection: ResponsePatternCollection.DEFAULT_RESPONSE_PATTERNS
};
class ResponsePacket {
  static DEFAULT_OPTIONS = DEFAULT_OPTIONS;
  constructor(providedOptions) {
    const options = optionize3()({}, DEFAULT_OPTIONS, providedOptions);
    assert && assert(options.responsePatternCollection instanceof ResponsePatternCollection);

    // The response to be spoken for this packet when speaking names. This is usually
    // the same as the description accessible name, typically spoken on focus and on interaction, labelling what the
    // object is. Mutate as needed until time to alert.
    this._nameResponse = options.nameResponse;

    // The response to be spoken for this packet when speaking about object changes. This
    // is usually the state information, such as the current input value. Mutate as needed until time to alert.
    this._objectResponse = options.objectResponse;

    // The response to be spoken for this packet when speaking about context changes.
    // This is usually a response that describes the surrounding changes that have occurred after interacting
    // with the object. Mutate as needed until time to alert.
    this._contextResponse = options.contextResponse;

    // The response to be spoken for this packet when speaking hints. This is usually the response
    // that guides the user toward further interaction with this object if it is important to do so to use
    // the application. Mutate as needed until time to alert.
    this._hintResponse = options.hintResponse;

    // Controls whether or not the name, object, context, and hint responses are controlled
    // by responseCollector Properties. If true, all responses will be spoken when requested, regardless
    // of these Properties. This is often useful for surrounding UI components where it is important
    // that information be heard even when certain responses have been disabled. Mutate as needed until time to alert.
    this.ignoreProperties = options.ignoreProperties;

    // A collection of response patterns that are used when consolidating
    // each response with responseCollector. Controls the order of the Voicing responses and also punctuation
    // used when responses are assembled into final content for the UtteranceQueue. See ResponsePatternCollection for
    // more details. Mutate as needed until time to alert.
    this.responsePatternCollection = options.responsePatternCollection;
  }
  getNameResponse() {
    return ResponsePacket.getResponseText(this._nameResponse);
  }
  get nameResponse() {
    return this.getNameResponse();
  }
  set nameResponse(nameResponse) {
    this.setNameResponse(nameResponse);
  }
  setNameResponse(nameResponse) {
    this._nameResponse = nameResponse;
  }
  getObjectResponse() {
    return ResponsePacket.getResponseText(this._objectResponse);
  }
  get objectResponse() {
    return this.getObjectResponse();
  }
  set objectResponse(objectResponse) {
    this.setObjectResponse(objectResponse);
  }
  setObjectResponse(objectResponse) {
    this._objectResponse = objectResponse;
  }
  getContextResponse() {
    return ResponsePacket.getResponseText(this._contextResponse);
  }
  get contextResponse() {
    return this.getContextResponse();
  }
  set contextResponse(contextResponse) {
    this.setContextResponse(contextResponse);
  }
  setContextResponse(contextResponse) {
    this._contextResponse = contextResponse;
  }
  getHintResponse() {
    return ResponsePacket.getResponseText(this._hintResponse);
  }
  get hintResponse() {
    return this.getHintResponse();
  }
  set hintResponse(hintResponse) {
    this.setHintResponse(hintResponse);
  }
  setHintResponse(hintResponse) {
    this._hintResponse = hintResponse;
  }

  // Map VoicingResponse -> ResolvedResponse (resolve functions and Properties to their values)
  static getResponseText(response) {
    return response instanceof ReadOnlyProperty || response instanceof TinyProperty ? response.value : typeof response === 'function' ? response() : response;
  }
  copy() {
    return new ResponsePacket(this.serialize());
  }
  serialize() {
    return {
      nameResponse: this.nameResponse,
      objectResponse: this.objectResponse,
      contextResponse: this.contextResponse,
      hintResponse: this.hintResponse,
      ignoreProperties: this.ignoreProperties,
      responsePatternCollection: this.responsePatternCollection
    };
  }
}
utteranceQueueNamespace.register('ResponsePacket', ResponsePacket);
export default ResponsePacket;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSZWFkT25seVByb3BlcnR5IiwiVGlueVByb3BlcnR5Iiwib3B0aW9uaXplMyIsIlJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb24iLCJ1dHRlcmFuY2VRdWV1ZU5hbWVzcGFjZSIsIkRFRkFVTFRfT1BUSU9OUyIsIm5hbWVSZXNwb25zZSIsIm9iamVjdFJlc3BvbnNlIiwiY29udGV4dFJlc3BvbnNlIiwiaGludFJlc3BvbnNlIiwiaWdub3JlUHJvcGVydGllcyIsInJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb24iLCJERUZBVUxUX1JFU1BPTlNFX1BBVFRFUk5TIiwiUmVzcG9uc2VQYWNrZXQiLCJjb25zdHJ1Y3RvciIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJhc3NlcnQiLCJfbmFtZVJlc3BvbnNlIiwiX29iamVjdFJlc3BvbnNlIiwiX2NvbnRleHRSZXNwb25zZSIsIl9oaW50UmVzcG9uc2UiLCJnZXROYW1lUmVzcG9uc2UiLCJnZXRSZXNwb25zZVRleHQiLCJzZXROYW1lUmVzcG9uc2UiLCJnZXRPYmplY3RSZXNwb25zZSIsInNldE9iamVjdFJlc3BvbnNlIiwiZ2V0Q29udGV4dFJlc3BvbnNlIiwic2V0Q29udGV4dFJlc3BvbnNlIiwiZ2V0SGludFJlc3BvbnNlIiwic2V0SGludFJlc3BvbnNlIiwicmVzcG9uc2UiLCJ2YWx1ZSIsImNvcHkiLCJzZXJpYWxpemUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlJlc3BvbnNlUGFja2V0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFRoZSBSZXNwb25zZVBhY2tldCBjb2xsZWN0cyB0aGUgY2F0ZWdvcmllcyBvZiBhIHNpbmdsZSBcInJlc3BvbnNlXCIgaW50byB0aGUgZm9sbG93aW5nIHNlY3Rpb25zOlxyXG4gKiBcIk5hbWUgUmVzcG9uc2VcIiAtIEEgcmVzcG9uc2UgdGhhdCBsYWJlbHMgKG5hbWVzKSBzb21lIGVsZW1lbnQgdG8gZGVzY3JpYmUuXHJcbiAqIFwiT2JqZWN0IFJlc3BvbnNlXCIgLSBBIHJlc3BvbnNlIGRpcmVjdGx5IGRlc2NyaWJpbmcgdGhlIHN0YXRlIG9mIHRoZSBuYW1lZCBlbGVtZW50LlxyXG4gKiBcIkNvbnRleHQgUmVzcG9uc2VcIiAtIEEgcmVzcG9uc2UgdGhhdCBkZXNjcmliZXMgc3Vycm91bmRpbmcgY29udGV4dCByZWxhdGVkIHRvIHRoZSBuYW1lZCBlbGVtZW50IG9yIGNoYW5nZXMgdG8gaXQuXHJcbiAqIFwiSGludCBSZXNwb25zZVwiIC0gQSByZXNwb25zZSB0aGF0IGdpdmVzIGEgaGludCBhYm91dCB3aGF0IGVuIGVsZW1lbnQgaXMgZm9yIG9yIGhvdyB0byBpbnRlcmFjdCB3aXRoIGl0LlxyXG4gKlxyXG4gKiBBIHJlc3BvbnNlIGlzIG1vc3Qgb2Z0ZW4gdGllZCB0byBhbiBlbGVtZW50LCBvciBhbiBvYmplY3QgdGhhdCBpcyBiZWluZyBkZXNjcmliZWQvdm9pY2VkLlxyXG4gKlxyXG4gKiBJbmRpdmlkdWFsIGNhdGVnb3JpZXMgb2YgcmVzcG9uc2VzIGNhbiBiZSBlbmFibGVkIG9yIGRpc2FibGVkLiBUaGUgUmVzcG9uc2VQYWNrZXQga2VlcHMgdHJhY2sgb2YgYWxsIHRoZXNlXHJcbiAqIHJlc3BvbnNlcy4gV2hlbiBpdCBpcyB0aW1lIHRvIGFsZXJ0IHRoZSByZXNwb25zZXMgb2YgdGhpcyBSZXNwb25zZVBhY2tldCwgdGhlIFJlc3BvbnNlQ29sbGVjdG9yIHdpbGwgYXNzZW1ibGVcclxuICogYSBmaW5hbCBzdHJpbmcgZGVwZW5kaW5nIG9uIHdoaWNoIGNhdGVnb3JpZXMgb2YgcmVzcG9uc2VzIGFyZSBlbmFibGVkLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZ1xyXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9SZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IFRpbnlQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1RpbnlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgb3B0aW9uaXplMywgT3B0aW9uaXplRGVmYXVsdHMgfSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb24gZnJvbSAnLi9SZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uLmpzJztcclxuaW1wb3J0IHV0dGVyYW5jZVF1ZXVlTmFtZXNwYWNlIGZyb20gJy4vdXR0ZXJhbmNlUXVldWVOYW1lc3BhY2UuanMnO1xyXG5cclxuLy8gVGhlIHRleHQgc2VudCB0byBhbiBBbm5vdW5jZXIgdGVjaG5vbG9neSwgYWZ0ZXIgcmVzb2x2aW5nIGl0IGZyb20gcG90ZW50aWFsbHkgbW9yZSBjb21wbGljYXRlZCBzdHJ1Y3R1cmVzIGhvbGRpbmcgYSByZXNwb25zZVxyXG5leHBvcnQgdHlwZSBSZXNvbHZlZFJlc3BvbnNlID0gc3RyaW5nIHwgbnVtYmVyIHwgbnVsbDtcclxuXHJcbnR5cGUgUmVzcG9uc2VDcmVhdG9yID0gVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPiB8ICggKCkgPT4gUmVzb2x2ZWRSZXNwb25zZSApO1xyXG5leHBvcnQgdHlwZSBWb2ljaW5nUmVzcG9uc2UgPSBSZXNwb25zZUNyZWF0b3IgfCBSZXNvbHZlZFJlc3BvbnNlO1xyXG5cclxuLy8gTm8gZnVuY3Rpb24gY3JlYXRvciBiZWNhdXNlIHdlIGRvbid0IHdhbnQgdG8gc3VwcG9ydCB0aGUgZXhlY3V0aW9uIG9mIHRoYXQgZnVuY3Rpb24uXHJcbmV4cG9ydCB0eXBlIFNwZWFrYWJsZVJlc29sdmVkUmVzcG9uc2UgPSBSZXNvbHZlZFJlc3BvbnNlIHwgVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPjtcclxuXHJcbmV4cG9ydCB0eXBlIFJlc3BvbnNlUGFja2V0T3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gc3Bva2VuIHdoZW4gbmFtZSByZXNwb25zZXMgYXJlIGVuYWJsZWRcclxuICBuYW1lUmVzcG9uc2U/OiBWb2ljaW5nUmVzcG9uc2U7XHJcblxyXG4gIC8vIHNwb2tlbiB3aGVuIG9iamVjdCByZXNwb25zZXMgYXJlIGVuYWJsZWRcclxuICBvYmplY3RSZXNwb25zZT86IFZvaWNpbmdSZXNwb25zZTtcclxuXHJcbiAgLy8gc3Bva2VuIHdoZW4gY29udGV4dCByZXNwb25zZXMgYXJlIGVuYWJsZWRcclxuICBjb250ZXh0UmVzcG9uc2U/OiBWb2ljaW5nUmVzcG9uc2U7XHJcblxyXG4gIC8vIHNwb2tlbiB3aGVuIGludGVyYWN0aW9uIGhpbnRzIGFyZSBlbmFibGVkXHJcbiAgaGludFJlc3BvbnNlPzogVm9pY2luZ1Jlc3BvbnNlO1xyXG5cclxuICAvLyBXaGV0aGVyIHRoaXMgcmVzcG9uc2Ugc2hvdWxkIGlnbm9yZSB0aGUgUHJvcGVydGllcyBvZiByZXNwb25zZUNvbGxlY3Rvci4gSWYgdHJ1ZSwgdGhlIG5hbWVSZXNwb25zZSwgb2JqZWN0UmVzcG9uc2UsXHJcbiAgLy8gY29udGV4dFJlc3BvbnNlLCBhbmQgaW50ZXJhY3Rpb25IaW50IHdpbGwgYWxsIGJlIHNwb2tlbiByZWdhcmRsZXNzIG9mIHRoZSB2YWx1ZXMgb2YgdGhlIFByb3BlcnRpZXMgb2YgcmVzcG9uc2VDb2xsZWN0b3JcclxuICBpZ25vcmVQcm9wZXJ0aWVzPzogYm9vbGVhbjtcclxuXHJcbiAgLy8gQ29sbGVjdGlvbiBvZiBzdHJpbmcgcGF0dGVybnMgdG8gdXNlIHdpdGggcmVzcG9uc2VDb2xsZWN0b3IuY29sbGVjdFJlc3BvbnNlcywgc2VlIFJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb24gZm9yXHJcbiAgLy8gbW9yZSBpbmZvcm1hdGlvbi5cclxuICByZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uPzogUmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvbjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFNwZWFrYWJsZVJlc29sdmVkT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gSW4gc3BlYWtpbmcgb3B0aW9ucywgd2UgZG9uJ3QgYWxsb3cgYSBSZXNwb25zZUNyZWF0b3IgZnVuY3Rpb24sIGJ1dCBqdXN0IGEgc3RyaW5nfG51bGwuIFRoZSBgdW5kZWZpbmVkYCBpcyB0b1xyXG4gIC8vIG1hdGNoIG9uIHRoZSBwcm9wZXJ0aWVzIGJlY2F1c2UgdGhleSBhcmUgb3B0aW9uYWwgKG1hcmtlZCB3aXRoIGA/YClcclxuICBbUHJvcGVydHlOYW1lIGluIGtleW9mIFJlc3BvbnNlUGFja2V0T3B0aW9uc106IFJlc3BvbnNlUGFja2V0T3B0aW9uc1tQcm9wZXJ0eU5hbWVdIGV4dGVuZHMgKCBWb2ljaW5nUmVzcG9uc2UgfCB1bmRlZmluZWQgKSA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGVha2FibGVSZXNvbHZlZFJlc3BvbnNlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlUGFja2V0T3B0aW9uc1tQcm9wZXJ0eU5hbWVdO1xyXG59O1xyXG5cclxuLy8gQWRkIG51bGwgc3VwcG9ydCBmb3IgY2VydGFpbiBjYXNlc1xyXG5leHBvcnQgdHlwZSBTcGVha2FibGVOdWxsYWJsZVJlc29sdmVkT3B0aW9ucyA9IHtcclxuICBbUHJvcGVydHlOYW1lIGluIGtleW9mIFNwZWFrYWJsZVJlc29sdmVkT3B0aW9uc106IFNwZWFrYWJsZVJlc29sdmVkT3B0aW9uc1tQcm9wZXJ0eU5hbWVdIGV4dGVuZHMgU3BlYWthYmxlUmVzb2x2ZWRSZXNwb25zZSA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGVha2FibGVSZXNvbHZlZFJlc3BvbnNlIHwgbnVsbCA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGVha2FibGVSZXNvbHZlZE9wdGlvbnNbUHJvcGVydHlOYW1lXTtcclxufTtcclxuXHJcbi8vIERlZmF1bHRzIGNhbid0IGJlIGZ1bmN0aW9ucywgaXQgbWFrZXMgaXQgZWFzaWVyIGZvciBjZXJ0YWluIGNhc2VzLCBsaWtlIGluIHJlc3BvbnNlQ29sbGVjdG9yLlxyXG5jb25zdCBERUZBVUxUX09QVElPTlM6IE9wdGlvbml6ZURlZmF1bHRzPFNwZWFrYWJsZU51bGxhYmxlUmVzb2x2ZWRPcHRpb25zPiA9IHtcclxuICBuYW1lUmVzcG9uc2U6IG51bGwsXHJcbiAgb2JqZWN0UmVzcG9uc2U6IG51bGwsXHJcbiAgY29udGV4dFJlc3BvbnNlOiBudWxsLFxyXG4gIGhpbnRSZXNwb25zZTogbnVsbCxcclxuICBpZ25vcmVQcm9wZXJ0aWVzOiBmYWxzZSxcclxuXHJcbiAgLy8gVGhlIGNvbGxlY3Rpb24gb2Ygc3RyaW5nIHBhdHRlcm5zIHRvIHVzZSB3aGVuIGFzc2VtYmxpbmcgcmVzcG9uc2VzIGJhc2VkIG9uIHdoaWNoXHJcbiAgLy8gcmVzcG9uc2VzIGFyZSBwcm92aWRlZCBhbmQgd2hpY2ggcmVzcG9uc2VDb2xsZWN0b3IgUHJvcGVydGllcyBhcmUgdHJ1ZS4gU2VlIFJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb25cclxuICAvLyBpZiB5b3UgZG8gbm90IHdhbnQgdG8gdXNlIHRoZSBkZWZhdWx0LlxyXG4gIHJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb246IFJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb24uREVGQVVMVF9SRVNQT05TRV9QQVRURVJOU1xyXG59O1xyXG5cclxuY2xhc3MgUmVzcG9uc2VQYWNrZXQge1xyXG4gIHByaXZhdGUgX25hbWVSZXNwb25zZTogVm9pY2luZ1Jlc3BvbnNlO1xyXG4gIHByaXZhdGUgX29iamVjdFJlc3BvbnNlOiBWb2ljaW5nUmVzcG9uc2U7XHJcbiAgcHJpdmF0ZSBfY29udGV4dFJlc3BvbnNlOiBWb2ljaW5nUmVzcG9uc2U7XHJcbiAgcHJpdmF0ZSBfaGludFJlc3BvbnNlOiBWb2ljaW5nUmVzcG9uc2U7XHJcblxyXG4gIHB1YmxpYyBpZ25vcmVQcm9wZXJ0aWVzOiBib29sZWFuO1xyXG4gIHB1YmxpYyByZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uOiBSZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uO1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgREVGQVVMVF9PUFRJT05TID0gREVGQVVMVF9PUFRJT05TO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3ZpZGVkT3B0aW9ucz86IFJlc3BvbnNlUGFja2V0T3B0aW9ucyApIHtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemUzPFJlc3BvbnNlUGFja2V0T3B0aW9ucz4oKSgge30sIERFRkFVTFRfT1BUSU9OUywgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5yZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uIGluc3RhbmNlb2YgUmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvbiApO1xyXG5cclxuICAgIC8vIFRoZSByZXNwb25zZSB0byBiZSBzcG9rZW4gZm9yIHRoaXMgcGFja2V0IHdoZW4gc3BlYWtpbmcgbmFtZXMuIFRoaXMgaXMgdXN1YWxseVxyXG4gICAgLy8gdGhlIHNhbWUgYXMgdGhlIGRlc2NyaXB0aW9uIGFjY2Vzc2libGUgbmFtZSwgdHlwaWNhbGx5IHNwb2tlbiBvbiBmb2N1cyBhbmQgb24gaW50ZXJhY3Rpb24sIGxhYmVsbGluZyB3aGF0IHRoZVxyXG4gICAgLy8gb2JqZWN0IGlzLiBNdXRhdGUgYXMgbmVlZGVkIHVudGlsIHRpbWUgdG8gYWxlcnQuXHJcbiAgICB0aGlzLl9uYW1lUmVzcG9uc2UgPSBvcHRpb25zLm5hbWVSZXNwb25zZTtcclxuXHJcbiAgICAvLyBUaGUgcmVzcG9uc2UgdG8gYmUgc3Bva2VuIGZvciB0aGlzIHBhY2tldCB3aGVuIHNwZWFraW5nIGFib3V0IG9iamVjdCBjaGFuZ2VzLiBUaGlzXHJcbiAgICAvLyBpcyB1c3VhbGx5IHRoZSBzdGF0ZSBpbmZvcm1hdGlvbiwgc3VjaCBhcyB0aGUgY3VycmVudCBpbnB1dCB2YWx1ZS4gTXV0YXRlIGFzIG5lZWRlZCB1bnRpbCB0aW1lIHRvIGFsZXJ0LlxyXG4gICAgdGhpcy5fb2JqZWN0UmVzcG9uc2UgPSBvcHRpb25zLm9iamVjdFJlc3BvbnNlO1xyXG5cclxuICAgIC8vIFRoZSByZXNwb25zZSB0byBiZSBzcG9rZW4gZm9yIHRoaXMgcGFja2V0IHdoZW4gc3BlYWtpbmcgYWJvdXQgY29udGV4dCBjaGFuZ2VzLlxyXG4gICAgLy8gVGhpcyBpcyB1c3VhbGx5IGEgcmVzcG9uc2UgdGhhdCBkZXNjcmliZXMgdGhlIHN1cnJvdW5kaW5nIGNoYW5nZXMgdGhhdCBoYXZlIG9jY3VycmVkIGFmdGVyIGludGVyYWN0aW5nXHJcbiAgICAvLyB3aXRoIHRoZSBvYmplY3QuIE11dGF0ZSBhcyBuZWVkZWQgdW50aWwgdGltZSB0byBhbGVydC5cclxuICAgIHRoaXMuX2NvbnRleHRSZXNwb25zZSA9IG9wdGlvbnMuY29udGV4dFJlc3BvbnNlO1xyXG5cclxuICAgIC8vIFRoZSByZXNwb25zZSB0byBiZSBzcG9rZW4gZm9yIHRoaXMgcGFja2V0IHdoZW4gc3BlYWtpbmcgaGludHMuIFRoaXMgaXMgdXN1YWxseSB0aGUgcmVzcG9uc2VcclxuICAgIC8vIHRoYXQgZ3VpZGVzIHRoZSB1c2VyIHRvd2FyZCBmdXJ0aGVyIGludGVyYWN0aW9uIHdpdGggdGhpcyBvYmplY3QgaWYgaXQgaXMgaW1wb3J0YW50IHRvIGRvIHNvIHRvIHVzZVxyXG4gICAgLy8gdGhlIGFwcGxpY2F0aW9uLiBNdXRhdGUgYXMgbmVlZGVkIHVudGlsIHRpbWUgdG8gYWxlcnQuXHJcbiAgICB0aGlzLl9oaW50UmVzcG9uc2UgPSBvcHRpb25zLmhpbnRSZXNwb25zZTtcclxuXHJcbiAgICAvLyBDb250cm9scyB3aGV0aGVyIG9yIG5vdCB0aGUgbmFtZSwgb2JqZWN0LCBjb250ZXh0LCBhbmQgaGludCByZXNwb25zZXMgYXJlIGNvbnRyb2xsZWRcclxuICAgIC8vIGJ5IHJlc3BvbnNlQ29sbGVjdG9yIFByb3BlcnRpZXMuIElmIHRydWUsIGFsbCByZXNwb25zZXMgd2lsbCBiZSBzcG9rZW4gd2hlbiByZXF1ZXN0ZWQsIHJlZ2FyZGxlc3NcclxuICAgIC8vIG9mIHRoZXNlIFByb3BlcnRpZXMuIFRoaXMgaXMgb2Z0ZW4gdXNlZnVsIGZvciBzdXJyb3VuZGluZyBVSSBjb21wb25lbnRzIHdoZXJlIGl0IGlzIGltcG9ydGFudFxyXG4gICAgLy8gdGhhdCBpbmZvcm1hdGlvbiBiZSBoZWFyZCBldmVuIHdoZW4gY2VydGFpbiByZXNwb25zZXMgaGF2ZSBiZWVuIGRpc2FibGVkLiBNdXRhdGUgYXMgbmVlZGVkIHVudGlsIHRpbWUgdG8gYWxlcnQuXHJcbiAgICB0aGlzLmlnbm9yZVByb3BlcnRpZXMgPSBvcHRpb25zLmlnbm9yZVByb3BlcnRpZXM7XHJcblxyXG4gICAgLy8gQSBjb2xsZWN0aW9uIG9mIHJlc3BvbnNlIHBhdHRlcm5zIHRoYXQgYXJlIHVzZWQgd2hlbiBjb25zb2xpZGF0aW5nXHJcbiAgICAvLyBlYWNoIHJlc3BvbnNlIHdpdGggcmVzcG9uc2VDb2xsZWN0b3IuIENvbnRyb2xzIHRoZSBvcmRlciBvZiB0aGUgVm9pY2luZyByZXNwb25zZXMgYW5kIGFsc28gcHVuY3R1YXRpb25cclxuICAgIC8vIHVzZWQgd2hlbiByZXNwb25zZXMgYXJlIGFzc2VtYmxlZCBpbnRvIGZpbmFsIGNvbnRlbnQgZm9yIHRoZSBVdHRlcmFuY2VRdWV1ZS4gU2VlIFJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb24gZm9yXHJcbiAgICAvLyBtb3JlIGRldGFpbHMuIE11dGF0ZSBhcyBuZWVkZWQgdW50aWwgdGltZSB0byBhbGVydC5cclxuICAgIHRoaXMucmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvbiA9IG9wdGlvbnMucmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvbjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXROYW1lUmVzcG9uc2UoKTogUmVzb2x2ZWRSZXNwb25zZSB7XHJcbiAgICByZXR1cm4gUmVzcG9uc2VQYWNrZXQuZ2V0UmVzcG9uc2VUZXh0KCB0aGlzLl9uYW1lUmVzcG9uc2UgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgbmFtZVJlc3BvbnNlKCk6IFJlc29sdmVkUmVzcG9uc2UgeyByZXR1cm4gdGhpcy5nZXROYW1lUmVzcG9uc2UoKTsgfVxyXG5cclxuICBwdWJsaWMgc2V0IG5hbWVSZXNwb25zZSggbmFtZVJlc3BvbnNlOiBWb2ljaW5nUmVzcG9uc2UgKSB7IHRoaXMuc2V0TmFtZVJlc3BvbnNlKCBuYW1lUmVzcG9uc2UgKTsgfVxyXG5cclxuICBwdWJsaWMgc2V0TmFtZVJlc3BvbnNlKCBuYW1lUmVzcG9uc2U6IFZvaWNpbmdSZXNwb25zZSApOiB2b2lkIHtcclxuICAgIHRoaXMuX25hbWVSZXNwb25zZSA9IG5hbWVSZXNwb25zZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRPYmplY3RSZXNwb25zZSgpOiBSZXNvbHZlZFJlc3BvbnNlIHtcclxuICAgIHJldHVybiBSZXNwb25zZVBhY2tldC5nZXRSZXNwb25zZVRleHQoIHRoaXMuX29iamVjdFJlc3BvbnNlICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IG9iamVjdFJlc3BvbnNlKCk6IFJlc29sdmVkUmVzcG9uc2UgeyByZXR1cm4gdGhpcy5nZXRPYmplY3RSZXNwb25zZSgpOyB9XHJcblxyXG4gIHB1YmxpYyBzZXQgb2JqZWN0UmVzcG9uc2UoIG9iamVjdFJlc3BvbnNlOiBWb2ljaW5nUmVzcG9uc2UgKSB7IHRoaXMuc2V0T2JqZWN0UmVzcG9uc2UoIG9iamVjdFJlc3BvbnNlICk7IH1cclxuXHJcbiAgcHVibGljIHNldE9iamVjdFJlc3BvbnNlKCBvYmplY3RSZXNwb25zZTogVm9pY2luZ1Jlc3BvbnNlICk6IHZvaWQge1xyXG4gICAgdGhpcy5fb2JqZWN0UmVzcG9uc2UgPSBvYmplY3RSZXNwb25zZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRDb250ZXh0UmVzcG9uc2UoKTogUmVzb2x2ZWRSZXNwb25zZSB7XHJcbiAgICByZXR1cm4gUmVzcG9uc2VQYWNrZXQuZ2V0UmVzcG9uc2VUZXh0KCB0aGlzLl9jb250ZXh0UmVzcG9uc2UgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgY29udGV4dFJlc3BvbnNlKCk6IFJlc29sdmVkUmVzcG9uc2UgeyByZXR1cm4gdGhpcy5nZXRDb250ZXh0UmVzcG9uc2UoKTsgfVxyXG5cclxuICBwdWJsaWMgc2V0IGNvbnRleHRSZXNwb25zZSggY29udGV4dFJlc3BvbnNlOiBWb2ljaW5nUmVzcG9uc2UgKSB7IHRoaXMuc2V0Q29udGV4dFJlc3BvbnNlKCBjb250ZXh0UmVzcG9uc2UgKTsgfVxyXG5cclxuICBwdWJsaWMgc2V0Q29udGV4dFJlc3BvbnNlKCBjb250ZXh0UmVzcG9uc2U6IFZvaWNpbmdSZXNwb25zZSApOiB2b2lkIHtcclxuICAgIHRoaXMuX2NvbnRleHRSZXNwb25zZSA9IGNvbnRleHRSZXNwb25zZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRIaW50UmVzcG9uc2UoKTogUmVzb2x2ZWRSZXNwb25zZSB7XHJcbiAgICByZXR1cm4gUmVzcG9uc2VQYWNrZXQuZ2V0UmVzcG9uc2VUZXh0KCB0aGlzLl9oaW50UmVzcG9uc2UgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgaGludFJlc3BvbnNlKCk6IFJlc29sdmVkUmVzcG9uc2UgeyByZXR1cm4gdGhpcy5nZXRIaW50UmVzcG9uc2UoKTsgfVxyXG5cclxuICBwdWJsaWMgc2V0IGhpbnRSZXNwb25zZSggaGludFJlc3BvbnNlOiBWb2ljaW5nUmVzcG9uc2UgKSB7IHRoaXMuc2V0SGludFJlc3BvbnNlKCBoaW50UmVzcG9uc2UgKTsgfVxyXG5cclxuICBwdWJsaWMgc2V0SGludFJlc3BvbnNlKCBoaW50UmVzcG9uc2U6IFZvaWNpbmdSZXNwb25zZSApOiB2b2lkIHtcclxuICAgIHRoaXMuX2hpbnRSZXNwb25zZSA9IGhpbnRSZXNwb25zZTtcclxuICB9XHJcblxyXG4gIC8vIE1hcCBWb2ljaW5nUmVzcG9uc2UgLT4gUmVzb2x2ZWRSZXNwb25zZSAocmVzb2x2ZSBmdW5jdGlvbnMgYW5kIFByb3BlcnRpZXMgdG8gdGhlaXIgdmFsdWVzKVxyXG4gIHB1YmxpYyBzdGF0aWMgZ2V0UmVzcG9uc2VUZXh0KCByZXNwb25zZTogVm9pY2luZ1Jlc3BvbnNlICk6IFJlc29sdmVkUmVzcG9uc2Uge1xyXG4gICAgcmV0dXJuIHJlc3BvbnNlIGluc3RhbmNlb2YgUmVhZE9ubHlQcm9wZXJ0eSB8fCByZXNwb25zZSBpbnN0YW5jZW9mIFRpbnlQcm9wZXJ0eSA/IHJlc3BvbnNlLnZhbHVlIDpcclxuICAgICAgICAgICB0eXBlb2YgcmVzcG9uc2UgPT09ICdmdW5jdGlvbicgPyByZXNwb25zZSgpIDogcmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY29weSgpOiBSZXNwb25zZVBhY2tldCB7XHJcbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlUGFja2V0KCB0aGlzLnNlcmlhbGl6ZSgpICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2VyaWFsaXplKCk6IFJlcXVpcmVkPFNwZWFrYWJsZU51bGxhYmxlUmVzb2x2ZWRPcHRpb25zPiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuYW1lUmVzcG9uc2U6IHRoaXMubmFtZVJlc3BvbnNlLFxyXG4gICAgICBvYmplY3RSZXNwb25zZTogdGhpcy5vYmplY3RSZXNwb25zZSxcclxuICAgICAgY29udGV4dFJlc3BvbnNlOiB0aGlzLmNvbnRleHRSZXNwb25zZSxcclxuICAgICAgaGludFJlc3BvbnNlOiB0aGlzLmhpbnRSZXNwb25zZSxcclxuICAgICAgaWdub3JlUHJvcGVydGllczogdGhpcy5pZ25vcmVQcm9wZXJ0aWVzLFxyXG4gICAgICByZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uOiB0aGlzLnJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb25cclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG51dHRlcmFuY2VRdWV1ZU5hbWVzcGFjZS5yZWdpc3RlciggJ1Jlc3BvbnNlUGFja2V0JywgUmVzcG9uc2VQYWNrZXQgKTtcclxuZXhwb3J0IGRlZmF1bHQgUmVzcG9uc2VQYWNrZXQ7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxnQkFBZ0IsTUFBTSxtQ0FBbUM7QUFDaEUsT0FBT0MsWUFBWSxNQUFNLCtCQUErQjtBQUV4RCxTQUFTQyxVQUFVLFFBQTJCLGlDQUFpQztBQUMvRSxPQUFPQyx5QkFBeUIsTUFBTSxnQ0FBZ0M7QUFDdEUsT0FBT0MsdUJBQXVCLE1BQU0sOEJBQThCOztBQUVsRTs7QUFNQTs7QUFtQ0E7O0FBT0E7QUFDQSxNQUFNQyxlQUFvRSxHQUFHO0VBQzNFQyxZQUFZLEVBQUUsSUFBSTtFQUNsQkMsY0FBYyxFQUFFLElBQUk7RUFDcEJDLGVBQWUsRUFBRSxJQUFJO0VBQ3JCQyxZQUFZLEVBQUUsSUFBSTtFQUNsQkMsZ0JBQWdCLEVBQUUsS0FBSztFQUV2QjtFQUNBO0VBQ0E7RUFDQUMseUJBQXlCLEVBQUVSLHlCQUF5QixDQUFDUztBQUN2RCxDQUFDO0FBRUQsTUFBTUMsY0FBYyxDQUFDO0VBUW5CLE9BQXVCUixlQUFlLEdBQUdBLGVBQWU7RUFFakRTLFdBQVdBLENBQUVDLGVBQXVDLEVBQUc7SUFDNUQsTUFBTUMsT0FBTyxHQUFHZCxVQUFVLENBQXdCLENBQUMsQ0FBRSxDQUFDLENBQUMsRUFBRUcsZUFBZSxFQUFFVSxlQUFnQixDQUFDO0lBRTNGRSxNQUFNLElBQUlBLE1BQU0sQ0FBRUQsT0FBTyxDQUFDTCx5QkFBeUIsWUFBWVIseUJBQTBCLENBQUM7O0lBRTFG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