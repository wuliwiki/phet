// Copyright 2014-2023, University of Colorado Boulder

/**
 * The GravityAndOrbitsModel has an array of GravityAndOrbitsScenes, one scene for each configuration of bodies (e.g.,
 * Star + Planet). Each scene has its own model, canvas, clock, etc, which are used in place of this Module's data.
 * The model contains information that is shared across all modes, such as whether certain features are shown (such as
 * showing the gravitational force).
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Jonathan Olson (PhET Interactive Simulations)
 * @author Chris Malley (PixelZoom, Inc.)
 * @author John Blanco (PhET Interactive Simulations)
 * @author Aaron Davis (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import EnumerationProperty from '../../../../axon/js/EnumerationProperty.js';
import Property from '../../../../axon/js/Property.js';
import PhysicalConstants from '../../../../phet-core/js/PhysicalConstants.js';
import TimeSpeed from '../../../../scenery-phet/js/TimeSpeed.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import IOType from '../../../../tandem/js/types/IOType.js';
import ReferenceIO from '../../../../tandem/js/types/ReferenceIO.js';
import gravityAndOrbits from '../../gravityAndOrbits.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
// constants
const G = PhysicalConstants.GRAVITATIONAL_CONSTANT;
class GravityAndOrbitsModel {
  static G = G;

  // True if when a value changes, it is allowed to be accepted as a new "initial condition" for an experiment

  constructor(showMeasuringTape, createModes, initialSceneIndex, showMassCheckbox, tandem) {
    // Properties that are common to all "modes" should live here.
    this.showGravityForceProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('showGravityForceProperty')
    });
    this.showVelocityProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('showVelocityProperty')
    });
    this.showPathProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('showPathProperty')
    });
    this.showGridProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('showGridProperty')
    });

    // The following 2 tandems should not appear in the "Model" screen
    this.showMassProperty = new BooleanProperty(false, {
      tandem: showMassCheckbox ? tandem.createTandem('showMassProperty') : Tandem.OPTIONAL
    });
    this.showMeasuringTapeProperty = new BooleanProperty(false, {
      tandem: showMeasuringTape ? tandem.createTandem('showMeasuringTapeProperty') : Tandem.OPTIONAL
    });
    assert && assert(phet.joist.sim.selectedScreenProperty, 'sim should exist by now');
    this.isPlayingProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('isPlayingProperty'),
      phetioDocumentation: `This value is true if the play/pause button on this screen is in play mode. (It remains true even if the user switches screens. Use in combination with '${phet.joist.sim.selectedScreenProperty.tandem.phetioID}'.)`
    });
    this.timeSpeedProperty = new EnumerationProperty(TimeSpeed.NORMAL, {
      tandem: tandem.createTandem('timeSpeedProperty')
    });
    this.gravityEnabledProperty = new BooleanProperty(true, {
      tandem: tandem.createTandem('gravityEnabledProperty')
    });
    this.steppingProperty = new BooleanProperty(false);
    this.rewindingProperty = new BooleanProperty(false);

    // these two booleans indicate whether or not to show the checkbox for measuring tape and mass.
    // they are false for the model screen and true for the toScale screen
    this.showMassCheckbox = showMassCheckbox;
    this.showMeasuringTape = showMeasuringTape;
    this.changeRewindValueProperty = new DerivedProperty([this.isPlayingProperty, this.steppingProperty, this.rewindingProperty], (isPlaying, stepping, rewinding) => !isPlaying && !stepping && !rewinding);
    this.sceneList = createModes(this);
    this.sceneProperty = new Property(this.sceneList.scenes[0], {
      tandem: tandem.createTandem('sceneProperty'),
      validValues: this.sceneList.scenes,
      phetioValueType: ReferenceIO(IOType.ObjectIO)
    });
  }
  step(dt) {
    // limit dt to 1 so there are no large jumps
    dt = Math.min(1, dt);

    // collision animations should proceed outside of the model step
    const bodies = this.sceneProperty.get().physicsEngine.bodies;
    for (let i = 0; i < bodies.length; i++) {
      const body = bodies[i];
      if (body.isCollidedProperty.get()) {
        body.clockTicksSinceExplosionProperty.value += 1;
      }
    }
    if (this.isPlayingProperty.value) {
      this.sceneProperty.value.getClock().step(dt);
    }
  }
  getScenes() {
    return this.sceneList.scenes;
  }
  updateActiveModule() {
    for (let i = 0; i < this.sceneList.scenes.length; i++) {
      this.sceneList.scenes[i].activeProperty.set(this.sceneList.scenes[i] === this.sceneProperty.value);
    }
  }
  reset() {
    this.showGravityForceProperty.reset();
    this.showPathProperty.reset();
    this.showGridProperty.reset();
    this.showVelocityProperty.reset();
    this.showMassProperty.reset();
    this.isPlayingProperty.reset();
    this.timeSpeedProperty.reset();
    this.showMeasuringTapeProperty.reset();
    this.gravityEnabledProperty.reset();
    this.steppingProperty.reset();
    this.rewindingProperty.reset();
    this.sceneProperty.reset();
    for (let i = 0; i < this.sceneList.scenes.length; i++) {
      this.sceneList.scenes[i].reset();
    }
  }
}
gravityAndOrbits.register('GravityAndOrbitsModel', GravityAndOrbitsModel);
export default GravityAndOrbitsModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJFbnVtZXJhdGlvblByb3BlcnR5IiwiUHJvcGVydHkiLCJQaHlzaWNhbENvbnN0YW50cyIsIlRpbWVTcGVlZCIsIlRhbmRlbSIsIklPVHlwZSIsIlJlZmVyZW5jZUlPIiwiZ3Jhdml0eUFuZE9yYml0cyIsIkRlcml2ZWRQcm9wZXJ0eSIsIkciLCJHUkFWSVRBVElPTkFMX0NPTlNUQU5UIiwiR3Jhdml0eUFuZE9yYml0c01vZGVsIiwiY29uc3RydWN0b3IiLCJzaG93TWVhc3VyaW5nVGFwZSIsImNyZWF0ZU1vZGVzIiwiaW5pdGlhbFNjZW5lSW5kZXgiLCJzaG93TWFzc0NoZWNrYm94IiwidGFuZGVtIiwic2hvd0dyYXZpdHlGb3JjZVByb3BlcnR5IiwiY3JlYXRlVGFuZGVtIiwic2hvd1ZlbG9jaXR5UHJvcGVydHkiLCJzaG93UGF0aFByb3BlcnR5Iiwic2hvd0dyaWRQcm9wZXJ0eSIsInNob3dNYXNzUHJvcGVydHkiLCJPUFRJT05BTCIsInNob3dNZWFzdXJpbmdUYXBlUHJvcGVydHkiLCJhc3NlcnQiLCJwaGV0Iiwiam9pc3QiLCJzaW0iLCJzZWxlY3RlZFNjcmVlblByb3BlcnR5IiwiaXNQbGF5aW5nUHJvcGVydHkiLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwicGhldGlvSUQiLCJ0aW1lU3BlZWRQcm9wZXJ0eSIsIk5PUk1BTCIsImdyYXZpdHlFbmFibGVkUHJvcGVydHkiLCJzdGVwcGluZ1Byb3BlcnR5IiwicmV3aW5kaW5nUHJvcGVydHkiLCJjaGFuZ2VSZXdpbmRWYWx1ZVByb3BlcnR5IiwiaXNQbGF5aW5nIiwic3RlcHBpbmciLCJyZXdpbmRpbmciLCJzY2VuZUxpc3QiLCJzY2VuZVByb3BlcnR5Iiwic2NlbmVzIiwidmFsaWRWYWx1ZXMiLCJwaGV0aW9WYWx1ZVR5cGUiLCJPYmplY3RJTyIsInN0ZXAiLCJkdCIsIk1hdGgiLCJtaW4iLCJib2RpZXMiLCJnZXQiLCJwaHlzaWNzRW5naW5lIiwiaSIsImxlbmd0aCIsImJvZHkiLCJpc0NvbGxpZGVkUHJvcGVydHkiLCJjbG9ja1RpY2tzU2luY2VFeHBsb3Npb25Qcm9wZXJ0eSIsInZhbHVlIiwiZ2V0Q2xvY2siLCJnZXRTY2VuZXMiLCJ1cGRhdGVBY3RpdmVNb2R1bGUiLCJhY3RpdmVQcm9wZXJ0eSIsInNldCIsInJlc2V0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJHcmF2aXR5QW5kT3JiaXRzTW9kZWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhlIEdyYXZpdHlBbmRPcmJpdHNNb2RlbCBoYXMgYW4gYXJyYXkgb2YgR3Jhdml0eUFuZE9yYml0c1NjZW5lcywgb25lIHNjZW5lIGZvciBlYWNoIGNvbmZpZ3VyYXRpb24gb2YgYm9kaWVzIChlLmcuLFxyXG4gKiBTdGFyICsgUGxhbmV0KS4gRWFjaCBzY2VuZSBoYXMgaXRzIG93biBtb2RlbCwgY2FudmFzLCBjbG9jaywgZXRjLCB3aGljaCBhcmUgdXNlZCBpbiBwbGFjZSBvZiB0aGlzIE1vZHVsZSdzIGRhdGEuXHJcbiAqIFRoZSBtb2RlbCBjb250YWlucyBpbmZvcm1hdGlvbiB0aGF0IGlzIHNoYXJlZCBhY3Jvc3MgYWxsIG1vZGVzLCBzdWNoIGFzIHdoZXRoZXIgY2VydGFpbiBmZWF0dXJlcyBhcmUgc2hvd24gKHN1Y2ggYXNcclxuICogc2hvd2luZyB0aGUgZ3Jhdml0YXRpb25hbCBmb3JjZSkuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgQWFyb24gRGF2aXMgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBFbnVtZXJhdGlvblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRW51bWVyYXRpb25Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFBoeXNpY2FsQ29uc3RhbnRzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9QaHlzaWNhbENvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBUaW1lU3BlZWQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1RpbWVTcGVlZC5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBJT1R5cGUgZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0lPVHlwZS5qcyc7XHJcbmltcG9ydCBSZWZlcmVuY2VJTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvUmVmZXJlbmNlSU8uanMnO1xyXG5pbXBvcnQgZ3Jhdml0eUFuZE9yYml0cyBmcm9tICcuLi8uLi9ncmF2aXR5QW5kT3JiaXRzLmpzJztcclxuaW1wb3J0IFNjZW5lRmFjdG9yeSBmcm9tICcuLi9TY2VuZUZhY3RvcnkuanMnO1xyXG5pbXBvcnQgR3Jhdml0eUFuZE9yYml0c1NjZW5lIGZyb20gJy4uL0dyYXZpdHlBbmRPcmJpdHNTY2VuZS5qcyc7XHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUTW9kZWwgZnJvbSAnLi4vLi4vLi4vLi4vam9pc3QvanMvVE1vZGVsLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBHID0gUGh5c2ljYWxDb25zdGFudHMuR1JBVklUQVRJT05BTF9DT05TVEFOVDtcclxuXHJcbmNsYXNzIEdyYXZpdHlBbmRPcmJpdHNNb2RlbCBpbXBsZW1lbnRzIFRNb2RlbCB7XHJcbiAgcHVibGljIHJlYWRvbmx5IHNob3dHcmF2aXR5Rm9yY2VQcm9wZXJ0eTogQm9vbGVhblByb3BlcnR5O1xyXG4gIHB1YmxpYyByZWFkb25seSBzaG93VmVsb2NpdHlQcm9wZXJ0eTogQm9vbGVhblByb3BlcnR5O1xyXG4gIHB1YmxpYyByZWFkb25seSBzaG93UGF0aFByb3BlcnR5OiBCb29sZWFuUHJvcGVydHk7XHJcbiAgcHVibGljIHJlYWRvbmx5IHNob3dHcmlkUHJvcGVydHk6IEJvb2xlYW5Qcm9wZXJ0eTtcclxuICBwdWJsaWMgcmVhZG9ubHkgc2hvd01hc3NQcm9wZXJ0eTogQm9vbGVhblByb3BlcnR5O1xyXG4gIHB1YmxpYyByZWFkb25seSBzaG93TWVhc3VyaW5nVGFwZVByb3BlcnR5OiBCb29sZWFuUHJvcGVydHk7XHJcbiAgcHVibGljIHJlYWRvbmx5IHNjZW5lUHJvcGVydHk6IFByb3BlcnR5PEdyYXZpdHlBbmRPcmJpdHNTY2VuZT47XHJcbiAgcHVibGljIHJlYWRvbmx5IGlzUGxheWluZ1Byb3BlcnR5OiBCb29sZWFuUHJvcGVydHk7XHJcbiAgcHVibGljIHJlYWRvbmx5IHRpbWVTcGVlZFByb3BlcnR5OiBFbnVtZXJhdGlvblByb3BlcnR5PFRpbWVTcGVlZD47XHJcbiAgcHVibGljIHJlYWRvbmx5IGdyYXZpdHlFbmFibGVkUHJvcGVydHk6IEJvb2xlYW5Qcm9wZXJ0eTtcclxuICBwdWJsaWMgcmVhZG9ubHkgc3RlcHBpbmdQcm9wZXJ0eTogQm9vbGVhblByb3BlcnR5O1xyXG4gIHB1YmxpYyByZWFkb25seSByZXdpbmRpbmdQcm9wZXJ0eTogQm9vbGVhblByb3BlcnR5O1xyXG4gIHB1YmxpYyByZWFkb25seSBzaG93TWFzc0NoZWNrYm94OiBib29sZWFuO1xyXG4gIHB1YmxpYyByZWFkb25seSBzaG93TWVhc3VyaW5nVGFwZTogYm9vbGVhbjtcclxuICBwdWJsaWMgcmVhZG9ubHkgc2NlbmVMaXN0OiBTY2VuZUZhY3Rvcnk7XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgRyA9IEc7XHJcblxyXG4gIC8vIFRydWUgaWYgd2hlbiBhIHZhbHVlIGNoYW5nZXMsIGl0IGlzIGFsbG93ZWQgdG8gYmUgYWNjZXB0ZWQgYXMgYSBuZXcgXCJpbml0aWFsIGNvbmRpdGlvblwiIGZvciBhbiBleHBlcmltZW50XHJcbiAgcHVibGljIHJlYWRvbmx5IGNoYW5nZVJld2luZFZhbHVlUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHNob3dNZWFzdXJpbmdUYXBlOiBib29sZWFuLCBjcmVhdGVNb2RlczogKCBhcmcwOiBHcmF2aXR5QW5kT3JiaXRzTW9kZWwgKSA9PiBTY2VuZUZhY3RvcnksIGluaXRpYWxTY2VuZUluZGV4OiBudW1iZXIsIHNob3dNYXNzQ2hlY2tib3g6IGJvb2xlYW4sIHRhbmRlbTogVGFuZGVtICkge1xyXG5cclxuICAgIC8vIFByb3BlcnRpZXMgdGhhdCBhcmUgY29tbW9uIHRvIGFsbCBcIm1vZGVzXCIgc2hvdWxkIGxpdmUgaGVyZS5cclxuICAgIHRoaXMuc2hvd0dyYXZpdHlGb3JjZVByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UsIHsgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnc2hvd0dyYXZpdHlGb3JjZVByb3BlcnR5JyApIH0gKTtcclxuICAgIHRoaXMuc2hvd1ZlbG9jaXR5UHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwgeyB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdzaG93VmVsb2NpdHlQcm9wZXJ0eScgKSB9ICk7XHJcbiAgICB0aGlzLnNob3dQYXRoUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwgeyB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdzaG93UGF0aFByb3BlcnR5JyApIH0gKTtcclxuICAgIHRoaXMuc2hvd0dyaWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7IHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Nob3dHcmlkUHJvcGVydHknICkgfSApO1xyXG5cclxuICAgIC8vIFRoZSBmb2xsb3dpbmcgMiB0YW5kZW1zIHNob3VsZCBub3QgYXBwZWFyIGluIHRoZSBcIk1vZGVsXCIgc2NyZWVuXHJcbiAgICB0aGlzLnNob3dNYXNzUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwgeyB0YW5kZW06IHNob3dNYXNzQ2hlY2tib3ggPyB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnc2hvd01hc3NQcm9wZXJ0eScgKSA6IFRhbmRlbS5PUFRJT05BTCB9ICk7XHJcbiAgICB0aGlzLnNob3dNZWFzdXJpbmdUYXBlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwgeyB0YW5kZW06IHNob3dNZWFzdXJpbmdUYXBlID8gdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Nob3dNZWFzdXJpbmdUYXBlUHJvcGVydHknICkgOiBUYW5kZW0uT1BUSU9OQUwgfSApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHBoZXQuam9pc3Quc2ltLnNlbGVjdGVkU2NyZWVuUHJvcGVydHksICdzaW0gc2hvdWxkIGV4aXN0IGJ5IG5vdycgKTtcclxuICAgIHRoaXMuaXNQbGF5aW5nUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdpc1BsYXlpbmdQcm9wZXJ0eScgKSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogYFRoaXMgdmFsdWUgaXMgdHJ1ZSBpZiB0aGUgcGxheS9wYXVzZSBidXR0b24gb24gdGhpcyBzY3JlZW4gaXMgaW4gcGxheSBtb2RlLiAoSXQgcmVtYWlucyB0cnVlIGV2ZW4gaWYgdGhlIHVzZXIgc3dpdGNoZXMgc2NyZWVucy4gVXNlIGluIGNvbWJpbmF0aW9uIHdpdGggJyR7cGhldC5qb2lzdC5zaW0uc2VsZWN0ZWRTY3JlZW5Qcm9wZXJ0eS50YW5kZW0ucGhldGlvSUR9Jy4pYFxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMudGltZVNwZWVkUHJvcGVydHkgPSBuZXcgRW51bWVyYXRpb25Qcm9wZXJ0eSggVGltZVNwZWVkLk5PUk1BTCwge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd0aW1lU3BlZWRQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZ3Jhdml0eUVuYWJsZWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUsIHsgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZ3Jhdml0eUVuYWJsZWRQcm9wZXJ0eScgKSB9ICk7XHJcbiAgICB0aGlzLnN0ZXBwaW5nUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG4gICAgdGhpcy5yZXdpbmRpbmdQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlICk7XHJcblxyXG4gICAgLy8gdGhlc2UgdHdvIGJvb2xlYW5zIGluZGljYXRlIHdoZXRoZXIgb3Igbm90IHRvIHNob3cgdGhlIGNoZWNrYm94IGZvciBtZWFzdXJpbmcgdGFwZSBhbmQgbWFzcy5cclxuICAgIC8vIHRoZXkgYXJlIGZhbHNlIGZvciB0aGUgbW9kZWwgc2NyZWVuIGFuZCB0cnVlIGZvciB0aGUgdG9TY2FsZSBzY3JlZW5cclxuICAgIHRoaXMuc2hvd01hc3NDaGVja2JveCA9IHNob3dNYXNzQ2hlY2tib3g7XHJcbiAgICB0aGlzLnNob3dNZWFzdXJpbmdUYXBlID0gc2hvd01lYXN1cmluZ1RhcGU7XHJcblxyXG4gICAgdGhpcy5jaGFuZ2VSZXdpbmRWYWx1ZVByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggW1xyXG4gICAgICAgIHRoaXMuaXNQbGF5aW5nUHJvcGVydHksXHJcbiAgICAgICAgdGhpcy5zdGVwcGluZ1Byb3BlcnR5LFxyXG4gICAgICAgIHRoaXMucmV3aW5kaW5nUHJvcGVydHlcclxuICAgICAgXSwgKCBpc1BsYXlpbmcsIHN0ZXBwaW5nLCByZXdpbmRpbmcgKSA9PlxyXG4gICAgICAgICFpc1BsYXlpbmcgJiYgIXN0ZXBwaW5nICYmICFyZXdpbmRpbmdcclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5zY2VuZUxpc3QgPSBjcmVhdGVNb2RlcyggdGhpcyApO1xyXG5cclxuICAgIHRoaXMuc2NlbmVQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggdGhpcy5zY2VuZUxpc3Quc2NlbmVzWyAwIF0sIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnc2NlbmVQcm9wZXJ0eScgKSxcclxuICAgICAgdmFsaWRWYWx1ZXM6IHRoaXMuc2NlbmVMaXN0LnNjZW5lcyxcclxuICAgICAgcGhldGlvVmFsdWVUeXBlOiBSZWZlcmVuY2VJTyggSU9UeXBlLk9iamVjdElPIClcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGVwKCBkdDogbnVtYmVyICk6IHZvaWQge1xyXG5cclxuICAgIC8vIGxpbWl0IGR0IHRvIDEgc28gdGhlcmUgYXJlIG5vIGxhcmdlIGp1bXBzXHJcbiAgICBkdCA9IE1hdGgubWluKCAxLCBkdCApO1xyXG5cclxuICAgIC8vIGNvbGxpc2lvbiBhbmltYXRpb25zIHNob3VsZCBwcm9jZWVkIG91dHNpZGUgb2YgdGhlIG1vZGVsIHN0ZXBcclxuICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuc2NlbmVQcm9wZXJ0eS5nZXQoKS5waHlzaWNzRW5naW5lLmJvZGllcztcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGJvZGllcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgYm9keSA9IGJvZGllc1sgaSBdO1xyXG4gICAgICBpZiAoIGJvZHkuaXNDb2xsaWRlZFByb3BlcnR5LmdldCgpICkge1xyXG4gICAgICAgIGJvZHkuY2xvY2tUaWNrc1NpbmNlRXhwbG9zaW9uUHJvcGVydHkudmFsdWUgKz0gMTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmICggdGhpcy5pc1BsYXlpbmdQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgdGhpcy5zY2VuZVByb3BlcnR5LnZhbHVlLmdldENsb2NrKCkuc3RlcCggZHQgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRTY2VuZXMoKTogR3Jhdml0eUFuZE9yYml0c1NjZW5lW10ge1xyXG4gICAgcmV0dXJuIHRoaXMuc2NlbmVMaXN0LnNjZW5lcztcclxuICB9XHJcblxyXG4gIHB1YmxpYyB1cGRhdGVBY3RpdmVNb2R1bGUoKTogdm9pZCB7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLnNjZW5lTGlzdC5zY2VuZXMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIHRoaXMuc2NlbmVMaXN0LnNjZW5lc1sgaSBdLmFjdGl2ZVByb3BlcnR5LnNldCggdGhpcy5zY2VuZUxpc3Quc2NlbmVzWyBpIF0gPT09IHRoaXMuc2NlbmVQcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5zaG93R3Jhdml0eUZvcmNlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuc2hvd1BhdGhQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5zaG93R3JpZFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnNob3dWZWxvY2l0eVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnNob3dNYXNzUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuaXNQbGF5aW5nUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMudGltZVNwZWVkUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuc2hvd01lYXN1cmluZ1RhcGVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5ncmF2aXR5RW5hYmxlZFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnN0ZXBwaW5nUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMucmV3aW5kaW5nUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuc2NlbmVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5zY2VuZUxpc3Quc2NlbmVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICB0aGlzLnNjZW5lTGlzdC5zY2VuZXNbIGkgXS5yZXNldCgpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZ3Jhdml0eUFuZE9yYml0cy5yZWdpc3RlciggJ0dyYXZpdHlBbmRPcmJpdHNNb2RlbCcsIEdyYXZpdHlBbmRPcmJpdHNNb2RlbCApO1xyXG5leHBvcnQgZGVmYXVsdCBHcmF2aXR5QW5kT3JiaXRzTW9kZWw7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxtQkFBbUIsTUFBTSw0Q0FBNEM7QUFDNUUsT0FBT0MsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxpQkFBaUIsTUFBTSwrQ0FBK0M7QUFDN0UsT0FBT0MsU0FBUyxNQUFNLDBDQUEwQztBQUNoRSxPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBQ3BELE9BQU9DLE1BQU0sTUFBTSx1Q0FBdUM7QUFDMUQsT0FBT0MsV0FBVyxNQUFNLDRD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