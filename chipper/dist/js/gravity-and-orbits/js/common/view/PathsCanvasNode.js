// Copyright 2015-2022, University of Colorado Boulder

/**
 * Shows the "trail" left behind by a Body as it moves over time, which disappears after about 2 orbits
 * This is named "Path" instead of "trail" since that is how it is supposed to appear to the students.
 *
 * Note: In the Java sim this was PathNode and there was one Node for each body. For performance reasons, it
 * has been changed so that there is just one CanvasNode shared between all of the bodies.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Aaron Davis (PhET Interactive Simulations)
 */

import Utils from '../../../../dot/js/Utils.js';
import { CanvasNode } from '../../../../scenery/js/imports.js';
import gravityAndOrbits from '../../gravityAndOrbits.js';
// constants
const STROKE_WIDTH = 3;
class PathsCanvasNode extends CanvasNode {
  /**
   */
  constructor(bodies, transformProperty, visibleProperty, canvasBounds) {
    assert && assert(canvasBounds, 'Paths canvas must define bounds');
    super({
      canvasBounds: canvasBounds,
      preventFit: true
    });

    // a map tracking each body and its associated points
    this.namedPoints = {};
    for (let i = 0; i < bodies.length; i++) {
      this.namedPoints[bodies[i].type] = new NamedPoints(bodies[i].type);
    }
    this.transformProperty = transformProperty;

    // transform all body points and re paint the canvas
    // disposal unnecessary, the canvas node exists for life of sim
    const updateNamedPoints = () => {
      for (let i = 0; i < bodies.length; i++) {
        const body = bodies[i];

        // when the transform changes, we want to re-transform all points in a body
        // path and then re paint the canvas
        this.namedPoints[body.type].points = [];
        for (let j = 0; j < body.path.length; j++) {
          const point = body.path[j];
          const pt = transformProperty.get().modelToViewPosition(point);
          this.namedPoints[body.type].points.push(pt);
        }
      }
      this.invalidatePaint();
    };
    transformProperty.link(updateNamedPoints);
    this.bodies = bodies;
    visibleProperty.link(isVisible => {
      this.visible = isVisible;

      // Don't clear the path during phet-io state set, see https://github.com/phetsims/gravity-and-orbits/issues/455
      if (!phet.joist.sim.isSettingPhetioStateProperty.value) {
        // Paths should restart from the body position when "Path" checkbox is checked
        for (let i = 0; i < bodies.length; i++) {
          this.bodies[i].clearPath();
        }
      }
      updateNamedPoints();
    });

    // listener for when a point is added, bound by thisNode
    // created to avoid excess closures every time a point is removed
    // @param bodyName - used to look up points associated with the desired body's trail
    this.pointAddedListener = (point, bodyName) => {
      const pt = transformProperty.get().modelToViewPosition(point);

      // 'this' is defined by bind in addListener
      const namedPoints = this.namedPoints[bodyName];
      namedPoints.points.push(pt);
      if (visibleProperty.get()) {
        this.invalidatePaint();
      }
    };

    // listener for when a point is removed, bound by thisNode
    // created to avoid excess closures every time a point is removed
    // @param bodyName - used to look up points associated with the desired body's trail
    this.pointRemovedListener = bodyName => {
      // 'this' defined by bind in addListener
      const namedPoints = this.namedPoints[bodyName];
      if (namedPoints.points.length > 0) {
        namedPoints.points.shift();
      }
      if (visibleProperty.get()) {
        this.invalidatePaint();
      }
    };

    // listener for when date is cleared, bound by thisNode
    // created to avoid excess closures every time date is cleared
    // @param bodyName - used to look up points associated with the desired body's trail
    this.clearedListener = bodyName => {
      // 'this' is defined by bind
      const namedPoints = this.namedPoints[bodyName];
      while (namedPoints.points.length) {
        namedPoints.points.pop();
      }
      this.invalidatePaint();
    };

    // add listeners to each body
    for (let i = 0; i < bodies.length; i++) {
      const body = bodies[i];
      body.pointAddedEmitter.addListener(this.pointAddedListener.bind(this));
      body.pointRemovedEmitter.addListener(this.pointRemovedListener.bind(this));
      body.clearedEmitter.addListener(this.clearedListener.bind(this));
    }
  }
  paintCanvas(context) {
    let j;

    // draw the path for each body one by one
    for (let i = 0; i < this.bodies.length; i++) {
      const body = this.bodies[i];
      const points = this.namedPoints[body.type].points;

      // max path length in view coordinates
      const maxPathLength = this.transformProperty.get().modelToViewDeltaX(body.maxPathLength);
      const fadePathLength = maxPathLength * 0.15; // fade length is ~15% of the path

      context.strokeStyle = body.color.toCSS();
      context.lineWidth = STROKE_WIDTH;
      context.lineCap = 'round';
      context.lineJoin = 'round';
      context.beginPath();

      // Create and render the solid part as a path. New points are added at the tail of the list,
      // so easiest to render backwards for fade-out.
      if (points.length > 0) {
        context.moveTo(points[points.length - 1].x, points[points.length - 1].y);
      }
      j = points.length - 1;
      body.pathLength = 0;
      while (body.pathLength < maxPathLength - fadePathLength && j > 0) {
        context.lineTo(points[j].x, points[j].y);
        if (j > 1) {
          // increment the path length by the length of the added segment
          const segDifX = points[j].x - points[j - 1].x;
          const segDifY = points[j].y - points[j - 1].y;

          // avoid using vector2 to prevent excess object allocation
          const segLength = Math.sqrt(segDifX * segDifX + segDifY * segDifY);
          body.pathLength += segLength;
        }
        j--;
      }
      context.stroke();

      // Draw the faded out part

      // Using "butt" is too "feathered" and makes the stroke look less bold than it should be
      context.lineCap = 'square';

      // Using "square" makes the stroke too wide, so we must trim it down accordingly.
      context.lineWidth = STROKE_WIDTH * 0.7;
      const faded = body.color;
      while (body.pathLength < maxPathLength && j > 0) {
        assert && assert(body.pathLength > maxPathLength - fadePathLength, 'the path length is too small to start fading');

        // fade out a little bit each segment
        const alpha = Utils.linear(maxPathLength - fadePathLength, maxPathLength, 1, 0, body.pathLength);

        // format without Color to avoid unnecessary allocation
        const fade = `rgba( ${faded.r}, ${faded.g}, ${faded.b}, ${alpha} )`;
        context.beginPath();
        context.strokeStyle = fade;
        context.moveTo(points[j + 1].x, points[j + 1].y);
        context.lineTo(points[j].x, points[j].y);
        context.stroke();

        // increment the path length by the length of the added segment
        const segDifX = points[j].x - points[j - 1].x;
        const segDifY = points[j].y - points[j - 1].y;

        // avoid using vector2 to prevent excess object allocation
        const segLength = Math.sqrt(segDifX * segDifX + segDifY * segDifY);
        body.pathLength += segLength;
        j--;
      }
      if (body.pathLength > maxPathLength) {
        while (j >= 0) {
          points.shift();
          j--;
        }
      }
    }
  }
}
gravityAndOrbits.register('PathsCanvasNode', PathsCanvasNode);
class NamedPoints {
  /**
   * Named points assigns an array of points a name so that it can be looked up outside of a closure.
   */
  constructor(type) {
    this.type = type;
    this.points = [];
  }
}
gravityAndOrbits.register('NamedPoints', NamedPoints);
export default PathsCanvasNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIkNhbnZhc05vZGUiLCJncmF2aXR5QW5kT3JiaXRzIiwiU1RST0tFX1dJRFRIIiwiUGF0aHNDYW52YXNOb2RlIiwiY29uc3RydWN0b3IiLCJib2RpZXMiLCJ0cmFuc2Zvcm1Qcm9wZXJ0eSIsInZpc2libGVQcm9wZXJ0eSIsImNhbnZhc0JvdW5kcyIsImFzc2VydCIsInByZXZlbnRGaXQiLCJuYW1lZFBvaW50cyIsImkiLCJsZW5ndGgiLCJ0eXBlIiwiTmFtZWRQb2ludHMiLCJ1cGRhdGVOYW1lZFBvaW50cyIsImJvZHkiLCJwb2ludHMiLCJqIiwicGF0aCIsInBvaW50IiwicHQiLCJnZXQiLCJtb2RlbFRvVmlld1Bvc2l0aW9uIiwicHVzaCIsImludmFsaWRhdGVQYWludCIsImxpbmsiLCJpc1Zpc2libGUiLCJ2aXNpYmxlIiwicGhldCIsImpvaXN0Iiwic2ltIiwiaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eSIsInZhbHVlIiwiY2xlYXJQYXRoIiwicG9pbnRBZGRlZExpc3RlbmVyIiwiYm9keU5hbWUiLCJwb2ludFJlbW92ZWRMaXN0ZW5lciIsInNoaWZ0IiwiY2xlYXJlZExpc3RlbmVyIiwicG9wIiwicG9pbnRBZGRlZEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImJpbmQiLCJwb2ludFJlbW92ZWRFbWl0dGVyIiwiY2xlYXJlZEVtaXR0ZXIiLCJwYWludENhbnZhcyIsImNvbnRleHQiLCJtYXhQYXRoTGVuZ3RoIiwibW9kZWxUb1ZpZXdEZWx0YVgiLCJmYWRlUGF0aExlbmd0aCIsInN0cm9rZVN0eWxlIiwiY29sb3IiLCJ0b0NTUyIsImxpbmVXaWR0aCIsImxpbmVDYXAiLCJsaW5lSm9pbiIsImJlZ2luUGF0aCIsIm1vdmVUbyIsIngiLCJ5IiwicGF0aExlbmd0aCIsImxpbmVUbyIsInNlZ0RpZlgiLCJzZWdEaWZZIiwic2VnTGVuZ3RoIiwiTWF0aCIsInNxcnQiLCJzdHJva2UiLCJmYWRlZCIsImFscGhhIiwibGluZWFyIiwiZmFkZSIsInIiLCJnIiwiYiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUGF0aHNDYW52YXNOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFNob3dzIHRoZSBcInRyYWlsXCIgbGVmdCBiZWhpbmQgYnkgYSBCb2R5IGFzIGl0IG1vdmVzIG92ZXIgdGltZSwgd2hpY2ggZGlzYXBwZWFycyBhZnRlciBhYm91dCAyIG9yYml0c1xyXG4gKiBUaGlzIGlzIG5hbWVkIFwiUGF0aFwiIGluc3RlYWQgb2YgXCJ0cmFpbFwiIHNpbmNlIHRoYXQgaXMgaG93IGl0IGlzIHN1cHBvc2VkIHRvIGFwcGVhciB0byB0aGUgc3R1ZGVudHMuXHJcbiAqXHJcbiAqIE5vdGU6IEluIHRoZSBKYXZhIHNpbSB0aGlzIHdhcyBQYXRoTm9kZSBhbmQgdGhlcmUgd2FzIG9uZSBOb2RlIGZvciBlYWNoIGJvZHkuIEZvciBwZXJmb3JtYW5jZSByZWFzb25zLCBpdFxyXG4gKiBoYXMgYmVlbiBjaGFuZ2VkIHNvIHRoYXQgdGhlcmUgaXMganVzdCBvbmUgQ2FudmFzTm9kZSBzaGFyZWQgYmV0d2VlbiBhbGwgb2YgdGhlIGJvZGllcy5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBBYXJvbiBEYXZpcyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IHsgQ2FudmFzTm9kZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBncmF2aXR5QW5kT3JiaXRzIGZyb20gJy4uLy4uL2dyYXZpdHlBbmRPcmJpdHMuanMnO1xyXG5pbXBvcnQgQm9keSBmcm9tICcuLi9tb2RlbC9Cb2R5LmpzJztcclxuaW1wb3J0IEJvZHlUeXBlRW51bSBmcm9tICcuLi9tb2RlbC9Cb2R5VHlwZUVudW0uanMnO1xyXG5pbXBvcnQgTW9kZWxWaWV3VHJhbnNmb3JtMiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IEJvdW5kczIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0JvdW5kczIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgU1RST0tFX1dJRFRIID0gMztcclxuXHJcbmNsYXNzIFBhdGhzQ2FudmFzTm9kZSBleHRlbmRzIENhbnZhc05vZGUge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbmFtZWRQb2ludHM6IFJlY29yZDxzdHJpbmcsIE5hbWVkUG9pbnRzPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IHRyYW5zZm9ybVByb3BlcnR5OiBQcm9wZXJ0eTxNb2RlbFZpZXdUcmFuc2Zvcm0yPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGJvZGllczogQm9keVtdO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcG9pbnRBZGRlZExpc3RlbmVyOiAoIHBvaW50OiBWZWN0b3IyLCBib2R5TmFtZTogQm9keVR5cGVFbnVtICkgPT4gdm9pZDtcclxuICBwcml2YXRlIHJlYWRvbmx5IHBvaW50UmVtb3ZlZExpc3RlbmVyOiAoIGJvZHlOYW1lOiBCb2R5VHlwZUVudW0gKSA9PiB2b2lkO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY2xlYXJlZExpc3RlbmVyOiAoIGJvZHlOYW1lOiBCb2R5VHlwZUVudW0gKSA9PiB2b2lkO1xyXG5cclxuICAvKipcclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGJvZGllczogQm9keVtdLCB0cmFuc2Zvcm1Qcm9wZXJ0eTogUHJvcGVydHk8TW9kZWxWaWV3VHJhbnNmb3JtMj4sIHZpc2libGVQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj4sIGNhbnZhc0JvdW5kczogQm91bmRzMiApIHtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjYW52YXNCb3VuZHMsICdQYXRocyBjYW52YXMgbXVzdCBkZWZpbmUgYm91bmRzJyApO1xyXG4gICAgc3VwZXIoIHtcclxuICAgICAgY2FudmFzQm91bmRzOiBjYW52YXNCb3VuZHMsXHJcbiAgICAgIHByZXZlbnRGaXQ6IHRydWVcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBhIG1hcCB0cmFja2luZyBlYWNoIGJvZHkgYW5kIGl0cyBhc3NvY2lhdGVkIHBvaW50c1xyXG4gICAgdGhpcy5uYW1lZFBvaW50cyA9IHt9O1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICB0aGlzLm5hbWVkUG9pbnRzWyBib2RpZXNbIGkgXS50eXBlIF0gPSBuZXcgTmFtZWRQb2ludHMoIGJvZGllc1sgaSBdLnR5cGUgKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnRyYW5zZm9ybVByb3BlcnR5ID0gdHJhbnNmb3JtUHJvcGVydHk7XHJcblxyXG4gICAgLy8gdHJhbnNmb3JtIGFsbCBib2R5IHBvaW50cyBhbmQgcmUgcGFpbnQgdGhlIGNhbnZhc1xyXG4gICAgLy8gZGlzcG9zYWwgdW5uZWNlc3NhcnksIHRoZSBjYW52YXMgbm9kZSBleGlzdHMgZm9yIGxpZmUgb2Ygc2ltXHJcbiAgICBjb25zdCB1cGRhdGVOYW1lZFBvaW50cyA9ICgpID0+IHtcclxuICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSBib2RpZXNbIGkgXTtcclxuXHJcbiAgICAgICAgLy8gd2hlbiB0aGUgdHJhbnNmb3JtIGNoYW5nZXMsIHdlIHdhbnQgdG8gcmUtdHJhbnNmb3JtIGFsbCBwb2ludHMgaW4gYSBib2R5XHJcbiAgICAgICAgLy8gcGF0aCBhbmQgdGhlbiByZSBwYWludCB0aGUgY2FudmFzXHJcbiAgICAgICAgdGhpcy5uYW1lZFBvaW50c1sgYm9keS50eXBlIF0ucG9pbnRzID0gW107XHJcblxyXG4gICAgICAgIGZvciAoIGxldCBqID0gMDsgaiA8IGJvZHkucGF0aC5sZW5ndGg7IGorKyApIHtcclxuICAgICAgICAgIGNvbnN0IHBvaW50ID0gYm9keS5wYXRoWyBqIF07XHJcbiAgICAgICAgICBjb25zdCBwdCA9IHRyYW5zZm9ybVByb3BlcnR5LmdldCgpLm1vZGVsVG9WaWV3UG9zaXRpb24oIHBvaW50ICk7XHJcbiAgICAgICAgICB0aGlzLm5hbWVkUG9pbnRzWyBib2R5LnR5cGUgXS5wb2ludHMucHVzaCggcHQgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuaW52YWxpZGF0ZVBhaW50KCk7XHJcbiAgICB9O1xyXG4gICAgdHJhbnNmb3JtUHJvcGVydHkubGluayggdXBkYXRlTmFtZWRQb2ludHMgKTtcclxuXHJcbiAgICB0aGlzLmJvZGllcyA9IGJvZGllcztcclxuXHJcbiAgICB2aXNpYmxlUHJvcGVydHkubGluayggaXNWaXNpYmxlID0+IHtcclxuICAgICAgdGhpcy52aXNpYmxlID0gaXNWaXNpYmxlO1xyXG5cclxuICAgICAgLy8gRG9uJ3QgY2xlYXIgdGhlIHBhdGggZHVyaW5nIHBoZXQtaW8gc3RhdGUgc2V0LCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2dyYXZpdHktYW5kLW9yYml0cy9pc3N1ZXMvNDU1XHJcbiAgICAgIGlmICggIXBoZXQuam9pc3Quc2ltLmlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkudmFsdWUgKSB7XHJcblxyXG4gICAgICAgIC8vIFBhdGhzIHNob3VsZCByZXN0YXJ0IGZyb20gdGhlIGJvZHkgcG9zaXRpb24gd2hlbiBcIlBhdGhcIiBjaGVja2JveCBpcyBjaGVja2VkXHJcbiAgICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgICAgdGhpcy5ib2RpZXNbIGkgXS5jbGVhclBhdGgoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgdXBkYXRlTmFtZWRQb2ludHMoKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBsaXN0ZW5lciBmb3Igd2hlbiBhIHBvaW50IGlzIGFkZGVkLCBib3VuZCBieSB0aGlzTm9kZVxyXG4gICAgLy8gY3JlYXRlZCB0byBhdm9pZCBleGNlc3MgY2xvc3VyZXMgZXZlcnkgdGltZSBhIHBvaW50IGlzIHJlbW92ZWRcclxuICAgIC8vIEBwYXJhbSBib2R5TmFtZSAtIHVzZWQgdG8gbG9vayB1cCBwb2ludHMgYXNzb2NpYXRlZCB3aXRoIHRoZSBkZXNpcmVkIGJvZHkncyB0cmFpbFxyXG4gICAgdGhpcy5wb2ludEFkZGVkTGlzdGVuZXIgPSAoIHBvaW50LCBib2R5TmFtZSApID0+IHtcclxuICAgICAgY29uc3QgcHQgPSB0cmFuc2Zvcm1Qcm9wZXJ0eS5nZXQoKS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBwb2ludCApO1xyXG5cclxuICAgICAgLy8gJ3RoaXMnIGlzIGRlZmluZWQgYnkgYmluZCBpbiBhZGRMaXN0ZW5lclxyXG4gICAgICBjb25zdCBuYW1lZFBvaW50cyA9IHRoaXMubmFtZWRQb2ludHNbIGJvZHlOYW1lIF07XHJcbiAgICAgIG5hbWVkUG9pbnRzLnBvaW50cy5wdXNoKCBwdCApO1xyXG4gICAgICBpZiAoIHZpc2libGVQcm9wZXJ0eS5nZXQoKSApIHtcclxuICAgICAgICB0aGlzLmludmFsaWRhdGVQYWludCgpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIGxpc3RlbmVyIGZvciB3aGVuIGEgcG9pbnQgaXMgcmVtb3ZlZCwgYm91bmQgYnkgdGhpc05vZGVcclxuICAgIC8vIGNyZWF0ZWQgdG8gYXZvaWQgZXhjZXNzIGNsb3N1cmVzIGV2ZXJ5IHRpbWUgYSBwb2ludCBpcyByZW1vdmVkXHJcbiAgICAvLyBAcGFyYW0gYm9keU5hbWUgLSB1c2VkIHRvIGxvb2sgdXAgcG9pbnRzIGFzc29jaWF0ZWQgd2l0aCB0aGUgZGVzaXJlZCBib2R5J3MgdHJhaWxcclxuICAgIHRoaXMucG9pbnRSZW1vdmVkTGlzdGVuZXIgPSBib2R5TmFtZSA9PiB7XHJcblxyXG4gICAgICAvLyAndGhpcycgZGVmaW5lZCBieSBiaW5kIGluIGFkZExpc3RlbmVyXHJcbiAgICAgIGNvbnN0IG5hbWVkUG9pbnRzID0gdGhpcy5uYW1lZFBvaW50c1sgYm9keU5hbWUgXTtcclxuICAgICAgaWYgKCBuYW1lZFBvaW50cy5wb2ludHMubGVuZ3RoID4gMCApIHtcclxuICAgICAgICBuYW1lZFBvaW50cy5wb2ludHMuc2hpZnQoKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIHZpc2libGVQcm9wZXJ0eS5nZXQoKSApIHtcclxuICAgICAgICB0aGlzLmludmFsaWRhdGVQYWludCgpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIGxpc3RlbmVyIGZvciB3aGVuIGRhdGUgaXMgY2xlYXJlZCwgYm91bmQgYnkgdGhpc05vZGVcclxuICAgIC8vIGNyZWF0ZWQgdG8gYXZvaWQgZXhjZXNzIGNsb3N1cmVzIGV2ZXJ5IHRpbWUgZGF0ZSBpcyBjbGVhcmVkXHJcbiAgICAvLyBAcGFyYW0gYm9keU5hbWUgLSB1c2VkIHRvIGxvb2sgdXAgcG9pbnRzIGFzc29jaWF0ZWQgd2l0aCB0aGUgZGVzaXJlZCBib2R5J3MgdHJhaWxcclxuICAgIHRoaXMuY2xlYXJlZExpc3RlbmVyID0gYm9keU5hbWUgPT4ge1xyXG5cclxuICAgICAgLy8gJ3RoaXMnIGlzIGRlZmluZWQgYnkgYmluZFxyXG4gICAgICBjb25zdCBuYW1lZFBvaW50cyA9IHRoaXMubmFtZWRQb2ludHNbIGJvZHlOYW1lIF07XHJcbiAgICAgIHdoaWxlICggbmFtZWRQb2ludHMucG9pbnRzLmxlbmd0aCApIHsgbmFtZWRQb2ludHMucG9pbnRzLnBvcCgpOyB9XHJcbiAgICAgIHRoaXMuaW52YWxpZGF0ZVBhaW50KCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIGFkZCBsaXN0ZW5lcnMgdG8gZWFjaCBib2R5XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBib2RpZXMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IGJvZHkgPSBib2RpZXNbIGkgXTtcclxuXHJcbiAgICAgIGJvZHkucG9pbnRBZGRlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIHRoaXMucG9pbnRBZGRlZExpc3RlbmVyLmJpbmQoIHRoaXMgKSApO1xyXG4gICAgICBib2R5LnBvaW50UmVtb3ZlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIHRoaXMucG9pbnRSZW1vdmVkTGlzdGVuZXIuYmluZCggdGhpcyApICk7XHJcbiAgICAgIGJvZHkuY2xlYXJlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIHRoaXMuY2xlYXJlZExpc3RlbmVyLmJpbmQoIHRoaXMgKSApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHBhaW50Q2FudmFzKCBjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgKTogdm9pZCB7XHJcbiAgICBsZXQgajtcclxuXHJcbiAgICAvLyBkcmF3IHRoZSBwYXRoIGZvciBlYWNoIGJvZHkgb25lIGJ5IG9uZVxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5ib2RpZXMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IGJvZHkgPSB0aGlzLmJvZGllc1sgaSBdO1xyXG4gICAgICBjb25zdCBwb2ludHMgPSB0aGlzLm5hbWVkUG9pbnRzWyBib2R5LnR5cGUgXS5wb2ludHM7XHJcblxyXG4gICAgICAvLyBtYXggcGF0aCBsZW5ndGggaW4gdmlldyBjb29yZGluYXRlc1xyXG4gICAgICBjb25zdCBtYXhQYXRoTGVuZ3RoID0gdGhpcy50cmFuc2Zvcm1Qcm9wZXJ0eS5nZXQoKS5tb2RlbFRvVmlld0RlbHRhWCggYm9keS5tYXhQYXRoTGVuZ3RoICk7XHJcbiAgICAgIGNvbnN0IGZhZGVQYXRoTGVuZ3RoID0gbWF4UGF0aExlbmd0aCAqIDAuMTU7IC8vIGZhZGUgbGVuZ3RoIGlzIH4xNSUgb2YgdGhlIHBhdGhcclxuXHJcbiAgICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBib2R5LmNvbG9yLnRvQ1NTKCk7XHJcbiAgICAgIGNvbnRleHQubGluZVdpZHRoID0gU1RST0tFX1dJRFRIO1xyXG4gICAgICBjb250ZXh0LmxpbmVDYXAgPSAncm91bmQnO1xyXG4gICAgICBjb250ZXh0LmxpbmVKb2luID0gJ3JvdW5kJztcclxuICAgICAgY29udGV4dC5iZWdpblBhdGgoKTtcclxuXHJcbiAgICAgIC8vIENyZWF0ZSBhbmQgcmVuZGVyIHRoZSBzb2xpZCBwYXJ0IGFzIGEgcGF0aC4gTmV3IHBvaW50cyBhcmUgYWRkZWQgYXQgdGhlIHRhaWwgb2YgdGhlIGxpc3QsXHJcbiAgICAgIC8vIHNvIGVhc2llc3QgdG8gcmVuZGVyIGJhY2t3YXJkcyBmb3IgZmFkZS1vdXQuXHJcbiAgICAgIGlmICggcG9pbnRzLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgY29udGV4dC5tb3ZlVG8oIHBvaW50c1sgcG9pbnRzLmxlbmd0aCAtIDEgXS54LCBwb2ludHNbIHBvaW50cy5sZW5ndGggLSAxIF0ueSApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBqID0gcG9pbnRzLmxlbmd0aCAtIDE7XHJcbiAgICAgIGJvZHkucGF0aExlbmd0aCA9IDA7XHJcbiAgICAgIHdoaWxlICggYm9keS5wYXRoTGVuZ3RoIDwgbWF4UGF0aExlbmd0aCAtIGZhZGVQYXRoTGVuZ3RoICYmIGogPiAwICkge1xyXG4gICAgICAgIGNvbnRleHQubGluZVRvKCBwb2ludHNbIGogXS54LCBwb2ludHNbIGogXS55ICk7XHJcbiAgICAgICAgaWYgKCBqID4gMSApIHtcclxuICAgICAgICAgIC8vIGluY3JlbWVudCB0aGUgcGF0aCBsZW5ndGggYnkgdGhlIGxlbmd0aCBvZiB0aGUgYWRkZWQgc2VnbWVudFxyXG4gICAgICAgICAgY29uc3Qgc2VnRGlmWCA9IHBvaW50c1sgaiBdLnggLSBwb2ludHNbIGogLSAxIF0ueDtcclxuICAgICAgICAgIGNvbnN0IHNlZ0RpZlkgPSBwb2ludHNbIGogXS55IC0gcG9pbnRzWyBqIC0gMSBdLnk7XHJcblxyXG4gICAgICAgICAgLy8gYXZvaWQgdXNpbmcgdmVjdG9yMiB0byBwcmV2ZW50IGV4Y2VzcyBvYmplY3QgYWxsb2NhdGlvblxyXG4gICAgICAgICAgY29uc3Qgc2VnTGVuZ3RoID0gTWF0aC5zcXJ0KCBzZWdEaWZYICogc2VnRGlmWCArIHNlZ0RpZlkgKiBzZWdEaWZZICk7XHJcbiAgICAgICAgICBib2R5LnBhdGhMZW5ndGggKz0gc2VnTGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBqLS07XHJcbiAgICAgIH1cclxuICAgICAgY29udGV4dC5zdHJva2UoKTtcclxuXHJcbiAgICAgIC8vIERyYXcgdGhlIGZhZGVkIG91dCBwYXJ0XHJcblxyXG4gICAgICAvLyBVc2luZyBcImJ1dHRcIiBpcyB0b28gXCJmZWF0aGVyZWRcIiBhbmQgbWFrZXMgdGhlIHN0cm9rZSBsb29rIGxlc3MgYm9sZCB0aGFuIGl0IHNob3VsZCBiZVxyXG4gICAgICBjb250ZXh0LmxpbmVDYXAgPSAnc3F1YXJlJztcclxuXHJcbiAgICAgIC8vIFVzaW5nIFwic3F1YXJlXCIgbWFrZXMgdGhlIHN0cm9rZSB0b28gd2lkZSwgc28gd2UgbXVzdCB0cmltIGl0IGRvd24gYWNjb3JkaW5nbHkuXHJcbiAgICAgIGNvbnRleHQubGluZVdpZHRoID0gU1RST0tFX1dJRFRIICogMC43O1xyXG5cclxuICAgICAgY29uc3QgZmFkZWQgPSBib2R5LmNvbG9yO1xyXG5cclxuICAgICAgd2hpbGUgKCBib2R5LnBhdGhMZW5ndGggPCBtYXhQYXRoTGVuZ3RoICYmIGogPiAwICkge1xyXG4gICAgICAgIGFzc2VydCAmJiBhc3NlcnQoIGJvZHkucGF0aExlbmd0aCA+IG1heFBhdGhMZW5ndGggLSBmYWRlUGF0aExlbmd0aCwgJ3RoZSBwYXRoIGxlbmd0aCBpcyB0b28gc21hbGwgdG8gc3RhcnQgZmFkaW5nJyApO1xyXG5cclxuICAgICAgICAvLyBmYWRlIG91dCBhIGxpdHRsZSBiaXQgZWFjaCBzZWdtZW50XHJcbiAgICAgICAgY29uc3QgYWxwaGEgPSBVdGlscy5saW5lYXIoIG1heFBhdGhMZW5ndGggLSBmYWRlUGF0aExlbmd0aCwgbWF4UGF0aExlbmd0aCwgMSwgMCwgYm9keS5wYXRoTGVuZ3RoICk7XHJcblxyXG4gICAgICAgIC8vIGZvcm1hdCB3aXRob3V0IENvbG9yIHRvIGF2b2lkIHVubmVjZXNzYXJ5IGFsbG9jYXRpb25cclxuICAgICAgICBjb25zdCBmYWRlID0gYHJnYmEoICR7ZmFkZWQucn0sICR7ZmFkZWQuZ30sICR7ZmFkZWQuYn0sICR7YWxwaGF9IClgO1xyXG5cclxuICAgICAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBmYWRlO1xyXG4gICAgICAgIGNvbnRleHQubW92ZVRvKCBwb2ludHNbIGogKyAxIF0ueCwgcG9pbnRzWyBqICsgMSBdLnkgKTtcclxuICAgICAgICBjb250ZXh0LmxpbmVUbyggcG9pbnRzWyBqIF0ueCwgcG9pbnRzWyBqIF0ueSApO1xyXG4gICAgICAgIGNvbnRleHQuc3Ryb2tlKCk7XHJcblxyXG4gICAgICAgIC8vIGluY3JlbWVudCB0aGUgcGF0aCBsZW5ndGggYnkgdGhlIGxlbmd0aCBvZiB0aGUgYWRkZWQgc2VnbWVudFxyXG4gICAgICAgIGNvbnN0IHNlZ0RpZlggPSBwb2ludHNbIGogXS54IC0gcG9pbnRzWyBqIC0gMSBdLng7XHJcbiAgICAgICAgY29uc3Qgc2VnRGlmWSA9IHBvaW50c1sgaiBdLnkgLSBwb2ludHNbIGogLSAxIF0ueTtcclxuXHJcbiAgICAgICAgLy8gYXZvaWQgdXNpbmcgdmVjdG9yMiB0byBwcmV2ZW50IGV4Y2VzcyBvYmplY3QgYWxsb2NhdGlvblxyXG4gICAgICAgIGNvbnN0IHNlZ0xlbmd0aCA9IE1hdGguc3FydCggc2VnRGlmWCAqIHNlZ0RpZlggKyBzZWdEaWZZICogc2VnRGlmWSApO1xyXG4gICAgICAgIGJvZHkucGF0aExlbmd0aCArPSBzZWdMZW5ndGg7XHJcbiAgICAgICAgai0tO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIGJvZHkucGF0aExlbmd0aCA+IG1heFBhdGhMZW5ndGggKSB7XHJcbiAgICAgICAgd2hpbGUgKCBqID49IDAgKSB7XHJcbiAgICAgICAgICBwb2ludHMuc2hpZnQoKTtcclxuICAgICAgICAgIGotLTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmdyYXZpdHlBbmRPcmJpdHMucmVnaXN0ZXIoICdQYXRoc0NhbnZhc05vZGUnLCBQYXRoc0NhbnZhc05vZGUgKTtcclxuXHJcbmNsYXNzIE5hbWVkUG9pbnRzIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IHR5cGU6IEJvZHlUeXBlRW51bTtcclxuICBwdWJsaWMgcG9pbnRzOiBWZWN0b3IyW107XHJcblxyXG4gIC8qKlxyXG4gICAqIE5hbWVkIHBvaW50cyBhc3NpZ25zIGFuIGFycmF5IG9mIHBvaW50cyBhIG5hbWUgc28gdGhhdCBpdCBjYW4gYmUgbG9va2VkIHVwIG91dHNpZGUgb2YgYSBjbG9zdXJlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggdHlwZTogQm9keVR5cGVFbnVtICkge1xyXG4gICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgIHRoaXMucG9pbnRzID0gW107XHJcbiAgfVxyXG59XHJcblxyXG5ncmF2aXR5QW5kT3JiaXRzLnJlZ2lzdGVyKCAnTmFtZWRQb2ludHMnLCBOYW1lZFBvaW50cyApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgUGF0aHNDYW52YXNOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNB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