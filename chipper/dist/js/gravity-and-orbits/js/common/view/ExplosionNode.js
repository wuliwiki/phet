// Copyright 2014-2022, University of Colorado Boulder

/**
 * Shows an explosion for a smaller Body when it crashes into a larger Body.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Aaron Davis (PhET Interactive Simulations)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import LinearFunction from '../../../../dot/js/LinearFunction.js';
import { Node } from '../../../../scenery/js/imports.js';
import gravityAndOrbits from '../../gravityAndOrbits.js';
import { SunRenderer } from './BodyRenderer.js';
// constants
const NUM_STEPS_FOR_ANIMATION = 10;
class ExplosionNode extends Node {
  constructor(body, modelViewTransformProperty) {
    super();

    // Function that computes the diameter as a function of the animation step
    const getDiameter = numClockTicksSinceExplosion => {
      if (numClockTicksSinceExplosion < NUM_STEPS_FOR_ANIMATION / 2) {
        const myFunction = new LinearFunction(0, NUM_STEPS_FOR_ANIMATION / 2, 1, this.getMaxViewDiameter(body, modelViewTransformProperty));
        return myFunction.evaluate(numClockTicksSinceExplosion);
      } else if (numClockTicksSinceExplosion < NUM_STEPS_FOR_ANIMATION) {
        const myFunction2 = new LinearFunction(NUM_STEPS_FOR_ANIMATION / 2, NUM_STEPS_FOR_ANIMATION, this.getMaxViewDiameter(body, modelViewTransformProperty), 1);
        return myFunction2.evaluate(numClockTicksSinceExplosion);
      } else {
        return 1.0;
      }
    };

    // Add the graphic that shows the explosion, uses the twinkle graphics from the cartoon sun
    this.addChild(this.getExplosionEdgeGraphic(body, getDiameter));

    // update the position of this node when the body changes, unless the body is collided
    body.positionProperty.link(() => {
      // this if statement wasn't in the Java version, but it looks weird to have the explosion drag with the mouse
      if (!body.isCollidedProperty.get()) {
        this.translation = modelViewTransformProperty.get().modelToViewPosition(body.positionProperty.get());
      }
    });
  }

  /**
   * Get a graphic for the explosion, linking diameter to the time steps since a collision occurred.
   *
   * @param body
   * @param getDiameter - diameter of graphic in view coordinates as function of time since collision
   */
  getExplosionEdgeGraphic(body, getDiameter) {
    const getDoubleRadius = radius => radius * 2;
    const explosionEdgeGraphic = new SunRenderer(body, 1, 14, getDoubleRadius);
    const explodedProperty = new DerivedProperty([body.isCollidedProperty, body.clockTicksSinceExplosionProperty], (collided, clockTicks) => collided && clockTicks <= NUM_STEPS_FOR_ANIMATION);
    explodedProperty.linkAttribute(explosionEdgeGraphic, 'visible');
    body.clockTicksSinceExplosionProperty.lazyLink(clockTicks => explosionEdgeGraphic.setDiameter(getDiameter(clockTicks)));
    return explosionEdgeGraphic;
  }
  getMaxViewDiameter(body, modelViewTransformProperty) {
    return modelViewTransformProperty.get().modelToViewDeltaX(body.diameterProperty.get()) * 2;
  }
}
gravityAndOrbits.register('ExplosionNode', ExplosionNode);
export default ExplosionNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJMaW5lYXJGdW5jdGlvbiIsIk5vZGUiLCJncmF2aXR5QW5kT3JiaXRzIiwiU3VuUmVuZGVyZXIiLCJOVU1fU1RFUFNfRk9SX0FOSU1BVElPTiIsIkV4cGxvc2lvbk5vZGUiLCJjb25zdHJ1Y3RvciIsImJvZHkiLCJtb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eSIsImdldERpYW1ldGVyIiwibnVtQ2xvY2tUaWNrc1NpbmNlRXhwbG9zaW9uIiwibXlGdW5jdGlvbiIsImdldE1heFZpZXdEaWFtZXRlciIsImV2YWx1YXRlIiwibXlGdW5jdGlvbjIiLCJhZGRDaGlsZCIsImdldEV4cGxvc2lvbkVkZ2VHcmFwaGljIiwicG9zaXRpb25Qcm9wZXJ0eSIsImxpbmsiLCJpc0NvbGxpZGVkUHJvcGVydHkiLCJnZXQiLCJ0cmFuc2xhdGlvbiIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJnZXREb3VibGVSYWRpdXMiLCJyYWRpdXMiLCJleHBsb3Npb25FZGdlR3JhcGhpYyIsImV4cGxvZGVkUHJvcGVydHkiLCJjbG9ja1RpY2tzU2luY2VFeHBsb3Npb25Qcm9wZXJ0eSIsImNvbGxpZGVkIiwiY2xvY2tUaWNrcyIsImxpbmtBdHRyaWJ1dGUiLCJsYXp5TGluayIsInNldERpYW1ldGVyIiwibW9kZWxUb1ZpZXdEZWx0YVgiLCJkaWFtZXRlclByb3BlcnR5IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJFeHBsb3Npb25Ob2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFNob3dzIGFuIGV4cGxvc2lvbiBmb3IgYSBzbWFsbGVyIEJvZHkgd2hlbiBpdCBjcmFzaGVzIGludG8gYSBsYXJnZXIgQm9keS5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBBYXJvbiBEYXZpcyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IExpbmVhckZ1bmN0aW9uIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9MaW5lYXJGdW5jdGlvbi5qcyc7XHJcbmltcG9ydCB7IE5vZGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZ3Jhdml0eUFuZE9yYml0cyBmcm9tICcuLi8uLi9ncmF2aXR5QW5kT3JiaXRzLmpzJztcclxuaW1wb3J0IEJvZHlSZW5kZXJlciwgeyBTdW5SZW5kZXJlciB9IGZyb20gJy4vQm9keVJlbmRlcmVyLmpzJztcclxuaW1wb3J0IEJvZHkgZnJvbSAnLi4vbW9kZWwvQm9keS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE5VTV9TVEVQU19GT1JfQU5JTUFUSU9OID0gMTA7XHJcblxyXG5jbGFzcyBFeHBsb3Npb25Ob2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggYm9keTogQm9keSwgbW9kZWxWaWV3VHJhbnNmb3JtUHJvcGVydHk6IFByb3BlcnR5PE1vZGVsVmlld1RyYW5zZm9ybTI+ICkge1xyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICAvLyBGdW5jdGlvbiB0aGF0IGNvbXB1dGVzIHRoZSBkaWFtZXRlciBhcyBhIGZ1bmN0aW9uIG9mIHRoZSBhbmltYXRpb24gc3RlcFxyXG4gICAgY29uc3QgZ2V0RGlhbWV0ZXIgPSAoIG51bUNsb2NrVGlja3NTaW5jZUV4cGxvc2lvbjogbnVtYmVyICkgPT4ge1xyXG4gICAgICBpZiAoIG51bUNsb2NrVGlja3NTaW5jZUV4cGxvc2lvbiA8IE5VTV9TVEVQU19GT1JfQU5JTUFUSU9OIC8gMiApIHtcclxuICAgICAgICBjb25zdCBteUZ1bmN0aW9uID0gbmV3IExpbmVhckZ1bmN0aW9uKCAwLCBOVU1fU1RFUFNfRk9SX0FOSU1BVElPTiAvIDIsXHJcbiAgICAgICAgICAxLCB0aGlzLmdldE1heFZpZXdEaWFtZXRlciggYm9keSwgbW9kZWxWaWV3VHJhbnNmb3JtUHJvcGVydHkgKSApO1xyXG4gICAgICAgIHJldHVybiBteUZ1bmN0aW9uLmV2YWx1YXRlKCBudW1DbG9ja1RpY2tzU2luY2VFeHBsb3Npb24gKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggbnVtQ2xvY2tUaWNrc1NpbmNlRXhwbG9zaW9uIDwgTlVNX1NURVBTX0ZPUl9BTklNQVRJT04gKSB7XHJcbiAgICAgICAgY29uc3QgbXlGdW5jdGlvbjIgPSBuZXcgTGluZWFyRnVuY3Rpb24oIE5VTV9TVEVQU19GT1JfQU5JTUFUSU9OIC8gMiwgTlVNX1NURVBTX0ZPUl9BTklNQVRJT04sXHJcbiAgICAgICAgICB0aGlzLmdldE1heFZpZXdEaWFtZXRlciggYm9keSwgbW9kZWxWaWV3VHJhbnNmb3JtUHJvcGVydHkgKSwgMSApO1xyXG4gICAgICAgIHJldHVybiBteUZ1bmN0aW9uMi5ldmFsdWF0ZSggbnVtQ2xvY2tUaWNrc1NpbmNlRXhwbG9zaW9uICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIDEuMDtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGdyYXBoaWMgdGhhdCBzaG93cyB0aGUgZXhwbG9zaW9uLCB1c2VzIHRoZSB0d2lua2xlIGdyYXBoaWNzIGZyb20gdGhlIGNhcnRvb24gc3VuXHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLmdldEV4cGxvc2lvbkVkZ2VHcmFwaGljKCBib2R5LCBnZXREaWFtZXRlciApICk7XHJcblxyXG4gICAgLy8gdXBkYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGlzIG5vZGUgd2hlbiB0aGUgYm9keSBjaGFuZ2VzLCB1bmxlc3MgdGhlIGJvZHkgaXMgY29sbGlkZWRcclxuICAgIGJvZHkucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCAoKSA9PiB7XHJcblxyXG4gICAgICAvLyB0aGlzIGlmIHN0YXRlbWVudCB3YXNuJ3QgaW4gdGhlIEphdmEgdmVyc2lvbiwgYnV0IGl0IGxvb2tzIHdlaXJkIHRvIGhhdmUgdGhlIGV4cGxvc2lvbiBkcmFnIHdpdGggdGhlIG1vdXNlXHJcbiAgICAgIGlmICggIWJvZHkuaXNDb2xsaWRlZFByb3BlcnR5LmdldCgpICkge1xyXG4gICAgICAgIHRoaXMudHJhbnNsYXRpb24gPSBtb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eS5nZXQoKS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBib2R5LnBvc2l0aW9uUHJvcGVydHkuZ2V0KCkgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGEgZ3JhcGhpYyBmb3IgdGhlIGV4cGxvc2lvbiwgbGlua2luZyBkaWFtZXRlciB0byB0aGUgdGltZSBzdGVwcyBzaW5jZSBhIGNvbGxpc2lvbiBvY2N1cnJlZC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBib2R5XHJcbiAgICogQHBhcmFtIGdldERpYW1ldGVyIC0gZGlhbWV0ZXIgb2YgZ3JhcGhpYyBpbiB2aWV3IGNvb3JkaW5hdGVzIGFzIGZ1bmN0aW9uIG9mIHRpbWUgc2luY2UgY29sbGlzaW9uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRFeHBsb3Npb25FZGdlR3JhcGhpYyggYm9keTogQm9keSwgZ2V0RGlhbWV0ZXI6ICggdGlja3M6IG51bWJlciApID0+IG51bWJlciApOiBCb2R5UmVuZGVyZXIge1xyXG4gICAgY29uc3QgZ2V0RG91YmxlUmFkaXVzID0gKCByYWRpdXM6IG51bWJlciApID0+IHJhZGl1cyAqIDI7XHJcblxyXG4gICAgY29uc3QgZXhwbG9zaW9uRWRnZUdyYXBoaWMgPSBuZXcgU3VuUmVuZGVyZXIoIGJvZHksIDEsIDE0LCBnZXREb3VibGVSYWRpdXMgKTtcclxuXHJcbiAgICBjb25zdCBleHBsb2RlZFByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBib2R5LmlzQ29sbGlkZWRQcm9wZXJ0eSwgYm9keS5jbG9ja1RpY2tzU2luY2VFeHBsb3Npb25Qcm9wZXJ0eSBdLFxyXG4gICAgICAoIGNvbGxpZGVkLCBjbG9ja1RpY2tzICkgPT4gY29sbGlkZWQgJiYgY2xvY2tUaWNrcyA8PSBOVU1fU1RFUFNfRk9SX0FOSU1BVElPTiApO1xyXG5cclxuICAgIGV4cGxvZGVkUHJvcGVydHkubGlua0F0dHJpYnV0ZSggZXhwbG9zaW9uRWRnZUdyYXBoaWMsICd2aXNpYmxlJyApO1xyXG5cclxuICAgIGJvZHkuY2xvY2tUaWNrc1NpbmNlRXhwbG9zaW9uUHJvcGVydHkubGF6eUxpbmsoICggY2xvY2tUaWNrczogbnVtYmVyICkgPT4gZXhwbG9zaW9uRWRnZUdyYXBoaWMuc2V0RGlhbWV0ZXIoIGdldERpYW1ldGVyKCBjbG9ja1RpY2tzICkgKSApO1xyXG5cclxuICAgIHJldHVybiBleHBsb3Npb25FZGdlR3JhcGhpYztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0TWF4Vmlld0RpYW1ldGVyKCBib2R5OiBCb2R5LCBtb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eTogUHJvcGVydHk8TW9kZWxWaWV3VHJhbnNmb3JtMj4gKTogbnVtYmVyIHtcclxuICAgIHJldHVybiBtb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eS5nZXQoKS5tb2RlbFRvVmlld0RlbHRhWCggYm9keS5kaWFtZXRlclByb3BlcnR5LmdldCgpICkgKiAyO1xyXG4gIH1cclxufVxyXG5cclxuZ3Jhdml0eUFuZE9yYml0cy5yZWdpc3RlciggJ0V4cGxvc2lvbk5vZGUnLCBFeHBsb3Npb25Ob2RlICk7XHJcbmV4cG9ydCBkZWZhdWx0IEV4cGxvc2lvbk5vZGU7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsY0FBYyxNQUFNLHNDQUFzQztBQUNqRSxTQUFTQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ3hELE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxTQUF1QkMsV0FBVyxRQUFRLG1CQUFtQjtBQUs3RDtBQUNBLE1BQU1DLHVCQUF1QixHQUFHLEVBQUU7QUFFbEMsTUFBTUMsYUFBYSxTQUFTSixJQUFJLENBQUM7RUFFeEJLLFdBQVdBLENBQUVDLElBQVUsRUFBRUMsMEJBQXlELEVBQUc7SUFDMUYsS0FBSyxDQUFDLENBQUM7O0lBRVA7SUFDQSxNQUFNQyxXQUFXLEdBQUtDLDJCQUFtQyxJQUFNO01BQzdELElBQUtBLDJCQUEyQixHQUFHTix1QkFBdUIsR0FBRyxDQUFDLEVBQUc7UUFDL0QsTUFBTU8sVUFBVSxHQUFHLElBQUlYLGNBQWMsQ0FBRSxDQUFDLEVBQUVJLHVCQUF1QixHQUFHLENBQUMsRUFDbkUsQ0FBQyxFQUFFLElBQUksQ0FBQ1Esa0JBQWtCLENBQUVMLElBQUksRUFBRUMsMEJBQTJCLENBQUUsQ0FBQztRQUNsRSxPQUFPRyxVQUFVLENBQUNFLFFBQVEsQ0FBRUgsMkJBQTRCLENBQUM7TUFDM0QsQ0FBQyxNQUNJLElBQUtBLDJCQUEyQixHQUFHTix1QkFBdUIsRUFBRztRQUNoRSxNQUFNVSxXQUFXLEdBQUcsSUFBSWQsY0FBYyxDQUFFSSx1QkFBdUIsR0FBRyxDQUFDLEVBQUVBLHVCQUF1QixFQUMxRixJQUFJLENBQUNRLGtCQUFrQixDQUFFTCxJQUFJLEVBQUVDLDBCQUEyQixDQUFDLEVBQUUsQ0FBRSxDQUFDO1FBQ2xFLE9BQU9NLFdBQVcsQ0FBQ0QsUUFBUSxDQUFFSCwyQkFBNEIsQ0FBQztNQUM1RCxDQUFDLE1BQ0k7UUFDSCxPQUFPLEdBQUc7TUFDWjtJQUNGLENBQUM7O0lBRUQ7SUFDQSxJQUFJLENBQUNLLFFBQVEsQ0FBRSxJQUFJLENBQUNDLHVCQUF1QixDQUFFVCxJQUFJLEVBQUVFLFdBQVksQ0FBRSxDQUFDOztJQUVsRTtJQUNBRixJQUFJLENBQUNVLGdCQUFnQixDQUFDQyxJQUFJLENBQUUsTUFBTTtNQUVoQztNQUNBLElBQUssQ0FBQ1gsSUFBSSxDQUFDWSxrQkFBa0IsQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFBRztRQUNwQyxJQUFJLENBQUNDLFdBQVcsR0FBR2IsMEJBQTBCLENBQUNZLEdBQUcsQ0FBQyxDQUFDLENBQUNFLG1CQUFtQixDQUFFZixJQUFJLENBQUNVLGdCQUFnQixDQUFDRyxHQUFHLENBQUMsQ0FBRSxDQUFDO01BQ3hHO0lBQ0YsQ0FBRSxDQUFDO0VBQ0w7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ1VKLHVCQUF1QkEsQ0FBRVQsSUFBVSxFQUFFRSxXQUF3QyxFQUFpQjtJQUNwRyxNQUFNYyxlQUFlLEdBQUtDLE1BQWMsSUFBTUEsTUFBTSxHQUFHLENBQUM7SUFFeEQsTUFBTUMsb0JBQW9CLEdBQUcsSUFBSXRCLFdBQVcsQ0FBRUksSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUVnQixlQUFnQixDQUFDO0lBRTVFLE1BQU1HLGdCQUFnQixHQUFHLElBQUkzQixlQUFlLENBQUUsQ0FBRVEsSUFBSSxDQUFDWSxrQkFBa0IsRUFBRVosSUFBSSxDQUFDb0IsZ0NBQWdDLENBQUUsRUFDOUcsQ0FBRUMsUUFBUSxFQUFFQyxVQUFVLEtBQU1ELFFBQVEsSUFBSUMsVUFBVSxJQUFJekIsdUJBQXdCLENBQUM7SUFFakZzQixnQkFBZ0IsQ0FBQ0ksYUFBYSxDQUFFTCxvQkFBb0IsRUFBRSxTQUFVLENBQUM7SUFFakVsQixJQUFJLENBQUNvQixnQ0FBZ0MsQ0FBQ0ksUUFBUSxDQUFJRixVQUFrQixJQUFNSixvQkFBb0IsQ0FBQ08sV0FBVyxDQUFFdkIsV0FBVyxDQUFFb0IsVUFBVyxDQUFFLENBQUUsQ0FBQztJQUV6SSxPQUFPSixvQkFBb0I7RUFDN0I7RUFFUWIsa0JBQWtCQSxDQUFFTCxJQUFVLEVBQUVDLDBCQUF5RCxFQUFXO0lBQzFHLE9BQU9BLDBCQUEwQixDQUFDWSxHQUFHLENBQUMsQ0FBQyxDQUFDYSxpQkFBaUIsQ0FBRTFCLElBQUksQ0FBQzJCLGdCQUFnQixDQUFDZCxHQUFHLENBQUMsQ0FBRSxDQUFDLEdBQUcsQ0FBQztFQUM5RjtBQUNGO0FBRUFsQixnQkFBZ0IsQ0FBQ2lDLFFBQVEsQ0FBRSxlQUFlLEVBQUU5QixhQUFjLENBQUM7QUFDM0QsZUFBZUEsYUFBYSJ9