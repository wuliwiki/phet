// Copyright 2014-2022, University of Colorado Boulder

/**
 * Draws a vector for a Body, such as a force vector or velocity vector.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Aaron Davis (PhET Interactive Simulations)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import { Node } from '../../../../scenery/js/imports.js';
import gravityAndOrbits from '../../gravityAndOrbits.js';
import Multilink from '../../../../axon/js/Multilink.js';
import optionize from '../../../../phet-core/js/optionize.js';

// constants
const FORCE_SCALE = 76.0 / 5.179E15;
class VectorNode extends Node {
  static FORCE_SCALE = FORCE_SCALE;
  constructor(body, transformProperty, visibleProperty, vectorProperty, scale, fill, outline, tandem, providedOptions) {
    const options = optionize()({
      tandem: tandem,
      visiblePropertyOptions: {
        phetioReadOnly: true
      }
    }, providedOptions);
    super(options);
    this.body = body;
    this.vectorProperty = vectorProperty;
    this.body = body;
    this.transformProperty = transformProperty;
    this.vectorNodeScale = scale;

    // Only show if the body hasn't collided
    const shouldBeShownProperty = new DerivedProperty([visibleProperty, body.isCollidedProperty], (visible, collided) => visible && !collided);
    shouldBeShownProperty.linkAttribute(this, 'visible');
    const arrowNode = new ArrowNode(0, 0, 0, 0, {
      headHeight: 15,
      headWidth: 15,
      tailWidth: 5,
      fill: fill,
      stroke: outline,
      pickable: false,
      isHeadDynamic: true,
      scaleTailToo: true
    });
    this.propertyListener = visible => {
      if (visible) {
        const tail = this.getTail();
        const tip = this.getTip(tail);
        arrowNode.setTailAndTip(tail.x, tail.y, tip.x, tip.y);
      }
    };
    Multilink.multilink([visibleProperty, vectorProperty, body.positionProperty, transformProperty], this.propertyListener);
    this.addChild(arrowNode);
  }
  getTail() {
    return this.transformProperty.get().modelToViewPosition(this.body.positionProperty.get());
  }
  getTip(tail = this.getTail()) {
    const force = this.transformProperty.get().modelToViewDelta(this.vectorProperty.get().times(this.vectorNodeScale));
    return new Vector2(force.x + tail.x, force.y + tail.y);
  }
}
gravityAndOrbits.register('VectorNode', VectorNode);
export default VectorNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJWZWN0b3IyIiwiQXJyb3dOb2RlIiwiTm9kZSIsImdyYXZpdHlBbmRPcmJpdHMiLCJNdWx0aWxpbmsiLCJvcHRpb25pemUiLCJGT1JDRV9TQ0FMRSIsIlZlY3Rvck5vZGUiLCJjb25zdHJ1Y3RvciIsImJvZHkiLCJ0cmFuc2Zvcm1Qcm9wZXJ0eSIsInZpc2libGVQcm9wZXJ0eSIsInZlY3RvclByb3BlcnR5Iiwic2NhbGUiLCJmaWxsIiwib3V0bGluZSIsInRhbmRlbSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ2aXNpYmxlUHJvcGVydHlPcHRpb25zIiwicGhldGlvUmVhZE9ubHkiLCJ2ZWN0b3JOb2RlU2NhbGUiLCJzaG91bGRCZVNob3duUHJvcGVydHkiLCJpc0NvbGxpZGVkUHJvcGVydHkiLCJ2aXNpYmxlIiwiY29sbGlkZWQiLCJsaW5rQXR0cmlidXRlIiwiYXJyb3dOb2RlIiwiaGVhZEhlaWdodCIsImhlYWRXaWR0aCIsInRhaWxXaWR0aCIsInN0cm9rZSIsInBpY2thYmxlIiwiaXNIZWFkRHluYW1pYyIsInNjYWxlVGFpbFRvbyIsInByb3BlcnR5TGlzdGVuZXIiLCJ0YWlsIiwiZ2V0VGFpbCIsInRpcCIsImdldFRpcCIsInNldFRhaWxBbmRUaXAiLCJ4IiwieSIsIm11bHRpbGluayIsInBvc2l0aW9uUHJvcGVydHkiLCJhZGRDaGlsZCIsImdldCIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJmb3JjZSIsIm1vZGVsVG9WaWV3RGVsdGEiLCJ0aW1lcyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiVmVjdG9yTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBEcmF3cyBhIHZlY3RvciBmb3IgYSBCb2R5LCBzdWNoIGFzIGEgZm9yY2UgdmVjdG9yIG9yIHZlbG9jaXR5IHZlY3Rvci5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBBYXJvbiBEYXZpcyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBBcnJvd05vZGUgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL0Fycm93Tm9kZS5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBOb2RlLCBOb2RlT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBncmF2aXR5QW5kT3JiaXRzIGZyb20gJy4uLy4uL2dyYXZpdHlBbmRPcmJpdHMuanMnO1xyXG5pbXBvcnQgQm9keSBmcm9tICcuLi9tb2RlbC9Cb2R5LmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgRk9SQ0VfU0NBTEUgPSA3Ni4wIC8gNS4xNzlFMTU7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0gRW1wdHlTZWxmT3B0aW9ucztcclxuZXhwb3J0IHR5cGUgVmVjdG9yTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIE5vZGVPcHRpb25zO1xyXG5cclxuY2xhc3MgVmVjdG9yTm9kZSBleHRlbmRzIE5vZGUge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgYm9keTogQm9keTtcclxuICBwcml2YXRlIHJlYWRvbmx5IHZlY3RvclByb3BlcnR5OiBQcm9wZXJ0eTxWZWN0b3IyPjtcclxuICBwcm90ZWN0ZWQgdHJhbnNmb3JtUHJvcGVydHk6IFByb3BlcnR5PE1vZGVsVmlld1RyYW5zZm9ybTI+O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcHJvcGVydHlMaXN0ZW5lcjogKCB2aXNpYmxlOiBib29sZWFuICkgPT4gdm9pZDtcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IEZPUkNFX1NDQUxFID0gRk9SQ0VfU0NBTEU7XHJcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IHZlY3Rvck5vZGVTY2FsZTogbnVtYmVyO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGJvZHk6IEJvZHksIHRyYW5zZm9ybVByb3BlcnR5OiBQcm9wZXJ0eTxNb2RlbFZpZXdUcmFuc2Zvcm0yPiwgdmlzaWJsZVByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPiwgdmVjdG9yUHJvcGVydHk6IFByb3BlcnR5PFZlY3RvcjI+LCBzY2FsZTogbnVtYmVyLCBmaWxsOiBDb2xvciwgb3V0bGluZTogQ29sb3IsIHRhbmRlbTogVGFuZGVtLFxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWRPcHRpb25zPzogVmVjdG9yTm9kZU9wdGlvbnMgKSB7XHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFZlY3Rvck5vZGVPcHRpb25zLCBTZWxmT3B0aW9ucywgTm9kZU9wdGlvbnM+KCkoIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0sXHJcbiAgICAgIHZpc2libGVQcm9wZXJ0eU9wdGlvbnM6IHsgcGhldGlvUmVhZE9ubHk6IHRydWUgfVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuYm9keSA9IGJvZHk7XHJcbiAgICB0aGlzLnZlY3RvclByb3BlcnR5ID0gdmVjdG9yUHJvcGVydHk7XHJcbiAgICB0aGlzLmJvZHkgPSBib2R5O1xyXG4gICAgdGhpcy50cmFuc2Zvcm1Qcm9wZXJ0eSA9IHRyYW5zZm9ybVByb3BlcnR5O1xyXG4gICAgdGhpcy52ZWN0b3JOb2RlU2NhbGUgPSBzY2FsZTtcclxuXHJcbiAgICAvLyBPbmx5IHNob3cgaWYgdGhlIGJvZHkgaGFzbid0IGNvbGxpZGVkXHJcbiAgICBjb25zdCBzaG91bGRCZVNob3duUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgICBbIHZpc2libGVQcm9wZXJ0eSwgYm9keS5pc0NvbGxpZGVkUHJvcGVydHkgXSwgKCB2aXNpYmxlLCBjb2xsaWRlZCApID0+IHZpc2libGUgJiYgIWNvbGxpZGVkXHJcbiAgICApO1xyXG4gICAgc2hvdWxkQmVTaG93blByb3BlcnR5LmxpbmtBdHRyaWJ1dGUoIHRoaXMsICd2aXNpYmxlJyApO1xyXG5cclxuICAgIGNvbnN0IGFycm93Tm9kZSA9IG5ldyBBcnJvd05vZGUoIDAsIDAsIDAsIDAsIHtcclxuICAgICAgaGVhZEhlaWdodDogMTUsXHJcbiAgICAgIGhlYWRXaWR0aDogMTUsXHJcbiAgICAgIHRhaWxXaWR0aDogNSxcclxuICAgICAgZmlsbDogZmlsbCxcclxuICAgICAgc3Ryb2tlOiBvdXRsaW5lLFxyXG4gICAgICBwaWNrYWJsZTogZmFsc2UsXHJcbiAgICAgIGlzSGVhZER5bmFtaWM6IHRydWUsXHJcbiAgICAgIHNjYWxlVGFpbFRvbzogdHJ1ZVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMucHJvcGVydHlMaXN0ZW5lciA9IHZpc2libGUgPT4ge1xyXG4gICAgICBpZiAoIHZpc2libGUgKSB7XHJcbiAgICAgICAgY29uc3QgdGFpbCA9IHRoaXMuZ2V0VGFpbCgpO1xyXG4gICAgICAgIGNvbnN0IHRpcCA9IHRoaXMuZ2V0VGlwKCB0YWlsICk7XHJcbiAgICAgICAgYXJyb3dOb2RlLnNldFRhaWxBbmRUaXAoIHRhaWwueCwgdGFpbC55LCB0aXAueCwgdGlwLnkgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFsgdmlzaWJsZVByb3BlcnR5LCB2ZWN0b3JQcm9wZXJ0eSwgYm9keS5wb3NpdGlvblByb3BlcnR5LCB0cmFuc2Zvcm1Qcm9wZXJ0eSBdLCB0aGlzLnByb3BlcnR5TGlzdGVuZXIgKTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBhcnJvd05vZGUgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0VGFpbCgpOiBWZWN0b3IyIHtcclxuICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybVByb3BlcnR5LmdldCgpLm1vZGVsVG9WaWV3UG9zaXRpb24oIHRoaXMuYm9keS5wb3NpdGlvblByb3BlcnR5LmdldCgpICk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgZ2V0VGlwKCB0YWlsOiBWZWN0b3IyID0gdGhpcy5nZXRUYWlsKCkgKTogVmVjdG9yMiB7XHJcbiAgICBjb25zdCBmb3JjZSA9IHRoaXMudHJhbnNmb3JtUHJvcGVydHkuZ2V0KCkubW9kZWxUb1ZpZXdEZWx0YSggdGhpcy52ZWN0b3JQcm9wZXJ0eS5nZXQoKS50aW1lcyggdGhpcy52ZWN0b3JOb2RlU2NhbGUgKSApO1xyXG4gICAgcmV0dXJuIG5ldyBWZWN0b3IyKCBmb3JjZS54ICsgdGFpbC54LCBmb3JjZS55ICsgdGFpbC55ICk7XHJcbiAgfVxyXG59XHJcblxyXG5ncmF2aXR5QW5kT3JiaXRzLnJlZ2lzdGVyKCAnVmVjdG9yTm9kZScsIFZlY3Rvck5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgVmVjdG9yTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBRXBFLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsU0FBUyxNQUFNLDBDQUEwQztBQUNoRSxTQUFnQkMsSUFBSSxRQUFxQixtQ0FBbUM7QUFDNUUsT0FBT0MsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBSXhELE9BQU9DLFNBQVMsTUFBTSxrQ0FBa0M7QUFDeEQsT0FBT0MsU0FBUyxNQUE0Qix1Q0FBdUM7O0FBRW5GO0FBQ0EsTUFBTUMsV0FBVyxHQUFHLElBQUksR0FBRyxRQUFRO0FBS25DLE1BQU1DLFVBQVUsU0FBU0wsSUFBSSxDQUFDO0VBSzVCLE9BQXVCSSxXQUFXLEdBQUdBLFdBQVc7RUFHekNFLFdBQVdBLENBQUVDLElBQVUsRUFBRUMsaUJBQWdELEVBQUVDLGVBQWtDLEVBQUVDLGNBQWlDLEVBQUVDLEtBQWEsRUFBRUMsSUFBVyxFQUFFQyxPQUFjLEVBQUVDLE1BQWMsRUFDL0xDLGVBQW1DLEVBQUc7SUFDeEQsTUFBTUMsT0FBTyxHQUFHYixTQUFTLENBQThDLENBQUMsQ0FBRTtNQUN4RVcsTUFBTSxFQUFFQSxNQUFNO01BQ2RHLHNCQUFzQixFQUFFO1FBQUVDLGNBQWMsRUFBRTtNQUFLO0lBQ2pELENBQUMsRUFBRUgsZUFBZ0IsQ0FBQztJQUNwQixLQUFLLENBQUVDLE9BQVEsQ0FBQztJQUVoQixJQUFJLENBQUNULElBQUksR0FBR0EsSUFBSTtJQUNoQixJQUFJLENBQUNHLGNBQWMsR0FBR0EsY0FBYztJQUNwQyxJQUFJLENBQUNILElBQUksR0FBR0EsSUFBSTtJQUNoQixJQUFJLENBQUNDLGlCQUFpQixHQUFHQSxpQkFBaUI7SUFDMUMsSUFBSSxDQUFDVyxlQUFlLEdBQUdSLEtBQUs7O0lBRTVCO0lBQ0EsTUFBTVMscUJBQXFCLEdBQUcsSUFBSXZCLGVBQWUsQ0FDL0MsQ0FBRVksZUFBZSxFQUFFRixJQUFJLENBQUNjLGtCQUFrQixDQUFFLEVBQUUsQ0FBRUMsT0FBTyxFQUFFQyxRQUFRLEtBQU1ELE9BQU8sSUFBSSxDQUFDQyxRQUNyRixDQUFDO0lBQ0RILHFCQUFxQixDQUFDSSxhQUFhLENBQUUsSUFBSSxFQUFFLFNBQVUsQ0FBQztJQUV0RCxNQUFNQyxTQUFTLEdBQUcsSUFBSTFCLFNBQVMsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU7TUFDM0MyQixVQUFVLEVBQUUsRUFBRTtNQUNkQyxTQUFTLEVBQUUsRUFBRTtNQUNiQyxTQUFTLEVBQUUsQ0FBQztNQUNaaEIsSUFBSSxFQUFFQSxJQUFJO01BQ1ZpQixNQUFNLEVBQUVoQixPQUFPO01BQ2ZpQixRQUFRLEVBQUUsS0FBSztNQUNmQyxhQUFhLEVBQUUsSUFBSTtNQUNuQkMsWUFBWSxFQUFFO0lBQ2hCLENBQUUsQ0FBQztJQUVILElBQUksQ0FBQ0MsZ0JBQWdCLEdBQUdYLE9BQU8sSUFBSTtNQUNqQyxJQUFLQSxPQUFPLEVBQUc7UUFDYixNQUFNWSxJQUFJLEdBQUcsSUFBSSxDQUFDQyxPQUFPLENBQUMsQ0FBQztRQUMzQixNQUFNQyxHQUFHLEdBQUcsSUFBSSxDQUFDQyxNQUFNLENBQUVILElBQUssQ0FBQztRQUMvQlQsU0FBUyxDQUFDYSxhQUFhLENBQUVKLElBQUksQ0FBQ0ssQ0FBQyxFQUFFTCxJQUFJLENBQUNNLENBQUMsRUFBRUosR0FBRyxDQUFDRyxDQUFDLEVBQUVILEdBQUcsQ0FBQ0ksQ0FBRSxDQUFDO01BQ3pEO0lBQ0YsQ0FBQztJQUNEdEMsU0FBUyxDQUFDdUMsU0FBUyxDQUFFLENBQUVoQyxlQUFlLEVBQUVDLGNBQWMsRUFBRUgsSUFBSSxDQUFDbUMsZ0JBQWdCLEVBQUVsQyxpQkFBaUIsQ0FBRSxFQUFFLElBQUksQ0FBQ3lCLGdCQUFpQixDQUFDO0lBRTNILElBQUksQ0FBQ1UsUUFBUSxDQUFFbEIsU0FBVSxDQUFDO0VBQzVCO0VBRVFVLE9BQU9BLENBQUEsRUFBWTtJQUN6QixPQUFPLElBQUksQ0FBQzNCLGlCQUFpQixDQUFDb0MsR0FBRyxDQUFDLENBQUMsQ0FBQ0MsbUJBQW1CLENBQUUsSUFBSSxDQUFDdEMsSUFBSSxDQUFDbUMsZ0JBQWdCLENBQUNFLEdBQUcsQ0FBQyxDQUFFLENBQUM7RUFDN0Y7RUFFVVAsTUFBTUEsQ0FBRUgsSUFBYSxHQUFHLElBQUksQ0FBQ0MsT0FBTyxDQUFDLENBQUMsRUFBWTtJQUMxRCxNQUFNVyxLQUFLLEdBQUcsSUFBSSxDQUFDdEMsaUJBQWlCLENBQUNvQyxHQUFHLENBQUMsQ0FBQyxDQUFDRyxnQkFBZ0IsQ0FBRSxJQUFJLENBQUNyQyxjQUFjLENBQUNrQyxHQUFHLENBQUMsQ0FBQyxDQUFDSSxLQUFLLENBQUUsSUFBSSxDQUFDN0IsZUFBZ0IsQ0FBRSxDQUFDO0lBQ3RILE9BQU8sSUFBSXJCLE9BQU8sQ0FBRWdELEtBQUssQ0FBQ1AsQ0FBQyxHQUFHTCxJQUFJLENBQUNLLENBQUMsRUFBRU8sS0FBSyxDQUFDTixDQUFDLEdBQUdOLElBQUksQ0FBQ00sQ0FBRSxDQUFDO0VBQzFEO0FBQ0Y7QUFFQXZDLGdCQUFnQixDQUFDZ0QsUUFBUSxDQUFFLFlBQVksRUFBRTVDLFVBQVcsQ0FBQztBQUNyRCxlQUFlQSxVQUFVIn0=