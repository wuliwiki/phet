// Copyright 2014-2023, University of Colorado Boulder

/**
 * BodyNode renders one piccolo PNode for a Body, which can be at model or real scale.  It is also draggable,
 * which changes the position of the Body.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Aaron Davis (PhET Interactive Simulations)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { DragListener, Line, Node, Rectangle, Text } from '../../../../scenery/js/imports.js';
import gravityAndOrbits from '../../gravityAndOrbits.js';
import GravityAndOrbitsColors from '../GravityAndOrbitsColors.js';
import Multilink from '../../../../axon/js/Multilink.js';
class BodyNode extends Node {
  /**
   * Constructor for BodyNode
   * @param body
   * @param labelAngle - Angle at which to show the name label, different for different BodyNodes so they
   *                              don't overlap too much
   * @param isPlayingProperty is the simulation playing?
   * @param scene
   * @param tandem
   */
  constructor(body, labelAngle, isPlayingProperty, scene, tandem) {
    super({
      cursor: 'pointer',
      tandem: tandem,
      pickable: true,
      phetioInputEnabledPropertyInstrumented: true
    });
    const clock = scene.getClock();
    this.modelViewTransformProperty = scene.transformProperty;
    this.body = body;
    this.body.isCollidedProperty.link(isCollided => this.setVisible(!isCollided));
    this.bodyRenderer = this.body.createRenderer(this.getViewDiameter());
    this.addChild(this.bodyRenderer);

    // images rotate the target body with the rotation property
    const rotationListener = rotation => {
      // if the body has a 'target mass' representation, only rotate that one
      if (this.bodyRenderer.targetBodyRenderer) {
        this.bodyRenderer.targetBodyRenderer.rotation = rotation;
      } else {
        this.bodyRenderer.rotation = rotation;
      }
    };
    body.rotationProperty.link(rotationListener);
    const dragBoundsProperty = new DerivedProperty([scene.modelBoundsProperty, body.diameterProperty], (modelBounds, diameter) => {
      assert && assert(modelBounds !== null);
      return modelBounds.eroded(diameter / 2);
    });

    // If a body is dragged while the sim is paused, it sets new "initial conditions" that can be rewound to
    const saveStateIfPaused = () => {
      if (!isPlayingProperty.value) {
        clock.setSimulationTime(0.0);

        // if paused, the state of the orbital system should be saved so that rewind will revert to the last placement of bodies
        scene.saveState();
      }
    };
    const dragListener = new DragListener({
      positionProperty: body.positionProperty,
      transform: this.modelViewTransformProperty,
      dragBoundsProperty: dragBoundsProperty,
      start: () => {
        body.userControlled = true;

        // Clear the path when dragging starts.
        body.clearPath();
        saveStateIfPaused();
      },
      drag: () => {
        body.userModifiedPositionEmitter.emit();
        saveStateIfPaused();
      },
      end: () => {
        body.userControlled = false;
        saveStateIfPaused();
      },
      tandem: tandem.createTandem('dragListener')
    });
    this.addInputListener(dragListener);

    // create position and diameter listeners so that they can be unlinked for garbage collection and so that anonymous
    // closures are not necessary through multilink
    this.positionListener = (position, modelViewTransform) => {
      this.setTranslation(modelViewTransform.modelToViewPosition(position));
    };
    Multilink.multilink([this.body.positionProperty, this.modelViewTransformProperty], this.positionListener);
    this.diameterListener = () => {
      const viewDiameter = this.getViewDiameter();
      this.bodyRenderer.setDiameter(viewDiameter);
      const viewCenter = this.bodyRenderer.bounds.center;

      // touch areas need to change with diameter
      const circle = Shape.circle(viewCenter.x, viewCenter.y, viewDiameter / 2 + body.touchDilation);
      this.touchArea = circle;
      this.mouseArea = circle;
    };
    Multilink.multilink([this.body.diameterProperty, this.modelViewTransformProperty], this.diameterListener);
    this.modelBoundsListener = dragBounds => {
      // when changing the bounds, we want to set the bounds of the planet without modifying the position
      // of the planets.  We store the position, and restore once drag bounds have been set
      // these changes should never set rewindable values of the body Properties
      this.body.freezeRewindChangeProperty.set(true);
      this.body.positionProperty.set(this.body.positionProperty.value);

      // now unfreeze the Property rewindValues
      this.body.freezeRewindChangeProperty.set(false);
    };
    scene.modelBoundsProperty.link(this.modelBoundsListener);

    // Points to the sphere with a text indicator and line when it is too small to see (in modes with realistic units)
    this.addChild(this.createArrowIndicator(this.body, labelAngle, tandem.createTandem('indicatorNode')));
  }

  /**
   * Return a Node that points to the sphere with a text indicator and line when it is too small to see (in modes
   * with realistic units)
   */
  createArrowIndicator(body, labelAngle, tandem) {
    const node = new Node({
      tandem: tandem,
      phetioDocumentation: 'When the body is too small to see (depending on the zoom level), this shows a line that ' + 'points to the body and indicates its name with a label.'
    });
    const viewCenter = new Vector2(0, 0);
    const northEastVector = Vector2.createPolar(1, labelAngle);
    const tip = northEastVector.times(10).plus(viewCenter);
    const tail = northEastVector.times(70).plus(viewCenter);
    const labelTextTandem = tandem.createTandem('labelText');
    node.addChild(new Line(tail.x, tail.y, tip.x, tip.y, {
      stroke: GravityAndOrbitsColors.bodyLabelIndicatorProperty
    }));
    const labelText = new Text(body.labelStringProperty, {
      font: new PhetFont(18),
      fill: GravityAndOrbitsColors.foregroundProperty,
      maxWidth: 65,
      tandem: labelTextTandem
    });

    // Eliminate artifacts seen on Windows chrome by adding an invisible rectangle underlay, see
    // https://github.com/phetsims/QA/issues/519
    // 1px is too small for ?stringTest=long because the underlay rectangle is reduced in size as well
    const antiArtifactRectangle = new Rectangle({
      // A rectangle with no fill doesn't paint, so we paint with low or no opacity to make sure that region is painted
      fill: 'transparent'
    });
    labelText.boundsProperty.link(bounds => {
      antiArtifactRectangle.rectBounds = bounds.dilated(10);
    });
    const labelWithAntiArtifactRectangle = new Node({
      children: [antiArtifactRectangle, labelText]
    });
    labelWithAntiArtifactRectangle.localBoundsProperty.link(() => {
      labelWithAntiArtifactRectangle.centerX = tail.x;
      labelWithAntiArtifactRectangle.y = tail.y - this.bodyRenderer.height - 10;
    });
    node.addChild(labelWithAntiArtifactRectangle);

    // when transform or mass changes diameter, check for visibility change of label
    const labelVisibilityListener = () => node.setVisible(this.getViewDiameter() <= 12);
    this.body.diameterProperty.link(labelVisibilityListener);
    this.modelViewTransformProperty.link(labelVisibilityListener);
    return node;
  }

  /**
   * Get the diameter of the body in view coordinates.
   */
  getViewDiameter() {
    const viewDiameter = this.modelViewTransformProperty.get().modelToViewDeltaX(this.body.diameterProperty.get());
    return Math.max(viewDiameter, 2);
  }
}
gravityAndOrbits.register('BodyNode', BodyNode);
export default BodyNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJWZWN0b3IyIiwiU2hhcGUiLCJQaGV0Rm9udCIsIkRyYWdMaXN0ZW5lciIsIkxpbmUiLCJOb2RlIiwiUmVjdGFuZ2xlIiwiVGV4dCIsImdyYXZpdHlBbmRPcmJpdHMiLCJHcmF2aXR5QW5kT3JiaXRzQ29sb3JzIiwiTXVsdGlsaW5rIiwiQm9keU5vZGUiLCJjb25zdHJ1Y3RvciIsImJvZHkiLCJsYWJlbEFuZ2xlIiwiaXNQbGF5aW5nUHJvcGVydHkiLCJzY2VuZSIsInRhbmRlbSIsImN1cnNvciIsInBpY2thYmxlIiwicGhldGlvSW5wdXRFbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQiLCJjbG9jayIsImdldENsb2NrIiwibW9kZWxWaWV3VHJhbnNmb3JtUHJvcGVydHkiLCJ0cmFuc2Zvcm1Qcm9wZXJ0eSIsImlzQ29sbGlkZWRQcm9wZXJ0eSIsImxpbmsiLCJpc0NvbGxpZGVkIiwic2V0VmlzaWJsZSIsImJvZHlSZW5kZXJlciIsImNyZWF0ZVJlbmRlcmVyIiwiZ2V0Vmlld0RpYW1ldGVyIiwiYWRkQ2hpbGQiLCJyb3RhdGlvbkxpc3RlbmVyIiwicm90YXRpb24iLCJ0YXJnZXRCb2R5UmVuZGVyZXIiLCJyb3RhdGlvblByb3BlcnR5IiwiZHJhZ0JvdW5kc1Byb3BlcnR5IiwibW9kZWxCb3VuZHNQcm9wZXJ0eSIsImRpYW1ldGVyUHJvcGVydHkiLCJtb2RlbEJvdW5kcyIsImRpYW1ldGVyIiwiYXNzZXJ0IiwiZXJvZGVkIiwic2F2ZVN0YXRlSWZQYXVzZWQiLCJ2YWx1ZSIsInNldFNpbXVsYXRpb25UaW1lIiwic2F2ZVN0YXRlIiwiZHJhZ0xpc3RlbmVyIiwicG9zaXRpb25Qcm9wZXJ0eSIsInRyYW5zZm9ybSIsInN0YXJ0IiwidXNlckNvbnRyb2xsZWQiLCJjbGVhclBhdGgiLCJkcmFnIiwidXNlck1vZGlmaWVkUG9zaXRpb25FbWl0dGVyIiwiZW1pdCIsImVuZCIsImNyZWF0ZVRhbmRlbSIsImFkZElucHV0TGlzdGVuZXIiLCJwb3NpdGlvbkxpc3RlbmVyIiwicG9zaXRpb24iLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJzZXRUcmFuc2xhdGlvbiIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJtdWx0aWxpbmsiLCJkaWFtZXRlckxpc3RlbmVyIiwidmlld0RpYW1ldGVyIiwic2V0RGlhbWV0ZXIiLCJ2aWV3Q2VudGVyIiwiYm91bmRzIiwiY2VudGVyIiwiY2lyY2xlIiwieCIsInkiLCJ0b3VjaERpbGF0aW9uIiwidG91Y2hBcmVhIiwibW91c2VBcmVhIiwibW9kZWxCb3VuZHNMaXN0ZW5lciIsImRyYWdCb3VuZHMiLCJmcmVlemVSZXdpbmRDaGFuZ2VQcm9wZXJ0eSIsInNldCIsImNyZWF0ZUFycm93SW5kaWNhdG9yIiwibm9kZSIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJub3J0aEVhc3RWZWN0b3IiLCJjcmVhdGVQb2xhciIsInRpcCIsInRpbWVzIiwicGx1cyIsInRhaWwiLCJsYWJlbFRleHRUYW5kZW0iLCJzdHJva2UiLCJib2R5TGFiZWxJbmRpY2F0b3JQcm9wZXJ0eSIsImxhYmVsVGV4dCIsImxhYmVsU3RyaW5nUHJvcGVydHkiLCJmb250IiwiZmlsbCIsImZvcmVncm91bmRQcm9wZXJ0eSIsIm1heFdpZHRoIiwiYW50aUFydGlmYWN0UmVjdGFuZ2xlIiwiYm91bmRzUHJvcGVydHkiLCJyZWN0Qm91bmRzIiwiZGlsYXRlZCIsImxhYmVsV2l0aEFudGlBcnRpZmFjdFJlY3RhbmdsZSIsImNoaWxkcmVuIiwibG9jYWxCb3VuZHNQcm9wZXJ0eSIsImNlbnRlclgiLCJoZWlnaHQiLCJsYWJlbFZpc2liaWxpdHlMaXN0ZW5lciIsImdldCIsIm1vZGVsVG9WaWV3RGVsdGFYIiwiTWF0aCIsIm1heCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQm9keU5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQm9keU5vZGUgcmVuZGVycyBvbmUgcGljY29sbyBQTm9kZSBmb3IgYSBCb2R5LCB3aGljaCBjYW4gYmUgYXQgbW9kZWwgb3IgcmVhbCBzY2FsZS4gIEl0IGlzIGFsc28gZHJhZ2dhYmxlLFxyXG4gKiB3aGljaCBjaGFuZ2VzIHRoZSBwb3NpdGlvbiBvZiB0aGUgQm9keS5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBBYXJvbiBEYXZpcyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IEJvZHkgZnJvbSAnLi4vbW9kZWwvQm9keS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUGhldEZvbnQuanMnO1xyXG5pbXBvcnQgeyBEcmFnTGlzdGVuZXIsIExpbmUsIE5vZGUsIFJlY3RhbmdsZSwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBncmF2aXR5QW5kT3JiaXRzIGZyb20gJy4uLy4uL2dyYXZpdHlBbmRPcmJpdHMuanMnO1xyXG5pbXBvcnQgR3Jhdml0eUFuZE9yYml0c0NvbG9ycyBmcm9tICcuLi9HcmF2aXR5QW5kT3JiaXRzQ29sb3JzLmpzJztcclxuaW1wb3J0IEdyYXZpdHlBbmRPcmJpdHNTY2VuZSBmcm9tICcuLi9HcmF2aXR5QW5kT3JiaXRzU2NlbmUuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgQm9keVJlbmRlcmVyIGZyb20gJy4vQm9keVJlbmRlcmVyLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5cclxuY2xhc3MgQm9keU5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IG1vZGVsVmlld1RyYW5zZm9ybVByb3BlcnR5OiBQcm9wZXJ0eTxNb2RlbFZpZXdUcmFuc2Zvcm0yPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgYm9keTogQm9keTtcclxuICBwdWJsaWMgcmVhZG9ubHkgYm9keVJlbmRlcmVyOiBCb2R5UmVuZGVyZXI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBwb3NpdGlvbkxpc3RlbmVyOiAoIHBvc2l0aW9uOiBWZWN0b3IyLCBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTIgKSA9PiB2b2lkO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlhbWV0ZXJMaXN0ZW5lcjogKCkgPT4gdm9pZDtcclxuICBwcml2YXRlIHJlYWRvbmx5IG1vZGVsQm91bmRzTGlzdGVuZXI6ICggZHJhZ0JvdW5kczogQm91bmRzMiB8IG51bGwgKSA9PiB2b2lkO1xyXG5cclxuICAvKipcclxuICAgKiBDb25zdHJ1Y3RvciBmb3IgQm9keU5vZGVcclxuICAgKiBAcGFyYW0gYm9keVxyXG4gICAqIEBwYXJhbSBsYWJlbEFuZ2xlIC0gQW5nbGUgYXQgd2hpY2ggdG8gc2hvdyB0aGUgbmFtZSBsYWJlbCwgZGlmZmVyZW50IGZvciBkaWZmZXJlbnQgQm9keU5vZGVzIHNvIHRoZXlcclxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvbid0IG92ZXJsYXAgdG9vIG11Y2hcclxuICAgKiBAcGFyYW0gaXNQbGF5aW5nUHJvcGVydHkgaXMgdGhlIHNpbXVsYXRpb24gcGxheWluZz9cclxuICAgKiBAcGFyYW0gc2NlbmVcclxuICAgKiBAcGFyYW0gdGFuZGVtXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBib2R5OiBCb2R5LCBsYWJlbEFuZ2xlOiBudW1iZXIsIGlzUGxheWluZ1Byb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPiwgc2NlbmU6IEdyYXZpdHlBbmRPcmJpdHNTY2VuZSwgdGFuZGVtOiBUYW5kZW0gKSB7XHJcbiAgICBzdXBlcigge1xyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0sXHJcbiAgICAgIHBpY2thYmxlOiB0cnVlLFxyXG4gICAgICBwaGV0aW9JbnB1dEVuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZDogdHJ1ZVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGNsb2NrID0gc2NlbmUuZ2V0Q2xvY2soKTtcclxuXHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybVByb3BlcnR5ID0gc2NlbmUudHJhbnNmb3JtUHJvcGVydHk7XHJcbiAgICB0aGlzLmJvZHkgPSBib2R5O1xyXG5cclxuICAgIHRoaXMuYm9keS5pc0NvbGxpZGVkUHJvcGVydHkubGluayggaXNDb2xsaWRlZCA9PiB0aGlzLnNldFZpc2libGUoICFpc0NvbGxpZGVkICkgKTtcclxuXHJcbiAgICB0aGlzLmJvZHlSZW5kZXJlciA9IHRoaXMuYm9keS5jcmVhdGVSZW5kZXJlciggdGhpcy5nZXRWaWV3RGlhbWV0ZXIoKSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5ib2R5UmVuZGVyZXIgKTtcclxuXHJcbiAgICAvLyBpbWFnZXMgcm90YXRlIHRoZSB0YXJnZXQgYm9keSB3aXRoIHRoZSByb3RhdGlvbiBwcm9wZXJ0eVxyXG4gICAgY29uc3Qgcm90YXRpb25MaXN0ZW5lciA9ICggcm90YXRpb246IG51bWJlciApID0+IHtcclxuXHJcbiAgICAgIC8vIGlmIHRoZSBib2R5IGhhcyBhICd0YXJnZXQgbWFzcycgcmVwcmVzZW50YXRpb24sIG9ubHkgcm90YXRlIHRoYXQgb25lXHJcbiAgICAgIGlmICggdGhpcy5ib2R5UmVuZGVyZXIudGFyZ2V0Qm9keVJlbmRlcmVyICkge1xyXG4gICAgICAgIHRoaXMuYm9keVJlbmRlcmVyLnRhcmdldEJvZHlSZW5kZXJlci5yb3RhdGlvbiA9IHJvdGF0aW9uO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYm9keVJlbmRlcmVyLnJvdGF0aW9uID0gcm90YXRpb247XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBib2R5LnJvdGF0aW9uUHJvcGVydHkubGluayggcm90YXRpb25MaXN0ZW5lciApO1xyXG5cclxuICAgIGNvbnN0IGRyYWdCb3VuZHNQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgc2NlbmUubW9kZWxCb3VuZHNQcm9wZXJ0eSwgYm9keS5kaWFtZXRlclByb3BlcnR5IF0sICggbW9kZWxCb3VuZHMsIGRpYW1ldGVyICkgPT4ge1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBtb2RlbEJvdW5kcyAhPT0gbnVsbCApO1xyXG5cclxuICAgICAgcmV0dXJuIG1vZGVsQm91bmRzIS5lcm9kZWQoIGRpYW1ldGVyIC8gMiApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIElmIGEgYm9keSBpcyBkcmFnZ2VkIHdoaWxlIHRoZSBzaW0gaXMgcGF1c2VkLCBpdCBzZXRzIG5ldyBcImluaXRpYWwgY29uZGl0aW9uc1wiIHRoYXQgY2FuIGJlIHJld291bmQgdG9cclxuICAgIGNvbnN0IHNhdmVTdGF0ZUlmUGF1c2VkID0gKCkgPT4ge1xyXG5cclxuICAgICAgaWYgKCAhaXNQbGF5aW5nUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgY2xvY2suc2V0U2ltdWxhdGlvblRpbWUoIDAuMCApO1xyXG5cclxuICAgICAgICAvLyBpZiBwYXVzZWQsIHRoZSBzdGF0ZSBvZiB0aGUgb3JiaXRhbCBzeXN0ZW0gc2hvdWxkIGJlIHNhdmVkIHNvIHRoYXQgcmV3aW5kIHdpbGwgcmV2ZXJ0IHRvIHRoZSBsYXN0IHBsYWNlbWVudCBvZiBib2RpZXNcclxuICAgICAgICBzY2VuZS5zYXZlU3RhdGUoKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIGNvbnN0IGRyYWdMaXN0ZW5lciA9IG5ldyBEcmFnTGlzdGVuZXIoIHtcclxuICAgICAgcG9zaXRpb25Qcm9wZXJ0eTogYm9keS5wb3NpdGlvblByb3BlcnR5LFxyXG4gICAgICB0cmFuc2Zvcm06IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtUHJvcGVydHksXHJcbiAgICAgIGRyYWdCb3VuZHNQcm9wZXJ0eTogZHJhZ0JvdW5kc1Byb3BlcnR5LFxyXG4gICAgICBzdGFydDogKCkgPT4ge1xyXG4gICAgICAgIGJvZHkudXNlckNvbnRyb2xsZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAvLyBDbGVhciB0aGUgcGF0aCB3aGVuIGRyYWdnaW5nIHN0YXJ0cy5cclxuICAgICAgICBib2R5LmNsZWFyUGF0aCgpO1xyXG5cclxuICAgICAgICBzYXZlU3RhdGVJZlBhdXNlZCgpO1xyXG4gICAgICB9LFxyXG4gICAgICBkcmFnOiAoKSA9PiB7XHJcbiAgICAgICAgYm9keS51c2VyTW9kaWZpZWRQb3NpdGlvbkVtaXR0ZXIuZW1pdCgpO1xyXG4gICAgICAgIHNhdmVTdGF0ZUlmUGF1c2VkKCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGVuZDogKCkgPT4ge1xyXG4gICAgICAgIGJvZHkudXNlckNvbnRyb2xsZWQgPSBmYWxzZTtcclxuICAgICAgICBzYXZlU3RhdGVJZlBhdXNlZCgpO1xyXG4gICAgICB9LFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdkcmFnTGlzdGVuZXInIClcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmFkZElucHV0TGlzdGVuZXIoIGRyYWdMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIGNyZWF0ZSBwb3NpdGlvbiBhbmQgZGlhbWV0ZXIgbGlzdGVuZXJzIHNvIHRoYXQgdGhleSBjYW4gYmUgdW5saW5rZWQgZm9yIGdhcmJhZ2UgY29sbGVjdGlvbiBhbmQgc28gdGhhdCBhbm9ueW1vdXNcclxuICAgIC8vIGNsb3N1cmVzIGFyZSBub3QgbmVjZXNzYXJ5IHRocm91Z2ggbXVsdGlsaW5rXHJcbiAgICB0aGlzLnBvc2l0aW9uTGlzdGVuZXIgPSAoIHBvc2l0aW9uLCBtb2RlbFZpZXdUcmFuc2Zvcm0gKSA9PiB7XHJcbiAgICAgIHRoaXMuc2V0VHJhbnNsYXRpb24oIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBwb3NpdGlvbiApICk7XHJcbiAgICB9O1xyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayggWyB0aGlzLmJvZHkucG9zaXRpb25Qcm9wZXJ0eSwgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eSBdLCB0aGlzLnBvc2l0aW9uTGlzdGVuZXIgKTtcclxuXHJcbiAgICB0aGlzLmRpYW1ldGVyTGlzdGVuZXIgPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHZpZXdEaWFtZXRlciA9IHRoaXMuZ2V0Vmlld0RpYW1ldGVyKCk7XHJcbiAgICAgIHRoaXMuYm9keVJlbmRlcmVyLnNldERpYW1ldGVyKCB2aWV3RGlhbWV0ZXIgKTtcclxuICAgICAgY29uc3Qgdmlld0NlbnRlciA9IHRoaXMuYm9keVJlbmRlcmVyLmJvdW5kcy5jZW50ZXI7XHJcblxyXG4gICAgICAvLyB0b3VjaCBhcmVhcyBuZWVkIHRvIGNoYW5nZSB3aXRoIGRpYW1ldGVyXHJcbiAgICAgIGNvbnN0IGNpcmNsZSA9IFNoYXBlLmNpcmNsZSggdmlld0NlbnRlci54LCB2aWV3Q2VudGVyLnksIHZpZXdEaWFtZXRlciAvIDIgKyBib2R5LnRvdWNoRGlsYXRpb24gKTtcclxuICAgICAgdGhpcy50b3VjaEFyZWEgPSBjaXJjbGU7XHJcbiAgICAgIHRoaXMubW91c2VBcmVhID0gY2lyY2xlO1xyXG4gICAgfTtcclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFsgdGhpcy5ib2R5LmRpYW1ldGVyUHJvcGVydHksIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtUHJvcGVydHkgXSwgdGhpcy5kaWFtZXRlckxpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5tb2RlbEJvdW5kc0xpc3RlbmVyID0gZHJhZ0JvdW5kcyA9PiB7XHJcblxyXG4gICAgICAvLyB3aGVuIGNoYW5naW5nIHRoZSBib3VuZHMsIHdlIHdhbnQgdG8gc2V0IHRoZSBib3VuZHMgb2YgdGhlIHBsYW5ldCB3aXRob3V0IG1vZGlmeWluZyB0aGUgcG9zaXRpb25cclxuICAgICAgLy8gb2YgdGhlIHBsYW5ldHMuICBXZSBzdG9yZSB0aGUgcG9zaXRpb24sIGFuZCByZXN0b3JlIG9uY2UgZHJhZyBib3VuZHMgaGF2ZSBiZWVuIHNldFxyXG4gICAgICAvLyB0aGVzZSBjaGFuZ2VzIHNob3VsZCBuZXZlciBzZXQgcmV3aW5kYWJsZSB2YWx1ZXMgb2YgdGhlIGJvZHkgUHJvcGVydGllc1xyXG4gICAgICB0aGlzLmJvZHkuZnJlZXplUmV3aW5kQ2hhbmdlUHJvcGVydHkuc2V0KCB0cnVlICk7XHJcbiAgICAgIHRoaXMuYm9keS5wb3NpdGlvblByb3BlcnR5LnNldCggdGhpcy5ib2R5LnBvc2l0aW9uUHJvcGVydHkudmFsdWUgKTtcclxuXHJcbiAgICAgIC8vIG5vdyB1bmZyZWV6ZSB0aGUgUHJvcGVydHkgcmV3aW5kVmFsdWVzXHJcbiAgICAgIHRoaXMuYm9keS5mcmVlemVSZXdpbmRDaGFuZ2VQcm9wZXJ0eS5zZXQoIGZhbHNlICk7XHJcbiAgICB9O1xyXG4gICAgc2NlbmUubW9kZWxCb3VuZHNQcm9wZXJ0eS5saW5rKCB0aGlzLm1vZGVsQm91bmRzTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBQb2ludHMgdG8gdGhlIHNwaGVyZSB3aXRoIGEgdGV4dCBpbmRpY2F0b3IgYW5kIGxpbmUgd2hlbiBpdCBpcyB0b28gc21hbGwgdG8gc2VlIChpbiBtb2RlcyB3aXRoIHJlYWxpc3RpYyB1bml0cylcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuY3JlYXRlQXJyb3dJbmRpY2F0b3IoIHRoaXMuYm9keSwgbGFiZWxBbmdsZSwgdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2luZGljYXRvck5vZGUnICkgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJuIGEgTm9kZSB0aGF0IHBvaW50cyB0byB0aGUgc3BoZXJlIHdpdGggYSB0ZXh0IGluZGljYXRvciBhbmQgbGluZSB3aGVuIGl0IGlzIHRvbyBzbWFsbCB0byBzZWUgKGluIG1vZGVzXHJcbiAgICogd2l0aCByZWFsaXN0aWMgdW5pdHMpXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjcmVhdGVBcnJvd0luZGljYXRvciggYm9keTogQm9keSwgbGFiZWxBbmdsZTogbnVtYmVyLCB0YW5kZW06IFRhbmRlbSApOiBOb2RlIHtcclxuICAgIGNvbnN0IG5vZGUgPSBuZXcgTm9kZSgge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ1doZW4gdGhlIGJvZHkgaXMgdG9vIHNtYWxsIHRvIHNlZSAoZGVwZW5kaW5nIG9uIHRoZSB6b29tIGxldmVsKSwgdGhpcyBzaG93cyBhIGxpbmUgdGhhdCAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BvaW50cyB0byB0aGUgYm9keSBhbmQgaW5kaWNhdGVzIGl0cyBuYW1lIHdpdGggYSBsYWJlbC4nXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCB2aWV3Q2VudGVyID0gbmV3IFZlY3RvcjIoIDAsIDAgKTtcclxuICAgIGNvbnN0IG5vcnRoRWFzdFZlY3RvciA9IFZlY3RvcjIuY3JlYXRlUG9sYXIoIDEsIGxhYmVsQW5nbGUgKTtcclxuICAgIGNvbnN0IHRpcCA9IG5vcnRoRWFzdFZlY3Rvci50aW1lcyggMTAgKS5wbHVzKCB2aWV3Q2VudGVyICk7XHJcbiAgICBjb25zdCB0YWlsID0gbm9ydGhFYXN0VmVjdG9yLnRpbWVzKCA3MCApLnBsdXMoIHZpZXdDZW50ZXIgKTtcclxuXHJcbiAgICBjb25zdCBsYWJlbFRleHRUYW5kZW0gPSB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnbGFiZWxUZXh0JyApO1xyXG4gICAgbm9kZS5hZGRDaGlsZCggbmV3IExpbmUoIHRhaWwueCwgdGFpbC55LCB0aXAueCwgdGlwLnksIHtcclxuICAgICAgc3Ryb2tlOiBHcmF2aXR5QW5kT3JiaXRzQ29sb3JzLmJvZHlMYWJlbEluZGljYXRvclByb3BlcnR5XHJcbiAgICB9ICkgKTtcclxuICAgIGNvbnN0IGxhYmVsVGV4dCA9IG5ldyBUZXh0KCBib2R5LmxhYmVsU3RyaW5nUHJvcGVydHkhLCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTggKSxcclxuICAgICAgZmlsbDogR3Jhdml0eUFuZE9yYml0c0NvbG9ycy5mb3JlZ3JvdW5kUHJvcGVydHksXHJcbiAgICAgIG1heFdpZHRoOiA2NSxcclxuICAgICAgdGFuZGVtOiBsYWJlbFRleHRUYW5kZW1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBFbGltaW5hdGUgYXJ0aWZhY3RzIHNlZW4gb24gV2luZG93cyBjaHJvbWUgYnkgYWRkaW5nIGFuIGludmlzaWJsZSByZWN0YW5nbGUgdW5kZXJsYXksIHNlZVxyXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL1FBL2lzc3Vlcy81MTlcclxuICAgIC8vIDFweCBpcyB0b28gc21hbGwgZm9yID9zdHJpbmdUZXN0PWxvbmcgYmVjYXVzZSB0aGUgdW5kZXJsYXkgcmVjdGFuZ2xlIGlzIHJlZHVjZWQgaW4gc2l6ZSBhcyB3ZWxsXHJcbiAgICBjb25zdCBhbnRpQXJ0aWZhY3RSZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKCB7XHJcbiAgICAgIC8vIEEgcmVjdGFuZ2xlIHdpdGggbm8gZmlsbCBkb2Vzbid0IHBhaW50LCBzbyB3ZSBwYWludCB3aXRoIGxvdyBvciBubyBvcGFjaXR5IHRvIG1ha2Ugc3VyZSB0aGF0IHJlZ2lvbiBpcyBwYWludGVkXHJcbiAgICAgIGZpbGw6ICd0cmFuc3BhcmVudCdcclxuICAgIH0gKTtcclxuICAgIGxhYmVsVGV4dC5ib3VuZHNQcm9wZXJ0eS5saW5rKCBib3VuZHMgPT4ge1xyXG4gICAgICBhbnRpQXJ0aWZhY3RSZWN0YW5nbGUucmVjdEJvdW5kcyA9IGJvdW5kcy5kaWxhdGVkKCAxMCApO1xyXG4gICAgfSApO1xyXG4gICAgY29uc3QgbGFiZWxXaXRoQW50aUFydGlmYWN0UmVjdGFuZ2xlID0gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFsgYW50aUFydGlmYWN0UmVjdGFuZ2xlLCBsYWJlbFRleHQgXVxyXG4gICAgfSApO1xyXG4gICAgbGFiZWxXaXRoQW50aUFydGlmYWN0UmVjdGFuZ2xlLmxvY2FsQm91bmRzUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICBsYWJlbFdpdGhBbnRpQXJ0aWZhY3RSZWN0YW5nbGUuY2VudGVyWCA9IHRhaWwueDtcclxuICAgICAgbGFiZWxXaXRoQW50aUFydGlmYWN0UmVjdGFuZ2xlLnkgPSB0YWlsLnkgLSB0aGlzLmJvZHlSZW5kZXJlci5oZWlnaHQgLSAxMDtcclxuICAgIH0gKTtcclxuICAgIG5vZGUuYWRkQ2hpbGQoIGxhYmVsV2l0aEFudGlBcnRpZmFjdFJlY3RhbmdsZSApO1xyXG5cclxuICAgIC8vIHdoZW4gdHJhbnNmb3JtIG9yIG1hc3MgY2hhbmdlcyBkaWFtZXRlciwgY2hlY2sgZm9yIHZpc2liaWxpdHkgY2hhbmdlIG9mIGxhYmVsXHJcbiAgICBjb25zdCBsYWJlbFZpc2liaWxpdHlMaXN0ZW5lciA9ICgpID0+IG5vZGUuc2V0VmlzaWJsZSggdGhpcy5nZXRWaWV3RGlhbWV0ZXIoKSA8PSAxMiApO1xyXG4gICAgdGhpcy5ib2R5LmRpYW1ldGVyUHJvcGVydHkubGluayggbGFiZWxWaXNpYmlsaXR5TGlzdGVuZXIgKTtcclxuICAgIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtUHJvcGVydHkubGluayggbGFiZWxWaXNpYmlsaXR5TGlzdGVuZXIgKTtcclxuXHJcbiAgICByZXR1cm4gbm9kZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgZGlhbWV0ZXIgb2YgdGhlIGJvZHkgaW4gdmlldyBjb29yZGluYXRlcy5cclxuICAgKi9cclxuICBwcml2YXRlIGdldFZpZXdEaWFtZXRlcigpOiBudW1iZXIge1xyXG4gICAgY29uc3Qgdmlld0RpYW1ldGVyID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eS5nZXQoKS5tb2RlbFRvVmlld0RlbHRhWCggdGhpcy5ib2R5LmRpYW1ldGVyUHJvcGVydHkuZ2V0KCkgKTtcclxuICAgIHJldHVybiBNYXRoLm1heCggdmlld0RpYW1ldGVyLCAyICk7XHJcbiAgfVxyXG59XHJcblxyXG5ncmF2aXR5QW5kT3JiaXRzLnJlZ2lzdGVyKCAnQm9keU5vZGUnLCBCb2R5Tm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBCb2R5Tm9kZTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBR3BFLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsU0FBU0MsS0FBSyxRQUFRLGdDQUFnQztBQUN0RCxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLFlBQVksRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLFNBQVMsRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUM3RixPQUFPQyxnQkFBZ0IsTUFBTSwyQkFBMkI7QUFDeEQsT0FBT0Msc0JBQXNCLE1BQU0sOEJBQThCO0FBTWpFLE9BQU9D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