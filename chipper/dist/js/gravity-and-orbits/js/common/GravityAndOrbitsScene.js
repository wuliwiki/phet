// Copyright 2014-2022, University of Colorado Boulder

/**
 * A GravityAndOrbitsScene behaves like a screen, it has its own model, control panel, canvas, and remembers its state
 * when you leave and come back. It is created with defaults from SceneFactory.Mode.
 * <p/>
 * The sim was designed this way so that objects are replaced instead of mutated.
 * For instance, when switching from Mode 1 to Mode 2, instead of removing Mode 1 bodies from the model,
 * storing their state, and replacing with the Mode 2 bodies, this paradigm just replaces the entire model instance.
 * <p/>
 * The advantage of this approach is that model states, canvas states and control panels are always correct,
 * and it is impossible to end up with a bug in which you have a mixture of components from multiple modes.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Aaron Davis (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../axon/js/BooleanProperty.js';
import NumberProperty from '../../../axon/js/NumberProperty.js';
import Property from '../../../axon/js/Property.js';
import Rectangle from '../../../dot/js/Rectangle.js';
import Vector2 from '../../../dot/js/Vector2.js';
import Vector2Property from '../../../dot/js/Vector2Property.js';
import merge from '../../../phet-core/js/merge.js';
import ModelViewTransform2 from '../../../phetcommon/js/view/ModelViewTransform2.js';
import PhetioObject from '../../../tandem/js/PhetioObject.js';
import Tandem from '../../../tandem/js/Tandem.js';
import IOType from '../../../tandem/js/types/IOType.js';
import ReferenceIO from '../../../tandem/js/types/ReferenceIO.js';
import gravityAndOrbits from '../gravityAndOrbits.js';
import GravityAndOrbitsConstants from './GravityAndOrbitsConstants.js';
import GravityAndOrbitsClock from './model/GravityAndOrbitsClock.js';
import GravityAndOrbitsPhysicsEngine from './model/GravityAndOrbitsPhysicsEngine.js';
import GravityAndOrbitsSceneView from './view/GravityAndOrbitsSceneView.js';
import Multilink from '../../../axon/js/Multilink.js';
import optionize from '../../../phet-core/js/optionize.js';
// constants
const PLAY_AREA_WIDTH = GravityAndOrbitsSceneView.STAGE_SIZE.width;
const PLAY_AREA_HEIGHT = GravityAndOrbitsSceneView.STAGE_SIZE.height;
class GravityAndOrbitsScene extends PhetioObject {
  /**
   * @param model
   * @param modeConfig
   * @param timeFormatter
   * @param iconImage
   * @param velocityVectorScale
   * @param massReadoutFactory - returns a node for the representation
   * @param gridSpacing
   * @param tandem
   * @param sceneViewTandem
   * @param bodies
   * @param pairs
   * @param [providedOptions]
   */
  constructor(model, modeConfig, timeFormatter, iconImage, velocityVectorScale, massReadoutFactory, gridSpacing, tandem, sceneViewTandem, bodies, pairs, providedOptions) {
    const forceScale = modeConfig.forceScale;
    const initialMeasuringTapePosition = modeConfig.initialMeasuringTapePosition;
    const defaultZoomScale = modeConfig.zoom;
    const tandemName = tandem.name;
    const radioButtonTandemName = `${tandemName}RadioButton`;
    const resetButtonTandemName = `${tandemName}ResetButton`;
    const massControlPanelTandemName = `${tandemName}MassesControlPanel`;
    const options = optionize()({
      gridCenter: new Vector2(0, 0),
      dt: modeConfig.dt,
      adjustMoonOrbit: false
    }, providedOptions);
    const gridCenter = options.gridCenter;
    const dt = options.dt;
    super({
      phetioDocumentation: 'A group of orbital masses which can be selected',
      phetioType: ReferenceIO(IOType.ObjectIO),
      phetioState: false,
      tandem: tandem
    });
    this.massControlPanel = null;
    this.activeProperty = new BooleanProperty(false);
    this.deviatedFromDefaultsProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('deviatedFromDefaultsProperty'),
      phetioDocumentation: 'for internal PhET use only',
      phetioReadOnly: true
    });
    const measuringTapePointOptions = {
      units: 'm'
    };
    const measuringTapeTandem = tandem.createTandem('measuringTape');
    this.measuringTapeStartPointProperty = new Vector2Property(initialMeasuringTapePosition.p1, merge({
      tandem: measuringTapeTandem.createTandem('startPointProperty')
    }, measuringTapePointOptions));
    this.measuringTapeEndPointProperty = new Vector2Property(initialMeasuringTapePosition.p2, merge({
      tandem: measuringTapeTandem.createTandem('endPointProperty')
    }, measuringTapePointOptions));
    this.zoomLevelProperty = new NumberProperty(1, {
      tandem: tandem.createTandem('zoomLevelProperty'),
      range: GravityAndOrbitsConstants.ZOOM_RANGE
    });
    this.radioButtonTandemName = radioButtonTandemName; // (read-only)
    this.resetButtonTandemName = resetButtonTandemName; // (read-only)
    this.tandemName = tandemName; // (read-only)
    this.massControlPanelTandemName = massControlPanelTandemName; // (read-only)

    this.dt = dt;
    this.forceScale = forceScale;
    this.iconImage = iconImage;
    this.isPlayingProperty = model.isPlayingProperty;

    // How much to scale (shrink or grow) the velocity vectors; a mapping from meters/second to stage coordinates
    this.velocityVectorScale = velocityVectorScale;
    this.gridSpacing = gridSpacing; // in meters
    this.gridCenter = gridCenter;
    this.rewindingProperty = model.rewindingProperty; // save a reference to the rewinding property of p
    this.timeSpeedProperty = model.timeSpeedProperty;
    this.timeFormatter = timeFormatter;

    // Function that creates a Node to readout the mass for the specified body node (with the specified visibility flag)
    this.massReadoutFactory = massReadoutFactory;
    this.modelBoundsProperty = new Property(null); // needed for dragListener bounds
    this.transformProperty = new Property(this.createTransform(defaultZoomScale, gridCenter));
    this.zoomLevelProperty.link(() => this.transformProperty.set(this.createTransform(defaultZoomScale, gridCenter)));
    const clock = new GravityAndOrbitsClock(model.changeRewindValueProperty, dt, model.steppingProperty, this.timeSpeedProperty, tandem, tandem.createTandem('clock'));
    this.physicsEngine = new GravityAndOrbitsPhysicsEngine(clock, model.gravityEnabledProperty, options.adjustMoonOrbit);
    Multilink.multilink([model.isPlayingProperty, this.activeProperty], (playButtonPressed, active) => this.physicsEngine.clock.setRunning(playButtonPressed && active));
    bodies.forEach(body => this.addBody(body));

    // {Node} - scenery node that depicts the play area for this scene
    this.sceneView = new GravityAndOrbitsSceneView(this, model, sceneViewTandem);
    this.pairs = pairs;

    // Save the new PhET-iO state as an initial configuration for this scene, but only if the state being set applies
    // to this scene.
    Tandem.PHET_IO_ENABLED && phet.phetio.phetioEngine.phetioStateEngine.stateSetEmitter.addListener(state => {
      const phetioIDsToSet = Object.keys(state);
      for (let i = 0; i < phetioIDsToSet.length; i++) {
        if (phetioIDsToSet[i].startsWith(this.tandem.phetioID)) {
          this.saveState();
          break;
        }
      }
    });
  }

  /**
   * Create the transform from model coordinates to stage coordinates
   */
  createTransform(defaultZoomScale, gridCenter) {
    const modelBounds = this.getTargetRectangle(defaultZoomScale * this.zoomLevelProperty.get(), gridCenter);
    this.modelBoundsProperty.set(modelBounds);
    const playAreaHeight = PLAY_AREA_HEIGHT - 50;
    const scale = playAreaHeight / PLAY_AREA_HEIGHT;
    const viewBounds = new Rectangle(30, 0, PLAY_AREA_WIDTH * scale, PLAY_AREA_HEIGHT * scale);

    // Ensure the transform is square (not stretched or squashed), so that circles transform into circles and not ellipses
    assert && assert(Math.abs(modelBounds.width / modelBounds.height - viewBounds.width / viewBounds.height) <= 1E-12);
    return ModelViewTransform2.createRectangleInvertedYMapping(modelBounds, viewBounds);
  }

  /**
   * Find the rectangle that should be viewed in the model
   */
  getTargetRectangle(targetScale, targetCenterModelPoint) {
    const z = targetScale * 1.5E-9;
    const modelWidth = PLAY_AREA_WIDTH / z;
    const modelHeight = PLAY_AREA_HEIGHT / z;
    return new Rectangle(-modelWidth / 2 + targetCenterModelPoint.x, -modelHeight / 2 + targetCenterModelPoint.y, modelWidth, modelHeight);
  }
  getClock() {
    return this.physicsEngine.clock;
  }
  getBodies() {
    return this.physicsEngine.getBodies();
  }

  /**
   * Set the deviated from defaults property - stored on the scene so that we don't have to use a closure for performance.
   */
  setDeviatedFromDefaults() {
    this.deviatedFromDefaultsProperty.set(true);
  }
  addBody(body) {
    this.physicsEngine.addBody(body);
    body.massProperty.link(this.setDeviatedFromDefaults.bind(this));
    body.userModifiedPositionEmitter.addListener(this.setDeviatedFromDefaults.bind(this));
    // body.userModifiedVelocityEmitter.addListener( this.setDeviatedFromDefaults.bind( this ) ) ;

    // if the user modifies velocity, save state while paused
    body.userModifiedVelocityEmitter.addListener(() => {
      this.setDeviatedFromDefaults();
      if (!this.isPlayingProperty.get()) {
        this.saveState();
      }
    });
  }
  reset() {
    this.activeProperty.reset();
    this.deviatedFromDefaultsProperty.reset();
    this.measuringTapeStartPointProperty.reset();
    this.measuringTapeEndPointProperty.reset();
    this.zoomLevelProperty.reset();
    this.physicsEngine.clock.resetSimulationTime();
    this.physicsEngine.resetAll();
  }

  /**
   * Return the bodies to their original states when the user presses "reset" (not "reset all")
   *
   */
  resetScene() {
    this.physicsEngine.resetBodies();
    this.deviatedFromDefaultsProperty.set(false);
    this.getClock().setSimulationTime(0.0);
    Tandem.PHET_IO_ENABLED && phet.phetio.phetioEngine.phetioStateEngine.restoreStateForPhetioObject(this);
  }

  /**
   * Restore the last set of initial conditions that were set while the sim was paused.
   */
  rewind() {
    this.rewindingProperty.set(true);
    this.getClock().timeProperty.rewind();
    const bodies = this.physicsEngine.getBodies();
    bodies.forEach(body => body.rewind());

    // update the force vectors accordingly
    this.physicsEngine.updateForceVectors();
    this.rewindingProperty.set(false);
  }

  /**
   * Save the state of the orbital system, which includes all rewindable properties of all bodies. This should only be
   * called when the sim is paused.
   */
  saveState() {
    const bodies = this.physicsEngine.getBodies();
    for (let i = 0; i < bodies.length; i++) {
      bodies[i].saveBodyState();
    }
    this.getClock().timeProperty.storeRewindValueNoNotify();
  }

  /**
   * @returns All bodies in the scene for which the mass can be changed
   */
  getMassSettableBodies() {
    const bodies = this.getBodies();
    const massSettableBodies = [];
    for (let i = 0; i < bodies.length; i++) {
      if (bodies[i].massSettable) {
        massSettableBodies.push(bodies[i]);
      }
    }
    return massSettableBodies;
  }
}
gravityAndOrbits.register('GravityAndOrbitsScene', GravityAndOrbitsScene);
export default GravityAndOrbitsScene;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIlByb3BlcnR5IiwiUmVjdGFuZ2xlIiwiVmVjdG9yMiIsIlZlY3RvcjJQcm9wZXJ0eSIsIm1lcmdlIiwiTW9kZWxWaWV3VHJhbnNmb3JtMiIsIlBoZXRpb09iamVjdCIsIlRhbmRlbSIsIklPVHlwZSIsIlJlZmVyZW5jZUlPIiwiZ3Jhdml0eUFuZE9yYml0cyIsIkdyYXZpdHlBbmRPcmJpdHNDb25zdGFudHMiLCJHcmF2aXR5QW5kT3JiaXRzQ2xvY2siLCJHcmF2aXR5QW5kT3JiaXRzUGh5c2ljc0VuZ2luZSIsIkdyYXZpdHlBbmRPcmJpdHNTY2VuZVZpZXciLCJNdWx0aWxpbmsiLCJvcHRpb25pemUiLCJQTEFZX0FSRUFfV0lEVEgiLCJTVEFHRV9TSVpFIiwid2lkdGgiLCJQTEFZX0FSRUFfSEVJR0hUIiwiaGVpZ2h0IiwiR3Jhdml0eUFuZE9yYml0c1NjZW5lIiwiY29uc3RydWN0b3IiLCJtb2RlbCIsIm1vZGVDb25maWciLCJ0aW1lRm9ybWF0dGVyIiwiaWNvbkltYWdlIiwidmVsb2NpdHlWZWN0b3JTY2FsZSIsIm1hc3NSZWFkb3V0RmFjdG9yeSIsImdyaWRTcGFjaW5nIiwidGFuZGVtIiwic2NlbmVWaWV3VGFuZGVtIiwiYm9kaWVzIiwicGFpcnMiLCJwcm92aWRlZE9wdGlvbnMiLCJmb3JjZVNjYWxlIiwiaW5pdGlhbE1lYXN1cmluZ1RhcGVQb3NpdGlvbiIsImRlZmF1bHRab29tU2NhbGUiLCJ6b29tIiwidGFuZGVtTmFtZSIsIm5hbWUiLCJyYWRpb0J1dHRvblRhbmRlbU5hbWUiLCJyZXNldEJ1dHRvblRhbmRlbU5hbWUiLCJtYXNzQ29udHJvbFBhbmVsVGFuZGVtTmFtZSIsIm9wdGlvbnMiLCJncmlkQ2VudGVyIiwiZHQiLCJhZGp1c3RNb29uT3JiaXQiLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwicGhldGlvVHlwZSIsIk9iamVjdElPIiwicGhldGlvU3RhdGUiLCJtYXNzQ29udHJvbFBhbmVsIiwiYWN0aXZlUHJvcGVydHkiLCJkZXZpYXRlZEZyb21EZWZhdWx0c1Byb3BlcnR5IiwiY3JlYXRlVGFuZGVtIiwicGhldGlvUmVhZE9ubHkiLCJtZWFzdXJpbmdUYXBlUG9pbnRPcHRpb25zIiwidW5pdHMiLCJtZWFzdXJpbmdUYXBlVGFuZGVtIiwibWVhc3VyaW5nVGFwZVN0YXJ0UG9pbnRQcm9wZXJ0eSIsInAxIiwibWVhc3VyaW5nVGFwZUVuZFBvaW50UHJvcGVydHkiLCJwMiIsInpvb21MZXZlbFByb3BlcnR5IiwicmFuZ2UiLCJaT09NX1JBTkdFIiwiaXNQbGF5aW5nUHJvcGVydHkiLCJyZXdpbmRpbmdQcm9wZXJ0eSIsInRpbWVTcGVlZFByb3BlcnR5IiwibW9kZWxCb3VuZHNQcm9wZXJ0eSIsInRyYW5zZm9ybVByb3BlcnR5IiwiY3JlYXRlVHJhbnNmb3JtIiwibGluayIsInNldCIsImNsb2NrIiwiY2hhbmdlUmV3aW5kVmFsdWVQcm9wZXJ0eSIsInN0ZXBwaW5nUHJvcGVydHkiLCJwaHlzaWNzRW5naW5lIiwiZ3Jhdml0eUVuYWJsZWRQcm9wZXJ0eSIsIm11bHRpbGluayIsInBsYXlCdXR0b25QcmVzc2VkIiwiYWN0aXZlIiwic2V0UnVubmluZyIsImZvckVhY2giLCJib2R5IiwiYWRkQm9keSIsInNjZW5lVmlldyIsIlBIRVRfSU9fRU5BQkxFRCIsInBoZXQiLCJwaGV0aW8iLCJwaGV0aW9FbmdpbmUiLCJwaGV0aW9TdGF0ZUVuZ2luZSIsInN0YXRlU2V0RW1pdHRlciIsImFkZExpc3RlbmVyIiwic3RhdGUiLCJwaGV0aW9JRHNUb1NldCIsIk9iamVjdCIsImtleXMiLCJpIiwibGVuZ3RoIiwic3RhcnRzV2l0aCIsInBoZXRpb0lEIiwic2F2ZVN0YXRlIiwibW9kZWxCb3VuZHMiLCJnZXRUYXJnZXRSZWN0YW5nbGUiLCJnZXQiLCJwbGF5QXJlYUhlaWdodCIsInNjYWxlIiwidmlld0JvdW5kcyIsImFzc2VydCIsIk1hdGgiLCJhYnMiLCJjcmVhdGVSZWN0YW5nbGVJbnZlcnRlZFlNYXBwaW5nIiwidGFyZ2V0U2NhbGUiLCJ0YXJnZXRDZW50ZXJNb2RlbFBvaW50IiwieiIsIm1vZGVsV2lkdGgiLCJtb2RlbEhlaWdodCIsIngiLCJ5IiwiZ2V0Q2xvY2siLCJnZXRCb2RpZXMiLCJzZXREZXZpYXRlZEZyb21EZWZhdWx0cyIsIm1hc3NQcm9wZXJ0eSIsImJpbmQiLCJ1c2VyTW9kaWZpZWRQb3NpdGlvbkVtaXR0ZXIiLCJ1c2VyTW9kaWZpZWRWZWxvY2l0eUVtaXR0ZXIiLCJyZXNldCIsInJlc2V0U2ltdWxhdGlvblRpbWUiLCJyZXNldEFsbCIsInJlc2V0U2NlbmUiLCJyZXNldEJvZGllcyIsInNldFNpbXVsYXRpb25UaW1lIiwicmVzdG9yZVN0YXRlRm9yUGhldGlvT2JqZWN0IiwicmV3aW5kIiwidGltZVByb3BlcnR5IiwidXBkYXRlRm9yY2VWZWN0b3JzIiwic2F2ZUJvZHlTdGF0ZSIsInN0b3JlUmV3aW5kVmFsdWVOb05vdGlmeSIsImdldE1hc3NTZXR0YWJsZUJvZGllcyIsIm1hc3NTZXR0YWJsZUJvZGllcyIsIm1hc3NTZXR0YWJsZSIsInB1c2giLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkdyYXZpdHlBbmRPcmJpdHNTY2VuZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBIEdyYXZpdHlBbmRPcmJpdHNTY2VuZSBiZWhhdmVzIGxpa2UgYSBzY3JlZW4sIGl0IGhhcyBpdHMgb3duIG1vZGVsLCBjb250cm9sIHBhbmVsLCBjYW52YXMsIGFuZCByZW1lbWJlcnMgaXRzIHN0YXRlXHJcbiAqIHdoZW4geW91IGxlYXZlIGFuZCBjb21lIGJhY2suIEl0IGlzIGNyZWF0ZWQgd2l0aCBkZWZhdWx0cyBmcm9tIFNjZW5lRmFjdG9yeS5Nb2RlLlxyXG4gKiA8cC8+XHJcbiAqIFRoZSBzaW0gd2FzIGRlc2lnbmVkIHRoaXMgd2F5IHNvIHRoYXQgb2JqZWN0cyBhcmUgcmVwbGFjZWQgaW5zdGVhZCBvZiBtdXRhdGVkLlxyXG4gKiBGb3IgaW5zdGFuY2UsIHdoZW4gc3dpdGNoaW5nIGZyb20gTW9kZSAxIHRvIE1vZGUgMiwgaW5zdGVhZCBvZiByZW1vdmluZyBNb2RlIDEgYm9kaWVzIGZyb20gdGhlIG1vZGVsLFxyXG4gKiBzdG9yaW5nIHRoZWlyIHN0YXRlLCBhbmQgcmVwbGFjaW5nIHdpdGggdGhlIE1vZGUgMiBib2RpZXMsIHRoaXMgcGFyYWRpZ20ganVzdCByZXBsYWNlcyB0aGUgZW50aXJlIG1vZGVsIGluc3RhbmNlLlxyXG4gKiA8cC8+XHJcbiAqIFRoZSBhZHZhbnRhZ2Ugb2YgdGhpcyBhcHByb2FjaCBpcyB0aGF0IG1vZGVsIHN0YXRlcywgY2FudmFzIHN0YXRlcyBhbmQgY29udHJvbCBwYW5lbHMgYXJlIGFsd2F5cyBjb3JyZWN0LFxyXG4gKiBhbmQgaXQgaXMgaW1wb3NzaWJsZSB0byBlbmQgdXAgd2l0aCBhIGJ1ZyBpbiB3aGljaCB5b3UgaGF2ZSBhIG1peHR1cmUgb2YgY29tcG9uZW50cyBmcm9tIG11bHRpcGxlIG1vZGVzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIEFhcm9uIERhdmlzIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFJlY3RhbmdsZSBmcm9tICcuLi8uLi8uLi9kb3QvanMvUmVjdGFuZ2xlLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMlByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgUGhldGlvT2JqZWN0LCB7IFBoZXRpb09iamVjdE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvUGhldGlvT2JqZWN0LmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IElPVHlwZSBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvSU9UeXBlLmpzJztcclxuaW1wb3J0IFJlZmVyZW5jZUlPIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9SZWZlcmVuY2VJTy5qcyc7XHJcbmltcG9ydCBncmF2aXR5QW5kT3JiaXRzIGZyb20gJy4uL2dyYXZpdHlBbmRPcmJpdHMuanMnO1xyXG5pbXBvcnQgR3Jhdml0eUFuZE9yYml0c0NvbnN0YW50cyBmcm9tICcuL0dyYXZpdHlBbmRPcmJpdHNDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgR3Jhdml0eUFuZE9yYml0c0Nsb2NrIGZyb20gJy4vbW9kZWwvR3Jhdml0eUFuZE9yYml0c0Nsb2NrLmpzJztcclxuaW1wb3J0IEdyYXZpdHlBbmRPcmJpdHNQaHlzaWNzRW5naW5lIGZyb20gJy4vbW9kZWwvR3Jhdml0eUFuZE9yYml0c1BoeXNpY3NFbmdpbmUuanMnO1xyXG5pbXBvcnQgR3Jhdml0eUFuZE9yYml0c1NjZW5lVmlldyBmcm9tICcuL3ZpZXcvR3Jhdml0eUFuZE9yYml0c1NjZW5lVmlldy5qcyc7XHJcbmltcG9ydCB7IE5vZGUgfSBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgR3Jhdml0eUFuZE9yYml0c01vZGVsIGZyb20gJy4vbW9kZWwvR3Jhdml0eUFuZE9yYml0c01vZGVsLmpzJztcclxuaW1wb3J0IE1vZGVDb25maWcgZnJvbSAnLi9tb2RlbC9Nb2RlQ29uZmlnLmpzJztcclxuaW1wb3J0IEJvZHlOb2RlIGZyb20gJy4vdmlldy9Cb2R5Tm9kZS5qcyc7XHJcbmltcG9ydCBCb2R5IGZyb20gJy4vbW9kZWwvQm9keS5qcyc7XHJcbmltcG9ydCBQYWlyIGZyb20gJy4vbW9kZWwvUGFpci5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IEVudW1lcmF0aW9uUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9FbnVtZXJhdGlvblByb3BlcnR5LmpzJztcclxuaW1wb3J0IFRpbWVTcGVlZCBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvVGltZVNwZWVkLmpzJztcclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgUExBWV9BUkVBX1dJRFRIID0gR3Jhdml0eUFuZE9yYml0c1NjZW5lVmlldy5TVEFHRV9TSVpFLndpZHRoO1xyXG5jb25zdCBQTEFZX0FSRUFfSEVJR0hUID0gR3Jhdml0eUFuZE9yYml0c1NjZW5lVmlldy5TVEFHRV9TSVpFLmhlaWdodDtcclxuXHJcbnR5cGUgR3Jhdml0eUFuZE9yYml0c1NjZW5lT3B0aW9ucyA9IHtcclxuICBhZGp1c3RNb29uT3JiaXQ/OiBib29sZWFuO1xyXG4gIGR0PzogbnVtYmVyO1xyXG4gIGdyaWRDZW50ZXI/OiBWZWN0b3IyO1xyXG59ICYgUGhldGlvT2JqZWN0T3B0aW9ucztcclxuXHJcbnR5cGUgTWVhc3VyaW5nVGFwZU9wdGlvbnMgPSB7XHJcbiAgdGFuZGVtPzogVGFuZGVtO1xyXG4gIHVuaXRzPzogc3RyaW5nO1xyXG59O1xyXG5cclxudHlwZSBHcmF2aXR5QW5kT3JiaXRzU2NlbmVJbXBsZW1lbnRhdGlvbk9wdGlvbnMgPSBQaWNrPEdyYXZpdHlBbmRPcmJpdHNTY2VuZU9wdGlvbnMsICdhZGp1c3RNb29uT3JiaXQnIHwgJ2R0JyB8ICdncmlkQ2VudGVyJz47XHJcblxyXG5jbGFzcyBHcmF2aXR5QW5kT3JiaXRzU2NlbmUgZXh0ZW5kcyBQaGV0aW9PYmplY3Qge1xyXG4gIHB1YmxpYyByZWFkb25seSBhY3RpdmVQcm9wZXJ0eTogQm9vbGVhblByb3BlcnR5O1xyXG4gIHB1YmxpYyByZWFkb25seSBpY29uSW1hZ2U6IE5vZGU7XHJcbiAgcHVibGljIHJlYWRvbmx5IG1vZGVsQm91bmRzUHJvcGVydHk6IFByb3BlcnR5PEJvdW5kczIgfCBudWxsPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgdHJhbnNmb3JtUHJvcGVydHk6IFByb3BlcnR5PE1vZGVsVmlld1RyYW5zZm9ybTI+O1xyXG4gIHB1YmxpYyByZWFkb25seSByYWRpb0J1dHRvblRhbmRlbU5hbWU6IHN0cmluZztcclxuICBwdWJsaWMgcmVhZG9ubHkgcmVzZXRCdXR0b25UYW5kZW1OYW1lOiBzdHJpbmc7XHJcbiAgcHVibGljIHJlYWRvbmx5IHNjZW5lVmlldzogR3Jhdml0eUFuZE9yYml0c1NjZW5lVmlldztcclxuICBwdWJsaWMgcmVhZG9ubHkgbWFzc0NvbnRyb2xQYW5lbFRhbmRlbU5hbWU6IHN0cmluZztcclxuICBwdWJsaWMgcmVhZG9ubHkgZm9yY2VTY2FsZTogbnVtYmVyO1xyXG4gIHB1YmxpYyByZWFkb25seSBwaHlzaWNzRW5naW5lOiBHcmF2aXR5QW5kT3JiaXRzUGh5c2ljc0VuZ2luZTtcclxuICBwdWJsaWMgcmVhZG9ubHkgbWFzc1JlYWRvdXRGYWN0b3J5OiAoIGFyZzA6IEJvZHlOb2RlLCBhcmcxOiBQcm9wZXJ0eTxib29sZWFuPiApID0+IE5vZGU7XHJcbiAgcHVibGljIHJlYWRvbmx5IHpvb21MZXZlbFByb3BlcnR5OiBOdW1iZXJQcm9wZXJ0eTtcclxuICBwdWJsaWMgcmVhZG9ubHkgdmVsb2NpdHlWZWN0b3JTY2FsZTogbnVtYmVyO1xyXG4gIHB1YmxpYyByZWFkb25seSBncmlkU3BhY2luZzogbnVtYmVyO1xyXG4gIHB1YmxpYyByZWFkb25seSBncmlkQ2VudGVyOiBWZWN0b3IyO1xyXG4gIHB1YmxpYyByZWFkb25seSB0aW1lRm9ybWF0dGVyOiAoIG51bWJlclByb3BlcnR5OiBUUHJvcGVydHk8bnVtYmVyPiwgdGFuZGVtOiBUYW5kZW0gKSA9PiBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+O1xyXG4gIHB1YmxpYyByZWFkb25seSBtZWFzdXJpbmdUYXBlU3RhcnRQb2ludFByb3BlcnR5OiBWZWN0b3IyUHJvcGVydHk7XHJcbiAgcHVibGljIHJlYWRvbmx5IG1lYXN1cmluZ1RhcGVFbmRQb2ludFByb3BlcnR5OiBWZWN0b3IyUHJvcGVydHk7XHJcbiAgcHVibGljIHJlYWRvbmx5IGlzUGxheWluZ1Byb3BlcnR5OiBCb29sZWFuUHJvcGVydHk7XHJcbiAgcHVibGljIG1hc3NDb250cm9sUGFuZWw6IE5vZGUgfCBudWxsO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGRldmlhdGVkRnJvbURlZmF1bHRzUHJvcGVydHk6IEJvb2xlYW5Qcm9wZXJ0eTtcclxuICBwcml2YXRlIHJlYWRvbmx5IHRhbmRlbU5hbWU6IHN0cmluZztcclxuICBwcml2YXRlIHJlYWRvbmx5IGR0OiBudW1iZXI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSByZXdpbmRpbmdQcm9wZXJ0eTogQm9vbGVhblByb3BlcnR5O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdGltZVNwZWVkUHJvcGVydHk6IEVudW1lcmF0aW9uUHJvcGVydHk8VGltZVNwZWVkPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IHBhaXJzOiBQYWlyW107XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBtb2RlbFxyXG4gICAqIEBwYXJhbSBtb2RlQ29uZmlnXHJcbiAgICogQHBhcmFtIHRpbWVGb3JtYXR0ZXJcclxuICAgKiBAcGFyYW0gaWNvbkltYWdlXHJcbiAgICogQHBhcmFtIHZlbG9jaXR5VmVjdG9yU2NhbGVcclxuICAgKiBAcGFyYW0gbWFzc1JlYWRvdXRGYWN0b3J5IC0gcmV0dXJucyBhIG5vZGUgZm9yIHRoZSByZXByZXNlbnRhdGlvblxyXG4gICAqIEBwYXJhbSBncmlkU3BhY2luZ1xyXG4gICAqIEBwYXJhbSB0YW5kZW1cclxuICAgKiBAcGFyYW0gc2NlbmVWaWV3VGFuZGVtXHJcbiAgICogQHBhcmFtIGJvZGllc1xyXG4gICAqIEBwYXJhbSBwYWlyc1xyXG4gICAqIEBwYXJhbSBbcHJvdmlkZWRPcHRpb25zXVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbW9kZWw6IEdyYXZpdHlBbmRPcmJpdHNNb2RlbCwgbW9kZUNvbmZpZzogTW9kZUNvbmZpZyxcclxuICAgICAgICAgICAgICAgICAgICAgIHRpbWVGb3JtYXR0ZXI6ICggbnVtYmVyUHJvcGVydHk6IFRQcm9wZXJ0eTxudW1iZXI+LCB0YW5kZW06IFRhbmRlbSApID0+IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBpY29uSW1hZ2U6IE5vZGUsIHZlbG9jaXR5VmVjdG9yU2NhbGU6IG51bWJlcixcclxuICAgICAgICAgICAgICAgICAgICAgIG1hc3NSZWFkb3V0RmFjdG9yeTogKCBhcmcwOiBCb2R5Tm9kZSwgYXJnMTogUHJvcGVydHk8Ym9vbGVhbj4gKSA9PiBOb2RlLCBncmlkU3BhY2luZzogbnVtYmVyLCB0YW5kZW06IFRhbmRlbSxcclxuICAgICAgICAgICAgICAgICAgICAgIHNjZW5lVmlld1RhbmRlbTogVGFuZGVtLCBib2RpZXM6IEJvZHlbXSwgcGFpcnM6IFBhaXJbXSwgcHJvdmlkZWRPcHRpb25zPzogR3Jhdml0eUFuZE9yYml0c1NjZW5lT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBmb3JjZVNjYWxlID0gbW9kZUNvbmZpZy5mb3JjZVNjYWxlO1xyXG4gICAgY29uc3QgaW5pdGlhbE1lYXN1cmluZ1RhcGVQb3NpdGlvbiA9IG1vZGVDb25maWcuaW5pdGlhbE1lYXN1cmluZ1RhcGVQb3NpdGlvbjtcclxuICAgIGNvbnN0IGRlZmF1bHRab29tU2NhbGUgPSBtb2RlQ29uZmlnLnpvb207XHJcbiAgICBjb25zdCB0YW5kZW1OYW1lID0gdGFuZGVtLm5hbWU7XHJcbiAgICBjb25zdCByYWRpb0J1dHRvblRhbmRlbU5hbWUgPSBgJHt0YW5kZW1OYW1lfVJhZGlvQnV0dG9uYDtcclxuICAgIGNvbnN0IHJlc2V0QnV0dG9uVGFuZGVtTmFtZSA9IGAke3RhbmRlbU5hbWV9UmVzZXRCdXR0b25gO1xyXG4gICAgY29uc3QgbWFzc0NvbnRyb2xQYW5lbFRhbmRlbU5hbWUgPSBgJHt0YW5kZW1OYW1lfU1hc3Nlc0NvbnRyb2xQYW5lbGA7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxHcmF2aXR5QW5kT3JiaXRzU2NlbmVJbXBsZW1lbnRhdGlvbk9wdGlvbnM+KCkoIHtcclxuICAgICAgZ3JpZENlbnRlcjogbmV3IFZlY3RvcjIoIDAsIDAgKSxcclxuICAgICAgZHQ6IG1vZGVDb25maWcuZHQsXHJcbiAgICAgIGFkanVzdE1vb25PcmJpdDogZmFsc2VcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG4gICAgY29uc3QgZ3JpZENlbnRlciA9IG9wdGlvbnMuZ3JpZENlbnRlcjtcclxuICAgIGNvbnN0IGR0ID0gb3B0aW9ucy5kdDtcclxuXHJcbiAgICBzdXBlcigge1xyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnQSBncm91cCBvZiBvcmJpdGFsIG1hc3NlcyB3aGljaCBjYW4gYmUgc2VsZWN0ZWQnLFxyXG4gICAgICBwaGV0aW9UeXBlOiBSZWZlcmVuY2VJTyggSU9UeXBlLk9iamVjdElPICksXHJcbiAgICAgIHBoZXRpb1N0YXRlOiBmYWxzZSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW1cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLm1hc3NDb250cm9sUGFuZWwgPSBudWxsO1xyXG5cclxuICAgIHRoaXMuYWN0aXZlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG5cclxuICAgIHRoaXMuZGV2aWF0ZWRGcm9tRGVmYXVsdHNQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RldmlhdGVkRnJvbURlZmF1bHRzUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdmb3IgaW50ZXJuYWwgUGhFVCB1c2Ugb25seScsXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBtZWFzdXJpbmdUYXBlUG9pbnRPcHRpb25zOiBNZWFzdXJpbmdUYXBlT3B0aW9ucyA9IHtcclxuICAgICAgdW5pdHM6ICdtJ1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBtZWFzdXJpbmdUYXBlVGFuZGVtID0gdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ21lYXN1cmluZ1RhcGUnICk7XHJcblxyXG4gICAgdGhpcy5tZWFzdXJpbmdUYXBlU3RhcnRQb2ludFByb3BlcnR5ID0gbmV3IFZlY3RvcjJQcm9wZXJ0eSggaW5pdGlhbE1lYXN1cmluZ1RhcGVQb3NpdGlvbiEucDEsIG1lcmdlKCB7XHJcbiAgICAgIHRhbmRlbTogbWVhc3VyaW5nVGFwZVRhbmRlbS5jcmVhdGVUYW5kZW0oICdzdGFydFBvaW50UHJvcGVydHknIClcclxuICAgIH0sIG1lYXN1cmluZ1RhcGVQb2ludE9wdGlvbnMgKSApO1xyXG4gICAgdGhpcy5tZWFzdXJpbmdUYXBlRW5kUG9pbnRQcm9wZXJ0eSA9IG5ldyBWZWN0b3IyUHJvcGVydHkoIGluaXRpYWxNZWFzdXJpbmdUYXBlUG9zaXRpb24hLnAyLCBtZXJnZSgge1xyXG4gICAgICB0YW5kZW06IG1lYXN1cmluZ1RhcGVUYW5kZW0uY3JlYXRlVGFuZGVtKCAnZW5kUG9pbnRQcm9wZXJ0eScgKVxyXG4gICAgfSwgbWVhc3VyaW5nVGFwZVBvaW50T3B0aW9ucyApICk7XHJcbiAgICB0aGlzLnpvb21MZXZlbFByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCAxLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3pvb21MZXZlbFByb3BlcnR5JyApLFxyXG4gICAgICByYW5nZTogR3Jhdml0eUFuZE9yYml0c0NvbnN0YW50cy5aT09NX1JBTkdFXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5yYWRpb0J1dHRvblRhbmRlbU5hbWUgPSByYWRpb0J1dHRvblRhbmRlbU5hbWU7IC8vIChyZWFkLW9ubHkpXHJcbiAgICB0aGlzLnJlc2V0QnV0dG9uVGFuZGVtTmFtZSA9IHJlc2V0QnV0dG9uVGFuZGVtTmFtZTsgLy8gKHJlYWQtb25seSlcclxuICAgIHRoaXMudGFuZGVtTmFtZSA9IHRhbmRlbU5hbWU7IC8vIChyZWFkLW9ubHkpXHJcbiAgICB0aGlzLm1hc3NDb250cm9sUGFuZWxUYW5kZW1OYW1lID0gbWFzc0NvbnRyb2xQYW5lbFRhbmRlbU5hbWU7IC8vIChyZWFkLW9ubHkpXHJcblxyXG4gICAgdGhpcy5kdCA9IGR0O1xyXG4gICAgdGhpcy5mb3JjZVNjYWxlID0gZm9yY2VTY2FsZSE7XHJcbiAgICB0aGlzLmljb25JbWFnZSA9IGljb25JbWFnZTtcclxuXHJcbiAgICB0aGlzLmlzUGxheWluZ1Byb3BlcnR5ID0gbW9kZWwuaXNQbGF5aW5nUHJvcGVydHk7XHJcblxyXG4gICAgLy8gSG93IG11Y2ggdG8gc2NhbGUgKHNocmluayBvciBncm93KSB0aGUgdmVsb2NpdHkgdmVjdG9yczsgYSBtYXBwaW5nIGZyb20gbWV0ZXJzL3NlY29uZCB0byBzdGFnZSBjb29yZGluYXRlc1xyXG4gICAgdGhpcy52ZWxvY2l0eVZlY3RvclNjYWxlID0gdmVsb2NpdHlWZWN0b3JTY2FsZTtcclxuICAgIHRoaXMuZ3JpZFNwYWNpbmcgPSBncmlkU3BhY2luZzsgLy8gaW4gbWV0ZXJzXHJcbiAgICB0aGlzLmdyaWRDZW50ZXIgPSBncmlkQ2VudGVyO1xyXG4gICAgdGhpcy5yZXdpbmRpbmdQcm9wZXJ0eSA9IG1vZGVsLnJld2luZGluZ1Byb3BlcnR5OyAvLyBzYXZlIGEgcmVmZXJlbmNlIHRvIHRoZSByZXdpbmRpbmcgcHJvcGVydHkgb2YgcFxyXG4gICAgdGhpcy50aW1lU3BlZWRQcm9wZXJ0eSA9IG1vZGVsLnRpbWVTcGVlZFByb3BlcnR5O1xyXG4gICAgdGhpcy50aW1lRm9ybWF0dGVyID0gdGltZUZvcm1hdHRlcjtcclxuXHJcbiAgICAvLyBGdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBOb2RlIHRvIHJlYWRvdXQgdGhlIG1hc3MgZm9yIHRoZSBzcGVjaWZpZWQgYm9keSBub2RlICh3aXRoIHRoZSBzcGVjaWZpZWQgdmlzaWJpbGl0eSBmbGFnKVxyXG4gICAgdGhpcy5tYXNzUmVhZG91dEZhY3RvcnkgPSBtYXNzUmVhZG91dEZhY3Rvcnk7XHJcblxyXG4gICAgdGhpcy5tb2RlbEJvdW5kc1Byb3BlcnR5ID0gbmV3IFByb3BlcnR5PEJvdW5kczIgfCBudWxsPiggbnVsbCApOyAvLyBuZWVkZWQgZm9yIGRyYWdMaXN0ZW5lciBib3VuZHNcclxuICAgIHRoaXMudHJhbnNmb3JtUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIHRoaXMuY3JlYXRlVHJhbnNmb3JtKCBkZWZhdWx0Wm9vbVNjYWxlLCBncmlkQ2VudGVyICkgKTtcclxuXHJcbiAgICB0aGlzLnpvb21MZXZlbFByb3BlcnR5LmxpbmsoICgpID0+IHRoaXMudHJhbnNmb3JtUHJvcGVydHkuc2V0KCB0aGlzLmNyZWF0ZVRyYW5zZm9ybSggZGVmYXVsdFpvb21TY2FsZSwgZ3JpZENlbnRlciApICkgKTtcclxuXHJcbiAgICBjb25zdCBjbG9jayA9IG5ldyBHcmF2aXR5QW5kT3JiaXRzQ2xvY2soIG1vZGVsLmNoYW5nZVJld2luZFZhbHVlUHJvcGVydHksIGR0LCBtb2RlbC5zdGVwcGluZ1Byb3BlcnR5LCB0aGlzLnRpbWVTcGVlZFByb3BlcnR5LCB0YW5kZW0sIHRhbmRlbS5jcmVhdGVUYW5kZW0oICdjbG9jaycgKSApO1xyXG4gICAgdGhpcy5waHlzaWNzRW5naW5lID0gbmV3IEdyYXZpdHlBbmRPcmJpdHNQaHlzaWNzRW5naW5lKCBjbG9jaywgbW9kZWwuZ3Jhdml0eUVuYWJsZWRQcm9wZXJ0eSwgb3B0aW9ucy5hZGp1c3RNb29uT3JiaXQgKTtcclxuXHJcbiAgICBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIG1vZGVsLmlzUGxheWluZ1Byb3BlcnR5LCB0aGlzLmFjdGl2ZVByb3BlcnR5IF0sICggcGxheUJ1dHRvblByZXNzZWQsIGFjdGl2ZSApID0+XHJcbiAgICAgIHRoaXMucGh5c2ljc0VuZ2luZS5jbG9jay5zZXRSdW5uaW5nKCBwbGF5QnV0dG9uUHJlc3NlZCAmJiBhY3RpdmUgKVxyXG4gICAgKTtcclxuXHJcbiAgICBib2RpZXMuZm9yRWFjaCggYm9keSA9PiB0aGlzLmFkZEJvZHkoIGJvZHkgKSApO1xyXG5cclxuICAgIC8vIHtOb2RlfSAtIHNjZW5lcnkgbm9kZSB0aGF0IGRlcGljdHMgdGhlIHBsYXkgYXJlYSBmb3IgdGhpcyBzY2VuZVxyXG4gICAgdGhpcy5zY2VuZVZpZXcgPSBuZXcgR3Jhdml0eUFuZE9yYml0c1NjZW5lVmlldyggdGhpcywgbW9kZWwsIHNjZW5lVmlld1RhbmRlbSApO1xyXG5cclxuICAgIHRoaXMucGFpcnMgPSBwYWlycztcclxuXHJcbiAgICAvLyBTYXZlIHRoZSBuZXcgUGhFVC1pTyBzdGF0ZSBhcyBhbiBpbml0aWFsIGNvbmZpZ3VyYXRpb24gZm9yIHRoaXMgc2NlbmUsIGJ1dCBvbmx5IGlmIHRoZSBzdGF0ZSBiZWluZyBzZXQgYXBwbGllc1xyXG4gICAgLy8gdG8gdGhpcyBzY2VuZS5cclxuICAgIFRhbmRlbS5QSEVUX0lPX0VOQUJMRUQgJiYgcGhldC5waGV0aW8ucGhldGlvRW5naW5lLnBoZXRpb1N0YXRlRW5naW5lLnN0YXRlU2V0RW1pdHRlci5hZGRMaXN0ZW5lciggKCBzdGF0ZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gKSA9PiB7XHJcblxyXG4gICAgICBjb25zdCBwaGV0aW9JRHNUb1NldCA9IE9iamVjdC5rZXlzKCBzdGF0ZSApO1xyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBwaGV0aW9JRHNUb1NldC5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICBpZiAoIHBoZXRpb0lEc1RvU2V0WyBpIF0uc3RhcnRzV2l0aCggdGhpcy50YW5kZW0ucGhldGlvSUQgKSApIHtcclxuICAgICAgICAgIHRoaXMuc2F2ZVN0YXRlKCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSB0aGUgdHJhbnNmb3JtIGZyb20gbW9kZWwgY29vcmRpbmF0ZXMgdG8gc3RhZ2UgY29vcmRpbmF0ZXNcclxuICAgKi9cclxuICBwcml2YXRlIGNyZWF0ZVRyYW5zZm9ybSggZGVmYXVsdFpvb21TY2FsZTogbnVtYmVyLCBncmlkQ2VudGVyOiBWZWN0b3IyICk6IE1vZGVsVmlld1RyYW5zZm9ybTIge1xyXG4gICAgY29uc3QgbW9kZWxCb3VuZHMgPSB0aGlzLmdldFRhcmdldFJlY3RhbmdsZSggZGVmYXVsdFpvb21TY2FsZSAqIHRoaXMuem9vbUxldmVsUHJvcGVydHkuZ2V0KCksIGdyaWRDZW50ZXIgKTtcclxuICAgIHRoaXMubW9kZWxCb3VuZHNQcm9wZXJ0eS5zZXQoIG1vZGVsQm91bmRzICk7XHJcbiAgICBjb25zdCBwbGF5QXJlYUhlaWdodCA9IFBMQVlfQVJFQV9IRUlHSFQgLSA1MDtcclxuICAgIGNvbnN0IHNjYWxlID0gcGxheUFyZWFIZWlnaHQgLyBQTEFZX0FSRUFfSEVJR0hUO1xyXG4gICAgY29uc3Qgdmlld0JvdW5kcyA9IG5ldyBSZWN0YW5nbGUoIDMwLCAwLCBQTEFZX0FSRUFfV0lEVEggKiBzY2FsZSwgUExBWV9BUkVBX0hFSUdIVCAqIHNjYWxlICk7XHJcblxyXG4gICAgLy8gRW5zdXJlIHRoZSB0cmFuc2Zvcm0gaXMgc3F1YXJlIChub3Qgc3RyZXRjaGVkIG9yIHNxdWFzaGVkKSwgc28gdGhhdCBjaXJjbGVzIHRyYW5zZm9ybSBpbnRvIGNpcmNsZXMgYW5kIG5vdCBlbGxpcHNlc1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggTWF0aC5hYnMoIG1vZGVsQm91bmRzLndpZHRoIC8gbW9kZWxCb3VuZHMuaGVpZ2h0IC0gdmlld0JvdW5kcy53aWR0aCAvIHZpZXdCb3VuZHMuaGVpZ2h0ICkgPD0gMUUtMTIgKTtcclxuXHJcbiAgICByZXR1cm4gTW9kZWxWaWV3VHJhbnNmb3JtMi5jcmVhdGVSZWN0YW5nbGVJbnZlcnRlZFlNYXBwaW5nKCBtb2RlbEJvdW5kcywgdmlld0JvdW5kcyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmluZCB0aGUgcmVjdGFuZ2xlIHRoYXQgc2hvdWxkIGJlIHZpZXdlZCBpbiB0aGUgbW9kZWxcclxuICAgKi9cclxuICBwcml2YXRlIGdldFRhcmdldFJlY3RhbmdsZSggdGFyZ2V0U2NhbGU6IG51bWJlciwgdGFyZ2V0Q2VudGVyTW9kZWxQb2ludDogVmVjdG9yMiApOiBSZWN0YW5nbGUge1xyXG4gICAgY29uc3QgeiA9IHRhcmdldFNjYWxlICogMS41RS05O1xyXG4gICAgY29uc3QgbW9kZWxXaWR0aCA9IFBMQVlfQVJFQV9XSURUSCAvIHo7XHJcbiAgICBjb25zdCBtb2RlbEhlaWdodCA9IFBMQVlfQVJFQV9IRUlHSFQgLyB6O1xyXG4gICAgcmV0dXJuIG5ldyBSZWN0YW5nbGUoXHJcbiAgICAgIC1tb2RlbFdpZHRoIC8gMiArIHRhcmdldENlbnRlck1vZGVsUG9pbnQueCxcclxuICAgICAgLW1vZGVsSGVpZ2h0IC8gMiArIHRhcmdldENlbnRlck1vZGVsUG9pbnQueSxcclxuICAgICAgbW9kZWxXaWR0aCxcclxuICAgICAgbW9kZWxIZWlnaHQgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRDbG9jaygpOiBHcmF2aXR5QW5kT3JiaXRzQ2xvY2sge1xyXG4gICAgcmV0dXJuIHRoaXMucGh5c2ljc0VuZ2luZS5jbG9jaztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRCb2RpZXMoKTogQm9keVtdIHtcclxuICAgIHJldHVybiB0aGlzLnBoeXNpY3NFbmdpbmUuZ2V0Qm9kaWVzKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIGRldmlhdGVkIGZyb20gZGVmYXVsdHMgcHJvcGVydHkgLSBzdG9yZWQgb24gdGhlIHNjZW5lIHNvIHRoYXQgd2UgZG9uJ3QgaGF2ZSB0byB1c2UgYSBjbG9zdXJlIGZvciBwZXJmb3JtYW5jZS5cclxuICAgKi9cclxuICBwcml2YXRlIHNldERldmlhdGVkRnJvbURlZmF1bHRzKCk6IHZvaWQge1xyXG4gICAgdGhpcy5kZXZpYXRlZEZyb21EZWZhdWx0c1Byb3BlcnR5LnNldCggdHJ1ZSApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhZGRCb2R5KCBib2R5OiBCb2R5ICk6IHZvaWQge1xyXG4gICAgdGhpcy5waHlzaWNzRW5naW5lLmFkZEJvZHkoIGJvZHkgKTtcclxuXHJcbiAgICBib2R5Lm1hc3NQcm9wZXJ0eS5saW5rKCB0aGlzLnNldERldmlhdGVkRnJvbURlZmF1bHRzLmJpbmQoIHRoaXMgKSApO1xyXG4gICAgYm9keS51c2VyTW9kaWZpZWRQb3NpdGlvbkVtaXR0ZXIuYWRkTGlzdGVuZXIoIHRoaXMuc2V0RGV2aWF0ZWRGcm9tRGVmYXVsdHMuYmluZCggdGhpcyApICk7XHJcbiAgICAvLyBib2R5LnVzZXJNb2RpZmllZFZlbG9jaXR5RW1pdHRlci5hZGRMaXN0ZW5lciggdGhpcy5zZXREZXZpYXRlZEZyb21EZWZhdWx0cy5iaW5kKCB0aGlzICkgKSA7XHJcblxyXG4gICAgLy8gaWYgdGhlIHVzZXIgbW9kaWZpZXMgdmVsb2NpdHksIHNhdmUgc3RhdGUgd2hpbGUgcGF1c2VkXHJcbiAgICBib2R5LnVzZXJNb2RpZmllZFZlbG9jaXR5RW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICB0aGlzLnNldERldmlhdGVkRnJvbURlZmF1bHRzKCk7XHJcbiAgICAgIGlmICggIXRoaXMuaXNQbGF5aW5nUHJvcGVydHkuZ2V0KCkgKSB7XHJcbiAgICAgICAgdGhpcy5zYXZlU3RhdGUoKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5hY3RpdmVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5kZXZpYXRlZEZyb21EZWZhdWx0c1Byb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLm1lYXN1cmluZ1RhcGVTdGFydFBvaW50UHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMubWVhc3VyaW5nVGFwZUVuZFBvaW50UHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuem9vbUxldmVsUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMucGh5c2ljc0VuZ2luZS5jbG9jay5yZXNldFNpbXVsYXRpb25UaW1lKCk7XHJcblxyXG4gICAgdGhpcy5waHlzaWNzRW5naW5lLnJlc2V0QWxsKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm4gdGhlIGJvZGllcyB0byB0aGVpciBvcmlnaW5hbCBzdGF0ZXMgd2hlbiB0aGUgdXNlciBwcmVzc2VzIFwicmVzZXRcIiAobm90IFwicmVzZXQgYWxsXCIpXHJcbiAgICpcclxuICAgKi9cclxuICBwdWJsaWMgcmVzZXRTY2VuZSgpOiB2b2lkIHtcclxuICAgIHRoaXMucGh5c2ljc0VuZ2luZS5yZXNldEJvZGllcygpO1xyXG4gICAgdGhpcy5kZXZpYXRlZEZyb21EZWZhdWx0c1Byb3BlcnR5LnNldCggZmFsc2UgKTtcclxuICAgIHRoaXMuZ2V0Q2xvY2soKS5zZXRTaW11bGF0aW9uVGltZSggMC4wICk7XHJcblxyXG4gICAgVGFuZGVtLlBIRVRfSU9fRU5BQkxFRCAmJiBwaGV0LnBoZXRpby5waGV0aW9FbmdpbmUucGhldGlvU3RhdGVFbmdpbmUucmVzdG9yZVN0YXRlRm9yUGhldGlvT2JqZWN0KCB0aGlzICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0b3JlIHRoZSBsYXN0IHNldCBvZiBpbml0aWFsIGNvbmRpdGlvbnMgdGhhdCB3ZXJlIHNldCB3aGlsZSB0aGUgc2ltIHdhcyBwYXVzZWQuXHJcbiAgICovXHJcbiAgcHVibGljIHJld2luZCgpOiB2b2lkIHtcclxuICAgIHRoaXMucmV3aW5kaW5nUHJvcGVydHkuc2V0KCB0cnVlICk7XHJcbiAgICB0aGlzLmdldENsb2NrKCkudGltZVByb3BlcnR5LnJld2luZCgpO1xyXG4gICAgY29uc3QgYm9kaWVzID0gdGhpcy5waHlzaWNzRW5naW5lLmdldEJvZGllcygpO1xyXG4gICAgYm9kaWVzLmZvckVhY2goIGJvZHkgPT4gYm9keS5yZXdpbmQoKSApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSB0aGUgZm9yY2UgdmVjdG9ycyBhY2NvcmRpbmdseVxyXG4gICAgdGhpcy5waHlzaWNzRW5naW5lLnVwZGF0ZUZvcmNlVmVjdG9ycygpO1xyXG5cclxuICAgIHRoaXMucmV3aW5kaW5nUHJvcGVydHkuc2V0KCBmYWxzZSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2F2ZSB0aGUgc3RhdGUgb2YgdGhlIG9yYml0YWwgc3lzdGVtLCB3aGljaCBpbmNsdWRlcyBhbGwgcmV3aW5kYWJsZSBwcm9wZXJ0aWVzIG9mIGFsbCBib2RpZXMuIFRoaXMgc2hvdWxkIG9ubHkgYmVcclxuICAgKiBjYWxsZWQgd2hlbiB0aGUgc2ltIGlzIHBhdXNlZC5cclxuICAgKi9cclxuICBwdWJsaWMgc2F2ZVN0YXRlKCk6IHZvaWQge1xyXG4gICAgY29uc3QgYm9kaWVzID0gdGhpcy5waHlzaWNzRW5naW5lLmdldEJvZGllcygpO1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBib2RpZXNbIGkgXS5zYXZlQm9keVN0YXRlKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmdldENsb2NrKCkudGltZVByb3BlcnR5LnN0b3JlUmV3aW5kVmFsdWVOb05vdGlmeSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHJldHVybnMgQWxsIGJvZGllcyBpbiB0aGUgc2NlbmUgZm9yIHdoaWNoIHRoZSBtYXNzIGNhbiBiZSBjaGFuZ2VkXHJcbiAgICovXHJcbiAgcHVibGljIGdldE1hc3NTZXR0YWJsZUJvZGllcygpOiBCb2R5W10ge1xyXG4gICAgY29uc3QgYm9kaWVzID0gdGhpcy5nZXRCb2RpZXMoKTtcclxuICAgIGNvbnN0IG1hc3NTZXR0YWJsZUJvZGllcyA9IFtdO1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBpZiAoIGJvZGllc1sgaSBdLm1hc3NTZXR0YWJsZSApIHtcclxuICAgICAgICBtYXNzU2V0dGFibGVCb2RpZXMucHVzaCggYm9kaWVzWyBpIF0gKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG1hc3NTZXR0YWJsZUJvZGllcztcclxuICB9XHJcbn1cclxuXHJcbmdyYXZpdHlBbmRPcmJpdHMucmVnaXN0ZXIoICdHcmF2aXR5QW5kT3JiaXRzU2NlbmUnLCBHcmF2aXR5QW5kT3JiaXRzU2NlbmUgKTtcclxuZXhwb3J0IGRlZmF1bHQgR3Jhdml0eUFuZE9yYml0c1NjZW5l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