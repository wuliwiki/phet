// Copyright 2014-2023, University of Colorado Boulder

/**
 * A chemical reaction is a process that leads to the transformation of one set of
 * chemical substances (reactants) to another (products).
 * The reactants that do not transform to products are referred to herein as leftovers.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import optionize from '../../../../phet-core/js/optionize.js';
import PhetioObject from '../../../../tandem/js/PhetioObject.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import IOType from '../../../../tandem/js/types/IOType.js';
import ReferenceIO from '../../../../tandem/js/types/ReferenceIO.js';
import DevStringUtils from '../../dev/DevStringUtils.js';
import reactantsProductsAndLeftovers from '../../reactantsProductsAndLeftovers.js';
import Substance from './Substance.js';

//TODO https://github.com/phetsims/reactants-products-and-leftovers/issues/78 tandem required

export default class Reaction extends PhetioObject {
  // a leftover for each reactant, in the same order as reactants

  constructor(reactants, products, providedOptions) {
    assert && assert(reactants.length > 1, 'a reaction requires at least 2 reactants');
    assert && assert(products.length > 0, 'a reaction requires at least 1 product');
    const options = optionize()({
      nameProperty: null,
      // PhetioObjectOptions
      tandem: Tandem.OPT_OUT,
      //TODO https://github.com/phetsims/reactants-products-and-leftovers/issues/78 tandem required
      phetioState: false,
      phetioType: Reaction.ReactionIO
    }, providedOptions);
    super(options);
    this.reactants = reactants;
    this.products = products;
    this.nameProperty = options.nameProperty;

    // Create a leftover for each reactant, in the same order.
    this.leftovers = [];
    this.reactants.forEach(reactant => {
      this.leftovers.push(new Substance(1, reactant.symbol, reactant.iconProperty.value, 0));
    });
    const quantityListener = this.updateQuantities.bind(this);
    this.reactants.forEach(reactant => reactant.quantityProperty.link(quantityListener));
  }
  reset() {
    this.reactants.forEach(reactant => reactant.reset());
    this.products.forEach(product => product.reset());
    this.leftovers.forEach(leftover => leftover.reset());
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
  toString() {
    return DevStringUtils.equationString(this);
  }

  /**
   * Formula is a reaction if more than one coefficient is non-zero, or if any coefficient is > 1.
   */
  isReaction() {
    let greaterThanZero = 0;
    let greaterThanOne = 0;
    this.reactants.forEach(reactant => {
      if (reactant.coefficientProperty.value > 0) {
        greaterThanZero++;
      }
      if (reactant.coefficientProperty.value > 1) {
        greaterThanOne++;
      }
    });
    return greaterThanZero > 1 || greaterThanOne > 0;
  }

  /*
   * Updates the quantities of products and leftovers.
   */
  updateQuantities() {
    const numberOfReactions = this.getNumberOfReactions();
    this.products.forEach(product => {
      product.quantityProperty.value = numberOfReactions * product.coefficientProperty.value;
    });
    // reactants and leftovers array have identical orders
    for (let i = 0; i < this.reactants.length; i++) {
      this.leftovers[i].quantityProperty.value = this.reactants[i].quantityProperty.value - numberOfReactions * this.reactants[i].coefficientProperty.value;
    }
  }

  /**
   * Gets the number of reactions we have, based on the coefficients and reactant quantities.
   * For each reactant, we divide its quantity by its coefficient.
   * The smallest such value determines the number of reactions N that will occur.
   */
  getNumberOfReactions() {
    let numberOfReactions = 0;
    if (this.isReaction()) {
      const possibleValues = [];
      this.reactants.forEach(reactant => {
        if (reactant.coefficientProperty.value !== 0) {
          possibleValues.push(Math.floor(reactant.quantityProperty.value / reactant.coefficientProperty.value));
        }
      });
      assert && assert(possibleValues.length > 0);
      possibleValues.sort();
      numberOfReactions = possibleValues[0];
    }
    return numberOfReactions;
  }
  static ReactionIO = new IOType('ReactionIO', {
    valueType: Reaction,
    supertype: ReferenceIO(IOType.ObjectIO)
  });
}
reactantsProductsAndLeftovers.register('Reaction', Reaction);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJvcHRpb25pemUiLCJQaGV0aW9PYmplY3QiLCJUYW5kZW0iLCJJT1R5cGUiLCJSZWZlcmVuY2VJTyIsIkRldlN0cmluZ1V0aWxzIiwicmVhY3RhbnRzUHJvZHVjdHNBbmRMZWZ0b3ZlcnMiLCJTdWJzdGFuY2UiLCJSZWFjdGlvbiIsImNvbnN0cnVjdG9yIiwicmVhY3RhbnRzIiwicHJvZHVjdHMiLCJwcm92aWRlZE9wdGlvbnMiLCJhc3NlcnQiLCJsZW5ndGgiLCJvcHRpb25zIiwibmFtZVByb3BlcnR5IiwidGFuZGVtIiwiT1BUX09VVCIsInBoZXRpb1N0YXRlIiwicGhldGlvVHlwZSIsIlJlYWN0aW9uSU8iLCJsZWZ0b3ZlcnMiLCJmb3JFYWNoIiwicmVhY3RhbnQiLCJwdXNoIiwic3ltYm9sIiwiaWNvblByb3BlcnR5IiwidmFsdWUiLCJxdWFudGl0eUxpc3RlbmVyIiwidXBkYXRlUXVhbnRpdGllcyIsImJpbmQiLCJxdWFudGl0eVByb3BlcnR5IiwibGluayIsInJlc2V0IiwicHJvZHVjdCIsImxlZnRvdmVyIiwiZGlzcG9zZSIsInRvU3RyaW5nIiwiZXF1YXRpb25TdHJpbmciLCJpc1JlYWN0aW9uIiwiZ3JlYXRlclRoYW5aZXJvIiwiZ3JlYXRlclRoYW5PbmUiLCJjb2VmZmljaWVudFByb3BlcnR5IiwibnVtYmVyT2ZSZWFjdGlvbnMiLCJnZXROdW1iZXJPZlJlYWN0aW9ucyIsImkiLCJwb3NzaWJsZVZhbHVlcyIsIk1hdGgiLCJmbG9vciIsInNvcnQiLCJ2YWx1ZVR5cGUiLCJzdXBlcnR5cGUiLCJPYmplY3RJTyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUmVhY3Rpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQSBjaGVtaWNhbCByZWFjdGlvbiBpcyBhIHByb2Nlc3MgdGhhdCBsZWFkcyB0byB0aGUgdHJhbnNmb3JtYXRpb24gb2Ygb25lIHNldCBvZlxyXG4gKiBjaGVtaWNhbCBzdWJzdGFuY2VzIChyZWFjdGFudHMpIHRvIGFub3RoZXIgKHByb2R1Y3RzKS5cclxuICogVGhlIHJlYWN0YW50cyB0aGF0IGRvIG5vdCB0cmFuc2Zvcm0gdG8gcHJvZHVjdHMgYXJlIHJlZmVycmVkIHRvIGhlcmVpbiBhcyBsZWZ0b3ZlcnMuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja09wdGlvbmFsIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrT3B0aW9uYWwuanMnO1xyXG5pbXBvcnQgUGhldGlvT2JqZWN0LCB7IFBoZXRpb09iamVjdE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvUGhldGlvT2JqZWN0LmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IElPVHlwZSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvSU9UeXBlLmpzJztcclxuaW1wb3J0IFJlZmVyZW5jZUlPIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9SZWZlcmVuY2VJTy5qcyc7XHJcbmltcG9ydCBEZXZTdHJpbmdVdGlscyBmcm9tICcuLi8uLi9kZXYvRGV2U3RyaW5nVXRpbHMuanMnO1xyXG5pbXBvcnQgcmVhY3RhbnRzUHJvZHVjdHNBbmRMZWZ0b3ZlcnMgZnJvbSAnLi4vLi4vcmVhY3RhbnRzUHJvZHVjdHNBbmRMZWZ0b3ZlcnMuanMnO1xyXG5pbXBvcnQgU3Vic3RhbmNlIGZyb20gJy4vU3Vic3RhbmNlLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgbmFtZVByb3BlcnR5PzogVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPiB8IG51bGw7IC8vIG9wdGlvbmFsIG5hbWUgZm9yIHRoZSBSZWFjdGlvbiwgZGlzcGxheWVkIHRvIHRoZSB1c2VyXHJcbn07XHJcblxyXG4vL1RPRE8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3JlYWN0YW50cy1wcm9kdWN0cy1hbmQtbGVmdG92ZXJzL2lzc3Vlcy83OCB0YW5kZW0gcmVxdWlyZWRcclxuZXhwb3J0IHR5cGUgUmVhY3Rpb25PcHRpb25zID0gU2VsZk9wdGlvbnMgJiBQaWNrT3B0aW9uYWw8UGhldGlvT2JqZWN0T3B0aW9ucywgJ3RhbmRlbSc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVhY3Rpb24gZXh0ZW5kcyBQaGV0aW9PYmplY3Qge1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgbmFtZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+IHwgbnVsbDtcclxuICBwdWJsaWMgcmVhZG9ubHkgcmVhY3RhbnRzOiBTdWJzdGFuY2VbXTtcclxuICBwdWJsaWMgcmVhZG9ubHkgcHJvZHVjdHM6IFN1YnN0YW5jZVtdO1xyXG4gIHB1YmxpYyByZWFkb25seSBsZWZ0b3ZlcnM6IFN1YnN0YW5jZVtdOyAvLyBhIGxlZnRvdmVyIGZvciBlYWNoIHJlYWN0YW50LCBpbiB0aGUgc2FtZSBvcmRlciBhcyByZWFjdGFudHNcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCByZWFjdGFudHM6IFN1YnN0YW5jZVtdLCBwcm9kdWN0czogU3Vic3RhbmNlW10sIHByb3ZpZGVkT3B0aW9ucz86IFJlYWN0aW9uT3B0aW9ucyApIHtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCByZWFjdGFudHMubGVuZ3RoID4gMSwgJ2EgcmVhY3Rpb24gcmVxdWlyZXMgYXQgbGVhc3QgMiByZWFjdGFudHMnICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBwcm9kdWN0cy5sZW5ndGggPiAwLCAnYSByZWFjdGlvbiByZXF1aXJlcyBhdCBsZWFzdCAxIHByb2R1Y3QnICk7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxSZWFjdGlvbk9wdGlvbnMsIFNlbGZPcHRpb25zLCBQaGV0aW9PYmplY3RPcHRpb25zPigpKCB7XHJcbiAgICAgIG5hbWVQcm9wZXJ0eTogbnVsbCxcclxuXHJcbiAgICAgIC8vIFBoZXRpb09iamVjdE9wdGlvbnNcclxuICAgICAgdGFuZGVtOiBUYW5kZW0uT1BUX09VVCwgLy9UT0RPIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9yZWFjdGFudHMtcHJvZHVjdHMtYW5kLWxlZnRvdmVycy9pc3N1ZXMvNzggdGFuZGVtIHJlcXVpcmVkXHJcbiAgICAgIHBoZXRpb1N0YXRlOiBmYWxzZSxcclxuICAgICAgcGhldGlvVHlwZTogUmVhY3Rpb24uUmVhY3Rpb25JT1xyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLnJlYWN0YW50cyA9IHJlYWN0YW50cztcclxuICAgIHRoaXMucHJvZHVjdHMgPSBwcm9kdWN0cztcclxuICAgIHRoaXMubmFtZVByb3BlcnR5ID0gb3B0aW9ucy5uYW1lUHJvcGVydHk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgbGVmdG92ZXIgZm9yIGVhY2ggcmVhY3RhbnQsIGluIHRoZSBzYW1lIG9yZGVyLlxyXG4gICAgdGhpcy5sZWZ0b3ZlcnMgPSBbXTtcclxuICAgIHRoaXMucmVhY3RhbnRzLmZvckVhY2goIHJlYWN0YW50ID0+IHtcclxuICAgICAgdGhpcy5sZWZ0b3ZlcnMucHVzaCggbmV3IFN1YnN0YW5jZSggMSwgcmVhY3RhbnQuc3ltYm9sLCByZWFjdGFudC5pY29uUHJvcGVydHkudmFsdWUsIDAgKSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHF1YW50aXR5TGlzdGVuZXIgPSB0aGlzLnVwZGF0ZVF1YW50aXRpZXMuYmluZCggdGhpcyApO1xyXG4gICAgdGhpcy5yZWFjdGFudHMuZm9yRWFjaCggcmVhY3RhbnQgPT4gcmVhY3RhbnQucXVhbnRpdHlQcm9wZXJ0eS5saW5rKCBxdWFudGl0eUxpc3RlbmVyICkgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMucmVhY3RhbnRzLmZvckVhY2goIHJlYWN0YW50ID0+IHJlYWN0YW50LnJlc2V0KCkgKTtcclxuICAgIHRoaXMucHJvZHVjdHMuZm9yRWFjaCggcHJvZHVjdCA9PiBwcm9kdWN0LnJlc2V0KCkgKTtcclxuICAgIHRoaXMubGVmdG92ZXJzLmZvckVhY2goIGxlZnRvdmVyID0+IGxlZnRvdmVyLnJlc2V0KCkgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgdG9TdHJpbmcoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiBEZXZTdHJpbmdVdGlscy5lcXVhdGlvblN0cmluZyggdGhpcyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRm9ybXVsYSBpcyBhIHJlYWN0aW9uIGlmIG1vcmUgdGhhbiBvbmUgY29lZmZpY2llbnQgaXMgbm9uLXplcm8sIG9yIGlmIGFueSBjb2VmZmljaWVudCBpcyA+IDEuXHJcbiAgICovXHJcbiAgcHVibGljIGlzUmVhY3Rpb24oKTogYm9vbGVhbiB7XHJcbiAgICBsZXQgZ3JlYXRlclRoYW5aZXJvID0gMDtcclxuICAgIGxldCBncmVhdGVyVGhhbk9uZSA9IDA7XHJcbiAgICB0aGlzLnJlYWN0YW50cy5mb3JFYWNoKCByZWFjdGFudCA9PiB7XHJcbiAgICAgIGlmICggcmVhY3RhbnQuY29lZmZpY2llbnRQcm9wZXJ0eS52YWx1ZSA+IDAgKSB7IGdyZWF0ZXJUaGFuWmVybysrOyB9XHJcbiAgICAgIGlmICggcmVhY3RhbnQuY29lZmZpY2llbnRQcm9wZXJ0eS52YWx1ZSA+IDEgKSB7IGdyZWF0ZXJUaGFuT25lKys7IH1cclxuICAgIH0gKTtcclxuICAgIHJldHVybiAoIGdyZWF0ZXJUaGFuWmVybyA+IDEgfHwgZ3JlYXRlclRoYW5PbmUgPiAwICk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIFVwZGF0ZXMgdGhlIHF1YW50aXRpZXMgb2YgcHJvZHVjdHMgYW5kIGxlZnRvdmVycy5cclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZVF1YW50aXRpZXMoKTogdm9pZCB7XHJcbiAgICBjb25zdCBudW1iZXJPZlJlYWN0aW9ucyA9IHRoaXMuZ2V0TnVtYmVyT2ZSZWFjdGlvbnMoKTtcclxuICAgIHRoaXMucHJvZHVjdHMuZm9yRWFjaCggcHJvZHVjdCA9PiB7XHJcbiAgICAgIHByb2R1Y3QucXVhbnRpdHlQcm9wZXJ0eS52YWx1ZSA9IG51bWJlck9mUmVhY3Rpb25zICogcHJvZHVjdC5jb2VmZmljaWVudFByb3BlcnR5LnZhbHVlO1xyXG4gICAgfSApO1xyXG4gICAgLy8gcmVhY3RhbnRzIGFuZCBsZWZ0b3ZlcnMgYXJyYXkgaGF2ZSBpZGVudGljYWwgb3JkZXJzXHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLnJlYWN0YW50cy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgdGhpcy5sZWZ0b3ZlcnNbIGkgXS5xdWFudGl0eVByb3BlcnR5LnZhbHVlID1cclxuICAgICAgICB0aGlzLnJlYWN0YW50c1sgaSBdLnF1YW50aXR5UHJvcGVydHkudmFsdWUgLSAoIG51bWJlck9mUmVhY3Rpb25zICogdGhpcy5yZWFjdGFudHNbIGkgXS5jb2VmZmljaWVudFByb3BlcnR5LnZhbHVlICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBudW1iZXIgb2YgcmVhY3Rpb25zIHdlIGhhdmUsIGJhc2VkIG9uIHRoZSBjb2VmZmljaWVudHMgYW5kIHJlYWN0YW50IHF1YW50aXRpZXMuXHJcbiAgICogRm9yIGVhY2ggcmVhY3RhbnQsIHdlIGRpdmlkZSBpdHMgcXVhbnRpdHkgYnkgaXRzIGNvZWZmaWNpZW50LlxyXG4gICAqIFRoZSBzbWFsbGVzdCBzdWNoIHZhbHVlIGRldGVybWluZXMgdGhlIG51bWJlciBvZiByZWFjdGlvbnMgTiB0aGF0IHdpbGwgb2NjdXIuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXROdW1iZXJPZlJlYWN0aW9ucygpOiBudW1iZXIge1xyXG4gICAgbGV0IG51bWJlck9mUmVhY3Rpb25zID0gMDtcclxuICAgIGlmICggdGhpcy5pc1JlYWN0aW9uKCkgKSB7XHJcbiAgICAgIGNvbnN0IHBvc3NpYmxlVmFsdWVzOiBudW1iZXJbXSA9IFtdO1xyXG4gICAgICB0aGlzLnJlYWN0YW50cy5mb3JFYWNoKCByZWFjdGFudCA9PiB7XHJcbiAgICAgICAgaWYgKCByZWFjdGFudC5jb2VmZmljaWVudFByb3BlcnR5LnZhbHVlICE9PSAwICkge1xyXG4gICAgICAgICAgcG9zc2libGVWYWx1ZXMucHVzaCggTWF0aC5mbG9vciggcmVhY3RhbnQucXVhbnRpdHlQcm9wZXJ0eS52YWx1ZSAvIHJlYWN0YW50LmNvZWZmaWNpZW50UHJvcGVydHkudmFsdWUgKSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBwb3NzaWJsZVZhbHVlcy5sZW5ndGggPiAwICk7XHJcbiAgICAgIHBvc3NpYmxlVmFsdWVzLnNvcnQoKTtcclxuICAgICAgbnVtYmVyT2ZSZWFjdGlvbnMgPSBwb3NzaWJsZVZhbHVlc1sgMCBdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bWJlck9mUmVhY3Rpb25zO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBSZWFjdGlvbklPID0gbmV3IElPVHlwZSggJ1JlYWN0aW9uSU8nLCB7XHJcbiAgICB2YWx1ZVR5cGU6IFJlYWN0aW9uLFxyXG4gICAgc3VwZXJ0eXBlOiBSZWZlcmVuY2VJTyggSU9UeXBlLk9iamVjdElPIClcclxuICB9ICk7XHJcbn1cclxuXHJcbnJlYWN0YW50c1Byb2R1Y3RzQW5kTGVmdG92ZXJzLnJlZ2lzdGVyKCAnUmVhY3Rpb24nLCBSZWFjdGlvbiApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0EsT0FBT0EsU0FBUyxNQUFNLHVDQUF1QztBQUU3RCxPQUFPQyxZQUFZLE1BQStCLHVDQUF1QztBQUN6RixPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBQ3BELE9BQU9DLE1BQU0sTUFBTSx1Q0FBdUM7QUFDMUQsT0FBT0MsV0FBVyxNQUFNLDRDQUE0QztBQUNwRSxPQUFPQyxjQUFjLE1BQU0sNkJBQTZCO0FBQ3hELE9BQU9DLDZCQUE2QixNQUFNLHdDQUF3QztBQUNsRixPQUFPQyxTQUFTLE1BQU0sZ0JBQWdCOztBQU10Qzs7QUFHQSxlQUFlLE1BQU1DLFFBQVEsU0FBU1AsWUFBWSxDQUFDO0VBS1Q7O0VBRWpDUSxXQUFXQSxDQUFFQyxTQUFzQixFQUFFQyxRQUFxQixFQUFFQyxlQUFpQyxFQUFHO0lBRXJHQyxNQUFNLElBQUlBLE1BQU0sQ0FBRUgsU0FBUyxDQUFDSSxNQUFNLEdBQUcsQ0FBQyxFQUFFLDBDQUEyQyxDQUFDO0lBQ3BGRCxNQUFNLElBQUlBLE1BQU0sQ0FBRUYsUUFBUSxDQUFDRyxNQUFNLEdBQUcsQ0FBQyxFQUFFLHdDQUF5QyxDQUFDO0lBRWpGLE1BQU1DLE9BQU8sR0FBR2YsU0FBUyxDQUFvRCxDQUFDLENBQUU7TUFDOUVnQixZQUFZLEVBQUUsSUFBSTtNQUVsQjtNQUNBQyxNQUFNLEVBQUVmLE1BQU0sQ0FBQ2dCLE9BQU87TUFBRTtNQUN4QkMsV0FB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