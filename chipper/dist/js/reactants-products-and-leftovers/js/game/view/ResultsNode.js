// Copyright 2014-2023, University of Colorado Boulder

/**
 * SettingsNode is responsible for the view that corresponds to GamePhase.RESULTS.
 * It displays the game results (score, optional time,...) and a reward (if the user got a perfect score).
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import LevelCompletedNode from '../../../../vegas/js/LevelCompletedNode.js';
import reactantsProductsAndLeftovers from '../../reactantsProductsAndLeftovers.js';
import GamePhase from '../model/GamePhase.js';
import RPALRewardNode from './RPALRewardNode.js';
import RPALQueryParameters from '../../common/RPALQueryParameters.js';
import GamePhaseNode from './GamePhaseNode.js';
export default class ResultsNode extends GamePhaseNode {
  // created dynamically to match the level

  constructor(model, layoutBounds, audioPlayer, tandem) {
    super(GamePhase.RESULTS, model.gamePhaseProperty, {
      tandem: tandem
    });
    this.rewardNode = null;

    // Created dynamically to match the level
    let levelCompletedNode = null;

    /*
     * Displays the game results, possibly with a 'reward'.
     * Unlink is unnecessary because this node exists for the lifetime of the simulation.
     */
    model.gamePhaseProperty.link(gamePhase => {
      // show results when we enter this phase
      if (gamePhase === GamePhase.RESULTS) {
        // Show the reward if the score is perfect, and play the appropriate audio feedback.
        if (model.isPerfectScore() || RPALQueryParameters.showReward) {
          this.rewardNode = new RPALRewardNode(model.levelProperty.value);
          this.addChild(this.rewardNode);
          audioPlayer.gameOverPerfectScore();
        } else {
          audioPlayer.gameOverImperfectScore();
        }

        // Pseudo-dialog that shows results.
        const level = model.levelProperty.value;
        levelCompletedNode = new LevelCompletedNode(level + 1, model.scoreProperty.value, model.getPerfectScore(level), model.numberOfChallengesProperty.value,
        // number of stars in the progress indicator
        model.timerEnabledProperty.value, model.timer.elapsedTimeProperty.value, model.bestTimeProperties[level].value, model.isNewBestTime, () => model.settings(), {
          starDiameter: 45,
          centerX: layoutBounds.centerX,
          centerY: layoutBounds.centerY
        });
        this.addChild(levelCompletedNode);
      } else {
        if (this.rewardNode) {
          this.rewardNode.dispose();
          this.rewardNode = null;
        }
        if (levelCompletedNode) {
          levelCompletedNode.dispose();
          levelCompletedNode = null;
        }
      }
    });
  }

  /**
   * Animates the game reward.
   * @param dt - time between step calls, in seconds
   */
  step(dt) {
    if (this.rewardNode) {
      this.rewardNode.step(dt);
    }
  }
}
reactantsProductsAndLeftovers.register('ResultsNode', ResultsNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJMZXZlbENvbXBsZXRlZE5vZGUiLCJyZWFjdGFudHNQcm9kdWN0c0FuZExlZnRvdmVycyIsIkdhbWVQaGFzZSIsIlJQQUxSZXdhcmROb2RlIiwiUlBBTFF1ZXJ5UGFyYW1ldGVycyIsIkdhbWVQaGFzZU5vZGUiLCJSZXN1bHRzTm9kZSIsImNvbnN0cnVjdG9yIiwibW9kZWwiLCJsYXlvdXRCb3VuZHMiLCJhdWRpb1BsYXllciIsInRhbmRlbSIsIlJFU1VMVFMiLCJnYW1lUGhhc2VQcm9wZXJ0eSIsInJld2FyZE5vZGUiLCJsZXZlbENvbXBsZXRlZE5vZGUiLCJsaW5rIiwiZ2FtZVBoYXNlIiwiaXNQZXJmZWN0U2NvcmUiLCJzaG93UmV3YXJkIiwibGV2ZWxQcm9wZXJ0eSIsInZhbHVlIiwiYWRkQ2hpbGQiLCJnYW1lT3ZlclBlcmZlY3RTY29yZSIsImdhbWVPdmVySW1wZXJmZWN0U2NvcmUiLCJsZXZlbCIsInNjb3JlUHJvcGVydHkiLCJnZXRQZXJmZWN0U2NvcmUiLCJudW1iZXJPZkNoYWxsZW5nZXNQcm9wZXJ0eSIsInRpbWVyRW5hYmxlZFByb3BlcnR5IiwidGltZXIiLCJlbGFwc2VkVGltZVByb3BlcnR5IiwiYmVzdFRpbWVQcm9wZXJ0aWVzIiwiaXNOZXdCZXN0VGltZSIsInNldHRpbmdzIiwic3RhckRpYW1ldGVyIiwiY2VudGVyWCIsImNlbnRlclkiLCJkaXNwb3NlIiwic3RlcCIsImR0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJSZXN1bHRzTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTZXR0aW5nc05vZGUgaXMgcmVzcG9uc2libGUgZm9yIHRoZSB2aWV3IHRoYXQgY29ycmVzcG9uZHMgdG8gR2FtZVBoYXNlLlJFU1VMVFMuXHJcbiAqIEl0IGRpc3BsYXlzIHRoZSBnYW1lIHJlc3VsdHMgKHNjb3JlLCBvcHRpb25hbCB0aW1lLC4uLikgYW5kIGEgcmV3YXJkIChpZiB0aGUgdXNlciBnb3QgYSBwZXJmZWN0IHNjb3JlKS5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCBHYW1lQXVkaW9QbGF5ZXIgZnJvbSAnLi4vLi4vLi4vLi4vdmVnYXMvanMvR2FtZUF1ZGlvUGxheWVyLmpzJztcclxuaW1wb3J0IExldmVsQ29tcGxldGVkTm9kZSBmcm9tICcuLi8uLi8uLi8uLi92ZWdhcy9qcy9MZXZlbENvbXBsZXRlZE5vZGUuanMnO1xyXG5pbXBvcnQgcmVhY3RhbnRzUHJvZHVjdHNBbmRMZWZ0b3ZlcnMgZnJvbSAnLi4vLi4vcmVhY3RhbnRzUHJvZHVjdHNBbmRMZWZ0b3ZlcnMuanMnO1xyXG5pbXBvcnQgR2FtZU1vZGVsIGZyb20gJy4uL21vZGVsL0dhbWVNb2RlbC5qcyc7XHJcbmltcG9ydCBHYW1lUGhhc2UgZnJvbSAnLi4vbW9kZWwvR2FtZVBoYXNlLmpzJztcclxuaW1wb3J0IFJQQUxSZXdhcmROb2RlIGZyb20gJy4vUlBBTFJld2FyZE5vZGUuanMnO1xyXG5pbXBvcnQgUlBBTFF1ZXJ5UGFyYW1ldGVycyBmcm9tICcuLi8uLi9jb21tb24vUlBBTFF1ZXJ5UGFyYW1ldGVycy5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBHYW1lUGhhc2VOb2RlIGZyb20gJy4vR2FtZVBoYXNlTm9kZS5qcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSZXN1bHRzTm9kZSBleHRlbmRzIEdhbWVQaGFzZU5vZGUge1xyXG5cclxuICBwcml2YXRlIHJld2FyZE5vZGU6IFJQQUxSZXdhcmROb2RlIHwgbnVsbDsgLy8gY3JlYXRlZCBkeW5hbWljYWxseSB0byBtYXRjaCB0aGUgbGV2ZWxcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBtb2RlbDogR2FtZU1vZGVsLCBsYXlvdXRCb3VuZHM6IEJvdW5kczIsIGF1ZGlvUGxheWVyOiBHYW1lQXVkaW9QbGF5ZXIsIHRhbmRlbTogVGFuZGVtICkge1xyXG5cclxuICAgIHN1cGVyKCBHYW1lUGhhc2UuUkVTVUxUUywgbW9kZWwuZ2FtZVBoYXNlUHJvcGVydHksIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW1cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnJld2FyZE5vZGUgPSBudWxsO1xyXG5cclxuICAgIC8vIENyZWF0ZWQgZHluYW1pY2FsbHkgdG8gbWF0Y2ggdGhlIGxldmVsXHJcbiAgICBsZXQgbGV2ZWxDb21wbGV0ZWROb2RlOiBMZXZlbENvbXBsZXRlZE5vZGUgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgICAvKlxyXG4gICAgICogRGlzcGxheXMgdGhlIGdhbWUgcmVzdWx0cywgcG9zc2libHkgd2l0aCBhICdyZXdhcmQnLlxyXG4gICAgICogVW5saW5rIGlzIHVubmVjZXNzYXJ5IGJlY2F1c2UgdGhpcyBub2RlIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW11bGF0aW9uLlxyXG4gICAgICovXHJcbiAgICBtb2RlbC5nYW1lUGhhc2VQcm9wZXJ0eS5saW5rKCBnYW1lUGhhc2UgPT4ge1xyXG5cclxuICAgICAgLy8gc2hvdyByZXN1bHRzIHdoZW4gd2UgZW50ZXIgdGhpcyBwaGFzZVxyXG4gICAgICBpZiAoIGdhbWVQaGFzZSA9PT0gR2FtZVBoYXNlLlJFU1VMVFMgKSB7XHJcblxyXG4gICAgICAgIC8vIFNob3cgdGhlIHJld2FyZCBpZiB0aGUgc2NvcmUgaXMgcGVyZmVjdCwgYW5kIHBsYXkgdGhlIGFwcHJvcHJpYXRlIGF1ZGlvIGZlZWRiYWNrLlxyXG4gICAgICAgIGlmICggbW9kZWwuaXNQZXJmZWN0U2NvcmUoKSB8fCBSUEFMUXVlcnlQYXJhbWV0ZXJzLnNob3dSZXdhcmQgKSB7XHJcbiAgICAgICAgICB0aGlzLnJld2FyZE5vZGUgPSBuZXcgUlBBTFJld2FyZE5vZGUoIG1vZGVsLmxldmVsUHJvcGVydHkudmFsdWUgKTtcclxuICAgICAgICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMucmV3YXJkTm9kZSApO1xyXG4gICAgICAgICAgYXVkaW9QbGF5ZXIuZ2FtZU92ZXJQZXJmZWN0U2NvcmUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBhdWRpb1BsYXllci5nYW1lT3ZlckltcGVyZmVjdFNjb3JlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBQc2V1ZG8tZGlhbG9nIHRoYXQgc2hvd3MgcmVzdWx0cy5cclxuICAgICAgICBjb25zdCBsZXZlbCA9IG1vZGVsLmxldmVsUHJvcGVydHkudmFsdWU7XHJcbiAgICAgICAgbGV2ZWxDb21wbGV0ZWROb2RlID0gbmV3IExldmVsQ29tcGxldGVkTm9kZShcclxuICAgICAgICAgIGxldmVsICsgMSxcclxuICAgICAgICAgIG1vZGVsLnNjb3JlUHJvcGVydHkudmFsdWUsXHJcbiAgICAgICAgICBtb2RlbC5nZXRQZXJmZWN0U2NvcmUoIGxldmVsICksXHJcbiAgICAgICAgICBtb2RlbC5udW1iZXJPZkNoYWxsZW5nZXNQcm9wZXJ0eS52YWx1ZSwgLy8gbnVtYmVyIG9mIHN0YXJzIGluIHRoZSBwcm9ncmVzcyBpbmRpY2F0b3JcclxuICAgICAgICAgIG1vZGVsLnRpbWVyRW5hYmxlZFByb3BlcnR5LnZhbHVlLFxyXG4gICAgICAgICAgbW9kZWwudGltZXIuZWxhcHNlZFRpbWVQcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgICAgIG1vZGVsLmJlc3RUaW1lUHJvcGVydGllc1sgbGV2ZWwgXS52YWx1ZSxcclxuICAgICAgICAgIG1vZGVsLmlzTmV3QmVzdFRpbWUsXHJcbiAgICAgICAgICAoKSA9PiBtb2RlbC5zZXR0aW5ncygpLFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBzdGFyRGlhbWV0ZXI6IDQ1LFxyXG4gICAgICAgICAgICBjZW50ZXJYOiBsYXlvdXRCb3VuZHMuY2VudGVyWCxcclxuICAgICAgICAgICAgY2VudGVyWTogbGF5b3V0Qm91bmRzLmNlbnRlcllcclxuICAgICAgICAgIH0gKTtcclxuICAgICAgICB0aGlzLmFkZENoaWxkKCBsZXZlbENvbXBsZXRlZE5vZGUgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBpZiAoIHRoaXMucmV3YXJkTm9kZSApIHtcclxuICAgICAgICAgIHRoaXMucmV3YXJkTm9kZS5kaXNwb3NlKCk7XHJcbiAgICAgICAgICB0aGlzLnJld2FyZE5vZGUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIGxldmVsQ29tcGxldGVkTm9kZSApIHtcclxuICAgICAgICAgIGxldmVsQ29tcGxldGVkTm9kZS5kaXNwb3NlKCk7XHJcbiAgICAgICAgICBsZXZlbENvbXBsZXRlZE5vZGUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQW5pbWF0ZXMgdGhlIGdhbWUgcmV3YXJkLlxyXG4gICAqIEBwYXJhbSBkdCAtIHRpbWUgYmV0d2VlbiBzdGVwIGNhbGxzLCBpbiBzZWNvbmRzXHJcbiAgICovXHJcbiAgcHVibGljIHN0ZXAoIGR0OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICBpZiAoIHRoaXMucmV3YXJkTm9kZSApIHtcclxuICAgICAgdGhpcy5yZXdhcmROb2RlLnN0ZXAoIGR0ICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5yZWFjdGFudHNQcm9kdWN0c0FuZExlZnRvdmVycy5yZWdpc3RlciggJ1Jlc3VsdHNOb2RlJywgUmVzdWx0c05vZGUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFJQSxPQUFPQSxrQkFBa0IsTUFBTSw0Q0FBNEM7QUFDM0UsT0FBT0MsNkJB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