// Copyright 2014-2023, University of Colorado Boulder

/**
 * Scenery Node for the draggable electric field sensor node.
 *
 * @author Martin Veillette (Berea College)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import merge from '../../../../phet-core/js/merge.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import { DragListener, Node, Text } from '../../../../scenery/js/imports.js';
import chargesAndFields from '../../chargesAndFields.js';
import ChargesAndFieldsStrings from '../../ChargesAndFieldsStrings.js';
import ChargesAndFieldsColors from '../ChargesAndFieldsColors.js';
import ChargesAndFieldsConstants from '../ChargesAndFieldsConstants.js';
import ElectricFieldSensorRepresentationNode from './ElectricFieldSensorRepresentationNode.js';
const angleUnitString = ChargesAndFieldsStrings.angleUnit;
const eFieldUnitString = ChargesAndFieldsStrings.eFieldUnit;
const pattern0Value1UnitsString = ChargesAndFieldsStrings.pattern['0value']['1units'];

// constants
const LABEL_FONT = ChargesAndFieldsConstants.ELECTRIC_FIELD_SENSOR_LABEL_FONT;

// Max value chosen such that this limit is reached once the sensor is fully enclosed in a charge
const MIN_ARROW_LENGTH = 1e-9;
class ElectricFieldSensorNode extends ElectricFieldSensorRepresentationNode {
  /**
   * Constructor for the ElectricFieldSensorNode which renders the sensor as a scenery node.
   * @param {ElectricFieldSensor} electricFieldSensor
   * @param {function} snapToGridLines - function( {Property.<Vector2>})
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Property.<Bounds2>} availableModelBoundsProperty - dragBounds for the electric field sensor node
   * @param {Property.<boolean>} isPlayAreaChargedProperty - is there at least one charged particle on the board
   * @param {Property.<boolean>} areValuesVisibleProperty
   * @param {Bounds2} enclosureBounds
   * @param {Tandem} tandem
   */
  constructor(electricFieldSensor, snapToGridLines, modelViewTransform, availableModelBoundsProperty, isPlayAreaChargedProperty, areValuesVisibleProperty, enclosureBounds, tandem) {
    super({
      tandem: tandem,
      phetioDynamicElement: true,
      phetioType: Node.NodeIO
    });
    this.modelElement = electricFieldSensor; // @public (read-only)

    // Expand the touch area
    this.touchArea = this.localBounds.dilated(10);

    // Create the E-field arrow, (set the arrow horizontally to start with)
    // TODO: why is the fill and stroke set to the same value?
    const arrowNode = new ArrowNode(0, 0, 1, 0, {
      pickable: false,
      stroke: ChargesAndFieldsColors.electricFieldSensorArrowProperty,
      fill: ChargesAndFieldsColors.electricFieldSensorArrowProperty,
      tandem: tandem.createTandem('arrowNode')
    });

    // Create two numerical readouts for the strength and direction of the electric field.
    const fieldStrengthLabelText = new Text('', {
      font: LABEL_FONT,
      pickable: false,
      fill: ChargesAndFieldsColors.electricFieldSensorLabelProperty,
      tandem: tandem.createTandem('fieldStrengthLabelText')
    });
    const directionLabelText = new Text('', {
      font: LABEL_FONT,
      pickable: false,
      fill: ChargesAndFieldsColors.electricFieldSensorLabelProperty,
      tandem: tandem.createTandem('directionLabelText')
    });
    this.addChild(arrowNode);
    this.addChild(fieldStrengthLabelText);
    this.addChild(directionLabelText);
    arrowNode.moveToBack(); // the arrow should always be on the back of 'this'

    // layout
    arrowNode.left = 0;
    arrowNode.centerY = 0;
    fieldStrengthLabelText.bottom = this.top; // 'this' is the ElectricFieldSensorRepresentationNode, i.e. the circle
    directionLabelText.bottom = fieldStrengthLabelText.top;

    // when the electric field changes update the arrow and the labels
    const electricFieldListener = electricField => {
      const magnitude = electricField.magnitude;
      const angle = electricField.angle; // angle from the model, in radians

      // note that the angleInView = -1 * angleInModel
      // since the vertical direction is reversed between the view and the model
      // so the text must be updated with angle whereas arrow node must be updated with -angle

      // Update the sensor arrow and the electric field labels.
      // Make sure the E-field magnitude is not too large to avoid
      // text overruns and other problems with very large potentials/fields (this
      // typically occurs when the sensor is placed too close to a charge center).
      if (magnitude < ChargesAndFieldsConstants.MAX_EFIELD_MAGNITUDE) {
        // Check that the arrow length is above MIN_ARROW_LENGTH to avoid problems
        // with scenery code attempting to normalize a zero-length vector.
        const arrowLength = 15 * magnitude; // arbitrary multiplicative factor for the view
        if (arrowLength > MIN_ARROW_LENGTH) {
          arrowNode.setTailAndTip(0, 0, arrowLength * Math.cos(-angle), arrowLength * Math.sin(-angle));
          arrowNode.visible = electricFieldSensor.isActiveProperty.get();
        }
        if (areValuesVisibleProperty.get()) {
          fieldStrengthLabelText.visible = electricFieldSensor.isActiveProperty.get();
          directionLabelText.visible = electricFieldSensor.isActiveProperty.get();
        }

        // Update the strings in the labels
        const fieldMagnitudeString = decimalAdjust(magnitude, {
          maxDecimalPlaces: 2
        });
        fieldStrengthLabelText.string = StringUtils.format(pattern0Value1UnitsString, fieldMagnitudeString, eFieldUnitString);
        const angleString = Utils.toFixed(Utils.toDegrees(angle), 1);
        directionLabelText.string = isPlayAreaChargedProperty.get() ? StringUtils.format(pattern0Value1UnitsString, angleString, angleUnitString) : '';
      } else {
        arrowNode.visible = false;
        fieldStrengthLabelText.string = '-';
        directionLabelText.string = '-';
      }
      fieldStrengthLabelText.centerX = 0;
      directionLabelText.centerX = 0;
    };
    electricFieldSensor.electricFieldProperty.link(electricFieldListener);
    const isActiveListener = isActive => {
      arrowNode.visible = isActive;
      if (areValuesVisibleProperty.get()) {
        fieldStrengthLabelText.visible = isActive;
        directionLabelText.visible = isActive;
      }
    };
    electricFieldSensor.isActiveProperty.link(isActiveListener);

    // Show/hide labels
    const areValuesVisibleListener = isVisible => {
      fieldStrengthLabelText.visible = isVisible;
      directionLabelText.visible = isVisible;
    };
    areValuesVisibleProperty.link(areValuesVisibleListener);

    // Show/hide field arrow
    const isPlayAreaChargedListener = isPlayAreaCharged => arrowNode.setVisible(isPlayAreaCharged);
    isPlayAreaChargedProperty.link(isPlayAreaChargedListener);

    // The direction label is visible if:
    // (1) 'values' is checked
    // (2) the net play area charge is marked as nonzero
    const isDirectionLabelVisibleDerivedProperty = new DerivedProperty([areValuesVisibleProperty, isPlayAreaChargedProperty], (areValuesVisible, isPlayAreaCharged) => areValuesVisible && isPlayAreaCharged);

    // Show/hide labels
    const isDirectionLabelVisibleListener = isVisible => directionLabelText.setVisible(isVisible);
    isDirectionLabelVisibleDerivedProperty.link(isDirectionLabelVisibleListener);

    // Register for synchronization with model.
    const positionListener = position => {
      this.translation = modelViewTransform.modelToViewPosition(position);
    };
    electricFieldSensor.positionProperty.link(positionListener);
    this.dragListener = new DragListener({
      applyOffset: false,
      positionProperty: electricFieldSensor.positionProperty,
      tandem: tandem.createTandem('dragListener'),
      dragBoundsProperty: availableModelBoundsProperty,
      transform: modelViewTransform,
      canStartPress: () => !electricFieldSensor.animationTween,
      offsetPosition: (point, listener) => {
        return listener.pointer && listener.pointer.isTouchLike() ? new Vector2(0, -2 * ChargesAndFieldsConstants.ELECTRIC_FIELD_SENSOR_CIRCLE_RADIUS) : Vector2.ZERO;
      },
      start: () => {
        // Move the sensor to the front of this layer when grabbed by the user.
        this.moveToFront();
      },
      end: () => {
        snapToGridLines(electricFieldSensor.positionProperty);
        if (!enclosureBounds.containsPoint(electricFieldSensor.positionProperty.get())) {
          electricFieldSensor.isActiveProperty.set(true);
        }

        // Avoid corner-case issue #89. Treat excessively large E-field magnitude as an indicator that r ~ 0
        if (electricFieldSensor.electricField.magnitude > ChargesAndFieldsConstants.MAX_EFIELD_MAGNITUDE) {
          arrowNode.visible = false;
        }
      }
    });
    this.dragListener.isUserControlledProperty.link(controlled => electricFieldSensor.isUserControlledProperty.set(controlled));

    // Conditionally hook up the input handling (and cursor) when the sensor is interactive.
    let isDragListenerAttached = false;
    const isInteractiveListener = () => {
      const isInteractive = electricFieldSensor.isInteractiveProperty.get();
      if (isDragListenerAttached !== isInteractive) {
        if (isInteractive) {
          this.cursor = 'pointer';
          this.addInputListener(this.dragListener);
        } else {
          this.cursor = null;
          this.removeInputListener(this.dragListener);
        }
        isDragListenerAttached = isInteractive;
      }
    };
    electricFieldSensor.isInteractiveProperty.link(isInteractiveListener);
    this.availableModelBoundsProperty = availableModelBoundsProperty;
    this.disposeElectricFieldSensorNode = () => {
      arrowNode.dispose();
      electricFieldSensor.isActiveProperty.unlink(isActiveListener);
      electricFieldSensor.isInteractiveProperty.unlink(isInteractiveListener);
      electricFieldSensor.positionProperty.unlink(positionListener);
      electricFieldSensor.electricFieldProperty.unlink(electricFieldListener);
      areValuesVisibleProperty.unlink(areValuesVisibleListener);
      isPlayAreaChargedProperty.unlink(isPlayAreaChargedListener);
      isDirectionLabelVisibleDerivedProperty.unlink(isDirectionLabelVisibleListener);
      isDirectionLabelVisibleDerivedProperty.dispose();
      this.dragListener.dispose();
      fieldStrengthLabelText.dispose();
      directionLabelText.dispose();
    };

    /**
     * Decimal adjustment of a number is a function that round a number and returns a string.
     * For numbers between -10 and 10, the return strings has a fixed number of decimal places (determined by maxDecimalPlaces)
     * whereas for numbers larger than ten, (or smaller than -10)  the number returned has with a fixed number of significant figures that
     * is at least equal to the number of decimal places (or larger). See example below
     *
     * @param {number} number
     * @param {Object} [options]
     * @returns {string}
     */
    function decimalAdjust(number, options) {
      options = merge({
        maxDecimalPlaces: 3
      }, options);

      // e.g. for  maxDecimalPlaces: 3
      // 9999.11 -> 9999  (numbers larger than 10^maxDecimalPlaces) are rounded to unity
      // 999.111 -> 999.1
      // 99.1111 -> 99.11
      // 9.11111 -> 9.111 (numbers smaller than 10 have maxDecimalPlaces decimal places)
      // 1.11111 -> 1.111
      // 0.11111 -> 0.111
      // 0.00111 -> 0.001
      // 0.00011 -> 0.000

      // let's find the exponent as in
      // number = mantissa times 10^(exponent) where the mantissa is between 1 and 10 (or -1 to -10)
      const exponent = Math.floor(Math.log(Math.abs(number)) / Math.log(10));
      let decimalPlaces;
      if (exponent >= options.maxDecimalPlaces) {
        decimalPlaces = 0;
      } else if (exponent > 0) {
        decimalPlaces = options.maxDecimalPlaces - exponent;
      } else {
        decimalPlaces = options.maxDecimalPlaces;
      }
      return Utils.toFixed(number, decimalPlaces);
    }
  }

  /**
   * Releases references
   * @public
   */
  dispose() {
    this.disposeElectricFieldSensorNode();
    super.dispose();
  }
}
chargesAndFields.register('ElectricFieldSensorNode', ElectricFieldSensorNode);
export default ElectricFieldSensorNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJVdGlscyIsIlZlY3RvcjIiLCJtZXJnZSIsIlN0cmluZ1V0aWxzIiwiQXJyb3dOb2RlIiwiRHJhZ0xpc3RlbmVyIiwiTm9kZSIsIlRleHQiLCJjaGFyZ2VzQW5kRmllbGRzIiwiQ2hhcmdlc0FuZEZpZWxkc1N0cmluZ3MiLCJDaGFyZ2VzQW5kRmllbGRzQ29sb3JzIiwiQ2hhcmdlc0FuZEZpZWxkc0NvbnN0YW50cyIsIkVsZWN0cmljRmllbGRTZW5zb3JSZXByZXNlbnRhdGlvbk5vZGUiLCJhbmdsZVVuaXRTdHJpbmciLCJhbmdsZVVuaXQiLCJlRmllbGRVbml0U3RyaW5nIiwiZUZpZWxkVW5pdCIsInBhdHRlcm4wVmFsdWUxVW5pdHNTdHJpbmciLCJwYXR0ZXJuIiwiTEFCRUxfRk9OVCIsIkVMRUNUUklDX0ZJRUxEX1NFTlNPUl9MQUJFTF9GT05UIiwiTUlOX0FSUk9XX0xFTkdUSCIsIkVsZWN0cmljRmllbGRTZW5zb3JOb2RlIiwiY29uc3RydWN0b3IiLCJlbGVjdHJpY0ZpZWxkU2Vuc29yIiwic25hcFRvR3JpZExpbmVzIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwiYXZhaWxhYmxlTW9kZWxCb3VuZHNQcm9wZXJ0eSIsImlzUGxheUFyZWFDaGFyZ2VkUHJvcGVydHkiLCJhcmVWYWx1ZXNWaXNpYmxlUHJvcGVydHkiLCJlbmNsb3N1cmVCb3VuZHMiLCJ0YW5kZW0iLCJwaGV0aW9EeW5hbWljRWxlbWVudCIsInBoZXRpb1R5cGUiLCJOb2RlSU8iLCJtb2RlbEVsZW1lbnQiLCJ0b3VjaEFyZWEiLCJsb2NhbEJvdW5kcyIsImRpbGF0ZWQiLCJhcnJvd05vZGUiLCJwaWNrYWJsZSIsInN0cm9rZSIsImVsZWN0cmljRmllbGRTZW5zb3JBcnJvd1Byb3BlcnR5IiwiZmlsbCIsImNyZWF0ZVRhbmRlbSIsImZpZWxkU3RyZW5ndGhMYWJlbFRleHQiLCJmb250IiwiZWxlY3RyaWNGaWVsZFNlbnNvckxhYmVsUHJvcGVydHkiLCJkaXJlY3Rpb25MYWJlbFRleHQiLCJhZGRDaGlsZCIsIm1vdmVUb0JhY2siLCJsZWZ0IiwiY2VudGVyWSIsImJvdHRvbSIsInRvcCIsImVsZWN0cmljRmllbGRMaXN0ZW5lciIsImVsZWN0cmljRmllbGQiLCJtYWduaXR1ZGUiLCJhbmdsZSIsIk1BWF9FRklFTERfTUFHTklUVURFIiwiYXJyb3dMZW5ndGgiLCJzZXRUYWlsQW5kVGlwIiwiTWF0aCIsImNvcyIsInNpbiIsInZpc2libGUiLCJpc0FjdGl2ZVByb3BlcnR5IiwiZ2V0IiwiZmllbGRNYWduaXR1ZGVTdHJpbmciLCJkZWNpbWFsQWRqdXN0IiwibWF4RGVjaW1hbFBsYWNlcyIsInN0cmluZyIsImZvcm1hdCIsImFuZ2xlU3RyaW5nIiwidG9GaXhlZCIsInRvRGVncmVlcyIsImNlbnRlclgiLCJlbGVjdHJpY0ZpZWxkUHJvcGVydHkiLCJsaW5rIiwiaXNBY3RpdmVMaXN0ZW5lciIsImlzQWN0aXZlIiwiYXJlVmFsdWVzVmlzaWJsZUxpc3RlbmVyIiwiaXNWaXNpYmxlIiwiaXNQbGF5QXJlYUNoYXJnZWRMaXN0ZW5lciIsImlzUGxheUFyZWFDaGFyZ2VkIiwic2V0VmlzaWJsZSIsImlzRGlyZWN0aW9uTGFiZWxWaXNpYmxlRGVyaXZlZFByb3BlcnR5IiwiYXJlVmFsdWVzVmlzaWJsZSIsImlzRGlyZWN0aW9uTGFiZWxWaXNpYmxlTGlzdGVuZXIiLCJwb3NpdGlvbkxpc3RlbmVyIiwicG9zaXRpb24iLCJ0cmFuc2xhdGlvbiIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJwb3NpdGlvblByb3BlcnR5IiwiZHJhZ0xpc3RlbmVyIiwiYXBwbHlPZmZzZXQiLCJkcmFnQm91bmRzUHJvcGVydHkiLCJ0cmFuc2Zvcm0iLCJjYW5TdGFydFByZXNzIiwiYW5pbWF0aW9uVHdlZW4iLCJvZmZzZXRQb3NpdGlvbiIsInBvaW50IiwibGlzdGVuZXIiLCJwb2ludGVyIiwiaXNUb3VjaExpa2UiLCJFTEVDVFJJQ19GSUVMRF9TRU5TT1JfQ0lSQ0xFX1JBRElVUyIsIlpFUk8iLCJzdGFydCIsIm1vdmVUb0Zyb250IiwiZW5kIiwiY29udGFpbnNQb2ludCIsInNldCIsImlzVXNlckNvbnRyb2xsZWRQcm9wZXJ0eSIsImNvbnRyb2xsZWQiLCJpc0RyYWdMaXN0ZW5lckF0dGFjaGVkIiwiaXNJbnRlcmFjdGl2ZUxpc3RlbmVyIiwiaXNJbnRlcmFjdGl2ZSIsImlzSW50ZXJhY3RpdmVQcm9wZXJ0eSIsImN1cnNvciIsImFkZElucHV0TGlzdGVuZXIiLCJyZW1vdmVJbnB1dExpc3RlbmVyIiwiZGlzcG9zZUVsZWN0cmljRmllbGRTZW5zb3JOb2RlIiwiZGlzcG9zZSIsInVubGluayIsIm51bWJlciIsIm9wdGlvbnMiLCJleHBvbmVudCIsImZsb29yIiwibG9nIiwiYWJzIiwiZGVjaW1hbFBsYWNlcyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRWxlY3RyaWNGaWVsZFNlbnNvck5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2NlbmVyeSBOb2RlIGZvciB0aGUgZHJhZ2dhYmxlIGVsZWN0cmljIGZpZWxkIHNlbnNvciBub2RlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIE1hcnRpbiBWZWlsbGV0dGUgKEJlcmVhIENvbGxlZ2UpXHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IEFycm93Tm9kZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvQXJyb3dOb2RlLmpzJztcclxuaW1wb3J0IHsgRHJhZ0xpc3RlbmVyLCBOb2RlLCBUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGNoYXJnZXNBbmRGaWVsZHMgZnJvbSAnLi4vLi4vY2hhcmdlc0FuZEZpZWxkcy5qcyc7XHJcbmltcG9ydCBDaGFyZ2VzQW5kRmllbGRzU3RyaW5ncyBmcm9tICcuLi8uLi9DaGFyZ2VzQW5kRmllbGRzU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzIGZyb20gJy4uL0NoYXJnZXNBbmRGaWVsZHNDb2xvcnMuanMnO1xyXG5pbXBvcnQgQ2hhcmdlc0FuZEZpZWxkc0NvbnN0YW50cyBmcm9tICcuLi9DaGFyZ2VzQW5kRmllbGRzQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEVsZWN0cmljRmllbGRTZW5zb3JSZXByZXNlbnRhdGlvbk5vZGUgZnJvbSAnLi9FbGVjdHJpY0ZpZWxkU2Vuc29yUmVwcmVzZW50YXRpb25Ob2RlLmpzJztcclxuXHJcbmNvbnN0IGFuZ2xlVW5pdFN0cmluZyA9IENoYXJnZXNBbmRGaWVsZHNTdHJpbmdzLmFuZ2xlVW5pdDtcclxuY29uc3QgZUZpZWxkVW5pdFN0cmluZyA9IENoYXJnZXNBbmRGaWVsZHNTdHJpbmdzLmVGaWVsZFVuaXQ7XHJcbmNvbnN0IHBhdHRlcm4wVmFsdWUxVW5pdHNTdHJpbmcgPSBDaGFyZ2VzQW5kRmllbGRzU3RyaW5ncy5wYXR0ZXJuWyAnMHZhbHVlJyBdWyAnMXVuaXRzJyBdO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IExBQkVMX0ZPTlQgPSBDaGFyZ2VzQW5kRmllbGRzQ29uc3RhbnRzLkVMRUNUUklDX0ZJRUxEX1NFTlNPUl9MQUJFTF9GT05UO1xyXG5cclxuLy8gTWF4IHZhbHVlIGNob3NlbiBzdWNoIHRoYXQgdGhpcyBsaW1pdCBpcyByZWFjaGVkIG9uY2UgdGhlIHNlbnNvciBpcyBmdWxseSBlbmNsb3NlZCBpbiBhIGNoYXJnZVxyXG5jb25zdCBNSU5fQVJST1dfTEVOR1RIID0gMWUtOTtcclxuXHJcbmNsYXNzIEVsZWN0cmljRmllbGRTZW5zb3JOb2RlIGV4dGVuZHMgRWxlY3RyaWNGaWVsZFNlbnNvclJlcHJlc2VudGF0aW9uTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnN0cnVjdG9yIGZvciB0aGUgRWxlY3RyaWNGaWVsZFNlbnNvck5vZGUgd2hpY2ggcmVuZGVycyB0aGUgc2Vuc29yIGFzIGEgc2NlbmVyeSBub2RlLlxyXG4gICAqIEBwYXJhbSB7RWxlY3RyaWNGaWVsZFNlbnNvcn0gZWxlY3RyaWNGaWVsZFNlbnNvclxyXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IHNuYXBUb0dyaWRMaW5lcyAtIGZ1bmN0aW9uKCB7UHJvcGVydHkuPFZlY3RvcjI+fSlcclxuICAgKiBAcGFyYW0ge01vZGVsVmlld1RyYW5zZm9ybTJ9IG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPEJvdW5kczI+fSBhdmFpbGFibGVNb2RlbEJvdW5kc1Byb3BlcnR5IC0gZHJhZ0JvdW5kcyBmb3IgdGhlIGVsZWN0cmljIGZpZWxkIHNlbnNvciBub2RlXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IGlzUGxheUFyZWFDaGFyZ2VkUHJvcGVydHkgLSBpcyB0aGVyZSBhdCBsZWFzdCBvbmUgY2hhcmdlZCBwYXJ0aWNsZSBvbiB0aGUgYm9hcmRcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5Ljxib29sZWFuPn0gYXJlVmFsdWVzVmlzaWJsZVByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtCb3VuZHMyfSBlbmNsb3N1cmVCb3VuZHNcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGVsZWN0cmljRmllbGRTZW5zb3IsXHJcbiAgICAgICAgICAgICAgIHNuYXBUb0dyaWRMaW5lcyxcclxuICAgICAgICAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLFxyXG4gICAgICAgICAgICAgICBhdmFpbGFibGVNb2RlbEJvdW5kc1Byb3BlcnR5LFxyXG4gICAgICAgICAgICAgICBpc1BsYXlBcmVhQ2hhcmdlZFByb3BlcnR5LFxyXG4gICAgICAgICAgICAgICBhcmVWYWx1ZXNWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgICAgICAgICAgIGVuY2xvc3VyZUJvdW5kcyxcclxuICAgICAgICAgICAgICAgdGFuZGVtICkge1xyXG5cclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLFxyXG4gICAgICBwaGV0aW9EeW5hbWljRWxlbWVudDogdHJ1ZSxcclxuICAgICAgcGhldGlvVHlwZTogTm9kZS5Ob2RlSU9cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLm1vZGVsRWxlbWVudCA9IGVsZWN0cmljRmllbGRTZW5zb3I7IC8vIEBwdWJsaWMgKHJlYWQtb25seSlcclxuXHJcbiAgICAvLyBFeHBhbmQgdGhlIHRvdWNoIGFyZWFcclxuICAgIHRoaXMudG91Y2hBcmVhID0gdGhpcy5sb2NhbEJvdW5kcy5kaWxhdGVkKCAxMCApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgRS1maWVsZCBhcnJvdywgKHNldCB0aGUgYXJyb3cgaG9yaXpvbnRhbGx5IHRvIHN0YXJ0IHdpdGgpXHJcbiAgICAvLyBUT0RPOiB3aHkgaXMgdGhlIGZpbGwgYW5kIHN0cm9rZSBzZXQgdG8gdGhlIHNhbWUgdmFsdWU/XHJcbiAgICBjb25zdCBhcnJvd05vZGUgPSBuZXcgQXJyb3dOb2RlKCAwLCAwLCAxLCAwLCB7XHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZSxcclxuICAgICAgc3Ryb2tlOiBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmVsZWN0cmljRmllbGRTZW5zb3JBcnJvd1Byb3BlcnR5LFxyXG4gICAgICBmaWxsOiBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmVsZWN0cmljRmllbGRTZW5zb3JBcnJvd1Byb3BlcnR5LFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdhcnJvd05vZGUnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdHdvIG51bWVyaWNhbCByZWFkb3V0cyBmb3IgdGhlIHN0cmVuZ3RoIGFuZCBkaXJlY3Rpb24gb2YgdGhlIGVsZWN0cmljIGZpZWxkLlxyXG4gICAgY29uc3QgZmllbGRTdHJlbmd0aExhYmVsVGV4dCA9IG5ldyBUZXh0KCAnJywge1xyXG4gICAgICBmb250OiBMQUJFTF9GT05ULFxyXG4gICAgICBwaWNrYWJsZTogZmFsc2UsXHJcbiAgICAgIGZpbGw6IENoYXJnZXNBbmRGaWVsZHNDb2xvcnMuZWxlY3RyaWNGaWVsZFNlbnNvckxhYmVsUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2ZpZWxkU3RyZW5ndGhMYWJlbFRleHQnIClcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IGRpcmVjdGlvbkxhYmVsVGV4dCA9IG5ldyBUZXh0KCAnJywge1xyXG4gICAgICBmb250OiBMQUJFTF9GT05ULFxyXG4gICAgICBwaWNrYWJsZTogZmFsc2UsXHJcbiAgICAgIGZpbGw6IENoYXJnZXNBbmRGaWVsZHNDb2xvcnMuZWxlY3RyaWNGaWVsZFNlbnNvckxhYmVsUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RpcmVjdGlvbkxhYmVsVGV4dCcgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIGFycm93Tm9kZSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggZmllbGRTdHJlbmd0aExhYmVsVGV4dCApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggZGlyZWN0aW9uTGFiZWxUZXh0ICk7XHJcbiAgICBhcnJvd05vZGUubW92ZVRvQmFjaygpOyAvLyB0aGUgYXJyb3cgc2hvdWxkIGFsd2F5cyBiZSBvbiB0aGUgYmFjayBvZiAndGhpcydcclxuXHJcbiAgICAvLyBsYXlvdXRcclxuICAgIGFycm93Tm9kZS5sZWZ0ID0gMDtcclxuICAgIGFycm93Tm9kZS5jZW50ZXJZID0gMDtcclxuICAgIGZpZWxkU3RyZW5ndGhMYWJlbFRleHQuYm90dG9tID0gdGhpcy50b3A7IC8vICd0aGlzJyBpcyB0aGUgRWxlY3RyaWNGaWVsZFNlbnNvclJlcHJlc2VudGF0aW9uTm9kZSwgaS5lLiB0aGUgY2lyY2xlXHJcbiAgICBkaXJlY3Rpb25MYWJlbFRleHQuYm90dG9tID0gZmllbGRTdHJlbmd0aExhYmVsVGV4dC50b3A7XHJcblxyXG4gICAgLy8gd2hlbiB0aGUgZWxlY3RyaWMgZmllbGQgY2hhbmdlcyB1cGRhdGUgdGhlIGFycm93IGFuZCB0aGUgbGFiZWxzXHJcbiAgICBjb25zdCBlbGVjdHJpY0ZpZWxkTGlzdGVuZXIgPSBlbGVjdHJpY0ZpZWxkID0+IHtcclxuICAgICAgY29uc3QgbWFnbml0dWRlID0gZWxlY3RyaWNGaWVsZC5tYWduaXR1ZGU7XHJcbiAgICAgIGNvbnN0IGFuZ2xlID0gZWxlY3RyaWNGaWVsZC5hbmdsZTsgLy8gYW5nbGUgZnJvbSB0aGUgbW9kZWwsIGluIHJhZGlhbnNcclxuXHJcbiAgICAgIC8vIG5vdGUgdGhhdCB0aGUgYW5nbGVJblZpZXcgPSAtMSAqIGFuZ2xlSW5Nb2RlbFxyXG4gICAgICAvLyBzaW5jZSB0aGUgdmVydGljYWwgZGlyZWN0aW9uIGlzIHJldmVyc2VkIGJldHdlZW4gdGhlIHZpZXcgYW5kIHRoZSBtb2RlbFxyXG4gICAgICAvLyBzbyB0aGUgdGV4dCBtdXN0IGJlIHVwZGF0ZWQgd2l0aCBhbmdsZSB3aGVyZWFzIGFycm93IG5vZGUgbXVzdCBiZSB1cGRhdGVkIHdpdGggLWFuZ2xlXHJcblxyXG4gICAgICAvLyBVcGRhdGUgdGhlIHNlbnNvciBhcnJvdyBhbmQgdGhlIGVsZWN0cmljIGZpZWxkIGxhYmVscy5cclxuICAgICAgLy8gTWFrZSBzdXJlIHRoZSBFLWZpZWxkIG1hZ25pdHVkZSBpcyBub3QgdG9vIGxhcmdlIHRvIGF2b2lkXHJcbiAgICAgIC8vIHRleHQgb3ZlcnJ1bnMgYW5kIG90aGVyIHByb2JsZW1zIHdpdGggdmVyeSBsYXJnZSBwb3RlbnRpYWxzL2ZpZWxkcyAodGhpc1xyXG4gICAgICAvLyB0eXBpY2FsbHkgb2NjdXJzIHdoZW4gdGhlIHNlbnNvciBpcyBwbGFjZWQgdG9vIGNsb3NlIHRvIGEgY2hhcmdlIGNlbnRlcikuXHJcbiAgICAgIGlmICggbWFnbml0dWRlIDwgQ2hhcmdlc0FuZEZpZWxkc0NvbnN0YW50cy5NQVhfRUZJRUxEX01BR05JVFVERSApIHtcclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgYXJyb3cgbGVuZ3RoIGlzIGFib3ZlIE1JTl9BUlJPV19MRU5HVEggdG8gYXZvaWQgcHJvYmxlbXNcclxuICAgICAgICAvLyB3aXRoIHNjZW5lcnkgY29kZSBhdHRlbXB0aW5nIHRvIG5vcm1hbGl6ZSBhIHplcm8tbGVuZ3RoIHZlY3Rvci5cclxuICAgICAgICBjb25zdCBhcnJvd0xlbmd0aCA9IDE1ICogbWFnbml0dWRlOyAvLyBhcmJpdHJhcnkgbXVsdGlwbGljYXRpdmUgZmFjdG9yIGZvciB0aGUgdmlld1xyXG4gICAgICAgIGlmICggYXJyb3dMZW5ndGggPiBNSU5fQVJST1dfTEVOR1RIICkge1xyXG4gICAgICAgICAgYXJyb3dOb2RlLnNldFRhaWxBbmRUaXAoIDAsIDAsIGFycm93TGVuZ3RoICogTWF0aC5jb3MoIC1hbmdsZSApLCBhcnJvd0xlbmd0aCAqIE1hdGguc2luKCAtYW5nbGUgKSApO1xyXG4gICAgICAgICAgYXJyb3dOb2RlLnZpc2libGUgPSBlbGVjdHJpY0ZpZWxkU2Vuc29yLmlzQWN0aXZlUHJvcGVydHkuZ2V0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIGFyZVZhbHVlc1Zpc2libGVQcm9wZXJ0eS5nZXQoKSApIHtcclxuICAgICAgICAgIGZpZWxkU3RyZW5ndGhMYWJlbFRleHQudmlzaWJsZSA9IGVsZWN0cmljRmllbGRTZW5zb3IuaXNBY3RpdmVQcm9wZXJ0eS5nZXQoKTtcclxuICAgICAgICAgIGRpcmVjdGlvbkxhYmVsVGV4dC52aXNpYmxlID0gZWxlY3RyaWNGaWVsZFNlbnNvci5pc0FjdGl2ZVByb3BlcnR5LmdldCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBzdHJpbmdzIGluIHRoZSBsYWJlbHNcclxuICAgICAgICBjb25zdCBmaWVsZE1hZ25pdHVkZVN0cmluZyA9IGRlY2ltYWxBZGp1c3QoIG1hZ25pdHVkZSwgeyBtYXhEZWNpbWFsUGxhY2VzOiAyIH0gKTtcclxuICAgICAgICBmaWVsZFN0cmVuZ3RoTGFiZWxUZXh0LnN0cmluZyA9IFN0cmluZ1V0aWxzLmZvcm1hdCggcGF0dGVybjBWYWx1ZTFVbml0c1N0cmluZywgZmllbGRNYWduaXR1ZGVTdHJpbmcsIGVGaWVsZFVuaXRTdHJpbmcgKTtcclxuXHJcbiAgICAgICAgY29uc3QgYW5nbGVTdHJpbmcgPSBVdGlscy50b0ZpeGVkKCBVdGlscy50b0RlZ3JlZXMoIGFuZ2xlICksIDEgKTtcclxuICAgICAgICBkaXJlY3Rpb25MYWJlbFRleHQuc3RyaW5nID0gaXNQbGF5QXJlYUNoYXJnZWRQcm9wZXJ0eS5nZXQoKSA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZ1V0aWxzLmZvcm1hdCggcGF0dGVybjBWYWx1ZTFVbml0c1N0cmluZywgYW5nbGVTdHJpbmcsIGFuZ2xlVW5pdFN0cmluZyApIDogJyc7XHJcblxyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGFycm93Tm9kZS52aXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgICAgIGZpZWxkU3RyZW5ndGhMYWJlbFRleHQuc3RyaW5nID0gJy0nO1xyXG4gICAgICAgIGRpcmVjdGlvbkxhYmVsVGV4dC5zdHJpbmcgPSAnLSc7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZpZWxkU3RyZW5ndGhMYWJlbFRleHQuY2VudGVyWCA9IDA7XHJcbiAgICAgIGRpcmVjdGlvbkxhYmVsVGV4dC5jZW50ZXJYID0gMDtcclxuICAgIH07XHJcbiAgICBlbGVjdHJpY0ZpZWxkU2Vuc29yLmVsZWN0cmljRmllbGRQcm9wZXJ0eS5saW5rKCBlbGVjdHJpY0ZpZWxkTGlzdGVuZXIgKTtcclxuXHJcbiAgICBjb25zdCBpc0FjdGl2ZUxpc3RlbmVyID0gaXNBY3RpdmUgPT4ge1xyXG4gICAgICBhcnJvd05vZGUudmlzaWJsZSA9IGlzQWN0aXZlO1xyXG4gICAgICBpZiAoIGFyZVZhbHVlc1Zpc2libGVQcm9wZXJ0eS5nZXQoKSApIHtcclxuICAgICAgICBmaWVsZFN0cmVuZ3RoTGFiZWxUZXh0LnZpc2libGUgPSBpc0FjdGl2ZTtcclxuICAgICAgICBkaXJlY3Rpb25MYWJlbFRleHQudmlzaWJsZSA9IGlzQWN0aXZlO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgZWxlY3RyaWNGaWVsZFNlbnNvci5pc0FjdGl2ZVByb3BlcnR5LmxpbmsoIGlzQWN0aXZlTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBTaG93L2hpZGUgbGFiZWxzXHJcbiAgICBjb25zdCBhcmVWYWx1ZXNWaXNpYmxlTGlzdGVuZXIgPSBpc1Zpc2libGUgPT4ge1xyXG4gICAgICBmaWVsZFN0cmVuZ3RoTGFiZWxUZXh0LnZpc2libGUgPSBpc1Zpc2libGU7XHJcbiAgICAgIGRpcmVjdGlvbkxhYmVsVGV4dC52aXNpYmxlID0gaXNWaXNpYmxlO1xyXG4gICAgfTtcclxuICAgIGFyZVZhbHVlc1Zpc2libGVQcm9wZXJ0eS5saW5rKCBhcmVWYWx1ZXNWaXNpYmxlTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBTaG93L2hpZGUgZmllbGQgYXJyb3dcclxuICAgIGNvbnN0IGlzUGxheUFyZWFDaGFyZ2VkTGlzdGVuZXIgPSBpc1BsYXlBcmVhQ2hhcmdlZCA9PiBhcnJvd05vZGUuc2V0VmlzaWJsZSggaXNQbGF5QXJlYUNoYXJnZWQgKTtcclxuICAgIGlzUGxheUFyZWFDaGFyZ2VkUHJvcGVydHkubGluayggaXNQbGF5QXJlYUNoYXJnZWRMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIFRoZSBkaXJlY3Rpb24gbGFiZWwgaXMgdmlzaWJsZSBpZjpcclxuICAgIC8vICgxKSAndmFsdWVzJyBpcyBjaGVja2VkXHJcbiAgICAvLyAoMikgdGhlIG5ldCBwbGF5IGFyZWEgY2hhcmdlIGlzIG1hcmtlZCBhcyBub256ZXJvXHJcbiAgICBjb25zdCBpc0RpcmVjdGlvbkxhYmVsVmlzaWJsZURlcml2ZWRQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgYXJlVmFsdWVzVmlzaWJsZVByb3BlcnR5LCBpc1BsYXlBcmVhQ2hhcmdlZFByb3BlcnR5IF0sXHJcbiAgICAgICggYXJlVmFsdWVzVmlzaWJsZSwgaXNQbGF5QXJlYUNoYXJnZWQgKSA9PiBhcmVWYWx1ZXNWaXNpYmxlICYmIGlzUGxheUFyZWFDaGFyZ2VkXHJcbiAgICApO1xyXG5cclxuICAgIC8vIFNob3cvaGlkZSBsYWJlbHNcclxuICAgIGNvbnN0IGlzRGlyZWN0aW9uTGFiZWxWaXNpYmxlTGlzdGVuZXIgPSBpc1Zpc2libGUgPT4gZGlyZWN0aW9uTGFiZWxUZXh0LnNldFZpc2libGUoIGlzVmlzaWJsZSApO1xyXG4gICAgaXNEaXJlY3Rpb25MYWJlbFZpc2libGVEZXJpdmVkUHJvcGVydHkubGluayggaXNEaXJlY3Rpb25MYWJlbFZpc2libGVMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIFJlZ2lzdGVyIGZvciBzeW5jaHJvbml6YXRpb24gd2l0aCBtb2RlbC5cclxuICAgIGNvbnN0IHBvc2l0aW9uTGlzdGVuZXIgPSBwb3NpdGlvbiA9PiB7XHJcbiAgICAgIHRoaXMudHJhbnNsYXRpb24gPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggcG9zaXRpb24gKTtcclxuICAgIH07XHJcbiAgICBlbGVjdHJpY0ZpZWxkU2Vuc29yLnBvc2l0aW9uUHJvcGVydHkubGluayggcG9zaXRpb25MaXN0ZW5lciApO1xyXG5cclxuICAgIHRoaXMuZHJhZ0xpc3RlbmVyID0gbmV3IERyYWdMaXN0ZW5lcigge1xyXG4gICAgICBhcHBseU9mZnNldDogZmFsc2UsXHJcbiAgICAgIHBvc2l0aW9uUHJvcGVydHk6IGVsZWN0cmljRmllbGRTZW5zb3IucG9zaXRpb25Qcm9wZXJ0eSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZHJhZ0xpc3RlbmVyJyApLFxyXG4gICAgICBkcmFnQm91bmRzUHJvcGVydHk6IGF2YWlsYWJsZU1vZGVsQm91bmRzUHJvcGVydHksXHJcbiAgICAgIHRyYW5zZm9ybTogbW9kZWxWaWV3VHJhbnNmb3JtLFxyXG4gICAgICBjYW5TdGFydFByZXNzOiAoKSA9PiAhZWxlY3RyaWNGaWVsZFNlbnNvci5hbmltYXRpb25Ud2VlbixcclxuICAgICAgb2Zmc2V0UG9zaXRpb246ICggcG9pbnQsIGxpc3RlbmVyICkgPT4ge1xyXG4gICAgICAgIHJldHVybiBsaXN0ZW5lci5wb2ludGVyICYmIGxpc3RlbmVyLnBvaW50ZXIuaXNUb3VjaExpa2UoKSA/IG5ldyBWZWN0b3IyKCAwLCAtMiAqIENoYXJnZXNBbmRGaWVsZHNDb25zdGFudHMuRUxFQ1RSSUNfRklFTERfU0VOU09SX0NJUkNMRV9SQURJVVMgKSA6IFZlY3RvcjIuWkVSTztcclxuICAgICAgfSxcclxuICAgICAgc3RhcnQ6ICgpID0+IHtcclxuICAgICAgICAvLyBNb3ZlIHRoZSBzZW5zb3IgdG8gdGhlIGZyb250IG9mIHRoaXMgbGF5ZXIgd2hlbiBncmFiYmVkIGJ5IHRoZSB1c2VyLlxyXG4gICAgICAgIHRoaXMubW92ZVRvRnJvbnQoKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGVuZDogKCkgPT4ge1xyXG4gICAgICAgIHNuYXBUb0dyaWRMaW5lcyggZWxlY3RyaWNGaWVsZFNlbnNvci5wb3NpdGlvblByb3BlcnR5ICk7XHJcblxyXG4gICAgICAgIGlmICggIWVuY2xvc3VyZUJvdW5kcy5jb250YWluc1BvaW50KCBlbGVjdHJpY0ZpZWxkU2Vuc29yLnBvc2l0aW9uUHJvcGVydHkuZ2V0KCkgKSApIHtcclxuICAgICAgICAgIGVsZWN0cmljRmllbGRTZW5zb3IuaXNBY3RpdmVQcm9wZXJ0eS5zZXQoIHRydWUgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEF2b2lkIGNvcm5lci1jYXNlIGlzc3VlICM4OS4gVHJlYXQgZXhjZXNzaXZlbHkgbGFyZ2UgRS1maWVsZCBtYWduaXR1ZGUgYXMgYW4gaW5kaWNhdG9yIHRoYXQgciB+IDBcclxuICAgICAgICBpZiAoIGVsZWN0cmljRmllbGRTZW5zb3IuZWxlY3RyaWNGaWVsZC5tYWduaXR1ZGUgPiBDaGFyZ2VzQW5kRmllbGRzQ29uc3RhbnRzLk1BWF9FRklFTERfTUFHTklUVURFICkge1xyXG4gICAgICAgICAgYXJyb3dOb2RlLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIHRoaXMuZHJhZ0xpc3RlbmVyLmlzVXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5saW5rKCBjb250cm9sbGVkID0+IGVsZWN0cmljRmllbGRTZW5zb3IuaXNVc2VyQ29udHJvbGxlZFByb3BlcnR5LnNldCggY29udHJvbGxlZCApICk7XHJcblxyXG4gICAgLy8gQ29uZGl0aW9uYWxseSBob29rIHVwIHRoZSBpbnB1dCBoYW5kbGluZyAoYW5kIGN1cnNvcikgd2hlbiB0aGUgc2Vuc29yIGlzIGludGVyYWN0aXZlLlxyXG4gICAgbGV0IGlzRHJhZ0xpc3RlbmVyQXR0YWNoZWQgPSBmYWxzZTtcclxuICAgIGNvbnN0IGlzSW50ZXJhY3RpdmVMaXN0ZW5lciA9ICgpID0+IHtcclxuICAgICAgY29uc3QgaXNJbnRlcmFjdGl2ZSA9IGVsZWN0cmljRmllbGRTZW5zb3IuaXNJbnRlcmFjdGl2ZVByb3BlcnR5LmdldCgpO1xyXG5cclxuICAgICAgaWYgKCBpc0RyYWdMaXN0ZW5lckF0dGFjaGVkICE9PSBpc0ludGVyYWN0aXZlICkge1xyXG4gICAgICAgIGlmICggaXNJbnRlcmFjdGl2ZSApIHtcclxuICAgICAgICAgIHRoaXMuY3Vyc29yID0gJ3BvaW50ZXInO1xyXG4gICAgICAgICAgdGhpcy5hZGRJbnB1dExpc3RlbmVyKCB0aGlzLmRyYWdMaXN0ZW5lciApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuY3Vyc29yID0gbnVsbDtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlSW5wdXRMaXN0ZW5lciggdGhpcy5kcmFnTGlzdGVuZXIgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlzRHJhZ0xpc3RlbmVyQXR0YWNoZWQgPSBpc0ludGVyYWN0aXZlO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgZWxlY3RyaWNGaWVsZFNlbnNvci5pc0ludGVyYWN0aXZlUHJvcGVydHkubGluayggaXNJbnRlcmFjdGl2ZUxpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5hdmFpbGFibGVNb2RlbEJvdW5kc1Byb3BlcnR5ID0gYXZhaWxhYmxlTW9kZWxCb3VuZHNQcm9wZXJ0eTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VFbGVjdHJpY0ZpZWxkU2Vuc29yTm9kZSA9ICgpID0+IHtcclxuICAgICAgYXJyb3dOb2RlLmRpc3Bvc2UoKTtcclxuICAgICAgZWxlY3RyaWNGaWVsZFNlbnNvci5pc0FjdGl2ZVByb3BlcnR5LnVubGluayggaXNBY3RpdmVMaXN0ZW5lciApO1xyXG4gICAgICBlbGVjdHJpY0ZpZWxkU2Vuc29yLmlzSW50ZXJhY3RpdmVQcm9wZXJ0eS51bmxpbmsoIGlzSW50ZXJhY3RpdmVMaXN0ZW5lciApO1xyXG4gICAgICBlbGVjdHJpY0ZpZWxkU2Vuc29yLnBvc2l0aW9uUHJvcGVydHkudW5saW5rKCBwb3NpdGlvbkxpc3RlbmVyICk7XHJcbiAgICAgIGVsZWN0cmljRmllbGRTZW5zb3IuZWxlY3RyaWNGaWVsZFByb3BlcnR5LnVubGluayggZWxlY3RyaWNGaWVsZExpc3RlbmVyICk7XHJcbiAgICAgIGFyZVZhbHVlc1Zpc2libGVQcm9wZXJ0eS51bmxpbmsoIGFyZVZhbHVlc1Zpc2libGVMaXN0ZW5lciApO1xyXG4gICAgICBpc1BsYXlBcmVhQ2hhcmdlZFByb3BlcnR5LnVubGluayggaXNQbGF5QXJlYUNoYXJnZWRMaXN0ZW5lciApO1xyXG4gICAgICBpc0RpcmVjdGlvbkxhYmVsVmlzaWJsZURlcml2ZWRQcm9wZXJ0eS51bmxpbmsoIGlzRGlyZWN0aW9uTGFiZWxWaXNpYmxlTGlzdGVuZXIgKTtcclxuICAgICAgaXNEaXJlY3Rpb25MYWJlbFZpc2libGVEZXJpdmVkUHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgICB0aGlzLmRyYWdMaXN0ZW5lci5kaXNwb3NlKCk7XHJcbiAgICAgIGZpZWxkU3RyZW5ndGhMYWJlbFRleHQuZGlzcG9zZSgpO1xyXG4gICAgICBkaXJlY3Rpb25MYWJlbFRleHQuZGlzcG9zZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIERlY2ltYWwgYWRqdXN0bWVudCBvZiBhIG51bWJlciBpcyBhIGZ1bmN0aW9uIHRoYXQgcm91bmQgYSBudW1iZXIgYW5kIHJldHVybnMgYSBzdHJpbmcuXHJcbiAgICAgKiBGb3IgbnVtYmVycyBiZXR3ZWVuIC0xMCBhbmQgMTAsIHRoZSByZXR1cm4gc3RyaW5ncyBoYXMgYSBmaXhlZCBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMgKGRldGVybWluZWQgYnkgbWF4RGVjaW1hbFBsYWNlcylcclxuICAgICAqIHdoZXJlYXMgZm9yIG51bWJlcnMgbGFyZ2VyIHRoYW4gdGVuLCAob3Igc21hbGxlciB0aGFuIC0xMCkgIHRoZSBudW1iZXIgcmV0dXJuZWQgaGFzIHdpdGggYSBmaXhlZCBudW1iZXIgb2Ygc2lnbmlmaWNhbnQgZmlndXJlcyB0aGF0XHJcbiAgICAgKiBpcyBhdCBsZWFzdCBlcXVhbCB0byB0aGUgbnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzIChvciBsYXJnZXIpLiBTZWUgZXhhbXBsZSBiZWxvd1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBudW1iZXJcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGRlY2ltYWxBZGp1c3QoIG51bWJlciwgb3B0aW9ucyApIHtcclxuICAgICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcbiAgICAgICAgbWF4RGVjaW1hbFBsYWNlczogM1xyXG4gICAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgICAvLyBlLmcuIGZvciAgbWF4RGVjaW1hbFBsYWNlczogM1xyXG4gICAgICAvLyA5OTk5LjExIC0+IDk5OTkgIChudW1iZXJzIGxhcmdlciB0aGFuIDEwXm1heERlY2ltYWxQbGFjZXMpIGFyZSByb3VuZGVkIHRvIHVuaXR5XHJcbiAgICAgIC8vIDk5OS4xMTEgLT4gOTk5LjFcclxuICAgICAgLy8gOTkuMTExMSAtPiA5OS4xMVxyXG4gICAgICAvLyA5LjExMTExIC0+IDkuMTExIChudW1iZXJzIHNtYWxsZXIgdGhhbiAxMCBoYXZlIG1heERlY2ltYWxQbGFjZXMgZGVjaW1hbCBwbGFjZXMpXHJcbiAgICAgIC8vIDEuMTExMTEgLT4gMS4xMTFcclxuICAgICAgLy8gMC4xMTExMSAtPiAwLjExMVxyXG4gICAgICAvLyAwLjAwMTExIC0+IDAuMDAxXHJcbiAgICAgIC8vIDAuMDAwMTEgLT4gMC4wMDBcclxuXHJcbiAgICAgIC8vIGxldCdzIGZpbmQgdGhlIGV4cG9uZW50IGFzIGluXHJcbiAgICAgIC8vIG51bWJlciA9IG1hbnRpc3NhIHRpbWVzIDEwXihleHBvbmVudCkgd2hlcmUgdGhlIG1hbnRpc3NhIGlzIGJldHdlZW4gMSBhbmQgMTAgKG9yIC0xIHRvIC0xMClcclxuICAgICAgY29uc3QgZXhwb25lbnQgPSBNYXRoLmZsb29yKCBNYXRoLmxvZyggTWF0aC5hYnMoIG51bWJlciApICkgLyBNYXRoLmxvZyggMTAgKSApO1xyXG5cclxuICAgICAgbGV0IGRlY2ltYWxQbGFjZXM7XHJcblxyXG4gICAgICBpZiAoIGV4cG9uZW50ID49IG9wdGlvbnMubWF4RGVjaW1hbFBsYWNlcyApIHtcclxuICAgICAgICBkZWNpbWFsUGxhY2VzID0gMDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggZXhwb25lbnQgPiAwICkge1xyXG4gICAgICAgIGRlY2ltYWxQbGFjZXMgPSBvcHRpb25zLm1heERlY2ltYWxQbGFjZXMgLSBleHBvbmVudDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBkZWNpbWFsUGxhY2VzID0gb3B0aW9ucy5tYXhEZWNpbWFsUGxhY2VzO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gVXRpbHMudG9GaXhlZCggbnVtYmVyLCBkZWNpbWFsUGxhY2VzICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZWxlYXNlcyByZWZlcmVuY2VzXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGRpc3Bvc2UoKSB7XHJcbiAgICB0aGlzLmRpc3Bvc2VFbGVjdHJpY0ZpZWxkU2Vuc29yTm9kZSgpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuY2hhcmdlc0FuZEZpZWxkcy5yZWdpc3RlciggJ0VsZWN0cmljRmllbGRTZW5zb3JOb2RlJywgRWxlY3RyaWNGaWVsZFNlbnNvck5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgRWxlY3RyaWNGaWVsZFNlbnNvck5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsV0FBVyxN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