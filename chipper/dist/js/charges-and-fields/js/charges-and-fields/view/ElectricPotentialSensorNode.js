// Copyright 2014-2023, University of Colorado Boulder

/**
 * View for the ElectricPotentialSensorNode which renders the sensor as a scenery node.
 * The sensor is draggable, has a readout of the electric potential (that matches the
 * electric potential at the crosshair position). The electric potential sensor has two
 * push buttons: One of them send a callback that creates an electric potential line whereas
 * the second push buttons deletes all the electric potential lines on the board.
 *
 * @author Martin Veillette (Berea College)
 */

import Property from '../../../../axon/js/Property.js';
import Utils from '../../../../dot/js/Utils.js';
import { Shape } from '../../../../kite/js/imports.js';
import merge from '../../../../phet-core/js/merge.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import EraserButton from '../../../../scenery-phet/js/buttons/EraserButton.js';
import { Circle, DragListener, HBox, Image, Node, Path, Rectangle, Text, VBox } from '../../../../scenery/js/imports.js';
import electricPotentialPanelOutline_png from '../../../mipmaps/electricPotentialPanelOutline_png.js';
import chargesAndFields from '../../chargesAndFields.js';
import ChargesAndFieldsStrings from '../../ChargesAndFieldsStrings.js';
import ChargesAndFieldsColors from '../ChargesAndFieldsColors.js';
import ChargesAndFieldsConstants from '../ChargesAndFieldsConstants.js';
import PencilButton from './PencilButton.js';

// constants
const CIRCLE_RADIUS = 18; // radius of the circle around the crosshair

const equipotentialString = ChargesAndFieldsStrings.equipotential;
const pattern0Value1UnitsString = ChargesAndFieldsStrings.pattern['0value']['1units'];
const voltageUnitString = ChargesAndFieldsStrings.voltageUnit;
class ElectricPotentialSensorNode extends Node {
  /**
   * TODO: this interface is unwieldy and difficult to navigate.  Why not pass the model with all these functions?
   * @param {ChargesAndFieldsModel} model
   * @param {Function} snapToGridLines - A Function that snap the position to the minor gridlines.
   * @param {Function} getElectricPotentialColor - A function that maps a value of the electric potential to a color
   * @param {ModelViewTransform2} modelViewTransform - the coordinate transform between model coordinates and view coordinates
   * @param {Property.<Bounds2>} availableModelBoundsProperty - drag bounds in model coordinates for the electric potential sensor node
   * @param {Tandem} tandem
   */
  constructor(model, snapToGridLines, getElectricPotentialColor, modelViewTransform, availableModelBoundsProperty, tandem) {
    const electricPotentialSensor = model.electricPotentialSensor;
    super({
      cursor: 'pointer',
      // Show a cursor hand over the sensor
      tandem: tandem
    });
    this.modelElement = electricPotentialSensor; // @public (read-only)

    // @public
    this.isUserControlledProperty = new Property(false);

    // Create the centered circle around the crosshair. The origin of this node is the center of the circle
    const circle = new Circle(CIRCLE_RADIUS, {
      lineWidth: 3,
      centerX: 0,
      centerY: 0,
      stroke: ChargesAndFieldsColors.electricPotentialSensorCircleStrokeProperty,
      tandem: tandem.createTandem('circle')
    });

    // Create the crosshair
    const crosshairShape = new Shape().moveTo(-CIRCLE_RADIUS, 0).lineTo(CIRCLE_RADIUS, 0).moveTo(0, -CIRCLE_RADIUS).lineTo(0, CIRCLE_RADIUS);
    const crosshair = new Path(crosshairShape, {
      centerX: 0,
      centerY: 0,
      stroke: ChargesAndFieldsColors.electricPotentialSensorCrosshairStrokeProperty,
      tandem: tandem.createTandem('crosshair')
    });

    // Create the base of the crosshair
    // TODO: why are the fill and stroke set to the same thing?
    const crosshairMount = new Rectangle(0, 0, 0.4 * CIRCLE_RADIUS, 0.4 * CIRCLE_RADIUS, {
      fill: ChargesAndFieldsColors.electricPotentialSensorCrosshairStrokeProperty,
      stroke: ChargesAndFieldsColors.electricPotentialSensorCrosshairStrokeProperty,
      tandem: tandem.createTandem('crosshairMount')
    });

    // Create the text node above the readout
    const electricPotentialPanelTitleText = new Text(equipotentialString, {
      maxWidth: 85,
      font: ChargesAndFieldsConstants.DEFAULT_FONT,
      fill: ChargesAndFieldsColors.electricPotentialPanelTitleTextProperty,
      tandem: tandem.createTandem('electricPotentialPanelTitleText')
    });

    // Create the button that allows the board to be cleared of all lines.
    const clearButton = new EraserButton({
      tandem: tandem.createTandem('clearButton'),
      baseColor: '#f2f2f2',
      iconWidth: 23,
      listener: () => model.clearElectricPotentialLines()
    });

    // Create the button that allows to plot the ElectricPotential Lines
    const plotElectricPotentialLineButton = new PencilButton(tandem.createTandem('plotElectricPotentialLineButton'), {
      baseColor: '#f2f2f2',
      listener: () => model.addElectricPotentialLine(electricPotentialSensor.positionProperty.get())
    });
    const isPlayAreaChargedListener = charged => {
      plotElectricPotentialLineButton.enabled = charged;
    };
    model.isPlayAreaChargedProperty.link(isPlayAreaChargedListener);

    // See see https://github.com/phetsims/charges-and-fields/issues/73
    const doNotStartDragListener = {
      down: event => event.handle()
    };
    clearButton.addInputListener(doNotStartDragListener);
    plotElectricPotentialLineButton.addInputListener(doNotStartDragListener);

    // Create the voltage readout
    const voltageText = new Text('', {
      maxWidth: 65,
      font: ChargesAndFieldsConstants.DEFAULT_FONT,
      tandem: tandem.createTandem('voltageText'),
      fill: ChargesAndFieldsColors.electricPotentialSensorTextPanelTextFillProperty
    });

    // The clear and plot buttons
    const buttonsBox = new HBox({
      spacing: 10,
      children: [clearButton, plotElectricPotentialLineButton],
      pickable: true,
      scale: 0.8
    });

    // Create the background rectangle behind the voltage Reading
    const backgroundAdjustment = 0;
    const backgroundRectangle = new Rectangle(backgroundAdjustment, 0, buttonsBox.width - backgroundAdjustment * 2, voltageText.height * 1.5, 5, 5, {
      fill: ChargesAndFieldsColors.electricPotentialSensorTextPanelBackgroundProperty,
      stroke: ChargesAndFieldsColors.electricPotentialSensorTextPanelBorderProperty,
      tandem: tandem.createTandem('backgroundRectangle')
    });

    // Create the body of the sensor
    const outlineImage = new Image(electricPotentialPanelOutline_png, {
      tandem: tandem.createTandem('outlineImage')
    });

    // Organize the content of the control panel
    const bodyContent = new VBox({
      spacing: 7,
      children: [electricPotentialPanelTitleText, backgroundRectangle, buttonsBox],
      pickable: true
    });

    /**
     * The voltage readout is updated according to the value of the electric potential
     * @param {number} electricPotential
     */
    function updateVoltageReadout(electricPotential) {
      voltageText.string = StringUtils.format(pattern0Value1UnitsString, decimalAdjust(electricPotential), voltageUnitString);
      voltageText.centerX = bodyContent.centerX;
    }

    // update text of the voltage readout according to the current value of the electric potential
    updateVoltageReadout(electricPotentialSensor.electricPotentialProperty.get());

    // Add the nodes to the body
    const bodyNode = new Node();
    bodyNode.addChild(outlineImage); // must go first
    bodyNode.addChild(bodyContent);
    bodyNode.addChild(voltageText); // must be last

    // layout the elements of bodyNode
    outlineImage.scale(1.55 * 73.6 / outlineImage.width);
    outlineImage.centerX = bodyContent.centerX;
    outlineImage.top = bodyContent.top - 15;
    voltageText.centerX = bodyContent.centerX;
    voltageText.centerY = backgroundRectangle.centerY;

    // the color of the fill tracks the electric potential
    function updateCircleFillWithPotential() {
      updateCircleFill(electricPotentialSensor.electricPotentialProperty.get());
    }
    ChargesAndFieldsColors.electricPotentialGridZeroProperty.link(updateCircleFillWithPotential);
    ChargesAndFieldsColors.electricPotentialGridSaturationPositiveProperty.link(updateCircleFillWithPotential);
    ChargesAndFieldsColors.electricPotentialGridSaturationNegativeProperty.link(updateCircleFillWithPotential);

    // Add the various components to this node
    this.addChild(crosshairMount);
    this.addChild(circle);
    this.addChild(crosshair);
    this.addChild(bodyNode);

    // layout elements
    crosshairMount.centerX = circle.centerX;
    crosshairMount.top = circle.bottom;
    bodyNode.centerX = crosshairMount.centerX;
    bodyNode.top = crosshairMount.bottom;

    // Register for synchronization with model.
    const positionListener = position => {
      this.translation = modelViewTransform.modelToViewPosition(position);
    };
    electricPotentialSensor.positionProperty.link(positionListener);

    // Update the value of the electric potential on the panel and the fill color on the crosshair
    const potentialListener = electricPotential => {
      // update the text of the voltage
      updateVoltageReadout(electricPotential);

      // the color fill inside the circle changes according to the value of the electric potential
      updateCircleFill(electricPotential);
    };
    electricPotentialSensor.electricPotentialProperty.link(potentialListener);

    // Should be added as a listener by our parent when the time is right
    this.dragListener = new DragListener({
      positionProperty: electricPotentialSensor.positionProperty,
      tandem: tandem.createTandem('dragListener'),
      dragBoundsProperty: availableModelBoundsProperty,
      transform: modelViewTransform,
      end: () => {
        snapToGridLines(electricPotentialSensor.positionProperty);
      }
    });
    this.dragListener.isUserControlledProperty.link(controlled => {
      this.isUserControlledProperty.value = controlled;
    });

    // When dragging, move the electric potential sensor
    this.addInputListener(this.dragListener);

    // Show/Hide this node
    // no need to unlink, stays for the lifetime of the simulation
    electricPotentialSensor.isActiveProperty.linkAttribute(this, 'visible');

    /**
     * The color fill inside the circle changes according to the value of the electric potential*
     * @param {number} electricPotential
     */
    function updateCircleFill(electricPotential) {
      circle.fill = getElectricPotentialColor(electricPotential, {
        transparency: 0.5
      });
    }

    /**
     * Returns a formatted string representing a number, rounded if necessary.
     * For -10 <= `number` <= 10, the returned string has a fixed number of decimal places
     * (determined by maxDecimalPlaces). For abs(number) > 10, the returned string is given a
     * number of significant figures at least equal to the number of decimal places.
     *
     * Example for maxDecimalPlaces = 3:
     * 9999.11 -> 9999  numbers larger than 10^maxDecimalPlaces are rounded to integers
     * 999.111 -> 999.1
     * 99.1111 -> 99.11
     * 9.11111 -> 9.111 numbers smaller than 10 have maxDecimalPlaces decimal places
     * 1.11111 -> 1.111
     * 0.11111 -> 0.111
     * 0.00111 -> 0.001
     * 0.00011 -> 0.000
     *
     * @param {number} number
     * @param {Object} [options]
     * @returns {string}
     */
    function decimalAdjust(number, options) {
      options = merge({
        maxDecimalPlaces: 3
      }, options);

      // let's find the exponent as in
      // number = mantissa times 10^(exponent) where the mantissa is between 1 and 10 (or -1 to -10)
      const absolute = Math.abs(number);
      const exponent = Math.floor(Math.log(absolute) / Math.log(10)); // Math.log10 using Math.log

      let decimalPlaces;
      if (exponent >= options.maxDecimalPlaces) {
        decimalPlaces = 0;
      } else if (exponent > 0) {
        decimalPlaces = options.maxDecimalPlaces - exponent;
      } else {
        decimalPlaces = options.maxDecimalPlaces;
      }
      return Utils.toFixed(number, decimalPlaces);
    }
    this.disposeElectricPotentialSensorNode = () => {
      electricPotentialSensor.positionProperty.unlink(positionListener);
      electricPotentialSensor.electricPotentialProperty.unlink(potentialListener);
      model.isPlayAreaChargedProperty.unlink(isPlayAreaChargedListener);
    };
  }

  /**
   * Releases references
   * @public
   */
  dispose() {
    this.disposeElectricPotentialSensorNode();
  }
}
chargesAndFields.register('ElectricPotentialSensorNode', ElectricPotentialSensorNode);
export default ElectricPotentialSensorNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIlV0aWxzIiwiU2hhcGUiLCJtZXJnZSIsIlN0cmluZ1V0aWxzIiwiRXJhc2VyQnV0dG9uIiwiQ2lyY2xlIiwiRHJhZ0xpc3RlbmVyIiwiSEJveCIsIkltYWdlIiwiTm9kZSIsIlBhdGgiLCJSZWN0YW5nbGUiLCJUZXh0IiwiVkJveCIsImVsZWN0cmljUG90ZW50aWFsUGFuZWxPdXRsaW5lX3BuZyIsImNoYXJnZXNBbmRGaWVsZHMiLCJDaGFyZ2VzQW5kRmllbGRzU3RyaW5ncyIsIkNoYXJnZXNBbmRGaWVsZHNDb2xvcnMiLCJDaGFyZ2VzQW5kRmllbGRzQ29uc3RhbnRzIiwiUGVuY2lsQnV0dG9uIiwiQ0lSQ0xFX1JBRElVUyIsImVxdWlwb3RlbnRpYWxTdHJpbmciLCJlcXVpcG90ZW50aWFsIiwicGF0dGVybjBWYWx1ZTFVbml0c1N0cmluZyIsInBhdHRlcm4iLCJ2b2x0YWdlVW5pdFN0cmluZyIsInZvbHRhZ2VVbml0IiwiRWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JOb2RlIiwiY29uc3RydWN0b3IiLCJtb2RlbCIsInNuYXBUb0dyaWRMaW5lcyIsImdldEVsZWN0cmljUG90ZW50aWFsQ29sb3IiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJhdmFpbGFibGVNb2RlbEJvdW5kc1Byb3BlcnR5IiwidGFuZGVtIiwiZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3IiLCJjdXJzb3IiLCJtb2RlbEVsZW1lbnQiLCJpc1VzZXJDb250cm9sbGVkUHJvcGVydHkiLCJjaXJjbGUiLCJsaW5lV2lkdGgiLCJjZW50ZXJYIiwiY2VudGVyWSIsInN0cm9rZSIsImVsZWN0cmljUG90ZW50aWFsU2Vuc29yQ2lyY2xlU3Ryb2tlUHJvcGVydHkiLCJjcmVhdGVUYW5kZW0iLCJjcm9zc2hhaXJTaGFwZSIsIm1vdmVUbyIsImxpbmVUbyIsImNyb3NzaGFpciIsImVsZWN0cmljUG90ZW50aWFsU2Vuc29yQ3Jvc3NoYWlyU3Ryb2tlUHJvcGVydHkiLCJjcm9zc2hhaXJNb3VudCIsImZpbGwiLCJlbGVjdHJpY1BvdGVudGlhbFBhbmVsVGl0bGVUZXh0IiwibWF4V2lkdGgiLCJmb250IiwiREVGQVVMVF9GT05UIiwiZWxlY3RyaWNQb3RlbnRpYWxQYW5lbFRpdGxlVGV4dFByb3BlcnR5IiwiY2xlYXJCdXR0b24iLCJiYXNlQ29sb3IiLCJpY29uV2lkdGgiLCJsaXN0ZW5lciIsImNsZWFyRWxlY3RyaWNQb3RlbnRpYWxMaW5lcyIsInBsb3RFbGVjdHJpY1BvdGVudGlhbExpbmVCdXR0b24iLCJhZGRFbGVjdHJpY1BvdGVudGlhbExpbmUiLCJwb3NpdGlvblByb3BlcnR5IiwiZ2V0IiwiaXNQbGF5QXJlYUNoYXJnZWRMaXN0ZW5lciIsImNoYXJnZWQiLCJlbmFibGVkIiwiaXNQbGF5QXJlYUNoYXJnZWRQcm9wZXJ0eSIsImxpbmsiLCJkb05vdFN0YXJ0RHJhZ0xpc3RlbmVyIiwiZG93biIsImV2ZW50IiwiaGFuZGxlIiwiYWRkSW5wdXRMaXN0ZW5lciIsInZvbHRhZ2VUZXh0IiwiZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JUZXh0UGFuZWxUZXh0RmlsbFByb3BlcnR5IiwiYnV0dG9uc0JveCIsInNwYWNpbmciLCJjaGlsZHJlbiIsInBpY2thYmxlIiwic2NhbGUiLCJiYWNrZ3JvdW5kQWRqdXN0bWVudCIsImJhY2tncm91bmRSZWN0YW5nbGUiLCJ3aWR0aCIsImhlaWdodCIsImVsZWN0cmljUG90ZW50aWFsU2Vuc29yVGV4dFBhbmVsQmFja2dyb3VuZFByb3BlcnR5IiwiZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JUZXh0UGFuZWxCb3JkZXJQcm9wZXJ0eSIsIm91dGxpbmVJbWFnZSIsImJvZHlDb250ZW50IiwidXBkYXRlVm9sdGFnZVJlYWRvdXQiLCJlbGVjdHJpY1BvdGVudGlhbCIsInN0cmluZyIsImZvcm1hdCIsImRlY2ltYWxBZGp1c3QiLCJlbGVjdHJpY1BvdGVudGlhbFByb3BlcnR5IiwiYm9keU5vZGUiLCJhZGRDaGlsZCIsInRvcCIsInVwZGF0ZUNpcmNsZUZpbGxXaXRoUG90ZW50aWFsIiwidXBkYXRlQ2lyY2xlRmlsbCIsImVsZWN0cmljUG90ZW50aWFsR3JpZFplcm9Qcm9wZXJ0eSIsImVsZWN0cmljUG90ZW50aWFsR3JpZFNhdHVyYXRpb25Qb3NpdGl2ZVByb3BlcnR5IiwiZWxlY3RyaWNQb3RlbnRpYWxHcmlkU2F0dXJhdGlvbk5lZ2F0aXZlUHJvcGVydHkiLCJib3R0b20iLCJwb3NpdGlvbkxpc3RlbmVyIiwicG9zaXRpb24iLCJ0cmFuc2xhdGlvbiIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJwb3RlbnRpYWxMaXN0ZW5lciIsImRyYWdMaXN0ZW5lciIsImRyYWdCb3VuZHNQcm9wZXJ0eSIsInRyYW5zZm9ybSIsImVuZCIsImNvbnRyb2xsZWQiLCJ2YWx1ZSIsImlzQWN0aXZlUHJvcGVydHkiLCJsaW5rQXR0cmlidXRlIiwidHJhbnNwYXJlbmN5IiwibnVtYmVyIiwib3B0aW9ucyIsIm1heERlY2ltYWxQbGFjZXMiLCJhYnNvbHV0ZSIsIk1hdGgiLCJhYnMiLCJleHBvbmVudCIsImZsb29yIiwibG9nIiwiZGVjaW1hbFBsYWNlcyIsInRvRml4ZWQiLCJkaXNwb3NlRWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JOb2RlIiwidW5saW5rIiwiZGlzcG9zZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFZpZXcgZm9yIHRoZSBFbGVjdHJpY1BvdGVudGlhbFNlbnNvck5vZGUgd2hpY2ggcmVuZGVycyB0aGUgc2Vuc29yIGFzIGEgc2NlbmVyeSBub2RlLlxyXG4gKiBUaGUgc2Vuc29yIGlzIGRyYWdnYWJsZSwgaGFzIGEgcmVhZG91dCBvZiB0aGUgZWxlY3RyaWMgcG90ZW50aWFsICh0aGF0IG1hdGNoZXMgdGhlXHJcbiAqIGVsZWN0cmljIHBvdGVudGlhbCBhdCB0aGUgY3Jvc3NoYWlyIHBvc2l0aW9uKS4gVGhlIGVsZWN0cmljIHBvdGVudGlhbCBzZW5zb3IgaGFzIHR3b1xyXG4gKiBwdXNoIGJ1dHRvbnM6IE9uZSBvZiB0aGVtIHNlbmQgYSBjYWxsYmFjayB0aGF0IGNyZWF0ZXMgYW4gZWxlY3RyaWMgcG90ZW50aWFsIGxpbmUgd2hlcmVhc1xyXG4gKiB0aGUgc2Vjb25kIHB1c2ggYnV0dG9ucyBkZWxldGVzIGFsbCB0aGUgZWxlY3RyaWMgcG90ZW50aWFsIGxpbmVzIG9uIHRoZSBib2FyZC5cclxuICpcclxuICogQGF1dGhvciBNYXJ0aW4gVmVpbGxldHRlIChCZXJlYSBDb2xsZWdlKVxyXG4gKi9cclxuXHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBTdHJpbmdVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3V0aWwvU3RyaW5nVXRpbHMuanMnO1xyXG5pbXBvcnQgRXJhc2VyQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL0VyYXNlckJ1dHRvbi5qcyc7XHJcbmltcG9ydCB7IENpcmNsZSwgRHJhZ0xpc3RlbmVyLCBIQm94LCBJbWFnZSwgTm9kZSwgUGF0aCwgUmVjdGFuZ2xlLCBUZXh0LCBWQm94IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGVsZWN0cmljUG90ZW50aWFsUGFuZWxPdXRsaW5lX3BuZyBmcm9tICcuLi8uLi8uLi9taXBtYXBzL2VsZWN0cmljUG90ZW50aWFsUGFuZWxPdXRsaW5lX3BuZy5qcyc7XHJcbmltcG9ydCBjaGFyZ2VzQW5kRmllbGRzIGZyb20gJy4uLy4uL2NoYXJnZXNBbmRGaWVsZHMuanMnO1xyXG5pbXBvcnQgQ2hhcmdlc0FuZEZpZWxkc1N0cmluZ3MgZnJvbSAnLi4vLi4vQ2hhcmdlc0FuZEZpZWxkc1N0cmluZ3MuanMnO1xyXG5pbXBvcnQgQ2hhcmdlc0FuZEZpZWxkc0NvbG9ycyBmcm9tICcuLi9DaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmpzJztcclxuaW1wb3J0IENoYXJnZXNBbmRGaWVsZHNDb25zdGFudHMgZnJvbSAnLi4vQ2hhcmdlc0FuZEZpZWxkc0NvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBQZW5jaWxCdXR0b24gZnJvbSAnLi9QZW5jaWxCdXR0b24uanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IENJUkNMRV9SQURJVVMgPSAxODsgLy8gcmFkaXVzIG9mIHRoZSBjaXJjbGUgYXJvdW5kIHRoZSBjcm9zc2hhaXJcclxuXHJcbmNvbnN0IGVxdWlwb3RlbnRpYWxTdHJpbmcgPSBDaGFyZ2VzQW5kRmllbGRzU3RyaW5ncy5lcXVpcG90ZW50aWFsO1xyXG5jb25zdCBwYXR0ZXJuMFZhbHVlMVVuaXRzU3RyaW5nID0gQ2hhcmdlc0FuZEZpZWxkc1N0cmluZ3MucGF0dGVyblsgJzB2YWx1ZScgXVsgJzF1bml0cycgXTtcclxuY29uc3Qgdm9sdGFnZVVuaXRTdHJpbmcgPSBDaGFyZ2VzQW5kRmllbGRzU3RyaW5ncy52b2x0YWdlVW5pdDtcclxuXHJcblxyXG5jbGFzcyBFbGVjdHJpY1BvdGVudGlhbFNlbnNvck5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuICAvKipcclxuICAgKiBUT0RPOiB0aGlzIGludGVyZmFjZSBpcyB1bndpZWxkeSBhbmQgZGlmZmljdWx0IHRvIG5hdmlnYXRlLiAgV2h5IG5vdCBwYXNzIHRoZSBtb2RlbCB3aXRoIGFsbCB0aGVzZSBmdW5jdGlvbnM/XHJcbiAgICogQHBhcmFtIHtDaGFyZ2VzQW5kRmllbGRzTW9kZWx9IG1vZGVsXHJcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gc25hcFRvR3JpZExpbmVzIC0gQSBGdW5jdGlvbiB0aGF0IHNuYXAgdGhlIHBvc2l0aW9uIHRvIHRoZSBtaW5vciBncmlkbGluZXMuXHJcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZ2V0RWxlY3RyaWNQb3RlbnRpYWxDb2xvciAtIEEgZnVuY3Rpb24gdGhhdCBtYXBzIGEgdmFsdWUgb2YgdGhlIGVsZWN0cmljIHBvdGVudGlhbCB0byBhIGNvbG9yXHJcbiAgICogQHBhcmFtIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfSBtb2RlbFZpZXdUcmFuc2Zvcm0gLSB0aGUgY29vcmRpbmF0ZSB0cmFuc2Zvcm0gYmV0d2VlbiBtb2RlbCBjb29yZGluYXRlcyBhbmQgdmlldyBjb29yZGluYXRlc1xyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPEJvdW5kczI+fSBhdmFpbGFibGVNb2RlbEJvdW5kc1Byb3BlcnR5IC0gZHJhZyBib3VuZHMgaW4gbW9kZWwgY29vcmRpbmF0ZXMgZm9yIHRoZSBlbGVjdHJpYyBwb3RlbnRpYWwgc2Vuc29yIG5vZGVcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1vZGVsLFxyXG4gICAgICAgICAgICAgICBzbmFwVG9HcmlkTGluZXMsXHJcbiAgICAgICAgICAgICAgIGdldEVsZWN0cmljUG90ZW50aWFsQ29sb3IsXHJcbiAgICAgICAgICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgICAgICAgICAgYXZhaWxhYmxlTW9kZWxCb3VuZHNQcm9wZXJ0eSxcclxuICAgICAgICAgICAgICAgdGFuZGVtICkge1xyXG5cclxuICAgIGNvbnN0IGVsZWN0cmljUG90ZW50aWFsU2Vuc29yID0gbW9kZWwuZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3I7XHJcblxyXG4gICAgc3VwZXIoIHtcclxuICAgICAgY3Vyc29yOiAncG9pbnRlcicsIC8vIFNob3cgYSBjdXJzb3IgaGFuZCBvdmVyIHRoZSBzZW5zb3JcclxuICAgICAgdGFuZGVtOiB0YW5kZW1cclxuICAgIH0gKTtcclxuICAgIHRoaXMubW9kZWxFbGVtZW50ID0gZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3I7IC8vIEBwdWJsaWMgKHJlYWQtb25seSlcclxuXHJcbiAgICAvLyBAcHVibGljXHJcbiAgICB0aGlzLmlzVXNlckNvbnRyb2xsZWRQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggZmFsc2UgKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIGNlbnRlcmVkIGNpcmNsZSBhcm91bmQgdGhlIGNyb3NzaGFpci4gVGhlIG9yaWdpbiBvZiB0aGlzIG5vZGUgaXMgdGhlIGNlbnRlciBvZiB0aGUgY2lyY2xlXHJcbiAgICBjb25zdCBjaXJjbGUgPSBuZXcgQ2lyY2xlKCBDSVJDTEVfUkFESVVTLCB7XHJcbiAgICAgIGxpbmVXaWR0aDogMyxcclxuICAgICAgY2VudGVyWDogMCxcclxuICAgICAgY2VudGVyWTogMCxcclxuICAgICAgc3Ryb2tlOiBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmVsZWN0cmljUG90ZW50aWFsU2Vuc29yQ2lyY2xlU3Ryb2tlUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NpcmNsZScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgY3Jvc3NoYWlyXHJcbiAgICBjb25zdCBjcm9zc2hhaXJTaGFwZSA9IG5ldyBTaGFwZSgpLm1vdmVUbyggLUNJUkNMRV9SQURJVVMsIDAgKVxyXG4gICAgICAubGluZVRvKCBDSVJDTEVfUkFESVVTLCAwIClcclxuICAgICAgLm1vdmVUbyggMCwgLUNJUkNMRV9SQURJVVMgKVxyXG4gICAgICAubGluZVRvKCAwLCBDSVJDTEVfUkFESVVTICk7XHJcbiAgICBjb25zdCBjcm9zc2hhaXIgPSBuZXcgUGF0aCggY3Jvc3NoYWlyU2hhcGUsIHtcclxuICAgICAgY2VudGVyWDogMCxcclxuICAgICAgY2VudGVyWTogMCxcclxuICAgICAgc3Ryb2tlOiBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmVsZWN0cmljUG90ZW50aWFsU2Vuc29yQ3Jvc3NoYWlyU3Ryb2tlUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2Nyb3NzaGFpcicgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgYmFzZSBvZiB0aGUgY3Jvc3NoYWlyXHJcbiAgICAvLyBUT0RPOiB3aHkgYXJlIHRoZSBmaWxsIGFuZCBzdHJva2Ugc2V0IHRvIHRoZSBzYW1lIHRoaW5nP1xyXG4gICAgY29uc3QgY3Jvc3NoYWlyTW91bnQgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCAwLjQgKiBDSVJDTEVfUkFESVVTLCAwLjQgKiBDSVJDTEVfUkFESVVTLCB7XHJcbiAgICAgIGZpbGw6IENoYXJnZXNBbmRGaWVsZHNDb2xvcnMuZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JDcm9zc2hhaXJTdHJva2VQcm9wZXJ0eSxcclxuICAgICAgc3Ryb2tlOiBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmVsZWN0cmljUG90ZW50aWFsU2Vuc29yQ3Jvc3NoYWlyU3Ryb2tlUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2Nyb3NzaGFpck1vdW50JyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSB0ZXh0IG5vZGUgYWJvdmUgdGhlIHJlYWRvdXRcclxuICAgIGNvbnN0IGVsZWN0cmljUG90ZW50aWFsUGFuZWxUaXRsZVRleHQgPSBuZXcgVGV4dCggZXF1aXBvdGVudGlhbFN0cmluZywge1xyXG4gICAgICBtYXhXaWR0aDogODUsXHJcbiAgICAgIGZvbnQ6IENoYXJnZXNBbmRGaWVsZHNDb25zdGFudHMuREVGQVVMVF9GT05ULFxyXG4gICAgICBmaWxsOiBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmVsZWN0cmljUG90ZW50aWFsUGFuZWxUaXRsZVRleHRQcm9wZXJ0eSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZWxlY3RyaWNQb3RlbnRpYWxQYW5lbFRpdGxlVGV4dCcgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgYnV0dG9uIHRoYXQgYWxsb3dzIHRoZSBib2FyZCB0byBiZSBjbGVhcmVkIG9mIGFsbCBsaW5lcy5cclxuICAgIGNvbnN0IGNsZWFyQnV0dG9uID0gbmV3IEVyYXNlckJ1dHRvbigge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdjbGVhckJ1dHRvbicgKSxcclxuICAgICAgYmFzZUNvbG9yOiAnI2YyZjJmMicsXHJcbiAgICAgIGljb25XaWR0aDogMjMsXHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiBtb2RlbC5jbGVhckVsZWN0cmljUG90ZW50aWFsTGluZXMoKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgYnV0dG9uIHRoYXQgYWxsb3dzIHRvIHBsb3QgdGhlIEVsZWN0cmljUG90ZW50aWFsIExpbmVzXHJcbiAgICBjb25zdCBwbG90RWxlY3RyaWNQb3RlbnRpYWxMaW5lQnV0dG9uID0gbmV3IFBlbmNpbEJ1dHRvbiggdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Bsb3RFbGVjdHJpY1BvdGVudGlhbExpbmVCdXR0b24nICksIHtcclxuICAgICAgYmFzZUNvbG9yOiAnI2YyZjJmMicsXHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiBtb2RlbC5hZGRFbGVjdHJpY1BvdGVudGlhbExpbmUoIGVsZWN0cmljUG90ZW50aWFsU2Vuc29yLnBvc2l0aW9uUHJvcGVydHkuZ2V0KCkgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGlzUGxheUFyZWFDaGFyZ2VkTGlzdGVuZXIgPSBjaGFyZ2VkID0+IHtcclxuICAgICAgcGxvdEVsZWN0cmljUG90ZW50aWFsTGluZUJ1dHRvbi5lbmFibGVkID0gY2hhcmdlZDtcclxuICAgIH07XHJcbiAgICBtb2RlbC5pc1BsYXlBcmVhQ2hhcmdlZFByb3BlcnR5LmxpbmsoIGlzUGxheUFyZWFDaGFyZ2VkTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBTZWUgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jaGFyZ2VzLWFuZC1maWVsZHMvaXNzdWVzLzczXHJcbiAgICBjb25zdCBkb05vdFN0YXJ0RHJhZ0xpc3RlbmVyID0ge1xyXG4gICAgICBkb3duOiBldmVudCA9PiBldmVudC5oYW5kbGUoKVxyXG4gICAgfTtcclxuICAgIGNsZWFyQnV0dG9uLmFkZElucHV0TGlzdGVuZXIoIGRvTm90U3RhcnREcmFnTGlzdGVuZXIgKTtcclxuICAgIHBsb3RFbGVjdHJpY1BvdGVudGlhbExpbmVCdXR0b24uYWRkSW5wdXRMaXN0ZW5lciggZG9Ob3RTdGFydERyYWdMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgdm9sdGFnZSByZWFkb3V0XHJcbiAgICBjb25zdCB2b2x0YWdlVGV4dCA9IG5ldyBUZXh0KCAnJywge1xyXG4gICAgICBtYXhXaWR0aDogNjUsXHJcbiAgICAgIGZvbnQ6IENoYXJnZXNBbmRGaWVsZHNDb25zdGFudHMuREVGQVVMVF9GT05ULFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd2b2x0YWdlVGV4dCcgKSxcclxuICAgICAgZmlsbDogQ2hhcmdlc0FuZEZpZWxkc0NvbG9ycy5lbGVjdHJpY1BvdGVudGlhbFNlbnNvclRleHRQYW5lbFRleHRGaWxsUHJvcGVydHlcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBUaGUgY2xlYXIgYW5kIHBsb3QgYnV0dG9uc1xyXG4gICAgY29uc3QgYnV0dG9uc0JveCA9IG5ldyBIQm94KCB7XHJcbiAgICAgIHNwYWNpbmc6IDEwLFxyXG4gICAgICBjaGlsZHJlbjogWyBjbGVhckJ1dHRvbiwgcGxvdEVsZWN0cmljUG90ZW50aWFsTGluZUJ1dHRvbiBdLFxyXG4gICAgICBwaWNrYWJsZTogdHJ1ZSxcclxuICAgICAgc2NhbGU6IDAuOFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgYmFja2dyb3VuZCByZWN0YW5nbGUgYmVoaW5kIHRoZSB2b2x0YWdlIFJlYWRpbmdcclxuICAgIGNvbnN0IGJhY2tncm91bmRBZGp1c3RtZW50ID0gMDtcclxuICAgIGNvbnN0IGJhY2tncm91bmRSZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKFxyXG4gICAgICBiYWNrZ3JvdW5kQWRqdXN0bWVudCxcclxuICAgICAgMCxcclxuICAgICAgYnV0dG9uc0JveC53aWR0aCAtIGJhY2tncm91bmRBZGp1c3RtZW50ICogMixcclxuICAgICAgdm9sdGFnZVRleHQuaGVpZ2h0ICogMS41LCA1LCA1LCB7XHJcbiAgICAgICAgZmlsbDogQ2hhcmdlc0FuZEZpZWxkc0NvbG9ycy5lbGVjdHJpY1BvdGVudGlhbFNlbnNvclRleHRQYW5lbEJhY2tncm91bmRQcm9wZXJ0eSxcclxuICAgICAgICBzdHJva2U6IENoYXJnZXNBbmRGaWVsZHNDb2xvcnMuZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JUZXh0UGFuZWxCb3JkZXJQcm9wZXJ0eSxcclxuICAgICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdiYWNrZ3JvdW5kUmVjdGFuZ2xlJyApXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIGJvZHkgb2YgdGhlIHNlbnNvclxyXG4gICAgY29uc3Qgb3V0bGluZUltYWdlID0gbmV3IEltYWdlKCBlbGVjdHJpY1BvdGVudGlhbFBhbmVsT3V0bGluZV9wbmcsIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnb3V0bGluZUltYWdlJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gT3JnYW5pemUgdGhlIGNvbnRlbnQgb2YgdGhlIGNvbnRyb2wgcGFuZWxcclxuICAgIGNvbnN0IGJvZHlDb250ZW50ID0gbmV3IFZCb3goIHtcclxuICAgICAgc3BhY2luZzogNyxcclxuICAgICAgY2hpbGRyZW46IFsgZWxlY3RyaWNQb3RlbnRpYWxQYW5lbFRpdGxlVGV4dCwgYmFja2dyb3VuZFJlY3RhbmdsZSwgYnV0dG9uc0JveCBdLFxyXG4gICAgICBwaWNrYWJsZTogdHJ1ZVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogVGhlIHZvbHRhZ2UgcmVhZG91dCBpcyB1cGRhdGVkIGFjY29yZGluZyB0byB0aGUgdmFsdWUgb2YgdGhlIGVsZWN0cmljIHBvdGVudGlhbFxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGVsZWN0cmljUG90ZW50aWFsXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIHVwZGF0ZVZvbHRhZ2VSZWFkb3V0KCBlbGVjdHJpY1BvdGVudGlhbCApIHtcclxuICAgICAgdm9sdGFnZVRleHQuc3RyaW5nID0gU3RyaW5nVXRpbHMuZm9ybWF0KCBwYXR0ZXJuMFZhbHVlMVVuaXRzU3RyaW5nLCBkZWNpbWFsQWRqdXN0KCBlbGVjdHJpY1BvdGVudGlhbCApLCB2b2x0YWdlVW5pdFN0cmluZyApO1xyXG4gICAgICB2b2x0YWdlVGV4dC5jZW50ZXJYID0gYm9keUNvbnRlbnQuY2VudGVyWDtcclxuICAgIH1cclxuXHJcbiAgICAvLyB1cGRhdGUgdGV4dCBvZiB0aGUgdm9sdGFnZSByZWFkb3V0IGFjY29yZGluZyB0byB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgZWxlY3RyaWMgcG90ZW50aWFsXHJcbiAgICB1cGRhdGVWb2x0YWdlUmVhZG91dCggZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3IuZWxlY3RyaWNQb3RlbnRpYWxQcm9wZXJ0eS5nZXQoKSApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgbm9kZXMgdG8gdGhlIGJvZHlcclxuICAgIGNvbnN0IGJvZHlOb2RlID0gbmV3IE5vZGUoKTtcclxuICAgIGJvZHlOb2RlLmFkZENoaWxkKCBvdXRsaW5lSW1hZ2UgKTsgLy8gbXVzdCBnbyBmaXJzdFxyXG4gICAgYm9keU5vZGUuYWRkQ2hpbGQoIGJvZHlDb250ZW50ICk7XHJcbiAgICBib2R5Tm9kZS5hZGRDaGlsZCggdm9sdGFnZVRleHQgKTsgLy8gbXVzdCBiZSBsYXN0XHJcblxyXG4gICAgLy8gbGF5b3V0IHRoZSBlbGVtZW50cyBvZiBib2R5Tm9kZVxyXG4gICAgb3V0bGluZUltYWdlLnNjYWxlKCAxLjU1ICogNzMuNiAvIG91dGxpbmVJbWFnZS53aWR0aCApO1xyXG4gICAgb3V0bGluZUltYWdlLmNlbnRlclggPSBib2R5Q29udGVudC5jZW50ZXJYO1xyXG4gICAgb3V0bGluZUltYWdlLnRvcCA9IGJvZHlDb250ZW50LnRvcCAtIDE1O1xyXG4gICAgdm9sdGFnZVRleHQuY2VudGVyWCA9IGJvZHlDb250ZW50LmNlbnRlclg7XHJcbiAgICB2b2x0YWdlVGV4dC5jZW50ZXJZID0gYmFja2dyb3VuZFJlY3RhbmdsZS5jZW50ZXJZO1xyXG5cclxuICAgIC8vIHRoZSBjb2xvciBvZiB0aGUgZmlsbCB0cmFja3MgdGhlIGVsZWN0cmljIHBvdGVudGlhbFxyXG4gICAgZnVuY3Rpb24gdXBkYXRlQ2lyY2xlRmlsbFdpdGhQb3RlbnRpYWwoKSB7XHJcbiAgICAgIHVwZGF0ZUNpcmNsZUZpbGwoIGVsZWN0cmljUG90ZW50aWFsU2Vuc29yLmVsZWN0cmljUG90ZW50aWFsUHJvcGVydHkuZ2V0KCkgKTtcclxuICAgIH1cclxuXHJcbiAgICBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmVsZWN0cmljUG90ZW50aWFsR3JpZFplcm9Qcm9wZXJ0eS5saW5rKCB1cGRhdGVDaXJjbGVGaWxsV2l0aFBvdGVudGlhbCApO1xyXG4gICAgQ2hhcmdlc0FuZEZpZWxkc0NvbG9ycy5lbGVjdHJpY1BvdGVudGlhbEdyaWRTYXR1cmF0aW9uUG9zaXRpdmVQcm9wZXJ0eS5saW5rKCB1cGRhdGVDaXJjbGVGaWxsV2l0aFBvdGVudGlhbCApO1xyXG4gICAgQ2hhcmdlc0FuZEZpZWxkc0NvbG9ycy5lbGVjdHJpY1BvdGVudGlhbEdyaWRTYXR1cmF0aW9uTmVnYXRpdmVQcm9wZXJ0eS5saW5rKCB1cGRhdGVDaXJjbGVGaWxsV2l0aFBvdGVudGlhbCApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgdmFyaW91cyBjb21wb25lbnRzIHRvIHRoaXMgbm9kZVxyXG4gICAgdGhpcy5hZGRDaGlsZCggY3Jvc3NoYWlyTW91bnQgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGNpcmNsZSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggY3Jvc3NoYWlyICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBib2R5Tm9kZSApO1xyXG5cclxuICAgIC8vIGxheW91dCBlbGVtZW50c1xyXG4gICAgY3Jvc3NoYWlyTW91bnQuY2VudGVyWCA9IGNpcmNsZS5jZW50ZXJYO1xyXG4gICAgY3Jvc3NoYWlyTW91bnQudG9wID0gY2lyY2xlLmJvdHRvbTtcclxuICAgIGJvZHlOb2RlLmNlbnRlclggPSBjcm9zc2hhaXJNb3VudC5jZW50ZXJYO1xyXG4gICAgYm9keU5vZGUudG9wID0gY3Jvc3NoYWlyTW91bnQuYm90dG9tO1xyXG5cclxuICAgIC8vIFJlZ2lzdGVyIGZvciBzeW5jaHJvbml6YXRpb24gd2l0aCBtb2RlbC5cclxuICAgIGNvbnN0IHBvc2l0aW9uTGlzdGVuZXIgPSBwb3NpdGlvbiA9PiB7XHJcbiAgICAgIHRoaXMudHJhbnNsYXRpb24gPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggcG9zaXRpb24gKTtcclxuICAgIH07XHJcbiAgICBlbGVjdHJpY1BvdGVudGlhbFNlbnNvci5wb3NpdGlvblByb3BlcnR5LmxpbmsoIHBvc2l0aW9uTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBVcGRhdGUgdGhlIHZhbHVlIG9mIHRoZSBlbGVjdHJpYyBwb3RlbnRpYWwgb24gdGhlIHBhbmVsIGFuZCB0aGUgZmlsbCBjb2xvciBvbiB0aGUgY3Jvc3NoYWlyXHJcbiAgICBjb25zdCBwb3RlbnRpYWxMaXN0ZW5lciA9IGVsZWN0cmljUG90ZW50aWFsID0+IHtcclxuXHJcbiAgICAgIC8vIHVwZGF0ZSB0aGUgdGV4dCBvZiB0aGUgdm9sdGFnZVxyXG4gICAgICB1cGRhdGVWb2x0YWdlUmVhZG91dCggZWxlY3RyaWNQb3RlbnRpYWwgKTtcclxuXHJcbiAgICAgIC8vIHRoZSBjb2xvciBmaWxsIGluc2lkZSB0aGUgY2lyY2xlIGNoYW5nZXMgYWNjb3JkaW5nIHRvIHRoZSB2YWx1ZSBvZiB0aGUgZWxlY3RyaWMgcG90ZW50aWFsXHJcbiAgICAgIHVwZGF0ZUNpcmNsZUZpbGwoIGVsZWN0cmljUG90ZW50aWFsICk7XHJcbiAgICB9O1xyXG4gICAgZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3IuZWxlY3RyaWNQb3RlbnRpYWxQcm9wZXJ0eS5saW5rKCBwb3RlbnRpYWxMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIFNob3VsZCBiZSBhZGRlZCBhcyBhIGxpc3RlbmVyIGJ5IG91ciBwYXJlbnQgd2hlbiB0aGUgdGltZSBpcyByaWdodFxyXG4gICAgdGhpcy5kcmFnTGlzdGVuZXIgPSBuZXcgRHJhZ0xpc3RlbmVyKCB7XHJcbiAgICAgIHBvc2l0aW9uUHJvcGVydHk6IGVsZWN0cmljUG90ZW50aWFsU2Vuc29yLnBvc2l0aW9uUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RyYWdMaXN0ZW5lcicgKSxcclxuICAgICAgZHJhZ0JvdW5kc1Byb3BlcnR5OiBhdmFpbGFibGVNb2RlbEJvdW5kc1Byb3BlcnR5LFxyXG4gICAgICB0cmFuc2Zvcm06IG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgZW5kOiAoKSA9PiB7XHJcbiAgICAgICAgc25hcFRvR3JpZExpbmVzKCBlbGVjdHJpY1BvdGVudGlhbFNlbnNvci5wb3NpdGlvblByb3BlcnR5ICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIHRoaXMuZHJhZ0xpc3RlbmVyLmlzVXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5saW5rKCBjb250cm9sbGVkID0+IHtcclxuICAgICAgdGhpcy5pc1VzZXJDb250cm9sbGVkUHJvcGVydHkudmFsdWUgPSBjb250cm9sbGVkO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFdoZW4gZHJhZ2dpbmcsIG1vdmUgdGhlIGVsZWN0cmljIHBvdGVudGlhbCBzZW5zb3JcclxuICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggdGhpcy5kcmFnTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBTaG93L0hpZGUgdGhpcyBub2RlXHJcbiAgICAvLyBubyBuZWVkIHRvIHVubGluaywgc3RheXMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltdWxhdGlvblxyXG4gICAgZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3IuaXNBY3RpdmVQcm9wZXJ0eS5saW5rQXR0cmlidXRlKCB0aGlzLCAndmlzaWJsZScgKTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFRoZSBjb2xvciBmaWxsIGluc2lkZSB0aGUgY2lyY2xlIGNoYW5nZXMgYWNjb3JkaW5nIHRvIHRoZSB2YWx1ZSBvZiB0aGUgZWxlY3RyaWMgcG90ZW50aWFsKlxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGVsZWN0cmljUG90ZW50aWFsXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIHVwZGF0ZUNpcmNsZUZpbGwoIGVsZWN0cmljUG90ZW50aWFsICkge1xyXG4gICAgICBjaXJjbGUuZmlsbCA9IGdldEVsZWN0cmljUG90ZW50aWFsQ29sb3IoIGVsZWN0cmljUG90ZW50aWFsLCB7IHRyYW5zcGFyZW5jeTogMC41IH0gKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgYSBmb3JtYXR0ZWQgc3RyaW5nIHJlcHJlc2VudGluZyBhIG51bWJlciwgcm91bmRlZCBpZiBuZWNlc3NhcnkuXHJcbiAgICAgKiBGb3IgLTEwIDw9IGBudW1iZXJgIDw9IDEwLCB0aGUgcmV0dXJuZWQgc3RyaW5nIGhhcyBhIGZpeGVkIG51bWJlciBvZiBkZWNpbWFsIHBsYWNlc1xyXG4gICAgICogKGRldGVybWluZWQgYnkgbWF4RGVjaW1hbFBsYWNlcykuIEZvciBhYnMobnVtYmVyKSA+IDEwLCB0aGUgcmV0dXJuZWQgc3RyaW5nIGlzIGdpdmVuIGFcclxuICAgICAqIG51bWJlciBvZiBzaWduaWZpY2FudCBmaWd1cmVzIGF0IGxlYXN0IGVxdWFsIHRvIHRoZSBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMuXHJcbiAgICAgKlxyXG4gICAgICogRXhhbXBsZSBmb3IgbWF4RGVjaW1hbFBsYWNlcyA9IDM6XHJcbiAgICAgKiA5OTk5LjExIC0+IDk5OTkgIG51bWJlcnMgbGFyZ2VyIHRoYW4gMTBebWF4RGVjaW1hbFBsYWNlcyBhcmUgcm91bmRlZCB0byBpbnRlZ2Vyc1xyXG4gICAgICogOTk5LjExMSAtPiA5OTkuMVxyXG4gICAgICogOTkuMTExMSAtPiA5OS4xMVxyXG4gICAgICogOS4xMTExMSAtPiA5LjExMSBudW1iZXJzIHNtYWxsZXIgdGhhbiAxMCBoYXZlIG1heERlY2ltYWxQbGFjZXMgZGVjaW1hbCBwbGFjZXNcclxuICAgICAqIDEuMTExMTEgLT4gMS4xMTFcclxuICAgICAqIDAuMTExMTEgLT4gMC4xMTFcclxuICAgICAqIDAuMDAxMTEgLT4gMC4wMDFcclxuICAgICAqIDAuMDAwMTEgLT4gMC4wMDBcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gbnVtYmVyXHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBkZWNpbWFsQWRqdXN0KCBudW1iZXIsIG9wdGlvbnMgKSB7XHJcbiAgICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG4gICAgICAgIG1heERlY2ltYWxQbGFjZXM6IDNcclxuICAgICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgICAgLy8gbGV0J3MgZmluZCB0aGUgZXhwb25lbnQgYXMgaW5cclxuICAgICAgLy8gbnVtYmVyID0gbWFudGlzc2EgdGltZXMgMTBeKGV4cG9uZW50KSB3aGVyZSB0aGUgbWFudGlzc2EgaXMgYmV0d2VlbiAxIGFuZCAxMCAob3IgLTEgdG8gLTEwKVxyXG4gICAgICBjb25zdCBhYnNvbHV0ZSA9IE1hdGguYWJzKCBudW1iZXIgKTtcclxuICAgICAgY29uc3QgZXhwb25lbnQgPSBNYXRoLmZsb29yKCBNYXRoLmxvZyggYWJzb2x1dGUgKSAvIE1hdGgubG9nKCAxMCApICk7IC8vIE1hdGgubG9nMTAgdXNpbmcgTWF0aC5sb2dcclxuXHJcbiAgICAgIGxldCBkZWNpbWFsUGxhY2VzO1xyXG5cclxuICAgICAgaWYgKCBleHBvbmVudCA+PSBvcHRpb25zLm1heERlY2ltYWxQbGFjZXMgKSB7XHJcbiAgICAgICAgZGVjaW1hbFBsYWNlcyA9IDA7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIGV4cG9uZW50ID4gMCApIHtcclxuICAgICAgICBkZWNpbWFsUGxhY2VzID0gb3B0aW9ucy5tYXhEZWNpbWFsUGxhY2VzIC0gZXhwb25lbnQ7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgZGVjaW1hbFBsYWNlcyA9IG9wdGlvbnMubWF4RGVjaW1hbFBsYWNlcztcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIFV0aWxzLnRvRml4ZWQoIG51bWJlciwgZGVjaW1hbFBsYWNlcyApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZGlzcG9zZUVsZWN0cmljUG90ZW50aWFsU2Vuc29yTm9kZSA9ICgpID0+IHtcclxuICAgICAgZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3IucG9zaXRpb25Qcm9wZXJ0eS51bmxpbmsoIHBvc2l0aW9uTGlzdGVuZXIgKTtcclxuICAgICAgZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3IuZWxlY3RyaWNQb3RlbnRpYWxQcm9wZXJ0eS51bmxpbmsoIHBvdGVudGlhbExpc3RlbmVyICk7XHJcbiAgICAgIG1vZGVsLmlzUGxheUFyZWFDaGFyZ2VkUHJvcGVydHkudW5saW5rKCBpc1BsYXlBcmVhQ2hhcmdlZExpc3RlbmVyICk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVsZWFzZXMgcmVmZXJlbmNlc1xyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBkaXNwb3NlKCkge1xyXG4gICAgdGhpcy5kaXNwb3NlRWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JOb2RlKCk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuY2hhcmdlc0FuZEZpZWxkcy5yZWdpc3RlciggJ0VsZWN0cmljUG90ZW50aWFsU2Vuc29yTm9kZScsIEVsZWN0cmljUG90ZW50aWFsU2Vuc29yTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBFbGVjdHJpY1BvdGVudGlhbFNlbnNvck5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDdEQsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxPQUFPQyxXQUFXLE1BQU0sK0NBQStDO0FBQ3ZFLE9BQU9DLFlBQVksTUFBTSxxREFBcUQ7QUFDOUUsU0FBU0MsTUFBTSxFQUFFQyxZQUFZLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsU0FBUyxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDeEgsT0FBT0MsaUNBQWlDLE1BQU0sdURBQXVEO0FBQ3JHLE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxPQUFPQyx1QkFBdUIsTUFBTSxrQ0FBa0M7QUFDdEUsT0FBT0Msc0JBQXNCLE1BQU0sOEJBQThCO0FBQ2pFLE9BQU9DLHlCQUF5QixNQUFNLGlDQUFpQztBQUN2RSxPQUFPQyxZQUFZLE1BQU0sbUJBQW1COztBQUU1QztBQUNBLE1BQU1DLGFBQWEsR0FBRyxFQUFFLENBQUMsQ0FBQzs7QUFFMUIsTUFBTUMsbUJBQW1CLEdBQUdMLHVCQUF1QixDQUFD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