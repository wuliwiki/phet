// Copyright 2015-2022, University of Colorado Boulder

/**
 * Toolbox from which the user can drag (or otherwise enable) tools.
 * The toolbox includes a measuring tape and an electric potential sensor
 *
 * @author Martin Veillette (Berea College)
 */

import Property from '../../../../axon/js/Property.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Vector2Property from '../../../../dot/js/Vector2Property.js';
import { Shape } from '../../../../kite/js/imports.js';
import MeasuringTapeNode from '../../../../scenery-phet/js/MeasuringTapeNode.js';
import { Circle, Image, Node, Path, Rectangle, Text, VBox } from '../../../../scenery/js/imports.js';
import Panel from '../../../../sun/js/Panel.js';
import electricPotentialPanelOutline_png from '../../../mipmaps/electricPotentialPanelOutline_png.js';
import chargesAndFields from '../../chargesAndFields.js';
import ChargesAndFieldsStrings from '../../ChargesAndFieldsStrings.js';
import ChargesAndFieldsColors from '../ChargesAndFieldsColors.js';
import ChargesAndFieldsConstants from '../ChargesAndFieldsConstants.js';

// constants
const CIRCLE_RADIUS = 10; // radius of the circle around the crosshair

const voltageUnitString = ChargesAndFieldsStrings.voltageUnit;
class ChargesAndFieldsToolboxPanel extends Panel {
  /**
   * @param {MeasuringTape} measuringTape
   * @param {ElectricPotentialSensor} electricPotentialSensor
   * @param {ChargesAndFieldsMeasuringTapeNode} measuringTapeNode
   * @param {ElectricPotentialSensorNode} electricPotentialSensorNode
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Property.<Bounds2>} availableModelBoundsProperty
   * @param {Tandem} tandem
   */
  constructor(measuringTape, electricPotentialSensor, measuringTapeNode, electricPotentialSensorNode, modelViewTransform, availableModelBoundsProperty, tandem) {
    // Create the icon image for the electricPotential sensor
    const electricPotentialSensorIconNode = ChargesAndFieldsToolboxPanel.createElectricPotentialSensorIcon(tandem); // {Node}

    // Create the icon image for the measuring Tape
    const measuringTapeIconNode = ChargesAndFieldsToolboxPanel.createMeasuringTapeIcon(tandem); // {Node}

    // The content panel with the two icons
    const panelContent = new VBox({
      spacing: 20,
      children: [electricPotentialSensorIconNode, measuringTapeIconNode],
      pickable: true,
      excludeInvisibleChildrenFromBounds: false
    });

    // Options for the panel
    const panelOptions = {
      lineWidth: ChargesAndFieldsConstants.PANEL_LINE_WIDTH,
      xMargin: 12,
      yMargin: 10,
      fill: ChargesAndFieldsColors.controlPanelFillProperty,
      stroke: ChargesAndFieldsColors.controlPanelBorderProperty,
      tandem: tandem
    };

    // add the panelContent
    super(panelContent, panelOptions);

    // determine the distance (in model coordinates) between the tip and the base position of the measuring tape
    const tipToBasePosition = measuringTape.tipPositionProperty.get().minus(measuringTape.basePositionProperty.get());
    const measuringTapeInputListener = {
      down: event => {
        // Don't try to start drags with a right mouse button or an attached pointer.
        if (!event.canStartPress()) {
          return;
        }
        measuringTape.isActiveProperty.set(true);
        const initialViewPosition = this.globalToParentPoint(event.pointer.point).minus(measuringTapeNode.getLocalBaseCenter());
        measuringTape.basePositionProperty.set(modelViewTransform.viewToModelPosition(initialViewPosition));
        measuringTape.tipPositionProperty.set(measuringTape.basePositionProperty.get().plus(tipToBasePosition));
        measuringTapeNode.startBaseDrag(event);
      }
    };

    // When pressed, creates a model element and triggers press() on the corresponding view
    electricPotentialSensorIconNode.addInputListener({
      down: event => {
        // Don't try to start drags with a right mouse button or an attached pointer.
        if (!event.canStartPress()) {
          return;
        }
        electricPotentialSensor.isActiveProperty.set(true);

        // initial position of the pointer in the screenView coordinates
        const initialViewPosition = this.globalToParentPoint(event.pointer.point).plusXY(0, -electricPotentialPanelOutline_png[0].height * 6 / 25);
        electricPotentialSensor.positionProperty.set(modelViewTransform.viewToModelPosition(initialViewPosition));
        electricPotentialSensorNode.dragListener.press(event, electricPotentialSensorNode);
      }
    });

    // Add the listener that will allow the user to click on this and create a model element, then position it in the model.
    measuringTapeIconNode.addInputListener(measuringTapeInputListener);

    // hide and show
    electricPotentialSensor.isActiveProperty.link(visible => electricPotentialSensorIconNode.setVisible(!visible));

    // measuringTape visibility has the opposite visibility of the measuringTape Icon
    measuringTape.isActiveProperty.link(active => measuringTapeIconNode.setVisible(!active));

    // no need to dispose of this link since this is present for the lifetime of the sim
    availableModelBoundsProperty.link(bounds => {
      // TODO: did this mean to say measuringTape.dragBounds???
      measuringTapeInputListener.dragBounds = bounds;
    });
  }

  /**
   * Returns an icon of the sensor (without the two buttons)
   * @private
   * @returns {Node}
   */
  static createElectricPotentialSensorIcon(tandem) {
    const node = new Node({
      // Show a cursor hand over the sensor icon
      cursor: 'pointer',
      tandem: tandem.createTandem('electricPotentialSensor')
    });

    // Create and add the centered circle around the crosshair. The origin of this node is the center of the circle
    const circle = new Circle(CIRCLE_RADIUS, {
      lineWidth: 2,
      centerX: 0,
      centerY: 0,
      stroke: ChargesAndFieldsColors.electricPotentialSensorCrosshairStrokeProperty
    });

    // Create the crosshair
    const crosshairShape = new Shape().moveTo(-CIRCLE_RADIUS, 0).lineTo(CIRCLE_RADIUS, 0).moveTo(0, -CIRCLE_RADIUS).lineTo(0, CIRCLE_RADIUS);
    const crosshair = new Path(crosshairShape, {
      centerX: 0,
      centerY: 0,
      stroke: ChargesAndFieldsColors.electricPotentialSensorCrosshairStrokeProperty
    });

    // Create the base of the crosshair
    // TODO: why is the fill the same as the stroke?
    const crosshairMount = new Rectangle(0, 0, 0.4 * CIRCLE_RADIUS, 0.4 * CIRCLE_RADIUS, {
      fill: ChargesAndFieldsColors.electricPotentialSensorCrosshairStrokeProperty,
      stroke: ChargesAndFieldsColors.electricPotentialSensorCrosshairStrokeProperty,
      tandem: tandem.createTandem('crosshairMount')
    });

    // Create the voltage Reading reading
    // TODO: Is this internationalized?
    const voltageText = new Text(`0.0 ${voltageUnitString}`, {
      font: ChargesAndFieldsConstants.DEFAULT_FONT,
      fill: 'black',
      stroke: 'black',
      maxWidth: 200,
      tandem: tandem.createTandem('voltageText')
    });
    const outlineImage = new Image(electricPotentialPanelOutline_png, {
      tandem: tandem.createTandem('outlineImage')
    });
    outlineImage.scale(0.5 * 6 / 25);

    // Create the background rectangle behind the voltage Reading
    const backgroundRectangle = new Rectangle(0, 0, outlineImage.width * 0.8, voltageText.height * 1.5, 5, 5, {
      fill: 'white',
      stroke: 'black',
      tandem: tandem.createTandem('backgroundRectangle')
    });
    crosshairMount.centerX = circle.centerX;
    crosshairMount.top = circle.bottom;
    voltageText.centerX = circle.centerX;
    backgroundRectangle.centerX = circle.centerX;
    outlineImage.centerX = circle.centerX;
    outlineImage.top = crosshairMount.bottom;
    voltageText.top = outlineImage.top + 20;
    backgroundRectangle.centerY = voltageText.centerY;
    node.addChild(crosshairMount);
    node.addChild(circle);
    node.addChild(crosshair);
    node.addChild(outlineImage);
    node.addChild(backgroundRectangle);
    node.addChild(voltageText);
    return node;
  }

  /**
   * Returns an icon of the measuring tape
   * @private
   * @returns {Node}
   */
  static createMeasuringTapeIcon(tandem) {
    // procedure to create an icon Image of a measuringTape
    // first, create an actual measuring tape

    const unspooledMeterTape = 30; // in view coordinates
    const measuringTape = new MeasuringTapeNode(new Property({
      name: '',
      multiplier: 1
    }), {
      tipPositionProperty: new Vector2Property(new Vector2(unspooledMeterTape, 0), {
        tandem: tandem.createTandem('tipPositionProperty'),
        phetioDocumentation: 'Tip position of measuring tape'
      }),
      scale: 0.8,
      // make it a bit small
      hasValue: false,
      // let's hide the text label value (the length) for the icon
      tandem: tandem.createTandem('measuringTape')
    });

    // second, create the measuringTape icon
    const measuringTapeIcon = new Node({
      children: [measuringTape]
    });

    // Create the measuringTape icon using toImage
    measuringTape.toImage(image => {
      measuringTapeIcon.children = [new Image(image, {
        cursor: 'pointer',
        tandem: tandem.createTandem('measuringTapeIconImage')
      })];
    }, measuringTape.width - unspooledMeterTape, measuringTape.height - 5, Math.ceil(measuringTape.width), Math.ceil(measuringTape.height));
    return measuringTapeIcon;
  }
}
chargesAndFields.register('ChargesAndFieldsToolboxPanel', ChargesAndFieldsToolboxPanel);
export default ChargesAndFieldsToolboxPanel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIlZlY3RvcjIiLCJWZWN0b3IyUHJvcGVydHkiLCJTaGFwZSIsIk1lYXN1cmluZ1RhcGVOb2RlIiwiQ2lyY2xlIiwiSW1hZ2UiLCJOb2RlIiwiUGF0aCIsIlJlY3RhbmdsZSIsIlRleHQiLCJWQm94IiwiUGFuZWwiLCJlbGVjdHJpY1BvdGVudGlhbFBhbmVsT3V0bGluZV9wbmciLCJjaGFyZ2VzQW5kRmllbGRzIiwiQ2hhcmdlc0FuZEZpZWxkc1N0cmluZ3MiLCJDaGFyZ2VzQW5kRmllbGRzQ29sb3JzIiwiQ2hhcmdlc0FuZEZpZWxkc0NvbnN0YW50cyIsIkNJUkNMRV9SQURJVVMiLCJ2b2x0YWdlVW5pdFN0cmluZyIsInZvbHRhZ2VVbml0IiwiQ2hhcmdlc0FuZEZpZWxkc1Rvb2xib3hQYW5lbCIsImNvbnN0cnVjdG9yIiwibWVhc3VyaW5nVGFwZSIsImVsZWN0cmljUG90ZW50aWFsU2Vuc29yIiwibWVhc3VyaW5nVGFwZU5vZGUiLCJlbGVjdHJpY1BvdGVudGlhbFNlbnNvck5vZGUiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJhdmFpbGFibGVNb2RlbEJvdW5kc1Byb3BlcnR5IiwidGFuZGVtIiwiZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JJY29uTm9kZSIsImNyZWF0ZUVsZWN0cmljUG90ZW50aWFsU2Vuc29ySWNvbiIsIm1lYXN1cmluZ1RhcGVJY29uTm9kZSIsImNyZWF0ZU1lYXN1cmluZ1RhcGVJY29uIiwicGFuZWxDb250ZW50Iiwic3BhY2luZyIsImNoaWxkcmVuIiwicGlja2FibGUiLCJleGNsdWRlSW52aXNpYmxlQ2hpbGRyZW5Gcm9tQm91bmRzIiwicGFuZWxPcHRpb25zIiwibGluZVdpZHRoIiwiUEFORUxfTElORV9XSURUSCIsInhNYXJnaW4iLCJ5TWFyZ2luIiwiZmlsbCIsImNvbnRyb2xQYW5lbEZpbGxQcm9wZXJ0eSIsInN0cm9rZSIsImNvbnRyb2xQYW5lbEJvcmRlclByb3BlcnR5IiwidGlwVG9CYXNlUG9zaXRpb24iLCJ0aXBQb3NpdGlvblByb3BlcnR5IiwiZ2V0IiwibWludXMiLCJiYXNlUG9zaXRpb25Qcm9wZXJ0eSIsIm1lYXN1cmluZ1RhcGVJbnB1dExpc3RlbmVyIiwiZG93biIsImV2ZW50IiwiY2FuU3RhcnRQcmVzcyIsImlzQWN0aXZlUHJvcGVydHkiLCJzZXQiLCJpbml0aWFsVmlld1Bvc2l0aW9uIiwiZ2xvYmFsVG9QYXJlbnRQb2ludCIsInBvaW50ZXIiLCJwb2ludCIsImdldExvY2FsQmFzZUNlbnRlciIsInZpZXdUb01vZGVsUG9zaXRpb24iLCJwbHVzIiwic3RhcnRCYXNlRHJhZyIsImFkZElucHV0TGlzdGVuZXIiLCJwbHVzWFkiLCJoZWlnaHQiLCJwb3NpdGlvblByb3BlcnR5IiwiZHJhZ0xpc3RlbmVyIiwicHJlc3MiLCJsaW5rIiwidmlzaWJsZSIsInNldFZpc2libGUiLCJhY3RpdmUiLCJib3VuZHMiLCJkcmFnQm91bmRzIiwibm9kZSIsImN1cnNvciIsImNyZWF0ZVRhbmRlbSIsImNpcmNsZSIsImNlbnRlclgiLCJjZW50ZXJZIiwiZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JDcm9zc2hhaXJTdHJva2VQcm9wZXJ0eSIsImNyb3NzaGFpclNoYXBlIiwibW92ZVRvIiwibGluZVRvIiwiY3Jvc3NoYWlyIiwiY3Jvc3NoYWlyTW91bnQiLCJ2b2x0YWdlVGV4dCIsImZvbnQiLCJERUZBVUxUX0ZPTlQiLCJtYXhXaWR0aCIsIm91dGxpbmVJbWFnZSIsInNjYWxlIiwiYmFja2dyb3VuZFJlY3RhbmdsZSIsIndpZHRoIiwidG9wIiwiYm90dG9tIiwiYWRkQ2hpbGQiLCJ1bnNwb29sZWRNZXRlclRhcGUiLCJuYW1lIiwibXVsdGlwbGllciIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJoYXNWYWx1ZSIsIm1lYXN1cmluZ1RhcGVJY29uIiwidG9JbWFnZSIsImltYWdlIiwiTWF0aCIsImNlaWwiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNoYXJnZXNBbmRGaWVsZHNUb29sYm94UGFuZWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTUtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVG9vbGJveCBmcm9tIHdoaWNoIHRoZSB1c2VyIGNhbiBkcmFnIChvciBvdGhlcndpc2UgZW5hYmxlKSB0b29scy5cclxuICogVGhlIHRvb2xib3ggaW5jbHVkZXMgYSBtZWFzdXJpbmcgdGFwZSBhbmQgYW4gZWxlY3RyaWMgcG90ZW50aWFsIHNlbnNvclxyXG4gKlxyXG4gKiBAYXV0aG9yIE1hcnRpbiBWZWlsbGV0dGUgKEJlcmVhIENvbGxlZ2UpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBWZWN0b3IyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IE1lYXN1cmluZ1RhcGVOb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9NZWFzdXJpbmdUYXBlTm9kZS5qcyc7XHJcbmltcG9ydCB7IENpcmNsZSwgSW1hZ2UsIE5vZGUsIFBhdGgsIFJlY3RhbmdsZSwgVGV4dCwgVkJveCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBQYW5lbCBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvUGFuZWwuanMnO1xyXG5pbXBvcnQgZWxlY3RyaWNQb3RlbnRpYWxQYW5lbE91dGxpbmVfcG5nIGZyb20gJy4uLy4uLy4uL21pcG1hcHMvZWxlY3RyaWNQb3RlbnRpYWxQYW5lbE91dGxpbmVfcG5nLmpzJztcclxuaW1wb3J0IGNoYXJnZXNBbmRGaWVsZHMgZnJvbSAnLi4vLi4vY2hhcmdlc0FuZEZpZWxkcy5qcyc7XHJcbmltcG9ydCBDaGFyZ2VzQW5kRmllbGRzU3RyaW5ncyBmcm9tICcuLi8uLi9DaGFyZ2VzQW5kRmllbGRzU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzIGZyb20gJy4uL0NoYXJnZXNBbmRGaWVsZHNDb2xvcnMuanMnO1xyXG5pbXBvcnQgQ2hhcmdlc0FuZEZpZWxkc0NvbnN0YW50cyBmcm9tICcuLi9DaGFyZ2VzQW5kRmllbGRzQ29uc3RhbnRzLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBDSVJDTEVfUkFESVVTID0gMTA7IC8vIHJhZGl1cyBvZiB0aGUgY2lyY2xlIGFyb3VuZCB0aGUgY3Jvc3NoYWlyXHJcblxyXG5jb25zdCB2b2x0YWdlVW5pdFN0cmluZyA9IENoYXJnZXNBbmRGaWVsZHNTdHJpbmdzLnZvbHRhZ2VVbml0O1xyXG5cclxuY2xhc3MgQ2hhcmdlc0FuZEZpZWxkc1Rvb2xib3hQYW5lbCBleHRlbmRzIFBhbmVsIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtNZWFzdXJpbmdUYXBlfSBtZWFzdXJpbmdUYXBlXHJcbiAgICogQHBhcmFtIHtFbGVjdHJpY1BvdGVudGlhbFNlbnNvcn0gZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JcclxuICAgKiBAcGFyYW0ge0NoYXJnZXNBbmRGaWVsZHNNZWFzdXJpbmdUYXBlTm9kZX0gbWVhc3VyaW5nVGFwZU5vZGVcclxuICAgKiBAcGFyYW0ge0VsZWN0cmljUG90ZW50aWFsU2Vuc29yTm9kZX0gZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JOb2RlXHJcbiAgICogQHBhcmFtIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfSBtb2RlbFZpZXdUcmFuc2Zvcm1cclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5LjxCb3VuZHMyPn0gYXZhaWxhYmxlTW9kZWxCb3VuZHNQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7VGFuZGVtfSB0YW5kZW1cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbWVhc3VyaW5nVGFwZSxcclxuICAgICAgICAgICAgICAgZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3IsXHJcbiAgICAgICAgICAgICAgIG1lYXN1cmluZ1RhcGVOb2RlLFxyXG4gICAgICAgICAgICAgICBlbGVjdHJpY1BvdGVudGlhbFNlbnNvck5vZGUsXHJcbiAgICAgICAgICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgICAgICAgICAgYXZhaWxhYmxlTW9kZWxCb3VuZHNQcm9wZXJ0eSxcclxuICAgICAgICAgICAgICAgdGFuZGVtICkge1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgaWNvbiBpbWFnZSBmb3IgdGhlIGVsZWN0cmljUG90ZW50aWFsIHNlbnNvclxyXG4gICAgY29uc3QgZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JJY29uTm9kZSA9IENoYXJnZXNBbmRGaWVsZHNUb29sYm94UGFuZWwuY3JlYXRlRWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JJY29uKCB0YW5kZW0gKTsgLy8ge05vZGV9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBpY29uIGltYWdlIGZvciB0aGUgbWVhc3VyaW5nIFRhcGVcclxuICAgIGNvbnN0IG1lYXN1cmluZ1RhcGVJY29uTm9kZSA9IENoYXJnZXNBbmRGaWVsZHNUb29sYm94UGFuZWwuY3JlYXRlTWVhc3VyaW5nVGFwZUljb24oIHRhbmRlbSApOyAvLyB7Tm9kZX1cclxuXHJcbiAgICAvLyBUaGUgY29udGVudCBwYW5lbCB3aXRoIHRoZSB0d28gaWNvbnNcclxuICAgIGNvbnN0IHBhbmVsQ29udGVudCA9IG5ldyBWQm94KCB7XHJcbiAgICAgIHNwYWNpbmc6IDIwLFxyXG4gICAgICBjaGlsZHJlbjogWyBlbGVjdHJpY1BvdGVudGlhbFNlbnNvckljb25Ob2RlLCBtZWFzdXJpbmdUYXBlSWNvbk5vZGUgXSxcclxuICAgICAgcGlja2FibGU6IHRydWUsXHJcbiAgICAgIGV4Y2x1ZGVJbnZpc2libGVDaGlsZHJlbkZyb21Cb3VuZHM6IGZhbHNlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gT3B0aW9ucyBmb3IgdGhlIHBhbmVsXHJcbiAgICBjb25zdCBwYW5lbE9wdGlvbnMgPSB7XHJcbiAgICAgIGxpbmVXaWR0aDogQ2hhcmdlc0FuZEZpZWxkc0NvbnN0YW50cy5QQU5FTF9MSU5FX1dJRFRILFxyXG4gICAgICB4TWFyZ2luOiAxMixcclxuICAgICAgeU1hcmdpbjogMTAsXHJcbiAgICAgIGZpbGw6IENoYXJnZXNBbmRGaWVsZHNDb2xvcnMuY29udHJvbFBhbmVsRmlsbFByb3BlcnR5LFxyXG4gICAgICBzdHJva2U6IENoYXJnZXNBbmRGaWVsZHNDb2xvcnMuY29udHJvbFBhbmVsQm9yZGVyUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIGFkZCB0aGUgcGFuZWxDb250ZW50XHJcbiAgICBzdXBlciggcGFuZWxDb250ZW50LCBwYW5lbE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBkZXRlcm1pbmUgdGhlIGRpc3RhbmNlIChpbiBtb2RlbCBjb29yZGluYXRlcykgYmV0d2VlbiB0aGUgdGlwIGFuZCB0aGUgYmFzZSBwb3NpdGlvbiBvZiB0aGUgbWVhc3VyaW5nIHRhcGVcclxuICAgIGNvbnN0IHRpcFRvQmFzZVBvc2l0aW9uID0gbWVhc3VyaW5nVGFwZS50aXBQb3NpdGlvblByb3BlcnR5LmdldCgpLm1pbnVzKCBtZWFzdXJpbmdUYXBlLmJhc2VQb3NpdGlvblByb3BlcnR5LmdldCgpICk7XHJcblxyXG4gICAgY29uc3QgbWVhc3VyaW5nVGFwZUlucHV0TGlzdGVuZXIgPSB7XHJcbiAgICAgIGRvd246IGV2ZW50ID0+IHtcclxuXHJcbiAgICAgICAgLy8gRG9uJ3QgdHJ5IHRvIHN0YXJ0IGRyYWdzIHdpdGggYSByaWdodCBtb3VzZSBidXR0b24gb3IgYW4gYXR0YWNoZWQgcG9pbnRlci5cclxuICAgICAgICBpZiAoICFldmVudC5jYW5TdGFydFByZXNzKCkgKSB7IHJldHVybjsgfVxyXG5cclxuICAgICAgICBtZWFzdXJpbmdUYXBlLmlzQWN0aXZlUHJvcGVydHkuc2V0KCB0cnVlICk7XHJcblxyXG4gICAgICAgIGNvbnN0IGluaXRpYWxWaWV3UG9zaXRpb24gPSB0aGlzLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKVxyXG4gICAgICAgICAgLm1pbnVzKCBtZWFzdXJpbmdUYXBlTm9kZS5nZXRMb2NhbEJhc2VDZW50ZXIoKSApO1xyXG4gICAgICAgIG1lYXN1cmluZ1RhcGUuYmFzZVBvc2l0aW9uUHJvcGVydHkuc2V0KCBtb2RlbFZpZXdUcmFuc2Zvcm0udmlld1RvTW9kZWxQb3NpdGlvbiggaW5pdGlhbFZpZXdQb3NpdGlvbiApICk7XHJcbiAgICAgICAgbWVhc3VyaW5nVGFwZS50aXBQb3NpdGlvblByb3BlcnR5LnNldCggbWVhc3VyaW5nVGFwZS5iYXNlUG9zaXRpb25Qcm9wZXJ0eS5nZXQoKS5wbHVzKCB0aXBUb0Jhc2VQb3NpdGlvbiApICk7XHJcblxyXG4gICAgICAgIG1lYXN1cmluZ1RhcGVOb2RlLnN0YXJ0QmFzZURyYWcoIGV2ZW50ICk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gV2hlbiBwcmVzc2VkLCBjcmVhdGVzIGEgbW9kZWwgZWxlbWVudCBhbmQgdHJpZ2dlcnMgcHJlc3MoKSBvbiB0aGUgY29ycmVzcG9uZGluZyB2aWV3XHJcbiAgICBlbGVjdHJpY1BvdGVudGlhbFNlbnNvckljb25Ob2RlLmFkZElucHV0TGlzdGVuZXIoIHtcclxuICAgICAgZG93bjogZXZlbnQgPT4ge1xyXG5cclxuICAgICAgICAvLyBEb24ndCB0cnkgdG8gc3RhcnQgZHJhZ3Mgd2l0aCBhIHJpZ2h0IG1vdXNlIGJ1dHRvbiBvciBhbiBhdHRhY2hlZCBwb2ludGVyLlxyXG4gICAgICAgIGlmICggIWV2ZW50LmNhblN0YXJ0UHJlc3MoKSApIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgICAgIGVsZWN0cmljUG90ZW50aWFsU2Vuc29yLmlzQWN0aXZlUHJvcGVydHkuc2V0KCB0cnVlICk7XHJcblxyXG4gICAgICAgIC8vIGluaXRpYWwgcG9zaXRpb24gb2YgdGhlIHBvaW50ZXIgaW4gdGhlIHNjcmVlblZpZXcgY29vcmRpbmF0ZXNcclxuICAgICAgICBjb25zdCBpbml0aWFsVmlld1Bvc2l0aW9uID0gdGhpcy5nbG9iYWxUb1BhcmVudFBvaW50KCBldmVudC5wb2ludGVyLnBvaW50ICkucGx1c1hZKCAwLCAtZWxlY3RyaWNQb3RlbnRpYWxQYW5lbE91dGxpbmVfcG5nWyAwIF0uaGVpZ2h0ICogNiAvIDI1ICk7XHJcbiAgICAgICAgZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3IucG9zaXRpb25Qcm9wZXJ0eS5zZXQoIG1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbFBvc2l0aW9uKCBpbml0aWFsVmlld1Bvc2l0aW9uICkgKTtcclxuXHJcbiAgICAgICAgZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JOb2RlLmRyYWdMaXN0ZW5lci5wcmVzcyggZXZlbnQsIGVsZWN0cmljUG90ZW50aWFsU2Vuc29yTm9kZSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBsaXN0ZW5lciB0aGF0IHdpbGwgYWxsb3cgdGhlIHVzZXIgdG8gY2xpY2sgb24gdGhpcyBhbmQgY3JlYXRlIGEgbW9kZWwgZWxlbWVudCwgdGhlbiBwb3NpdGlvbiBpdCBpbiB0aGUgbW9kZWwuXHJcbiAgICBtZWFzdXJpbmdUYXBlSWNvbk5vZGUuYWRkSW5wdXRMaXN0ZW5lciggbWVhc3VyaW5nVGFwZUlucHV0TGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBoaWRlIGFuZCBzaG93XHJcbiAgICBlbGVjdHJpY1BvdGVudGlhbFNlbnNvci5pc0FjdGl2ZVByb3BlcnR5LmxpbmsoIHZpc2libGUgPT4gZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JJY29uTm9kZS5zZXRWaXNpYmxlKCAhdmlzaWJsZSApICk7XHJcblxyXG4gICAgLy8gbWVhc3VyaW5nVGFwZSB2aXNpYmlsaXR5IGhhcyB0aGUgb3Bwb3NpdGUgdmlzaWJpbGl0eSBvZiB0aGUgbWVhc3VyaW5nVGFwZSBJY29uXHJcbiAgICBtZWFzdXJpbmdUYXBlLmlzQWN0aXZlUHJvcGVydHkubGluayggYWN0aXZlID0+IG1lYXN1cmluZ1RhcGVJY29uTm9kZS5zZXRWaXNpYmxlKCAhYWN0aXZlICkgKTtcclxuXHJcbiAgICAvLyBubyBuZWVkIHRvIGRpc3Bvc2Ugb2YgdGhpcyBsaW5rIHNpbmNlIHRoaXMgaXMgcHJlc2VudCBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW1cclxuICAgIGF2YWlsYWJsZU1vZGVsQm91bmRzUHJvcGVydHkubGluayggYm91bmRzID0+IHtcclxuXHJcbiAgICAgIC8vIFRPRE86IGRpZCB0aGlzIG1lYW4gdG8gc2F5IG1lYXN1cmluZ1RhcGUuZHJhZ0JvdW5kcz8/P1xyXG4gICAgICBtZWFzdXJpbmdUYXBlSW5wdXRMaXN0ZW5lci5kcmFnQm91bmRzID0gYm91bmRzO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyBhbiBpY29uIG9mIHRoZSBzZW5zb3IgKHdpdGhvdXQgdGhlIHR3byBidXR0b25zKVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHJldHVybnMge05vZGV9XHJcbiAgICovXHJcbiAgc3RhdGljIGNyZWF0ZUVsZWN0cmljUG90ZW50aWFsU2Vuc29ySWNvbiggdGFuZGVtICkge1xyXG5cclxuICAgIGNvbnN0IG5vZGUgPSBuZXcgTm9kZSgge1xyXG4gICAgICAvLyBTaG93IGEgY3Vyc29yIGhhbmQgb3ZlciB0aGUgc2Vuc29yIGljb25cclxuICAgICAgY3Vyc29yOiAncG9pbnRlcicsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2VsZWN0cmljUG90ZW50aWFsU2Vuc29yJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGFuZCBhZGQgdGhlIGNlbnRlcmVkIGNpcmNsZSBhcm91bmQgdGhlIGNyb3NzaGFpci4gVGhlIG9yaWdpbiBvZiB0aGlzIG5vZGUgaXMgdGhlIGNlbnRlciBvZiB0aGUgY2lyY2xlXHJcbiAgICBjb25zdCBjaXJjbGUgPSBuZXcgQ2lyY2xlKCBDSVJDTEVfUkFESVVTLCB7XHJcbiAgICAgIGxpbmVXaWR0aDogMixcclxuICAgICAgY2VudGVyWDogMCxcclxuICAgICAgY2VudGVyWTogMCxcclxuICAgICAgc3Ryb2tlOiBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmVsZWN0cmljUG90ZW50aWFsU2Vuc29yQ3Jvc3NoYWlyU3Ryb2tlUHJvcGVydHlcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIGNyb3NzaGFpclxyXG4gICAgY29uc3QgY3Jvc3NoYWlyU2hhcGUgPSBuZXcgU2hhcGUoKS5tb3ZlVG8oIC1DSVJDTEVfUkFESVVTLCAwIClcclxuICAgICAgLmxpbmVUbyggQ0lSQ0xFX1JBRElVUywgMCApXHJcbiAgICAgIC5tb3ZlVG8oIDAsIC1DSVJDTEVfUkFESVVTIClcclxuICAgICAgLmxpbmVUbyggMCwgQ0lSQ0xFX1JBRElVUyApO1xyXG4gICAgY29uc3QgY3Jvc3NoYWlyID0gbmV3IFBhdGgoIGNyb3NzaGFpclNoYXBlLCB7XHJcbiAgICAgIGNlbnRlclg6IDAsXHJcbiAgICAgIGNlbnRlclk6IDAsXHJcbiAgICAgIHN0cm9rZTogQ2hhcmdlc0FuZEZpZWxkc0NvbG9ycy5lbGVjdHJpY1BvdGVudGlhbFNlbnNvckNyb3NzaGFpclN0cm9rZVByb3BlcnR5XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBiYXNlIG9mIHRoZSBjcm9zc2hhaXJcclxuICAgIC8vIFRPRE86IHdoeSBpcyB0aGUgZmlsbCB0aGUgc2FtZSBhcyB0aGUgc3Ryb2tlP1xyXG4gICAgY29uc3QgY3Jvc3NoYWlyTW91bnQgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCAwLjQgKiBDSVJDTEVfUkFESVVTLCAwLjQgKiBDSVJDTEVfUkFESVVTLCB7XHJcbiAgICAgIGZpbGw6IENoYXJnZXNBbmRGaWVsZHNDb2xvcnMuZWxlY3RyaWNQb3RlbnRpYWxTZW5zb3JDcm9zc2hhaXJTdHJva2VQcm9wZXJ0eSxcclxuICAgICAgc3Ryb2tlOiBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmVsZWN0cmljUG90ZW50aWFsU2Vuc29yQ3Jvc3NoYWlyU3Ryb2tlUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2Nyb3NzaGFpck1vdW50JyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSB2b2x0YWdlIFJlYWRpbmcgcmVhZGluZ1xyXG4gICAgLy8gVE9ETzogSXMgdGhpcyBpbnRlcm5hdGlvbmFsaXplZD9cclxuICAgIGNvbnN0IHZvbHRhZ2VUZXh0ID0gbmV3IFRleHQoIGAwLjAgJHt2b2x0YWdlVW5pdFN0cmluZ31gLCB7XHJcbiAgICAgIGZvbnQ6IENoYXJnZXNBbmRGaWVsZHNDb25zdGFudHMuREVGQVVMVF9GT05ULFxyXG4gICAgICBmaWxsOiAnYmxhY2snLFxyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIG1heFdpZHRoOiAyMDAsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3ZvbHRhZ2VUZXh0JyApXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBvdXRsaW5lSW1hZ2UgPSBuZXcgSW1hZ2UoIGVsZWN0cmljUG90ZW50aWFsUGFuZWxPdXRsaW5lX3BuZywge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdvdXRsaW5lSW1hZ2UnIClcclxuICAgIH0gKTtcclxuICAgIG91dGxpbmVJbWFnZS5zY2FsZSggMC41ICogNiAvIDI1ICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBiYWNrZ3JvdW5kIHJlY3RhbmdsZSBiZWhpbmQgdGhlIHZvbHRhZ2UgUmVhZGluZ1xyXG4gICAgY29uc3QgYmFja2dyb3VuZFJlY3RhbmdsZSA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIG91dGxpbmVJbWFnZS53aWR0aCAqIDAuOCwgdm9sdGFnZVRleHQuaGVpZ2h0ICogMS41LCA1LCA1LCB7XHJcbiAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnYmFja2dyb3VuZFJlY3RhbmdsZScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNyb3NzaGFpck1vdW50LmNlbnRlclggPSBjaXJjbGUuY2VudGVyWDtcclxuICAgIGNyb3NzaGFpck1vdW50LnRvcCA9IGNpcmNsZS5ib3R0b207XHJcbiAgICB2b2x0YWdlVGV4dC5jZW50ZXJYID0gY2lyY2xlLmNlbnRlclg7XHJcbiAgICBiYWNrZ3JvdW5kUmVjdGFuZ2xlLmNlbnRlclggPSBjaXJjbGUuY2VudGVyWDtcclxuICAgIG91dGxpbmVJbWFnZS5jZW50ZXJYID0gY2lyY2xlLmNlbnRlclg7XHJcbiAgICBvdXRsaW5lSW1hZ2UudG9wID0gY3Jvc3NoYWlyTW91bnQuYm90dG9tO1xyXG4gICAgdm9sdGFnZVRleHQudG9wID0gb3V0bGluZUltYWdlLnRvcCArIDIwO1xyXG4gICAgYmFja2dyb3VuZFJlY3RhbmdsZS5jZW50ZXJZID0gdm9sdGFnZVRleHQuY2VudGVyWTtcclxuXHJcbiAgICBub2RlLmFkZENoaWxkKCBjcm9zc2hhaXJNb3VudCApO1xyXG4gICAgbm9kZS5hZGRDaGlsZCggY2lyY2xlICk7XHJcbiAgICBub2RlLmFkZENoaWxkKCBjcm9zc2hhaXIgKTtcclxuICAgIG5vZGUuYWRkQ2hpbGQoIG91dGxpbmVJbWFnZSApO1xyXG4gICAgbm9kZS5hZGRDaGlsZCggYmFja2dyb3VuZFJlY3RhbmdsZSApO1xyXG4gICAgbm9kZS5hZGRDaGlsZCggdm9sdGFnZVRleHQgKTtcclxuXHJcbiAgICByZXR1cm4gbm9kZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgYW4gaWNvbiBvZiB0aGUgbWVhc3VyaW5nIHRhcGVcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEByZXR1cm5zIHtOb2RlfVxyXG4gICAqL1xyXG4gIHN0YXRpYyBjcmVhdGVNZWFzdXJpbmdUYXBlSWNvbiggdGFuZGVtICkge1xyXG4gICAgLy8gcHJvY2VkdXJlIHRvIGNyZWF0ZSBhbiBpY29uIEltYWdlIG9mIGEgbWVhc3VyaW5nVGFwZVxyXG4gICAgLy8gZmlyc3QsIGNyZWF0ZSBhbiBhY3R1YWwgbWVhc3VyaW5nIHRhcGVcclxuXHJcbiAgICBjb25zdCB1bnNwb29sZWRNZXRlclRhcGUgPSAzMDsgLy8gaW4gdmlldyBjb29yZGluYXRlc1xyXG4gICAgY29uc3QgbWVhc3VyaW5nVGFwZSA9IG5ldyBNZWFzdXJpbmdUYXBlTm9kZSggbmV3IFByb3BlcnR5KCB7IG5hbWU6ICcnLCBtdWx0aXBsaWVyOiAxIH0gKSwge1xyXG4gICAgICB0aXBQb3NpdGlvblByb3BlcnR5OiBuZXcgVmVjdG9yMlByb3BlcnR5KCBuZXcgVmVjdG9yMiggdW5zcG9vbGVkTWV0ZXJUYXBlLCAwICksIHtcclxuICAgICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd0aXBQb3NpdGlvblByb3BlcnR5JyApLFxyXG4gICAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdUaXAgcG9zaXRpb24gb2YgbWVhc3VyaW5nIHRhcGUnXHJcbiAgICAgIH0gKSxcclxuICAgICAgc2NhbGU6IDAuOCwgLy8gbWFrZSBpdCBhIGJpdCBzbWFsbFxyXG4gICAgICBoYXNWYWx1ZTogZmFsc2UsIC8vIGxldCdzIGhpZGUgdGhlIHRleHQgbGFiZWwgdmFsdWUgKHRoZSBsZW5ndGgpIGZvciB0aGUgaWNvblxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdtZWFzdXJpbmdUYXBlJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gc2Vjb25kLCBjcmVhdGUgdGhlIG1lYXN1cmluZ1RhcGUgaWNvblxyXG4gICAgY29uc3QgbWVhc3VyaW5nVGFwZUljb24gPSBuZXcgTm9kZSggeyBjaGlsZHJlbjogWyBtZWFzdXJpbmdUYXBlIF0gfSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgbWVhc3VyaW5nVGFwZSBpY29uIHVzaW5nIHRvSW1hZ2VcclxuICAgIG1lYXN1cmluZ1RhcGUudG9JbWFnZSggaW1hZ2UgPT4ge1xyXG4gICAgICBtZWFzdXJpbmdUYXBlSWNvbi5jaGlsZHJlbiA9IFsgbmV3IEltYWdlKCBpbWFnZSwge1xyXG4gICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLFxyXG4gICAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ21lYXN1cmluZ1RhcGVJY29uSW1hZ2UnIClcclxuICAgICAgfSApIF07XHJcbiAgICB9LCBtZWFzdXJpbmdUYXBlLndpZHRoIC0gdW5zcG9vbGVkTWV0ZXJUYXBlLCBtZWFzdXJpbmdUYXBlLmhlaWdodCAtIDUsIE1hdGguY2VpbCggbWVhc3VyaW5nVGFwZS53aWR0aCApLCBNYXRoLmNlaWwoIG1lYXN1cmluZ1RhcGUuaGVpZ2h0ICkgKTtcclxuXHJcbiAgICByZXR1cm4gbWVhc3VyaW5nVGFwZUljb247XHJcbiAgfVxyXG59XHJcblxyXG5jaGFyZ2VzQW5kRmllbGRzLnJlZ2lzdGVyKCAnQ2hhcmdlc0FuZEZpZWxkc1Rvb2xib3hQYW5lbCcsIENoYXJnZXNBbmRGaWVsZHNUb29sYm94UGFuZWwgKTtcclxuZXhwb3J0IGRlZmF1bHQgQ2hhcmdlc0FuZEZpZWxkc1Rvb2xib3hQYW5lbDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxRQUFRLE1BQU0saUNBQWlDO0FBQ3RELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsZUFBZSxNQUFNLHVDQUF1QztBQUNuRSxTQUFTQyxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELE9BQU9DLGlCQUFpQixNQUFNLGtEQUFrRDtBQUNoRixTQUFTQyxNQUFNLEVBQUVDLEtBQUss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