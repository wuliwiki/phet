// Copyright 2016-2022, University of Colorado Boulder

/**
 * View for the electric potential Node that uses Canvas.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import { CanvasNode } from '../../../../scenery/js/imports.js';
import chargesAndFields from '../../chargesAndFields.js';
import ChargesAndFieldsColors from '../ChargesAndFieldsColors.js';
import ChargesAndFieldsConstants from '../ChargesAndFieldsConstants.js';
import ChargeTracker from './ChargeTracker.js';

// Spacing in the model coordinate frame.
const ELECTRIC_POTENTIAL_SENSOR_SPACING = ChargesAndFieldsConstants.ELECTRIC_POTENTIAL_SENSOR_SPACING;
class ElectricPotentialCanvasNode extends CanvasNode {
  /**
   * @param {ObservableArrayDef.<ChargedParticle>} chargedParticles - only chargedParticles that active are in this array
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Bounds2} modelBounds - The bounds in the model that need to be drawn
   * @param {Property.<boolean>} isVisibleProperty
   */
  constructor(chargedParticles, modelViewTransform, modelBounds, isVisibleProperty) {
    super({
      canvasBounds: modelViewTransform.modelToViewBounds(modelBounds)
    });
    this.chargeTracker = new ChargeTracker(chargedParticles);
    this.modelViewTransform = modelViewTransform;
    this.modelBounds = modelBounds;
    this.viewBounds = this.modelViewTransform.modelToViewBounds(modelBounds);
    this.isVisibleProperty = isVisibleProperty;

    // Invalidate paint on a bunch of changes
    const invalidateSelfListener = this.forceRepaint.bind(this);
    ChargesAndFieldsColors.electricPotentialGridZeroProperty.link(invalidateSelfListener);
    ChargesAndFieldsColors.electricPotentialGridSaturationPositiveProperty.link(invalidateSelfListener);
    ChargesAndFieldsColors.electricPotentialGridSaturationNegativeProperty.link(invalidateSelfListener);
    isVisibleProperty.link(invalidateSelfListener); // visibility change

    // particle added
    chargedParticles.addItemAddedListener(particle => particle.positionProperty.link(invalidateSelfListener));

    // particle removed
    chargedParticles.addItemRemovedListener(particle => {
      invalidateSelfListener();
      particle.positionProperty.unlink(invalidateSelfListener);
    });
    isVisibleProperty.linkAttribute(this, 'visible');
    this.modelPositions = []; // {Array.<Vector2>}
    const width = modelBounds.width;
    const height = modelBounds.height;
    const numHorizontal = Math.ceil(width / ELECTRIC_POTENTIAL_SENSOR_SPACING);
    const numVertical = Math.ceil(height / ELECTRIC_POTENTIAL_SENSOR_SPACING);
    for (let row = 0; row < numVertical; row++) {
      const y = modelBounds.minY + (row + 0.5) * height / numVertical;
      for (let col = 0; col < numHorizontal; col++) {
        const x = modelBounds.minX + (col + 0.5) * width / numHorizontal;
        this.modelPositions.push(new Vector2(x, y));
      }
    }
    this.electricPotentials = new Float64Array(this.modelPositions.length);
    this.directCanvas = document.createElement('canvas');
    this.directCanvas.width = numHorizontal;
    this.directCanvas.height = numVertical;
    this.directContext = this.directCanvas.getContext('2d');
    this.directCanvasDirty = true; // Store a dirty flag, in case there weren't charge changes detected

    this.imageData = this.directContext.getImageData(0, 0, numHorizontal, numVertical);
    assert && assert(this.imageData.width === numHorizontal);
    assert && assert(this.imageData.height === numVertical);

    // visibility change
    this.disposeElectricPotentialCanvasNode = () => isVisibleProperty.unlink(invalidateSelfListener);
  }

  /**
   * @private
   */
  forceRepaint() {
    this.invalidatePaint();
    this.directCanvasDirty = true;
  }

  /**
   * @private
   */
  updateElectricPotentials() {
    const kConstant = ChargesAndFieldsConstants.K_CONSTANT;
    const numChanges = this.chargeTracker.queue.length;
    for (let i = 0; i < numChanges; i++) {
      const item = this.chargeTracker.queue[i];
      const oldPosition = item.oldPosition;
      const newPosition = item.newPosition;
      const charge = item.charge;
      for (let j = 0; j < this.modelPositions.length; j++) {
        const position = this.modelPositions[j];
        let electricPotential = this.electricPotentials[j];
        if (oldPosition) {
          const oldDistance = position.distance(oldPosition);
          if (oldDistance !== 0) {
            electricPotential -= charge * kConstant / oldDistance;
          }
        }
        if (newPosition) {
          const newDistance = position.distance(newPosition);
          if (newDistance !== 0) {
            electricPotential += charge * kConstant / newDistance;
          }
        }
        this.electricPotentials[j] = electricPotential;
      }
    }
    this.chargeTracker.clear();

    // Update our direct canvas if necessary
    if (numChanges || this.directCanvasDirty) {
      const zeroColor = ChargesAndFieldsColors.electricPotentialGridZeroProperty.get();
      const positiveColor = ChargesAndFieldsColors.electricPotentialGridSaturationPositiveProperty.get();
      const negativeColor = ChargesAndFieldsColors.electricPotentialGridSaturationNegativeProperty.get();
      const data = this.imageData.data;
      for (let k = 0; k < this.electricPotentials.length; k++) {
        let value = this.electricPotentials[k] / 40; // mapped with special constant

        let extremeColor;
        if (value > 0) {
          extremeColor = positiveColor;
        } else {
          value = -value;
          extremeColor = negativeColor;
        }
        value = Math.min(value, 1); // clamp to [0,1]

        const offset = 4 * k;
        data[offset + 0] = extremeColor.r * value + zeroColor.r * (1 - value);
        data[offset + 1] = extremeColor.g * value + zeroColor.g * (1 - value);
        data[offset + 2] = extremeColor.b * value + zeroColor.b * (1 - value);
        data[offset + 3] = 255 * (extremeColor.a * value + zeroColor.a * (1 - value));
      }
      this.directContext.putImageData(this.imageData, 0, 0);
      this.directCanvasDirty = false;
    }
  }

  /**
   * Function responsible for painting the canvas Node as a grid array of squares
   * @public
   * @override
   * @param {CanvasRenderingContext2D} context
   */
  paintCanvas(context) {
    this.updateElectricPotentials();
    context.save();
    const sx = this.viewBounds.width / this.directCanvas.width;
    const sy = -this.viewBounds.height / this.directCanvas.height;
    const tx = this.viewBounds.minX;
    const ty = this.viewBounds.maxY;
    context.transform(sx, 0, 0, sy, tx, ty);
    context.drawImage(this.directCanvas, 0, 0);
    context.restore();
  }

  /**
   * Releases references
   * @public
   */
  dispose() {
    this.disposeElectricPotentialCanvasNode();
  }
}
chargesAndFields.register('ElectricPotentialCanvasNode', ElectricPotentialCanvasNode);
export default ElectricPotentialCanvasNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiQ2FudmFzTm9kZSIsImNoYXJnZXNBbmRGaWVsZHMiLCJDaGFyZ2VzQW5kRmllbGRzQ29sb3JzIiwiQ2hhcmdlc0FuZEZpZWxkc0NvbnN0YW50cyIsIkNoYXJnZVRyYWNrZXIiLCJFTEVDVFJJQ19QT1RFTlRJQUxfU0VOU09SX1NQQUNJTkciLCJFbGVjdHJpY1BvdGVudGlhbENhbnZhc05vZGUiLCJjb25zdHJ1Y3RvciIsImNoYXJnZWRQYXJ0aWNsZXMiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJtb2RlbEJvdW5kcyIsImlzVmlzaWJsZVByb3BlcnR5IiwiY2FudmFzQm91bmRzIiwibW9kZWxUb1ZpZXdCb3VuZHMiLCJjaGFyZ2VUcmFja2VyIiwidmlld0JvdW5kcyIsImludmFsaWRhdGVTZWxmTGlzdGVuZXIiLCJmb3JjZVJlcGFpbnQiLCJiaW5kIiwiZWxlY3RyaWNQb3RlbnRpYWxHcmlkWmVyb1Byb3BlcnR5IiwibGluayIsImVsZWN0cmljUG90ZW50aWFsR3JpZFNhdHVyYXRpb25Qb3NpdGl2ZVByb3BlcnR5IiwiZWxlY3RyaWNQb3RlbnRpYWxHcmlkU2F0dXJhdGlvbk5lZ2F0aXZlUHJvcGVydHkiLCJhZGRJdGVtQWRkZWRMaXN0ZW5lciIsInBhcnRpY2xlIiwicG9zaXRpb25Qcm9wZXJ0eSIsImFkZEl0ZW1SZW1vdmVkTGlzdGVuZXIiLCJ1bmxpbmsiLCJsaW5rQXR0cmlidXRlIiwibW9kZWxQb3NpdGlvbnMiLCJ3aWR0aCIsImhlaWdodCIsIm51bUhvcml6b250YWwiLCJNYXRoIiwiY2VpbCIsIm51bVZlcnRpY2FsIiwicm93IiwieSIsIm1pblkiLCJjb2wiLCJ4IiwibWluWCIsInB1c2giLCJlbGVjdHJpY1BvdGVudGlhbHMiLCJGbG9hdDY0QXJyYXkiLCJsZW5ndGgiLCJkaXJlY3RDYW52YXMiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJkaXJlY3RDb250ZXh0IiwiZ2V0Q29udGV4dCIsImRpcmVjdENhbnZhc0RpcnR5IiwiaW1hZ2VEYXRhIiwiZ2V0SW1hZ2VEYXRhIiwiYXNzZXJ0IiwiZGlzcG9zZUVsZWN0cmljUG90ZW50aWFsQ2FudmFzTm9kZSIsImludmFsaWRhdGVQYWludCIsInVwZGF0ZUVsZWN0cmljUG90ZW50aWFscyIsImtDb25zdGFudCIsIktfQ09OU1RBTlQiLCJudW1DaGFuZ2VzIiwicXVldWUiLCJpIiwiaXRlbSIsIm9sZFBvc2l0aW9uIiwibmV3UG9zaXRpb24iLCJjaGFyZ2UiLCJqIiwicG9zaXRpb24iLCJlbGVjdHJpY1BvdGVudGlhbCIsIm9sZERpc3RhbmNlIiwiZGlzdGFuY2UiLCJuZXdEaXN0YW5jZSIsImNsZWFyIiwiemVyb0NvbG9yIiwiZ2V0IiwicG9zaXRpdmVDb2xvciIsIm5lZ2F0aXZlQ29sb3IiLCJkYXRhIiwiayIsInZhbHVlIiwiZXh0cmVtZUNvbG9yIiwibWluIiwib2Zmc2V0IiwiciIsImciLCJiIiwiYSIsInB1dEltYWdlRGF0YSIsInBhaW50Q2FudmFzIiwiY29udGV4dCIsInNhdmUiLCJzeCIsInN5IiwidHgiLCJ0eSIsIm1heFkiLCJ0cmFuc2Zvcm0iLCJkcmF3SW1hZ2UiLCJyZXN0b3JlIiwiZGlzcG9zZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRWxlY3RyaWNQb3RlbnRpYWxDYW52YXNOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFZpZXcgZm9yIHRoZSBlbGVjdHJpYyBwb3RlbnRpYWwgTm9kZSB0aGF0IHVzZXMgQ2FudmFzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvbmF0aGFuIE9sc29uIDxqb25hdGhhbi5vbHNvbkBjb2xvcmFkby5lZHU+XHJcbiAqL1xyXG5cclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgeyBDYW52YXNOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGNoYXJnZXNBbmRGaWVsZHMgZnJvbSAnLi4vLi4vY2hhcmdlc0FuZEZpZWxkcy5qcyc7XHJcbmltcG9ydCBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzIGZyb20gJy4uL0NoYXJnZXNBbmRGaWVsZHNDb2xvcnMuanMnO1xyXG5pbXBvcnQgQ2hhcmdlc0FuZEZpZWxkc0NvbnN0YW50cyBmcm9tICcuLi9DaGFyZ2VzQW5kRmllbGRzQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IENoYXJnZVRyYWNrZXIgZnJvbSAnLi9DaGFyZ2VUcmFja2VyLmpzJztcclxuXHJcbi8vIFNwYWNpbmcgaW4gdGhlIG1vZGVsIGNvb3JkaW5hdGUgZnJhbWUuXHJcbmNvbnN0IEVMRUNUUklDX1BPVEVOVElBTF9TRU5TT1JfU1BBQ0lORyA9IENoYXJnZXNBbmRGaWVsZHNDb25zdGFudHMuRUxFQ1RSSUNfUE9URU5USUFMX1NFTlNPUl9TUEFDSU5HO1xyXG5cclxuY2xhc3MgRWxlY3RyaWNQb3RlbnRpYWxDYW52YXNOb2RlIGV4dGVuZHMgQ2FudmFzTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7T2JzZXJ2YWJsZUFycmF5RGVmLjxDaGFyZ2VkUGFydGljbGU+fSBjaGFyZ2VkUGFydGljbGVzIC0gb25seSBjaGFyZ2VkUGFydGljbGVzIHRoYXQgYWN0aXZlIGFyZSBpbiB0aGlzIGFycmF5XHJcbiAgICogQHBhcmFtIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfSBtb2RlbFZpZXdUcmFuc2Zvcm1cclxuICAgKiBAcGFyYW0ge0JvdW5kczJ9IG1vZGVsQm91bmRzIC0gVGhlIGJvdW5kcyBpbiB0aGUgbW9kZWwgdGhhdCBuZWVkIHRvIGJlIGRyYXduXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IGlzVmlzaWJsZVByb3BlcnR5XHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGNoYXJnZWRQYXJ0aWNsZXMsXHJcbiAgICAgICAgICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgICAgICAgICAgbW9kZWxCb3VuZHMsXHJcbiAgICAgICAgICAgICAgIGlzVmlzaWJsZVByb3BlcnR5ICkge1xyXG5cclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIGNhbnZhc0JvdW5kczogbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3Qm91bmRzKCBtb2RlbEJvdW5kcyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5jaGFyZ2VUcmFja2VyID0gbmV3IENoYXJnZVRyYWNrZXIoIGNoYXJnZWRQYXJ0aWNsZXMgKTtcclxuXHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSA9IG1vZGVsVmlld1RyYW5zZm9ybTtcclxuICAgIHRoaXMubW9kZWxCb3VuZHMgPSBtb2RlbEJvdW5kcztcclxuICAgIHRoaXMudmlld0JvdW5kcyA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3Qm91bmRzKCBtb2RlbEJvdW5kcyApO1xyXG4gICAgdGhpcy5pc1Zpc2libGVQcm9wZXJ0eSA9IGlzVmlzaWJsZVByb3BlcnR5O1xyXG5cclxuICAgIC8vIEludmFsaWRhdGUgcGFpbnQgb24gYSBidW5jaCBvZiBjaGFuZ2VzXHJcbiAgICBjb25zdCBpbnZhbGlkYXRlU2VsZkxpc3RlbmVyID0gdGhpcy5mb3JjZVJlcGFpbnQuYmluZCggdGhpcyApO1xyXG4gICAgQ2hhcmdlc0FuZEZpZWxkc0NvbG9ycy5lbGVjdHJpY1BvdGVudGlhbEdyaWRaZXJvUHJvcGVydHkubGluayggaW52YWxpZGF0ZVNlbGZMaXN0ZW5lciApO1xyXG4gICAgQ2hhcmdlc0FuZEZpZWxkc0NvbG9ycy5lbGVjdHJpY1BvdGVudGlhbEdyaWRTYXR1cmF0aW9uUG9zaXRpdmVQcm9wZXJ0eS5saW5rKCBpbnZhbGlkYXRlU2VsZkxpc3RlbmVyICk7XHJcbiAgICBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmVsZWN0cmljUG90ZW50aWFsR3JpZFNhdHVyYXRpb25OZWdhdGl2ZVByb3BlcnR5LmxpbmsoIGludmFsaWRhdGVTZWxmTGlzdGVuZXIgKTtcclxuICAgIGlzVmlzaWJsZVByb3BlcnR5LmxpbmsoIGludmFsaWRhdGVTZWxmTGlzdGVuZXIgKTsgLy8gdmlzaWJpbGl0eSBjaGFuZ2VcclxuXHJcbiAgICAvLyBwYXJ0aWNsZSBhZGRlZFxyXG4gICAgY2hhcmdlZFBhcnRpY2xlcy5hZGRJdGVtQWRkZWRMaXN0ZW5lciggcGFydGljbGUgPT4gcGFydGljbGUucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCBpbnZhbGlkYXRlU2VsZkxpc3RlbmVyICkgKTtcclxuXHJcbiAgICAvLyBwYXJ0aWNsZSByZW1vdmVkXHJcbiAgICBjaGFyZ2VkUGFydGljbGVzLmFkZEl0ZW1SZW1vdmVkTGlzdGVuZXIoIHBhcnRpY2xlID0+IHtcclxuICAgICAgaW52YWxpZGF0ZVNlbGZMaXN0ZW5lcigpO1xyXG4gICAgICBwYXJ0aWNsZS5wb3NpdGlvblByb3BlcnR5LnVubGluayggaW52YWxpZGF0ZVNlbGZMaXN0ZW5lciApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGlzVmlzaWJsZVByb3BlcnR5LmxpbmtBdHRyaWJ1dGUoIHRoaXMsICd2aXNpYmxlJyApO1xyXG5cclxuICAgIHRoaXMubW9kZWxQb3NpdGlvbnMgPSBbXTsgLy8ge0FycmF5LjxWZWN0b3IyPn1cclxuICAgIGNvbnN0IHdpZHRoID0gbW9kZWxCb3VuZHMud2lkdGg7XHJcbiAgICBjb25zdCBoZWlnaHQgPSBtb2RlbEJvdW5kcy5oZWlnaHQ7XHJcbiAgICBjb25zdCBudW1Ib3Jpem9udGFsID0gTWF0aC5jZWlsKCB3aWR0aCAvIEVMRUNUUklDX1BPVEVOVElBTF9TRU5TT1JfU1BBQ0lORyApO1xyXG4gICAgY29uc3QgbnVtVmVydGljYWwgPSBNYXRoLmNlaWwoIGhlaWdodCAvIEVMRUNUUklDX1BPVEVOVElBTF9TRU5TT1JfU1BBQ0lORyApO1xyXG4gICAgZm9yICggbGV0IHJvdyA9IDA7IHJvdyA8IG51bVZlcnRpY2FsOyByb3crKyApIHtcclxuICAgICAgY29uc3QgeSA9IG1vZGVsQm91bmRzLm1pblkgKyAoIHJvdyArIDAuNSApICogaGVpZ2h0IC8gbnVtVmVydGljYWw7XHJcblxyXG4gICAgICBmb3IgKCBsZXQgY29sID0gMDsgY29sIDwgbnVtSG9yaXpvbnRhbDsgY29sKysgKSB7XHJcbiAgICAgICAgY29uc3QgeCA9IG1vZGVsQm91bmRzLm1pblggKyAoIGNvbCArIDAuNSApICogd2lkdGggLyBudW1Ib3Jpem9udGFsO1xyXG5cclxuICAgICAgICB0aGlzLm1vZGVsUG9zaXRpb25zLnB1c2goIG5ldyBWZWN0b3IyKCB4LCB5ICkgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZWxlY3RyaWNQb3RlbnRpYWxzID0gbmV3IEZsb2F0NjRBcnJheSggdGhpcy5tb2RlbFBvc2l0aW9ucy5sZW5ndGggKTtcclxuXHJcbiAgICB0aGlzLmRpcmVjdENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdjYW52YXMnICk7XHJcbiAgICB0aGlzLmRpcmVjdENhbnZhcy53aWR0aCA9IG51bUhvcml6b250YWw7XHJcbiAgICB0aGlzLmRpcmVjdENhbnZhcy5oZWlnaHQgPSBudW1WZXJ0aWNhbDtcclxuICAgIHRoaXMuZGlyZWN0Q29udGV4dCA9IHRoaXMuZGlyZWN0Q2FudmFzLmdldENvbnRleHQoICcyZCcgKTtcclxuICAgIHRoaXMuZGlyZWN0Q2FudmFzRGlydHkgPSB0cnVlOyAvLyBTdG9yZSBhIGRpcnR5IGZsYWcsIGluIGNhc2UgdGhlcmUgd2VyZW4ndCBjaGFyZ2UgY2hhbmdlcyBkZXRlY3RlZFxyXG5cclxuICAgIHRoaXMuaW1hZ2VEYXRhID0gdGhpcy5kaXJlY3RDb250ZXh0LmdldEltYWdlRGF0YSggMCwgMCwgbnVtSG9yaXpvbnRhbCwgbnVtVmVydGljYWwgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuaW1hZ2VEYXRhLndpZHRoID09PSBudW1Ib3Jpem9udGFsICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLmltYWdlRGF0YS5oZWlnaHQgPT09IG51bVZlcnRpY2FsICk7XHJcblxyXG4gICAgLy8gdmlzaWJpbGl0eSBjaGFuZ2VcclxuICAgIHRoaXMuZGlzcG9zZUVsZWN0cmljUG90ZW50aWFsQ2FudmFzTm9kZSA9ICgpID0+IGlzVmlzaWJsZVByb3BlcnR5LnVubGluayggaW52YWxpZGF0ZVNlbGZMaXN0ZW5lciApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmb3JjZVJlcGFpbnQoKSB7XHJcbiAgICB0aGlzLmludmFsaWRhdGVQYWludCgpO1xyXG4gICAgdGhpcy5kaXJlY3RDYW52YXNEaXJ0eSA9IHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIHVwZGF0ZUVsZWN0cmljUG90ZW50aWFscygpIHtcclxuICAgIGNvbnN0IGtDb25zdGFudCA9IENoYXJnZXNBbmRGaWVsZHNDb25zdGFudHMuS19DT05TVEFOVDtcclxuXHJcbiAgICBjb25zdCBudW1DaGFuZ2VzID0gdGhpcy5jaGFyZ2VUcmFja2VyLnF1ZXVlLmxlbmd0aDtcclxuXHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBudW1DaGFuZ2VzOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmNoYXJnZVRyYWNrZXIucXVldWVbIGkgXTtcclxuICAgICAgY29uc3Qgb2xkUG9zaXRpb24gPSBpdGVtLm9sZFBvc2l0aW9uO1xyXG4gICAgICBjb25zdCBuZXdQb3NpdGlvbiA9IGl0ZW0ubmV3UG9zaXRpb247XHJcbiAgICAgIGNvbnN0IGNoYXJnZSA9IGl0ZW0uY2hhcmdlO1xyXG5cclxuICAgICAgZm9yICggbGV0IGogPSAwOyBqIDwgdGhpcy5tb2RlbFBvc2l0aW9ucy5sZW5ndGg7IGorKyApIHtcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMubW9kZWxQb3NpdGlvbnNbIGogXTtcclxuICAgICAgICBsZXQgZWxlY3RyaWNQb3RlbnRpYWwgPSB0aGlzLmVsZWN0cmljUG90ZW50aWFsc1sgaiBdO1xyXG5cclxuICAgICAgICBpZiAoIG9sZFBvc2l0aW9uICkge1xyXG4gICAgICAgICAgY29uc3Qgb2xkRGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZSggb2xkUG9zaXRpb24gKTtcclxuICAgICAgICAgIGlmICggb2xkRGlzdGFuY2UgIT09IDAgKSB7XHJcbiAgICAgICAgICAgIGVsZWN0cmljUG90ZW50aWFsIC09IGNoYXJnZSAqIGtDb25zdGFudCAvIG9sZERpc3RhbmNlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCBuZXdQb3NpdGlvbiApIHtcclxuICAgICAgICAgIGNvbnN0IG5ld0Rpc3RhbmNlID0gcG9zaXRpb24uZGlzdGFuY2UoIG5ld1Bvc2l0aW9uICk7XHJcbiAgICAgICAgICBpZiAoIG5ld0Rpc3RhbmNlICE9PSAwICkge1xyXG4gICAgICAgICAgICBlbGVjdHJpY1BvdGVudGlhbCArPSBjaGFyZ2UgKiBrQ29uc3RhbnQgLyBuZXdEaXN0YW5jZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZWxlY3RyaWNQb3RlbnRpYWxzWyBqIF0gPSBlbGVjdHJpY1BvdGVudGlhbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2hhcmdlVHJhY2tlci5jbGVhcigpO1xyXG5cclxuICAgIC8vIFVwZGF0ZSBvdXIgZGlyZWN0IGNhbnZhcyBpZiBuZWNlc3NhcnlcclxuICAgIGlmICggbnVtQ2hhbmdlcyB8fCB0aGlzLmRpcmVjdENhbnZhc0RpcnR5ICkge1xyXG4gICAgICBjb25zdCB6ZXJvQ29sb3IgPSBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmVsZWN0cmljUG90ZW50aWFsR3JpZFplcm9Qcm9wZXJ0eS5nZXQoKTtcclxuICAgICAgY29uc3QgcG9zaXRpdmVDb2xvciA9IENoYXJnZXNBbmRGaWVsZHNDb2xvcnMuZWxlY3RyaWNQb3RlbnRpYWxHcmlkU2F0dXJhdGlvblBvc2l0aXZlUHJvcGVydHkuZ2V0KCk7XHJcbiAgICAgIGNvbnN0IG5lZ2F0aXZlQ29sb3IgPSBDaGFyZ2VzQW5kRmllbGRzQ29sb3JzLmVsZWN0cmljUG90ZW50aWFsR3JpZFNhdHVyYXRpb25OZWdhdGl2ZVByb3BlcnR5LmdldCgpO1xyXG4gICAgICBjb25zdCBkYXRhID0gdGhpcy5pbWFnZURhdGEuZGF0YTtcclxuXHJcbiAgICAgIGZvciAoIGxldCBrID0gMDsgayA8IHRoaXMuZWxlY3RyaWNQb3RlbnRpYWxzLmxlbmd0aDsgaysrICkge1xyXG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuZWxlY3RyaWNQb3RlbnRpYWxzWyBrIF0gLyA0MDsgLy8gbWFwcGVkIHdpdGggc3BlY2lhbCBjb25zdGFudFxyXG5cclxuICAgICAgICBsZXQgZXh0cmVtZUNvbG9yO1xyXG4gICAgICAgIGlmICggdmFsdWUgPiAwICkge1xyXG4gICAgICAgICAgZXh0cmVtZUNvbG9yID0gcG9zaXRpdmVDb2xvcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICB2YWx1ZSA9IC12YWx1ZTtcclxuICAgICAgICAgIGV4dHJlbWVDb2xvciA9IG5lZ2F0aXZlQ29sb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhbHVlID0gTWF0aC5taW4oIHZhbHVlLCAxICk7IC8vIGNsYW1wIHRvIFswLDFdXHJcblxyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IDQgKiBrO1xyXG4gICAgICAgIGRhdGFbIG9mZnNldCArIDAgXSA9IGV4dHJlbWVDb2xvci5yICogdmFsdWUgKyB6ZXJvQ29sb3IuciAqICggMSAtIHZhbHVlICk7XHJcbiAgICAgICAgZGF0YVsgb2Zmc2V0ICsgMSBdID0gZXh0cmVtZUNvbG9yLmcgKiB2YWx1ZSArIHplcm9Db2xvci5nICogKCAxIC0gdmFsdWUgKTtcclxuICAgICAgICBkYXRhWyBvZmZzZXQgKyAyIF0gPSBleHRyZW1lQ29sb3IuYiAqIHZhbHVlICsgemVyb0NvbG9yLmIgKiAoIDEgLSB2YWx1ZSApO1xyXG4gICAgICAgIGRhdGFbIG9mZnNldCArIDMgXSA9IDI1NSAqICggZXh0cmVtZUNvbG9yLmEgKiB2YWx1ZSArIHplcm9Db2xvci5hICogKCAxIC0gdmFsdWUgKSApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmRpcmVjdENvbnRleHQucHV0SW1hZ2VEYXRhKCB0aGlzLmltYWdlRGF0YSwgMCwgMCApO1xyXG5cclxuICAgICAgdGhpcy5kaXJlY3RDYW52YXNEaXJ0eSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRnVuY3Rpb24gcmVzcG9uc2libGUgZm9yIHBhaW50aW5nIHRoZSBjYW52YXMgTm9kZSBhcyBhIGdyaWQgYXJyYXkgb2Ygc3F1YXJlc1xyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dFxyXG4gICAqL1xyXG4gIHBhaW50Q2FudmFzKCBjb250ZXh0ICkge1xyXG4gICAgdGhpcy51cGRhdGVFbGVjdHJpY1BvdGVudGlhbHMoKTtcclxuXHJcbiAgICBjb250ZXh0LnNhdmUoKTtcclxuXHJcbiAgICBjb25zdCBzeCA9IHRoaXMudmlld0JvdW5kcy53aWR0aCAvIHRoaXMuZGlyZWN0Q2FudmFzLndpZHRoO1xyXG4gICAgY29uc3Qgc3kgPSAtdGhpcy52aWV3Qm91bmRzLmhlaWdodCAvIHRoaXMuZGlyZWN0Q2FudmFzLmhlaWdodDtcclxuICAgIGNvbnN0IHR4ID0gdGhpcy52aWV3Qm91bmRzLm1pblg7XHJcbiAgICBjb25zdCB0eSA9IHRoaXMudmlld0JvdW5kcy5tYXhZO1xyXG4gICAgY29udGV4dC50cmFuc2Zvcm0oIHN4LCAwLCAwLCBzeSwgdHgsIHR5ICk7XHJcblxyXG4gICAgY29udGV4dC5kcmF3SW1hZ2UoIHRoaXMuZGlyZWN0Q2FudmFzLCAwLCAwICk7XHJcblxyXG4gICAgY29udGV4dC5yZXN0b3JlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZWxlYXNlcyByZWZlcmVuY2VzXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGRpc3Bvc2UoKSB7XHJcbiAgICB0aGlzLmRpc3Bvc2VFbGVjdHJpY1BvdGVudGlhbENhbnZhc05vZGUoKTtcclxuICB9XHJcbn1cclxuXHJcbmNoYXJnZXNBbmRGaWVsZHMucmVnaXN0ZXIoICdFbGVjdHJpY1BvdGVudGlhbENhbnZhc05vZGUnLCBFbGVjdHJpY1BvdGVudGlhbENhbnZhc05vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgRWxlY3RyaWNQb3RlbnRpYWxDYW52YXNOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELFNBQVNDLFVBQVUsUUFBUSxtQ0FBbUM7QUFDOUQsT0FBT0MsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBQ3hELE9BQU9DLHNCQUFzQixNQUFNLDhCQUE4QjtBQUNqRSxPQUFPQyx5QkFBeUIsTUFBTSxpQ0FBaUM7QUFDdkUsT0FBT0MsYUFBYSxNQUFNLG9CQUFvQjs7QUFFOUM7QUFDQSxNQUFNQyxpQ0FBaUMsR0FBR0YseUJBQXlCLENBQUNFLGlDQUFpQztBQUVyRyxNQUFNQywyQkFBMkIsU0FBU04sVUFBVSxDQUFDO0VBRW5EO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFTyxXQUFXQSxDQUFFQyxnQkFBZ0IsRUFDaEJDLGtCQUFrQixFQUNsQkMsV0FBVyxFQUNYQyxpQkFBaUIsRUFBRztJQUUvQixLQUFLLENBQUU7TUFDTEMsWUFBWSxFQUFFSCxrQkFBa0IsQ0FBQ0ksaUJBQWlCLENBQUVILFdBQVk7SUFDbEUsQ0FBRSxDQUFDO0lBRUgsSUFBSSxDQUFDSSxhQUFhLEdBQUcsSUFBSVYsYUFBYSxDQUFFSSxnQkFBaUIsQ0FBQztJQUUxRCxJQUFJLENBQUND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