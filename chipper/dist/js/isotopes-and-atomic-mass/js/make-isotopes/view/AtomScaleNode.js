// Copyright 2014-2023, University of Colorado Boulder

/**
 * Node that represents a scale on which an atom can be weighed.
 *
 * @author John Blanco
 * @author Jesse Greenberg
 * @author Aadish Gupta
 */

import Property from '../../../../axon/js/Property.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import Utils from '../../../../dot/js/Utils.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Image, Node, Text } from '../../../../scenery/js/imports.js';
import AquaRadioButton from '../../../../sun/js/AquaRadioButton.js';
import Panel from '../../../../sun/js/Panel.js';
import scale_png from '../../../mipmaps/scale_png.js';
import isotopesAndAtomicMass from '../../isotopesAndAtomicMass.js';
import IsotopesAndAtomicMassStrings from '../../IsotopesAndAtomicMassStrings.js';
const atomicMassString = IsotopesAndAtomicMassStrings.atomicMass;
const massNumberString = IsotopesAndAtomicMassStrings.massNumber;

// class data
const DISPLAY_MODE = {
  MASS_NUMBER: 'mass number',
  ATOMIC_MASS: 'atomic mass'
};
const SCALE_WIDTH = 275; //This is the width Aspect Ratio will control height
const READOUT_SIZE = new Dimension2(80, 50);

/**
 * Utility function that defines the readout on the front of the scale. This readout can display an atom's mass as
 * either the mass number, which is an integer number representing the total number of nucleons, or as the atomic
 * mass, which is the relative actual mass of the atom.
 *
 * @param {NumberAtom} atom
 * @param {Property} displayModeProperty
 */
function ScaleReadoutNode(atom, displayModeProperty) {
  this.atom = atom;
  const readoutText = new Text('', {
    font: new PhetFont(20),
    maxWidth: 0.9 * READOUT_SIZE.width,
    maxHeight: 0.9 * READOUT_SIZE.height
  });
  function updateReadout() {
    if (displayModeProperty.get() === DISPLAY_MODE.MASS_NUMBER) {
      readoutText.setString(atom.massNumberProperty.get().toString());
    } else {
      const isotopeAtomicMass = atom.getIsotopeAtomicMass();
      readoutText.setString(isotopeAtomicMass > 0 ? Utils.toFixed(isotopeAtomicMass, 5) : '--');
    }

    // Center the text in the display.
    readoutText.centerX = READOUT_SIZE.width / 2;
    readoutText.centerY = READOUT_SIZE.height * 0.325;
  }

  // Watch the property that represents the display mode and update the readout when it changes.
  // Doesn't need unlink as it stays through out the sim life
  displayModeProperty.link(() => {
    updateReadout();
  });

  // Watch the atom and update the readout whenever it changes.
  // Doesn't need unlink as it stays through out the sim life
  atom.massNumberProperty.link(() => {
    updateReadout();
  });
  return new Panel(readoutText, {
    minWidth: READOUT_SIZE.width,
    minHeight: READOUT_SIZE.height,
    resize: false,
    cornerRadius: 5,
    lineWidth: 3,
    align: 'center'
  });
}

/**
 * Creates and return a node containing the radio buttons that allow the user to select the display mode for the scale.
 *
 * @param {Property} displayModeProperty
 */
function DisplayModeSelectionNode(displayModeProperty) {
  const radioButtonRadius = 6;
  const LABEL_FONT = new PhetFont(14);
  const massNumberButton = new AquaRadioButton(displayModeProperty, DISPLAY_MODE.MASS_NUMBER, new Text(massNumberString, {
    font: LABEL_FONT,
    maxWidth: 125,
    fill: 'white'
  }), {
    radius: radioButtonRadius
  });
  const atomicMassButton = new AquaRadioButton(displayModeProperty, DISPLAY_MODE.ATOMIC_MASS, new Text(atomicMassString, {
    font: LABEL_FONT,
    maxWidth: 125,
    fill: 'white'
  }), {
    radius: radioButtonRadius
  });
  const displayButtonGroup = new Node();
  displayButtonGroup.addChild(massNumberButton);
  atomicMassButton.top = massNumberButton.bottom + 8;
  atomicMassButton.left = displayButtonGroup.left;
  displayButtonGroup.addChild(atomicMassButton);
  return displayButtonGroup;
}
class AtomScaleNode extends Node {
  /**
   * Constructor for an AtomScaleNode.
   *
   * @param {ParticleAtom} atom
   */
  constructor(atom) {
    super();
    this.displayModeProperty = new Property(DISPLAY_MODE.MASS_NUMBER);

    // This is Loading the scale image and scaling it to desired width and adding to the node
    const weighScaleImage = new Image(scale_png);
    weighScaleImage.scale(SCALE_WIDTH / weighScaleImage.width);
    this.addChild(weighScaleImage);

    // Add the scale readout node which displays either atomic mass or number.
    const scaleReadoutNode = new ScaleReadoutNode(atom, this.displayModeProperty);
    scaleReadoutNode.left = SCALE_WIDTH * 0.075; // empirically determined
    scaleReadoutNode.centerY = weighScaleImage.height * 0.7; // empirically determined

    this.addChild(scaleReadoutNode);

    // Add the display mode selector to the scale base.
    const displayModeSelectionNode = new DisplayModeSelectionNode(this.displayModeProperty);
    // Position the selector next to the readout.
    displayModeSelectionNode.centerX = (scaleReadoutNode.right + weighScaleImage.width - 5) / 2; // empirically determined
    displayModeSelectionNode.centerY = weighScaleImage.height * 0.7; // empirically determined
    this.addChild(displayModeSelectionNode);
  }

  /**
   * Reset the atom scale node to its initial state by resetting the display mode property.
   * @public
   */
  reset() {
    this.displayModeProperty.reset();
  }
}
isotopesAndAtomicMass.register('AtomScaleNode', AtomScaleNode);
export default AtomScaleNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIkRpbWVuc2lvbjIiLCJVdGlscyIsIlBoZXRGb250IiwiSW1hZ2UiLCJOb2RlIiwiVGV4dCIsIkFxdWFSYWRpb0J1dHRvbiIsIlBhbmVsIiwic2NhbGVfcG5nIiwiaXNvdG9wZXNBbmRBdG9taWNNYXNzIiwiSXNvdG9wZXNBbmRBdG9taWNNYXNzU3RyaW5ncyIsImF0b21pY01hc3NTdHJpbmciLCJhdG9taWNNYXNzIiwibWFzc051bWJlclN0cmluZyIsIm1hc3NOdW1iZXIiLCJESVNQTEFZX01PREUiLCJNQVNTX05VTUJFUiIsIkFUT01JQ19NQVNTIiwiU0NBTEVfV0lEVEgiLCJSRUFET1VUX1NJWkUiLCJTY2FsZVJlYWRvdXROb2RlIiwiYXRvbSIsImRpc3BsYXlNb2RlUHJvcGVydHkiLCJyZWFkb3V0VGV4dCIsImZvbnQiLCJtYXhXaWR0aCIsIndpZHRoIiwibWF4SGVpZ2h0IiwiaGVpZ2h0IiwidXBkYXRlUmVhZG91dCIsImdldCIsInNldFN0cmluZyIsIm1hc3NOdW1iZXJQcm9wZXJ0eSIsInRvU3RyaW5nIiwiaXNvdG9wZUF0b21pY01hc3MiLCJnZXRJc290b3BlQXRvbWljTWFzcyIsInRvRml4ZWQiLCJjZW50ZXJYIiwiY2VudGVyWSIsImxpbmsiLCJtaW5XaWR0aCIsIm1pbkhlaWdodCIsInJlc2l6ZSIsImNvcm5lclJhZGl1cyIsImxpbmVXaWR0aCIsImFsaWduIiwiRGlzcGxheU1vZGVTZWxlY3Rpb25Ob2RlIiwicmFkaW9CdXR0b25SYWRpdXMiLCJMQUJFTF9GT05UIiwibWFzc051bWJlckJ1dHRvbiIsImZpbGwiLCJyYWRpdXMiLCJhdG9taWNNYXNzQnV0dG9uIiwiZGlzcGxheUJ1dHRvbkdyb3VwIiwiYWRkQ2hpbGQiLCJ0b3AiLCJib3R0b20iLCJsZWZ0IiwiQXRvbVNjYWxlTm9kZSIsImNvbnN0cnVjdG9yIiwid2VpZ2hTY2FsZUltYWdlIiwic2NhbGUiLCJzY2FsZVJlYWRvdXROb2RlIiwiZGlzcGxheU1vZGVTZWxlY3Rpb25Ob2RlIiwicmlnaHQiLCJyZXNldCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQXRvbVNjYWxlTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBOb2RlIHRoYXQgcmVwcmVzZW50cyBhIHNjYWxlIG9uIHdoaWNoIGFuIGF0b20gY2FuIGJlIHdlaWdoZWQuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmdcclxuICogQGF1dGhvciBBYWRpc2ggR3VwdGFcclxuICovXHJcblxyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBEaW1lbnNpb24yIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9EaW1lbnNpb24yLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUGhldEZvbnQuanMnO1xyXG5pbXBvcnQgeyBJbWFnZSwgTm9kZSwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBBcXVhUmFkaW9CdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL0FxdWFSYWRpb0J1dHRvbi5qcyc7XHJcbmltcG9ydCBQYW5lbCBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvUGFuZWwuanMnO1xyXG5pbXBvcnQgc2NhbGVfcG5nIGZyb20gJy4uLy4uLy4uL21pcG1hcHMvc2NhbGVfcG5nLmpzJztcclxuaW1wb3J0IGlzb3RvcGVzQW5kQXRvbWljTWFzcyBmcm9tICcuLi8uLi9pc290b3Blc0FuZEF0b21pY01hc3MuanMnO1xyXG5pbXBvcnQgSXNvdG9wZXNBbmRBdG9taWNNYXNzU3RyaW5ncyBmcm9tICcuLi8uLi9Jc290b3Blc0FuZEF0b21pY01hc3NTdHJpbmdzLmpzJztcclxuXHJcbmNvbnN0IGF0b21pY01hc3NTdHJpbmcgPSBJc290b3Blc0FuZEF0b21pY01hc3NTdHJpbmdzLmF0b21pY01hc3M7XHJcbmNvbnN0IG1hc3NOdW1iZXJTdHJpbmcgPSBJc290b3Blc0FuZEF0b21pY01hc3NTdHJpbmdzLm1hc3NOdW1iZXI7XHJcblxyXG4vLyBjbGFzcyBkYXRhXHJcbmNvbnN0IERJU1BMQVlfTU9ERSA9IHsgTUFTU19OVU1CRVI6ICdtYXNzIG51bWJlcicsIEFUT01JQ19NQVNTOiAnYXRvbWljIG1hc3MnIH07XHJcbmNvbnN0IFNDQUxFX1dJRFRIID0gMjc1OyAvL1RoaXMgaXMgdGhlIHdpZHRoIEFzcGVjdCBSYXRpbyB3aWxsIGNvbnRyb2wgaGVpZ2h0XHJcbmNvbnN0IFJFQURPVVRfU0laRSA9IG5ldyBEaW1lbnNpb24yKCA4MCwgNTAgKTtcclxuXHJcbi8qKlxyXG4gKiBVdGlsaXR5IGZ1bmN0aW9uIHRoYXQgZGVmaW5lcyB0aGUgcmVhZG91dCBvbiB0aGUgZnJvbnQgb2YgdGhlIHNjYWxlLiBUaGlzIHJlYWRvdXQgY2FuIGRpc3BsYXkgYW4gYXRvbSdzIG1hc3MgYXNcclxuICogZWl0aGVyIHRoZSBtYXNzIG51bWJlciwgd2hpY2ggaXMgYW4gaW50ZWdlciBudW1iZXIgcmVwcmVzZW50aW5nIHRoZSB0b3RhbCBudW1iZXIgb2YgbnVjbGVvbnMsIG9yIGFzIHRoZSBhdG9taWNcclxuICogbWFzcywgd2hpY2ggaXMgdGhlIHJlbGF0aXZlIGFjdHVhbCBtYXNzIG9mIHRoZSBhdG9tLlxyXG4gKlxyXG4gKiBAcGFyYW0ge051bWJlckF0b219IGF0b21cclxuICogQHBhcmFtIHtQcm9wZXJ0eX0gZGlzcGxheU1vZGVQcm9wZXJ0eVxyXG4gKi9cclxuZnVuY3Rpb24gU2NhbGVSZWFkb3V0Tm9kZSggYXRvbSwgZGlzcGxheU1vZGVQcm9wZXJ0eSApIHtcclxuICB0aGlzLmF0b20gPSBhdG9tO1xyXG5cclxuICBjb25zdCByZWFkb3V0VGV4dCA9IG5ldyBUZXh0KCAnJywge1xyXG4gICAgZm9udDogbmV3IFBoZXRGb250KCAyMCApLFxyXG4gICAgbWF4V2lkdGg6IDAuOSAqIFJFQURPVVRfU0laRS53aWR0aCxcclxuICAgIG1heEhlaWdodDogMC45ICogUkVBRE9VVF9TSVpFLmhlaWdodFxyXG4gIH0gKTtcclxuXHJcbiAgZnVuY3Rpb24gdXBkYXRlUmVhZG91dCgpIHtcclxuICAgIGlmICggZGlzcGxheU1vZGVQcm9wZXJ0eS5nZXQoKSA9PT0gRElTUExBWV9NT0RFLk1BU1NfTlVNQkVSICkge1xyXG4gICAgICByZWFkb3V0VGV4dC5zZXRTdHJpbmcoIGF0b20ubWFzc051bWJlclByb3BlcnR5LmdldCgpLnRvU3RyaW5nKCkgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjb25zdCBpc290b3BlQXRvbWljTWFzcyA9IGF0b20uZ2V0SXNvdG9wZUF0b21pY01hc3MoKTtcclxuICAgICAgcmVhZG91dFRleHQuc2V0U3RyaW5nKCBpc290b3BlQXRvbWljTWFzcyA+IDAgPyBVdGlscy50b0ZpeGVkKCBpc290b3BlQXRvbWljTWFzcywgNSApIDogJy0tJyApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENlbnRlciB0aGUgdGV4dCBpbiB0aGUgZGlzcGxheS5cclxuICAgIHJlYWRvdXRUZXh0LmNlbnRlclggPSBSRUFET1VUX1NJWkUud2lkdGggLyAyO1xyXG4gICAgcmVhZG91dFRleHQuY2VudGVyWSA9IFJFQURPVVRfU0laRS5oZWlnaHQgKiAwLjMyNTtcclxuICB9XHJcblxyXG4gIC8vIFdhdGNoIHRoZSBwcm9wZXJ0eSB0aGF0IHJlcHJlc2VudHMgdGhlIGRpc3BsYXkgbW9kZSBhbmQgdXBkYXRlIHRoZSByZWFkb3V0IHdoZW4gaXQgY2hhbmdlcy5cclxuICAvLyBEb2Vzbid0IG5lZWQgdW5saW5rIGFzIGl0IHN0YXlzIHRocm91Z2ggb3V0IHRoZSBzaW0gbGlmZVxyXG4gIGRpc3BsYXlNb2RlUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgdXBkYXRlUmVhZG91dCgpO1xyXG4gIH0gKTtcclxuXHJcbiAgLy8gV2F0Y2ggdGhlIGF0b20gYW5kIHVwZGF0ZSB0aGUgcmVhZG91dCB3aGVuZXZlciBpdCBjaGFuZ2VzLlxyXG4gIC8vIERvZXNuJ3QgbmVlZCB1bmxpbmsgYXMgaXQgc3RheXMgdGhyb3VnaCBvdXQgdGhlIHNpbSBsaWZlXHJcbiAgYXRvbS5tYXNzTnVtYmVyUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgdXBkYXRlUmVhZG91dCgpO1xyXG4gIH0gKTtcclxuXHJcbiAgcmV0dXJuIG5ldyBQYW5lbCggcmVhZG91dFRleHQsIHtcclxuICAgIG1pbldpZHRoOiBSRUFET1VUX1NJWkUud2lkdGgsXHJcbiAgICBtaW5IZWlnaHQ6IFJFQURPVVRfU0laRS5oZWlnaHQsXHJcbiAgICByZXNpemU6IGZhbHNlLFxyXG4gICAgY29ybmVyUmFkaXVzOiA1LFxyXG4gICAgbGluZVdpZHRoOiAzLFxyXG4gICAgYWxpZ246ICdjZW50ZXInXHJcbiAgfSApO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlcyBhbmQgcmV0dXJuIGEgbm9kZSBjb250YWluaW5nIHRoZSByYWRpbyBidXR0b25zIHRoYXQgYWxsb3cgdGhlIHVzZXIgdG8gc2VsZWN0IHRoZSBkaXNwbGF5IG1vZGUgZm9yIHRoZSBzY2FsZS5cclxuICpcclxuICogQHBhcmFtIHtQcm9wZXJ0eX0gZGlzcGxheU1vZGVQcm9wZXJ0eVxyXG4gKi9cclxuZnVuY3Rpb24gRGlzcGxheU1vZGVTZWxlY3Rpb25Ob2RlKCBkaXNwbGF5TW9kZVByb3BlcnR5ICkge1xyXG4gIGNvbnN0IHJhZGlvQnV0dG9uUmFkaXVzID0gNjtcclxuICBjb25zdCBMQUJFTF9GT05UID0gbmV3IFBoZXRGb250KCAxNCApO1xyXG4gIGNvbnN0IG1hc3NOdW1iZXJCdXR0b24gPSBuZXcgQXF1YVJhZGlvQnV0dG9uKCBkaXNwbGF5TW9kZVByb3BlcnR5LCBESVNQTEFZX01PREUuTUFTU19OVU1CRVIsXHJcbiAgICBuZXcgVGV4dCggbWFzc051bWJlclN0cmluZywge1xyXG4gICAgICBmb250OiBMQUJFTF9GT05ULFxyXG4gICAgICBtYXhXaWR0aDogMTI1LFxyXG4gICAgICBmaWxsOiAnd2hpdGUnXHJcbiAgICB9ICksIHsgcmFkaXVzOiByYWRpb0J1dHRvblJhZGl1cyB9ICk7XHJcbiAgY29uc3QgYXRvbWljTWFzc0J1dHRvbiA9IG5ldyBBcXVhUmFkaW9CdXR0b24oIGRpc3BsYXlNb2RlUHJvcGVydHksIERJU1BMQVlfTU9ERS5BVE9NSUNfTUFTUyxcclxuICAgIG5ldyBUZXh0KCBhdG9taWNNYXNzU3RyaW5nLCB7XHJcbiAgICAgIGZvbnQ6IExBQkVMX0ZPTlQsXHJcbiAgICAgIG1heFdpZHRoOiAxMjUsXHJcbiAgICAgIGZpbGw6ICd3aGl0ZSdcclxuICAgIH0gKSwgeyByYWRpdXM6IHJhZGlvQnV0dG9uUmFkaXVzIH0gKTtcclxuICBjb25zdCBkaXNwbGF5QnV0dG9uR3JvdXAgPSBuZXcgTm9kZSgpO1xyXG4gIGRpc3BsYXlCdXR0b25Hcm91cC5hZGRDaGlsZCggbWFzc051bWJlckJ1dHRvbiApO1xyXG4gIGF0b21pY01hc3NCdXR0b24udG9wID0gbWFzc051bWJlckJ1dHRvbi5ib3R0b20gKyA4O1xyXG4gIGF0b21pY01hc3NCdXR0b24ubGVmdCA9IGRpc3BsYXlCdXR0b25Hcm91cC5sZWZ0O1xyXG4gIGRpc3BsYXlCdXR0b25Hcm91cC5hZGRDaGlsZCggYXRvbWljTWFzc0J1dHRvbiApO1xyXG4gIHJldHVybiBkaXNwbGF5QnV0dG9uR3JvdXA7XHJcbn1cclxuXHJcbmNsYXNzIEF0b21TY2FsZU5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQ29uc3RydWN0b3IgZm9yIGFuIEF0b21TY2FsZU5vZGUuXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge1BhcnRpY2xlQXRvbX0gYXRvbVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBhdG9tICkge1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5kaXNwbGF5TW9kZVByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBESVNQTEFZX01PREUuTUFTU19OVU1CRVIgKTtcclxuXHJcbiAgICAvLyBUaGlzIGlzIExvYWRpbmcgdGhlIHNjYWxlIGltYWdlIGFuZCBzY2FsaW5nIGl0IHRvIGRlc2lyZWQgd2lkdGggYW5kIGFkZGluZyB0byB0aGUgbm9kZVxyXG4gICAgY29uc3Qgd2VpZ2hTY2FsZUltYWdlID0gbmV3IEltYWdlKCBzY2FsZV9wbmcgKTtcclxuICAgIHdlaWdoU2NhbGVJbWFnZS5zY2FsZSggU0NBTEVfV0lEVEggLyB3ZWlnaFNjYWxlSW1hZ2Uud2lkdGggKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHdlaWdoU2NhbGVJbWFnZSApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgc2NhbGUgcmVhZG91dCBub2RlIHdoaWNoIGRpc3BsYXlzIGVpdGhlciBhdG9taWMgbWFzcyBvciBudW1iZXIuXHJcbiAgICBjb25zdCBzY2FsZVJlYWRvdXROb2RlID0gbmV3IFNjYWxlUmVhZG91dE5vZGUoIGF0b20sIHRoaXMuZGlzcGxheU1vZGVQcm9wZXJ0eSApO1xyXG4gICAgc2NhbGVSZWFkb3V0Tm9kZS5sZWZ0ID0gU0NBTEVfV0lEVEggKiAwLjA3NTsgLy8gZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG4gICAgc2NhbGVSZWFkb3V0Tm9kZS5jZW50ZXJZID0gd2VpZ2hTY2FsZUltYWdlLmhlaWdodCAqIDAuNzsgLy8gZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIHNjYWxlUmVhZG91dE5vZGUgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGRpc3BsYXkgbW9kZSBzZWxlY3RvciB0byB0aGUgc2NhbGUgYmFzZS5cclxuICAgIGNvbnN0IGRpc3BsYXlNb2RlU2VsZWN0aW9uTm9kZSA9IG5ldyBEaXNwbGF5TW9kZVNlbGVjdGlvbk5vZGUoIHRoaXMuZGlzcGxheU1vZGVQcm9wZXJ0eSApO1xyXG4gICAgLy8gUG9zaXRpb24gdGhlIHNlbGVjdG9yIG5leHQgdG8gdGhlIHJlYWRvdXQuXHJcbiAgICBkaXNwbGF5TW9kZVNlbGVjdGlvbk5vZGUuY2VudGVyWCA9ICggc2NhbGVSZWFkb3V0Tm9kZS5yaWdodCArIHdlaWdoU2NhbGVJbWFnZS53aWR0aCAtIDUgKSAvIDI7IC8vIGVtcGlyaWNhbGx5IGRldGVybWluZWRcclxuICAgIGRpc3BsYXlNb2RlU2VsZWN0aW9uTm9kZS5jZW50ZXJZID0gd2VpZ2hTY2FsZUltYWdlLmhlaWdodCAqIDAuNzsgLy8gZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG4gICAgdGhpcy5hZGRDaGlsZCggZGlzcGxheU1vZGVTZWxlY3Rpb25Ob2RlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNldCB0aGUgYXRvbSBzY2FsZSBub2RlIHRvIGl0cyBpbml0aWFsIHN0YXRlIGJ5IHJlc2V0dGluZyB0aGUgZGlzcGxheSBtb2RlIHByb3BlcnR5LlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICByZXNldCgpIHtcclxuICAgIHRoaXMuZGlzcGxheU1vZGVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gIH1cclxufVxyXG5cclxuaXNvdG9wZXNBbmRBdG9taWNNYXNzLnJlZ2lzdGVyKCAnQXRvbVNjYWxlTm9kZScsIEF0b21TY2FsZU5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgQXRvbVNjYWxlTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFFBQVEsTUFBTSxpQ0FBaUM7QUFDdEQsT0FBT0MsVUFBVSxNQUFNLGtDQUFrQztBQUN6RCxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsU0FBU0MsS0FBSyxFQUFFQyxJQUFJLEVB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