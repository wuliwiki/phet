// Copyright 2014-2023, University of Colorado Boulder

/**
 * This class defines a Node that represents an atom in "schematic" (i.e. Bohr) form and allows users to add or remove
 * neutrons from/to a bucket in order to create different isotopes of a particular atom.
 *
 * @author John Blanco
 * @author Jesse Greenberg
 * @author Aadish Gupta
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import BucketFront from '../../../../scenery-phet/js/bucket/BucketFront.js';
import BucketHole from '../../../../scenery-phet/js/bucket/BucketHole.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Node, Text } from '../../../../scenery/js/imports.js';
import AtomIdentifier from '../../../../shred/js/AtomIdentifier.js';
import ShredStrings from '../../../../shred/js/ShredStrings.js';
import BucketDragListener from '../../../../shred/js/view/BucketDragListener.js';
import ParticleView from '../../../../shred/js/view/ParticleView.js';
import isotopesAndAtomicMass from '../../isotopesAndAtomicMass.js';
import IsotopesAndAtomicMassStrings from '../../IsotopesAndAtomicMassStrings.js';
import IsotopeAtomNode from './IsotopeAtomNode.js';
const myIsotopeString = IsotopesAndAtomicMassStrings.myIsotope;
const stableString = ShredStrings.stable;
const unstableString = ShredStrings.unstable;

// constants
const NUM_NUCLEON_LAYERS = 5; // This is based on max number of particles, may need adjustment if that changes.
const ELEMENT_NAME_FONT_SIZE = 16;
class InteractiveIsotopeNode extends Node {
  /**
   * Constructor for an InteractiveIsotopeNode
   * @param {MakeIsotopesModel} makeIsotopesModel
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Vector2} bottomPoint
   */
  constructor(makeIsotopesModel, modelViewTransform, bottomPoint) {
    super();
    this.modelViewTransform = modelViewTransform; // extend scope of modelViewTransform.

    // Add the node that shows the textual labels and electron cloud.
    const isotopeAtomNode = new IsotopeAtomNode(makeIsotopesModel.particleAtom, bottomPoint, modelViewTransform);
    this.addChild(isotopeAtomNode);
    const myIsotopeLabel = new Text(myIsotopeString, {
      font: new PhetFont({
        size: 16,
        weight: 'bold'
      }),
      fill: 'black',
      centerX: isotopeAtomNode.centerX,
      maxWidth: 100
    });
    this.addChild(myIsotopeLabel);
    myIsotopeLabel.bottom = isotopeAtomNode.top - 5;

    // Add the bucket components that hold the neutrons.
    const neutronBucketHole = new BucketHole(makeIsotopesModel.neutronBucket, modelViewTransform);
    const neutronBucketFront = new BucketFront(makeIsotopesModel.neutronBucket, modelViewTransform);
    neutronBucketFront.addInputListener(new BucketDragListener(makeIsotopesModel.neutronBucket, neutronBucketFront, modelViewTransform));

    // Bucket hole is first item added to view for proper layering.
    this.addChild(neutronBucketHole);

    // Add the layers where the nucleons will be maintained.
    const nucleonLayersNode = new Node();
    const nucleonLayers = [];
    _.times(NUM_NUCLEON_LAYERS, () => {
      const nucleonLayer = new Node();
      nucleonLayers.push(nucleonLayer);
      nucleonLayersNode.addChild(nucleonLayer);
    });
    nucleonLayers.reverse(); // Set up the nucleon layers so that layer 0 is in front.

    // Function to adjust z-layer ordering for a particle. This is to be linked to the particle's zLayer property.
    const adjustZLayer = (addedAtom, zLayer) => {
      assert && assert(nucleonLayers.length > zLayer, 'zLayer for proton exceeds number of layers, max number may need increasing.');
      // Determine whether proton view is on the correct layer.
      let onCorrectLayer = false;
      nucleonLayers[zLayer].children.forEach(particleView => {
        if (particleView.particle === addedAtom) {
          onCorrectLayer = true;
        }
      });
      if (!onCorrectLayer) {
        // Remove particle view from its current layer.
        let particleView = null;
        for (let layerIndex = 0; layerIndex < nucleonLayers.length && particleView === null; layerIndex++) {
          for (let childIndex = 0; childIndex < nucleonLayers[layerIndex].children.length; childIndex++) {
            if (nucleonLayers[layerIndex].children[childIndex].particle === addedAtom) {
              particleView = nucleonLayers[layerIndex].children[childIndex];
              nucleonLayers[layerIndex].removeChildAt(childIndex);
              break;
            }
          }
        }
        // Add the particle view to its new layer.
        assert && assert(particleView !== null, 'Particle view not found during relayering');
        nucleonLayers[zLayer].addChild(particleView);
      }
    };

    // function to add the view for a nucleon, i.e. a proton or neutron
    const addParticleView = addedParticle => {
      assert && assert(addedParticle.type === 'proton' || addedParticle.type === 'neutron', 'unrecognized particle type');
      const particleView = new ParticleView(addedParticle, this.modelViewTransform);
      particleView.center = this.modelViewTransform.modelToViewPosition(addedParticle.positionProperty.get());
      particleView.pickable = addedParticle.type === 'neutron';

      // add particle view to correct z layer.
      nucleonLayers[addedParticle.zLayerProperty.get()].addChild(particleView);
      const adjustZLayerLink = zLayer => {
        adjustZLayer(addedParticle, zLayer);
      };

      // Add a listener that adjusts a nucleon's z-order layering.
      addedParticle.zLayerProperty.link(adjustZLayerLink);
      const moveParticleToFront = value => {
        if (value) {
          particleView.moveToFront();
        }
      };
      addedParticle.userControlledProperty.link(moveParticleToFront);

      // Add the item removed listener.
      let temp;
      if (addedParticle.type === 'proton') {
        temp = makeIsotopesModel.protons;
      } else if (addedParticle.type === 'neutron') {
        temp = makeIsotopesModel.neutrons;
      }
      temp.addItemRemovedListener(function removalListener(removedAtom) {
        if (removedAtom === addedParticle) {
          nucleonLayers[addedParticle.zLayerProperty.get()].removeChild(particleView);
          particleView.dispose();
          addedParticle.zLayerProperty.unlink(adjustZLayerLink);
          addedParticle.userControlledProperty.unlink(moveParticleToFront);
          temp.removeItemRemovedListener(removalListener);
        }
      });
    };
    makeIsotopesModel.protons.forEach(proton => {
      addParticleView(proton);
    });
    makeIsotopesModel.neutrons.forEach(neutron => {
      addParticleView(neutron);
    });

    // add the item added listeners for particles of this isotope
    makeIsotopesModel.protons.addItemAddedListener(addedAtom => {
      addParticleView(addedAtom);
    });

    // add the item added listeners for particles of this isotope
    makeIsotopesModel.neutrons.addItemAddedListener(addedAtom => {
      addParticleView(addedAtom);
    });

    // Create the textual readout for the element name.
    const elementName = new Text('', {
      font: new PhetFont({
        size: ELEMENT_NAME_FONT_SIZE,
        weight: 'bold'
      })
    });
    this.addChild(elementName);

    // Define the update function for the element name.
    const updateElementName = (numProtons, numNeutrons) => {
      // This data structure maps the vertical distance of element name from the nucleus center for each supported
      // number of nucleons.  These values were empirically determined, and are set so that the label looks good and
      // doesn't overlap with the nucleus.
      const mapElementToPosition = {
        1: 35,
        2: 35,
        3: 40,
        4: 42,
        5: 44,
        6: 47,
        7: 47,
        8: 50,
        9: 50,
        10: 50
      };

      // get element name and append mass number to identify isotope
      let name = `${AtomIdentifier.getName(numProtons)}-${numProtons + numNeutrons}`;
      if (name.length === 0) {
        name = '';
      }
      elementName.string = name;
      const isotopeAtomNodeRadius = isotopeAtomNode.centerY - isotopeAtomNode.top;
      let elementNameMaxWidth;
      if (isotopeAtomNodeRadius > mapElementToPosition[numProtons]) {
        // limit the width of the element name to fit in the electron cloud
        elementNameMaxWidth = 2 * Math.sqrt(isotopeAtomNodeRadius * isotopeAtomNodeRadius - mapElementToPosition[numProtons] * mapElementToPosition[numProtons]);
      } else {
        // This else clause can occur if there are no electrons.  In that case, use an empirically determined max width.
        elementNameMaxWidth = 30;
      }
      elementName.maxWidth = elementNameMaxWidth;
      elementName.center = new Vector2(isotopeAtomNode.centerX, isotopeAtomNode.centerY - mapElementToPosition[numProtons]);
    };

    // Create the textual readout for the stability indicator.
    const stabilityIndicator = new Text('', {
      font: new PhetFont({
        size: 12,
        weight: 'bold'
      })
    });
    this.addChild(stabilityIndicator);

    // Define the update function for the stability indicator.
    const updateStabilityIndicator = (numProtons, numNeutrons) => {
      // This data structure maps the vertical distance of stable/unstable label to the center of nucleus so that labels
      // look good and don't overlap with nucleons in the nucleus. These values have been empirically determined
      const mapStableUnstableToPosition = {
        1: 30,
        2: 35,
        3: 40,
        4: 42,
        5: 44,
        6: 47,
        7: 47,
        8: 50,
        9: 50,
        10: 50
      };
      const stabilityIndicatorCenterPos = new Vector2(isotopeAtomNode.centerX, isotopeAtomNode.centerY + mapStableUnstableToPosition[numProtons]);
      const isotopeAtomNodeRadius = isotopeAtomNode.centerY - isotopeAtomNode.top;
      let stabilityIndicatorMaxWidth;
      if (isotopeAtomNodeRadius > mapStableUnstableToPosition[numProtons]) {
        // limit stability indicator label to fit inside the electron cloud
        stabilityIndicatorMaxWidth = 2 * Math.sqrt(isotopeAtomNodeRadius * isotopeAtomNodeRadius - mapStableUnstableToPosition[numProtons] * mapStableUnstableToPosition[numProtons]);
      } else {
        // This else clause can occur if there are no electrons.  In that case, use an empirically determined max width.
        stabilityIndicatorMaxWidth = 30;
      }

      // set the text of the stability indicator
      if (numProtons > 0) {
        if (AtomIdentifier.isStable(numProtons, numNeutrons)) {
          stabilityIndicator.string = stableString;
        } else {
          stabilityIndicator.string = unstableString;
        }
      } else {
        stabilityIndicator.string = '';
      }

      // position and limit the width
      stabilityIndicator.maxWidth = stabilityIndicatorMaxWidth;
      stabilityIndicator.center = stabilityIndicatorCenterPos;
    };
    this.addChild(nucleonLayersNode);
    // Add the neutron bucket child here for proper layering with neutrons.
    this.addChild(neutronBucketFront);
    makeIsotopesModel.atomReconfigured.addListener(() => {
      updateElementName(makeIsotopesModel.particleAtom.protonCountProperty.get(), makeIsotopesModel.particleAtom.neutronCountProperty.get());
      updateStabilityIndicator(makeIsotopesModel.particleAtom.protonCountProperty.get(), makeIsotopesModel.particleAtom.neutronCountProperty.get());
      myIsotopeLabel.bottom = isotopeAtomNode.top - 5;
    });

    // initial update
    updateElementName(makeIsotopesModel.particleAtom.protonCountProperty.get(), makeIsotopesModel.particleAtom.neutronCountProperty.get());
    updateStabilityIndicator(makeIsotopesModel.particleAtom.protonCountProperty.get(), makeIsotopesModel.particleAtom.neutronCountProperty.get());
  }
}
isotopesAndAtomicMass.register('InteractiveIsotopeNode', InteractiveIsotopeNode);
export default InteractiveIsotopeNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiQnVja2V0RnJvbnQiLCJCdWNrZXRIb2xlIiwiUGhldEZvbnQiLCJOb2RlIiwiVGV4dCIsIkF0b21JZGVudGlmaWVyIiwiU2hyZWRTdHJpbmdzIiwiQnVja2V0RHJhZ0xpc3RlbmVyIiwiUGFydGljbGVWaWV3IiwiaXNvdG9wZXNBbmRBdG9taWNNYXNzIiwiSXNvdG9wZXNBbmRBdG9taWNNYXNzU3RyaW5ncyIsIklzb3RvcGVBdG9tTm9kZSIsIm15SXNvdG9wZVN0cmluZyIsIm15SXNvdG9wZSIsInN0YWJsZVN0cmluZyIsInN0YWJsZSIsInVuc3RhYmxlU3RyaW5nIiwidW5zdGFibGUiLCJOVU1fTlVDTEVPTl9MQVlFUlMiLCJFTEVNRU5UX05BTUVfRk9OVF9TSVpFIiwiSW50ZXJhY3RpdmVJc290b3BlTm9kZSIsImNvbnN0cnVjdG9yIiwibWFrZUlzb3RvcGVzTW9kZWwiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJib3R0b21Qb2ludCIsImlzb3RvcGVBdG9tTm9kZSIsInBhcnRpY2xlQXRvbSIsImFkZENoaWxkIiwibXlJc290b3BlTGFiZWwiLCJmb250Iiwic2l6ZSIsIndlaWdodCIsImZpbGwiLCJjZW50ZXJYIiwibWF4V2lkdGgiLCJib3R0b20iLCJ0b3AiLCJuZXV0cm9uQnVja2V0SG9sZSIsIm5ldXRyb25CdWNrZXQiLCJuZXV0cm9uQnVja2V0RnJvbnQiLCJhZGRJbnB1dExpc3RlbmVyIiwibnVjbGVvbkxheWVyc05vZGUiLCJudWNsZW9uTGF5ZXJzIiwiXyIsInRpbWVzIiwibnVjbGVvbkxheWVyIiwicHVzaCIsInJldmVyc2UiLCJhZGp1c3RaTGF5ZXIiLCJhZGRlZEF0b20iLCJ6TGF5ZXIiLCJhc3NlcnQiLCJsZW5ndGgiLCJvbkNvcnJlY3RMYXllciIsImNoaWxkcmVuIiwiZm9yRWFjaCIsInBhcnRpY2xlVmlldyIsInBhcnRpY2xlIiwibGF5ZXJJbmRleCIsImNoaWxkSW5kZXgiLCJyZW1vdmVDaGlsZEF0IiwiYWRkUGFydGljbGVWaWV3IiwiYWRkZWRQYXJ0aWNsZSIsInR5cGUiLCJjZW50ZXIiLCJtb2RlbFRvVmlld1Bvc2l0aW9uIiwicG9zaXRpb25Qcm9wZXJ0eSIsImdldCIsInBpY2thYmxlIiwiekxheWVyUHJvcGVydHkiLCJhZGp1c3RaTGF5ZXJMaW5rIiwibGluayIsIm1vdmVQYXJ0aWNsZVRvRnJvbnQiLCJ2YWx1ZSIsIm1vdmVUb0Zyb250IiwidXNlckNvbnRyb2xsZWRQcm9wZXJ0eSIsInRlbXAiLCJwcm90b25zIiwibmV1dHJvbnMiLCJhZGRJdGVtUmVtb3ZlZExpc3RlbmVyIiwicmVtb3ZhbExpc3RlbmVyIiwicmVtb3ZlZEF0b20iLCJyZW1vdmVDaGlsZCIsImRpc3Bvc2UiLCJ1bmxpbmsiLCJyZW1vdmVJdGVtUmVtb3ZlZExpc3RlbmVyIiwicHJvdG9uIiwibmV1dHJvbiIsImFkZEl0ZW1BZGRlZExpc3RlbmVyIiwiZWxlbWVudE5hbWUiLCJ1cGRhdGVFbGVtZW50TmFtZSIsIm51bVByb3RvbnMiLCJudW1OZXV0cm9ucyIsIm1hcEVsZW1lbnRUb1Bvc2l0aW9uIiwibmFtZSIsImdldE5hbWUiLCJzdHJpbmciLCJpc290b3BlQXRvbU5vZGVSYWRpdXMiLCJjZW50ZXJZIiwiZWxlbWVudE5hbWVNYXhXaWR0aCIsIk1hdGgiLCJzcXJ0Iiwic3RhYmlsaXR5SW5kaWNhdG9yIiwidXBkYXRlU3RhYmlsaXR5SW5kaWNhdG9yIiwibWFwU3RhYmxlVW5zdGFibGVUb1Bvc2l0aW9uIiwic3RhYmlsaXR5SW5kaWNhdG9yQ2VudGVyUG9zIiwic3RhYmlsaXR5SW5kaWNhdG9yTWF4V2lkdGgiLCJpc1N0YWJsZSIsImF0b21SZWNvbmZpZ3VyZWQiLCJhZGRMaXN0ZW5lciIsInByb3RvbkNvdW50UHJvcGVydHkiLCJuZXV0cm9uQ291bnRQcm9wZXJ0eSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiSW50ZXJhY3RpdmVJc290b3BlTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBUaGlzIGNsYXNzIGRlZmluZXMgYSBOb2RlIHRoYXQgcmVwcmVzZW50cyBhbiBhdG9tIGluIFwic2NoZW1hdGljXCIgKGkuZS4gQm9ocikgZm9ybSBhbmQgYWxsb3dzIHVzZXJzIHRvIGFkZCBvciByZW1vdmVcclxuICogbmV1dHJvbnMgZnJvbS90byBhIGJ1Y2tldCBpbiBvcmRlciB0byBjcmVhdGUgZGlmZmVyZW50IGlzb3RvcGVzIG9mIGEgcGFydGljdWxhciBhdG9tLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnXHJcbiAqIEBhdXRob3IgQWFkaXNoIEd1cHRhXHJcbiAqL1xyXG5cclxuXHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IEJ1Y2tldEZyb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idWNrZXQvQnVja2V0RnJvbnQuanMnO1xyXG5pbXBvcnQgQnVja2V0SG9sZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvYnVja2V0L0J1Y2tldEhvbGUuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgTm9kZSwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBBdG9tSWRlbnRpZmllciBmcm9tICcuLi8uLi8uLi8uLi9zaHJlZC9qcy9BdG9tSWRlbnRpZmllci5qcyc7XHJcbmltcG9ydCBTaHJlZFN0cmluZ3MgZnJvbSAnLi4vLi4vLi4vLi4vc2hyZWQvanMvU2hyZWRTdHJpbmdzLmpzJztcclxuaW1wb3J0IEJ1Y2tldERyYWdMaXN0ZW5lciBmcm9tICcuLi8uLi8uLi8uLi9zaHJlZC9qcy92aWV3L0J1Y2tldERyYWdMaXN0ZW5lci5qcyc7XHJcbmltcG9ydCBQYXJ0aWNsZVZpZXcgZnJvbSAnLi4vLi4vLi4vLi4vc2hyZWQvanMvdmlldy9QYXJ0aWNsZVZpZXcuanMnO1xyXG5pbXBvcnQgaXNvdG9wZXNBbmRBdG9taWNNYXNzIGZyb20gJy4uLy4uL2lzb3RvcGVzQW5kQXRvbWljTWFzcy5qcyc7XHJcbmltcG9ydCBJc290b3Blc0FuZEF0b21pY01hc3NTdHJpbmdzIGZyb20gJy4uLy4uL0lzb3RvcGVzQW5kQXRvbWljTWFzc1N0cmluZ3MuanMnO1xyXG5pbXBvcnQgSXNvdG9wZUF0b21Ob2RlIGZyb20gJy4vSXNvdG9wZUF0b21Ob2RlLmpzJztcclxuXHJcbmNvbnN0IG15SXNvdG9wZVN0cmluZyA9IElzb3RvcGVzQW5kQXRvbWljTWFzc1N0cmluZ3MubXlJc290b3BlO1xyXG5jb25zdCBzdGFibGVTdHJpbmcgPSBTaHJlZFN0cmluZ3Muc3RhYmxlO1xyXG5jb25zdCB1bnN0YWJsZVN0cmluZyA9IFNocmVkU3RyaW5ncy51bnN0YWJsZTtcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBOVU1fTlVDTEVPTl9MQVlFUlMgPSA1OyAvLyBUaGlzIGlzIGJhc2VkIG9uIG1heCBudW1iZXIgb2YgcGFydGljbGVzLCBtYXkgbmVlZCBhZGp1c3RtZW50IGlmIHRoYXQgY2hhbmdlcy5cclxuY29uc3QgRUxFTUVOVF9OQU1FX0ZPTlRfU0laRSA9IDE2O1xyXG5cclxuY2xhc3MgSW50ZXJhY3RpdmVJc290b3BlTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBDb25zdHJ1Y3RvciBmb3IgYW4gSW50ZXJhY3RpdmVJc290b3BlTm9kZVxyXG4gICAqIEBwYXJhbSB7TWFrZUlzb3RvcGVzTW9kZWx9IG1ha2VJc290b3Blc01vZGVsXHJcbiAgICogQHBhcmFtIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfSBtb2RlbFZpZXdUcmFuc2Zvcm1cclxuICAgKiBAcGFyYW0ge1ZlY3RvcjJ9IGJvdHRvbVBvaW50XHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1ha2VJc290b3Blc01vZGVsLCBtb2RlbFZpZXdUcmFuc2Zvcm0sIGJvdHRvbVBvaW50ICkge1xyXG4gICAgc3VwZXIoKTtcclxuICAgIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtID0gbW9kZWxWaWV3VHJhbnNmb3JtOyAvLyBleHRlbmQgc2NvcGUgb2YgbW9kZWxWaWV3VHJhbnNmb3JtLlxyXG5cclxuICAgIC8vIEFkZCB0aGUgbm9kZSB0aGF0IHNob3dzIHRoZSB0ZXh0dWFsIGxhYmVscyBhbmQgZWxlY3Ryb24gY2xvdWQuXHJcbiAgICBjb25zdCBpc290b3BlQXRvbU5vZGUgPSBuZXcgSXNvdG9wZUF0b21Ob2RlKCBtYWtlSXNvdG9wZXNNb2RlbC5wYXJ0aWNsZUF0b20sIGJvdHRvbVBvaW50LCBtb2RlbFZpZXdUcmFuc2Zvcm0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGlzb3RvcGVBdG9tTm9kZSApO1xyXG4gICAgY29uc3QgbXlJc290b3BlTGFiZWwgPSBuZXcgVGV4dCggbXlJc290b3BlU3RyaW5nLCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggeyBzaXplOiAxNiwgd2VpZ2h0OiAnYm9sZCcgfSApLFxyXG4gICAgICBmaWxsOiAnYmxhY2snLFxyXG4gICAgICBjZW50ZXJYOiBpc290b3BlQXRvbU5vZGUuY2VudGVyWCxcclxuICAgICAgbWF4V2lkdGg6IDEwMFxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbXlJc290b3BlTGFiZWwgKTtcclxuICAgIG15SXNvdG9wZUxhYmVsLmJvdHRvbSA9IGlzb3RvcGVBdG9tTm9kZS50b3AgLSA1O1xyXG5cclxuICAgIC8vIEFkZCB0aGUgYnVja2V0IGNvbXBvbmVudHMgdGhhdCBob2xkIHRoZSBuZXV0cm9ucy5cclxuICAgIGNvbnN0IG5ldXRyb25CdWNrZXRIb2xlID0gbmV3IEJ1Y2tldEhvbGUoIG1ha2VJc290b3Blc01vZGVsLm5ldXRyb25CdWNrZXQsIG1vZGVsVmlld1RyYW5zZm9ybSApO1xyXG4gICAgY29uc3QgbmV1dHJvbkJ1Y2tldEZyb250ID0gbmV3IEJ1Y2tldEZyb250KCBtYWtlSXNvdG9wZXNNb2RlbC5uZXV0cm9uQnVja2V0LCBtb2RlbFZpZXdUcmFuc2Zvcm0gKTtcclxuICAgIG5ldXRyb25CdWNrZXRGcm9udC5hZGRJbnB1dExpc3RlbmVyKCBuZXcgQnVja2V0RHJhZ0xpc3RlbmVyKFxyXG4gICAgICBtYWtlSXNvdG9wZXNNb2RlbC5uZXV0cm9uQnVja2V0LFxyXG4gICAgICBuZXV0cm9uQnVja2V0RnJvbnQsXHJcbiAgICAgIG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAgKSApO1xyXG5cclxuICAgIC8vIEJ1Y2tldCBob2xlIGlzIGZpcnN0IGl0ZW0gYWRkZWQgdG8gdmlldyBmb3IgcHJvcGVyIGxheWVyaW5nLlxyXG4gICAgdGhpcy5hZGRDaGlsZCggbmV1dHJvbkJ1Y2tldEhvbGUgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGxheWVycyB3aGVyZSB0aGUgbnVjbGVvbnMgd2lsbCBiZSBtYWludGFpbmVkLlxyXG4gICAgY29uc3QgbnVjbGVvbkxheWVyc05vZGUgPSBuZXcgTm9kZSgpO1xyXG4gICAgY29uc3QgbnVjbGVvbkxheWVycyA9IFtdO1xyXG4gICAgXy50aW1lcyggTlVNX05VQ0xFT05fTEFZRVJTLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG51Y2xlb25MYXllciA9IG5ldyBOb2RlKCk7XHJcbiAgICAgIG51Y2xlb25MYXllcnMucHVzaCggbnVjbGVvbkxheWVyICk7XHJcbiAgICAgIG51Y2xlb25MYXllcnNOb2RlLmFkZENoaWxkKCBudWNsZW9uTGF5ZXIgKTtcclxuICAgIH0gKTtcclxuICAgIG51Y2xlb25MYXllcnMucmV2ZXJzZSgpOyAvLyBTZXQgdXAgdGhlIG51Y2xlb24gbGF5ZXJzIHNvIHRoYXQgbGF5ZXIgMCBpcyBpbiBmcm9udC5cclxuXHJcbiAgICAvLyBGdW5jdGlvbiB0byBhZGp1c3Qgei1sYXllciBvcmRlcmluZyBmb3IgYSBwYXJ0aWNsZS4gVGhpcyBpcyB0byBiZSBsaW5rZWQgdG8gdGhlIHBhcnRpY2xlJ3MgekxheWVyIHByb3BlcnR5LlxyXG4gICAgY29uc3QgYWRqdXN0WkxheWVyID0gKCBhZGRlZEF0b20sIHpMYXllciApID0+IHtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggbnVjbGVvbkxheWVycy5sZW5ndGggPiB6TGF5ZXIsXHJcbiAgICAgICAgJ3pMYXllciBmb3IgcHJvdG9uIGV4Y2VlZHMgbnVtYmVyIG9mIGxheWVycywgbWF4IG51bWJlciBtYXkgbmVlZCBpbmNyZWFzaW5nLicgKTtcclxuICAgICAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgcHJvdG9uIHZpZXcgaXMgb24gdGhlIGNvcnJlY3QgbGF5ZXIuXHJcbiAgICAgIGxldCBvbkNvcnJlY3RMYXllciA9IGZhbHNlO1xyXG4gICAgICBudWNsZW9uTGF5ZXJzWyB6TGF5ZXIgXS5jaGlsZHJlbi5mb3JFYWNoKCBwYXJ0aWNsZVZpZXcgPT4ge1xyXG4gICAgICAgIGlmICggcGFydGljbGVWaWV3LnBhcnRpY2xlID09PSBhZGRlZEF0b20gKSB7XHJcbiAgICAgICAgICBvbkNvcnJlY3RMYXllciA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgICAgIGlmICggIW9uQ29ycmVjdExheWVyICkge1xyXG4gICAgICAgIC8vIFJlbW92ZSBwYXJ0aWNsZSB2aWV3IGZyb20gaXRzIGN1cnJlbnQgbGF5ZXIuXHJcbiAgICAgICAgbGV0IHBhcnRpY2xlVmlldyA9IG51bGw7XHJcbiAgICAgICAgZm9yICggbGV0IGxheWVySW5kZXggPSAwOyBsYXllckluZGV4IDwgbnVjbGVvbkxheWVycy5sZW5ndGggJiYgcGFydGljbGVWaWV3ID09PSBudWxsOyBsYXllckluZGV4KysgKSB7XHJcbiAgICAgICAgICBmb3IgKCBsZXQgY2hpbGRJbmRleCA9IDA7IGNoaWxkSW5kZXggPCBudWNsZW9uTGF5ZXJzWyBsYXllckluZGV4IF0uY2hpbGRyZW4ubGVuZ3RoOyBjaGlsZEluZGV4KysgKSB7XHJcbiAgICAgICAgICAgIGlmICggbnVjbGVvbkxheWVyc1sgbGF5ZXJJbmRleCBdLmNoaWxkcmVuWyBjaGlsZEluZGV4IF0ucGFydGljbGUgPT09IGFkZGVkQXRvbSApIHtcclxuICAgICAgICAgICAgICBwYXJ0aWNsZVZpZXcgPSBudWNsZW9uTGF5ZXJzWyBsYXllckluZGV4IF0uY2hpbGRyZW5bIGNoaWxkSW5kZXggXTtcclxuICAgICAgICAgICAgICBudWNsZW9uTGF5ZXJzWyBsYXllckluZGV4IF0ucmVtb3ZlQ2hpbGRBdCggY2hpbGRJbmRleCApO1xyXG4gICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEFkZCB0aGUgcGFydGljbGUgdmlldyB0byBpdHMgbmV3IGxheWVyLlxyXG4gICAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHBhcnRpY2xlVmlldyAhPT0gbnVsbCwgJ1BhcnRpY2xlIHZpZXcgbm90IGZvdW5kIGR1cmluZyByZWxheWVyaW5nJyApO1xyXG4gICAgICAgIG51Y2xlb25MYXllcnNbIHpMYXllciBdLmFkZENoaWxkKCBwYXJ0aWNsZVZpZXcgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBmdW5jdGlvbiB0byBhZGQgdGhlIHZpZXcgZm9yIGEgbnVjbGVvbiwgaS5lLiBhIHByb3RvbiBvciBuZXV0cm9uXHJcbiAgICBjb25zdCBhZGRQYXJ0aWNsZVZpZXcgPSBhZGRlZFBhcnRpY2xlID0+IHtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydChcclxuICAgICAgICBhZGRlZFBhcnRpY2xlLnR5cGUgPT09ICdwcm90b24nIHx8IGFkZGVkUGFydGljbGUudHlwZSA9PT0gJ25ldXRyb24nLFxyXG4gICAgICAgICd1bnJlY29nbml6ZWQgcGFydGljbGUgdHlwZSdcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGNvbnN0IHBhcnRpY2xlVmlldyA9IG5ldyBQYXJ0aWNsZVZpZXcoIGFkZGVkUGFydGljbGUsIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtICk7XHJcbiAgICAgIHBhcnRpY2xlVmlldy5jZW50ZXIgPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBhZGRlZFBhcnRpY2xlLnBvc2l0aW9uUHJvcGVydHkuZ2V0KCkgKTtcclxuICAgICAgcGFydGljbGVWaWV3LnBpY2thYmxlID0gYWRkZWRQYXJ0aWNsZS50eXBlID09PSAnbmV1dHJvbic7XHJcblxyXG4gICAgICAvLyBhZGQgcGFydGljbGUgdmlldyB0byBjb3JyZWN0IHogbGF5ZXIuXHJcbiAgICAgIG51Y2xlb25MYXllcnNbIGFkZGVkUGFydGljbGUuekxheWVyUHJvcGVydHkuZ2V0KCkgXS5hZGRDaGlsZCggcGFydGljbGVWaWV3ICk7XHJcblxyXG4gICAgICBjb25zdCBhZGp1c3RaTGF5ZXJMaW5rID0gekxheWVyID0+IHtcclxuICAgICAgICBhZGp1c3RaTGF5ZXIoIGFkZGVkUGFydGljbGUsIHpMYXllciApO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gQWRkIGEgbGlzdGVuZXIgdGhhdCBhZGp1c3RzIGEgbnVjbGVvbidzIHotb3JkZXIgbGF5ZXJpbmcuXHJcbiAgICAgIGFkZGVkUGFydGljbGUuekxheWVyUHJvcGVydHkubGluayggYWRqdXN0WkxheWVyTGluayApO1xyXG5cclxuICAgICAgY29uc3QgbW92ZVBhcnRpY2xlVG9Gcm9udCA9IHZhbHVlID0+IHtcclxuICAgICAgICBpZiAoIHZhbHVlICkge1xyXG4gICAgICAgICAgcGFydGljbGVWaWV3Lm1vdmVUb0Zyb250KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBhZGRlZFBhcnRpY2xlLnVzZXJDb250cm9sbGVkUHJvcGVydHkubGluayggbW92ZVBhcnRpY2xlVG9Gcm9udCApO1xyXG5cclxuICAgICAgLy8gQWRkIHRoZSBpdGVtIHJlbW92ZWQgbGlzdGVuZXIuXHJcbiAgICAgIGxldCB0ZW1wO1xyXG4gICAgICBpZiAoIGFkZGVkUGFydGljbGUudHlwZSA9PT0gJ3Byb3RvbicgKSB7XHJcbiAgICAgICAgdGVtcCA9IG1ha2VJc290b3Blc01vZGVsLnByb3RvbnM7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIGFkZGVkUGFydGljbGUudHlwZSA9PT0gJ25ldXRyb24nICkge1xyXG4gICAgICAgIHRlbXAgPSBtYWtlSXNvdG9wZXNNb2RlbC5uZXV0cm9ucztcclxuICAgICAgfVxyXG5cclxuICAgICAgdGVtcC5hZGRJdGVtUmVtb3ZlZExpc3RlbmVyKCBmdW5jdGlvbiByZW1vdmFsTGlzdGVuZXIoIHJlbW92ZWRBdG9tICkge1xyXG4gICAgICAgIGlmICggcmVtb3ZlZEF0b20gPT09IGFkZGVkUGFydGljbGUgKSB7XHJcbiAgICAgICAgICBudWNsZW9uTGF5ZXJzWyBhZGRlZFBhcnRpY2xlLnpMYXllclByb3BlcnR5LmdldCgpIF0ucmVtb3ZlQ2hpbGQoIHBhcnRpY2xlVmlldyApO1xyXG4gICAgICAgICAgcGFydGljbGVWaWV3LmRpc3Bvc2UoKTtcclxuICAgICAgICAgIGFkZGVkUGFydGljbGUuekxheWVyUHJvcGVydHkudW5saW5rKCBhZGp1c3RaTGF5ZXJMaW5rICk7XHJcbiAgICAgICAgICBhZGRlZFBhcnRpY2xlLnVzZXJDb250cm9sbGVkUHJvcGVydHkudW5saW5rKCBtb3ZlUGFydGljbGVUb0Zyb250ICk7XHJcbiAgICAgICAgICB0ZW1wLnJlbW92ZUl0ZW1SZW1vdmVkTGlzdGVuZXIoIHJlbW92YWxMaXN0ZW5lciApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG4gICAgfTtcclxuXHJcbiAgICBtYWtlSXNvdG9wZXNNb2RlbC5wcm90b25zLmZvckVhY2goIHByb3RvbiA9PiB7IGFkZFBhcnRpY2xlVmlldyggcHJvdG9uICk7IH0gKTtcclxuXHJcbiAgICBtYWtlSXNvdG9wZXNNb2RlbC5uZXV0cm9ucy5mb3JFYWNoKCBuZXV0cm9uID0+IHsgYWRkUGFydGljbGVWaWV3KCBuZXV0cm9uICk7IH0gKTtcclxuXHJcbiAgICAvLyBhZGQgdGhlIGl0ZW0gYWRkZWQgbGlzdGVuZXJzIGZvciBwYXJ0aWNsZXMgb2YgdGhpcyBpc290b3BlXHJcbiAgICBtYWtlSXNvdG9wZXNNb2RlbC5wcm90b25zLmFkZEl0ZW1BZGRlZExpc3RlbmVyKCBhZGRlZEF0b20gPT4geyBhZGRQYXJ0aWNsZVZpZXcoIGFkZGVkQXRvbSApOyB9ICk7XHJcblxyXG4gICAgLy8gYWRkIHRoZSBpdGVtIGFkZGVkIGxpc3RlbmVycyBmb3IgcGFydGljbGVzIG9mIHRoaXMgaXNvdG9wZVxyXG4gICAgbWFrZUlzb3RvcGVzTW9kZWwubmV1dHJvbnMuYWRkSXRlbUFkZGVkTGlzdGVuZXIoIGFkZGVkQXRvbSA9PiB7IGFkZFBhcnRpY2xlVmlldyggYWRkZWRBdG9tICk7IH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIHRleHR1YWwgcmVhZG91dCBmb3IgdGhlIGVsZW1lbnQgbmFtZS5cclxuICAgIGNvbnN0IGVsZW1lbnROYW1lID0gbmV3IFRleHQoICcnLCB7IGZvbnQ6IG5ldyBQaGV0Rm9udCggeyBzaXplOiBFTEVNRU5UX05BTUVfRk9OVF9TSVpFLCB3ZWlnaHQ6ICdib2xkJyB9ICkgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggZWxlbWVudE5hbWUgKTtcclxuXHJcbiAgICAvLyBEZWZpbmUgdGhlIHVwZGF0ZSBmdW5jdGlvbiBmb3IgdGhlIGVsZW1lbnQgbmFtZS5cclxuICAgIGNvbnN0IHVwZGF0ZUVsZW1lbnROYW1lID0gKCBudW1Qcm90b25zLCBudW1OZXV0cm9ucyApID0+IHtcclxuXHJcbiAgICAgIC8vIFRoaXMgZGF0YSBzdHJ1Y3R1cmUgbWFwcyB0aGUgdmVydGljYWwgZGlzdGFuY2Ugb2YgZWxlbWVudCBuYW1lIGZyb20gdGhlIG51Y2xldXMgY2VudGVyIGZvciBlYWNoIHN1cHBvcnRlZFxyXG4gICAgICAvLyBudW1iZXIgb2YgbnVjbGVvbnMuICBUaGVzZSB2YWx1ZXMgd2VyZSBlbXBpcmljYWxseSBkZXRlcm1pbmVkLCBhbmQgYXJlIHNldCBzbyB0aGF0IHRoZSBsYWJlbCBsb29rcyBnb29kIGFuZFxyXG4gICAgICAvLyBkb2Vzbid0IG92ZXJsYXAgd2l0aCB0aGUgbnVjbGV1cy5cclxuICAgICAgY29uc3QgbWFwRWxlbWVudFRvUG9zaXRpb24gPSB7XHJcbiAgICAgICAgMTogMzUsXHJcbiAgICAgICAgMjogMzUsXHJcbiAgICAgICAgMzogNDAsXHJcbiAgICAgICAgNDogNDIsXHJcbiAgICAgICAgNTogNDQsXHJcbiAgICAgICAgNjogNDcsXHJcbiAgICAgICAgNzogNDcsXHJcbiAgICAgICAgODogNTAsXHJcbiAgICAgICAgOTogNTAsXHJcbiAgICAgICAgMTA6IDUwXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBnZXQgZWxlbWVudCBuYW1lIGFuZCBhcHBlbmQgbWFzcyBudW1iZXIgdG8gaWRlbnRpZnkgaXNvdG9wZVxyXG4gICAgICBsZXQgbmFtZSA9IGAke0F0b21JZGVudGlmaWVyLmdldE5hbWUoIG51bVByb3RvbnMgKX0tJHtudW1Qcm90b25zICsgbnVtTmV1dHJvbnN9YDtcclxuICAgICAgaWYgKCBuYW1lLmxlbmd0aCA9PT0gMCApIHtcclxuICAgICAgICBuYW1lID0gJyc7XHJcbiAgICAgIH1cclxuICAgICAgZWxlbWVudE5hbWUuc3RyaW5nID0gbmFtZTtcclxuICAgICAgY29uc3QgaXNvdG9wZUF0b21Ob2RlUmFkaXVzID0gaXNvdG9wZUF0b21Ob2RlLmNlbnRlclkgLSBpc290b3BlQXRvbU5vZGUudG9wO1xyXG4gICAgICBsZXQgZWxlbWVudE5hbWVNYXhXaWR0aDtcclxuICAgICAgaWYgKCBpc290b3BlQXRvbU5vZGVSYWRpdXMgPiBtYXBFbGVtZW50VG9Qb3NpdGlvblsgbnVtUHJvdG9ucyBdICkge1xyXG5cclxuICAgICAgICAvLyBsaW1pdCB0aGUgd2lkdGggb2YgdGhlIGVsZW1lbnQgbmFtZSB0byBmaXQgaW4gdGhlIGVsZWN0cm9uIGNsb3VkXHJcbiAgICAgICAgZWxlbWVudE5hbWVNYXhXaWR0aCA9IDIgKiBNYXRoLnNxcnQoXHJcbiAgICAgICAgICAoIGlzb3RvcGVBdG9tTm9kZVJhZGl1cyAqIGlzb3RvcGVBdG9tTm9kZVJhZGl1cyApIC1cclxuICAgICAgICAgICggbWFwRWxlbWVudFRvUG9zaXRpb25bIG51bVByb3RvbnMgXSAqIG1hcEVsZW1lbnRUb1Bvc2l0aW9uWyBudW1Qcm90b25zIF0gKVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgIC8vIFRoaXMgZWxzZSBjbGF1c2UgY2FuIG9jY3VyIGlmIHRoZXJlIGFyZSBubyBlbGVjdHJvbnMuICBJbiB0aGF0IGNhc2UsIHVzZSBhbiBlbXBpcmljYWxseSBkZXRlcm1pbmVkIG1heCB3aWR0aC5cclxuICAgICAgICBlbGVtZW50TmFtZU1heFdpZHRoID0gMzA7XHJcbiAgICAgIH1cclxuICAgICAgZWxlbWVudE5hbWUubWF4V2lkdGggPSBlbGVtZW50TmFtZU1heFdpZHRoO1xyXG4gICAgICBlbGVtZW50TmFtZS5jZW50ZXIgPSBuZXcgVmVjdG9yMihcclxuICAgICAgICBpc290b3BlQXRvbU5vZGUuY2VudGVyWCxcclxuICAgICAgICBpc290b3BlQXRvbU5vZGUuY2VudGVyWSAtIG1hcEVsZW1lbnRUb1Bvc2l0aW9uWyBudW1Qcm90b25zIF1cclxuICAgICAgKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSB0ZXh0dWFsIHJlYWRvdXQgZm9yIHRoZSBzdGFiaWxpdHkgaW5kaWNhdG9yLlxyXG4gICAgY29uc3Qgc3RhYmlsaXR5SW5kaWNhdG9yID0gbmV3IFRleHQoICcnLCB7IGZvbnQ6IG5ldyBQaGV0Rm9udCggeyBzaXplOiAxMiwgd2VpZ2h0OiAnYm9sZCcgfSApIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHN0YWJpbGl0eUluZGljYXRvciApO1xyXG5cclxuICAgIC8vIERlZmluZSB0aGUgdXBkYXRlIGZ1bmN0aW9uIGZvciB0aGUgc3RhYmlsaXR5IGluZGljYXRvci5cclxuICAgIGNvbnN0IHVwZGF0ZVN0YWJpbGl0eUluZGljYXRvciA9ICggbnVtUHJvdG9ucywgbnVtTmV1dHJvbnMgKSA9PiB7XHJcblxyXG4gICAgICAvLyBUaGlzIGRhdGEgc3RydWN0dXJlIG1hcHMgdGhlIHZlcnRpY2FsIGRpc3RhbmNlIG9mIHN0YWJsZS91bnN0YWJsZSBsYWJlbCB0byB0aGUgY2VudGVyIG9mIG51Y2xldXMgc28gdGhhdCBsYWJlbHNcclxuICAgICAgLy8gbG9vayBnb29kIGFuZCBkb24ndCBvdmVybGFwIHdpdGggbnVjbGVvbnMgaW4gdGhlIG51Y2xldXMuIFRoZXNlIHZhbHVlcyBoYXZlIGJlZW4gZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG4gICAgICBjb25zdCBtYXBTdGFibGVVbnN0YWJsZVRvUG9zaXRpb24gPSB7XHJcbiAgICAgICAgMTogMzAsXHJcbiAgICAgICAgMjogMzUsXHJcbiAgICAgICAgMzogNDAsXHJcbiAgICAgICAgNDogNDIsXHJcbiAgICAgICAgNTogNDQsXHJcbiAgICAgICAgNjogNDcsXHJcbiAgICAgICAgNzogNDcsXHJcbiAgICAgICAgODogNTAsXHJcbiAgICAgICAgOTogNTAsXHJcbiAgICAgICAgMTA6IDUwXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHN0YWJpbGl0eUluZGljYXRvckNlbnRlclBvcyA9IG5ldyBWZWN0b3IyKFxyXG4gICAgICAgIGlzb3RvcGVBdG9tTm9kZS5jZW50ZXJYLFxyXG4gICAgICAgIGlzb3RvcGVBdG9tTm9kZS5jZW50ZXJZICsgbWFwU3RhYmxlVW5zdGFibGVUb1Bvc2l0aW9uWyBudW1Qcm90b25zIF1cclxuICAgICAgKTtcclxuICAgICAgY29uc3QgaXNvdG9wZUF0b21Ob2RlUmFkaXVzID0gaXNvdG9wZUF0b21Ob2RlLmNlbnRlclkgLSBpc290b3BlQXRvbU5vZGUudG9wO1xyXG4gICAgICBsZXQgc3RhYmlsaXR5SW5kaWNhdG9yTWF4V2lkdGg7XHJcbiAgICAgIGlmICggaXNvdG9wZUF0b21Ob2RlUmFkaXVzID4gbWFwU3RhYmxlVW5zdGFibGVUb1Bvc2l0aW9uWyBudW1Qcm90b25zIF0gKSB7XHJcblxyXG4gICAgICAgIC8vIGxpbWl0IHN0YWJpbGl0eSBpbmRpY2F0b3IgbGFiZWwgdG8gZml0IGluc2lkZSB0aGUgZWxlY3Ryb24gY2xvdWRcclxuICAgICAgICBzdGFiaWxpdHlJbmRpY2F0b3JNYXhXaWR0aCA9IDIgKiBNYXRoLnNxcnQoXHJcbiAgICAgICAgICAoIGlzb3RvcGVBdG9tTm9kZVJhZGl1cyAqIGlzb3RvcGVBdG9tTm9kZVJhZGl1cyApIC1cclxuICAgICAgICAgICggbWFwU3RhYmxlVW5zdGFibGVUb1Bvc2l0aW9uWyBudW1Qcm90b25zIF0gKiBtYXBTdGFibGVVbnN0YWJsZVRvUG9zaXRpb25bIG51bVByb3RvbnMgXSApXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgLy8gVGhpcyBlbHNlIGNsYXVzZSBjYW4gb2NjdXIgaWYgdGhlcmUgYXJlIG5vIGVsZWN0cm9ucy4gIEluIHRoYXQgY2FzZSwgdXNlIGFuIGVtcGlyaWNhbGx5IGRldGVybWluZWQgbWF4IHdpZHRoLlxyXG4gICAgICAgIHN0YWJpbGl0eUluZGljYXRvck1heFdpZHRoID0gMzA7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIHNldCB0aGUgdGV4dCBvZiB0aGUgc3RhYmlsaXR5IGluZGljYXRvclxyXG4gICAgICBpZiAoIG51bVByb3RvbnMgPiAwICkge1xyXG4gICAgICAgIGlmICggQXRvbUlkZW50aWZpZXIuaXNTdGFibGUoIG51bVByb3RvbnMsIG51bU5ldXRyb25zICkgKSB7XHJcbiAgICAgICAgICBzdGFiaWxpdHlJbmRpY2F0b3Iuc3RyaW5nID0gc3RhYmxlU3RyaW5nO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHN0YWJpbGl0eUluZGljYXRvci5zdHJpbmcgPSB1bnN0YWJsZVN0cmluZztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgc3RhYmlsaXR5SW5kaWNhdG9yLnN0cmluZyA9ICcnO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBwb3NpdGlvbiBhbmQgbGltaXQgdGhlIHdpZHRoXHJcbiAgICAgIHN0YWJpbGl0eUluZGljYXRvci5tYXhXaWR0aCA9IHN0YWJpbGl0eUluZGljYXRvck1heFdpZHRoO1xyXG4gICAgICBzdGFiaWxpdHlJbmRpY2F0b3IuY2VudGVyID0gc3RhYmlsaXR5SW5kaWNhdG9yQ2VudGVyUG9zO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBudWNsZW9uTGF5ZXJzTm9kZSApO1xyXG4gICAgLy8gQWRkIHRoZSBuZXV0cm9uIGJ1Y2tldCBjaGlsZCBoZXJlIGZvciBwcm9wZXIgbGF5ZXJpbmcgd2l0aCBuZXV0cm9ucy5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIG5ldXRyb25CdWNrZXRGcm9udCApO1xyXG5cclxuICAgIG1ha2VJc290b3Blc01vZGVsLmF0b21SZWNvbmZpZ3VyZWQuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgICAgdXBkYXRlRWxlbWVudE5hbWUoXHJcbiAgICAgICAgbWFrZUlzb3RvcGVzTW9kZWwucGFydGljbGVBdG9tLnByb3RvbkNvdW50UHJvcGVydHkuZ2V0KCksXHJcbiAgICAgICAgbWFrZUlzb3RvcGVzTW9kZWwucGFydGljbGVBdG9tLm5ldXRyb25Db3VudFByb3BlcnR5LmdldCgpXHJcbiAgICAgICk7XHJcbiAgICAgIHVwZGF0ZVN0YWJpbGl0eUluZGljYXRvcihcclxuICAgICAgICBtYWtlSXNvdG9wZXNNb2RlbC5wYXJ0aWNsZUF0b20ucHJvdG9uQ291bnRQcm9wZXJ0eS5nZXQoKSxcclxuICAgICAgICBtYWtlSXNvdG9wZXNNb2RlbC5wYXJ0aWNsZUF0b20ubmV1dHJvbkNvdW50UHJvcGVydHkuZ2V0KClcclxuICAgICAgKTtcclxuICAgICAgbXlJc290b3BlTGFiZWwuYm90dG9tID0gaXNvdG9wZUF0b21Ob2RlLnRvcCAtIDU7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gaW5pdGlhbCB1cGRhdGVcclxuICAgIHVwZGF0ZUVsZW1lbnROYW1lKFxyXG4gICAgICBtYWtlSXNvdG9wZXNNb2RlbC5wYXJ0aWNsZUF0b20ucHJvdG9uQ291bnRQcm9wZXJ0eS5nZXQoKSxcclxuICAgICAgbWFrZUlzb3RvcGVzTW9kZWwucGFydGljbGVBdG9tLm5ldXRyb25Db3VudFByb3BlcnR5LmdldCgpXHJcbiAgICApO1xyXG4gICAgdXBkYXRlU3RhYmlsaXR5SW5kaWNhdG9yKFxyXG4gICAgICBtYWtlSXNvdG9wZXNNb2RlbC5wYXJ0aWNsZUF0b20ucHJvdG9uQ291bnRQcm9wZXJ0eS5nZXQoKSxcclxuICAgICAgbWFrZUlzb3RvcGVzTW9kZWwucGFydGljbGVBdG9tLm5ldXRyb25Db3VudFByb3BlcnR5LmdldCgpXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuaXNvdG9wZXNBbmRBdG9taWNNYXNzLnJlZ2lzdGVyKCAnSW50ZXJhY3RpdmVJc290b3BlTm9kZScsIEludGVyYWN0aXZlSXNvdG9wZU5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgSW50ZXJhY3RpdmVJc290b3BlTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0EsT0FBT0EsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxXQUFXLE1BQU0sbURBQW1EO0FBQzNFLE9BQU9DLFVBQVUsTUFBTSxrREFBa0Q7QUFDekUsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxTQUFTQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDOUQsT0FBT0MsY0FBYyxNQUFNLHdDQUF3QztBQUNuRSxPQUFPQyxZQUFZLE1BQU0sc0NB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