// Copyright 2019-2023, University of Colorado Boulder

/**
 * Class for the 'Objects' accordion box, which is the panel in the lower right corner of the sim that displays an
 * environment for counting with various objects.
 *
 * @author Chris Klusendorf (PhET Interactive Simulations)
 */

import CountingCommonConstants from '../../../../counting-common/js/common/CountingCommonConstants.js';
import CountingObjectType from '../../../../counting-common/js/common/model/CountingObjectType.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import { Color, Image } from '../../../../scenery/js/imports.js';
import RectangularRadioButtonGroup from '../../../../sun/js/buttons/RectangularRadioButtonGroup.js';
import numberSuiteCommon from '../../numberSuiteCommon.js';
import NumberSuiteCommonStrings from '../../NumberSuiteCommonStrings.js';
import NumberSuiteCommonConstants from '../NumberSuiteCommonConstants.js';
import CountingAreaNode from './CountingAreaNode.js';
import BaseNumberNode from '../../../../counting-common/js/common/view/BaseNumberNode.js';
import BaseNumber from '../../../../counting-common/js/common/model/BaseNumber.js';
import NumberSuiteCommonAccordionBox from './NumberSuiteCommonAccordionBox.js';
import optionize from '../../../../phet-core/js/optionize.js';
import Property from '../../../../axon/js/Property.js';

// types

// constants
const RADIO_BUTTON_SIZE = new Dimension2(28, 28); // in screen coordinates

class CountingAccordionBox extends NumberSuiteCommonAccordionBox {
  constructor(countingArea, countingObjectTypeProperty, width, height, providedOptions) {
    const options = optionize()({
      titleStringProperty: NumberSuiteCommonStrings.objectsStringProperty,
      titleTextOptions: {
        maxWidth: NumberSuiteCommonConstants.LOWER_ACCORDION_BOX_TITLE_MAX_WIDTH
      },
      countingObjectTypes: null,
      linkedCountingArea: null,
      linkStatusChangedEmitter: null
    }, providedOptions);
    super(width, new Property(height), options);
    this.countingAreaNode = new CountingAreaNode(countingArea, countingObjectTypeProperty, this.contentBoundsProperty);
    this.contentNode.addChild(this.countingAreaNode);
    let radioButtonGroup = null;
    if (options.countingObjectTypes) {
      // create the icons for the RectangularRadioButtonGroup
      const buttons = [];
      options.countingObjectTypes.forEach(countingObjectType => {
        let iconNode = null;
        if (countingObjectType === CountingObjectType.PAPER_NUMBER) {
          iconNode = new BaseNumberNode(new BaseNumber(1, 0), 1);
          iconNode.setScaleMagnitude(RADIO_BUTTON_SIZE.height / iconNode.height);
        } else {
          iconNode = new Image(CountingCommonConstants.COUNTING_OBJECT_TYPE_TO_IMAGE.get(countingObjectType), {
            maxWidth: RADIO_BUTTON_SIZE.width,
            maxHeight: RADIO_BUTTON_SIZE.height
          });
        }
        buttons.push({
          value: countingObjectType,
          createNode: () => iconNode
        });
      });

      // create and add the RectangularRadioButtonGroup, which is a control for changing the CountingObjectType of the countingObjects
      radioButtonGroup = new RectangularRadioButtonGroup(countingObjectTypeProperty, buttons, {
        orientation: 'horizontal',
        spacing: 10,
        radioButtonOptions: {
          baseColor: Color.WHITE
        }
      });
      radioButtonGroup.right = this.contentBoundsProperty.value.right - CountingCommonConstants.COUNTING_AREA_MARGIN;
      radioButtonGroup.bottom = this.contentBoundsProperty.value.bottom - CountingCommonConstants.COUNTING_AREA_MARGIN;
      this.contentNode.addChild(radioButtonGroup);
    }

    // add the linked countingArea
    if (options.linkedCountingArea && options.linkStatusChangedEmitter) {
      const linkedObjectsCountingAreaNode = new CountingAreaNode(options.linkedCountingArea, countingObjectTypeProperty, this.contentBoundsProperty, {
        viewHasIndependentModel: false
      });
      linkedObjectsCountingAreaNode.visible = false;
      this.contentNode.addChild(linkedObjectsCountingAreaNode);
      options.linkStatusChangedEmitter.addListener(objectsLinked => {
        linkedObjectsCountingAreaNode.visible = objectsLinked;
        this.countingAreaNode.visible = !objectsLinked;
        radioButtonGroup && radioButtonGroup.moveToFront();
      });
    }
  }
}
numberSuiteCommon.register('CountingAccordionBox', CountingAccordionBox);
export default CountingAccordionBox;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDb3VudGluZ0NvbW1vbkNvbnN0YW50cyIsIkNvdW50aW5nT2JqZWN0VHlwZSIsIkRpbWVuc2lvbjIiLCJDb2xvciIsIkltYWdlIiwiUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwIiwibnVtYmVyU3VpdGVDb21tb24iLCJOdW1iZXJTdWl0ZUNvbW1vblN0cmluZ3MiLCJOdW1iZXJTdWl0ZUNvbW1vbkNvbnN0YW50cyIsIkNvdW50aW5nQXJlYU5vZGUiLCJCYXNlTnVtYmVyTm9kZSIsIkJhc2VOdW1iZXIiLCJOdW1iZXJTdWl0ZUNvbW1vbkFjY29yZGlvbkJveCIsIm9wdGlvbml6ZSIsIlByb3BlcnR5IiwiUkFESU9fQlVUVE9OX1NJWkUiLCJDb3VudGluZ0FjY29yZGlvbkJveCIsImNvbnN0cnVjdG9yIiwiY291bnRpbmdBcmVhIiwiY291bnRpbmdPYmplY3RUeXBlUHJvcGVydHkiLCJ3aWR0aCIsImhlaWdodCIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ0aXRsZVN0cmluZ1Byb3BlcnR5Iiwib2JqZWN0c1N0cmluZ1Byb3BlcnR5IiwidGl0bGVUZXh0T3B0aW9ucyIsIm1heFdpZHRoIiwiTE9XRVJfQUNDT1JESU9OX0JPWF9USVRMRV9NQVhfV0lEVEgiLCJjb3VudGluZ09iamVjdFR5cGVzIiwibGlua2VkQ291bnRpbmdBcmVhIiwibGlua1N0YXR1c0NoYW5nZWRFbWl0dGVyIiwiY291bnRpbmdBcmVhTm9kZSIsImNvbnRlbnRCb3VuZHNQcm9wZXJ0eSIsImNvbnRlbnROb2RlIiwiYWRkQ2hpbGQiLCJyYWRpb0J1dHRvbkdyb3VwIiwiYnV0dG9ucyIsImZvckVhY2giLCJjb3VudGluZ09iamVjdFR5cGUiLCJpY29uTm9kZSIsIlBBUEVSX05VTUJFUiIsInNldFNjYWxlTWFnbml0dWRlIiwiQ09VTlRJTkdfT0JKRUNUX1RZUEVfVE9fSU1BR0UiLCJnZXQiLCJtYXhIZWlnaHQiLCJwdXNoIiwidmFsdWUiLCJjcmVhdGVOb2RlIiwib3JpZW50YXRpb24iLCJzcGFjaW5nIiwicmFkaW9CdXR0b25PcHRpb25zIiwiYmFzZUNvbG9yIiwiV0hJVEUiLCJyaWdodCIsIkNPVU5USU5HX0FSRUFfTUFSR0lOIiwiYm90dG9tIiwibGlua2VkT2JqZWN0c0NvdW50aW5nQXJlYU5vZGUiLCJ2aWV3SGFzSW5kZXBlbmRlbnRNb2RlbCIsInZpc2libGUiLCJhZGRMaXN0ZW5lciIsIm9iamVjdHNMaW5rZWQiLCJtb3ZlVG9Gcm9udCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQ291bnRpbmdBY2NvcmRpb25Cb3gudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQ2xhc3MgZm9yIHRoZSAnT2JqZWN0cycgYWNjb3JkaW9uIGJveCwgd2hpY2ggaXMgdGhlIHBhbmVsIGluIHRoZSBsb3dlciByaWdodCBjb3JuZXIgb2YgdGhlIHNpbSB0aGF0IGRpc3BsYXlzIGFuXHJcbiAqIGVudmlyb25tZW50IGZvciBjb3VudGluZyB3aXRoIHZhcmlvdXMgb2JqZWN0cy5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBLbHVzZW5kb3JmIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBFbnVtZXJhdGlvblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRW51bWVyYXRpb25Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBDb3VudGluZ0NvbW1vbkNvbnN0YW50cyBmcm9tICcuLi8uLi8uLi8uLi9jb3VudGluZy1jb21tb24vanMvY29tbW9uL0NvdW50aW5nQ29tbW9uQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IENvdW50aW5nT2JqZWN0VHlwZSBmcm9tICcuLi8uLi8uLi8uLi9jb3VudGluZy1jb21tb24vanMvY29tbW9uL21vZGVsL0NvdW50aW5nT2JqZWN0VHlwZS5qcyc7XHJcbmltcG9ydCBEaW1lbnNpb24yIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9EaW1lbnNpb24yLmpzJztcclxuaW1wb3J0IHsgQ29sb3IsIEltYWdlLCBOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cCwgeyBSZWN0YW5ndWxhclJhZGlvQnV0dG9uR3JvdXBJdGVtIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL2J1dHRvbnMvUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwLmpzJztcclxuaW1wb3J0IG51bWJlclN1aXRlQ29tbW9uIGZyb20gJy4uLy4uL251bWJlclN1aXRlQ29tbW9uLmpzJztcclxuaW1wb3J0IE51bWJlclN1aXRlQ29tbW9uU3RyaW5ncyBmcm9tICcuLi8uLi9OdW1iZXJTdWl0ZUNvbW1vblN0cmluZ3MuanMnO1xyXG5pbXBvcnQgTnVtYmVyU3VpdGVDb21tb25Db25zdGFudHMgZnJvbSAnLi4vTnVtYmVyU3VpdGVDb21tb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgQ291bnRpbmdBcmVhTm9kZSBmcm9tICcuL0NvdW50aW5nQXJlYU5vZGUuanMnO1xyXG5pbXBvcnQgQ291bnRpbmdBcmVhIGZyb20gJy4uL21vZGVsL0NvdW50aW5nQXJlYS5qcyc7XHJcbmltcG9ydCBCYXNlTnVtYmVyTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9jb3VudGluZy1jb21tb24vanMvY29tbW9uL3ZpZXcvQmFzZU51bWJlck5vZGUuanMnO1xyXG5pbXBvcnQgQmFzZU51bWJlciBmcm9tICcuLi8uLi8uLi8uLi9jb3VudGluZy1jb21tb24vanMvY29tbW9uL21vZGVsL0Jhc2VOdW1iZXIuanMnO1xyXG5pbXBvcnQgTnVtYmVyU3VpdGVDb21tb25BY2NvcmRpb25Cb3gsIHsgTnVtYmVyU3VpdGVDb21tb25BY2NvcmRpb25Cb3hPcHRpb25zIH0gZnJvbSAnLi9OdW1iZXJTdWl0ZUNvbW1vbkFjY29yZGlvbkJveC5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFN0cmljdE9taXQgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1N0cmljdE9taXQuanMnO1xyXG5pbXBvcnQgUGlja09wdGlvbmFsIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrT3B0aW9uYWwuanMnO1xyXG5pbXBvcnQgVEVtaXR0ZXIgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9URW1pdHRlci5qcyc7XHJcblxyXG4vLyB0eXBlc1xyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIGNvdW50aW5nT2JqZWN0VHlwZXM/OiBDb3VudGluZ09iamVjdFR5cGVbXSB8IG51bGw7XHJcbiAgbGlua2VkQ291bnRpbmdBcmVhPzogQ291bnRpbmdBcmVhIHwgbnVsbDtcclxuICBsaW5rU3RhdHVzQ2hhbmdlZEVtaXR0ZXI/OiBURW1pdHRlcjxbIGJvb2xlYW4gXT4gfCBudWxsO1xyXG59O1xyXG5leHBvcnQgdHlwZSBDb3VudGluZ0FjY29yZGlvbkJveE9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmXHJcbiAgU3RyaWN0T21pdDxOdW1iZXJTdWl0ZUNvbW1vbkFjY29yZGlvbkJveE9wdGlvbnMsICd0aXRsZVN0cmluZ1Byb3BlcnR5Jz4gJlxyXG4gIFBpY2tPcHRpb25hbDxOdW1iZXJTdWl0ZUNvbW1vbkFjY29yZGlvbkJveE9wdGlvbnMsICd0aXRsZVN0cmluZ1Byb3BlcnR5Jz47XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgUkFESU9fQlVUVE9OX1NJWkUgPSBuZXcgRGltZW5zaW9uMiggMjgsIDI4ICk7IC8vIGluIHNjcmVlbiBjb29yZGluYXRlc1xyXG5cclxuY2xhc3MgQ291bnRpbmdBY2NvcmRpb25Cb3ggZXh0ZW5kcyBOdW1iZXJTdWl0ZUNvbW1vbkFjY29yZGlvbkJveCB7XHJcbiAgcHVibGljIHJlYWRvbmx5IGNvdW50aW5nQXJlYU5vZGU6IENvdW50aW5nQXJlYU5vZGU7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggY291bnRpbmdBcmVhOiBDb3VudGluZ0FyZWEsXHJcbiAgICAgICAgICAgICAgICAgICAgICBjb3VudGluZ09iamVjdFR5cGVQcm9wZXJ0eTogRW51bWVyYXRpb25Qcm9wZXJ0eTxDb3VudGluZ09iamVjdFR5cGU+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG51bWJlcixcclxuICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogbnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWRPcHRpb25zOiBDb3VudGluZ0FjY29yZGlvbkJveE9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxDb3VudGluZ0FjY29yZGlvbkJveE9wdGlvbnMsIFNlbGZPcHRpb25zLCBOdW1iZXJTdWl0ZUNvbW1vbkFjY29yZGlvbkJveE9wdGlvbnM+KCkoIHtcclxuICAgICAgdGl0bGVTdHJpbmdQcm9wZXJ0eTogTnVtYmVyU3VpdGVDb21tb25TdHJpbmdzLm9iamVjdHNTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgdGl0bGVUZXh0T3B0aW9uczoge1xyXG4gICAgICAgIG1heFdpZHRoOiBOdW1iZXJTdWl0ZUNvbW1vbkNvbnN0YW50cy5MT1dFUl9BQ0NPUkRJT05fQk9YX1RJVExFX01BWF9XSURUSFxyXG4gICAgICB9LFxyXG4gICAgICBjb3VudGluZ09iamVjdFR5cGVzOiBudWxsLFxyXG4gICAgICBsaW5rZWRDb3VudGluZ0FyZWE6IG51bGwsXHJcbiAgICAgIGxpbmtTdGF0dXNDaGFuZ2VkRW1pdHRlcjogbnVsbFxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIHdpZHRoLCBuZXcgUHJvcGVydHk8bnVtYmVyPiggaGVpZ2h0ICksIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLmNvdW50aW5nQXJlYU5vZGUgPSBuZXcgQ291bnRpbmdBcmVhTm9kZSggY291bnRpbmdBcmVhLCBjb3VudGluZ09iamVjdFR5cGVQcm9wZXJ0eSwgdGhpcy5jb250ZW50Qm91bmRzUHJvcGVydHkgKTtcclxuICAgIHRoaXMuY29udGVudE5vZGUuYWRkQ2hpbGQoIHRoaXMuY291bnRpbmdBcmVhTm9kZSApO1xyXG5cclxuICAgIGxldCByYWRpb0J1dHRvbkdyb3VwOiBSZWN0YW5ndWxhclJhZGlvQnV0dG9uR3JvdXA8Q291bnRpbmdPYmplY3RUeXBlPiB8IG51bGwgPSBudWxsO1xyXG4gICAgaWYgKCBvcHRpb25zLmNvdW50aW5nT2JqZWN0VHlwZXMgKSB7XHJcblxyXG4gICAgICAvLyBjcmVhdGUgdGhlIGljb25zIGZvciB0aGUgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwXHJcbiAgICAgIGNvbnN0IGJ1dHRvbnM6IFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cEl0ZW08Q291bnRpbmdPYmplY3RUeXBlPltdID0gW107XHJcbiAgICAgIG9wdGlvbnMuY291bnRpbmdPYmplY3RUeXBlcy5mb3JFYWNoKCBjb3VudGluZ09iamVjdFR5cGUgPT4ge1xyXG4gICAgICAgIGxldCBpY29uTm9kZTogTm9kZSB8IG51bGwgPSBudWxsO1xyXG4gICAgICAgIGlmICggY291bnRpbmdPYmplY3RUeXBlID09PSBDb3VudGluZ09iamVjdFR5cGUuUEFQRVJfTlVNQkVSICkge1xyXG4gICAgICAgICAgaWNvbk5vZGUgPSBuZXcgQmFzZU51bWJlck5vZGUoIG5ldyBCYXNlTnVtYmVyKCAxLCAwICksIDEgKTtcclxuICAgICAgICAgIGljb25Ob2RlLnNldFNjYWxlTWFnbml0dWRlKCBSQURJT19CVVRUT05fU0laRS5oZWlnaHQgLyBpY29uTm9kZS5oZWlnaHQgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBpY29uTm9kZSA9IG5ldyBJbWFnZSggQ291bnRpbmdDb21tb25Db25zdGFudHMuQ09VTlRJTkdfT0JKRUNUX1RZUEVfVE9fSU1BR0UuZ2V0KCBjb3VudGluZ09iamVjdFR5cGUgKSwge1xyXG4gICAgICAgICAgICBtYXhXaWR0aDogUkFESU9fQlVUVE9OX1NJWkUud2lkdGgsXHJcbiAgICAgICAgICAgIG1heEhlaWdodDogUkFESU9fQlVUVE9OX1NJWkUuaGVpZ2h0XHJcbiAgICAgICAgICB9ICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBidXR0b25zLnB1c2goIHtcclxuICAgICAgICAgIHZhbHVlOiBjb3VudGluZ09iamVjdFR5cGUsXHJcbiAgICAgICAgICBjcmVhdGVOb2RlOiAoKSA9PiBpY29uTm9kZSFcclxuICAgICAgICB9ICk7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIC8vIGNyZWF0ZSBhbmQgYWRkIHRoZSBSZWN0YW5ndWxhclJhZGlvQnV0dG9uR3JvdXAsIHdoaWNoIGlzIGEgY29udHJvbCBmb3IgY2hhbmdpbmcgdGhlIENvdW50aW5nT2JqZWN0VHlwZSBvZiB0aGUgY291bnRpbmdPYmplY3RzXHJcbiAgICAgIHJhZGlvQnV0dG9uR3JvdXAgPSBuZXcgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwKCBjb3VudGluZ09iamVjdFR5cGVQcm9wZXJ0eSwgYnV0dG9ucywge1xyXG4gICAgICAgIG9yaWVudGF0aW9uOiAnaG9yaXpvbnRhbCcsXHJcbiAgICAgICAgc3BhY2luZzogMTAsXHJcbiAgICAgICAgcmFkaW9CdXR0b25PcHRpb25zOiB7XHJcbiAgICAgICAgICBiYXNlQ29sb3I6IENvbG9yLldISVRFXHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgICAgIHJhZGlvQnV0dG9uR3JvdXAucmlnaHQgPSB0aGlzLmNvbnRlbnRCb3VuZHNQcm9wZXJ0eS52YWx1ZS5yaWdodCAtIENvdW50aW5nQ29tbW9uQ29uc3RhbnRzLkNPVU5USU5HX0FSRUFfTUFSR0lOO1xyXG4gICAgICByYWRpb0J1dHRvbkdyb3VwLmJvdHRvbSA9IHRoaXMuY29udGVudEJvdW5kc1Byb3BlcnR5LnZhbHVlLmJvdHRvbSAtIENvdW50aW5nQ29tbW9uQ29uc3RhbnRzLkNPVU5USU5HX0FSRUFfTUFSR0lOO1xyXG4gICAgICB0aGlzLmNvbnRlbnROb2RlLmFkZENoaWxkKCByYWRpb0J1dHRvbkdyb3VwICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYWRkIHRoZSBsaW5rZWQgY291bnRpbmdBcmVhXHJcbiAgICBpZiAoIG9wdGlvbnMubGlua2VkQ291bnRpbmdBcmVhICYmIG9wdGlvbnMubGlua1N0YXR1c0NoYW5nZWRFbWl0dGVyICkge1xyXG4gICAgICBjb25zdCBsaW5rZWRPYmplY3RzQ291bnRpbmdBcmVhTm9kZSA9IG5ldyBDb3VudGluZ0FyZWFOb2RlKFxyXG4gICAgICAgIG9wdGlvbnMubGlua2VkQ291bnRpbmdBcmVhLFxyXG4gICAgICAgIGNvdW50aW5nT2JqZWN0VHlwZVByb3BlcnR5LFxyXG4gICAgICAgIHRoaXMuY29udGVudEJvdW5kc1Byb3BlcnR5LCB7XHJcbiAgICAgICAgICB2aWV3SGFzSW5kZXBlbmRlbnRNb2RlbDogZmFsc2VcclxuICAgICAgICB9XHJcbiAgICAgICk7XHJcbiAgICAgIGxpbmtlZE9iamVjdHNDb3VudGluZ0FyZWFOb2RlLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgdGhpcy5jb250ZW50Tm9kZS5hZGRDaGlsZCggbGlua2VkT2JqZWN0c0NvdW50aW5nQXJlYU5vZGUgKTtcclxuXHJcbiAgICAgIG9wdGlvbnMubGlua1N0YXR1c0NoYW5nZWRFbWl0dGVyLmFkZExpc3RlbmVyKCBvYmplY3RzTGlua2VkID0+IHtcclxuICAgICAgICBsaW5rZWRPYmplY3RzQ291bnRpbmdBcmVhTm9kZS52aXNpYmxlID0gb2JqZWN0c0xpbmtlZDtcclxuICAgICAgICB0aGlzLmNvdW50aW5nQXJlYU5vZGUudmlzaWJsZSA9ICFvYmplY3RzTGlua2VkO1xyXG4gICAgICAgIHJhZGlvQnV0dG9uR3JvdXAgJiYgcmFkaW9CdXR0b25Hcm91cC5tb3ZlVG9Gcm9udCgpO1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5udW1iZXJTdWl0ZUNvbW1vbi5yZWdpc3RlciggJ0NvdW50aW5nQWNjb3JkaW9uQm94JywgQ291bnRpbmdBY2NvcmRpb25Cb3ggKTtcclxuZXhwb3J0IGRlZmF1bHQgQ291bnRpbmdBY2NvcmRpb25Cb3g7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0EsT0FBT0EsdUJBQXVCLE1BQU0sa0VBQWtFO0FBQ3RHLE9BQU9DLGtCQUFrQixNQUFNLG1FQUFtRTtBQUNsRyxPQUFPQyxVQUFVLE1BQU0sa0NBQWtDO0FBQ3pELFNBQVNDLEtBQUssRUFBRUMsS0FBSyxRQUFjLG1DQUFtQztBQUN0RSxPQUFPQywyQkFBMkIsTUFBMkMsMkRBQTJEO0FBQ3hJLE9BQU9DLGlCQUFpQixNQUFNLDRCQUE0QjtBQUMxRCxPQUFPQyx3QkFBd0IsTUFBTSxtQ0FBbUM7QUFDeEUsT0FBT0MsMEJBQTBCLE1BQU0sa0NBQWtDO0FBQ3pFLE9BQU9DLGdCQUFnQixNQUFNLHVCQUF1QjtBQUVwRCxPQUFPQyxjQUFjLE1BQU0sOERBQThEO0FBQ3pGLE9BQU9DLFVBQVUsTUFBTSwyREFBMkQ7QUFDbEYsT0FBT0MsNkJBQTZCLE1BQWdELG9DQUFvQztBQUN4SCxPQUFPQyxTQUFTLE1BQU0sdUNBQXVDO0FBQzdELE9BQU9DLFFBQVEsTUFBTSxpQ0FBaUM7O0FBS3REOztBQVVBO0FBQ0EsTUFBTUMsaUJBQWlCLEdBQUcsSUFBSWIsVUFBVSxDQUFFLEVBQUUsRUFBRSxFQUFHLENBQUMsQ0FBQyxDQUFDOztBQUVwRCxNQUFNYyxvQkFBb0IsU0FBU0osNkJBQTZCLENBQUM7RUFHeERLLFdBQVdBLENBQUVDLFlBQTBCLEVBQzFCQywwQkFBbUUsRUFDbkVDLEtBQWEsRUFDYkMsTUFBYyxFQUNkQyxlQUE0QyxFQUFHO0lBRWpFLE1BQU1DLE9BQU8sR0FBR1YsU0FBUyxDQUFpRixDQUFDLENBQUU7TUFDM0dXLG1CQUFtQixFQUFFakIsd0JBQXdCLENBQUNrQixxQkFBcUI7TUFDbkVDLGdCQUFnQixFQUFFO1FBQ2hCQyxRQUFRLEVBQUVuQiwwQkFBMEIsQ0FBQ29CO01BQ3ZDLENBQUM7TUFDREMsbUJBQW1CLEVBQUUsSUFBSTtNQUN6QkMsa0JBQWtCLEVBQUUsSUFBSTtNQUN4QkMsd0JBQXdCLEVBQUU7SUFDNUIsQ0FBQyxFQUFFVCxlQUFnQixDQUFDO0lBRXBCLEtBQUssQ0FBRUYsS0FBSyxFQUFFLElBQUlOLFFBQVEsQ0FBVU8sTUFBTyxDQUFDLEVBQUVFLE9BQVEsQ0FBQztJQUV2RCxJQUFJLENBQUNTLGdCQUFnQixHQUFHLElBQUl2QixnQkFBZ0IsQ0FBRVMsWUFBWSxFQUFFQywwQkFBMEIsRUFBRSxJQUFJLENBQUNjLHFCQUFzQixDQUFDO0lBQ3BILElBQUksQ0FBQ0MsV0FBVyxDQUFDQyxRQUFRLENBQUUsSUFBSSxDQUFDSCxnQkFBaUIsQ0FBQztJQUVsRCxJQUFJSSxnQkFBd0UsR0FBRyxJQUFJO0lBQ25GLElBQUtiLE9BQU8sQ0FBQ00sbUJBQW1CLEVBQUc7TUFFakM7TUFDQSxNQUFNUSxPQUE4RCxHQUFHLEVBQUU7TUFDekVkLE9BQU8sQ0FBQ00sbUJBQW1CLENBQUNTLE9BQU8sQ0FBRUMsa0JBQWtCLElBQUk7UUFDekQsSUFBSUMsUUFBcUIsR0FBRyxJQUFJO1FBQ2hDLElBQUtELGtCQUFrQixLQUFLdEMsa0JBQWtCLENBQUN3QyxZQUFZLEVBQUc7VUFDNURELFFBQVEsR0FBRyxJQUFJOUIsY0FBYyxDQUFFLElBQUlDLFVBQVUsQ0FBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDO1VBQzFENkIsUUFBUSxDQUFDRSxpQkFBaUIsQ0FBRTNCLGlCQUFpQixDQUFDTSxNQUFNLEdBQUdtQixRQUFRLENBQUNuQixNQUFPLENBQUM7UUFDMUUsQ0FBQyxNQUNJO1VBQ0htQixRQUFRLEdBQUcsSUFBSXBDLEtBQUssQ0FBRUosdUJBQXVCLENBQUMyQyw2QkFBNkIsQ0FBQ0MsR0FBRyxDQUFFTCxrQkFBbUIsQ0FBQyxFQUFFO1lBQ3JHWixRQUFRLEVBQUVaLGlCQUFpQixDQUFDSyxLQUFLO1lBQ2pDeUIsU0FBUyxFQUFFOUIsaUJBQWlCLENBQUNNO1VBQy9CLENBQUUsQ0FBQztRQUNMO1FBRUFnQixPQUFPLENBQUNTLElBQUksQ0FBRTtVQUNaQyxLQUFLLEVBQUVSLGtCQUFrQjtVQUN6QlMsVUFBVSxFQUFFQSxDQUFBLEtBQU1SO1FBQ3BCLENBQUUsQ0FBQztNQUNMLENBQUUsQ0FBQzs7TUFFSDtNQUNBSixnQkFBZ0IsR0FBRyxJQUFJL0IsMkJBQTJCLENBQUVjLDBCQUEwQixFQUFFa0IsT0FBTyxFQUFFO1FBQ3ZGWSxXQUFXLEVBQUUsWUFBWTtRQUN6QkMsT0FBTyxFQUFFLEVBQUU7UUFDWEMsa0JBQWtCLEVBQUU7VUFDbEJDLFNBQVMsRUFBRWpELEtBQUssQ0FBQ2tEO1FBQ25CO01BQ0YsQ0FBRSxDQUFDO01BQ0hqQixnQkFBZ0IsQ0FBQ2tCLEtBQUssR0FBRyxJQUFJLENBQUNyQixxQkFBcUIsQ0FBQ2MsS0FBSyxDQUFDTyxLQUFLLEdBQUd0RCx1QkFBdUIsQ0FBQ3VELG9CQUFvQjtNQUM5R25CLGdCQUFnQixDQUFDb0IsTUFBTSxHQUFHLElBQUksQ0FBQ3ZCLHFCQUFxQixDQUFDYyxLQUFLLENBQUNTLE1BQU0sR0FBR3hELHVCQUF1QixDQUFDdUQsb0JBQW9CO01BQ2hILElBQUksQ0FBQ3JCLFdBQVcsQ0FBQ0MsUUFBUSxDQUFFQyxnQkFBaUIsQ0FBQztJQUMvQzs7SUFFQTtJQUNBLElBQUtiLE9BQU8sQ0FBQ08sa0JBQWtCLElBQUlQLE9BQU8sQ0FBQ1Esd0JBQXdCLEVBQUc7TUFDcEUsTUFBTTBCLDZCQUE2QixHQUFHLElBQUloRCxnQkFBZ0IsQ0FDeERjLE9BQU8sQ0FBQ08sa0JBQWtCLEVBQzFCWCwwQkFBMEIsRUFDMUIsSUFBSSxDQUFDYyxxQkFBcUIsRUFBRTtRQUMxQnlCLHVCQUF1QixFQUFFO01BQzNCLENBQ0YsQ0FBQztNQUNERCw2QkFBNkIsQ0FBQ0UsT0FBTyxHQUFHLEtBQUs7TUFDN0MsSUFBSSxDQUFDekIsV0FBVyxDQUFDQyxRQUFRLENBQUVzQiw2QkFBOEIsQ0FBQztNQUUxRGxDLE9BQU8sQ0FBQ1Esd0JBQXdCLENBQUM2QixXQUFXLENBQUVDLGFBQWEsSUFBSTtRQUM3REosNkJBQTZCLENBQUNFLE9BQU8sR0FBR0UsYUFBYTtRQUNyRCxJQUFJLENBQUM3QixnQkFBZ0IsQ0FBQzJCLE9BQU8sR0FBRyxDQUFDRSxhQUFhO1FBQzlDekIsZ0JBQWdCLElBQUlBLGdCQUFnQixDQUFDMEIsV0FBVyxDQUFDLENBQUM7TUFDcEQsQ0FBRSxDQUFDO0lBQ0w7RUFDRjtBQUNGO0FBRUF4RCxpQkFBaUIsQ0FBQ3lELFFBQVEsQ0FBRSxzQkFBc0IsRUFBRS9DLG9CQUFxQixDQUFDO0FBQzFFLGVBQWVBLG9CQUFvQiJ9