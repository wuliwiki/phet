// Copyright 2019-2023, University of Colorado Boulder

/**
 * Class for a 'Ten Frame' Node, which creates ten frames (5x2 grid of squares) and fills them with dots by listening
 * to the provided Property. It supports any NumberProperty with a maximum range that is a multiple of ten.
 *
 * The static methods can be used to draw simple ten frame nodes and provide positions for the centers of their squares.
 *
 * @author Chris Klusendorf (PhET Interactive Simulations)
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import { Circle, HBox, Node, Path } from '../../../../scenery/js/imports.js';
import numberSuiteCommon from '../../numberSuiteCommon.js';
import NumberSuiteCommonConstants from '../NumberSuiteCommonConstants.js';
import optionize from '../../../../phet-core/js/optionize.js';

// types

// constants - all are used for both drawing the ten frame shape and positioning the dots within the ten frame shape
const NUMBER_OF_X_SQUARES = 5; // a ten frame is this many squares wide
const NUMBER_OF_Y_SQUARES = 2; // a ten frame is this many squares tall
const SIDE_LENGTH = 20; // the side length of one square in a ten frame
const DISTANCE_BETWEEN_TEN_FRAMES = 5; // horizontal spacing between ten frames, if there's more than one
const LINE_WIDTH = 0.8; // the line width of the lines in a ten frame. used in this class, not necessarily in getTenFramePath

class TenFrameNode extends Node {
  // a Node layer for the dots

  // the center of every dot spot available

  constructor(currentNumberProperty, sumRange) {
    super();
    assert && assert(sumRange.max % NumberSuiteCommonConstants.TEN === 0, `sumRange.max must be a multiple of ten, but was: ${sumRange.max}`);
    this.numberOfTenFrames = sumRange.max / NumberSuiteCommonConstants.TEN;

    // create the calculated number of ten frames needed
    const tenFramePaths = [];
    _.times(this.numberOfTenFrames, () => {
      tenFramePaths.push(TenFrameNode.getTenFramePath());
    });

    // add all ten frames, aligned in a horizontal line
    const alignedTenFrames = new HBox({
      children: tenFramePaths,
      spacing: DISTANCE_BETWEEN_TEN_FRAMES
    });
    this.addChild(alignedTenFrames);
    this.dotsLayer = new Node();
    this.addChild(this.dotsLayer);
    this.dotSpots = TenFrameNode.getSpotCenters({
      numberOfTenFrames: this.numberOfTenFrames
    });

    // update the number of dots shown whenever the current number changes
    currentNumberProperty.link(currentNumber => {
      this.updateDots(currentNumber);
    });
  }

  /**
   * Draws the provided number of dots on the dots layer.
   */
  updateDots(numberOfDots) {
    this.dotsLayer.removeAllChildren();
    for (let i = 0; i < numberOfDots; i++) {
      const dotNode = new Circle(SIDE_LENGTH / 4, {
        fill: 'black'
      });
      dotNode.center = this.dotSpots[i];
      this.dotsLayer.addChild(dotNode);
    }
  }

  /**
   * Calculates the center position of all the squares in a ten frame shape(s).
   */
  static getSpotCenters(provideOptions) {
    const options = optionize()({
      numberOfTenFrames: 1,
      sideLength: SIDE_LENGTH,
      lineWidth: LINE_WIDTH
    }, provideOptions);
    const spots = [];
    const squareCenterOffset = options.sideLength / 2 + options.lineWidth / 2; // offset from the edge to the first square's center

    // the width of i ten frames plus the space between ten frames
    const nextTenFrameXOffset = NUMBER_OF_X_SQUARES * options.sideLength + DISTANCE_BETWEEN_TEN_FRAMES + options.lineWidth / 2;
    for (let i = 0; i < options.numberOfTenFrames; i++) {
      const xOffset = i * nextTenFrameXOffset; // shift over for each additional ten frame

      // iterate through all squares in a ten frame and record the center of each square
      for (let j = 0; j < NUMBER_OF_Y_SQUARES; j++) {
        const y = j * options.sideLength + squareCenterOffset;
        for (let k = 0; k < NUMBER_OF_X_SQUARES; k++) {
          const x = k * options.sideLength + squareCenterOffset;
          spots.push(new Vector2(x + xOffset, y));
        }
      }
    }
    return spots;
  }

  /**
   * Draws a ten frame shape, which is a 5 by 2 grid of squares.
   */
  static getTenFramePath(providedOptions) {
    const options = optionize()({
      // GetTenFramePathSelfOptions
      sideLength: SIDE_LENGTH,
      // PathOptions
      fill: 'white',
      stroke: 'black',
      lineWidth: LINE_WIDTH
    }, providedOptions);
    const tenFrameShape = new Shape().moveTo(0, 0)

    // draw the bounding rectangle, counterclockwise
    .lineToRelative(0, NUMBER_OF_Y_SQUARES * options.sideLength).lineToRelative(NUMBER_OF_X_SQUARES * options.sideLength, 0).lineToRelative(0, -NUMBER_OF_Y_SQUARES * options.sideLength).lineToRelative(-NUMBER_OF_X_SQUARES * options.sideLength, 0).lineTo(0, NUMBER_OF_Y_SQUARES / 2 * options.sideLength)

    // draw the middle horizontal line, left to right
    .lineToRelative(NUMBER_OF_X_SQUARES * options.sideLength, 0)

    // draw the inner vertical lines, right to left
    .moveTo(NUMBER_OF_X_SQUARES * options.sideLength * 0.8, 0).lineToRelative(0, NUMBER_OF_Y_SQUARES * options.sideLength).moveTo(NUMBER_OF_X_SQUARES * options.sideLength * 0.6, 0).lineToRelative(0, NUMBER_OF_Y_SQUARES * options.sideLength).moveTo(NUMBER_OF_X_SQUARES * options.sideLength * 0.4, 0).lineToRelative(0, NUMBER_OF_Y_SQUARES * options.sideLength).moveTo(NUMBER_OF_X_SQUARES * options.sideLength * 0.2, 0).lineToRelative(0, NUMBER_OF_Y_SQUARES * options.sideLength).close();
    return new Path(tenFrameShape, options);
  }
}
numberSuiteCommon.register('TenFrameNode', TenFrameNode);
export default TenFrameNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiU2hhcGUiLCJDaXJjbGUiLCJIQm94IiwiTm9kZSIsIlBhdGgiLCJudW1iZXJTdWl0ZUNvbW1vbiIsIk51bWJlclN1aXRlQ29tbW9uQ29uc3RhbnRzIiwib3B0aW9uaXplIiwiTlVNQkVSX09GX1hfU1FVQVJFUyIsIk5VTUJFUl9PRl9ZX1NRVUFSRVMiLCJTSURFX0xFTkdUSCIsIkRJU1RBTkNFX0JFVFdFRU5fVEVOX0ZSQU1FUyIsIkxJTkVfV0lEVEgiLCJUZW5GcmFtZU5vZGUiLCJjb25zdHJ1Y3RvciIsImN1cnJlbnROdW1iZXJQcm9wZXJ0eSIsInN1bVJhbmdlIiwiYXNzZXJ0IiwibWF4IiwiVEVOIiwibnVtYmVyT2ZUZW5GcmFtZXMiLCJ0ZW5GcmFtZVBhdGhzIiwiXyIsInRpbWVzIiwicHVzaCIsImdldFRlbkZyYW1lUGF0aCIsImFsaWduZWRUZW5GcmFtZXMiLCJjaGlsZHJlbiIsInNwYWNpbmciLCJhZGRDaGlsZCIsImRvdHNMYXllciIsImRvdFNwb3RzIiwiZ2V0U3BvdENlbnRlcnMiLCJsaW5rIiwiY3VycmVudE51bWJlciIsInVwZGF0ZURvdHMiLCJudW1iZXJPZkRvdHMiLCJyZW1vdmVBbGxDaGlsZHJlbiIsImkiLCJkb3ROb2RlIiwiZmlsbCIsImNlbnRlciIsInByb3ZpZGVPcHRpb25zIiwib3B0aW9ucyIsInNpZGVMZW5ndGgiLCJsaW5lV2lkdGgiLCJzcG90cyIsInNxdWFyZUNlbnRlck9mZnNldCIsIm5leHRUZW5GcmFtZVhPZmZzZXQiLCJ4T2Zmc2V0IiwiaiIsInkiLCJrIiwieCIsInByb3ZpZGVkT3B0aW9ucyIsInN0cm9rZSIsInRlbkZyYW1lU2hhcGUiLCJtb3ZlVG8iLCJsaW5lVG9SZWxhdGl2ZSIsImxpbmVUbyIsImNsb3NlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJUZW5GcmFtZU5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQ2xhc3MgZm9yIGEgJ1RlbiBGcmFtZScgTm9kZSwgd2hpY2ggY3JlYXRlcyB0ZW4gZnJhbWVzICg1eDIgZ3JpZCBvZiBzcXVhcmVzKSBhbmQgZmlsbHMgdGhlbSB3aXRoIGRvdHMgYnkgbGlzdGVuaW5nXHJcbiAqIHRvIHRoZSBwcm92aWRlZCBQcm9wZXJ0eS4gSXQgc3VwcG9ydHMgYW55IE51bWJlclByb3BlcnR5IHdpdGggYSBtYXhpbXVtIHJhbmdlIHRoYXQgaXMgYSBtdWx0aXBsZSBvZiB0ZW4uXHJcbiAqXHJcbiAqIFRoZSBzdGF0aWMgbWV0aG9kcyBjYW4gYmUgdXNlZCB0byBkcmF3IHNpbXBsZSB0ZW4gZnJhbWUgbm9kZXMgYW5kIHByb3ZpZGUgcG9zaXRpb25zIGZvciB0aGUgY2VudGVycyBvZiB0aGVpciBzcXVhcmVzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIEtsdXNlbmRvcmYgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB7IENpcmNsZSwgSEJveCwgTm9kZSwgUGF0aCwgUGF0aE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbnVtYmVyU3VpdGVDb21tb24gZnJvbSAnLi4vLi4vbnVtYmVyU3VpdGVDb21tb24uanMnO1xyXG5pbXBvcnQgTnVtYmVyU3VpdGVDb21tb25Db25zdGFudHMgZnJvbSAnLi4vTnVtYmVyU3VpdGVDb21tb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5cclxuLy8gdHlwZXNcclxudHlwZSBHZXRTcG90Q2VudGVyc09wdGlvbnMgPSB7XHJcbiAgbnVtYmVyT2ZUZW5GcmFtZXM/OiBudW1iZXI7XHJcbiAgc2lkZUxlbmd0aD86IG51bWJlcjtcclxuICBsaW5lV2lkdGg/OiBudW1iZXI7XHJcbn07XHJcbnR5cGUgR2V0VGVuRnJhbWVQYXRoU2VsZk9wdGlvbnMgPSB7XHJcbiAgc2lkZUxlbmd0aD86IG51bWJlcjtcclxufTtcclxudHlwZSBHZXRUZW5GcmFtZVBhdGhPcHRpb25zID0gR2V0VGVuRnJhbWVQYXRoU2VsZk9wdGlvbnMgJiBQYXRoT3B0aW9ucztcclxuXHJcbi8vIGNvbnN0YW50cyAtIGFsbCBhcmUgdXNlZCBmb3IgYm90aCBkcmF3aW5nIHRoZSB0ZW4gZnJhbWUgc2hhcGUgYW5kIHBvc2l0aW9uaW5nIHRoZSBkb3RzIHdpdGhpbiB0aGUgdGVuIGZyYW1lIHNoYXBlXHJcbmNvbnN0IE5VTUJFUl9PRl9YX1NRVUFSRVMgPSA1OyAvLyBhIHRlbiBmcmFtZSBpcyB0aGlzIG1hbnkgc3F1YXJlcyB3aWRlXHJcbmNvbnN0IE5VTUJFUl9PRl9ZX1NRVUFSRVMgPSAyOyAvLyBhIHRlbiBmcmFtZSBpcyB0aGlzIG1hbnkgc3F1YXJlcyB0YWxsXHJcbmNvbnN0IFNJREVfTEVOR1RIID0gMjA7IC8vIHRoZSBzaWRlIGxlbmd0aCBvZiBvbmUgc3F1YXJlIGluIGEgdGVuIGZyYW1lXHJcbmNvbnN0IERJU1RBTkNFX0JFVFdFRU5fVEVOX0ZSQU1FUyA9IDU7IC8vIGhvcml6b250YWwgc3BhY2luZyBiZXR3ZWVuIHRlbiBmcmFtZXMsIGlmIHRoZXJlJ3MgbW9yZSB0aGFuIG9uZVxyXG5jb25zdCBMSU5FX1dJRFRIID0gMC44OyAvLyB0aGUgbGluZSB3aWR0aCBvZiB0aGUgbGluZXMgaW4gYSB0ZW4gZnJhbWUuIHVzZWQgaW4gdGhpcyBjbGFzcywgbm90IG5lY2Vzc2FyaWx5IGluIGdldFRlbkZyYW1lUGF0aFxyXG5cclxuY2xhc3MgVGVuRnJhbWVOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSBudW1iZXJPZlRlbkZyYW1lczogbnVtYmVyO1xyXG5cclxuICAvLyBhIE5vZGUgbGF5ZXIgZm9yIHRoZSBkb3RzXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkb3RzTGF5ZXI6IE5vZGU7XHJcblxyXG4gIC8vIHRoZSBjZW50ZXIgb2YgZXZlcnkgZG90IHNwb3QgYXZhaWxhYmxlXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkb3RTcG90czogVmVjdG9yMltdO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGN1cnJlbnROdW1iZXJQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPiwgc3VtUmFuZ2U6IFJhbmdlICkge1xyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBzdW1SYW5nZS5tYXggJSBOdW1iZXJTdWl0ZUNvbW1vbkNvbnN0YW50cy5URU4gPT09IDAsXHJcbiAgICAgIGBzdW1SYW5nZS5tYXggbXVzdCBiZSBhIG11bHRpcGxlIG9mIHRlbiwgYnV0IHdhczogJHtzdW1SYW5nZS5tYXh9YCApO1xyXG5cclxuICAgIHRoaXMubnVtYmVyT2ZUZW5GcmFtZXMgPSBzdW1SYW5nZS5tYXggLyBOdW1iZXJTdWl0ZUNvbW1vbkNvbnN0YW50cy5URU47XHJcblxyXG4gICAgLy8gY3JlYXRlIHRoZSBjYWxjdWxhdGVkIG51bWJlciBvZiB0ZW4gZnJhbWVzIG5lZWRlZFxyXG4gICAgY29uc3QgdGVuRnJhbWVQYXRoczogTm9kZVtdID0gW107XHJcbiAgICBfLnRpbWVzKCB0aGlzLm51bWJlck9mVGVuRnJhbWVzLCAoKSA9PiB7XHJcbiAgICAgIHRlbkZyYW1lUGF0aHMucHVzaCggVGVuRnJhbWVOb2RlLmdldFRlbkZyYW1lUGF0aCgpICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYWRkIGFsbCB0ZW4gZnJhbWVzLCBhbGlnbmVkIGluIGEgaG9yaXpvbnRhbCBsaW5lXHJcbiAgICBjb25zdCBhbGlnbmVkVGVuRnJhbWVzID0gbmV3IEhCb3goIHtcclxuICAgICAgY2hpbGRyZW46IHRlbkZyYW1lUGF0aHMsXHJcbiAgICAgIHNwYWNpbmc6IERJU1RBTkNFX0JFVFdFRU5fVEVOX0ZSQU1FU1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggYWxpZ25lZFRlbkZyYW1lcyApO1xyXG5cclxuICAgIHRoaXMuZG90c0xheWVyID0gbmV3IE5vZGUoKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuZG90c0xheWVyICk7XHJcblxyXG4gICAgdGhpcy5kb3RTcG90cyA9IFRlbkZyYW1lTm9kZS5nZXRTcG90Q2VudGVycygge1xyXG4gICAgICBudW1iZXJPZlRlbkZyYW1lczogdGhpcy5udW1iZXJPZlRlbkZyYW1lc1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSB0aGUgbnVtYmVyIG9mIGRvdHMgc2hvd24gd2hlbmV2ZXIgdGhlIGN1cnJlbnQgbnVtYmVyIGNoYW5nZXNcclxuICAgIGN1cnJlbnROdW1iZXJQcm9wZXJ0eS5saW5rKCBjdXJyZW50TnVtYmVyID0+IHtcclxuICAgICAgdGhpcy51cGRhdGVEb3RzKCBjdXJyZW50TnVtYmVyICk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEcmF3cyB0aGUgcHJvdmlkZWQgbnVtYmVyIG9mIGRvdHMgb24gdGhlIGRvdHMgbGF5ZXIuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVEb3RzKCBudW1iZXJPZkRvdHM6IG51bWJlciApOiB2b2lkIHtcclxuICAgIHRoaXMuZG90c0xheWVyLnJlbW92ZUFsbENoaWxkcmVuKCk7XHJcblxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZEb3RzOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IGRvdE5vZGUgPSBuZXcgQ2lyY2xlKCBTSURFX0xFTkdUSCAvIDQsIHsgZmlsbDogJ2JsYWNrJyB9ICk7XHJcbiAgICAgIGRvdE5vZGUuY2VudGVyID0gdGhpcy5kb3RTcG90c1sgaSBdO1xyXG4gICAgICB0aGlzLmRvdHNMYXllci5hZGRDaGlsZCggZG90Tm9kZSApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FsY3VsYXRlcyB0aGUgY2VudGVyIHBvc2l0aW9uIG9mIGFsbCB0aGUgc3F1YXJlcyBpbiBhIHRlbiBmcmFtZSBzaGFwZShzKS5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGdldFNwb3RDZW50ZXJzKCBwcm92aWRlT3B0aW9ucz86IEdldFNwb3RDZW50ZXJzT3B0aW9ucyApOiBWZWN0b3IyW10ge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8R2V0U3BvdENlbnRlcnNPcHRpb25zPigpKCB7XHJcbiAgICAgIG51bWJlck9mVGVuRnJhbWVzOiAxLFxyXG4gICAgICBzaWRlTGVuZ3RoOiBTSURFX0xFTkdUSCxcclxuICAgICAgbGluZVdpZHRoOiBMSU5FX1dJRFRIXHJcbiAgICB9LCBwcm92aWRlT3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IHNwb3RzID0gW107XHJcbiAgICBjb25zdCBzcXVhcmVDZW50ZXJPZmZzZXQgPSBvcHRpb25zLnNpZGVMZW5ndGggLyAyICsgb3B0aW9ucy5saW5lV2lkdGggLyAyOyAvLyBvZmZzZXQgZnJvbSB0aGUgZWRnZSB0byB0aGUgZmlyc3Qgc3F1YXJlJ3MgY2VudGVyXHJcblxyXG4gICAgLy8gdGhlIHdpZHRoIG9mIGkgdGVuIGZyYW1lcyBwbHVzIHRoZSBzcGFjZSBiZXR3ZWVuIHRlbiBmcmFtZXNcclxuICAgIGNvbnN0IG5leHRUZW5GcmFtZVhPZmZzZXQgPSBOVU1CRVJfT0ZfWF9TUVVBUkVTICogb3B0aW9ucy5zaWRlTGVuZ3RoICsgRElTVEFOQ0VfQkVUV0VFTl9URU5fRlJBTUVTICsgb3B0aW9ucy5saW5lV2lkdGggLyAyO1xyXG5cclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IG9wdGlvbnMubnVtYmVyT2ZUZW5GcmFtZXM7IGkrKyApIHtcclxuICAgICAgY29uc3QgeE9mZnNldCA9IGkgKiBuZXh0VGVuRnJhbWVYT2Zmc2V0OyAvLyBzaGlmdCBvdmVyIGZvciBlYWNoIGFkZGl0aW9uYWwgdGVuIGZyYW1lXHJcblxyXG4gICAgICAvLyBpdGVyYXRlIHRocm91Z2ggYWxsIHNxdWFyZXMgaW4gYSB0ZW4gZnJhbWUgYW5kIHJlY29yZCB0aGUgY2VudGVyIG9mIGVhY2ggc3F1YXJlXHJcbiAgICAgIGZvciAoIGxldCBqID0gMDsgaiA8IE5VTUJFUl9PRl9ZX1NRVUFSRVM7IGorKyApIHtcclxuICAgICAgICBjb25zdCB5ID0gaiAqIG9wdGlvbnMuc2lkZUxlbmd0aCArIHNxdWFyZUNlbnRlck9mZnNldDtcclxuICAgICAgICBmb3IgKCBsZXQgayA9IDA7IGsgPCBOVU1CRVJfT0ZfWF9TUVVBUkVTOyBrKysgKSB7XHJcbiAgICAgICAgICBjb25zdCB4ID0gayAqIG9wdGlvbnMuc2lkZUxlbmd0aCArIHNxdWFyZUNlbnRlck9mZnNldDtcclxuICAgICAgICAgIHNwb3RzLnB1c2goIG5ldyBWZWN0b3IyKCB4ICsgeE9mZnNldCwgeSApICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3BvdHM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEcmF3cyBhIHRlbiBmcmFtZSBzaGFwZSwgd2hpY2ggaXMgYSA1IGJ5IDIgZ3JpZCBvZiBzcXVhcmVzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgZ2V0VGVuRnJhbWVQYXRoKCBwcm92aWRlZE9wdGlvbnM/OiBHZXRUZW5GcmFtZVBhdGhPcHRpb25zICk6IFBhdGgge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8R2V0VGVuRnJhbWVQYXRoT3B0aW9ucywgR2V0VGVuRnJhbWVQYXRoU2VsZk9wdGlvbnMsIFBhdGhPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBHZXRUZW5GcmFtZVBhdGhTZWxmT3B0aW9uc1xyXG4gICAgICBzaWRlTGVuZ3RoOiBTSURFX0xFTkdUSCxcclxuXHJcbiAgICAgIC8vIFBhdGhPcHRpb25zXHJcbiAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgbGluZVdpZHRoOiBMSU5FX1dJRFRIXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCB0ZW5GcmFtZVNoYXBlID0gbmV3IFNoYXBlKClcclxuICAgICAgLm1vdmVUbyggMCwgMCApXHJcblxyXG4gICAgICAvLyBkcmF3IHRoZSBib3VuZGluZyByZWN0YW5nbGUsIGNvdW50ZXJjbG9ja3dpc2VcclxuICAgICAgLmxpbmVUb1JlbGF0aXZlKCAwLCBOVU1CRVJfT0ZfWV9TUVVBUkVTICogb3B0aW9ucy5zaWRlTGVuZ3RoIClcclxuICAgICAgLmxpbmVUb1JlbGF0aXZlKCBOVU1CRVJfT0ZfWF9TUVVBUkVTICogb3B0aW9ucy5zaWRlTGVuZ3RoLCAwIClcclxuICAgICAgLmxpbmVUb1JlbGF0aXZlKCAwLCAtTlVNQkVSX09GX1lfU1FVQVJFUyAqIG9wdGlvbnMuc2lkZUxlbmd0aCApXHJcbiAgICAgIC5saW5lVG9SZWxhdGl2ZSggLU5VTUJFUl9PRl9YX1NRVUFSRVMgKiBvcHRpb25zLnNpZGVMZW5ndGgsIDAgKVxyXG4gICAgICAubGluZVRvKCAwLCBOVU1CRVJfT0ZfWV9TUVVBUkVTIC8gMiAqIG9wdGlvbnMuc2lkZUxlbmd0aCApXHJcblxyXG4gICAgICAvLyBkcmF3IHRoZSBtaWRkbGUgaG9yaXpvbnRhbCBsaW5lLCBsZWZ0IHRvIHJpZ2h0XHJcbiAgICAgIC5saW5lVG9SZWxhdGl2ZSggTlVNQkVSX09GX1hfU1FVQVJFUyAqIG9wdGlvbnMuc2lkZUxlbmd0aCwgMCApXHJcblxyXG4gICAgICAvLyBkcmF3IHRoZSBpbm5lciB2ZXJ0aWNhbCBsaW5lcywgcmlnaHQgdG8gbGVmdFxyXG4gICAgICAubW92ZVRvKCBOVU1CRVJfT0ZfWF9TUVVBUkVTICogb3B0aW9ucy5zaWRlTGVuZ3RoICogMC44LCAwIClcclxuICAgICAgLmxpbmVUb1JlbGF0aXZlKCAwLCBOVU1CRVJfT0ZfWV9TUVVBUkVTICogb3B0aW9ucy5zaWRlTGVuZ3RoIClcclxuICAgICAgLm1vdmVUbyggTlVNQkVSX09GX1hfU1FVQVJFUyAqIG9wdGlvbnMuc2lkZUxlbmd0aCAqIDAuNiwgMCApXHJcbiAgICAgIC5saW5lVG9SZWxhdGl2ZSggMCwgTlVNQkVSX09GX1lfU1FVQVJFUyAqIG9wdGlvbnMuc2lkZUxlbmd0aCApXHJcbiAgICAgIC5tb3ZlVG8oIE5VTUJFUl9PRl9YX1NRVUFSRVMgKiBvcHRpb25zLnNpZGVMZW5ndGggKiAwLjQsIDAgKVxyXG4gICAgICAubGluZVRvUmVsYXRpdmUoIDAsIE5VTUJFUl9PRl9ZX1NRVUFSRVMgKiBvcHRpb25zLnNpZGVMZW5ndGggKVxyXG4gICAgICAubW92ZVRvKCBOVU1CRVJfT0ZfWF9TUVVBUkVTICogb3B0aW9ucy5zaWRlTGVuZ3RoICogMC4yLCAwIClcclxuICAgICAgLmxpbmVUb1JlbGF0aXZlKCAwLCBOVU1CRVJfT0ZfWV9TUVVBUkVTICogb3B0aW9ucy5zaWRlTGVuZ3RoIClcclxuICAgICAgLmNsb3NlKCk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQYXRoKCB0ZW5GcmFtZVNoYXBlLCBvcHRpb25zICk7XHJcbiAgfVxyXG59XHJcblxyXG5udW1iZXJTdWl0ZUNvbW1vbi5yZWdpc3RlciggJ1RlbkZyYW1lTm9kZScsIFRlbkZyYW1lTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBUZW5GcmFtZU5vZGU7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0sK0JB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