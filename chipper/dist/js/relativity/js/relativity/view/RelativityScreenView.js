// Copyright 2023, University of Colorado Boulder

/**
 * TODO Describe this class and its responsibilities.
 *
 * @author Zijian Wang
 */

import ScreenView from '../../../../joist/js/ScreenView.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import RelativityConstants from '../../common/RelativityConstants.js';
import relativity from '../../relativity.js';
import optionize from '../../../../phet-core/js/optionize.js';
import PlaneView from "./PlaneView.js";
import { Rectangle, Node, Text } from "../../../../scenery/js/imports.js";
import XAxisView from "./XAxisView.js";
import ControlPanelView from "./ControlPanelView.js";
import Matrix3 from "../../../../dot/js/Matrix3.js";
import EarthView from "./EarthView.js";
import LorentzPanelView from "./LorentzPanel.js";
import HintPanelView from "./HintPanelView.js";
export default class RelativityScreenView extends ScreenView {
  nodeA = new Node();
  nodeB = new Node();
  matA = new Matrix3();
  matB = new Matrix3();
  tA = [];
  tB = [];
  tSpace_shuttle = 0;
  tEarth = 0;
  vScala = 30;
  unitSpace = 80;
  planeView = new PlaneView();
  earthView = new EarthView();
  x0 = 0;
  y0 = 0;
  distance = 0;
  constructor(model, providedOptions) {
    const options = optionize()({
      //TODO add default values for optional SelfOptions here
      //TODO add default values for optional ScreenViewOptions here
    }, providedOptions);
    super(options);
    this.x0 = this.layoutBounds.centerX;
    this.y0 = this.layoutBounds.centerY;
    const TIME_FONT = 16;
    this.addChild(new Rectangle(1, 1, this.layoutBounds.width, this.layoutBounds.height, {
      fill: 'rgb( 222, 222, 222 )'
    })); //test layout

    this.nodeA.addChild(this.planeView);
    this.nodeB.addChild(this.earthView);

    //add Watch A
    for (let i = -5; i <= 5; i += 1) {
      const t = new Text("0.00", {
        centerX: i * this.unitSpace,
        centerY: -4 * TIME_FONT,
        fontSize: TIME_FONT
      });
      this.tA.push(t);
      this.nodeA.addChild(t);
      this.nodeA.addChild(new Text(i, {
        centerX: i * this.unitSpace,
        centerY: 20,
        fontSize: TIME_FONT
      }));
    }
    this.nodeA.addChild(new Text("t' /s =", {
      right: -5 * this.unitSpace - 24,
      centerY: -4 * TIME_FONT,
      fontSize: TIME_FONT
    }));
    this.nodeA.addChild(new Text("x' /ls =", {
      right: -5 * this.unitSpace - 24,
      centerY: 20,
      fontSize: TIME_FONT
    }));

    //add Watch B
    for (let i = -5; i <= 5; i += 1) {
      const t = new Text("0.00", {
        centerX: i * this.unitSpace,
        centerY: 3 * TIME_FONT,
        fontSize: TIME_FONT
      });
      this.tB.push(t);
      this.nodeB.addChild(t);
      this.nodeB.addChild(new Text(i, {
        centerX: i * this.unitSpace,
        centerY: -20,
        fontSize: TIME_FONT
      }));
    }
    this.nodeB.addChild(new Text("t /s =", {
      right: -5 * this.unitSpace - 24,
      centerY: 3 * TIME_FONT,
      fontSize: TIME_FONT
    }));
    this.nodeB.addChild(new Text("x /ls =", {
      right: -5 * this.unitSpace - 24,
      centerY: -20,
      fontSize: TIME_FONT
    }));

    //add Coord
    this.nodeA.addChild(new XAxisView("x'", "y'", -5, 5, 0, 0.5, this.unitSpace));
    this.nodeB.addChild(new XAxisView("x", "y", -5, 5, 0, 0.5, this.unitSpace));
    this.addChild(this.nodeA);
    this.addChild(this.nodeB);
    this.controlPanel = new ControlPanelView({
      right: 2 * this.x0 - RelativityConstants.SCREEN_VIEW_X_MARGIN - 255,
      bottom: 2 * this.y0 - RelativityConstants.SCREEN_VIEW_Y_MARGIN - 104
      //maxWidth: 200,
    });

    this.addChild(this.controlPanel);
    let lorentzPanel = new LorentzPanelView({
      right: 2 * this.x0 - RelativityConstants.SCREEN_VIEW_X_MARGIN - 58,
      bottom: 2 * this.y0 - RelativityConstants.SCREEN_VIEW_Y_MARGIN
      //maxWidth: 200,
    });

    this.addChild(lorentzPanel);
    let hintPanel = new HintPanelView({
      left: 20,
      bottom: 2 * this.y0 - RelativityConstants.SCREEN_VIEW_Y_MARGIN
      //maxWidth: 580,
    });

    this.addChild(hintPanel);
    const resetAllButton = new ResetAllButton({
      listener: () => {
        this.interruptSubtreeInput(); // cancel interactions that may be in progress
        model.reset();
        this.reset();
      },
      right: 2 * this.x0 - RelativityConstants.SCREEN_VIEW_X_MARGIN,
      bottom: 2 * this.y0 - RelativityConstants.SCREEN_VIEW_Y_MARGIN,
      tandem: options.tandem.createTandem('resetAllButton')
    });
    this.addChild(resetAllButton);
    this.reset();
  }

  /**
   * Resets the view.
   */
  reset() {
    //TODO
    this.controlPanel.isPlaying.value = false;
    this.matA.setArray([1, 0, 0, 0, 1, 0, this.x0, this.y0 - this.unitSpace * 2.5, 1]);
    this.matB.setArray([1, 0, 0, 0, 1, 0, this.x0, this.y0 - this.unitSpace * 1.5, 1]);
    this.nodeA.setMatrix(this.matA);
    this.nodeB.setMatrix(this.matB);
    this.distance = 0;
    this.tSpace_shuttle = 0;
    this.tEarth = 0;
  }

  /**
   * Steps the view.
   * @param dt - time step, in seconds
   */
  step(dt) {
    let one_over_gamma = Math.sqrt(1 - this.controlPanel.velocity ** 2);
    if (this.controlPanel.velocity < 0 && this.planeView.isRight || this.controlPanel.velocity >= 0 && !this.planeView.isRight) {
      this.planeView.flip();
    }
    if (this.controlPanel.isPlaying.value) {
      if (this.controlPanel.aChecked.value) {
        this.tSpace_shuttle += one_over_gamma * dt / (this.unitSpace / this.vScala);
        this.tEarth += dt / (this.unitSpace / this.vScala);
        this.distance += this.vScala * dt * this.controlPanel.velocity;
      } else {
        this.tSpace_shuttle += dt / (this.unitSpace / this.vScala);
        this.tEarth += dt / (this.unitSpace / this.vScala) / one_over_gamma;
        this.distance += this.vScala * dt * this.controlPanel.velocity / one_over_gamma;
      }
    }
    if (this.controlPanel.aChecked.value) {
      this.matA.set00(one_over_gamma);
      this.matB.set00(1);
      this.matA.set02(this.x0 + this.distance);
      this.matB.set02(this.x0);
      this.nodeA.setMatrix(this.matA);
      this.nodeB.setMatrix(this.matB);
      for (let i = 0; i < this.tA.length; i++) {
        let tt = this.tSpace_shuttle - (i - 5) * this.controlPanel.velocity;
        this.tA[i].setString(tt.toFixed(3));
        this.tB[i].setString(this.tEarth.toFixed(3));
      }
    } else {
      this.matA.set00(1);
      this.matB.set00(one_over_gamma);
      this.matA.set02(this.x0);
      this.matB.set02(this.x0 - one_over_gamma * this.distance);
      this.nodeA.setMatrix(this.matA);
      this.nodeB.setMatrix(this.matB);
      for (let i = 0; i < this.tB.length; i++) {
        let tt = this.tEarth + (i - this.distance / this.unitSpace - 5) * this.controlPanel.velocity;
        this.tA[i].setString(this.tSpace_shuttle.toFixed(3));
        this.tB[i].setString(tt.toFixed(3));
      }
    }
    this.controlPanel.space_shuttle_t_ = this.tSpace_shuttle;
    this.controlPanel.space_shuttle_t = this.tEarth;
    this.controlPanel.space_shuttle_x = this.distance / this.unitSpace;
    this.controlPanel.setText();
  }
}
relativity.register('RelativityScreenView', RelativityScreenView);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTY3JlZW5WaWV3IiwiUmVzZXRBbGxCdXR0b24iLCJSZWxhdGl2aXR5Q29uc3RhbnRzIiwicmVsYXRpdml0eSIsIm9wdGlvbml6ZSIsIlBsYW5lVmlldyIsIlJlY3RhbmdsZSIsIk5vZGUiLCJUZXh0IiwiWEF4aXNWaWV3IiwiQ29udHJvbFBhbmVsVmlldyIsIk1hdHJpeDMiLCJFYXJ0aFZpZXciLCJMb3JlbnR6UGFuZWxWaWV3IiwiSGludFBhbmVsVmlldyIsIlJlbGF0aXZpdHlTY3JlZW5WaWV3Iiwibm9kZUEiLCJub2RlQiIsIm1hdEEiLCJtYXRCIiwidEEiLCJ0QiIsInRTcGFjZV9zaHV0dGxlIiwidEVhcnRoIiwidlNjYWxhIiwidW5pdFNwYWNlIiwicGxhbmVWaWV3IiwiZWFydGhWaWV3IiwieDAiLCJ5MCIsImRpc3RhbmNlIiwiY29uc3RydWN0b3IiLCJtb2RlbCIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJsYXlvdXRCb3VuZHMiLCJjZW50ZXJYIiwiY2VudGVyWSIsIlRJTUVfRk9OVCIsImFkZENoaWxkIiwid2lkdGgiLCJoZWlnaHQiLCJmaWxsIiwiaSIsInQiLCJmb250U2l6ZSIsInB1c2giLCJyaWdodCIsImNvbnRyb2xQYW5lbCIsIlNDUkVFTl9WSUVXX1hfTUFSR0lOIiwiYm90dG9tIiwiU0NSRUVOX1ZJRVdfWV9NQVJHSU4iLCJsb3JlbnR6UGFuZWwiLCJoaW50UGFuZWwiLCJsZWZ0IiwicmVzZXRBbGxCdXR0b24iLCJsaXN0ZW5lciIsImludGVycnVwdFN1YnRyZWVJbnB1dCIsInJlc2V0IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwiaXNQbGF5aW5nIiwidmFsdWUiLCJzZXRBcnJheSIsInNldE1hdHJpeCIsInN0ZXAiLCJkdCIsIm9uZV9vdmVyX2dhbW1hIiwiTWF0aCIsInNxcnQiLCJ2ZWxvY2l0eSIsImlzUmlnaHQiLCJmbGlwIiwiYUNoZWNrZWQiLCJzZXQwMCIsInNldDAyIiwibGVuZ3RoIiwidHQiLCJzZXRTdHJpbmciLCJ0b0ZpeGVkIiwic3BhY2Vfc2h1dHRsZV90XyIsInNwYWNlX3NodXR0bGVfdCIsInNwYWNlX3NodXR0bGVfeCIsInNldFRleHQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlJlbGF0aXZpdHlTY3JlZW5WaWV3LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBUT0RPIERlc2NyaWJlIHRoaXMgY2xhc3MgYW5kIGl0cyByZXNwb25zaWJpbGl0aWVzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFppamlhbiBXYW5nXHJcbiAqL1xyXG5cclxuaW1wb3J0IFNjcmVlblZpZXcsIHtTY3JlZW5WaWV3T3B0aW9uc30gZnJvbSAnLi4vLi4vLi4vLi4vam9pc3QvanMvU2NyZWVuVmlldy5qcyc7XHJcbmltcG9ydCBSZXNldEFsbEJ1dHRvbiBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvYnV0dG9ucy9SZXNldEFsbEJ1dHRvbi5qcyc7XHJcbmltcG9ydCBSZWxhdGl2aXR5Q29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9SZWxhdGl2aXR5Q29uc3RhbnRzLmpzJztcclxuaW1wb3J0IHJlbGF0aXZpdHkgZnJvbSAnLi4vLi4vcmVsYXRpdml0eS5qcyc7XHJcbmltcG9ydCBSZWxhdGl2aXR5TW9kZWwgZnJvbSAnLi4vbW9kZWwvUmVsYXRpdml0eU1vZGVsLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFBsYW5lVmlldyBmcm9tIFwiLi9QbGFuZVZpZXcuanNcIjtcclxuaW1wb3J0IHtSZWN0YW5nbGUsIE5vZGUsIFRleHR9IGZyb20gXCIuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanNcIjtcclxuaW1wb3J0IFhBeGlzVmlldyBmcm9tIFwiLi9YQXhpc1ZpZXcuanNcIjtcclxuaW1wb3J0IENvbnRyb2xQYW5lbFZpZXcgZnJvbSBcIi4vQ29udHJvbFBhbmVsVmlldy5qc1wiO1xyXG5pbXBvcnQgTWF0cml4MyBmcm9tIFwiLi4vLi4vLi4vLi4vZG90L2pzL01hdHJpeDMuanNcIjtcclxuaW1wb3J0IEVhcnRoVmlldyBmcm9tIFwiLi9FYXJ0aFZpZXcuanNcIjtcclxuaW1wb3J0IExvcmVudHpQYW5lbFZpZXcgZnJvbSBcIi4vTG9yZW50elBhbmVsLmpzXCI7XHJcbmltcG9ydCBIaW50UGFuZWxWaWV3IGZyb20gXCIuL0hpbnRQYW5lbFZpZXcuanNcIjtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgICAvL1RPRE8gYWRkIG9wdGlvbnMgdGhhdCBhcmUgc3BlY2lmaWMgdG8gUmVsYXRpdml0eVNjcmVlblZpZXcgaGVyZVxyXG59O1xyXG5cclxudHlwZSBSZWxhdGl2aXR5U2NyZWVuVmlld09wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFNjcmVlblZpZXdPcHRpb25zO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVsYXRpdml0eVNjcmVlblZpZXcgZXh0ZW5kcyBTY3JlZW5WaWV3IHtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgY29udHJvbFBhbmVsOiBDb250cm9sUGFuZWxWaWV3O1xyXG5cclxuICAgIHByaXZhdGUgbm9kZUE6IE5vZGUgPSBuZXcgTm9kZSgpO1xyXG4gICAgcHJpdmF0ZSBub2RlQjogTm9kZSA9IG5ldyBOb2RlKCk7XHJcbiAgICBwcml2YXRlIG1hdEEgPSBuZXcgTWF0cml4MygpO1xyXG4gICAgcHJpdmF0ZSBtYXRCID0gbmV3IE1hdHJpeDMoKTtcclxuXHJcbiAgICBwcml2YXRlIHRBOiBUZXh0W10gPSBbXTtcclxuICAgIHByaXZhdGUgdEI6IFRleHRbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSB0U3BhY2Vfc2h1dHRsZSA9IDBcclxuICAgIHByaXZhdGUgdEVhcnRoID0gMFxyXG4gICAgcHJpdmF0ZSB2U2NhbGEgPSAzMDtcclxuICAgIHByaXZhdGUgdW5pdFNwYWNlID0gODBcclxuICAgIHByaXZhdGUgcGxhbmVWaWV3ID0gbmV3IFBsYW5lVmlldygpXHJcbiAgICBwcml2YXRlIGVhcnRoVmlldyA9IG5ldyBFYXJ0aFZpZXcoKVxyXG4gICAgcHJpdmF0ZSB4MD0wXHJcbiAgICBwcml2YXRlIHkwPTBcclxuICAgIHByaXZhdGUgZGlzdGFuY2UgPSAwXHJcblxyXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKG1vZGVsOiBSZWxhdGl2aXR5TW9kZWwsIHByb3ZpZGVkT3B0aW9uczogUmVsYXRpdml0eVNjcmVlblZpZXdPcHRpb25zKSB7XHJcblxyXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8UmVsYXRpdml0eVNjcmVlblZpZXdPcHRpb25zLCBTZWxmT3B0aW9ucywgU2NyZWVuVmlld09wdGlvbnM+KCkoe1xyXG4gICAgICAgICAgICAvL1RPRE8gYWRkIGRlZmF1bHQgdmFsdWVzIGZvciBvcHRpb25hbCBTZWxmT3B0aW9ucyBoZXJlXHJcbiAgICAgICAgICAgIC8vVE9ETyBhZGQgZGVmYXVsdCB2YWx1ZXMgZm9yIG9wdGlvbmFsIFNjcmVlblZpZXdPcHRpb25zIGhlcmVcclxuICAgICAgICB9LCBwcm92aWRlZE9wdGlvbnMpO1xyXG5cclxuICAgICAgICBzdXBlcihvcHRpb25zKTtcclxuICAgICAgICB0aGlzLngwID0gdGhpcy5sYXlvdXRCb3VuZHMuY2VudGVyWFxyXG4gICAgICAgIHRoaXMueTAgPSB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJZXHJcblxyXG4gICAgICAgIGNvbnN0IFRJTUVfRk9OVCA9IDE2O1xyXG4gICAgICAgIHRoaXMuYWRkQ2hpbGQobmV3IFJlY3RhbmdsZSgxLCAxLCB0aGlzLmxheW91dEJvdW5kcy53aWR0aCwgdGhpcy5sYXlvdXRCb3VuZHMuaGVpZ2h0LCB7ZmlsbDogJ3JnYiggMjIyLCAyMjIsIDIyMiApJ30pKSAvL3Rlc3QgbGF5b3V0XHJcblxyXG4gICAgICAgIHRoaXMubm9kZUEuYWRkQ2hpbGQodGhpcy5wbGFuZVZpZXcpO1xyXG4gICAgICAgIHRoaXMubm9kZUIuYWRkQ2hpbGQodGhpcy5lYXJ0aFZpZXcpO1xyXG5cclxuICAgICAgICAvL2FkZCBXYXRjaCBBXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IC01OyBpIDw9IDU7IGkgKz0gMSkge1xyXG4gICAgICAgICAgICBjb25zdCB0ID0gbmV3IFRleHQoXCIwLjAwXCIsIHtjZW50ZXJYOiBpICogdGhpcy51bml0U3BhY2UsIGNlbnRlclk6IC00ICogVElNRV9GT05ULCBmb250U2l6ZTogVElNRV9GT05UfSk7XHJcbiAgICAgICAgICAgIHRoaXMudEEucHVzaCh0KTtcclxuICAgICAgICAgICAgdGhpcy5ub2RlQS5hZGRDaGlsZCh0KVxyXG4gICAgICAgICAgICB0aGlzLm5vZGVBLmFkZENoaWxkKG5ldyBUZXh0KGksIHtcclxuICAgICAgICAgICAgICAgIGNlbnRlclg6IGkgKiB0aGlzLnVuaXRTcGFjZSxcclxuICAgICAgICAgICAgICAgIGNlbnRlclk6IDIwLFxyXG4gICAgICAgICAgICAgICAgZm9udFNpemU6IFRJTUVfRk9OVFxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubm9kZUEuYWRkQ2hpbGQobmV3IFRleHQoXCJ0JyAvcyA9XCIsIHtcclxuICAgICAgICAgICAgcmlnaHQ6IC01ICogdGhpcy51bml0U3BhY2UgLSAyNCxcclxuICAgICAgICAgICAgY2VudGVyWTogLTQgKiBUSU1FX0ZPTlQsXHJcbiAgICAgICAgICAgIGZvbnRTaXplOiBUSU1FX0ZPTlRcclxuICAgICAgICB9KSlcclxuICAgICAgICB0aGlzLm5vZGVBLmFkZENoaWxkKG5ldyBUZXh0KFwieCcgL2xzID1cIiwge1xyXG4gICAgICAgICAgICByaWdodDogLTUgKiB0aGlzLnVuaXRTcGFjZSAtIDI0LFxyXG4gICAgICAgICAgICBjZW50ZXJZOiAyMCxcclxuICAgICAgICAgICAgZm9udFNpemU6IFRJTUVfRk9OVFxyXG4gICAgICAgIH0pKVxyXG5cclxuICAgICAgICAvL2FkZCBXYXRjaCBCXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IC01OyBpIDw9IDU7IGkgKz0gMSkge1xyXG4gICAgICAgICAgICBjb25zdCB0ID0gbmV3IFRleHQoXCIwLjAwXCIsIHtjZW50ZXJYOiBpICogdGhpcy51bml0U3BhY2UsIGNlbnRlclk6IDMgKiBUSU1FX0ZPTlQsIGZvbnRTaXplOiBUSU1FX0ZPTlR9KTtcclxuICAgICAgICAgICAgdGhpcy50Qi5wdXNoKHQpXHJcbiAgICAgICAgICAgIHRoaXMubm9kZUIuYWRkQ2hpbGQodClcclxuICAgICAgICAgICAgdGhpcy5ub2RlQi5hZGRDaGlsZChuZXcgVGV4dChpLCB7XHJcbiAgICAgICAgICAgICAgICBjZW50ZXJYOiBpICogdGhpcy51bml0U3BhY2UsXHJcbiAgICAgICAgICAgICAgICBjZW50ZXJZOiAtMjAsXHJcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogVElNRV9GT05UXHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ub2RlQi5hZGRDaGlsZChuZXcgVGV4dChcInQgL3MgPVwiLCB7XHJcbiAgICAgICAgICAgIHJpZ2h0OiAtNSAqIHRoaXMudW5pdFNwYWNlIC0gMjQsXHJcbiAgICAgICAgICAgIGNlbnRlclk6IDMgKiBUSU1FX0ZPTlQsXHJcbiAgICAgICAgICAgIGZvbnRTaXplOiBUSU1FX0ZPTlRcclxuICAgICAgICB9KSlcclxuICAgICAgICB0aGlzLm5vZGVCLmFkZENoaWxkKG5ldyBUZXh0KFwieCAvbHMgPVwiLCB7XHJcbiAgICAgICAgICAgIHJpZ2h0OiAtNSAqIHRoaXMudW5pdFNwYWNlIC0gMjQsXHJcbiAgICAgICAgICAgIGNlbnRlclk6IC0yMCxcclxuICAgICAgICAgICAgZm9udFNpemU6IFRJTUVfRk9OVFxyXG4gICAgICAgIH0pKVxyXG5cclxuICAgICAgICAvL2FkZCBDb29yZFxyXG4gICAgICAgIHRoaXMubm9kZUEuYWRkQ2hpbGQobmV3IFhBeGlzVmlldyhcIngnXCIsIFwieSdcIiwgLTUsIDUsIDAsIDAuNSwgdGhpcy51bml0U3BhY2UpKVxyXG4gICAgICAgIHRoaXMubm9kZUIuYWRkQ2hpbGQobmV3IFhBeGlzVmlldyhcInhcIiwgXCJ5XCIsIC01LCA1LCAwLCAwLjUsIHRoaXMudW5pdFNwYWNlKSlcclxuXHJcbiAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLm5vZGVBKTtcclxuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMubm9kZUIpO1xyXG5cclxuICAgICAgICB0aGlzLmNvbnRyb2xQYW5lbCA9IG5ldyBDb250cm9sUGFuZWxWaWV3KHtcclxuICAgICAgICAgICAgcmlnaHQ6IDIgKiB0aGlzLngwIC0gUmVsYXRpdml0eUNvbnN0YW50cy5TQ1JFRU5fVklFV19YX01BUkdJTiAtIDI1NSxcclxuICAgICAgICAgICAgYm90dG9tOiAyICogdGhpcy55MCAtIFJlbGF0aXZpdHlDb25zdGFudHMuU0NSRUVOX1ZJRVdfWV9NQVJHSU4gLSAxMDQsXHJcbiAgICAgICAgICAgIC8vbWF4V2lkdGg6IDIwMCxcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuY29udHJvbFBhbmVsKVxyXG5cclxuICAgICAgICBsZXQgbG9yZW50elBhbmVsID0gbmV3IExvcmVudHpQYW5lbFZpZXcoe1xyXG4gICAgICAgICAgICByaWdodDogMiAqIHRoaXMueDAgLSBSZWxhdGl2aXR5Q29uc3RhbnRzLlNDUkVFTl9WSUVXX1hfTUFSR0lOIC0gNTgsXHJcbiAgICAgICAgICAgIGJvdHRvbTogMiAqIHRoaXMueTAgLSBSZWxhdGl2aXR5Q29uc3RhbnRzLlNDUkVFTl9WSUVXX1lfTUFSR0lOLFxyXG4gICAgICAgICAgICAvL21heFdpZHRoOiAyMDAsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5hZGRDaGlsZChsb3JlbnR6UGFuZWwpXHJcblxyXG4gICAgICAgIGxldCBoaW50UGFuZWwgPSBuZXcgSGludFBhbmVsVmlldyh7XHJcbiAgICAgICAgICAgIGxlZnQ6IDIwICxcclxuICAgICAgICAgICAgYm90dG9tOiAyICogdGhpcy55MCAtIFJlbGF0aXZpdHlDb25zdGFudHMuU0NSRUVOX1ZJRVdfWV9NQVJHSU4sXHJcbiAgICAgICAgICAgIC8vbWF4V2lkdGg6IDU4MCxcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmFkZENoaWxkKGhpbnRQYW5lbClcclxuXHJcbiAgICAgICAgY29uc3QgcmVzZXRBbGxCdXR0b24gPSBuZXcgUmVzZXRBbGxCdXR0b24oe1xyXG4gICAgICAgICAgICBsaXN0ZW5lcjogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnRlcnJ1cHRTdWJ0cmVlSW5wdXQoKTsgLy8gY2FuY2VsIGludGVyYWN0aW9ucyB0aGF0IG1heSBiZSBpbiBwcm9ncmVzc1xyXG4gICAgICAgICAgICAgICAgbW9kZWwucmVzZXQoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcmlnaHQ6IDIgKiB0aGlzLngwIC0gUmVsYXRpdml0eUNvbnN0YW50cy5TQ1JFRU5fVklFV19YX01BUkdJTixcclxuICAgICAgICAgICAgYm90dG9tOiAyICogdGhpcy55MCAtIFJlbGF0aXZpdHlDb25zdGFudHMuU0NSRUVOX1ZJRVdfWV9NQVJHSU4sXHJcbiAgICAgICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCdyZXNldEFsbEJ1dHRvbicpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5hZGRDaGlsZChyZXNldEFsbEJ1dHRvbik7XHJcblxyXG4gICAgICAgIHRoaXMucmVzZXQoKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVzZXRzIHRoZSB2aWV3LlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICAgICAgLy9UT0RPXHJcbiAgICAgICAgdGhpcy5jb250cm9sUGFuZWwuaXNQbGF5aW5nLnZhbHVlID0gZmFsc2VcclxuICAgICAgICB0aGlzLm1hdEEuc2V0QXJyYXkoWzEsIDAsIDAsIDAsIDEsIDAsIHRoaXMueDAsIHRoaXMueTAgLSB0aGlzLnVuaXRTcGFjZSAqIDIuNSwgMV0pXHJcbiAgICAgICAgdGhpcy5tYXRCLnNldEFycmF5KFsxLCAwLCAwLCAwLCAxLCAwLCB0aGlzLngwLCB0aGlzLnkwIC0gdGhpcy51bml0U3BhY2UgKiAxLjUsIDFdKVxyXG5cclxuICAgICAgICB0aGlzLm5vZGVBLnNldE1hdHJpeCh0aGlzLm1hdEEpXHJcbiAgICAgICAgdGhpcy5ub2RlQi5zZXRNYXRyaXgodGhpcy5tYXRCKVxyXG5cclxuICAgICAgICB0aGlzLmRpc3RhbmNlID0gMFxyXG4gICAgICAgIHRoaXMudFNwYWNlX3NodXR0bGUgPSAwXHJcbiAgICAgICAgdGhpcy50RWFydGggPSAwXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdGVwcyB0aGUgdmlldy5cclxuICAgICAqIEBwYXJhbSBkdCAtIHRpbWUgc3RlcCwgaW4gc2Vjb25kc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb3ZlcnJpZGUgc3RlcChkdDogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgbGV0IG9uZV9vdmVyX2dhbW1hID0gTWF0aC5zcXJ0KDEgLSB0aGlzLmNvbnRyb2xQYW5lbC52ZWxvY2l0eSAqKiAyKVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jb250cm9sUGFuZWwudmVsb2NpdHkgPCAwICYmIHRoaXMucGxhbmVWaWV3LmlzUmlnaHQgfHwgdGhpcy5jb250cm9sUGFuZWwudmVsb2NpdHkgPj0gMCAmJiAhdGhpcy5wbGFuZVZpZXcuaXNSaWdodCkge1xyXG4gICAgICAgICAgICB0aGlzLnBsYW5lVmlldy5mbGlwKClcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY29udHJvbFBhbmVsLmlzUGxheWluZy52YWx1ZSkge1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbFBhbmVsLmFDaGVja2VkLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRTcGFjZV9zaHV0dGxlICs9IG9uZV9vdmVyX2dhbW1hICogZHQgLyAodGhpcy51bml0U3BhY2UgLyB0aGlzLnZTY2FsYSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRFYXJ0aCArPSBkdCAvICh0aGlzLnVuaXRTcGFjZSAvIHRoaXMudlNjYWxhKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzdGFuY2UgKz0gdGhpcy52U2NhbGEgKiBkdCAqIHRoaXMuY29udHJvbFBhbmVsLnZlbG9jaXR5XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRTcGFjZV9zaHV0dGxlICs9IGR0IC8gKHRoaXMudW5pdFNwYWNlIC8gdGhpcy52U2NhbGEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50RWFydGggKz0gZHQgLyAodGhpcy51bml0U3BhY2UgLyB0aGlzLnZTY2FsYSkgLyBvbmVfb3Zlcl9nYW1tYTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzdGFuY2UgKz0gdGhpcy52U2NhbGEgKiBkdCAqIHRoaXMuY29udHJvbFBhbmVsLnZlbG9jaXR5IC8gb25lX292ZXJfZ2FtbWFcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY29udHJvbFBhbmVsLmFDaGVja2VkLnZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWF0QS5zZXQwMChvbmVfb3Zlcl9nYW1tYSlcclxuICAgICAgICAgICAgdGhpcy5tYXRCLnNldDAwKDEpXHJcbiAgICAgICAgICAgIHRoaXMubWF0QS5zZXQwMih0aGlzLngwICsgdGhpcy5kaXN0YW5jZSk7XHJcbiAgICAgICAgICAgIHRoaXMubWF0Qi5zZXQwMih0aGlzLngwKVxyXG4gICAgICAgICAgICB0aGlzLm5vZGVBLnNldE1hdHJpeCh0aGlzLm1hdEEpXHJcbiAgICAgICAgICAgIHRoaXMubm9kZUIuc2V0TWF0cml4KHRoaXMubWF0QilcclxuICAgICAgICAgICAgZm9yKGxldCBpID0wOyBpPHRoaXMudEEubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgbGV0IHR0ID0gdGhpcy50U3BhY2Vfc2h1dHRsZSAtIChpIC0gNSkgKiB0aGlzLmNvbnRyb2xQYW5lbC52ZWxvY2l0eVxyXG4gICAgICAgICAgICAgICAgdGhpcy50QVtpXS5zZXRTdHJpbmcodHQudG9GaXhlZCgzKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRCW2ldLnNldFN0cmluZyh0aGlzLnRFYXJ0aC50b0ZpeGVkKDMpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubWF0QS5zZXQwMCgxKVxyXG4gICAgICAgICAgICB0aGlzLm1hdEIuc2V0MDAob25lX292ZXJfZ2FtbWEpXHJcbiAgICAgICAgICAgIHRoaXMubWF0QS5zZXQwMih0aGlzLngwKTtcclxuICAgICAgICAgICAgdGhpcy5tYXRCLnNldDAyKHRoaXMueDAgLSBvbmVfb3Zlcl9nYW1tYSAqIHRoaXMuZGlzdGFuY2UpXHJcbiAgICAgICAgICAgIHRoaXMubm9kZUEuc2V0TWF0cml4KHRoaXMubWF0QSlcclxuICAgICAgICAgICAgdGhpcy5ub2RlQi5zZXRNYXRyaXgodGhpcy5tYXRCKVxyXG4gICAgICAgICAgICBmb3IobGV0IGkgPTA7IGk8dGhpcy50Qi5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBsZXQgdHQgPSB0aGlzLnRFYXJ0aCArIChpIC0gdGhpcy5kaXN0YW5jZS90aGlzLnVuaXRTcGFjZSAtIDUpICogdGhpcy5jb250cm9sUGFuZWwudmVsb2NpdHlcclxuICAgICAgICAgICAgICAgIHRoaXMudEFbaV0uc2V0U3RyaW5nKHRoaXMudFNwYWNlX3NodXR0bGUudG9GaXhlZCgzKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRCW2ldLnNldFN0cmluZyh0dC50b0ZpeGVkKDMpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNvbnRyb2xQYW5lbC5zcGFjZV9zaHV0dGxlX3RfID0gdGhpcy50U3BhY2Vfc2h1dHRsZVxyXG4gICAgICAgIHRoaXMuY29udHJvbFBhbmVsLnNwYWNlX3NodXR0bGVfdCA9IHRoaXMudEVhcnRoXHJcbiAgICAgICAgdGhpcy5jb250cm9sUGFuZWwuc3BhY2Vfc2h1dHRsZV94ID0gdGhpcy5kaXN0YW5jZSAvIHRoaXMudW5pdFNwYWNlXHJcbiAgICAgICAgdGhpcy5jb250cm9sUGFuZWwuc2V0VGV4dCgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5yZWxhdGl2aXR5LnJlZ2lzdGVyKCdSZWxhdGl2aXR5U2NyZWVuVmlldycsIFJlbGF0aXZpdHlTY3JlZW5WaWV3KTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsVUFBVSxNQUEyQixvQ0FBb0M7QUFDaEYsT0FBT0MsY0FBYyxNQUFNLHVEQUF1RDtBQUNsRixPQUFPQyxtQkFBbUIsTUFBTSxxQ0FBcUM7QUFDckUsT0FBT0MsVUFBVSxNQUFNLHFCQUFxQjtBQUU1QyxPQUFPQyxTQUFTLE1BQU0sdUNBQXVDO0FBQzdELE9BQU9DLFNBQVMsTUFBTSxnQkFBZ0I7QUFDdEMsU0FBUUMsU0FBUyxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBTyxtQ0FBbUM7QUFDdkUsT0FBT0MsU0FBUyxNQUFNLGdCQUFnQjtBQUN0QyxPQUFPQyxnQkFBZ0IsTUFBTSx1QkFBdUI7QUFDcEQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxTQUFTLE1BQU0sZ0JBQWdCO0FBQ3RDLE9BQU9DLGdCQUFnQixNQUFNLG1CQUFtQjtBQUNoRCxPQUFPQyxhQUFhLE1BQU0sb0JBQW9CO0FBUTlDLGVBQWUsTUFBTUMsb0JBQW9CLFNBQVNmLFVBQVUsQ0FBQztFQUdqRGdCLEtBQUss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