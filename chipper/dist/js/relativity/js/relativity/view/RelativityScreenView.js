// Copyright 2023, University of Colorado Boulder

/**
 * TODO Describe this class and its responsibilities.
 *
 * @author Zijian Wang
 */

import ScreenView from '../../../../joist/js/ScreenView.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import RelativityConstants from '../../common/RelativityConstants.js';
import relativity from '../../relativity.js';
import optionize from '../../../../phet-core/js/optionize.js';
import Vector2 from "../../../../dot/js/Vector2.js";
import ModelViewTransform2 from "../../../../phetcommon/js/view/ModelViewTransform2.js";
import PlaneView from "./PlaneView.js";
import { Color, Line, Node, Text } from "../../../../scenery/js/imports.js";
import XAxisView from "./XAxisView.js";
import ControlPanelView from "./ControlPanelView.js";
import Matrix3 from "../../../../dot/js/Matrix3.js";
import MathSymbolFont from "../../../../scenery-phet/js/MathSymbolFont.js";
export default class RelativityScreenView extends ScreenView {
  nodeA = new Node();
  nodeAc = new Node();
  nodeB = new Node(new Vector2(0, 0));
  nodeBc = new Node();
  mat = new Matrix3();
  mat0 = new Matrix3();
  tA = [];
  tB = [];
  tAValue = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
  tBValue = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
  timeScala = 0;
  vScala = 30;
  constructor(model, providedOptions) {
    const options = optionize()({
      //TODO add default values for optional SelfOptions here
      //TODO add default values for optional ScreenViewOptions here
    }, providedOptions);
    super(options);
    //console.log(this.mat0)
    const center = new Vector2(this.layoutBounds.width / 2, this.layoutBounds.height / 2);
    const modelViewTransform = ModelViewTransform2.createOffsetScaleMapping(center, 1);
    const GRAPH_BACKGROUND_COLOR = Color.white;
    const GRAPH_MAJOR_LINE_COLOR = 'rgb( 212, 212, 212 )'; // gray
    const GRAPH_MINOR_LINE_COLOR = 'rgb( 225, 225, 225 )'; // lighter gray
    const MAJOR_GRID_LINE_WIDTH = 1.5; // view units
    const MINOR_GRID_LINE_WIDTH = 0.7; // view units
    const MAJOR_TICK_SPACING = 5; // model units
    const MINOR_TICK_SPACING = 1;
    const SCALE_FACTOR = 15;
    const MIN_X = 20;
    const MIN_Y = 20;
    const WIDTH = 12 * SCALE_FACTOR * MAJOR_TICK_SPACING;
    const HEIGHT = 2 * SCALE_FACTOR * MAJOR_TICK_SPACING;
    this.timeScala = HEIGHT / 2 / 30;
    let COUNT = 0;
    // Vertical lines
    for (let xValue = -WIDTH / 2; xValue <= WIDTH / 2; xValue += MINOR_TICK_SPACING * SCALE_FACTOR) {
      if (COUNT % MAJOR_TICK_SPACING == 0) {
        this.nodeA.addChild(new Line(xValue, -HEIGHT / 2, xValue, HEIGHT / 2, {
          stroke: GRAPH_MAJOR_LINE_COLOR,
          lineWidth: MAJOR_GRID_LINE_WIDTH
        }));
        const t = new Text("0", {
          x: xValue - 15,
          y: -15,
          font: new MathSymbolFont(28)
        });
        this.tA.push(t);
        this.nodeA.addChild(t);
      } else {
        this.nodeA.addChild(new Line(xValue, -HEIGHT / 2, xValue, HEIGHT / 2, {
          stroke: GRAPH_MINOR_LINE_COLOR,
          lineWidth: MINOR_GRID_LINE_WIDTH
        }));
        //console.log(this.nodeA.x)
      }

      COUNT += 1;
    }
    // Horizontal lines
    COUNT = 0;
    for (let yValue = -HEIGHT / 2; yValue <= HEIGHT / 2; yValue += MINOR_TICK_SPACING * SCALE_FACTOR) {
      if (COUNT % MAJOR_TICK_SPACING == 0) {
        this.nodeA.addChild(new Line(-WIDTH / 2, yValue, WIDTH / 2, yValue, {
          stroke: GRAPH_MAJOR_LINE_COLOR,
          lineWidth: MAJOR_GRID_LINE_WIDTH
        }));
      } else {
        this.nodeA.addChild(new Line(-WIDTH / 2, yValue, WIDTH / 2, yValue, {
          stroke: GRAPH_MINOR_LINE_COLOR,
          lineWidth: MINOR_GRID_LINE_WIDTH
        }));
      }
      COUNT += 1;
    }
    this.nodeA.addChild(new XAxisView("x, t (A系)", -WIDTH / 2 - 30, 0, WIDTH / 2 + 30, 0));
    COUNT = 0;
    // Vertical lines
    for (let xValue = -WIDTH / 2; xValue <= WIDTH / 2; xValue += MINOR_TICK_SPACING * SCALE_FACTOR) {
      if (COUNT % MAJOR_TICK_SPACING == 0) {
        this.nodeB.addChild(new Line(xValue, -HEIGHT / 2, xValue, HEIGHT / 2, {
          stroke: GRAPH_MAJOR_LINE_COLOR,
          lineWidth: MAJOR_GRID_LINE_WIDTH
        }));
        const t = new Text("0", {
          x: xValue - 15,
          y: -15,
          font: new MathSymbolFont(28)
        });
        this.tB.push(t);
        this.nodeB.addChild(t);
      } else {
        this.nodeB.addChild(new Line(xValue, -HEIGHT / 2, xValue, HEIGHT / 2, {
          stroke: GRAPH_MINOR_LINE_COLOR,
          lineWidth: MINOR_GRID_LINE_WIDTH
        }));
        //console.log(this.nodeB.x)
      }

      COUNT += 1;
    }
    // Horizontal lines
    COUNT = 0;
    for (let yValue = -HEIGHT / 2; yValue <= HEIGHT / 2; yValue += MINOR_TICK_SPACING * SCALE_FACTOR) {
      if (COUNT % MAJOR_TICK_SPACING == 0) {
        this.nodeB.addChild(new Line(-WIDTH / 2, yValue, WIDTH / 2, yValue, {
          stroke: GRAPH_MAJOR_LINE_COLOR,
          lineWidth: MAJOR_GRID_LINE_WIDTH
        }));
      } else {
        this.nodeB.addChild(new Line(-WIDTH / 2, yValue, WIDTH / 2, yValue, {
          stroke: GRAPH_MINOR_LINE_COLOR,
          lineWidth: MINOR_GRID_LINE_WIDTH
        }));
      }
      COUNT += 1;
    }
    this.nodeB.addChild(new XAxisView("x', t' (B系)", -WIDTH / 2 - 30, 0, WIDTH / 2 + 30, 0));
    this.nodeAc.addChild(this.nodeA);
    this.nodeBc.addChild(this.nodeB);
    this.nodeAc.setX(center.x);
    this.nodeAc.setY(center.y - 1.2 * HEIGHT);
    this.nodeBc.setX(center.x);
    this.nodeBc.setY(center.y);
    this.addChild(this.nodeAc);
    this.addChild(this.nodeBc);
    this.addChild(new PlaneView(new Vector2(0, -80), modelViewTransform));
    this.controlPanel = new ControlPanelView({
      left: RelativityConstants.SCREEN_VIEW_X_MARGIN,
      bottom: this.layoutBounds.maxY - RelativityConstants.SCREEN_VIEW_Y_MARGIN
    });
    this.addChild(this.controlPanel);
    const resetAllButton = new ResetAllButton({
      listener: () => {
        this.interruptSubtreeInput(); // cancel interactions that may be in progress
        model.reset();
        this.reset();
      },
      right: this.layoutBounds.maxX - RelativityConstants.SCREEN_VIEW_X_MARGIN,
      bottom: this.layoutBounds.maxY - RelativityConstants.SCREEN_VIEW_Y_MARGIN,
      tandem: options.tandem.createTandem('resetAllButton')
    });
    this.addChild(resetAllButton);
  }

  /**
   * Resets the view.
   */
  reset() {
    //TODO
  }

  /**
   * Steps the view.
   * @param dt - time step, in seconds
   */
  step(dt) {
    //TODO
    //console.log(this.nodeB.x,",",this.nodeB.y);
    if (this.controlPanel.isPlaying) {
      if (this.controlPanel.aChecked) {
        this.nodeBc.x += this.vScala * dt * this.controlPanel.velocity;
      } else {
        this.nodeAc.x += -this.vScala * dt * this.controlPanel.velocity;
      }
      for (let i in this.tAValue) {
        this.tAValue[i] += dt / this.timeScala;
      }
      for (let i in this.tBValue) {
        this.tBValue[i] += dt / this.timeScala;
      }
    }
    if (this.controlPanel.aChecked) {
      let scaleX = Math.sqrt(1 - this.controlPanel.velocity ** 2);
      this.mat.setArray([scaleX, 0, 0, 0, 1, 0, 0, 0, 1]);
      this.nodeA.setMatrix(this.mat0);
      this.nodeB.setMatrix(this.mat);
      for (let i in this.tA) {
        this.tA[i].setString(this.tAValue[i].toFixed(2));
      }
      for (let i in this.tB) {
        let tt = this.tAValue[i] * Math.sqrt(1 - this.controlPanel.velocity ** 2) + (i - 6) * this.controlPanel.velocity / this.vScala;
        this.tB[i].setString(tt.toFixed(2));
      }
    } else {
      let scaleX = Math.sqrt(1 - this.controlPanel.velocity ** 2);
      this.mat.setArray([scaleX, 0, 0, 0, 1, 0, 0, 0, 1]);
      this.nodeB.setMatrix(this.mat0);
      this.nodeA.setMatrix(this.mat);
      for (let i in this.tA) {
        let tt = this.tBValue[i] * Math.sqrt(1 - this.controlPanel.velocity ** 2) - (i - 6) * this.controlPanel.velocity / this.vScala;
        this.tA[i].setString(tt.toFixed(2));
      }
      for (let i in this.tB) {
        this.tB[i].setString(this.tBValue[i].toFixed(2));
      }
    }
  }
}
relativity.register('RelativityScreenView', RelativityScreenView);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTY3JlZW5WaWV3IiwiUmVzZXRBbGxCdXR0b24iLCJSZWxhdGl2aXR5Q29uc3RhbnRzIiwicmVsYXRpdml0eSIsIm9wdGlvbml6ZSIsIlZlY3RvcjIiLCJNb2RlbFZpZXdUcmFuc2Zvcm0yIiwiUGxhbmVWaWV3IiwiQ29sb3IiLCJMaW5lIiwiTm9kZSIsIlRleHQiLCJYQXhpc1ZpZXciLCJDb250cm9sUGFuZWxWaWV3IiwiTWF0cml4MyIsIk1hdGhTeW1ib2xGb250IiwiUmVsYXRpdml0eVNjcmVlblZpZXciLCJub2RlQSIsIm5vZGVBYyIsIm5vZGVCIiwibm9kZUJjIiwibWF0IiwibWF0MCIsInRBIiwidEIiLCJ0QVZhbHVlIiwidEJWYWx1ZSIsInRpbWVTY2FsYSIsInZTY2FsYSIsImNvbnN0cnVjdG9yIiwibW9kZWwiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiY2VudGVyIiwibGF5b3V0Qm91bmRzIiwid2lkdGgiLCJoZWlnaHQiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJjcmVhdGVPZmZzZXRTY2FsZU1hcHBpbmciLCJHUkFQSF9CQUNLR1JPVU5EX0NPTE9SIiwid2hpdGUiLCJHUkFQSF9NQUpPUl9MSU5FX0NPTE9SIiwiR1JBUEhfTUlOT1JfTElORV9DT0xPUiIsIk1BSk9SX0dSSURfTElORV9XSURUSCIsIk1JTk9SX0dSSURfTElORV9XSURUSCIsIk1BSk9SX1RJQ0tfU1BBQ0lORyIsIk1JTk9SX1RJQ0tfU1BBQ0lORyIsIlNDQUxFX0ZBQ1RPUiIsIk1JTl9YIiwiTUlOX1kiLCJXSURUSCIsIkhFSUdIVCIsIkNPVU5UIiwieFZhbHVlIiwiYWRkQ2hpbGQiLCJzdHJva2UiLCJsaW5lV2lkdGgiLCJ0IiwieCIsInkiLCJmb250IiwicHVzaCIsInlWYWx1ZSIsInNldFgiLCJzZXRZIiwiY29udHJvbFBhbmVsIiwibGVmdCIsIlNDUkVFTl9WSUVXX1hfTUFSR0lOIiwiYm90dG9tIiwibWF4WSIsIlNDUkVFTl9WSUVXX1lfTUFSR0lOIiwicmVzZXRBbGxCdXR0b24iLCJsaXN0ZW5lciIsImludGVycnVwdFN1YnRyZWVJbnB1dCIsInJlc2V0IiwicmlnaHQiLCJtYXhYIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwic3RlcCIsImR0IiwiaXNQbGF5aW5nIiwiYUNoZWNrZWQiLCJ2ZWxvY2l0eSIsImkiLCJzY2FsZVgiLCJNYXRoIiwic3FydCIsInNldEFycmF5Iiwic2V0TWF0cml4Iiwic2V0U3RyaW5nIiwidG9GaXhlZCIsInR0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJSZWxhdGl2aXR5U2NyZWVuVmlldy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVE9ETyBEZXNjcmliZSB0aGlzIGNsYXNzIGFuZCBpdHMgcmVzcG9uc2liaWxpdGllcy5cclxuICpcclxuICogQGF1dGhvciBaaWppYW4gV2FuZ1xyXG4gKi9cclxuXHJcbmltcG9ydCBTY3JlZW5WaWV3LCB7IFNjcmVlblZpZXdPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vam9pc3QvanMvU2NyZWVuVmlldy5qcyc7XHJcbmltcG9ydCBSZXNldEFsbEJ1dHRvbiBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvYnV0dG9ucy9SZXNldEFsbEJ1dHRvbi5qcyc7XHJcbmltcG9ydCBSZWxhdGl2aXR5Q29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9SZWxhdGl2aXR5Q29uc3RhbnRzLmpzJztcclxuaW1wb3J0IHJlbGF0aXZpdHkgZnJvbSAnLi4vLi4vcmVsYXRpdml0eS5qcyc7XHJcbmltcG9ydCBSZWxhdGl2aXR5TW9kZWwgZnJvbSAnLi4vbW9kZWwvUmVsYXRpdml0eU1vZGVsLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSBcIi4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzXCI7XHJcbmltcG9ydCBNb2RlbFZpZXdUcmFuc2Zvcm0yIGZyb20gXCIuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qc1wiO1xyXG5pbXBvcnQgUGxhbmVWaWV3IGZyb20gXCIuL1BsYW5lVmlldy5qc1wiO1xyXG5pbXBvcnQge1JlY3RhbmdsZSwgQ29sb3IsIExpbmUsIFBhdGgsIE5vZGUsIFRleHR9IGZyb20gXCIuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanNcIjtcclxuaW1wb3J0IFhBeGlzVmlldyBmcm9tIFwiLi9YQXhpc1ZpZXcuanNcIjtcclxuaW1wb3J0IENvbnRyb2xQYW5lbFZpZXcgZnJvbSBcIi4vQ29udHJvbFBhbmVsVmlldy5qc1wiO1xyXG5pbXBvcnQgUGFuZWwgZnJvbSBcIi4uLy4uLy4uLy4uL3N1bi9qcy9QYW5lbC5qc1wiO1xyXG5pbXBvcnQgTWF0cml4MyBmcm9tIFwiLi4vLi4vLi4vLi4vZG90L2pzL01hdHJpeDMuanNcIjtcclxuaW1wb3J0IE1hdGhTeW1ib2xGb250IGZyb20gXCIuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvTWF0aFN5bWJvbEZvbnQuanNcIjtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAvL1RPRE8gYWRkIG9wdGlvbnMgdGhhdCBhcmUgc3BlY2lmaWMgdG8gUmVsYXRpdml0eVNjcmVlblZpZXcgaGVyZVxyXG59O1xyXG5cclxudHlwZSBSZWxhdGl2aXR5U2NyZWVuVmlld09wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFNjcmVlblZpZXdPcHRpb25zO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVsYXRpdml0eVNjcmVlblZpZXcgZXh0ZW5kcyBTY3JlZW5WaWV3IHtcclxuICBwcml2YXRlIGNvbnRyb2xQYW5lbDogQ29udHJvbFBhbmVsVmlldztcclxuICBwcml2YXRlIG5vZGVBOiBOb2RlID0gbmV3IE5vZGUoKTtcclxuICBwcml2YXRlIG5vZGVBYyA6IE5vZGUgPSBuZXcgTm9kZSgpO1xyXG4gIHByaXZhdGUgbm9kZUI6IE5vZGUgPSBuZXcgTm9kZShuZXcgVmVjdG9yMigwLDApKTtcclxuICBwcml2YXRlIG5vZGVCYyA6IE5vZGUgPSBuZXcgTm9kZSgpO1xyXG4gIHByaXZhdGUgbWF0ID0gbmV3IE1hdHJpeDMoKTtcclxuICBwcml2YXRlIG1hdDAgID0gbmV3IE1hdHJpeDMoKTtcclxuICBwcml2YXRlIHRBOiBUZXh0W10gPSBbXTtcclxuICBwcml2YXRlIHRCOiBUZXh0W10gPSBbXTtcclxuICBwcml2YXRlIHRBVmFsdWUgPSBbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMF07XHJcbiAgcHJpdmF0ZSB0QlZhbHVlID0gWzAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDBdO1xyXG4gIHByaXZhdGUgdGltZVNjYWxhID0gMDtcclxuICBwcml2YXRlIHZTY2FsYT0gMzA7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbW9kZWw6IFJlbGF0aXZpdHlNb2RlbCwgcHJvdmlkZWRPcHRpb25zOiBSZWxhdGl2aXR5U2NyZWVuVmlld09wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxSZWxhdGl2aXR5U2NyZWVuVmlld09wdGlvbnMsIFNlbGZPcHRpb25zLCBTY3JlZW5WaWV3T3B0aW9ucz4oKSgge1xyXG4gICAgICAvL1RPRE8gYWRkIGRlZmF1bHQgdmFsdWVzIGZvciBvcHRpb25hbCBTZWxmT3B0aW9ucyBoZXJlXHJcbiAgICAgIC8vVE9ETyBhZGQgZGVmYXVsdCB2YWx1ZXMgZm9yIG9wdGlvbmFsIFNjcmVlblZpZXdPcHRpb25zIGhlcmVcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcbiAgICAvL2NvbnNvbGUubG9nKHRoaXMubWF0MClcclxuICAgIGNvbnN0IGNlbnRlciA9IG5ldyBWZWN0b3IyKCB0aGlzLmxheW91dEJvdW5kcy53aWR0aC8gMiwgdGhpcy5sYXlvdXRCb3VuZHMuaGVpZ2h0IC8gMiApO1xyXG5cclxuICAgIGNvbnN0IG1vZGVsVmlld1RyYW5zZm9ybSA9IE1vZGVsVmlld1RyYW5zZm9ybTIuY3JlYXRlT2Zmc2V0U2NhbGVNYXBwaW5nKCBjZW50ZXIsIDEgKTtcclxuXHJcbiAgICBjb25zdCBHUkFQSF9CQUNLR1JPVU5EX0NPTE9SID0gQ29sb3Iud2hpdGU7XHJcbiAgICBjb25zdCBHUkFQSF9NQUpPUl9MSU5FX0NPTE9SID0gJ3JnYiggMjEyLCAyMTIsIDIxMiApJzsgLy8gZ3JheVxyXG4gICAgY29uc3QgR1JBUEhfTUlOT1JfTElORV9DT0xPUiA9ICdyZ2IoIDIyNSwgMjI1LCAyMjUgKSc7IC8vIGxpZ2h0ZXIgZ3JheVxyXG4gICAgY29uc3QgTUFKT1JfR1JJRF9MSU5FX1dJRFRIID0gMS41OyAvLyB2aWV3IHVuaXRzXHJcbiAgICBjb25zdCBNSU5PUl9HUklEX0xJTkVfV0lEVEggPSAwLjc7IC8vIHZpZXcgdW5pdHNcclxuICAgIGNvbnN0IE1BSk9SX1RJQ0tfU1BBQ0lORyA9IDU7IC8vIG1vZGVsIHVuaXRzXHJcbiAgICBjb25zdCBNSU5PUl9USUNLX1NQQUNJTkcgPSAxO1xyXG4gICAgY29uc3QgU0NBTEVfRkFDVE9SID0gMTU7XHJcbiAgICBjb25zdCBNSU5fWCA9IDIwO1xyXG4gICAgY29uc3QgTUlOX1kgPSAyMDtcclxuICAgIGNvbnN0IFdJRFRIID0gMTIgKiBTQ0FMRV9GQUNUT1IgKiBNQUpPUl9USUNLX1NQQUNJTkc7XHJcbiAgICBjb25zdCBIRUlHSFQgPSAyICogU0NBTEVfRkFDVE9SICogTUFKT1JfVElDS19TUEFDSU5HO1xyXG4gICAgdGhpcy50aW1lU2NhbGEgPSBIRUlHSFQvMi8zMDtcclxuXHJcbiAgICBsZXQgQ09VTlQgPSAwO1xyXG4gICAgLy8gVmVydGljYWwgbGluZXNcclxuICAgIGZvciAobGV0IHhWYWx1ZSA9IC1XSURUSC8yOyB4VmFsdWUgPD0gV0lEVEgvMiA7IHhWYWx1ZSArPSBNSU5PUl9USUNLX1NQQUNJTkcgKiBTQ0FMRV9GQUNUT1IpIHtcclxuICAgICAgaWYoQ09VTlQgJSBNQUpPUl9USUNLX1NQQUNJTkc9PTAgKXtcclxuICAgICAgICB0aGlzLm5vZGVBLmFkZENoaWxkKG5ldyBMaW5lKHhWYWx1ZSwgLUhFSUdIVC8yLCB4VmFsdWUsSEVJR0hULzIsIHtcclxuICAgICAgICAgIHN0cm9rZTogR1JBUEhfTUFKT1JfTElORV9DT0xPUiwgbGluZVdpZHRoOiBNQUpPUl9HUklEX0xJTkVfV0lEVEgsXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIGNvbnN0IHQgPSBuZXcgVGV4dChcIjBcIix7eDp4VmFsdWUtMTUseTotMTUsZm9udDogbmV3IE1hdGhTeW1ib2xGb250KCAyOCApLH0pO1xyXG4gICAgICAgIHRoaXMudEEucHVzaCh0KTtcclxuICAgICAgICB0aGlzLm5vZGVBLmFkZENoaWxkKHQpXHJcbiAgICAgIH1lbHNlIHtcclxuICAgICAgICB0aGlzLm5vZGVBLmFkZENoaWxkKG5ldyBMaW5lKHhWYWx1ZSwgLUhFSUdIVC8yLCB4VmFsdWUsSEVJR0hULzIsIHtcclxuICAgICAgICAgIHN0cm9rZTogR1JBUEhfTUlOT1JfTElORV9DT0xPUiwgbGluZVdpZHRoOiBNSU5PUl9HUklEX0xJTkVfV0lEVEgsXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIC8vY29uc29sZS5sb2codGhpcy5ub2RlQS54KVxyXG4gICAgICB9XHJcbiAgICAgIENPVU5UICs9IDE7XHJcbiAgICB9XHJcbiAgICAvLyBIb3Jpem9udGFsIGxpbmVzXHJcbiAgICBDT1VOVCA9IDA7XHJcbiAgICBmb3IgKGxldCB5VmFsdWUgPSAtSEVJR0hULzI7IHlWYWx1ZSA8PSBIRUlHSFQvMjsgeVZhbHVlICs9ICBNSU5PUl9USUNLX1NQQUNJTkcgKiBTQ0FMRV9GQUNUT1IpIHtcclxuICAgICAgaWYoQ09VTlQlTUFKT1JfVElDS19TUEFDSU5HPT0wKXtcclxuICAgICAgICB0aGlzLm5vZGVBLmFkZENoaWxkKG5ldyBMaW5lKC1XSURUSC8yLCB5VmFsdWUsIFdJRFRILzIseVZhbHVlLCB7XHJcbiAgICAgICAgICBzdHJva2U6IEdSQVBIX01BSk9SX0xJTkVfQ09MT1IsIGxpbmVXaWR0aDogTUFKT1JfR1JJRF9MSU5FX1dJRFRILFxyXG4gICAgICAgIH0pKTtcclxuICAgICAgfWVsc2Uge1xyXG4gICAgICAgIHRoaXMubm9kZUEuYWRkQ2hpbGQobmV3IExpbmUoLVdJRFRILzIsIHlWYWx1ZSwgV0lEVEgvMix5VmFsdWUsIHtcclxuICAgICAgICAgIHN0cm9rZTogR1JBUEhfTUlOT1JfTElORV9DT0xPUiwgbGluZVdpZHRoOiBNSU5PUl9HUklEX0xJTkVfV0lEVEgsXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICB9XHJcbiAgICAgIENPVU5UICs9IDE7XHJcbiAgICB9XHJcbiAgICB0aGlzLm5vZGVBLmFkZENoaWxkKG5ldyBYQXhpc1ZpZXcoXCJ4LCB0IChB57O7KVwiLC1XSURUSC8yLTMwLDAsV0lEVEgvMiszMCwwKSlcclxuXHJcblxyXG4gICAgQ09VTlQgPSAwO1xyXG4gICAgLy8gVmVydGljYWwgbGluZXNcclxuICAgIGZvciAobGV0IHhWYWx1ZSA9IC1XSURUSC8yOyB4VmFsdWUgPD0gV0lEVEgvMiA7IHhWYWx1ZSArPSBNSU5PUl9USUNLX1NQQUNJTkcgKiBTQ0FMRV9GQUNUT1IpIHtcclxuICAgICAgaWYoQ09VTlQgJSBNQUpPUl9USUNLX1NQQUNJTkc9PTAgKXtcclxuICAgICAgICB0aGlzLm5vZGVCLmFkZENoaWxkKG5ldyBMaW5lKHhWYWx1ZSwgLUhFSUdIVC8yLCB4VmFsdWUsSEVJR0hULzIsIHtcclxuICAgICAgICAgIHN0cm9rZTogR1JBUEhfTUFKT1JfTElORV9DT0xPUiwgbGluZVdpZHRoOiBNQUpPUl9HUklEX0xJTkVfV0lEVEgsXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIGNvbnN0IHQgPSBuZXcgVGV4dChcIjBcIix7eDp4VmFsdWUtMTUseTotMTUsZm9udDogbmV3IE1hdGhTeW1ib2xGb250KCAyOCApLH0pO1xyXG4gICAgICAgIHRoaXMudEIucHVzaCh0KVxyXG4gICAgICAgIHRoaXMubm9kZUIuYWRkQ2hpbGQodClcclxuICAgICAgfWVsc2Uge1xyXG4gICAgICAgIHRoaXMubm9kZUIuYWRkQ2hpbGQobmV3IExpbmUoeFZhbHVlLCAtSEVJR0hULzIsIHhWYWx1ZSxIRUlHSFQvMiwge1xyXG4gICAgICAgICAgc3Ryb2tlOiBHUkFQSF9NSU5PUl9MSU5FX0NPTE9SLCBsaW5lV2lkdGg6IE1JTk9SX0dSSURfTElORV9XSURUSCxcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLm5vZGVCLngpXHJcbiAgICAgIH1cclxuICAgICAgQ09VTlQgKz0gMTtcclxuICAgIH1cclxuICAgIC8vIEhvcml6b250YWwgbGluZXNcclxuICAgIENPVU5UID0gMDtcclxuICAgIGZvciAobGV0IHlWYWx1ZSA9IC1IRUlHSFQvMjsgeVZhbHVlIDw9IEhFSUdIVC8yOyB5VmFsdWUgKz0gIE1JTk9SX1RJQ0tfU1BBQ0lORyAqIFNDQUxFX0ZBQ1RPUikge1xyXG4gICAgICBpZihDT1VOVCVNQUpPUl9USUNLX1NQQUNJTkc9PTApe1xyXG4gICAgICAgIHRoaXMubm9kZUIuYWRkQ2hpbGQobmV3IExpbmUoLVdJRFRILzIsIHlWYWx1ZSwgV0lEVEgvMix5VmFsdWUsIHtcclxuICAgICAgICAgIHN0cm9rZTogR1JBUEhfTUFKT1JfTElORV9DT0xPUiwgbGluZVdpZHRoOiBNQUpPUl9HUklEX0xJTkVfV0lEVEgsXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICB9ZWxzZSB7XHJcbiAgICAgICAgdGhpcy5ub2RlQi5hZGRDaGlsZChuZXcgTGluZSgtV0lEVEgvMiwgeVZhbHVlLCBXSURUSC8yLHlWYWx1ZSwge1xyXG4gICAgICAgICAgc3Ryb2tlOiBHUkFQSF9NSU5PUl9MSU5FX0NPTE9SLCBsaW5lV2lkdGg6IE1JTk9SX0dSSURfTElORV9XSURUSCxcclxuICAgICAgICB9KSk7XHJcbiAgICAgIH1cclxuICAgICAgQ09VTlQgKz0gMTtcclxuICAgIH1cclxuICAgIHRoaXMubm9kZUIuYWRkQ2hpbGQobmV3IFhBeGlzVmlldyhcIngnLCB0JyAoQuezuylcIiwtV0lEVEgvMi0zMCwwLFdJRFRILzIrMzAsMCkpXHJcblxyXG5cclxuICAgIHRoaXMubm9kZUFjLmFkZENoaWxkKHRoaXMubm9kZUEpXHJcbiAgICB0aGlzLm5vZGVCYy5hZGRDaGlsZCh0aGlzLm5vZGVCKVxyXG5cclxuICAgIHRoaXMubm9kZUFjLnNldFgoY2VudGVyLngpO1xyXG4gICAgdGhpcy5ub2RlQWMuc2V0WShjZW50ZXIueS0xLjIqSEVJR0hUKTtcclxuICAgIHRoaXMubm9kZUJjLnNldFgoY2VudGVyLngpXHJcbiAgICB0aGlzLm5vZGVCYy5zZXRZKGNlbnRlci55KVxyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5ub2RlQWMpO1xyXG4gICAgdGhpcy5hZGRDaGlsZCh0aGlzLm5vZGVCYyk7XHJcblxyXG4gICAgdGhpcy5hZGRDaGlsZChuZXcgUGxhbmVWaWV3KG5ldyBWZWN0b3IyKDAsLTgwKSwgbW9kZWxWaWV3VHJhbnNmb3JtKSk7XHJcblxyXG4gICAgdGhpcy5jb250cm9sUGFuZWwgPSBuZXcgQ29udHJvbFBhbmVsVmlldygge1xyXG4gICAgICAgICAgbGVmdDogUmVsYXRpdml0eUNvbnN0YW50cy5TQ1JFRU5fVklFV19YX01BUkdJTixcclxuICAgICAgICAgIGJvdHRvbTogdGhpcy5sYXlvdXRCb3VuZHMubWF4WSAtIFJlbGF0aXZpdHlDb25zdGFudHMuU0NSRUVOX1ZJRVdfWV9NQVJHSU4sXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKHRoaXMuY29udHJvbFBhbmVsKTtcclxuXHJcbiAgICBjb25zdCByZXNldEFsbEJ1dHRvbiA9IG5ldyBSZXNldEFsbEJ1dHRvbigge1xyXG4gICAgICBsaXN0ZW5lcjogKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuaW50ZXJydXB0U3VidHJlZUlucHV0KCk7IC8vIGNhbmNlbCBpbnRlcmFjdGlvbnMgdGhhdCBtYXkgYmUgaW4gcHJvZ3Jlc3NcclxuICAgICAgICBtb2RlbC5yZXNldCgpO1xyXG4gICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgfSxcclxuICAgICAgcmlnaHQ6IHRoaXMubGF5b3V0Qm91bmRzLm1heFggLSBSZWxhdGl2aXR5Q29uc3RhbnRzLlNDUkVFTl9WSUVXX1hfTUFSR0lOLFxyXG4gICAgICBib3R0b206IHRoaXMubGF5b3V0Qm91bmRzLm1heFkgLSBSZWxhdGl2aXR5Q29uc3RhbnRzLlNDUkVFTl9WSUVXX1lfTUFSR0lOLFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Jlc2V0QWxsQnV0dG9uJyApXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCByZXNldEFsbEJ1dHRvbiApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXRzIHRoZSB2aWV3LlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuICAgIC8vVE9ET1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RlcHMgdGhlIHZpZXcuXHJcbiAgICogQHBhcmFtIGR0IC0gdGltZSBzdGVwLCBpbiBzZWNvbmRzXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIHN0ZXAoIGR0OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICAvL1RPRE9cclxuICAgIC8vY29uc29sZS5sb2codGhpcy5ub2RlQi54LFwiLFwiLHRoaXMubm9kZUIueSk7XHJcbiAgICBpZih0aGlzLmNvbnRyb2xQYW5lbC5pc1BsYXlpbmcpe1xyXG4gICAgICBpZih0aGlzLmNvbnRyb2xQYW5lbC5hQ2hlY2tlZCl7XHJcbiAgICAgICAgdGhpcy5ub2RlQmMueCArPSB0aGlzLnZTY2FsYSogZHQgKiB0aGlzLmNvbnRyb2xQYW5lbC52ZWxvY2l0eTtcclxuICAgICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5ub2RlQWMueCArPSAtIHRoaXMudlNjYWxhKiBkdCAqIHRoaXMuY29udHJvbFBhbmVsLnZlbG9jaXR5O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBmb3IgKGxldCBpIGluIHRoaXMudEFWYWx1ZSkge1xyXG4gICAgICAgIHRoaXMudEFWYWx1ZVtpXSArPSBkdC90aGlzLnRpbWVTY2FsYTtcclxuICAgICAgfVxyXG4gICAgICBmb3IgKGxldCBpIGluIHRoaXMudEJWYWx1ZSkge1xyXG4gICAgICAgIHRoaXMudEJWYWx1ZVtpXSArPSBkdC90aGlzLnRpbWVTY2FsYTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmKHRoaXMuY29udHJvbFBhbmVsLmFDaGVja2VkKXtcclxuICAgICAgbGV0IHNjYWxlWCA9IE1hdGguc3FydCgxLXRoaXMuY29udHJvbFBhbmVsLnZlbG9jaXR5ICoqIDIpO1xyXG4gICAgICB0aGlzLm1hdC5zZXRBcnJheShbc2NhbGVYLDAsMCwwLDEsMCwwLDAsMV0pO1xyXG4gICAgICB0aGlzLm5vZGVBLnNldE1hdHJpeCh0aGlzLm1hdDApXHJcbiAgICAgIHRoaXMubm9kZUIuc2V0TWF0cml4KHRoaXMubWF0KTtcclxuXHJcbiAgICAgIGZvciAobGV0IGkgaW4gdGhpcy50QSkge1xyXG4gICAgICAgIHRoaXMudEFbaV0uc2V0U3RyaW5nKHRoaXMudEFWYWx1ZVtpXS50b0ZpeGVkKDIpKTtcclxuICAgICAgfVxyXG4gICAgICBmb3IgKGxldCBpIGluIHRoaXMudEIpIHtcclxuICAgICAgICBsZXQgdHQgPSB0aGlzLnRBVmFsdWVbaV0qTWF0aC5zcXJ0KDEtdGhpcy5jb250cm9sUGFuZWwudmVsb2NpdHkgKiogMikrKGktNikqdGhpcy5jb250cm9sUGFuZWwudmVsb2NpdHkvdGhpcy52U2NhbGFcclxuICAgICAgICB0aGlzLnRCW2ldLnNldFN0cmluZyh0dC50b0ZpeGVkKDIpKTtcclxuICAgICAgfVxyXG4gICAgfWVsc2Uge1xyXG4gICAgICBsZXQgc2NhbGVYID0gTWF0aC5zcXJ0KDEtdGhpcy5jb250cm9sUGFuZWwudmVsb2NpdHkgKiogMik7XHJcbiAgICAgIHRoaXMubWF0LnNldEFycmF5KFtzY2FsZVgsMCwwLDAsMSwwLDAsMCwxXSk7XHJcbiAgICAgIHRoaXMubm9kZUIuc2V0TWF0cml4KHRoaXMubWF0MClcclxuICAgICAgdGhpcy5ub2RlQS5zZXRNYXRyaXgodGhpcy5tYXQpO1xyXG5cclxuICAgICAgZm9yIChsZXQgaSBpbiB0aGlzLnRBKSB7XHJcbiAgICAgICAgbGV0IHR0ID0gdGhpcy50QlZhbHVlW2ldKk1hdGguc3FydCgxLXRoaXMuY29udHJvbFBhbmVsLnZlbG9jaXR5ICoqIDIpLShpLTYpKnRoaXMuY29udHJvbFBhbmVsLnZlbG9jaXR5L3RoaXMudlNjYWxhXHJcbiAgICAgICAgdGhpcy50QVtpXS5zZXRTdHJpbmcodHQudG9GaXhlZCgyKSk7XHJcbiAgICAgIH1cclxuICAgICAgZm9yIChsZXQgaSBpbiB0aGlzLnRCKSB7XHJcbiAgICAgICAgdGhpcy50QltpXS5zZXRTdHJpbmcodGhpcy50QlZhbHVlW2ldLnRvRml4ZWQoMikpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5yZWxhdGl2aXR5LnJlZ2lzdGVyKCAnUmVsYXRpdml0eVNjcmVlblZpZXcnLCBSZWxhdGl2aXR5U2NyZWVuVmlldyApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxVQUFVLE1BQTZCLG9DQUFvQztBQUNsRixPQUFPQyxjQUFjLE1BQU0sdURBQXVEO0FBQ2xGLE9BQU9DLG1CQUFtQixNQUFNLHFDQUFxQztBQUNyRSxPQUFPQyxVQUFVLE1BQU0scUJBQXFCO0FBRTVDLE9BQU9DLFNBQVMsTUFBTSx1Q0FBdUM7QUFDN0QsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxtQkFBbUIsTUFBTSx1REFBdUQ7QUFDdkYsT0FBT0MsU0FBUyxNQUFNLGdCQUFnQjtBQUN0QyxTQUFtQkMsS0FBSyxFQUFF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