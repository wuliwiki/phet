// Copyright 2022, University of Colorado Boulder
/**
 * Renders the main area of the lattice (doesn't include the damping regions) using 2d canvas.
 * Allows for wall reflection and an extra source. Also can dampen the waves to be within a certain area.
 *
 * @author Piet Goris (University of Leuven)
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { CanvasNode, Color } from '../../../../scenery/js/imports.js';
import ImageDataRenderer from '../../../../scenery-phet/js/ImageDataRenderer.js';
import SoundConstants from '../../common/SoundConstants.js';
import sound from '../../sound.js';
import optionize from '../../../../phet-core/js/optionize.js';

// constants
const CUTOFF = 0.4;
export default class LatticeCanvasNode extends CanvasNode {
  // settable, if defined shows unvisited lattice cells as specified color, used for light

  // For performance, render into a sub-canvas which will be drawn into the rendering context at the right scale

  constructor(lattice, providedOptions) {
    const options = optionize()({
      // only use the visible part for the bounds (not the damping regions)
      canvasBounds: SoundConstants.getCanvasBounds(lattice),
      layerSplit: true,
      // ensure we're on our own layer
      baseColor: Color.blue,
      hasReflection: false,
      sourcePosition: new Vector2(0, 0),
      hasSecondSource: false,
      source2PositionY: 0,
      wallAngle: Math.PI / 4
    }, providedOptions);
    super(options);
    this.hasSecondSource = options.hasSecondSource;
    this.source2PositionY = options.source2PositionY;
    this.sourcePosition = options.sourcePosition;
    this.hasReflection = options.hasReflection;
    this.lattice = lattice;
    this.wallPositionX = this.lattice.width / 2;
    this.wallAngle = options.wallAngle;
    this.baseColor = options.baseColor;
    this.vacuumColor = null;
    this.imageDataRenderer = new ImageDataRenderer(lattice.visibleBounds.width, lattice.visibleBounds.height);

    // Invalidate paint when model indicates changes
    lattice.changedEmitter.addListener(this.invalidatePaint.bind(this));
  }

  /**
   * Convert the given point in the local coordinate frame to the corresponding i,j (integral) lattice coordinates.
   * @param point - point in the local coordinate frame
   */
  static localPointToLatticePoint(point) {
    return new Vector2(Utils.roundSymmetric(point.x / SoundConstants.CELL_WIDTH), Utils.roundSymmetric(point.y / SoundConstants.CELL_WIDTH));
  }

  /**
   * Sets the x coordinate of the reflection wall
   */
  setWallPositionX(x) {
    this.wallPositionX = x;
  }

  /**
   * Sets the angle of the reflection wall
   */
  setWallAngle(angle) {
    this.wallAngle = angle;
  }

  /**
   * Sets the color of the peaks of the wave.
   */
  setBaseColor(color) {
    this.baseColor = color;
    this.invalidatePaint();
  }

  /**
   * Gets dampened lattice value
   */
  getDampenedValue(x, y) {
    const distance = this.sourcePosition.distanceXY(x, y);
    const distanceDampen = distance >= 0 && distance <= SoundConstants.MAX_SOUND_DISTANCE ? (SoundConstants.MAX_SOUND_DISTANCE - distance) / SoundConstants.MAX_SOUND_DISTANCE : 0;
    return this.lattice.getInterpolatedValue(x, y) * distanceDampen;
  }

  /**
   * Draws into the canvas.
   */
  paintCanvas(context) {
    let m = 0;
    const data = this.imageDataRenderer.data;
    const dampX = this.lattice.dampX;
    const dampY = this.lattice.dampY;
    const width = this.lattice.width;
    const height = this.lattice.height;
    let intensity;
    for (let i = dampX; i < width - dampX; i++) {
      for (let k = dampY; k < height - dampY; k++) {
        // Note this is transposed because of the ordering of putImageData

        let addition = 0;
        let zeroOut = 1;
        if (this.hasReflection) {
          if (k >= this.sourcePosition.x && k < Utils.roundSymmetric(this.wallPositionX) - (i - height + dampY) / Math.tan(this.wallAngle)) {
            const originalPos = new Vector2(k, i);
            const wallVector = Vector2.createPolar(1, -this.wallAngle);
            const wallOrigin = new Vector2(this.wallPositionX, height - dampY);
            const mirroredPosition = wallVector.withMagnitude(originalPos.copy().minus(wallOrigin).dot(wallVector)).plus(wallOrigin);
            const perp = mirroredPosition.minus(originalPos).times(2);
            const final = originalPos.plus(perp);
            const finalX = Utils.roundSymmetric(final.x);
            const finalY = Utils.roundSymmetric(final.y);
            addition = this.getDampenedValue(finalX, finalY);
          } else {
            zeroOut = 0;
          }
        }
        if (this.hasSecondSource) {
          addition = this.getDampenedValue(k, Utils.roundSymmetric(i + this.sourcePosition.y - this.source2PositionY));
        }
        const waveValue = (this.getDampenedValue(k, i) + addition) * zeroOut;
        if (waveValue > 0) {
          intensity = Utils.linear(0, 2, CUTOFF, 1, waveValue);
          intensity = Utils.clamp(intensity, CUTOFF, 1);
        } else {
          const MIN_SHADE = 0.03; // Stop before 0 because 0 is too jarring
          intensity = Utils.linear(-1.5, 0, MIN_SHADE, CUTOFF, waveValue);
          intensity = Utils.clamp(intensity, MIN_SHADE, CUTOFF);
        }

        // Note this interpolation doesn't include the gamma factor that Color.blend does
        let r = this.baseColor.red * intensity;
        let g = this.baseColor.green * intensity;
        let b = this.baseColor.blue * intensity;

        // Note this is transposed because of the ordering of putImageData
        if (this.vacuumColor && !this.lattice.hasCellBeenVisited(k, i)) {
          r = this.vacuumColor.r;
          g = this.vacuumColor.g;
          b = this.vacuumColor.b;
        }

        // ImageData.data is Uint8ClampedArray.  Performance is critical and all numbers are non-negative.
        const offset = 4 * m;
        data[offset] = Math.round(r); // eslint-disable-line bad-sim-text
        data[offset + 1] = Math.round(g); // eslint-disable-line bad-sim-text
        data[offset + 2] = Math.round(b); // eslint-disable-line bad-sim-text
        data[offset + 3] = 255; // Fully opaque
        m++;
      }
    }
    this.imageDataRenderer.putImageData();

    // draw the sub-canvas to the rendering context at the appropriate scale
    context.save();
    context.transform(SoundConstants.CELL_WIDTH, 0, 0, SoundConstants.CELL_WIDTH, 0, 0);
    context.drawImage(this.imageDataRenderer.canvas, 0, 0);
    context.restore();
  }
}
sound.register('LatticeCanvasNode', LatticeCanvasNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlZlY3RvcjIiLCJDYW52YXNOb2RlIiwiQ29sb3IiLCJJbWFnZURhdGFSZW5kZXJlciIsIlNvdW5kQ29uc3RhbnRzIiwic291bmQiLCJvcHRpb25pemUiLCJDVVRPRkYiLCJMYXR0aWNlQ2FudmFzTm9kZSIsImNvbnN0cnVjdG9yIiwibGF0dGljZSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJjYW52YXNCb3VuZHMiLCJnZXRDYW52YXNCb3VuZHMiLCJsYXllclNwbGl0IiwiYmFzZUNvbG9yIiwiYmx1ZSIsImhhc1JlZmxlY3Rpb24iLCJzb3VyY2VQb3NpdGlvbiIsImhhc1NlY29uZFNvdXJjZSIsInNvdXJjZTJQb3NpdGlvblkiLCJ3YWxsQW5nbGUiLCJNYXRoIiwiUEkiLCJ3YWxsUG9zaXRpb25YIiwid2lkdGgiLCJ2YWN1dW1Db2xvciIsImltYWdlRGF0YVJlbmRlcmVyIiwidmlzaWJsZUJvdW5kcyIsImhlaWdodCIsImNoYW5nZWRFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJpbnZhbGlkYXRlUGFpbnQiLCJiaW5kIiwibG9jYWxQb2ludFRvTGF0dGljZVBvaW50IiwicG9pbnQiLCJyb3VuZFN5bW1ldHJpYyIsIngiLCJDRUxMX1dJRFRIIiwieSIsInNldFdhbGxQb3NpdGlvblgiLCJzZXRXYWxsQW5nbGUiLCJhbmdsZSIsInNldEJhc2VDb2xvciIsImNvbG9yIiwiZ2V0RGFtcGVuZWRWYWx1ZSIsImRpc3RhbmNlIiwiZGlzdGFuY2VYWSIsImRpc3RhbmNlRGFtcGVuIiwiTUFYX1NPVU5EX0RJU1RBTkNFIiwiZ2V0SW50ZXJwb2xhdGVkVmFsdWUiLCJwYWludENhbnZhcyIsImNvbnRleHQiLCJtIiwiZGF0YSIsImRhbXBYIiwiZGFtcFkiLCJpbnRlbnNpdHkiLCJpIiwiayIsImFkZGl0aW9uIiwiemVyb091dCIsInRhbiIsIm9yaWdpbmFsUG9zIiwid2FsbFZlY3RvciIsImNyZWF0ZVBvbGFyIiwid2FsbE9yaWdpbiIsIm1pcnJvcmVkUG9zaXRpb24iLCJ3aXRoTWFnbml0dWRlIiwiY29weSIsIm1pbnVzIiwiZG90IiwicGx1cyIsInBlcnAiLCJ0aW1lcyIsImZpbmFsIiwiZmluYWxYIiwiZmluYWxZIiwid2F2ZVZhbHVlIiwibGluZWFyIiwiY2xhbXAiLCJNSU5fU0hBREUiLCJyIiwicmVkIiwiZyIsImdyZWVuIiwiYiIsImhhc0NlbGxCZWVuVmlzaXRlZCIsIm9mZnNldCIsInJvdW5kIiwicHV0SW1hZ2VEYXRhIiwic2F2ZSIsInRyYW5zZm9ybSIsImRyYXdJbWFnZSIsImNhbnZhcyIsInJlc3RvcmUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkxhdHRpY2VDYW52YXNOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuLyoqXHJcbiAqIFJlbmRlcnMgdGhlIG1haW4gYXJlYSBvZiB0aGUgbGF0dGljZSAoZG9lc24ndCBpbmNsdWRlIHRoZSBkYW1waW5nIHJlZ2lvbnMpIHVzaW5nIDJkIGNhbnZhcy5cclxuICogQWxsb3dzIGZvciB3YWxsIHJlZmxlY3Rpb24gYW5kIGFuIGV4dHJhIHNvdXJjZS4gQWxzbyBjYW4gZGFtcGVuIHRoZSB3YXZlcyB0byBiZSB3aXRoaW4gYSBjZXJ0YWluIGFyZWEuXHJcbiAqXHJcbiAqIEBhdXRob3IgUGlldCBHb3JpcyAoVW5pdmVyc2l0eSBvZiBMZXV2ZW4pXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgQ2FudmFzTm9kZSwgQ2FudmFzTm9kZU9wdGlvbnMsIENvbG9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEltYWdlRGF0YVJlbmRlcmVyIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9JbWFnZURhdGFSZW5kZXJlci5qcyc7XHJcbmltcG9ydCBTb3VuZENvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vU291bmRDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgc291bmQgZnJvbSAnLi4vLi4vc291bmQuanMnO1xyXG5pbXBvcnQgTGF0dGljZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvTGF0dGljZS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgQ1VUT0ZGID0gMC40O1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICBiYXNlQ29sb3I/OiBDb2xvcjtcclxuICBoYXNSZWZsZWN0aW9uPzogYm9vbGVhbjtcclxuICBzb3VyY2VQb3NpdGlvbj86IFZlY3RvcjI7XHJcbiAgaGFzU2Vjb25kU291cmNlPzogYm9vbGVhbjtcclxuICBzb3VyY2UyUG9zaXRpb25ZPzogbnVtYmVyO1xyXG4gIHdhbGxBbmdsZT86IG51bWJlcjtcclxufTtcclxudHlwZSBMYXR0aWNlQ2FudmFzTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIENhbnZhc05vZGVPcHRpb25zO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGF0dGljZUNhbnZhc05vZGUgZXh0ZW5kcyBDYW52YXNOb2RlIHtcclxuXHJcbiAgcHVibGljIHNvdXJjZTJQb3NpdGlvblk6IG51bWJlcjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGhhc1NlY29uZFNvdXJjZTogYm9vbGVhbjtcclxuICBwcml2YXRlIHJlYWRvbmx5IHNvdXJjZVBvc2l0aW9uOiBWZWN0b3IyO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgaGFzUmVmbGVjdGlvbjogYm9vbGVhbjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGxhdHRpY2U6IExhdHRpY2U7XHJcbiAgcHJpdmF0ZSB3YWxsUG9zaXRpb25YOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSB3YWxsQW5nbGU6IG51bWJlcjtcclxuICBwcml2YXRlIGJhc2VDb2xvcjogQ29sb3I7XHJcblxyXG4gIC8vIHNldHRhYmxlLCBpZiBkZWZpbmVkIHNob3dzIHVudmlzaXRlZCBsYXR0aWNlIGNlbGxzIGFzIHNwZWNpZmllZCBjb2xvciwgdXNlZCBmb3IgbGlnaHRcclxuICBwcml2YXRlIHZhY3V1bUNvbG9yOiBDb2xvciB8IG51bGw7XHJcblxyXG4gIC8vIEZvciBwZXJmb3JtYW5jZSwgcmVuZGVyIGludG8gYSBzdWItY2FudmFzIHdoaWNoIHdpbGwgYmUgZHJhd24gaW50byB0aGUgcmVuZGVyaW5nIGNvbnRleHQgYXQgdGhlIHJpZ2h0IHNjYWxlXHJcbiAgcHJpdmF0ZSByZWFkb25seSBpbWFnZURhdGFSZW5kZXJlcjogSW1hZ2VEYXRhUmVuZGVyZXI7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbGF0dGljZTogTGF0dGljZSwgcHJvdmlkZWRPcHRpb25zPzogTGF0dGljZUNhbnZhc05vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8TGF0dGljZUNhbnZhc05vZGVPcHRpb25zLCBTZWxmT3B0aW9ucywgQ2FudmFzTm9kZU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIG9ubHkgdXNlIHRoZSB2aXNpYmxlIHBhcnQgZm9yIHRoZSBib3VuZHMgKG5vdCB0aGUgZGFtcGluZyByZWdpb25zKVxyXG4gICAgICBjYW52YXNCb3VuZHM6IFNvdW5kQ29uc3RhbnRzLmdldENhbnZhc0JvdW5kcyggbGF0dGljZSApLFxyXG4gICAgICBsYXllclNwbGl0OiB0cnVlLCAvLyBlbnN1cmUgd2UncmUgb24gb3VyIG93biBsYXllclxyXG4gICAgICBiYXNlQ29sb3I6IENvbG9yLmJsdWUsXHJcbiAgICAgIGhhc1JlZmxlY3Rpb246IGZhbHNlLFxyXG4gICAgICBzb3VyY2VQb3NpdGlvbjogbmV3IFZlY3RvcjIoIDAsIDAgKSxcclxuICAgICAgaGFzU2Vjb25kU291cmNlOiBmYWxzZSxcclxuICAgICAgc291cmNlMlBvc2l0aW9uWTogMCxcclxuICAgICAgd2FsbEFuZ2xlOiBNYXRoLlBJIC8gNFxyXG5cclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5oYXNTZWNvbmRTb3VyY2UgPSBvcHRpb25zLmhhc1NlY29uZFNvdXJjZTtcclxuICAgIHRoaXMuc291cmNlMlBvc2l0aW9uWSA9IG9wdGlvbnMuc291cmNlMlBvc2l0aW9uWTtcclxuICAgIHRoaXMuc291cmNlUG9zaXRpb24gPSBvcHRpb25zLnNvdXJjZVBvc2l0aW9uO1xyXG4gICAgdGhpcy5oYXNSZWZsZWN0aW9uID0gb3B0aW9ucy5oYXNSZWZsZWN0aW9uO1xyXG5cclxuICAgIHRoaXMubGF0dGljZSA9IGxhdHRpY2U7XHJcbiAgICB0aGlzLndhbGxQb3NpdGlvblggPSB0aGlzLmxhdHRpY2Uud2lkdGggLyAyO1xyXG5cclxuICAgIHRoaXMud2FsbEFuZ2xlID0gb3B0aW9ucy53YWxsQW5nbGU7XHJcblxyXG4gICAgdGhpcy5iYXNlQ29sb3IgPSBvcHRpb25zLmJhc2VDb2xvcjtcclxuXHJcbiAgICB0aGlzLnZhY3V1bUNvbG9yID0gbnVsbDtcclxuXHJcbiAgICB0aGlzLmltYWdlRGF0YVJlbmRlcmVyID0gbmV3IEltYWdlRGF0YVJlbmRlcmVyKCBsYXR0aWNlLnZpc2libGVCb3VuZHMud2lkdGgsIGxhdHRpY2UudmlzaWJsZUJvdW5kcy5oZWlnaHQgKTtcclxuXHJcbiAgICAvLyBJbnZhbGlkYXRlIHBhaW50IHdoZW4gbW9kZWwgaW5kaWNhdGVzIGNoYW5nZXNcclxuICAgIGxhdHRpY2UuY2hhbmdlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIHRoaXMuaW52YWxpZGF0ZVBhaW50LmJpbmQoIHRoaXMgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29udmVydCB0aGUgZ2l2ZW4gcG9pbnQgaW4gdGhlIGxvY2FsIGNvb3JkaW5hdGUgZnJhbWUgdG8gdGhlIGNvcnJlc3BvbmRpbmcgaSxqIChpbnRlZ3JhbCkgbGF0dGljZSBjb29yZGluYXRlcy5cclxuICAgKiBAcGFyYW0gcG9pbnQgLSBwb2ludCBpbiB0aGUgbG9jYWwgY29vcmRpbmF0ZSBmcmFtZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIGxvY2FsUG9pbnRUb0xhdHRpY2VQb2ludCggcG9pbnQ6IFZlY3RvcjIgKTogVmVjdG9yMiB7XHJcbiAgICByZXR1cm4gbmV3IFZlY3RvcjIoXHJcbiAgICAgIFV0aWxzLnJvdW5kU3ltbWV0cmljKCBwb2ludC54IC8gU291bmRDb25zdGFudHMuQ0VMTF9XSURUSCApLFxyXG4gICAgICBVdGlscy5yb3VuZFN5bW1ldHJpYyggcG9pbnQueSAvIFNvdW5kQ29uc3RhbnRzLkNFTExfV0lEVEggKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIHggY29vcmRpbmF0ZSBvZiB0aGUgcmVmbGVjdGlvbiB3YWxsXHJcbiAgICovXHJcbiAgcHVibGljIHNldFdhbGxQb3NpdGlvblgoIHg6IG51bWJlciApOiB2b2lkIHtcclxuICAgIHRoaXMud2FsbFBvc2l0aW9uWCA9IHg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSBhbmdsZSBvZiB0aGUgcmVmbGVjdGlvbiB3YWxsXHJcbiAgICovXHJcbiAgcHVibGljIHNldFdhbGxBbmdsZSggYW5nbGU6IG51bWJlciApOiB2b2lkIHtcclxuICAgIHRoaXMud2FsbEFuZ2xlID0gYW5nbGU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSBjb2xvciBvZiB0aGUgcGVha3Mgb2YgdGhlIHdhdmUuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRCYXNlQ29sb3IoIGNvbG9yOiBDb2xvciApOiB2b2lkIHtcclxuICAgIHRoaXMuYmFzZUNvbG9yID0gY29sb3I7XHJcbiAgICB0aGlzLmludmFsaWRhdGVQYWludCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyBkYW1wZW5lZCBsYXR0aWNlIHZhbHVlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXREYW1wZW5lZFZhbHVlKCB4OiBudW1iZXIsIHk6IG51bWJlciApOiBudW1iZXIge1xyXG4gICAgY29uc3QgZGlzdGFuY2UgPSB0aGlzLnNvdXJjZVBvc2l0aW9uLmRpc3RhbmNlWFkoIHgsIHkgKTtcclxuICAgIGNvbnN0IGRpc3RhbmNlRGFtcGVuID0gZGlzdGFuY2UgPj0gMCAmJiBkaXN0YW5jZSA8PSBTb3VuZENvbnN0YW50cy5NQVhfU09VTkRfRElTVEFOQ0UgPyAoIFNvdW5kQ29uc3RhbnRzLk1BWF9TT1VORF9ESVNUQU5DRSAtIGRpc3RhbmNlICkgLyBTb3VuZENvbnN0YW50cy5NQVhfU09VTkRfRElTVEFOQ0UgOiAwO1xyXG5cclxuICAgIHJldHVybiB0aGlzLmxhdHRpY2UuZ2V0SW50ZXJwb2xhdGVkVmFsdWUoIHgsIHkgKSAqIGRpc3RhbmNlRGFtcGVuO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRHJhd3MgaW50byB0aGUgY2FudmFzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBwYWludENhbnZhcyggY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEICk6IHZvaWQge1xyXG4gICAgbGV0IG0gPSAwO1xyXG4gICAgY29uc3QgZGF0YSA9IHRoaXMuaW1hZ2VEYXRhUmVuZGVyZXIuZGF0YTtcclxuICAgIGNvbnN0IGRhbXBYID0gdGhpcy5sYXR0aWNlLmRhbXBYO1xyXG4gICAgY29uc3QgZGFtcFkgPSB0aGlzLmxhdHRpY2UuZGFtcFk7XHJcbiAgICBjb25zdCB3aWR0aCA9IHRoaXMubGF0dGljZS53aWR0aDtcclxuICAgIGNvbnN0IGhlaWdodCA9IHRoaXMubGF0dGljZS5oZWlnaHQ7XHJcbiAgICBsZXQgaW50ZW5zaXR5O1xyXG5cclxuICAgIGZvciAoIGxldCBpID0gZGFtcFg7IGkgPCB3aWR0aCAtIGRhbXBYOyBpKysgKSB7XHJcbiAgICAgIGZvciAoIGxldCBrID0gZGFtcFk7IGsgPCBoZWlnaHQgLSBkYW1wWTsgaysrICkge1xyXG5cclxuICAgICAgICAvLyBOb3RlIHRoaXMgaXMgdHJhbnNwb3NlZCBiZWNhdXNlIG9mIHRoZSBvcmRlcmluZyBvZiBwdXRJbWFnZURhdGFcclxuXHJcbiAgICAgICAgbGV0IGFkZGl0aW9uID0gMDtcclxuICAgICAgICBsZXQgemVyb091dCA9IDE7XHJcblxyXG4gICAgICAgIGlmICggdGhpcy5oYXNSZWZsZWN0aW9uICkge1xyXG4gICAgICAgICAgaWYgKCBrID49IHRoaXMuc291cmNlUG9zaXRpb24ueCAmJiBrIDwgVXRpbHMucm91bmRTeW1tZXRyaWMoIHRoaXMud2FsbFBvc2l0aW9uWCApIC0gKCBpIC0gaGVpZ2h0ICsgZGFtcFkgKSAvIE1hdGgudGFuKCB0aGlzLndhbGxBbmdsZSApICkge1xyXG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbFBvcyA9IG5ldyBWZWN0b3IyKCBrLCBpICk7XHJcbiAgICAgICAgICAgIGNvbnN0IHdhbGxWZWN0b3IgPSBWZWN0b3IyLmNyZWF0ZVBvbGFyKCAxLCAtdGhpcy53YWxsQW5nbGUgKTtcclxuICAgICAgICAgICAgY29uc3Qgd2FsbE9yaWdpbiA9IG5ldyBWZWN0b3IyKCB0aGlzLndhbGxQb3NpdGlvblgsIGhlaWdodCAtIGRhbXBZICk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1pcnJvcmVkUG9zaXRpb24gPSB3YWxsVmVjdG9yLndpdGhNYWduaXR1ZGUoIG9yaWdpbmFsUG9zLmNvcHkoKS5taW51cyggd2FsbE9yaWdpbiApLmRvdCggd2FsbFZlY3RvciApICkucGx1cyggd2FsbE9yaWdpbiApO1xyXG4gICAgICAgICAgICBjb25zdCBwZXJwID0gbWlycm9yZWRQb3NpdGlvbi5taW51cyggb3JpZ2luYWxQb3MgKS50aW1lcyggMiApO1xyXG4gICAgICAgICAgICBjb25zdCBmaW5hbCA9IG9yaWdpbmFsUG9zLnBsdXMoIHBlcnAgKTtcclxuICAgICAgICAgICAgY29uc3QgZmluYWxYID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIGZpbmFsLnggKTtcclxuICAgICAgICAgICAgY29uc3QgZmluYWxZID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIGZpbmFsLnkgKTtcclxuXHJcbiAgICAgICAgICAgIGFkZGl0aW9uID0gdGhpcy5nZXREYW1wZW5lZFZhbHVlKCBmaW5hbFgsIGZpbmFsWSApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHplcm9PdXQgPSAwO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCB0aGlzLmhhc1NlY29uZFNvdXJjZSApIHtcclxuICAgICAgICAgIGFkZGl0aW9uID0gdGhpcy5nZXREYW1wZW5lZFZhbHVlKCBrLCBVdGlscy5yb3VuZFN5bW1ldHJpYyggaSArIHRoaXMuc291cmNlUG9zaXRpb24ueSAtIHRoaXMuc291cmNlMlBvc2l0aW9uWSApICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB3YXZlVmFsdWUgPSAoIHRoaXMuZ2V0RGFtcGVuZWRWYWx1ZSggaywgaSApICsgYWRkaXRpb24gKSAqIHplcm9PdXQ7XHJcblxyXG4gICAgICAgIGlmICggd2F2ZVZhbHVlID4gMCApIHtcclxuICAgICAgICAgIGludGVuc2l0eSA9IFV0aWxzLmxpbmVhciggMCwgMiwgQ1VUT0ZGLCAxLCB3YXZlVmFsdWUgKTtcclxuICAgICAgICAgIGludGVuc2l0eSA9IFV0aWxzLmNsYW1wKCBpbnRlbnNpdHksIENVVE9GRiwgMSApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGNvbnN0IE1JTl9TSEFERSA9IDAuMDM7IC8vIFN0b3AgYmVmb3JlIDAgYmVjYXVzZSAwIGlzIHRvbyBqYXJyaW5nXHJcbiAgICAgICAgICBpbnRlbnNpdHkgPSBVdGlscy5saW5lYXIoIC0xLjUsIDAsIE1JTl9TSEFERSwgQ1VUT0ZGLCB3YXZlVmFsdWUgKTtcclxuICAgICAgICAgIGludGVuc2l0eSA9IFV0aWxzLmNsYW1wKCBpbnRlbnNpdHksIE1JTl9TSEFERSwgQ1VUT0ZGICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBOb3RlIHRoaXMgaW50ZXJwb2xhdGlvbiBkb2Vzbid0IGluY2x1ZGUgdGhlIGdhbW1hIGZhY3RvciB0aGF0IENvbG9yLmJsZW5kIGRvZXNcclxuICAgICAgICBsZXQgciA9IHRoaXMuYmFzZUNvbG9yLnJlZCAqIGludGVuc2l0eTtcclxuICAgICAgICBsZXQgZyA9IHRoaXMuYmFzZUNvbG9yLmdyZWVuICogaW50ZW5zaXR5O1xyXG4gICAgICAgIGxldCBiID0gdGhpcy5iYXNlQ29sb3IuYmx1ZSAqIGludGVuc2l0eTtcclxuXHJcbiAgICAgICAgLy8gTm90ZSB0aGlzIGlzIHRyYW5zcG9zZWQgYmVjYXVzZSBvZiB0aGUgb3JkZXJpbmcgb2YgcHV0SW1hZ2VEYXRhXHJcbiAgICAgICAgaWYgKCB0aGlzLnZhY3V1bUNvbG9yICYmICF0aGlzLmxhdHRpY2UuaGFzQ2VsbEJlZW5WaXNpdGVkKCBrLCBpICkgKSB7XHJcbiAgICAgICAgICByID0gdGhpcy52YWN1dW1Db2xvci5yO1xyXG4gICAgICAgICAgZyA9IHRoaXMudmFjdXVtQ29sb3IuZztcclxuICAgICAgICAgIGIgPSB0aGlzLnZhY3V1bUNvbG9yLmI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJbWFnZURhdGEuZGF0YSBpcyBVaW50OENsYW1wZWRBcnJheS4gIFBlcmZvcm1hbmNlIGlzIGNyaXRpY2FsIGFuZCBhbGwgbnVtYmVycyBhcmUgbm9uLW5lZ2F0aXZlLlxyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IDQgKiBtO1xyXG4gICAgICAgIGRhdGFbIG9mZnNldCBdID0gTWF0aC5yb3VuZCggciApOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGJhZC1zaW0tdGV4dFxyXG4gICAgICAgIGRhdGFbIG9mZnNldCArIDEgXSA9IE1hdGgucm91bmQoIGcgKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBiYWQtc2ltLXRleHRcclxuICAgICAgICBkYXRhWyBvZmZzZXQgKyAyIF0gPSBNYXRoLnJvdW5kKCBiICk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgYmFkLXNpbS10ZXh0XHJcbiAgICAgICAgZGF0YVsgb2Zmc2V0ICsgMyBdID0gMjU1OyAvLyBGdWxseSBvcGFxdWVcclxuICAgICAgICBtKys7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuaW1hZ2VEYXRhUmVuZGVyZXIucHV0SW1hZ2VEYXRhKCk7XHJcblxyXG4gICAgLy8gZHJhdyB0aGUgc3ViLWNhbnZhcyB0byB0aGUgcmVuZGVyaW5nIGNvbnRleHQgYXQgdGhlIGFwcHJvcHJpYXRlIHNjYWxlXHJcbiAgICBjb250ZXh0LnNhdmUoKTtcclxuICAgIGNvbnRleHQudHJhbnNmb3JtKCBTb3VuZENvbnN0YW50cy5DRUxMX1dJRFRILCAwLCAwLCBTb3VuZENvbnN0YW50cy5DRUxMX1dJRFRILCAwLCAwICk7XHJcbiAgICBjb250ZXh0LmRyYXdJbWFnZSggdGhpcy5pbWFnZURhdGFSZW5kZXJlci5jYW52YXMsIDAsIDAgKTtcclxuICAgIGNvbnRleHQucmVzdG9yZSgpO1xyXG4gIH1cclxufVxyXG5cclxuc291bmQucmVnaXN0ZXIoICdMYXR0aWNlQ2FudmFzTm9kZScsIExhdHRpY2VDYW52YXNOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxTQUFTQyxVQUFVLEVBQXFCQyxLQUFLLFFBQVEsbUNBQW1DO0FBQ3hGLE9B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