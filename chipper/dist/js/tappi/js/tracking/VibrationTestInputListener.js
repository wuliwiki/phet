// Copyright 2020-2021, University of Colorado Boulder

/**
 * @author Jesse Greenberg
 */

import tappi from '../tappi.js';
import VibrationTestEvent from './VibrationTestEvent.js';
class VibrationTestInputListener {
  /**
   * @param {VibrationTestEventRecorder} eventRecorder - object saving VibrationTestEvents, passed in since this is not
   *                                                     the only class creating and saving events.
   */
  constructor(eventRecorder) {
    // @private {VibrationTestEventRecorder}
    this.eventRecorder = eventRecorder;

    // in seconds
    this.elapsedTime = 0;
    this._pointerListener = {
      up: event => {
        const globalPoint = event.pointer.point;
        const testEvent = new VibrationTestEvent(globalPoint.x, globalPoint.y, this.elapsedTime, `${event.pointer.type}up`);
        this.eventRecorder.addTestEvent(testEvent);
        this.handleRelease();
      },
      cancel: evennt => {
        this.handleRelease();
      },
      // attached to the pointer, so that only moves that occur while a pointer is down are recorded
      move: event => {
        const globalPoint = event.pointer.point;
        const testEvent = new VibrationTestEvent(globalPoint.x, globalPoint.y, this.elapsedTime, `${event.pointer.type}move`);
        this.eventRecorder.addTestEvent(testEvent);
      }
    };
    this.pointer = null;
  }

  /**
   * @private
   * @param {SceneryEvent} event
   */
  handleRelease(event) {
    this.pointer.removeInputListener(this._pointerListener);
    this.pointer = null;
  }

  /**
   * @public
   */
  interrupt() {
    if (this.pointer) {
      this.pointer.removeInputListener(this._pointerListener);
      this.pointer = null;
    }
  }

  /**
   * @public (scenery-internal) - part of the listener API
   * @param event
   */
  down(event) {
    if (this.pointer === null) {
      this.pointer = event.pointer;
      const globalPoint = event.pointer.point;
      const testEvent = new VibrationTestEvent(globalPoint.x, globalPoint.y, this.elapsedTime, `${event.pointer.type}down`);
      this.eventRecorder.addTestEvent(testEvent);
      event.pointer.addInputListener(this._pointerListener, false);
    }
  }

  /**
   * @public (scenery-internal) - part of the listener API
   * @param event
   */
  click(event) {
    // just record center of click target
    const position = event.target.globalBounds.center;
    console.log(position);
    const testEvent = new VibrationTestEvent(position.x, position.y, this.elapsedTime, event.pointer.type);
    this.eventRecorder.addTestEvent(testEvent);
  }

  /**
   * Sets the elapsed time to be saved for events. Rather than stepping/tracking its own elapsed time,
   * it should be set externally by a simulation because this listener is not the only one to save data
   * to the event recorder. The simulation updates its elapsed time in one location and sends that
   * to the places that need it.
   * @public
   *
   * @param {number} time - in seconds
   */
  setElapsedTime(time) {
    this.elapsedTime = time;
  }
}
tappi.register('VibrationTestInputListener', VibrationTestInputListener);
export default VibrationTestInputListener;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ0YXBwaSIsIlZpYnJhdGlvblRlc3RFdmVudCIsIlZpYnJhdGlvblRlc3RJbnB1dExpc3RlbmVyIiwiY29uc3RydWN0b3IiLCJldmVudFJlY29yZGVyIiwiZWxhcHNlZFRpbWUiLCJfcG9pbnRlckxpc3RlbmVyIiwidXAiLCJldmVudCIsImdsb2JhbFBvaW50IiwicG9pbnRlciIsInBvaW50IiwidGVzdEV2ZW50IiwieCIsInkiLCJ0eXBlIiwiYWRkVGVzdEV2ZW50IiwiaGFuZGxlUmVsZWFzZSIsImNhbmNlbCIsImV2ZW5udCIsIm1vdmUiLCJyZW1vdmVJbnB1dExpc3RlbmVyIiwiaW50ZXJydXB0IiwiZG93biIsImFkZElucHV0TGlzdGVuZXIiLCJjbGljayIsInBvc2l0aW9uIiwidGFyZ2V0IiwiZ2xvYmFsQm91bmRzIiwiY2VudGVyIiwiY29uc29sZSIsImxvZyIsInNldEVsYXBzZWRUaW1lIiwidGltZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiVmlicmF0aW9uVGVzdElucHV0TGlzdGVuZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjAtMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmdcclxuICovXHJcblxyXG5pbXBvcnQgdGFwcGkgZnJvbSAnLi4vdGFwcGkuanMnO1xyXG5pbXBvcnQgVmlicmF0aW9uVGVzdEV2ZW50IGZyb20gJy4vVmlicmF0aW9uVGVzdEV2ZW50LmpzJztcclxuXHJcbmNsYXNzIFZpYnJhdGlvblRlc3RJbnB1dExpc3RlbmVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtWaWJyYXRpb25UZXN0RXZlbnRSZWNvcmRlcn0gZXZlbnRSZWNvcmRlciAtIG9iamVjdCBzYXZpbmcgVmlicmF0aW9uVGVzdEV2ZW50cywgcGFzc2VkIGluIHNpbmNlIHRoaXMgaXMgbm90XHJcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBvbmx5IGNsYXNzIGNyZWF0aW5nIGFuZCBzYXZpbmcgZXZlbnRzLlxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBldmVudFJlY29yZGVyICkge1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtWaWJyYXRpb25UZXN0RXZlbnRSZWNvcmRlcn1cclxuICAgIHRoaXMuZXZlbnRSZWNvcmRlciA9IGV2ZW50UmVjb3JkZXI7XHJcblxyXG4gICAgLy8gaW4gc2Vjb25kc1xyXG4gICAgdGhpcy5lbGFwc2VkVGltZSA9IDA7XHJcblxyXG4gICAgdGhpcy5fcG9pbnRlckxpc3RlbmVyID0ge1xyXG4gICAgICB1cDogZXZlbnQgPT4ge1xyXG4gICAgICAgIGNvbnN0IGdsb2JhbFBvaW50ID0gZXZlbnQucG9pbnRlci5wb2ludDtcclxuICAgICAgICBjb25zdCB0ZXN0RXZlbnQgPSBuZXcgVmlicmF0aW9uVGVzdEV2ZW50KCBnbG9iYWxQb2ludC54LCBnbG9iYWxQb2ludC55LCB0aGlzLmVsYXBzZWRUaW1lLCBgJHtldmVudC5wb2ludGVyLnR5cGV9dXBgICk7XHJcbiAgICAgICAgdGhpcy5ldmVudFJlY29yZGVyLmFkZFRlc3RFdmVudCggdGVzdEV2ZW50ICk7XHJcblxyXG4gICAgICAgIHRoaXMuaGFuZGxlUmVsZWFzZSgpO1xyXG4gICAgICB9LFxyXG4gICAgICBjYW5jZWw6IGV2ZW5udCA9PiB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVSZWxlYXNlKCk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBhdHRhY2hlZCB0byB0aGUgcG9pbnRlciwgc28gdGhhdCBvbmx5IG1vdmVzIHRoYXQgb2NjdXIgd2hpbGUgYSBwb2ludGVyIGlzIGRvd24gYXJlIHJlY29yZGVkXHJcbiAgICAgIG1vdmU6IGV2ZW50ID0+IHtcclxuICAgICAgICBjb25zdCBnbG9iYWxQb2ludCA9IGV2ZW50LnBvaW50ZXIucG9pbnQ7XHJcbiAgICAgICAgY29uc3QgdGVzdEV2ZW50ID0gbmV3IFZpYnJhdGlvblRlc3RFdmVudCggZ2xvYmFsUG9pbnQueCwgZ2xvYmFsUG9pbnQueSwgdGhpcy5lbGFwc2VkVGltZSwgYCR7ZXZlbnQucG9pbnRlci50eXBlfW1vdmVgICk7XHJcbiAgICAgICAgdGhpcy5ldmVudFJlY29yZGVyLmFkZFRlc3RFdmVudCggdGVzdEV2ZW50ICk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5wb2ludGVyID0gbnVsbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHBhcmFtIHtTY2VuZXJ5RXZlbnR9IGV2ZW50XHJcbiAgICovXHJcbiAgaGFuZGxlUmVsZWFzZSggZXZlbnQgKSB7XHJcbiAgICB0aGlzLnBvaW50ZXIucmVtb3ZlSW5wdXRMaXN0ZW5lciggdGhpcy5fcG9pbnRlckxpc3RlbmVyICk7XHJcbiAgICB0aGlzLnBvaW50ZXIgPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGludGVycnVwdCgpIHtcclxuICAgIGlmICggdGhpcy5wb2ludGVyICkge1xyXG4gICAgICB0aGlzLnBvaW50ZXIucmVtb3ZlSW5wdXRMaXN0ZW5lciggdGhpcy5fcG9pbnRlckxpc3RlbmVyICk7XHJcbiAgICAgIHRoaXMucG9pbnRlciA9IG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHVibGljIChzY2VuZXJ5LWludGVybmFsKSAtIHBhcnQgb2YgdGhlIGxpc3RlbmVyIEFQSVxyXG4gICAqIEBwYXJhbSBldmVudFxyXG4gICAqL1xyXG4gIGRvd24oIGV2ZW50ICkge1xyXG4gICAgaWYgKCB0aGlzLnBvaW50ZXIgPT09IG51bGwgKSB7XHJcbiAgICAgIHRoaXMucG9pbnRlciA9IGV2ZW50LnBvaW50ZXI7XHJcbiAgICAgIGNvbnN0IGdsb2JhbFBvaW50ID0gZXZlbnQucG9pbnRlci5wb2ludDtcclxuICAgICAgY29uc3QgdGVzdEV2ZW50ID0gbmV3IFZpYnJhdGlvblRlc3RFdmVudCggZ2xvYmFsUG9pbnQueCwgZ2xvYmFsUG9pbnQueSwgdGhpcy5lbGFwc2VkVGltZSwgYCR7ZXZlbnQucG9pbnRlci50eXBlfWRvd25gICk7XHJcbiAgICAgIHRoaXMuZXZlbnRSZWNvcmRlci5hZGRUZXN0RXZlbnQoIHRlc3RFdmVudCApO1xyXG5cclxuICAgICAgZXZlbnQucG9pbnRlci5hZGRJbnB1dExpc3RlbmVyKCB0aGlzLl9wb2ludGVyTGlzdGVuZXIsIGZhbHNlICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHVibGljIChzY2VuZXJ5LWludGVybmFsKSAtIHBhcnQgb2YgdGhlIGxpc3RlbmVyIEFQSVxyXG4gICAqIEBwYXJhbSBldmVudFxyXG4gICAqL1xyXG4gIGNsaWNrKCBldmVudCApIHtcclxuXHJcbiAgICAvLyBqdXN0IHJlY29yZCBjZW50ZXIgb2YgY2xpY2sgdGFyZ2V0XHJcbiAgICBjb25zdCBwb3NpdGlvbiA9IGV2ZW50LnRhcmdldC5nbG9iYWxCb3VuZHMuY2VudGVyO1xyXG4gICAgY29uc29sZS5sb2coIHBvc2l0aW9uICk7XHJcbiAgICBjb25zdCB0ZXN0RXZlbnQgPSBuZXcgVmlicmF0aW9uVGVzdEV2ZW50KCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCB0aGlzLmVsYXBzZWRUaW1lLCBldmVudC5wb2ludGVyLnR5cGUgKTtcclxuICAgIHRoaXMuZXZlbnRSZWNvcmRlci5hZGRUZXN0RXZlbnQoIHRlc3RFdmVudCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgZWxhcHNlZCB0aW1lIHRvIGJlIHNhdmVkIGZvciBldmVudHMuIFJhdGhlciB0aGFuIHN0ZXBwaW5nL3RyYWNraW5nIGl0cyBvd24gZWxhcHNlZCB0aW1lLFxyXG4gICAqIGl0IHNob3VsZCBiZSBzZXQgZXh0ZXJuYWxseSBieSBhIHNpbXVsYXRpb24gYmVjYXVzZSB0aGlzIGxpc3RlbmVyIGlzIG5vdCB0aGUgb25seSBvbmUgdG8gc2F2ZSBkYXRhXHJcbiAgICogdG8gdGhlIGV2ZW50IHJlY29yZGVyLiBUaGUgc2ltdWxhdGlvbiB1cGRhdGVzIGl0cyBlbGFwc2VkIHRpbWUgaW4gb25lIGxvY2F0aW9uIGFuZCBzZW5kcyB0aGF0XHJcbiAgICogdG8gdGhlIHBsYWNlcyB0aGF0IG5lZWQgaXQuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHRpbWUgLSBpbiBzZWNvbmRzXHJcbiAgICovXHJcbiAgc2V0RWxhcHNlZFRpbWUoIHRpbWUgKSB7XHJcbiAgICB0aGlzLmVsYXBzZWRUaW1lID0gdGltZTtcclxuICB9XHJcbn1cclxuXHJcbnRhcHBpLnJlZ2lzdGVyKCAnVmlicmF0aW9uVGVzdElucHV0TGlzdGVuZXInLCBWaWJyYXRpb25UZXN0SW5wdXRMaXN0ZW5lciApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgVmlicmF0aW9uVGVzdElucHV0TGlzdGVuZXI7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBTSxhQUFhO0FBQy9CLE9BQU9DLGtCQUFrQixNQUFNLHlCQUF5QjtBQUV4RCxNQUFNQywwQkFBMEIsQ0FBQztFQUUvQjtBQUNGO0FBQ0E7QUFDQTtFQUNFQyxXQUFXQSxDQUFFQyxhQUFhLEVBQUc7SUFFM0I7SUFDQSxJQUFJLENBQUNBLGFBQWEsR0FBR0EsYUFBYTs7SUFFbEM7SUFDQSxJQUFJLENBQUNDLFdBQVcsR0FBRyxDQUFDO0lBRXBCLElBQUksQ0FBQ0MsZ0JBQWdCLEdBQUc7TUFDdEJDLEVBQUUsRUFBRUMsS0FBSyxJQUFJO1FBQ1gsTUFBTUMsV0FBVyxHQUFHRCxLQUFLLENBQUNFLE9BQU8sQ0FBQ0MsS0FBSztRQUN2QyxNQUFNQyxTQUFTLEdBQUcsSUFBSVgsa0JBQWtCLENBQUVRLFdBQVcsQ0FBQ0ksQ0FBQyxFQUFFSixXQUFXLENBQUNLLENBQUMsRUFBRSxJQUFJLENB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