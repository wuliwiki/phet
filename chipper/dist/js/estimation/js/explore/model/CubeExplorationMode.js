// Copyright 2014-2021, University of Colorado Boulder

/**
 * Definition of the 'cube exploration mode' for the exploration model.
 */

import dotRandom from '../../../../dot/js/dotRandom.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Color } from '../../../../scenery/js/imports.js';
import EstimationConstants from '../../common/EstimationConstants.js';
import CubeModel from '../../common/model/CubeModel.js';
import Dimension3 from '../../common/model/Dimension3.js';
import estimation from '../../estimation.js';
import AbstractExplorationMode from './AbstractExplorationMode.js';

// constants
const MAX_DISCRETE_CUBES = 200;
const MODE_NAME = 'cubes';
const COMPARE_CUBE_SIZE = new Dimension3(1.75, 1.75, 1.75);
const VALID_REF_OBJECT_SIZES = [new Dimension3(COMPARE_CUBE_SIZE.width / 5, COMPARE_CUBE_SIZE.height / 5, COMPARE_CUBE_SIZE.depth / 5), new Dimension3(COMPARE_CUBE_SIZE.width / 4, COMPARE_CUBE_SIZE.height / 4, COMPARE_CUBE_SIZE.depth / 4), new Dimension3(COMPARE_CUBE_SIZE.width / 3, COMPARE_CUBE_SIZE.height / 3, COMPARE_CUBE_SIZE.depth / 3), new Dimension3(COMPARE_CUBE_SIZE.width / 2, COMPARE_CUBE_SIZE.height / 2, COMPARE_CUBE_SIZE.depth / 2), new Dimension3(COMPARE_CUBE_SIZE.width / 3, COMPARE_CUBE_SIZE.height / 2, COMPARE_CUBE_SIZE.depth / 2), new Dimension3(COMPARE_CUBE_SIZE.width / 4, COMPARE_CUBE_SIZE.height / 2, COMPARE_CUBE_SIZE.depth / 2), new Dimension3(COMPARE_CUBE_SIZE.width / 2, COMPARE_CUBE_SIZE.height / 4, COMPARE_CUBE_SIZE.depth / 2)];
const INITIAL_REFERENCE_OBJECT_SIZE = VALID_REF_OBJECT_SIZES[2];
class CubeExplorationMode extends AbstractExplorationMode {
  constructor(selectedModeProperty) {
    super(selectedModeProperty, MODE_NAME);

    // Create the reference, compare, continuous, and discrete objects.
    const compareCubePosition = new Vector2(0, -0.2);
    this.compareObject = new CubeModel(COMPARE_CUBE_SIZE, compareCubePosition, new Color(EstimationConstants.COMPARISON_OBJECT_COLOR).setAlpha(0.5), false, false);
    this.continuousSizableObject = new CubeModel(new Dimension3(0.1, 0.1, 0.1), compareCubePosition, EstimationConstants.REFERENCE_OBJECT_COLOR, false, false);
    this.referenceObject = new CubeModel(INITIAL_REFERENCE_OBJECT_SIZE, new Vector2(-2, 0), EstimationConstants.REFERENCE_OBJECT_COLOR, false, false);
    _.times(MAX_DISCRETE_CUBES, () => {
      // Initial size is arbitrary, will be sized as needed.
      this.discreteObjectList.push(new CubeModel(new Dimension3(0.1, 0.1, 0.1), Vector2.ZERO, EstimationConstants.REFERENCE_OBJECT_COLOR, true, false));
    });
    this.setReferenceObjectSize(INITIAL_REFERENCE_OBJECT_SIZE);
    this.numVisibleDiscreteCubes = 0;

    // Complete initialization by hooking up visibility updates in the parent class.
    this.hookUpVisibilityUpdates();

    // Maintain a short history of reference object sizes so unique ones can be chosen.
    this.previousReferenceObjectSize = INITIAL_REFERENCE_OBJECT_SIZE;
  }

  // TODO: Visibility annotations should be checked and updated, see https://github.com/phetsims/estimation/issues/9

  // @public
  setReferenceObjectSize(size) {
    this.referenceObject.sizeProperty.value = size;

    // Size and position the discrete cubes based on the sizes of the
    // reference cube and the compare cube.
    const cubesAcross = this.compareObject.sizeProperty.value.width / this.referenceObject.sizeProperty.value.width;
    const cubesFrontToBack = this.compareObject.sizeProperty.value.depth / this.referenceObject.sizeProperty.value.depth;
    let numCubesPlaced = 0;
    const compareCubeBackCorner = this.compareObject.positionProperty.value.plus(new Vector2(this.compareObject.sizeProperty.value.depth * EstimationConstants.DEPTH_PROJECTION_PROPORTION, 0).rotated(EstimationConstants.CUBE_PROJECTION_ANGLE));
    const xUnitDisplacement = new Vector2(this.referenceObject.sizeProperty.value.width, 0);
    const yUnitDisplacement = new Vector2(0, this.referenceObject.sizeProperty.value.height);
    const zUnitDisplacement = new Vector2(-this.referenceObject.sizeProperty.value.depth * EstimationConstants.DEPTH_PROJECTION_PROPORTION, 0).rotated(EstimationConstants.CUBE_PROJECTION_ANGLE);
    const xDisplacement = new Vector2(0, 0);
    const yDisplacement = new Vector2(0, 0);
    const zDisplacement = new Vector2(0, 0);
    for (let y = 0; numCubesPlaced < MAX_DISCRETE_CUBES; y++) {
      yDisplacement.setY(yUnitDisplacement.y * y);
      for (let z = 0; z < cubesFrontToBack && numCubesPlaced < MAX_DISCRETE_CUBES; z++) {
        zDisplacement.setXY(zUnitDisplacement.x * (z + 1), zUnitDisplacement.y * (z + 1));
        for (let x = 0; x < cubesAcross && numCubesPlaced < MAX_DISCRETE_CUBES; x++) {
          this.discreteObjectList[numCubesPlaced].sizeProperty.value = this.referenceObject.sizeProperty.value;
          xDisplacement.setX(xUnitDisplacement.x * x);
          this.discreteObjectList[numCubesPlaced].positionProperty.value = new Vector2(compareCubeBackCorner.x + xDisplacement.x + zDisplacement.x + yDisplacement.x, compareCubeBackCorner.y + xDisplacement.y + zDisplacement.y + yDisplacement.y);
          numCubesPlaced++;
        }
      }
    }

    // Set the initial size of the continuous object.
    this.updateContinuousObjectSize(this.estimateProperty.value);
  }

  // @public
  newReferenceObject() {
    // Choose a random size that hasn't been chosen for a while.
    let unique = false;
    let referenceObjectSize = null;
    while (!unique) {
      referenceObjectSize = VALID_REF_OBJECT_SIZES[Math.floor(dotRandom.nextDouble() * VALID_REF_OBJECT_SIZES.length)];
      unique = referenceObjectSize !== this.previousReferenceObjectSize && referenceObjectSize !== this.referenceObject.size;
    }
    this.previousReferenceObjectSize = referenceObjectSize;
    this.setReferenceObjectSize(referenceObjectSize);
  }

  // @public
  setInitialReferenceObject() {
    this.setReferenceObjectSize(INITIAL_REFERENCE_OBJECT_SIZE);
  }

  // @public
  updateDiscreteObjectVisibility(selectedMode, estimateValue) {
    const targetNumVisibleDiscreteCubes = selectedMode === 'cubes' && this.continuousOrDiscreteProperty.value === 'discrete' ? estimateValue : 0;
    const startIndex = Math.min(this.numVisibleDiscreteCubes, targetNumVisibleDiscreteCubes);
    const endIndex = Math.max(this.numVisibleDiscreteCubes, targetNumVisibleDiscreteCubes);
    const visibility = targetNumVisibleDiscreteCubes > this.numVisibleDiscreteCubes;
    for (let i = startIndex; i < endIndex && i < MAX_DISCRETE_CUBES; i++) {
      this.discreteObjectList[i].visibleProperty.value = visibility;
    }
    this.numVisibleDiscreteCubes = targetNumVisibleDiscreteCubes;
  }

  // @public
  updateContinuousObjectSize(estimateValue) {
    const hr = this.referenceObject.sizeProperty.value.height;
    const wr = this.referenceObject.sizeProperty.value.width;
    const dr = this.referenceObject.sizeProperty.value.depth;

    // Set the size of the continuous cube
    if (hr === wr && wr === dr) {
      this.continuousSizableObject.sizeProperty.value = new Dimension3(wr * Math.pow(estimateValue, 1 / 3), hr * Math.pow(estimateValue, 1 / 3), dr * Math.pow(estimateValue, 1 / 3));
    } else {
      // Scale each dimension linearly. This isn't used all the time
      // because the size won't quite match the estimate value in cases
      // other than estimate = 1 and estimate = answer, but it is likely
      // close enough that no one will be disturbed by it.
      const hc = this.compareObject.sizeProperty.value.height;
      const wc = this.compareObject.sizeProperty.value.width;
      const dc = this.compareObject.sizeProperty.value.depth;
      const answer = hc * wc * dc / (hr * wr * dr);
      const a = (1 - wc / wr) / (1 - answer) * (estimateValue - 1) + 1;
      const b = (1 - hc / hr) / (1 - answer) * (estimateValue - 1) + 1;
      const c = (1 - dc / dr) / (1 - answer) * (estimateValue - 1) + 1;
      this.continuousSizableObject.sizeProperty.value = new Dimension3(a * wr, b * hr, c * dr);
    }

    // The following hairy calculation is about figuring out where to
    // position the continuous cube so that its back corner is in the same
    // place as that of the comparison cube.
    this.continuousSizableObject.positionProperty.value = this.compareObject.positionProperty.value.plus(new Vector2((this.compareObject.sizeProperty.value.depth - this.continuousSizableObject.sizeProperty.value.depth) * EstimationConstants.DEPTH_PROJECTION_PROPORTION, 0).rotated(EstimationConstants.CUBE_PROJECTION_ANGLE));
  }
}
estimation.register('CubeExplorationMode', CubeExplorationMode);
export default CubeExplorationMode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJWZWN0b3IyIiwiQ29sb3IiLCJFc3RpbWF0aW9uQ29uc3RhbnRzIiwiQ3ViZU1vZGVsIiwiRGltZW5zaW9uMyIsImVzdGltYXRpb24iLCJBYnN0cmFjdEV4cGxvcmF0aW9uTW9kZSIsIk1BWF9ESVNDUkVURV9DVUJFUyIsIk1PREVfTkFNRSIsIkNPTVBBUkVfQ1VCRV9TSVpFIiwiVkFMSURfUkVGX09CSkVDVF9TSVpFUyIsIndpZHRoIiwiaGVpZ2h0IiwiZGVwdGgiLCJJTklUSUFMX1JFRkVSRU5DRV9PQkpFQ1RfU0laRSIsIkN1YmVFeHBsb3JhdGlvbk1vZGUiLCJjb25zdHJ1Y3RvciIsInNlbGVjdGVkTW9kZVByb3BlcnR5IiwiY29tcGFyZUN1YmVQb3NpdGlvbiIsImNvbXBhcmVPYmplY3QiLCJDT01QQVJJU09OX09CSkVDVF9DT0xPUiIsInNldEFscGhhIiwiY29udGludW91c1NpemFibGVPYmplY3QiLCJSRUZFUkVOQ0VfT0JKRUNUX0NPTE9SIiwicmVmZXJlbmNlT2JqZWN0IiwiXyIsInRpbWVzIiwiZGlzY3JldGVPYmplY3RMaXN0IiwicHVzaCIsIlpFUk8iLCJzZXRSZWZlcmVuY2VPYmplY3RTaXplIiwibnVtVmlzaWJsZURpc2NyZXRlQ3ViZXMiLCJob29rVXBWaXNpYmlsaXR5VXBkYXRlcyIsInByZXZpb3VzUmVmZXJlbmNlT2JqZWN0U2l6ZSIsInNpemUiLCJzaXplUHJvcGVydHkiLCJ2YWx1ZSIsImN1YmVzQWNyb3NzIiwiY3ViZXNGcm9udFRvQmFjayIsIm51bUN1YmVzUGxhY2VkIiwiY29tcGFyZUN1YmVCYWNrQ29ybmVyIiwicG9zaXRpb25Qcm9wZXJ0eSIsInBsdXMiLCJERVBUSF9QUk9KRUNUSU9OX1BST1BPUlRJT04iLCJyb3RhdGVkIiwiQ1VCRV9QUk9KRUNUSU9OX0FOR0xFIiwieFVuaXREaXNwbGFjZW1lbnQiLCJ5VW5pdERpc3BsYWNlbWVudCIsInpVbml0RGlzcGxhY2VtZW50IiwieERpc3BsYWNlbWVudCIsInlEaXNwbGFjZW1lbnQiLCJ6RGlzcGxhY2VtZW50IiwieSIsInNldFkiLCJ6Iiwic2V0WFkiLCJ4Iiwic2V0WCIsInVwZGF0ZUNvbnRpbnVvdXNPYmplY3RTaXplIiwiZXN0aW1hdGVQcm9wZXJ0eSIsIm5ld1JlZmVyZW5jZU9iamVjdCIsInVuaXF1ZSIsInJlZmVyZW5jZU9iamVjdFNpemUiLCJNYXRoIiwiZmxvb3IiLCJuZXh0RG91YmxlIiwibGVuZ3RoIiwic2V0SW5pdGlhbFJlZmVyZW5jZU9iamVjdCIsInVwZGF0ZURpc2NyZXRlT2JqZWN0VmlzaWJpbGl0eSIsInNlbGVjdGVkTW9kZSIsImVzdGltYXRlVmFsdWUiLCJ0YXJnZXROdW1WaXNpYmxlRGlzY3JldGVDdWJlcyIsImNvbnRpbnVvdXNPckRpc2NyZXRlUHJvcGVydHkiLCJzdGFydEluZGV4IiwibWluIiwiZW5kSW5kZXgiLCJtYXgiLCJ2aXNpYmlsaXR5IiwiaSIsInZpc2libGVQcm9wZXJ0eSIsImhyIiwid3IiLCJkciIsInBvdyIsImhjIiwid2MiLCJkYyIsImFuc3dlciIsImEiLCJiIiwiYyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQ3ViZUV4cGxvcmF0aW9uTW9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIxLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBEZWZpbml0aW9uIG9mIHRoZSAnY3ViZSBleHBsb3JhdGlvbiBtb2RlJyBmb3IgdGhlIGV4cGxvcmF0aW9uIG1vZGVsLlxyXG4gKi9cclxuXHJcbmltcG9ydCBkb3RSYW5kb20gZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL2RvdFJhbmRvbS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgQ29sb3IgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgRXN0aW1hdGlvbkNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vRXN0aW1hdGlvbkNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBDdWJlTW9kZWwgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL0N1YmVNb2RlbC5qcyc7XHJcbmltcG9ydCBEaW1lbnNpb24zIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9EaW1lbnNpb24zLmpzJztcclxuaW1wb3J0IGVzdGltYXRpb24gZnJvbSAnLi4vLi4vZXN0aW1hdGlvbi5qcyc7XHJcbmltcG9ydCBBYnN0cmFjdEV4cGxvcmF0aW9uTW9kZSBmcm9tICcuL0Fic3RyYWN0RXhwbG9yYXRpb25Nb2RlLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBNQVhfRElTQ1JFVEVfQ1VCRVMgPSAyMDA7XHJcbmNvbnN0IE1PREVfTkFNRSA9ICdjdWJlcyc7XHJcbmNvbnN0IENPTVBBUkVfQ1VCRV9TSVpFID0gbmV3IERpbWVuc2lvbjMoIDEuNzUsIDEuNzUsIDEuNzUgKTtcclxuY29uc3QgVkFMSURfUkVGX09CSkVDVF9TSVpFUyA9IFtcclxuICBuZXcgRGltZW5zaW9uMyggQ09NUEFSRV9DVUJFX1NJWkUud2lkdGggLyA1LCBDT01QQVJFX0NVQkVfU0laRS5oZWlnaHQgLyA1LCBDT01QQVJFX0NVQkVfU0laRS5kZXB0aCAvIDUgKSxcclxuICBuZXcgRGltZW5zaW9uMyggQ09NUEFSRV9DVUJFX1NJWkUud2lkdGggLyA0LCBDT01QQVJFX0NVQkVfU0laRS5oZWlnaHQgLyA0LCBDT01QQVJFX0NVQkVfU0laRS5kZXB0aCAvIDQgKSxcclxuICBuZXcgRGltZW5zaW9uMyggQ09NUEFSRV9DVUJFX1NJWkUud2lkdGggLyAzLCBDT01QQVJFX0NVQkVfU0laRS5oZWlnaHQgLyAzLCBDT01QQVJFX0NVQkVfU0laRS5kZXB0aCAvIDMgKSxcclxuICBuZXcgRGltZW5zaW9uMyggQ09NUEFSRV9DVUJFX1NJWkUud2lkdGggLyAyLCBDT01QQVJFX0NVQkVfU0laRS5oZWlnaHQgLyAyLCBDT01QQVJFX0NVQkVfU0laRS5kZXB0aCAvIDIgKSxcclxuICBuZXcgRGltZW5zaW9uMyggQ09NUEFSRV9DVUJFX1NJWkUud2lkdGggLyAzLCBDT01QQVJFX0NVQkVfU0laRS5oZWlnaHQgLyAyLCBDT01QQVJFX0NVQkVfU0laRS5kZXB0aCAvIDIgKSxcclxuICBuZXcgRGltZW5zaW9uMyggQ09NUEFSRV9DVUJFX1NJWkUud2lkdGggLyA0LCBDT01QQVJFX0NVQkVfU0laRS5oZWlnaHQgLyAyLCBDT01QQVJFX0NVQkVfU0laRS5kZXB0aCAvIDIgKSxcclxuICBuZXcgRGltZW5zaW9uMyggQ09NUEFSRV9DVUJFX1NJWkUud2lkdGggLyAyLCBDT01QQVJFX0NVQkVfU0laRS5oZWlnaHQgLyA0LCBDT01QQVJFX0NVQkVfU0laRS5kZXB0aCAvIDIgKVxyXG5dO1xyXG5jb25zdCBJTklUSUFMX1JFRkVSRU5DRV9PQkpFQ1RfU0laRSA9IFZBTElEX1JFRl9PQkpFQ1RfU0laRVNbIDIgXTtcclxuXHJcbmNsYXNzIEN1YmVFeHBsb3JhdGlvbk1vZGUgZXh0ZW5kcyBBYnN0cmFjdEV4cGxvcmF0aW9uTW9kZSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCBzZWxlY3RlZE1vZGVQcm9wZXJ0eSApIHtcclxuICAgIHN1cGVyKCBzZWxlY3RlZE1vZGVQcm9wZXJ0eSwgTU9ERV9OQU1FICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSByZWZlcmVuY2UsIGNvbXBhcmUsIGNvbnRpbnVvdXMsIGFuZCBkaXNjcmV0ZSBvYmplY3RzLlxyXG4gICAgY29uc3QgY29tcGFyZUN1YmVQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCAwLCAtMC4yICk7XHJcbiAgICB0aGlzLmNvbXBhcmVPYmplY3QgPSBuZXcgQ3ViZU1vZGVsKCBDT01QQVJFX0NVQkVfU0laRSwgY29tcGFyZUN1YmVQb3NpdGlvbiwgbmV3IENvbG9yKCBFc3RpbWF0aW9uQ29uc3RhbnRzLkNPTVBBUklTT05fT0JKRUNUX0NPTE9SICkuc2V0QWxwaGEoIDAuNSApLCBmYWxzZSwgZmFsc2UgKTtcclxuICAgIHRoaXMuY29udGludW91c1NpemFibGVPYmplY3QgPSBuZXcgQ3ViZU1vZGVsKCBuZXcgRGltZW5zaW9uMyggMC4xLCAwLjEsIDAuMSApLCBjb21wYXJlQ3ViZVBvc2l0aW9uLCBFc3RpbWF0aW9uQ29uc3RhbnRzLlJFRkVSRU5DRV9PQkpFQ1RfQ09MT1IsIGZhbHNlLCBmYWxzZSApO1xyXG4gICAgdGhpcy5yZWZlcmVuY2VPYmplY3QgPSBuZXcgQ3ViZU1vZGVsKCBJTklUSUFMX1JFRkVSRU5DRV9PQkpFQ1RfU0laRSwgbmV3IFZlY3RvcjIoIC0yLCAwICksIEVzdGltYXRpb25Db25zdGFudHMuUkVGRVJFTkNFX09CSkVDVF9DT0xPUiwgZmFsc2UsIGZhbHNlICk7XHJcbiAgICBfLnRpbWVzKCBNQVhfRElTQ1JFVEVfQ1VCRVMsICgpID0+IHtcclxuICAgICAgLy8gSW5pdGlhbCBzaXplIGlzIGFyYml0cmFyeSwgd2lsbCBiZSBzaXplZCBhcyBuZWVkZWQuXHJcbiAgICAgIHRoaXMuZGlzY3JldGVPYmplY3RMaXN0LnB1c2goIG5ldyBDdWJlTW9kZWwoIG5ldyBEaW1lbnNpb24zKCAwLjEsIDAuMSwgMC4xICksIFZlY3RvcjIuWkVSTywgRXN0aW1hdGlvbkNvbnN0YW50cy5SRUZFUkVOQ0VfT0JKRUNUX0NPTE9SLCB0cnVlLCBmYWxzZSApICk7XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLnNldFJlZmVyZW5jZU9iamVjdFNpemUoIElOSVRJQUxfUkVGRVJFTkNFX09CSkVDVF9TSVpFICk7XHJcbiAgICB0aGlzLm51bVZpc2libGVEaXNjcmV0ZUN1YmVzID0gMDtcclxuXHJcbiAgICAvLyBDb21wbGV0ZSBpbml0aWFsaXphdGlvbiBieSBob29raW5nIHVwIHZpc2liaWxpdHkgdXBkYXRlcyBpbiB0aGUgcGFyZW50IGNsYXNzLlxyXG4gICAgdGhpcy5ob29rVXBWaXNpYmlsaXR5VXBkYXRlcygpO1xyXG5cclxuICAgIC8vIE1haW50YWluIGEgc2hvcnQgaGlzdG9yeSBvZiByZWZlcmVuY2Ugb2JqZWN0IHNpemVzIHNvIHVuaXF1ZSBvbmVzIGNhbiBiZSBjaG9zZW4uXHJcbiAgICB0aGlzLnByZXZpb3VzUmVmZXJlbmNlT2JqZWN0U2l6ZSA9IElOSVRJQUxfUkVGRVJFTkNFX09CSkVDVF9TSVpFO1xyXG4gIH1cclxuXHJcbiAgLy8gVE9ETzogVmlzaWJpbGl0eSBhbm5vdGF0aW9ucyBzaG91bGQgYmUgY2hlY2tlZCBhbmQgdXBkYXRlZCwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9lc3RpbWF0aW9uL2lzc3Vlcy85XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBzZXRSZWZlcmVuY2VPYmplY3RTaXplKCBzaXplICkge1xyXG4gICAgdGhpcy5yZWZlcmVuY2VPYmplY3Quc2l6ZVByb3BlcnR5LnZhbHVlID0gc2l6ZTtcclxuXHJcbiAgICAvLyBTaXplIGFuZCBwb3NpdGlvbiB0aGUgZGlzY3JldGUgY3ViZXMgYmFzZWQgb24gdGhlIHNpemVzIG9mIHRoZVxyXG4gICAgLy8gcmVmZXJlbmNlIGN1YmUgYW5kIHRoZSBjb21wYXJlIGN1YmUuXHJcbiAgICBjb25zdCBjdWJlc0Fjcm9zcyA9IHRoaXMuY29tcGFyZU9iamVjdC5zaXplUHJvcGVydHkudmFsdWUud2lkdGggLyB0aGlzLnJlZmVyZW5jZU9iamVjdC5zaXplUHJvcGVydHkudmFsdWUud2lkdGg7XHJcbiAgICBjb25zdCBjdWJlc0Zyb250VG9CYWNrID0gdGhpcy5jb21wYXJlT2JqZWN0LnNpemVQcm9wZXJ0eS52YWx1ZS5kZXB0aCAvIHRoaXMucmVmZXJlbmNlT2JqZWN0LnNpemVQcm9wZXJ0eS52YWx1ZS5kZXB0aDtcclxuICAgIGxldCBudW1DdWJlc1BsYWNlZCA9IDA7XHJcbiAgICBjb25zdCBjb21wYXJlQ3ViZUJhY2tDb3JuZXIgPSB0aGlzLmNvbXBhcmVPYmplY3QucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS5wbHVzKCBuZXcgVmVjdG9yMiggKCB0aGlzLmNvbXBhcmVPYmplY3Quc2l6ZVByb3BlcnR5LnZhbHVlLmRlcHRoICkgKiBFc3RpbWF0aW9uQ29uc3RhbnRzLkRFUFRIX1BST0pFQ1RJT05fUFJPUE9SVElPTiwgMCApLnJvdGF0ZWQoIEVzdGltYXRpb25Db25zdGFudHMuQ1VCRV9QUk9KRUNUSU9OX0FOR0xFICkgKTtcclxuICAgIGNvbnN0IHhVbml0RGlzcGxhY2VtZW50ID0gbmV3IFZlY3RvcjIoIHRoaXMucmVmZXJlbmNlT2JqZWN0LnNpemVQcm9wZXJ0eS52YWx1ZS53aWR0aCwgMCApO1xyXG4gICAgY29uc3QgeVVuaXREaXNwbGFjZW1lbnQgPSBuZXcgVmVjdG9yMiggMCwgdGhpcy5yZWZlcmVuY2VPYmplY3Quc2l6ZVByb3BlcnR5LnZhbHVlLmhlaWdodCApO1xyXG4gICAgY29uc3QgelVuaXREaXNwbGFjZW1lbnQgPSBuZXcgVmVjdG9yMiggLXRoaXMucmVmZXJlbmNlT2JqZWN0LnNpemVQcm9wZXJ0eS52YWx1ZS5kZXB0aCAqIEVzdGltYXRpb25Db25zdGFudHMuREVQVEhfUFJPSkVDVElPTl9QUk9QT1JUSU9OLCAwICkucm90YXRlZCggRXN0aW1hdGlvbkNvbnN0YW50cy5DVUJFX1BST0pFQ1RJT05fQU5HTEUgKTtcclxuICAgIGNvbnN0IHhEaXNwbGFjZW1lbnQgPSBuZXcgVmVjdG9yMiggMCwgMCApO1xyXG4gICAgY29uc3QgeURpc3BsYWNlbWVudCA9IG5ldyBWZWN0b3IyKCAwLCAwICk7XHJcbiAgICBjb25zdCB6RGlzcGxhY2VtZW50ID0gbmV3IFZlY3RvcjIoIDAsIDAgKTtcclxuICAgIGZvciAoIGxldCB5ID0gMDsgbnVtQ3ViZXNQbGFjZWQgPCBNQVhfRElTQ1JFVEVfQ1VCRVM7IHkrKyApIHtcclxuICAgICAgeURpc3BsYWNlbWVudC5zZXRZKCB5VW5pdERpc3BsYWNlbWVudC55ICogeSApO1xyXG4gICAgICBmb3IgKCBsZXQgeiA9IDA7IHogPCBjdWJlc0Zyb250VG9CYWNrICYmIG51bUN1YmVzUGxhY2VkIDwgTUFYX0RJU0NSRVRFX0NVQkVTOyB6KysgKSB7XHJcbiAgICAgICAgekRpc3BsYWNlbWVudC5zZXRYWSggelVuaXREaXNwbGFjZW1lbnQueCAqICggeiArIDEgKSwgelVuaXREaXNwbGFjZW1lbnQueSAqICggeiArIDEgKSApO1xyXG4gICAgICAgIGZvciAoIGxldCB4ID0gMDsgeCA8IGN1YmVzQWNyb3NzICYmIG51bUN1YmVzUGxhY2VkIDwgTUFYX0RJU0NSRVRFX0NVQkVTOyB4KysgKSB7XHJcbiAgICAgICAgICB0aGlzLmRpc2NyZXRlT2JqZWN0TGlzdFsgbnVtQ3ViZXNQbGFjZWQgXS5zaXplUHJvcGVydHkudmFsdWUgPSB0aGlzLnJlZmVyZW5jZU9iamVjdC5zaXplUHJvcGVydHkudmFsdWU7XHJcbiAgICAgICAgICB4RGlzcGxhY2VtZW50LnNldFgoIHhVbml0RGlzcGxhY2VtZW50LnggKiB4ICk7XHJcbiAgICAgICAgICB0aGlzLmRpc2NyZXRlT2JqZWN0TGlzdFsgbnVtQ3ViZXNQbGFjZWQgXS5wb3NpdGlvblByb3BlcnR5LnZhbHVlID0gbmV3IFZlY3RvcjIoIGNvbXBhcmVDdWJlQmFja0Nvcm5lci54ICsgeERpc3BsYWNlbWVudC54ICsgekRpc3BsYWNlbWVudC54ICsgeURpc3BsYWNlbWVudC54LFxyXG4gICAgICAgICAgICBjb21wYXJlQ3ViZUJhY2tDb3JuZXIueSArIHhEaXNwbGFjZW1lbnQueSArIHpEaXNwbGFjZW1lbnQueSArIHlEaXNwbGFjZW1lbnQueSApO1xyXG4gICAgICAgICAgbnVtQ3ViZXNQbGFjZWQrKztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBTZXQgdGhlIGluaXRpYWwgc2l6ZSBvZiB0aGUgY29udGludW91cyBvYmplY3QuXHJcbiAgICB0aGlzLnVwZGF0ZUNvbnRpbnVvdXNPYmplY3RTaXplKCB0aGlzLmVzdGltYXRlUHJvcGVydHkudmFsdWUgKTtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBuZXdSZWZlcmVuY2VPYmplY3QoKSB7XHJcbiAgICAvLyBDaG9vc2UgYSByYW5kb20gc2l6ZSB0aGF0IGhhc24ndCBiZWVuIGNob3NlbiBmb3IgYSB3aGlsZS5cclxuICAgIGxldCB1bmlxdWUgPSBmYWxzZTtcclxuICAgIGxldCByZWZlcmVuY2VPYmplY3RTaXplID0gbnVsbDtcclxuICAgIHdoaWxlICggIXVuaXF1ZSApIHtcclxuICAgICAgcmVmZXJlbmNlT2JqZWN0U2l6ZSA9IFZBTElEX1JFRl9PQkpFQ1RfU0laRVNbIE1hdGguZmxvb3IoIGRvdFJhbmRvbS5uZXh0RG91YmxlKCkgKiBWQUxJRF9SRUZfT0JKRUNUX1NJWkVTLmxlbmd0aCApIF07XHJcbiAgICAgIHVuaXF1ZSA9ICggcmVmZXJlbmNlT2JqZWN0U2l6ZSAhPT0gdGhpcy5wcmV2aW91c1JlZmVyZW5jZU9iamVjdFNpemUgJiYgcmVmZXJlbmNlT2JqZWN0U2l6ZSAhPT0gdGhpcy5yZWZlcmVuY2VPYmplY3Quc2l6ZSApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5wcmV2aW91c1JlZmVyZW5jZU9iamVjdFNpemUgPSByZWZlcmVuY2VPYmplY3RTaXplO1xyXG4gICAgdGhpcy5zZXRSZWZlcmVuY2VPYmplY3RTaXplKCByZWZlcmVuY2VPYmplY3RTaXplICk7XHJcbiAgfVxyXG5cclxuICAvLyBAcHVibGljXHJcbiAgc2V0SW5pdGlhbFJlZmVyZW5jZU9iamVjdCgpIHtcclxuICAgIHRoaXMuc2V0UmVmZXJlbmNlT2JqZWN0U2l6ZSggSU5JVElBTF9SRUZFUkVOQ0VfT0JKRUNUX1NJWkUgKTtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICB1cGRhdGVEaXNjcmV0ZU9iamVjdFZpc2liaWxpdHkoIHNlbGVjdGVkTW9kZSwgZXN0aW1hdGVWYWx1ZSApIHtcclxuICAgIGNvbnN0IHRhcmdldE51bVZpc2libGVEaXNjcmV0ZUN1YmVzID0gc2VsZWN0ZWRNb2RlID09PSAnY3ViZXMnICYmIHRoaXMuY29udGludW91c09yRGlzY3JldGVQcm9wZXJ0eS52YWx1ZSA9PT0gJ2Rpc2NyZXRlJyA/IGVzdGltYXRlVmFsdWUgOiAwO1xyXG4gICAgY29uc3Qgc3RhcnRJbmRleCA9IE1hdGgubWluKCB0aGlzLm51bVZpc2libGVEaXNjcmV0ZUN1YmVzLCB0YXJnZXROdW1WaXNpYmxlRGlzY3JldGVDdWJlcyApO1xyXG4gICAgY29uc3QgZW5kSW5kZXggPSBNYXRoLm1heCggdGhpcy5udW1WaXNpYmxlRGlzY3JldGVDdWJlcywgdGFyZ2V0TnVtVmlzaWJsZURpc2NyZXRlQ3ViZXMgKTtcclxuICAgIGNvbnN0IHZpc2liaWxpdHkgPSB0YXJnZXROdW1WaXNpYmxlRGlzY3JldGVDdWJlcyA+IHRoaXMubnVtVmlzaWJsZURpc2NyZXRlQ3ViZXM7XHJcbiAgICBmb3IgKCBsZXQgaSA9IHN0YXJ0SW5kZXg7IGkgPCBlbmRJbmRleCAmJiBpIDwgTUFYX0RJU0NSRVRFX0NVQkVTOyBpKysgKSB7XHJcbiAgICAgIHRoaXMuZGlzY3JldGVPYmplY3RMaXN0WyBpIF0udmlzaWJsZVByb3BlcnR5LnZhbHVlID0gdmlzaWJpbGl0eTtcclxuICAgIH1cclxuICAgIHRoaXMubnVtVmlzaWJsZURpc2NyZXRlQ3ViZXMgPSB0YXJnZXROdW1WaXNpYmxlRGlzY3JldGVDdWJlcztcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICB1cGRhdGVDb250aW51b3VzT2JqZWN0U2l6ZSggZXN0aW1hdGVWYWx1ZSApIHtcclxuXHJcbiAgICBjb25zdCBociA9IHRoaXMucmVmZXJlbmNlT2JqZWN0LnNpemVQcm9wZXJ0eS52YWx1ZS5oZWlnaHQ7XHJcbiAgICBjb25zdCB3ciA9IHRoaXMucmVmZXJlbmNlT2JqZWN0LnNpemVQcm9wZXJ0eS52YWx1ZS53aWR0aDtcclxuICAgIGNvbnN0IGRyID0gdGhpcy5yZWZlcmVuY2VPYmplY3Quc2l6ZVByb3BlcnR5LnZhbHVlLmRlcHRoO1xyXG5cclxuICAgIC8vIFNldCB0aGUgc2l6ZSBvZiB0aGUgY29udGludW91cyBjdWJlXHJcbiAgICBpZiAoIGhyID09PSB3ciAmJiB3ciA9PT0gZHIgKSB7XHJcbiAgICAgIHRoaXMuY29udGludW91c1NpemFibGVPYmplY3Quc2l6ZVByb3BlcnR5LnZhbHVlID0gbmV3IERpbWVuc2lvbjMoXHJcbiAgICAgICAgd3IgKiBNYXRoLnBvdyggZXN0aW1hdGVWYWx1ZSwgMSAvIDMgKSxcclxuICAgICAgICBociAqIE1hdGgucG93KCBlc3RpbWF0ZVZhbHVlLCAxIC8gMyApLFxyXG4gICAgICAgIGRyICogTWF0aC5wb3coIGVzdGltYXRlVmFsdWUsIDEgLyAzICkgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAvLyBTY2FsZSBlYWNoIGRpbWVuc2lvbiBsaW5lYXJseS4gVGhpcyBpc24ndCB1c2VkIGFsbCB0aGUgdGltZVxyXG4gICAgICAvLyBiZWNhdXNlIHRoZSBzaXplIHdvbid0IHF1aXRlIG1hdGNoIHRoZSBlc3RpbWF0ZSB2YWx1ZSBpbiBjYXNlc1xyXG4gICAgICAvLyBvdGhlciB0aGFuIGVzdGltYXRlID0gMSBhbmQgZXN0aW1hdGUgPSBhbnN3ZXIsIGJ1dCBpdCBpcyBsaWtlbHlcclxuICAgICAgLy8gY2xvc2UgZW5vdWdoIHRoYXQgbm8gb25lIHdpbGwgYmUgZGlzdHVyYmVkIGJ5IGl0LlxyXG4gICAgICBjb25zdCBoYyA9IHRoaXMuY29tcGFyZU9iamVjdC5zaXplUHJvcGVydHkudmFsdWUuaGVpZ2h0O1xyXG4gICAgICBjb25zdCB3YyA9IHRoaXMuY29tcGFyZU9iamVjdC5zaXplUHJvcGVydHkudmFsdWUud2lkdGg7XHJcbiAgICAgIGNvbnN0IGRjID0gdGhpcy5jb21wYXJlT2JqZWN0LnNpemVQcm9wZXJ0eS52YWx1ZS5kZXB0aDtcclxuICAgICAgY29uc3QgYW5zd2VyID0gaGMgKiB3YyAqIGRjIC8gKCBociAqIHdyICogZHIgKTtcclxuICAgICAgY29uc3QgYSA9ICggKCAxIC0gd2MgLyB3ciApIC8gKCAxIC0gYW5zd2VyICkgKSAqICggZXN0aW1hdGVWYWx1ZSAtIDEgKSArIDE7XHJcbiAgICAgIGNvbnN0IGIgPSAoICggMSAtIGhjIC8gaHIgKSAvICggMSAtIGFuc3dlciApICkgKiAoIGVzdGltYXRlVmFsdWUgLSAxICkgKyAxO1xyXG4gICAgICBjb25zdCBjID0gKCAoIDEgLSBkYyAvIGRyICkgLyAoIDEgLSBhbnN3ZXIgKSApICogKCBlc3RpbWF0ZVZhbHVlIC0gMSApICsgMTtcclxuICAgICAgdGhpcy5jb250aW51b3VzU2l6YWJsZU9iamVjdC5zaXplUHJvcGVydHkudmFsdWUgPSBuZXcgRGltZW5zaW9uMyggYSAqIHdyLCBiICogaHIsIGMgKiBkciApO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvLyBUaGUgZm9sbG93aW5nIGhhaXJ5IGNhbGN1bGF0aW9uIGlzIGFib3V0IGZpZ3VyaW5nIG91dCB3aGVyZSB0b1xyXG4gICAgLy8gcG9zaXRpb24gdGhlIGNvbnRpbnVvdXMgY3ViZSBzbyB0aGF0IGl0cyBiYWNrIGNvcm5lciBpcyBpbiB0aGUgc2FtZVxyXG4gICAgLy8gcGxhY2UgYXMgdGhhdCBvZiB0aGUgY29tcGFyaXNvbiBjdWJlLlxyXG4gICAgdGhpcy5jb250aW51b3VzU2l6YWJsZU9iamVjdC5wb3NpdGlvblByb3BlcnR5LnZhbHVlID0gdGhpcy5jb21wYXJlT2JqZWN0LnBvc2l0aW9uUHJvcGVydHkudmFsdWUucGx1cyhcclxuICAgICAgbmV3IFZlY3RvcjIoICggdGhpcy5jb21wYXJlT2JqZWN0LnNpemVQcm9wZXJ0eS52YWx1ZS5kZXB0aCAtIHRoaXMuY29udGludW91c1NpemFibGVPYmplY3Quc2l6ZVByb3BlcnR5LnZhbHVlLmRlcHRoICkgKiBFc3RpbWF0aW9uQ29uc3RhbnRzLkRFUFRIX1BST0pFQ1RJT05fUFJPUE9SVElPTixcclxuICAgICAgICAwICkucm90YXRlZCggRXN0aW1hdGlvbkNvbnN0YW50cy5DVUJFX1BST0pFQ1RJT05fQU5HTEUgKSApO1xyXG4gIH1cclxufVxyXG5cclxuZXN0aW1hdGlvbi5yZWdpc3RlciggJ0N1YmVFeHBsb3JhdGlvbk1vZGUnLCBDdWJlRXhwbG9yYXRpb25Nb2RlICk7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