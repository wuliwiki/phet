// Copyright 2016-2022, University of Colorado Boulder

/**
 * This type represents an expression in the view, which basically looks like a rectangle with two or more coin terms
 * in it and plus signs between them.
 *
 * Note that this works in conjunction with ExpressionOverlayNode to implement the view-oriented behaviors of the
 * expressions so, if you don't find what you're looking for here, you may want to check that type.
 *
 * @author John Blanco
 */

import Multilink from '../../../../axon/js/Multilink.js';
import Matrix3 from '../../../../dot/js/Matrix3.js';
import { Shape } from '../../../../kite/js/imports.js';
import MathSymbols from '../../../../scenery-phet/js/MathSymbols.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Node, Path, Text } from '../../../../scenery/js/imports.js';
import expressionExchange from '../../expressionExchange.js';
import EESharedConstants from '../EESharedConstants.js';

// constants
const BACKGROUND_COLOR = EESharedConstants.EXPRESSION_BACKGROUND_COLOR;
const NUM_ZIG_ZAGS = 5;
const ZIG_ZAG_AMPLITUDE = 2; // in screen coordinates, empirically determined
const HINT_OFFSET = 3; // in screen coordinates, empirically determined
const LEFT_HINT_TRANSLATION = Matrix3.translation(-HINT_OFFSET, 0);
const RIGHT_HINT_TRANSLATION = Matrix3.translation(HINT_OFFSET, 0);
const OPERATOR_FONT = new PhetFont(32);
class ExpressionNode extends Node {
  /**
   * @param {Expression} expression - model of an expression
   * @param {Property.<boolean>} simplifyNegativesProperty - controls whether to depict minus signs
   */
  constructor(expression, simplifyNegativesProperty) {
    super({
      pickable: false
    });
    const self = this;

    // shape and path used to define and display the background
    const backgroundPath = new Path(null, {
      fill: BACKGROUND_COLOR,
      lineWidth: 5
    });
    this.addChild(backgroundPath);

    // left and right 'hints' that are used to indicate to the user that a coin term can be added
    const leftHintNode = new Path(null, {
      fill: BACKGROUND_COLOR
    });
    this.addChild(leftHintNode);
    const rightHintNode = new Path(null, {
      fill: BACKGROUND_COLOR
    });
    this.addChild(rightHintNode);

    // layer where the plus and/or minus symbols go
    const operatorsLayer = new Node();
    this.addChild(operatorsLayer);

    // function to update the background and the plus/minus symbols
    function updateBackgroundAndSymbols() {
      // symbols are recreated each time to keep things simple
      operatorsLayer.removeAllChildren();
      if (expression.coinTerms.length > 0) {
        const coinTermsLeftToRight = expression.coinTerms.slice().sort((ct1, ct2) => ct1.destinationProperty.get().x - ct2.destinationProperty.get().x);
        const backgroundShape = new Shape();
        backgroundShape.moveTo(0, 0);
        backgroundShape.lineTo(expression.widthProperty.get(), 0);
        const expressionWidth = expression.widthProperty.get();
        const expressionHeight = expression.heightProperty.get();

        // if the hint is active, the edge is zig zagged
        if (expression.rightHintActiveProperty.get()) {
          backgroundShape.zigZagTo(expressionWidth, expressionHeight, ZIG_ZAG_AMPLITUDE, NUM_ZIG_ZAGS, false);
        } else {
          backgroundShape.lineTo(expressionWidth, expressionHeight);
        }
        backgroundShape.lineTo(0, expressionHeight);

        // zig zag on left side if hint is active
        if (expression.leftHintActiveProperty.get()) {
          backgroundShape.zigZagTo(0, 0, ZIG_ZAG_AMPLITUDE, NUM_ZIG_ZAGS, false);
        } else {
          backgroundShape.lineTo(0, 0);
        }
        backgroundShape.close();
        backgroundPath.visible = true;
        backgroundPath.shape = null;
        backgroundPath.shape = backgroundShape;

        // add the operators
        for (let i = 0; i < coinTermsLeftToRight.length - 1; i++) {
          // determine whether to show a plus sign or a minus sign
          let symbolText;
          if (simplifyNegativesProperty.value && coinTermsLeftToRight[i + 1].totalCountProperty.get() < 0 && !coinTermsLeftToRight[i + 1].userControlledProperty.get()) {
            symbolText = MathSymbols.MINUS;
          } else {
            symbolText = MathSymbols.PLUS;
          }

          // add the operator
          const operator = new Text(symbolText, {
            font: OPERATOR_FONT,
            scale: expression.scaleProperty.get(),
            centerX: (coinTermsLeftToRight[i].destinationProperty.get().x + coinTermsLeftToRight[i].localViewBoundsProperty.get().maxX + coinTermsLeftToRight[i + 1].destinationProperty.get().x + coinTermsLeftToRight[i + 1].localViewBoundsProperty.get().minX) / 2 - expression.upperLeftCornerProperty.get().x,
            centerY: expressionHeight / 2
          });
          operatorsLayer.addChild(operator);
        }
      } else {
        // no terms in this expression, so no background should be shown
        backgroundPath.visible = false;
      }
    }

    // update the appearance if the layout changes
    expression.layoutChangedEmitter.addListener(updateBackgroundAndSymbols);

    // make the background invisible whenever this expression is in a collection area
    expression.collectedProperty.link(collected => {
      backgroundPath.fill = collected ? 'transparent' : BACKGROUND_COLOR;
    });

    // update the shape when hint states of the expression change
    const updateBackgroundAndSymbolsMultilink = Multilink.multilink([expression.leftHintActiveProperty, expression.rightHintActiveProperty, simplifyNegativesProperty], updateBackgroundAndSymbols);

    // update the position when the expression moves
    function updatePosition(upperLeftCorner) {
      self.translation = upperLeftCorner;
    }
    expression.upperLeftCornerProperty.link(updatePosition);

    // update the visibility of the left and right hints
    const leftHintHandle = visible => {
      leftHintNode.visible = visible;
    };
    const rightHintHandle = visible => {
      rightHintNode.visible = visible;
    };
    expression.leftHintActiveProperty.link(leftHintHandle);
    expression.rightHintActiveProperty.link(rightHintHandle);

    // turn the halo on and off based on the associated property
    function activateCombineHint(combineHintActive) {
      backgroundPath.stroke = combineHintActive ? 'yellow' : null;
    }
    expression.combineHaloActiveProperty.link(activateCombineHint);

    // update the shape of the left hint
    const leftHintMultilink = Multilink.multilink([expression.heightProperty, expression.widthProperty, expression.leftHintWidthProperty], (expressionHeight, expressionWidth, hintWidth) => {
      let leftHintShape = new Shape().moveTo(-hintWidth, 0).lineTo(0, 0);
      leftHintShape.zigZagTo(0, expressionHeight, ZIG_ZAG_AMPLITUDE, NUM_ZIG_ZAGS, false);
      leftHintShape.lineTo(-hintWidth, expressionHeight).close();
      leftHintShape = leftHintShape.transformed(LEFT_HINT_TRANSLATION);
      leftHintNode.shape = leftHintShape;
    });

    // update the shape of the right hint
    const rightHintMultilink = Multilink.multilink([expression.heightProperty, expression.widthProperty, expression.rightHintWidthProperty], (expressionHeight, expressionWidth, hintWidth) => {
      let rightHintShape = new Shape().moveTo(expressionWidth, 0);
      rightHintShape.zigZagTo(expressionWidth, expressionHeight, ZIG_ZAG_AMPLITUDE, NUM_ZIG_ZAGS, false);
      rightHintShape.lineTo(expressionWidth + hintWidth, expressionHeight).lineTo(expressionWidth + hintWidth, 0).close();
      rightHintShape = rightHintShape.transformed(RIGHT_HINT_TRANSLATION);
      rightHintNode.shape = rightHintShape;
    });

    // create a dispose function
    this.disposeExpressionNode = () => {
      expression.layoutChangedEmitter.removeListener(updateBackgroundAndSymbols);
      updateBackgroundAndSymbolsMultilink.dispose();
      expression.upperLeftCornerProperty.unlink(updatePosition);
      expression.leftHintActiveProperty.unlink(leftHintHandle);
      expression.rightHintActiveProperty.unlink(rightHintHandle);
      expression.combineHaloActiveProperty.unlink(activateCombineHint);
      leftHintMultilink.dispose();
      rightHintMultilink.dispose();
    };

    // do the initial update
    updateBackgroundAndSymbols();
  }

  // @public
  dispose() {
    this.disposeExpressionNode();
    super.dispose();
  }
}
expressionExchange.register('ExpressionNode', ExpressionNode);
export default ExpressionNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJNYXRyaXgzIiwiU2hhcGUiLCJNYXRoU3ltYm9scyIsIlBoZXRGb250IiwiTm9kZSIsIlBhdGgiLCJUZXh0IiwiZXhwcmVzc2lvbkV4Y2hhbmdlIiwiRUVTaGFyZWRDb25zdGFudHMiLCJCQUNLR1JPVU5EX0NPTE9SIiwiRVhQUkVTU0lPTl9CQUNLR1JPVU5EX0NPTE9SIiwiTlVNX1pJR19aQUdTIiwiWklHX1pBR19BTVBMSVRVREUiLCJISU5UX09GRlNFVCIsIkxFRlRfSElOVF9UUkFOU0xBVElPTiIsInRyYW5zbGF0aW9uIiwiUklHSFRfSElOVF9UUkFOU0xBVElPTiIsIk9QRVJBVE9SX0ZPTlQiLCJFeHByZXNzaW9uTm9kZSIsImNvbnN0cnVjdG9yIiwiZXhwcmVzc2lvbiIsInNpbXBsaWZ5TmVnYXRpdmVzUHJvcGVydHkiLCJwaWNrYWJsZSIsInNlbGYiLCJiYWNrZ3JvdW5kUGF0aCIsImZpbGwiLCJsaW5lV2lkdGgiLCJhZGRDaGlsZCIsImxlZnRIaW50Tm9kZSIsInJpZ2h0SGludE5vZGUiLCJvcGVyYXRvcnNMYXllciIsInVwZGF0ZUJhY2tncm91bmRBbmRTeW1ib2xzIiwicmVtb3ZlQWxsQ2hpbGRyZW4iLCJjb2luVGVybXMiLCJsZW5ndGgiLCJjb2luVGVybXNMZWZ0VG9SaWdodCIsInNsaWNlIiwic29ydCIsImN0MSIsImN0MiIsImRlc3RpbmF0aW9uUHJvcGVydHkiLCJnZXQiLCJ4IiwiYmFja2dyb3VuZFNoYXBlIiwibW92ZVRvIiwibGluZVRvIiwid2lkdGhQcm9wZXJ0eSIsImV4cHJlc3Npb25XaWR0aCIsImV4cHJlc3Npb25IZWlnaHQiLCJoZWlnaHRQcm9wZXJ0eSIsInJpZ2h0SGludEFjdGl2ZVByb3BlcnR5IiwiemlnWmFnVG8iLCJsZWZ0SGludEFjdGl2ZVByb3BlcnR5IiwiY2xvc2UiLCJ2aXNpYmxlIiwic2hhcGUiLCJpIiwic3ltYm9sVGV4dCIsInZhbHVlIiwidG90YWxDb3VudFByb3BlcnR5IiwidXNlckNvbnRyb2xsZWRQcm9wZXJ0eSIsIk1JTlVTIiwiUExVUyIsIm9wZXJhdG9yIiwiZm9udCIsInNjYWxlIiwic2NhbGVQcm9wZXJ0eSIsImNlbnRlclgiLCJsb2NhbFZpZXdCb3VuZHNQcm9wZXJ0eSIsIm1heFgiLCJtaW5YIiwidXBwZXJMZWZ0Q29ybmVyUHJvcGVydHkiLCJjZW50ZXJZIiwibGF5b3V0Q2hhbmdlZEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImNvbGxlY3RlZFByb3BlcnR5IiwibGluayIsImNvbGxlY3RlZCIsInVwZGF0ZUJhY2tncm91bmRBbmRTeW1ib2xzTXVsdGlsaW5rIiwibXVsdGlsaW5rIiwidXBkYXRlUG9zaXRpb24iLCJ1cHBlckxlZnRDb3JuZXIiLCJsZWZ0SGludEhhbmRsZSIsInJpZ2h0SGludEhhbmRsZSIsImFjdGl2YXRlQ29tYmluZUhpbnQiLCJjb21iaW5lSGludEFjdGl2ZSIsInN0cm9rZSIsImNvbWJpbmVIYWxvQWN0aXZlUHJvcGVydHkiLCJsZWZ0SGludE11bHRpbGluayIsImxlZnRIaW50V2lkdGhQcm9wZXJ0eSIsImhpbnRXaWR0aCIsImxlZnRIaW50U2hhcGUiLCJ0cmFuc2Zvcm1lZCIsInJpZ2h0SGludE11bHRpbGluayIsInJpZ2h0SGludFdpZHRoUHJvcGVydHkiLCJyaWdodEhpbnRTaGFwZSIsImRpc3Bvc2VFeHByZXNzaW9uTm9kZSIsInJlbW92ZUxpc3RlbmVyIiwiZGlzcG9zZSIsInVubGluayIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRXhwcmVzc2lvbk5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhpcyB0eXBlIHJlcHJlc2VudHMgYW4gZXhwcmVzc2lvbiBpbiB0aGUgdmlldywgd2hpY2ggYmFzaWNhbGx5IGxvb2tzIGxpa2UgYSByZWN0YW5nbGUgd2l0aCB0d28gb3IgbW9yZSBjb2luIHRlcm1zXHJcbiAqIGluIGl0IGFuZCBwbHVzIHNpZ25zIGJldHdlZW4gdGhlbS5cclxuICpcclxuICogTm90ZSB0aGF0IHRoaXMgd29ya3MgaW4gY29uanVuY3Rpb24gd2l0aCBFeHByZXNzaW9uT3ZlcmxheU5vZGUgdG8gaW1wbGVtZW50IHRoZSB2aWV3LW9yaWVudGVkIGJlaGF2aW9ycyBvZiB0aGVcclxuICogZXhwcmVzc2lvbnMgc28sIGlmIHlvdSBkb24ndCBmaW5kIHdoYXQgeW91J3JlIGxvb2tpbmcgZm9yIGhlcmUsIHlvdSBtYXkgd2FudCB0byBjaGVjayB0aGF0IHR5cGUuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICovXHJcblxyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IE1hdHJpeDMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL01hdHJpeDMuanMnO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBNYXRoU3ltYm9scyBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvTWF0aFN5bWJvbHMuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgTm9kZSwgUGF0aCwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBleHByZXNzaW9uRXhjaGFuZ2UgZnJvbSAnLi4vLi4vZXhwcmVzc2lvbkV4Y2hhbmdlLmpzJztcclxuaW1wb3J0IEVFU2hhcmVkQ29uc3RhbnRzIGZyb20gJy4uL0VFU2hhcmVkQ29uc3RhbnRzLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBCQUNLR1JPVU5EX0NPTE9SID0gRUVTaGFyZWRDb25zdGFudHMuRVhQUkVTU0lPTl9CQUNLR1JPVU5EX0NPTE9SO1xyXG5jb25zdCBOVU1fWklHX1pBR1MgPSA1O1xyXG5jb25zdCBaSUdfWkFHX0FNUExJVFVERSA9IDI7IC8vIGluIHNjcmVlbiBjb29yZGluYXRlcywgZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG5jb25zdCBISU5UX09GRlNFVCA9IDM7IC8vIGluIHNjcmVlbiBjb29yZGluYXRlcywgZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG5jb25zdCBMRUZUX0hJTlRfVFJBTlNMQVRJT04gPSBNYXRyaXgzLnRyYW5zbGF0aW9uKCAtSElOVF9PRkZTRVQsIDAgKTtcclxuY29uc3QgUklHSFRfSElOVF9UUkFOU0xBVElPTiA9IE1hdHJpeDMudHJhbnNsYXRpb24oIEhJTlRfT0ZGU0VULCAwICk7XHJcbmNvbnN0IE9QRVJBVE9SX0ZPTlQgPSBuZXcgUGhldEZvbnQoIDMyICk7XHJcblxyXG5jbGFzcyBFeHByZXNzaW9uTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0V4cHJlc3Npb259IGV4cHJlc3Npb24gLSBtb2RlbCBvZiBhbiBleHByZXNzaW9uXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IHNpbXBsaWZ5TmVnYXRpdmVzUHJvcGVydHkgLSBjb250cm9scyB3aGV0aGVyIHRvIGRlcGljdCBtaW51cyBzaWduc1xyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBleHByZXNzaW9uLCBzaW1wbGlmeU5lZ2F0aXZlc1Byb3BlcnR5ICkge1xyXG5cclxuICAgIHN1cGVyKCB7IHBpY2thYmxlOiBmYWxzZSB9ICk7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAvLyBzaGFwZSBhbmQgcGF0aCB1c2VkIHRvIGRlZmluZSBhbmQgZGlzcGxheSB0aGUgYmFja2dyb3VuZFxyXG4gICAgY29uc3QgYmFja2dyb3VuZFBhdGggPSBuZXcgUGF0aCggbnVsbCwgeyBmaWxsOiBCQUNLR1JPVU5EX0NPTE9SLCBsaW5lV2lkdGg6IDUgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggYmFja2dyb3VuZFBhdGggKTtcclxuXHJcbiAgICAvLyBsZWZ0IGFuZCByaWdodCAnaGludHMnIHRoYXQgYXJlIHVzZWQgdG8gaW5kaWNhdGUgdG8gdGhlIHVzZXIgdGhhdCBhIGNvaW4gdGVybSBjYW4gYmUgYWRkZWRcclxuICAgIGNvbnN0IGxlZnRIaW50Tm9kZSA9IG5ldyBQYXRoKCBudWxsLCB7IGZpbGw6IEJBQ0tHUk9VTkRfQ09MT1IgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbGVmdEhpbnROb2RlICk7XHJcblxyXG4gICAgY29uc3QgcmlnaHRIaW50Tm9kZSA9IG5ldyBQYXRoKCBudWxsLCB7IGZpbGw6IEJBQ0tHUk9VTkRfQ09MT1IgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggcmlnaHRIaW50Tm9kZSApO1xyXG5cclxuICAgIC8vIGxheWVyIHdoZXJlIHRoZSBwbHVzIGFuZC9vciBtaW51cyBzeW1ib2xzIGdvXHJcbiAgICBjb25zdCBvcGVyYXRvcnNMYXllciA9IG5ldyBOb2RlKCk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBvcGVyYXRvcnNMYXllciApO1xyXG5cclxuICAgIC8vIGZ1bmN0aW9uIHRvIHVwZGF0ZSB0aGUgYmFja2dyb3VuZCBhbmQgdGhlIHBsdXMvbWludXMgc3ltYm9sc1xyXG4gICAgZnVuY3Rpb24gdXBkYXRlQmFja2dyb3VuZEFuZFN5bWJvbHMoKSB7XHJcblxyXG4gICAgICAvLyBzeW1ib2xzIGFyZSByZWNyZWF0ZWQgZWFjaCB0aW1lIHRvIGtlZXAgdGhpbmdzIHNpbXBsZVxyXG4gICAgICBvcGVyYXRvcnNMYXllci5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG5cclxuICAgICAgaWYgKCBleHByZXNzaW9uLmNvaW5UZXJtcy5sZW5ndGggPiAwICkge1xyXG5cclxuICAgICAgICBjb25zdCBjb2luVGVybXNMZWZ0VG9SaWdodCA9IGV4cHJlc3Npb24uY29pblRlcm1zLnNsaWNlKCkuc29ydCggKCBjdDEsIGN0MiApID0+IGN0MS5kZXN0aW5hdGlvblByb3BlcnR5LmdldCgpLnggLSBjdDIuZGVzdGluYXRpb25Qcm9wZXJ0eS5nZXQoKS54ICk7XHJcblxyXG4gICAgICAgIGNvbnN0IGJhY2tncm91bmRTaGFwZSA9IG5ldyBTaGFwZSgpO1xyXG4gICAgICAgIGJhY2tncm91bmRTaGFwZS5tb3ZlVG8oIDAsIDAgKTtcclxuICAgICAgICBiYWNrZ3JvdW5kU2hhcGUubGluZVRvKCBleHByZXNzaW9uLndpZHRoUHJvcGVydHkuZ2V0KCksIDAgKTtcclxuICAgICAgICBjb25zdCBleHByZXNzaW9uV2lkdGggPSBleHByZXNzaW9uLndpZHRoUHJvcGVydHkuZ2V0KCk7XHJcbiAgICAgICAgY29uc3QgZXhwcmVzc2lvbkhlaWdodCA9IGV4cHJlc3Npb24uaGVpZ2h0UHJvcGVydHkuZ2V0KCk7XHJcblxyXG4gICAgICAgIC8vIGlmIHRoZSBoaW50IGlzIGFjdGl2ZSwgdGhlIGVkZ2UgaXMgemlnIHphZ2dlZFxyXG4gICAgICAgIGlmICggZXhwcmVzc2lvbi5yaWdodEhpbnRBY3RpdmVQcm9wZXJ0eS5nZXQoKSApIHtcclxuICAgICAgICAgIGJhY2tncm91bmRTaGFwZS56aWdaYWdUbyggZXhwcmVzc2lvbldpZHRoLCBleHByZXNzaW9uSGVpZ2h0LCBaSUdfWkFHX0FNUExJVFVERSwgTlVNX1pJR19aQUdTLCBmYWxzZSApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGJhY2tncm91bmRTaGFwZS5saW5lVG8oIGV4cHJlc3Npb25XaWR0aCwgZXhwcmVzc2lvbkhlaWdodCApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBiYWNrZ3JvdW5kU2hhcGUubGluZVRvKCAwLCBleHByZXNzaW9uSGVpZ2h0ICk7XHJcblxyXG4gICAgICAgIC8vIHppZyB6YWcgb24gbGVmdCBzaWRlIGlmIGhpbnQgaXMgYWN0aXZlXHJcbiAgICAgICAgaWYgKCBleHByZXNzaW9uLmxlZnRIaW50QWN0aXZlUHJvcGVydHkuZ2V0KCkgKSB7XHJcbiAgICAgICAgICBiYWNrZ3JvdW5kU2hhcGUuemlnWmFnVG8oIDAsIDAsIFpJR19aQUdfQU1QTElUVURFLCBOVU1fWklHX1pBR1MsIGZhbHNlICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgYmFja2dyb3VuZFNoYXBlLmxpbmVUbyggMCwgMCApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYmFja2dyb3VuZFNoYXBlLmNsb3NlKCk7XHJcbiAgICAgICAgYmFja2dyb3VuZFBhdGgudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgYmFja2dyb3VuZFBhdGguc2hhcGUgPSBudWxsO1xyXG4gICAgICAgIGJhY2tncm91bmRQYXRoLnNoYXBlID0gYmFja2dyb3VuZFNoYXBlO1xyXG5cclxuICAgICAgICAvLyBhZGQgdGhlIG9wZXJhdG9yc1xyXG4gICAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGNvaW5UZXJtc0xlZnRUb1JpZ2h0Lmxlbmd0aCAtIDE7IGkrKyApIHtcclxuXHJcbiAgICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB0byBzaG93IGEgcGx1cyBzaWduIG9yIGEgbWludXMgc2lnblxyXG4gICAgICAgICAgbGV0IHN5bWJvbFRleHQ7XHJcbiAgICAgICAgICBpZiAoIHNpbXBsaWZ5TmVnYXRpdmVzUHJvcGVydHkudmFsdWUgJiZcclxuICAgICAgICAgICAgICAgY29pblRlcm1zTGVmdFRvUmlnaHRbIGkgKyAxIF0udG90YWxDb3VudFByb3BlcnR5LmdldCgpIDwgMCAmJiAhY29pblRlcm1zTGVmdFRvUmlnaHRbIGkgKyAxIF0udXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5nZXQoKSApIHtcclxuICAgICAgICAgICAgc3ltYm9sVGV4dCA9IE1hdGhTeW1ib2xzLk1JTlVTO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHN5bWJvbFRleHQgPSBNYXRoU3ltYm9scy5QTFVTO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIGFkZCB0aGUgb3BlcmF0b3JcclxuICAgICAgICAgIGNvbnN0IG9wZXJhdG9yID0gbmV3IFRleHQoIHN5bWJvbFRleHQsIHtcclxuICAgICAgICAgICAgZm9udDogT1BFUkFUT1JfRk9OVCxcclxuICAgICAgICAgICAgc2NhbGU6IGV4cHJlc3Npb24uc2NhbGVQcm9wZXJ0eS5nZXQoKSxcclxuICAgICAgICAgICAgY2VudGVyWDogKCBjb2luVGVybXNMZWZ0VG9SaWdodFsgaSBdLmRlc3RpbmF0aW9uUHJvcGVydHkuZ2V0KCkueCArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgY29pblRlcm1zTGVmdFRvUmlnaHRbIGkgXS5sb2NhbFZpZXdCb3VuZHNQcm9wZXJ0eS5nZXQoKS5tYXhYICtcclxuICAgICAgICAgICAgICAgICAgICAgICBjb2luVGVybXNMZWZ0VG9SaWdodFsgaSArIDEgXS5kZXN0aW5hdGlvblByb3BlcnR5LmdldCgpLnggK1xyXG4gICAgICAgICAgICAgICAgICAgICAgIGNvaW5UZXJtc0xlZnRUb1JpZ2h0WyBpICsgMSBdLmxvY2FsVmlld0JvdW5kc1Byb3BlcnR5LmdldCgpLm1pblggKSAvIDIgLVxyXG4gICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uLnVwcGVyTGVmdENvcm5lclByb3BlcnR5LmdldCgpLngsXHJcbiAgICAgICAgICAgIGNlbnRlclk6IGV4cHJlc3Npb25IZWlnaHQgLyAyXHJcbiAgICAgICAgICB9ICk7XHJcbiAgICAgICAgICBvcGVyYXRvcnNMYXllci5hZGRDaGlsZCggb3BlcmF0b3IgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgLy8gbm8gdGVybXMgaW4gdGhpcyBleHByZXNzaW9uLCBzbyBubyBiYWNrZ3JvdW5kIHNob3VsZCBiZSBzaG93blxyXG4gICAgICAgIGJhY2tncm91bmRQYXRoLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIHVwZGF0ZSB0aGUgYXBwZWFyYW5jZSBpZiB0aGUgbGF5b3V0IGNoYW5nZXNcclxuICAgIGV4cHJlc3Npb24ubGF5b3V0Q2hhbmdlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIHVwZGF0ZUJhY2tncm91bmRBbmRTeW1ib2xzICk7XHJcblxyXG4gICAgLy8gbWFrZSB0aGUgYmFja2dyb3VuZCBpbnZpc2libGUgd2hlbmV2ZXIgdGhpcyBleHByZXNzaW9uIGlzIGluIGEgY29sbGVjdGlvbiBhcmVhXHJcbiAgICBleHByZXNzaW9uLmNvbGxlY3RlZFByb3BlcnR5LmxpbmsoIGNvbGxlY3RlZCA9PiB7XHJcbiAgICAgIGJhY2tncm91bmRQYXRoLmZpbGwgPSBjb2xsZWN0ZWQgPyAndHJhbnNwYXJlbnQnIDogQkFDS0dST1VORF9DT0xPUjtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB1cGRhdGUgdGhlIHNoYXBlIHdoZW4gaGludCBzdGF0ZXMgb2YgdGhlIGV4cHJlc3Npb24gY2hhbmdlXHJcbiAgICBjb25zdCB1cGRhdGVCYWNrZ3JvdW5kQW5kU3ltYm9sc011bHRpbGluayA9IE11bHRpbGluay5tdWx0aWxpbmsoXHJcbiAgICAgIFsgZXhwcmVzc2lvbi5sZWZ0SGludEFjdGl2ZVByb3BlcnR5LCBleHByZXNzaW9uLnJpZ2h0SGludEFjdGl2ZVByb3BlcnR5LCBzaW1wbGlmeU5lZ2F0aXZlc1Byb3BlcnR5IF0sXHJcbiAgICAgIHVwZGF0ZUJhY2tncm91bmRBbmRTeW1ib2xzXHJcbiAgICApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSB0aGUgcG9zaXRpb24gd2hlbiB0aGUgZXhwcmVzc2lvbiBtb3Zlc1xyXG4gICAgZnVuY3Rpb24gdXBkYXRlUG9zaXRpb24oIHVwcGVyTGVmdENvcm5lciApIHtcclxuICAgICAgc2VsZi50cmFuc2xhdGlvbiA9IHVwcGVyTGVmdENvcm5lcjtcclxuICAgIH1cclxuXHJcbiAgICBleHByZXNzaW9uLnVwcGVyTGVmdENvcm5lclByb3BlcnR5LmxpbmsoIHVwZGF0ZVBvc2l0aW9uICk7XHJcblxyXG4gICAgLy8gdXBkYXRlIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBsZWZ0IGFuZCByaWdodCBoaW50c1xyXG4gICAgY29uc3QgbGVmdEhpbnRIYW5kbGUgPSB2aXNpYmxlID0+IHtsZWZ0SGludE5vZGUudmlzaWJsZSA9IHZpc2libGU7fTtcclxuICAgIGNvbnN0IHJpZ2h0SGludEhhbmRsZSA9IHZpc2libGUgPT4ge3JpZ2h0SGludE5vZGUudmlzaWJsZSA9IHZpc2libGU7fTtcclxuICAgIGV4cHJlc3Npb24ubGVmdEhpbnRBY3RpdmVQcm9wZXJ0eS5saW5rKCBsZWZ0SGludEhhbmRsZSApO1xyXG4gICAgZXhwcmVzc2lvbi5yaWdodEhpbnRBY3RpdmVQcm9wZXJ0eS5saW5rKCByaWdodEhpbnRIYW5kbGUgKTtcclxuXHJcbiAgICAvLyB0dXJuIHRoZSBoYWxvIG9uIGFuZCBvZmYgYmFzZWQgb24gdGhlIGFzc29jaWF0ZWQgcHJvcGVydHlcclxuICAgIGZ1bmN0aW9uIGFjdGl2YXRlQ29tYmluZUhpbnQoIGNvbWJpbmVIaW50QWN0aXZlICkge1xyXG4gICAgICBiYWNrZ3JvdW5kUGF0aC5zdHJva2UgPSBjb21iaW5lSGludEFjdGl2ZSA/ICd5ZWxsb3cnIDogbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBleHByZXNzaW9uLmNvbWJpbmVIYWxvQWN0aXZlUHJvcGVydHkubGluayggYWN0aXZhdGVDb21iaW5lSGludCApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSB0aGUgc2hhcGUgb2YgdGhlIGxlZnQgaGludFxyXG4gICAgY29uc3QgbGVmdEhpbnRNdWx0aWxpbmsgPSBNdWx0aWxpbmsubXVsdGlsaW5rKFxyXG4gICAgICBbIGV4cHJlc3Npb24uaGVpZ2h0UHJvcGVydHksIGV4cHJlc3Npb24ud2lkdGhQcm9wZXJ0eSwgZXhwcmVzc2lvbi5sZWZ0SGludFdpZHRoUHJvcGVydHkgXSxcclxuICAgICAgKCBleHByZXNzaW9uSGVpZ2h0LCBleHByZXNzaW9uV2lkdGgsIGhpbnRXaWR0aCApID0+IHtcclxuICAgICAgICBsZXQgbGVmdEhpbnRTaGFwZSA9IG5ldyBTaGFwZSgpXHJcbiAgICAgICAgICAubW92ZVRvKCAtaGludFdpZHRoLCAwIClcclxuICAgICAgICAgIC5saW5lVG8oIDAsIDAgKTtcclxuICAgICAgICBsZWZ0SGludFNoYXBlLnppZ1phZ1RvKCAwLCBleHByZXNzaW9uSGVpZ2h0LCBaSUdfWkFHX0FNUExJVFVERSwgTlVNX1pJR19aQUdTLCBmYWxzZSApO1xyXG4gICAgICAgIGxlZnRIaW50U2hhcGVcclxuICAgICAgICAgIC5saW5lVG8oIC1oaW50V2lkdGgsIGV4cHJlc3Npb25IZWlnaHQgKVxyXG4gICAgICAgICAgLmNsb3NlKCk7XHJcbiAgICAgICAgbGVmdEhpbnRTaGFwZSA9IGxlZnRIaW50U2hhcGUudHJhbnNmb3JtZWQoIExFRlRfSElOVF9UUkFOU0xBVElPTiApO1xyXG4gICAgICAgIGxlZnRIaW50Tm9kZS5zaGFwZSA9IGxlZnRIaW50U2hhcGU7XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgLy8gdXBkYXRlIHRoZSBzaGFwZSBvZiB0aGUgcmlnaHQgaGludFxyXG4gICAgY29uc3QgcmlnaHRIaW50TXVsdGlsaW5rID0gTXVsdGlsaW5rLm11bHRpbGluayhcclxuICAgICAgWyBleHByZXNzaW9uLmhlaWdodFByb3BlcnR5LCBleHByZXNzaW9uLndpZHRoUHJvcGVydHksIGV4cHJlc3Npb24ucmlnaHRIaW50V2lkdGhQcm9wZXJ0eSBdLFxyXG4gICAgICAoIGV4cHJlc3Npb25IZWlnaHQsIGV4cHJlc3Npb25XaWR0aCwgaGludFdpZHRoICkgPT4ge1xyXG4gICAgICAgIGxldCByaWdodEhpbnRTaGFwZSA9IG5ldyBTaGFwZSgpLm1vdmVUbyggZXhwcmVzc2lvbldpZHRoLCAwICk7XHJcbiAgICAgICAgcmlnaHRIaW50U2hhcGUuemlnWmFnVG8oIGV4cHJlc3Npb25XaWR0aCwgZXhwcmVzc2lvbkhlaWdodCwgWklHX1pBR19BTVBMSVRVREUsIE5VTV9aSUdfWkFHUywgZmFsc2UgKTtcclxuICAgICAgICByaWdodEhpbnRTaGFwZVxyXG4gICAgICAgICAgLmxpbmVUbyggZXhwcmVzc2lvbldpZHRoICsgaGludFdpZHRoLCBleHByZXNzaW9uSGVpZ2h0IClcclxuICAgICAgICAgIC5saW5lVG8oIGV4cHJlc3Npb25XaWR0aCArIGhpbnRXaWR0aCwgMCApXHJcbiAgICAgICAgICAuY2xvc2UoKTtcclxuICAgICAgICByaWdodEhpbnRTaGFwZSA9IHJpZ2h0SGludFNoYXBlLnRyYW5zZm9ybWVkKCBSSUdIVF9ISU5UX1RSQU5TTEFUSU9OICk7XHJcbiAgICAgICAgcmlnaHRIaW50Tm9kZS5zaGFwZSA9IHJpZ2h0SGludFNoYXBlO1xyXG4gICAgICB9XHJcbiAgICApO1xyXG5cclxuICAgIC8vIGNyZWF0ZSBhIGRpc3Bvc2UgZnVuY3Rpb25cclxuICAgIHRoaXMuZGlzcG9zZUV4cHJlc3Npb25Ob2RlID0gKCkgPT4ge1xyXG4gICAgICBleHByZXNzaW9uLmxheW91dENoYW5nZWRFbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCB1cGRhdGVCYWNrZ3JvdW5kQW5kU3ltYm9scyApO1xyXG4gICAgICB1cGRhdGVCYWNrZ3JvdW5kQW5kU3ltYm9sc011bHRpbGluay5kaXNwb3NlKCk7XHJcbiAgICAgIGV4cHJlc3Npb24udXBwZXJMZWZ0Q29ybmVyUHJvcGVydHkudW5saW5rKCB1cGRhdGVQb3NpdGlvbiApO1xyXG4gICAgICBleHByZXNzaW9uLmxlZnRIaW50QWN0aXZlUHJvcGVydHkudW5saW5rKCBsZWZ0SGludEhhbmRsZSApO1xyXG4gICAgICBleHByZXNzaW9uLnJpZ2h0SGludEFjdGl2ZVByb3BlcnR5LnVubGluayggcmlnaHRIaW50SGFuZGxlICk7XHJcbiAgICAgIGV4cHJlc3Npb24uY29tYmluZUhhbG9BY3RpdmVQcm9wZXJ0eS51bmxpbmsoIGFjdGl2YXRlQ29tYmluZUhpbnQgKTtcclxuICAgICAgbGVmdEhpbnRNdWx0aWxpbmsuZGlzcG9zZSgpO1xyXG4gICAgICByaWdodEhpbnRNdWx0aWxpbmsuZGlzcG9zZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBkbyB0aGUgaW5pdGlhbCB1cGRhdGVcclxuICAgIHVwZGF0ZUJhY2tncm91bmRBbmRTeW1ib2xzKCk7XHJcbiAgfVxyXG5cclxuICAvLyBAcHVibGljXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIHRoaXMuZGlzcG9zZUV4cHJlc3Npb25Ob2RlKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5leHByZXNzaW9uRXhjaGFuZ2UucmVnaXN0ZXIoICdFeHByZXNzaW9uTm9kZScsIEV4cHJlc3Npb25Ob2RlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBFeHByZXNzaW9uTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxTQUFTLE1BQU0sa0NBQWtDO0FBQ3hELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsU0FBU0MsS0FBSyxRQUFRLGdDQUFnQztBQUN0RCxPQUFPQyxXQUFXLE1BQU0sNENBQTRDO0FBQ3BFLE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsU0FBU0MsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDcEUsT0FBT0Msa0JBQWtCLE1BQU0sNkJBQTZCO0FBQzVELE9BQU9DLGlCQUFpQixNQUFNLHlCQUF5Qjs7QUFFdkQ7QUFDQSxNQUFNQyxnQkFBZ0IsR0FBR0QsaUJBQWlCLENBQUNFLDJCQUEyQjtBQUN0RSxNQUFNQyxZQUFZLEdBQUcsQ0FBQztBQUN0QixNQUFNQyxpQkFBaUIsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUM3QixNQUFNQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDdkIsTUFBTUMscUJBQXFCLEdBQUdkLE9BQU8sQ0FBQ2UsV0FBVyxDQUFFLENBQUNGLFdBQVcsRUFBRSxDQUFFLENBQUM7QUFDcEUsTUFBTUcsc0JBQXNCLEdBQUdoQixPQUFPLENBQUNlLFdBQVcsQ0FBRUYsV0FBVyxFQUFFLENBQUUsQ0FBQztBQUNwRSxNQUFNSSxhQUFhLEdBQUcsSUFBSWQsUUFBUSxDQUFFLEVBQUcsQ0FBQztBQUV4QyxNQUFNZSxjQUFjLFNBQVNkLElBQUksQ0FBQztFQUVoQztBQUNGO0FBQ0E7QUFDQTtFQUNFZSxXQUFXQSxDQUFFQyxVQUFVLEVBQUVDLHlCQUF5QixFQUFHO0lBRW5ELEtBQUssQ0FBRTtNQUFFQyxRQUFRLEVBQUU7SUFBTSxDQUFFLENBQUM7SUFDNUIsTUFBTUMsSUFBSSxHQUFHLElBQUk7O0lBRWpCO0lBQ0EsTUFBTUMsY0FBYyxHQUFHLElBQUluQixJQUFJLENBQUUsSUFBSSxFQUFFO01BQUVvQixJQUFJLEVBQUVoQixnQkFBZ0I7TUFBRWlCLFNBQVMsRUFBRTtJQUFFLENBQUUsQ0FBQztJQUNqRixJQUFJLENBQUNDLFFBQVEsQ0FBRUgsY0FBZSxDQUFDOztJQUUvQjtJQUNBLE1BQU1JLFlBQVksR0FBRyxJQUFJdkIsSUFBSSxDQUFFLElBQUksRUFBRTtNQUFFb0IsSUFBSSxFQUFFaEI7SUFBaUIsQ0FBRSxDQUFDO0lBQ2pFLElBQUksQ0FBQ2tCLFFBQVEsQ0FBRUMsWUFBYSxDQUFDO0lBRTdCLE1BQU1DLGFBQWEsR0FBRyxJQUFJeEIsSUFBSSxDQUFFLElBQUksRUFBRTtNQUFFb0IsSUFBSSxFQUFFaEI7SUFBaUIsQ0FBRSxDQUFDO0lBQ2xFLElBQUksQ0FBQ2tCLFFBQVEsQ0FBRUUsYUFBYyxDQUFDOztJQUU5QjtJQUNBLE1BQU1DLGNBQWMsR0FBRyxJQUFJMUIsSUFBSSxDQUFDLENBQUM7SUFDakMsSUFBSSxDQUFDdUIsUUFBUSxDQUFFRyxjQUFlLENBQUM7O0lBRS9CO0lBQ0EsU0FBU0MsMEJBQTBCQSxDQUFBLEVBQUc7TUFFcEM7TUFDQUQsY0FBYyxDQUFDRSxpQkFBaUIsQ0FBQyxDQUFDO01BRWxDLElBQUtaLFVBQVUsQ0FBQ2EsU0FBUyxDQUFDQyxNQUFNLEdBQUcsQ0FBQyxFQUFHO1FBRXJDLE1BQU1DLG9CQUFvQixHQUFHZixVQUFVLENBQUNhLFNBQVMsQ0FBQ0csS0FBSyxDQUFDLENBQUMsQ0FBQ0MsSUFBSSxDQUFFLENBQUVDLEdBQUcsRUFBRUMsR0FBRyxLQUFNRCxHQUFHLENBQUNFLG1CQUFtQixDQUFDQyxHQUFHLENBQUMsQ0FBQyxDQUFDQyxDQUFDLEdBQUdILEdBQUcsQ0FBQ0MsbUJBQW1CLENBQUNDLEdBQUcsQ0FBQyxDQUFDLENBQUNDLENBQUUsQ0FBQztRQUVuSixNQUFNQyxlQUFlLEdBQUcsSUFBSTFDLEtBQUssQ0FBQyxDQUFDO1FBQ25DMEMsZUFBZSxDQUFDQyxNQUFNLENBQUUsQ0FBQyxFQUFFLENBQUUsQ0FBQztRQUM5QkQsZUFBZSxDQUFDRSxNQUFNLENBQUV6QixVQUFVLENBQUMwQixhQUFhLENBQUNMLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBRSxDQUFDO1FBQzNELE1BQU1NLGVBQWUsR0FBRzNCLFVBQVUsQ0FBQzBCLGFBQWEsQ0FBQ0wsR0FBRyxDQUFDLENBQUM7UUFDdEQsTUFBTU8sZ0JBQWdCLEdBQUc1QixVQUFVLENBQUM2QixjQUFjLENBQUNSLEdBQUcsQ0FBQyxDQUFDOztRQUV4RDtRQUNBLElBQUtyQixVQUFVLENBQUM4Qix1QkFBdUIsQ0FBQ1QsR0FBRyxDQUFDLENBQUMsRUFBRztVQUM5Q0UsZUFBZSxDQUFDUSxRQUFRLENBQUVKLGVBQWUsRUFBRUMsZ0JBQWdCLEVBQUVwQyxpQkFBaUIsRUFBRUQsWUFBWSxFQUFFLEtBQU0sQ0FBQztRQUN2RyxDQUFDLE1BQ0k7VUFDSGdDLGVBQWUsQ0FBQ0UsTUFBTSxDQUFFRSxlQUFlLEVBQUVDLGdCQUFpQixDQUFDO1FBQzdEO1FBQ0FMLGVBQWUsQ0FBQ0UsTUFBTSxDQUFFLENBQUMsRUFBRUcsZ0JBQWlCLENBQUM7O1FBRTdDO1FBQ0EsSUFBSzVCLFVBQVUsQ0FBQ2dDLHNCQUFzQixDQUFDWCxHQUFHLENBQUMsQ0FBQyxFQUFHO1VBQzdDRSxlQUFlLENBQUNRLFFBQVEsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFdkMsaUJBQWlCLEVBQUVELFlBQVksRUFBRSxLQUFNLENBQUM7UUFDMUUsQ0FBQyxNQUNJO1VBQ0hnQyxlQUFlLENBQUNFLE1BQU0sQ0FBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDO1FBQ2hDO1FBRUFGLGVBQWUsQ0FBQ1UsS0FBSyxDQUFDLENBQUM7UUFDdkI3QixjQUFjLENBQUM4QixPQUFPLEdBQUcsSUFBSTtRQUM3QjlCLGNBQWMsQ0FBQytCLEtBQUssR0FBRyxJQUFJO1FBQzNCL0IsY0FBYyxDQUFDK0IsS0FBSyxHQUFHWixlQUFlOztRQUV0QztRQUNBLEtBQU0sSUFBSWEsQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHckIsb0JBQW9CLENBQUNELE1BQU0sR0FBRyxDQUFDLEVBQUVzQixDQUFDLEVBQUUsRUFBRztVQUUxRDtVQUNBLElBQUlDLFVBQVU7VUFDZCxJQUFLcEMseUJBQXlCLENBQUNxQyxLQUFLLElBQy9CdkIsb0JBQW9CLENBQUVxQixDQUFDLEdBQUcsQ0FBQyxDQUFFLENBQUNHLGtCQUFrQixDQUFDbEIsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQ04sb0JBQW9CLENBQUVxQixDQUFDLEdBQUcsQ0FBQyxDQUFFLENBQUNJLHNCQUFzQixDQUFDbkIsR0FBRyxDQUFDLENBQUMsRUFBRztZQUMvSGdCLFVBQVUsR0FBR3ZELFdBQVcsQ0FBQzJELEtBQUs7VUFDaEMsQ0FBQyxNQUNJO1lBQ0hKLFVBQVUsR0FBR3ZELFdBQVcsQ0FBQzRELElBQUk7VUFDL0I7O1VBRUE7VUFDQSxNQUFNQyxRQUFRLEdBQUcsSUFBSXpELElBQUksQ0FBRW1ELFVBQVUsRUFBRTtZQUNyQ08sSUFBSSxFQUFFL0MsYUFBYTtZQUNuQmdELEtBQUssRUFBRTdDLFVBQVUsQ0FBQzhDLGFBQWEsQ0FBQ3pCLEdBQUcsQ0FBQyxDQUFDO1lBQ3JDMEIsT0FBTyxFQUFFLENBQUVoQyxvQkFBb0IsQ0FBRXFCLENBQUMsQ0FBRSxDQUFDaEIsbUJBQW1CLENBQUNDLEdBQUcsQ0FBQyxDQUFDLENBQUNDLENBQUMsR0FDckRQLG9CQUFvQixDQUFFcUIsQ0FBQyxDQUFFLENBQUNZLHVCQUF1QixDQUFDM0IsR0FBRyxDQUFDLENBQUMsQ0FBQzRCLElBQUksR0FDNURsQyxvQkFBb0IsQ0FBRXFCLENBQUMsR0FBRyxDQUFDLENBQUUsQ0FBQ2hCLG1CQUFtQixDQUFDQyxHQUFHLENBQUMsQ0FBQyxDQUFDQyxDQUFDLEdBQ3pEUCxvQkFBb0IsQ0FBRXFCLENBQUMsR0FBRyxDQUFDLENBQUUsQ0FBQ1ksdUJBQXVCLENBQUMzQixHQUFHLENBQUMsQ0FBQyxDQUFDNkIsSUFBSSxJQUFLLENBQUMsR0FDeEVsRCxVQUFVLENBQUNtRCx1QkFBdUIsQ0FBQzlCLEdBQUcsQ0FBQyxDQUFDLENBQUNDLENBQUM7WUFDbkQ4QixPQUFPLEVBQUV4QixnQkFBZ0IsR0FBRztVQUM5QixDQUFFLENBQUM7VUFDSGxCLGNBQWMsQ0FBQ0gsUUFBUSxDQUFFb0MsUUFBUyxDQUFDO1FBQ3JDO01BQ0YsQ0FBQyxNQUNJO1FBQ0g7UUFDQXZDLGNBQWMsQ0FBQzhCLE9BQU8sR0FBRyxLQUFLO01BQ2hDO0lBQ0Y7O0lBRUE7SUFDQWxDLFVBQVUsQ0FBQ3FELG9CQUFvQixDQUFDQyxXQUFXLENBQUUzQywwQkFBMkIsQ0FBQzs7SUFFekU7SUFDQVgsVUFBVSxDQUFDdUQsaUJBQWlCLENBQUNDLElBQUksQ0FBRUMsU0FBUyxJQUFJO01BQzlDckQsY0FBYyxDQUFDQyxJQUFJLEdBQUdvRCxTQUFTLEdBQUcsYUFBYSxHQUFHcEUsZ0JBQWdCO0lBQ3BFLENBQUUsQ0FBQzs7SUFFSDtJQUNBLE1BQU1xRSxtQ0FBbUMsR0FBRy9FLFNBQVMsQ0FBQ2dGLFNBQVMsQ0FDN0QsQ0FBRTNELFVBQVUsQ0FBQ2dDLHNCQUFzQixFQUFFaEMsVUFBVSxDQUFDOEIsdUJBQXVCLEVBQUU3Qix5QkFBeUIsQ0FBRSxFQUNwR1UsMEJBQ0YsQ0FBQzs7SUFFRDtJQUNBLFNBQVNpRCxjQUFjQSxDQUFFQyxlQUFlLEVBQUc7TUFDekMxRCxJQUFJLENBQUNSLFdBQVcsR0FBR2tFLGVBQWU7SUFDcEM7SUFFQTdELFVBQVUsQ0FBQ21ELHVCQUF1QixDQUFDSyxJQUFJLENBQUVJLGNBQWUsQ0FBQzs7SUFFekQ7SUFDQSxNQUFNRSxjQUFjLEdBQUc1QixPQUFPLElBQUk7TUFBQzFCLFlBQVksQ0FBQzBCLE9BQU8sR0FBR0EsT0FBTztJQUFDLENBQUM7SUFDbkUsTUFBTTZCLGVBQWUsR0FBRzdCLE9BQU8sSUFBSTtNQUFDekIsYUFBYSxDQUFDeUIsT0FBTyxHQUFHQSxPQUFPO0lBQUMsQ0FBQztJQUNyRWxDLFVBQVUsQ0FBQ2dDLHNCQUFzQixDQUFDd0IsSUFBSSxDQUFFTSxjQUFlLENBQUM7SUFDeEQ5RCxVQUFVLENBQUM4Qix1QkFBdUIsQ0FBQzBCLElBQUksQ0FBRU8sZUFBZ0IsQ0FBQzs7SUFFMUQ7SUFDQSxTQUFTQyxtQkFBbUJBLENBQUVDLGlCQUFpQixFQUFHO01BQ2hEN0QsY0FBYyxDQUFDOEQsTUFBTSxHQUFHRCxpQkFBaUIsR0FBRyxRQUFRLEdBQUcsSUFBSTtJQUM3RDtJQUVBakUsVUFBVSxDQUFDbUUseUJBQXlCLENBQUNYLElBQUksQ0FBRVEsbUJBQW9CLENBQUM7O0lBRWhFO0lBQ0EsTUFBTUksaUJBQWlCLEdBQUd6RixTQUFTLENBQUNnRixTQUFTLENBQzNDLENBQUUzRCxVQUFVLENBQUM2QixjQUFjLEVBQUU3QixVQUFVLENBQUMwQixhQUFhLEVBQUUxQixVQUFVLENBQUNxRSxxQkFBcUIsQ0FBRSxFQUN6RixDQUFFekMsZ0JBQWdCLEVBQUVELGVBQWUsRUFBRTJDLFNBQVMsS0FBTTtNQUNsRCxJQUFJQyxhQUFhLEdBQUcsSUFBSTFGLEtBQUssQ0FBQyxDQUFDLENBQzVCMkMsTUFBTSxDQUFFLENBQUM4QyxTQUFTLEVBQUUsQ0FBRSxDQUFDLENBQ3ZCN0MsTUFBTSxDQUFFLENBQUMsRUFBRSxDQUFFLENBQUM7TUFDakI4QyxhQUFhLENBQUN4QyxRQUFRLENBQUUsQ0FBQyxFQUFFSCxnQkFBZ0IsRUFBRXBDLGlCQUFpQixFQUFFRCxZQUFZLEVBQUUsS0FBTSxDQUFDO01BQ3JGZ0YsYUFBYSxDQUNWOUMsTUFBTSxDQUFFLENBQUM2QyxTQUFTLEVBQUUxQyxnQkFBaUIsQ0FBQyxDQUN0Q0ssS0FBSyxDQUFDLENBQUM7TUFDVnNDLGFBQWEsR0FBR0EsYUFBYSxDQUFDQyxXQUFXLENBQUU5RSxxQkFBc0IsQ0FBQztNQUNsRWMsWUFBWSxDQUFDMkIsS0FBSyxHQUFHb0MsYUFBYTtJQUNwQyxDQUNGLENBQUM7O0lBRUQ7SUFDQSxNQUFNRSxrQkFBa0IsR0FBRzlGLFNBQVMsQ0FBQ2dGLFNBQVMsQ0FDNUMsQ0FBRTNELFVBQVUsQ0FBQzZCLGNBQWMsRUFBRTdCLFVBQVUsQ0FBQzBCLGFBQWEsRUFBRTFCLFVBQVUsQ0FBQzBFLHNCQUFzQixDQUFFLEVBQzFGLENBQUU5QyxnQkFBZ0IsRUFBRUQsZUFBZSxFQUFFMkMsU0FBUyxLQUFNO01BQ2xELElBQUlLLGNBQWMsR0FBRyxJQUFJOUYsS0FBSyxDQUFDLENBQUMsQ0FBQzJDLE1BQU0sQ0FBRUcsZUFBZSxFQUFFLENBQUUsQ0FBQztNQUM3RGdELGNBQWMsQ0FBQzVDLFFBQVEsQ0FBRUosZUFBZSxFQUFFQyxnQkFBZ0IsRUFBRXBDLGlCQUFpQixFQUFFRCxZQUFZLEVBQUUsS0FBTSxDQUFDO01BQ3BHb0YsY0FBYyxDQUNYbEQsTUFBTSxDQUFFRSxlQUFlLEdBQUcyQyxTQUFTLEVBQUUxQyxnQkFBaUIsQ0FBQyxDQUN2REgsTUFBTSxDQUFFRSxlQUFlLEdBQUcyQyxTQUFTLEVBQUUsQ0FBRSxDQUFDLENBQ3hDckMsS0FBSyxDQUFDLENBQUM7TUFDVjBDLGNBQWMsR0FBR0EsY0FBYyxDQUFDSCxXQUFXLENBQUU1RSxzQkFBdUIsQ0FBQztNQUNyRWEsYUFBYSxDQUFDMEIsS0FBSyxHQUFHd0MsY0FBYztJQUN0QyxDQUNGLENBQUM7O0lBRUQ7SUFDQSxJQUFJLENBQUNDLHFCQUFxQixHQUFHLE1BQU07TUFDakM1RSxVQUFVLENBQUNxRCxvQkFBb0IsQ0FBQ3dCLGNBQWMsQ0FBRWxFLDBCQUEyQixDQUFDO01BQzVFK0MsbUNBQW1DLENBQUNvQixPQUFPLENBQUMsQ0FBQztNQUM3QzlFLFVBQVUsQ0FBQ21ELHVCQUF1QixDQUFDNEIsTUFBTSxDQUFFbkIsY0FBZSxDQUFDO01BQzNENUQsVUFBVSxDQUFDZ0Msc0JBQXNCLENBQUMrQyxNQUFNLENBQUVqQixjQUFlLENBQUM7TUFDMUQ5RCxVQUFVLENBQUM4Qix1QkFBdUIsQ0FBQ2lELE1BQU0sQ0FBRWhCLGVBQWdCLENBQUM7TUFDNUQvRCxVQUFVLENBQUNtRSx5QkFBeUIsQ0FBQ1ksTUFBTSxDQUFFZixtQkFBb0IsQ0FBQztNQUNsRUksaUJBQWlCLENBQUNVLE9BQU8sQ0FBQyxDQUFDO01BQzNCTCxrQkFBa0IsQ0FBQ0ssT0FBTyxDQUFDLENBQUM7SUFDOUIsQ0FBQzs7SUFFRDtJQUNBbkUsMEJBQTBCLENBQUMsQ0FBQztFQUM5Qjs7RUFFQTtFQUNBbUUsT0FBT0EsQ0FBQSxFQUFHO0lBQ1IsSUFBSSxDQUFDRixxQkFBcUIsQ0FBQyxDQUFDO0lBQzVCLEtBQUssQ0FBQ0UsT0FBTyxDQUFDLENBQUM7RUFDakI7QUFDRjtBQUVBM0Ysa0JBQWtCLENBQUM2RixRQUFRLENBQUUsZ0JBQWdCLEVBQUVsRixjQUFlLENBQUM7QUFFL0QsZUFBZUEsY0FBYyJ9