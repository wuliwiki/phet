// Copyright 2015-2021, University of Colorado Boulder

/**
 * Main model for Trig Tour Sim
 *
 * @author Michael Dubson (PhET)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Utils from '../../../../dot/js/Utils.js';
import trigTour from '../../trigTour.js';
import SpecialAngles from '../SpecialAngles.js';

// constants
const MAX_SMALL_ANGLE_LIMIT = 0.5 * Math.PI;
const MAX_ANGLE_LIMIT = 50 * Math.PI + MAX_SMALL_ANGLE_LIMIT; // must be ( integer+0.5) number of full rotations

class TrigTourModel {
  constructor() {
    // @public {Property.<Number>} total (full) angle in radians, can be greater than 2*pi, or less than -2*pi
    this.fullAngleProperty = new NumberProperty(0);

    // @public {Property.<boolean>} indicates singularity in tan function at theta = +/- 90 degrees
    // true if fullAngle is close to +/-90 degrees
    this.singularityProperty = new BooleanProperty(false);

    // @public {Property.<boolean>} (read-only) true if user exceeds maximum allowed angle
    this.maxAngleExceededProperty = new BooleanProperty(false);
    this.smallAngle = 0; // @private, fullAngle modulo 2*pi with 180 offset, is between -pi and +pi
    this.previousAngle = 0; // @private, smallAngle in previous step, needed to compute total fullAngle from smallAngle
    this.rotationNumberFromPi = 0; //@private, number of turns around the unit circle, incremented at +/-180 deg,
    //needed to compute fullAngle from smallAngle
    this.fullTurnCount = 0; // @public, number of turns around unit circle, incremented at fullAngle = 0 deg
    this.halfTurnCount = 0; // @public, number of half turns around unit circle, incremented at smallAngle = 0 and 180
  }

  /**
   * Resets the properties of the model
   * @public
   */
  reset() {
    this.fullAngleProperty.reset();
    this.singularityProperty.reset();
    this.maxAngleExceededProperty.reset();
  }

  /**
   * Returns cos of the total model fullAngle in radians.
   * @public
   *
   * @returns {number}
   */
  cos() {
    return Math.cos(this.fullAngleProperty.value);
  }

  /**
   * Returns sin of the total model fullAngle in radians.
   * @public
   *
   * @returns {number}
   */
  sin() {
    return Math.sin(this.fullAngleProperty.value);
  }

  /**
   * Returns tangent of current model fullAngle in radians. When near +/-90 degrees, cuts off tan value at +/- maxValue.
   * Must cut off value at +/- maxValue or else Safari Browser won't display properly.
   * @public
   *
   * @returns {number}
   */
  tan() {
    const tanValue = Math.tan(this.fullAngleProperty.value);
    const maxValue = 350;
    this.singularityProperty.value = false;
    let returnValue;
    if (tanValue > maxValue) {
      returnValue = maxValue;
      this.singularityProperty.value = true;
    } else if (tanValue < -maxValue) {
      returnValue = -maxValue;
      this.singularityProperty.value = true;
    } else {
      returnValue = tanValue;
    }
    return returnValue;
  }

  /**
   * Get the current model fullAngle in radians.
   * @public
   *
   * @returns {number}
   */
  getFullAngleInRadians() {
    return this.fullAngleProperty.value;
  }

  /**
   * Get the current model fullAngle in degrees.
   * @public
   *
   * @returns {number}
   */
  getFullAngleInDegrees() {
    return Utils.toDegrees(this.fullAngleProperty.value);
  }

  /**
   * Returns the small angle in radians, between -pi and +pi
   * @public
   *
   * @returns {number}
   */
  getSmallAngleInRadians() {
    return this.smallAngle;
  }

  /**
   * Return the small angle in degrees between -180 and +180.
   * @public
   *
   * @returns {number}
   */
  getSmallAngleInDegrees() {
    return Utils.toDegrees(this.smallAngle);
  }

  /**
   * Convenience function, return the small angle in degrees bound by 0 to +360
   * @public
   *
   * @returns {number}
   */
  getSmallAngle0To360() {
    if (this.smallAngle > 0) {
      return Utils.toDegrees(this.smallAngle);
    } else {
      return 360 + Utils.toDegrees(this.smallAngle);
    }
  }

  /**
   * Set the full angle, and the associated small angle and various turn counts.
   * @public
   *
   * @param {number} fullAngleInRads - requested new angle
   */
  setFullAngleInRadians(fullAngleInRads) {
    let remainderAngle = fullAngleInRads % (2 * Math.PI);
    this.fullTurnCount = Utils.roundSymmetric((fullAngleInRads - remainderAngle) / (2 * Math.PI));
    if (Math.abs(remainderAngle) <= Math.PI) {
      this.rotationNumberFromPi = this.fullTurnCount;
    } else {
      if (fullAngleInRads > 0) {
        this.rotationNumberFromPi = this.fullTurnCount + 1;
      } else {
        this.rotationNumberFromPi = this.fullTurnCount - 1;
      }
    }
    this.smallAngle = fullAngleInRads - this.rotationNumberFromPi * 2 * Math.PI;
    remainderAngle = fullAngleInRads % Math.PI;
    this.halfTurnCount = Utils.roundSymmetric((fullAngleInRads - remainderAngle) / Math.PI);
    this.fullAngleProperty.value = fullAngleInRads;
  }

  /**
   * Set the full angle and its associated small angle and turn counts from a desired small angle.
   * @public
   *
   * @param {number} smallAngle
   */
  setFullAngleWithSmallAngle(smallAngle) {
    this.smallAngle = smallAngle;

    // must be less than (180-30)deg in order to handle special angle correctly
    const comparisonAngle = Utils.toRadians(149);
    if (this.smallAngle < 0 && this.previousAngle > comparisonAngle) {
      this.rotationNumberFromPi += 1;
    } else if (this.smallAngle > 0 && this.previousAngle < -comparisonAngle) {
      this.rotationNumberFromPi -= 1;
    }

    // don't want to trigger angle update yet
    let targetAngle = this.rotationNumberFromPi * 2 * Math.PI + this.smallAngle;

    // round to nearest half-degree; to do this, must convert to degrees and then back to rads
    let roundedTargetAngle = Utils.toDegrees(targetAngle);
    const deltaDeg = 0.5;
    const roundFactor = Utils.roundSymmetric(1 / deltaDeg);
    roundedTargetAngle = Utils.roundSymmetric(roundedTargetAngle * roundFactor) / roundFactor;
    targetAngle = Utils.toRadians(roundedTargetAngle);
    let remainderAngle = targetAngle % (2 * Math.PI);

    // set turn counts and angles
    this.fullTurnCount = Utils.roundSymmetric((targetAngle - remainderAngle) / (2 * Math.PI));
    remainderAngle = targetAngle % Math.PI;
    this.halfTurnCount = Utils.roundSymmetric((targetAngle - remainderAngle) / Math.PI);
    this.fullAngleProperty.value = targetAngle; // now can trigger angle update
    this.previousAngle = smallAngle;
  }

  /**
   * Given the small angle in radians, set the current fullAngle to nearest special angle in radians. The small angle
   * is bound in the range of -PI to PI due to the delta of the drag handler, so the list of special angles is
   * also bound to this range.
   * @public
   *
   * @param {number} smallAngle - small angle in radians
   */
  setSpecialAngleWithSmallAngle(smallAngle) {
    const smallAngleInDegrees = Utils.toDegrees(smallAngle);
    let nearestSpecialAngleInRads = 0;
    const specialAnglesFromPi = SpecialAngles.SPECIAL_ANGLES_FROM_PI;

    // borders are angles half-way between special angles
    const borderAnglesFromPi = SpecialAngles.BORDER_ANGLES_FROM_PI;
    for (let i = 0; i < specialAnglesFromPi.length; i++) {
      if (smallAngleInDegrees >= borderAnglesFromPi[i] && smallAngleInDegrees < borderAnglesFromPi[i + 1]) {
        nearestSpecialAngleInRads = Utils.toRadians(specialAnglesFromPi[i]);
      }
      // Must deal with angle = 180 deg  as a special case.
      if (smallAngleInDegrees >= 165 || smallAngleInDegrees < -165) {
        nearestSpecialAngleInRads = Math.PI;
      }
    }
    this.setFullAngleWithSmallAngle(nearestSpecialAngleInRads);
  }

  /**
   * Given the full angle, set angle to the nearest special angle.
   * @public
   *
   * @param {number} fullAngle - full angle in radians
   */
  setSpecialAngleWithFullAngle(fullAngle) {
    const remainderAngle = fullAngle % (2 * Math.PI);
    const fullTurnsAngle = fullAngle - remainderAngle;
    const remainderInDegrees = Utils.toDegrees(remainderAngle);
    let nearestSpecialAngleInDegrees = 0;

    // Notice these are not the same special angles as in setSpecialAngle() above
    const specialAngles = SpecialAngles.SPECIAL_ANGLES;

    // borders are angles half-way between special angles
    const borderAngles = SpecialAngles.BORDER_ANGLES;
    for (let i = 0; i <= specialAngles.length - 1; i++) {
      if (remainderInDegrees >= borderAngles[i] && remainderInDegrees < borderAngles[i + 1]) {
        nearestSpecialAngleInDegrees = specialAngles[i + 1];
      }
      if (remainderInDegrees <= -borderAngles[i] && remainderInDegrees > -borderAngles[i + 1]) {
        nearestSpecialAngleInDegrees = -specialAngles[i + 1];
      }
    }

    // Must handle 0 and +/-360 deg angles as special cases.
    if (remainderInDegrees < 15 && remainderInDegrees >= -15) {
      nearestSpecialAngleInDegrees = 0;
    } else if (remainderInDegrees >= 345) {
      nearestSpecialAngleInDegrees = 360;
    } else if (remainderInDegrees < -345) {
      nearestSpecialAngleInDegrees = -360;
    }
    const nearestSpecialAngleInRadians = Utils.toRadians(nearestSpecialAngleInDegrees);
    const nearestFullAngle = fullTurnsAngle + nearestSpecialAngleInRadians;
    this.setFullAngleInRadians(nearestFullAngle);
  }

  /**
   * Checks to see if the user exceeds max number of rotations.  If the user exceeds +/- 25.25 rotations, the
   * fullAngle can not grow in magnitude. Sets the max angleExceeded property and is called whenever user tries to
   * change the fullAngle.
   *
   * @public
   */
  checkMaxAngleExceeded() {
    // determine if max angle is exceeded and set the property.
    this.maxAngleExceededProperty.value = Math.abs(this.getFullAngleInRadians()) > MAX_ANGLE_LIMIT;
  }
}

// statics
TrigTourModel.MAX_SMALL_ANGLE_LIMIT = MAX_SMALL_ANGLE_LIMIT;
TrigTourModel.MAX_ANGLE_LIMIT = MAX_ANGLE_LIMIT;
trigTour.register('TrigTourModel', TrigTourModel);
export default TrigTourModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIlV0aWxzIiwidHJpZ1RvdXIiLCJTcGVjaWFsQW5nbGVzIiwiTUFYX1NNQUxMX0FOR0xFX0xJTUlUIiwiTWF0aCIsIlBJIiwiTUFYX0FOR0xFX0xJTUlUIiwiVHJpZ1RvdXJNb2RlbCIsImNvbnN0cnVjdG9yIiwiZnVsbEFuZ2xlUHJvcGVydHkiLCJzaW5ndWxhcml0eVByb3BlcnR5IiwibWF4QW5nbGVFeGNlZWRlZFByb3BlcnR5Iiwic21hbGxBbmdsZSIsInByZXZpb3VzQW5nbGUiLCJyb3RhdGlvbk51bWJlckZyb21QaSIsImZ1bGxUdXJuQ291bnQiLCJoYWxmVHVybkNvdW50IiwicmVzZXQiLCJjb3MiLCJ2YWx1ZSIsInNpbiIsInRhbiIsInRhblZhbHVlIiwibWF4VmFsdWUiLCJyZXR1cm5WYWx1ZSIsImdldEZ1bGxBbmdsZUluUmFkaWFucyIsImdldEZ1bGxBbmdsZUluRGVncmVlcyIsInRvRGVncmVlcyIsImdldFNtYWxsQW5nbGVJblJhZGlhbnMiLCJnZXRTbWFsbEFuZ2xlSW5EZWdyZWVzIiwiZ2V0U21hbGxBbmdsZTBUbzM2MCIsInNldEZ1bGxBbmdsZUluUmFkaWFucyIsImZ1bGxBbmdsZUluUmFkcyIsInJlbWFpbmRlckFuZ2xlIiwicm91bmRTeW1tZXRyaWMiLCJhYnMiLCJzZXRGdWxsQW5nbGVXaXRoU21hbGxBbmdsZSIsImNvbXBhcmlzb25BbmdsZSIsInRvUmFkaWFucyIsInRhcmdldEFuZ2xlIiwicm91bmRlZFRhcmdldEFuZ2xlIiwiZGVsdGFEZWciLCJyb3VuZEZhY3RvciIsInNldFNwZWNpYWxBbmdsZVdpdGhTbWFsbEFuZ2xlIiwic21hbGxBbmdsZUluRGVncmVlcyIsIm5lYXJlc3RTcGVjaWFsQW5nbGVJblJhZHMiLCJzcGVjaWFsQW5nbGVzRnJvbVBpIiwiU1BFQ0lBTF9BTkdMRVNfRlJPTV9QSSIsImJvcmRlckFuZ2xlc0Zyb21QaSIsIkJPUkRFUl9BTkdMRVNfRlJPTV9QSSIsImkiLCJsZW5ndGgiLCJzZXRTcGVjaWFsQW5nbGVXaXRoRnVsbEFuZ2xlIiwiZnVsbEFuZ2xlIiwiZnVsbFR1cm5zQW5nbGUiLCJyZW1haW5kZXJJbkRlZ3JlZXMiLCJuZWFyZXN0U3BlY2lhbEFuZ2xlSW5EZWdyZWVzIiwic3BlY2lhbEFuZ2xlcyIsIlNQRUNJQUxfQU5HTEVTIiwiYm9yZGVyQW5nbGVzIiwiQk9SREVSX0FOR0xFUyIsIm5lYXJlc3RTcGVjaWFsQW5nbGVJblJhZGlhbnMiLCJuZWFyZXN0RnVsbEFuZ2xlIiwiY2hlY2tNYXhBbmdsZUV4Y2VlZGVkIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJUcmlnVG91ck1vZGVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjEsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIE1haW4gbW9kZWwgZm9yIFRyaWcgVG91ciBTaW1cclxuICpcclxuICogQGF1dGhvciBNaWNoYWVsIER1YnNvbiAoUGhFVClcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IE51bWJlclByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTnVtYmVyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IHRyaWdUb3VyIGZyb20gJy4uLy4uL3RyaWdUb3VyLmpzJztcclxuaW1wb3J0IFNwZWNpYWxBbmdsZXMgZnJvbSAnLi4vU3BlY2lhbEFuZ2xlcy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgTUFYX1NNQUxMX0FOR0xFX0xJTUlUID0gMC41ICogTWF0aC5QSTtcclxuY29uc3QgTUFYX0FOR0xFX0xJTUlUID0gNTAgKiBNYXRoLlBJICsgTUFYX1NNQUxMX0FOR0xFX0xJTUlUOyAvLyBtdXN0IGJlICggaW50ZWdlciswLjUpIG51bWJlciBvZiBmdWxsIHJvdGF0aW9uc1xyXG5cclxuY2xhc3MgVHJpZ1RvdXJNb2RlbCB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7UHJvcGVydHkuPE51bWJlcj59IHRvdGFsIChmdWxsKSBhbmdsZSBpbiByYWRpYW5zLCBjYW4gYmUgZ3JlYXRlciB0aGFuIDIqcGksIG9yIGxlc3MgdGhhbiAtMipwaVxyXG4gICAgdGhpcy5mdWxsQW5nbGVQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggMCApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge1Byb3BlcnR5Ljxib29sZWFuPn0gaW5kaWNhdGVzIHNpbmd1bGFyaXR5IGluIHRhbiBmdW5jdGlvbiBhdCB0aGV0YSA9ICsvLSA5MCBkZWdyZWVzXHJcbiAgICAvLyB0cnVlIGlmIGZ1bGxBbmdsZSBpcyBjbG9zZSB0byArLy05MCBkZWdyZWVzXHJcbiAgICB0aGlzLnNpbmd1bGFyaXR5UHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge1Byb3BlcnR5Ljxib29sZWFuPn0gKHJlYWQtb25seSkgdHJ1ZSBpZiB1c2VyIGV4Y2VlZHMgbWF4aW11bSBhbGxvd2VkIGFuZ2xlXHJcbiAgICB0aGlzLm1heEFuZ2xlRXhjZWVkZWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlICk7XHJcblxyXG5cclxuICAgIHRoaXMuc21hbGxBbmdsZSA9IDA7ICAgIC8vIEBwcml2YXRlLCBmdWxsQW5nbGUgbW9kdWxvIDIqcGkgd2l0aCAxODAgb2Zmc2V0LCBpcyBiZXR3ZWVuIC1waSBhbmQgK3BpXHJcbiAgICB0aGlzLnByZXZpb3VzQW5nbGUgPSAwOyAvLyBAcHJpdmF0ZSwgc21hbGxBbmdsZSBpbiBwcmV2aW91cyBzdGVwLCBuZWVkZWQgdG8gY29tcHV0ZSB0b3RhbCBmdWxsQW5nbGUgZnJvbSBzbWFsbEFuZ2xlXHJcbiAgICB0aGlzLnJvdGF0aW9uTnVtYmVyRnJvbVBpID0gMDsgIC8vQHByaXZhdGUsIG51bWJlciBvZiB0dXJucyBhcm91bmQgdGhlIHVuaXQgY2lyY2xlLCBpbmNyZW1lbnRlZCBhdCArLy0xODAgZGVnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL25lZWRlZCB0byBjb21wdXRlIGZ1bGxBbmdsZSBmcm9tIHNtYWxsQW5nbGVcclxuICAgIHRoaXMuZnVsbFR1cm5Db3VudCA9IDA7IC8vIEBwdWJsaWMsIG51bWJlciBvZiB0dXJucyBhcm91bmQgdW5pdCBjaXJjbGUsIGluY3JlbWVudGVkIGF0IGZ1bGxBbmdsZSA9IDAgZGVnXHJcbiAgICB0aGlzLmhhbGZUdXJuQ291bnQgPSAwOyAvLyBAcHVibGljLCBudW1iZXIgb2YgaGFsZiB0dXJucyBhcm91bmQgdW5pdCBjaXJjbGUsIGluY3JlbWVudGVkIGF0IHNtYWxsQW5nbGUgPSAwIGFuZCAxODBcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBSZXNldHMgdGhlIHByb3BlcnRpZXMgb2YgdGhlIG1vZGVsXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHJlc2V0KCkge1xyXG4gICAgdGhpcy5mdWxsQW5nbGVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5zaW5ndWxhcml0eVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLm1heEFuZ2xlRXhjZWVkZWRQcm9wZXJ0eS5yZXNldCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyBjb3Mgb2YgdGhlIHRvdGFsIG1vZGVsIGZ1bGxBbmdsZSBpbiByYWRpYW5zLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9XHJcbiAgICovXHJcbiAgY29zKCkge1xyXG4gICAgcmV0dXJuIE1hdGguY29zKCB0aGlzLmZ1bGxBbmdsZVByb3BlcnR5LnZhbHVlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHNpbiBvZiB0aGUgdG90YWwgbW9kZWwgZnVsbEFuZ2xlIGluIHJhZGlhbnMuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHJldHVybnMge251bWJlcn1cclxuICAgKi9cclxuICBzaW4oKSB7XHJcbiAgICByZXR1cm4gTWF0aC5zaW4oIHRoaXMuZnVsbEFuZ2xlUHJvcGVydHkudmFsdWUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGFuZ2VudCBvZiBjdXJyZW50IG1vZGVsIGZ1bGxBbmdsZSBpbiByYWRpYW5zLiBXaGVuIG5lYXIgKy8tOTAgZGVncmVlcywgY3V0cyBvZmYgdGFuIHZhbHVlIGF0ICsvLSBtYXhWYWx1ZS5cclxuICAgKiBNdXN0IGN1dCBvZmYgdmFsdWUgYXQgKy8tIG1heFZhbHVlIG9yIGVsc2UgU2FmYXJpIEJyb3dzZXIgd29uJ3QgZGlzcGxheSBwcm9wZXJseS5cclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqL1xyXG4gIHRhbigpIHtcclxuICAgIGNvbnN0IHRhblZhbHVlID0gTWF0aC50YW4oIHRoaXMuZnVsbEFuZ2xlUHJvcGVydHkudmFsdWUgKTtcclxuICAgIGNvbnN0IG1heFZhbHVlID0gMzUwO1xyXG4gICAgdGhpcy5zaW5ndWxhcml0eVByb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcbiAgICBsZXQgcmV0dXJuVmFsdWU7XHJcbiAgICBpZiAoIHRhblZhbHVlID4gbWF4VmFsdWUgKSB7XHJcbiAgICAgIHJldHVyblZhbHVlID0gbWF4VmFsdWU7XHJcbiAgICAgIHRoaXMuc2luZ3VsYXJpdHlQcm9wZXJ0eS52YWx1ZSA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggdGFuVmFsdWUgPCAtbWF4VmFsdWUgKSB7XHJcbiAgICAgIHJldHVyblZhbHVlID0gLW1heFZhbHVlO1xyXG4gICAgICB0aGlzLnNpbmd1bGFyaXR5UHJvcGVydHkudmFsdWUgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHJldHVyblZhbHVlID0gdGFuVmFsdWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIGN1cnJlbnQgbW9kZWwgZnVsbEFuZ2xlIGluIHJhZGlhbnMuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHJldHVybnMge251bWJlcn1cclxuICAgKi9cclxuICBnZXRGdWxsQW5nbGVJblJhZGlhbnMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5mdWxsQW5nbGVQcm9wZXJ0eS52YWx1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgY3VycmVudCBtb2RlbCBmdWxsQW5nbGUgaW4gZGVncmVlcy5cclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqL1xyXG4gIGdldEZ1bGxBbmdsZUluRGVncmVlcygpIHtcclxuICAgIHJldHVybiBVdGlscy50b0RlZ3JlZXMoIHRoaXMuZnVsbEFuZ2xlUHJvcGVydHkudmFsdWUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIHNtYWxsIGFuZ2xlIGluIHJhZGlhbnMsIGJldHdlZW4gLXBpIGFuZCArcGlcclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqL1xyXG4gIGdldFNtYWxsQW5nbGVJblJhZGlhbnMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zbWFsbEFuZ2xlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJuIHRoZSBzbWFsbCBhbmdsZSBpbiBkZWdyZWVzIGJldHdlZW4gLTE4MCBhbmQgKzE4MC5cclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqL1xyXG4gIGdldFNtYWxsQW5nbGVJbkRlZ3JlZXMoKSB7XHJcbiAgICByZXR1cm4gVXRpbHMudG9EZWdyZWVzKCB0aGlzLnNtYWxsQW5nbGUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnZlbmllbmNlIGZ1bmN0aW9uLCByZXR1cm4gdGhlIHNtYWxsIGFuZ2xlIGluIGRlZ3JlZXMgYm91bmQgYnkgMCB0byArMzYwXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHJldHVybnMge251bWJlcn1cclxuICAgKi9cclxuICBnZXRTbWFsbEFuZ2xlMFRvMzYwKCkge1xyXG4gICAgaWYgKCB0aGlzLnNtYWxsQW5nbGUgPiAwICkge1xyXG4gICAgICByZXR1cm4gVXRpbHMudG9EZWdyZWVzKCB0aGlzLnNtYWxsQW5nbGUgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICByZXR1cm4gMzYwICsgVXRpbHMudG9EZWdyZWVzKCB0aGlzLnNtYWxsQW5nbGUgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCB0aGUgZnVsbCBhbmdsZSwgYW5kIHRoZSBhc3NvY2lhdGVkIHNtYWxsIGFuZ2xlIGFuZCB2YXJpb3VzIHR1cm4gY291bnRzLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBmdWxsQW5nbGVJblJhZHMgLSByZXF1ZXN0ZWQgbmV3IGFuZ2xlXHJcbiAgICovXHJcbiAgc2V0RnVsbEFuZ2xlSW5SYWRpYW5zKCBmdWxsQW5nbGVJblJhZHMgKSB7XHJcbiAgICBsZXQgcmVtYWluZGVyQW5nbGUgPSBmdWxsQW5nbGVJblJhZHMgJSAoIDIgKiBNYXRoLlBJICk7XHJcbiAgICB0aGlzLmZ1bGxUdXJuQ291bnQgPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggKCBmdWxsQW5nbGVJblJhZHMgLSByZW1haW5kZXJBbmdsZSApIC8gKCAyICogTWF0aC5QSSApICk7XHJcblxyXG4gICAgaWYgKCBNYXRoLmFicyggcmVtYWluZGVyQW5nbGUgKSA8PSBNYXRoLlBJICkge1xyXG4gICAgICB0aGlzLnJvdGF0aW9uTnVtYmVyRnJvbVBpID0gdGhpcy5mdWxsVHVybkNvdW50O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGlmICggZnVsbEFuZ2xlSW5SYWRzID4gMCApIHtcclxuICAgICAgICB0aGlzLnJvdGF0aW9uTnVtYmVyRnJvbVBpID0gdGhpcy5mdWxsVHVybkNvdW50ICsgMTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB0aGlzLnJvdGF0aW9uTnVtYmVyRnJvbVBpID0gdGhpcy5mdWxsVHVybkNvdW50IC0gMTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5zbWFsbEFuZ2xlID0gZnVsbEFuZ2xlSW5SYWRzIC0gdGhpcy5yb3RhdGlvbk51bWJlckZyb21QaSAqIDIgKiBNYXRoLlBJO1xyXG4gICAgcmVtYWluZGVyQW5nbGUgPSBmdWxsQW5nbGVJblJhZHMgJSAoIE1hdGguUEkgKTtcclxuICAgIHRoaXMuaGFsZlR1cm5Db3VudCA9IFV0aWxzLnJvdW5kU3ltbWV0cmljKCAoIGZ1bGxBbmdsZUluUmFkcyAtIHJlbWFpbmRlckFuZ2xlICkgLyAoIE1hdGguUEkgKSApO1xyXG4gICAgdGhpcy5mdWxsQW5nbGVQcm9wZXJ0eS52YWx1ZSA9IGZ1bGxBbmdsZUluUmFkcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCB0aGUgZnVsbCBhbmdsZSBhbmQgaXRzIGFzc29jaWF0ZWQgc21hbGwgYW5nbGUgYW5kIHR1cm4gY291bnRzIGZyb20gYSBkZXNpcmVkIHNtYWxsIGFuZ2xlLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBzbWFsbEFuZ2xlXHJcbiAgICovXHJcbiAgc2V0RnVsbEFuZ2xlV2l0aFNtYWxsQW5nbGUoIHNtYWxsQW5nbGUgKSB7XHJcbiAgICB0aGlzLnNtYWxsQW5nbGUgPSBzbWFsbEFuZ2xlO1xyXG5cclxuICAgIC8vIG11c3QgYmUgbGVzcyB0aGFuICgxODAtMzApZGVnIGluIG9yZGVyIHRvIGhhbmRsZSBzcGVjaWFsIGFuZ2xlIGNvcnJlY3RseVxyXG4gICAgY29uc3QgY29tcGFyaXNvbkFuZ2xlID0gVXRpbHMudG9SYWRpYW5zKCAxNDkgKTtcclxuICAgIGlmICggKCB0aGlzLnNtYWxsQW5nbGUgPCAwICkgJiYgKCB0aGlzLnByZXZpb3VzQW5nbGUgPiBjb21wYXJpc29uQW5nbGUgKSApIHtcclxuICAgICAgdGhpcy5yb3RhdGlvbk51bWJlckZyb21QaSArPSAxO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIHRoaXMuc21hbGxBbmdsZSA+IDAgJiYgdGhpcy5wcmV2aW91c0FuZ2xlIDwgLWNvbXBhcmlzb25BbmdsZSApIHtcclxuICAgICAgdGhpcy5yb3RhdGlvbk51bWJlckZyb21QaSAtPSAxO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGRvbid0IHdhbnQgdG8gdHJpZ2dlciBhbmdsZSB1cGRhdGUgeWV0XHJcbiAgICBsZXQgdGFyZ2V0QW5nbGUgPSB0aGlzLnJvdGF0aW9uTnVtYmVyRnJvbVBpICogMiAqIE1hdGguUEkgKyB0aGlzLnNtYWxsQW5nbGU7XHJcblxyXG4gICAgLy8gcm91bmQgdG8gbmVhcmVzdCBoYWxmLWRlZ3JlZTsgdG8gZG8gdGhpcywgbXVzdCBjb252ZXJ0IHRvIGRlZ3JlZXMgYW5kIHRoZW4gYmFjayB0byByYWRzXHJcbiAgICBsZXQgcm91bmRlZFRhcmdldEFuZ2xlID0gVXRpbHMudG9EZWdyZWVzKCB0YXJnZXRBbmdsZSApO1xyXG4gICAgY29uc3QgZGVsdGFEZWcgPSAwLjU7XHJcbiAgICBjb25zdCByb3VuZEZhY3RvciA9IFV0aWxzLnJvdW5kU3ltbWV0cmljKCAxIC8gZGVsdGFEZWcgKTtcclxuICAgIHJvdW5kZWRUYXJnZXRBbmdsZSA9IFV0aWxzLnJvdW5kU3ltbWV0cmljKCByb3VuZGVkVGFyZ2V0QW5nbGUgKiByb3VuZEZhY3RvciApIC8gcm91bmRGYWN0b3I7XHJcbiAgICB0YXJnZXRBbmdsZSA9IFV0aWxzLnRvUmFkaWFucyggcm91bmRlZFRhcmdldEFuZ2xlICk7XHJcbiAgICBsZXQgcmVtYWluZGVyQW5nbGUgPSB0YXJnZXRBbmdsZSAlICggMiAqIE1hdGguUEkgKTtcclxuXHJcbiAgICAvLyBzZXQgdHVybiBjb3VudHMgYW5kIGFuZ2xlc1xyXG4gICAgdGhpcy5mdWxsVHVybkNvdW50ID0gVXRpbHMucm91bmRTeW1tZXRyaWMoICggdGFyZ2V0QW5nbGUgLSByZW1haW5kZXJBbmdsZSApIC8gKCAyICogTWF0aC5QSSApICk7XHJcbiAgICByZW1haW5kZXJBbmdsZSA9IHRhcmdldEFuZ2xlICUgKCBNYXRoLlBJICk7XHJcbiAgICB0aGlzLmhhbGZUdXJuQ291bnQgPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggKCB0YXJnZXRBbmdsZSAtIHJlbWFpbmRlckFuZ2xlICkgLyAoIE1hdGguUEkgKSApO1xyXG4gICAgdGhpcy5mdWxsQW5nbGVQcm9wZXJ0eS52YWx1ZSA9IHRhcmdldEFuZ2xlOyAgLy8gbm93IGNhbiB0cmlnZ2VyIGFuZ2xlIHVwZGF0ZVxyXG4gICAgdGhpcy5wcmV2aW91c0FuZ2xlID0gc21hbGxBbmdsZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdpdmVuIHRoZSBzbWFsbCBhbmdsZSBpbiByYWRpYW5zLCBzZXQgdGhlIGN1cnJlbnQgZnVsbEFuZ2xlIHRvIG5lYXJlc3Qgc3BlY2lhbCBhbmdsZSBpbiByYWRpYW5zLiBUaGUgc21hbGwgYW5nbGVcclxuICAgKiBpcyBib3VuZCBpbiB0aGUgcmFuZ2Ugb2YgLVBJIHRvIFBJIGR1ZSB0byB0aGUgZGVsdGEgb2YgdGhlIGRyYWcgaGFuZGxlciwgc28gdGhlIGxpc3Qgb2Ygc3BlY2lhbCBhbmdsZXMgaXNcclxuICAgKiBhbHNvIGJvdW5kIHRvIHRoaXMgcmFuZ2UuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHNtYWxsQW5nbGUgLSBzbWFsbCBhbmdsZSBpbiByYWRpYW5zXHJcbiAgICovXHJcbiAgc2V0U3BlY2lhbEFuZ2xlV2l0aFNtYWxsQW5nbGUoIHNtYWxsQW5nbGUgKSB7XHJcbiAgICBjb25zdCBzbWFsbEFuZ2xlSW5EZWdyZWVzID0gVXRpbHMudG9EZWdyZWVzKCBzbWFsbEFuZ2xlICk7XHJcbiAgICBsZXQgbmVhcmVzdFNwZWNpYWxBbmdsZUluUmFkcyA9IDA7XHJcbiAgICBjb25zdCBzcGVjaWFsQW5nbGVzRnJvbVBpID0gU3BlY2lhbEFuZ2xlcy5TUEVDSUFMX0FOR0xFU19GUk9NX1BJO1xyXG5cclxuICAgIC8vIGJvcmRlcnMgYXJlIGFuZ2xlcyBoYWxmLXdheSBiZXR3ZWVuIHNwZWNpYWwgYW5nbGVzXHJcbiAgICBjb25zdCBib3JkZXJBbmdsZXNGcm9tUGkgPSBTcGVjaWFsQW5nbGVzLkJPUkRFUl9BTkdMRVNfRlJPTV9QSTtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHNwZWNpYWxBbmdsZXNGcm9tUGkubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGlmICggc21hbGxBbmdsZUluRGVncmVlcyA+PSBib3JkZXJBbmdsZXNGcm9tUGlbIGkgXSAmJiBzbWFsbEFuZ2xlSW5EZWdyZWVzIDwgYm9yZGVyQW5nbGVzRnJvbVBpWyBpICsgMSBdICkge1xyXG4gICAgICAgIG5lYXJlc3RTcGVjaWFsQW5nbGVJblJhZHMgPSBVdGlscy50b1JhZGlhbnMoIHNwZWNpYWxBbmdsZXNGcm9tUGlbIGkgXSApO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIE11c3QgZGVhbCB3aXRoIGFuZ2xlID0gMTgwIGRlZyAgYXMgYSBzcGVjaWFsIGNhc2UuXHJcbiAgICAgIGlmICggc21hbGxBbmdsZUluRGVncmVlcyA+PSAxNjUgfHwgc21hbGxBbmdsZUluRGVncmVlcyA8IC0xNjUgKSB7XHJcbiAgICAgICAgbmVhcmVzdFNwZWNpYWxBbmdsZUluUmFkcyA9IE1hdGguUEk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuc2V0RnVsbEFuZ2xlV2l0aFNtYWxsQW5nbGUoIG5lYXJlc3RTcGVjaWFsQW5nbGVJblJhZHMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdpdmVuIHRoZSBmdWxsIGFuZ2xlLCBzZXQgYW5nbGUgdG8gdGhlIG5lYXJlc3Qgc3BlY2lhbCBhbmdsZS5cclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZnVsbEFuZ2xlIC0gZnVsbCBhbmdsZSBpbiByYWRpYW5zXHJcbiAgICovXHJcbiAgc2V0U3BlY2lhbEFuZ2xlV2l0aEZ1bGxBbmdsZSggZnVsbEFuZ2xlICkge1xyXG4gICAgY29uc3QgcmVtYWluZGVyQW5nbGUgPSBmdWxsQW5nbGUgJSAoIDIgKiBNYXRoLlBJICk7XHJcbiAgICBjb25zdCBmdWxsVHVybnNBbmdsZSA9IGZ1bGxBbmdsZSAtIHJlbWFpbmRlckFuZ2xlO1xyXG4gICAgY29uc3QgcmVtYWluZGVySW5EZWdyZWVzID0gVXRpbHMudG9EZWdyZWVzKCByZW1haW5kZXJBbmdsZSApO1xyXG4gICAgbGV0IG5lYXJlc3RTcGVjaWFsQW5nbGVJbkRlZ3JlZXMgPSAwO1xyXG5cclxuICAgIC8vIE5vdGljZSB0aGVzZSBhcmUgbm90IHRoZSBzYW1lIHNwZWNpYWwgYW5nbGVzIGFzIGluIHNldFNwZWNpYWxBbmdsZSgpIGFib3ZlXHJcbiAgICBjb25zdCBzcGVjaWFsQW5nbGVzID0gU3BlY2lhbEFuZ2xlcy5TUEVDSUFMX0FOR0xFUztcclxuXHJcbiAgICAvLyBib3JkZXJzIGFyZSBhbmdsZXMgaGFsZi13YXkgYmV0d2VlbiBzcGVjaWFsIGFuZ2xlc1xyXG4gICAgY29uc3QgYm9yZGVyQW5nbGVzID0gU3BlY2lhbEFuZ2xlcy5CT1JERVJfQU5HTEVTO1xyXG5cclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8PSBzcGVjaWFsQW5nbGVzLmxlbmd0aCAtIDE7IGkrKyApIHtcclxuICAgICAgaWYgKCByZW1haW5kZXJJbkRlZ3JlZXMgPj0gYm9yZGVyQW5nbGVzWyBpIF0gJiYgcmVtYWluZGVySW5EZWdyZWVzIDwgYm9yZGVyQW5nbGVzWyBpICsgMSBdICkge1xyXG4gICAgICAgIG5lYXJlc3RTcGVjaWFsQW5nbGVJbkRlZ3JlZXMgPSBzcGVjaWFsQW5nbGVzWyBpICsgMSBdO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICggcmVtYWluZGVySW5EZWdyZWVzIDw9IC1ib3JkZXJBbmdsZXNbIGkgXSAmJiByZW1haW5kZXJJbkRlZ3JlZXMgPiAtYm9yZGVyQW5nbGVzWyBpICsgMSBdICkge1xyXG4gICAgICAgIG5lYXJlc3RTcGVjaWFsQW5nbGVJbkRlZ3JlZXMgPSAtc3BlY2lhbEFuZ2xlc1sgaSArIDEgXTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIE11c3QgaGFuZGxlIDAgYW5kICsvLTM2MCBkZWcgYW5nbGVzIGFzIHNwZWNpYWwgY2FzZXMuXHJcbiAgICBpZiAoIHJlbWFpbmRlckluRGVncmVlcyA8IDE1ICYmIHJlbWFpbmRlckluRGVncmVlcyA+PSAtMTUgKSB7XHJcbiAgICAgIG5lYXJlc3RTcGVjaWFsQW5nbGVJbkRlZ3JlZXMgPSAwO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIHJlbWFpbmRlckluRGVncmVlcyA+PSAzNDUgKSB7XHJcbiAgICAgIG5lYXJlc3RTcGVjaWFsQW5nbGVJbkRlZ3JlZXMgPSAzNjA7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggcmVtYWluZGVySW5EZWdyZWVzIDwgLTM0NSApIHtcclxuICAgICAgbmVhcmVzdFNwZWNpYWxBbmdsZUluRGVncmVlcyA9IC0zNjA7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbmVhcmVzdFNwZWNpYWxBbmdsZUluUmFkaWFucyA9IFV0aWxzLnRvUmFkaWFucyggbmVhcmVzdFNwZWNpYWxBbmdsZUluRGVncmVlcyApO1xyXG4gICAgY29uc3QgbmVhcmVzdEZ1bGxBbmdsZSA9IGZ1bGxUdXJuc0FuZ2xlICsgbmVhcmVzdFNwZWNpYWxBbmdsZUluUmFkaWFucztcclxuICAgIHRoaXMuc2V0RnVsbEFuZ2xlSW5SYWRpYW5zKCBuZWFyZXN0RnVsbEFuZ2xlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVja3MgdG8gc2VlIGlmIHRoZSB1c2VyIGV4Y2VlZHMgbWF4IG51bWJlciBvZiByb3RhdGlvbnMuICBJZiB0aGUgdXNlciBleGNlZWRzICsvLSAyNS4yNSByb3RhdGlvbnMsIHRoZVxyXG4gICAqIGZ1bGxBbmdsZSBjYW4gbm90IGdyb3cgaW4gbWFnbml0dWRlLiBTZXRzIHRoZSBtYXggYW5nbGVFeGNlZWRlZCBwcm9wZXJ0eSBhbmQgaXMgY2FsbGVkIHdoZW5ldmVyIHVzZXIgdHJpZXMgdG9cclxuICAgKiBjaGFuZ2UgdGhlIGZ1bGxBbmdsZS5cclxuICAgKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBjaGVja01heEFuZ2xlRXhjZWVkZWQoKSB7XHJcbiAgICAvLyBkZXRlcm1pbmUgaWYgbWF4IGFuZ2xlIGlzIGV4Y2VlZGVkIGFuZCBzZXQgdGhlIHByb3BlcnR5LlxyXG4gICAgdGhpcy5tYXhBbmdsZUV4Y2VlZGVkUHJvcGVydHkudmFsdWUgPSAoIE1hdGguYWJzKCB0aGlzLmdldEZ1bGxBbmdsZUluUmFkaWFucygpICkgPiBNQVhfQU5HTEVfTElNSVQgKTtcclxuICB9XHJcbn1cclxuXHJcblxyXG4vLyBzdGF0aWNzXHJcblRyaWdUb3VyTW9kZWwuTUFYX1NNQUxMX0FOR0xFX0xJTUlUID0gTUFYX1NNQUxMX0FOR0xFX0xJTUlUO1xyXG5UcmlnVG91ck1vZGVsLk1BWF9BTkdMRV9MSU1JVCA9IE1BWF9BTkdMRV9MSU1JVDtcclxuXHJcbnRyaWdUb3VyLnJlZ2lzdGVyKCAnVHJpZ1RvdXJNb2RlbCcsIFRyaWdUb3VyTW9kZWwgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFRyaWdUb3VyTW9kZWw7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsY0FBYyxNQUFNLHVDQUF1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