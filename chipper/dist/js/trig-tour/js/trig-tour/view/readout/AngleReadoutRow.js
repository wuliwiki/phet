// Copyright 2016-2023, University of Colorado Boulder

/**
 * Creates the second row for the ReadoutNode of Trig Tour.  This row contains a label for the angle and the value
 * of the model angle, in degrees or radians.
 *
 * @author Michael Dubson (PhET developer) on 6/10/2015
 * @author Jesse Greenberg
 */

import Utils from '../../../../../dot/js/Utils.js';
import StringUtils from '../../../../../phetcommon/js/util/StringUtils.js';
import MathSymbols from '../../../../../scenery-phet/js/MathSymbols.js';
import PhetFont from '../../../../../scenery-phet/js/PhetFont.js';
import { Node, Text } from '../../../../../scenery/js/imports.js';
import trigTour from '../../../trigTour.js';
import TrigTourStrings from '../../../TrigTourStrings.js';
import SpecialAngles from '../../SpecialAngles.js';
import TrigTourMathStrings from '../../TrigTourMathStrings.js';
import TrigTourColors from '../TrigTourColors.js';
import FractionNode from './FractionNode.js';

//strings
const angleString = TrigTourStrings.angle;
const radsString = TrigTourStrings.rads;
const valueUnitPatternString = TrigTourStrings.valueUnitPattern;

// non-translatable string
const equalString = TrigTourMathStrings.EQUALS_STRING;

//constants
const DISPLAY_FONT = new PhetFont(20);
const TEXT_COLOR = TrigTourColors.TEXT_COLOR;
class AngleReadoutRow extends Node {
  /**
   * @param {TrigTourModel} trigTourModel is the main model of the sim
   * @param {ViewProperties} viewProperties
   * @param {Object} [options] to pass the maximum width of content in the ReadoutNode panel in the screen view.
   */
  constructor(trigTourModel, viewProperties, options) {
    super(options);

    // @private
    this.decimalPrecision = 1; // number of decimal places for display of fullAngle, = 0 for special angles
    this.units = 'degrees'; // {string} 'degrees'|'radians' set by radio buttons on ReadoutNode
    this.viewProperties = viewProperties;
    this.trigTourModel = trigTourModel;

    // initialize font styles
    const fontInfo = {
      font: DISPLAY_FONT,
      fill: TEXT_COLOR
    };
    const fontBoldInfo = {
      font: DISPLAY_FONT,
      fill: TEXT_COLOR,
      fontWeight: 'bold'
    };

    // full angle for the trigTourModel
    const fullAngleValue = Utils.toFixed(trigTourModel.fullAngleProperty.value, 1);

    //  value is decimal number or exact fraction of radians (in special angle mode)
    const angleLabelText = new Text(angleString, fontBoldInfo);
    const angleLabelEqualsText = new Text(equalString, fontBoldInfo);
    this.angleReadoutDecimal = new Text(fullAngleValue, fontInfo); // angle readout as decimal number
    this.fullAngleFractionNode = new FractionNode('', '', fontInfo); // node representing fractional form of full angle

    // used to display angle as FractionNode in Special angles mode
    this.angleReadoutFraction = new FractionNode('', '', fontInfo);
    this.angleReadoutDecimal.visible = true;
    this.angleReadoutFraction.visible = false;

    // Either angleReadoutDecimal visible (decimal number values)
    // or (fullAngleFractionNode + angleReadoutFraction) visible in Special angles mode
    this.children = [angleLabelText, angleLabelEqualsText, this.angleReadoutDecimal, this.fullAngleFractionNode, this.angleReadoutFraction];

    // row 2 layout
    const spacing = 4;
    angleLabelEqualsText.left = angleLabelText.right + spacing;
    this.angleReadoutDecimal.left = angleLabelEqualsText.right + spacing;
    this.fullAngleFractionNode.left = angleLabelEqualsText.right + spacing;
    this.angleReadoutFraction.left = this.fullAngleFractionNode.right + spacing;
    trigTourModel.fullAngleProperty.link(fullAngle => {
      // fullAngle is in radians
      this.setAngleReadout();
    });
    viewProperties.angleUnitsProperty.link(units => {
      this.setUnits(units);
      if (units === 'radians' && viewProperties.specialAnglesVisibleProperty.value) {
        this.fullAngleFractionNode.visible = true;
        this.angleReadoutFraction.visible = true;
        this.angleReadoutDecimal.visible = false;
      } else {
        this.fullAngleFractionNode.visible = false;
        this.angleReadoutFraction.visible = false;
        this.angleReadoutDecimal.visible = true;
      }
      this.setAngleReadout();
    });
    viewProperties.specialAnglesVisibleProperty.link(specialAnglesVisible => {
      //select correct angle readout
      if (specialAnglesVisible && viewProperties.angleUnitsProperty.value === 'radians') {
        this.fullAngleFractionNode.visible = true;
        this.angleReadoutFraction.visible = true;
        this.angleReadoutDecimal.visible = false;
      } else {
        this.fullAngleFractionNode.visible = false;
        this.angleReadoutFraction.visible = false;
        this.angleReadoutDecimal.visible = true;
      }

      // set precision of angle readout in degrees:
      // in special angles mode, zero decimal places (e.g. 45 deg), otherwise 1 decimal place (e.g. 45.0 deg)
      if (specialAnglesVisible) {
        const currentSmallAngle = trigTourModel.getSmallAngleInRadians();
        trigTourModel.setSpecialAngleWithSmallAngle(currentSmallAngle);
        this.setAngleReadoutPrecision(0); //integer display of special angles
      } else {
        // 1 decimal place precision for continuous angles
        this.setAngleReadoutPrecision(1);
      }
      this.setAngleReadout();
    });
  }

  /**
   * Set readout units to either degrees or radians.
   * @private
   *
   * @param {string} units one of 'degrees' || 'radians'
   */
  setUnits(units) {
    this.units = units;
    if (units === 'radians') {
      const radiansValue = Utils.toFixed(this.trigTourModel.getFullAngleInRadians(), 3);
      const unitsString = StringUtils.format(valueUnitPatternString, radiansValue, radsString);
      this.angleReadoutDecimal.string = unitsString;
    } else {
      const roundedAngle = Utils.toFixed(this.trigTourModel.getFullAngleInDegrees(), this.decimalPrecision);
      this.angleReadoutDecimal.string = `${roundedAngle}\u00B0`;
    }
  }

  /**
   * Set the fullAngle readout precision.
   * @private
   *
   * @param {number} decimalPrecision
   */
  setAngleReadoutPrecision(decimalPrecision) {
    this.decimalPrecision = decimalPrecision;
  }

  /**
   * Sets the unit format of angle readout of readout panel in degrees, radians, or special angles.
   * @private
   */
  setAngleReadout() {
    const radiansDisplayed = this.viewProperties.angleUnitsProperty.value === 'radians';
    const specialAnglesVisible = this.viewProperties.specialAnglesVisibleProperty.value === true;
    if (!radiansDisplayed) {
      this.angleReadoutDecimal.string = `${Utils.toFixed(this.trigTourModel.getFullAngleInDegrees(), this.decimalPrecision)}\u00B0`;
    }
    if (radiansDisplayed && !specialAnglesVisible) {
      this.angleReadoutDecimal.string = `${Utils.toFixed(this.trigTourModel.fullAngleProperty.value, 3)} ${radsString}`;
    }
    if (radiansDisplayed && specialAnglesVisible) {
      this.setSpecialAngleReadout();
    }
  }

  /**
   * Set the special angle readout.
   * @private
   */
  setSpecialAngleReadout() {
    this.angleReadoutFraction.visible = true;

    // need integer value of angle, since internal arithmetic often not-quite integer
    let angleInDegs = Utils.roundSymmetric(this.trigTourModel.getFullAngleInDegrees());
    if (Math.abs(angleInDegs) > 360) {
      angleInDegs = angleInDegs % 360;
    }

    // number of full turns around unit circle, incremented at theta = 0
    const fullTurnCount = this.trigTourModel.fullTurnCount;
    const piRadiansCount = 2 * fullTurnCount; // number of half turns around unit circle; half-turn = pi radians
    let fullTurnString = ''; // angle readout has format theta = 4pi + (1/2)pi = fullTurnString + small angle
    if (piRadiansCount !== 0) {
      if (fullTurnCount > 0) {
        fullTurnString = `${piRadiansCount + MathSymbols.PI} + `;
      } else {
        // if angle negative, minus sign is constructed in FractionNode
        fullTurnString = `${piRadiansCount + MathSymbols.PI} `;
      }
    } else {
      // if zero turns, set full turn string to null string.
      fullTurnString = '';
    }
    this.fullAngleFractionNode.setValues(fullTurnString, '', false);
    this.angleReadoutFraction.left = this.fullAngleFractionNode.right;

    // set the angle readout, making sure that the angle is defined in the special fractions object
    const specialAngleFractions = SpecialAngles.SPECIAL_ANGLE_FRACTIONS;
    if (specialAngleFractions[angleInDegs] || specialAngleFractions[-angleInDegs]) {
      // correct for negative angles, fraction must reflect if negative and objects in SpecialAngles do not track
      // this information
      const sign = angleInDegs >= 0 ? '' : '-';
      const coefficient = angleInDegs >= 0 ? +1 : -1;
      this.angleReadoutFraction.setValues(sign + specialAngleFractions[coefficient * angleInDegs].numerator,
      // string concatenation
      specialAngleFractions[coefficient * angleInDegs].denominator, false /* no radicals for special angle fractions */);
    }

    // Must handle smallAngle = 0 or pi as special cases
    const roundedAngle = Utils.roundSymmetric(this.trigTourModel.getSmallAngleInDegrees());
    if (roundedAngle === 0 || roundedAngle === 180) {
      const nbrPiRads = this.trigTourModel.halfTurnCount;
      let angleRadianString = nbrPiRads + MathSymbols.PI;
      if (nbrPiRads === 0) {
        angleRadianString = '0';
      } else if (nbrPiRads === 1) {
        angleRadianString = MathSymbols.PI;
      } else if (nbrPiRads === -1) {
        angleRadianString = `-${MathSymbols.PI}`;
      }
      this.fullAngleFractionNode.setValues(angleRadianString, '');

      // dummy angleReadoutFraction is set to ensure bounds remain constant and readoutDisplay does not jump around
      this.angleReadoutFraction.setValues('A', 'B');
      this.angleReadoutFraction.visible = false;
    }
  }
}
trigTour.register('AngleReadoutRow', AngleReadoutRow);
export default AngleReadoutRow;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlN0cmluZ1V0aWxzIiwiTWF0aFN5bWJvbHMiLCJQaGV0Rm9udCIsIk5vZGUiLCJUZXh0IiwidHJpZ1RvdXIiLCJUcmlnVG91clN0cmluZ3MiLCJTcGVjaWFsQW5nbGVzIiwiVHJpZ1RvdXJNYXRoU3RyaW5ncyIsIlRyaWdUb3VyQ29sb3JzIiwiRnJhY3Rpb25Ob2RlIiwiYW5nbGVTdHJpbmciLCJhbmdsZSIsInJhZHNTdHJpbmciLCJyYWRzIiwidmFsdWVVbml0UGF0dGVyblN0cmluZyIsInZhbHVlVW5pdFBhdHRlcm4iLCJlcXVhbFN0cmluZyIsIkVRVUFMU19TVFJJTkciLCJESVNQTEFZX0ZPTlQiLCJURVhUX0NPTE9SIiwiQW5nbGVSZWFkb3V0Um93IiwiY29uc3RydWN0b3IiLCJ0cmlnVG91ck1vZGVsIiwidmlld1Byb3BlcnRpZXMiLCJvcHRpb25zIiwiZGVjaW1hbFByZWNpc2lvbiIsInVuaXRzIiwiZm9udEluZm8iLCJmb250IiwiZmlsbCIsImZvbnRCb2xkSW5mbyIsImZvbnRXZWlnaHQiLCJmdWxsQW5nbGVWYWx1ZSIsInRvRml4ZWQiLCJmdWxsQW5nbGVQcm9wZXJ0eSIsInZhbHVlIiwiYW5nbGVMYWJlbFRleHQiLCJhbmdsZUxhYmVsRXF1YWxzVGV4dCIsImFuZ2xlUmVhZG91dERlY2ltYWwiLCJmdWxsQW5nbGVGcmFjdGlvbk5vZGUiLCJhbmdsZVJlYWRvdXRGcmFjdGlvbiIsInZpc2libGUiLCJjaGlsZHJlbiIsInNwYWNpbmciLCJsZWZ0IiwicmlnaHQiLCJsaW5rIiwiZnVsbEFuZ2xlIiwic2V0QW5nbGVSZWFkb3V0IiwiYW5nbGVVbml0c1Byb3BlcnR5Iiwic2V0VW5pdHMiLCJzcGVjaWFsQW5nbGVzVmlzaWJsZVByb3BlcnR5Iiwic3BlY2lhbEFuZ2xlc1Zpc2libGUiLCJjdXJyZW50U21hbGxBbmdsZSIsImdldFNtYWxsQW5nbGVJblJhZGlhbnMiLCJzZXRTcGVjaWFsQW5nbGVXaXRoU21hbGxBbmdsZSIsInNldEFuZ2xlUmVhZG91dFByZWNpc2lvbiIsInJhZGlhbnNWYWx1ZSIsImdldEZ1bGxBbmdsZUluUmFkaWFucyIsInVuaXRzU3RyaW5nIiwiZm9ybWF0Iiwic3RyaW5nIiwicm91bmRlZEFuZ2xlIiwiZ2V0RnVsbEFuZ2xlSW5EZWdyZWVzIiwicmFkaWFuc0Rpc3BsYXllZCIsInNldFNwZWNpYWxBbmdsZVJlYWRvdXQiLCJhbmdsZUluRGVncyIsInJvdW5kU3ltbWV0cmljIiwiTWF0aCIsImFicyIsImZ1bGxUdXJuQ291bnQiLCJwaVJhZGlhbnNDb3VudCIsImZ1bGxUdXJuU3RyaW5nIiwiUEkiLCJzZXRWYWx1ZXMiLCJzcGVjaWFsQW5nbGVGcmFjdGlvbnMiLCJTUEVDSUFMX0FOR0xFX0ZSQUNUSU9OUyIsInNpZ24iLCJjb2VmZmljaWVudCIsIm51bWVyYXRvciIsImRlbm9taW5hdG9yIiwiZ2V0U21hbGxBbmdsZUluRGVncmVlcyIsIm5iclBpUmFkcyIsImhhbGZUdXJuQ291bnQiLCJhbmdsZVJhZGlhblN0cmluZyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQW5nbGVSZWFkb3V0Um93LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZXMgdGhlIHNlY29uZCByb3cgZm9yIHRoZSBSZWFkb3V0Tm9kZSBvZiBUcmlnIFRvdXIuICBUaGlzIHJvdyBjb250YWlucyBhIGxhYmVsIGZvciB0aGUgYW5nbGUgYW5kIHRoZSB2YWx1ZVxyXG4gKiBvZiB0aGUgbW9kZWwgYW5nbGUsIGluIGRlZ3JlZXMgb3IgcmFkaWFucy5cclxuICpcclxuICogQGF1dGhvciBNaWNoYWVsIER1YnNvbiAoUGhFVCBkZXZlbG9wZXIpIG9uIDYvMTAvMjAxNVxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZ1xyXG4gKi9cclxuXHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IE1hdGhTeW1ib2xzIGZyb20gJy4uLy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9NYXRoU3ltYm9scy5qcyc7XHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuLi8uLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUGhldEZvbnQuanMnO1xyXG5pbXBvcnQgeyBOb2RlLCBUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHRyaWdUb3VyIGZyb20gJy4uLy4uLy4uL3RyaWdUb3VyLmpzJztcclxuaW1wb3J0IFRyaWdUb3VyU3RyaW5ncyBmcm9tICcuLi8uLi8uLi9UcmlnVG91clN0cmluZ3MuanMnO1xyXG5pbXBvcnQgU3BlY2lhbEFuZ2xlcyBmcm9tICcuLi8uLi9TcGVjaWFsQW5nbGVzLmpzJztcclxuaW1wb3J0IFRyaWdUb3VyTWF0aFN0cmluZ3MgZnJvbSAnLi4vLi4vVHJpZ1RvdXJNYXRoU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBUcmlnVG91ckNvbG9ycyBmcm9tICcuLi9UcmlnVG91ckNvbG9ycy5qcyc7XHJcbmltcG9ydCBGcmFjdGlvbk5vZGUgZnJvbSAnLi9GcmFjdGlvbk5vZGUuanMnO1xyXG5cclxuLy9zdHJpbmdzXHJcbmNvbnN0IGFuZ2xlU3RyaW5nID0gVHJpZ1RvdXJTdHJpbmdzLmFuZ2xlO1xyXG5jb25zdCByYWRzU3RyaW5nID0gVHJpZ1RvdXJTdHJpbmdzLnJhZHM7XHJcbmNvbnN0IHZhbHVlVW5pdFBhdHRlcm5TdHJpbmcgPSBUcmlnVG91clN0cmluZ3MudmFsdWVVbml0UGF0dGVybjtcclxuXHJcbi8vIG5vbi10cmFuc2xhdGFibGUgc3RyaW5nXHJcbmNvbnN0IGVxdWFsU3RyaW5nID0gVHJpZ1RvdXJNYXRoU3RyaW5ncy5FUVVBTFNfU1RSSU5HO1xyXG5cclxuLy9jb25zdGFudHNcclxuY29uc3QgRElTUExBWV9GT05UID0gbmV3IFBoZXRGb250KCAyMCApO1xyXG5jb25zdCBURVhUX0NPTE9SID0gVHJpZ1RvdXJDb2xvcnMuVEVYVF9DT0xPUjtcclxuXHJcbmNsYXNzIEFuZ2xlUmVhZG91dFJvdyBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1RyaWdUb3VyTW9kZWx9IHRyaWdUb3VyTW9kZWwgaXMgdGhlIG1haW4gbW9kZWwgb2YgdGhlIHNpbVxyXG4gICAqIEBwYXJhbSB7Vmlld1Byb3BlcnRpZXN9IHZpZXdQcm9wZXJ0aWVzXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSB0byBwYXNzIHRoZSBtYXhpbXVtIHdpZHRoIG9mIGNvbnRlbnQgaW4gdGhlIFJlYWRvdXROb2RlIHBhbmVsIGluIHRoZSBzY3JlZW4gdmlldy5cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggdHJpZ1RvdXJNb2RlbCwgdmlld1Byb3BlcnRpZXMsIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5kZWNpbWFsUHJlY2lzaW9uID0gMTsgLy8gbnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzIGZvciBkaXNwbGF5IG9mIGZ1bGxBbmdsZSwgPSAwIGZvciBzcGVjaWFsIGFuZ2xlc1xyXG4gICAgdGhpcy51bml0cyA9ICdkZWdyZWVzJzsgLy8ge3N0cmluZ30gJ2RlZ3JlZXMnfCdyYWRpYW5zJyBzZXQgYnkgcmFkaW8gYnV0dG9ucyBvbiBSZWFkb3V0Tm9kZVxyXG4gICAgdGhpcy52aWV3UHJvcGVydGllcyA9IHZpZXdQcm9wZXJ0aWVzO1xyXG4gICAgdGhpcy50cmlnVG91ck1vZGVsID0gdHJpZ1RvdXJNb2RlbDtcclxuXHJcbiAgICAvLyBpbml0aWFsaXplIGZvbnQgc3R5bGVzXHJcbiAgICBjb25zdCBmb250SW5mbyA9IHsgZm9udDogRElTUExBWV9GT05ULCBmaWxsOiBURVhUX0NPTE9SIH07XHJcbiAgICBjb25zdCBmb250Qm9sZEluZm8gPSB7IGZvbnQ6IERJU1BMQVlfRk9OVCwgZmlsbDogVEVYVF9DT0xPUiwgZm9udFdlaWdodDogJ2JvbGQnIH07XHJcblxyXG4gICAgLy8gZnVsbCBhbmdsZSBmb3IgdGhlIHRyaWdUb3VyTW9kZWxcclxuICAgIGNvbnN0IGZ1bGxBbmdsZVZhbHVlID0gVXRpbHMudG9GaXhlZCggdHJpZ1RvdXJNb2RlbC5mdWxsQW5nbGVQcm9wZXJ0eS52YWx1ZSwgMSApO1xyXG5cclxuICAgIC8vICB2YWx1ZSBpcyBkZWNpbWFsIG51bWJlciBvciBleGFjdCBmcmFjdGlvbiBvZiByYWRpYW5zIChpbiBzcGVjaWFsIGFuZ2xlIG1vZGUpXHJcbiAgICBjb25zdCBhbmdsZUxhYmVsVGV4dCA9IG5ldyBUZXh0KCBhbmdsZVN0cmluZywgZm9udEJvbGRJbmZvICk7XHJcbiAgICBjb25zdCBhbmdsZUxhYmVsRXF1YWxzVGV4dCA9IG5ldyBUZXh0KCBlcXVhbFN0cmluZywgZm9udEJvbGRJbmZvICk7XHJcbiAgICB0aGlzLmFuZ2xlUmVhZG91dERlY2ltYWwgPSBuZXcgVGV4dCggZnVsbEFuZ2xlVmFsdWUsIGZvbnRJbmZvICk7IC8vIGFuZ2xlIHJlYWRvdXQgYXMgZGVjaW1hbCBudW1iZXJcclxuICAgIHRoaXMuZnVsbEFuZ2xlRnJhY3Rpb25Ob2RlID0gbmV3IEZyYWN0aW9uTm9kZSggJycsICcnLCBmb250SW5mbyApOyAgLy8gbm9kZSByZXByZXNlbnRpbmcgZnJhY3Rpb25hbCBmb3JtIG9mIGZ1bGwgYW5nbGVcclxuXHJcbiAgICAvLyB1c2VkIHRvIGRpc3BsYXkgYW5nbGUgYXMgRnJhY3Rpb25Ob2RlIGluIFNwZWNpYWwgYW5nbGVzIG1vZGVcclxuICAgIHRoaXMuYW5nbGVSZWFkb3V0RnJhY3Rpb24gPSBuZXcgRnJhY3Rpb25Ob2RlKCAnJywgJycsIGZvbnRJbmZvICk7XHJcbiAgICB0aGlzLmFuZ2xlUmVhZG91dERlY2ltYWwudmlzaWJsZSA9IHRydWU7XHJcbiAgICB0aGlzLmFuZ2xlUmVhZG91dEZyYWN0aW9uLnZpc2libGUgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBFaXRoZXIgYW5nbGVSZWFkb3V0RGVjaW1hbCB2aXNpYmxlIChkZWNpbWFsIG51bWJlciB2YWx1ZXMpXHJcbiAgICAvLyBvciAoZnVsbEFuZ2xlRnJhY3Rpb25Ob2RlICsgYW5nbGVSZWFkb3V0RnJhY3Rpb24pIHZpc2libGUgaW4gU3BlY2lhbCBhbmdsZXMgbW9kZVxyXG4gICAgdGhpcy5jaGlsZHJlbiA9IFsgYW5nbGVMYWJlbFRleHQsIGFuZ2xlTGFiZWxFcXVhbHNUZXh0LCB0aGlzLmFuZ2xlUmVhZG91dERlY2ltYWwsIHRoaXMuZnVsbEFuZ2xlRnJhY3Rpb25Ob2RlLCB0aGlzLmFuZ2xlUmVhZG91dEZyYWN0aW9uIF07XHJcblxyXG4gICAgLy8gcm93IDIgbGF5b3V0XHJcbiAgICBjb25zdCBzcGFjaW5nID0gNDtcclxuICAgIGFuZ2xlTGFiZWxFcXVhbHNUZXh0LmxlZnQgPSBhbmdsZUxhYmVsVGV4dC5yaWdodCArIHNwYWNpbmc7XHJcbiAgICB0aGlzLmFuZ2xlUmVhZG91dERlY2ltYWwubGVmdCA9IGFuZ2xlTGFiZWxFcXVhbHNUZXh0LnJpZ2h0ICsgc3BhY2luZztcclxuICAgIHRoaXMuZnVsbEFuZ2xlRnJhY3Rpb25Ob2RlLmxlZnQgPSBhbmdsZUxhYmVsRXF1YWxzVGV4dC5yaWdodCArIHNwYWNpbmc7XHJcbiAgICB0aGlzLmFuZ2xlUmVhZG91dEZyYWN0aW9uLmxlZnQgPSB0aGlzLmZ1bGxBbmdsZUZyYWN0aW9uTm9kZS5yaWdodCArIHNwYWNpbmc7XHJcblxyXG4gICAgdHJpZ1RvdXJNb2RlbC5mdWxsQW5nbGVQcm9wZXJ0eS5saW5rKCBmdWxsQW5nbGUgPT4geyAgICAvLyBmdWxsQW5nbGUgaXMgaW4gcmFkaWFuc1xyXG4gICAgICB0aGlzLnNldEFuZ2xlUmVhZG91dCgpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHZpZXdQcm9wZXJ0aWVzLmFuZ2xlVW5pdHNQcm9wZXJ0eS5saW5rKCB1bml0cyA9PiB7XHJcbiAgICAgIHRoaXMuc2V0VW5pdHMoIHVuaXRzICk7XHJcbiAgICAgIGlmICggdW5pdHMgPT09ICdyYWRpYW5zJyAmJiB2aWV3UHJvcGVydGllcy5zcGVjaWFsQW5nbGVzVmlzaWJsZVByb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICAgIHRoaXMuZnVsbEFuZ2xlRnJhY3Rpb25Ob2RlLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuYW5nbGVSZWFkb3V0RnJhY3Rpb24udmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5hbmdsZVJlYWRvdXREZWNpbWFsLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB0aGlzLmZ1bGxBbmdsZUZyYWN0aW9uTm9kZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5hbmdsZVJlYWRvdXRGcmFjdGlvbi52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5hbmdsZVJlYWRvdXREZWNpbWFsLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuc2V0QW5nbGVSZWFkb3V0KCk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdmlld1Byb3BlcnRpZXMuc3BlY2lhbEFuZ2xlc1Zpc2libGVQcm9wZXJ0eS5saW5rKCBzcGVjaWFsQW5nbGVzVmlzaWJsZSA9PiB7XHJcblxyXG4gICAgICAvL3NlbGVjdCBjb3JyZWN0IGFuZ2xlIHJlYWRvdXRcclxuICAgICAgaWYgKCBzcGVjaWFsQW5nbGVzVmlzaWJsZSAmJiB2aWV3UHJvcGVydGllcy5hbmdsZVVuaXRzUHJvcGVydHkudmFsdWUgPT09ICdyYWRpYW5zJyApIHtcclxuICAgICAgICB0aGlzLmZ1bGxBbmdsZUZyYWN0aW9uTm9kZS52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmFuZ2xlUmVhZG91dEZyYWN0aW9uLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuYW5nbGVSZWFkb3V0RGVjaW1hbC52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdGhpcy5mdWxsQW5nbGVGcmFjdGlvbk5vZGUudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuYW5nbGVSZWFkb3V0RnJhY3Rpb24udmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuYW5nbGVSZWFkb3V0RGVjaW1hbC52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gc2V0IHByZWNpc2lvbiBvZiBhbmdsZSByZWFkb3V0IGluIGRlZ3JlZXM6XHJcbiAgICAgIC8vIGluIHNwZWNpYWwgYW5nbGVzIG1vZGUsIHplcm8gZGVjaW1hbCBwbGFjZXMgKGUuZy4gNDUgZGVnKSwgb3RoZXJ3aXNlIDEgZGVjaW1hbCBwbGFjZSAoZS5nLiA0NS4wIGRlZylcclxuICAgICAgaWYgKCBzcGVjaWFsQW5nbGVzVmlzaWJsZSApIHtcclxuICAgICAgICBjb25zdCBjdXJyZW50U21hbGxBbmdsZSA9IHRyaWdUb3VyTW9kZWwuZ2V0U21hbGxBbmdsZUluUmFkaWFucygpO1xyXG4gICAgICAgIHRyaWdUb3VyTW9kZWwuc2V0U3BlY2lhbEFuZ2xlV2l0aFNtYWxsQW5nbGUoIGN1cnJlbnRTbWFsbEFuZ2xlICk7XHJcbiAgICAgICAgdGhpcy5zZXRBbmdsZVJlYWRvdXRQcmVjaXNpb24oIDAgKTsgICAvL2ludGVnZXIgZGlzcGxheSBvZiBzcGVjaWFsIGFuZ2xlc1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIDEgZGVjaW1hbCBwbGFjZSBwcmVjaXNpb24gZm9yIGNvbnRpbnVvdXMgYW5nbGVzXHJcbiAgICAgICAgdGhpcy5zZXRBbmdsZVJlYWRvdXRQcmVjaXNpb24oIDEgKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnNldEFuZ2xlUmVhZG91dCgpO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCByZWFkb3V0IHVuaXRzIHRvIGVpdGhlciBkZWdyZWVzIG9yIHJhZGlhbnMuXHJcbiAgICogQHByaXZhdGVcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1bml0cyBvbmUgb2YgJ2RlZ3JlZXMnIHx8ICdyYWRpYW5zJ1xyXG4gICAqL1xyXG4gIHNldFVuaXRzKCB1bml0cyApIHtcclxuICAgIHRoaXMudW5pdHMgPSB1bml0cztcclxuICAgIGlmICggdW5pdHMgPT09ICdyYWRpYW5zJyApIHtcclxuICAgICAgY29uc3QgcmFkaWFuc1ZhbHVlID0gVXRpbHMudG9GaXhlZCggdGhpcy50cmlnVG91ck1vZGVsLmdldEZ1bGxBbmdsZUluUmFkaWFucygpLCAzICk7XHJcbiAgICAgIGNvbnN0IHVuaXRzU3RyaW5nID0gU3RyaW5nVXRpbHMuZm9ybWF0KCB2YWx1ZVVuaXRQYXR0ZXJuU3RyaW5nLCByYWRpYW5zVmFsdWUsIHJhZHNTdHJpbmcgKTtcclxuICAgICAgdGhpcy5hbmdsZVJlYWRvdXREZWNpbWFsLnN0cmluZyA9IHVuaXRzU3RyaW5nO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNvbnN0IHJvdW5kZWRBbmdsZSA9IFV0aWxzLnRvRml4ZWQoIHRoaXMudHJpZ1RvdXJNb2RlbC5nZXRGdWxsQW5nbGVJbkRlZ3JlZXMoKSwgdGhpcy5kZWNpbWFsUHJlY2lzaW9uICk7XHJcbiAgICAgIHRoaXMuYW5nbGVSZWFkb3V0RGVjaW1hbC5zdHJpbmcgPSBgJHtyb3VuZGVkQW5nbGV9XFx1MDBCMGA7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIGZ1bGxBbmdsZSByZWFkb3V0IHByZWNpc2lvbi5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGRlY2ltYWxQcmVjaXNpb25cclxuICAgKi9cclxuICBzZXRBbmdsZVJlYWRvdXRQcmVjaXNpb24oIGRlY2ltYWxQcmVjaXNpb24gKSB7XHJcbiAgICB0aGlzLmRlY2ltYWxQcmVjaXNpb24gPSBkZWNpbWFsUHJlY2lzaW9uO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgdW5pdCBmb3JtYXQgb2YgYW5nbGUgcmVhZG91dCBvZiByZWFkb3V0IHBhbmVsIGluIGRlZ3JlZXMsIHJhZGlhbnMsIG9yIHNwZWNpYWwgYW5nbGVzLlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgc2V0QW5nbGVSZWFkb3V0KCkge1xyXG4gICAgY29uc3QgcmFkaWFuc0Rpc3BsYXllZCA9IHRoaXMudmlld1Byb3BlcnRpZXMuYW5nbGVVbml0c1Byb3BlcnR5LnZhbHVlID09PSAncmFkaWFucyc7XHJcbiAgICBjb25zdCBzcGVjaWFsQW5nbGVzVmlzaWJsZSA9IHRoaXMudmlld1Byb3BlcnRpZXMuc3BlY2lhbEFuZ2xlc1Zpc2libGVQcm9wZXJ0eS52YWx1ZSA9PT0gdHJ1ZTtcclxuICAgIGlmICggIXJhZGlhbnNEaXNwbGF5ZWQgKSB7XHJcbiAgICAgIHRoaXMuYW5nbGVSZWFkb3V0RGVjaW1hbC5zdHJpbmcgPSBgJHtVdGlscy50b0ZpeGVkKCB0aGlzLnRyaWdUb3VyTW9kZWwuZ2V0RnVsbEFuZ2xlSW5EZWdyZWVzKCksIHRoaXMuZGVjaW1hbFByZWNpc2lvbiApfVxcdTAwQjBgO1xyXG4gICAgfVxyXG4gICAgaWYgKCByYWRpYW5zRGlzcGxheWVkICYmICFzcGVjaWFsQW5nbGVzVmlzaWJsZSApIHtcclxuICAgICAgdGhpcy5hbmdsZVJlYWRvdXREZWNpbWFsLnN0cmluZyA9IGAke1V0aWxzLnRvRml4ZWQoIHRoaXMudHJpZ1RvdXJNb2RlbC5mdWxsQW5nbGVQcm9wZXJ0eS52YWx1ZSwgMyApfSAke3JhZHNTdHJpbmd9YDtcclxuICAgIH1cclxuICAgIGlmICggcmFkaWFuc0Rpc3BsYXllZCAmJiBzcGVjaWFsQW5nbGVzVmlzaWJsZSApIHtcclxuICAgICAgdGhpcy5zZXRTcGVjaWFsQW5nbGVSZWFkb3V0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIHNwZWNpYWwgYW5nbGUgcmVhZG91dC5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIHNldFNwZWNpYWxBbmdsZVJlYWRvdXQoKSB7XHJcbiAgICB0aGlzLmFuZ2xlUmVhZG91dEZyYWN0aW9uLnZpc2libGUgPSB0cnVlO1xyXG5cclxuICAgIC8vIG5lZWQgaW50ZWdlciB2YWx1ZSBvZiBhbmdsZSwgc2luY2UgaW50ZXJuYWwgYXJpdGhtZXRpYyBvZnRlbiBub3QtcXVpdGUgaW50ZWdlclxyXG4gICAgbGV0IGFuZ2xlSW5EZWdzID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIHRoaXMudHJpZ1RvdXJNb2RlbC5nZXRGdWxsQW5nbGVJbkRlZ3JlZXMoKSApO1xyXG4gICAgaWYgKCBNYXRoLmFicyggYW5nbGVJbkRlZ3MgKSA+IDM2MCApIHtcclxuICAgICAgYW5nbGVJbkRlZ3MgPSBhbmdsZUluRGVncyAlIDM2MDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBudW1iZXIgb2YgZnVsbCB0dXJucyBhcm91bmQgdW5pdCBjaXJjbGUsIGluY3JlbWVudGVkIGF0IHRoZXRhID0gMFxyXG4gICAgY29uc3QgZnVsbFR1cm5Db3VudCA9IHRoaXMudHJpZ1RvdXJNb2RlbC5mdWxsVHVybkNvdW50O1xyXG4gICAgY29uc3QgcGlSYWRpYW5zQ291bnQgPSAyICogZnVsbFR1cm5Db3VudDsgLy8gbnVtYmVyIG9mIGhhbGYgdHVybnMgYXJvdW5kIHVuaXQgY2lyY2xlOyBoYWxmLXR1cm4gPSBwaSByYWRpYW5zXHJcbiAgICBsZXQgZnVsbFR1cm5TdHJpbmcgPSAnJzsgLy8gYW5nbGUgcmVhZG91dCBoYXMgZm9ybWF0IHRoZXRhID0gNHBpICsgKDEvMilwaSA9IGZ1bGxUdXJuU3RyaW5nICsgc21hbGwgYW5nbGVcclxuICAgIGlmICggcGlSYWRpYW5zQ291bnQgIT09IDAgKSB7XHJcbiAgICAgIGlmICggZnVsbFR1cm5Db3VudCA+IDAgKSB7XHJcbiAgICAgICAgZnVsbFR1cm5TdHJpbmcgPSBgJHtwaVJhZGlhbnNDb3VudCArIE1hdGhTeW1ib2xzLlBJfSArIGA7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgLy8gaWYgYW5nbGUgbmVnYXRpdmUsIG1pbnVzIHNpZ24gaXMgY29uc3RydWN0ZWQgaW4gRnJhY3Rpb25Ob2RlXHJcbiAgICAgICAgZnVsbFR1cm5TdHJpbmcgPSBgJHtwaVJhZGlhbnNDb3VudCArIE1hdGhTeW1ib2xzLlBJfSBgO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgLy8gaWYgemVybyB0dXJucywgc2V0IGZ1bGwgdHVybiBzdHJpbmcgdG8gbnVsbCBzdHJpbmcuXHJcbiAgICAgIGZ1bGxUdXJuU3RyaW5nID0gJyc7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5mdWxsQW5nbGVGcmFjdGlvbk5vZGUuc2V0VmFsdWVzKCBmdWxsVHVyblN0cmluZywgJycsIGZhbHNlICk7XHJcbiAgICB0aGlzLmFuZ2xlUmVhZG91dEZyYWN0aW9uLmxlZnQgPSB0aGlzLmZ1bGxBbmdsZUZyYWN0aW9uTm9kZS5yaWdodDtcclxuXHJcbiAgICAvLyBzZXQgdGhlIGFuZ2xlIHJlYWRvdXQsIG1ha2luZyBzdXJlIHRoYXQgdGhlIGFuZ2xlIGlzIGRlZmluZWQgaW4gdGhlIHNwZWNpYWwgZnJhY3Rpb25zIG9iamVjdFxyXG4gICAgY29uc3Qgc3BlY2lhbEFuZ2xlRnJhY3Rpb25zID0gU3BlY2lhbEFuZ2xlcy5TUEVDSUFMX0FOR0xFX0ZSQUNUSU9OUztcclxuICAgIGlmICggc3BlY2lhbEFuZ2xlRnJhY3Rpb25zWyBhbmdsZUluRGVncyBdIHx8IHNwZWNpYWxBbmdsZUZyYWN0aW9uc1sgLWFuZ2xlSW5EZWdzIF0gKSB7XHJcbiAgICAgIC8vIGNvcnJlY3QgZm9yIG5lZ2F0aXZlIGFuZ2xlcywgZnJhY3Rpb24gbXVzdCByZWZsZWN0IGlmIG5lZ2F0aXZlIGFuZCBvYmplY3RzIGluIFNwZWNpYWxBbmdsZXMgZG8gbm90IHRyYWNrXHJcbiAgICAgIC8vIHRoaXMgaW5mb3JtYXRpb25cclxuICAgICAgY29uc3Qgc2lnbiA9IGFuZ2xlSW5EZWdzID49IDAgPyAnJyA6ICctJztcclxuICAgICAgY29uc3QgY29lZmZpY2llbnQgPSBhbmdsZUluRGVncyA+PSAwID8gKzEgOiAtMTtcclxuICAgICAgdGhpcy5hbmdsZVJlYWRvdXRGcmFjdGlvbi5zZXRWYWx1ZXMoXHJcbiAgICAgICAgc2lnbiArIHNwZWNpYWxBbmdsZUZyYWN0aW9uc1sgY29lZmZpY2llbnQgKiBhbmdsZUluRGVncyBdLm51bWVyYXRvciwgLy8gc3RyaW5nIGNvbmNhdGVuYXRpb25cclxuICAgICAgICBzcGVjaWFsQW5nbGVGcmFjdGlvbnNbIGNvZWZmaWNpZW50ICogYW5nbGVJbkRlZ3MgXS5kZW5vbWluYXRvcixcclxuICAgICAgICBmYWxzZSAvKiBubyByYWRpY2FscyBmb3Igc3BlY2lhbCBhbmdsZSBmcmFjdGlvbnMgKi9cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBNdXN0IGhhbmRsZSBzbWFsbEFuZ2xlID0gMCBvciBwaSBhcyBzcGVjaWFsIGNhc2VzXHJcbiAgICBjb25zdCByb3VuZGVkQW5nbGUgPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggdGhpcy50cmlnVG91ck1vZGVsLmdldFNtYWxsQW5nbGVJbkRlZ3JlZXMoKSApO1xyXG4gICAgaWYgKCByb3VuZGVkQW5nbGUgPT09IDAgfHwgcm91bmRlZEFuZ2xlID09PSAxODAgKSB7XHJcbiAgICAgIGNvbnN0IG5iclBpUmFkcyA9IHRoaXMudHJpZ1RvdXJNb2RlbC5oYWxmVHVybkNvdW50O1xyXG4gICAgICBsZXQgYW5nbGVSYWRpYW5TdHJpbmcgPSBuYnJQaVJhZHMgKyBNYXRoU3ltYm9scy5QSTtcclxuICAgICAgaWYgKCBuYnJQaVJhZHMgPT09IDAgKSB7XHJcbiAgICAgICAgYW5nbGVSYWRpYW5TdHJpbmcgPSAnMCc7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIG5iclBpUmFkcyA9PT0gMSApIHtcclxuICAgICAgICBhbmdsZVJhZGlhblN0cmluZyA9IE1hdGhTeW1ib2xzLlBJO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBuYnJQaVJhZHMgPT09IC0xICkge1xyXG4gICAgICAgIGFuZ2xlUmFkaWFuU3RyaW5nID0gYC0ke01hdGhTeW1ib2xzLlBJfWA7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5mdWxsQW5nbGVGcmFjdGlvbk5vZGUuc2V0VmFsdWVzKCBhbmdsZVJhZGlhblN0cmluZywgJycgKTtcclxuXHJcbiAgICAgIC8vIGR1bW15IGFuZ2xlUmVhZG91dEZyYWN0aW9uIGlzIHNldCB0byBlbnN1cmUgYm91bmRzIHJlbWFpbiBjb25zdGFudCBhbmQgcmVhZG91dERpc3BsYXkgZG9lcyBub3QganVtcCBhcm91bmRcclxuICAgICAgdGhpcy5hbmdsZVJlYWRvdXRGcmFjdGlvbi5zZXRWYWx1ZXMoICdBJywgJ0InICk7XHJcbiAgICAgIHRoaXMuYW5nbGVSZWFkb3V0RnJhY3Rpb24udmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxudHJpZ1RvdXIucmVnaXN0ZXIoICdBbmdsZVJlYWRvdXRSb3cnLCBBbmdsZVJlYWRvdXRSb3cgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IEFuZ2xlUmVhZG91dFJvdzsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBTSxnQ0FBZ0M7QUFDbEQsT0FBT0MsV0FBVyxNQUFNLGtEQUFrRDtBQUMxRSxPQUFPQyxXQUFXLE1BQU0sK0NBQStDO0FBQ3ZFLE9BQU9DLFFBQVEsTUFBTSw0Q0FBNEM7QUFDakUsU0FBU0MsSUFBSSxFQUFFQyxJQUFJLFFBQVEsc0NBQXNDO0FBQ2pFLE9BQU9DLFFBQVEsTUFBTSxzQkFBc0I7QUFDM0MsT0FBT0MsZUFBZSxNQUFNLDZC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