// Copyright 2015-2022, University of Colorado Boulder

/**
 * Node for the spiral in Trig Tour.  The spiral in this sim grows with the angle of the simulation.
 *
 * @author Jesse Greenberg
 * @author Michael Dubson (PhET developer) on 6/2/2015
 */

import Utils from '../../../../dot/js/Utils.js';
import { Shape } from '../../../../kite/js/imports.js';
import merge from '../../../../phet-core/js/merge.js';
import { Image, Node, Path } from '../../../../scenery/js/imports.js';
import clockwiseSpiral_png from '../../../mipmaps/clockwiseSpiral_png.js';
import counterClockwiseSpiral_png from '../../../mipmaps/counterClockwiseSpiral_png.js';
import trigTour from '../../trigTour.js';
class TrigTourSpiralNode extends Node {
  /**
   * Constructor.
   * @param {TrigTourModel} trigTourModel
   * @param {number} initialRadius - initial radius of the spiral
   * @param {number} spiralAngle - total angle of the spiral shape
   * @param {Object} [options]
   */
  constructor(trigTourModel, initialRadius, spiralAngle, options) {
    options = merge({
      stroke: 'black',
      arrowHeadColor: 'black',
      arrowHeadLineWidth: 1,
      lineWidth: 2,
      preventFit: true
    }, options);
    super(options);

    // watch the current radius which points to the end point of the spiral
    this.endPointRadius = initialRadius; // @private
    this.initialRadius = initialRadius; // @private

    // draw an arrow head which will be placed at the outer end of the spiral
    const arrowHeadShape = new Shape();
    const arrowHeadWidth = 7;
    const arrowHeadLength = 12; //arrow head length
    arrowHeadShape.moveTo(0, 0).lineTo(-arrowHeadWidth / 2, arrowHeadLength).lineTo(arrowHeadWidth / 2, arrowHeadLength).close();
    this.angleArcArrowHead = new Path(arrowHeadShape, {
      lineWidth: options.arrowHeadLineWidth,
      fill: options.arrowHeadColor
    });

    //------------------------------------------------------------------------------------------------------------------
    /**
     * The following code is used to generate the spiral images used in this sim.
     *
     * The spiral path causes the simulation to perform poorly on tablets.  The path is then converted to an image with
     * Node.toImage().  Rendering the image causes a very long load time, so the rendered image was saved under
     * trig-tour/images so that it could be pulled from the image plugin.
     *
     * For more information, see https://github.com/phetsims/trig-tour/issues/62
     */

    // // draw the spiral with gradually increasing radius
    // var arcShape = new Shape();
    // arcShape.moveTo( this.endPointRadius, 0 ); // initial position of the spiral
    // var totalAngle = trigTourModel.getFullAngleInRadians();

    // // if the total angle is less than 0.5 radians, delta should be smaller for smoother lines
    // var deltaAngle = 0.1;
    // if ( Math.abs( totalAngle ) < 0.5 ) {
    //   deltaAngle = 0.02;
    // }

    // // approximate the spiral shape with line segments
    // var angle = 0;
    // if ( spiralAngle > 0 ) {
    //   for ( angle = 0; angle <= spiralAngle; angle += deltaAngle ) {
    //     if ( Math.abs( totalAngle ) < 0.5 ) {
    //       deltaAngle = 0.02;
    //     }
    //     this.endPointRadius += deltaAngle;
    //     arcShape.lineTo( this.endPointRadius * Math.cos( angle ), -this.endPointRadius * Math.sin( angle ) );
    //   }
    // }
    // else {
    //   for ( angle = 0; angle >= spiralAngle; angle -= deltaAngle ) {
    //     if ( Math.abs( totalAngle ) < 0.5 ) {
    //       deltaAngle = 0.02;
    //     }

    //     this.endPointRadius += deltaAngle;
    //     arcShape.lineTo( this.endPointRadius * Math.cos( angle ), -this.endPointRadius * Math.sin( angle ) );
    //   }
    // }

    // // apply the shape to a path, scaling it up for good resolution in the following image conversion
    // var imageScale = 3;
    // var spiralPath = new Path( arcShape, merge( { scale: imageScale }, options ) );

    // // convert the path to an image as a performance optimization
    // spiralPath.toImage( function( image, x, y ) {
    //   var spiralImage = new Image( image, { x: -x, y: -y } );
    //   spiralImage.scale( 1 / imageScale, 1 / imageScale, true );
    //   thisNode.children = [ spiralImage, thisNode.angleArcArrowHead ];
    //   console.log( image );
    // } );
    //------------------------------------------------------------------------------------------------------------------

    // apply the correct dimage to the node, generated by the code above
    // the image coordiniates are off after render, normalize and fix with offsets by visual inspection
    const imageScale = 3; // image was scaled by 3 in node.toImage
    const imageOffset = 1.6; // correct for small offset generated by saved image
    let spiralImage;
    let xImageOffset;
    let yImageOffset;
    if (spiralAngle > 0) {
      spiralImage = counterClockwiseSpiral_png;
      xImageOffset = -imageOffset;
      yImageOffset = imageOffset;
    } else {
      spiralImage = clockwiseSpiral_png;
      xImageOffset = -imageOffset;
      yImageOffset = -imageOffset;
    }
    const spiralImageNode = new Image(spiralImage);
    spiralImageNode.scale(1 / imageScale, 1 / imageScale, true);
    spiralImageNode.x = -spiralImageNode.width / 2 + xImageOffset;
    spiralImageNode.y = -spiralImageNode.height / 2 + yImageOffset;
    this.children = [spiralImageNode, this.angleArcArrowHead];

    // update the position of the arrow node whenever the full model angle changes
    trigTourModel.fullAngleProperty.link(fullAngle => {
      this.updateEndPointRadius(fullAngle);
      this.updateClipArea(fullAngle);
      this.updateArrowHead(fullAngle);
    });
  }

  /**
   * @private
   * @param {number} fullAngle
   */
  updateArrowHead(fullAngle) {
    // show arrow head on angle arc if angle is > 45 degrees
    this.angleArcArrowHead.visible = Math.abs(fullAngle) > Utils.toRadians(45);

    // position the arrow head
    this.angleArcArrowHead.x = this.endPointRadius * Math.cos(fullAngle);
    this.angleArcArrowHead.y = -this.endPointRadius * Math.sin(fullAngle);
    // orient arrow head on angle arc correctly
    if (fullAngle < 0) {
      this.angleArcArrowHead.rotation = Math.PI - fullAngle - 6 / this.endPointRadius;
    } else {
      this.angleArcArrowHead.rotation = -fullAngle + 6 / this.endPointRadius;
    }
  }

  /**
   * @private
   * @param {number} fullAngle
   */
  updateEndPointRadius(fullAngle) {
    this.endPointRadius = this.initialRadius;
    let deltaAngle;
    let angle;
    if (Math.abs(fullAngle) < 0.5) {
      deltaAngle = 0.02;
    } else {
      deltaAngle = 0.1;
    }
    if (fullAngle > 0) {
      for (angle = 0; angle <= fullAngle; angle += deltaAngle) {
        this.endPointRadius += deltaAngle;
      }
    } else {
      for (angle = 0; angle >= fullAngle; angle -= deltaAngle) {
        this.endPointRadius += deltaAngle;
      }
    }
  }

  /**
   * The clip area is a single loop of the spiral offset by a small amount to include the largest rotation of the full
   * spiral shape for the given angle.  Updating the clip area shape is a performance enhancement for redrawing
   * the entire spiral shape every frame.
   * @private
   *
   * @param {number} fullAngle
   */
  updateClipArea(fullAngle) {
    const clipShape = new Shape();

    // We'll build the clip shape with two arc segments. We need to compute the radius on each to be the average of
    // the equivalent spiral's starting and ending radii. We'll start at r0 and end at r1, so by drawing two arcs,
    // we'll have a radius in the middle of rHalf.
    const r0 = this.endPointRadius - 2.5;
    const r1 = r0 + Math.PI * 2;
    const rHalf = (r0 + r1) / 2;

    // The first arc's radius should be the average of its starting radius (r0) and ending radius (rHalf).
    const firstRadius = (r0 + rHalf) / 2;

    // The offset of the arc's center from the spiral's center, in the direction of fullAngle, such that our first
    // arc will go from magnitude-angle pairs of (r0,fullAngle) to (rHalf,fullAngle+pi).
    const firstOffset = (r0 - rHalf) / 2;

    // The second arc's radius should be the average of its starting radius (rHalf) and ending radius (r1).
    const secondRadius = (rHalf + r1) / 2;

    // The offset of the arc's center from the spiral's center, in the direction of fullAngle, such that our first
    // arc will go from magnitude-angle pairs of (rHalf,fullAngle+pi) to (r1,fullAngle+2pi).
    const secondOffset = (r1 - rHalf) / 2;

    // Because the angle is in the mathematical coordinate frame, we need to negate it so that it represents the angle
    // in our graphical coordinate frame, where the Y axis is flipped in direction (thus requiring the opposite angle).
    fullAngle = -fullAngle;

    // Based on the direction of the spiral, we need to modify the angles and whether the arcs are anticlockwise.
    let angle0;
    let angleHalf;
    let angle1;
    let anticlockwise;
    if (fullAngle < 0) {
      angle0 = fullAngle;
      angleHalf = fullAngle + Math.PI;
      angle1 = fullAngle + 2 * Math.PI;
      anticlockwise = true;
    } else {
      angle0 = fullAngle + 2 * Math.PI;
      angleHalf = fullAngle + Math.PI;
      angle1 = fullAngle;
      anticlockwise = false;
    }
    clipShape.arc(firstOffset * Math.cos(fullAngle), firstOffset * Math.sin(fullAngle), firstRadius, angle0, angleHalf, anticlockwise);
    clipShape.arc(secondOffset * Math.cos(fullAngle), secondOffset * Math.sin(fullAngle), secondRadius, angleHalf, angle1, anticlockwise);
    clipShape.close();
    this.clipArea = clipShape;
  }
}
trigTour.register('TrigTourSpiralNode', TrigTourSpiralNode);
export default TrigTourSpiralNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlNoYXBlIiwibWVyZ2UiLCJJbWFnZSIsIk5vZGUiLCJQYXRoIiwiY2xvY2t3aXNlU3BpcmFsX3BuZyIsImNvdW50ZXJDbG9ja3dpc2VTcGlyYWxfcG5nIiwidHJpZ1RvdXIiLCJUcmlnVG91clNwaXJhbE5vZGUiLCJjb25zdHJ1Y3RvciIsInRyaWdUb3VyTW9kZWwiLCJpbml0aWFsUmFkaXVzIiwic3BpcmFsQW5nbGUiLCJvcHRpb25zIiwic3Ryb2tlIiwiYXJyb3dIZWFkQ29sb3IiLCJhcnJvd0hlYWRMaW5lV2lkdGgiLCJsaW5lV2lkdGgiLCJwcmV2ZW50Rml0IiwiZW5kUG9pbnRSYWRpdXMiLCJhcnJvd0hlYWRTaGFwZSIsImFycm93SGVhZFdpZHRoIiwiYXJyb3dIZWFkTGVuZ3RoIiwibW92ZVRvIiwibGluZVRvIiwiY2xvc2UiLCJhbmdsZUFyY0Fycm93SGVhZCIsImZpbGwiLCJpbWFnZVNjYWxlIiwiaW1hZ2VPZmZzZXQiLCJzcGlyYWxJbWFnZSIsInhJbWFnZU9mZnNldCIsInlJbWFnZU9mZnNldCIsInNwaXJhbEltYWdlTm9kZSIsInNjYWxlIiwieCIsIndpZHRoIiwieSIsImhlaWdodCIsImNoaWxkcmVuIiwiZnVsbEFuZ2xlUHJvcGVydHkiLCJsaW5rIiwiZnVsbEFuZ2xlIiwidXBkYXRlRW5kUG9pbnRSYWRpdXMiLCJ1cGRhdGVDbGlwQXJlYSIsInVwZGF0ZUFycm93SGVhZCIsInZpc2libGUiLCJNYXRoIiwiYWJzIiwidG9SYWRpYW5zIiwiY29zIiwic2luIiwicm90YXRpb24iLCJQSSIsImRlbHRhQW5nbGUiLCJhbmdsZSIsImNsaXBTaGFwZSIsInIwIiwicjEiLCJySGFsZiIsImZpcnN0UmFkaXVzIiwiZmlyc3RPZmZzZXQiLCJzZWNvbmRSYWRpdXMiLCJzZWNvbmRPZmZzZXQiLCJhbmdsZTAiLCJhbmdsZUhhbGYiLCJhbmdsZTEiLCJhbnRpY2xvY2t3aXNlIiwiYXJjIiwiY2xpcEFyZWEiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlRyaWdUb3VyU3BpcmFsTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBOb2RlIGZvciB0aGUgc3BpcmFsIGluIFRyaWcgVG91ci4gIFRoZSBzcGlyYWwgaW4gdGhpcyBzaW0gZ3Jvd3Mgd2l0aCB0aGUgYW5nbGUgb2YgdGhlIHNpbXVsYXRpb24uXHJcbiAqXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnXHJcbiAqIEBhdXRob3IgTWljaGFlbCBEdWJzb24gKFBoRVQgZGV2ZWxvcGVyKSBvbiA2LzIvMjAxNVxyXG4gKi9cclxuXHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgeyBJbWFnZSwgTm9kZSwgUGF0aCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBjbG9ja3dpc2VTcGlyYWxfcG5nIGZyb20gJy4uLy4uLy4uL21pcG1hcHMvY2xvY2t3aXNlU3BpcmFsX3BuZy5qcyc7XHJcbmltcG9ydCBjb3VudGVyQ2xvY2t3aXNlU3BpcmFsX3BuZyBmcm9tICcuLi8uLi8uLi9taXBtYXBzL2NvdW50ZXJDbG9ja3dpc2VTcGlyYWxfcG5nLmpzJztcclxuaW1wb3J0IHRyaWdUb3VyIGZyb20gJy4uLy4uL3RyaWdUb3VyLmpzJztcclxuXHJcbmNsYXNzIFRyaWdUb3VyU3BpcmFsTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBDb25zdHJ1Y3Rvci5cclxuICAgKiBAcGFyYW0ge1RyaWdUb3VyTW9kZWx9IHRyaWdUb3VyTW9kZWxcclxuICAgKiBAcGFyYW0ge251bWJlcn0gaW5pdGlhbFJhZGl1cyAtIGluaXRpYWwgcmFkaXVzIG9mIHRoZSBzcGlyYWxcclxuICAgKiBAcGFyYW0ge251bWJlcn0gc3BpcmFsQW5nbGUgLSB0b3RhbCBhbmdsZSBvZiB0aGUgc3BpcmFsIHNoYXBlXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCB0cmlnVG91ck1vZGVsLCBpbml0aWFsUmFkaXVzLCBzcGlyYWxBbmdsZSwgb3B0aW9ucyApIHtcclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGFycm93SGVhZENvbG9yOiAnYmxhY2snLFxyXG4gICAgICBhcnJvd0hlYWRMaW5lV2lkdGg6IDEsXHJcbiAgICAgIGxpbmVXaWR0aDogMixcclxuICAgICAgcHJldmVudEZpdDogdHJ1ZVxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gd2F0Y2ggdGhlIGN1cnJlbnQgcmFkaXVzIHdoaWNoIHBvaW50cyB0byB0aGUgZW5kIHBvaW50IG9mIHRoZSBzcGlyYWxcclxuICAgIHRoaXMuZW5kUG9pbnRSYWRpdXMgPSBpbml0aWFsUmFkaXVzOyAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5pbml0aWFsUmFkaXVzID0gaW5pdGlhbFJhZGl1czsgLy8gQHByaXZhdGVcclxuXHJcbiAgICAvLyBkcmF3IGFuIGFycm93IGhlYWQgd2hpY2ggd2lsbCBiZSBwbGFjZWQgYXQgdGhlIG91dGVyIGVuZCBvZiB0aGUgc3BpcmFsXHJcbiAgICBjb25zdCBhcnJvd0hlYWRTaGFwZSA9IG5ldyBTaGFwZSgpO1xyXG4gICAgY29uc3QgYXJyb3dIZWFkV2lkdGggPSA3O1xyXG4gICAgY29uc3QgYXJyb3dIZWFkTGVuZ3RoID0gMTI7ICAgIC8vYXJyb3cgaGVhZCBsZW5ndGhcclxuICAgIGFycm93SGVhZFNoYXBlLm1vdmVUbyggMCwgMCApXHJcbiAgICAgIC5saW5lVG8oIC1hcnJvd0hlYWRXaWR0aCAvIDIsIGFycm93SGVhZExlbmd0aCApXHJcbiAgICAgIC5saW5lVG8oIGFycm93SGVhZFdpZHRoIC8gMiwgYXJyb3dIZWFkTGVuZ3RoIClcclxuICAgICAgLmNsb3NlKCk7XHJcbiAgICB0aGlzLmFuZ2xlQXJjQXJyb3dIZWFkID0gbmV3IFBhdGgoIGFycm93SGVhZFNoYXBlLCB7XHJcbiAgICAgIGxpbmVXaWR0aDogb3B0aW9ucy5hcnJvd0hlYWRMaW5lV2lkdGgsXHJcbiAgICAgIGZpbGw6IG9wdGlvbnMuYXJyb3dIZWFkQ29sb3JcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgZm9sbG93aW5nIGNvZGUgaXMgdXNlZCB0byBnZW5lcmF0ZSB0aGUgc3BpcmFsIGltYWdlcyB1c2VkIGluIHRoaXMgc2ltLlxyXG4gICAgICpcclxuICAgICAqIFRoZSBzcGlyYWwgcGF0aCBjYXVzZXMgdGhlIHNpbXVsYXRpb24gdG8gcGVyZm9ybSBwb29ybHkgb24gdGFibGV0cy4gIFRoZSBwYXRoIGlzIHRoZW4gY29udmVydGVkIHRvIGFuIGltYWdlIHdpdGhcclxuICAgICAqIE5vZGUudG9JbWFnZSgpLiAgUmVuZGVyaW5nIHRoZSBpbWFnZSBjYXVzZXMgYSB2ZXJ5IGxvbmcgbG9hZCB0aW1lLCBzbyB0aGUgcmVuZGVyZWQgaW1hZ2Ugd2FzIHNhdmVkIHVuZGVyXHJcbiAgICAgKiB0cmlnLXRvdXIvaW1hZ2VzIHNvIHRoYXQgaXQgY291bGQgYmUgcHVsbGVkIGZyb20gdGhlIGltYWdlIHBsdWdpbi5cclxuICAgICAqXHJcbiAgICAgKiBGb3IgbW9yZSBpbmZvcm1hdGlvbiwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy90cmlnLXRvdXIvaXNzdWVzLzYyXHJcbiAgICAgKi9cclxuXHJcbiAgICAgIC8vIC8vIGRyYXcgdGhlIHNwaXJhbCB3aXRoIGdyYWR1YWxseSBpbmNyZWFzaW5nIHJhZGl1c1xyXG4gICAgICAvLyB2YXIgYXJjU2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuICAgICAgLy8gYXJjU2hhcGUubW92ZVRvKCB0aGlzLmVuZFBvaW50UmFkaXVzLCAwICk7IC8vIGluaXRpYWwgcG9zaXRpb24gb2YgdGhlIHNwaXJhbFxyXG4gICAgICAvLyB2YXIgdG90YWxBbmdsZSA9IHRyaWdUb3VyTW9kZWwuZ2V0RnVsbEFuZ2xlSW5SYWRpYW5zKCk7XHJcblxyXG4gICAgICAvLyAvLyBpZiB0aGUgdG90YWwgYW5nbGUgaXMgbGVzcyB0aGFuIDAuNSByYWRpYW5zLCBkZWx0YSBzaG91bGQgYmUgc21hbGxlciBmb3Igc21vb3RoZXIgbGluZXNcclxuICAgICAgLy8gdmFyIGRlbHRhQW5nbGUgPSAwLjE7XHJcbiAgICAgIC8vIGlmICggTWF0aC5hYnMoIHRvdGFsQW5nbGUgKSA8IDAuNSApIHtcclxuICAgICAgLy8gICBkZWx0YUFuZ2xlID0gMC4wMjtcclxuICAgICAgLy8gfVxyXG5cclxuICAgICAgLy8gLy8gYXBwcm94aW1hdGUgdGhlIHNwaXJhbCBzaGFwZSB3aXRoIGxpbmUgc2VnbWVudHNcclxuICAgICAgLy8gdmFyIGFuZ2xlID0gMDtcclxuICAgICAgLy8gaWYgKCBzcGlyYWxBbmdsZSA+IDAgKSB7XHJcbiAgICAgIC8vICAgZm9yICggYW5nbGUgPSAwOyBhbmdsZSA8PSBzcGlyYWxBbmdsZTsgYW5nbGUgKz0gZGVsdGFBbmdsZSApIHtcclxuICAgICAgLy8gICAgIGlmICggTWF0aC5hYnMoIHRvdGFsQW5nbGUgKSA8IDAuNSApIHtcclxuICAgICAgLy8gICAgICAgZGVsdGFBbmdsZSA9IDAuMDI7XHJcbiAgICAgIC8vICAgICB9XHJcbiAgICAgIC8vICAgICB0aGlzLmVuZFBvaW50UmFkaXVzICs9IGRlbHRhQW5nbGU7XHJcbiAgICAgIC8vICAgICBhcmNTaGFwZS5saW5lVG8oIHRoaXMuZW5kUG9pbnRSYWRpdXMgKiBNYXRoLmNvcyggYW5nbGUgKSwgLXRoaXMuZW5kUG9pbnRSYWRpdXMgKiBNYXRoLnNpbiggYW5nbGUgKSApO1xyXG4gICAgICAvLyAgIH1cclxuICAgICAgLy8gfVxyXG4gICAgICAvLyBlbHNlIHtcclxuICAgICAgLy8gICBmb3IgKCBhbmdsZSA9IDA7IGFuZ2xlID49IHNwaXJhbEFuZ2xlOyBhbmdsZSAtPSBkZWx0YUFuZ2xlICkge1xyXG4gICAgICAvLyAgICAgaWYgKCBNYXRoLmFicyggdG90YWxBbmdsZSApIDwgMC41ICkge1xyXG4gICAgICAvLyAgICAgICBkZWx0YUFuZ2xlID0gMC4wMjtcclxuICAgICAgLy8gICAgIH1cclxuXHJcbiAgICAgIC8vICAgICB0aGlzLmVuZFBvaW50UmFkaXVzICs9IGRlbHRhQW5nbGU7XHJcbiAgICAgIC8vICAgICBhcmNTaGFwZS5saW5lVG8oIHRoaXMuZW5kUG9pbnRSYWRpdXMgKiBNYXRoLmNvcyggYW5nbGUgKSwgLXRoaXMuZW5kUG9pbnRSYWRpdXMgKiBNYXRoLnNpbiggYW5nbGUgKSApO1xyXG4gICAgICAvLyAgIH1cclxuICAgICAgLy8gfVxyXG5cclxuICAgICAgLy8gLy8gYXBwbHkgdGhlIHNoYXBlIHRvIGEgcGF0aCwgc2NhbGluZyBpdCB1cCBmb3IgZ29vZCByZXNvbHV0aW9uIGluIHRoZSBmb2xsb3dpbmcgaW1hZ2UgY29udmVyc2lvblxyXG4gICAgICAvLyB2YXIgaW1hZ2VTY2FsZSA9IDM7XHJcbiAgICAgIC8vIHZhciBzcGlyYWxQYXRoID0gbmV3IFBhdGgoIGFyY1NoYXBlLCBtZXJnZSggeyBzY2FsZTogaW1hZ2VTY2FsZSB9LCBvcHRpb25zICkgKTtcclxuXHJcbiAgICAgIC8vIC8vIGNvbnZlcnQgdGhlIHBhdGggdG8gYW4gaW1hZ2UgYXMgYSBwZXJmb3JtYW5jZSBvcHRpbWl6YXRpb25cclxuICAgICAgLy8gc3BpcmFsUGF0aC50b0ltYWdlKCBmdW5jdGlvbiggaW1hZ2UsIHgsIHkgKSB7XHJcbiAgICAgIC8vICAgdmFyIHNwaXJhbEltYWdlID0gbmV3IEltYWdlKCBpbWFnZSwgeyB4OiAteCwgeTogLXkgfSApO1xyXG4gICAgICAvLyAgIHNwaXJhbEltYWdlLnNjYWxlKCAxIC8gaW1hZ2VTY2FsZSwgMSAvIGltYWdlU2NhbGUsIHRydWUgKTtcclxuICAgICAgLy8gICB0aGlzTm9kZS5jaGlsZHJlbiA9IFsgc3BpcmFsSW1hZ2UsIHRoaXNOb2RlLmFuZ2xlQXJjQXJyb3dIZWFkIF07XHJcbiAgICAgIC8vICAgY29uc29sZS5sb2coIGltYWdlICk7XHJcbiAgICAgIC8vIH0gKTtcclxuICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgICAgIC8vIGFwcGx5IHRoZSBjb3JyZWN0IGRpbWFnZSB0byB0aGUgbm9kZSwgZ2VuZXJhdGVkIGJ5IHRoZSBjb2RlIGFib3ZlXHJcbiAgICAgIC8vIHRoZSBpbWFnZSBjb29yZGluaWF0ZXMgYXJlIG9mZiBhZnRlciByZW5kZXIsIG5vcm1hbGl6ZSBhbmQgZml4IHdpdGggb2Zmc2V0cyBieSB2aXN1YWwgaW5zcGVjdGlvblxyXG4gICAgY29uc3QgaW1hZ2VTY2FsZSA9IDM7IC8vIGltYWdlIHdhcyBzY2FsZWQgYnkgMyBpbiBub2RlLnRvSW1hZ2VcclxuICAgIGNvbnN0IGltYWdlT2Zmc2V0ID0gMS42OyAvLyBjb3JyZWN0IGZvciBzbWFsbCBvZmZzZXQgZ2VuZXJhdGVkIGJ5IHNhdmVkIGltYWdlXHJcbiAgICBsZXQgc3BpcmFsSW1hZ2U7XHJcbiAgICBsZXQgeEltYWdlT2Zmc2V0O1xyXG4gICAgbGV0IHlJbWFnZU9mZnNldDtcclxuICAgIGlmICggc3BpcmFsQW5nbGUgPiAwICkge1xyXG4gICAgICBzcGlyYWxJbWFnZSA9IGNvdW50ZXJDbG9ja3dpc2VTcGlyYWxfcG5nO1xyXG4gICAgICB4SW1hZ2VPZmZzZXQgPSAtaW1hZ2VPZmZzZXQ7XHJcbiAgICAgIHlJbWFnZU9mZnNldCA9IGltYWdlT2Zmc2V0O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHNwaXJhbEltYWdlID0gY2xvY2t3aXNlU3BpcmFsX3BuZztcclxuICAgICAgeEltYWdlT2Zmc2V0ID0gLWltYWdlT2Zmc2V0O1xyXG4gICAgICB5SW1hZ2VPZmZzZXQgPSAtaW1hZ2VPZmZzZXQ7XHJcbiAgICB9XHJcbiAgICBjb25zdCBzcGlyYWxJbWFnZU5vZGUgPSBuZXcgSW1hZ2UoIHNwaXJhbEltYWdlICk7XHJcbiAgICBzcGlyYWxJbWFnZU5vZGUuc2NhbGUoIDEgLyBpbWFnZVNjYWxlLCAxIC8gaW1hZ2VTY2FsZSwgdHJ1ZSApO1xyXG5cclxuICAgIHNwaXJhbEltYWdlTm9kZS54ID0gLXNwaXJhbEltYWdlTm9kZS53aWR0aCAvIDIgKyB4SW1hZ2VPZmZzZXQ7XHJcbiAgICBzcGlyYWxJbWFnZU5vZGUueSA9IC1zcGlyYWxJbWFnZU5vZGUuaGVpZ2h0IC8gMiArIHlJbWFnZU9mZnNldDtcclxuXHJcbiAgICB0aGlzLmNoaWxkcmVuID0gWyBzcGlyYWxJbWFnZU5vZGUsIHRoaXMuYW5nbGVBcmNBcnJvd0hlYWQgXTtcclxuXHJcbiAgICAvLyB1cGRhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBhcnJvdyBub2RlIHdoZW5ldmVyIHRoZSBmdWxsIG1vZGVsIGFuZ2xlIGNoYW5nZXNcclxuICAgIHRyaWdUb3VyTW9kZWwuZnVsbEFuZ2xlUHJvcGVydHkubGluayggZnVsbEFuZ2xlID0+IHtcclxuICAgICAgdGhpcy51cGRhdGVFbmRQb2ludFJhZGl1cyggZnVsbEFuZ2xlICk7XHJcbiAgICAgIHRoaXMudXBkYXRlQ2xpcEFyZWEoIGZ1bGxBbmdsZSApO1xyXG4gICAgICB0aGlzLnVwZGF0ZUFycm93SGVhZCggZnVsbEFuZ2xlICk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogQHByaXZhdGVcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZnVsbEFuZ2xlXHJcbiAgICovXHJcbiAgdXBkYXRlQXJyb3dIZWFkKCBmdWxsQW5nbGUgKSB7XHJcbiAgICAvLyBzaG93IGFycm93IGhlYWQgb24gYW5nbGUgYXJjIGlmIGFuZ2xlIGlzID4gNDUgZGVncmVlc1xyXG4gICAgdGhpcy5hbmdsZUFyY0Fycm93SGVhZC52aXNpYmxlID0gTWF0aC5hYnMoIGZ1bGxBbmdsZSApID4gVXRpbHMudG9SYWRpYW5zKCA0NSApO1xyXG5cclxuICAgIC8vIHBvc2l0aW9uIHRoZSBhcnJvdyBoZWFkXHJcbiAgICB0aGlzLmFuZ2xlQXJjQXJyb3dIZWFkLnggPSB0aGlzLmVuZFBvaW50UmFkaXVzICogTWF0aC5jb3MoIGZ1bGxBbmdsZSApO1xyXG4gICAgdGhpcy5hbmdsZUFyY0Fycm93SGVhZC55ID0gLXRoaXMuZW5kUG9pbnRSYWRpdXMgKiBNYXRoLnNpbiggZnVsbEFuZ2xlICk7XHJcbiAgICAvLyBvcmllbnQgYXJyb3cgaGVhZCBvbiBhbmdsZSBhcmMgY29ycmVjdGx5XHJcbiAgICBpZiAoIGZ1bGxBbmdsZSA8IDAgKSB7XHJcbiAgICAgIHRoaXMuYW5nbGVBcmNBcnJvd0hlYWQucm90YXRpb24gPSBNYXRoLlBJIC0gZnVsbEFuZ2xlIC0gKCA2IC8gdGhpcy5lbmRQb2ludFJhZGl1cyApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMuYW5nbGVBcmNBcnJvd0hlYWQucm90YXRpb24gPSAtZnVsbEFuZ2xlICsgKCA2IC8gdGhpcy5lbmRQb2ludFJhZGl1cyApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHByaXZhdGVcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZnVsbEFuZ2xlXHJcbiAgICovXHJcbiAgdXBkYXRlRW5kUG9pbnRSYWRpdXMoIGZ1bGxBbmdsZSApIHtcclxuICAgIHRoaXMuZW5kUG9pbnRSYWRpdXMgPSB0aGlzLmluaXRpYWxSYWRpdXM7XHJcbiAgICBsZXQgZGVsdGFBbmdsZTtcclxuICAgIGxldCBhbmdsZTtcclxuICAgIGlmICggTWF0aC5hYnMoIGZ1bGxBbmdsZSApIDwgMC41ICkge1xyXG4gICAgICBkZWx0YUFuZ2xlID0gMC4wMjtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBkZWx0YUFuZ2xlID0gMC4xO1xyXG4gICAgfVxyXG4gICAgaWYgKCBmdWxsQW5nbGUgPiAwICkge1xyXG4gICAgICBmb3IgKCBhbmdsZSA9IDA7IGFuZ2xlIDw9IGZ1bGxBbmdsZTsgYW5nbGUgKz0gZGVsdGFBbmdsZSApIHtcclxuICAgICAgICB0aGlzLmVuZFBvaW50UmFkaXVzICs9IGRlbHRhQW5nbGU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBmb3IgKCBhbmdsZSA9IDA7IGFuZ2xlID49IGZ1bGxBbmdsZTsgYW5nbGUgLT0gZGVsdGFBbmdsZSApIHtcclxuICAgICAgICB0aGlzLmVuZFBvaW50UmFkaXVzICs9IGRlbHRhQW5nbGU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSBjbGlwIGFyZWEgaXMgYSBzaW5nbGUgbG9vcCBvZiB0aGUgc3BpcmFsIG9mZnNldCBieSBhIHNtYWxsIGFtb3VudCB0byBpbmNsdWRlIHRoZSBsYXJnZXN0IHJvdGF0aW9uIG9mIHRoZSBmdWxsXHJcbiAgICogc3BpcmFsIHNoYXBlIGZvciB0aGUgZ2l2ZW4gYW5nbGUuICBVcGRhdGluZyB0aGUgY2xpcCBhcmVhIHNoYXBlIGlzIGEgcGVyZm9ybWFuY2UgZW5oYW5jZW1lbnQgZm9yIHJlZHJhd2luZ1xyXG4gICAqIHRoZSBlbnRpcmUgc3BpcmFsIHNoYXBlIGV2ZXJ5IGZyYW1lLlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZnVsbEFuZ2xlXHJcbiAgICovXHJcbiAgdXBkYXRlQ2xpcEFyZWEoIGZ1bGxBbmdsZSApIHtcclxuXHJcbiAgICBjb25zdCBjbGlwU2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuXHJcbiAgICAvLyBXZSdsbCBidWlsZCB0aGUgY2xpcCBzaGFwZSB3aXRoIHR3byBhcmMgc2VnbWVudHMuIFdlIG5lZWQgdG8gY29tcHV0ZSB0aGUgcmFkaXVzIG9uIGVhY2ggdG8gYmUgdGhlIGF2ZXJhZ2Ugb2ZcclxuICAgIC8vIHRoZSBlcXVpdmFsZW50IHNwaXJhbCdzIHN0YXJ0aW5nIGFuZCBlbmRpbmcgcmFkaWkuIFdlJ2xsIHN0YXJ0IGF0IHIwIGFuZCBlbmQgYXQgcjEsIHNvIGJ5IGRyYXdpbmcgdHdvIGFyY3MsXHJcbiAgICAvLyB3ZSdsbCBoYXZlIGEgcmFkaXVzIGluIHRoZSBtaWRkbGUgb2YgckhhbGYuXHJcbiAgICBjb25zdCByMCA9IHRoaXMuZW5kUG9pbnRSYWRpdXMgLSAyLjU7XHJcbiAgICBjb25zdCByMSA9IHIwICsgTWF0aC5QSSAqIDI7XHJcbiAgICBjb25zdCBySGFsZiA9ICggcjAgKyByMSApIC8gMjtcclxuXHJcbiAgICAvLyBUaGUgZmlyc3QgYXJjJ3MgcmFkaXVzIHNob3VsZCBiZSB0aGUgYXZlcmFnZSBvZiBpdHMgc3RhcnRpbmcgcmFkaXVzIChyMCkgYW5kIGVuZGluZyByYWRpdXMgKHJIYWxmKS5cclxuICAgIGNvbnN0IGZpcnN0UmFkaXVzID0gKCByMCArIHJIYWxmICkgLyAyO1xyXG5cclxuICAgIC8vIFRoZSBvZmZzZXQgb2YgdGhlIGFyYydzIGNlbnRlciBmcm9tIHRoZSBzcGlyYWwncyBjZW50ZXIsIGluIHRoZSBkaXJlY3Rpb24gb2YgZnVsbEFuZ2xlLCBzdWNoIHRoYXQgb3VyIGZpcnN0XHJcbiAgICAvLyBhcmMgd2lsbCBnbyBmcm9tIG1hZ25pdHVkZS1hbmdsZSBwYWlycyBvZiAocjAsZnVsbEFuZ2xlKSB0byAockhhbGYsZnVsbEFuZ2xlK3BpKS5cclxuICAgIGNvbnN0IGZpcnN0T2Zmc2V0ID0gKCByMCAtIHJIYWxmICkgLyAyO1xyXG5cclxuICAgIC8vIFRoZSBzZWNvbmQgYXJjJ3MgcmFkaXVzIHNob3VsZCBiZSB0aGUgYXZlcmFnZSBvZiBpdHMgc3RhcnRpbmcgcmFkaXVzIChySGFsZikgYW5kIGVuZGluZyByYWRpdXMgKHIxKS5cclxuICAgIGNvbnN0IHNlY29uZFJhZGl1cyA9ICggckhhbGYgKyByMSApIC8gMjtcclxuXHJcbiAgICAvLyBUaGUgb2Zmc2V0IG9mIHRoZSBhcmMncyBjZW50ZXIgZnJvbSB0aGUgc3BpcmFsJ3MgY2VudGVyLCBpbiB0aGUgZGlyZWN0aW9uIG9mIGZ1bGxBbmdsZSwgc3VjaCB0aGF0IG91ciBmaXJzdFxyXG4gICAgLy8gYXJjIHdpbGwgZ28gZnJvbSBtYWduaXR1ZGUtYW5nbGUgcGFpcnMgb2YgKHJIYWxmLGZ1bGxBbmdsZStwaSkgdG8gKHIxLGZ1bGxBbmdsZSsycGkpLlxyXG4gICAgY29uc3Qgc2Vjb25kT2Zmc2V0ID0gKCByMSAtIHJIYWxmICkgLyAyO1xyXG5cclxuICAgIC8vIEJlY2F1c2UgdGhlIGFuZ2xlIGlzIGluIHRoZSBtYXRoZW1hdGljYWwgY29vcmRpbmF0ZSBmcmFtZSwgd2UgbmVlZCB0byBuZWdhdGUgaXQgc28gdGhhdCBpdCByZXByZXNlbnRzIHRoZSBhbmdsZVxyXG4gICAgLy8gaW4gb3VyIGdyYXBoaWNhbCBjb29yZGluYXRlIGZyYW1lLCB3aGVyZSB0aGUgWSBheGlzIGlzIGZsaXBwZWQgaW4gZGlyZWN0aW9uICh0aHVzIHJlcXVpcmluZyB0aGUgb3Bwb3NpdGUgYW5nbGUpLlxyXG4gICAgZnVsbEFuZ2xlID0gLWZ1bGxBbmdsZTtcclxuXHJcbiAgICAvLyBCYXNlZCBvbiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBzcGlyYWwsIHdlIG5lZWQgdG8gbW9kaWZ5IHRoZSBhbmdsZXMgYW5kIHdoZXRoZXIgdGhlIGFyY3MgYXJlIGFudGljbG9ja3dpc2UuXHJcbiAgICBsZXQgYW5nbGUwO1xyXG4gICAgbGV0IGFuZ2xlSGFsZjtcclxuICAgIGxldCBhbmdsZTE7XHJcbiAgICBsZXQgYW50aWNsb2Nrd2lzZTtcclxuICAgIGlmICggZnVsbEFuZ2xlIDwgMCApIHtcclxuICAgICAgYW5nbGUwID0gZnVsbEFuZ2xlO1xyXG4gICAgICBhbmdsZUhhbGYgPSBmdWxsQW5nbGUgKyBNYXRoLlBJO1xyXG4gICAgICBhbmdsZTEgPSBmdWxsQW5nbGUgKyAyICogTWF0aC5QSTtcclxuICAgICAgYW50aWNsb2Nrd2lzZSA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgYW5nbGUwID0gZnVsbEFuZ2xlICsgMiAqIE1hdGguUEk7XHJcbiAgICAgIGFuZ2xlSGFsZiA9IGZ1bGxBbmdsZSArIE1hdGguUEk7XHJcbiAgICAgIGFuZ2xlMSA9IGZ1bGxBbmdsZTtcclxuICAgICAgYW50aWNsb2Nrd2lzZSA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNsaXBTaGFwZS5hcmMoIGZpcnN0T2Zmc2V0ICogTWF0aC5jb3MoIGZ1bGxBbmdsZSApLCBmaXJzdE9mZnNldCAqIE1hdGguc2luKCBmdWxsQW5nbGUgKSxcclxuICAgICAgZmlyc3RSYWRpdXMsIGFuZ2xlMCwgYW5nbGVIYWxmLCBhbnRpY2xvY2t3aXNlICk7XHJcbiAgICBjbGlwU2hhcGUuYXJjKCBzZWNvbmRPZmZzZXQgKiBNYXRoLmNvcyggZnVsbEFuZ2xlICksIHNlY29uZE9mZnNldCAqIE1hdGguc2luKCBmdWxsQW5nbGUgKSxcclxuICAgICAgc2Vjb25kUmFkaXVzLCBhbmdsZUhhbGYsIGFuZ2xlMSwgYW50aWNsb2Nrd2lzZSApO1xyXG5cclxuICAgIGNsaXBTaGFwZS5jbG9zZSgpO1xyXG4gICAgdGhpcy5jbGlwQXJlYSA9IGNsaXBTaGFwZTtcclxuICB9XHJcbn1cclxuXHJcbnRyaWdUb3VyLnJlZ2lzdGVyKCAnVHJpZ1RvdXJTcGlyYWxOb2RlJywgVHJpZ1RvdXJTcGlyYWxOb2RlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBU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