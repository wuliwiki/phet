// Copyright 2014-2023, University of Colorado Boulder

/**
 * Visual representation of a diatomic molecule.
 * Children position themselves in global coordinates, so this node's position should be (0,0).
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import optionize from '../../../../phet-core/js/optionize.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import { Node } from '../../../../scenery/js/imports.js';
import MPQueryParameters from '../../common/MPQueryParameters.js';
import AtomNode from '../../common/view/AtomNode.js';
import BondDipoleNode from '../../common/view/BondDipoleNode.js';
import BondNode from '../../common/view/BondNode.js';
import MoleculeAngleDragListener from '../../common/view/MoleculeAngleDragListener.js';
import PartialChargeNode from '../../common/view/PartialChargeNode.js';
import TranslateArrowsNode from '../../common/view/TranslateArrowsNode.js';
import moleculePolarity from '../../moleculePolarity.js';
import ElectronDensitySurfaceNode from './ElectronDensitySurfaceNode.js';
import ElectrostaticPotentialSurfaceNode from './ElectrostaticPotentialSurfaceNode.js';
export default class DiatomicMoleculeNode extends Node {
  constructor(molecule, viewProperties, providedOptions) {
    const options = optionize()({
      // NodeOptions
      cursor: 'pointer',
      phetioInputEnabledPropertyInstrumented: true
    }, providedOptions);

    // atoms
    const atomANode = new AtomNode(molecule.atomA, {
      tandem: options.tandem.createTandem('atomANode')
    });
    const atomBNode = new AtomNode(molecule.atomB, {
      tandem: options.tandem.createTandem('atomBNode')
    });

    // bond
    const bondNode = new BondNode(molecule.bond, {
      tandem: options.tandem.createTandem('bondNode')
    });

    // arrows to provide interaction hints
    const hintArrowsTandem = options.tandem.createTandem('hintArrowsNode');
    const hintArrowANode = new TranslateArrowsNode(molecule, molecule.atomA, {
      pickable: false,
      tandem: hintArrowsTandem.createTandem('hintArrowANode')
    });
    const hintArrowBNode = new TranslateArrowsNode(molecule, molecule.atomB, {
      pickable: false,
      tandem: hintArrowsTandem.createTandem('hintArrowBNode')
    });
    const hintArrowsNode = new Node({
      children: [hintArrowANode, hintArrowBNode],
      tandem: hintArrowsTandem,
      visiblePropertyOptions: {
        phetioDocumentation: 'Set to false to permanently hide hint arrows.'
      }
    });

    // partial charge
    const partialChargeANode = PartialChargeNode.createOppositePartialChargeNode(molecule.atomA, molecule.bond, {
      visibleProperty: viewProperties.partialChargesVisibleProperty
    });
    const partialChargeBNode = PartialChargeNode.createOppositePartialChargeNode(molecule.atomB, molecule.bond, {
      visibleProperty: viewProperties.partialChargesVisibleProperty
    });

    // surfaces
    const electrostaticPotentialSurfaceNode = new ElectrostaticPotentialSurfaceNode(molecule, {
      tandem: options.tandem.createTandem('electrostaticPotentialSurfaceNode')
    });
    const electronDensitySurfaceNode = new ElectronDensitySurfaceNode(molecule, {
      tandem: options.tandem.createTandem('electronDensitySurfaceNode')
    });

    // dipole
    const bondDipoleNode = new BondDipoleNode(molecule.bond, {
      visibleProperty: viewProperties.bondDipoleVisibleProperty
    });
    options.children = [electrostaticPotentialSurfaceNode, electronDensitySurfaceNode, bondNode, atomANode, atomBNode, hintArrowsNode, partialChargeANode, partialChargeBNode, bondDipoleNode];
    super(options);

    // rotate molecule by dragging anywhere
    const dragListener = new MoleculeAngleDragListener(molecule, this, {
      phetioDocumentation: 'rotates the molecule by dragging anywhere on it',
      tandem: options.tandem.createTandem('dragListener')
    });
    this.addInputListener(dragListener);
    viewProperties.surfaceTypeProperty.link(surfaceType => {
      electrostaticPotentialSurfaceNode.visible = surfaceType === 'electrostaticPotential';
      electronDensitySurfaceNode.visible = surfaceType === 'electronDensity';
    });

    // {boolean} Set to true when the molecule has been changed by the user.
    let moleculeHasChanged = false;

    // Hides the hint arrows if the molecule becomes non-interactive.
    // Set the hint arrows individually, because hintArrowsNode.visibleProperty is for use by PhET-iO.
    const updateHintArrows = () => {
      hintArrowANode.visible = hintArrowBNode.visible = !moleculeHasChanged && this.inputEnabled;
    };

    // When the user drags any atom or bond, hide the hint arrows.
    const hideArrows = () => {
      if (molecule.isDraggingProperty.value) {
        moleculeHasChanged = true;
        updateHintArrows();
      }
    };
    molecule.angleProperty.lazyLink(hideArrows);
    this.inputEnabledProperty.link(() => updateHintArrows());

    // Show molecule angle as an arrow that points from the center to the atom in the direction of angle.
    if (MPQueryParameters.showMoleculeAngle) {
      const arrowNode = new ArrowNode(0, 0, 100, 0, {
        fill: 'red',
        translation: molecule.position
      });
      this.addChild(arrowNode);
      molecule.angleProperty.link(angle => arrowNode.setRotation(angle));
    }
    this.resetDiatomicMoleculeNode = () => {
      moleculeHasChanged = false;
      updateHintArrows();
    };
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
  reset() {
    this.resetDiatomicMoleculeNode();
  }
}
moleculePolarity.register('DiatomicMoleculeNode', DiatomicMoleculeNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJvcHRpb25pemUiLCJBcnJvd05vZGUiLCJOb2RlIiwiTVBRdWVyeVBhcmFtZXRlcnMiLCJBdG9tTm9kZSIsIkJvbmREaXBvbGVOb2RlIiwiQm9uZE5vZGUiLCJNb2xlY3VsZUFuZ2xlRHJhZ0xpc3RlbmVyIiwiUGFydGlhbENoYXJnZU5vZGUiLCJUcmFuc2xhdGVBcnJvd3NOb2RlIiwibW9sZWN1bGVQb2xhcml0eSIsIkVsZWN0cm9uRGVuc2l0eVN1cmZhY2VOb2RlIiwiRWxlY3Ryb3N0YXRpY1BvdGVudGlhbFN1cmZhY2VOb2RlIiwiRGlhdG9taWNNb2xlY3VsZU5vZGUiLCJjb25zdHJ1Y3RvciIsIm1vbGVjdWxlIiwidmlld1Byb3BlcnRpZXMiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiY3Vyc29yIiwicGhldGlvSW5wdXRFbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQiLCJhdG9tQU5vZGUiLCJhdG9tQSIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsImF0b21CTm9kZSIsImF0b21CIiwiYm9uZE5vZGUiLCJib25kIiwiaGludEFycm93c1RhbmRlbSIsImhpbnRBcnJvd0FOb2RlIiwicGlja2FibGUiLCJoaW50QXJyb3dCTm9kZSIsImhpbnRBcnJvd3NOb2RlIiwiY2hpbGRyZW4iLCJ2aXNpYmxlUHJvcGVydHlPcHRpb25zIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsInBhcnRpYWxDaGFyZ2VBTm9kZSIsImNyZWF0ZU9wcG9zaXRlUGFydGlhbENoYXJnZU5vZGUiLCJ2aXNpYmxlUHJvcGVydHkiLCJwYXJ0aWFsQ2hhcmdlc1Zpc2libGVQcm9wZXJ0eSIsInBhcnRpYWxDaGFyZ2VCTm9kZSIsImVsZWN0cm9zdGF0aWNQb3RlbnRpYWxTdXJmYWNlTm9kZSIsImVsZWN0cm9uRGVuc2l0eVN1cmZhY2VOb2RlIiwiYm9uZERpcG9sZU5vZGUiLCJib25kRGlwb2xlVmlzaWJsZVByb3BlcnR5IiwiZHJhZ0xpc3RlbmVyIiwiYWRkSW5wdXRMaXN0ZW5lciIsInN1cmZhY2VUeXBlUHJvcGVydHkiLCJsaW5rIiwic3VyZmFjZVR5cGUiLCJ2aXNpYmxlIiwibW9sZWN1bGVIYXNDaGFuZ2VkIiwidXBkYXRlSGludEFycm93cyIsImlucHV0RW5hYmxlZCIsImhpZGVBcnJvd3MiLCJpc0RyYWdnaW5nUHJvcGVydHkiLCJ2YWx1ZSIsImFuZ2xlUHJvcGVydHkiLCJsYXp5TGluayIsImlucHV0RW5hYmxlZFByb3BlcnR5Iiwic2hvd01vbGVjdWxlQW5nbGUiLCJhcnJvd05vZGUiLCJmaWxsIiwidHJhbnNsYXRpb24iLCJwb3NpdGlvbiIsImFkZENoaWxkIiwiYW5nbGUiLCJzZXRSb3RhdGlvbiIsInJlc2V0RGlhdG9taWNNb2xlY3VsZU5vZGUiLCJkaXNwb3NlIiwiYXNzZXJ0IiwicmVzZXQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkRpYXRvbWljTW9sZWN1bGVOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFZpc3VhbCByZXByZXNlbnRhdGlvbiBvZiBhIGRpYXRvbWljIG1vbGVjdWxlLlxyXG4gKiBDaGlsZHJlbiBwb3NpdGlvbiB0aGVtc2VsdmVzIGluIGdsb2JhbCBjb29yZGluYXRlcywgc28gdGhpcyBub2RlJ3MgcG9zaXRpb24gc2hvdWxkIGJlICgwLDApLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgQXJyb3dOb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9BcnJvd05vZGUuanMnO1xyXG5pbXBvcnQgeyBOb2RlLCBOb2RlT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBNUFF1ZXJ5UGFyYW1ldGVycyBmcm9tICcuLi8uLi9jb21tb24vTVBRdWVyeVBhcmFtZXRlcnMuanMnO1xyXG5pbXBvcnQgQXRvbU5vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvQXRvbU5vZGUuanMnO1xyXG5pbXBvcnQgQm9uZERpcG9sZU5vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvQm9uZERpcG9sZU5vZGUuanMnO1xyXG5pbXBvcnQgQm9uZE5vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvQm9uZE5vZGUuanMnO1xyXG5pbXBvcnQgTW9sZWN1bGVBbmdsZURyYWdMaXN0ZW5lciBmcm9tICcuLi8uLi9jb21tb24vdmlldy9Nb2xlY3VsZUFuZ2xlRHJhZ0xpc3RlbmVyLmpzJztcclxuaW1wb3J0IFBhcnRpYWxDaGFyZ2VOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L1BhcnRpYWxDaGFyZ2VOb2RlLmpzJztcclxuaW1wb3J0IFRyYW5zbGF0ZUFycm93c05vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvVHJhbnNsYXRlQXJyb3dzTm9kZS5qcyc7XHJcbmltcG9ydCBtb2xlY3VsZVBvbGFyaXR5IGZyb20gJy4uLy4uL21vbGVjdWxlUG9sYXJpdHkuanMnO1xyXG5pbXBvcnQgRGlhdG9taWNNb2xlY3VsZSBmcm9tICcuLi9tb2RlbC9EaWF0b21pY01vbGVjdWxlLmpzJztcclxuaW1wb3J0IEVsZWN0cm9uRGVuc2l0eVN1cmZhY2VOb2RlIGZyb20gJy4vRWxlY3Ryb25EZW5zaXR5U3VyZmFjZU5vZGUuanMnO1xyXG5pbXBvcnQgRWxlY3Ryb3N0YXRpY1BvdGVudGlhbFN1cmZhY2VOb2RlIGZyb20gJy4vRWxlY3Ryb3N0YXRpY1BvdGVudGlhbFN1cmZhY2VOb2RlLmpzJztcclxuaW1wb3J0IFR3b0F0b21zVmlld1Byb3BlcnRpZXMgZnJvbSAnLi9Ud29BdG9tc1ZpZXdQcm9wZXJ0aWVzLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSBFbXB0eVNlbGZPcHRpb25zO1xyXG5cclxudHlwZSBEaWF0b21pY01vbGVjdWxlTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxOb2RlT3B0aW9ucywgJ3RhbmRlbSc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGlhdG9taWNNb2xlY3VsZU5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSByZXNldERpYXRvbWljTW9sZWN1bGVOb2RlOiAoKSA9PiB2b2lkO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG1vbGVjdWxlOiBEaWF0b21pY01vbGVjdWxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgdmlld1Byb3BlcnRpZXM6IFR3b0F0b21zVmlld1Byb3BlcnRpZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnM6IERpYXRvbWljTW9sZWN1bGVOb2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPERpYXRvbWljTW9sZWN1bGVOb2RlT3B0aW9ucywgU2VsZk9wdGlvbnMsIE5vZGVPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBOb2RlT3B0aW9uc1xyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcclxuICAgICAgcGhldGlvSW5wdXRFbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQ6IHRydWVcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIC8vIGF0b21zXHJcbiAgICBjb25zdCBhdG9tQU5vZGUgPSBuZXcgQXRvbU5vZGUoIG1vbGVjdWxlLmF0b21BLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnYXRvbUFOb2RlJyApXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBhdG9tQk5vZGUgPSBuZXcgQXRvbU5vZGUoIG1vbGVjdWxlLmF0b21CLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnYXRvbUJOb2RlJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYm9uZFxyXG4gICAgY29uc3QgYm9uZE5vZGUgPSBuZXcgQm9uZE5vZGUoIG1vbGVjdWxlLmJvbmQsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdib25kTm9kZScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGFycm93cyB0byBwcm92aWRlIGludGVyYWN0aW9uIGhpbnRzXHJcbiAgICBjb25zdCBoaW50QXJyb3dzVGFuZGVtID0gb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnaGludEFycm93c05vZGUnICk7XHJcbiAgICBjb25zdCBoaW50QXJyb3dBTm9kZSA9IG5ldyBUcmFuc2xhdGVBcnJvd3NOb2RlKCBtb2xlY3VsZSwgbW9sZWN1bGUuYXRvbUEsIHtcclxuICAgICAgcGlja2FibGU6IGZhbHNlLFxyXG4gICAgICB0YW5kZW06IGhpbnRBcnJvd3NUYW5kZW0uY3JlYXRlVGFuZGVtKCAnaGludEFycm93QU5vZGUnIClcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IGhpbnRBcnJvd0JOb2RlID0gbmV3IFRyYW5zbGF0ZUFycm93c05vZGUoIG1vbGVjdWxlLCBtb2xlY3VsZS5hdG9tQiwge1xyXG4gICAgICBwaWNrYWJsZTogZmFsc2UsXHJcbiAgICAgIHRhbmRlbTogaGludEFycm93c1RhbmRlbS5jcmVhdGVUYW5kZW0oICdoaW50QXJyb3dCTm9kZScgKVxyXG4gICAgfSApO1xyXG4gICAgY29uc3QgaGludEFycm93c05vZGUgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogWyBoaW50QXJyb3dBTm9kZSwgaGludEFycm93Qk5vZGUgXSxcclxuICAgICAgdGFuZGVtOiBoaW50QXJyb3dzVGFuZGVtLFxyXG4gICAgICB2aXNpYmxlUHJvcGVydHlPcHRpb25zOiB7XHJcbiAgICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ1NldCB0byBmYWxzZSB0byBwZXJtYW5lbnRseSBoaWRlIGhpbnQgYXJyb3dzLidcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHBhcnRpYWwgY2hhcmdlXHJcbiAgICBjb25zdCBwYXJ0aWFsQ2hhcmdlQU5vZGUgPSBQYXJ0aWFsQ2hhcmdlTm9kZS5jcmVhdGVPcHBvc2l0ZVBhcnRpYWxDaGFyZ2VOb2RlKCBtb2xlY3VsZS5hdG9tQSwgbW9sZWN1bGUuYm9uZCwge1xyXG4gICAgICB2aXNpYmxlUHJvcGVydHk6IHZpZXdQcm9wZXJ0aWVzLnBhcnRpYWxDaGFyZ2VzVmlzaWJsZVByb3BlcnR5XHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBwYXJ0aWFsQ2hhcmdlQk5vZGUgPSBQYXJ0aWFsQ2hhcmdlTm9kZS5jcmVhdGVPcHBvc2l0ZVBhcnRpYWxDaGFyZ2VOb2RlKCBtb2xlY3VsZS5hdG9tQiwgbW9sZWN1bGUuYm9uZCwge1xyXG4gICAgICB2aXNpYmxlUHJvcGVydHk6IHZpZXdQcm9wZXJ0aWVzLnBhcnRpYWxDaGFyZ2VzVmlzaWJsZVByb3BlcnR5XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gc3VyZmFjZXNcclxuICAgIGNvbnN0IGVsZWN0cm9zdGF0aWNQb3RlbnRpYWxTdXJmYWNlTm9kZSA9IG5ldyBFbGVjdHJvc3RhdGljUG90ZW50aWFsU3VyZmFjZU5vZGUoIG1vbGVjdWxlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZWxlY3Ryb3N0YXRpY1BvdGVudGlhbFN1cmZhY2VOb2RlJyApXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBlbGVjdHJvbkRlbnNpdHlTdXJmYWNlTm9kZSA9IG5ldyBFbGVjdHJvbkRlbnNpdHlTdXJmYWNlTm9kZSggbW9sZWN1bGUsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdlbGVjdHJvbkRlbnNpdHlTdXJmYWNlTm9kZScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGRpcG9sZVxyXG4gICAgY29uc3QgYm9uZERpcG9sZU5vZGUgPSBuZXcgQm9uZERpcG9sZU5vZGUoIG1vbGVjdWxlLmJvbmQsIHtcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiB2aWV3UHJvcGVydGllcy5ib25kRGlwb2xlVmlzaWJsZVByb3BlcnR5XHJcbiAgICB9ICk7XHJcblxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFtcclxuICAgICAgZWxlY3Ryb3N0YXRpY1BvdGVudGlhbFN1cmZhY2VOb2RlLCBlbGVjdHJvbkRlbnNpdHlTdXJmYWNlTm9kZSxcclxuICAgICAgYm9uZE5vZGUsIGF0b21BTm9kZSwgYXRvbUJOb2RlLFxyXG4gICAgICBoaW50QXJyb3dzTm9kZSxcclxuICAgICAgcGFydGlhbENoYXJnZUFOb2RlLCBwYXJ0aWFsQ2hhcmdlQk5vZGUsIGJvbmREaXBvbGVOb2RlXHJcbiAgICBdO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gcm90YXRlIG1vbGVjdWxlIGJ5IGRyYWdnaW5nIGFueXdoZXJlXHJcbiAgICBjb25zdCBkcmFnTGlzdGVuZXIgPSBuZXcgTW9sZWN1bGVBbmdsZURyYWdMaXN0ZW5lciggbW9sZWN1bGUsIHRoaXMsIHtcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ3JvdGF0ZXMgdGhlIG1vbGVjdWxlIGJ5IGRyYWdnaW5nIGFueXdoZXJlIG9uIGl0JyxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdkcmFnTGlzdGVuZXInIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggZHJhZ0xpc3RlbmVyICk7XHJcblxyXG4gICAgdmlld1Byb3BlcnRpZXMuc3VyZmFjZVR5cGVQcm9wZXJ0eS5saW5rKCBzdXJmYWNlVHlwZSA9PiB7XHJcbiAgICAgIGVsZWN0cm9zdGF0aWNQb3RlbnRpYWxTdXJmYWNlTm9kZS52aXNpYmxlID0gKCBzdXJmYWNlVHlwZSA9PT0gJ2VsZWN0cm9zdGF0aWNQb3RlbnRpYWwnICk7XHJcbiAgICAgIGVsZWN0cm9uRGVuc2l0eVN1cmZhY2VOb2RlLnZpc2libGUgPSAoIHN1cmZhY2VUeXBlID09PSAnZWxlY3Ryb25EZW5zaXR5JyApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHtib29sZWFufSBTZXQgdG8gdHJ1ZSB3aGVuIHRoZSBtb2xlY3VsZSBoYXMgYmVlbiBjaGFuZ2VkIGJ5IHRoZSB1c2VyLlxyXG4gICAgbGV0IG1vbGVjdWxlSGFzQ2hhbmdlZCA9IGZhbHNlO1xyXG5cclxuICAgIC8vIEhpZGVzIHRoZSBoaW50IGFycm93cyBpZiB0aGUgbW9sZWN1bGUgYmVjb21lcyBub24taW50ZXJhY3RpdmUuXHJcbiAgICAvLyBTZXQgdGhlIGhpbnQgYXJyb3dzIGluZGl2aWR1YWxseSwgYmVjYXVzZSBoaW50QXJyb3dzTm9kZS52aXNpYmxlUHJvcGVydHkgaXMgZm9yIHVzZSBieSBQaEVULWlPLlxyXG4gICAgY29uc3QgdXBkYXRlSGludEFycm93cyA9ICgpID0+IHtcclxuICAgICAgaGludEFycm93QU5vZGUudmlzaWJsZSA9IGhpbnRBcnJvd0JOb2RlLnZpc2libGUgPSAoICFtb2xlY3VsZUhhc0NoYW5nZWQgJiYgdGhpcy5pbnB1dEVuYWJsZWQgKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gV2hlbiB0aGUgdXNlciBkcmFncyBhbnkgYXRvbSBvciBib25kLCBoaWRlIHRoZSBoaW50IGFycm93cy5cclxuICAgIGNvbnN0IGhpZGVBcnJvd3MgPSAoKSA9PiB7XHJcbiAgICAgIGlmICggbW9sZWN1bGUuaXNEcmFnZ2luZ1Byb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICAgIG1vbGVjdWxlSGFzQ2hhbmdlZCA9IHRydWU7XHJcbiAgICAgICAgdXBkYXRlSGludEFycm93cygpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgbW9sZWN1bGUuYW5nbGVQcm9wZXJ0eS5sYXp5TGluayggaGlkZUFycm93cyApO1xyXG5cclxuICAgIHRoaXMuaW5wdXRFbmFibGVkUHJvcGVydHkubGluayggKCkgPT4gdXBkYXRlSGludEFycm93cygpICk7XHJcblxyXG4gICAgLy8gU2hvdyBtb2xlY3VsZSBhbmdsZSBhcyBhbiBhcnJvdyB0aGF0IHBvaW50cyBmcm9tIHRoZSBjZW50ZXIgdG8gdGhlIGF0b20gaW4gdGhlIGRpcmVjdGlvbiBvZiBhbmdsZS5cclxuICAgIGlmICggTVBRdWVyeVBhcmFtZXRlcnMuc2hvd01vbGVjdWxlQW5nbGUgKSB7XHJcbiAgICAgIGNvbnN0IGFycm93Tm9kZSA9IG5ldyBBcnJvd05vZGUoIDAsIDAsIDEwMCwgMCwge1xyXG4gICAgICAgIGZpbGw6ICdyZWQnLFxyXG4gICAgICAgIHRyYW5zbGF0aW9uOiBtb2xlY3VsZS5wb3NpdGlvblxyXG4gICAgICB9ICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIGFycm93Tm9kZSApO1xyXG4gICAgICBtb2xlY3VsZS5hbmdsZVByb3BlcnR5LmxpbmsoIGFuZ2xlID0+IGFycm93Tm9kZS5zZXRSb3RhdGlvbiggYW5nbGUgKSApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMucmVzZXREaWF0b21pY01vbGVjdWxlTm9kZSA9ICgpID0+IHtcclxuICAgICAgbW9sZWN1bGVIYXNDaGFuZ2VkID0gZmFsc2U7XHJcbiAgICAgIHVwZGF0ZUhpbnRBcnJvd3MoKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5yZXNldERpYXRvbWljTW9sZWN1bGVOb2RlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5tb2xlY3VsZVBvbGFyaXR5LnJlZ2lzdGVyKCAnRGlhdG9taWNNb2xlY3VsZU5vZGUnLCBEaWF0b21pY01vbGVjdWxlTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFNBQVMsTUFBNEIsdUNBQXVDO0FBRW5GLE9BQU9DLFNBQVMsTUFBTSwwQ0FBMEM7QUFDaEUsU0FBU0MsSUFBSSxRQUFxQixtQ0FBbUM7QUFDckUsT0FBT0MsaUJBQWlCLE1BQU0sbUNBQW1DO0FBQ2pFLE9BQU9DLFFBQVEsTUFBTSwrQkFBK0I7QUFDcEQsT0FBT0MsY0FBYyxNQUFNLHFDQUFxQztBQUNoRSxPQUFPQyxRQUFRLE1BQU0sK0JBQStCO0FBQ3BELE9BQU9DLHlCQUF5QixNQUFNLGdEQUFnRDtBQUN0RixPQUFPQyxpQkFBaUIsTUFBTSx3Q0FBd0M7QUFDdEUsT0FBT0MsbUJBQW1CLE1BQU0sMENBQTBDO0FBQzFFLE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUV4RCxPQUFPQywwQkFBMEIsTUFBTSxpQ0FBaUM7QUFDeEUsT0FBT0MsaUNBQWlDLE1BQU0sd0NBQXdDO0FBT3RGLGVBQWUsTUFBTUMsb0JBQW9CLFNBQVNYLElBQUksQ0FBQztFQUk5Q1ksV0FBV0EsQ0FBRUMsUUFBMEIsRUFDMUJDLGNBQXNDLEVBQ3RDQyxlQUE0QyxFQUFHO0lBRWpFLE1BQU1DLE9BQU8sR0FBR2xCLFNBQVMsQ0FBd0QsQ0FBQyxDQUFFO01BRWxGO01BQ0FtQixNQUFNLEVBQUUsU0FBUztNQUNqQkMsc0NBQXNDLEVBQUU7SUFDMUMsQ0FBQyxFQUFFSCxlQUFnQixDQUFDOztJQUVwQjtJQUNBLE1BQU1JLFNBQVMsR0FBRyxJQUFJakIsUUFBUSxDQUFFVyxRQUFRLENBQUNPLEtBQUssRUFBRTtNQUM5Q0Ms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