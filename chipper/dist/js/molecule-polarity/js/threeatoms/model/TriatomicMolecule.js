// Copyright 2014-2022, University of Colorado Boulder

/**
 * TriatomicMolecule is the model of a make-believe triatomic (3 atoms) molecule with a very specific topology.
 * Variables are named based on the English labels applied to the atoms.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import NumberIO from '../../../../tandem/js/types/NumberIO.js';
import Atom from '../../common/model/Atom.js';
import Bond from '../../common/model/Bond.js';
import Molecule from '../../common/model/Molecule.js';
import normalizeAngle from '../../common/model/normalizeAngle.js';
import MPColors from '../../common/MPColors.js';
import MPConstants from '../../common/MPConstants.js';
import moleculePolarity from '../../moleculePolarity.js';
import MoleculePolarityStrings from '../../MoleculePolarityStrings.js';
export default class TriatomicMolecule extends Molecule {
  // the atom labeled 'A'
  // the atom labeled 'B'
  // the atom labeled 'C'
  // the bond between atoms 'A' and 'B'
  // the bond between atoms 'B' and 'C'
  // see phetioDocumentation
  // see phetioDocumentation

  // the angle between bondAB and bondBC
  // This was added for PhET-iO, see https://github.com/phetsims/molecule-polarity/issues/98
  constructor(providedOptions) {
    const options = providedOptions;

    // atoms labeled A, B, C
    const atomA = new Atom(MoleculePolarityStrings.atomAStringProperty, {
      color: MPColors.ATOM_A,
      tandem: options.tandem.createTandem('atomA')
    });
    const atomB = new Atom(MoleculePolarityStrings.atomBStringProperty, {
      color: MPColors.ATOM_B,
      electronegativity: MPConstants.ELECTRONEGATIVITY_RANGE.min + MPConstants.ELECTRONEGATIVITY_RANGE.getLength() / 2,
      tandem: options.tandem.createTandem('atomB')
    });
    const atomC = new Atom(MoleculePolarityStrings.atomCStringProperty, {
      color: MPColors.ATOM_C,
      tandem: options.tandem.createTandem('atomC')
    });
    const bondABTandem = options.tandem.createTandem('bondAB');
    const bondBCTandem = options.tandem.createTandem('bondBC');

    // the bond connecting atoms A and B
    const bondAB = new Bond(atomA, atomB, {
      tandem: bondABTandem,
      phetioDocumentation: 'the bond between atoms A and B'
    });

    // the bond connecting atoms B and C
    const bondBC = new Bond(atomB, atomC, {
      tandem: bondBCTandem,
      phetioDocumentation: 'the bond between atoms B and C'
    });

    // the bond angle of atom A relative to atom B, before applying molecule rotation
    const bondAngleABProperty = new NumberProperty(0.75 * Math.PI, {
      range: MPConstants.ANGLE_RANGE,
      units: 'radians',
      tandem: bondABTandem.createTandem('angleProperty'),
      phetioDocumentation: 'rotation angle of the bond between atoms A and B, relative to the molecule\'s angle and position, with positive rotation being CLOCKWISE'
    });

    // the bond angle of atom C relative to atom B, before applying molecule rotation
    const bondAngleBCProperty = new NumberProperty(0.25 * Math.PI, {
      range: MPConstants.ANGLE_RANGE,
      units: 'radians',
      tandem: bondBCTandem.createTandem('angleProperty'),
      phetioDocumentation: 'rotation angle of the bond between atoms B and C, relative to the molecule\'s angle and position, with positive rotation being CLOCKWISE'
    });
    const updateAtomPositions = (position, angle) => {
      atomB.positionProperty.value = position; // atom B remains at the molecule's position
      updateAtomPosition(atomA, bondAngleABProperty.value, position, angle);
      updateAtomPosition(atomC, bondAngleBCProperty.value, position, angle);
    };
    const updatePartialCharges = () => {
      const deltaAB = atomA.electronegativityProperty.value - atomB.electronegativityProperty.value;
      const deltaCB = atomC.electronegativityProperty.value - atomB.electronegativityProperty.value;

      // in our simplified model, partial charge and deltaEN are equivalent. not so in the real world.
      atomA.partialChargeProperty.value = -deltaAB;
      atomC.partialChargeProperty.value = -deltaCB;

      // atom B's participates in 2 bonds, so its partial charge is the sum
      atomB.partialChargeProperty.value = deltaAB + deltaCB;
    };
    super([atomA, atomB, atomC], [bondAB, bondBC], updateAtomPositions, updatePartialCharges, options);
    const bondAngleListener = () => updateAtomPositions(this.position, this.angleProperty.value);
    bondAngleABProperty.link(bondAngleListener);
    bondAngleBCProperty.link(bondAngleListener);
    this.bondAngleABCProperty = new DerivedProperty([bondAngleABProperty, bondAngleBCProperty], (bondAngleAB, bondAngleBC) => normalizeAngle(bondAngleAB - bondAngleBC, MPConstants.ANGLE_RANGE.min), {
      isValidValue: value => MPConstants.ANGLE_RANGE.contains(value),
      tandem: options.tandem.createTandem('bondAngleABCProperty'),
      phetioValueType: NumberIO,
      phetioDocumentation: 'the angle between bonds AB and BC, with positive rotation being CLOCKWISE'
    });
    this.atomA = atomA;
    this.atomB = atomB;
    this.atomC = atomC;
    this.bondAB = bondAB;
    this.bondBC = bondBC;
    this.bondAngleABProperty = bondAngleABProperty;
    this.bondAngleBCProperty = bondAngleBCProperty;
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
  reset() {
    super.reset();
    this.bondAngleABProperty.reset();
    this.bondAngleBCProperty.reset();
  }
}

/*
 * Repositions one atom.
 * @param atom - the atom to reposition
 * @param bondAngle - the angle of the bond that the atom participates in
 * @param position - position of the molecule
 * @param angle - orientation of the molecule
 */
function updateAtomPosition(atom, bondAngle, position, angle) {
  const thetaA = angle + bondAngle;
  const xA = MPConstants.BOND_LENGTH * Math.cos(thetaA) + position.x;
  const yA = MPConstants.BOND_LENGTH * Math.sin(thetaA) + position.y;
  atom.positionProperty.value = new Vector2(xA, yA);
}
moleculePolarity.register('TriatomicMolecule', TriatomicMolecule);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIlZlY3RvcjIiLCJOdW1iZXJJTyIsIkF0b20iLCJCb25kIiwiTW9sZWN1bGUiLCJub3JtYWxpemVBbmdsZSIsIk1QQ29sb3JzIiwiTVBDb25zdGFudHMiLCJtb2xlY3VsZVBvbGFyaXR5IiwiTW9sZWN1bGVQb2xhcml0eVN0cmluZ3MiLCJUcmlhdG9taWNNb2xlY3VsZSIsImNvbnN0cnVjdG9yIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImF0b21BIiwiYXRvbUFTdHJpbmdQcm9wZXJ0eSIsImNvbG9yIiwiQVRPTV9BIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwiYXRvbUIiLCJhdG9tQlN0cmluZ1Byb3BlcnR5IiwiQVRPTV9CIiwiZWxlY3Ryb25lZ2F0aXZpdHkiLCJFTEVDVFJPTkVHQVRJVklUWV9SQU5HRSIsIm1pbiIsImdldExlbmd0aCIsImF0b21DIiwiYXRvbUNTdHJpbmdQcm9wZXJ0eSIsIkFUT01fQyIsImJvbmRBQlRhbmRlbSIsImJvbmRCQ1RhbmRlbSIsImJvbmRBQiIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJib25kQkMiLCJib25kQW5nbGVBQlByb3BlcnR5IiwiTWF0aCIsIlBJIiwicmFuZ2UiLCJBTkdMRV9SQU5HRSIsInVuaXRzIiwiYm9uZEFuZ2xlQkNQcm9wZXJ0eSIsInVwZGF0ZUF0b21Qb3NpdGlvbnMiLCJwb3NpdGlvbiIsImFuZ2xlIiwicG9zaXRpb25Qcm9wZXJ0eSIsInZhbHVlIiwidXBkYXRlQXRvbVBvc2l0aW9uIiwidXBkYXRlUGFydGlhbENoYXJnZXMiLCJkZWx0YUFCIiwiZWxlY3Ryb25lZ2F0aXZpdHlQcm9wZXJ0eSIsImRlbHRhQ0IiLCJwYXJ0aWFsQ2hhcmdlUHJvcGVydHkiLCJib25kQW5nbGVMaXN0ZW5lciIsImFuZ2xlUHJvcGVydHkiLCJsaW5rIiwiYm9uZEFuZ2xlQUJDUHJvcGVydHkiLCJib25kQW5nbGVBQiIsImJvbmRBbmdsZUJDIiwiaXNWYWxpZFZhbHVlIiwiY29udGFpbnMiLCJwaGV0aW9WYWx1ZVR5cGUiLCJkaXNwb3NlIiwiYXNzZXJ0IiwicmVzZXQiLCJhdG9tIiwiYm9uZEFuZ2xlIiwidGhldGFBIiwieEEiLCJCT05EX0xFTkdUSCIsImNvcyIsIngiLCJ5QSIsInNpbiIsInkiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlRyaWF0b21pY01vbGVjdWxlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFRyaWF0b21pY01vbGVjdWxlIGlzIHRoZSBtb2RlbCBvZiBhIG1ha2UtYmVsaWV2ZSB0cmlhdG9taWMgKDMgYXRvbXMpIG1vbGVjdWxlIHdpdGggYSB2ZXJ5IHNwZWNpZmljIHRvcG9sb2d5LlxyXG4gKiBWYXJpYWJsZXMgYXJlIG5hbWVkIGJhc2VkIG9uIHRoZSBFbmdsaXNoIGxhYmVscyBhcHBsaWVkIHRvIHRoZSBhdG9tcy5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IE51bWJlclByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTnVtYmVyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgTnVtYmVySU8gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL051bWJlcklPLmpzJztcclxuaW1wb3J0IEF0b20gZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL0F0b20uanMnO1xyXG5pbXBvcnQgQm9uZCBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvQm9uZC5qcyc7XHJcbmltcG9ydCBNb2xlY3VsZSwgeyBNb2xlY3VsZU9wdGlvbnMgfSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvTW9sZWN1bGUuanMnO1xyXG5pbXBvcnQgbm9ybWFsaXplQW5nbGUgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL25vcm1hbGl6ZUFuZ2xlLmpzJztcclxuaW1wb3J0IE1QQ29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi9NUENvbG9ycy5qcyc7XHJcbmltcG9ydCBNUENvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vTVBDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgbW9sZWN1bGVQb2xhcml0eSBmcm9tICcuLi8uLi9tb2xlY3VsZVBvbGFyaXR5LmpzJztcclxuaW1wb3J0IE1vbGVjdWxlUG9sYXJpdHlTdHJpbmdzIGZyb20gJy4uLy4uL01vbGVjdWxlUG9sYXJpdHlTdHJpbmdzLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSBFbXB0eVNlbGZPcHRpb25zO1xyXG5cclxudHlwZSBUcmlhdG9taWNNb2xlY3VsZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIE1vbGVjdWxlT3B0aW9ucztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRyaWF0b21pY01vbGVjdWxlIGV4dGVuZHMgTW9sZWN1bGUge1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgYXRvbUE6IEF0b207IC8vIHRoZSBhdG9tIGxhYmVsZWQgJ0EnXHJcbiAgcHVibGljIHJlYWRvbmx5IGF0b21COiBBdG9tOyAvLyB0aGUgYXRvbSBsYWJlbGVkICdCJ1xyXG4gIHB1YmxpYyByZWFkb25seSBhdG9tQzogQXRvbTsgLy8gdGhlIGF0b20gbGFiZWxlZCAnQydcclxuICBwdWJsaWMgcmVhZG9ubHkgYm9uZEFCOiBCb25kOyAvLyB0aGUgYm9uZCBiZXR3ZWVuIGF0b21zICdBJyBhbmQgJ0InXHJcbiAgcHVibGljIHJlYWRvbmx5IGJvbmRCQzogQm9uZDsgLy8gdGhlIGJvbmQgYmV0d2VlbiBhdG9tcyAnQicgYW5kICdDJ1xyXG4gIHB1YmxpYyByZWFkb25seSBib25kQW5nbGVBQlByb3BlcnR5OiBOdW1iZXJQcm9wZXJ0eTsgLy8gc2VlIHBoZXRpb0RvY3VtZW50YXRpb25cclxuICBwdWJsaWMgcmVhZG9ubHkgYm9uZEFuZ2xlQkNQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHk7IC8vIHNlZSBwaGV0aW9Eb2N1bWVudGF0aW9uXHJcblxyXG4gIC8vIHRoZSBhbmdsZSBiZXR3ZWVuIGJvbmRBQiBhbmQgYm9uZEJDXHJcbiAgLy8gVGhpcyB3YXMgYWRkZWQgZm9yIFBoRVQtaU8sIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbW9sZWN1bGUtcG9sYXJpdHkvaXNzdWVzLzk4XHJcbiAgcHJpdmF0ZSByZWFkb25seSBib25kQW5nbGVBQkNQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPjtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM6IFRyaWF0b21pY01vbGVjdWxlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gcHJvdmlkZWRPcHRpb25zO1xyXG5cclxuICAgIC8vIGF0b21zIGxhYmVsZWQgQSwgQiwgQ1xyXG4gICAgY29uc3QgYXRvbUEgPSBuZXcgQXRvbSggTW9sZWN1bGVQb2xhcml0eVN0cmluZ3MuYXRvbUFTdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICBjb2xvcjogTVBDb2xvcnMuQVRPTV9BLFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2F0b21BJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgYXRvbUIgPSBuZXcgQXRvbSggTW9sZWN1bGVQb2xhcml0eVN0cmluZ3MuYXRvbUJTdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICBjb2xvcjogTVBDb2xvcnMuQVRPTV9CLFxyXG4gICAgICBlbGVjdHJvbmVnYXRpdml0eTogTVBDb25zdGFudHMuRUxFQ1RST05FR0FUSVZJVFlfUkFOR0UubWluICsgKCBNUENvbnN0YW50cy5FTEVDVFJPTkVHQVRJVklUWV9SQU5HRS5nZXRMZW5ndGgoKSAvIDIgKSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdhdG9tQicgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGF0b21DID0gbmV3IEF0b20oIE1vbGVjdWxlUG9sYXJpdHlTdHJpbmdzLmF0b21DU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgY29sb3I6IE1QQ29sb3JzLkFUT01fQyxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdhdG9tQycgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGJvbmRBQlRhbmRlbSA9IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2JvbmRBQicgKTtcclxuICAgIGNvbnN0IGJvbmRCQ1RhbmRlbSA9IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2JvbmRCQycgKTtcclxuXHJcbiAgICAvLyB0aGUgYm9uZCBjb25uZWN0aW5nIGF0b21zIEEgYW5kIEJcclxuICAgIGNvbnN0IGJvbmRBQiA9IG5ldyBCb25kKCBhdG9tQSwgYXRvbUIsIHtcclxuICAgICAgdGFuZGVtOiBib25kQUJUYW5kZW0sXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICd0aGUgYm9uZCBiZXR3ZWVuIGF0b21zIEEgYW5kIEInXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gdGhlIGJvbmQgY29ubmVjdGluZyBhdG9tcyBCIGFuZCBDXHJcbiAgICBjb25zdCBib25kQkMgPSBuZXcgQm9uZCggYXRvbUIsIGF0b21DLCB7XHJcbiAgICAgIHRhbmRlbTogYm9uZEJDVGFuZGVtLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAndGhlIGJvbmQgYmV0d2VlbiBhdG9tcyBCIGFuZCBDJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHRoZSBib25kIGFuZ2xlIG9mIGF0b20gQSByZWxhdGl2ZSB0byBhdG9tIEIsIGJlZm9yZSBhcHBseWluZyBtb2xlY3VsZSByb3RhdGlvblxyXG4gICAgY29uc3QgYm9uZEFuZ2xlQUJQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggMC43NSAqIE1hdGguUEksIHtcclxuICAgICAgcmFuZ2U6IE1QQ29uc3RhbnRzLkFOR0xFX1JBTkdFLFxyXG4gICAgICB1bml0czogJ3JhZGlhbnMnLFxyXG4gICAgICB0YW5kZW06IGJvbmRBQlRhbmRlbS5jcmVhdGVUYW5kZW0oICdhbmdsZVByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAncm90YXRpb24gYW5nbGUgb2YgdGhlIGJvbmQgYmV0d2VlbiBhdG9tcyBBIGFuZCBCLCByZWxhdGl2ZSB0byB0aGUgbW9sZWN1bGVcXCdzIGFuZ2xlIGFuZCBwb3NpdGlvbiwgd2l0aCBwb3NpdGl2ZSByb3RhdGlvbiBiZWluZyBDTE9DS1dJU0UnXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gdGhlIGJvbmQgYW5nbGUgb2YgYXRvbSBDIHJlbGF0aXZlIHRvIGF0b20gQiwgYmVmb3JlIGFwcGx5aW5nIG1vbGVjdWxlIHJvdGF0aW9uXHJcbiAgICBjb25zdCBib25kQW5nbGVCQ1Byb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCAwLjI1ICogTWF0aC5QSSwge1xyXG4gICAgICByYW5nZTogTVBDb25zdGFudHMuQU5HTEVfUkFOR0UsXHJcbiAgICAgIHVuaXRzOiAncmFkaWFucycsXHJcbiAgICAgIHRhbmRlbTogYm9uZEJDVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2FuZ2xlUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdyb3RhdGlvbiBhbmdsZSBvZiB0aGUgYm9uZCBiZXR3ZWVuIGF0b21zIEIgYW5kIEMsIHJlbGF0aXZlIHRvIHRoZSBtb2xlY3VsZVxcJ3MgYW5nbGUgYW5kIHBvc2l0aW9uLCB3aXRoIHBvc2l0aXZlIHJvdGF0aW9uIGJlaW5nIENMT0NLV0lTRSdcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCB1cGRhdGVBdG9tUG9zaXRpb25zID0gKCBwb3NpdGlvbjogVmVjdG9yMiwgYW5nbGU6IG51bWJlciApID0+IHtcclxuICAgICAgYXRvbUIucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZSA9IHBvc2l0aW9uOyAgLy8gYXRvbSBCIHJlbWFpbnMgYXQgdGhlIG1vbGVjdWxlJ3MgcG9zaXRpb25cclxuICAgICAgdXBkYXRlQXRvbVBvc2l0aW9uKCBhdG9tQSwgYm9uZEFuZ2xlQUJQcm9wZXJ0eS52YWx1ZSwgcG9zaXRpb24sIGFuZ2xlICk7XHJcbiAgICAgIHVwZGF0ZUF0b21Qb3NpdGlvbiggYXRvbUMsIGJvbmRBbmdsZUJDUHJvcGVydHkudmFsdWUsIHBvc2l0aW9uLCBhbmdsZSApO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCB1cGRhdGVQYXJ0aWFsQ2hhcmdlcyA9ICgpID0+IHtcclxuXHJcbiAgICAgIGNvbnN0IGRlbHRhQUIgPSBhdG9tQS5lbGVjdHJvbmVnYXRpdml0eVByb3BlcnR5LnZhbHVlIC0gYXRvbUIuZWxlY3Ryb25lZ2F0aXZpdHlQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgY29uc3QgZGVsdGFDQiA9IGF0b21DLmVsZWN0cm9uZWdhdGl2aXR5UHJvcGVydHkudmFsdWUgLSBhdG9tQi5lbGVjdHJvbmVnYXRpdml0eVByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgICAgLy8gaW4gb3VyIHNpbXBsaWZpZWQgbW9kZWwsIHBhcnRpYWwgY2hhcmdlIGFuZCBkZWx0YUVOIGFyZSBlcXVpdmFsZW50LiBub3Qgc28gaW4gdGhlIHJlYWwgd29ybGQuXHJcbiAgICAgIGF0b21BLnBhcnRpYWxDaGFyZ2VQcm9wZXJ0eS52YWx1ZSA9IC1kZWx0YUFCO1xyXG4gICAgICBhdG9tQy5wYXJ0aWFsQ2hhcmdlUHJvcGVydHkudmFsdWUgPSAtZGVsdGFDQjtcclxuXHJcbiAgICAgIC8vIGF0b20gQidzIHBhcnRpY2lwYXRlcyBpbiAyIGJvbmRzLCBzbyBpdHMgcGFydGlhbCBjaGFyZ2UgaXMgdGhlIHN1bVxyXG4gICAgICBhdG9tQi5wYXJ0aWFsQ2hhcmdlUHJvcGVydHkudmFsdWUgPSBkZWx0YUFCICsgZGVsdGFDQjtcclxuICAgIH07XHJcblxyXG4gICAgc3VwZXIoIFsgYXRvbUEsIGF0b21CLCBhdG9tQyBdLCBbIGJvbmRBQiwgYm9uZEJDIF0sIHVwZGF0ZUF0b21Qb3NpdGlvbnMsIHVwZGF0ZVBhcnRpYWxDaGFyZ2VzLCBvcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgYm9uZEFuZ2xlTGlzdGVuZXIgPSAoKSA9PiB1cGRhdGVBdG9tUG9zaXRpb25zKCB0aGlzLnBvc2l0aW9uLCB0aGlzLmFuZ2xlUHJvcGVydHkudmFsdWUgKTtcclxuICAgIGJvbmRBbmdsZUFCUHJvcGVydHkubGluayggYm9uZEFuZ2xlTGlzdGVuZXIgKTtcclxuICAgIGJvbmRBbmdsZUJDUHJvcGVydHkubGluayggYm9uZEFuZ2xlTGlzdGVuZXIgKTtcclxuXHJcbiAgICB0aGlzLmJvbmRBbmdsZUFCQ1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eShcclxuICAgICAgWyBib25kQW5nbGVBQlByb3BlcnR5LCBib25kQW5nbGVCQ1Byb3BlcnR5IF0sXHJcbiAgICAgICggYm9uZEFuZ2xlQUIsIGJvbmRBbmdsZUJDICkgPT4gbm9ybWFsaXplQW5nbGUoIGJvbmRBbmdsZUFCIC0gYm9uZEFuZ2xlQkMsIE1QQ29uc3RhbnRzLkFOR0xFX1JBTkdFLm1pbiApLCB7XHJcbiAgICAgICAgaXNWYWxpZFZhbHVlOiB2YWx1ZSA9PiBNUENvbnN0YW50cy5BTkdMRV9SQU5HRS5jb250YWlucyggdmFsdWUgKSxcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2JvbmRBbmdsZUFCQ1Byb3BlcnR5JyApLFxyXG4gICAgICAgIHBoZXRpb1ZhbHVlVHlwZTogTnVtYmVySU8sXHJcbiAgICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ3RoZSBhbmdsZSBiZXR3ZWVuIGJvbmRzIEFCIGFuZCBCQywgd2l0aCBwb3NpdGl2ZSByb3RhdGlvbiBiZWluZyBDTE9DS1dJU0UnXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmF0b21BID0gYXRvbUE7XHJcbiAgICB0aGlzLmF0b21CID0gYXRvbUI7XHJcbiAgICB0aGlzLmF0b21DID0gYXRvbUM7XHJcbiAgICB0aGlzLmJvbmRBQiA9IGJvbmRBQjtcclxuICAgIHRoaXMuYm9uZEJDID0gYm9uZEJDO1xyXG4gICAgdGhpcy5ib25kQW5nbGVBQlByb3BlcnR5ID0gYm9uZEFuZ2xlQUJQcm9wZXJ0eTtcclxuICAgIHRoaXMuYm9uZEFuZ2xlQkNQcm9wZXJ0eSA9IGJvbmRBbmdsZUJDUHJvcGVydHk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgc3VwZXIucmVzZXQoKTtcclxuICAgIHRoaXMuYm9uZEFuZ2xlQUJQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5ib25kQW5nbGVCQ1Byb3BlcnR5LnJlc2V0KCk7XHJcbiAgfVxyXG59XHJcblxyXG4vKlxyXG4gKiBSZXBvc2l0aW9ucyBvbmUgYXRvbS5cclxuICogQHBhcmFtIGF0b20gLSB0aGUgYXRvbSB0byByZXBvc2l0aW9uXHJcbiAqIEBwYXJhbSBib25kQW5nbGUgLSB0aGUgYW5nbGUgb2YgdGhlIGJvbmQgdGhhdCB0aGUgYXRvbSBwYXJ0aWNpcGF0ZXMgaW5cclxuICogQHBhcmFtIHBvc2l0aW9uIC0gcG9zaXRpb24gb2YgdGhlIG1vbGVjdWxlXHJcbiAqIEBwYXJhbSBhbmdsZSAtIG9yaWVudGF0aW9uIG9mIHRoZSBtb2xlY3VsZVxyXG4gKi9cclxuZnVuY3Rpb24gdXBkYXRlQXRvbVBvc2l0aW9uKCBhdG9tOiBBdG9tLCBib25kQW5nbGU6IG51bWJlciwgcG9zaXRpb246IFZlY3RvcjIsIGFuZ2xlOiBudW1iZXIgKTogdm9pZCB7XHJcbiAgY29uc3QgdGhldGFBID0gYW5nbGUgKyBib25kQW5nbGU7XHJcbiAgY29uc3QgeEEgPSAoIE1QQ29uc3RhbnRzLkJPTkRfTEVOR1RIICogTWF0aC5jb3MoIHRoZXRhQSApICkgKyBwb3NpdGlvbi54O1xyXG4gIGNvbnN0IHlBID0gKCBNUENvbnN0YW50cy5CT05EX0xFTkdUSCAqIE1hdGguc2luKCB0aGV0YUEgKSApICsgcG9zaXRpb24ueTtcclxuICBhdG9tLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgPSBuZXcgVmVjdG9yMiggeEEsIHlBICk7XHJcbn1cclxuXHJcbm1vbGVjdWxlUG9sYXJpdHkucmVnaXN0ZXIoICdUcmlhdG9taWNNb2xlY3VsZScsIFRyaWF0b21pY01vbGVjdWxlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxjQUFjLE1BQU0sdUNBQXVDO0FBRWxFLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFFbkQsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxPQUFPQyxJQUFJLE1BQU0sNEJBQTRCO0FBQzdDLE9BQU9DLElBQUksTUFBTSw0QkFBNEI7QUFDN0MsT0FBT0MsUUFBUSxNQUEyQixnQ0FBZ0M7QUFDMUUsT0FBT0MsY0FBYyxNQUFNLHNDQUFz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