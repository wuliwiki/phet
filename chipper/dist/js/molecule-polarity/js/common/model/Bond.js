// Copyright 2014-2022, University of Colorado Boulder

/**
 * Bond is the model of a bond between 2 atoms.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import PhetioObject from '../../../../tandem/js/PhetioObject.js';
import moleculePolarity from '../../moleculePolarity.js';
import MPPreferences from './MPPreferences.js';
import optionize from '../../../../phet-core/js/optionize.js';
export default class Bond extends PhetioObject {
  constructor(atom1, atom2, providedOptions) {
    const options = optionize()({
      // PhetioObjectOptions
      phetioState: false
    }, providedOptions);
    super(options);
    this.atom1 = atom1;
    this.atom2 = atom2;
    this.dipoleProperty = new DerivedProperty([atom1.positionProperty, atom2.positionProperty, atom1.electronegativityProperty, atom2.electronegativityProperty, MPPreferences.dipoleDirectionProperty], (position1, position2, electronegativity1, electronegativity2, dipoleDirection) => {
      const deltaEN = electronegativity2 - electronegativity1;

      // this is a simplification. in reality, magnitude is a function of deltaEN and many other things.
      const magnitude = Math.abs(deltaEN);
      let angle = this.getAngle();
      if (deltaEN < 0) {
        angle += Math.PI;
      }
      const dipole = Vector2.createPolar(magnitude, angle);

      // The above algorithm is for a dipole that points from positive to negative charge.
      // For IUPAC convention, the direction of the dipole is from negative to positive charge,
      // so rotate the dipole 180 degrees. See issue #5 and #56.
      if (dipoleDirection === 'negativeToPositive') {
        dipole.rotate(Math.PI);
      }
      return dipole;
    }, {
      tandem: options.tandem.createTandem('dipoleProperty'),
      phetioValueType: Vector2.Vector2IO,
      phetioDocumentation: 'Qualitative vector representation of the dipole, based on the electronegativity difference ' + 'between the atoms. +x is to the right, +y is DOWN, and positive rotation is CLOCKWISE.'
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }

  /**
   * Gets the center of the bond, the midpoint between the 2 atom positions.
   */
  getCenter() {
    return this.atom1.positionProperty.value.average(this.atom2.positionProperty.value);
  }

  /**
   * Gets the angle (in radians) of atom2 relative to the horizontal axis.
   */
  getAngle() {
    const center = this.getCenter();
    return Math.atan2(this.atom2.positionProperty.value.y - center.y, this.atom2.positionProperty.value.x - center.x);
  }

  /**
   * Gets the bond length, the distance between the 2 atoms.
   */
  getLength() {
    return this.atom1.positionProperty.value.distance(this.atom2.positionProperty.value);
  }
}
moleculePolarity.register('Bond', Bond);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJWZWN0b3IyIiwiUGhldGlvT2JqZWN0IiwibW9sZWN1bGVQb2xhcml0eSIsIk1QUHJlZmVyZW5jZXMiLCJvcHRpb25pemUiLCJCb25kIiwiY29uc3RydWN0b3IiLCJhdG9tMSIsImF0b20yIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsInBoZXRpb1N0YXRlIiwiZGlwb2xlUHJvcGVydHkiLCJwb3NpdGlvblByb3BlcnR5IiwiZWxlY3Ryb25lZ2F0aXZpdHlQcm9wZXJ0eSIsImRpcG9sZURpcmVjdGlvblByb3BlcnR5IiwicG9zaXRpb24xIiwicG9zaXRpb24yIiwiZWxlY3Ryb25lZ2F0aXZpdHkxIiwiZWxlY3Ryb25lZ2F0aXZpdHkyIiwiZGlwb2xlRGlyZWN0aW9uIiwiZGVsdGFFTiIsIm1hZ25pdHVkZSIsIk1hdGgiLCJhYnMiLCJhbmdsZSIsImdldEFuZ2xlIiwiUEkiLCJkaXBvbGUiLCJjcmVhdGVQb2xhciIsInJvdGF0ZSIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb1ZhbHVlVHlwZSIsIlZlY3RvcjJJTyIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJkaXNwb3NlIiwiYXNzZXJ0IiwiZ2V0Q2VudGVyIiwidmFsdWUiLCJhdmVyYWdlIiwiY2VudGVyIiwiYXRhbjIiLCJ5IiwieCIsImdldExlbmd0aCIsImRpc3RhbmNlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJCb25kLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEJvbmQgaXMgdGhlIG1vZGVsIG9mIGEgYm9uZCBiZXR3ZWVuIDIgYXRvbXMuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IFBoZXRpb09iamVjdCwgeyBQaGV0aW9PYmplY3RPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1BoZXRpb09iamVjdC5qcyc7XHJcbmltcG9ydCBtb2xlY3VsZVBvbGFyaXR5IGZyb20gJy4uLy4uL21vbGVjdWxlUG9sYXJpdHkuanMnO1xyXG5pbXBvcnQgTVBQcmVmZXJlbmNlcyBmcm9tICcuL01QUHJlZmVyZW5jZXMuanMnO1xyXG5pbXBvcnQgQXRvbSBmcm9tICcuL0F0b20uanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQaWNrUmVxdWlyZWQgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1BpY2tSZXF1aXJlZC5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IEVtcHR5U2VsZk9wdGlvbnM7XHJcblxyXG50eXBlIEJvbmRPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBQaWNrUmVxdWlyZWQ8UGhldGlvT2JqZWN0T3B0aW9ucywgJ3RhbmRlbScgfCAncGhldGlvRG9jdW1lbnRhdGlvbic+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQm9uZCBleHRlbmRzIFBoZXRpb09iamVjdCB7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSBhdG9tMTogQXRvbTtcclxuICBwdWJsaWMgcmVhZG9ubHkgYXRvbTI6IEF0b207XHJcbiAgcHVibGljIHJlYWRvbmx5IGRpcG9sZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxWZWN0b3IyPjtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBhdG9tMTogQXRvbSwgYXRvbTI6IEF0b20sIHByb3ZpZGVkT3B0aW9uczogQm9uZE9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxCb25kT3B0aW9ucywgU2VsZk9wdGlvbnMsIFBoZXRpb09iamVjdE9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFBoZXRpb09iamVjdE9wdGlvbnNcclxuICAgICAgcGhldGlvU3RhdGU6IGZhbHNlXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuYXRvbTEgPSBhdG9tMTtcclxuICAgIHRoaXMuYXRvbTIgPSBhdG9tMjtcclxuXHJcbiAgICB0aGlzLmRpcG9sZVByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggW1xyXG4gICAgICAgIGF0b20xLnBvc2l0aW9uUHJvcGVydHksIGF0b20yLnBvc2l0aW9uUHJvcGVydHksXHJcbiAgICAgICAgYXRvbTEuZWxlY3Ryb25lZ2F0aXZpdHlQcm9wZXJ0eSwgYXRvbTIuZWxlY3Ryb25lZ2F0aXZpdHlQcm9wZXJ0eSxcclxuICAgICAgICBNUFByZWZlcmVuY2VzLmRpcG9sZURpcmVjdGlvblByb3BlcnR5XHJcbiAgICAgIF0sXHJcbiAgICAgICggcG9zaXRpb24xLCBwb3NpdGlvbjIsIGVsZWN0cm9uZWdhdGl2aXR5MSwgZWxlY3Ryb25lZ2F0aXZpdHkyLCBkaXBvbGVEaXJlY3Rpb24gKSA9PiB7XHJcblxyXG4gICAgICAgIGNvbnN0IGRlbHRhRU4gPSBlbGVjdHJvbmVnYXRpdml0eTIgLSBlbGVjdHJvbmVnYXRpdml0eTE7XHJcblxyXG4gICAgICAgIC8vIHRoaXMgaXMgYSBzaW1wbGlmaWNhdGlvbi4gaW4gcmVhbGl0eSwgbWFnbml0dWRlIGlzIGEgZnVuY3Rpb24gb2YgZGVsdGFFTiBhbmQgbWFueSBvdGhlciB0aGluZ3MuXHJcbiAgICAgICAgY29uc3QgbWFnbml0dWRlID0gTWF0aC5hYnMoIGRlbHRhRU4gKTtcclxuXHJcbiAgICAgICAgbGV0IGFuZ2xlID0gdGhpcy5nZXRBbmdsZSgpO1xyXG4gICAgICAgIGlmICggZGVsdGFFTiA8IDAgKSB7XHJcbiAgICAgICAgICBhbmdsZSArPSBNYXRoLlBJO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGlwb2xlID0gVmVjdG9yMi5jcmVhdGVQb2xhciggbWFnbml0dWRlLCBhbmdsZSApO1xyXG5cclxuICAgICAgICAvLyBUaGUgYWJvdmUgYWxnb3JpdGhtIGlzIGZvciBhIGRpcG9sZSB0aGF0IHBvaW50cyBmcm9tIHBvc2l0aXZlIHRvIG5lZ2F0aXZlIGNoYXJnZS5cclxuICAgICAgICAvLyBGb3IgSVVQQUMgY29udmVudGlvbiwgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZGlwb2xlIGlzIGZyb20gbmVnYXRpdmUgdG8gcG9zaXRpdmUgY2hhcmdlLFxyXG4gICAgICAgIC8vIHNvIHJvdGF0ZSB0aGUgZGlwb2xlIDE4MCBkZWdyZWVzLiBTZWUgaXNzdWUgIzUgYW5kICM1Ni5cclxuICAgICAgICBpZiAoIGRpcG9sZURpcmVjdGlvbiA9PT0gJ25lZ2F0aXZlVG9Qb3NpdGl2ZScgKSB7XHJcbiAgICAgICAgICBkaXBvbGUucm90YXRlKCBNYXRoLlBJICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZGlwb2xlO1xyXG4gICAgICB9LCB7XHJcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdkaXBvbGVQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9WYWx1ZVR5cGU6IFZlY3RvcjIuVmVjdG9yMklPLFxyXG4gICAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246XHJcbiAgICAgICAgICAnUXVhbGl0YXRpdmUgdmVjdG9yIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBkaXBvbGUsIGJhc2VkIG9uIHRoZSBlbGVjdHJvbmVnYXRpdml0eSBkaWZmZXJlbmNlICcgK1xyXG4gICAgICAgICAgJ2JldHdlZW4gdGhlIGF0b21zLiAreCBpcyB0byB0aGUgcmlnaHQsICt5IGlzIERPV04sIGFuZCBwb3NpdGl2ZSByb3RhdGlvbiBpcyBDTE9DS1dJU0UuJ1xyXG4gICAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyB0aGUgY2VudGVyIG9mIHRoZSBib25kLCB0aGUgbWlkcG9pbnQgYmV0d2VlbiB0aGUgMiBhdG9tIHBvc2l0aW9ucy5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Q2VudGVyKCk6IFZlY3RvcjIge1xyXG4gICAgcmV0dXJuIHRoaXMuYXRvbTEucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS5hdmVyYWdlKCB0aGlzLmF0b20yLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIGFuZ2xlIChpbiByYWRpYW5zKSBvZiBhdG9tMiByZWxhdGl2ZSB0byB0aGUgaG9yaXpvbnRhbCBheGlzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRBbmdsZSgpOiBudW1iZXIge1xyXG4gICAgY29uc3QgY2VudGVyID0gdGhpcy5nZXRDZW50ZXIoKTtcclxuICAgIHJldHVybiBNYXRoLmF0YW4yKCB0aGlzLmF0b20yLnBvc2l0aW9uUHJvcGVydHkudmFsdWUueSAtIGNlbnRlci55LCB0aGlzLmF0b20yLnBvc2l0aW9uUHJvcGVydHkudmFsdWUueCAtIGNlbnRlci54ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBib25kIGxlbmd0aCwgdGhlIGRpc3RhbmNlIGJldHdlZW4gdGhlIDIgYXRvbXMuXHJcbiAgICovXHJcbiAgcHVibGljIGdldExlbmd0aCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuYXRvbTEucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS5kaXN0YW5jZSggdGhpcy5hdG9tMi5wb3NpdGlvblByb3BlcnR5LnZhbHVlICk7XHJcbiAgfVxyXG59XHJcblxyXG5tb2xlY3VsZVBvbGFyaXR5LnJlZ2lzdGVyKCAnQm9uZCcsIEJvbmQgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLFlBQVksTUFBK0IsdUNBQXVDO0FBQ3pGLE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxPQUFPQyxhQUFhLE1BQU0sb0JBQW9CO0FBSTlDLE9BQU9DLFNBQVMsTUFBNEIsdUNBQXVDO0FBTW5GLGVBQWUsTUFBTUMsSUFBSSxTQUFTSixZQUFZLENBQUM7RUFNdENLLFdBQVdBLENBQUVDLEtBQVcsRUFBRUMsS0FBVyxFQUFFQyxlQUE0QixFQUFHO0lBRTNFLE1BQU1DLE9BQU8sR0FBR04sU0FBUyxDQUFnRCxDQUFDLENBQUU7TUFFMUU7TUFDQU8sV0FBVyxFQUFFO0lBQ2YsQ0FBQyxFQUFFRixlQUFnQixDQUFDO0lBRXBCLEtBQUssQ0FBRUMsT0FBUSxDQUFDO0lBRWhCLElBQUksQ0FBQ0gsS0FBSyxHQUFHQSxLQUFLO0lBQ2xCLElBQUksQ0FBQ0MsS0FBSyxHQUFHQSxLQUFLO0lBRWxCLElBQUksQ0FBQ0ksY0FBYyxHQUFHLElBQUliLGVBQWUsQ0FBRSxDQUN2Q1EsS0FBSyxDQUFDTSxnQkFBZ0IsRUFBRUwsS0FBSyxDQUFDSyxnQkFBZ0IsRUFDOUNOLEtBQUssQ0FBQ08seUJBQXlCLEVBQUVOLEtBQUssQ0FBQ00seUJBQXlCLEVBQ2hFWCxhQUFhLENBQUNZLHVCQUF1QixDQUN0QyxFQUNELENBQUVDLFNBQVMsRUFBRUMsU0FBUyxFQUFFQyxrQkFBa0IsRUFBRUMsa0JBQWtCLEVBQUVDLGVBQWUsS0FBTTtNQUVuRixNQUFNQyxPQUFPLEdBQUdGLGtCQUFrQixHQUFHRCxrQkFBa0I7O01BRXZEO01BQ0EsTUFBTUksU0FBUyxHQUFHQyxJQUFJLENBQUNDLEdBQUcsQ0FBRUgsT0FBUSxDQUFDO01BRXJDLElBQUlJLEtBQUssR0FBRyxJQUFJLENBQUNDLFFBQVEsQ0FBQyxDQUFDO01BQzNCLElBQUtMLE9BQU8sR0FBRyxDQUFDLEVBQUc7UUFDakJJLEtBQUssSUFBSUYsSUFBSSxDQUFDSSxFQUFFO01BQ2xCO01BRUEsTUFBTUMsTUFBTSxHQUFHNUIsT0FBTyxDQUFDNkIsV0FBVyxDQUFFUCxTQUFTLEVBQUVHLEtBQU0sQ0FBQzs7TUFFdEQ7TUFDQTtNQUNBO01BQ0EsSUFBS0wsZUFBZSxLQUFLLG9CQUFvQixFQUFHO1FBQzlDUSxNQUFNLENBQUNFLE1BQU0sQ0FBRVAsSUFBSSxDQUFDSSxFQUFHLENBQUM7TUFDMUI7TUFFQSxPQUFPQyxNQUFNO0lBQ2YsQ0FBQyxFQUFFO01BQ0RHLE1BQU0sRUFBRXJCLE9BQU8sQ0FBQ3FCLE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLGdCQUFpQixDQUFDO01BQ3ZEQyxlQUFlLEVBQUVqQyxPQUFPLENBQUNrQyxTQUFTO01BQ2xDQyxtQkFBbUIsRUFDakIsNkZBQTZGLEdBQzdGO0lBQ0osQ0FBRSxDQUFDO0VBQ1A7RUFFZ0JDLE9BQU9BLENBQUEsRUFBUztJQUM5QkMsTUFBTSxJQUFJQSxNQUFNLENBQUUsS0FBSyxFQUFFLDhEQUErRCxDQUFDO0lBQ3pGLEtBQUssQ0FBQ0QsT0FBTyxDQUFDLENBQUM7RUFDakI7O0VBRUE7QUFDRjtBQUNBO0VBQ1NFLFNBQVNBLENBQUEsRUFBWTtJQUMxQixPQUFPLElBQUksQ0FBQy9CLEtBQUssQ0FBQ00sZ0JBQWdCLENBQUMwQixLQUFLLENBQUNDLE9BQU8sQ0FBRSxJQUFJLENBQUNoQyxLQUFLLENBQUNLLGdCQUFnQixDQUFDMEIsS0FBTSxDQUFDO0VBQ3ZGOztFQUVBO0FBQ0Y7QUFDQTtFQUNTYixRQUFRQSxDQUFBLEVBQVc7SUFDeEIsTUFBTWUsTUFBTSxHQUFHLElBQUksQ0FBQ0gsU0FBUyxDQUFDLENBQUM7SUFDL0IsT0FBT2YsSUFBSSxDQUFDbUIsS0FBSyxDQUFFLElBQUksQ0FBQ2xDLEtBQUssQ0FBQ0ssZ0JBQWdCLENBQUMwQixLQUFLLENBQUNJLENBQUMsR0FBR0YsTUFBTSxDQUFDRSxDQUFDLEVBQUUsSUFBSSxDQUFDbkMsS0FBSyxDQUFDSyxnQkFBZ0IsQ0FBQzBCLEtBQUssQ0FBQ0ssQ0FBQyxHQUFHSCxNQUFNLENBQUNHLENBQUUsQ0FBQztFQUNySDs7RUFFQTtBQUNGO0FBQ0E7RUFDU0MsU0FBU0EsQ0FBQSxFQUFXO0lBQ3pCLE9BQU8sSUFBSSxDQUFDdEMsS0FBSyxDQUFDTSxnQkFBZ0IsQ0FBQzBCLEtBQUssQ0FBQ08sUUFBUSxDQUFFLElBQUksQ0FBQ3RDLEtBQUssQ0FBQ0ssZ0JBQWdCLENBQUMwQixLQUFNLENBQUM7RUFDeEY7QUFDRjtBQUVBckMsZ0JBQWdCLENBQUM2QyxRQUFRLENBQUUsTUFBTSxFQUFFMUMsSUFBSyxDQUFDIn0=