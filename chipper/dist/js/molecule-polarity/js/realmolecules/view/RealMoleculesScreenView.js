// Copyright 2014-2023, University of Colorado Boulder

/**
 * View for the 'Real Molecules' screen.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Multilink from '../../../../axon/js/Multilink.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import ScreenView from '../../../../joist/js/ScreenView.js';
import optionize from '../../../../phet-core/js/optionize.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import { Node } from '../../../../scenery/js/imports.js';
import MPPreferences from '../../common/model/MPPreferences.js';
import MPConstants from '../../common/MPConstants.js';
import MPQueryParameters from '../../common/MPQueryParameters.js';
import SurfaceColorKey from '../../common/view/SurfaceColorKey.js';
import moleculePolarity from '../../moleculePolarity.js';
import ElectronegativityTableNode from './ElectronegativityTableNode.js';
import RealMoleculesControl from './RealMoleculesControl.js';
import RealMoleculesControlPanel from './RealMoleculesControlPanel.js';
import RealMoleculesViewProperties from './RealMoleculesViewProperties.js';
import RealMoleculeViewer from './RealMoleculeViewer.js';
import UnderDevelopmentPanel from './UnderDevelopmentPanel.js';
export default class RealMoleculesScreenView extends ScreenView {
  constructor(model, providedOptions) {
    const options = optionize()({
      // ScreenViewOptions
      layoutBounds: MPConstants.LAYOUT_BOUNDS
    }, providedOptions);
    super(options);

    // view-specific Properties
    const viewProperties = new RealMoleculesViewProperties({
      tandem: options.tandem.createTandem('viewProperties')
    });
    this.moleculeViewer = new RealMoleculeViewer(model.moleculeProperty, viewProperties, {
      viewerSize: new Dimension2(450, 450),
      tandem: options.tandem.createTandem('moleculeViewer')
    });
    const electronegativityTableNode = new ElectronegativityTableNode(this.moleculeViewer, {
      visibleProperty: viewProperties.atomElectronegativitiesVisibleProperty,
      tandem: options.tandem.createTandem('electronegativityTableNode')
    });
    const comboBoxListParent = new Node();
    const moleculesComboBox = new RealMoleculesControl(model.moleculeProperty, model.molecules, comboBoxListParent, {
      comboBoxOptions: {
        tandem: options.tandem.createTandem('moleculesComboBox')
      }
    });

    // Group color keys under a common parent, so that PhET-iO can hide the color key.
    const colorKeysTandem = options.tandem.createTandem('colorKeys');
    const electrostaticPotentialRWBColorKey = SurfaceColorKey.createElectrostaticPotentialRWBColorKey({
      tandem: colorKeysTandem.createTandem('electrostaticPotentialRWBColorKey')
    });
    const electrostaticPotentialROYGBColorKey = SurfaceColorKey.createElectrostaticPotentialROYGBColorKey({
      tandem: colorKeysTandem.createTandem('electrostaticPotentialROYGBColorKey')
    });
    const electronDensityColorKey = SurfaceColorKey.createElectronDensityColorKey({
      tandem: colorKeysTandem.createTandem('electronDensityColorKey')
    });
    const colorKeysNode = new Node({
      children: [electrostaticPotentialRWBColorKey, electrostaticPotentialROYGBColorKey, electronDensityColorKey]
    });
    const controlPanel = new RealMoleculesControlPanel(viewProperties, {
      tandem: options.tandem.createTandem('controlPanel')
    });
    const resetAllButton = new ResetAllButton({
      listener: () => {
        this.interruptSubtreeInput();
        model.reset();
        viewProperties.reset();
      },
      scale: 1.32,
      tandem: options.tandem.createTandem('resetAllButton')
    });

    // Parent for all nodes added to this screen
    const rootNode = new Node({
      children: [this.moleculeViewer, electronegativityTableNode, moleculesComboBox, controlPanel, colorKeysNode, resetAllButton, comboBoxListParent // last, so that combo box list is on top
      ]
    });

    this.addChild(rootNode);

    // layout ---------------------------------

    this.moleculeViewer.left = 100;

    // centered above viewer
    electronegativityTableNode.centerX = this.moleculeViewer.centerX;
    electronegativityTableNode.top = this.layoutBounds.top + 25;

    // centered below electronegativity table
    colorKeysNode.centerX = electronegativityTableNode.centerX;
    colorKeysNode.top = electronegativityTableNode.bottom + 15;

    // below color keys
    this.moleculeViewer.top = colorKeysNode.bottom + 15;

    // centered below viewer
    moleculesComboBox.centerX = this.moleculeViewer.centerX;
    moleculesComboBox.top = this.moleculeViewer.bottom + 15;

    // right of viewer
    controlPanel.left = this.moleculeViewer.right + 100;
    controlPanel.centerY = this.layoutBounds.centerY;

    // bottom-right corner of the screen
    resetAllButton.right = this.layoutBounds.right - 40;
    resetAllButton.bottom = this.layoutBounds.bottom - 20;

    // synchronization with view Properties ------------------------------

    Multilink.multilink([viewProperties.surfaceTypeProperty, MPPreferences.surfaceColorProperty], (surfaceType, surfaceColor) => {
      electrostaticPotentialRWBColorKey.visible = surfaceType === 'electrostaticPotential' && surfaceColor === 'RWB';
      electrostaticPotentialROYGBColorKey.visible = surfaceType === 'electrostaticPotential' && surfaceColor === 'ROYGB';
      electronDensityColorKey.visible = surfaceType === 'electronDensity';
    });

    //TODO see https://github.com/phetsims/molecule-polarity/issues/32
    // Until the Real Molecules screen is fully implemented, hide everything that was created above, and display
    // a message. We're continuing to create everything to reduce the possibility that regressions creep in.
    if (!MPQueryParameters.realMolecules) {
      rootNode.visible = false;
      this.addChild(new UnderDevelopmentPanel(this.layoutBounds));
    }
  }
}
moleculePolarity.register('RealMoleculesScreenView', RealMoleculesScreenView);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJEaW1lbnNpb24yIiwiU2NyZWVuVmlldyIsIm9wdGlvbml6ZSIsIlJlc2V0QWxsQnV0dG9uIiwiTm9kZSIsIk1QUHJlZmVyZW5jZXMiLCJNUENvbnN0YW50cyIsIk1QUXVlcnlQYXJhbWV0ZXJzIiwiU3VyZmFjZUNvbG9yS2V5IiwibW9sZWN1bGVQb2xhcml0eSIsIkVsZWN0cm9uZWdhdGl2aXR5VGFibGVOb2RlIiwiUmVhbE1vbGVjdWxlc0NvbnRyb2wiLCJSZWFsTW9sZWN1bGVzQ29udHJvbFBhbmVsIiwiUmVhbE1vbGVjdWxlc1ZpZXdQcm9wZXJ0aWVzIiwiUmVhbE1vbGVjdWxlVmlld2VyIiwiVW5kZXJEZXZlbG9wbWVudFBhbmVsIiwiUmVhbE1vbGVjdWxlc1NjcmVlblZpZXciLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImxheW91dEJvdW5kcyIsIkxBWU9VVF9CT1VORFMiLCJ2aWV3UHJvcGVydGllcyIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsIm1vbGVjdWxlVmlld2VyIiwibW9sZWN1bGVQcm9wZXJ0eSIsInZpZXdlclNpemUiLCJlbGVjdHJvbmVnYXRpdml0eVRhYmxlTm9kZSIsInZpc2libGVQcm9wZXJ0eSIsImF0b21FbGVjdHJvbmVnYXRpdml0aWVzVmlzaWJsZVByb3BlcnR5IiwiY29tYm9Cb3hMaXN0UGFyZW50IiwibW9sZWN1bGVzQ29tYm9Cb3giLCJtb2xlY3VsZXMiLCJjb21ib0JveE9wdGlvbnMiLCJjb2xvcktleXNUYW5kZW0iLCJlbGVjdHJvc3RhdGljUG90ZW50aWFsUldCQ29sb3JLZXkiLCJjcmVhdGVFbGVjdHJvc3RhdGljUG90ZW50aWFsUldCQ29sb3JLZXkiLCJlbGVjdHJvc3RhdGljUG90ZW50aWFsUk9ZR0JDb2xvcktleSIsImNyZWF0ZUVsZWN0cm9zdGF0aWNQb3RlbnRpYWxST1lHQkNvbG9yS2V5IiwiZWxlY3Ryb25EZW5zaXR5Q29sb3JLZXkiLCJjcmVhdGVFbGVjdHJvbkRlbnNpdHlDb2xvcktleSIsImNvbG9yS2V5c05vZGUiLCJjaGlsZHJlbiIsImNvbnRyb2xQYW5lbCIsInJlc2V0QWxsQnV0dG9uIiwibGlzdGVuZXIiLCJpbnRlcnJ1cHRTdWJ0cmVlSW5wdXQiLCJyZXNldCIsInNjYWxlIiwicm9vdE5vZGUiLCJhZGRDaGlsZCIsImxlZnQiLCJjZW50ZXJYIiwidG9wIiwiYm90dG9tIiwicmlnaHQiLCJjZW50ZXJZIiwibXVsdGlsaW5rIiwic3VyZmFjZVR5cGVQcm9wZXJ0eSIsInN1cmZhY2VDb2xvclByb3BlcnR5Iiwic3VyZmFjZVR5cGUiLCJzdXJmYWNlQ29sb3IiLCJ2aXNpYmxlIiwicmVhbE1vbGVjdWxlcyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUmVhbE1vbGVjdWxlc1NjcmVlblZpZXcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVmlldyBmb3IgdGhlICdSZWFsIE1vbGVjdWxlcycgc2NyZWVuLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCBTY3JlZW5WaWV3LCB7IFNjcmVlblZpZXdPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vam9pc3QvanMvU2NyZWVuVmlldy5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgUmVzZXRBbGxCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL2J1dHRvbnMvUmVzZXRBbGxCdXR0b24uanMnO1xyXG5pbXBvcnQgeyBOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IE1QUHJlZmVyZW5jZXMgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL01QUHJlZmVyZW5jZXMuanMnO1xyXG5pbXBvcnQgTVBDb25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL01QQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IE1QUXVlcnlQYXJhbWV0ZXJzIGZyb20gJy4uLy4uL2NvbW1vbi9NUFF1ZXJ5UGFyYW1ldGVycy5qcyc7XHJcbmltcG9ydCBTdXJmYWNlQ29sb3JLZXkgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvU3VyZmFjZUNvbG9yS2V5LmpzJztcclxuaW1wb3J0IG1vbGVjdWxlUG9sYXJpdHkgZnJvbSAnLi4vLi4vbW9sZWN1bGVQb2xhcml0eS5qcyc7XHJcbmltcG9ydCBSZWFsTW9sZWN1bGVzTW9kZWwgZnJvbSAnLi4vbW9kZWwvUmVhbE1vbGVjdWxlc01vZGVsLmpzJztcclxuaW1wb3J0IEVsZWN0cm9uZWdhdGl2aXR5VGFibGVOb2RlIGZyb20gJy4vRWxlY3Ryb25lZ2F0aXZpdHlUYWJsZU5vZGUuanMnO1xyXG5pbXBvcnQgUmVhbE1vbGVjdWxlc0NvbnRyb2wgZnJvbSAnLi9SZWFsTW9sZWN1bGVzQ29udHJvbC5qcyc7XHJcbmltcG9ydCBSZWFsTW9sZWN1bGVzQ29udHJvbFBhbmVsIGZyb20gJy4vUmVhbE1vbGVjdWxlc0NvbnRyb2xQYW5lbC5qcyc7XHJcbmltcG9ydCBSZWFsTW9sZWN1bGVzVmlld1Byb3BlcnRpZXMgZnJvbSAnLi9SZWFsTW9sZWN1bGVzVmlld1Byb3BlcnRpZXMuanMnO1xyXG5pbXBvcnQgUmVhbE1vbGVjdWxlVmlld2VyIGZyb20gJy4vUmVhbE1vbGVjdWxlVmlld2VyLmpzJztcclxuaW1wb3J0IFVuZGVyRGV2ZWxvcG1lbnRQYW5lbCBmcm9tICcuL1VuZGVyRGV2ZWxvcG1lbnRQYW5lbC5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0gRW1wdHlTZWxmT3B0aW9ucztcclxuXHJcbnR5cGUgUmVhbE1vbGVjdWxlc1NjcmVlblZpZXdPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBQaWNrUmVxdWlyZWQ8U2NyZWVuVmlld09wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJlYWxNb2xlY3VsZXNTY3JlZW5WaWV3IGV4dGVuZHMgU2NyZWVuVmlldyB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgbW9sZWN1bGVWaWV3ZXI6IFJlYWxNb2xlY3VsZVZpZXdlcjtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBtb2RlbDogUmVhbE1vbGVjdWxlc01vZGVsLCBwcm92aWRlZE9wdGlvbnM6IFJlYWxNb2xlY3VsZXNTY3JlZW5WaWV3T3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFJlYWxNb2xlY3VsZXNTY3JlZW5WaWV3T3B0aW9ucywgU2VsZk9wdGlvbnMsIFNjcmVlblZpZXdPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBTY3JlZW5WaWV3T3B0aW9uc1xyXG4gICAgICBsYXlvdXRCb3VuZHM6IE1QQ29uc3RhbnRzLkxBWU9VVF9CT1VORFNcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gdmlldy1zcGVjaWZpYyBQcm9wZXJ0aWVzXHJcbiAgICBjb25zdCB2aWV3UHJvcGVydGllcyA9IG5ldyBSZWFsTW9sZWN1bGVzVmlld1Byb3BlcnRpZXMoIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICd2aWV3UHJvcGVydGllcycgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMubW9sZWN1bGVWaWV3ZXIgPSBuZXcgUmVhbE1vbGVjdWxlVmlld2VyKCBtb2RlbC5tb2xlY3VsZVByb3BlcnR5LCB2aWV3UHJvcGVydGllcywge1xyXG4gICAgICB2aWV3ZXJTaXplOiBuZXcgRGltZW5zaW9uMiggNDUwLCA0NTAgKSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdtb2xlY3VsZVZpZXdlcicgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGVsZWN0cm9uZWdhdGl2aXR5VGFibGVOb2RlID0gbmV3IEVsZWN0cm9uZWdhdGl2aXR5VGFibGVOb2RlKCB0aGlzLm1vbGVjdWxlVmlld2VyLCB7XHJcbiAgICAgIHZpc2libGVQcm9wZXJ0eTogdmlld1Byb3BlcnRpZXMuYXRvbUVsZWN0cm9uZWdhdGl2aXRpZXNWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZWxlY3Ryb25lZ2F0aXZpdHlUYWJsZU5vZGUnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBjb21ib0JveExpc3RQYXJlbnQgPSBuZXcgTm9kZSgpO1xyXG4gICAgY29uc3QgbW9sZWN1bGVzQ29tYm9Cb3ggPSBuZXcgUmVhbE1vbGVjdWxlc0NvbnRyb2woIG1vZGVsLm1vbGVjdWxlUHJvcGVydHksIG1vZGVsLm1vbGVjdWxlcywgY29tYm9Cb3hMaXN0UGFyZW50LCB7XHJcbiAgICAgIGNvbWJvQm94T3B0aW9uczoge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnbW9sZWN1bGVzQ29tYm9Cb3gnIClcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEdyb3VwIGNvbG9yIGtleXMgdW5kZXIgYSBjb21tb24gcGFyZW50LCBzbyB0aGF0IFBoRVQtaU8gY2FuIGhpZGUgdGhlIGNvbG9yIGtleS5cclxuICAgIGNvbnN0IGNvbG9yS2V5c1RhbmRlbSA9IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NvbG9yS2V5cycgKTtcclxuXHJcbiAgICBjb25zdCBlbGVjdHJvc3RhdGljUG90ZW50aWFsUldCQ29sb3JLZXkgPSBTdXJmYWNlQ29sb3JLZXkuY3JlYXRlRWxlY3Ryb3N0YXRpY1BvdGVudGlhbFJXQkNvbG9yS2V5KCB7XHJcbiAgICAgIHRhbmRlbTogY29sb3JLZXlzVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2VsZWN0cm9zdGF0aWNQb3RlbnRpYWxSV0JDb2xvcktleScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGVsZWN0cm9zdGF0aWNQb3RlbnRpYWxST1lHQkNvbG9yS2V5ID0gU3VyZmFjZUNvbG9yS2V5LmNyZWF0ZUVsZWN0cm9zdGF0aWNQb3RlbnRpYWxST1lHQkNvbG9yS2V5KCB7XHJcbiAgICAgIHRhbmRlbTogY29sb3JLZXlzVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2VsZWN0cm9zdGF0aWNQb3RlbnRpYWxST1lHQkNvbG9yS2V5JyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgZWxlY3Ryb25EZW5zaXR5Q29sb3JLZXkgPSBTdXJmYWNlQ29sb3JLZXkuY3JlYXRlRWxlY3Ryb25EZW5zaXR5Q29sb3JLZXkoIHtcclxuICAgICAgdGFuZGVtOiBjb2xvcktleXNUYW5kZW0uY3JlYXRlVGFuZGVtKCAnZWxlY3Ryb25EZW5zaXR5Q29sb3JLZXknIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBjb2xvcktleXNOb2RlID0gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBlbGVjdHJvc3RhdGljUG90ZW50aWFsUldCQ29sb3JLZXksXHJcbiAgICAgICAgZWxlY3Ryb3N0YXRpY1BvdGVudGlhbFJPWUdCQ29sb3JLZXksXHJcbiAgICAgICAgZWxlY3Ryb25EZW5zaXR5Q29sb3JLZXlcclxuICAgICAgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGNvbnRyb2xQYW5lbCA9IG5ldyBSZWFsTW9sZWN1bGVzQ29udHJvbFBhbmVsKCB2aWV3UHJvcGVydGllcywge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NvbnRyb2xQYW5lbCcgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHJlc2V0QWxsQnV0dG9uID0gbmV3IFJlc2V0QWxsQnV0dG9uKCB7XHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5pbnRlcnJ1cHRTdWJ0cmVlSW5wdXQoKTtcclxuICAgICAgICBtb2RlbC5yZXNldCgpO1xyXG4gICAgICAgIHZpZXdQcm9wZXJ0aWVzLnJlc2V0KCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIHNjYWxlOiAxLjMyLFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Jlc2V0QWxsQnV0dG9uJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gUGFyZW50IGZvciBhbGwgbm9kZXMgYWRkZWQgdG8gdGhpcyBzY3JlZW5cclxuICAgIGNvbnN0IHJvb3ROb2RlID0gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICB0aGlzLm1vbGVjdWxlVmlld2VyLFxyXG4gICAgICAgIGVsZWN0cm9uZWdhdGl2aXR5VGFibGVOb2RlLFxyXG4gICAgICAgIG1vbGVjdWxlc0NvbWJvQm94LFxyXG4gICAgICAgIGNvbnRyb2xQYW5lbCxcclxuICAgICAgICBjb2xvcktleXNOb2RlLFxyXG4gICAgICAgIHJlc2V0QWxsQnV0dG9uLFxyXG4gICAgICAgIGNvbWJvQm94TGlzdFBhcmVudCAvLyBsYXN0LCBzbyB0aGF0IGNvbWJvIGJveCBsaXN0IGlzIG9uIHRvcFxyXG4gICAgICBdXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCByb290Tm9kZSApO1xyXG5cclxuICAgIC8vIGxheW91dCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgICB0aGlzLm1vbGVjdWxlVmlld2VyLmxlZnQgPSAxMDA7XHJcblxyXG4gICAgLy8gY2VudGVyZWQgYWJvdmUgdmlld2VyXHJcbiAgICBlbGVjdHJvbmVnYXRpdml0eVRhYmxlTm9kZS5jZW50ZXJYID0gdGhpcy5tb2xlY3VsZVZpZXdlci5jZW50ZXJYO1xyXG4gICAgZWxlY3Ryb25lZ2F0aXZpdHlUYWJsZU5vZGUudG9wID0gdGhpcy5sYXlvdXRCb3VuZHMudG9wICsgMjU7XHJcblxyXG4gICAgLy8gY2VudGVyZWQgYmVsb3cgZWxlY3Ryb25lZ2F0aXZpdHkgdGFibGVcclxuICAgIGNvbG9yS2V5c05vZGUuY2VudGVyWCA9IGVsZWN0cm9uZWdhdGl2aXR5VGFibGVOb2RlLmNlbnRlclg7XHJcbiAgICBjb2xvcktleXNOb2RlLnRvcCA9IGVsZWN0cm9uZWdhdGl2aXR5VGFibGVOb2RlLmJvdHRvbSArIDE1O1xyXG5cclxuICAgIC8vIGJlbG93IGNvbG9yIGtleXNcclxuICAgIHRoaXMubW9sZWN1bGVWaWV3ZXIudG9wID0gY29sb3JLZXlzTm9kZS5ib3R0b20gKyAxNTtcclxuXHJcbiAgICAvLyBjZW50ZXJlZCBiZWxvdyB2aWV3ZXJcclxuICAgIG1vbGVjdWxlc0NvbWJvQm94LmNlbnRlclggPSB0aGlzLm1vbGVjdWxlVmlld2VyLmNlbnRlclg7XHJcbiAgICBtb2xlY3VsZXNDb21ib0JveC50b3AgPSB0aGlzLm1vbGVjdWxlVmlld2VyLmJvdHRvbSArIDE1O1xyXG5cclxuICAgIC8vIHJpZ2h0IG9mIHZpZXdlclxyXG4gICAgY29udHJvbFBhbmVsLmxlZnQgPSB0aGlzLm1vbGVjdWxlVmlld2VyLnJpZ2h0ICsgMTAwO1xyXG4gICAgY29udHJvbFBhbmVsLmNlbnRlclkgPSB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJZO1xyXG5cclxuICAgIC8vIGJvdHRvbS1yaWdodCBjb3JuZXIgb2YgdGhlIHNjcmVlblxyXG4gICAgcmVzZXRBbGxCdXR0b24ucmlnaHQgPSB0aGlzLmxheW91dEJvdW5kcy5yaWdodCAtIDQwO1xyXG4gICAgcmVzZXRBbGxCdXR0b24uYm90dG9tID0gdGhpcy5sYXlvdXRCb3VuZHMuYm90dG9tIC0gMjA7XHJcblxyXG4gICAgLy8gc3luY2hyb25pemF0aW9uIHdpdGggdmlldyBQcm9wZXJ0aWVzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFsgdmlld1Byb3BlcnRpZXMuc3VyZmFjZVR5cGVQcm9wZXJ0eSwgTVBQcmVmZXJlbmNlcy5zdXJmYWNlQ29sb3JQcm9wZXJ0eSBdLFxyXG4gICAgICAoIHN1cmZhY2VUeXBlLCBzdXJmYWNlQ29sb3IgKSA9PiB7XHJcbiAgICAgICAgZWxlY3Ryb3N0YXRpY1BvdGVudGlhbFJXQkNvbG9yS2V5LnZpc2libGUgPSAoIHN1cmZhY2VUeXBlID09PSAnZWxlY3Ryb3N0YXRpY1BvdGVudGlhbCcgJiYgc3VyZmFjZUNvbG9yID09PSAnUldCJyApO1xyXG4gICAgICAgIGVsZWN0cm9zdGF0aWNQb3RlbnRpYWxST1lHQkNvbG9yS2V5LnZpc2libGUgPSAoIHN1cmZhY2VUeXBlID09PSAnZWxlY3Ryb3N0YXRpY1BvdGVudGlhbCcgJiYgc3VyZmFjZUNvbG9yID09PSAnUk9ZR0InICk7XHJcbiAgICAgICAgZWxlY3Ryb25EZW5zaXR5Q29sb3JLZXkudmlzaWJsZSA9ICggc3VyZmFjZVR5cGUgPT09ICdlbGVjdHJvbkRlbnNpdHknICk7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvL1RPRE8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9tb2xlY3VsZS1wb2xhcml0eS9pc3N1ZXMvMzJcclxuICAgIC8vIFVudGlsIHRoZSBSZWFsIE1vbGVjdWxlcyBzY3JlZW4gaXMgZnVsbHkgaW1wbGVtZW50ZWQsIGhpZGUgZXZlcnl0aGluZyB0aGF0IHdhcyBjcmVhdGVkIGFib3ZlLCBhbmQgZGlzcGxheVxyXG4gICAgLy8gYSBtZXNzYWdlLiBXZSdyZSBjb250aW51aW5nIHRvIGNyZWF0ZSBldmVyeXRoaW5nIHRvIHJlZHVjZSB0aGUgcG9zc2liaWxpdHkgdGhhdCByZWdyZXNzaW9ucyBjcmVlcCBpbi5cclxuICAgIGlmICggIU1QUXVlcnlQYXJhbWV0ZXJzLnJlYWxNb2xlY3VsZXMgKSB7XHJcbiAgICAgIHJvb3ROb2RlLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgdGhpcy5hZGRDaGlsZCggbmV3IFVuZGVyRGV2ZWxvcG1lbnRQYW5lbCggdGhpcy5sYXlvdXRCb3VuZHMgKSApO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxubW9sZWN1bGVQb2xhcml0eS5yZWdpc3RlciggJ1JlYWxNb2xlY3VsZXNTY3JlZW5WaWV3JywgUmVhbE1vbGVjdWxlc1NjcmVlblZpZXcgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsU0FBUyxNQUFNLGtDQUFrQztBQUN4RCxPQUFPQyxVQUFVLE1BQU0sa0NBQWtDO0FBQ3pELE9BQU9DLFVBQVUsTUFBNkIsb0NBQW9DO0FBQ2xGLE9BQU9DLFNBQVMsTUFBNEIsdUNBQXVDO0FBRW5GLE9BQU9DLGNBQWMsTUFBTSx1REFBdUQ7QUFDbEYsU0FBU0MsSUFBSSxRQUFRLG1DQUFtQztBQUN4RCxPQUFPQyxhQUFhLE1BQU0scUNBQXFDO0FBQy9ELE9BQU9DLFdBQVcsTUFBTSw2QkFBNkI7QUFDckQsT0FBT0MsaUJBQWlCLE1BQU0sbUNBQW1DO0FBQ2pFLE9BQU9DLGVBQWUsTUFBTSxzQ0FBc0M7QUFDbEUsT0FBT0MsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBRXhELE9BQU9DLDBCQUEwQixNQUFNLGlDQUFpQztBQUN4RSxPQUFPQyxvQkFBb0IsTUFBTSwyQkFBMkI7QUFDNUQsT0FBT0MseUJBQXlCLE1BQU0sZ0NBQWdDO0FBQ3RFLE9BQU9DLDJCQUEyQixNQUFNLGtDQUFrQztBQUMxRSxPQUFPQyxrQkFBa0IsTUFBTSx5QkFB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