// Copyright 2023, University of Colorado Boulder

/**
 * The controls in the ScreenView that are related to connection to prototype tangibles. For example, they will
 * support connection to a bluetooth device, serial connection, or begin calibration with a physical device.
 *
 * These are not shown unless requested with query parameters (different controls shown depending on requested feature,
 * see QuadrilateralQueryParameters).
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import { Text, VBox } from '../../../../../scenery/js/imports.js';
import quadrilateral from '../../../quadrilateral.js';
import QuadrilateralConstants from '../../../QuadrilateralConstants.js';
import QuadrilateralCalibrationContentNode from './QuadrilateralCalibrationContentNode.js';
import Dialog from '../../../../../sun/js/Dialog.js';
import TextPushButton from '../../../../../sun/js/buttons/TextPushButton.js';
import QuadrilateralColors from '../../../QuadrilateralColors.js';
import QuadrilateralQueryParameters from '../../QuadrilateralQueryParameters.js';
import QuadrilateralBluetoothConnectionButton from './QuadrilateralBluetoothConnectionButton.js';
import QuadrilateralSerialConnectionButton from './QuadrilateralSerialConnectionButton.js';
export default class QuadrilateralTangibleControls extends VBox {
  constructor(tangibleConnectionModel, tangibleController, tandem) {
    // Add a Dialog that will calibrate the device to the simulation (mapping physical data to modelled data).
    const calibrationDialog = new Dialog(new QuadrilateralCalibrationContentNode(tangibleConnectionModel), {
      title: new Text('External Device Calibration', QuadrilateralConstants.PANEL_TITLE_TEXT_OPTIONS)
    });
    calibrationDialog.isShowingProperty.link((isShowing, wasShowing) => {
      tangibleConnectionModel.isCalibratingProperty.value = isShowing;

      // When the dialog is closed...
      if (!isShowing && wasShowing !== null) {
        // it is possible that the Dialog was closed without getting good values for the bounds
        const physicalModelBounds = tangibleConnectionModel.physicalModelBoundsProperty.value;
        if (physicalModelBounds && physicalModelBounds.isValid()) {
          // set reasonable initial positions of vertices
          tangibleController.finishCalibration();
        }
      }
    });

    // final contents depend on query parameters
    const children = [];

    // open the calibration dialog
    const calibrationButton = new TextPushButton('Calibrate Device', {
      listener: () => {
        calibrationDialog.show();
      },
      textNodeOptions: QuadrilateralConstants.SCREEN_TEXT_OPTIONS,
      baseColor: QuadrilateralColors.screenViewButtonColorProperty
    });
    children.push(calibrationButton);
    if (QuadrilateralQueryParameters.bluetooth) {
      // request BLE devices
      const bluetoothButton = new QuadrilateralBluetoothConnectionButton(tangibleConnectionModel, tangibleController);
      children.push(bluetoothButton);
    }
    if (QuadrilateralQueryParameters.serial) {
      // send values to the device with serial connection
      const sendValuesButton = new QuadrilateralSerialConnectionButton(tangibleConnectionModel);
      children.push(sendValuesButton);
    }
    super({
      align: 'left',
      spacing: QuadrilateralConstants.CONTROLS_SPACING,
      children: children
    });
  }
}
quadrilateral.register('QuadrilateralTangibleControls', QuadrilateralTangibleControls);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJUZXh0IiwiVkJveCIsInF1YWRyaWxhdGVyYWwiLCJRdWFkcmlsYXRlcmFsQ29uc3RhbnRzIiwiUXVhZHJpbGF0ZXJhbENhbGlicmF0aW9uQ29udGVudE5vZGUiLCJEaWFsb2ciLCJUZXh0UHVzaEJ1dHRvbiIsIlF1YWRyaWxhdGVyYWxDb2xvcnMiLCJRdWFkcmlsYXRlcmFsUXVlcnlQYXJhbWV0ZXJzIiwiUXVhZHJpbGF0ZXJhbEJsdWV0b290aENvbm5lY3Rpb25CdXR0b24iLCJRdWFkcmlsYXRlcmFsU2VyaWFsQ29ubmVjdGlvbkJ1dHRvbiIsIlF1YWRyaWxhdGVyYWxUYW5naWJsZUNvbnRyb2xzIiwiY29uc3RydWN0b3IiLCJ0YW5naWJsZUNvbm5lY3Rpb25Nb2RlbCIsInRhbmdpYmxlQ29udHJvbGxlciIsInRhbmRlbSIsImNhbGlicmF0aW9uRGlhbG9nIiwidGl0bGUiLCJQQU5FTF9USVRMRV9URVhUX09QVElPTlMiLCJpc1Nob3dpbmdQcm9wZXJ0eSIsImxpbmsiLCJpc1Nob3dpbmciLCJ3YXNTaG93aW5nIiwiaXNDYWxpYnJhdGluZ1Byb3BlcnR5IiwidmFsdWUiLCJwaHlzaWNhbE1vZGVsQm91bmRzIiwicGh5c2ljYWxNb2RlbEJvdW5kc1Byb3BlcnR5IiwiaXNWYWxpZCIsImZpbmlzaENhbGlicmF0aW9uIiwiY2hpbGRyZW4iLCJjYWxpYnJhdGlvbkJ1dHRvbiIsImxpc3RlbmVyIiwic2hvdyIsInRleHROb2RlT3B0aW9ucyIsIlNDUkVFTl9URVhUX09QVElPTlMiLCJiYXNlQ29sb3IiLCJzY3JlZW5WaWV3QnV0dG9uQ29sb3JQcm9wZXJ0eSIsInB1c2giLCJibHVldG9vdGgiLCJibHVldG9vdGhCdXR0b24iLCJzZXJpYWwiLCJzZW5kVmFsdWVzQnV0dG9uIiwiYWxpZ24iLCJzcGFjaW5nIiwiQ09OVFJPTFNfU1BBQ0lORyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUXVhZHJpbGF0ZXJhbFRhbmdpYmxlQ29udHJvbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFRoZSBjb250cm9scyBpbiB0aGUgU2NyZWVuVmlldyB0aGF0IGFyZSByZWxhdGVkIHRvIGNvbm5lY3Rpb24gdG8gcHJvdG90eXBlIHRhbmdpYmxlcy4gRm9yIGV4YW1wbGUsIHRoZXkgd2lsbFxyXG4gKiBzdXBwb3J0IGNvbm5lY3Rpb24gdG8gYSBibHVldG9vdGggZGV2aWNlLCBzZXJpYWwgY29ubmVjdGlvbiwgb3IgYmVnaW4gY2FsaWJyYXRpb24gd2l0aCBhIHBoeXNpY2FsIGRldmljZS5cclxuICpcclxuICogVGhlc2UgYXJlIG5vdCBzaG93biB1bmxlc3MgcmVxdWVzdGVkIHdpdGggcXVlcnkgcGFyYW1ldGVycyAoZGlmZmVyZW50IGNvbnRyb2xzIHNob3duIGRlcGVuZGluZyBvbiByZXF1ZXN0ZWQgZmVhdHVyZSxcclxuICogc2VlIFF1YWRyaWxhdGVyYWxRdWVyeVBhcmFtZXRlcnMpLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgeyBUZXh0LCBWQm94IH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHF1YWRyaWxhdGVyYWwgZnJvbSAnLi4vLi4vLi4vcXVhZHJpbGF0ZXJhbC5qcyc7XHJcbmltcG9ydCBRdWFkcmlsYXRlcmFsQ29uc3RhbnRzIGZyb20gJy4uLy4uLy4uL1F1YWRyaWxhdGVyYWxDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgVGFuZ2libGVDb25uZWN0aW9uTW9kZWwgZnJvbSAnLi4vLi4vbW9kZWwvcHJvdG90eXBlL1RhbmdpYmxlQ29ubmVjdGlvbk1vZGVsLmpzJztcclxuaW1wb3J0IFF1YWRyaWxhdGVyYWxDYWxpYnJhdGlvbkNvbnRlbnROb2RlIGZyb20gJy4vUXVhZHJpbGF0ZXJhbENhbGlicmF0aW9uQ29udGVudE5vZGUuanMnO1xyXG5pbXBvcnQgRGlhbG9nIGZyb20gJy4uLy4uLy4uLy4uLy4uL3N1bi9qcy9EaWFsb2cuanMnO1xyXG5pbXBvcnQgVGV4dFB1c2hCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc3VuL2pzL2J1dHRvbnMvVGV4dFB1c2hCdXR0b24uanMnO1xyXG5pbXBvcnQgUXVhZHJpbGF0ZXJhbENvbG9ycyBmcm9tICcuLi8uLi8uLi9RdWFkcmlsYXRlcmFsQ29sb3JzLmpzJztcclxuaW1wb3J0IFF1YWRyaWxhdGVyYWxRdWVyeVBhcmFtZXRlcnMgZnJvbSAnLi4vLi4vUXVhZHJpbGF0ZXJhbFF1ZXJ5UGFyYW1ldGVycy5qcyc7XHJcbmltcG9ydCBRdWFkcmlsYXRlcmFsQmx1ZXRvb3RoQ29ubmVjdGlvbkJ1dHRvbiBmcm9tICcuL1F1YWRyaWxhdGVyYWxCbHVldG9vdGhDb25uZWN0aW9uQnV0dG9uLmpzJztcclxuaW1wb3J0IFF1YWRyaWxhdGVyYWxTZXJpYWxDb25uZWN0aW9uQnV0dG9uIGZyb20gJy4vUXVhZHJpbGF0ZXJhbFNlcmlhbENvbm5lY3Rpb25CdXR0b24uanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgUXVhZHJpbGF0ZXJhbFRhbmdpYmxlQ29udHJvbGxlciBmcm9tICcuL1F1YWRyaWxhdGVyYWxUYW5naWJsZUNvbnRyb2xsZXIuanMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUXVhZHJpbGF0ZXJhbFRhbmdpYmxlQ29udHJvbHMgZXh0ZW5kcyBWQm94IHtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHRhbmdpYmxlQ29ubmVjdGlvbk1vZGVsOiBUYW5naWJsZUNvbm5lY3Rpb25Nb2RlbCwgdGFuZ2libGVDb250cm9sbGVyOiBRdWFkcmlsYXRlcmFsVGFuZ2libGVDb250cm9sbGVyLCB0YW5kZW06IFRhbmRlbSApIHtcclxuXHJcbiAgICAvLyBBZGQgYSBEaWFsb2cgdGhhdCB3aWxsIGNhbGlicmF0ZSB0aGUgZGV2aWNlIHRvIHRoZSBzaW11bGF0aW9uIChtYXBwaW5nIHBoeXNpY2FsIGRhdGEgdG8gbW9kZWxsZWQgZGF0YSkuXHJcbiAgICBjb25zdCBjYWxpYnJhdGlvbkRpYWxvZyA9IG5ldyBEaWFsb2coIG5ldyBRdWFkcmlsYXRlcmFsQ2FsaWJyYXRpb25Db250ZW50Tm9kZSggdGFuZ2libGVDb25uZWN0aW9uTW9kZWwgKSwge1xyXG4gICAgICB0aXRsZTogbmV3IFRleHQoICdFeHRlcm5hbCBEZXZpY2UgQ2FsaWJyYXRpb24nLCBRdWFkcmlsYXRlcmFsQ29uc3RhbnRzLlBBTkVMX1RJVExFX1RFWFRfT1BUSU9OUyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY2FsaWJyYXRpb25EaWFsb2cuaXNTaG93aW5nUHJvcGVydHkubGluayggKCBpc1Nob3dpbmcsIHdhc1Nob3dpbmcgKSA9PiB7XHJcbiAgICAgIHRhbmdpYmxlQ29ubmVjdGlvbk1vZGVsLmlzQ2FsaWJyYXRpbmdQcm9wZXJ0eS52YWx1ZSA9IGlzU2hvd2luZztcclxuXHJcbiAgICAgIC8vIFdoZW4gdGhlIGRpYWxvZyBpcyBjbG9zZWQuLi5cclxuICAgICAgaWYgKCAhaXNTaG93aW5nICYmIHdhc1Nob3dpbmcgIT09IG51bGwgKSB7XHJcblxyXG4gICAgICAgIC8vIGl0IGlzIHBvc3NpYmxlIHRoYXQgdGhlIERpYWxvZyB3YXMgY2xvc2VkIHdpdGhvdXQgZ2V0dGluZyBnb29kIHZhbHVlcyBmb3IgdGhlIGJvdW5kc1xyXG4gICAgICAgIGNvbnN0IHBoeXNpY2FsTW9kZWxCb3VuZHMgPSB0YW5naWJsZUNvbm5lY3Rpb25Nb2RlbC5waHlzaWNhbE1vZGVsQm91bmRzUHJvcGVydHkudmFsdWU7XHJcbiAgICAgICAgaWYgKCBwaHlzaWNhbE1vZGVsQm91bmRzICYmIHBoeXNpY2FsTW9kZWxCb3VuZHMuaXNWYWxpZCgpICkge1xyXG5cclxuICAgICAgICAgIC8vIHNldCByZWFzb25hYmxlIGluaXRpYWwgcG9zaXRpb25zIG9mIHZlcnRpY2VzXHJcbiAgICAgICAgICB0YW5naWJsZUNvbnRyb2xsZXIuZmluaXNoQ2FsaWJyYXRpb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBmaW5hbCBjb250ZW50cyBkZXBlbmQgb24gcXVlcnkgcGFyYW1ldGVyc1xyXG4gICAgY29uc3QgY2hpbGRyZW4gPSBbXTtcclxuXHJcbiAgICAvLyBvcGVuIHRoZSBjYWxpYnJhdGlvbiBkaWFsb2dcclxuICAgIGNvbnN0IGNhbGlicmF0aW9uQnV0dG9uID0gbmV3IFRleHRQdXNoQnV0dG9uKCAnQ2FsaWJyYXRlIERldmljZScsIHtcclxuICAgICAgbGlzdGVuZXI6ICgpID0+IHtcclxuICAgICAgICBjYWxpYnJhdGlvbkRpYWxvZy5zaG93KCk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICB0ZXh0Tm9kZU9wdGlvbnM6IFF1YWRyaWxhdGVyYWxDb25zdGFudHMuU0NSRUVOX1RFWFRfT1BUSU9OUyxcclxuICAgICAgYmFzZUNvbG9yOiBRdWFkcmlsYXRlcmFsQ29sb3JzLnNjcmVlblZpZXdCdXR0b25Db2xvclByb3BlcnR5XHJcbiAgICB9ICk7XHJcbiAgICBjaGlsZHJlbi5wdXNoKCBjYWxpYnJhdGlvbkJ1dHRvbiApO1xyXG5cclxuICAgIGlmICggUXVhZHJpbGF0ZXJhbFF1ZXJ5UGFyYW1ldGVycy5ibHVldG9vdGggKSB7XHJcblxyXG4gICAgICAvLyByZXF1ZXN0IEJMRSBkZXZpY2VzXHJcbiAgICAgIGNvbnN0IGJsdWV0b290aEJ1dHRvbiA9IG5ldyBRdWFkcmlsYXRlcmFsQmx1ZXRvb3RoQ29ubmVjdGlvbkJ1dHRvbiggdGFuZ2libGVDb25uZWN0aW9uTW9kZWwsIHRhbmdpYmxlQ29udHJvbGxlciApO1xyXG4gICAgICBjaGlsZHJlbi5wdXNoKCBibHVldG9vdGhCdXR0b24gKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIFF1YWRyaWxhdGVyYWxRdWVyeVBhcmFtZXRlcnMuc2VyaWFsICkge1xyXG5cclxuICAgICAgLy8gc2VuZCB2YWx1ZXMgdG8gdGhlIGRldmljZSB3aXRoIHNlcmlhbCBjb25uZWN0aW9uXHJcbiAgICAgIGNvbnN0IHNlbmRWYWx1ZXNCdXR0b24gPSBuZXcgUXVhZHJpbGF0ZXJhbFNlcmlhbENvbm5lY3Rpb25CdXR0b24oIHRhbmdpYmxlQ29ubmVjdGlvbk1vZGVsICk7XHJcbiAgICAgIGNoaWxkcmVuLnB1c2goIHNlbmRWYWx1ZXNCdXR0b24gKTtcclxuICAgIH1cclxuXHJcbiAgICBzdXBlcigge1xyXG4gICAgICBhbGlnbjogJ2xlZnQnLFxyXG4gICAgICBzcGFjaW5nOiBRdWFkcmlsYXRlcmFsQ29uc3RhbnRzLkNPTlRST0xTX1NQQUNJTkcsXHJcbiAgICAgIGNoaWxkcmVuOiBjaGlsZHJlblxyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxucXVhZHJpbGF0ZXJhbC5yZWdpc3RlciggJ1F1YWRyaWxhdGVyYWxUYW5naWJsZUNvbnRyb2xzJywgUXVhZHJpbGF0ZXJhbFRhbmdpYmxlQ29udHJvbHMgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBU0EsSUFBSSxFQUFFQyxJQUFJLFFBQVEsc0NBQXNDO0FBQ2pFLE9BQU9DLGFBQWEsTUFBTSwyQkFBMkI7QUFDckQsT0FBT0Msc0JBQXNCLE1BQU0sb0NBQW9DO0FBRXZFLE9BQU9DLG1DQUFtQyxNQUFNLDBDQUEwQztBQUMxRixPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBQ3BELE9BQU9DLGNBQWMsTUFBTSxpREFBaUQ7QUFDNUUsT0FBT0MsbUJBQW1CLE1BQU0saUNBQWlDO0FBQ2pFLE9BQU9DLDRCQUE0QixNQUFNLHVDQUF1QztBQUNoRixPQUFPQyxzQ0FBc0MsTUFBTSw2Q0FBNkM7QUFDaEcsT0FBT0MsbUNBQW1DLE1BQU0sMENBQTBDO0FBSTFGLGVBQWUsTUFBTUMsNkJBQTZCLFNBQVNWLElBQUksQ0FBQztFQUN2RFcsV0FBV0EsQ0FBRUMsdUJBQWdELEVBQUVDLGtCQUFtRCxFQUFFQyxNQUFjLEVBQUc7SUFFMUk7SUFDQSxNQUFNQyxpQkFBaUIsR0FBRyxJQUFJWCxNQUFNLENBQUUsSUFBSUQsbUNBQW1DLENBQUVTLHVCQUF3QixDQUFDLEVBQUU7TUFDeEdJLEtBQUssRUFBRSxJQUFJakIsSUFBSSxDQUFFLDZCQUE2QixFQUFFRyxzQkFBc0IsQ0FBQ2Usd0JBQXlCO0lBQ2xHLENBQUUsQ0FBQztJQUVIRixpQkFBaUIsQ0FBQ0csaUJBQWlCLENBQUNDLElBQUksQ0FBRSxDQUFFQyxTQUFTLEVBQUVDLFVBQVUsS0FBTTtNQUNyRVQsdUJBQXVCLENBQUNVLHFCQUFxQixDQUFDQyxLQUFLLEdBQUdILFNBQVM7O01BRS9EO01BQ0EsSUFBSyxDQUFDQSxTQUFTLElBQUlDLFVBQVUsS0FBSyxJQUFJLEVBQUc7UUFFdkM7UUFDQSxNQUFNRyxtQkFBbUIsR0FBR1osdUJBQXVCLENBQUNhLDJCQUEyQixDQUFDRixLQUFLO1FBQ3JGLElBQUtDLG1CQUFtQixJQUFJQSxtQkFBbUIsQ0FBQ0UsT0FBTyxDQUFDLENBQUMsRUFBRztVQUUxRDtVQUNBYixrQkFBa0IsQ0FBQ2MsaUJBQWlCLENBQUMsQ0FBQztRQUN4QztNQUNGO0lBQ0YsQ0FBRSxDQUFDOztJQUVIO0lBQ0EsTUFBTUMsUUFBUSxHQUFHLEVBQUU7O0lBRW5CO0lBQ0EsTUFBTUMsaUJBQWlCLEdBQUcsSUFBSXhCLGNBQWMsQ0FBRSxrQkFBa0IsRUFBRTtNQUNoRXlCLFFBQVEsRUFBRUEsQ0FBQSxLQUFNO1FBQ2RmLGlCQUFpQixDQUFDZ0IsSUFBSSxDQUFDLENBQUM7TUFDMUIsQ0FBQztNQUVEQyxlQUFlLEVBQUU5QixzQkFBc0IsQ0FBQytCLG1CQUFtQjtNQUMzREMsU0FBUyxFQUFFNUIsbUJBQW1CLENBQUM2QjtJQUNqQyxDQUFFLENBQUM7SUFDSFAsUUFBUSxDQUFDUSxJQUFJLENBQUVQLGlCQUFrQixDQUFDO0lBRWxDLElBQUt0Qiw0QkFBNEIsQ0FBQzhCLFNBQVMsRUFBRztNQUU1QztNQUNBLE1BQU1DLGVBQWUsR0FBRyxJQUFJOUIsc0NBQXNDLENBQUVJLHVCQUF1QixFQUFFQyxrQkFBbUIsQ0FBQztNQUNqSGUsUUFBUSxDQUFDUSxJQUFJLENBQUVFLGVBQWdCLENBQUM7SUFDbEM7SUFFQSxJQUFLL0IsNEJBQTRCLENBQUNnQyxNQUFNLEVBQUc7TUFFekM7TUFDQSxNQUFNQyxnQkFBZ0IsR0FBRyxJQUFJL0IsbUNBQW1DLENBQUVHLHVCQUF3QixDQUFDO01BQzNGZ0IsUUFBUSxDQUFDUSxJQUFJLENBQUVJLGdCQUFpQixDQUFDO0lBQ25DO0lBRUEsS0FBSyxDQUFFO01BQ0xDLEtBQUssRUFBRSxNQUFNO01BQ2JDLE9BQU8sRUFBRXhDLHNCQUFzQixDQUFDeUMsZ0JBQWdCO01BQ2hEZixRQUFRLEVBQUVBO0lBQ1osQ0FBRSxDQUFDO0VBQ0w7QUFDRjtBQUVBM0IsYUFBYSxDQUFDMkMsUUFBUSxDQUFFLCtCQUErQixFQUFFbEMsNkJBQThCLENBQUMifQ==