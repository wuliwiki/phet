// Copyright 2022-2023, University of Colorado Boulder

/**
 * A display for the current quadrilateral shape name. The name can be conditionally displayed, depending on
 * shapeNameVisibleProperty.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import { Node, Rectangle, VoicingText } from '../../../../scenery/js/imports.js';
import ExpandCollapseButton from '../../../../sun/js/ExpandCollapseButton.js';
import quadrilateral from '../../quadrilateral.js';
import NamedQuadrilateral from '../model/NamedQuadrilateral.js';
import QuadrilateralConstants from '../../QuadrilateralConstants.js';
import Multilink from '../../../../axon/js/Multilink.js';
import QuadrilateralStrings from '../../QuadrilateralStrings.js';
import QuadrilateralColors from '../../QuadrilateralColors.js';
import { combineOptions } from '../../../../phet-core/js/optionize.js';

// constants
const squareStringProperty = QuadrilateralStrings.shapeNames.squareStringProperty;
const rectangleStringProperty = QuadrilateralStrings.shapeNames.rectangleStringProperty;
const rhombusStringProperty = QuadrilateralStrings.shapeNames.rhombusStringProperty;
const kiteStringProperty = QuadrilateralStrings.shapeNames.kiteStringProperty;
const isoscelesTrapezoidStringProperty = QuadrilateralStrings.shapeNames.isoscelesTrapezoidStringProperty;
const trapezoidStringProperty = QuadrilateralStrings.shapeNames.trapezoidStringProperty;
const concaveQuadrilateralStringProperty = QuadrilateralStrings.shapeNames.concaveQuadrilateralStringProperty;
const convexQuadrilateralStringProperty = QuadrilateralStrings.shapeNames.convexQuadrilateralStringProperty;
const parallelogramStringProperty = QuadrilateralStrings.shapeNames.parallelogramStringProperty;
const dartStringProperty = QuadrilateralStrings.shapeNames.dartStringProperty;
const triangleStringProperty = QuadrilateralStrings.shapeNames.triangleStringProperty;
const shapeNameHiddenStringProperty = QuadrilateralStrings.shapeNameHiddenStringProperty;
const shapeNameHiddenContextResponseStringProperty = QuadrilateralStrings.a11y.voicing.shapeNameHiddenContextResponseStringProperty;
const shapeNameShownContextResponseStringProperty = QuadrilateralStrings.a11y.voicing.shapeNameShownContextResponseStringProperty;
const SHAPE_NAME_MAP = new Map([[NamedQuadrilateral.SQUARE, squareStringProperty], [NamedQuadrilateral.RECTANGLE, rectangleStringProperty], [NamedQuadrilateral.RHOMBUS, rhombusStringProperty], [NamedQuadrilateral.KITE, kiteStringProperty], [NamedQuadrilateral.ISOSCELES_TRAPEZOID, isoscelesTrapezoidStringProperty], [NamedQuadrilateral.TRAPEZOID, trapezoidStringProperty], [NamedQuadrilateral.CONCAVE_QUADRILATERAL, concaveQuadrilateralStringProperty], [NamedQuadrilateral.CONVEX_QUADRILATERAL, convexQuadrilateralStringProperty], [NamedQuadrilateral.PARALLELOGRAM, parallelogramStringProperty], [NamedQuadrilateral.DART, dartStringProperty], [NamedQuadrilateral.TRIANGLE, triangleStringProperty]]);

// empirically determined
const DISPLAY_WIDTH = 350;
const DISPLAY_HEIGHT = 40;
export default class QuadrilateralShapeNameDisplay extends Node {
  constructor(shapeNameVisibleProperty, shapeNameProperty, quadrilateralDescriber, tandem) {
    super();

    // display contents
    const expandCollapseButton = new ExpandCollapseButton(shapeNameVisibleProperty, {
      sideLength: 20,
      // phet-io
      tandem: tandem.createTandem('expandCollapseButton')
    });
    const shapeNameText = new VoicingText('', combineOptions({
      // Remove this component from the traversal order even though it uses Voicing. For alt input + voicing,
      // the expandCollapseButton as an interactive component is sufficient, see
      // https://github.com/phetsims/quadrilateral/issues/238#issuecomment-1276306315 for this request
      readingBlockTagName: null
    }, QuadrilateralConstants.SHAPE_NAME_TEXT_OPTIONS));
    const backgroundRectangle = new Rectangle(0, 0, DISPLAY_WIDTH, DISPLAY_HEIGHT, QuadrilateralConstants.CORNER_RADIUS, QuadrilateralConstants.CORNER_RADIUS, {
      fill: QuadrilateralColors.panelFillColorProperty,
      stroke: QuadrilateralColors.panelStrokeColorProperty
    });
    this.children = [backgroundRectangle, expandCollapseButton, shapeNameText];
    let wasVisible = shapeNameVisibleProperty.value;

    // Update display text and contents to be spoken from Voicing interactions. See
    // https://github.com/phetsims/quadrilateral/issues/238 for the design of the Voicing responses. Linked
    // to the actual string Properties to support dynamic locales.
    Multilink.multilinkAny([shapeNameVisibleProperty, shapeNameProperty, ...SHAPE_NAME_MAP.values(), shapeNameHiddenStringProperty], () => {
      let textStringProperty;
      if (shapeNameVisibleProperty.value) {
        const shapeName = shapeNameProperty.value;
        assert && assert(SHAPE_NAME_MAP.has(shapeName), 'Shape is not named in SHAPE_NAME_MAP');
        textStringProperty = SHAPE_NAME_MAP.get(shapeName);

        // Text is bold when shape name is visible
        shapeNameText.fontWeight = 'bold';

        // voicing - when shape name is shown we should include the detected shape in the name response
        expandCollapseButton.voicingNameResponse = quadrilateralDescriber.getYouHaveAShapeDescription();
        expandCollapseButton.voicingContextResponse = shapeNameShownContextResponseStringProperty;
        shapeNameText.readingBlockNameResponse = textStringProperty;
      } else {
        textStringProperty = shapeNameHiddenStringProperty;
        shapeNameText.fontWeight = 'normal';

        // voicing
        expandCollapseButton.voicingNameResponse = shapeNameHiddenStringProperty;
        expandCollapseButton.voicingContextResponse = shapeNameHiddenContextResponseStringProperty;
        shapeNameText.readingBlockNameResponse = textStringProperty;
      }

      // Only after updating voicing response content, speak the response. We only announce this when visibility
      // changes, not when shapeNameProperty changes. Done in this multilink instead of its own link so that
      // the output is independent of listener order.
      if (wasVisible !== shapeNameVisibleProperty.value) {
        expandCollapseButton.voicingSpeakFullResponse();
        wasVisible = shapeNameVisibleProperty.value;
      }
      shapeNameText.string = textStringProperty.value;
      shapeNameText.center = backgroundRectangle.center;
    });

    // layout
    shapeNameText.center = backgroundRectangle.center;
    expandCollapseButton.leftCenter = backgroundRectangle.leftCenter.plusXY(expandCollapseButton.width / 2, 0);
  }
}
quadrilateral.register('QuadrilateralShapeNameDisplay', QuadrilateralShapeNameDisplay);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOb2RlIiwiUmVjdGFuZ2xlIiwiVm9pY2luZ1RleHQiLCJFeHBhbmRDb2xsYXBzZUJ1dHRvbiIsInF1YWRyaWxhdGVyYWwiLCJOYW1lZFF1YWRyaWxhdGVyYWwiLCJRdWFkcmlsYXRlcmFsQ29uc3RhbnRzIiwiTXVsdGlsaW5rIiwiUXVhZHJpbGF0ZXJhbFN0cmluZ3MiLCJRdWFkcmlsYXRlcmFsQ29sb3JzIiwiY29tYmluZU9wdGlvbnMiLCJzcXVhcmVTdHJpbmdQcm9wZXJ0eSIsInNoYXBlTmFtZXMiLCJyZWN0YW5nbGVTdHJpbmdQcm9wZXJ0eSIsInJob21idXNTdHJpbmdQcm9wZXJ0eSIsImtpdGVTdHJpbmdQcm9wZXJ0eSIsImlzb3NjZWxlc1RyYXBlem9pZFN0cmluZ1Byb3BlcnR5IiwidHJhcGV6b2lkU3RyaW5nUHJvcGVydHkiLCJjb25jYXZlUXVhZHJpbGF0ZXJhbFN0cmluZ1Byb3BlcnR5IiwiY29udmV4UXVhZHJpbGF0ZXJhbFN0cmluZ1Byb3BlcnR5IiwicGFyYWxsZWxvZ3JhbVN0cmluZ1Byb3BlcnR5IiwiZGFydFN0cmluZ1Byb3BlcnR5IiwidHJpYW5nbGVTdHJpbmdQcm9wZXJ0eSIsInNoYXBlTmFtZUhpZGRlblN0cmluZ1Byb3BlcnR5Iiwic2hhcGVOYW1lSGlkZGVuQ29udGV4dFJlc3BvbnNlU3RyaW5nUHJvcGVydHkiLCJhMTF5Iiwidm9pY2luZyIsInNoYXBlTmFtZVNob3duQ29udGV4dFJlc3BvbnNlU3RyaW5nUHJvcGVydHkiLCJTSEFQRV9OQU1FX01BUCIsIk1hcCIsIlNRVUFSRSIsIlJFQ1RBTkdMRSIsIlJIT01CVVMiLCJLSVRFIiwiSVNPU0NFTEVTX1RSQVBFWk9JRCIsIlRSQVBFWk9JRCIsIkNPTkNBVkVfUVVBRFJJTEFURVJBTCIsIkNPTlZFWF9RVUFEUklMQVRFUkFMIiwiUEFSQUxMRUxPR1JBTSIsIkRBUlQiLCJUUklBTkdMRSIsIkRJU1BMQVlfV0lEVEgiLCJESVNQTEFZX0hFSUdIVCIsIlF1YWRyaWxhdGVyYWxTaGFwZU5hbWVEaXNwbGF5IiwiY29uc3RydWN0b3IiLCJzaGFwZU5hbWVWaXNpYmxlUHJvcGVydHkiLCJzaGFwZU5hbWVQcm9wZXJ0eSIsInF1YWRyaWxhdGVyYWxEZXNjcmliZXIiLCJ0YW5kZW0iLCJleHBhbmRDb2xsYXBzZUJ1dHRvbiIsInNpZGVMZW5ndGgiLCJjcmVhdGVUYW5kZW0iLCJzaGFwZU5hbWVUZXh0IiwicmVhZGluZ0Jsb2NrVGFnTmFtZSIsIlNIQVBFX05BTUVfVEVYVF9PUFRJT05TIiwiYmFja2dyb3VuZFJlY3RhbmdsZSIsIkNPUk5FUl9SQURJVVMiLCJmaWxsIiwicGFuZWxGaWxsQ29sb3JQcm9wZXJ0eSIsInN0cm9rZSIsInBhbmVsU3Ryb2tlQ29sb3JQcm9wZXJ0eSIsImNoaWxkcmVuIiwid2FzVmlzaWJsZSIsInZhbHVlIiwibXVsdGlsaW5rQW55IiwidmFsdWVzIiwidGV4dFN0cmluZ1Byb3BlcnR5Iiwic2hhcGVOYW1lIiwiYXNzZXJ0IiwiaGFzIiwiZ2V0IiwiZm9udFdlaWdodCIsInZvaWNpbmdOYW1lUmVzcG9uc2UiLCJnZXRZb3VIYXZlQVNoYXBlRGVzY3JpcHRpb24iLCJ2b2ljaW5nQ29udGV4dFJlc3BvbnNlIiwicmVhZGluZ0Jsb2NrTmFtZVJlc3BvbnNlIiwidm9pY2luZ1NwZWFrRnVsbFJlc3BvbnNlIiwic3RyaW5nIiwiY2VudGVyIiwibGVmdENlbnRlciIsInBsdXNYWSIsIndpZHRoIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJRdWFkcmlsYXRlcmFsU2hhcGVOYW1lRGlzcGxheS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMi0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBIGRpc3BsYXkgZm9yIHRoZSBjdXJyZW50IHF1YWRyaWxhdGVyYWwgc2hhcGUgbmFtZS4gVGhlIG5hbWUgY2FuIGJlIGNvbmRpdGlvbmFsbHkgZGlzcGxheWVkLCBkZXBlbmRpbmcgb25cclxuICogc2hhcGVOYW1lVmlzaWJsZVByb3BlcnR5LlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgTm9kZSwgUmVjdGFuZ2xlLCBWb2ljaW5nVGV4dCwgVm9pY2luZ1RleHRPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEV4cGFuZENvbGxhcHNlQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9FeHBhbmRDb2xsYXBzZUJ1dHRvbi5qcyc7XHJcbmltcG9ydCBxdWFkcmlsYXRlcmFsIGZyb20gJy4uLy4uL3F1YWRyaWxhdGVyYWwuanMnO1xyXG5pbXBvcnQgTmFtZWRRdWFkcmlsYXRlcmFsIGZyb20gJy4uL21vZGVsL05hbWVkUXVhZHJpbGF0ZXJhbC5qcyc7XHJcbmltcG9ydCBRdWFkcmlsYXRlcmFsQ29uc3RhbnRzIGZyb20gJy4uLy4uL1F1YWRyaWxhdGVyYWxDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IFF1YWRyaWxhdGVyYWxTdHJpbmdzIGZyb20gJy4uLy4uL1F1YWRyaWxhdGVyYWxTdHJpbmdzLmpzJztcclxuaW1wb3J0IFF1YWRyaWxhdGVyYWxDb2xvcnMgZnJvbSAnLi4vLi4vUXVhZHJpbGF0ZXJhbENvbG9ycy5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBRdWFkcmlsYXRlcmFsRGVzY3JpYmVyIGZyb20gJy4vUXVhZHJpbGF0ZXJhbERlc2NyaWJlci5qcyc7XHJcbmltcG9ydCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3Qgc3F1YXJlU3RyaW5nUHJvcGVydHkgPSBRdWFkcmlsYXRlcmFsU3RyaW5ncy5zaGFwZU5hbWVzLnNxdWFyZVN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCByZWN0YW5nbGVTdHJpbmdQcm9wZXJ0eSA9IFF1YWRyaWxhdGVyYWxTdHJpbmdzLnNoYXBlTmFtZXMucmVjdGFuZ2xlU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHJob21idXNTdHJpbmdQcm9wZXJ0eSA9IFF1YWRyaWxhdGVyYWxTdHJpbmdzLnNoYXBlTmFtZXMucmhvbWJ1c1N0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBraXRlU3RyaW5nUHJvcGVydHkgPSBRdWFkcmlsYXRlcmFsU3RyaW5ncy5zaGFwZU5hbWVzLmtpdGVTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgaXNvc2NlbGVzVHJhcGV6b2lkU3RyaW5nUHJvcGVydHkgPSBRdWFkcmlsYXRlcmFsU3RyaW5ncy5zaGFwZU5hbWVzLmlzb3NjZWxlc1RyYXBlem9pZFN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCB0cmFwZXpvaWRTdHJpbmdQcm9wZXJ0eSA9IFF1YWRyaWxhdGVyYWxTdHJpbmdzLnNoYXBlTmFtZXMudHJhcGV6b2lkU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGNvbmNhdmVRdWFkcmlsYXRlcmFsU3RyaW5nUHJvcGVydHkgPSBRdWFkcmlsYXRlcmFsU3RyaW5ncy5zaGFwZU5hbWVzLmNvbmNhdmVRdWFkcmlsYXRlcmFsU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGNvbnZleFF1YWRyaWxhdGVyYWxTdHJpbmdQcm9wZXJ0eSA9IFF1YWRyaWxhdGVyYWxTdHJpbmdzLnNoYXBlTmFtZXMuY29udmV4UXVhZHJpbGF0ZXJhbFN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBwYXJhbGxlbG9ncmFtU3RyaW5nUHJvcGVydHkgPSBRdWFkcmlsYXRlcmFsU3RyaW5ncy5zaGFwZU5hbWVzLnBhcmFsbGVsb2dyYW1TdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgZGFydFN0cmluZ1Byb3BlcnR5ID0gUXVhZHJpbGF0ZXJhbFN0cmluZ3Muc2hhcGVOYW1lcy5kYXJ0U3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHRyaWFuZ2xlU3RyaW5nUHJvcGVydHkgPSBRdWFkcmlsYXRlcmFsU3RyaW5ncy5zaGFwZU5hbWVzLnRyaWFuZ2xlU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHNoYXBlTmFtZUhpZGRlblN0cmluZ1Byb3BlcnR5ID0gUXVhZHJpbGF0ZXJhbFN0cmluZ3Muc2hhcGVOYW1lSGlkZGVuU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHNoYXBlTmFtZUhpZGRlbkNvbnRleHRSZXNwb25zZVN0cmluZ1Byb3BlcnR5ID0gUXVhZHJpbGF0ZXJhbFN0cmluZ3MuYTExeS52b2ljaW5nLnNoYXBlTmFtZUhpZGRlbkNvbnRleHRSZXNwb25zZVN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBzaGFwZU5hbWVTaG93bkNvbnRleHRSZXNwb25zZVN0cmluZ1Byb3BlcnR5ID0gUXVhZHJpbGF0ZXJhbFN0cmluZ3MuYTExeS52b2ljaW5nLnNoYXBlTmFtZVNob3duQ29udGV4dFJlc3BvbnNlU3RyaW5nUHJvcGVydHk7XHJcblxyXG5jb25zdCBTSEFQRV9OQU1FX01BUCA9IG5ldyBNYXAoIFtcclxuICBbIE5hbWVkUXVhZHJpbGF0ZXJhbC5TUVVBUkUsIHNxdWFyZVN0cmluZ1Byb3BlcnR5IF0sXHJcbiAgWyBOYW1lZFF1YWRyaWxhdGVyYWwuUkVDVEFOR0xFLCByZWN0YW5nbGVTdHJpbmdQcm9wZXJ0eSBdLFxyXG4gIFsgTmFtZWRRdWFkcmlsYXRlcmFsLlJIT01CVVMsIHJob21idXNTdHJpbmdQcm9wZXJ0eSBdLFxyXG4gIFsgTmFtZWRRdWFkcmlsYXRlcmFsLktJVEUsIGtpdGVTdHJpbmdQcm9wZXJ0eSBdLFxyXG4gIFsgTmFtZWRRdWFkcmlsYXRlcmFsLklTT1NDRUxFU19UUkFQRVpPSUQsIGlzb3NjZWxlc1RyYXBlem9pZFN0cmluZ1Byb3BlcnR5IF0sXHJcbiAgWyBOYW1lZFF1YWRyaWxhdGVyYWwuVFJBUEVaT0lELCB0cmFwZXpvaWRTdHJpbmdQcm9wZXJ0eSBdLFxyXG4gIFsgTmFtZWRRdWFkcmlsYXRlcmFsLkNPTkNBVkVfUVVBRFJJTEFURVJBTCwgY29uY2F2ZVF1YWRyaWxhdGVyYWxTdHJpbmdQcm9wZXJ0eSBdLFxyXG4gIFsgTmFtZWRRdWFkcmlsYXRlcmFsLkNPTlZFWF9RVUFEUklMQVRFUkFMLCBjb252ZXhRdWFkcmlsYXRlcmFsU3RyaW5nUHJvcGVydHkgXSxcclxuICBbIE5hbWVkUXVhZHJpbGF0ZXJhbC5QQVJBTExFTE9HUkFNLCBwYXJhbGxlbG9ncmFtU3RyaW5nUHJvcGVydHkgXSxcclxuICBbIE5hbWVkUXVhZHJpbGF0ZXJhbC5EQVJULCBkYXJ0U3RyaW5nUHJvcGVydHkgXSxcclxuICBbIE5hbWVkUXVhZHJpbGF0ZXJhbC5UUklBTkdMRSwgdHJpYW5nbGVTdHJpbmdQcm9wZXJ0eSBdXHJcbl0gKTtcclxuXHJcbi8vIGVtcGlyaWNhbGx5IGRldGVybWluZWRcclxuY29uc3QgRElTUExBWV9XSURUSCA9IDM1MDtcclxuY29uc3QgRElTUExBWV9IRUlHSFQgPSA0MDtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFF1YWRyaWxhdGVyYWxTaGFwZU5hbWVEaXNwbGF5IGV4dGVuZHMgTm9kZSB7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBzaGFwZU5hbWVWaXNpYmxlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+LCBzaGFwZU5hbWVQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8TmFtZWRRdWFkcmlsYXRlcmFsPiwgcXVhZHJpbGF0ZXJhbERlc2NyaWJlcjogUXVhZHJpbGF0ZXJhbERlc2NyaWJlciwgdGFuZGVtOiBUYW5kZW0gKSB7XHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIC8vIGRpc3BsYXkgY29udGVudHNcclxuICAgIGNvbnN0IGV4cGFuZENvbGxhcHNlQnV0dG9uID0gbmV3IEV4cGFuZENvbGxhcHNlQnV0dG9uKCBzaGFwZU5hbWVWaXNpYmxlUHJvcGVydHksIHtcclxuICAgICAgc2lkZUxlbmd0aDogMjAsXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2V4cGFuZENvbGxhcHNlQnV0dG9uJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3Qgc2hhcGVOYW1lVGV4dCA9IG5ldyBWb2ljaW5nVGV4dCggJycsIGNvbWJpbmVPcHRpb25zPFZvaWNpbmdUZXh0T3B0aW9ucz4oIHtcclxuXHJcbiAgICAgIC8vIFJlbW92ZSB0aGlzIGNvbXBvbmVudCBmcm9tIHRoZSB0cmF2ZXJzYWwgb3JkZXIgZXZlbiB0aG91Z2ggaXQgdXNlcyBWb2ljaW5nLiBGb3IgYWx0IGlucHV0ICsgdm9pY2luZyxcclxuICAgICAgLy8gdGhlIGV4cGFuZENvbGxhcHNlQnV0dG9uIGFzIGFuIGludGVyYWN0aXZlIGNvbXBvbmVudCBpcyBzdWZmaWNpZW50LCBzZWVcclxuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3F1YWRyaWxhdGVyYWwvaXNzdWVzLzIzOCNpc3N1ZWNvbW1lbnQtMTI3NjMwNjMxNSBmb3IgdGhpcyByZXF1ZXN0XHJcbiAgICAgIHJlYWRpbmdCbG9ja1RhZ05hbWU6IG51bGxcclxuICAgIH0sIFF1YWRyaWxhdGVyYWxDb25zdGFudHMuU0hBUEVfTkFNRV9URVhUX09QVElPTlMgKSApO1xyXG5cclxuICAgIGNvbnN0IGJhY2tncm91bmRSZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBESVNQTEFZX1dJRFRILCBESVNQTEFZX0hFSUdIVCwgUXVhZHJpbGF0ZXJhbENvbnN0YW50cy5DT1JORVJfUkFESVVTLCBRdWFkcmlsYXRlcmFsQ29uc3RhbnRzLkNPUk5FUl9SQURJVVMsIHtcclxuICAgICAgZmlsbDogUXVhZHJpbGF0ZXJhbENvbG9ycy5wYW5lbEZpbGxDb2xvclByb3BlcnR5LFxyXG4gICAgICBzdHJva2U6IFF1YWRyaWxhdGVyYWxDb2xvcnMucGFuZWxTdHJva2VDb2xvclByb3BlcnR5XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmNoaWxkcmVuID0gWyBiYWNrZ3JvdW5kUmVjdGFuZ2xlLCBleHBhbmRDb2xsYXBzZUJ1dHRvbiwgc2hhcGVOYW1lVGV4dCBdO1xyXG5cclxuICAgIGxldCB3YXNWaXNpYmxlID0gc2hhcGVOYW1lVmlzaWJsZVByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgIC8vIFVwZGF0ZSBkaXNwbGF5IHRleHQgYW5kIGNvbnRlbnRzIHRvIGJlIHNwb2tlbiBmcm9tIFZvaWNpbmcgaW50ZXJhY3Rpb25zLiBTZWVcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9xdWFkcmlsYXRlcmFsL2lzc3Vlcy8yMzggZm9yIHRoZSBkZXNpZ24gb2YgdGhlIFZvaWNpbmcgcmVzcG9uc2VzLiBMaW5rZWRcclxuICAgIC8vIHRvIHRoZSBhY3R1YWwgc3RyaW5nIFByb3BlcnRpZXMgdG8gc3VwcG9ydCBkeW5hbWljIGxvY2FsZXMuXHJcbiAgICBNdWx0aWxpbmsubXVsdGlsaW5rQW55KCBbIHNoYXBlTmFtZVZpc2libGVQcm9wZXJ0eSwgc2hhcGVOYW1lUHJvcGVydHksIC4uLlNIQVBFX05BTUVfTUFQLnZhbHVlcygpLCBzaGFwZU5hbWVIaWRkZW5TdHJpbmdQcm9wZXJ0eSBdLCAoKSA9PiB7XHJcbiAgICAgIGxldCB0ZXh0U3RyaW5nUHJvcGVydHk7XHJcblxyXG4gICAgICBpZiAoIHNoYXBlTmFtZVZpc2libGVQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICBjb25zdCBzaGFwZU5hbWUgPSBzaGFwZU5hbWVQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBTSEFQRV9OQU1FX01BUC5oYXMoIHNoYXBlTmFtZSApLCAnU2hhcGUgaXMgbm90IG5hbWVkIGluIFNIQVBFX05BTUVfTUFQJyApO1xyXG4gICAgICAgIHRleHRTdHJpbmdQcm9wZXJ0eSA9IFNIQVBFX05BTUVfTUFQLmdldCggc2hhcGVOYW1lICkhO1xyXG5cclxuICAgICAgICAvLyBUZXh0IGlzIGJvbGQgd2hlbiBzaGFwZSBuYW1lIGlzIHZpc2libGVcclxuICAgICAgICBzaGFwZU5hbWVUZXh0LmZvbnRXZWlnaHQgPSAnYm9sZCc7XHJcblxyXG4gICAgICAgIC8vIHZvaWNpbmcgLSB3aGVuIHNoYXBlIG5hbWUgaXMgc2hvd24gd2Ugc2hvdWxkIGluY2x1ZGUgdGhlIGRldGVjdGVkIHNoYXBlIGluIHRoZSBuYW1lIHJlc3BvbnNlXHJcbiAgICAgICAgZXhwYW5kQ29sbGFwc2VCdXR0b24udm9pY2luZ05hbWVSZXNwb25zZSA9IHF1YWRyaWxhdGVyYWxEZXNjcmliZXIuZ2V0WW91SGF2ZUFTaGFwZURlc2NyaXB0aW9uKCk7XHJcbiAgICAgICAgZXhwYW5kQ29sbGFwc2VCdXR0b24udm9pY2luZ0NvbnRleHRSZXNwb25zZSA9IHNoYXBlTmFtZVNob3duQ29udGV4dFJlc3BvbnNlU3RyaW5nUHJvcGVydHk7XHJcbiAgICAgICAgc2hhcGVOYW1lVGV4dC5yZWFkaW5nQmxvY2tOYW1lUmVzcG9uc2UgPSB0ZXh0U3RyaW5nUHJvcGVydHk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdGV4dFN0cmluZ1Byb3BlcnR5ID0gc2hhcGVOYW1lSGlkZGVuU3RyaW5nUHJvcGVydHk7XHJcbiAgICAgICAgc2hhcGVOYW1lVGV4dC5mb250V2VpZ2h0ID0gJ25vcm1hbCc7XHJcblxyXG4gICAgICAgIC8vIHZvaWNpbmdcclxuICAgICAgICBleHBhbmRDb2xsYXBzZUJ1dHRvbi52b2ljaW5nTmFtZVJlc3BvbnNlID0gc2hhcGVOYW1lSGlkZGVuU3RyaW5nUHJvcGVydHk7XHJcbiAgICAgICAgZXhwYW5kQ29sbGFwc2VCdXR0b24udm9pY2luZ0NvbnRleHRSZXNwb25zZSA9IHNoYXBlTmFtZUhpZGRlbkNvbnRleHRSZXNwb25zZVN0cmluZ1Byb3BlcnR5O1xyXG4gICAgICAgIHNoYXBlTmFtZVRleHQucmVhZGluZ0Jsb2NrTmFtZVJlc3BvbnNlID0gdGV4dFN0cmluZ1Byb3BlcnR5O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBPbmx5IGFmdGVyIHVwZGF0aW5nIHZvaWNpbmcgcmVzcG9uc2UgY29udGVudCwgc3BlYWsgdGhlIHJlc3BvbnNlLiBXZSBvbmx5IGFubm91bmNlIHRoaXMgd2hlbiB2aXNpYmlsaXR5XHJcbiAgICAgIC8vIGNoYW5nZXMsIG5vdCB3aGVuIHNoYXBlTmFtZVByb3BlcnR5IGNoYW5nZXMuIERvbmUgaW4gdGhpcyBtdWx0aWxpbmsgaW5zdGVhZCBvZiBpdHMgb3duIGxpbmsgc28gdGhhdFxyXG4gICAgICAvLyB0aGUgb3V0cHV0IGlzIGluZGVwZW5kZW50IG9mIGxpc3RlbmVyIG9yZGVyLlxyXG4gICAgICBpZiAoIHdhc1Zpc2libGUgIT09IHNoYXBlTmFtZVZpc2libGVQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICBleHBhbmRDb2xsYXBzZUJ1dHRvbi52b2ljaW5nU3BlYWtGdWxsUmVzcG9uc2UoKTtcclxuICAgICAgICB3YXNWaXNpYmxlID0gc2hhcGVOYW1lVmlzaWJsZVByb3BlcnR5LnZhbHVlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBzaGFwZU5hbWVUZXh0LnN0cmluZyA9IHRleHRTdHJpbmdQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgc2hhcGVOYW1lVGV4dC5jZW50ZXIgPSBiYWNrZ3JvdW5kUmVjdGFuZ2xlLmNlbnRlcjtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBsYXlvdXRcclxuICAgIHNoYXBlTmFtZVRleHQuY2VudGVyID0gYmFja2dyb3VuZFJlY3RhbmdsZS5jZW50ZXI7XHJcbiAgICBleHBhbmRDb2xsYXBzZUJ1dHRvbi5sZWZ0Q2VudGVyID0gYmFja2dyb3VuZFJlY3RhbmdsZS5sZWZ0Q2VudGVyLnBsdXNYWSggZXhwYW5kQ29sbGFwc2VCdXR0b24ud2lkdGggLyAyLCAwICk7XHJcbiAgfVxyXG59XHJcblxyXG5xdWFkcmlsYXRlcmFsLnJlZ2lzdGVyKCAnUXVhZHJpbGF0ZXJhbFNoYXBlTmFtZURpc3BsYXknLCBRdWFkcmlsYXRlcmFsU2hhcGVOYW1lRGlzcGxheSApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFJQSxTQUFTQSxJQUFJLEVBQUVDLFNBQVMsRUFBRUMsV0FBVyxRQUE0QixtQ0FBbUM7QUFDcEcsT0FBT0Msb0JBQW9CLE1BQU0sNENBQTRDO0FBQzdFLE9BQU9DLGFBQWEsTUFBTSx3QkFBd0I7QUFDbEQsT0FBT0Msa0JBQWtCLE1BQU0sZ0NBQWdDO0FBQy9ELE9BQU9DLHNCQUFzQixNQUFNLGlDQUFpQztBQUNwRSxPQUFPQyxTQUFTLE1BQU0sa0NBQWtDO0FBQ3hELE9BQU9DLG9CQUFvQixNQUFNLCtCQUErQjtBQUNoRSxPQUFPQyxtQkFBbUIsTUFBTSw4QkFBOEI7QUFHOUQsU0FBU0MsY0FBYyxRQUFRLHVDQUF1Qzs7QUFFdEU7QUFDQSxNQUFNQyxvQkFBb0IsR0FBR0gsb0JBQW9CLENBQUNJLFVBQVUsQ0FBQ0Qsb0JBQW9CO0FBQ2pGLE1BQU1FLHVCQUF1QixHQUFHTCxvQkFBb0IsQ0FBQ0ksVUFBVSxDQUFDQyx1QkFBdUI7QUFDdkYsTUFBTUMscUJBQXFCLEdBQUdOLG9CQUFvQixDQUFDSSxVQUFVLENBQUNFLHFCQUFxQjtBQUNuRixNQUFNQyxrQkFBa0IsR0FBR1Asb0JBQW9CLENBQUNJLFVBQVUsQ0FBQ0csa0JBQWtCO0FBQzdFLE1BQU1DLGdDQUFnQyxHQUFHUixvQkFBb0IsQ0FBQ0ksVUFBVSxDQUFDSSxnQ0FBZ0M7QUFDekcsTUFBTUMsdUJBQXVCLEdBQUdULG9CQUFvQixDQUFDSSxVQUFVLENBQUNLLHVCQUF1QjtBQUN2RixNQUFNQyxrQ0FBa0MsR0FBR1Ysb0JB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