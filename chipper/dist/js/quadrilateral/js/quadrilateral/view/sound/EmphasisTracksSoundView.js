// Copyright 2022-2023, University of Colorado Boulder

/**
 * In this design, all tracks play at once. Depending on the shape name, one or more of the tracks will have a higher
 * output level to emphasise a particular geometry.
 *
 * See https://github.com/phetsims/quadrilateral/issues/175#issuecomment-1201643077 for more information about this
 * design.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import quadrilateral from '../../../quadrilateral.js';
import TracksSoundView from './TracksSoundView.js';
import quadTrackBackgroundRhythmComplex_mp3 from '../../../../sounds/quadTrackBackgroundRhythmComplex_mp3.js';
import quadTrackLowAscendingFourNotes_mp3 from '../../../../sounds/quadTrackLowAscendingFourNotes_mp3.js';
import quadTrackHighTonesAmbient_mp3 from '../../../../sounds/quadTrackHighTonesAmbient_mp3.js';
import quadTrackHighDescendingPingRepeats_mp3 from '../../../../sounds/quadTrackHighDescendingPingRepeats_mp3.js';
import quadTrackHighBellsFallAndRise_mp3 from '../../../../sounds/quadTrackHighBellsFallAndRise_mp3.js';
import quadTrackLowPunctualBoops_mp3 from '../../../../sounds/quadTrackLowPunctualBoops_mp3.js';
import quadTrackLowDistortedTonalRhythm_mp3 from '../../../../sounds/quadTrackLowDistortedTonalRhythm_mp3.js';
import quadTrackHighRepeatedMonotoneRinging_mp3 from '../../../../sounds/quadTrackHighRepeatedMonotoneRinging_mp3.js';
import quadTrackBackgroundRhythmInverted_mp3 from '../../../../sounds/quadTrackBackgroundRhythmInverted_mp3.js';
import quadTrackLowPunctualBoopsSparse_mp3 from '../../../../sounds/quadTrackLowPunctualBoopsSparse_mp3.js';
import NamedQuadrilateral from '../../model/NamedQuadrilateral.js';
// default output level for sound clips that are playing in the background behind the louder emphasized sound
const DEFAULT_BACKGROUND_OUTPUT_LEVEL = 0.15;

// All the sounds played in this sound design
const EMPHASIS_TRACKS = [quadTrackBackgroundRhythmComplex_mp3, quadTrackBackgroundRhythmInverted_mp3, quadTrackLowAscendingFourNotes_mp3, quadTrackLowDistortedTonalRhythm_mp3, quadTrackHighDescendingPingRepeats_mp3, quadTrackHighBellsFallAndRise_mp3, quadTrackLowPunctualBoops_mp3, quadTrackHighTonesAmbient_mp3, quadTrackHighRepeatedMonotoneRinging_mp3, quadTrackLowPunctualBoopsSparse_mp3];

// Each NamedQuadrilateral is assigned zero or more of the above tracks to play at a louder output level when the shape
// is in that state. Values of the map are indices of the sound files above that should play at a higher output level,
// according to the design in https://github.com/phetsims/quadrilateral/issues/175.
const NAMED_QUADRILATERAL_TO_HIGH_VOLUME_TRACKS_MAP = new Map([[NamedQuadrilateral.CONVEX_QUADRILATERAL, [0]], [NamedQuadrilateral.CONCAVE_QUADRILATERAL, [1]], [NamedQuadrilateral.TRIANGLE, []], [NamedQuadrilateral.DART, [9]], [NamedQuadrilateral.KITE, [2]], [NamedQuadrilateral.TRAPEZOID, [4]], [NamedQuadrilateral.ISOSCELES_TRAPEZOID, [3]], [NamedQuadrilateral.PARALLELOGRAM, [5]], [NamedQuadrilateral.RHOMBUS, [6]], [NamedQuadrilateral.RECTANGLE, [8]], [NamedQuadrilateral.SQUARE, [7]]]);
export default class EmphasisTracksSoundView extends TracksSoundView {
  // The requested output levels for each SoundClip as shapes are detected. All of these are playing at once at the
  // provided output level while the "high volume tracks" play louder on top of them. See
  //https://github.com/phetsims/quadrilateral/issues/175#issuecomment-1400645437 for a list of these values.
  indexToBackgroundOutputLevelMap = new Map([[0, DEFAULT_BACKGROUND_OUTPUT_LEVEL], [1, DEFAULT_BACKGROUND_OUTPUT_LEVEL], [2, DEFAULT_BACKGROUND_OUTPUT_LEVEL], [3, DEFAULT_BACKGROUND_OUTPUT_LEVEL], [4, DEFAULT_BACKGROUND_OUTPUT_LEVEL], [5, DEFAULT_BACKGROUND_OUTPUT_LEVEL], [6, DEFAULT_BACKGROUND_OUTPUT_LEVEL / 2], [7, DEFAULT_BACKGROUND_OUTPUT_LEVEL * 2], [8, DEFAULT_BACKGROUND_OUTPUT_LEVEL], [9, DEFAULT_BACKGROUND_OUTPUT_LEVEL]]);
  constructor(shapeModel, shapeSoundEnabledProperty, resetNotInProgressProperty, soundOptionsModel) {
    super(shapeModel, shapeSoundEnabledProperty, resetNotInProgressProperty, soundOptionsModel, EMPHASIS_TRACKS);

    // desired output levels for each sound (as requested by design after manually editing the gain)
    // See https://github.com/phetsims/quadrilateral/issues/175#issuecomment-1400645437
    this.indexToOutputLevelMap.set(0, 0.75);
    this.indexToOutputLevelMap.set(1, 0.75);
    this.indexToOutputLevelMap.set(2, 1);
    this.indexToOutputLevelMap.set(3, 1);
    this.indexToOutputLevelMap.set(4, 1);
    this.indexToOutputLevelMap.set(5, 1);
    this.indexToOutputLevelMap.set(6, 0.75);
    this.indexToOutputLevelMap.set(7, 1);
    this.indexToOutputLevelMap.set(8, 0.6);
    this.indexToOutputLevelMap.set(9, 0.75);
    const shapeNameListener = shapeName => {
      // First, reduce all the sound clips to their background output level
      this.soundClips.forEach((soundClip, index) => {
        soundClip.setOutputLevel(this.indexToBackgroundOutputLevelMap.get(index));
      });

      // play the emphasized clips at their higher volume
      const tracksToEmphasize = NAMED_QUADRILATERAL_TO_HIGH_VOLUME_TRACKS_MAP.get(shapeName);
      assert && assert(tracksToEmphasize, 'NamedQuadrilateral does not have a EmphasisTracksSoundView design');
      tracksToEmphasize.forEach(index => {
        this.soundClips[index].setOutputLevel(this.indexToOutputLevelMap.get(index));
      });
    };
    shapeModel.shapeNameProperty.link(shapeNameListener);
    this.disposeEmphasisTracksSoundView = () => {
      shapeModel.shapeNameProperty.unlink(shapeNameListener);
    };
  }
  dispose() {
    this.disposeEmphasisTracksSoundView();
    super.dispose();
  }
}
quadrilateral.register('EmphasisTracksSoundView', EmphasisTracksSoundView);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJxdWFkcmlsYXRlcmFsIiwiVHJhY2tzU291bmRWaWV3IiwicXVhZFRyYWNrQmFja2dyb3VuZFJoeXRobUNvbXBsZXhfbXAzIiwicXVhZFRyYWNrTG93QXNjZW5kaW5nRm91ck5vdGVzX21wMyIsInF1YWRUcmFja0hpZ2hUb25lc0FtYmllbnRfbXAzIiwicXVhZFRyYWNrSGlnaERlc2NlbmRpbmdQaW5nUmVwZWF0c19tcDMiLCJxdWFkVHJhY2tIaWdoQmVsbHNGYWxsQW5kUmlzZV9tcDMiLCJxdWFkVHJhY2tMb3dQdW5jdHVhbEJvb3BzX21wMyIsInF1YWRUcmFja0xvd0Rpc3RvcnRlZFRvbmFsUmh5dGhtX21wMyIsInF1YWRUcmFja0hpZ2hSZXBlYXRlZE1vbm90b25lUmluZ2luZ19tcDMiLCJxdWFkVHJhY2tCYWNrZ3JvdW5kUmh5dGhtSW52ZXJ0ZWRfbXAzIiwicXVhZFRyYWNrTG93UHVuY3R1YWxCb29wc1NwYXJzZV9tcDMiLCJOYW1lZFF1YWRyaWxhdGVyYWwiLCJERUZBVUxUX0JBQ0tHUk9VTkRfT1VUUFVUX0xFVkVMIiwiRU1QSEFTSVNfVFJBQ0tTIiwiTkFNRURfUVVBRFJJTEFURVJBTF9UT19ISUdIX1ZPTFVNRV9UUkFDS1NfTUFQIiwiTWFwIiwiQ09OVkVYX1FVQURSSUxBVEVSQUwiLCJDT05DQVZFX1FVQURSSUxBVEVSQUwiLCJUUklBTkdMRSIsIkRBUlQiLCJLSVRFIiwiVFJBUEVaT0lEIiwiSVNPU0NFTEVTX1RSQVBFWk9JRCIsIlBBUkFMTEVMT0dSQU0iLCJSSE9NQlVTIiwiUkVDVEFOR0xFIiwiU1FVQVJFIiwiRW1waGFzaXNUcmFja3NTb3VuZFZpZXciLCJpbmRleFRvQmFja2dyb3VuZE91dHB1dExldmVsTWFwIiwiY29uc3RydWN0b3IiLCJzaGFwZU1vZGVsIiwic2hhcGVTb3VuZEVuYWJsZWRQcm9wZXJ0eSIsInJlc2V0Tm90SW5Qcm9ncmVzc1Byb3BlcnR5Iiwic291bmRPcHRpb25zTW9kZWwiLCJpbmRleFRvT3V0cHV0TGV2ZWxNYXAiLCJzZXQiLCJzaGFwZU5hbWVMaXN0ZW5lciIsInNoYXBlTmFtZSIsInNvdW5kQ2xpcHMiLCJmb3JFYWNoIiwic291bmRDbGlwIiwiaW5kZXgiLCJzZXRPdXRwdXRMZXZlbCIsImdldCIsInRyYWNrc1RvRW1waGFzaXplIiwiYXNzZXJ0Iiwic2hhcGVOYW1lUHJvcGVydHkiLCJsaW5rIiwiZGlzcG9zZUVtcGhhc2lzVHJhY2tzU291bmRWaWV3IiwidW5saW5rIiwiZGlzcG9zZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRW1waGFzaXNUcmFja3NTb3VuZFZpZXcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjItMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogSW4gdGhpcyBkZXNpZ24sIGFsbCB0cmFja3MgcGxheSBhdCBvbmNlLiBEZXBlbmRpbmcgb24gdGhlIHNoYXBlIG5hbWUsIG9uZSBvciBtb3JlIG9mIHRoZSB0cmFja3Mgd2lsbCBoYXZlIGEgaGlnaGVyXHJcbiAqIG91dHB1dCBsZXZlbCB0byBlbXBoYXNpc2UgYSBwYXJ0aWN1bGFyIGdlb21ldHJ5LlxyXG4gKlxyXG4gKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3F1YWRyaWxhdGVyYWwvaXNzdWVzLzE3NSNpc3N1ZWNvbW1lbnQtMTIwMTY0MzA3NyBmb3IgbW9yZSBpbmZvcm1hdGlvbiBhYm91dCB0aGlzXHJcbiAqIGRlc2lnbi5cclxuICpcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmcgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IHF1YWRyaWxhdGVyYWwgZnJvbSAnLi4vLi4vLi4vcXVhZHJpbGF0ZXJhbC5qcyc7XHJcbmltcG9ydCBUcmFja3NTb3VuZFZpZXcgZnJvbSAnLi9UcmFja3NTb3VuZFZpZXcuanMnO1xyXG5pbXBvcnQgcXVhZFRyYWNrQmFja2dyb3VuZFJoeXRobUNvbXBsZXhfbXAzIGZyb20gJy4uLy4uLy4uLy4uL3NvdW5kcy9xdWFkVHJhY2tCYWNrZ3JvdW5kUmh5dGhtQ29tcGxleF9tcDMuanMnO1xyXG5pbXBvcnQgcXVhZFRyYWNrTG93QXNjZW5kaW5nRm91ck5vdGVzX21wMyBmcm9tICcuLi8uLi8uLi8uLi9zb3VuZHMvcXVhZFRyYWNrTG93QXNjZW5kaW5nRm91ck5vdGVzX21wMy5qcyc7XHJcbmltcG9ydCBxdWFkVHJhY2tIaWdoVG9uZXNBbWJpZW50X21wMyBmcm9tICcuLi8uLi8uLi8uLi9zb3VuZHMvcXVhZFRyYWNrSGlnaFRvbmVzQW1iaWVudF9tcDMuanMnO1xyXG5pbXBvcnQgcXVhZFRyYWNrSGlnaERlc2NlbmRpbmdQaW5nUmVwZWF0c19tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3F1YWRUcmFja0hpZ2hEZXNjZW5kaW5nUGluZ1JlcGVhdHNfbXAzLmpzJztcclxuaW1wb3J0IHF1YWRUcmFja0hpZ2hCZWxsc0ZhbGxBbmRSaXNlX21wMyBmcm9tICcuLi8uLi8uLi8uLi9zb3VuZHMvcXVhZFRyYWNrSGlnaEJlbGxzRmFsbEFuZFJpc2VfbXAzLmpzJztcclxuaW1wb3J0IHF1YWRUcmFja0xvd1B1bmN0dWFsQm9vcHNfbXAzIGZyb20gJy4uLy4uLy4uLy4uL3NvdW5kcy9xdWFkVHJhY2tMb3dQdW5jdHVhbEJvb3BzX21wMy5qcyc7XHJcbmltcG9ydCBxdWFkVHJhY2tMb3dEaXN0b3J0ZWRUb25hbFJoeXRobV9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3F1YWRUcmFja0xvd0Rpc3RvcnRlZFRvbmFsUmh5dGhtX21wMy5qcyc7XHJcbmltcG9ydCBxdWFkVHJhY2tIaWdoUmVwZWF0ZWRNb25vdG9uZVJpbmdpbmdfbXAzIGZyb20gJy4uLy4uLy4uLy4uL3NvdW5kcy9xdWFkVHJhY2tIaWdoUmVwZWF0ZWRNb25vdG9uZVJpbmdpbmdfbXAzLmpzJztcclxuaW1wb3J0IHF1YWRUcmFja0JhY2tncm91bmRSaHl0aG1JbnZlcnRlZF9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3F1YWRUcmFja0JhY2tncm91bmRSaHl0aG1JbnZlcnRlZF9tcDMuanMnO1xyXG5pbXBvcnQgcXVhZFRyYWNrTG93UHVuY3R1YWxCb29wc1NwYXJzZV9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3F1YWRUcmFja0xvd1B1bmN0dWFsQm9vcHNTcGFyc2VfbXAzLmpzJztcclxuaW1wb3J0IFF1YWRyaWxhdGVyYWxTaGFwZU1vZGVsIGZyb20gJy4uLy4uL21vZGVsL1F1YWRyaWxhdGVyYWxTaGFwZU1vZGVsLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTmFtZWRRdWFkcmlsYXRlcmFsIGZyb20gJy4uLy4uL21vZGVsL05hbWVkUXVhZHJpbGF0ZXJhbC5qcyc7XHJcbmltcG9ydCBRdWFkcmlsYXRlcmFsU291bmRPcHRpb25zTW9kZWwgZnJvbSAnLi4vLi4vbW9kZWwvUXVhZHJpbGF0ZXJhbFNvdW5kT3B0aW9uc01vZGVsLmpzJztcclxuXHJcbi8vIGRlZmF1bHQgb3V0cHV0IGxldmVsIGZvciBzb3VuZCBjbGlwcyB0aGF0IGFyZSBwbGF5aW5nIGluIHRoZSBiYWNrZ3JvdW5kIGJlaGluZCB0aGUgbG91ZGVyIGVtcGhhc2l6ZWQgc291bmRcclxuY29uc3QgREVGQVVMVF9CQUNLR1JPVU5EX09VVFBVVF9MRVZFTCA9IDAuMTU7XHJcblxyXG4vLyBBbGwgdGhlIHNvdW5kcyBwbGF5ZWQgaW4gdGhpcyBzb3VuZCBkZXNpZ25cclxuY29uc3QgRU1QSEFTSVNfVFJBQ0tTID0gW1xyXG4gIHF1YWRUcmFja0JhY2tncm91bmRSaHl0aG1Db21wbGV4X21wMyxcclxuICBxdWFkVHJhY2tCYWNrZ3JvdW5kUmh5dGhtSW52ZXJ0ZWRfbXAzLFxyXG4gIHF1YWRUcmFja0xvd0FzY2VuZGluZ0ZvdXJOb3Rlc19tcDMsXHJcbiAgcXVhZFRyYWNrTG93RGlzdG9ydGVkVG9uYWxSaHl0aG1fbXAzLFxyXG4gIHF1YWRUcmFja0hpZ2hEZXNjZW5kaW5nUGluZ1JlcGVhdHNfbXAzLFxyXG4gIHF1YWRUcmFja0hpZ2hCZWxsc0ZhbGxBbmRSaXNlX21wMyxcclxuICBxdWFkVHJhY2tMb3dQdW5jdHVhbEJvb3BzX21wMyxcclxuICBxdWFkVHJhY2tIaWdoVG9uZXNBbWJpZW50X21wMyxcclxuICBxdWFkVHJhY2tIaWdoUmVwZWF0ZWRNb25vdG9uZVJpbmdpbmdfbXAzLFxyXG4gIHF1YWRUcmFja0xvd1B1bmN0dWFsQm9vcHNTcGFyc2VfbXAzXHJcbl07XHJcblxyXG4vLyBFYWNoIE5hbWVkUXVhZHJpbGF0ZXJhbCBpcyBhc3NpZ25lZCB6ZXJvIG9yIG1vcmUgb2YgdGhlIGFib3ZlIHRyYWNrcyB0byBwbGF5IGF0IGEgbG91ZGVyIG91dHB1dCBsZXZlbCB3aGVuIHRoZSBzaGFwZVxyXG4vLyBpcyBpbiB0aGF0IHN0YXRlLiBWYWx1ZXMgb2YgdGhlIG1hcCBhcmUgaW5kaWNlcyBvZiB0aGUgc291bmQgZmlsZXMgYWJvdmUgdGhhdCBzaG91bGQgcGxheSBhdCBhIGhpZ2hlciBvdXRwdXQgbGV2ZWwsXHJcbi8vIGFjY29yZGluZyB0byB0aGUgZGVzaWduIGluIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9xdWFkcmlsYXRlcmFsL2lzc3Vlcy8xNzUuXHJcbmNvbnN0IE5BTUVEX1FVQURSSUxBVEVSQUxfVE9fSElHSF9WT0xVTUVfVFJBQ0tTX01BUCA9IG5ldyBNYXAoIFtcclxuICBbIE5hbWVkUXVhZHJpbGF0ZXJhbC5DT05WRVhfUVVBRFJJTEFURVJBTCwgWyAwIF0gXSxcclxuICBbIE5hbWVkUXVhZHJpbGF0ZXJhbC5DT05DQVZFX1FVQURSSUxBVEVSQUwsIFsgMSBdIF0sXHJcbiAgWyBOYW1lZFF1YWRyaWxhdGVyYWwuVFJJQU5HTEUsIFtdIF0sXHJcbiAgWyBOYW1lZFF1YWRyaWxhdGVyYWwuREFSVCwgWyA5IF0gXSxcclxuICBbIE5hbWVkUXVhZHJpbGF0ZXJhbC5LSVRFLCBbIDIgXSBdLFxyXG4gIFsgTmFtZWRRdWFkcmlsYXRlcmFsLlRSQVBFWk9JRCwgWyA0IF0gXSxcclxuICBbIE5hbWVkUXVhZHJpbGF0ZXJhbC5JU09TQ0VMRVNfVFJBUEVaT0lELCBbIDMgXSBdLFxyXG4gIFsgTmFtZWRRdWFkcmlsYXRlcmFsLlBBUkFMTEVMT0dSQU0sIFsgNSBdIF0sXHJcbiAgWyBOYW1lZFF1YWRyaWxhdGVyYWwuUkhPTUJVUywgWyA2IF0gXSxcclxuICBbIE5hbWVkUXVhZHJpbGF0ZXJhbC5SRUNUQU5HTEUsIFsgOCBdIF0sXHJcbiAgWyBOYW1lZFF1YWRyaWxhdGVyYWwuU1FVQVJFLCBbIDcgXSBdXHJcbl0gKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEVtcGhhc2lzVHJhY2tzU291bmRWaWV3IGV4dGVuZHMgVHJhY2tzU291bmRWaWV3IHtcclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VFbXBoYXNpc1RyYWNrc1NvdW5kVmlldzogKCkgPT4gdm9pZDtcclxuXHJcbiAgLy8gVGhlIHJlcXVlc3RlZCBvdXRwdXQgbGV2ZWxzIGZvciBlYWNoIFNvdW5kQ2xpcCBhcyBzaGFwZXMgYXJlIGRldGVjdGVkLiBBbGwgb2YgdGhlc2UgYXJlIHBsYXlpbmcgYXQgb25jZSBhdCB0aGVcclxuICAvLyBwcm92aWRlZCBvdXRwdXQgbGV2ZWwgd2hpbGUgdGhlIFwiaGlnaCB2b2x1bWUgdHJhY2tzXCIgcGxheSBsb3VkZXIgb24gdG9wIG9mIHRoZW0uIFNlZVxyXG4gIC8vaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3F1YWRyaWxhdGVyYWwvaXNzdWVzLzE3NSNpc3N1ZWNvbW1lbnQtMTQwMDY0NTQzNyBmb3IgYSBsaXN0IG9mIHRoZXNlIHZhbHVlcy5cclxuICBwcml2YXRlIHJlYWRvbmx5IGluZGV4VG9CYWNrZ3JvdW5kT3V0cHV0TGV2ZWxNYXAgPSBuZXcgTWFwPG51bWJlciwgbnVtYmVyPiggW1xyXG4gICAgWyAwLCBERUZBVUxUX0JBQ0tHUk9VTkRfT1VUUFVUX0xFVkVMIF0sXHJcbiAgICBbIDEsIERFRkFVTFRfQkFDS0dST1VORF9PVVRQVVRfTEVWRUwgXSxcclxuICAgIFsgMiwgREVGQVVMVF9CQUNLR1JPVU5EX09VVFBVVF9MRVZFTCBdLFxyXG4gICAgWyAzLCBERUZBVUxUX0JBQ0tHUk9VTkRfT1VUUFVUX0xFVkVMIF0sXHJcbiAgICBbIDQsIERFRkFVTFRfQkFDS0dST1VORF9PVVRQVVRfTEVWRUwgXSxcclxuICAgIFsgNSwgREVGQVVMVF9CQUNLR1JPVU5EX09VVFBVVF9MRVZFTCBdLFxyXG4gICAgWyA2LCBERUZBVUxUX0JBQ0tHUk9VTkRfT1VUUFVUX0xFVkVMIC8gMiBdLFxyXG4gICAgWyA3LCBERUZBVUxUX0JBQ0tHUk9VTkRfT1VUUFVUX0xFVkVMICogMiBdLFxyXG4gICAgWyA4LCBERUZBVUxUX0JBQ0tHUk9VTkRfT1VUUFVUX0xFVkVMIF0sXHJcbiAgICBbIDksIERFRkFVTFRfQkFDS0dST1VORF9PVVRQVVRfTEVWRUwgXVxyXG4gIF0gKTtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBzaGFwZU1vZGVsOiBRdWFkcmlsYXRlcmFsU2hhcGVNb2RlbCwgc2hhcGVTb3VuZEVuYWJsZWRQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4sIHJlc2V0Tm90SW5Qcm9ncmVzc1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPiwgc291bmRPcHRpb25zTW9kZWw6IFF1YWRyaWxhdGVyYWxTb3VuZE9wdGlvbnNNb2RlbCApIHtcclxuICAgIHN1cGVyKCBzaGFwZU1vZGVsLCBzaGFwZVNvdW5kRW5hYmxlZFByb3BlcnR5LCByZXNldE5vdEluUHJvZ3Jlc3NQcm9wZXJ0eSwgc291bmRPcHRpb25zTW9kZWwsIEVNUEhBU0lTX1RSQUNLUyApO1xyXG5cclxuICAgIC8vIGRlc2lyZWQgb3V0cHV0IGxldmVscyBmb3IgZWFjaCBzb3VuZCAoYXMgcmVxdWVzdGVkIGJ5IGRlc2lnbiBhZnRlciBtYW51YWxseSBlZGl0aW5nIHRoZSBnYWluKVxyXG4gICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9xdWFkcmlsYXRlcmFsL2lzc3Vlcy8xNzUjaXNzdWVjb21tZW50LTE0MDA2NDU0MzdcclxuICAgIHRoaXMuaW5kZXhUb091dHB1dExldmVsTWFwLnNldCggMCwgMC43NSApO1xyXG4gICAgdGhpcy5pbmRleFRvT3V0cHV0TGV2ZWxNYXAuc2V0KCAxLCAwLjc1ICk7XHJcbiAgICB0aGlzLmluZGV4VG9PdXRwdXRMZXZlbE1hcC5zZXQoIDIsIDEgKTtcclxuICAgIHRoaXMuaW5kZXhUb091dHB1dExldmVsTWFwLnNldCggMywgMSApO1xyXG4gICAgdGhpcy5pbmRleFRvT3V0cHV0TGV2ZWxNYXAuc2V0KCA0LCAxICk7XHJcbiAgICB0aGlzLmluZGV4VG9PdXRwdXRMZXZlbE1hcC5zZXQoIDUsIDEgKTtcclxuICAgIHRoaXMuaW5kZXhUb091dHB1dExldmVsTWFwLnNldCggNiwgMC43NSApO1xyXG4gICAgdGhpcy5pbmRleFRvT3V0cHV0TGV2ZWxNYXAuc2V0KCA3LCAxICk7XHJcbiAgICB0aGlzLmluZGV4VG9PdXRwdXRMZXZlbE1hcC5zZXQoIDgsIDAuNiApO1xyXG4gICAgdGhpcy5pbmRleFRvT3V0cHV0TGV2ZWxNYXAuc2V0KCA5LCAwLjc1ICk7XHJcblxyXG4gICAgY29uc3Qgc2hhcGVOYW1lTGlzdGVuZXIgPSAoIHNoYXBlTmFtZTogTmFtZWRRdWFkcmlsYXRlcmFsICkgPT4ge1xyXG5cclxuICAgICAgLy8gRmlyc3QsIHJlZHVjZSBhbGwgdGhlIHNvdW5kIGNsaXBzIHRvIHRoZWlyIGJhY2tncm91bmQgb3V0cHV0IGxldmVsXHJcbiAgICAgIHRoaXMuc291bmRDbGlwcy5mb3JFYWNoKCAoIHNvdW5kQ2xpcCwgaW5kZXggKSA9PiB7XHJcbiAgICAgICAgc291bmRDbGlwLnNldE91dHB1dExldmVsKCB0aGlzLmluZGV4VG9CYWNrZ3JvdW5kT3V0cHV0TGV2ZWxNYXAuZ2V0KCBpbmRleCApISApO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBwbGF5IHRoZSBlbXBoYXNpemVkIGNsaXBzIGF0IHRoZWlyIGhpZ2hlciB2b2x1bWVcclxuICAgICAgY29uc3QgdHJhY2tzVG9FbXBoYXNpemUgPSBOQU1FRF9RVUFEUklMQVRFUkFMX1RPX0hJR0hfVk9MVU1FX1RSQUNLU19NQVAuZ2V0KCBzaGFwZU5hbWUgKTtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggdHJhY2tzVG9FbXBoYXNpemUsICdOYW1lZFF1YWRyaWxhdGVyYWwgZG9lcyBub3QgaGF2ZSBhIEVtcGhhc2lzVHJhY2tzU291bmRWaWV3IGRlc2lnbicgKTtcclxuICAgICAgdHJhY2tzVG9FbXBoYXNpemUhLmZvckVhY2goIGluZGV4ID0+IHtcclxuICAgICAgICB0aGlzLnNvdW5kQ2xpcHNbIGluZGV4IF0uc2V0T3V0cHV0TGV2ZWwoIHRoaXMuaW5kZXhUb091dHB1dExldmVsTWFwLmdldCggaW5kZXggKSEgKTtcclxuICAgICAgfSApO1xyXG4gICAgfTtcclxuICAgIHNoYXBlTW9kZWwuc2hhcGVOYW1lUHJvcGVydHkubGluayggc2hhcGVOYW1lTGlzdGVuZXIgKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VFbXBoYXNpc1RyYWNrc1NvdW5kVmlldyA9ICgpID0+IHtcclxuICAgICAgc2hhcGVNb2RlbC5zaGFwZU5hbWVQcm9wZXJ0eS51bmxpbmsoIHNoYXBlTmFtZUxpc3RlbmVyICk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VFbXBoYXNpc1RyYWNrc1NvdW5kVmlldygpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxucXVhZHJpbGF0ZXJhbC5yZWdpc3RlciggJ0VtcGhhc2lzVHJhY2tzU291bmRWaWV3JywgRW1waGFzaXNUcmFja3NTb3VuZFZpZXcgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNB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