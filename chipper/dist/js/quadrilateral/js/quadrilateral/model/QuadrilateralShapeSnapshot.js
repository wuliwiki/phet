// Copyright 2021-2023, University of Colorado Boulder

/**
 * A snapshot of the model Properties at a point in time needed to compare against other states to watch
 * how the model is changing over time.
 *
 * Currently, this is used in description code to describe how the shape changes between distinct events (which sounds
 * better than creating a new description every Property change).
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import quadrilateral from '../../quadrilateral.js';
import QuadrilateralSideLabel from './QuadrilateralSideLabel.js';
import QuadrilateralVertexLabel from './QuadrilateralVertexLabel.js';
export default class QuadrilateralShapeSnapshot {
  constructor(shapeModel) {
    this.isParallelogram = shapeModel.isParallelogram();
    this.sideABsideCDParallel = shapeModel.sideABSideCDParallelSideChecker.areSidesParallel();
    this.sideBCsideDAParallel = shapeModel.sideBCSideDAParallelSideChecker.areSidesParallel();
    this.area = shapeModel.areaProperty.value;
    this.namedQuadrilateral = shapeModel.shapeNameProperty.value;
    this.shapeModel = shapeModel;
    this.vertexAPosition = shapeModel.vertexA.positionProperty.value;
    this.vertexBPosition = shapeModel.vertexB.positionProperty.value;
    this.vertexCPosition = shapeModel.vertexC.positionProperty.value;
    this.vertexDPosition = shapeModel.vertexD.positionProperty.value;
    this.vertexAAngle = shapeModel.vertexA.angleProperty.value;
    this.vertexBAngle = shapeModel.vertexB.angleProperty.value;
    this.vertexCAngle = shapeModel.vertexC.angleProperty.value;
    this.vertexDAngle = shapeModel.vertexD.angleProperty.value;
    this.sideABLength = shapeModel.sideAB.lengthProperty.value;
    this.sideBCLength = shapeModel.sideBC.lengthProperty.value;
    this.sideCDLength = shapeModel.sideCD.lengthProperty.value;
    this.sideDALength = shapeModel.sideDA.lengthProperty.value;
    this.sideLengths = [this.sideABLength, this.sideBCLength, this.sideDALength, this.sideCDLength];
  }

  /**
   * Returns the saved QuadrilateralVertex angle of a particular QuadrilateralVertex given the QuadrilateralVertexLabel.
   */
  getAngleFromVertexLabel(label) {
    return label === QuadrilateralVertexLabel.VERTEX_A ? this.vertexAAngle : label === QuadrilateralVertexLabel.VERTEX_B ? this.vertexBAngle : label === QuadrilateralVertexLabel.VERTEX_C ? this.vertexCAngle : this.vertexDAngle; // VERTEX_D
  }

  getLengthFromSideLabel(label) {
    return label === QuadrilateralSideLabel.SIDE_AB ? this.sideABLength : label === QuadrilateralSideLabel.SIDE_BC ? this.sideBCLength : label === QuadrilateralSideLabel.SIDE_CD ? this.sideCDLength : this.sideDALength; // SIDE_DA
  }

  /**
   * Returns the saved QuadrilateralVertex position of a particular QuadrilateralVertex given the QuadrilateralVertexLabel.
   */
  getPositionFromVertexLabel(label) {
    return label === QuadrilateralVertexLabel.VERTEX_A ? this.vertexAPosition : label === QuadrilateralVertexLabel.VERTEX_B ? this.vertexBPosition : label === QuadrilateralVertexLabel.VERTEX_C ? this.vertexCPosition : this.vertexDPosition; // VERTEX_D
  }

  /**
   * Returns the saved vertex positions of a side given the QuadrilateralSideLabel. Returns an array with the
   * vertex positions in order like [ side.vertex1, side.vertex2 ].
   */
  getVertexPositionsFromSideLabel(label) {
    return label === QuadrilateralSideLabel.SIDE_AB ? [this.vertexAPosition, this.vertexBPosition] : label === QuadrilateralSideLabel.SIDE_BC ? [this.vertexBPosition, this.vertexCPosition] : label === QuadrilateralSideLabel.SIDE_CD ? [this.vertexCPosition, this.vertexDPosition] : [this.vertexDPosition, this.vertexAPosition]; // SIDE_DA
  }

  /**
   * Returns the saved side lengths of adjacent sides for side defined by the QuadrilateralSideLabel. Returns
   * an array of adjacent side lengths in order moving clockwise like this:
   *                sideLabel
   *               ----------
   *              |         |
   * adjacentSide1|         |adjacentSide2
   *              |         |
   *              |         |
   *
   * @returns [adjacentSide1.lengthProperty.value, adjacentSide2.lengthProperty.value]
   */
  getAdjacentSideLengthsFromSideLabel(label) {
    return label === QuadrilateralSideLabel.SIDE_AB ? [this.sideDALength, this.sideBCLength] : label === QuadrilateralSideLabel.SIDE_BC ? [this.sideABLength, this.sideCDLength] : label === QuadrilateralSideLabel.SIDE_CD ? [this.sideBCLength, this.sideDALength] : [this.sideCDLength, this.sideABLength]; // SIDE_DA
  }

  /**
   * Returns true if the sides adjacent to the QuadrilateralSide labelled by provided QuadrilateralSideLabel are parallel in this snapshot.
   * For example, given the following:
   *
   *                sideLabel
   *               ----------
   *              |         |
   * adjacentSide1|         |adjacentSide2
   *              |         |
   *              |         |
   *
   * Will return true if adjacentSide1 and adjacentSide2 are parallel.
   */
  getAdjacentSidesParallelFromSideLabel(label) {
    return label === QuadrilateralSideLabel.SIDE_AB ? this.sideBCsideDAParallel : label === QuadrilateralSideLabel.SIDE_BC ? this.sideABsideCDParallel : label === QuadrilateralSideLabel.SIDE_CD ? this.sideBCsideDAParallel : this.sideABsideCDParallel; // SIDE_DA
  }

  /**
   * Counts the number of sides in this snapshot that have the same length, returning the largest count. If all are
   * the same, returns 4. Otherwise, will return 3, then 2, then 0.
   */
  countNumberOfEqualSides() {
    let numberOfEqualSides = 0;
    for (let i = 0; i < this.sideLengths.length; i++) {
      const currentLength = this.sideLengths[i];
      let numberEqualToCurrentLength = 0;
      for (let j = 0; j < this.sideLengths.length; j++) {
        const nextLength = this.sideLengths[j];
        if (this.shapeModel.isInterLengthEqualToOther(currentLength, nextLength)) {
          numberEqualToCurrentLength++;
        }
      }
      if (numberEqualToCurrentLength > numberOfEqualSides) {
        numberOfEqualSides = numberEqualToCurrentLength;
      }
    }
    return numberOfEqualSides;
  }
}
quadrilateral.register('QuadrilateralShapeSnapshot', QuadrilateralShapeSnapshot);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJxdWFkcmlsYXRlcmFsIiwiUXVhZHJpbGF0ZXJhbFNpZGVMYWJlbCIsIlF1YWRyaWxhdGVyYWxWZXJ0ZXhMYWJlbCIsIlF1YWRyaWxhdGVyYWxTaGFwZVNuYXBzaG90IiwiY29uc3RydWN0b3IiLCJzaGFwZU1vZGVsIiwiaXNQYXJhbGxlbG9ncmFtIiwic2lkZUFCc2lkZUNEUGFyYWxsZWwiLCJzaWRlQUJTaWRlQ0RQYXJhbGxlbFNpZGVDaGVja2VyIiwiYXJlU2lkZXNQYXJhbGxlbCIsInNpZGVCQ3NpZGVEQVBhcmFsbGVsIiwic2lkZUJDU2lkZURBUGFyYWxsZWxTaWRlQ2hlY2tlciIsImFyZWEiLCJhcmVhUHJvcGVydHkiLCJ2YWx1ZSIsIm5hbWVkUXVhZHJpbGF0ZXJhbCIsInNoYXBlTmFtZVByb3BlcnR5IiwidmVydGV4QVBvc2l0aW9uIiwidmVydGV4QSIsInBvc2l0aW9uUHJvcGVydHkiLCJ2ZXJ0ZXhCUG9zaXRpb24iLCJ2ZXJ0ZXhCIiwidmVydGV4Q1Bvc2l0aW9uIiwidmVydGV4QyIsInZlcnRleERQb3NpdGlvbiIsInZlcnRleEQiLCJ2ZXJ0ZXhBQW5nbGUiLCJhbmdsZVByb3BlcnR5IiwidmVydGV4QkFuZ2xlIiwidmVydGV4Q0FuZ2xlIiwidmVydGV4REFuZ2xlIiwic2lkZUFCTGVuZ3RoIiwic2lkZUFCIiwibGVuZ3RoUHJvcGVydHkiLCJzaWRlQkNMZW5ndGgiLCJzaWRlQkMiLCJzaWRlQ0RMZW5ndGgiLCJzaWRlQ0QiLCJzaWRlREFMZW5ndGgiLCJzaWRlREEiLCJzaWRlTGVuZ3RocyIsImdldEFuZ2xlRnJvbVZlcnRleExhYmVsIiwibGFiZWwiLCJWRVJURVhfQSIsIlZFUlRFWF9CIiwiVkVSVEVYX0MiLCJnZXRMZW5ndGhGcm9tU2lkZUxhYmVsIiwiU0lERV9BQiIsIlNJREVfQkMiLCJTSURFX0NEIiwiZ2V0UG9zaXRpb25Gcm9tVmVydGV4TGFiZWwiLCJnZXRWZXJ0ZXhQb3NpdGlvbnNGcm9tU2lkZUxhYmVsIiwiZ2V0QWRqYWNlbnRTaWRlTGVuZ3Roc0Zyb21TaWRlTGFiZWwiLCJnZXRBZGphY2VudFNpZGVzUGFyYWxsZWxGcm9tU2lkZUxhYmVsIiwiY291bnROdW1iZXJPZkVxdWFsU2lkZXMiLCJudW1iZXJPZkVxdWFsU2lkZXMiLCJpIiwibGVuZ3RoIiwiY3VycmVudExlbmd0aCIsIm51bWJlckVxdWFsVG9DdXJyZW50TGVuZ3RoIiwiaiIsIm5leHRMZW5ndGgiLCJpc0ludGVyTGVuZ3RoRXF1YWxUb090aGVyIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJRdWFkcmlsYXRlcmFsU2hhcGVTbmFwc2hvdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBIHNuYXBzaG90IG9mIHRoZSBtb2RlbCBQcm9wZXJ0aWVzIGF0IGEgcG9pbnQgaW4gdGltZSBuZWVkZWQgdG8gY29tcGFyZSBhZ2FpbnN0IG90aGVyIHN0YXRlcyB0byB3YXRjaFxyXG4gKiBob3cgdGhlIG1vZGVsIGlzIGNoYW5naW5nIG92ZXIgdGltZS5cclxuICpcclxuICogQ3VycmVudGx5LCB0aGlzIGlzIHVzZWQgaW4gZGVzY3JpcHRpb24gY29kZSB0byBkZXNjcmliZSBob3cgdGhlIHNoYXBlIGNoYW5nZXMgYmV0d2VlbiBkaXN0aW5jdCBldmVudHMgKHdoaWNoIHNvdW5kc1xyXG4gKiBiZXR0ZXIgdGhhbiBjcmVhdGluZyBhIG5ldyBkZXNjcmlwdGlvbiBldmVyeSBQcm9wZXJ0eSBjaGFuZ2UpLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgcXVhZHJpbGF0ZXJhbCBmcm9tICcuLi8uLi9xdWFkcmlsYXRlcmFsLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgUXVhZHJpbGF0ZXJhbFNoYXBlTW9kZWwgZnJvbSAnLi9RdWFkcmlsYXRlcmFsU2hhcGVNb2RlbC5qcyc7XHJcbmltcG9ydCBRdWFkcmlsYXRlcmFsU2lkZUxhYmVsIGZyb20gJy4vUXVhZHJpbGF0ZXJhbFNpZGVMYWJlbC5qcyc7XHJcbmltcG9ydCBRdWFkcmlsYXRlcmFsVmVydGV4TGFiZWwgZnJvbSAnLi9RdWFkcmlsYXRlcmFsVmVydGV4TGFiZWwuanMnO1xyXG5pbXBvcnQgTmFtZWRRdWFkcmlsYXRlcmFsIGZyb20gJy4vTmFtZWRRdWFkcmlsYXRlcmFsLmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFF1YWRyaWxhdGVyYWxTaGFwZVNuYXBzaG90IHtcclxuICBwdWJsaWMgcmVhZG9ubHkgaXNQYXJhbGxlbG9ncmFtOiBib29sZWFuO1xyXG4gIHB1YmxpYyByZWFkb25seSBzaWRlQUJzaWRlQ0RQYXJhbGxlbDogYm9vbGVhbjtcclxuICBwdWJsaWMgcmVhZG9ubHkgc2lkZUJDc2lkZURBUGFyYWxsZWw6IGJvb2xlYW47XHJcbiAgcHVibGljIHJlYWRvbmx5IG5hbWVkUXVhZHJpbGF0ZXJhbDogTmFtZWRRdWFkcmlsYXRlcmFsO1xyXG4gIHB1YmxpYyByZWFkb25seSBhcmVhOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBzaGFwZU1vZGVsOiBRdWFkcmlsYXRlcmFsU2hhcGVNb2RlbDtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IHZlcnRleEFQb3NpdGlvbjogVmVjdG9yMjtcclxuICBwdWJsaWMgcmVhZG9ubHkgdmVydGV4QlBvc2l0aW9uOiBWZWN0b3IyO1xyXG4gIHB1YmxpYyByZWFkb25seSB2ZXJ0ZXhDUG9zaXRpb246IFZlY3RvcjI7XHJcbiAgcHVibGljIHJlYWRvbmx5IHZlcnRleERQb3NpdGlvbjogVmVjdG9yMjtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IHZlcnRleEFBbmdsZTogbnVtYmVyO1xyXG4gIHB1YmxpYyByZWFkb25seSB2ZXJ0ZXhCQW5nbGU6IG51bWJlcjtcclxuICBwdWJsaWMgcmVhZG9ubHkgdmVydGV4Q0FuZ2xlOiBudW1iZXI7XHJcbiAgcHVibGljIHJlYWRvbmx5IHZlcnRleERBbmdsZTogbnVtYmVyO1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgc2lkZUFCTGVuZ3RoOiBudW1iZXI7XHJcbiAgcHVibGljIHJlYWRvbmx5IHNpZGVCQ0xlbmd0aDogbnVtYmVyO1xyXG4gIHB1YmxpYyByZWFkb25seSBzaWRlREFMZW5ndGg6IG51bWJlcjtcclxuICBwdWJsaWMgcmVhZG9ubHkgc2lkZUNETGVuZ3RoOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBzaWRlTGVuZ3RoczogcmVhZG9ubHkgbnVtYmVyW107XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvciggc2hhcGVNb2RlbDogUXVhZHJpbGF0ZXJhbFNoYXBlTW9kZWwgKSB7XHJcbiAgICB0aGlzLmlzUGFyYWxsZWxvZ3JhbSA9IHNoYXBlTW9kZWwuaXNQYXJhbGxlbG9ncmFtKCk7XHJcbiAgICB0aGlzLnNpZGVBQnNpZGVDRFBhcmFsbGVsID0gc2hhcGVNb2RlbC5zaWRlQUJTaWRlQ0RQYXJhbGxlbFNpZGVDaGVja2VyLmFyZVNpZGVzUGFyYWxsZWwoKTtcclxuICAgIHRoaXMuc2lkZUJDc2lkZURBUGFyYWxsZWwgPSBzaGFwZU1vZGVsLnNpZGVCQ1NpZGVEQVBhcmFsbGVsU2lkZUNoZWNrZXIuYXJlU2lkZXNQYXJhbGxlbCgpO1xyXG4gICAgdGhpcy5hcmVhID0gc2hhcGVNb2RlbC5hcmVhUHJvcGVydHkudmFsdWU7XHJcbiAgICB0aGlzLm5hbWVkUXVhZHJpbGF0ZXJhbCA9IHNoYXBlTW9kZWwuc2hhcGVOYW1lUHJvcGVydHkudmFsdWU7XHJcbiAgICB0aGlzLnNoYXBlTW9kZWwgPSBzaGFwZU1vZGVsO1xyXG5cclxuICAgIHRoaXMudmVydGV4QVBvc2l0aW9uID0gc2hhcGVNb2RlbC52ZXJ0ZXhBLnBvc2l0aW9uUHJvcGVydHkudmFsdWU7XHJcbiAgICB0aGlzLnZlcnRleEJQb3NpdGlvbiA9IHNoYXBlTW9kZWwudmVydGV4Qi5wb3NpdGlvblByb3BlcnR5LnZhbHVlO1xyXG4gICAgdGhpcy52ZXJ0ZXhDUG9zaXRpb24gPSBzaGFwZU1vZGVsLnZlcnRleEMucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZTtcclxuICAgIHRoaXMudmVydGV4RFBvc2l0aW9uID0gc2hhcGVNb2RlbC52ZXJ0ZXhELnBvc2l0aW9uUHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgdGhpcy52ZXJ0ZXhBQW5nbGUgPSBzaGFwZU1vZGVsLnZlcnRleEEuYW5nbGVQcm9wZXJ0eS52YWx1ZSE7XHJcbiAgICB0aGlzLnZlcnRleEJBbmdsZSA9IHNoYXBlTW9kZWwudmVydGV4Qi5hbmdsZVByb3BlcnR5LnZhbHVlITtcclxuICAgIHRoaXMudmVydGV4Q0FuZ2xlID0gc2hhcGVNb2RlbC52ZXJ0ZXhDLmFuZ2xlUHJvcGVydHkudmFsdWUhO1xyXG4gICAgdGhpcy52ZXJ0ZXhEQW5nbGUgPSBzaGFwZU1vZGVsLnZlcnRleEQuYW5nbGVQcm9wZXJ0eS52YWx1ZSE7XHJcblxyXG4gICAgdGhpcy5zaWRlQUJMZW5ndGggPSBzaGFwZU1vZGVsLnNpZGVBQi5sZW5ndGhQcm9wZXJ0eS52YWx1ZTtcclxuICAgIHRoaXMuc2lkZUJDTGVuZ3RoID0gc2hhcGVNb2RlbC5zaWRlQkMubGVuZ3RoUHJvcGVydHkudmFsdWU7XHJcbiAgICB0aGlzLnNpZGVDRExlbmd0aCA9IHNoYXBlTW9kZWwuc2lkZUNELmxlbmd0aFByb3BlcnR5LnZhbHVlO1xyXG4gICAgdGhpcy5zaWRlREFMZW5ndGggPSBzaGFwZU1vZGVsLnNpZGVEQS5sZW5ndGhQcm9wZXJ0eS52YWx1ZTtcclxuICAgIHRoaXMuc2lkZUxlbmd0aHMgPSBbXHJcbiAgICAgIHRoaXMuc2lkZUFCTGVuZ3RoLFxyXG4gICAgICB0aGlzLnNpZGVCQ0xlbmd0aCxcclxuICAgICAgdGhpcy5zaWRlREFMZW5ndGgsXHJcbiAgICAgIHRoaXMuc2lkZUNETGVuZ3RoXHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgc2F2ZWQgUXVhZHJpbGF0ZXJhbFZlcnRleCBhbmdsZSBvZiBhIHBhcnRpY3VsYXIgUXVhZHJpbGF0ZXJhbFZlcnRleCBnaXZlbiB0aGUgUXVhZHJpbGF0ZXJhbFZlcnRleExhYmVsLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRBbmdsZUZyb21WZXJ0ZXhMYWJlbCggbGFiZWw6IFF1YWRyaWxhdGVyYWxWZXJ0ZXhMYWJlbCApOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIGxhYmVsID09PSBRdWFkcmlsYXRlcmFsVmVydGV4TGFiZWwuVkVSVEVYX0EgPyB0aGlzLnZlcnRleEFBbmdsZSA6XHJcbiAgICAgICAgICAgbGFiZWwgPT09IFF1YWRyaWxhdGVyYWxWZXJ0ZXhMYWJlbC5WRVJURVhfQiA/IHRoaXMudmVydGV4QkFuZ2xlIDpcclxuICAgICAgICAgICBsYWJlbCA9PT0gUXVhZHJpbGF0ZXJhbFZlcnRleExhYmVsLlZFUlRFWF9DID8gdGhpcy52ZXJ0ZXhDQW5nbGUgOlxyXG4gICAgICAgICAgIHRoaXMudmVydGV4REFuZ2xlOyAvLyBWRVJURVhfRFxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldExlbmd0aEZyb21TaWRlTGFiZWwoIGxhYmVsOiBRdWFkcmlsYXRlcmFsU2lkZUxhYmVsICk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gbGFiZWwgPT09IFF1YWRyaWxhdGVyYWxTaWRlTGFiZWwuU0lERV9BQiA/IHRoaXMuc2lkZUFCTGVuZ3RoIDpcclxuICAgICAgICAgICBsYWJlbCA9PT0gUXVhZHJpbGF0ZXJhbFNpZGVMYWJlbC5TSURFX0JDID8gdGhpcy5zaWRlQkNMZW5ndGggOlxyXG4gICAgICAgICAgIGxhYmVsID09PSBRdWFkcmlsYXRlcmFsU2lkZUxhYmVsLlNJREVfQ0QgPyB0aGlzLnNpZGVDRExlbmd0aCA6XHJcbiAgICAgICAgICAgdGhpcy5zaWRlREFMZW5ndGg7IC8vIFNJREVfREFcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIHNhdmVkIFF1YWRyaWxhdGVyYWxWZXJ0ZXggcG9zaXRpb24gb2YgYSBwYXJ0aWN1bGFyIFF1YWRyaWxhdGVyYWxWZXJ0ZXggZ2l2ZW4gdGhlIFF1YWRyaWxhdGVyYWxWZXJ0ZXhMYWJlbC5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0UG9zaXRpb25Gcm9tVmVydGV4TGFiZWwoIGxhYmVsOiBRdWFkcmlsYXRlcmFsVmVydGV4TGFiZWwgKTogVmVjdG9yMiB7XHJcbiAgICByZXR1cm4gbGFiZWwgPT09IFF1YWRyaWxhdGVyYWxWZXJ0ZXhMYWJlbC5WRVJURVhfQSA/IHRoaXMudmVydGV4QVBvc2l0aW9uIDpcclxuICAgICAgICAgICBsYWJlbCA9PT0gUXVhZHJpbGF0ZXJhbFZlcnRleExhYmVsLlZFUlRFWF9CID8gdGhpcy52ZXJ0ZXhCUG9zaXRpb24gOlxyXG4gICAgICAgICAgIGxhYmVsID09PSBRdWFkcmlsYXRlcmFsVmVydGV4TGFiZWwuVkVSVEVYX0MgPyB0aGlzLnZlcnRleENQb3NpdGlvbiA6XHJcbiAgICAgICAgICAgdGhpcy52ZXJ0ZXhEUG9zaXRpb247IC8vIFZFUlRFWF9EXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSBzYXZlZCB2ZXJ0ZXggcG9zaXRpb25zIG9mIGEgc2lkZSBnaXZlbiB0aGUgUXVhZHJpbGF0ZXJhbFNpZGVMYWJlbC4gUmV0dXJucyBhbiBhcnJheSB3aXRoIHRoZVxyXG4gICAqIHZlcnRleCBwb3NpdGlvbnMgaW4gb3JkZXIgbGlrZSBbIHNpZGUudmVydGV4MSwgc2lkZS52ZXJ0ZXgyIF0uXHJcbiAgICovXHJcbiAgcHVibGljIGdldFZlcnRleFBvc2l0aW9uc0Zyb21TaWRlTGFiZWwoIGxhYmVsOiBRdWFkcmlsYXRlcmFsU2lkZUxhYmVsICk6IFsgVmVjdG9yMiwgVmVjdG9yMiBdIHtcclxuICAgIHJldHVybiBsYWJlbCA9PT0gUXVhZHJpbGF0ZXJhbFNpZGVMYWJlbC5TSURFX0FCID8gWyB0aGlzLnZlcnRleEFQb3NpdGlvbiwgdGhpcy52ZXJ0ZXhCUG9zaXRpb24gXSA6XHJcbiAgICAgICAgICAgbGFiZWwgPT09IFF1YWRyaWxhdGVyYWxTaWRlTGFiZWwuU0lERV9CQyA/IFsgdGhpcy52ZXJ0ZXhCUG9zaXRpb24sIHRoaXMudmVydGV4Q1Bvc2l0aW9uIF0gOlxyXG4gICAgICAgICAgIGxhYmVsID09PSBRdWFkcmlsYXRlcmFsU2lkZUxhYmVsLlNJREVfQ0QgPyBbIHRoaXMudmVydGV4Q1Bvc2l0aW9uLCB0aGlzLnZlcnRleERQb3NpdGlvbiBdIDpcclxuICAgICAgICAgICAgIFsgdGhpcy52ZXJ0ZXhEUG9zaXRpb24sIHRoaXMudmVydGV4QVBvc2l0aW9uIF07IC8vIFNJREVfREFcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIHNhdmVkIHNpZGUgbGVuZ3RocyBvZiBhZGphY2VudCBzaWRlcyBmb3Igc2lkZSBkZWZpbmVkIGJ5IHRoZSBRdWFkcmlsYXRlcmFsU2lkZUxhYmVsLiBSZXR1cm5zXHJcbiAgICogYW4gYXJyYXkgb2YgYWRqYWNlbnQgc2lkZSBsZW5ndGhzIGluIG9yZGVyIG1vdmluZyBjbG9ja3dpc2UgbGlrZSB0aGlzOlxyXG4gICAqICAgICAgICAgICAgICAgIHNpZGVMYWJlbFxyXG4gICAqICAgICAgICAgICAgICAgLS0tLS0tLS0tLVxyXG4gICAqICAgICAgICAgICAgICB8ICAgICAgICAgfFxyXG4gICAqIGFkamFjZW50U2lkZTF8ICAgICAgICAgfGFkamFjZW50U2lkZTJcclxuICAgKiAgICAgICAgICAgICAgfCAgICAgICAgIHxcclxuICAgKiAgICAgICAgICAgICAgfCAgICAgICAgIHxcclxuICAgKlxyXG4gICAqIEByZXR1cm5zIFthZGphY2VudFNpZGUxLmxlbmd0aFByb3BlcnR5LnZhbHVlLCBhZGphY2VudFNpZGUyLmxlbmd0aFByb3BlcnR5LnZhbHVlXVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRBZGphY2VudFNpZGVMZW5ndGhzRnJvbVNpZGVMYWJlbCggbGFiZWw6IFF1YWRyaWxhdGVyYWxTaWRlTGFiZWwgKTogWyBudW1iZXIsIG51bWJlciBdIHtcclxuICAgIHJldHVybiBsYWJlbCA9PT0gUXVhZHJpbGF0ZXJhbFNpZGVMYWJlbC5TSURFX0FCID8gWyB0aGlzLnNpZGVEQUxlbmd0aCwgdGhpcy5zaWRlQkNMZW5ndGggXSA6XHJcbiAgICAgICAgICAgbGFiZWwgPT09IFF1YWRyaWxhdGVyYWxTaWRlTGFiZWwuU0lERV9CQyA/IFsgdGhpcy5zaWRlQUJMZW5ndGgsIHRoaXMuc2lkZUNETGVuZ3RoIF0gOlxyXG4gICAgICAgICAgIGxhYmVsID09PSBRdWFkcmlsYXRlcmFsU2lkZUxhYmVsLlNJREVfQ0QgPyBbIHRoaXMuc2lkZUJDTGVuZ3RoLCB0aGlzLnNpZGVEQUxlbmd0aCBdIDpcclxuICAgICAgICAgICAgIFsgdGhpcy5zaWRlQ0RMZW5ndGgsIHRoaXMuc2lkZUFCTGVuZ3RoIF07IC8vIFNJREVfREFcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgc2lkZXMgYWRqYWNlbnQgdG8gdGhlIFF1YWRyaWxhdGVyYWxTaWRlIGxhYmVsbGVkIGJ5IHByb3ZpZGVkIFF1YWRyaWxhdGVyYWxTaWRlTGFiZWwgYXJlIHBhcmFsbGVsIGluIHRoaXMgc25hcHNob3QuXHJcbiAgICogRm9yIGV4YW1wbGUsIGdpdmVuIHRoZSBmb2xsb3dpbmc6XHJcbiAgICpcclxuICAgKiAgICAgICAgICAgICAgICBzaWRlTGFiZWxcclxuICAgKiAgICAgICAgICAgICAgIC0tLS0tLS0tLS1cclxuICAgKiAgICAgICAgICAgICAgfCAgICAgICAgIHxcclxuICAgKiBhZGphY2VudFNpZGUxfCAgICAgICAgIHxhZGphY2VudFNpZGUyXHJcbiAgICogICAgICAgICAgICAgIHwgICAgICAgICB8XHJcbiAgICogICAgICAgICAgICAgIHwgICAgICAgICB8XHJcbiAgICpcclxuICAgKiBXaWxsIHJldHVybiB0cnVlIGlmIGFkamFjZW50U2lkZTEgYW5kIGFkamFjZW50U2lkZTIgYXJlIHBhcmFsbGVsLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRBZGphY2VudFNpZGVzUGFyYWxsZWxGcm9tU2lkZUxhYmVsKCBsYWJlbDogUXVhZHJpbGF0ZXJhbFNpZGVMYWJlbCApOiBib29sZWFuIHtcclxuICAgIHJldHVybiBsYWJlbCA9PT0gUXVhZHJpbGF0ZXJhbFNpZGVMYWJlbC5TSURFX0FCID8gdGhpcy5zaWRlQkNzaWRlREFQYXJhbGxlbCA6XHJcbiAgICAgICAgICAgbGFiZWwgPT09IFF1YWRyaWxhdGVyYWxTaWRlTGFiZWwuU0lERV9CQyA/IHRoaXMuc2lkZUFCc2lkZUNEUGFyYWxsZWwgOlxyXG4gICAgICAgICAgIGxhYmVsID09PSBRdWFkcmlsYXRlcmFsU2lkZUxhYmVsLlNJREVfQ0QgPyB0aGlzLnNpZGVCQ3NpZGVEQVBhcmFsbGVsIDpcclxuICAgICAgICAgICB0aGlzLnNpZGVBQnNpZGVDRFBhcmFsbGVsOyAvLyBTSURFX0RBXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb3VudHMgdGhlIG51bWJlciBvZiBzaWRlcyBpbiB0aGlzIHNuYXBzaG90IHRoYXQgaGF2ZSB0aGUgc2FtZSBsZW5ndGgsIHJldHVybmluZyB0aGUgbGFyZ2VzdCBjb3VudC4gSWYgYWxsIGFyZVxyXG4gICAqIHRoZSBzYW1lLCByZXR1cm5zIDQuIE90aGVyd2lzZSwgd2lsbCByZXR1cm4gMywgdGhlbiAyLCB0aGVuIDAuXHJcbiAgICovXHJcbiAgcHVibGljIGNvdW50TnVtYmVyT2ZFcXVhbFNpZGVzKCk6IG51bWJlciB7XHJcbiAgICBsZXQgbnVtYmVyT2ZFcXVhbFNpZGVzID0gMDtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuc2lkZUxlbmd0aHMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRMZW5ndGggPSB0aGlzLnNpZGVMZW5ndGhzWyBpIF07XHJcblxyXG4gICAgICBsZXQgbnVtYmVyRXF1YWxUb0N1cnJlbnRMZW5ndGggPSAwO1xyXG4gICAgICBmb3IgKCBsZXQgaiA9IDA7IGogPCB0aGlzLnNpZGVMZW5ndGhzLmxlbmd0aDsgaisrICkge1xyXG4gICAgICAgIGNvbnN0IG5leHRMZW5ndGggPSB0aGlzLnNpZGVMZW5ndGhzWyBqIF07XHJcblxyXG4gICAgICAgIGlmICggdGhpcy5zaGFwZU1vZGVsLmlzSW50ZXJMZW5ndGhFcXVhbFRvT3RoZXIoIGN1cnJlbnRMZW5ndGgsIG5leHRMZW5ndGggKSApIHtcclxuICAgICAgICAgIG51bWJlckVxdWFsVG9DdXJyZW50TGVuZ3RoKys7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIG51bWJlckVxdWFsVG9DdXJyZW50TGVuZ3RoID4gbnVtYmVyT2ZFcXVhbFNpZGVzICkge1xyXG4gICAgICAgIG51bWJlck9mRXF1YWxTaWRlcyA9IG51bWJlckVxdWFsVG9DdXJyZW50TGVuZ3RoO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bWJlck9mRXF1YWxTaWRlcztcclxuICB9XHJcbn1cclxuXHJcbnF1YWRyaWxhdGVyYWwucmVnaXN0ZXIoICdRdWFkcmlsYXRlcmFsU2hhcGVTbmFwc2hvdCcsIFF1YWRyaWxhdGVyYWxTaGFwZVNuYXBzaG90ICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGFBQWEsTUFBTSx3QkFBd0I7QUFHbEQsT0FBT0Msc0JBQXNCLE1BQU0sNkJBQTZCO0FBQ2hFLE9BQU9DLHdCQUF3QixNQUFNLCtCQUErQjtBQUdwRSxlQUFlLE1BQU1DLDBCQUEwQixDQUFDO0VBd0J2Q0MsV0FBV0EsQ0FBRUMsVUFBbUMsRUFBRztJQUN4RCxJQUFJLENBQUNDLGVBQWUsR0FBR0QsVUFBVSxDQUFDQyxlQUFlLENBQUMsQ0FBQztJQUNuRCxJQUFJLENBQUNDLG9CQUFvQixHQUFHRixVQUFVLENBQUNHLCtC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