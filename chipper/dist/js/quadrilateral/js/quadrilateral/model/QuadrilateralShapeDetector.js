// Copyright 2022-2023, University of Colorado Boulder

/**
 * Detects the most specific name of the quadrilateral shape from the current geometric properties.
 *
 * The implementation of shape detection comes from decisions in https://github.com/phetsims/quadrilateral/issues/188.
 * In particular, see https://github.com/phetsims/quadrilateral/issues/188#issuecomment-1226165886 and
 * https://github.com/phetsims/quadrilateral/issues/188#issuecomment-1232237994.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import quadrilateral from '../../quadrilateral.js';
import NamedQuadrilateral from './NamedQuadrilateral.js';

// Set up the bits for each shape property.
const CONCAVE_ANGLE = shapeModel => _.some(shapeModel.vertices, vertex => vertex.angleProperty.value > Math.PI);
const ONE_PARALLEL_PAIR = shapeModel => shapeModel.parallelSidePairsProperty.value.length > 0;
const TWO_PARALLEL_PAIR = shapeModel => shapeModel.parallelSidePairsProperty.value.length > 1;
const TWO_EQUAL_ADJACENT_ANGLE_PAIR = shapeModel => shapeModel.adjacentEqualVertexPairsProperty.value.length > 1;
const ONE_EQUAL_OPPOSITE_ANGLE_PAIR = shapeModel => shapeModel.oppositeEqualVertexPairsProperty.value.length > 0;
const TWO_EQUAL_OPPOSITE_ANGLE_PAIR = shapeModel => shapeModel.oppositeEqualVertexPairsProperty.value.length > 1;
const ALL_EQUAL_ANGLE = shapeModel => shapeModel.getAreAllAnglesRight();
const TWO_EQUAL_ADJACENT_SIDE_PAIR = shapeModel => shapeModel.adjacentEqualSidePairsProperty.value.length > 1;
const ONE_EQUAL_OPPOSITE_SIDE_PAIR = shapeModel => shapeModel.oppositeEqualSidePairsProperty.value.length > 0;
const TWO_EQUAL_OPPOSITE_SIDE_PAIR = shapeModel => shapeModel.oppositeEqualSidePairsProperty.value.length > 1;
const ALL_EQUAL_SIDE = shapeModel => shapeModel.getAreAllLengthsEqual();
const ONE_ANGLE_PIE = shapeModel => _.some(shapeModel.vertices, vertex => shapeModel.isFlatAngle(vertex.angleProperty.value));

// Set up conditions for each shape. The quadrilateral must at least these attributes to be considered a match.
const CONCAVE = [CONCAVE_ANGLE];
const TRIANGLE = [ONE_ANGLE_PIE];
const DART = [CONCAVE_ANGLE, ONE_EQUAL_OPPOSITE_ANGLE_PAIR, TWO_EQUAL_ADJACENT_SIDE_PAIR];
const KITE = [ONE_EQUAL_OPPOSITE_ANGLE_PAIR, TWO_EQUAL_ADJACENT_SIDE_PAIR];
const TRAPEZOID = [ONE_PARALLEL_PAIR];
const ISOSCELES_TRAPEZOID = [...TRAPEZOID, TWO_EQUAL_ADJACENT_ANGLE_PAIR, ONE_EQUAL_OPPOSITE_SIDE_PAIR];
const PARALLELOGRAM = [ONE_PARALLEL_PAIR, TWO_PARALLEL_PAIR, ONE_EQUAL_OPPOSITE_ANGLE_PAIR, TWO_EQUAL_OPPOSITE_ANGLE_PAIR, ONE_EQUAL_OPPOSITE_SIDE_PAIR, TWO_EQUAL_OPPOSITE_SIDE_PAIR];
const RECTANGLE = [...PARALLELOGRAM, ALL_EQUAL_ANGLE, TWO_EQUAL_ADJACENT_ANGLE_PAIR];
const RHOMBUS = [...PARALLELOGRAM, TWO_EQUAL_ADJACENT_SIDE_PAIR, ALL_EQUAL_SIDE];
const SQUARE = [...RHOMBUS, TWO_EQUAL_ADJACENT_ANGLE_PAIR, ALL_EQUAL_ANGLE];

/**
 * Returns true when the condition state matches the conditions. If the condition has at least those
 * requirements (or more) it will still be considered a match for that shape.
 *
 * @param shapeModel
 * @param requirements - requirements for a particular shape
 */
const matches = (shapeModel, requirements) => {
  return requirements.every(requirement => requirement(shapeModel));
};
export default class QuadrilateralShapeDetector {
  /**
   * Compute the name of the quadrilateral. Note this must be called AFTER all order dependent Properties are updated
   * because it relies on vertex positions to be stable and all shape attributes to be calculated. See
   * QuadrilateralShapeModel.updateOrderDependentProperties for more information.
   */
  static getShapeName(shapeModel) {
    // First look for a triangle - it is unique in that if we have a triangle there are no more shapes "under"
    // it that share attributes - so we can return this right away.
    if (matches(shapeModel, TRIANGLE)) {
      return NamedQuadrilateral.TRIANGLE;
    } else if (matches(shapeModel, CONCAVE)) {
      return matches(shapeModel, DART) ? NamedQuadrilateral.DART : NamedQuadrilateral.CONCAVE_QUADRILATERAL;
    } else {
      return matches(shapeModel, SQUARE) ? NamedQuadrilateral.SQUARE : matches(shapeModel, RHOMBUS) ? NamedQuadrilateral.RHOMBUS : matches(shapeModel, RECTANGLE) ? NamedQuadrilateral.RECTANGLE : matches(shapeModel, PARALLELOGRAM) ? NamedQuadrilateral.PARALLELOGRAM : matches(shapeModel, KITE) ? NamedQuadrilateral.KITE : matches(shapeModel, ISOSCELES_TRAPEZOID) ? NamedQuadrilateral.ISOSCELES_TRAPEZOID : matches(shapeModel, TRAPEZOID) ? NamedQuadrilateral.TRAPEZOID : NamedQuadrilateral.CONVEX_QUADRILATERAL;
    }
  }
}
quadrilateral.register('QuadrilateralShapeDetector', QuadrilateralShapeDetector);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJxdWFkcmlsYXRlcmFsIiwiTmFtZWRRdWFkcmlsYXRlcmFsIiwiQ09OQ0FWRV9BTkdMRSIsInNoYXBlTW9kZWwiLCJfIiwic29tZSIsInZlcnRpY2VzIiwidmVydGV4IiwiYW5nbGVQcm9wZXJ0eSIsInZhbHVlIiwiTWF0aCIsIlBJIiwiT05FX1BBUkFMTEVMX1BBSVIiLCJwYXJhbGxlbFNpZGVQYWlyc1Byb3BlcnR5IiwibGVuZ3RoIiwiVFdPX1BBUkFMTEVMX1BBSVIiLCJUV09fRVFVQUxfQURKQUNFTlRfQU5HTEVfUEFJUiIsImFkamFjZW50RXF1YWxWZXJ0ZXhQYWlyc1Byb3BlcnR5IiwiT05FX0VRVUFMX09QUE9TSVRFX0FOR0xFX1BBSVIiLCJvcHBvc2l0ZUVxdWFsVmVydGV4UGFpcnNQcm9wZXJ0eSIsIlRXT19FUVVBTF9PUFBPU0lURV9BTkdMRV9QQUlSIiwiQUxMX0VRVUFMX0FOR0xFIiwiZ2V0QXJlQWxsQW5nbGVzUmlnaHQiLCJUV09fRVFVQUxfQURKQUNFTlRfU0lERV9QQUlSIiwiYWRqYWNlbnRFcXVhbFNpZGVQYWlyc1Byb3BlcnR5IiwiT05FX0VRVUFMX09QUE9TSVRFX1NJREVfUEFJUiIsIm9wcG9zaXRlRXF1YWxTaWRlUGFpcnNQcm9wZXJ0eSIsIlRXT19FUVVBTF9PUFBPU0lURV9TSURFX1BBSVIiLCJBTExfRVFVQUxfU0lERSIsImdldEFyZUFsbExlbmd0aHNFcXVhbCIsIk9ORV9BTkdMRV9QSUUiLCJpc0ZsYXRBbmdsZSIsIkNPTkNBVkUiLCJUUklBTkdMRSIsIkRBUlQiLCJLSVRFIiwiVFJBUEVaT0lEIiwiSVNPU0NFTEVTX1RSQVBFWk9JRCIsIlBBUkFMTEVMT0dSQU0iLCJSRUNUQU5HTEUiLCJSSE9NQlVTIiwiU1FVQVJFIiwibWF0Y2hlcyIsInJlcXVpcmVtZW50cyIsImV2ZXJ5IiwicmVxdWlyZW1lbnQiLCJRdWFkcmlsYXRlcmFsU2hhcGVEZXRlY3RvciIsImdldFNoYXBlTmFtZSIsIkNPTkNBVkVfUVVBRFJJTEFURVJBTCIsIkNPTlZFWF9RVUFEUklMQVRFUkFMIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJRdWFkcmlsYXRlcmFsU2hhcGVEZXRlY3Rvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMi0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBEZXRlY3RzIHRoZSBtb3N0IHNwZWNpZmljIG5hbWUgb2YgdGhlIHF1YWRyaWxhdGVyYWwgc2hhcGUgZnJvbSB0aGUgY3VycmVudCBnZW9tZXRyaWMgcHJvcGVydGllcy5cclxuICpcclxuICogVGhlIGltcGxlbWVudGF0aW9uIG9mIHNoYXBlIGRldGVjdGlvbiBjb21lcyBmcm9tIGRlY2lzaW9ucyBpbiBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcXVhZHJpbGF0ZXJhbC9pc3N1ZXMvMTg4LlxyXG4gKiBJbiBwYXJ0aWN1bGFyLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3F1YWRyaWxhdGVyYWwvaXNzdWVzLzE4OCNpc3N1ZWNvbW1lbnQtMTIyNjE2NTg4NiBhbmRcclxuICogaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3F1YWRyaWxhdGVyYWwvaXNzdWVzLzE4OCNpc3N1ZWNvbW1lbnQtMTIzMjIzNzk5NC5cclxuICpcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmcgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IHF1YWRyaWxhdGVyYWwgZnJvbSAnLi4vLi4vcXVhZHJpbGF0ZXJhbC5qcyc7XHJcbmltcG9ydCBRdWFkcmlsYXRlcmFsU2hhcGVNb2RlbCBmcm9tICcuL1F1YWRyaWxhdGVyYWxTaGFwZU1vZGVsLmpzJztcclxuaW1wb3J0IE5hbWVkUXVhZHJpbGF0ZXJhbCBmcm9tICcuL05hbWVkUXVhZHJpbGF0ZXJhbC5qcyc7XHJcblxyXG4vLyBTZXQgdXAgdGhlIGJpdHMgZm9yIGVhY2ggc2hhcGUgcHJvcGVydHkuXHJcbmNvbnN0IENPTkNBVkVfQU5HTEUgPSAoIHNoYXBlTW9kZWw6IFF1YWRyaWxhdGVyYWxTaGFwZU1vZGVsICkgPT4gXy5zb21lKCBzaGFwZU1vZGVsLnZlcnRpY2VzLCB2ZXJ0ZXggPT4gdmVydGV4LmFuZ2xlUHJvcGVydHkudmFsdWUhID4gTWF0aC5QSSApO1xyXG5jb25zdCBPTkVfUEFSQUxMRUxfUEFJUiA9ICggc2hhcGVNb2RlbDogUXVhZHJpbGF0ZXJhbFNoYXBlTW9kZWwgKSA9PiBzaGFwZU1vZGVsLnBhcmFsbGVsU2lkZVBhaXJzUHJvcGVydHkudmFsdWUubGVuZ3RoID4gMDtcclxuY29uc3QgVFdPX1BBUkFMTEVMX1BBSVIgPSAoIHNoYXBlTW9kZWw6IFF1YWRyaWxhdGVyYWxTaGFwZU1vZGVsICkgPT4gc2hhcGVNb2RlbC5wYXJhbGxlbFNpZGVQYWlyc1Byb3BlcnR5LnZhbHVlLmxlbmd0aCA+IDE7XHJcbmNvbnN0IFRXT19FUVVBTF9BREpBQ0VOVF9BTkdMRV9QQUlSID0gKCBzaGFwZU1vZGVsOiBRdWFkcmlsYXRlcmFsU2hhcGVNb2RlbCApID0+IHNoYXBlTW9kZWwuYWRqYWNlbnRFcXVhbFZlcnRleFBhaXJzUHJvcGVydHkudmFsdWUubGVuZ3RoID4gMTtcclxuY29uc3QgT05FX0VRVUFMX09QUE9TSVRFX0FOR0xFX1BBSVIgPSAoIHNoYXBlTW9kZWw6IFF1YWRyaWxhdGVyYWxTaGFwZU1vZGVsICkgPT4gc2hhcGVNb2RlbC5vcHBvc2l0ZUVxdWFsVmVydGV4UGFpcnNQcm9wZXJ0eS52YWx1ZS5sZW5ndGggPiAwO1xyXG5jb25zdCBUV09fRVFVQUxfT1BQT1NJVEVfQU5HTEVfUEFJUiA9ICggc2hhcGVNb2RlbDogUXVhZHJpbGF0ZXJhbFNoYXBlTW9kZWwgKSA9PiBzaGFwZU1vZGVsLm9wcG9zaXRlRXF1YWxWZXJ0ZXhQYWlyc1Byb3BlcnR5LnZhbHVlLmxlbmd0aCA+IDE7XHJcbmNvbnN0IEFMTF9FUVVBTF9BTkdMRSA9ICggc2hhcGVNb2RlbDogUXVhZHJpbGF0ZXJhbFNoYXBlTW9kZWwgKSA9PiBzaGFwZU1vZGVsLmdldEFyZUFsbEFuZ2xlc1JpZ2h0KCk7XHJcbmNvbnN0IFRXT19FUVVBTF9BREpBQ0VOVF9TSURFX1BBSVIgPSAoIHNoYXBlTW9kZWw6IFF1YWRyaWxhdGVyYWxTaGFwZU1vZGVsICkgPT4gc2hhcGVNb2RlbC5hZGphY2VudEVxdWFsU2lkZVBhaXJzUHJvcGVydHkudmFsdWUubGVuZ3RoID4gMTtcclxuY29uc3QgT05FX0VRVUFMX09QUE9TSVRFX1NJREVfUEFJUiA9ICggc2hhcGVNb2RlbDogUXVhZHJpbGF0ZXJhbFNoYXBlTW9kZWwgKSA9PiBzaGFwZU1vZGVsLm9wcG9zaXRlRXF1YWxTaWRlUGFpcnNQcm9wZXJ0eS52YWx1ZS5sZW5ndGggPiAwO1xyXG5jb25zdCBUV09fRVFVQUxfT1BQT1NJVEVfU0lERV9QQUlSID0gKCBzaGFwZU1vZGVsOiBRdWFkcmlsYXRlcmFsU2hhcGVNb2RlbCApID0+IHNoYXBlTW9kZWwub3Bwb3NpdGVFcXVhbFNpZGVQYWlyc1Byb3BlcnR5LnZhbHVlLmxlbmd0aCA+IDE7XHJcbmNvbnN0IEFMTF9FUVVBTF9TSURFID0gKCBzaGFwZU1vZGVsOiBRdWFkcmlsYXRlcmFsU2hhcGVNb2RlbCApID0+IHNoYXBlTW9kZWwuZ2V0QXJlQWxsTGVuZ3Roc0VxdWFsKCk7XHJcbmNvbnN0IE9ORV9BTkdMRV9QSUUgPSAoIHNoYXBlTW9kZWw6IFF1YWRyaWxhdGVyYWxTaGFwZU1vZGVsICkgPT4gXy5zb21lKCBzaGFwZU1vZGVsLnZlcnRpY2VzLCB2ZXJ0ZXggPT4gc2hhcGVNb2RlbC5pc0ZsYXRBbmdsZSggdmVydGV4LmFuZ2xlUHJvcGVydHkudmFsdWUhICkgKTtcclxuXHJcbi8vIFNldCB1cCBjb25kaXRpb25zIGZvciBlYWNoIHNoYXBlLiBUaGUgcXVhZHJpbGF0ZXJhbCBtdXN0IGF0IGxlYXN0IHRoZXNlIGF0dHJpYnV0ZXMgdG8gYmUgY29uc2lkZXJlZCBhIG1hdGNoLlxyXG5jb25zdCBDT05DQVZFID0gWyBDT05DQVZFX0FOR0xFIF07XHJcblxyXG5jb25zdCBUUklBTkdMRSA9IFsgT05FX0FOR0xFX1BJRSBdO1xyXG5cclxuY29uc3QgREFSVCA9IFtcclxuICBDT05DQVZFX0FOR0xFLFxyXG4gIE9ORV9FUVVBTF9PUFBPU0lURV9BTkdMRV9QQUlSLFxyXG4gIFRXT19FUVVBTF9BREpBQ0VOVF9TSURFX1BBSVJcclxuXTtcclxuXHJcbmNvbnN0IEtJVEUgPSBbXHJcbiAgT05FX0VRVUFMX09QUE9TSVRFX0FOR0xFX1BBSVIsXHJcbiAgVFdPX0VRVUFMX0FESkFDRU5UX1NJREVfUEFJUlxyXG5dO1xyXG5cclxuY29uc3QgVFJBUEVaT0lEID0gW1xyXG4gIE9ORV9QQVJBTExFTF9QQUlSXHJcbl07XHJcblxyXG5jb25zdCBJU09TQ0VMRVNfVFJBUEVaT0lEID0gW1xyXG4gIC4uLlRSQVBFWk9JRCxcclxuICBUV09fRVFVQUxfQURKQUNFTlRfQU5HTEVfUEFJUixcclxuICBPTkVfRVFVQUxfT1BQT1NJVEVfU0lERV9QQUlSXHJcbl07XHJcblxyXG5jb25zdCBQQVJBTExFTE9HUkFNID0gW1xyXG4gIE9ORV9QQVJBTExFTF9QQUlSLFxyXG4gIFRXT19QQVJBTExFTF9QQUlSLFxyXG4gIE9ORV9FUVVBTF9PUFBPU0lURV9BTkdMRV9QQUlSLFxyXG4gIFRXT19FUVVBTF9PUFBPU0lURV9BTkdMRV9QQUlSLFxyXG4gIE9ORV9FUVVBTF9PUFBPU0lURV9TSURFX1BBSVIsXHJcbiAgVFdPX0VRVUFMX09QUE9TSVRFX1NJREVfUEFJUlxyXG5dO1xyXG5cclxuY29uc3QgUkVDVEFOR0xFID0gW1xyXG4gIC4uLlBBUkFMTEVMT0dSQU0sXHJcblxyXG4gIEFMTF9FUVVBTF9BTkdMRSxcclxuICBUV09fRVFVQUxfQURKQUNFTlRfQU5HTEVfUEFJUlxyXG5dO1xyXG5cclxuY29uc3QgUkhPTUJVUyA9IFtcclxuICAuLi5QQVJBTExFTE9HUkFNLFxyXG5cclxuICBUV09fRVFVQUxfQURKQUNFTlRfU0lERV9QQUlSLFxyXG4gIEFMTF9FUVVBTF9TSURFXHJcbl07XHJcblxyXG5jb25zdCBTUVVBUkUgPSBbXHJcbiAgLi4uUkhPTUJVUyxcclxuXHJcbiAgVFdPX0VRVUFMX0FESkFDRU5UX0FOR0xFX1BBSVIsXHJcbiAgQUxMX0VRVUFMX0FOR0xFXHJcbl07XHJcblxyXG4vKipcclxuICogUmV0dXJucyB0cnVlIHdoZW4gdGhlIGNvbmRpdGlvbiBzdGF0ZSBtYXRjaGVzIHRoZSBjb25kaXRpb25zLiBJZiB0aGUgY29uZGl0aW9uIGhhcyBhdCBsZWFzdCB0aG9zZVxyXG4gKiByZXF1aXJlbWVudHMgKG9yIG1vcmUpIGl0IHdpbGwgc3RpbGwgYmUgY29uc2lkZXJlZCBhIG1hdGNoIGZvciB0aGF0IHNoYXBlLlxyXG4gKlxyXG4gKiBAcGFyYW0gc2hhcGVNb2RlbFxyXG4gKiBAcGFyYW0gcmVxdWlyZW1lbnRzIC0gcmVxdWlyZW1lbnRzIGZvciBhIHBhcnRpY3VsYXIgc2hhcGVcclxuICovXHJcbmNvbnN0IG1hdGNoZXMgPSAoIHNoYXBlTW9kZWw6IFF1YWRyaWxhdGVyYWxTaGFwZU1vZGVsLCByZXF1aXJlbWVudHM6IEFycmF5PCggc2hhcGVNb2RlbDogUXVhZHJpbGF0ZXJhbFNoYXBlTW9kZWwgKSA9PiBib29sZWFuPiApOiBib29sZWFuID0+IHtcclxuICByZXR1cm4gcmVxdWlyZW1lbnRzLmV2ZXJ5KCByZXF1aXJlbWVudCA9PiByZXF1aXJlbWVudCggc2hhcGVNb2RlbCApICk7XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBRdWFkcmlsYXRlcmFsU2hhcGVEZXRlY3RvciB7XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbXB1dGUgdGhlIG5hbWUgb2YgdGhlIHF1YWRyaWxhdGVyYWwuIE5vdGUgdGhpcyBtdXN0IGJlIGNhbGxlZCBBRlRFUiBhbGwgb3JkZXIgZGVwZW5kZW50IFByb3BlcnRpZXMgYXJlIHVwZGF0ZWRcclxuICAgKiBiZWNhdXNlIGl0IHJlbGllcyBvbiB2ZXJ0ZXggcG9zaXRpb25zIHRvIGJlIHN0YWJsZSBhbmQgYWxsIHNoYXBlIGF0dHJpYnV0ZXMgdG8gYmUgY2FsY3VsYXRlZC4gU2VlXHJcbiAgICogUXVhZHJpbGF0ZXJhbFNoYXBlTW9kZWwudXBkYXRlT3JkZXJEZXBlbmRlbnRQcm9wZXJ0aWVzIGZvciBtb3JlIGluZm9ybWF0aW9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgZ2V0U2hhcGVOYW1lKCBzaGFwZU1vZGVsOiBRdWFkcmlsYXRlcmFsU2hhcGVNb2RlbCApOiBOYW1lZFF1YWRyaWxhdGVyYWwge1xyXG5cclxuICAgIC8vIEZpcnN0IGxvb2sgZm9yIGEgdHJpYW5nbGUgLSBpdCBpcyB1bmlxdWUgaW4gdGhhdCBpZiB3ZSBoYXZlIGEgdHJpYW5nbGUgdGhlcmUgYXJlIG5vIG1vcmUgc2hhcGVzIFwidW5kZXJcIlxyXG4gICAgLy8gaXQgdGhhdCBzaGFyZSBhdHRyaWJ1dGVzIC0gc28gd2UgY2FuIHJldHVybiB0aGlzIHJpZ2h0IGF3YXkuXHJcbiAgICBpZiAoIG1hdGNoZXMoIHNoYXBlTW9kZWwsIFRSSUFOR0xFICkgKSB7XHJcbiAgICAgIHJldHVybiBOYW1lZFF1YWRyaWxhdGVyYWwuVFJJQU5HTEU7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggbWF0Y2hlcyggc2hhcGVNb2RlbCwgQ09OQ0FWRSApICkge1xyXG4gICAgICByZXR1cm4gbWF0Y2hlcyggc2hhcGVNb2RlbCwgREFSVCApID8gTmFtZWRRdWFkcmlsYXRlcmFsLkRBUlQgOlxyXG4gICAgICAgICAgICAgTmFtZWRRdWFkcmlsYXRlcmFsLkNPTkNBVkVfUVVBRFJJTEFURVJBTDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICByZXR1cm4gbWF0Y2hlcyggc2hhcGVNb2RlbCwgU1FVQVJFICkgPyBOYW1lZFF1YWRyaWxhdGVyYWwuU1FVQVJFIDpcclxuICAgICAgICAgICAgIG1hdGNoZXMoIHNoYXBlTW9kZWwsIFJIT01CVVMgKSA/IE5hbWVkUXVhZHJpbGF0ZXJhbC5SSE9NQlVTIDpcclxuICAgICAgICAgICAgIG1hdGNoZXMoIHNoYXBlTW9kZWwsIFJFQ1RBTkdMRSApID8gTmFtZWRRdWFkcmlsYXRlcmFsLlJFQ1RBTkdMRSA6XHJcbiAgICAgICAgICAgICBtYXRjaGVzKCBzaGFwZU1vZGVsLCBQQVJBTExFTE9HUkFNICkgPyBOYW1lZFF1YWRyaWxhdGVyYWwuUEFSQUxMRUxPR1JBTSA6XHJcbiAgICAgICAgICAgICBtYXRjaGVzKCBzaGFwZU1vZGVsLCBLSVRFICkgPyBOYW1lZFF1YWRyaWxhdGVyYWwuS0lURSA6XHJcbiAgICAgICAgICAgICBtYXRjaGVzKCBzaGFwZU1vZGVsLCBJU09TQ0VMRVNfVFJBUEVaT0lEICkgPyBOYW1lZFF1YWRyaWxhdGVyYWwuSVNPU0NFTEVTX1RSQVBFWk9JRCA6XHJcbiAgICAgICAgICAgICBtYXRjaGVzKCBzaGFwZU1vZGVsLCBUUkFQRVpPSUQgKSA/IE5hbWVkUXVhZHJpbGF0ZXJhbC5UUkFQRVpPSUQgOlxyXG4gICAgICAgICAgICAgTmFtZWRRdWFkcmlsYXRlcmFsLkNPTlZFWF9RVUFEUklMQVRFUkFMO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxucXVhZHJpbGF0ZXJhbC5yZWdpc3RlciggJ1F1YWRyaWxhdGVyYWxTaGFwZURldGVjdG9yJywgUXVhZHJpbGF0ZXJhbFNoYXBlRGV0ZWN0b3IgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsYUFBYSxNQUFNLHdCQUF3QjtBQUVsRCxPQUFPQyxrQkFBa0IsTUFBTSx5QkFBeUI7O0FBRXhEO0FBQ0EsTUFBTUMsYUFBYSxHQUFLQyxVQUFtQyxJQUFNQyxDQUFDLENBQUNDLElBQUksQ0FBRUYsVUFBVSxDQUFDRyxRQUFRLEVBQUVDLE1BQU0sSUFBSUEsTUFBTSxDQUFDQyxhQUFhLENBQUNDLEtBQUssR0FBSUMsSUFBSSxDQUFDQyxFQUFHLENBQUM7QUFDL0ksTUFBTUMsaUJBQWlCLEdBQUtULFVBQW1DLElBQU1BLFVBQVUsQ0FBQ1UseUJB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