// Copyright 2015-2023, University of Colorado Boulder

/**
 * Voltmeter model.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 * @author Andrew Adare (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../../axon/js/BooleanProperty.js';
import Multilink from '../../../../../axon/js/Multilink.js';
import Property from '../../../../../axon/js/Property.js';
import StringProperty from '../../../../../axon/js/StringProperty.js';
import Bounds2 from '../../../../../dot/js/Bounds2.js';
import Dimension2 from '../../../../../dot/js/Dimension2.js';
import Vector3 from '../../../../../dot/js/Vector3.js';
import YawPitchModelViewTransform3 from '../../../../../scenery-phet/js/capacitor/YawPitchModelViewTransform3.js';
import NullableIO from '../../../../../tandem/js/types/NullableIO.js';
import NumberIO from '../../../../../tandem/js/types/NumberIO.js';
import capacitorLabBasics from '../../../capacitorLabBasics.js';
import CircuitPosition from '../CircuitPosition.js';
import CircuitState from '../CircuitState.js';
import ParallelCircuit from '../ParallelCircuit.js';
import ProbeTarget from '../ProbeTarget.js';
import VoltmeterShapeCreator from '../shapes/VoltmeterShapeCreator.js';

// constants
// size of the probe tips, determined by visual inspection of the associated image files
const PROBE_TIP_SIZE = new Dimension2(0.0003, 0.0013); // meters

// Initial positions when dragged out of toolbox
const POSITIVE_PROBE_POSITION = new Vector3(0.0669, 0.0298, 0);
const NEGATIVE_PROBE_POSITION = new Vector3(0.0707, 0.0329, 0);
class Voltmeter {
  /**
   * @param {ParallelCircuit} circuit
   * @param {Bounds2} dragBounds
   * @param {YawPitchModelViewTransform3} modelViewTransform
   * @param {Property.<boolean>} voltmeterVisibleProperty
   * @param {Tandem} tandem
   */
  constructor(circuit, dragBounds, modelViewTransform, voltmeterVisibleProperty, tandem) {
    assert && assert(circuit instanceof ParallelCircuit);
    assert && assert(dragBounds instanceof Bounds2);
    assert && assert(modelViewTransform instanceof YawPitchModelViewTransform3);

    // @private {ParallelCircuit}
    this.circuit = circuit;

    // @public {Bounds2} (read-only)
    this.dragBounds = dragBounds;

    // @private {YawPitchModelViewTransform3}
    this.modelViewTransform = modelViewTransform;

    // @public {Dimension2} (read-only)
    this.probeTipSizeReference = PROBE_TIP_SIZE;

    // @public {Property.<boolean>}
    this.visibleProperty = voltmeterVisibleProperty;

    // @public {Property.<boolean>}
    this.isDraggedProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('isDraggedProperty'),
      phetioDocumentation: 'Indicates whether the user is currently dragging the voltmeter'
    });

    // @public {Property.<Vector3>}
    this.bodyPositionProperty = new Property(new Vector3(0, 0, 0), {
      valueComparisonStrategy: 'equalsFunction',
      tandem: tandem.createTandem('bodyPositionProperty'),
      phetioValueType: Vector3.Vector3IO
    });

    // @public {Property.<Vector3>}
    this.positiveProbePositionProperty = new Property(POSITIVE_PROBE_POSITION, {
      valueComparisonStrategy: 'equalsFunction',
      tandem: tandem.createTandem('positiveProbePositionProperty'),
      phetioValueType: Vector3.Vector3IO
    });

    // @public {Property.<Vector3>}
    this.negativeProbePositionProperty = new Property(NEGATIVE_PROBE_POSITION, {
      valueComparisonStrategy: 'equalsFunction',
      tandem: tandem.createTandem('negativeProbePositionProperty'),
      phetioValueType: Vector3.Vector3IO
    });

    // By design, the voltmeter reads "?" for disconnected contacts, which is represented internally by a null
    // assignment value.
    // @public {Property.<number|null>}
    this.measuredVoltageProperty = new Property(null, {
      tandem: tandem.createTandem('measuredVoltageProperty'),
      units: 'V',
      phetioValueType: NullableIO(NumberIO)
    });

    // TODO: factor out shared code for positive/negative probe
    // TODO: Why not an enum?
    // @private {Property.<ProbeTarget>} - What the positive probe is currently touching. Updated from within computeValue below.
    this.positiveProbeTargetProperty = new StringProperty(ProbeTarget.NONE, {
      tandem: tandem.createTandem('positiveProbeTargetProperty')
    });

    // @private {Property.<ProbeTarget>} - What the negative probe is currently touching. Updated from within computeValue below.
    // TODO: Why not an enum?
    this.negativeProbeTargetProperty = new StringProperty(ProbeTarget.NONE, {
      tandem: tandem.createTandem('negativeProbeTargetProperty')
    });

    // @public {VoltmeterShapeCreator} (read-only)
    this.shapeCreator = new VoltmeterShapeCreator(this, modelViewTransform);

    /**
     * Update the value of the meter. Called when many different properties change.
     */
    const updateValue = () => {
      if (this.visibleProperty.value) {
        const probesTouching = this.probesAreTouching();
        this.positiveProbeTargetProperty.value = probesTouching ? ProbeTarget.OTHER_PROBE : this.circuit.getProbeTarget(this.shapeCreator.getPositiveProbeTipShape());
        this.negativeProbeTargetProperty.value = probesTouching ? ProbeTarget.OTHER_PROBE : this.circuit.getProbeTarget(this.shapeCreator.getNegativeProbeTipShape());
        this.measuredVoltageProperty.value = this.computeValue();
      } else {
        this.measuredVoltageProperty.value = null;
      }
    };
    updateValue();

    // Since we don't update when not visible,
    this.visibleProperty.lazyLink(updateValue);

    // Update voltage reading if plate voltage changes
    circuit.capacitor.plateVoltageProperty.lazyLink(updateValue);

    // Update reading when the probes move
    Multilink.lazyMultilink([this.negativeProbePositionProperty, this.positiveProbePositionProperty], updateValue);

    // Update all segments and the plate voltages when capacitor plate geometry changes. Capacitor may not exist yet.
    circuit.capacitor.plateSeparationProperty.lazyLink(updateValue);

    // Update the plate voltage when the capacitor plate size changes. Capacitor may not exist yet.
    circuit.capacitor.plateSizeProperty.lazyLink(updateValue);

    // update the value when the circuit connection property changes
    circuit.circuitConnectionProperty.lazyLink(updateValue);

    // Update when battery voltage changes
    circuit.battery.voltageProperty.lazyLink(updateValue);

    // Update when the switch is moving. NOTE: only listening to the top, since both get activated at the same time.
    circuit.capacitor.topCircuitSwitch.angleProperty.lazyLink(updateValue);
  }

  /**
   * Computes the voltage reading for this voltmeter (null corresponds to a ? on the voltmeter)
   * @private
   *
   * @returns {number|null} - voltage difference between probes
   */
  computeValue() {
    const positiveProbeTarget = this.positiveProbeTargetProperty.value;
    const negativeProbeTarget = this.negativeProbeTargetProperty.value;

    // If one probe is disconnected, return null.
    if (positiveProbeTarget === ProbeTarget.NONE || negativeProbeTarget === ProbeTarget.NONE) {
      return null;
    }

    // Sanity check for both as "other probe"
    if (positiveProbeTarget === ProbeTarget.OTHER_PROBE || negativeProbeTarget === ProbeTarget.OTHER_PROBE) {
      return 0;
    }
    let positiveCircuitPosition = ProbeTarget.getCircuitPosition(positiveProbeTarget);
    let negativeCircuitPosition = ProbeTarget.getCircuitPosition(negativeProbeTarget);

    // If the probes are touching the same position, there should be no voltage change. We check here first so we can
    // bail out and avoid any more work (even though we do a very similar check below).
    if (positiveCircuitPosition === negativeCircuitPosition) {
      return 0;
    }

    // Closed circuit between battery and capacitor
    if (this.circuit.circuitConnectionProperty.value === CircuitState.BATTERY_CONNECTED) {
      // Shift capacitor positions to battery positions (since we use the total voltage for anything connected to the capacitor)
      if (CircuitPosition.isCapacitor(positiveCircuitPosition)) {
        positiveCircuitPosition = CircuitPosition.isTop(positiveCircuitPosition) ? CircuitPosition.BATTERY_TOP : CircuitPosition.BATTERY_BOTTOM;
      }
      if (CircuitPosition.isCapacitor(negativeCircuitPosition)) {
        negativeCircuitPosition = CircuitPosition.isTop(negativeCircuitPosition) ? CircuitPosition.BATTERY_TOP : CircuitPosition.BATTERY_BOTTOM;
      }
    }
    // Closed circuit between light bulb and capacitor
    else if (this.circuit.circuitConnectionProperty.value === CircuitState.LIGHT_BULB_CONNECTED) {
      // Shift light bulb positions to capacitor positions (since we use the capacitor plate voltage for anything connected to the light bulb)
      if (CircuitPosition.isLightBulb(positiveCircuitPosition)) {
        positiveCircuitPosition = CircuitPosition.isTop(positiveCircuitPosition) ? CircuitPosition.CAPACITOR_TOP : CircuitPosition.CAPACITOR_BOTTOM;
      }
      if (CircuitPosition.isLightBulb(negativeCircuitPosition)) {
        negativeCircuitPosition = CircuitPosition.isTop(negativeCircuitPosition) ? CircuitPosition.CAPACITOR_TOP : CircuitPosition.CAPACITOR_BOTTOM;
      }
    }

    // If the probes are touching the same position, there should be no voltage change. This is different from the
    // above check (with the same code) since we have potentially remapped some of the circuit positions.
    if (positiveCircuitPosition === negativeCircuitPosition) {
      return 0;
    }
    // If probes are on opposite sides of the battery
    else if (CircuitPosition.isBattery(positiveCircuitPosition) && CircuitPosition.isBattery(negativeCircuitPosition)) {
      return (CircuitPosition.isTop(positiveCircuitPosition) ? 1 : -1) * this.circuit.getTotalVoltage();
    }
    // If probes are on opposite sides of the capacitor (and can't be connected to the battery, see above)
    else if (CircuitPosition.isCapacitor(positiveCircuitPosition) && CircuitPosition.isCapacitor(negativeCircuitPosition)) {
      return (CircuitPosition.isTop(positiveCircuitPosition) ? 1 : -1) * this.circuit.getCapacitorPlateVoltage();
    }
    // If probes are on opposite sides of the light bulb (and can't be connected to the capacitor, see above)
    else if (CircuitPosition.isLightBulb(positiveCircuitPosition) && CircuitPosition.isLightBulb(negativeCircuitPosition)) {
      return 0;
    }
    // Probes are not touching a connected component
    else {
      return null;
    }
  }

  /**
   * Probes are touching if their tips intersect.
   * @public
   *
   * @returns {boolean}
   */
  probesAreTouching() {
    const posShape = this.shapeCreator.getPositiveProbeTipShape();
    const negShape = this.shapeCreator.getNegativeProbeTipShape();
    return posShape.bounds.intersectsBounds(negShape.bounds) && posShape.shapeIntersection(negShape).getNonoverlappingArea() > 0;
  }

  // @public
  reset() {
    this.isDraggedProperty.reset();
    this.bodyPositionProperty.reset();
    this.positiveProbePositionProperty.reset();
    this.negativeProbePositionProperty.reset();
    this.measuredVoltageProperty.reset();
    this.positiveProbeTargetProperty.reset();
    this.negativeProbeTargetProperty.reset();
  }
}
capacitorLabBasics.register('Voltmeter', Voltmeter);
export default Voltmeter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJNdWx0aWxpbmsiLCJQcm9wZXJ0eSIsIlN0cmluZ1Byb3BlcnR5IiwiQm91bmRzMiIsIkRpbWVuc2lvbjIiLCJWZWN0b3IzIiwiWWF3UGl0Y2hNb2RlbFZpZXdUcmFuc2Zvcm0zIiwiTnVsbGFibGVJTyIsIk51bWJlcklPIiwiY2FwYWNpdG9yTGFiQmFzaWNzIiwiQ2lyY3VpdFBvc2l0aW9uIiwiQ2lyY3VpdFN0YXRlIiwiUGFyYWxsZWxDaXJjdWl0IiwiUHJvYmVUYXJnZXQiLCJWb2x0bWV0ZXJTaGFwZUNyZWF0b3IiLCJQUk9CRV9USVBfU0laRSIsIlBPU0lUSVZFX1BST0JFX1BPU0lUSU9OIiwiTkVHQVRJVkVfUFJPQkVfUE9TSVRJT04iLCJWb2x0bWV0ZXIiLCJjb25zdHJ1Y3RvciIsImNpcmN1aXQiLCJkcmFnQm91bmRzIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwidm9sdG1ldGVyVmlzaWJsZVByb3BlcnR5IiwidGFuZGVtIiwiYXNzZXJ0IiwicHJvYmVUaXBTaXplUmVmZXJlbmNlIiwidmlzaWJsZVByb3BlcnR5IiwiaXNEcmFnZ2VkUHJvcGVydHkiLCJjcmVhdGVUYW5kZW0iLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwiYm9keVBvc2l0aW9uUHJvcGVydHkiLCJ2YWx1ZUNvbXBhcmlzb25TdHJhdGVneSIsInBoZXRpb1ZhbHVlVHlwZSIsIlZlY3RvcjNJTyIsInBvc2l0aXZlUHJvYmVQb3NpdGlvblByb3BlcnR5IiwibmVnYXRpdmVQcm9iZVBvc2l0aW9uUHJvcGVydHkiLCJtZWFzdXJlZFZvbHRhZ2VQcm9wZXJ0eSIsInVuaXRzIiwicG9zaXRpdmVQcm9iZVRhcmdldFByb3BlcnR5IiwiTk9ORSIsIm5lZ2F0aXZlUHJvYmVUYXJnZXRQcm9wZXJ0eSIsInNoYXBlQ3JlYXRvciIsInVwZGF0ZVZhbHVlIiwidmFsdWUiLCJwcm9iZXNUb3VjaGluZyIsInByb2Jlc0FyZVRvdWNoaW5nIiwiT1RIRVJfUFJPQkUiLCJnZXRQcm9iZVRhcmdldCIsImdldFBvc2l0aXZlUHJvYmVUaXBTaGFwZSIsImdldE5lZ2F0aXZlUHJvYmVUaXBTaGFwZSIsImNvbXB1dGVWYWx1ZSIsImxhenlMaW5rIiwiY2FwYWNpdG9yIiwicGxhdGVWb2x0YWdlUHJvcGVydHkiLCJsYXp5TXVsdGlsaW5rIiwicGxhdGVTZXBhcmF0aW9uUHJvcGVydHkiLCJwbGF0ZVNpemVQcm9wZXJ0eSIsImNpcmN1aXRDb25uZWN0aW9uUHJvcGVydHkiLCJiYXR0ZXJ5Iiwidm9sdGFnZVByb3BlcnR5IiwidG9wQ2lyY3VpdFN3aXRjaCIsImFuZ2xlUHJvcGVydHkiLCJwb3NpdGl2ZVByb2JlVGFyZ2V0IiwibmVnYXRpdmVQcm9iZVRhcmdldCIsInBvc2l0aXZlQ2lyY3VpdFBvc2l0aW9uIiwiZ2V0Q2lyY3VpdFBvc2l0aW9uIiwibmVnYXRpdmVDaXJjdWl0UG9zaXRpb24iLCJCQVRURVJZX0NPTk5FQ1RFRCIsImlzQ2FwYWNpdG9yIiwiaXNUb3AiLCJCQVRURVJZX1RPUCIsIkJBVFRFUllfQk9UVE9NIiwiTElHSFRfQlVMQl9DT05ORUNURUQiLCJpc0xpZ2h0QnVsYiIsIkNBUEFDSVRPUl9UT1AiLCJDQVBBQ0lUT1JfQk9UVE9NIiwiaXNCYXR0ZXJ5IiwiZ2V0VG90YWxWb2x0YWdlIiwiZ2V0Q2FwYWNpdG9yUGxhdGVWb2x0YWdlIiwicG9zU2hhcGUiLCJuZWdTaGFwZSIsImJvdW5kcyIsImludGVyc2VjdHNCb3VuZHMiLCJzaGFwZUludGVyc2VjdGlvbiIsImdldE5vbm92ZXJsYXBwaW5nQXJlYSIsInJlc2V0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJWb2x0bWV0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTUtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVm9sdG1ldGVyIG1vZGVsLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBBbmRyZXcgQWRhcmUgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBTdHJpbmdQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi8uLi9heG9uL2pzL1N0cmluZ1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IEJvdW5kczIgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL0JvdW5kczIuanMnO1xyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi8uLi8uLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCBWZWN0b3IzIGZyb20gJy4uLy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IzLmpzJztcclxuaW1wb3J0IFlhd1BpdGNoTW9kZWxWaWV3VHJhbnNmb3JtMyBmcm9tICcuLi8uLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvY2FwYWNpdG9yL1lhd1BpdGNoTW9kZWxWaWV3VHJhbnNmb3JtMy5qcyc7XHJcbmltcG9ydCBOdWxsYWJsZUlPIGZyb20gJy4uLy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdWxsYWJsZUlPLmpzJztcclxuaW1wb3J0IE51bWJlcklPIGZyb20gJy4uLy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdW1iZXJJTy5qcyc7XHJcbmltcG9ydCBjYXBhY2l0b3JMYWJCYXNpY3MgZnJvbSAnLi4vLi4vLi4vY2FwYWNpdG9yTGFiQmFzaWNzLmpzJztcclxuaW1wb3J0IENpcmN1aXRQb3NpdGlvbiBmcm9tICcuLi9DaXJjdWl0UG9zaXRpb24uanMnO1xyXG5pbXBvcnQgQ2lyY3VpdFN0YXRlIGZyb20gJy4uL0NpcmN1aXRTdGF0ZS5qcyc7XHJcbmltcG9ydCBQYXJhbGxlbENpcmN1aXQgZnJvbSAnLi4vUGFyYWxsZWxDaXJjdWl0LmpzJztcclxuaW1wb3J0IFByb2JlVGFyZ2V0IGZyb20gJy4uL1Byb2JlVGFyZ2V0LmpzJztcclxuaW1wb3J0IFZvbHRtZXRlclNoYXBlQ3JlYXRvciBmcm9tICcuLi9zaGFwZXMvVm9sdG1ldGVyU2hhcGVDcmVhdG9yLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG4vLyBzaXplIG9mIHRoZSBwcm9iZSB0aXBzLCBkZXRlcm1pbmVkIGJ5IHZpc3VhbCBpbnNwZWN0aW9uIG9mIHRoZSBhc3NvY2lhdGVkIGltYWdlIGZpbGVzXHJcbmNvbnN0IFBST0JFX1RJUF9TSVpFID0gbmV3IERpbWVuc2lvbjIoIDAuMDAwMywgMC4wMDEzICk7IC8vIG1ldGVyc1xyXG5cclxuLy8gSW5pdGlhbCBwb3NpdGlvbnMgd2hlbiBkcmFnZ2VkIG91dCBvZiB0b29sYm94XHJcbmNvbnN0IFBPU0lUSVZFX1BST0JFX1BPU0lUSU9OID0gbmV3IFZlY3RvcjMoIDAuMDY2OSwgMC4wMjk4LCAwICk7XHJcbmNvbnN0IE5FR0FUSVZFX1BST0JFX1BPU0lUSU9OID0gbmV3IFZlY3RvcjMoIDAuMDcwNywgMC4wMzI5LCAwICk7XHJcblxyXG5jbGFzcyBWb2x0bWV0ZXIge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7UGFyYWxsZWxDaXJjdWl0fSBjaXJjdWl0XHJcbiAgICogQHBhcmFtIHtCb3VuZHMyfSBkcmFnQm91bmRzXHJcbiAgICogQHBhcmFtIHtZYXdQaXRjaE1vZGVsVmlld1RyYW5zZm9ybTN9IG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPGJvb2xlYW4+fSB2b2x0bWV0ZXJWaXNpYmxlUHJvcGVydHlcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGNpcmN1aXQsIGRyYWdCb3VuZHMsIG1vZGVsVmlld1RyYW5zZm9ybSwgdm9sdG1ldGVyVmlzaWJsZVByb3BlcnR5LCB0YW5kZW0gKSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjaXJjdWl0IGluc3RhbmNlb2YgUGFyYWxsZWxDaXJjdWl0ICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBkcmFnQm91bmRzIGluc3RhbmNlb2YgQm91bmRzMiApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggbW9kZWxWaWV3VHJhbnNmb3JtIGluc3RhbmNlb2YgWWF3UGl0Y2hNb2RlbFZpZXdUcmFuc2Zvcm0zICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge1BhcmFsbGVsQ2lyY3VpdH1cclxuICAgIHRoaXMuY2lyY3VpdCA9IGNpcmN1aXQ7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7Qm91bmRzMn0gKHJlYWQtb25seSlcclxuICAgIHRoaXMuZHJhZ0JvdW5kcyA9IGRyYWdCb3VuZHM7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge1lhd1BpdGNoTW9kZWxWaWV3VHJhbnNmb3JtM31cclxuICAgIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtID0gbW9kZWxWaWV3VHJhbnNmb3JtO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge0RpbWVuc2lvbjJ9IChyZWFkLW9ubHkpXHJcbiAgICB0aGlzLnByb2JlVGlwU2l6ZVJlZmVyZW5jZSA9IFBST0JFX1RJUF9TSVpFO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge1Byb3BlcnR5Ljxib29sZWFuPn1cclxuICAgIHRoaXMudmlzaWJsZVByb3BlcnR5ID0gdm9sdG1ldGVyVmlzaWJsZVByb3BlcnR5O1xyXG5cclxuICAgIC8vIEBwdWJsaWMge1Byb3BlcnR5Ljxib29sZWFuPn1cclxuICAgIHRoaXMuaXNEcmFnZ2VkUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdpc0RyYWdnZWRQcm9wZXJ0eScgKSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ0luZGljYXRlcyB3aGV0aGVyIHRoZSB1c2VyIGlzIGN1cnJlbnRseSBkcmFnZ2luZyB0aGUgdm9sdG1ldGVyJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge1Byb3BlcnR5LjxWZWN0b3IzPn1cclxuICAgIHRoaXMuYm9keVBvc2l0aW9uUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIG5ldyBWZWN0b3IzKCAwLCAwLCAwICksIHtcclxuICAgICAgdmFsdWVDb21wYXJpc29uU3RyYXRlZ3k6ICdlcXVhbHNGdW5jdGlvbicsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2JvZHlQb3NpdGlvblByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9WYWx1ZVR5cGU6IFZlY3RvcjMuVmVjdG9yM0lPXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7UHJvcGVydHkuPFZlY3RvcjM+fVxyXG4gICAgdGhpcy5wb3NpdGl2ZVByb2JlUG9zaXRpb25Qcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggUE9TSVRJVkVfUFJPQkVfUE9TSVRJT04sIHtcclxuICAgICAgdmFsdWVDb21wYXJpc29uU3RyYXRlZ3k6ICdlcXVhbHNGdW5jdGlvbicsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Bvc2l0aXZlUHJvYmVQb3NpdGlvblByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9WYWx1ZVR5cGU6IFZlY3RvcjMuVmVjdG9yM0lPXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7UHJvcGVydHkuPFZlY3RvcjM+fVxyXG4gICAgdGhpcy5uZWdhdGl2ZVByb2JlUG9zaXRpb25Qcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggTkVHQVRJVkVfUFJPQkVfUE9TSVRJT04sIHtcclxuICAgICAgdmFsdWVDb21wYXJpc29uU3RyYXRlZ3k6ICdlcXVhbHNGdW5jdGlvbicsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ25lZ2F0aXZlUHJvYmVQb3NpdGlvblByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9WYWx1ZVR5cGU6IFZlY3RvcjMuVmVjdG9yM0lPXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQnkgZGVzaWduLCB0aGUgdm9sdG1ldGVyIHJlYWRzIFwiP1wiIGZvciBkaXNjb25uZWN0ZWQgY29udGFjdHMsIHdoaWNoIGlzIHJlcHJlc2VudGVkIGludGVybmFsbHkgYnkgYSBudWxsXHJcbiAgICAvLyBhc3NpZ25tZW50IHZhbHVlLlxyXG4gICAgLy8gQHB1YmxpYyB7UHJvcGVydHkuPG51bWJlcnxudWxsPn1cclxuICAgIHRoaXMubWVhc3VyZWRWb2x0YWdlUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIG51bGwsIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnbWVhc3VyZWRWb2x0YWdlUHJvcGVydHknICksXHJcbiAgICAgIHVuaXRzOiAnVicsXHJcbiAgICAgIHBoZXRpb1ZhbHVlVHlwZTogTnVsbGFibGVJTyggTnVtYmVySU8gKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFRPRE86IGZhY3RvciBvdXQgc2hhcmVkIGNvZGUgZm9yIHBvc2l0aXZlL25lZ2F0aXZlIHByb2JlXHJcbiAgICAvLyBUT0RPOiBXaHkgbm90IGFuIGVudW0/XHJcbiAgICAvLyBAcHJpdmF0ZSB7UHJvcGVydHkuPFByb2JlVGFyZ2V0Pn0gLSBXaGF0IHRoZSBwb3NpdGl2ZSBwcm9iZSBpcyBjdXJyZW50bHkgdG91Y2hpbmcuIFVwZGF0ZWQgZnJvbSB3aXRoaW4gY29tcHV0ZVZhbHVlIGJlbG93LlxyXG4gICAgdGhpcy5wb3NpdGl2ZVByb2JlVGFyZ2V0UHJvcGVydHkgPSBuZXcgU3RyaW5nUHJvcGVydHkoIFByb2JlVGFyZ2V0Lk5PTkUsIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAncG9zaXRpdmVQcm9iZVRhcmdldFByb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge1Byb3BlcnR5LjxQcm9iZVRhcmdldD59IC0gV2hhdCB0aGUgbmVnYXRpdmUgcHJvYmUgaXMgY3VycmVudGx5IHRvdWNoaW5nLiBVcGRhdGVkIGZyb20gd2l0aGluIGNvbXB1dGVWYWx1ZSBiZWxvdy5cclxuICAgIC8vIFRPRE86IFdoeSBub3QgYW4gZW51bT9cclxuICAgIHRoaXMubmVnYXRpdmVQcm9iZVRhcmdldFByb3BlcnR5ID0gbmV3IFN0cmluZ1Byb3BlcnR5KCBQcm9iZVRhcmdldC5OT05FLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ25lZ2F0aXZlUHJvYmVUYXJnZXRQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuXHJcbiAgICAvLyBAcHVibGljIHtWb2x0bWV0ZXJTaGFwZUNyZWF0b3J9IChyZWFkLW9ubHkpXHJcbiAgICB0aGlzLnNoYXBlQ3JlYXRvciA9IG5ldyBWb2x0bWV0ZXJTaGFwZUNyZWF0b3IoIHRoaXMsIG1vZGVsVmlld1RyYW5zZm9ybSApO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogVXBkYXRlIHRoZSB2YWx1ZSBvZiB0aGUgbWV0ZXIuIENhbGxlZCB3aGVuIG1hbnkgZGlmZmVyZW50IHByb3BlcnRpZXMgY2hhbmdlLlxyXG4gICAgICovXHJcbiAgICBjb25zdCB1cGRhdGVWYWx1ZSA9ICgpID0+IHtcclxuICAgICAgaWYgKCB0aGlzLnZpc2libGVQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICBjb25zdCBwcm9iZXNUb3VjaGluZyA9IHRoaXMucHJvYmVzQXJlVG91Y2hpbmcoKTtcclxuICAgICAgICB0aGlzLnBvc2l0aXZlUHJvYmVUYXJnZXRQcm9wZXJ0eS52YWx1ZSA9IHByb2Jlc1RvdWNoaW5nID8gUHJvYmVUYXJnZXQuT1RIRVJfUFJPQkUgOiB0aGlzLmNpcmN1aXQuZ2V0UHJvYmVUYXJnZXQoIHRoaXMuc2hhcGVDcmVhdG9yLmdldFBvc2l0aXZlUHJvYmVUaXBTaGFwZSgpICk7XHJcbiAgICAgICAgdGhpcy5uZWdhdGl2ZVByb2JlVGFyZ2V0UHJvcGVydHkudmFsdWUgPSBwcm9iZXNUb3VjaGluZyA/IFByb2JlVGFyZ2V0Lk9USEVSX1BST0JFIDogdGhpcy5jaXJjdWl0LmdldFByb2JlVGFyZ2V0KCB0aGlzLnNoYXBlQ3JlYXRvci5nZXROZWdhdGl2ZVByb2JlVGlwU2hhcGUoKSApO1xyXG4gICAgICAgIHRoaXMubWVhc3VyZWRWb2x0YWdlUHJvcGVydHkudmFsdWUgPSB0aGlzLmNvbXB1dGVWYWx1ZSgpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMubWVhc3VyZWRWb2x0YWdlUHJvcGVydHkudmFsdWUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgdXBkYXRlVmFsdWUoKTtcclxuXHJcbiAgICAvLyBTaW5jZSB3ZSBkb24ndCB1cGRhdGUgd2hlbiBub3QgdmlzaWJsZSxcclxuICAgIHRoaXMudmlzaWJsZVByb3BlcnR5LmxhenlMaW5rKCB1cGRhdGVWYWx1ZSApO1xyXG5cclxuICAgIC8vIFVwZGF0ZSB2b2x0YWdlIHJlYWRpbmcgaWYgcGxhdGUgdm9sdGFnZSBjaGFuZ2VzXHJcbiAgICBjaXJjdWl0LmNhcGFjaXRvci5wbGF0ZVZvbHRhZ2VQcm9wZXJ0eS5sYXp5TGluayggdXBkYXRlVmFsdWUgKTtcclxuXHJcbiAgICAvLyBVcGRhdGUgcmVhZGluZyB3aGVuIHRoZSBwcm9iZXMgbW92ZVxyXG4gICAgTXVsdGlsaW5rLmxhenlNdWx0aWxpbmsoIFsgdGhpcy5uZWdhdGl2ZVByb2JlUG9zaXRpb25Qcm9wZXJ0eSwgdGhpcy5wb3NpdGl2ZVByb2JlUG9zaXRpb25Qcm9wZXJ0eSBdLCB1cGRhdGVWYWx1ZSApO1xyXG5cclxuICAgIC8vIFVwZGF0ZSBhbGwgc2VnbWVudHMgYW5kIHRoZSBwbGF0ZSB2b2x0YWdlcyB3aGVuIGNhcGFjaXRvciBwbGF0ZSBnZW9tZXRyeSBjaGFuZ2VzLiBDYXBhY2l0b3IgbWF5IG5vdCBleGlzdCB5ZXQuXHJcbiAgICBjaXJjdWl0LmNhcGFjaXRvci5wbGF0ZVNlcGFyYXRpb25Qcm9wZXJ0eS5sYXp5TGluayggdXBkYXRlVmFsdWUgKTtcclxuXHJcbiAgICAvLyBVcGRhdGUgdGhlIHBsYXRlIHZvbHRhZ2Ugd2hlbiB0aGUgY2FwYWNpdG9yIHBsYXRlIHNpemUgY2hhbmdlcy4gQ2FwYWNpdG9yIG1heSBub3QgZXhpc3QgeWV0LlxyXG4gICAgY2lyY3VpdC5jYXBhY2l0b3IucGxhdGVTaXplUHJvcGVydHkubGF6eUxpbmsoIHVwZGF0ZVZhbHVlICk7XHJcblxyXG4gICAgLy8gdXBkYXRlIHRoZSB2YWx1ZSB3aGVuIHRoZSBjaXJjdWl0IGNvbm5lY3Rpb24gcHJvcGVydHkgY2hhbmdlc1xyXG4gICAgY2lyY3VpdC5jaXJjdWl0Q29ubmVjdGlvblByb3BlcnR5LmxhenlMaW5rKCB1cGRhdGVWYWx1ZSApO1xyXG5cclxuICAgIC8vIFVwZGF0ZSB3aGVuIGJhdHRlcnkgdm9sdGFnZSBjaGFuZ2VzXHJcbiAgICBjaXJjdWl0LmJhdHRlcnkudm9sdGFnZVByb3BlcnR5LmxhenlMaW5rKCB1cGRhdGVWYWx1ZSApO1xyXG5cclxuICAgIC8vIFVwZGF0ZSB3aGVuIHRoZSBzd2l0Y2ggaXMgbW92aW5nLiBOT1RFOiBvbmx5IGxpc3RlbmluZyB0byB0aGUgdG9wLCBzaW5jZSBib3RoIGdldCBhY3RpdmF0ZWQgYXQgdGhlIHNhbWUgdGltZS5cclxuICAgIGNpcmN1aXQuY2FwYWNpdG9yLnRvcENpcmN1aXRTd2l0Y2guYW5nbGVQcm9wZXJ0eS5sYXp5TGluayggdXBkYXRlVmFsdWUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbXB1dGVzIHRoZSB2b2x0YWdlIHJlYWRpbmcgZm9yIHRoaXMgdm9sdG1ldGVyIChudWxsIGNvcnJlc3BvbmRzIHRvIGEgPyBvbiB0aGUgdm9sdG1ldGVyKVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfG51bGx9IC0gdm9sdGFnZSBkaWZmZXJlbmNlIGJldHdlZW4gcHJvYmVzXHJcbiAgICovXHJcbiAgY29tcHV0ZVZhbHVlKCkge1xyXG4gICAgY29uc3QgcG9zaXRpdmVQcm9iZVRhcmdldCA9IHRoaXMucG9zaXRpdmVQcm9iZVRhcmdldFByb3BlcnR5LnZhbHVlO1xyXG4gICAgY29uc3QgbmVnYXRpdmVQcm9iZVRhcmdldCA9IHRoaXMubmVnYXRpdmVQcm9iZVRhcmdldFByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgIC8vIElmIG9uZSBwcm9iZSBpcyBkaXNjb25uZWN0ZWQsIHJldHVybiBudWxsLlxyXG4gICAgaWYgKCBwb3NpdGl2ZVByb2JlVGFyZ2V0ID09PSBQcm9iZVRhcmdldC5OT05FIHx8IG5lZ2F0aXZlUHJvYmVUYXJnZXQgPT09IFByb2JlVGFyZ2V0Lk5PTkUgKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNhbml0eSBjaGVjayBmb3IgYm90aCBhcyBcIm90aGVyIHByb2JlXCJcclxuICAgIGlmICggcG9zaXRpdmVQcm9iZVRhcmdldCA9PT0gUHJvYmVUYXJnZXQuT1RIRVJfUFJPQkUgfHwgbmVnYXRpdmVQcm9iZVRhcmdldCA9PT0gUHJvYmVUYXJnZXQuT1RIRVJfUFJPQkUgKSB7XHJcbiAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBwb3NpdGl2ZUNpcmN1aXRQb3NpdGlvbiA9IFByb2JlVGFyZ2V0LmdldENpcmN1aXRQb3NpdGlvbiggcG9zaXRpdmVQcm9iZVRhcmdldCApO1xyXG4gICAgbGV0IG5lZ2F0aXZlQ2lyY3VpdFBvc2l0aW9uID0gUHJvYmVUYXJnZXQuZ2V0Q2lyY3VpdFBvc2l0aW9uKCBuZWdhdGl2ZVByb2JlVGFyZ2V0ICk7XHJcblxyXG4gICAgLy8gSWYgdGhlIHByb2JlcyBhcmUgdG91Y2hpbmcgdGhlIHNhbWUgcG9zaXRpb24sIHRoZXJlIHNob3VsZCBiZSBubyB2b2x0YWdlIGNoYW5nZS4gV2UgY2hlY2sgaGVyZSBmaXJzdCBzbyB3ZSBjYW5cclxuICAgIC8vIGJhaWwgb3V0IGFuZCBhdm9pZCBhbnkgbW9yZSB3b3JrIChldmVuIHRob3VnaCB3ZSBkbyBhIHZlcnkgc2ltaWxhciBjaGVjayBiZWxvdykuXHJcbiAgICBpZiAoIHBvc2l0aXZlQ2lyY3VpdFBvc2l0aW9uID09PSBuZWdhdGl2ZUNpcmN1aXRQb3NpdGlvbiApIHtcclxuICAgICAgcmV0dXJuIDA7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2xvc2VkIGNpcmN1aXQgYmV0d2VlbiBiYXR0ZXJ5IGFuZCBjYXBhY2l0b3JcclxuICAgIGlmICggdGhpcy5jaXJjdWl0LmNpcmN1aXRDb25uZWN0aW9uUHJvcGVydHkudmFsdWUgPT09IENpcmN1aXRTdGF0ZS5CQVRURVJZX0NPTk5FQ1RFRCApIHtcclxuICAgICAgLy8gU2hpZnQgY2FwYWNpdG9yIHBvc2l0aW9ucyB0byBiYXR0ZXJ5IHBvc2l0aW9ucyAoc2luY2Ugd2UgdXNlIHRoZSB0b3RhbCB2b2x0YWdlIGZvciBhbnl0aGluZyBjb25uZWN0ZWQgdG8gdGhlIGNhcGFjaXRvcilcclxuICAgICAgaWYgKCBDaXJjdWl0UG9zaXRpb24uaXNDYXBhY2l0b3IoIHBvc2l0aXZlQ2lyY3VpdFBvc2l0aW9uICkgKSB7XHJcbiAgICAgICAgcG9zaXRpdmVDaXJjdWl0UG9zaXRpb24gPSBDaXJjdWl0UG9zaXRpb24uaXNUb3AoIHBvc2l0aXZlQ2lyY3VpdFBvc2l0aW9uICkgPyBDaXJjdWl0UG9zaXRpb24uQkFUVEVSWV9UT1AgOiBDaXJjdWl0UG9zaXRpb24uQkFUVEVSWV9CT1RUT007XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCBDaXJjdWl0UG9zaXRpb24uaXNDYXBhY2l0b3IoIG5lZ2F0aXZlQ2lyY3VpdFBvc2l0aW9uICkgKSB7XHJcbiAgICAgICAgbmVnYXRpdmVDaXJjdWl0UG9zaXRpb24gPSBDaXJjdWl0UG9zaXRpb24uaXNUb3AoIG5lZ2F0aXZlQ2lyY3VpdFBvc2l0aW9uICkgPyBDaXJjdWl0UG9zaXRpb24uQkFUVEVSWV9UT1AgOiBDaXJjdWl0UG9zaXRpb24uQkFUVEVSWV9CT1RUT007XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIENsb3NlZCBjaXJjdWl0IGJldHdlZW4gbGlnaHQgYnVsYiBhbmQgY2FwYWNpdG9yXHJcbiAgICBlbHNlIGlmICggdGhpcy5jaXJjdWl0LmNpcmN1aXRDb25uZWN0aW9uUHJvcGVydHkudmFsdWUgPT09IENpcmN1aXRTdGF0ZS5MSUdIVF9CVUxCX0NPTk5FQ1RFRCApIHtcclxuICAgICAgLy8gU2hpZnQgbGlnaHQgYnVsYiBwb3NpdGlvbnMgdG8gY2FwYWNpdG9yIHBvc2l0aW9ucyAoc2luY2Ugd2UgdXNlIHRoZSBjYXBhY2l0b3IgcGxhdGUgdm9sdGFnZSBmb3IgYW55dGhpbmcgY29ubmVjdGVkIHRvIHRoZSBsaWdodCBidWxiKVxyXG4gICAgICBpZiAoIENpcmN1aXRQb3NpdGlvbi5pc0xpZ2h0QnVsYiggcG9zaXRpdmVDaXJjdWl0UG9zaXRpb24gKSApIHtcclxuICAgICAgICBwb3NpdGl2ZUNpcmN1aXRQb3NpdGlvbiA9IENpcmN1aXRQb3NpdGlvbi5pc1RvcCggcG9zaXRpdmVDaXJjdWl0UG9zaXRpb24gKSA/IENpcmN1aXRQb3NpdGlvbi5DQVBBQ0lUT1JfVE9QIDogQ2lyY3VpdFBvc2l0aW9uLkNBUEFDSVRPUl9CT1RUT007XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCBDaXJjdWl0UG9zaXRpb24uaXNMaWdodEJ1bGIoIG5lZ2F0aXZlQ2lyY3VpdFBvc2l0aW9uICkgKSB7XHJcbiAgICAgICAgbmVnYXRpdmVDaXJjdWl0UG9zaXRpb24gPSBDaXJjdWl0UG9zaXRpb24uaXNUb3AoIG5lZ2F0aXZlQ2lyY3VpdFBvc2l0aW9uICkgPyBDaXJjdWl0UG9zaXRpb24uQ0FQQUNJVE9SX1RPUCA6IENpcmN1aXRQb3NpdGlvbi5DQVBBQ0lUT1JfQk9UVE9NO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgdGhlIHByb2JlcyBhcmUgdG91Y2hpbmcgdGhlIHNhbWUgcG9zaXRpb24sIHRoZXJlIHNob3VsZCBiZSBubyB2b2x0YWdlIGNoYW5nZS4gVGhpcyBpcyBkaWZmZXJlbnQgZnJvbSB0aGVcclxuICAgIC8vIGFib3ZlIGNoZWNrICh3aXRoIHRoZSBzYW1lIGNvZGUpIHNpbmNlIHdlIGhhdmUgcG90ZW50aWFsbHkgcmVtYXBwZWQgc29tZSBvZiB0aGUgY2lyY3VpdCBwb3NpdGlvbnMuXHJcbiAgICBpZiAoIHBvc2l0aXZlQ2lyY3VpdFBvc2l0aW9uID09PSBuZWdhdGl2ZUNpcmN1aXRQb3NpdGlvbiApIHtcclxuICAgICAgcmV0dXJuIDA7XHJcbiAgICB9XHJcbiAgICAvLyBJZiBwcm9iZXMgYXJlIG9uIG9wcG9zaXRlIHNpZGVzIG9mIHRoZSBiYXR0ZXJ5XHJcbiAgICBlbHNlIGlmICggQ2lyY3VpdFBvc2l0aW9uLmlzQmF0dGVyeSggcG9zaXRpdmVDaXJjdWl0UG9zaXRpb24gKSAmJiBDaXJjdWl0UG9zaXRpb24uaXNCYXR0ZXJ5KCBuZWdhdGl2ZUNpcmN1aXRQb3NpdGlvbiApICkge1xyXG4gICAgICByZXR1cm4gKCBDaXJjdWl0UG9zaXRpb24uaXNUb3AoIHBvc2l0aXZlQ2lyY3VpdFBvc2l0aW9uICkgPyAxIDogLTEgKSAqIHRoaXMuY2lyY3VpdC5nZXRUb3RhbFZvbHRhZ2UoKTtcclxuICAgIH1cclxuICAgIC8vIElmIHByb2JlcyBhcmUgb24gb3Bwb3NpdGUgc2lkZXMgb2YgdGhlIGNhcGFjaXRvciAoYW5kIGNhbid0IGJlIGNvbm5lY3RlZCB0byB0aGUgYmF0dGVyeSwgc2VlIGFib3ZlKVxyXG4gICAgZWxzZSBpZiAoIENpcmN1aXRQb3NpdGlvbi5pc0NhcGFjaXRvciggcG9zaXRpdmVDaXJjdWl0UG9zaXRpb24gKSAmJiBDaXJjdWl0UG9zaXRpb24uaXNDYXBhY2l0b3IoIG5lZ2F0aXZlQ2lyY3VpdFBvc2l0aW9uICkgKSB7XHJcbiAgICAgIHJldHVybiAoIENpcmN1aXRQb3NpdGlvbi5pc1RvcCggcG9zaXRpdmVDaXJjdWl0UG9zaXRpb24gKSA/IDEgOiAtMSApICogdGhpcy5jaXJjdWl0LmdldENhcGFjaXRvclBsYXRlVm9sdGFnZSgpO1xyXG4gICAgfVxyXG4gICAgLy8gSWYgcHJvYmVzIGFyZSBvbiBvcHBvc2l0ZSBzaWRlcyBvZiB0aGUgbGlnaHQgYnVsYiAoYW5kIGNhbid0IGJlIGNvbm5lY3RlZCB0byB0aGUgY2FwYWNpdG9yLCBzZWUgYWJvdmUpXHJcbiAgICBlbHNlIGlmICggQ2lyY3VpdFBvc2l0aW9uLmlzTGlnaHRCdWxiKCBwb3NpdGl2ZUNpcmN1aXRQb3NpdGlvbiApICYmIENpcmN1aXRQb3NpdGlvbi5pc0xpZ2h0QnVsYiggbmVnYXRpdmVDaXJjdWl0UG9zaXRpb24gKSApIHtcclxuICAgICAgcmV0dXJuIDA7XHJcbiAgICB9XHJcbiAgICAvLyBQcm9iZXMgYXJlIG5vdCB0b3VjaGluZyBhIGNvbm5lY3RlZCBjb21wb25lbnRcclxuICAgIGVsc2Uge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFByb2JlcyBhcmUgdG91Y2hpbmcgaWYgdGhlaXIgdGlwcyBpbnRlcnNlY3QuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAgICovXHJcbiAgcHJvYmVzQXJlVG91Y2hpbmcoKSB7XHJcbiAgICBjb25zdCBwb3NTaGFwZSA9IHRoaXMuc2hhcGVDcmVhdG9yLmdldFBvc2l0aXZlUHJvYmVUaXBTaGFwZSgpO1xyXG4gICAgY29uc3QgbmVnU2hhcGUgPSB0aGlzLnNoYXBlQ3JlYXRvci5nZXROZWdhdGl2ZVByb2JlVGlwU2hhcGUoKTtcclxuXHJcbiAgICByZXR1cm4gcG9zU2hhcGUuYm91bmRzLmludGVyc2VjdHNCb3VuZHMoIG5lZ1NoYXBlLmJvdW5kcyApICYmXHJcbiAgICAgICAgICAgcG9zU2hhcGUuc2hhcGVJbnRlcnNlY3Rpb24oIG5lZ1NoYXBlICkuZ2V0Tm9ub3ZlcmxhcHBpbmdBcmVhKCkgPiAwO1xyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIHJlc2V0KCkge1xyXG4gICAgdGhpcy5pc0RyYWdnZWRQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5ib2R5UG9zaXRpb25Qcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5wb3NpdGl2ZVByb2JlUG9zaXRpb25Qcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5uZWdhdGl2ZVByb2JlUG9zaXRpb25Qcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5tZWFzdXJlZFZvbHRhZ2VQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5wb3NpdGl2ZVByb2JlVGFyZ2V0UHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMubmVnYXRpdmVQcm9iZVRhcmdldFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgfVxyXG59XHJcblxyXG5jYXBhY2l0b3JMYWJCYXNpY3MucmVnaXN0ZXIoICdWb2x0bWV0ZXInLCBWb2x0bWV0ZXIgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFZvbHRtZXRlcjtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sMkNBQTJDO0FBQ3ZFLE9BQU9DLFNBQVMsTUFBTSxxQ0FBcUM7QUFDM0QsT0FBT0MsUUFBUSxNQUFNLG9DQUFvQztBQUN6RCxPQUFPQyxjQUFjLE1BQU0sMENBQTBDO0FBQ3JFLE9BQU9DLE9BQU8sTUFBTSxrQ0FBa0M7QUFDdEQsT0FBT0MsVUFBVSxNQUFNLHFDQUFxQztBQUM1RCxPQUFPQyxPQUFPLE1BQU0sa0NBQWtDO0FBQ3RELE9BQU9DLDJCQUEyQixNQUFNLHlFQUF5RTtBQUNqSCxPQUFPQyxVQUFVLE1BQU0sOENBQThDO0FBQ3JFLE9BQU9DLFFBQVEs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