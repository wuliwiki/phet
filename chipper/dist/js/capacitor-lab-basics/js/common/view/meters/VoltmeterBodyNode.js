// Copyright 2015-2023, University of Colorado Boulder

/**
 * Body of the voltmeter.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import DynamicProperty from '../../../../../axon/js/DynamicProperty.js';
import Property from '../../../../../axon/js/Property.js';
import Bounds2 from '../../../../../dot/js/Bounds2.js';
import Utils from '../../../../../dot/js/Utils.js';
import Vector2 from '../../../../../dot/js/Vector2.js';
import StringUtils from '../../../../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../../../../scenery-phet/js/PhetFont.js';
import { DragListener, Image, Node, Rectangle, Text } from '../../../../../scenery/js/imports.js';
import voltmeterBody_png from '../../../../images/voltmeterBody_png.js';
import capacitorLabBasics from '../../../capacitorLabBasics.js';
import CapacitorLabBasicsStrings from '../../../CapacitorLabBasicsStrings.js';

// digital display
const DISPLAY_FONT = new PhetFont(18);

// title display
const TITLE_FONT = new PhetFont({
  size: 20
});
const voltageString = CapacitorLabBasicsStrings.voltage;
const voltsPatternString = CapacitorLabBasicsStrings.voltsPattern;
const voltsUnknownString = CapacitorLabBasicsStrings.volts.unknown;
class VoltmeterBodyNode extends Node {
  /**
   * @param {Voltmeter} voltmeter - the voltmeter model
   * @param {YawPitchModelViewTransform3} modelViewTransform
   * @param {Property.<boolean>} isDraggedProperty
   * @param {Tandem} tandem
   */
  constructor(voltmeter, modelViewTransform, isDraggedProperty, tandem) {
    super();
    this.cursor = 'pointer';

    // @public {Property.<Vector3>]}
    this.bodyPositionProperty = voltmeter.bodyPositionProperty;
    const readoutAdjustmentY = 15;

    // body of the meter
    const imageNode = new Image(voltmeterBody_png, {
      scale: 0.336,
      hitTestPixels: true
    });
    this.addChild(imageNode);

    // text label
    const labelText = new Text(voltageString, {
      font: TITLE_FONT,
      maxWidth: imageNode.width / 2
    });
    labelText.center = new Vector2(imageNode.width / 2, imageNode.height / 3 + readoutAdjustmentY);
    this.addChild(labelText);
    const valueString = StringUtils.fillIn(voltsPatternString, {
      value: voltmeter.measuredVoltageProperty.value
    });
    const valueText = new Text(valueString, {
      font: DISPLAY_FONT,
      maxWidth: imageNode.width * 0.4
    });

    // add the display to the
    // display area for the value
    const backgroundRectWidth = imageNode.width / 2;
    const backgroundRectHeight = valueText.height + 5;
    const backgroundRect = new Rectangle(new Bounds2(0, 0, backgroundRectWidth, backgroundRectHeight), 5, 5, {
      lineWidth: 1,
      fill: 'white',
      stroke: 'black'
    });
    const textCenter = new Vector2(this.center.x, this.center.y + readoutAdjustmentY);
    backgroundRect.center = textCenter;
    valueText.center = textCenter;
    this.addChild(backgroundRect);
    this.addChild(valueText);

    // offsets for connection points of wires that attach probes to body, determined by visual inspection.  If the
    // voltmeter body images ever changes, these will have to be changed as well.
    const imageBounds = imageNode.bounds;
    const probeOffset = 0.056;
    this.positiveConnectionOffset = new Vector2((0.5 - probeOffset) * imageBounds.width, 0.875 * imageBounds.maxY); // @public bottom left
    this.negativeConnectionOffset = new Vector2((0.5 + probeOffset) * imageBounds.width, 0.875 * imageBounds.maxY); // @public bottom right

    // update value
    voltmeter.measuredVoltageProperty.link(value => {
      this.setValueText(valueText, value);
      valueText.center = backgroundRect.center;
    });

    // update position with model
    voltmeter.bodyPositionProperty.link(bodyPosition => {
      if (bodyPosition instanceof Vector2) {
        this.translation = modelViewTransform.modelToViewPosition(bodyPosition.toVector3());
      } else {
        this.translation = modelViewTransform.modelToViewPosition(bodyPosition);
      }
    });

    // voltmeter is restricted by bounds in model coordinates for `handler, adjusted by dimensions
    // of the voltmeter body
    const adjustedViewBounds = new Bounds2(0, 0, voltmeter.dragBounds.maxX - imageNode.width, voltmeter.dragBounds.maxY - imageNode.height);
    const bodyDragBounds = modelViewTransform.viewToModelBounds(adjustedViewBounds);
    const body2DProperty = new DynamicProperty(new Property(voltmeter.bodyPositionProperty), {
      bidirectional: true,
      valueComparisonStrategy: 'equalsFunction',
      map: vector3 => vector3.toVector2(),
      inverseMap: vector2 => vector2.toVector3()
    });
    this.dragListener = new DragListener({
      positionProperty: body2DProperty,
      attach: true,
      useParentOffset: true,
      tandem: tandem.createTandem('dragListener'),
      dragBoundsProperty: new Property(bodyDragBounds),
      transform: modelViewTransform.modelToViewTransform2D,
      start: () => {
        isDraggedProperty.set(true);
      },
      end: () => {
        isDraggedProperty.set(false);
      }
    });
    this.addInputListener(this.dragListener);
  }

  /**
   * Set the text for the display value, formatting the units and number of decimal places.
   *
   * @param {Text} valueText
   * @param {number} value
   * @public
   */
  setValueText(valueText, value) {
    if (value === null) {
      valueText.setString(voltsUnknownString);
    } else {
      const fixedValue = Utils.toFixed(value, 3);
      valueText.setString(StringUtils.fillIn(voltsPatternString, {
        value: fixedValue
      }));
    }
  }
}
capacitorLabBasics.register('VoltmeterBodyNode', VoltmeterBodyNode);
export default VoltmeterBodyNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEeW5hbWljUHJvcGVydHkiLCJQcm9wZXJ0eSIsIkJvdW5kczIiLCJVdGlscyIsIlZlY3RvcjIiLCJTdHJpbmdVdGlscyIsIlBoZXRGb250IiwiRHJhZ0xpc3RlbmVyIiwiSW1hZ2UiLCJOb2RlIiwiUmVjdGFuZ2xlIiwiVGV4dCIsInZvbHRtZXRlckJvZHlfcG5nIiwiY2FwYWNpdG9yTGFiQmFzaWNzIiwiQ2FwYWNpdG9yTGFiQmFzaWNzU3RyaW5ncyIsIkRJU1BMQVlfRk9OVCIsIlRJVExFX0ZPTlQiLCJzaXplIiwidm9sdGFnZVN0cmluZyIsInZvbHRhZ2UiLCJ2b2x0c1BhdHRlcm5TdHJpbmciLCJ2b2x0c1BhdHRlcm4iLCJ2b2x0c1Vua25vd25TdHJpbmciLCJ2b2x0cyIsInVua25vd24iLCJWb2x0bWV0ZXJCb2R5Tm9kZSIsImNvbnN0cnVjdG9yIiwidm9sdG1ldGVyIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwiaXNEcmFnZ2VkUHJvcGVydHkiLCJ0YW5kZW0iLCJjdXJzb3IiLCJib2R5UG9zaXRpb25Qcm9wZXJ0eSIsInJlYWRvdXRBZGp1c3RtZW50WSIsImltYWdlTm9kZSIsInNjYWxlIiwiaGl0VGVzdFBpeGVscyIsImFkZENoaWxkIiwibGFiZWxUZXh0IiwiZm9udCIsIm1heFdpZHRoIiwid2lkdGgiLCJjZW50ZXIiLCJoZWlnaHQiLCJ2YWx1ZVN0cmluZyIsImZpbGxJbiIsInZhbHVlIiwibWVhc3VyZWRWb2x0YWdlUHJvcGVydHkiLCJ2YWx1ZVRleHQiLCJiYWNrZ3JvdW5kUmVjdFdpZHRoIiwiYmFja2dyb3VuZFJlY3RIZWlnaHQiLCJiYWNrZ3JvdW5kUmVjdCIsImxpbmVXaWR0aCIsImZpbGwiLCJzdHJva2UiLCJ0ZXh0Q2VudGVyIiwieCIsInkiLCJpbWFnZUJvdW5kcyIsImJvdW5kcyIsInByb2JlT2Zmc2V0IiwicG9zaXRpdmVDb25uZWN0aW9uT2Zmc2V0IiwibWF4WSIsIm5lZ2F0aXZlQ29ubmVjdGlvbk9mZnNldCIsImxpbmsiLCJzZXRWYWx1ZVRleHQiLCJib2R5UG9zaXRpb24iLCJ0cmFuc2xhdGlvbiIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJ0b1ZlY3RvcjMiLCJhZGp1c3RlZFZpZXdCb3VuZHMiLCJkcmFnQm91bmRzIiwibWF4WCIsImJvZHlEcmFnQm91bmRzIiwidmlld1RvTW9kZWxCb3VuZHMiLCJib2R5MkRQcm9wZXJ0eSIsImJpZGlyZWN0aW9uYWwiLCJ2YWx1ZUNvbXBhcmlzb25TdHJhdGVneSIsIm1hcCIsInZlY3RvcjMiLCJ0b1ZlY3RvcjIiLCJpbnZlcnNlTWFwIiwidmVjdG9yMiIsImRyYWdMaXN0ZW5lciIsInBvc2l0aW9uUHJvcGVydHkiLCJhdHRhY2giLCJ1c2VQYXJlbnRPZmZzZXQiLCJjcmVhdGVUYW5kZW0iLCJkcmFnQm91bmRzUHJvcGVydHkiLCJ0cmFuc2Zvcm0iLCJtb2RlbFRvVmlld1RyYW5zZm9ybTJEIiwic3RhcnQiLCJzZXQiLCJlbmQiLCJhZGRJbnB1dExpc3RlbmVyIiwic2V0U3RyaW5nIiwiZml4ZWRWYWx1ZSIsInRvRml4ZWQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlZvbHRtZXRlckJvZHlOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEJvZHkgb2YgdGhlIHZvbHRtZXRlci5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmcgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IER5bmFtaWNQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi8uLi9heG9uL2pzL0R5bmFtaWNQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IEJvdW5kczIgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL0JvdW5kczIuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IERyYWdMaXN0ZW5lciwgSW1hZ2UsIE5vZGUsIFJlY3RhbmdsZSwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB2b2x0bWV0ZXJCb2R5X3BuZyBmcm9tICcuLi8uLi8uLi8uLi9pbWFnZXMvdm9sdG1ldGVyQm9keV9wbmcuanMnO1xyXG5pbXBvcnQgY2FwYWNpdG9yTGFiQmFzaWNzIGZyb20gJy4uLy4uLy4uL2NhcGFjaXRvckxhYkJhc2ljcy5qcyc7XHJcbmltcG9ydCBDYXBhY2l0b3JMYWJCYXNpY3NTdHJpbmdzIGZyb20gJy4uLy4uLy4uL0NhcGFjaXRvckxhYkJhc2ljc1N0cmluZ3MuanMnO1xyXG5cclxuLy8gZGlnaXRhbCBkaXNwbGF5XHJcbmNvbnN0IERJU1BMQVlfRk9OVCA9IG5ldyBQaGV0Rm9udCggMTggKTtcclxuXHJcbi8vIHRpdGxlIGRpc3BsYXlcclxuY29uc3QgVElUTEVfRk9OVCA9IG5ldyBQaGV0Rm9udCgge1xyXG4gIHNpemU6IDIwXHJcbn0gKTtcclxuXHJcbmNvbnN0IHZvbHRhZ2VTdHJpbmcgPSBDYXBhY2l0b3JMYWJCYXNpY3NTdHJpbmdzLnZvbHRhZ2U7XHJcbmNvbnN0IHZvbHRzUGF0dGVyblN0cmluZyA9IENhcGFjaXRvckxhYkJhc2ljc1N0cmluZ3Mudm9sdHNQYXR0ZXJuO1xyXG5jb25zdCB2b2x0c1Vua25vd25TdHJpbmcgPSBDYXBhY2l0b3JMYWJCYXNpY3NTdHJpbmdzLnZvbHRzLnVua25vd247XHJcblxyXG5jbGFzcyBWb2x0bWV0ZXJCb2R5Tm9kZSBleHRlbmRzIE5vZGUge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7Vm9sdG1ldGVyfSB2b2x0bWV0ZXIgLSB0aGUgdm9sdG1ldGVyIG1vZGVsXHJcbiAgICogQHBhcmFtIHtZYXdQaXRjaE1vZGVsVmlld1RyYW5zZm9ybTN9IG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPGJvb2xlYW4+fSBpc0RyYWdnZWRQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7VGFuZGVtfSB0YW5kZW1cclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvciggdm9sdG1ldGVyLCBtb2RlbFZpZXdUcmFuc2Zvcm0sIGlzRHJhZ2dlZFByb3BlcnR5LCB0YW5kZW0gKSB7XHJcblxyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICB0aGlzLmN1cnNvciA9ICdwb2ludGVyJztcclxuXHJcbiAgICAvLyBAcHVibGljIHtQcm9wZXJ0eS48VmVjdG9yMz5dfVxyXG4gICAgdGhpcy5ib2R5UG9zaXRpb25Qcm9wZXJ0eSA9IHZvbHRtZXRlci5ib2R5UG9zaXRpb25Qcm9wZXJ0eTtcclxuXHJcbiAgICBjb25zdCByZWFkb3V0QWRqdXN0bWVudFkgPSAxNTtcclxuXHJcbiAgICAvLyBib2R5IG9mIHRoZSBtZXRlclxyXG4gICAgY29uc3QgaW1hZ2VOb2RlID0gbmV3IEltYWdlKCB2b2x0bWV0ZXJCb2R5X3BuZywge1xyXG4gICAgICBzY2FsZTogMC4zMzYsXHJcbiAgICAgIGhpdFRlc3RQaXhlbHM6IHRydWVcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGltYWdlTm9kZSApO1xyXG5cclxuICAgIC8vIHRleHQgbGFiZWxcclxuICAgIGNvbnN0IGxhYmVsVGV4dCA9IG5ldyBUZXh0KCB2b2x0YWdlU3RyaW5nLCB7XHJcbiAgICAgIGZvbnQ6IFRJVExFX0ZPTlQsXHJcbiAgICAgIG1heFdpZHRoOiBpbWFnZU5vZGUud2lkdGggLyAyXHJcbiAgICB9ICk7XHJcbiAgICBsYWJlbFRleHQuY2VudGVyID0gbmV3IFZlY3RvcjIoIGltYWdlTm9kZS53aWR0aCAvIDIsIGltYWdlTm9kZS5oZWlnaHQgLyAzICsgcmVhZG91dEFkanVzdG1lbnRZICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBsYWJlbFRleHQgKTtcclxuXHJcbiAgICBjb25zdCB2YWx1ZVN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggdm9sdHNQYXR0ZXJuU3RyaW5nLCB7XHJcbiAgICAgIHZhbHVlOiB2b2x0bWV0ZXIubWVhc3VyZWRWb2x0YWdlUHJvcGVydHkudmFsdWVcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCB2YWx1ZVRleHQgPSBuZXcgVGV4dCggdmFsdWVTdHJpbmcsIHtcclxuICAgICAgZm9udDogRElTUExBWV9GT05ULFxyXG4gICAgICBtYXhXaWR0aDogaW1hZ2VOb2RlLndpZHRoICogMC40XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYWRkIHRoZSBkaXNwbGF5IHRvIHRoZVxyXG4gICAgLy8gZGlzcGxheSBhcmVhIGZvciB0aGUgdmFsdWVcclxuICAgIGNvbnN0IGJhY2tncm91bmRSZWN0V2lkdGggPSBpbWFnZU5vZGUud2lkdGggLyAyO1xyXG4gICAgY29uc3QgYmFja2dyb3VuZFJlY3RIZWlnaHQgPSB2YWx1ZVRleHQuaGVpZ2h0ICsgNTtcclxuICAgIGNvbnN0IGJhY2tncm91bmRSZWN0ID0gbmV3IFJlY3RhbmdsZSggbmV3IEJvdW5kczIoIDAsIDAsIGJhY2tncm91bmRSZWN0V2lkdGgsIGJhY2tncm91bmRSZWN0SGVpZ2h0ICksIDUsIDUsIHtcclxuICAgICAgbGluZVdpZHRoOiAxLFxyXG4gICAgICBmaWxsOiAnd2hpdGUnLFxyXG4gICAgICBzdHJva2U6ICdibGFjaydcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IHRleHRDZW50ZXIgPSBuZXcgVmVjdG9yMiggdGhpcy5jZW50ZXIueCwgdGhpcy5jZW50ZXIueSArIHJlYWRvdXRBZGp1c3RtZW50WSApO1xyXG4gICAgYmFja2dyb3VuZFJlY3QuY2VudGVyID0gdGV4dENlbnRlcjtcclxuICAgIHZhbHVlVGV4dC5jZW50ZXIgPSB0ZXh0Q2VudGVyO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggYmFja2dyb3VuZFJlY3QgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHZhbHVlVGV4dCApO1xyXG5cclxuICAgIC8vIG9mZnNldHMgZm9yIGNvbm5lY3Rpb24gcG9pbnRzIG9mIHdpcmVzIHRoYXQgYXR0YWNoIHByb2JlcyB0byBib2R5LCBkZXRlcm1pbmVkIGJ5IHZpc3VhbCBpbnNwZWN0aW9uLiAgSWYgdGhlXHJcbiAgICAvLyB2b2x0bWV0ZXIgYm9keSBpbWFnZXMgZXZlciBjaGFuZ2VzLCB0aGVzZSB3aWxsIGhhdmUgdG8gYmUgY2hhbmdlZCBhcyB3ZWxsLlxyXG4gICAgY29uc3QgaW1hZ2VCb3VuZHMgPSBpbWFnZU5vZGUuYm91bmRzO1xyXG4gICAgY29uc3QgcHJvYmVPZmZzZXQgPSAwLjA1NjtcclxuICAgIHRoaXMucG9zaXRpdmVDb25uZWN0aW9uT2Zmc2V0ID0gbmV3IFZlY3RvcjIoICggMC41IC0gcHJvYmVPZmZzZXQgKSAqIGltYWdlQm91bmRzLndpZHRoLCAwLjg3NSAqIGltYWdlQm91bmRzLm1heFkgKTsgLy8gQHB1YmxpYyBib3R0b20gbGVmdFxyXG4gICAgdGhpcy5uZWdhdGl2ZUNvbm5lY3Rpb25PZmZzZXQgPSBuZXcgVmVjdG9yMiggKCAwLjUgKyBwcm9iZU9mZnNldCApICogaW1hZ2VCb3VuZHMud2lkdGgsIDAuODc1ICogaW1hZ2VCb3VuZHMubWF4WSApOyAvLyBAcHVibGljIGJvdHRvbSByaWdodFxyXG5cclxuICAgIC8vIHVwZGF0ZSB2YWx1ZVxyXG4gICAgdm9sdG1ldGVyLm1lYXN1cmVkVm9sdGFnZVByb3BlcnR5LmxpbmsoIHZhbHVlID0+IHtcclxuICAgICAgdGhpcy5zZXRWYWx1ZVRleHQoIHZhbHVlVGV4dCwgdmFsdWUgKTtcclxuICAgICAgdmFsdWVUZXh0LmNlbnRlciA9IGJhY2tncm91bmRSZWN0LmNlbnRlcjtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB1cGRhdGUgcG9zaXRpb24gd2l0aCBtb2RlbFxyXG4gICAgdm9sdG1ldGVyLmJvZHlQb3NpdGlvblByb3BlcnR5LmxpbmsoIGJvZHlQb3NpdGlvbiA9PiB7XHJcbiAgICAgIGlmICggYm9keVBvc2l0aW9uIGluc3RhbmNlb2YgVmVjdG9yMiApIHtcclxuICAgICAgICB0aGlzLnRyYW5zbGF0aW9uID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIGJvZHlQb3NpdGlvbi50b1ZlY3RvcjMoKSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMudHJhbnNsYXRpb24gPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggYm9keVBvc2l0aW9uICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB2b2x0bWV0ZXIgaXMgcmVzdHJpY3RlZCBieSBib3VuZHMgaW4gbW9kZWwgY29vcmRpbmF0ZXMgZm9yIGBoYW5kbGVyLCBhZGp1c3RlZCBieSBkaW1lbnNpb25zXHJcbiAgICAvLyBvZiB0aGUgdm9sdG1ldGVyIGJvZHlcclxuICAgIGNvbnN0IGFkanVzdGVkVmlld0JvdW5kcyA9IG5ldyBCb3VuZHMyKCAwLCAwLCB2b2x0bWV0ZXIuZHJhZ0JvdW5kcy5tYXhYIC0gaW1hZ2VOb2RlLndpZHRoLCB2b2x0bWV0ZXIuZHJhZ0JvdW5kcy5tYXhZIC0gaW1hZ2VOb2RlLmhlaWdodCApO1xyXG4gICAgY29uc3QgYm9keURyYWdCb3VuZHMgPSBtb2RlbFZpZXdUcmFuc2Zvcm0udmlld1RvTW9kZWxCb3VuZHMoIGFkanVzdGVkVmlld0JvdW5kcyApO1xyXG5cclxuICAgIGNvbnN0IGJvZHkyRFByb3BlcnR5ID0gbmV3IER5bmFtaWNQcm9wZXJ0eSggbmV3IFByb3BlcnR5KCB2b2x0bWV0ZXIuYm9keVBvc2l0aW9uUHJvcGVydHkgKSwge1xyXG4gICAgICBiaWRpcmVjdGlvbmFsOiB0cnVlLFxyXG4gICAgICB2YWx1ZUNvbXBhcmlzb25TdHJhdGVneTogJ2VxdWFsc0Z1bmN0aW9uJyxcclxuICAgICAgbWFwOiB2ZWN0b3IzID0+IHZlY3RvcjMudG9WZWN0b3IyKCksXHJcbiAgICAgIGludmVyc2VNYXA6IHZlY3RvcjIgPT4gdmVjdG9yMi50b1ZlY3RvcjMoKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5kcmFnTGlzdGVuZXIgPSBuZXcgRHJhZ0xpc3RlbmVyKCB7XHJcbiAgICAgIHBvc2l0aW9uUHJvcGVydHk6IGJvZHkyRFByb3BlcnR5LFxyXG4gICAgICBhdHRhY2g6IHRydWUsXHJcbiAgICAgIHVzZVBhcmVudE9mZnNldDogdHJ1ZSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZHJhZ0xpc3RlbmVyJyApLFxyXG4gICAgICBkcmFnQm91bmRzUHJvcGVydHk6IG5ldyBQcm9wZXJ0eSggYm9keURyYWdCb3VuZHMgKSxcclxuICAgICAgdHJhbnNmb3JtOiBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdUcmFuc2Zvcm0yRCxcclxuICAgICAgc3RhcnQ6ICgpID0+IHtcclxuICAgICAgICBpc0RyYWdnZWRQcm9wZXJ0eS5zZXQoIHRydWUgKTtcclxuICAgICAgfSxcclxuICAgICAgZW5kOiAoKSA9PiB7XHJcbiAgICAgICAgaXNEcmFnZ2VkUHJvcGVydHkuc2V0KCBmYWxzZSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZElucHV0TGlzdGVuZXIoIHRoaXMuZHJhZ0xpc3RlbmVyICk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHRoZSB0ZXh0IGZvciB0aGUgZGlzcGxheSB2YWx1ZSwgZm9ybWF0dGluZyB0aGUgdW5pdHMgYW5kIG51bWJlciBvZiBkZWNpbWFsIHBsYWNlcy5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7VGV4dH0gdmFsdWVUZXh0XHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHNldFZhbHVlVGV4dCggdmFsdWVUZXh0LCB2YWx1ZSApIHtcclxuICAgIGlmICggdmFsdWUgPT09IG51bGwgKSB7XHJcbiAgICAgIHZhbHVlVGV4dC5zZXRTdHJpbmcoIHZvbHRzVW5rbm93blN0cmluZyApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNvbnN0IGZpeGVkVmFsdWUgPSBVdGlscy50b0ZpeGVkKCB2YWx1ZSwgMyApO1xyXG4gICAgICB2YWx1ZVRleHQuc2V0U3RyaW5nKCBTdHJpbmdVdGlscy5maWxsSW4oIHZvbHRzUGF0dGVyblN0cmluZywgeyB2YWx1ZTogZml4ZWRWYWx1ZSB9ICkgKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmNhcGFjaXRvckxhYkJhc2ljcy5yZWdpc3RlciggJ1ZvbHRtZXRlckJvZHlOb2RlJywgVm9sdG1ldGVyQm9keU5vZGUgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFZvbHRtZXRlckJvZHlOb2RlO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sMkNBQTJDO0FBQ3ZFLE9BQU9DLFFBQVEsTUFBTSxvQ0FBb0M7QUFDekQsT0FBT0MsT0FBTyxNQUFNLGtDQUFrQztBQUN0RCxPQUFPQyxLQUFLLE1BQU0sZ0NBQWdDO0FBQ2xELE9BQU9DLE9BQU8sTUFBTSxrQ0FBa0M7QUFDdEQsT0FBT0MsV0FBVyxNQUFNLGtEQUFrRDtBQUMxRSxPQUFPQyxRQUFRLE1BQU0sNENBQTRDO0FBQ2pFLFNBQVNDLFlBQVksRUFBRUMsS0FBSyxFQUFFQyxJQUFJLEVBQUVDLFNBQVMsRUFBRUMsSUFB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