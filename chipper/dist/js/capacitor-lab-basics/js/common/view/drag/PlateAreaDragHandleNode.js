// Copyright 2015-2023, University of Colorado Boulder

/**
 * Drag handle for changing the plate area.
 * Origin is at the end of the dashed line that is farthest from the arrow.
 * Attached to the capacitor's top plate, at front-left corner of top face.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 * @author Andrew Adare (PhET Interactive Simulations)
 */

import Vector2 from '../../../../../dot/js/Vector2.js';
import { Node } from '../../../../../scenery/js/imports.js';
import capacitorLabBasics from '../../../capacitorLabBasics.js';
import CapacitorLabBasicsStrings from '../../../CapacitorLabBasicsStrings.js';
import CLBConstants from '../../CLBConstants.js';
import UnitsUtils from '../../model/util/UnitsUtils.js';
import DragHandleArrowNode from './DragHandleArrowNode.js';
import DragHandleLineNode from './DragHandleLineNode.js';
import DragHandleValueNode from './DragHandleValueNode.js';
import PlateAreaDragHandler from './PlateAreaDragHandler.js';

// constants
// endpoints for a vertical double-headed arrow, this will be rotated to point along the plate's pseudo-3D diagonal
const ARROW_TIP_POSITION = new Vector2(0, 0);
const ARROW_TAIL_POSITION = new Vector2(0, CLBConstants.DRAG_HANDLE_ARROW_LENGTH);
const millimetersSquaredPatternString = CapacitorLabBasicsStrings.millimetersSquaredPattern;
const plateAreaString = CapacitorLabBasicsStrings.plateArea;

// endpoints for a vertical line, this will be rotated to point along the plate's pseudo-3D diagonal
const LINE_LENGTH = 22;
const LINE_START_POSITION = new Vector2(0, 0);
const LINE_END_POSITION = new Vector2(0, LINE_LENGTH);
class PlateAreaDragHandleNode extends Node {
  /**
   * @param {Capacitor} capacitor
   * @param {YawPitchModelViewTransform3} modelViewTransform
   * @param {Range} valueRange
   * @param {Tandem} tandem
   */
  constructor(capacitor, modelViewTransform, valueRange, tandem) {
    super({
      tandem: tandem
    });

    // @private {Capacitor}
    this.capacitor = capacitor;

    // @private {YawPitchModelViewTransform3}
    this.modelViewTransform = modelViewTransform;
    const dragListener = new PlateAreaDragHandler(capacitor, modelViewTransform, valueRange, tandem.createTandem('dragListener'));
    this.addInputListener(dragListener);

    // arrow
    const arrowNode = new DragHandleArrowNode(ARROW_TIP_POSITION, ARROW_TAIL_POSITION, dragListener.isHighlightedProperty, tandem.createTandem('arrowNode'));
    this.cursor = 'pointer';

    // line
    const lineNode = new DragHandleLineNode(LINE_START_POSITION, LINE_END_POSITION);

    // value
    const millimetersSquared = UnitsUtils.metersSquaredToMillimetersSquared(capacitor.getPlateArea());

    // @private {DragHandleValueNode}
    this.valueNode = new DragHandleValueNode(plateAreaString, millimetersSquared, millimetersSquaredPatternString, {
      tandem: tandem.createTandem('valueNode')
    });

    // Make text part of the draggable area
    this.valueNode.mouseArea = this.valueNode.bounds.dilated(0);
    this.valueNode.touchArea = this.valueNode.bounds.dilated(0);

    // rendering order
    this.addChild(lineNode);
    this.addChild(arrowNode);
    this.addChild(this.valueNode);

    // layout: arrow below line, rotate into alignment with top plate's pseudo-3D diagonal
    let x = 0;
    let y = 0;
    const angle = -Math.PI / 2 + modelViewTransform.yaw / 2; // aligned with diagonal of plate surface
    const lineArrowSpacing = 2;
    lineNode.translation = new Vector2(x, y);
    lineNode.rotation = angle;
    x = lineNode.bounds.maxX + lineArrowSpacing;
    y = lineNode.bounds.minY - lineArrowSpacing;
    arrowNode.translation = new Vector2(x, y);
    arrowNode.rotation = angle;
    x = lineNode.bounds.maxX + this.valueNode.bounds.width / 3;
    y = lineNode.bounds.minY - this.valueNode.bounds.height - 14;
    this.valueNode.translation = new Vector2(x, y);

    // watch for model changes
    capacitor.plateSizeProperty.link(() => {
      this.updateDisplay();
      this.updateOffset();
    });
    capacitor.plateSeparationProperty.link(() => {
      this.updateOffset();
    });
  }

  /**
   * Synchronizes the value display with the model.
   * @public
   */
  updateDisplay() {
    const millimetersSquared = UnitsUtils.metersSquaredToMillimetersSquared(this.capacitor.getPlateArea());
    this.valueNode.setValue(millimetersSquared, 0); // Zero decimal places
  }

  /**
   * Attach drag handle to capacitor's top plate, at back-right corner of top face.
   * @public
   */
  updateOffset() {
    const plateSize = this.capacitor.plateSizeProperty.value;
    const x = this.capacitor.position.x + plateSize.width / 2;
    const y = this.capacitor.position.y - this.capacitor.plateSeparationProperty.value / 2 - plateSize.height;
    const z = this.capacitor.position.z + plateSize.depth / 2;
    this.translation = this.modelViewTransform.modelToViewXYZ(x, y, z);
  }
}
capacitorLabBasics.register('PlateAreaDragHandleNode', PlateAreaDragHandleNode);
export default PlateAreaDragHandleNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiTm9kZSIsImNhcGFjaXRvckxhYkJhc2ljcyIsIkNhcGFjaXRvckxhYkJhc2ljc1N0cmluZ3MiLCJDTEJDb25zdGFudHMiLCJVbml0c1V0aWxzIiwiRHJhZ0hhbmRsZUFycm93Tm9kZSIsIkRyYWdIYW5kbGVMaW5lTm9kZSIsIkRyYWdIYW5kbGVWYWx1ZU5vZGUiLCJQbGF0ZUFyZWFEcmFnSGFuZGxlciIsIkFSUk9XX1RJUF9QT1NJVElPTiIsIkFSUk9XX1RBSUxfUE9TSVRJT04iLCJEUkFHX0hBTkRMRV9BUlJPV19MRU5HVEgiLCJtaWxsaW1ldGVyc1NxdWFyZWRQYXR0ZXJuU3RyaW5nIiwibWlsbGltZXRlcnNTcXVhcmVkUGF0dGVybiIsInBsYXRlQXJlYVN0cmluZyIsInBsYXRlQXJlYSIsIkxJTkVfTEVOR1RIIiwiTElORV9TVEFSVF9QT1NJVElPTiIsIkxJTkVfRU5EX1BPU0lUSU9OIiwiUGxhdGVBcmVhRHJhZ0hhbmRsZU5vZGUiLCJjb25zdHJ1Y3RvciIsImNhcGFjaXRvciIsIm1vZGVsVmlld1RyYW5zZm9ybSIsInZhbHVlUmFuZ2UiLCJ0YW5kZW0iLCJkcmFnTGlzdGVuZXIiLCJjcmVhdGVUYW5kZW0iLCJhZGRJbnB1dExpc3RlbmVyIiwiYXJyb3dOb2RlIiwiaXNIaWdobGlnaHRlZFByb3BlcnR5IiwiY3Vyc29yIiwibGluZU5vZGUiLCJtaWxsaW1ldGVyc1NxdWFyZWQiLCJtZXRlcnNTcXVhcmVkVG9NaWxsaW1ldGVyc1NxdWFyZWQiLCJnZXRQbGF0ZUFyZWEiLCJ2YWx1ZU5vZGUiLCJtb3VzZUFyZWEiLCJib3VuZHMiLCJkaWxhdGVkIiwidG91Y2hBcmVhIiwiYWRkQ2hpbGQiLCJ4IiwieSIsImFuZ2xlIiwiTWF0aCIsIlBJIiwieWF3IiwibGluZUFycm93U3BhY2luZyIsInRyYW5zbGF0aW9uIiwicm90YXRpb24iLCJtYXhYIiwibWluWSIsIndpZHRoIiwiaGVpZ2h0IiwicGxhdGVTaXplUHJvcGVydHkiLCJsaW5rIiwidXBkYXRlRGlzcGxheSIsInVwZGF0ZU9mZnNldCIsInBsYXRlU2VwYXJhdGlvblByb3BlcnR5Iiwic2V0VmFsdWUiLCJwbGF0ZVNpemUiLCJ2YWx1ZSIsInBvc2l0aW9uIiwieiIsImRlcHRoIiwibW9kZWxUb1ZpZXdYWVoiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlBsYXRlQXJlYURyYWdIYW5kbGVOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIERyYWcgaGFuZGxlIGZvciBjaGFuZ2luZyB0aGUgcGxhdGUgYXJlYS5cclxuICogT3JpZ2luIGlzIGF0IHRoZSBlbmQgb2YgdGhlIGRhc2hlZCBsaW5lIHRoYXQgaXMgZmFydGhlc3QgZnJvbSB0aGUgYXJyb3cuXHJcbiAqIEF0dGFjaGVkIHRvIHRoZSBjYXBhY2l0b3IncyB0b3AgcGxhdGUsIGF0IGZyb250LWxlZnQgY29ybmVyIG9mIHRvcCBmYWNlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBBbmRyZXcgQWRhcmUgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgeyBOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGNhcGFjaXRvckxhYkJhc2ljcyBmcm9tICcuLi8uLi8uLi9jYXBhY2l0b3JMYWJCYXNpY3MuanMnO1xyXG5pbXBvcnQgQ2FwYWNpdG9yTGFiQmFzaWNzU3RyaW5ncyBmcm9tICcuLi8uLi8uLi9DYXBhY2l0b3JMYWJCYXNpY3NTdHJpbmdzLmpzJztcclxuaW1wb3J0IENMQkNvbnN0YW50cyBmcm9tICcuLi8uLi9DTEJDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgVW5pdHNVdGlscyBmcm9tICcuLi8uLi9tb2RlbC91dGlsL1VuaXRzVXRpbHMuanMnO1xyXG5pbXBvcnQgRHJhZ0hhbmRsZUFycm93Tm9kZSBmcm9tICcuL0RyYWdIYW5kbGVBcnJvd05vZGUuanMnO1xyXG5pbXBvcnQgRHJhZ0hhbmRsZUxpbmVOb2RlIGZyb20gJy4vRHJhZ0hhbmRsZUxpbmVOb2RlLmpzJztcclxuaW1wb3J0IERyYWdIYW5kbGVWYWx1ZU5vZGUgZnJvbSAnLi9EcmFnSGFuZGxlVmFsdWVOb2RlLmpzJztcclxuaW1wb3J0IFBsYXRlQXJlYURyYWdIYW5kbGVyIGZyb20gJy4vUGxhdGVBcmVhRHJhZ0hhbmRsZXIuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbi8vIGVuZHBvaW50cyBmb3IgYSB2ZXJ0aWNhbCBkb3VibGUtaGVhZGVkIGFycm93LCB0aGlzIHdpbGwgYmUgcm90YXRlZCB0byBwb2ludCBhbG9uZyB0aGUgcGxhdGUncyBwc2V1ZG8tM0QgZGlhZ29uYWxcclxuY29uc3QgQVJST1dfVElQX1BPU0lUSU9OID0gbmV3IFZlY3RvcjIoIDAsIDAgKTtcclxuY29uc3QgQVJST1dfVEFJTF9QT1NJVElPTiA9IG5ldyBWZWN0b3IyKCAwLCBDTEJDb25zdGFudHMuRFJBR19IQU5ETEVfQVJST1dfTEVOR1RIICk7XHJcblxyXG5jb25zdCBtaWxsaW1ldGVyc1NxdWFyZWRQYXR0ZXJuU3RyaW5nID0gQ2FwYWNpdG9yTGFiQmFzaWNzU3RyaW5ncy5taWxsaW1ldGVyc1NxdWFyZWRQYXR0ZXJuO1xyXG5jb25zdCBwbGF0ZUFyZWFTdHJpbmcgPSBDYXBhY2l0b3JMYWJCYXNpY3NTdHJpbmdzLnBsYXRlQXJlYTtcclxuXHJcbi8vIGVuZHBvaW50cyBmb3IgYSB2ZXJ0aWNhbCBsaW5lLCB0aGlzIHdpbGwgYmUgcm90YXRlZCB0byBwb2ludCBhbG9uZyB0aGUgcGxhdGUncyBwc2V1ZG8tM0QgZGlhZ29uYWxcclxuY29uc3QgTElORV9MRU5HVEggPSAyMjtcclxuY29uc3QgTElORV9TVEFSVF9QT1NJVElPTiA9IG5ldyBWZWN0b3IyKCAwLCAwICk7XHJcbmNvbnN0IExJTkVfRU5EX1BPU0lUSU9OID0gbmV3IFZlY3RvcjIoIDAsIExJTkVfTEVOR1RIICk7XHJcblxyXG5jbGFzcyBQbGF0ZUFyZWFEcmFnSGFuZGxlTm9kZSBleHRlbmRzIE5vZGUge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7Q2FwYWNpdG9yfSBjYXBhY2l0b3JcclxuICAgKiBAcGFyYW0ge1lhd1BpdGNoTW9kZWxWaWV3VHJhbnNmb3JtM30gbW9kZWxWaWV3VHJhbnNmb3JtXHJcbiAgICogQHBhcmFtIHtSYW5nZX0gdmFsdWVSYW5nZVxyXG4gICAqIEBwYXJhbSB7VGFuZGVtfSB0YW5kZW1cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggY2FwYWNpdG9yLCBtb2RlbFZpZXdUcmFuc2Zvcm0sIHZhbHVlUmFuZ2UsIHRhbmRlbSApIHtcclxuXHJcbiAgICBzdXBlciggeyB0YW5kZW06IHRhbmRlbSB9ICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge0NhcGFjaXRvcn1cclxuICAgIHRoaXMuY2FwYWNpdG9yID0gY2FwYWNpdG9yO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtZYXdQaXRjaE1vZGVsVmlld1RyYW5zZm9ybTN9XHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSA9IG1vZGVsVmlld1RyYW5zZm9ybTtcclxuXHJcbiAgICBjb25zdCBkcmFnTGlzdGVuZXIgPSBuZXcgUGxhdGVBcmVhRHJhZ0hhbmRsZXIoIGNhcGFjaXRvciwgbW9kZWxWaWV3VHJhbnNmb3JtLCB2YWx1ZVJhbmdlLFxyXG4gICAgICB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZHJhZ0xpc3RlbmVyJyApICk7XHJcbiAgICB0aGlzLmFkZElucHV0TGlzdGVuZXIoIGRyYWdMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIGFycm93XHJcbiAgICBjb25zdCBhcnJvd05vZGUgPSBuZXcgRHJhZ0hhbmRsZUFycm93Tm9kZSggQVJST1dfVElQX1BPU0lUSU9OLCBBUlJPV19UQUlMX1BPU0lUSU9OLCBkcmFnTGlzdGVuZXIuaXNIaWdobGlnaHRlZFByb3BlcnR5LFxyXG4gICAgICB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnYXJyb3dOb2RlJyApICk7XHJcblxyXG4gICAgdGhpcy5jdXJzb3IgPSAncG9pbnRlcic7XHJcblxyXG4gICAgLy8gbGluZVxyXG4gICAgY29uc3QgbGluZU5vZGUgPSBuZXcgRHJhZ0hhbmRsZUxpbmVOb2RlKCBMSU5FX1NUQVJUX1BPU0lUSU9OLCBMSU5FX0VORF9QT1NJVElPTiApO1xyXG5cclxuICAgIC8vIHZhbHVlXHJcbiAgICBjb25zdCBtaWxsaW1ldGVyc1NxdWFyZWQgPSBVbml0c1V0aWxzLm1ldGVyc1NxdWFyZWRUb01pbGxpbWV0ZXJzU3F1YXJlZCggY2FwYWNpdG9yLmdldFBsYXRlQXJlYSgpICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge0RyYWdIYW5kbGVWYWx1ZU5vZGV9XHJcbiAgICB0aGlzLnZhbHVlTm9kZSA9IG5ldyBEcmFnSGFuZGxlVmFsdWVOb2RlKCBwbGF0ZUFyZWFTdHJpbmcsIG1pbGxpbWV0ZXJzU3F1YXJlZCwgbWlsbGltZXRlcnNTcXVhcmVkUGF0dGVyblN0cmluZywge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd2YWx1ZU5vZGUnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBNYWtlIHRleHQgcGFydCBvZiB0aGUgZHJhZ2dhYmxlIGFyZWFcclxuICAgIHRoaXMudmFsdWVOb2RlLm1vdXNlQXJlYSA9IHRoaXMudmFsdWVOb2RlLmJvdW5kcy5kaWxhdGVkKCAwICk7XHJcbiAgICB0aGlzLnZhbHVlTm9kZS50b3VjaEFyZWEgPSB0aGlzLnZhbHVlTm9kZS5ib3VuZHMuZGlsYXRlZCggMCApO1xyXG5cclxuICAgIC8vIHJlbmRlcmluZyBvcmRlclxyXG4gICAgdGhpcy5hZGRDaGlsZCggbGluZU5vZGUgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGFycm93Tm9kZSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy52YWx1ZU5vZGUgKTtcclxuXHJcbiAgICAvLyBsYXlvdXQ6IGFycm93IGJlbG93IGxpbmUsIHJvdGF0ZSBpbnRvIGFsaWdubWVudCB3aXRoIHRvcCBwbGF0ZSdzIHBzZXVkby0zRCBkaWFnb25hbFxyXG4gICAgbGV0IHggPSAwO1xyXG4gICAgbGV0IHkgPSAwO1xyXG4gICAgY29uc3QgYW5nbGUgPSAoIC1NYXRoLlBJIC8gMiApICsgKCBtb2RlbFZpZXdUcmFuc2Zvcm0ueWF3IC8gMiApOyAvLyBhbGlnbmVkIHdpdGggZGlhZ29uYWwgb2YgcGxhdGUgc3VyZmFjZVxyXG4gICAgY29uc3QgbGluZUFycm93U3BhY2luZyA9IDI7XHJcbiAgICBsaW5lTm9kZS50cmFuc2xhdGlvbiA9IG5ldyBWZWN0b3IyKCB4LCB5ICk7XHJcbiAgICBsaW5lTm9kZS5yb3RhdGlvbiA9IGFuZ2xlO1xyXG5cclxuICAgIHggPSBsaW5lTm9kZS5ib3VuZHMubWF4WCArIGxpbmVBcnJvd1NwYWNpbmc7XHJcbiAgICB5ID0gbGluZU5vZGUuYm91bmRzLm1pblkgLSBsaW5lQXJyb3dTcGFjaW5nO1xyXG4gICAgYXJyb3dOb2RlLnRyYW5zbGF0aW9uID0gbmV3IFZlY3RvcjIoIHgsIHkgKTtcclxuICAgIGFycm93Tm9kZS5yb3RhdGlvbiA9IGFuZ2xlO1xyXG5cclxuICAgIHggPSBsaW5lTm9kZS5ib3VuZHMubWF4WCArIHRoaXMudmFsdWVOb2RlLmJvdW5kcy53aWR0aCAvIDM7XHJcbiAgICB5ID0gbGluZU5vZGUuYm91bmRzLm1pblkgLSB0aGlzLnZhbHVlTm9kZS5ib3VuZHMuaGVpZ2h0IC0gMTQ7XHJcbiAgICB0aGlzLnZhbHVlTm9kZS50cmFuc2xhdGlvbiA9IG5ldyBWZWN0b3IyKCB4LCB5ICk7XHJcblxyXG4gICAgLy8gd2F0Y2ggZm9yIG1vZGVsIGNoYW5nZXNcclxuICAgIGNhcGFjaXRvci5wbGF0ZVNpemVQcm9wZXJ0eS5saW5rKCAoKSA9PiB7XHJcbiAgICAgIHRoaXMudXBkYXRlRGlzcGxheSgpO1xyXG4gICAgICB0aGlzLnVwZGF0ZU9mZnNldCgpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGNhcGFjaXRvci5wbGF0ZVNlcGFyYXRpb25Qcm9wZXJ0eS5saW5rKCAoKSA9PiB7XHJcbiAgICAgIHRoaXMudXBkYXRlT2Zmc2V0KCk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogU3luY2hyb25pemVzIHRoZSB2YWx1ZSBkaXNwbGF5IHdpdGggdGhlIG1vZGVsLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICB1cGRhdGVEaXNwbGF5KCkge1xyXG4gICAgY29uc3QgbWlsbGltZXRlcnNTcXVhcmVkID0gVW5pdHNVdGlscy5tZXRlcnNTcXVhcmVkVG9NaWxsaW1ldGVyc1NxdWFyZWQoIHRoaXMuY2FwYWNpdG9yLmdldFBsYXRlQXJlYSgpICk7XHJcbiAgICB0aGlzLnZhbHVlTm9kZS5zZXRWYWx1ZSggbWlsbGltZXRlcnNTcXVhcmVkLCAwICk7IC8vIFplcm8gZGVjaW1hbCBwbGFjZXNcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEF0dGFjaCBkcmFnIGhhbmRsZSB0byBjYXBhY2l0b3IncyB0b3AgcGxhdGUsIGF0IGJhY2stcmlnaHQgY29ybmVyIG9mIHRvcCBmYWNlLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICB1cGRhdGVPZmZzZXQoKSB7XHJcbiAgICBjb25zdCBwbGF0ZVNpemUgPSB0aGlzLmNhcGFjaXRvci5wbGF0ZVNpemVQcm9wZXJ0eS52YWx1ZTtcclxuICAgIGNvbnN0IHggPSB0aGlzLmNhcGFjaXRvci5wb3NpdGlvbi54ICsgKCBwbGF0ZVNpemUud2lkdGggLyAyICk7XHJcbiAgICBjb25zdCB5ID0gdGhpcy5jYXBhY2l0b3IucG9zaXRpb24ueSAtICggdGhpcy5jYXBhY2l0b3IucGxhdGVTZXBhcmF0aW9uUHJvcGVydHkudmFsdWUgLyAyICkgLSBwbGF0ZVNpemUuaGVpZ2h0O1xyXG4gICAgY29uc3QgeiA9IHRoaXMuY2FwYWNpdG9yLnBvc2l0aW9uLnogKyAoIHBsYXRlU2l6ZS5kZXB0aCAvIDIgKTtcclxuICAgIHRoaXMudHJhbnNsYXRpb24gPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1hZWiggeCwgeSwgeiApO1xyXG4gIH1cclxufVxyXG5cclxuY2FwYWNpdG9yTGFiQmFzaWNzLnJlZ2lzdGVyKCAnUGxhdGVBcmVhRHJhZ0hhbmRsZU5vZGUnLCBQbGF0ZUFyZWFEcmFnSGFuZGxlTm9kZSApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgUGxhdGVBcmVhRHJhZ0hhbmRsZU5vZGU7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE9BQU8sTUFBTSxrQ0FBa0M7QUFDdEQsU0FBU0MsSUFBSSxRQUFRLHNDQUFzQztBQUMzRCxPQUFPQyxrQkFBa0IsTUFBTSxnQ0FBZ0M7QUFDL0QsT0FBT0MseUJBQXlCLE1BQU0sdUNBQXVDO0FBQzdFLE9BQU9DLFlBQVksTUFBTSx1QkFBdUI7QUFDaEQsT0FBT0MsVUFBVSxNQUFNLGdDQUFnQztBQUN2RCxPQUFPQyxtQkFBbUIsTUFBTSwwQkFBMEI7QUFDMUQsT0FBT0Msa0JBQWtCLE1BQU0seUJBQXlCO0FBQ3hELE9BQU9DLG1CQUFtQixNQUFNLDBCQUEwQjtBQUMxRCxPQUFPQyxvQkFBb0IsTUFBTSwyQkFBMkI7O0FBRTVEO0FBQ0E7QUFDQSxNQUFNQyxrQkFBa0IsR0FBRyxJQUFJVixPQUFPLENBQUUsQ0FBQyxFQUFFLENBQUUsQ0FBQztBQUM5QyxNQUFNVyxtQkFBbUIsR0FBRyxJQUFJWCxPQUFPLENBQUUsQ0FBQyxFQUFFSSxZQUFZLENBQUNRLHdCQUF5QixDQUFDO0FBRW5GLE1BQU1DLCtCQUEr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