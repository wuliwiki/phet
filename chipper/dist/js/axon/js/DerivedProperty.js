// Copyright 2013-2023, University of Colorado Boulder

/**
 * A DerivedProperty is computed based on other Properties.  This implementation inherits from Property to (a) simplify
 * implementation and (b) ensure it remains consistent. Note that the setters should not be called directly, so the
 * setters (set, reset and es5 setter) throw an error if used directly.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Tandem from '../../tandem/js/Tandem.js';
import IOType from '../../tandem/js/types/IOType.js';
import VoidIO from '../../tandem/js/types/VoidIO.js';
import axon from './axon.js';
import Property from './Property.js';
import propertyStateHandlerSingleton from './propertyStateHandlerSingleton.js';
import PropertyStatePhase from './PropertyStatePhase.js';
import optionize from '../../phet-core/js/optionize.js';
import ReadOnlyProperty from './ReadOnlyProperty.js';
import PhetioObject from '../../tandem/js/PhetioObject.js';
const DERIVED_PROPERTY_IO_PREFIX = 'DerivedPropertyIO';
/**
 * Compute the derived value given a derivation and an array of dependencies
 */
function getDerivedValue(derivation, dependencies) {
  // @ts-expect-error
  return derivation(...dependencies.map(property => property.get()));
}

// Convenience type for a Derived property that has a known return type but unknown dependency types.

/**
 * T = type of the derived value
 * Parameters[] = types of the callback parameters, e.g. [ Vector2, number, boolean ]
 */
export default class DerivedProperty extends ReadOnlyProperty {
  /**
   * @param dependencies - Properties that this Property's value is derived from
   * @param derivation - function that derives this Property's value, expects args in the same order as dependencies
   * @param [providedOptions] - see Property
   */

  constructor(dependencies, derivation, providedOptions) {
    const options = optionize()({
      tandem: Tandem.OPTIONAL,
      phetioReadOnly: true,
      // derived properties can be read but not set by PhET-iO
      phetioOuterType: DerivedProperty.DerivedPropertyIO,
      phetioLinkDependencies: true
    }, providedOptions);
    assert && assert(dependencies.every(_.identity), 'dependencies should all be truthy');
    assert && assert(dependencies.length === _.uniq(dependencies).length, 'duplicate dependencies');
    const initialValue = getDerivedValue(derivation, dependencies);

    // We must pass supertype tandem to parent class so addInstance is called only once in the subclassiest constructor.
    super(initialValue, options);
    if (Tandem.VALIDATION && this.isPhetioInstrumented()) {
      // The phetioType should be a concrete (instantiated) DerivedPropertyIO, hence we must check its outer type
      assert && assert(this.phetioType.typeName.startsWith('DerivedPropertyIO'), 'phetioType should be DerivedPropertyIO');
    }
    this.dependencies = dependencies;
    this.derivation = derivation;
    this.derivedPropertyListener = this.getDerivedPropertyListener.bind(this);
    dependencies.forEach(dependency => {
      dependency.lazyLink(this.derivedPropertyListener);
      if (this.isPhetioInstrumented() && dependency instanceof PhetioObject && dependency.isPhetioInstrumented()) {
        if (dependency instanceof ReadOnlyProperty) {
          // Dependencies should have taken their correct values before this DerivedProperty undefers, so it will be sure
          // to have the right value.
          // NOTE: Do not mark the beforePhase as NOTIFY, as this will potentially cause interdependence bugs when used
          // with Multilinks. See Projectile Motion's use of MeasuringTapeNode for an example.
          propertyStateHandlerSingleton.registerPhetioOrderDependency(dependency, PropertyStatePhase.UNDEFER, this, PropertyStatePhase.UNDEFER);
        }
        if (options.phetioLinkDependencies) {
          const dependenciesTandem = options.tandem.createTandem('dependencies');
          this.addLinkedElement(dependency, {
            tandem: dependenciesTandem.createTandemFromPhetioID(dependency.tandem.phetioID)
          });
        }
      }
    });
  }

  /**
   * Determines whether this DerivedProperty has a specific dependency.
   */
  hasDependency(dependency) {
    return this.definedDependencies.includes(dependency);
  }

  /**
   * Returns dependencies that are guaranteed to be defined internally.
   */
  get definedDependencies() {
    assert && assert(this.dependencies !== null, 'Dependencies should be defined, has this Property been disposed?');
    return this.dependencies;
  }

  // for bind
  getDerivedPropertyListener() {
    // Don't try to recompute if we are disposed, see https://github.com/phetsims/axon/issues/432
    if (this.isDisposed) {
      return;
    }

    // Just mark that there is a deferred value, then calculate the derivation below when setDeferred() is called.
    // This is in part supported by the PhET-iO state engine because it can account for intermediate states, such
    // that this Property won't notify until after it is undeferred and has taken its final value.
    if (this.isDeferred) {
      this.hasDeferredValue = true;
    } else {
      super.set(getDerivedValue(this.derivation, this.definedDependencies));
    }
  }

  /**
   * Allows forcing a recomputation (as a possible workaround to listener order).
   */
  recomputeDerivation() {
    this.getDerivedPropertyListener();
  }
  dispose() {
    const dependencies = this.definedDependencies;

    // Unlink from dependent Properties
    for (let i = 0; i < dependencies.length; i++) {
      const dependency = dependencies[i];
      if (dependency.hasListener(this.derivedPropertyListener)) {
        dependency.unlink(this.derivedPropertyListener);
      }
    }
    this.dependencies = null;
    super.dispose();
  }

  /**
   * Support deferred DerivedProperty by only calculating the derivation once when it is time to undefer it and fire
   * notifications. This way we don't have intermediate derivation calls during PhET-iO state setting.
   */
  setDeferred(isDeferred) {
    if (this.isDeferred && !isDeferred) {
      this.deferredValue = getDerivedValue(this.derivation, this.definedDependencies);
    }
    return super.setDeferred(isDeferred);
  }

  /**
   * Creates a derived boolean Property whose value is true iff firstProperty's value is equal to secondProperty's
   * value.
   */
  static valueEquals(firstProperty, secondProperty, options) {
    return new DerivedProperty([firstProperty, secondProperty], (u, v) => u === v, options);
  }
  static valueEqualsConstant(firstProperty, value, options) {
    return new DerivedProperty([firstProperty], u => u === value, options);
  }

  /**
   * Creates a derived boolean Property whose value is true iff every input Property value is true.
   */
  static and(properties, options) {
    assert && assert(properties.length > 0, 'must provide a dependency');
    return DerivedProperty.deriveAny(properties, () => _.reduce(properties, andFunction, true), options);
  }

  /**
   * Creates a derived boolean Property whose value is true iff any input Property value is true.
   */
  static or(properties, options) {
    assert && assert(properties.length > 0, 'must provide a dependency');
    return DerivedProperty.deriveAny(properties, () => _.reduce(properties, orFunction, false), options);
  }

  /**
   * Creates a derived boolean Property whose value is the inverse of the provided property.
   */
  static not(propertyToInvert, options) {
    return new DerivedProperty([propertyToInvert], x => !x, options);
  }

  /**
   * Create a DerivedProperty from any number of dependencies.  This is parallel to Multilink.multilinkAny
   */
  static deriveAny(dependencies, derivation, providedOptions) {
    return new DerivedProperty(
    // @ts-expect-error we have to provide a mapping between an arbitrary length array and our max overload of 15 types.
    dependencies, derivation, providedOptions);
  }
}
const andFunction = (value, property) => {
  return value && property.value;
};
const orFunction = (value, property) => {
  assert && assert(typeof property.value === 'boolean', 'boolean value required');
  return value || property.value;
};

// Cache each parameterized DerivedPropertyIO so that it is only created once.
const cache = new Map();

/**
 * Parametric IO Type constructor.  Given a parameter type, this function returns an appropriate DerivedProperty
 * IO Type. Unlike PropertyIO, DerivedPropertyIO cannot be set by PhET-iO clients.
 * This caching implementation should be kept in sync with the other parametric IO Type caching implementations.
 */
DerivedProperty.DerivedPropertyIO = parameterType => {
  assert && assert(parameterType, 'DerivedPropertyIO needs parameterType');
  if (!cache.has(parameterType)) {
    cache.set(parameterType, new IOType(`${DERIVED_PROPERTY_IO_PREFIX}<${parameterType.typeName}>`, {
      valueType: DerivedProperty,
      parameterTypes: [parameterType],
      supertype: Property.PropertyIO(parameterType),
      documentation: 'Like PropertyIO, but not settable.  Instead it is derived from other DerivedPropertyIO or PropertyIO ' + 'instances',
      // Override the parent implementation as a no-op.  DerivedProperty values appear in the state, but should not be set
      // back into a running simulation. See https://github.com/phetsims/phet-io/issues/1292
      applyState: _.noop,
      methods: {
        setValue: {
          returnType: VoidIO,
          parameterTypes: [parameterType],
          // @ts-expect-error
          implementation: DerivedProperty.prototype.set,
          documentation: 'Errors out when you try to set a derived property.',
          invocableForReadOnlyElements: false
        }
      }
    }));
  }
  return cache.get(parameterType);
};

// Convenience classes for subclassing DerivedProperty
export class DerivedProperty1 extends DerivedProperty {}
export class DerivedProperty2 extends DerivedProperty {}
export class DerivedProperty3 extends DerivedProperty {}
export class DerivedProperty4 extends DerivedProperty {}
export class DerivedProperty5 extends DerivedProperty {}
axon.register('DerivedProperty', DerivedProperty);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJUYW5kZW0iLCJJT1R5cGUiLCJWb2lkSU8iLCJheG9uIiwiUHJvcGVydHkiLCJwcm9wZXJ0eVN0YXRlSGFuZGxlclNpbmdsZXRvbiIsIlByb3BlcnR5U3RhdGVQaGFzZSIsIm9wdGlvbml6ZSIsIlJlYWRPbmx5UHJvcGVydHkiLCJQaGV0aW9PYmplY3QiLCJERVJJVkVEX1BST1BFUlRZX0lPX1BSRUZJWCIsImdldERlcml2ZWRWYWx1ZSIsImRlcml2YXRpb24iLCJkZXBlbmRlbmNpZXMiLCJtYXAiLCJwcm9wZXJ0eSIsImdldCIsIkRlcml2ZWRQcm9wZXJ0eSIsImNvbnN0cnVjdG9yIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsInRhbmRlbSIsIk9QVElPTkFMIiwicGhldGlvUmVhZE9ubHkiLCJwaGV0aW9PdXRlclR5cGUiLCJEZXJpdmVkUHJvcGVydHlJTyIsInBoZXRpb0xpbmtEZXBlbmRlbmNpZXMiLCJhc3NlcnQiLCJldmVyeSIsIl8iLCJpZGVudGl0eSIsImxlbmd0aCIsInVuaXEiLCJpbml0aWFsVmFsdWUiLCJWQUxJREFUSU9OIiwiaXNQaGV0aW9JbnN0cnVtZW50ZWQiLCJwaGV0aW9UeXBlIiwidHlwZU5hbWUiLCJzdGFydHNXaXRoIiwiZGVyaXZlZFByb3BlcnR5TGlzdGVuZXIiLCJnZXREZXJpdmVkUHJvcGVydHlMaXN0ZW5lciIsImJpbmQiLCJmb3JFYWNoIiwiZGVwZW5kZW5jeSIsImxhenlMaW5rIiwicmVnaXN0ZXJQaGV0aW9PcmRlckRlcGVuZGVuY3kiLCJVTkRFRkVSIiwiZGVwZW5kZW5jaWVzVGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwiYWRkTGlua2VkRWxlbWVudCIsImNyZWF0ZVRhbmRlbUZyb21QaGV0aW9JRCIsInBoZXRpb0lEIiwiaGFzRGVwZW5kZW5jeSIsImRlZmluZWREZXBlbmRlbmNpZXMiLCJpbmNsdWRlcyIsImlzRGlzcG9zZWQiLCJpc0RlZmVycmVkIiwiaGFzRGVmZXJyZWRWYWx1ZSIsInNldCIsInJlY29tcHV0ZURlcml2YXRpb24iLCJkaXNwb3NlIiwiaSIsImhhc0xpc3RlbmVyIiwidW5saW5rIiwic2V0RGVmZXJyZWQiLCJkZWZlcnJlZFZhbHVlIiwidmFsdWVFcXVhbHMiLCJmaXJzdFByb3BlcnR5Iiwic2Vjb25kUHJvcGVydHkiLCJ1IiwidiIsInZhbHVlRXF1YWxzQ29uc3RhbnQiLCJ2YWx1ZSIsImFuZCIsInByb3BlcnRpZXMiLCJkZXJpdmVBbnkiLCJyZWR1Y2UiLCJhbmRGdW5jdGlvbiIsIm9yIiwib3JGdW5jdGlvbiIsIm5vdCIsInByb3BlcnR5VG9JbnZlcnQiLCJ4IiwiY2FjaGUiLCJNYXAiLCJwYXJhbWV0ZXJUeXBlIiwiaGFzIiwidmFsdWVUeXBlIiwicGFyYW1ldGVyVHlwZXMiLCJzdXBlcnR5cGUiLCJQcm9wZXJ0eUlPIiwiZG9jdW1lbnRhdGlvbiIsImFwcGx5U3RhdGUiLCJub29wIiwibWV0aG9kcyIsInNldFZhbHVlIiwicmV0dXJuVHlwZSIsImltcGxlbWVudGF0aW9uIiwicHJvdG90eXBlIiwiaW52b2NhYmxlRm9yUmVhZE9ubHlFbGVtZW50cyIsIkRlcml2ZWRQcm9wZXJ0eTEiLCJEZXJpdmVkUHJvcGVydHkyIiwiRGVyaXZlZFByb3BlcnR5MyIsIkRlcml2ZWRQcm9wZXJ0eTQiLCJEZXJpdmVkUHJvcGVydHk1IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJEZXJpdmVkUHJvcGVydHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQSBEZXJpdmVkUHJvcGVydHkgaXMgY29tcHV0ZWQgYmFzZWQgb24gb3RoZXIgUHJvcGVydGllcy4gIFRoaXMgaW1wbGVtZW50YXRpb24gaW5oZXJpdHMgZnJvbSBQcm9wZXJ0eSB0byAoYSkgc2ltcGxpZnlcclxuICogaW1wbGVtZW50YXRpb24gYW5kIChiKSBlbnN1cmUgaXQgcmVtYWlucyBjb25zaXN0ZW50LiBOb3RlIHRoYXQgdGhlIHNldHRlcnMgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHksIHNvIHRoZVxyXG4gKiBzZXR0ZXJzIChzZXQsIHJlc2V0IGFuZCBlczUgc2V0dGVyKSB0aHJvdyBhbiBlcnJvciBpZiB1c2VkIGRpcmVjdGx5LlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBJT1R5cGUgZnJvbSAnLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0lPVHlwZS5qcyc7XHJcbmltcG9ydCBWb2lkSU8gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL3R5cGVzL1ZvaWRJTy5qcyc7XHJcbmltcG9ydCBheG9uIGZyb20gJy4vYXhvbi5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSwgeyBQcm9wZXJ0eU9wdGlvbnMgfSBmcm9tICcuL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IHByb3BlcnR5U3RhdGVIYW5kbGVyU2luZ2xldG9uIGZyb20gJy4vcHJvcGVydHlTdGF0ZUhhbmRsZXJTaW5nbGV0b24uanMnO1xyXG5pbXBvcnQgUHJvcGVydHlTdGF0ZVBoYXNlIGZyb20gJy4vUHJvcGVydHlTdGF0ZVBoYXNlLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4vVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgSW50ZW50aW9uYWxBbnkgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL0ludGVudGlvbmFsQW55LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IHsgRGVwZW5kZW5jaWVzLCBSUDEsIFJQMTAsIFJQMTEsIFJQMTIsIFJQMTMsIFJQMTQsIFJQMTUsIFJQMiwgUlAzLCBSUDQsIFJQNSwgUlA2LCBSUDcsIFJQOCwgUlA5IH0gZnJvbSAnLi9NdWx0aWxpbmsuanMnO1xyXG5pbXBvcnQgUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuL1JlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUGhldGlvT2JqZWN0IGZyb20gJy4uLy4uL3RhbmRlbS9qcy9QaGV0aW9PYmplY3QuanMnO1xyXG5cclxuY29uc3QgREVSSVZFRF9QUk9QRVJUWV9JT19QUkVGSVggPSAnRGVyaXZlZFByb3BlcnR5SU8nO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gV2hlbiB0cnVlLCBpZiB0aGlzIERlcml2ZWRQcm9wZXJ0eSBpcyBQaEVULWlPIGluc3RydW1lbnQsIGFkZCBhIExpbmtlZEVsZW1lbnQgZm9yIGVhY2ggUGhFVC1pTyBpbnN0cnVtZW50ZWQgZGVwZW5kZW5jeS5cclxuICBwaGV0aW9MaW5rRGVwZW5kZW5jaWVzPzogYm9vbGVhbjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIERlcml2ZWRQcm9wZXJ0eU9wdGlvbnM8VD4gPSBTZWxmT3B0aW9ucyAmIFByb3BlcnR5T3B0aW9uczxUPjtcclxuXHJcbi8qKlxyXG4gKiBDb21wdXRlIHRoZSBkZXJpdmVkIHZhbHVlIGdpdmVuIGEgZGVyaXZhdGlvbiBhbmQgYW4gYXJyYXkgb2YgZGVwZW5kZW5jaWVzXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXREZXJpdmVkVmFsdWU8VCwgVDEsIFQyLCBUMywgVDQsIFQ1LCBUNiwgVDcsIFQ4LCBUOSwgVDEwLCBUMTEsIFQxMiwgVDEzLCBUMTQsIFQxNT4oIGRlcml2YXRpb246ICggLi4ucGFyYW1zOiBbIFQxLCBUMiwgVDMsIFQ0LCBUNSwgVDYsIFQ3LCBUOCwgVDksIFQxMCwgVDExLCBUMTIsIFQxMywgVDE0LCBUMTUgXSApID0+IFQsIGRlcGVuZGVuY2llczogRGVwZW5kZW5jaWVzPFQxLCBUMiwgVDMsIFQ0LCBUNSwgVDYsIFQ3LCBUOCwgVDksIFQxMCwgVDExLCBUMTIsIFQxMywgVDE0LCBUMTU+ICk6IFQge1xyXG5cclxuICAvLyBAdHMtZXhwZWN0LWVycm9yXHJcbiAgcmV0dXJuIGRlcml2YXRpb24oIC4uLmRlcGVuZGVuY2llcy5tYXAoIHByb3BlcnR5ID0+IHByb3BlcnR5LmdldCgpICkgKTtcclxufVxyXG5cclxuLy8gQ29udmVuaWVuY2UgdHlwZSBmb3IgYSBEZXJpdmVkIHByb3BlcnR5IHRoYXQgaGFzIGEga25vd24gcmV0dXJuIHR5cGUgYnV0IHVua25vd24gZGVwZW5kZW5jeSB0eXBlcy5cclxuZXhwb3J0IHR5cGUgVW5rbm93bkRlcml2ZWRQcm9wZXJ0eTxUPiA9IERlcml2ZWRQcm9wZXJ0eTxULCB1bmtub3duLCB1bmtub3duLCB1bmtub3duLCB1bmtub3duLCB1bmtub3duLCB1bmtub3duLCB1bmtub3duLCB1bmtub3duLCB1bmtub3duLCB1bmtub3duLCB1bmtub3duLCB1bmtub3duLCB1bmtub3duLCB1bmtub3duLCB1bmtub3duPjtcclxuXHJcbi8qKlxyXG4gKiBUID0gdHlwZSBvZiB0aGUgZGVyaXZlZCB2YWx1ZVxyXG4gKiBQYXJhbWV0ZXJzW10gPSB0eXBlcyBvZiB0aGUgY2FsbGJhY2sgcGFyYW1ldGVycywgZS5nLiBbIFZlY3RvcjIsIG51bWJlciwgYm9vbGVhbiBdXHJcbiAqL1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEZXJpdmVkUHJvcGVydHk8VCwgVDEsIFQyLCBUMywgVDQsIFQ1LCBUNiwgVDcsIFQ4LCBUOSwgVDEwLCBUMTEsIFQxMiwgVDEzLCBUMTQsIFQxNT4gZXh0ZW5kcyBSZWFkT25seVByb3BlcnR5PFQ+IGltcGxlbWVudHMgVFJlYWRPbmx5UHJvcGVydHk8VD4ge1xyXG4gIHByaXZhdGUgZGVwZW5kZW5jaWVzOiBEZXBlbmRlbmNpZXM8VDEsIFQyLCBUMywgVDQsIFQ1LCBUNiwgVDcsIFQ4LCBUOSwgVDEwLCBUMTEsIFQxMiwgVDEzLCBUMTQsIFQxNT4gfCBudWxsO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGVyaXZhdGlvbjogKCAuLi5wYXJhbXM6IFsgVDEsIFQyLCBUMywgVDQsIFQ1LCBUNiwgVDcsIFQ4LCBUOSwgVDEwLCBUMTEsIFQxMiwgVDEzLCBUMTQsIFQxNSBdICkgPT4gVDtcclxuICBwcml2YXRlIHJlYWRvbmx5IGRlcml2ZWRQcm9wZXJ0eUxpc3RlbmVyOiAoKSA9PiB2b2lkO1xyXG4gIHB1YmxpYyBzdGF0aWMgRGVyaXZlZFByb3BlcnR5SU86ICggcGFyYW1ldGVyVHlwZTogSU9UeXBlICkgPT4gSU9UeXBlO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gZGVwZW5kZW5jaWVzIC0gUHJvcGVydGllcyB0aGF0IHRoaXMgUHJvcGVydHkncyB2YWx1ZSBpcyBkZXJpdmVkIGZyb21cclxuICAgKiBAcGFyYW0gZGVyaXZhdGlvbiAtIGZ1bmN0aW9uIHRoYXQgZGVyaXZlcyB0aGlzIFByb3BlcnR5J3MgdmFsdWUsIGV4cGVjdHMgYXJncyBpbiB0aGUgc2FtZSBvcmRlciBhcyBkZXBlbmRlbmNpZXNcclxuICAgKiBAcGFyYW0gW3Byb3ZpZGVkT3B0aW9uc10gLSBzZWUgUHJvcGVydHlcclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGRlcGVuZGVuY2llczogUlAxPFQxPiwgZGVyaXZhdGlvbjogKCAuLi5wYXJhbXM6IFsgVDEgXSApID0+IFQsIHByb3ZpZGVkT3B0aW9ucz86IERlcml2ZWRQcm9wZXJ0eU9wdGlvbnM8VD4gKSA7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBkZXBlbmRlbmNpZXM6IFJQMjxUMSwgVDI+LCBkZXJpdmF0aW9uOiAoIC4uLnBhcmFtczogWyBUMSwgVDIgXSApID0+IFQsIHByb3ZpZGVkT3B0aW9ucz86IERlcml2ZWRQcm9wZXJ0eU9wdGlvbnM8VD4gKSA7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBkZXBlbmRlbmNpZXM6IFJQMzxUMSwgVDIsIFQzPiwgZGVyaXZhdGlvbjogKCAuLi5wYXJhbXM6IFsgVDEsIFQyLCBUMyBdICkgPT4gVCwgcHJvdmlkZWRPcHRpb25zPzogRGVyaXZlZFByb3BlcnR5T3B0aW9uczxUPiApIDtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGRlcGVuZGVuY2llczogUlA0PFQxLCBUMiwgVDMsIFQ0PiwgZGVyaXZhdGlvbjogKCAuLi5wYXJhbXM6IFsgVDEsIFQyLCBUMywgVDQgXSApID0+IFQsIHByb3ZpZGVkT3B0aW9ucz86IERlcml2ZWRQcm9wZXJ0eU9wdGlvbnM8VD4gKSA7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBkZXBlbmRlbmNpZXM6IFJQNTxUMSwgVDIsIFQzLCBUNCwgVDU+LCBkZXJpdmF0aW9uOiAoIC4uLnBhcmFtczogWyBUMSwgVDIsIFQzLCBUNCwgVDUgXSApID0+IFQsIHByb3ZpZGVkT3B0aW9ucz86IERlcml2ZWRQcm9wZXJ0eU9wdGlvbnM8VD4gKSA7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBkZXBlbmRlbmNpZXM6IFJQNjxUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2PiwgZGVyaXZhdGlvbjogKCAuLi5wYXJhbXM6IFsgVDEsIFQyLCBUMywgVDQsIFQ1LCBUNiBdICkgPT4gVCwgcHJvdmlkZWRPcHRpb25zPzogRGVyaXZlZFByb3BlcnR5T3B0aW9uczxUPiApIDtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGRlcGVuZGVuY2llczogUlA3PFQxLCBUMiwgVDMsIFQ0LCBUNSwgVDYsIFQ3PiwgZGVyaXZhdGlvbjogKCAuLi5wYXJhbXM6IFsgVDEsIFQyLCBUMywgVDQsIFQ1LCBUNiwgVDcgXSApID0+IFQsIHByb3ZpZGVkT3B0aW9ucz86IERlcml2ZWRQcm9wZXJ0eU9wdGlvbnM8VD4gKSA7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBkZXBlbmRlbmNpZXM6IFJQODxUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDg+LCBkZXJpdmF0aW9uOiAoIC4uLnBhcmFtczogWyBUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDggXSApID0+IFQsIHByb3ZpZGVkT3B0aW9ucz86IERlcml2ZWRQcm9wZXJ0eU9wdGlvbnM8VD4gKSA7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBkZXBlbmRlbmNpZXM6IFJQOTxUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDgsIFQ5PiwgZGVyaXZhdGlvbjogKCAuLi5wYXJhbXM6IFsgVDEsIFQyLCBUMywgVDQsIFQ1LCBUNiwgVDcsIFQ4LCBUOSBdICkgPT4gVCwgcHJvdmlkZWRPcHRpb25zPzogRGVyaXZlZFByb3BlcnR5T3B0aW9uczxUPiApIDtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGRlcGVuZGVuY2llczogUlAxMDxUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDgsIFQ5LCBUMTA+LCBkZXJpdmF0aW9uOiAoIC4uLnBhcmFtczogWyBUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDgsIFQ5LCBUMTAgXSApID0+IFQsIHByb3ZpZGVkT3B0aW9ucz86IERlcml2ZWRQcm9wZXJ0eU9wdGlvbnM8VD4gKSA7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBkZXBlbmRlbmNpZXM6IFJQMTE8VDEsIFQyLCBUMywgVDQsIFQ1LCBUNiwgVDcsIFQ4LCBUOSwgVDEwLCBUMTE+LCBkZXJpdmF0aW9uOiAoIC4uLnBhcmFtczogWyBUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDgsIFQ5LCBUMTAsIFQxMSBdICkgPT4gVCwgcHJvdmlkZWRPcHRpb25zPzogRGVyaXZlZFByb3BlcnR5T3B0aW9uczxUPiApIDtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGRlcGVuZGVuY2llczogUlAxMjxUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDgsIFQ5LCBUMTAsIFQxMSwgVDEyPiwgZGVyaXZhdGlvbjogKCAuLi5wYXJhbXM6IFsgVDEsIFQyLCBUMywgVDQsIFQ1LCBUNiwgVDcsIFQ4LCBUOSwgVDEwLCBUMTEsIFQxMiBdICkgPT4gVCwgcHJvdmlkZWRPcHRpb25zPzogRGVyaXZlZFByb3BlcnR5T3B0aW9uczxUPiApIDtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGRlcGVuZGVuY2llczogUlAxMzxUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDgsIFQ5LCBUMTAsIFQxMSwgVDEyLCBUMTM+LCBkZXJpdmF0aW9uOiAoIC4uLnBhcmFtczogWyBUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDgsIFQ5LCBUMTAsIFQxMSwgVDEyLCBUMTMgXSApID0+IFQsIHByb3ZpZGVkT3B0aW9ucz86IERlcml2ZWRQcm9wZXJ0eU9wdGlvbnM8VD4gKSA7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBkZXBlbmRlbmNpZXM6IFJQMTQ8VDEsIFQyLCBUMywgVDQsIFQ1LCBUNiwgVDcsIFQ4LCBUOSwgVDEwLCBUMTEsIFQxMiwgVDEzLCBUMTQ+LCBkZXJpdmF0aW9uOiAoIC4uLnBhcmFtczogWyBUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDgsIFQ5LCBUMTAsIFQxMSwgVDEyLCBUMTMsIFQxNCBdICkgPT4gVCwgcHJvdmlkZWRPcHRpb25zPzogRGVyaXZlZFByb3BlcnR5T3B0aW9uczxUPiApIDtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGRlcGVuZGVuY2llczogUlAxNTxUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDgsIFQ5LCBUMTAsIFQxMSwgVDEyLCBUMTMsIFQxNCwgVDE1PiwgZGVyaXZhdGlvbjogKCAuLi5wYXJhbXM6IFsgVDEsIFQyLCBUMywgVDQsIFQ1LCBUNiwgVDcsIFQ4LCBUOSwgVDEwLCBUMTEsIFQxMiwgVDEzLCBUMTQsIFQxNSBdICkgPT4gVCwgcHJvdmlkZWRPcHRpb25zPzogRGVyaXZlZFByb3BlcnR5T3B0aW9uczxUPiApIDtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGRlcGVuZGVuY2llczogRGVwZW5kZW5jaWVzPFQxLCBUMiwgVDMsIFQ0LCBUNSwgVDYsIFQ3LCBUOCwgVDksIFQxMCwgVDExLCBUMTIsIFQxMywgVDE0LCBUMTU+LCBkZXJpdmF0aW9uOiAoIC4uLnBhcmFtczogWyBUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDgsIFQ5LCBUMTAsIFQxMSwgVDEyLCBUMTMsIFQxNCwgVDE1IF0gKSA9PiBULCBwcm92aWRlZE9wdGlvbnM/OiBEZXJpdmVkUHJvcGVydHlPcHRpb25zPFQ+ICk7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBkZXBlbmRlbmNpZXM6IERlcGVuZGVuY2llczxUMSwgVDIsIFQzLCBUNCwgVDUsIFQ2LCBUNywgVDgsIFQ5LCBUMTAsIFQxMSwgVDEyLCBUMTMsIFQxNCwgVDE1PiwgZGVyaXZhdGlvbjogKCAuLi5wYXJhbXM6IFsgVDEsIFQyLCBUMywgVDQsIFQ1LCBUNiwgVDcsIFQ4LCBUOSwgVDEwLCBUMTEsIFQxMiwgVDEzLCBUMTQsIFQxNSBdICkgPT4gVCwgcHJvdmlkZWRPcHRpb25zPzogRGVyaXZlZFByb3BlcnR5T3B0aW9uczxUPiApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPERlcml2ZWRQcm9wZXJ0eU9wdGlvbnM8VD4sIFNlbGZPcHRpb25zLCBQcm9wZXJ0eU9wdGlvbnM8VD4+KCkoIHtcclxuICAgICAgdGFuZGVtOiBUYW5kZW0uT1BUSU9OQUwsXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlLCAvLyBkZXJpdmVkIHByb3BlcnRpZXMgY2FuIGJlIHJlYWQgYnV0IG5vdCBzZXQgYnkgUGhFVC1pT1xyXG4gICAgICBwaGV0aW9PdXRlclR5cGU6IERlcml2ZWRQcm9wZXJ0eS5EZXJpdmVkUHJvcGVydHlJTyxcclxuICAgICAgcGhldGlvTGlua0RlcGVuZGVuY2llczogdHJ1ZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZGVwZW5kZW5jaWVzLmV2ZXJ5KCBfLmlkZW50aXR5ICksICdkZXBlbmRlbmNpZXMgc2hvdWxkIGFsbCBiZSB0cnV0aHknICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBkZXBlbmRlbmNpZXMubGVuZ3RoID09PSBfLnVuaXEoIGRlcGVuZGVuY2llcyApLmxlbmd0aCwgJ2R1cGxpY2F0ZSBkZXBlbmRlbmNpZXMnICk7XHJcblxyXG4gICAgY29uc3QgaW5pdGlhbFZhbHVlID0gZ2V0RGVyaXZlZFZhbHVlKCBkZXJpdmF0aW9uLCBkZXBlbmRlbmNpZXMgKTtcclxuXHJcbiAgICAvLyBXZSBtdXN0IHBhc3Mgc3VwZXJ0eXBlIHRhbmRlbSB0byBwYXJlbnQgY2xhc3Mgc28gYWRkSW5zdGFuY2UgaXMgY2FsbGVkIG9ubHkgb25jZSBpbiB0aGUgc3ViY2xhc3NpZXN0IGNvbnN0cnVjdG9yLlxyXG4gICAgc3VwZXIoIGluaXRpYWxWYWx1ZSwgb3B0aW9ucyApO1xyXG5cclxuICAgIGlmICggVGFuZGVtLlZBTElEQVRJT04gJiYgdGhpcy5pc1BoZXRpb0luc3RydW1lbnRlZCgpICkge1xyXG5cclxuICAgICAgLy8gVGhlIHBoZXRpb1R5cGUgc2hvdWxkIGJlIGEgY29uY3JldGUgKGluc3RhbnRpYXRlZCkgRGVyaXZlZFByb3BlcnR5SU8sIGhlbmNlIHdlIG11c3QgY2hlY2sgaXRzIG91dGVyIHR5cGVcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5waGV0aW9UeXBlLnR5cGVOYW1lLnN0YXJ0c1dpdGgoICdEZXJpdmVkUHJvcGVydHlJTycgKSwgJ3BoZXRpb1R5cGUgc2hvdWxkIGJlIERlcml2ZWRQcm9wZXJ0eUlPJyApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gZGVwZW5kZW5jaWVzO1xyXG4gICAgdGhpcy5kZXJpdmF0aW9uID0gZGVyaXZhdGlvbjtcclxuICAgIHRoaXMuZGVyaXZlZFByb3BlcnR5TGlzdGVuZXIgPSB0aGlzLmdldERlcml2ZWRQcm9wZXJ0eUxpc3RlbmVyLmJpbmQoIHRoaXMgKTtcclxuXHJcbiAgICBkZXBlbmRlbmNpZXMuZm9yRWFjaCggZGVwZW5kZW5jeSA9PiB7XHJcblxyXG4gICAgICBkZXBlbmRlbmN5LmxhenlMaW5rKCB0aGlzLmRlcml2ZWRQcm9wZXJ0eUxpc3RlbmVyICk7XHJcblxyXG4gICAgICBpZiAoIHRoaXMuaXNQaGV0aW9JbnN0cnVtZW50ZWQoKSAmJiBkZXBlbmRlbmN5IGluc3RhbmNlb2YgUGhldGlvT2JqZWN0ICYmIGRlcGVuZGVuY3kuaXNQaGV0aW9JbnN0cnVtZW50ZWQoKSApIHtcclxuICAgICAgICBpZiAoIGRlcGVuZGVuY3kgaW5zdGFuY2VvZiBSZWFkT25seVByb3BlcnR5ICkge1xyXG5cclxuICAgICAgICAgIC8vIERlcGVuZGVuY2llcyBzaG91bGQgaGF2ZSB0YWtlbiB0aGVpciBjb3JyZWN0IHZhbHVlcyBiZWZvcmUgdGhpcyBEZXJpdmVkUHJvcGVydHkgdW5kZWZlcnMsIHNvIGl0IHdpbGwgYmUgc3VyZVxyXG4gICAgICAgICAgLy8gdG8gaGF2ZSB0aGUgcmlnaHQgdmFsdWUuXHJcbiAgICAgICAgICAvLyBOT1RFOiBEbyBub3QgbWFyayB0aGUgYmVmb3JlUGhhc2UgYXMgTk9USUZZLCBhcyB0aGlzIHdpbGwgcG90ZW50aWFsbHkgY2F1c2UgaW50ZXJkZXBlbmRlbmNlIGJ1Z3Mgd2hlbiB1c2VkXHJcbiAgICAgICAgICAvLyB3aXRoIE11bHRpbGlua3MuIFNlZSBQcm9qZWN0aWxlIE1vdGlvbidzIHVzZSBvZiBNZWFzdXJpbmdUYXBlTm9kZSBmb3IgYW4gZXhhbXBsZS5cclxuICAgICAgICAgIHByb3BlcnR5U3RhdGVIYW5kbGVyU2luZ2xldG9uLnJlZ2lzdGVyUGhldGlvT3JkZXJEZXBlbmRlbmN5KCBkZXBlbmRlbmN5LCBQcm9wZXJ0eVN0YXRlUGhhc2UuVU5ERUZFUiwgdGhpcywgUHJvcGVydHlTdGF0ZVBoYXNlLlVOREVGRVIgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICggb3B0aW9ucy5waGV0aW9MaW5rRGVwZW5kZW5jaWVzICkge1xyXG4gICAgICAgICAgY29uc3QgZGVwZW5kZW5jaWVzVGFuZGVtID0gb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZGVwZW5kZW5jaWVzJyApO1xyXG4gICAgICAgICAgdGhpcy5hZGRMaW5rZWRFbGVtZW50KCBkZXBlbmRlbmN5LCB7XHJcbiAgICAgICAgICAgIHRhbmRlbTogZGVwZW5kZW5jaWVzVGFuZGVtLmNyZWF0ZVRhbmRlbUZyb21QaGV0aW9JRCggZGVwZW5kZW5jeS50YW5kZW0ucGhldGlvSUQgKVxyXG4gICAgICAgICAgfSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoaXMgRGVyaXZlZFByb3BlcnR5IGhhcyBhIHNwZWNpZmljIGRlcGVuZGVuY3kuXHJcbiAgICovXHJcbiAgcHVibGljIGhhc0RlcGVuZGVuY3koIGRlcGVuZGVuY3k6IFRSZWFkT25seVByb3BlcnR5PEludGVudGlvbmFsQW55PiApOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmRlZmluZWREZXBlbmRlbmNpZXMuaW5jbHVkZXMoIGRlcGVuZGVuY3kgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgZGVwZW5kZW5jaWVzIHRoYXQgYXJlIGd1YXJhbnRlZWQgdG8gYmUgZGVmaW5lZCBpbnRlcm5hbGx5LlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0IGRlZmluZWREZXBlbmRlbmNpZXMoKTogRGVwZW5kZW5jaWVzPFQxLCBUMiwgVDMsIFQ0LCBUNSwgVDYsIFQ3LCBUOCwgVDksIFQxMCwgVDExLCBUMTIsIFQxMywgVDE0LCBUMTU+IHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuZGVwZW5kZW5jaWVzICE9PSBudWxsLCAnRGVwZW5kZW5jaWVzIHNob3VsZCBiZSBkZWZpbmVkLCBoYXMgdGhpcyBQcm9wZXJ0eSBiZWVuIGRpc3Bvc2VkPycgKTtcclxuICAgIHJldHVybiB0aGlzLmRlcGVuZGVuY2llcyE7XHJcbiAgfVxyXG5cclxuICAvLyBmb3IgYmluZFxyXG4gIHByaXZhdGUgZ2V0RGVyaXZlZFByb3BlcnR5TGlzdGVuZXIoKTogdm9pZCB7XHJcbiAgICAvLyBEb24ndCB0cnkgdG8gcmVjb21wdXRlIGlmIHdlIGFyZSBkaXNwb3NlZCwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9heG9uL2lzc3Vlcy80MzJcclxuICAgIGlmICggdGhpcy5pc0Rpc3Bvc2VkICkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSnVzdCBtYXJrIHRoYXQgdGhlcmUgaXMgYSBkZWZlcnJlZCB2YWx1ZSwgdGhlbiBjYWxjdWxhdGUgdGhlIGRlcml2YXRpb24gYmVsb3cgd2hlbiBzZXREZWZlcnJlZCgpIGlzIGNhbGxlZC5cclxuICAgIC8vIFRoaXMgaXMgaW4gcGFydCBzdXBwb3J0ZWQgYnkgdGhlIFBoRVQtaU8gc3RhdGUgZW5naW5lIGJlY2F1c2UgaXQgY2FuIGFjY291bnQgZm9yIGludGVybWVkaWF0ZSBzdGF0ZXMsIHN1Y2hcclxuICAgIC8vIHRoYXQgdGhpcyBQcm9wZXJ0eSB3b24ndCBub3RpZnkgdW50aWwgYWZ0ZXIgaXQgaXMgdW5kZWZlcnJlZCBhbmQgaGFzIHRha2VuIGl0cyBmaW5hbCB2YWx1ZS5cclxuICAgIGlmICggdGhpcy5pc0RlZmVycmVkICkge1xyXG4gICAgICB0aGlzLmhhc0RlZmVycmVkVmFsdWUgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHN1cGVyLnNldCggZ2V0RGVyaXZlZFZhbHVlKCB0aGlzLmRlcml2YXRpb24sIHRoaXMuZGVmaW5lZERlcGVuZGVuY2llcyApICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBbGxvd3MgZm9yY2luZyBhIHJlY29tcHV0YXRpb24gKGFzIGEgcG9zc2libGUgd29ya2Fyb3VuZCB0byBsaXN0ZW5lciBvcmRlcikuXHJcbiAgICovXHJcbiAgcHVibGljIHJlY29tcHV0ZURlcml2YXRpb24oKTogdm9pZCB7XHJcbiAgICB0aGlzLmdldERlcml2ZWRQcm9wZXJ0eUxpc3RlbmVyKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuXHJcbiAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSB0aGlzLmRlZmluZWREZXBlbmRlbmNpZXM7XHJcblxyXG4gICAgLy8gVW5saW5rIGZyb20gZGVwZW5kZW50IFByb3BlcnRpZXNcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGRlcGVuZGVuY2llcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgZGVwZW5kZW5jeSA9IGRlcGVuZGVuY2llc1sgaSBdO1xyXG4gICAgICBpZiAoIGRlcGVuZGVuY3kuaGFzTGlzdGVuZXIoIHRoaXMuZGVyaXZlZFByb3BlcnR5TGlzdGVuZXIgKSApIHtcclxuICAgICAgICBkZXBlbmRlbmN5LnVubGluayggdGhpcy5kZXJpdmVkUHJvcGVydHlMaXN0ZW5lciApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmRlcGVuZGVuY2llcyA9IG51bGw7XHJcblxyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3VwcG9ydCBkZWZlcnJlZCBEZXJpdmVkUHJvcGVydHkgYnkgb25seSBjYWxjdWxhdGluZyB0aGUgZGVyaXZhdGlvbiBvbmNlIHdoZW4gaXQgaXMgdGltZSB0byB1bmRlZmVyIGl0IGFuZCBmaXJlXHJcbiAgICogbm90aWZpY2F0aW9ucy4gVGhpcyB3YXkgd2UgZG9uJ3QgaGF2ZSBpbnRlcm1lZGlhdGUgZGVyaXZhdGlvbiBjYWxscyBkdXJpbmcgUGhFVC1pTyBzdGF0ZSBzZXR0aW5nLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBzZXREZWZlcnJlZCggaXNEZWZlcnJlZDogYm9vbGVhbiApOiAoICgpID0+IHZvaWQgKSB8IG51bGwge1xyXG4gICAgaWYgKCB0aGlzLmlzRGVmZXJyZWQgJiYgIWlzRGVmZXJyZWQgKSB7XHJcbiAgICAgIHRoaXMuZGVmZXJyZWRWYWx1ZSA9IGdldERlcml2ZWRWYWx1ZSggdGhpcy5kZXJpdmF0aW9uLCB0aGlzLmRlZmluZWREZXBlbmRlbmNpZXMgKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdXBlci5zZXREZWZlcnJlZCggaXNEZWZlcnJlZCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhIGRlcml2ZWQgYm9vbGVhbiBQcm9wZXJ0eSB3aG9zZSB2YWx1ZSBpcyB0cnVlIGlmZiBmaXJzdFByb3BlcnR5J3MgdmFsdWUgaXMgZXF1YWwgdG8gc2Vjb25kUHJvcGVydHknc1xyXG4gICAqIHZhbHVlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgdmFsdWVFcXVhbHMoIGZpcnN0UHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHVua25vd24+LCBzZWNvbmRQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8dW5rbm93bj4sIG9wdGlvbnM/OiBEZXJpdmVkUHJvcGVydHlPcHRpb25zPGJvb2xlYW4+ICk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+IHtcclxuICAgIHJldHVybiBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIGZpcnN0UHJvcGVydHksIHNlY29uZFByb3BlcnR5IF0sICggdTogdW5rbm93biwgdjogdW5rbm93biApID0+IHUgPT09IHYsIG9wdGlvbnMgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgdmFsdWVFcXVhbHNDb25zdGFudCggZmlyc3RQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8dW5rbm93bj4sIHZhbHVlOiB1bmtub3duLCBvcHRpb25zPzogRGVyaXZlZFByb3BlcnR5T3B0aW9uczxib29sZWFuPiApOiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPiB7XHJcbiAgICByZXR1cm4gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBmaXJzdFByb3BlcnR5IF0sICggdTogdW5rbm93biApID0+IHUgPT09IHZhbHVlLCBvcHRpb25zICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgZGVyaXZlZCBib29sZWFuIFByb3BlcnR5IHdob3NlIHZhbHVlIGlzIHRydWUgaWZmIGV2ZXJ5IGlucHV0IFByb3BlcnR5IHZhbHVlIGlzIHRydWUuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBhbmQoIHByb3BlcnRpZXM6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+W10sIG9wdGlvbnM/OiBQcm9wZXJ0eU9wdGlvbnM8Ym9vbGVhbj4gKTogVW5rbm93bkRlcml2ZWRQcm9wZXJ0eTxib29sZWFuPiB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBwcm9wZXJ0aWVzLmxlbmd0aCA+IDAsICdtdXN0IHByb3ZpZGUgYSBkZXBlbmRlbmN5JyApO1xyXG5cclxuICAgIHJldHVybiBEZXJpdmVkUHJvcGVydHkuZGVyaXZlQW55KCBwcm9wZXJ0aWVzLCAoKSA9PiBfLnJlZHVjZSggcHJvcGVydGllcywgYW5kRnVuY3Rpb24sIHRydWUgKSwgb3B0aW9ucyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhIGRlcml2ZWQgYm9vbGVhbiBQcm9wZXJ0eSB3aG9zZSB2YWx1ZSBpcyB0cnVlIGlmZiBhbnkgaW5wdXQgUHJvcGVydHkgdmFsdWUgaXMgdHJ1ZS5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIG9yKCBwcm9wZXJ0aWVzOiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPltdLCBvcHRpb25zPzogUHJvcGVydHlPcHRpb25zPGJvb2xlYW4+ICk6IFVua25vd25EZXJpdmVkUHJvcGVydHk8Ym9vbGVhbj4ge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggcHJvcGVydGllcy5sZW5ndGggPiAwLCAnbXVzdCBwcm92aWRlIGEgZGVwZW5kZW5jeScgKTtcclxuXHJcbiAgICByZXR1cm4gRGVyaXZlZFByb3BlcnR5LmRlcml2ZUFueSggcHJvcGVydGllcywgKCkgPT4gXy5yZWR1Y2UoIHByb3BlcnRpZXMsIG9yRnVuY3Rpb24sIGZhbHNlICksIG9wdGlvbnMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBkZXJpdmVkIGJvb2xlYW4gUHJvcGVydHkgd2hvc2UgdmFsdWUgaXMgdGhlIGludmVyc2Ugb2YgdGhlIHByb3ZpZGVkIHByb3BlcnR5LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgbm90KCBwcm9wZXJ0eVRvSW52ZXJ0OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPiwgb3B0aW9ucz86IERlcml2ZWRQcm9wZXJ0eU9wdGlvbnM8Ym9vbGVhbj4gKTogRGVyaXZlZFByb3BlcnR5PGJvb2xlYW4sIGJvb2xlYW4sIHVua25vd24sIHVua25vd24sIHVua25vd24sIHVua25vd24sIHVua25vd24sIHVua25vd24sIHVua25vd24sIHVua25vd24sIHVua25vd24sIHVua25vd24sIHVua25vd24sIHVua25vd24sIHVua25vd24sIHVua25vd24+IHtcclxuICAgIHJldHVybiBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIHByb3BlcnR5VG9JbnZlcnQgXSwgKCB4OiBib29sZWFuICkgPT4gIXgsIG9wdGlvbnMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBhIERlcml2ZWRQcm9wZXJ0eSBmcm9tIGFueSBudW1iZXIgb2YgZGVwZW5kZW5jaWVzLiAgVGhpcyBpcyBwYXJhbGxlbCB0byBNdWx0aWxpbmsubXVsdGlsaW5rQW55XHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBkZXJpdmVBbnk8VD4oIGRlcGVuZGVuY2llczogQXJyYXk8VFJlYWRPbmx5UHJvcGVydHk8dW5rbm93bj4+LCBkZXJpdmF0aW9uOiAoKSA9PiBULCBwcm92aWRlZE9wdGlvbnM/OiBEZXJpdmVkUHJvcGVydHlPcHRpb25zPFQ+ICk6IFVua25vd25EZXJpdmVkUHJvcGVydHk8VD4ge1xyXG4gICAgcmV0dXJuIG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3Igd2UgaGF2ZSB0byBwcm92aWRlIGEgbWFwcGluZyBiZXR3ZWVuIGFuIGFyYml0cmFyeSBsZW5ndGggYXJyYXkgYW5kIG91ciBtYXggb3ZlcmxvYWQgb2YgMTUgdHlwZXMuXHJcbiAgICAgIGRlcGVuZGVuY2llcyxcclxuXHJcbiAgICAgIGRlcml2YXRpb24sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgYW5kRnVuY3Rpb24gPSAoIHZhbHVlOiBib29sZWFuLCBwcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4gKSA9PiB7XHJcbiAgcmV0dXJuIHZhbHVlICYmIHByb3BlcnR5LnZhbHVlO1xyXG59O1xyXG5cclxuY29uc3Qgb3JGdW5jdGlvbiA9ICggdmFsdWU6IGJvb2xlYW4sIHByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPiApID0+IHtcclxuICBhc3NlcnQgJiYgYXNzZXJ0KCB0eXBlb2YgcHJvcGVydHkudmFsdWUgPT09ICdib29sZWFuJywgJ2Jvb2xlYW4gdmFsdWUgcmVxdWlyZWQnICk7XHJcbiAgcmV0dXJuIHZhbHVlIHx8IHByb3BlcnR5LnZhbHVlO1xyXG59O1xyXG5cclxuLy8gQ2FjaGUgZWFjaCBwYXJhbWV0ZXJpemVkIERlcml2ZWRQcm9wZXJ0eUlPIHNvIHRoYXQgaXQgaXMgb25seSBjcmVhdGVkIG9uY2UuXHJcbmNvbnN0IGNhY2hlID0gbmV3IE1hcDxJT1R5cGUsIElPVHlwZT4oKTtcclxuXHJcbi8qKlxyXG4gKiBQYXJhbWV0cmljIElPIFR5cGUgY29uc3RydWN0b3IuICBHaXZlbiBhIHBhcmFtZXRlciB0eXBlLCB0aGlzIGZ1bmN0aW9uIHJldHVybnMgYW4gYXBwcm9wcmlhdGUgRGVyaXZlZFByb3BlcnR5XHJcbiAqIElPIFR5cGUuIFVubGlrZSBQcm9wZXJ0eUlPLCBEZXJpdmVkUHJvcGVydHlJTyBjYW5ub3QgYmUgc2V0IGJ5IFBoRVQtaU8gY2xpZW50cy5cclxuICogVGhpcyBjYWNoaW5nIGltcGxlbWVudGF0aW9uIHNob3VsZCBiZSBrZXB0IGluIHN5bmMgd2l0aCB0aGUgb3RoZXIgcGFyYW1ldHJpYyBJTyBUeXBlIGNhY2hpbmcgaW1wbGVtZW50YXRpb25zLlxyXG4gKi9cclxuRGVyaXZlZFByb3BlcnR5LkRlcml2ZWRQcm9wZXJ0eUlPID0gcGFyYW1ldGVyVHlwZSA9PiB7XHJcbiAgYXNzZXJ0ICYmIGFzc2VydCggcGFyYW1ldGVyVHlwZSwgJ0Rlcml2ZWRQcm9wZXJ0eUlPIG5lZWRzIHBhcmFtZXRlclR5cGUnICk7XHJcblxyXG4gIGlmICggIWNhY2hlLmhhcyggcGFyYW1ldGVyVHlwZSApICkge1xyXG4gICAgY2FjaGUuc2V0KCBwYXJhbWV0ZXJUeXBlLCBuZXcgSU9UeXBlKCBgJHtERVJJVkVEX1BST1BFUlRZX0lPX1BSRUZJWH08JHtwYXJhbWV0ZXJUeXBlLnR5cGVOYW1lfT5gLCB7XHJcbiAgICAgIHZhbHVlVHlwZTogRGVyaXZlZFByb3BlcnR5LFxyXG4gICAgICBwYXJhbWV0ZXJUeXBlczogWyBwYXJhbWV0ZXJUeXBlIF0sXHJcbiAgICAgIHN1cGVydHlwZTogUHJvcGVydHkuUHJvcGVydHlJTyggcGFyYW1ldGVyVHlwZSApLFxyXG4gICAgICBkb2N1bWVudGF0aW9uOiAnTGlrZSBQcm9wZXJ0eUlPLCBidXQgbm90IHNldHRhYmxlLiAgSW5zdGVhZCBpdCBpcyBkZXJpdmVkIGZyb20gb3RoZXIgRGVyaXZlZFByb3BlcnR5SU8gb3IgUHJvcGVydHlJTyAnICtcclxuICAgICAgICAgICAgICAgICAgICAgJ2luc3RhbmNlcycsXHJcblxyXG4gICAgICAvLyBPdmVycmlkZSB0aGUgcGFyZW50IGltcGxlbWVudGF0aW9uIGFzIGEgbm8tb3AuICBEZXJpdmVkUHJvcGVydHkgdmFsdWVzIGFwcGVhciBpbiB0aGUgc3RhdGUsIGJ1dCBzaG91bGQgbm90IGJlIHNldFxyXG4gICAgICAvLyBiYWNrIGludG8gYSBydW5uaW5nIHNpbXVsYXRpb24uIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcGhldC1pby9pc3N1ZXMvMTI5MlxyXG4gICAgICBhcHBseVN0YXRlOiBfLm5vb3AsXHJcbiAgICAgIG1ldGhvZHM6IHtcclxuICAgICAgICBzZXRWYWx1ZToge1xyXG4gICAgICAgICAgcmV0dXJuVHlwZTogVm9pZElPLFxyXG4gICAgICAgICAgcGFyYW1ldGVyVHlwZXM6IFsgcGFyYW1ldGVyVHlwZSBdLFxyXG5cclxuICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcclxuICAgICAgICAgIGltcGxlbWVudGF0aW9uOiBEZXJpdmVkUHJvcGVydHkucHJvdG90eXBlLnNldCxcclxuICAgICAgICAgIGRvY3VtZW50YXRpb246ICdFcnJvcnMgb3V0IHdoZW4geW91IHRyeSB0byBzZXQgYSBkZXJpdmVkIHByb3BlcnR5LicsXHJcbiAgICAgICAgICBpbnZvY2FibGVGb3JSZWFkT25seUVsZW1lbnRzOiBmYWxzZVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSApICk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY2FjaGUuZ2V0KCBwYXJhbWV0ZXJUeXBlICkhO1xyXG59O1xyXG5cclxuXHJcbi8vIENvbnZlbmllbmNlIGNsYXNzZXMgZm9yIHN1YmNsYXNzaW5nIERlcml2ZWRQcm9wZXJ0eVxyXG5leHBvcnQgY2xhc3MgRGVyaXZlZFByb3BlcnR5MTxULCBUMT4gZXh0ZW5kcyBEZXJpdmVkUHJvcGVydHk8VCwgVDEsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlcj4ge31cclxuXHJcbmV4cG9ydCBjbGFzcyBEZXJpdmVkUHJvcGVydHkyPFQsIFQxLCBUMj4gZXh0ZW5kcyBEZXJpdmVkUHJvcGVydHk8VCwgVDEsIFQyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlcj4ge31cclxuXHJcbmV4cG9ydCBjbGFzcyBEZXJpdmVkUHJvcGVydHkzPFQsIFQxLCBUMiwgVDM+IGV4dGVuZHMgRGVyaXZlZFByb3BlcnR5PFQsIFQxLCBUMiwgVDMsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXI+IHt9XHJcblxyXG5leHBvcnQgY2xhc3MgRGVyaXZlZFByb3BlcnR5NDxULCBUMSwgVDIsIFQzLCBUND4gZXh0ZW5kcyBEZXJpdmVkUHJvcGVydHk8VCwgVDEsIFQyLCBUMywgVDQsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlcj4ge31cclxuXHJcbmV4cG9ydCBjbGFzcyBEZXJpdmVkUHJvcGVydHk1PFQsIFQxLCBUMiwgVDMsIFQ0LCBUNT4gZXh0ZW5kcyBEZXJpdmVkUHJvcGVydHk8VCwgVDEsIFQyLCBUMywgVDQsIFQ1LCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlciwgbmV2ZXIsIG5ldmVyLCBuZXZlcj4ge31cclxuXHJcbmF4b24ucmVnaXN0ZXIoICdEZXJpdmVkUHJvcGVydHknLCBEZXJpdmVkUHJvcGVydHkgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxNQUFNLE1BQU0sMkJBQTJCO0FBQzlDLE9BQU9DLE1BQU0sTUFBTSxpQ0FBaUM7QUFDcEQsT0FBT0MsTUFBTSxNQUFNLGlDQUFpQztBQUNwRCxPQUFPQyxJQUFJLE1BQU0sV0FBVztBQUM1QixPQUFPQyxRQUFRLE1BQTJCLGVBQWU7QUFDekQsT0FBT0MsNkJBQTZCLE1BQU0sb0NBQW9DO0FBQzlFLE9BQU9DLGtCQUFrQixNQUFNLHlCQUF5QjtBQUd4RCxPQUFPQyxTQUFTLE1BQU0saUNBQWlDO0FBRXZELE9BQU9DLGdCQUFnQixNQUFNLHVCQUF1QjtBQUNwRCxPQUFPQyxZQUFZLE1BQU0saUNBQWlDO0FBRTFELE1BQU1DLDBCQUEwQixHQUFHLG1CQUFtQjtBQVV0RDtBQUNBO0FB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