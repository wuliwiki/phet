// Copyright 2016-2023, University of Colorado Boulder

/**
 * Property whose value must be a number.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Range from '../../dot/js/Range.js';
import optionize from '../../phet-core/js/optionize.js';
import Tandem from '../../tandem/js/Tandem.js';
import IOType from '../../tandem/js/types/IOType.js';
import NullableIO from '../../tandem/js/types/NullableIO.js';
import NumberIO from '../../tandem/js/types/NumberIO.js';
import StringIO from '../../tandem/js/types/StringIO.js';
import axon from './axon.js';
import ReadOnlyProperty from './ReadOnlyProperty.js';
import Property from './Property.js';
import validate from './validate.js';
import assertMutuallyExclusiveOptions from '../../phet-core/js/assertMutuallyExclusiveOptions.js';
const VALID_INTEGER = {
  valueType: 'number',
  isValidValue: v => v % 1 === 0,
  validationMessage: 'Should be a valid integer'
};
const VALID_NON_NAN = {
  isValidValue: v => !isNaN(v),
  validationMessage: 'Should not be NaN'
};
const VALIDATE_OPTIONS_FALSE = {
  validateValidator: false
};

// valid values for options.numberType to convey whether it is continuous or discrete with step size 1
const VALID_NUMBER_TYPES = ['FloatingPoint', 'Integer'];
// standardized tandem name for rangeProperty
const RANGE_PROPERTY_TANDEM_NAME = 'rangeProperty';
export const DEFAULT_RANGE = Range.EVERYTHING;
// For the IOType
const PropertyIOImpl = Property.PropertyIO(NumberIO);
export default class NumberProperty extends Property {
  // Used by PhET-iO in NumberPropertyIO as metadata passed to the wrapper.
  // @readonly, but cannot set as such because it is set by PhET-iO state.

  // validation for NumberProperty and its rangeProperty, undefined if assertions are disabled

  constructor(value, providedOptions) {
    // Please feel free to remove this if you have a reasonable case!
    assert && providedOptions && assertMutuallyExclusiveOptions(['range'], ['validValues']);
    const options = optionize()({
      // NumberPropertyOptions
      numberType: 'FloatingPoint',
      range: DEFAULT_RANGE,
      // PropertyOptions
      validators: [],
      tandem: Tandem.OPTIONAL,
      phetioOuterType: () => NumberProperty.NumberPropertyIO
    }, providedOptions);
    options.rangePropertyOptions = optionize()({
      phetioDocumentation: 'provides the range of possible values for the parent NumberProperty',
      phetioValueType: Range.RangeIO,
      phetioReadOnly: true,
      // If provided range is the default, don't instrument the PhET-iO RangeProperty
      tandem: options.range !== DEFAULT_RANGE ? options.tandem.createTandem(RANGE_PROPERTY_TANDEM_NAME) : Tandem.OPT_OUT
    }, options.rangePropertyOptions);
    if (assert && Tandem.VALIDATION && options.rangePropertyOptions.tandem && options.rangePropertyOptions.tandem.supplied) {
      assert && assert(options.rangePropertyOptions.tandem.name === RANGE_PROPERTY_TANDEM_NAME, `rangePropertyOptions.tandem.name must be ${RANGE_PROPERTY_TANDEM_NAME}: ${options.rangePropertyOptions.tandem.name}`);
    }

    // client cannot specify superclass options that are controlled by NumberProperty
    options.valueType = 'number';
    options.phetioValueType = NumberIO; // not actually used, but for completeness, don't have ReadOnlyProperty storing the wrong default.

    const rangePropertyProvided = options.range && options.range instanceof ReadOnlyProperty;
    const ownsRangeProperty = !rangePropertyProvided;
    const rangeProperty = options.range instanceof ReadOnlyProperty ? options.range : new Property(options.range, options.rangePropertyOptions);
    options.validators.push(VALID_NON_NAN); // seems right for this to run first
    if (options.numberType === 'Integer') {
      options.validators.push(VALID_INTEGER);
    }
    options.validators.push({
      isValidValue: v => rangeProperty.value.contains(v),
      validationMessage: 'Number must be within rangeProperty value.'
    });
    super(value, options);
    this.numberType = options.numberType;
    this.rangeProperty = rangeProperty;
    if (assert && Tandem.VALIDATION && this.rangeProperty.isPhetioInstrumented()) {
      assert && assert(this.isPhetioInstrumented(), 'NumberProperty must be phet-io instrumented if the range is');
    }
    const rangePropertyObserver = () => {
      validate(this.value, this.valueValidator, VALIDATE_OPTIONS_FALSE);
    };
    assert && this.rangeProperty.link(rangePropertyObserver);

    // For PhET-iO State, make sure that both the range and this value are correct before firing notifications (where the assertions are).
    this.rangeProperty.addPhetioStateDependencies([this]);
    this.addPhetioStateDependencies([this.rangeProperty]);

    // verify that validValues meet other NumberProperty-specific validation criteria
    if (options.validValues && this.validateNumberAndRangeProperty) {
      for (let i = 0; i < options.validValues.length; i++) {
        const validValue = options.validValues[i];
        this.validateNumberAndRangeProperty(validValue);
      }
    }
    this.disposeNumberProperty = () => {
      if (ownsRangeProperty) {
        this.rangeProperty.dispose();
      } else if (assert) {
        this.rangeProperty.unlink(rangePropertyObserver);
      }
    };
    this.resetNumberProperty = () => {
      ownsRangeProperty && this.rangeProperty.reset();
    };
  }
  get range() {
    return this.rangeProperty.value;
  }

  /**
   * Convenience function for setting the rangeProperty. Note: be careful using this function, as validation will occur
   * immediately, and if the value is outside of this new Range an error will occur. See this.setValueAndRange() for
   *  way to set both at once without assertion errors.
   */
  set range(range) {
    this.rangeProperty.value = range;
  }
  reset() {
    this.resetValueAndRange(); // even if we don't own the range, reset them together to prevent assertions, https://github.com/phetsims/axon/issues/427
    super.reset();
  }
  dispose() {
    this.disposeNumberProperty();
    super.dispose();
  }

  /**
   * An atomic setting function that will set a range and a value at the same time, to make sure that validation does
   * not fail after one but has been set not the other.
   */
  setValueAndRange(value, range) {
    assert && assert(range.contains(value), `value ${value} is not in range [${range.min},${range.max}]`);

    // defer notification of listeners
    this.setDeferred(true);
    this.rangeProperty.setDeferred(true);

    // set values
    this.set(value);
    this.rangeProperty.set(range);

    // notify listeners if the values have changed
    const notifyValueListeners = this.setDeferred(false);
    const notifyRangeListeners = this.rangeProperty.setDeferred(false);
    notifyValueListeners && notifyValueListeners();
    notifyRangeListeners && notifyRangeListeners();
  }

  /**
   * Resets the value and range atomically.
   * If you use setValueAndRange, you'll likely need to use this instead of reset.
   */
  resetValueAndRange() {
    this.setValueAndRange(this.initialValue, this.rangeProperty.initialValue);
  }

  /**
   * Get parent state and append NumberProperty-specific metadata to it.
   */
  toStateObject() {
    const parentStateObject = PropertyIOImpl.toStateObject(this);
    parentStateObject.numberType = this.numberType;
    parentStateObject.range = Range.RangeIO.toStateObject(this.rangeProperty.value);
    const hasRangePhetioID = this.rangeProperty && this.rangeProperty.isPhetioInstrumented();
    parentStateObject.rangePhetioID = hasRangePhetioID ? this.rangeProperty.tandem.phetioID : null;
    return parentStateObject;
  }
  static NumberPropertyIO = new IOType('NumberPropertyIO', {
    valueType: NumberProperty,
    supertype: PropertyIOImpl,
    parameterTypes: [NumberIO],
    documentation: `Extends PropertyIO to add values for the numeric range ( min, max ) and numberType ( '${VALID_NUMBER_TYPES.join('\' | \'')}' )`,
    toStateObject: numberProperty => {
      return numberProperty.toStateObject();
    },
    applyState: (numberProperty, stateObject) => {
      // nothing to do here for range, because in order to support range, this NumberProperty's rangeProperty must be instrumented.

      PropertyIOImpl.applyState(numberProperty, stateObject);
    },
    stateSchema: {
      numberType: StringIO,
      range: Range.RangeIO,
      rangePhetioID: NullableIO(StringIO),
      value: NumberIO
    }
  });
}
axon.register('NumberProperty', NumberProperty);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSYW5nZSIsIm9wdGlvbml6ZSIsIlRhbmRlbSIsIklPVHlwZSIsIk51bGxhYmxlSU8iLCJOdW1iZXJJTyIsIlN0cmluZ0lPIiwiYXhvbiIsIlJlYWRPbmx5UHJvcGVydHkiLCJQcm9wZXJ0eSIsInZhbGlkYXRlIiwiYXNzZXJ0TXV0dWFsbHlFeGNsdXNpdmVPcHRpb25zIiwiVkFMSURfSU5URUdFUiIsInZhbHVlVHlwZSIsImlzVmFsaWRWYWx1ZSIsInYiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIlZBTElEX05PTl9OQU4iLCJpc05hTiIsIlZBTElEQVRFX09QVElPTlNfRkFMU0UiLCJ2YWxpZGF0ZVZhbGlkYXRvciIsIlZBTElEX05VTUJFUl9UWVBFUyIsIlJBTkdFX1BST1BFUlRZX1RBTkRFTV9OQU1FIiwiREVGQVVMVF9SQU5HRSIsIkVWRVJZVEhJTkciLCJQcm9wZXJ0eUlPSW1wbCIsIlByb3BlcnR5SU8iLCJOdW1iZXJQcm9wZXJ0eSIsImNvbnN0cnVjdG9yIiwidmFsdWUiLCJwcm92aWRlZE9wdGlvbnMiLCJhc3NlcnQiLCJvcHRpb25zIiwibnVtYmVyVHlwZSIsInJhbmdlIiwidmFsaWRhdG9ycyIsInRhbmRlbSIsIk9QVElPTkFMIiwicGhldGlvT3V0ZXJUeXBlIiwiTnVtYmVyUHJvcGVydHlJTyIsInJhbmdlUHJvcGVydHlPcHRpb25zIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsInBoZXRpb1ZhbHVlVHlwZSIsIlJhbmdlSU8iLCJwaGV0aW9SZWFkT25seSIsImNyZWF0ZVRhbmRlbSIsIk9QVF9PVVQiLCJWQUxJREFUSU9OIiwic3VwcGxpZWQiLCJuYW1lIiwicmFuZ2VQcm9wZXJ0eVByb3ZpZGVkIiwib3duc1JhbmdlUHJvcGVydHkiLCJyYW5nZVByb3BlcnR5IiwicHVzaCIsImNvbnRhaW5zIiwiaXNQaGV0aW9JbnN0cnVtZW50ZWQiLCJyYW5nZVByb3BlcnR5T2JzZXJ2ZXIiLCJ2YWx1ZVZhbGlkYXRvciIsImxpbmsiLCJhZGRQaGV0aW9TdGF0ZURlcGVuZGVuY2llcyIsInZhbGlkVmFsdWVzIiwidmFsaWRhdGVOdW1iZXJBbmRSYW5nZVByb3BlcnR5IiwiaSIsImxlbmd0aCIsInZhbGlkVmFsdWUiLCJkaXNwb3NlTnVtYmVyUHJvcGVydHkiLCJkaXNwb3NlIiwidW5saW5rIiwicmVzZXROdW1iZXJQcm9wZXJ0eSIsInJlc2V0IiwicmVzZXRWYWx1ZUFuZFJhbmdlIiwic2V0VmFsdWVBbmRSYW5nZSIsIm1pbiIsIm1heCIsInNldERlZmVycmVkIiwic2V0Iiwibm90aWZ5VmFsdWVMaXN0ZW5lcnMiLCJub3RpZnlSYW5nZUxpc3RlbmVycyIsImluaXRpYWxWYWx1ZSIsInRvU3RhdGVPYmplY3QiLCJwYXJlbnRTdGF0ZU9iamVjdCIsImhhc1JhbmdlUGhldGlvSUQiLCJyYW5nZVBoZXRpb0lEIiwicGhldGlvSUQiLCJzdXBlcnR5cGUiLCJwYXJhbWV0ZXJUeXBlcyIsImRvY3VtZW50YXRpb24iLCJqb2luIiwibnVtYmVyUHJvcGVydHkiLCJhcHBseVN0YXRlIiwic3RhdGVPYmplY3QiLCJzdGF0ZVNjaGVtYSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTnVtYmVyUHJvcGVydHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogUHJvcGVydHkgd2hvc2UgdmFsdWUgbXVzdCBiZSBhIG51bWJlci5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgUmFuZ2UsIHsgUmFuZ2VTdGF0ZU9iamVjdCB9IGZyb20gJy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBJT1R5cGUgZnJvbSAnLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0lPVHlwZS5qcyc7XHJcbmltcG9ydCBOdWxsYWJsZUlPIGZyb20gJy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdWxsYWJsZUlPLmpzJztcclxuaW1wb3J0IE51bWJlcklPIGZyb20gJy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdW1iZXJJTy5qcyc7XHJcbmltcG9ydCBTdHJpbmdJTyBmcm9tICcuLi8uLi90YW5kZW0vanMvdHlwZXMvU3RyaW5nSU8uanMnO1xyXG5pbXBvcnQgYXhvbiBmcm9tICcuL2F4b24uanMnO1xyXG5pbXBvcnQgUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuL1JlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUHJvcGVydHksIHsgUHJvcGVydHlPcHRpb25zIH0gZnJvbSAnLi9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCB2YWxpZGF0ZSBmcm9tICcuL3ZhbGlkYXRlLmpzJztcclxuaW1wb3J0IFRSYW5nZWRQcm9wZXJ0eSBmcm9tICcuL1RSYW5nZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBhc3NlcnRNdXR1YWxseUV4Y2x1c2l2ZU9wdGlvbnMgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL2Fzc2VydE11dHVhbGx5RXhjbHVzaXZlT3B0aW9ucy5qcyc7XHJcblxyXG5jb25zdCBWQUxJRF9JTlRFR0VSID0geyB2YWx1ZVR5cGU6ICdudW1iZXInLCBpc1ZhbGlkVmFsdWU6ICggdjogbnVtYmVyICkgPT4gdiAlIDEgPT09IDAsIHZhbGlkYXRpb25NZXNzYWdlOiAnU2hvdWxkIGJlIGEgdmFsaWQgaW50ZWdlcicgfTtcclxuY29uc3QgVkFMSURfTk9OX05BTiA9IHsgaXNWYWxpZFZhbHVlOiAoIHY6IG51bWJlciApID0+ICFpc05hTiggdiApLCB2YWxpZGF0aW9uTWVzc2FnZTogJ1Nob3VsZCBub3QgYmUgTmFOJyB9O1xyXG5jb25zdCBWQUxJREFURV9PUFRJT05TX0ZBTFNFID0geyB2YWxpZGF0ZVZhbGlkYXRvcjogZmFsc2UgfTtcclxuXHJcbi8vIHZhbGlkIHZhbHVlcyBmb3Igb3B0aW9ucy5udW1iZXJUeXBlIHRvIGNvbnZleSB3aGV0aGVyIGl0IGlzIGNvbnRpbnVvdXMgb3IgZGlzY3JldGUgd2l0aCBzdGVwIHNpemUgMVxyXG5jb25zdCBWQUxJRF9OVU1CRVJfVFlQRVMgPSBbICdGbG9hdGluZ1BvaW50JywgJ0ludGVnZXInIF0gYXMgY29uc3Q7XHJcbnR5cGUgTnVtYmVyVHlwZSA9IHR5cGVvZiBWQUxJRF9OVU1CRVJfVFlQRVNbbnVtYmVyXTtcclxuXHJcbi8vIHN0YW5kYXJkaXplZCB0YW5kZW0gbmFtZSBmb3IgcmFuZ2VQcm9wZXJ0eVxyXG5jb25zdCBSQU5HRV9QUk9QRVJUWV9UQU5ERU1fTkFNRSA9ICdyYW5nZVByb3BlcnR5JztcclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1JBTkdFID0gUmFuZ2UuRVZFUllUSElORztcclxuXHJcbmV4cG9ydCB0eXBlIE51bWJlclByb3BlcnR5U3RhdGUgPSB7XHJcbiAgbnVtYmVyVHlwZTogc3RyaW5nO1xyXG4gIHJhbmdlOiBSYW5nZVN0YXRlT2JqZWN0O1xyXG4gIHJhbmdlUGhldGlvSUQ6IHN0cmluZyB8IG51bGw7XHJcbn0gJiBSZWFkT25seVByb3BlcnR5PG51bWJlcj47XHJcblxyXG4vLyBGb3IgdGhlIElPVHlwZVxyXG5jb25zdCBQcm9wZXJ0eUlPSW1wbCA9IFByb3BlcnR5LlByb3BlcnR5SU8oIE51bWJlcklPICk7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIG51bWJlclR5cGU/OiBOdW1iZXJUeXBlO1xyXG4gIHJhbmdlPzogUmFuZ2UgfCBQcm9wZXJ0eTxSYW5nZT47XHJcblxyXG4gIC8vIFBhc3NlZCB0byB0aGlzLnJhbmdlUHJvcGVydHkgaWYgTnVtYmVyUHJvcGVydHkgY3JlYXRlcyBpdC4gSWdub3JlZCBpZiBhIFByb3BlcnR5IGlzIHByb3ZpZGVkIHZpYSBvcHRpb25zLnJhbmdlLlxyXG4gIHJhbmdlUHJvcGVydHlPcHRpb25zPzogUHJvcGVydHlPcHRpb25zPFJhbmdlPjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIE51bWJlclByb3BlcnR5T3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxQcm9wZXJ0eU9wdGlvbnM8bnVtYmVyPiwgJ3BoZXRpb1ZhbHVlVHlwZScgfCAndmFsdWVUeXBlJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOdW1iZXJQcm9wZXJ0eSBleHRlbmRzIFByb3BlcnR5PG51bWJlcj4gaW1wbGVtZW50cyBUUmFuZ2VkUHJvcGVydHkge1xyXG5cclxuICAvLyBVc2VkIGJ5IFBoRVQtaU8gaW4gTnVtYmVyUHJvcGVydHlJTyBhcyBtZXRhZGF0YSBwYXNzZWQgdG8gdGhlIHdyYXBwZXIuXHJcbiAgLy8gQHJlYWRvbmx5LCBidXQgY2Fubm90IHNldCBhcyBzdWNoIGJlY2F1c2UgaXQgaXMgc2V0IGJ5IFBoRVQtaU8gc3RhdGUuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBudW1iZXJUeXBlOiBOdW1iZXJUeXBlO1xyXG5cclxuICAvLyB2YWxpZGF0aW9uIGZvciBOdW1iZXJQcm9wZXJ0eSBhbmQgaXRzIHJhbmdlUHJvcGVydHksIHVuZGVmaW5lZCBpZiBhc3NlcnRpb25zIGFyZSBkaXNhYmxlZFxyXG4gIHByaXZhdGUgcmVhZG9ubHkgdmFsaWRhdGVOdW1iZXJBbmRSYW5nZVByb3BlcnR5OiAoICggdmFsdWU6IG51bWJlciApID0+IHZvaWQgKSB8IHVuZGVmaW5lZDtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IHJhbmdlUHJvcGVydHk6IFByb3BlcnR5PFJhbmdlPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VOdW1iZXJQcm9wZXJ0eTogKCkgPT4gdm9pZDtcclxuICBwcml2YXRlIHJlYWRvbmx5IHJlc2V0TnVtYmVyUHJvcGVydHk6ICgpID0+IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggdmFsdWU6IG51bWJlciwgcHJvdmlkZWRPcHRpb25zPzogTnVtYmVyUHJvcGVydHlPcHRpb25zICkge1xyXG5cclxuICAgIC8vIFBsZWFzZSBmZWVsIGZyZWUgdG8gcmVtb3ZlIHRoaXMgaWYgeW91IGhhdmUgYSByZWFzb25hYmxlIGNhc2UhXHJcbiAgICBhc3NlcnQgJiYgcHJvdmlkZWRPcHRpb25zICYmIGFzc2VydE11dHVhbGx5RXhjbHVzaXZlT3B0aW9ucyggWyAncmFuZ2UnIF0sIFsgJ3ZhbGlkVmFsdWVzJyBdICk7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxOdW1iZXJQcm9wZXJ0eU9wdGlvbnMsIFN0cmljdE9taXQ8U2VsZk9wdGlvbnMsICdyYW5nZVByb3BlcnR5T3B0aW9ucyc+LCBQcm9wZXJ0eU9wdGlvbnM8bnVtYmVyPj4oKSgge1xyXG5cclxuICAgICAgLy8gTnVtYmVyUHJvcGVydHlPcHRpb25zXHJcbiAgICAgIG51bWJlclR5cGU6ICdGbG9hdGluZ1BvaW50JyxcclxuICAgICAgcmFuZ2U6IERFRkFVTFRfUkFOR0UsXHJcblxyXG4gICAgICAvLyBQcm9wZXJ0eU9wdGlvbnNcclxuICAgICAgdmFsaWRhdG9yczogW10sXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLk9QVElPTkFMLFxyXG5cclxuICAgICAgcGhldGlvT3V0ZXJUeXBlOiAoKSA9PiBOdW1iZXJQcm9wZXJ0eS5OdW1iZXJQcm9wZXJ0eUlPXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBvcHRpb25zLnJhbmdlUHJvcGVydHlPcHRpb25zID0gb3B0aW9uaXplPFByb3BlcnR5T3B0aW9uczxSYW5nZT4sIEVtcHR5U2VsZk9wdGlvbnMsIFByb3BlcnR5T3B0aW9uczxSYW5nZT4+KCkoIHtcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ3Byb3ZpZGVzIHRoZSByYW5nZSBvZiBwb3NzaWJsZSB2YWx1ZXMgZm9yIHRoZSBwYXJlbnQgTnVtYmVyUHJvcGVydHknLFxyXG4gICAgICBwaGV0aW9WYWx1ZVR5cGU6IFJhbmdlLlJhbmdlSU8sXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlLFxyXG5cclxuICAgICAgLy8gSWYgcHJvdmlkZWQgcmFuZ2UgaXMgdGhlIGRlZmF1bHQsIGRvbid0IGluc3RydW1lbnQgdGhlIFBoRVQtaU8gUmFuZ2VQcm9wZXJ0eVxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMucmFuZ2UgIT09IERFRkFVTFRfUkFOR0UgPyBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oIFJBTkdFX1BST1BFUlRZX1RBTkRFTV9OQU1FICkgOiBUYW5kZW0uT1BUX09VVFxyXG4gICAgfSwgb3B0aW9ucy5yYW5nZVByb3BlcnR5T3B0aW9ucyApO1xyXG5cclxuICAgIGlmICggYXNzZXJ0ICYmIFRhbmRlbS5WQUxJREFUSU9OICYmIG9wdGlvbnMucmFuZ2VQcm9wZXJ0eU9wdGlvbnMudGFuZGVtICYmIG9wdGlvbnMucmFuZ2VQcm9wZXJ0eU9wdGlvbnMudGFuZGVtLnN1cHBsaWVkICkge1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zLnJhbmdlUHJvcGVydHlPcHRpb25zLnRhbmRlbS5uYW1lID09PSBSQU5HRV9QUk9QRVJUWV9UQU5ERU1fTkFNRSxcclxuICAgICAgICBgcmFuZ2VQcm9wZXJ0eU9wdGlvbnMudGFuZGVtLm5hbWUgbXVzdCBiZSAke1JBTkdFX1BST1BFUlRZX1RBTkRFTV9OQU1FfTogJHtvcHRpb25zLnJhbmdlUHJvcGVydHlPcHRpb25zLnRhbmRlbS5uYW1lfWAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBjbGllbnQgY2Fubm90IHNwZWNpZnkgc3VwZXJjbGFzcyBvcHRpb25zIHRoYXQgYXJlIGNvbnRyb2xsZWQgYnkgTnVtYmVyUHJvcGVydHlcclxuICAgIG9wdGlvbnMudmFsdWVUeXBlID0gJ251bWJlcic7XHJcbiAgICBvcHRpb25zLnBoZXRpb1ZhbHVlVHlwZSA9IE51bWJlcklPOyAvLyBub3QgYWN0dWFsbHkgdXNlZCwgYnV0IGZvciBjb21wbGV0ZW5lc3MsIGRvbid0IGhhdmUgUmVhZE9ubHlQcm9wZXJ0eSBzdG9yaW5nIHRoZSB3cm9uZyBkZWZhdWx0LlxyXG5cclxuICAgIGNvbnN0IHJhbmdlUHJvcGVydHlQcm92aWRlZCA9IG9wdGlvbnMucmFuZ2UgJiYgb3B0aW9ucy5yYW5nZSBpbnN0YW5jZW9mIFJlYWRPbmx5UHJvcGVydHk7XHJcbiAgICBjb25zdCBvd25zUmFuZ2VQcm9wZXJ0eSA9ICFyYW5nZVByb3BlcnR5UHJvdmlkZWQ7XHJcblxyXG4gICAgY29uc3QgcmFuZ2VQcm9wZXJ0eSA9IG9wdGlvbnMucmFuZ2UgaW5zdGFuY2VvZiBSZWFkT25seVByb3BlcnR5ID8gb3B0aW9ucy5yYW5nZSA6IG5ldyBQcm9wZXJ0eSggb3B0aW9ucy5yYW5nZSwgb3B0aW9ucy5yYW5nZVByb3BlcnR5T3B0aW9ucyApO1xyXG5cclxuICAgIG9wdGlvbnMudmFsaWRhdG9ycy5wdXNoKCBWQUxJRF9OT05fTkFOICk7IC8vIHNlZW1zIHJpZ2h0IGZvciB0aGlzIHRvIHJ1biBmaXJzdFxyXG4gICAgaWYgKCBvcHRpb25zLm51bWJlclR5cGUgPT09ICdJbnRlZ2VyJyApIHtcclxuICAgICAgb3B0aW9ucy52YWxpZGF0b3JzLnB1c2goIFZBTElEX0lOVEVHRVIgKTtcclxuICAgIH1cclxuICAgIG9wdGlvbnMudmFsaWRhdG9ycy5wdXNoKCB7XHJcbiAgICAgIGlzVmFsaWRWYWx1ZTogdiA9PiByYW5nZVByb3BlcnR5LnZhbHVlLmNvbnRhaW5zKCB2ICksXHJcbiAgICAgIHZhbGlkYXRpb25NZXNzYWdlOiAnTnVtYmVyIG11c3QgYmUgd2l0aGluIHJhbmdlUHJvcGVydHkgdmFsdWUuJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHN1cGVyKCB2YWx1ZSwgb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMubnVtYmVyVHlwZSA9IG9wdGlvbnMubnVtYmVyVHlwZTtcclxuICAgIHRoaXMucmFuZ2VQcm9wZXJ0eSA9IHJhbmdlUHJvcGVydHk7XHJcblxyXG4gICAgaWYgKCBhc3NlcnQgJiYgVGFuZGVtLlZBTElEQVRJT04gJiYgdGhpcy5yYW5nZVByb3BlcnR5LmlzUGhldGlvSW5zdHJ1bWVudGVkKCkgKSB7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuaXNQaGV0aW9JbnN0cnVtZW50ZWQoKSwgJ051bWJlclByb3BlcnR5IG11c3QgYmUgcGhldC1pbyBpbnN0cnVtZW50ZWQgaWYgdGhlIHJhbmdlIGlzJyApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJhbmdlUHJvcGVydHlPYnNlcnZlciA9ICgpID0+IHtcclxuICAgICAgdmFsaWRhdGUoIHRoaXMudmFsdWUsIHRoaXMudmFsdWVWYWxpZGF0b3IsIFZBTElEQVRFX09QVElPTlNfRkFMU0UgKTtcclxuICAgIH07XHJcbiAgICBhc3NlcnQgJiYgdGhpcy5yYW5nZVByb3BlcnR5LmxpbmsoIHJhbmdlUHJvcGVydHlPYnNlcnZlciApO1xyXG5cclxuICAgIC8vIEZvciBQaEVULWlPIFN0YXRlLCBtYWtlIHN1cmUgdGhhdCBib3RoIHRoZSByYW5nZSBhbmQgdGhpcyB2YWx1ZSBhcmUgY29ycmVjdCBiZWZvcmUgZmlyaW5nIG5vdGlmaWNhdGlvbnMgKHdoZXJlIHRoZSBhc3NlcnRpb25zIGFyZSkuXHJcbiAgICB0aGlzLnJhbmdlUHJvcGVydHkuYWRkUGhldGlvU3RhdGVEZXBlbmRlbmNpZXMoIFsgdGhpcyBdICk7XHJcbiAgICB0aGlzLmFkZFBoZXRpb1N0YXRlRGVwZW5kZW5jaWVzKCBbIHRoaXMucmFuZ2VQcm9wZXJ0eSBdICk7XHJcblxyXG4gICAgLy8gdmVyaWZ5IHRoYXQgdmFsaWRWYWx1ZXMgbWVldCBvdGhlciBOdW1iZXJQcm9wZXJ0eS1zcGVjaWZpYyB2YWxpZGF0aW9uIGNyaXRlcmlhXHJcbiAgICBpZiAoIG9wdGlvbnMudmFsaWRWYWx1ZXMgJiYgdGhpcy52YWxpZGF0ZU51bWJlckFuZFJhbmdlUHJvcGVydHkgKSB7XHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IG9wdGlvbnMudmFsaWRWYWx1ZXMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgY29uc3QgdmFsaWRWYWx1ZSA9IG9wdGlvbnMudmFsaWRWYWx1ZXNbIGkgXTtcclxuICAgICAgICB0aGlzLnZhbGlkYXRlTnVtYmVyQW5kUmFuZ2VQcm9wZXJ0eSggdmFsaWRWYWx1ZSApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlTnVtYmVyUHJvcGVydHkgPSAoKSA9PiB7XHJcbiAgICAgIGlmICggb3duc1JhbmdlUHJvcGVydHkgKSB7XHJcbiAgICAgICAgdGhpcy5yYW5nZVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggYXNzZXJ0ICkge1xyXG4gICAgICAgIHRoaXMucmFuZ2VQcm9wZXJ0eS51bmxpbmsoIHJhbmdlUHJvcGVydHlPYnNlcnZlciApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucmVzZXROdW1iZXJQcm9wZXJ0eSA9ICgpID0+IHtcclxuICAgICAgb3duc1JhbmdlUHJvcGVydHkgJiYgdGhpcy5yYW5nZVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCByYW5nZSgpOiBSYW5nZSB7XHJcbiAgICByZXR1cm4gdGhpcy5yYW5nZVByb3BlcnR5LnZhbHVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29udmVuaWVuY2UgZnVuY3Rpb24gZm9yIHNldHRpbmcgdGhlIHJhbmdlUHJvcGVydHkuIE5vdGU6IGJlIGNhcmVmdWwgdXNpbmcgdGhpcyBmdW5jdGlvbiwgYXMgdmFsaWRhdGlvbiB3aWxsIG9jY3VyXHJcbiAgICogaW1tZWRpYXRlbHksIGFuZCBpZiB0aGUgdmFsdWUgaXMgb3V0c2lkZSBvZiB0aGlzIG5ldyBSYW5nZSBhbiBlcnJvciB3aWxsIG9jY3VyLiBTZWUgdGhpcy5zZXRWYWx1ZUFuZFJhbmdlKCkgZm9yXHJcbiAgICogIHdheSB0byBzZXQgYm90aCBhdCBvbmNlIHdpdGhvdXQgYXNzZXJ0aW9uIGVycm9ycy5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0IHJhbmdlKCByYW5nZTogUmFuZ2UgKSB7XHJcbiAgICB0aGlzLnJhbmdlUHJvcGVydHkudmFsdWUgPSByYW5nZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMucmVzZXRWYWx1ZUFuZFJhbmdlKCk7IC8vIGV2ZW4gaWYgd2UgZG9uJ3Qgb3duIHRoZSByYW5nZSwgcmVzZXQgdGhlbSB0b2dldGhlciB0byBwcmV2ZW50IGFzc2VydGlvbnMsIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9heG9uL2lzc3Vlcy80MjdcclxuICAgIHN1cGVyLnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZU51bWJlclByb3BlcnR5KCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBbiBhdG9taWMgc2V0dGluZyBmdW5jdGlvbiB0aGF0IHdpbGwgc2V0IGEgcmFuZ2UgYW5kIGEgdmFsdWUgYXQgdGhlIHNhbWUgdGltZSwgdG8gbWFrZSBzdXJlIHRoYXQgdmFsaWRhdGlvbiBkb2VzXHJcbiAgICogbm90IGZhaWwgYWZ0ZXIgb25lIGJ1dCBoYXMgYmVlbiBzZXQgbm90IHRoZSBvdGhlci5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0VmFsdWVBbmRSYW5nZSggdmFsdWU6IG51bWJlciwgcmFuZ2U6IFJhbmdlICk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggcmFuZ2UuY29udGFpbnMoIHZhbHVlICksIGB2YWx1ZSAke3ZhbHVlfSBpcyBub3QgaW4gcmFuZ2UgWyR7cmFuZ2UubWlufSwke3JhbmdlLm1heH1dYCApO1xyXG5cclxuICAgIC8vIGRlZmVyIG5vdGlmaWNhdGlvbiBvZiBsaXN0ZW5lcnNcclxuICAgIHRoaXMuc2V0RGVmZXJyZWQoIHRydWUgKTtcclxuICAgIHRoaXMucmFuZ2VQcm9wZXJ0eS5zZXREZWZlcnJlZCggdHJ1ZSApO1xyXG5cclxuICAgIC8vIHNldCB2YWx1ZXNcclxuICAgIHRoaXMuc2V0KCB2YWx1ZSApO1xyXG4gICAgdGhpcy5yYW5nZVByb3BlcnR5LnNldCggcmFuZ2UgKTtcclxuXHJcbiAgICAvLyBub3RpZnkgbGlzdGVuZXJzIGlmIHRoZSB2YWx1ZXMgaGF2ZSBjaGFuZ2VkXHJcbiAgICBjb25zdCBub3RpZnlWYWx1ZUxpc3RlbmVycyA9IHRoaXMuc2V0RGVmZXJyZWQoIGZhbHNlICk7XHJcbiAgICBjb25zdCBub3RpZnlSYW5nZUxpc3RlbmVycyA9IHRoaXMucmFuZ2VQcm9wZXJ0eS5zZXREZWZlcnJlZCggZmFsc2UgKTtcclxuICAgIG5vdGlmeVZhbHVlTGlzdGVuZXJzICYmIG5vdGlmeVZhbHVlTGlzdGVuZXJzKCk7XHJcbiAgICBub3RpZnlSYW5nZUxpc3RlbmVycyAmJiBub3RpZnlSYW5nZUxpc3RlbmVycygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXRzIHRoZSB2YWx1ZSBhbmQgcmFuZ2UgYXRvbWljYWxseS5cclxuICAgKiBJZiB5b3UgdXNlIHNldFZhbHVlQW5kUmFuZ2UsIHlvdSdsbCBsaWtlbHkgbmVlZCB0byB1c2UgdGhpcyBpbnN0ZWFkIG9mIHJlc2V0LlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldFZhbHVlQW5kUmFuZ2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLnNldFZhbHVlQW5kUmFuZ2UoIHRoaXMuaW5pdGlhbFZhbHVlLCB0aGlzLnJhbmdlUHJvcGVydHkuaW5pdGlhbFZhbHVlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgcGFyZW50IHN0YXRlIGFuZCBhcHBlbmQgTnVtYmVyUHJvcGVydHktc3BlY2lmaWMgbWV0YWRhdGEgdG8gaXQuXHJcbiAgICovXHJcbiAgcHVibGljIHRvU3RhdGVPYmplY3QoKTogTnVtYmVyUHJvcGVydHlTdGF0ZSB7XHJcbiAgICBjb25zdCBwYXJlbnRTdGF0ZU9iamVjdCA9IFByb3BlcnR5SU9JbXBsLnRvU3RhdGVPYmplY3QoIHRoaXMgKTtcclxuXHJcbiAgICBwYXJlbnRTdGF0ZU9iamVjdC5udW1iZXJUeXBlID0gdGhpcy5udW1iZXJUeXBlO1xyXG4gICAgcGFyZW50U3RhdGVPYmplY3QucmFuZ2UgPSBSYW5nZS5SYW5nZUlPLnRvU3RhdGVPYmplY3QoIHRoaXMucmFuZ2VQcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICAgIGNvbnN0IGhhc1JhbmdlUGhldGlvSUQgPSB0aGlzLnJhbmdlUHJvcGVydHkgJiYgdGhpcy5yYW5nZVByb3BlcnR5LmlzUGhldGlvSW5zdHJ1bWVudGVkKCk7XHJcbiAgICBwYXJlbnRTdGF0ZU9iamVjdC5yYW5nZVBoZXRpb0lEID0gaGFzUmFuZ2VQaGV0aW9JRCA/IHRoaXMucmFuZ2VQcm9wZXJ0eS50YW5kZW0ucGhldGlvSUQgOiBudWxsO1xyXG5cclxuICAgIHJldHVybiBwYXJlbnRTdGF0ZU9iamVjdDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgTnVtYmVyUHJvcGVydHlJTyA9IG5ldyBJT1R5cGU8TnVtYmVyUHJvcGVydHksIE51bWJlclByb3BlcnR5U3RhdGU+KCAnTnVtYmVyUHJvcGVydHlJTycsIHtcclxuICAgIHZhbHVlVHlwZTogTnVtYmVyUHJvcGVydHksXHJcbiAgICBzdXBlcnR5cGU6IFByb3BlcnR5SU9JbXBsLFxyXG5cclxuICAgIHBhcmFtZXRlclR5cGVzOiBbIE51bWJlcklPIF0sXHJcbiAgICBkb2N1bWVudGF0aW9uOiBgRXh0ZW5kcyBQcm9wZXJ0eUlPIHRvIGFkZCB2YWx1ZXMgZm9yIHRoZSBudW1lcmljIHJhbmdlICggbWluLCBtYXggKSBhbmQgbnVtYmVyVHlwZSAoICcke1xyXG4gICAgICBWQUxJRF9OVU1CRVJfVFlQRVMuam9pbiggJ1xcJyB8IFxcJycgKX0nIClgLFxyXG4gICAgdG9TdGF0ZU9iamVjdDogbnVtYmVyUHJvcGVydHkgPT4ge1xyXG4gICAgICByZXR1cm4gbnVtYmVyUHJvcGVydHkudG9TdGF0ZU9iamVjdCgpO1xyXG4gICAgfSxcclxuICAgIGFwcGx5U3RhdGU6ICggbnVtYmVyUHJvcGVydHksIHN0YXRlT2JqZWN0ICkgPT4ge1xyXG4gICAgICAvLyBub3RoaW5nIHRvIGRvIGhlcmUgZm9yIHJhbmdlLCBiZWNhdXNlIGluIG9yZGVyIHRvIHN1cHBvcnQgcmFuZ2UsIHRoaXMgTnVtYmVyUHJvcGVydHkncyByYW5nZVByb3BlcnR5IG11c3QgYmUgaW5zdHJ1bWVudGVkLlxyXG5cclxuICAgICAgUHJvcGVydHlJT0ltcGwuYXBwbHlTdGF0ZSggbnVtYmVyUHJvcGVydHksIHN0YXRlT2JqZWN0ICk7XHJcbiAgICB9LFxyXG4gICAgc3RhdGVTY2hlbWE6IHtcclxuICAgICAgbnVtYmVyVHlwZTogU3RyaW5nSU8sXHJcbiAgICAgIHJhbmdlOiBSYW5nZS5SYW5nZUlPLFxyXG4gICAgICByYW5nZVBoZXRpb0lEOiBOdWxsYWJsZUlPKCBTdHJpbmdJTyApLFxyXG4gICAgICB2YWx1ZTogTnVtYmVySU9cclxuICAgIH1cclxuICB9ICk7XHJcbn1cclxuXHJcbmF4b24ucmVnaXN0ZXIoICdOdW1iZXJQcm9wZXJ0eScsIE51bWJlclByb3BlcnR5ICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBNEIsdUJBQXVCO0FBRS9ELE9BQU9DLFNBQVMsTUFBNEIsaUNBQWlDO0FBQzdFLE9BQU9DLE1BQU0sTUFBTSwyQkFBMkI7QUFDOUMsT0FBT0MsTUFBTSxNQUFNLGlDQUFpQztBQUNwRCxPQUFPQyxVQUFV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