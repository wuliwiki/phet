// Copyright 2017-2022, University of Colorado Boulder

/**
 * QUnit tests for DynamicProperty
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import DynamicProperty from './DynamicProperty.js';
import Property from './Property.js';
QUnit.module('DynamicProperty');
QUnit.test('Basics', assert => {
  const aProperty = new Property(5);
  const bProperty = new Property(2);
  const propertyProperty = new Property(aProperty);
  const dynamicProperty = new DynamicProperty(propertyProperty);
  assert.equal(dynamicProperty.value, aProperty.value);
  propertyProperty.value = bProperty;
  assert.equal(dynamicProperty.value, bProperty.value);
  bProperty.value = 7;
  assert.equal(dynamicProperty.value, bProperty.value);
  aProperty.value = 10;
  propertyProperty.value = aProperty;
  assert.equal(dynamicProperty.value, aProperty.value);
});
QUnit.test('Derive (string)', assert => {
  const a = {
    property: new Property(5)
  };
  const b = {
    property: new Property(2)
  };
  const mainProperty = new Property(a);
  const dynamicProperty = new DynamicProperty(mainProperty, {
    derive: 'property'
  });
  assert.equal(dynamicProperty.value, a.property.value);
  mainProperty.value = b;
  assert.equal(dynamicProperty.value, b.property.value);
  b.property.value = 7;
  assert.equal(dynamicProperty.value, b.property.value);
  a.property.value = 10;
  mainProperty.value = a;
  assert.equal(dynamicProperty.value, a.property.value);
});
QUnit.test('Derive (function)', assert => {
  const a = {
    property: new Property(5)
  };
  const b = {
    property: new Property(2)
  };
  const mainProperty = new Property(a);
  const dynamicProperty = new DynamicProperty(mainProperty, {
    derive: function (ob) {
      return ob.property;
    }
  });
  assert.equal(dynamicProperty.value, a.property.value);
  mainProperty.value = b;
  assert.equal(dynamicProperty.value, b.property.value);
  b.property.value = 7;
  assert.equal(dynamicProperty.value, b.property.value);
  a.property.value = 10;
  mainProperty.value = a;
  assert.equal(dynamicProperty.value, a.property.value);
});
QUnit.test('Bidirectional', assert => {
  const firstProperty = new Property(5);
  const secondProperty = new Property(10);
  const numberPropertyProperty = new Property(firstProperty);
  const dynamicProperty = new DynamicProperty(numberPropertyProperty, {
    bidirectional: true
  });
  dynamicProperty.value = 2; // allowed now that it is bidirectional, otherwise prohibited
  assert.equal(firstProperty.value, 2);
  numberPropertyProperty.value = secondProperty; // change which property is active
  assert.equal(dynamicProperty.value, 10);
  dynamicProperty.value = 0;
  assert.equal(secondProperty.value, 0);
  assert.equal(firstProperty.value, 2);
});
QUnit.test('Mapping (with bidirectional)', assert => {
  const firstProperty = new Property(5);
  const secondProperty = new Property(10);
  const numberPropertyProperty = new Property(firstProperty);
  const dynamicProperty = new DynamicProperty(numberPropertyProperty, {
    bidirectional: true,
    map: function (number) {
      return `${number}`;
    },
    inverseMap: function (string) {
      return Number.parseFloat(string);
    }
  });
  assert.equal(typeof dynamicProperty.value, 'string');
  assert.equal(dynamicProperty.value, '5');
  dynamicProperty.value = '2';
  assert.equal(firstProperty.value, 2);
  numberPropertyProperty.value = secondProperty; // change which property is active
  assert.equal(dynamicProperty.value, '10');
  dynamicProperty.value = '0';
  assert.equal(secondProperty.value, 0);
  assert.equal(firstProperty.value, 2);
});
QUnit.test('Attempted setters to nonbidirectional', assert => {
  const property = new Property(5);
  const propertyProperty = new Property(property);
  const dynamicProperty = new DynamicProperty(propertyProperty);
  window.assert && assert.throws(() => {
    dynamicProperty.value = 10;
  }, /bidirectional/, 'Should not be able to set a non-bidirectional DynamicProperty');
  window.assert && assert.throws(() => {
    dynamicProperty.reset();
  }, /bidirectional/, 'Should not be able to reset a non-bidirectional DynamicProperty');
  assert.expect(window.assert ? 2 : 0);
});
QUnit.test('Bidirectional prevention of pingponging', assert => {
  let callbackCount = 0;
  const sourceProperty = new Property(0);
  sourceProperty.link(() => {
    if (callbackCount++ > 500) {
      throw new Error('Infinite loop detected');
    }
  });
  const wrapperProperty = new Property(sourceProperty);
  const dynamicProperty = new DynamicProperty(wrapperProperty, {
    bidirectional: true,
    // NOT a true inverse
    map: n => n + 2,
    inverseMap: n => n - 1
  });
  dynamicProperty.link(() => {
    if (callbackCount++ > 500) {
      throw new Error('Infinite loop detected');
    }
  });
  assert.equal(sourceProperty.value, 0);
  assert.equal(dynamicProperty.value, 2);
  dynamicProperty.value = 3;
  assert.equal(sourceProperty.value, 2);
  assert.equal(dynamicProperty.value, 3);
  sourceProperty.value = 5;
  assert.equal(sourceProperty.value, 5);
  assert.equal(dynamicProperty.value, 7);
  dynamicProperty.value = -10;
  assert.equal(sourceProperty.value, -11);
  assert.equal(dynamicProperty.value, -10);
  sourceProperty.value = 12;
  assert.equal(sourceProperty.value, 12);
  assert.equal(dynamicProperty.value, 14);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEeW5hbWljUHJvcGVydHkiLCJQcm9wZXJ0eSIsIlFVbml0IiwibW9kdWxlIiwidGVzdCIsImFzc2VydCIsImFQcm9wZXJ0eSIsImJQcm9wZXJ0eSIsInByb3BlcnR5UHJvcGVydHkiLCJkeW5hbWljUHJvcGVydHkiLCJlcXVhbCIsInZhbHVlIiwiYSIsInByb3BlcnR5IiwiYiIsIm1haW5Qcm9wZXJ0eSIsImRlcml2ZSIsIm9iIiwiZmlyc3RQcm9wZXJ0eSIsInNlY29uZFByb3BlcnR5IiwibnVtYmVyUHJvcGVydHlQcm9wZXJ0eSIsImJpZGlyZWN0aW9uYWwiLCJtYXAiLCJudW1iZXIiLCJpbnZlcnNlTWFwIiwic3RyaW5nIiwiTnVtYmVyIiwicGFyc2VGbG9hdCIsIndpbmRvdyIsInRocm93cyIsInJlc2V0IiwiZXhwZWN0IiwiY2FsbGJhY2tDb3VudCIsInNvdXJjZVByb3BlcnR5IiwibGluayIsIkVycm9yIiwid3JhcHBlclByb3BlcnR5IiwibiJdLCJzb3VyY2VzIjpbIkR5bmFtaWNQcm9wZXJ0eVRlc3RzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFFVbml0IHRlc3RzIGZvciBEeW5hbWljUHJvcGVydHlcclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgRHluYW1pY1Byb3BlcnR5IGZyb20gJy4vRHluYW1pY1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4vUHJvcGVydHkuanMnO1xyXG5cclxuUVVuaXQubW9kdWxlKCAnRHluYW1pY1Byb3BlcnR5JyApO1xyXG5cclxuUVVuaXQudGVzdCggJ0Jhc2ljcycsIGFzc2VydCA9PiB7XHJcbiAgY29uc3QgYVByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCA1ICk7XHJcbiAgY29uc3QgYlByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCAyICk7XHJcbiAgY29uc3QgcHJvcGVydHlQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggYVByb3BlcnR5ICk7XHJcbiAgY29uc3QgZHluYW1pY1Byb3BlcnR5ID0gbmV3IER5bmFtaWNQcm9wZXJ0eSggcHJvcGVydHlQcm9wZXJ0eSApO1xyXG5cclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgYVByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gIHByb3BlcnR5UHJvcGVydHkudmFsdWUgPSBiUHJvcGVydHk7XHJcbiAgYXNzZXJ0LmVxdWFsKCBkeW5hbWljUHJvcGVydHkudmFsdWUsIGJQcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICBiUHJvcGVydHkudmFsdWUgPSA3O1xyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCBiUHJvcGVydHkudmFsdWUgKTtcclxuXHJcbiAgYVByb3BlcnR5LnZhbHVlID0gMTA7XHJcbiAgcHJvcGVydHlQcm9wZXJ0eS52YWx1ZSA9IGFQcm9wZXJ0eTtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgYVByb3BlcnR5LnZhbHVlICk7XHJcbn0gKTtcclxuXHJcblFVbml0LnRlc3QoICdEZXJpdmUgKHN0cmluZyknLCBhc3NlcnQgPT4ge1xyXG4gIGNvbnN0IGEgPSB7XHJcbiAgICBwcm9wZXJ0eTogbmV3IFByb3BlcnR5KCA1IClcclxuICB9O1xyXG4gIGNvbnN0IGIgPSB7XHJcbiAgICBwcm9wZXJ0eTogbmV3IFByb3BlcnR5KCAyIClcclxuICB9O1xyXG4gIGNvbnN0IG1haW5Qcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggYSApO1xyXG4gIGNvbnN0IGR5bmFtaWNQcm9wZXJ0eSA9IG5ldyBEeW5hbWljUHJvcGVydHkoIG1haW5Qcm9wZXJ0eSwge1xyXG4gICAgZGVyaXZlOiAncHJvcGVydHknXHJcbiAgfSApO1xyXG5cclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgYS5wcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICBtYWluUHJvcGVydHkudmFsdWUgPSBiO1xyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCBiLnByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gIGIucHJvcGVydHkudmFsdWUgPSA3O1xyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCBiLnByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gIGEucHJvcGVydHkudmFsdWUgPSAxMDtcclxuICBtYWluUHJvcGVydHkudmFsdWUgPSBhO1xyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCBhLnByb3BlcnR5LnZhbHVlICk7XHJcbn0gKTtcclxuXHJcblFVbml0LnRlc3QoICdEZXJpdmUgKGZ1bmN0aW9uKScsIGFzc2VydCA9PiB7XHJcbiAgY29uc3QgYSA9IHtcclxuICAgIHByb3BlcnR5OiBuZXcgUHJvcGVydHkoIDUgKVxyXG4gIH07XHJcbiAgY29uc3QgYiA9IHtcclxuICAgIHByb3BlcnR5OiBuZXcgUHJvcGVydHkoIDIgKVxyXG4gIH07XHJcbiAgY29uc3QgbWFpblByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBhICk7XHJcbiAgY29uc3QgZHluYW1pY1Byb3BlcnR5ID0gbmV3IER5bmFtaWNQcm9wZXJ0eSggbWFpblByb3BlcnR5LCB7XHJcbiAgICBkZXJpdmU6IGZ1bmN0aW9uKCBvYiApIHtcclxuICAgICAgcmV0dXJuIG9iLnByb3BlcnR5O1xyXG4gICAgfVxyXG4gIH0gKTtcclxuXHJcbiAgYXNzZXJ0LmVxdWFsKCBkeW5hbWljUHJvcGVydHkudmFsdWUsIGEucHJvcGVydHkudmFsdWUgKTtcclxuXHJcbiAgbWFpblByb3BlcnR5LnZhbHVlID0gYjtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgYi5wcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICBiLnByb3BlcnR5LnZhbHVlID0gNztcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgYi5wcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICBhLnByb3BlcnR5LnZhbHVlID0gMTA7XHJcbiAgbWFpblByb3BlcnR5LnZhbHVlID0gYTtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgYS5wcm9wZXJ0eS52YWx1ZSApO1xyXG59ICk7XHJcblxyXG5RVW5pdC50ZXN0KCAnQmlkaXJlY3Rpb25hbCcsIGFzc2VydCA9PiB7XHJcbiAgY29uc3QgZmlyc3RQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggNSApO1xyXG4gIGNvbnN0IHNlY29uZFByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCAxMCApO1xyXG4gIGNvbnN0IG51bWJlclByb3BlcnR5UHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIGZpcnN0UHJvcGVydHkgKTtcclxuICBjb25zdCBkeW5hbWljUHJvcGVydHkgPSBuZXcgRHluYW1pY1Byb3BlcnR5KCBudW1iZXJQcm9wZXJ0eVByb3BlcnR5LCB7IGJpZGlyZWN0aW9uYWw6IHRydWUgfSApO1xyXG5cclxuICBkeW5hbWljUHJvcGVydHkudmFsdWUgPSAyOyAvLyBhbGxvd2VkIG5vdyB0aGF0IGl0IGlzIGJpZGlyZWN0aW9uYWwsIG90aGVyd2lzZSBwcm9oaWJpdGVkXHJcbiAgYXNzZXJ0LmVxdWFsKCBmaXJzdFByb3BlcnR5LnZhbHVlLCAyICk7XHJcblxyXG4gIG51bWJlclByb3BlcnR5UHJvcGVydHkudmFsdWUgPSBzZWNvbmRQcm9wZXJ0eTsgLy8gY2hhbmdlIHdoaWNoIHByb3BlcnR5IGlzIGFjdGl2ZVxyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCAxMCApO1xyXG5cclxuICBkeW5hbWljUHJvcGVydHkudmFsdWUgPSAwO1xyXG4gIGFzc2VydC5lcXVhbCggc2Vjb25kUHJvcGVydHkudmFsdWUsIDAgKTtcclxuICBhc3NlcnQuZXF1YWwoIGZpcnN0UHJvcGVydHkudmFsdWUsIDIgKTtcclxufSApO1xyXG5cclxuUVVuaXQudGVzdCggJ01hcHBpbmcgKHdpdGggYmlkaXJlY3Rpb25hbCknLCBhc3NlcnQgPT4ge1xyXG4gIGNvbnN0IGZpcnN0UHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIDUgKTtcclxuICBjb25zdCBzZWNvbmRQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggMTAgKTtcclxuICBjb25zdCBudW1iZXJQcm9wZXJ0eVByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBmaXJzdFByb3BlcnR5ICk7XHJcbiAgY29uc3QgZHluYW1pY1Byb3BlcnR5ID0gbmV3IER5bmFtaWNQcm9wZXJ0eSggbnVtYmVyUHJvcGVydHlQcm9wZXJ0eSwge1xyXG4gICAgYmlkaXJlY3Rpb25hbDogdHJ1ZSxcclxuICAgIG1hcDogZnVuY3Rpb24oIG51bWJlciApIHtcclxuICAgICAgcmV0dXJuIGAke251bWJlcn1gO1xyXG4gICAgfSxcclxuICAgIGludmVyc2VNYXA6IGZ1bmN0aW9uKCBzdHJpbmcgKSB7XHJcbiAgICAgIHJldHVybiBOdW1iZXIucGFyc2VGbG9hdCggc3RyaW5nICk7XHJcbiAgICB9XHJcbiAgfSApO1xyXG5cclxuICBhc3NlcnQuZXF1YWwoIHR5cGVvZiBkeW5hbWljUHJvcGVydHkudmFsdWUsICdzdHJpbmcnICk7XHJcbiAgYXNzZXJ0LmVxdWFsKCBkeW5hbWljUHJvcGVydHkudmFsdWUsICc1JyApO1xyXG5cclxuICBkeW5hbWljUHJvcGVydHkudmFsdWUgPSAnMic7XHJcbiAgYXNzZXJ0LmVxdWFsKCBmaXJzdFByb3BlcnR5LnZhbHVlLCAyICk7XHJcblxyXG4gIG51bWJlclByb3BlcnR5UHJvcGVydHkudmFsdWUgPSBzZWNvbmRQcm9wZXJ0eTsgLy8gY2hhbmdlIHdoaWNoIHByb3BlcnR5IGlzIGFjdGl2ZVxyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCAnMTAnICk7XHJcblxyXG4gIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSA9ICcwJztcclxuICBhc3NlcnQuZXF1YWwoIHNlY29uZFByb3BlcnR5LnZhbHVlLCAwICk7XHJcbiAgYXNzZXJ0LmVxdWFsKCBmaXJzdFByb3BlcnR5LnZhbHVlLCAyICk7XHJcbn0gKTtcclxuXHJcblFVbml0LnRlc3QoICdBdHRlbXB0ZWQgc2V0dGVycyB0byBub25iaWRpcmVjdGlvbmFsJywgYXNzZXJ0ID0+IHtcclxuICBjb25zdCBwcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggNSApO1xyXG4gIGNvbnN0IHByb3BlcnR5UHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIHByb3BlcnR5ICk7XHJcbiAgY29uc3QgZHluYW1pY1Byb3BlcnR5ID0gbmV3IER5bmFtaWNQcm9wZXJ0eSggcHJvcGVydHlQcm9wZXJ0eSApO1xyXG5cclxuICB3aW5kb3cuYXNzZXJ0ICYmIGFzc2VydC50aHJvd3MoICgpID0+IHtcclxuICAgIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSA9IDEwO1xyXG4gIH0sIC9iaWRpcmVjdGlvbmFsLywgJ1Nob3VsZCBub3QgYmUgYWJsZSB0byBzZXQgYSBub24tYmlkaXJlY3Rpb25hbCBEeW5hbWljUHJvcGVydHknICk7XHJcblxyXG4gIHdpbmRvdy5hc3NlcnQgJiYgYXNzZXJ0LnRocm93cyggKCkgPT4ge1xyXG4gICAgZHluYW1pY1Byb3BlcnR5LnJlc2V0KCk7XHJcbiAgfSwgL2JpZGlyZWN0aW9uYWwvLCAnU2hvdWxkIG5vdCBiZSBhYmxlIHRvIHJlc2V0IGEgbm9uLWJpZGlyZWN0aW9uYWwgRHluYW1pY1Byb3BlcnR5JyApO1xyXG5cclxuICBhc3NlcnQuZXhwZWN0KCB3aW5kb3cuYXNzZXJ0ID8gMiA6IDAgKTtcclxufSApO1xyXG5cclxuUVVuaXQudGVzdCggJ0JpZGlyZWN0aW9uYWwgcHJldmVudGlvbiBvZiBwaW5ncG9uZ2luZycsIGFzc2VydCA9PiB7XHJcbiAgbGV0IGNhbGxiYWNrQ291bnQgPSAwO1xyXG5cclxuICBjb25zdCBzb3VyY2VQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggMCApO1xyXG4gIHNvdXJjZVByb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgIGlmICggY2FsbGJhY2tDb3VudCsrID4gNTAwICkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoICdJbmZpbml0ZSBsb29wIGRldGVjdGVkJyApO1xyXG4gICAgfVxyXG4gIH0gKTtcclxuXHJcbiAgY29uc3Qgd3JhcHBlclByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBzb3VyY2VQcm9wZXJ0eSApO1xyXG4gIGNvbnN0IGR5bmFtaWNQcm9wZXJ0eSA9IG5ldyBEeW5hbWljUHJvcGVydHkoIHdyYXBwZXJQcm9wZXJ0eSwge1xyXG4gICAgYmlkaXJlY3Rpb25hbDogdHJ1ZSxcclxuICAgIC8vIE5PVCBhIHRydWUgaW52ZXJzZVxyXG4gICAgbWFwOiAoIG46IG51bWJlciApID0+IG4gKyAyLFxyXG4gICAgaW52ZXJzZU1hcDogKCBuOiBudW1iZXIgKSA9PiBuIC0gMVxyXG4gIH0gKTtcclxuICBkeW5hbWljUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgaWYgKCBjYWxsYmFja0NvdW50KysgPiA1MDAgKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvciggJ0luZmluaXRlIGxvb3AgZGV0ZWN0ZWQnICk7XHJcbiAgICB9XHJcbiAgfSApO1xyXG4gIGFzc2VydC5lcXVhbCggc291cmNlUHJvcGVydHkudmFsdWUsIDAgKTtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgMiApO1xyXG5cclxuICBkeW5hbWljUHJvcGVydHkudmFsdWUgPSAzO1xyXG4gIGFzc2VydC5lcXVhbCggc291cmNlUHJvcGVydHkudmFsdWUsIDIgKTtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgMyApO1xyXG5cclxuICBzb3VyY2VQcm9wZXJ0eS52YWx1ZSA9IDU7XHJcbiAgYXNzZXJ0LmVxdWFsKCBzb3VyY2VQcm9wZXJ0eS52YWx1ZSwgNSApO1xyXG4gIGFzc2VydC5lcXVhbCggZHluYW1pY1Byb3BlcnR5LnZhbHVlLCA3ICk7XHJcblxyXG4gIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSA9IC0xMDtcclxuICBhc3NlcnQuZXF1YWwoIHNvdXJjZVByb3BlcnR5LnZhbHVlLCAtMTEgKTtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgLTEwICk7XHJcblxyXG4gIHNvdXJjZVByb3BlcnR5LnZhbHVlID0gMTI7XHJcbiAgYXNzZXJ0LmVxdWFsKCBzb3VyY2VQcm9wZXJ0eS52YWx1ZSwgMTIgKTtcclxuICBhc3NlcnQuZXF1YWwoIGR5bmFtaWNQcm9wZXJ0eS52YWx1ZSwgMTQgKTtcclxufSApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHNCQUFzQjtBQUNsRCxPQUFPQyxRQUFRLE1BQU0sZUFBZTtBQUVwQ0MsS0FBSyxDQUFDQyxNQUFNLENBQUUsaUJBQWtCLENBQUM7QUFFakNELEtBQUssQ0FBQ0UsSUFBSSxDQUFFLFFBQVEsRUFBRUMsTUFBTSxJQUFJO0VBQzlCLE1BQU1DLFNBQVMsR0FBRyxJQUFJTCxRQUFRLENBQUUsQ0FBRSxDQUFDO0VBQ25DLE1BQU1NLFNBQVMsR0FBRyxJQUFJTixRQUFRLENBQUUsQ0FBRSxDQUFDO0VBQ25DLE1BQU1PLGdCQUFnQixHQUFHLElBQUlQLFFBQVEsQ0FBRUssU0FBVSxDQUFDO0VBQ2xELE1BQU1HLGVBQWUsR0FBRyxJQUFJVCxlQUFlLENBQUVRLGdCQUFpQixDQUFDO0VBRS9ESCxNQUFNLENBQUNLLEtBQUssQ0FBRUQsZUFBZSxDQUFDRSxLQUFLLEVBQUVMLFNBQVMsQ0FBQ0ssS0FBTSxDQUFDO0VBRXRESCxnQkFBZ0IsQ0FBQ0csS0FBSyxHQUFHSixTQUFTO0VBQ2xDRixNQUFNLENBQUNLLEtBQUssQ0FBRUQsZUFBZSxDQUFDRSxLQUFLLEVBQUVKLFNBQVMsQ0FBQ0ksS0FBTSxDQUFDO0VBRXRE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