// Copyright 2014-2023, University of Colorado Boulder

/**
 * Top-level model for the 'Game' screen.
 *
 * @author Vasily Shakhov (MLearner)
 */

import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Property from '../../../../axon/js/Property.js';
import EnumerationProperty from '../../../../axon/js/EnumerationProperty.js';
import dotRandom from '../../../../dot/js/dotRandom.js';
import Range from '../../../../dot/js/Range.js';
import GameTimer from '../../../../vegas/js/GameTimer.js';
import balancingChemicalEquations from '../../balancingChemicalEquations.js';
import BalancedRepresentation from '../../common/model/BalancedRepresentation.js';
import SynthesisEquation from '../../common/model/SynthesisEquation.js';
import GameFactory from './GameFactory.js';
import GameState from './GameState.js';
/*
 * Strategies for selecting the "balanced representation" that is displayed by the "Not Balanced" popup.
 * This is a map from level to strategy.
 */
const BALANCED_REPRESENTATION_STRATEGIES = [
// level 1
() => BalancedRepresentation.BALANCE_SCALES,
// level 2
() => dotRandom.nextDouble() < 0.5 ? BalancedRepresentation.BALANCE_SCALES : BalancedRepresentation.BAR_CHARTS,
// level 3
() => BalancedRepresentation.BAR_CHARTS];
const POINTS_FIRST_ATTEMPT = 2; // points to award for correct guess on 1st attempt
const POINTS_SECOND_ATTEMPT = 1; // points to award for correct guess on 2nd attempt

export default class GameModel {
  // state of the game
  // level of the current game
  // how many points the user has earned for the current game
  // number of challenges in the current game
  // current challenge/Equation
  // index of the current challenge that the user is working on

  // how many attempts the user has made at solving the current challenge
  // how many points were earned for the current challenge
  // which representation to use in the "Not Balanced" popup
  // is the time for this game a new best time?
  // best times in ms, indexed by level
  // best scores, indexed by level

  constructor(tandem) {
    this.coefficientsRange = new Range(0, 7); // Range of possible equation coefficients
    this.levelsRange = new Range(0, 2); // Levels 1-2-3, counting from 0

    this.stateProperty = new EnumerationProperty(GameState.LEVEL_SELECTION);
    this.levelProperty = new NumberProperty(0, {
      numberType: 'Integer'
    });
    this.pointsProperty = new NumberProperty(0, {
      numberType: 'Integer'
    });
    this.numberOfEquationsProperty = new NumberProperty(0, {
      numberType: 'Integer'
    });
    this.currentEquationProperty = new Property(SynthesisEquation.create_N2_3H2_2NH3()); // any non-null Equation will do here
    this.currentEquationIndexProperty = new NumberProperty(0, {
      numberType: 'Integer'
    });
    this.equations = [];
    this.timer = new GameTimer();
    this.attempts = 0;
    this.currentPoints = 0;
    this.balancedRepresentation = BalancedRepresentation.NONE;
    this.isNewBestTime = false;
    this.bestTimeProperties = [];
    this.bestScoreProperties = [];
    for (let i = this.levelsRange.min; i <= this.levelsRange.max; i++) {
      this.bestTimeProperties[i] = new NumberProperty(0, {
        numberType: 'Integer'
      });
      this.bestScoreProperties[i] = new NumberProperty(0, {
        numberType: 'Integer'
      });
    }
  }
  reset() {
    this.stateProperty.reset();
    this.levelProperty.reset();
    this.pointsProperty.reset();
    this.numberOfEquationsProperty.reset();
    this.currentEquationProperty.reset();
    this.currentEquationIndexProperty.reset();
    this.bestTimeProperties.forEach(bestTimeProperty => bestTimeProperty.reset());
    this.bestScoreProperties.forEach(bestScoreProperty => bestScoreProperty.reset());
  }

  /**
   * Called when the user presses a level-selection button.
   */
  startGame() {
    const level = this.levelProperty.value;

    // create a set of challenges
    this.equations = GameFactory.createEquations(level);

    // initialize simple fields
    this.attempts = 0;
    this.currentPoints = 0;
    this.isNewBestTime = false;
    this.balancedRepresentation = BALANCED_REPRESENTATION_STRATEGIES[level]();
    this.timer.restart();

    // initialize properties
    this.currentEquationIndexProperty.value = 0;
    this.currentEquationProperty.value = this.equations[this.currentEquationIndexProperty.value];
    this.numberOfEquationsProperty.value = this.equations.length;
    this.pointsProperty.value = 0;
    this.stateProperty.value = GameState.CHECK;
  }

  /**
   * Called when the user presses the "Check" button.
   */
  check() {
    this.attempts++;
    if (this.currentEquationProperty.value.balancedAndSimplified) {
      // award points
      if (this.attempts === 1) {
        this.currentPoints = POINTS_FIRST_ATTEMPT;
      } else if (this.attempts === 2) {
        this.currentPoints = POINTS_SECOND_ATTEMPT;
      } else {
        this.currentPoints = 0;
      }
      this.pointsProperty.value = this.pointsProperty.value + this.currentPoints;
      this.stateProperty.value = GameState.NEXT;
      if (this.currentEquationIndexProperty.value === this.equations.length - 1) {
        this.endGame();
      }
    } else if (this.attempts < 2) {
      this.stateProperty.value = GameState.TRY_AGAIN;
    } else {
      if (this.currentEquationIndexProperty.value === this.equations.length - 1) {
        this.endGame();
      }
      this.stateProperty.value = GameState.SHOW_ANSWER;
    }
  }

  /**
   * When a game ends, stop the timer and (if perfect score) set the new best time.
   */
  endGame() {
    this.timer.stop();
    const level = this.levelProperty.value;
    const points = this.pointsProperty.value;

    //check for new best score
    if (points > this.bestScoreProperties[level].value) {
      this.bestScoreProperties[level].value = points;
    }

    // check for new best time
    const previousBestTime = this.bestTimeProperties[level].value;
    if (this.isPerfectScore() && (previousBestTime === 0 || this.timer.elapsedTimeProperty.value < previousBestTime)) {
      this.isNewBestTime = true;
      this.bestTimeProperties[level].value = this.timer.elapsedTimeProperty.value;
    }
  }

  /**
   * Called when the user presses the "Try Again" button.
   */
  tryAgain() {
    this.stateProperty.value = GameState.CHECK;
  }

  /**
   * Called when the user presses the "Show Answer" button.
   */
  showAnswer() {
    this.stateProperty.value = GameState.NEXT;
  }

  /**
   * Gets the number of equations for a specified level.
   */
  getNumberOfEquations(level) {
    return GameFactory.getNumberOfEquations(level);
  }

  /**
   * Gets the number of points in a perfect score for a specified level.
   * A perfect score is obtained when the user balances every equation correctly on the first attempt.
   */
  getPerfectScore(level) {
    return this.getNumberOfEquations(level) * POINTS_FIRST_ATTEMPT;
  }

  /**
   * Is the current score a perfect score?
   * This can be called at any time during the game, but can't possibly return true until the game has been completed.
   */
  isPerfectScore() {
    return this.pointsProperty.value === this.getPerfectScore(this.levelProperty.value);
  }

  /**
   * Called when the user presses the "Start Over" button.
   */
  newGame() {
    this.stateProperty.value = GameState.LEVEL_SELECTION;
    this.timer.restart();
  }

  /**
   * Called when the user presses the "Next" button.
   */
  next() {
    if (this.currentEquationIndexProperty.value < this.equations.length - 1) {
      this.attempts = 0;
      this.currentPoints = 0;
      this.balancedRepresentation = BALANCED_REPRESENTATION_STRATEGIES[this.levelProperty.value]();
      this.currentEquationIndexProperty.value = this.currentEquationIndexProperty.value + 1;
      this.currentEquationProperty.value = this.equations[this.currentEquationIndexProperty.value];
      this.stateProperty.value = GameState.CHECK;
    } else {
      this.stateProperty.value = GameState.LEVEL_COMPLETED;
    }
  }
}
balancingChemicalEquations.register('GameModel', GameModel);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOdW1iZXJQcm9wZXJ0eSIsIlByb3BlcnR5IiwiRW51bWVyYXRpb25Qcm9wZXJ0eSIsImRvdFJhbmRvbSIsIlJhbmdlIiwiR2FtZVRpbWVyIiwiYmFsYW5jaW5nQ2hlbWljYWxFcXVhdGlvbnMiLCJCYWxhbmNlZFJlcHJlc2VudGF0aW9uIiwiU3ludGhlc2lzRXF1YXRpb24iLCJHYW1lRmFjdG9yeSIsIkdhbWVTdGF0ZSIsIkJBTEFOQ0VEX1JFUFJFU0VOVEFUSU9OX1NUUkFURUdJRVMiLCJCQUxBTkNFX1NDQUxFUyIsIm5leHREb3VibGUiLCJCQVJfQ0hBUlRTIiwiUE9JTlRTX0ZJUlNUX0FUVEVNUFQiLCJQT0lOVFNfU0VDT05EX0FUVEVNUFQiLCJHYW1lTW9kZWwiLCJjb25zdHJ1Y3RvciIsInRhbmRlbSIsImNvZWZmaWNpZW50c1JhbmdlIiwibGV2ZWxzUmFuZ2UiLCJzdGF0ZVByb3BlcnR5IiwiTEVWRUxfU0VMRUNUSU9OIiwibGV2ZWxQcm9wZXJ0eSIsIm51bWJlclR5cGUiLCJwb2ludHNQcm9wZXJ0eSIsIm51bWJlck9mRXF1YXRpb25zUHJvcGVydHkiLCJjdXJyZW50RXF1YXRpb25Qcm9wZXJ0eSIsImNyZWF0ZV9OMl8zSDJfMk5IMyIsImN1cnJlbnRFcXVhdGlvbkluZGV4UHJvcGVydHkiLCJlcXVhdGlvbnMiLCJ0aW1lciIsImF0dGVtcHRzIiwiY3VycmVudFBvaW50cyIsImJhbGFuY2VkUmVwcmVzZW50YXRpb24iLCJOT05FIiwiaXNOZXdCZXN0VGltZSIsImJlc3RUaW1lUHJvcGVydGllcyIsImJlc3RTY29yZVByb3BlcnRpZXMiLCJpIiwibWluIiwibWF4IiwicmVzZXQiLCJmb3JFYWNoIiwiYmVzdFRpbWVQcm9wZXJ0eSIsImJlc3RTY29yZVByb3BlcnR5Iiwic3RhcnRHYW1lIiwibGV2ZWwiLCJ2YWx1ZSIsImNyZWF0ZUVxdWF0aW9ucyIsInJlc3RhcnQiLCJsZW5ndGgiLCJDSEVDSyIsImNoZWNrIiwiYmFsYW5jZWRBbmRTaW1wbGlmaWVkIiwiTkVYVCIsImVuZEdhbWUiLCJUUllfQUdBSU4iLCJTSE9XX0FOU1dFUiIsInN0b3AiLCJwb2ludHMiLCJwcmV2aW91c0Jlc3RUaW1lIiwiaXNQZXJmZWN0U2NvcmUiLCJlbGFwc2VkVGltZVByb3BlcnR5IiwidHJ5QWdhaW4iLCJzaG93QW5zd2VyIiwiZ2V0TnVtYmVyT2ZFcXVhdGlvbnMiLCJnZXRQZXJmZWN0U2NvcmUiLCJuZXdHYW1lIiwibmV4dCIsIkxFVkVMX0NPTVBMRVRFRCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiR2FtZU1vZGVsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFRvcC1sZXZlbCBtb2RlbCBmb3IgdGhlICdHYW1lJyBzY3JlZW4uXHJcbiAqXHJcbiAqIEBhdXRob3IgVmFzaWx5IFNoYWtob3YgKE1MZWFybmVyKVxyXG4gKi9cclxuXHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRW51bWVyYXRpb25Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0VudW1lcmF0aW9uUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgZG90UmFuZG9tIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9kb3RSYW5kb20uanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IEdhbWVUaW1lciBmcm9tICcuLi8uLi8uLi8uLi92ZWdhcy9qcy9HYW1lVGltZXIuanMnO1xyXG5pbXBvcnQgYmFsYW5jaW5nQ2hlbWljYWxFcXVhdGlvbnMgZnJvbSAnLi4vLi4vYmFsYW5jaW5nQ2hlbWljYWxFcXVhdGlvbnMuanMnO1xyXG5pbXBvcnQgQmFsYW5jZWRSZXByZXNlbnRhdGlvbiBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvQmFsYW5jZWRSZXByZXNlbnRhdGlvbi5qcyc7XHJcbmltcG9ydCBTeW50aGVzaXNFcXVhdGlvbiBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvU3ludGhlc2lzRXF1YXRpb24uanMnO1xyXG5pbXBvcnQgR2FtZUZhY3RvcnkgZnJvbSAnLi9HYW1lRmFjdG9yeS5qcyc7XHJcbmltcG9ydCBHYW1lU3RhdGUgZnJvbSAnLi9HYW1lU3RhdGUuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgRXF1YXRpb24gZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL0VxdWF0aW9uLmpzJztcclxuXHJcbi8qXHJcbiAqIFN0cmF0ZWdpZXMgZm9yIHNlbGVjdGluZyB0aGUgXCJiYWxhbmNlZCByZXByZXNlbnRhdGlvblwiIHRoYXQgaXMgZGlzcGxheWVkIGJ5IHRoZSBcIk5vdCBCYWxhbmNlZFwiIHBvcHVwLlxyXG4gKiBUaGlzIGlzIGEgbWFwIGZyb20gbGV2ZWwgdG8gc3RyYXRlZ3kuXHJcbiAqL1xyXG5jb25zdCBCQUxBTkNFRF9SRVBSRVNFTlRBVElPTl9TVFJBVEVHSUVTID0gW1xyXG5cclxuICAvLyBsZXZlbCAxXHJcbiAgKCkgPT4gQmFsYW5jZWRSZXByZXNlbnRhdGlvbi5CQUxBTkNFX1NDQUxFUyxcclxuXHJcbiAgLy8gbGV2ZWwgMlxyXG4gICgpID0+IGRvdFJhbmRvbS5uZXh0RG91YmxlKCkgPCAwLjUgPyBCYWxhbmNlZFJlcHJlc2VudGF0aW9uLkJBTEFOQ0VfU0NBTEVTIDogQmFsYW5jZWRSZXByZXNlbnRhdGlvbi5CQVJfQ0hBUlRTLFxyXG5cclxuICAvLyBsZXZlbCAzXHJcbiAgKCkgPT4gQmFsYW5jZWRSZXByZXNlbnRhdGlvbi5CQVJfQ0hBUlRTXHJcbl07XHJcbmNvbnN0IFBPSU5UU19GSVJTVF9BVFRFTVBUID0gMjsgIC8vIHBvaW50cyB0byBhd2FyZCBmb3IgY29ycmVjdCBndWVzcyBvbiAxc3QgYXR0ZW1wdFxyXG5jb25zdCBQT0lOVFNfU0VDT05EX0FUVEVNUFQgPSAxOyAvLyBwb2ludHMgdG8gYXdhcmQgZm9yIGNvcnJlY3QgZ3Vlc3Mgb24gMm5kIGF0dGVtcHRcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVNb2RlbCB7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSBjb2VmZmljaWVudHNSYW5nZTogUmFuZ2U7XHJcbiAgcHVibGljIHJlYWRvbmx5IGxldmVsc1JhbmdlOiBSYW5nZTtcclxuICBwdWJsaWMgcmVhZG9ubHkgc3RhdGVQcm9wZXJ0eTogRW51bWVyYXRpb25Qcm9wZXJ0eTxHYW1lU3RhdGU+OyAvLyBzdGF0ZSBvZiB0aGUgZ2FtZVxyXG4gIHB1YmxpYyByZWFkb25seSBsZXZlbFByb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+OyAvLyBsZXZlbCBvZiB0aGUgY3VycmVudCBnYW1lXHJcbiAgcHVibGljIHJlYWRvbmx5IHBvaW50c1Byb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+OyAvLyBob3cgbWFueSBwb2ludHMgdGhlIHVzZXIgaGFzIGVhcm5lZCBmb3IgdGhlIGN1cnJlbnQgZ2FtZVxyXG4gIHB1YmxpYyByZWFkb25seSBudW1iZXJPZkVxdWF0aW9uc1Byb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+OyAvLyBudW1iZXIgb2YgY2hhbGxlbmdlcyBpbiB0aGUgY3VycmVudCBnYW1lXHJcbiAgcHVibGljIHJlYWRvbmx5IGN1cnJlbnRFcXVhdGlvblByb3BlcnR5OiBQcm9wZXJ0eTxFcXVhdGlvbj47IC8vIGN1cnJlbnQgY2hhbGxlbmdlL0VxdWF0aW9uXHJcbiAgcHVibGljIHJlYWRvbmx5IGN1cnJlbnRFcXVhdGlvbkluZGV4UHJvcGVydHk6IFByb3BlcnR5PG51bWJlcj47IC8vIGluZGV4IG9mIHRoZSBjdXJyZW50IGNoYWxsZW5nZSB0aGF0IHRoZSB1c2VyIGlzIHdvcmtpbmcgb25cclxuICBwdWJsaWMgZXF1YXRpb25zOiBFcXVhdGlvbltdO1xyXG4gIHB1YmxpYyByZWFkb25seSB0aW1lcjogR2FtZVRpbWVyO1xyXG5cclxuICBwcml2YXRlIGF0dGVtcHRzOiBudW1iZXI7IC8vIGhvdyBtYW55IGF0dGVtcHRzIHRoZSB1c2VyIGhhcyBtYWRlIGF0IHNvbHZpbmcgdGhlIGN1cnJlbnQgY2hhbGxlbmdlXHJcbiAgcHVibGljIGN1cnJlbnRQb2ludHM6IG51bWJlcjsgLy8gaG93IG1hbnkgcG9pbnRzIHdlcmUgZWFybmVkIGZvciB0aGUgY3VycmVudCBjaGFsbGVuZ2VcclxuICBwdWJsaWMgYmFsYW5jZWRSZXByZXNlbnRhdGlvbjogQmFsYW5jZWRSZXByZXNlbnRhdGlvbjsgLy8gd2hpY2ggcmVwcmVzZW50YXRpb24gdG8gdXNlIGluIHRoZSBcIk5vdCBCYWxhbmNlZFwiIHBvcHVwXHJcbiAgcHVibGljIGlzTmV3QmVzdFRpbWU6IGJvb2xlYW47IC8vIGlzIHRoZSB0aW1lIGZvciB0aGlzIGdhbWUgYSBuZXcgYmVzdCB0aW1lP1xyXG4gIHB1YmxpYyByZWFkb25seSBiZXN0VGltZVByb3BlcnRpZXM6IFByb3BlcnR5PG51bWJlcj5bXTsgLy8gYmVzdCB0aW1lcyBpbiBtcywgaW5kZXhlZCBieSBsZXZlbFxyXG4gIHB1YmxpYyByZWFkb25seSBiZXN0U2NvcmVQcm9wZXJ0aWVzOiBQcm9wZXJ0eTxudW1iZXI+W107IC8vIGJlc3Qgc2NvcmVzLCBpbmRleGVkIGJ5IGxldmVsXHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggdGFuZGVtOiBUYW5kZW0gKSB7XHJcblxyXG4gICAgdGhpcy5jb2VmZmljaWVudHNSYW5nZSA9IG5ldyBSYW5nZSggMCwgNyApOyAvLyBSYW5nZSBvZiBwb3NzaWJsZSBlcXVhdGlvbiBjb2VmZmljaWVudHNcclxuICAgIHRoaXMubGV2ZWxzUmFuZ2UgPSBuZXcgUmFuZ2UoIDAsIDIgKTsgLy8gTGV2ZWxzIDEtMi0zLCBjb3VudGluZyBmcm9tIDBcclxuXHJcbiAgICB0aGlzLnN0YXRlUHJvcGVydHkgPSBuZXcgRW51bWVyYXRpb25Qcm9wZXJ0eSggR2FtZVN0YXRlLkxFVkVMX1NFTEVDVElPTiApO1xyXG4gICAgdGhpcy5sZXZlbFByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCAwLCB7IG51bWJlclR5cGU6ICdJbnRlZ2VyJyB9ICk7XHJcbiAgICB0aGlzLnBvaW50c1Byb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCAwLCB7IG51bWJlclR5cGU6ICdJbnRlZ2VyJyB9ICk7XHJcbiAgICB0aGlzLm51bWJlck9mRXF1YXRpb25zUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIDAsIHsgbnVtYmVyVHlwZTogJ0ludGVnZXInIH0gKTtcclxuICAgIHRoaXMuY3VycmVudEVxdWF0aW9uUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIFN5bnRoZXNpc0VxdWF0aW9uLmNyZWF0ZV9OMl8zSDJfMk5IMygpICk7IC8vIGFueSBub24tbnVsbCBFcXVhdGlvbiB3aWxsIGRvIGhlcmVcclxuICAgIHRoaXMuY3VycmVudEVxdWF0aW9uSW5kZXhQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggMCwgeyBudW1iZXJUeXBlOiAnSW50ZWdlcicgfSApO1xyXG5cclxuICAgIHRoaXMuZXF1YXRpb25zID0gW107XHJcbiAgICB0aGlzLnRpbWVyID0gbmV3IEdhbWVUaW1lcigpO1xyXG4gICAgdGhpcy5hdHRlbXB0cyA9IDA7XHJcbiAgICB0aGlzLmN1cnJlbnRQb2ludHMgPSAwO1xyXG4gICAgdGhpcy5iYWxhbmNlZFJlcHJlc2VudGF0aW9uID0gQmFsYW5jZWRSZXByZXNlbnRhdGlvbi5OT05FO1xyXG4gICAgdGhpcy5pc05ld0Jlc3RUaW1lID0gZmFsc2U7XHJcblxyXG4gICAgdGhpcy5iZXN0VGltZVByb3BlcnRpZXMgPSBbXTtcclxuICAgIHRoaXMuYmVzdFNjb3JlUHJvcGVydGllcyA9IFtdO1xyXG4gICAgZm9yICggbGV0IGkgPSB0aGlzLmxldmVsc1JhbmdlLm1pbjsgaSA8PSB0aGlzLmxldmVsc1JhbmdlLm1heDsgaSsrICkge1xyXG4gICAgICB0aGlzLmJlc3RUaW1lUHJvcGVydGllc1sgaSBdID0gbmV3IE51bWJlclByb3BlcnR5KCAwLCB7IG51bWJlclR5cGU6ICdJbnRlZ2VyJyB9ICk7XHJcbiAgICAgIHRoaXMuYmVzdFNjb3JlUHJvcGVydGllc1sgaSBdID0gbmV3IE51bWJlclByb3BlcnR5KCAwLCB7IG51bWJlclR5cGU6ICdJbnRlZ2VyJyB9ICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLnN0YXRlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMubGV2ZWxQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5wb2ludHNQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5udW1iZXJPZkVxdWF0aW9uc1Byb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmN1cnJlbnRFcXVhdGlvblByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmN1cnJlbnRFcXVhdGlvbkluZGV4UHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuYmVzdFRpbWVQcm9wZXJ0aWVzLmZvckVhY2goIGJlc3RUaW1lUHJvcGVydHkgPT4gYmVzdFRpbWVQcm9wZXJ0eS5yZXNldCgpICk7XHJcbiAgICB0aGlzLmJlc3RTY29yZVByb3BlcnRpZXMuZm9yRWFjaCggYmVzdFNjb3JlUHJvcGVydHkgPT4gYmVzdFNjb3JlUHJvcGVydHkucmVzZXQoKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FsbGVkIHdoZW4gdGhlIHVzZXIgcHJlc3NlcyBhIGxldmVsLXNlbGVjdGlvbiBidXR0b24uXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXJ0R2FtZSgpOiB2b2lkIHtcclxuXHJcbiAgICBjb25zdCBsZXZlbCA9IHRoaXMubGV2ZWxQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICAvLyBjcmVhdGUgYSBzZXQgb2YgY2hhbGxlbmdlc1xyXG4gICAgdGhpcy5lcXVhdGlvbnMgPSBHYW1lRmFjdG9yeS5jcmVhdGVFcXVhdGlvbnMoIGxldmVsICk7XHJcblxyXG4gICAgLy8gaW5pdGlhbGl6ZSBzaW1wbGUgZmllbGRzXHJcbiAgICB0aGlzLmF0dGVtcHRzID0gMDtcclxuICAgIHRoaXMuY3VycmVudFBvaW50cyA9IDA7XHJcbiAgICB0aGlzLmlzTmV3QmVzdFRpbWUgPSBmYWxzZTtcclxuICAgIHRoaXMuYmFsYW5jZWRSZXByZXNlbnRhdGlvbiA9IEJBTEFOQ0VEX1JFUFJFU0VOVEFUSU9OX1NUUkFURUdJRVNbIGxldmVsIF0oKTtcclxuICAgIHRoaXMudGltZXIucmVzdGFydCgpO1xyXG5cclxuICAgIC8vIGluaXRpYWxpemUgcHJvcGVydGllc1xyXG4gICAgdGhpcy5jdXJyZW50RXF1YXRpb25JbmRleFByb3BlcnR5LnZhbHVlID0gMDtcclxuICAgIHRoaXMuY3VycmVudEVxdWF0aW9uUHJvcGVydHkudmFsdWUgPSB0aGlzLmVxdWF0aW9uc1sgdGhpcy5jdXJyZW50RXF1YXRpb25JbmRleFByb3BlcnR5LnZhbHVlIF07XHJcbiAgICB0aGlzLm51bWJlck9mRXF1YXRpb25zUHJvcGVydHkudmFsdWUgPSB0aGlzLmVxdWF0aW9ucy5sZW5ndGg7XHJcbiAgICB0aGlzLnBvaW50c1Byb3BlcnR5LnZhbHVlID0gMDtcclxuICAgIHRoaXMuc3RhdGVQcm9wZXJ0eS52YWx1ZSA9IEdhbWVTdGF0ZS5DSEVDSztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGxlZCB3aGVuIHRoZSB1c2VyIHByZXNzZXMgdGhlIFwiQ2hlY2tcIiBidXR0b24uXHJcbiAgICovXHJcbiAgcHVibGljIGNoZWNrKCk6IHZvaWQge1xyXG4gICAgdGhpcy5hdHRlbXB0cysrO1xyXG5cclxuICAgIGlmICggdGhpcy5jdXJyZW50RXF1YXRpb25Qcm9wZXJ0eS52YWx1ZS5iYWxhbmNlZEFuZFNpbXBsaWZpZWQgKSB7XHJcbiAgICAgIC8vIGF3YXJkIHBvaW50c1xyXG4gICAgICBpZiAoIHRoaXMuYXR0ZW1wdHMgPT09IDEgKSB7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50UG9pbnRzID0gUE9JTlRTX0ZJUlNUX0FUVEVNUFQ7XHJcblxyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCB0aGlzLmF0dGVtcHRzID09PSAyICkge1xyXG4gICAgICAgIHRoaXMuY3VycmVudFBvaW50cyA9IFBPSU5UU19TRUNPTkRfQVRURU1QVDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB0aGlzLmN1cnJlbnRQb2ludHMgPSAwO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMucG9pbnRzUHJvcGVydHkudmFsdWUgPSB0aGlzLnBvaW50c1Byb3BlcnR5LnZhbHVlICsgdGhpcy5jdXJyZW50UG9pbnRzO1xyXG4gICAgICB0aGlzLnN0YXRlUHJvcGVydHkudmFsdWUgPSBHYW1lU3RhdGUuTkVYVDtcclxuXHJcbiAgICAgIGlmICggdGhpcy5jdXJyZW50RXF1YXRpb25JbmRleFByb3BlcnR5LnZhbHVlID09PSB0aGlzLmVxdWF0aW9ucy5sZW5ndGggLSAxICkge1xyXG4gICAgICAgIHRoaXMuZW5kR2FtZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggdGhpcy5hdHRlbXB0cyA8IDIgKSB7XHJcbiAgICAgIHRoaXMuc3RhdGVQcm9wZXJ0eS52YWx1ZSA9IEdhbWVTdGF0ZS5UUllfQUdBSU47XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgaWYgKCB0aGlzLmN1cnJlbnRFcXVhdGlvbkluZGV4UHJvcGVydHkudmFsdWUgPT09IHRoaXMuZXF1YXRpb25zLmxlbmd0aCAtIDEgKSB7XHJcbiAgICAgICAgdGhpcy5lbmRHYW1lKCk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5zdGF0ZVByb3BlcnR5LnZhbHVlID0gR2FtZVN0YXRlLlNIT1dfQU5TV0VSO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogV2hlbiBhIGdhbWUgZW5kcywgc3RvcCB0aGUgdGltZXIgYW5kIChpZiBwZXJmZWN0IHNjb3JlKSBzZXQgdGhlIG5ldyBiZXN0IHRpbWUuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBlbmRHYW1lKCk6IHZvaWQge1xyXG5cclxuICAgIHRoaXMudGltZXIuc3RvcCgpO1xyXG5cclxuICAgIGNvbnN0IGxldmVsID0gdGhpcy5sZXZlbFByb3BlcnR5LnZhbHVlO1xyXG4gICAgY29uc3QgcG9pbnRzID0gdGhpcy5wb2ludHNQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICAvL2NoZWNrIGZvciBuZXcgYmVzdCBzY29yZVxyXG4gICAgaWYgKCBwb2ludHMgPiB0aGlzLmJlc3RTY29yZVByb3BlcnRpZXNbIGxldmVsIF0udmFsdWUgKSB7XHJcbiAgICAgIHRoaXMuYmVzdFNjb3JlUHJvcGVydGllc1sgbGV2ZWwgXS52YWx1ZSA9IHBvaW50cztcclxuICAgIH1cclxuXHJcbiAgICAvLyBjaGVjayBmb3IgbmV3IGJlc3QgdGltZVxyXG4gICAgY29uc3QgcHJldmlvdXNCZXN0VGltZSA9IHRoaXMuYmVzdFRpbWVQcm9wZXJ0aWVzWyBsZXZlbCBdLnZhbHVlO1xyXG4gICAgaWYgKCB0aGlzLmlzUGVyZmVjdFNjb3JlKCkgJiYgKCBwcmV2aW91c0Jlc3RUaW1lID09PSAwIHx8IHRoaXMudGltZXIuZWxhcHNlZFRpbWVQcm9wZXJ0eS52YWx1ZSA8IHByZXZpb3VzQmVzdFRpbWUgKSApIHtcclxuICAgICAgdGhpcy5pc05ld0Jlc3RUaW1lID0gdHJ1ZTtcclxuICAgICAgdGhpcy5iZXN0VGltZVByb3BlcnRpZXNbIGxldmVsIF0udmFsdWUgPSB0aGlzLnRpbWVyLmVsYXBzZWRUaW1lUHJvcGVydHkudmFsdWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxsZWQgd2hlbiB0aGUgdXNlciBwcmVzc2VzIHRoZSBcIlRyeSBBZ2FpblwiIGJ1dHRvbi5cclxuICAgKi9cclxuICBwdWJsaWMgdHJ5QWdhaW4oKTogdm9pZCB7XHJcbiAgICB0aGlzLnN0YXRlUHJvcGVydHkudmFsdWUgPSBHYW1lU3RhdGUuQ0hFQ0s7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxsZWQgd2hlbiB0aGUgdXNlciBwcmVzc2VzIHRoZSBcIlNob3cgQW5zd2VyXCIgYnV0dG9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzaG93QW5zd2VyKCk6IHZvaWQge1xyXG4gICAgdGhpcy5zdGF0ZVByb3BlcnR5LnZhbHVlID0gR2FtZVN0YXRlLk5FWFQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBudW1iZXIgb2YgZXF1YXRpb25zIGZvciBhIHNwZWNpZmllZCBsZXZlbC5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TnVtYmVyT2ZFcXVhdGlvbnMoIGxldmVsOiBudW1iZXIgKTogbnVtYmVyIHtcclxuICAgIHJldHVybiBHYW1lRmFjdG9yeS5nZXROdW1iZXJPZkVxdWF0aW9ucyggbGV2ZWwgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIG51bWJlciBvZiBwb2ludHMgaW4gYSBwZXJmZWN0IHNjb3JlIGZvciBhIHNwZWNpZmllZCBsZXZlbC5cclxuICAgKiBBIHBlcmZlY3Qgc2NvcmUgaXMgb2J0YWluZWQgd2hlbiB0aGUgdXNlciBiYWxhbmNlcyBldmVyeSBlcXVhdGlvbiBjb3JyZWN0bHkgb24gdGhlIGZpcnN0IGF0dGVtcHQuXHJcbiAgICovXHJcbiAgcHVibGljIGdldFBlcmZlY3RTY29yZSggbGV2ZWw6IG51bWJlciApOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0TnVtYmVyT2ZFcXVhdGlvbnMoIGxldmVsICkgKiBQT0lOVFNfRklSU1RfQVRURU1QVDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIElzIHRoZSBjdXJyZW50IHNjb3JlIGEgcGVyZmVjdCBzY29yZT9cclxuICAgKiBUaGlzIGNhbiBiZSBjYWxsZWQgYXQgYW55IHRpbWUgZHVyaW5nIHRoZSBnYW1lLCBidXQgY2FuJ3QgcG9zc2libHkgcmV0dXJuIHRydWUgdW50aWwgdGhlIGdhbWUgaGFzIGJlZW4gY29tcGxldGVkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBpc1BlcmZlY3RTY29yZSgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnBvaW50c1Byb3BlcnR5LnZhbHVlID09PSB0aGlzLmdldFBlcmZlY3RTY29yZSggdGhpcy5sZXZlbFByb3BlcnR5LnZhbHVlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxsZWQgd2hlbiB0aGUgdXNlciBwcmVzc2VzIHRoZSBcIlN0YXJ0IE92ZXJcIiBidXR0b24uXHJcbiAgICovXHJcbiAgcHVibGljIG5ld0dhbWUoKTogdm9pZCB7XHJcbiAgICB0aGlzLnN0YXRlUHJvcGVydHkudmFsdWUgPSBHYW1lU3RhdGUuTEVWRUxfU0VMRUNUSU9OO1xyXG4gICAgdGhpcy50aW1lci5yZXN0YXJ0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxsZWQgd2hlbiB0aGUgdXNlciBwcmVzc2VzIHRoZSBcIk5leHRcIiBidXR0b24uXHJcbiAgICovXHJcbiAgcHVibGljIG5leHQoKTogdm9pZCB7XHJcbiAgICBpZiAoIHRoaXMuY3VycmVudEVxdWF0aW9uSW5kZXhQcm9wZXJ0eS52YWx1ZSA8IHRoaXMuZXF1YXRpb25zLmxlbmd0aCAtIDEgKSB7XHJcbiAgICAgIHRoaXMuYXR0ZW1wdHMgPSAwO1xyXG4gICAgICB0aGlzLmN1cnJlbnRQb2ludHMgPSAwO1xyXG4gICAgICB0aGlzLmJhbGFuY2VkUmVwcmVzZW50YXRpb24gPSBCQUxBTkNFRF9SRVBSRVNFTlRBVElPTl9TVFJBVEVHSUVTWyB0aGlzLmxldmVsUHJvcGVydHkudmFsdWUgXSgpO1xyXG4gICAgICB0aGlzLmN1cnJlbnRFcXVhdGlvbkluZGV4UHJvcGVydHkudmFsdWUgPSB0aGlzLmN1cnJlbnRFcXVhdGlvbkluZGV4UHJvcGVydHkudmFsdWUgKyAxO1xyXG4gICAgICB0aGlzLmN1cnJlbnRFcXVhdGlvblByb3BlcnR5LnZhbHVlID0gdGhpcy5lcXVhdGlvbnNbIHRoaXMuY3VycmVudEVxdWF0aW9uSW5kZXhQcm9wZXJ0eS52YWx1ZSBdO1xyXG4gICAgICB0aGlzLnN0YXRlUHJvcGVydHkudmFsdWUgPSBHYW1lU3RhdGUuQ0hFQ0s7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5zdGF0ZVByb3BlcnR5LnZhbHVlID0gR2FtZVN0YXRlLkxFVkVMX0NPTVBMRVRFRDtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmJhbGFuY2luZ0NoZW1pY2FsRXF1YXRpb25zLnJlZ2lzdGVyKCAnR2FtZU1vZGVsJywgR2FtZU1vZGVsICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGNBQWMsTUFBTSx1Q0FBdUM7QUFDbEUsT0FBT0MsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxtQkFBbUIsTUFBTSw0Q0FBNEM7QUFDNUUsT0FBT0MsU0FBUyxNQUFNLGlDQUFpQztBQUN2RCxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLFNBQVMsTUFBTSxtQ0FBbUM7QUFDekQsT0FBT0MsMEJBQTBCLE1BQU0scUNBQXFDO0FBQzVFLE9BQU9DLHNCQUFzQixNQUFNLDhDQUE4QztBQUNqRixPQUFPQyxpQkFBaUIsTUFBTSx5Q0FBeUM7QUFDdkUsT0FBT0MsV0FBVyxNQUFNLGtCQUFrQjtBQUMxQyxPQUFPQyxTQUFTLE1BQU0sZ0JBQWdCO0FBSXRDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsa0NBQWtDLEdBQUc7QUFFekM7QUFDQSxNQUFNSixzQkFBc0IsQ0FBQ0ssY0FBYztBQUUzQztBQUNBLE1BQU1ULFNBQVMsQ0FBQ1UsVUFBVSxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUdOLHNCQUFzQixDQUFDSyxjQUFjLEdBQUdMLHNCQUFzQixDQUFDTyxVQUFVO0FB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