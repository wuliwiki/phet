// Copyright 2014-2023, University of Colorado Boulder

/**
 * Node that contains all user-interface elements related to playing game challenges.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import merge from '../../../../phet-core/js/merge.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Node, Text } from '../../../../scenery/js/imports.js';
import TextPushButton from '../../../../sun/js/buttons/TextPushButton.js';
import FiniteStatusBar from '../../../../vegas/js/FiniteStatusBar.js';
import ScoreDisplayLabeledNumber from '../../../../vegas/js/ScoreDisplayLabeledNumber.js';
import balancingChemicalEquations from '../../balancingChemicalEquations.js';
import BalancingChemicalEquationsStrings from '../../BalancingChemicalEquationsStrings.js';
import BCEConstants from '../../common/BCEConstants.js';
import BoxesNode from '../../common/view/BoxesNode.js';
import EquationNode from '../../common/view/EquationNode.js';
import HorizontalAligner from '../../common/view/HorizontalAligner.js';
import GameState from '../model/GameState.js';
import GameFeedbackPanel from './GameFeedbackPanel.js';
// constants
const BOX_SIZE = new Dimension2(285, 340);
const BOX_X_SPACING = 140; // horizontal spacing between boxes
const STATUS_BAR_FONT = new PhetFont(14);
const STATUS_BAR_TEXT_FILL = 'white';
export default class GamePlayNode extends Node {
  // created on demand
  // boxes that show molecules corresponding to the equation coefficients

  constructor(model, viewProperties, audioPlayer, layoutBounds, visibleBoundsProperty) {
    super();
    this.model = model;
    this.audioPlayer = audioPlayer;
    this.layoutBounds = layoutBounds;
    this.aligner = new HorizontalAligner(layoutBounds.width, BOX_SIZE.width, BOX_X_SPACING);
    this.feedbackPanel = null;

    // status bar
    const statusBar = new FiniteStatusBar(layoutBounds, visibleBoundsProperty, model.pointsProperty, {
      createScoreDisplay: scoreProperty => new ScoreDisplayLabeledNumber(scoreProperty, {
        font: STATUS_BAR_FONT,
        textFill: STATUS_BAR_TEXT_FILL
      }),
      // FiniteStatusBar uses 1-based level numbering, model is 0-based, see #127.
      levelProperty: new DerivedProperty([model.levelProperty], level => level + 1),
      challengeIndexProperty: model.currentEquationIndexProperty,
      numberOfChallengesProperty: model.numberOfEquationsProperty,
      elapsedTimeProperty: model.timer.elapsedTimeProperty,
      timerEnabledProperty: viewProperties.timerEnabledProperty,
      font: STATUS_BAR_FONT,
      textFill: STATUS_BAR_TEXT_FILL,
      barFill: 'rgb( 49, 117, 202 )',
      xMargin: 30,
      yMargin: 5,
      startOverButtonOptions: {
        baseColor: 'rgb( 229, 243, 255 )',
        textFill: 'black',
        listener: this.model.newGame.bind(this.model),
        xMargin: 10,
        yMargin: 5
      }
    });
    this.addChild(statusBar);
    this.boxesNode = new BoxesNode(model.currentEquationProperty, model.coefficientsRange, this.aligner, BOX_SIZE, BCEConstants.BOX_COLOR, viewProperties.reactantsBoxExpandedProperty, viewProperties.productsBoxExpandedProperty, {
      y: statusBar.bottom + 15
    });
    this.addChild(this.boxesNode);
    this.equationNode = new EquationNode(this.model.currentEquationProperty, this.model.coefficientsRange, this.aligner);
    this.addChild(this.equationNode);
    this.equationNode.centerY = this.layoutBounds.height - (this.layoutBounds.height - this.boxesNode.bottom) / 2;

    // buttons: Check, Next
    const BUTTONS_OPTIONS = {
      font: new PhetFont(20),
      baseColor: 'yellow',
      maxWidth: 0.85 * BOX_X_SPACING
    };
    this.checkButton = new TextPushButton(BalancingChemicalEquationsStrings.checkStringProperty, merge(BUTTONS_OPTIONS, {
      listener: () => {
        this.playGuessAudio();
        this.model.check();
      }
    }));
    this.addChild(this.checkButton);
    this.checkButton.boundsProperty.link(bounds => {
      this.checkButton.centerX = this.layoutBounds.centerX;
      this.checkButton.bottom = this.boxesNode.bottom;
    });
    this.nextButton = new TextPushButton(BalancingChemicalEquationsStrings.nextStringProperty, merge(BUTTONS_OPTIONS, {
      listener: () => {
        this.model.next();
      }
    }));
    this.addChild(this.nextButton);
    this.nextButton.boundsProperty.link(bounds => {
      this.nextButton.centerX = this.layoutBounds.centerX;
      this.nextButton.bottom = this.boxesNode.bottom;
    });

    // developer stuff
    if (phet.chipper.queryParameters.showAnswers) {
      // display correct coefficient at bottom center of the screen
      const answerNode = new Text('', {
        fill: 'red',
        font: new PhetFont(12),
        bottom: this.layoutBounds.bottom - 5
      });
      this.addChild(answerNode);
      this.model.currentEquationProperty.link(equation => {
        answerNode.string = equation.getCoefficientsString();
        answerNode.centerX = this.layoutBounds.centerX;
      });

      // skips the current equation
      const skipButton = new TextPushButton('Skip', {
        font: new PhetFont(10),
        baseColor: 'red',
        textFill: 'white',
        listener: model.next.bind(model),
        // equivalent to 'Next'
        right: answerNode.left - 20,
        bottom: this.layoutBounds.bottom - 2
      });
      this.addChild(skipButton);
    }

    // Call an initializer to set up the game for the state.
    model.stateProperty.link(state => {
      if (state === GameState.CHECK) {
        this.initCheck();
      } else if (state === GameState.TRY_AGAIN) {
        this.initTryAgain();
      } else if (state === GameState.SHOW_ANSWER) {
        this.initShowAnswer();
      } else if (state === GameState.NEXT) {
        this.initNext();
      }
    });

    // Disable 'Check' button when all coefficients are zero.
    const coefficientsSumObserver = coefficientsSum => {
      this.checkButton.enabled = coefficientsSum > 0;
    };
    model.currentEquationProperty.link((newEquation, oldEquation) => {
      if (oldEquation) {
        oldEquation.coefficientsSumProperty.unlink(coefficientsSumObserver);
      }
      if (newEquation) {
        newEquation.coefficientsSumProperty.link(coefficientsSumObserver);
      }
    });
  }

  // No dispose needed, instances of this type persist for lifetime of the sim.

  initCheck() {
    this.equationNode.setCoefficientsEditable(true);
    this.checkButton.visible = true;
    this.nextButton.visible = false;
    this.setFeedbackPanelVisible(false);
    this.setBalancedHighlightEnabled(false);
  }
  initTryAgain() {
    this.equationNode.setCoefficientsEditable(false);
    this.checkButton.visible = this.nextButton.visible = false;
    this.setFeedbackPanelVisible(true);
    this.setBalancedHighlightEnabled(false);
  }
  initShowAnswer() {
    this.equationNode.setCoefficientsEditable(false);
    this.checkButton.visible = this.nextButton.visible = false;
    this.setFeedbackPanelVisible(true);
    this.setBalancedHighlightEnabled(false);
  }
  initNext() {
    this.equationNode.setCoefficientsEditable(false);
    this.checkButton.visible = false;
    const currentEquation = this.model.currentEquationProperty.value;
    this.nextButton.visible = !currentEquation.balancedAndSimplified; // 'Next' button is in the feedbackPanel
    this.setFeedbackPanelVisible(currentEquation.balancedAndSimplified);
    this.setBalancedHighlightEnabled(true);
    currentEquation.balance(); // show the correct answer (do this last!)
  }

  /*
   * Turns on/off the highlighting feature that indicates whether the equation is balanced.
   * We need to be able to control this so that a balanced equation doesn't highlight
   * until after the user has completed a challenge.
   */
  setBalancedHighlightEnabled(enabled) {
    this.equationNode.setBalancedHighlightEnabled(enabled);
    this.boxesNode.setBalancedHighlightEnabled(enabled);
  }

  /**
   * Plays a sound corresponding to whether the user's guess is correct or incorrect.
   */
  playGuessAudio() {
    if (this.model.currentEquationProperty.value.balancedAndSimplified) {
      this.audioPlayer.correctAnswer();
    } else {
      this.audioPlayer.wrongAnswer();
    }
  }

  /**
   * Controls the visibility of the game feedback panel.
   * This tells the user whether their guess is correct or not.
   */
  setFeedbackPanelVisible(visible) {
    if (this.feedbackPanel) {
      this.removeChild(this.feedbackPanel);
      this.feedbackPanel = null;
    }
    if (visible) {
      this.feedbackPanel = new GameFeedbackPanel(this.model, this.aligner, {
        centerX: this.layoutBounds.centerX,
        top: this.boxesNode.top + 10
      });
      this.addChild(this.feedbackPanel); // visible and in front
    }
  }
}

balancingChemicalEquations.register('GamePlayNode', GamePlayNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJEaW1lbnNpb24yIiwibWVyZ2UiLCJQaGV0Rm9udCIsIk5vZGUiLCJUZXh0IiwiVGV4dFB1c2hCdXR0b24iLCJGaW5pdGVTdGF0dXNCYXIiLCJTY29yZURpc3BsYXlMYWJlbGVkTnVtYmVyIiwiYmFsYW5jaW5nQ2hlbWljYWxFcXVhdGlvbnMiLCJCYWxhbmNpbmdDaGVtaWNhbEVxdWF0aW9uc1N0cmluZ3MiLCJCQ0VDb25zdGFudHMiLCJCb3hlc05vZGUiLCJFcXVhdGlvbk5vZGUiLCJIb3Jpem9udGFsQWxpZ25lciIsIkdhbWVTdGF0ZSIsIkdhbWVGZWVkYmFja1BhbmVsIiwiQk9YX1NJWkUiLCJCT1hfWF9TUEFDSU5HIiwiU1RBVFVTX0JBUl9GT05UIiwiU1RBVFVTX0JBUl9URVhUX0ZJTEwiLCJHYW1lUGxheU5vZGUiLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwidmlld1Byb3BlcnRpZXMiLCJhdWRpb1BsYXllciIsImxheW91dEJvdW5kcyIsInZpc2libGVCb3VuZHNQcm9wZXJ0eSIsImFsaWduZXIiLCJ3aWR0aCIsImZlZWRiYWNrUGFuZWwiLCJzdGF0dXNCYXIiLCJwb2ludHNQcm9wZXJ0eSIsImNyZWF0ZVNjb3JlRGlzcGxheSIsInNjb3JlUHJvcGVydHkiLCJmb250IiwidGV4dEZpbGwiLCJsZXZlbFByb3BlcnR5IiwibGV2ZWwiLCJjaGFsbGVuZ2VJbmRleFByb3BlcnR5IiwiY3VycmVudEVxdWF0aW9uSW5kZXhQcm9wZXJ0eSIsIm51bWJlck9mQ2hhbGxlbmdlc1Byb3BlcnR5IiwibnVtYmVyT2ZFcXVhdGlvbnNQcm9wZXJ0eSIsImVsYXBzZWRUaW1lUHJvcGVydHkiLCJ0aW1lciIsInRpbWVyRW5hYmxlZFByb3BlcnR5IiwiYmFyRmlsbCIsInhNYXJnaW4iLCJ5TWFyZ2luIiwic3RhcnRPdmVyQnV0dG9uT3B0aW9ucyIsImJhc2VDb2xvciIsImxpc3RlbmVyIiwibmV3R2FtZSIsImJpbmQiLCJhZGRDaGlsZCIsImJveGVzTm9kZSIsImN1cnJlbnRFcXVhdGlvblByb3BlcnR5IiwiY29lZmZpY2llbnRzUmFuZ2UiLCJCT1hfQ09MT1IiLCJyZWFjdGFudHNCb3hFeHBhbmRlZFByb3BlcnR5IiwicHJvZHVjdHNCb3hFeHBhbmRlZFByb3BlcnR5IiwieSIsImJvdHRvbSIsImVxdWF0aW9uTm9kZSIsImNlbnRlclkiLCJoZWlnaHQiLCJCVVRUT05TX09QVElPTlMiLCJtYXhXaWR0aCIsImNoZWNrQnV0dG9uIiwiY2hlY2tTdHJpbmdQcm9wZXJ0eSIsInBsYXlHdWVzc0F1ZGlvIiwiY2hlY2siLCJib3VuZHNQcm9wZXJ0eSIsImxpbmsiLCJib3VuZHMiLCJjZW50ZXJYIiwibmV4dEJ1dHRvbiIsIm5leHRTdHJpbmdQcm9wZXJ0eSIsIm5leHQiLCJwaGV0IiwiY2hpcHBlciIsInF1ZXJ5UGFyYW1ldGVycyIsInNob3dBbnN3ZXJzIiwiYW5zd2VyTm9kZSIsImZpbGwiLCJlcXVhdGlvbiIsInN0cmluZyIsImdldENvZWZmaWNpZW50c1N0cmluZyIsInNraXBCdXR0b24iLCJyaWdodCIsImxlZnQiLCJzdGF0ZVByb3BlcnR5Iiwic3RhdGUiLCJDSEVDSyIsImluaXRDaGVjayIsIlRSWV9BR0FJTiIsImluaXRUcnlBZ2FpbiIsIlNIT1dfQU5TV0VSIiwiaW5pdFNob3dBbnN3ZXIiLCJORVhUIiwiaW5pdE5leHQiLCJjb2VmZmljaWVudHNTdW1PYnNlcnZlciIsImNvZWZmaWNpZW50c1N1bSIsImVuYWJsZWQiLCJuZXdFcXVhdGlvbiIsIm9sZEVxdWF0aW9uIiwiY29lZmZpY2llbnRzU3VtUHJvcGVydHkiLCJ1bmxpbmsiLCJzZXRDb2VmZmljaWVudHNFZGl0YWJsZSIsInZpc2libGUiLCJzZXRGZWVkYmFja1BhbmVsVmlzaWJsZSIsInNldEJhbGFuY2VkSGlnaGxpZ2h0RW5hYmxlZCIsImN1cnJlbnRFcXVhdGlvbiIsInZhbHVlIiwiYmFsYW5jZWRBbmRTaW1wbGlmaWVkIiwiYmFsYW5jZSIsImNvcnJlY3RBbnN3ZXIiLCJ3cm9uZ0Fuc3dlciIsInJlbW92ZUNoaWxkIiwidG9wIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJHYW1lUGxheU5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogTm9kZSB0aGF0IGNvbnRhaW5zIGFsbCB1c2VyLWludGVyZmFjZSBlbGVtZW50cyByZWxhdGVkIHRvIHBsYXlpbmcgZ2FtZSBjaGFsbGVuZ2VzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IERpbWVuc2lvbjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0RpbWVuc2lvbjIuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgVGV4dFB1c2hCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL2J1dHRvbnMvVGV4dFB1c2hCdXR0b24uanMnO1xyXG5pbXBvcnQgRmluaXRlU3RhdHVzQmFyIGZyb20gJy4uLy4uLy4uLy4uL3ZlZ2FzL2pzL0Zpbml0ZVN0YXR1c0Jhci5qcyc7XHJcbmltcG9ydCBHYW1lQXVkaW9QbGF5ZXIgZnJvbSAnLi4vLi4vLi4vLi4vdmVnYXMvanMvR2FtZUF1ZGlvUGxheWVyLmpzJztcclxuaW1wb3J0IFNjb3JlRGlzcGxheUxhYmVsZWROdW1iZXIgZnJvbSAnLi4vLi4vLi4vLi4vdmVnYXMvanMvU2NvcmVEaXNwbGF5TGFiZWxlZE51bWJlci5qcyc7XHJcbmltcG9ydCBiYWxhbmNpbmdDaGVtaWNhbEVxdWF0aW9ucyBmcm9tICcuLi8uLi9iYWxhbmNpbmdDaGVtaWNhbEVxdWF0aW9ucy5qcyc7XHJcbmltcG9ydCBCYWxhbmNpbmdDaGVtaWNhbEVxdWF0aW9uc1N0cmluZ3MgZnJvbSAnLi4vLi4vQmFsYW5jaW5nQ2hlbWljYWxFcXVhdGlvbnNTdHJpbmdzLmpzJztcclxuaW1wb3J0IEJDRUNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vQkNFQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEJveGVzTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9Cb3hlc05vZGUuanMnO1xyXG5pbXBvcnQgRXF1YXRpb25Ob2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0VxdWF0aW9uTm9kZS5qcyc7XHJcbmltcG9ydCBIb3Jpem9udGFsQWxpZ25lciBmcm9tICcuLi8uLi9jb21tb24vdmlldy9Ib3Jpem9udGFsQWxpZ25lci5qcyc7XHJcbmltcG9ydCBHYW1lTW9kZWwgZnJvbSAnLi4vbW9kZWwvR2FtZU1vZGVsLmpzJztcclxuaW1wb3J0IEdhbWVTdGF0ZSBmcm9tICcuLi9tb2RlbC9HYW1lU3RhdGUuanMnO1xyXG5pbXBvcnQgR2FtZUZlZWRiYWNrUGFuZWwgZnJvbSAnLi9HYW1lRmVlZGJhY2tQYW5lbC5qcyc7XHJcbmltcG9ydCBHYW1lVmlld1Byb3BlcnRpZXMgZnJvbSAnLi9HYW1lVmlld1Byb3BlcnRpZXMuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IEJPWF9TSVpFID0gbmV3IERpbWVuc2lvbjIoIDI4NSwgMzQwICk7XHJcbmNvbnN0IEJPWF9YX1NQQUNJTkcgPSAxNDA7IC8vIGhvcml6b250YWwgc3BhY2luZyBiZXR3ZWVuIGJveGVzXHJcbmNvbnN0IFNUQVRVU19CQVJfRk9OVCA9IG5ldyBQaGV0Rm9udCggMTQgKTtcclxuY29uc3QgU1RBVFVTX0JBUl9URVhUX0ZJTEwgPSAnd2hpdGUnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZVBsYXlOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgbW9kZWw6IEdhbWVNb2RlbDtcclxuICBwcml2YXRlIHJlYWRvbmx5IGF1ZGlvUGxheWVyOiBHYW1lQXVkaW9QbGF5ZXI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBsYXlvdXRCb3VuZHM6IEJvdW5kczI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBhbGlnbmVyOiBIb3Jpem9udGFsQWxpZ25lcjtcclxuICBwcml2YXRlIGZlZWRiYWNrUGFuZWw6IEdhbWVGZWVkYmFja1BhbmVsIHwgbnVsbDsgLy8gY3JlYXRlZCBvbiBkZW1hbmRcclxuICBwcml2YXRlIHJlYWRvbmx5IGJveGVzTm9kZTogQm94ZXNOb2RlOyAvLyBib3hlcyB0aGF0IHNob3cgbW9sZWN1bGVzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGVxdWF0aW9uIGNvZWZmaWNpZW50c1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZXF1YXRpb25Ob2RlOiBFcXVhdGlvbk5vZGU7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBjaGVja0J1dHRvbjogVGV4dFB1c2hCdXR0b247XHJcbiAgcHJpdmF0ZSByZWFkb25seSBuZXh0QnV0dG9uOiBUZXh0UHVzaEJ1dHRvbjtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBtb2RlbDogR2FtZU1vZGVsLCB2aWV3UHJvcGVydGllczogR2FtZVZpZXdQcm9wZXJ0aWVzLCBhdWRpb1BsYXllcjogR2FtZUF1ZGlvUGxheWVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgbGF5b3V0Qm91bmRzOiBCb3VuZHMyLCB2aXNpYmxlQm91bmRzUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PEJvdW5kczI+ICkge1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xyXG4gICAgdGhpcy5hdWRpb1BsYXllciA9IGF1ZGlvUGxheWVyO1xyXG4gICAgdGhpcy5sYXlvdXRCb3VuZHMgPSBsYXlvdXRCb3VuZHM7XHJcbiAgICB0aGlzLmFsaWduZXIgPSBuZXcgSG9yaXpvbnRhbEFsaWduZXIoIGxheW91dEJvdW5kcy53aWR0aCwgQk9YX1NJWkUud2lkdGgsIEJPWF9YX1NQQUNJTkcgKTtcclxuICAgIHRoaXMuZmVlZGJhY2tQYW5lbCA9IG51bGw7XHJcblxyXG4gICAgLy8gc3RhdHVzIGJhclxyXG4gICAgY29uc3Qgc3RhdHVzQmFyID0gbmV3IEZpbml0ZVN0YXR1c0JhciggbGF5b3V0Qm91bmRzLCB2aXNpYmxlQm91bmRzUHJvcGVydHksIG1vZGVsLnBvaW50c1Byb3BlcnR5LCB7XHJcbiAgICAgIGNyZWF0ZVNjb3JlRGlzcGxheTogc2NvcmVQcm9wZXJ0eSA9PiBuZXcgU2NvcmVEaXNwbGF5TGFiZWxlZE51bWJlciggc2NvcmVQcm9wZXJ0eSwge1xyXG4gICAgICAgIGZvbnQ6IFNUQVRVU19CQVJfRk9OVCxcclxuICAgICAgICB0ZXh0RmlsbDogU1RBVFVTX0JBUl9URVhUX0ZJTExcclxuICAgICAgfSApLFxyXG5cclxuICAgICAgLy8gRmluaXRlU3RhdHVzQmFyIHVzZXMgMS1iYXNlZCBsZXZlbCBudW1iZXJpbmcsIG1vZGVsIGlzIDAtYmFzZWQsIHNlZSAjMTI3LlxyXG4gICAgICBsZXZlbFByb3BlcnR5OiBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIG1vZGVsLmxldmVsUHJvcGVydHkgXSwgbGV2ZWwgPT4gbGV2ZWwgKyAxICksXHJcbiAgICAgIGNoYWxsZW5nZUluZGV4UHJvcGVydHk6IG1vZGVsLmN1cnJlbnRFcXVhdGlvbkluZGV4UHJvcGVydHksXHJcbiAgICAgIG51bWJlck9mQ2hhbGxlbmdlc1Byb3BlcnR5OiBtb2RlbC5udW1iZXJPZkVxdWF0aW9uc1Byb3BlcnR5LFxyXG4gICAgICBlbGFwc2VkVGltZVByb3BlcnR5OiBtb2RlbC50aW1lci5lbGFwc2VkVGltZVByb3BlcnR5LFxyXG4gICAgICB0aW1lckVuYWJsZWRQcm9wZXJ0eTogdmlld1Byb3BlcnRpZXMudGltZXJFbmFibGVkUHJvcGVydHksXHJcbiAgICAgIGZvbnQ6IFNUQVRVU19CQVJfRk9OVCxcclxuICAgICAgdGV4dEZpbGw6IFNUQVRVU19CQVJfVEVYVF9GSUxMLFxyXG4gICAgICBiYXJGaWxsOiAncmdiKCA0OSwgMTE3LCAyMDIgKScsXHJcbiAgICAgIHhNYXJnaW46IDMwLFxyXG4gICAgICB5TWFyZ2luOiA1LFxyXG4gICAgICBzdGFydE92ZXJCdXR0b25PcHRpb25zOiB7XHJcbiAgICAgICAgYmFzZUNvbG9yOiAncmdiKCAyMjksIDI0MywgMjU1ICknLFxyXG4gICAgICAgIHRleHRGaWxsOiAnYmxhY2snLFxyXG4gICAgICAgIGxpc3RlbmVyOiB0aGlzLm1vZGVsLm5ld0dhbWUuYmluZCggdGhpcy5tb2RlbCApLFxyXG4gICAgICAgIHhNYXJnaW46IDEwLFxyXG4gICAgICAgIHlNYXJnaW46IDVcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggc3RhdHVzQmFyICk7XHJcblxyXG4gICAgdGhpcy5ib3hlc05vZGUgPSBuZXcgQm94ZXNOb2RlKCBtb2RlbC5jdXJyZW50RXF1YXRpb25Qcm9wZXJ0eSwgbW9kZWwuY29lZmZpY2llbnRzUmFuZ2UsIHRoaXMuYWxpZ25lcixcclxuICAgICAgQk9YX1NJWkUsIEJDRUNvbnN0YW50cy5CT1hfQ09MT1IsIHZpZXdQcm9wZXJ0aWVzLnJlYWN0YW50c0JveEV4cGFuZGVkUHJvcGVydHksIHZpZXdQcm9wZXJ0aWVzLnByb2R1Y3RzQm94RXhwYW5kZWRQcm9wZXJ0eSxcclxuICAgICAgeyB5OiBzdGF0dXNCYXIuYm90dG9tICsgMTUgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5ib3hlc05vZGUgKTtcclxuXHJcbiAgICB0aGlzLmVxdWF0aW9uTm9kZSA9IG5ldyBFcXVhdGlvbk5vZGUoIHRoaXMubW9kZWwuY3VycmVudEVxdWF0aW9uUHJvcGVydHksIHRoaXMubW9kZWwuY29lZmZpY2llbnRzUmFuZ2UsIHRoaXMuYWxpZ25lciApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5lcXVhdGlvbk5vZGUgKTtcclxuICAgIHRoaXMuZXF1YXRpb25Ob2RlLmNlbnRlclkgPSB0aGlzLmxheW91dEJvdW5kcy5oZWlnaHQgLSAoIHRoaXMubGF5b3V0Qm91bmRzLmhlaWdodCAtIHRoaXMuYm94ZXNOb2RlLmJvdHRvbSApIC8gMjtcclxuXHJcbiAgICAvLyBidXR0b25zOiBDaGVjaywgTmV4dFxyXG4gICAgY29uc3QgQlVUVE9OU19PUFRJT05TID0ge1xyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIDIwICksXHJcbiAgICAgIGJhc2VDb2xvcjogJ3llbGxvdycsXHJcbiAgICAgIG1heFdpZHRoOiAwLjg1ICogQk9YX1hfU1BBQ0lOR1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmNoZWNrQnV0dG9uID0gbmV3IFRleHRQdXNoQnV0dG9uKCBCYWxhbmNpbmdDaGVtaWNhbEVxdWF0aW9uc1N0cmluZ3MuY2hlY2tTdHJpbmdQcm9wZXJ0eSwgbWVyZ2UoIEJVVFRPTlNfT1BUSU9OUywge1xyXG4gICAgICBsaXN0ZW5lcjogKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucGxheUd1ZXNzQXVkaW8oKTtcclxuICAgICAgICB0aGlzLm1vZGVsLmNoZWNrKCk7XHJcbiAgICAgIH1cclxuICAgIH0gKSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5jaGVja0J1dHRvbiApO1xyXG5cclxuICAgIHRoaXMuY2hlY2tCdXR0b24uYm91bmRzUHJvcGVydHkubGluayggYm91bmRzID0+IHtcclxuICAgICAgdGhpcy5jaGVja0J1dHRvbi5jZW50ZXJYID0gdGhpcy5sYXlvdXRCb3VuZHMuY2VudGVyWDtcclxuICAgICAgdGhpcy5jaGVja0J1dHRvbi5ib3R0b20gPSB0aGlzLmJveGVzTm9kZS5ib3R0b207XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5uZXh0QnV0dG9uID0gbmV3IFRleHRQdXNoQnV0dG9uKCBCYWxhbmNpbmdDaGVtaWNhbEVxdWF0aW9uc1N0cmluZ3MubmV4dFN0cmluZ1Byb3BlcnR5LCBtZXJnZSggQlVUVE9OU19PUFRJT05TLCB7XHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5tb2RlbC5uZXh0KCk7XHJcbiAgICAgIH1cclxuICAgIH0gKSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5uZXh0QnV0dG9uICk7XHJcblxyXG4gICAgdGhpcy5uZXh0QnV0dG9uLmJvdW5kc1Byb3BlcnR5LmxpbmsoIGJvdW5kcyA9PiB7XHJcbiAgICAgIHRoaXMubmV4dEJ1dHRvbi5jZW50ZXJYID0gdGhpcy5sYXlvdXRCb3VuZHMuY2VudGVyWDtcclxuICAgICAgdGhpcy5uZXh0QnV0dG9uLmJvdHRvbSA9IHRoaXMuYm94ZXNOb2RlLmJvdHRvbTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBkZXZlbG9wZXIgc3R1ZmZcclxuICAgIGlmICggcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5zaG93QW5zd2VycyApIHtcclxuXHJcbiAgICAgIC8vIGRpc3BsYXkgY29ycmVjdCBjb2VmZmljaWVudCBhdCBib3R0b20gY2VudGVyIG9mIHRoZSBzY3JlZW5cclxuICAgICAgY29uc3QgYW5zd2VyTm9kZSA9IG5ldyBUZXh0KCAnJywge1xyXG4gICAgICAgIGZpbGw6ICdyZWQnLFxyXG4gICAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTIgKSxcclxuICAgICAgICBib3R0b206IHRoaXMubGF5b3V0Qm91bmRzLmJvdHRvbSAtIDVcclxuICAgICAgfSApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCBhbnN3ZXJOb2RlICk7XHJcbiAgICAgIHRoaXMubW9kZWwuY3VycmVudEVxdWF0aW9uUHJvcGVydHkubGluayggZXF1YXRpb24gPT4ge1xyXG4gICAgICAgIGFuc3dlck5vZGUuc3RyaW5nID0gZXF1YXRpb24uZ2V0Q29lZmZpY2llbnRzU3RyaW5nKCk7XHJcbiAgICAgICAgYW5zd2VyTm9kZS5jZW50ZXJYID0gdGhpcy5sYXlvdXRCb3VuZHMuY2VudGVyWDtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgLy8gc2tpcHMgdGhlIGN1cnJlbnQgZXF1YXRpb25cclxuICAgICAgY29uc3Qgc2tpcEJ1dHRvbiA9IG5ldyBUZXh0UHVzaEJ1dHRvbiggJ1NraXAnLCB7XHJcbiAgICAgICAgZm9udDogbmV3IFBoZXRGb250KCAxMCApLFxyXG4gICAgICAgIGJhc2VDb2xvcjogJ3JlZCcsXHJcbiAgICAgICAgdGV4dEZpbGw6ICd3aGl0ZScsXHJcbiAgICAgICAgbGlzdGVuZXI6IG1vZGVsLm5leHQuYmluZCggbW9kZWwgKSwgLy8gZXF1aXZhbGVudCB0byAnTmV4dCdcclxuICAgICAgICByaWdodDogYW5zd2VyTm9kZS5sZWZ0IC0gMjAsXHJcbiAgICAgICAgYm90dG9tOiB0aGlzLmxheW91dEJvdW5kcy5ib3R0b20gLSAyXHJcbiAgICAgIH0gKTtcclxuICAgICAgdGhpcy5hZGRDaGlsZCggc2tpcEJ1dHRvbiApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENhbGwgYW4gaW5pdGlhbGl6ZXIgdG8gc2V0IHVwIHRoZSBnYW1lIGZvciB0aGUgc3RhdGUuXHJcbiAgICBtb2RlbC5zdGF0ZVByb3BlcnR5LmxpbmsoIHN0YXRlID0+IHtcclxuICAgICAgaWYgKCBzdGF0ZSA9PT0gR2FtZVN0YXRlLkNIRUNLICkge1xyXG4gICAgICAgIHRoaXMuaW5pdENoZWNrKCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHN0YXRlID09PSBHYW1lU3RhdGUuVFJZX0FHQUlOICkge1xyXG4gICAgICAgIHRoaXMuaW5pdFRyeUFnYWluKCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHN0YXRlID09PSBHYW1lU3RhdGUuU0hPV19BTlNXRVIgKSB7XHJcbiAgICAgICAgdGhpcy5pbml0U2hvd0Fuc3dlcigpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBzdGF0ZSA9PT0gR2FtZVN0YXRlLk5FWFQgKSB7XHJcbiAgICAgICAgdGhpcy5pbml0TmV4dCgpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gRGlzYWJsZSAnQ2hlY2snIGJ1dHRvbiB3aGVuIGFsbCBjb2VmZmljaWVudHMgYXJlIHplcm8uXHJcbiAgICBjb25zdCBjb2VmZmljaWVudHNTdW1PYnNlcnZlciA9ICggY29lZmZpY2llbnRzU3VtOiBudW1iZXIgKSA9PiB7XHJcbiAgICAgIHRoaXMuY2hlY2tCdXR0b24uZW5hYmxlZCA9ICggY29lZmZpY2llbnRzU3VtID4gMCApO1xyXG4gICAgfTtcclxuICAgIG1vZGVsLmN1cnJlbnRFcXVhdGlvblByb3BlcnR5LmxpbmsoICggbmV3RXF1YXRpb24sIG9sZEVxdWF0aW9uICkgPT4ge1xyXG4gICAgICBpZiAoIG9sZEVxdWF0aW9uICkgeyBvbGRFcXVhdGlvbi5jb2VmZmljaWVudHNTdW1Qcm9wZXJ0eS51bmxpbmsoIGNvZWZmaWNpZW50c1N1bU9ic2VydmVyICk7IH1cclxuICAgICAgaWYgKCBuZXdFcXVhdGlvbiApIHsgbmV3RXF1YXRpb24uY29lZmZpY2llbnRzU3VtUHJvcGVydHkubGluayggY29lZmZpY2llbnRzU3VtT2JzZXJ2ZXIgKTsgfVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLy8gTm8gZGlzcG9zZSBuZWVkZWQsIGluc3RhbmNlcyBvZiB0aGlzIHR5cGUgcGVyc2lzdCBmb3IgbGlmZXRpbWUgb2YgdGhlIHNpbS5cclxuXHJcbiAgcHJpdmF0ZSBpbml0Q2hlY2soKTogdm9pZCB7XHJcbiAgICB0aGlzLmVxdWF0aW9uTm9kZS5zZXRDb2VmZmljaWVudHNFZGl0YWJsZSggdHJ1ZSApO1xyXG4gICAgdGhpcy5jaGVja0J1dHRvbi52aXNpYmxlID0gdHJ1ZTtcclxuICAgIHRoaXMubmV4dEJ1dHRvbi52aXNpYmxlID0gZmFsc2U7XHJcbiAgICB0aGlzLnNldEZlZWRiYWNrUGFuZWxWaXNpYmxlKCBmYWxzZSApO1xyXG4gICAgdGhpcy5zZXRCYWxhbmNlZEhpZ2hsaWdodEVuYWJsZWQoIGZhbHNlICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGluaXRUcnlBZ2FpbigpOiB2b2lkIHtcclxuICAgIHRoaXMuZXF1YXRpb25Ob2RlLnNldENvZWZmaWNpZW50c0VkaXRhYmxlKCBmYWxzZSApO1xyXG4gICAgdGhpcy5jaGVja0J1dHRvbi52aXNpYmxlID0gdGhpcy5uZXh0QnV0dG9uLnZpc2libGUgPSBmYWxzZTtcclxuICAgIHRoaXMuc2V0RmVlZGJhY2tQYW5lbFZpc2libGUoIHRydWUgKTtcclxuICAgIHRoaXMuc2V0QmFsYW5jZWRIaWdobGlnaHRFbmFibGVkKCBmYWxzZSApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbml0U2hvd0Fuc3dlcigpOiB2b2lkIHtcclxuICAgIHRoaXMuZXF1YXRpb25Ob2RlLnNldENvZWZmaWNpZW50c0VkaXRhYmxlKCBmYWxzZSApO1xyXG4gICAgdGhpcy5jaGVja0J1dHRvbi52aXNpYmxlID0gdGhpcy5uZXh0QnV0dG9uLnZpc2libGUgPSBmYWxzZTtcclxuICAgIHRoaXMuc2V0RmVlZGJhY2tQYW5lbFZpc2libGUoIHRydWUgKTtcclxuICAgIHRoaXMuc2V0QmFsYW5jZWRIaWdobGlnaHRFbmFibGVkKCBmYWxzZSApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbml0TmV4dCgpOiB2b2lkIHtcclxuXHJcbiAgICB0aGlzLmVxdWF0aW9uTm9kZS5zZXRDb2VmZmljaWVudHNFZGl0YWJsZSggZmFsc2UgKTtcclxuICAgIHRoaXMuY2hlY2tCdXR0b24udmlzaWJsZSA9IGZhbHNlO1xyXG5cclxuICAgIGNvbnN0IGN1cnJlbnRFcXVhdGlvbiA9IHRoaXMubW9kZWwuY3VycmVudEVxdWF0aW9uUHJvcGVydHkudmFsdWU7XHJcbiAgICB0aGlzLm5leHRCdXR0b24udmlzaWJsZSA9ICFjdXJyZW50RXF1YXRpb24uYmFsYW5jZWRBbmRTaW1wbGlmaWVkOyAvLyAnTmV4dCcgYnV0dG9uIGlzIGluIHRoZSBmZWVkYmFja1BhbmVsXHJcbiAgICB0aGlzLnNldEZlZWRiYWNrUGFuZWxWaXNpYmxlKCBjdXJyZW50RXF1YXRpb24uYmFsYW5jZWRBbmRTaW1wbGlmaWVkICk7XHJcbiAgICB0aGlzLnNldEJhbGFuY2VkSGlnaGxpZ2h0RW5hYmxlZCggdHJ1ZSApO1xyXG4gICAgY3VycmVudEVxdWF0aW9uLmJhbGFuY2UoKTsgLy8gc2hvdyB0aGUgY29ycmVjdCBhbnN3ZXIgKGRvIHRoaXMgbGFzdCEpXHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIFR1cm5zIG9uL29mZiB0aGUgaGlnaGxpZ2h0aW5nIGZlYXR1cmUgdGhhdCBpbmRpY2F0ZXMgd2hldGhlciB0aGUgZXF1YXRpb24gaXMgYmFsYW5jZWQuXHJcbiAgICogV2UgbmVlZCB0byBiZSBhYmxlIHRvIGNvbnRyb2wgdGhpcyBzbyB0aGF0IGEgYmFsYW5jZWQgZXF1YXRpb24gZG9lc24ndCBoaWdobGlnaHRcclxuICAgKiB1bnRpbCBhZnRlciB0aGUgdXNlciBoYXMgY29tcGxldGVkIGEgY2hhbGxlbmdlLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0QmFsYW5jZWRIaWdobGlnaHRFbmFibGVkKCBlbmFibGVkOiBib29sZWFuICk6IHZvaWQge1xyXG4gICAgdGhpcy5lcXVhdGlvbk5vZGUuc2V0QmFsYW5jZWRIaWdobGlnaHRFbmFibGVkKCBlbmFibGVkICk7XHJcbiAgICB0aGlzLmJveGVzTm9kZS5zZXRCYWxhbmNlZEhpZ2hsaWdodEVuYWJsZWQoIGVuYWJsZWQgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFBsYXlzIGEgc291bmQgY29ycmVzcG9uZGluZyB0byB3aGV0aGVyIHRoZSB1c2VyJ3MgZ3Vlc3MgaXMgY29ycmVjdCBvciBpbmNvcnJlY3QuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBwbGF5R3Vlc3NBdWRpbygpOiB2b2lkIHtcclxuICAgIGlmICggdGhpcy5tb2RlbC5jdXJyZW50RXF1YXRpb25Qcm9wZXJ0eS52YWx1ZS5iYWxhbmNlZEFuZFNpbXBsaWZpZWQgKSB7XHJcbiAgICAgIHRoaXMuYXVkaW9QbGF5ZXIuY29ycmVjdEFuc3dlcigpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMuYXVkaW9QbGF5ZXIud3JvbmdBbnN3ZXIoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnRyb2xzIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBnYW1lIGZlZWRiYWNrIHBhbmVsLlxyXG4gICAqIFRoaXMgdGVsbHMgdGhlIHVzZXIgd2hldGhlciB0aGVpciBndWVzcyBpcyBjb3JyZWN0IG9yIG5vdC5cclxuICAgKi9cclxuICBwcml2YXRlIHNldEZlZWRiYWNrUGFuZWxWaXNpYmxlKCB2aXNpYmxlOiBib29sZWFuICk6IHZvaWQge1xyXG4gICAgaWYgKCB0aGlzLmZlZWRiYWNrUGFuZWwgKSB7XHJcbiAgICAgIHRoaXMucmVtb3ZlQ2hpbGQoIHRoaXMuZmVlZGJhY2tQYW5lbCApO1xyXG4gICAgICB0aGlzLmZlZWRiYWNrUGFuZWwgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYgKCB2aXNpYmxlICkge1xyXG4gICAgICB0aGlzLmZlZWRiYWNrUGFuZWwgPSBuZXcgR2FtZUZlZWRiYWNrUGFuZWwoIHRoaXMubW9kZWwsIHRoaXMuYWxpZ25lciwge1xyXG4gICAgICAgIGNlbnRlclg6IHRoaXMubGF5b3V0Qm91bmRzLmNlbnRlclgsXHJcbiAgICAgICAgdG9wOiB0aGlzLmJveGVzTm9kZS50b3AgKyAxMFxyXG4gICAgICB9ICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuZmVlZGJhY2tQYW5lbCApOyAvLyB2aXNpYmxlIGFuZCBpbiBmcm9udFxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuYmFsYW5jaW5nQ2hlbWljYWxFcXVhdGlvbnMucmVnaXN0ZXIoICdHYW1lUGxheU5vZGUnLCBHYW1lUGxheU5vZGUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUdwRSxPQUFPQyxVQUFVLE1BQU0sa0NBQWtDO0FBQ3pELE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxTQUFTQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDOUQsT0FBT0MsY0FBYyxNQUFNLDhDQUE4QztBQUN6RSxPQUFPQyxlQUFlLE1BQU0seUNBQXlDO0FBRXJFLE9BQU9DLHlCQUF5QixNQUFNLG1EQUFtRDtBQUN6RixPQUFPQywwQkFBMEIsTUFBTSxxQ0FBcUM7QUFDNUUsT0FBT0MsaUNBQWlDLE1BQU0sNENBQTRDO0FBQzFGLE9BQU9DLFlBQVksTUFBTSw4QkFBOEI7QUFDdkQsT0FBT0MsU0FBUyxNQUFNLGdDQUFnQztBQUN0RCxPQUFPQyxZQUFZLE1BQU0sbUNBQW1DO0FBQzVELE9BQU9DLGlCQUFpQixNQUFNLHdDQUF3QztBQUV0RSxPQUFPQyxTQUFTLE1BQU0sdUJBQXVCO0FBQzdDLE9BQU9DLGlCQUFpQixNQUFNLHdCQUF3QjtBQUd0RDtBQUNBLE1BQU1DLFFBQVEsR0FBRyxJQUFJaEIsVUFBVSxDQUFFLEdBQUcsRUFBRSxHQUFJLENBQUM7QUFDM0MsTUFBTWlCLGFBQWEsR0FBRyxHQUFHLENBQUMsQ0FBQztBQUMzQixNQUFNQyxlQUFlLEdBQUcsSUFBSWhCLFFBQVEsQ0FBRSxFQUFHLENBQUM7QUFDMUMsTUFBTWlCLG9CQUFvQixHQUFHLE9BQU87QUFFcEMsZUFBZSxNQUFNQyxZQUFZLFNBQVNqQixJQUFJLENBQUM7RUFNSTtFQUNWOztFQUtoQ2tCLFdBQVdB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