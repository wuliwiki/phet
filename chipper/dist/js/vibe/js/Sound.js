// Copyright 2013-2021, University of Colorado Boulder

/**
 * Type for loading and playing sounds.
 * @author John Blanco (PhET Interactive Simulations)
 */

import Property from '../../axon/js/Property.js';
import { Display } from '../../scenery/js/imports.js';
import audioContextStateChangeMonitor from '../../tambo/js/audioContextStateChangeMonitor.js';
import phetAudioContext from '../../tambo/js/phetAudioContext.js';
import SoundClip from '../../tambo/js/sound-generators/SoundClip.js';
import vibe from './vibe.js';

// global property that allows all audio to be turned on/off, see #11
const audioEnabledProperty = new Property(true);

// create a gain node that will be shared by all sounds and can be used to set the output level for all sounds
const sharedGainNode = phetAudioContext.createGain();
sharedGainNode.connect(phetAudioContext.destination);
sharedGainNode.gain.setValueAtTime(phet.chipper.queryParameters.audio === 'enabled' ? 1 : 0, phetAudioContext.currentTime);
class Sound {
  /**
   * @param {WrappedAudioBuffer} soundDefinition - a wrapped audio buffer, generally obtained through loading a
   * sound module
   */
  constructor(soundDefinition) {
    // Note to maintainers: This was basically gutted and replaces with objects from the tambo library in May 2020 in
    // order to support a new way of modularizing sounds.  See https://github.com/phetsims/tambo/issues/100 and
    // https://github.com/phetsims/vibe/issues/33 for more information.
    this.soundClip = new SoundClip(soundDefinition);

    // connect the sound clip directly to the output gain node
    this.soundClip.masterGainNode.connect(sharedGainNode);
  }

  /**
   * play the sound if audio is enabled
   * @public
   */
  play() {
    if (audioEnabledProperty.get()) {
      this.soundClip.play();
    }
  }

  /**
   * stop play of the sound
   * @public
   */
  stop() {
    this.soundClip.stop();
  }
}

// statics
Sound.audioEnabledProperty = audioEnabledProperty;

// Handle the audio context state, both when changes occur and when it is initially suspended.  As of this writing (Feb
// 2019), there are some differences in how the audio context state behaves on different platforms, so the code monitors
// different events and states to keep the audio context running.  As the behavior of the audio context becomes more
// consistent across browsers, it may be possible to simplify this.
if (!phetAudioContext.isStubbed) {
  // function to remove the listeners, used to avoid code duplication
  const removeUserInteractionListeners = () => {
    window.removeEventListener('touchstart', resumeAudioContext, false);
    if (Display.userGestureEmitter.hasListener(resumeAudioContext)) {
      Display.userGestureEmitter.removeListener(resumeAudioContext);
    }
  };

  // listener that resumes the audio context
  const resumeAudioContext = () => {
    if (phetAudioContext.state !== 'running') {
      phet.log && phet.log(`audio context not running, attempting to resume, state = ${phetAudioContext.state}`);

      // tell the audio context to resume
      phetAudioContext.resume().then(() => {
        phet.log && phet.log(`resume appears to have succeeded, phetAudioContext.state = ${phetAudioContext.state}`);
        removeUserInteractionListeners();
      }).catch(err => {
        const errorMessage = `error when trying to resume audio context, err = ${err}`;
        console.error(errorMessage);
        assert && alert(errorMessage);
      });
    } else {
      // audio context is already running, no need to listen anymore
      removeUserInteractionListeners();
    }
  };

  // listen for a touchstart - this only works to resume the audio context on iOS devices (as of this writing)
  window.addEventListener('touchstart', resumeAudioContext, false);

  // listen for other user gesture events
  Display.userGestureEmitter.addListener(resumeAudioContext);

  // During testing, several use cases were found where the audio context state changes to something other than
  // the "running" state while the sim is in use (generally either "suspended" or "interrupted", depending on the
  // browser).  The following code is intended to handle this situation by trying to resume it right away.  GitHub
  // issues with details about why this is necessary are:
  // - https://github.com/phetsims/tambo/issues/58
  // - https://github.com/phetsims/tambo/issues/59
  // - https://github.com/phetsims/fractions-common/issues/82
  // - https://github.com/phetsims/friction/issues/173
  // - https://github.com/phetsims/resistance-in-a-wire/issues/190
  // - https://github.com/phetsims/tambo/issues/90
  let previousAudioContextState = phetAudioContext.state;
  audioContextStateChangeMonitor.addStateChangeListener(phetAudioContext, state => {
    phet.log && phet.log(`audio context state changed, old state = ${previousAudioContextState}, new state = ${state}, audio context time = ${phetAudioContext.currentTime}`);
    if (state !== 'running') {
      // add a listener that will resume the audio context on the next touchstart
      window.addEventListener('touchstart', resumeAudioContext, false);

      // listen for other user gesture events too
      Display.userGestureEmitter.addListener(resumeAudioContext);
    }
    previousAudioContextState = state;
  });
}
vibe.register('Sound', Sound);
export default Sound;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIkRpc3BsYXkiLCJhdWRpb0NvbnRleHRTdGF0ZUNoYW5nZU1vbml0b3IiLCJwaGV0QXVkaW9Db250ZXh0IiwiU291bmRDbGlwIiwidmliZSIsImF1ZGlvRW5hYmxlZFByb3BlcnR5Iiwic2hhcmVkR2Fpbk5vZGUiLCJjcmVhdGVHYWluIiwiY29ubmVjdCIsImRlc3RpbmF0aW9uIiwiZ2FpbiIsInNldFZhbHVlQXRUaW1lIiwicGhldCIsImNoaXBwZXIiLCJxdWVyeVBhcmFtZXRlcnMiLCJhdWRpbyIsImN1cnJlbnRUaW1lIiwiU291bmQiLCJjb25zdHJ1Y3RvciIsInNvdW5kRGVmaW5pdGlvbiIsInNvdW5kQ2xpcCIsIm1hc3RlckdhaW5Ob2RlIiwicGxheSIsImdldCIsInN0b3AiLCJpc1N0dWJiZWQiLCJyZW1vdmVVc2VySW50ZXJhY3Rpb25MaXN0ZW5lcnMiLCJ3aW5kb3ciLCJyZW1vdmVFdmVudExpc3RlbmVyIiwicmVzdW1lQXVkaW9Db250ZXh0IiwidXNlckdlc3R1cmVFbWl0dGVyIiwiaGFzTGlzdGVuZXIiLCJyZW1vdmVMaXN0ZW5lciIsInN0YXRlIiwibG9nIiwicmVzdW1lIiwidGhlbiIsImNhdGNoIiwiZXJyIiwiZXJyb3JNZXNzYWdlIiwiY29uc29sZSIsImVycm9yIiwiYXNzZXJ0IiwiYWxlcnQiLCJhZGRFdmVudExpc3RlbmVyIiwiYWRkTGlzdGVuZXIiLCJwcmV2aW91c0F1ZGlvQ29udGV4dFN0YXRlIiwiYWRkU3RhdGVDaGFuZ2VMaXN0ZW5lciIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiU291bmQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVHlwZSBmb3IgbG9hZGluZyBhbmQgcGxheWluZyBzb3VuZHMuXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgeyBEaXNwbGF5IH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGF1ZGlvQ29udGV4dFN0YXRlQ2hhbmdlTW9uaXRvciBmcm9tICcuLi8uLi90YW1iby9qcy9hdWRpb0NvbnRleHRTdGF0ZUNoYW5nZU1vbml0b3IuanMnO1xyXG5pbXBvcnQgcGhldEF1ZGlvQ29udGV4dCBmcm9tICcuLi8uLi90YW1iby9qcy9waGV0QXVkaW9Db250ZXh0LmpzJztcclxuaW1wb3J0IFNvdW5kQ2xpcCBmcm9tICcuLi8uLi90YW1iby9qcy9zb3VuZC1nZW5lcmF0b3JzL1NvdW5kQ2xpcC5qcyc7XHJcbmltcG9ydCB2aWJlIGZyb20gJy4vdmliZS5qcyc7XHJcblxyXG4vLyBnbG9iYWwgcHJvcGVydHkgdGhhdCBhbGxvd3MgYWxsIGF1ZGlvIHRvIGJlIHR1cm5lZCBvbi9vZmYsIHNlZSAjMTFcclxuY29uc3QgYXVkaW9FbmFibGVkUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIHRydWUgKTtcclxuXHJcbi8vIGNyZWF0ZSBhIGdhaW4gbm9kZSB0aGF0IHdpbGwgYmUgc2hhcmVkIGJ5IGFsbCBzb3VuZHMgYW5kIGNhbiBiZSB1c2VkIHRvIHNldCB0aGUgb3V0cHV0IGxldmVsIGZvciBhbGwgc291bmRzXHJcbmNvbnN0IHNoYXJlZEdhaW5Ob2RlID0gcGhldEF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7XHJcbnNoYXJlZEdhaW5Ob2RlLmNvbm5lY3QoIHBoZXRBdWRpb0NvbnRleHQuZGVzdGluYXRpb24gKTtcclxuXHJcbnNoYXJlZEdhaW5Ob2RlLmdhaW4uc2V0VmFsdWVBdFRpbWUoXHJcbiAgcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5hdWRpbyA9PT0gJ2VuYWJsZWQnID8gMSA6IDAsXHJcbiAgcGhldEF1ZGlvQ29udGV4dC5jdXJyZW50VGltZVxyXG4pO1xyXG5cclxuY2xhc3MgU291bmQge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1dyYXBwZWRBdWRpb0J1ZmZlcn0gc291bmREZWZpbml0aW9uIC0gYSB3cmFwcGVkIGF1ZGlvIGJ1ZmZlciwgZ2VuZXJhbGx5IG9idGFpbmVkIHRocm91Z2ggbG9hZGluZyBhXHJcbiAgICogc291bmQgbW9kdWxlXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIHNvdW5kRGVmaW5pdGlvbiApIHtcclxuXHJcbiAgICAvLyBOb3RlIHRvIG1haW50YWluZXJzOiBUaGlzIHdhcyBiYXNpY2FsbHkgZ3V0dGVkIGFuZCByZXBsYWNlcyB3aXRoIG9iamVjdHMgZnJvbSB0aGUgdGFtYm8gbGlicmFyeSBpbiBNYXkgMjAyMCBpblxyXG4gICAgLy8gb3JkZXIgdG8gc3VwcG9ydCBhIG5ldyB3YXkgb2YgbW9kdWxhcml6aW5nIHNvdW5kcy4gIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvdGFtYm8vaXNzdWVzLzEwMCBhbmRcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy92aWJlL2lzc3Vlcy8zMyBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cclxuICAgIHRoaXMuc291bmRDbGlwID0gbmV3IFNvdW5kQ2xpcCggc291bmREZWZpbml0aW9uICk7XHJcblxyXG4gICAgLy8gY29ubmVjdCB0aGUgc291bmQgY2xpcCBkaXJlY3RseSB0byB0aGUgb3V0cHV0IGdhaW4gbm9kZVxyXG4gICAgdGhpcy5zb3VuZENsaXAubWFzdGVyR2Fpbk5vZGUuY29ubmVjdCggc2hhcmVkR2Fpbk5vZGUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHBsYXkgdGhlIHNvdW5kIGlmIGF1ZGlvIGlzIGVuYWJsZWRcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcGxheSgpIHtcclxuICAgIGlmICggYXVkaW9FbmFibGVkUHJvcGVydHkuZ2V0KCkgKSB7XHJcbiAgICAgIHRoaXMuc291bmRDbGlwLnBsYXkoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHN0b3AgcGxheSBvZiB0aGUgc291bmRcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc3RvcCgpIHtcclxuICAgIHRoaXMuc291bmRDbGlwLnN0b3AoKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIHN0YXRpY3NcclxuU291bmQuYXVkaW9FbmFibGVkUHJvcGVydHkgPSBhdWRpb0VuYWJsZWRQcm9wZXJ0eTtcclxuXHJcbi8vIEhhbmRsZSB0aGUgYXVkaW8gY29udGV4dCBzdGF0ZSwgYm90aCB3aGVuIGNoYW5nZXMgb2NjdXIgYW5kIHdoZW4gaXQgaXMgaW5pdGlhbGx5IHN1c3BlbmRlZC4gIEFzIG9mIHRoaXMgd3JpdGluZyAoRmViXHJcbi8vIDIwMTkpLCB0aGVyZSBhcmUgc29tZSBkaWZmZXJlbmNlcyBpbiBob3cgdGhlIGF1ZGlvIGNvbnRleHQgc3RhdGUgYmVoYXZlcyBvbiBkaWZmZXJlbnQgcGxhdGZvcm1zLCBzbyB0aGUgY29kZSBtb25pdG9yc1xyXG4vLyBkaWZmZXJlbnQgZXZlbnRzIGFuZCBzdGF0ZXMgdG8ga2VlcCB0aGUgYXVkaW8gY29udGV4dCBydW5uaW5nLiAgQXMgdGhlIGJlaGF2aW9yIG9mIHRoZSBhdWRpbyBjb250ZXh0IGJlY29tZXMgbW9yZVxyXG4vLyBjb25zaXN0ZW50IGFjcm9zcyBicm93c2VycywgaXQgbWF5IGJlIHBvc3NpYmxlIHRvIHNpbXBsaWZ5IHRoaXMuXHJcbmlmICggIXBoZXRBdWRpb0NvbnRleHQuaXNTdHViYmVkICkge1xyXG5cclxuICAvLyBmdW5jdGlvbiB0byByZW1vdmUgdGhlIGxpc3RlbmVycywgdXNlZCB0byBhdm9pZCBjb2RlIGR1cGxpY2F0aW9uXHJcbiAgY29uc3QgcmVtb3ZlVXNlckludGVyYWN0aW9uTGlzdGVuZXJzID0gKCkgPT4ge1xyXG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoICd0b3VjaHN0YXJ0JywgcmVzdW1lQXVkaW9Db250ZXh0LCBmYWxzZSApO1xyXG4gICAgaWYgKCBEaXNwbGF5LnVzZXJHZXN0dXJlRW1pdHRlci5oYXNMaXN0ZW5lciggcmVzdW1lQXVkaW9Db250ZXh0ICkgKSB7XHJcbiAgICAgIERpc3BsYXkudXNlckdlc3R1cmVFbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCByZXN1bWVBdWRpb0NvbnRleHQgKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAvLyBsaXN0ZW5lciB0aGF0IHJlc3VtZXMgdGhlIGF1ZGlvIGNvbnRleHRcclxuICBjb25zdCByZXN1bWVBdWRpb0NvbnRleHQgPSAoKSA9PiB7XHJcblxyXG4gICAgaWYgKCBwaGV0QXVkaW9Db250ZXh0LnN0YXRlICE9PSAncnVubmluZycgKSB7XHJcblxyXG4gICAgICBwaGV0LmxvZyAmJiBwaGV0LmxvZyggYGF1ZGlvIGNvbnRleHQgbm90IHJ1bm5pbmcsIGF0dGVtcHRpbmcgdG8gcmVzdW1lLCBzdGF0ZSA9ICR7cGhldEF1ZGlvQ29udGV4dC5zdGF0ZX1gICk7XHJcblxyXG4gICAgICAvLyB0ZWxsIHRoZSBhdWRpbyBjb250ZXh0IHRvIHJlc3VtZVxyXG4gICAgICBwaGV0QXVkaW9Db250ZXh0LnJlc3VtZSgpXHJcbiAgICAgICAgLnRoZW4oICgpID0+IHtcclxuICAgICAgICAgIHBoZXQubG9nICYmIHBoZXQubG9nKCBgcmVzdW1lIGFwcGVhcnMgdG8gaGF2ZSBzdWNjZWVkZWQsIHBoZXRBdWRpb0NvbnRleHQuc3RhdGUgPSAke3BoZXRBdWRpb0NvbnRleHQuc3RhdGV9YCApO1xyXG4gICAgICAgICAgcmVtb3ZlVXNlckludGVyYWN0aW9uTGlzdGVuZXJzKCk7XHJcbiAgICAgICAgfSApXHJcbiAgICAgICAgLmNhdGNoKCBlcnIgPT4ge1xyXG4gICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYGVycm9yIHdoZW4gdHJ5aW5nIHRvIHJlc3VtZSBhdWRpbyBjb250ZXh0LCBlcnIgPSAke2Vycn1gO1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvciggZXJyb3JNZXNzYWdlICk7XHJcbiAgICAgICAgICBhc3NlcnQgJiYgYWxlcnQoIGVycm9yTWVzc2FnZSApO1xyXG4gICAgICAgIH0gKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG5cclxuICAgICAgLy8gYXVkaW8gY29udGV4dCBpcyBhbHJlYWR5IHJ1bm5pbmcsIG5vIG5lZWQgdG8gbGlzdGVuIGFueW1vcmVcclxuICAgICAgcmVtb3ZlVXNlckludGVyYWN0aW9uTGlzdGVuZXJzKCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgLy8gbGlzdGVuIGZvciBhIHRvdWNoc3RhcnQgLSB0aGlzIG9ubHkgd29ya3MgdG8gcmVzdW1lIHRoZSBhdWRpbyBjb250ZXh0IG9uIGlPUyBkZXZpY2VzIChhcyBvZiB0aGlzIHdyaXRpbmcpXHJcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICd0b3VjaHN0YXJ0JywgcmVzdW1lQXVkaW9Db250ZXh0LCBmYWxzZSApO1xyXG5cclxuICAvLyBsaXN0ZW4gZm9yIG90aGVyIHVzZXIgZ2VzdHVyZSBldmVudHNcclxuICBEaXNwbGF5LnVzZXJHZXN0dXJlRW1pdHRlci5hZGRMaXN0ZW5lciggcmVzdW1lQXVkaW9Db250ZXh0ICk7XHJcblxyXG4gIC8vIER1cmluZyB0ZXN0aW5nLCBzZXZlcmFsIHVzZSBjYXNlcyB3ZXJlIGZvdW5kIHdoZXJlIHRoZSBhdWRpbyBjb250ZXh0IHN0YXRlIGNoYW5nZXMgdG8gc29tZXRoaW5nIG90aGVyIHRoYW5cclxuICAvLyB0aGUgXCJydW5uaW5nXCIgc3RhdGUgd2hpbGUgdGhlIHNpbSBpcyBpbiB1c2UgKGdlbmVyYWxseSBlaXRoZXIgXCJzdXNwZW5kZWRcIiBvciBcImludGVycnVwdGVkXCIsIGRlcGVuZGluZyBvbiB0aGVcclxuICAvLyBicm93c2VyKS4gIFRoZSBmb2xsb3dpbmcgY29kZSBpcyBpbnRlbmRlZCB0byBoYW5kbGUgdGhpcyBzaXR1YXRpb24gYnkgdHJ5aW5nIHRvIHJlc3VtZSBpdCByaWdodCBhd2F5LiAgR2l0SHViXHJcbiAgLy8gaXNzdWVzIHdpdGggZGV0YWlscyBhYm91dCB3aHkgdGhpcyBpcyBuZWNlc3NhcnkgYXJlOlxyXG4gIC8vIC0gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3RhbWJvL2lzc3Vlcy81OFxyXG4gIC8vIC0gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3RhbWJvL2lzc3Vlcy81OVxyXG4gIC8vIC0gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2ZyYWN0aW9ucy1jb21tb24vaXNzdWVzLzgyXHJcbiAgLy8gLSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZnJpY3Rpb24vaXNzdWVzLzE3M1xyXG4gIC8vIC0gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3Jlc2lzdGFuY2UtaW4tYS13aXJlL2lzc3Vlcy8xOTBcclxuICAvLyAtIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy90YW1iby9pc3N1ZXMvOTBcclxuICBsZXQgcHJldmlvdXNBdWRpb0NvbnRleHRTdGF0ZSA9IHBoZXRBdWRpb0NvbnRleHQuc3RhdGU7XHJcbiAgYXVkaW9Db250ZXh0U3RhdGVDaGFuZ2VNb25pdG9yLmFkZFN0YXRlQ2hhbmdlTGlzdGVuZXIoIHBoZXRBdWRpb0NvbnRleHQsIHN0YXRlID0+IHtcclxuXHJcbiAgICBwaGV0LmxvZyAmJiBwaGV0LmxvZyhcclxuICAgICAgYGF1ZGlvIGNvbnRleHQgc3RhdGUgY2hhbmdlZCwgb2xkIHN0YXRlID0gJHtcclxuICAgICAgICBwcmV2aW91c0F1ZGlvQ29udGV4dFN0YXRlXHJcbiAgICAgIH0sIG5ldyBzdGF0ZSA9ICR7XHJcbiAgICAgICAgc3RhdGVcclxuICAgICAgfSwgYXVkaW8gY29udGV4dCB0aW1lID0gJHtcclxuICAgICAgICBwaGV0QXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lfWBcclxuICAgICk7XHJcblxyXG4gICAgaWYgKCBzdGF0ZSAhPT0gJ3J1bm5pbmcnICkge1xyXG5cclxuICAgICAgLy8gYWRkIGEgbGlzdGVuZXIgdGhhdCB3aWxsIHJlc3VtZSB0aGUgYXVkaW8gY29udGV4dCBvbiB0aGUgbmV4dCB0b3VjaHN0YXJ0XHJcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAndG91Y2hzdGFydCcsIHJlc3VtZUF1ZGlvQ29udGV4dCwgZmFsc2UgKTtcclxuXHJcbiAgICAgIC8vIGxpc3RlbiBmb3Igb3RoZXIgdXNlciBnZXN0dXJlIGV2ZW50cyB0b29cclxuICAgICAgRGlzcGxheS51c2VyR2VzdHVyZUVtaXR0ZXIuYWRkTGlzdGVuZXIoIHJlc3VtZUF1ZGlvQ29udGV4dCApO1xyXG4gICAgfVxyXG5cclxuICAgIHByZXZpb3VzQXVkaW9Db250ZXh0U3RhdGUgPSBzdGF0ZTtcclxuICB9ICk7XHJcbn1cclxuXHJcbnZpYmUucmVnaXN0ZXIoICdTb3VuZCcsIFNvdW5kICk7XHJcbmV4cG9ydCBkZWZhdWx0IFNvdW5kOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLDJCQUEyQjtBQUNoRCxTQUFTQyxPQUFPLFFBQVEsNkJBQTZCO0FBQ3JELE9BQU9DLDhCQUE4QixNQUFNLGtEQUFrRDtBQUM3RixPQUFPQyxnQkFBZ0IsTUFBTSxvQ0FBb0M7QUFDakUsT0FBT0MsU0FBUyxNQUFNLDhDQUE4QztBQUNwRSxPQUFPQyxJQUFJLE1BQU0sV0FBVzs7QUFFNUI7QUFDQSxNQUFNQyxvQkFBb0IsR0FBRyxJQUFJTixRQUFRLENBQUUsSUFBSyxDQUFDOztBQUVqRDtBQUNBLE1BQU1PLGNBQWMsR0FBR0osZ0JBQWdCLENBQUNLLFVBQVUsQ0FBQyxDQUFDO0FBQ3BERCxjQUFjLENBQUNFLE9BQU8sQ0FBRU4sZ0JBQWdCLENBQUNPLFdBQVksQ0FBQztBQUV0REgsY0FBYyxDQUFDSSxJQUFJLENBQUNDLGNBQWMsQ0FDaENDLElBQUksQ0FBQ0MsT0FBTyxDQUFDQyxlQUFlLENBQUNDLEtBQUssS0FBSyxTQUFTLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFDeERiLGdC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