// Copyright 2015-2022, University of Colorado Boulder

/**
 * A LightRay models one straight segment of a beam (completely within a single medium), with a specific wavelength.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Chandrashekar Bemagoni (Actual Concepts)
 */

import createObservableArray from '../../../../axon/js/createObservableArray.js';
import Ray2 from '../../../../dot/js/Ray2.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Line, Shape } from '../../../../kite/js/imports.js';
import bendingLight from '../../bendingLight.js';
import BendingLightConstants from '../BendingLightConstants.js';
import LaserViewEnum from './LaserViewEnum.js';
// constants
/**
 * If a vector is infinite, make it finite
 */
const makeFinite = vector => {
  if (!isFinite(vector.x)) {
    vector.x = 0;
  }
  if (!isFinite(vector.y)) {
    vector.y = 0;
  }
};
class LightRay {
  // Directionality is important for propagation

  // for internal use only. Clients should use toVector()
  unitVector = new Vector2(0, 0);
  vectorForm = new Vector2(0, 0);

  // wave particles
  particles = createObservableArray();

  // time used in wave sensor node
  time = 0;
  waveShape = null;
  clipRegionCorners = null;
  static RAY_WIDTH = 1.5992063492063494E-7;

  /**
   * @param trapeziumWidth - width of wave at intersection of mediums
   * @param tail - tail position of light ray
   * @param tip - tip position of light ray
   * @param indexOfRefraction - The index of refraction of the medium the light ray inhabits
   * @param wavelength - wavelength in meters
   * @param wavelengthInVacuum - wavelength in nm (in a vacuum, not in the current medium)
   * @param powerFraction - amount of power this light has (full strength is 1.0)
   * @param color - color of light ray
   * @param waveWidth - width of the wave
   * @param numWavelengthsPhaseOffset - indicates how many wavelengths have passed before this light ray begins
   * @param extend - indicates whether to extend it at tip of the wave
   * @param extendBackwards - indicates whether to extend backwards it at tail of the wave
   * @param laserView - specifies the laser view whether ray or wave mode
   * @param rayType - for the intro model, 'incident' | 'reflected' | 'transmitted' | 'prism'
   */
  constructor(trapeziumWidth, tail, tip, indexOfRefraction, wavelength, wavelengthInVacuum, powerFraction, color, waveWidth, numWavelengthsPhaseOffset, extend, extendBackwards, laserView, rayType) {
    // fill in the triangular chip near y=0 even for truncated beams, if it is the transmitted beam
    // Light must be extended backwards for the transmitted wave shape to be correct
    this.extendBackwards = extendBackwards;
    this.color = color;
    this.waveWidth = waveWidth;
    this.trapeziumWidth = trapeziumWidth;
    this.tip = tip;
    this.tail = tail;

    // The index of refraction of the medium the light ray inhabits
    this.indexOfRefraction = indexOfRefraction; // (read-only)
    this.wavelength = wavelength; // (read-only), wavelength in meters
    assert && assert(wavelengthInVacuum >= 300 && wavelengthInVacuum <= 900);
    this.wavelengthInVacuum = wavelengthInVacuum; // (read-only), wavelength in nm

    // Amount of power this light has (full strength is 1.0)
    this.powerFraction = powerFraction; // (read-only)

    // This number indicates how many wavelengths have passed before this light ray begins.
    // It is zero for the light coming out of the laser.
    this.numWavelengthsPhaseOffset = numWavelengthsPhaseOffset; // (read-only)

    // has to be an integral number of wavelength so that the phases work out correctly,
    // turing this up too high past 1E6 causes things not to render properly
    this.extend = extend; // (read-only)

    // (read-only) Keep track of the type of light ray for use in AngleNode
    this.rayType = rayType;
    if (laserView === LaserViewEnum.WAVE) {
      // The wave is wider than the ray, and must be clipped against the opposite medium so it doesn't leak over
      // angle of tail is Math.PI/2 for transmitted and reflected rays.
      const tipAngle = this.extend ? Math.PI / 2 : this.getAngle();
      const tailAngle = this.extendBackwards ? Math.PI / 2 : this.getAngle();
      const tipWidth = this.extend ? this.trapeziumWidth : this.waveWidth;
      const tailWidth = this.extendBackwards ? this.trapeziumWidth : this.waveWidth;

      // Calculating two end points of tip. They are at the angle of Math.PI/2 with respect to the ray angle
      const tipVectorX = tipWidth * Math.cos(tipAngle + Math.PI / 2) / 2;
      const tipVectorY = tipWidth * Math.sin(tipAngle + Math.PI / 2) / 2;

      // Calculating two end points of tail. They are at the angle of Math.PI/2 with respect to the ray angle
      const tailVectorX = tailWidth * Math.cos(tailAngle + Math.PI / 2) / 2;
      const tailVectorY = tailWidth * Math.sin(tailAngle + Math.PI / 2) / 2;
      const tipPoint1 = this.tip.minusXY(tipVectorX, tipVectorY);
      const tipPoint2 = this.tip.plusXY(tipVectorX, tipVectorY);
      const tailPoint1 = this.tail.minusXY(tailVectorX, tailVectorY);
      const tailPoint2 = this.tail.plusXY(tailVectorX, tailVectorY);

      // Getting correct order of points
      const tipPoint1XY = tipPoint2.x > tipPoint1.x ? tipPoint2 : tipPoint1;
      const tipPoint2XY = tipPoint2.x < tipPoint1.x ? tipPoint2 : tipPoint1;
      const tailPoint1XY = tailPoint1.x < tailPoint2.x ? tailPoint1 : tailPoint2;
      const tailPoint2XY = tailPoint1.x > tailPoint2.x ? tailPoint1 : tailPoint2;

      // This is to avoid drawing of wave backwards (near the intersection of mediums) when it intersects intensity
      // meter sensor shape
      if (tailPoint2XY.x - tipPoint1XY.x > 1E-10) {
        tipPoint1XY.y = tailPoint2XY.y;
        tailPoint2XY.x = this.toVector().magnitude / Math.cos(this.getAngle());
        tipPoint1XY.x = tailPoint2XY.x;
      }

      // Make sure we don't send NaN or +/- Infinity to Kite, see https://github.com/phetsims/bending-light/issues/329
      makeFinite(tailPoint1XY);
      makeFinite(tailPoint2XY);
      makeFinite(tipPoint1XY);
      makeFinite(tipPoint2XY);

      // (read-only)
      this.waveShape = new Shape().moveToPoint(tailPoint1XY).lineToPoint(tailPoint2XY).lineToPoint(tipPoint1XY).lineToPoint(tipPoint2XY).close();

      // (read-only), for drawing the clipping shape
      this.clipRegionCorners = [new Vector2(tailPoint1XY.x, tailPoint1XY.y), new Vector2(tailPoint2XY.x, tailPoint2XY.y), new Vector2(tipPoint1XY.x, tipPoint1XY.y), new Vector2(tipPoint2XY.x, tipPoint2XY.y)];
    }
  }

  /**
   * Update the time, so it can update the phase of the wave graphic
   * @param time - simulation time
   */
  setTime(time) {
    this.time = time;
  }

  /**
   * Determines the speed of the light ray
   */
  getSpeed() {
    return BendingLightConstants.SPEED_OF_LIGHT / this.indexOfRefraction;
  }
  createParallelRay(distance, rayType) {
    const perpendicular = Vector2.createPolar(distance, this.getAngle() + Math.PI / 2);
    const t = rayType === 'incident' ? this.tip : this.tail;
    const tail = t.plus(perpendicular);
    return new Ray2(tail, Vector2.createPolar(1, this.getAngle() + (rayType === 'incident' ? Math.PI : 0)));
  }

  /**
   * Check to see if this light ray hits the specified sensor region
   * @param sensorRegion - sensor region of intensity meter
   * @param rayType - 'incident', 'transmitted' or 'reflected'
   */
  getIntersections(sensorRegion, rayType) {
    if (this.waveShape) {
      // Create a ray that is parallel to the light ray and within the beam width that is closest to the center
      // of the sensor.  This is the most straightforward way to check for the closest intersection to the sensor
      // region.
      const p = sensorRegion.getBounds().center;
      const tip = this.tip;
      const tail = this.tail;

      // Compute the distance from the sensor to the ray, using
      // https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line
      const n = tip.minus(tail).normalized();
      const a = tail;
      const aMinusP = a.minus(p);
      let distanceToRay = aMinusP.minus(n.timesScalar(aMinusP.dot(n))).magnitude;
      const perpendicular = Vector2.createPolar(1, this.getAngle() + Math.PI / 2);
      const sign = perpendicular.dot(p.minus(a)) < 0 ? -1 : +1;
      distanceToRay = sign * Math.min(distanceToRay, this.waveWidth / 2);
      return sensorRegion.intersection(this.createParallelRay(distanceToRay, rayType));
    } else {
      const direction = Vector2.createPolar(1, this.getAngle() + (rayType === 'incident' ? Math.PI : 0));
      const ray = new Ray2(rayType === 'incident' ? this.tip : this.tail, direction);
      return sensorRegion.intersection(ray);
    }
  }
  toLine() {
    return new Line(this.tail, this.tip);
  }

  /**
   * Determines length of light ray
   */
  getLength() {
    return this.tip.distance(this.tail);
  }
  toVector() {
    this.vectorForm.x = this.tip.x - this.tail.x;
    this.vectorForm.y = this.tip.y - this.tail.y;
    return this.vectorForm;
  }

  /**
   * Determines the unit vector of light ray
   */
  getUnitVector() {
    const magnitude = this.tip.distance(this.tail);
    this.unitVector.x = (this.tip.x - this.tail.x) / magnitude;
    this.unitVector.y = (this.tip.y - this.tail.y) / magnitude;
    return this.unitVector;
  }

  /**
   * Determines the angle of light ray
   */
  getAngle() {
    return Math.atan2(this.tip.y - this.tail.y, this.tip.x - this.tail.x);
  }
  getNumberOfWavelengths() {
    return this.getLength() / this.wavelength;
  }

  /**
   * Determine if the light ray contains the specified position,
   * accounting for whether it is shown as a thin light ray or wide wave
   * @param position
   * @param waveMode - specifies whether ray or wave mode
   */
  contains(position, waveMode) {
    if (waveMode && this.waveShape) {
      return this.waveShape.containsPoint(position);
    } else {
      return this.toLine().explicitClosestToPoint(position)[0].distanceSquared < 1E-14;
    }
  }
  getVelocityVector() {
    return this.tip.minus(this.tail).normalize().multiplyScalar(this.getSpeed());
  }
  getFrequency() {
    return this.getSpeed() / this.wavelength;
  }
  getAngularFrequency() {
    return this.getFrequency() * Math.PI * 2;
  }
  getPhaseOffset() {
    return this.getAngularFrequency() * this.time - 2 * Math.PI * this.numWavelengthsPhaseOffset;
  }

  /**
   * Get the total argument to the cosine for the wave function(k * x - omega * t + phase)
   * @param distanceAlongRay - distance of a specific point from the start of the ray
   */
  getCosArg(distanceAlongRay) {
    const w = this.getAngularFrequency();
    const k = 2 * Math.PI / this.wavelength;
    const x = distanceAlongRay;
    const t = this.time;
    return k * x - w * t + 2 * Math.PI * this.numWavelengthsPhaseOffset;
  }
}
bendingLight.register('LightRay', LightRay);
export default LightRay;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVPYnNlcnZhYmxlQXJyYXkiLCJSYXkyIiwiVmVjdG9yMiIsIkxpbmUiLCJTaGFwZSIsImJlbmRpbmdMaWdodCIsIkJlbmRpbmdMaWdodENvbnN0YW50cyIsIkxhc2VyVmlld0VudW0iLCJtYWtlRmluaXRlIiwidmVjdG9yIiwiaXNGaW5pdGUiLCJ4IiwieSIsIkxpZ2h0UmF5IiwidW5pdFZlY3RvciIsInZlY3RvckZvcm0iLCJwYXJ0aWNsZXMiLCJ0aW1lIiwid2F2ZVNoYXBlIiwiY2xpcFJlZ2lvbkNvcm5lcnMiLCJSQVlfV0lEVEgiLCJjb25zdHJ1Y3RvciIsInRyYXBleml1bVdpZHRoIiwidGFpbCIsInRpcCIsImluZGV4T2ZSZWZyYWN0aW9uIiwid2F2ZWxlbmd0aCIsIndhdmVsZW5ndGhJblZhY3V1bSIsInBvd2VyRnJhY3Rpb24iLCJjb2xvciIsIndhdmVXaWR0aCIsIm51bVdhdmVsZW5ndGhzUGhhc2VPZmZzZXQiLCJleHRlbmQiLCJleHRlbmRCYWNrd2FyZHMiLCJsYXNlclZpZXciLCJyYXlUeXBlIiwiYXNzZXJ0IiwiV0FWRSIsInRpcEFuZ2xlIiwiTWF0aCIsIlBJIiwiZ2V0QW5nbGUiLCJ0YWlsQW5nbGUiLCJ0aXBXaWR0aCIsInRhaWxXaWR0aCIsInRpcFZlY3RvclgiLCJjb3MiLCJ0aXBWZWN0b3JZIiwic2luIiwidGFpbFZlY3RvclgiLCJ0YWlsVmVjdG9yWSIsInRpcFBvaW50MSIsIm1pbnVzWFkiLCJ0aXBQb2ludDIiLCJwbHVzWFkiLCJ0YWlsUG9pbnQxIiwidGFpbFBvaW50MiIsInRpcFBvaW50MVhZIiwidGlwUG9pbnQyWFkiLCJ0YWlsUG9pbnQxWFkiLCJ0YWlsUG9pbnQyWFkiLCJ0b1ZlY3RvciIsIm1hZ25pdHVkZSIsIm1vdmVUb1BvaW50IiwibGluZVRvUG9pbnQiLCJjbG9zZSIsInNldFRpbWUiLCJnZXRTcGVlZCIsIlNQRUVEX09GX0xJR0hUIiwiY3JlYXRlUGFyYWxsZWxSYXkiLCJkaXN0YW5jZSIsInBlcnBlbmRpY3VsYXIiLCJjcmVhdGVQb2xhciIsInQiLCJwbHVzIiwiZ2V0SW50ZXJzZWN0aW9ucyIsInNlbnNvclJlZ2lvbiIsInAiLCJnZXRCb3VuZHMiLCJjZW50ZXIiLCJuIiwibWludXMiLCJub3JtYWxpemVkIiwiYSIsImFNaW51c1AiLCJkaXN0YW5jZVRvUmF5IiwidGltZXNTY2FsYXIiLCJkb3QiLCJzaWduIiwibWluIiwiaW50ZXJzZWN0aW9uIiwiZGlyZWN0aW9uIiwicmF5IiwidG9MaW5lIiwiZ2V0TGVuZ3RoIiwiZ2V0VW5pdFZlY3RvciIsImF0YW4yIiwiZ2V0TnVtYmVyT2ZXYXZlbGVuZ3RocyIsImNvbnRhaW5zIiwicG9zaXRpb24iLCJ3YXZlTW9kZSIsImNvbnRhaW5zUG9pbnQiLCJleHBsaWNpdENsb3Nlc3RUb1BvaW50IiwiZGlzdGFuY2VTcXVhcmVkIiwiZ2V0VmVsb2NpdHlWZWN0b3IiLCJub3JtYWxpemUiLCJtdWx0aXBseVNjYWxhciIsImdldEZyZXF1ZW5jeSIsImdldEFuZ3VsYXJGcmVxdWVuY3kiLCJnZXRQaGFzZU9mZnNldCIsImdldENvc0FyZyIsImRpc3RhbmNlQWxvbmdSYXkiLCJ3IiwiayIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTGlnaHRSYXkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTUtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQSBMaWdodFJheSBtb2RlbHMgb25lIHN0cmFpZ2h0IHNlZ21lbnQgb2YgYSBiZWFtIChjb21wbGV0ZWx5IHdpdGhpbiBhIHNpbmdsZSBtZWRpdW0pLCB3aXRoIGEgc3BlY2lmaWMgd2F2ZWxlbmd0aC5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBDaGFuZHJhc2hla2FyIEJlbWFnb25pIChBY3R1YWwgQ29uY2VwdHMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IGNyZWF0ZU9ic2VydmFibGVBcnJheSwgeyBPYnNlcnZhYmxlQXJyYXkgfSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL2NyZWF0ZU9ic2VydmFibGVBcnJheS5qcyc7XHJcbmltcG9ydCBSYXkyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9SYXkyLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgeyBMaW5lLCBTaGFwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB7IENvbG9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGJlbmRpbmdMaWdodCBmcm9tICcuLi8uLi9iZW5kaW5nTGlnaHQuanMnO1xyXG5pbXBvcnQgQmVuZGluZ0xpZ2h0Q29uc3RhbnRzIGZyb20gJy4uL0JlbmRpbmdMaWdodENvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBXYXZlUGFydGljbGUgZnJvbSAnLi9XYXZlUGFydGljbGUuanMnO1xyXG5pbXBvcnQgTGFzZXJWaWV3RW51bSBmcm9tICcuL0xhc2VyVmlld0VudW0uanMnO1xyXG5pbXBvcnQgSW50ZXJzZWN0aW9uIGZyb20gJy4uLy4uL3ByaXNtcy9tb2RlbC9JbnRlcnNlY3Rpb24uanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcblxyXG4vKipcclxuICogSWYgYSB2ZWN0b3IgaXMgaW5maW5pdGUsIG1ha2UgaXQgZmluaXRlXHJcbiAqL1xyXG5jb25zdCBtYWtlRmluaXRlID0gKCB2ZWN0b3I6IFZlY3RvcjIgKSA9PiB7XHJcbiAgaWYgKCAhaXNGaW5pdGUoIHZlY3Rvci54ICkgKSB7XHJcbiAgICB2ZWN0b3IueCA9IDA7XHJcbiAgfVxyXG4gIGlmICggIWlzRmluaXRlKCB2ZWN0b3IueSApICkge1xyXG4gICAgdmVjdG9yLnkgPSAwO1xyXG4gIH1cclxufTtcclxuXHJcbmNsYXNzIExpZ2h0UmF5IHtcclxuICBwdWJsaWMgcmVhZG9ubHkgZXh0ZW5kQmFja3dhcmRzOiBib29sZWFuO1xyXG4gIHB1YmxpYyByZWFkb25seSBjb2xvcjogQ29sb3I7XHJcbiAgcHVibGljIHJlYWRvbmx5IHdhdmVXaWR0aDogbnVtYmVyO1xyXG4gIHB1YmxpYyByZWFkb25seSB0cmFwZXppdW1XaWR0aDogbnVtYmVyO1xyXG5cclxuICAvLyBEaXJlY3Rpb25hbGl0eSBpcyBpbXBvcnRhbnQgZm9yIHByb3BhZ2F0aW9uXHJcbiAgcHVibGljIHJlYWRvbmx5IHRpcDogVmVjdG9yMjtcclxuICBwdWJsaWMgcmVhZG9ubHkgdGFpbDogVmVjdG9yMjtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IGluZGV4T2ZSZWZyYWN0aW9uOiBudW1iZXI7XHJcbiAgcHVibGljIHJlYWRvbmx5IHdhdmVsZW5ndGg6IG51bWJlcjtcclxuICBwdWJsaWMgcmVhZG9ubHkgd2F2ZWxlbmd0aEluVmFjdXVtOiBudW1iZXI7XHJcbiAgcHVibGljIHJlYWRvbmx5IHBvd2VyRnJhY3Rpb246IG51bWJlcjtcclxuICBwdWJsaWMgcmVhZG9ubHkgbnVtV2F2ZWxlbmd0aHNQaGFzZU9mZnNldDogbnVtYmVyO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZXh0ZW5kOiBib29sZWFuO1xyXG5cclxuICAvLyBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuIENsaWVudHMgc2hvdWxkIHVzZSB0b1ZlY3RvcigpXHJcbiAgcHJpdmF0ZSByZWFkb25seSB1bml0VmVjdG9yOiBWZWN0b3IyID0gbmV3IFZlY3RvcjIoIDAsIDAgKTtcclxuICBwcml2YXRlIHJlYWRvbmx5IHZlY3RvckZvcm06IFZlY3RvcjIgPSBuZXcgVmVjdG9yMiggMCwgMCApO1xyXG5cclxuICAvLyB3YXZlIHBhcnRpY2xlc1xyXG4gIHB1YmxpYyByZWFkb25seSBwYXJ0aWNsZXM6IE9ic2VydmFibGVBcnJheTxXYXZlUGFydGljbGU+ID0gY3JlYXRlT2JzZXJ2YWJsZUFycmF5KCk7XHJcblxyXG4gIC8vIHRpbWUgdXNlZCBpbiB3YXZlIHNlbnNvciBub2RlXHJcbiAgcHVibGljIHRpbWUgPSAwO1xyXG4gIHB1YmxpYyByZWFkb25seSByYXlUeXBlOiBzdHJpbmc7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSB3YXZlU2hhcGU6IFNoYXBlIHwgbnVsbCA9IG51bGw7XHJcbiAgcHVibGljIHJlYWRvbmx5IGNsaXBSZWdpb25Db3JuZXJzOiBWZWN0b3IyW10gfCBudWxsID0gbnVsbDtcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IFJBWV9XSURUSCA9IDEuNTk5MjA2MzQ5MjA2MzQ5NEUtNztcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHRyYXBleml1bVdpZHRoIC0gd2lkdGggb2Ygd2F2ZSBhdCBpbnRlcnNlY3Rpb24gb2YgbWVkaXVtc1xyXG4gICAqIEBwYXJhbSB0YWlsIC0gdGFpbCBwb3NpdGlvbiBvZiBsaWdodCByYXlcclxuICAgKiBAcGFyYW0gdGlwIC0gdGlwIHBvc2l0aW9uIG9mIGxpZ2h0IHJheVxyXG4gICAqIEBwYXJhbSBpbmRleE9mUmVmcmFjdGlvbiAtIFRoZSBpbmRleCBvZiByZWZyYWN0aW9uIG9mIHRoZSBtZWRpdW0gdGhlIGxpZ2h0IHJheSBpbmhhYml0c1xyXG4gICAqIEBwYXJhbSB3YXZlbGVuZ3RoIC0gd2F2ZWxlbmd0aCBpbiBtZXRlcnNcclxuICAgKiBAcGFyYW0gd2F2ZWxlbmd0aEluVmFjdXVtIC0gd2F2ZWxlbmd0aCBpbiBubSAoaW4gYSB2YWN1dW0sIG5vdCBpbiB0aGUgY3VycmVudCBtZWRpdW0pXHJcbiAgICogQHBhcmFtIHBvd2VyRnJhY3Rpb24gLSBhbW91bnQgb2YgcG93ZXIgdGhpcyBsaWdodCBoYXMgKGZ1bGwgc3RyZW5ndGggaXMgMS4wKVxyXG4gICAqIEBwYXJhbSBjb2xvciAtIGNvbG9yIG9mIGxpZ2h0IHJheVxyXG4gICAqIEBwYXJhbSB3YXZlV2lkdGggLSB3aWR0aCBvZiB0aGUgd2F2ZVxyXG4gICAqIEBwYXJhbSBudW1XYXZlbGVuZ3Roc1BoYXNlT2Zmc2V0IC0gaW5kaWNhdGVzIGhvdyBtYW55IHdhdmVsZW5ndGhzIGhhdmUgcGFzc2VkIGJlZm9yZSB0aGlzIGxpZ2h0IHJheSBiZWdpbnNcclxuICAgKiBAcGFyYW0gZXh0ZW5kIC0gaW5kaWNhdGVzIHdoZXRoZXIgdG8gZXh0ZW5kIGl0IGF0IHRpcCBvZiB0aGUgd2F2ZVxyXG4gICAqIEBwYXJhbSBleHRlbmRCYWNrd2FyZHMgLSBpbmRpY2F0ZXMgd2hldGhlciB0byBleHRlbmQgYmFja3dhcmRzIGl0IGF0IHRhaWwgb2YgdGhlIHdhdmVcclxuICAgKiBAcGFyYW0gbGFzZXJWaWV3IC0gc3BlY2lmaWVzIHRoZSBsYXNlciB2aWV3IHdoZXRoZXIgcmF5IG9yIHdhdmUgbW9kZVxyXG4gICAqIEBwYXJhbSByYXlUeXBlIC0gZm9yIHRoZSBpbnRybyBtb2RlbCwgJ2luY2lkZW50JyB8ICdyZWZsZWN0ZWQnIHwgJ3RyYW5zbWl0dGVkJyB8ICdwcmlzbSdcclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHRyYXBleml1bVdpZHRoOiBudW1iZXIsIHRhaWw6IFZlY3RvcjIsIHRpcDogVmVjdG9yMiwgaW5kZXhPZlJlZnJhY3Rpb246IG51bWJlciwgd2F2ZWxlbmd0aDogbnVtYmVyLCB3YXZlbGVuZ3RoSW5WYWN1dW06IG51bWJlciwgcG93ZXJGcmFjdGlvbjogbnVtYmVyLCBjb2xvcjogQ29sb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgICB3YXZlV2lkdGg6IG51bWJlciwgbnVtV2F2ZWxlbmd0aHNQaGFzZU9mZnNldDogbnVtYmVyLCBleHRlbmQ6IGJvb2xlYW4sIGV4dGVuZEJhY2t3YXJkczogYm9vbGVhbiwgbGFzZXJWaWV3OiBMYXNlclZpZXdFbnVtLCByYXlUeXBlOiBzdHJpbmcgKSB7XHJcblxyXG4gICAgLy8gZmlsbCBpbiB0aGUgdHJpYW5ndWxhciBjaGlwIG5lYXIgeT0wIGV2ZW4gZm9yIHRydW5jYXRlZCBiZWFtcywgaWYgaXQgaXMgdGhlIHRyYW5zbWl0dGVkIGJlYW1cclxuICAgIC8vIExpZ2h0IG11c3QgYmUgZXh0ZW5kZWQgYmFja3dhcmRzIGZvciB0aGUgdHJhbnNtaXR0ZWQgd2F2ZSBzaGFwZSB0byBiZSBjb3JyZWN0XHJcbiAgICB0aGlzLmV4dGVuZEJhY2t3YXJkcyA9IGV4dGVuZEJhY2t3YXJkcztcclxuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcclxuICAgIHRoaXMud2F2ZVdpZHRoID0gd2F2ZVdpZHRoO1xyXG4gICAgdGhpcy50cmFwZXppdW1XaWR0aCA9IHRyYXBleml1bVdpZHRoO1xyXG4gICAgdGhpcy50aXAgPSB0aXA7XHJcbiAgICB0aGlzLnRhaWwgPSB0YWlsO1xyXG5cclxuICAgIC8vIFRoZSBpbmRleCBvZiByZWZyYWN0aW9uIG9mIHRoZSBtZWRpdW0gdGhlIGxpZ2h0IHJheSBpbmhhYml0c1xyXG4gICAgdGhpcy5pbmRleE9mUmVmcmFjdGlvbiA9IGluZGV4T2ZSZWZyYWN0aW9uOyAvLyAocmVhZC1vbmx5KVxyXG4gICAgdGhpcy53YXZlbGVuZ3RoID0gd2F2ZWxlbmd0aDsgLy8gKHJlYWQtb25seSksIHdhdmVsZW5ndGggaW4gbWV0ZXJzXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB3YXZlbGVuZ3RoSW5WYWN1dW0gPj0gMzAwICYmIHdhdmVsZW5ndGhJblZhY3V1bSA8PSA5MDAgKTtcclxuICAgIHRoaXMud2F2ZWxlbmd0aEluVmFjdXVtID0gd2F2ZWxlbmd0aEluVmFjdXVtOyAvLyAocmVhZC1vbmx5KSwgd2F2ZWxlbmd0aCBpbiBubVxyXG5cclxuICAgIC8vIEFtb3VudCBvZiBwb3dlciB0aGlzIGxpZ2h0IGhhcyAoZnVsbCBzdHJlbmd0aCBpcyAxLjApXHJcbiAgICB0aGlzLnBvd2VyRnJhY3Rpb24gPSBwb3dlckZyYWN0aW9uOyAvLyAocmVhZC1vbmx5KVxyXG5cclxuICAgIC8vIFRoaXMgbnVtYmVyIGluZGljYXRlcyBob3cgbWFueSB3YXZlbGVuZ3RocyBoYXZlIHBhc3NlZCBiZWZvcmUgdGhpcyBsaWdodCByYXkgYmVnaW5zLlxyXG4gICAgLy8gSXQgaXMgemVybyBmb3IgdGhlIGxpZ2h0IGNvbWluZyBvdXQgb2YgdGhlIGxhc2VyLlxyXG4gICAgdGhpcy5udW1XYXZlbGVuZ3Roc1BoYXNlT2Zmc2V0ID0gbnVtV2F2ZWxlbmd0aHNQaGFzZU9mZnNldDsgLy8gKHJlYWQtb25seSlcclxuXHJcbiAgICAvLyBoYXMgdG8gYmUgYW4gaW50ZWdyYWwgbnVtYmVyIG9mIHdhdmVsZW5ndGggc28gdGhhdCB0aGUgcGhhc2VzIHdvcmsgb3V0IGNvcnJlY3RseSxcclxuICAgIC8vIHR1cmluZyB0aGlzIHVwIHRvbyBoaWdoIHBhc3QgMUU2IGNhdXNlcyB0aGluZ3Mgbm90IHRvIHJlbmRlciBwcm9wZXJseVxyXG4gICAgdGhpcy5leHRlbmQgPSBleHRlbmQ7IC8vIChyZWFkLW9ubHkpXHJcblxyXG4gICAgLy8gKHJlYWQtb25seSkgS2VlcCB0cmFjayBvZiB0aGUgdHlwZSBvZiBsaWdodCByYXkgZm9yIHVzZSBpbiBBbmdsZU5vZGVcclxuICAgIHRoaXMucmF5VHlwZSA9IHJheVR5cGU7XHJcblxyXG4gICAgaWYgKCBsYXNlclZpZXcgPT09IExhc2VyVmlld0VudW0uV0FWRSApIHtcclxuXHJcbiAgICAgIC8vIFRoZSB3YXZlIGlzIHdpZGVyIHRoYW4gdGhlIHJheSwgYW5kIG11c3QgYmUgY2xpcHBlZCBhZ2FpbnN0IHRoZSBvcHBvc2l0ZSBtZWRpdW0gc28gaXQgZG9lc24ndCBsZWFrIG92ZXJcclxuICAgICAgLy8gYW5nbGUgb2YgdGFpbCBpcyBNYXRoLlBJLzIgZm9yIHRyYW5zbWl0dGVkIGFuZCByZWZsZWN0ZWQgcmF5cy5cclxuICAgICAgY29uc3QgdGlwQW5nbGUgPSB0aGlzLmV4dGVuZCA/IE1hdGguUEkgLyAyIDogdGhpcy5nZXRBbmdsZSgpO1xyXG4gICAgICBjb25zdCB0YWlsQW5nbGUgPSB0aGlzLmV4dGVuZEJhY2t3YXJkcyA/IE1hdGguUEkgLyAyIDogdGhpcy5nZXRBbmdsZSgpO1xyXG4gICAgICBjb25zdCB0aXBXaWR0aCA9IHRoaXMuZXh0ZW5kID8gdGhpcy50cmFwZXppdW1XaWR0aCA6IHRoaXMud2F2ZVdpZHRoO1xyXG4gICAgICBjb25zdCB0YWlsV2lkdGggPSB0aGlzLmV4dGVuZEJhY2t3YXJkcyA/IHRoaXMudHJhcGV6aXVtV2lkdGggOiB0aGlzLndhdmVXaWR0aDtcclxuXHJcbiAgICAgIC8vIENhbGN1bGF0aW5nIHR3byBlbmQgcG9pbnRzIG9mIHRpcC4gVGhleSBhcmUgYXQgdGhlIGFuZ2xlIG9mIE1hdGguUEkvMiB3aXRoIHJlc3BlY3QgdG8gdGhlIHJheSBhbmdsZVxyXG4gICAgICBjb25zdCB0aXBWZWN0b3JYID0gdGlwV2lkdGggKiBNYXRoLmNvcyggdGlwQW5nbGUgKyBNYXRoLlBJIC8gMiApIC8gMjtcclxuICAgICAgY29uc3QgdGlwVmVjdG9yWSA9IHRpcFdpZHRoICogTWF0aC5zaW4oIHRpcEFuZ2xlICsgTWF0aC5QSSAvIDIgKSAvIDI7XHJcblxyXG4gICAgICAvLyBDYWxjdWxhdGluZyB0d28gZW5kIHBvaW50cyBvZiB0YWlsLiBUaGV5IGFyZSBhdCB0aGUgYW5nbGUgb2YgTWF0aC5QSS8yIHdpdGggcmVzcGVjdCB0byB0aGUgcmF5IGFuZ2xlXHJcbiAgICAgIGNvbnN0IHRhaWxWZWN0b3JYID0gdGFpbFdpZHRoICogTWF0aC5jb3MoIHRhaWxBbmdsZSArIE1hdGguUEkgLyAyICkgLyAyO1xyXG4gICAgICBjb25zdCB0YWlsVmVjdG9yWSA9IHRhaWxXaWR0aCAqIE1hdGguc2luKCB0YWlsQW5nbGUgKyBNYXRoLlBJIC8gMiApIC8gMjtcclxuXHJcbiAgICAgIGNvbnN0IHRpcFBvaW50MSA9IHRoaXMudGlwLm1pbnVzWFkoIHRpcFZlY3RvclgsIHRpcFZlY3RvclkgKTtcclxuICAgICAgY29uc3QgdGlwUG9pbnQyID0gdGhpcy50aXAucGx1c1hZKCB0aXBWZWN0b3JYLCB0aXBWZWN0b3JZICk7XHJcbiAgICAgIGNvbnN0IHRhaWxQb2ludDEgPSB0aGlzLnRhaWwubWludXNYWSggdGFpbFZlY3RvclgsIHRhaWxWZWN0b3JZICk7XHJcbiAgICAgIGNvbnN0IHRhaWxQb2ludDIgPSB0aGlzLnRhaWwucGx1c1hZKCB0YWlsVmVjdG9yWCwgdGFpbFZlY3RvclkgKTtcclxuXHJcbiAgICAgIC8vIEdldHRpbmcgY29ycmVjdCBvcmRlciBvZiBwb2ludHNcclxuICAgICAgY29uc3QgdGlwUG9pbnQxWFkgPSB0aXBQb2ludDIueCA+IHRpcFBvaW50MS54ID8gdGlwUG9pbnQyIDogdGlwUG9pbnQxO1xyXG4gICAgICBjb25zdCB0aXBQb2ludDJYWSA9IHRpcFBvaW50Mi54IDwgdGlwUG9pbnQxLnggPyB0aXBQb2ludDIgOiB0aXBQb2ludDE7XHJcblxyXG4gICAgICBjb25zdCB0YWlsUG9pbnQxWFkgPSB0YWlsUG9pbnQxLnggPCB0YWlsUG9pbnQyLnggPyB0YWlsUG9pbnQxIDogdGFpbFBvaW50MjtcclxuICAgICAgY29uc3QgdGFpbFBvaW50MlhZID0gdGFpbFBvaW50MS54ID4gdGFpbFBvaW50Mi54ID8gdGFpbFBvaW50MSA6IHRhaWxQb2ludDI7XHJcblxyXG4gICAgICAvLyBUaGlzIGlzIHRvIGF2b2lkIGRyYXdpbmcgb2Ygd2F2ZSBiYWNrd2FyZHMgKG5lYXIgdGhlIGludGVyc2VjdGlvbiBvZiBtZWRpdW1zKSB3aGVuIGl0IGludGVyc2VjdHMgaW50ZW5zaXR5XHJcbiAgICAgIC8vIG1ldGVyIHNlbnNvciBzaGFwZVxyXG4gICAgICBpZiAoICggdGFpbFBvaW50MlhZLnggLSB0aXBQb2ludDFYWS54ICkgPiAxRS0xMCApIHtcclxuICAgICAgICB0aXBQb2ludDFYWS55ID0gdGFpbFBvaW50MlhZLnk7XHJcbiAgICAgICAgdGFpbFBvaW50MlhZLnggPSB0aGlzLnRvVmVjdG9yKCkubWFnbml0dWRlIC8gTWF0aC5jb3MoIHRoaXMuZ2V0QW5nbGUoKSApO1xyXG4gICAgICAgIHRpcFBvaW50MVhZLnggPSB0YWlsUG9pbnQyWFkueDtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gTWFrZSBzdXJlIHdlIGRvbid0IHNlbmQgTmFOIG9yICsvLSBJbmZpbml0eSB0byBLaXRlLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2JlbmRpbmctbGlnaHQvaXNzdWVzLzMyOVxyXG4gICAgICBtYWtlRmluaXRlKCB0YWlsUG9pbnQxWFkgKTtcclxuICAgICAgbWFrZUZpbml0ZSggdGFpbFBvaW50MlhZICk7XHJcbiAgICAgIG1ha2VGaW5pdGUoIHRpcFBvaW50MVhZICk7XHJcbiAgICAgIG1ha2VGaW5pdGUoIHRpcFBvaW50MlhZICk7XHJcblxyXG4gICAgICAvLyAocmVhZC1vbmx5KVxyXG4gICAgICB0aGlzLndhdmVTaGFwZSA9IG5ldyBTaGFwZSgpXHJcbiAgICAgICAgLm1vdmVUb1BvaW50KCB0YWlsUG9pbnQxWFkgKVxyXG4gICAgICAgIC5saW5lVG9Qb2ludCggdGFpbFBvaW50MlhZIClcclxuICAgICAgICAubGluZVRvUG9pbnQoIHRpcFBvaW50MVhZIClcclxuICAgICAgICAubGluZVRvUG9pbnQoIHRpcFBvaW50MlhZIClcclxuICAgICAgICAuY2xvc2UoKTtcclxuXHJcbiAgICAgIC8vIChyZWFkLW9ubHkpLCBmb3IgZHJhd2luZyB0aGUgY2xpcHBpbmcgc2hhcGVcclxuICAgICAgdGhpcy5jbGlwUmVnaW9uQ29ybmVycyA9IFtcclxuICAgICAgICBuZXcgVmVjdG9yMiggdGFpbFBvaW50MVhZLngsIHRhaWxQb2ludDFYWS55ICksXHJcbiAgICAgICAgbmV3IFZlY3RvcjIoIHRhaWxQb2ludDJYWS54LCB0YWlsUG9pbnQyWFkueSApLFxyXG4gICAgICAgIG5ldyBWZWN0b3IyKCB0aXBQb2ludDFYWS54LCB0aXBQb2ludDFYWS55ICksXHJcbiAgICAgICAgbmV3IFZlY3RvcjIoIHRpcFBvaW50MlhZLngsIHRpcFBvaW50MlhZLnkgKVxyXG4gICAgICBdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIHRoZSB0aW1lLCBzbyBpdCBjYW4gdXBkYXRlIHRoZSBwaGFzZSBvZiB0aGUgd2F2ZSBncmFwaGljXHJcbiAgICogQHBhcmFtIHRpbWUgLSBzaW11bGF0aW9uIHRpbWVcclxuICAgKi9cclxuICBwdWJsaWMgc2V0VGltZSggdGltZTogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgdGhpcy50aW1lID0gdGltZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERldGVybWluZXMgdGhlIHNwZWVkIG9mIHRoZSBsaWdodCByYXlcclxuICAgKi9cclxuICBwcml2YXRlIGdldFNwZWVkKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gQmVuZGluZ0xpZ2h0Q29uc3RhbnRzLlNQRUVEX09GX0xJR0hUIC8gdGhpcy5pbmRleE9mUmVmcmFjdGlvbjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlUGFyYWxsZWxSYXkoIGRpc3RhbmNlOiBudW1iZXIsIHJheVR5cGU6IHN0cmluZyApOiBSYXkyIHtcclxuICAgIGNvbnN0IHBlcnBlbmRpY3VsYXIgPSBWZWN0b3IyLmNyZWF0ZVBvbGFyKCBkaXN0YW5jZSwgdGhpcy5nZXRBbmdsZSgpICsgTWF0aC5QSSAvIDIgKTtcclxuICAgIGNvbnN0IHQgPSByYXlUeXBlID09PSAnaW5jaWRlbnQnID8gdGhpcy50aXAgOiB0aGlzLnRhaWw7XHJcbiAgICBjb25zdCB0YWlsID0gdC5wbHVzKCBwZXJwZW5kaWN1bGFyICk7XHJcbiAgICByZXR1cm4gbmV3IFJheTIoIHRhaWwsIFZlY3RvcjIuY3JlYXRlUG9sYXIoIDEsIHRoaXMuZ2V0QW5nbGUoKSArICggcmF5VHlwZSA9PT0gJ2luY2lkZW50JyA/IE1hdGguUEkgOiAwICkgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgdG8gc2VlIGlmIHRoaXMgbGlnaHQgcmF5IGhpdHMgdGhlIHNwZWNpZmllZCBzZW5zb3IgcmVnaW9uXHJcbiAgICogQHBhcmFtIHNlbnNvclJlZ2lvbiAtIHNlbnNvciByZWdpb24gb2YgaW50ZW5zaXR5IG1ldGVyXHJcbiAgICogQHBhcmFtIHJheVR5cGUgLSAnaW5jaWRlbnQnLCAndHJhbnNtaXR0ZWQnIG9yICdyZWZsZWN0ZWQnXHJcbiAgICovXHJcbiAgcHVibGljIGdldEludGVyc2VjdGlvbnMoIHNlbnNvclJlZ2lvbjogU2hhcGUsIHJheVR5cGU6IHN0cmluZyApOiBJbnRlcnNlY3Rpb25bXSB7XHJcblxyXG4gICAgaWYgKCB0aGlzLndhdmVTaGFwZSApIHtcclxuXHJcbiAgICAgIC8vIENyZWF0ZSBhIHJheSB0aGF0IGlzIHBhcmFsbGVsIHRvIHRoZSBsaWdodCByYXkgYW5kIHdpdGhpbiB0aGUgYmVhbSB3aWR0aCB0aGF0IGlzIGNsb3Nlc3QgdG8gdGhlIGNlbnRlclxyXG4gICAgICAvLyBvZiB0aGUgc2Vuc29yLiAgVGhpcyBpcyB0aGUgbW9zdCBzdHJhaWdodGZvcndhcmQgd2F5IHRvIGNoZWNrIGZvciB0aGUgY2xvc2VzdCBpbnRlcnNlY3Rpb24gdG8gdGhlIHNlbnNvclxyXG4gICAgICAvLyByZWdpb24uXHJcbiAgICAgIGNvbnN0IHAgPSBzZW5zb3JSZWdpb24uZ2V0Qm91bmRzKCkuY2VudGVyO1xyXG5cclxuICAgICAgY29uc3QgdGlwID0gdGhpcy50aXA7XHJcbiAgICAgIGNvbnN0IHRhaWwgPSB0aGlzLnRhaWw7XHJcblxyXG4gICAgICAvLyBDb21wdXRlIHRoZSBkaXN0YW5jZSBmcm9tIHRoZSBzZW5zb3IgdG8gdGhlIHJheSwgdXNpbmdcclxuICAgICAgLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRGlzdGFuY2VfZnJvbV9hX3BvaW50X3RvX2FfbGluZVxyXG4gICAgICBjb25zdCBuID0gdGlwLm1pbnVzKCB0YWlsICkubm9ybWFsaXplZCgpO1xyXG4gICAgICBjb25zdCBhID0gdGFpbDtcclxuICAgICAgY29uc3QgYU1pbnVzUCA9IGEubWludXMoIHAgKTtcclxuICAgICAgbGV0IGRpc3RhbmNlVG9SYXkgPSBhTWludXNQLm1pbnVzKCBuLnRpbWVzU2NhbGFyKCBhTWludXNQLmRvdCggbiApICkgKS5tYWduaXR1ZGU7XHJcblxyXG4gICAgICBjb25zdCBwZXJwZW5kaWN1bGFyID0gVmVjdG9yMi5jcmVhdGVQb2xhciggMSwgdGhpcy5nZXRBbmdsZSgpICsgTWF0aC5QSSAvIDIgKTtcclxuICAgICAgY29uc3Qgc2lnbiA9IHBlcnBlbmRpY3VsYXIuZG90KCBwLm1pbnVzKCBhICkgKSA8IDAgPyAtMSA6ICsxO1xyXG4gICAgICBkaXN0YW5jZVRvUmF5ID0gc2lnbiAqIE1hdGgubWluKCBkaXN0YW5jZVRvUmF5LCB0aGlzLndhdmVXaWR0aCAvIDIgKTtcclxuICAgICAgcmV0dXJuIHNlbnNvclJlZ2lvbi5pbnRlcnNlY3Rpb24oIHRoaXMuY3JlYXRlUGFyYWxsZWxSYXkoIGRpc3RhbmNlVG9SYXksIHJheVR5cGUgKSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IFZlY3RvcjIuY3JlYXRlUG9sYXIoIDEsIHRoaXMuZ2V0QW5nbGUoKSArICggcmF5VHlwZSA9PT0gJ2luY2lkZW50JyA/IE1hdGguUEkgOiAwICkgKTtcclxuICAgICAgY29uc3QgcmF5ID0gbmV3IFJheTIoIHJheVR5cGUgPT09ICdpbmNpZGVudCcgPyB0aGlzLnRpcCA6IHRoaXMudGFpbCwgZGlyZWN0aW9uICk7XHJcbiAgICAgIHJldHVybiBzZW5zb3JSZWdpb24uaW50ZXJzZWN0aW9uKCByYXkgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgdG9MaW5lKCk6IExpbmUge1xyXG4gICAgcmV0dXJuIG5ldyBMaW5lKCB0aGlzLnRhaWwsIHRoaXMudGlwICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZXRlcm1pbmVzIGxlbmd0aCBvZiBsaWdodCByYXlcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TGVuZ3RoKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy50aXAuZGlzdGFuY2UoIHRoaXMudGFpbCApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHRvVmVjdG9yKCk6IFZlY3RvcjIge1xyXG4gICAgdGhpcy52ZWN0b3JGb3JtLnggPSB0aGlzLnRpcC54IC0gdGhpcy50YWlsLng7XHJcbiAgICB0aGlzLnZlY3RvckZvcm0ueSA9IHRoaXMudGlwLnkgLSB0aGlzLnRhaWwueTtcclxuICAgIHJldHVybiB0aGlzLnZlY3RvckZvcm07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZXRlcm1pbmVzIHRoZSB1bml0IHZlY3RvciBvZiBsaWdodCByYXlcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0VW5pdFZlY3RvcigpOiBWZWN0b3IyIHtcclxuICAgIGNvbnN0IG1hZ25pdHVkZSA9IHRoaXMudGlwLmRpc3RhbmNlKCB0aGlzLnRhaWwgKTtcclxuICAgIHRoaXMudW5pdFZlY3Rvci54ID0gKCB0aGlzLnRpcC54IC0gdGhpcy50YWlsLnggKSAvIG1hZ25pdHVkZTtcclxuICAgIHRoaXMudW5pdFZlY3Rvci55ID0gKCB0aGlzLnRpcC55IC0gdGhpcy50YWlsLnkgKSAvIG1hZ25pdHVkZTtcclxuICAgIHJldHVybiB0aGlzLnVuaXRWZWN0b3I7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZXRlcm1pbmVzIHRoZSBhbmdsZSBvZiBsaWdodCByYXlcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0QW5nbGUoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiBNYXRoLmF0YW4yKCB0aGlzLnRpcC55IC0gdGhpcy50YWlsLnksIHRoaXMudGlwLnggLSB0aGlzLnRhaWwueCApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldE51bWJlck9mV2F2ZWxlbmd0aHMoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmdldExlbmd0aCgpIC8gdGhpcy53YXZlbGVuZ3RoO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGV0ZXJtaW5lIGlmIHRoZSBsaWdodCByYXkgY29udGFpbnMgdGhlIHNwZWNpZmllZCBwb3NpdGlvbixcclxuICAgKiBhY2NvdW50aW5nIGZvciB3aGV0aGVyIGl0IGlzIHNob3duIGFzIGEgdGhpbiBsaWdodCByYXkgb3Igd2lkZSB3YXZlXHJcbiAgICogQHBhcmFtIHBvc2l0aW9uXHJcbiAgICogQHBhcmFtIHdhdmVNb2RlIC0gc3BlY2lmaWVzIHdoZXRoZXIgcmF5IG9yIHdhdmUgbW9kZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb250YWlucyggcG9zaXRpb246IFZlY3RvcjIsIHdhdmVNb2RlOiBib29sZWFuICk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCB3YXZlTW9kZSAmJiB0aGlzLndhdmVTaGFwZSApIHtcclxuICAgICAgcmV0dXJuIHRoaXMud2F2ZVNoYXBlLmNvbnRhaW5zUG9pbnQoIHBvc2l0aW9uICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMudG9MaW5lKCkuZXhwbGljaXRDbG9zZXN0VG9Qb2ludCggcG9zaXRpb24gKVsgMCBdLmRpc3RhbmNlU3F1YXJlZCA8IDFFLTE0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFZlbG9jaXR5VmVjdG9yKCk6IFZlY3RvcjIge1xyXG4gICAgcmV0dXJuIHRoaXMudGlwLm1pbnVzKCB0aGlzLnRhaWwgKS5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhciggdGhpcy5nZXRTcGVlZCgpICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEZyZXF1ZW5jeSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0U3BlZWQoKSAvIHRoaXMud2F2ZWxlbmd0aDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0QW5ndWxhckZyZXF1ZW5jeSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0RnJlcXVlbmN5KCkgKiBNYXRoLlBJICogMjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRQaGFzZU9mZnNldCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0QW5ndWxhckZyZXF1ZW5jeSgpICogdGhpcy50aW1lIC0gMiAqIE1hdGguUEkgKiB0aGlzLm51bVdhdmVsZW5ndGhzUGhhc2VPZmZzZXQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIHRvdGFsIGFyZ3VtZW50IHRvIHRoZSBjb3NpbmUgZm9yIHRoZSB3YXZlIGZ1bmN0aW9uKGsgKiB4IC0gb21lZ2EgKiB0ICsgcGhhc2UpXHJcbiAgICogQHBhcmFtIGRpc3RhbmNlQWxvbmdSYXkgLSBkaXN0YW5jZSBvZiBhIHNwZWNpZmljIHBvaW50IGZyb20gdGhlIHN0YXJ0IG9mIHRoZSByYXlcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Q29zQXJnKCBkaXN0YW5jZUFsb25nUmF5OiBudW1iZXIgKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IHcgPSB0aGlzLmdldEFuZ3VsYXJGcmVxdWVuY3koKTtcclxuICAgIGNvbnN0IGsgPSAyICogTWF0aC5QSSAvIHRoaXMud2F2ZWxlbmd0aDtcclxuICAgIGNvbnN0IHggPSBkaXN0YW5jZUFsb25nUmF5O1xyXG4gICAgY29uc3QgdCA9IHRoaXMudGltZTtcclxuICAgIHJldHVybiBrICogeCAtIHcgKiB0ICsgMiAqIE1hdGguUEkgKiB0aGlzLm51bVdhdmVsZW5ndGhzUGhhc2VPZmZzZXQ7XHJcbiAgfVxyXG59XHJcblxyXG5iZW5kaW5nTGlnaHQucmVnaXN0ZXIoICdMaWdodFJheScsIExpZ2h0UmF5ICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBMaWdodFJheTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxxQkFBcUIsTUFBMkIsOENBQThDO0FBQ3JHLE9BQU9DLElBQUksTUFBTSw0QkFBNEI7QUFDN0MsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxTQUFTQyxJQUFJLEVBQUVDLEtBQUssUUFBUSxnQ0FBZ0M7QUFFNUQsT0FBT0MsWUFBWSxNQUFNLHVCQUF1QjtBQUNoRCxPQUFPQyxxQkFBcUIsTUFBTSw2QkFBNkI7QUFFL0QsT0FBT0MsYUFBYSxNQUFN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