// Copyright 2015-2023, University of Colorado Boulder

/**
 * Main model for bending light application. Rays are recomputed whenever laser parameters changed. Each ray oscillates
 * in time, as shown in the wave view. There are model representations for several tools as well as their visibility.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Chandrashekar Bemagoni (Actual Concepts)
 */

import createObservableArray from '../../../../axon/js/createObservableArray.js';
import Property from '../../../../axon/js/Property.js';
import EnumerationProperty from '../../../../axon/js/EnumerationProperty.js';
import TimeSpeed from '../../../../scenery-phet/js/TimeSpeed.js';
import { Utils } from '../../../../scenery/js/imports.js';
import bendingLight from '../../bendingLight.js';
import BendingLightConstants from '../BendingLightConstants.js';
import Laser from './Laser.js';
import MediumColorFactory from './MediumColorFactory.js';
import LaserViewEnum from './LaserViewEnum.js';
import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Range from '../../../../dot/js/Range.js';
// constants
const DEFAULT_LASER_DISTANCE_FROM_PIVOT = 9.225E-6;

// a good size for the units being used in the sim; used to determine the dimensions of various model objects
const CHARACTERISTIC_LENGTH = BendingLightConstants.WAVELENGTH_RED;
class BendingLightModel {
  static DEFAULT_LASER_DISTANCE_FROM_PIVOT = DEFAULT_LASER_DISTANCE_FROM_PIVOT;

  /**
   * @param laserAngle - laser angle in radians
   * @param topLeftQuadrant - specifies whether laser in topLeftQuadrant
   * @param laserDistanceFromPivot - distance of laser from pivot point, in view coordinates
   * @param tandem
   */
  constructor(laserAngle, topLeftQuadrant, laserDistanceFromPivot, tandem) {
    // (read-only)- list of rays in the model
    this.rays = createObservableArray();

    // overridden in subtypes
    this.rotationArrowAngleOffset = null;
    this.mediumColorFactory = new MediumColorFactory();

    // dimensions of the model, guaranteed to be shown in entirety on the stage
    this.modelWidth = CHARACTERISTIC_LENGTH * 62;
    this.modelHeight = this.modelWidth * 0.7;

    // Check to see if WebGL was prevented by a query parameter
    this.allowWebGL = Utils.checkWebGLSupport() && phet.chipper.queryParameters.webgl; // (read-only)

    // Whether the laser is Ray or Wave mode
    this.laserViewProperty = new EnumerationProperty(LaserViewEnum.RAY);
    this.wavelengthProperty = new NumberProperty(BendingLightConstants.WAVELENGTH_RED, {
      tandem: tandem.createTandem('wavelengthProperty'),
      range: new Range(BendingLightConstants.LASER_MIN_WAVELENGTH * 1E-9, BendingLightConstants.LASER_MAX_WAVELENGTH * 1E-9)
    });
    this.isPlayingProperty = new BooleanProperty(true);
    this.speedProperty = new EnumerationProperty(TimeSpeed.NORMAL);
    this.indexOfRefractionProperty = new Property(1);
    this.showNormalProperty = new BooleanProperty(true);
    this.showAnglesProperty = new BooleanProperty(false);

    // (read-only)- the laser
    this.laser = new Laser(this.wavelengthProperty, laserDistanceFromPivot, laserAngle, topLeftQuadrant);
  }

  // Adds a ray to the model
  addRay(ray) {
    this.rays.push(ray);
  }

  // Clear the model in preparation for another ray propagation update phase
  clearModel() {
    for (let i = 0; i < this.rays.length; i++) {
      this.rays[i].particles.clear();
    }
    this.rays.length = 0;
  }

  // Update the model by clearing the rays, then recreating them
  updateModel() {
    this.clearModel();
    this.propagateRays();
  }
  reset() {
    this.laserViewProperty.reset();
    this.wavelengthProperty.reset();
    this.isPlayingProperty.reset();
    this.speedProperty.reset();
    this.indexOfRefractionProperty.reset();
    this.showNormalProperty.reset();
    this.showAnglesProperty.reset();
    this.laser.reset();
  }

  /**
   * Get the fraction of power reflected from the medium
   * @param n1 - index of refraction of first medium
   * @param n2 - index of refraction of second medium
   * @param cosTheta1 - cosine of incident angle
   * @param cosTheta2 - cosine of reflected angle
   */
  static getReflectedPower(n1, n2, cosTheta1, cosTheta2) {
    return Math.pow((n1 * cosTheta1 - n2 * cosTheta2) / (n1 * cosTheta1 + n2 * cosTheta2), 2);
  }

  /**
   * Get the fraction of power transmitted through the medium
   * @param n1 - index of refraction of first medium
   * @param n2 - index of refraction of second medium
   * @param cosTheta1 - cosine of incident angle
   * @param cosTheta2 - cosine of transmitted angle
   */
  static getTransmittedPower(n1, n2, cosTheta1, cosTheta2) {
    return 4 * n1 * n2 * cosTheta1 * cosTheta2 / Math.pow(n1 * cosTheta1 + n2 * cosTheta2, 2);
  }
}
bendingLight.register('BendingLightModel', BendingLightModel);
export default BendingLightModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVPYnNlcnZhYmxlQXJyYXkiLCJQcm9wZXJ0eSIsIkVudW1lcmF0aW9uUHJvcGVydHkiLCJUaW1lU3BlZWQiLCJVdGlscyIsImJlbmRpbmdMaWdodCIsIkJlbmRpbmdMaWdodENvbnN0YW50cyIsIkxhc2VyIiwiTWVkaXVtQ29sb3JGYWN0b3J5IiwiTGFzZXJWaWV3RW51bSIsIkJvb2xlYW5Qcm9wZXJ0eSIsIk51bWJlclByb3BlcnR5IiwiUmFuZ2UiLCJERUZBVUxUX0xBU0VSX0RJU1RBTkNFX0ZST01fUElWT1QiLCJDSEFSQUNURVJJU1RJQ19MRU5HVEgiLCJXQVZFTEVOR1RIX1JFRCIsIkJlbmRpbmdMaWdodE1vZGVsIiwiY29uc3RydWN0b3IiLCJsYXNlckFuZ2xlIiwidG9wTGVmdFF1YWRyYW50IiwibGFzZXJEaXN0YW5jZUZyb21QaXZvdCIsInRhbmRlbSIsInJheXMiLCJyb3RhdGlvbkFycm93QW5nbGVPZmZzZXQiLCJtZWRpdW1Db2xvckZhY3RvcnkiLCJtb2RlbFdpZHRoIiwibW9kZWxIZWlnaHQiLCJhbGxvd1dlYkdMIiwiY2hlY2tXZWJHTFN1cHBvcnQiLCJwaGV0IiwiY2hpcHBlciIsInF1ZXJ5UGFyYW1ldGVycyIsIndlYmdsIiwibGFzZXJWaWV3UHJvcGVydHkiLCJSQVkiLCJ3YXZlbGVuZ3RoUHJvcGVydHkiLCJjcmVhdGVUYW5kZW0iLCJyYW5nZSIsIkxBU0VSX01JTl9XQVZFTEVOR1RIIiwiTEFTRVJfTUFYX1dBVkVMRU5HVEgiLCJpc1BsYXlpbmdQcm9wZXJ0eSIsInNwZWVkUHJvcGVydHkiLCJOT1JNQUwiLCJpbmRleE9mUmVmcmFjdGlvblByb3BlcnR5Iiwic2hvd05vcm1hbFByb3BlcnR5Iiwic2hvd0FuZ2xlc1Byb3BlcnR5IiwibGFzZXIiLCJhZGRSYXkiLCJyYXkiLCJwdXNoIiwiY2xlYXJNb2RlbCIsImkiLCJsZW5ndGgiLCJwYXJ0aWNsZXMiLCJjbGVhciIsInVwZGF0ZU1vZGVsIiwicHJvcGFnYXRlUmF5cyIsInJlc2V0IiwiZ2V0UmVmbGVjdGVkUG93ZXIiLCJuMSIsIm4yIiwiY29zVGhldGExIiwiY29zVGhldGEyIiwiTWF0aCIsInBvdyIsImdldFRyYW5zbWl0dGVkUG93ZXIiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkJlbmRpbmdMaWdodE1vZGVsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIE1haW4gbW9kZWwgZm9yIGJlbmRpbmcgbGlnaHQgYXBwbGljYXRpb24uIFJheXMgYXJlIHJlY29tcHV0ZWQgd2hlbmV2ZXIgbGFzZXIgcGFyYW1ldGVycyBjaGFuZ2VkLiBFYWNoIHJheSBvc2NpbGxhdGVzXHJcbiAqIGluIHRpbWUsIGFzIHNob3duIGluIHRoZSB3YXZlIHZpZXcuIFRoZXJlIGFyZSBtb2RlbCByZXByZXNlbnRhdGlvbnMgZm9yIHNldmVyYWwgdG9vbHMgYXMgd2VsbCBhcyB0aGVpciB2aXNpYmlsaXR5LlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIENoYW5kcmFzaGVrYXIgQmVtYWdvbmkgKEFjdHVhbCBDb25jZXB0cylcclxuICovXHJcblxyXG5pbXBvcnQgY3JlYXRlT2JzZXJ2YWJsZUFycmF5LCB7IE9ic2VydmFibGVBcnJheSB9IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvY3JlYXRlT2JzZXJ2YWJsZUFycmF5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRW51bWVyYXRpb25Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0VudW1lcmF0aW9uUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVGltZVNwZWVkIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9UaW1lU3BlZWQuanMnO1xyXG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBiZW5kaW5nTGlnaHQgZnJvbSAnLi4vLi4vYmVuZGluZ0xpZ2h0LmpzJztcclxuaW1wb3J0IEJlbmRpbmdMaWdodENvbnN0YW50cyBmcm9tICcuLi9CZW5kaW5nTGlnaHRDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgTGFzZXIgZnJvbSAnLi9MYXNlci5qcyc7XHJcbmltcG9ydCBMaWdodFJheSBmcm9tICcuL0xpZ2h0UmF5LmpzJztcclxuaW1wb3J0IE1lZGl1bUNvbG9yRmFjdG9yeSBmcm9tICcuL01lZGl1bUNvbG9yRmFjdG9yeS5qcyc7XHJcbmltcG9ydCBMYXNlclZpZXdFbnVtIGZyb20gJy4vTGFzZXJWaWV3RW51bS5qcyc7XHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgVE1vZGVsIGZyb20gJy4uLy4uLy4uLy4uL2pvaXN0L2pzL1RNb2RlbC5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgREVGQVVMVF9MQVNFUl9ESVNUQU5DRV9GUk9NX1BJVk9UID0gOS4yMjVFLTY7XHJcblxyXG4vLyBhIGdvb2Qgc2l6ZSBmb3IgdGhlIHVuaXRzIGJlaW5nIHVzZWQgaW4gdGhlIHNpbTsgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGRpbWVuc2lvbnMgb2YgdmFyaW91cyBtb2RlbCBvYmplY3RzXHJcbmNvbnN0IENIQVJBQ1RFUklTVElDX0xFTkdUSCA9IEJlbmRpbmdMaWdodENvbnN0YW50cy5XQVZFTEVOR1RIX1JFRDtcclxuXHJcbmFic3RyYWN0IGNsYXNzIEJlbmRpbmdMaWdodE1vZGVsIGltcGxlbWVudHMgVE1vZGVsIHtcclxuICBwdWJsaWMgcmVhZG9ubHkgcmF5czogT2JzZXJ2YWJsZUFycmF5PExpZ2h0UmF5PjtcclxuICBwdWJsaWMgbWVkaXVtQ29sb3JGYWN0b3J5OiBNZWRpdW1Db2xvckZhY3Rvcnk7XHJcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IG1vZGVsV2lkdGg6IG51bWJlcjtcclxuICBwdWJsaWMgcmVhZG9ubHkgbW9kZWxIZWlnaHQ6IG51bWJlcjtcclxuICBwdWJsaWMgcmVhZG9ubHkgYWxsb3dXZWJHTDogYm9vbGVhbjtcclxuICBwdWJsaWMgcmVhZG9ubHkgbGFzZXJWaWV3UHJvcGVydHk6IFByb3BlcnR5PExhc2VyVmlld0VudW0+O1xyXG4gIHB1YmxpYyByZWFkb25seSB3YXZlbGVuZ3RoUHJvcGVydHk6IFByb3BlcnR5PG51bWJlcj47XHJcbiAgcHVibGljIHJlYWRvbmx5IHNwZWVkUHJvcGVydHk6IEVudW1lcmF0aW9uUHJvcGVydHk8VGltZVNwZWVkPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGluZGV4T2ZSZWZyYWN0aW9uUHJvcGVydHk6IFByb3BlcnR5PG51bWJlcj47XHJcbiAgcHVibGljIHJlYWRvbmx5IHNob3dOb3JtYWxQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgcHVibGljIHJlYWRvbmx5IGlzUGxheWluZ1Byb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgc2hvd0FuZ2xlc1Byb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgbGFzZXI6IExhc2VyO1xyXG4gIHB1YmxpYyByb3RhdGlvbkFycm93QW5nbGVPZmZzZXQ6IG51bWJlciB8IG51bGw7XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgREVGQVVMVF9MQVNFUl9ESVNUQU5DRV9GUk9NX1BJVk9UOiBudW1iZXIgPSBERUZBVUxUX0xBU0VSX0RJU1RBTkNFX0ZST01fUElWT1Q7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBsYXNlckFuZ2xlIC0gbGFzZXIgYW5nbGUgaW4gcmFkaWFuc1xyXG4gICAqIEBwYXJhbSB0b3BMZWZ0UXVhZHJhbnQgLSBzcGVjaWZpZXMgd2hldGhlciBsYXNlciBpbiB0b3BMZWZ0UXVhZHJhbnRcclxuICAgKiBAcGFyYW0gbGFzZXJEaXN0YW5jZUZyb21QaXZvdCAtIGRpc3RhbmNlIG9mIGxhc2VyIGZyb20gcGl2b3QgcG9pbnQsIGluIHZpZXcgY29vcmRpbmF0ZXNcclxuICAgKiBAcGFyYW0gdGFuZGVtXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBsYXNlckFuZ2xlOiBudW1iZXIsIHRvcExlZnRRdWFkcmFudDogYm9vbGVhbiwgbGFzZXJEaXN0YW5jZUZyb21QaXZvdDogbnVtYmVyLCB0YW5kZW06IFRhbmRlbSApIHtcclxuXHJcbiAgICAvLyAocmVhZC1vbmx5KS0gbGlzdCBvZiByYXlzIGluIHRoZSBtb2RlbFxyXG4gICAgdGhpcy5yYXlzID0gY3JlYXRlT2JzZXJ2YWJsZUFycmF5KCk7XHJcblxyXG4gICAgLy8gb3ZlcnJpZGRlbiBpbiBzdWJ0eXBlc1xyXG4gICAgdGhpcy5yb3RhdGlvbkFycm93QW5nbGVPZmZzZXQgPSBudWxsO1xyXG5cclxuICAgIHRoaXMubWVkaXVtQ29sb3JGYWN0b3J5ID0gbmV3IE1lZGl1bUNvbG9yRmFjdG9yeSgpO1xyXG5cclxuICAgIC8vIGRpbWVuc2lvbnMgb2YgdGhlIG1vZGVsLCBndWFyYW50ZWVkIHRvIGJlIHNob3duIGluIGVudGlyZXR5IG9uIHRoZSBzdGFnZVxyXG4gICAgdGhpcy5tb2RlbFdpZHRoID0gQ0hBUkFDVEVSSVNUSUNfTEVOR1RIICogNjI7XHJcbiAgICB0aGlzLm1vZGVsSGVpZ2h0ID0gdGhpcy5tb2RlbFdpZHRoICogMC43O1xyXG5cclxuICAgIC8vIENoZWNrIHRvIHNlZSBpZiBXZWJHTCB3YXMgcHJldmVudGVkIGJ5IGEgcXVlcnkgcGFyYW1ldGVyXHJcbiAgICB0aGlzLmFsbG93V2ViR0wgPSBVdGlscy5jaGVja1dlYkdMU3VwcG9ydCgpICYmIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMud2ViZ2w7IC8vIChyZWFkLW9ubHkpXHJcblxyXG4gICAgLy8gV2hldGhlciB0aGUgbGFzZXIgaXMgUmF5IG9yIFdhdmUgbW9kZVxyXG4gICAgdGhpcy5sYXNlclZpZXdQcm9wZXJ0eSA9IG5ldyBFbnVtZXJhdGlvblByb3BlcnR5KCBMYXNlclZpZXdFbnVtLlJBWSApO1xyXG5cclxuICAgIHRoaXMud2F2ZWxlbmd0aFByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCBCZW5kaW5nTGlnaHRDb25zdGFudHMuV0FWRUxFTkdUSF9SRUQsIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnd2F2ZWxlbmd0aFByb3BlcnR5JyApLFxyXG4gICAgICByYW5nZTogbmV3IFJhbmdlKCBCZW5kaW5nTGlnaHRDb25zdGFudHMuTEFTRVJfTUlOX1dBVkVMRU5HVEggKiAxRS05LCBCZW5kaW5nTGlnaHRDb25zdGFudHMuTEFTRVJfTUFYX1dBVkVMRU5HVEggKiAxRS05IClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuaXNQbGF5aW5nUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlICk7XHJcbiAgICB0aGlzLnNwZWVkUHJvcGVydHkgPSBuZXcgRW51bWVyYXRpb25Qcm9wZXJ0eSggVGltZVNwZWVkLk5PUk1BTCApO1xyXG4gICAgdGhpcy5pbmRleE9mUmVmcmFjdGlvblByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCAxICk7XHJcbiAgICB0aGlzLnNob3dOb3JtYWxQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUgKTtcclxuICAgIHRoaXMuc2hvd0FuZ2xlc1Byb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuXHJcbiAgICAvLyAocmVhZC1vbmx5KS0gdGhlIGxhc2VyXHJcbiAgICB0aGlzLmxhc2VyID0gbmV3IExhc2VyKCB0aGlzLndhdmVsZW5ndGhQcm9wZXJ0eSwgbGFzZXJEaXN0YW5jZUZyb21QaXZvdCwgbGFzZXJBbmdsZSwgdG9wTGVmdFF1YWRyYW50ICk7XHJcbiAgfVxyXG5cclxuICAvLyBBZGRzIGEgcmF5IHRvIHRoZSBtb2RlbFxyXG4gIHB1YmxpYyBhZGRSYXkoIHJheTogTGlnaHRSYXkgKTogdm9pZCB7XHJcbiAgICB0aGlzLnJheXMucHVzaCggcmF5ICk7XHJcbiAgfVxyXG5cclxuICAvLyBDbGVhciB0aGUgbW9kZWwgaW4gcHJlcGFyYXRpb24gZm9yIGFub3RoZXIgcmF5IHByb3BhZ2F0aW9uIHVwZGF0ZSBwaGFzZVxyXG4gIHByaXZhdGUgY2xlYXJNb2RlbCgpOiB2b2lkIHtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMucmF5cy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgdGhpcy5yYXlzWyBpIF0ucGFydGljbGVzLmNsZWFyKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnJheXMubGVuZ3RoID0gMDtcclxuICB9XHJcblxyXG4gIC8vIFVwZGF0ZSB0aGUgbW9kZWwgYnkgY2xlYXJpbmcgdGhlIHJheXMsIHRoZW4gcmVjcmVhdGluZyB0aGVtXHJcbiAgcHVibGljIHVwZGF0ZU1vZGVsKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jbGVhck1vZGVsKCk7XHJcbiAgICB0aGlzLnByb3BhZ2F0ZVJheXMoKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBwcm9wYWdhdGVSYXlzKCk6IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMubGFzZXJWaWV3UHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMud2F2ZWxlbmd0aFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmlzUGxheWluZ1Byb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnNwZWVkUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuaW5kZXhPZlJlZnJhY3Rpb25Qcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5zaG93Tm9ybWFsUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuc2hvd0FuZ2xlc1Byb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmxhc2VyLnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIGZyYWN0aW9uIG9mIHBvd2VyIHJlZmxlY3RlZCBmcm9tIHRoZSBtZWRpdW1cclxuICAgKiBAcGFyYW0gbjEgLSBpbmRleCBvZiByZWZyYWN0aW9uIG9mIGZpcnN0IG1lZGl1bVxyXG4gICAqIEBwYXJhbSBuMiAtIGluZGV4IG9mIHJlZnJhY3Rpb24gb2Ygc2Vjb25kIG1lZGl1bVxyXG4gICAqIEBwYXJhbSBjb3NUaGV0YTEgLSBjb3NpbmUgb2YgaW5jaWRlbnQgYW5nbGVcclxuICAgKiBAcGFyYW0gY29zVGhldGEyIC0gY29zaW5lIG9mIHJlZmxlY3RlZCBhbmdsZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgZ2V0UmVmbGVjdGVkUG93ZXIoIG4xOiBudW1iZXIsIG4yOiBudW1iZXIsIGNvc1RoZXRhMTogbnVtYmVyLCBjb3NUaGV0YTI6IG51bWJlciApOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIE1hdGgucG93KCAoIG4xICogY29zVGhldGExIC0gbjIgKiBjb3NUaGV0YTIgKSAvICggbjEgKiBjb3NUaGV0YTEgKyBuMiAqIGNvc1RoZXRhMiApLCAyICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIGZyYWN0aW9uIG9mIHBvd2VyIHRyYW5zbWl0dGVkIHRocm91Z2ggdGhlIG1lZGl1bVxyXG4gICAqIEBwYXJhbSBuMSAtIGluZGV4IG9mIHJlZnJhY3Rpb24gb2YgZmlyc3QgbWVkaXVtXHJcbiAgICogQHBhcmFtIG4yIC0gaW5kZXggb2YgcmVmcmFjdGlvbiBvZiBzZWNvbmQgbWVkaXVtXHJcbiAgICogQHBhcmFtIGNvc1RoZXRhMSAtIGNvc2luZSBvZiBpbmNpZGVudCBhbmdsZVxyXG4gICAqIEBwYXJhbSBjb3NUaGV0YTIgLSBjb3NpbmUgb2YgdHJhbnNtaXR0ZWQgYW5nbGVcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGdldFRyYW5zbWl0dGVkUG93ZXIoIG4xOiBudW1iZXIsIG4yOiBudW1iZXIsIGNvc1RoZXRhMTogbnVtYmVyLCBjb3NUaGV0YTI6IG51bWJlciApOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIDQgKiBuMSAqIG4yICogY29zVGhldGExICogY29zVGhldGEyIC8gKCBNYXRoLnBvdyggbjEgKiBjb3NUaGV0YTEgKyBuMiAqIGNvc1RoZXRhMiwgMiApICk7XHJcbiAgfVxyXG59XHJcblxyXG5iZW5kaW5nTGlnaHQucmVnaXN0ZXIoICdCZW5kaW5nTGlnaHRNb2RlbCcsIEJlbmRpbmdMaWdodE1vZGVsICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBCZW5kaW5nTGlnaHRNb2RlbDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLHFCQUFxQixNQUEyQiw4Q0FBOEM7QUFDckcsT0FBT0MsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxtQkFBbUIsTUFBTSw0Q0FBNEM7QUFDNUUsT0FBT0MsU0FBUyxNQUFNLDBDQUEwQztBQUNoRSxTQUFTQyxLQUFLLFFBQVEsbUNBQW1DO0FBQ3pELE9BQU9DLFlBQVksTUFBTSx1QkFBdUI7QUFDaEQsT0FBT0MscUJBQXFCLE1BQU0sNkJBQTZCO0FBQy9ELE9BQU9DLEtBQUssTUFBTSxZQUFZO0FBRTlCLE9BQU9DLGtCQUFrQixNQUFNLHlCQUF5QjtBQUN4RCxPQUFPQyxhQUFhLE1BQU0sb0JBQW9CO0FBQzlDLE9BQU9DLGVBQWUsTUFBTSx3Q0FBd0M7QUFFcEUsT0FBT0MsY0FBYyxNQUFN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