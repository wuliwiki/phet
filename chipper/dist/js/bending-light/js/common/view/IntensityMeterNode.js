// Copyright 2015-2023, University of Colorado Boulder

/**
 * View for the intensity meter, including its movable sensor and readout region (called the body).
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Chandrashekar Bemagoni (Actual Concepts)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Vector2Property from '../../../../dot/js/Vector2Property.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import ProbeNode from '../../../../scenery-phet/js/ProbeNode.js';
import ShadedRectangle from '../../../../scenery-phet/js/ShadedRectangle.js';
import WireNode from '../../../../scenery-phet/js/WireNode.js';
import { LinearGradient, Node, Rectangle, Text } from '../../../../scenery/js/imports.js';
import BendingLightStrings from '../../BendingLightStrings.js';
import bendingLight from '../../bendingLight.js';
const intensityStringProperty = BendingLightStrings.intensityStringProperty;

// constants
const NORMAL_DISTANCE = 25;
const bodyNormalProperty = new Vector2Property(new Vector2(NORMAL_DISTANCE, 0));
const sensorNormalProperty = new Vector2Property(new Vector2(0, NORMAL_DISTANCE));
class IntensityMeterNode extends Node {
  /**
   * @param modelViewTransform - Transform between model and view coordinate frames
   * @param intensityMeter - model for the intensity meter
   * @param [providedOptions]
   */
  constructor(modelViewTransform, intensityMeter, providedOptions) {
    super();
    this.modelViewTransform = modelViewTransform; // (read-only)
    this.intensityMeter = intensityMeter;
    this.probeNode = new ProbeNode({
      cursor: 'pointer',
      scale: 0.6
    });

    // add body node
    const rectangleWidth = 150;
    const rectangleHeight = 95;

    // adding outer rectangle
    const outerRectangle = new Rectangle(0, 0, rectangleWidth, rectangleHeight, 5, 5, {
      stroke: new LinearGradient(0, 0, 0, rectangleHeight).addColorStop(0, '#408260').addColorStop(1, '#005127'),
      fill: new LinearGradient(0, 0, 0, rectangleHeight).addColorStop(0, '#06974C').addColorStop(0.6, '#00773A'),
      lineWidth: 2
    });

    // second rectangle
    const innerRectangle = new Rectangle(2, 2, rectangleWidth - 10, rectangleHeight - 10, 5, 5, {
      fill: '#008541',
      centerX: outerRectangle.centerX,
      centerY: outerRectangle.centerY
    });

    // adding inner rectangle
    const valueBackground = new ShadedRectangle(new Bounds2(0, 0, rectangleWidth * 0.8, rectangleHeight * 0.4), {
      baseColor: 'white',
      lightSource: 'rightBottom',
      centerX: innerRectangle.centerX,
      top: 10
    });

    // Add a "Intensity" title to the body node
    const titleNode = new Text(intensityStringProperty, {
      font: new PhetFont(24),
      fill: 'white',
      maxWidth: rectangleWidth - 15
    });

    // Add the reading to the body node
    const valueNode = new Text(intensityMeter.readingProperty.get().getString(), {
      font: new PhetFont(25),
      fill: 'black',
      maxWidth: valueBackground.width * 0.85
    });

    // add up all the shapes to form a body node
    this.bodyNode = new Node({
      children: [outerRectangle, innerRectangle, valueBackground, titleNode, valueNode],
      cursor: 'pointer',
      scale: 0.6
    });
    titleNode.bottom = innerRectangle.bottom - 3;
    titleNode.boundsProperty.link(bounds => {
      titleNode.centerX = outerRectangle.centerX;
    });

    // displayed value
    intensityMeter.readingProperty.link(reading => {
      valueNode.setString(reading.getString());
      valueNode.center = valueBackground.center;
    });

    // Connect the sensor to the body with a gray wire
    const above = amount => position => position.plusXY(0, -amount);
    const rightBottomProperty = new DerivedProperty([this.bodyNode.boundsProperty], bounds => bounds.rightBottom);
    const centerBottomProperty = new DerivedProperty([this.probeNode.boundsProperty], bounds => bounds.centerBottom);
    this.wireNode = new WireNode(new DerivedProperty([rightBottomProperty], above(12)), bodyNormalProperty, centerBottomProperty, sensorNormalProperty, {
      lineWidth: 3,
      stroke: 'gray'
    });
    intensityMeter.sensorPositionProperty.link(sensorPosition => {
      this.probeNode.translation = modelViewTransform.modelToViewPosition(sensorPosition);
    });
    intensityMeter.bodyPositionProperty.link(bodyPosition => {
      this.bodyNode.translation = modelViewTransform.modelToViewPosition(bodyPosition);
    });

    // add the components
    this.addChild(this.wireNode);
    this.addChild(this.probeNode);
    this.addChild(this.bodyNode);

    /**
     * when the nodes are positioned by moving the node itself (for view layout), synchonize the model
     * Without this, when the body node is bumped out of the medium panels, it would have the wrong model position
     */
    this.syncModelFromView = () => {
      const sensorPosition = modelViewTransform.viewToModelPosition(this.probeNode.translation);
      const bodyPosition = modelViewTransform.viewToModelPosition(this.bodyNode.translation);
      intensityMeter.sensorPositionProperty.value = sensorPosition;
      intensityMeter.bodyPositionProperty.value = bodyPosition;
    };
    this.mutate(providedOptions);
    this.resetRelativePositions();
    this.syncModelFromView();
  }
  resetRelativePositions() {
    this.probeNode.center = this.bodyNode.center.plusXY(90, -10);
  }
}
bendingLight.register('IntensityMeterNode', IntensityMeterNode);
export default IntensityMeterNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJCb3VuZHMyIiwiVmVjdG9yMiIsIlZlY3RvcjJQcm9wZXJ0eSIsIlBoZXRGb250IiwiUHJvYmVOb2RlIiwiU2hhZGVkUmVjdGFuZ2xlIiwiV2lyZU5vZGUiLCJMaW5lYXJHcmFkaWVudCIsIk5vZGUiLCJSZWN0YW5nbGUiLCJUZXh0IiwiQmVuZGluZ0xpZ2h0U3RyaW5ncyIsImJlbmRpbmdMaWdodCIsImludGVuc2l0eVN0cmluZ1Byb3BlcnR5IiwiTk9STUFMX0RJU1RBTkNFIiwiYm9keU5vcm1hbFByb3BlcnR5Iiwic2Vuc29yTm9ybWFsUHJvcGVydHkiLCJJbnRlbnNpdHlNZXRlck5vZGUiLCJjb25zdHJ1Y3RvciIsIm1vZGVsVmlld1RyYW5zZm9ybSIsImludGVuc2l0eU1ldGVyIiwicHJvdmlkZWRPcHRpb25zIiwicHJvYmVOb2RlIiwiY3Vyc29yIiwic2NhbGUiLCJyZWN0YW5nbGVXaWR0aCIsInJlY3RhbmdsZUhlaWdodCIsIm91dGVyUmVjdGFuZ2xlIiwic3Ryb2tlIiwiYWRkQ29sb3JTdG9wIiwiZmlsbCIsImxpbmVXaWR0aCIsImlubmVyUmVjdGFuZ2xlIiwiY2VudGVyWCIsImNlbnRlclkiLCJ2YWx1ZUJhY2tncm91bmQiLCJiYXNlQ29sb3IiLCJsaWdodFNvdXJjZSIsInRvcCIsInRpdGxlTm9kZSIsImZvbnQiLCJtYXhXaWR0aCIsInZhbHVlTm9kZSIsInJlYWRpbmdQcm9wZXJ0eSIsImdldCIsImdldFN0cmluZyIsIndpZHRoIiwiYm9keU5vZGUiLCJjaGlsZHJlbiIsImJvdHRvbSIsImJvdW5kc1Byb3BlcnR5IiwibGluayIsImJvdW5kcyIsInJlYWRpbmciLCJzZXRTdHJpbmciLCJjZW50ZXIiLCJhYm92ZSIsImFtb3VudCIsInBvc2l0aW9uIiwicGx1c1hZIiwicmlnaHRCb3R0b21Qcm9wZXJ0eSIsInJpZ2h0Qm90dG9tIiwiY2VudGVyQm90dG9tUHJvcGVydHkiLCJjZW50ZXJCb3R0b20iLCJ3aXJlTm9kZSIsInNlbnNvclBvc2l0aW9uUHJvcGVydHkiLCJzZW5zb3JQb3NpdGlvbiIsInRyYW5zbGF0aW9uIiwibW9kZWxUb1ZpZXdQb3NpdGlvbiIsImJvZHlQb3NpdGlvblByb3BlcnR5IiwiYm9keVBvc2l0aW9uIiwiYWRkQ2hpbGQiLCJzeW5jTW9kZWxGcm9tVmlldyIsInZpZXdUb01vZGVsUG9zaXRpb24iLCJ2YWx1ZSIsIm11dGF0ZSIsInJlc2V0UmVsYXRpdmVQb3NpdGlvbnMiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkludGVuc2l0eU1ldGVyTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBWaWV3IGZvciB0aGUgaW50ZW5zaXR5IG1ldGVyLCBpbmNsdWRpbmcgaXRzIG1vdmFibGUgc2Vuc29yIGFuZCByZWFkb3V0IHJlZ2lvbiAoY2FsbGVkIHRoZSBib2R5KS5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBDaGFuZHJhc2hla2FyIEJlbWFnb25pIChBY3R1YWwgQ29uY2VwdHMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMlByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IFByb2JlTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUHJvYmVOb2RlLmpzJztcclxuaW1wb3J0IFNoYWRlZFJlY3RhbmdsZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvU2hhZGVkUmVjdGFuZ2xlLmpzJztcclxuaW1wb3J0IFdpcmVOb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9XaXJlTm9kZS5qcyc7XHJcbmltcG9ydCB7IExpbmVhckdyYWRpZW50LCBOb2RlLCBOb2RlT3B0aW9ucywgUmVjdGFuZ2xlLCBUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEJlbmRpbmdMaWdodFN0cmluZ3MgZnJvbSAnLi4vLi4vQmVuZGluZ0xpZ2h0U3RyaW5ncy5qcyc7XHJcbmltcG9ydCBiZW5kaW5nTGlnaHQgZnJvbSAnLi4vLi4vYmVuZGluZ0xpZ2h0LmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgSW50ZW5zaXR5TWV0ZXIgZnJvbSAnLi4vbW9kZWwvSW50ZW5zaXR5TWV0ZXIuanMnO1xyXG5cclxuY29uc3QgaW50ZW5zaXR5U3RyaW5nUHJvcGVydHkgPSBCZW5kaW5nTGlnaHRTdHJpbmdzLmludGVuc2l0eVN0cmluZ1Byb3BlcnR5O1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE5PUk1BTF9ESVNUQU5DRSA9IDI1O1xyXG5jb25zdCBib2R5Tm9ybWFsUHJvcGVydHkgPSBuZXcgVmVjdG9yMlByb3BlcnR5KCBuZXcgVmVjdG9yMiggTk9STUFMX0RJU1RBTkNFLCAwICkgKTtcclxuY29uc3Qgc2Vuc29yTm9ybWFsUHJvcGVydHkgPSBuZXcgVmVjdG9yMlByb3BlcnR5KCBuZXcgVmVjdG9yMiggMCwgTk9STUFMX0RJU1RBTkNFICkgKTtcclxuXHJcbnR5cGUgSW50ZW5zaXR5TWV0ZXJOb2RlT3B0aW9ucyA9IE5vZGVPcHRpb25zO1xyXG5cclxuY2xhc3MgSW50ZW5zaXR5TWV0ZXJOb2RlIGV4dGVuZHMgTm9kZSB7XHJcbiAgcHJpdmF0ZSBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTI7XHJcbiAgcHVibGljIHByb2JlTm9kZTogUHJvYmVOb2RlO1xyXG4gIHByaXZhdGUgaW50ZW5zaXR5TWV0ZXI6IEludGVuc2l0eU1ldGVyO1xyXG4gIHB1YmxpYyBib2R5Tm9kZTogTm9kZTtcclxuICBwcml2YXRlIHdpcmVOb2RlOiBXaXJlTm9kZTtcclxuICBwdWJsaWMgc3luY01vZGVsRnJvbVZpZXc6ICgpID0+IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBtb2RlbFZpZXdUcmFuc2Zvcm0gLSBUcmFuc2Zvcm0gYmV0d2VlbiBtb2RlbCBhbmQgdmlldyBjb29yZGluYXRlIGZyYW1lc1xyXG4gICAqIEBwYXJhbSBpbnRlbnNpdHlNZXRlciAtIG1vZGVsIGZvciB0aGUgaW50ZW5zaXR5IG1ldGVyXHJcbiAgICogQHBhcmFtIFtwcm92aWRlZE9wdGlvbnNdXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTIsIGludGVuc2l0eU1ldGVyOiBJbnRlbnNpdHlNZXRlciwgcHJvdmlkZWRPcHRpb25zPzogSW50ZW5zaXR5TWV0ZXJOb2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBzdXBlcigpO1xyXG4gICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0gPSBtb2RlbFZpZXdUcmFuc2Zvcm07IC8vIChyZWFkLW9ubHkpXHJcbiAgICB0aGlzLmludGVuc2l0eU1ldGVyID0gaW50ZW5zaXR5TWV0ZXI7XHJcblxyXG4gICAgdGhpcy5wcm9iZU5vZGUgPSBuZXcgUHJvYmVOb2RlKCB7IGN1cnNvcjogJ3BvaW50ZXInLCBzY2FsZTogMC42IH0gKTtcclxuXHJcbiAgICAvLyBhZGQgYm9keSBub2RlXHJcbiAgICBjb25zdCByZWN0YW5nbGVXaWR0aCA9IDE1MDtcclxuICAgIGNvbnN0IHJlY3RhbmdsZUhlaWdodCA9IDk1O1xyXG5cclxuICAgIC8vIGFkZGluZyBvdXRlciByZWN0YW5nbGVcclxuICAgIGNvbnN0IG91dGVyUmVjdGFuZ2xlID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgcmVjdGFuZ2xlV2lkdGgsIHJlY3RhbmdsZUhlaWdodCwgNSwgNSwge1xyXG4gICAgICBzdHJva2U6IG5ldyBMaW5lYXJHcmFkaWVudCggMCwgMCwgMCwgcmVjdGFuZ2xlSGVpZ2h0IClcclxuICAgICAgICAuYWRkQ29sb3JTdG9wKCAwLCAnIzQwODI2MCcgKVxyXG4gICAgICAgIC5hZGRDb2xvclN0b3AoIDEsICcjMDA1MTI3JyApLFxyXG4gICAgICBmaWxsOiBuZXcgTGluZWFyR3JhZGllbnQoIDAsIDAsIDAsIHJlY3RhbmdsZUhlaWdodCApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggMCwgJyMwNjk3NEMnIClcclxuICAgICAgICAuYWRkQ29sb3JTdG9wKCAwLjYsICcjMDA3NzNBJyApLFxyXG4gICAgICBsaW5lV2lkdGg6IDJcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBzZWNvbmQgcmVjdGFuZ2xlXHJcbiAgICBjb25zdCBpbm5lclJlY3RhbmdsZSA9IG5ldyBSZWN0YW5nbGUoIDIsIDIsIHJlY3RhbmdsZVdpZHRoIC0gMTAsIHJlY3RhbmdsZUhlaWdodCAtIDEwLCA1LCA1LCB7XHJcbiAgICAgIGZpbGw6ICcjMDA4NTQxJyxcclxuICAgICAgY2VudGVyWDogb3V0ZXJSZWN0YW5nbGUuY2VudGVyWCxcclxuICAgICAgY2VudGVyWTogb3V0ZXJSZWN0YW5nbGUuY2VudGVyWVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGFkZGluZyBpbm5lciByZWN0YW5nbGVcclxuICAgIGNvbnN0IHZhbHVlQmFja2dyb3VuZCA9IG5ldyBTaGFkZWRSZWN0YW5nbGUoIG5ldyBCb3VuZHMyKCAwLCAwLCByZWN0YW5nbGVXaWR0aCAqIDAuOCwgcmVjdGFuZ2xlSGVpZ2h0ICogMC40ICksIHtcclxuICAgICAgYmFzZUNvbG9yOiAnd2hpdGUnLFxyXG4gICAgICBsaWdodFNvdXJjZTogJ3JpZ2h0Qm90dG9tJyxcclxuICAgICAgY2VudGVyWDogaW5uZXJSZWN0YW5nbGUuY2VudGVyWCxcclxuICAgICAgdG9wOiAxMFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEFkZCBhIFwiSW50ZW5zaXR5XCIgdGl0bGUgdG8gdGhlIGJvZHkgbm9kZVxyXG4gICAgY29uc3QgdGl0bGVOb2RlID0gbmV3IFRleHQoIGludGVuc2l0eVN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMjQgKSxcclxuICAgICAgZmlsbDogJ3doaXRlJyxcclxuICAgICAgbWF4V2lkdGg6IHJlY3RhbmdsZVdpZHRoIC0gMTVcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIHJlYWRpbmcgdG8gdGhlIGJvZHkgbm9kZVxyXG4gICAgY29uc3QgdmFsdWVOb2RlID0gbmV3IFRleHQoIGludGVuc2l0eU1ldGVyLnJlYWRpbmdQcm9wZXJ0eS5nZXQoKS5nZXRTdHJpbmcoKSwge1xyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIDI1ICksXHJcbiAgICAgIGZpbGw6ICdibGFjaycsXHJcbiAgICAgIG1heFdpZHRoOiB2YWx1ZUJhY2tncm91bmQud2lkdGggKiAwLjg1XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYWRkIHVwIGFsbCB0aGUgc2hhcGVzIHRvIGZvcm0gYSBib2R5IG5vZGVcclxuICAgIHRoaXMuYm9keU5vZGUgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogWyBvdXRlclJlY3RhbmdsZSwgaW5uZXJSZWN0YW5nbGUsIHZhbHVlQmFja2dyb3VuZCwgdGl0bGVOb2RlLCB2YWx1ZU5vZGUgXSxcclxuICAgICAgY3Vyc29yOiAncG9pbnRlcicsXHJcbiAgICAgIHNjYWxlOiAwLjZcclxuICAgIH0gKTtcclxuICAgIHRpdGxlTm9kZS5ib3R0b20gPSBpbm5lclJlY3RhbmdsZS5ib3R0b20gLSAzO1xyXG5cclxuICAgIHRpdGxlTm9kZS5ib3VuZHNQcm9wZXJ0eS5saW5rKCBib3VuZHMgPT4ge1xyXG4gICAgICB0aXRsZU5vZGUuY2VudGVyWCA9IG91dGVyUmVjdGFuZ2xlLmNlbnRlclg7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gZGlzcGxheWVkIHZhbHVlXHJcbiAgICBpbnRlbnNpdHlNZXRlci5yZWFkaW5nUHJvcGVydHkubGluayggcmVhZGluZyA9PiB7XHJcbiAgICAgIHZhbHVlTm9kZS5zZXRTdHJpbmcoIHJlYWRpbmcuZ2V0U3RyaW5nKCkgKTtcclxuICAgICAgdmFsdWVOb2RlLmNlbnRlciA9IHZhbHVlQmFja2dyb3VuZC5jZW50ZXI7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQ29ubmVjdCB0aGUgc2Vuc29yIHRvIHRoZSBib2R5IHdpdGggYSBncmF5IHdpcmVcclxuICAgIGNvbnN0IGFib3ZlID0gKCBhbW91bnQ6IG51bWJlciApID0+ICggcG9zaXRpb246IFZlY3RvcjIgKSA9PiBwb3NpdGlvbi5wbHVzWFkoIDAsIC1hbW91bnQgKTtcclxuXHJcbiAgICBjb25zdCByaWdodEJvdHRvbVByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyB0aGlzLmJvZHlOb2RlLmJvdW5kc1Byb3BlcnR5IF0sIGJvdW5kcyA9PiBib3VuZHMucmlnaHRCb3R0b20gKTtcclxuICAgIGNvbnN0IGNlbnRlckJvdHRvbVByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyB0aGlzLnByb2JlTm9kZS5ib3VuZHNQcm9wZXJ0eSBdLCBib3VuZHMgPT4gYm91bmRzLmNlbnRlckJvdHRvbSApO1xyXG5cclxuICAgIHRoaXMud2lyZU5vZGUgPSBuZXcgV2lyZU5vZGUoXHJcbiAgICAgIG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgcmlnaHRCb3R0b21Qcm9wZXJ0eSBdLCBhYm92ZSggMTIgKSApLFxyXG4gICAgICBib2R5Tm9ybWFsUHJvcGVydHksXHJcbiAgICAgIGNlbnRlckJvdHRvbVByb3BlcnR5LFxyXG4gICAgICBzZW5zb3JOb3JtYWxQcm9wZXJ0eSwge1xyXG4gICAgICAgIGxpbmVXaWR0aDogMyxcclxuICAgICAgICBzdHJva2U6ICdncmF5J1xyXG4gICAgICB9XHJcbiAgICApO1xyXG5cclxuICAgIGludGVuc2l0eU1ldGVyLnNlbnNvclBvc2l0aW9uUHJvcGVydHkubGluayggc2Vuc29yUG9zaXRpb24gPT4ge1xyXG4gICAgICB0aGlzLnByb2JlTm9kZS50cmFuc2xhdGlvbiA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBzZW5zb3JQb3NpdGlvbiApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGludGVuc2l0eU1ldGVyLmJvZHlQb3NpdGlvblByb3BlcnR5LmxpbmsoIGJvZHlQb3NpdGlvbiA9PiB7XHJcbiAgICAgIHRoaXMuYm9keU5vZGUudHJhbnNsYXRpb24gPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggYm9keVBvc2l0aW9uICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYWRkIHRoZSBjb21wb25lbnRzXHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLndpcmVOb2RlICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLnByb2JlTm9kZSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5ib2R5Tm9kZSApO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogd2hlbiB0aGUgbm9kZXMgYXJlIHBvc2l0aW9uZWQgYnkgbW92aW5nIHRoZSBub2RlIGl0c2VsZiAoZm9yIHZpZXcgbGF5b3V0KSwgc3luY2hvbml6ZSB0aGUgbW9kZWxcclxuICAgICAqIFdpdGhvdXQgdGhpcywgd2hlbiB0aGUgYm9keSBub2RlIGlzIGJ1bXBlZCBvdXQgb2YgdGhlIG1lZGl1bSBwYW5lbHMsIGl0IHdvdWxkIGhhdmUgdGhlIHdyb25nIG1vZGVsIHBvc2l0aW9uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuc3luY01vZGVsRnJvbVZpZXcgPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNlbnNvclBvc2l0aW9uID0gbW9kZWxWaWV3VHJhbnNmb3JtLnZpZXdUb01vZGVsUG9zaXRpb24oIHRoaXMucHJvYmVOb2RlLnRyYW5zbGF0aW9uICk7XHJcbiAgICAgIGNvbnN0IGJvZHlQb3NpdGlvbiA9IG1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbFBvc2l0aW9uKCB0aGlzLmJvZHlOb2RlLnRyYW5zbGF0aW9uICk7XHJcblxyXG4gICAgICBpbnRlbnNpdHlNZXRlci5zZW5zb3JQb3NpdGlvblByb3BlcnR5LnZhbHVlID0gc2Vuc29yUG9zaXRpb247XHJcbiAgICAgIGludGVuc2l0eU1ldGVyLmJvZHlQb3NpdGlvblByb3BlcnR5LnZhbHVlID0gYm9keVBvc2l0aW9uO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLm11dGF0ZSggcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5yZXNldFJlbGF0aXZlUG9zaXRpb25zKCk7XHJcbiAgICB0aGlzLnN5bmNNb2RlbEZyb21WaWV3KCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVzZXRSZWxhdGl2ZVBvc2l0aW9ucygpOiB2b2lkIHtcclxuICAgIHRoaXMucHJvYmVOb2RlLmNlbnRlciA9IHRoaXMuYm9keU5vZGUuY2VudGVyLnBsdXNYWSggOTAsIC0xMCApO1xyXG4gIH1cclxufVxyXG5cclxuYmVuZGluZ0xpZ2h0LnJlZ2lzdGVyKCAnSW50ZW5zaXR5TWV0ZXJOb2RlJywgSW50ZW5zaXR5TWV0ZXJOb2RlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBJbnRlbnNpdHlNZXRlck5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFN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