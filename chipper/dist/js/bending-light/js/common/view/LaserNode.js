// Copyright 2015-2023, University of Colorado Boulder

/**
 * Node for drawing the laser itself, including an on/off button and ability to rotate/translate.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Chandrashekar Bemagoni (Actual Concepts)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import Property from '../../../../axon/js/Property.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import merge from '../../../../phet-core/js/merge.js';
import LaserPointerNode from '../../../../scenery-phet/js/LaserPointerNode.js';
import { DragListener, Image, Node } from '../../../../scenery/js/imports.js';
import bendingLight from '../../bendingLight.js';
import BendingLightConstants from '../BendingLightConstants.js';
import knob_png from '../../../images/knob_png.js';
import optionize from '../../../../phet-core/js/optionize.js';
class LaserNode extends Node {
  /**
   * @param modelViewTransform - Transform between model and view coordinate frames
   * @param laser - model for the laser
   * @param showRotationDragHandlesProperty - to show laser node rotate arrows
   * @param showTranslationDragHandlesProperty - to show laser node drag arrows
   * @param clampDragAngle - function that limits the angle of laser to its bounds
   *                                       translating the laser
   * @param hasKnob - true - add a knob, make the laser rotate by dragging the knob, translate by dragging the laser body
   *                  false - don't add a knob, make the laser rotate by dragging the laser body, don't support translation
   * @param dragBoundsProperty - bounds that define where the laser may be dragged
   * @param occlusionHandler - function that will move the laser out from behind a control panel if dropped
   *                                      there
   * @param [providedOptions?]
   */
  constructor(modelViewTransform, laser, showRotationDragHandlesProperty, showTranslationDragHandlesProperty, clampDragAngle, hasKnob, dragBoundsProperty, occlusionHandler, providedOptions) {
    const options = optionize()({}, providedOptions);
    const laserPointerNode = new LaserPointerNode(laser.onProperty, {
      bodySize: new Dimension2(70, 30),
      nozzleSize: new Dimension2(10, 25),
      buttonRadius: 12,
      buttonXMargin: 2,
      buttonYMargin: 2,
      cornerRadius: 2,
      buttonTouchAreaDilation: 4,
      getButtonLocation: bodyNode => bodyNode.rightCenter.blend(bodyNode.center, 0.5)
    });
    const knobImage = hasKnob ? new Image(knob_png, {
      scale: 0.58,
      rightCenter: laserPointerNode.leftCenter

      // This will be resolved when Image is TypeScript
    }) : null;
    if (knobImage) {
      knobImage.touchArea = knobImage.localBounds.dilatedXY(15, 27).shiftedX(-15);
      hasKnob && laserPointerNode.addChild(knobImage);
    } else {
      laserPointerNode.touchArea = laserPointerNode.bounds.dilated(8).shiftedX(-8);
    }
    laserPointerNode.translate(laserPointerNode.width, laserPointerNode.height / 2);

    // If there is a knob ("Prisms" screen), it is used to rotate the laser.
    // If there is no knob ("Intro" and "More Tools" screens), then the laser is rotated by dragging the laser itself.
    const rotationTarget = hasKnob ? knobImage : laserPointerNode;

    // When mousing over or starting to drag the laser, increment the over count.  If it is more than zero
    // then show the drag handles.  This ensures they will be shown whenever dragging or over, and they won't flicker
    const overCountProperty = new Property(0);
    overCountProperty.link(overCount => showRotationDragHandlesProperty.set(overCount > 0));
    super(merge({
      cursor: 'pointer'
    }, providedOptions));

    // (read-only), Used for radius and length of drag handlers
    this.laserImageWidth = laserPointerNode.width;

    // add laser image
    laserPointerNode.rotateAround(laserPointerNode.getCenter(), Math.PI);
    this.addChild(laserPointerNode);
    const lightImageHeight = laserPointerNode.getHeight();

    // re usable vector to avoid vector allocation
    const emissionPointEndPosition = new Vector2(0, 0);

    // When the window reshapes, make sure the laser remains in the play area
    dragBoundsProperty.link(dragBounds => {
      const center = laser.emissionPointProperty.value;
      const eroded = dragBounds.erodedXY(lightImageHeight / 2, lightImageHeight / 2);
      const newEmissionPoint = modelViewTransform.viewToModelBounds(eroded).getClosestPoint(center.x, center.y);
      const delta = newEmissionPoint.minus(laser.emissionPointProperty.value);
      laser.translate(delta.x, delta.y);
    });

    // add the drag region for translating the laser
    let start;

    // On the "Prisms" screen, the laser can be translated by dragging the laser, and rotated by dragging the knob on
    // the back of the laser.  This part of the code handles the translation.
    if (hasKnob) {
      const translationListener = new DragListener({
        start: event => {
          start = this.globalToParentPoint(event.pointer.point);
          showTranslationDragHandlesProperty.value = true;
        },
        drag: event => {
          const laserNodeDragBounds = dragBoundsProperty.value.erodedXY(lightImageHeight / 2, lightImageHeight / 2);
          const laserDragBoundsInModelValues = modelViewTransform.viewToModelBounds(laserNodeDragBounds);
          const endDrag = this.globalToParentPoint(event.pointer.point);
          if (start) {
            const deltaX = modelViewTransform.viewToModelDeltaX(endDrag.x - start.x);
            const deltaY = modelViewTransform.viewToModelDeltaY(endDrag.y - start.y);

            // position of final emission point with out constraining to bounds
            emissionPointEndPosition.setXY(laser.emissionPointProperty.value.x + deltaX, laser.emissionPointProperty.value.y + deltaY);

            // position of final emission point with constraining to bounds
            const emissionPointEndPositionInBounds = laserDragBoundsInModelValues.closestPointTo(emissionPointEndPosition);
            const translateX = emissionPointEndPositionInBounds.x - laser.emissionPointProperty.value.x;
            const translateY = emissionPointEndPositionInBounds.y - laser.emissionPointProperty.value.y;
            laser.translate(translateX, translateY);

            // Store the position of caught point after translating. Can be obtained by adding distance between emission
            // point and drag point (end - emissionPointEndPosition) to emission point (emissionPointEndPositionInBounds)
            // after translating.
            const boundsDx = emissionPointEndPositionInBounds.x - emissionPointEndPosition.x;
            const boundsDY = emissionPointEndPositionInBounds.y - emissionPointEndPosition.y;
            endDrag.x = endDrag.x + modelViewTransform.modelToViewDeltaX(boundsDx);
            endDrag.y = endDrag.y + modelViewTransform.modelToViewDeltaY(boundsDY);
            start = endDrag;
            showTranslationDragHandlesProperty.value = true;
          }
        },
        end: () => {
          showTranslationDragHandlesProperty.value = false;
          occlusionHandler(this);
        }
      });
      laserPointerNode.addInputListener(translationListener);

      // Listeners to enable/disable the translation dragHandles
      const translationOverListener = {
        enter: () => {
          showTranslationDragHandlesProperty.value = !showRotationDragHandlesProperty.value;
        },
        exit: () => {
          showTranslationDragHandlesProperty.value = false;
        }
      };
      laserPointerNode.addInputListener(translationOverListener);
      const isTranslationEnabledProperty = new BooleanProperty(true, {
        tandem: options.tandem.createTandem('isTranslationEnabledProperty'),
        phetioDocumentation: 'This Property determines whether the laser can be translated, in the "Prisms" screen only. ' + 'A value of false means the laser cannot be translated, though it may still be rotatable.'
      });
      isTranslationEnabledProperty.lazyLink(isEnabled => {
        if (isEnabled) {
          laserPointerNode.addInputListener(translationListener);
          laserPointerNode.addInputListener(translationOverListener);
        } else {
          laserPointerNode.removeInputListener(translationListener);
          laserPointerNode.removeInputListener(translationOverListener);
        }
      });
    }
    const rotationListener = new DragListener({
      start: () => {
        showTranslationDragHandlesProperty.value = false;
        overCountProperty.value++;
      },
      drag: event => {
        const coordinateFrame = this.parents[0];
        const laserAnglebeforeRotate = laser.getAngle();
        const localLaserPosition = coordinateFrame.globalToLocalPoint(event.pointer.point);
        const angle = Math.atan2(modelViewTransform.viewToModelY(localLaserPosition.y) - laser.pivotProperty.value.y, modelViewTransform.viewToModelX(localLaserPosition.x) - laser.pivotProperty.value.x);
        let laserAngleAfterClamp = clampDragAngle(angle);

        // prevent laser from going to 90 degrees when in wave mode, should go until laser bumps into edge.
        const pastMaxAngle = laserAngleAfterClamp > BendingLightConstants.MAX_ANGLE_IN_WAVE_MODE;
        if (laser.waveProperty.value && pastMaxAngle && laser.topLeftQuadrant) {
          laserAngleAfterClamp = BendingLightConstants.MAX_ANGLE_IN_WAVE_MODE;
        }
        laser.setAngle(laserAngleAfterClamp);
        const laserNodeDragBounds = dragBoundsProperty.value.erodedXY(lightImageHeight / 2, lightImageHeight / 2);
        const laserDragBoundsInModelValues = modelViewTransform.viewToModelBounds(laserNodeDragBounds);
        if (!laserDragBoundsInModelValues.containsPoint(laser.emissionPointProperty.value)) {
          laser.setAngle(laserAnglebeforeRotate);
        }
        showTranslationDragHandlesProperty.value = false;
        showRotationDragHandlesProperty.value = true;
      },
      end: () => {
        overCountProperty.value--;
      }
    });
    rotationTarget.addInputListener(rotationListener);

    // Listeners to enable/disable the rotation dragHandles
    const rotationOverListener = {
      enter: () => {
        overCountProperty.value++;
      },
      exit: () => {
        overCountProperty.value--;
      }
    };
    rotationTarget.addInputListener(rotationOverListener);
    const isRotationEnabledProperty = new BooleanProperty(true, {
      tandem: options.tandem.createTandem('isRotationEnabledProperty'),
      phetioDocumentation: 'This Property determines whether the laser can be rotated.  On the "Intro" and "More Tools" ' + 'screens, a value of false renders the laser unmovable. On the "Prisms" screen, it hides ' + 'the rotation knob on the back of the laser and makes it non-rotatable (though it may still ' + 'be translatable).'
    });
    isRotationEnabledProperty.lazyLink(isEnabled => {
      if (isEnabled) {
        rotationTarget.addInputListener(rotationListener);
        rotationTarget.addInputListener(rotationOverListener);
      } else {
        rotationTarget.removeInputListener(rotationListener);
        rotationTarget.removeInputListener(rotationOverListener);
      }
      if (knobImage) {
        knobImage.visible = isEnabled;
      }
    });

    // update the laser position
    laser.emissionPointProperty.link(newEmissionPoint => {
      const emissionPointX = modelViewTransform.modelToViewX(newEmissionPoint.x);
      const emissionPointY = modelViewTransform.modelToViewY(newEmissionPoint.y);
      this.setTranslation(emissionPointX, emissionPointY);
      this.setRotation(-laser.getAngle());
      this.translate(0, -lightImageHeight / 2);
    });
    this.laser = laser;
    this.modelViewTransform = modelViewTransform;
  }

  /**
   * Called from the occlusion handler.  Translates the view by the specified amount by translating the corresponding
   * model
   */
  translateViewXY(x, y) {
    const delta = this.modelViewTransform.viewToModelDeltaXY(x, y);
    this.laser.translate(delta.x, delta.y);
  }
}
bendingLight.register('LaserNode', LaserNode);
export default LaserNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJQcm9wZXJ0eSIsIkRpbWVuc2lvbjIiLCJWZWN0b3IyIiwibWVyZ2UiLCJMYXNlclBvaW50ZXJOb2RlIiwiRHJhZ0xpc3RlbmVyIiwiSW1hZ2UiLCJOb2RlIiwiYmVuZGluZ0xpZ2h0IiwiQmVuZGluZ0xpZ2h0Q29uc3RhbnRzIiwia25vYl9wbmciLCJvcHRpb25pemUiLCJMYXNlck5vZGUiLCJjb25zdHJ1Y3RvciIsIm1vZGVsVmlld1RyYW5zZm9ybSIsImxhc2VyIiwic2hvd1JvdGF0aW9uRHJhZ0hhbmRsZXNQcm9wZXJ0eSIsInNob3dUcmFuc2xhdGlvbkRyYWdIYW5kbGVzUHJvcGVydHkiLCJjbGFtcERyYWdBbmdsZSIsImhhc0tub2IiLCJkcmFnQm91bmRzUHJvcGVydHkiLCJvY2NsdXNpb25IYW5kbGVyIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImxhc2VyUG9pbnRlck5vZGUiLCJvblByb3BlcnR5IiwiYm9keVNpemUiLCJub3p6bGVTaXplIiwiYnV0dG9uUmFkaXVzIiwiYnV0dG9uWE1hcmdpbiIsImJ1dHRvbllNYXJnaW4iLCJjb3JuZXJSYWRpdXMiLCJidXR0b25Ub3VjaEFyZWFEaWxhdGlvbiIsImdldEJ1dHRvbkxvY2F0aW9uIiwiYm9keU5vZGUiLCJyaWdodENlbnRlciIsImJsZW5kIiwiY2VudGVyIiwia25vYkltYWdlIiwic2NhbGUiLCJsZWZ0Q2VudGVyIiwidG91Y2hBcmVhIiwibG9jYWxCb3VuZHMiLCJkaWxhdGVkWFkiLCJzaGlmdGVkWCIsImFkZENoaWxkIiwiYm91bmRzIiwiZGlsYXRlZCIsInRyYW5zbGF0ZSIsIndpZHRoIiwiaGVpZ2h0Iiwicm90YXRpb25UYXJnZXQiLCJvdmVyQ291bnRQcm9wZXJ0eSIsImxpbmsiLCJvdmVyQ291bnQiLCJzZXQiLCJjdXJzb3IiLCJsYXNlckltYWdlV2lkdGgiLCJyb3RhdGVBcm91bmQiLCJnZXRDZW50ZXIiLCJNYXRoIiwiUEkiLCJsaWdodEltYWdlSGVpZ2h0IiwiZ2V0SGVpZ2h0IiwiZW1pc3Npb25Qb2ludEVuZFBvc2l0aW9uIiwiZHJhZ0JvdW5kcyIsImVtaXNzaW9uUG9pbnRQcm9wZXJ0eSIsInZhbHVlIiwiZXJvZGVkIiwiZXJvZGVkWFkiLCJuZXdFbWlzc2lvblBvaW50Iiwidmlld1RvTW9kZWxCb3VuZHMiLCJnZXRDbG9zZXN0UG9pbnQiLCJ4IiwieSIsImRlbHRhIiwibWludXMiLCJzdGFydCIsInRyYW5zbGF0aW9uTGlzdGVuZXIiLCJldmVudCIsImdsb2JhbFRvUGFyZW50UG9pbnQiLCJwb2ludGVyIiwicG9pbnQiLCJkcmFnIiwibGFzZXJOb2RlRHJhZ0JvdW5kcyIsImxhc2VyRHJhZ0JvdW5kc0luTW9kZWxWYWx1ZXMiLCJlbmREcmFnIiwiZGVsdGFYIiwidmlld1RvTW9kZWxEZWx0YVgiLCJkZWx0YVkiLCJ2aWV3VG9Nb2RlbERlbHRhWSIsInNldFhZIiwiZW1pc3Npb25Qb2ludEVuZFBvc2l0aW9uSW5Cb3VuZHMiLCJjbG9zZXN0UG9pbnRUbyIsInRyYW5zbGF0ZVgiLCJ0cmFuc2xhdGVZIiwiYm91bmRzRHgiLCJib3VuZHNEWSIsIm1vZGVsVG9WaWV3RGVsdGFYIiwibW9kZWxUb1ZpZXdEZWx0YVkiLCJlbmQiLCJhZGRJbnB1dExpc3RlbmVyIiwidHJhbnNsYXRpb25PdmVyTGlzdGVuZXIiLCJlbnRlciIsImV4aXQiLCJpc1RyYW5zbGF0aW9uRW5hYmxlZFByb3BlcnR5IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsImxhenlMaW5rIiwiaXNFbmFibGVkIiwicmVtb3ZlSW5wdXRMaXN0ZW5lciIsInJvdGF0aW9uTGlzdGVuZXIiLCJjb29yZGluYXRlRnJhbWUiLCJwYXJlbnRzIiwibGFzZXJBbmdsZWJlZm9yZVJvdGF0ZSIsImdldEFuZ2xlIiwibG9jYWxMYXNlclBvc2l0aW9uIiwiZ2xvYmFsVG9Mb2NhbFBvaW50IiwiYW5nbGUiLCJhdGFuMiIsInZpZXdUb01vZGVsWSIsInBpdm90UHJvcGVydHkiLCJ2aWV3VG9Nb2RlbFgiLCJsYXNlckFuZ2xlQWZ0ZXJDbGFtcCIsInBhc3RNYXhBbmdsZSIsIk1BWF9BTkdMRV9JTl9XQVZFX01PREUiLCJ3YXZlUHJvcGVydHkiLCJ0b3BMZWZ0UXVhZHJhbnQiLCJzZXRBbmdsZSIsImNvbnRhaW5zUG9pbnQiLCJyb3RhdGlvbk92ZXJMaXN0ZW5lciIsImlzUm90YXRpb25FbmFibGVkUHJvcGVydHkiLCJ2aXNpYmxlIiwiZW1pc3Npb25Qb2ludFgiLCJtb2RlbFRvVmlld1giLCJlbWlzc2lvblBvaW50WSIsIm1vZGVsVG9WaWV3WSIsInNldFRyYW5zbGF0aW9uIiwic2V0Um90YXRpb24iLCJ0cmFuc2xhdGVWaWV3WFkiLCJ2aWV3VG9Nb2RlbERlbHRhWFkiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkxhc2VyTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBOb2RlIGZvciBkcmF3aW5nIHRoZSBsYXNlciBpdHNlbGYsIGluY2x1ZGluZyBhbiBvbi9vZmYgYnV0dG9uIGFuZCBhYmlsaXR5IHRvIHJvdGF0ZS90cmFuc2xhdGUuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgQ2hhbmRyYXNoZWthciBCZW1hZ29uaSAoQWN0dWFsIENvbmNlcHRzKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBEaW1lbnNpb24yIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9EaW1lbnNpb24yLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IExhc2VyUG9pbnRlck5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL0xhc2VyUG9pbnRlck5vZGUuanMnO1xyXG5pbXBvcnQgeyBEcmFnTGlzdGVuZXIsIEltYWdlLCBOb2RlLCBTY2VuZXJ5RXZlbnQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgYmVuZGluZ0xpZ2h0IGZyb20gJy4uLy4uL2JlbmRpbmdMaWdodC5qcyc7XHJcbmltcG9ydCBCZW5kaW5nTGlnaHRDb25zdGFudHMgZnJvbSAnLi4vQmVuZGluZ0xpZ2h0Q29uc3RhbnRzLmpzJztcclxuaW1wb3J0IGtub2JfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9rbm9iX3BuZy5qcyc7XHJcbmltcG9ydCBNb2RlbFZpZXdUcmFuc2Zvcm0yIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdmlldy9Nb2RlbFZpZXdUcmFuc2Zvcm0yLmpzJztcclxuaW1wb3J0IExhc2VyIGZyb20gJy4uL21vZGVsL0xhc2VyLmpzJztcclxuaW1wb3J0IEJvdW5kczIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0JvdW5kczIuanMnO1xyXG5pbXBvcnQgeyBQaGV0aW9PYmplY3RPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1BoZXRpb09iamVjdC5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IEVtcHR5U2VsZk9wdGlvbnM7XHJcbnR5cGUgUGFyZW50T3B0aW9ucyA9IFBpY2tSZXF1aXJlZDxQaGV0aW9PYmplY3RPcHRpb25zLCAndGFuZGVtJz47XHJcbnR5cGUgTGFzZXJOb2RlT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgUGFyZW50T3B0aW9ucztcclxuXHJcbmNsYXNzIExhc2VyTm9kZSBleHRlbmRzIE5vZGUge1xyXG4gIHB1YmxpYyBsYXNlckltYWdlV2lkdGg6IG51bWJlcjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGxhc2VyOiBMYXNlcjtcclxuICBwcml2YXRlIHJlYWRvbmx5IG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMjtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIG1vZGVsVmlld1RyYW5zZm9ybSAtIFRyYW5zZm9ybSBiZXR3ZWVuIG1vZGVsIGFuZCB2aWV3IGNvb3JkaW5hdGUgZnJhbWVzXHJcbiAgICogQHBhcmFtIGxhc2VyIC0gbW9kZWwgZm9yIHRoZSBsYXNlclxyXG4gICAqIEBwYXJhbSBzaG93Um90YXRpb25EcmFnSGFuZGxlc1Byb3BlcnR5IC0gdG8gc2hvdyBsYXNlciBub2RlIHJvdGF0ZSBhcnJvd3NcclxuICAgKiBAcGFyYW0gc2hvd1RyYW5zbGF0aW9uRHJhZ0hhbmRsZXNQcm9wZXJ0eSAtIHRvIHNob3cgbGFzZXIgbm9kZSBkcmFnIGFycm93c1xyXG4gICAqIEBwYXJhbSBjbGFtcERyYWdBbmdsZSAtIGZ1bmN0aW9uIHRoYXQgbGltaXRzIHRoZSBhbmdsZSBvZiBsYXNlciB0byBpdHMgYm91bmRzXHJcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGluZyB0aGUgbGFzZXJcclxuICAgKiBAcGFyYW0gaGFzS25vYiAtIHRydWUgLSBhZGQgYSBrbm9iLCBtYWtlIHRoZSBsYXNlciByb3RhdGUgYnkgZHJhZ2dpbmcgdGhlIGtub2IsIHRyYW5zbGF0ZSBieSBkcmFnZ2luZyB0aGUgbGFzZXIgYm9keVxyXG4gICAqICAgICAgICAgICAgICAgICAgZmFsc2UgLSBkb24ndCBhZGQgYSBrbm9iLCBtYWtlIHRoZSBsYXNlciByb3RhdGUgYnkgZHJhZ2dpbmcgdGhlIGxhc2VyIGJvZHksIGRvbid0IHN1cHBvcnQgdHJhbnNsYXRpb25cclxuICAgKiBAcGFyYW0gZHJhZ0JvdW5kc1Byb3BlcnR5IC0gYm91bmRzIHRoYXQgZGVmaW5lIHdoZXJlIHRoZSBsYXNlciBtYXkgYmUgZHJhZ2dlZFxyXG4gICAqIEBwYXJhbSBvY2NsdXNpb25IYW5kbGVyIC0gZnVuY3Rpb24gdGhhdCB3aWxsIG1vdmUgdGhlIGxhc2VyIG91dCBmcm9tIGJlaGluZCBhIGNvbnRyb2wgcGFuZWwgaWYgZHJvcHBlZFxyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVyZVxyXG4gICAqIEBwYXJhbSBbcHJvdmlkZWRPcHRpb25zP11cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMiwgbGFzZXI6IExhc2VyLCBzaG93Um90YXRpb25EcmFnSGFuZGxlc1Byb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPiwgc2hvd1RyYW5zbGF0aW9uRHJhZ0hhbmRsZXNQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBjbGFtcERyYWdBbmdsZTogKCBuOiBudW1iZXIgKSA9PiBudW1iZXIsIGhhc0tub2I6IGJvb2xlYW4sIGRyYWdCb3VuZHNQcm9wZXJ0eTogUHJvcGVydHk8Qm91bmRzMj4sIG9jY2x1c2lvbkhhbmRsZXI6ICggbGFzZXJOb2RlOiBMYXNlck5vZGUgKSA9PiB2b2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWRPcHRpb25zPzogTGFzZXJOb2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPExhc2VyTm9kZU9wdGlvbnMsIFNlbGZPcHRpb25zLCBQYXJlbnRPcHRpb25zPigpKCB7fSwgcHJvdmlkZWRPcHRpb25zICk7XHJcbiAgICBjb25zdCBsYXNlclBvaW50ZXJOb2RlID0gbmV3IExhc2VyUG9pbnRlck5vZGUoIGxhc2VyLm9uUHJvcGVydHksIHtcclxuICAgICAgYm9keVNpemU6IG5ldyBEaW1lbnNpb24yKCA3MCwgMzAgKSxcclxuICAgICAgbm96emxlU2l6ZTogbmV3IERpbWVuc2lvbjIoIDEwLCAyNSApLFxyXG4gICAgICBidXR0b25SYWRpdXM6IDEyLFxyXG4gICAgICBidXR0b25YTWFyZ2luOiAyLFxyXG4gICAgICBidXR0b25ZTWFyZ2luOiAyLFxyXG4gICAgICBjb3JuZXJSYWRpdXM6IDIsXHJcbiAgICAgIGJ1dHRvblRvdWNoQXJlYURpbGF0aW9uOiA0LFxyXG4gICAgICBnZXRCdXR0b25Mb2NhdGlvbjogKCBib2R5Tm9kZTogTm9kZSApID0+IGJvZHlOb2RlLnJpZ2h0Q2VudGVyLmJsZW5kKCBib2R5Tm9kZS5jZW50ZXIsIDAuNSApXHJcbiAgICB9ICkgYXMgTm9kZTtcclxuXHJcbiAgICBjb25zdCBrbm9iSW1hZ2UgPSBoYXNLbm9iID8gKCBuZXcgSW1hZ2UoIGtub2JfcG5nLCB7XHJcbiAgICAgIHNjYWxlOiAwLjU4LFxyXG4gICAgICByaWdodENlbnRlcjogbGFzZXJQb2ludGVyTm9kZS5sZWZ0Q2VudGVyXHJcblxyXG4gICAgICAvLyBUaGlzIHdpbGwgYmUgcmVzb2x2ZWQgd2hlbiBJbWFnZSBpcyBUeXBlU2NyaXB0XHJcbiAgICB9ICkgKSA6IG51bGw7XHJcbiAgICBpZiAoIGtub2JJbWFnZSApIHtcclxuICAgICAga25vYkltYWdlLnRvdWNoQXJlYSA9IGtub2JJbWFnZS5sb2NhbEJvdW5kcy5kaWxhdGVkWFkoIDE1LCAyNyApLnNoaWZ0ZWRYKCAtMTUgKTtcclxuICAgICAgaGFzS25vYiAmJiBsYXNlclBvaW50ZXJOb2RlLmFkZENoaWxkKCBrbm9iSW1hZ2UgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBsYXNlclBvaW50ZXJOb2RlLnRvdWNoQXJlYSA9IGxhc2VyUG9pbnRlck5vZGUuYm91bmRzLmRpbGF0ZWQoIDggKS5zaGlmdGVkWCggLTggKTtcclxuICAgIH1cclxuXHJcbiAgICBsYXNlclBvaW50ZXJOb2RlLnRyYW5zbGF0ZSggbGFzZXJQb2ludGVyTm9kZS53aWR0aCwgbGFzZXJQb2ludGVyTm9kZS5oZWlnaHQgLyAyICk7XHJcblxyXG4gICAgLy8gSWYgdGhlcmUgaXMgYSBrbm9iIChcIlByaXNtc1wiIHNjcmVlbiksIGl0IGlzIHVzZWQgdG8gcm90YXRlIHRoZSBsYXNlci5cclxuICAgIC8vIElmIHRoZXJlIGlzIG5vIGtub2IgKFwiSW50cm9cIiBhbmQgXCJNb3JlIFRvb2xzXCIgc2NyZWVucyksIHRoZW4gdGhlIGxhc2VyIGlzIHJvdGF0ZWQgYnkgZHJhZ2dpbmcgdGhlIGxhc2VyIGl0c2VsZi5cclxuICAgIGNvbnN0IHJvdGF0aW9uVGFyZ2V0ID0gaGFzS25vYiA/IGtub2JJbWFnZSEgOiBsYXNlclBvaW50ZXJOb2RlO1xyXG5cclxuICAgIC8vIFdoZW4gbW91c2luZyBvdmVyIG9yIHN0YXJ0aW5nIHRvIGRyYWcgdGhlIGxhc2VyLCBpbmNyZW1lbnQgdGhlIG92ZXIgY291bnQuICBJZiBpdCBpcyBtb3JlIHRoYW4gemVyb1xyXG4gICAgLy8gdGhlbiBzaG93IHRoZSBkcmFnIGhhbmRsZXMuICBUaGlzIGVuc3VyZXMgdGhleSB3aWxsIGJlIHNob3duIHdoZW5ldmVyIGRyYWdnaW5nIG9yIG92ZXIsIGFuZCB0aGV5IHdvbid0IGZsaWNrZXJcclxuICAgIGNvbnN0IG92ZXJDb3VudFByb3BlcnR5ID0gbmV3IFByb3BlcnR5PG51bWJlcj4oIDAgKTtcclxuICAgIG92ZXJDb3VudFByb3BlcnR5LmxpbmsoIG92ZXJDb3VudCA9PiBzaG93Um90YXRpb25EcmFnSGFuZGxlc1Byb3BlcnR5LnNldCggb3ZlckNvdW50ID4gMCApICk7XHJcblxyXG4gICAgc3VwZXIoIG1lcmdlKCB7IGN1cnNvcjogJ3BvaW50ZXInIH0sIHByb3ZpZGVkT3B0aW9ucyApICk7XHJcblxyXG4gICAgLy8gKHJlYWQtb25seSksIFVzZWQgZm9yIHJhZGl1cyBhbmQgbGVuZ3RoIG9mIGRyYWcgaGFuZGxlcnNcclxuICAgIHRoaXMubGFzZXJJbWFnZVdpZHRoID0gbGFzZXJQb2ludGVyTm9kZS53aWR0aDtcclxuXHJcbiAgICAvLyBhZGQgbGFzZXIgaW1hZ2VcclxuICAgIGxhc2VyUG9pbnRlck5vZGUucm90YXRlQXJvdW5kKCBsYXNlclBvaW50ZXJOb2RlLmdldENlbnRlcigpLCBNYXRoLlBJICk7XHJcblxyXG4gICAgdGhpcy5hZGRDaGlsZCggbGFzZXJQb2ludGVyTm9kZSApO1xyXG5cclxuICAgIGNvbnN0IGxpZ2h0SW1hZ2VIZWlnaHQgPSBsYXNlclBvaW50ZXJOb2RlLmdldEhlaWdodCgpO1xyXG5cclxuICAgIC8vIHJlIHVzYWJsZSB2ZWN0b3IgdG8gYXZvaWQgdmVjdG9yIGFsbG9jYXRpb25cclxuICAgIGNvbnN0IGVtaXNzaW9uUG9pbnRFbmRQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCAwLCAwICk7XHJcblxyXG4gICAgLy8gV2hlbiB0aGUgd2luZG93IHJlc2hhcGVzLCBtYWtlIHN1cmUgdGhlIGxhc2VyIHJlbWFpbnMgaW4gdGhlIHBsYXkgYXJlYVxyXG4gICAgZHJhZ0JvdW5kc1Byb3BlcnR5LmxpbmsoIGRyYWdCb3VuZHMgPT4ge1xyXG4gICAgICBjb25zdCBjZW50ZXIgPSBsYXNlci5lbWlzc2lvblBvaW50UHJvcGVydHkudmFsdWU7XHJcbiAgICAgIGNvbnN0IGVyb2RlZCA9IGRyYWdCb3VuZHMuZXJvZGVkWFkoIGxpZ2h0SW1hZ2VIZWlnaHQgLyAyLCBsaWdodEltYWdlSGVpZ2h0IC8gMiApO1xyXG5cclxuICAgICAgY29uc3QgbmV3RW1pc3Npb25Qb2ludCA9IG1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbEJvdW5kcyggZXJvZGVkICkuZ2V0Q2xvc2VzdFBvaW50KCBjZW50ZXIueCwgY2VudGVyLnkgKTtcclxuICAgICAgY29uc3QgZGVsdGEgPSBuZXdFbWlzc2lvblBvaW50Lm1pbnVzKCBsYXNlci5lbWlzc2lvblBvaW50UHJvcGVydHkudmFsdWUgKTtcclxuICAgICAgbGFzZXIudHJhbnNsYXRlKCBkZWx0YS54LCBkZWx0YS55ICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYWRkIHRoZSBkcmFnIHJlZ2lvbiBmb3IgdHJhbnNsYXRpbmcgdGhlIGxhc2VyXHJcbiAgICBsZXQgc3RhcnQ6IFZlY3RvcjIgfCBudWxsO1xyXG5cclxuICAgIC8vIE9uIHRoZSBcIlByaXNtc1wiIHNjcmVlbiwgdGhlIGxhc2VyIGNhbiBiZSB0cmFuc2xhdGVkIGJ5IGRyYWdnaW5nIHRoZSBsYXNlciwgYW5kIHJvdGF0ZWQgYnkgZHJhZ2dpbmcgdGhlIGtub2Igb25cclxuICAgIC8vIHRoZSBiYWNrIG9mIHRoZSBsYXNlci4gIFRoaXMgcGFydCBvZiB0aGUgY29kZSBoYW5kbGVzIHRoZSB0cmFuc2xhdGlvbi5cclxuICAgIGlmICggaGFzS25vYiApIHtcclxuICAgICAgY29uc3QgdHJhbnNsYXRpb25MaXN0ZW5lciA9IG5ldyBEcmFnTGlzdGVuZXIoIHtcclxuICAgICAgICBzdGFydDogKCBldmVudDogU2NlbmVyeUV2ZW50ICkgPT4ge1xyXG4gICAgICAgICAgc3RhcnQgPSB0aGlzLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKTtcclxuICAgICAgICAgIHNob3dUcmFuc2xhdGlvbkRyYWdIYW5kbGVzUHJvcGVydHkudmFsdWUgPSB0cnVlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZHJhZzogKCBldmVudDogU2NlbmVyeUV2ZW50ICkgPT4ge1xyXG5cclxuICAgICAgICAgIGNvbnN0IGxhc2VyTm9kZURyYWdCb3VuZHMgPSBkcmFnQm91bmRzUHJvcGVydHkudmFsdWUuZXJvZGVkWFkoIGxpZ2h0SW1hZ2VIZWlnaHQgLyAyLCBsaWdodEltYWdlSGVpZ2h0IC8gMiApO1xyXG4gICAgICAgICAgY29uc3QgbGFzZXJEcmFnQm91bmRzSW5Nb2RlbFZhbHVlcyA9IG1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbEJvdW5kcyggbGFzZXJOb2RlRHJhZ0JvdW5kcyApO1xyXG5cclxuICAgICAgICAgIGNvbnN0IGVuZERyYWcgPSB0aGlzLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKTtcclxuICAgICAgICAgIGlmICggc3RhcnQgKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlbHRhWCA9IG1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbERlbHRhWCggZW5kRHJhZy54IC0gc3RhcnQueCApO1xyXG4gICAgICAgICAgICBjb25zdCBkZWx0YVkgPSBtb2RlbFZpZXdUcmFuc2Zvcm0udmlld1RvTW9kZWxEZWx0YVkoIGVuZERyYWcueSAtIHN0YXJ0LnkgKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHBvc2l0aW9uIG9mIGZpbmFsIGVtaXNzaW9uIHBvaW50IHdpdGggb3V0IGNvbnN0cmFpbmluZyB0byBib3VuZHNcclxuICAgICAgICAgICAgZW1pc3Npb25Qb2ludEVuZFBvc2l0aW9uLnNldFhZKCBsYXNlci5lbWlzc2lvblBvaW50UHJvcGVydHkudmFsdWUueCArIGRlbHRhWCwgbGFzZXIuZW1pc3Npb25Qb2ludFByb3BlcnR5LnZhbHVlLnkgKyBkZWx0YVkgKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHBvc2l0aW9uIG9mIGZpbmFsIGVtaXNzaW9uIHBvaW50IHdpdGggY29uc3RyYWluaW5nIHRvIGJvdW5kc1xyXG4gICAgICAgICAgICBjb25zdCBlbWlzc2lvblBvaW50RW5kUG9zaXRpb25JbkJvdW5kcyA9IGxhc2VyRHJhZ0JvdW5kc0luTW9kZWxWYWx1ZXMuY2xvc2VzdFBvaW50VG8oIGVtaXNzaW9uUG9pbnRFbmRQb3NpdGlvbiApO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdHJhbnNsYXRlWCA9IGVtaXNzaW9uUG9pbnRFbmRQb3NpdGlvbkluQm91bmRzLnggLSBsYXNlci5lbWlzc2lvblBvaW50UHJvcGVydHkudmFsdWUueDtcclxuICAgICAgICAgICAgY29uc3QgdHJhbnNsYXRlWSA9IGVtaXNzaW9uUG9pbnRFbmRQb3NpdGlvbkluQm91bmRzLnkgLSBsYXNlci5lbWlzc2lvblBvaW50UHJvcGVydHkudmFsdWUueTtcclxuICAgICAgICAgICAgbGFzZXIudHJhbnNsYXRlKCB0cmFuc2xhdGVYLCB0cmFuc2xhdGVZICk7XHJcblxyXG4gICAgICAgICAgICAvLyBTdG9yZSB0aGUgcG9zaXRpb24gb2YgY2F1Z2h0IHBvaW50IGFmdGVyIHRyYW5zbGF0aW5nLiBDYW4gYmUgb2J0YWluZWQgYnkgYWRkaW5nIGRpc3RhbmNlIGJldHdlZW4gZW1pc3Npb25cclxuICAgICAgICAgICAgLy8gcG9pbnQgYW5kIGRyYWcgcG9pbnQgKGVuZCAtIGVtaXNzaW9uUG9pbnRFbmRQb3NpdGlvbikgdG8gZW1pc3Npb24gcG9pbnQgKGVtaXNzaW9uUG9pbnRFbmRQb3NpdGlvbkluQm91bmRzKVxyXG4gICAgICAgICAgICAvLyBhZnRlciB0cmFuc2xhdGluZy5cclxuICAgICAgICAgICAgY29uc3QgYm91bmRzRHggPSBlbWlzc2lvblBvaW50RW5kUG9zaXRpb25JbkJvdW5kcy54IC0gZW1pc3Npb25Qb2ludEVuZFBvc2l0aW9uLng7XHJcbiAgICAgICAgICAgIGNvbnN0IGJvdW5kc0RZID0gZW1pc3Npb25Qb2ludEVuZFBvc2l0aW9uSW5Cb3VuZHMueSAtIGVtaXNzaW9uUG9pbnRFbmRQb3NpdGlvbi55O1xyXG4gICAgICAgICAgICBlbmREcmFnLnggPSBlbmREcmFnLnggKyBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YVgoIGJvdW5kc0R4ICk7XHJcbiAgICAgICAgICAgIGVuZERyYWcueSA9IGVuZERyYWcueSArIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWSggYm91bmRzRFkgKTtcclxuXHJcbiAgICAgICAgICAgIHN0YXJ0ID0gZW5kRHJhZztcclxuICAgICAgICAgICAgc2hvd1RyYW5zbGF0aW9uRHJhZ0hhbmRsZXNQcm9wZXJ0eS52YWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbmQ6ICgpID0+IHtcclxuICAgICAgICAgIHNob3dUcmFuc2xhdGlvbkRyYWdIYW5kbGVzUHJvcGVydHkudmFsdWUgPSBmYWxzZTtcclxuICAgICAgICAgIG9jY2x1c2lvbkhhbmRsZXIoIHRoaXMgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgICAgbGFzZXJQb2ludGVyTm9kZS5hZGRJbnB1dExpc3RlbmVyKCB0cmFuc2xhdGlvbkxpc3RlbmVyICk7XHJcblxyXG4gICAgICAvLyBMaXN0ZW5lcnMgdG8gZW5hYmxlL2Rpc2FibGUgdGhlIHRyYW5zbGF0aW9uIGRyYWdIYW5kbGVzXHJcbiAgICAgIGNvbnN0IHRyYW5zbGF0aW9uT3Zlckxpc3RlbmVyID0ge1xyXG4gICAgICAgIGVudGVyOiAoKSA9PiB7XHJcbiAgICAgICAgICBzaG93VHJhbnNsYXRpb25EcmFnSGFuZGxlc1Byb3BlcnR5LnZhbHVlID0gIXNob3dSb3RhdGlvbkRyYWdIYW5kbGVzUHJvcGVydHkudmFsdWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBleGl0OiAoKSA9PiB7XHJcbiAgICAgICAgICBzaG93VHJhbnNsYXRpb25EcmFnSGFuZGxlc1Byb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBsYXNlclBvaW50ZXJOb2RlLmFkZElucHV0TGlzdGVuZXIoIHRyYW5zbGF0aW9uT3Zlckxpc3RlbmVyICk7XHJcblxyXG4gICAgICBjb25zdCBpc1RyYW5zbGF0aW9uRW5hYmxlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggdHJ1ZSwge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnaXNUcmFuc2xhdGlvbkVuYWJsZWRQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnVGhpcyBQcm9wZXJ0eSBkZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGxhc2VyIGNhbiBiZSB0cmFuc2xhdGVkLCBpbiB0aGUgXCJQcmlzbXNcIiBzY3JlZW4gb25seS4gJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0EgdmFsdWUgb2YgZmFsc2UgbWVhbnMgdGhlIGxhc2VyIGNhbm5vdCBiZSB0cmFuc2xhdGVkLCB0aG91Z2ggaXQgbWF5IHN0aWxsIGJlIHJvdGF0YWJsZS4nXHJcbiAgICAgIH0gKTtcclxuICAgICAgaXNUcmFuc2xhdGlvbkVuYWJsZWRQcm9wZXJ0eS5sYXp5TGluayggKCBpc0VuYWJsZWQ6IGJvb2xlYW4gKSA9PiB7XHJcbiAgICAgICAgaWYgKCBpc0VuYWJsZWQgKSB7XHJcbiAgICAgICAgICBsYXNlclBvaW50ZXJOb2RlLmFkZElucHV0TGlzdGVuZXIoIHRyYW5zbGF0aW9uTGlzdGVuZXIgKTtcclxuICAgICAgICAgIGxhc2VyUG9pbnRlck5vZGUuYWRkSW5wdXRMaXN0ZW5lciggdHJhbnNsYXRpb25PdmVyTGlzdGVuZXIgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBsYXNlclBvaW50ZXJOb2RlLnJlbW92ZUlucHV0TGlzdGVuZXIoIHRyYW5zbGF0aW9uTGlzdGVuZXIgKTtcclxuICAgICAgICAgIGxhc2VyUG9pbnRlck5vZGUucmVtb3ZlSW5wdXRMaXN0ZW5lciggdHJhbnNsYXRpb25PdmVyTGlzdGVuZXIgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByb3RhdGlvbkxpc3RlbmVyID0gbmV3IERyYWdMaXN0ZW5lcigge1xyXG4gICAgICBzdGFydDogKCkgPT4ge1xyXG4gICAgICAgIHNob3dUcmFuc2xhdGlvbkRyYWdIYW5kbGVzUHJvcGVydHkudmFsdWUgPSBmYWxzZTtcclxuICAgICAgICBvdmVyQ291bnRQcm9wZXJ0eS52YWx1ZSsrO1xyXG4gICAgICB9LFxyXG4gICAgICBkcmFnOiAoIGV2ZW50OiBTY2VuZXJ5RXZlbnQgKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY29vcmRpbmF0ZUZyYW1lID0gdGhpcy5wYXJlbnRzWyAwIF07XHJcbiAgICAgICAgY29uc3QgbGFzZXJBbmdsZWJlZm9yZVJvdGF0ZSA9IGxhc2VyLmdldEFuZ2xlKCk7XHJcbiAgICAgICAgY29uc3QgbG9jYWxMYXNlclBvc2l0aW9uID0gY29vcmRpbmF0ZUZyYW1lLmdsb2JhbFRvTG9jYWxQb2ludCggZXZlbnQucG9pbnRlci5wb2ludCApO1xyXG4gICAgICAgIGNvbnN0IGFuZ2xlID0gTWF0aC5hdGFuMiggbW9kZWxWaWV3VHJhbnNmb3JtLnZpZXdUb01vZGVsWSggbG9jYWxMYXNlclBvc2l0aW9uLnkgKSAtIGxhc2VyLnBpdm90UHJvcGVydHkudmFsdWUueSxcclxuICAgICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbFgoIGxvY2FsTGFzZXJQb3NpdGlvbi54ICkgLSBsYXNlci5waXZvdFByb3BlcnR5LnZhbHVlLnggKTtcclxuICAgICAgICBsZXQgbGFzZXJBbmdsZUFmdGVyQ2xhbXAgPSBjbGFtcERyYWdBbmdsZSggYW5nbGUgKTtcclxuXHJcbiAgICAgICAgLy8gcHJldmVudCBsYXNlciBmcm9tIGdvaW5nIHRvIDkwIGRlZ3JlZXMgd2hlbiBpbiB3YXZlIG1vZGUsIHNob3VsZCBnbyB1bnRpbCBsYXNlciBidW1wcyBpbnRvIGVkZ2UuXHJcbiAgICAgICAgY29uc3QgcGFzdE1heEFuZ2xlID0gbGFzZXJBbmdsZUFmdGVyQ2xhbXAgPiBCZW5kaW5nTGlnaHRDb25zdGFudHMuTUFYX0FOR0xFX0lOX1dBVkVfTU9ERTtcclxuICAgICAgICBpZiAoIGxhc2VyLndhdmVQcm9wZXJ0eS52YWx1ZSAmJiBwYXN0TWF4QW5nbGUgJiYgbGFzZXIudG9wTGVmdFF1YWRyYW50ICkge1xyXG4gICAgICAgICAgbGFzZXJBbmdsZUFmdGVyQ2xhbXAgPSBCZW5kaW5nTGlnaHRDb25zdGFudHMuTUFYX0FOR0xFX0lOX1dBVkVfTU9ERTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGFzZXIuc2V0QW5nbGUoIGxhc2VyQW5nbGVBZnRlckNsYW1wICk7XHJcblxyXG4gICAgICAgIGNvbnN0IGxhc2VyTm9kZURyYWdCb3VuZHMgPSBkcmFnQm91bmRzUHJvcGVydHkudmFsdWUuZXJvZGVkWFkoIGxpZ2h0SW1hZ2VIZWlnaHQgLyAyLCBsaWdodEltYWdlSGVpZ2h0IC8gMiApO1xyXG4gICAgICAgIGNvbnN0IGxhc2VyRHJhZ0JvdW5kc0luTW9kZWxWYWx1ZXMgPSBtb2RlbFZpZXdUcmFuc2Zvcm0udmlld1RvTW9kZWxCb3VuZHMoIGxhc2VyTm9kZURyYWdCb3VuZHMgKTtcclxuICAgICAgICBpZiAoICFsYXNlckRyYWdCb3VuZHNJbk1vZGVsVmFsdWVzLmNvbnRhaW5zUG9pbnQoIGxhc2VyLmVtaXNzaW9uUG9pbnRQcm9wZXJ0eS52YWx1ZSApICkge1xyXG4gICAgICAgICAgbGFzZXIuc2V0QW5nbGUoIGxhc2VyQW5nbGViZWZvcmVSb3RhdGUgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2hvd1RyYW5zbGF0aW9uRHJhZ0hhbmRsZXNQcm9wZXJ0eS52YWx1ZSA9IGZhbHNlO1xyXG4gICAgICAgIHNob3dSb3RhdGlvbkRyYWdIYW5kbGVzUHJvcGVydHkudmFsdWUgPSB0cnVlO1xyXG4gICAgICB9LFxyXG4gICAgICBlbmQ6ICgpID0+IHtcclxuICAgICAgICBvdmVyQ291bnRQcm9wZXJ0eS52YWx1ZS0tO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICByb3RhdGlvblRhcmdldC5hZGRJbnB1dExpc3RlbmVyKCByb3RhdGlvbkxpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gTGlzdGVuZXJzIHRvIGVuYWJsZS9kaXNhYmxlIHRoZSByb3RhdGlvbiBkcmFnSGFuZGxlc1xyXG4gICAgY29uc3Qgcm90YXRpb25PdmVyTGlzdGVuZXIgPSB7XHJcbiAgICAgIGVudGVyOiAoKSA9PiB7XHJcbiAgICAgICAgb3ZlckNvdW50UHJvcGVydHkudmFsdWUrKztcclxuICAgICAgfSxcclxuICAgICAgZXhpdDogKCkgPT4ge1xyXG4gICAgICAgIG92ZXJDb3VudFByb3BlcnR5LnZhbHVlLS07XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICByb3RhdGlvblRhcmdldC5hZGRJbnB1dExpc3RlbmVyKCByb3RhdGlvbk92ZXJMaXN0ZW5lciApO1xyXG5cclxuICAgIGNvbnN0IGlzUm90YXRpb25FbmFibGVkUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnaXNSb3RhdGlvbkVuYWJsZWRQcm9wZXJ0eScgKSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ1RoaXMgUHJvcGVydHkgZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBsYXNlciBjYW4gYmUgcm90YXRlZC4gIE9uIHRoZSBcIkludHJvXCIgYW5kIFwiTW9yZSBUb29sc1wiICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAnc2NyZWVucywgYSB2YWx1ZSBvZiBmYWxzZSByZW5kZXJzIHRoZSBsYXNlciB1bm1vdmFibGUuIE9uIHRoZSBcIlByaXNtc1wiIHNjcmVlbiwgaXQgaGlkZXMgJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICd0aGUgcm90YXRpb24ga25vYiBvbiB0aGUgYmFjayBvZiB0aGUgbGFzZXIgYW5kIG1ha2VzIGl0IG5vbi1yb3RhdGFibGUgKHRob3VnaCBpdCBtYXkgc3RpbGwgJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICdiZSB0cmFuc2xhdGFibGUpLidcclxuICAgIH0gKTtcclxuICAgIGlzUm90YXRpb25FbmFibGVkUHJvcGVydHkubGF6eUxpbmsoICggaXNFbmFibGVkOiBib29sZWFuICkgPT4ge1xyXG4gICAgICBpZiAoIGlzRW5hYmxlZCApIHtcclxuICAgICAgICByb3RhdGlvblRhcmdldC5hZGRJbnB1dExpc3RlbmVyKCByb3RhdGlvbkxpc3RlbmVyICk7XHJcbiAgICAgICAgcm90YXRpb25UYXJnZXQuYWRkSW5wdXRMaXN0ZW5lciggcm90YXRpb25PdmVyTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByb3RhdGlvblRhcmdldC5yZW1vdmVJbnB1dExpc3RlbmVyKCByb3RhdGlvbkxpc3RlbmVyICk7XHJcbiAgICAgICAgcm90YXRpb25UYXJnZXQucmVtb3ZlSW5wdXRMaXN0ZW5lciggcm90YXRpb25PdmVyTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIGtub2JJbWFnZSApIHtcclxuICAgICAgICBrbm9iSW1hZ2UudmlzaWJsZSA9IGlzRW5hYmxlZDtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSB0aGUgbGFzZXIgcG9zaXRpb25cclxuICAgIGxhc2VyLmVtaXNzaW9uUG9pbnRQcm9wZXJ0eS5saW5rKCBuZXdFbWlzc2lvblBvaW50ID0+IHtcclxuICAgICAgY29uc3QgZW1pc3Npb25Qb2ludFggPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCBuZXdFbWlzc2lvblBvaW50LnggKTtcclxuICAgICAgY29uc3QgZW1pc3Npb25Qb2ludFkgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdZKCBuZXdFbWlzc2lvblBvaW50LnkgKTtcclxuICAgICAgdGhpcy5zZXRUcmFuc2xhdGlvbiggZW1pc3Npb25Qb2ludFgsIGVtaXNzaW9uUG9pbnRZICk7XHJcbiAgICAgIHRoaXMuc2V0Um90YXRpb24oIC1sYXNlci5nZXRBbmdsZSgpICk7XHJcbiAgICAgIHRoaXMudHJhbnNsYXRlKCAwLCAtbGlnaHRJbWFnZUhlaWdodCAvIDIgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmxhc2VyID0gbGFzZXI7XHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSA9IG1vZGVsVmlld1RyYW5zZm9ybTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGxlZCBmcm9tIHRoZSBvY2NsdXNpb24gaGFuZGxlci4gIFRyYW5zbGF0ZXMgdGhlIHZpZXcgYnkgdGhlIHNwZWNpZmllZCBhbW91bnQgYnkgdHJhbnNsYXRpbmcgdGhlIGNvcnJlc3BvbmRpbmdcclxuICAgKiBtb2RlbFxyXG4gICAqL1xyXG4gIHByaXZhdGUgdHJhbnNsYXRlVmlld1hZKCB4OiBudW1iZXIsIHk6IG51bWJlciApOiB2b2lkIHtcclxuICAgIGNvbnN0IGRlbHRhID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0udmlld1RvTW9kZWxEZWx0YVhZKCB4LCB5ICk7XHJcbiAgICB0aGlzLmxhc2VyLnRyYW5zbGF0ZSggZGVsdGEueCwgZGVsdGEueSApO1xyXG4gIH1cclxufVxyXG5cclxuYmVuZGluZ0xpZ2h0LnJlZ2lzdGVyKCAnTGFzZXJOb2RlJywgTGFzZXJOb2RlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBMYXNlck5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxRQUFRLE1BQU0saUNBQWlDO0FBQ3RELE9BQU9DLFVBQVUsTUFBTSxrQ0FBa0M7QUFDekQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxLQUFLLE1BQU0sbUNBQW1DO0FBQ3JELE9BQU9DLGdCQUFnQixNQUFNLGlEQUFpRDtBQUM5RSxTQUFTQyxZQUFZLEVBQUVDLEtBQUssRUFBRUMsSUFBSSxRQUFzQixtQ0FBbUM7QUFDM0YsT0FBT0MsWUFBWSxNQUFNLHVCQUF1QjtBQUNoRCxPQUFPQyxxQkFBcUIsTUFBTSw2QkFBNkI7QUFDL0Qs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