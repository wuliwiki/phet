// Copyright 2015-2022, University of Colorado Boulder

/**
 * In order to support white light, we need to perform additive color mixing (not subtractive,
 * as is the default when drawing transparent colors on top of each other in Java).
 * <p/>
 * This class uses the Bresenham line drawing algorithm (with a stroke thickness of 2) to determine which pixels each
 * ray inhabits. When multiple rays hit the same pixel, their RGB values are added. If any of the RG or B values is
 * greater than the maximum of 255, then RGB values are scaled down and the leftover part is put into the "intensity"
 * value (which is the sum of the ray intensities). The intensity is converted to a transparency value according to
 * alpha = sqrt(intensity/3), which is also clamped to be between 0 and 255.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Chandrashekar Bemagoni (Actual Concepts)
 */

import Bounds2 from '../../../../dot/js/Bounds2.js';
import Utils from '../../../../dot/js/Utils.js';
import VisibleColor from '../../../../scenery-phet/js/VisibleColor.js';
import { CanvasNode } from '../../../../scenery/js/imports.js';
import bendingLight from '../../bendingLight.js';
import BendingLightConstants from '../../common/BendingLightConstants.js';
class WhiteLightCanvasNode extends CanvasNode {
  /**
   * @param modelViewTransform - converts between model and view co-ordinates
   * @param stageWidth - width of the dev area
   * @param stageHeight - height of the dev area
   * @param whiteLightRays - array of white light rays
   * @param environmentMediumProperty
   * @param mediumColorFactory - for creating colors from index of refraction
   */
  constructor(modelViewTransform, stageWidth, stageHeight, whiteLightRays, environmentMediumProperty, mediumColorFactory) {
    super({
      canvasBounds: new Bounds2(0, 0, stageWidth, stageHeight)
    });
    this.colorCSS = null;
    this.invalidatePaint();
    this.modelViewTransform = modelViewTransform;
    this.whiteLightRays = whiteLightRays;
    this.environmentMediumProperty = environmentMediumProperty;
    const update = () => {
      const a = environmentMediumProperty.value.substance.indexOfRefractionForRedLight;
      this.colorCSS = mediumColorFactory.getColor(a).toCSS();
      this.invalidatePaint();
    };
    mediumColorFactory.lightTypeProperty.link(update);
    environmentMediumProperty.link(update);
  }

  /**
   * Paints the particles on the canvas node.
   */
  paintCanvas(context) {
    context.lineWidth = 3;
    context.globalCompositeOperation = 'source-over';

    // @ts-expect-error
    context.fillStyle = this.colorCSS;
    context.save();
    context.setTransform(1, 0, 0, 1, 0, 0);
    context.fillRect(0, 0, context.canvas.width, context.canvas.height);
    context.restore();

    // Have to save the previous globalCompositeOperation so it doesn't leak to the SingleColorLightCanvasNode on iOS
    // see #267
    context.save();

    // "Screen", basically adds colors together, making them lighter
    context.globalCompositeOperation = 'lighter';
    for (let i = 0; i < this.whiteLightRays.length; i++) {
      const lightRay = this.whiteLightRays[i]; // {LightRay}

      const wavelength = Utils.roundSymmetric(lightRay.wavelengthInVacuum); // convert back to (nm)

      // Get the line values to make the next part more readable
      const x1 = this.modelViewTransform.modelToViewX(lightRay.tip.x);
      const y1 = this.modelViewTransform.modelToViewY(lightRay.tip.y);
      const x2 = this.modelViewTransform.modelToViewX(lightRay.tail.x);
      const y2 = this.modelViewTransform.modelToViewY(lightRay.tail.y);

      // Scale intensity into a custom alpha range
      const a = Utils.clamp(BendingLightConstants.D65[wavelength] * Math.sqrt(lightRay.powerFraction) / 118, 0, 1) / 8;

      // skip alpha values that are just too light to see, which could also cause number format problems when creating
      // css color
      if (a > 1E-5) {
        const c = VisibleColor.wavelengthToColor(wavelength);
        const r = c.r;
        const g = c.g;
        const b = c.b;
        context.strokeStyle = `rgb(${Utils.roundSymmetric(r * a / 0.9829313170995397)},${Utils.roundSymmetric(g * a)},${Utils.roundSymmetric(b * a / 0.7144456644926587)})`;
        context.beginPath();
        context.moveTo(x1, y1);
        context.lineTo(x2, y2);
        context.stroke();
      }
    }
    context.restore();
  }
  step() {
    this.invalidatePaint();
  }
}
bendingLight.register('WhiteLightCanvasNode', WhiteLightCanvasNode);
export default WhiteLightCanvasNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb3VuZHMyIiwiVXRpbHMiLCJWaXNpYmxlQ29sb3IiLCJDYW52YXNOb2RlIiwiYmVuZGluZ0xpZ2h0IiwiQmVuZGluZ0xpZ2h0Q29uc3RhbnRzIiwiV2hpdGVMaWdodENhbnZhc05vZGUiLCJjb25zdHJ1Y3RvciIsIm1vZGVsVmlld1RyYW5zZm9ybSIsInN0YWdlV2lkdGgiLCJzdGFnZUhlaWdodCIsIndoaXRlTGlnaHRSYXlzIiwiZW52aXJvbm1lbnRNZWRpdW1Qcm9wZXJ0eSIsIm1lZGl1bUNvbG9yRmFjdG9yeSIsImNhbnZhc0JvdW5kcyIsImNvbG9yQ1NTIiwiaW52YWxpZGF0ZVBhaW50IiwidXBkYXRlIiwiYSIsInZhbHVlIiwic3Vic3RhbmNlIiwiaW5kZXhPZlJlZnJhY3Rpb25Gb3JSZWRMaWdodCIsImdldENvbG9yIiwidG9DU1MiLCJsaWdodFR5cGVQcm9wZXJ0eSIsImxpbmsiLCJwYWludENhbnZhcyIsImNvbnRleHQiLCJsaW5lV2lkdGgiLCJnbG9iYWxDb21wb3NpdGVPcGVyYXRpb24iLCJmaWxsU3R5bGUiLCJzYXZlIiwic2V0VHJhbnNmb3JtIiwiZmlsbFJlY3QiLCJjYW52YXMiLCJ3aWR0aCIsImhlaWdodCIsInJlc3RvcmUiLCJpIiwibGVuZ3RoIiwibGlnaHRSYXkiLCJ3YXZlbGVuZ3RoIiwicm91bmRTeW1tZXRyaWMiLCJ3YXZlbGVuZ3RoSW5WYWN1dW0iLCJ4MSIsIm1vZGVsVG9WaWV3WCIsInRpcCIsIngiLCJ5MSIsIm1vZGVsVG9WaWV3WSIsInkiLCJ4MiIsInRhaWwiLCJ5MiIsImNsYW1wIiwiRDY1IiwiTWF0aCIsInNxcnQiLCJwb3dlckZyYWN0aW9uIiwiYyIsIndhdmVsZW5ndGhUb0NvbG9yIiwiciIsImciLCJiIiwic3Ryb2tlU3R5bGUiLCJiZWdpblBhdGgiLCJtb3ZlVG8iLCJsaW5lVG8iLCJzdHJva2UiLCJzdGVwIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJXaGl0ZUxpZ2h0Q2FudmFzTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBJbiBvcmRlciB0byBzdXBwb3J0IHdoaXRlIGxpZ2h0LCB3ZSBuZWVkIHRvIHBlcmZvcm0gYWRkaXRpdmUgY29sb3IgbWl4aW5nIChub3Qgc3VidHJhY3RpdmUsXHJcbiAqIGFzIGlzIHRoZSBkZWZhdWx0IHdoZW4gZHJhd2luZyB0cmFuc3BhcmVudCBjb2xvcnMgb24gdG9wIG9mIGVhY2ggb3RoZXIgaW4gSmF2YSkuXHJcbiAqIDxwLz5cclxuICogVGhpcyBjbGFzcyB1c2VzIHRoZSBCcmVzZW5oYW0gbGluZSBkcmF3aW5nIGFsZ29yaXRobSAod2l0aCBhIHN0cm9rZSB0aGlja25lc3Mgb2YgMikgdG8gZGV0ZXJtaW5lIHdoaWNoIHBpeGVscyBlYWNoXHJcbiAqIHJheSBpbmhhYml0cy4gV2hlbiBtdWx0aXBsZSByYXlzIGhpdCB0aGUgc2FtZSBwaXhlbCwgdGhlaXIgUkdCIHZhbHVlcyBhcmUgYWRkZWQuIElmIGFueSBvZiB0aGUgUkcgb3IgQiB2YWx1ZXMgaXNcclxuICogZ3JlYXRlciB0aGFuIHRoZSBtYXhpbXVtIG9mIDI1NSwgdGhlbiBSR0IgdmFsdWVzIGFyZSBzY2FsZWQgZG93biBhbmQgdGhlIGxlZnRvdmVyIHBhcnQgaXMgcHV0IGludG8gdGhlIFwiaW50ZW5zaXR5XCJcclxuICogdmFsdWUgKHdoaWNoIGlzIHRoZSBzdW0gb2YgdGhlIHJheSBpbnRlbnNpdGllcykuIFRoZSBpbnRlbnNpdHkgaXMgY29udmVydGVkIHRvIGEgdHJhbnNwYXJlbmN5IHZhbHVlIGFjY29yZGluZyB0b1xyXG4gKiBhbHBoYSA9IHNxcnQoaW50ZW5zaXR5LzMpLCB3aGljaCBpcyBhbHNvIGNsYW1wZWQgdG8gYmUgYmV0d2VlbiAwIGFuZCAyNTUuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgQ2hhbmRyYXNoZWthciBCZW1hZ29uaSAoQWN0dWFsIENvbmNlcHRzKVxyXG4gKi9cclxuXHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IEJvdW5kczIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0JvdW5kczIuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgVmlzaWJsZUNvbG9yIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9WaXNpYmxlQ29sb3IuanMnO1xyXG5pbXBvcnQgeyBDYW52YXNOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGJlbmRpbmdMaWdodCBmcm9tICcuLi8uLi9iZW5kaW5nTGlnaHQuanMnO1xyXG5pbXBvcnQgQmVuZGluZ0xpZ2h0Q29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9CZW5kaW5nTGlnaHRDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgTGlnaHRSYXkgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL0xpZ2h0UmF5LmpzJztcclxuaW1wb3J0IE1lZGl1bSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvTWVkaXVtLmpzJztcclxuaW1wb3J0IE1lZGl1bUNvbG9yRmFjdG9yeSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvTWVkaXVtQ29sb3JGYWN0b3J5LmpzJztcclxuXHJcbmNsYXNzIFdoaXRlTGlnaHRDYW52YXNOb2RlIGV4dGVuZHMgQ2FudmFzTm9kZSB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSB3aGl0ZUxpZ2h0UmF5czogTGlnaHRSYXlbXTtcclxuICBwcml2YXRlIGVudmlyb25tZW50TWVkaXVtUHJvcGVydHk6IFByb3BlcnR5PE1lZGl1bT47XHJcbiAgcHJpdmF0ZSBjb2xvckNTUzogc3RyaW5nIHwgbnVsbDtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIG1vZGVsVmlld1RyYW5zZm9ybSAtIGNvbnZlcnRzIGJldHdlZW4gbW9kZWwgYW5kIHZpZXcgY28tb3JkaW5hdGVzXHJcbiAgICogQHBhcmFtIHN0YWdlV2lkdGggLSB3aWR0aCBvZiB0aGUgZGV2IGFyZWFcclxuICAgKiBAcGFyYW0gc3RhZ2VIZWlnaHQgLSBoZWlnaHQgb2YgdGhlIGRldiBhcmVhXHJcbiAgICogQHBhcmFtIHdoaXRlTGlnaHRSYXlzIC0gYXJyYXkgb2Ygd2hpdGUgbGlnaHQgcmF5c1xyXG4gICAqIEBwYXJhbSBlbnZpcm9ubWVudE1lZGl1bVByb3BlcnR5XHJcbiAgICogQHBhcmFtIG1lZGl1bUNvbG9yRmFjdG9yeSAtIGZvciBjcmVhdGluZyBjb2xvcnMgZnJvbSBpbmRleCBvZiByZWZyYWN0aW9uXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTIsIHN0YWdlV2lkdGg6IG51bWJlciwgc3RhZ2VIZWlnaHQ6IG51bWJlciwgd2hpdGVMaWdodFJheXM6IExpZ2h0UmF5W10sXHJcbiAgICAgICAgICAgICAgICAgICAgICBlbnZpcm9ubWVudE1lZGl1bVByb3BlcnR5OiBQcm9wZXJ0eTxNZWRpdW0+LCBtZWRpdW1Db2xvckZhY3Rvcnk6IE1lZGl1bUNvbG9yRmFjdG9yeSApIHtcclxuXHJcbiAgICBzdXBlcigge1xyXG4gICAgICBjYW52YXNCb3VuZHM6IG5ldyBCb3VuZHMyKCAwLCAwLCBzdGFnZVdpZHRoLCBzdGFnZUhlaWdodCApXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmNvbG9yQ1NTID0gbnVsbDtcclxuICAgIHRoaXMuaW52YWxpZGF0ZVBhaW50KCk7XHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSA9IG1vZGVsVmlld1RyYW5zZm9ybTtcclxuICAgIHRoaXMud2hpdGVMaWdodFJheXMgPSB3aGl0ZUxpZ2h0UmF5cztcclxuICAgIHRoaXMuZW52aXJvbm1lbnRNZWRpdW1Qcm9wZXJ0eSA9IGVudmlyb25tZW50TWVkaXVtUHJvcGVydHk7XHJcbiAgICBjb25zdCB1cGRhdGUgPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGEgPSBlbnZpcm9ubWVudE1lZGl1bVByb3BlcnR5LnZhbHVlLnN1YnN0YW5jZS5pbmRleE9mUmVmcmFjdGlvbkZvclJlZExpZ2h0O1xyXG4gICAgICB0aGlzLmNvbG9yQ1NTID0gbWVkaXVtQ29sb3JGYWN0b3J5LmdldENvbG9yKCBhICkudG9DU1MoKTtcclxuICAgICAgdGhpcy5pbnZhbGlkYXRlUGFpbnQoKTtcclxuICAgIH07XHJcbiAgICBtZWRpdW1Db2xvckZhY3RvcnkubGlnaHRUeXBlUHJvcGVydHkubGluayggdXBkYXRlICk7XHJcbiAgICBlbnZpcm9ubWVudE1lZGl1bVByb3BlcnR5LmxpbmsoIHVwZGF0ZSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUGFpbnRzIHRoZSBwYXJ0aWNsZXMgb24gdGhlIGNhbnZhcyBub2RlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBwYWludENhbnZhcyggY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEICk6IHZvaWQge1xyXG4gICAgY29udGV4dC5saW5lV2lkdGggPSAzO1xyXG4gICAgY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLW92ZXInO1xyXG5cclxuICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcclxuICAgIGNvbnRleHQuZmlsbFN0eWxlID0gdGhpcy5jb2xvckNTUztcclxuICAgIGNvbnRleHQuc2F2ZSgpO1xyXG4gICAgY29udGV4dC5zZXRUcmFuc2Zvcm0oIDEsIDAsIDAsIDEsIDAsIDAgKTtcclxuICAgIGNvbnRleHQuZmlsbFJlY3QoIDAsIDAsIGNvbnRleHQuY2FudmFzLndpZHRoLCBjb250ZXh0LmNhbnZhcy5oZWlnaHQgKTtcclxuICAgIGNvbnRleHQucmVzdG9yZSgpO1xyXG5cclxuICAgIC8vIEhhdmUgdG8gc2F2ZSB0aGUgcHJldmlvdXMgZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uIHNvIGl0IGRvZXNuJ3QgbGVhayB0byB0aGUgU2luZ2xlQ29sb3JMaWdodENhbnZhc05vZGUgb24gaU9TXHJcbiAgICAvLyBzZWUgIzI2N1xyXG4gICAgY29udGV4dC5zYXZlKCk7XHJcblxyXG4gICAgLy8gXCJTY3JlZW5cIiwgYmFzaWNhbGx5IGFkZHMgY29sb3JzIHRvZ2V0aGVyLCBtYWtpbmcgdGhlbSBsaWdodGVyXHJcbiAgICBjb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdsaWdodGVyJztcclxuXHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLndoaXRlTGlnaHRSYXlzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBjb25zdCBsaWdodFJheSA9IHRoaXMud2hpdGVMaWdodFJheXNbIGkgXTsgLy8ge0xpZ2h0UmF5fVxyXG5cclxuICAgICAgY29uc3Qgd2F2ZWxlbmd0aCA9IFV0aWxzLnJvdW5kU3ltbWV0cmljKCBsaWdodFJheS53YXZlbGVuZ3RoSW5WYWN1dW0gKTsgLy8gY29udmVydCBiYWNrIHRvIChubSlcclxuXHJcbiAgICAgIC8vIEdldCB0aGUgbGluZSB2YWx1ZXMgdG8gbWFrZSB0aGUgbmV4dCBwYXJ0IG1vcmUgcmVhZGFibGVcclxuICAgICAgY29uc3QgeDEgPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIGxpZ2h0UmF5LnRpcC54ICk7XHJcbiAgICAgIGNvbnN0IHkxID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdZKCBsaWdodFJheS50aXAueSApO1xyXG4gICAgICBjb25zdCB4MiA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WCggbGlnaHRSYXkudGFpbC54ICk7XHJcbiAgICAgIGNvbnN0IHkyID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdZKCBsaWdodFJheS50YWlsLnkgKTtcclxuXHJcbiAgICAgIC8vIFNjYWxlIGludGVuc2l0eSBpbnRvIGEgY3VzdG9tIGFscGhhIHJhbmdlXHJcbiAgICAgIGNvbnN0IGEgPSBVdGlscy5jbGFtcCggQmVuZGluZ0xpZ2h0Q29uc3RhbnRzLkQ2NVsgd2F2ZWxlbmd0aCBdICogTWF0aC5zcXJ0KCBsaWdodFJheS5wb3dlckZyYWN0aW9uICkgLyAxMTgsIDAsIDEgKVxyXG4gICAgICAgICAgICAgICAgLyA4O1xyXG5cclxuICAgICAgLy8gc2tpcCBhbHBoYSB2YWx1ZXMgdGhhdCBhcmUganVzdCB0b28gbGlnaHQgdG8gc2VlLCB3aGljaCBjb3VsZCBhbHNvIGNhdXNlIG51bWJlciBmb3JtYXQgcHJvYmxlbXMgd2hlbiBjcmVhdGluZ1xyXG4gICAgICAvLyBjc3MgY29sb3JcclxuICAgICAgaWYgKCBhID4gMUUtNSApIHtcclxuICAgICAgICBjb25zdCBjID0gVmlzaWJsZUNvbG9yLndhdmVsZW5ndGhUb0NvbG9yKCB3YXZlbGVuZ3RoICk7XHJcbiAgICAgICAgY29uc3QgcjogbnVtYmVyID0gYy5yO1xyXG4gICAgICAgIGNvbnN0IGc6IG51bWJlciA9IGMuZztcclxuICAgICAgICBjb25zdCBiOiBudW1iZXIgPSBjLmI7XHJcbiAgICAgICAgY29udGV4dC5zdHJva2VTdHlsZSA9IGByZ2IoJHtcclxuICAgICAgICAgIFV0aWxzLnJvdW5kU3ltbWV0cmljKCByICogYSAvIDAuOTgyOTMxMzE3MDk5NTM5NyApfSwke1xyXG4gICAgICAgICAgVXRpbHMucm91bmRTeW1tZXRyaWMoIGcgKiBhICl9LCR7XHJcbiAgICAgICAgICBVdGlscy5yb3VuZFN5bW1ldHJpYyggYiAqIGEgLyAwLjcxNDQ0NTY2NDQ5MjY1ODcgKVxyXG4gICAgICAgIH0pYDtcclxuICAgICAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgIGNvbnRleHQubW92ZVRvKCB4MSwgeTEgKTtcclxuICAgICAgICBjb250ZXh0LmxpbmVUbyggeDIsIHkyICk7XHJcbiAgICAgICAgY29udGV4dC5zdHJva2UoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29udGV4dC5yZXN0b3JlKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RlcCgpOiB2b2lkIHtcclxuICAgIHRoaXMuaW52YWxpZGF0ZVBhaW50KCk7XHJcbiAgfVxyXG59XHJcblxyXG5iZW5kaW5nTGlnaHQucmVnaXN0ZXIoICdXaGl0ZUxpZ2h0Q2FudmFzTm9kZScsIFdoaXRlTGlnaHRDYW52YXNOb2RlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBXaGl0ZUxpZ2h0Q2FudmFzTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLE9BQU9BLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUUvQyxPQUFPQyxZQUFZLE1BQU0sNkNBQTZDO0FBQ3RFLFNBQVNDLFVBQVUsUUFBUSxtQ0FBbUM7QUFDOUQsT0FBT0MsWUFBWSxNQUFNLHVCQUF1QjtBQUNoRCxPQUFPQyxxQkFBcUIsTUFBTSx1Q0FBdUM7QUFLekUsTUFBTUMsb0JBQW9CLFNBQVNILFVBQVUsQ0FBQztFQU01QztBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ1NJLFdBQVdBLENBQUVDLGtCQUF1QyxFQUFFQyxVQUFrQixFQUFFQyxXQUFtQixFQUFFQyxjQUEwQixFQUM1R0MseUJBQTJDLEVBQUVDLGtCQUFzQyxFQUFHO0lBRXhHLEtBQUssQ0FBRTtNQUNMQyxZQUFZLEVBQUUsSUFBSWQsT0FBTyxDQUFFLENBQUMs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