// Copyright 2021-2022, University of Colorado Boulder

/**
 * Wave WebGl Rendering.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Chandrashekar Bemagoni (Actual Concepts)
 */

import { ShaderProgram, WebGLNode } from '../../../../scenery/js/imports.js';
import bendingLight from '../../bendingLight.js';
const scratchFloatArray1 = new Float32Array(9);
const scratchFloatArray2 = new Float32Array(9);
class WaveWebGLNode extends WebGLNode {
  // public only for access by WavePainter
  /**
   * @param modelViewTransform - Transform between model and view coordinate frames
   * @param rays - light rays
   */
  constructor(modelViewTransform, rays) {
    super(WavePainter);
    this.modelViewTransform = modelViewTransform;
    this.rays = rays;
  }

  /**
   */
  step() {
    this.invalidatePaint();
  }
}
class WavePainter {
  constructor(gl, node) {
    this.gl = gl;
    this.node = node;

    // Simple example for custom shader
    const vertexShaderSource = [
    // Position
    'attribute vec3 aPosition;',
    // vertex attribute
    'uniform mat3 uModelViewMatrix;', 'uniform mat3 uProjectionMatrix;', 'varying vec2 vPosition;', 'void main( void ) {', '  vPosition = aPosition.xy;',
    // homogeneous model-view transformation
    'vec3 view = uModelViewMatrix * vec3( aPosition.xy, 1 );',
    // homogeneous map to normalized device coordinates
    'vec3 ndc = uProjectionMatrix * vec3( view.xy, 1 );',
    // combine with the z coordinate specified
    'gl_Position = vec4( ndc.xy, aPosition.z, 1.0 );', '}'].join('\n');

    // custom fragment shader
    const fragmentShaderSource = ['precision mediump float;', 'uniform float uPowerFraction;',
    // light ray power fraction
    'uniform vec2 uTail;',
    // Tail point
    'uniform float uAngle;',
    // Angle of the ColoredRay
    'uniform float uWaveLength;',
    // Wavelength of the ColoredRay
    'uniform float uPhase;',
    // phase difference of the ColoredRay
    'uniform vec3 uColor;',
    // Color of the wave
    'varying vec2 vPosition;', 'void main( void ) {',
    // Perpendicular distance from tail to rendering coordinate. This is obtained by Coordinate Transformation to
    // tail point and applying dot product to the unit vector in the direction of ray and rendering coordinate
    'float distance = dot(vec2(cos(uAngle),sin(uAngle)), vec2(vPosition.x-uTail.x,uTail.y - vPosition.y));',
    // finding the position of rendering coordinate in each wave particle to determine the color of the pixel
    'float positionDiff = mod( abs( distance - uPhase), uWaveLength);',
    // color is determined by perpendicular distance of coordinate from the start of the particle.
    'float colorFactor = abs( 1.0 - positionDiff / ( uWaveLength * 0.5 ) );', 'gl_FragColor.rgb = uColor * (colorFactor);', 'gl_FragColor.a = sqrt(uPowerFraction);',
    // Use premultipled alpha, see https://github.com/phetsims/energy-skate-park/issues/39
    'gl_FragColor.rgb *= gl_FragColor.a;', '}'].join('\n');
    this.shaderProgram = new ShaderProgram(gl, vertexShaderSource, fragmentShaderSource, {
      attributes: ['aPosition'],
      uniforms: ['uModelViewMatrix', 'uProjectionMatrix', 'uPowerFraction', 'uTail', 'uAngle', 'uWaveLength', 'uPhase', 'uColor']
    });
    this.vertexBuffer = gl.createBuffer();
  }
  paint(modelViewMatrix, projectionMatrix) {
    const gl = this.gl;
    const shaderProgram = this.shaderProgram;
    const rays = this.node.rays;
    const modelViewTransform = this.node.modelViewTransform;
    shaderProgram.use();
    for (let i = rays.length - 1; i >= 0; i--) {
      const elements = [];
      const lightRay = rays[i];
      if (lightRay.waveShape) {
        const lightRayWaveSubPath = lightRay.waveShape.subpaths[0];

        // get the x and y coordinates of wave corner points
        const point1X = modelViewTransform.modelToViewX(lightRayWaveSubPath.points[0].x);
        const point1Y = modelViewTransform.modelToViewY(lightRayWaveSubPath.points[0].y);
        const point2X = modelViewTransform.modelToViewX(lightRayWaveSubPath.points[1].x);
        const point2Y = modelViewTransform.modelToViewY(lightRayWaveSubPath.points[1].y);
        const point3X = modelViewTransform.modelToViewX(lightRayWaveSubPath.points[3].x);
        const point3Y = modelViewTransform.modelToViewY(lightRayWaveSubPath.points[3].y);
        const point4X = modelViewTransform.modelToViewX(lightRayWaveSubPath.points[2].x);
        const point4Y = modelViewTransform.modelToViewY(lightRayWaveSubPath.points[2].y);

        // points to draw light ray beam
        elements.push(point1X, point1Y, 1);
        elements.push(point2X, point2Y, 1);
        elements.push(point3X, point3Y, 1);
        elements.push(point4X, point4Y, 1);

        // light ray power fraction
        const lightRayPowerFraction = lightRay.powerFraction;

        // tail position in view co-ordinates
        const tailViewX = modelViewTransform.modelToViewX(lightRay.tail.x);
        const tailViewY = modelViewTransform.modelToViewY(lightRay.tail.y);

        // light ray angle
        const lightRayAngle = lightRay.getAngle();

        // light ray wavelength
        const wavelength = modelViewTransform.modelToViewDeltaX(lightRay.wavelength);

        // phase
        const totalPhaseOffsetInNumberOfWavelengths = lightRay.getPhaseOffset() / 2 / Math.PI;
        const phaseDiff = modelViewTransform.modelToViewDeltaX(
        // Just keep the fractional part
        totalPhaseOffsetInNumberOfWavelengths % 1 * lightRay.wavelength);

        // light ray color
        const red = lightRay.color.r / 255;
        const green = lightRay.color.g / 255;
        const blue = lightRay.color.b / 255;
        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(elements), gl.STATIC_DRAW);
        if (shaderProgram) {
          gl.uniformMatrix3fv(shaderProgram.uniformLocations.uModelViewMatrix, false, modelViewMatrix.copyToArray(scratchFloatArray1));
          gl.uniformMatrix3fv(shaderProgram.uniformLocations.uProjectionMatrix, false, projectionMatrix.copyToArray(scratchFloatArray2));
          gl.uniform1f(shaderProgram.uniformLocations.uPowerFraction, lightRayPowerFraction);
          gl.uniform2f(shaderProgram.uniformLocations.uTail, tailViewX, tailViewY);
          gl.uniform1f(shaderProgram.uniformLocations.uAngle, lightRayAngle);
          gl.uniform1f(shaderProgram.uniformLocations.uWaveLength, wavelength);
          gl.uniform1f(shaderProgram.uniformLocations.uPhase, phaseDiff);
          gl.uniform3f(shaderProgram.uniformLocations.uColor, red, green, blue);
          gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);
          gl.vertexAttribPointer(shaderProgram.attributeLocations.aPosition, 3, gl.FLOAT, false, 0, 0);
          gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
        }
      }
    }
    shaderProgram.unuse();
    return WebGLNode.PAINTED_SOMETHING;
  }
  dispose() {
    this.shaderProgram.dispose();
    this.gl.deleteBuffer(this.vertexBuffer);
  }
}
bendingLight.register('WaveWebGLNode', WaveWebGLNode);
export default WaveWebGLNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaGFkZXJQcm9ncmFtIiwiV2ViR0xOb2RlIiwiYmVuZGluZ0xpZ2h0Iiwic2NyYXRjaEZsb2F0QXJyYXkxIiwiRmxvYXQzMkFycmF5Iiwic2NyYXRjaEZsb2F0QXJyYXkyIiwiV2F2ZVdlYkdMTm9kZSIsImNvbnN0cnVjdG9yIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwicmF5cyIsIldhdmVQYWludGVyIiwic3RlcCIsImludmFsaWRhdGVQYWludCIsImdsIiwibm9kZSIsInZlcnRleFNoYWRlclNvdXJjZSIsImpvaW4iLCJmcmFnbWVudFNoYWRlclNvdXJjZSIsInNoYWRlclByb2dyYW0iLCJhdHRyaWJ1dGVzIiwidW5pZm9ybXMiLCJ2ZXJ0ZXhCdWZmZXIiLCJjcmVhdGVCdWZmZXIiLCJwYWludCIsIm1vZGVsVmlld01hdHJpeCIsInByb2plY3Rpb25NYXRyaXgiLCJ1c2UiLCJpIiwibGVuZ3RoIiwiZWxlbWVudHMiLCJsaWdodFJheSIsIndhdmVTaGFwZSIsImxpZ2h0UmF5V2F2ZVN1YlBhdGgiLCJzdWJwYXRocyIsInBvaW50MVgiLCJtb2RlbFRvVmlld1giLCJwb2ludHMiLCJ4IiwicG9pbnQxWSIsIm1vZGVsVG9WaWV3WSIsInkiLCJwb2ludDJYIiwicG9pbnQyWSIsInBvaW50M1giLCJwb2ludDNZIiwicG9pbnQ0WCIsInBvaW50NFkiLCJwdXNoIiwibGlnaHRSYXlQb3dlckZyYWN0aW9uIiwicG93ZXJGcmFjdGlvbiIsInRhaWxWaWV3WCIsInRhaWwiLCJ0YWlsVmlld1kiLCJsaWdodFJheUFuZ2xlIiwiZ2V0QW5nbGUiLCJ3YXZlbGVuZ3RoIiwibW9kZWxUb1ZpZXdEZWx0YVgiLCJ0b3RhbFBoYXNlT2Zmc2V0SW5OdW1iZXJPZldhdmVsZW5ndGhzIiwiZ2V0UGhhc2VPZmZzZXQiLCJNYXRoIiwiUEkiLCJwaGFzZURpZmYiLCJyZWQiLCJjb2xvciIsInIiLCJncmVlbiIsImciLCJibHVlIiwiYiIsImJpbmRCdWZmZXIiLCJBUlJBWV9CVUZGRVIiLCJidWZmZXJEYXRhIiwiU1RBVElDX0RSQVciLCJ1bmlmb3JtTWF0cml4M2Z2IiwidW5pZm9ybUxvY2F0aW9ucyIsInVNb2RlbFZpZXdNYXRyaXgiLCJjb3B5VG9BcnJheSIsInVQcm9qZWN0aW9uTWF0cml4IiwidW5pZm9ybTFmIiwidVBvd2VyRnJhY3Rpb24iLCJ1bmlmb3JtMmYiLCJ1VGFpbCIsInVBbmdsZSIsInVXYXZlTGVuZ3RoIiwidVBoYXNlIiwidW5pZm9ybTNmIiwidUNvbG9yIiwidmVydGV4QXR0cmliUG9pbnRlciIsImF0dHJpYnV0ZUxvY2F0aW9ucyIsImFQb3NpdGlvbiIsIkZMT0FUIiwiZHJhd0FycmF5cyIsIlRSSUFOR0xFX1NUUklQIiwidW51c2UiLCJQQUlOVEVEX1NPTUVUSElORyIsImRpc3Bvc2UiLCJkZWxldGVCdWZmZXIiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIldhdmVXZWJHTE5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjEtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogV2F2ZSBXZWJHbCBSZW5kZXJpbmcuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgQ2hhbmRyYXNoZWthciBCZW1hZ29uaSAoQWN0dWFsIENvbmNlcHRzKVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IFNoYWRlclByb2dyYW0sIFdlYkdMTm9kZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBiZW5kaW5nTGlnaHQgZnJvbSAnLi4vLi4vYmVuZGluZ0xpZ2h0LmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgTGlnaHRSYXkgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL0xpZ2h0UmF5LmpzJztcclxuaW1wb3J0IE1hdHJpeDMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL01hdHJpeDMuanMnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlQXJyYXkgfSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL2NyZWF0ZU9ic2VydmFibGVBcnJheS5qcyc7XHJcblxyXG5jb25zdCBzY3JhdGNoRmxvYXRBcnJheTEgPSBuZXcgRmxvYXQzMkFycmF5KCA5ICk7XHJcbmNvbnN0IHNjcmF0Y2hGbG9hdEFycmF5MiA9IG5ldyBGbG9hdDMyQXJyYXkoIDkgKTtcclxuXHJcbmNsYXNzIFdhdmVXZWJHTE5vZGUgZXh0ZW5kcyBXZWJHTE5vZGUge1xyXG4gIHB1YmxpYyByZWFkb25seSBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTI7XHJcbiAgcHVibGljIHJlYWRvbmx5IHJheXM6IE9ic2VydmFibGVBcnJheTxMaWdodFJheT47IC8vIHB1YmxpYyBvbmx5IGZvciBhY2Nlc3MgYnkgV2F2ZVBhaW50ZXJcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIG1vZGVsVmlld1RyYW5zZm9ybSAtIFRyYW5zZm9ybSBiZXR3ZWVuIG1vZGVsIGFuZCB2aWV3IGNvb3JkaW5hdGUgZnJhbWVzXHJcbiAgICogQHBhcmFtIHJheXMgLSBsaWdodCByYXlzXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTIsIHJheXM6IE9ic2VydmFibGVBcnJheTxMaWdodFJheT4gKSB7XHJcbiAgICBzdXBlciggV2F2ZVBhaW50ZXIgKTtcclxuICAgIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtID0gbW9kZWxWaWV3VHJhbnNmb3JtO1xyXG4gICAgdGhpcy5yYXlzID0gcmF5cztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGVwKCk6IHZvaWQge1xyXG4gICAgdGhpcy5pbnZhbGlkYXRlUGFpbnQoKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIFdhdmVQYWludGVyIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IGdsOiBXZWJHTFJlbmRlcmluZ0NvbnRleHQ7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBub2RlOiBXYXZlV2ViR0xOb2RlO1xyXG4gIHByaXZhdGUgc2hhZGVyUHJvZ3JhbTogU2hhZGVyUHJvZ3JhbTtcclxuICBwcml2YXRlIHZlcnRleEJ1ZmZlcjogV2ViR0xCdWZmZXIgfCBudWxsO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGdsOiBXZWJHTFJlbmRlcmluZ0NvbnRleHQsIG5vZGU6IFdhdmVXZWJHTE5vZGUgKSB7XHJcbiAgICB0aGlzLmdsID0gZ2w7XHJcbiAgICB0aGlzLm5vZGUgPSBub2RlO1xyXG5cclxuICAgIC8vIFNpbXBsZSBleGFtcGxlIGZvciBjdXN0b20gc2hhZGVyXHJcbiAgICBjb25zdCB2ZXJ0ZXhTaGFkZXJTb3VyY2UgPSBbXHJcblxyXG4gICAgICAvLyBQb3NpdGlvblxyXG4gICAgICAnYXR0cmlidXRlIHZlYzMgYVBvc2l0aW9uOycsIC8vIHZlcnRleCBhdHRyaWJ1dGVcclxuICAgICAgJ3VuaWZvcm0gbWF0MyB1TW9kZWxWaWV3TWF0cml4OycsXHJcbiAgICAgICd1bmlmb3JtIG1hdDMgdVByb2plY3Rpb25NYXRyaXg7JyxcclxuICAgICAgJ3ZhcnlpbmcgdmVjMiB2UG9zaXRpb247JyxcclxuICAgICAgJ3ZvaWQgbWFpbiggdm9pZCApIHsnLFxyXG4gICAgICAnICB2UG9zaXRpb24gPSBhUG9zaXRpb24ueHk7JyxcclxuXHJcbiAgICAgIC8vIGhvbW9nZW5lb3VzIG1vZGVsLXZpZXcgdHJhbnNmb3JtYXRpb25cclxuICAgICAgJ3ZlYzMgdmlldyA9IHVNb2RlbFZpZXdNYXRyaXggKiB2ZWMzKCBhUG9zaXRpb24ueHksIDEgKTsnLFxyXG5cclxuICAgICAgLy8gaG9tb2dlbmVvdXMgbWFwIHRvIG5vcm1hbGl6ZWQgZGV2aWNlIGNvb3JkaW5hdGVzXHJcbiAgICAgICd2ZWMzIG5kYyA9IHVQcm9qZWN0aW9uTWF0cml4ICogdmVjMyggdmlldy54eSwgMSApOycsXHJcblxyXG4gICAgICAvLyBjb21iaW5lIHdpdGggdGhlIHogY29vcmRpbmF0ZSBzcGVjaWZpZWRcclxuICAgICAgJ2dsX1Bvc2l0aW9uID0gdmVjNCggbmRjLnh5LCBhUG9zaXRpb24ueiwgMS4wICk7JyxcclxuICAgICAgJ30nXHJcbiAgICBdLmpvaW4oICdcXG4nICk7XHJcblxyXG4gICAgLy8gY3VzdG9tIGZyYWdtZW50IHNoYWRlclxyXG4gICAgY29uc3QgZnJhZ21lbnRTaGFkZXJTb3VyY2UgPSBbXHJcbiAgICAgICdwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsnLFxyXG4gICAgICAndW5pZm9ybSBmbG9hdCB1UG93ZXJGcmFjdGlvbjsnLCAvLyBsaWdodCByYXkgcG93ZXIgZnJhY3Rpb25cclxuICAgICAgJ3VuaWZvcm0gdmVjMiB1VGFpbDsnLCAvLyBUYWlsIHBvaW50XHJcbiAgICAgICd1bmlmb3JtIGZsb2F0IHVBbmdsZTsnLCAvLyBBbmdsZSBvZiB0aGUgQ29sb3JlZFJheVxyXG4gICAgICAndW5pZm9ybSBmbG9hdCB1V2F2ZUxlbmd0aDsnLCAvLyBXYXZlbGVuZ3RoIG9mIHRoZSBDb2xvcmVkUmF5XHJcbiAgICAgICd1bmlmb3JtIGZsb2F0IHVQaGFzZTsnLCAvLyBwaGFzZSBkaWZmZXJlbmNlIG9mIHRoZSBDb2xvcmVkUmF5XHJcbiAgICAgICd1bmlmb3JtIHZlYzMgdUNvbG9yOycsIC8vIENvbG9yIG9mIHRoZSB3YXZlXHJcbiAgICAgICd2YXJ5aW5nIHZlYzIgdlBvc2l0aW9uOycsXHJcbiAgICAgICd2b2lkIG1haW4oIHZvaWQgKSB7JyxcclxuXHJcbiAgICAgIC8vIFBlcnBlbmRpY3VsYXIgZGlzdGFuY2UgZnJvbSB0YWlsIHRvIHJlbmRlcmluZyBjb29yZGluYXRlLiBUaGlzIGlzIG9idGFpbmVkIGJ5IENvb3JkaW5hdGUgVHJhbnNmb3JtYXRpb24gdG9cclxuICAgICAgLy8gdGFpbCBwb2ludCBhbmQgYXBwbHlpbmcgZG90IHByb2R1Y3QgdG8gdGhlIHVuaXQgdmVjdG9yIGluIHRoZSBkaXJlY3Rpb24gb2YgcmF5IGFuZCByZW5kZXJpbmcgY29vcmRpbmF0ZVxyXG4gICAgICAnZmxvYXQgZGlzdGFuY2UgPSBkb3QodmVjMihjb3ModUFuZ2xlKSxzaW4odUFuZ2xlKSksIHZlYzIodlBvc2l0aW9uLngtdVRhaWwueCx1VGFpbC55IC0gdlBvc2l0aW9uLnkpKTsnLFxyXG5cclxuICAgICAgLy8gZmluZGluZyB0aGUgcG9zaXRpb24gb2YgcmVuZGVyaW5nIGNvb3JkaW5hdGUgaW4gZWFjaCB3YXZlIHBhcnRpY2xlIHRvIGRldGVybWluZSB0aGUgY29sb3Igb2YgdGhlIHBpeGVsXHJcbiAgICAgICdmbG9hdCBwb3NpdGlvbkRpZmYgPSBtb2QoIGFicyggZGlzdGFuY2UgLSB1UGhhc2UpLCB1V2F2ZUxlbmd0aCk7JyxcclxuXHJcbiAgICAgIC8vIGNvbG9yIGlzIGRldGVybWluZWQgYnkgcGVycGVuZGljdWxhciBkaXN0YW5jZSBvZiBjb29yZGluYXRlIGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBwYXJ0aWNsZS5cclxuICAgICAgJ2Zsb2F0IGNvbG9yRmFjdG9yID0gYWJzKCAxLjAgLSBwb3NpdGlvbkRpZmYgLyAoIHVXYXZlTGVuZ3RoICogMC41ICkgKTsnLFxyXG4gICAgICAnZ2xfRnJhZ0NvbG9yLnJnYiA9IHVDb2xvciAqIChjb2xvckZhY3Rvcik7JyxcclxuICAgICAgJ2dsX0ZyYWdDb2xvci5hID0gc3FydCh1UG93ZXJGcmFjdGlvbik7JyxcclxuXHJcbiAgICAgIC8vIFVzZSBwcmVtdWx0aXBsZWQgYWxwaGEsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZW5lcmd5LXNrYXRlLXBhcmsvaXNzdWVzLzM5XHJcbiAgICAgICdnbF9GcmFnQ29sb3IucmdiICo9IGdsX0ZyYWdDb2xvci5hOycsXHJcbiAgICAgICd9J1xyXG4gICAgXS5qb2luKCAnXFxuJyApO1xyXG5cclxuICAgIHRoaXMuc2hhZGVyUHJvZ3JhbSA9IG5ldyBTaGFkZXJQcm9ncmFtKCBnbCwgdmVydGV4U2hhZGVyU291cmNlLCBmcmFnbWVudFNoYWRlclNvdXJjZSwge1xyXG4gICAgICBhdHRyaWJ1dGVzOiBbICdhUG9zaXRpb24nIF0sXHJcbiAgICAgIHVuaWZvcm1zOiBbICd1TW9kZWxWaWV3TWF0cml4JywgJ3VQcm9qZWN0aW9uTWF0cml4JywgJ3VQb3dlckZyYWN0aW9uJywgJ3VUYWlsJywgJ3VBbmdsZScsICd1V2F2ZUxlbmd0aCcsXHJcbiAgICAgICAgJ3VQaGFzZScsICd1Q29sb3InIF1cclxuICAgIH0gKTtcclxuICAgIHRoaXMudmVydGV4QnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcGFpbnQoIG1vZGVsVmlld01hdHJpeDogTWF0cml4MywgcHJvamVjdGlvbk1hdHJpeDogTWF0cml4MyApOiAxIHtcclxuICAgIGNvbnN0IGdsID0gdGhpcy5nbDtcclxuICAgIGNvbnN0IHNoYWRlclByb2dyYW0gPSB0aGlzLnNoYWRlclByb2dyYW07XHJcbiAgICBjb25zdCByYXlzID0gdGhpcy5ub2RlLnJheXM7XHJcbiAgICBjb25zdCBtb2RlbFZpZXdUcmFuc2Zvcm0gPSB0aGlzLm5vZGUubW9kZWxWaWV3VHJhbnNmb3JtO1xyXG5cclxuICAgIHNoYWRlclByb2dyYW0udXNlKCk7XHJcblxyXG4gICAgZm9yICggbGV0IGkgPSByYXlzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tICkge1xyXG4gICAgICBjb25zdCBlbGVtZW50cyA9IFtdO1xyXG4gICAgICBjb25zdCBsaWdodFJheSA9IHJheXNbIGkgXTtcclxuICAgICAgaWYgKCBsaWdodFJheS53YXZlU2hhcGUgKSB7XHJcbiAgICAgICAgY29uc3QgbGlnaHRSYXlXYXZlU3ViUGF0aCA9IGxpZ2h0UmF5LndhdmVTaGFwZS5zdWJwYXRoc1sgMCBdO1xyXG5cclxuICAgICAgICAvLyBnZXQgdGhlIHggYW5kIHkgY29vcmRpbmF0ZXMgb2Ygd2F2ZSBjb3JuZXIgcG9pbnRzXHJcbiAgICAgICAgY29uc3QgcG9pbnQxWCA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIGxpZ2h0UmF5V2F2ZVN1YlBhdGgucG9pbnRzWyAwIF0ueCApO1xyXG4gICAgICAgIGNvbnN0IHBvaW50MVkgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdZKCBsaWdodFJheVdhdmVTdWJQYXRoLnBvaW50c1sgMCBdLnkgKTtcclxuICAgICAgICBjb25zdCBwb2ludDJYID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WCggbGlnaHRSYXlXYXZlU3ViUGF0aC5wb2ludHNbIDEgXS54ICk7XHJcbiAgICAgICAgY29uc3QgcG9pbnQyWSA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1koIGxpZ2h0UmF5V2F2ZVN1YlBhdGgucG9pbnRzWyAxIF0ueSApO1xyXG4gICAgICAgIGNvbnN0IHBvaW50M1ggPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCBsaWdodFJheVdhdmVTdWJQYXRoLnBvaW50c1sgMyBdLnggKTtcclxuICAgICAgICBjb25zdCBwb2ludDNZID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggbGlnaHRSYXlXYXZlU3ViUGF0aC5wb2ludHNbIDMgXS55ICk7XHJcbiAgICAgICAgY29uc3QgcG9pbnQ0WCA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIGxpZ2h0UmF5V2F2ZVN1YlBhdGgucG9pbnRzWyAyIF0ueCApO1xyXG4gICAgICAgIGNvbnN0IHBvaW50NFkgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdZKCBsaWdodFJheVdhdmVTdWJQYXRoLnBvaW50c1sgMiBdLnkgKTtcclxuXHJcbiAgICAgICAgLy8gcG9pbnRzIHRvIGRyYXcgbGlnaHQgcmF5IGJlYW1cclxuICAgICAgICBlbGVtZW50cy5wdXNoKCBwb2ludDFYLCBwb2ludDFZLCAxICk7XHJcbiAgICAgICAgZWxlbWVudHMucHVzaCggcG9pbnQyWCwgcG9pbnQyWSwgMSApO1xyXG4gICAgICAgIGVsZW1lbnRzLnB1c2goIHBvaW50M1gsIHBvaW50M1ksIDEgKTtcclxuICAgICAgICBlbGVtZW50cy5wdXNoKCBwb2ludDRYLCBwb2ludDRZLCAxICk7XHJcblxyXG4gICAgICAgIC8vIGxpZ2h0IHJheSBwb3dlciBmcmFjdGlvblxyXG4gICAgICAgIGNvbnN0IGxpZ2h0UmF5UG93ZXJGcmFjdGlvbiA9IGxpZ2h0UmF5LnBvd2VyRnJhY3Rpb247XHJcblxyXG4gICAgICAgIC8vIHRhaWwgcG9zaXRpb24gaW4gdmlldyBjby1vcmRpbmF0ZXNcclxuICAgICAgICBjb25zdCB0YWlsVmlld1ggPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCBsaWdodFJheS50YWlsLnggKTtcclxuICAgICAgICBjb25zdCB0YWlsVmlld1kgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdZKCBsaWdodFJheS50YWlsLnkgKTtcclxuXHJcbiAgICAgICAgLy8gbGlnaHQgcmF5IGFuZ2xlXHJcbiAgICAgICAgY29uc3QgbGlnaHRSYXlBbmdsZSA9IGxpZ2h0UmF5LmdldEFuZ2xlKCk7XHJcblxyXG4gICAgICAgIC8vIGxpZ2h0IHJheSB3YXZlbGVuZ3RoXHJcbiAgICAgICAgY29uc3Qgd2F2ZWxlbmd0aCA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggbGlnaHRSYXkud2F2ZWxlbmd0aCApO1xyXG5cclxuICAgICAgICAvLyBwaGFzZVxyXG4gICAgICAgIGNvbnN0IHRvdGFsUGhhc2VPZmZzZXRJbk51bWJlck9mV2F2ZWxlbmd0aHMgPSBsaWdodFJheS5nZXRQaGFzZU9mZnNldCgpIC8gMiAvIE1hdGguUEk7XHJcbiAgICAgICAgY29uc3QgcGhhc2VEaWZmID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFYKFxyXG4gICAgICAgICAgLy8gSnVzdCBrZWVwIHRoZSBmcmFjdGlvbmFsIHBhcnRcclxuICAgICAgICAgICggdG90YWxQaGFzZU9mZnNldEluTnVtYmVyT2ZXYXZlbGVuZ3RocyAlIDEgKSAqIGxpZ2h0UmF5LndhdmVsZW5ndGhcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICAvLyBsaWdodCByYXkgY29sb3JcclxuICAgICAgICBjb25zdCByZWQgPSBsaWdodFJheS5jb2xvci5yIC8gMjU1O1xyXG4gICAgICAgIGNvbnN0IGdyZWVuID0gbGlnaHRSYXkuY29sb3IuZyAvIDI1NTtcclxuICAgICAgICBjb25zdCBibHVlID0gbGlnaHRSYXkuY29sb3IuYiAvIDI1NTtcclxuXHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlciggZ2wuQVJSQVlfQlVGRkVSLCB0aGlzLnZlcnRleEJ1ZmZlciApO1xyXG4gICAgICAgIGdsLmJ1ZmZlckRhdGEoIGdsLkFSUkFZX0JVRkZFUiwgbmV3IEZsb2F0MzJBcnJheSggZWxlbWVudHMgKSwgZ2wuU1RBVElDX0RSQVcgKTtcclxuXHJcbiAgICAgICAgaWYgKCBzaGFkZXJQcm9ncmFtICkge1xyXG4gICAgICAgICAgZ2wudW5pZm9ybU1hdHJpeDNmdiggc2hhZGVyUHJvZ3JhbS51bmlmb3JtTG9jYXRpb25zLnVNb2RlbFZpZXdNYXRyaXgsIGZhbHNlLCBtb2RlbFZpZXdNYXRyaXguY29weVRvQXJyYXkoIHNjcmF0Y2hGbG9hdEFycmF5MSApICk7XHJcbiAgICAgICAgICBnbC51bmlmb3JtTWF0cml4M2Z2KCBzaGFkZXJQcm9ncmFtLnVuaWZvcm1Mb2NhdGlvbnMudVByb2plY3Rpb25NYXRyaXgsIGZhbHNlLCBwcm9qZWN0aW9uTWF0cml4LmNvcHlUb0FycmF5KCBzY3JhdGNoRmxvYXRBcnJheTIgKSApO1xyXG4gICAgICAgICAgZ2wudW5pZm9ybTFmKCBzaGFkZXJQcm9ncmFtLnVuaWZvcm1Mb2NhdGlvbnMudVBvd2VyRnJhY3Rpb24sIGxpZ2h0UmF5UG93ZXJGcmFjdGlvbiApO1xyXG4gICAgICAgICAgZ2wudW5pZm9ybTJmKCBzaGFkZXJQcm9ncmFtLnVuaWZvcm1Mb2NhdGlvbnMudVRhaWwsIHRhaWxWaWV3WCwgdGFpbFZpZXdZICk7XHJcbiAgICAgICAgICBnbC51bmlmb3JtMWYoIHNoYWRlclByb2dyYW0udW5pZm9ybUxvY2F0aW9ucy51QW5nbGUsIGxpZ2h0UmF5QW5nbGUgKTtcclxuICAgICAgICAgIGdsLnVuaWZvcm0xZiggc2hhZGVyUHJvZ3JhbS51bmlmb3JtTG9jYXRpb25zLnVXYXZlTGVuZ3RoLCB3YXZlbGVuZ3RoICk7XHJcbiAgICAgICAgICBnbC51bmlmb3JtMWYoIHNoYWRlclByb2dyYW0udW5pZm9ybUxvY2F0aW9ucy51UGhhc2UsIHBoYXNlRGlmZiApO1xyXG4gICAgICAgICAgZ2wudW5pZm9ybTNmKCBzaGFkZXJQcm9ncmFtLnVuaWZvcm1Mb2NhdGlvbnMudUNvbG9yLCByZWQsIGdyZWVuLCBibHVlICk7XHJcblxyXG4gICAgICAgICAgZ2wuYmluZEJ1ZmZlciggZ2wuQVJSQVlfQlVGRkVSLCB0aGlzLnZlcnRleEJ1ZmZlciApO1xyXG4gICAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlciggc2hhZGVyUHJvZ3JhbS5hdHRyaWJ1dGVMb2NhdGlvbnMuYVBvc2l0aW9uLCAzLCBnbC5GTE9BVCwgZmFsc2UsIDAsIDAgKTtcclxuXHJcbiAgICAgICAgICBnbC5kcmF3QXJyYXlzKCBnbC5UUklBTkdMRV9TVFJJUCwgMCwgNCApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2hhZGVyUHJvZ3JhbS51bnVzZSgpO1xyXG5cclxuICAgIHJldHVybiBXZWJHTE5vZGUuUEFJTlRFRF9TT01FVEhJTkc7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuc2hhZGVyUHJvZ3JhbS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLmdsLmRlbGV0ZUJ1ZmZlciggdGhpcy52ZXJ0ZXhCdWZmZXIgKTtcclxuICB9XHJcbn1cclxuXHJcbmJlbmRpbmdMaWdodC5yZWdpc3RlciggJ1dhdmVXZWJHTE5vZGUnLCBXYXZlV2ViR0xOb2RlICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBXYXZlV2ViR0xOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFNBQVNBLGFBQWEsRUFBRUMsU0FBUyxRQUFRLG1DQUFtQztBQUM1RSxPQUFPQyxZQUFZLE1BQU0sdUJBQXVCO0FBTWhELE1BQU1DLGtCQUFrQixHQUFHLElBQUlDLFlBQVksQ0FBRSxDQUFFLENBQUM7QUFDaEQsTUFBTUMsa0JBQWtCLEdBQUcsSUFBSUQsWUFBWSxDQUFFLENBQUUsQ0FBQztBQUVoRCxNQUFNRSxhQUFhLFNBQVNMLFNBQVMsQ0FBQztFQUVhO0VBRWpEO0FBQ0Y7QUFDQTtBQUNBO0VBQ1NNLFdBQVdBLENBQUVDLGtCQUF1QyxFQUFFQyxJQUErQixFQUFHO0lBQzdGLEtBQUssQ0FBRUMsV0FBWSxDQUFDO0lBQ3BCLElBQUksQ0FBQ0Ysa0JBQWtCLEdBQUdBLGtCQUFrQjtJQUM1QyxJQUFJLENBQUNDLElBQUksR0FBR0EsSUFBSTtFQUNsQjs7RUFFQTtBQUNGO0VBQ1NFLElBQUlBLENBQUEsRUFBUztJQUNsQixJQUFJLENBQUNDLGVBQWUsQ0FBQyxDQUFDO0VBQ3hCO0FBQ0Y7QUFFQSxNQUFNRixXQUFXLENBQUM7RUFNVEgsV0FBV0EsQ0FBRU0sRUFBeUIsRUFBRUMsSUFBbUIsRUFBRztJQUNuRSxJQUFJLENBQUNELEVBQUUsR0FBR0EsRUFBRTtJQUNaLElBQUksQ0FBQ0MsSUFBSSxHQUFHQSxJQUFJOztJQUVoQjtJQUNBLE1BQU1DLGtCQUFrQixHQUFHO0lBRXpCO0lBQ0EsMkJBQTJCO0lBQUU7SUFDN0IsZ0NBQWdDLEVBQ2hDLGlDQUFpQyxFQUNqQyx5QkFBeUIsRUFDekIscUJBQXFCLEVBQ3JCLDZCQUE2QjtJQUU3QjtJQUNBLHlEQUF5RDtJQUV6RDtJQUNBLG9EQUFv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