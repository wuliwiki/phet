// Copyright 2017-2023, University of Colorado Boulder

/**
 * Slider unit with a vertical slider, a label above the slider and a readout display below the slider.
 * @author Martin Veillette (Berea College)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import merge from '../../../../phet-core/js/merge.js';
import { Node, Rectangle, Text, VBox } from '../../../../scenery/js/imports.js';
import VSlider from '../../../../sun/js/VSlider.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import ohmsLaw from '../../ohmsLaw.js';
import OhmsLawConstants from '../OhmsLawConstants.js';

// constants
const READOUT_SPACING = 6;
class SliderUnit extends Node {
  /**
   * @param {Property.<number>} property
   * @param {RangeWithValue} range
   * @param {string} symbolString
   * @param {string} nameString
   * @param {TReadOnlyProperty.<string>} unitStringProperty
   * @param {string} labelContent - a11y, label read by a screen reader on focus
   * @param {Object} [options]
   */
  constructor(property, range, symbolString, nameString, unitStringProperty, labelContent, options) {
    // options used by options below
    options = merge({
      // phet-io
      tandem: Tandem.REQUIRED // to be passed to supertype
    }, options);
    options = merge({
      sliderOptions: {
        trackFillEnabled: 'black',
        thumbFill: '#c3c4c5',
        thumbFillHighlighted: '#dedede',
        trackSize: new Dimension2(4, OhmsLawConstants.SLIDER_HEIGHT),
        thumbSize: new Dimension2(45, 22),
        // Don't allow any values that cannot be displayed by the precision allowed in this sim.
        constrainValue: value => Utils.toFixedNumber(value, options.decimalPlaces),
        startDrag: _.noop,
        endDrag: _.noop,
        // Turn off default sound generation, since this does its own in a highly customized way.
        soundGenerator: null,
        // pdom
        keyboardStep: 1,
        // delta for keyboard step
        shiftKeyboardStep: 0.1,
        // delta when holding shift
        roundToStepSize: true,
        // so default keyboard step rounds to pedagogically useful values
        containerTagName: 'div',
        // this div helps the a11y view look a bit better
        labelContent: labelContent,
        labelTagName: 'label',
        a11yMapPDOMValue: value => Utils.toFixedNumber(value, options.decimalPlaces),
        // phet-io
        tandem: options.tandem.createTandem('slider')
      },
      // {number}
      decimalPlaces: 0
    }, options);

    // override the start and end drag functions in the options
    const providedStartDragFunction = options.sliderOptions.startDrag;
    options.sliderOptions.startDrag = event => {
      if (event.type === 'keydown') {
        this.sliderDraggingByKeyboardProperty.set(true);
      }
      providedStartDragFunction && providedStartDragFunction();
    };
    const providedEndDragFunction = options.sliderOptions.endDrag;
    options.sliderOptions.endDrag = () => {
      this.sliderDraggingByKeyboardProperty.set(false);
      providedEndDragFunction && providedEndDragFunction();
    };
    super();

    // @public (read-only) {BooleanProperty} indicates if the slider is being dragged via the keyboard
    this.sliderDraggingByKeyboardProperty = new BooleanProperty(false);
    const slider = new VSlider(property, range, options.sliderOptions);
    const symbolText = new Text(symbolString, {
      font: OhmsLawConstants.SYMBOL_FONT,
      fill: OhmsLawConstants.BLUE_COLOR,
      maxWidth: OhmsLawConstants.SLIDER_WIDTH,
      tandem: options.tandem.createTandem('symbolText')
    });
    const nameText = new Text(nameString, {
      font: OhmsLawConstants.NAME_FONT,
      fill: OhmsLawConstants.BLUE_COLOR,
      maxWidth: OhmsLawConstants.SLIDER_WIDTH,
      tandem: options.tandem.createTandem('nameText')
    });

    // positioned with `y` rather than using other bounds methods so the text is aligned correctly because text
    // is aligned at y = 0, see https://github.com/phetsims/ohms-law/issues/140
    const headerNode = new Node({
      children: [symbolText, nameText]
    });
    nameText.center = new Vector2(symbolText.centerX, symbolText.y + 18);
    const valueText = new Text(Utils.toFixed(range.max, options.decimalPlaces), {
      font: OhmsLawConstants.READOUT_FONT,
      fill: OhmsLawConstants.BLACK_COLOR,
      tandem: options.tandem.createTandem('valueText'),
      stringPropertyOptions: {
        phetioReadOnly: true
      }
    });
    const unitText = new Text(unitStringProperty, {
      font: OhmsLawConstants.UNIT_FONT,
      fill: OhmsLawConstants.BLUE_COLOR,
      left: valueText.right / 2,
      // Size the unit to be as big as possible next to the value with spacing.
      maxWidth: OhmsLawConstants.UNIT_MAX_WIDTH,
      tandem: options.tandem.createTandem('unitText')
    });

    // The readout should be horizontally aligned
    const readout = new Node({
      children: [valueText, unitText]
    });
    valueText.right = unitText.left - READOUT_SPACING;

    // This ensures that both the value and the unit are on the same line, even if unit has a letter that dips "below" a writing line.
    valueText.y = unitText.y;

    // Background for centering
    const readoutBackground = Rectangle.bounds(readout.bounds, {
      children: [readout]
    });

    // Add components in a vertically spaced stack
    this.addChild(new VBox({
      spacing: 5,
      children: [headerNode, slider, readoutBackground]
    }));

    // Update value of the readout. Present for the lifetime of the simulation; no need to unlink.
    property.link(value => {
      valueText.string = Utils.toFixed(value, options.decimalPlaces);
      valueText.right = unitText.left - READOUT_SPACING;
      readout.centerX = readoutBackground.selfBounds.centerX;
    });
    this.mutate(options);
  }
}
ohmsLaw.register('SliderUnit', SliderUnit);
export default SliderUnit;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEaW1lbnNpb24yIiwiVXRpbHMiLCJWZWN0b3IyIiwibWVyZ2UiLCJOb2RlIiwiUmVjdGFuZ2xlIiwiVGV4dCIsIlZCb3giLCJWU2xpZGVyIiwiVGFuZGVtIiwib2htc0xhdyIsIk9obXNMYXdDb25zdGFudHMiLCJSRUFET1VUX1NQQUNJTkciLCJTbGlkZXJVbml0IiwiY29uc3RydWN0b3IiLCJwcm9wZXJ0eSIsInJhbmdlIiwic3ltYm9sU3RyaW5nIiwibmFtZVN0cmluZyIsInVuaXRTdHJpbmdQcm9wZXJ0eSIsImxhYmVsQ29udGVudCIsIm9wdGlvbnMiLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInNsaWRlck9wdGlvbnMiLCJ0cmFja0ZpbGxFbmFibGVkIiwidGh1bWJGaWxsIiwidGh1bWJGaWxsSGlnaGxpZ2h0ZWQiLCJ0cmFja1NpemUiLCJTTElERVJfSEVJR0hUIiwidGh1bWJTaXplIiwiY29uc3RyYWluVmFsdWUiLCJ2YWx1ZSIsInRvRml4ZWROdW1iZXIiLCJkZWNpbWFsUGxhY2VzIiwic3RhcnREcmFnIiwiXyIsIm5vb3AiLCJlbmREcmFnIiwic291bmRHZW5lcmF0b3IiLCJrZXlib2FyZFN0ZXAiLCJzaGlmdEtleWJvYXJkU3RlcCIsInJvdW5kVG9TdGVwU2l6ZSIsImNvbnRhaW5lclRhZ05hbWUiLCJsYWJlbFRhZ05hbWUiLCJhMTF5TWFwUERPTVZhbHVlIiwiY3JlYXRlVGFuZGVtIiwicHJvdmlkZWRTdGFydERyYWdGdW5jdGlvbiIsImV2ZW50IiwidHlwZSIsInNsaWRlckRyYWdnaW5nQnlLZXlib2FyZFByb3BlcnR5Iiwic2V0IiwicHJvdmlkZWRFbmREcmFnRnVuY3Rpb24iLCJzbGlkZXIiLCJzeW1ib2xUZXh0IiwiZm9udCIsIlNZTUJPTF9GT05UIiwiZmlsbCIsIkJMVUVfQ09MT1IiLCJtYXhXaWR0aCIsIlNMSURFUl9XSURUSCIsIm5hbWVUZXh0IiwiTkFNRV9GT05UIiwiaGVhZGVyTm9kZSIsImNoaWxkcmVuIiwiY2VudGVyIiwiY2VudGVyWCIsInkiLCJ2YWx1ZVRleHQiLCJ0b0ZpeGVkIiwibWF4IiwiUkVBRE9VVF9GT05UIiwiQkxBQ0tfQ09MT1IiLCJzdHJpbmdQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9SZWFkT25seSIsInVuaXRUZXh0IiwiVU5JVF9GT05UIiwibGVmdCIsInJpZ2h0IiwiVU5JVF9NQVhfV0lEVEgiLCJyZWFkb3V0IiwicmVhZG91dEJhY2tncm91bmQiLCJib3VuZHMiLCJhZGRDaGlsZCIsInNwYWNpbmciLCJsaW5rIiwic3RyaW5nIiwic2VsZkJvdW5kcyIsIm11dGF0ZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiU2xpZGVyVW5pdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNy0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTbGlkZXIgdW5pdCB3aXRoIGEgdmVydGljYWwgc2xpZGVyLCBhIGxhYmVsIGFib3ZlIHRoZSBzbGlkZXIgYW5kIGEgcmVhZG91dCBkaXNwbGF5IGJlbG93IHRoZSBzbGlkZXIuXHJcbiAqIEBhdXRob3IgTWFydGluIFZlaWxsZXR0ZSAoQmVyZWEgQ29sbGVnZSlcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IERpbWVuc2lvbjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0RpbWVuc2lvbjIuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IHsgTm9kZSwgUmVjdGFuZ2xlLCBUZXh0LCBWQm94IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFZTbGlkZXIgZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL1ZTbGlkZXIuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgb2htc0xhdyBmcm9tICcuLi8uLi9vaG1zTGF3LmpzJztcclxuaW1wb3J0IE9obXNMYXdDb25zdGFudHMgZnJvbSAnLi4vT2htc0xhd0NvbnN0YW50cy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgUkVBRE9VVF9TUEFDSU5HID0gNjtcclxuXHJcbmNsYXNzIFNsaWRlclVuaXQgZXh0ZW5kcyBOb2RlIHtcclxuICAvKipcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5LjxudW1iZXI+fSBwcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7UmFuZ2VXaXRoVmFsdWV9IHJhbmdlXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHN5bWJvbFN0cmluZ1xyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lU3RyaW5nXHJcbiAgICogQHBhcmFtIHtUUmVhZE9ubHlQcm9wZXJ0eS48c3RyaW5nPn0gdW5pdFN0cmluZ1Byb3BlcnR5XHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGxhYmVsQ29udGVudCAtIGExMXksIGxhYmVsIHJlYWQgYnkgYSBzY3JlZW4gcmVhZGVyIG9uIGZvY3VzXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBwcm9wZXJ0eSwgcmFuZ2UsIHN5bWJvbFN0cmluZywgbmFtZVN0cmluZywgdW5pdFN0cmluZ1Byb3BlcnR5LCBsYWJlbENvbnRlbnQsIG9wdGlvbnMgKSB7XHJcblxyXG5cclxuICAgIC8vIG9wdGlvbnMgdXNlZCBieSBvcHRpb25zIGJlbG93XHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuXHJcbiAgICAgIC8vIHBoZXQtaW9cclxuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRUQgLy8gdG8gYmUgcGFzc2VkIHRvIHN1cGVydHlwZVxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG4gICAgICBzbGlkZXJPcHRpb25zOiB7XHJcbiAgICAgICAgdHJhY2tGaWxsRW5hYmxlZDogJ2JsYWNrJyxcclxuICAgICAgICB0aHVtYkZpbGw6ICcjYzNjNGM1JyxcclxuICAgICAgICB0aHVtYkZpbGxIaWdobGlnaHRlZDogJyNkZWRlZGUnLFxyXG4gICAgICAgIHRyYWNrU2l6ZTogbmV3IERpbWVuc2lvbjIoIDQsIE9obXNMYXdDb25zdGFudHMuU0xJREVSX0hFSUdIVCApLFxyXG4gICAgICAgIHRodW1iU2l6ZTogbmV3IERpbWVuc2lvbjIoIDQ1LCAyMiApLFxyXG5cclxuICAgICAgICAvLyBEb24ndCBhbGxvdyBhbnkgdmFsdWVzIHRoYXQgY2Fubm90IGJlIGRpc3BsYXllZCBieSB0aGUgcHJlY2lzaW9uIGFsbG93ZWQgaW4gdGhpcyBzaW0uXHJcbiAgICAgICAgY29uc3RyYWluVmFsdWU6IHZhbHVlID0+IFV0aWxzLnRvRml4ZWROdW1iZXIoIHZhbHVlLCBvcHRpb25zLmRlY2ltYWxQbGFjZXMgKSxcclxuXHJcbiAgICAgICAgc3RhcnREcmFnOiBfLm5vb3AsXHJcbiAgICAgICAgZW5kRHJhZzogXy5ub29wLFxyXG5cclxuICAgICAgICAvLyBUdXJuIG9mZiBkZWZhdWx0IHNvdW5kIGdlbmVyYXRpb24sIHNpbmNlIHRoaXMgZG9lcyBpdHMgb3duIGluIGEgaGlnaGx5IGN1c3RvbWl6ZWQgd2F5LlxyXG4gICAgICAgIHNvdW5kR2VuZXJhdG9yOiBudWxsLFxyXG5cclxuICAgICAgICAvLyBwZG9tXHJcbiAgICAgICAga2V5Ym9hcmRTdGVwOiAxLCAgLy8gZGVsdGEgZm9yIGtleWJvYXJkIHN0ZXBcclxuICAgICAgICBzaGlmdEtleWJvYXJkU3RlcDogMC4xLCAvLyBkZWx0YSB3aGVuIGhvbGRpbmcgc2hpZnRcclxuICAgICAgICByb3VuZFRvU3RlcFNpemU6IHRydWUsIC8vIHNvIGRlZmF1bHQga2V5Ym9hcmQgc3RlcCByb3VuZHMgdG8gcGVkYWdvZ2ljYWxseSB1c2VmdWwgdmFsdWVzXHJcbiAgICAgICAgY29udGFpbmVyVGFnTmFtZTogJ2RpdicsIC8vIHRoaXMgZGl2IGhlbHBzIHRoZSBhMTF5IHZpZXcgbG9vayBhIGJpdCBiZXR0ZXJcclxuICAgICAgICBsYWJlbENvbnRlbnQ6IGxhYmVsQ29udGVudCxcclxuICAgICAgICBsYWJlbFRhZ05hbWU6ICdsYWJlbCcsXHJcbiAgICAgICAgYTExeU1hcFBET01WYWx1ZTogdmFsdWUgPT4gVXRpbHMudG9GaXhlZE51bWJlciggdmFsdWUsIG9wdGlvbnMuZGVjaW1hbFBsYWNlcyApLFxyXG5cclxuICAgICAgICAvLyBwaGV0LWlvXHJcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdzbGlkZXInIClcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIHtudW1iZXJ9XHJcbiAgICAgIGRlY2ltYWxQbGFjZXM6IDBcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBvdmVycmlkZSB0aGUgc3RhcnQgYW5kIGVuZCBkcmFnIGZ1bmN0aW9ucyBpbiB0aGUgb3B0aW9uc1xyXG4gICAgY29uc3QgcHJvdmlkZWRTdGFydERyYWdGdW5jdGlvbiA9IG9wdGlvbnMuc2xpZGVyT3B0aW9ucy5zdGFydERyYWc7XHJcbiAgICBvcHRpb25zLnNsaWRlck9wdGlvbnMuc3RhcnREcmFnID0gZXZlbnQgPT4ge1xyXG4gICAgICBpZiAoIGV2ZW50LnR5cGUgPT09ICdrZXlkb3duJyApIHtcclxuICAgICAgICB0aGlzLnNsaWRlckRyYWdnaW5nQnlLZXlib2FyZFByb3BlcnR5LnNldCggdHJ1ZSApO1xyXG4gICAgICB9XHJcbiAgICAgIHByb3ZpZGVkU3RhcnREcmFnRnVuY3Rpb24gJiYgcHJvdmlkZWRTdGFydERyYWdGdW5jdGlvbigpO1xyXG4gICAgfTtcclxuICAgIGNvbnN0IHByb3ZpZGVkRW5kRHJhZ0Z1bmN0aW9uID0gb3B0aW9ucy5zbGlkZXJPcHRpb25zLmVuZERyYWc7XHJcbiAgICBvcHRpb25zLnNsaWRlck9wdGlvbnMuZW5kRHJhZyA9ICgpID0+IHtcclxuICAgICAgdGhpcy5zbGlkZXJEcmFnZ2luZ0J5S2V5Ym9hcmRQcm9wZXJ0eS5zZXQoIGZhbHNlICk7XHJcbiAgICAgIHByb3ZpZGVkRW5kRHJhZ0Z1bmN0aW9uICYmIHByb3ZpZGVkRW5kRHJhZ0Z1bmN0aW9uKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAocmVhZC1vbmx5KSB7Qm9vbGVhblByb3BlcnR5fSBpbmRpY2F0ZXMgaWYgdGhlIHNsaWRlciBpcyBiZWluZyBkcmFnZ2VkIHZpYSB0aGUga2V5Ym9hcmRcclxuICAgIHRoaXMuc2xpZGVyRHJhZ2dpbmdCeUtleWJvYXJkUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG5cclxuICAgIGNvbnN0IHNsaWRlciA9IG5ldyBWU2xpZGVyKCBwcm9wZXJ0eSwgcmFuZ2UsIG9wdGlvbnMuc2xpZGVyT3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IHN5bWJvbFRleHQgPSBuZXcgVGV4dCggc3ltYm9sU3RyaW5nLCB7XHJcbiAgICAgIGZvbnQ6IE9obXNMYXdDb25zdGFudHMuU1lNQk9MX0ZPTlQsXHJcbiAgICAgIGZpbGw6IE9obXNMYXdDb25zdGFudHMuQkxVRV9DT0xPUixcclxuICAgICAgbWF4V2lkdGg6IE9obXNMYXdDb25zdGFudHMuU0xJREVSX1dJRFRILFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3N5bWJvbFRleHQnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBuYW1lVGV4dCA9IG5ldyBUZXh0KCBuYW1lU3RyaW5nLCB7XHJcbiAgICAgIGZvbnQ6IE9obXNMYXdDb25zdGFudHMuTkFNRV9GT05ULFxyXG4gICAgICBmaWxsOiBPaG1zTGF3Q29uc3RhbnRzLkJMVUVfQ09MT1IsXHJcbiAgICAgIG1heFdpZHRoOiBPaG1zTGF3Q29uc3RhbnRzLlNMSURFUl9XSURUSCxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICduYW1lVGV4dCcgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHBvc2l0aW9uZWQgd2l0aCBgeWAgcmF0aGVyIHRoYW4gdXNpbmcgb3RoZXIgYm91bmRzIG1ldGhvZHMgc28gdGhlIHRleHQgaXMgYWxpZ25lZCBjb3JyZWN0bHkgYmVjYXVzZSB0ZXh0XHJcbiAgICAvLyBpcyBhbGlnbmVkIGF0IHkgPSAwLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL29obXMtbGF3L2lzc3Vlcy8xNDBcclxuICAgIGNvbnN0IGhlYWRlck5vZGUgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogWyBzeW1ib2xUZXh0LCBuYW1lVGV4dCBdXHJcbiAgICB9ICk7XHJcbiAgICBuYW1lVGV4dC5jZW50ZXIgPSBuZXcgVmVjdG9yMiggc3ltYm9sVGV4dC5jZW50ZXJYLCBzeW1ib2xUZXh0LnkgKyAxOCApO1xyXG5cclxuICAgIGNvbnN0IHZhbHVlVGV4dCA9IG5ldyBUZXh0KCBVdGlscy50b0ZpeGVkKCByYW5nZS5tYXgsIG9wdGlvbnMuZGVjaW1hbFBsYWNlcyApLCB7XHJcbiAgICAgIGZvbnQ6IE9obXNMYXdDb25zdGFudHMuUkVBRE9VVF9GT05ULFxyXG4gICAgICBmaWxsOiBPaG1zTGF3Q29uc3RhbnRzLkJMQUNLX0NPTE9SLFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3ZhbHVlVGV4dCcgKSxcclxuICAgICAgc3RyaW5nUHJvcGVydHlPcHRpb25zOiB7IHBoZXRpb1JlYWRPbmx5OiB0cnVlIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCB1bml0VGV4dCA9IG5ldyBUZXh0KCB1bml0U3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgZm9udDogT2htc0xhd0NvbnN0YW50cy5VTklUX0ZPTlQsXHJcbiAgICAgIGZpbGw6IE9obXNMYXdDb25zdGFudHMuQkxVRV9DT0xPUixcclxuICAgICAgbGVmdDogdmFsdWVUZXh0LnJpZ2h0IC8gMixcclxuXHJcbiAgICAgIC8vIFNpemUgdGhlIHVuaXQgdG8gYmUgYXMgYmlnIGFzIHBvc3NpYmxlIG5leHQgdG8gdGhlIHZhbHVlIHdpdGggc3BhY2luZy5cclxuICAgICAgbWF4V2lkdGg6IE9obXNMYXdDb25zdGFudHMuVU5JVF9NQVhfV0lEVEgsXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndW5pdFRleHQnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBUaGUgcmVhZG91dCBzaG91bGQgYmUgaG9yaXpvbnRhbGx5IGFsaWduZWRcclxuICAgIGNvbnN0IHJlYWRvdXQgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogWyB2YWx1ZVRleHQsIHVuaXRUZXh0IF1cclxuICAgIH0gKTtcclxuICAgIHZhbHVlVGV4dC5yaWdodCA9IHVuaXRUZXh0LmxlZnQgLSBSRUFET1VUX1NQQUNJTkc7XHJcblxyXG4gICAgLy8gVGhpcyBlbnN1cmVzIHRoYXQgYm90aCB0aGUgdmFsdWUgYW5kIHRoZSB1bml0IGFyZSBvbiB0aGUgc2FtZSBsaW5lLCBldmVuIGlmIHVuaXQgaGFzIGEgbGV0dGVyIHRoYXQgZGlwcyBcImJlbG93XCIgYSB3cml0aW5nIGxpbmUuXHJcbiAgICB2YWx1ZVRleHQueSA9IHVuaXRUZXh0Lnk7XHJcblxyXG4gICAgLy8gQmFja2dyb3VuZCBmb3IgY2VudGVyaW5nXHJcbiAgICBjb25zdCByZWFkb3V0QmFja2dyb3VuZCA9IFJlY3RhbmdsZS5ib3VuZHMoIHJlYWRvdXQuYm91bmRzLCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbIHJlYWRvdXQgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEFkZCBjb21wb25lbnRzIGluIGEgdmVydGljYWxseSBzcGFjZWQgc3RhY2tcclxuICAgIHRoaXMuYWRkQ2hpbGQoIG5ldyBWQm94KCB7XHJcbiAgICAgIHNwYWNpbmc6IDUsXHJcbiAgICAgIGNoaWxkcmVuOiBbIGhlYWRlck5vZGUsIHNsaWRlciwgcmVhZG91dEJhY2tncm91bmQgXVxyXG4gICAgfSApICk7XHJcblxyXG4gICAgLy8gVXBkYXRlIHZhbHVlIG9mIHRoZSByZWFkb3V0LiBQcmVzZW50IGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIHNpbXVsYXRpb247IG5vIG5lZWQgdG8gdW5saW5rLlxyXG4gICAgcHJvcGVydHkubGluayggdmFsdWUgPT4ge1xyXG4gICAgICB2YWx1ZVRleHQuc3RyaW5nID0gVXRpbHMudG9GaXhlZCggdmFsdWUsIG9wdGlvbnMuZGVjaW1hbFBsYWNlcyApO1xyXG4gICAgICB2YWx1ZVRleHQucmlnaHQgPSB1bml0VGV4dC5sZWZ0IC0gUkVBRE9VVF9TUEFDSU5HO1xyXG4gICAgICByZWFkb3V0LmNlbnRlclggPSByZWFkb3V0QmFja2dyb3VuZC5zZWxmQm91bmRzLmNlbnRlclg7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuICB9XHJcbn1cclxuXHJcbm9obXNMYXcucmVnaXN0ZXIoICdTbGlkZXJVbml0JywgU2xpZGVyVW5pdCApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgU2xpZGVyVW5pdDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsVUFBVSxNQUFNLGtDQUFrQztBQUN6RCxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxTQUFTQyxJQUFJLEVBQUVDLFNBQVMs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