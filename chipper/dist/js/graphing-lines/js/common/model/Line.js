// Copyright 2013-2023, University of Colorado Boulder

/**
 * An immutable line, described by 2 points, (x1,y1) and (x2,y2).
 * Slope components (rise and run) are signed relative to (x1,y1).
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Utils from '../../../../dot/js/Utils.js';
import Fraction from '../../../../phetcommon/js/model/Fraction.js';
import graphingLines from '../../graphingLines.js';
import GLColors from '../GLColors.js';
export default class Line {
  // points that define the line

  // slope = rise/run

  constructor(x1, y1, x2, y2, color = 'black') {
    // 2 different points are required
    assert && assert(x1 !== x2 || y1 !== y2, `points are the same: (${x1},${y1})`);
    this.x1 = x1;
    this.y1 = y1;
    this.x2 = x2;
    this.y2 = y2;
    this.rise = y2 - y1;
    this.run = x2 - x1;
    this.color = color || 'black';
  }

  // Convenience method for creating a line with a different color.
  withColor(color) {
    return new Line(this.x1, this.y1, this.x2, this.y2, color);
  }

  // For debugging, do not rely on format!
  toString() {
    return `Line[x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} rise=${this.rise} run=${this.run} color=${this.color.toString()}]`;
  }

  // Returns true if 2 points on the specified line are also on this line.
  same(line) {
    return this.onLineXY(line.x1, line.y1) && this.onLineXY(line.x2, line.y2);
  }

  // Returns true if the slope is undefined.
  undefinedSlope() {
    return this.run === 0;
  }

  // Gets the slope. Returns NaN if slope is undefined.
  getSlope() {
    if (this.undefinedSlope()) {
      return Number.NaN;
    } else {
      return this.rise / this.run;
    }
  }

  /*
   * Given x, solve y = m(x - x1) + y1
   * Returns NaN if the solution is not unique, or there is no solution (x can't possibly be on the line.)
   * This occurs when we have a vertical line, with no run.
   */
  solveY(x) {
    if (this.undefinedSlope()) {
      return Number.NaN;
    } else {
      return this.getSlope() * (x - this.x1) + this.y1;
    }
  }

  /*
   * Given y, solve x = ((y - y1)/m) + x1
   * Returns NaN if the solution is not unique (horizontal line) or the slope is undefined (vertical line).
   */
  solveX(y) {
    if (this.rise === 0 || this.run === 0) {
      return Number.NaN;
    } else {
      return (y - this.y1) / (this.rise / this.run) + this.x1;
    }
  }

  // Gets the simplified rise.
  getSimplifiedRise() {
    if (this.slopeIsSimplifiable()) {
      return Utils.roundSymmetric(this.rise / Utils.gcd(this.rise, this.run));
    } else {
      return this.rise;
    }
  }

  // Gets the simplified run.
  getSimplifiedRun() {
    if (this.slopeIsSimplifiable()) {
      return Utils.roundSymmetric(this.run / Utils.gcd(this.rise, this.run));
    } else {
      return this.run;
    }
  }

  /*
   * Simplification uses Euclid's algorithm for computing the greatest common divisor (GCD) of non-zero integers,
   * so slope can be simplified only if the rise and run meet that criteria.
   */
  slopeIsSimplifiable() {
    return this.rise !== 0 && this.run !== 0 && Number.isInteger(this.rise) && Number.isInteger(this.run);
  }

  /**
   * Returns true if point is on this line.
   */
  onLinePoint(p) {
    return this.onLineXY(p.x, p.y);
  }
  onLineXY(x, y) {
    if (this.rise === 0) {
      return y === this.y1;
    } else if (this.run === 0) {
      return x === this.x1;
    } else {
      // account for floating point errors, see https://github.com/phetsims/graphing-lines/issues/56
      return Math.abs(x - this.solveX(y)) < 1E-10;
    }
  }

  /**
   * Gets the y-intercept as a simplified fraction.
   * This is valid only if (x1,y1) and (x2,y2) are at integer positions on the grid.
   */
  getYIntercept() {
    assert && assert(Number.isInteger(this.x1) && Number.isInteger(this.y1) && Number.isInteger(this.rise) && Number.isInteger(this.run));
    if (this.rise === 0 || this.run === 0) {
      return new Fraction(this.y1, 1); // not technically correct for run===0, but gives the desired result in slope-intercept equations
    }

    const numerator = Utils.roundSymmetric(this.y1 * this.run - this.x1 * this.rise);
    const denominator = this.run;
    const gcd = Utils.gcd(numerator, denominator);
    return new Fraction(Utils.roundSymmetric(numerator / gcd), Utils.roundSymmetric(denominator / gcd));
  }

  /**
   * Creates a line by describing it in point-slope form: (y - y1) = m(x - x1)
   */
  static createPointSlope(x1, y1, rise, run, color) {
    return new Line(x1, y1, x1 + run, y1 + rise, color);
  }

  /**
   * Creates a line by describing it in slope-intercept form: y = mx + b
   */
  static createSlopeIntercept(rise, run, yIntercept, color) {
    return Line.createPointSlope(0, yIntercept, rise, run, color);
  }

  // y = x (a standard line)
  static Y_EQUALS_X_LINE = new Line(0, 0, 1, 1, GLColors.Y_EQUALS_X);

  // y = -x (a standard line)
  static Y_EQUALS_NEGATIVE_X_LINE = new Line(0, 0, 1, -1, GLColors.Y_EQUALS_NEGATIVE_X);
}
graphingLines.register('Line', Line);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIkZyYWN0aW9uIiwiZ3JhcGhpbmdMaW5lcyIsIkdMQ29sb3JzIiwiTGluZSIsImNvbnN0cnVjdG9yIiwieDEiLCJ5MSIsIngyIiwieTIiLCJjb2xvciIsImFzc2VydCIsInJpc2UiLCJydW4iLCJ3aXRoQ29sb3IiLCJ0b1N0cmluZyIsInNhbWUiLCJsaW5lIiwib25MaW5lWFkiLCJ1bmRlZmluZWRTbG9wZSIsImdldFNsb3BlIiwiTnVtYmVyIiwiTmFOIiwic29sdmVZIiwieCIsInNvbHZlWCIsInkiLCJnZXRTaW1wbGlmaWVkUmlzZSIsInNsb3BlSXNTaW1wbGlmaWFibGUiLCJyb3VuZFN5bW1ldHJpYyIsImdjZCIsImdldFNpbXBsaWZpZWRSdW4iLCJpc0ludGVnZXIiLCJvbkxpbmVQb2ludCIsInAiLCJNYXRoIiwiYWJzIiwiZ2V0WUludGVyY2VwdCIsIm51bWVyYXRvciIsImRlbm9taW5hdG9yIiwiY3JlYXRlUG9pbnRTbG9wZSIsImNyZWF0ZVNsb3BlSW50ZXJjZXB0IiwieUludGVyY2VwdCIsIllfRVFVQUxTX1hfTElORSIsIllfRVFVQUxTX1giLCJZX0VRVUFMU19ORUdBVElWRV9YX0xJTkUiLCJZX0VRVUFMU19ORUdBVElWRV9YIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJMaW5lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDEzLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEFuIGltbXV0YWJsZSBsaW5lLCBkZXNjcmliZWQgYnkgMiBwb2ludHMsICh4MSx5MSkgYW5kICh4Mix5MikuXHJcbiAqIFNsb3BlIGNvbXBvbmVudHMgKHJpc2UgYW5kIHJ1bikgYXJlIHNpZ25lZCByZWxhdGl2ZSB0byAoeDEseTEpLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBGcmFjdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL21vZGVsL0ZyYWN0aW9uLmpzJztcclxuaW1wb3J0IHsgQ29sb3IgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZ3JhcGhpbmdMaW5lcyBmcm9tICcuLi8uLi9ncmFwaGluZ0xpbmVzLmpzJztcclxuaW1wb3J0IEdMQ29sb3JzIGZyb20gJy4uL0dMQ29sb3JzLmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExpbmUge1xyXG5cclxuICAvLyBwb2ludHMgdGhhdCBkZWZpbmUgdGhlIGxpbmVcclxuICBwdWJsaWMgcmVhZG9ubHkgeDE6IG51bWJlcjtcclxuICBwdWJsaWMgcmVhZG9ubHkgeTE6IG51bWJlcjtcclxuICBwdWJsaWMgcmVhZG9ubHkgeDI6IG51bWJlcjtcclxuICBwdWJsaWMgcmVhZG9ubHkgeTI6IG51bWJlcjtcclxuXHJcbiAgLy8gc2xvcGUgPSByaXNlL3J1blxyXG4gIHB1YmxpYyByZWFkb25seSByaXNlOiBudW1iZXI7XHJcbiAgcHVibGljIHJlYWRvbmx5IHJ1bjogbnVtYmVyO1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgY29sb3I6IENvbG9yIHwgc3RyaW5nO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHgxOiBudW1iZXIsIHkxOiBudW1iZXIsIHgyOiBudW1iZXIsIHkyOiBudW1iZXIsIGNvbG9yOiBDb2xvciB8IHN0cmluZyA9ICdibGFjaycgKSB7XHJcblxyXG4gICAgLy8gMiBkaWZmZXJlbnQgcG9pbnRzIGFyZSByZXF1aXJlZFxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggeDEgIT09IHgyIHx8IHkxICE9PSB5MiwgYHBvaW50cyBhcmUgdGhlIHNhbWU6ICgke3gxfSwke3kxfSlgICk7XHJcblxyXG4gICAgdGhpcy54MSA9IHgxO1xyXG4gICAgdGhpcy55MSA9IHkxO1xyXG4gICAgdGhpcy54MiA9IHgyO1xyXG4gICAgdGhpcy55MiA9IHkyO1xyXG4gICAgdGhpcy5yaXNlID0geTIgLSB5MTtcclxuICAgIHRoaXMucnVuID0geDIgLSB4MTtcclxuICAgIHRoaXMuY29sb3IgPSBjb2xvciB8fCAnYmxhY2snO1xyXG4gIH1cclxuXHJcbiAgLy8gQ29udmVuaWVuY2UgbWV0aG9kIGZvciBjcmVhdGluZyBhIGxpbmUgd2l0aCBhIGRpZmZlcmVudCBjb2xvci5cclxuICBwdWJsaWMgd2l0aENvbG9yKCBjb2xvcjogQ29sb3IgfCBzdHJpbmcgKTogTGluZSB7XHJcbiAgICByZXR1cm4gbmV3IExpbmUoIHRoaXMueDEsIHRoaXMueTEsIHRoaXMueDIsIHRoaXMueTIsIGNvbG9yICk7XHJcbiAgfVxyXG5cclxuICAvLyBGb3IgZGVidWdnaW5nLCBkbyBub3QgcmVseSBvbiBmb3JtYXQhXHJcbiAgcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gYExpbmVbeDE9JHt0aGlzLngxfSB5MT0ke3RoaXMueTF9IHgyPSR7dGhpcy54Mn0geTI9JHt0aGlzLnkyXHJcbiAgICB9IHJpc2U9JHt0aGlzLnJpc2V9IHJ1bj0ke3RoaXMucnVufSBjb2xvcj0ke3RoaXMuY29sb3IudG9TdHJpbmcoKX1dYDtcclxuICB9XHJcblxyXG4gIC8vIFJldHVybnMgdHJ1ZSBpZiAyIHBvaW50cyBvbiB0aGUgc3BlY2lmaWVkIGxpbmUgYXJlIGFsc28gb24gdGhpcyBsaW5lLlxyXG4gIHB1YmxpYyBzYW1lKCBsaW5lOiBMaW5lICk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMub25MaW5lWFkoIGxpbmUueDEsIGxpbmUueTEgKSAmJiB0aGlzLm9uTGluZVhZKCBsaW5lLngyLCBsaW5lLnkyICk7XHJcbiAgfVxyXG5cclxuICAvLyBSZXR1cm5zIHRydWUgaWYgdGhlIHNsb3BlIGlzIHVuZGVmaW5lZC5cclxuICBwdWJsaWMgdW5kZWZpbmVkU2xvcGUoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKCB0aGlzLnJ1biA9PT0gMCApO1xyXG4gIH1cclxuXHJcbiAgLy8gR2V0cyB0aGUgc2xvcGUuIFJldHVybnMgTmFOIGlmIHNsb3BlIGlzIHVuZGVmaW5lZC5cclxuICBwdWJsaWMgZ2V0U2xvcGUoKTogbnVtYmVyIHtcclxuICAgIGlmICggdGhpcy51bmRlZmluZWRTbG9wZSgpICkge1xyXG4gICAgICByZXR1cm4gTnVtYmVyLk5hTjtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhpcy5yaXNlIC8gdGhpcy5ydW47XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIEdpdmVuIHgsIHNvbHZlIHkgPSBtKHggLSB4MSkgKyB5MVxyXG4gICAqIFJldHVybnMgTmFOIGlmIHRoZSBzb2x1dGlvbiBpcyBub3QgdW5pcXVlLCBvciB0aGVyZSBpcyBubyBzb2x1dGlvbiAoeCBjYW4ndCBwb3NzaWJseSBiZSBvbiB0aGUgbGluZS4pXHJcbiAgICogVGhpcyBvY2N1cnMgd2hlbiB3ZSBoYXZlIGEgdmVydGljYWwgbGluZSwgd2l0aCBubyBydW4uXHJcbiAgICovXHJcbiAgcHVibGljIHNvbHZlWSggeDogbnVtYmVyICk6IG51bWJlciB7XHJcbiAgICBpZiAoIHRoaXMudW5kZWZpbmVkU2xvcGUoKSApIHtcclxuICAgICAgcmV0dXJuIE51bWJlci5OYU47XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgcmV0dXJuICggdGhpcy5nZXRTbG9wZSgpICogKCB4IC0gdGhpcy54MSApICkgKyB0aGlzLnkxO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiBHaXZlbiB5LCBzb2x2ZSB4ID0gKCh5IC0geTEpL20pICsgeDFcclxuICAgKiBSZXR1cm5zIE5hTiBpZiB0aGUgc29sdXRpb24gaXMgbm90IHVuaXF1ZSAoaG9yaXpvbnRhbCBsaW5lKSBvciB0aGUgc2xvcGUgaXMgdW5kZWZpbmVkICh2ZXJ0aWNhbCBsaW5lKS5cclxuICAgKi9cclxuICBwdWJsaWMgc29sdmVYKCB5OiBudW1iZXIgKTogbnVtYmVyIHtcclxuICAgIGlmICggdGhpcy5yaXNlID09PSAwIHx8IHRoaXMucnVuID09PSAwICkge1xyXG4gICAgICByZXR1cm4gTnVtYmVyLk5hTjtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICByZXR1cm4gKCAoIHkgLSB0aGlzLnkxICkgLyAoIHRoaXMucmlzZSAvIHRoaXMucnVuICkgKSArIHRoaXMueDE7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBHZXRzIHRoZSBzaW1wbGlmaWVkIHJpc2UuXHJcbiAgcHVibGljIGdldFNpbXBsaWZpZWRSaXNlKCk6IG51bWJlciB7XHJcbiAgICBpZiAoIHRoaXMuc2xvcGVJc1NpbXBsaWZpYWJsZSgpICkge1xyXG4gICAgICByZXR1cm4gVXRpbHMucm91bmRTeW1tZXRyaWMoIHRoaXMucmlzZSAvIFV0aWxzLmdjZCggdGhpcy5yaXNlLCB0aGlzLnJ1biApICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMucmlzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEdldHMgdGhlIHNpbXBsaWZpZWQgcnVuLlxyXG4gIHB1YmxpYyBnZXRTaW1wbGlmaWVkUnVuKCk6IG51bWJlciB7XHJcbiAgICBpZiAoIHRoaXMuc2xvcGVJc1NpbXBsaWZpYWJsZSgpICkge1xyXG4gICAgICByZXR1cm4gVXRpbHMucm91bmRTeW1tZXRyaWMoIHRoaXMucnVuIC8gVXRpbHMuZ2NkKCB0aGlzLnJpc2UsIHRoaXMucnVuICkgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhpcy5ydW47XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIFNpbXBsaWZpY2F0aW9uIHVzZXMgRXVjbGlkJ3MgYWxnb3JpdGhtIGZvciBjb21wdXRpbmcgdGhlIGdyZWF0ZXN0IGNvbW1vbiBkaXZpc29yIChHQ0QpIG9mIG5vbi16ZXJvIGludGVnZXJzLFxyXG4gICAqIHNvIHNsb3BlIGNhbiBiZSBzaW1wbGlmaWVkIG9ubHkgaWYgdGhlIHJpc2UgYW5kIHJ1biBtZWV0IHRoYXQgY3JpdGVyaWEuXHJcbiAgICovXHJcbiAgcHVibGljIHNsb3BlSXNTaW1wbGlmaWFibGUoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKCB0aGlzLnJpc2UgIT09IDAgKSAmJiAoIHRoaXMucnVuICE9PSAwICkgJiYgTnVtYmVyLmlzSW50ZWdlciggdGhpcy5yaXNlICkgJiYgTnVtYmVyLmlzSW50ZWdlciggdGhpcy5ydW4gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdHJ1ZSBpZiBwb2ludCBpcyBvbiB0aGlzIGxpbmUuXHJcbiAgICovXHJcbiAgcHVibGljIG9uTGluZVBvaW50KCBwOiBWZWN0b3IyICk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMub25MaW5lWFkoIHAueCwgcC55ICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uTGluZVhZKCB4OiBudW1iZXIsIHk6IG51bWJlciApOiBib29sZWFuIHtcclxuICAgIGlmICggdGhpcy5yaXNlID09PSAwICkge1xyXG4gICAgICByZXR1cm4gKCB5ID09PSB0aGlzLnkxICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggdGhpcy5ydW4gPT09IDAgKSB7XHJcbiAgICAgIHJldHVybiAoIHggPT09IHRoaXMueDEgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAvLyBhY2NvdW50IGZvciBmbG9hdGluZyBwb2ludCBlcnJvcnMsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZ3JhcGhpbmctbGluZXMvaXNzdWVzLzU2XHJcbiAgICAgIHJldHVybiAoIE1hdGguYWJzKCB4IC0gdGhpcy5zb2x2ZVgoIHkgKSApIDwgMUUtMTAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIHktaW50ZXJjZXB0IGFzIGEgc2ltcGxpZmllZCBmcmFjdGlvbi5cclxuICAgKiBUaGlzIGlzIHZhbGlkIG9ubHkgaWYgKHgxLHkxKSBhbmQgKHgyLHkyKSBhcmUgYXQgaW50ZWdlciBwb3NpdGlvbnMgb24gdGhlIGdyaWQuXHJcbiAgICovXHJcbiAgcHVibGljIGdldFlJbnRlcmNlcHQoKTogRnJhY3Rpb24ge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggTnVtYmVyLmlzSW50ZWdlciggdGhpcy54MSApICYmIE51bWJlci5pc0ludGVnZXIoIHRoaXMueTEgKSAmJiBOdW1iZXIuaXNJbnRlZ2VyKCB0aGlzLnJpc2UgKSAmJiBOdW1iZXIuaXNJbnRlZ2VyKCB0aGlzLnJ1biApICk7XHJcbiAgICBpZiAoIHRoaXMucmlzZSA9PT0gMCB8fCB0aGlzLnJ1biA9PT0gMCApIHtcclxuICAgICAgcmV0dXJuIG5ldyBGcmFjdGlvbiggdGhpcy55MSwgMSApOyAvLyBub3QgdGVjaG5pY2FsbHkgY29ycmVjdCBmb3IgcnVuPT09MCwgYnV0IGdpdmVzIHRoZSBkZXNpcmVkIHJlc3VsdCBpbiBzbG9wZS1pbnRlcmNlcHQgZXF1YXRpb25zXHJcbiAgICB9XHJcbiAgICBjb25zdCBudW1lcmF0b3IgPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggKCB0aGlzLnkxICogdGhpcy5ydW4gKSAtICggdGhpcy54MSAqIHRoaXMucmlzZSApICk7XHJcbiAgICBjb25zdCBkZW5vbWluYXRvciA9IHRoaXMucnVuO1xyXG4gICAgY29uc3QgZ2NkID0gVXRpbHMuZ2NkKCBudW1lcmF0b3IsIGRlbm9taW5hdG9yICk7XHJcbiAgICByZXR1cm4gbmV3IEZyYWN0aW9uKCBVdGlscy5yb3VuZFN5bW1ldHJpYyggbnVtZXJhdG9yIC8gZ2NkICksIFV0aWxzLnJvdW5kU3ltbWV0cmljKCBkZW5vbWluYXRvciAvIGdjZCApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgbGluZSBieSBkZXNjcmliaW5nIGl0IGluIHBvaW50LXNsb3BlIGZvcm06ICh5IC0geTEpID0gbSh4IC0geDEpXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVQb2ludFNsb3BlKCB4MTogbnVtYmVyLCB5MTogbnVtYmVyLCByaXNlOiBudW1iZXIsIHJ1bjogbnVtYmVyLCBjb2xvcj86IENvbG9yIHwgc3RyaW5nICk6IExpbmUge1xyXG4gICAgcmV0dXJuIG5ldyBMaW5lKCB4MSwgeTEsIHgxICsgcnVuLCB5MSArIHJpc2UsIGNvbG9yICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgbGluZSBieSBkZXNjcmliaW5nIGl0IGluIHNsb3BlLWludGVyY2VwdCBmb3JtOiB5ID0gbXggKyBiXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVTbG9wZUludGVyY2VwdCggcmlzZTogbnVtYmVyLCBydW46IG51bWJlciwgeUludGVyY2VwdDogbnVtYmVyLCBjb2xvcj86IENvbG9yIHwgc3RyaW5nICk6IExpbmUge1xyXG4gICAgcmV0dXJuIExpbmUuY3JlYXRlUG9pbnRTbG9wZSggMCwgeUludGVyY2VwdCwgcmlzZSwgcnVuLCBjb2xvciApO1xyXG4gIH1cclxuXHJcbiAgLy8geSA9IHggKGEgc3RhbmRhcmQgbGluZSlcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IFlfRVFVQUxTX1hfTElORSA9IG5ldyBMaW5lKCAwLCAwLCAxLCAxLCBHTENvbG9ycy5ZX0VRVUFMU19YICk7XHJcblxyXG4gIC8vIHkgPSAteCAoYSBzdGFuZGFyZCBsaW5lKVxyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgWV9FUVVBTFNfTkVHQVRJVkVfWF9MSU5FID0gbmV3IExpbmUoIDAsIDAsIDEsIC0xLCBHTENvbG9ycy5ZX0VRVUFMU19ORUdBVElWRV9YICk7XHJcbn1cclxuXHJcbmdyYXBoaW5nTGluZXMucmVnaXN0ZXIoICdMaW5lJywg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