// Copyright 2013-2023, University of Colorado Boulder

/**
 * LineNode is the visual representation of a line.
 * By default, a line is not labeled with an equation. Clients are responsible for decorating the line
 * with an equation of the correct form (slope, slope-intercept, point-slope.) The line's equation is
 * positioned towards the tip, parallel with the line.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Dimension2 from '../../../../dot/js/Dimension2.js';
import optionize from '../../../../phet-core/js/optionize.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import { Line as SceneryLine, Node } from '../../../../scenery/js/imports.js';
import graphingLines from '../../graphingLines.js';
import Line from '../model/Line.js';
// constants
const HEAD_SIZE = new Dimension2(10, 10);
const TAIL_WIDTH = 3;
const LINE_EXTENT = 25; // how far the line extends past the grid
const EQUATION_FONT_SIZE = 18;

// Options for SCENERY_PHET/ArrowNode
const ARROW_NODE_OPTIONS = {
  doubleHead: true,
  tailWidth: TAIL_WIDTH,
  headWidth: HEAD_SIZE.width,
  headHeight: HEAD_SIZE.height,
  stroke: null
};

// Options for SCENERY/Line
const SCENERY_LINE_OPTIONS = {
  lineWidth: TAIL_WIDTH
};

// Options for SelfOptions.createDynamicLabel

export default class LineNode extends Node {
  // parent of all children
  // One of these will be instantiated, based on the value of SelfOptions.hasArrows.
  // optional equationNode and its parent.
  constructor(lineProperty, graph, modelViewTransform, providedOptions) {
    const options = optionize()({
      // SelfOptions
      hasArrows: true
    }, providedOptions);
    super();
    this.lineProperty = lineProperty;
    this.graph = graph;
    this.modelViewTransform = modelViewTransform;
    this.xExtent = modelViewTransform.viewToModelDeltaX(LINE_EXTENT);
    this.yExtent = Math.abs(modelViewTransform.viewToModelDeltaY(LINE_EXTENT));
    this.parentNode = new Node();
    if (options.hasArrows) {
      this.arrowNode = new ArrowNode(0, 0, 0, 1, ARROW_NODE_OPTIONS);
      this.parentNode.addChild(this.arrowNode);
    } else {
      this.lineNode = new SceneryLine(0, 0, 0, 0, SCENERY_LINE_OPTIONS);
      this.parentNode.addChild(this.lineNode);
    }
    if (options.createDynamicLabel) {
      this.equationNode = options.createDynamicLabel(lineProperty, {
        fontSize: EQUATION_FONT_SIZE
      });

      // Rotation is applied to equationParentNode. This makes positioning the equation a little easier to grok.
      this.equationParentNode = new Node({
        children: [this.equationNode]
      });
      this.parentNode.addChild(this.equationParentNode);
    }
    this.addChild(this.parentNode);
    const lineObserver = line => this.update(line);
    lineProperty.link(lineObserver); // unlink in dispose

    this.disposeLineNode = () => {
      this.equationNode && this.equationNode.dispose();
      lineProperty.unlink(lineObserver);
    };
  }
  dispose() {
    this.disposeLineNode();
    super.dispose();
  }
  setEquationVisible(visible) {
    assert && assert(this.equationParentNode);
    if (this.equationParentNode) {
      this.equationParentNode.visible = visible;
    }
  }

  // Updates the line and equation.
  update(line) {
    // line may be NotALine, for example the user's guess in 'Place The Points' challenge
    const isALine = line instanceof Line;
    this.parentNode.visible = isALine;
    if (!isALine) {
      return;
    }

    // compute the new tip and tail for the line
    const xRange = this.graph.xRange;
    const yRange = this.graph.yRange;
    let tailX;
    let tailY;
    let tipX;
    let tipY;
    if (line.run === 0) {
      // x = 0
      tailX = line.x1;
      tailY = yRange.max + this.yExtent;
      tipX = line.x1;
      tipY = yRange.min - this.yExtent;
    } else if (line.rise === 0) {
      // y = b
      tailX = xRange.min - this.xExtent;
      tailY = line.y1;
      tipX = xRange.max + this.yExtent;
      tipY = line.y1;
    } else {
      // tail is the left-most end point. Compute x such that the point is inside the grid.
      tailX = xRange.min - this.xExtent;
      tailY = line.solveY(tailX);
      if (tailY < yRange.min - this.yExtent) {
        tailX = line.solveX(yRange.min - this.yExtent);
        tailY = line.solveY(tailX);
      } else if (tailY > yRange.max + this.yExtent) {
        tailX = line.solveX(yRange.max + this.yExtent);
        tailY = line.solveY(tailX);
      }

      // tip is the right-most end point. Compute x such that the point is inside the grid.
      tipX = xRange.max + this.xExtent;
      tipY = line.solveY(tipX);
      if (tipY < yRange.min - this.yExtent) {
        tipX = line.solveX(yRange.min - this.yExtent);
        tipY = line.solveY(tipX);
      } else if (tipY > yRange.max + this.yExtent) {
        tipX = line.solveX(yRange.max + this.yExtent);
        tipY = line.solveY(tipX);
      }
    }

    // line
    const tailPosition = this.modelViewTransform.modelToViewXY(tailX, tailY);
    const tipPosition = this.modelViewTransform.modelToViewXY(tipX, tipY);
    if (this.arrowNode) {
      this.arrowNode.setTailAndTip(tailPosition.x, tailPosition.y, tipPosition.x, tipPosition.y);
      this.arrowNode.fill = line.color;
    } else {
      const lineNode = this.lineNode;
      assert && assert(lineNode);
      lineNode.setLine(tailPosition.x, tailPosition.y, tipPosition.x, tipPosition.y);
      lineNode.stroke = line.color;
    }

    /*
     * If this line has an equation, update its orientation and position.
     * Rotation is applied to equationParentNode.
     * Translation is applied to equationNode, relative to a horizontal line whose tip points right.
     */
    if (this.equationNode) {
      const equationParentNode = this.equationParentNode;
      assert && assert(equationParentNode);
      equationParentNode.rotation = line.undefinedSlope() ? Math.PI / 2 : -Math.atan(line.getSlope());

      // Equations have some invisible nodes. Compensate so that layout is for visible nodes.
      const equationBounds = this.equationNode.bounds;
      const equationVisibleBounds = this.equationNode.visibleBounds;
      const leftOffset = equationVisibleBounds.left - equationBounds.left;
      const rightOffset = equationBounds.right - equationVisibleBounds.right;
      const topOffset = equationVisibleBounds.top - equationBounds.top;
      const bottomOffset = equationBounds.bottom - equationVisibleBounds.bottom;

      // Put the equation where it won't interfere with slope tool or y-axis, at the end of the line that would have the slope manipulator.
      const X_OFFSET = 60;
      const Y_OFFSET = 12;
      if (line.undefinedSlope()) {
        // This puts the 'undefined slope' label to the right of the y-axis, at the same end of the line as the slope manipulator.
        if (line.rise < 0) {
          equationParentNode.translation = tipPosition;
          this.equationNode.right = -X_OFFSET + rightOffset;
          this.equationNode.bottom = -Y_OFFSET + bottomOffset;
        } else {
          equationParentNode.translation = tailPosition;
          this.equationNode.left = X_OFFSET - leftOffset;
          this.equationNode.bottom = -Y_OFFSET + bottomOffset;
        }
      } else if (line.rise <= 0) {
        if (line.run >= 0) {
          // quadrant 4: equation above the line, at tip (right)
          equationParentNode.translation = tipPosition;
          this.equationNode.right = -X_OFFSET + rightOffset;
          this.equationNode.bottom = -Y_OFFSET + bottomOffset;
        } else {
          // quadrant 3: equation above the line, at tail (left)
          equationParentNode.translation = tailPosition;
          this.equationNode.left = X_OFFSET - leftOffset;
          this.equationNode.bottom = -Y_OFFSET + bottomOffset;
        }
      } else {
        if (line.run > 0) {
          // quadrant 1: equation below the line, at tip (right)
          equationParentNode.translation = tipPosition;
          this.equationNode.right = -X_OFFSET + rightOffset;
          this.equationNode.top = Y_OFFSET - topOffset;
        } else {
          // quadrant 2: equation below the line, at tail (left)
          equationParentNode.translation = tailPosition;
          this.equationNode.left = X_OFFSET - leftOffset;
          this.equationNode.top = Y_OFFSET - topOffset;
        }
      }
    }
  }
}
graphingLines.register('LineNode', LineNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEaW1lbnNpb24yIiwib3B0aW9uaXplIiwiQXJyb3dOb2RlIiwiTGluZSIsIlNjZW5lcnlMaW5lIiwiTm9kZSIsImdyYXBoaW5nTGluZXMiLCJIRUFEX1NJWkUiLCJUQUlMX1dJRFRIIiwiTElORV9FWFRFTlQiLCJFUVVBVElPTl9GT05UX1NJWkUiLCJBUlJPV19OT0RFX09QVElPTlMiLCJkb3VibGVIZWFkIiwidGFpbFdpZHRoIiwiaGVhZFdpZHRoIiwid2lkdGgiLCJoZWFkSGVpZ2h0IiwiaGVpZ2h0Iiwic3Ryb2tlIiwiU0NFTkVSWV9MSU5FX09QVElPTlMiLCJsaW5lV2lkdGgiLCJMaW5lTm9kZSIsImNvbnN0cnVjdG9yIiwibGluZVByb3BlcnR5IiwiZ3JhcGgiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiaGFzQXJyb3dzIiwieEV4dGVudCIsInZpZXdUb01vZGVsRGVsdGFYIiwieUV4dGVudCIsIk1hdGgiLCJhYnMiLCJ2aWV3VG9Nb2RlbERlbHRhWSIsInBhcmVudE5vZGUiLCJhcnJvd05vZGUiLCJhZGRDaGlsZCIsImxpbmVOb2RlIiwiY3JlYXRlRHluYW1pY0xhYmVsIiwiZXF1YXRpb25Ob2RlIiwiZm9udFNpemUiLCJlcXVhdGlvblBhcmVudE5vZGUiLCJjaGlsZHJlbiIsImxpbmVPYnNlcnZlciIsImxpbmUiLCJ1cGRhdGUiLCJsaW5rIiwiZGlzcG9zZUxpbmVOb2RlIiwiZGlzcG9zZSIsInVubGluayIsInNldEVxdWF0aW9uVmlzaWJsZSIsInZpc2libGUiLCJhc3NlcnQiLCJpc0FMaW5lIiwieFJhbmdlIiwieVJhbmdlIiwidGFpbFgiLCJ0YWlsWSIsInRpcFgiLCJ0aXBZIiwicnVuIiwieDEiLCJtYXgiLCJtaW4iLCJyaXNlIiwieTEiLCJzb2x2ZVkiLCJzb2x2ZVgiLCJ0YWlsUG9zaXRpb24iLCJtb2RlbFRvVmlld1hZIiwidGlwUG9zaXRpb24iLCJzZXRUYWlsQW5kVGlwIiwieCIsInkiLCJmaWxsIiwiY29sb3IiLCJzZXRMaW5lIiwicm90YXRpb24iLCJ1bmRlZmluZWRTbG9wZSIsIlBJIiwiYXRhbiIsImdldFNsb3BlIiwiZXF1YXRpb25Cb3VuZHMiLCJib3VuZHMiLCJlcXVhdGlvblZpc2libGVCb3VuZHMiLCJ2aXNpYmxlQm91bmRzIiwibGVmdE9mZnNldCIsImxlZnQiLCJyaWdodE9mZnNldCIsInJpZ2h0IiwidG9wT2Zmc2V0IiwidG9wIiwiYm90dG9tT2Zmc2V0IiwiYm90dG9tIiwiWF9PRkZTRVQiLCJZX09GRlNFVCIsInRyYW5zbGF0aW9uIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJMaW5lTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxMy0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBMaW5lTm9kZSBpcyB0aGUgdmlzdWFsIHJlcHJlc2VudGF0aW9uIG9mIGEgbGluZS5cclxuICogQnkgZGVmYXVsdCwgYSBsaW5lIGlzIG5vdCBsYWJlbGVkIHdpdGggYW4gZXF1YXRpb24uIENsaWVudHMgYXJlIHJlc3BvbnNpYmxlIGZvciBkZWNvcmF0aW5nIHRoZSBsaW5lXHJcbiAqIHdpdGggYW4gZXF1YXRpb24gb2YgdGhlIGNvcnJlY3QgZm9ybSAoc2xvcGUsIHNsb3BlLWludGVyY2VwdCwgcG9pbnQtc2xvcGUuKSBUaGUgbGluZSdzIGVxdWF0aW9uIGlzXHJcbiAqIHBvc2l0aW9uZWQgdG93YXJkcyB0aGUgdGlwLCBwYXJhbGxlbCB3aXRoIHRoZSBsaW5lLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IERpbWVuc2lvbjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0RpbWVuc2lvbjIuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBNb2RlbFZpZXdUcmFuc2Zvcm0yIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdmlldy9Nb2RlbFZpZXdUcmFuc2Zvcm0yLmpzJztcclxuaW1wb3J0IEFycm93Tm9kZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvQXJyb3dOb2RlLmpzJztcclxuaW1wb3J0IHsgTGluZSBhcyBTY2VuZXJ5TGluZSwgTm9kZSwgTm9kZU9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZ3JhcGhpbmdMaW5lcyBmcm9tICcuLi8uLi9ncmFwaGluZ0xpbmVzLmpzJztcclxuaW1wb3J0IE5vdEFMaW5lIGZyb20gJy4uLy4uL2xpbmVnYW1lL21vZGVsL05vdEFMaW5lLmpzJztcclxuaW1wb3J0IExpbmUgZnJvbSAnLi4vbW9kZWwvTGluZS5qcyc7XHJcbmltcG9ydCBHcmFwaCBmcm9tICcuLi9tb2RlbC9HcmFwaC5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgSEVBRF9TSVpFID0gbmV3IERpbWVuc2lvbjIoIDEwLCAxMCApO1xyXG5jb25zdCBUQUlMX1dJRFRIID0gMztcclxuY29uc3QgTElORV9FWFRFTlQgPSAyNTsgLy8gaG93IGZhciB0aGUgbGluZSBleHRlbmRzIHBhc3QgdGhlIGdyaWRcclxuY29uc3QgRVFVQVRJT05fRk9OVF9TSVpFID0gMTg7XHJcblxyXG4vLyBPcHRpb25zIGZvciBTQ0VORVJZX1BIRVQvQXJyb3dOb2RlXHJcbmNvbnN0IEFSUk9XX05PREVfT1BUSU9OUyA9IHtcclxuICBkb3VibGVIZWFkOiB0cnVlLFxyXG4gIHRhaWxXaWR0aDogVEFJTF9XSURUSCxcclxuICBoZWFkV2lkdGg6IEhFQURfU0laRS53aWR0aCxcclxuICBoZWFkSGVpZ2h0OiBIRUFEX1NJWkUuaGVpZ2h0LFxyXG4gIHN0cm9rZTogbnVsbFxyXG59O1xyXG5cclxuLy8gT3B0aW9ucyBmb3IgU0NFTkVSWS9MaW5lXHJcbmNvbnN0IFNDRU5FUllfTElORV9PUFRJT05TID0ge1xyXG4gIGxpbmVXaWR0aDogVEFJTF9XSURUSFxyXG59O1xyXG5cclxuLy8gT3B0aW9ucyBmb3IgU2VsZk9wdGlvbnMuY3JlYXRlRHluYW1pY0xhYmVsXHJcbmV4cG9ydCB0eXBlIENyZWF0ZUR5bmFtaWNMYWJlbE9wdGlvbnMgPSB7XHJcbiAgcGlja2FibGU/OiBib29sZWFuO1xyXG4gIGludGVyYWN0aXZlUG9pbnQ/OiBib29sZWFuO1xyXG4gIGludGVyYWN0aXZlU2xvcGU/OiBib29sZWFuO1xyXG4gIGludGVyYWN0aXZlSW50ZXJjZXB0PzogYm9vbGVhbjtcclxuICBmb250U2l6ZT86IG51bWJlcjtcclxuICBtYXhXaWR0aD86IG51bWJlciB8IG51bGw7XHJcbiAgc2xvcGVVbmRlZmluZWRWaXNpYmxlPzogYm9vbGVhbjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIENyZWF0ZUR5bmFtaWNMYWJlbEZ1bmN0aW9uID0gKCBsaW5lUHJvcGVydHk6IFByb3BlcnR5PExpbmU+LCBwcm92aWRlZE9wdGlvbnM/OiBDcmVhdGVEeW5hbWljTGFiZWxPcHRpb25zICkgPT4gTm9kZTtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcblxyXG4gIC8vIEZ1bmN0aW9uIGZvciBjcmVhdGluZyBhIGR5bmFtaWMgbGFiZWwgdGhhdCB1cGRhdGVzIGFzIHRoZSBsaW5lIGNoYW5nZXMuXHJcbiAgY3JlYXRlRHluYW1pY0xhYmVsPzogQ3JlYXRlRHluYW1pY0xhYmVsRnVuY3Rpb247XHJcblxyXG4gIC8vIFdoZXRoZXIgdGhlIGxpbmUgaGFzIGFycm93cyBvbiBpdHMgZW5kcy5cclxuICBoYXNBcnJvd3M/OiBib29sZWFuO1xyXG59O1xyXG5cclxudHlwZSBMaW5lTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExpbmVOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSBsaW5lUHJvcGVydHk6IFByb3BlcnR5PExpbmU+O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZ3JhcGg6IEdyYXBoO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbW9kZWxWaWV3VHJhbnNmb3JtOiBNb2RlbFZpZXdUcmFuc2Zvcm0yO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgeEV4dGVudDogbnVtYmVyO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgeUV4dGVudDogbnVtYmVyO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcGFyZW50Tm9kZTogTm9kZTsgLy8gcGFyZW50IG9mIGFsbCBjaGlsZHJlblxyXG5cclxuICAvLyBPbmUgb2YgdGhlc2Ugd2lsbCBiZSBpbnN0YW50aWF0ZWQsIGJhc2VkIG9uIHRoZSB2YWx1ZSBvZiBTZWxmT3B0aW9ucy5oYXNBcnJvd3MuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBhcnJvd05vZGU/OiBBcnJvd05vZGU7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBsaW5lTm9kZT86IFNjZW5lcnlMaW5lO1xyXG5cclxuICAvLyBvcHRpb25hbCBlcXVhdGlvbk5vZGUgYW5kIGl0cyBwYXJlbnQuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBlcXVhdGlvbk5vZGU/OiBOb2RlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZXF1YXRpb25QYXJlbnROb2RlPzogTm9kZTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlTGluZU5vZGU6ICgpID0+IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbGluZVByb3BlcnR5OiBQcm9wZXJ0eTxMaW5lPixcclxuICAgICAgICAgICAgICAgICAgICAgIGdyYXBoOiBHcmFwaCxcclxuICAgICAgICAgICAgICAgICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMixcclxuICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVkT3B0aW9ucz86IExpbmVOb2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPExpbmVOb2RlT3B0aW9ucywgU3RyaWN0T21pdDxTZWxmT3B0aW9ucywgJ2NyZWF0ZUR5bmFtaWNMYWJlbCc+LCBOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgaGFzQXJyb3dzOiB0cnVlXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIHRoaXMubGluZVByb3BlcnR5ID0gbGluZVByb3BlcnR5O1xyXG4gICAgdGhpcy5ncmFwaCA9IGdyYXBoO1xyXG4gICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0gPSBtb2RlbFZpZXdUcmFuc2Zvcm07XHJcbiAgICB0aGlzLnhFeHRlbnQgPSBtb2RlbFZpZXdUcmFuc2Zvcm0udmlld1RvTW9kZWxEZWx0YVgoIExJTkVfRVhURU5UICk7XHJcbiAgICB0aGlzLnlFeHRlbnQgPSBNYXRoLmFicyggbW9kZWxWaWV3VHJhbnNmb3JtLnZpZXdUb01vZGVsRGVsdGFZKCBMSU5FX0VYVEVOVCApICk7XHJcblxyXG4gICAgdGhpcy5wYXJlbnROb2RlID0gbmV3IE5vZGUoKTtcclxuXHJcbiAgICBpZiAoIG9wdGlvbnMuaGFzQXJyb3dzICkge1xyXG4gICAgICB0aGlzLmFycm93Tm9kZSA9IG5ldyBBcnJvd05vZGUoIDAsIDAsIDAsIDEsIEFSUk9XX05PREVfT1BUSU9OUyApO1xyXG4gICAgICB0aGlzLnBhcmVudE5vZGUuYWRkQ2hpbGQoIHRoaXMuYXJyb3dOb2RlICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5saW5lTm9kZSA9IG5ldyBTY2VuZXJ5TGluZSggMCwgMCwgMCwgMCwgU0NFTkVSWV9MSU5FX09QVElPTlMgKTtcclxuICAgICAgdGhpcy5wYXJlbnROb2RlLmFkZENoaWxkKCB0aGlzLmxpbmVOb2RlICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCBvcHRpb25zLmNyZWF0ZUR5bmFtaWNMYWJlbCApIHtcclxuICAgICAgdGhpcy5lcXVhdGlvbk5vZGUgPSBvcHRpb25zLmNyZWF0ZUR5bmFtaWNMYWJlbCggbGluZVByb3BlcnR5LCB7XHJcbiAgICAgICAgZm9udFNpemU6IEVRVUFUSU9OX0ZPTlRfU0laRVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBSb3RhdGlvbiBpcyBhcHBsaWVkIHRvIGVxdWF0aW9uUGFyZW50Tm9kZS4gVGhpcyBtYWtlcyBwb3NpdGlvbmluZyB0aGUgZXF1YXRpb24gYSBsaXR0bGUgZWFzaWVyIHRvIGdyb2suXHJcbiAgICAgIHRoaXMuZXF1YXRpb25QYXJlbnROb2RlID0gbmV3IE5vZGUoIHtcclxuICAgICAgICBjaGlsZHJlbjogWyB0aGlzLmVxdWF0aW9uTm9kZSBdXHJcbiAgICAgIH0gKTtcclxuICAgICAgdGhpcy5wYXJlbnROb2RlLmFkZENoaWxkKCB0aGlzLmVxdWF0aW9uUGFyZW50Tm9kZSApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMucGFyZW50Tm9kZSApO1xyXG5cclxuICAgIGNvbnN0IGxpbmVPYnNlcnZlciA9ICggbGluZTogTGluZSB8IE5vdEFMaW5lICkgPT4gdGhpcy51cGRhdGUoIGxpbmUgKTtcclxuICAgIGxpbmVQcm9wZXJ0eS5saW5rKCBsaW5lT2JzZXJ2ZXIgKTsgLy8gdW5saW5rIGluIGRpc3Bvc2VcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VMaW5lTm9kZSA9ICgpID0+IHtcclxuICAgICAgdGhpcy5lcXVhdGlvbk5vZGUgJiYgdGhpcy5lcXVhdGlvbk5vZGUuZGlzcG9zZSgpO1xyXG4gICAgICBsaW5lUHJvcGVydHkudW5saW5rKCBsaW5lT2JzZXJ2ZXIgKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZUxpbmVOb2RlKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0RXF1YXRpb25WaXNpYmxlKCB2aXNpYmxlOiBib29sZWFuICk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5lcXVhdGlvblBhcmVudE5vZGUgKTtcclxuICAgIGlmICggdGhpcy5lcXVhdGlvblBhcmVudE5vZGUgKSB7XHJcbiAgICAgIHRoaXMuZXF1YXRpb25QYXJlbnROb2RlLnZpc2libGUgPSB2aXNpYmxlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gVXBkYXRlcyB0aGUgbGluZSBhbmQgZXF1YXRpb24uXHJcbiAgcHJpdmF0ZSB1cGRhdGUoIGxpbmU6IExpbmUgfCBOb3RBTGluZSApOiB2b2lkIHtcclxuXHJcbiAgICAvLyBsaW5lIG1heSBiZSBOb3RBTGluZSwgZm9yIGV4YW1wbGUgdGhlIHVzZXIncyBndWVzcyBpbiAnUGxhY2UgVGhlIFBvaW50cycgY2hhbGxlbmdlXHJcbiAgICBjb25zdCBpc0FMaW5lID0gKCBsaW5lIGluc3RhbmNlb2YgTGluZSApO1xyXG4gICAgdGhpcy5wYXJlbnROb2RlLnZpc2libGUgPSBpc0FMaW5lO1xyXG4gICAgaWYgKCAhaXNBTGluZSApIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgLy8gY29tcHV0ZSB0aGUgbmV3IHRpcCBhbmQgdGFpbCBmb3IgdGhlIGxpbmVcclxuICAgIGNvbnN0IHhSYW5nZSA9IHRoaXMuZ3JhcGgueFJhbmdlO1xyXG4gICAgY29uc3QgeVJhbmdlID0gdGhpcy5ncmFwaC55UmFuZ2U7XHJcbiAgICBsZXQgdGFpbFg7XHJcbiAgICBsZXQgdGFpbFk7XHJcbiAgICBsZXQgdGlwWDtcclxuICAgIGxldCB0aXBZO1xyXG5cclxuICAgIGlmICggbGluZS5ydW4gPT09IDAgKSB7XHJcbiAgICAgIC8vIHggPSAwXHJcbiAgICAgIHRhaWxYID0gbGluZS54MTtcclxuICAgICAgdGFpbFkgPSB5UmFuZ2UubWF4ICsgdGhpcy55RXh0ZW50O1xyXG4gICAgICB0aXBYID0gbGluZS54MTtcclxuICAgICAgdGlwWSA9IHlSYW5nZS5taW4gLSB0aGlzLnlFeHRlbnQ7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggbGluZS5yaXNlID09PSAwICkge1xyXG4gICAgICAvLyB5ID0gYlxyXG4gICAgICB0YWlsWCA9IHhSYW5nZS5taW4gLSB0aGlzLnhFeHRlbnQ7XHJcbiAgICAgIHRhaWxZID0gbGluZS55MTtcclxuICAgICAgdGlwWCA9IHhSYW5nZS5tYXggKyB0aGlzLnlFeHRlbnQ7XHJcbiAgICAgIHRpcFkgPSBsaW5lLnkxO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIC8vIHRhaWwgaXMgdGhlIGxlZnQtbW9zdCBlbmQgcG9pbnQuIENvbXB1dGUgeCBzdWNoIHRoYXQgdGhlIHBvaW50IGlzIGluc2lkZSB0aGUgZ3JpZC5cclxuICAgICAgdGFpbFggPSB4UmFuZ2UubWluIC0gdGhpcy54RXh0ZW50O1xyXG4gICAgICB0YWlsWSA9IGxpbmUuc29sdmVZKCB0YWlsWCApO1xyXG4gICAgICBpZiAoIHRhaWxZIDwgeVJhbmdlLm1pbiAtIHRoaXMueUV4dGVudCApIHtcclxuICAgICAgICB0YWlsWCA9IGxpbmUuc29sdmVYKCB5UmFuZ2UubWluIC0gdGhpcy55RXh0ZW50ICk7XHJcbiAgICAgICAgdGFpbFkgPSBsaW5lLnNvbHZlWSggdGFpbFggKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggdGFpbFkgPiB5UmFuZ2UubWF4ICsgdGhpcy55RXh0ZW50ICkge1xyXG4gICAgICAgIHRhaWxYID0gbGluZS5zb2x2ZVgoIHlSYW5nZS5tYXggKyB0aGlzLnlFeHRlbnQgKTtcclxuICAgICAgICB0YWlsWSA9IGxpbmUuc29sdmVZKCB0YWlsWCApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyB0aXAgaXMgdGhlIHJpZ2h0LW1vc3QgZW5kIHBvaW50LiBDb21wdXRlIHggc3VjaCB0aGF0IHRoZSBwb2ludCBpcyBpbnNpZGUgdGhlIGdyaWQuXHJcbiAgICAgIHRpcFggPSB4UmFuZ2UubWF4ICsgdGhpcy54RXh0ZW50O1xyXG4gICAgICB0aXBZID0gbGluZS5zb2x2ZVkoIHRpcFggKTtcclxuICAgICAgaWYgKCB0aXBZIDwgeVJhbmdlLm1pbiAtIHRoaXMueUV4dGVudCApIHtcclxuICAgICAgICB0aXBYID0gbGluZS5zb2x2ZVgoIHlSYW5nZS5taW4gLSB0aGlzLnlFeHRlbnQgKTtcclxuICAgICAgICB0aXBZID0gbGluZS5zb2x2ZVkoIHRpcFggKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggdGlwWSA+IHlSYW5nZS5tYXggKyB0aGlzLnlFeHRlbnQgKSB7XHJcbiAgICAgICAgdGlwWCA9IGxpbmUuc29sdmVYKCB5UmFuZ2UubWF4ICsgdGhpcy55RXh0ZW50ICk7XHJcbiAgICAgICAgdGlwWSA9IGxpbmUuc29sdmVZKCB0aXBYICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBsaW5lXHJcbiAgICBjb25zdCB0YWlsUG9zaXRpb24gPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1hZKCB0YWlsWCwgdGFpbFkgKTtcclxuICAgIGNvbnN0IHRpcFBvc2l0aW9uID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYWSggdGlwWCwgdGlwWSApO1xyXG4gICAgaWYgKCB0aGlzLmFycm93Tm9kZSApIHtcclxuICAgICAgdGhpcy5hcnJvd05vZGUuc2V0VGFpbEFuZFRpcCggdGFpbFBvc2l0aW9uLngsIHRhaWxQb3NpdGlvbi55LCB0aXBQb3NpdGlvbi54LCB0aXBQb3NpdGlvbi55ICk7XHJcbiAgICAgIHRoaXMuYXJyb3dOb2RlLmZpbGwgPSBsaW5lLmNvbG9yO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNvbnN0IGxpbmVOb2RlID0gdGhpcy5saW5lTm9kZSE7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIGxpbmVOb2RlICk7XHJcbiAgICAgIGxpbmVOb2RlLnNldExpbmUoIHRhaWxQb3NpdGlvbi54LCB0YWlsUG9zaXRpb24ueSwgdGlwUG9zaXRpb24ueCwgdGlwUG9zaXRpb24ueSApO1xyXG4gICAgICBsaW5lTm9kZS5zdHJva2UgPSBsaW5lLmNvbG9yO1xyXG4gICAgfVxyXG5cclxuICAgIC8qXHJcbiAgICAgKiBJZiB0aGlzIGxpbmUgaGFzIGFuIGVxdWF0aW9uLCB1cGRhdGUgaXRzIG9yaWVudGF0aW9uIGFuZCBwb3NpdGlvbi5cclxuICAgICAqIFJvdGF0aW9uIGlzIGFwcGxpZWQgdG8gZXF1YXRpb25QYXJlbnROb2RlLlxyXG4gICAgICogVHJhbnNsYXRpb24gaXMgYXBwbGllZCB0byBlcXVhdGlvbk5vZGUsIHJlbGF0aXZlIHRvIGEgaG9yaXpvbnRhbCBsaW5lIHdob3NlIHRpcCBwb2ludHMgcmlnaHQuXHJcbiAgICAgKi9cclxuICAgIGlmICggdGhpcy5lcXVhdGlvbk5vZGUgKSB7XHJcblxyXG4gICAgICBjb25zdCBlcXVhdGlvblBhcmVudE5vZGUgPSB0aGlzLmVxdWF0aW9uUGFyZW50Tm9kZSE7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIGVxdWF0aW9uUGFyZW50Tm9kZSApO1xyXG5cclxuICAgICAgZXF1YXRpb25QYXJlbnROb2RlLnJvdGF0aW9uID0gbGluZS51bmRlZmluZWRTbG9wZSgpID8gTWF0aC5QSSAvIDIgOiAtTWF0aC5hdGFuKCBsaW5lLmdldFNsb3BlKCkgKTtcclxuXHJcbiAgICAgIC8vIEVxdWF0aW9ucyBoYXZlIHNvbWUgaW52aXNpYmxlIG5vZGVzLiBDb21wZW5zYXRlIHNvIHRoYXQgbGF5b3V0IGlzIGZvciB2aXNpYmxlIG5vZGVzLlxyXG4gICAgICBjb25zdCBlcXVhdGlvbkJvdW5kcyA9IHRoaXMuZXF1YXRpb25Ob2RlLmJvdW5kcztcclxuICAgICAgY29uc3QgZXF1YXRpb25WaXNpYmxlQm91bmRzID0gdGhpcy5lcXVhdGlvbk5vZGUudmlzaWJsZUJvdW5kcztcclxuICAgICAgY29uc3QgbGVmdE9mZnNldCA9IGVxdWF0aW9uVmlzaWJsZUJvdW5kcy5sZWZ0IC0gZXF1YXRpb25Cb3VuZHMubGVmdDtcclxuICAgICAgY29uc3QgcmlnaHRPZmZzZXQgPSBlcXVhdGlvbkJvdW5kcy5yaWdodCAtIGVxdWF0aW9uVmlzaWJsZUJvdW5kcy5yaWdodDtcclxuICAgICAgY29uc3QgdG9wT2Zmc2V0ID0gZXF1YXRpb25WaXNpYmxlQm91bmRzLnRvcCAtIGVxdWF0aW9uQm91bmRzLnRvcDtcclxuICAgICAgY29uc3QgYm90dG9tT2Zmc2V0ID0gZXF1YXRpb25Cb3VuZHMuYm90dG9tIC0gZXF1YXRpb25WaXNpYmxlQm91bmRzLmJvdHRvbTtcclxuXHJcbiAgICAgIC8vIFB1dCB0aGUgZXF1YXRpb24gd2hlcmUgaXQgd29uJ3QgaW50ZXJmZXJlIHdpdGggc2xvcGUgdG9vbCBvciB5LWF4aXMsIGF0IHRoZSBlbmQgb2YgdGhlIGxpbmUgdGhhdCB3b3VsZCBoYXZlIHRoZSBzbG9wZSBtYW5pcHVsYXRvci5cclxuICAgICAgY29uc3QgWF9PRkZTRVQgPSA2MDtcclxuICAgICAgY29uc3QgWV9PRkZTRVQgPSAxMjtcclxuICAgICAgaWYgKCBsaW5lLnVuZGVmaW5lZFNsb3BlKCkgKSB7XHJcblxyXG4gICAgICAgIC8vIFRoaXMgcHV0cyB0aGUgJ3VuZGVmaW5lZCBzbG9wZScgbGFiZWwgdG8gdGhlIHJpZ2h0IG9mIHRoZSB5LWF4aXMsIGF0IHRoZSBzYW1lIGVuZCBvZiB0aGUgbGluZSBhcyB0aGUgc2xvcGUgbWFuaXB1bGF0b3IuXHJcbiAgICAgICAgaWYgKCBsaW5lLnJpc2UgPCAwICkge1xyXG4gICAgICAgICAgZXF1YXRpb25QYXJlbnROb2RlLnRyYW5zbGF0aW9uID0gdGlwUG9zaXRpb247XHJcbiAgICAgICAgICB0aGlzLmVxdWF0aW9uTm9kZS5yaWdodCA9IC1YX09GRlNFVCArIHJpZ2h0T2Zmc2V0O1xyXG4gICAgICAgICAgdGhpcy5lcXVhdGlvbk5vZGUuYm90dG9tID0gLVlfT0ZGU0VUICsgYm90dG9tT2Zmc2V0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGVxdWF0aW9uUGFyZW50Tm9kZS50cmFuc2xhdGlvbiA9IHRhaWxQb3NpdGlvbjtcclxuICAgICAgICAgIHRoaXMuZXF1YXRpb25Ob2RlLmxlZnQgPSBYX09GRlNFVCAtIGxlZnRPZmZzZXQ7XHJcbiAgICAgICAgICB0aGlzLmVxdWF0aW9uTm9kZS5ib3R0b20gPSAtWV9PRkZTRVQgKyBib3R0b21PZmZzZXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBsaW5lLnJpc2UgPD0gMCApIHtcclxuICAgICAgICBpZiAoIGxpbmUucnVuID49IDAgKSB7XHJcblxyXG4gICAgICAgICAgLy8gcXVhZHJhbnQgNDogZXF1YXRpb24gYWJvdmUgdGhlIGxpbmUsIGF0IHRpcCAocmlnaHQpXHJcbiAgICAgICAgICBlcXVhdGlvblBhcmVudE5vZGUudHJhbnNsYXRpb24gPSB0aXBQb3NpdGlvbjtcclxuICAgICAgICAgIHRoaXMuZXF1YXRpb25Ob2RlLnJpZ2h0ID0gLVhfT0ZGU0VUICsgcmlnaHRPZmZzZXQ7XHJcbiAgICAgICAgICB0aGlzLmVxdWF0aW9uTm9kZS5ib3R0b20gPSAtWV9PRkZTRVQgKyBib3R0b21PZmZzZXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAgIC8vIHF1YWRyYW50IDM6IGVxdWF0aW9uIGFib3ZlIHRoZSBsaW5lLCBhdCB0YWlsIChsZWZ0KVxyXG4gICAgICAgICAgZXF1YXRpb25QYXJlbnROb2RlLnRyYW5zbGF0aW9uID0gdGFpbFBvc2l0aW9uO1xyXG4gICAgICAgICAgdGhpcy5lcXVhdGlvbk5vZGUubGVmdCA9IFhfT0ZGU0VUIC0gbGVmdE9mZnNldDtcclxuICAgICAgICAgIHRoaXMuZXF1YXRpb25Ob2RlLmJvdHRvbSA9IC1ZX09GRlNFVCArIGJvdHRvbU9mZnNldDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgaWYgKCBsaW5lLnJ1biA+IDAgKSB7XHJcblxyXG4gICAgICAgICAgLy8gcXVhZHJhbnQgMTogZXF1YXRpb24gYmVsb3cgdGhlIGxpbmUsIGF0IHRpcCAocmlnaHQpXHJcbiAgICAgICAgICBlcXVhdGlvblBhcmVudE5vZGUudHJhbnNsYXRpb24gPSB0aXBQb3NpdGlvbjtcclxuICAgICAgICAgIHRoaXMuZXF1YXRpb25Ob2RlLnJpZ2h0ID0gLVhfT0ZGU0VUICsgcmlnaHRPZmZzZXQ7XHJcbiAgICAgICAgICB0aGlzLmVxdWF0aW9uTm9kZS50b3AgPSBZX09GRlNFVCAtIHRvcE9mZnNldDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgICAgLy8gcXVhZHJhbnQgMjogZXF1YXRpb24gYmVsb3cgdGhlIGxpbmUsIGF0IHRhaWwgKGxlZnQpXHJcbiAgICAgICAgICBlcXVhdGlvblBhcmVudE5vZGUudHJhbnNsYXRpb24gPSB0YWlsUG9zaXRpb247XHJcbiAgICAgICAgICB0aGlzLmVxdWF0aW9uTm9kZS5sZWZ0ID0gWF9PRkZTRVQgLSBsZWZ0T2Zmc2V0O1xyXG4gICAgICAgICAgdGhpcy5lcXVhdGlvbk5vZGUudG9wID0gWV9PRkZTRVQgLSB0b3BPZmZzZXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5ncmFwaGluZ0xpbmVzLnJlZ2lzdGVyKCAnTGluZU5vZGUnLCBMaW5lTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFHQSxPQUFPQSxVQUFVLE1BQU0sa0NBQWtDO0FBQ3pELE9BQU9DLFNBQVMsTUFBTSx1Q0FBdUM7QUFHN0QsT0FBT0MsU0FBUyxN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