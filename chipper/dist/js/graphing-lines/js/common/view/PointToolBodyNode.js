// Copyright 2021-2023, University of Colorado Boulder

/**
 * PointToolBodyNode is the body portion of the point tool. It includes everything except the tool's probe.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Bounds2 from '../../../../dot/js/Bounds2.js';
import Utils from '../../../../dot/js/Utils.js';
import optionize from '../../../../phet-core/js/optionize.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import ShadedRectangle from '../../../../scenery-phet/js/ShadedRectangle.js';
import { Color, LinearGradient, Node, Rectangle, RichText, VBox } from '../../../../scenery/js/imports.js';
import graphingLines from '../../graphingLines.js';
import GraphingLinesStrings from '../../GraphingLinesStrings.js';
import GLColors from '../GLColors.js';

// constants
const DEFAULT_FONT = new PhetFont({
  size: 15,
  weight: 'bold'
});
const NUMBER_OF_GRIPS = 3;

// The side where the client intends to add a probe

export default class PointToolBodyNode extends Node {
  constructor(coordinatesProperty, providedOptions) {
    const options = optionize()({
      // SelfOptions
      coordinatesSide: 'left',
      cornerRadius: 8,
      bodyWidth: 130,
      bodyHeight: 48,
      bodyColor: GLColors.POINT_TOOL_COLOR,
      bodyXMargin: 7,
      backgroundWidth: 70,
      backgroundHeight: 35,
      backgroundFill: 'white',
      backgroundStroke: Color.grayColor(185),
      backgroundXMargin: 4,
      backgroundYMargin: 2,
      font: DEFAULT_FONT,
      textFill: 'black',
      decimals: 1
    }, providedOptions);

    // The main rectangle
    const bodyRectangle = new ShadedRectangle(new Bounds2(0, 0, options.bodyWidth, options.bodyHeight), {
      baseColor: options.bodyColor,
      lightOffset: 0.95,
      cornerRadius: options.cornerRadius
    });

    // The background rectangle that appears behind the coordinates
    const background = new Rectangle(0, 0, options.backgroundWidth, options.backgroundHeight, {
      cornerRadius: options.cornerRadius,
      lineWidth: 2,
      fill: options.backgroundFill,
      stroke: options.backgroundStroke,
      centerY: bodyRectangle.centerY
    });

    // The text that displays the coordinates
    const textNode = new RichText('', {
      font: options.font,
      fill: options.textFill,
      maxWidth: options.backgroundWidth - 2 * options.backgroundXMargin,
      maxHeight: options.backgroundHeight - 2 * options.backgroundYMargin
    });

    // Horizontal 'grip' bars that cue the user to drag the tool
    const gripWidth = bodyRectangle.width - background.width - 3 * options.bodyXMargin;
    const gripHeight = 4;
    const gripFill = new LinearGradient(0, 0, 0, gripHeight).addColorStop(0, 'white').addColorStop(0.5, options.bodyColor).addColorStop(1, Color.grayColor(20));
    const gripStroke = Color.grayColor(140);
    const grips = [];
    for (let i = 0; i < NUMBER_OF_GRIPS; i++) {
      grips.push(new Rectangle(0, 0, gripWidth, gripHeight, {
        cornerRadius: gripHeight / 2,
        fill: gripFill,
        stroke: gripStroke,
        lineWidth: 0.5
      }));
    }
    const gripsBox = new VBox({
      children: grips,
      spacing: 6,
      centerY: bodyRectangle.centerY
    });

    // Layout
    if (options.coordinatesSide === 'left') {
      background.left = bodyRectangle.left + options.bodyXMargin;
      gripsBox.right = bodyRectangle.right - options.bodyXMargin;
    } else {
      background.right = bodyRectangle.right - options.bodyXMargin;
      gripsBox.left = bodyRectangle.left + options.bodyXMargin;
    }
    assert && assert(!options.children);
    options.children = [bodyRectangle, background, textNode, gripsBox];
    super(options);

    // Update the displayed coordinates. Use toFixedNumber so that trailing zeros are removed.
    const coordinatesListener = coordinates => {
      if (coordinates) {
        const x = Utils.toFixedNumber(coordinates.x, options.decimals);
        const y = Utils.toFixedNumber(coordinates.y, options.decimals);
        textNode.string = StringUtils.format(GraphingLinesStrings.point.XY, x, y);
      } else {
        textNode.string = GraphingLinesStrings.point.unknown;
      }
    };
    coordinatesProperty.link(coordinatesListener);

    // Keep the coordinates centered in the background.
    textNode.boundsProperty.link(() => {
      textNode.center = background.center;
    });
    this.disposePointToolBodyNode = () => {
      if (coordinatesProperty.hasListener(coordinatesListener)) {
        coordinatesProperty.unlink(coordinatesListener);
      }
    };
    this.background = background;
    this.textNode = textNode;
  }
  dispose() {
    this.disposePointToolBodyNode();
    super.dispose();
  }

  /**
   * Sets the fill for the text.
   */
  setTextFill(fill) {
    this.textNode.fill = fill;
  }

  /**
   * Sets the fill for the text background.
   */
  setBackgroundFill(fill) {
    this.background.fill = fill;
  }
}
graphingLines.register('PointToolBodyNode', PointToolBodyNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb3VuZHMyIiwiVXRpbHMiLCJvcHRpb25pemUiLCJTdHJpbmdVdGlscyIsIlBoZXRGb250IiwiU2hhZGVkUmVjdGFuZ2xlIiwiQ29sb3IiLCJMaW5lYXJHcmFkaWVudCIsIk5vZGUiLCJSZWN0YW5nbGUiLCJSaWNoVGV4dCIsIlZCb3giLCJncmFwaGluZ0xpbmVzIiwiR3JhcGhpbmdMaW5lc1N0cmluZ3MiLCJHTENvbG9ycyIsIkRFRkFVTFRfRk9OVCIsInNpemUiLCJ3ZWlnaHQiLCJOVU1CRVJfT0ZfR1JJUFMiLCJQb2ludFRvb2xCb2R5Tm9kZSIsImNvbnN0cnVjdG9yIiwiY29vcmRpbmF0ZXNQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJjb29yZGluYXRlc1NpZGUiLCJjb3JuZXJSYWRpdXMiLCJib2R5V2lkdGgiLCJib2R5SGVpZ2h0IiwiYm9keUNvbG9yIiwiUE9JTlRfVE9PTF9DT0xPUiIsImJvZHlYTWFyZ2luIiwiYmFja2dyb3VuZFdpZHRoIiwiYmFja2dyb3VuZEhlaWdodCIsImJhY2tncm91bmRGaWxsIiwiYmFja2dyb3VuZFN0cm9rZSIsImdyYXlDb2xvciIsImJhY2tncm91bmRYTWFyZ2luIiwiYmFja2dyb3VuZFlNYXJnaW4iLCJmb250IiwidGV4dEZpbGwiLCJkZWNpbWFscyIsImJvZHlSZWN0YW5nbGUiLCJiYXNlQ29sb3IiLCJsaWdodE9mZnNldCIsImJhY2tncm91bmQiLCJsaW5lV2lkdGgiLCJmaWxsIiwic3Ryb2tlIiwiY2VudGVyWSIsInRleHROb2RlIiwibWF4V2lkdGgiLCJtYXhIZWlnaHQiLCJncmlwV2lkdGgiLCJ3aWR0aCIsImdyaXBIZWlnaHQiLCJncmlwRmlsbCIsImFkZENvbG9yU3RvcCIsImdyaXBTdHJva2UiLCJncmlwcyIsImkiLCJwdXNoIiwiZ3JpcHNCb3giLCJjaGlsZHJlbiIsInNwYWNpbmciLCJsZWZ0IiwicmlnaHQiLCJhc3NlcnQiLCJjb29yZGluYXRlc0xpc3RlbmVyIiwiY29vcmRpbmF0ZXMiLCJ4IiwidG9GaXhlZE51bWJlciIsInkiLCJzdHJpbmciLCJmb3JtYXQiLCJwb2ludCIsIlhZIiwidW5rbm93biIsImxpbmsiLCJib3VuZHNQcm9wZXJ0eSIsImNlbnRlciIsImRpc3Bvc2VQb2ludFRvb2xCb2R5Tm9kZSIsImhhc0xpc3RlbmVyIiwidW5saW5rIiwiZGlzcG9zZSIsInNldFRleHRGaWxsIiwic2V0QmFja2dyb3VuZEZpbGwiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlBvaW50VG9vbEJvZHlOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFBvaW50VG9vbEJvZHlOb2RlIGlzIHRoZSBib2R5IHBvcnRpb24gb2YgdGhlIHBvaW50IHRvb2wuIEl0IGluY2x1ZGVzIGV2ZXJ5dGhpbmcgZXhjZXB0IHRoZSB0b29sJ3MgcHJvYmUuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBTdHJpbmdVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3V0aWwvU3RyaW5nVXRpbHMuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IFNoYWRlZFJlY3RhbmdsZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvU2hhZGVkUmVjdGFuZ2xlLmpzJztcclxuaW1wb3J0IHsgQ29sb3IsIExpbmVhckdyYWRpZW50LCBOb2RlLCBOb2RlT3B0aW9ucywgUmVjdGFuZ2xlLCBSaWNoVGV4dCwgVENvbG9yLCBWQm94IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGdyYXBoaW5nTGluZXMgZnJvbSAnLi4vLi4vZ3JhcGhpbmdMaW5lcy5qcyc7XHJcbmltcG9ydCBHcmFwaGluZ0xpbmVzU3RyaW5ncyBmcm9tICcuLi8uLi9HcmFwaGluZ0xpbmVzU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBHTENvbG9ycyBmcm9tICcuLi9HTENvbG9ycy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgREVGQVVMVF9GT05UID0gbmV3IFBoZXRGb250KCB7IHNpemU6IDE1LCB3ZWlnaHQ6ICdib2xkJyB9ICk7XHJcbmNvbnN0IE5VTUJFUl9PRl9HUklQUyA9IDM7XHJcblxyXG4vLyBUaGUgc2lkZSB3aGVyZSB0aGUgY2xpZW50IGludGVuZHMgdG8gYWRkIGEgcHJvYmVcclxudHlwZSBDb29yZGluYXRlc1NpZGUgPSAnbGVmdCcgfCAncmlnaHQnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gVGhlIHNpZGUgd2hlcmUgdGhlIGNsaWVudCBpbnRlbmRzIHRvIGFkZCBhIHByb2JlXHJcbiAgY29vcmRpbmF0ZXNTaWRlPzogQ29vcmRpbmF0ZXNTaWRlO1xyXG5cclxuICAvLyBGb3IgYm90aCB0aGUgYm9keSBhbmQgdGV4dCBiYWNrZ3JvdW5kXHJcbiAgY29ybmVyUmFkaXVzPzogbnVtYmVyO1xyXG5cclxuICAvLyBib2R5XHJcbiAgYm9keVdpZHRoPzogbnVtYmVyO1xyXG4gIGJvZHlIZWlnaHQ/OiBudW1iZXI7XHJcbiAgYm9keUNvbG9yPzogVENvbG9yO1xyXG4gIGJvZHlYTWFyZ2luPzogbnVtYmVyO1xyXG5cclxuICAvLyB0ZXh0IGJhY2tncm91bmRcclxuICBiYWNrZ3JvdW5kV2lkdGg/OiBudW1iZXI7XHJcbiAgYmFja2dyb3VuZEhlaWdodD86IG51bWJlcjtcclxuICBiYWNrZ3JvdW5kRmlsbD86IFRDb2xvcjtcclxuICBiYWNrZ3JvdW5kU3Ryb2tlPzogVENvbG9yO1xyXG4gIGJhY2tncm91bmRYTWFyZ2luPzogbnVtYmVyO1xyXG4gIGJhY2tncm91bmRZTWFyZ2luPzogbnVtYmVyO1xyXG5cclxuICAvLyB0ZXh0XHJcbiAgZm9udD86IFBoZXRGb250O1xyXG4gIHRleHRGaWxsPzogVENvbG9yO1xyXG4gIGRlY2ltYWxzPzogbnVtYmVyO1xyXG59O1xyXG5cclxudHlwZSBQb2ludFRvb2xCb2R5Tm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvaW50VG9vbEJvZHlOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgYmFja2dyb3VuZDogUmVjdGFuZ2xlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdGV4dE5vZGU6IFJpY2hUZXh0O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZVBvaW50VG9vbEJvZHlOb2RlOiAoKSA9PiB2b2lkO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGNvb3JkaW5hdGVzUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PFZlY3RvcjIgfCBudWxsPiwgcHJvdmlkZWRPcHRpb25zPzogUG9pbnRUb29sQm9keU5vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8UG9pbnRUb29sQm9keU5vZGVPcHRpb25zLCBTZWxmT3B0aW9ucywgTm9kZU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNlbGZPcHRpb25zXHJcbiAgICAgIGNvb3JkaW5hdGVzU2lkZTogJ2xlZnQnLFxyXG4gICAgICBjb3JuZXJSYWRpdXM6IDgsXHJcbiAgICAgIGJvZHlXaWR0aDogMTMwLFxyXG4gICAgICBib2R5SGVpZ2h0OiA0OCxcclxuICAgICAgYm9keUNvbG9yOiBHTENvbG9ycy5QT0lOVF9UT09MX0NPTE9SLFxyXG4gICAgICBib2R5WE1hcmdpbjogNyxcclxuICAgICAgYmFja2dyb3VuZFdpZHRoOiA3MCxcclxuICAgICAgYmFja2dyb3VuZEhlaWdodDogMzUsXHJcbiAgICAgIGJhY2tncm91bmRGaWxsOiAnd2hpdGUnLFxyXG4gICAgICBiYWNrZ3JvdW5kU3Ryb2tlOiBDb2xvci5ncmF5Q29sb3IoIDE4NSApLFxyXG4gICAgICBiYWNrZ3JvdW5kWE1hcmdpbjogNCxcclxuICAgICAgYmFja2dyb3VuZFlNYXJnaW46IDIsXHJcbiAgICAgIGZvbnQ6IERFRkFVTFRfRk9OVCxcclxuICAgICAgdGV4dEZpbGw6ICdibGFjaycsXHJcbiAgICAgIGRlY2ltYWxzOiAxXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBUaGUgbWFpbiByZWN0YW5nbGVcclxuICAgIGNvbnN0IGJvZHlSZWN0YW5nbGUgPSBuZXcgU2hhZGVkUmVjdGFuZ2xlKCBuZXcgQm91bmRzMiggMCwgMCwgb3B0aW9ucy5ib2R5V2lkdGgsIG9wdGlvbnMuYm9keUhlaWdodCApLCB7XHJcbiAgICAgIGJhc2VDb2xvcjogb3B0aW9ucy5ib2R5Q29sb3IsXHJcbiAgICAgIGxpZ2h0T2Zmc2V0OiAwLjk1LFxyXG4gICAgICBjb3JuZXJSYWRpdXM6IG9wdGlvbnMuY29ybmVyUmFkaXVzXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gVGhlIGJhY2tncm91bmQgcmVjdGFuZ2xlIHRoYXQgYXBwZWFycyBiZWhpbmQgdGhlIGNvb3JkaW5hdGVzXHJcbiAgICBjb25zdCBiYWNrZ3JvdW5kID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgb3B0aW9ucy5iYWNrZ3JvdW5kV2lkdGgsIG9wdGlvbnMuYmFja2dyb3VuZEhlaWdodCwge1xyXG4gICAgICBjb3JuZXJSYWRpdXM6IG9wdGlvbnMuY29ybmVyUmFkaXVzLFxyXG4gICAgICBsaW5lV2lkdGg6IDIsXHJcbiAgICAgIGZpbGw6IG9wdGlvbnMuYmFja2dyb3VuZEZpbGwsXHJcbiAgICAgIHN0cm9rZTogb3B0aW9ucy5iYWNrZ3JvdW5kU3Ryb2tlLFxyXG4gICAgICBjZW50ZXJZOiBib2R5UmVjdGFuZ2xlLmNlbnRlcllcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBUaGUgdGV4dCB0aGF0IGRpc3BsYXlzIHRoZSBjb29yZGluYXRlc1xyXG4gICAgY29uc3QgdGV4dE5vZGUgPSBuZXcgUmljaFRleHQoICcnLCB7XHJcbiAgICAgIGZvbnQ6IG9wdGlvbnMuZm9udCxcclxuICAgICAgZmlsbDogb3B0aW9ucy50ZXh0RmlsbCxcclxuICAgICAgbWF4V2lkdGg6IG9wdGlvbnMuYmFja2dyb3VuZFdpZHRoIC0gKCAyICogb3B0aW9ucy5iYWNrZ3JvdW5kWE1hcmdpbiApLFxyXG4gICAgICBtYXhIZWlnaHQ6IG9wdGlvbnMuYmFja2dyb3VuZEhlaWdodCAtICggMiAqIG9wdGlvbnMuYmFja2dyb3VuZFlNYXJnaW4gKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEhvcml6b250YWwgJ2dyaXAnIGJhcnMgdGhhdCBjdWUgdGhlIHVzZXIgdG8gZHJhZyB0aGUgdG9vbFxyXG4gICAgY29uc3QgZ3JpcFdpZHRoID0gYm9keVJlY3RhbmdsZS53aWR0aCAtIGJhY2tncm91bmQud2lkdGggLSAoIDMgKiBvcHRpb25zLmJvZHlYTWFyZ2luICk7XHJcbiAgICBjb25zdCBncmlwSGVpZ2h0ID0gNDtcclxuICAgIGNvbnN0IGdyaXBGaWxsID0gbmV3IExpbmVhckdyYWRpZW50KCAwLCAwLCAwLCBncmlwSGVpZ2h0IClcclxuICAgICAgLmFkZENvbG9yU3RvcCggMCwgJ3doaXRlJyApXHJcbiAgICAgIC5hZGRDb2xvclN0b3AoIDAuNSwgb3B0aW9ucy5ib2R5Q29sb3IgKVxyXG4gICAgICAuYWRkQ29sb3JTdG9wKCAxLCBDb2xvci5ncmF5Q29sb3IoIDIwICkgKTtcclxuICAgIGNvbnN0IGdyaXBTdHJva2UgPSBDb2xvci5ncmF5Q29sb3IoIDE0MCApO1xyXG4gICAgY29uc3QgZ3JpcHMgPSBbXTtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IE5VTUJFUl9PRl9HUklQUzsgaSsrICkge1xyXG4gICAgICBncmlwcy5wdXNoKCBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBncmlwV2lkdGgsIGdyaXBIZWlnaHQsIHtcclxuICAgICAgICBjb3JuZXJSYWRpdXM6IGdyaXBIZWlnaHQgLyAyLFxyXG4gICAgICAgIGZpbGw6IGdyaXBGaWxsLFxyXG4gICAgICAgIHN0cm9rZTogZ3JpcFN0cm9rZSxcclxuICAgICAgICBsaW5lV2lkdGg6IDAuNVxyXG4gICAgICB9ICkgKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGdyaXBzQm94ID0gbmV3IFZCb3goIHtcclxuICAgICAgY2hpbGRyZW46IGdyaXBzLFxyXG4gICAgICBzcGFjaW5nOiA2LFxyXG4gICAgICBjZW50ZXJZOiBib2R5UmVjdGFuZ2xlLmNlbnRlcllcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBMYXlvdXRcclxuICAgIGlmICggb3B0aW9ucy5jb29yZGluYXRlc1NpZGUgPT09ICdsZWZ0JyApIHtcclxuICAgICAgYmFja2dyb3VuZC5sZWZ0ID0gYm9keVJlY3RhbmdsZS5sZWZ0ICsgb3B0aW9ucy5ib2R5WE1hcmdpbjtcclxuICAgICAgZ3JpcHNCb3gucmlnaHQgPSBib2R5UmVjdGFuZ2xlLnJpZ2h0IC0gb3B0aW9ucy5ib2R5WE1hcmdpbjtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBiYWNrZ3JvdW5kLnJpZ2h0ID0gYm9keVJlY3RhbmdsZS5yaWdodCAtIG9wdGlvbnMuYm9keVhNYXJnaW47XHJcbiAgICAgIGdyaXBzQm94LmxlZnQgPSBib2R5UmVjdGFuZ2xlLmxlZnQgKyBvcHRpb25zLmJvZHlYTWFyZ2luO1xyXG4gICAgfVxyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICFvcHRpb25zLmNoaWxkcmVuICk7XHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gWyBib2R5UmVjdGFuZ2xlLCBiYWNrZ3JvdW5kLCB0ZXh0Tm9kZSwgZ3JpcHNCb3ggXTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIFVwZGF0ZSB0aGUgZGlzcGxheWVkIGNvb3JkaW5hdGVzLiBVc2UgdG9GaXhlZE51bWJlciBzbyB0aGF0IHRyYWlsaW5nIHplcm9zIGFyZSByZW1vdmVkLlxyXG4gICAgY29uc3QgY29vcmRpbmF0ZXNMaXN0ZW5lciA9ICggY29vcmRpbmF0ZXM6IFZlY3RvcjIgfCBudWxsICkgPT4ge1xyXG4gICAgICBpZiAoIGNvb3JkaW5hdGVzICkge1xyXG4gICAgICAgIGNvbnN0IHggPSBVdGlscy50b0ZpeGVkTnVtYmVyKCBjb29yZGluYXRlcy54LCBvcHRpb25zLmRlY2ltYWxzICk7XHJcbiAgICAgICAgY29uc3QgeSA9IFV0aWxzLnRvRml4ZWROdW1iZXIoIGNvb3JkaW5hdGVzLnksIG9wdGlvbnMuZGVjaW1hbHMgKTtcclxuICAgICAgICB0ZXh0Tm9kZS5zdHJpbmcgPSBTdHJpbmdVdGlscy5mb3JtYXQoIEdyYXBoaW5nTGluZXNTdHJpbmdzLnBvaW50LlhZLCB4LCB5ICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdGV4dE5vZGUuc3RyaW5nID0gR3JhcGhpbmdMaW5lc1N0cmluZ3MucG9pbnQudW5rbm93bjtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIGNvb3JkaW5hdGVzUHJvcGVydHkubGluayggY29vcmRpbmF0ZXNMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIEtlZXAgdGhlIGNvb3JkaW5hdGVzIGNlbnRlcmVkIGluIHRoZSBiYWNrZ3JvdW5kLlxyXG4gICAgdGV4dE5vZGUuYm91bmRzUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICB0ZXh0Tm9kZS5jZW50ZXIgPSBiYWNrZ3JvdW5kLmNlbnRlcjtcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VQb2ludFRvb2xCb2R5Tm9kZSA9ICgpID0+IHtcclxuICAgICAgaWYgKCBjb29yZGluYXRlc1Byb3BlcnR5Lmhhc0xpc3RlbmVyKCBjb29yZGluYXRlc0xpc3RlbmVyICkgKSB7XHJcbiAgICAgICAgY29vcmRpbmF0ZXNQcm9wZXJ0eS51bmxpbmsoIGNvb3JkaW5hdGVzTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmJhY2tncm91bmQgPSBiYWNrZ3JvdW5kO1xyXG4gICAgdGhpcy50ZXh0Tm9kZSA9IHRleHROb2RlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VQb2ludFRvb2xCb2R5Tm9kZSgpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgZmlsbCBmb3IgdGhlIHRleHQuXHJcbiAgICovXHJcbiAgcHVibGljIHNldFRleHRGaWxsKCBmaWxsOiBUQ29sb3IgKTogdm9pZCB7XHJcbiAgICB0aGlzLnRleHROb2RlLmZpbGwgPSBmaWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgZmlsbCBmb3IgdGhlIHRleHQgYmFja2dyb3VuZC5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0QmFja2dyb3VuZEZpbGwoIGZpbGw6IFRDb2xvciApOiB2b2lkIHtcclxuICAgIHRoaXMuYmFja2dyb3VuZC5maWxsID0gZmlsbDtcclxuICB9XHJcbn1cclxuXHJcbmdyYXBoaW5nTGluZXMucmVnaXN0ZXIoICdQb2ludFRvb2xCb2R5Tm9kZScsIFBvaW50VG9vbEJvZHlOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFF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