// Copyright 2013-2023, University of Colorado Boulder

/**
 * Slope indicator that the design team referred to as the 'slope tool'.
 * It displays the rise and run values of the slope.
 * Drawn in the global coordinate frame of the view.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Node } from '../../../../scenery/js/imports.js';
import graphingLines from '../../graphingLines.js';
import GLColors from '../GLColors.js';
import DimensionalArrowNode from './DimensionalArrowNode.js';
import NumberBackgroundNode from './NumberBackgroundNode.js';

// constants
const VALUE_X_SPACING = 6;
const VALUE_Y_SPACING = 6;
const NUMBER_BACKGROUND_NODE_OPTIONS = {
  font: new PhetFont({
    size: 16,
    weight: 'bold'
  }),
  decimalPlaces: 0,
  textFill: 'black',
  backgroundFill: GLColors.SLOPE,
  xMargin: 6,
  yMargin: 6,
  cornerRadius: 5
};
export default class SlopeToolNode extends Node {
  constructor(lineProperty, modelViewTransform) {
    super();
    this.runProperty = new NumberProperty(lineProperty.value.run);
    this.riseProperty = new NumberProperty(lineProperty.value.rise);
    this.riseValueNode = new NumberBackgroundNode(this.riseProperty, NUMBER_BACKGROUND_NODE_OPTIONS);
    this.runValueNode = new NumberBackgroundNode(this.runProperty, NUMBER_BACKGROUND_NODE_OPTIONS);

    // Arrows
    const arrowNodeOptions = {
      lineWidth: 1.75,
      stroke: GLColors.SLOPE_TOOL_DIMENSIONAL_LINES,
      arrowTipSize: new Dimension2(10, 10),
      delimiterLength: 0.5 * modelViewTransform.modelToViewDeltaX(1) // half of one cell in the graph
    };

    this.riseArrowNode = new DimensionalArrowNode(0, 0, 0, 50, arrowNodeOptions);
    this.runArrowNode = new DimensionalArrowNode(0, 0, 0, 50, arrowNodeOptions);

    // Put all nodes under a common parent, so we can hide for zero or undefined slopes
    this.parentNode = new Node({
      children: [this.riseArrowNode, this.riseValueNode, this.runArrowNode, this.runValueNode]
    });
    this.addChild(this.parentNode);
    const lineObserver = line => this.update(line, modelViewTransform);
    lineProperty.link(lineObserver); // unlink in dispose

    // Update when this Node becomes visible
    this.visibleProperty.link(visible => visible && this.update(lineProperty.value, modelViewTransform));
    this.disposeSlopeToolNode = () => {
      this.riseValueNode.dispose();
      this.runValueNode.dispose();
      lineProperty.unlink(lineObserver);
    };
  }
  dispose() {
    this.disposeSlopeToolNode();
    super.dispose();
  }
  update(line, modelViewTransform) {
    // update only if visible
    if (!this.visible) {
      return;
    }

    // Show nothing for horizontal or vertical lines.
    this.parentNode.visible = line.rise !== 0 && line.run !== 0;
    if (!this.parentNode.visible) {
      return;
    }

    // update internal properties before doing any layout
    this.riseProperty.value = line.rise;
    this.runProperty.value = line.run;

    // compute view coordinates
    const gridXSpacing = modelViewTransform.modelToViewDeltaX(1);
    const gridYSpacing = modelViewTransform.modelToViewDeltaY(1);
    const x1 = modelViewTransform.modelToViewX(line.x1);
    const y1 = modelViewTransform.modelToViewY(line.y1);
    const x2 = modelViewTransform.modelToViewX(line.x2);
    const y2 = modelViewTransform.modelToViewY(line.y2);

    // rise
    const offsetFactor = 0.6;
    const xOffset = offsetFactor * gridXSpacing;
    if (line.run > 0) {
      // vertical arrow to left of point
      this.riseArrowNode.setTailAndTip(x1 - xOffset, y1, x1 - xOffset, y2);
      // value to left of arrow
      this.riseValueNode.right = this.riseArrowNode.left - VALUE_X_SPACING;
      this.riseValueNode.centerY = this.riseArrowNode.centerY;
    } else {
      // vertical arrow to right of point
      this.riseArrowNode.setTailAndTip(x1 + xOffset, y1, x1 + xOffset, y2);
      // value to right of arrow
      this.riseValueNode.left = this.riseArrowNode.right + VALUE_X_SPACING;
      this.riseValueNode.centerY = this.riseArrowNode.centerY;
    }

    // run
    const yOffset = offsetFactor * gridYSpacing;
    if (line.rise > 0) {
      // horizontal arrow below point
      this.runArrowNode.setTailAndTip(x1, y2 + yOffset, x2, y2 + yOffset);
      // value above arrow
      this.runValueNode.centerX = this.runArrowNode.centerX;
      this.runValueNode.bottom = this.runArrowNode.top - VALUE_Y_SPACING;
    } else {
      // horizontal arrow above point
      this.runArrowNode.setTailAndTip(x1, y2 - yOffset, x2, y2 - yOffset);
      // value below arrow
      this.runValueNode.centerX = this.runArrowNode.centerX;
      this.runValueNode.top = this.runArrowNode.bottom + VALUE_Y_SPACING;
    }
  }
}
graphingLines.register('SlopeToolNode', SlopeToolNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOdW1iZXJQcm9wZXJ0eSIsIkRpbWVuc2lvbjIiLCJQaGV0Rm9udCIsIk5vZGUiLCJncmFwaGluZ0xpbmVzIiwiR0xDb2xvcnMiLCJEaW1lbnNpb25hbEFycm93Tm9kZSIsIk51bWJlckJhY2tncm91bmROb2RlIiwiVkFMVUVfWF9TUEFDSU5HIiwiVkFMVUVfWV9TUEFDSU5HIiwiTlVNQkVSX0JBQ0tHUk9VTkRfTk9ERV9PUFRJT05TIiwiZm9udCIsInNpemUiLCJ3ZWlnaHQiLCJkZWNpbWFsUGxhY2VzIiwidGV4dEZpbGwiLCJiYWNrZ3JvdW5kRmlsbCIsIlNMT1BFIiwieE1hcmdpbiIsInlNYXJnaW4iLCJjb3JuZXJSYWRpdXMiLCJTbG9wZVRvb2xOb2RlIiwiY29uc3RydWN0b3IiLCJsaW5lUHJvcGVydHkiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJydW5Qcm9wZXJ0eSIsInZhbHVlIiwicnVuIiwicmlzZVByb3BlcnR5IiwicmlzZSIsInJpc2VWYWx1ZU5vZGUiLCJydW5WYWx1ZU5vZGUiLCJhcnJvd05vZGVPcHRpb25zIiwibGluZVdpZHRoIiwic3Ryb2tlIiwiU0xPUEVfVE9PTF9ESU1FTlNJT05BTF9MSU5FUyIsImFycm93VGlwU2l6ZSIsImRlbGltaXRlckxlbmd0aCIsIm1vZGVsVG9WaWV3RGVsdGFYIiwicmlzZUFycm93Tm9kZSIsInJ1bkFycm93Tm9kZSIsInBhcmVudE5vZGUiLCJjaGlsZHJlbiIsImFkZENoaWxkIiwibGluZU9ic2VydmVyIiwibGluZSIsInVwZGF0ZSIsImxpbmsiLCJ2aXNpYmxlUHJvcGVydHkiLCJ2aXNpYmxlIiwiZGlzcG9zZVNsb3BlVG9vbE5vZGUiLCJkaXNwb3NlIiwidW5saW5rIiwiZ3JpZFhTcGFjaW5nIiwiZ3JpZFlTcGFjaW5nIiwibW9kZWxUb1ZpZXdEZWx0YVkiLCJ4MSIsIm1vZGVsVG9WaWV3WCIsInkxIiwibW9kZWxUb1ZpZXdZIiwieDIiLCJ5MiIsIm9mZnNldEZhY3RvciIsInhPZmZzZXQiLCJzZXRUYWlsQW5kVGlwIiwicmlnaHQiLCJsZWZ0IiwiY2VudGVyWSIsInlPZmZzZXQiLCJjZW50ZXJYIiwiYm90dG9tIiwidG9wIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJTbG9wZVRvb2xOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDEzLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFNsb3BlIGluZGljYXRvciB0aGF0IHRoZSBkZXNpZ24gdGVhbSByZWZlcnJlZCB0byBhcyB0aGUgJ3Nsb3BlIHRvb2wnLlxyXG4gKiBJdCBkaXNwbGF5cyB0aGUgcmlzZSBhbmQgcnVuIHZhbHVlcyBvZiB0aGUgc2xvcGUuXHJcbiAqIERyYXduIGluIHRoZSBnbG9iYWwgY29vcmRpbmF0ZSBmcmFtZSBvZiB0aGUgdmlldy5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCBNb2RlbFZpZXdUcmFuc2Zvcm0yIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdmlldy9Nb2RlbFZpZXdUcmFuc2Zvcm0yLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IE5vZGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZ3JhcGhpbmdMaW5lcyBmcm9tICcuLi8uLi9ncmFwaGluZ0xpbmVzLmpzJztcclxuaW1wb3J0IEdMQ29sb3JzIGZyb20gJy4uL0dMQ29sb3JzLmpzJztcclxuaW1wb3J0IExpbmUgZnJvbSAnLi4vbW9kZWwvTGluZS5qcyc7XHJcbmltcG9ydCBEaW1lbnNpb25hbEFycm93Tm9kZSBmcm9tICcuL0RpbWVuc2lvbmFsQXJyb3dOb2RlLmpzJztcclxuaW1wb3J0IE51bWJlckJhY2tncm91bmROb2RlIGZyb20gJy4vTnVtYmVyQmFja2dyb3VuZE5vZGUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IFZBTFVFX1hfU1BBQ0lORyA9IDY7XHJcbmNvbnN0IFZBTFVFX1lfU1BBQ0lORyA9IDY7XHJcbmNvbnN0IE5VTUJFUl9CQUNLR1JPVU5EX05PREVfT1BUSU9OUyA9IHtcclxuICBmb250OiBuZXcgUGhldEZvbnQoIHsgc2l6ZTogMTYsIHdlaWdodDogJ2JvbGQnIH0gKSxcclxuICBkZWNpbWFsUGxhY2VzOiAwLFxyXG4gIHRleHRGaWxsOiAnYmxhY2snLFxyXG4gIGJhY2tncm91bmRGaWxsOiBHTENvbG9ycy5TTE9QRSxcclxuICB4TWFyZ2luOiA2LFxyXG4gIHlNYXJnaW46IDYsXHJcbiAgY29ybmVyUmFkaXVzOiA1XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTbG9wZVRvb2xOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgcmlzZVByb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcnVuUHJvcGVydHk6IFByb3BlcnR5PG51bWJlcj47XHJcbiAgcHJpdmF0ZSByZWFkb25seSByaXNlVmFsdWVOb2RlOiBOdW1iZXJCYWNrZ3JvdW5kTm9kZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IHJ1blZhbHVlTm9kZTogTnVtYmVyQmFja2dyb3VuZE5vZGU7XHJcbiAgcHJpdmF0ZSByZWFkb25seSByaXNlQXJyb3dOb2RlOiBEaW1lbnNpb25hbEFycm93Tm9kZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IHJ1bkFycm93Tm9kZTogRGltZW5zaW9uYWxBcnJvd05vZGU7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBwYXJlbnROb2RlOiBOb2RlO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VTbG9wZVRvb2xOb2RlOiAoKSA9PiB2b2lkO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGxpbmVQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8TGluZT4sIG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMiApIHtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIHRoaXMucnVuUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIGxpbmVQcm9wZXJ0eS52YWx1ZS5ydW4gKTtcclxuICAgIHRoaXMucmlzZVByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCBsaW5lUHJvcGVydHkudmFsdWUucmlzZSApO1xyXG5cclxuICAgIHRoaXMucmlzZVZhbHVlTm9kZSA9IG5ldyBOdW1iZXJCYWNrZ3JvdW5kTm9kZSggdGhpcy5yaXNlUHJvcGVydHksIE5VTUJFUl9CQUNLR1JPVU5EX05PREVfT1BUSU9OUyApO1xyXG4gICAgdGhpcy5ydW5WYWx1ZU5vZGUgPSBuZXcgTnVtYmVyQmFja2dyb3VuZE5vZGUoIHRoaXMucnVuUHJvcGVydHksIE5VTUJFUl9CQUNLR1JPVU5EX05PREVfT1BUSU9OUyApO1xyXG5cclxuICAgIC8vIEFycm93c1xyXG4gICAgY29uc3QgYXJyb3dOb2RlT3B0aW9ucyA9IHtcclxuICAgICAgbGluZVdpZHRoOiAxLjc1LFxyXG4gICAgICBzdHJva2U6IEdMQ29sb3JzLlNMT1BFX1RPT0xfRElNRU5TSU9OQUxfTElORVMsXHJcbiAgICAgIGFycm93VGlwU2l6ZTogbmV3IERpbWVuc2lvbjIoIDEwLCAxMCApLFxyXG4gICAgICBkZWxpbWl0ZXJMZW5ndGg6IDAuNSAqIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggMSApIC8vIGhhbGYgb2Ygb25lIGNlbGwgaW4gdGhlIGdyYXBoXHJcbiAgICB9O1xyXG4gICAgdGhpcy5yaXNlQXJyb3dOb2RlID0gbmV3IERpbWVuc2lvbmFsQXJyb3dOb2RlKCAwLCAwLCAwLCA1MCwgYXJyb3dOb2RlT3B0aW9ucyApO1xyXG4gICAgdGhpcy5ydW5BcnJvd05vZGUgPSBuZXcgRGltZW5zaW9uYWxBcnJvd05vZGUoIDAsIDAsIDAsIDUwLCBhcnJvd05vZGVPcHRpb25zICk7XHJcblxyXG4gICAgLy8gUHV0IGFsbCBub2RlcyB1bmRlciBhIGNvbW1vbiBwYXJlbnQsIHNvIHdlIGNhbiBoaWRlIGZvciB6ZXJvIG9yIHVuZGVmaW5lZCBzbG9wZXNcclxuICAgIHRoaXMucGFyZW50Tm9kZSA9IG5ldyBOb2RlKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgdGhpcy5yaXNlQXJyb3dOb2RlLFxyXG4gICAgICAgIHRoaXMucmlzZVZhbHVlTm9kZSxcclxuICAgICAgICB0aGlzLnJ1bkFycm93Tm9kZSxcclxuICAgICAgICB0aGlzLnJ1blZhbHVlTm9kZVxyXG4gICAgICBdXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLnBhcmVudE5vZGUgKTtcclxuXHJcbiAgICBjb25zdCBsaW5lT2JzZXJ2ZXIgPSAoIGxpbmU6IExpbmUgKSA9PiB0aGlzLnVwZGF0ZSggbGluZSwgbW9kZWxWaWV3VHJhbnNmb3JtICk7XHJcbiAgICBsaW5lUHJvcGVydHkubGluayggbGluZU9ic2VydmVyICk7IC8vIHVubGluayBpbiBkaXNwb3NlXHJcblxyXG4gICAgLy8gVXBkYXRlIHdoZW4gdGhpcyBOb2RlIGJlY29tZXMgdmlzaWJsZVxyXG4gICAgdGhpcy52aXNpYmxlUHJvcGVydHkubGluayggdmlzaWJsZSA9PiB2aXNpYmxlICYmIHRoaXMudXBkYXRlKCBsaW5lUHJvcGVydHkudmFsdWUsIG1vZGVsVmlld1RyYW5zZm9ybSApICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlU2xvcGVUb29sTm9kZSA9ICgpID0+IHtcclxuICAgICAgdGhpcy5yaXNlVmFsdWVOb2RlLmRpc3Bvc2UoKTtcclxuICAgICAgdGhpcy5ydW5WYWx1ZU5vZGUuZGlzcG9zZSgpO1xyXG4gICAgICBsaW5lUHJvcGVydHkudW5saW5rKCBsaW5lT2JzZXJ2ZXIgKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZVNsb3BlVG9vbE5vZGUoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlKCBsaW5lOiBMaW5lLCBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTIgKTogdm9pZCB7XHJcblxyXG4gICAgLy8gdXBkYXRlIG9ubHkgaWYgdmlzaWJsZVxyXG4gICAgaWYgKCAhdGhpcy52aXNpYmxlICkgeyByZXR1cm47IH1cclxuXHJcbiAgICAvLyBTaG93IG5vdGhpbmcgZm9yIGhvcml6b250YWwgb3IgdmVydGljYWwgbGluZXMuXHJcbiAgICB0aGlzLnBhcmVudE5vZGUudmlzaWJsZSA9ICggbGluZS5yaXNlICE9PSAwICYmIGxpbmUucnVuICE9PSAwICk7XHJcbiAgICBpZiAoICF0aGlzLnBhcmVudE5vZGUudmlzaWJsZSApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHVwZGF0ZSBpbnRlcm5hbCBwcm9wZXJ0aWVzIGJlZm9yZSBkb2luZyBhbnkgbGF5b3V0XHJcbiAgICB0aGlzLnJpc2VQcm9wZXJ0eS52YWx1ZSA9IGxpbmUucmlzZTtcclxuICAgIHRoaXMucnVuUHJvcGVydHkudmFsdWUgPSBsaW5lLnJ1bjtcclxuXHJcbiAgICAvLyBjb21wdXRlIHZpZXcgY29vcmRpbmF0ZXNcclxuICAgIGNvbnN0IGdyaWRYU3BhY2luZyA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggMSApO1xyXG4gICAgY29uc3QgZ3JpZFlTcGFjaW5nID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFZKCAxICk7XHJcbiAgICBjb25zdCB4MSA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIGxpbmUueDEgKTtcclxuICAgIGNvbnN0IHkxID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggbGluZS55MSApO1xyXG4gICAgY29uc3QgeDIgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCBsaW5lLngyICk7XHJcbiAgICBjb25zdCB5MiA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1koIGxpbmUueTIgKTtcclxuXHJcbiAgICAvLyByaXNlXHJcbiAgICBjb25zdCBvZmZzZXRGYWN0b3IgPSAwLjY7XHJcbiAgICBjb25zdCB4T2Zmc2V0ID0gb2Zmc2V0RmFjdG9yICogZ3JpZFhTcGFjaW5nO1xyXG4gICAgaWYgKCBsaW5lLnJ1biA+IDAgKSB7XHJcbiAgICAgIC8vIHZlcnRpY2FsIGFycm93IHRvIGxlZnQgb2YgcG9pbnRcclxuICAgICAgdGhpcy5yaXNlQXJyb3dOb2RlLnNldFRhaWxBbmRUaXAoIHgxIC0geE9mZnNldCwgeTEsIHgxIC0geE9mZnNldCwgeTIgKTtcclxuICAgICAgLy8gdmFsdWUgdG8gbGVmdCBvZiBhcnJvd1xyXG4gICAgICB0aGlzLnJpc2VWYWx1ZU5vZGUucmlnaHQgPSB0aGlzLnJpc2VBcnJvd05vZGUubGVmdCAtIFZBTFVFX1hfU1BBQ0lORztcclxuICAgICAgdGhpcy5yaXNlVmFsdWVOb2RlLmNlbnRlclkgPSB0aGlzLnJpc2VBcnJvd05vZGUuY2VudGVyWTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAvLyB2ZXJ0aWNhbCBhcnJvdyB0byByaWdodCBvZiBwb2ludFxyXG4gICAgICB0aGlzLnJpc2VBcnJvd05vZGUuc2V0VGFpbEFuZFRpcCggeDEgKyB4T2Zmc2V0LCB5MSwgeDEgKyB4T2Zmc2V0LCB5MiApO1xyXG4gICAgICAvLyB2YWx1ZSB0byByaWdodCBvZiBhcnJvd1xyXG4gICAgICB0aGlzLnJpc2VWYWx1ZU5vZGUubGVmdCA9IHRoaXMucmlzZUFycm93Tm9kZS5yaWdodCArIFZBTFVFX1hfU1BBQ0lORztcclxuICAgICAgdGhpcy5yaXNlVmFsdWVOb2RlLmNlbnRlclkgPSB0aGlzLnJpc2VBcnJvd05vZGUuY2VudGVyWTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBydW5cclxuICAgIGNvbnN0IHlPZmZzZXQgPSBvZmZzZXRGYWN0b3IgKiBncmlkWVNwYWNpbmc7XHJcbiAgICBpZiAoIGxpbmUucmlzZSA+IDAgKSB7XHJcbiAgICAgIC8vIGhvcml6b250YWwgYXJyb3cgYmVsb3cgcG9pbnRcclxuICAgICAgdGhpcy5ydW5BcnJvd05vZGUuc2V0VGFpbEFuZFRpcCggeDEsIHkyICsgeU9mZnNldCwgeDIsIHkyICsgeU9mZnNldCApO1xyXG4gICAgICAvLyB2YWx1ZSBhYm92ZSBhcnJvd1xyXG4gICAgICB0aGlzLnJ1blZhbHVlTm9kZS5jZW50ZXJYID0gdGhpcy5ydW5BcnJvd05vZGUuY2VudGVyWDtcclxuICAgICAgdGhpcy5ydW5WYWx1ZU5vZGUuYm90dG9tID0gdGhpcy5ydW5BcnJvd05vZGUudG9wIC0gVkFMVUVfWV9TUEFDSU5HO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIC8vIGhvcml6b250YWwgYXJyb3cgYWJvdmUgcG9pbnRcclxuICAgICAgdGhpcy5ydW5BcnJvd05vZGUuc2V0VGFpbEFuZFRpcCggeDEsIHkyIC0geU9mZnNldCwgeDIsIHkyIC0geU9mZnNldCApO1xyXG4gICAgICAvLyB2YWx1ZSBiZWxvdyBhcnJvd1xyXG4gICAgICB0aGlzLnJ1blZhbHVlTm9kZS5jZW50ZXJYID0gdGhpcy5ydW5BcnJvd05vZGUuY2VudGVyWDtcclxuICAgICAgdGhpcy5ydW5WYWx1ZU5vZGUudG9wID0gdGhpcy5ydW5BcnJvd05vZGUuYm90dG9tICsgVkFMVUVfWV9TUEFDSU5HO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZ3JhcGhpbmdMaW5lcy5yZWdpc3RlciggJ1Nsb3BlVG9vbE5vZGUnLCBTbG9wZVRvb2xOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxjQUFjLE1BQU0sdUNBQXVDO0FBR2xFLE9BQU9DLFVBQVUsTUFBTSxrQ0FBa0M7QUFFekQsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxTQUFTQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ3hELE9BQU9DLGFBQWEsTUFBTSx3QkFBd0I7QUFDbEQsT0FBT0MsUUFBUSxNQUFNLGdCQUFnQjtBQUVyQyxPQUFPQyxvQkFBb0IsTUFBTSwyQkFBMkI7QUFDNUQsT0FBT0Msb0JBQW9CLE1BQU0sMkJBQTJCOztBQUU1RDtBQUNBLE1BQU1DLGVBQWUsR0FBRyxDQUFDO0FBQ3pCLE1BQU1DLGVBQWUsR0FBRyxDQUFDO0FBQ3pCLE1BQU1DLDhCQUE4QixHQUFHO0VBQ3JDQyxJQUFJLEVBQUUsSUFBSVQsUUFBUSxDQUFFO0lBQUVVLElBQUksRUFBRSxFQUFFO0lBQUVDLE1BQU0sRUFBRTtFQUFPLENBQUUsQ0FBQztFQUNsREMsYUFBYSxFQUFFLENBQUM7RUFDaEJDLFFBQVEsRUFBRSxPQUFPO0VBQ2pCQyxjQUFjLEVBQUVYLFFBQVEsQ0FBQ1ksS0FBSztFQUM5QkMsT0FBTyxFQUFFLENBQUM7RUFDVkMsT0FBTyxFQUFFLENBQUM7RUFDVkMsWUFBWSxFQUFFO0FBQ2hCLENBQUM7QUFFRCxlQUFlLE1BQU1DLGFBQWEsU0FBU2xCLElBQUksQ0FBQztFQVl2Q21CLFdBQVdBLENBQUVDLFlBQXFDLEVBQUVDLGtCQUF1QyxFQUFHO0lBRW5HLEtBQUssQ0FBQyxDQUFDO0lBRVAsSUFBSSxDQUFDQyxX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