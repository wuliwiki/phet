// Copyright 2013-2023, University of Colorado Boulder

/**
 * Manipulator for changing a line's y-intercept.
 * This manipulates (x1,y1), keeping x1 constrained to zero, and effectively dragging along the y-axis.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Utils from '../../../../../dot/js/Utils.js';
import Vector2 from '../../../../../dot/js/Vector2.js';
import { DragListener } from '../../../../../scenery/js/imports.js';
import graphingLines from '../../../graphingLines.js';
import GLColors from '../../GLColors.js';
import Line from '../../model/Line.js';
import Manipulator from './Manipulator.js';
export default class YInterceptManipulator extends Manipulator {
  constructor(radius, lineProperty, y1RangeProperty, modelViewTransform) {
    super(radius, GLColors.INTERCEPT, {
      haloAlpha: GLColors.HALO_ALPHA.intercept
    });

    // move the manipulator to match the line's (x1,y1) point
    const lineObserver = line => {
      this.translation = modelViewTransform.modelToViewPosition(new Vector2(line.x1, line.y1));
    };
    lineProperty.link(lineObserver); // unlink in dispose

    this.addInputListener(new YInterceptDragListener(this, lineProperty, y1RangeProperty, modelViewTransform));
    this.disposeYInterceptManipulator = () => {
      lineProperty.unlink(lineObserver);
    };
  }
  dispose() {
    this.disposeYInterceptManipulator();
    super.dispose();
  }
}

/**
 * Drag listener for y-intercept manipulator.
 */
class YInterceptDragListener extends DragListener {
  constructor(targetNode, lineProperty, y1RangeProperty, modelViewTransform) {
    let startOffset; // where the drag started, relative to the y-intercept, in parent view coordinates

    super({
      allowTouchSnag: true,
      // note where the drag started
      start: event => {
        const line = lineProperty.value;
        const position = modelViewTransform.modelToViewXY(line.x1, line.y1);
        startOffset = targetNode.globalToParentPoint(event.pointer.point).minus(position);
      },
      drag: event => {
        const parentPoint = targetNode.globalToParentPoint(event.pointer.point).minus(startOffset);
        const position = modelViewTransform.viewToModelPosition(parentPoint);

        // constrain to range, snap to grid
        const y1 = Utils.roundSymmetric(Utils.clamp(position.y, y1RangeProperty.value.min, y1RangeProperty.value.max));
        const line = lineProperty.value;

        // Keep slope constant, change y1.
        lineProperty.value = Line.createSlopeIntercept(line.rise, line.run, y1, line.color);
      }
    });
  }
}
graphingLines.register('YInterceptManipulator', YInterceptManipulator);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlZlY3RvcjIiLCJEcmFnTGlzdGVuZXIiLCJncmFwaGluZ0xpbmVzIiwiR0xDb2xvcnMiLCJMaW5lIiwiTWFuaXB1bGF0b3IiLCJZSW50ZXJjZXB0TWFuaXB1bGF0b3IiLCJjb25zdHJ1Y3RvciIsInJhZGl1cyIsImxpbmVQcm9wZXJ0eSIsInkxUmFuZ2VQcm9wZXJ0eSIsIm1vZGVsVmlld1RyYW5zZm9ybSIsIklOVEVSQ0VQVCIsImhhbG9BbHBoYSIsIkhBTE9fQUxQSEEiLCJpbnRlcmNlcHQiLCJsaW5lT2JzZXJ2ZXIiLCJsaW5lIiwidHJhbnNsYXRpb24iLCJtb2RlbFRvVmlld1Bvc2l0aW9uIiwieDEiLCJ5MSIsImxpbmsiLCJhZGRJbnB1dExpc3RlbmVyIiwiWUludGVyY2VwdERyYWdMaXN0ZW5lciIsImRpc3Bvc2VZSW50ZXJjZXB0TWFuaXB1bGF0b3IiLCJ1bmxpbmsiLCJkaXNwb3NlIiwidGFyZ2V0Tm9kZSIsInN0YXJ0T2Zmc2V0IiwiYWxsb3dUb3VjaFNuYWciLCJzdGFydCIsImV2ZW50IiwidmFsdWUiLCJwb3NpdGlvbiIsIm1vZGVsVG9WaWV3WFkiLCJnbG9iYWxUb1BhcmVudFBvaW50IiwicG9pbnRlciIsInBvaW50IiwibWludXMiLCJkcmFnIiwicGFyZW50UG9pbnQiLCJ2aWV3VG9Nb2RlbFBvc2l0aW9uIiwicm91bmRTeW1tZXRyaWMiLCJjbGFtcCIsInkiLCJtaW4iLCJtYXgiLCJjcmVhdGVTbG9wZUludGVyY2VwdCIsInJpc2UiLCJydW4iLCJjb2xvciIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiWUludGVyY2VwdE1hbmlwdWxhdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDEzLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIE1hbmlwdWxhdG9yIGZvciBjaGFuZ2luZyBhIGxpbmUncyB5LWludGVyY2VwdC5cclxuICogVGhpcyBtYW5pcHVsYXRlcyAoeDEseTEpLCBrZWVwaW5nIHgxIGNvbnN0cmFpbmVkIHRvIHplcm8sIGFuZCBlZmZlY3RpdmVseSBkcmFnZ2luZyBhbG9uZyB0aGUgeS1heGlzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgeyBEcmFnTGlzdGVuZXIsIE5vZGUgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZ3JhcGhpbmdMaW5lcyBmcm9tICcuLi8uLi8uLi9ncmFwaGluZ0xpbmVzLmpzJztcclxuaW1wb3J0IEdMQ29sb3JzIGZyb20gJy4uLy4uL0dMQ29sb3JzLmpzJztcclxuaW1wb3J0IExpbmUgZnJvbSAnLi4vLi4vbW9kZWwvTGluZS5qcyc7XHJcbmltcG9ydCBNYW5pcHVsYXRvciBmcm9tICcuL01hbmlwdWxhdG9yLmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFlJbnRlcmNlcHRNYW5pcHVsYXRvciBleHRlbmRzIE1hbmlwdWxhdG9yIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlWUludGVyY2VwdE1hbmlwdWxhdG9yOiAoKSA9PiB2b2lkO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHJhZGl1czogbnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgbGluZVByb3BlcnR5OiBQcm9wZXJ0eTxMaW5lPixcclxuICAgICAgICAgICAgICAgICAgICAgIHkxUmFuZ2VQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8UmFuZ2U+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtOiBNb2RlbFZpZXdUcmFuc2Zvcm0yICkge1xyXG5cclxuICAgIHN1cGVyKCByYWRpdXMsIEdMQ29sb3JzLklOVEVSQ0VQVCwgeyBoYWxvQWxwaGE6IEdMQ29sb3JzLkhBTE9fQUxQSEEuaW50ZXJjZXB0IH0gKTtcclxuXHJcbiAgICAvLyBtb3ZlIHRoZSBtYW5pcHVsYXRvciB0byBtYXRjaCB0aGUgbGluZSdzICh4MSx5MSkgcG9pbnRcclxuICAgIGNvbnN0IGxpbmVPYnNlcnZlciA9ICggbGluZTogTGluZSApID0+IHtcclxuICAgICAgdGhpcy50cmFuc2xhdGlvbiA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBuZXcgVmVjdG9yMiggbGluZS54MSwgbGluZS55MSApICk7XHJcbiAgICB9O1xyXG4gICAgbGluZVByb3BlcnR5LmxpbmsoIGxpbmVPYnNlcnZlciApOyAvLyB1bmxpbmsgaW4gZGlzcG9zZVxyXG5cclxuICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggbmV3IFlJbnRlcmNlcHREcmFnTGlzdGVuZXIoIHRoaXMsIGxpbmVQcm9wZXJ0eSwgeTFSYW5nZVByb3BlcnR5LCBtb2RlbFZpZXdUcmFuc2Zvcm0gKSApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZVlJbnRlcmNlcHRNYW5pcHVsYXRvciA9ICgpID0+IHtcclxuICAgICAgbGluZVByb3BlcnR5LnVubGluayggbGluZU9ic2VydmVyICk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VZSW50ZXJjZXB0TWFuaXB1bGF0b3IoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEcmFnIGxpc3RlbmVyIGZvciB5LWludGVyY2VwdCBtYW5pcHVsYXRvci5cclxuICovXHJcbmNsYXNzIFlJbnRlcmNlcHREcmFnTGlzdGVuZXIgZXh0ZW5kcyBEcmFnTGlzdGVuZXIge1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHRhcmdldE5vZGU6IE5vZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICBsaW5lUHJvcGVydHk6IFByb3BlcnR5PExpbmU+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgeTFSYW5nZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxSYW5nZT4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTIgKSB7XHJcblxyXG4gICAgbGV0IHN0YXJ0T2Zmc2V0OiBWZWN0b3IyOyAvLyB3aGVyZSB0aGUgZHJhZyBzdGFydGVkLCByZWxhdGl2ZSB0byB0aGUgeS1pbnRlcmNlcHQsIGluIHBhcmVudCB2aWV3IGNvb3JkaW5hdGVzXHJcblxyXG4gICAgc3VwZXIoIHtcclxuXHJcbiAgICAgIGFsbG93VG91Y2hTbmFnOiB0cnVlLFxyXG5cclxuICAgICAgLy8gbm90ZSB3aGVyZSB0aGUgZHJhZyBzdGFydGVkXHJcbiAgICAgIHN0YXJ0OiBldmVudCA9PiB7XHJcbiAgICAgICAgY29uc3QgbGluZSA9IGxpbmVQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1hZKCBsaW5lLngxLCBsaW5lLnkxICk7XHJcbiAgICAgICAgc3RhcnRPZmZzZXQgPSB0YXJnZXROb2RlLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKS5taW51cyggcG9zaXRpb24gKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGRyYWc6IGV2ZW50ID0+IHtcclxuXHJcbiAgICAgICAgY29uc3QgcGFyZW50UG9pbnQgPSB0YXJnZXROb2RlLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKS5taW51cyggc3RhcnRPZmZzZXQgKTtcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbFBvc2l0aW9uKCBwYXJlbnRQb2ludCApO1xyXG5cclxuICAgICAgICAvLyBjb25zdHJhaW4gdG8gcmFuZ2UsIHNuYXAgdG8gZ3JpZFxyXG4gICAgICAgIGNvbnN0IHkxID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIFV0aWxzLmNsYW1wKCBwb3NpdGlvbi55LCB5MVJhbmdlUHJvcGVydHkudmFsdWUubWluLCB5MVJhbmdlUHJvcGVydHkudmFsdWUubWF4ICkgKTtcclxuICAgICAgICBjb25zdCBsaW5lID0gbGluZVByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgICAgICAvLyBLZWVwIHNsb3BlIGNvbnN0YW50LCBjaGFuZ2UgeTEuXHJcbiAgICAgICAgbGluZVByb3BlcnR5LnZhbHVlID0gTGluZS5jcmVhdGVTbG9wZUludGVyY2VwdCggbGluZS5yaXNlLCBsaW5lLnJ1biwgeTEsIGxpbmUuY29sb3IgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxuZ3JhcGhpbmdMaW5lcy5yZWdpc3RlciggJ1lJbnRlcmNlcHRNYW5pcHVsYXRvcicsIFlJbnRlcmNlcHRNYW5pcHVsYXRvciApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUtBLE9BQU9BLEtBQUssTUFBTSxnQ0FBZ0M7QUFDbEQsT0FBT0Ms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