// Copyright 2013-2023, University of Colorado Boulder

/**
 * Drag listener for an arbitrary point (Vector2).
 * Used exclusively in 'Place the Points' game challenges.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Utils from '../../../../../dot/js/Utils.js';
import Vector2 from '../../../../../dot/js/Vector2.js';
import { DragListener } from '../../../../../scenery/js/imports.js';
import graphingLines from '../../../graphingLines.js';
import GLColors from '../../GLColors.js';
import Manipulator from './Manipulator.js';
export default class PointManipulator extends Manipulator {
  constructor(radius, pointProperty, otherPointProperties,
  // points that pointProperty cannot be on
  xRange, yRange, modelViewTransform) {
    super(radius, GLColors.POINT, {
      haloAlpha: GLColors.HALO_ALPHA.point
    });

    // move the manipulator to match the point
    const lineObserver = point => {
      this.translation = modelViewTransform.modelToViewPosition(point);
    };
    pointProperty.link(lineObserver); // unlink in dispose

    this.addInputListener(new PointDragListener(this, pointProperty, otherPointProperties, xRange, yRange, modelViewTransform));
    this.disposePointManipulator = () => {
      pointProperty.unlink(lineObserver);
    };
  }
  dispose() {
    this.disposePointManipulator();
    super.dispose();
  }
}

/**
 * Drag listener for an arbitrary point.
 */
class PointDragListener extends DragListener {
  constructor(targetNode, pointProperty, otherPointProperties, xRange, yRange, modelViewTransform) {
    let startOffset; // where the drag started, relative to the slope manipulator, in parent view coordinates

    super({
      allowTouchSnag: true,
      // note where the drag started
      start: event => {
        const position = modelViewTransform.modelToViewPosition(pointProperty.value);
        startOffset = targetNode.globalToParentPoint(event.pointer.point).minus(position);
      },
      drag: event => {
        const parentPoint = targetNode.globalToParentPoint(event.pointer.point).minus(startOffset);
        const position = modelViewTransform.viewToModelPosition(parentPoint);

        // constrain to range, snap to grid
        const x = Utils.roundSymmetric(Utils.clamp(position.x, xRange.min, xRange.max));
        const y = Utils.roundSymmetric(Utils.clamp(position.y, yRange.min, yRange.max));
        const p = new Vector2(x, y);

        // is this point the same as one of the others?
        let same = false;
        for (let i = 0; i < otherPointProperties.length; i++) {
          if (p.equals(otherPointProperties[i].value)) {
            same = true;
            break;
          }
        }

        // if the point is unique, set it
        if (!same) {
          pointProperty.value = p;
        }
      }
    });
  }
}
graphingLines.register('PointManipulator', PointManipulator);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlZlY3RvcjIiLCJEcmFnTGlzdGVuZXIiLCJncmFwaGluZ0xpbmVzIiwiR0xDb2xvcnMiLCJNYW5pcHVsYXRvciIsIlBvaW50TWFuaXB1bGF0b3IiLCJjb25zdHJ1Y3RvciIsInJhZGl1cyIsInBvaW50UHJvcGVydHkiLCJvdGhlclBvaW50UHJvcGVydGllcyIsInhSYW5nZSIsInlSYW5nZSIsIm1vZGVsVmlld1RyYW5zZm9ybSIsIlBPSU5UIiwiaGFsb0FscGhhIiwiSEFMT19BTFBIQSIsInBvaW50IiwibGluZU9ic2VydmVyIiwidHJhbnNsYXRpb24iLCJtb2RlbFRvVmlld1Bvc2l0aW9uIiwibGluayIsImFkZElucHV0TGlzdGVuZXIiLCJQb2ludERyYWdMaXN0ZW5lciIsImRpc3Bvc2VQb2ludE1hbmlwdWxhdG9yIiwidW5saW5rIiwiZGlzcG9zZSIsInRhcmdldE5vZGUiLCJzdGFydE9mZnNldCIsImFsbG93VG91Y2hTbmFnIiwic3RhcnQiLCJldmVudCIsInBvc2l0aW9uIiwidmFsdWUiLCJnbG9iYWxUb1BhcmVudFBvaW50IiwicG9pbnRlciIsIm1pbnVzIiwiZHJhZyIsInBhcmVudFBvaW50Iiwidmlld1RvTW9kZWxQb3NpdGlvbiIsIngiLCJyb3VuZFN5bW1ldHJpYyIsImNsYW1wIiwibWluIiwibWF4IiwieSIsInAiLCJzYW1lIiwiaSIsImxlbmd0aCIsImVxdWFscyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUG9pbnRNYW5pcHVsYXRvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxMy0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBEcmFnIGxpc3RlbmVyIGZvciBhbiBhcmJpdHJhcnkgcG9pbnQgKFZlY3RvcjIpLlxyXG4gKiBVc2VkIGV4Y2x1c2l2ZWx5IGluICdQbGFjZSB0aGUgUG9pbnRzJyBnYW1lIGNoYWxsZW5nZXMuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgTW9kZWxWaWV3VHJhbnNmb3JtMiBmcm9tICcuLi8uLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qcyc7XHJcbmltcG9ydCB7IERyYWdMaXN0ZW5lciwgTm9kZSB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBncmFwaGluZ0xpbmVzIGZyb20gJy4uLy4uLy4uL2dyYXBoaW5nTGluZXMuanMnO1xyXG5pbXBvcnQgR0xDb2xvcnMgZnJvbSAnLi4vLi4vR0xDb2xvcnMuanMnO1xyXG5pbXBvcnQgTWFuaXB1bGF0b3IgZnJvbSAnLi9NYW5pcHVsYXRvci5qcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb2ludE1hbmlwdWxhdG9yIGV4dGVuZHMgTWFuaXB1bGF0b3Ige1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VQb2ludE1hbmlwdWxhdG9yOiAoKSA9PiB2b2lkO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHJhZGl1czogbnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgcG9pbnRQcm9wZXJ0eTogUHJvcGVydHk8VmVjdG9yMj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBvdGhlclBvaW50UHJvcGVydGllczogVFJlYWRPbmx5UHJvcGVydHk8VmVjdG9yMj5bXSwgLy8gcG9pbnRzIHRoYXQgcG9pbnRQcm9wZXJ0eSBjYW5ub3QgYmUgb25cclxuICAgICAgICAgICAgICAgICAgICAgIHhSYW5nZTogUmFuZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICB5UmFuZ2U6IFJhbmdlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtOiBNb2RlbFZpZXdUcmFuc2Zvcm0yICkge1xyXG5cclxuICAgIHN1cGVyKCByYWRpdXMsIEdMQ29sb3JzLlBPSU5ULCB7IGhhbG9BbHBoYTogR0xDb2xvcnMuSEFMT19BTFBIQS5wb2ludCB9ICk7XHJcblxyXG4gICAgLy8gbW92ZSB0aGUgbWFuaXB1bGF0b3IgdG8gbWF0Y2ggdGhlIHBvaW50XHJcbiAgICBjb25zdCBsaW5lT2JzZXJ2ZXIgPSAoIHBvaW50OiBWZWN0b3IyICkgPT4ge1xyXG4gICAgICB0aGlzLnRyYW5zbGF0aW9uID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIHBvaW50ICk7XHJcbiAgICB9O1xyXG4gICAgcG9pbnRQcm9wZXJ0eS5saW5rKCBsaW5lT2JzZXJ2ZXIgKTsgLy8gdW5saW5rIGluIGRpc3Bvc2VcclxuXHJcbiAgICB0aGlzLmFkZElucHV0TGlzdGVuZXIoIG5ldyBQb2ludERyYWdMaXN0ZW5lciggdGhpcywgcG9pbnRQcm9wZXJ0eSwgb3RoZXJQb2ludFByb3BlcnRpZXMsIHhSYW5nZSwgeVJhbmdlLCBtb2RlbFZpZXdUcmFuc2Zvcm0gKSApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZVBvaW50TWFuaXB1bGF0b3IgPSAoKSA9PiB7XHJcbiAgICAgIHBvaW50UHJvcGVydHkudW5saW5rKCBsaW5lT2JzZXJ2ZXIgKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZVBvaW50TWFuaXB1bGF0b3IoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEcmFnIGxpc3RlbmVyIGZvciBhbiBhcmJpdHJhcnkgcG9pbnQuXHJcbiAqL1xyXG5jbGFzcyBQb2ludERyYWdMaXN0ZW5lciBleHRlbmRzIERyYWdMaXN0ZW5lciB7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggdGFyZ2V0Tm9kZTogTm9kZSxcclxuICAgICAgICAgICAgICAgICAgICAgIHBvaW50UHJvcGVydHk6IFByb3BlcnR5PFZlY3RvcjI+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgb3RoZXJQb2ludFByb3BlcnRpZXM6IFRSZWFkT25seVByb3BlcnR5PFZlY3RvcjI+W10sXHJcbiAgICAgICAgICAgICAgICAgICAgICB4UmFuZ2U6IFJhbmdlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgeVJhbmdlOiBSYW5nZSxcclxuICAgICAgICAgICAgICAgICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMiApIHtcclxuXHJcbiAgICBsZXQgc3RhcnRPZmZzZXQ6IFZlY3RvcjI7IC8vIHdoZXJlIHRoZSBkcmFnIHN0YXJ0ZWQsIHJlbGF0aXZlIHRvIHRoZSBzbG9wZSBtYW5pcHVsYXRvciwgaW4gcGFyZW50IHZpZXcgY29vcmRpbmF0ZXNcclxuXHJcbiAgICBzdXBlcigge1xyXG5cclxuICAgICAgYWxsb3dUb3VjaFNuYWc6IHRydWUsXHJcblxyXG4gICAgICAvLyBub3RlIHdoZXJlIHRoZSBkcmFnIHN0YXJ0ZWRcclxuICAgICAgc3RhcnQ6IGV2ZW50ID0+IHtcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBwb2ludFByb3BlcnR5LnZhbHVlICk7XHJcbiAgICAgICAgc3RhcnRPZmZzZXQgPSB0YXJnZXROb2RlLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKS5taW51cyggcG9zaXRpb24gKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGRyYWc6IGV2ZW50ID0+IHtcclxuXHJcbiAgICAgICAgY29uc3QgcGFyZW50UG9pbnQgPSB0YXJnZXROb2RlLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKS5taW51cyggc3RhcnRPZmZzZXQgKTtcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbFBvc2l0aW9uKCBwYXJlbnRQb2ludCApO1xyXG5cclxuICAgICAgICAvLyBjb25zdHJhaW4gdG8gcmFuZ2UsIHNuYXAgdG8gZ3JpZFxyXG4gICAgICAgIGNvbnN0IHggPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggVXRpbHMuY2xhbXAoIHBvc2l0aW9uLngsIHhSYW5nZS5taW4sIHhSYW5nZS5tYXggKSApO1xyXG4gICAgICAgIGNvbnN0IHkgPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggVXRpbHMuY2xhbXAoIHBvc2l0aW9uLnksIHlSYW5nZS5taW4sIHlSYW5nZS5tYXggKSApO1xyXG4gICAgICAgIGNvbnN0IHAgPSBuZXcgVmVjdG9yMiggeCwgeSApO1xyXG5cclxuICAgICAgICAvLyBpcyB0aGlzIHBvaW50IHRoZSBzYW1lIGFzIG9uZSBvZiB0aGUgb3RoZXJzP1xyXG4gICAgICAgIGxldCBzYW1lID0gZmFsc2U7XHJcbiAgICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgb3RoZXJQb2ludFByb3BlcnRpZXMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICBpZiAoIHAuZXF1YWxzKCBvdGhlclBvaW50UHJvcGVydGllc1sgaSBdLnZhbHVlICkgKSB7XHJcbiAgICAgICAgICAgIHNhbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGlmIHRoZSBwb2ludCBpcyB1bmlxdWUsIHNldCBpdFxyXG4gICAgICAgIGlmICggIXNhbWUgKSB7XHJcbiAgICAgICAgICBwb2ludFByb3BlcnR5LnZhbHVlID0gcDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbmdyYXBoaW5nTGluZXMucmVnaXN0ZXIoICdQb2ludE1hbmlwdWxhdG9yJywgUG9pbnRNYW5pcHVsYXRvciApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUtBLE9BQU9BLEtBQUssTUFBTSxnQ0FBZ0M7QUFDbEQsT0FBT0MsT0FBTyxNQUFNLGtDQUFrQztBQUV0RCxTQUFTQyxZQUFZLFFBQWMsc0NBQXNDO0FBQ3pFLE9BQU9DLGFBQWEsTUFBTSwyQkFBMkI7QUFDckQsT0FBT0MsUUFBUSxNQUFNLG1CQUFtQjtBQUN4QyxPQUFPQyxXQUFXLE1BQU0sa0JBQWtCO0FBRTFDLGVBQWUsTUFBTUMsZ0JBQWdCLFNBQVNELFdBQVcsQ0FBQztFQUlqREUsV0FBV0EsQ0FBRUMsTUFBYyxFQUNkQyxhQUFnQyxFQUNoQ0Msb0JBQWtEO0VBQUU7RUFDcERDLE1BQWEsRUFDYkMsTUFBYSxFQUNiQyxrQkFBdUMsRUFBRztJQUU1RCxLQUFLLENBQUVMLE1BQU0sRUFBRUosUUFBUSxDQUFDVSxLQUFLLEVBQUU7TUFBRUMsU0FBUyxFQUFFWCxRQUFRLENBQUNZLFVBQVUsQ0FBQ0M7SUFBTSxDQUFFLENBQUM7O0lBRXpFO0lBQ0EsTUFBTUMsWUFBWSxHQUFLRCxLQUFjLElBQU07TUFDekMsSUFBSSxDQUFDRSxXQUFXLEdBQUdOLGtCQUFrQixDQUFDTyxtQkFBbUIsQ0FBRUgsS0FBTSxDQUFDO0lBQ3BFLENBQUM7SUFDRFIsYUFBYSxDQUFDWSxJQUFJLENBQUVILFlBQWEsQ0FBQyxDQUFDLENBQUM7O0lBRXBDLElBQUksQ0FBQ0ksZ0JBQWdCLENBQUUsSUFB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