// Copyright 2013-2023, University of Colorado Boulder

/**
 * GLRewardNode is the reward that is displayed when a game is completed with a perfect score.
 * Various images (based on game level) move from top to bottom in the play area.
 * Run with the 'reward' query parameter to show the reward at the end of every game, regardless of score.
 *
 * Here's what you'll see at each level:
 *
 * Level 1 = equations
 * Level 2 = graphs
 * Level 3 = point tools
 * Level 4 = smiley faces
 * Level 5 = paper airplanes
 * Level 6 = all of the above
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Property from '../../../../axon/js/Property.js';
import dotRandom from '../../../../dot/js/dotRandom.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Vector2Property from '../../../../dot/js/Vector2Property.js';
import FaceNode from '../../../../scenery-phet/js/FaceNode.js';
import PaperAirplaneNode from '../../../../scenery-phet/js/PaperAirplaneNode.js';
import PhetColorScheme from '../../../../scenery-phet/js/PhetColorScheme.js';
import { Node } from '../../../../scenery/js/imports.js';
import RewardNode from '../../../../vegas/js/RewardNode.js';
import GLConstants from '../../common/GLConstants.js';
import Line from '../../common/model/Line.js';
import GLIconFactory from '../../common/view/GLIconFactory.js';
import PointToolBodyNode from '../../common/view/PointToolBodyNode.js';
import PointToolProbeNode from '../../common/view/PointToolProbeNode.js';
import graphingLines from '../../graphingLines.js';
import PointSlopeEquationNode from '../../pointslope/view/PointSlopeEquationNode.js';
import SlopeInterceptEquationNode from '../../slopeintercept/view/SlopeInterceptEquationNode.js';

// constants
const NUMBER_OF_NODES = 150;
const NODE_COLORS = ['yellow', PhetColorScheme.RED_COLORBLIND, 'orange', 'magenta', 'cyan', 'green'];
const EQUATION_FONT_SIZE = 24;
const GRAPH_WIDTH = 60;
const FACE_DIAMETER = 60;
const AIRPLANE_SCALE = 1.76;
export default class GLRewardNode extends RewardNode {
  constructor(rewardNodes) {
    super({
      nodes: rewardNodes
    });
  }

  /**
   * Creates a set of equations nodes.
   */
  static createEquationNodes() {
    return RewardNode.createRandomNodes(createNodes(createEquationNode, NODE_COLORS), NUMBER_OF_NODES);
  }

  /**
   * Creates a set of equations graph.
   */
  static createGraphNodes() {
    return RewardNode.createRandomNodes(createNodes(createGraphNode, NODE_COLORS), NUMBER_OF_NODES);
  }

  /**
   * Creates a set of 'point tool' nodes.
   */
  static createPointToolNodes() {
    return RewardNode.createRandomNodes(createNodes(createPointToolNode, NODE_COLORS), NUMBER_OF_NODES);
  }

  /**
   * Creates a set of 'smiley face' nodes.
   */
  static createSmileyFaceNodes() {
    return RewardNode.createRandomNodes(createNodes(createFaceNode, NODE_COLORS), NUMBER_OF_NODES);
  }

  /**
   * Creates a set of paper airplane nodes, similar to the PhET logo.
   */
  static createPaperAirplaneNodes() {
    return RewardNode.createRandomNodes(createNodes(createPaperAirplaneNode, NODE_COLORS), NUMBER_OF_NODES);
  }

  /**
   * Creates an assortment of nodes, using all of the above types.
   */
  static createAssortedNodes() {
    const nodes = createNodes(createEquationNode, NODE_COLORS).concat(createNodes(createGraphNode, NODE_COLORS)).concat(createNodes(createPointToolNode, NODE_COLORS)).concat(createNodes(createFaceNode, NODE_COLORS)).concat(createNodes(createPaperAirplaneNode, NODE_COLORS));
    return RewardNode.createRandomNodes(nodes, NUMBER_OF_NODES);
  }
}

//-----------------------------------------------------------------------------------------------
// Misc. utility functions
//-----------------------------------------------------------------------------------------------

function getRandomX() {
  return getRandomNonZeroInteger(GLConstants.X_AXIS_RANGE.min, GLConstants.X_AXIS_RANGE.max);
}
function getRandomY() {
  return getRandomNonZeroInteger(GLConstants.Y_AXIS_RANGE.min, GLConstants.Y_AXIS_RANGE.max);
}
function getRandomNonZeroInteger(min, max) {
  let i = Utils.roundSymmetric(min + dotRandom.nextDouble() * (max - min));
  if (i === 0) {
    i = 1;
  }
  return i;
}

//-----------------------------------------------------------------------------------------------
// Functions that create specific types of nodes.
// All of these function must have a {Color|String} color parameter.
//-----------------------------------------------------------------------------------------------

// Creates a random equation with the specified color.
function createEquationNode(color) {
  let node;
  if (dotRandom.nextDouble() < 0.5) {
    node = SlopeInterceptEquationNode.createDynamicLabel(new Property(Line.createSlopeIntercept(getRandomY(), getRandomX(), getRandomY(), color)), {
      fontSize: EQUATION_FONT_SIZE
    });
  } else {
    node = PointSlopeEquationNode.createDynamicLabel(new Property(Line.createPointSlope(getRandomX(), getRandomY(), getRandomX(), getRandomY(), color)), {
      fontSize: EQUATION_FONT_SIZE
    });
  }
  return node;
}

// Creates a random graph with the specified color.
function createGraphNode(color) {
  let node;
  if (dotRandom.nextDouble() < 0.5) {
    node = GLIconFactory.createGraphIcon(GRAPH_WIDTH, color, -3, -3, 3, 3); // y = +x
  } else {
    node = GLIconFactory.createGraphIcon(GRAPH_WIDTH, color, -3, 3, 3, -3); // y = -x
  }

  return node;
}

/**
 * Creates a random point tool with the specified color.
 * This does not use PointToolNode because it has too many model dependencies.
 */
function createPointToolNode(color) {
  const coordinatesProperty = new Vector2Property(new Vector2(getRandomX(), getRandomY()));
  const bodyNode = new PointToolBodyNode(coordinatesProperty, {
    backgroundFill: color
  });
  const probeNode = new PointToolProbeNode({
    centerX: 0.25 * bodyNode.width,
    top: bodyNode.bottom - 2 // overlap
  });

  return new Node({
    children: [probeNode, bodyNode]
  });
}

// Creates a smiley face with the specified color.
function createFaceNode(color) {
  return new FaceNode(FACE_DIAMETER, {
    headFill: color
  });
}

// Creates a paper airplane with the specified color.
function createPaperAirplaneNode(color) {
  return new PaperAirplaneNode({
    fill: color,
    scale: AIRPLANE_SCALE
  }); // width of around 60px
}

/**
 * Creates an array of nodes for a specified array of colors.
 * The functions above serve as the creationFunction argument.
 */
function createNodes(creationFunction, colors) {
  return colors.map(color => creationFunction(color));
}
graphingLines.register('GLRewardNode', GLRewardNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsImRvdFJhbmRvbSIsIlV0aWxzIiwiVmVjdG9yMiIsIlZlY3RvcjJQcm9wZXJ0eSIsIkZhY2VOb2RlIiwiUGFwZXJBaXJwbGFuZU5vZGUiLCJQaGV0Q29sb3JTY2hlbWUiLCJOb2RlIiwiUmV3YXJkTm9kZSIsIkdMQ29uc3RhbnRzIiwiTGluZSIsIkdMSWNvbkZhY3RvcnkiLCJQb2ludFRvb2xCb2R5Tm9kZSIsIlBvaW50VG9vbFByb2JlTm9kZSIsImdyYXBoaW5nTGluZXMiLCJQb2ludFNsb3BlRXF1YXRpb25Ob2RlIiwiU2xvcGVJbnRlcmNlcHRFcXVhdGlvbk5vZGUiLCJOVU1CRVJfT0ZfTk9ERVMiLCJOT0RFX0NPTE9SUyIsIlJFRF9DT0xPUkJMSU5EIiwiRVFVQVRJT05fRk9OVF9TSVpFIiwiR1JBUEhfV0lEVEgiLCJGQUNFX0RJQU1FVEVSIiwiQUlSUExBTkVfU0NBTEUiLCJHTFJld2FyZE5vZGUiLCJjb25zdHJ1Y3RvciIsInJld2FyZE5vZGVzIiwibm9kZXMiLCJjcmVhdGVFcXVhdGlvbk5vZGVzIiwiY3JlYXRlUmFuZG9tTm9kZXMiLCJjcmVhdGVOb2RlcyIsImNyZWF0ZUVxdWF0aW9uTm9kZSIsImNyZWF0ZUdyYXBoTm9kZXMiLCJjcmVhdGVHcmFwaE5vZGUiLCJjcmVhdGVQb2ludFRvb2xOb2RlcyIsImNyZWF0ZVBvaW50VG9vbE5vZGUiLCJjcmVhdGVTbWlsZXlGYWNlTm9kZXMiLCJjcmVhdGVGYWNlTm9kZSIsImNyZWF0ZVBhcGVyQWlycGxhbmVOb2RlcyIsImNyZWF0ZVBhcGVyQWlycGxhbmVOb2RlIiwiY3JlYXRlQXNzb3J0ZWROb2RlcyIsImNvbmNhdCIsImdldFJhbmRvbVgiLCJnZXRSYW5kb21Ob25aZXJvSW50ZWdlciIsIlhfQVhJU19SQU5HRSIsIm1pbiIsIm1heCIsImdldFJhbmRvbVkiLCJZX0FYSVNfUkFOR0UiLCJpIiwicm91bmRTeW1tZXRyaWMiLCJuZXh0RG91YmxlIiwiY29sb3IiLCJub2RlIiwiY3JlYXRlRHluYW1pY0xhYmVsIiwiY3JlYXRlU2xvcGVJbnRlcmNlcHQiLCJmb250U2l6ZSIsImNyZWF0ZVBvaW50U2xvcGUiLCJjcmVhdGVHcmFwaEljb24iLCJjb29yZGluYXRlc1Byb3BlcnR5IiwiYm9keU5vZGUiLCJiYWNrZ3JvdW5kRmlsbCIsInByb2JlTm9kZSIsImNlbnRlclgiLCJ3aWR0aCIsInRvcCIsImJvdHRvbSIsImNoaWxkcmVuIiwiaGVhZEZpbGwiLCJmaWxsIiwic2NhbGUiLCJjcmVhdGlvbkZ1bmN0aW9uIiwiY29sb3JzIiwibWFwIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJHTFJld2FyZE5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogR0xSZXdhcmROb2RlIGlzIHRoZSByZXdhcmQgdGhhdCBpcyBkaXNwbGF5ZWQgd2hlbiBhIGdhbWUgaXMgY29tcGxldGVkIHdpdGggYSBwZXJmZWN0IHNjb3JlLlxyXG4gKiBWYXJpb3VzIGltYWdlcyAoYmFzZWQgb24gZ2FtZSBsZXZlbCkgbW92ZSBmcm9tIHRvcCB0byBib3R0b20gaW4gdGhlIHBsYXkgYXJlYS5cclxuICogUnVuIHdpdGggdGhlICdyZXdhcmQnIHF1ZXJ5IHBhcmFtZXRlciB0byBzaG93IHRoZSByZXdhcmQgYXQgdGhlIGVuZCBvZiBldmVyeSBnYW1lLCByZWdhcmRsZXNzIG9mIHNjb3JlLlxyXG4gKlxyXG4gKiBIZXJlJ3Mgd2hhdCB5b3UnbGwgc2VlIGF0IGVhY2ggbGV2ZWw6XHJcbiAqXHJcbiAqIExldmVsIDEgPSBlcXVhdGlvbnNcclxuICogTGV2ZWwgMiA9IGdyYXBoc1xyXG4gKiBMZXZlbCAzID0gcG9pbnQgdG9vbHNcclxuICogTGV2ZWwgNCA9IHNtaWxleSBmYWNlc1xyXG4gKiBMZXZlbCA1ID0gcGFwZXIgYWlycGxhbmVzXHJcbiAqIExldmVsIDYgPSBhbGwgb2YgdGhlIGFib3ZlXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgZG90UmFuZG9tIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9kb3RSYW5kb20uanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMlByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRmFjZU5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL0ZhY2VOb2RlLmpzJztcclxuaW1wb3J0IFBhcGVyQWlycGxhbmVOb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QYXBlckFpcnBsYW5lTm9kZS5qcyc7XHJcbmltcG9ydCBQaGV0Q29sb3JTY2hlbWUgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRDb2xvclNjaGVtZS5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFJld2FyZE5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vdmVnYXMvanMvUmV3YXJkTm9kZS5qcyc7XHJcbmltcG9ydCBHTENvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vR0xDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgTGluZSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvTGluZS5qcyc7XHJcbmltcG9ydCBHTEljb25GYWN0b3J5IGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0dMSWNvbkZhY3RvcnkuanMnO1xyXG5pbXBvcnQgUG9pbnRUb29sQm9keU5vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvUG9pbnRUb29sQm9keU5vZGUuanMnO1xyXG5pbXBvcnQgUG9pbnRUb29sUHJvYmVOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L1BvaW50VG9vbFByb2JlTm9kZS5qcyc7XHJcbmltcG9ydCBncmFwaGluZ0xpbmVzIGZyb20gJy4uLy4uL2dyYXBoaW5nTGluZXMuanMnO1xyXG5pbXBvcnQgUG9pbnRTbG9wZUVxdWF0aW9uTm9kZSBmcm9tICcuLi8uLi9wb2ludHNsb3BlL3ZpZXcvUG9pbnRTbG9wZUVxdWF0aW9uTm9kZS5qcyc7XHJcbmltcG9ydCBTbG9wZUludGVyY2VwdEVxdWF0aW9uTm9kZSBmcm9tICcuLi8uLi9zbG9wZWludGVyY2VwdC92aWV3L1Nsb3BlSW50ZXJjZXB0RXF1YXRpb25Ob2RlLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBOVU1CRVJfT0ZfTk9ERVMgPSAxNTA7XHJcbmNvbnN0IE5PREVfQ09MT1JTID0gWyAneWVsbG93JywgUGhldENvbG9yU2NoZW1lLlJFRF9DT0xPUkJMSU5ELCAnb3JhbmdlJywgJ21hZ2VudGEnLCAnY3lhbicsICdncmVlbicgXTtcclxuY29uc3QgRVFVQVRJT05fRk9OVF9TSVpFID0gMjQ7XHJcbmNvbnN0IEdSQVBIX1dJRFRIID0gNjA7XHJcbmNvbnN0IEZBQ0VfRElBTUVURVIgPSA2MDtcclxuY29uc3QgQUlSUExBTkVfU0NBTEUgPSAxLjc2O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR0xSZXdhcmROb2RlIGV4dGVuZHMgUmV3YXJkTm9kZSB7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcmV3YXJkTm9kZXM6IE5vZGVbXSApIHtcclxuICAgIHN1cGVyKCB7IG5vZGVzOiByZXdhcmROb2RlcyB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgc2V0IG9mIGVxdWF0aW9ucyBub2Rlcy5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGNyZWF0ZUVxdWF0aW9uTm9kZXMoKTogTm9kZVtdIHtcclxuICAgIHJldHVybiBSZXdhcmROb2RlLmNyZWF0ZVJhbmRvbU5vZGVzKCBjcmVhdGVOb2RlcyggY3JlYXRlRXF1YXRpb25Ob2RlLCBOT0RFX0NPTE9SUyApLCBOVU1CRVJfT0ZfTk9ERVMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBzZXQgb2YgZXF1YXRpb25zIGdyYXBoLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlR3JhcGhOb2RlcygpOiBOb2RlW10ge1xyXG4gICAgcmV0dXJuIFJld2FyZE5vZGUuY3JlYXRlUmFuZG9tTm9kZXMoIGNyZWF0ZU5vZGVzKCBjcmVhdGVHcmFwaE5vZGUsIE5PREVfQ09MT1JTICksIE5VTUJFUl9PRl9OT0RFUyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhIHNldCBvZiAncG9pbnQgdG9vbCcgbm9kZXMuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVQb2ludFRvb2xOb2RlcygpOiBOb2RlW10ge1xyXG4gICAgcmV0dXJuIFJld2FyZE5vZGUuY3JlYXRlUmFuZG9tTm9kZXMoIGNyZWF0ZU5vZGVzKCBjcmVhdGVQb2ludFRvb2xOb2RlLCBOT0RFX0NPTE9SUyApLCBOVU1CRVJfT0ZfTk9ERVMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBzZXQgb2YgJ3NtaWxleSBmYWNlJyBub2Rlcy5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGNyZWF0ZVNtaWxleUZhY2VOb2RlcygpOiBOb2RlW10ge1xyXG4gICAgcmV0dXJuIFJld2FyZE5vZGUuY3JlYXRlUmFuZG9tTm9kZXMoIGNyZWF0ZU5vZGVzKCBjcmVhdGVGYWNlTm9kZSwgTk9ERV9DT0xPUlMgKSwgTlVNQkVSX09GX05PREVTICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgc2V0IG9mIHBhcGVyIGFpcnBsYW5lIG5vZGVzLCBzaW1pbGFyIHRvIHRoZSBQaEVUIGxvZ28uXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVQYXBlckFpcnBsYW5lTm9kZXMoKTogTm9kZVtdIHtcclxuICAgIHJldHVybiBSZXdhcmROb2RlLmNyZWF0ZVJhbmRvbU5vZGVzKCBjcmVhdGVOb2RlcyggY3JlYXRlUGFwZXJBaXJwbGFuZU5vZGUsIE5PREVfQ09MT1JTICksIE5VTUJFUl9PRl9OT0RFUyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhbiBhc3NvcnRtZW50IG9mIG5vZGVzLCB1c2luZyBhbGwgb2YgdGhlIGFib3ZlIHR5cGVzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlQXNzb3J0ZWROb2RlcygpOiBOb2RlW10ge1xyXG4gICAgY29uc3Qgbm9kZXMgPSBjcmVhdGVOb2RlcyggY3JlYXRlRXF1YXRpb25Ob2RlLCBOT0RFX0NPTE9SUyApXHJcbiAgICAgIC5jb25jYXQoIGNyZWF0ZU5vZGVzKCBjcmVhdGVHcmFwaE5vZGUsIE5PREVfQ09MT1JTICkgKVxyXG4gICAgICAuY29uY2F0KCBjcmVhdGVOb2RlcyggY3JlYXRlUG9pbnRUb29sTm9kZSwgTk9ERV9DT0xPUlMgKSApXHJcbiAgICAgIC5jb25jYXQoIGNyZWF0ZU5vZGVzKCBjcmVhdGVGYWNlTm9kZSwgTk9ERV9DT0xPUlMgKSApXHJcbiAgICAgIC5jb25jYXQoIGNyZWF0ZU5vZGVzKCBjcmVhdGVQYXBlckFpcnBsYW5lTm9kZSwgTk9ERV9DT0xPUlMgKSApO1xyXG4gICAgcmV0dXJuIFJld2FyZE5vZGUuY3JlYXRlUmFuZG9tTm9kZXMoIG5vZGVzLCBOVU1CRVJfT0ZfTk9ERVMgKTtcclxuICB9XHJcbn1cclxuXHJcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLy8gTWlzYy4gdXRpbGl0eSBmdW5jdGlvbnNcclxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZnVuY3Rpb24gZ2V0UmFuZG9tWCgpOiBudW1iZXIge1xyXG4gIHJldHVybiBnZXRSYW5kb21Ob25aZXJvSW50ZWdlciggR0xDb25zdGFudHMuWF9BWElTX1JBTkdFLm1pbiwgR0xDb25zdGFudHMuWF9BWElTX1JBTkdFLm1heCApO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRSYW5kb21ZKCk6IG51bWJlciB7XHJcbiAgcmV0dXJuIGdldFJhbmRvbU5vblplcm9JbnRlZ2VyKCBHTENvbnN0YW50cy5ZX0FYSVNfUkFOR0UubWluLCBHTENvbnN0YW50cy5ZX0FYSVNfUkFOR0UubWF4ICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFJhbmRvbU5vblplcm9JbnRlZ2VyKCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIgKTogbnVtYmVyIHtcclxuICBsZXQgaSA9IFV0aWxzLnJvdW5kU3ltbWV0cmljKCBtaW4gKyAoIGRvdFJhbmRvbS5uZXh0RG91YmxlKCkgKiAoIG1heCAtIG1pbiApICkgKTtcclxuICBpZiAoIGkgPT09IDAgKSB7IGkgPSAxOyB9XHJcbiAgcmV0dXJuIGk7XHJcbn1cclxuXHJcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLy8gRnVuY3Rpb25zIHRoYXQgY3JlYXRlIHNwZWNpZmljIHR5cGVzIG9mIG5vZGVzLlxyXG4vLyBBbGwgb2YgdGhlc2UgZnVuY3Rpb24gbXVzdCBoYXZlIGEge0NvbG9yfFN0cmluZ30gY29sb3IgcGFyYW1ldGVyLlxyXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4vLyBDcmVhdGVzIGEgcmFuZG9tIGVxdWF0aW9uIHdpdGggdGhlIHNwZWNpZmllZCBjb2xvci5cclxuZnVuY3Rpb24gY3JlYXRlRXF1YXRpb25Ob2RlKCBjb2xvcjogQ29sb3IgfCBzdHJpbmcgKTogTm9kZSB7XHJcbiAgbGV0IG5vZGU7XHJcbiAgaWYgKCBkb3RSYW5kb20ubmV4dERvdWJsZSgpIDwgMC41ICkge1xyXG4gICAgbm9kZSA9IFNsb3BlSW50ZXJjZXB0RXF1YXRpb25Ob2RlLmNyZWF0ZUR5bmFtaWNMYWJlbChcclxuICAgICAgbmV3IFByb3BlcnR5KCBMaW5lLmNyZWF0ZVNsb3BlSW50ZXJjZXB0KCBnZXRSYW5kb21ZKCksIGdldFJhbmRvbVgoKSwgZ2V0UmFuZG9tWSgpLCBjb2xvciApICksIHtcclxuICAgICAgICBmb250U2l6ZTogRVFVQVRJT05fRk9OVF9TSVpFXHJcbiAgICAgIH0gKTtcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICBub2RlID0gUG9pbnRTbG9wZUVxdWF0aW9uTm9kZS5jcmVhdGVEeW5hbWljTGFiZWwoXHJcbiAgICAgIG5ldyBQcm9wZXJ0eSggTGluZS5jcmVhdGVQb2ludFNsb3BlKCBnZXRSYW5kb21YKCksIGdldFJhbmRvbVkoKSwgZ2V0UmFuZG9tWCgpLCBnZXRSYW5kb21ZKCksIGNvbG9yICkgKSwge1xyXG4gICAgICAgIGZvbnRTaXplOiBFUVVBVElPTl9GT05UX1NJWkVcclxuICAgICAgfSApO1xyXG4gIH1cclxuICByZXR1cm4gbm9kZTtcclxufVxyXG5cclxuLy8gQ3JlYXRlcyBhIHJhbmRvbSBncmFwaCB3aXRoIHRoZSBzcGVjaWZpZWQgY29sb3IuXHJcbmZ1bmN0aW9uIGNyZWF0ZUdyYXBoTm9kZSggY29sb3I6IENvbG9yIHwgc3RyaW5nICk6IE5vZGUge1xyXG4gIGxldCBub2RlO1xyXG4gIGlmICggZG90UmFuZG9tLm5leHREb3VibGUoKSA8IDAuNSApIHtcclxuICAgIG5vZGUgPSBHTEljb25GYWN0b3J5LmNyZWF0ZUdyYXBoSWNvbiggR1JBUEhfV0lEVEgsIGNvbG9yLCAtMywgLTMsIDMsIDMgKTsgLy8geSA9ICt4XHJcbiAgfVxyXG4gIGVsc2Uge1xyXG4gICAgbm9kZSA9IEdMSWNvbkZhY3RvcnkuY3JlYXRlR3JhcGhJY29uKCBHUkFQSF9XSURUSCwgY29sb3IsIC0zLCAzLCAzLCAtMyApOyAvLyB5ID0gLXhcclxuICB9XHJcbiAgcmV0dXJuIG5vZGU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIGEgcmFuZG9tIHBvaW50IHRvb2wgd2l0aCB0aGUgc3BlY2lmaWVkIGNvbG9yLlxyXG4gKiBUaGlzIGRvZXMgbm90IHVzZSBQb2ludFRvb2xOb2RlIGJlY2F1c2UgaXQgaGFzIHRvbyBtYW55IG1vZGVsIGRlcGVuZGVuY2llcy5cclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZVBvaW50VG9vbE5vZGUoIGNvbG9yOiBDb2xvciB8IHN0cmluZyApOiBOb2RlIHtcclxuICBjb25zdCBjb29yZGluYXRlc1Byb3BlcnR5ID0gbmV3IFZlY3RvcjJQcm9wZXJ0eSggbmV3IFZlY3RvcjIoIGdldFJhbmRvbVgoKSwgZ2V0UmFuZG9tWSgpICkgKTtcclxuICBjb25zdCBib2R5Tm9kZSA9IG5ldyBQb2ludFRvb2xCb2R5Tm9kZSggY29vcmRpbmF0ZXNQcm9wZXJ0eSwge1xyXG4gICAgYmFja2dyb3VuZEZpbGw6IGNvbG9yXHJcbiAgfSApO1xyXG4gIGNvbnN0IHByb2JlTm9kZSA9IG5ldyBQb2ludFRvb2xQcm9iZU5vZGUoIHtcclxuICAgIGNlbnRlclg6IDAuMjUgKiBib2R5Tm9kZS53aWR0aCxcclxuICAgIHRvcDogYm9keU5vZGUuYm90dG9tIC0gMiAvLyBvdmVybGFwXHJcbiAgfSApO1xyXG4gIHJldHVybiBuZXcgTm9kZSggeyBjaGlsZHJlbjogWyBwcm9iZU5vZGUsIGJvZHlOb2RlIF0gfSApO1xyXG59XHJcblxyXG4vLyBDcmVhdGVzIGEgc21pbGV5IGZhY2Ugd2l0aCB0aGUgc3BlY2lmaWVkIGNvbG9yLlxyXG5mdW5jdGlvbiBjcmVhdGVGYWNlTm9kZSggY29sb3I6IENvbG9yIHwgc3RyaW5nICk6IE5vZGUge1xyXG4gIHJldHVybiBuZXcgRmFjZU5vZGUoIEZBQ0VfRElBTUVURVIsIHsgaGVhZEZpbGw6IGNvbG9yIH0gKTtcclxufVxyXG5cclxuLy8gQ3JlYXRlcyBhIHBhcGVyIGFpcnBsYW5lIHdpdGggdGhlIHNwZWNpZmllZCBjb2xvci5cclxuZnVuY3Rpb24gY3JlYXRlUGFwZXJBaXJwbGFuZU5vZGUoIGNvbG9yOiBDb2xvciB8IHN0cmluZyApOiBOb2RlIHtcclxuICByZXR1cm4gbmV3IFBhcGVyQWlycGxhbmVOb2RlKCB7IGZpbGw6IGNvbG9yLCBzY2FsZTogQUlSUExBTkVfU0NBTEUgfSApOyAvLyB3aWR0aCBvZiBhcm91bmQgNjBweFxyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlcyBhbiBhcnJheSBvZiBub2RlcyBmb3IgYSBzcGVjaWZpZWQgYXJyYXkgb2YgY29sb3JzLlxyXG4gKiBUaGUgZnVuY3Rpb25zIGFib3ZlIHNlcnZlIGFzIHRoZSBjcmVhdGlvbkZ1bmN0aW9uIGFyZ3VtZW50LlxyXG4gKi9cclxuZnVuY3Rpb24gY3JlYXRlTm9kZXMoIGNyZWF0aW9uRnVuY3Rpb246ICggY29sb3I6IENvbG9yIHwgc3RyaW5nICkgPT4gTm9kZSwgY29sb3JzOiBBcnJheTxDb2xvciB8IHN0cmluZz4gKTogTm9kZVtdIHtcclxuICByZXR1cm4gY29sb3JzLm1hcCggY29sb3IgPT4gY3JlYXRpb25GdW5jdGlvbiggY29sb3IgKSApO1xyXG59XHJcblxyXG5ncmFwaGluZ0xpbmVzLnJlZ2lzdGVyKCAnR0xSZXdhcmROb2RlJywgR0xSZXdhcmROb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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