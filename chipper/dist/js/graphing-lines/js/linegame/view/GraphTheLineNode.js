// Copyright 2013-2023, University of Colorado Boulder

/**
 * View for 'Graph the Line' challenges.
 * User manipulates a graphed line on the right, equations are displayed on the left.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Property from '../../../../axon/js/Property.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Node, Text } from '../../../../scenery/js/imports.js';
import Line from '../../common/model/Line.js';
import graphingLines from '../../graphingLines.js';
import GraphingLinesStrings from '../../GraphingLinesStrings.js';
import LineGameConstants from '../LineGameConstants.js';
import ManipulationMode from '../model/ManipulationMode.js';
import PlayState from '../model/PlayState.js';
import ChallengeNode from './ChallengeNode.js';
import EquationBoxNode from './EquationBoxNode.js';
import GraphPointSlopeNode from './GraphPointSlopeNode.js';
import GraphSlopeInterceptNode from './GraphSlopeInterceptNode.js';
import GraphTwoPointsNode from './GraphTwoPointsNode.js';
export default class GraphTheLineNode extends ChallengeNode {
  // 'Not A Line', for situations where 3-points do not define a line

  constructor(challenge, model, challengeSize, audioPlayer) {
    super(challenge, model, challengeSize, audioPlayer);
    const boxSize = new Dimension2(0.4 * challengeSize.width, 0.22 * challengeSize.height);

    // title, possibly scaled for i18n
    const titleNode = new Text(challenge.title, {
      font: LineGameConstants.TITLE_FONT,
      fill: LineGameConstants.TITLE_COLOR,
      maxWidth: boxSize.width
    });

    // Answer
    const answerBoxNode = new EquationBoxNode(GraphingLinesStrings.lineToGraph, challenge.answer.color, boxSize, ChallengeNode.createEquationNode(new Property(challenge.answer), challenge.equationForm, {
      fontSize: LineGameConstants.STATIC_EQUATION_FONT_SIZE,
      slopeUndefinedVisible: false
    }));
    const guessLineProperty = new Property(Line.Y_EQUALS_X_LINE); // start with any non-null line
    const guessEquationNode = ChallengeNode.createEquationNode(guessLineProperty, challenge.equationForm, {
      fontSize: LineGameConstants.STATIC_EQUATION_FONT_SIZE,
      // guessEquationNode's default maxWidth is optimized for an equation on the graph, but is not appropriate for
      // an equation in EquationBoxNode, since EquationBoxNode controls the maxWidth of what's put in it.
      // See https://github.com/phetsims/graphing-lines/issues/117
      maxWidth: null
    });
    this.notALineNode = new Text(GraphingLinesStrings.notALine, {
      font: new PhetFont({
        size: 24,
        weight: 'bold'
      }),
      fill: 'black'
    });

    // Either the equation or 'not a line' is displayed.
    const equationNode = new Node({
      children: [guessEquationNode, this.notALineNode]
    });

    // Guess
    const guessBoxNode = new EquationBoxNode(GraphingLinesStrings.yourLine, LineGameConstants.GUESS_COLOR, boxSize, equationNode);
    this.graphNode = this.createGraphNode(challenge);
    this.graphNode.setGuessPointVisible(challenge.manipulationMode === ManipulationMode.SLOPE); // plot the point if we're only manipulating slope

    // rendering order
    this.subtypeParent.addChild(titleNode);
    this.subtypeParent.addChild(this.graphNode);
    this.subtypeParent.addChild(answerBoxNode);
    this.subtypeParent.addChild(guessBoxNode);

    // layout
    {
      // graphNode is positioned automatically based on modelViewTransform's origin offset.

      // left align the title and boxes
      answerBoxNode.centerX = challenge.modelViewTransform.modelToViewX(challenge.graph.xRange.min) / 2; // centered in space to left of graph
      guessBoxNode.left = answerBoxNode.left;
      titleNode.left = answerBoxNode.left;

      // stack title and boxes vertically, title top-aligned with graph's grid
      const ySpacing = 30;
      titleNode.top = challenge.modelViewTransform.modelToViewY(challenge.graph.yRange.max);
      answerBoxNode.top = titleNode.bottom + ySpacing;
      guessBoxNode.top = answerBoxNode.bottom + ySpacing;

      // face centered below boxes, bottom-aligned with buttons
      this.faceNode.centerX = answerBoxNode.centerX;
      this.faceNode.bottom = this.buttonsParent.bottom;
    }

    // Update visibility of the correct/incorrect icons.
    const updateIcons = () => {
      const playState = model.playStateProperty.value;
      answerBoxNode.setCorrectIconVisible(playState === PlayState.NEXT);
      guessBoxNode.setCorrectIconVisible(playState === PlayState.NEXT && challenge.isCorrect());
      guessBoxNode.setIncorrectIconVisible(playState === PlayState.NEXT && !challenge.isCorrect());
    };

    // sync with guess
    const guessObserver = line => {
      const isaLine = line instanceof Line;

      // line is NotAline if ManipulationMode.THREE_POINTS and points don't make a line
      if (isaLine) {
        guessLineProperty.value = line; // updates guessEquationNode
      }

      guessEquationNode.visible = isaLine;
      this.notALineNode.visible = !isaLine;

      // visibility of correct/incorrect icons
      updateIcons();
    };
    challenge.guessProperty.link(guessObserver); // unlink in dispose

    // sync with game state
    const playStateObserver = playState => {
      // No-op if dispose has been called, see https://github.com/phetsims/graphing-lines/issues/133
      if (!this.isDisposed) {
        // states in which the graph is interactive
        this.graphNode.pickable = playState === PlayState.FIRST_CHECK || playState === PlayState.SECOND_CHECK || playState === PlayState.TRY_AGAIN || playState === PlayState.NEXT && !challenge.isCorrect();

        // Graph the answer line at the end of the challenge.
        this.graphNode.setAnswerLineVisible(playState === PlayState.NEXT);
        this.graphNode.setAnswerPointVisible(playState === PlayState.NEXT);
        guessBoxNode.visible = playState === PlayState.NEXT;

        // show stuff when the user got the challenge wrong
        if (playState === PlayState.NEXT && !challenge.isCorrect()) {
          this.graphNode.setGuessPointVisible(true);
          this.graphNode.setSlopeToolVisible(true);
        }

        // visibility of correct/incorrect icons
        updateIcons();
      }
    };
    model.playStateProperty.link(playStateObserver); // unlink in dispose

    this.disposeGraphTheLineNode = () => {
      challenge.guessProperty.unlink(guessObserver);
      model.playStateProperty.unlink(playStateObserver);
      guessEquationNode.dispose();
      this.graphNode.dispose();
    };
  }
  dispose() {
    this.disposeGraphTheLineNode();
    super.dispose();
  }

  /**
   * Creates the graph portion of the view.
   */
  createGraphNode(challenge) {
    if (challenge.manipulationMode === ManipulationMode.POINT || challenge.manipulationMode === ManipulationMode.SLOPE || challenge.manipulationMode === ManipulationMode.POINT_SLOPE) {
      return new GraphPointSlopeNode(challenge);
    } else if (challenge.manipulationMode === ManipulationMode.INTERCEPT || challenge.manipulationMode === ManipulationMode.SLOPE_INTERCEPT) {
      assert && assert(challenge.answer.getYIntercept().isInteger());
      return new GraphSlopeInterceptNode(challenge);
    } else if (challenge.manipulationMode === ManipulationMode.TWO_POINTS) {
      return new GraphTwoPointsNode(challenge);
    } else {
      throw new Error(`unsupported manipulationMode: ${challenge.manipulationMode}`);
    }
  }
}
graphingLines.register('GraphTheLineNode', GraphTheLineNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIkRpbWVuc2lvbjIiLCJQaGV0Rm9udCIsIk5vZGUiLCJUZXh0IiwiTGluZSIsImdyYXBoaW5nTGluZXMiLCJHcmFwaGluZ0xpbmVzU3RyaW5ncyIsIkxpbmVHYW1lQ29uc3RhbnRzIiwiTWFuaXB1bGF0aW9uTW9kZSIsIlBsYXlTdGF0ZSIsIkNoYWxsZW5nZU5vZGUiLCJFcXVhdGlvbkJveE5vZGUiLCJHcmFwaFBvaW50U2xvcGVOb2RlIiwiR3JhcGhTbG9wZUludGVyY2VwdE5vZGUiLCJHcmFwaFR3b1BvaW50c05vZGUiLCJHcmFwaFRoZUxpbmVOb2RlIiwiY29uc3RydWN0b3IiLCJjaGFsbGVuZ2UiLCJtb2RlbCIsImNoYWxsZW5nZVNpemUiLCJhdWRpb1BsYXllciIsImJveFNpemUiLCJ3aWR0aCIsImhlaWdodCIsInRpdGxlTm9kZSIsInRpdGxlIiwiZm9udCIsIlRJVExFX0ZPTlQiLCJmaWxsIiwiVElUTEVfQ09MT1IiLCJtYXhXaWR0aCIsImFuc3dlckJveE5vZGUiLCJsaW5lVG9HcmFwaCIsImFuc3dlciIsImNvbG9yIiwiY3JlYXRlRXF1YXRpb25Ob2RlIiwiZXF1YXRpb25Gb3JtIiwiZm9udFNpemUiLCJTVEFUSUNfRVFVQVRJT05fRk9OVF9TSVpFIiwic2xvcGVVbmRlZmluZWRWaXNpYmxlIiwiZ3Vlc3NMaW5lUHJvcGVydHkiLCJZX0VRVUFMU19YX0xJTkUiLCJndWVzc0VxdWF0aW9uTm9kZSIsIm5vdEFMaW5lTm9kZSIsIm5vdEFMaW5lIiwic2l6ZSIsIndlaWdodCIsImVxdWF0aW9uTm9kZSIsImNoaWxkcmVuIiwiZ3Vlc3NCb3hOb2RlIiwieW91ckxpbmUiLCJHVUVTU19DT0xPUiIsImdyYXBoTm9kZSIsImNyZWF0ZUdyYXBoTm9kZSIsInNldEd1ZXNzUG9pbnRWaXNpYmxlIiwibWFuaXB1bGF0aW9uTW9kZSIsIlNMT1BFIiwic3VidHlwZVBhcmVudCIsImFkZENoaWxkIiwiY2VudGVyWCIsIm1vZGVsVmlld1RyYW5zZm9ybSIsIm1vZGVsVG9WaWV3WCIsImdyYXBoIiwieFJhbmdlIiwibWluIiwibGVmdCIsInlTcGFjaW5nIiwidG9wIiwibW9kZWxUb1ZpZXdZIiwieVJhbmdlIiwibWF4IiwiYm90dG9tIiwiZmFjZU5vZGUiLCJidXR0b25zUGFyZW50IiwidXBkYXRlSWNvbnMiLCJwbGF5U3RhdGUiLCJwbGF5U3RhdGVQcm9wZXJ0eSIsInZhbHVlIiwic2V0Q29ycmVjdEljb25WaXNpYmxlIiwiTkVYVCIsImlzQ29ycmVjdCIsInNldEluY29ycmVjdEljb25WaXNpYmxlIiwiZ3Vlc3NPYnNlcnZlciIsImxpbmUiLCJpc2FMaW5lIiwidmlzaWJsZSIsImd1ZXNzUHJvcGVydHkiLCJsaW5rIiwicGxheVN0YXRlT2JzZXJ2ZXIiLCJpc0Rpc3Bvc2VkIiwicGlja2FibGUiLCJGSVJTVF9DSEVDSyIsIlNFQ09ORF9DSEVDSyIsIlRSWV9BR0FJTiIsInNldEFuc3dlckxpbmVWaXNpYmxlIiwic2V0QW5zd2VyUG9pbnRWaXNpYmxlIiwic2V0U2xvcGVUb29sVmlzaWJsZSIsImRpc3Bvc2VHcmFwaFRoZUxpbmVOb2RlIiwidW5saW5rIiwiZGlzcG9zZSIsIlBPSU5UIiwiUE9JTlRfU0xPUEUiLCJJTlRFUkNFUFQiLCJTTE9QRV9JTlRFUkNFUFQiLCJhc3NlcnQiLCJnZXRZSW50ZXJjZXB0IiwiaXNJbnRlZ2VyIiwiVFdPX1BPSU5UUyIsIkVycm9yIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJHcmFwaFRoZUxpbmVOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDEzLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFZpZXcgZm9yICdHcmFwaCB0aGUgTGluZScgY2hhbGxlbmdlcy5cclxuICogVXNlciBtYW5pcHVsYXRlcyBhIGdyYXBoZWQgbGluZSBvbiB0aGUgcmlnaHQsIGVxdWF0aW9ucyBhcmUgZGlzcGxheWVkIG9uIHRoZSBsZWZ0LlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IERpbWVuc2lvbjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0RpbWVuc2lvbjIuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgTm9kZSwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBMaW5lIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9MaW5lLmpzJztcclxuaW1wb3J0IGdyYXBoaW5nTGluZXMgZnJvbSAnLi4vLi4vZ3JhcGhpbmdMaW5lcy5qcyc7XHJcbmltcG9ydCBHcmFwaGluZ0xpbmVzU3RyaW5ncyBmcm9tICcuLi8uLi9HcmFwaGluZ0xpbmVzU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBMaW5lR2FtZUNvbnN0YW50cyBmcm9tICcuLi9MaW5lR2FtZUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBNYW5pcHVsYXRpb25Nb2RlIGZyb20gJy4uL21vZGVsL01hbmlwdWxhdGlvbk1vZGUuanMnO1xyXG5pbXBvcnQgUGxheVN0YXRlIGZyb20gJy4uL21vZGVsL1BsYXlTdGF0ZS5qcyc7XHJcbmltcG9ydCBDaGFsbGVuZ2VOb2RlIGZyb20gJy4vQ2hhbGxlbmdlTm9kZS5qcyc7XHJcbmltcG9ydCBFcXVhdGlvbkJveE5vZGUgZnJvbSAnLi9FcXVhdGlvbkJveE5vZGUuanMnO1xyXG5pbXBvcnQgR3JhcGhQb2ludFNsb3BlTm9kZSBmcm9tICcuL0dyYXBoUG9pbnRTbG9wZU5vZGUuanMnO1xyXG5pbXBvcnQgR3JhcGhTbG9wZUludGVyY2VwdE5vZGUgZnJvbSAnLi9HcmFwaFNsb3BlSW50ZXJjZXB0Tm9kZS5qcyc7XHJcbmltcG9ydCBHcmFwaFR3b1BvaW50c05vZGUgZnJvbSAnLi9HcmFwaFR3b1BvaW50c05vZGUuanMnO1xyXG5pbXBvcnQgTGluZUdhbWVNb2RlbCBmcm9tICcuLi9tb2RlbC9MaW5lR2FtZU1vZGVsLmpzJztcclxuaW1wb3J0IEdyYXBoVGhlTGluZSBmcm9tICcuLi9tb2RlbC9HcmFwaFRoZUxpbmUuanMnO1xyXG5pbXBvcnQgR2FtZUF1ZGlvUGxheWVyIGZyb20gJy4uLy4uLy4uLy4uL3ZlZ2FzL2pzL0dhbWVBdWRpb1BsYXllci5qcyc7XHJcbmltcG9ydCBDaGFsbGVuZ2VHcmFwaE5vZGUgZnJvbSAnLi9DaGFsbGVuZ2VHcmFwaE5vZGUuanMnO1xyXG5pbXBvcnQgTm90QUxpbmUgZnJvbSAnLi4vbW9kZWwvTm90QUxpbmUuanMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR3JhcGhUaGVMaW5lTm9kZSBleHRlbmRzIENoYWxsZW5nZU5vZGUge1xyXG5cclxuICAvLyAnTm90IEEgTGluZScsIGZvciBzaXR1YXRpb25zIHdoZXJlIDMtcG9pbnRzIGRvIG5vdCBkZWZpbmUgYSBsaW5lXHJcbiAgcHJpdmF0ZSByZWFkb25seSBub3RBTGluZU5vZGU6IE5vZGU7XHJcblxyXG4gIHByb3RlY3RlZCByZWFkb25seSBncmFwaE5vZGU6IENoYWxsZW5nZUdyYXBoTm9kZTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlR3JhcGhUaGVMaW5lTm9kZTogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBjaGFsbGVuZ2U6IEdyYXBoVGhlTGluZSwgbW9kZWw6IExpbmVHYW1lTW9kZWwsIGNoYWxsZW5nZVNpemU6IERpbWVuc2lvbjIsIGF1ZGlvUGxheWVyOiBHYW1lQXVkaW9QbGF5ZXIgKSB7XHJcblxyXG4gICAgc3VwZXIoIGNoYWxsZW5nZSwgbW9kZWwsIGNoYWxsZW5nZVNpemUsIGF1ZGlvUGxheWVyICk7XHJcblxyXG4gICAgY29uc3QgYm94U2l6ZSA9IG5ldyBEaW1lbnNpb24yKCAwLjQgKiBjaGFsbGVuZ2VTaXplLndpZHRoLCAwLjIyICogY2hhbGxlbmdlU2l6ZS5oZWlnaHQgKTtcclxuXHJcbiAgICAvLyB0aXRsZSwgcG9zc2libHkgc2NhbGVkIGZvciBpMThuXHJcbiAgICBjb25zdCB0aXRsZU5vZGUgPSBuZXcgVGV4dCggY2hhbGxlbmdlLnRpdGxlLCB7XHJcbiAgICAgIGZvbnQ6IExpbmVHYW1lQ29uc3RhbnRzLlRJVExFX0ZPTlQsXHJcbiAgICAgIGZpbGw6IExpbmVHYW1lQ29uc3RhbnRzLlRJVExFX0NPTE9SLFxyXG4gICAgICBtYXhXaWR0aDogYm94U2l6ZS53aWR0aFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEFuc3dlclxyXG4gICAgY29uc3QgYW5zd2VyQm94Tm9kZSA9IG5ldyBFcXVhdGlvbkJveE5vZGUoIEdyYXBoaW5nTGluZXNTdHJpbmdzLmxpbmVUb0dyYXBoLCBjaGFsbGVuZ2UuYW5zd2VyLmNvbG9yLCBib3hTaXplLFxyXG4gICAgICBDaGFsbGVuZ2VOb2RlLmNyZWF0ZUVxdWF0aW9uTm9kZSggbmV3IFByb3BlcnR5KCBjaGFsbGVuZ2UuYW5zd2VyICksIGNoYWxsZW5nZS5lcXVhdGlvbkZvcm0sIHtcclxuICAgICAgICBmb250U2l6ZTogTGluZUdhbWVDb25zdGFudHMuU1RBVElDX0VRVUFUSU9OX0ZPTlRfU0laRSxcclxuICAgICAgICBzbG9wZVVuZGVmaW5lZFZpc2libGU6IGZhbHNlXHJcbiAgICAgIH0gKSApO1xyXG5cclxuICAgIGNvbnN0IGd1ZXNzTGluZVByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBMaW5lLllfRVFVQUxTX1hfTElORSApOyAvLyBzdGFydCB3aXRoIGFueSBub24tbnVsbCBsaW5lXHJcbiAgICBjb25zdCBndWVzc0VxdWF0aW9uTm9kZSA9IENoYWxsZW5nZU5vZGUuY3JlYXRlRXF1YXRpb25Ob2RlKCBndWVzc0xpbmVQcm9wZXJ0eSwgY2hhbGxlbmdlLmVxdWF0aW9uRm9ybSwge1xyXG4gICAgICBmb250U2l6ZTogTGluZUdhbWVDb25zdGFudHMuU1RBVElDX0VRVUFUSU9OX0ZPTlRfU0laRSxcclxuXHJcbiAgICAgIC8vIGd1ZXNzRXF1YXRpb25Ob2RlJ3MgZGVmYXVsdCBtYXhXaWR0aCBpcyBvcHRpbWl6ZWQgZm9yIGFuIGVxdWF0aW9uIG9uIHRoZSBncmFwaCwgYnV0IGlzIG5vdCBhcHByb3ByaWF0ZSBmb3JcclxuICAgICAgLy8gYW4gZXF1YXRpb24gaW4gRXF1YXRpb25Cb3hOb2RlLCBzaW5jZSBFcXVhdGlvbkJveE5vZGUgY29udHJvbHMgdGhlIG1heFdpZHRoIG9mIHdoYXQncyBwdXQgaW4gaXQuXHJcbiAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZ3JhcGhpbmctbGluZXMvaXNzdWVzLzExN1xyXG4gICAgICBtYXhXaWR0aDogbnVsbFxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMubm90QUxpbmVOb2RlID0gbmV3IFRleHQoIEdyYXBoaW5nTGluZXNTdHJpbmdzLm5vdEFMaW5lLCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggeyBzaXplOiAyNCwgd2VpZ2h0OiAnYm9sZCcgfSApLFxyXG4gICAgICBmaWxsOiAnYmxhY2snXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gRWl0aGVyIHRoZSBlcXVhdGlvbiBvciAnbm90IGEgbGluZScgaXMgZGlzcGxheWVkLlxyXG4gICAgY29uc3QgZXF1YXRpb25Ob2RlID0gbmV3IE5vZGUoIHsgY2hpbGRyZW46IFsgZ3Vlc3NFcXVhdGlvbk5vZGUsIHRoaXMubm90QUxpbmVOb2RlIF0gfSApO1xyXG5cclxuICAgIC8vIEd1ZXNzXHJcbiAgICBjb25zdCBndWVzc0JveE5vZGUgPSBuZXcgRXF1YXRpb25Cb3hOb2RlKCBHcmFwaGluZ0xpbmVzU3RyaW5ncy55b3VyTGluZSwgTGluZUdhbWVDb25zdGFudHMuR1VFU1NfQ09MT1IsIGJveFNpemUsIGVxdWF0aW9uTm9kZSApO1xyXG5cclxuICAgIHRoaXMuZ3JhcGhOb2RlID0gdGhpcy5jcmVhdGVHcmFwaE5vZGUoIGNoYWxsZW5nZSApO1xyXG4gICAgdGhpcy5ncmFwaE5vZGUuc2V0R3Vlc3NQb2ludFZpc2libGUoIGNoYWxsZW5nZS5tYW5pcHVsYXRpb25Nb2RlID09PSBNYW5pcHVsYXRpb25Nb2RlLlNMT1BFICk7IC8vIHBsb3QgdGhlIHBvaW50IGlmIHdlJ3JlIG9ubHkgbWFuaXB1bGF0aW5nIHNsb3BlXHJcblxyXG4gICAgLy8gcmVuZGVyaW5nIG9yZGVyXHJcbiAgICB0aGlzLnN1YnR5cGVQYXJlbnQuYWRkQ2hpbGQoIHRpdGxlTm9kZSApO1xyXG4gICAgdGhpcy5zdWJ0eXBlUGFyZW50LmFkZENoaWxkKCB0aGlzLmdyYXBoTm9kZSApO1xyXG4gICAgdGhpcy5zdWJ0eXBlUGFyZW50LmFkZENoaWxkKCBhbnN3ZXJCb3hOb2RlICk7XHJcbiAgICB0aGlzLnN1YnR5cGVQYXJlbnQuYWRkQ2hpbGQoIGd1ZXNzQm94Tm9kZSApO1xyXG5cclxuICAgIC8vIGxheW91dFxyXG4gICAge1xyXG4gICAgICAvLyBncmFwaE5vZGUgaXMgcG9zaXRpb25lZCBhdXRvbWF0aWNhbGx5IGJhc2VkIG9uIG1vZGVsVmlld1RyYW5zZm9ybSdzIG9yaWdpbiBvZmZzZXQuXHJcblxyXG4gICAgICAvLyBsZWZ0IGFsaWduIHRoZSB0aXRsZSBhbmQgYm94ZXNcclxuICAgICAgYW5zd2VyQm94Tm9kZS5jZW50ZXJYID0gY2hhbGxlbmdlLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIGNoYWxsZW5nZS5ncmFwaC54UmFuZ2UubWluICkgLyAyOyAvLyBjZW50ZXJlZCBpbiBzcGFjZSB0byBsZWZ0IG9mIGdyYXBoXHJcbiAgICAgIGd1ZXNzQm94Tm9kZS5sZWZ0ID0gYW5zd2VyQm94Tm9kZS5sZWZ0O1xyXG4gICAgICB0aXRsZU5vZGUubGVmdCA9IGFuc3dlckJveE5vZGUubGVmdDtcclxuXHJcbiAgICAgIC8vIHN0YWNrIHRpdGxlIGFuZCBib3hlcyB2ZXJ0aWNhbGx5LCB0aXRsZSB0b3AtYWxpZ25lZCB3aXRoIGdyYXBoJ3MgZ3JpZFxyXG4gICAgICBjb25zdCB5U3BhY2luZyA9IDMwO1xyXG4gICAgICB0aXRsZU5vZGUudG9wID0gY2hhbGxlbmdlLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1koIGNoYWxsZW5nZS5ncmFwaC55UmFuZ2UubWF4ICk7XHJcbiAgICAgIGFuc3dlckJveE5vZGUudG9wID0gdGl0bGVOb2RlLmJvdHRvbSArIHlTcGFjaW5nO1xyXG4gICAgICBndWVzc0JveE5vZGUudG9wID0gYW5zd2VyQm94Tm9kZS5ib3R0b20gKyB5U3BhY2luZztcclxuXHJcbiAgICAgIC8vIGZhY2UgY2VudGVyZWQgYmVsb3cgYm94ZXMsIGJvdHRvbS1hbGlnbmVkIHdpdGggYnV0dG9uc1xyXG4gICAgICB0aGlzLmZhY2VOb2RlLmNlbnRlclggPSBhbnN3ZXJCb3hOb2RlLmNlbnRlclg7XHJcbiAgICAgIHRoaXMuZmFjZU5vZGUuYm90dG9tID0gdGhpcy5idXR0b25zUGFyZW50LmJvdHRvbTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVcGRhdGUgdmlzaWJpbGl0eSBvZiB0aGUgY29ycmVjdC9pbmNvcnJlY3QgaWNvbnMuXHJcbiAgICBjb25zdCB1cGRhdGVJY29ucyA9ICgpID0+IHtcclxuICAgICAgY29uc3QgcGxheVN0YXRlID0gbW9kZWwucGxheVN0YXRlUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIGFuc3dlckJveE5vZGUuc2V0Q29ycmVjdEljb25WaXNpYmxlKCBwbGF5U3RhdGUgPT09IFBsYXlTdGF0ZS5ORVhUICk7XHJcbiAgICAgIGd1ZXNzQm94Tm9kZS5zZXRDb3JyZWN0SWNvblZpc2libGUoIHBsYXlTdGF0ZSA9PT0gUGxheVN0YXRlLk5FWFQgJiYgY2hhbGxlbmdlLmlzQ29ycmVjdCgpICk7XHJcbiAgICAgIGd1ZXNzQm94Tm9kZS5zZXRJbmNvcnJlY3RJY29uVmlzaWJsZSggcGxheVN0YXRlID09PSBQbGF5U3RhdGUuTkVYVCAmJiAhY2hhbGxlbmdlLmlzQ29ycmVjdCgpICk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIHN5bmMgd2l0aCBndWVzc1xyXG4gICAgY29uc3QgZ3Vlc3NPYnNlcnZlciA9ICggbGluZTogTGluZSB8IE5vdEFMaW5lICkgPT4ge1xyXG5cclxuICAgICAgY29uc3QgaXNhTGluZSA9ICggbGluZSBpbnN0YW5jZW9mIExpbmUgKTtcclxuXHJcbiAgICAgIC8vIGxpbmUgaXMgTm90QWxpbmUgaWYgTWFuaXB1bGF0aW9uTW9kZS5USFJFRV9QT0lOVFMgYW5kIHBvaW50cyBkb24ndCBtYWtlIGEgbGluZVxyXG4gICAgICBpZiAoIGlzYUxpbmUgKSB7XHJcbiAgICAgICAgZ3Vlc3NMaW5lUHJvcGVydHkudmFsdWUgPSBsaW5lOyAvLyB1cGRhdGVzIGd1ZXNzRXF1YXRpb25Ob2RlXHJcbiAgICAgIH1cclxuICAgICAgZ3Vlc3NFcXVhdGlvbk5vZGUudmlzaWJsZSA9IGlzYUxpbmU7XHJcbiAgICAgIHRoaXMubm90QUxpbmVOb2RlLnZpc2libGUgPSAhaXNhTGluZTtcclxuXHJcbiAgICAgIC8vIHZpc2liaWxpdHkgb2YgY29ycmVjdC9pbmNvcnJlY3QgaWNvbnNcclxuICAgICAgdXBkYXRlSWNvbnMoKTtcclxuICAgIH07XHJcbiAgICBjaGFsbGVuZ2UuZ3Vlc3NQcm9wZXJ0eS5saW5rKCBndWVzc09ic2VydmVyICk7IC8vIHVubGluayBpbiBkaXNwb3NlXHJcblxyXG4gICAgLy8gc3luYyB3aXRoIGdhbWUgc3RhdGVcclxuICAgIGNvbnN0IHBsYXlTdGF0ZU9ic2VydmVyID0gKCBwbGF5U3RhdGU6IFBsYXlTdGF0ZSApID0+IHtcclxuXHJcbiAgICAgIC8vIE5vLW9wIGlmIGRpc3Bvc2UgaGFzIGJlZW4gY2FsbGVkLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2dyYXBoaW5nLWxpbmVzL2lzc3Vlcy8xMzNcclxuICAgICAgaWYgKCAhdGhpcy5pc0Rpc3Bvc2VkICkge1xyXG5cclxuICAgICAgICAvLyBzdGF0ZXMgaW4gd2hpY2ggdGhlIGdyYXBoIGlzIGludGVyYWN0aXZlXHJcbiAgICAgICAgdGhpcy5ncmFwaE5vZGUucGlja2FibGUgPSAoXHJcbiAgICAgICAgICBwbGF5U3RhdGUgPT09IFBsYXlTdGF0ZS5GSVJTVF9DSEVDSyB8fFxyXG4gICAgICAgICAgcGxheVN0YXRlID09PSBQbGF5U3RhdGUuU0VDT05EX0NIRUNLIHx8XHJcbiAgICAgICAgICBwbGF5U3RhdGUgPT09IFBsYXlTdGF0ZS5UUllfQUdBSU4gfHxcclxuICAgICAgICAgICggcGxheVN0YXRlID09PSBQbGF5U3RhdGUuTkVYVCAmJiAhY2hhbGxlbmdlLmlzQ29ycmVjdCgpIClcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICAvLyBHcmFwaCB0aGUgYW5zd2VyIGxpbmUgYXQgdGhlIGVuZCBvZiB0aGUgY2hhbGxlbmdlLlxyXG4gICAgICAgIHRoaXMuZ3JhcGhOb2RlLnNldEFuc3dlckxpbmVWaXNpYmxlKCBwbGF5U3RhdGUgPT09IFBsYXlTdGF0ZS5ORVhUICk7XHJcbiAgICAgICAgdGhpcy5ncmFwaE5vZGUuc2V0QW5zd2VyUG9pbnRWaXNpYmxlKCBwbGF5U3RhdGUgPT09IFBsYXlTdGF0ZS5ORVhUICk7XHJcblxyXG4gICAgICAgIGd1ZXNzQm94Tm9kZS52aXNpYmxlID0gKCBwbGF5U3RhdGUgPT09IFBsYXlTdGF0ZS5ORVhUICk7XHJcblxyXG4gICAgICAgIC8vIHNob3cgc3R1ZmYgd2hlbiB0aGUgdXNlciBnb3QgdGhlIGNoYWxsZW5nZSB3cm9uZ1xyXG4gICAgICAgIGlmICggcGxheVN0YXRlID09PSBQbGF5U3RhdGUuTkVYVCAmJiAhY2hhbGxlbmdlLmlzQ29ycmVjdCgpICkge1xyXG4gICAgICAgICAgdGhpcy5ncmFwaE5vZGUuc2V0R3Vlc3NQb2ludFZpc2libGUoIHRydWUgKTtcclxuICAgICAgICAgIHRoaXMuZ3JhcGhOb2RlLnNldFNsb3BlVG9vbFZpc2libGUoIHRydWUgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHZpc2liaWxpdHkgb2YgY29ycmVjdC9pbmNvcnJlY3QgaWNvbnNcclxuICAgICAgICB1cGRhdGVJY29ucygpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgbW9kZWwucGxheVN0YXRlUHJvcGVydHkubGluayggcGxheVN0YXRlT2JzZXJ2ZXIgKTsgLy8gdW5saW5rIGluIGRpc3Bvc2VcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VHcmFwaFRoZUxpbmVOb2RlID0gKCkgPT4ge1xyXG4gICAgICBjaGFsbGVuZ2UuZ3Vlc3NQcm9wZXJ0eS51bmxpbmsoIGd1ZXNzT2JzZXJ2ZXIgKTtcclxuICAgICAgbW9kZWwucGxheVN0YXRlUHJvcGVydHkudW5saW5rKCBwbGF5U3RhdGVPYnNlcnZlciApO1xyXG4gICAgICBndWVzc0VxdWF0aW9uTm9kZS5kaXNwb3NlKCk7XHJcbiAgICAgIHRoaXMuZ3JhcGhOb2RlLmRpc3Bvc2UoKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZUdyYXBoVGhlTGluZU5vZGUoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgdGhlIGdyYXBoIHBvcnRpb24gb2YgdGhlIHZpZXcuXHJcbiAgICovXHJcbiAgcHVibGljIGNyZWF0ZUdyYXBoTm9kZSggY2hhbGxlbmdlOiBHcmFwaFRoZUxpbmUgKTogQ2hhbGxlbmdlR3JhcGhOb2RlIHtcclxuICAgIGlmICggY2hhbGxlbmdlLm1hbmlwdWxhdGlvbk1vZGUgPT09IE1hbmlwdWxhdGlvbk1vZGUuUE9JTlQgfHwgY2hhbGxlbmdlLm1hbmlwdWxhdGlvbk1vZGUgPT09IE1hbmlwdWxhdGlvbk1vZGUuU0xPUEUgfHwgY2hhbGxlbmdlLm1hbmlwdWxhdGlvbk1vZGUgPT09IE1hbmlwdWxhdGlvbk1vZGUuUE9JTlRfU0xPUEUgKSB7XHJcbiAgICAgIHJldHVybiBuZXcgR3JhcGhQb2ludFNsb3BlTm9kZSggY2hhbGxlbmdlICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggY2hhbGxlbmdlLm1hbmlwdWxhdGlvbk1vZGUgPT09IE1hbmlwdWxhdGlvbk1vZGUuSU5URVJDRVBUIHx8IGNoYWxsZW5nZS5tYW5pcHVsYXRpb25Nb2RlID09PSBNYW5pcHVsYXRpb25Nb2RlLlNMT1BFX0lOVEVSQ0VQVCApIHtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggY2hhbGxlbmdlLmFuc3dlci5nZXRZSW50ZXJjZXB0KCkuaXNJbnRlZ2VyKCkgKTtcclxuICAgICAgcmV0dXJuIG5ldyBHcmFwaFNsb3BlSW50ZXJjZXB0Tm9kZSggY2hhbGxlbmdlICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggY2hhbGxlbmdlLm1hbmlwdWxhdGlvbk1vZGUgPT09IE1hbmlwdWxhdGlvbk1vZGUuVFdPX1BPSU5UUyApIHtcclxuICAgICAgcmV0dXJuIG5ldyBHcmFwaFR3b1BvaW50c05vZGUoIGNoYWxsZW5nZSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvciggYHVuc3VwcG9ydGVkIG1hbmlwdWxhdGlvbk1vZGU6ICR7Y2hhbGxlbmdlLm1hbmlwdWxhdGlvbk1vZGV9YCApO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZ3JhcGhpbmdMaW5lcy5yZWdpc3RlciggJ0dyYXBoVGhlTGluZU5vZGUnLCBHcmFwaFRoZUxpbmVOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxVQUFVLE1BQU0sa0NBQWtDO0FBQ3pELE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsU0FBU0MsSUFBSSxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQzlELE9BQU9DLElBQUksTUFBTSw0QkFBNEI7QUFDN0MsT0FBT0MsYUFBYSxNQUFNLHdCQUF3QjtBQUNs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