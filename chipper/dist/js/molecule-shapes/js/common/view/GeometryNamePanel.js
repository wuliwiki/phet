// Copyright 2014-2023, University of Colorado Boulder

/**
 * Shows the molecular and electron geometry names, and has checkboxes which allow toggling their visibility
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Multilink from '../../../../axon/js/Multilink.js';
import merge from '../../../../phet-core/js/merge.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { GridBox, Node, Text } from '../../../../scenery/js/imports.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import moleculeShapes from '../../moleculeShapes.js';
import MoleculeShapesStrings from '../../MoleculeShapesStrings.js';
import MoleculeShapesCheckbox from './MoleculeShapesCheckbox.js';
import MoleculeShapesColors from './MoleculeShapesColors.js';
import MoleculeShapesPanel from './MoleculeShapesPanel.js';
import { emptyElectronGeometryStringProperty } from '../model/ElectronGeometry.js';
import { emptyMoleculeGeometryStringProperty } from '../model/MoleculeGeometry.js';

// string list needed to compute maximum label bounds
const electronGeometryStringProperties = [emptyElectronGeometryStringProperty, MoleculeShapesStrings.geometry.diatomicStringProperty, MoleculeShapesStrings.geometry.linearStringProperty, MoleculeShapesStrings.geometry.trigonalPlanarStringProperty, MoleculeShapesStrings.geometry.tetrahedralStringProperty, MoleculeShapesStrings.geometry.trigonalBipyramidalStringProperty, MoleculeShapesStrings.geometry.octahedralStringProperty];

// string list needed to compute maximum label bounds
const moleculeGeometryStringProperties = [emptyMoleculeGeometryStringProperty, MoleculeShapesStrings.shape.diatomicStringProperty, MoleculeShapesStrings.shape.linearStringProperty, MoleculeShapesStrings.shape.bentStringProperty, MoleculeShapesStrings.shape.trigonalPlanarStringProperty, MoleculeShapesStrings.shape.trigonalPyramidalStringProperty, MoleculeShapesStrings.shape.tShapedStringProperty, MoleculeShapesStrings.shape.tetrahedralStringProperty, MoleculeShapesStrings.shape.seesawStringProperty, MoleculeShapesStrings.shape.squarePlanarStringProperty, MoleculeShapesStrings.shape.trigonalBipyramidalStringProperty, MoleculeShapesStrings.shape.squarePyramidalStringProperty, MoleculeShapesStrings.shape.octahedralStringProperty];
const geometryNameFont = new PhetFont(16);
const MAX_INDIVIDUAL_WIDTH = 420;
function getMaximumTextWidth(stringProperties) {
  return new DerivedProperty(stringProperties, (...strings) => {
    return Math.min(MAX_INDIVIDUAL_WIDTH, Math.max(...strings.map(string => {
      return new Text(string, {
        font: geometryNameFont
      }).width;
    })));
  });
}
const maxElectronGeometryWidthProperty = getMaximumTextWidth(electronGeometryStringProperties);
const maxMoleculeGeometryWidthProperty = getMaximumTextWidth(moleculeGeometryStringProperties);
class GeometryNamePanel extends MoleculeShapesPanel {
  /**
   * @param {MoleculeShapesModel} model
   * @param {Tandem} tandem
   * @param {Object} [options]
   */
  constructor(model, tandem, options) {
    options = merge({
      fill: MoleculeShapesColors.backgroundProperty,
      tandem: tandem
    }, options);
    const content = new GridBox({
      xSpacing: 20,
      ySpacing: 10
    });
    super(MoleculeShapesStrings.control.geometryNameStringProperty, content, tandem);

    // @private {MoleculeShapesModel}
    this.model = model;

    // labels for the types of geometries
    const textLabelFont = new PhetFont(14);

    // @private {MoleculeShapesCheckbox}
    const moleculeGeometryCheckboxTandem = tandem.createTandem('moleculeGeometryCheckbox');
    this.moleculeGeometryCheckbox = new MoleculeShapesCheckbox(model.showMoleculeGeometryProperty, new Text(MoleculeShapesStrings.control.moleculeGeometryStringProperty, {
      font: textLabelFont,
      fill: MoleculeShapesColors.moleculeGeometryNameProperty,
      tandem: moleculeGeometryCheckboxTandem.createTandem('labelText')
    }), {
      tandem: moleculeGeometryCheckboxTandem,
      layoutOptions: {
        column: 1,
        row: 0
      }
    });
    const electronGeometryCheckboxTandem = model.isBasicsVersion ? Tandem.OPT_OUT : tandem.createTandem('electronGeometryCheckbox');
    this.electronGeometryCheckbox = new MoleculeShapesCheckbox(model.showElectronGeometryProperty, new Text(MoleculeShapesStrings.control.electronGeometryStringProperty, {
      font: textLabelFont,
      fill: MoleculeShapesColors.electronGeometryNameProperty,
      tandem: electronGeometryCheckboxTandem.createTandem('labelText')
    }), {
      tandem: electronGeometryCheckboxTandem,
      layoutOptions: {
        column: 0,
        row: 0
      }
    });

    // @private {Text} - text fields that will show the name of the geometry (uses string placeholders for height)
    this.moleculeText = new Text('X', {
      visibleProperty: model.showMoleculeGeometryProperty,
      font: geometryNameFont,
      pickable: false,
      fill: MoleculeShapesColors.moleculeGeometryNameProperty,
      maxWidth: MAX_INDIVIDUAL_WIDTH
    });
    // @private {Text}
    this.electronText = new Text('Y', {
      visibleProperty: model.showElectronGeometryProperty,
      font: geometryNameFont,
      pickable: false,
      fill: MoleculeShapesColors.electronGeometryNameProperty,
      maxWidth: MAX_INDIVIDUAL_WIDTH
    });
    const moleculeTextContainer = new Node({
      // Hide this container only when the checkbox is hidden
      visibleProperty: this.moleculeGeometryCheckbox.visibleProperty,
      children: [this.moleculeText],
      layoutOptions: {
        column: 1,
        row: 1,
        minContentHeight: this.moleculeText.height
      }
    });
    maxMoleculeGeometryWidthProperty.link(maxMoleculeGeometryWidth => {
      moleculeTextContainer.mutateLayoutOptions({
        minContentWidth: maxMoleculeGeometryWidth
      });
    });

    // TODO: pointer area listeners

    content.addChild(this.moleculeGeometryCheckbox);
    content.addChild(moleculeTextContainer);
    Multilink.multilink([this.moleculeGeometryCheckbox.boundsProperty, moleculeTextContainer.boundsProperty, content.boundsProperty], () => {
      let bounds = this.moleculeGeometryCheckbox.localBounds.union(this.moleculeGeometryCheckbox.boundsOf(moleculeTextContainer));
      if (bounds.width < maxMoleculeGeometryWidthProperty.value) {
        bounds = bounds.dilatedX((maxMoleculeGeometryWidthProperty.value - bounds.width) / 2);
      }
      bounds = bounds.dilated(10);
      this.moleculeGeometryCheckbox.touchArea = this.moleculeGeometryCheckbox.mouseArea = bounds;
    });
    if (!model.isBasicsVersion) {
      const electronTextContainer = new Node({
        // Hide this container only when the checkbox is hidden
        visibleProperty: this.electronGeometryCheckbox.visibleProperty,
        children: [this.electronText],
        layoutOptions: {
          column: 0,
          row: 1,
          minContentHeight: this.electronText.height
        }
      });
      maxElectronGeometryWidthProperty.link(maxElectronGeometryWidth => {
        electronTextContainer.mutateLayoutOptions({
          minContentWidth: maxElectronGeometryWidth
        });
      });

      // basics version excludes lone-pair (electron) geometries
      content.addChild(this.electronGeometryCheckbox);
      content.addChild(electronTextContainer);
      Multilink.multilink([this.electronGeometryCheckbox.boundsProperty, electronTextContainer.boundsProperty, content.boundsProperty], () => {
        let bounds = this.electronGeometryCheckbox.localBounds.union(this.electronGeometryCheckbox.boundsOf(electronTextContainer));
        if (bounds.width < maxElectronGeometryWidthProperty.value) {
          bounds = bounds.dilatedX((maxElectronGeometryWidthProperty.value - bounds.width) / 2);
        }
        bounds = bounds.dilated(10);
        this.electronGeometryCheckbox.touchArea = this.electronGeometryCheckbox.mouseArea = bounds;
      });
    }
    const updateNames = this.updateNames.bind(this);
    model.moleculeProperty.link((newMolecule, oldMolecule) => {
      if (oldMolecule) {
        oldMolecule.bondChangedEmitter.removeListener(updateNames);
      }
      if (newMolecule) {
        newMolecule.bondChangedEmitter.addListener(updateNames);
      }
      updateNames();
    });
    this.mutate(options);
  }

  /**
   * @private
   */
  updateNames() {
    this.moleculeText.stringProperty = this.getMoleculeGeometryName();
    this.electronText.stringProperty = this.getElectronGeometryName();

    // layout
    this.moleculeText.centerX = this.moleculeGeometryCheckbox.centerX;
    this.electronText.centerX = this.electronGeometryCheckbox.centerX;
  }

  /**
   * @private
   */
  getMoleculeGeometryName() {
    const nameProperty = this.model.moleculeProperty.value.getCentralVSEPRConfiguration().moleculeGeometry.stringProperty;
    if (nameProperty === null) {
      return emptyMoleculeGeometryStringProperty;
    } else {
      return nameProperty;
    }
  }

  /**
   * @private
   */
  getElectronGeometryName() {
    const nameProperty = this.model.moleculeProperty.value.getCentralVSEPRConfiguration().electronGeometry.stringProperty;
    if (nameProperty === null) {
      return emptyElectronGeometryStringProperty;
    } else {
      return nameProperty;
    }
  }
}
moleculeShapes.register('GeometryNamePanel', GeometryNamePanel);
export default GeometryNamePanel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJNdWx0aWxpbmsiLCJtZXJnZSIsIlBoZXRGb250IiwiR3JpZEJveCIsIk5vZGUiLCJUZXh0IiwiVGFuZGVtIiwibW9sZWN1bGVTaGFwZXMiLCJNb2xlY3VsZVNoYXBlc1N0cmluZ3MiLCJNb2xlY3VsZVNoYXBlc0NoZWNrYm94IiwiTW9sZWN1bGVTaGFwZXNDb2xvcnMiLCJNb2xlY3VsZVNoYXBlc1BhbmVsIiwiZW1wdHlFbGVjdHJvbkdlb21ldHJ5U3RyaW5nUHJvcGVydHkiLCJlbXB0eU1vbGVjdWxlR2VvbWV0cnlTdHJpbmdQcm9wZXJ0eSIsImVsZWN0cm9uR2VvbWV0cnlTdHJpbmdQcm9wZXJ0aWVzIiwiZ2VvbWV0cnkiLCJkaWF0b21pY1N0cmluZ1Byb3BlcnR5IiwibGluZWFyU3RyaW5nUHJvcGVydHkiLCJ0cmlnb25hbFBsYW5hclN0cmluZ1Byb3BlcnR5IiwidGV0cmFoZWRyYWxTdHJpbmdQcm9wZXJ0eSIsInRyaWdvbmFsQmlweXJhbWlkYWxTdHJpbmdQcm9wZXJ0eSIsIm9jdGFoZWRyYWxTdHJpbmdQcm9wZXJ0eSIsIm1vbGVjdWxlR2VvbWV0cnlTdHJpbmdQcm9wZXJ0aWVzIiwic2hhcGUiLCJiZW50U3RyaW5nUHJvcGVydHkiLCJ0cmlnb25hbFB5cmFtaWRhbFN0cmluZ1Byb3BlcnR5IiwidFNoYXBlZFN0cmluZ1Byb3BlcnR5Iiwic2Vlc2F3U3RyaW5nUHJvcGVydHkiLCJzcXVhcmVQbGFuYXJTdHJpbmdQcm9wZXJ0eSIsInNxdWFyZVB5cmFtaWRhbFN0cmluZ1Byb3BlcnR5IiwiZ2VvbWV0cnlOYW1lRm9udCIsIk1BWF9JTkRJVklEVUFMX1dJRFRIIiwiZ2V0TWF4aW11bVRleHRXaWR0aCIsInN0cmluZ1Byb3BlcnRpZXMiLCJzdHJpbmdzIiwiTWF0aCIsIm1pbiIsIm1heCIsIm1hcCIsInN0cmluZyIsImZvbnQiLCJ3aWR0aCIsIm1heEVsZWN0cm9uR2VvbWV0cnlXaWR0aFByb3BlcnR5IiwibWF4TW9sZWN1bGVHZW9tZXRyeVdpZHRoUHJvcGVydHkiLCJHZW9tZXRyeU5hbWVQYW5lbCIsImNvbnN0cnVjdG9yIiwibW9kZWwiLCJ0YW5kZW0iLCJvcHRpb25zIiwiZmlsbCIsImJhY2tncm91bmRQcm9wZXJ0eSIsImNvbnRlbnQiLCJ4U3BhY2luZyIsInlTcGFjaW5nIiwiY29udHJvbCIsImdlb21ldHJ5TmFtZVN0cmluZ1Byb3BlcnR5IiwidGV4dExhYmVsRm9udCIsIm1vbGVjdWxlR2VvbWV0cnlDaGVja2JveFRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsIm1vbGVjdWxlR2VvbWV0cnlDaGVja2JveCIsInNob3dNb2xlY3VsZUdlb21ldHJ5UHJvcGVydHkiLCJtb2xlY3VsZUdlb21ldHJ5U3RyaW5nUHJvcGVydHkiLCJtb2xlY3VsZUdlb21ldHJ5TmFtZVByb3BlcnR5IiwibGF5b3V0T3B0aW9ucyIsImNvbHVtbiIsInJvdyIsImVsZWN0cm9uR2VvbWV0cnlDaGVja2JveFRhbmRlbSIsImlzQmFzaWNzVmVyc2lvbiIsIk9QVF9PVVQiLCJlbGVjdHJvbkdlb21ldHJ5Q2hlY2tib3giLCJzaG93RWxlY3Ryb25HZW9tZXRyeVByb3BlcnR5IiwiZWxlY3Ryb25HZW9tZXRyeVN0cmluZ1Byb3BlcnR5IiwiZWxlY3Ryb25HZW9tZXRyeU5hbWVQcm9wZXJ0eSIsIm1vbGVjdWxlVGV4dCIsInZpc2libGVQcm9wZXJ0eSIsInBpY2thYmxlIiwibWF4V2lkdGgiLCJlbGVjdHJvblRleHQiLCJtb2xlY3VsZVRleHRDb250YWluZXIiLCJjaGlsZHJlbiIsIm1pbkNvbnRlbnRIZWlnaHQiLCJoZWlnaHQiLCJsaW5rIiwibWF4TW9sZWN1bGVHZW9tZXRyeVdpZHRoIiwibXV0YXRlTGF5b3V0T3B0aW9ucyIsIm1pbkNvbnRlbnRXaWR0aCIsImFkZENoaWxkIiwibXVsdGlsaW5rIiwiYm91bmRzUHJvcGVydHkiLCJib3VuZHMiLCJsb2NhbEJvdW5kcyIsInVuaW9uIiwiYm91bmRzT2YiLCJ2YWx1ZSIsImRpbGF0ZWRYIiwiZGlsYXRlZCIsInRvdWNoQXJlYSIsIm1vdXNlQXJlYSIsImVsZWN0cm9uVGV4dENvbnRhaW5lciIsIm1heEVsZWN0cm9uR2VvbWV0cnlXaWR0aCIsInVwZGF0ZU5hbWVzIiwiYmluZCIsIm1vbGVjdWxlUHJvcGVydHkiLCJuZXdNb2xlY3VsZSIsIm9sZE1vbGVjdWxlIiwiYm9uZENoYW5nZWRFbWl0dGVyIiwicmVtb3ZlTGlzdGVuZXIiLCJhZGRMaXN0ZW5lciIsIm11dGF0ZSIsInN0cmluZ1Byb3BlcnR5IiwiZ2V0TW9sZWN1bGVHZW9tZXRyeU5hbWUiLCJnZXRFbGVjdHJvbkdlb21ldHJ5TmFtZSIsImNlbnRlclgiLCJuYW1lUHJvcGVydHkiLCJnZXRDZW50cmFsVlNFUFJDb25maWd1cmF0aW9uIiwibW9sZWN1bGVHZW9tZXRyeSIsImVsZWN0cm9uR2VvbWV0cnkiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkdlb21ldHJ5TmFtZVBhbmVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFNob3dzIHRoZSBtb2xlY3VsYXIgYW5kIGVsZWN0cm9uIGdlb21ldHJ5IG5hbWVzLCBhbmQgaGFzIGNoZWNrYm94ZXMgd2hpY2ggYWxsb3cgdG9nZ2xpbmcgdGhlaXIgdmlzaWJpbGl0eVxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvbmF0aGFuIE9sc29uIDxqb25hdGhhbi5vbHNvbkBjb2xvcmFkby5lZHU+XHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IEdyaWRCb3gsIE5vZGUsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgbW9sZWN1bGVTaGFwZXMgZnJvbSAnLi4vLi4vbW9sZWN1bGVTaGFwZXMuanMnO1xyXG5pbXBvcnQgTW9sZWN1bGVTaGFwZXNTdHJpbmdzIGZyb20gJy4uLy4uL01vbGVjdWxlU2hhcGVzU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBNb2xlY3VsZVNoYXBlc0NoZWNrYm94IGZyb20gJy4vTW9sZWN1bGVTaGFwZXNDaGVja2JveC5qcyc7XHJcbmltcG9ydCBNb2xlY3VsZVNoYXBlc0NvbG9ycyBmcm9tICcuL01vbGVjdWxlU2hhcGVzQ29sb3JzLmpzJztcclxuaW1wb3J0IE1vbGVjdWxlU2hhcGVzUGFuZWwgZnJvbSAnLi9Nb2xlY3VsZVNoYXBlc1BhbmVsLmpzJztcclxuaW1wb3J0IHsgZW1wdHlFbGVjdHJvbkdlb21ldHJ5U3RyaW5nUHJvcGVydHkgfSBmcm9tICcuLi9tb2RlbC9FbGVjdHJvbkdlb21ldHJ5LmpzJztcclxuaW1wb3J0IHsgZW1wdHlNb2xlY3VsZUdlb21ldHJ5U3RyaW5nUHJvcGVydHkgfSBmcm9tICcuLi9tb2RlbC9Nb2xlY3VsZUdlb21ldHJ5LmpzJztcclxuXHJcbi8vIHN0cmluZyBsaXN0IG5lZWRlZCB0byBjb21wdXRlIG1heGltdW0gbGFiZWwgYm91bmRzXHJcbmNvbnN0IGVsZWN0cm9uR2VvbWV0cnlTdHJpbmdQcm9wZXJ0aWVzID0gW1xyXG4gIGVtcHR5RWxlY3Ryb25HZW9tZXRyeVN0cmluZ1Byb3BlcnR5LFxyXG4gIE1vbGVjdWxlU2hhcGVzU3RyaW5ncy5nZW9tZXRyeS5kaWF0b21pY1N0cmluZ1Byb3BlcnR5LFxyXG4gIE1vbGVjdWxlU2hhcGVzU3RyaW5ncy5nZW9tZXRyeS5saW5lYXJTdHJpbmdQcm9wZXJ0eSxcclxuICBNb2xlY3VsZVNoYXBlc1N0cmluZ3MuZ2VvbWV0cnkudHJpZ29uYWxQbGFuYXJTdHJpbmdQcm9wZXJ0eSxcclxuICBNb2xlY3VsZVNoYXBlc1N0cmluZ3MuZ2VvbWV0cnkudGV0cmFoZWRyYWxTdHJpbmdQcm9wZXJ0eSxcclxuICBNb2xlY3VsZVNoYXBlc1N0cmluZ3MuZ2VvbWV0cnkudHJpZ29uYWxCaXB5cmFtaWRhbFN0cmluZ1Byb3BlcnR5LFxyXG4gIE1vbGVjdWxlU2hhcGVzU3RyaW5ncy5nZW9tZXRyeS5vY3RhaGVkcmFsU3RyaW5nUHJvcGVydHlcclxuXTtcclxuXHJcbi8vIHN0cmluZyBsaXN0IG5lZWRlZCB0byBjb21wdXRlIG1heGltdW0gbGFiZWwgYm91bmRzXHJcbmNvbnN0IG1vbGVjdWxlR2VvbWV0cnlTdHJpbmdQcm9wZXJ0aWVzID0gW1xyXG4gIGVtcHR5TW9sZWN1bGVHZW9tZXRyeVN0cmluZ1Byb3BlcnR5LFxyXG4gIE1vbGVjdWxlU2hhcGVzU3RyaW5ncy5zaGFwZS5kaWF0b21pY1N0cmluZ1Byb3BlcnR5LFxyXG4gIE1vbGVjdWxlU2hhcGVzU3RyaW5ncy5zaGFwZS5saW5lYXJTdHJpbmdQcm9wZXJ0eSxcclxuICBNb2xlY3VsZVNoYXBlc1N0cmluZ3Muc2hhcGUuYmVudFN0cmluZ1Byb3BlcnR5LFxyXG4gIE1vbGVjdWxlU2hhcGVzU3RyaW5ncy5zaGFwZS50cmlnb25hbFBsYW5hclN0cmluZ1Byb3BlcnR5LFxyXG4gIE1vbGVjdWxlU2hhcGVzU3RyaW5ncy5zaGFwZS50cmlnb25hbFB5cmFtaWRhbFN0cmluZ1Byb3BlcnR5LFxyXG4gIE1vbGVjdWxlU2hhcGVzU3RyaW5ncy5zaGFwZS50U2hhcGVkU3RyaW5nUHJvcGVydHksXHJcbiAgTW9sZWN1bGVTaGFwZXNTdHJpbmdzLnNoYXBlLnRldHJhaGVkcmFsU3RyaW5nUHJvcGVydHksXHJcbiAgTW9sZWN1bGVTaGFwZXNTdHJpbmdzLnNoYXBlLnNlZXNhd1N0cmluZ1Byb3BlcnR5LFxyXG4gIE1vbGVjdWxlU2hhcGVzU3RyaW5ncy5zaGFwZS5zcXVhcmVQbGFuYXJTdHJpbmdQcm9wZXJ0eSxcclxuICBNb2xlY3VsZVNoYXBlc1N0cmluZ3Muc2hhcGUudHJpZ29uYWxCaXB5cmFtaWRhbFN0cmluZ1Byb3BlcnR5LFxyXG4gIE1vbGVjdWxlU2hhcGVzU3RyaW5ncy5zaGFwZS5zcXVhcmVQeXJhbWlkYWxTdHJpbmdQcm9wZXJ0eSxcclxuICBNb2xlY3VsZVNoYXBlc1N0cmluZ3Muc2hhcGUub2N0YWhlZHJhbFN0cmluZ1Byb3BlcnR5XHJcbl07XHJcblxyXG5jb25zdCBnZW9tZXRyeU5hbWVGb250ID0gbmV3IFBoZXRGb250KCAxNiApO1xyXG5cclxuY29uc3QgTUFYX0lORElWSURVQUxfV0lEVEggPSA0MjA7XHJcblxyXG5mdW5jdGlvbiBnZXRNYXhpbXVtVGV4dFdpZHRoKCBzdHJpbmdQcm9wZXJ0aWVzICkge1xyXG4gIHJldHVybiBuZXcgRGVyaXZlZFByb3BlcnR5KCBzdHJpbmdQcm9wZXJ0aWVzLCAoIC4uLnN0cmluZ3MgKSA9PiB7XHJcbiAgICByZXR1cm4gTWF0aC5taW4oIE1BWF9JTkRJVklEVUFMX1dJRFRILCBNYXRoLm1heCggLi4uc3RyaW5ncy5tYXAoIHN0cmluZyA9PiB7XHJcbiAgICAgIHJldHVybiBuZXcgVGV4dCggc3RyaW5nLCB7IGZvbnQ6IGdlb21ldHJ5TmFtZUZvbnQgfSApLndpZHRoO1xyXG4gICAgfSApICkgKTtcclxuICB9ICk7XHJcbn1cclxuXHJcbmNvbnN0IG1heEVsZWN0cm9uR2VvbWV0cnlXaWR0aFByb3BlcnR5ID0gZ2V0TWF4aW11bVRleHRXaWR0aCggZWxlY3Ryb25HZW9tZXRyeVN0cmluZ1Byb3BlcnRpZXMgKTtcclxuY29uc3QgbWF4TW9sZWN1bGVHZW9tZXRyeVdpZHRoUHJvcGVydHkgPSBnZXRNYXhpbXVtVGV4dFdpZHRoKCBtb2xlY3VsZUdlb21ldHJ5U3RyaW5nUHJvcGVydGllcyApO1xyXG5cclxuY2xhc3MgR2VvbWV0cnlOYW1lUGFuZWwgZXh0ZW5kcyBNb2xlY3VsZVNoYXBlc1BhbmVsIHtcclxuICAvKipcclxuICAgKiBAcGFyYW0ge01vbGVjdWxlU2hhcGVzTW9kZWx9IG1vZGVsXHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbW9kZWwsIHRhbmRlbSwgb3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuICAgICAgZmlsbDogTW9sZWN1bGVTaGFwZXNDb2xvcnMuYmFja2dyb3VuZFByb3BlcnR5LFxyXG4gICAgICB0YW5kZW06IHRhbmRlbVxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IGNvbnRlbnQgPSBuZXcgR3JpZEJveCgge1xyXG4gICAgICB4U3BhY2luZzogMjAsXHJcbiAgICAgIHlTcGFjaW5nOiAxMFxyXG4gICAgfSApO1xyXG5cclxuICAgIHN1cGVyKCBNb2xlY3VsZVNoYXBlc1N0cmluZ3MuY29udHJvbC5nZW9tZXRyeU5hbWVTdHJpbmdQcm9wZXJ0eSwgY29udGVudCwgdGFuZGVtICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge01vbGVjdWxlU2hhcGVzTW9kZWx9XHJcbiAgICB0aGlzLm1vZGVsID0gbW9kZWw7XHJcblxyXG4gICAgLy8gbGFiZWxzIGZvciB0aGUgdHlwZXMgb2YgZ2VvbWV0cmllc1xyXG4gICAgY29uc3QgdGV4dExhYmVsRm9udCA9IG5ldyBQaGV0Rm9udCggMTQgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7TW9sZWN1bGVTaGFwZXNDaGVja2JveH1cclxuICAgIGNvbnN0IG1vbGVjdWxlR2VvbWV0cnlDaGVja2JveFRhbmRlbSA9IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdtb2xlY3VsZUdlb21ldHJ5Q2hlY2tib3gnICk7XHJcbiAgICB0aGlzLm1vbGVjdWxlR2VvbWV0cnlDaGVja2JveCA9IG5ldyBNb2xlY3VsZVNoYXBlc0NoZWNrYm94KCBtb2RlbC5zaG93TW9sZWN1bGVHZW9tZXRyeVByb3BlcnR5LCBuZXcgVGV4dCggTW9sZWN1bGVTaGFwZXNTdHJpbmdzLmNvbnRyb2wubW9sZWN1bGVHZW9tZXRyeVN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgIGZvbnQ6IHRleHRMYWJlbEZvbnQsXHJcbiAgICAgIGZpbGw6IE1vbGVjdWxlU2hhcGVzQ29sb3JzLm1vbGVjdWxlR2VvbWV0cnlOYW1lUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbTogbW9sZWN1bGVHZW9tZXRyeUNoZWNrYm94VGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xhYmVsVGV4dCcgKVxyXG4gICAgfSApLCB7XHJcbiAgICAgIHRhbmRlbTogbW9sZWN1bGVHZW9tZXRyeUNoZWNrYm94VGFuZGVtLFxyXG4gICAgICBsYXlvdXRPcHRpb25zOiB7XHJcbiAgICAgICAgY29sdW1uOiAxLFxyXG4gICAgICAgIHJvdzogMFxyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBlbGVjdHJvbkdlb21ldHJ5Q2hlY2tib3hUYW5kZW0gPSBtb2RlbC5pc0Jhc2ljc1ZlcnNpb24gPyBUYW5kZW0uT1BUX09VVCA6IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdlbGVjdHJvbkdlb21ldHJ5Q2hlY2tib3gnICk7XHJcbiAgICB0aGlzLmVsZWN0cm9uR2VvbWV0cnlDaGVja2JveCA9IG5ldyBNb2xlY3VsZVNoYXBlc0NoZWNrYm94KCBtb2RlbC5zaG93RWxlY3Ryb25HZW9tZXRyeVByb3BlcnR5LCBuZXcgVGV4dCggTW9sZWN1bGVTaGFwZXNTdHJpbmdzLmNvbnRyb2wuZWxlY3Ryb25HZW9tZXRyeVN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgIGZvbnQ6IHRleHRMYWJlbEZvbnQsXHJcbiAgICAgIGZpbGw6IE1vbGVjdWxlU2hhcGVzQ29sb3JzLmVsZWN0cm9uR2VvbWV0cnlOYW1lUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbTogZWxlY3Ryb25HZW9tZXRyeUNoZWNrYm94VGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xhYmVsVGV4dCcgKVxyXG4gICAgfSApLCB7XHJcbiAgICAgIHRhbmRlbTogZWxlY3Ryb25HZW9tZXRyeUNoZWNrYm94VGFuZGVtLFxyXG4gICAgICBsYXlvdXRPcHRpb25zOiB7XHJcbiAgICAgICAgY29sdW1uOiAwLFxyXG4gICAgICAgIHJvdzogMFxyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge1RleHR9IC0gdGV4dCBmaWVsZHMgdGhhdCB3aWxsIHNob3cgdGhlIG5hbWUgb2YgdGhlIGdlb21ldHJ5ICh1c2VzIHN0cmluZyBwbGFjZWhvbGRlcnMgZm9yIGhlaWdodClcclxuICAgIHRoaXMubW9sZWN1bGVUZXh0ID0gbmV3IFRleHQoICdYJywge1xyXG4gICAgICB2aXNpYmxlUHJvcGVydHk6IG1vZGVsLnNob3dNb2xlY3VsZUdlb21ldHJ5UHJvcGVydHksXHJcbiAgICAgIGZvbnQ6IGdlb21ldHJ5TmFtZUZvbnQsXHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZSxcclxuICAgICAgZmlsbDogTW9sZWN1bGVTaGFwZXNDb2xvcnMubW9sZWN1bGVHZW9tZXRyeU5hbWVQcm9wZXJ0eSxcclxuICAgICAgbWF4V2lkdGg6IE1BWF9JTkRJVklEVUFMX1dJRFRIXHJcbiAgICB9ICk7XHJcbiAgICAvLyBAcHJpdmF0ZSB7VGV4dH1cclxuICAgIHRoaXMuZWxlY3Ryb25UZXh0ID0gbmV3IFRleHQoICdZJywge1xyXG4gICAgICB2aXNpYmxlUHJvcGVydHk6IG1vZGVsLnNob3dFbGVjdHJvbkdlb21ldHJ5UHJvcGVydHksXHJcbiAgICAgIGZvbnQ6IGdlb21ldHJ5TmFtZUZvbnQsXHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZSxcclxuICAgICAgZmlsbDogTW9sZWN1bGVTaGFwZXNDb2xvcnMuZWxlY3Ryb25HZW9tZXRyeU5hbWVQcm9wZXJ0eSxcclxuICAgICAgbWF4V2lkdGg6IE1BWF9JTkRJVklEVUFMX1dJRFRIXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgbW9sZWN1bGVUZXh0Q29udGFpbmVyID0gbmV3IE5vZGUoIHtcclxuICAgICAgLy8gSGlkZSB0aGlzIGNvbnRhaW5lciBvbmx5IHdoZW4gdGhlIGNoZWNrYm94IGlzIGhpZGRlblxyXG4gICAgICB2aXNpYmxlUHJvcGVydHk6IHRoaXMubW9sZWN1bGVHZW9tZXRyeUNoZWNrYm94LnZpc2libGVQcm9wZXJ0eSxcclxuICAgICAgY2hpbGRyZW46IFsgdGhpcy5tb2xlY3VsZVRleHQgXSxcclxuICAgICAgbGF5b3V0T3B0aW9uczoge1xyXG4gICAgICAgIGNvbHVtbjogMSxcclxuICAgICAgICByb3c6IDEsXHJcbiAgICAgICAgbWluQ29udGVudEhlaWdodDogdGhpcy5tb2xlY3VsZVRleHQuaGVpZ2h0XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIG1heE1vbGVjdWxlR2VvbWV0cnlXaWR0aFByb3BlcnR5LmxpbmsoIG1heE1vbGVjdWxlR2VvbWV0cnlXaWR0aCA9PiB7XHJcbiAgICAgIG1vbGVjdWxlVGV4dENvbnRhaW5lci5tdXRhdGVMYXlvdXRPcHRpb25zKCB7XHJcbiAgICAgICAgbWluQ29udGVudFdpZHRoOiBtYXhNb2xlY3VsZUdlb21ldHJ5V2lkdGhcclxuICAgICAgfSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFRPRE86IHBvaW50ZXIgYXJlYSBsaXN0ZW5lcnNcclxuXHJcbiAgICBjb250ZW50LmFkZENoaWxkKCB0aGlzLm1vbGVjdWxlR2VvbWV0cnlDaGVja2JveCApO1xyXG4gICAgY29udGVudC5hZGRDaGlsZCggbW9sZWN1bGVUZXh0Q29udGFpbmVyICk7XHJcblxyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayggWyB0aGlzLm1vbGVjdWxlR2VvbWV0cnlDaGVja2JveC5ib3VuZHNQcm9wZXJ0eSwgbW9sZWN1bGVUZXh0Q29udGFpbmVyLmJvdW5kc1Byb3BlcnR5LCBjb250ZW50LmJvdW5kc1Byb3BlcnR5IF0sICgpID0+IHtcclxuICAgICAgbGV0IGJvdW5kcyA9IHRoaXMubW9sZWN1bGVHZW9tZXRyeUNoZWNrYm94LmxvY2FsQm91bmRzLnVuaW9uKCB0aGlzLm1vbGVjdWxlR2VvbWV0cnlDaGVja2JveC5ib3VuZHNPZiggbW9sZWN1bGVUZXh0Q29udGFpbmVyICkgKTtcclxuICAgICAgaWYgKCBib3VuZHMud2lkdGggPCBtYXhNb2xlY3VsZUdlb21ldHJ5V2lkdGhQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICBib3VuZHMgPSBib3VuZHMuZGlsYXRlZFgoICggbWF4TW9sZWN1bGVHZW9tZXRyeVdpZHRoUHJvcGVydHkudmFsdWUgLSBib3VuZHMud2lkdGggKSAvIDIgKTtcclxuICAgICAgfVxyXG4gICAgICBib3VuZHMgPSBib3VuZHMuZGlsYXRlZCggMTAgKTtcclxuICAgICAgdGhpcy5tb2xlY3VsZUdlb21ldHJ5Q2hlY2tib3gudG91Y2hBcmVhID0gdGhpcy5tb2xlY3VsZUdlb21ldHJ5Q2hlY2tib3gubW91c2VBcmVhID0gYm91bmRzO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGlmICggIW1vZGVsLmlzQmFzaWNzVmVyc2lvbiApIHtcclxuICAgICAgY29uc3QgZWxlY3Ryb25UZXh0Q29udGFpbmVyID0gbmV3IE5vZGUoIHtcclxuICAgICAgICAvLyBIaWRlIHRoaXMgY29udGFpbmVyIG9ubHkgd2hlbiB0aGUgY2hlY2tib3ggaXMgaGlkZGVuXHJcbiAgICAgICAgdmlzaWJsZVByb3BlcnR5OiB0aGlzLmVsZWN0cm9uR2VvbWV0cnlDaGVja2JveC52aXNpYmxlUHJvcGVydHksXHJcbiAgICAgICAgY2hpbGRyZW46IFsgdGhpcy5lbGVjdHJvblRleHQgXSxcclxuICAgICAgICBsYXlvdXRPcHRpb25zOiB7XHJcbiAgICAgICAgICBjb2x1bW46IDAsXHJcbiAgICAgICAgICByb3c6IDEsXHJcbiAgICAgICAgICBtaW5Db250ZW50SGVpZ2h0OiB0aGlzLmVsZWN0cm9uVGV4dC5oZWlnaHRcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgICAgbWF4RWxlY3Ryb25HZW9tZXRyeVdpZHRoUHJvcGVydHkubGluayggbWF4RWxlY3Ryb25HZW9tZXRyeVdpZHRoID0+IHtcclxuICAgICAgICBlbGVjdHJvblRleHRDb250YWluZXIubXV0YXRlTGF5b3V0T3B0aW9ucygge1xyXG4gICAgICAgICAgbWluQ29udGVudFdpZHRoOiBtYXhFbGVjdHJvbkdlb21ldHJ5V2lkdGhcclxuICAgICAgICB9ICk7XHJcbiAgICAgIH0gKTtcclxuXHJcblxyXG4gICAgICAvLyBiYXNpY3MgdmVyc2lvbiBleGNsdWRlcyBsb25lLXBhaXIgKGVsZWN0cm9uKSBnZW9tZXRyaWVzXHJcbiAgICAgIGNvbnRlbnQuYWRkQ2hpbGQoIHRoaXMuZWxlY3Ryb25HZW9tZXRyeUNoZWNrYm94ICk7XHJcbiAgICAgIGNvbnRlbnQuYWRkQ2hpbGQoIGVsZWN0cm9uVGV4dENvbnRhaW5lciApO1xyXG5cclxuICAgICAgTXVsdGlsaW5rLm11bHRpbGluayggWyB0aGlzLmVsZWN0cm9uR2VvbWV0cnlDaGVja2JveC5ib3VuZHNQcm9wZXJ0eSwgZWxlY3Ryb25UZXh0Q29udGFpbmVyLmJvdW5kc1Byb3BlcnR5LCBjb250ZW50LmJvdW5kc1Byb3BlcnR5IF0sICgpID0+IHtcclxuICAgICAgICBsZXQgYm91bmRzID0gdGhpcy5lbGVjdHJvbkdlb21ldHJ5Q2hlY2tib3gubG9jYWxCb3VuZHMudW5pb24oIHRoaXMuZWxlY3Ryb25HZW9tZXRyeUNoZWNrYm94LmJvdW5kc09mKCBlbGVjdHJvblRleHRDb250YWluZXIgKSApO1xyXG4gICAgICAgIGlmICggYm91bmRzLndpZHRoIDwgbWF4RWxlY3Ryb25HZW9tZXRyeVdpZHRoUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgICBib3VuZHMgPSBib3VuZHMuZGlsYXRlZFgoICggbWF4RWxlY3Ryb25HZW9tZXRyeVdpZHRoUHJvcGVydHkudmFsdWUgLSBib3VuZHMud2lkdGggKSAvIDIgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYm91bmRzID0gYm91bmRzLmRpbGF0ZWQoIDEwICk7XHJcbiAgICAgICAgdGhpcy5lbGVjdHJvbkdlb21ldHJ5Q2hlY2tib3gudG91Y2hBcmVhID0gdGhpcy5lbGVjdHJvbkdlb21ldHJ5Q2hlY2tib3gubW91c2VBcmVhID0gYm91bmRzO1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXBkYXRlTmFtZXMgPSB0aGlzLnVwZGF0ZU5hbWVzLmJpbmQoIHRoaXMgKTtcclxuICAgIG1vZGVsLm1vbGVjdWxlUHJvcGVydHkubGluayggKCBuZXdNb2xlY3VsZSwgb2xkTW9sZWN1bGUgKSA9PiB7XHJcbiAgICAgIGlmICggb2xkTW9sZWN1bGUgKSB7XHJcbiAgICAgICAgb2xkTW9sZWN1bGUuYm9uZENoYW5nZWRFbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCB1cGRhdGVOYW1lcyApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICggbmV3TW9sZWN1bGUgKSB7XHJcbiAgICAgICAgbmV3TW9sZWN1bGUuYm9uZENoYW5nZWRFbWl0dGVyLmFkZExpc3RlbmVyKCB1cGRhdGVOYW1lcyApO1xyXG4gICAgICB9XHJcbiAgICAgIHVwZGF0ZU5hbWVzKCk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgdXBkYXRlTmFtZXMoKSB7XHJcbiAgICB0aGlzLm1vbGVjdWxlVGV4dC5zdHJpbmdQcm9wZXJ0eSA9IHRoaXMuZ2V0TW9sZWN1bGVHZW9tZXRyeU5hbWUoKTtcclxuICAgIHRoaXMuZWxlY3Ryb25UZXh0LnN0cmluZ1Byb3BlcnR5ID0gdGhpcy5nZXRFbGVjdHJvbkdlb21ldHJ5TmFtZSgpO1xyXG5cclxuICAgIC8vIGxheW91dFxyXG4gICAgdGhpcy5tb2xlY3VsZVRleHQuY2VudGVyWCA9IHRoaXMubW9sZWN1bGVHZW9tZXRyeUNoZWNrYm94LmNlbnRlclg7XHJcbiAgICB0aGlzLmVsZWN0cm9uVGV4dC5jZW50ZXJYID0gdGhpcy5lbGVjdHJvbkdlb21ldHJ5Q2hlY2tib3guY2VudGVyWDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZ2V0TW9sZWN1bGVHZW9tZXRyeU5hbWUoKSB7XHJcbiAgICBjb25zdCBuYW1lUHJvcGVydHkgPSB0aGlzLm1vZGVsLm1vbGVjdWxlUHJvcGVydHkudmFsdWUuZ2V0Q2VudHJhbFZTRVBSQ29uZmlndXJhdGlvbigpLm1vbGVjdWxlR2VvbWV0cnkuc3RyaW5nUHJvcGVydHk7XHJcbiAgICBpZiAoIG5hbWVQcm9wZXJ0eSA9PT0gbnVsbCApIHtcclxuICAgICAgcmV0dXJuIGVtcHR5TW9sZWN1bGVHZW9tZXRyeVN0cmluZ1Byb3BlcnR5O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHJldHVybiBuYW1lUHJvcGVydHk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGdldEVsZWN0cm9uR2VvbWV0cnlOYW1lKCkge1xyXG4gICAgY29uc3QgbmFtZVByb3BlcnR5ID0gdGhpcy5tb2RlbC5tb2xlY3VsZVByb3BlcnR5LnZhbHVlLmdldENlbnRyYWxWU0VQUkNvbmZpZ3VyYXRpb24oKS5lbGVjdHJvbkdlb21ldHJ5LnN0cmluZ1Byb3BlcnR5O1xyXG4gICAgaWYgKCBuYW1lUHJvcGVydHkgPT09IG51bGwgKSB7XHJcbiAgICAgIHJldHVybiBlbXB0eUVsZWN0cm9uR2VvbWV0cnlTdHJpbmdQcm9wZXJ0eTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICByZXR1cm4gbmFtZVByb3BlcnR5O1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxubW9sZWN1bGVTaGFwZXMucmVnaXN0ZXIoICdHZW9tZXRyeU5hbWVQYW5lbCcsIEdlb21ldHJ5TmFtZVBhbmVs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