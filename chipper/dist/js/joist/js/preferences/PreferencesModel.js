// Copyright 2021-2023, University of Colorado Boulder

/**
 * A Class that manages Simulation features that are enabled and disabled by user Preferences.
 *
 * @author Jesse Greenberg
 */

import { colorProfileProperty, voicingManager, voicingUtteranceQueue } from '../../../scenery/js/imports.js';
import responseCollector from '../../../utterance-queue/js/responseCollector.js';
import BooleanProperty from '../../../axon/js/BooleanProperty.js';
import joist from '../joist.js';
import PreferencesStorage from './PreferencesStorage.js';
import soundManager from '../../../tambo/js/soundManager.js';
import audioManager from '../audioManager.js';
import PhetioObject from '../../../tandem/js/PhetioObject.js';
import optionize from '../../../phet-core/js/optionize.js';
import regionAndCultureManager from './regionAndCultureManager.js';
import SpeechSynthesisAnnouncer from '../../../utterance-queue/js/SpeechSynthesisAnnouncer.js';
import Tandem from '../../../tandem/js/Tandem.js';
import localeProperty from '../i18n/localeProperty.js';
import merge from '../../../phet-core/js/merge.js';
import IOType from '../../../tandem/js/types/IOType.js';
import BooleanIO from '../../../tandem/js/types/BooleanIO.js';
import Multilink from '../../../axon/js/Multilink.js';
const AUDIO_MODEL_TANDEM = 'audioModel';
const VISUAL_MODEL_TANDEM = 'visualModel';
const INPUT_MODEL_TANDEM = 'inputModel';

///////////////////////////////////////////
// Options types

// preferences that are simulation-specific
/////////////////////////////////////
// Model types
// Model for controls that appear in the "Simulation" panel of preferences
// Model for controls that appear in the "Visual" panel of preferences
// Model for controls that appear in the "Audio" panel of preferences
export default class PreferencesModel extends PhetioObject {
  constructor(providedOptions = {}) {
    // initialize-globals uses package.json to determine defaults for features enabled by the sim and those defaults
    // can be overwritten by query parameter.  So phet.chipper.queryParameters contains an accurate representation of
    // which features are required.
    const phetFeatures = phet.chipper.queryParameters;

    // Multiple optionize calls + spread in one initialization site so that TypeScript has the correct type for nested
    // options immediately, and we don't need multiple variables to achieve it.
    const options = {
      // Put the spread first so that nested options' defaults will correctly override
      ...optionize()({
        // phet-io
        tandem: Tandem.OPTIONAL,
        phetioType: PreferencesModel.PreferencesModelIO,
        phetioFeatured: true,
        phetioState: false,
        phetioReadOnly: true
      }, providedOptions),
      simulationOptions: optionize()({
        tandemName: 'simulationModel',
        customPreferences: []
      }, providedOptions.simulationOptions),
      visualOptions: optionize()({
        tandemName: VISUAL_MODEL_TANDEM,
        supportsProjectorMode: false,
        supportsInteractiveHighlights: phetFeatures.supportsInteractiveHighlights,
        customPreferences: []
      }, providedOptions.visualOptions),
      audioOptions: optionize()({
        tandemName: AUDIO_MODEL_TANDEM,
        supportsVoicing: phetFeatures.supportsVoicing,
        supportsSound: phetFeatures.supportsSound,
        supportsExtraSound: phetFeatures.supportsExtraSound,
        customPreferences: []
      }, providedOptions.audioOptions),
      inputOptions: optionize()({
        tandemName: INPUT_MODEL_TANDEM,
        supportsGestureControl: phetFeatures.supportsGestureControl,
        customPreferences: []
      }, providedOptions.inputOptions),
      localizationOptions: optionize()({
        tandemName: 'localizationModel',
        supportsDynamicLocales: !!localeProperty.validValues && localeProperty.validValues.length > 1 && phet.chipper.allowLocaleSwitching,
        characterSets: [],
        customPreferences: [],
        includeLocalePanel: true
      }, providedOptions.localizationOptions)
    };
    super(options);
    this.simulationModel = options.simulationOptions;
    const visualTandem = options.tandem.createTandem(VISUAL_MODEL_TANDEM);
    this.visualModel = merge({
      interactiveHighlightsEnabledProperty: new BooleanProperty(phet.chipper.queryParameters.interactiveHighlightsInitiallyEnabled, {
        tandem: visualTandem.createTandem('interactiveHighlightsEnabledProperty'),
        phetioState: false
      }),
      colorProfileProperty: colorProfileProperty
    }, options.visualOptions);

    // For now, the Voicing feature is only available when we are running in the English locale, accessibility
    // strings are not made available for translation. When running with dynamic locales, the voicing feature
    // is supported if English is available, but will be disabled until English is selected.
    const supportsVoicing = options.audioOptions.supportsVoicing && SpeechSynthesisAnnouncer.isSpeechSynthesisSupported() && (
    // Running with english locale OR an environment where locale switching is supported and
    // english is one of the available languages.
    phet.chipper.locale.startsWith('en') || phet.chipper.allowLocaleSwitching && _.some(localeProperty.validValues, value => value.startsWith('en')));

    // Audio can be disabled explicitly via query parameter
    const audioEnabled = phet.chipper.queryParameters.audio !== 'disabled';
    this.audioModel = {
      supportsVoicing: supportsVoicing && audioEnabled,
      supportsSound: options.audioOptions.supportsSound && audioEnabled,
      supportsExtraSound: options.audioOptions.supportsExtraSound && audioEnabled,
      audioEnabledProperty: audioManager.audioEnabledProperty,
      soundEnabledProperty: soundManager.enabledProperty,
      extraSoundEnabledProperty: soundManager.extraSoundEnabledProperty,
      voicingEnabledProperty: voicingManager.enabledProperty,
      voicingMainWindowVoicingEnabledProperty: voicingManager.mainWindowVoicingEnabledProperty,
      voicingObjectResponsesEnabledProperty: responseCollector.objectResponsesEnabledProperty,
      voicingContextResponsesEnabledProperty: responseCollector.contextResponsesEnabledProperty,
      voicingHintResponsesEnabledProperty: responseCollector.hintResponsesEnabledProperty,
      voicePitchProperty: voicingManager.voicePitchProperty,
      voiceRateProperty: voicingManager.voiceRateProperty,
      voiceProperty: voicingManager.voiceProperty,
      toolbarEnabledProperty: new BooleanProperty(true, {
        tandem: options.tandem.createTandem(AUDIO_MODEL_TANDEM).createTandem('toolbarEnabledProperty'),
        phetioState: false
      }),
      customPreferences: options.audioOptions.customPreferences,
      tandemName: options.audioOptions.tandemName
    };
    const inputTandem = options.tandem.createTandem(INPUT_MODEL_TANDEM);
    this.inputModel = merge({
      gestureControlsEnabledProperty: new BooleanProperty(false, {
        tandem: inputTandem.createTandem('gestureControlsEnabledProperty'),
        phetioState: false
      })
    }, options.inputOptions);
    this.localizationModel = merge({
      localeProperty: localeProperty,
      regionAndCultureProperty: regionAndCultureManager.regionAndCultureProperty
    }, options.localizationOptions);
    if (options.localizationOptions.characterSets.length > 0) {
      // default is the first set
      regionAndCultureManager.regionAndCultureProperty.value = options.localizationOptions.characterSets[0];
      assert && assert(regionAndCultureManager.regionAndCultureProperty.value !== null, 'We have at least one descriptor, so regionAndCultureProperty should not be null.');
      this.localizationModel.regionAndCultureProperty = regionAndCultureManager.regionAndCultureProperty;
    }
    if (this.audioModel.supportsExtraSound) {
      assert && assert(this.audioModel.supportsSound, 'supportsSound must be true to also support extraSound');
    }
    this.addPhetioLinkedElementsForModel(options.tandem, this.simulationModel);
    this.addPhetioLinkedElementsForModel(options.tandem, this.visualModel, [{
      property: this.visualModel.colorProfileProperty
    }]);
    this.addPhetioLinkedElementsForModel(options.tandem, this.audioModel, [{
      property: this.audioModel.audioEnabledProperty,
      tandemName: 'audioEnabledProperty'
    }, {
      property: this.audioModel.soundEnabledProperty,
      tandemName: 'soundEnabledProperty'
    }, {
      property: this.audioModel.extraSoundEnabledProperty,
      tandemName: 'extraSoundEnabledProperty'
    }, {
      property: this.audioModel.voicingEnabledProperty,
      tandemName: 'voicingEnabledProperty'
    }, {
      property: this.audioModel.voicingMainWindowVoicingEnabledProperty,
      tandemName: 'voicingMainWindowVoicingEnabledProperty'
    }, {
      property: this.audioModel.voicingObjectResponsesEnabledProperty,
      tandemName: 'voicingObjectResponsesEnabledProperty'
    }, {
      property: this.audioModel.voicingContextResponsesEnabledProperty,
      tandemName: 'voicingContextResponsesEnabledProperty'
    }, {
      property: this.audioModel.voicingHintResponsesEnabledProperty,
      tandemName: 'voicingHintResponsesEnabledProperty'
    }, {
      property: this.audioModel.voicePitchProperty,
      tandemName: 'voicePitchProperty'
    }, {
      property: this.audioModel.voiceRateProperty,
      tandemName: 'voiceRateProperty'
    }]);
    this.addPhetioLinkedElementsForModel(options.tandem, this.inputModel);
    this.addPhetioLinkedElementsForModel(options.tandem, this.localizationModel, [{
      property: this.localizationModel.localeProperty,
      tandemName: 'localeProperty'
    }]);

    // Since voicingManager in Scenery can not use initialize-globals, set the initial value for whether Voicing is
    // enabled here in the PreferencesModel.
    if (supportsVoicing) {
      voicingManager.enabledProperty.value = phet.chipper.queryParameters.voicingInitiallyEnabled;

      // Voicing is only available in the 'en' locale currently. If the locale is changed away from English, Voicing is
      // disabled. The next time Voicing returns to 'en', Voicing will be enabled again.
      let voicingDisabledFromLocale = false;
      localeProperty.link(locale => {
        const englishLocale = locale.startsWith('en');
        if (voicingManager.enabledProperty.value) {
          voicingManager.enabledProperty.value = englishLocale;
          voicingDisabledFromLocale = true;
        } else if (voicingDisabledFromLocale && englishLocale) {
          voicingManager.enabledProperty.value = true;
          voicingDisabledFromLocale = false;
        }
      });

      // The default utteranceQueue will be used for voicing of simulation components, and it is enabled when the
      // voicingManager is fully enabled (voicingManager is enabled and the voicing is enabled for the "main window"
      // sim screens)
      voicingManager.enabledProperty.link(enabled => {
        voicingUtteranceQueue.enabled = enabled;
        !enabled && voicingUtteranceQueue.clear();
      });

      // If initially enabled, then apply all responses on startup, can (and should) be overwritten by PreferencesStorage.
      if (phet.chipper.queryParameters.voicingInitiallyEnabled) {
        responseCollector.objectResponsesEnabledProperty.value = true;
        responseCollector.contextResponsesEnabledProperty.value = true;
        responseCollector.hintResponsesEnabledProperty.value = true;

        // Set the first voice according to PhET's preferred english voices
        const voicesMultilink = Multilink.multilink([voicingManager.voicesProperty, voicingManager.isInitializedProperty], (voices, initialized) => {
          if (initialized && voices.length > 0) {
            voicingManager.voiceProperty.value = voicingManager.getEnglishPrioritizedVoices()[0];
            Multilink.unmultilink(voicesMultilink);
          }
        });
      }
    }
    if (phet.chipper.queryParameters.printVoicingResponses) {
      voicingManager.startSpeakingEmitter.addListener(text => console.log(text));
    }
    this.registerPreferencesStorage();
  }

  /**
   * Set up preferencesStorage for supported PreferencesProperties. Don't include all-sound and all-audio controls
   * because that feel too global to automatically take the last value.
   */
  registerPreferencesStorage() {
    if (this.visualModel.supportsInteractiveHighlights) {
      PreferencesStorage.register(this.visualModel.interactiveHighlightsEnabledProperty, 'interactiveHighlightsEnabledProperty');
    }
    if (this.audioModel.supportsVoicing) {
      // Register these to be stored when PreferencesStorage is enabled.
      PreferencesStorage.register(this.audioModel.voicingObjectResponsesEnabledProperty, 'objectResponsesEnabledProperty');
      PreferencesStorage.register(this.audioModel.voicingContextResponsesEnabledProperty, 'contextResponsesEnabledProperty');
      PreferencesStorage.register(this.audioModel.voicingHintResponsesEnabledProperty, 'hintResponsesEnabledProperty');
      PreferencesStorage.register(this.audioModel.voiceRateProperty, 'voiceRateProperty');
      PreferencesStorage.register(this.audioModel.voicePitchProperty, 'voicePitchProperty');
    }
    if (this.audioModel.supportsExtraSound) {
      PreferencesStorage.register(this.audioModel.extraSoundEnabledProperty, 'extraSoundEnabledProperty');
    }
    if (this.inputModel.supportsGestureControl) {
      PreferencesStorage.register(this.inputModel.gestureControlsEnabledProperty, 'gestureControlsEnabledProperty');
    }
  }
  addPhetioLinkedElementsForModel(parentTandem, featureModel, additionalProperties = []) {
    const tandem = parentTandem.createTandem(featureModel.tandemName);
    const propertiesToLink = additionalProperties;
    for (let i = 0; i < featureModel.customPreferences.length; i++) {
      const customPreference = featureModel.customPreferences[i];
      customPreference.modelLinkables && propertiesToLink.push(...customPreference.modelLinkables);
    }
    for (let j = 0; j < propertiesToLink.length; j++) {
      const modelPropertyObject = propertiesToLink[j];
      const tandemName = modelPropertyObject.tandemName || modelPropertyObject.property.tandem.name;
      this.addLinkedElement(modelPropertyObject.property, {
        tandem: tandem.createTandem(tandemName)
      });
    }
  }
  preferenceModelHasCustom(preferenceModel) {
    return preferenceModel.customPreferences.length > 0;
  }

  /**
   * Returns true if the SimulationModel supports any preferences that can be changed.
   */
  supportsSimulationPreferences() {
    return this.preferenceModelHasCustom(this.simulationModel);
  }

  /**
   * Returns true if the VisualModel has any preferences that can be changed.
   */
  supportsVisualPreferences() {
    return this.visualModel.supportsInteractiveHighlights || this.visualModel.supportsProjectorMode || this.preferenceModelHasCustom(this.visualModel);
  }

  /**
   * Returns true if the AudioModel has any preferences that can be changed.
   */
  supportsAudioPreferences() {
    return this.audioModel.supportsSound || this.audioModel.supportsExtraSound || this.audioModel.supportsVoicing || this.preferenceModelHasCustom(this.audioModel);
  }

  /**
   * Returns true if the InputModel has any preferences that can be changed.
   */
  supportsInputPreferences() {
    return this.inputModel.supportsGestureControl || this.preferenceModelHasCustom(this.inputModel);
  }

  /**
   * Returns true if the LocalizationModel has any preferences that can be changed.
   */
  supportsLocalizationPreferences() {
    return this.localizationModel.supportsDynamicLocales || this.localizationModel.characterSets.length > 0 || this.preferenceModelHasCustom(this.localizationModel);
  }

  /**
   * Returns true if this model supports any controllable preferences for the dialog. Returns false when the dialog
   * would have nothing to display.
   */
  shouldShowDialog() {
    return this.supportsSimulationPreferences() || this.supportsVisualPreferences() || this.supportsInputPreferences() || this.supportsLocalizationPreferences() || this.supportsAudioPreferences();
  }
  static PreferencesModelIO = new IOType('PreferencesModelIO', {
    valueType: PreferencesModel,
    toStateObject: preferencesModel => {
      return {
        supportsProjectorMode: preferencesModel.visualModel.supportsProjectorMode,
        supportsInteractiveHighlights: preferencesModel.visualModel.supportsInteractiveHighlights,
        supportsVoicing: preferencesModel.audioModel.supportsVoicing,
        supportsSound: preferencesModel.audioModel.supportsSound,
        supportsExtraSound: preferencesModel.audioModel.supportsExtraSound,
        supportsGestureControl: preferencesModel.inputModel.supportsGestureControl,
        supportsDynamicLocales: preferencesModel.localizationModel.supportsDynamicLocales,
        // Method-based
        supportsAudioPreferences: preferencesModel.supportsAudioPreferences(),
        supportsInputPreferences: preferencesModel.supportsInputPreferences(),
        supportsLocalizationPreferences: preferencesModel.supportsLocalizationPreferences(),
        supportsSimulationPreferences: preferencesModel.supportsSimulationPreferences(),
        supportsVisualPreferences: preferencesModel.supportsVisualPreferences()
      };
    },
    stateSchema: {
      supportsProjectorMode: BooleanIO,
      supportsInteractiveHighlights: BooleanIO,
      supportsVoicing: BooleanIO,
      supportsSound: BooleanIO,
      supportsExtraSound: BooleanIO,
      supportsGestureControl: BooleanIO,
      supportsDynamicLocales: BooleanIO,
      // Method-based
      supportsAudioPreferences: BooleanIO,
      supportsInputPreferences: BooleanIO,
      supportsLocalizationPreferences: BooleanIO,
      supportsSimulationPreferences: BooleanIO,
      supportsVisualPreferences: BooleanIO
    }
  });
}
joist.register('PreferencesModel', PreferencesModel);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb2xvclByb2ZpbGVQcm9wZXJ0eSIsInZvaWNpbmdNYW5hZ2VyIiwidm9pY2luZ1V0dGVyYW5jZVF1ZXVlIiwicmVzcG9uc2VDb2xsZWN0b3IiLCJCb29sZWFuUHJvcGVydHkiLCJqb2lzdCIsIlByZWZlcmVuY2VzU3RvcmFnZSIsInNvdW5kTWFuYWdlciIsImF1ZGlvTWFuYWdlciIsIlBoZXRpb09iamVjdCIsIm9wdGlvbml6ZSIsInJlZ2lvbkFuZEN1bHR1cmVNYW5hZ2VyIiwiU3BlZWNoU3ludGhlc2lzQW5ub3VuY2VyIiwiVGFuZGVtIiwibG9jYWxlUHJvcGVydHkiLCJtZXJnZSIsIklPVHlwZSIsIkJvb2xlYW5JTyIsIk11bHRpbGluayIsIkFVRElPX01PREVMX1RBTkRFTSIsIlZJU1VBTF9NT0RFTF9UQU5ERU0iLCJJTlBVVF9NT0RFTF9UQU5ERU0iLCJQcmVmZXJlbmNlc01vZGVsIiwiY29uc3RydWN0b3IiLCJwcm92aWRlZE9wdGlvbnMiLCJwaGV0RmVhdHVyZXMiLCJwaGV0IiwiY2hpcHBlciIsInF1ZXJ5UGFyYW1ldGVycyIsIm9wdGlvbnMiLCJ0YW5kZW0iLCJPUFRJT05BTCIsInBoZXRpb1R5cGUiLCJQcmVmZXJlbmNlc01vZGVsSU8iLCJwaGV0aW9GZWF0dXJlZCIsInBoZXRpb1N0YXRlIiwicGhldGlvUmVhZE9ubHkiLCJzaW11bGF0aW9uT3B0aW9ucyIsInRhbmRlbU5hbWUiLCJjdXN0b21QcmVmZXJlbmNlcyIsInZpc3VhbE9wdGlvbnMiLCJzdXBwb3J0c1Byb2plY3Rvck1vZGUiLCJzdXBwb3J0c0ludGVyYWN0aXZlSGlnaGxpZ2h0cyIsImF1ZGlvT3B0aW9ucyIsInN1cHBvcnRzVm9pY2luZyIsInN1cHBvcnRzU291bmQiLCJzdXBwb3J0c0V4dHJhU291bmQiLCJpbnB1dE9wdGlvbnMiLCJzdXBwb3J0c0dlc3R1cmVDb250cm9sIiwibG9jYWxpemF0aW9uT3B0aW9ucyIsInN1cHBvcnRzRHluYW1pY0xvY2FsZXMiLCJ2YWxpZFZhbHVlcyIsImxlbmd0aCIsImFsbG93TG9jYWxlU3dpdGNoaW5nIiwiY2hhcmFjdGVyU2V0cyIsImluY2x1ZGVMb2NhbGVQYW5lbCIsInNpbXVsYXRpb25Nb2RlbCIsInZpc3VhbFRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsInZpc3VhbE1vZGVsIiwiaW50ZXJhY3RpdmVIaWdobGlnaHRzRW5hYmxlZFByb3BlcnR5IiwiaW50ZXJhY3RpdmVIaWdobGlnaHRzSW5pdGlhbGx5RW5hYmxlZCIsImlzU3BlZWNoU3ludGhlc2lzU3VwcG9ydGVkIiwibG9jYWxlIiwic3RhcnRzV2l0aCIsIl8iLCJzb21lIiwidmFsdWUiLCJhdWRpb0VuYWJsZWQiLCJhdWRpbyIsImF1ZGlvTW9kZWwiLCJhdWRpb0VuYWJsZWRQcm9wZXJ0eSIsInNvdW5kRW5hYmxlZFByb3BlcnR5IiwiZW5hYmxlZFByb3BlcnR5IiwiZXh0cmFTb3VuZEVuYWJsZWRQcm9wZXJ0eSIsInZvaWNpbmdFbmFibGVkUHJvcGVydHkiLCJ2b2ljaW5nTWFpbldpbmRvd1ZvaWNpbmdFbmFibGVkUHJvcGVydHkiLCJtYWluV2luZG93Vm9pY2luZ0VuYWJsZWRQcm9wZXJ0eSIsInZvaWNpbmdPYmplY3RSZXNwb25zZXNFbmFibGVkUHJvcGVydHkiLCJvYmplY3RSZXNwb25zZXNFbmFibGVkUHJvcGVydHkiLCJ2b2ljaW5nQ29udGV4dFJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eSIsImNvbnRleHRSZXNwb25zZXNFbmFibGVkUHJvcGVydHkiLCJ2b2ljaW5nSGludFJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eSIsImhpbnRSZXNwb25zZXNFbmFibGVkUHJvcGVydHkiLCJ2b2ljZVBpdGNoUHJvcGVydHkiLCJ2b2ljZVJhdGVQcm9wZXJ0eSIsInZvaWNlUHJvcGVydHkiLCJ0b29sYmFyRW5hYmxlZFByb3BlcnR5IiwiaW5wdXRUYW5kZW0iLCJpbnB1dE1vZGVsIiwiZ2VzdHVyZUNvbnRyb2xzRW5hYmxlZFByb3BlcnR5IiwibG9jYWxpemF0aW9uTW9kZWwiLCJyZWdpb25BbmRDdWx0dXJlUHJvcGVydHkiLCJhc3NlcnQiLCJhZGRQaGV0aW9MaW5rZWRFbGVtZW50c0Zvck1vZGVsIiwicHJvcGVydHkiLCJ2b2ljaW5nSW5pdGlhbGx5RW5hYmxlZCIsInZvaWNpbmdEaXNhYmxlZEZyb21Mb2NhbGUiLCJsaW5rIiwiZW5nbGlzaExvY2FsZSIsImVuYWJsZWQiLCJjbGVhciIsInZvaWNlc011bHRpbGluayIsIm11bHRpbGluayIsInZvaWNlc1Byb3BlcnR5IiwiaXNJbml0aWFsaXplZFByb3BlcnR5Iiwidm9pY2VzIiwiaW5pdGlhbGl6ZWQiLCJnZXRFbmdsaXNoUHJpb3JpdGl6ZWRWb2ljZXMiLCJ1bm11bHRpbGluayIsInByaW50Vm9pY2luZ1Jlc3BvbnNlcyIsInN0YXJ0U3BlYWtpbmdFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJ0ZXh0IiwiY29uc29sZSIsImxvZyIsInJlZ2lzdGVyUHJlZmVyZW5jZXNTdG9yYWdlIiwicmVnaXN0ZXIiLCJwYXJlbnRUYW5kZW0iLCJmZWF0dXJlTW9kZWwiLCJhZGRpdGlvbmFsUHJvcGVydGllcyIsInByb3BlcnRpZXNUb0xpbmsiLCJpIiwiY3VzdG9tUHJlZmVyZW5jZSIsIm1vZGVsTGlua2FibGVzIiwicHVzaCIsImoiLCJtb2RlbFByb3BlcnR5T2JqZWN0IiwibmFtZSIsImFkZExpbmtlZEVsZW1lbnQiLCJwcmVmZXJlbmNlTW9kZWxIYXNDdXN0b20iLCJwcmVmZXJlbmNlTW9kZWwiLCJzdXBwb3J0c1NpbXVsYXRpb25QcmVmZXJlbmNlcyIsInN1cHBvcnRzVmlzdWFsUHJlZmVyZW5jZXMiLCJzdXBwb3J0c0F1ZGlvUHJlZmVyZW5jZXMiLCJzdXBwb3J0c0lucHV0UHJlZmVyZW5jZXMiLCJzdXBwb3J0c0xvY2FsaXphdGlvblByZWZlcmVuY2VzIiwic2hvdWxkU2hvd0RpYWxvZyIsInZhbHVlVHlwZSIsInRvU3RhdGVPYmplY3QiLCJwcmVmZXJlbmNlc01vZGVsIiwic3RhdGVTY2hlbWEiXSwic291cmNlcyI6WyJQcmVmZXJlbmNlc01vZGVsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEEgQ2xhc3MgdGhhdCBtYW5hZ2VzIFNpbXVsYXRpb24gZmVhdHVyZXMgdGhhdCBhcmUgZW5hYmxlZCBhbmQgZGlzYWJsZWQgYnkgdXNlciBQcmVmZXJlbmNlcy5cclxuICpcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmdcclxuICovXHJcblxyXG5pbXBvcnQgeyBjb2xvclByb2ZpbGVQcm9wZXJ0eSwgTm9kZSwgdm9pY2luZ01hbmFnZXIsIHZvaWNpbmdVdHRlcmFuY2VRdWV1ZSB9IGZyb20gJy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCByZXNwb25zZUNvbGxlY3RvciBmcm9tICcuLi8uLi8uLi91dHRlcmFuY2UtcXVldWUvanMvcmVzcG9uc2VDb2xsZWN0b3IuanMnO1xyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IGpvaXN0IGZyb20gJy4uL2pvaXN0LmpzJztcclxuaW1wb3J0IFByZWZlcmVuY2VzU3RvcmFnZSBmcm9tICcuL1ByZWZlcmVuY2VzU3RvcmFnZS5qcyc7XHJcbmltcG9ydCBzb3VuZE1hbmFnZXIgZnJvbSAnLi4vLi4vLi4vdGFtYm8vanMvc291bmRNYW5hZ2VyLmpzJztcclxuaW1wb3J0IGF1ZGlvTWFuYWdlciBmcm9tICcuLi9hdWRpb01hbmFnZXIuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IFBoZXRpb09iamVjdCwgeyBQaGV0aW9PYmplY3RPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vdGFuZGVtL2pzL1BoZXRpb09iamVjdC5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgcmVnaW9uQW5kQ3VsdHVyZU1hbmFnZXIgZnJvbSAnLi9yZWdpb25BbmRDdWx0dXJlTWFuYWdlci5qcyc7XHJcbmltcG9ydCBTcGVlY2hTeW50aGVzaXNBbm5vdW5jZXIgZnJvbSAnLi4vLi4vLi4vdXR0ZXJhbmNlLXF1ZXVlL2pzL1NwZWVjaFN5bnRoZXNpc0Fubm91bmNlci5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBsb2NhbGVQcm9wZXJ0eSwgeyBMb2NhbGUgfSBmcm9tICcuLi9pMThuL2xvY2FsZVByb3BlcnR5LmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IElPVHlwZSBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvSU9UeXBlLmpzJztcclxuaW1wb3J0IEJvb2xlYW5JTyBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvQm9vbGVhbklPLmpzJztcclxuaW1wb3J0IENoYXJhY3RlclNldCBmcm9tICcuL0NoYXJhY3RlclNldC5qcyc7XHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5cclxudHlwZSBNb2RlbFByb3BlcnR5TGlua2FibGUgPSB7XHJcbiAgcHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHVua25vd24+ICYgUGhldGlvT2JqZWN0O1xyXG4gIHRhbmRlbU5hbWU/OiBzdHJpbmc7IC8vIGlmIGJsYW5rLCB3aWxsIHVzZSB0aGUgdGFuZGVtLm5hbWUgb2YgdGhlIFByb3BlcnR5LlxyXG59O1xyXG5cclxudHlwZSBDdXN0b21QcmVmZXJlbmNlID0ge1xyXG5cclxuICAvLyBDb250ZW50IHNob3VsZCBjcmVhdGUgYSBjaGlsZCB0YW5kZW0gY2FsbGVkICdzaW1QcmVmZXJlbmNlcydcclxuICBjcmVhdGVDb250ZW50OiAoIHBhcmVudFRhbmRlbTogVGFuZGVtICkgPT4gTm9kZTtcclxuXHJcbiAgLy8gRWFjaCB3aWxsIGhhdmUgYSBQaEVULWlPIExpbmtlZEVsZW1lbnQgYWRkZWQgdG8gdGhlIG1vZGVsIGZvciBlYWNoIG9mIHRoZW0uXHJcbiAgbW9kZWxMaW5rYWJsZXM/OiBNb2RlbFByb3BlcnR5TGlua2FibGVbXTtcclxufTtcclxuXHJcbnR5cGUgQ3VzdG9tUHJlZmVyZW5jZXNPcHRpb25zID0ge1xyXG4gIGN1c3RvbVByZWZlcmVuY2VzPzogQ3VzdG9tUHJlZmVyZW5jZVtdO1xyXG59O1xyXG5cclxuY29uc3QgQVVESU9fTU9ERUxfVEFOREVNID0gJ2F1ZGlvTW9kZWwnO1xyXG5jb25zdCBWSVNVQUxfTU9ERUxfVEFOREVNID0gJ3Zpc3VhbE1vZGVsJztcclxuY29uc3QgSU5QVVRfTU9ERUxfVEFOREVNID0gJ2lucHV0TW9kZWwnO1xyXG5cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLyBPcHRpb25zIHR5cGVzXHJcblxyXG4vLyBwcmVmZXJlbmNlcyB0aGF0IGFyZSBzaW11bGF0aW9uLXNwZWNpZmljXHJcbnR5cGUgU2ltdWxhdGlvblByZWZlcmVuY2VzT3B0aW9ucyA9IEN1c3RvbVByZWZlcmVuY2VzT3B0aW9ucztcclxuXHJcbnR5cGUgVmlzdWFsUHJlZmVyZW5jZXNPcHRpb25zID0ge1xyXG5cclxuICAvLyBXaGV0aGVyIHRoZSBzaW0gc3VwcG9ydHMgcHJvamVjdG9yIG1vZGUgYW5kIGEgdG9nZ2xlIHN3aXRjaCB0byBlbmFibGUgaXQgaW4gdGhlIFByZWZlcmVuY2VzRGlhbG9nLlxyXG4gIHN1cHBvcnRzUHJvamVjdG9yTW9kZT86IGJvb2xlYW47XHJcblxyXG4gIC8vIHdoZXRoZXIgdGhlIHNpbSBzdXBwb3J0cyB0aGUgXCJJbnRlcmFjdGl2ZSBIaWdobGlnaHRzXCIgZmVhdHVyZSwgYW5kIGNoZWNrYm94IHRvIGVuYWJsZSBpbiB0aGVcclxuICAvLyBQcmVmZXJlbmNlcyBEaWFsb2dcclxuICBzdXBwb3J0c0ludGVyYWN0aXZlSGlnaGxpZ2h0cz86IGJvb2xlYW47XHJcbn0gJiBDdXN0b21QcmVmZXJlbmNlc09wdGlvbnM7XHJcblxyXG50eXBlIEF1ZGlvUHJlZmVyZW5jZXNPcHRpb25zID0ge1xyXG5cclxuICAvLyBUaGUgZW50cnkgcG9pbnQgZm9yIFZvaWNpbmcsIGFuZCBpZiB0cnVlIHRoZSBzaW0gd2lsbCBzdXBwb3J0IFZvaWNpbmcgYW5kIFZvaWNpbmcgb3B0aW9ucyBpbiBQcmVmZXJlbmNlcy5cclxuICAvLyBUaGUgZmVhdHVyZSBpcyBvbmx5IGF2YWlsYWJsZSBvbiBwbGF0Zm9ybXMgd2hlcmUgU3BlZWNoU3ludGhlc2lzIGlzIHN1cHBvcnRlZC4gRm9yIG5vdywgaXQgaXMgb25seSBhdmFpbGFibGVcclxuICAvLyB3aGVuIHJ1bm5pbmcgd2l0aCBFbmdsaXNoIGxvY2FsZXMsIGFjY2Vzc2liaWxpdHkgc3RyaW5ncyBhcmUgbm90IG1hZGUgYXZhaWxhYmxlIGZvciB0cmFuc2xhdGlvbiB5ZXQuXHJcbiAgc3VwcG9ydHNWb2ljaW5nPzogYm9vbGVhbjtcclxuXHJcbiAgLy8gV2hldGhlciB0byBpbmNsdWRlIGNoZWNrYm94ZXMgcmVsYXRlZCB0byBzb3VuZCBhbmQgZXh0cmEgc291bmQuIHN1cHBvcnRzRXh0cmFTb3VuZCBjYW4gb25seSBiZVxyXG4gIC8vIGluY2x1ZGVkIGlmIHN1cHBvcnRzU291bmQgaXMgYWxzbyB0cnVlLlxyXG4gIHN1cHBvcnRzU291bmQ/OiBib29sZWFuO1xyXG4gIHN1cHBvcnRzRXh0cmFTb3VuZD86IGJvb2xlYW47XHJcbn0gJiBDdXN0b21QcmVmZXJlbmNlc09wdGlvbnM7XHJcblxyXG50eXBlIElucHV0UHJlZmVyZW5jZXNPcHRpb25zID0ge1xyXG5cclxuICAvLyBXaGV0aGVyIHRvIGluY2x1ZGUgXCJnZXN0dXJlXCIgY29udHJvbHNcclxuICBzdXBwb3J0c0dlc3R1cmVDb250cm9sPzogYm9vbGVhbjtcclxufSAmIEN1c3RvbVByZWZlcmVuY2VzT3B0aW9ucztcclxuXHJcbnR5cGUgTG9jYWxpemF0aW9uUHJlZmVyZW5jZXNPcHRpb25zID0ge1xyXG5cclxuICAvLyBXaGV0aGVyIHRvIGluY2x1ZGUgYSBVSSBjb21wb25lbnQgdGhhdCBjaGFuZ2VzIHRoZSBzaW0gbGFuZ3VhZ2UuIERlZmF1bHQgZm9yIHRoaXMgaW4gcGhldEZlYXR1cmVzIGlzIHRydWUuIEJ1dCBpdFxyXG4gIC8vIGlzIHN0aWxsIG9ubHkgYXZhaWxhYmxlIHdoZW4gbG9jYWxlUHJvcGVydHkgaW5kaWNhdGVzIHRoYXQgbW9yZSB0aGFuIG9uZSBsb2NhbGUgaXMgYXZhaWxhYmxlLlxyXG4gIHN1cHBvcnRzRHluYW1pY0xvY2FsZXM/OiBib29sZWFuO1xyXG5cclxuICAvLyBEZXNjcmliZXMgdGhlIGF2YWlsYWJsZSBhcnR3b3JrIHRoYXQgY2FuIGJlIHVzZWQgZm9yIGRpZmZlcmVudCByZWdpb25zIGFuZCBjdWx0dXJlcy4gSWYgYW55IHNldHMgYXJlXHJcbiAgLy8gcHJvdmlkZWQsIHRoZSBMb2NhbGl6YXRpb24gdGFiIHdpbGwgaW5jbHVkZSBhIFVJIGNvbXBvbmVudCB0byBzd2FwIG91dCBwaWVjZXMgb2YgYXJ0d29yayB0byBtYXRjaCB0aGUgc2VsZWN0ZWRcclxuICAvLyByZWdpb24gYW5kIGN1bHR1cmUuIENoYXJhY3RlclNldHMgY29udGFpbnMgaW5mb3JtYXRpb24gZm9yIHRoZSBVSSBjb21wb25lbnQgdG8gZGVzY3JpYmUgZWFjaCBjaG9pY2UuXHJcbiAgY2hhcmFjdGVyU2V0cz86IENoYXJhY3RlclNldFtdO1xyXG5cclxuICAvLyBXaGV0aGVyIHRvIGluY2x1ZGUgdGhlIGRlZmF1bHQgTG9jYWxlUGFuZWwgZm9yIHNlbGVjdGluZyBsb2NhbGUuIFRoaXMgd2FzIGFkZGVkIHRvIGFsbG93IHNpbXMgbGlrZVxyXG4gIC8vIE51bWJlciBQbGF5IGFuZCBOdW1iZXIgQ29tcGFyZSB0byBzdWJzdGl0dXRlIHRoZWlyIG93biBjdXN0b20gY29udHJvbHMuXHJcbiAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9udW1iZXItc3VpdGUtY29tbW9uL2lzc3Vlcy80Ny5cclxuICBpbmNsdWRlTG9jYWxlUGFuZWw/OiBib29sZWFuO1xyXG59ICYgQ3VzdG9tUHJlZmVyZW5jZXNPcHRpb25zO1xyXG5cclxudHlwZSBQcmVmZXJlbmNlc01vZGVsU2VsZk9wdGlvbnMgPSB7XHJcblxyXG4gIC8vIGNvbmZpZ3VyYXRpb24gZm9yIGNvbnRyb2xzIGluIHRoZSBcIlNpbXVsYXRpb25cIiB0YWIgb2YgdGhlIFByZWZlcmVuY2VzRGlhbG9nXHJcbiAgc2ltdWxhdGlvbk9wdGlvbnM/OiBTaW11bGF0aW9uUHJlZmVyZW5jZXNPcHRpb25zO1xyXG5cclxuICAvLyBjb25maWd1cmF0aW9uIGZvciBjb250cm9scyBpbiB0aGUgXCJWaXN1YWxcIiB0YWIgb2YgdGhlIFByZWZlcmVuY2VzRGlhbG9nXHJcbiAgdmlzdWFsT3B0aW9ucz86IFZpc3VhbFByZWZlcmVuY2VzT3B0aW9ucztcclxuXHJcbiAgLy8gY29uZmlndXJhdGlvbiBmb3IgY29udHJvbHMgaW4gdGhlIFwiQXVkaW9cIiB0YWIgb2YgdGhlIFByZWZlcmVuY2VzRGlhbG9nXHJcbiAgYXVkaW9PcHRpb25zPzogQXVkaW9QcmVmZXJlbmNlc09wdGlvbnM7XHJcblxyXG4gIC8vIGNvbmZpZ3VyYXRpb24gZm9yIGNvbnRyb2xzIGluIHRoZSBcIklucHV0XCIgdGFiIG9mIHRoZSBQcmVmZXJlbmNlc0RpYWxvZ1xyXG4gIGlucHV0T3B0aW9ucz86IElucHV0UHJlZmVyZW5jZXNPcHRpb25zO1xyXG5cclxuICAvLyBjb25maWd1cmF0aW9uIGZvciBjb250cm9scyBpbiB0aGUgXCJMb2NhbGl6YXRpb25cIiB0YWIgb2YgdGhlIFByZWZlcmVuY2VzRGlhbG9nXHJcbiAgbG9jYWxpemF0aW9uT3B0aW9ucz86IExvY2FsaXphdGlvblByZWZlcmVuY2VzT3B0aW9ucztcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFByZWZlcmVuY2VzTW9kZWxPcHRpb25zID0gUHJlZmVyZW5jZXNNb2RlbFNlbGZPcHRpb25zICYgUGhldGlvT2JqZWN0T3B0aW9ucztcclxuXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8gTW9kZWwgdHlwZXNcclxuXHJcbnR5cGUgQmFzZU1vZGVsVHlwZSA9IHtcclxuICB0YW5kZW1OYW1lOiBzdHJpbmc7IC8vIHRhbmRlbSBuYW1lIG9mIHRoZSBtb2RlbCwgbGlrZSBcImF1ZGlvTW9kZWxcIlxyXG59O1xyXG5cclxuLy8gTW9kZWwgZm9yIGNvbnRyb2xzIHRoYXQgYXBwZWFyIGluIHRoZSBcIlNpbXVsYXRpb25cIiBwYW5lbCBvZiBwcmVmZXJlbmNlc1xyXG5leHBvcnQgdHlwZSBTaW11bGF0aW9uTW9kZWwgPSBCYXNlTW9kZWxUeXBlICYgUmVxdWlyZWQ8U2ltdWxhdGlvblByZWZlcmVuY2VzT3B0aW9ucz47XHJcblxyXG4vLyBNb2RlbCBmb3IgY29udHJvbHMgdGhhdCBhcHBlYXIgaW4gdGhlIFwiVmlzdWFsXCIgcGFuZWwgb2YgcHJlZmVyZW5jZXNcclxuZXhwb3J0IHR5cGUgVmlzdWFsTW9kZWwgPSBCYXNlTW9kZWxUeXBlICYge1xyXG5cclxuICAvLyBXaGV0aGVyIFwiSW50ZXJhY3RpdmUgSGlnaGxpZ2h0c1wiIGFyZSBlbmFibGVkIGZvciB0aGUgc2ltdWxhdGlvbi4gSWYgZW5hYmxlZCwgZm9jdXMgaGlnaGxpZ2h0cyB3aWxsIGFwcGVhciBhcm91bmRcclxuICAvLyBmb2N1c2FibGUgY29tcG9uZW50cyB3aXRoICdvdmVyJyBldmVudHMsIGFuZCBwZXJzaXN0IGFyb3VuZCB0aGUgZm9jdXNlZCBlbGVtZW50IGV2ZW4gd2l0aCBtb3VzZSBhbmQgdG91Y2hcclxuICAvLyBpbnRlcmFjdGlvbi5cclxuICBpbnRlcmFjdGl2ZUhpZ2hsaWdodHNFbmFibGVkUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyBUaGUgY3VycmVudCBjb2xvclByb2ZpbGUgb2YgdGhlIFNpbXVsYXRpb25cclxuICBjb2xvclByb2ZpbGVQcm9wZXJ0eTogUHJvcGVydHk8c3RyaW5nPjtcclxufSAmIFJlcXVpcmVkPFZpc3VhbFByZWZlcmVuY2VzT3B0aW9ucz47XHJcblxyXG4vLyBNb2RlbCBmb3IgY29udHJvbHMgdGhhdCBhcHBlYXIgaW4gdGhlIFwiQXVkaW9cIiBwYW5lbCBvZiBwcmVmZXJlbmNlc1xyXG5leHBvcnQgdHlwZSBBdWRpb01vZGVsID0gQmFzZU1vZGVsVHlwZSAmIHtcclxuXHJcbiAgLy8gV2hlbiBmYWxzZSwgbm8gYXVkaW8gZmVhdHVyZXMgYXJlIGhlYXJkLiBTZWUgYXVkaW9NYW5hZ2VyLnRzIGZvciBkb2N1bWVudGF0aW9uIGFib3V0IGF1ZGlvIGFuZCBzdWIgZmVhdHVyZXMuXHJcbiAgYXVkaW9FbmFibGVkUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG4gIHNvdW5kRW5hYmxlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICBleHRyYVNvdW5kRW5hYmxlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICB2b2ljaW5nRW5hYmxlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gV2hldGhlciBzdWItZmVhdHVyZXMgb2YgVm9pY2luZyBhcmUgZW5hYmxlZC4gU2VlIHZvaWNpbmdNYW5hZ2VyIGFuZCByZXNwb25zZUNvbGxlY3RvciBmb3IgZG9jdW1lbnRhdGlvbiBhYm91dFxyXG4gIC8vIGVhY2ggb2YgdGhlc2UgZmVhdHVyZXMuXHJcbiAgdm9pY2luZ01haW5XaW5kb3dWb2ljaW5nRW5hYmxlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICB2b2ljaW5nT2JqZWN0UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICB2b2ljaW5nQ29udGV4dFJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgdm9pY2luZ0hpbnRSZXNwb25zZXNFbmFibGVkUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyBDb250cm9scyBmb3IgdGhlIHZvaWNlIG9mIFNwZWVjaFN5bnRoZXNpc0Fubm91bmNlci50c1xyXG4gIHZvaWNlUGl0Y2hQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHk7XHJcbiAgdm9pY2VSYXRlUHJvcGVydHk6IE51bWJlclByb3BlcnR5O1xyXG4gIHZvaWNlUHJvcGVydHk6IFByb3BlcnR5PG51bGwgfCBTcGVlY2hTeW50aGVzaXNWb2ljZT47IC8vIE5vdCBhIFBoRVQtaU8gbGlua2VkIGVsZW1lbnQgYmVjYXVzZSBpdCBjYW4ndCBiZSBjdXN0b21pemVkIHRocm91Z2ggdGhlIEFQSS5cclxuXHJcbiAgLy8gV2hldGhlciB0aGUgU2ltIFRvb2xiYXIgaXMgZW5hYmxlZCwgd2hpY2ggZ2l2ZXMgcXVpY2sgYWNjZXNzIHRvIFZvaWNpbmcgY29udHJvbHMgYW5kIGZlYXR1cmVzLlxyXG4gIHRvb2xiYXJFbmFibGVkUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG59ICYgUmVxdWlyZWQ8QXVkaW9QcmVmZXJlbmNlc09wdGlvbnM+O1xyXG5cclxuZXhwb3J0IHR5cGUgSW5wdXRNb2RlbCA9IEJhc2VNb2RlbFR5cGUgJiB7XHJcblxyXG4gIC8vIFdoZXRoZXIgXCJHZXN0dXJlIENvbnRyb2xzXCIgYXJlIGVuYWJsZWQgZm9yIHRoZSBzaW11bGF0aW9uLiBJZiBlbmFibGVkLCB0b3VjaCBzY3JlZW4gaW5wdXQgd2lsbCBjaGFuZ2UgdG8gd29ya1xyXG4gIC8vIGxpa2UgYSBzY3JlZW4gcmVhZGVyLiBIb3Jpem9udGFsIHN3aXBlcyBhY3Jvc3MgdGhlIHNjcmVlbiB3aWxsIG1vdmUgZm9jdXMsIGRvdWJsZS10YXBzIHdpbGwgYWN0aXZhdGUgdGhlXHJcbiAgLy8gc2VsZWN0ZWQgaXRlbSwgYW5kIHRhcCB0aGVuIGhvbGQgd2lsbCBpbml0aWF0ZSBkcmFnIGFuZCBkcm9wIGludGVyYWN0aW9ucy4gTm90ZSB0aGF0IGVuYWJsaW5nIHRoaXMgd2lsbCBnZW5lcmFsbHlcclxuICAvLyBwcmV2ZW50IGFsbCB0b3VjaCBpbnB1dCBmcm9tIHdvcmtpbmcgYXMgaXQgZG9lcyBub3JtYWxseS5cclxuICBnZXN0dXJlQ29udHJvbHNFbmFibGVkUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxufSAmIFJlcXVpcmVkPElucHV0UHJlZmVyZW5jZXNPcHRpb25zPjtcclxuXHJcbmV4cG9ydCB0eXBlIExvY2FsaXphdGlvbk1vZGVsID0gQmFzZU1vZGVsVHlwZSAmIHtcclxuXHJcbiAgLy8gVGhlIHNlbGVjdGVkIGNoYXJhY3RlciBhcnR3b3JrIHRvIHVzZSB3aGVuIHRoZSBzaW0gc3VwcG9ydHMgY3VsdHVyZSBhbmQgcmVnaW9uIHN3aXRjaGluZy5cclxuICByZWdpb25BbmRDdWx0dXJlUHJvcGVydHk6IFByb3BlcnR5PENoYXJhY3RlclNldCB8IG51bGw+O1xyXG5cclxuICBsb2NhbGVQcm9wZXJ0eTogUHJvcGVydHk8TG9jYWxlPjtcclxufSAmIFJlcXVpcmVkPExvY2FsaXphdGlvblByZWZlcmVuY2VzT3B0aW9ucz47XHJcblxyXG50eXBlIEZlYXR1cmVNb2RlbCA9IFNpbXVsYXRpb25Nb2RlbCB8IEF1ZGlvTW9kZWwgfCBWaXN1YWxNb2RlbCB8IElucHV0TW9kZWwgfCBMb2NhbGl6YXRpb25Nb2RlbDtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByZWZlcmVuY2VzTW9kZWwgZXh0ZW5kcyBQaGV0aW9PYmplY3Qge1xyXG4gIHB1YmxpYyByZWFkb25seSBzaW11bGF0aW9uTW9kZWw6IFNpbXVsYXRpb25Nb2RlbDtcclxuICBwdWJsaWMgcmVhZG9ubHkgdmlzdWFsTW9kZWw6IFZpc3VhbE1vZGVsO1xyXG4gIHB1YmxpYyByZWFkb25seSBhdWRpb01vZGVsOiBBdWRpb01vZGVsO1xyXG4gIHB1YmxpYyByZWFkb25seSBpbnB1dE1vZGVsOiBJbnB1dE1vZGVsO1xyXG4gIHB1YmxpYyByZWFkb25seSBsb2NhbGl6YXRpb25Nb2RlbDogTG9jYWxpemF0aW9uTW9kZWw7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcHJvdmlkZWRPcHRpb25zOiBQcmVmZXJlbmNlc01vZGVsT3B0aW9ucyA9IHt9ICkge1xyXG5cclxuICAgIC8vIGluaXRpYWxpemUtZ2xvYmFscyB1c2VzIHBhY2thZ2UuanNvbiB0byBkZXRlcm1pbmUgZGVmYXVsdHMgZm9yIGZlYXR1cmVzIGVuYWJsZWQgYnkgdGhlIHNpbSBhbmQgdGhvc2UgZGVmYXVsdHNcclxuICAgIC8vIGNhbiBiZSBvdmVyd3JpdHRlbiBieSBxdWVyeSBwYXJhbWV0ZXIuICBTbyBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzIGNvbnRhaW5zIGFuIGFjY3VyYXRlIHJlcHJlc2VudGF0aW9uIG9mXHJcbiAgICAvLyB3aGljaCBmZWF0dXJlcyBhcmUgcmVxdWlyZWQuXHJcbiAgICBjb25zdCBwaGV0RmVhdHVyZXMgPSBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzO1xyXG5cclxuICAgIC8vIE11bHRpcGxlIG9wdGlvbml6ZSBjYWxscyArIHNwcmVhZCBpbiBvbmUgaW5pdGlhbGl6YXRpb24gc2l0ZSBzbyB0aGF0IFR5cGVTY3JpcHQgaGFzIHRoZSBjb3JyZWN0IHR5cGUgZm9yIG5lc3RlZFxyXG4gICAgLy8gb3B0aW9ucyBpbW1lZGlhdGVseSwgYW5kIHdlIGRvbid0IG5lZWQgbXVsdGlwbGUgdmFyaWFibGVzIHRvIGFjaGlldmUgaXQuXHJcbiAgICBjb25zdCBvcHRpb25zID0ge1xyXG5cclxuICAgICAgLy8gUHV0IHRoZSBzcHJlYWQgZmlyc3Qgc28gdGhhdCBuZXN0ZWQgb3B0aW9ucycgZGVmYXVsdHMgd2lsbCBjb3JyZWN0bHkgb3ZlcnJpZGVcclxuICAgICAgLi4uKCBvcHRpb25pemU8UHJlZmVyZW5jZXNNb2RlbE9wdGlvbnMsIEVtcHR5U2VsZk9wdGlvbnMsIFBoZXRpb09iamVjdE9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgICAgLy8gcGhldC1pb1xyXG4gICAgICAgIHRhbmRlbTogVGFuZGVtLk9QVElPTkFMLFxyXG4gICAgICAgIHBoZXRpb1R5cGU6IFByZWZlcmVuY2VzTW9kZWwuUHJlZmVyZW5jZXNNb2RlbElPLFxyXG4gICAgICAgIHBoZXRpb0ZlYXR1cmVkOiB0cnVlLFxyXG4gICAgICAgIHBoZXRpb1N0YXRlOiBmYWxzZSxcclxuICAgICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZVxyXG4gICAgICB9LCBwcm92aWRlZE9wdGlvbnMgKSApLFxyXG4gICAgICBzaW11bGF0aW9uT3B0aW9uczogb3B0aW9uaXplPFNpbXVsYXRpb25QcmVmZXJlbmNlc09wdGlvbnMsIFNpbXVsYXRpb25QcmVmZXJlbmNlc09wdGlvbnMsIEJhc2VNb2RlbFR5cGU+KCkoIHtcclxuICAgICAgICB0YW5kZW1OYW1lOiAnc2ltdWxhdGlvbk1vZGVsJyxcclxuICAgICAgICBjdXN0b21QcmVmZXJlbmNlczogW11cclxuICAgICAgfSwgcHJvdmlkZWRPcHRpb25zLnNpbXVsYXRpb25PcHRpb25zICksXHJcbiAgICAgIHZpc3VhbE9wdGlvbnM6IG9wdGlvbml6ZTxWaXN1YWxQcmVmZXJlbmNlc09wdGlvbnMsIFZpc3VhbFByZWZlcmVuY2VzT3B0aW9ucywgQmFzZU1vZGVsVHlwZT4oKSgge1xyXG4gICAgICAgIHRhbmRlbU5hbWU6IFZJU1VBTF9NT0RFTF9UQU5ERU0sXHJcbiAgICAgICAgc3VwcG9ydHNQcm9qZWN0b3JNb2RlOiBmYWxzZSxcclxuICAgICAgICBzdXBwb3J0c0ludGVyYWN0aXZlSGlnaGxpZ2h0czogcGhldEZlYXR1cmVzLnN1cHBvcnRzSW50ZXJhY3RpdmVIaWdobGlnaHRzLFxyXG4gICAgICAgIGN1c3RvbVByZWZlcmVuY2VzOiBbXVxyXG4gICAgICB9LCBwcm92aWRlZE9wdGlvbnMudmlzdWFsT3B0aW9ucyApLFxyXG4gICAgICBhdWRpb09wdGlvbnM6IG9wdGlvbml6ZTxBdWRpb1ByZWZlcmVuY2VzT3B0aW9ucywgQXVkaW9QcmVmZXJlbmNlc09wdGlvbnMsIEJhc2VNb2RlbFR5cGU+KCkoIHtcclxuICAgICAgICB0YW5kZW1OYW1lOiBBVURJT19NT0RFTF9UQU5ERU0sXHJcbiAgICAgICAgc3VwcG9ydHNWb2ljaW5nOiBwaGV0RmVhdHVyZXMuc3VwcG9ydHNWb2ljaW5nLFxyXG4gICAgICAgIHN1cHBvcnRzU291bmQ6IHBoZXRGZWF0dXJlcy5zdXBwb3J0c1NvdW5kLFxyXG4gICAgICAgIHN1cHBvcnRzRXh0cmFTb3VuZDogcGhldEZlYXR1cmVzLnN1cHBvcnRzRXh0cmFTb3VuZCxcclxuICAgICAgICBjdXN0b21QcmVmZXJlbmNlczogW11cclxuICAgICAgfSwgcHJvdmlkZWRPcHRpb25zLmF1ZGlvT3B0aW9ucyApLFxyXG4gICAgICBpbnB1dE9wdGlvbnM6IG9wdGlvbml6ZTxJbnB1dFByZWZlcmVuY2VzT3B0aW9ucywgSW5wdXRQcmVmZXJlbmNlc09wdGlvbnMsIEJhc2VNb2RlbFR5cGU+KCkoIHtcclxuICAgICAgICB0YW5kZW1OYW1lOiBJTlBVVF9NT0RFTF9UQU5ERU0sXHJcbiAgICAgICAgc3VwcG9ydHNHZXN0dXJlQ29udHJvbDogcGhldEZlYXR1cmVzLnN1cHBvcnRzR2VzdHVyZUNvbnRyb2wsXHJcbiAgICAgICAgY3VzdG9tUHJlZmVyZW5jZXM6IFtdXHJcbiAgICAgIH0sIHByb3ZpZGVkT3B0aW9ucy5pbnB1dE9wdGlvbnMgKSxcclxuICAgICAgbG9jYWxpemF0aW9uT3B0aW9uczogb3B0aW9uaXplPExvY2FsaXphdGlvblByZWZlcmVuY2VzT3B0aW9ucywgTG9jYWxpemF0aW9uUHJlZmVyZW5jZXNPcHRpb25zLCBCYXNlTW9kZWxUeXBlPigpKCB7XHJcbiAgICAgICAgdGFuZGVtTmFtZTogJ2xvY2FsaXphdGlvbk1vZGVsJyxcclxuICAgICAgICBzdXBwb3J0c0R5bmFtaWNMb2NhbGVzOiAhIWxvY2FsZVByb3BlcnR5LnZhbGlkVmFsdWVzICYmIGxvY2FsZVByb3BlcnR5LnZhbGlkVmFsdWVzLmxlbmd0aCA+IDEgJiYgcGhldC5jaGlwcGVyLmFsbG93TG9jYWxlU3dpdGNoaW5nLFxyXG4gICAgICAgIGNoYXJhY3RlclNldHM6IFtdLFxyXG4gICAgICAgIGN1c3RvbVByZWZlcmVuY2VzOiBbXSxcclxuICAgICAgICBpbmNsdWRlTG9jYWxlUGFuZWw6IHRydWVcclxuICAgICAgfSwgcHJvdmlkZWRPcHRpb25zLmxvY2FsaXphdGlvbk9wdGlvbnMgKVxyXG4gICAgfTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuc2ltdWxhdGlvbk1vZGVsID0gb3B0aW9ucy5zaW11bGF0aW9uT3B0aW9ucztcclxuXHJcbiAgICBjb25zdCB2aXN1YWxUYW5kZW0gPSBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oIFZJU1VBTF9NT0RFTF9UQU5ERU0gKTtcclxuICAgIHRoaXMudmlzdWFsTW9kZWwgPSBtZXJnZSgge1xyXG4gICAgICBpbnRlcmFjdGl2ZUhpZ2hsaWdodHNFbmFibGVkUHJvcGVydHk6IG5ldyBCb29sZWFuUHJvcGVydHkoIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuaW50ZXJhY3RpdmVIaWdobGlnaHRzSW5pdGlhbGx5RW5hYmxlZCwge1xyXG4gICAgICAgIHRhbmRlbTogdmlzdWFsVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2ludGVyYWN0aXZlSGlnaGxpZ2h0c0VuYWJsZWRQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9TdGF0ZTogZmFsc2VcclxuICAgICAgfSApLFxyXG4gICAgICBjb2xvclByb2ZpbGVQcm9wZXJ0eTogY29sb3JQcm9maWxlUHJvcGVydHlcclxuICAgIH0sIG9wdGlvbnMudmlzdWFsT3B0aW9ucyApO1xyXG5cclxuICAgIC8vIEZvciBub3csIHRoZSBWb2ljaW5nIGZlYXR1cmUgaXMgb25seSBhdmFpbGFibGUgd2hlbiB3ZSBhcmUgcnVubmluZyBpbiB0aGUgRW5nbGlzaCBsb2NhbGUsIGFjY2Vzc2liaWxpdHlcclxuICAgIC8vIHN0cmluZ3MgYXJlIG5vdCBtYWRlIGF2YWlsYWJsZSBmb3IgdHJhbnNsYXRpb24uIFdoZW4gcnVubmluZyB3aXRoIGR5bmFtaWMgbG9jYWxlcywgdGhlIHZvaWNpbmcgZmVhdHVyZVxyXG4gICAgLy8gaXMgc3VwcG9ydGVkIGlmIEVuZ2xpc2ggaXMgYXZhaWxhYmxlLCBidXQgd2lsbCBiZSBkaXNhYmxlZCB1bnRpbCBFbmdsaXNoIGlzIHNlbGVjdGVkLlxyXG4gICAgY29uc3Qgc3VwcG9ydHNWb2ljaW5nID0gb3B0aW9ucy5hdWRpb09wdGlvbnMuc3VwcG9ydHNWb2ljaW5nICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTcGVlY2hTeW50aGVzaXNBbm5vdW5jZXIuaXNTcGVlY2hTeW50aGVzaXNTdXBwb3J0ZWQoKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSdW5uaW5nIHdpdGggZW5nbGlzaCBsb2NhbGUgT1IgYW4gZW52aXJvbm1lbnQgd2hlcmUgbG9jYWxlIHN3aXRjaGluZyBpcyBzdXBwb3J0ZWQgYW5kXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVuZ2xpc2ggaXMgb25lIG9mIHRoZSBhdmFpbGFibGUgbGFuZ3VhZ2VzLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaGV0LmNoaXBwZXIubG9jYWxlLnN0YXJ0c1dpdGgoICdlbicgKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIHBoZXQuY2hpcHBlci5hbGxvd0xvY2FsZVN3aXRjaGluZyAmJiBfLnNvbWUoIGxvY2FsZVByb3BlcnR5LnZhbGlkVmFsdWVzLCB2YWx1ZSA9PiB2YWx1ZS5zdGFydHNXaXRoKCAnZW4nICkgKSApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG5cclxuICAgIC8vIEF1ZGlvIGNhbiBiZSBkaXNhYmxlZCBleHBsaWNpdGx5IHZpYSBxdWVyeSBwYXJhbWV0ZXJcclxuICAgIGNvbnN0IGF1ZGlvRW5hYmxlZCA9IHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuYXVkaW8gIT09ICdkaXNhYmxlZCc7XHJcblxyXG4gICAgdGhpcy5hdWRpb01vZGVsID0ge1xyXG4gICAgICBzdXBwb3J0c1ZvaWNpbmc6IHN1cHBvcnRzVm9pY2luZyAmJiBhdWRpb0VuYWJsZWQsXHJcblxyXG4gICAgICBzdXBwb3J0c1NvdW5kOiBvcHRpb25zLmF1ZGlvT3B0aW9ucy5zdXBwb3J0c1NvdW5kICYmIGF1ZGlvRW5hYmxlZCxcclxuICAgICAgc3VwcG9ydHNFeHRyYVNvdW5kOiBvcHRpb25zLmF1ZGlvT3B0aW9ucy5zdXBwb3J0c0V4dHJhU291bmQgJiYgYXVkaW9FbmFibGVkLFxyXG5cclxuICAgICAgYXVkaW9FbmFibGVkUHJvcGVydHk6IGF1ZGlvTWFuYWdlci5hdWRpb0VuYWJsZWRQcm9wZXJ0eSxcclxuICAgICAgc291bmRFbmFibGVkUHJvcGVydHk6IHNvdW5kTWFuYWdlci5lbmFibGVkUHJvcGVydHksXHJcbiAgICAgIGV4dHJhU291bmRFbmFibGVkUHJvcGVydHk6IHNvdW5kTWFuYWdlci5leHRyYVNvdW5kRW5hYmxlZFByb3BlcnR5LFxyXG5cclxuICAgICAgdm9pY2luZ0VuYWJsZWRQcm9wZXJ0eTogdm9pY2luZ01hbmFnZXIuZW5hYmxlZFByb3BlcnR5IGFzIFByb3BlcnR5PGJvb2xlYW4+LFxyXG4gICAgICB2b2ljaW5nTWFpbldpbmRvd1ZvaWNpbmdFbmFibGVkUHJvcGVydHk6IHZvaWNpbmdNYW5hZ2VyLm1haW5XaW5kb3dWb2ljaW5nRW5hYmxlZFByb3BlcnR5LFxyXG4gICAgICB2b2ljaW5nT2JqZWN0UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5OiByZXNwb25zZUNvbGxlY3Rvci5vYmplY3RSZXNwb25zZXNFbmFibGVkUHJvcGVydHksXHJcbiAgICAgIHZvaWNpbmdDb250ZXh0UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5OiByZXNwb25zZUNvbGxlY3Rvci5jb250ZXh0UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5LFxyXG4gICAgICB2b2ljaW5nSGludFJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eTogcmVzcG9uc2VDb2xsZWN0b3IuaGludFJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eSxcclxuICAgICAgdm9pY2VQaXRjaFByb3BlcnR5OiB2b2ljaW5nTWFuYWdlci52b2ljZVBpdGNoUHJvcGVydHksXHJcbiAgICAgIHZvaWNlUmF0ZVByb3BlcnR5OiB2b2ljaW5nTWFuYWdlci52b2ljZVJhdGVQcm9wZXJ0eSxcclxuICAgICAgdm9pY2VQcm9wZXJ0eTogdm9pY2luZ01hbmFnZXIudm9pY2VQcm9wZXJ0eSxcclxuXHJcbiAgICAgIHRvb2xiYXJFbmFibGVkUHJvcGVydHk6IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUsIHtcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggQVVESU9fTU9ERUxfVEFOREVNICkuY3JlYXRlVGFuZGVtKCAndG9vbGJhckVuYWJsZWRQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9TdGF0ZTogZmFsc2VcclxuICAgICAgfSApLFxyXG5cclxuICAgICAgY3VzdG9tUHJlZmVyZW5jZXM6IG9wdGlvbnMuYXVkaW9PcHRpb25zLmN1c3RvbVByZWZlcmVuY2VzLFxyXG4gICAgICB0YW5kZW1OYW1lOiBvcHRpb25zLmF1ZGlvT3B0aW9ucy50YW5kZW1OYW1lXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGlucHV0VGFuZGVtID0gb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCBJTlBVVF9NT0RFTF9UQU5ERU0gKTtcclxuICAgIHRoaXMuaW5wdXRNb2RlbCA9IG1lcmdlKCB7XHJcbiAgICAgIGdlc3R1cmVDb250cm9sc0VuYWJsZWRQcm9wZXJ0eTogbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UsIHtcclxuICAgICAgICB0YW5kZW06IGlucHV0VGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2dlc3R1cmVDb250cm9sc0VuYWJsZWRQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9TdGF0ZTogZmFsc2VcclxuICAgICAgfSApXHJcbiAgICB9LCBvcHRpb25zLmlucHV0T3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMubG9jYWxpemF0aW9uTW9kZWwgPSBtZXJnZSgge1xyXG4gICAgICBsb2NhbGVQcm9wZXJ0eTogbG9jYWxlUHJvcGVydHksXHJcbiAgICAgIHJlZ2lvbkFuZEN1bHR1cmVQcm9wZXJ0eTogcmVnaW9uQW5kQ3VsdHVyZU1hbmFnZXIucmVnaW9uQW5kQ3VsdHVyZVByb3BlcnR5XHJcbiAgICB9LCBvcHRpb25zLmxvY2FsaXphdGlvbk9wdGlvbnMgKTtcclxuXHJcbiAgICBpZiAoIG9wdGlvbnMubG9jYWxpemF0aW9uT3B0aW9ucy5jaGFyYWN0ZXJTZXRzLmxlbmd0aCA+IDAgKSB7XHJcblxyXG4gICAgICAvLyBkZWZhdWx0IGlzIHRoZSBmaXJzdCBzZXRcclxuICAgICAgcmVnaW9uQW5kQ3VsdHVyZU1hbmFnZXIucmVnaW9uQW5kQ3VsdHVyZVByb3BlcnR5LnZhbHVlID0gb3B0aW9ucy5sb2NhbGl6YXRpb25PcHRpb25zLmNoYXJhY3RlclNldHNbIDAgXTtcclxuXHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHJlZ2lvbkFuZEN1bHR1cmVNYW5hZ2VyLnJlZ2lvbkFuZEN1bHR1cmVQcm9wZXJ0eS52YWx1ZSAhPT0gbnVsbCwgJ1dlIGhhdmUgYXQgbGVhc3Qgb25lIGRlc2NyaXB0b3IsIHNvIHJlZ2lvbkFuZEN1bHR1cmVQcm9wZXJ0eSBzaG91bGQgbm90IGJlIG51bGwuJyApO1xyXG4gICAgICB0aGlzLmxvY2FsaXphdGlvbk1vZGVsLnJlZ2lvbkFuZEN1bHR1cmVQcm9wZXJ0eSA9IHJlZ2lvbkFuZEN1bHR1cmVNYW5hZ2VyLnJlZ2lvbkFuZEN1bHR1cmVQcm9wZXJ0eTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgaWYgKCB0aGlzLmF1ZGlvTW9kZWwuc3VwcG9ydHNFeHRyYVNvdW5kICkge1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLmF1ZGlvTW9kZWwuc3VwcG9ydHNTb3VuZCwgJ3N1cHBvcnRzU291bmQgbXVzdCBiZSB0cnVlIHRvIGFsc28gc3VwcG9ydCBleHRyYVNvdW5kJyApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuYWRkUGhldGlvTGlua2VkRWxlbWVudHNGb3JNb2RlbCggb3B0aW9ucy50YW5kZW0sIHRoaXMuc2ltdWxhdGlvbk1vZGVsICk7XHJcblxyXG4gICAgdGhpcy5hZGRQaGV0aW9MaW5rZWRFbGVtZW50c0Zvck1vZGVsKCBvcHRpb25zLnRhbmRlbSwgdGhpcy52aXN1YWxNb2RlbCwgW1xyXG4gICAgICB7IHByb3BlcnR5OiB0aGlzLnZpc3VhbE1vZGVsLmNvbG9yUHJvZmlsZVByb3BlcnR5IH1cclxuICAgIF0gKTtcclxuXHJcbiAgICB0aGlzLmFkZFBoZXRpb0xpbmtlZEVsZW1lbnRzRm9yTW9kZWwoIG9wdGlvbnMudGFuZGVtLCB0aGlzLmF1ZGlvTW9kZWwsIFtcclxuICAgICAgeyBwcm9wZXJ0eTogdGhpcy5hdWRpb01vZGVsLmF1ZGlvRW5hYmxlZFByb3BlcnR5LCB0YW5kZW1OYW1lOiAnYXVkaW9FbmFibGVkUHJvcGVydHknIH0sXHJcbiAgICAgIHsgcHJvcGVydHk6IHRoaXMuYXVkaW9Nb2RlbC5zb3VuZEVuYWJsZWRQcm9wZXJ0eSwgdGFuZGVtTmFtZTogJ3NvdW5kRW5hYmxlZFByb3BlcnR5JyB9LFxyXG4gICAgICB7IHByb3BlcnR5OiB0aGlzLmF1ZGlvTW9kZWwuZXh0cmFTb3VuZEVuYWJsZWRQcm9wZXJ0eSwgdGFuZGVtTmFtZTogJ2V4dHJhU291bmRFbmFibGVkUHJvcGVydHknIH0sXHJcbiAgICAgIHsgcHJvcGVydHk6IHRoaXMuYXVkaW9Nb2RlbC52b2ljaW5nRW5hYmxlZFByb3BlcnR5LCB0YW5kZW1OYW1lOiAndm9pY2luZ0VuYWJsZWRQcm9wZXJ0eScgfSxcclxuICAgICAgeyBwcm9wZXJ0eTogdGhpcy5hdWRpb01vZGVsLnZvaWNpbmdNYWluV2luZG93Vm9pY2luZ0VuYWJsZWRQcm9wZXJ0eSwgdGFuZGVtTmFtZTogJ3ZvaWNpbmdNYWluV2luZG93Vm9pY2luZ0VuYWJsZWRQcm9wZXJ0eScgfSxcclxuICAgICAgeyBwcm9wZXJ0eTogdGhpcy5hdWRpb01vZGVsLnZvaWNpbmdPYmplY3RSZXNwb25zZXNFbmFibGVkUHJvcGVydHksIHRhbmRlbU5hbWU6ICd2b2ljaW5nT2JqZWN0UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5JyB9LFxyXG4gICAgICB7IHByb3BlcnR5OiB0aGlzLmF1ZGlvTW9kZWwudm9pY2luZ0NvbnRleHRSZXNwb25zZXNFbmFibGVkUHJvcGVydHksIHRhbmRlbU5hbWU6ICd2b2ljaW5nQ29udGV4dFJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eScgfSxcclxuICAgICAgeyBwcm9wZXJ0eTogdGhpcy5hdWRpb01vZGVsLnZvaWNpbmdIaW50UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5LCB0YW5kZW1OYW1lOiAndm9pY2luZ0hpbnRSZXNwb25zZXNFbmFibGVkUHJvcGVydHknIH0sXHJcbiAgICAgIHsgcHJvcGVydHk6IHRoaXMuYXVkaW9Nb2RlbC52b2ljZVBpdGNoUHJvcGVydHksIHRhbmRlbU5hbWU6ICd2b2ljZVBpdGNoUHJvcGVydHknIH0sXHJcbiAgICAgIHsgcHJvcGVydHk6IHRoaXMuYXVkaW9Nb2RlbC52b2ljZVJhdGVQcm9wZXJ0eSwgdGFuZGVtTmFtZTogJ3ZvaWNlUmF0ZVByb3BlcnR5JyB9XHJcbiAgICBdICk7XHJcbiAgICB0aGlzLmFkZFBoZXRpb0xpbmtlZEVsZW1lbnRzRm9yTW9kZWwoIG9wdGlvbnMudGFuZGVtLCB0aGlzLmlucHV0TW9kZWwgKTtcclxuICAgIHRoaXMuYWRkUGhldGlvTGlua2VkRWxlbWVudHNGb3JNb2RlbCggb3B0aW9ucy50YW5kZW0sIHRoaXMubG9jYWxpemF0aW9uTW9kZWwsIFtcclxuICAgICAgeyBwcm9wZXJ0eTogdGhpcy5sb2NhbGl6YXRpb25Nb2RlbC5sb2NhbGVQcm9wZXJ0eSwgdGFuZGVtTmFtZTogJ2xvY2FsZVByb3BlcnR5JyB9XHJcbiAgICBdICk7XHJcblxyXG4gICAgLy8gU2luY2Ugdm9pY2luZ01hbmFnZXIgaW4gU2NlbmVyeSBjYW4gbm90IHVzZSBpbml0aWFsaXplLWdsb2JhbHMsIHNldCB0aGUgaW5pdGlhbCB2YWx1ZSBmb3Igd2hldGhlciBWb2ljaW5nIGlzXHJcbiAgICAvLyBlbmFibGVkIGhlcmUgaW4gdGhlIFByZWZlcmVuY2VzTW9kZWwuXHJcbiAgICBpZiAoIHN1cHBvcnRzVm9pY2luZyApIHtcclxuICAgICAgdm9pY2luZ01hbmFnZXIuZW5hYmxlZFByb3BlcnR5LnZhbHVlID0gcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy52b2ljaW5nSW5pdGlhbGx5RW5hYmxlZDtcclxuXHJcbiAgICAgIC8vIFZvaWNpbmcgaXMgb25seSBhdmFpbGFibGUgaW4gdGhlICdlbicgbG9jYWxlIGN1cnJlbnRseS4gSWYgdGhlIGxvY2FsZSBpcyBjaGFuZ2VkIGF3YXkgZnJvbSBFbmdsaXNoLCBWb2ljaW5nIGlzXHJcbiAgICAgIC8vIGRpc2FibGVkLiBUaGUgbmV4dCB0aW1lIFZvaWNpbmcgcmV0dXJucyB0byAnZW4nLCBWb2ljaW5nIHdpbGwgYmUgZW5hYmxlZCBhZ2Fpbi5cclxuICAgICAgbGV0IHZvaWNpbmdEaXNhYmxlZEZyb21Mb2NhbGUgPSBmYWxzZTtcclxuICAgICAgbG9jYWxlUHJvcGVydHkubGluayggbG9jYWxlID0+IHtcclxuXHJcbiAgICAgICAgY29uc3QgZW5nbGlzaExvY2FsZSA9IGxvY2FsZS5zdGFydHNXaXRoKCAnZW4nICk7XHJcbiAgICAgICAgaWYgKCB2b2ljaW5nTWFuYWdlci5lbmFibGVkUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgICB2b2ljaW5nTWFuYWdlci5lbmFibGVkUHJvcGVydHkudmFsdWUgPSBlbmdsaXNoTG9jYWxlO1xyXG4gICAgICAgICAgdm9pY2luZ0Rpc2FibGVkRnJvbUxvY2FsZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCB2b2ljaW5nRGlzYWJsZWRGcm9tTG9jYWxlICYmIGVuZ2xpc2hMb2NhbGUgKSB7XHJcbiAgICAgICAgICB2b2ljaW5nTWFuYWdlci5lbmFibGVkUHJvcGVydHkudmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgdm9pY2luZ0Rpc2FibGVkRnJvbUxvY2FsZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG5cclxuICAgICAgLy8gVGhlIGRlZmF1bHQgdXR0ZXJhbmNlUXVldWUgd2lsbCBiZSB1c2VkIGZvciB2b2ljaW5nIG9mIHNpbXVsYXRpb24gY29tcG9uZW50cywgYW5kIGl0IGlzIGVuYWJsZWQgd2hlbiB0aGVcclxuICAgICAgLy8gdm9pY2luZ01hbmFnZXIgaXMgZnVsbHkgZW5hYmxlZCAodm9pY2luZ01hbmFnZXIgaXMgZW5hYmxlZCBhbmQgdGhlIHZvaWNpbmcgaXMgZW5hYmxlZCBmb3IgdGhlIFwibWFpbiB3aW5kb3dcIlxyXG4gICAgICAvLyBzaW0gc2NyZWVucylcclxuICAgICAgdm9pY2luZ01hbmFnZXIuZW5hYmxlZFByb3BlcnR5LmxpbmsoIGVuYWJsZWQgPT4ge1xyXG4gICAgICAgIHZvaWNpbmdVdHRlcmFuY2VRdWV1ZS5lbmFibGVkID0gZW5hYmxlZDtcclxuICAgICAgICAhZW5hYmxlZCAmJiB2b2ljaW5nVXR0ZXJhbmNlUXVldWUuY2xlYXIoKTtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgLy8gSWYgaW5pdGlhbGx5IGVuYWJsZWQsIHRoZW4gYXBwbHkgYWxsIHJlc3BvbnNlcyBvbiBzdGFydHVwLCBjYW4gKGFuZCBzaG91bGQpIGJlIG92ZXJ3cml0dGVuIGJ5IFByZWZlcmVuY2VzU3RvcmFnZS5cclxuICAgICAgaWYgKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnZvaWNpbmdJbml0aWFsbHlFbmFibGVkICkge1xyXG4gICAgICAgIHJlc3BvbnNlQ29sbGVjdG9yLm9iamVjdFJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eS52YWx1ZSA9IHRydWU7XHJcbiAgICAgICAgcmVzcG9uc2VDb2xsZWN0b3IuY29udGV4dFJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eS52YWx1ZSA9IHRydWU7XHJcbiAgICAgICAgcmVzcG9uc2VDb2xsZWN0b3IuaGludFJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eS52YWx1ZSA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIFNldCB0aGUgZmlyc3Qgdm9pY2UgYWNjb3JkaW5nIHRvIFBoRVQncyBwcmVmZXJyZWQgZW5nbGlzaCB2b2ljZXNcclxuICAgICAgICBjb25zdCB2b2ljZXNNdWx0aWxpbmsgPSBNdWx0aWxpbmsubXVsdGlsaW5rKFxyXG4gICAgICAgICAgWyB2b2ljaW5nTWFuYWdlci52b2ljZXNQcm9wZXJ0eSwgdm9pY2luZ01hbmFnZXIuaXNJbml0aWFsaXplZFByb3BlcnR5IF0sXHJcbiAgICAgICAgICAoIHZvaWNlcywgaW5pdGlhbGl6ZWQgKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICggaW5pdGlhbGl6ZWQgJiYgdm9pY2VzLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgICAgICAgdm9pY2luZ01hbmFnZXIudm9pY2VQcm9wZXJ0eS52YWx1ZSA9IHZvaWNpbmdNYW5hZ2VyLmdldEVuZ2xpc2hQcmlvcml0aXplZFZvaWNlcygpWyAwIF07XHJcbiAgICAgICAgICAgICAgTXVsdGlsaW5rLnVubXVsdGlsaW5rKCB2b2ljZXNNdWx0aWxpbmsgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMucHJpbnRWb2ljaW5nUmVzcG9uc2VzICkge1xyXG4gICAgICB2b2ljaW5nTWFuYWdlci5zdGFydFNwZWFraW5nRW1pdHRlci5hZGRMaXN0ZW5lciggdGV4dCA9PiBjb25zb2xlLmxvZyggdGV4dCApICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5yZWdpc3RlclByZWZlcmVuY2VzU3RvcmFnZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHVwIHByZWZlcmVuY2VzU3RvcmFnZSBmb3Igc3VwcG9ydGVkIFByZWZlcmVuY2VzUHJvcGVydGllcy4gRG9uJ3QgaW5jbHVkZSBhbGwtc291bmQgYW5kIGFsbC1hdWRpbyBjb250cm9sc1xyXG4gICAqIGJlY2F1c2UgdGhhdCBmZWVsIHRvbyBnbG9iYWwgdG8gYXV0b21hdGljYWxseSB0YWtlIHRoZSBsYXN0IHZhbHVlLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVnaXN0ZXJQcmVmZXJlbmNlc1N0b3JhZ2UoKTogdm9pZCB7XHJcblxyXG4gICAgaWYgKCB0aGlzLnZpc3VhbE1vZGVsLnN1cHBvcnRzSW50ZXJhY3RpdmVIaWdobGlnaHRzICkge1xyXG4gICAgICBQcmVmZXJlbmNlc1N0b3JhZ2UucmVnaXN0ZXIoIHRoaXMudmlzdWFsTW9kZWwuaW50ZXJhY3RpdmVIaWdobGlnaHRzRW5hYmxlZFByb3BlcnR5LCAnaW50ZXJhY3RpdmVIaWdobGlnaHRzRW5hYmxlZFByb3BlcnR5JyApO1xyXG4gICAgfVxyXG4gICAgaWYgKCB0aGlzLmF1ZGlvTW9kZWwuc3VwcG9ydHNWb2ljaW5nICkge1xyXG5cclxuICAgICAgLy8gUmVnaXN0ZXIgdGhlc2UgdG8gYmUgc3RvcmVkIHdoZW4gUHJlZmVyZW5jZXNTdG9yYWdlIGlzIGVuYWJsZWQuXHJcbiAgICAgIFByZWZlcmVuY2VzU3RvcmFnZS5yZWdpc3RlciggdGhpcy5hdWRpb01vZGVsLnZvaWNpbmdPYmplY3RSZXNwb25zZXNFbmFibGVkUHJvcGVydHksICdvYmplY3RSZXNwb25zZXNFbmFibGVkUHJvcGVydHknICk7XHJcbiAgICAgIFByZWZlcmVuY2VzU3RvcmFnZS5yZWdpc3RlciggdGhpcy5hdWRpb01vZGVsLnZvaWNpbmdDb250ZXh0UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5LCAnY29udGV4dFJlc3BvbnNlc0VuYWJsZWRQcm9wZXJ0eScgKTtcclxuICAgICAgUHJlZmVyZW5jZXNTdG9yYWdlLnJlZ2lzdGVyKCB0aGlzLmF1ZGlvTW9kZWwudm9pY2luZ0hpbnRSZXNwb25zZXNFbmFibGVkUHJvcGVydHksICdoaW50UmVzcG9uc2VzRW5hYmxlZFByb3BlcnR5JyApO1xyXG4gICAgICBQcmVmZXJlbmNlc1N0b3JhZ2UucmVnaXN0ZXIoIHRoaXMuYXVkaW9Nb2RlbC52b2ljZVJhdGVQcm9wZXJ0eSwgJ3ZvaWNlUmF0ZVByb3BlcnR5JyApO1xyXG4gICAgICBQcmVmZXJlbmNlc1N0b3JhZ2UucmVnaXN0ZXIoIHRoaXMuYXVkaW9Nb2RlbC52b2ljZVBpdGNoUHJvcGVydHksICd2b2ljZVBpdGNoUHJvcGVydHknICk7XHJcbiAgICB9XHJcbiAgICBpZiAoIHRoaXMuYXVkaW9Nb2RlbC5zdXBwb3J0c0V4dHJhU291bmQgKSB7XHJcbiAgICAgIFByZWZlcmVuY2VzU3RvcmFnZS5yZWdpc3RlciggdGhpcy5hdWRpb01vZGVsLmV4dHJhU291bmRFbmFibGVkUHJvcGVydHksICdleHRyYVNvdW5kRW5hYmxlZFByb3BlcnR5JyApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICggdGhpcy5pbnB1dE1vZGVsLnN1cHBvcnRzR2VzdHVyZUNvbnRyb2wgKSB7XHJcbiAgICAgIFByZWZlcmVuY2VzU3RvcmFnZS5yZWdpc3RlciggdGhpcy5pbnB1dE1vZGVsLmdlc3R1cmVDb250cm9sc0VuYWJsZWRQcm9wZXJ0eSwgJ2dlc3R1cmVDb250cm9sc0VuYWJsZWRQcm9wZXJ0eScgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgYWRkUGhldGlvTGlua2VkRWxlbWVudHNGb3JNb2RlbCggcGFyZW50VGFuZGVtOiBUYW5kZW0sIGZlYXR1cmVNb2RlbDogRmVhdHVyZU1vZGVsLCBhZGRpdGlvbmFsUHJvcGVydGllczogQXJyYXk8TW9kZWxQcm9wZXJ0eUxpbmthYmxlPiA9IFtdICk6IHZvaWQge1xyXG4gICAgY29uc3QgdGFuZGVtID0gcGFyZW50VGFuZGVtLmNyZWF0ZVRhbmRlbSggZmVhdHVyZU1vZGVsLnRhbmRlbU5hbWUgKTtcclxuICAgIGNvbnN0IHByb3BlcnRpZXNUb0xpbmsgPSBhZGRpdGlvbmFsUHJvcGVydGllcztcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGZlYXR1cmVNb2RlbC5jdXN0b21QcmVmZXJlbmNlcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgY3VzdG9tUHJlZmVyZW5jZSA9IGZlYXR1cmVNb2RlbC5jdXN0b21QcmVmZXJlbmNlc1sgaSBdO1xyXG4gICAgICBjdXN0b21QcmVmZXJlbmNlLm1vZGVsTGlua2FibGVzICYmIHByb3BlcnRpZXNUb0xpbmsucHVzaCggLi4uY3VzdG9tUHJlZmVyZW5jZS5tb2RlbExpbmthYmxlcyApO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAoIGxldCBqID0gMDsgaiA8IHByb3BlcnRpZXNUb0xpbmsubGVuZ3RoOyBqKysgKSB7XHJcbiAgICAgIGNvbnN0IG1vZGVsUHJvcGVydHlPYmplY3QgPSBwcm9wZXJ0aWVzVG9MaW5rWyBqIF07XHJcbiAgICAgIGNvbnN0IHRhbmRlbU5hbWUgPSBtb2RlbFByb3BlcnR5T2JqZWN0LnRhbmRlbU5hbWUgfHwgbW9kZWxQcm9wZXJ0eU9iamVjdC5wcm9wZXJ0eS50YW5kZW0ubmFtZTtcclxuICAgICAgdGhpcy5hZGRMaW5rZWRFbGVtZW50KCBtb2RlbFByb3BlcnR5T2JqZWN0LnByb3BlcnR5LCB7IHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggdGFuZGVtTmFtZSApIH0gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBwcmVmZXJlbmNlTW9kZWxIYXNDdXN0b20oIHByZWZlcmVuY2VNb2RlbDogUmVxdWlyZWQ8Q3VzdG9tUHJlZmVyZW5jZXNPcHRpb25zPiApOiBib29sZWFuIHtcclxuICAgIHJldHVybiBwcmVmZXJlbmNlTW9kZWwuY3VzdG9tUHJlZmVyZW5jZXMubGVuZ3RoID4gMDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgU2ltdWxhdGlvbk1vZGVsIHN1cHBvcnRzIGFueSBwcmVmZXJlbmNlcyB0aGF0IGNhbiBiZSBjaGFuZ2VkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdXBwb3J0c1NpbXVsYXRpb25QcmVmZXJlbmNlcygpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnByZWZlcmVuY2VNb2RlbEhhc0N1c3RvbSggdGhpcy5zaW11bGF0aW9uTW9kZWwgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgVmlzdWFsTW9kZWwgaGFzIGFueSBwcmVmZXJlbmNlcyB0aGF0IGNhbiBiZSBjaGFuZ2VkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdXBwb3J0c1Zpc3VhbFByZWZlcmVuY2VzKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMudmlzdWFsTW9kZWwuc3VwcG9ydHNJbnRlcmFjdGl2ZUhpZ2hsaWdodHMgfHxcclxuICAgICAgICAgICB0aGlzLnZpc3VhbE1vZGVsLnN1cHBvcnRzUHJvamVjdG9yTW9kZSB8fFxyXG4gICAgICAgICAgIHRoaXMucHJlZmVyZW5jZU1vZGVsSGFzQ3VzdG9tKCB0aGlzLnZpc3VhbE1vZGVsICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIEF1ZGlvTW9kZWwgaGFzIGFueSBwcmVmZXJlbmNlcyB0aGF0IGNhbiBiZSBjaGFuZ2VkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdXBwb3J0c0F1ZGlvUHJlZmVyZW5jZXMoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5hdWRpb01vZGVsLnN1cHBvcnRzU291bmQgfHxcclxuICAgICAgICAgICB0aGlzLmF1ZGlvTW9kZWwuc3VwcG9ydHNFeHRyYVNvdW5kIHx8XHJcbiAgICAgICAgICAgdGhpcy5hdWRpb01vZGVsLnN1cHBvcnRzVm9pY2luZyB8fFxyXG4gICAgICAgICAgIHRoaXMucHJlZmVyZW5jZU1vZGVsSGFzQ3VzdG9tKCB0aGlzLmF1ZGlvTW9kZWwgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgSW5wdXRNb2RlbCBoYXMgYW55IHByZWZlcmVuY2VzIHRoYXQgY2FuIGJlIGNoYW5nZWQuXHJcbiAgICovXHJcbiAgcHVibGljIHN1cHBvcnRzSW5wdXRQcmVmZXJlbmNlcygpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmlucHV0TW9kZWwuc3VwcG9ydHNHZXN0dXJlQ29udHJvbCB8fCB0aGlzLnByZWZlcmVuY2VNb2RlbEhhc0N1c3RvbSggdGhpcy5pbnB1dE1vZGVsICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIExvY2FsaXphdGlvbk1vZGVsIGhhcyBhbnkgcHJlZmVyZW5jZXMgdGhhdCBjYW4gYmUgY2hhbmdlZC5cclxuICAgKi9cclxuICBwdWJsaWMgc3VwcG9ydHNMb2NhbGl6YXRpb25QcmVmZXJlbmNlcygpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmxvY2FsaXphdGlvbk1vZGVsLnN1cHBvcnRzRHluYW1pY0xvY2FsZXMgfHxcclxuICAgICAgICAgICB0aGlzLmxvY2FsaXphdGlvbk1vZGVsLmNoYXJhY3RlclNldHMubGVuZ3RoID4gMCB8fFxyXG4gICAgICAgICAgIHRoaXMucHJlZmVyZW5jZU1vZGVsSGFzQ3VzdG9tKCB0aGlzLmxvY2FsaXphdGlvbk1vZGVsICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBtb2RlbCBzdXBwb3J0cyBhbnkgY29udHJvbGxhYmxlIHByZWZlcmVuY2VzIGZvciB0aGUgZGlhbG9nLiBSZXR1cm5zIGZhbHNlIHdoZW4gdGhlIGRpYWxvZ1xyXG4gICAqIHdvdWxkIGhhdmUgbm90aGluZyB0byBkaXNwbGF5LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzaG91bGRTaG93RGlhbG9nKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc3VwcG9ydHNTaW11bGF0aW9uUHJlZmVyZW5jZXMoKSB8fCB0aGlzLnN1cHBvcnRzVmlzdWFsUHJlZmVyZW5jZXMoKSB8fFxyXG4gICAgICAgICAgIHRoaXMuc3VwcG9ydHNJbnB1dFByZWZlcmVuY2VzKCkgfHwgdGhpcy5zdXBwb3J0c0xvY2FsaXphdGlvblByZWZlcmVuY2VzKCkgfHxcclxuICAgICAgICAgICB0aGlzLnN1cHBvcnRzQXVkaW9QcmVmZXJlbmNlcygpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBQcmVmZXJlbmNlc01vZGVsSU8gPSBuZXcgSU9UeXBlKCAnUHJlZmVyZW5jZXNNb2RlbElPJywge1xyXG4gICAgdmFsdWVUeXBlOiBQcmVmZXJlbmNlc01vZGVsLFxyXG5cclxuICAgIHRvU3RhdGVPYmplY3Q6ICggcHJlZmVyZW5jZXNNb2RlbDogUHJlZmVyZW5jZXNNb2RlbCApID0+IHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdXBwb3J0c1Byb2plY3Rvck1vZGU6IHByZWZlcmVuY2VzTW9kZWwudmlzdWFsTW9kZWwuc3VwcG9ydHNQcm9qZWN0b3JNb2RlLFxyXG4gICAgICAgIHN1cHBvcnRzSW50ZXJhY3RpdmVIaWdobGlnaHRzOiBwcmVmZXJlbmNlc01vZGVsLnZpc3VhbE1vZGVsLnN1cHBvcnRzSW50ZXJhY3RpdmVIaWdobGlnaHRzLFxyXG4gICAgICAgIHN1cHBvcnRzVm9pY2luZzogcHJlZmVyZW5jZXNNb2RlbC5hdWRpb01vZGVsLnN1cHBvcnRzVm9pY2luZyxcclxuICAgICAgICBzdXBwb3J0c1NvdW5kOiBwcmVmZXJlbmNlc01vZGVsLmF1ZGlvTW9kZWwuc3VwcG9ydHNTb3VuZCxcclxuICAgICAgICBzdXBwb3J0c0V4dHJhU291bmQ6IHByZWZlcmVuY2VzTW9kZWwuYXVkaW9Nb2RlbC5zdXBwb3J0c0V4dHJhU291bmQsXHJcbiAgICAgICAgc3VwcG9ydHNHZXN0dXJlQ29udHJvbDogcHJlZmVyZW5jZXNNb2RlbC5pbnB1dE1vZGVsLnN1cHBvcnRzR2VzdHVyZUNvbnRyb2wsXHJcbiAgICAgICAgc3VwcG9ydHNEeW5hbWljTG9jYWxlczogcHJlZmVyZW5jZXNNb2RlbC5sb2NhbGl6YXRpb25Nb2RlbC5zdXBwb3J0c0R5bmFtaWNMb2NhbGVzLFxyXG5cclxuICAgICAgICAvLyBNZXRob2QtYmFzZWRcclxuICAgICAgICBzdXBwb3J0c0F1ZGlvUHJlZmVyZW5jZXM6IHByZWZlcmVuY2VzTW9kZWwuc3VwcG9ydHNBdWRpb1ByZWZlcmVuY2VzKCksXHJcbiAgICAgICAgc3VwcG9ydHNJbnB1dFByZWZlcmVuY2VzOiBwcmVmZXJlbmNlc01vZGVsLnN1cHBvcnRzSW5wdXRQcmVmZXJlbmNlcygpLFxyXG4gICAgICAgIHN1cHBvcnRzTG9jYWxpemF0aW9uUHJlZmVyZW5jZXM6IHByZWZlcmVuY2VzTW9kZWwuc3VwcG9ydHNMb2NhbGl6YXRpb25QcmVmZXJlbmNlcygpLFxyXG4gICAgICAgIHN1cHBvcnRzU2ltdWxhdGlvblByZWZlcmVuY2VzOiBwcmVmZXJlbmNlc01vZGVsLnN1cHBvcnRzU2ltdWxhdGlvblByZWZlcmVuY2VzKCksXHJcbiAgICAgICAgc3VwcG9ydHNWaXN1YWxQcmVmZXJlbmNlczogcHJlZmVyZW5jZXNNb2RlbC5zdXBwb3J0c1Zpc3VhbFByZWZlcmVuY2VzKClcclxuICAgICAgfTtcclxuICAgIH0sXHJcbiAgICBzdGF0ZVNjaGVtYToge1xyXG4gICAgICBzdXBwb3J0c1Byb2plY3Rvck1vZGU6IEJvb2xlYW5JTyxcclxuICAgICAgc3VwcG9ydHNJbnRlcmFjdGl2ZUhpZ2hsaWdodHM6IEJvb2xlYW5JTyxcclxuICAgICAgc3VwcG9ydHNWb2ljaW5nOiBCb29sZWFuSU8sXHJcbiAgICAgIHN1cHBvcnRzU291bmQ6IEJvb2xlYW5JTyxcclxuICAgICAgc3VwcG9ydHNFeHRyYVNvdW5kOiBCb29sZWFuSU8sXHJcbiAgICAgIHN1cHBvcnRzR2VzdHVyZUNvbnRyb2w6IEJvb2xlYW5JTyxcclxuICAgICAgc3VwcG9ydHNEeW5hbWljTG9jYWxlczogQm9vbGVhbklPLFxyXG5cclxuICAgICAgLy8gTWV0aG9kLWJhc2VkXHJcbiAgICAgIHN1cHBvcnRzQXVkaW9QcmVmZXJlbmNlczogQm9vbGVhbklPLFxyXG4gICAgICBzdXBwb3J0c0lucHV0UHJlZmVyZW5jZXM6IEJvb2xlYW5JTyxcclxuICAgICAgc3VwcG9ydHNMb2NhbGl6YXRpb25QcmVmZXJlbmNlczogQm9vbGVhbklPLFxyXG4gICAgICBzdXBwb3J0c1NpbXVsYXRpb25QcmVmZXJlbmNlczogQm9vbGVhbklPLFxyXG4gICAgICBzdXBwb3J0c1Zpc3VhbFByZWZlcmVuY2VzOiBCb29sZWFuSU9cclxuICAgIH1cclxuICB9ICk7XHJcbn1cclxuXHJcbmpvaXN0LnJlZ2lzdGVyKCAnUHJlZmVyZW5jZXNNb2RlbCcsIFByZWZlcmVuY2VzTW9kZWwgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFNBQVNBLG9CQUFvQixFQUFRQyxjQUFjLEVBQUVDLHFCQUFxQixRQUFRLGdDQUFnQztBQUNsSCxPQUFPQyxpQkFBaUIsTUFBTSxrREFBa0Q7QUFDaEYsT0FBT0MsZUFBZSxNQUFNLHFDQUFxQztBQUNqRSxPQUFPQyxLQUFLLE1BQU0sYUFBYTtBQUMvQixPQUFPQyxrQkFBa0IsTUFBTSx5QkFBeUI7QUFDeEQsT0FBT0MsWUFBWSxNQUFNLG1DQUFtQztBQUM1RCxPQUFPQyxZQUFZLE1BQU0sb0JBQW9CO0FBRzdDLE9BQU9DLFlBQVksTUFBK0Isb0NBQW9DO0FBQ3RGLE9BQU9DLFNBQVMsTUFBNEIsb0NBQW9DO0FBQ2hGLE9BQU9DLHVCQUF1QixNQUFNLDhCQUE4QjtBQUNsRSxPQUFPQyx3QkFBd0IsTUFBTSx5REFBeUQ7QUFDOUYsT0FBT0MsTUFBTSxNQUFNLDhCQUE4QjtBQUNqRCxPQUFPQyxjQUFjLE1BQWtCLDJCQUEyQjtBQUNsRSxPQUFPQyxLQUFLLE1BQU0sZ0NBQWdDO0FBRWxELE9BQU9DLE1BQU0sTUFBTSxvQ0FBb0M7QUFDdkQsT0FBT0MsU0FBUyxNQUFNLHVDQUF1QztBQUU3RCxPQUFPQyxTQUFTLE1BQU0sK0JBQStCO0FBb0JyRCxNQUFNQyxrQkFBa0IsR0FBRyxZQUFZO0FBQ3ZDLE1BQU1DLG1CQUFtQixHQUFHLGFBQWE7QUFDekMsTUFBTUMsa0JBQWtCLEdBQUcsWUFBWTs7QUFFdkM7QUFDQTs7QUFFQTtBQXFFQTtBQUNBO0FBTUE7QUFHQTtBQVlBO0FBNkNBLGVBQWUsTUFBTUMsZ0JBQWdCLFNBQVNiLFlBQVksQ0FBQztFQU9sRGMsV0FBV0EsQ0FBRUMsZUFBd0MsR0FBRyxDQUFDLENBQUMsRUFBRztJQUVsRTtJQUNBO0lBQ0E7SUFDQSxNQUFNQyxZQUFZLEdBQUdDLElBQUksQ0FBQ0MsT0FBTyxDQUFDQyxlQUFlOztJQUVqRDtJQUNBO0lBQ0EsTUFBTUMsT0FBTyxHQUFHO01BRWQ7TUFDQSxHQUFLbkIsU0FBUyxDQUFpRSxDQUFDLENBQUU7UUFFaEY7UUFDQW9CLE1BQU0sRUFBRWpCLE1BQU0sQ0FBQ2tCLFFBQVE7UUFDdkJDLFVBQVUsRUFBRVYsZ0JBQWdCLENBQUNXLGtCQUFrQjtRQUMvQ0MsY0FBYyxFQUFFLElBQUk7UUFDcEJDLFdBQVcsRUFBRSxLQUFLO1FBQ2xCQyxjQUFjLEVBQUU7TUFDbEIsQ0FBQyxFQUFFWixlQUFnQixDQUFHO01BQ3RCYSxpQkFBaUIsRUFBRTNCLFNBQVMsQ0FBNEUsQ0FBQyxDQUFFO1FBQ3pHNEIsVUFBVSxFQUFFLGlCQUFpQjtRQUM3QkMsaUJBQWlCLEVBQUU7TUFDckIsQ0FBQyxFQUFFZixlQUFlLENBQUNhLGlCQUFrQixDQUFDO01BQ3RDRyxhQUFhLEVBQUU5QixTQUFTLENBQW9FLENBQUMsQ0FBRTtRQUM3RjRCLFVBQVUsRUFBRWxCLG1CQUFtQjtRQUMvQnFCLHFCQUFxQixFQUFFLEtBQUs7UUFDNUJDLDZCQUE2QixFQUFFakIsWUFBWSxDQUFDaUIsNkJBQTZCO1FBQ3pFSCxpQkFBaUIsRUFBRTtNQUNyQixDQUFDLEVBQUVmLGVBQWUsQ0FBQ2dCLGFBQWMsQ0FBQztNQUNsQ0csWUFBWSxFQUFFakMsU0FBUyxDQUFrRSxDQUFDLENBQUU7UUFDMUY0QixVQUFVLEVBQUVuQixrQkFBa0I7UUFDOUJ5QixlQUFlLEVBQUVuQixZQUFZLENBQUNtQixlQUFlO1FBQzdDQyxhQUFhLEVBQUVwQixZQUFZLENBQUNvQixhQUFhO1FBQ3pDQyxrQkFBa0IsRUFBRXJCLFlBQVksQ0FBQ3FCLGtCQUFrQjtRQUNuRFAsaUJBQWlCLEVBQUU7TUFDckIsQ0FBQyxFQUFFZixlQUFlLENBQUNtQixZQUFhLENBQUM7TUFDakNJLFlBQVksRUFBRXJDLFNBQVMsQ0FBa0UsQ0FBQyxDQUFFO1FBQzFGNEIsVUFBVSxFQUFFakIsa0JBQWtCO1FBQzlCMkIsc0JBQXNCLEVBQUV2QixZQUFZLENBQUN1QixzQkFBc0I7UUFDM0RULGlCQUFpQixFQUFFO01BQ3JCLENBQUMsRUFBRWYsZUFBZSxDQUFDdUIsWUFBYSxDQUFDO01BQ2pDRSxtQkFBbUIsRUFBRXZDLFNBQVMsQ0FBZ0YsQ0FBQyxDQUFFO1FBQy9HNEIsVUFBVSxFQUFFLG1CQUFtQjtRQUMvQlksc0JBQXNCLEVBQUUsQ0FBQyxDQUFDcEMsY0FBYyxDQUFDcUMsV0FBVyxJQUFJckMsY0FBYyxDQUFDcUMsV0FBVyxDQUFDQyxNQUFNLEdBQUcsQ0FBQyxJQUFJMUIsSUFBSSxDQUFDQyxPQUFPLENBQUMwQixvQkFBb0I7UUFDbElDLGFBQWEsRUFBRSxFQUFFO1FBQ2pCZixpQkFBaUIsRUFBRSxFQUFFO1FBQ3JCZ0Isa0JBQWtCLEVBQUU7TUFDdEIsQ0FBQyxFQUFFL0IsZUFBZSxDQUFDeUIsbUJBQW9CO0lBQ3pDLENBQUM7SUFFRCxLQUFLLENBQUVwQixPQUFRLENBQUM7SUFFaEIsSUFBSSxDQUFDMkIsZUFBZSxHQUFHM0IsT0FBTyxDQUFDUSxpQkFBaUI7SUFFaEQsTUFBTW9CLFlBQVksR0FBRzVCLE9BQU8sQ0FBQ0MsTUFBTSxDQUFDNEIsWUFBWSxDQUFFdEMsbUJBQW9CLENBQUM7SUFDdkUsSUFBSSxDQUFDdUMsV0FBVyxHQUFHNUMsS0FBSyxDQUFFO01BQ3hCNkMsb0NBQW9DLEVBQUUsSUFBSXhELGVBQWUsQ0FBRXNCLElBQUksQ0FBQ0MsT0FBTyxDQUFDQyxlQUFlLENBQUNpQyxxQ0FBcUMsRUFBRTtRQUM3SC9CLE1BQU0sRUFBRTJCLFlBQVksQ0FBQ0MsWUFBWSxDQUFFLHNDQUF1QyxDQUFDO1FBQzNFdkIsV0FBVyxFQUFFO01BQ2YsQ0FBRSxDQUFDO01BQ0huQyxvQkFBb0IsRUFBRUE7SUFDeEIsQ0FBQyxFQUFFNkIsT0FBTyxDQUFDVyxhQUFjLENBQUM7O0lBRTFCO0lBQ0E7SUFDQTtJQUNBLE1BQU1JLGVBQWUsR0FBR2YsT0FBTyxDQUFDYyxZQUFZLENBQUNDLGVBQWUsSUFDcENoQyx3QkFBd0IsQ0FBQ2tELDBCQUEwQixDQUFDLENBQUM7SUFFbkQ7SUFDQTtJQUNBcEMsSUFBSSxDQUFDQyxPQUFPLENBQUNvQyxNQUFNLENBQUNDLFVBQVUsQ0FBRSxJQUFLLENBQUMsSUFDcEN0QyxJQUFJLENBQUNDLE9BQU8sQ0FBQzBCLG9CQUFvQixJQUFJWSxDQUFDLENBQUNDLElBQUksQ0FBRXBELGNBQWMsQ0FBQ3FDLFdBQVcsRUFBRWdCLEtBQUssSUFBSUEsS0FBSyxDQUFDSCxVQUFVLENBQUUsSUFBSyxDQUFFLENBQUcsQ0FDakg7O0lBRXpCO0lBQ0EsTUFBTUksWUFBWSxHQUFHMUMsSUFBSSxDQUFDQyxPQUFPLENBQUNDLGVBQWUsQ0FBQ3lDLEtBQUssS0FBSyxVQUFVO0lBRXRFLElBQUksQ0FBQ0MsVUFBVSxHQUFHO01BQ2hCMUIsZUFBZSxFQUFFQSxlQUFlLElBQUl3QixZQUFZO01BRWhEdkIsYUFBYSxFQUFFaEIsT0FBTyxDQUFDYyxZQUFZLENBQUNFLGFBQWEsSUFBSXVCLFlBQVk7TUFDakV0QixrQkFBa0IsRUFBRWpCLE9BQU8sQ0FBQ2MsWUFBWSxDQUFDRyxrQkFBa0IsSUFBSXNCLFlBQVk7TUFFM0VHLG9CQUFvQixFQUFFL0QsWUFBWSxDQUFDK0Qsb0JBQW9CO01BQ3ZEQyxvQkFBb0IsRUFBRWpFLFlBQVksQ0FBQ2tFLGVBQWU7TUFDbERDLHlCQUF5QixFQUFFbkUsWUFBWSxDQUFDbUUseUJBQXlCO01BRWpFQyxzQkFBc0IsRUFBRTFFLGNBQWMsQ0FBQ3dFLGVBQW9DO01BQzNFRyx1Q0FBdUMsRUFBRTNFLGNBQWMsQ0FBQzRFLGdDQUFnQztNQUN4RkMscUNBQXFDLEVBQUUzRSxpQkFBaUIsQ0FBQzRFLDhCQUE4QjtNQUN2RkMsc0NBQXNDLEVBQUU3RSxpQkFBaUIsQ0FBQzhFLCtCQUErQjtNQUN6RkMsbUNBQW1DLEVBQUUvRSxpQkFBaUIsQ0FBQ2dGLDRCQUE0QjtNQUNuRkMsa0JBQWtCLEVBQUVuRixjQUFjLENBQUNtRixrQkFBa0I7TUFDckRDLGlCQUFpQixFQUFFcEYsY0FBYyxDQUFDb0YsaUJBQWlCO01BQ25EQyxhQUFhLEVBQUVyRixjQUFjLENBQUNxRixhQUFhO01BRTNDQyxzQkFBc0IsRUFBRSxJQUFJbkYsZUFBZSxDQUFFLElBQUksRUFBRTtRQUNqRDBCLE1BQU0sRUFBRUQsT0FBTyxDQUFDQyxNQUFNLENBQUM0QixZQUFZLENBQUV2QyxrQkFBbUIsQ0FBQyxDQUFDdUMsWUFBWSxDQUFFLHdCQUF5QixDQUFDO1FBQ2xHdkIsV0FBVyxFQUFFO01BQ2YsQ0FBRSxDQUFDO01BRUhJLGlCQUFpQixFQUFFVixPQUFPLENBQUNjLFlBQVksQ0FBQ0osaUJBQWlCO01BQ3pERCxVQUFVLEVBQUVULE9BQU8sQ0FBQ2MsWUFBWSxDQUFDTDtJQUNuQyxDQUFDO0lBRUQsTUFBTWtELFdBQVcsR0FBRzNELE9BQU8sQ0FBQ0MsTUFBTSxDQUFDNEIsWUFBWSxDQUFFckMsa0JBQW1CLENBQUM7SUFDckUsSUFBSSxDQUFDb0UsVUFBVSxHQUFHMUUsS0FBSyxDQUFFO01BQ3ZCMkUsOEJBQThCLEVBQUUsSUFBSXRGLGVBQWUsQ0FBRSxLQUFLLEVBQUU7UUFDMUQwQixNQUFNLEVBQUUwRCxXQUFXLENBQUM5QixZQUFZLENBQUUsZ0NBQWlDLENBQUM7UUFDcEV2QixXQUFXLEVBQUU7TUFDZixDQUFFO0lBQ0osQ0FBQyxFQUFFTixPQUFPLENBQUNrQixZQUFhLENBQUM7SUFFekIsSUFBSSxDQUFDNEMsaUJBQWlCLEdBQUc1RSxLQUFLLENBQUU7TUFDOUJELGNBQWMsRUFBRUEsY0FBYztNQUM5QjhFLHdCQUF3QixFQUFFakYsdUJBQXVCLENBQUNpRjtJQUNwRCxDQUFDLEVBQUUvRCxPQUFPLENBQUNvQixtQkFBb0IsQ0FBQztJQUVoQyxJQUFLcEIsT0FBTyxDQUFDb0IsbUJBQW1CLENBQUNLLGFBQWEsQ0FBQ0YsTUFBTSxHQUFHLENBQUMsRUFBRztNQUUxRDtNQUNBekMsdUJBQXVCLENBQUNpRix3QkFBd0IsQ0FBQ3pCLEtBQUssR0FBR3RDLE9BQU8sQ0FBQ29CLG1CQUFtQixDQUFDSyxhQUFhLENBQUUsQ0FBQyxDQUFFO01BRXZHdUMsTUFBTSxJQUFJQSxNQUFNLENBQUVsRix1QkFBdUIsQ0FBQ2lGLHdCQUF3QixDQUFDekIsS0FBSyxLQUFLLElBQUksRUFBRSxrRkFBbUYsQ0FBQztNQUN2SyxJQUFJLENBQUN3QixpQkFBaUIsQ0FBQ0Msd0JBQXdCLEdBQUdqRix1QkFBdUIsQ0FBQ2lGLHdCQUF3QjtJQUNwRztJQUdBLElBQUssSUFBSSxDQUFDdEIsVUFBVSxDQUFDeEIsa0JBQWtCLEVBQUc7TUFDeEMrQyxNQUFNLElBQUlBLE1BQU0sQ0FBRSxJQUFJLENBQUN2QixVQUFVLENBQUN6QixhQUFhLEVBQUUsdURBQXdELENBQUM7SUFDNUc7SUFFQSxJQUFJLENBQUNpRCwrQkFBK0IsQ0FBRWpFLE9BQU8sQ0FBQ0MsTUFBTSxFQUFFLElBQUksQ0FBQzBCLGVBQWdCLENBQUM7SUFFNUUsSUFBSSxDQUFDc0MsK0JBQStCLENBQUVqRSxPQUFPLENBQUNDLE1BQU0sRUFBRSxJQUFJLENBQUM2QixXQUFXLEVBQUUsQ0FDdEU7TUFBRW9DLFFBQVEsRUFBRSxJQUFJLENBQUNwQyxXQUFXLENBQUMzRDtJQUFxQixDQUFDLENBQ25ELENBQUM7SUFFSCxJQUFJLENBQUM4RiwrQkFBK0IsQ0FBRWpFLE9BQU8sQ0FBQ0MsTUFBTSxFQUFFLElBQUksQ0FBQ3dDLFVBQVUsRUFBRSxDQUNyRTtNQUFFeUIsUUFBUSxFQUFFLElBQUksQ0FBQ3pCLFVBQVUsQ0FBQ0Msb0JBQW9CO01BQUVqQyxVQUFVLEVBQUU7SUFBdUIsQ0FBQyxFQUN0RjtNQUFFeUQsUUFBUSxFQUFFLElBQUksQ0FBQ3pCLFVBQVUsQ0FBQ0Usb0JBQW9CO01BQUVsQyxVQUFVLEVBQUU7SUFBdUIsQ0FBQyxFQUN0RjtNQUFFeUQsUUFBUSxFQUFFLElBQUksQ0FBQ3pCLFVBQVUsQ0FBQ0kseUJBQXlCO01BQUVwQyxVQUFVLEVBQUU7SUFBNEIsQ0FBQyxFQUNoRztNQUFFeUQsUUFBUSxFQUFFLElBQUksQ0FBQ3pCLFVBQVUsQ0FBQ0ssc0JBQXNCO01BQUVyQyxVQUFVLEVBQUU7SUFBeUIsQ0FBQyxFQUMxRjtNQUFFeUQsUUFBUSxFQUFFLElBQUksQ0FBQ3pCLFVBQVUsQ0FBQ00sdUNBQXVDO01BQUV0QyxVQUFVLEVBQUU7SUFBMEMsQ0FBQyxFQUM1SDtNQUFFeUQsUUFBUSxFQUFFLElBQUksQ0FBQ3pCLFVBQVUsQ0FBQ1EscUNBQXFDO01BQUV4QyxVQUFVLEVBQUU7SUFBd0MsQ0FBQyxFQUN4SDtNQUFFeUQsUUFBUSxFQUFFLElBQUksQ0FBQ3pCLFVBQVUsQ0FBQ1Usc0NBQXNDO01BQUUxQyxVQUFVLEVBQUU7SUFBeUMsQ0FBQyxFQUMxSDtNQUFFeUQsUUFBUSxFQUFFLElBQUksQ0FBQ3pCLFVBQVUsQ0FBQ1ksbUNBQW1DO01BQUU1QyxVQUFVLEVBQUU7SUFBc0MsQ0FBQyxFQUNwSDtNQUFFeUQsUUFBUSxFQUFFLElBQUksQ0FBQ3pCLFVBQVUsQ0FBQ2Msa0JBQWtCO01BQUU5QyxVQUFVLEVBQUU7SUFBcUIsQ0FBQyxFQUNsRjtNQUFFeUQsUUFBUSxFQUFFLElBQUksQ0FBQ3pCLFVBQVUsQ0FBQ2UsaUJBQWlCO01BQUUvQyxVQUFVLEVBQUU7SUFBb0IsQ0FBQyxDQUNoRixDQUFDO0lBQ0gsSUFBSSxDQUFDd0QsK0JBQStCLENBQUVqRSxPQUFPLENBQUNDLE1BQU0sRUFBRSxJQUFJLENBQUMyRCxVQUFXLENBQUM7SUFDdkUsSUFBSSxDQUFDSywrQkFBK0IsQ0FBRWpFLE9BQU8sQ0FBQ0MsTUFBTSxFQUFFLElBQUksQ0FBQzZELGlCQUFpQixFQUFFLENBQzVFO01BQUVJLFFBQVEsRUFBRSxJQUFJLENBQUNKLGlCQUFpQixDQUFDN0UsY0FBYztNQUFFd0IsVUFBVSxFQUFFO0lBQWlCLENBQUMsQ0FDakYsQ0FBQzs7SUFFSDtJQUNBO0lBQ0EsSUFBS00sZUFBZSxFQUFHO01BQ3JCM0MsY0FBYyxDQUFDd0UsZUFBZSxDQUFDTixLQUFLLEdBQUd6QyxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsZUFBZSxDQUFDb0UsdUJBQXVCOztNQUUzRjtNQUNBO01BQ0EsSUFBSUMseUJBQXlCLEdBQUcsS0FBSztNQUNyQ25GLGNBQWMsQ0FBQ29GLElBQUksQ0FBRW5DLE1BQU0sSUFBSTtRQUU3QixNQUFNb0MsYUFBYSxHQUFHcEMsTUFBTSxDQUFDQyxVQUFVLENBQUUsSUFBSyxDQUFDO1FBQy9DLElBQUsvRCxjQUFjLENBQUN3RSxlQUFlLENBQUNOLEtBQUssRUFBRztVQUMxQ2xFLGNBQWMsQ0FBQ3dFLGVBQWUsQ0FBQ04sS0FBSyxHQUFHZ0MsYUFBYTtVQUNwREYseUJBQXlCLEdBQUcsSUFBSTtRQUNsQyxDQUFDLE1BQ0ksSUFBS0EseUJBQXlCLElBQUlFLGFBQWEsRUFBRztVQUNyRGxHLGNBQWMsQ0FBQ3dFLGVBQWUsQ0FBQ04sS0FBSyxHQUFHLElBQUk7VUFDM0M4Qix5QkFBeUIsR0FBRyxLQUFLO1FBQ25DO01BQ0YsQ0FBRSxDQUFDOztNQUVIO01BQ0E7TUFDQTtNQUNBaEcsY0FBYyxDQUFDd0UsZUFBZSxDQUFDeUIsSUFBSSxDQUFFRSxPQUFPLElBQUk7UUFDOUNsRyxxQkFBcUIsQ0FBQ2tHLE9BQU8sR0FBR0EsT0FBTztRQUN2QyxDQUFDQSxPQUFPLElBQUlsRyxxQkFBcUIsQ0FBQ21HLEtBQUssQ0FBQyxDQUFDO01BQzNDLENBQUUsQ0FBQzs7TUFFSDtNQUNBLElBQUszRSxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsZUFBZSxDQUFDb0UsdUJBQXVCLEVBQUc7UUFDMUQ3RixpQkFBaUIsQ0FBQzRFLDhCQUE4QixDQUFDWixLQUFLLEdBQUcsSUFBSTtRQUM3RGhFLGlCQUFpQixDQUFDOEUsK0JBQStCLENBQUNkLEtBQUssR0FBRyxJQUFJO1FBQzlEaEUsaUJBQWlCLENBQUNnRiw0QkFBNEIsQ0FBQ2hCLEtBQUssR0FBRyxJQUFJOztRQUUzRDtRQUNBLE1BQU1tQyxlQUFlLEdBQUdwRixTQUFTLENBQUNxRixTQUFTLENBQ3pDLENBQUV0RyxjQUFjLENBQUN1RyxjQUFjLEVBQUV2RyxjQUFjLENBQUN3RyxxQkFBcUIsQ0FBRSxFQUN2RSxDQUFFQyxNQUFNLEVBQUVDLFdBQVcsS0FBTTtVQUN6QixJQUFLQSxXQUFXLElBQUlELE1BQU0sQ0FBQ3RELE1BQU0sR0FBRyxDQUFDLEVBQUc7WUFDdENuRCxjQUFjLENBQUNxRixhQUFhLENBQUNuQixLQUFLLEdBQUdsRSxjQUFjLENBQUMyRywyQkFBMkIsQ0FBQyxDQUFDLENBQUUsQ0FBQyxDQUFFO1lBQ3RGMUYsU0FBUyxDQUFDMkYsV0FBVyxDQUFFUCxlQUFnQixDQUFDO1VBQzFDO1FBQ0YsQ0FDRixDQUFDO01BQ0g7SUFDRjtJQUVBLElBQUs1RSxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsZUFBZSxDQUFDa0YscUJBQXFCLEVBQUc7TUFDeEQ3RyxjQUFjLENBQUM4RyxvQkFBb0IsQ0FBQ0MsV0FBVyxDQUFFQyxJQUFJLElBQUlDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFFRixJQUFLLENBQUUsQ0FBQztJQUNoRjtJQUVBLElBQUksQ0FBQ0csMEJBQTBCLENBQUMsQ0FBQztFQUNuQzs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtFQUNVQSwwQkFBMEJBLENBQUEsRUFBUztJQUV6QyxJQUFLLElBQUksQ0FBQ3pELFdBQVcsQ0FBQ2pCLDZCQUE2QixFQUFHO01BQ3BEcEMsa0JBQWtCLENBQUMrRyxRQUFRLENBQUUsSUFBSSxDQUFDMUQsV0FBVyxDQUFDQyxvQ0FBb0MsRUFBRSxzQ0FBdUMsQ0FBQztJQUM5SDtJQUNBLElBQUssSUFBSSxDQUFDVSxVQUFVLENBQUMxQixlQUFlLEVBQUc7TUFFckM7TUFDQXRDLGtCQUFrQixDQUFDK0csUUFBUSxDQUFFLElBQUksQ0FBQy9DLFVBQVUsQ0FBQ1EscUNBQXFDLEVBQUUsZ0NBQWlDLENBQUM7TUFDdEh4RSxrQkFBa0IsQ0FBQytHLFFBQVEsQ0FBRSxJQUFJLENBQUMvQyxVQUFVLENBQUNVLHNDQUFzQyxFQUFFLGlDQUFrQyxDQUFDO01BQ3hIMUUsa0JBQWtCLENBQUMrRyxRQUFRLENBQUUsSUFBSSxDQUFDL0MsVUFBVSxDQUFDWSxtQ0FBbUMsRUFBRSw4QkFBK0IsQ0FBQztNQUNsSDVFLGtCQUFrQixDQUFDK0csUUFBUSxDQUFFLElBQUksQ0FBQy9DLFVBQVUsQ0FBQ2UsaUJBQWlCLEVBQUUsbUJBQW9CLENBQUM7TUFDckYvRSxrQkFBa0IsQ0FBQytHLFFBQVEsQ0FBRSxJQUFJLENBQUMvQyxVQUFVLENBQUNjLGtCQUFrQixFQUFFLG9CQUFxQixDQUFDO0lBQ3pGO0lBQ0EsSUFBSyxJQUFJLENBQUNkLFVBQVUsQ0FBQ3hCLGtCQUFrQixFQUFHO01BQ3hDeEMsa0JBQWtCLENBQUMrRyxRQUFRLENBQUUsSUFBSSxDQUFDL0MsVUFBVSxDQUFDSSx5QkFBeUIsRUFBRSwyQkFBNEIsQ0FBQztJQUN2RztJQUVBLElBQUssSUFBSSxDQUFDZSxVQUFVLENBQUN6QyxzQkFBc0IsRUFBRztNQUM1QzFDLGtCQUFrQixDQUFDK0csUUFBUSxDQUFFLElBQUksQ0FBQzVCLFVBQVUsQ0FBQ0MsOEJBQThCLEVBQUUsZ0NBQWlDLENBQUM7SUFDakg7RUFDRjtFQUVRSSwrQkFBK0JBLENBQUV3QixZQUFvQixFQUFFQyxZQUEwQixFQUFFQyxvQkFBa0QsR0FBRyxFQUFFLEVBQVM7SUFDekosTUFBTTFGLE1BQU0sR0FBR3dGLFlBQVksQ0FBQzVELFlBQVksQ0FBRTZELFlBQVksQ0FBQ2pGLFVBQVcsQ0FBQztJQUNuRSxNQUFNbUYsZ0JBQWdCLEdBQUdELG9CQUFvQjtJQUM3QyxLQUFNLElBQUlFLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR0gsWUFBWSxDQUFDaEYsaUJBQWlCLENBQUNhLE1BQU0sRUFBRXNFLENBQUMsRUFBRSxFQUFHO01BQ2hFLE1BQU1DLGdCQUFnQixHQUFHSixZQUFZLENBQUNoRixpQkFBaUIsQ0FBRW1GLENBQUMsQ0FBRTtNQUM1REMsZ0JBQWdCLENBQUNDLGNBQWMsSUFBSUgsZ0JBQWdCLENBQUNJLElBQUksQ0FBRSxHQUFHRixnQkFBZ0IsQ0FBQ0MsY0FBZSxDQUFDO0lBQ2hHO0lBRUEsS0FBTSxJQUFJRSxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUdMLGdCQUFnQixDQUFDckUsTUFBTSxFQUFFMEUsQ0FBQyxFQUFFLEVBQUc7TUFDbEQsTUFBTUMsbUJBQW1CLEdBQUdOLGdCQUFnQixDQUFFSyxDQUFDLENBQUU7TUFDakQsTUFBTXhGLFVBQVUsR0FBR3lGLG1CQUFtQixDQUFDekYsVUFBVSxJQUFJeUYsbUJBQW1CLENBQUNoQyxRQUFRLENBQUNqRSxNQUFNLENBQUNrRyxJQUFJO01BQzdGLElBQUksQ0FBQ0MsZ0JBQWdCLENBQUVGLG1CQUFtQixDQUFDaEMsUUFBUSxFQUFFO1FBQUVqRSxNQUFNLEVBQUVBLE1BQU0sQ0FBQzRCLFlBQVksQ0FBRXBCLFVBQVc7TUFBRSxDQUFFLENBQUM7SUFDdEc7RUFDRjtFQUVPNEYsd0JBQXdCQSxDQUFFQyxlQUFtRCxFQUFZO0lBQzlGLE9BQU9BLGVBQWUsQ0FBQzVGLGlCQUFpQixDQUFDYSxNQUFNLEdBQUcsQ0FBQztFQUNyRDs7RUFFQTtBQUNGO0FBQ0E7RUFDU2dGLDZCQUE2QkEsQ0FBQSxFQUFZO0lBQzlDLE9BQU8sSUFBSSxDQUFDRix3QkFBd0IsQ0FBRSxJQUFJLENBQUMxRSxlQUFnQixDQUFDO0VBQzlEOztFQUVBO0FBQ0Y7QUFDQTtFQUNTNkUseUJBQXlCQSxDQUFBLEVBQVk7SUFDMUMsT0FBTyxJQUFJLENBQUMxRSxXQUFXLENBQUNqQiw2QkFBNkIsSUFDOUMsSUFBSSxDQUFDaUIsV0FBVyxDQUFDbEIscUJBQXFCLElBQ3RDLElBQUksQ0FBQ3lGLHdCQUF3QixDQUFFLElBQUksQ0FBQ3ZFLFdBQVksQ0FBQztFQUMxRDs7RUFFQTtBQUNGO0FBQ0E7RUFDUzJFLHdCQUF3QkEsQ0FBQSxFQUFZO0lBQ3pDLE9BQU8sSUFBSSxDQUFDaEUsVUFBVSxDQUFDekIsYUFBYSxJQUM3QixJQUFJLENBQUN5QixVQUFVLENBQUN4QixrQkFBa0IsSUFDbEMsSUFBSSxDQUFDd0IsVUFBVSxDQUFDMUIsZUFBZSxJQUMvQixJQUFJLENBQUNzRix3QkFBd0IsQ0FBRSxJQUFJLENBQUM1RCxVQUFXLENBQUM7RUFDekQ7O0VBRUE7QUFDRjtBQUNBO0VBQ1NpRSx3QkFBd0JBLENBQUEsRUFBWTtJQUN6QyxPQUFPLElBQUksQ0FBQzlDLFVBQVUsQ0FBQ3pDLHNCQUFzQixJQUFJLElBQUksQ0FBQ2tGLHdCQUF3QixDQUFFLElBQUksQ0FBQ3pDLFVBQVcsQ0FBQztFQUNuRzs7RUFFQTtBQUNGO0FBQ0E7RUFDUytDLCtCQUErQkEsQ0FBQSxFQUFZO0lBQ2hELE9BQU8sSUFBSSxDQUFDN0MsaUJBQWlCLENBQUN6QyxzQkFBc0IsSUFDN0MsSUFBSSxDQUFDeUMsaUJBQWlCLENBQUNyQyxhQUFhLENBQUNGLE1BQU0sR0FBRyxDQUFDLElBQy9DLElBQUksQ0FBQzhFLHdCQUF3QixDQUFFLElBQUksQ0FBQ3ZDLGlCQUFrQixDQUFDO0VBQ2hFOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0VBQ1M4QyxnQkFBZ0JBLENBQUEsRUFBWTtJQUNqQyxPQUFPLElBQUksQ0FBQ0wsNkJBQTZCLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQ0MseUJBQXlCLENBQUMsQ0FBQyxJQUN4RSxJQUFJLENBQUNFLHdCQUF3QixDQUFDLENBQUMsSUFBSSxJQUFJLENBQUNDLCtCQUErQixDQUFDLENBQUMsSUFDekUsSUFBSSxDQUFDRix3QkFBd0IsQ0FBQyxDQUFDO0VBQ3hDO0VBRUEsT0FBY3JHLGtCQUFrQixHQUFHLElBQUlqQixNQUFNLENBQUUsb0JBQW9CLEVBQUU7SUFDbkUwSCxTQUFTLEVBQUVwSCxnQkFBZ0I7SUFFM0JxSCxhQUFhLEVBQUlDLGdCQUFrQyxJQUFNO01BQ3ZELE9BQU87UUFDTG5HLHFCQUFxQixFQUFFbUcsZ0JBQWdCLENBQUNqRixXQUFXLENBQUNsQixxQkFBcUI7UUFDekVDLDZCQUE2QixFQUFFa0csZ0JBQWdCLENBQUNqRixXQUFXLENBQUNqQiw2QkFBNkI7UUFDekZFLGVBQWUsRUFBRWdHLGdCQUFnQixDQUFDdEUsVUFBVSxDQUFDMUIsZUFBZTtRQUM1REMsYUFBYSxFQUFFK0YsZ0JBQWdCLENBQUN0RSxVQUFVLENBQUN6QixhQUFhO1FBQ3hEQyxrQkFBa0IsRUFBRThGLGdCQUFnQixDQUFDdEUsVUFBVSxDQUFDeEIsa0JBQWtCO1FBQ2xFRSxzQkFBc0IsRUFBRTRGLGdCQUFnQixDQUFDbkQsVUFBVSxDQUFDekMsc0JBQXNCO1FBQzFFRSxzQkFBc0IsRUFBRTBGLGdCQUFnQixDQUFDakQsaUJBQWlCLENBQUN6QyxzQkFBc0I7UUFFakY7UUFDQW9GLHdCQUF3QixFQUFFTSxnQkFBZ0IsQ0FBQ04sd0JBQXdCLENBQUMsQ0FBQztRQUNyRUMsd0JBQXdCLEVBQUVLLGdCQUFnQixDQUFDTCx3QkFBd0IsQ0FBQyxDQUFDO1FBQ3JFQywrQkFBK0IsRUFBRUksZ0JBQWdCLENBQUNKLCtCQUErQixDQUFDLENBQUM7UUFDbkZKLDZCQUE2QixFQUFFUSxnQkFBZ0IsQ0FBQ1IsNkJBQTZCLENBQUMsQ0FBQztRQUMvRUMseUJBQXlCLEVBQUVPLGdCQUFnQixDQUFDUCx5QkFBeUIsQ0FBQztNQUN4RSxDQUFDO0lBQ0gsQ0FBQztJQUNEUSxXQUFXLEVBQUU7TUFDWHBHLHFCQUFxQixFQUFFeEIsU0FBUztNQUNoQ3lCLDZCQUE2QixFQUFFekIsU0FBUztNQUN4QzJCLGVBQWUsRUFBRTNCLFNBQVM7TUFDMUI0QixhQUFhLEVBQUU1QixTQUFTO01BQ3hCNkIsa0JBQWtCLEVBQUU3QixTQUFTO01BQzdCK0Isc0JBQXNCLEVBQUUvQixTQUFTO01BQ2pDaUMsc0JBQXNCLEVBQUVqQyxTQUFTO01BRWpDO01BQ0FxSCx3QkFBd0IsRUFBRXJILFNBQVM7TUFDbkNzSCx3QkFBd0IsRUFBRXRILFNBQVM7TUFDbkN1SCwrQkFBK0IsRUFBRXZILFNBQVM7TUFDMUNtSCw2QkFBNkIsRUFBRW5ILFNBQVM7TUFDeENvSCx5QkFBeUIsRUFBRXBIO0lBQzdCO0VBQ0YsQ0FBRSxDQUFDO0FBQ0w7QUFFQVosS0FBSyxDQUFDZ0gsUUFBUSxDQUFFLGtCQUFrQixFQUFFL0YsZ0JBQWlCLENBQUMifQ==