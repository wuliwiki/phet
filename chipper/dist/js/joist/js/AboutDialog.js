// Copyright 2013-2022, University of Colorado Boulder

/**
 * AboutDialog displays information about the simulation -- its title, version number, credits, etc.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import DerivedProperty from '../../axon/js/DerivedProperty.js';
import stepTimer from '../../axon/js/stepTimer.js';
import optionize from '../../phet-core/js/optionize.js';
import StringUtils from '../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../scenery-phet/js/PhetFont.js';
import { allowLinksProperty, Node, PDOMPeer, RichText, VBox, VoicingRichText, VoicingText, VStrut } from '../../scenery/js/imports.js';
import Dialog from '../../sun/js/Dialog.js';
import Tandem from '../../tandem/js/Tandem.js';
import CreditsNode from './CreditsNode.js';
import joist from './joist.js';
import JoistStrings from './JoistStrings.js';
import packageJSON from './packageJSON.js';
import updateCheck from './updateCheck.js';
import UpdateNodes from './UpdateNodes.js';
import UpdateState from './UpdateState.js';

// constants
const MAX_WIDTH = 550; // Maximum width of elements in the dialog
const NOMINAL_FONT_SIZE = 16; // Change this to make everything larger or smaller

export default class AboutDialog extends Dialog {
  // Listener that should be called every frame where we are shown, with {number} dt as a single parameter.

  // Listener that should be called whenever our update state changes (while we are displayed)

  /**
   * @param nameStringProperty - name of the simulation
   * @param version - version of the simulation
   * @param credits - credits for the simulation
   * @param locale - locale string
   * @param [providedOptions]
   */
  constructor(nameStringProperty, version, credits, locale, providedOptions) {
    const options = optionize()({
      xSpacing: 26,
      topMargin: 26,
      bottomMargin: 26,
      leftMargin: 26,
      phetioReadOnly: true,
      // the AboutDialog should not be settable
      phetioDynamicElement: true,
      tandem: Tandem.REQUIRED
    }, providedOptions);

    // Dynamic modules are loaded in simLauncher and accessed through their namespace
    const Brand = phet.brand.Brand;
    assert && assert(Brand, 'Brand should exist by now');
    let children = [];
    const titleText = new VoicingText(nameStringProperty, {
      font: new PhetFont(2 * NOMINAL_FONT_SIZE),
      maxWidth: MAX_WIDTH,
      tagName: 'h1'
    });
    children.push(titleText);
    const versionStringProperty = new DerivedProperty([JoistStrings.versionPatternStringProperty], versionPattern => {
      return StringUtils.format(versionPattern, version);
    });
    children.push(new VoicingText(versionStringProperty, {
      font: new PhetFont(NOMINAL_FONT_SIZE),
      maxWidth: MAX_WIDTH,
      tagName: 'p'
    }));

    // Built versions will have a build timestamp
    if (phet.chipper.buildTimestamp) {
      children.push(new VoicingText(phet.chipper.buildTimestamp, {
        font: new PhetFont(0.65 * NOMINAL_FONT_SIZE),
        maxWidth: MAX_WIDTH,
        tagName: 'p',
        innerContent: phet.chipper.buildTimestamp
      }));
    }
    let updateStepListener = null;
    let updateVisibilityListener = null;
    let updatePanel = null;

    // brand=phet versions that are not running in the phet-app should check update status.
    if (updateCheck.areUpdatesChecked) {
      const positionOptions = {
        left: 0,
        top: 0
      };
      const checkingNode = UpdateNodes.createCheckingNode(positionOptions);
      const upToDateNode = UpdateNodes.createUpToDateNode(positionOptions);
      const outOfDateNode = UpdateNodes.createOutOfDateAboutNode(positionOptions);
      const offlineNode = UpdateNodes.createOfflineNode(positionOptions);
      updateStepListener = checkingNode.stepListener;
      updateVisibilityListener = state => {
        checkingNode.visible = state === UpdateState.CHECKING;
        upToDateNode.visible = state === UpdateState.UP_TO_DATE;
        outOfDateNode.visible = state === UpdateState.OUT_OF_DATE;
        offlineNode.visible = state === UpdateState.OFFLINE;

        // pdom - make update content visible/invisible for screen readers by explicitly removing content
        // from the DOM, necessary because AT will ready hidden content in a Dialog.
        checkingNode.pdomVisible = checkingNode.visible;
        upToDateNode.pdomVisible = upToDateNode.visible;
        outOfDateNode.pdomVisible = outOfDateNode.visible;
        offlineNode.pdomVisible = offlineNode.visible;
      };
      updatePanel = new Node({
        children: [checkingNode, upToDateNode, outOfDateNode, offlineNode],
        maxWidth: MAX_WIDTH,
        visibleProperty: allowLinksProperty
      });
      children.push(updatePanel);
    }
    const brandChildren = [];

    // Show the brand name, if it exists
    if (Brand.name) {
      brandChildren.push(new VoicingRichText(Brand.name, {
        font: new PhetFont(NOMINAL_FONT_SIZE),
        supScale: 0.5,
        supYOffset: 3,
        maxWidth: MAX_WIDTH,
        // pdom
        tagName: 'h2',
        innerContent: Brand.name
      }));
    }

    // Show the brand copyright statement, if it exists
    if (Brand.copyright) {
      const year = phet.chipper.buildTimestamp ?
      // defined for built versions
      phet.chipper.buildTimestamp.split('-')[0] :
      // e.g. "2017-04-20 19:04:59 UTC" -> "2017"
      new Date().getFullYear(); // in unbuilt mode

      const copyright = StringUtils.fillIn(Brand.copyright, {
        year: year
      });
      brandChildren.push(new VoicingText(copyright, {
        font: new PhetFont(0.75 * NOMINAL_FONT_SIZE),
        maxWidth: MAX_WIDTH,
        // pdom
        tagName: 'p',
        innerContent: copyright
      }));
    }
    let additionalLicenseStatement = null;

    // Optional additionalLicenseStatement, used in phet-io
    if (Brand.additionalLicenseStatement) {
      additionalLicenseStatement = new VoicingRichText(Brand.additionalLicenseStatement, {
        font: new PhetFont(0.65 * NOMINAL_FONT_SIZE),
        fill: 'gray',
        align: 'left',
        maxWidth: MAX_WIDTH,
        // pdom
        tagName: 'p',
        innerContent: Brand.additionalLicenseStatement
      });
      brandChildren.push(additionalLicenseStatement);
    }
    if (brandChildren.length > 0) {
      children.push(new VStrut(15));
      children = children.concat(brandChildren);
    }
    let creditsNode = null;

    // Add credits for specific brands
    if (Brand.id === 'phet' || Brand.id === 'phet-io') {
      children.push(new VStrut(15));
      creditsNode = new CreditsNode(credits, {
        titleFont: new PhetFont({
          size: NOMINAL_FONT_SIZE,
          weight: 'bold'
        }),
        textFont: new PhetFont(0.75 * NOMINAL_FONT_SIZE),
        maxWidth: MAX_WIDTH
      });
      children.push(creditsNode);
    }

    // Show any links identified in the brand
    const linksChildren = [];
    const links = Brand.getLinks(packageJSON.name, locale);
    if (links && links.length > 0) {
      linksChildren.push(new VStrut(15));
      for (let i = 0; i < links.length; i++) {
        const link = links[i];

        // If links are allowed, use hyperlinks. Otherwise, just output the URL. This doesn't need to be internationalized.
        const stringProperty = new DerivedProperty([allowLinksProperty, link.textStringProperty], (allowLinks, linkText) => {
          return allowLinks ? `<a href="{{url}}">${linkText}</a>` : `${linkText}: ${link.url}`;
        });

        // This is PhET-iO instrumented because it is a keyboard navigation focusable element.
        linksChildren.push(new RichText(stringProperty, {
          links: {
            url: link.url
          },
          // RichText must fill in URL for link
          font: new PhetFont(NOMINAL_FONT_SIZE),
          tandem: options.tandem.createTandem(link.tandemName),
          phetioReadOnly: true
        }));
      }

      // Show the links in a separate VBox so they will have the same MAX_WIDTH and hence the same font size.
      const linksParent = new VBox({
        spacing: 6,
        align: 'left',
        children: linksChildren,
        maxWidth: MAX_WIDTH
      });
      children.push(linksParent);
    }
    const content = new VBox({
      align: 'left',
      spacing: 6,
      children: children,
      // pdom - accessible container for all AboutDialog content
      tagName: 'div'
    });
    super(content, options);
    this.updateStepListener = updateStepListener;
    this.updateVisibilityListener = updateVisibilityListener;

    // pdom - set label association so the title is read when focus enters the dialog
    this.addAriaLabelledbyAssociation({
      thisElementName: PDOMPeer.PRIMARY_SIBLING,
      otherElementName: PDOMPeer.PRIMARY_SIBLING,
      otherNode: titleText
    });
    this.disposeAboutDialog = () => {
      creditsNode && creditsNode.dispose();
      additionalLicenseStatement && additionalLicenseStatement.dispose();
      linksChildren.forEach(child => child.dispose && child.dispose());
    };
  }

  /**
   * When the dialog is shown, add update listeners.
   */
  show() {
    if (updateCheck.areUpdatesChecked && !this.isShowingProperty.value) {
      updateCheck.resetTimeout();

      // Fire off a new update check if we were marked as offline or unchecked before, and we handle updates.
      if (updateCheck.stateProperty.value === UpdateState.OFFLINE || updateCheck.stateProperty.value === UpdateState.UNCHECKED) {
        updateCheck.check();
      }
      this.updateStepListener && stepTimer.addListener(this.updateStepListener);
      this.updateVisibilityListener && updateCheck.stateProperty.link(this.updateVisibilityListener);
    }
    super.show();
  }

  /**
   * When the dialog is hidden, remove update listeners.
   */
  hide() {
    if (this.isShowingProperty.value) {
      super.hide();
      if (updateCheck.areUpdatesChecked) {
        this.updateVisibilityListener && updateCheck.stateProperty.unlink(this.updateVisibilityListener);
        this.updateStepListener && stepTimer.removeListener(this.updateStepListener);
      }
    }
  }
  dispose() {
    this.disposeAboutDialog();
    super.dispose();
  }
}
joist.register('AboutDialog', AboutDialog);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJzdGVwVGltZXIiLCJvcHRpb25pemUiLCJTdHJpbmdVdGlscyIsIlBoZXRGb250IiwiYWxsb3dMaW5rc1Byb3BlcnR5IiwiTm9kZSIsIlBET01QZWVyIiwiUmljaFRleHQiLCJWQm94IiwiVm9pY2luZ1JpY2hUZXh0IiwiVm9pY2luZ1RleHQiLCJWU3RydXQiLCJEaWFsb2ciLCJUYW5kZW0iLCJDcmVkaXRzTm9kZSIsImpvaXN0IiwiSm9pc3RTdHJpbmdzIiwicGFja2FnZUpTT04iLCJ1cGRhdGVDaGVjayIsIlVwZGF0ZU5vZGVzIiwiVXBkYXRlU3RhdGUiLCJNQVhfV0lEVEgiLCJOT01JTkFMX0ZPTlRfU0laRSIsIkFib3V0RGlhbG9nIiwiY29uc3RydWN0b3IiLCJuYW1lU3RyaW5nUHJvcGVydHkiLCJ2ZXJzaW9uIiwiY3JlZGl0cyIsImxvY2FsZSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ4U3BhY2luZyIsInRvcE1hcmdpbiIsImJvdHRvbU1hcmdpbiIsImxlZnRNYXJnaW4iLCJwaGV0aW9SZWFkT25seSIsInBoZXRpb0R5bmFtaWNFbGVtZW50IiwidGFuZGVtIiwiUkVRVUlSRUQiLCJCcmFuZCIsInBoZXQiLCJicmFuZCIsImFzc2VydCIsImNoaWxkcmVuIiwidGl0bGVUZXh0IiwiZm9udCIsIm1heFdpZHRoIiwidGFnTmFtZSIsInB1c2giLCJ2ZXJzaW9uU3RyaW5nUHJvcGVydHkiLCJ2ZXJzaW9uUGF0dGVyblN0cmluZ1Byb3BlcnR5IiwidmVyc2lvblBhdHRlcm4iLCJmb3JtYXQiLCJjaGlwcGVyIiwiYnVpbGRUaW1lc3RhbXAiLCJpbm5lckNvbnRlbnQiLCJ1cGRhdGVTdGVwTGlzdGVuZXIiLCJ1cGRhdGVWaXNpYmlsaXR5TGlzdGVuZXIiLCJ1cGRhdGVQYW5lbCIsImFyZVVwZGF0ZXNDaGVja2VkIiwicG9zaXRpb25PcHRpb25zIiwibGVmdCIsInRvcCIsImNoZWNraW5nTm9kZSIsImNyZWF0ZUNoZWNraW5nTm9kZSIsInVwVG9EYXRlTm9kZSIsImNyZWF0ZVVwVG9EYXRlTm9kZSIsIm91dE9mRGF0ZU5vZGUiLCJjcmVhdGVPdXRPZkRhdGVBYm91dE5vZGUiLCJvZmZsaW5lTm9kZSIsImNyZWF0ZU9mZmxpbmVOb2RlIiwic3RlcExpc3RlbmVyIiwic3RhdGUiLCJ2aXNpYmxlIiwiQ0hFQ0tJTkciLCJVUF9UT19EQVRFIiwiT1VUX09GX0RBVEUiLCJPRkZMSU5FIiwicGRvbVZpc2libGUiLCJ2aXNpYmxlUHJvcGVydHkiLCJicmFuZENoaWxkcmVuIiwibmFtZSIsInN1cFNjYWxlIiwic3VwWU9mZnNldCIsImNvcHlyaWdodCIsInllYXIiLCJzcGxpdCIsIkRhdGUiLCJnZXRGdWxsWWVhciIsImZpbGxJbiIsImFkZGl0aW9uYWxMaWNlbnNlU3RhdGVtZW50IiwiZmlsbCIsImFsaWduIiwibGVuZ3RoIiwiY29uY2F0IiwiY3JlZGl0c05vZGUiLCJpZCIsInRpdGxlRm9udCIsInNpemUiLCJ3ZWlnaHQiLCJ0ZXh0Rm9udCIsImxpbmtzQ2hpbGRyZW4iLCJsaW5rcyIsImdldExpbmtzIiwiaSIsImxpbmsiLCJzdHJpbmdQcm9wZXJ0eSIsInRleHRTdHJpbmdQcm9wZXJ0eSIsImFsbG93TGlua3MiLCJsaW5rVGV4dCIsInVybCIsImNyZWF0ZVRhbmRlbSIsInRhbmRlbU5hbWUiLCJsaW5rc1BhcmVudCIsInNwYWNpbmciLCJjb250ZW50IiwiYWRkQXJpYUxhYmVsbGVkYnlBc3NvY2lhdGlvbiIsInRoaXNFbGVtZW50TmFtZSIsIlBSSU1BUllfU0lCTElORyIsIm90aGVyRWxlbWVudE5hbWUiLCJvdGhlck5vZGUiLCJkaXNwb3NlQWJvdXREaWFsb2ciLCJkaXNwb3NlIiwiZm9yRWFjaCIsImNoaWxkIiwic2hvdyIsImlzU2hvd2luZ1Byb3BlcnR5IiwidmFsdWUiLCJyZXNldFRpbWVvdXQiLCJzdGF0ZVByb3BlcnR5IiwiVU5DSEVDS0VEIiwiY2hlY2siLCJhZGRMaXN0ZW5lciIsImhpZGUiLCJ1bmxpbmsiLCJyZW1vdmVMaXN0ZW5lciIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQWJvdXREaWFsb2cudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQWJvdXREaWFsb2cgZGlzcGxheXMgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNpbXVsYXRpb24gLS0gaXRzIHRpdGxlLCB2ZXJzaW9uIG51bWJlciwgY3JlZGl0cywgZXRjLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgc3RlcFRpbWVyIGZyb20gJy4uLy4uL2F4b24vanMvc3RlcFRpbWVyLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVEJyYW5kIGZyb20gJy4uLy4uL2JyYW5kL2pzL1RCcmFuZC5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IGFsbG93TGlua3NQcm9wZXJ0eSwgTm9kZSwgUERPTVBlZXIsIFJpY2hUZXh0LCBWQm94LCBWb2ljaW5nUmljaFRleHQsIFZvaWNpbmdUZXh0LCBWU3RydXQgfSBmcm9tICcuLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgRGlhbG9nLCB7IERpYWxvZ09wdGlvbnMgfSBmcm9tICcuLi8uLi9zdW4vanMvRGlhbG9nLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IENyZWRpdHNOb2RlLCB7IENyZWRpdHNEYXRhIH0gZnJvbSAnLi9DcmVkaXRzTm9kZS5qcyc7XHJcbmltcG9ydCB7IExvY2FsZSB9IGZyb20gJy4vaTE4bi9sb2NhbGVQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBqb2lzdCBmcm9tICcuL2pvaXN0LmpzJztcclxuaW1wb3J0IEpvaXN0U3RyaW5ncyBmcm9tICcuL0pvaXN0U3RyaW5ncy5qcyc7XHJcbmltcG9ydCBwYWNrYWdlSlNPTiBmcm9tICcuL3BhY2thZ2VKU09OLmpzJztcclxuaW1wb3J0IHVwZGF0ZUNoZWNrIGZyb20gJy4vdXBkYXRlQ2hlY2suanMnO1xyXG5pbXBvcnQgVXBkYXRlTm9kZXMgZnJvbSAnLi9VcGRhdGVOb2Rlcy5qcyc7XHJcbmltcG9ydCBVcGRhdGVTdGF0ZSBmcm9tICcuL1VwZGF0ZVN0YXRlLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBNQVhfV0lEVEggPSA1NTA7IC8vIE1heGltdW0gd2lkdGggb2YgZWxlbWVudHMgaW4gdGhlIGRpYWxvZ1xyXG5jb25zdCBOT01JTkFMX0ZPTlRfU0laRSA9IDE2OyAvLyBDaGFuZ2UgdGhpcyB0byBtYWtlIGV2ZXJ5dGhpbmcgbGFyZ2VyIG9yIHNtYWxsZXJcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSBFbXB0eVNlbGZPcHRpb25zO1xyXG5cclxuZXhwb3J0IHR5cGUgQWJvdXREaWFsb2dPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBEaWFsb2dPcHRpb25zO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQWJvdXREaWFsb2cgZXh0ZW5kcyBEaWFsb2cge1xyXG5cclxuICAvLyBMaXN0ZW5lciB0aGF0IHNob3VsZCBiZSBjYWxsZWQgZXZlcnkgZnJhbWUgd2hlcmUgd2UgYXJlIHNob3duLCB3aXRoIHtudW1iZXJ9IGR0IGFzIGEgc2luZ2xlIHBhcmFtZXRlci5cclxuICBwcml2YXRlIHJlYWRvbmx5IHVwZGF0ZVN0ZXBMaXN0ZW5lcjogKCAoIGR0OiBudW1iZXIgKSA9PiB2b2lkICkgfCBudWxsO1xyXG5cclxuICAvLyBMaXN0ZW5lciB0aGF0IHNob3VsZCBiZSBjYWxsZWQgd2hlbmV2ZXIgb3VyIHVwZGF0ZSBzdGF0ZSBjaGFuZ2VzICh3aGlsZSB3ZSBhcmUgZGlzcGxheWVkKVxyXG4gIHByaXZhdGUgcmVhZG9ubHkgdXBkYXRlVmlzaWJpbGl0eUxpc3RlbmVyOiAoICggc3RhdGU6IFVwZGF0ZVN0YXRlICkgPT4gdm9pZCApIHwgbnVsbDtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlQWJvdXREaWFsb2c6ICgpID0+IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBuYW1lU3RyaW5nUHJvcGVydHkgLSBuYW1lIG9mIHRoZSBzaW11bGF0aW9uXHJcbiAgICogQHBhcmFtIHZlcnNpb24gLSB2ZXJzaW9uIG9mIHRoZSBzaW11bGF0aW9uXHJcbiAgICogQHBhcmFtIGNyZWRpdHMgLSBjcmVkaXRzIGZvciB0aGUgc2ltdWxhdGlvblxyXG4gICAqIEBwYXJhbSBsb2NhbGUgLSBsb2NhbGUgc3RyaW5nXHJcbiAgICogQHBhcmFtIFtwcm92aWRlZE9wdGlvbnNdXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBuYW1lU3RyaW5nUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4sIHZlcnNpb246IHN0cmluZywgY3JlZGl0czogQ3JlZGl0c0RhdGEsIGxvY2FsZTogTG9jYWxlLCBwcm92aWRlZE9wdGlvbnM/OiBBYm91dERpYWxvZ09wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxBYm91dERpYWxvZ09wdGlvbnMsIFNlbGZPcHRpb25zLCBEaWFsb2dPcHRpb25zPigpKCB7XHJcbiAgICAgIHhTcGFjaW5nOiAyNixcclxuICAgICAgdG9wTWFyZ2luOiAyNixcclxuICAgICAgYm90dG9tTWFyZ2luOiAyNixcclxuICAgICAgbGVmdE1hcmdpbjogMjYsXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlLCAvLyB0aGUgQWJvdXREaWFsb2cgc2hvdWxkIG5vdCBiZSBzZXR0YWJsZVxyXG4gICAgICBwaGV0aW9EeW5hbWljRWxlbWVudDogdHJ1ZSxcclxuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRURcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIC8vIER5bmFtaWMgbW9kdWxlcyBhcmUgbG9hZGVkIGluIHNpbUxhdW5jaGVyIGFuZCBhY2Nlc3NlZCB0aHJvdWdoIHRoZWlyIG5hbWVzcGFjZVxyXG4gICAgY29uc3QgQnJhbmQ6IFRCcmFuZCA9IHBoZXQuYnJhbmQuQnJhbmQ7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBCcmFuZCwgJ0JyYW5kIHNob3VsZCBleGlzdCBieSBub3cnICk7XHJcblxyXG4gICAgbGV0IGNoaWxkcmVuID0gW107XHJcblxyXG4gICAgY29uc3QgdGl0bGVUZXh0ID0gbmV3IFZvaWNpbmdUZXh0KCBuYW1lU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgZm9udDogbmV3IFBoZXRGb250KCAyICogTk9NSU5BTF9GT05UX1NJWkUgKSxcclxuICAgICAgbWF4V2lkdGg6IE1BWF9XSURUSCxcclxuICAgICAgdGFnTmFtZTogJ2gxJ1xyXG4gICAgfSApO1xyXG4gICAgY2hpbGRyZW4ucHVzaCggdGl0bGVUZXh0ICk7XHJcblxyXG4gICAgY29uc3QgdmVyc2lvblN0cmluZ1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBKb2lzdFN0cmluZ3MudmVyc2lvblBhdHRlcm5TdHJpbmdQcm9wZXJ0eSBdLCB2ZXJzaW9uUGF0dGVybiA9PiB7XHJcbiAgICAgIHJldHVybiBTdHJpbmdVdGlscy5mb3JtYXQoIHZlcnNpb25QYXR0ZXJuLCB2ZXJzaW9uICk7XHJcbiAgICB9ICk7XHJcbiAgICBjaGlsZHJlbi5wdXNoKCBuZXcgVm9pY2luZ1RleHQoIHZlcnNpb25TdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIE5PTUlOQUxfRk9OVF9TSVpFICksXHJcbiAgICAgIG1heFdpZHRoOiBNQVhfV0lEVEgsXHJcbiAgICAgIHRhZ05hbWU6ICdwJ1xyXG4gICAgfSApICk7XHJcblxyXG4gICAgLy8gQnVpbHQgdmVyc2lvbnMgd2lsbCBoYXZlIGEgYnVpbGQgdGltZXN0YW1wXHJcbiAgICBpZiAoIHBoZXQuY2hpcHBlci5idWlsZFRpbWVzdGFtcCApIHtcclxuICAgICAgY2hpbGRyZW4ucHVzaCggbmV3IFZvaWNpbmdUZXh0KCBwaGV0LmNoaXBwZXIuYnVpbGRUaW1lc3RhbXAsIHtcclxuICAgICAgICBmb250OiBuZXcgUGhldEZvbnQoIDAuNjUgKiBOT01JTkFMX0ZPTlRfU0laRSApLFxyXG4gICAgICAgIG1heFdpZHRoOiBNQVhfV0lEVEgsXHJcbiAgICAgICAgdGFnTmFtZTogJ3AnLFxyXG4gICAgICAgIGlubmVyQ29udGVudDogcGhldC5jaGlwcGVyLmJ1aWxkVGltZXN0YW1wXHJcbiAgICAgIH0gKSApO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCB1cGRhdGVTdGVwTGlzdGVuZXI6ICggKCBkdDogbnVtYmVyICkgPT4gdm9pZCApIHwgbnVsbCA9IG51bGw7XHJcbiAgICBsZXQgdXBkYXRlVmlzaWJpbGl0eUxpc3RlbmVyOiAoICggc3RhdGU6IFVwZGF0ZVN0YXRlICkgPT4gdm9pZCApIHwgbnVsbCA9IG51bGw7XHJcbiAgICBsZXQgdXBkYXRlUGFuZWw6IE5vZGUgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgICAvLyBicmFuZD1waGV0IHZlcnNpb25zIHRoYXQgYXJlIG5vdCBydW5uaW5nIGluIHRoZSBwaGV0LWFwcCBzaG91bGQgY2hlY2sgdXBkYXRlIHN0YXR1cy5cclxuICAgIGlmICggdXBkYXRlQ2hlY2suYXJlVXBkYXRlc0NoZWNrZWQgKSB7XHJcblxyXG4gICAgICBjb25zdCBwb3NpdGlvbk9wdGlvbnMgPSB7IGxlZnQ6IDAsIHRvcDogMCB9O1xyXG4gICAgICBjb25zdCBjaGVja2luZ05vZGUgPSBVcGRhdGVOb2Rlcy5jcmVhdGVDaGVja2luZ05vZGUoIHBvc2l0aW9uT3B0aW9ucyApO1xyXG4gICAgICBjb25zdCB1cFRvRGF0ZU5vZGUgPSBVcGRhdGVOb2Rlcy5jcmVhdGVVcFRvRGF0ZU5vZGUoIHBvc2l0aW9uT3B0aW9ucyApO1xyXG4gICAgICBjb25zdCBvdXRPZkRhdGVOb2RlID0gVXBkYXRlTm9kZXMuY3JlYXRlT3V0T2ZEYXRlQWJvdXROb2RlKCBwb3NpdGlvbk9wdGlvbnMgKTtcclxuICAgICAgY29uc3Qgb2ZmbGluZU5vZGUgPSBVcGRhdGVOb2Rlcy5jcmVhdGVPZmZsaW5lTm9kZSggcG9zaXRpb25PcHRpb25zICk7XHJcblxyXG4gICAgICB1cGRhdGVTdGVwTGlzdGVuZXIgPSBjaGVja2luZ05vZGUuc3RlcExpc3RlbmVyO1xyXG5cclxuICAgICAgdXBkYXRlVmlzaWJpbGl0eUxpc3RlbmVyID0gKCBzdGF0ZTogVXBkYXRlU3RhdGUgKSA9PiB7XHJcbiAgICAgICAgY2hlY2tpbmdOb2RlLnZpc2libGUgPSAoIHN0YXRlID09PSBVcGRhdGVTdGF0ZS5DSEVDS0lORyApO1xyXG4gICAgICAgIHVwVG9EYXRlTm9kZS52aXNpYmxlID0gKCBzdGF0ZSA9PT0gVXBkYXRlU3RhdGUuVVBfVE9fREFURSApO1xyXG4gICAgICAgIG91dE9mRGF0ZU5vZGUudmlzaWJsZSA9ICggc3RhdGUgPT09IFVwZGF0ZVN0YXRlLk9VVF9PRl9EQVRFICk7XHJcbiAgICAgICAgb2ZmbGluZU5vZGUudmlzaWJsZSA9ICggc3RhdGUgPT09IFVwZGF0ZVN0YXRlLk9GRkxJTkUgKTtcclxuXHJcbiAgICAgICAgLy8gcGRvbSAtIG1ha2UgdXBkYXRlIGNvbnRlbnQgdmlzaWJsZS9pbnZpc2libGUgZm9yIHNjcmVlbiByZWFkZXJzIGJ5IGV4cGxpY2l0bHkgcmVtb3ZpbmcgY29udGVudFxyXG4gICAgICAgIC8vIGZyb20gdGhlIERPTSwgbmVjZXNzYXJ5IGJlY2F1c2UgQVQgd2lsbCByZWFkeSBoaWRkZW4gY29udGVudCBpbiBhIERpYWxvZy5cclxuICAgICAgICBjaGVja2luZ05vZGUucGRvbVZpc2libGUgPSBjaGVja2luZ05vZGUudmlzaWJsZTtcclxuICAgICAgICB1cFRvRGF0ZU5vZGUucGRvbVZpc2libGUgPSB1cFRvRGF0ZU5vZGUudmlzaWJsZTtcclxuICAgICAgICBvdXRPZkRhdGVOb2RlLnBkb21WaXNpYmxlID0gb3V0T2ZEYXRlTm9kZS52aXNpYmxlO1xyXG4gICAgICAgIG9mZmxpbmVOb2RlLnBkb21WaXNpYmxlID0gb2ZmbGluZU5vZGUudmlzaWJsZTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHVwZGF0ZVBhbmVsID0gbmV3IE5vZGUoIHtcclxuICAgICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgICAgY2hlY2tpbmdOb2RlLFxyXG4gICAgICAgICAgdXBUb0RhdGVOb2RlLFxyXG4gICAgICAgICAgb3V0T2ZEYXRlTm9kZSxcclxuICAgICAgICAgIG9mZmxpbmVOb2RlXHJcbiAgICAgICAgXSxcclxuICAgICAgICBtYXhXaWR0aDogTUFYX1dJRFRILFxyXG4gICAgICAgIHZpc2libGVQcm9wZXJ0eTogYWxsb3dMaW5rc1Byb3BlcnR5XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIGNoaWxkcmVuLnB1c2goIHVwZGF0ZVBhbmVsICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYnJhbmRDaGlsZHJlbiA9IFtdO1xyXG5cclxuICAgIC8vIFNob3cgdGhlIGJyYW5kIG5hbWUsIGlmIGl0IGV4aXN0c1xyXG4gICAgaWYgKCBCcmFuZC5uYW1lICkge1xyXG4gICAgICBicmFuZENoaWxkcmVuLnB1c2goIG5ldyBWb2ljaW5nUmljaFRleHQoIEJyYW5kLm5hbWUsIHtcclxuICAgICAgICBmb250OiBuZXcgUGhldEZvbnQoIE5PTUlOQUxfRk9OVF9TSVpFICksXHJcbiAgICAgICAgc3VwU2NhbGU6IDAuNSxcclxuICAgICAgICBzdXBZT2Zmc2V0OiAzLFxyXG4gICAgICAgIG1heFdpZHRoOiBNQVhfV0lEVEgsXHJcblxyXG4gICAgICAgIC8vIHBkb21cclxuICAgICAgICB0YWdOYW1lOiAnaDInLFxyXG4gICAgICAgIGlubmVyQ29udGVudDogQnJhbmQubmFtZVxyXG4gICAgICB9ICkgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTaG93IHRoZSBicmFuZCBjb3B5cmlnaHQgc3RhdGVtZW50LCBpZiBpdCBleGlzdHNcclxuICAgIGlmICggQnJhbmQuY29weXJpZ2h0ICkge1xyXG4gICAgICBjb25zdCB5ZWFyID0gcGhldC5jaGlwcGVyLmJ1aWxkVGltZXN0YW1wID8gLy8gZGVmaW5lZCBmb3IgYnVpbHQgdmVyc2lvbnNcclxuICAgICAgICAgICAgICAgICAgIHBoZXQuY2hpcHBlci5idWlsZFRpbWVzdGFtcC5zcGxpdCggJy0nIClbIDAgXSA6IC8vIGUuZy4gXCIyMDE3LTA0LTIwIDE5OjA0OjU5IFVUQ1wiIC0+IFwiMjAxN1wiXHJcbiAgICAgICAgICAgICAgICAgICBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7IC8vIGluIHVuYnVpbHQgbW9kZVxyXG5cclxuICAgICAgY29uc3QgY29weXJpZ2h0ID0gU3RyaW5nVXRpbHMuZmlsbEluKCBCcmFuZC5jb3B5cmlnaHQsIHsgeWVhcjogeWVhciB9ICk7XHJcblxyXG4gICAgICBicmFuZENoaWxkcmVuLnB1c2goIG5ldyBWb2ljaW5nVGV4dCggY29weXJpZ2h0LCB7XHJcbiAgICAgICAgZm9udDogbmV3IFBoZXRGb250KCAwLjc1ICogTk9NSU5BTF9GT05UX1NJWkUgKSxcclxuICAgICAgICBtYXhXaWR0aDogTUFYX1dJRFRILFxyXG5cclxuICAgICAgICAvLyBwZG9tXHJcbiAgICAgICAgdGFnTmFtZTogJ3AnLFxyXG4gICAgICAgIGlubmVyQ29udGVudDogY29weXJpZ2h0XHJcbiAgICAgIH0gKSApO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBhZGRpdGlvbmFsTGljZW5zZVN0YXRlbWVudDogTm9kZSB8IG51bGwgPSBudWxsO1xyXG5cclxuICAgIC8vIE9wdGlvbmFsIGFkZGl0aW9uYWxMaWNlbnNlU3RhdGVtZW50LCB1c2VkIGluIHBoZXQtaW9cclxuICAgIGlmICggQnJhbmQuYWRkaXRpb25hbExpY2Vuc2VTdGF0ZW1lbnQgKSB7XHJcbiAgICAgIGFkZGl0aW9uYWxMaWNlbnNlU3RhdGVtZW50ID0gbmV3IFZvaWNpbmdSaWNoVGV4dCggQnJhbmQuYWRkaXRpb25hbExpY2Vuc2VTdGF0ZW1lbnQsIHtcclxuICAgICAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMC42NSAqIE5PTUlOQUxfRk9OVF9TSVpFICksXHJcbiAgICAgICAgICBmaWxsOiAnZ3JheScsXHJcbiAgICAgICAgICBhbGlnbjogJ2xlZnQnLFxyXG4gICAgICAgICAgbWF4V2lkdGg6IE1BWF9XSURUSCxcclxuXHJcbiAgICAgICAgICAvLyBwZG9tXHJcbiAgICAgICAgICB0YWdOYW1lOiAncCcsXHJcbiAgICAgICAgICBpbm5lckNvbnRlbnQ6IEJyYW5kLmFkZGl0aW9uYWxMaWNlbnNlU3RhdGVtZW50XHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG4gICAgICBicmFuZENoaWxkcmVuLnB1c2goIGFkZGl0aW9uYWxMaWNlbnNlU3RhdGVtZW50ICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCBicmFuZENoaWxkcmVuLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgIGNoaWxkcmVuLnB1c2goIG5ldyBWU3RydXQoIDE1ICkgKTtcclxuICAgICAgY2hpbGRyZW4gPSBjaGlsZHJlbi5jb25jYXQoIGJyYW5kQ2hpbGRyZW4gKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgY3JlZGl0c05vZGU6IE5vZGUgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgICAvLyBBZGQgY3JlZGl0cyBmb3Igc3BlY2lmaWMgYnJhbmRzXHJcbiAgICBpZiAoICggQnJhbmQuaWQgPT09ICdwaGV0JyB8fCBCcmFuZC5pZCA9PT0gJ3BoZXQtaW8nICkgKSB7XHJcbiAgICAgIGNoaWxkcmVuLnB1c2goIG5ldyBWU3RydXQoIDE1ICkgKTtcclxuICAgICAgY3JlZGl0c05vZGUgPSBuZXcgQ3JlZGl0c05vZGUoIGNyZWRpdHMsIHtcclxuICAgICAgICB0aXRsZUZvbnQ6IG5ldyBQaGV0Rm9udCggeyBzaXplOiBOT01JTkFMX0ZPTlRfU0laRSwgd2VpZ2h0OiAnYm9sZCcgfSApLFxyXG4gICAgICAgIHRleHRGb250OiBuZXcgUGhldEZvbnQoIDAuNzUgKiBOT01JTkFMX0ZPTlRfU0laRSApLFxyXG4gICAgICAgIG1heFdpZHRoOiBNQVhfV0lEVEhcclxuICAgICAgfSApO1xyXG4gICAgICBjaGlsZHJlbi5wdXNoKCBjcmVkaXRzTm9kZSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNob3cgYW55IGxpbmtzIGlkZW50aWZpZWQgaW4gdGhlIGJyYW5kXHJcbiAgICBjb25zdCBsaW5rc0NoaWxkcmVuOiBOb2RlW10gPSBbXTtcclxuICAgIGNvbnN0IGxpbmtzID0gQnJhbmQuZ2V0TGlua3MoIHBhY2thZ2VKU09OLm5hbWUsIGxvY2FsZSApO1xyXG4gICAgaWYgKCBsaW5rcyAmJiBsaW5rcy5sZW5ndGggPiAwICkge1xyXG5cclxuICAgICAgbGlua3NDaGlsZHJlbi5wdXNoKCBuZXcgVlN0cnV0KCAxNSApICk7XHJcblxyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBsaW5rcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICBjb25zdCBsaW5rID0gbGlua3NbIGkgXTtcclxuXHJcbiAgICAgICAgLy8gSWYgbGlua3MgYXJlIGFsbG93ZWQsIHVzZSBoeXBlcmxpbmtzLiBPdGhlcndpc2UsIGp1c3Qgb3V0cHV0IHRoZSBVUkwuIFRoaXMgZG9lc24ndCBuZWVkIHRvIGJlIGludGVybmF0aW9uYWxpemVkLlxyXG4gICAgICAgIGNvbnN0IHN0cmluZ1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBhbGxvd0xpbmtzUHJvcGVydHksIGxpbmsudGV4dFN0cmluZ1Byb3BlcnR5IF0sICggYWxsb3dMaW5rcywgbGlua1RleHQgKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gYWxsb3dMaW5rcyA/IGA8YSBocmVmPVwie3t1cmx9fVwiPiR7bGlua1RleHR9PC9hPmAgOiBgJHtsaW5rVGV4dH06ICR7bGluay51cmx9YDtcclxuICAgICAgICB9ICk7XHJcblxyXG4gICAgICAgIC8vIFRoaXMgaXMgUGhFVC1pTyBpbnN0cnVtZW50ZWQgYmVjYXVzZSBpdCBpcyBhIGtleWJvYXJkIG5hdmlnYXRpb24gZm9jdXNhYmxlIGVsZW1lbnQuXHJcbiAgICAgICAgbGlua3NDaGlsZHJlbi5wdXNoKCBuZXcgUmljaFRleHQoIHN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgICAgICBsaW5rczogeyB1cmw6IGxpbmsudXJsIH0sIC8vIFJpY2hUZXh0IG11c3QgZmlsbCBpbiBVUkwgZm9yIGxpbmtcclxuICAgICAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggTk9NSU5BTF9GT05UX1NJWkUgKSxcclxuICAgICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCBsaW5rLnRhbmRlbU5hbWUgKSxcclxuICAgICAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlXHJcbiAgICAgICAgfSApICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFNob3cgdGhlIGxpbmtzIGluIGEgc2VwYXJhdGUgVkJveCBzbyB0aGV5IHdpbGwgaGF2ZSB0aGUgc2FtZSBNQVhfV0lEVEggYW5kIGhlbmNlIHRoZSBzYW1lIGZvbnQgc2l6ZS5cclxuICAgICAgY29uc3QgbGlua3NQYXJlbnQgPSBuZXcgVkJveCgge1xyXG4gICAgICAgIHNwYWNpbmc6IDYsXHJcbiAgICAgICAgYWxpZ246ICdsZWZ0JyxcclxuICAgICAgICBjaGlsZHJlbjogbGlua3NDaGlsZHJlbiwgbWF4V2lkdGg6IE1BWF9XSURUSFxyXG4gICAgICB9ICk7XHJcbiAgICAgIGNoaWxkcmVuLnB1c2goIGxpbmtzUGFyZW50ICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY29udGVudCA9IG5ldyBWQm94KCB7XHJcbiAgICAgIGFsaWduOiAnbGVmdCcsXHJcbiAgICAgIHNwYWNpbmc6IDYsXHJcbiAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbixcclxuXHJcbiAgICAgIC8vIHBkb20gLSBhY2Nlc3NpYmxlIGNvbnRhaW5lciBmb3IgYWxsIEFib3V0RGlhbG9nIGNvbnRlbnRcclxuICAgICAgdGFnTmFtZTogJ2RpdidcclxuICAgIH0gKTtcclxuXHJcbiAgICBzdXBlciggY29udGVudCwgb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMudXBkYXRlU3RlcExpc3RlbmVyID0gdXBkYXRlU3RlcExpc3RlbmVyO1xyXG4gICAgdGhpcy51cGRhdGVWaXNpYmlsaXR5TGlzdGVuZXIgPSB1cGRhdGVWaXNpYmlsaXR5TGlzdGVuZXI7XHJcblxyXG4gICAgLy8gcGRvbSAtIHNldCBsYWJlbCBhc3NvY2lhdGlvbiBzbyB0aGUgdGl0bGUgaXMgcmVhZCB3aGVuIGZvY3VzIGVudGVycyB0aGUgZGlhbG9nXHJcbiAgICB0aGlzLmFkZEFyaWFMYWJlbGxlZGJ5QXNzb2NpYXRpb24oIHtcclxuICAgICAgdGhpc0VsZW1lbnROYW1lOiBQRE9NUGVlci5QUklNQVJZX1NJQkxJTkcsXHJcbiAgICAgIG90aGVyRWxlbWVudE5hbWU6IFBET01QZWVyLlBSSU1BUllfU0lCTElORyxcclxuICAgICAgb3RoZXJOb2RlOiB0aXRsZVRleHRcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VBYm91dERpYWxvZyA9ICgpID0+IHtcclxuICAgICAgY3JlZGl0c05vZGUgJiYgY3JlZGl0c05vZGUuZGlzcG9zZSgpO1xyXG4gICAgICBhZGRpdGlvbmFsTGljZW5zZVN0YXRlbWVudCAmJiBhZGRpdGlvbmFsTGljZW5zZVN0YXRlbWVudC5kaXNwb3NlKCk7XHJcbiAgICAgIGxpbmtzQ2hpbGRyZW4uZm9yRWFjaCggY2hpbGQgPT4gY2hpbGQuZGlzcG9zZSAmJiBjaGlsZC5kaXNwb3NlKCkgKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBXaGVuIHRoZSBkaWFsb2cgaXMgc2hvd24sIGFkZCB1cGRhdGUgbGlzdGVuZXJzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBzaG93KCk6IHZvaWQge1xyXG4gICAgaWYgKCB1cGRhdGVDaGVjay5hcmVVcGRhdGVzQ2hlY2tlZCAmJiAhdGhpcy5pc1Nob3dpbmdQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgdXBkYXRlQ2hlY2sucmVzZXRUaW1lb3V0KCk7XHJcblxyXG4gICAgICAvLyBGaXJlIG9mZiBhIG5ldyB1cGRhdGUgY2hlY2sgaWYgd2Ugd2VyZSBtYXJrZWQgYXMgb2ZmbGluZSBvciB1bmNoZWNrZWQgYmVmb3JlLCBhbmQgd2UgaGFuZGxlIHVwZGF0ZXMuXHJcbiAgICAgIGlmICggdXBkYXRlQ2hlY2suc3RhdGVQcm9wZXJ0eS52YWx1ZSA9PT0gVXBkYXRlU3RhdGUuT0ZGTElORSB8fCB1cGRhdGVDaGVjay5zdGF0ZVByb3BlcnR5LnZhbHVlID09PSBVcGRhdGVTdGF0ZS5VTkNIRUNLRUQgKSB7XHJcbiAgICAgICAgdXBkYXRlQ2hlY2suY2hlY2soKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy51cGRhdGVTdGVwTGlzdGVuZXIgJiYgc3RlcFRpbWVyLmFkZExpc3RlbmVyKCB0aGlzLnVwZGF0ZVN0ZXBMaXN0ZW5lciApO1xyXG4gICAgICB0aGlzLnVwZGF0ZVZpc2liaWxpdHlMaXN0ZW5lciAmJiB1cGRhdGVDaGVjay5zdGF0ZVByb3BlcnR5LmxpbmsoIHRoaXMudXBkYXRlVmlzaWJpbGl0eUxpc3RlbmVyICk7XHJcbiAgICB9XHJcblxyXG4gICAgc3VwZXIuc2hvdygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogV2hlbiB0aGUgZGlhbG9nIGlzIGhpZGRlbiwgcmVtb3ZlIHVwZGF0ZSBsaXN0ZW5lcnMuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGhpZGUoKTogdm9pZCB7XHJcbiAgICBpZiAoIHRoaXMuaXNTaG93aW5nUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgIHN1cGVyLmhpZGUoKTtcclxuXHJcbiAgICAgIGlmICggdXBkYXRlQ2hlY2suYXJlVXBkYXRlc0NoZWNrZWQgKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVWaXNpYmlsaXR5TGlzdGVuZXIgJiYgdXBkYXRlQ2hlY2suc3RhdGVQcm9wZXJ0eS51bmxpbmsoIHRoaXMudXBkYXRlVmlzaWJpbGl0eUxpc3RlbmVyICk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGVwTGlzdGVuZXIgJiYgc3RlcFRpbWVyLnJlbW92ZUxpc3RlbmVyKCB0aGlzLnVwZGF0ZVN0ZXBMaXN0ZW5lciApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZUFib3V0RGlhbG9nKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5qb2lzdC5yZWdpc3RlciggJ0Fib3V0RGlhbG9nJywgQWJvdXREaWFsb2cgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLGtDQUFrQztBQUM5RCxPQUFPQyxTQUFTLE1BQU0sNEJBQTRCO0FBR2xELE9BQU9DLFNBQVMsTUFBNEIsaUNBQWlDO0FBQzdFLE9BQU9DLFdBQVcsTUFBTSx5Q0FBeUM7QUFDakUsT0FBT0MsUUFBUSxNQUFNLG1DQUFtQztBQUN4RCxTQUFTQyxrQkFBa0IsRUFBRUMsSUFBSSxFQUFFQyxRQUFRLEVBQUVDLFFBQVEsRUFBRUMsSUFBSSxFQUFF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