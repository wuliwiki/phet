// Copyright 2021-2023, University of Colorado Boulder

/**
 * An item for the Toolbar that includes components related to the voicing feature. Includes a switch to
 * enable/disable all speech, and buttons to hear overview information about the active sim Screen.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../axon/js/BooleanProperty.js';
import PlayStopButton from '../../../scenery-phet/js/buttons/PlayStopButton.js';
import PhetFont from '../../../scenery-phet/js/PhetFont.js';
import { AlignGroup, Display, HBox, Node, ReadingBlockHighlight, Text, voicingManager, VoicingText, voicingUtteranceQueue } from '../../../scenery/js/imports.js';
import Tandem from '../../../tandem/js/Tandem.js';
import Utterance from '../../../utterance-queue/js/Utterance.js';
import joist from '../joist.js';
import JoistStrings from '../JoistStrings.js';
import PreferencesControl from '../preferences/PreferencesControl.js';
import optionize, { combineOptions } from '../../../phet-core/js/optionize.js';
import ToggleSwitch from '../../../sun/js/ToggleSwitch.js';
import PreferencesDialogConstants from '../preferences/PreferencesDialogConstants.js';

// constants
const CONTENT_VERTICAL_SPACING = 10;
const QUICK_INFO = 20;

// strings - Many of these strings are displayed visually but only when the sim is running in the english locale.
// Voicing is only available in English so these contents are hidden because translators will not be able to test
// them in a translated context. These strings are nested under the a11y key so that they are not available for
// translation.
const titleStringProperty = JoistStrings.a11y.toolbar.voicing.titleStringProperty;
const quickInfoStringProperty = JoistStrings.a11y.toolbar.voicing.quickInfoStringProperty;
const simVoicingOnStringProperty = JoistStrings.a11y.toolbar.voicing.simVoicingOnAlertStringProperty;
const simVoicingOffStringProperty = JoistStrings.a11y.toolbar.voicing.simVoicingOffAlertStringProperty;
const toolbarStringProperty = JoistStrings.a11y.toolbar.titleStringProperty;
const playOverviewStringProperty = JoistStrings.a11y.toolbar.voicing.playOverviewLabelStringProperty;
const playDetailsStringProperty = JoistStrings.a11y.toolbar.voicing.playDetailsLabelStringProperty;
const playHintStringProperty = JoistStrings.a11y.toolbar.voicing.playHintLabelStringProperty;
const overviewStringProperty = JoistStrings.a11y.toolbar.voicing.overviewLabelStringProperty;
const detailsStringProperty = JoistStrings.a11y.toolbar.voicing.detailsLabelStringProperty;
const hintStringProperty = JoistStrings.a11y.toolbar.voicing.hintLabelStringProperty;
class VoicingToolbarItem extends Node {
  constructor(alertManager, lookAndFeel, providedOptions) {
    const options = optionize()({
      // pdom
      tagName: 'section',
      labelTagName: 'h2',
      labelContent: toolbarStringProperty,
      // phet-io
      visiblePropertyOptions: {
        phetioReadOnly: true
      }
    }, providedOptions);
    super(options);
    const titleTextOptions = {
      font: new PhetFont(14),
      fill: lookAndFeel.navigationBarTextFillProperty,
      maxWidth: 90 // i18n, by inspection
    };

    const titleText = new Text(titleStringProperty, titleTextOptions);
    const quickInfoText = new VoicingText(quickInfoStringProperty, titleTextOptions);
    quickInfoText.focusHighlight = new ReadingBlockHighlight(quickInfoText, {
      // the inner stroke is white since the toolbar is on a black background
      innerStroke: 'white'
    });
    const muteSpeechSwitch = new ToggleSwitch(voicingManager.mainWindowVoicingEnabledProperty, false, true, combineOptions({
      a11yName: titleStringProperty,
      rightValueContextResponse: simVoicingOnStringProperty,
      leftValueContextResponse: simVoicingOffStringProperty,
      tandem: options.tandem.createTandem('muteSpeechSwitch')
    }, PreferencesDialogConstants.TOGGLE_SWITCH_OPTIONS));
    const muteSpeechControl = new PreferencesControl({
      labelNode: titleText,
      controlNode: muteSpeechSwitch,
      tandem: options.tandem.createTandem('muteSpeechControl')
    });

    // layout
    const labelAlignGroup = new AlignGroup();
    const inputAlignGroup = new AlignGroup();
    const overviewRow = new LabelButtonRow(overviewStringProperty, playOverviewStringProperty, labelAlignGroup, inputAlignGroup, lookAndFeel, alertManager.createOverviewContent.bind(alertManager));
    const detailsRow = new LabelButtonRow(detailsStringProperty, playDetailsStringProperty, labelAlignGroup, inputAlignGroup, lookAndFeel, alertManager.createDetailsContent.bind(alertManager));
    const hintRow = new LabelButtonRow(hintStringProperty, playHintStringProperty, labelAlignGroup, inputAlignGroup, lookAndFeel, alertManager.createHintContent.bind(alertManager));
    this.children = [muteSpeechControl, quickInfoText, overviewRow.content, detailsRow.content, hintRow.content];

    // layout
    quickInfoText.leftTop = muteSpeechControl.leftBottom.plusXY(0, CONTENT_VERTICAL_SPACING);
    overviewRow.content.leftTop = quickInfoText.leftBottom.plusXY(QUICK_INFO, CONTENT_VERTICAL_SPACING);
    detailsRow.content.leftTop = overviewRow.content.leftBottom.plusXY(0, CONTENT_VERTICAL_SPACING);
    hintRow.content.leftTop = detailsRow.content.leftBottom.plusXY(0, CONTENT_VERTICAL_SPACING);
    const rows = [overviewRow, detailsRow, hintRow];
    const playingProperties = [overviewRow.playingProperty, detailsRow.playingProperty, hintRow.playingProperty];
    rows.forEach(row => {
      row.playingProperty.link(playing => {
        row.playContent(playingProperties);
      });
    });
    this.disposeVoicingToolbarItem = () => {
      quickInfoText.dispose();
      titleText.dispose();
    };
  }

  /**
   */
  dispose() {
    this.disposeVoicingToolbarItem();
    super.dispose();
  }
}

/**
 * An inner class that manages a labelled PlayStopButton in the VoicingToolbarItem. Creates the label, button,
 * and adds listeners that generate the alert to be Voiced and toggle the button's playing state when
 * the voicingManager stops speaking.
 */
class LabelButtonRow {
  // A unique Utterance for the object response so that it can be independently cancelled and have a dynamic Priority
  // depending on interaction with the screen.
  // Whether the PlayStopButton has been pressed and the voicingManager is actively speaking this content
  // The Node of content to be displayed in the view, managing layout of the label and button
  /**
   * @param labelString - the visually rendered Text label for the button
   * @param a11yName - the string read in the PDOM and with the Voicing feature that labels this Button
   * @param labelAlignGroup - To align all labels in the VoicingToolbarItem
   * @param inputAlignGroup - To align all inputs in the VoicingToolbarItem
   * @param lookAndFeel
   * @param createAlert - function that creates the alert when the button is pressed
   */
  constructor(labelString, a11yName, labelAlignGroup, inputAlignGroup, lookAndFeel, createAlert) {
    this.lookAndFeel = lookAndFeel;
    this.objectResponseUtterance = new Utterance();
    this.createAlert = createAlert;
    this.playingProperty = new BooleanProperty(false, {
      // Speech is requested from a listener on the isPlayingProperty. But if the browser cannot speak it may
      // immediately cancel speech and set this Property to false again causing reentrancy.
      reentrant: true
    });
    this.playStopButton = new PlayStopButton(this.playingProperty, {
      startPlayingLabel: a11yName,
      // voicing
      voicingNameResponse: a11yName,
      voicingIgnoreVoicingManagerProperties: true,
      radius: 12,
      // phet-io
      tandem: Tandem.OPT_OUT
    });
    const textLabel = new Text(labelString, {
      font: new PhetFont(12),
      fill: this.lookAndFeel.navigationBarTextFillProperty,
      maxWidth: 100 // i18n, by inspection
    });

    const labelBox = labelAlignGroup.createBox(textLabel, {
      xAlign: 'left'
    });
    const inputBox = inputAlignGroup.createBox(this.playStopButton, {
      xAlign: 'right'
    });
    this.content = new HBox({
      children: [labelBox, inputBox],
      spacing: CONTENT_VERTICAL_SPACING
    });
    voicingManager.endSpeakingEmitter.addListener((text, endedUtterance) => {
      if (endedUtterance === this.objectResponseUtterance) {
        this.playingProperty.set(false);

        // Remove if listener wasn't interrupted by Display input.
        if (Display.inputListeners.includes(displayListener)) {
          Display.removeInputListener(displayListener);
        }
      }
    });

    // Reduces the priority of this.utterance as soon as there is an interaction with the screen so that it may
    // be interrupted by simulation responses. See https://github.com/phetsims/joist/issues/752.
    const reducePriorityListener = event => {
      // After a down event it will be possible for this.utterance to be interrupted. That will turn the "Stop" button
      // into a "Play" button. If the mouse is still down in this case the next up event on the "Play" button will
      // immediately play its content which is unexpected. We get around this by not reducing priority if the event
      // is going to this button.
      if (!event.trail.nodes.includes(this.playStopButton)) {
        Display.removeInputListener(displayListener);

        // Wait until the listener is removed before reducing this, this may immediately end the Utterance and remove
        // the listener again in the endSpeakingListener above.
        this.objectResponseUtterance.priorityProperty.value = Utterance.LOW_PRIORITY;
      }
    };
    const displayListener = {
      // The events that indicate some kind of input so we should allow this.utterance to be interrupted.
      down: reducePriorityListener,
      focus: reducePriorityListener
    };
    voicingManager.startSpeakingEmitter.addListener((response, utterance) => {
      if (utterance === this.objectResponseUtterance) {
        Display.addInputListener(displayListener);
      }
    });
  }

  /**
   * Play the Voicing content for this Row.
   */
  playContent(playingProperties) {
    if (this.playingProperty.value) {
      // when one button is pressed, immediately stop any other buttons, only one should be playing at a time
      const otherProperties = _.without(playingProperties, this.playingProperty);
      otherProperties.forEach(property => {
        property.value = false;
      });

      // This utterance is top priority so that it does not get interrupted during responses that happen as
      // the simulation changes. It stays top priority until there is some interaction with the display.
      this.objectResponseUtterance.priorityProperty.value = Utterance.TOP_PRIORITY;
      this.playStopButton.voicingSpeakResponse({
        objectResponse: this.createAlert(),
        // A sepparate Utterance from the default voicingUtterance so that if default responses are cancelled we
        // don't also cancel this content in the listeners related to priorityProperty above.
        utterance: this.objectResponseUtterance
      });
    } else {
      voicingUtteranceQueue.cancelUtterance(this.objectResponseUtterance);
    }
  }
}
joist.register('VoicingToolbarItem', VoicingToolbarItem);
export default VoicingToolbarItem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJQbGF5U3RvcEJ1dHRvbiIsIlBoZXRGb250IiwiQWxpZ25Hcm91cCIsIkRpc3BsYXkiLCJIQm94IiwiTm9kZSIsIlJlYWRpbmdCbG9ja0hpZ2hsaWdodCIsIlRleHQiLCJ2b2ljaW5nTWFuYWdlciIsIlZvaWNpbmdUZXh0Iiwidm9pY2luZ1V0dGVyYW5jZVF1ZXVlIiwiVGFuZGVtIiwiVXR0ZXJhbmNlIiwiam9pc3QiLCJKb2lzdFN0cmluZ3MiLCJQcmVmZXJlbmNlc0NvbnRyb2wiLCJvcHRpb25pemUiLCJjb21iaW5lT3B0aW9ucyIsIlRvZ2dsZVN3aXRjaCIsIlByZWZlcmVuY2VzRGlhbG9nQ29uc3RhbnRzIiwiQ09OVEVOVF9WRVJUSUNBTF9TUEFDSU5HIiwiUVVJQ0tfSU5GTyIsInRpdGxlU3RyaW5nUHJvcGVydHkiLCJhMTF5IiwidG9vbGJhciIsInZvaWNpbmciLCJxdWlja0luZm9TdHJpbmdQcm9wZXJ0eSIsInNpbVZvaWNpbmdPblN0cmluZ1Byb3BlcnR5Iiwic2ltVm9pY2luZ09uQWxlcnRTdHJpbmdQcm9wZXJ0eSIsInNpbVZvaWNpbmdPZmZTdHJpbmdQcm9wZXJ0eSIsInNpbVZvaWNpbmdPZmZBbGVydFN0cmluZ1Byb3BlcnR5IiwidG9vbGJhclN0cmluZ1Byb3BlcnR5IiwicGxheU92ZXJ2aWV3U3RyaW5nUHJvcGVydHkiLCJwbGF5T3ZlcnZpZXdMYWJlbFN0cmluZ1Byb3BlcnR5IiwicGxheURldGFpbHNTdHJpbmdQcm9wZXJ0eSIsInBsYXlEZXRhaWxzTGFiZWxTdHJpbmdQcm9wZXJ0eSIsInBsYXlIaW50U3RyaW5nUHJvcGVydHkiLCJwbGF5SGludExhYmVsU3RyaW5nUHJvcGVydHkiLCJvdmVydmlld1N0cmluZ1Byb3BlcnR5Iiwib3ZlcnZpZXdMYWJlbFN0cmluZ1Byb3BlcnR5IiwiZGV0YWlsc1N0cmluZ1Byb3BlcnR5IiwiZGV0YWlsc0xhYmVsU3RyaW5nUHJvcGVydHkiLCJoaW50U3RyaW5nUHJvcGVydHkiLCJoaW50TGFiZWxTdHJpbmdQcm9wZXJ0eSIsIlZvaWNpbmdUb29sYmFySXRlbSIsImNvbnN0cnVjdG9yIiwiYWxlcnRNYW5hZ2VyIiwibG9va0FuZEZlZWwiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwidGFnTmFtZSIsImxhYmVsVGFnTmFtZSIsImxhYmVsQ29udGVudCIsInZpc2libGVQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9SZWFkT25seSIsInRpdGxlVGV4dE9wdGlvbnMiLCJmb250IiwiZmlsbCIsIm5hdmlnYXRpb25CYXJUZXh0RmlsbFByb3BlcnR5IiwibWF4V2lkdGgiLCJ0aXRsZVRleHQiLCJxdWlja0luZm9UZXh0IiwiZm9jdXNIaWdobGlnaHQiLCJpbm5lclN0cm9rZSIsIm11dGVTcGVlY2hTd2l0Y2giLCJtYWluV2luZG93Vm9pY2luZ0VuYWJsZWRQcm9wZXJ0eSIsImExMXlOYW1lIiwicmlnaHRWYWx1ZUNvbnRleHRSZXNwb25zZSIsImxlZnRWYWx1ZUNvbnRleHRSZXNwb25zZSIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsIlRPR0dMRV9TV0lUQ0hfT1BUSU9OUyIsIm11dGVTcGVlY2hDb250cm9sIiwibGFiZWxOb2RlIiwiY29udHJvbE5vZGUiLCJsYWJlbEFsaWduR3JvdXAiLCJpbnB1dEFsaWduR3JvdXAiLCJvdmVydmlld1JvdyIsIkxhYmVsQnV0dG9uUm93IiwiY3JlYXRlT3ZlcnZpZXdDb250ZW50IiwiYmluZCIsImRldGFpbHNSb3ciLCJjcmVhdGVEZXRhaWxzQ29udGVudCIsImhpbnRSb3ciLCJjcmVhdGVIaW50Q29udGVudCIsImNoaWxkcmVuIiwiY29udGVudCIsImxlZnRUb3AiLCJsZWZ0Qm90dG9tIiwicGx1c1hZIiwicm93cyIsInBsYXlpbmdQcm9wZXJ0aWVzIiwicGxheWluZ1Byb3BlcnR5IiwiZm9yRWFjaCIsInJvdyIsImxpbmsiLCJwbGF5aW5nIiwicGxheUNvbnRlbnQiLCJkaXNwb3NlVm9pY2luZ1Rvb2xiYXJJdGVtIiwiZGlzcG9zZSIsImxhYmVsU3RyaW5nIiwiY3JlYXRlQWxlcnQiLCJvYmplY3RSZXNwb25zZVV0dGVyYW5jZSIsInJlZW50cmFudCIsInBsYXlTdG9wQnV0dG9uIiwic3RhcnRQbGF5aW5nTGFiZWwiLCJ2b2ljaW5nTmFtZVJlc3BvbnNlIiwidm9pY2luZ0lnbm9yZVZvaWNpbmdNYW5hZ2VyUHJvcGVydGllcyIsInJhZGl1cyIsIk9QVF9PVVQiLCJ0ZXh0TGFiZWwiLCJsYWJlbEJveCIsImNyZWF0ZUJveCIsInhBbGlnbiIsImlucHV0Qm94Iiwic3BhY2luZyIsImVuZFNwZWFraW5nRW1pdHRlciIsImFkZExpc3RlbmVyIiwidGV4dCIsImVuZGVkVXR0ZXJhbmNlIiwic2V0IiwiaW5wdXRMaXN0ZW5lcnMiLCJpbmNsdWRlcyIsImRpc3BsYXlMaXN0ZW5lciIsInJlbW92ZUlucHV0TGlzdGVuZXIiLCJyZWR1Y2VQcmlvcml0eUxpc3RlbmVyIiwiZXZlbnQiLCJ0cmFpbCIsIm5vZGVzIiwicHJpb3JpdHlQcm9wZXJ0eSIsInZhbHVlIiwiTE9XX1BSSU9SSVRZIiwiZG93biIsImZvY3VzIiwic3RhcnRTcGVha2luZ0VtaXR0ZXIiLCJyZXNwb25zZSIsInV0dGVyYW5jZSIsImFkZElucHV0TGlzdGVuZXIiLCJvdGhlclByb3BlcnRpZXMiLCJfIiwid2l0aG91dCIsInByb3BlcnR5IiwiVE9QX1BSSU9SSVRZIiwidm9pY2luZ1NwZWFrUmVzcG9uc2UiLCJvYmplY3RSZXNwb25zZSIsImNhbmNlbFV0dGVyYW5jZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiVm9pY2luZ1Rvb2xiYXJJdGVtLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEFuIGl0ZW0gZm9yIHRoZSBUb29sYmFyIHRoYXQgaW5jbHVkZXMgY29tcG9uZW50cyByZWxhdGVkIHRvIHRoZSB2b2ljaW5nIGZlYXR1cmUuIEluY2x1ZGVzIGEgc3dpdGNoIHRvXHJcbiAqIGVuYWJsZS9kaXNhYmxlIGFsbCBzcGVlY2gsIGFuZCBidXR0b25zIHRvIGhlYXIgb3ZlcnZpZXcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGFjdGl2ZSBzaW0gU2NyZWVuLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IFBsYXlTdG9wQnV0dG9uIGZyb20gJy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL1BsYXlTdG9wQnV0dG9uLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IEFsaWduR3JvdXAsIERpc3BsYXksIEhCb3gsIE5vZGUsIE5vZGVPcHRpb25zLCBSZWFkaW5nQmxvY2tIaWdobGlnaHQsIFNjZW5lcnlFdmVudCwgVGV4dCwgdm9pY2luZ01hbmFnZXIsIFZvaWNpbmdUZXh0LCB2b2ljaW5nVXR0ZXJhbmNlUXVldWUgfSBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgVXR0ZXJhbmNlIGZyb20gJy4uLy4uLy4uL3V0dGVyYW5jZS1xdWV1ZS9qcy9VdHRlcmFuY2UuanMnO1xyXG5pbXBvcnQgam9pc3QgZnJvbSAnLi4vam9pc3QuanMnO1xyXG5pbXBvcnQgSm9pc3RTdHJpbmdzIGZyb20gJy4uL0pvaXN0U3RyaW5ncy5qcyc7XHJcbmltcG9ydCBQcmVmZXJlbmNlc0NvbnRyb2wgZnJvbSAnLi4vcHJlZmVyZW5jZXMvUHJlZmVyZW5jZXNDb250cm9sLmpzJztcclxuaW1wb3J0IFZvaWNpbmdUb29sYmFyQWxlcnRNYW5hZ2VyIGZyb20gJy4vVm9pY2luZ1Rvb2xiYXJBbGVydE1hbmFnZXIuanMnO1xyXG5pbXBvcnQgTG9va0FuZEZlZWwgZnJvbSAnLi4vTG9va0FuZEZlZWwuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zLCBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBQaWNrUmVxdWlyZWQgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1BpY2tSZXF1aXJlZC5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgU3BlYWthYmxlUmVzb2x2ZWRSZXNwb25zZSB9IGZyb20gJy4uLy4uLy4uL3V0dGVyYW5jZS1xdWV1ZS9qcy9SZXNwb25zZVBhY2tldC5qcyc7XHJcbmltcG9ydCBUb2dnbGVTd2l0Y2gsIHsgVG9nZ2xlU3dpdGNoT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL3N1bi9qcy9Ub2dnbGVTd2l0Y2guanMnO1xyXG5pbXBvcnQgUHJlZmVyZW5jZXNEaWFsb2dDb25zdGFudHMgZnJvbSAnLi4vcHJlZmVyZW5jZXMvUHJlZmVyZW5jZXNEaWFsb2dDb25zdGFudHMuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IENPTlRFTlRfVkVSVElDQUxfU1BBQ0lORyA9IDEwO1xyXG5jb25zdCBRVUlDS19JTkZPID0gMjA7XHJcblxyXG4vLyBzdHJpbmdzIC0gTWFueSBvZiB0aGVzZSBzdHJpbmdzIGFyZSBkaXNwbGF5ZWQgdmlzdWFsbHkgYnV0IG9ubHkgd2hlbiB0aGUgc2ltIGlzIHJ1bm5pbmcgaW4gdGhlIGVuZ2xpc2ggbG9jYWxlLlxyXG4vLyBWb2ljaW5nIGlzIG9ubHkgYXZhaWxhYmxlIGluIEVuZ2xpc2ggc28gdGhlc2UgY29udGVudHMgYXJlIGhpZGRlbiBiZWNhdXNlIHRyYW5zbGF0b3JzIHdpbGwgbm90IGJlIGFibGUgdG8gdGVzdFxyXG4vLyB0aGVtIGluIGEgdHJhbnNsYXRlZCBjb250ZXh0LiBUaGVzZSBzdHJpbmdzIGFyZSBuZXN0ZWQgdW5kZXIgdGhlIGExMXkga2V5IHNvIHRoYXQgdGhleSBhcmUgbm90IGF2YWlsYWJsZSBmb3JcclxuLy8gdHJhbnNsYXRpb24uXHJcbmNvbnN0IHRpdGxlU3RyaW5nUHJvcGVydHkgPSBKb2lzdFN0cmluZ3MuYTExeS50b29sYmFyLnZvaWNpbmcudGl0bGVTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgcXVpY2tJbmZvU3RyaW5nUHJvcGVydHkgPSBKb2lzdFN0cmluZ3MuYTExeS50b29sYmFyLnZvaWNpbmcucXVpY2tJbmZvU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHNpbVZvaWNpbmdPblN0cmluZ1Byb3BlcnR5ID0gSm9pc3RTdHJpbmdzLmExMXkudG9vbGJhci52b2ljaW5nLnNpbVZvaWNpbmdPbkFsZXJ0U3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHNpbVZvaWNpbmdPZmZTdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIudm9pY2luZy5zaW1Wb2ljaW5nT2ZmQWxlcnRTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgdG9vbGJhclN0cmluZ1Byb3BlcnR5ID0gSm9pc3RTdHJpbmdzLmExMXkudG9vbGJhci50aXRsZVN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBwbGF5T3ZlcnZpZXdTdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIudm9pY2luZy5wbGF5T3ZlcnZpZXdMYWJlbFN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBwbGF5RGV0YWlsc1N0cmluZ1Byb3BlcnR5ID0gSm9pc3RTdHJpbmdzLmExMXkudG9vbGJhci52b2ljaW5nLnBsYXlEZXRhaWxzTGFiZWxTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgcGxheUhpbnRTdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIudm9pY2luZy5wbGF5SGludExhYmVsU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IG92ZXJ2aWV3U3RyaW5nUHJvcGVydHkgPSBKb2lzdFN0cmluZ3MuYTExeS50b29sYmFyLnZvaWNpbmcub3ZlcnZpZXdMYWJlbFN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBkZXRhaWxzU3RyaW5nUHJvcGVydHkgPSBKb2lzdFN0cmluZ3MuYTExeS50b29sYmFyLnZvaWNpbmcuZGV0YWlsc0xhYmVsU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGhpbnRTdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIudm9pY2luZy5oaW50TGFiZWxTdHJpbmdQcm9wZXJ0eTtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSBFbXB0eVNlbGZPcHRpb25zO1xyXG5leHBvcnQgdHlwZSBWb2ljaW5nVG9vbGJhckl0ZW1PcHRpb25zID0gU2VsZk9wdGlvbnMgJiBOb2RlT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxOb2RlT3B0aW9ucywgJ3RhbmRlbSc+O1xyXG5cclxuY2xhc3MgVm9pY2luZ1Rvb2xiYXJJdGVtIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZVZvaWNpbmdUb29sYmFySXRlbTogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBhbGVydE1hbmFnZXI6IFZvaWNpbmdUb29sYmFyQWxlcnRNYW5hZ2VyLCBsb29rQW5kRmVlbDogTG9va0FuZEZlZWwsIHByb3ZpZGVkT3B0aW9ucz86IFZvaWNpbmdUb29sYmFySXRlbU9wdGlvbnMgKSB7XHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFZvaWNpbmdUb29sYmFySXRlbU9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gcGRvbVxyXG4gICAgICB0YWdOYW1lOiAnc2VjdGlvbicsXHJcbiAgICAgIGxhYmVsVGFnTmFtZTogJ2gyJyxcclxuICAgICAgbGFiZWxDb250ZW50OiB0b29sYmFyU3RyaW5nUHJvcGVydHksXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHZpc2libGVQcm9wZXJ0eU9wdGlvbnM6IHtcclxuICAgICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZVxyXG4gICAgICB9XHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IHRpdGxlVGV4dE9wdGlvbnMgPSB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTQgKSxcclxuICAgICAgZmlsbDogbG9va0FuZEZlZWwubmF2aWdhdGlvbkJhclRleHRGaWxsUHJvcGVydHksXHJcbiAgICAgIG1heFdpZHRoOiA5MCAvLyBpMThuLCBieSBpbnNwZWN0aW9uXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHRpdGxlVGV4dCA9IG5ldyBUZXh0KCB0aXRsZVN0cmluZ1Byb3BlcnR5LCB0aXRsZVRleHRPcHRpb25zICk7XHJcbiAgICBjb25zdCBxdWlja0luZm9UZXh0ID0gbmV3IFZvaWNpbmdUZXh0KCBxdWlja0luZm9TdHJpbmdQcm9wZXJ0eSwgdGl0bGVUZXh0T3B0aW9ucyApO1xyXG4gICAgcXVpY2tJbmZvVGV4dC5mb2N1c0hpZ2hsaWdodCA9IG5ldyBSZWFkaW5nQmxvY2tIaWdobGlnaHQoIHF1aWNrSW5mb1RleHQsIHtcclxuXHJcbiAgICAgIC8vIHRoZSBpbm5lciBzdHJva2UgaXMgd2hpdGUgc2luY2UgdGhlIHRvb2xiYXIgaXMgb24gYSBibGFjayBiYWNrZ3JvdW5kXHJcbiAgICAgIGlubmVyU3Ryb2tlOiAnd2hpdGUnXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgbXV0ZVNwZWVjaFN3aXRjaCA9IG5ldyBUb2dnbGVTd2l0Y2goIHZvaWNpbmdNYW5hZ2VyLm1haW5XaW5kb3dWb2ljaW5nRW5hYmxlZFByb3BlcnR5LCBmYWxzZSwgdHJ1ZSwgY29tYmluZU9wdGlvbnM8VG9nZ2xlU3dpdGNoT3B0aW9ucz4oIHtcclxuICAgICAgYTExeU5hbWU6IHRpdGxlU3RyaW5nUHJvcGVydHksXHJcbiAgICAgIHJpZ2h0VmFsdWVDb250ZXh0UmVzcG9uc2U6IHNpbVZvaWNpbmdPblN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBsZWZ0VmFsdWVDb250ZXh0UmVzcG9uc2U6IHNpbVZvaWNpbmdPZmZTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdtdXRlU3BlZWNoU3dpdGNoJyApXHJcbiAgICB9LCBQcmVmZXJlbmNlc0RpYWxvZ0NvbnN0YW50cy5UT0dHTEVfU1dJVENIX09QVElPTlMgKSApO1xyXG4gICAgY29uc3QgbXV0ZVNwZWVjaENvbnRyb2wgPSBuZXcgUHJlZmVyZW5jZXNDb250cm9sKCB7XHJcbiAgICAgIGxhYmVsTm9kZTogdGl0bGVUZXh0LFxyXG4gICAgICBjb250cm9sTm9kZTogbXV0ZVNwZWVjaFN3aXRjaCxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdtdXRlU3BlZWNoQ29udHJvbCcgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGxheW91dFxyXG4gICAgY29uc3QgbGFiZWxBbGlnbkdyb3VwID0gbmV3IEFsaWduR3JvdXAoKTtcclxuICAgIGNvbnN0IGlucHV0QWxpZ25Hcm91cCA9IG5ldyBBbGlnbkdyb3VwKCk7XHJcblxyXG4gICAgY29uc3Qgb3ZlcnZpZXdSb3cgPSBuZXcgTGFiZWxCdXR0b25Sb3coIG92ZXJ2aWV3U3RyaW5nUHJvcGVydHksIHBsYXlPdmVydmlld1N0cmluZ1Byb3BlcnR5LCBsYWJlbEFsaWduR3JvdXAsIGlucHV0QWxpZ25Hcm91cCxcclxuICAgICAgbG9va0FuZEZlZWwsIGFsZXJ0TWFuYWdlci5jcmVhdGVPdmVydmlld0NvbnRlbnQuYmluZCggYWxlcnRNYW5hZ2VyICkgKTtcclxuICAgIGNvbnN0IGRldGFpbHNSb3cgPSBuZXcgTGFiZWxCdXR0b25Sb3coIGRldGFpbHNTdHJpbmdQcm9wZXJ0eSwgcGxheURldGFpbHNTdHJpbmdQcm9wZXJ0eSwgbGFiZWxBbGlnbkdyb3VwLCBpbnB1dEFsaWduR3JvdXAsXHJcbiAgICAgIGxvb2tBbmRGZWVsLCBhbGVydE1hbmFnZXIuY3JlYXRlRGV0YWlsc0NvbnRlbnQuYmluZCggYWxlcnRNYW5hZ2VyICkgKTtcclxuICAgIGNvbnN0IGhpbnRSb3cgPSBuZXcgTGFiZWxCdXR0b25Sb3coIGhpbnRTdHJpbmdQcm9wZXJ0eSwgcGxheUhpbnRTdHJpbmdQcm9wZXJ0eSwgbGFiZWxBbGlnbkdyb3VwLCBpbnB1dEFsaWduR3JvdXAsXHJcbiAgICAgIGxvb2tBbmRGZWVsLCBhbGVydE1hbmFnZXIuY3JlYXRlSGludENvbnRlbnQuYmluZCggYWxlcnRNYW5hZ2VyICkgKTtcclxuXHJcbiAgICB0aGlzLmNoaWxkcmVuID0gWyBtdXRlU3BlZWNoQ29udHJvbCwgcXVpY2tJbmZvVGV4dCwgb3ZlcnZpZXdSb3cuY29udGVudCwgZGV0YWlsc1Jvdy5jb250ZW50LCBoaW50Um93LmNvbnRlbnQgXTtcclxuXHJcbiAgICAvLyBsYXlvdXRcclxuICAgIHF1aWNrSW5mb1RleHQubGVmdFRvcCA9IG11dGVTcGVlY2hDb250cm9sLmxlZnRCb3R0b20ucGx1c1hZKCAwLCBDT05URU5UX1ZFUlRJQ0FMX1NQQUNJTkcgKTtcclxuICAgIG92ZXJ2aWV3Um93LmNvbnRlbnQubGVmdFRvcCA9IHF1aWNrSW5mb1RleHQubGVmdEJvdHRvbS5wbHVzWFkoIFFVSUNLX0lORk8sIENPTlRFTlRfVkVSVElDQUxfU1BBQ0lORyApO1xyXG4gICAgZGV0YWlsc1Jvdy5jb250ZW50LmxlZnRUb3AgPSBvdmVydmlld1Jvdy5jb250ZW50LmxlZnRCb3R0b20ucGx1c1hZKCAwLCBDT05URU5UX1ZFUlRJQ0FMX1NQQUNJTkcgKTtcclxuICAgIGhpbnRSb3cuY29udGVudC5sZWZ0VG9wID0gZGV0YWlsc1Jvdy5jb250ZW50LmxlZnRCb3R0b20ucGx1c1hZKCAwLCBDT05URU5UX1ZFUlRJQ0FMX1NQQUNJTkcgKTtcclxuXHJcbiAgICBjb25zdCByb3dzID0gWyBvdmVydmlld1JvdywgZGV0YWlsc1JvdywgaGludFJvdyBdO1xyXG4gICAgY29uc3QgcGxheWluZ1Byb3BlcnRpZXMgPSBbIG92ZXJ2aWV3Um93LnBsYXlpbmdQcm9wZXJ0eSwgZGV0YWlsc1Jvdy5wbGF5aW5nUHJvcGVydHksIGhpbnRSb3cucGxheWluZ1Byb3BlcnR5IF07XHJcblxyXG4gICAgcm93cy5mb3JFYWNoKCByb3cgPT4ge1xyXG4gICAgICByb3cucGxheWluZ1Byb3BlcnR5LmxpbmsoIHBsYXlpbmcgPT4ge1xyXG4gICAgICAgIHJvdy5wbGF5Q29udGVudCggcGxheWluZ1Byb3BlcnRpZXMgKTtcclxuICAgICAgfSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZVZvaWNpbmdUb29sYmFySXRlbSA9ICgpID0+IHtcclxuICAgICAgcXVpY2tJbmZvVGV4dC5kaXNwb3NlKCk7XHJcbiAgICAgIHRpdGxlVGV4dC5kaXNwb3NlKCk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VWb2ljaW5nVG9vbGJhckl0ZW0oKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBbiBpbm5lciBjbGFzcyB0aGF0IG1hbmFnZXMgYSBsYWJlbGxlZCBQbGF5U3RvcEJ1dHRvbiBpbiB0aGUgVm9pY2luZ1Rvb2xiYXJJdGVtLiBDcmVhdGVzIHRoZSBsYWJlbCwgYnV0dG9uLFxyXG4gKiBhbmQgYWRkcyBsaXN0ZW5lcnMgdGhhdCBnZW5lcmF0ZSB0aGUgYWxlcnQgdG8gYmUgVm9pY2VkIGFuZCB0b2dnbGUgdGhlIGJ1dHRvbidzIHBsYXlpbmcgc3RhdGUgd2hlblxyXG4gKiB0aGUgdm9pY2luZ01hbmFnZXIgc3RvcHMgc3BlYWtpbmcuXHJcbiAqL1xyXG5jbGFzcyBMYWJlbEJ1dHRvblJvdyB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgbG9va0FuZEZlZWw6IExvb2tBbmRGZWVsO1xyXG5cclxuICAvLyBBIHVuaXF1ZSBVdHRlcmFuY2UgZm9yIHRoZSBvYmplY3QgcmVzcG9uc2Ugc28gdGhhdCBpdCBjYW4gYmUgaW5kZXBlbmRlbnRseSBjYW5jZWxsZWQgYW5kIGhhdmUgYSBkeW5hbWljIFByaW9yaXR5XHJcbiAgLy8gZGVwZW5kaW5nIG9uIGludGVyYWN0aW9uIHdpdGggdGhlIHNjcmVlbi5cclxuICBwcml2YXRlIHJlYWRvbmx5IG9iamVjdFJlc3BvbnNlVXR0ZXJhbmNlOiBVdHRlcmFuY2U7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBjcmVhdGVBbGVydDogKCkgPT4gU3BlYWthYmxlUmVzb2x2ZWRSZXNwb25zZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IHBsYXlTdG9wQnV0dG9uOiBQbGF5U3RvcEJ1dHRvbjtcclxuXHJcbiAgLy8gV2hldGhlciB0aGUgUGxheVN0b3BCdXR0b24gaGFzIGJlZW4gcHJlc3NlZCBhbmQgdGhlIHZvaWNpbmdNYW5hZ2VyIGlzIGFjdGl2ZWx5IHNwZWFraW5nIHRoaXMgY29udGVudFxyXG4gIHB1YmxpYyByZWFkb25seSBwbGF5aW5nUHJvcGVydHk6IEJvb2xlYW5Qcm9wZXJ0eTtcclxuXHJcbiAgLy8gVGhlIE5vZGUgb2YgY29udGVudCB0byBiZSBkaXNwbGF5ZWQgaW4gdGhlIHZpZXcsIG1hbmFnaW5nIGxheW91dCBvZiB0aGUgbGFiZWwgYW5kIGJ1dHRvblxyXG4gIHB1YmxpYyByZWFkb25seSBjb250ZW50OiBOb2RlO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gbGFiZWxTdHJpbmcgLSB0aGUgdmlzdWFsbHkgcmVuZGVyZWQgVGV4dCBsYWJlbCBmb3IgdGhlIGJ1dHRvblxyXG4gICAqIEBwYXJhbSBhMTF5TmFtZSAtIHRoZSBzdHJpbmcgcmVhZCBpbiB0aGUgUERPTSBhbmQgd2l0aCB0aGUgVm9pY2luZyBmZWF0dXJlIHRoYXQgbGFiZWxzIHRoaXMgQnV0dG9uXHJcbiAgICogQHBhcmFtIGxhYmVsQWxpZ25Hcm91cCAtIFRvIGFsaWduIGFsbCBsYWJlbHMgaW4gdGhlIFZvaWNpbmdUb29sYmFySXRlbVxyXG4gICAqIEBwYXJhbSBpbnB1dEFsaWduR3JvdXAgLSBUbyBhbGlnbiBhbGwgaW5wdXRzIGluIHRoZSBWb2ljaW5nVG9vbGJhckl0ZW1cclxuICAgKiBAcGFyYW0gbG9va0FuZEZlZWxcclxuICAgKiBAcGFyYW0gY3JlYXRlQWxlcnQgLSBmdW5jdGlvbiB0aGF0IGNyZWF0ZXMgdGhlIGFsZXJ0IHdoZW4gdGhlIGJ1dHRvbiBpcyBwcmVzc2VkXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKFxyXG4gICAgbGFiZWxTdHJpbmc6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4sXHJcbiAgICBhMTF5TmFtZTogVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPixcclxuICAgIGxhYmVsQWxpZ25Hcm91cDogQWxpZ25Hcm91cCxcclxuICAgIGlucHV0QWxpZ25Hcm91cDogQWxpZ25Hcm91cCxcclxuICAgIGxvb2tBbmRGZWVsOiBMb29rQW5kRmVlbCxcclxuICAgIGNyZWF0ZUFsZXJ0OiAoKSA9PiBTcGVha2FibGVSZXNvbHZlZFJlc3BvbnNlXHJcbiAgKSB7XHJcblxyXG4gICAgdGhpcy5sb29rQW5kRmVlbCA9IGxvb2tBbmRGZWVsO1xyXG4gICAgdGhpcy5vYmplY3RSZXNwb25zZVV0dGVyYW5jZSA9IG5ldyBVdHRlcmFuY2UoKTtcclxuICAgIHRoaXMuY3JlYXRlQWxlcnQgPSBjcmVhdGVBbGVydDtcclxuXHJcbiAgICB0aGlzLnBsYXlpbmdQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcblxyXG4gICAgICAvLyBTcGVlY2ggaXMgcmVxdWVzdGVkIGZyb20gYSBsaXN0ZW5lciBvbiB0aGUgaXNQbGF5aW5nUHJvcGVydHkuIEJ1dCBpZiB0aGUgYnJvd3NlciBjYW5ub3Qgc3BlYWsgaXQgbWF5XHJcbiAgICAgIC8vIGltbWVkaWF0ZWx5IGNhbmNlbCBzcGVlY2ggYW5kIHNldCB0aGlzIFByb3BlcnR5IHRvIGZhbHNlIGFnYWluIGNhdXNpbmcgcmVlbnRyYW5jeS5cclxuICAgICAgcmVlbnRyYW50OiB0cnVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5wbGF5U3RvcEJ1dHRvbiA9IG5ldyBQbGF5U3RvcEJ1dHRvbiggdGhpcy5wbGF5aW5nUHJvcGVydHksIHtcclxuICAgICAgc3RhcnRQbGF5aW5nTGFiZWw6IGExMXlOYW1lLFxyXG5cclxuICAgICAgLy8gdm9pY2luZ1xyXG4gICAgICB2b2ljaW5nTmFtZVJlc3BvbnNlOiBhMTF5TmFtZSxcclxuICAgICAgdm9pY2luZ0lnbm9yZVZvaWNpbmdNYW5hZ2VyUHJvcGVydGllczogdHJ1ZSxcclxuXHJcbiAgICAgIHJhZGl1czogMTIsXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLk9QVF9PVVRcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCB0ZXh0TGFiZWwgPSBuZXcgVGV4dCggbGFiZWxTdHJpbmcsIHtcclxuICAgICAgZm9udDogbmV3IFBoZXRGb250KCAxMiApLFxyXG4gICAgICBmaWxsOiB0aGlzLmxvb2tBbmRGZWVsLm5hdmlnYXRpb25CYXJUZXh0RmlsbFByb3BlcnR5LFxyXG4gICAgICBtYXhXaWR0aDogMTAwIC8vIGkxOG4sIGJ5IGluc3BlY3Rpb25cclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBsYWJlbEJveCA9IGxhYmVsQWxpZ25Hcm91cC5jcmVhdGVCb3goIHRleHRMYWJlbCwgeyB4QWxpZ246ICdsZWZ0JyB9ICk7XHJcbiAgICBjb25zdCBpbnB1dEJveCA9IGlucHV0QWxpZ25Hcm91cC5jcmVhdGVCb3goIHRoaXMucGxheVN0b3BCdXR0b24sIHsgeEFsaWduOiAncmlnaHQnIH0gKTtcclxuXHJcbiAgICB0aGlzLmNvbnRlbnQgPSBuZXcgSEJveCggeyBjaGlsZHJlbjogWyBsYWJlbEJveCwgaW5wdXRCb3ggXSwgc3BhY2luZzogQ09OVEVOVF9WRVJUSUNBTF9TUEFDSU5HIH0gKTtcclxuXHJcbiAgICB2b2ljaW5nTWFuYWdlci5lbmRTcGVha2luZ0VtaXR0ZXIuYWRkTGlzdGVuZXIoICggdGV4dCwgZW5kZWRVdHRlcmFuY2UgKSA9PiB7XHJcbiAgICAgIGlmICggZW5kZWRVdHRlcmFuY2UgPT09IHRoaXMub2JqZWN0UmVzcG9uc2VVdHRlcmFuY2UgKSB7XHJcbiAgICAgICAgdGhpcy5wbGF5aW5nUHJvcGVydHkuc2V0KCBmYWxzZSApO1xyXG5cclxuICAgICAgICAvLyBSZW1vdmUgaWYgbGlzdGVuZXIgd2Fzbid0IGludGVycnVwdGVkIGJ5IERpc3BsYXkgaW5wdXQuXHJcbiAgICAgICAgaWYgKCBEaXNwbGF5LmlucHV0TGlzdGVuZXJzLmluY2x1ZGVzKCBkaXNwbGF5TGlzdGVuZXIgKSApIHtcclxuICAgICAgICAgIERpc3BsYXkucmVtb3ZlSW5wdXRMaXN0ZW5lciggZGlzcGxheUxpc3RlbmVyICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gUmVkdWNlcyB0aGUgcHJpb3JpdHkgb2YgdGhpcy51dHRlcmFuY2UgYXMgc29vbiBhcyB0aGVyZSBpcyBhbiBpbnRlcmFjdGlvbiB3aXRoIHRoZSBzY3JlZW4gc28gdGhhdCBpdCBtYXlcclxuICAgIC8vIGJlIGludGVycnVwdGVkIGJ5IHNpbXVsYXRpb24gcmVzcG9uc2VzLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2pvaXN0L2lzc3Vlcy83NTIuXHJcbiAgICBjb25zdCByZWR1Y2VQcmlvcml0eUxpc3RlbmVyID0gKCBldmVudDogU2NlbmVyeUV2ZW50ICkgPT4ge1xyXG5cclxuICAgICAgLy8gQWZ0ZXIgYSBkb3duIGV2ZW50IGl0IHdpbGwgYmUgcG9zc2libGUgZm9yIHRoaXMudXR0ZXJhbmNlIHRvIGJlIGludGVycnVwdGVkLiBUaGF0IHdpbGwgdHVybiB0aGUgXCJTdG9wXCIgYnV0dG9uXHJcbiAgICAgIC8vIGludG8gYSBcIlBsYXlcIiBidXR0b24uIElmIHRoZSBtb3VzZSBpcyBzdGlsbCBkb3duIGluIHRoaXMgY2FzZSB0aGUgbmV4dCB1cCBldmVudCBvbiB0aGUgXCJQbGF5XCIgYnV0dG9uIHdpbGxcclxuICAgICAgLy8gaW1tZWRpYXRlbHkgcGxheSBpdHMgY29udGVudCB3aGljaCBpcyB1bmV4cGVjdGVkLiBXZSBnZXQgYXJvdW5kIHRoaXMgYnkgbm90IHJlZHVjaW5nIHByaW9yaXR5IGlmIHRoZSBldmVudFxyXG4gICAgICAvLyBpcyBnb2luZyB0byB0aGlzIGJ1dHRvbi5cclxuICAgICAgaWYgKCAhZXZlbnQudHJhaWwubm9kZXMuaW5jbHVkZXMoIHRoaXMucGxheVN0b3BCdXR0b24gKSApIHtcclxuICAgICAgICBEaXNwbGF5LnJlbW92ZUlucHV0TGlzdGVuZXIoIGRpc3BsYXlMaXN0ZW5lciApO1xyXG5cclxuICAgICAgICAvLyBXYWl0IHVudGlsIHRoZSBsaXN0ZW5lciBpcyByZW1vdmVkIGJlZm9yZSByZWR1Y2luZyB0aGlzLCB0aGlzIG1heSBpbW1lZGlhdGVseSBlbmQgdGhlIFV0dGVyYW5jZSBhbmQgcmVtb3ZlXHJcbiAgICAgICAgLy8gdGhlIGxpc3RlbmVyIGFnYWluIGluIHRoZSBlbmRTcGVha2luZ0xpc3RlbmVyIGFib3ZlLlxyXG4gICAgICAgIHRoaXMub2JqZWN0UmVzcG9uc2VVdHRlcmFuY2UucHJpb3JpdHlQcm9wZXJ0eS52YWx1ZSA9IFV0dGVyYW5jZS5MT1dfUFJJT1JJVFk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgZGlzcGxheUxpc3RlbmVyID0ge1xyXG5cclxuICAgICAgLy8gVGhlIGV2ZW50cyB0aGF0IGluZGljYXRlIHNvbWUga2luZCBvZiBpbnB1dCBzbyB3ZSBzaG91bGQgYWxsb3cgdGhpcy51dHRlcmFuY2UgdG8gYmUgaW50ZXJydXB0ZWQuXHJcbiAgICAgIGRvd246IHJlZHVjZVByaW9yaXR5TGlzdGVuZXIsXHJcbiAgICAgIGZvY3VzOiByZWR1Y2VQcmlvcml0eUxpc3RlbmVyXHJcbiAgICB9O1xyXG5cclxuICAgIHZvaWNpbmdNYW5hZ2VyLnN0YXJ0U3BlYWtpbmdFbWl0dGVyLmFkZExpc3RlbmVyKCAoIHJlc3BvbnNlLCB1dHRlcmFuY2UgKSA9PiB7XHJcbiAgICAgIGlmICggdXR0ZXJhbmNlID09PSB0aGlzLm9iamVjdFJlc3BvbnNlVXR0ZXJhbmNlICkge1xyXG4gICAgICAgIERpc3BsYXkuYWRkSW5wdXRMaXN0ZW5lciggZGlzcGxheUxpc3RlbmVyICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFBsYXkgdGhlIFZvaWNpbmcgY29udGVudCBmb3IgdGhpcyBSb3cuXHJcbiAgICovXHJcbiAgcHVibGljIHBsYXlDb250ZW50KCBwbGF5aW5nUHJvcGVydGllczogQm9vbGVhblByb3BlcnR5W10gKTogdm9pZCB7XHJcblxyXG4gICAgaWYgKCB0aGlzLnBsYXlpbmdQcm9wZXJ0eS52YWx1ZSApIHtcclxuXHJcbiAgICAgIC8vIHdoZW4gb25lIGJ1dHRvbiBpcyBwcmVzc2VkLCBpbW1lZGlhdGVseSBzdG9wIGFueSBvdGhlciBidXR0b25zLCBvbmx5IG9uZSBzaG91bGQgYmUgcGxheWluZyBhdCBhIHRpbWVcclxuICAgICAgY29uc3Qgb3RoZXJQcm9wZXJ0aWVzID0gXy53aXRob3V0KCBwbGF5aW5nUHJvcGVydGllcywgdGhpcy5wbGF5aW5nUHJvcGVydHkgKTtcclxuICAgICAgb3RoZXJQcm9wZXJ0aWVzLmZvckVhY2goIHByb3BlcnR5ID0+IHtcclxuICAgICAgICBwcm9wZXJ0eS52YWx1ZSA9IGZhbHNlO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBUaGlzIHV0dGVyYW5jZSBpcyB0b3AgcHJpb3JpdHkgc28gdGhhdCBpdCBkb2VzIG5vdCBnZXQgaW50ZXJydXB0ZWQgZHVyaW5nIHJlc3BvbnNlcyB0aGF0IGhhcHBlbiBhc1xyXG4gICAgICAvLyB0aGUgc2ltdWxhdGlvbiBjaGFuZ2VzLiBJdCBzdGF5cyB0b3AgcHJpb3JpdHkgdW50aWwgdGhlcmUgaXMgc29tZSBpbnRlcmFjdGlvbiB3aXRoIHRoZSBkaXNwbGF5LlxyXG4gICAgICB0aGlzLm9iamVjdFJlc3BvbnNlVXR0ZXJhbmNlLnByaW9yaXR5UHJvcGVydHkudmFsdWUgPSBVdHRlcmFuY2UuVE9QX1BSSU9SSVRZO1xyXG4gICAgICB0aGlzLnBsYXlTdG9wQnV0dG9uLnZvaWNpbmdTcGVha1Jlc3BvbnNlKCB7XHJcbiAgICAgICAgb2JqZWN0UmVzcG9uc2U6IHRoaXMuY3JlYXRlQWxlcnQoKSxcclxuXHJcbiAgICAgICAgLy8gQSBzZXBwYXJhdGUgVXR0ZXJhbmNlIGZyb20gdGhlIGRlZmF1bHQgdm9pY2luZ1V0dGVyYW5jZSBzbyB0aGF0IGlmIGRlZmF1bHQgcmVzcG9uc2VzIGFyZSBjYW5jZWxsZWQgd2VcclxuICAgICAgICAvLyBkb24ndCBhbHNvIGNhbmNlbCB0aGlzIGNvbnRlbnQgaW4gdGhlIGxpc3RlbmVycyByZWxhdGVkIHRvIHByaW9yaXR5UHJvcGVydHkgYWJvdmUuXHJcbiAgICAgICAgdXR0ZXJhbmNlOiB0aGlzLm9iamVjdFJlc3BvbnNlVXR0ZXJhbmNlXHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB2b2ljaW5nVXR0ZXJhbmNlUXVldWUuY2FuY2VsVXR0ZXJhbmNlKCB0aGlzLm9iamVjdFJlc3BvbnNlVXR0ZXJhbmNlICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5qb2lzdC5yZWdpc3RlciggJ1ZvaWNpbmdUb29sYmFySXRlbScsIFZvaWNpbmdUb29sYmFySXRlbSApO1xyXG5leHBvcnQgZGVmYXVsdCBWb2ljaW5nVG9vbGJhckl0ZW07Il0sIm1hcHBpbmdzIjoiQUFB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