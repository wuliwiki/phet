// Copyright 2015-2022, University of Colorado Boulder

/**
 * UI parts for update-related dialogs
 */

import merge from '../../phet-core/js/merge.js';
import StringUtils from '../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../scenery-phet/js/PhetFont.js';
import SpinningIndicatorNode from '../../scenery-phet/js/SpinningIndicatorNode.js';
import { allowLinksProperty, HBox, openPopup, Path, Rectangle, RichText, VBox, VoicingText, VStrut } from '../../scenery/js/imports.js';
import checkSolidShape from '../../sherpa/js/fontawesome-5/checkSolidShape.js';
import exclamationTriangleSolidShape from '../../sherpa/js/fontawesome-5/exclamationTriangleSolidShape.js';
import TextPushButton from '../../sun/js/buttons/TextPushButton.js';
import joist from './joist.js';
import JoistStrings from './JoistStrings.js';
import updateCheck from './updateCheck.js';
import UpdateState from './UpdateState.js';
import DerivedProperty from '../../axon/js/DerivedProperty.js';

// constants
const UPDATE_TEXT_FONT = new PhetFont(14);
const MAX_WIDTH = 550; // Maximum width of the resulting update items

const UpdateNodes = {
  /**
   * "Checking" state node. With two size options (if options.big == true, it will be bigger)
   *
   * [options] - passed to the Node
   * returns step( dt ) and stepListener (bound to the node itself)
   * (joist-internal)
   */
  createCheckingNode: function (options) {
    const spinningIndicatorNode = new SpinningIndicatorNode({
      diameter: options.big ? 24 : 18
    });
    const checkingNode = new HBox(merge({
      spacing: options.big ? 10 : 8,
      maxWidth: MAX_WIDTH,
      children: [spinningIndicatorNode, new VoicingText(JoistStrings.updates.checkingStringProperty, {
        font: new PhetFont(options.big ? 16 : 14),
        fontWeight: options.big ? 'bold' : 'normal'
      })]
    }, options));
    checkingNode.step = function (dt) {
      if (updateCheck.stateProperty.value === UpdateState.CHECKING) {
        spinningIndicatorNode.step(dt);
      }
    };
    checkingNode.stepListener = checkingNode.step.bind(checkingNode);
    return checkingNode;
  },
  /**
   * "Up-to-date" state node
   * [options] - passed to the Node
   * (joist-internal)
   */
  createUpToDateNode: function (options) {
    return new HBox(merge({
      spacing: 8,
      maxWidth: MAX_WIDTH,
      children: [new Rectangle(0, 0, 20, 20, 5, 5, {
        fill: '#5c3',
        scale: options.big ? 1.2 : 1,
        children: [new Path(checkSolidShape, {
          fill: '#fff',
          scale: 0.029,
          centerX: 10,
          centerY: 10
        })]
      }), new VoicingText(JoistStrings.updates.upToDateStringProperty, {
        font: new PhetFont(options.big ? 16 : 14),
        fontWeight: options.big ? 'bold' : 'normal'
      })]
    }, options));
  },
  /**
   * "Out-of-date" state node for the "About" dialog.
   * [options] - passed to the Node
   * (joist-internal)
   */
  createOutOfDateAboutNode: function (options) {
    const stringProperty = new DerivedProperty([JoistStrings.updates.outOfDateStringProperty, allowLinksProperty], (outOfDateString, allowLinks) => {
      return allowLinks ? `<a href="{{url}}">${outOfDateString}</a>` : outOfDateString;
    });
    const links = {
      url: updateCheck.updateURL
    };
    const linkNode = new RichText(stringProperty, {
      links: links,
      font: UPDATE_TEXT_FONT
    });
    return new HBox(merge({
      spacing: 8,
      maxWidth: MAX_WIDTH,
      children: [new Path(exclamationTriangleSolidShape, {
        fill: '#E87600',
        // "safety orange", according to Wikipedia
        scale: 0.03
      }), linkNode],
      // pdom
      tagName: 'div'
    }, options));
  },
  /**
   * "Out-of-date" state node for the "Check for update" dialog.
   * dialog - the dialog, so that it can be closed with the "No thanks..." button
   * [options] - passed to the Node
   * (joist-internal)
   */
  createOutOfDateDialogNode: function (dialog, ourVersionString, latestVersionString, options) {
    const latestVersionStringProperty = new DerivedProperty([JoistStrings.updates.newVersionAvailableStringProperty], string => {
      return StringUtils.format(string, latestVersionString);
    });
    const ourVersionStringProperty = new DerivedProperty([JoistStrings.updates.yourCurrentVersionStringProperty], string => {
      return StringUtils.format(string, ourVersionString);
    });
    return new VBox(merge({
      spacing: 15,
      maxWidth: MAX_WIDTH,
      children: [new VBox({
        spacing: 5,
        align: 'left',
        children: [new VoicingText(latestVersionStringProperty, {
          font: new PhetFont(16),
          fontWeight: 'bold'
        }), new VoicingText(ourVersionStringProperty, {
          font: UPDATE_TEXT_FONT
        })]
      }), new HBox({
        spacing: 25,
        children: [new TextPushButton(JoistStrings.updates.getUpdateStringProperty, {
          visibleProperty: allowLinksProperty,
          baseColor: '#6f6',
          font: UPDATE_TEXT_FONT,
          listener: function () {
            openPopup(updateCheck.updateURL); // open in a new window/tab
          }
        }), new TextPushButton(JoistStrings.updates.noThanksStringProperty, {
          baseColor: '#ddd',
          font: UPDATE_TEXT_FONT,
          listener: function () {
            dialog.hide();

            // Closing the dialog is handled by the Dialog listener itself, no need to add code to close it here.
          }
        })]
      })]
    }, options));
  },
  /**
   * "Offline" state node
   * [options] - passed to the Node
   * (joist-internal)
   */
  createOfflineNode: function (options) {
    return new HBox(merge({
      spacing: 0,
      maxWidth: MAX_WIDTH,
      children: [new VStrut(20),
      // spacer to match layout of other nodes
      new VoicingText(JoistStrings.updates.offlineStringProperty, {
        font: new PhetFont(options.big ? 16 : 14),
        fontWeight: options.big ? 'bold' : 'normal'
      })]
    }, options));
  }
};
joist.register('UpdateNodes', UpdateNodes);
export default UpdateNodes;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtZXJnZSIsIlN0cmluZ1V0aWxzIiwiUGhldEZvbnQiLCJTcGlubmluZ0luZGljYXRvck5vZGUiLCJhbGxvd0xpbmtzUHJvcGVydHkiLCJIQm94Iiwib3BlblBvcHVwIiwiUGF0aCIsIlJlY3RhbmdsZSIsIlJpY2hUZXh0IiwiVkJveCIsIlZvaWNpbmdUZXh0IiwiVlN0cnV0IiwiY2hlY2tTb2xpZFNoYXBlIiwiZXhjbGFtYXRpb25UcmlhbmdsZVNvbGlkU2hhcGUiLCJUZXh0UHVzaEJ1dHRvbiIsImpvaXN0IiwiSm9pc3RTdHJpbmdzIiwidXBkYXRlQ2hlY2siLCJVcGRhdGVTdGF0ZSIsIkRlcml2ZWRQcm9wZXJ0eSIsIlVQREFURV9URVhUX0ZPTlQiLCJNQVhfV0lEVEgiLCJVcGRhdGVOb2RlcyIsImNyZWF0ZUNoZWNraW5nTm9kZSIsIm9wdGlvbnMiLCJzcGlubmluZ0luZGljYXRvck5vZGUiLCJkaWFtZXRlciIsImJpZyIsImNoZWNraW5nTm9kZSIsInNwYWNpbmciLCJtYXhXaWR0aCIsImNoaWxkcmVuIiwidXBkYXRlcyIsImNoZWNraW5nU3RyaW5nUHJvcGVydHkiLCJmb250IiwiZm9udFdlaWdodCIsInN0ZXAiLCJkdCIsInN0YXRlUHJvcGVydHkiLCJ2YWx1ZSIsIkNIRUNLSU5HIiwic3RlcExpc3RlbmVyIiwiYmluZCIsImNyZWF0ZVVwVG9EYXRlTm9kZSIsImZpbGwiLCJzY2FsZSIsImNlbnRlclgiLCJjZW50ZXJZIiwidXBUb0RhdGVTdHJpbmdQcm9wZXJ0eSIsImNyZWF0ZU91dE9mRGF0ZUFib3V0Tm9kZSIsInN0cmluZ1Byb3BlcnR5Iiwib3V0T2ZEYXRlU3RyaW5nUHJvcGVydHkiLCJvdXRPZkRhdGVTdHJpbmciLCJhbGxvd0xpbmtzIiwibGlua3MiLCJ1cmwiLCJ1cGRhdGVVUkwiLCJsaW5rTm9kZSIsInRhZ05hbWUiLCJjcmVhdGVPdXRPZkRhdGVEaWFsb2dOb2RlIiwiZGlhbG9nIiwib3VyVmVyc2lvblN0cmluZyIsImxhdGVzdFZlcnNpb25TdHJpbmciLCJsYXRlc3RWZXJzaW9uU3RyaW5nUHJvcGVydHkiLCJuZXdWZXJzaW9uQXZhaWxhYmxlU3RyaW5nUHJvcGVydHkiLCJzdHJpbmciLCJmb3JtYXQiLCJvdXJWZXJzaW9uU3RyaW5nUHJvcGVydHkiLCJ5b3VyQ3VycmVudFZlcnNpb25TdHJpbmdQcm9wZXJ0eSIsImFsaWduIiwiZ2V0VXBkYXRlU3RyaW5nUHJvcGVydHkiLCJ2aXNpYmxlUHJvcGVydHkiLCJiYXNlQ29sb3IiLCJsaXN0ZW5lciIsIm5vVGhhbmtzU3RyaW5nUHJvcGVydHkiLCJoaWRlIiwiY3JlYXRlT2ZmbGluZU5vZGUiLCJvZmZsaW5lU3RyaW5nUHJvcGVydHkiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlVwZGF0ZU5vZGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFVJIHBhcnRzIGZvciB1cGRhdGUtcmVsYXRlZCBkaWFsb2dzXHJcbiAqL1xyXG5cclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBTdHJpbmdVdGlscyBmcm9tICcuLi8uLi9waGV0Y29tbW9uL2pzL3V0aWwvU3RyaW5nVXRpbHMuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IFNwaW5uaW5nSW5kaWNhdG9yTm9kZSBmcm9tICcuLi8uLi9zY2VuZXJ5LXBoZXQvanMvU3Bpbm5pbmdJbmRpY2F0b3JOb2RlLmpzJztcclxuaW1wb3J0IHsgYWxsb3dMaW5rc1Byb3BlcnR5LCBIQm94LCBOb2RlLCBvcGVuUG9wdXAsIFBhdGgsIFJlY3RhbmdsZSwgUmljaFRleHQsIFJpY2hUZXh0TGlua3MsIFZCb3gsIFZvaWNpbmdUZXh0LCBWU3RydXQgfSBmcm9tICcuLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgY2hlY2tTb2xpZFNoYXBlIGZyb20gJy4uLy4uL3NoZXJwYS9qcy9mb250YXdlc29tZS01L2NoZWNrU29saWRTaGFwZS5qcyc7XHJcbmltcG9ydCBleGNsYW1hdGlvblRyaWFuZ2xlU29saWRTaGFwZSBmcm9tICcuLi8uLi9zaGVycGEvanMvZm9udGF3ZXNvbWUtNS9leGNsYW1hdGlvblRyaWFuZ2xlU29saWRTaGFwZS5qcyc7XHJcbmltcG9ydCBUZXh0UHVzaEJ1dHRvbiBmcm9tICcuLi8uLi9zdW4vanMvYnV0dG9ucy9UZXh0UHVzaEJ1dHRvbi5qcyc7XHJcbmltcG9ydCBqb2lzdCBmcm9tICcuL2pvaXN0LmpzJztcclxuaW1wb3J0IEpvaXN0U3RyaW5ncyBmcm9tICcuL0pvaXN0U3RyaW5ncy5qcyc7XHJcbmltcG9ydCB1cGRhdGVDaGVjayBmcm9tICcuL3VwZGF0ZUNoZWNrLmpzJztcclxuaW1wb3J0IFVwZGF0ZVN0YXRlIGZyb20gJy4vVXBkYXRlU3RhdGUuanMnO1xyXG5pbXBvcnQgVXBkYXRlRGlhbG9nIGZyb20gJy4vVXBkYXRlRGlhbG9nLmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgVVBEQVRFX1RFWFRfRk9OVCA9IG5ldyBQaGV0Rm9udCggMTQgKTtcclxuY29uc3QgTUFYX1dJRFRIID0gNTUwOyAvLyBNYXhpbXVtIHdpZHRoIG9mIHRoZSByZXN1bHRpbmcgdXBkYXRlIGl0ZW1zXHJcblxyXG50eXBlIE9wdGlvbnMgPSB7XHJcbiAgYmlnPzogYm9vbGVhbjtcclxuICBjZW50ZXJYPzogbnVtYmVyO1xyXG4gIGNlbnRlclk/OiBudW1iZXI7XHJcbiAgbGVmdD86IG51bWJlcjtcclxuICB0b3A/OiBudW1iZXI7XHJcbn07XHJcblxyXG50eXBlIFRTdGVwID0ge1xyXG4gIHN0ZXA6ICggZHQ6IG51bWJlciApID0+IHZvaWQ7XHJcbiAgc3RlcExpc3RlbmVyOiAoIGR0OiBudW1iZXIgKSA9PiB2b2lkO1xyXG59O1xyXG5cclxudHlwZSBUU3RlcEhCb3ggPSBUU3RlcCAmIEhCb3g7XHJcblxyXG5jb25zdCBVcGRhdGVOb2RlcyA9IHtcclxuXHJcbiAgLyoqXHJcbiAgICogXCJDaGVja2luZ1wiIHN0YXRlIG5vZGUuIFdpdGggdHdvIHNpemUgb3B0aW9ucyAoaWYgb3B0aW9ucy5iaWcgPT0gdHJ1ZSwgaXQgd2lsbCBiZSBiaWdnZXIpXHJcbiAgICpcclxuICAgKiBbb3B0aW9uc10gLSBwYXNzZWQgdG8gdGhlIE5vZGVcclxuICAgKiByZXR1cm5zIHN0ZXAoIGR0ICkgYW5kIHN0ZXBMaXN0ZW5lciAoYm91bmQgdG8gdGhlIG5vZGUgaXRzZWxmKVxyXG4gICAqIChqb2lzdC1pbnRlcm5hbClcclxuICAgKi9cclxuICBjcmVhdGVDaGVja2luZ05vZGU6IGZ1bmN0aW9uKCBvcHRpb25zOiBPcHRpb25zICk6IE5vZGUgJiBUU3RlcCB7XHJcbiAgICBjb25zdCBzcGlubmluZ0luZGljYXRvck5vZGUgPSBuZXcgU3Bpbm5pbmdJbmRpY2F0b3JOb2RlKCB7IGRpYW1ldGVyOiBvcHRpb25zLmJpZyA/IDI0IDogMTggfSApO1xyXG4gICAgY29uc3QgY2hlY2tpbmdOb2RlID0gbmV3IEhCb3goIG1lcmdlKCB7XHJcbiAgICAgIHNwYWNpbmc6IG9wdGlvbnMuYmlnID8gMTAgOiA4LFxyXG4gICAgICBtYXhXaWR0aDogTUFYX1dJRFRILFxyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIHNwaW5uaW5nSW5kaWNhdG9yTm9kZSxcclxuICAgICAgICBuZXcgVm9pY2luZ1RleHQoIEpvaXN0U3RyaW5ncy51cGRhdGVzLmNoZWNraW5nU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggb3B0aW9ucy5iaWcgPyAxNiA6IDE0ICksXHJcbiAgICAgICAgICBmb250V2VpZ2h0OiBvcHRpb25zLmJpZyA/ICdib2xkJyA6ICdub3JtYWwnXHJcbiAgICAgICAgfSApXHJcbiAgICAgIF1cclxuICAgIH0sIG9wdGlvbnMgKSApIGFzIFRTdGVwSEJveDtcclxuICAgIGNoZWNraW5nTm9kZS5zdGVwID0gZnVuY3Rpb24oIGR0ICkge1xyXG4gICAgICBpZiAoIHVwZGF0ZUNoZWNrLnN0YXRlUHJvcGVydHkudmFsdWUgPT09IFVwZGF0ZVN0YXRlLkNIRUNLSU5HICkge1xyXG4gICAgICAgIHNwaW5uaW5nSW5kaWNhdG9yTm9kZS5zdGVwKCBkdCApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgY2hlY2tpbmdOb2RlLnN0ZXBMaXN0ZW5lciA9IGNoZWNraW5nTm9kZS5zdGVwLmJpbmQoIGNoZWNraW5nTm9kZSApO1xyXG4gICAgcmV0dXJuIGNoZWNraW5nTm9kZTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiBcIlVwLXRvLWRhdGVcIiBzdGF0ZSBub2RlXHJcbiAgICogW29wdGlvbnNdIC0gcGFzc2VkIHRvIHRoZSBOb2RlXHJcbiAgICogKGpvaXN0LWludGVybmFsKVxyXG4gICAqL1xyXG4gIGNyZWF0ZVVwVG9EYXRlTm9kZTogZnVuY3Rpb24oIG9wdGlvbnM6IE9wdGlvbnMgKTogTm9kZSB7XHJcbiAgICByZXR1cm4gbmV3IEhCb3goIG1lcmdlKCB7XHJcbiAgICAgIHNwYWNpbmc6IDgsXHJcbiAgICAgIG1heFdpZHRoOiBNQVhfV0lEVEgsXHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgbmV3IFJlY3RhbmdsZSggMCwgMCwgMjAsIDIwLCA1LCA1LCB7XHJcbiAgICAgICAgICBmaWxsOiAnIzVjMycsXHJcbiAgICAgICAgICBzY2FsZTogb3B0aW9ucy5iaWcgPyAxLjIgOiAxLFxyXG4gICAgICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICAgICAgbmV3IFBhdGgoIGNoZWNrU29saWRTaGFwZSwge1xyXG4gICAgICAgICAgICAgIGZpbGw6ICcjZmZmJyxcclxuICAgICAgICAgICAgICBzY2FsZTogMC4wMjksXHJcbiAgICAgICAgICAgICAgY2VudGVyWDogMTAsXHJcbiAgICAgICAgICAgICAgY2VudGVyWTogMTBcclxuICAgICAgICAgICAgfSApXHJcbiAgICAgICAgICBdXHJcbiAgICAgICAgfSApLFxyXG4gICAgICAgIG5ldyBWb2ljaW5nVGV4dCggSm9pc3RTdHJpbmdzLnVwZGF0ZXMudXBUb0RhdGVTdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICAgICAgZm9udDogbmV3IFBoZXRGb250KCBvcHRpb25zLmJpZyA/IDE2IDogMTQgKSxcclxuICAgICAgICAgIGZvbnRXZWlnaHQ6IG9wdGlvbnMuYmlnID8gJ2JvbGQnIDogJ25vcm1hbCdcclxuICAgICAgICB9IClcclxuICAgICAgXVxyXG4gICAgfSwgb3B0aW9ucyApICk7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogXCJPdXQtb2YtZGF0ZVwiIHN0YXRlIG5vZGUgZm9yIHRoZSBcIkFib3V0XCIgZGlhbG9nLlxyXG4gICAqIFtvcHRpb25zXSAtIHBhc3NlZCB0byB0aGUgTm9kZVxyXG4gICAqIChqb2lzdC1pbnRlcm5hbClcclxuICAgKi9cclxuICBjcmVhdGVPdXRPZkRhdGVBYm91dE5vZGU6IGZ1bmN0aW9uKCBvcHRpb25zOiBPcHRpb25zICk6IE5vZGUge1xyXG4gICAgY29uc3Qgc3RyaW5nUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIEpvaXN0U3RyaW5ncy51cGRhdGVzLm91dE9mRGF0ZVN0cmluZ1Byb3BlcnR5LCBhbGxvd0xpbmtzUHJvcGVydHkgXSwgKCBvdXRPZkRhdGVTdHJpbmcsIGFsbG93TGlua3MgKSA9PiB7XHJcbiAgICAgIHJldHVybiBhbGxvd0xpbmtzID8gYDxhIGhyZWY9XCJ7e3VybH19XCI+JHtvdXRPZkRhdGVTdHJpbmd9PC9hPmAgOiBvdXRPZkRhdGVTdHJpbmc7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgbGlua3M6IFJpY2hUZXh0TGlua3MgPSB7IHVybDogdXBkYXRlQ2hlY2sudXBkYXRlVVJMIH07XHJcblxyXG4gICAgY29uc3QgbGlua05vZGUgPSBuZXcgUmljaFRleHQoIHN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgIGxpbmtzOiBsaW5rcyxcclxuICAgICAgZm9udDogVVBEQVRFX1RFWFRfRk9OVFxyXG4gICAgfSApO1xyXG4gICAgcmV0dXJuIG5ldyBIQm94KCBtZXJnZSgge1xyXG4gICAgICBzcGFjaW5nOiA4LFxyXG4gICAgICBtYXhXaWR0aDogTUFYX1dJRFRILFxyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIG5ldyBQYXRoKCBleGNsYW1hdGlvblRyaWFuZ2xlU29saWRTaGFwZSwge1xyXG4gICAgICAgICAgZmlsbDogJyNFODc2MDAnLCAvLyBcInNhZmV0eSBvcmFuZ2VcIiwgYWNjb3JkaW5nIHRvIFdpa2lwZWRpYVxyXG4gICAgICAgICAgc2NhbGU6IDAuMDNcclxuICAgICAgICB9ICksXHJcbiAgICAgICAgbGlua05vZGVcclxuICAgICAgXSxcclxuXHJcbiAgICAgIC8vIHBkb21cclxuICAgICAgdGFnTmFtZTogJ2RpdidcclxuICAgIH0sIG9wdGlvbnMgKSApO1xyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIFwiT3V0LW9mLWRhdGVcIiBzdGF0ZSBub2RlIGZvciB0aGUgXCJDaGVjayBmb3IgdXBkYXRlXCIgZGlhbG9nLlxyXG4gICAqIGRpYWxvZyAtIHRoZSBkaWFsb2csIHNvIHRoYXQgaXQgY2FuIGJlIGNsb3NlZCB3aXRoIHRoZSBcIk5vIHRoYW5rcy4uLlwiIGJ1dHRvblxyXG4gICAqIFtvcHRpb25zXSAtIHBhc3NlZCB0byB0aGUgTm9kZVxyXG4gICAqIChqb2lzdC1pbnRlcm5hbClcclxuICAgKi9cclxuICBjcmVhdGVPdXRPZkRhdGVEaWFsb2dOb2RlOiBmdW5jdGlvbiggZGlhbG9nOiBVcGRhdGVEaWFsb2csIG91clZlcnNpb25TdHJpbmc6IHN0cmluZywgbGF0ZXN0VmVyc2lvblN0cmluZzogc3RyaW5nLCBvcHRpb25zOiBPcHRpb25zICk6IE5vZGUge1xyXG5cclxuICAgIGNvbnN0IGxhdGVzdFZlcnNpb25TdHJpbmdQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgSm9pc3RTdHJpbmdzLnVwZGF0ZXMubmV3VmVyc2lvbkF2YWlsYWJsZVN0cmluZ1Byb3BlcnR5IF0sIHN0cmluZyA9PiB7XHJcbiAgICAgIHJldHVybiBTdHJpbmdVdGlscy5mb3JtYXQoIHN0cmluZywgbGF0ZXN0VmVyc2lvblN0cmluZyApO1xyXG4gICAgfSApO1xyXG4gICAgY29uc3Qgb3VyVmVyc2lvblN0cmluZ1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBKb2lzdFN0cmluZ3MudXBkYXRlcy55b3VyQ3VycmVudFZlcnNpb25TdHJpbmdQcm9wZXJ0eSBdLCBzdHJpbmcgPT4ge1xyXG4gICAgICByZXR1cm4gU3RyaW5nVXRpbHMuZm9ybWF0KCBzdHJpbmcsIG91clZlcnNpb25TdHJpbmcgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFZCb3goIG1lcmdlKCB7XHJcbiAgICAgIHNwYWNpbmc6IDE1LFxyXG4gICAgICBtYXhXaWR0aDogTUFYX1dJRFRILFxyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIG5ldyBWQm94KCB7XHJcbiAgICAgICAgICBzcGFjaW5nOiA1LCBhbGlnbjogJ2xlZnQnLCBjaGlsZHJlbjogW1xyXG4gICAgICAgICAgICBuZXcgVm9pY2luZ1RleHQoIGxhdGVzdFZlcnNpb25TdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICAgICAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTYgKSwgZm9udFdlaWdodDogJ2JvbGQnXHJcbiAgICAgICAgICAgIH0gKSxcclxuICAgICAgICAgICAgbmV3IFZvaWNpbmdUZXh0KCBvdXJWZXJzaW9uU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgICAgICAgICBmb250OiBVUERBVEVfVEVYVF9GT05UXHJcbiAgICAgICAgICAgIH0gKVxyXG4gICAgICAgICAgXVxyXG4gICAgICAgIH0gKSxcclxuICAgICAgICBuZXcgSEJveCgge1xyXG4gICAgICAgICAgc3BhY2luZzogMjUsIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgICAgIG5ldyBUZXh0UHVzaEJ1dHRvbiggSm9pc3RTdHJpbmdzLnVwZGF0ZXMuZ2V0VXBkYXRlU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgICAgICAgICB2aXNpYmxlUHJvcGVydHk6IGFsbG93TGlua3NQcm9wZXJ0eSxcclxuICAgICAgICAgICAgICBiYXNlQ29sb3I6ICcjNmY2JywgZm9udDogVVBEQVRFX1RFWFRfRk9OVCwgbGlzdGVuZXI6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgb3BlblBvcHVwKCB1cGRhdGVDaGVjay51cGRhdGVVUkwgKTsgLy8gb3BlbiBpbiBhIG5ldyB3aW5kb3cvdGFiXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ICksXHJcbiAgICAgICAgICAgIG5ldyBUZXh0UHVzaEJ1dHRvbiggSm9pc3RTdHJpbmdzLnVwZGF0ZXMubm9UaGFua3NTdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICAgICAgICAgIGJhc2VDb2xvcjogJyNkZGQnLCBmb250OiBVUERBVEVfVEVYVF9GT05ULCBsaXN0ZW5lcjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBkaWFsb2cuaGlkZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENsb3NpbmcgdGhlIGRpYWxvZyBpcyBoYW5kbGVkIGJ5IHRoZSBEaWFsb2cgbGlzdGVuZXIgaXRzZWxmLCBubyBuZWVkIHRvIGFkZCBjb2RlIHRvIGNsb3NlIGl0IGhlcmUuXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IClcclxuICAgICAgICAgIF1cclxuICAgICAgICB9IClcclxuICAgICAgXVxyXG4gICAgfSwgb3B0aW9ucyApICk7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogXCJPZmZsaW5lXCIgc3RhdGUgbm9kZVxyXG4gICAqIFtvcHRpb25zXSAtIHBhc3NlZCB0byB0aGUgTm9kZVxyXG4gICAqIChqb2lzdC1pbnRlcm5hbClcclxuICAgKi9cclxuICBjcmVhdGVPZmZsaW5lTm9kZTogZnVuY3Rpb24oIG9wdGlvbnM6IE9wdGlvbnMgKTogTm9kZSB7XHJcbiAgICByZXR1cm4gbmV3IEhCb3goIG1lcmdlKCB7XHJcbiAgICAgIHNwYWNpbmc6IDAsXHJcbiAgICAgIG1heFdpZHRoOiBNQVhfV0lEVEgsXHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgbmV3IFZTdHJ1dCggMjAgKSwgLy8gc3BhY2VyIHRvIG1hdGNoIGxheW91dCBvZiBvdGhlciBub2Rlc1xyXG4gICAgICAgIG5ldyBWb2ljaW5nVGV4dCggSm9pc3RTdHJpbmdzLnVwZGF0ZXMub2ZmbGluZVN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgICAgICBmb250OiBuZXcgUGhldEZvbnQoIG9wdGlvbnMuYmlnID8gMTYgOiAxNCApLFxyXG4gICAgICAgICAgZm9udFdlaWdodDogb3B0aW9ucy5iaWcgPyAnYm9sZCcgOiAnbm9ybWFsJ1xyXG4gICAgICAgIH0gKVxyXG4gICAgICBdXHJcbiAgICB9LCBvcHRpb25zICkgKTtcclxuICB9XHJcbn07XHJcblxyXG5qb2lzdC5yZWdpc3RlciggJ1VwZGF0ZU5vZGVzJywgVXBkYXRlTm9kZXMgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFVwZGF0ZU5vZGVzOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsV0FBVyxNQUFNLHlDQUF5QztBQUNqRSxPQUFPQyxRQUFRLE1BQU0sbUNBQW1DO0FBQ3hELE9BQU9DLHFCQUFxQixNQUFNLGdEQUFnRDtBQUNsRixTQUFTQyxrQkFBa0IsRUFBRUMsSUFBSSxFQUFRQyxTQUFTLEVBQUVDLElBQUksRUFBRUMsU0FBUyxFQUFFQyxRQUFRLEVBQWlCQyxJQUFJ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