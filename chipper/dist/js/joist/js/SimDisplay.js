// Copyright 2021-2023, University of Colorado Boulder

/**
 * Wrap the Display class in sim-specific logic. This includes fuzzing support, browser workarounds that have come up
 * over the years, and many listeners added the Display Instance.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 * @author Michael Kauzmann (PhET Interactive Simulations)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import BooleanProperty from '../../axon/js/BooleanProperty.js';
import DynamicStringTest from './DynamicStringTest.js';
import optionize from '../../phet-core/js/optionize.js';
import { animatedPanZoomSingleton, Display, InputFuzzer, KeyboardFuzzer, Node, scenery, Utils } from '../../scenery/js/imports.js';
import '../../sherpa/lib/game-up-camera-1.0.0.js';
import Tandem from '../../tandem/js/Tandem.js';
import HighlightVisibilityController from './HighlightVisibilityController.js';
import joist from './joist.js';
export default class SimDisplay extends Display {
  // root for the simulation and the target for AnimatedPanZoomListener to support magnification since the Display rootNode
  // cannot be transformed
  simulationRoot = new Node();

  // Add a listener to the Display that controls visibility of various highlights in response to user input.

  // For consistent option defaults
  static DEFAULT_WEBGL = false;
  constructor(providedOptions) {
    const options = optionize()({
      // the default renderer for the rootNode, see #221, #184 and https://github.com/phetsims/molarity/issues/24
      rootRenderer: 'svg',
      // Sims that do not use WebGL trigger a ~ 0.5 second pause shortly after the sim starts up, so sims must opt in to
      // webgl support, see https://github.com/phetsims/scenery/issues/621
      webgl: SimDisplay.DEFAULT_WEBGL,
      // {boolean} - Whether to allow WebGL 2x scaling when antialiasing is detected. If running out of memory on
      // things like iPad 2s (e.g. https://github.com/phetsims/scenery/issues/859), this can be turned to false.
      allowBackingScaleAntialiasing: true,
      // prevent overflow that can cause iOS bugginess, see https://github.com/phetsims/phet-io/issues/341
      allowSceneOverflow: false,
      // Indicate whether webgl is allowed to facilitate testing on non-webgl platforms, see https://github.com/phetsims/scenery/issues/289
      allowWebGL: phet.chipper.queryParameters.webgl,
      assumeFullWindow: true,
      // a bit faster if we can assume no coordinate translations are needed for the display.

      // pdom accessibility (interactive description)
      accessibility: phet.chipper.queryParameters.supportsInteractiveDescription,
      // phet-io
      tandem: Tandem.REQUIRED
    }, providedOptions);

    // Support for Interactive Highlights dictated by the preferences model.
    options.supportsInteractiveHighlights = options.preferencesModel.visualModel.supportsInteractiveHighlights;

    // override rootRenderer using query parameter, see #221 and #184
    options.rootRenderer = phet.chipper.queryParameters.rootRenderer || options.rootRenderer;

    // Supplied query parameters override options (but default values for non-supplied query parameters do not).
    if (QueryStringMachine.containsKey('webgl')) {
      options.webgl = phet.chipper.queryParameters.webgl;
    }
    Utils.setWebGLEnabled(options.webgl);

    // override window.open with a semi-API-compatible function, so fuzzing doesn't open new windows.
    if (phet.chipper.isFuzzEnabled()) {
      // @ts-expect-error - it isn't yet clear how to define objects to window just yet
      window.open = function () {
        return {
          focus: _.noop,
          blur: _.noop
        };
      };
    }
    const $body = $('body');

    // prevent scrollbars
    $body.css('padding', '0').css('margin', '0').css('overflow', 'hidden');

    // check to see if the sim div already exists in the DOM under the body. This is the case for https://github.com/phetsims/scenery/issues/174 (iOS offline reading list)
    if (document.getElementById('sim') && document.getElementById('sim').parentNode === document.body) {
      document.body.removeChild(document.getElementById('sim'));
    }

    // Prevents selection cursor issues in Safari, see https://github.com/phetsims/scenery/issues/476
    document.onselectstart = function () {
      return false;
    };
    super(new Node({
      renderer: options.rootRenderer
    }), options);
    this.simulationRoot = new Node();
    this.rootNode.addChild(this.simulationRoot);

    // Seeding by default a random value for reproducible fuzzes if desired
    const fuzzerSeed = phet.chipper.queryParameters.randomSeed * Math.PI;
    this.inputFuzzer = new InputFuzzer(this, fuzzerSeed);
    this.keyboardFuzzer = new KeyboardFuzzer(this, fuzzerSeed);
    this.supportsPanAndZoomProperty = new BooleanProperty(phet.chipper.queryParameters.supportsPanAndZoom, {
      tandem: options.tandem.createTandem('supportsPanAndZoomProperty'),
      phetioFeatured: true
    });
    this.domElement.id = 'sim';
    if (phet.chipper.queryParameters.supportsInteractiveDescription) {
      // for now interactive description is only in English
      // NOTE: When translatable this will need to update with language, change to phet.chipper.local
      this.pdomRootElement.lang = 'en';
    }
    this.highlightVisibilityController = new HighlightVisibilityController(this, options.preferencesModel);
    if (phet.chipper.queryParameters.sceneryLog) {
      // @ts-expect-error - until scenery.js is converted to typescript, which is non-trivial (I tried)
      scenery.enableLogging(phet.chipper.queryParameters.sceneryLog);
    }
    if (phet.chipper.queryParameters.sceneryStringLog) {
      // @ts-expect-error - until scenery.js is converted to typescript, which is non-trivial (I tried)
      scenery.switchLogToString();
    }

    // See https://github.com/phetsims/chipper/issues/1319
    if (phet.chipper.queryParameters.stringTest === 'dynamic') {
      const dynamicStringTest = new DynamicStringTest();
      window.addEventListener('keydown', event => dynamicStringTest.handleEvent(event));
    }
    this.initializeEvents({
      tandem: Tandem.GENERAL_CONTROLLER.createTandem('input')
    }); // sets up listeners on the document with preventDefault(), and forwards those events to our scene

    window.phet.joist.rootNode = this.rootNode; // make the scene available for debugging
    window.phet.joist.display = this; // make the display available for debugging

    // Pass through query parameters to scenery for showing supplemental information
    this.setPointerDisplayVisible(phet.chipper.queryParameters.showPointers);
    this.setPointerAreaDisplayVisible(phet.chipper.queryParameters.showPointerAreas);
    this.setHitAreaDisplayVisible(phet.chipper.queryParameters.showHitAreas);
    this.setCanvasNodeBoundsVisible(phet.chipper.queryParameters.showCanvasNodeBounds);
    this.setFittedBlockBoundsVisible(phet.chipper.queryParameters.showFittedBlockBounds);

    // magnification support - always initialized for consistent PhET-iO API, but only conditionally added to Display
    animatedPanZoomSingleton.initialize(this.simulationRoot, {
      tandem: options.tandem.createTandem('panZoomListener')
    });
    const animatedPanZoomListener = animatedPanZoomSingleton.listener;
    this.supportsPanAndZoomProperty.link(supported => {
      if (supported) {
        this.addInputListener(animatedPanZoomListener);
      } else if (this.hasInputListener(animatedPanZoomListener)) {
        this.removeInputListener(animatedPanZoomListener);
      }
    });

    // If the page is loaded from the back-forward cache, then reload the page to avoid bugginess,
    // see https://github.com/phetsims/joist/issues/448
    window.addEventListener('pageshow', event => {
      if (event.persisted) {
        window.location.reload();
      }
    });
  }

  /**
   * Handle synthetic input event fuzzing
   */
  fuzzInputEvents() {
    // If fuzz parameter is used then fuzzTouch and fuzzMouse events should be fired
    const fuzzTouch = phet.chipper.queryParameters.fuzzTouch || phet.chipper.queryParameters.fuzz;
    const fuzzMouse = phet.chipper.queryParameters.fuzzMouse || phet.chipper.queryParameters.fuzz;

    // fire or synthesize input events
    if (fuzzMouse || fuzzTouch) {
      this.inputFuzzer.fuzzEvents(phet.chipper.queryParameters.fuzzRate, fuzzMouse, fuzzTouch, phet.chipper.queryParameters.fuzzPointers);
    }

    // fire or synthesize keyboard input events
    if (phet.chipper.queryParameters.fuzzBoard && document.hasFocus()) {
      assert && assert(phet.chipper.queryParameters.supportsInteractiveDescription, 'fuzzBoard can only run with interactive description enabled.');
      this.keyboardFuzzer.fuzzBoardEvents(phet.chipper.queryParameters.fuzzRate);
    }
  }
  step(dt) {
    if (this.supportsPanAndZoomProperty.value) {
      // animate the PanZoomListener, for smooth panning/scaling
      animatedPanZoomSingleton.listener.step(dt);
    }
  }
}
joist.register('SimDisplay', SimDisplay);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEeW5hbWljU3RyaW5nVGVzdCIsIm9wdGlvbml6ZSIsImFuaW1hdGVkUGFuWm9vbVNpbmdsZXRvbiIsIkRpc3BsYXkiLCJJbnB1dEZ1enplciIsIktleWJvYXJkRnV6emVyIiwiTm9kZSIsInNjZW5lcnkiLCJVdGlscyIsIlRhbmRlbSIsIkhpZ2hsaWdodFZpc2liaWxpdHlDb250cm9sbGVyIiwiam9pc3QiLCJTaW1EaXNwbGF5Iiwic2ltdWxhdGlvblJvb3QiLCJERUZBVUxUX1dFQkdMIiwiY29uc3RydWN0b3IiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwicm9vdFJlbmRlcmVyIiwid2ViZ2wiLCJhbGxvd0JhY2tpbmdTY2FsZUFudGlhbGlhc2luZyIsImFsbG93U2NlbmVPdmVyZmxvdyIsImFsbG93V2ViR0wiLCJwaGV0IiwiY2hpcHBlciIsInF1ZXJ5UGFyYW1ldGVycyIsImFzc3VtZUZ1bGxXaW5kb3ciLCJhY2Nlc3NpYmlsaXR5Iiwic3VwcG9ydHNJbnRlcmFjdGl2ZURlc2NyaXB0aW9uIiwidGFuZGVtIiwiUkVRVUlSRUQiLCJzdXBwb3J0c0ludGVyYWN0aXZlSGlnaGxpZ2h0cyIsInByZWZlcmVuY2VzTW9kZWwiLCJ2aXN1YWxNb2RlbCIsIlF1ZXJ5U3RyaW5nTWFjaGluZSIsImNvbnRhaW5zS2V5Iiwic2V0V2ViR0xFbmFibGVkIiwiaXNGdXp6RW5hYmxlZCIsIndpbmRvdyIsIm9wZW4iLCJmb2N1cyIsIl8iLCJub29wIiwiYmx1ciIsIiRib2R5IiwiJCIsImNzcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJwYXJlbnROb2RlIiwiYm9keSIsInJlbW92ZUNoaWxkIiwib25zZWxlY3RzdGFydCIsInJlbmRlcmVyIiwicm9vdE5vZGUiLCJhZGRDaGlsZCIsImZ1enplclNlZWQiLCJyYW5kb21TZWVkIiwiTWF0aCIsIlBJIiwiaW5wdXRGdXp6ZXIiLCJrZXlib2FyZEZ1enplciIsInN1cHBvcnRzUGFuQW5kWm9vbVByb3BlcnR5Iiwic3VwcG9ydHNQYW5BbmRab29tIiwiY3JlYXRlVGFuZGVtIiwicGhldGlvRmVhdHVyZWQiLCJkb21FbGVtZW50IiwiaWQiLCJwZG9tUm9vdEVsZW1lbnQiLCJsYW5nIiwiaGlnaGxpZ2h0VmlzaWJpbGl0eUNvbnRyb2xsZXIiLCJzY2VuZXJ5TG9nIiwiZW5hYmxlTG9nZ2luZyIsInNjZW5lcnlTdHJpbmdMb2ciLCJzd2l0Y2hMb2dUb1N0cmluZyIsInN0cmluZ1Rlc3QiLCJkeW5hbWljU3RyaW5nVGVzdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImhhbmRsZUV2ZW50IiwiaW5pdGlhbGl6ZUV2ZW50cyIsIkdFTkVSQUxfQ09OVFJPTExFUiIsImRpc3BsYXkiLCJzZXRQb2ludGVyRGlzcGxheVZpc2libGUiLCJzaG93UG9pbnRlcnMiLCJzZXRQb2ludGVyQXJlYURpc3BsYXlWaXNpYmxlIiwic2hvd1BvaW50ZXJBcmVhcyIsInNldEhpdEFyZWFEaXNwbGF5VmlzaWJsZSIsInNob3dIaXRBcmVhcyIsInNldENhbnZhc05vZGVCb3VuZHNWaXNpYmxlIiwic2hvd0NhbnZhc05vZGVCb3VuZHMiLCJzZXRGaXR0ZWRCbG9ja0JvdW5kc1Zpc2libGUiLCJzaG93Rml0dGVkQmxvY2tCb3VuZHMiLCJpbml0aWFsaXplIiwiYW5pbWF0ZWRQYW5ab29tTGlzdGVuZXIiLCJsaXN0ZW5lciIsImxpbmsiLCJzdXBwb3J0ZWQiLCJhZGRJbnB1dExpc3RlbmVyIiwiaGFzSW5wdXRMaXN0ZW5lciIsInJlbW92ZUlucHV0TGlzdGVuZXIiLCJwZXJzaXN0ZWQiLCJsb2NhdGlvbiIsInJlbG9hZCIsImZ1enpJbnB1dEV2ZW50cyIsImZ1enpUb3VjaCIsImZ1enoiLCJmdXp6TW91c2UiLCJmdXp6RXZlbnRzIiwiZnV6elJhdGUiLCJmdXp6UG9pbnRlcnMiLCJmdXp6Qm9hcmQiLCJoYXNGb2N1cyIsImFzc2VydCIsImZ1enpCb2FyZEV2ZW50cyIsInN0ZXAiLCJkdCIsInZhbHVlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJTaW1EaXNwbGF5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFdyYXAgdGhlIERpc3BsYXkgY2xhc3MgaW4gc2ltLXNwZWNpZmljIGxvZ2ljLiBUaGlzIGluY2x1ZGVzIGZ1enppbmcgc3VwcG9ydCwgYnJvd3NlciB3b3JrYXJvdW5kcyB0aGF0IGhhdmUgY29tZSB1cFxyXG4gKiBvdmVyIHRoZSB5ZWFycywgYW5kIG1hbnkgbGlzdGVuZXJzIGFkZGVkIHRoZSBEaXNwbGF5IEluc3RhbmNlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKiBAYXV0aG9yIEpvbmF0aGFuIE9sc29uIDxqb25hdGhhbi5vbHNvbkBjb2xvcmFkby5lZHU+XHJcbiAqIEBhdXRob3IgTWljaGFlbCBLYXV6bWFubiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmcgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRHluYW1pY1N0cmluZ1Rlc3QgZnJvbSAnLi9EeW5hbWljU3RyaW5nVGVzdC5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IHsgYW5pbWF0ZWRQYW5ab29tU2luZ2xldG9uLCBEaXNwbGF5LCBEaXNwbGF5T3B0aW9ucywgSW5wdXRGdXp6ZXIsIEtleWJvYXJkRnV6emVyLCBOb2RlLCBSZW5kZXJlclR5cGUsIHNjZW5lcnksIFV0aWxzIH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0ICcuLi8uLi9zaGVycGEvbGliL2dhbWUtdXAtY2FtZXJhLTEuMC4wLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IEhpZ2hsaWdodFZpc2liaWxpdHlDb250cm9sbGVyIGZyb20gJy4vSGlnaGxpZ2h0VmlzaWJpbGl0eUNvbnRyb2xsZXIuanMnO1xyXG5pbXBvcnQgam9pc3QgZnJvbSAnLi9qb2lzdC5qcyc7XHJcbmltcG9ydCBQcmVmZXJlbmNlc01vZGVsIGZyb20gJy4vcHJlZmVyZW5jZXMvUHJlZmVyZW5jZXNNb2RlbC5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIHdlYmdsPzogYm9vbGVhbjtcclxuICByb290UmVuZGVyZXI/OiBSZW5kZXJlclR5cGU7XHJcbiAgcHJlZmVyZW5jZXNNb2RlbDogUHJlZmVyZW5jZXNNb2RlbDtcclxufTtcclxuZXhwb3J0IHR5cGUgU2ltRGlzcGxheU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFN0cmljdE9taXQ8RGlzcGxheU9wdGlvbnMsICdzdXBwb3J0c0ludGVyYWN0aXZlSGlnaGxpZ2h0cyc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2ltRGlzcGxheSBleHRlbmRzIERpc3BsYXkge1xyXG5cclxuICAvLyByb290IGZvciB0aGUgc2ltdWxhdGlvbiBhbmQgdGhlIHRhcmdldCBmb3IgQW5pbWF0ZWRQYW5ab29tTGlzdGVuZXIgdG8gc3VwcG9ydCBtYWduaWZpY2F0aW9uIHNpbmNlIHRoZSBEaXNwbGF5IHJvb3ROb2RlXHJcbiAgLy8gY2Fubm90IGJlIHRyYW5zZm9ybWVkXHJcbiAgcHVibGljIHJlYWRvbmx5IHNpbXVsYXRpb25Sb290ID0gbmV3IE5vZGUoKTtcclxuICBwcml2YXRlIHJlYWRvbmx5IGlucHV0RnV6emVyOiBJbnB1dEZ1enplcjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGtleWJvYXJkRnV6emVyOiBLZXlib2FyZEZ1enplcjtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBzdXBwb3J0c1BhbkFuZFpvb21Qcm9wZXJ0eTogVFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyBBZGQgYSBsaXN0ZW5lciB0byB0aGUgRGlzcGxheSB0aGF0IGNvbnRyb2xzIHZpc2liaWxpdHkgb2YgdmFyaW91cyBoaWdobGlnaHRzIGluIHJlc3BvbnNlIHRvIHVzZXIgaW5wdXQuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBoaWdobGlnaHRWaXNpYmlsaXR5Q29udHJvbGxlcjogSGlnaGxpZ2h0VmlzaWJpbGl0eUNvbnRyb2xsZXI7XHJcblxyXG4gIC8vIEZvciBjb25zaXN0ZW50IG9wdGlvbiBkZWZhdWx0c1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgREVGQVVMVF9XRUJHTCA9IGZhbHNlO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3ZpZGVkT3B0aW9uczogU2ltRGlzcGxheU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxTaW1EaXNwbGF5T3B0aW9ucywgU2VsZk9wdGlvbnMsIERpc3BsYXlPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyB0aGUgZGVmYXVsdCByZW5kZXJlciBmb3IgdGhlIHJvb3ROb2RlLCBzZWUgIzIyMSwgIzE4NCBhbmQgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL21vbGFyaXR5L2lzc3Vlcy8yNFxyXG4gICAgICByb290UmVuZGVyZXI6ICdzdmcnLFxyXG5cclxuICAgICAgLy8gU2ltcyB0aGF0IGRvIG5vdCB1c2UgV2ViR0wgdHJpZ2dlciBhIH4gMC41IHNlY29uZCBwYXVzZSBzaG9ydGx5IGFmdGVyIHRoZSBzaW0gc3RhcnRzIHVwLCBzbyBzaW1zIG11c3Qgb3B0IGluIHRvXHJcbiAgICAgIC8vIHdlYmdsIHN1cHBvcnQsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS9pc3N1ZXMvNjIxXHJcbiAgICAgIHdlYmdsOiBTaW1EaXNwbGF5LkRFRkFVTFRfV0VCR0wsXHJcblxyXG4gICAgICAvLyB7Ym9vbGVhbn0gLSBXaGV0aGVyIHRvIGFsbG93IFdlYkdMIDJ4IHNjYWxpbmcgd2hlbiBhbnRpYWxpYXNpbmcgaXMgZGV0ZWN0ZWQuIElmIHJ1bm5pbmcgb3V0IG9mIG1lbW9yeSBvblxyXG4gICAgICAvLyB0aGluZ3MgbGlrZSBpUGFkIDJzIChlLmcuIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zY2VuZXJ5L2lzc3Vlcy84NTkpLCB0aGlzIGNhbiBiZSB0dXJuZWQgdG8gZmFsc2UuXHJcbiAgICAgIGFsbG93QmFja2luZ1NjYWxlQW50aWFsaWFzaW5nOiB0cnVlLFxyXG5cclxuICAgICAgLy8gcHJldmVudCBvdmVyZmxvdyB0aGF0IGNhbiBjYXVzZSBpT1MgYnVnZ2luZXNzLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3BoZXQtaW8vaXNzdWVzLzM0MVxyXG4gICAgICBhbGxvd1NjZW5lT3ZlcmZsb3c6IGZhbHNlLFxyXG5cclxuICAgICAgLy8gSW5kaWNhdGUgd2hldGhlciB3ZWJnbCBpcyBhbGxvd2VkIHRvIGZhY2lsaXRhdGUgdGVzdGluZyBvbiBub24td2ViZ2wgcGxhdGZvcm1zLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnkvaXNzdWVzLzI4OVxyXG4gICAgICBhbGxvd1dlYkdMOiBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLndlYmdsLFxyXG4gICAgICBhc3N1bWVGdWxsV2luZG93OiB0cnVlLCAvLyBhIGJpdCBmYXN0ZXIgaWYgd2UgY2FuIGFzc3VtZSBubyBjb29yZGluYXRlIHRyYW5zbGF0aW9ucyBhcmUgbmVlZGVkIGZvciB0aGUgZGlzcGxheS5cclxuXHJcbiAgICAgIC8vIHBkb20gYWNjZXNzaWJpbGl0eSAoaW50ZXJhY3RpdmUgZGVzY3JpcHRpb24pXHJcbiAgICAgIGFjY2Vzc2liaWxpdHk6IHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuc3VwcG9ydHNJbnRlcmFjdGl2ZURlc2NyaXB0aW9uLFxyXG5cclxuICAgICAgLy8gcGhldC1pb1xyXG4gICAgICB0YW5kZW06IFRhbmRlbS5SRVFVSVJFRFxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gU3VwcG9ydCBmb3IgSW50ZXJhY3RpdmUgSGlnaGxpZ2h0cyBkaWN0YXRlZCBieSB0aGUgcHJlZmVyZW5jZXMgbW9kZWwuXHJcbiAgICBvcHRpb25zLnN1cHBvcnRzSW50ZXJhY3RpdmVIaWdobGlnaHRzID0gb3B0aW9ucy5wcmVmZXJlbmNlc01vZGVsLnZpc3VhbE1vZGVsLnN1cHBvcnRzSW50ZXJhY3RpdmVIaWdobGlnaHRzO1xyXG5cclxuICAgIC8vIG92ZXJyaWRlIHJvb3RSZW5kZXJlciB1c2luZyBxdWVyeSBwYXJhbWV0ZXIsIHNlZSAjMjIxIGFuZCAjMTg0XHJcbiAgICBvcHRpb25zLnJvb3RSZW5kZXJlciA9IHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMucm9vdFJlbmRlcmVyIHx8IG9wdGlvbnMucm9vdFJlbmRlcmVyO1xyXG5cclxuICAgIC8vIFN1cHBsaWVkIHF1ZXJ5IHBhcmFtZXRlcnMgb3ZlcnJpZGUgb3B0aW9ucyAoYnV0IGRlZmF1bHQgdmFsdWVzIGZvciBub24tc3VwcGxpZWQgcXVlcnkgcGFyYW1ldGVycyBkbyBub3QpLlxyXG4gICAgaWYgKCBRdWVyeVN0cmluZ01hY2hpbmUuY29udGFpbnNLZXkoICd3ZWJnbCcgKSApIHtcclxuICAgICAgb3B0aW9ucy53ZWJnbCA9IHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMud2ViZ2w7XHJcbiAgICB9XHJcblxyXG4gICAgVXRpbHMuc2V0V2ViR0xFbmFibGVkKCBvcHRpb25zLndlYmdsICk7XHJcblxyXG4gICAgLy8gb3ZlcnJpZGUgd2luZG93Lm9wZW4gd2l0aCBhIHNlbWktQVBJLWNvbXBhdGlibGUgZnVuY3Rpb24sIHNvIGZ1enppbmcgZG9lc24ndCBvcGVuIG5ldyB3aW5kb3dzLlxyXG4gICAgaWYgKCBwaGV0LmNoaXBwZXIuaXNGdXp6RW5hYmxlZCgpICkge1xyXG5cclxuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIGl0IGlzbid0IHlldCBjbGVhciBob3cgdG8gZGVmaW5lIG9iamVjdHMgdG8gd2luZG93IGp1c3QgeWV0XHJcbiAgICAgIHdpbmRvdy5vcGVuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIGZvY3VzOiBfLm5vb3AsXHJcbiAgICAgICAgICBibHVyOiBfLm5vb3BcclxuICAgICAgICB9O1xyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0ICRib2R5ID0gJCggJ2JvZHknICk7XHJcblxyXG4gICAgLy8gcHJldmVudCBzY3JvbGxiYXJzXHJcbiAgICAkYm9keS5jc3MoICdwYWRkaW5nJywgJzAnICkuY3NzKCAnbWFyZ2luJywgJzAnICkuY3NzKCAnb3ZlcmZsb3cnLCAnaGlkZGVuJyApO1xyXG5cclxuICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGUgc2ltIGRpdiBhbHJlYWR5IGV4aXN0cyBpbiB0aGUgRE9NIHVuZGVyIHRoZSBib2R5LiBUaGlzIGlzIHRoZSBjYXNlIGZvciBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS9pc3N1ZXMvMTc0IChpT1Mgb2ZmbGluZSByZWFkaW5nIGxpc3QpXHJcbiAgICBpZiAoIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnc2ltJyApICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnc2ltJyApIS5wYXJlbnROb2RlID09PSBkb2N1bWVudC5ib2R5ICkge1xyXG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ3NpbScgKSEgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQcmV2ZW50cyBzZWxlY3Rpb24gY3Vyc29yIGlzc3VlcyBpbiBTYWZhcmksIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS9pc3N1ZXMvNDc2XHJcbiAgICBkb2N1bWVudC5vbnNlbGVjdHN0YXJ0ID0gZnVuY3Rpb24oKSB7IHJldHVybiBmYWxzZTsgfTtcclxuXHJcbiAgICBzdXBlciggbmV3IE5vZGUoIHsgcmVuZGVyZXI6IG9wdGlvbnMucm9vdFJlbmRlcmVyIH0gKSwgb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuc2ltdWxhdGlvblJvb3QgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5yb290Tm9kZS5hZGRDaGlsZCggdGhpcy5zaW11bGF0aW9uUm9vdCApO1xyXG5cclxuICAgIC8vIFNlZWRpbmcgYnkgZGVmYXVsdCBhIHJhbmRvbSB2YWx1ZSBmb3IgcmVwcm9kdWNpYmxlIGZ1enplcyBpZiBkZXNpcmVkXHJcbiAgICBjb25zdCBmdXp6ZXJTZWVkID0gcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5yYW5kb21TZWVkICogTWF0aC5QSTtcclxuXHJcbiAgICB0aGlzLmlucHV0RnV6emVyID0gbmV3IElucHV0RnV6emVyKCB0aGlzLCBmdXp6ZXJTZWVkICk7XHJcbiAgICB0aGlzLmtleWJvYXJkRnV6emVyID0gbmV3IEtleWJvYXJkRnV6emVyKCB0aGlzLCBmdXp6ZXJTZWVkICk7XHJcblxyXG4gICAgdGhpcy5zdXBwb3J0c1BhbkFuZFpvb21Qcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuc3VwcG9ydHNQYW5BbmRab29tLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnc3VwcG9ydHNQYW5BbmRab29tUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0ZlYXR1cmVkOiB0cnVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5kb21FbGVtZW50LmlkID0gJ3NpbSc7XHJcblxyXG4gICAgaWYgKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnN1cHBvcnRzSW50ZXJhY3RpdmVEZXNjcmlwdGlvbiApIHtcclxuXHJcbiAgICAgIC8vIGZvciBub3cgaW50ZXJhY3RpdmUgZGVzY3JpcHRpb24gaXMgb25seSBpbiBFbmdsaXNoXHJcbiAgICAgIC8vIE5PVEU6IFdoZW4gdHJhbnNsYXRhYmxlIHRoaXMgd2lsbCBuZWVkIHRvIHVwZGF0ZSB3aXRoIGxhbmd1YWdlLCBjaGFuZ2UgdG8gcGhldC5jaGlwcGVyLmxvY2FsXHJcbiAgICAgIHRoaXMucGRvbVJvb3RFbGVtZW50IS5sYW5nID0gJ2VuJztcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmhpZ2hsaWdodFZpc2liaWxpdHlDb250cm9sbGVyID0gbmV3IEhpZ2hsaWdodFZpc2liaWxpdHlDb250cm9sbGVyKCB0aGlzLCBvcHRpb25zLnByZWZlcmVuY2VzTW9kZWwgKTtcclxuXHJcbiAgICBpZiAoIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuc2NlbmVyeUxvZyApIHtcclxuXHJcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgLSB1bnRpbCBzY2VuZXJ5LmpzIGlzIGNvbnZlcnRlZCB0byB0eXBlc2NyaXB0LCB3aGljaCBpcyBub24tdHJpdmlhbCAoSSB0cmllZClcclxuICAgICAgc2NlbmVyeS5lbmFibGVMb2dnaW5nKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnNjZW5lcnlMb2cgKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuc2NlbmVyeVN0cmluZ0xvZyApIHtcclxuXHJcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgLSB1bnRpbCBzY2VuZXJ5LmpzIGlzIGNvbnZlcnRlZCB0byB0eXBlc2NyaXB0LCB3aGljaCBpcyBub24tdHJpdmlhbCAoSSB0cmllZClcclxuICAgICAgc2NlbmVyeS5zd2l0Y2hMb2dUb1N0cmluZygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2hpcHBlci9pc3N1ZXMvMTMxOVxyXG4gICAgaWYgKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnN0cmluZ1Rlc3QgPT09ICdkeW5hbWljJyApIHtcclxuICAgICAgY29uc3QgZHluYW1pY1N0cmluZ1Rlc3QgPSBuZXcgRHluYW1pY1N0cmluZ1Rlc3QoKTtcclxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICdrZXlkb3duJywgZXZlbnQgPT4gZHluYW1pY1N0cmluZ1Rlc3QuaGFuZGxlRXZlbnQoIGV2ZW50ICkgKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmluaXRpYWxpemVFdmVudHMoIHtcclxuICAgICAgdGFuZGVtOiBUYW5kZW0uR0VORVJBTF9DT05UUk9MTEVSLmNyZWF0ZVRhbmRlbSggJ2lucHV0JyApXHJcbiAgICB9ICk7IC8vIHNldHMgdXAgbGlzdGVuZXJzIG9uIHRoZSBkb2N1bWVudCB3aXRoIHByZXZlbnREZWZhdWx0KCksIGFuZCBmb3J3YXJkcyB0aG9zZSBldmVudHMgdG8gb3VyIHNjZW5lXHJcblxyXG4gICAgd2luZG93LnBoZXQuam9pc3Qucm9vdE5vZGUgPSB0aGlzLnJvb3ROb2RlOyAvLyBtYWtlIHRoZSBzY2VuZSBhdmFpbGFibGUgZm9yIGRlYnVnZ2luZ1xyXG4gICAgd2luZG93LnBoZXQuam9pc3QuZGlzcGxheSA9IHRoaXM7IC8vIG1ha2UgdGhlIGRpc3BsYXkgYXZhaWxhYmxlIGZvciBkZWJ1Z2dpbmdcclxuXHJcbiAgICAvLyBQYXNzIHRocm91Z2ggcXVlcnkgcGFyYW1ldGVycyB0byBzY2VuZXJ5IGZvciBzaG93aW5nIHN1cHBsZW1lbnRhbCBpbmZvcm1hdGlvblxyXG4gICAgdGhpcy5zZXRQb2ludGVyRGlzcGxheVZpc2libGUoIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuc2hvd1BvaW50ZXJzICk7XHJcbiAgICB0aGlzLnNldFBvaW50ZXJBcmVhRGlzcGxheVZpc2libGUoIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuc2hvd1BvaW50ZXJBcmVhcyApO1xyXG4gICAgdGhpcy5zZXRIaXRBcmVhRGlzcGxheVZpc2libGUoIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuc2hvd0hpdEFyZWFzICk7XHJcbiAgICB0aGlzLnNldENhbnZhc05vZGVCb3VuZHNWaXNpYmxlKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnNob3dDYW52YXNOb2RlQm91bmRzICk7XHJcbiAgICB0aGlzLnNldEZpdHRlZEJsb2NrQm91bmRzVmlzaWJsZSggcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5zaG93Rml0dGVkQmxvY2tCb3VuZHMgKTtcclxuXHJcbiAgICAvLyBtYWduaWZpY2F0aW9uIHN1cHBvcnQgLSBhbHdheXMgaW5pdGlhbGl6ZWQgZm9yIGNvbnNpc3RlbnQgUGhFVC1pTyBBUEksIGJ1dCBvbmx5IGNvbmRpdGlvbmFsbHkgYWRkZWQgdG8gRGlzcGxheVxyXG4gICAgYW5pbWF0ZWRQYW5ab29tU2luZ2xldG9uLmluaXRpYWxpemUoIHRoaXMuc2ltdWxhdGlvblJvb3QsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdwYW5ab29tTGlzdGVuZXInIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBhbmltYXRlZFBhblpvb21MaXN0ZW5lciA9IGFuaW1hdGVkUGFuWm9vbVNpbmdsZXRvbi5saXN0ZW5lciE7XHJcblxyXG4gICAgdGhpcy5zdXBwb3J0c1BhbkFuZFpvb21Qcm9wZXJ0eS5saW5rKCBzdXBwb3J0ZWQgPT4ge1xyXG4gICAgICBpZiAoIHN1cHBvcnRlZCApIHtcclxuICAgICAgICB0aGlzLmFkZElucHV0TGlzdGVuZXIoIGFuaW1hdGVkUGFuWm9vbUxpc3RlbmVyICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHRoaXMuaGFzSW5wdXRMaXN0ZW5lciggYW5pbWF0ZWRQYW5ab29tTGlzdGVuZXIgKSApIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUlucHV0TGlzdGVuZXIoIGFuaW1hdGVkUGFuWm9vbUxpc3RlbmVyICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBJZiB0aGUgcGFnZSBpcyBsb2FkZWQgZnJvbSB0aGUgYmFjay1mb3J3YXJkIGNhY2hlLCB0aGVuIHJlbG9hZCB0aGUgcGFnZSB0byBhdm9pZCBidWdnaW5lc3MsXHJcbiAgICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2pvaXN0L2lzc3Vlcy80NDhcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAncGFnZXNob3cnLCBldmVudCA9PiB7XHJcbiAgICAgIGlmICggZXZlbnQucGVyc2lzdGVkICkge1xyXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGFuZGxlIHN5bnRoZXRpYyBpbnB1dCBldmVudCBmdXp6aW5nXHJcbiAgICovXHJcbiAgcHVibGljIGZ1enpJbnB1dEV2ZW50cygpOiB2b2lkIHtcclxuXHJcbiAgICAvLyBJZiBmdXp6IHBhcmFtZXRlciBpcyB1c2VkIHRoZW4gZnV6elRvdWNoIGFuZCBmdXp6TW91c2UgZXZlbnRzIHNob3VsZCBiZSBmaXJlZFxyXG4gICAgY29uc3QgZnV6elRvdWNoID0gcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5mdXp6VG91Y2ggfHwgcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5mdXp6O1xyXG4gICAgY29uc3QgZnV6ek1vdXNlID0gcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5mdXp6TW91c2UgfHwgcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5mdXp6O1xyXG5cclxuICAgIC8vIGZpcmUgb3Igc3ludGhlc2l6ZSBpbnB1dCBldmVudHNcclxuICAgIGlmICggZnV6ek1vdXNlIHx8IGZ1enpUb3VjaCApIHtcclxuICAgICAgdGhpcy5pbnB1dEZ1enplci5mdXp6RXZlbnRzKFxyXG4gICAgICAgIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuZnV6elJhdGUsXHJcbiAgICAgICAgZnV6ek1vdXNlLFxyXG4gICAgICAgIGZ1enpUb3VjaCxcclxuICAgICAgICBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmZ1enpQb2ludGVyc1xyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGZpcmUgb3Igc3ludGhlc2l6ZSBrZXlib2FyZCBpbnB1dCBldmVudHNcclxuICAgIGlmICggcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5mdXp6Qm9hcmQgJiYgZG9jdW1lbnQuaGFzRm9jdXMoKSApIHtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5zdXBwb3J0c0ludGVyYWN0aXZlRGVzY3JpcHRpb24sICdmdXp6Qm9hcmQgY2FuIG9ubHkgcnVuIHdpdGggaW50ZXJhY3RpdmUgZGVzY3JpcHRpb24gZW5hYmxlZC4nICk7XHJcbiAgICAgIHRoaXMua2V5Ym9hcmRGdXp6ZXIuZnV6ekJvYXJkRXZlbnRzKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmZ1enpSYXRlICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RlcCggZHQ6IG51bWJlciApOiB2b2lkIHtcclxuICAgIGlmICggdGhpcy5zdXBwb3J0c1BhbkFuZFpvb21Qcm9wZXJ0eS52YWx1ZSApIHtcclxuXHJcbiAgICAgIC8vIGFuaW1hdGUgdGhlIFBhblpvb21MaXN0ZW5lciwgZm9yIHNtb290aCBwYW5uaW5nL3NjYWxpbmdcclxuICAgICAgYW5pbWF0ZWRQYW5ab29tU2luZ2xldG9uLmxpc3RlbmVyIS5zdGVwKCBkdCApO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuam9pc3QucmVnaXN0ZXIoICdTaW1EaXNwbGF5JywgU2ltRGlzcGxheSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLGtDQUFrQztBQUU5RCxPQUFPQyxpQkFBaUIsTUFBTSx3QkFBd0I7QUFDdEQsT0FBT0MsU0FBUyxNQUFNLGlDQUFpQztBQUV2RCxTQUFTQyx3QkFBd0IsRUFBRUMsT0FBTyxFQUFrQkMsV0FBVyxFQUFFQyxjQUFjLEVBQUVDLElBQUksRUFBZ0JDLE9BQU8sRUFBRUMsS0FBSyxRQUFRLDZCQUE2QjtBQUNoSyxPQUFPLDBDQUEwQztBQUNqRCxPQUFPQyxNQUFNLE1BQU0sMkJBQTJCO0FBQzlDLE9BQU9DLDZCQUE2QixNQUFNLG9DQUFvQztBQUM5RSxPQUFPQyxLQUFLLE1BQU0sWUFBWTtBQVU5QixlQUFlLE1BQU1DLFVBQVUsU0FBU1QsT0FBTyxDQUFDO0VBRTlDO0VBQ0E7RUFDZ0JVLGNBQWMsR0FBRyxJQUFJUCxJQUFJLENBQUMsQ0FBQzs7RUFNM0M7O0VBR0E7RUFDQSxPQUF1QlEsYUFBYSxHQUFHLEtBQUs7RUFFckNDLFdBQVdBLENBQUVDLGVBQWtDLEVBQUc7SUFFdkQsTUFBTUMsT0FBTyxHQUFHaEIsU0FBUyxDQUFpRCxDQUFDLENBQUU7TUFFM0U7TUFDQWlCLFlBQVksRUFBRSxLQUFLO01BRW5CO01BQ0E7TUFDQUMsS0FBSyxFQUFFUCxVQUFVLENBQUNFLGFBQWE7TUFFL0I7TUFDQTtNQUNBTSw2QkFBNkIsRUFBRSxJQUFJO01BRW5DO01BQ0FDLGtCQUFrQixFQUFFLEtBQUs7TUFFekI7TUFDQUMsVUFBVSxFQUFFQyxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsZUFBZSxDQUFDTixLQUFLO01BQzlDTyxnQkFBZ0Is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