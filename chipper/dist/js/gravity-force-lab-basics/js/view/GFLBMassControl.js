// Copyright 2016-2022, University of Colorado Boulder

/**
 * Label with a number picker for setting mass.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import Property from '../../../axon/js/Property.js';
import Utils from '../../../dot/js/Utils.js';
import merge from '../../../phet-core/js/merge.js';
import StringUtils from '../../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../../scenery-phet/js/PhetFont.js';
import { Color, HBox, ReadingBlock, Text, VBox } from '../../../scenery/js/imports.js';
import NumberPicker from '../../../sun/js/NumberPicker.js';
import Panel from '../../../sun/js/Panel.js';
import nullSoundPlayer from '../../../tambo/js/shared-sound-players/nullSoundPlayer.js';
import GFLBConstants from '../GFLBConstants.js';
import gravityForceLabBasics from '../gravityForceLabBasics.js';
import GravityForceLabBasicsStrings from '../GravityForceLabBasicsStrings.js';
const billionKgString = GravityForceLabBasicsStrings.billionKg;
const changeMassHintResponseString = GravityForceLabBasicsStrings.a11y.voicing.changeMassHintResponse;
const massControlReadingBlockPatternString = GravityForceLabBasicsStrings.a11y.voicing.massControlReadingBlockPattern;

// constants
const MIN_PANEL_WIDTH = 150;
const MAX_TEXT_WIDTH = 120; // i18n
const BILLION_MULTIPLIER = GFLBConstants.BILLION_MULTIPLIER;
class GFLBMassControl extends Panel {
  /**
   * @param {string} titleString
   * @param {Property.<number>} valueProperty
   * @param {Range} massRange
   * @param {String} labelContent - a11y, the content of the label for the mass control
   * @param {ISLCObjectEnum} thisObjectEnum
   * @param {GFLBAlertManager} alertManager
   * @param {GFLBMassDescriber} massDescriber
   * @param {Tandem} tandem
   * @param {Object} [options]
   */
  constructor(titleString, valueProperty, massRange, labelContent, thisObjectEnum, alertManager, massDescriber, tandem, options) {
    options = merge({
      color: new Color(0, 0, 255),
      // {null|string} (voicing) custom content to guide the user to dragging with custom gesture
      changeMassHintString: null
    }, options);
    const titleText = new Text(titleString, {
      font: new PhetFont(18),
      maxWidth: MAX_TEXT_WIDTH,
      tandem: tandem.createTandem('titleText')
    });

    // Keep track of the current mass between the start and end of an interaction to see if we should alert.
    let currentMass = valueProperty.value;
    const numberPicker = new NumberPicker(valueProperty, new Property(massRange), {
      font: new PhetFont(20),
      scale: 1.5,
      tandem: tandem.createTandem('numberPicker'),
      incrementFunction: mass => mass + BILLION_MULTIPLIER,
      decrementFunction: mass => mass - BILLION_MULTIPLIER,
      formatValue: value => Utils.toFixed(value / BILLION_MULTIPLIER, 0),
      a11yMapPDOMValue: value => Utils.toFixedNumber(Math.ceil(value / BILLION_MULTIPLIER), 0),
      // arrow options
      arrowHeight: 3,
      arrowYSpacing: 2,
      color: options.color,
      // sound
      valueChangedSoundPlayer: nullSoundPlayer,
      boundarySoundPlayer: nullSoundPlayer,
      a11yCreateAriaValueText: () => massDescriber.getMassAndUnit(thisObjectEnum),
      // on end interaction, if alert a special alert if the mass started at the min/max and didnt' change.
      a11yCreateContextResponseAlert: () => {
        // no change and at max or min
        if (currentMass === valueProperty.value && (currentMass === massRange.max || currentMass === massRange.min)) {
          return alertManager.alertMassMinMaxEdge(thisObjectEnum);
        }
        return null; // regular mass changed alerts come from model changes
      },

      startInput: () => {
        currentMass = valueProperty.value;
      },
      // pdom
      pageKeyboardStep: BILLION_MULTIPLIER * 2,
      accessibleName: labelContent,
      // voicing
      voicingNameResponse: labelContent,
      voicingObjectResponse: () => massDescriber.getMassAndUnit(thisObjectEnum),
      voicingContextResponse: alertManager.getMassValueChangedAlert(thisObjectEnum).alert,
      voicingHintResponse: changeMassHintResponseString
    });
    const numberPickerLabelText = new Text(billionKgString, {
      font: new PhetFont({
        size: 14
      }),
      maxWidth: MAX_TEXT_WIDTH,
      tandem: tandem.createTandem('numberPickerLabelText')
    });
    const numberPickerHBox = new HBox({
      children: [numberPicker, numberPickerLabelText],
      spacing: 10
    });
    const panelVBox = new MassControlReadingBlock({
      children: [titleText, numberPickerHBox],
      spacing: 10,
      // voicing
      readingBlockHintResponse: changeMassHintResponseString
    });
    titleText.stringProperty.lazyLink(() => {
      titleText.centerX = panelVBox.centerX;
    });
    super(panelVBox, {
      fill: '#f1f1f2',
      xMargin: 15,
      yMargin: 10,
      minWidth: MIN_PANEL_WIDTH,
      resize: false,
      align: 'center',
      tandem: tandem,
      // pdom
      tagName: 'div' // Though not necessary, it is helpful for the a11y view to display the valuetext within this div.
    });

    // voicing - when the Property changes, update the ReadingBlock content
    valueProperty.link(value => {
      panelVBox.readingBlockNameResponse = StringUtils.fillIn(massControlReadingBlockPatternString, {
        label: labelContent,
        value: numberPicker.ariaValueText
      });
    });
  }
}
gravityForceLabBasics.register('GFLBMassControl', GFLBMassControl);

/**
 * An inner class for the mass contents surrounding the NumberPicker (title, readout) that can be activated
 * to get the current value and any other help content provided by Voicing.
 */
class MassControlReadingBlock extends ReadingBlock(VBox) {
  /**
   * @mixes {ReadingBlock}
   * @param {Object} [options]
   */
  constructor(options) {
    options = merge({
      // voicing - This ReadingBlock should neither be focusable nor discoverable in the PDOM because its content
      // is provided in other responses. It was requested that it be removed from the focus order.
      readingBlockTagName: null
    }, options);
    super(options);
  }
}
export default GFLBMassControl;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIlV0aWxzIiwibWVyZ2UiLCJTdHJpbmdVdGlscyIsIlBoZXRGb250IiwiQ29sb3IiLCJIQm94IiwiUmVhZGluZ0Jsb2NrIiwiVGV4dCIsIlZCb3giLCJOdW1iZXJQaWNrZXIiLCJQYW5lbCIsIm51bGxTb3VuZFBsYXllciIsIkdGTEJDb25zdGFudHMiLCJncmF2aXR5Rm9yY2VMYWJCYXNpY3MiLCJHcmF2aXR5Rm9yY2VMYWJCYXNpY3NTdHJpbmdzIiwiYmlsbGlvbktnU3RyaW5nIiwiYmlsbGlvbktnIiwiY2hhbmdlTWFzc0hpbnRSZXNwb25zZVN0cmluZyIsImExMXkiLCJ2b2ljaW5nIiwiY2hhbmdlTWFzc0hpbnRSZXNwb25zZSIsIm1hc3NDb250cm9sUmVhZGluZ0Jsb2NrUGF0dGVyblN0cmluZyIsIm1hc3NDb250cm9sUmVhZGluZ0Jsb2NrUGF0dGVybiIsIk1JTl9QQU5FTF9XSURUSCIsIk1BWF9URVhUX1dJRFRIIiwiQklMTElPTl9NVUxUSVBMSUVSIiwiR0ZMQk1hc3NDb250cm9sIiwiY29uc3RydWN0b3IiLCJ0aXRsZVN0cmluZyIsInZhbHVlUHJvcGVydHkiLCJtYXNzUmFuZ2UiLCJsYWJlbENvbnRlbnQiLCJ0aGlzT2JqZWN0RW51bSIsImFsZXJ0TWFuYWdlciIsIm1hc3NEZXNjcmliZXIiLCJ0YW5kZW0iLCJvcHRpb25zIiwiY29sb3IiLCJjaGFuZ2VNYXNzSGludFN0cmluZyIsInRpdGxlVGV4dCIsImZvbnQiLCJtYXhXaWR0aCIsImNyZWF0ZVRhbmRlbSIsImN1cnJlbnRNYXNzIiwidmFsdWUiLCJudW1iZXJQaWNrZXIiLCJzY2FsZSIsImluY3JlbWVudEZ1bmN0aW9uIiwibWFzcyIsImRlY3JlbWVudEZ1bmN0aW9uIiwiZm9ybWF0VmFsdWUiLCJ0b0ZpeGVkIiwiYTExeU1hcFBET01WYWx1ZSIsInRvRml4ZWROdW1iZXIiLCJNYXRoIiwiY2VpbCIsImFycm93SGVpZ2h0IiwiYXJyb3dZU3BhY2luZyIsInZhbHVlQ2hhbmdlZFNvdW5kUGxheWVyIiwiYm91bmRhcnlTb3VuZFBsYXllciIsImExMXlDcmVhdGVBcmlhVmFsdWVUZXh0IiwiZ2V0TWFzc0FuZFVuaXQiLCJhMTF5Q3JlYXRlQ29udGV4dFJlc3BvbnNlQWxlcnQiLCJtYXgiLCJtaW4iLCJhbGVydE1hc3NNaW5NYXhFZGdlIiwic3RhcnRJbnB1dCIsInBhZ2VLZXlib2FyZFN0ZXAiLCJhY2Nlc3NpYmxlTmFtZSIsInZvaWNpbmdOYW1lUmVzcG9uc2UiLCJ2b2ljaW5nT2JqZWN0UmVzcG9uc2UiLCJ2b2ljaW5nQ29udGV4dFJlc3BvbnNlIiwiZ2V0TWFzc1ZhbHVlQ2hhbmdlZEFsZXJ0IiwiYWxlcnQiLCJ2b2ljaW5nSGludFJlc3BvbnNlIiwibnVtYmVyUGlja2VyTGFiZWxUZXh0Iiwic2l6ZSIsIm51bWJlclBpY2tlckhCb3giLCJjaGlsZHJlbiIsInNwYWNpbmciLCJwYW5lbFZCb3giLCJNYXNzQ29udHJvbFJlYWRpbmdCbG9jayIsInJlYWRpbmdCbG9ja0hpbnRSZXNwb25zZSIsInN0cmluZ1Byb3BlcnR5IiwibGF6eUxpbmsiLCJjZW50ZXJYIiwiZmlsbCIsInhNYXJnaW4iLCJ5TWFyZ2luIiwibWluV2lkdGgiLCJyZXNpemUiLCJhbGlnbiIsInRhZ05hbWUiLCJsaW5rIiwicmVhZGluZ0Jsb2NrTmFtZVJlc3BvbnNlIiwiZmlsbEluIiwibGFiZWwiLCJhcmlhVmFsdWVUZXh0IiwicmVnaXN0ZXIiLCJyZWFkaW5nQmxvY2tUYWdOYW1lIl0sInNvdXJjZXMiOlsiR0ZMQk1hc3NDb250cm9sLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIExhYmVsIHdpdGggYSBudW1iZXIgcGlja2VyIGZvciBzZXR0aW5nIG1hc3MuXHJcbiAqXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBIQm94LCBSZWFkaW5nQmxvY2ssIFRleHQsIFZCb3ggfSBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgTnVtYmVyUGlja2VyIGZyb20gJy4uLy4uLy4uL3N1bi9qcy9OdW1iZXJQaWNrZXIuanMnO1xyXG5pbXBvcnQgUGFuZWwgZnJvbSAnLi4vLi4vLi4vc3VuL2pzL1BhbmVsLmpzJztcclxuaW1wb3J0IG51bGxTb3VuZFBsYXllciBmcm9tICcuLi8uLi8uLi90YW1iby9qcy9zaGFyZWQtc291bmQtcGxheWVycy9udWxsU291bmRQbGF5ZXIuanMnO1xyXG5pbXBvcnQgR0ZMQkNvbnN0YW50cyBmcm9tICcuLi9HRkxCQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IGdyYXZpdHlGb3JjZUxhYkJhc2ljcyBmcm9tICcuLi9ncmF2aXR5Rm9yY2VMYWJCYXNpY3MuanMnO1xyXG5pbXBvcnQgR3Jhdml0eUZvcmNlTGFiQmFzaWNzU3RyaW5ncyBmcm9tICcuLi9HcmF2aXR5Rm9yY2VMYWJCYXNpY3NTdHJpbmdzLmpzJztcclxuXHJcbmNvbnN0IGJpbGxpb25LZ1N0cmluZyA9IEdyYXZpdHlGb3JjZUxhYkJhc2ljc1N0cmluZ3MuYmlsbGlvbktnO1xyXG5jb25zdCBjaGFuZ2VNYXNzSGludFJlc3BvbnNlU3RyaW5nID0gR3Jhdml0eUZvcmNlTGFiQmFzaWNzU3RyaW5ncy5hMTF5LnZvaWNpbmcuY2hhbmdlTWFzc0hpbnRSZXNwb25zZTtcclxuY29uc3QgbWFzc0NvbnRyb2xSZWFkaW5nQmxvY2tQYXR0ZXJuU3RyaW5nID0gR3Jhdml0eUZvcmNlTGFiQmFzaWNzU3RyaW5ncy5hMTF5LnZvaWNpbmcubWFzc0NvbnRyb2xSZWFkaW5nQmxvY2tQYXR0ZXJuO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE1JTl9QQU5FTF9XSURUSCA9IDE1MDtcclxuY29uc3QgTUFYX1RFWFRfV0lEVEggPSAxMjA7IC8vIGkxOG5cclxuY29uc3QgQklMTElPTl9NVUxUSVBMSUVSID0gR0ZMQkNvbnN0YW50cy5CSUxMSU9OX01VTFRJUExJRVI7XHJcblxyXG5jbGFzcyBHRkxCTWFzc0NvbnRyb2wgZXh0ZW5kcyBQYW5lbCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB0aXRsZVN0cmluZ1xyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPG51bWJlcj59IHZhbHVlUHJvcGVydHlcclxuICAgKiBAcGFyYW0ge1JhbmdlfSBtYXNzUmFuZ2VcclxuICAgKiBAcGFyYW0ge1N0cmluZ30gbGFiZWxDb250ZW50IC0gYTExeSwgdGhlIGNvbnRlbnQgb2YgdGhlIGxhYmVsIGZvciB0aGUgbWFzcyBjb250cm9sXHJcbiAgICogQHBhcmFtIHtJU0xDT2JqZWN0RW51bX0gdGhpc09iamVjdEVudW1cclxuICAgKiBAcGFyYW0ge0dGTEJBbGVydE1hbmFnZXJ9IGFsZXJ0TWFuYWdlclxyXG4gICAqIEBwYXJhbSB7R0ZMQk1hc3NEZXNjcmliZXJ9IG1hc3NEZXNjcmliZXJcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCB0aXRsZVN0cmluZywgdmFsdWVQcm9wZXJ0eSwgbWFzc1JhbmdlLCBsYWJlbENvbnRlbnQsIHRoaXNPYmplY3RFbnVtLCBhbGVydE1hbmFnZXIsXHJcbiAgICAgICAgICAgICAgIG1hc3NEZXNjcmliZXIsIHRhbmRlbSwgb3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuICAgICAgY29sb3I6IG5ldyBDb2xvciggMCwgMCwgMjU1ICksXHJcblxyXG4gICAgICAvLyB7bnVsbHxzdHJpbmd9ICh2b2ljaW5nKSBjdXN0b20gY29udGVudCB0byBndWlkZSB0aGUgdXNlciB0byBkcmFnZ2luZyB3aXRoIGN1c3RvbSBnZXN0dXJlXHJcbiAgICAgIGNoYW5nZU1hc3NIaW50U3RyaW5nOiBudWxsXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgdGl0bGVUZXh0ID0gbmV3IFRleHQoIHRpdGxlU3RyaW5nLCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTggKSxcclxuICAgICAgbWF4V2lkdGg6IE1BWF9URVhUX1dJRFRILFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd0aXRsZVRleHQnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBLZWVwIHRyYWNrIG9mIHRoZSBjdXJyZW50IG1hc3MgYmV0d2VlbiB0aGUgc3RhcnQgYW5kIGVuZCBvZiBhbiBpbnRlcmFjdGlvbiB0byBzZWUgaWYgd2Ugc2hvdWxkIGFsZXJ0LlxyXG4gICAgbGV0IGN1cnJlbnRNYXNzID0gdmFsdWVQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICBjb25zdCBudW1iZXJQaWNrZXIgPSBuZXcgTnVtYmVyUGlja2VyKCB2YWx1ZVByb3BlcnR5LCBuZXcgUHJvcGVydHkoIG1hc3NSYW5nZSApLCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMjAgKSxcclxuICAgICAgc2NhbGU6IDEuNSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnbnVtYmVyUGlja2VyJyApLFxyXG4gICAgICBpbmNyZW1lbnRGdW5jdGlvbjogbWFzcyA9PiBtYXNzICsgQklMTElPTl9NVUxUSVBMSUVSLFxyXG4gICAgICBkZWNyZW1lbnRGdW5jdGlvbjogbWFzcyA9PiBtYXNzIC0gQklMTElPTl9NVUxUSVBMSUVSLFxyXG4gICAgICBmb3JtYXRWYWx1ZTogdmFsdWUgPT4gVXRpbHMudG9GaXhlZCggdmFsdWUgLyBCSUxMSU9OX01VTFRJUExJRVIsIDAgKSxcclxuICAgICAgYTExeU1hcFBET01WYWx1ZTogdmFsdWUgPT4gVXRpbHMudG9GaXhlZE51bWJlciggTWF0aC5jZWlsKCB2YWx1ZSAvIEJJTExJT05fTVVMVElQTElFUiApLCAwICksXHJcblxyXG4gICAgICAvLyBhcnJvdyBvcHRpb25zXHJcbiAgICAgIGFycm93SGVpZ2h0OiAzLFxyXG4gICAgICBhcnJvd1lTcGFjaW5nOiAyLFxyXG4gICAgICBjb2xvcjogb3B0aW9ucy5jb2xvcixcclxuXHJcbiAgICAgIC8vIHNvdW5kXHJcbiAgICAgIHZhbHVlQ2hhbmdlZFNvdW5kUGxheWVyOiBudWxsU291bmRQbGF5ZXIsXHJcbiAgICAgIGJvdW5kYXJ5U291bmRQbGF5ZXI6IG51bGxTb3VuZFBsYXllcixcclxuXHJcbiAgICAgIGExMXlDcmVhdGVBcmlhVmFsdWVUZXh0OiAoKSA9PiBtYXNzRGVzY3JpYmVyLmdldE1hc3NBbmRVbml0KCB0aGlzT2JqZWN0RW51bSApLFxyXG5cclxuICAgICAgLy8gb24gZW5kIGludGVyYWN0aW9uLCBpZiBhbGVydCBhIHNwZWNpYWwgYWxlcnQgaWYgdGhlIG1hc3Mgc3RhcnRlZCBhdCB0aGUgbWluL21heCBhbmQgZGlkbnQnIGNoYW5nZS5cclxuICAgICAgYTExeUNyZWF0ZUNvbnRleHRSZXNwb25zZUFsZXJ0OiAoKSA9PiB7XHJcblxyXG4gICAgICAgIC8vIG5vIGNoYW5nZSBhbmQgYXQgbWF4IG9yIG1pblxyXG4gICAgICAgIGlmICggY3VycmVudE1hc3MgPT09IHZhbHVlUHJvcGVydHkudmFsdWUgJiYgKCBjdXJyZW50TWFzcyA9PT0gbWFzc1JhbmdlLm1heCB8fCBjdXJyZW50TWFzcyA9PT0gbWFzc1JhbmdlLm1pbiApICkge1xyXG4gICAgICAgICAgcmV0dXJuIGFsZXJ0TWFuYWdlci5hbGVydE1hc3NNaW5NYXhFZGdlKCB0aGlzT2JqZWN0RW51bSApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDsgLy8gcmVndWxhciBtYXNzIGNoYW5nZWQgYWxlcnRzIGNvbWUgZnJvbSBtb2RlbCBjaGFuZ2VzXHJcbiAgICAgIH0sXHJcbiAgICAgIHN0YXJ0SW5wdXQ6ICgpID0+IHtcclxuICAgICAgICBjdXJyZW50TWFzcyA9IHZhbHVlUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBwZG9tXHJcbiAgICAgIHBhZ2VLZXlib2FyZFN0ZXA6IEJJTExJT05fTVVMVElQTElFUiAqIDIsXHJcbiAgICAgIGFjY2Vzc2libGVOYW1lOiBsYWJlbENvbnRlbnQsXHJcblxyXG4gICAgICAvLyB2b2ljaW5nXHJcbiAgICAgIHZvaWNpbmdOYW1lUmVzcG9uc2U6IGxhYmVsQ29udGVudCxcclxuICAgICAgdm9pY2luZ09iamVjdFJlc3BvbnNlOiAoKSA9PiBtYXNzRGVzY3JpYmVyLmdldE1hc3NBbmRVbml0KCB0aGlzT2JqZWN0RW51bSApLFxyXG4gICAgICB2b2ljaW5nQ29udGV4dFJlc3BvbnNlOiBhbGVydE1hbmFnZXIuZ2V0TWFzc1ZhbHVlQ2hhbmdlZEFsZXJ0KCB0aGlzT2JqZWN0RW51bSApLmFsZXJ0LFxyXG4gICAgICB2b2ljaW5nSGludFJlc3BvbnNlOiBjaGFuZ2VNYXNzSGludFJlc3BvbnNlU3RyaW5nXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBudW1iZXJQaWNrZXJMYWJlbFRleHQgPSBuZXcgVGV4dCggYmlsbGlvbktnU3RyaW5nLCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggeyBzaXplOiAxNCB9ICksXHJcbiAgICAgIG1heFdpZHRoOiBNQVhfVEVYVF9XSURUSCxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnbnVtYmVyUGlja2VyTGFiZWxUZXh0JyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgbnVtYmVyUGlja2VySEJveCA9IG5ldyBIQm94KCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbIG51bWJlclBpY2tlciwgbnVtYmVyUGlja2VyTGFiZWxUZXh0IF0sXHJcbiAgICAgIHNwYWNpbmc6IDEwXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgcGFuZWxWQm94ID0gbmV3IE1hc3NDb250cm9sUmVhZGluZ0Jsb2NrKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbIHRpdGxlVGV4dCwgbnVtYmVyUGlja2VySEJveCBdLFxyXG4gICAgICBzcGFjaW5nOiAxMCxcclxuXHJcbiAgICAgIC8vIHZvaWNpbmdcclxuICAgICAgcmVhZGluZ0Jsb2NrSGludFJlc3BvbnNlOiBjaGFuZ2VNYXNzSGludFJlc3BvbnNlU3RyaW5nXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGl0bGVUZXh0LnN0cmluZ1Byb3BlcnR5LmxhenlMaW5rKCAoKSA9PiB7IHRpdGxlVGV4dC5jZW50ZXJYID0gcGFuZWxWQm94LmNlbnRlclg7IH0gKTtcclxuXHJcbiAgICBzdXBlciggcGFuZWxWQm94LCB7XHJcbiAgICAgIGZpbGw6ICcjZjFmMWYyJyxcclxuICAgICAgeE1hcmdpbjogMTUsXHJcbiAgICAgIHlNYXJnaW46IDEwLFxyXG4gICAgICBtaW5XaWR0aDogTUlOX1BBTkVMX1dJRFRILFxyXG4gICAgICByZXNpemU6IGZhbHNlLFxyXG4gICAgICBhbGlnbjogJ2NlbnRlcicsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLFxyXG5cclxuICAgICAgLy8gcGRvbVxyXG4gICAgICB0YWdOYW1lOiAnZGl2JyAvLyBUaG91Z2ggbm90IG5lY2Vzc2FyeSwgaXQgaXMgaGVscGZ1bCBmb3IgdGhlIGExMXkgdmlldyB0byBkaXNwbGF5IHRoZSB2YWx1ZXRleHQgd2l0aGluIHRoaXMgZGl2LlxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHZvaWNpbmcgLSB3aGVuIHRoZSBQcm9wZXJ0eSBjaGFuZ2VzLCB1cGRhdGUgdGhlIFJlYWRpbmdCbG9jayBjb250ZW50XHJcbiAgICB2YWx1ZVByb3BlcnR5LmxpbmsoIHZhbHVlID0+IHtcclxuICAgICAgcGFuZWxWQm94LnJlYWRpbmdCbG9ja05hbWVSZXNwb25zZSA9IFN0cmluZ1V0aWxzLmZpbGxJbiggbWFzc0NvbnRyb2xSZWFkaW5nQmxvY2tQYXR0ZXJuU3RyaW5nLCB7XHJcbiAgICAgICAgbGFiZWw6IGxhYmVsQ29udGVudCxcclxuICAgICAgICB2YWx1ZTogbnVtYmVyUGlja2VyLmFyaWFWYWx1ZVRleHRcclxuICAgICAgfSApO1xyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxuZ3Jhdml0eUZvcmNlTGFiQmFzaWNzLnJlZ2lzdGVyKCAnR0ZMQk1hc3NDb250cm9sJywgR0ZMQk1hc3NDb250cm9sICk7XHJcblxyXG4vKipcclxuICogQW4gaW5uZXIgY2xhc3MgZm9yIHRoZSBtYXNzIGNvbnRlbnRzIHN1cnJvdW5kaW5nIHRoZSBOdW1iZXJQaWNrZXIgKHRpdGxlLCByZWFkb3V0KSB0aGF0IGNhbiBiZSBhY3RpdmF0ZWRcclxuICogdG8gZ2V0IHRoZSBjdXJyZW50IHZhbHVlIGFuZCBhbnkgb3RoZXIgaGVscCBjb250ZW50IHByb3ZpZGVkIGJ5IFZvaWNpbmcuXHJcbiAqL1xyXG5jbGFzcyBNYXNzQ29udHJvbFJlYWRpbmdCbG9jayBleHRlbmRzIFJlYWRpbmdCbG9jayggVkJveCApIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQG1peGVzIHtSZWFkaW5nQmxvY2t9XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBvcHRpb25zICkge1xyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcblxyXG4gICAgICAvLyB2b2ljaW5nIC0gVGhpcyBSZWFkaW5nQmxvY2sgc2hvdWxkIG5laXRoZXIgYmUgZm9jdXNhYmxlIG5vciBkaXNjb3ZlcmFibGUgaW4gdGhlIFBET00gYmVjYXVzZSBpdHMgY29udGVudFxyXG4gICAgICAvLyBpcyBwcm92aWRlZCBpbiBvdGhlciByZXNwb25zZXMuIEl0IHdhcyByZXF1ZXN0ZWQgdGhhdCBpdCBiZSByZW1vdmVkIGZyb20gdGhlIGZvY3VzIG9yZGVyLlxyXG4gICAgICByZWFkaW5nQmxvY2tUYWdOYW1lOiBudWxsXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEdGTEJNYXNzQ29udHJvbDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLDhCQUE4QjtBQUNuRCxPQUFPQyxLQUFLLE1BQU0sMEJBQTBCO0FBQzVDLE9BQU9DLEtBQUssTUFBTSxnQ0FBZ0M7QUFDbEQsT0FBT0MsV0FBVyxNQUFNLDRDQUE0QztBQUNwRSxPQUFPQyxRQUFRLE1BQU0sc0NBQXNDO0FBQzNELFNBQVNDLEtBQUssRUFBRUMsSUFBSSxFQUFFQyxZQUFZLEVBQUVDLElBQUksRUFBRUMsSUFBSSxRQUFRLGdDQUFnQztBQUN0RixPQUFPQyxZQUFZLE1BQU0saUNBQWlDO0FBQzFELE9BQU9DLEtBQUssTUFBTSwwQkFBMEI7QUFDNUMsT0FBT0MsZUFBZSxNQUFNLDJEQUEyRDtBQUN2RixPQUFPQyxhQUFhLE1BQU0scUJBQXFCO0FBQy9DLE9BQU9DLHFCQUFxQixNQUFNLDZCQUE2QjtBQUMvRCxPQUFPQyw0QkFBNEIsTUFBTSxvQ0FBb0M7QUFFN0UsTUFBTUMsZUFBZSxHQUFHRCw0QkFBNEIsQ0FBQ0UsU0FBUztBQUM5RCxNQUFNQyw0QkFBNEIsR0FBR0gsNEJBQTRCLENBQUNJLElBQUksQ0FBQ0MsT0FBTyxDQUFDQyxzQkFBc0I7QUFDckcsTUFBTUMsb0NBQW9DLEdBQUdQLDRCQUE0QixDQUFDSSxJQUFJLENBQUND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