// Copyright 2016-2022, University of Colorado Boulder

/**
 * Shows a single Billiards table, draggable by its sides, with a moving ball and holes in the
 * top left, top right and bottom right corners.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Andrea Lin
 */

import Multilink from '../../../../../axon/js/Multilink.js';
import Bounds2 from '../../../../../dot/js/Bounds2.js';
import Matrix3 from '../../../../../dot/js/Matrix3.js';
import Utils from '../../../../../dot/js/Utils.js';
import Vector2 from '../../../../../dot/js/Vector2.js';
import { Shape } from '../../../../../kite/js/imports.js';
import merge from '../../../../../phet-core/js/merge.js';
import ModelViewTransform2 from '../../../../../phetcommon/js/view/ModelViewTransform2.js';
import ShadedSphereNode from '../../../../../scenery-phet/js/ShadedSphereNode.js';
import { Circle, DragListener, HBox, Node, Path, Rectangle } from '../../../../../scenery/js/imports.js';
import MutableOptionsNode from '../../../../../sun/js/MutableOptionsNode.js';
import proportionPlayground from '../../../proportionPlayground.js';
import ProportionPlaygroundConstants from '../../ProportionPlaygroundConstants.js';
import ProportionPlaygroundColors from '../ProportionPlaygroundColors.js';
import SceneRatioNode from '../SceneRatioNode.js';
import BilliardsPath from './BilliardsPath.js';

// constants
const MODEL_VIEW_SCALE = 18;
const BALL_DIAMETER = 10;
const GRID_LINE_WIDTH = 0.028;
class BilliardsTableNode extends SceneRatioNode {
  /**
   * @param {BilliardsTable} billiardsTable - the model
   * @param {Object} [options] - See options below. Also passed to Node's mutate.
   */
  constructor(billiardsTable, tandem, options) {
    super(billiardsTable);

    // {ModelViewTransform2} - Will be updated when the width/length changes.
    const modelViewTransform = new ModelViewTransform2(BilliardsTableNode.computeModelViewMatrix(billiardsTable.lengthProperty.value, billiardsTable.widthProperty.value));
    options = merge({
      // {boolean} - Whether this node should always take up the bounds for a full-size (20x20) billiards table.
      fullSizeBounds: true,
      // {boolean} - Whether to allow dragging the borders of the table to resize it. If true, it will show some
      //             "grippy dots" to indicate it is draggable.
      allowDragToResize: true,
      tandem: tandem
    }, options);

    // Model the edge outside of the green area (not as a stroke) since there is no way to do "outer" stroke
    const borderRectangle = new Rectangle({
      fill: ProportionPlaygroundColors.billiardsBorderProperty,
      cornerRadius: 9
    });
    const insideRectangle = new Rectangle({
      fill: ProportionPlaygroundColors.billiardsInsideProperty
    });

    // Create drag-handle parts to be used as children.
    const dragGripDots = new HBox({
      pickable: false,
      // use the mouse/touch areas directly, don't test these
      spacing: 1.3,
      children: [0, 1, 2].map(() => new Circle(1.2, {
        fill: ProportionPlaygroundColors.billiardsGripDotsProperty
      })),
      center: Vector2.ZERO
    });
    const rotatedGripDots = new Node({
      children: [dragGripDots],
      rotation: Math.PI / 2
    });

    // Drag handles (with grippy dots). These will live on the 4 borders, and can be dragged to resize the table.
    const leftDragHandle = new Node({
      cursor: 'pointer',
      children: [rotatedGripDots]
    });
    const rightDragHandle = new Node({
      cursor: 'pointer',
      children: [rotatedGripDots]
    });
    const topDragHandle = new Node({
      cursor: 'pointer',
      children: [dragGripDots]
    });
    const bottomDragHandle = new Node({
      cursor: 'pointer',
      children: [dragGripDots]
    });

    // Grid lines for in the inner rectangle. Clipping will be used instead of redrawing when width/length changes.
    const gridLinesNode = BilliardsTableNode.createGridLinesNode();

    // The path shows the trail of where the ball has been
    const pathNode = new BilliardsPath(modelViewTransform, billiardsTable.collisionPoints, billiardsTable.ballPositionProperty);
    billiardsTable.restartEmitter.addListener(() => {
      pathNode.reset();
    });

    // The moving ball node
    const ballNode = new MutableOptionsNode(ShadedSphereNode, [BALL_DIAMETER], {
      pickable: false
    }, {
      mainColor: ProportionPlaygroundColors.billiardsBallMainProperty,
      highlightColor: ProportionPlaygroundColors.billiardsBallHighlightProperty
    });
    billiardsTable.ballPositionProperty.link(ballModelPosition => {
      ballNode.translation = modelViewTransform.modelToViewPosition(ballModelPosition);
    });

    // Create the holes for top-left, top-right and bottom-right
    const createCircle = () => new Circle(BALL_DIAMETER / 2, {
      fill: ProportionPlaygroundColors.billiardsPocketProperty
    });
    const topLeftHoleNode = createCircle();
    const topRightHoleNode = createCircle();
    const bottomRightHoleNode = createCircle();

    /**
     * Hook up the drag listener for each drag handle.
     *
     * @param {Node} dragHandle
     * @param {Property.<number>} property - The width or length property of the table
     * @param {string} coordinate - the axis, 'x' or 'y', to use. Corresponds with width or length, respectively.
     * @param {number} changeSign - -1 or 1, designates whether its the left or right, top or bottom dragHandle
     * @param {Tandem} tandem
     */
    const createDragListener = (dragHandle, property, coordinate, changeSign, tandem) => {
      let startPoint; // track where the mouse drag starts
      let startProperty; // track the beginning width

      dragHandle.addInputListener(new DragListener({
        tandem: tandem,
        applyOffset: false,
        start: (event, listener) => {
          startPoint = listener.parentPoint;
          startProperty = property.value;
        },
        drag: (event, listener) => {
          const change = Utils.roundSymmetric(changeSign * (listener.parentPoint[coordinate] - startPoint[coordinate]) * 2 / MODEL_VIEW_SCALE);

          // change width so its within the acceptable range
          property.value = ProportionPlaygroundConstants.BILLIARDS_COUNT_RANGE.constrainValue(startProperty + change);
        }
      }));
    };
    // When a side of the table is dragged, the appropriate width or length changes.
    createDragListener(leftDragHandle, billiardsTable.widthProperty, 'x', -1, tandem.createTandem('leftDragListener'));
    createDragListener(rightDragHandle, billiardsTable.widthProperty, 'x', 1, tandem.createTandem('rightDragListener'));
    createDragListener(topDragHandle, billiardsTable.lengthProperty, 'y', -1, tandem.createTandem('topDragListener'));
    createDragListener(bottomDragHandle, billiardsTable.lengthProperty, 'y', 1, tandem.createTandem('bottomDragListener'));

    // When the table is resized, redraw it.
    Multilink.multilink([billiardsTable.lengthProperty, billiardsTable.widthProperty], () => {
      const length = billiardsTable.lengthProperty.value;
      const width = billiardsTable.widthProperty.value;

      // Recompute the model-view transform.
      modelViewTransform.setMatrix(BilliardsTableNode.computeModelViewMatrix(billiardsTable.lengthProperty.value, billiardsTable.widthProperty.value));
      const viewEdgeWidth = 11;
      const modelEdgeWidth = modelViewTransform.viewToModelDeltaX(viewEdgeWidth);

      // Compute the full bounds (and set as local bounds) if the option is provided.
      if (options.fullSizeBounds) {
        this.localBounds = Bounds2.point(0, 0).dilatedXY(ProportionPlaygroundConstants.BILLIARDS_COUNT_RANGE.max * MODEL_VIEW_SCALE / 2 + viewEdgeWidth, ProportionPlaygroundConstants.BILLIARDS_COUNT_RANGE.max * MODEL_VIEW_SCALE / 2 + viewEdgeWidth);
      }

      // Determine the view bounds of the area where the ball can be.
      const viewBounds = new Bounds2(modelViewTransform.modelToViewX(0), modelViewTransform.modelToViewY(length),
      // since this gets mapped to the min
      modelViewTransform.modelToViewX(width), modelViewTransform.modelToViewY(0));
      insideRectangle.setRectBounds(viewBounds);
      borderRectangle.setRectBounds(viewBounds.dilated(viewEdgeWidth));
      leftDragHandle.center = modelViewTransform.modelToViewPosition(new Vector2(-modelEdgeWidth / 2, length / 2));
      rightDragHandle.center = modelViewTransform.modelToViewPosition(new Vector2(width + modelEdgeWidth / 2, length / 2));
      topDragHandle.center = modelViewTransform.modelToViewPosition(new Vector2(width / 2, length + modelEdgeWidth / 2));
      bottomDragHandle.center = modelViewTransform.modelToViewPosition(new Vector2(width / 2, -modelEdgeWidth / 2));
      function setMouseTouchAreas(dragHandle, width, length, rotation) {
        // Quadrilateral that covers the border in the specified quadrant
        dragHandle.mouseArea = new Shape().polygon([new Vector2(-width / 2, -length / 2), new Vector2(-width / 2, length / 2), new Vector2(width / 2, length / 2 + width), new Vector2(width / 2, -length / 2 - width)]).transformed(Matrix3.rotation2(rotation));

        // Apply an additional offset for touch
        const touchOffset = 0.6 * width;
        dragHandle.touchArea = new Shape().polygon([new Vector2(-width / 2 - touchOffset, -length / 2 + touchOffset), new Vector2(-width / 2 - touchOffset, length / 2 - touchOffset), new Vector2(width / 2 + touchOffset, length / 2 + width + touchOffset), new Vector2(width / 2 + touchOffset, -length / 2 - width - touchOffset)]).transformed(Matrix3.rotation2(rotation));
      }
      setMouseTouchAreas(leftDragHandle, viewEdgeWidth, -modelViewTransform.modelToViewDeltaY(length), Math.PI);
      setMouseTouchAreas(rightDragHandle, viewEdgeWidth, -modelViewTransform.modelToViewDeltaY(length), 0);
      setMouseTouchAreas(topDragHandle, viewEdgeWidth, modelViewTransform.modelToViewDeltaX(width), -Math.PI / 2);
      setMouseTouchAreas(bottomDragHandle, viewEdgeWidth, modelViewTransform.modelToViewDeltaX(width), Math.PI / 2);

      // Position and clip the grid lines (positioning is relevant, can't use view bounds above)
      gridLinesNode.clipArea = Shape.bounds(new Bounds2(0, 0, width, length).dilated(GRID_LINE_WIDTH / 2));
      gridLinesNode.translation = new Vector2(-width * MODEL_VIEW_SCALE / 2, -length * MODEL_VIEW_SCALE / 2);

      // Position the holes.
      bottomRightHoleNode.translation = modelViewTransform.modelToViewPosition(new Vector2(width, 0));
      topLeftHoleNode.translation = modelViewTransform.modelToViewPosition(new Vector2(0, length));
      topRightHoleNode.translation = modelViewTransform.modelToViewPosition(new Vector2(width, length));
    });

    // Set up child order, with the drag handles (if added) under the ball, but over everything else.
    const baseNodes = [borderRectangle, insideRectangle, gridLinesNode, pathNode, topLeftHoleNode, topRightHoleNode, bottomRightHoleNode];
    const dragHandles = [leftDragHandle, rightDragHandle, topDragHandle, bottomDragHandle];
    this.children = baseNodes.concat(options.allowDragToResize ? dragHandles : [], [ballNode]);
    this.mutate(options);
  }

  /**
   * Computes what the current model-view transform should be (depends on length/width).
   * @private
   *
   * @returns {Matrix3}
   */
  static computeModelViewMatrix(length, width) {
    return new Matrix3().rowMajor(MODEL_VIEW_SCALE, 0, -MODEL_VIEW_SCALE * width / 2, 0, -MODEL_VIEW_SCALE, MODEL_VIEW_SCALE * length / 2, 0, 0, 1);
  }

  /**
   * Creates a node that contains all of the potentially required grid lines.
   * @private
   *
   * @returns {Node}
   */
  static createGridLinesNode() {
    const min = -1;
    const max = ProportionPlaygroundConstants.BILLIARDS_COUNT_RANGE.max + 1;
    const shape = new Shape();
    _.range(min, max + 1).forEach(n => {
      shape.moveTo(n, min).lineTo(n, max);
      shape.moveTo(min, n).lineTo(max, n);
    });
    return new Path(shape, {
      scale: MODEL_VIEW_SCALE,
      stroke: ProportionPlaygroundColors.billiardsGridLineProperty,
      lineWidth: GRID_LINE_WIDTH
    });
  }
}
proportionPlayground.register('BilliardsTableNode', BilliardsTableNode);
export default BilliardsTableNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJCb3VuZHMyIiwiTWF0cml4MyIsIlV0aWxzIiwiVmVjdG9yMiIsIlNoYXBlIiwibWVyZ2UiLCJNb2RlbFZpZXdUcmFuc2Zvcm0yIiwiU2hhZGVkU3BoZXJlTm9kZSIsIkNpcmNsZSIsIkRyYWdMaXN0ZW5lciIsIkhCb3giLCJOb2RlIiwiUGF0aCIsIlJlY3RhbmdsZSIsIk11dGFibGVPcHRpb25zTm9kZSIsInByb3BvcnRpb25QbGF5Z3JvdW5kIiwiUHJvcG9ydGlvblBsYXlncm91bmRDb25zdGFudHMiLCJQcm9wb3J0aW9uUGxheWdyb3VuZENvbG9ycyIsIlNjZW5lUmF0aW9Ob2RlIiwiQmlsbGlhcmRzUGF0aCIsIk1PREVMX1ZJRVdfU0NBTEUiLCJCQUxMX0RJQU1FVEVSIiwiR1JJRF9MSU5FX1dJRFRIIiwiQmlsbGlhcmRzVGFibGVOb2RlIiwiY29uc3RydWN0b3IiLCJiaWxsaWFyZHNUYWJsZSIsInRhbmRlbSIsIm9wdGlvbnMiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJjb21wdXRlTW9kZWxWaWV3TWF0cml4IiwibGVuZ3RoUHJvcGVydHkiLCJ2YWx1ZSIsIndpZHRoUHJvcGVydHkiLCJmdWxsU2l6ZUJvdW5kcyIsImFsbG93RHJhZ1RvUmVzaXplIiwiYm9yZGVyUmVjdGFuZ2xlIiwiZmlsbCIsImJpbGxpYXJkc0JvcmRlclByb3BlcnR5IiwiY29ybmVyUmFkaXVzIiwiaW5zaWRlUmVjdGFuZ2xlIiwiYmlsbGlhcmRzSW5zaWRlUHJvcGVydHkiLCJkcmFnR3JpcERvdHMiLCJwaWNrYWJsZSIsInNwYWNpbmciLCJjaGlsZHJlbiIsIm1hcCIsImJpbGxpYXJkc0dyaXBEb3RzUHJvcGVydHkiLCJjZW50ZXIiLCJaRVJPIiwicm90YXRlZEdyaXBEb3RzIiwicm90YXRpb24iLCJNYXRoIiwiUEkiLCJsZWZ0RHJhZ0hhbmRsZSIsImN1cnNvciIsInJpZ2h0RHJhZ0hhbmRsZSIsInRvcERyYWdIYW5kbGUiLCJib3R0b21EcmFnSGFuZGxlIiwiZ3JpZExpbmVzTm9kZSIsImNyZWF0ZUdyaWRMaW5lc05vZGUiLCJwYXRoTm9kZSIsImNvbGxpc2lvblBvaW50cyIsImJhbGxQb3NpdGlvblByb3BlcnR5IiwicmVzdGFydEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsInJlc2V0IiwiYmFsbE5vZGUiLCJtYWluQ29sb3IiLCJiaWxsaWFyZHNCYWxsTWFpblByb3BlcnR5IiwiaGlnaGxpZ2h0Q29sb3IiLCJiaWxsaWFyZHNCYWxsSGlnaGxpZ2h0UHJvcGVydHkiLCJsaW5rIiwiYmFsbE1vZGVsUG9zaXRpb24iLCJ0cmFuc2xhdGlvbiIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJjcmVhdGVDaXJjbGUiLCJiaWxsaWFyZHNQb2NrZXRQcm9wZXJ0eSIsInRvcExlZnRIb2xlTm9kZSIsInRvcFJpZ2h0SG9sZU5vZGUiLCJib3R0b21SaWdodEhvbGVOb2RlIiwiY3JlYXRlRHJhZ0xpc3RlbmVyIiwiZHJhZ0hhbmRsZSIsInByb3BlcnR5IiwiY29vcmRpbmF0ZSIsImNoYW5nZVNpZ24iLCJzdGFydFBvaW50Iiwic3RhcnRQcm9wZXJ0eSIsImFkZElucHV0TGlzdGVuZXIiLCJhcHBseU9mZnNldCIsInN0YXJ0IiwiZXZlbnQiLCJsaXN0ZW5lciIsInBhcmVudFBvaW50IiwiZHJhZyIsImNoYW5nZSIsInJvdW5kU3ltbWV0cmljIiwiQklMTElBUkRTX0NPVU5UX1JBTkdFIiwiY29uc3RyYWluVmFsdWUiLCJjcmVhdGVUYW5kZW0iLCJtdWx0aWxpbmsiLCJsZW5ndGgiLCJ3aWR0aCIsInNldE1hdHJpeCIsInZpZXdFZGdlV2lkdGgiLCJtb2RlbEVkZ2VXaWR0aCIsInZpZXdUb01vZGVsRGVsdGFYIiwibG9jYWxCb3VuZHMiLCJwb2ludCIsImRpbGF0ZWRYWSIsIm1heCIsInZpZXdCb3VuZHMiLCJtb2RlbFRvVmlld1giLCJtb2RlbFRvVmlld1kiLCJzZXRSZWN0Qm91bmRzIiwiZGlsYXRlZCIsInNldE1vdXNlVG91Y2hBcmVhcyIsIm1vdXNlQXJlYSIsInBvbHlnb24iLCJ0cmFuc2Zvcm1lZCIsInJvdGF0aW9uMiIsInRvdWNoT2Zmc2V0IiwidG91Y2hBcmVhIiwibW9kZWxUb1ZpZXdEZWx0YVkiLCJtb2RlbFRvVmlld0RlbHRhWCIsImNsaXBBcmVhIiwiYm91bmRzIiwiYmFzZU5vZGVzIiwiZHJhZ0hhbmRsZXMiLCJjb25jYXQiLCJtdXRhdGUiLCJyb3dNYWpvciIsIm1pbiIsInNoYXBlIiwiXyIsInJhbmdlIiwiZm9yRWFjaCIsIm4iLCJtb3ZlVG8iLCJsaW5lVG8iLCJzY2FsZSIsInN0cm9rZSIsImJpbGxpYXJkc0dyaWRMaW5lUHJvcGVydHkiLCJsaW5lV2lkdGgiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkJpbGxpYXJkc1RhYmxlTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNi0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTaG93cyBhIHNpbmdsZSBCaWxsaWFyZHMgdGFibGUsIGRyYWdnYWJsZSBieSBpdHMgc2lkZXMsIHdpdGggYSBtb3ZpbmcgYmFsbCBhbmQgaG9sZXMgaW4gdGhlXHJcbiAqIHRvcCBsZWZ0LCB0b3AgcmlnaHQgYW5kIGJvdHRvbSByaWdodCBjb3JuZXJzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIEFuZHJlYSBMaW5cclxuICovXHJcblxyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IEJvdW5kczIgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL0JvdW5kczIuanMnO1xyXG5pbXBvcnQgTWF0cml4MyBmcm9tICcuLi8uLi8uLi8uLi8uLi9kb3QvanMvTWF0cml4My5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBNb2RlbFZpZXdUcmFuc2Zvcm0yIGZyb20gJy4uLy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdmlldy9Nb2RlbFZpZXdUcmFuc2Zvcm0yLmpzJztcclxuaW1wb3J0IFNoYWRlZFNwaGVyZU5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1NoYWRlZFNwaGVyZU5vZGUuanMnO1xyXG5pbXBvcnQgeyBDaXJjbGUsIERyYWdMaXN0ZW5lciwgSEJveCwgTm9kZSwgUGF0aCwgUmVjdGFuZ2xlIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IE11dGFibGVPcHRpb25zTm9kZSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zdW4vanMvTXV0YWJsZU9wdGlvbnNOb2RlLmpzJztcclxuaW1wb3J0IHByb3BvcnRpb25QbGF5Z3JvdW5kIGZyb20gJy4uLy4uLy4uL3Byb3BvcnRpb25QbGF5Z3JvdW5kLmpzJztcclxuaW1wb3J0IFByb3BvcnRpb25QbGF5Z3JvdW5kQ29uc3RhbnRzIGZyb20gJy4uLy4uL1Byb3BvcnRpb25QbGF5Z3JvdW5kQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IFByb3BvcnRpb25QbGF5Z3JvdW5kQ29sb3JzIGZyb20gJy4uL1Byb3BvcnRpb25QbGF5Z3JvdW5kQ29sb3JzLmpzJztcclxuaW1wb3J0IFNjZW5lUmF0aW9Ob2RlIGZyb20gJy4uL1NjZW5lUmF0aW9Ob2RlLmpzJztcclxuaW1wb3J0IEJpbGxpYXJkc1BhdGggZnJvbSAnLi9CaWxsaWFyZHNQYXRoLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBNT0RFTF9WSUVXX1NDQUxFID0gMTg7XHJcbmNvbnN0IEJBTExfRElBTUVURVIgPSAxMDtcclxuY29uc3QgR1JJRF9MSU5FX1dJRFRIID0gMC4wMjg7XHJcblxyXG5jbGFzcyBCaWxsaWFyZHNUYWJsZU5vZGUgZXh0ZW5kcyBTY2VuZVJhdGlvTm9kZSB7XHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtCaWxsaWFyZHNUYWJsZX0gYmlsbGlhcmRzVGFibGUgLSB0aGUgbW9kZWxcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIC0gU2VlIG9wdGlvbnMgYmVsb3cuIEFsc28gcGFzc2VkIHRvIE5vZGUncyBtdXRhdGUuXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGJpbGxpYXJkc1RhYmxlLCB0YW5kZW0sIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgc3VwZXIoIGJpbGxpYXJkc1RhYmxlICk7XHJcblxyXG4gICAgLy8ge01vZGVsVmlld1RyYW5zZm9ybTJ9IC0gV2lsbCBiZSB1cGRhdGVkIHdoZW4gdGhlIHdpZHRoL2xlbmd0aCBjaGFuZ2VzLlxyXG4gICAgY29uc3QgbW9kZWxWaWV3VHJhbnNmb3JtID0gbmV3IE1vZGVsVmlld1RyYW5zZm9ybTIoIEJpbGxpYXJkc1RhYmxlTm9kZS5jb21wdXRlTW9kZWxWaWV3TWF0cml4KCBiaWxsaWFyZHNUYWJsZS5sZW5ndGhQcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgYmlsbGlhcmRzVGFibGUud2lkdGhQcm9wZXJ0eS52YWx1ZSApICk7XHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcbiAgICAgIC8vIHtib29sZWFufSAtIFdoZXRoZXIgdGhpcyBub2RlIHNob3VsZCBhbHdheXMgdGFrZSB1cCB0aGUgYm91bmRzIGZvciBhIGZ1bGwtc2l6ZSAoMjB4MjApIGJpbGxpYXJkcyB0YWJsZS5cclxuICAgICAgZnVsbFNpemVCb3VuZHM6IHRydWUsXHJcblxyXG4gICAgICAvLyB7Ym9vbGVhbn0gLSBXaGV0aGVyIHRvIGFsbG93IGRyYWdnaW5nIHRoZSBib3JkZXJzIG9mIHRoZSB0YWJsZSB0byByZXNpemUgaXQuIElmIHRydWUsIGl0IHdpbGwgc2hvdyBzb21lXHJcbiAgICAgIC8vICAgICAgICAgICAgIFwiZ3JpcHB5IGRvdHNcIiB0byBpbmRpY2F0ZSBpdCBpcyBkcmFnZ2FibGUuXHJcbiAgICAgIGFsbG93RHJhZ1RvUmVzaXplOiB0cnVlLFxyXG5cclxuICAgICAgdGFuZGVtOiB0YW5kZW1cclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBNb2RlbCB0aGUgZWRnZSBvdXRzaWRlIG9mIHRoZSBncmVlbiBhcmVhIChub3QgYXMgYSBzdHJva2UpIHNpbmNlIHRoZXJlIGlzIG5vIHdheSB0byBkbyBcIm91dGVyXCIgc3Ryb2tlXHJcbiAgICBjb25zdCBib3JkZXJSZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKCB7XHJcbiAgICAgIGZpbGw6IFByb3BvcnRpb25QbGF5Z3JvdW5kQ29sb3JzLmJpbGxpYXJkc0JvcmRlclByb3BlcnR5LFxyXG4gICAgICBjb3JuZXJSYWRpdXM6IDlcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IGluc2lkZVJlY3RhbmdsZSA9IG5ldyBSZWN0YW5nbGUoIHtcclxuICAgICAgZmlsbDogUHJvcG9ydGlvblBsYXlncm91bmRDb2xvcnMuYmlsbGlhcmRzSW5zaWRlUHJvcGVydHlcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgZHJhZy1oYW5kbGUgcGFydHMgdG8gYmUgdXNlZCBhcyBjaGlsZHJlbi5cclxuICAgIGNvbnN0IGRyYWdHcmlwRG90cyA9IG5ldyBIQm94KCB7XHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZSwgLy8gdXNlIHRoZSBtb3VzZS90b3VjaCBhcmVhcyBkaXJlY3RseSwgZG9uJ3QgdGVzdCB0aGVzZVxyXG4gICAgICBzcGFjaW5nOiAxLjMsXHJcbiAgICAgIGNoaWxkcmVuOiBbIDAsIDEsIDIgXS5tYXAoICgpID0+IG5ldyBDaXJjbGUoIDEuMiwge1xyXG4gICAgICAgIGZpbGw6IFByb3BvcnRpb25QbGF5Z3JvdW5kQ29sb3JzLmJpbGxpYXJkc0dyaXBEb3RzUHJvcGVydHlcclxuICAgICAgfSApICksXHJcbiAgICAgIGNlbnRlcjogVmVjdG9yMi5aRVJPXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCByb3RhdGVkR3JpcERvdHMgPSBuZXcgTm9kZSggeyBjaGlsZHJlbjogWyBkcmFnR3JpcERvdHMgXSwgcm90YXRpb246IE1hdGguUEkgLyAyIH0gKTtcclxuXHJcbiAgICAvLyBEcmFnIGhhbmRsZXMgKHdpdGggZ3JpcHB5IGRvdHMpLiBUaGVzZSB3aWxsIGxpdmUgb24gdGhlIDQgYm9yZGVycywgYW5kIGNhbiBiZSBkcmFnZ2VkIHRvIHJlc2l6ZSB0aGUgdGFibGUuXHJcbiAgICBjb25zdCBsZWZ0RHJhZ0hhbmRsZSA9IG5ldyBOb2RlKCB7IGN1cnNvcjogJ3BvaW50ZXInLCBjaGlsZHJlbjogWyByb3RhdGVkR3JpcERvdHMgXSB9ICk7XHJcbiAgICBjb25zdCByaWdodERyYWdIYW5kbGUgPSBuZXcgTm9kZSggeyBjdXJzb3I6ICdwb2ludGVyJywgY2hpbGRyZW46IFsgcm90YXRlZEdyaXBEb3RzIF0gfSApO1xyXG4gICAgY29uc3QgdG9wRHJhZ0hhbmRsZSA9IG5ldyBOb2RlKCB7IGN1cnNvcjogJ3BvaW50ZXInLCBjaGlsZHJlbjogWyBkcmFnR3JpcERvdHMgXSB9ICk7XHJcbiAgICBjb25zdCBib3R0b21EcmFnSGFuZGxlID0gbmV3IE5vZGUoIHsgY3Vyc29yOiAncG9pbnRlcicsIGNoaWxkcmVuOiBbIGRyYWdHcmlwRG90cyBdIH0gKTtcclxuXHJcbiAgICAvLyBHcmlkIGxpbmVzIGZvciBpbiB0aGUgaW5uZXIgcmVjdGFuZ2xlLiBDbGlwcGluZyB3aWxsIGJlIHVzZWQgaW5zdGVhZCBvZiByZWRyYXdpbmcgd2hlbiB3aWR0aC9sZW5ndGggY2hhbmdlcy5cclxuICAgIGNvbnN0IGdyaWRMaW5lc05vZGUgPSBCaWxsaWFyZHNUYWJsZU5vZGUuY3JlYXRlR3JpZExpbmVzTm9kZSgpO1xyXG5cclxuICAgIC8vIFRoZSBwYXRoIHNob3dzIHRoZSB0cmFpbCBvZiB3aGVyZSB0aGUgYmFsbCBoYXMgYmVlblxyXG4gICAgY29uc3QgcGF0aE5vZGUgPSBuZXcgQmlsbGlhcmRzUGF0aCggbW9kZWxWaWV3VHJhbnNmb3JtLCBiaWxsaWFyZHNUYWJsZS5jb2xsaXNpb25Qb2ludHMsIGJpbGxpYXJkc1RhYmxlLmJhbGxQb3NpdGlvblByb3BlcnR5ICk7XHJcbiAgICBiaWxsaWFyZHNUYWJsZS5yZXN0YXJ0RW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICBwYXRoTm9kZS5yZXNldCgpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFRoZSBtb3ZpbmcgYmFsbCBub2RlXHJcbiAgICBjb25zdCBiYWxsTm9kZSA9IG5ldyBNdXRhYmxlT3B0aW9uc05vZGUoIFNoYWRlZFNwaGVyZU5vZGUsIFsgQkFMTF9ESUFNRVRFUiBdLCB7XHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZVxyXG4gICAgfSwge1xyXG4gICAgICBtYWluQ29sb3I6IFByb3BvcnRpb25QbGF5Z3JvdW5kQ29sb3JzLmJpbGxpYXJkc0JhbGxNYWluUHJvcGVydHksXHJcbiAgICAgIGhpZ2hsaWdodENvbG9yOiBQcm9wb3J0aW9uUGxheWdyb3VuZENvbG9ycy5iaWxsaWFyZHNCYWxsSGlnaGxpZ2h0UHJvcGVydHlcclxuICAgIH0gKTtcclxuICAgIGJpbGxpYXJkc1RhYmxlLmJhbGxQb3NpdGlvblByb3BlcnR5LmxpbmsoIGJhbGxNb2RlbFBvc2l0aW9uID0+IHtcclxuICAgICAgYmFsbE5vZGUudHJhbnNsYXRpb24gPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggYmFsbE1vZGVsUG9zaXRpb24gKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIGhvbGVzIGZvciB0b3AtbGVmdCwgdG9wLXJpZ2h0IGFuZCBib3R0b20tcmlnaHRcclxuICAgIGNvbnN0IGNyZWF0ZUNpcmNsZSA9ICgpID0+IG5ldyBDaXJjbGUoIEJBTExfRElBTUVURVIgLyAyLCB7IGZpbGw6IFByb3BvcnRpb25QbGF5Z3JvdW5kQ29sb3JzLmJpbGxpYXJkc1BvY2tldFByb3BlcnR5IH0gKTtcclxuICAgIGNvbnN0IHRvcExlZnRIb2xlTm9kZSA9IGNyZWF0ZUNpcmNsZSgpO1xyXG4gICAgY29uc3QgdG9wUmlnaHRIb2xlTm9kZSA9IGNyZWF0ZUNpcmNsZSgpO1xyXG4gICAgY29uc3QgYm90dG9tUmlnaHRIb2xlTm9kZSA9IGNyZWF0ZUNpcmNsZSgpO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogSG9vayB1cCB0aGUgZHJhZyBsaXN0ZW5lciBmb3IgZWFjaCBkcmFnIGhhbmRsZS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge05vZGV9IGRyYWdIYW5kbGVcclxuICAgICAqIEBwYXJhbSB7UHJvcGVydHkuPG51bWJlcj59IHByb3BlcnR5IC0gVGhlIHdpZHRoIG9yIGxlbmd0aCBwcm9wZXJ0eSBvZiB0aGUgdGFibGVcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjb29yZGluYXRlIC0gdGhlIGF4aXMsICd4JyBvciAneScsIHRvIHVzZS4gQ29ycmVzcG9uZHMgd2l0aCB3aWR0aCBvciBsZW5ndGgsIHJlc3BlY3RpdmVseS5cclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjaGFuZ2VTaWduIC0gLTEgb3IgMSwgZGVzaWduYXRlcyB3aGV0aGVyIGl0cyB0aGUgbGVmdCBvciByaWdodCwgdG9wIG9yIGJvdHRvbSBkcmFnSGFuZGxlXHJcbiAgICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IGNyZWF0ZURyYWdMaXN0ZW5lciA9ICggZHJhZ0hhbmRsZSwgcHJvcGVydHksIGNvb3JkaW5hdGUsIGNoYW5nZVNpZ24sIHRhbmRlbSApID0+IHtcclxuXHJcbiAgICAgIGxldCBzdGFydFBvaW50OyAvLyB0cmFjayB3aGVyZSB0aGUgbW91c2UgZHJhZyBzdGFydHNcclxuICAgICAgbGV0IHN0YXJ0UHJvcGVydHk7IC8vIHRyYWNrIHRoZSBiZWdpbm5pbmcgd2lkdGhcclxuXHJcbiAgICAgIGRyYWdIYW5kbGUuYWRkSW5wdXRMaXN0ZW5lciggbmV3IERyYWdMaXN0ZW5lcigge1xyXG4gICAgICAgIHRhbmRlbTogdGFuZGVtLFxyXG4gICAgICAgIGFwcGx5T2Zmc2V0OiBmYWxzZSxcclxuICAgICAgICBzdGFydDogKCBldmVudCwgbGlzdGVuZXIgKSA9PiB7XHJcbiAgICAgICAgICBzdGFydFBvaW50ID0gbGlzdGVuZXIucGFyZW50UG9pbnQ7XHJcbiAgICAgICAgICBzdGFydFByb3BlcnR5ID0gcHJvcGVydHkudmFsdWU7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgZHJhZzogKCBldmVudCwgbGlzdGVuZXIgKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBjaGFuZ2UgPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggY2hhbmdlU2lnbiAqICggbGlzdGVuZXIucGFyZW50UG9pbnRbIGNvb3JkaW5hdGUgXSAtIHN0YXJ0UG9pbnRbIGNvb3JkaW5hdGUgXSApICogMiAvIE1PREVMX1ZJRVdfU0NBTEUgKTtcclxuXHJcbiAgICAgICAgICAvLyBjaGFuZ2Ugd2lkdGggc28gaXRzIHdpdGhpbiB0aGUgYWNjZXB0YWJsZSByYW5nZVxyXG4gICAgICAgICAgcHJvcGVydHkudmFsdWUgPSBQcm9wb3J0aW9uUGxheWdyb3VuZENvbnN0YW50cy5CSUxMSUFSRFNfQ09VTlRfUkFOR0UuY29uc3RyYWluVmFsdWUoIHN0YXJ0UHJvcGVydHkgKyBjaGFuZ2UgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICB9ICkgKTtcclxuICAgIH07XHJcbiAgICAvLyBXaGVuIGEgc2lkZSBvZiB0aGUgdGFibGUgaXMgZHJhZ2dlZCwgdGhlIGFwcHJvcHJpYXRlIHdpZHRoIG9yIGxlbmd0aCBjaGFuZ2VzLlxyXG4gICAgY3JlYXRlRHJhZ0xpc3RlbmVyKCBsZWZ0RHJhZ0hhbmRsZSwgYmlsbGlhcmRzVGFibGUud2lkdGhQcm9wZXJ0eSwgJ3gnLCAtMSwgdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xlZnREcmFnTGlzdGVuZXInICkgKTtcclxuICAgIGNyZWF0ZURyYWdMaXN0ZW5lciggcmlnaHREcmFnSGFuZGxlLCBiaWxsaWFyZHNUYWJsZS53aWR0aFByb3BlcnR5LCAneCcsIDEsIHRhbmRlbS5jcmVhdGVUYW5kZW0oICdyaWdodERyYWdMaXN0ZW5lcicgKSApO1xyXG4gICAgY3JlYXRlRHJhZ0xpc3RlbmVyKCB0b3BEcmFnSGFuZGxlLCBiaWxsaWFyZHNUYWJsZS5sZW5ndGhQcm9wZXJ0eSwgJ3knLCAtMSwgdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3RvcERyYWdMaXN0ZW5lcicgKSApO1xyXG4gICAgY3JlYXRlRHJhZ0xpc3RlbmVyKCBib3R0b21EcmFnSGFuZGxlLCBiaWxsaWFyZHNUYWJsZS5sZW5ndGhQcm9wZXJ0eSwgJ3knLCAxLCB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnYm90dG9tRHJhZ0xpc3RlbmVyJyApICk7XHJcblxyXG4gICAgLy8gV2hlbiB0aGUgdGFibGUgaXMgcmVzaXplZCwgcmVkcmF3IGl0LlxyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayggW1xyXG4gICAgICBiaWxsaWFyZHNUYWJsZS5sZW5ndGhQcm9wZXJ0eSxcclxuICAgICAgYmlsbGlhcmRzVGFibGUud2lkdGhQcm9wZXJ0eVxyXG4gICAgXSwgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsZW5ndGggPSBiaWxsaWFyZHNUYWJsZS5sZW5ndGhQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgY29uc3Qgd2lkdGggPSBiaWxsaWFyZHNUYWJsZS53aWR0aFByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgICAgLy8gUmVjb21wdXRlIHRoZSBtb2RlbC12aWV3IHRyYW5zZm9ybS5cclxuICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLnNldE1hdHJpeCggQmlsbGlhcmRzVGFibGVOb2RlLmNvbXB1dGVNb2RlbFZpZXdNYXRyaXgoIGJpbGxpYXJkc1RhYmxlLmxlbmd0aFByb3BlcnR5LnZhbHVlLFxyXG4gICAgICAgIGJpbGxpYXJkc1RhYmxlLndpZHRoUHJvcGVydHkudmFsdWUgKSApO1xyXG5cclxuICAgICAgY29uc3Qgdmlld0VkZ2VXaWR0aCA9IDExO1xyXG4gICAgICBjb25zdCBtb2RlbEVkZ2VXaWR0aCA9IG1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbERlbHRhWCggdmlld0VkZ2VXaWR0aCApO1xyXG5cclxuICAgICAgLy8gQ29tcHV0ZSB0aGUgZnVsbCBib3VuZHMgKGFuZCBzZXQgYXMgbG9jYWwgYm91bmRzKSBpZiB0aGUgb3B0aW9uIGlzIHByb3ZpZGVkLlxyXG4gICAgICBpZiAoIG9wdGlvbnMuZnVsbFNpemVCb3VuZHMgKSB7XHJcbiAgICAgICAgdGhpcy5sb2NhbEJvdW5kcyA9IEJvdW5kczIucG9pbnQoIDAsIDAgKS5kaWxhdGVkWFkoXHJcbiAgICAgICAgICBQcm9wb3J0aW9uUGxheWdyb3VuZENvbnN0YW50cy5CSUxMSUFSRFNfQ09VTlRfUkFOR0UubWF4ICogTU9ERUxfVklFV19TQ0FMRSAvIDIgKyB2aWV3RWRnZVdpZHRoLFxyXG4gICAgICAgICAgUHJvcG9ydGlvblBsYXlncm91bmRDb25zdGFudHMuQklMTElBUkRTX0NPVU5UX1JBTkdFLm1heCAqIE1PREVMX1ZJRVdfU0NBTEUgLyAyICsgdmlld0VkZ2VXaWR0aCApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBEZXRlcm1pbmUgdGhlIHZpZXcgYm91bmRzIG9mIHRoZSBhcmVhIHdoZXJlIHRoZSBiYWxsIGNhbiBiZS5cclxuICAgICAgY29uc3Qgdmlld0JvdW5kcyA9IG5ldyBCb3VuZHMyKCBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCAwICksXHJcbiAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggbGVuZ3RoICksIC8vIHNpbmNlIHRoaXMgZ2V0cyBtYXBwZWQgdG8gdGhlIG1pblxyXG4gICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIHdpZHRoICksXHJcbiAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggMCApICk7XHJcbiAgICAgIGluc2lkZVJlY3RhbmdsZS5zZXRSZWN0Qm91bmRzKCB2aWV3Qm91bmRzICk7XHJcbiAgICAgIGJvcmRlclJlY3RhbmdsZS5zZXRSZWN0Qm91bmRzKCB2aWV3Qm91bmRzLmRpbGF0ZWQoIHZpZXdFZGdlV2lkdGggKSApO1xyXG5cclxuICAgICAgbGVmdERyYWdIYW5kbGUuY2VudGVyID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIG5ldyBWZWN0b3IyKCAtbW9kZWxFZGdlV2lkdGggLyAyLCBsZW5ndGggLyAyICkgKTtcclxuICAgICAgcmlnaHREcmFnSGFuZGxlLmNlbnRlciA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBuZXcgVmVjdG9yMiggd2lkdGggKyBtb2RlbEVkZ2VXaWR0aCAvIDIsIGxlbmd0aCAvIDIgKSApO1xyXG4gICAgICB0b3BEcmFnSGFuZGxlLmNlbnRlciA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBuZXcgVmVjdG9yMiggd2lkdGggLyAyLCBsZW5ndGggKyBtb2RlbEVkZ2VXaWR0aCAvIDIgKSApO1xyXG4gICAgICBib3R0b21EcmFnSGFuZGxlLmNlbnRlciA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBuZXcgVmVjdG9yMiggd2lkdGggLyAyLCAtbW9kZWxFZGdlV2lkdGggLyAyICkgKTtcclxuXHJcbiAgICAgIGZ1bmN0aW9uIHNldE1vdXNlVG91Y2hBcmVhcyggZHJhZ0hhbmRsZSwgd2lkdGgsIGxlbmd0aCwgcm90YXRpb24gKSB7XHJcbiAgICAgICAgLy8gUXVhZHJpbGF0ZXJhbCB0aGF0IGNvdmVycyB0aGUgYm9yZGVyIGluIHRoZSBzcGVjaWZpZWQgcXVhZHJhbnRcclxuICAgICAgICBkcmFnSGFuZGxlLm1vdXNlQXJlYSA9IG5ldyBTaGFwZSgpLnBvbHlnb24oIFtcclxuICAgICAgICAgIG5ldyBWZWN0b3IyKCAtd2lkdGggLyAyLCAtbGVuZ3RoIC8gMiApLFxyXG4gICAgICAgICAgbmV3IFZlY3RvcjIoIC13aWR0aCAvIDIsIGxlbmd0aCAvIDIgKSxcclxuICAgICAgICAgIG5ldyBWZWN0b3IyKCB3aWR0aCAvIDIsIGxlbmd0aCAvIDIgKyB3aWR0aCApLFxyXG4gICAgICAgICAgbmV3IFZlY3RvcjIoIHdpZHRoIC8gMiwgLWxlbmd0aCAvIDIgLSB3aWR0aCApXHJcbiAgICAgICAgXSApLnRyYW5zZm9ybWVkKCBNYXRyaXgzLnJvdGF0aW9uMiggcm90YXRpb24gKSApO1xyXG5cclxuICAgICAgICAvLyBBcHBseSBhbiBhZGRpdGlvbmFsIG9mZnNldCBmb3IgdG91Y2hcclxuICAgICAgICBjb25zdCB0b3VjaE9mZnNldCA9IDAuNiAqIHdpZHRoO1xyXG4gICAgICAgIGRyYWdIYW5kbGUudG91Y2hBcmVhID0gbmV3IFNoYXBlKCkucG9seWdvbiggW1xyXG4gICAgICAgICAgbmV3IFZlY3RvcjIoIC13aWR0aCAvIDIgLSB0b3VjaE9mZnNldCwgLWxlbmd0aCAvIDIgKyB0b3VjaE9mZnNldCApLFxyXG4gICAgICAgICAgbmV3IFZlY3RvcjIoIC13aWR0aCAvIDIgLSB0b3VjaE9mZnNldCwgbGVuZ3RoIC8gMiAtIHRvdWNoT2Zmc2V0ICksXHJcbiAgICAgICAgICBuZXcgVmVjdG9yMiggd2lkdGggLyAyICsgdG91Y2hPZmZzZXQsIGxlbmd0aCAvIDIgKyB3aWR0aCArIHRvdWNoT2Zmc2V0ICksXHJcbiAgICAgICAgICBuZXcgVmVjdG9yMiggd2lkdGggLyAyICsgdG91Y2hPZmZzZXQsIC1sZW5ndGggLyAyIC0gd2lkdGggLSB0b3VjaE9mZnNldCApXHJcbiAgICAgICAgXSApLnRyYW5zZm9ybWVkKCBNYXRyaXgzLnJvdGF0aW9uMiggcm90YXRpb24gKSApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBzZXRNb3VzZVRvdWNoQXJlYXMoIGxlZnREcmFnSGFuZGxlLCB2aWV3RWRnZVdpZHRoLCAtbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFZKCBsZW5ndGggKSwgTWF0aC5QSSApO1xyXG4gICAgICBzZXRNb3VzZVRvdWNoQXJlYXMoIHJpZ2h0RHJhZ0hhbmRsZSwgdmlld0VkZ2VXaWR0aCwgLW1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWSggbGVuZ3RoICksIDAgKTtcclxuICAgICAgc2V0TW91c2VUb3VjaEFyZWFzKCB0b3BEcmFnSGFuZGxlLCB2aWV3RWRnZVdpZHRoLCBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YVgoIHdpZHRoICksIC1NYXRoLlBJIC8gMiApO1xyXG4gICAgICBzZXRNb3VzZVRvdWNoQXJlYXMoIGJvdHRvbURyYWdIYW5kbGUsIHZpZXdFZGdlV2lkdGgsIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggd2lkdGggKSwgTWF0aC5QSSAvIDIgKTtcclxuXHJcbiAgICAgIC8vIFBvc2l0aW9uIGFuZCBjbGlwIHRoZSBncmlkIGxpbmVzIChwb3NpdGlvbmluZyBpcyByZWxldmFudCwgY2FuJ3QgdXNlIHZpZXcgYm91bmRzIGFib3ZlKVxyXG4gICAgICBncmlkTGluZXNOb2RlLmNsaXBBcmVhID0gU2hhcGUuYm91bmRzKCBuZXcgQm91bmRzMiggMCwgMCwgd2lkdGgsIGxlbmd0aCApLmRpbGF0ZWQoIEdSSURfTElORV9XSURUSCAvIDIgKSApO1xyXG4gICAgICBncmlkTGluZXNOb2RlLnRyYW5zbGF0aW9uID0gbmV3IFZlY3RvcjIoIC13aWR0aCAqIE1PREVMX1ZJRVdfU0NBTEUgLyAyLCAtbGVuZ3RoICogTU9ERUxfVklFV19TQ0FMRSAvIDIgKTtcclxuXHJcbiAgICAgIC8vIFBvc2l0aW9uIHRoZSBob2xlcy5cclxuICAgICAgYm90dG9tUmlnaHRIb2xlTm9kZS50cmFuc2xhdGlvbiA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBuZXcgVmVjdG9yMiggd2lkdGgsIDAgKSApO1xyXG4gICAgICB0b3BMZWZ0SG9sZU5vZGUudHJhbnNsYXRpb24gPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggbmV3IFZlY3RvcjIoIDAsIGxlbmd0aCApICk7XHJcbiAgICAgIHRvcFJpZ2h0SG9sZU5vZGUudHJhbnNsYXRpb24gPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggbmV3IFZlY3RvcjIoIHdpZHRoLCBsZW5ndGggKSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFNldCB1cCBjaGlsZCBvcmRlciwgd2l0aCB0aGUgZHJhZyBoYW5kbGVzIChpZiBhZGRlZCkgdW5kZXIgdGhlIGJhbGwsIGJ1dCBvdmVyIGV2ZXJ5dGhpbmcgZWxzZS5cclxuICAgIGNvbnN0IGJhc2VOb2RlcyA9IFtcclxuICAgICAgYm9yZGVyUmVjdGFuZ2xlLCBpbnNpZGVSZWN0YW5nbGUsXHJcbiAgICAgIGdyaWRMaW5lc05vZGUsXHJcbiAgICAgIHBhdGhOb2RlLFxyXG4gICAgICB0b3BMZWZ0SG9sZU5vZGUsIHRvcFJpZ2h0SG9sZU5vZGUsIGJvdHRvbVJpZ2h0SG9sZU5vZGVcclxuICAgIF07XHJcbiAgICBjb25zdCBkcmFnSGFuZGxlcyA9IFtcclxuICAgICAgbGVmdERyYWdIYW5kbGUsIHJpZ2h0RHJhZ0hhbmRsZSwgdG9wRHJhZ0hhbmRsZSwgYm90dG9tRHJhZ0hhbmRsZVxyXG4gICAgXTtcclxuICAgIHRoaXMuY2hpbGRyZW4gPSBiYXNlTm9kZXMuY29uY2F0KCBvcHRpb25zLmFsbG93RHJhZ1RvUmVzaXplID8gZHJhZ0hhbmRsZXMgOiBbXSwgWyBiYWxsTm9kZSBdICk7XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBDb21wdXRlcyB3aGF0IHRoZSBjdXJyZW50IG1vZGVsLXZpZXcgdHJhbnNmb3JtIHNob3VsZCBiZSAoZGVwZW5kcyBvbiBsZW5ndGgvd2lkdGgpLlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7TWF0cml4M31cclxuICAgKi9cclxuICBzdGF0aWMgY29tcHV0ZU1vZGVsVmlld01hdHJpeCggbGVuZ3RoLCB3aWR0aCApIHtcclxuICAgIHJldHVybiBuZXcgTWF0cml4MygpLnJvd01ham9yKCBNT0RFTF9WSUVXX1NDQUxFLCAwLCAtTU9ERUxfVklFV19TQ0FMRSAqIHdpZHRoIC8gMixcclxuICAgICAgMCwgLU1PREVMX1ZJRVdfU0NBTEUsIE1PREVMX1ZJRVdfU0NBTEUgKiBsZW5ndGggLyAyLFxyXG4gICAgICAwLCAwLCAxICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgbm9kZSB0aGF0IGNvbnRhaW5zIGFsbCBvZiB0aGUgcG90ZW50aWFsbHkgcmVxdWlyZWQgZ3JpZCBsaW5lcy5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqXHJcbiAgICogQHJldHVybnMge05vZGV9XHJcbiAgICovXHJcbiAgc3RhdGljIGNyZWF0ZUdyaWRMaW5lc05vZGUoKSB7XHJcbiAgICBjb25zdCBtaW4gPSAtMTtcclxuICAgIGNvbnN0IG1heCA9IFByb3BvcnRpb25QbGF5Z3JvdW5kQ29uc3RhbnRzLkJJTExJQVJEU19DT1VOVF9SQU5HRS5tYXggKyAxO1xyXG4gICAgY29uc3Qgc2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuXHJcbiAgICBfLnJhbmdlKCBtaW4sIG1heCArIDEgKS5mb3JFYWNoKCBuID0+IHtcclxuICAgICAgc2hhcGUubW92ZVRvKCBuLCBtaW4gKVxyXG4gICAgICAgIC5saW5lVG8oIG4sIG1heCApO1xyXG4gICAgICBzaGFwZS5tb3ZlVG8oIG1pbiwgbiApXHJcbiAgICAgICAgLmxpbmVUbyggbWF4LCBuICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQYXRoKCBzaGFwZSwge1xyXG4gICAgICBzY2FsZTogTU9ERUxfVklFV19TQ0FMRSxcclxuICAgICAgc3Ryb2tlOiBQcm9wb3J0aW9uUGxheWdyb3VuZENvbG9ycy5iaWxsaWFyZHNHcmlkTGluZVByb3BlcnR5LFxyXG4gICAgICBsaW5lV2lkdGg6IEdSSURfTElORV9XSURUSFxyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxucHJvcG9ydGlvblBsYXlncm91bmQucmVnaXN0ZXIoICdCaWxsaWFyZHNUYWJsZU5vZGUnLCBCaWxsaWFyZHNUYWJsZU5vZGUgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IEJpbGxpYXJkc1RhYmxlTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFNBQVMsTUFBTSxxQ0FBcUM7QUFDM0QsT0FBT0MsT0FBTyxNQUFNLGtDQUFrQztBQUN0RCxPQUFPQyxPQUFPLE1BQU0sa0NBQWtDO0FBQ3RELE9BQU9DLEtBQUssTUFBTSxnQ0FBZ0M7QUFDbEQsT0FBT0MsT0FBTyxNQUFNLGtDQUFrQztBQUN0RCxTQUFTQyxLQUFLLFFBQVEsbUNBQW1DO0FBQ3pELE9BQU9DLEtBQUssTUFBTSxzQ0FBc0M7QUFDeEQsT0FBT0MsbUJBQW1CLE1BQU0sMERBQTBEO0FBQzFGLE9BQU9DLGdCQUFnQixNQUFNLG9EQUFvRDtBQUNqRixTQUFTQyxNQUFNLEVBQUVDLFlBQVksRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsU0FBUyxRQUFRLHNDQUFzQztBQUN4RyxPQUFPQyxrQkFBa0IsTUFBTSw2Q0FBNkM7QUFDNUUsT0FBT0Msb0JBQW9CLE1BQU0sa0NBQWtDO0FBQ25FLE9BQU9DLDZCQUE2QixNQUFNLHdDQUF3QztBQUNsRixPQUFPQywwQkFBMEIsTUFBTSxrQ0FBa0M7QUFDekUsT0FBT0MsY0FBYyxNQUFNLHNCQUFzQjtBQUNqRCxPQUFPQyxhQUFhLE1BQU0sb0JBQW9COztBQUU5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