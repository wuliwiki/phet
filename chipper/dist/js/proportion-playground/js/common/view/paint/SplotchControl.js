// Copyright 2016-2022, University of Colorado Boulder

/**
 * Combines a mutable SplotchNode with its associated NumberPickers.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import dotRandom from '../../../../../dot/js/dotRandom.js';
import Vector2 from '../../../../../dot/js/Vector2.js';
import { Node } from '../../../../../scenery/js/imports.js';
import proportionPlayground from '../../../proportionPlayground.js';
import PaintChoice from '../../model/paint/PaintChoice.js';
import Side from '../../model/Side.js';
import ProportionPlaygroundConstants from '../../ProportionPlaygroundConstants.js';
import SceneRatioControl from '../SceneRatioControl.js';
import PaintBalloonNode from './PaintBalloonNode.js';
import PaintDripNode from './PaintDripNode.js';
import SplotchNode from './SplotchNode.js';

// Used as scratch vectors below
const startVector = new Vector2(0, 0);

// {Vector2} - Center of the splotch in splotch-control coordinates.
const SPLOTCH_POSITION = new Vector2(0, ProportionPlaygroundConstants.CONTROL_Y_OFFSET);
class SplotchControl extends SceneRatioControl {
  /**
   * @param {Splotch} splotch - the model
   * @param {Property.<PaintChoice>} paintChoiceProperty - Holds our current paint choice
   * @param {boolean} useVisibleAmounts - Whether our visible splotch size should be based on the "visible" counts as
   *                                      determined by the position of balloons/drips, or by the "real count"
   * @param {Side} balloonThrowSide - The side where balloon throws should originate from
   * @param {Tandem} tandem
   */
  constructor(splotch, paintChoiceProperty, useVisibleAmounts, balloonThrowSide, tandem) {
    assert && assert(tandem);
    super(splotch, PaintChoice.getActiveColorProperty(paintChoiceProperty, Side.LEFT), PaintChoice.getActiveColorProperty(paintChoiceProperty, Side.RIGHT), tandem);
    const dripLayer = new Node();
    const balloonLayer = new Node();

    // @private {SplotchNode}
    this.splotchNode = new SplotchNode(splotch, paintChoiceProperty, {
      useVisibleAmounts: useVisibleAmounts,
      translation: SPLOTCH_POSITION
    });
    this.addChild(dripLayer);
    this.addChild(this.splotchNode);
    this.addChild(balloonLayer);
    this.addBottomPickers();

    // @private {Side}
    this.balloonThrowSide = balloonThrowSide;

    // @private {Array.<PaintBalloonNode>}
    this.balloonNodes = [];

    // @private {Array.<PaintDripNode>}
    this.dripNodes = [];

    // Never add balloons/drips if we don't use the visible amounts
    if (useVisibleAmounts) {
      // Add balloon views when the model is added
      splotch.balloons.addItemAddedListener(balloon => {
        // Balloons have a random slight offset for the start/end (in the view only)
        const randomStart = new Vector2(dotRandom.nextDouble(), dotRandom.nextDouble()).minusScalar(0.5).timesScalar(150);
        const randomEnd = new Vector2(dotRandom.nextDouble(), dotRandom.nextDouble()).minusScalar(0.5).timesScalar(30);
        const balloonNode = new PaintBalloonNode(balloon, paintChoiceProperty, randomStart, randomEnd);
        balloonLayer.addChild(balloonNode);
        this.balloonNodes.push(balloonNode);
      });

      // Remove balloon views when the model is removed
      splotch.balloons.addItemRemovedListener(balloon => {
        for (let i = this.balloonNodes.length - 1; i >= 0; i--) {
          const balloonNode = this.balloonNodes[i];
          if (balloonNode.paintBalloon === balloon) {
            this.balloonNodes.splice(i, 1);
            balloonLayer.removeChild(balloonNode);
            balloonNode.dispose();
          }
        }
      });

      // Add drip views when the model is added
      splotch.drips.addItemAddedListener(drip => {
        const dripNode = new PaintDripNode(drip, paintChoiceProperty);
        dripLayer.addChild(dripNode);
        this.dripNodes.push(dripNode);
      });

      // Remove drip views when the model is removed
      splotch.drips.addItemRemovedListener(drip => {
        for (let i = this.dripNodes.length - 1; i >= 0; i--) {
          const dripNode = this.dripNodes[i];
          if (dripNode.paintDrip === drip) {
            this.dripNodes.splice(i, 1);
            dripLayer.removeChild(dripNode);
            dripNode.dispose();
          }
        }
      });
    }
  }

  /**
   * Steps forward in time.
   * @public
   *
   * @param {number} dt - In seconds
   * @param {Bounds2} visibleBounds
   */
  step(dt, visibleBounds) {
    if (this.balloonNodes.length || this.dripNodes.length) {
      visibleBounds = this.parentToLocalBounds(visibleBounds);
      const balloonSign = this.balloonThrowSide === Side.LEFT ? -1 : 1;
      const startPosition = startVector.setXY(visibleBounds.centerX + 0.55 * balloonSign * visibleBounds.width, visibleBounds.bottom * 0.8);

      // Update balloon positions
      for (let i = 0; i < this.balloonNodes.length; i++) {
        this.balloonNodes[i].position(startPosition, SPLOTCH_POSITION);
      }

      // Update drip positions
      for (let i = this.dripNodes.length - 1; i >= 0; i--) {
        this.dripNodes[i].position(SPLOTCH_POSITION, visibleBounds.bottom);
      }
    }
  }
}
proportionPlayground.register('SplotchControl', SplotchControl);
export default SplotchControl;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJWZWN0b3IyIiwiTm9kZSIsInByb3BvcnRpb25QbGF5Z3JvdW5kIiwiUGFpbnRDaG9pY2UiLCJTaWRlIiwiUHJvcG9ydGlvblBsYXlncm91bmRDb25zdGFudHMiLCJTY2VuZVJhdGlvQ29udHJvbCIsIlBhaW50QmFsbG9vbk5vZGUiLCJQYWludERyaXBOb2RlIiwiU3Bsb3RjaE5vZGUiLCJzdGFydFZlY3RvciIsIlNQTE9UQ0hfUE9TSVRJT04iLCJDT05UUk9MX1lfT0ZGU0VUIiwiU3Bsb3RjaENvbnRyb2wiLCJjb25zdHJ1Y3RvciIsInNwbG90Y2giLCJwYWludENob2ljZVByb3BlcnR5IiwidXNlVmlzaWJsZUFtb3VudHMiLCJiYWxsb29uVGhyb3dTaWRlIiwidGFuZGVtIiwiYXNzZXJ0IiwiZ2V0QWN0aXZlQ29sb3JQcm9wZXJ0eSIsIkxFRlQiLCJSSUdIVCIsImRyaXBMYXllciIsImJhbGxvb25MYXllciIsInNwbG90Y2hOb2RlIiwidHJhbnNsYXRpb24iLCJhZGRDaGlsZCIsImFkZEJvdHRvbVBpY2tlcnMiLCJiYWxsb29uTm9kZXMiLCJkcmlwTm9kZXMiLCJiYWxsb29ucyIsImFkZEl0ZW1BZGRlZExpc3RlbmVyIiwiYmFsbG9vbiIsInJhbmRvbVN0YXJ0IiwibmV4dERvdWJsZSIsIm1pbnVzU2NhbGFyIiwidGltZXNTY2FsYXIiLCJyYW5kb21FbmQiLCJiYWxsb29uTm9kZSIsInB1c2giLCJhZGRJdGVtUmVtb3ZlZExpc3RlbmVyIiwiaSIsImxlbmd0aCIsInBhaW50QmFsbG9vbiIsInNwbGljZSIsInJlbW92ZUNoaWxkIiwiZGlzcG9zZSIsImRyaXBzIiwiZHJpcCIsImRyaXBOb2RlIiwicGFpbnREcmlwIiwic3RlcCIsImR0IiwidmlzaWJsZUJvdW5kcyIsInBhcmVudFRvTG9jYWxCb3VuZHMiLCJiYWxsb29uU2lnbiIsInN0YXJ0UG9zaXRpb24iLCJzZXRYWSIsImNlbnRlclgiLCJ3aWR0aCIsImJvdHRvbSIsInBvc2l0aW9uIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJTcGxvdGNoQ29udHJvbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNi0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBDb21iaW5lcyBhIG11dGFibGUgU3Bsb3RjaE5vZGUgd2l0aCBpdHMgYXNzb2NpYXRlZCBOdW1iZXJQaWNrZXJzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBkb3RSYW5kb20gZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL2RvdFJhbmRvbS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgTm9kZSB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBwcm9wb3J0aW9uUGxheWdyb3VuZCBmcm9tICcuLi8uLi8uLi9wcm9wb3J0aW9uUGxheWdyb3VuZC5qcyc7XHJcbmltcG9ydCBQYWludENob2ljZSBmcm9tICcuLi8uLi9tb2RlbC9wYWludC9QYWludENob2ljZS5qcyc7XHJcbmltcG9ydCBTaWRlIGZyb20gJy4uLy4uL21vZGVsL1NpZGUuanMnO1xyXG5pbXBvcnQgUHJvcG9ydGlvblBsYXlncm91bmRDb25zdGFudHMgZnJvbSAnLi4vLi4vUHJvcG9ydGlvblBsYXlncm91bmRDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgU2NlbmVSYXRpb0NvbnRyb2wgZnJvbSAnLi4vU2NlbmVSYXRpb0NvbnRyb2wuanMnO1xyXG5pbXBvcnQgUGFpbnRCYWxsb29uTm9kZSBmcm9tICcuL1BhaW50QmFsbG9vbk5vZGUuanMnO1xyXG5pbXBvcnQgUGFpbnREcmlwTm9kZSBmcm9tICcuL1BhaW50RHJpcE5vZGUuanMnO1xyXG5pbXBvcnQgU3Bsb3RjaE5vZGUgZnJvbSAnLi9TcGxvdGNoTm9kZS5qcyc7XHJcblxyXG4vLyBVc2VkIGFzIHNjcmF0Y2ggdmVjdG9ycyBiZWxvd1xyXG5jb25zdCBzdGFydFZlY3RvciA9IG5ldyBWZWN0b3IyKCAwLCAwICk7XHJcblxyXG4vLyB7VmVjdG9yMn0gLSBDZW50ZXIgb2YgdGhlIHNwbG90Y2ggaW4gc3Bsb3RjaC1jb250cm9sIGNvb3JkaW5hdGVzLlxyXG5jb25zdCBTUExPVENIX1BPU0lUSU9OID0gbmV3IFZlY3RvcjIoIDAsIFByb3BvcnRpb25QbGF5Z3JvdW5kQ29uc3RhbnRzLkNPTlRST0xfWV9PRkZTRVQgKTtcclxuXHJcbmNsYXNzIFNwbG90Y2hDb250cm9sIGV4dGVuZHMgU2NlbmVSYXRpb0NvbnRyb2wge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7U3Bsb3RjaH0gc3Bsb3RjaCAtIHRoZSBtb2RlbFxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPFBhaW50Q2hvaWNlPn0gcGFpbnRDaG9pY2VQcm9wZXJ0eSAtIEhvbGRzIG91ciBjdXJyZW50IHBhaW50IGNob2ljZVxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gdXNlVmlzaWJsZUFtb3VudHMgLSBXaGV0aGVyIG91ciB2aXNpYmxlIHNwbG90Y2ggc2l6ZSBzaG91bGQgYmUgYmFzZWQgb24gdGhlIFwidmlzaWJsZVwiIGNvdW50cyBhc1xyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlcm1pbmVkIGJ5IHRoZSBwb3NpdGlvbiBvZiBiYWxsb29ucy9kcmlwcywgb3IgYnkgdGhlIFwicmVhbCBjb3VudFwiXHJcbiAgICogQHBhcmFtIHtTaWRlfSBiYWxsb29uVGhyb3dTaWRlIC0gVGhlIHNpZGUgd2hlcmUgYmFsbG9vbiB0aHJvd3Mgc2hvdWxkIG9yaWdpbmF0ZSBmcm9tXHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBzcGxvdGNoLCBwYWludENob2ljZVByb3BlcnR5LCB1c2VWaXNpYmxlQW1vdW50cywgYmFsbG9vblRocm93U2lkZSwgdGFuZGVtICkge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGFuZGVtICk7XHJcblxyXG4gICAgc3VwZXIoXHJcbiAgICAgIHNwbG90Y2gsXHJcbiAgICAgIFBhaW50Q2hvaWNlLmdldEFjdGl2ZUNvbG9yUHJvcGVydHkoIHBhaW50Q2hvaWNlUHJvcGVydHksIFNpZGUuTEVGVCApLFxyXG4gICAgICBQYWludENob2ljZS5nZXRBY3RpdmVDb2xvclByb3BlcnR5KCBwYWludENob2ljZVByb3BlcnR5LCBTaWRlLlJJR0hUICksXHJcbiAgICAgIHRhbmRlbVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBkcmlwTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgY29uc3QgYmFsbG9vbkxheWVyID0gbmV3IE5vZGUoKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7U3Bsb3RjaE5vZGV9XHJcbiAgICB0aGlzLnNwbG90Y2hOb2RlID0gbmV3IFNwbG90Y2hOb2RlKCBzcGxvdGNoLCBwYWludENob2ljZVByb3BlcnR5LCB7XHJcbiAgICAgIHVzZVZpc2libGVBbW91bnRzOiB1c2VWaXNpYmxlQW1vdW50cyxcclxuICAgICAgdHJhbnNsYXRpb246IFNQTE9UQ0hfUE9TSVRJT05cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBkcmlwTGF5ZXIgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuc3Bsb3RjaE5vZGUgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGJhbGxvb25MYXllciApO1xyXG4gICAgdGhpcy5hZGRCb3R0b21QaWNrZXJzKCk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge1NpZGV9XHJcbiAgICB0aGlzLmJhbGxvb25UaHJvd1NpZGUgPSBiYWxsb29uVGhyb3dTaWRlO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtBcnJheS48UGFpbnRCYWxsb29uTm9kZT59XHJcbiAgICB0aGlzLmJhbGxvb25Ob2RlcyA9IFtdO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtBcnJheS48UGFpbnREcmlwTm9kZT59XHJcbiAgICB0aGlzLmRyaXBOb2RlcyA9IFtdO1xyXG5cclxuICAgIC8vIE5ldmVyIGFkZCBiYWxsb29ucy9kcmlwcyBpZiB3ZSBkb24ndCB1c2UgdGhlIHZpc2libGUgYW1vdW50c1xyXG4gICAgaWYgKCB1c2VWaXNpYmxlQW1vdW50cyApIHtcclxuICAgICAgLy8gQWRkIGJhbGxvb24gdmlld3Mgd2hlbiB0aGUgbW9kZWwgaXMgYWRkZWRcclxuICAgICAgc3Bsb3RjaC5iYWxsb29ucy5hZGRJdGVtQWRkZWRMaXN0ZW5lciggYmFsbG9vbiA9PiB7XHJcbiAgICAgICAgLy8gQmFsbG9vbnMgaGF2ZSBhIHJhbmRvbSBzbGlnaHQgb2Zmc2V0IGZvciB0aGUgc3RhcnQvZW5kIChpbiB0aGUgdmlldyBvbmx5KVxyXG4gICAgICAgIGNvbnN0IHJhbmRvbVN0YXJ0ID0gbmV3IFZlY3RvcjIoIGRvdFJhbmRvbS5uZXh0RG91YmxlKCksIGRvdFJhbmRvbS5uZXh0RG91YmxlKCkgKS5taW51c1NjYWxhciggMC41ICkudGltZXNTY2FsYXIoIDE1MCApO1xyXG4gICAgICAgIGNvbnN0IHJhbmRvbUVuZCA9IG5ldyBWZWN0b3IyKCBkb3RSYW5kb20ubmV4dERvdWJsZSgpLCBkb3RSYW5kb20ubmV4dERvdWJsZSgpICkubWludXNTY2FsYXIoIDAuNSApLnRpbWVzU2NhbGFyKCAzMCApO1xyXG4gICAgICAgIGNvbnN0IGJhbGxvb25Ob2RlID0gbmV3IFBhaW50QmFsbG9vbk5vZGUoIGJhbGxvb24sIHBhaW50Q2hvaWNlUHJvcGVydHksIHJhbmRvbVN0YXJ0LCByYW5kb21FbmQgKTtcclxuICAgICAgICBiYWxsb29uTGF5ZXIuYWRkQ2hpbGQoIGJhbGxvb25Ob2RlICk7XHJcbiAgICAgICAgdGhpcy5iYWxsb29uTm9kZXMucHVzaCggYmFsbG9vbk5vZGUgKTtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgLy8gUmVtb3ZlIGJhbGxvb24gdmlld3Mgd2hlbiB0aGUgbW9kZWwgaXMgcmVtb3ZlZFxyXG4gICAgICBzcGxvdGNoLmJhbGxvb25zLmFkZEl0ZW1SZW1vdmVkTGlzdGVuZXIoIGJhbGxvb24gPT4ge1xyXG4gICAgICAgIGZvciAoIGxldCBpID0gdGhpcy5iYWxsb29uTm9kZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0gKSB7XHJcbiAgICAgICAgICBjb25zdCBiYWxsb29uTm9kZSA9IHRoaXMuYmFsbG9vbk5vZGVzWyBpIF07XHJcbiAgICAgICAgICBpZiAoIGJhbGxvb25Ob2RlLnBhaW50QmFsbG9vbiA9PT0gYmFsbG9vbiApIHtcclxuICAgICAgICAgICAgdGhpcy5iYWxsb29uTm9kZXMuc3BsaWNlKCBpLCAxICk7XHJcbiAgICAgICAgICAgIGJhbGxvb25MYXllci5yZW1vdmVDaGlsZCggYmFsbG9vbk5vZGUgKTtcclxuICAgICAgICAgICAgYmFsbG9vbk5vZGUuZGlzcG9zZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG5cclxuICAgICAgLy8gQWRkIGRyaXAgdmlld3Mgd2hlbiB0aGUgbW9kZWwgaXMgYWRkZWRcclxuICAgICAgc3Bsb3RjaC5kcmlwcy5hZGRJdGVtQWRkZWRMaXN0ZW5lciggZHJpcCA9PiB7XHJcbiAgICAgICAgY29uc3QgZHJpcE5vZGUgPSBuZXcgUGFpbnREcmlwTm9kZSggZHJpcCwgcGFpbnRDaG9pY2VQcm9wZXJ0eSApO1xyXG4gICAgICAgIGRyaXBMYXllci5hZGRDaGlsZCggZHJpcE5vZGUgKTtcclxuICAgICAgICB0aGlzLmRyaXBOb2Rlcy5wdXNoKCBkcmlwTm9kZSApO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBSZW1vdmUgZHJpcCB2aWV3cyB3aGVuIHRoZSBtb2RlbCBpcyByZW1vdmVkXHJcbiAgICAgIHNwbG90Y2guZHJpcHMuYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciggZHJpcCA9PiB7XHJcbiAgICAgICAgZm9yICggbGV0IGkgPSB0aGlzLmRyaXBOb2Rlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSApIHtcclxuICAgICAgICAgIGNvbnN0IGRyaXBOb2RlID0gdGhpcy5kcmlwTm9kZXNbIGkgXTtcclxuICAgICAgICAgIGlmICggZHJpcE5vZGUucGFpbnREcmlwID09PSBkcmlwICkge1xyXG4gICAgICAgICAgICB0aGlzLmRyaXBOb2Rlcy5zcGxpY2UoIGksIDEgKTtcclxuICAgICAgICAgICAgZHJpcExheWVyLnJlbW92ZUNoaWxkKCBkcmlwTm9kZSApO1xyXG4gICAgICAgICAgICBkcmlwTm9kZS5kaXNwb3NlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdGVwcyBmb3J3YXJkIGluIHRpbWUuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGR0IC0gSW4gc2Vjb25kc1xyXG4gICAqIEBwYXJhbSB7Qm91bmRzMn0gdmlzaWJsZUJvdW5kc1xyXG4gICAqL1xyXG4gIHN0ZXAoIGR0LCB2aXNpYmxlQm91bmRzICkge1xyXG4gICAgaWYgKCB0aGlzLmJhbGxvb25Ob2Rlcy5sZW5ndGggfHwgdGhpcy5kcmlwTm9kZXMubGVuZ3RoICkge1xyXG4gICAgICB2aXNpYmxlQm91bmRzID0gdGhpcy5wYXJlbnRUb0xvY2FsQm91bmRzKCB2aXNpYmxlQm91bmRzICk7XHJcblxyXG4gICAgICBjb25zdCBiYWxsb29uU2lnbiA9IHRoaXMuYmFsbG9vblRocm93U2lkZSA9PT0gU2lkZS5MRUZUID8gLTEgOiAxO1xyXG4gICAgICBjb25zdCBzdGFydFBvc2l0aW9uID0gc3RhcnRWZWN0b3Iuc2V0WFkoIHZpc2libGVCb3VuZHMuY2VudGVyWCArIDAuNTUgKiBiYWxsb29uU2lnbiAqIHZpc2libGVCb3VuZHMud2lkdGgsXHJcbiAgICAgICAgdmlzaWJsZUJvdW5kcy5ib3R0b20gKiAwLjggKTtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBiYWxsb29uIHBvc2l0aW9uc1xyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmJhbGxvb25Ob2Rlcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICB0aGlzLmJhbGxvb25Ob2Rlc1sgaSBdLnBvc2l0aW9uKCBzdGFydFBvc2l0aW9uLCBTUExPVENIX1BPU0lUSU9OICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBkcmlwIHBvc2l0aW9uc1xyXG4gICAgICBmb3IgKCBsZXQgaSA9IHRoaXMuZHJpcE5vZGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tICkge1xyXG4gICAgICAgIHRoaXMuZHJpcE5vZGVzWyBpIF0ucG9zaXRpb24oIFNQTE9UQ0hfUE9TSVRJT04sIHZpc2libGVCb3VuZHMuYm90dG9tICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbnByb3BvcnRpb25QbGF5Z3JvdW5kLnJlZ2lzdGVyKCAnU3Bsb3RjaENvbnRyb2wnLCBTcGxvdGNoQ29udHJvbCApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgU3Bsb3RjaENvbnRyb2w7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxTQUFTLE1BQU0sb0NBQW9DO0FBQzFELE9BQU9DLE9BQU8sTUFBTSxrQ0FBa0M7QUFDdEQsU0FBU0MsSUFBSSxRQUFRLHNDQUFzQztBQUMzRCxPQUFPQyxvQkFBb0IsTUFBTSxrQ0FBa0M7QUFDbkUsT0FBT0MsV0FBVyxNQUFNLGtDQUFrQztBQUMxRCxPQUFPQyxJQUFJLE1BQU0scUJBQXFCO0FBQ3RDLE9BQU9DLDZCQUE2QixNQUFNLHdDQUF3QztBQUNsRixPQUFPQyxpQkFBaUIsTUFBTSx5QkFBeUI7QUFDdkQsT0FBT0MsZ0JBQWdCLE1BQU0sdUJBQXVCO0FBQ3BELE9BQU9DLGFBQWEsTUFBTSxvQkFBb0I7QUFDOUMsT0FBT0MsV0FBVyxNQUFNLGtCQUFrQjs7QUFFMUM7QUFDQSxNQUFNQyxXQUFXLEdBQUcsSUFBSVYsT0FBTyxDQUFFLENBQUMsRUFBRSxDQUFFLENBQUM7O0FBRXZDO0FBQ0EsTUFBTVcsZ0JBQWdCLEdBQUcsSUFBSVgsT0FBTyxDQUFFLENBQUMsRUFBRUssNkJBQTZCLENBQUNPLGdCQUFpQixDQUFDO0FBRXpGLE1BQU1DLGNBQWMsU0FBU1AsaUJBQWlCLENBQUM7RUFDN0M7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFUSxXQUFXQSxDQUFFQyxPQUFPLEVBQUVDLG1CQUFtQixFQUFFQyxpQkFBaUIsRUFBRUMsZ0JBQWdCLEVBQUVDLE1BQU0sRUFBRztJQUN2RkMsTUFBTSxJQUFJQSxNQUFNLENBQUVELE1BQU8sQ0FBQztJQUUxQixLQUFLLENBQ0hKLE9BQU8sRUFDUFosV0FBVyxDQUFDa0Isc0JBQXNCLENBQUVMLG1CQUFtQixFQUFFWixJQUFJLENBQUNrQixJQUFLLENBQUMsRUFDcEVuQixXQUFXLENBQUNrQixzQkFBc0IsQ0FBRUwsbUJBQW1CLEVBQUVaLElBQUksQ0FBQ21CLEtBQU0sQ0FBQyxFQUNyRUosTUFDRixDQUFDO0lBRUQsTUFBTUssU0FBUyxHQUFHLElBQUl2QixJQUFJLENBQUMsQ0FBQztJQUM1QixNQUFNd0IsWUFBWSxHQUFHLElBQUl4QixJQUFJLENBQUMsQ0FBQzs7SUFFL0I7SUFDQSxJQUFJLENBQUN5QixXQUFXLEdBQUcsSUFBSWpCLFdBQVcsQ0FBRU0sT0FBTyxFQUFFQyxtQkFBbUIsRUFBRTtNQUNoRUMsaUJBQWlCLEVBQUVBLGlCQUFpQjtNQUNwQ1UsV0FBVyxFQUFFaEI7SUFDZixDQUFFLENBQUM7SUFFSCxJQUFJLENBQUNpQixRQUFRLENBQUVKLFNBQVUsQ0FBQztJQUMxQixJQUFJLENBQUNJLFFBQVEsQ0FBRSxJQUFJLENBQUNGLFdBQVksQ0FBQztJQUNqQyxJQUFJLENBQUNFLFFBQVEsQ0FBRUgsWUFBYSxDQUFDO0lBQzdCLElBQUksQ0FBQ0ksZ0JBQWdCLENBQUMsQ0FBQzs7SUFFdkI7SUFDQSxJQUFJLENBQUNYLGdCQUFnQixHQUFHQSxnQkFBZ0I7O0lBRXhDO0lBQ0EsSUFBSSxDQUFDWSxZQUFZLEdBQUcsRUFBRTs7SUFFdEI7SUFDQSxJQUFJLENBQUNDLFNBQVMsR0FBRyxFQUFFOztJQUVuQjtJQUNBLElBQUtkLGlCQUFpQixFQUFHO01BQ3ZCO01BQ0FGLE9BQU8sQ0FBQ2lCLFFBQVEsQ0FBQ0Msb0JBQW9CLENBQUVDLE9BQU8sSUFBSTtRQUNoRDtRQUNBLE1BQU1DLFdBQVcsR0FBRyxJQUFJbkMsT0FBTyxDQUFFRCxTQUFTLENBQUNxQyxVQUFVLENBQUMsQ0FBQyxFQUFFckMsU0FBUyxDQUFDcUMsVUFBVSxDQUFDLENBQUUsQ0FBQyxDQUFDQyxXQUFXLENBQUUsR0FBSSxDQUFDLENBQUNDLFdBQVcsQ0FBRSxHQUFJLENBQUM7UUFDdkgsTUFBTUMsU0FBUyxHQUFHLElBQUl2QyxPQUFPLENBQUVELFNBQVMsQ0FBQ3FDLFVBQVUsQ0FBQyxDQUFDLEVBQUVyQyxTQUFTLENBQUNxQyxVQUFVLENBQUMsQ0FBRSxDQUFDLENBQUNDLFdBQVcsQ0FBRSxHQUFJLENBQUMsQ0FBQ0MsV0FBVyxDQUFFLEVBQUcsQ0FBQztRQUNwSCxNQUFNRSxXQUFXLEdBQUcsSUFBSWpDLGdCQUFnQixDQUFFMkIsT0FBTyxFQUFFbEIsbUJBQW1CLEVBQUVtQixXQUFXLEVBQUVJLFNBQVUsQ0FBQztRQUNoR2QsWUFBWSxDQUFDRyxRQUFRLENBQUVZLFdBQVksQ0FBQztRQUNwQyxJQUFJLENBQUNWLFlBQVksQ0FBQ1csSUFBSSxDQUFFRCxXQUFZLENBQUM7TUFDdkMsQ0FBRSxDQUFDOztNQUVIO01BQ0F6QixPQUFPLENBQUNpQixRQUFRLENBQUNVLHNCQUFzQixDQUFFUixPQUFPLElBQUk7UUFDbEQsS0FBTSxJQUFJUyxDQUFDLEdBQUcsSUFBSSxDQUFDYixZQUFZLENBQUNjLE1BQU0sR0FBRyxDQUFDLEVBQUVELENBQUMsSUFBSSxDQUFDLEVBQUVBLENBQUMsRUFBRSxFQUFHO1VBQ3hELE1BQU1ILFdBQVcsR0FBRyxJQUFJLENBQUNWLFlBQVksQ0FBRWEsQ0FBQyxDQUFFO1VBQzFDLElBQUtILFdBQVcsQ0FBQ0ssWUFBWSxLQUFLWCxPQUFPLEVBQUc7WUFDMUMsSUFBSSxDQUFDSixZQUFZLENBQUNnQixNQUFNLENBQUVILENBQUMsRUFBRSxDQUFFLENBQUM7WUFDaENsQixZQUFZLENBQUNzQixXQUFXLENBQUVQLFdBQVksQ0FBQztZQUN2Q0EsV0FBVyxDQUFDUSxPQUFPLENBQUMsQ0FBQztVQUN2QjtRQUNGO01BQ0YsQ0FBRSxDQUFDOztNQUVIO01BQ0FqQyxPQUFPLENBQUNrQyxLQUFLLENBQUNoQixvQkFBb0IsQ0FBRWlCLElBQUksSUFBSTtRQUMxQyxNQUFNQyxRQUFRLEdBQUcsSUFBSTNDLGFBQWEsQ0FBRTBDLElBQUksRUFBRWxDLG1CQUFvQixDQUFDO1FBQy9EUSxTQUFTLENBQUNJLFFBQVEsQ0FBRXVCLFFBQVMsQ0FBQztRQUM5QixJQUFJLENBQUNwQixTQUFTLENBQUNVLElBQUksQ0FBRVUsUUFBUyxDQUFDO01BQ2pDLENBQUUsQ0FBQzs7TUFFSDtNQUNBcEMsT0FBTyxDQUFDa0MsS0FBSyxDQUFDUCxzQkFBc0IsQ0FBRVEsSUFBSSxJQUFJO1FBQzVDLEtBQU0sSUFBSVAsQ0FBQyxHQUFHLElBQUksQ0FBQ1osU0FBUyxDQUFDYSxNQUFNLEdBQUcsQ0FBQyxFQUFFRCxDQUFDLElBQUksQ0FBQyxFQUFFQSxDQUFDLEVBQUUsRUFBRztVQUNyRCxNQUFNUSxRQUFRLEdBQUcsSUFBSSxDQUFDcEIsU0FBUyxDQUFFWSxDQUFDLENBQUU7VUFDcEMsSUFBS1EsUUFBUSxDQUFDQyxTQUFTLEtBQUtGLElBQUksRUFBRztZQUNqQyxJQUFJLENBQUNuQixTQUFTLENBQUNlLE1BQU0sQ0FBRUgsQ0FBQyxFQUFFLENBQUUsQ0FBQztZQUM3Qm5CLFNBQVMsQ0FBQ3VCLFdBQVcsQ0FBRUksUUFBUyxDQUFDO1lBQ2pDQSxRQUFRLENBQUNILE9BQU8sQ0FBQyxDQUFDO1VBQ3BCO1FBQ0Y7TUFDRixDQUFFLENBQUM7SUFDTDtFQUNGOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VLLElBQUlBLENBQUVDLEVBQUUsRUFBRUMsYUFBYSxFQUFHO0lBQ3hCLElBQUssSUFBSSxDQUFDekIsWUFBWSxDQUFDYyxNQUFNLElBQUksSUFBSSxDQUFDYixTQUFTLENBQUNhLE1BQU0sRUFBRztNQUN2RFcsYUFBYSxHQUFHLElBQUksQ0FBQ0MsbUJBQW1CLENBQUVELGFBQWMsQ0FBQztNQUV6RCxNQUFNRSxXQUFXLEdBQUcsSUFBSSxDQUFDdkMsZ0JBQWdCLEtBQUtkLElBQUksQ0FBQ2tCLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO01BQ2hFLE1BQU1vQyxhQUFhLEdBQUdoRCxXQUFXLENBQUNpRCxLQUFLLENBQUVKLGFBQWEsQ0FBQ0ssT0FBTyxHQUFHLElBQUksR0FBR0gsV0FBVyxHQUFHRixhQUFhLENBQUNNLEtBQUssRUFDdkdOLGFBQWEsQ0FBQ08sTUFBTSxHQUFHLEdBQUksQ0FBQzs7TUFFOUI7TUFDQSxLQUFNLElBQUluQixDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUcsSUFBSSxDQUFDYixZQUFZLENBQUNjLE1BQU0sRUFBRUQsQ0FBQyxFQUFFLEVBQUc7UUFDbkQsSUFBSSxDQUFDYixZQUFZLENBQUVhLENBQUMsQ0FBRSxDQUFDb0IsUUFBUSxDQUFFTCxhQUFhLEVBQUUvQyxnQkFBaUIsQ0FBQztNQUNwRTs7TUFFQTtNQUNBLEtBQU0sSUFBSWdDLENBQUMsR0FBRyxJQUFJLENBQUNaLFNBQVMsQ0FBQ2EsTUFBTSxHQUFHLENBQUMsRUFBRUQsQ0FBQyxJQUFJLENBQUMsRUFBRUEsQ0FBQyxFQUFFLEVBQUc7UUFDckQsSUFBSSxDQUFDWixTQUFTLENBQUVZLENBQUMsQ0FBRSxDQUFDb0IsUUFBUSxDQUFFcEQsZ0JBQWdCLEVBQUU0QyxhQUFhLENBQUNPLE1BQU8sQ0FBQztNQUN4RTtJQUNGO0VBQ0Y7QUFDRjtBQUVBNUQsb0JBQW9CLENBQUM4RCxRQUFRLENBQUUsZ0JBQWdCLEVBQUVuRCxjQUFlLENBQUM7QUFFakUsZUFBZUEsY0FBYyJ9