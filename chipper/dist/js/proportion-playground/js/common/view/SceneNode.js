// Copyright 2016-2022, University of Colorado Boulder

/**
 * Base class for Scene nodes, which includes the reval button for Predict screens.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import merge from '../../../../phet-core/js/merge.js';
import ResetButton from '../../../../scenery-phet/js/buttons/ResetButton.js';
import { AlignGroup, Node } from '../../../../scenery/js/imports.js';
import ABSwitch from '../../../../sun/js/ABSwitch.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import proportionPlayground from '../../proportionPlayground.js';
import ProportionPlaygroundConstants from '../ProportionPlaygroundConstants.js';
import ProportionPlaygroundColors from './ProportionPlaygroundColors.js';
import RevealButton from './RevealButton.js';

// left and right labels for the switches should all share
const switchAlignGroup = new AlignGroup();
class SceneNode extends Node {
  /**
   * @param {Scene} scene - Our scene to display
   * @param {Bounds2} layoutBounds - visible bounds within which the UI must fit
   * @param {Object} config
   */
  constructor(scene, layoutBounds, config) {
    config = merge({
      sceneIcon: null,
      // {Node}, @required - shown in the SceneSelectionControls
      leftControl: null,
      // {SceneRatioControl}, @required
      rightControl: null,
      // {SceneRatioControl}, @required
      leftSwitchIcon: null,
      // {Node}, @required - Left side of the showBoth ABSwitch
      rightSwitchIcon: null,
      // {Node}, @required - Right side of the showBoth ABSwitch
      controlAlign: 'right',
      // 'right' or 'bottom', direction from the pickerContainer
      canCenterControlButton: true,
      // Whether the control button can be centered when both left/right are shown
      tandem: Tandem.REQUIRED
    }, config);
    assert && assert(config.sceneIcon);
    assert && assert(config.leftControl);
    assert && assert(config.rightControl);
    assert && assert(config.leftSwitchIcon);
    assert && assert(config.rightSwitchIcon);
    super({
      tandem: config.tandem
    });

    // @protected
    this.layoutBounds = layoutBounds;
    this.leftControl = config.leftControl;
    this.rightControl = config.rightControl;

    // @private
    this.controlAlign = config.controlAlign;
    this.revealBothOffset = config.revealBothOffset;
    this.canCenterControlButton = config.canCenterControlButton;

    // @public {Scene} - The main model for this scene
    this.scene = scene;

    // @public {Node} - Will be displayed in the scene selection radio group
    this.sceneIcon = config.sceneIcon;
    this.mutate({
      children: [this.rightControl, this.leftControl]
    });
    this.leftSwitchIcon = switchAlignGroup.createBox(config.leftSwitchIcon, {
      xAlign: 'right'
    });
    this.rightSwitchIcon = switchAlignGroup.createBox(config.rightSwitchIcon, {
      xAlign: 'left'
    });

    // @private {Node} - A button that will either handle revealing the scene's visual representation, or will refresh the scene.
    this.controlButton = null;

    // For predict mode, add a reveal button that show the representations
    if (scene.predictMode) {
      this.controlButton = new RevealButton(scene.revealProperty, {
        tandem: config.tandem.createTandem('revealButton')
      });
    }
    // Otherwise, have a 'Refresh' button, see https://github.com/phetsims/proportion-playground/issues/55
    else {
      this.controlButton = new ResetButton({
        listener: () => {
          scene.ratios.forEach(sceneRatio => {
            sceneRatio.reset();
          });
        },
        baseColor: ProportionPlaygroundColors.refreshBackgroundProperty,
        // refreshButton
        tandem: config.tandem.createTandem('resetButton')
      });
    }
    this.addChild(this.controlButton);
  }

  /**
   * Steps forward in time.
   * @public
   *
   * @param {number} dt - In seconds
   * @param {Bounds2} visibleBounds
   */
  step(dt, visibleBounds) {
    this.leftControl.step && this.leftControl.step(dt, visibleBounds);
    this.rightControl.step && this.rightControl.step(dt, visibleBounds);
  }

  /**
   * Adds the "showBoth" ABSwitch.
   * @public
   *
   * We have to do this later, since we need all of the scenes' switchIcons to be created/sized first. When ABSwitch
   * can handle resizing content, we can inline this.
   */
  addShowBothSwitch() {
    this.addChild(new ABSwitch(this.scene.showBothProperty, false, this.leftSwitchIcon, true, this.rightSwitchIcon, {
      centerBottom: this.layoutBounds.centerBottom.plusXY(0, -15),
      tandem: this.tandem.createTandem('showBothSwitch')
    }));
  }

  /**
   * Moves the reveal button to the desired position.
   * @protected
   */
  updateControlButton() {
    // Only does something if we have a button
    if (!this.controlButton) {
      return;
    }
    if (this.controlAlign === 'right') {
      if (this.scene.showBothProperty.value) {
        if (this.canCenterControlButton) {
          this.controlButton.centerX = this.layoutBounds.centerX;
        } else {
          // 10 amount of space for the larger button
          this.controlButton.centerX = this.layoutBounds.right - ProportionPlaygroundConstants.BUTTON_RIGHT_CENTER_OFFSET;
        }
        this.controlButton.centerY = this.layoutBounds.bottom - 128;
      } else {
        const pickerContainerBounds = this.leftControl.localToParentBounds(this.leftControl.pickerContainer.bounds);
        this.controlButton.centerX = pickerContainerBounds.right + 62; // 30 amount of space for the larger button
        this.controlButton.centerY = this.layoutBounds.bottom - 128;
      }
    } else {
      this.controlButton.centerX = this.layoutBounds.centerX;
      this.controlButton.centerY = this.layoutBounds.bottom - 100;
    }
  }
}
proportionPlayground.register('SceneNode', SceneNode);
export default SceneNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtZXJnZSIsIlJlc2V0QnV0dG9uIiwiQWxpZ25Hcm91cCIsIk5vZGUiLCJBQlN3aXRjaCIsIlRhbmRlbSIsInByb3BvcnRpb25QbGF5Z3JvdW5kIiwiUHJvcG9ydGlvblBsYXlncm91bmRDb25zdGFudHMiLCJQcm9wb3J0aW9uUGxheWdyb3VuZENvbG9ycyIsIlJldmVhbEJ1dHRvbiIsInN3aXRjaEFsaWduR3JvdXAiLCJTY2VuZU5vZGUiLCJjb25zdHJ1Y3RvciIsInNjZW5lIiwibGF5b3V0Qm91bmRzIiwiY29uZmlnIiwic2NlbmVJY29uIiwibGVmdENvbnRyb2wiLCJyaWdodENvbnRyb2wiLCJsZWZ0U3dpdGNoSWNvbiIsInJpZ2h0U3dpdGNoSWNvbiIsImNvbnRyb2xBbGlnbiIsImNhbkNlbnRlckNvbnRyb2xCdXR0b24iLCJ0YW5kZW0iLCJSRVFVSVJFRCIsImFzc2VydCIsInJldmVhbEJvdGhPZmZzZXQiLCJtdXRhdGUiLCJjaGlsZHJlbiIsImNyZWF0ZUJveCIsInhBbGlnbiIsImNvbnRyb2xCdXR0b24iLCJwcmVkaWN0TW9kZSIsInJldmVhbFByb3BlcnR5IiwiY3JlYXRlVGFuZGVtIiwibGlzdGVuZXIiLCJyYXRpb3MiLCJmb3JFYWNoIiwic2NlbmVSYXRpbyIsInJlc2V0IiwiYmFzZUNvbG9yIiwicmVmcmVzaEJhY2tncm91bmRQcm9wZXJ0eSIsImFkZENoaWxkIiwic3RlcCIsImR0IiwidmlzaWJsZUJvdW5kcyIsImFkZFNob3dCb3RoU3dpdGNoIiwic2hvd0JvdGhQcm9wZXJ0eSIsImNlbnRlckJvdHRvbSIsInBsdXNYWSIsInVwZGF0ZUNvbnRyb2xCdXR0b24iLCJ2YWx1ZSIsImNlbnRlclgiLCJyaWdodCIsIkJVVFRPTl9SSUdIVF9DRU5URVJfT0ZGU0VUIiwiY2VudGVyWSIsImJvdHRvbSIsInBpY2tlckNvbnRhaW5lckJvdW5kcyIsImxvY2FsVG9QYXJlbnRCb3VuZHMiLCJwaWNrZXJDb250YWluZXIiLCJib3VuZHMiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlNjZW5lTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNi0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBCYXNlIGNsYXNzIGZvciBTY2VuZSBub2Rlcywgd2hpY2ggaW5jbHVkZXMgdGhlIHJldmFsIGJ1dHRvbiBmb3IgUHJlZGljdCBzY3JlZW5zLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgUmVzZXRCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL2J1dHRvbnMvUmVzZXRCdXR0b24uanMnO1xyXG5pbXBvcnQgeyBBbGlnbkdyb3VwLCBOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEFCU3dpdGNoIGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9BQlN3aXRjaC5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBwcm9wb3J0aW9uUGxheWdyb3VuZCBmcm9tICcuLi8uLi9wcm9wb3J0aW9uUGxheWdyb3VuZC5qcyc7XHJcbmltcG9ydCBQcm9wb3J0aW9uUGxheWdyb3VuZENvbnN0YW50cyBmcm9tICcuLi9Qcm9wb3J0aW9uUGxheWdyb3VuZENvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBQcm9wb3J0aW9uUGxheWdyb3VuZENvbG9ycyBmcm9tICcuL1Byb3BvcnRpb25QbGF5Z3JvdW5kQ29sb3JzLmpzJztcclxuaW1wb3J0IFJldmVhbEJ1dHRvbiBmcm9tICcuL1JldmVhbEJ1dHRvbi5qcyc7XHJcblxyXG4vLyBsZWZ0IGFuZCByaWdodCBsYWJlbHMgZm9yIHRoZSBzd2l0Y2hlcyBzaG91bGQgYWxsIHNoYXJlXHJcbmNvbnN0IHN3aXRjaEFsaWduR3JvdXAgPSBuZXcgQWxpZ25Hcm91cCgpO1xyXG5cclxuY2xhc3MgU2NlbmVOb2RlIGV4dGVuZHMgTm9kZSB7XHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtTY2VuZX0gc2NlbmUgLSBPdXIgc2NlbmUgdG8gZGlzcGxheVxyXG4gICAqIEBwYXJhbSB7Qm91bmRzMn0gbGF5b3V0Qm91bmRzIC0gdmlzaWJsZSBib3VuZHMgd2l0aGluIHdoaWNoIHRoZSBVSSBtdXN0IGZpdFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWdcclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvciggc2NlbmUsIGxheW91dEJvdW5kcywgY29uZmlnICkge1xyXG4gICAgY29uZmlnID0gbWVyZ2UoIHtcclxuICAgICAgc2NlbmVJY29uOiBudWxsLCAvLyB7Tm9kZX0sIEByZXF1aXJlZCAtIHNob3duIGluIHRoZSBTY2VuZVNlbGVjdGlvbkNvbnRyb2xzXHJcbiAgICAgIGxlZnRDb250cm9sOiBudWxsLCAvLyB7U2NlbmVSYXRpb0NvbnRyb2x9LCBAcmVxdWlyZWRcclxuICAgICAgcmlnaHRDb250cm9sOiBudWxsLCAvLyB7U2NlbmVSYXRpb0NvbnRyb2x9LCBAcmVxdWlyZWRcclxuICAgICAgbGVmdFN3aXRjaEljb246IG51bGwsIC8vIHtOb2RlfSwgQHJlcXVpcmVkIC0gTGVmdCBzaWRlIG9mIHRoZSBzaG93Qm90aCBBQlN3aXRjaFxyXG4gICAgICByaWdodFN3aXRjaEljb246IG51bGwsIC8vIHtOb2RlfSwgQHJlcXVpcmVkIC0gUmlnaHQgc2lkZSBvZiB0aGUgc2hvd0JvdGggQUJTd2l0Y2hcclxuICAgICAgY29udHJvbEFsaWduOiAncmlnaHQnLCAvLyAncmlnaHQnIG9yICdib3R0b20nLCBkaXJlY3Rpb24gZnJvbSB0aGUgcGlja2VyQ29udGFpbmVyXHJcbiAgICAgIGNhbkNlbnRlckNvbnRyb2xCdXR0b246IHRydWUsIC8vIFdoZXRoZXIgdGhlIGNvbnRyb2wgYnV0dG9uIGNhbiBiZSBjZW50ZXJlZCB3aGVuIGJvdGggbGVmdC9yaWdodCBhcmUgc2hvd25cclxuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRURcclxuICAgIH0sIGNvbmZpZyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbmZpZy5zY2VuZUljb24gKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbmZpZy5sZWZ0Q29udHJvbCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY29uZmlnLnJpZ2h0Q29udHJvbCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY29uZmlnLmxlZnRTd2l0Y2hJY29uICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjb25maWcucmlnaHRTd2l0Y2hJY29uICk7XHJcblxyXG4gICAgc3VwZXIoIHtcclxuICAgICAgdGFuZGVtOiBjb25maWcudGFuZGVtXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHByb3RlY3RlZFxyXG4gICAgdGhpcy5sYXlvdXRCb3VuZHMgPSBsYXlvdXRCb3VuZHM7XHJcbiAgICB0aGlzLmxlZnRDb250cm9sID0gY29uZmlnLmxlZnRDb250cm9sO1xyXG4gICAgdGhpcy5yaWdodENvbnRyb2wgPSBjb25maWcucmlnaHRDb250cm9sO1xyXG5cclxuICAgIC8vIEBwcml2YXRlXHJcbiAgICB0aGlzLmNvbnRyb2xBbGlnbiA9IGNvbmZpZy5jb250cm9sQWxpZ247XHJcbiAgICB0aGlzLnJldmVhbEJvdGhPZmZzZXQgPSBjb25maWcucmV2ZWFsQm90aE9mZnNldDtcclxuICAgIHRoaXMuY2FuQ2VudGVyQ29udHJvbEJ1dHRvbiA9IGNvbmZpZy5jYW5DZW50ZXJDb250cm9sQnV0dG9uO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge1NjZW5lfSAtIFRoZSBtYWluIG1vZGVsIGZvciB0aGlzIHNjZW5lXHJcbiAgICB0aGlzLnNjZW5lID0gc2NlbmU7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7Tm9kZX0gLSBXaWxsIGJlIGRpc3BsYXllZCBpbiB0aGUgc2NlbmUgc2VsZWN0aW9uIHJhZGlvIGdyb3VwXHJcbiAgICB0aGlzLnNjZW5lSWNvbiA9IGNvbmZpZy5zY2VuZUljb247XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIHtcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICB0aGlzLnJpZ2h0Q29udHJvbCxcclxuICAgICAgICB0aGlzLmxlZnRDb250cm9sXHJcbiAgICAgIF1cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmxlZnRTd2l0Y2hJY29uID0gc3dpdGNoQWxpZ25Hcm91cC5jcmVhdGVCb3goIGNvbmZpZy5sZWZ0U3dpdGNoSWNvbiwgeyB4QWxpZ246ICdyaWdodCcgfSApO1xyXG4gICAgdGhpcy5yaWdodFN3aXRjaEljb24gPSBzd2l0Y2hBbGlnbkdyb3VwLmNyZWF0ZUJveCggY29uZmlnLnJpZ2h0U3dpdGNoSWNvbiwgeyB4QWxpZ246ICdsZWZ0JyB9ICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge05vZGV9IC0gQSBidXR0b24gdGhhdCB3aWxsIGVpdGhlciBoYW5kbGUgcmV2ZWFsaW5nIHRoZSBzY2VuZSdzIHZpc3VhbCByZXByZXNlbnRhdGlvbiwgb3Igd2lsbCByZWZyZXNoIHRoZSBzY2VuZS5cclxuICAgIHRoaXMuY29udHJvbEJ1dHRvbiA9IG51bGw7XHJcblxyXG4gICAgLy8gRm9yIHByZWRpY3QgbW9kZSwgYWRkIGEgcmV2ZWFsIGJ1dHRvbiB0aGF0IHNob3cgdGhlIHJlcHJlc2VudGF0aW9uc1xyXG4gICAgaWYgKCBzY2VuZS5wcmVkaWN0TW9kZSApIHtcclxuICAgICAgdGhpcy5jb250cm9sQnV0dG9uID0gbmV3IFJldmVhbEJ1dHRvbiggc2NlbmUucmV2ZWFsUHJvcGVydHksIHtcclxuICAgICAgICB0YW5kZW06IGNvbmZpZy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncmV2ZWFsQnV0dG9uJyApXHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuICAgIC8vIE90aGVyd2lzZSwgaGF2ZSBhICdSZWZyZXNoJyBidXR0b24sIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcHJvcG9ydGlvbi1wbGF5Z3JvdW5kL2lzc3Vlcy81NVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMuY29udHJvbEJ1dHRvbiA9IG5ldyBSZXNldEJ1dHRvbigge1xyXG4gICAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgICBzY2VuZS5yYXRpb3MuZm9yRWFjaCggc2NlbmVSYXRpbyA9PiB7XHJcbiAgICAgICAgICAgIHNjZW5lUmF0aW8ucmVzZXQoKTtcclxuICAgICAgICAgIH0gKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGJhc2VDb2xvcjogUHJvcG9ydGlvblBsYXlncm91bmRDb2xvcnMucmVmcmVzaEJhY2tncm91bmRQcm9wZXJ0eSxcclxuXHJcbiAgICAgICAgLy8gcmVmcmVzaEJ1dHRvblxyXG4gICAgICAgIHRhbmRlbTogY29uZmlnLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdyZXNldEJ1dHRvbicgKVxyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLmNvbnRyb2xCdXR0b24gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0ZXBzIGZvcndhcmQgaW4gdGltZS5cclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHQgLSBJbiBzZWNvbmRzXHJcbiAgICogQHBhcmFtIHtCb3VuZHMyfSB2aXNpYmxlQm91bmRzXHJcbiAgICovXHJcbiAgc3RlcCggZHQsIHZpc2libGVCb3VuZHMgKSB7XHJcbiAgICB0aGlzLmxlZnRDb250cm9sLnN0ZXAgJiYgdGhpcy5sZWZ0Q29udHJvbC5zdGVwKCBkdCwgdmlzaWJsZUJvdW5kcyApO1xyXG4gICAgdGhpcy5yaWdodENvbnRyb2wuc3RlcCAmJiB0aGlzLnJpZ2h0Q29udHJvbC5zdGVwKCBkdCwgdmlzaWJsZUJvdW5kcyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWRkcyB0aGUgXCJzaG93Qm90aFwiIEFCU3dpdGNoLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIFdlIGhhdmUgdG8gZG8gdGhpcyBsYXRlciwgc2luY2Ugd2UgbmVlZCBhbGwgb2YgdGhlIHNjZW5lcycgc3dpdGNoSWNvbnMgdG8gYmUgY3JlYXRlZC9zaXplZCBmaXJzdC4gV2hlbiBBQlN3aXRjaFxyXG4gICAqIGNhbiBoYW5kbGUgcmVzaXppbmcgY29udGVudCwgd2UgY2FuIGlubGluZSB0aGlzLlxyXG4gICAqL1xyXG4gIGFkZFNob3dCb3RoU3dpdGNoKCkge1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbmV3IEFCU3dpdGNoKCB0aGlzLnNjZW5lLnNob3dCb3RoUHJvcGVydHksXHJcbiAgICAgIGZhbHNlLCB0aGlzLmxlZnRTd2l0Y2hJY29uLFxyXG4gICAgICB0cnVlLCB0aGlzLnJpZ2h0U3dpdGNoSWNvbiwge1xyXG4gICAgICAgIGNlbnRlckJvdHRvbTogdGhpcy5sYXlvdXRCb3VuZHMuY2VudGVyQm90dG9tLnBsdXNYWSggMCwgLTE1ICksXHJcbiAgICAgICAgdGFuZGVtOiB0aGlzLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdzaG93Qm90aFN3aXRjaCcgKVxyXG4gICAgICB9ICkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1vdmVzIHRoZSByZXZlYWwgYnV0dG9uIHRvIHRoZSBkZXNpcmVkIHBvc2l0aW9uLlxyXG4gICAqIEBwcm90ZWN0ZWRcclxuICAgKi9cclxuICB1cGRhdGVDb250cm9sQnV0dG9uKCkge1xyXG4gICAgLy8gT25seSBkb2VzIHNvbWV0aGluZyBpZiB3ZSBoYXZlIGEgYnV0dG9uXHJcbiAgICBpZiAoICF0aGlzLmNvbnRyb2xCdXR0b24gKSB7IHJldHVybjsgfVxyXG5cclxuICAgIGlmICggdGhpcy5jb250cm9sQWxpZ24gPT09ICdyaWdodCcgKSB7XHJcbiAgICAgIGlmICggdGhpcy5zY2VuZS5zaG93Qm90aFByb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICAgIGlmICggdGhpcy5jYW5DZW50ZXJDb250cm9sQnV0dG9uICkge1xyXG4gICAgICAgICAgdGhpcy5jb250cm9sQnV0dG9uLmNlbnRlclggPSB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJYO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIC8vIDEwIGFtb3VudCBvZiBzcGFjZSBmb3IgdGhlIGxhcmdlciBidXR0b25cclxuICAgICAgICAgIHRoaXMuY29udHJvbEJ1dHRvbi5jZW50ZXJYID0gdGhpcy5sYXlvdXRCb3VuZHMucmlnaHQgLSBQcm9wb3J0aW9uUGxheWdyb3VuZENvbnN0YW50cy5CVVRUT05fUklHSFRfQ0VOVEVSX09GRlNFVDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb250cm9sQnV0dG9uLmNlbnRlclkgPSB0aGlzLmxheW91dEJvdW5kcy5ib3R0b20gLSAxMjg7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcGlja2VyQ29udGFpbmVyQm91bmRzID0gdGhpcy5sZWZ0Q29udHJvbC5sb2NhbFRvUGFyZW50Qm91bmRzKCB0aGlzLmxlZnRDb250cm9sLnBpY2tlckNvbnRhaW5lci5ib3VuZHMgKTtcclxuICAgICAgICB0aGlzLmNvbnRyb2xCdXR0b24uY2VudGVyWCA9IHBpY2tlckNvbnRhaW5lckJvdW5kcy5yaWdodCArIDYyOyAvLyAzMCBhbW91bnQgb2Ygc3BhY2UgZm9yIHRoZSBsYXJnZXIgYnV0dG9uXHJcbiAgICAgICAgdGhpcy5jb250cm9sQnV0dG9uLmNlbnRlclkgPSB0aGlzLmxheW91dEJvdW5kcy5ib3R0b20gLSAxMjg7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLmNvbnRyb2xCdXR0b24uY2VudGVyWCA9IHRoaXMubGF5b3V0Qm91bmRzLmNlbnRlclg7XHJcbiAgICAgIHRoaXMuY29udHJvbEJ1dHRvbi5jZW50ZXJZID0gdGhpcy5sYXlvdXRCb3VuZHMuYm90dG9tIC0gMTAwO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxucHJvcG9ydGlvblBsYXlncm91bmQucmVnaXN0ZXIoICdTY2VuZU5vZGUnLCBTY2VuZU5vZGUgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFNjZW5lTm9kZTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsV0FBVyxNQUFNLG9EQUFvRDtBQUM1RSxTQUFTQyxVQUFVLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDcEUsT0FBT0MsUUFBUSxNQUFNLGdDQUFnQztBQUNyRCxPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBQ3BELE9BQU9DLG9CQUFvQixNQUFNLCtCQUErQjtBQUNoRSxPQUFPQyw2QkFBNkIsTUFBTSxxQ0FBcUM7QUFDL0UsT0FBT0MsMEJBQTBCLE1BQU0saUNBQWlDO0FBQ3hFLE9BQU9DLFlBQVksTUFBTSxtQkFBbUI7O0FBRTVDO0FBQ0EsTUFBTUMsZ0JBQWdCLEdBQUcsSUFBSVIsVUFBVSxDQUFDLENBQUM7QUFFekMsTUFBTVMsU0FBUyxTQUFTUixJQUFJLENBQUM7RUFDM0I7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNFUyxXQUFXQSxDQUFFQyxLQUFLLEVBQUVDLFlBQVksRUFBRUMsTUFBTSxFQUFHO0lBQ3pDQSxNQUFNLEdBQUdmLEtBQUssQ0FBRTtNQUNkZ0IsU0FBUyxFQUFFLElBQUk7TUFBRTtNQUNqQkMsV0FBVyxFQUFFLElBQUk7TUFBRTtNQUNuQkMsWUFBWSxFQUFFLElBQUk7TUFBRTtNQUNwQkMsY0FBYyxFQUFFLElBQUk7TUFBRTtNQUN0QkMsZUFBZSxFQUFFLElBQUk7TUFBRTtNQUN2QkMsWUFBWSxFQUFFLE9BQU87TUFBRTtNQUN2QkMsc0JBQXNCLEVBQUUsSUFBSTtNQUFFO01BQzlCQyxNQUFNLEVBQUVsQixN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