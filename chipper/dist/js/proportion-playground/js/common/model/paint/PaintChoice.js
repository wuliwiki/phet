// Copyright 2016-2023, University of Colorado Boulder

/**
 * Represents two colors that can be blended together with a different ratio. Provides parametric (0-1) computation of
 * colors in different blends.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import DerivedProperty from '../../../../../axon/js/DerivedProperty.js';
import { Color } from '../../../../../scenery/js/imports.js';
import PhetioObject from '../../../../../tandem/js/PhetioObject.js';
import Tandem from '../../../../../tandem/js/Tandem.js';
import IOType from '../../../../../tandem/js/types/IOType.js';
import StringIO from '../../../../../tandem/js/types/StringIO.js';
import proportionPlayground from '../../../proportionPlayground.js';
import ProportionPlaygroundColors from '../../view/ProportionPlaygroundColors.js';
import Side from '../Side.js';

/**
 * Models mixing of watercolor paints with the weighted geometric mean, then with an applied gamma correction.
 * @private
 *
 * @param {number} x - First color component, from 0 to 255
 * @param {number} y - Second color component, from 0 to 255
 * @param {number} ratio - 0 means all first color, 1 means all second color
 * @returns {number} - The final color component
 */
function gammaSubtract(x, y, ratio) {
  const gamma = 2.2; // Could adjust in the future

  const linearX = Math.pow(x / 255, gamma);
  const linearY = Math.pow(y / 255, gamma);

  // Use the weighted geometric mean for subtractive color modeling.
  // See http://www.handprint.com/HP/WCL/color3.html#mixprofile and http://scottburns.us/subtractive-color-mixture/
  // We don't use a full spectra, but do the same thing component-wise.
  return 255 * Math.pow(Math.pow(linearX, 1 - ratio) * Math.pow(linearY, ratio), 1 / gamma);
}

/**
 * Mixes two colors with subtractive color modeling. See gammaSubtract for more information.
 * @private
 *
 * @param {Color} a - First color
 * @param {Color} b - Second color
 * @param {number} ratio - 0 means all first color, 1 means all second color
 * @returns {Color}
 */
function blendSubtractiveRGBGamma(a, b, ratio) {
  return new Color(gammaSubtract(a.red, b.red, ratio), gammaSubtract(a.green, b.green, ratio), gammaSubtract(a.blue, b.blue, ratio));
}

/**
 * Power-based blending function, see https://github.com/phetsims/proportion-playground/issues/45.
 * @private
 *
 * @param {number} ratio - From 0 to 1.
 * @param {number} power - The power level to apply (<1 compresses, >1 stretches, =1 has no change)
 * @returns {number}
 */
function stretchRatio(ratio, power) {
  if (ratio <= 0.5) {
    return 0.5 * Math.pow(2 * ratio, power);
  } else {
    return 1 - 0.5 * Math.pow(2 * (1 - ratio), power);
  }
}
class PaintChoice extends PhetioObject {
  /**
   * @private
   *
   * @param {Property.<Color>} leftColorProperty
   * @param {Property.<Color>} rightColorProperty
   */
  constructor(leftColorProperty, rightColorProperty, tandem) {
    super({
      tandem: tandem,
      phetioType: PaintChoiceIO
    });

    // @public
    this.leftColorProperty = leftColorProperty;
    this.rightColorProperty = rightColorProperty;
  }

  /**
   * @public
   *
   * @param {number} blendAmount - value between 0 (left color) and 1 (right color)
   * @returns {Color}
   */
  getBlendedColor(blendAmount) {
    assert && assert(blendAmount >= 0 && blendAmount <= 1, 'Blend amount was out of bounds.');
    return blendSubtractiveRGBGamma(this.leftColorProperty.value, this.rightColorProperty.value, stretchRatio(blendAmount, 2.0));
  }

  /**
   * Returns either the left or right color property, depending on what side is requested.
   * @public
   *
   * @param {Side} side
   * @returns {Property.<Color>}
   */
  getColorProperty(side) {
    assert && assert(Side.includes(side));
    return side === Side.LEFT ? this.leftColorProperty : this.rightColorProperty;
  }

  /**
   * @public
   *
   * @param {Property.<PaintChoice>} paintChoiceProperty
   * @param {Side} side
   * @returns {Property.<Color>}
   */
  static getActiveColorProperty(paintChoiceProperty, side) {
    const dependencies = [paintChoiceProperty].concat(PaintChoice.CHOICES.map(paintChoice => paintChoice.getColorProperty(side)));
    return new DerivedProperty(_.uniq(dependencies), () => paintChoiceProperty.value.getColorProperty(side).value);
  }
}
const PaintChoiceIO = new IOType('PaintChoiceIO', {
  valueType: PaintChoice,
  documentation: 'A combination of a left and right effective color',
  toStateObject(paintChoice) {
    return {
      _choice: paintChoice === PaintChoice.BLUE_YELLOW ? 'BLUE_YELLOW' : paintChoice === PaintChoice.RED_YELLOW ? 'RED_YELLOW' : 'BLACK_WHITE'
    };
  },
  stateSchema: {
    _choice: StringIO
  },
  fromStateObject(stateObject) {
    return PaintChoice[stateObject._choice];
  }
});
PaintChoice.PaintChoiceIO = PaintChoiceIO;
proportionPlayground.register('PaintChoice', PaintChoice);
PaintChoice.BLUE = ProportionPlaygroundColors.paintBlueProperty;
PaintChoice.YELLOW = ProportionPlaygroundColors.paintYellowProperty;
PaintChoice.RED = ProportionPlaygroundColors.paintRedProperty;
PaintChoice.BLACK = ProportionPlaygroundColors.paintBlackProperty;
PaintChoice.WHITE = ProportionPlaygroundColors.paintWhiteProperty;

// Assign unique IDs to the individual paints, so that they can be differentiated for balloon handling.
PaintChoice.BLUE.paintId = 1;
PaintChoice.YELLOW.paintId = 2;
PaintChoice.RED.paintId = 3;
PaintChoice.BLACK.paintId = 4;
PaintChoice.WHITE.paintId = 5;
PaintChoice.BLUE_YELLOW = new PaintChoice(PaintChoice.BLUE, PaintChoice.YELLOW, Tandem.GLOBAL_MODEL.createTandem('blueYellowPaintChoice'));
PaintChoice.RED_YELLOW = new PaintChoice(PaintChoice.RED, PaintChoice.YELLOW, Tandem.GLOBAL_MODEL.createTandem('redYellowPaintChoice'));
PaintChoice.BLACK_WHITE = new PaintChoice(PaintChoice.BLACK, PaintChoice.WHITE, Tandem.GLOBAL_MODEL.createTandem('blackWhitePaintChoice'));
PaintChoice.CHOICES = [PaintChoice.BLUE_YELLOW, PaintChoice.RED_YELLOW, PaintChoice.BLACK_WHITE];
PaintChoice.COLORS = [PaintChoice.BLUE, PaintChoice.YELLOW, PaintChoice.RED, PaintChoice.BLACK, PaintChoice.WHITE];
export default PaintChoice;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJDb2xvciIsIlBoZXRpb09iamVjdCIsIlRhbmRlbSIsIklPVHlwZSIsIlN0cmluZ0lPIiwicHJvcG9ydGlvblBsYXlncm91bmQiLCJQcm9wb3J0aW9uUGxheWdyb3VuZENvbG9ycyIsIlNpZGUiLCJnYW1tYVN1YnRyYWN0IiwieCIsInkiLCJyYXRpbyIsImdhbW1hIiwibGluZWFyWCIsIk1hdGgiLCJwb3ciLCJsaW5lYXJZIiwiYmxlbmRTdWJ0cmFjdGl2ZVJHQkdhbW1hIiwiYSIsImIiLCJyZWQiLCJncmVlbiIsImJsdWUiLCJzdHJldGNoUmF0aW8iLCJwb3dlciIsIlBhaW50Q2hvaWNlIiwiY29uc3RydWN0b3IiLCJsZWZ0Q29sb3JQcm9wZXJ0eSIsInJpZ2h0Q29sb3JQcm9wZXJ0eSIsInRhbmRlbSIsInBoZXRpb1R5cGUiLCJQYWludENob2ljZUlPIiwiZ2V0QmxlbmRlZENvbG9yIiwiYmxlbmRBbW91bnQiLCJhc3NlcnQiLCJ2YWx1ZSIsImdldENvbG9yUHJvcGVydHkiLCJzaWRlIiwiaW5jbHVkZXMiLCJMRUZUIiwiZ2V0QWN0aXZlQ29sb3JQcm9wZXJ0eSIsInBhaW50Q2hvaWNlUHJvcGVydHkiLCJkZXBlbmRlbmNpZXMiLCJjb25jYXQiLCJDSE9JQ0VTIiwibWFwIiwicGFpbnRDaG9pY2UiLCJfIiwidW5pcSIsInZhbHVlVHlwZSIsImRvY3VtZW50YXRpb24iLCJ0b1N0YXRlT2JqZWN0IiwiX2Nob2ljZSIsIkJMVUVfWUVMTE9XIiwiUkVEX1lFTExPVyIsInN0YXRlU2NoZW1hIiwiZnJvbVN0YXRlT2JqZWN0Iiwic3RhdGVPYmplY3QiLCJyZWdpc3RlciIsIkJMVUUiLCJwYWludEJsdWVQcm9wZXJ0eSIsIllFTExPVyIsInBhaW50WWVsbG93UHJvcGVydHkiLCJSRUQiLCJwYWludFJlZFByb3BlcnR5IiwiQkxBQ0siLCJwYWludEJsYWNrUHJvcGVydHkiLCJXSElURSIsInBhaW50V2hpdGVQcm9wZXJ0eSIsInBhaW50SWQiLCJHTE9CQUxfTU9ERUwiLCJjcmVhdGVUYW5kZW0iLCJCTEFDS19XSElURSIsIkNPTE9SUyJdLCJzb3VyY2VzIjpbIlBhaW50Q2hvaWNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFJlcHJlc2VudHMgdHdvIGNvbG9ycyB0aGF0IGNhbiBiZSBibGVuZGVkIHRvZ2V0aGVyIHdpdGggYSBkaWZmZXJlbnQgcmF0aW8uIFByb3ZpZGVzIHBhcmFtZXRyaWMgKDAtMSkgY29tcHV0YXRpb24gb2ZcclxuICogY29sb3JzIGluIGRpZmZlcmVudCBibGVuZHMuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgQ29sb3IgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUGhldGlvT2JqZWN0IGZyb20gJy4uLy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9QaGV0aW9PYmplY3QuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgSU9UeXBlIGZyb20gJy4uLy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9JT1R5cGUuanMnO1xyXG5pbXBvcnQgU3RyaW5nSU8gZnJvbSAnLi4vLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL1N0cmluZ0lPLmpzJztcclxuaW1wb3J0IHByb3BvcnRpb25QbGF5Z3JvdW5kIGZyb20gJy4uLy4uLy4uL3Byb3BvcnRpb25QbGF5Z3JvdW5kLmpzJztcclxuaW1wb3J0IFByb3BvcnRpb25QbGF5Z3JvdW5kQ29sb3JzIGZyb20gJy4uLy4uL3ZpZXcvUHJvcG9ydGlvblBsYXlncm91bmRDb2xvcnMuanMnO1xyXG5pbXBvcnQgU2lkZSBmcm9tICcuLi9TaWRlLmpzJztcclxuXHJcbi8qKlxyXG4gKiBNb2RlbHMgbWl4aW5nIG9mIHdhdGVyY29sb3IgcGFpbnRzIHdpdGggdGhlIHdlaWdodGVkIGdlb21ldHJpYyBtZWFuLCB0aGVuIHdpdGggYW4gYXBwbGllZCBnYW1tYSBjb3JyZWN0aW9uLlxyXG4gKiBAcHJpdmF0ZVxyXG4gKlxyXG4gKiBAcGFyYW0ge251bWJlcn0geCAtIEZpcnN0IGNvbG9yIGNvbXBvbmVudCwgZnJvbSAwIHRvIDI1NVxyXG4gKiBAcGFyYW0ge251bWJlcn0geSAtIFNlY29uZCBjb2xvciBjb21wb25lbnQsIGZyb20gMCB0byAyNTVcclxuICogQHBhcmFtIHtudW1iZXJ9IHJhdGlvIC0gMCBtZWFucyBhbGwgZmlyc3QgY29sb3IsIDEgbWVhbnMgYWxsIHNlY29uZCBjb2xvclxyXG4gKiBAcmV0dXJucyB7bnVtYmVyfSAtIFRoZSBmaW5hbCBjb2xvciBjb21wb25lbnRcclxuICovXHJcbmZ1bmN0aW9uIGdhbW1hU3VidHJhY3QoIHgsIHksIHJhdGlvICkge1xyXG4gIGNvbnN0IGdhbW1hID0gMi4yOyAvLyBDb3VsZCBhZGp1c3QgaW4gdGhlIGZ1dHVyZVxyXG5cclxuICBjb25zdCBsaW5lYXJYID0gTWF0aC5wb3coIHggLyAyNTUsIGdhbW1hICk7XHJcbiAgY29uc3QgbGluZWFyWSA9IE1hdGgucG93KCB5IC8gMjU1LCBnYW1tYSApO1xyXG5cclxuICAvLyBVc2UgdGhlIHdlaWdodGVkIGdlb21ldHJpYyBtZWFuIGZvciBzdWJ0cmFjdGl2ZSBjb2xvciBtb2RlbGluZy5cclxuICAvLyBTZWUgaHR0cDovL3d3dy5oYW5kcHJpbnQuY29tL0hQL1dDTC9jb2xvcjMuaHRtbCNtaXhwcm9maWxlIGFuZCBodHRwOi8vc2NvdHRidXJucy51cy9zdWJ0cmFjdGl2ZS1jb2xvci1taXh0dXJlL1xyXG4gIC8vIFdlIGRvbid0IHVzZSBhIGZ1bGwgc3BlY3RyYSwgYnV0IGRvIHRoZSBzYW1lIHRoaW5nIGNvbXBvbmVudC13aXNlLlxyXG4gIHJldHVybiAyNTUgKiBNYXRoLnBvdyggTWF0aC5wb3coIGxpbmVhclgsIDEgLSByYXRpbyApICogTWF0aC5wb3coIGxpbmVhclksIHJhdGlvICksIDEgLyBnYW1tYSApO1xyXG59XHJcblxyXG4vKipcclxuICogTWl4ZXMgdHdvIGNvbG9ycyB3aXRoIHN1YnRyYWN0aXZlIGNvbG9yIG1vZGVsaW5nLiBTZWUgZ2FtbWFTdWJ0cmFjdCBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cclxuICogQHByaXZhdGVcclxuICpcclxuICogQHBhcmFtIHtDb2xvcn0gYSAtIEZpcnN0IGNvbG9yXHJcbiAqIEBwYXJhbSB7Q29sb3J9IGIgLSBTZWNvbmQgY29sb3JcclxuICogQHBhcmFtIHtudW1iZXJ9IHJhdGlvIC0gMCBtZWFucyBhbGwgZmlyc3QgY29sb3IsIDEgbWVhbnMgYWxsIHNlY29uZCBjb2xvclxyXG4gKiBAcmV0dXJucyB7Q29sb3J9XHJcbiAqL1xyXG5mdW5jdGlvbiBibGVuZFN1YnRyYWN0aXZlUkdCR2FtbWEoIGEsIGIsIHJhdGlvICkge1xyXG4gIHJldHVybiBuZXcgQ29sb3IoIGdhbW1hU3VidHJhY3QoIGEucmVkLCBiLnJlZCwgcmF0aW8gKSxcclxuICAgIGdhbW1hU3VidHJhY3QoIGEuZ3JlZW4sIGIuZ3JlZW4sIHJhdGlvICksXHJcbiAgICBnYW1tYVN1YnRyYWN0KCBhLmJsdWUsIGIuYmx1ZSwgcmF0aW8gKSApO1xyXG59XHJcblxyXG4vKipcclxuICogUG93ZXItYmFzZWQgYmxlbmRpbmcgZnVuY3Rpb24sIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcHJvcG9ydGlvbi1wbGF5Z3JvdW5kL2lzc3Vlcy80NS5cclxuICogQHByaXZhdGVcclxuICpcclxuICogQHBhcmFtIHtudW1iZXJ9IHJhdGlvIC0gRnJvbSAwIHRvIDEuXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBwb3dlciAtIFRoZSBwb3dlciBsZXZlbCB0byBhcHBseSAoPDEgY29tcHJlc3NlcywgPjEgc3RyZXRjaGVzLCA9MSBoYXMgbm8gY2hhbmdlKVxyXG4gKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gKi9cclxuZnVuY3Rpb24gc3RyZXRjaFJhdGlvKCByYXRpbywgcG93ZXIgKSB7XHJcbiAgaWYgKCByYXRpbyA8PSAwLjUgKSB7XHJcbiAgICByZXR1cm4gMC41ICogTWF0aC5wb3coIDIgKiByYXRpbywgcG93ZXIgKTtcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICByZXR1cm4gMSAtIDAuNSAqIE1hdGgucG93KCAyICogKCAxIC0gcmF0aW8gKSwgcG93ZXIgKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIFBhaW50Q2hvaWNlIGV4dGVuZHMgUGhldGlvT2JqZWN0IHtcclxuICAvKipcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Q29sb3I+fSBsZWZ0Q29sb3JQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPENvbG9yPn0gcmlnaHRDb2xvclByb3BlcnR5XHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGxlZnRDb2xvclByb3BlcnR5LCByaWdodENvbG9yUHJvcGVydHksIHRhbmRlbSApIHtcclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLFxyXG4gICAgICBwaGV0aW9UeXBlOiBQYWludENob2ljZUlPXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpY1xyXG4gICAgdGhpcy5sZWZ0Q29sb3JQcm9wZXJ0eSA9IGxlZnRDb2xvclByb3BlcnR5O1xyXG4gICAgdGhpcy5yaWdodENvbG9yUHJvcGVydHkgPSByaWdodENvbG9yUHJvcGVydHk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge251bWJlcn0gYmxlbmRBbW91bnQgLSB2YWx1ZSBiZXR3ZWVuIDAgKGxlZnQgY29sb3IpIGFuZCAxIChyaWdodCBjb2xvcilcclxuICAgKiBAcmV0dXJucyB7Q29sb3J9XHJcbiAgICovXHJcbiAgZ2V0QmxlbmRlZENvbG9yKCBibGVuZEFtb3VudCApIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGJsZW5kQW1vdW50ID49IDAgJiYgYmxlbmRBbW91bnQgPD0gMSwgJ0JsZW5kIGFtb3VudCB3YXMgb3V0IG9mIGJvdW5kcy4nICk7XHJcblxyXG4gICAgcmV0dXJuIGJsZW5kU3VidHJhY3RpdmVSR0JHYW1tYSggdGhpcy5sZWZ0Q29sb3JQcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgdGhpcy5yaWdodENvbG9yUHJvcGVydHkudmFsdWUsXHJcbiAgICAgIHN0cmV0Y2hSYXRpbyggYmxlbmRBbW91bnQsIDIuMCApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIGVpdGhlciB0aGUgbGVmdCBvciByaWdodCBjb2xvciBwcm9wZXJ0eSwgZGVwZW5kaW5nIG9uIHdoYXQgc2lkZSBpcyByZXF1ZXN0ZWQuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHtTaWRlfSBzaWRlXHJcbiAgICogQHJldHVybnMge1Byb3BlcnR5LjxDb2xvcj59XHJcbiAgICovXHJcbiAgZ2V0Q29sb3JQcm9wZXJ0eSggc2lkZSApIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIFNpZGUuaW5jbHVkZXMoIHNpZGUgKSApO1xyXG5cclxuICAgIHJldHVybiBzaWRlID09PSBTaWRlLkxFRlQgPyB0aGlzLmxlZnRDb2xvclByb3BlcnR5IDogdGhpcy5yaWdodENvbG9yUHJvcGVydHk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5LjxQYWludENob2ljZT59IHBhaW50Q2hvaWNlUHJvcGVydHlcclxuICAgKiBAcGFyYW0ge1NpZGV9IHNpZGVcclxuICAgKiBAcmV0dXJucyB7UHJvcGVydHkuPENvbG9yPn1cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0QWN0aXZlQ29sb3JQcm9wZXJ0eSggcGFpbnRDaG9pY2VQcm9wZXJ0eSwgc2lkZSApIHtcclxuICAgIGNvbnN0IGRlcGVuZGVuY2llcyA9IFsgcGFpbnRDaG9pY2VQcm9wZXJ0eSBdLmNvbmNhdCggUGFpbnRDaG9pY2UuQ0hPSUNFUy5tYXAoIHBhaW50Q2hvaWNlID0+IHBhaW50Q2hvaWNlLmdldENvbG9yUHJvcGVydHkoIHNpZGUgKSApICk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBEZXJpdmVkUHJvcGVydHkoIF8udW5pcSggZGVwZW5kZW5jaWVzICksICgpID0+IHBhaW50Q2hvaWNlUHJvcGVydHkudmFsdWUuZ2V0Q29sb3JQcm9wZXJ0eSggc2lkZSApLnZhbHVlICk7XHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBQYWludENob2ljZUlPID0gbmV3IElPVHlwZSggJ1BhaW50Q2hvaWNlSU8nLCB7XHJcbiAgdmFsdWVUeXBlOiBQYWludENob2ljZSxcclxuICBkb2N1bWVudGF0aW9uOiAnQSBjb21iaW5hdGlvbiBvZiBhIGxlZnQgYW5kIHJpZ2h0IGVmZmVjdGl2ZSBjb2xvcicsXHJcbiAgdG9TdGF0ZU9iamVjdCggcGFpbnRDaG9pY2UgKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBfY2hvaWNlOiAoIHBhaW50Q2hvaWNlID09PSBQYWludENob2ljZS5CTFVFX1lFTExPVyApID8gJ0JMVUVfWUVMTE9XJyA6ICggcGFpbnRDaG9pY2UgPT09IFBhaW50Q2hvaWNlLlJFRF9ZRUxMT1cgPyAnUkVEX1lFTExPVycgOiAnQkxBQ0tfV0hJVEUnIClcclxuICAgIH07XHJcbiAgfSxcclxuICBzdGF0ZVNjaGVtYToge1xyXG4gICAgX2Nob2ljZTogU3RyaW5nSU9cclxuICB9LFxyXG4gIGZyb21TdGF0ZU9iamVjdCggc3RhdGVPYmplY3QgKSB7XHJcbiAgICByZXR1cm4gUGFpbnRDaG9pY2VbIHN0YXRlT2JqZWN0Ll9jaG9pY2UgXTtcclxuICB9XHJcbn0gKTtcclxuUGFpbnRDaG9pY2UuUGFpbnRDaG9pY2VJTyA9IFBhaW50Q2hvaWNlSU87XHJcblxyXG5wcm9wb3J0aW9uUGxheWdyb3VuZC5yZWdpc3RlciggJ1BhaW50Q2hvaWNlJywgUGFpbnRDaG9pY2UgKTtcclxuXHJcblBhaW50Q2hvaWNlLkJMVUUgPSBQcm9wb3J0aW9uUGxheWdyb3VuZENvbG9ycy5wYWludEJsdWVQcm9wZXJ0eTtcclxuUGFpbnRDaG9pY2UuWUVMTE9XID0gUHJvcG9ydGlvblBsYXlncm91bmRDb2xvcnMucGFpbnRZZWxsb3dQcm9wZXJ0eTtcclxuUGFpbnRDaG9pY2UuUkVEID0gUHJvcG9ydGlvblBsYXlncm91bmRDb2xvcnMucGFpbnRSZWRQcm9wZXJ0eTtcclxuUGFpbnRDaG9pY2UuQkxBQ0sgPSBQcm9wb3J0aW9uUGxheWdyb3VuZENvbG9ycy5wYWludEJsYWNrUHJvcGVydHk7XHJcblBhaW50Q2hvaWNlLldISVRFID0gUHJvcG9ydGlvblBsYXlncm91bmRDb2xvcnMucGFpbnRXaGl0ZVByb3BlcnR5O1xyXG5cclxuLy8gQXNzaWduIHVuaXF1ZSBJRHMgdG8gdGhlIGluZGl2aWR1YWwgcGFpbnRzLCBzbyB0aGF0IHRoZXkgY2FuIGJlIGRpZmZlcmVudGlhdGVkIGZvciBiYWxsb29uIGhhbmRsaW5nLlxyXG5QYWludENob2ljZS5CTFVFLnBhaW50SWQgPSAxO1xyXG5QYWludENob2ljZS5ZRUxMT1cucGFpbnRJZCA9IDI7XHJcblBhaW50Q2hvaWNlLlJFRC5wYWludElkID0gMztcclxuUGFpbnRDaG9pY2UuQkxBQ0sucGFpbnRJZCA9IDQ7XHJcblBhaW50Q2hvaWNlLldISVRFLnBhaW50SWQgPSA1O1xyXG5cclxuUGFpbnRDaG9pY2UuQkxVRV9ZRUxMT1cgPSBuZXcgUGFpbnRDaG9pY2UoIFBhaW50Q2hvaWNlLkJMVUUsIFBhaW50Q2hvaWNlLllFTExPVywgVGFuZGVtLkdMT0JBTF9NT0RFTC5jcmVhdGVUYW5kZW0oICdibHVlWWVsbG93UGFpbnRDaG9pY2UnICkgKTtcclxuUGFpbnRDaG9pY2UuUkVEX1lFTExPVyA9IG5ldyBQYWludENob2ljZSggUGFpbnRDaG9pY2UuUkVELCBQYWludENob2ljZS5ZRUxMT1csIFRhbmRlbS5HTE9CQUxfTU9ERUwuY3JlYXRlVGFuZGVtKCAncmVkWWVsbG93UGFpbnRDaG9pY2UnICkgKTtcclxuUGFpbnRDaG9pY2UuQkxBQ0tfV0hJVEUgPSBuZXcgUGFpbnRDaG9pY2UoIFBhaW50Q2hvaWNlLkJMQUNLLCBQYWludENob2ljZS5XSElURSwgVGFuZGVtLkdMT0JBTF9NT0RFTC5jcmVhdGVUYW5kZW0oICdibGFja1doaXRlUGFpbnRDaG9pY2UnICkgKTtcclxuXHJcblBhaW50Q2hvaWNlLkNIT0lDRVMgPSBbXHJcbiAgUGFpbnRDaG9pY2UuQkxVRV9ZRUxMT1csXHJcbiAgUGFpbnRDaG9pY2UuUkVEX1lFTExPVyxcclxuICBQYWludENob2ljZS5CTEFDS19XSElURVxyXG5dO1xyXG5cclxuUGFpbnRDaG9pY2UuQ09MT1JTID0gW1xyXG4gIFBhaW50Q2hvaWNlLkJMVUUsXHJcbiAgUGFpbnRDaG9pY2UuWUVMTE9XLFxyXG4gIFBhaW50Q2hvaWNlLlJFRCxcclxuICBQYWludENob2ljZS5CTEFDSyxcclxuICBQYWludENob2ljZS5XSElURVxyXG5dO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgUGFpbnRDaG9pY2U7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sMkNBQTJDO0FBQ3ZFLFNBQVNDLEtBQUssUUFBUSxzQ0FBc0M7QUFDNUQsT0FBT0MsWUFBWSxNQUFNLDBDQUEwQztBQUNuRSxPQUFPQyxNQUFNLE1BQU0sb0NBQW9DO0FBQ3ZELE9BQU9DLE1BQU0sTUFBTSwwQ0FBMEM7QUFDN0QsT0FBT0Ms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