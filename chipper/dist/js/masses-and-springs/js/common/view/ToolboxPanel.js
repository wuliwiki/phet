// Copyright 2017-2023, University of Colorado Boulder

/**
 * Responsible for the toolbox panel and the ruler/timer icons held within
 *
 * @author Matt Pennington (PhET Interactive Simulations)
 * @author Denzell Barnett (PhET Interactive Simulations)
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import merge from '../../../../phet-core/js/merge.js';
import RulerNode from '../../../../scenery-phet/js/RulerNode.js';
import Stopwatch from '../../../../scenery-phet/js/Stopwatch.js';
import StopwatchNode from '../../../../scenery-phet/js/StopwatchNode.js';
import { AlignBox, DragListener, HBox, SimpleDragHandler } from '../../../../scenery/js/imports.js';
import Property from '../../../../axon/js/Property.js';
import Panel from '../../../../sun/js/Panel.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import massesAndSprings from '../../massesAndSprings.js';
import MassesAndSpringsConstants from '../MassesAndSpringsConstants.js';
class ToolboxPanel extends Panel {
  /**
   * @param {Stopwatch} stopwatch
   * @param {Bounds2} dragBounds
   * @param {DraggableRulerNode} rulerNode
   * @param {StopwatchNode} stopwatchNode
   * @param {Property.<boolean>} rulerVisibleProperty
   * @param {AlignGroup} alignGroup
   * @param {Tandem} tandem
   * @param {Object} [options]
   */
  constructor(stopwatch, dragBounds, rulerNode, stopwatchNode, rulerVisibleProperty, alignGroup, tandem, options) {
    options = merge({
      dragBounds: dragBounds,
      fill: MassesAndSpringsConstants.PANEL_FILL,
      xMargin: 10,
      yMargin: 7,
      align: 'center',
      cornerRadius: MassesAndSpringsConstants.PANEL_CORNER_RADIUS
    }, options);
    const toolbox = new HBox({
      align: 'center',
      spacing: 30,
      tandem: tandem.createTandem('toolbox'),
      excludeInvisibleChildrenFromBounds: false
    });
    const toolboxAlignBox = new AlignBox(toolbox, {
      group: alignGroup
    });
    super(toolboxAlignBox, options);

    // Create timer to be turned into icon
    const timer = new StopwatchNode(new Stopwatch({
      isVisible: true,
      tandem: Tandem.OPT_OUT
    }));
    timer.scale(0.5);

    // Create ruler to be turned into icon
    const rulerWidth = 397; // 1 meter
    const rulerLength = 0.175 * rulerWidth;
    const majorTickLabels = [''];
    for (let i = 1; i < 10; i++) {
      // create 10 empty strings for labels
      majorTickLabels.push('');
    }
    const majorTickWidth = rulerWidth / (majorTickLabels.length - 1);
    const ruler = new RulerNode(rulerWidth, rulerLength, majorTickWidth, majorTickLabels, '', {
      tandem: tandem.createTandem('ruler')
    });
    ruler.rotate(40, false);
    ruler.scale(0.12);

    // {Node} Create timer icon. Visible option is used only for reset() in ToolboxPanel.js
    const rulerIcon = ruler.rasterized({
      resolution: 5,
      imageOptions: {
        // Instead of changing the rendering, we'll dynamically generate a mipmap so the ruler icon appearance looks better.
        // See https://github.com/phetsims/masses-and-springs/issues/199.
        mipmap: true,
        cursor: 'pointer',
        tandem: tandem.createTandem('rulerIcon')
      }
    });

    // Drag listener for event forwarding: rulerIcon ---> rulerNode
    rulerIcon.addInputListener(DragListener.createForwardingListener(event => {
      rulerVisibleProperty.set(true);

      // Now determine the initial position where this element should move to after it's created, which corresponds
      // to the position of the mouse or touch event.
      const initialPosition = rulerNode.globalToParentPoint(event.pointer.point).minus(new Vector2(-rulerNode.width * 0.5, rulerNode.height * 0.4));
      rulerNode.positionProperty.set(initialPosition);

      // Sending through the startDrag from icon to rulerNode causes it to receive all subsequent drag events.
      rulerNode.rulerNodeDragListener.press(event);
    }, {
      // allow moving a finger (on a touchscreen) dragged across this node to interact with it
      allowTouchSnag: true,
      dragBoundsProperty: new Property(dragBounds),
      tandem: tandem.createTandem('dragListener'),
      useParentOffset: true
    }));
    toolbox.addChild(rulerIcon);
    rulerVisibleProperty.link(visible => {
      rulerIcon.visible = !visible;
    });

    // {Node} Create timer icon. Visible option is used only for reset() in ToolboxPanel.js
    const timerIcon = timer.rasterized({
      resolution: 5,
      imageOptions: {
        cursor: 'pointer',
        tandem: tandem.createTandem('timerIcon')
      }
    });

    // Drag listener for event forwarding: timerIcon ---> stopwatchNode
    timerIcon.addInputListener(SimpleDragHandler.createForwardingListener(event => {
      // Toggle visibility
      stopwatch.isVisibleProperty.value = true;

      // Now determine the initial position where this element should move to after it's created, which corresponds
      // to the position of the mouse or touch event.
      const initialPosition = stopwatchNode.globalToParentPoint(event.pointer.point).minus(new Vector2(stopwatchNode.width / 2, stopwatchNode.height * 0.4));
      stopwatch.positionProperty.set(initialPosition);

      // Sending through the startDrag from icon to stopwatchNode causes it to receive all subsequent drag events.
      stopwatchNode.dragListener.press(event, stopwatchNode);
    }, {
      // allow moving a finger (on a touchscreen) dragged across this node to interact with it
      allowTouchSnag: true,
      dragBounds: dragBounds,
      tandem: tandem.createTandem('dragListener')
    }));
    toolbox.addChild(timerIcon);
    stopwatch.isVisibleProperty.link(visible => {
      timerIcon.visible = !visible;
    });
  }
}
massesAndSprings.register('ToolboxPanel', ToolboxPanel);
export default ToolboxPanel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwibWVyZ2UiLCJSdWxlck5vZGUiLCJTdG9wd2F0Y2giLCJTdG9wd2F0Y2hOb2RlIiwiQWxpZ25Cb3giLCJEcmFnTGlzdGVuZXIiLCJIQm94IiwiU2ltcGxlRHJhZ0hhbmRsZXIiLCJQcm9wZXJ0eSIsIlBhbmVsIiwiVGFuZGVtIiwibWFzc2VzQW5kU3ByaW5ncyIsIk1hc3Nlc0FuZFNwcmluZ3NDb25zdGFudHMiLCJUb29sYm94UGFuZWwiLCJjb25zdHJ1Y3RvciIsInN0b3B3YXRjaCIsImRyYWdCb3VuZHMiLCJydWxlck5vZGUiLCJzdG9wd2F0Y2hOb2RlIiwicnVsZXJWaXNpYmxlUHJvcGVydHkiLCJhbGlnbkdyb3VwIiwidGFuZGVtIiwib3B0aW9ucyIsImZpbGwiLCJQQU5FTF9GSUxMIiwieE1hcmdpbiIsInlNYXJnaW4iLCJhbGlnbiIsImNvcm5lclJhZGl1cyIsIlBBTkVMX0NPUk5FUl9SQURJVVMiLCJ0b29sYm94Iiwic3BhY2luZyIsImNyZWF0ZVRhbmRlbSIsImV4Y2x1ZGVJbnZpc2libGVDaGlsZHJlbkZyb21Cb3VuZHMiLCJ0b29sYm94QWxpZ25Cb3giLCJncm91cCIsInRpbWVyIiwiaXNWaXNpYmxlIiwiT1BUX09VVCIsInNjYWxlIiwicnVsZXJXaWR0aCIsInJ1bGVyTGVuZ3RoIiwibWFqb3JUaWNrTGFiZWxzIiwiaSIsInB1c2giLCJtYWpvclRpY2tXaWR0aCIsImxlbmd0aCIsInJ1bGVyIiwicm90YXRlIiwicnVsZXJJY29uIiwicmFzdGVyaXplZCIsInJlc29sdXRpb24iLCJpbWFnZU9wdGlvbnMiLCJtaXBtYXAiLCJjdXJzb3IiLCJhZGRJbnB1dExpc3RlbmVyIiwiY3JlYXRlRm9yd2FyZGluZ0xpc3RlbmVyIiwiZXZlbnQiLCJzZXQiLCJpbml0aWFsUG9zaXRpb24iLCJnbG9iYWxUb1BhcmVudFBvaW50IiwicG9pbnRlciIsInBvaW50IiwibWludXMiLCJ3aWR0aCIsImhlaWdodCIsInBvc2l0aW9uUHJvcGVydHkiLCJydWxlck5vZGVEcmFnTGlzdGVuZXIiLCJwcmVzcyIsImFsbG93VG91Y2hTbmFnIiwiZHJhZ0JvdW5kc1Byb3BlcnR5IiwidXNlUGFyZW50T2Zmc2V0IiwiYWRkQ2hpbGQiLCJsaW5rIiwidmlzaWJsZSIsInRpbWVySWNvbiIsImlzVmlzaWJsZVByb3BlcnR5IiwidmFsdWUiLCJkcmFnTGlzdGVuZXIiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlRvb2xib3hQYW5lbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNy0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBSZXNwb25zaWJsZSBmb3IgdGhlIHRvb2xib3ggcGFuZWwgYW5kIHRoZSBydWxlci90aW1lciBpY29ucyBoZWxkIHdpdGhpblxyXG4gKlxyXG4gKiBAYXV0aG9yIE1hdHQgUGVubmluZ3RvbiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBEZW56ZWxsIEJhcm5ldHQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IFJ1bGVyTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUnVsZXJOb2RlLmpzJztcclxuaW1wb3J0IFN0b3B3YXRjaCBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvU3RvcHdhdGNoLmpzJztcclxuaW1wb3J0IFN0b3B3YXRjaE5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1N0b3B3YXRjaE5vZGUuanMnO1xyXG5pbXBvcnQgeyBBbGlnbkJveCwgRHJhZ0xpc3RlbmVyLCBIQm94LCBTaW1wbGVEcmFnSGFuZGxlciB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFBhbmVsIGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9QYW5lbC5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBtYXNzZXNBbmRTcHJpbmdzIGZyb20gJy4uLy4uL21hc3Nlc0FuZFNwcmluZ3MuanMnO1xyXG5pbXBvcnQgTWFzc2VzQW5kU3ByaW5nc0NvbnN0YW50cyBmcm9tICcuLi9NYXNzZXNBbmRTcHJpbmdzQ29uc3RhbnRzLmpzJztcclxuXHJcbmNsYXNzIFRvb2xib3hQYW5lbCBleHRlbmRzIFBhbmVsIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtTdG9wd2F0Y2h9IHN0b3B3YXRjaFxyXG4gICAqIEBwYXJhbSB7Qm91bmRzMn0gZHJhZ0JvdW5kc1xyXG4gICAqIEBwYXJhbSB7RHJhZ2dhYmxlUnVsZXJOb2RlfSBydWxlck5vZGVcclxuICAgKiBAcGFyYW0ge1N0b3B3YXRjaE5vZGV9IHN0b3B3YXRjaE5vZGVcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5Ljxib29sZWFuPn0gcnVsZXJWaXNpYmxlUHJvcGVydHlcclxuICAgKiBAcGFyYW0ge0FsaWduR3JvdXB9IGFsaWduR3JvdXBcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBzdG9wd2F0Y2gsIGRyYWdCb3VuZHMsIHJ1bGVyTm9kZSwgc3RvcHdhdGNoTm9kZSwgcnVsZXJWaXNpYmxlUHJvcGVydHksIGFsaWduR3JvdXAsIHRhbmRlbSwgb3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuICAgICAgZHJhZ0JvdW5kczogZHJhZ0JvdW5kcyxcclxuICAgICAgZmlsbDogTWFzc2VzQW5kU3ByaW5nc0NvbnN0YW50cy5QQU5FTF9GSUxMLFxyXG4gICAgICB4TWFyZ2luOiAxMCxcclxuICAgICAgeU1hcmdpbjogNyxcclxuICAgICAgYWxpZ246ICdjZW50ZXInLFxyXG4gICAgICBjb3JuZXJSYWRpdXM6IE1hc3Nlc0FuZFNwcmluZ3NDb25zdGFudHMuUEFORUxfQ09STkVSX1JBRElVU1xyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IHRvb2xib3ggPSBuZXcgSEJveCgge1xyXG4gICAgICBhbGlnbjogJ2NlbnRlcicsXHJcbiAgICAgIHNwYWNpbmc6IDMwLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd0b29sYm94JyApLFxyXG4gICAgICBleGNsdWRlSW52aXNpYmxlQ2hpbGRyZW5Gcm9tQm91bmRzOiBmYWxzZVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHRvb2xib3hBbGlnbkJveCA9IG5ldyBBbGlnbkJveCggdG9vbGJveCwgeyBncm91cDogYWxpZ25Hcm91cCB9ICk7XHJcblxyXG4gICAgc3VwZXIoIHRvb2xib3hBbGlnbkJveCwgb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aW1lciB0byBiZSB0dXJuZWQgaW50byBpY29uXHJcbiAgICBjb25zdCB0aW1lciA9IG5ldyBTdG9wd2F0Y2hOb2RlKCBuZXcgU3RvcHdhdGNoKCB7IGlzVmlzaWJsZTogdHJ1ZSwgdGFuZGVtOiBUYW5kZW0uT1BUX09VVCB9ICkgKTtcclxuICAgIHRpbWVyLnNjYWxlKCAwLjUgKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgcnVsZXIgdG8gYmUgdHVybmVkIGludG8gaWNvblxyXG4gICAgY29uc3QgcnVsZXJXaWR0aCA9IDM5NzsgLy8gMSBtZXRlclxyXG4gICAgY29uc3QgcnVsZXJMZW5ndGggPSAwLjE3NSAqIHJ1bGVyV2lkdGg7XHJcbiAgICBjb25zdCBtYWpvclRpY2tMYWJlbHMgPSBbICcnIF07XHJcbiAgICBmb3IgKCBsZXQgaSA9IDE7IGkgPCAxMDsgaSsrICkgeyAvLyBjcmVhdGUgMTAgZW1wdHkgc3RyaW5ncyBmb3IgbGFiZWxzXHJcbiAgICAgIG1ham9yVGlja0xhYmVscy5wdXNoKCAnJyApO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWFqb3JUaWNrV2lkdGggPSBydWxlcldpZHRoIC8gKCBtYWpvclRpY2tMYWJlbHMubGVuZ3RoIC0gMSApO1xyXG4gICAgY29uc3QgcnVsZXIgPSBuZXcgUnVsZXJOb2RlKFxyXG4gICAgICBydWxlcldpZHRoLFxyXG4gICAgICBydWxlckxlbmd0aCxcclxuICAgICAgbWFqb3JUaWNrV2lkdGgsXHJcbiAgICAgIG1ham9yVGlja0xhYmVscyxcclxuICAgICAgJycsXHJcbiAgICAgIHsgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAncnVsZXInICkgfSApO1xyXG4gICAgcnVsZXIucm90YXRlKCA0MCwgZmFsc2UgKTtcclxuICAgIHJ1bGVyLnNjYWxlKCAwLjEyICk7XHJcblxyXG4gICAgLy8ge05vZGV9IENyZWF0ZSB0aW1lciBpY29uLiBWaXNpYmxlIG9wdGlvbiBpcyB1c2VkIG9ubHkgZm9yIHJlc2V0KCkgaW4gVG9vbGJveFBhbmVsLmpzXHJcbiAgICBjb25zdCBydWxlckljb24gPSBydWxlci5yYXN0ZXJpemVkKCB7XHJcbiAgICAgIHJlc29sdXRpb246IDUsXHJcbiAgICAgIGltYWdlT3B0aW9uczoge1xyXG5cclxuICAgICAgICAvLyBJbnN0ZWFkIG9mIGNoYW5naW5nIHRoZSByZW5kZXJpbmcsIHdlJ2xsIGR5bmFtaWNhbGx5IGdlbmVyYXRlIGEgbWlwbWFwIHNvIHRoZSBydWxlciBpY29uIGFwcGVhcmFuY2UgbG9va3MgYmV0dGVyLlxyXG4gICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbWFzc2VzLWFuZC1zcHJpbmdzL2lzc3Vlcy8xOTkuXHJcbiAgICAgICAgbWlwbWFwOiB0cnVlLFxyXG4gICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLFxyXG4gICAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3J1bGVySWNvbicgKVxyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gRHJhZyBsaXN0ZW5lciBmb3IgZXZlbnQgZm9yd2FyZGluZzogcnVsZXJJY29uIC0tLT4gcnVsZXJOb2RlXHJcbiAgICBydWxlckljb24uYWRkSW5wdXRMaXN0ZW5lciggRHJhZ0xpc3RlbmVyLmNyZWF0ZUZvcndhcmRpbmdMaXN0ZW5lciggZXZlbnQgPT4ge1xyXG4gICAgICBydWxlclZpc2libGVQcm9wZXJ0eS5zZXQoIHRydWUgKTtcclxuXHJcbiAgICAgIC8vIE5vdyBkZXRlcm1pbmUgdGhlIGluaXRpYWwgcG9zaXRpb24gd2hlcmUgdGhpcyBlbGVtZW50IHNob3VsZCBtb3ZlIHRvIGFmdGVyIGl0J3MgY3JlYXRlZCwgd2hpY2ggY29ycmVzcG9uZHNcclxuICAgICAgLy8gdG8gdGhlIHBvc2l0aW9uIG9mIHRoZSBtb3VzZSBvciB0b3VjaCBldmVudC5cclxuICAgICAgY29uc3QgaW5pdGlhbFBvc2l0aW9uID0gcnVsZXJOb2RlLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKVxyXG4gICAgICAgIC5taW51cyggbmV3IFZlY3RvcjIoIC1ydWxlck5vZGUud2lkdGggKiAwLjUsIHJ1bGVyTm9kZS5oZWlnaHQgKiAwLjQgKSApO1xyXG4gICAgICBydWxlck5vZGUucG9zaXRpb25Qcm9wZXJ0eS5zZXQoIGluaXRpYWxQb3NpdGlvbiApO1xyXG5cclxuICAgICAgLy8gU2VuZGluZyB0aHJvdWdoIHRoZSBzdGFydERyYWcgZnJvbSBpY29uIHRvIHJ1bGVyTm9kZSBjYXVzZXMgaXQgdG8gcmVjZWl2ZSBhbGwgc3Vic2VxdWVudCBkcmFnIGV2ZW50cy5cclxuICAgICAgcnVsZXJOb2RlLnJ1bGVyTm9kZURyYWdMaXN0ZW5lci5wcmVzcyggZXZlbnQgKTtcclxuICAgIH0sIHtcclxuXHJcbiAgICAgIC8vIGFsbG93IG1vdmluZyBhIGZpbmdlciAob24gYSB0b3VjaHNjcmVlbikgZHJhZ2dlZCBhY3Jvc3MgdGhpcyBub2RlIHRvIGludGVyYWN0IHdpdGggaXRcclxuICAgICAgYWxsb3dUb3VjaFNuYWc6IHRydWUsXHJcbiAgICAgIGRyYWdCb3VuZHNQcm9wZXJ0eTogbmV3IFByb3BlcnR5KCBkcmFnQm91bmRzICksXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RyYWdMaXN0ZW5lcicgKSxcclxuICAgICAgdXNlUGFyZW50T2Zmc2V0OiB0cnVlXHJcbiAgICB9ICkgKTtcclxuICAgIHRvb2xib3guYWRkQ2hpbGQoIHJ1bGVySWNvbiApO1xyXG5cclxuICAgIHJ1bGVyVmlzaWJsZVByb3BlcnR5LmxpbmsoIHZpc2libGUgPT4ge1xyXG4gICAgICBydWxlckljb24udmlzaWJsZSA9ICF2aXNpYmxlO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHtOb2RlfSBDcmVhdGUgdGltZXIgaWNvbi4gVmlzaWJsZSBvcHRpb24gaXMgdXNlZCBvbmx5IGZvciByZXNldCgpIGluIFRvb2xib3hQYW5lbC5qc1xyXG4gICAgY29uc3QgdGltZXJJY29uID0gdGltZXIucmFzdGVyaXplZCgge1xyXG4gICAgICByZXNvbHV0aW9uOiA1LFxyXG4gICAgICBpbWFnZU9wdGlvbnM6IHtcclxuICAgICAgICBjdXJzb3I6ICdwb2ludGVyJyxcclxuICAgICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd0aW1lckljb24nIClcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIERyYWcgbGlzdGVuZXIgZm9yIGV2ZW50IGZvcndhcmRpbmc6IHRpbWVySWNvbiAtLS0+IHN0b3B3YXRjaE5vZGVcclxuICAgIHRpbWVySWNvbi5hZGRJbnB1dExpc3RlbmVyKCBTaW1wbGVEcmFnSGFuZGxlci5jcmVhdGVGb3J3YXJkaW5nTGlzdGVuZXIoIGV2ZW50ID0+IHtcclxuXHJcbiAgICAgIC8vIFRvZ2dsZSB2aXNpYmlsaXR5XHJcbiAgICAgIHN0b3B3YXRjaC5pc1Zpc2libGVQcm9wZXJ0eS52YWx1ZSA9IHRydWU7XHJcblxyXG4gICAgICAvLyBOb3cgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIHBvc2l0aW9uIHdoZXJlIHRoaXMgZWxlbWVudCBzaG91bGQgbW92ZSB0byBhZnRlciBpdCdzIGNyZWF0ZWQsIHdoaWNoIGNvcnJlc3BvbmRzXHJcbiAgICAgIC8vIHRvIHRoZSBwb3NpdGlvbiBvZiB0aGUgbW91c2Ugb3IgdG91Y2ggZXZlbnQuXHJcbiAgICAgIGNvbnN0IGluaXRpYWxQb3NpdGlvbiA9IHN0b3B3YXRjaE5vZGUuZ2xvYmFsVG9QYXJlbnRQb2ludCggZXZlbnQucG9pbnRlci5wb2ludCApXHJcbiAgICAgICAgLm1pbnVzKCBuZXcgVmVjdG9yMiggc3RvcHdhdGNoTm9kZS53aWR0aCAvIDIsIHN0b3B3YXRjaE5vZGUuaGVpZ2h0ICogMC40ICkgKTtcclxuXHJcbiAgICAgIHN0b3B3YXRjaC5wb3NpdGlvblByb3BlcnR5LnNldCggaW5pdGlhbFBvc2l0aW9uICk7XHJcblxyXG4gICAgICAvLyBTZW5kaW5nIHRocm91Z2ggdGhlIHN0YXJ0RHJhZyBmcm9tIGljb24gdG8gc3RvcHdhdGNoTm9kZSBjYXVzZXMgaXQgdG8gcmVjZWl2ZSBhbGwgc3Vic2VxdWVudCBkcmFnIGV2ZW50cy5cclxuICAgICAgc3RvcHdhdGNoTm9kZS5kcmFnTGlzdGVuZXIucHJlc3MoIGV2ZW50LCBzdG9wd2F0Y2hOb2RlICk7XHJcbiAgICB9LCB7XHJcblxyXG4gICAgICAvLyBhbGxvdyBtb3ZpbmcgYSBmaW5nZXIgKG9uIGEgdG91Y2hzY3JlZW4pIGRyYWdnZWQgYWNyb3NzIHRoaXMgbm9kZSB0byBpbnRlcmFjdCB3aXRoIGl0XHJcbiAgICAgIGFsbG93VG91Y2hTbmFnOiB0cnVlLFxyXG4gICAgICBkcmFnQm91bmRzOiBkcmFnQm91bmRzLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdkcmFnTGlzdGVuZXInIClcclxuICAgIH0gKSApO1xyXG4gICAgdG9vbGJveC5hZGRDaGlsZCggdGltZXJJY29uICk7XHJcbiAgICBzdG9wd2F0Y2guaXNWaXNpYmxlUHJvcGVydHkubGluayggdmlzaWJsZSA9PiB7XHJcbiAgICAgIHRpbWVySWNvbi52aXNpYmxlID0gIXZpc2libGU7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5tYXNzZXNBbmRTcHJpbmdzLnJlZ2lzdGVyKCAnVG9vbGJveFBhbmVsJywgVG9vbGJveFBhbmVsICk7XHJcbmV4cG9ydCBkZWZhdWx0IFRvb2xib3hQYW5lbDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsU0FBUyxNQUFNLDBDQUEwQztBQUNoRSxPQUFPQyxTQUFTLE1BQU0sMENBQTBDO0FBQ2hFLE9BQU9DLGFBQWEsTUFBTSw4Q0FBOEM7QUFDeEUsU0FBU0MsUUFBUSxFQUFFQyxZQUFZLEVBQUVDLElBQUksRUFBRUMsaUJBQWlCLFFBQVEsbUNBQW1DO0FBQ25HLE9BQU9DLFFBQVEsTUFBTSxpQ0FBaUM7QUFDdEQsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBQ3BELE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxPQUFPQyx5QkFBeUIsTUFBTSxpQ0FBaUM7QUFFdkUsTUFBTUMsWUFBWSxTQUFTSixLQUFLLENBQUM7RUFFL0I7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRUssV0FBV0EsQ0FBRUMsU0FBUyxFQUFFQyxVQUFVLEVBQUVDLFNBQVMsRUFBRUMsYUFBYSxFQUFFQyxvQkFBb0IsRUFBRUMsVUFBVSxFQUFFQyxNQUFNLEVB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