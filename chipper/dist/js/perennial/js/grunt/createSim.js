// Copyright 2014-2015, University of Colorado Boulder

/**
 * This grunt task creates a simulation based on the simula-rasa template.
 * This task must be run from perennial directory.
 *
 * Example usage:
 * grunt create-sim --repo=cannon-blaster --author="Sam Reid (PhET Interactive Simulations)"
 *
 * This task will attempt to coerce a sim title from the repository name. For example,
 * 'cannon-blaster' becomes 'Cannon Blaster'.  If this is not suitable, then use --title
 * to specify a title.  For example:
 * grunt create-sim --repo=fractions-basics --title="Fractions: Basics" --author="Sam Reid (PhET Interactive Simulations)"
 *
 * For development and debugging, add --clean=true to delete the repository directory.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Chris Malley (PixelZoom, Inc.)
 */

const _ = require('lodash');
const assert = require('assert');
const execute = require('../common/execute');
const grunt = require('grunt');
const gruntCommand = require('../common/gruntCommand');
const npmUpdate = require('../common/npmUpdate');
const fs = require('fs');

/**
 * @param {string} repo
 * @param {string} author
 * @param {Object} [options]
 */
module.exports = async function (repo, author, options) {
  const {
    title = toTitle(repo),
    clean = false
  } = options || {};
  assert(typeof repo === 'string' && /^[a-z]+(-[a-z]+)*$/u.test(repo), 'repo name should be composed of lower-case characters, optionally with dashes used as separators');
  assert(typeof author === 'string');
  assert(typeof title === 'string');
  assert(typeof clean === 'boolean');

  /**
   * Coerces a repository name to a sim title, eg, 'simula-rasa' -> 'Simula Rasa'
   * @param {string} simName - the input string like 'build-an-atom'
   * @returns {string}
   */
  function toTitle(simName) {
    const tmpString = simName.replace(/-(.)/g, (match, group1) => {
      return ` ${group1.toUpperCase()}`;
    });
    return tmpString.substring(0, 1).toUpperCase() + tmpString.substring(1);
  }
  grunt.log.writeln(`Greetings ${author}!`);
  grunt.log.writeln(`creating sim with repository name ${repo}`);

  // initialize the directory
  const destinationPath = `../${repo}`;
  if (grunt.file.exists(destinationPath)) {
    if (clean) {
      grunt.log.writeln(`Cleaning ${destinationPath}`);
      grunt.file.delete(destinationPath, {
        force: true
      }); // delete won't operate outside of current working dir unless forced
    } else {
      grunt.log.writeln(`WARNING:${destinationPath} already exists, overwriting`);
    }
  }
  grunt.file.mkdir(destinationPath);

  // Create variations of the repository name
  const configPath = repo.toUpperCase().replace(/-/g, '_'); // eg, 'simula-rasa' -> 'SIMULA_RASA'
  const lowerCamelCase = _.camelCase(repo); // eg, 'simula-rasa' -> 'simulaRasa'
  const upperCamelCase = lowerCamelCase.substring(0, 1).toUpperCase() + lowerCamelCase.substring(1); // eg, 'simula-rasa' -> 'SimulaRasa'

  const yearToday = grunt.template.today('yyyy');

  // Iterate over the file system and copy files, changing filenames and contents as we go.
  grunt.file.recurse('../simula-rasa', (abspath, rootdir, subdir, filename) => {
    // skip these files
    if (abspath.indexOf('../simula-rasa/README.md') === 0 || abspath.indexOf('../simula-rasa/node_modules/') === 0 || abspath.indexOf('../simula-rasa/.git/') === 0 || abspath.indexOf('../simula-rasa/build/') === 0) {

      // do nothing
    } else {
      let contents = grunt.file.read(abspath);

      // Replace variations of the repository name
      contents = contents.replace(/simula-rasa/g, repo);
      contents = contents.replace(/SIMULA_RASA/g, configPath);
      contents = contents.replace(/simulaRasa/g, lowerCamelCase);
      contents = contents.replace(/SimulaRasa/g, upperCamelCase);

      // Replace the title
      contents = contents.replace(/{{TITLE}}/g, title);

      // Replace author
      contents = contents.replace(/{{AUTHOR}}/g, author);

      // Fix copyright comments
      contents = contents.replace(/\/\/ Copyright \d\d\d\d.*/g, `// Copyright ${yearToday}, University of Colorado Boulder`);

      // Replace names in the path where the contents will be written
      let contentsPath = subdir ? `${destinationPath}/${subdir}/${filename}` : `${destinationPath}/${filename}`;
      contentsPath = contentsPath.replace(/simula-rasa/, repo);
      contentsPath = contentsPath.replace(/simulaRasa/, lowerCamelCase);
      contentsPath = contentsPath.replace(/SimulaRasa/, upperCamelCase);

      // Write the file
      grunt.file.write(contentsPath, contents);
      grunt.log.writeln('wrote', contentsPath);
    }
  });

  // Delete readmeCreatedManually from template, see https://github.com/phetsims/perennial/issues/199
  const packagePath = `${destinationPath}/package.json`;
  const simPackageJSON = grunt.file.readJSON(packagePath);
  if (simPackageJSON.phet && simPackageJSON.phet.hasOwnProperty('readmeCreatedManually')) {
    delete simPackageJSON.phet.readmeCreatedManually;
  }
  fs.writeFileSync(packagePath, JSON.stringify(simPackageJSON, null, 2));
  await npmUpdate(repo);
  await execute(gruntCommand, ['unpublished-README'], `../${repo}`);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfIiwicmVxdWlyZSIsImFzc2VydCIsImV4ZWN1dGUiLCJncnVudCIsImdydW50Q29tbWFuZCIsIm5wbVVwZGF0ZSIsImZzIiwibW9kdWxlIiwiZXhwb3J0cyIsInJlcG8iLCJhdXRob3IiLCJvcHRpb25zIiwidGl0bGUiLCJ0b1RpdGxlIiwiY2xlYW4iLCJ0ZXN0Iiwic2ltTmFtZSIsInRtcFN0cmluZyIsInJlcGxhY2UiLCJtYXRjaCIsImdyb3VwMSIsInRvVXBwZXJDYXNlIiwic3Vic3RyaW5nIiwibG9nIiwid3JpdGVsbiIsImRlc3RpbmF0aW9uUGF0aCIsImZpbGUiLCJleGlzdHMiLCJkZWxldGUiLCJmb3JjZSIsIm1rZGlyIiwiY29uZmlnUGF0aCIsImxvd2VyQ2FtZWxDYXNlIiwiY2FtZWxDYXNlIiwidXBwZXJDYW1lbENhc2UiLCJ5ZWFyVG9kYXkiLCJ0ZW1wbGF0ZSIsInRvZGF5IiwicmVjdXJzZSIsImFic3BhdGgiLCJyb290ZGlyIiwic3ViZGlyIiwiZmlsZW5hbWUiLCJpbmRleE9mIiwiY29udGVudHMiLCJyZWFkIiwiY29udGVudHNQYXRoIiwid3JpdGUiLCJwYWNrYWdlUGF0aCIsInNpbVBhY2thZ2VKU09OIiwicmVhZEpTT04iLCJwaGV0IiwiaGFzT3duUHJvcGVydHkiLCJyZWFkbWVDcmVhdGVkTWFudWFsbHkiLCJ3cml0ZUZpbGVTeW5jIiwiSlNPTiIsInN0cmluZ2lmeSJdLCJzb3VyY2VzIjpbImNyZWF0ZVNpbS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDE1LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBUaGlzIGdydW50IHRhc2sgY3JlYXRlcyBhIHNpbXVsYXRpb24gYmFzZWQgb24gdGhlIHNpbXVsYS1yYXNhIHRlbXBsYXRlLlxyXG4gKiBUaGlzIHRhc2sgbXVzdCBiZSBydW4gZnJvbSBwZXJlbm5pYWwgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBFeGFtcGxlIHVzYWdlOlxyXG4gKiBncnVudCBjcmVhdGUtc2ltIC0tcmVwbz1jYW5ub24tYmxhc3RlciAtLWF1dGhvcj1cIlNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVwiXHJcbiAqXHJcbiAqIFRoaXMgdGFzayB3aWxsIGF0dGVtcHQgdG8gY29lcmNlIGEgc2ltIHRpdGxlIGZyb20gdGhlIHJlcG9zaXRvcnkgbmFtZS4gRm9yIGV4YW1wbGUsXHJcbiAqICdjYW5ub24tYmxhc3RlcicgYmVjb21lcyAnQ2Fubm9uIEJsYXN0ZXInLiAgSWYgdGhpcyBpcyBub3Qgc3VpdGFibGUsIHRoZW4gdXNlIC0tdGl0bGVcclxuICogdG8gc3BlY2lmeSBhIHRpdGxlLiAgRm9yIGV4YW1wbGU6XHJcbiAqIGdydW50IGNyZWF0ZS1zaW0gLS1yZXBvPWZyYWN0aW9ucy1iYXNpY3MgLS10aXRsZT1cIkZyYWN0aW9uczogQmFzaWNzXCIgLS1hdXRob3I9XCJTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcIlxyXG4gKlxyXG4gKiBGb3IgZGV2ZWxvcG1lbnQgYW5kIGRlYnVnZ2luZywgYWRkIC0tY2xlYW49dHJ1ZSB0byBkZWxldGUgdGhlIHJlcG9zaXRvcnkgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmNvbnN0IF8gPSByZXF1aXJlKCAnbG9kYXNoJyApO1xyXG5jb25zdCBhc3NlcnQgPSByZXF1aXJlKCAnYXNzZXJ0JyApO1xyXG5jb25zdCBleGVjdXRlID0gcmVxdWlyZSggJy4uL2NvbW1vbi9leGVjdXRlJyApO1xyXG5jb25zdCBncnVudCA9IHJlcXVpcmUoICdncnVudCcgKTtcclxuY29uc3QgZ3J1bnRDb21tYW5kID0gcmVxdWlyZSggJy4uL2NvbW1vbi9ncnVudENvbW1hbmQnICk7XHJcbmNvbnN0IG5wbVVwZGF0ZSA9IHJlcXVpcmUoICcuLi9jb21tb24vbnBtVXBkYXRlJyApO1xyXG5jb25zdCBmcyA9IHJlcXVpcmUoICdmcycgKTtcclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVwb1xyXG4gKiBAcGFyYW0ge3N0cmluZ30gYXV0aG9yXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICovXHJcbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgZnVuY3Rpb24oIHJlcG8sIGF1dGhvciwgb3B0aW9ucyApIHtcclxuICBjb25zdCB7XHJcbiAgICB0aXRsZSA9IHRvVGl0bGUoIHJlcG8gKSxcclxuICAgIGNsZWFuID0gZmFsc2VcclxuICB9ID0gb3B0aW9ucyB8fCB7fTtcclxuXHJcbiAgYXNzZXJ0KCB0eXBlb2YgcmVwbyA9PT0gJ3N0cmluZycgJiYgL15bYS16XSsoLVthLXpdKykqJC91LnRlc3QoIHJlcG8gKSwgJ3JlcG8gbmFtZSBzaG91bGQgYmUgY29tcG9zZWQgb2YgbG93ZXItY2FzZSBjaGFyYWN0ZXJzLCBvcHRpb25hbGx5IHdpdGggZGFzaGVzIHVzZWQgYXMgc2VwYXJhdG9ycycgKTtcclxuICBhc3NlcnQoIHR5cGVvZiBhdXRob3IgPT09ICdzdHJpbmcnICk7XHJcbiAgYXNzZXJ0KCB0eXBlb2YgdGl0bGUgPT09ICdzdHJpbmcnICk7XHJcbiAgYXNzZXJ0KCB0eXBlb2YgY2xlYW4gPT09ICdib29sZWFuJyApO1xyXG5cclxuICAvKipcclxuICAgKiBDb2VyY2VzIGEgcmVwb3NpdG9yeSBuYW1lIHRvIGEgc2ltIHRpdGxlLCBlZywgJ3NpbXVsYS1yYXNhJyAtPiAnU2ltdWxhIFJhc2EnXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNpbU5hbWUgLSB0aGUgaW5wdXQgc3RyaW5nIGxpa2UgJ2J1aWxkLWFuLWF0b20nXHJcbiAgICogQHJldHVybnMge3N0cmluZ31cclxuICAgKi9cclxuICBmdW5jdGlvbiB0b1RpdGxlKCBzaW1OYW1lICkge1xyXG4gICAgY29uc3QgdG1wU3RyaW5nID0gc2ltTmFtZS5yZXBsYWNlKCAvLSguKS9nLCAoIG1hdGNoLCBncm91cDEgKSA9PiB7XHJcbiAgICAgIHJldHVybiBgICR7Z3JvdXAxLnRvVXBwZXJDYXNlKCl9YDtcclxuICAgIH0gKTtcclxuICAgIHJldHVybiB0bXBTdHJpbmcuc3Vic3RyaW5nKCAwLCAxICkudG9VcHBlckNhc2UoKSArIHRtcFN0cmluZy5zdWJzdHJpbmcoIDEgKTtcclxuICB9XHJcblxyXG4gIGdydW50LmxvZy53cml0ZWxuKCBgR3JlZXRpbmdzICR7YXV0aG9yfSFgICk7XHJcbiAgZ3J1bnQubG9nLndyaXRlbG4oIGBjcmVhdGluZyBzaW0gd2l0aCByZXBvc2l0b3J5IG5hbWUgJHtyZXBvfWAgKTtcclxuXHJcbiAgLy8gaW5pdGlhbGl6ZSB0aGUgZGlyZWN0b3J5XHJcbiAgY29uc3QgZGVzdGluYXRpb25QYXRoID0gYC4uLyR7cmVwb31gO1xyXG4gIGlmICggZ3J1bnQuZmlsZS5leGlzdHMoIGRlc3RpbmF0aW9uUGF0aCApICkge1xyXG4gICAgaWYgKCBjbGVhbiApIHtcclxuICAgICAgZ3J1bnQubG9nLndyaXRlbG4oIGBDbGVhbmluZyAke2Rlc3RpbmF0aW9uUGF0aH1gICk7XHJcbiAgICAgIGdydW50LmZpbGUuZGVsZXRlKCBkZXN0aW5hdGlvblBhdGgsIHsgZm9yY2U6IHRydWUgfSApOyAvLyBkZWxldGUgd29uJ3Qgb3BlcmF0ZSBvdXRzaWRlIG9mIGN1cnJlbnQgd29ya2luZyBkaXIgdW5sZXNzIGZvcmNlZFxyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGdydW50LmxvZy53cml0ZWxuKCBgV0FSTklORzoke2Rlc3RpbmF0aW9uUGF0aH0gYWxyZWFkeSBleGlzdHMsIG92ZXJ3cml0aW5nYCApO1xyXG4gICAgfVxyXG4gIH1cclxuICBncnVudC5maWxlLm1rZGlyKCBkZXN0aW5hdGlvblBhdGggKTtcclxuXHJcbiAgLy8gQ3JlYXRlIHZhcmlhdGlvbnMgb2YgdGhlIHJlcG9zaXRvcnkgbmFtZVxyXG4gIGNvbnN0IGNvbmZpZ1BhdGggPSByZXBvLnRvVXBwZXJDYXNlKCkucmVwbGFjZSggLy0vZywgJ18nICk7IC8vIGVnLCAnc2ltdWxhLXJhc2EnIC0+ICdTSU1VTEFfUkFTQSdcclxuICBjb25zdCBsb3dlckNhbWVsQ2FzZSA9IF8uY2FtZWxDYXNlKCByZXBvICk7IC8vIGVnLCAnc2ltdWxhLXJhc2EnIC0+ICdzaW11bGFSYXNhJ1xyXG4gIGNvbnN0IHVwcGVyQ2FtZWxDYXNlID0gbG93ZXJDYW1lbENhc2Uuc3Vic3RyaW5nKCAwLCAxICkudG9VcHBlckNhc2UoKSArIGxvd2VyQ2FtZWxDYXNlLnN1YnN0cmluZyggMSApOyAvLyBlZywgJ3NpbXVsYS1yYXNhJyAtPiAnU2ltdWxhUmFzYSdcclxuXHJcbiAgY29uc3QgeWVhclRvZGF5ID0gZ3J1bnQudGVtcGxhdGUudG9kYXkoICd5eXl5JyApO1xyXG5cclxuICAvLyBJdGVyYXRlIG92ZXIgdGhlIGZpbGUgc3lzdGVtIGFuZCBjb3B5IGZpbGVzLCBjaGFuZ2luZyBmaWxlbmFtZXMgYW5kIGNvbnRlbnRzIGFzIHdlIGdvLlxyXG4gIGdydW50LmZpbGUucmVjdXJzZSggJy4uL3NpbXVsYS1yYXNhJywgKCBhYnNwYXRoLCByb290ZGlyLCBzdWJkaXIsIGZpbGVuYW1lICkgPT4ge1xyXG5cclxuICAgIC8vIHNraXAgdGhlc2UgZmlsZXNcclxuICAgIGlmICggYWJzcGF0aC5pbmRleE9mKCAnLi4vc2ltdWxhLXJhc2EvUkVBRE1FLm1kJyApID09PSAwIHx8XHJcbiAgICAgICAgIGFic3BhdGguaW5kZXhPZiggJy4uL3NpbXVsYS1yYXNhL25vZGVfbW9kdWxlcy8nICkgPT09IDAgfHxcclxuICAgICAgICAgYWJzcGF0aC5pbmRleE9mKCAnLi4vc2ltdWxhLXJhc2EvLmdpdC8nICkgPT09IDAgfHxcclxuICAgICAgICAgYWJzcGF0aC5pbmRleE9mKCAnLi4vc2ltdWxhLXJhc2EvYnVpbGQvJyApID09PSAwICkge1xyXG5cclxuICAgICAgLy8gZG8gbm90aGluZ1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGxldCBjb250ZW50cyA9IGdydW50LmZpbGUucmVhZCggYWJzcGF0aCApO1xyXG5cclxuICAgICAgLy8gUmVwbGFjZSB2YXJpYXRpb25zIG9mIHRoZSByZXBvc2l0b3J5IG5hbWVcclxuICAgICAgY29udGVudHMgPSBjb250ZW50cy5yZXBsYWNlKCAvc2ltdWxhLXJhc2EvZywgcmVwbyApO1xyXG4gICAgICBjb250ZW50cyA9IGNvbnRlbnRzLnJlcGxhY2UoIC9TSU1VTEFfUkFTQS9nLCBjb25maWdQYXRoICk7XHJcbiAgICAgIGNvbnRlbnRzID0gY29udGVudHMucmVwbGFjZSggL3NpbXVsYVJhc2EvZywgbG93ZXJDYW1lbENhc2UgKTtcclxuICAgICAgY29udGVudHMgPSBjb250ZW50cy5yZXBsYWNlKCAvU2ltdWxhUmFzYS9nLCB1cHBlckNhbWVsQ2FzZSApO1xyXG5cclxuICAgICAgLy8gUmVwbGFjZSB0aGUgdGl0bGVcclxuICAgICAgY29udGVudHMgPSBjb250ZW50cy5yZXBsYWNlKCAve3tUSVRMRX19L2csIHRpdGxlICk7XHJcblxyXG4gICAgICAvLyBSZXBsYWNlIGF1dGhvclxyXG4gICAgICBjb250ZW50cyA9IGNvbnRlbnRzLnJlcGxhY2UoIC97e0FVVEhPUn19L2csIGF1dGhvciApO1xyXG5cclxuICAgICAgLy8gRml4IGNvcHlyaWdodCBjb21tZW50c1xyXG4gICAgICBjb250ZW50cyA9IGNvbnRlbnRzLnJlcGxhY2UoIC9cXC9cXC8gQ29weXJpZ2h0IFxcZFxcZFxcZFxcZC4qL2csIGAvLyBDb3B5cmlnaHQgJHt5ZWFyVG9kYXl9LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJgICk7XHJcblxyXG4gICAgICAvLyBSZXBsYWNlIG5hbWVzIGluIHRoZSBwYXRoIHdoZXJlIHRoZSBjb250ZW50cyB3aWxsIGJlIHdyaXR0ZW5cclxuICAgICAgbGV0IGNvbnRlbnRzUGF0aCA9IHN1YmRpciA/ICggYCR7ZGVzdGluYXRpb25QYXRofS8ke3N1YmRpcn0vJHtmaWxlbmFtZX1gICkgOiAoIGAke2Rlc3RpbmF0aW9uUGF0aH0vJHtmaWxlbmFtZX1gICk7XHJcbiAgICAgIGNvbnRlbnRzUGF0aCA9IGNvbnRlbnRzUGF0aC5yZXBsYWNlKCAvc2ltdWxhLXJhc2EvLCByZXBvICk7XHJcbiAgICAgIGNvbnRlbnRzUGF0aCA9IGNvbnRlbnRzUGF0aC5yZXBsYWNlKCAvc2ltdWxhUmFzYS8sIGxvd2VyQ2FtZWxDYXNlICk7XHJcbiAgICAgIGNvbnRlbnRzUGF0aCA9IGNvbnRlbnRzUGF0aC5yZXBsYWNlKCAvU2ltdWxhUmFzYS8sIHVwcGVyQ2FtZWxDYXNlICk7XHJcblxyXG4gICAgICAvLyBXcml0ZSB0aGUgZmlsZVxyXG4gICAgICBncnVudC5maWxlLndyaXRlKCBjb250ZW50c1BhdGgsIGNvbnRlbnRzICk7XHJcbiAgICAgIGdydW50LmxvZy53cml0ZWxuKCAnd3JvdGUnLCBjb250ZW50c1BhdGggKTtcclxuICAgIH1cclxuICB9ICk7XHJcblxyXG4gIC8vIERlbGV0ZSByZWFkbWVDcmVhdGVkTWFudWFsbHkgZnJvbSB0ZW1wbGF0ZSwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9wZXJlbm5pYWwvaXNzdWVzLzE5OVxyXG4gIGNvbnN0IHBhY2thZ2VQYXRoID0gYCR7ZGVzdGluYXRpb25QYXRofS9wYWNrYWdlLmpzb25gO1xyXG4gIGNvbnN0IHNpbVBhY2thZ2VKU09OID0gZ3J1bnQuZmlsZS5yZWFkSlNPTiggcGFja2FnZVBhdGggKTtcclxuICBpZiAoIHNpbVBhY2thZ2VKU09OLnBoZXQgJiYgc2ltUGFja2FnZUpTT04ucGhldC5oYXNPd25Qcm9wZXJ0eSggJ3JlYWRtZUNyZWF0ZWRNYW51YWxseScgKSApIHtcclxuICAgIGRlbGV0ZSBzaW1QYWNrYWdlSlNPTi5waGV0LnJlYWRtZUNyZWF0ZWRNYW51YWxseTtcclxuICB9XHJcbiAgZnMud3JpdGVGaWxlU3luYyggcGFja2FnZVBhdGgsIEpTT04uc3RyaW5naWZ5KCBzaW1QYWNrYWdlSlNPTiwgbnVsbCwgMiApICk7XHJcblxyXG4gIGF3YWl0IG5wbVVwZGF0ZSggcmVwbyApO1xyXG4gIGF3YWl0IGV4ZWN1dGUoIGdydW50Q29tbWFuZCwgWyAndW5wdWJsaXNoZWQtUkVBRE1FJyBdLCBgLi4vJHtyZXBvfWAgKTtcclxufTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE1BQU1BLENBQUMsR0FBR0MsT0FBTyxDQUFFLFFBQVMsQ0FBQztBQUM3QixNQUFNQyxNQUFNLEdBQUdELE9BQU8sQ0FBRSxRQUFTLENBQUM7QUFDbEMsTUFBTUUsT0FBTyxHQUFHRixPQUFPLENBQUUsbUJBQW9CLENBQUM7QUFDOUMsTUFBTUcsS0FBSyxHQUFHSCxPQUFPLENBQUUsT0FBUSxDQUFDO0FBQ2hDLE1BQU1JLFlBQVksR0FBR0osT0FBTyxDQUFFLHdCQUF5QixDQUFDO0FBQ3hELE1BQU1LLFNBQVMsR0FBR0wsT0FBTyxDQUFFLHFCQUFzQixDQUFDO0FBQ2xELE1BQU1NLEVBQUUsR0FBR04sT0FBTyxDQUFFLElBQUssQ0FBQzs7QUFFMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBTyxNQUFNLENBQUNDLE9BQU8sR0FBRyxnQkFBZ0JDLElBQUksRUFBRUMsTUFBTSxFQUFFQyxPQUFPLEVBQUc7RUFDdkQsTUFBTTtJQUNKQyxLQUFLLEdBQUdDLE9BQU8sQ0FBRUosSUFBSyxDQUFDO0lBQ3ZCSyxLQUFLLEdBQUc7RUFDVixDQUFDLEdBQUdILE9BQU8sSUFBSSxDQUFDLENBQUM7RUFFakJWLE1BQU0sQ0FBRSxPQUFPUSxJQUFJLEtBQUssUUFBUSxJQUFJLHFCQUFxQixDQUFDTSxJQUFJLENBQUVOLElBQUssQ0FBQyxFQUFFLGtHQUFtRyxDQUFDO0VBQzVLUixNQUFNLENBQUUsT0FBT1MsTUFBTSxLQUFLLFFB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