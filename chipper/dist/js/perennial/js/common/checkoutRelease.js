// Copyright 2017, University of Colorado Boulder

/**
 * Checks out the latest deployed production release branch (and dependencies) for a repository.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

const checkoutTarget = require('./checkoutTarget');
const simMetadata = require('./simMetadata');
const assert = require('assert');
const winston = require('winston');

/**
 * Checks out the latest release branch (and dependencies) for a repository.
 * @public
 *
 * @param {string} repo - The repository name
 * @param {boolean} includeNpmUpdate
 * @returns {Promise.<Array.<string>>} - Resolves with checkedOutRepos
 */
module.exports = async function (repo, includeNpmUpdate) {
  winston.info(`checking out release for ${repo}`);
  const data = await simMetadata({
    simulation: repo
  });
  assert(data.projects.length === 1, 'Metadata request should only return 1 simulation result');
  const branch = `${data.projects[0].version.major}.${data.projects[0].version.minor}`;
  return checkoutTarget(repo, branch, includeNpmUpdate);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjaGVja291dFRhcmdldCIsInJlcXVpcmUiLCJzaW1NZXRhZGF0YSIsImFzc2VydCIsIndpbnN0b24iLCJtb2R1bGUiLCJleHBvcnRzIiwicmVwbyIsImluY2x1ZGVOcG1VcGRhdGUiLCJpbmZvIiwiZGF0YSIsInNpbXVsYXRpb24iLCJwcm9qZWN0cyIsImxlbmd0aCIsImJyYW5jaCIsInZlcnNpb24iLCJtYWpvciIsIm1pbm9yIl0sInNvdXJjZXMiOlsiY2hlY2tvdXRSZWxlYXNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBDaGVja3Mgb3V0IHRoZSBsYXRlc3QgZGVwbG95ZWQgcHJvZHVjdGlvbiByZWxlYXNlIGJyYW5jaCAoYW5kIGRlcGVuZGVuY2llcykgZm9yIGEgcmVwb3NpdG9yeS5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmNvbnN0IGNoZWNrb3V0VGFyZ2V0ID0gcmVxdWlyZSggJy4vY2hlY2tvdXRUYXJnZXQnICk7XHJcbmNvbnN0IHNpbU1ldGFkYXRhID0gcmVxdWlyZSggJy4vc2ltTWV0YWRhdGEnICk7XHJcbmNvbnN0IGFzc2VydCA9IHJlcXVpcmUoICdhc3NlcnQnICk7XHJcbmNvbnN0IHdpbnN0b24gPSByZXF1aXJlKCAnd2luc3RvbicgKTtcclxuXHJcbi8qKlxyXG4gKiBDaGVja3Mgb3V0IHRoZSBsYXRlc3QgcmVsZWFzZSBicmFuY2ggKGFuZCBkZXBlbmRlbmNpZXMpIGZvciBhIHJlcG9zaXRvcnkuXHJcbiAqIEBwdWJsaWNcclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHJlcG8gLSBUaGUgcmVwb3NpdG9yeSBuYW1lXHJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gaW5jbHVkZU5wbVVwZGF0ZVxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZS48QXJyYXkuPHN0cmluZz4+fSAtIFJlc29sdmVzIHdpdGggY2hlY2tlZE91dFJlcG9zXHJcbiAqL1xyXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIGZ1bmN0aW9uKCByZXBvLCBpbmNsdWRlTnBtVXBkYXRlICkge1xyXG4gIHdpbnN0b24uaW5mbyggYGNoZWNraW5nIG91dCByZWxlYXNlIGZvciAke3JlcG99YCApO1xyXG5cclxuICBjb25zdCBkYXRhID0gYXdhaXQgc2ltTWV0YWRhdGEoIHtcclxuICAgIHNpbXVsYXRpb246IHJlcG9cclxuICB9ICk7XHJcblxyXG4gIGFzc2VydCggZGF0YS5wcm9qZWN0cy5sZW5ndGggPT09IDEsICdNZXRhZGF0YSByZXF1ZXN0IHNob3VsZCBvbmx5IHJldHVybiAxIHNpbXVsYXRpb24gcmVzdWx0JyApO1xyXG5cclxuICBjb25zdCBicmFuY2ggPSBgJHtkYXRhLnByb2plY3RzWyAwIF0udmVyc2lvbi5tYWpvcn0uJHtkYXRhLnByb2plY3RzWyAwIF0udmVyc2lvbi5taW5vcn1gO1xyXG5cclxuICByZXR1cm4gY2hlY2tvdXRUYXJnZXQoIHJlcG8sIGJyYW5jaCwgaW5jbHVkZU5wbVVwZGF0ZSApO1xyXG59O1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsTUFBTUEsY0FBYyxHQUFHQyxPQUFPLENBQUUsa0JBQW1CLENBQUM7QUFDcEQsTUFBTUMsV0FBVyxHQUFHRCxPQUFPLENBQUUsZUFBZ0IsQ0FBQztBQUM5QyxNQUFNRSxNQUFNLEdBQUdGLE9BQU8sQ0FBRSxRQUFTLENBQUM7QUFDbEMsTUFBTUcsT0FBTyxHQUFHSCxPQUFPLENBQUUsU0FBVSxDQUFDOztBQUVwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FJLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHLGdCQUFnQkMsSUFBSSxFQUFFQyxnQkFBZ0IsRUFBRztFQUN4REosT0FBTyxDQUFDSyxJQUFJLENBQUcsNEJBQTJCRixJQUFLLEVBQUUsQ0FBQztFQUVsRCxNQUFNRyxJQUFJLEdBQUcsTUFBTVIsV0FBVyxDQUFFO0lBQzlCUyxVQUFVLEVBQUVKO0VBQ2QsQ0FBRSxDQUFDO0VBRUhKLE1BQU0sQ0FBRU8sSUFBSSxDQUFDRSxRQUFRLENBQUNDLE1BQU0sS0FBSyxDQUFDLEVBQUUseURBQTBELENBQUM7RUFFL0YsTUFBTUMsTUFBTSxHQUFJLEdBQUVKLElBQUksQ0FBQ0UsUUFBUSxDQUFFLENBQUMsQ0FBRSxDQUFDRyxPQUFPLENBQUNDLEtBQU0sSUFBR04sSUFBSSxDQUFDRSxRQUFRLENBQUUsQ0FBQyxDQUFFLENBQUNHLE9BQU8sQ0FBQ0UsS0FBTSxFQUFDO0VBRXhGLE9BQU9qQixjQUFjLENBQUVPLElBQUksRUFBRU8sTUFBTSxFQUFFTixnQkFBaUIsQ0FBQztBQUN6RCxDQUFDIn0=