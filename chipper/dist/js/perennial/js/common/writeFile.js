// Copyright 2017-2018, University of Colorado Boulder

const fs = require('graceful-fs'); // eslint-disable-line require-statement-match
const winston = require('winston');
module.exports = async function (filepath, contents) {
  return new Promise((resolve, reject) => {
    let tries = 0;
    winston.info(`Writing file to path: ${filepath}`);
    const writeFileInterval = setInterval(() => {
      fs.writeFile(filepath, contents, err => {
        if (err) {
          tries += 1;
          if (err.code === 'ENOENT') {
            winston.error('Write operation failed. The target directory did not exist.');
            reject(err);
          } else if (tries >= 10) {
            winston.error(`Write operation failed ${tries} time(s). I'm giving up, all hope is lost.`);
            clearInterval(writeFileInterval);
            reject(err);
          } else {
            winston.error(`Write failed with error: ${JSON.stringify(err)}, trying again`);
          }
        } else {
          winston.debug('Write success.');
          clearInterval(writeFileInterval);
          resolve();
        }
      });
    }, 1000);
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJ3aW5zdG9uIiwibW9kdWxlIiwiZXhwb3J0cyIsImZpbGVwYXRoIiwiY29udGVudHMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInRyaWVzIiwiaW5mbyIsIndyaXRlRmlsZUludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJ3cml0ZUZpbGUiLCJlcnIiLCJjb2RlIiwiZXJyb3IiLCJjbGVhckludGVydmFsIiwiSlNPTiIsInN0cmluZ2lmeSIsImRlYnVnIl0sInNvdXJjZXMiOlsid3JpdGVGaWxlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMTgsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuY29uc3QgZnMgPSByZXF1aXJlKCAnZ3JhY2VmdWwtZnMnICk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1zdGF0ZW1lbnQtbWF0Y2hcclxuY29uc3Qgd2luc3RvbiA9IHJlcXVpcmUoICd3aW5zdG9uJyApO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyBmdW5jdGlvbiggZmlsZXBhdGgsIGNvbnRlbnRzICkge1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZSggKCByZXNvbHZlLCByZWplY3QgKSA9PiB7XHJcbiAgICBsZXQgdHJpZXMgPSAwO1xyXG4gICAgd2luc3Rvbi5pbmZvKCBgV3JpdGluZyBmaWxlIHRvIHBhdGg6ICR7ZmlsZXBhdGh9YCApO1xyXG4gICAgY29uc3Qgd3JpdGVGaWxlSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCggKCkgPT4ge1xyXG4gICAgICBmcy53cml0ZUZpbGUoIGZpbGVwYXRoLCBjb250ZW50cywgZXJyID0+IHtcclxuICAgICAgICBpZiAoIGVyciApIHtcclxuICAgICAgICAgIHRyaWVzICs9IDE7XHJcbiAgICAgICAgICBpZiAoIGVyci5jb2RlID09PSAnRU5PRU5UJyApIHtcclxuICAgICAgICAgICAgd2luc3Rvbi5lcnJvciggJ1dyaXRlIG9wZXJhdGlvbiBmYWlsZWQuIFRoZSB0YXJnZXQgZGlyZWN0b3J5IGRpZCBub3QgZXhpc3QuJyApO1xyXG4gICAgICAgICAgICByZWplY3QoIGVyciApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSBpZiAoIHRyaWVzID49IDEwICkge1xyXG4gICAgICAgICAgICB3aW5zdG9uLmVycm9yKCBgV3JpdGUgb3BlcmF0aW9uIGZhaWxlZCAke3RyaWVzfSB0aW1lKHMpLiBJJ20gZ2l2aW5nIHVwLCBhbGwgaG9wZSBpcyBsb3N0LmAgKTtcclxuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCggd3JpdGVGaWxlSW50ZXJ2YWwgKTtcclxuICAgICAgICAgICAgcmVqZWN0KCBlcnIgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB3aW5zdG9uLmVycm9yKCBgV3JpdGUgZmFpbGVkIHdpdGggZXJyb3I6ICR7SlNPTi5zdHJpbmdpZnkoIGVyciApfSwgdHJ5aW5nIGFnYWluYCApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHdpbnN0b24uZGVidWcoICdXcml0ZSBzdWNjZXNzLicgKTtcclxuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoIHdyaXRlRmlsZUludGVydmFsICk7XHJcbiAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgICB9LCAxMDAwICk7XHJcbiAgfSApO1xyXG59OyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTUEsRUFBRSxHQUFHQyxPQUFPLENBQUUsYUFBYyxDQUFDLENBQUMsQ0FBQztBQUNyQyxNQUFNQyxPQUFPLEdBQUdELE9BQU8sQ0FBRSxTQUFVLENBQUM7QUFFcENFLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHLGdCQUFnQkMsUUFBUSxFQUFFQyxRQUFRLEVBQUc7RUFDcEQsT0FBTyxJQUFJQyxPQUFPLENBQUUsQ0FBRUMsT0FBTyxFQUFFQyxNQUFNLEtBQU07SUFDekMsSUFBSUMsS0FBSyxHQUFHLENBQUM7SUFDYlIsT0FBTyxDQUFDUyxJQUFJLENBQUcseUJBQXdCTixRQUFTLEVBQUUsQ0FBQztJQUNuRCxNQUFNTyxpQkFBaUIsR0FBR0MsV0FBVyxDQUFFLE1BQU07TUFDM0NiLEVBQUUsQ0FBQ2MsU0FBUyxDQUFFVCxRQUFRLEVBQUVDLFFBQVEsRUFBRVMsR0FBRyxJQUFJO1FBQ3ZDLElBQUtBLEdBQUcsRUFBRztVQUNUTCxLQUFLLElBQUksQ0FBQztVQUNWLElBQUtLLEdBQUcsQ0FBQ0MsSUFBSSxLQUFLLFFBQVEsRUFBRztZQUMzQmQsT0FBTyxDQUFDZSxLQUFLLENBQUUsNkRBQThELENBQUM7WUFDOUVSLE1BQU0sQ0FBRU0sR0FBSSxDQUFDO1VBQ2YsQ0FBQyxNQUNJLElBQUtMLEtBQUssSUFBSSxFQUFFLEVBQUc7WUFDdEJSLE9BQU8sQ0FBQ2UsS0FBSyxDQUFHLDBCQUF5QlAsS0FBTSw0Q0FBNEMsQ0FBQztZQUM1RlEsYUFBYSxDQUFFTixpQkFBa0IsQ0FBQztZQUNsQ0gsTUFBTSxDQUFFTSxHQUFJLENBQUM7VUFDZixDQUFDLE1BQ0k7WUFDSGIsT0FBTyxDQUFDZSxLQUFLLENBQUcsNEJBQTJCRSxJQUFJLENBQUNDLFNBQVMsQ0FBRUwsR0FBSSxDQUFFLGdCQUFnQixDQUFDO1VBQ3BGO1FBQ0YsQ0FBQyxNQUNJO1VBQ0hiLE9BQU8sQ0FBQ21CLEtBQUssQ0FBRSxnQkFBaUIsQ0FBQztVQUNqQ0gsYUFBYSxDQUFFTixpQkFBa0IsQ0FBQztVQUNsQ0osT0FBTyxDQUFDLENBQUM7UUFDWDtNQUNGLENBQUUsQ0FBQztJQUNMLENBQUMsRUFBRSxJQUFLLENBQUM7RUFDWCxDQUFFLENBQUM7QUFDTCxDQUFDIn0=