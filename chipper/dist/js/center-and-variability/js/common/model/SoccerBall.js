// Copyright 2022-2023, University of Colorado Boulder

/**
 * Base class for a manipulable data point which could be a soccer ball or, in the lab screen, a colored sphere.
 *
 * @author Chris Klusendorf (PhET Interactive Simulations)
 * @author Sam Reid (PhET Interactive Simulations)
 */

import centerAndVariability from '../../centerAndVariability.js';
import Vector2Property from '../../../../dot/js/Vector2Property.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import optionize from '../../../../phet-core/js/optionize.js';
import CAVObjectType from './CAVObjectType.js';
import NumberIO from '../../../../tandem/js/types/NumberIO.js';
import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import CAVConstants from '../CAVConstants.js';
import Property from '../../../../axon/js/Property.js';
import NullableIO from '../../../../tandem/js/types/NullableIO.js';
import Emitter from '../../../../axon/js/Emitter.js';
import { AnimationMode } from './AnimationMode.js';
import EnumerationProperty from '../../../../axon/js/EnumerationProperty.js';
export default class SoccerBall {
  // Continuous value for the drag listener. When dragging, the object snaps to each tickmark

  // Continuous position during animation. After landing, it's discrete.

  // Where the object is animating to, or null if not yet animating

  // The value that participates in the data set.

  dragStartedEmitter = new Emitter();
  animation = null;
  soccerPlayer = null;
  constructor(providedOptions) {
    const options = optionize()({
      position: Vector2.ZERO,
      velocity: Vector2.ZERO,
      value: null,
      isFirstObject: false
    }, providedOptions);
    this.isFirstObject = options.isFirstObject;
    this.positionProperty = new Vector2Property(options.position, {
      tandem: options.tandem.createTandem('positionProperty')
    });
    this.velocityProperty = new Vector2Property(options.velocity, {
      tandem: options.tandem.createTandem('velocityProperty')
    });
    this.animationModeProperty = new EnumerationProperty(AnimationMode.NONE, {
      tandem: options.tandem.createTandem('animationModeProperty')
    });
    this.dragPositionProperty = new Vector2Property(options.position);
    this.valueProperty = new Property(options.value, {
      tandem: options.tandem.createTandem('valueProperty'),
      phetioValueType: NullableIO(NumberIO)
    });
    this.isMedianObjectProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('isMedianObjectProperty')
    });
    this.isQ1ObjectProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('isQ1ObjectProperty')
    });
    this.isQ3ObjectProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('isQ3ObjectProperty')
    });
    this.isShowingAnimationHighlightProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('isShowingAnimationHighlightProperty')
    });
    this.isActiveProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('isActiveProperty')
    });
    this.targetXProperty = new Property(null, {
      tandem: options.tandem.createTandem('targetXProperty'),
      phetioValueType: NullableIO(NumberIO)
    });
  }
  step(dt) {
    if (this.animationModeProperty.value === AnimationMode.FLYING) {
      assert && assert(this.targetXProperty.value !== null, 'targetXProperty.value should be non-null when animating');
      const xCoordinates = rk4(this.positionProperty.value.x, this.velocityProperty.value.x, 0, dt);
      const yCoordinates = rk4(this.positionProperty.value.y, this.velocityProperty.value.y, CAVConstants.GRAVITY, dt);
      let x = xCoordinates[0];
      let y = yCoordinates[0];
      this.velocityProperty.value.x = xCoordinates[1];
      this.velocityProperty.value.y = yCoordinates[1];
      let landed = false;
      if (y <= CAVObjectType.SOCCER_BALL.radius) {
        x = this.targetXProperty.value;
        y = CAVObjectType.SOCCER_BALL.radius;
        landed = true;
        this.valueProperty.value = this.targetXProperty.value;
      }
      this.positionProperty.value = new Vector2(x, y);
      if (landed) {
        this.animationModeProperty.value = AnimationMode.NONE;
      }
    }
  }
  reset() {
    this.positionProperty.reset();
    this.velocityProperty.reset();
    this.animationModeProperty.reset();
    this.valueProperty.reset();
    this.dragPositionProperty.reset();
    this.isMedianObjectProperty.reset();
    this.isQ1ObjectProperty.reset();
    this.isQ3ObjectProperty.reset();
    this.isShowingAnimationHighlightProperty.reset();
    this.isActiveProperty.reset();
    this.targetXProperty.value = null;
    this.soccerPlayer = null;
  }
}

/**
 * 4th order Runge Kutte integration under constant acceleration.  We use this more sophisticated algorithm instead of
 * x=x0+v0t+1/2at^2 because that looked too much like the ball ended a little to the left of the target location,
 * and jumped slightly to the side.
 * See https://mtdevans.com/2013/05/fourth-order-runge-kutta-algorithm-in-javascript-with-demo/
 */
const rk4 = (x, v, a, dt) => {
  const v2 = v + a * dt / 2;
  const v4 = v + a * dt;
  const xResult = x + dt * (v + 4 * v2 + v4) / 6;
  const vResult = v + a * dt;
  return [xResult, vResult];
};
centerAndVariability.register('SoccerBall', SoccerBall);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjZW50ZXJBbmRWYXJpYWJpbGl0eSIsIlZlY3RvcjJQcm9wZXJ0eSIsIlZlY3RvcjIiLCJvcHRpb25pemUiLCJDQVZPYmplY3RUeXBlIiwiTnVtYmVySU8iLCJCb29sZWFuUHJvcGVydHkiLCJDQVZDb25zdGFudHMiLCJQcm9wZXJ0eSIsIk51bGxhYmxlSU8iLCJFbWl0dGVyIiwiQW5pbWF0aW9uTW9kZSIsIkVudW1lcmF0aW9uUHJvcGVydHkiLCJTb2NjZXJCYWxsIiwiZHJhZ1N0YXJ0ZWRFbWl0dGVyIiwiYW5pbWF0aW9uIiwic29jY2VyUGxheWVyIiwiY29uc3RydWN0b3IiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwicG9zaXRpb24iLCJaRVJPIiwidmVsb2NpdHkiLCJ2YWx1ZSIsImlzRmlyc3RPYmplY3QiLCJwb3NpdGlvblByb3BlcnR5IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwidmVsb2NpdHlQcm9wZXJ0eSIsImFuaW1hdGlvbk1vZGVQcm9wZXJ0eSIsIk5PTkUiLCJkcmFnUG9zaXRpb25Qcm9wZXJ0eSIsInZhbHVlUHJvcGVydHkiLCJwaGV0aW9WYWx1ZVR5cGUiLCJpc01lZGlhbk9iamVjdFByb3BlcnR5IiwiaXNRMU9iamVjdFByb3BlcnR5IiwiaXNRM09iamVjdFByb3BlcnR5IiwiaXNTaG93aW5nQW5pbWF0aW9uSGlnaGxpZ2h0UHJvcGVydHkiLCJpc0FjdGl2ZVByb3BlcnR5IiwidGFyZ2V0WFByb3BlcnR5Iiwic3RlcCIsImR0IiwiRkxZSU5HIiwiYXNzZXJ0IiwieENvb3JkaW5hdGVzIiwicms0IiwieCIsInlDb29yZGluYXRlcyIsInkiLCJHUkFWSVRZIiwibGFuZGVkIiwiU09DQ0VSX0JBTEwiLCJyYWRpdXMiLCJyZXNldCIsInYiLCJhIiwidjIiLCJ2NCIsInhSZXN1bHQiLCJ2UmVzdWx0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJTb2NjZXJCYWxsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIyLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEJhc2UgY2xhc3MgZm9yIGEgbWFuaXB1bGFibGUgZGF0YSBwb2ludCB3aGljaCBjb3VsZCBiZSBhIHNvY2NlciBiYWxsIG9yLCBpbiB0aGUgbGFiIHNjcmVlbiwgYSBjb2xvcmVkIHNwaGVyZS5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBLbHVzZW5kb3JmIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBBbmltYXRpb24gZnJvbSAnLi4vLi4vLi4vLi4vdHdpeHQvanMvQW5pbWF0aW9uLmpzJztcclxuaW1wb3J0IGNlbnRlckFuZFZhcmlhYmlsaXR5IGZyb20gJy4uLy4uL2NlbnRlckFuZFZhcmlhYmlsaXR5LmpzJztcclxuaW1wb3J0IFZlY3RvcjJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMlByb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgUGhldGlvT2JqZWN0T3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9QaGV0aW9PYmplY3QuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBDQVZPYmplY3RUeXBlIGZyb20gJy4vQ0FWT2JqZWN0VHlwZS5qcyc7XHJcbmltcG9ydCBOdW1iZXJJTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvTnVtYmVySU8uanMnO1xyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IENBVkNvbnN0YW50cyBmcm9tICcuLi9DQVZDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdWxsYWJsZUlPIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdWxsYWJsZUlPLmpzJztcclxuaW1wb3J0IEVtaXR0ZXIgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbWl0dGVyLmpzJztcclxuaW1wb3J0IHsgQW5pbWF0aW9uTW9kZSB9IGZyb20gJy4vQW5pbWF0aW9uTW9kZS5qcyc7XHJcbmltcG9ydCBFbnVtZXJhdGlvblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRW51bWVyYXRpb25Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQaWNrUmVxdWlyZWQgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1BpY2tSZXF1aXJlZC5qcyc7XHJcbmltcG9ydCBURW1pdHRlciBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RFbWl0dGVyLmpzJztcclxuaW1wb3J0IFNvY2NlclBsYXllciBmcm9tICcuL1NvY2NlclBsYXllci5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIHBvc2l0aW9uPzogVmVjdG9yMjtcclxuICB2ZWxvY2l0eT86IFZlY3RvcjI7XHJcbiAgdmFsdWU/OiBudW1iZXIgfCBudWxsO1xyXG4gIGlzRmlyc3RPYmplY3Q/OiBib29sZWFuO1xyXG59O1xyXG5leHBvcnQgdHlwZSBDQVZPYmplY3RPcHRpb25zID1cclxuICBTZWxmT3B0aW9uc1xyXG4gICYgUGhldGlvT2JqZWN0T3B0aW9uc1xyXG4gICYgUGlja1JlcXVpcmVkPFBoZXRpb09iamVjdE9wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNvY2NlckJhbGwge1xyXG5cclxuICAvLyBDb250aW51b3VzIHZhbHVlIGZvciB0aGUgZHJhZyBsaXN0ZW5lci4gV2hlbiBkcmFnZ2luZywgdGhlIG9iamVjdCBzbmFwcyB0byBlYWNoIHRpY2ttYXJrXHJcbiAgcHVibGljIHJlYWRvbmx5IGRyYWdQb3NpdGlvblByb3BlcnR5OiBWZWN0b3IyUHJvcGVydHk7XHJcblxyXG4gIC8vIENvbnRpbnVvdXMgcG9zaXRpb24gZHVyaW5nIGFuaW1hdGlvbi4gQWZ0ZXIgbGFuZGluZywgaXQncyBkaXNjcmV0ZS5cclxuICBwdWJsaWMgcmVhZG9ubHkgcG9zaXRpb25Qcm9wZXJ0eTogVmVjdG9yMlByb3BlcnR5O1xyXG4gIHB1YmxpYyByZWFkb25seSB2ZWxvY2l0eVByb3BlcnR5OiBWZWN0b3IyUHJvcGVydHk7XHJcbiAgcHVibGljIHJlYWRvbmx5IGFuaW1hdGlvbk1vZGVQcm9wZXJ0eTogUHJvcGVydHk8QW5pbWF0aW9uTW9kZT47XHJcbiAgcHVibGljIHJlYWRvbmx5IGlzTWVkaWFuT2JqZWN0UHJvcGVydHk6IEJvb2xlYW5Qcm9wZXJ0eTtcclxuICBwdWJsaWMgcmVhZG9ubHkgaXNRMU9iamVjdFByb3BlcnR5OiBCb29sZWFuUHJvcGVydHk7XHJcbiAgcHVibGljIHJlYWRvbmx5IGlzUTNPYmplY3RQcm9wZXJ0eTogQm9vbGVhblByb3BlcnR5O1xyXG4gIHB1YmxpYyByZWFkb25seSBpc1Nob3dpbmdBbmltYXRpb25IaWdobGlnaHRQcm9wZXJ0eTogQm9vbGVhblByb3BlcnR5O1xyXG4gIHB1YmxpYyByZWFkb25seSBpc0ZpcnN0T2JqZWN0OiBib29sZWFuO1xyXG5cclxuICAvLyBXaGVyZSB0aGUgb2JqZWN0IGlzIGFuaW1hdGluZyB0bywgb3IgbnVsbCBpZiBub3QgeWV0IGFuaW1hdGluZ1xyXG4gIHB1YmxpYyB0YXJnZXRYUHJvcGVydHk6IFByb3BlcnR5PG51bWJlciB8IG51bGw+O1xyXG5cclxuICAvLyBUaGUgdmFsdWUgdGhhdCBwYXJ0aWNpcGF0ZXMgaW4gdGhlIGRhdGEgc2V0LlxyXG4gIHB1YmxpYyB2YWx1ZVByb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXIgfCBudWxsPjtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IGRyYWdTdGFydGVkRW1pdHRlcjogVEVtaXR0ZXIgPSBuZXcgRW1pdHRlcigpO1xyXG4gIHB1YmxpYyBhbmltYXRpb246IEFuaW1hdGlvbiB8IG51bGwgPSBudWxsO1xyXG4gIHB1YmxpYyByZWFkb25seSBpc0FjdGl2ZVByb3BlcnR5OiBCb29sZWFuUHJvcGVydHk7XHJcbiAgcHVibGljIHNvY2NlclBsYXllcjogU29jY2VyUGxheWVyIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcHJvdmlkZWRPcHRpb25zOiBDQVZPYmplY3RPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8Q0FWT2JqZWN0T3B0aW9ucywgU2VsZk9wdGlvbnMsIFBoZXRpb09iamVjdE9wdGlvbnM+KCkoIHtcclxuICAgICAgcG9zaXRpb246IFZlY3RvcjIuWkVSTyxcclxuICAgICAgdmVsb2NpdHk6IFZlY3RvcjIuWkVSTyxcclxuICAgICAgdmFsdWU6IG51bGwsXHJcbiAgICAgIGlzRmlyc3RPYmplY3Q6IGZhbHNlXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLmlzRmlyc3RPYmplY3QgPSBvcHRpb25zLmlzRmlyc3RPYmplY3Q7XHJcblxyXG4gICAgdGhpcy5wb3NpdGlvblByb3BlcnR5ID0gbmV3IFZlY3RvcjJQcm9wZXJ0eSggb3B0aW9ucy5wb3NpdGlvbiwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Bvc2l0aW9uUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMudmVsb2NpdHlQcm9wZXJ0eSA9IG5ldyBWZWN0b3IyUHJvcGVydHkoIG9wdGlvbnMudmVsb2NpdHksIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICd2ZWxvY2l0eVByb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFuaW1hdGlvbk1vZGVQcm9wZXJ0eSA9IG5ldyBFbnVtZXJhdGlvblByb3BlcnR5KCBBbmltYXRpb25Nb2RlLk5PTkUsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdhbmltYXRpb25Nb2RlUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuZHJhZ1Bvc2l0aW9uUHJvcGVydHkgPSBuZXcgVmVjdG9yMlByb3BlcnR5KCBvcHRpb25zLnBvc2l0aW9uICk7XHJcbiAgICB0aGlzLnZhbHVlUHJvcGVydHkgPSBuZXcgUHJvcGVydHk8bnVtYmVyIHwgbnVsbD4oIG9wdGlvbnMudmFsdWUsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICd2YWx1ZVByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9WYWx1ZVR5cGU6IE51bGxhYmxlSU8oIE51bWJlcklPIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuaXNNZWRpYW5PYmplY3RQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnaXNNZWRpYW5PYmplY3RQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5pc1ExT2JqZWN0UHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2lzUTFPYmplY3RQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5pc1EzT2JqZWN0UHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2lzUTNPYmplY3RQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5pc1Nob3dpbmdBbmltYXRpb25IaWdobGlnaHRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnaXNTaG93aW5nQW5pbWF0aW9uSGlnaGxpZ2h0UHJvcGVydHknIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuaXNBY3RpdmVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnaXNBY3RpdmVQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMudGFyZ2V0WFByb3BlcnR5ID0gbmV3IFByb3BlcnR5PG51bWJlciB8IG51bGw+KCBudWxsLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndGFyZ2V0WFByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9WYWx1ZVR5cGU6IE51bGxhYmxlSU8oIE51bWJlcklPIClcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGVwKCBkdDogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgaWYgKCB0aGlzLmFuaW1hdGlvbk1vZGVQcm9wZXJ0eS52YWx1ZSA9PT0gQW5pbWF0aW9uTW9kZS5GTFlJTkcgKSB7XHJcblxyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLnRhcmdldFhQcm9wZXJ0eS52YWx1ZSAhPT0gbnVsbCwgJ3RhcmdldFhQcm9wZXJ0eS52YWx1ZSBzaG91bGQgYmUgbm9uLW51bGwgd2hlbiBhbmltYXRpbmcnICk7XHJcblxyXG4gICAgICBjb25zdCB4Q29vcmRpbmF0ZXMgPSByazQoIHRoaXMucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS54LCB0aGlzLnZlbG9jaXR5UHJvcGVydHkudmFsdWUueCwgMCwgZHQgKTtcclxuICAgICAgY29uc3QgeUNvb3JkaW5hdGVzID0gcms0KCB0aGlzLnBvc2l0aW9uUHJvcGVydHkudmFsdWUueSwgdGhpcy52ZWxvY2l0eVByb3BlcnR5LnZhbHVlLnksIENBVkNvbnN0YW50cy5HUkFWSVRZLCBkdCApO1xyXG5cclxuICAgICAgbGV0IHggPSB4Q29vcmRpbmF0ZXNbIDAgXTtcclxuICAgICAgbGV0IHkgPSB5Q29vcmRpbmF0ZXNbIDAgXTtcclxuXHJcbiAgICAgIHRoaXMudmVsb2NpdHlQcm9wZXJ0eS52YWx1ZS54ID0geENvb3JkaW5hdGVzWyAxIF07XHJcbiAgICAgIHRoaXMudmVsb2NpdHlQcm9wZXJ0eS52YWx1ZS55ID0geUNvb3JkaW5hdGVzWyAxIF07XHJcblxyXG4gICAgICBsZXQgbGFuZGVkID0gZmFsc2U7XHJcblxyXG4gICAgICBpZiAoIHkgPD0gQ0FWT2JqZWN0VHlwZS5TT0NDRVJfQkFMTC5yYWRpdXMgKSB7XHJcbiAgICAgICAgeCA9IHRoaXMudGFyZ2V0WFByb3BlcnR5LnZhbHVlITtcclxuICAgICAgICB5ID0gQ0FWT2JqZWN0VHlwZS5TT0NDRVJfQkFMTC5yYWRpdXM7XHJcbiAgICAgICAgbGFuZGVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnZhbHVlUHJvcGVydHkudmFsdWUgPSB0aGlzLnRhcmdldFhQcm9wZXJ0eS52YWx1ZSE7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZSA9IG5ldyBWZWN0b3IyKCB4LCB5ICk7XHJcblxyXG4gICAgICBpZiAoIGxhbmRlZCApIHtcclxuICAgICAgICB0aGlzLmFuaW1hdGlvbk1vZGVQcm9wZXJ0eS52YWx1ZSA9IEFuaW1hdGlvbk1vZGUuTk9ORTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5wb3NpdGlvblByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnZlbG9jaXR5UHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuYW5pbWF0aW9uTW9kZVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnZhbHVlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuZHJhZ1Bvc2l0aW9uUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuaXNNZWRpYW5PYmplY3RQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5pc1ExT2JqZWN0UHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuaXNRM09iamVjdFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmlzU2hvd2luZ0FuaW1hdGlvbkhpZ2hsaWdodFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmlzQWN0aXZlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMudGFyZ2V0WFByb3BlcnR5LnZhbHVlID0gbnVsbDtcclxuICAgIHRoaXMuc29jY2VyUGxheWVyID0gbnVsbDtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiA0dGggb3JkZXIgUnVuZ2UgS3V0dGUgaW50ZWdyYXRpb24gdW5kZXIgY29uc3RhbnQgYWNjZWxlcmF0aW9uLiAgV2UgdXNlIHRoaXMgbW9yZSBzb3BoaXN0aWNhdGVkIGFsZ29yaXRobSBpbnN0ZWFkIG9mXHJcbiAqIHg9eDArdjB0KzEvMmF0XjIgYmVjYXVzZSB0aGF0IGxvb2tlZCB0b28gbXVjaCBsaWtlIHRoZSBiYWxsIGVuZGVkIGEgbGl0dGxlIHRvIHRoZSBsZWZ0IG9mIHRoZSB0YXJnZXQgbG9jYXRpb24sXHJcbiAqIGFuZCBqdW1wZWQgc2xpZ2h0bHkgdG8gdGhlIHNpZGUuXHJcbiAqIFNlZSBodHRwczovL210ZGV2YW5zLmNvbS8yMDEzLzA1L2ZvdXJ0aC1vcmRlci1ydW5nZS1rdXR0YS1hbGdvcml0aG0taW4tamF2YXNjcmlwdC13aXRoLWRlbW8vXHJcbiAqL1xyXG5jb25zdCByazQgPSAoIHg6IG51bWJlciwgdjogbnVtYmVyLCBhOiBudW1iZXIsIGR0OiBudW1iZXIgKSA9PiB7XHJcbiAgY29uc3QgdjIgPSB2ICsgYSAqIGR0IC8gMjtcclxuICBjb25zdCB2NCA9IHYgKyBhICogZHQ7XHJcblxyXG4gIGNvbnN0IHhSZXN1bHQgPSB4ICsgZHQgKiAoIHYgKyA0ICogdjIgKyB2NCApIC8gNjtcclxuICBjb25zdCB2UmVzdWx0ID0gdiArIGEgKiBkdDtcclxuXHJcbiAgcmV0dXJuIFsgeFJlc3VsdCwgdlJlc3VsdCBdO1xyXG59O1xyXG5cclxuY2VudGVyQW5kVmFyaWFiaWxpdHkucmVnaXN0ZXIoICdTb2NjZXJCYWxsJywgU29jY2VyQmFsbCApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLE9BQU9BLG9CQUFvQixNQUFNLCtCQUErQjtBQUNoRSxPQUFPQyxlQUFlLE1BQU0sdUNBQXVDO0FBRW5FLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsU0FBUyxNQUFNLHVDQUF1QztBQUM3RCxPQUFPQyxhQUFhLE1BQU0sb0JBQW9CO0FBQzlDLE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsT0FBT0MsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxZQUFZLE1BQU0sb0JBQW9CO0FBQzdDLE9BQU9DLFFBQVEsTUFBTSxpQ0FBaUM7QUFDdEQsT0FBT0MsVUFBVSxNQUFNLDJDQUEyQztBQUNsRSxPQUFPQyxPQUFPLE1BQU0sZ0NBQWdDO0FBQ3BELFNBQVNDLGFBQWEsUUFBUSxvQkFBb0I7QUFDbEQsT0FBT0MsbUJBQW1CLE1BQU0sNENBQTRDO0FBZ0I1RSxlQUFlLE1BQU1DLFVBQVUsQ0FBQztFQUU5Qjs7RUFHQTs7RUFVQTs7RUFHQTs7RUFHZ0JDLGtCQUFrQixHQUFhLElBQUlKLE9BQU8sQ0FBQyxDQUFDO0VBQ3JESyxTQUFTLEdBQXFCLElBQUk7RUFFbENDLFlBQVksR0FBd0IsSUFBSTtFQUV4Q0MsV0FBV0EsQ0FBRUMsZUFBaUMsRUFBRztJQUV0RCxNQUFNQyxPQUFPLEdBQUdoQixTQUFTLENBQXFELENBQUMsQ0FBRTtNQUMvRWlC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