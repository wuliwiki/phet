// Copyright 2022-2023, University of Colorado Boulder

/**
 * A number line for displaying data objects.
 *
 * @author Chris Klusendorf (PhET Interactive Simulations)
 * @author Sam Reid (PhET Interactive Simulations)
 */

import centerAndVariability from '../../centerAndVariability.js';
import { Node, Path, Text } from '../../../../scenery/js/imports.js';
import optionize from '../../../../phet-core/js/optionize.js';
import ChartTransform from '../../../../bamboo/js/ChartTransform.js';
import Range from '../../../../dot/js/Range.js';
import TickMarkSet from '../../../../bamboo/js/TickMarkSet.js';
import Orientation from '../../../../phet-core/js/Orientation.js';
import TickLabelSet from '../../../../bamboo/js/TickLabelSet.js';
import Utils from '../../../../dot/js/Utils.js';
import { Shape } from '../../../../kite/js/imports.js';
import CAVColors from '../CAVColors.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import CAVConstants from '../CAVConstants.js';
import Multilink from '../../../../axon/js/Multilink.js';
export default class NumberLineNode extends Node {
  // For layout

  constructor(meanValueProperty, isShowingMeanIndicatorProperty, rangeProperty, providedOptions) {
    const options = optionize()({
      color: 'white'
    }, providedOptions);
    super();

    // Tick marks on the dot plot are a little shorter than in the play area
    const tickMarkExtent = options.includeXAxis ? 7 : 10;
    const chartTransform = new ChartTransform({
      viewWidth: CAVConstants.CHART_VIEW_WIDTH,
      modelXRange: CAVConstants.PHYSICAL_RANGE,
      viewHeight: tickMarkExtent / 2,
      modelYRange: new Range(0, 1)
    });
    const tickMarkSet = new TickMarkSet(chartTransform, Orientation.HORIZONTAL, 1, {
      stroke: options.color,
      extent: tickMarkExtent
    });
    this.addChild(tickMarkSet);
    this.tickMarkSet = tickMarkSet;
    const tickLabelSet = new TickLabelSet(chartTransform, Orientation.HORIZONTAL, 1, {
      extent: tickMarkExtent + 12,
      createLabel: value => new Text(Utils.toFixed(value, 0), {
        fontSize: 16,
        fill: options.color
      })
    });
    this.addChild(tickLabelSet);
    if (options.includeXAxis) {
      const xAxisNode = new Path(new Shape().moveTo(tickMarkSet.left, 0).lineTo(tickMarkSet.right, 0), {
        stroke: options.color
      });
      this.addChild(xAxisNode);

      // For the dot plot, when "mean" is selected, there is a purple overlay on the x-axis (if there is an x-axis)
      const rangeNode = new Path(new Shape().moveTo(0, 0).lineToRelative(100, 0), {
        stroke: CAVColors.meanColorProperty,
        lineWidth: 3.2
      });
      Multilink.multilink([rangeProperty, isShowingMeanIndicatorProperty], (range, isShowingMeanIndicator) => {
        if (range !== null) {
          // Do not show any area or text above the data point if the range is 0
          rangeNode.shape = new Shape().moveTo(modelViewTransform.modelToViewX(range.min), 0).lineTo(modelViewTransform.modelToViewX(range.max), 0);
        }
        rangeNode.visible = isShowingMeanIndicator && range !== null;
      });
      this.addChild(rangeNode);
    }

    // TODO: See see https://github.com/phetsims/center-and-variability/issues/168, Can we make a 1d MVT since that's
    // all that's needed here, or should this be using the same MVT as the outer MVT?  Like the one that positions the number line node,
    // and puts objects in the right spots.
    const modelViewTransform = ModelViewTransform2.createRectangleInvertedYMapping(new Bounds2(CAVConstants.PHYSICAL_RANGE.min, 0, CAVConstants.PHYSICAL_RANGE.max, CAVConstants.PHYSICAL_RANGE.getLength()), new Bounds2(0, -CAVConstants.CHART_VIEW_WIDTH, CAVConstants.CHART_VIEW_WIDTH, CAVConstants.CHART_VIEW_WIDTH));
    const meanIndicatorNode = NumberLineNode.createMeanIndicatorNode(options.includeMeanStroke, false);
    this.addChild(meanIndicatorNode);
    Multilink.multilink([meanValueProperty, isShowingMeanIndicatorProperty], (meanValue, isShowingMeanIndicator) => {
      if (meanValue !== null) {
        meanIndicatorNode.centerTop = new Vector2(modelViewTransform.modelToViewX(meanValue), 0);
      }
      meanIndicatorNode.visible = isShowingMeanIndicator && meanValue !== null;
    });
    this.mutate(options);
  }
  static createMeanIndicatorNode(includeStroke, isIcon) {
    const TRIANGLE_LENGTH = 15;
    const TRIANGLE_ALTITUDE = 13;

    // This is a triangle that points up.  Start at the top center tip.
    const TRIANGLE_SHAPE = new Shape().moveTo(0, 0)

    // Moving counterclockwise
    .lineTo(-TRIANGLE_LENGTH / 2, TRIANGLE_ALTITUDE).lineToRelative(TRIANGLE_LENGTH, 0).close();
    return new Path(TRIANGLE_SHAPE, {
      fill: CAVColors.meanColorProperty,
      stroke: includeStroke ? CAVColors.arrowStrokeProperty : null,
      lineWidth: CAVConstants.ARROW_LINE_WIDTH
    });
  }
}
centerAndVariability.register('NumberLineNode', NumberLineNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjZW50ZXJBbmRWYXJpYWJpbGl0eSIsIk5vZGUiLCJQYXRoIiwiVGV4dCIsIm9wdGlvbml6ZSIsIkNoYXJ0VHJhbnNmb3JtIiwiUmFuZ2UiLCJUaWNrTWFya1NldCIsIk9yaWVudGF0aW9uIiwiVGlja0xhYmVsU2V0IiwiVXRpbHMiLCJTaGFwZSIsIkNBVkNvbG9ycyIsIlZlY3RvcjIiLCJNb2RlbFZpZXdUcmFuc2Zvcm0yIiwiQm91bmRzMiIsIkNBVkNvbnN0YW50cyIsIk11bHRpbGluayIsIk51bWJlckxpbmVOb2RlIiwiY29uc3RydWN0b3IiLCJtZWFuVmFsdWVQcm9wZXJ0eSIsImlzU2hvd2luZ01lYW5JbmRpY2F0b3JQcm9wZXJ0eSIsInJhbmdlUHJvcGVydHkiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiY29sb3IiLCJ0aWNrTWFya0V4dGVudCIsImluY2x1ZGVYQXhpcyIsImNoYXJ0VHJhbnNmb3JtIiwidmlld1dpZHRoIiwiQ0hBUlRfVklFV19XSURUSCIsIm1vZGVsWFJhbmdlIiwiUEhZU0lDQUxfUkFOR0UiLCJ2aWV3SGVpZ2h0IiwibW9kZWxZUmFuZ2UiLCJ0aWNrTWFya1NldCIsIkhPUklaT05UQUwiLCJzdHJva2UiLCJleHRlbnQiLCJhZGRDaGlsZCIsInRpY2tMYWJlbFNldCIsImNyZWF0ZUxhYmVsIiwidmFsdWUiLCJ0b0ZpeGVkIiwiZm9udFNpemUiLCJmaWxsIiwieEF4aXNOb2RlIiwibW92ZVRvIiwibGVmdCIsImxpbmVUbyIsInJpZ2h0IiwicmFuZ2VOb2RlIiwibGluZVRvUmVsYXRpdmUiLCJtZWFuQ29sb3JQcm9wZXJ0eSIsImxpbmVXaWR0aCIsIm11bHRpbGluayIsInJhbmdlIiwiaXNTaG93aW5nTWVhbkluZGljYXRvciIsInNoYXBlIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwibW9kZWxUb1ZpZXdYIiwibWluIiwibWF4IiwidmlzaWJsZSIsImNyZWF0ZVJlY3RhbmdsZUludmVydGVkWU1hcHBpbmciLCJnZXRMZW5ndGgiLCJtZWFuSW5kaWNhdG9yTm9kZSIsImNyZWF0ZU1lYW5JbmRpY2F0b3JOb2RlIiwiaW5jbHVkZU1lYW5TdHJva2UiLCJtZWFuVmFsdWUiLCJjZW50ZXJUb3AiLCJtdXRhdGUiLCJpbmNsdWRlU3Ryb2tlIiwiaXNJY29uIiwiVFJJQU5HTEVfTEVOR1RIIiwiVFJJQU5HTEVfQUxUSVRVREUiLCJUUklBTkdMRV9TSEFQRSIsImNsb3NlIiwiYXJyb3dTdHJva2VQcm9wZXJ0eSIsIkFSUk9XX0xJTkVfV0lEVEgiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIk51bWJlckxpbmVOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIyLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEEgbnVtYmVyIGxpbmUgZm9yIGRpc3BsYXlpbmcgZGF0YSBvYmplY3RzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIEtsdXNlbmRvcmYgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IGNlbnRlckFuZFZhcmlhYmlsaXR5IGZyb20gJy4uLy4uL2NlbnRlckFuZFZhcmlhYmlsaXR5LmpzJztcclxuaW1wb3J0IHsgTm9kZSwgTm9kZU9wdGlvbnMsIFBhdGgsIFRleHQsIFRQYWludCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBDaGFydFRyYW5zZm9ybSBmcm9tICcuLi8uLi8uLi8uLi9iYW1ib28vanMvQ2hhcnRUcmFuc2Zvcm0uanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IFRpY2tNYXJrU2V0IGZyb20gJy4uLy4uLy4uLy4uL2JhbWJvby9qcy9UaWNrTWFya1NldC5qcyc7XHJcbmltcG9ydCBPcmllbnRhdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvT3JpZW50YXRpb24uanMnO1xyXG5pbXBvcnQgVGlja0xhYmVsU2V0IGZyb20gJy4uLy4uLy4uLy4uL2JhbWJvby9qcy9UaWNrTGFiZWxTZXQuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBDQVZDb2xvcnMgZnJvbSAnLi4vQ0FWQ29sb3JzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgTW9kZWxWaWV3VHJhbnNmb3JtMiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IENBVkNvbnN0YW50cyBmcm9tICcuLi9DQVZDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgY29sb3I/OiBUUGFpbnQ7XHJcbiAgaW5jbHVkZVhBeGlzOiBib29sZWFuO1xyXG4gIGluY2x1ZGVNZWFuU3Ryb2tlOiBib29sZWFuO1xyXG59O1xyXG5leHBvcnQgdHlwZSBOdW1iZXJMaW5lTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIE5vZGVPcHRpb25zICYgUGlja1JlcXVpcmVkPE5vZGVPcHRpb25zLCAndGFuZGVtJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOdW1iZXJMaW5lTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvLyBGb3IgbGF5b3V0XHJcbiAgcHVibGljIHJlYWRvbmx5IHRpY2tNYXJrU2V0OiBUaWNrTWFya1NldDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKFxyXG4gICAgbWVhblZhbHVlUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PG51bWJlciB8IG51bGw+LFxyXG4gICAgaXNTaG93aW5nTWVhbkluZGljYXRvclByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPixcclxuICAgIHJhbmdlUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PFJhbmdlIHwgbnVsbD4sXHJcbiAgICBwcm92aWRlZE9wdGlvbnM/OiBOdW1iZXJMaW5lTm9kZU9wdGlvbnNcclxuICApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPE51bWJlckxpbmVOb2RlT3B0aW9ucywgU2VsZk9wdGlvbnMsIE5vZGVPcHRpb25zPigpKCB7XHJcbiAgICAgIGNvbG9yOiAnd2hpdGUnXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIC8vIFRpY2sgbWFya3Mgb24gdGhlIGRvdCBwbG90IGFyZSBhIGxpdHRsZSBzaG9ydGVyIHRoYW4gaW4gdGhlIHBsYXkgYXJlYVxyXG4gICAgY29uc3QgdGlja01hcmtFeHRlbnQgPSBvcHRpb25zLmluY2x1ZGVYQXhpcyA/IDcgOiAxMDtcclxuXHJcbiAgICBjb25zdCBjaGFydFRyYW5zZm9ybSA9IG5ldyBDaGFydFRyYW5zZm9ybSgge1xyXG4gICAgICB2aWV3V2lkdGg6IENBVkNvbnN0YW50cy5DSEFSVF9WSUVXX1dJRFRILFxyXG4gICAgICBtb2RlbFhSYW5nZTogQ0FWQ29uc3RhbnRzLlBIWVNJQ0FMX1JBTkdFLFxyXG4gICAgICB2aWV3SGVpZ2h0OiB0aWNrTWFya0V4dGVudCAvIDIsXHJcbiAgICAgIG1vZGVsWVJhbmdlOiBuZXcgUmFuZ2UoIDAsIDEgKVxyXG4gICAgfSApO1xyXG4gICAgY29uc3QgdGlja01hcmtTZXQgPSBuZXcgVGlja01hcmtTZXQoIGNoYXJ0VHJhbnNmb3JtLCBPcmllbnRhdGlvbi5IT1JJWk9OVEFMLCAxLCB7XHJcbiAgICAgIHN0cm9rZTogb3B0aW9ucy5jb2xvcixcclxuICAgICAgZXh0ZW50OiB0aWNrTWFya0V4dGVudFxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGlja01hcmtTZXQgKTtcclxuXHJcbiAgICB0aGlzLnRpY2tNYXJrU2V0ID0gdGlja01hcmtTZXQ7XHJcblxyXG4gICAgY29uc3QgdGlja0xhYmVsU2V0ID0gbmV3IFRpY2tMYWJlbFNldCggY2hhcnRUcmFuc2Zvcm0sIE9yaWVudGF0aW9uLkhPUklaT05UQUwsIDEsIHtcclxuICAgICAgZXh0ZW50OiB0aWNrTWFya0V4dGVudCArIDEyLFxyXG4gICAgICBjcmVhdGVMYWJlbDogKCB2YWx1ZTogbnVtYmVyICkgPT4gbmV3IFRleHQoIFV0aWxzLnRvRml4ZWQoIHZhbHVlLCAwICksIHtcclxuICAgICAgICBmb250U2l6ZTogMTYsXHJcbiAgICAgICAgZmlsbDogb3B0aW9ucy5jb2xvclxyXG4gICAgICB9IClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRpY2tMYWJlbFNldCApO1xyXG5cclxuICAgIGlmICggb3B0aW9ucy5pbmNsdWRlWEF4aXMgKSB7XHJcbiAgICAgIGNvbnN0IHhBeGlzTm9kZSA9IG5ldyBQYXRoKCBuZXcgU2hhcGUoKVxyXG4gICAgICAgIC5tb3ZlVG8oIHRpY2tNYXJrU2V0LmxlZnQsIDAgKVxyXG4gICAgICAgIC5saW5lVG8oIHRpY2tNYXJrU2V0LnJpZ2h0LCAwICksIHtcclxuICAgICAgICBzdHJva2U6IG9wdGlvbnMuY29sb3JcclxuICAgICAgfSApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCB4QXhpc05vZGUgKTtcclxuXHJcbiAgICAgIC8vIEZvciB0aGUgZG90IHBsb3QsIHdoZW4gXCJtZWFuXCIgaXMgc2VsZWN0ZWQsIHRoZXJlIGlzIGEgcHVycGxlIG92ZXJsYXkgb24gdGhlIHgtYXhpcyAoaWYgdGhlcmUgaXMgYW4geC1heGlzKVxyXG4gICAgICBjb25zdCByYW5nZU5vZGUgPSBuZXcgUGF0aCggbmV3IFNoYXBlKCkubW92ZVRvKCAwLCAwICkubGluZVRvUmVsYXRpdmUoIDEwMCwgMCApLCB7XHJcbiAgICAgICAgc3Ryb2tlOiBDQVZDb2xvcnMubWVhbkNvbG9yUHJvcGVydHksXHJcbiAgICAgICAgbGluZVdpZHRoOiAzLjJcclxuICAgICAgfSApO1xyXG4gICAgICBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIHJhbmdlUHJvcGVydHksIGlzU2hvd2luZ01lYW5JbmRpY2F0b3JQcm9wZXJ0eSBdLFxyXG4gICAgICAgICggcmFuZ2UsIGlzU2hvd2luZ01lYW5JbmRpY2F0b3IgKSA9PiB7XHJcbiAgICAgICAgICBpZiAoIHJhbmdlICE9PSBudWxsICkge1xyXG5cclxuICAgICAgICAgICAgLy8gRG8gbm90IHNob3cgYW55IGFyZWEgb3IgdGV4dCBhYm92ZSB0aGUgZGF0YSBwb2ludCBpZiB0aGUgcmFuZ2UgaXMgMFxyXG4gICAgICAgICAgICByYW5nZU5vZGUuc2hhcGUgPSBuZXcgU2hhcGUoKVxyXG4gICAgICAgICAgICAgIC5tb3ZlVG8oIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIHJhbmdlLm1pbiApLCAwIClcclxuICAgICAgICAgICAgICAubGluZVRvKCBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCByYW5nZS5tYXggKSwgMCApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmFuZ2VOb2RlLnZpc2libGUgPSBpc1Nob3dpbmdNZWFuSW5kaWNhdG9yICYmIHJhbmdlICE9PSBudWxsO1xyXG4gICAgICAgIH0gKTtcclxuXHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIHJhbmdlTm9kZSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRPRE86IFNlZSBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NlbnRlci1hbmQtdmFyaWFiaWxpdHkvaXNzdWVzLzE2OCwgQ2FuIHdlIG1ha2UgYSAxZCBNVlQgc2luY2UgdGhhdCdzXHJcbiAgICAvLyBhbGwgdGhhdCdzIG5lZWRlZCBoZXJlLCBvciBzaG91bGQgdGhpcyBiZSB1c2luZyB0aGUgc2FtZSBNVlQgYXMgdGhlIG91dGVyIE1WVD8gIExpa2UgdGhlIG9uZSB0aGF0IHBvc2l0aW9ucyB0aGUgbnVtYmVyIGxpbmUgbm9kZSxcclxuICAgIC8vIGFuZCBwdXRzIG9iamVjdHMgaW4gdGhlIHJpZ2h0IHNwb3RzLlxyXG4gICAgY29uc3QgbW9kZWxWaWV3VHJhbnNmb3JtID0gTW9kZWxWaWV3VHJhbnNmb3JtMi5jcmVhdGVSZWN0YW5nbGVJbnZlcnRlZFlNYXBwaW5nKFxyXG4gICAgICBuZXcgQm91bmRzMiggQ0FWQ29uc3RhbnRzLlBIWVNJQ0FMX1JBTkdFLm1pbiwgMCwgQ0FWQ29uc3RhbnRzLlBIWVNJQ0FMX1JBTkdFLm1heCwgQ0FWQ29uc3RhbnRzLlBIWVNJQ0FMX1JBTkdFLmdldExlbmd0aCgpICksXHJcbiAgICAgIG5ldyBCb3VuZHMyKCAwLCAtQ0FWQ29uc3RhbnRzLkNIQVJUX1ZJRVdfV0lEVEgsIENBVkNvbnN0YW50cy5DSEFSVF9WSUVXX1dJRFRILCBDQVZDb25zdGFudHMuQ0hBUlRfVklFV19XSURUSCApXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IG1lYW5JbmRpY2F0b3JOb2RlID0gTnVtYmVyTGluZU5vZGUuY3JlYXRlTWVhbkluZGljYXRvck5vZGUoIG9wdGlvbnMuaW5jbHVkZU1lYW5TdHJva2UsIGZhbHNlICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBtZWFuSW5kaWNhdG9yTm9kZSApO1xyXG5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFsgbWVhblZhbHVlUHJvcGVydHksIGlzU2hvd2luZ01lYW5JbmRpY2F0b3JQcm9wZXJ0eSBdLFxyXG4gICAgICAoIG1lYW5WYWx1ZSwgaXNTaG93aW5nTWVhbkluZGljYXRvciApID0+IHtcclxuICAgICAgICBpZiAoIG1lYW5WYWx1ZSAhPT0gbnVsbCApIHtcclxuICAgICAgICAgIG1lYW5JbmRpY2F0b3JOb2RlLmNlbnRlclRvcCA9IG5ldyBWZWN0b3IyKCBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCBtZWFuVmFsdWUgKSwgMCApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtZWFuSW5kaWNhdG9yTm9kZS52aXNpYmxlID0gaXNTaG93aW5nTWVhbkluZGljYXRvciAmJiBtZWFuVmFsdWUgIT09IG51bGw7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLm11dGF0ZSggb3B0aW9ucyApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVNZWFuSW5kaWNhdG9yTm9kZSggaW5jbHVkZVN0cm9rZTogYm9vbGVhbiwgaXNJY29uOiBib29sZWFuICk6IE5vZGUge1xyXG4gICAgY29uc3QgVFJJQU5HTEVfTEVOR1RIID0gMTU7XHJcbiAgICBjb25zdCBUUklBTkdMRV9BTFRJVFVERSA9IDEzO1xyXG5cclxuICAgIC8vIFRoaXMgaXMgYSB0cmlhbmdsZSB0aGF0IHBvaW50cyB1cC4gIFN0YXJ0IGF0IHRoZSB0b3AgY2VudGVyIHRpcC5cclxuICAgIGNvbnN0IFRSSUFOR0xFX1NIQVBFID0gbmV3IFNoYXBlKCkubW92ZVRvKCAwLCAwIClcclxuXHJcbiAgICAgIC8vIE1vdmluZyBjb3VudGVyY2xvY2t3aXNlXHJcbiAgICAgIC5saW5lVG8oIC1UUklBTkdMRV9MRU5HVEggLyAyLCBUUklBTkdMRV9BTFRJVFVERSApXHJcbiAgICAgIC5saW5lVG9SZWxhdGl2ZSggVFJJQU5HTEVfTEVOR1RILCAwIClcclxuICAgICAgLmNsb3NlKCk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQYXRoKCBUUklBTkdMRV9TSEFQRSwge1xyXG4gICAgICBmaWxsOiBDQVZDb2xvcnMubWVhbkNvbG9yUHJvcGVydHksXHJcbiAgICAgIHN0cm9rZTogaW5jbHVkZVN0cm9rZSA/IENBVkNvbG9ycy5hcnJvd1N0cm9rZVByb3BlcnR5IDogbnVsbCxcclxuICAgICAgbGluZVdpZHRoOiBDQVZDb25zdGFudHMuQVJST1dfTElORV9XSURUSFxyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxuY2VudGVyQW5kVmFyaWFiaWxpdHkucmVnaXN0ZXIoICdOdW1iZXJMaW5lTm9kZScsIE51bWJlckxpbmVOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0Esb0JBQW9CLE1BQU0sK0JBQStCO0FBQ2hFLFNBQVNDLElBQUksRUFBZUMsSUFBSSxFQUFFQyxJQUFJLFFBQWdCLG1DQUFtQztBQUN6RixPQUFPQyxTQUFTLE1BQU0sdUNBQXVDO0FBQzdELE9BQU9DLGNBQWMsTUFBTSx5Q0FBeUM7QUFDcEUsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxXQUFXLE1BQU0sc0NBQXNDO0FBQzlELE9BQU9DLFdBQVcsTUFBTSx5Q0FBeUM7QUFDakUsT0FBT0MsWUFBWSxNQUFNLHVDQUF1QztBQUNoRSxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFFdEQsT0FBT0MsU0FBUyxNQUFNLGlCQUFpQjtBQUN2QyxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLG1CQUFtQixNQUFNLHVEQUF1RDtBQUN2RixPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLFlBQVksTUFB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