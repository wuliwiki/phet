// Copyright 2023, University of Colorado Boulder

import CAVObjectNode from './CAVObjectNode.js';
import centerAndVariability from '../../centerAndVariability.js';
import { DragListener, Image, Node } from '../../../../scenery/js/imports.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import Multilink from '../../../../axon/js/Multilink.js';
import { AnimationMode } from '../model/AnimationMode.js';
import CAVObjectType from '../model/CAVObjectType.js';
import ballDark_png from '../../../images/ballDark_png.js';
import ball_png from '../../../images/ball_png.js';
import Vector2 from '../../../../dot/js/Vector2.js';
export default class SoccerBallNode extends CAVObjectNode {
  constructor(soccerBall, isSceneVisibleProperty, isShowingPlayAreaMedianProperty, modelViewTransform, objectNodesInputEnabledProperty, options) {
    const viewRadius = modelViewTransform.modelToViewDeltaX(CAVObjectType.SOCCER_BALL.radius);
    super(soccerBall, isShowingPlayAreaMedianProperty, modelViewTransform, CAVObjectType.SOCCER_BALL.radius, options);

    // The dark soccer ball is used for when a ball has input disabled.
    const soccerBallNode = new Image(ball_png);
    const soccerBallDarkNode = new Image(ballDark_png);
    const soccerBallNodes = new Node({
      children: [soccerBallNode, soccerBallDarkNode],
      // if the child node is non-square, it should still fit within specified dimensions. Note: this does not change the
      // aspect ratio.
      maxWidth: viewRadius * 2,
      maxHeight: viewRadius * 2,
      // Center the nested Node for compatibility with DragListener
      center: Vector2.ZERO
    });

    // only setup input-related things if dragging is enabled
    const dragListener = new DragListener({
      tandem: options.tandem.createTandem('dragListener'),
      positionProperty: soccerBall.dragPositionProperty,
      transform: modelViewTransform,
      start: () => {
        // if the user presses an object that's animating, allow it to keep animating up in the stack
        soccerBall.dragStartedEmitter.emit();
      },
      drag: () => {
        soccerBall.animation && soccerBall.animation.stop();
      }
    });

    // pan and zoom - In order to move the CAVObjectNode to a new position the pointer has to move more than half the
    // unit model length. When the CAVObjectNode is near the edge of the screen while zoomed in, the pointer doesn't
    // have enough space to move that far. If we make sure that bounds surrounding the CAVObjectNode have a width
    // of 2 model units the pointer will always have enough space to drag the CAVObjectNode to a new position.
    // See https://github.com/phetsims/center-and-variability/issues/88
    dragListener.createPanTargetBounds = () => {
      const modelPosition = soccerBall.positionProperty.value;
      const modelBounds = new Bounds2(modelPosition.x - 1, modelPosition.y - 1, modelPosition.x + 1, modelPosition.y + 1);
      const viewBounds = modelViewTransform.modelToViewBounds(modelBounds);
      return this.parentToGlobalBounds(viewBounds);
    };
    this.addInputListener(dragListener);
    this.touchArea = this.localBounds.dilatedX(5);

    // For PhET-iO, allow clients to shut off interactivity via this Property.
    const selfInputEnabledProperty = new BooleanProperty(true, {
      tandem: options.tandem.createTandem('selfInputEnabledProperty')
    });

    // Prevent dragging or interaction while the object does not have a value (when it is not in the play area yet),
    // when it is animating, if input for this individual node is disabled, or if input for all of the object nodes
    // ahs been disabled
    Multilink.multilink([soccerBall.animationModeProperty, soccerBall.valueProperty, selfInputEnabledProperty, objectNodesInputEnabledProperty], (mode, value, selfInputEnabled, objectsInputEnabled) => {
      const inputEnabled = value !== null && mode === AnimationMode.NONE && selfInputEnabled && objectsInputEnabled;

      // if input is disabled and the ball is in the play area, show the darker version
      const showDisabledSoccerBall = !inputEnabled && value !== null;
      soccerBallDarkNode.visible = showDisabledSoccerBall;
      soccerBallNode.visible = !showDisabledSoccerBall;
      this.inputEnabled = inputEnabled;
    });
    this.addChild(soccerBallNodes);

    // Data point should be visible if the soccer ball is active AND if the scene is visible.
    Multilink.multilink([soccerBall.isActiveProperty, isSceneVisibleProperty], (isActive, isSceneVisible) => {
      this.visible = isActive && isSceneVisible;
    });

    // show or hide the median highlight
    Multilink.multilink([soccerBall.isMedianObjectProperty, isShowingPlayAreaMedianProperty, soccerBall.isShowingAnimationHighlightProperty], (isMedianObject, isShowingPlayAreaMedian, isShowingAnimationHighlight) => {
      this.medianHighlight.visible = isShowingPlayAreaMedian && isMedianObject;

      // Median highlights should be in front in z-ordering. Rather than accomplishing this via a different layer,
      // move this to the front when it is visible.
      if (this.medianHighlight.visible) {
        this.moveToFront();
      }
    });
  }
}
centerAndVariability.register('SoccerBallNode', SoccerBallNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDQVZPYmplY3ROb2RlIiwiY2VudGVyQW5kVmFyaWFiaWxpdHkiLCJEcmFnTGlzdGVuZXIiLCJJbWFnZSIsIk5vZGUiLCJCb3VuZHMyIiwiQm9vbGVhblByb3BlcnR5IiwiTXVsdGlsaW5rIiwiQW5pbWF0aW9uTW9kZSIsIkNBVk9iamVjdFR5cGUiLCJiYWxsRGFya19wbmciLCJiYWxsX3BuZyIsIlZlY3RvcjIiLCJTb2NjZXJCYWxsTm9kZSIsImNvbnN0cnVjdG9yIiwic29jY2VyQmFsbCIsImlzU2NlbmVWaXNpYmxlUHJvcGVydHkiLCJpc1Nob3dpbmdQbGF5QXJlYU1lZGlhblByb3BlcnR5IiwibW9kZWxWaWV3VHJhbnNmb3JtIiwib2JqZWN0Tm9kZXNJbnB1dEVuYWJsZWRQcm9wZXJ0eSIsIm9wdGlvbnMiLCJ2aWV3UmFkaXVzIiwibW9kZWxUb1ZpZXdEZWx0YVgiLCJTT0NDRVJfQkFMTCIsInJhZGl1cyIsInNvY2NlckJhbGxOb2RlIiwic29jY2VyQmFsbERhcmtOb2RlIiwic29jY2VyQmFsbE5vZGVzIiwiY2hpbGRyZW4iLCJtYXhXaWR0aCIsIm1heEhlaWdodCIsImNlbnRlciIsIlpFUk8iLCJkcmFnTGlzdGVuZXIiLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJwb3NpdGlvblByb3BlcnR5IiwiZHJhZ1Bvc2l0aW9uUHJvcGVydHkiLCJ0cmFuc2Zvcm0iLCJzdGFydCIsImRyYWdTdGFydGVkRW1pdHRlciIsImVtaXQiLCJkcmFnIiwiYW5pbWF0aW9uIiwic3RvcCIsImNyZWF0ZVBhblRhcmdldEJvdW5kcyIsIm1vZGVsUG9zaXRpb24iLCJ2YWx1ZSIsIm1vZGVsQm91bmRzIiwieCIsInkiLCJ2aWV3Qm91bmRzIiwibW9kZWxUb1ZpZXdCb3VuZHMiLCJwYXJlbnRUb0dsb2JhbEJvdW5kcyIsImFkZElucHV0TGlzdGVuZXIiLCJ0b3VjaEFyZWEiLCJsb2NhbEJvdW5kcyIsImRpbGF0ZWRYIiwic2VsZklucHV0RW5hYmxlZFByb3BlcnR5IiwibXVsdGlsaW5rIiwiYW5pbWF0aW9uTW9kZVByb3BlcnR5IiwidmFsdWVQcm9wZXJ0eSIsIm1vZGUiLCJzZWxmSW5wdXRFbmFibGVkIiwib2JqZWN0c0lucHV0RW5hYmxlZCIsImlucHV0RW5hYmxlZCIsIk5PTkUiLCJzaG93RGlzYWJsZWRTb2NjZXJCYWxsIiwidmlzaWJsZSIsImFkZENoaWxkIiwiaXNBY3RpdmVQcm9wZXJ0eSIsImlzQWN0aXZlIiwiaXNTY2VuZVZpc2libGUiLCJpc01lZGlhbk9iamVjdFByb3BlcnR5IiwiaXNTaG93aW5nQW5pbWF0aW9uSGlnaGxpZ2h0UHJvcGVydHkiLCJpc01lZGlhbk9iamVjdCIsImlzU2hvd2luZ1BsYXlBcmVhTWVkaWFuIiwiaXNTaG93aW5nQW5pbWF0aW9uSGlnaGxpZ2h0IiwibWVkaWFuSGlnaGxpZ2h0IiwibW92ZVRvRnJvbnQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlNvY2NlckJhbGxOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbmltcG9ydCBDQVZPYmplY3ROb2RlLCB7IENBVk9iamVjdE5vZGVPcHRpb25zIH0gZnJvbSAnLi9DQVZPYmplY3ROb2RlLmpzJztcclxuaW1wb3J0IGNlbnRlckFuZFZhcmlhYmlsaXR5IGZyb20gJy4uLy4uL2NlbnRlckFuZFZhcmlhYmlsaXR5LmpzJztcclxuaW1wb3J0IFNvY2NlckJhbGwgZnJvbSAnLi4vbW9kZWwvU29jY2VyQmFsbC5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgVFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFByb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgRHJhZ0xpc3RlbmVyLCBJbWFnZSwgTm9kZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5pbXBvcnQgeyBBbmltYXRpb25Nb2RlIH0gZnJvbSAnLi4vbW9kZWwvQW5pbWF0aW9uTW9kZS5qcyc7XHJcbmltcG9ydCBDQVZPYmplY3RUeXBlIGZyb20gJy4uL21vZGVsL0NBVk9iamVjdFR5cGUuanMnO1xyXG5pbXBvcnQgYmFsbERhcmtfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9iYWxsRGFya19wbmcuanMnO1xyXG5pbXBvcnQgYmFsbF9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2JhbGxfcG5nLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU29jY2VyQmFsbE5vZGUgZXh0ZW5kcyBDQVZPYmplY3ROb2RlIHtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBzb2NjZXJCYWxsOiBTb2NjZXJCYWxsLCBpc1NjZW5lVmlzaWJsZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPiwgaXNTaG93aW5nUGxheUFyZWFNZWRpYW5Qcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTIsIG9iamVjdE5vZGVzSW5wdXRFbmFibGVkUHJvcGVydHk6IFRQcm9wZXJ0eTxib29sZWFuPixcclxuICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IENBVk9iamVjdE5vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IHZpZXdSYWRpdXMgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YVgoIENBVk9iamVjdFR5cGUuU09DQ0VSX0JBTEwucmFkaXVzICk7XHJcblxyXG4gICAgc3VwZXIoIHNvY2NlckJhbGwsIGlzU2hvd2luZ1BsYXlBcmVhTWVkaWFuUHJvcGVydHksIG1vZGVsVmlld1RyYW5zZm9ybSwgQ0FWT2JqZWN0VHlwZS5TT0NDRVJfQkFMTC5yYWRpdXMsIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBUaGUgZGFyayBzb2NjZXIgYmFsbCBpcyB1c2VkIGZvciB3aGVuIGEgYmFsbCBoYXMgaW5wdXQgZGlzYWJsZWQuXHJcbiAgICBjb25zdCBzb2NjZXJCYWxsTm9kZSA9IG5ldyBJbWFnZSggYmFsbF9wbmcgKTtcclxuICAgIGNvbnN0IHNvY2NlckJhbGxEYXJrTm9kZSA9IG5ldyBJbWFnZSggYmFsbERhcmtfcG5nICk7XHJcbiAgICBjb25zdCBzb2NjZXJCYWxsTm9kZXMgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogWyBzb2NjZXJCYWxsTm9kZSwgc29jY2VyQmFsbERhcmtOb2RlIF0sXHJcblxyXG4gICAgICAvLyBpZiB0aGUgY2hpbGQgbm9kZSBpcyBub24tc3F1YXJlLCBpdCBzaG91bGQgc3RpbGwgZml0IHdpdGhpbiBzcGVjaWZpZWQgZGltZW5zaW9ucy4gTm90ZTogdGhpcyBkb2VzIG5vdCBjaGFuZ2UgdGhlXHJcbiAgICAgIC8vIGFzcGVjdCByYXRpby5cclxuICAgICAgbWF4V2lkdGg6IHZpZXdSYWRpdXMgKiAyLFxyXG4gICAgICBtYXhIZWlnaHQ6IHZpZXdSYWRpdXMgKiAyLFxyXG5cclxuICAgICAgLy8gQ2VudGVyIHRoZSBuZXN0ZWQgTm9kZSBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIERyYWdMaXN0ZW5lclxyXG4gICAgICBjZW50ZXI6IFZlY3RvcjIuWkVST1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIG9ubHkgc2V0dXAgaW5wdXQtcmVsYXRlZCB0aGluZ3MgaWYgZHJhZ2dpbmcgaXMgZW5hYmxlZFxyXG4gICAgY29uc3QgZHJhZ0xpc3RlbmVyID0gbmV3IERyYWdMaXN0ZW5lcigge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RyYWdMaXN0ZW5lcicgKSxcclxuICAgICAgcG9zaXRpb25Qcm9wZXJ0eTogc29jY2VyQmFsbC5kcmFnUG9zaXRpb25Qcm9wZXJ0eSxcclxuICAgICAgdHJhbnNmb3JtOiBtb2RlbFZpZXdUcmFuc2Zvcm0sXHJcbiAgICAgIHN0YXJ0OiAoKSA9PiB7XHJcblxyXG4gICAgICAgIC8vIGlmIHRoZSB1c2VyIHByZXNzZXMgYW4gb2JqZWN0IHRoYXQncyBhbmltYXRpbmcsIGFsbG93IGl0IHRvIGtlZXAgYW5pbWF0aW5nIHVwIGluIHRoZSBzdGFja1xyXG4gICAgICAgIHNvY2NlckJhbGwuZHJhZ1N0YXJ0ZWRFbWl0dGVyLmVtaXQoKTtcclxuICAgICAgfSxcclxuICAgICAgZHJhZzogKCkgPT4ge1xyXG4gICAgICAgIHNvY2NlckJhbGwuYW5pbWF0aW9uICYmIHNvY2NlckJhbGwuYW5pbWF0aW9uLnN0b3AoKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHBhbiBhbmQgem9vbSAtIEluIG9yZGVyIHRvIG1vdmUgdGhlIENBVk9iamVjdE5vZGUgdG8gYSBuZXcgcG9zaXRpb24gdGhlIHBvaW50ZXIgaGFzIHRvIG1vdmUgbW9yZSB0aGFuIGhhbGYgdGhlXHJcbiAgICAvLyB1bml0IG1vZGVsIGxlbmd0aC4gV2hlbiB0aGUgQ0FWT2JqZWN0Tm9kZSBpcyBuZWFyIHRoZSBlZGdlIG9mIHRoZSBzY3JlZW4gd2hpbGUgem9vbWVkIGluLCB0aGUgcG9pbnRlciBkb2Vzbid0XHJcbiAgICAvLyBoYXZlIGVub3VnaCBzcGFjZSB0byBtb3ZlIHRoYXQgZmFyLiBJZiB3ZSBtYWtlIHN1cmUgdGhhdCBib3VuZHMgc3Vycm91bmRpbmcgdGhlIENBVk9iamVjdE5vZGUgaGF2ZSBhIHdpZHRoXHJcbiAgICAvLyBvZiAyIG1vZGVsIHVuaXRzIHRoZSBwb2ludGVyIHdpbGwgYWx3YXlzIGhhdmUgZW5vdWdoIHNwYWNlIHRvIGRyYWcgdGhlIENBVk9iamVjdE5vZGUgdG8gYSBuZXcgcG9zaXRpb24uXHJcbiAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NlbnRlci1hbmQtdmFyaWFiaWxpdHkvaXNzdWVzLzg4XHJcbiAgICBkcmFnTGlzdGVuZXIuY3JlYXRlUGFuVGFyZ2V0Qm91bmRzID0gKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2RlbFBvc2l0aW9uID0gc29jY2VyQmFsbC5wb3NpdGlvblByb3BlcnR5LnZhbHVlO1xyXG4gICAgICBjb25zdCBtb2RlbEJvdW5kcyA9IG5ldyBCb3VuZHMyKCBtb2RlbFBvc2l0aW9uLnggLSAxLCBtb2RlbFBvc2l0aW9uLnkgLSAxLCBtb2RlbFBvc2l0aW9uLnggKyAxLCBtb2RlbFBvc2l0aW9uLnkgKyAxICk7XHJcbiAgICAgIGNvbnN0IHZpZXdCb3VuZHMgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdCb3VuZHMoIG1vZGVsQm91bmRzICk7XHJcbiAgICAgIHJldHVybiB0aGlzLnBhcmVudFRvR2xvYmFsQm91bmRzKCB2aWV3Qm91bmRzICk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggZHJhZ0xpc3RlbmVyICk7XHJcbiAgICB0aGlzLnRvdWNoQXJlYSA9IHRoaXMubG9jYWxCb3VuZHMuZGlsYXRlZFgoIDUgKTtcclxuXHJcbiAgICAvLyBGb3IgUGhFVC1pTywgYWxsb3cgY2xpZW50cyB0byBzaHV0IG9mZiBpbnRlcmFjdGl2aXR5IHZpYSB0aGlzIFByb3BlcnR5LlxyXG4gICAgY29uc3Qgc2VsZklucHV0RW5hYmxlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggdHJ1ZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3NlbGZJbnB1dEVuYWJsZWRQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFByZXZlbnQgZHJhZ2dpbmcgb3IgaW50ZXJhY3Rpb24gd2hpbGUgdGhlIG9iamVjdCBkb2VzIG5vdCBoYXZlIGEgdmFsdWUgKHdoZW4gaXQgaXMgbm90IGluIHRoZSBwbGF5IGFyZWEgeWV0KSxcclxuICAgIC8vIHdoZW4gaXQgaXMgYW5pbWF0aW5nLCBpZiBpbnB1dCBmb3IgdGhpcyBpbmRpdmlkdWFsIG5vZGUgaXMgZGlzYWJsZWQsIG9yIGlmIGlucHV0IGZvciBhbGwgb2YgdGhlIG9iamVjdCBub2Rlc1xyXG4gICAgLy8gYWhzIGJlZW4gZGlzYWJsZWRcclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoXHJcbiAgICAgIFsgc29jY2VyQmFsbC5hbmltYXRpb25Nb2RlUHJvcGVydHksIHNvY2NlckJhbGwudmFsdWVQcm9wZXJ0eSwgc2VsZklucHV0RW5hYmxlZFByb3BlcnR5LCBvYmplY3ROb2Rlc0lucHV0RW5hYmxlZFByb3BlcnR5IF0sXHJcbiAgICAgICggbW9kZSwgdmFsdWUsIHNlbGZJbnB1dEVuYWJsZWQsIG9iamVjdHNJbnB1dEVuYWJsZWQgKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaW5wdXRFbmFibGVkID0gdmFsdWUgIT09IG51bGwgJiYgbW9kZSA9PT0gQW5pbWF0aW9uTW9kZS5OT05FICYmIHNlbGZJbnB1dEVuYWJsZWQgJiYgb2JqZWN0c0lucHV0RW5hYmxlZDtcclxuXHJcbiAgICAgICAgLy8gaWYgaW5wdXQgaXMgZGlzYWJsZWQgYW5kIHRoZSBiYWxsIGlzIGluIHRoZSBwbGF5IGFyZWEsIHNob3cgdGhlIGRhcmtlciB2ZXJzaW9uXHJcbiAgICAgICAgY29uc3Qgc2hvd0Rpc2FibGVkU29jY2VyQmFsbCA9ICFpbnB1dEVuYWJsZWQgJiYgdmFsdWUgIT09IG51bGw7XHJcbiAgICAgICAgc29jY2VyQmFsbERhcmtOb2RlLnZpc2libGUgPSBzaG93RGlzYWJsZWRTb2NjZXJCYWxsO1xyXG4gICAgICAgIHNvY2NlckJhbGxOb2RlLnZpc2libGUgPSAhc2hvd0Rpc2FibGVkU29jY2VyQmFsbDtcclxuXHJcbiAgICAgICAgdGhpcy5pbnB1dEVuYWJsZWQgPSBpbnB1dEVuYWJsZWQ7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBzb2NjZXJCYWxsTm9kZXMgKTtcclxuXHJcbiAgICAvLyBEYXRhIHBvaW50IHNob3VsZCBiZSB2aXNpYmxlIGlmIHRoZSBzb2NjZXIgYmFsbCBpcyBhY3RpdmUgQU5EIGlmIHRoZSBzY2VuZSBpcyB2aXNpYmxlLlxyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayggWyBzb2NjZXJCYWxsLmlzQWN0aXZlUHJvcGVydHksIGlzU2NlbmVWaXNpYmxlUHJvcGVydHkgXSwgKCBpc0FjdGl2ZSwgaXNTY2VuZVZpc2libGUgKSA9PiB7XHJcbiAgICAgIHRoaXMudmlzaWJsZSA9IGlzQWN0aXZlICYmIGlzU2NlbmVWaXNpYmxlO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHNob3cgb3IgaGlkZSB0aGUgbWVkaWFuIGhpZ2hsaWdodFxyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayhcclxuICAgICAgWyBzb2NjZXJCYWxsLmlzTWVkaWFuT2JqZWN0UHJvcGVydHksIGlzU2hvd2luZ1BsYXlBcmVhTWVkaWFuUHJvcGVydHksIHNvY2NlckJhbGwuaXNTaG93aW5nQW5pbWF0aW9uSGlnaGxpZ2h0UHJvcGVydHkgXSxcclxuICAgICAgKCBpc01lZGlhbk9iamVjdCwgaXNTaG93aW5nUGxheUFyZWFNZWRpYW4sIGlzU2hvd2luZ0FuaW1hdGlvbkhpZ2hsaWdodCApID0+IHtcclxuICAgICAgICB0aGlzLm1lZGlhbkhpZ2hsaWdodC52aXNpYmxlID0gaXNTaG93aW5nUGxheUFyZWFNZWRpYW4gJiYgaXNNZWRpYW5PYmplY3Q7XHJcblxyXG4gICAgICAgIC8vIE1lZGlhbiBoaWdobGlnaHRzIHNob3VsZCBiZSBpbiBmcm9udCBpbiB6LW9yZGVyaW5nLiBSYXRoZXIgdGhhbiBhY2NvbXBsaXNoaW5nIHRoaXMgdmlhIGEgZGlmZmVyZW50IGxheWVyLFxyXG4gICAgICAgIC8vIG1vdmUgdGhpcyB0byB0aGUgZnJvbnQgd2hlbiBpdCBpcyB2aXNpYmxlLlxyXG4gICAgICAgIGlmICggdGhpcy5tZWRpYW5IaWdobGlnaHQudmlzaWJsZSApIHtcclxuICAgICAgICAgIHRoaXMubW92ZVRvRnJvbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbmNlbnRlckFuZFZhcmlhYmlsaXR5LnJlZ2lzdGVyKCAnU29jY2VyQmFsbE5vZGUnLCBTb2NjZXJCYWxsTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsT0FBT0EsYUFBYSxNQUFnQyxvQkFBb0I7QUFDeEUsT0FBT0Msb0JBQW9CLE1BQU0sK0JBQStCO0FBS2hFLFNBQVNDLFlBQVksRUFBRUMsS0FBSyxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQzdFLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxTQUFTLE1BQU0sa0NBQWtDO0FBQ3hELFNBQVNDLGFBQWEsUUFBUSwyQkFBMkI7QUFDekQsT0FBT0MsYUFBYSxNQUFNLDJCQUEyQjtBQUNyRCxPQUFPQyxZQUFZLE1BQU0saUNBQWlDO0FBQzFELE9BQU9DLFFBQVEsTUFBTSw2QkFBNkI7QUFDbEQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUVuRCxlQUFlLE1BQU1DLGNBQWMsU0FBU2IsYUFBYSxDQUFDO0VBRWpEYyxXQUFXQSxDQUFFQyxVQUFzQixFQUFFQyxzQkFBa0QsRUFBRUMsK0JBQTJELEVBQ3ZJQyxrQkFBdUMsRUFBRUMsK0JBQW1ELEVBQzVGQyxPQUE2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