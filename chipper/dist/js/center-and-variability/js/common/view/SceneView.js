// Copyright 2023, University of Colorado Boulder

import SoccerBallNode from './SoccerBallNode.js';
import { AnimationMode } from '../model/AnimationMode.js';
import CAVObjectType from '../model/CAVObjectType.js';
import SoccerPlayerNode from './SoccerPlayerNode.js';
import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import centerAndVariability from '../../centerAndVariability.js';
import DragIndicatorArrowNode from './DragIndicatorArrowNode.js';
import PlayAreaMedianIndicatorNode from './PlayAreaMedianIndicatorNode.js';
import InfoDialog from '../../variability/view/InfoDialog.js';
import Multilink from '../../../../axon/js/Multilink.js';
export default class SceneView {
  constructor(model, sceneModel, backObjectLayer, frontObjectLayer, modelViewTransform, getAccordionBox, options) {
    const objectNodeGroupTandem = options.tandem.createTandem('soccerBallNodeGroup');
    const objectNodesInputEnabledProperty = new BooleanProperty(true, {
      tandem: objectNodeGroupTandem.createTandem('inputEnabledProperty')
    });
    const dragIndicatorArrowNode = new DragIndicatorArrowNode({
      tandem: options.tandem.createTandem('dragIndicatorArrowNode'),
      visible: false
    });
    backObjectLayer.addChild(dragIndicatorArrowNode);
    const updateDragIndictatorVisible = () => {
      // add the dragIndicatorArrowNode above the last object when it is added to the play area. if an object was
      // moved before this happens, don't show the dragIndicatorArrowNode
      if (sceneModel.soccerBallCountProperty.value === sceneModel.maxSoccerBalls && objectNodesInputEnabledProperty.value && _.every(sceneModel.soccerBalls, soccerBall => soccerBall.valueProperty.value !== null) && !model.soccerBallHasBeenDraggedProperty.value) {
        const lastBall = sceneModel.soccerBalls[sceneModel.soccerBalls.length - 1];
        const value = lastBall.valueProperty.value;
        dragIndicatorArrowNode.centerX = modelViewTransform.modelToViewX(value);
        const dragIndicatorArrowNodeMargin = 6;

        // calculate where the top object is
        const topObjectPositionY = modelViewTransform.modelToViewY(0) - (sceneModel.getOtherObjectsAtTarget(lastBall).length + 1) * Math.abs(modelViewTransform.modelToViewDeltaY(CAVObjectType.SOCCER_BALL.radius)) * 2 - dragIndicatorArrowNodeMargin;
        dragIndicatorArrowNode.bottom = topObjectPositionY;
        dragIndicatorArrowNode.visible = true;
      } else {
        dragIndicatorArrowNode.visible = false;
      }
    };
    model.soccerBallHasBeenDraggedProperty.link(updateDragIndictatorVisible);
    sceneModel.soccerBalls.forEach((soccerBall, index) => {
      const soccerBallNode = new SoccerBallNode(soccerBall, sceneModel.isVisibleProperty, model.isShowingPlayAreaMedianProperty, modelViewTransform, objectNodesInputEnabledProperty, {
        tandem: options.tandem.createTandem('soccerBalls').createTandem('soccerBallNode' + index)
      });
      backObjectLayer.addChild(soccerBallNode);

      // While flying, it should be in front in z-order, to be in front of the accordion box
      soccerBall.animationModeProperty.lazyLink((animationMode, oldAnimationModel) => {
        if (animationMode === AnimationMode.FLYING) {
          backObjectLayer.removeChild(soccerBallNode);
          frontObjectLayer.addChild(soccerBallNode);
        } else if (oldAnimationModel) {
          frontObjectLayer.removeChild(soccerBallNode);
          backObjectLayer.addChild(soccerBallNode);
        }
      });
      soccerBall.valueProperty.link((value, oldValue) => updateDragIndictatorVisible());
      soccerBall.valueProperty.link((value, oldValue) => {
        // If the value changed from numeric to numeric, it must have been by user dragging it.
        // It's simpler to have the listener here because in the model or drag listener, there is rounding/snapping
        // And we only want to hide the indicator of the user dragged the ball a full tick mark
        if (oldValue !== null) {
          model.soccerBallHasBeenDraggedProperty.value = true;
        }
      });
    });
    const playAreaMedianIndicatorNode = new PlayAreaMedianIndicatorNode();
    frontObjectLayer.addChild(playAreaMedianIndicatorNode);
    this.updateMedianNode = () => {
      const medianValue = sceneModel.medianValueProperty.value;
      const visible = medianValue !== null && model.isShowingPlayAreaMedianProperty.value && sceneModel.isVisibleProperty.value;
      if (visible) {
        // if there is a ball at that location, go above the ball
        const ballsAtLocation = sceneModel.soccerBalls.filter(soccerBall => soccerBall.valueProperty.value === medianValue);
        const modelHeight = ballsAtLocation.length * CAVObjectType.SOCCER_BALL.radius * 2; // assumes no spacing

        const viewHeight = modelViewTransform.modelToViewDeltaY(modelHeight);
        playAreaMedianIndicatorNode.centerX = modelViewTransform.modelToViewX(medianValue);
        playAreaMedianIndicatorNode.bottom = modelViewTransform.modelToViewY(0) + viewHeight;
        const accordionBox = getAccordionBox();

        // The arrow shouldn't overlap the accordion box
        if (accordionBox) {
          const accordionBoxHeight = accordionBox.expandedProperty.value ? accordionBox.getExpandedBoxHeight() : accordionBox.getCollapsedBoxHeight();
          if (playAreaMedianIndicatorNode.top < accordionBox.top + accordionBoxHeight) {
            playAreaMedianIndicatorNode.top = accordionBox.top + accordionBoxHeight + 4;
          }
        }
      }
      playAreaMedianIndicatorNode.visible = visible;
    };
    sceneModel.medianValueProperty.link(this.updateMedianNode);
    sceneModel.objectChangedEmitter.addListener(this.updateMedianNode);
    sceneModel.isVisibleProperty.link(this.updateMedianNode);
    const soccerPlayerNodes = sceneModel.soccerPlayers.map(soccerPlayer => new SoccerPlayerNode(soccerPlayer, modelViewTransform, sceneModel.isVisibleProperty));
    soccerPlayerNodes.forEach(soccerPlayerNode => frontObjectLayer.addChild(soccerPlayerNode));
    const varModel = model;
    const varSceneModel = sceneModel;
    if (varModel && varModel.isInfoShowingProperty && varModel.selectedSceneModelProperty && varSceneModel) {
      const infoDialog = new InfoDialog(varModel, varSceneModel, {
        tandem: options.tandem.createTandem('infoDialog')
      });
      Multilink.multilink([varModel.isInfoShowingProperty, varSceneModel.isVisibleProperty], (isInfoShowing, isVisible) => {
        if (isInfoShowing && isVisible) {
          infoDialog.show();
        } else {
          infoDialog.hide();
        }
      });
    }
    model.isShowingPlayAreaMedianProperty.link(this.updateMedianNode);
  }
}
centerAndVariability.register('SceneView', SceneView);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTb2NjZXJCYWxsTm9kZSIsIkFuaW1hdGlvbk1vZGUiLCJDQVZPYmplY3RUeXBlIiwiU29jY2VyUGxheWVyTm9kZSIsIkJvb2xlYW5Qcm9wZXJ0eSIsImNlbnRlckFuZFZhcmlhYmlsaXR5IiwiRHJhZ0luZGljYXRvckFycm93Tm9kZSIsIlBsYXlBcmVhTWVkaWFuSW5kaWNhdG9yTm9kZSIsIkluZm9EaWFsb2ciLCJNdWx0aWxpbmsiLCJTY2VuZVZpZXciLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwic2NlbmVNb2RlbCIsImJhY2tPYmplY3RMYXllciIsImZyb250T2JqZWN0TGF5ZXIiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJnZXRBY2NvcmRpb25Cb3giLCJvcHRpb25zIiwib2JqZWN0Tm9kZUdyb3VwVGFuZGVtIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwib2JqZWN0Tm9kZXNJbnB1dEVuYWJsZWRQcm9wZXJ0eSIsImRyYWdJbmRpY2F0b3JBcnJvd05vZGUiLCJ2aXNpYmxlIiwiYWRkQ2hpbGQiLCJ1cGRhdGVEcmFnSW5kaWN0YXRvclZpc2libGUiLCJzb2NjZXJCYWxsQ291bnRQcm9wZXJ0eSIsInZhbHVlIiwibWF4U29jY2VyQmFsbHMiLCJfIiwiZXZlcnkiLCJzb2NjZXJCYWxscyIsInNvY2NlckJhbGwiLCJ2YWx1ZVByb3BlcnR5Iiwic29jY2VyQmFsbEhhc0JlZW5EcmFnZ2VkUHJvcGVydHkiLCJsYXN0QmFsbCIsImxlbmd0aCIsImNlbnRlclgiLCJtb2RlbFRvVmlld1giLCJkcmFnSW5kaWNhdG9yQXJyb3dOb2RlTWFyZ2luIiwidG9wT2JqZWN0UG9zaXRpb25ZIiwibW9kZWxUb1ZpZXdZIiwiZ2V0T3RoZXJPYmplY3RzQXRUYXJnZXQiLCJNYXRoIiwiYWJzIiwibW9kZWxUb1ZpZXdEZWx0YVkiLCJTT0NDRVJfQkFMTCIsInJhZGl1cyIsImJvdHRvbSIsImxpbmsiLCJmb3JFYWNoIiwiaW5kZXgiLCJzb2NjZXJCYWxsTm9kZSIsImlzVmlzaWJsZVByb3BlcnR5IiwiaXNTaG93aW5nUGxheUFyZWFNZWRpYW5Qcm9wZXJ0eSIsImFuaW1hdGlvbk1vZGVQcm9wZXJ0eSIsImxhenlMaW5rIiwiYW5pbWF0aW9uTW9kZSIsIm9sZEFuaW1hdGlvbk1vZGVsIiwiRkxZSU5HIiwicmVtb3ZlQ2hpbGQiLCJvbGRWYWx1ZSIsInBsYXlBcmVhTWVkaWFuSW5kaWNhdG9yTm9kZSIsInVwZGF0ZU1lZGlhbk5vZGUiLCJtZWRpYW5WYWx1ZSIsIm1lZGlhblZhbHVlUHJvcGVydHkiLCJiYWxsc0F0TG9jYXRpb24iLCJmaWx0ZXIiLCJtb2RlbEhlaWdodCIsInZpZXdIZWlnaHQiLCJhY2NvcmRpb25Cb3giLCJhY2NvcmRpb25Cb3hIZWlnaHQiLCJleHBhbmRlZFByb3BlcnR5IiwiZ2V0RXhwYW5kZWRCb3hIZWlnaHQiLCJnZXRDb2xsYXBzZWRCb3hIZWlnaHQiLCJ0b3AiLCJvYmplY3RDaGFuZ2VkRW1pdHRlciIsImFkZExpc3RlbmVyIiwic29jY2VyUGxheWVyTm9kZXMiLCJzb2NjZXJQbGF5ZXJzIiwibWFwIiwic29jY2VyUGxheWVyIiwic29jY2VyUGxheWVyTm9kZSIsInZhck1vZGVsIiwidmFyU2NlbmVNb2RlbCIsImlzSW5mb1Nob3dpbmdQcm9wZXJ0eSIsInNlbGVjdGVkU2NlbmVNb2RlbFByb3BlcnR5IiwiaW5mb0RpYWxvZyIsIm11bHRpbGluayIsImlzSW5mb1Nob3dpbmciLCJpc1Zpc2libGUiLCJzaG93IiwiaGlkZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiU2NlbmVWaWV3LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbmltcG9ydCB7IE5vZGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgU29jY2VyQmFsbE5vZGUgZnJvbSAnLi9Tb2NjZXJCYWxsTm9kZS5qcyc7XHJcbmltcG9ydCB7IEFuaW1hdGlvbk1vZGUgfSBmcm9tICcuLi9tb2RlbC9BbmltYXRpb25Nb2RlLmpzJztcclxuaW1wb3J0IENBVk9iamVjdFR5cGUgZnJvbSAnLi4vbW9kZWwvQ0FWT2JqZWN0VHlwZS5qcyc7XHJcbmltcG9ydCBDQVZTY2VuZU1vZGVsIGZyb20gJy4uL21vZGVsL0NBVlNjZW5lTW9kZWwuanMnO1xyXG5pbXBvcnQgU29jY2VyUGxheWVyTm9kZSBmcm9tICcuL1NvY2NlclBsYXllck5vZGUuanMnO1xyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IENBVk1vZGVsIGZyb20gJy4uL21vZGVsL0NBVk1vZGVsLmpzJztcclxuaW1wb3J0IGNlbnRlckFuZFZhcmlhYmlsaXR5IGZyb20gJy4uLy4uL2NlbnRlckFuZFZhcmlhYmlsaXR5LmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgRHJhZ0luZGljYXRvckFycm93Tm9kZSBmcm9tICcuL0RyYWdJbmRpY2F0b3JBcnJvd05vZGUuanMnO1xyXG5pbXBvcnQgUGxheUFyZWFNZWRpYW5JbmRpY2F0b3JOb2RlIGZyb20gJy4vUGxheUFyZWFNZWRpYW5JbmRpY2F0b3JOb2RlLmpzJztcclxuaW1wb3J0IEFjY29yZGlvbkJveCBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvQWNjb3JkaW9uQm94LmpzJztcclxuaW1wb3J0IEluZm9EaWFsb2cgZnJvbSAnLi4vLi4vdmFyaWFiaWxpdHkvdmlldy9JbmZvRGlhbG9nLmpzJztcclxuaW1wb3J0IFZhcmlhYmlsaXR5U2NlbmVNb2RlbCBmcm9tICcuLi8uLi92YXJpYWJpbGl0eS9tb2RlbC9WYXJpYWJpbGl0eVNjZW5lTW9kZWwuanMnO1xyXG5pbXBvcnQgVmFyaWFiaWxpdHlNb2RlbCBmcm9tICcuLi8uLi92YXJpYWJpbGl0eS9tb2RlbC9WYXJpYWJpbGl0eU1vZGVsLmpzJztcclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY2VuZVZpZXcge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IHVwZGF0ZU1lZGlhbk5vZGU6ICgpID0+IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihcclxuICAgIG1vZGVsOiBDQVZNb2RlbCxcclxuICAgIHNjZW5lTW9kZWw6IENBVlNjZW5lTW9kZWwsXHJcbiAgICBiYWNrT2JqZWN0TGF5ZXI6IE5vZGUsXHJcbiAgICBmcm9udE9iamVjdExheWVyOiBOb2RlLFxyXG4gICAgbW9kZWxWaWV3VHJhbnNmb3JtOiBNb2RlbFZpZXdUcmFuc2Zvcm0yLFxyXG4gICAgZ2V0QWNjb3JkaW9uQm94OiAoKSA9PiBBY2NvcmRpb25Cb3ggfCBudWxsLFxyXG4gICAgb3B0aW9uczogeyB0YW5kZW06IFRhbmRlbSB9ICkge1xyXG5cclxuICAgIGNvbnN0IG9iamVjdE5vZGVHcm91cFRhbmRlbSA9IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3NvY2NlckJhbGxOb2RlR3JvdXAnICk7XHJcblxyXG4gICAgY29uc3Qgb2JqZWN0Tm9kZXNJbnB1dEVuYWJsZWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUsIHtcclxuICAgICAgdGFuZGVtOiBvYmplY3ROb2RlR3JvdXBUYW5kZW0uY3JlYXRlVGFuZGVtKCAnaW5wdXRFbmFibGVkUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBkcmFnSW5kaWNhdG9yQXJyb3dOb2RlID0gbmV3IERyYWdJbmRpY2F0b3JBcnJvd05vZGUoIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdkcmFnSW5kaWNhdG9yQXJyb3dOb2RlJyApLFxyXG4gICAgICB2aXNpYmxlOiBmYWxzZVxyXG4gICAgfSApO1xyXG5cclxuICAgIGJhY2tPYmplY3RMYXllci5hZGRDaGlsZCggZHJhZ0luZGljYXRvckFycm93Tm9kZSApO1xyXG5cclxuICAgIGNvbnN0IHVwZGF0ZURyYWdJbmRpY3RhdG9yVmlzaWJsZSA9ICgpID0+IHtcclxuXHJcbiAgICAgIC8vIGFkZCB0aGUgZHJhZ0luZGljYXRvckFycm93Tm9kZSBhYm92ZSB0aGUgbGFzdCBvYmplY3Qgd2hlbiBpdCBpcyBhZGRlZCB0byB0aGUgcGxheSBhcmVhLiBpZiBhbiBvYmplY3Qgd2FzXHJcbiAgICAgIC8vIG1vdmVkIGJlZm9yZSB0aGlzIGhhcHBlbnMsIGRvbid0IHNob3cgdGhlIGRyYWdJbmRpY2F0b3JBcnJvd05vZGVcclxuICAgICAgaWYgKCBzY2VuZU1vZGVsLnNvY2NlckJhbGxDb3VudFByb3BlcnR5LnZhbHVlID09PSBzY2VuZU1vZGVsLm1heFNvY2NlckJhbGxzICYmXHJcbiAgICAgICAgICAgb2JqZWN0Tm9kZXNJbnB1dEVuYWJsZWRQcm9wZXJ0eS52YWx1ZSAmJlxyXG4gICAgICAgICAgIF8uZXZlcnkoIHNjZW5lTW9kZWwuc29jY2VyQmFsbHMsIHNvY2NlckJhbGwgPT4gc29jY2VyQmFsbC52YWx1ZVByb3BlcnR5LnZhbHVlICE9PSBudWxsICkgJiZcclxuICAgICAgICAgICAhbW9kZWwuc29jY2VyQmFsbEhhc0JlZW5EcmFnZ2VkUHJvcGVydHkudmFsdWUgKSB7XHJcblxyXG4gICAgICAgIGNvbnN0IGxhc3RCYWxsID0gc2NlbmVNb2RlbC5zb2NjZXJCYWxsc1sgc2NlbmVNb2RlbC5zb2NjZXJCYWxscy5sZW5ndGggLSAxIF07XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBsYXN0QmFsbC52YWx1ZVByb3BlcnR5LnZhbHVlITtcclxuXHJcbiAgICAgICAgZHJhZ0luZGljYXRvckFycm93Tm9kZS5jZW50ZXJYID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WCggdmFsdWUgKTtcclxuXHJcbiAgICAgICAgY29uc3QgZHJhZ0luZGljYXRvckFycm93Tm9kZU1hcmdpbiA9IDY7XHJcblxyXG4gICAgICAgIC8vIGNhbGN1bGF0ZSB3aGVyZSB0aGUgdG9wIG9iamVjdCBpc1xyXG4gICAgICAgIGNvbnN0IHRvcE9iamVjdFBvc2l0aW9uWSA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1koIDAgKSAtXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCBzY2VuZU1vZGVsLmdldE90aGVyT2JqZWN0c0F0VGFyZ2V0KCBsYXN0QmFsbCApLmxlbmd0aCArIDEgKSAqXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWSggQ0FWT2JqZWN0VHlwZS5TT0NDRVJfQkFMTC5yYWRpdXMgKSApICogMiAtXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ0luZGljYXRvckFycm93Tm9kZU1hcmdpbjtcclxuXHJcbiAgICAgICAgZHJhZ0luZGljYXRvckFycm93Tm9kZS5ib3R0b20gPSB0b3BPYmplY3RQb3NpdGlvblk7XHJcbiAgICAgICAgZHJhZ0luZGljYXRvckFycm93Tm9kZS52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBkcmFnSW5kaWNhdG9yQXJyb3dOb2RlLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBtb2RlbC5zb2NjZXJCYWxsSGFzQmVlbkRyYWdnZWRQcm9wZXJ0eS5saW5rKCB1cGRhdGVEcmFnSW5kaWN0YXRvclZpc2libGUgKTtcclxuXHJcbiAgICBzY2VuZU1vZGVsLnNvY2NlckJhbGxzLmZvckVhY2goICggc29jY2VyQmFsbCwgaW5kZXggKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNvY2NlckJhbGxOb2RlID0gbmV3IFNvY2NlckJhbGxOb2RlKFxyXG4gICAgICAgIHNvY2NlckJhbGwsXHJcbiAgICAgICAgc2NlbmVNb2RlbC5pc1Zpc2libGVQcm9wZXJ0eSxcclxuICAgICAgICBtb2RlbC5pc1Nob3dpbmdQbGF5QXJlYU1lZGlhblByb3BlcnR5LFxyXG4gICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgICBvYmplY3ROb2Rlc0lucHV0RW5hYmxlZFByb3BlcnR5LCB7XHJcbiAgICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3NvY2NlckJhbGxzJyApLmNyZWF0ZVRhbmRlbSggJ3NvY2NlckJhbGxOb2RlJyArIGluZGV4IClcclxuICAgICAgICB9ICk7XHJcblxyXG4gICAgICBiYWNrT2JqZWN0TGF5ZXIuYWRkQ2hpbGQoIHNvY2NlckJhbGxOb2RlICk7XHJcblxyXG4gICAgICAvLyBXaGlsZSBmbHlpbmcsIGl0IHNob3VsZCBiZSBpbiBmcm9udCBpbiB6LW9yZGVyLCB0byBiZSBpbiBmcm9udCBvZiB0aGUgYWNjb3JkaW9uIGJveFxyXG4gICAgICBzb2NjZXJCYWxsLmFuaW1hdGlvbk1vZGVQcm9wZXJ0eS5sYXp5TGluayggKCBhbmltYXRpb25Nb2RlLCBvbGRBbmltYXRpb25Nb2RlbCApID0+IHtcclxuICAgICAgICBpZiAoIGFuaW1hdGlvbk1vZGUgPT09IEFuaW1hdGlvbk1vZGUuRkxZSU5HICkge1xyXG4gICAgICAgICAgYmFja09iamVjdExheWVyLnJlbW92ZUNoaWxkKCBzb2NjZXJCYWxsTm9kZSApO1xyXG4gICAgICAgICAgZnJvbnRPYmplY3RMYXllci5hZGRDaGlsZCggc29jY2VyQmFsbE5vZGUgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIG9sZEFuaW1hdGlvbk1vZGVsICkge1xyXG4gICAgICAgICAgZnJvbnRPYmplY3RMYXllci5yZW1vdmVDaGlsZCggc29jY2VyQmFsbE5vZGUgKTtcclxuICAgICAgICAgIGJhY2tPYmplY3RMYXllci5hZGRDaGlsZCggc29jY2VyQmFsbE5vZGUgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIHNvY2NlckJhbGwudmFsdWVQcm9wZXJ0eS5saW5rKCAoIHZhbHVlLCBvbGRWYWx1ZSApID0+IHVwZGF0ZURyYWdJbmRpY3RhdG9yVmlzaWJsZSgpICk7XHJcblxyXG4gICAgICBzb2NjZXJCYWxsLnZhbHVlUHJvcGVydHkubGluayggKCB2YWx1ZSwgb2xkVmFsdWUgKSA9PiB7XHJcblxyXG4gICAgICAgIC8vIElmIHRoZSB2YWx1ZSBjaGFuZ2VkIGZyb20gbnVtZXJpYyB0byBudW1lcmljLCBpdCBtdXN0IGhhdmUgYmVlbiBieSB1c2VyIGRyYWdnaW5nIGl0LlxyXG4gICAgICAgIC8vIEl0J3Mgc2ltcGxlciB0byBoYXZlIHRoZSBsaXN0ZW5lciBoZXJlIGJlY2F1c2UgaW4gdGhlIG1vZGVsIG9yIGRyYWcgbGlzdGVuZXIsIHRoZXJlIGlzIHJvdW5kaW5nL3NuYXBwaW5nXHJcbiAgICAgICAgLy8gQW5kIHdlIG9ubHkgd2FudCB0byBoaWRlIHRoZSBpbmRpY2F0b3Igb2YgdGhlIHVzZXIgZHJhZ2dlZCB0aGUgYmFsbCBhIGZ1bGwgdGljayBtYXJrXHJcbiAgICAgICAgaWYgKCBvbGRWYWx1ZSAhPT0gbnVsbCApIHtcclxuICAgICAgICAgIG1vZGVsLnNvY2NlckJhbGxIYXNCZWVuRHJhZ2dlZFByb3BlcnR5LnZhbHVlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBwbGF5QXJlYU1lZGlhbkluZGljYXRvck5vZGUgPSBuZXcgUGxheUFyZWFNZWRpYW5JbmRpY2F0b3JOb2RlKCk7XHJcbiAgICBmcm9udE9iamVjdExheWVyLmFkZENoaWxkKCBwbGF5QXJlYU1lZGlhbkluZGljYXRvck5vZGUgKTtcclxuXHJcbiAgICB0aGlzLnVwZGF0ZU1lZGlhbk5vZGUgPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1lZGlhblZhbHVlID0gc2NlbmVNb2RlbC5tZWRpYW5WYWx1ZVByb3BlcnR5LnZhbHVlO1xyXG4gICAgICBjb25zdCB2aXNpYmxlID0gbWVkaWFuVmFsdWUgIT09IG51bGwgJiYgbW9kZWwuaXNTaG93aW5nUGxheUFyZWFNZWRpYW5Qcm9wZXJ0eS52YWx1ZSAmJiBzY2VuZU1vZGVsLmlzVmlzaWJsZVByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgICAgaWYgKCB2aXNpYmxlICkge1xyXG5cclxuICAgICAgICAvLyBpZiB0aGVyZSBpcyBhIGJhbGwgYXQgdGhhdCBsb2NhdGlvbiwgZ28gYWJvdmUgdGhlIGJhbGxcclxuICAgICAgICBjb25zdCBiYWxsc0F0TG9jYXRpb24gPSBzY2VuZU1vZGVsLnNvY2NlckJhbGxzLmZpbHRlciggc29jY2VyQmFsbCA9PiBzb2NjZXJCYWxsLnZhbHVlUHJvcGVydHkudmFsdWUgPT09IG1lZGlhblZhbHVlICk7XHJcbiAgICAgICAgY29uc3QgbW9kZWxIZWlnaHQgPSBiYWxsc0F0TG9jYXRpb24ubGVuZ3RoICogQ0FWT2JqZWN0VHlwZS5TT0NDRVJfQkFMTC5yYWRpdXMgKiAyOyAvLyBhc3N1bWVzIG5vIHNwYWNpbmdcclxuXHJcbiAgICAgICAgY29uc3Qgdmlld0hlaWdodCA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWSggbW9kZWxIZWlnaHQgKTtcclxuXHJcbiAgICAgICAgcGxheUFyZWFNZWRpYW5JbmRpY2F0b3JOb2RlLmNlbnRlclggPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCBtZWRpYW5WYWx1ZSApO1xyXG4gICAgICAgIHBsYXlBcmVhTWVkaWFuSW5kaWNhdG9yTm9kZS5ib3R0b20gPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdZKCAwICkgKyB2aWV3SGVpZ2h0O1xyXG5cclxuICAgICAgICBjb25zdCBhY2NvcmRpb25Cb3ggPSBnZXRBY2NvcmRpb25Cb3goKTtcclxuXHJcbiAgICAgICAgLy8gVGhlIGFycm93IHNob3VsZG4ndCBvdmVybGFwIHRoZSBhY2NvcmRpb24gYm94XHJcbiAgICAgICAgaWYgKCBhY2NvcmRpb25Cb3ggKSB7XHJcbiAgICAgICAgICBjb25zdCBhY2NvcmRpb25Cb3hIZWlnaHQgPSBhY2NvcmRpb25Cb3guZXhwYW5kZWRQcm9wZXJ0eS52YWx1ZSA/IGFjY29yZGlvbkJveC5nZXRFeHBhbmRlZEJveEhlaWdodCgpIDogYWNjb3JkaW9uQm94LmdldENvbGxhcHNlZEJveEhlaWdodCgpO1xyXG4gICAgICAgICAgaWYgKCBwbGF5QXJlYU1lZGlhbkluZGljYXRvck5vZGUudG9wIDwgYWNjb3JkaW9uQm94LnRvcCArIGFjY29yZGlvbkJveEhlaWdodCApIHtcclxuICAgICAgICAgICAgcGxheUFyZWFNZWRpYW5JbmRpY2F0b3JOb2RlLnRvcCA9IGFjY29yZGlvbkJveC50b3AgKyBhY2NvcmRpb25Cb3hIZWlnaHQgKyA0O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBwbGF5QXJlYU1lZGlhbkluZGljYXRvck5vZGUudmlzaWJsZSA9IHZpc2libGU7XHJcbiAgICB9O1xyXG4gICAgc2NlbmVNb2RlbC5tZWRpYW5WYWx1ZVByb3BlcnR5LmxpbmsoIHRoaXMudXBkYXRlTWVkaWFuTm9kZSApO1xyXG4gICAgc2NlbmVNb2RlbC5vYmplY3RDaGFuZ2VkRW1pdHRlci5hZGRMaXN0ZW5lciggdGhpcy51cGRhdGVNZWRpYW5Ob2RlICk7XHJcbiAgICBzY2VuZU1vZGVsLmlzVmlzaWJsZVByb3BlcnR5LmxpbmsoIHRoaXMudXBkYXRlTWVkaWFuTm9kZSApO1xyXG5cclxuICAgIGNvbnN0IHNvY2NlclBsYXllck5vZGVzID0gc2NlbmVNb2RlbC5zb2NjZXJQbGF5ZXJzLm1hcCggc29jY2VyUGxheWVyID0+IG5ldyBTb2NjZXJQbGF5ZXJOb2RlKCBzb2NjZXJQbGF5ZXIsIG1vZGVsVmlld1RyYW5zZm9ybSwgc2NlbmVNb2RlbC5pc1Zpc2libGVQcm9wZXJ0eSApICk7XHJcblxyXG4gICAgc29jY2VyUGxheWVyTm9kZXMuZm9yRWFjaCggc29jY2VyUGxheWVyTm9kZSA9PiBmcm9udE9iamVjdExheWVyLmFkZENoaWxkKCBzb2NjZXJQbGF5ZXJOb2RlICkgKTtcclxuXHJcbiAgICBjb25zdCB2YXJNb2RlbCA9IG1vZGVsIGFzIFZhcmlhYmlsaXR5TW9kZWw7XHJcbiAgICBjb25zdCB2YXJTY2VuZU1vZGVsID0gc2NlbmVNb2RlbCBhcyBWYXJpYWJpbGl0eVNjZW5lTW9kZWw7XHJcblxyXG4gICAgaWYgKCB2YXJNb2RlbCAmJiB2YXJNb2RlbC5pc0luZm9TaG93aW5nUHJvcGVydHkgJiYgdmFyTW9kZWwuc2VsZWN0ZWRTY2VuZU1vZGVsUHJvcGVydHkgJiYgdmFyU2NlbmVNb2RlbCApIHtcclxuICAgICAgY29uc3QgaW5mb0RpYWxvZyA9IG5ldyBJbmZvRGlhbG9nKCB2YXJNb2RlbCwgdmFyU2NlbmVNb2RlbCwge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnaW5mb0RpYWxvZycgKVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIHZhck1vZGVsLmlzSW5mb1Nob3dpbmdQcm9wZXJ0eSwgdmFyU2NlbmVNb2RlbC5pc1Zpc2libGVQcm9wZXJ0eSBdLFxyXG4gICAgICAgICggaXNJbmZvU2hvd2luZywgaXNWaXNpYmxlICkgPT4ge1xyXG4gICAgICAgICAgaWYgKCBpc0luZm9TaG93aW5nICYmIGlzVmlzaWJsZSApIHtcclxuICAgICAgICAgICAgaW5mb0RpYWxvZy5zaG93KCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaW5mb0RpYWxvZy5oaWRlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSApO1xyXG4gICAgfVxyXG5cclxuICAgIG1vZGVsLmlzU2hvd2luZ1BsYXlBcmVhTWVkaWFuUHJvcGVydHkubGluayggdGhpcy51cGRhdGVNZWRpYW5Ob2RlICk7XHJcbiAgfVxyXG59XHJcblxyXG5jZW50ZXJBbmRWYXJpYWJpbGl0eS5yZWdpc3RlciggJ1NjZW5lVmlldycsIFNjZW5lVmlldyApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBR0EsT0FBT0EsY0FBYyxNQUFNLHFCQUFxQjtBQUNoRCxTQUFTQyxhQUFhLFFBQVEsMkJBQTJCO0FBQ3pELE9BQU9DLGFBQWEsTUFBTSwyQkFBMkI7QUFFckQsT0FBT0MsZ0JBQWdCLE1BQU0sdUJBQXVCO0FBQ3BELE9BQU9DLGVBQWUsTUFBTSx3Q0FBd0M7QUFHcEUsT0FBT0Msb0JBQW9CLE1BQU0sK0JBQStCO0FBRWhFLE9BQU9DLHNCQUFzQixNQUFNLDZCQUE2QjtBQUNoRSxPQUFPQywyQkFBMkIsTUFBTSxrQ0FBa0M7QUFFMUUsT0FBT0MsVUFBVSxNQUFNLHNDQUFzQztBQUc3RCxPQUFPQyxTQUFTLE1BQU0sa0NBQWtDO0FBRXhELGVBQWUsTUFBTUMsU0FBUyxDQUFDO0VBSXRCQyxXQUFXQSxDQUNoQkMsS0FBZSxFQUNmQyxVQUF5QixFQUN6QkMsZUFBcUIsRUFDckJDLGdCQUFzQixFQUN0QkMsa0JBQXVDLEVBQ3ZDQyxlQUEwQyxFQUMxQ0MsT0FBMkIsRUFBRztJQUU5QixNQUFNQyxxQkFBcUIsR0FBR0QsT0FBTyxDQUFDRSxNQUFNLENBQUNDLFlBQVksQ0FBRSxxQkFBc0IsQ0FBQztJQUVsRixNQUFNQywrQkFBK0IsR0FBRyxJQUFJbEIsZUFBZSxDQUFFLElBQUksRUFBRTtNQUNqRWdCLE1BQU0sRUFBRUQscUJBQXFCLENBQUNFLFlBQVksQ0FBRSxzQkFBdUI7SUFDckUsQ0FBRSxDQUFDO0lBRUgsTUFBTUUsc0JBQXNCLEdBQUcsSUFBSWpCLHNCQUFzQixDQUFFO01BQ3pEYyxNQUFNLEVBQUVGLE9BQU8sQ0FBQ0UsTUFBTSxDQUFDQyxZQUFZLENBQUUsd0JBQXlCLENBQUM7TUFDL0RHLE9BQU8sRUFB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