// Copyright 2023, University of Colorado Boulder

/**
 * RangeNode overlays a range indicator on the plot. It is used in both the accordion and info views.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import MedianBarNode from '../../common/view/MedianBarNode.js';
import { ManualConstraint, Rectangle, Text } from '../../../../scenery/js/imports.js';
import centerAndVariability from '../../centerAndVariability.js';
import CenterAndVariabilityStrings from '../../CenterAndVariabilityStrings.js';
import CAVPlotNode from '../../common/view/CAVPlotNode.js';
import CAVObjectType from '../../common/model/CAVObjectType.js';
import CAVConstants from '../../common/CAVConstants.js';
import CAVColors from '../../common/CAVColors.js';
import VariabilityReadoutText from './VariabilityReadoutText.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
export default class RangeNode extends CAVPlotNode {
  constructor(model, sceneModel, providedOptions) {
    const options = providedOptions;
    super(model, sceneModel, {
      dataPointFill: CAVColors.grayDataPointFill,
      ...options
    });
    if (options.parentContext === 'accordion') {
      const rangeReadoutValueProperty = new DerivedProperty([sceneModel.rangeValueProperty], rangeValue => {
        return rangeValue ? `${rangeValue}` : '?';
      });
      const rangeReadoutText = new VariabilityReadoutText(rangeReadoutValueProperty, CenterAndVariabilityStrings.rangeEqualsValuePatternStringProperty, {
        fill: CAVColors.meanColorProperty,
        visibleProperty: model.isShowingRangeProperty,
        right: this.left,
        y: this.centerY,
        tandem: options.tandem.createTandem('rangeReadoutText')
      });
      this.addChild(rangeReadoutText);
    }
    const needAtLeastOneKickText = new Text(CenterAndVariabilityStrings.needAtLeastOneKickStringProperty, {
      fontSize: 18,
      top: 100,
      maxWidth: CAVConstants.INFO_DIALOG_MAX_TEXT_WIDTH
    });
    ManualConstraint.create(this, [needAtLeastOneKickText], textProxy => {
      needAtLeastOneKickText.center = this.modelViewTransform.modelToViewXY(8, 2);
    });
    this.addChild(needAtLeastOneKickText);
    const rangeTextReadout = new Text('', {
      font: new PhetFont(13)
    });
    const rangeBar = new MedianBarNode({
      notchDirection: 'down',
      barStyle: 'continuous',
      stroke: 'black',
      lineWidth: 1
    });
    const rectangleHeight = 70;
    const rangeRectangle = new Rectangle(0, 50, 100, rectangleHeight, {
      fill: '#c3fdb9',
      stroke: 'lightGray'
    });
    this.addChild(rangeBar);
    this.addChild(rangeRectangle);
    this.addChild(rangeTextReadout);
    const updateRangeNode = () => {
      const sortedDots = _.sortBy(sceneModel.getActiveSoccerBalls().filter(soccerBall => soccerBall.valueProperty.value !== null), object => object.valueProperty.value);
      const leftmostDot = sortedDots[0];
      const rightmostDot = sortedDots[sortedDots.length - 1];

      // Only redraw the shape if the feature is selected and the data is sorted, and there is at least one card
      const hasNonZeroRange = leftmostDot && rightmostDot && leftmostDot.valueProperty.value !== rightmostDot.valueProperty.value;
      if (hasNonZeroRange) {
        const left = this.modelViewTransform.modelToViewX(leftmostDot.valueProperty.value);
        const right = this.modelViewTransform.modelToViewX(rightmostDot.valueProperty.value);
        const highestYValue = this.modelViewTransform.modelToViewY(_.maxBy(sortedDots, dot => dot.positionProperty.value.y).positionProperty.value.y);
        const floor = this.modelViewTransform.modelToViewY(0);
        if (options.parentContext === 'info') {
          rangeRectangle.rectHeight = Math.max(floor - highestYValue + this.modelViewTransform.modelToViewDeltaX(CAVObjectType.DATA_POINT.radius), rectangleHeight);
        }
        rangeRectangle.rectWidth = right - left;
        rangeRectangle.left = left;
        rangeRectangle.bottom = floor;
        rangeBar.setMedianBarShape(rangeRectangle.top - MedianBarNode.NOTCH_HEIGHT - 2, rangeRectangle.left, 0, rangeRectangle.right, false);
        rangeTextReadout.string = sceneModel.rangeValueProperty.value + '';
        rangeTextReadout.centerX = rangeRectangle.centerX;
        rangeTextReadout.bottom = rangeBar.top - 5;
      }
      const rangeVisibility = options.parentContext === 'info' && hasNonZeroRange || options.parentContext === 'accordion' && hasNonZeroRange && model.isShowingRangeProperty.value;
      rangeRectangle.visible = rangeVisibility;
      rangeBar.visible = rangeVisibility;
      rangeTextReadout.visible = rangeVisibility;
      needAtLeastOneKickText.visible = sceneModel.numberOfDataPointsProperty.value === 0 && (options.parentContext === 'info' || options.parentContext === 'accordion' && model.isShowingRangeProperty.value);
    };
    sceneModel.objectChangedEmitter.addListener(updateRangeNode);
    model.isShowingRangeProperty.link(updateRangeNode);
    model.selectedVariabilityProperty.link(updateRangeNode);
    sceneModel.numberOfDataPointsProperty.link(updateRangeNode);
    rangeRectangle.moveToBack();
  }
}
centerAndVariability.register('RangeNode', RangeNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQaGV0Rm9udCIsIk1lZGlhbkJhck5vZGUiLCJNYW51YWxDb25zdHJhaW50IiwiUmVjdGFuZ2xlIiwiVGV4dCIsImNlbnRlckFuZFZhcmlhYmlsaXR5IiwiQ2VudGVyQW5kVmFyaWFiaWxpdHlTdHJpbmdzIiwiQ0FWUGxvdE5vZGUiLCJDQVZPYmplY3RUeXBlIiwiQ0FWQ29uc3RhbnRzIiwiQ0FWQ29sb3JzIiwiVmFyaWFiaWxpdHlSZWFkb3V0VGV4dCIsIkRlcml2ZWRQcm9wZXJ0eSIsIlJhbmdlTm9kZSIsImNvbnN0cnVjdG9yIiwibW9kZWwiLCJzY2VuZU1vZGVsIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImRhdGFQb2ludEZpbGwiLCJncmF5RGF0YVBvaW50RmlsbCIsInBhcmVudENvbnRleHQiLCJyYW5nZVJlYWRvdXRWYWx1ZVByb3BlcnR5IiwicmFuZ2VWYWx1ZVByb3BlcnR5IiwicmFuZ2VWYWx1ZSIsInJhbmdlUmVhZG91dFRleHQiLCJyYW5nZUVxdWFsc1ZhbHVlUGF0dGVyblN0cmluZ1Byb3BlcnR5IiwiZmlsbCIsIm1lYW5Db2xvclByb3BlcnR5IiwidmlzaWJsZVByb3BlcnR5IiwiaXNTaG93aW5nUmFuZ2VQcm9wZXJ0eSIsInJpZ2h0IiwibGVmdCIsInkiLCJjZW50ZXJZIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwiYWRkQ2hpbGQiLCJuZWVkQXRMZWFzdE9uZUtpY2tUZXh0IiwibmVlZEF0TGVhc3RPbmVLaWNrU3RyaW5nUHJvcGVydHkiLCJmb250U2l6ZSIsInRvcCIsIm1heFdpZHRoIiwiSU5GT19ESUFMT0dfTUFYX1RFWFRfV0lEVEgiLCJjcmVhdGUiLCJ0ZXh0UHJveHkiLCJjZW50ZXIiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJtb2RlbFRvVmlld1hZIiwicmFuZ2VUZXh0UmVhZG91dCIsImZvbnQiLCJyYW5nZUJhciIsIm5vdGNoRGlyZWN0aW9uIiwiYmFyU3R5bGUiLCJzdHJva2UiLCJsaW5lV2lkdGgiLCJyZWN0YW5nbGVIZWlnaHQiLCJyYW5nZVJlY3RhbmdsZSIsInVwZGF0ZVJhbmdlTm9kZSIsInNvcnRlZERvdHMiLCJfIiwic29ydEJ5IiwiZ2V0QWN0aXZlU29jY2VyQmFsbHMiLCJmaWx0ZXIiLCJzb2NjZXJCYWxsIiwidmFsdWVQcm9wZXJ0eSIsInZhbHVlIiwib2JqZWN0IiwibGVmdG1vc3REb3QiLCJyaWdodG1vc3REb3QiLCJsZW5ndGgiLCJoYXNOb25aZXJvUmFuZ2UiLCJtb2RlbFRvVmlld1giLCJoaWdoZXN0WVZhbHVlIiwibW9kZWxUb1ZpZXdZIiwibWF4QnkiLCJkb3QiLCJwb3NpdGlvblByb3BlcnR5IiwiZmxvb3IiLCJyZWN0SGVpZ2h0IiwiTWF0aCIsIm1heCIsIm1vZGVsVG9WaWV3RGVsdGFYIiwiREFUQV9QT0lOVCIsInJhZGl1cyIsInJlY3RXaWR0aCIsImJvdHRvbSIsInNldE1lZGlhbkJhclNoYXBlIiwiTk9UQ0hfSEVJR0hUIiwic3RyaW5nIiwiY2VudGVyWCIsInJhbmdlVmlzaWJpbGl0eSIsInZpc2libGUiLCJudW1iZXJPZkRhdGFQb2ludHNQcm9wZXJ0eSIsIm9iamVjdENoYW5nZWRFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJsaW5rIiwic2VsZWN0ZWRWYXJpYWJpbGl0eVByb3BlcnR5IiwibW92ZVRvQmFjayIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUmFuZ2VOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBSYW5nZU5vZGUgb3ZlcmxheXMgYSByYW5nZSBpbmRpY2F0b3Igb24gdGhlIHBsb3QuIEl0IGlzIHVzZWQgaW4gYm90aCB0aGUgYWNjb3JkaW9uIGFuZCBpbmZvIHZpZXdzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUGhldEZvbnQuanMnO1xyXG5pbXBvcnQgTWVkaWFuQmFyTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9NZWRpYW5CYXJOb2RlLmpzJztcclxuaW1wb3J0IHsgTWFudWFsQ29uc3RyYWludCwgUmVjdGFuZ2xlLCBUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGNlbnRlckFuZFZhcmlhYmlsaXR5IGZyb20gJy4uLy4uL2NlbnRlckFuZFZhcmlhYmlsaXR5LmpzJztcclxuaW1wb3J0IFZhcmlhYmlsaXR5TW9kZWwgZnJvbSAnLi4vbW9kZWwvVmFyaWFiaWxpdHlNb2RlbC5qcyc7XHJcbmltcG9ydCBDZW50ZXJBbmRWYXJpYWJpbGl0eVN0cmluZ3MgZnJvbSAnLi4vLi4vQ2VudGVyQW5kVmFyaWFiaWxpdHlTdHJpbmdzLmpzJztcclxuaW1wb3J0IENBVlBsb3ROb2RlLCB7IENBVlBsb3RPcHRpb25zIH0gZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvQ0FWUGxvdE5vZGUuanMnO1xyXG5pbXBvcnQgQ0FWT2JqZWN0VHlwZSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvQ0FWT2JqZWN0VHlwZS5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IENBVkNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vQ0FWQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IENBVkNvbG9ycyBmcm9tICcuLi8uLi9jb21tb24vQ0FWQ29sb3JzLmpzJztcclxuaW1wb3J0IFZhcmlhYmlsaXR5UmVhZG91dFRleHQgZnJvbSAnLi9WYXJpYWJpbGl0eVJlYWRvdXRUZXh0LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBWYXJpYWJpbGl0eVNjZW5lTW9kZWwgZnJvbSAnLi4vbW9kZWwvVmFyaWFiaWxpdHlTY2VuZU1vZGVsLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgcGFyZW50Q29udGV4dDogJ2FjY29yZGlvbicgfCAnaW5mbyc7XHJcbn07XHJcbnR5cGUgUmFuZ2VOb2RlT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxDQVZQbG90T3B0aW9ucywgJ2RhdGFQb2ludEZpbGwnPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJhbmdlTm9kZSBleHRlbmRzIENBVlBsb3ROb2RlIHtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG1vZGVsOiBWYXJpYWJpbGl0eU1vZGVsLCBzY2VuZU1vZGVsOiBWYXJpYWJpbGl0eVNjZW5lTW9kZWwsIHByb3ZpZGVkT3B0aW9uczogUmFuZ2VOb2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gcHJvdmlkZWRPcHRpb25zO1xyXG5cclxuICAgIHN1cGVyKCBtb2RlbCwgc2NlbmVNb2RlbCwge1xyXG4gICAgICBkYXRhUG9pbnRGaWxsOiBDQVZDb2xvcnMuZ3JheURhdGFQb2ludEZpbGwsXHJcbiAgICAgIC4uLm9wdGlvbnNcclxuICAgIH0gKTtcclxuXHJcbiAgICBpZiAoIG9wdGlvbnMucGFyZW50Q29udGV4dCA9PT0gJ2FjY29yZGlvbicgKSB7XHJcbiAgICAgIGNvbnN0IHJhbmdlUmVhZG91dFZhbHVlUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIHNjZW5lTW9kZWwucmFuZ2VWYWx1ZVByb3BlcnR5IF0sIHJhbmdlVmFsdWUgPT4ge1xyXG4gICAgICAgIHJldHVybiByYW5nZVZhbHVlID8gYCR7cmFuZ2VWYWx1ZX1gIDogJz8nO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICBjb25zdCByYW5nZVJlYWRvdXRUZXh0ID0gbmV3IFZhcmlhYmlsaXR5UmVhZG91dFRleHQoIHJhbmdlUmVhZG91dFZhbHVlUHJvcGVydHksXHJcbiAgICAgICAgQ2VudGVyQW5kVmFyaWFiaWxpdHlTdHJpbmdzLnJhbmdlRXF1YWxzVmFsdWVQYXR0ZXJuU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgICAgIGZpbGw6IENBVkNvbG9ycy5tZWFuQ29sb3JQcm9wZXJ0eSxcclxuICAgICAgICAgIHZpc2libGVQcm9wZXJ0eTogbW9kZWwuaXNTaG93aW5nUmFuZ2VQcm9wZXJ0eSxcclxuICAgICAgICAgIHJpZ2h0OiB0aGlzLmxlZnQsXHJcbiAgICAgICAgICB5OiB0aGlzLmNlbnRlclksXHJcbiAgICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3JhbmdlUmVhZG91dFRleHQnIClcclxuICAgICAgICB9ICk7XHJcblxyXG4gICAgICB0aGlzLmFkZENoaWxkKCByYW5nZVJlYWRvdXRUZXh0ICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbmVlZEF0TGVhc3RPbmVLaWNrVGV4dCA9IG5ldyBUZXh0KCBDZW50ZXJBbmRWYXJpYWJpbGl0eVN0cmluZ3MubmVlZEF0TGVhc3RPbmVLaWNrU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgZm9udFNpemU6IDE4LFxyXG4gICAgICB0b3A6IDEwMCxcclxuICAgICAgbWF4V2lkdGg6IENBVkNvbnN0YW50cy5JTkZPX0RJQUxPR19NQVhfVEVYVF9XSURUSFxyXG4gICAgfSApO1xyXG5cclxuICAgIE1hbnVhbENvbnN0cmFpbnQuY3JlYXRlKCB0aGlzLCBbIG5lZWRBdExlYXN0T25lS2lja1RleHQgXSwgdGV4dFByb3h5ID0+IHtcclxuICAgICAgbmVlZEF0TGVhc3RPbmVLaWNrVGV4dC5jZW50ZXIgPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1hZKCA4LCAyICk7XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBuZWVkQXRMZWFzdE9uZUtpY2tUZXh0ICk7XHJcblxyXG4gICAgY29uc3QgcmFuZ2VUZXh0UmVhZG91dCA9IG5ldyBUZXh0KCAnJywge1xyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIDEzIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCByYW5nZUJhciA9IG5ldyBNZWRpYW5CYXJOb2RlKCB7XHJcbiAgICAgIG5vdGNoRGlyZWN0aW9uOiAnZG93bicsXHJcbiAgICAgIGJhclN0eWxlOiAnY29udGludW91cycsXHJcbiAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgbGluZVdpZHRoOiAxXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCByZWN0YW5nbGVIZWlnaHQgPSA3MDtcclxuICAgIGNvbnN0IHJhbmdlUmVjdGFuZ2xlID0gbmV3IFJlY3RhbmdsZSggMCwgNTAsIDEwMCwgcmVjdGFuZ2xlSGVpZ2h0LCB7XHJcbiAgICAgIGZpbGw6ICcjYzNmZGI5JyxcclxuICAgICAgc3Ryb2tlOiAnbGlnaHRHcmF5J1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggcmFuZ2VCYXIgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHJhbmdlUmVjdGFuZ2xlICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCByYW5nZVRleHRSZWFkb3V0ICk7XHJcblxyXG4gICAgY29uc3QgdXBkYXRlUmFuZ2VOb2RlID0gKCkgPT4ge1xyXG5cclxuICAgICAgY29uc3Qgc29ydGVkRG90cyA9IF8uc29ydEJ5KCBzY2VuZU1vZGVsLmdldEFjdGl2ZVNvY2NlckJhbGxzKCkuZmlsdGVyKCBzb2NjZXJCYWxsID0+IHNvY2NlckJhbGwudmFsdWVQcm9wZXJ0eS52YWx1ZSAhPT0gbnVsbCApLFxyXG4gICAgICAgIG9iamVjdCA9PiBvYmplY3QudmFsdWVQcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgICBjb25zdCBsZWZ0bW9zdERvdCA9IHNvcnRlZERvdHNbIDAgXTtcclxuICAgICAgY29uc3QgcmlnaHRtb3N0RG90ID0gc29ydGVkRG90c1sgc29ydGVkRG90cy5sZW5ndGggLSAxIF07XHJcblxyXG4gICAgICAvLyBPbmx5IHJlZHJhdyB0aGUgc2hhcGUgaWYgdGhlIGZlYXR1cmUgaXMgc2VsZWN0ZWQgYW5kIHRoZSBkYXRhIGlzIHNvcnRlZCwgYW5kIHRoZXJlIGlzIGF0IGxlYXN0IG9uZSBjYXJkXHJcbiAgICAgIGNvbnN0IGhhc05vblplcm9SYW5nZSA9IGxlZnRtb3N0RG90ICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0bW9zdERvdCAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0bW9zdERvdC52YWx1ZVByb3BlcnR5LnZhbHVlICE9PSByaWdodG1vc3REb3QudmFsdWVQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgaWYgKCBoYXNOb25aZXJvUmFuZ2UgKSB7XHJcbiAgICAgICAgY29uc3QgbGVmdCA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WCggbGVmdG1vc3REb3QudmFsdWVQcm9wZXJ0eS52YWx1ZSEgKTtcclxuICAgICAgICBjb25zdCByaWdodCA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WCggcmlnaHRtb3N0RG90LnZhbHVlUHJvcGVydHkudmFsdWUhICk7XHJcbiAgICAgICAgY29uc3QgaGlnaGVzdFlWYWx1ZSA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WShcclxuICAgICAgICAgIF8ubWF4QnkoIHNvcnRlZERvdHMsIGRvdCA9PiBkb3QucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS55ICkhLnBvc2l0aW9uUHJvcGVydHkudmFsdWUueSApO1xyXG5cclxuXHJcbiAgICAgICAgY29uc3QgZmxvb3IgPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1koIDAgKTtcclxuXHJcbiAgICAgICAgaWYgKCBvcHRpb25zLnBhcmVudENvbnRleHQgPT09ICdpbmZvJyApIHtcclxuICAgICAgICAgIHJhbmdlUmVjdGFuZ2xlLnJlY3RIZWlnaHQgPSBNYXRoLm1heCggZmxvb3IgLSBoaWdoZXN0WVZhbHVlICsgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YVgoIENBVk9iamVjdFR5cGUuREFUQV9QT0lOVC5yYWRpdXMgKSxcclxuICAgICAgICAgICAgcmVjdGFuZ2xlSGVpZ2h0ICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJhbmdlUmVjdGFuZ2xlLnJlY3RXaWR0aCA9IHJpZ2h0IC0gbGVmdDtcclxuICAgICAgICByYW5nZVJlY3RhbmdsZS5sZWZ0ID0gbGVmdDtcclxuICAgICAgICByYW5nZVJlY3RhbmdsZS5ib3R0b20gPSBmbG9vcjtcclxuXHJcbiAgICAgICAgcmFuZ2VCYXIuc2V0TWVkaWFuQmFyU2hhcGUoIHJhbmdlUmVjdGFuZ2xlLnRvcCAtIE1lZGlhbkJhck5vZGUuTk9UQ0hfSEVJR0hUIC0gMiwgcmFuZ2VSZWN0YW5nbGUubGVmdCwgMCwgcmFuZ2VSZWN0YW5nbGUucmlnaHQsIGZhbHNlICk7XHJcblxyXG4gICAgICAgIHJhbmdlVGV4dFJlYWRvdXQuc3RyaW5nID0gc2NlbmVNb2RlbC5yYW5nZVZhbHVlUHJvcGVydHkudmFsdWUgKyAnJztcclxuICAgICAgICByYW5nZVRleHRSZWFkb3V0LmNlbnRlclggPSByYW5nZVJlY3RhbmdsZS5jZW50ZXJYO1xyXG4gICAgICAgIHJhbmdlVGV4dFJlYWRvdXQuYm90dG9tID0gcmFuZ2VCYXIudG9wIC0gNTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCByYW5nZVZpc2liaWxpdHkgPSAoIG9wdGlvbnMucGFyZW50Q29udGV4dCA9PT0gJ2luZm8nICYmIGhhc05vblplcm9SYW5nZSApIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICggb3B0aW9ucy5wYXJlbnRDb250ZXh0ID09PSAnYWNjb3JkaW9uJyAmJiBoYXNOb25aZXJvUmFuZ2UgJiYgbW9kZWwuaXNTaG93aW5nUmFuZ2VQcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgICByYW5nZVJlY3RhbmdsZS52aXNpYmxlID0gcmFuZ2VWaXNpYmlsaXR5O1xyXG4gICAgICByYW5nZUJhci52aXNpYmxlID0gcmFuZ2VWaXNpYmlsaXR5O1xyXG4gICAgICByYW5nZVRleHRSZWFkb3V0LnZpc2libGUgPSByYW5nZVZpc2liaWxpdHk7XHJcbiAgICAgIG5lZWRBdExlYXN0T25lS2lja1RleHQudmlzaWJsZSA9IHNjZW5lTW9kZWwubnVtYmVyT2ZEYXRhUG9pbnRzUHJvcGVydHkudmFsdWUgPT09IDAgJiYgKCBvcHRpb25zLnBhcmVudENvbnRleHQgPT09ICdpbmZvJyB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCBvcHRpb25zLnBhcmVudENvbnRleHQgPT09ICdhY2NvcmRpb24nICYmIG1vZGVsLmlzU2hvd2luZ1JhbmdlUHJvcGVydHkudmFsdWUgKSApO1xyXG4gICAgfTtcclxuICAgIHNjZW5lTW9kZWwub2JqZWN0Q2hhbmdlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIHVwZGF0ZVJhbmdlTm9kZSApO1xyXG4gICAgbW9kZWwuaXNTaG93aW5nUmFuZ2VQcm9wZXJ0eS5saW5rKCB1cGRhdGVSYW5nZU5vZGUgKTtcclxuICAgIG1vZGVsLnNlbGVjdGVkVmFyaWFiaWxpdHlQcm9wZXJ0eS5saW5rKCB1cGRhdGVSYW5nZU5vZGUgKTtcclxuICAgIHNjZW5lTW9kZWwubnVtYmVyT2ZEYXRhUG9pbnRzUHJvcGVydHkubGluayggdXBkYXRlUmFuZ2VOb2RlICk7XHJcbiAgICByYW5nZVJlY3RhbmdsZS5tb3ZlVG9CYWNrKCk7XHJcbiAgfVxyXG59XHJcblxyXG5jZW50ZXJBbmRWYXJpYWJpbGl0eS5yZWdpc3RlciggJ1JhbmdlTm9kZScsIFJhbmdlTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxRQUFRLE1BQU0seUNBQXlDO0FBQzlELE9BQU9D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