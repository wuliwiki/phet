// Copyright 2023, University of Colorado Boulder

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import { Node, Circle, Rectangle, Text, VBox, HBox } from '../../../../scenery/js/imports.js';
import CenterAndVariabilityStrings from '../../CenterAndVariabilityStrings.js';
import PatternStringProperty from '../../../../axon/js/PatternStringProperty.js';
import centerAndVariability from '../../centerAndVariability.js';
import CAVConstants from '../../common/CAVConstants.js';
import IQRNode from './IQRNode.js';
import CAVColors from '../../common/CAVColors.js';
export default class IQRInfoNode extends VBox {
  constructor(model, sceneModel, options) {
    const hasAtLeastOneDataPointProperty = new DerivedProperty([sceneModel.numberOfDataPointsProperty], numberOfDataPoints => numberOfDataPoints >= 1);
    const hasEnoughDataForIQRProperty = new DerivedProperty([sceneModel.numberOfDataPointsProperty], numberOfDataPoints => numberOfDataPoints >= 5);
    const dataValuesLabel = new Text(CenterAndVariabilityStrings.iqrDataValuesStringProperty, {
      visibleProperty: hasAtLeastOneDataPointProperty,
      fontSize: 18,
      maxWidth: CAVConstants.INFO_DIALOG_MAX_TEXT_WIDTH
    });
    const dataValueNode = (distance, isLastValue, isMedian, isQuartile) => {
      const distanceLabelNode = new Node();
      const dataValueText = new Text(distance, {
        fontSize: 18,
        centerX: 0,
        centerY: 0
      });
      if (isMedian) {
        const MEDIAN_UNDERLINE_RECT_WIDTH = 16;
        const underlineRect = new Rectangle(-0.5 * MEDIAN_UNDERLINE_RECT_WIDTH, 8, MEDIAN_UNDERLINE_RECT_WIDTH, 3, {
          fill: CAVColors.medianColorProperty
        });
        distanceLabelNode.addChild(underlineRect);
      }
      if (isQuartile) {
        const backgroundCircle = new Circle(14, {
          fill: CAVColors.quartileColorProperty
        });
        distanceLabelNode.addChild(backgroundCircle);
      }
      distanceLabelNode.addChild(dataValueText);
      const dataValueNodeChildren = [distanceLabelNode];
      if (!isLastValue) {
        dataValueNodeChildren.push(new Text(',', {
          fontSize: 18
        }));
      }
      return new Node({
        children: dataValueNodeChildren
      });
    };
    const dataValues = [];
    const dataValuesContainer = new HBox({
      spacing: 5,
      children: dataValues,
      layoutOptions: {
        leftMargin: 5
      }
    });
    const dataValuesDisplay = new HBox({
      visibleProperty: hasAtLeastOneDataPointProperty,
      children: [dataValuesLabel, dataValuesContainer]
    });
    super({
      align: 'left',
      children: [new Text(CenterAndVariabilityStrings.interquartileRangeIQRStringProperty, {
        fontSize: 25,
        maxWidth: CAVConstants.INFO_DIALOG_MAX_TEXT_WIDTH,
        layoutOptions: {
          bottomMargin: 5
        }
      }), new Text(CenterAndVariabilityStrings.iqrDescriptionStringProperty, {
        fontSize: 18,
        maxWidth: CAVConstants.INFO_DIALOG_MAX_TEXT_WIDTH,
        layoutOptions: {
          bottomMargin: 15
        }
      }), dataValuesDisplay, new Text(new PatternStringProperty(CenterAndVariabilityStrings.iqrCalculationPattern1StringProperty, {
        q1: sceneModel.q1ValueProperty,
        q3: sceneModel.q3ValueProperty
      }), {
        fontSize: 18,
        visibleProperty: hasEnoughDataForIQRProperty,
        maxWidth: CAVConstants.INFO_DIALOG_MAX_TEXT_WIDTH,
        layoutOptions: {
          topMargin: 10
        }
      }), new Text(new PatternStringProperty(CenterAndVariabilityStrings.iqrCalculationPattern2StringProperty, {
        iqr: sceneModel.iqrValueProperty
      }), {
        fontSize: 18,
        visibleProperty: hasEnoughDataForIQRProperty,
        maxWidth: CAVConstants.INFO_DIALOG_MAX_TEXT_WIDTH
      }), new IQRNode(model, sceneModel, {
        parentContext: 'info',
        tandem: options.tandem.createTandem('iqrNode'),
        layoutOptions: {
          topMargin: 50
        }
      })]
    });
    const updateIQRInfoNode = () => {
      const sortedObjects = sceneModel.getSortedLandedObjects();
      const sortedData = sortedObjects.map(object => object.valueProperty.value);
      dataValuesContainer.setChildren(sortedData.map((dataValue, index) => {
        const soccerBall = sortedObjects[index];
        return dataValueNode(dataValue, index === sortedData.length - 1, soccerBall.isMedianObjectProperty.value, soccerBall.isQ1ObjectProperty.value || soccerBall.isQ3ObjectProperty.value);
      }));
    };
    sceneModel.objectChangedEmitter.addListener(updateIQRInfoNode);
    sceneModel.numberOfDataPointsProperty.link(updateIQRInfoNode);
  }
}
centerAndVariability.register('IQRInfoNode', IQRInfoNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJOb2RlIiwiQ2lyY2xlIiwiUmVjdGFuZ2xlIiwiVGV4dCIsIlZCb3giLCJIQm94IiwiQ2VudGVyQW5kVmFyaWFiaWxpdHlTdHJpbmdzIiwiUGF0dGVyblN0cmluZ1Byb3BlcnR5IiwiY2VudGVyQW5kVmFyaWFiaWxpdHkiLCJDQVZDb25zdGFudHMiLCJJUVJOb2RlIiwiQ0FWQ29sb3JzIiwiSVFSSW5mb05vZGUiLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwic2NlbmVNb2RlbCIsIm9wdGlvbnMiLCJoYXNBdExlYXN0T25lRGF0YVBvaW50UHJvcGVydHkiLCJudW1iZXJPZkRhdGFQb2ludHNQcm9wZXJ0eSIsIm51bWJlck9mRGF0YVBvaW50cyIsImhhc0Vub3VnaERhdGFGb3JJUVJQcm9wZXJ0eSIsImRhdGFWYWx1ZXNMYWJlbCIsImlxckRhdGFWYWx1ZXNTdHJpbmdQcm9wZXJ0eSIsInZpc2libGVQcm9wZXJ0eSIsImZvbnRTaXplIiwibWF4V2lkdGgiLCJJTkZPX0RJQUxPR19NQVhfVEVYVF9XSURUSCIsImRhdGFWYWx1ZU5vZGUiLCJkaXN0YW5jZSIsImlzTGFzdFZhbHVlIiwiaXNNZWRpYW4iLCJpc1F1YXJ0aWxlIiwiZGlzdGFuY2VMYWJlbE5vZGUiLCJkYXRhVmFsdWVUZXh0IiwiY2VudGVyWCIsImNlbnRlclkiLCJNRURJQU5fVU5ERVJMSU5FX1JFQ1RfV0lEVEgiLCJ1bmRlcmxpbmVSZWN0IiwiZmlsbCIsIm1lZGlhbkNvbG9yUHJvcGVydHkiLCJhZGRDaGlsZCIsImJhY2tncm91bmRDaXJjbGUiLCJxdWFydGlsZUNvbG9yUHJvcGVydHkiLCJkYXRhVmFsdWVOb2RlQ2hpbGRyZW4iLCJwdXNoIiwiY2hpbGRyZW4iLCJkYXRhVmFsdWVzIiwiZGF0YVZhbHVlc0NvbnRhaW5lciIsInNwYWNpbmciLCJsYXlvdXRPcHRpb25zIiwibGVmdE1hcmdpbiIsImRhdGFWYWx1ZXNEaXNwbGF5IiwiYWxpZ24iLCJpbnRlcnF1YXJ0aWxlUmFuZ2VJUVJTdHJpbmdQcm9wZXJ0eSIsImJvdHRvbU1hcmdpbiIsImlxckRlc2NyaXB0aW9uU3RyaW5nUHJvcGVydHkiLCJpcXJDYWxjdWxhdGlvblBhdHRlcm4xU3RyaW5nUHJvcGVydHkiLCJxMSIsInExVmFsdWVQcm9wZXJ0eSIsInEzIiwicTNWYWx1ZVByb3BlcnR5IiwidG9wTWFyZ2luIiwiaXFyQ2FsY3VsYXRpb25QYXR0ZXJuMlN0cmluZ1Byb3BlcnR5IiwiaXFyIiwiaXFyVmFsdWVQcm9wZXJ0eSIsInBhcmVudENvbnRleHQiLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJ1cGRhdGVJUVJJbmZvTm9kZSIsInNvcnRlZE9iamVjdHMiLCJnZXRTb3J0ZWRMYW5kZWRPYmplY3RzIiwic29ydGVkRGF0YSIsIm1hcCIsIm9iamVjdCIsInZhbHVlUHJvcGVydHkiLCJ2YWx1ZSIsInNldENoaWxkcmVuIiwiZGF0YVZhbHVlIiwiaW5kZXgiLCJzb2NjZXJCYWxsIiwibGVuZ3RoIiwiaXNNZWRpYW5PYmplY3RQcm9wZXJ0eSIsImlzUTFPYmplY3RQcm9wZXJ0eSIsImlzUTNPYmplY3RQcm9wZXJ0eSIsIm9iamVjdENoYW5nZWRFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJsaW5rIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJJUVJJbmZvTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgTm9kZSwgQ2lyY2xlLCBSZWN0YW5nbGUsIFRleHQsIFZCb3gsIEhCb3ggfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgQ2VudGVyQW5kVmFyaWFiaWxpdHlTdHJpbmdzIGZyb20gJy4uLy4uL0NlbnRlckFuZFZhcmlhYmlsaXR5U3RyaW5ncy5qcyc7XHJcbmltcG9ydCBQYXR0ZXJuU3RyaW5nUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9QYXR0ZXJuU3RyaW5nUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVmFyaWFiaWxpdHlNb2RlbCBmcm9tICcuLi9tb2RlbC9WYXJpYWJpbGl0eU1vZGVsLmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuaW1wb3J0IFBoZXRpb09iamVjdCBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvUGhldGlvT2JqZWN0LmpzJztcclxuaW1wb3J0IGNlbnRlckFuZFZhcmlhYmlsaXR5IGZyb20gJy4uLy4uL2NlbnRlckFuZFZhcmlhYmlsaXR5LmpzJztcclxuaW1wb3J0IENBVkNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vQ0FWQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IElRUk5vZGUgZnJvbSAnLi9JUVJOb2RlLmpzJztcclxuaW1wb3J0IFZhcmlhYmlsaXR5U2NlbmVNb2RlbCBmcm9tICcuLi9tb2RlbC9WYXJpYWJpbGl0eVNjZW5lTW9kZWwuanMnO1xyXG5pbXBvcnQgQ0FWQ29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi9DQVZDb2xvcnMuanMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSVFSSW5mb05vZGUgZXh0ZW5kcyBWQm94IHtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG1vZGVsOiBWYXJpYWJpbGl0eU1vZGVsLCBzY2VuZU1vZGVsOiBWYXJpYWJpbGl0eVNjZW5lTW9kZWwsIG9wdGlvbnM6IFBpY2tSZXF1aXJlZDxQaGV0aW9PYmplY3QsICd0YW5kZW0nPiApIHtcclxuXHJcbiAgICBjb25zdCBoYXNBdExlYXN0T25lRGF0YVBvaW50UHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIHNjZW5lTW9kZWwubnVtYmVyT2ZEYXRhUG9pbnRzUHJvcGVydHkgXSwgbnVtYmVyT2ZEYXRhUG9pbnRzID0+IG51bWJlck9mRGF0YVBvaW50cyA+PSAxICk7XHJcbiAgICBjb25zdCBoYXNFbm91Z2hEYXRhRm9ySVFSUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIHNjZW5lTW9kZWwubnVtYmVyT2ZEYXRhUG9pbnRzUHJvcGVydHkgXSwgbnVtYmVyT2ZEYXRhUG9pbnRzID0+IG51bWJlck9mRGF0YVBvaW50cyA+PSA1ICk7XHJcblxyXG4gICAgY29uc3QgZGF0YVZhbHVlc0xhYmVsID0gbmV3IFRleHQoIENlbnRlckFuZFZhcmlhYmlsaXR5U3RyaW5ncy5pcXJEYXRhVmFsdWVzU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiBoYXNBdExlYXN0T25lRGF0YVBvaW50UHJvcGVydHksXHJcbiAgICAgIGZvbnRTaXplOiAxOCxcclxuICAgICAgbWF4V2lkdGg6IENBVkNvbnN0YW50cy5JTkZPX0RJQUxPR19NQVhfVEVYVF9XSURUSFxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGRhdGFWYWx1ZU5vZGUgPSAoIGRpc3RhbmNlOiBudW1iZXIsIGlzTGFzdFZhbHVlOiBib29sZWFuLCBpc01lZGlhbjogYm9vbGVhbiwgaXNRdWFydGlsZTogYm9vbGVhbiApID0+IHtcclxuICAgICAgY29uc3QgZGlzdGFuY2VMYWJlbE5vZGUgPSBuZXcgTm9kZSgpO1xyXG4gICAgICBjb25zdCBkYXRhVmFsdWVUZXh0ID0gbmV3IFRleHQoIGRpc3RhbmNlLCB7IGZvbnRTaXplOiAxOCwgY2VudGVyWDogMCwgY2VudGVyWTogMCB9ICk7XHJcblxyXG4gICAgICBpZiAoIGlzTWVkaWFuICkge1xyXG4gICAgICAgIGNvbnN0IE1FRElBTl9VTkRFUkxJTkVfUkVDVF9XSURUSCA9IDE2O1xyXG4gICAgICAgIGNvbnN0IHVuZGVybGluZVJlY3QgPSBuZXcgUmVjdGFuZ2xlKCAtMC41ICogTUVESUFOX1VOREVSTElORV9SRUNUX1dJRFRILCA4LCBNRURJQU5fVU5ERVJMSU5FX1JFQ1RfV0lEVEgsIDMsIHsgZmlsbDogQ0FWQ29sb3JzLm1lZGlhbkNvbG9yUHJvcGVydHkgfSApO1xyXG4gICAgICAgIGRpc3RhbmNlTGFiZWxOb2RlLmFkZENoaWxkKCB1bmRlcmxpbmVSZWN0ICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICggaXNRdWFydGlsZSApIHtcclxuICAgICAgICBjb25zdCBiYWNrZ3JvdW5kQ2lyY2xlID0gbmV3IENpcmNsZSggMTQsIHsgZmlsbDogQ0FWQ29sb3JzLnF1YXJ0aWxlQ29sb3JQcm9wZXJ0eSB9ICk7XHJcbiAgICAgICAgZGlzdGFuY2VMYWJlbE5vZGUuYWRkQ2hpbGQoIGJhY2tncm91bmRDaXJjbGUgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZGlzdGFuY2VMYWJlbE5vZGUuYWRkQ2hpbGQoIGRhdGFWYWx1ZVRleHQgKTtcclxuXHJcbiAgICAgIGNvbnN0IGRhdGFWYWx1ZU5vZGVDaGlsZHJlbiA9IFsgZGlzdGFuY2VMYWJlbE5vZGUgXTtcclxuXHJcbiAgICAgIGlmICggIWlzTGFzdFZhbHVlICkge1xyXG4gICAgICAgIGRhdGFWYWx1ZU5vZGVDaGlsZHJlbi5wdXNoKCBuZXcgVGV4dCggJywnLCB7IGZvbnRTaXplOiAxOCB9ICkgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIG5ldyBOb2RlKCB7IGNoaWxkcmVuOiBkYXRhVmFsdWVOb2RlQ2hpbGRyZW4gfSApO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBkYXRhVmFsdWVzOiBOb2RlW10gPSBbXTtcclxuICAgIGNvbnN0IGRhdGFWYWx1ZXNDb250YWluZXIgPSBuZXcgSEJveCgge1xyXG4gICAgICBzcGFjaW5nOiA1LFxyXG4gICAgICBjaGlsZHJlbjogZGF0YVZhbHVlcyxcclxuICAgICAgbGF5b3V0T3B0aW9uczogeyBsZWZ0TWFyZ2luOiA1IH1cclxuICAgIH0gKTtcclxuICAgIGNvbnN0IGRhdGFWYWx1ZXNEaXNwbGF5ID0gbmV3IEhCb3goIHtcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiBoYXNBdExlYXN0T25lRGF0YVBvaW50UHJvcGVydHksXHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgZGF0YVZhbHVlc0xhYmVsLFxyXG4gICAgICAgIGRhdGFWYWx1ZXNDb250YWluZXJcclxuICAgICAgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIGFsaWduOiAnbGVmdCcsXHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgbmV3IFRleHQoIENlbnRlckFuZFZhcmlhYmlsaXR5U3RyaW5ncy5pbnRlcnF1YXJ0aWxlUmFuZ2VJUVJTdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICAgICAgZm9udFNpemU6IDI1LFxyXG4gICAgICAgICAgbWF4V2lkdGg6IENBVkNvbnN0YW50cy5JTkZPX0RJQUxPR19NQVhfVEVYVF9XSURUSCxcclxuICAgICAgICAgIGxheW91dE9wdGlvbnM6IHsgYm90dG9tTWFyZ2luOiA1IH1cclxuICAgICAgICB9ICksXHJcblxyXG4gICAgICAgIG5ldyBUZXh0KCBDZW50ZXJBbmRWYXJpYWJpbGl0eVN0cmluZ3MuaXFyRGVzY3JpcHRpb25TdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICAgICAgZm9udFNpemU6IDE4LFxyXG4gICAgICAgICAgbWF4V2lkdGg6IENBVkNvbnN0YW50cy5JTkZPX0RJQUxPR19NQVhfVEVYVF9XSURUSCxcclxuICAgICAgICAgIGxheW91dE9wdGlvbnM6IHsgYm90dG9tTWFyZ2luOiAxNSB9XHJcbiAgICAgICAgfSApLFxyXG5cclxuICAgICAgICBkYXRhVmFsdWVzRGlzcGxheSxcclxuXHJcbiAgICAgICAgbmV3IFRleHQoIG5ldyBQYXR0ZXJuU3RyaW5nUHJvcGVydHkoIENlbnRlckFuZFZhcmlhYmlsaXR5U3RyaW5ncy5pcXJDYWxjdWxhdGlvblBhdHRlcm4xU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgICAgIHExOiBzY2VuZU1vZGVsLnExVmFsdWVQcm9wZXJ0eSxcclxuICAgICAgICAgIHEzOiBzY2VuZU1vZGVsLnEzVmFsdWVQcm9wZXJ0eVxyXG4gICAgICAgIH0gKSwge1xyXG4gICAgICAgICAgZm9udFNpemU6IDE4LFxyXG4gICAgICAgICAgdmlzaWJsZVByb3BlcnR5OiBoYXNFbm91Z2hEYXRhRm9ySVFSUHJvcGVydHksXHJcbiAgICAgICAgICBtYXhXaWR0aDogQ0FWQ29uc3RhbnRzLklORk9fRElBTE9HX01BWF9URVhUX1dJRFRILFxyXG4gICAgICAgICAgbGF5b3V0T3B0aW9uczogeyB0b3BNYXJnaW46IDEwIH1cclxuICAgICAgICB9ICksXHJcblxyXG4gICAgICAgIG5ldyBUZXh0KCBuZXcgUGF0dGVyblN0cmluZ1Byb3BlcnR5KCBDZW50ZXJBbmRWYXJpYWJpbGl0eVN0cmluZ3MuaXFyQ2FsY3VsYXRpb25QYXR0ZXJuMlN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgICAgICBpcXI6IHNjZW5lTW9kZWwuaXFyVmFsdWVQcm9wZXJ0eVxyXG4gICAgICAgIH0gKSwgeyBmb250U2l6ZTogMTgsIHZpc2libGVQcm9wZXJ0eTogaGFzRW5vdWdoRGF0YUZvcklRUlByb3BlcnR5LCBtYXhXaWR0aDogQ0FWQ29uc3RhbnRzLklORk9fRElBTE9HX01BWF9URVhUX1dJRFRIIH0gKSxcclxuXHJcbiAgICAgICAgbmV3IElRUk5vZGUoIG1vZGVsLCBzY2VuZU1vZGVsLCB7XHJcbiAgICAgICAgICBwYXJlbnRDb250ZXh0OiAnaW5mbycsXHJcbiAgICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2lxck5vZGUnICksXHJcbiAgICAgICAgICBsYXlvdXRPcHRpb25zOiB7XHJcbiAgICAgICAgICAgIHRvcE1hcmdpbjogNTBcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IClcclxuICAgICAgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHVwZGF0ZUlRUkluZm9Ob2RlID0gKCkgPT4ge1xyXG4gICAgICBjb25zdCBzb3J0ZWRPYmplY3RzID0gc2NlbmVNb2RlbC5nZXRTb3J0ZWRMYW5kZWRPYmplY3RzKCk7XHJcbiAgICAgIGNvbnN0IHNvcnRlZERhdGEgPSBzb3J0ZWRPYmplY3RzLm1hcCggb2JqZWN0ID0+IG9iamVjdC52YWx1ZVByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gICAgICBkYXRhVmFsdWVzQ29udGFpbmVyLnNldENoaWxkcmVuKCBzb3J0ZWREYXRhLm1hcCggKCBkYXRhVmFsdWUsIGluZGV4ICkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNvY2NlckJhbGwgPSBzb3J0ZWRPYmplY3RzWyBpbmRleCBdO1xyXG4gICAgICAgIHJldHVybiBkYXRhVmFsdWVOb2RlKCBkYXRhVmFsdWUhLCBpbmRleCA9PT0gc29ydGVkRGF0YS5sZW5ndGggLSAxLCBzb2NjZXJCYWxsLmlzTWVkaWFuT2JqZWN0UHJvcGVydHkudmFsdWUsXHJcbiAgICAgICAgICBzb2NjZXJCYWxsLmlzUTFPYmplY3RQcm9wZXJ0eS52YWx1ZSB8fCBzb2NjZXJCYWxsLmlzUTNPYmplY3RQcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgICB9ICkgKTtcclxuICAgIH07XHJcblxyXG4gICAgc2NlbmVNb2RlbC5vYmplY3RDaGFuZ2VkRW1pdHRlci5hZGRMaXN0ZW5lciggdXBkYXRlSVFSSW5mb05vZGUgKTtcclxuICAgIHNjZW5lTW9kZWwubnVtYmVyT2ZEYXRhUG9pbnRzUHJvcGVydHkubGluayggdXBkYXRlSVFSSW5mb05vZGUgKTtcclxuICB9XHJcbn1cclxuXHJcbmNlbnRlckFuZFZhcmlhYmlsaXR5LnJlZ2lzdGVyKCAnSVFSSW5mb05vZGUnLCBJUVJJbmZvTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxTQUFTQyxJQUFJLEVBQUVDLE1BQU0sRUFBRUMsU0FBUyxFQUFFQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUM3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