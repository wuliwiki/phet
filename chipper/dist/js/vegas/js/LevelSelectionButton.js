// Copyright 2014-2023, University of Colorado Boulder

/**
 * Button for selecting a game level.
 * Includes an icon, score display, and (optional) 'best time' display.
 * See specification in https://github.com/phetsims/vegas/issues/59.
 * Originally named LevelSelectionItemNode, renamed to LevelSelectionButton on 4/10/2018.
 *
 * @author John Blanco
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Andrea Lin
 */

import Dimension2 from '../../dot/js/Dimension2.js';
import optionize from '../../phet-core/js/optionize.js';
import PhetFont from '../../scenery-phet/js/PhetFont.js';
import { Node, Rectangle, Text } from '../../scenery/js/imports.js';
import RectangularPushButton from '../../sun/js/buttons/RectangularPushButton.js';
import SoundClip from '../../tambo/js/sound-generators/SoundClip.js';
import soundConstants from '../../tambo/js/soundConstants.js';
import soundManager from '../../tambo/js/soundManager.js';
import Tandem from '../../tandem/js/Tandem.js';
import levelSelectionButton_mp3 from '../sounds/levelSelectionButton_mp3.js';
import GameTimer from './GameTimer.js';
import ScoreDisplayStars from './ScoreDisplayStars.js';
import vegas from './vegas.js';

// constants
const DEFAULT_BEST_TIME_FONT = new PhetFont(24);
const SCALING_TOLERANCE = 1E-4; // Empirically chosen as something the human eye is unlikely to notice.

export default class LevelSelectionButton extends RectangularPushButton {
  /**
   * @param icon - appears on the button above the score display, scaled to fit
   * @param scoreProperty
   * @param providedOptions
   */
  constructor(icon, scoreProperty, providedOptions) {
    const options = optionize()({
      // SelfOptions
      buttonWidth: 150,
      buttonHeight: 150,
      createScoreDisplay: () => new ScoreDisplayStars(scoreProperty),
      scoreDisplayProportion: 0.2,
      scoreDisplayMinXMargin: 10,
      scoreDisplayMinYMargin: 5,
      iconToScoreDisplayYSpace: 10,
      bestTimeProperty: null,
      bestTimeVisibleProperty: null,
      bestTimeFill: 'black',
      bestTimeFont: DEFAULT_BEST_TIME_FONT,
      bestTimeYSpacing: 10,
      // RectangularPushButton options
      cornerRadius: 10,
      baseColor: 'rgb( 242, 255, 204 )',
      xMargin: 10,
      yMargin: 10,
      soundPlayerIndex: 0,
      // phet-io
      tandem: Tandem.REQUIRED
    }, providedOptions);
    assert && assert(options.soundPlayerIndex >= 0, `invalid soundPlayerIndex: ${options.soundPlayerIndex}`);
    const maxContentWidth = options.buttonWidth - 2 * options.xMargin;
    const scoreDisplay = options.createScoreDisplay(scoreProperty);

    // Background behind scoreDisplay
    const scoreDisplayBackgroundHeight = options.buttonHeight * options.scoreDisplayProportion;
    const scoreDisplayBackground = new Rectangle(0, 0, maxContentWidth, scoreDisplayBackgroundHeight, {
      cornerRadius: options.cornerRadius,
      fill: 'white',
      stroke: 'black',
      pickable: false
    });

    // constrain scoreDisplay to fit in scoreDisplayBackground
    scoreDisplay.maxWidth = scoreDisplayBackground.width - 2 * options.scoreDisplayMinXMargin;
    scoreDisplay.maxHeight = scoreDisplayBackground.height - 2 * options.scoreDisplayMinYMargin;

    // Icon, scaled and padded to fit and to make the button size correct.
    const iconHeight = options.buttonHeight - scoreDisplayBackground.height - 2 * options.yMargin - options.iconToScoreDisplayYSpace;
    const iconSize = new Dimension2(maxContentWidth, iconHeight);
    const adjustedIcon = LevelSelectionButton.createSizedImageNode(icon, iconSize);
    adjustedIcon.centerX = scoreDisplayBackground.centerX;
    adjustedIcon.bottom = scoreDisplayBackground.top - options.iconToScoreDisplayYSpace;

    // Keep scoreDisplay centered in its background when its bounds change
    const scoreDisplayUpdateLayout = () => {
      scoreDisplay.center = scoreDisplayBackground.center;
    };
    scoreDisplay.boundsProperty.lazyLink(scoreDisplayUpdateLayout);
    scoreDisplayUpdateLayout();
    options.content = new Node({
      children: [adjustedIcon, scoreDisplayBackground, scoreDisplay]
    });

    // If no sound player was provided, create the default.
    if (options.soundPlayer === undefined) {
      const soundClip = new SoundClip(levelSelectionButton_mp3, {
        initialOutputLevel: 0.5,
        rateChangesAffectPlayingSounds: false
      });
      soundManager.addSoundGenerator(soundClip, {
        categoryName: 'user-interface'
      });
      options.soundPlayer = {
        play() {
          soundClip.setPlaybackRate(Math.pow(soundConstants.TWELFTH_ROOT_OF_TWO, options.soundPlayerIndex), 0);
          soundClip.play();
        },
        stop() {
          soundClip.stop();
        }
      };
    }
    super(options);

    // Variables that are set if options.bestTimeProperty is specified.
    let bestTimeListener = null;
    let bestTimeVisibleListener = null;

    // Best time decoration (optional), centered below the button, does not move when button is pressed
    if (options.bestTimeProperty) {
      const bestTimeNode = new Text('', {
        font: options.bestTimeFont,
        fill: options.bestTimeFill,
        maxWidth: this.width // constrain to width of the push button
      });

      const centerX = this.centerX;
      bestTimeNode.top = this.bottom + options.bestTimeYSpacing;
      this.addChild(bestTimeNode);
      bestTimeListener = bestTime => {
        if (bestTime !== null) {
          bestTimeNode.string = bestTime ? GameTimer.formatTime(bestTime) : '';
          bestTimeNode.centerX = centerX;
        }
      };
      options.bestTimeProperty.link(bestTimeListener);
      if (options.bestTimeVisibleProperty) {
        bestTimeVisibleListener = visible => {
          bestTimeNode.visible = visible;
        };
        options.bestTimeVisibleProperty.link(bestTimeVisibleListener);
      }
    }
    this.disposeLevelSelectionButton = () => {
      scoreDisplay.dispose();
      if (options.bestTimeProperty && bestTimeListener && options.bestTimeProperty.hasListener(bestTimeListener)) {
        options.bestTimeProperty.unlink(bestTimeListener);
      }
      if (options.bestTimeVisibleProperty && bestTimeVisibleListener && options.bestTimeVisibleProperty.hasListener(bestTimeVisibleListener)) {
        options.bestTimeVisibleProperty.unlink(bestTimeVisibleListener);
      }
    };
  }

  /**
   * Creates a new icon with the same dimensions as the specified icon. The new icon will be scaled to fit,
   * and a background with the specified size may be added to ensure that the bounds of the returned node are correct.
   */
  static createSizedImageNode(icon, size) {
    icon.scale(Math.min(size.width / icon.bounds.width, size.height / icon.bounds.height));
    if (Math.abs(icon.bounds.width - size.width) < SCALING_TOLERANCE && Math.abs(icon.bounds.height - size.height) < SCALING_TOLERANCE) {
      // The aspect ratio of the icon matched that of the specified size, so no padding is necessary.
      return icon;
    }

    // else padding is needed in either the horizontal or vertical direction.
    const background = Rectangle.dimension(size);
    icon.center = background.center;
    background.addChild(icon);
    return background;
  }
  dispose() {
    this.disposeLevelSelectionButton();
    super.dispose();
  }
}
vegas.register('LevelSelectionButton', LevelSelectionButton);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEaW1lbnNpb24yIiwib3B0aW9uaXplIiwiUGhldEZvbnQiLCJOb2RlIiwiUmVjdGFuZ2xlIiwiVGV4dCIsIlJlY3Rhbmd1bGFyUHVzaEJ1dHRvbiIsIlNvdW5kQ2xpcCIsInNvdW5kQ29uc3RhbnRzIiwic291bmRNYW5hZ2VyIiwiVGFuZGVtIiwibGV2ZWxTZWxlY3Rpb25CdXR0b25fbXAzIiwiR2FtZVRpbWVyIiwiU2NvcmVEaXNwbGF5U3RhcnMiLCJ2ZWdhcyIsIkRFRkFVTFRfQkVTVF9USU1FX0ZPTlQiLCJTQ0FMSU5HX1RPTEVSQU5DRSIsIkxldmVsU2VsZWN0aW9uQnV0dG9uIiwiY29uc3RydWN0b3IiLCJpY29uIiwic2NvcmVQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJidXR0b25XaWR0aCIsImJ1dHRvbkhlaWdodCIsImNyZWF0ZVNjb3JlRGlzcGxheSIsInNjb3JlRGlzcGxheVByb3BvcnRpb24iLCJzY29yZURpc3BsYXlNaW5YTWFyZ2luIiwic2NvcmVEaXNwbGF5TWluWU1hcmdpbiIsImljb25Ub1Njb3JlRGlzcGxheVlTcGFjZSIsImJlc3RUaW1lUHJvcGVydHkiLCJiZXN0VGltZVZpc2libGVQcm9wZXJ0eSIsImJlc3RUaW1lRmlsbCIsImJlc3RUaW1lRm9udCIsImJlc3RUaW1lWVNwYWNpbmciLCJjb3JuZXJSYWRpdXMiLCJiYXNlQ29sb3IiLCJ4TWFyZ2luIiwieU1hcmdpbiIsInNvdW5kUGxheWVySW5kZXgiLCJ0YW5kZW0iLCJSRVFVSVJFRCIsImFzc2VydCIsIm1heENvbnRlbnRXaWR0aCIsInNjb3JlRGlzcGxheSIsInNjb3JlRGlzcGxheUJhY2tncm91bmRIZWlnaHQiLCJzY29yZURpc3BsYXlCYWNrZ3JvdW5kIiwiZmlsbCIsInN0cm9rZSIsInBpY2thYmxlIiwibWF4V2lkdGgiLCJ3aWR0aCIsIm1heEhlaWdodCIsImhlaWdodCIsImljb25IZWlnaHQiLCJpY29uU2l6ZSIsImFkanVzdGVkSWNvbiIsImNyZWF0ZVNpemVkSW1hZ2VOb2RlIiwiY2VudGVyWCIsImJvdHRvbSIsInRvcCIsInNjb3JlRGlzcGxheVVwZGF0ZUxheW91dCIsImNlbnRlciIsImJvdW5kc1Byb3BlcnR5IiwibGF6eUxpbmsiLCJjb250ZW50IiwiY2hpbGRyZW4iLCJzb3VuZFBsYXllciIsInVuZGVmaW5lZCIsInNvdW5kQ2xpcCIsImluaXRpYWxPdXRwdXRMZXZlbCIsInJhdGVDaGFuZ2VzQWZmZWN0UGxheWluZ1NvdW5kcyIsImFkZFNvdW5kR2VuZXJhdG9yIiwiY2F0ZWdvcnlOYW1lIiwicGxheSIsInNldFBsYXliYWNrUmF0ZSIsIk1hdGgiLCJwb3ciLCJUV0VMRlRIX1JPT1RfT0ZfVFdPIiwic3RvcCIsImJlc3RUaW1lTGlzdGVuZXIiLCJiZXN0VGltZVZpc2libGVMaXN0ZW5lciIsImJlc3RUaW1lTm9kZSIsImZvbnQiLCJhZGRDaGlsZCIsImJlc3RUaW1lIiwic3RyaW5nIiwiZm9ybWF0VGltZSIsImxpbmsiLCJ2aXNpYmxlIiwiZGlzcG9zZUxldmVsU2VsZWN0aW9uQnV0dG9uIiwiZGlzcG9zZSIsImhhc0xpc3RlbmVyIiwidW5saW5rIiwic2l6ZSIsInNjYWxlIiwibWluIiwiYm91bmRzIiwiYWJzIiwiYmFja2dyb3VuZCIsImRpbWVuc2lvbiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTGV2ZWxTZWxlY3Rpb25CdXR0b24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQnV0dG9uIGZvciBzZWxlY3RpbmcgYSBnYW1lIGxldmVsLlxyXG4gKiBJbmNsdWRlcyBhbiBpY29uLCBzY29yZSBkaXNwbGF5LCBhbmQgKG9wdGlvbmFsKSAnYmVzdCB0aW1lJyBkaXNwbGF5LlxyXG4gKiBTZWUgc3BlY2lmaWNhdGlvbiBpbiBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvdmVnYXMvaXNzdWVzLzU5LlxyXG4gKiBPcmlnaW5hbGx5IG5hbWVkIExldmVsU2VsZWN0aW9uSXRlbU5vZGUsIHJlbmFtZWQgdG8gTGV2ZWxTZWxlY3Rpb25CdXR0b24gb24gNC8xMC8yMDE4LlxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqIEBhdXRob3IgQW5kcmVhIExpblxyXG4gKi9cclxuXHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IEZvbnQsIFRDb2xvciwgTm9kZSwgUmVjdGFuZ2xlLCBUZXh0IH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFJlY3Rhbmd1bGFyUHVzaEJ1dHRvbiwgeyBSZWN0YW5ndWxhclB1c2hCdXR0b25PcHRpb25zIH0gZnJvbSAnLi4vLi4vc3VuL2pzL2J1dHRvbnMvUmVjdGFuZ3VsYXJQdXNoQnV0dG9uLmpzJztcclxuaW1wb3J0IFNvdW5kQ2xpcCBmcm9tICcuLi8uLi90YW1iby9qcy9zb3VuZC1nZW5lcmF0b3JzL1NvdW5kQ2xpcC5qcyc7XHJcbmltcG9ydCBzb3VuZENvbnN0YW50cyBmcm9tICcuLi8uLi90YW1iby9qcy9zb3VuZENvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBzb3VuZE1hbmFnZXIgZnJvbSAnLi4vLi4vdGFtYm8vanMvc291bmRNYW5hZ2VyLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IGxldmVsU2VsZWN0aW9uQnV0dG9uX21wMyBmcm9tICcuLi9zb3VuZHMvbGV2ZWxTZWxlY3Rpb25CdXR0b25fbXAzLmpzJztcclxuaW1wb3J0IEdhbWVUaW1lciBmcm9tICcuL0dhbWVUaW1lci5qcyc7XHJcbmltcG9ydCBTY29yZURpc3BsYXlTdGFycyBmcm9tICcuL1Njb3JlRGlzcGxheVN0YXJzLmpzJztcclxuaW1wb3J0IHZlZ2FzIGZyb20gJy4vdmVnYXMuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IERFRkFVTFRfQkVTVF9USU1FX0ZPTlQgPSBuZXcgUGhldEZvbnQoIDI0ICk7XHJcbmNvbnN0IFNDQUxJTkdfVE9MRVJBTkNFID0gMUUtNDsgLy8gRW1waXJpY2FsbHkgY2hvc2VuIGFzIHNvbWV0aGluZyB0aGUgaHVtYW4gZXllIGlzIHVubGlrZWx5IHRvIG5vdGljZS5cclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcblxyXG4gIC8vIFVzZWQgdG8gc2l6ZSB0aGUgY29udGVudFxyXG4gIGJ1dHRvbldpZHRoPzogbnVtYmVyO1xyXG4gIGJ1dHRvbkhlaWdodD86IG51bWJlcjtcclxuXHJcbiAgLy8gc2NvcmUgZGlzcGxheVxyXG4gIGNyZWF0ZVNjb3JlRGlzcGxheT86ICggc2NvcmVQcm9wZXJ0eTogVFByb3BlcnR5PG51bWJlcj4gKSA9PiBOb2RlO1xyXG4gIHNjb3JlRGlzcGxheVByb3BvcnRpb24/OiBudW1iZXI7IC8vIHBlcmNlbnRhZ2Ugb2YgdGhlIGJ1dHRvbiBoZWlnaHQgb2NjdXBpZWQgYnkgc2NvcmVEaXNwbGF5LCAoMCwwLjVdXHJcbiAgc2NvcmVEaXNwbGF5TWluWE1hcmdpbj86IG51bWJlcjsgLy8gaG9yaXpvbnRhbCBtYXJnaW4gYmV0d2VlbiBzY29yZURpc3BsYXkgYW5kIGl0cyBiYWNrZ3JvdW5kXHJcbiAgc2NvcmVEaXNwbGF5TWluWU1hcmdpbj86IG51bWJlcjsgIC8vIHZlcnRpY2FsIG1hcmdpbiBiZXR3ZWVuIHNjb3JlRGlzcGxheSBhbmQgaXRzIGJhY2tncm91bmRcclxuICBpY29uVG9TY29yZURpc3BsYXlZU3BhY2U/OiBudW1iZXI7IC8vIHZlcnRpY2FsIHNwYWNlIGJldHdlZW4gaWNvbiBhbmQgc2NvcmUgZGlzcGxheVxyXG5cclxuICAvLyBiZXN0IHRpbWUgKG9wdGlvbmFsKVxyXG4gIGJlc3RUaW1lUHJvcGVydHk/OiBUUHJvcGVydHk8bnVtYmVyIHwgbnVsbD4gfCBudWxsOyAvLyBiZXN0IHRpbWUgaW4gc2Vjb25kcywgbnVsbCBpZiBubyBiZXN0IHRpbWVcclxuICBiZXN0VGltZVZpc2libGVQcm9wZXJ0eT86IFRQcm9wZXJ0eTxib29sZWFuPiB8IG51bGw7IC8vIGNvbnRyb2xzIHZpc2liaWxpdHkgb2YgYmVzdCB0aW1lLCBudWxsIGlmIG5vIGJlc3QgdGltZVxyXG4gIGJlc3RUaW1lRmlsbD86IFRDb2xvcjtcclxuICBiZXN0VGltZUZvbnQ/OiBGb250O1xyXG4gIGJlc3RUaW1lWVNwYWNpbmc/OiBudW1iZXI7ICAvLyB2ZXJ0aWNhbCBzcGFjZSBiZXR3ZWVuIGRyb3Agc2hhZG93IGFuZCBiZXN0IHRpbWVcclxuXHJcbiAgLy8gQ29uZmlndXJlcyB0aGUgc291bmRQbGF5ZXIgZm9yIGEgc3BlY2lmaWMgZ2FtZSBsZXZlbC4gTm90ZSB0aGF0IHRoaXMgYXNzdW1lcyB6ZXJvLWJhc2VkIGluZGV4aW5nIGZvciBnYW1lIGxldmVsLFxyXG4gIC8vIHdoaWNoIGlzIG9mdGVuIG5vdCB0aGUgY2FzZS4gVGhpcyBvcHRpb24gaXMgaWdub3JlZCBpZiBSZWN0YW5ndWxhclB1c2hCdXR0b25PcHRpb25zLnNvdW5kUGxheWVyIGlzIHByb3ZpZGVkLlxyXG4gIHNvdW5kUGxheWVySW5kZXg/OiBudW1iZXI7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBMZXZlbFNlbGVjdGlvbkJ1dHRvbk9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFN0cmljdE9taXQ8UmVjdGFuZ3VsYXJQdXNoQnV0dG9uT3B0aW9ucywgJ2NvbnRlbnQnPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExldmVsU2VsZWN0aW9uQnV0dG9uIGV4dGVuZHMgUmVjdGFuZ3VsYXJQdXNoQnV0dG9uIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlTGV2ZWxTZWxlY3Rpb25CdXR0b246ICgpID0+IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBpY29uIC0gYXBwZWFycyBvbiB0aGUgYnV0dG9uIGFib3ZlIHRoZSBzY29yZSBkaXNwbGF5LCBzY2FsZWQgdG8gZml0XHJcbiAgICogQHBhcmFtIHNjb3JlUHJvcGVydHlcclxuICAgKiBAcGFyYW0gcHJvdmlkZWRPcHRpb25zXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBpY29uOiBOb2RlLCBzY29yZVByb3BlcnR5OiBUUHJvcGVydHk8bnVtYmVyPiwgcHJvdmlkZWRPcHRpb25zPzogTGV2ZWxTZWxlY3Rpb25CdXR0b25PcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8TGV2ZWxTZWxlY3Rpb25CdXR0b25PcHRpb25zLCBTZWxmT3B0aW9ucywgUmVjdGFuZ3VsYXJQdXNoQnV0dG9uT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgYnV0dG9uV2lkdGg6IDE1MCxcclxuICAgICAgYnV0dG9uSGVpZ2h0OiAxNTAsXHJcbiAgICAgIGNyZWF0ZVNjb3JlRGlzcGxheTogKCkgPT4gbmV3IFNjb3JlRGlzcGxheVN0YXJzKCBzY29yZVByb3BlcnR5ICksXHJcbiAgICAgIHNjb3JlRGlzcGxheVByb3BvcnRpb246IDAuMixcclxuICAgICAgc2NvcmVEaXNwbGF5TWluWE1hcmdpbjogMTAsXHJcbiAgICAgIHNjb3JlRGlzcGxheU1pbllNYXJnaW46IDUsXHJcbiAgICAgIGljb25Ub1Njb3JlRGlzcGxheVlTcGFjZTogMTAsXHJcbiAgICAgIGJlc3RUaW1lUHJvcGVydHk6IG51bGwsXHJcbiAgICAgIGJlc3RUaW1lVmlzaWJsZVByb3BlcnR5OiBudWxsLFxyXG4gICAgICBiZXN0VGltZUZpbGw6ICdibGFjaycsXHJcbiAgICAgIGJlc3RUaW1lRm9udDogREVGQVVMVF9CRVNUX1RJTUVfRk9OVCxcclxuICAgICAgYmVzdFRpbWVZU3BhY2luZzogMTAsXHJcblxyXG4gICAgICAvLyBSZWN0YW5ndWxhclB1c2hCdXR0b24gb3B0aW9uc1xyXG4gICAgICBjb3JuZXJSYWRpdXM6IDEwLFxyXG4gICAgICBiYXNlQ29sb3I6ICdyZ2IoIDI0MiwgMjU1LCAyMDQgKScsXHJcbiAgICAgIHhNYXJnaW46IDEwLFxyXG4gICAgICB5TWFyZ2luOiAxMCxcclxuICAgICAgc291bmRQbGF5ZXJJbmRleDogMCxcclxuXHJcbiAgICAgIC8vIHBoZXQtaW9cclxuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRURcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMuc291bmRQbGF5ZXJJbmRleCA+PSAwLCBgaW52YWxpZCBzb3VuZFBsYXllckluZGV4OiAke29wdGlvbnMuc291bmRQbGF5ZXJJbmRleH1gICk7XHJcblxyXG4gICAgY29uc3QgbWF4Q29udGVudFdpZHRoID0gb3B0aW9ucy5idXR0b25XaWR0aCAtIDIgKiBvcHRpb25zLnhNYXJnaW47XHJcblxyXG4gICAgY29uc3Qgc2NvcmVEaXNwbGF5ID0gb3B0aW9ucy5jcmVhdGVTY29yZURpc3BsYXkoIHNjb3JlUHJvcGVydHkgKTtcclxuXHJcbiAgICAvLyBCYWNrZ3JvdW5kIGJlaGluZCBzY29yZURpc3BsYXlcclxuICAgIGNvbnN0IHNjb3JlRGlzcGxheUJhY2tncm91bmRIZWlnaHQgPSBvcHRpb25zLmJ1dHRvbkhlaWdodCAqIG9wdGlvbnMuc2NvcmVEaXNwbGF5UHJvcG9ydGlvbjtcclxuICAgIGNvbnN0IHNjb3JlRGlzcGxheUJhY2tncm91bmQgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBtYXhDb250ZW50V2lkdGgsIHNjb3JlRGlzcGxheUJhY2tncm91bmRIZWlnaHQsIHtcclxuICAgICAgY29ybmVyUmFkaXVzOiBvcHRpb25zLmNvcm5lclJhZGl1cyxcclxuICAgICAgZmlsbDogJ3doaXRlJyxcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBwaWNrYWJsZTogZmFsc2VcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBjb25zdHJhaW4gc2NvcmVEaXNwbGF5IHRvIGZpdCBpbiBzY29yZURpc3BsYXlCYWNrZ3JvdW5kXHJcbiAgICBzY29yZURpc3BsYXkubWF4V2lkdGggPSBzY29yZURpc3BsYXlCYWNrZ3JvdW5kLndpZHRoIC0gKCAyICogb3B0aW9ucy5zY29yZURpc3BsYXlNaW5YTWFyZ2luICk7XHJcbiAgICBzY29yZURpc3BsYXkubWF4SGVpZ2h0ID0gc2NvcmVEaXNwbGF5QmFja2dyb3VuZC5oZWlnaHQgLSAoIDIgKiBvcHRpb25zLnNjb3JlRGlzcGxheU1pbllNYXJnaW4gKTtcclxuXHJcbiAgICAvLyBJY29uLCBzY2FsZWQgYW5kIHBhZGRlZCB0byBmaXQgYW5kIHRvIG1ha2UgdGhlIGJ1dHRvbiBzaXplIGNvcnJlY3QuXHJcbiAgICBjb25zdCBpY29uSGVpZ2h0ID0gb3B0aW9ucy5idXR0b25IZWlnaHQgLSBzY29yZURpc3BsYXlCYWNrZ3JvdW5kLmhlaWdodCAtIDIgKiBvcHRpb25zLnlNYXJnaW4gLSBvcHRpb25zLmljb25Ub1Njb3JlRGlzcGxheVlTcGFjZTtcclxuICAgIGNvbnN0IGljb25TaXplID0gbmV3IERpbWVuc2lvbjIoIG1heENvbnRlbnRXaWR0aCwgaWNvbkhlaWdodCApO1xyXG4gICAgY29uc3QgYWRqdXN0ZWRJY29uID0gTGV2ZWxTZWxlY3Rpb25CdXR0b24uY3JlYXRlU2l6ZWRJbWFnZU5vZGUoIGljb24sIGljb25TaXplICk7XHJcbiAgICBhZGp1c3RlZEljb24uY2VudGVyWCA9IHNjb3JlRGlzcGxheUJhY2tncm91bmQuY2VudGVyWDtcclxuICAgIGFkanVzdGVkSWNvbi5ib3R0b20gPSBzY29yZURpc3BsYXlCYWNrZ3JvdW5kLnRvcCAtIG9wdGlvbnMuaWNvblRvU2NvcmVEaXNwbGF5WVNwYWNlO1xyXG5cclxuICAgIC8vIEtlZXAgc2NvcmVEaXNwbGF5IGNlbnRlcmVkIGluIGl0cyBiYWNrZ3JvdW5kIHdoZW4gaXRzIGJvdW5kcyBjaGFuZ2VcclxuICAgIGNvbnN0IHNjb3JlRGlzcGxheVVwZGF0ZUxheW91dCA9ICgpID0+IHtcclxuICAgICAgc2NvcmVEaXNwbGF5LmNlbnRlciA9IHNjb3JlRGlzcGxheUJhY2tncm91bmQuY2VudGVyO1xyXG4gICAgfTtcclxuICAgIHNjb3JlRGlzcGxheS5ib3VuZHNQcm9wZXJ0eS5sYXp5TGluayggc2NvcmVEaXNwbGF5VXBkYXRlTGF5b3V0ICk7XHJcbiAgICBzY29yZURpc3BsYXlVcGRhdGVMYXlvdXQoKTtcclxuXHJcbiAgICBvcHRpb25zLmNvbnRlbnQgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogWyBhZGp1c3RlZEljb24sIHNjb3JlRGlzcGxheUJhY2tncm91bmQsIHNjb3JlRGlzcGxheSBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gSWYgbm8gc291bmQgcGxheWVyIHdhcyBwcm92aWRlZCwgY3JlYXRlIHRoZSBkZWZhdWx0LlxyXG4gICAgaWYgKCBvcHRpb25zLnNvdW5kUGxheWVyID09PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgIGNvbnN0IHNvdW5kQ2xpcCA9IG5ldyBTb3VuZENsaXAoIGxldmVsU2VsZWN0aW9uQnV0dG9uX21wMywge1xyXG4gICAgICAgIGluaXRpYWxPdXRwdXRMZXZlbDogMC41LFxyXG4gICAgICAgIHJhdGVDaGFuZ2VzQWZmZWN0UGxheWluZ1NvdW5kczogZmFsc2VcclxuICAgICAgfSApO1xyXG4gICAgICBzb3VuZE1hbmFnZXIuYWRkU291bmRHZW5lcmF0b3IoIHNvdW5kQ2xpcCwgeyBjYXRlZ29yeU5hbWU6ICd1c2VyLWludGVyZmFjZScgfSApO1xyXG4gICAgICBvcHRpb25zLnNvdW5kUGxheWVyID0ge1xyXG4gICAgICAgIHBsYXkoKSB7XHJcbiAgICAgICAgICBzb3VuZENsaXAuc2V0UGxheWJhY2tSYXRlKCBNYXRoLnBvdyggc291bmRDb25zdGFudHMuVFdFTEZUSF9ST09UX09GX1RXTywgb3B0aW9ucy5zb3VuZFBsYXllckluZGV4ICksIDAgKTtcclxuICAgICAgICAgIHNvdW5kQ2xpcC5wbGF5KCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzdG9wKCkge1xyXG4gICAgICAgICAgc291bmRDbGlwLnN0b3AoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBWYXJpYWJsZXMgdGhhdCBhcmUgc2V0IGlmIG9wdGlvbnMuYmVzdFRpbWVQcm9wZXJ0eSBpcyBzcGVjaWZpZWQuXHJcbiAgICBsZXQgYmVzdFRpbWVMaXN0ZW5lcjogKCAoIGJlc3RUaW1lOiBudW1iZXIgfCBudWxsICkgPT4gdm9pZCApIHwgbnVsbCA9IG51bGw7XHJcbiAgICBsZXQgYmVzdFRpbWVWaXNpYmxlTGlzdGVuZXI6ICggKCB2aXNpYmxlOiBib29sZWFuICkgPT4gdm9pZCApIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gICAgLy8gQmVzdCB0aW1lIGRlY29yYXRpb24gKG9wdGlvbmFsKSwgY2VudGVyZWQgYmVsb3cgdGhlIGJ1dHRvbiwgZG9lcyBub3QgbW92ZSB3aGVuIGJ1dHRvbiBpcyBwcmVzc2VkXHJcbiAgICBpZiAoIG9wdGlvbnMuYmVzdFRpbWVQcm9wZXJ0eSApIHtcclxuXHJcbiAgICAgIGNvbnN0IGJlc3RUaW1lTm9kZSA9IG5ldyBUZXh0KCAnJywge1xyXG4gICAgICAgIGZvbnQ6IG9wdGlvbnMuYmVzdFRpbWVGb250LFxyXG4gICAgICAgIGZpbGw6IG9wdGlvbnMuYmVzdFRpbWVGaWxsLFxyXG4gICAgICAgIG1heFdpZHRoOiB0aGlzLndpZHRoIC8vIGNvbnN0cmFpbiB0byB3aWR0aCBvZiB0aGUgcHVzaCBidXR0b25cclxuICAgICAgfSApO1xyXG4gICAgICBjb25zdCBjZW50ZXJYID0gdGhpcy5jZW50ZXJYO1xyXG4gICAgICBiZXN0VGltZU5vZGUudG9wID0gdGhpcy5ib3R0b20gKyBvcHRpb25zLmJlc3RUaW1lWVNwYWNpbmc7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIGJlc3RUaW1lTm9kZSApO1xyXG5cclxuICAgICAgYmVzdFRpbWVMaXN0ZW5lciA9ICggYmVzdFRpbWU6IG51bWJlciB8IG51bGwgKSA9PiB7XHJcbiAgICAgICAgaWYgKCBiZXN0VGltZSAhPT0gbnVsbCApIHtcclxuICAgICAgICAgIGJlc3RUaW1lTm9kZS5zdHJpbmcgPSAoIGJlc3RUaW1lID8gR2FtZVRpbWVyLmZvcm1hdFRpbWUoIGJlc3RUaW1lICkgOiAnJyApO1xyXG4gICAgICAgICAgYmVzdFRpbWVOb2RlLmNlbnRlclggPSBjZW50ZXJYO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgb3B0aW9ucy5iZXN0VGltZVByb3BlcnR5LmxpbmsoIGJlc3RUaW1lTGlzdGVuZXIgKTtcclxuXHJcbiAgICAgIGlmICggb3B0aW9ucy5iZXN0VGltZVZpc2libGVQcm9wZXJ0eSApIHtcclxuICAgICAgICBiZXN0VGltZVZpc2libGVMaXN0ZW5lciA9ICggdmlzaWJsZTogYm9vbGVhbiApID0+IHtcclxuICAgICAgICAgIGJlc3RUaW1lTm9kZS52aXNpYmxlID0gdmlzaWJsZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIG9wdGlvbnMuYmVzdFRpbWVWaXNpYmxlUHJvcGVydHkubGluayggYmVzdFRpbWVWaXNpYmxlTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZGlzcG9zZUxldmVsU2VsZWN0aW9uQnV0dG9uID0gKCkgPT4ge1xyXG5cclxuICAgICAgc2NvcmVEaXNwbGF5LmRpc3Bvc2UoKTtcclxuXHJcbiAgICAgIGlmICggb3B0aW9ucy5iZXN0VGltZVByb3BlcnR5ICYmIGJlc3RUaW1lTGlzdGVuZXIgJiYgb3B0aW9ucy5iZXN0VGltZVByb3BlcnR5Lmhhc0xpc3RlbmVyKCBiZXN0VGltZUxpc3RlbmVyICkgKSB7XHJcbiAgICAgICAgb3B0aW9ucy5iZXN0VGltZVByb3BlcnR5LnVubGluayggYmVzdFRpbWVMaXN0ZW5lciApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIG9wdGlvbnMuYmVzdFRpbWVWaXNpYmxlUHJvcGVydHkgJiYgYmVzdFRpbWVWaXNpYmxlTGlzdGVuZXIgJiYgb3B0aW9ucy5iZXN0VGltZVZpc2libGVQcm9wZXJ0eS5oYXNMaXN0ZW5lciggYmVzdFRpbWVWaXNpYmxlTGlzdGVuZXIgKSApIHtcclxuICAgICAgICBvcHRpb25zLmJlc3RUaW1lVmlzaWJsZVByb3BlcnR5LnVubGluayggYmVzdFRpbWVWaXNpYmxlTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBuZXcgaWNvbiB3aXRoIHRoZSBzYW1lIGRpbWVuc2lvbnMgYXMgdGhlIHNwZWNpZmllZCBpY29uLiBUaGUgbmV3IGljb24gd2lsbCBiZSBzY2FsZWQgdG8gZml0LFxyXG4gICAqIGFuZCBhIGJhY2tncm91bmQgd2l0aCB0aGUgc3BlY2lmaWVkIHNpemUgbWF5IGJlIGFkZGVkIHRvIGVuc3VyZSB0aGF0IHRoZSBib3VuZHMgb2YgdGhlIHJldHVybmVkIG5vZGUgYXJlIGNvcnJlY3QuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVTaXplZEltYWdlTm9kZSggaWNvbjogTm9kZSwgc2l6ZTogRGltZW5zaW9uMiApOiBOb2RlIHtcclxuICAgIGljb24uc2NhbGUoIE1hdGgubWluKCBzaXplLndpZHRoIC8gaWNvbi5ib3VuZHMud2lkdGgsIHNpemUuaGVpZ2h0IC8gaWNvbi5ib3VuZHMuaGVpZ2h0ICkgKTtcclxuICAgIGlmICggTWF0aC5hYnMoIGljb24uYm91bmRzLndpZHRoIC0gc2l6ZS53aWR0aCApIDwgU0NBTElOR19UT0xFUkFOQ0UgJiZcclxuICAgICAgICAgTWF0aC5hYnMoIGljb24uYm91bmRzLmhlaWdodCAtIHNpemUuaGVpZ2h0ICkgPCBTQ0FMSU5HX1RPTEVSQU5DRSApIHtcclxuXHJcbiAgICAgIC8vIFRoZSBhc3BlY3QgcmF0aW8gb2YgdGhlIGljb24gbWF0Y2hlZCB0aGF0IG9mIHRoZSBzcGVjaWZpZWQgc2l6ZSwgc28gbm8gcGFkZGluZyBpcyBuZWNlc3NhcnkuXHJcbiAgICAgIHJldHVybiBpY29uO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGVsc2UgcGFkZGluZyBpcyBuZWVkZWQgaW4gZWl0aGVyIHRoZSBob3Jpem9udGFsIG9yIHZlcnRpY2FsIGRpcmVjdGlvbi5cclxuICAgIGNvbnN0IGJhY2tncm91bmQgPSBSZWN0YW5nbGUuZGltZW5zaW9uKCBzaXplICk7XHJcbiAgICBpY29uLmNlbnRlciA9IGJhY2tncm91bmQuY2VudGVyO1xyXG4gICAgYmFja2dyb3VuZC5hZGRDaGlsZCggaWNvbiApO1xyXG4gICAgcmV0dXJuIGJhY2tncm91bmQ7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZUxldmVsU2VsZWN0aW9uQnV0dG9uKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG52ZWdhcy5yZWdpc3RlciggJ0xldmVsU2VsZWN0aW9uQnV0dG9uJywgTGV2ZWxTZWxlY3Rpb25CdXR0b24gKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLE9BQU9BLFVBQVUsTUFBTSw0QkFBNEI7QUFDbkQsT0FBT0MsU0FBUyxNQUFNLGlDQUFpQztB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