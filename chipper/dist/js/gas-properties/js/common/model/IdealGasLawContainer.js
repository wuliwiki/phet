// Copyright 2018-2022, University of Colorado Boulder

/**
 * IdealGasLawContainer is the container used in screens that are based on the Ideal Gas Law.
 * This container has a (re)movable lid.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import optionize from '../../../../phet-core/js/optionize.js';
import gasProperties from '../../gasProperties.js';
import GasPropertiesQueryParameters from '../GasPropertiesQueryParameters.js';
import BaseContainer from './BaseContainer.js';

// constants

// Speed limit for the container's left movable wall, in pm/ps. Relevant when reducing the container size.
const WALL_SPEED_LIMIT = GasPropertiesQueryParameters.wallSpeedLimit;
export default class IdealGasLawContainer extends BaseContainer {
  // whether the lid is on the container
  // lid thickness, in pm
  // insets of the opening in the top, from the inside edges of the container, in pm
  // the right coordinate of the opening in the top of the container, in pm
  // minimum width of the lid, overlaps the left wall, in pm.
  // width of the lid, in pm
  // Particles enter the container here, on the inside of the container, in pm.
  // Bicycle pump hose connects here, on the outside of the container, in pm.
  // Desired width of the container, in pm.
  // Set this to impose an animated speed limit on decreasing width. See #90.
  // previous position of the left wall
  // is the container open?
  constructor(providedOptions) {
    const options = optionize()({
      // SelfOptions
      leftWallDoesWork: false
    }, providedOptions);
    super(options);
    this.leftWallDoesWork = options.leftWallDoesWork;
    this.lidIsOnProperty = new BooleanProperty(true, {
      tandem: options.tandem.createTandem('lidIsOnProperty'),
      phetioReadOnly: true,
      // derived from state of the particle system
      phetioDocumentation: 'whether the lid is on the container, or has been blown off'
    });
    this.lidThickness = 175;
    this.openingLeftInset = 1250;
    this.openingRightInset = 2000;
    assert && assert(this.widthRange.min > this.openingLeftInset + this.openingRightInset, 'widthRange.min is too small to accommodate insets');
    this.openingRight = this.position.y - this.openingRightInset;
    this.minLidWidth = this.openingLeftInset + this.wallThickness;
    const initialLidWidth = this.widthProperty.value - this.openingRightInset + this.wallThickness;
    this.lidWidthProperty = new NumberProperty(initialLidWidth, {
      // range changes dynamically with width of container
      isValidValue: value => value >= this.minLidWidth && value <= this.getMaxLidWidth(),
      units: 'pm',
      tandem: options.tandem.createTandem('lidWidthProperty'),
      phetioReadOnly: true // because the range is dynamic
    });

    this.particleEntryPosition = new Vector2(this.position.x, this.position.y + this.height / 5);
    this.hosePosition = this.particleEntryPosition.plusXY(this.wallThickness, 0);
    this.desiredWidth = this.widthProperty.value;
    this.previousLeft = this.left;
    this.isOpenProperty = new DerivedProperty([this.lidIsOnProperty, this.lidWidthProperty], (lidIsOn, lidWidth) => {
      return !lidIsOn || this.getOpeningWidth() !== 0;
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
  reset() {
    super.reset();
    this.lidIsOnProperty.reset();
    this.lidWidthProperty.reset();
    this.desiredWidth = this.widthProperty.value;
  }

  /**
   * Animates the container's width one step towards desiredWidth. Computes wall velocity if the wall does work.
   * @param dt - time delta, in ps
   */
  step(dt) {
    assert && assert(dt > 0, `invalid dt: ${dt}`);
    const widthDifference = this.desiredWidth - this.widthProperty.value;
    if (widthDifference !== 0) {
      // Default is to move the entire distance in one step.
      let newWidth = this.desiredWidth;

      // If the left wall does work (as in the Explore screen), limit the wall's speed and thus how much the
      // width changes per time step. The speed limit prevents the lid from blowing off too easily.  See #90.
      if (this.leftWallDoesWork) {
        const widthStep = dt * WALL_SPEED_LIMIT;
        if (widthStep < Math.abs(widthDifference)) {
          if (widthDifference > 0) {
            newWidth = this.widthProperty.value + widthStep;
          } else {
            newWidth = this.widthProperty.value - widthStep;
          }
        }
      }
      this.setWidth(newWidth);
    }

    // Compute the velocity of the left (movable) wall.  If the wall does not do work on particles, the wall
    // velocity is irrelevant and should remain set to zero, so that it doesn't contribute to collision detection.
    if (this.leftWallDoesWork) {
      const velocityX = (this.left - this.previousLeft) / dt;
      this.leftWallVelocity.setXY(velocityX, 0);
      this.previousLeft = this.left;
    } else {
      assert && assert(this.leftWallVelocity.magnitude === 0, 'wall velocity should be zero');
    }
  }

  /**
   * Resizes the container to the specified width.
   * Maintains a constant opening size in the top of the container, if possible.
   */
  setWidth(width) {
    if (width !== this.widthProperty.value) {
      assert && assert(this.widthRange.contains(width), `width is out of range: ${width}`);

      // Get opening width before changing widthProperty
      const openingWidth = this.getOpeningWidth();

      // resize the container
      this.widthProperty.value = width;

      // resize the lid if it's on the container, maintaining the opening width if possible
      if (this.lidIsOnProperty.value) {
        this.lidWidthProperty.value = Math.max(this.getMaxLidWidth() - openingWidth, this.minLidWidth);
      }
    }
  }

  /**
   * Resizes the container immediately to the specified width.
   */
  resizeImmediately(width) {
    assert && assert(this.widthRange.contains(width), `width is out of range: ${width}`);
    this.setWidth(width);
    this.desiredWidth = width;
  }

  /**
   * Gets the minimum lid width, in pm. This is constant, independent of the container width.
   */
  getMinLidWidth() {
    return this.minLidWidth;
  }

  /**
   * Gets the maximum lid width, in pm, when the lid is fully closed. This changes dynamically with the container width.
   */
  getMaxLidWidth() {
    return this.widthProperty.value - this.openingRightInset + this.wallThickness;
  }

  /**
   * Gets the left coordinate of the opening in the top of the container, in pm.
   */
  getOpeningLeft() {
    let openingLeft = null;
    if (this.lidIsOnProperty.value) {
      openingLeft = this.left - this.wallThickness + this.lidWidthProperty.value;

      // Round to nearest pm to avoid floating-point error, see https://github.com/phetsims/gas-properties/issues/63
      openingLeft = Utils.roundSymmetric(openingLeft);
    } else {
      openingLeft = this.left + this.openingLeftInset;
    }
    assert && assert(openingLeft <= this.getOpeningRight(), `openingLeft ${openingLeft} must be <= openingRight ${this.getOpeningRight()}`);
    return openingLeft;
  }

  /**
   * Gets the right coordinate of the opening in the top of the container, in pm.
   */
  getOpeningRight() {
    return this.openingRight;
  }

  /**
   * Gets the width of the opening in the top of the container, in pm.
   */
  getOpeningWidth() {
    const openingWidth = this.getOpeningRight() - this.getOpeningLeft();
    assert && assert(openingWidth >= 0, `invalid openingWidth: ${openingWidth}`);
    return openingWidth;
  }

  /**
   * Blows the lid off of the container.
   */
  blowLidOff() {
    this.lidIsOnProperty.value = false;
  }
}
gasProperties.register('IdealGasLawContainer', IdealGasLawContainer);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIlV0aWxzIiwiVmVjdG9yMiIsIm9wdGlvbml6ZSIsImdhc1Byb3BlcnRpZXMiLCJHYXNQcm9wZXJ0aWVzUXVlcnlQYXJhbWV0ZXJzIiwiQmFzZUNvbnRhaW5lciIsIldBTExfU1BFRURfTElNSVQiLCJ3YWxsU3BlZWRMaW1pdCIsIklkZWFsR2FzTGF3Q29udGFpbmVyIiwiY29uc3RydWN0b3IiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwibGVmdFdhbGxEb2VzV29yayIsImxpZElzT25Qcm9wZXJ0eSIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb1JlYWRPbmx5IiwicGhldGlvRG9jdW1lbnRhdGlvbiIsImxpZFRoaWNrbmVzcyIsIm9wZW5pbmdMZWZ0SW5zZXQiLCJvcGVuaW5nUmlnaHRJbnNldCIsImFzc2VydCIsIndpZHRoUmFuZ2UiLCJtaW4iLCJvcGVuaW5nUmlnaHQiLCJwb3NpdGlvbiIsInkiLCJtaW5MaWRXaWR0aCIsIndhbGxUaGlja25lc3MiLCJpbml0aWFsTGlkV2lkdGgiLCJ3aWR0aFByb3BlcnR5IiwidmFsdWUiLCJsaWRXaWR0aFByb3BlcnR5IiwiaXNWYWxpZFZhbHVlIiwiZ2V0TWF4TGlkV2lkdGgiLCJ1bml0cyIsInBhcnRpY2xlRW50cnlQb3NpdGlvbiIsIngiLCJoZWlnaHQiLCJob3NlUG9zaXRpb24iLCJwbHVzWFkiLCJkZXNpcmVkV2lkdGgiLCJwcmV2aW91c0xlZnQiLCJsZWZ0IiwiaXNPcGVuUHJvcGVydHkiLCJsaWRJc09uIiwibGlkV2lkdGgiLCJnZXRPcGVuaW5nV2lkdGgiLCJkaXNwb3NlIiwicmVzZXQiLCJzdGVwIiwiZHQiLCJ3aWR0aERpZmZlcmVuY2UiLCJuZXdXaWR0aCIsIndpZHRoU3RlcCIsIk1hdGgiLCJhYnMiLCJzZXRXaWR0aCIsInZlbG9jaXR5WCIsImxlZnRXYWxsVmVsb2NpdHkiLCJzZXRYWSIsIm1hZ25pdHVkZSIsIndpZHRoIiwiY29udGFpbnMiLCJvcGVuaW5nV2lkdGgiLCJtYXgiLCJyZXNpemVJbW1lZGlhdGVseSIsImdldE1pbkxpZFdpZHRoIiwiZ2V0T3BlbmluZ0xlZnQiLCJvcGVuaW5nTGVmdCIsInJvdW5kU3ltbWV0cmljIiwiZ2V0T3BlbmluZ1JpZ2h0IiwiYmxvd0xpZE9mZiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiSWRlYWxHYXNMYXdDb250YWluZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogSWRlYWxHYXNMYXdDb250YWluZXIgaXMgdGhlIGNvbnRhaW5lciB1c2VkIGluIHNjcmVlbnMgdGhhdCBhcmUgYmFzZWQgb24gdGhlIElkZWFsIEdhcyBMYXcuXHJcbiAqIFRoaXMgY29udGFpbmVyIGhhcyBhIChyZSltb3ZhYmxlIGxpZC5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBQaWNrUmVxdWlyZWQgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1BpY2tSZXF1aXJlZC5qcyc7XHJcbmltcG9ydCBnYXNQcm9wZXJ0aWVzIGZyb20gJy4uLy4uL2dhc1Byb3BlcnRpZXMuanMnO1xyXG5pbXBvcnQgR2FzUHJvcGVydGllc1F1ZXJ5UGFyYW1ldGVycyBmcm9tICcuLi9HYXNQcm9wZXJ0aWVzUXVlcnlQYXJhbWV0ZXJzLmpzJztcclxuaW1wb3J0IEJhc2VDb250YWluZXIsIHsgQmFzZUNvbnRhaW5lck9wdGlvbnMgfSBmcm9tICcuL0Jhc2VDb250YWluZXIuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcblxyXG4vLyBTcGVlZCBsaW1pdCBmb3IgdGhlIGNvbnRhaW5lcidzIGxlZnQgbW92YWJsZSB3YWxsLCBpbiBwbS9wcy4gUmVsZXZhbnQgd2hlbiByZWR1Y2luZyB0aGUgY29udGFpbmVyIHNpemUuXHJcbmNvbnN0IFdBTExfU1BFRURfTElNSVQgPSBHYXNQcm9wZXJ0aWVzUXVlcnlQYXJhbWV0ZXJzLndhbGxTcGVlZExpbWl0O1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICBsZWZ0V2FsbERvZXNXb3JrPzogYm9vbGVhbjsgIC8vIHRydWUgaWYgdGhlIGxlZnQgd2FsbCBkb2VzIHdvcmsgb24gcGFydGljbGVzLCBhcyBpbiB0aGUgRXhwbG9yZSBzY3JlZW5cclxufTtcclxuXHJcbnR5cGUgSWRlYWxHYXNMYXdDb250YWluZXJPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBQaWNrUmVxdWlyZWQ8QmFzZUNvbnRhaW5lck9wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIElkZWFsR2FzTGF3Q29udGFpbmVyIGV4dGVuZHMgQmFzZUNvbnRhaW5lciB7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSBsZWZ0V2FsbERvZXNXb3JrOiBib29sZWFuO1xyXG4gIHB1YmxpYyByZWFkb25seSBsaWRJc09uUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+OyAvLyB3aGV0aGVyIHRoZSBsaWQgaXMgb24gdGhlIGNvbnRhaW5lclxyXG4gIHB1YmxpYyByZWFkb25seSBsaWRUaGlja25lc3M6IG51bWJlcjsgLy8gbGlkIHRoaWNrbmVzcywgaW4gcG1cclxuXHJcbiAgLy8gaW5zZXRzIG9mIHRoZSBvcGVuaW5nIGluIHRoZSB0b3AsIGZyb20gdGhlIGluc2lkZSBlZGdlcyBvZiB0aGUgY29udGFpbmVyLCBpbiBwbVxyXG4gIHB1YmxpYyByZWFkb25seSBvcGVuaW5nTGVmdEluc2V0OiBudW1iZXI7XHJcbiAgcHVibGljIHJlYWRvbmx5IG9wZW5pbmdSaWdodEluc2V0OiBudW1iZXI7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgb3BlbmluZ1JpZ2h0OiBudW1iZXI7IC8vIHRoZSByaWdodCBjb29yZGluYXRlIG9mIHRoZSBvcGVuaW5nIGluIHRoZSB0b3Agb2YgdGhlIGNvbnRhaW5lciwgaW4gcG1cclxuICBwcml2YXRlIHJlYWRvbmx5IG1pbkxpZFdpZHRoOiBudW1iZXI7IC8vIG1pbmltdW0gd2lkdGggb2YgdGhlIGxpZCwgb3ZlcmxhcHMgdGhlIGxlZnQgd2FsbCwgaW4gcG0uXHJcbiAgcHVibGljIHJlYWRvbmx5IGxpZFdpZHRoUHJvcGVydHk6IFByb3BlcnR5PG51bWJlcj47IC8vIHdpZHRoIG9mIHRoZSBsaWQsIGluIHBtXHJcblxyXG4gIC8vIFBhcnRpY2xlcyBlbnRlciB0aGUgY29udGFpbmVyIGhlcmUsIG9uIHRoZSBpbnNpZGUgb2YgdGhlIGNvbnRhaW5lciwgaW4gcG0uXHJcbiAgcHVibGljIHJlYWRvbmx5IHBhcnRpY2xlRW50cnlQb3NpdGlvbjogVmVjdG9yMjtcclxuXHJcbiAgLy8gQmljeWNsZSBwdW1wIGhvc2UgY29ubmVjdHMgaGVyZSwgb24gdGhlIG91dHNpZGUgb2YgdGhlIGNvbnRhaW5lciwgaW4gcG0uXHJcbiAgcHVibGljIHJlYWRvbmx5IGhvc2VQb3NpdGlvbjogVmVjdG9yMjtcclxuXHJcbiAgLy8gRGVzaXJlZCB3aWR0aCBvZiB0aGUgY29udGFpbmVyLCBpbiBwbS5cclxuICAvLyBTZXQgdGhpcyB0byBpbXBvc2UgYW4gYW5pbWF0ZWQgc3BlZWQgbGltaXQgb24gZGVjcmVhc2luZyB3aWR0aC4gU2VlICM5MC5cclxuICBwdWJsaWMgZGVzaXJlZFdpZHRoOiBudW1iZXI7XHJcblxyXG4gIC8vIHByZXZpb3VzIHBvc2l0aW9uIG9mIHRoZSBsZWZ0IHdhbGxcclxuICBwcml2YXRlIHByZXZpb3VzTGVmdDogbnVtYmVyO1xyXG5cclxuICAvLyBpcyB0aGUgY29udGFpbmVyIG9wZW4/XHJcbiAgcHVibGljIHJlYWRvbmx5IGlzT3BlblByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM6IElkZWFsR2FzTGF3Q29udGFpbmVyT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPElkZWFsR2FzTGF3Q29udGFpbmVyT3B0aW9ucywgU2VsZk9wdGlvbnMsIEJhc2VDb250YWluZXJPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBTZWxmT3B0aW9uc1xyXG4gICAgICBsZWZ0V2FsbERvZXNXb3JrOiBmYWxzZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLmxlZnRXYWxsRG9lc1dvcmsgPSBvcHRpb25zLmxlZnRXYWxsRG9lc1dvcms7XHJcblxyXG4gICAgdGhpcy5saWRJc09uUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnbGlkSXNPblByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZSwgLy8gZGVyaXZlZCBmcm9tIHN0YXRlIG9mIHRoZSBwYXJ0aWNsZSBzeXN0ZW1cclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ3doZXRoZXIgdGhlIGxpZCBpcyBvbiB0aGUgY29udGFpbmVyLCBvciBoYXMgYmVlbiBibG93biBvZmYnXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5saWRUaGlja25lc3MgPSAxNzU7XHJcblxyXG4gICAgdGhpcy5vcGVuaW5nTGVmdEluc2V0ID0gMTI1MDtcclxuICAgIHRoaXMub3BlbmluZ1JpZ2h0SW5zZXQgPSAyMDAwO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy53aWR0aFJhbmdlLm1pbiA+IHRoaXMub3BlbmluZ0xlZnRJbnNldCArIHRoaXMub3BlbmluZ1JpZ2h0SW5zZXQsXHJcbiAgICAgICd3aWR0aFJhbmdlLm1pbiBpcyB0b28gc21hbGwgdG8gYWNjb21tb2RhdGUgaW5zZXRzJyApO1xyXG5cclxuICAgIHRoaXMub3BlbmluZ1JpZ2h0ID0gdGhpcy5wb3NpdGlvbi55IC0gdGhpcy5vcGVuaW5nUmlnaHRJbnNldDtcclxuXHJcbiAgICB0aGlzLm1pbkxpZFdpZHRoID0gdGhpcy5vcGVuaW5nTGVmdEluc2V0ICsgdGhpcy53YWxsVGhpY2tuZXNzO1xyXG5cclxuICAgIGNvbnN0IGluaXRpYWxMaWRXaWR0aCA9IHRoaXMud2lkdGhQcm9wZXJ0eS52YWx1ZSAtIHRoaXMub3BlbmluZ1JpZ2h0SW5zZXQgKyB0aGlzLndhbGxUaGlja25lc3M7XHJcblxyXG4gICAgdGhpcy5saWRXaWR0aFByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCBpbml0aWFsTGlkV2lkdGgsIHtcclxuXHJcbiAgICAgIC8vIHJhbmdlIGNoYW5nZXMgZHluYW1pY2FsbHkgd2l0aCB3aWR0aCBvZiBjb250YWluZXJcclxuICAgICAgaXNWYWxpZFZhbHVlOiB2YWx1ZSA9PiAoIHZhbHVlID49IHRoaXMubWluTGlkV2lkdGggJiYgdmFsdWUgPD0gdGhpcy5nZXRNYXhMaWRXaWR0aCgpICksXHJcbiAgICAgIHVuaXRzOiAncG0nLFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xpZFdpZHRoUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlIC8vIGJlY2F1c2UgdGhlIHJhbmdlIGlzIGR5bmFtaWNcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnBhcnRpY2xlRW50cnlQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCB0aGlzLnBvc2l0aW9uLngsIHRoaXMucG9zaXRpb24ueSArIHRoaXMuaGVpZ2h0IC8gNSApO1xyXG5cclxuICAgIHRoaXMuaG9zZVBvc2l0aW9uID0gdGhpcy5wYXJ0aWNsZUVudHJ5UG9zaXRpb24ucGx1c1hZKCB0aGlzLndhbGxUaGlja25lc3MsIDAgKTtcclxuXHJcbiAgICB0aGlzLmRlc2lyZWRXaWR0aCA9IHRoaXMud2lkdGhQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICB0aGlzLnByZXZpb3VzTGVmdCA9IHRoaXMubGVmdDtcclxuXHJcbiAgICB0aGlzLmlzT3BlblByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyB0aGlzLmxpZElzT25Qcm9wZXJ0eSwgdGhpcy5saWRXaWR0aFByb3BlcnR5IF0sXHJcbiAgICAgICggbGlkSXNPbiwgbGlkV2lkdGggKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuICFsaWRJc09uIHx8IHRoaXMuZ2V0T3BlbmluZ1dpZHRoKCkgIT09IDA7XHJcbiAgICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgcmVzZXQoKTogdm9pZCB7XHJcbiAgICBzdXBlci5yZXNldCgpO1xyXG4gICAgdGhpcy5saWRJc09uUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMubGlkV2lkdGhQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5kZXNpcmVkV2lkdGggPSB0aGlzLndpZHRoUHJvcGVydHkudmFsdWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBbmltYXRlcyB0aGUgY29udGFpbmVyJ3Mgd2lkdGggb25lIHN0ZXAgdG93YXJkcyBkZXNpcmVkV2lkdGguIENvbXB1dGVzIHdhbGwgdmVsb2NpdHkgaWYgdGhlIHdhbGwgZG9lcyB3b3JrLlxyXG4gICAqIEBwYXJhbSBkdCAtIHRpbWUgZGVsdGEsIGluIHBzXHJcbiAgICovXHJcbiAgcHVibGljIHN0ZXAoIGR0OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBkdCA+IDAsIGBpbnZhbGlkIGR0OiAke2R0fWAgKTtcclxuXHJcbiAgICBjb25zdCB3aWR0aERpZmZlcmVuY2UgPSB0aGlzLmRlc2lyZWRXaWR0aCAtIHRoaXMud2lkdGhQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICBpZiAoIHdpZHRoRGlmZmVyZW5jZSAhPT0gMCApIHtcclxuXHJcbiAgICAgIC8vIERlZmF1bHQgaXMgdG8gbW92ZSB0aGUgZW50aXJlIGRpc3RhbmNlIGluIG9uZSBzdGVwLlxyXG4gICAgICBsZXQgbmV3V2lkdGggPSB0aGlzLmRlc2lyZWRXaWR0aDtcclxuXHJcbiAgICAgIC8vIElmIHRoZSBsZWZ0IHdhbGwgZG9lcyB3b3JrIChhcyBpbiB0aGUgRXhwbG9yZSBzY3JlZW4pLCBsaW1pdCB0aGUgd2FsbCdzIHNwZWVkIGFuZCB0aHVzIGhvdyBtdWNoIHRoZVxyXG4gICAgICAvLyB3aWR0aCBjaGFuZ2VzIHBlciB0aW1lIHN0ZXAuIFRoZSBzcGVlZCBsaW1pdCBwcmV2ZW50cyB0aGUgbGlkIGZyb20gYmxvd2luZyBvZmYgdG9vIGVhc2lseS4gIFNlZSAjOTAuXHJcbiAgICAgIGlmICggdGhpcy5sZWZ0V2FsbERvZXNXb3JrICkge1xyXG5cclxuICAgICAgICBjb25zdCB3aWR0aFN0ZXAgPSBkdCAqIFdBTExfU1BFRURfTElNSVQ7XHJcblxyXG4gICAgICAgIGlmICggd2lkdGhTdGVwIDwgTWF0aC5hYnMoIHdpZHRoRGlmZmVyZW5jZSApICkge1xyXG4gICAgICAgICAgaWYgKCB3aWR0aERpZmZlcmVuY2UgPiAwICkge1xyXG4gICAgICAgICAgICBuZXdXaWR0aCA9IHRoaXMud2lkdGhQcm9wZXJ0eS52YWx1ZSArIHdpZHRoU3RlcDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBuZXdXaWR0aCA9IHRoaXMud2lkdGhQcm9wZXJ0eS52YWx1ZSAtIHdpZHRoU3RlcDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuc2V0V2lkdGgoIG5ld1dpZHRoICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ29tcHV0ZSB0aGUgdmVsb2NpdHkgb2YgdGhlIGxlZnQgKG1vdmFibGUpIHdhbGwuICBJZiB0aGUgd2FsbCBkb2VzIG5vdCBkbyB3b3JrIG9uIHBhcnRpY2xlcywgdGhlIHdhbGxcclxuICAgIC8vIHZlbG9jaXR5IGlzIGlycmVsZXZhbnQgYW5kIHNob3VsZCByZW1haW4gc2V0IHRvIHplcm8sIHNvIHRoYXQgaXQgZG9lc24ndCBjb250cmlidXRlIHRvIGNvbGxpc2lvbiBkZXRlY3Rpb24uXHJcbiAgICBpZiAoIHRoaXMubGVmdFdhbGxEb2VzV29yayApIHtcclxuICAgICAgY29uc3QgdmVsb2NpdHlYID0gKCB0aGlzLmxlZnQgLSB0aGlzLnByZXZpb3VzTGVmdCApIC8gZHQ7XHJcbiAgICAgIHRoaXMubGVmdFdhbGxWZWxvY2l0eS5zZXRYWSggdmVsb2NpdHlYLCAwICk7XHJcbiAgICAgIHRoaXMucHJldmlvdXNMZWZ0ID0gdGhpcy5sZWZ0O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMubGVmdFdhbGxWZWxvY2l0eS5tYWduaXR1ZGUgPT09IDAsICd3YWxsIHZlbG9jaXR5IHNob3VsZCBiZSB6ZXJvJyApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzaXplcyB0aGUgY29udGFpbmVyIHRvIHRoZSBzcGVjaWZpZWQgd2lkdGguXHJcbiAgICogTWFpbnRhaW5zIGEgY29uc3RhbnQgb3BlbmluZyBzaXplIGluIHRoZSB0b3Agb2YgdGhlIGNvbnRhaW5lciwgaWYgcG9zc2libGUuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRXaWR0aCggd2lkdGg6IG51bWJlciApOiB2b2lkIHtcclxuICAgIGlmICggd2lkdGggIT09IHRoaXMud2lkdGhQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy53aWR0aFJhbmdlLmNvbnRhaW5zKCB3aWR0aCApLCBgd2lkdGggaXMgb3V0IG9mIHJhbmdlOiAke3dpZHRofWAgKTtcclxuXHJcbiAgICAgIC8vIEdldCBvcGVuaW5nIHdpZHRoIGJlZm9yZSBjaGFuZ2luZyB3aWR0aFByb3BlcnR5XHJcbiAgICAgIGNvbnN0IG9wZW5pbmdXaWR0aCA9IHRoaXMuZ2V0T3BlbmluZ1dpZHRoKCk7XHJcblxyXG4gICAgICAvLyByZXNpemUgdGhlIGNvbnRhaW5lclxyXG4gICAgICB0aGlzLndpZHRoUHJvcGVydHkudmFsdWUgPSB3aWR0aDtcclxuXHJcbiAgICAgIC8vIHJlc2l6ZSB0aGUgbGlkIGlmIGl0J3Mgb24gdGhlIGNvbnRhaW5lciwgbWFpbnRhaW5pbmcgdGhlIG9wZW5pbmcgd2lkdGggaWYgcG9zc2libGVcclxuICAgICAgaWYgKCB0aGlzLmxpZElzT25Qcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICB0aGlzLmxpZFdpZHRoUHJvcGVydHkudmFsdWUgPSBNYXRoLm1heCggdGhpcy5nZXRNYXhMaWRXaWR0aCgpIC0gb3BlbmluZ1dpZHRoLCB0aGlzLm1pbkxpZFdpZHRoICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc2l6ZXMgdGhlIGNvbnRhaW5lciBpbW1lZGlhdGVseSB0byB0aGUgc3BlY2lmaWVkIHdpZHRoLlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNpemVJbW1lZGlhdGVseSggd2lkdGg6IG51bWJlciApOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMud2lkdGhSYW5nZS5jb250YWlucyggd2lkdGggKSwgYHdpZHRoIGlzIG91dCBvZiByYW5nZTogJHt3aWR0aH1gICk7XHJcbiAgICB0aGlzLnNldFdpZHRoKCB3aWR0aCApO1xyXG4gICAgdGhpcy5kZXNpcmVkV2lkdGggPSB3aWR0aDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIG1pbmltdW0gbGlkIHdpZHRoLCBpbiBwbS4gVGhpcyBpcyBjb25zdGFudCwgaW5kZXBlbmRlbnQgb2YgdGhlIGNvbnRhaW5lciB3aWR0aC5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TWluTGlkV2lkdGgoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLm1pbkxpZFdpZHRoO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyB0aGUgbWF4aW11bSBsaWQgd2lkdGgsIGluIHBtLCB3aGVuIHRoZSBsaWQgaXMgZnVsbHkgY2xvc2VkLiBUaGlzIGNoYW5nZXMgZHluYW1pY2FsbHkgd2l0aCB0aGUgY29udGFpbmVyIHdpZHRoLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRNYXhMaWRXaWR0aCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMud2lkdGhQcm9wZXJ0eS52YWx1ZSAtIHRoaXMub3BlbmluZ1JpZ2h0SW5zZXQgKyB0aGlzLndhbGxUaGlja25lc3M7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBsZWZ0IGNvb3JkaW5hdGUgb2YgdGhlIG9wZW5pbmcgaW4gdGhlIHRvcCBvZiB0aGUgY29udGFpbmVyLCBpbiBwbS5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0T3BlbmluZ0xlZnQoKTogbnVtYmVyIHtcclxuXHJcbiAgICBsZXQgb3BlbmluZ0xlZnQgPSBudWxsO1xyXG5cclxuICAgIGlmICggdGhpcy5saWRJc09uUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgIG9wZW5pbmdMZWZ0ID0gdGhpcy5sZWZ0IC0gdGhpcy53YWxsVGhpY2tuZXNzICsgdGhpcy5saWRXaWR0aFByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgICAgLy8gUm91bmQgdG8gbmVhcmVzdCBwbSB0byBhdm9pZCBmbG9hdGluZy1wb2ludCBlcnJvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9nYXMtcHJvcGVydGllcy9pc3N1ZXMvNjNcclxuICAgICAgb3BlbmluZ0xlZnQgPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggb3BlbmluZ0xlZnQgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBvcGVuaW5nTGVmdCA9IHRoaXMubGVmdCArIHRoaXMub3BlbmluZ0xlZnRJbnNldDtcclxuICAgIH1cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wZW5pbmdMZWZ0IDw9IHRoaXMuZ2V0T3BlbmluZ1JpZ2h0KCksXHJcbiAgICAgIGBvcGVuaW5nTGVmdCAke29wZW5pbmdMZWZ0fSBtdXN0IGJlIDw9IG9wZW5pbmdSaWdodCAke3RoaXMuZ2V0T3BlbmluZ1JpZ2h0KCl9YFxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gb3BlbmluZ0xlZnQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSByaWdodCBjb29yZGluYXRlIG9mIHRoZSBvcGVuaW5nIGluIHRoZSB0b3Agb2YgdGhlIGNvbnRhaW5lciwgaW4gcG0uXHJcbiAgICovXHJcbiAgcHVibGljIGdldE9wZW5pbmdSaWdodCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMub3BlbmluZ1JpZ2h0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyB0aGUgd2lkdGggb2YgdGhlIG9wZW5pbmcgaW4gdGhlIHRvcCBvZiB0aGUgY29udGFpbmVyLCBpbiBwbS5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0T3BlbmluZ1dpZHRoKCk6IG51bWJlciB7XHJcbiAgICBjb25zdCBvcGVuaW5nV2lkdGggPSB0aGlzLmdldE9wZW5pbmdSaWdodCgpIC0gdGhpcy5nZXRPcGVuaW5nTGVmdCgpO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3BlbmluZ1dpZHRoID49IDAsIGBpbnZhbGlkIG9wZW5pbmdXaWR0aDogJHtvcGVuaW5nV2lkdGh9YCApO1xyXG4gICAgcmV0dXJuIG9wZW5pbmdXaWR0aDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEJsb3dzIHRoZSBsaWQgb2ZmIG9mIHRoZSBjb250YWluZXIuXHJcbiAgICovXHJcbiAgcHVibGljIGJsb3dMaWRPZmYoKTogdm9pZCB7XHJcbiAgICB0aGlzLmxpZElzT25Qcm9wZXJ0eS52YWx1ZSA9IGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuZ2FzUHJvcGVydGllcy5yZWdpc3RlciggJ0lkZWFsR2FzTGF3Q29udGFpbmVyJywgSWRlYWxHYXNMYXdDb250YWluZXIgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsY0FBYyxNQUFNLHVDQUF1QztBQUdsRSxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsU0FBUyxN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