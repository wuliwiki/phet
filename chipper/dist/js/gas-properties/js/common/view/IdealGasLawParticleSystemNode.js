// Copyright 2019-2022, University of Colorado Boulder

/**
 * IdealGasLawParticleSystemNode renders the particle system for screens that are based on the Ideal Gas Law.
 * To optimize the size of canvases, this consists of 2 CanvasNodes; one for particles inside the container, one for
 * particles outside the container. So we use 2 instances of ParticlesNode via composition.
 *
 * Do not transform this Node! It's origin must be at the origin of the view coordinate frame.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import NumberProperty from '../../../../axon/js/NumberProperty.js';
import { Node } from '../../../../scenery/js/imports.js';
import gasProperties from '../../gasProperties.js';
import GasPropertiesConstants from '../GasPropertiesConstants.js';
import HeavyParticle from '../model/HeavyParticle.js';
import LightParticle from '../model/LightParticle.js';
import ParticleImageProperty from './ParticleImageProperty.js';
import ParticlesNode from './ParticlesNode.js';
export default class IdealGasLawParticleSystemNode extends Node {
  constructor(particleSystem, modelViewTransform, modelBoundsProperty, containerMaxBounds) {
    // generated image for HeavyParticle species
    const heavyParticleImageProperty = new ParticleImageProperty(() => new HeavyParticle(), modelViewTransform, new NumberProperty(GasPropertiesConstants.HEAVY_PARTICLES_RADIUS));

    // generated image for LightParticle species
    const lightParticleImageProperty = new ParticleImageProperty(() => new LightParticle(), modelViewTransform, new NumberProperty(GasPropertiesConstants.LIGHT_PARTICLES_RADIUS));

    // particles inside the container
    const insideParticlesNode = new ParticlesNode([particleSystem.heavyParticles, particleSystem.lightParticles], [heavyParticleImageProperty, lightParticleImageProperty], modelViewTransform);

    // Size the inside canvas to the maximum bounds for the container.
    insideParticlesNode.setCanvasBounds(modelViewTransform.modelToViewBounds(containerMaxBounds));

    // particles outside the container
    const outsideParticlesNode = new ParticlesNode([particleSystem.heavyParticlesOutside, particleSystem.lightParticlesOutside], [heavyParticleImageProperty, lightParticleImageProperty], modelViewTransform);

    // When particles escape through the container's lid, they float up, since there is no gravity.
    // So size the outside canvas to the portion of the model bounds that is above the container.
    modelBoundsProperty.link(modelBounds => {
      const canvasBounds = modelBounds.withMinY(containerMaxBounds.maxY);
      outsideParticlesNode.setCanvasBounds(modelViewTransform.modelToViewBounds(canvasBounds));
    });
    super({
      children: [insideParticlesNode, outsideParticlesNode]
    });
    this.insideParticlesNode = insideParticlesNode;
    this.outsideParticlesNode = outsideParticlesNode;
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }

  /**
   * Redraws the particle system.
   */
  update() {
    this.insideParticlesNode.update();
    this.outsideParticlesNode.update();
  }
}
gasProperties.register('IdealGasLawParticleSystemNode', IdealGasLawParticleSystemNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOdW1iZXJQcm9wZXJ0eSIsIk5vZGUiLCJnYXNQcm9wZXJ0aWVzIiwiR2FzUHJvcGVydGllc0NvbnN0YW50cyIsIkhlYXZ5UGFydGljbGUiLCJMaWdodFBhcnRpY2xlIiwiUGFydGljbGVJbWFnZVByb3BlcnR5IiwiUGFydGljbGVzTm9kZSIsIklkZWFsR2FzTGF3UGFydGljbGVTeXN0ZW1Ob2RlIiwiY29uc3RydWN0b3IiLCJwYXJ0aWNsZVN5c3RlbSIsIm1vZGVsVmlld1RyYW5zZm9ybSIsIm1vZGVsQm91bmRzUHJvcGVydHkiLCJjb250YWluZXJNYXhCb3VuZHMiLCJoZWF2eVBhcnRpY2xlSW1hZ2VQcm9wZXJ0eSIsIkhFQVZZX1BBUlRJQ0xFU19SQURJVVMiLCJsaWdodFBhcnRpY2xlSW1hZ2VQcm9wZXJ0eSIsIkxJR0hUX1BBUlRJQ0xFU19SQURJVVMiLCJpbnNpZGVQYXJ0aWNsZXNOb2RlIiwiaGVhdnlQYXJ0aWNsZXMiLCJsaWdodFBhcnRpY2xlcyIsInNldENhbnZhc0JvdW5kcyIsIm1vZGVsVG9WaWV3Qm91bmRzIiwib3V0c2lkZVBhcnRpY2xlc05vZGUiLCJoZWF2eVBhcnRpY2xlc091dHNpZGUiLCJsaWdodFBhcnRpY2xlc091dHNpZGUiLCJsaW5rIiwibW9kZWxCb3VuZHMiLCJjYW52YXNCb3VuZHMiLCJ3aXRoTWluWSIsIm1heFkiLCJjaGlsZHJlbiIsImRpc3Bvc2UiLCJhc3NlcnQiLCJ1cGRhdGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIklkZWFsR2FzTGF3UGFydGljbGVTeXN0ZW1Ob2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIElkZWFsR2FzTGF3UGFydGljbGVTeXN0ZW1Ob2RlIHJlbmRlcnMgdGhlIHBhcnRpY2xlIHN5c3RlbSBmb3Igc2NyZWVucyB0aGF0IGFyZSBiYXNlZCBvbiB0aGUgSWRlYWwgR2FzIExhdy5cclxuICogVG8gb3B0aW1pemUgdGhlIHNpemUgb2YgY2FudmFzZXMsIHRoaXMgY29uc2lzdHMgb2YgMiBDYW52YXNOb2Rlczsgb25lIGZvciBwYXJ0aWNsZXMgaW5zaWRlIHRoZSBjb250YWluZXIsIG9uZSBmb3JcclxuICogcGFydGljbGVzIG91dHNpZGUgdGhlIGNvbnRhaW5lci4gU28gd2UgdXNlIDIgaW5zdGFuY2VzIG9mIFBhcnRpY2xlc05vZGUgdmlhIGNvbXBvc2l0aW9uLlxyXG4gKlxyXG4gKiBEbyBub3QgdHJhbnNmb3JtIHRoaXMgTm9kZSEgSXQncyBvcmlnaW4gbXVzdCBiZSBhdCB0aGUgb3JpZ2luIG9mIHRoZSB2aWV3IGNvb3JkaW5hdGUgZnJhbWUuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IE51bWJlclByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTnVtYmVyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgeyBOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGdhc1Byb3BlcnRpZXMgZnJvbSAnLi4vLi4vZ2FzUHJvcGVydGllcy5qcyc7XHJcbmltcG9ydCBHYXNQcm9wZXJ0aWVzQ29uc3RhbnRzIGZyb20gJy4uL0dhc1Byb3BlcnRpZXNDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgSGVhdnlQYXJ0aWNsZSBmcm9tICcuLi9tb2RlbC9IZWF2eVBhcnRpY2xlLmpzJztcclxuaW1wb3J0IExpZ2h0UGFydGljbGUgZnJvbSAnLi4vbW9kZWwvTGlnaHRQYXJ0aWNsZS5qcyc7XHJcbmltcG9ydCBQYXJ0aWNsZVN5c3RlbSBmcm9tICcuLi9tb2RlbC9QYXJ0aWNsZVN5c3RlbS5qcyc7XHJcbmltcG9ydCBQYXJ0aWNsZUltYWdlUHJvcGVydHkgZnJvbSAnLi9QYXJ0aWNsZUltYWdlUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUGFydGljbGVzTm9kZSBmcm9tICcuL1BhcnRpY2xlc05vZGUuanMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSWRlYWxHYXNMYXdQYXJ0aWNsZVN5c3RlbU5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBpbnNpZGVQYXJ0aWNsZXNOb2RlOiBQYXJ0aWNsZXNOb2RlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgb3V0c2lkZVBhcnRpY2xlc05vZGU6IFBhcnRpY2xlc05vZGU7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcGFydGljbGVTeXN0ZW06IFBhcnRpY2xlU3lzdGVtLCBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTIsXHJcbiAgICAgICAgICAgICAgICAgICAgICBtb2RlbEJvdW5kc1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxCb3VuZHMyPiwgY29udGFpbmVyTWF4Qm91bmRzOiBCb3VuZHMyICkge1xyXG5cclxuICAgIC8vIGdlbmVyYXRlZCBpbWFnZSBmb3IgSGVhdnlQYXJ0aWNsZSBzcGVjaWVzXHJcbiAgICBjb25zdCBoZWF2eVBhcnRpY2xlSW1hZ2VQcm9wZXJ0eSA9IG5ldyBQYXJ0aWNsZUltYWdlUHJvcGVydHkoXHJcbiAgICAgICgpID0+IG5ldyBIZWF2eVBhcnRpY2xlKCksXHJcbiAgICAgIG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgbmV3IE51bWJlclByb3BlcnR5KCBHYXNQcm9wZXJ0aWVzQ29uc3RhbnRzLkhFQVZZX1BBUlRJQ0xFU19SQURJVVMgKVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBnZW5lcmF0ZWQgaW1hZ2UgZm9yIExpZ2h0UGFydGljbGUgc3BlY2llc1xyXG4gICAgY29uc3QgbGlnaHRQYXJ0aWNsZUltYWdlUHJvcGVydHkgPSBuZXcgUGFydGljbGVJbWFnZVByb3BlcnR5KFxyXG4gICAgICAoKSA9PiBuZXcgTGlnaHRQYXJ0aWNsZSgpLFxyXG4gICAgICBtb2RlbFZpZXdUcmFuc2Zvcm0sXHJcbiAgICAgIG5ldyBOdW1iZXJQcm9wZXJ0eSggR2FzUHJvcGVydGllc0NvbnN0YW50cy5MSUdIVF9QQVJUSUNMRVNfUkFESVVTIClcclxuICAgICk7XHJcblxyXG4gICAgLy8gcGFydGljbGVzIGluc2lkZSB0aGUgY29udGFpbmVyXHJcbiAgICBjb25zdCBpbnNpZGVQYXJ0aWNsZXNOb2RlID0gbmV3IFBhcnRpY2xlc05vZGUoXHJcbiAgICAgIFsgcGFydGljbGVTeXN0ZW0uaGVhdnlQYXJ0aWNsZXMsIHBhcnRpY2xlU3lzdGVtLmxpZ2h0UGFydGljbGVzIF0sXHJcbiAgICAgIFsgaGVhdnlQYXJ0aWNsZUltYWdlUHJvcGVydHksIGxpZ2h0UGFydGljbGVJbWFnZVByb3BlcnR5IF0sXHJcbiAgICAgIG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBTaXplIHRoZSBpbnNpZGUgY2FudmFzIHRvIHRoZSBtYXhpbXVtIGJvdW5kcyBmb3IgdGhlIGNvbnRhaW5lci5cclxuICAgIGluc2lkZVBhcnRpY2xlc05vZGUuc2V0Q2FudmFzQm91bmRzKCBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdCb3VuZHMoIGNvbnRhaW5lck1heEJvdW5kcyApICk7XHJcblxyXG4gICAgLy8gcGFydGljbGVzIG91dHNpZGUgdGhlIGNvbnRhaW5lclxyXG4gICAgY29uc3Qgb3V0c2lkZVBhcnRpY2xlc05vZGUgPSBuZXcgUGFydGljbGVzTm9kZShcclxuICAgICAgWyBwYXJ0aWNsZVN5c3RlbS5oZWF2eVBhcnRpY2xlc091dHNpZGUsIHBhcnRpY2xlU3lzdGVtLmxpZ2h0UGFydGljbGVzT3V0c2lkZSBdLFxyXG4gICAgICBbIGhlYXZ5UGFydGljbGVJbWFnZVByb3BlcnR5LCBsaWdodFBhcnRpY2xlSW1hZ2VQcm9wZXJ0eSBdLFxyXG4gICAgICBtb2RlbFZpZXdUcmFuc2Zvcm1cclxuICAgICk7XHJcblxyXG4gICAgLy8gV2hlbiBwYXJ0aWNsZXMgZXNjYXBlIHRocm91Z2ggdGhlIGNvbnRhaW5lcidzIGxpZCwgdGhleSBmbG9hdCB1cCwgc2luY2UgdGhlcmUgaXMgbm8gZ3Jhdml0eS5cclxuICAgIC8vIFNvIHNpemUgdGhlIG91dHNpZGUgY2FudmFzIHRvIHRoZSBwb3J0aW9uIG9mIHRoZSBtb2RlbCBib3VuZHMgdGhhdCBpcyBhYm92ZSB0aGUgY29udGFpbmVyLlxyXG4gICAgbW9kZWxCb3VuZHNQcm9wZXJ0eS5saW5rKCBtb2RlbEJvdW5kcyA9PiB7XHJcbiAgICAgIGNvbnN0IGNhbnZhc0JvdW5kcyA9IG1vZGVsQm91bmRzLndpdGhNaW5ZKCBjb250YWluZXJNYXhCb3VuZHMubWF4WSApO1xyXG4gICAgICBvdXRzaWRlUGFydGljbGVzTm9kZS5zZXRDYW52YXNCb3VuZHMoIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0JvdW5kcyggY2FudmFzQm91bmRzICkgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBzdXBlcigge1xyXG4gICAgICBjaGlsZHJlbjogWyBpbnNpZGVQYXJ0aWNsZXNOb2RlLCBvdXRzaWRlUGFydGljbGVzTm9kZSBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5pbnNpZGVQYXJ0aWNsZXNOb2RlID0gaW5zaWRlUGFydGljbGVzTm9kZTtcclxuICAgIHRoaXMub3V0c2lkZVBhcnRpY2xlc05vZGUgPSBvdXRzaWRlUGFydGljbGVzTm9kZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZWRyYXdzIHRoZSBwYXJ0aWNsZSBzeXN0ZW0uXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuaW5zaWRlUGFydGljbGVzTm9kZS51cGRhdGUoKTtcclxuICAgIHRoaXMub3V0c2lkZVBhcnRpY2xlc05vZGUudXBkYXRlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5nYXNQcm9wZXJ0aWVzLnJlZ2lzdGVyKCAnSWRlYWxHYXNMYXdQYXJ0aWNsZVN5c3RlbU5vZGUnLCBJZGVhbEdhc0xhd1BhcnRpY2xlU3lzdGVtTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGNBQWMsTUFBTSx1Q0FBdUM7QUFJbEUsU0FBU0MsSUFBSSxRQUFRLG1DQUFtQztBQUN4RCxPQUFPQyxhQUFhLE1BQU0sd0JBQXdCO0FBQ2xELE9BQU9DLHNCQUFzQixNQUFNLDhCQUE4QjtBQUNqRSxPQUFPQyxhQUFhLE1BQU0sMkJBQTJCO0FBQ3JELE9BQU9DLGFBQWEsTUFBTSwyQkFBMkI7QUFFckQsT0FBT0MscUJBQXFCLE1BQU0sNEJBQTRCO0FBQzlELE9BQU9DLGFBQWEsTUFBTSxvQkFBb0I7QUFFOUMsZUFBZSxNQUFNQyw2QkFBNkIsU0FBU1AsSUFBSSxDQUFDO0VBS3ZEUSxXQUFXQSxDQUFFQyxjQUE4QixFQUFFQyxrQkFBdUMsRUFDdkVDLG1CQUErQyxFQUFFQyxrQkFBMkIsRUFBRztJQUVqRztJQUNBLE1BQU1DLDBCQUEwQixHQUFHLElBQUlSLHFCQUFxQixDQUMxRCxNQUFNLElBQUlGLGFBQWEsQ0FBQyxDQUFDLEVBQ3pCTyxrQkFBa0IsRUFDbEIsSUFBSVgsY0FBYyxDQUFFRyxzQkFBc0IsQ0FBQ1ksc0JBQXVCLENBQ3BFLENBQUM7O0lBRUQ7SUFDQSxNQUFNQywwQkFBMEIsR0FBRyxJQUFJVixxQkFBcUIsQ0FDMUQsTUFBTSxJQUFJRCxhQUFhLENBQUMsQ0FBQyxFQUN6Qk0sa0JBQWtCLEVBQ2xCLElBQUlYLGNBQWMsQ0FBRUcsc0JBQXNCLENBQUNjLHNCQUF1QixDQUNwRSxDQUFDOztJQUVEO0lBQ0EsTUFBTUMsbUJBQW1CLEdBQUcsSUFBSVgsYUFBYSxDQUMzQyxDQUFFRyxjQUFjLENBQUNTLGNBQWMsRUFBRVQsY0FBYyxDQUFDVSxjQUFjLENBQUUsRUFDaEUsQ0FBRU4sMEJBQTBCLEVBQUVFLDBCQUEwQixDQUFFLEVBQzFETCxrQkFDRixDQUFDOztJQUVEO0lBQ0FPLG1CQUFtQixDQUFDRyxlQUFlLENBQUVWLGtCQUFrQixDQUFDVyxpQkFBaUIsQ0FBRVQsa0JBQW1CLENBQUUsQ0FBQzs7SUFFakc7SUFDQSxNQUFNVSxvQkFBb0IsR0FBRyxJQUFJaEIsYUFBYSxDQUM1QyxDQUFFRyxjQUFjLENBQUNjLHFCQUFxQixFQUFFZCxjQUFjLENBQUNlLHFCQUFxQixDQUFFLEVBQzlFLENBQUVYLDBCQUEwQixFQUFFRSwwQkFBMEIsQ0FBRSxFQUMxREwsa0JBQ0YsQ0FBQzs7SUFFRDtJQUNBO0lBQ0FDLG1CQUFtQixDQUFDYyxJQUFJLENBQUVDLFdBQVcsSUFBSTtNQUN2QyxNQUFNQyxZQUFZLEdBQUdELFdBQVcsQ0FBQ0UsUUFBUSxDQUFFaEIsa0JBQWtCLENBQUNpQixJQUFLLENBQUM7TUFDcEVQLG9CQUFvQixDQUFDRixlQUFlLENBQUVWLGtCQUFrQixDQUFDVyxpQkFBaUIsQ0FBRU0sWUFBYSxDQUFFLENBQUM7SUFDOUYsQ0FBRSxDQUFDO0lBRUgsS0FBSyxDQUFFO01BQ0xHLFFBQVEsRUFBRSxDQUFFYixtQkFBbUIsRUFBRUssb0JBQW9CO0lBQ3ZELENBQUUsQ0FBQztJQUVILElBQUksQ0FBQ0wsbUJBQW1CLEdBQUdBLG1CQUFtQjtJQUM5QyxJQUFJLENBQUNLLG9CQUFvQixHQUFHQSxvQkFBb0I7RUFDbEQ7RUFFZ0JTLE9BQU9BLENBQUEsRUFBUztJQUM5QkMsTUFBTSxJQUFJQSxNQUFNLENBQUUsS0FBSyxFQUFFLDhEQUErRCxDQUFDO0lBQ3pGLEtBQUssQ0FBQ0QsT0FBTyxDQUFDLENBQUM7RUFDakI7O0VBRUE7QUFDRjtBQUNBO0VBQ1NFLE1BQU1BLENBQUEsRUFBUztJQUNwQixJQUFJLENBQUNoQixtQkFBbUIsQ0FBQ2dCLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLElBQUksQ0FBQ1gsb0JBQW9CLENBQUNXLE1BQU0sQ0FBQyxDQUFDO0VBQ3BDO0FBQ0Y7QUFFQWhDLGFBQWEsQ0FBQ2lDLFFBQVEsQ0FBRSwrQkFBK0IsRUFBRTNCLDZCQUE4QixDQUFDIn0=