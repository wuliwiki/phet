// Copyright 2019-2022, University of Colorado Boulder

/**
 * ParticlesNode is the base class for rendering a collection of particles using Sprites. It is used in all screens.
 * Do not transform this Node! It's origin must be at the origin of the view coordinate frame.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import { Sprite, SpriteImage, SpriteInstance, Sprites } from '../../../../scenery/js/imports.js';
import gasProperties from '../../gasProperties.js';
import ParticleNode from './ParticleNode.js';

// constants
const IMAGE_SCALE = 2; // scale images to improve quality, see https://github.com/phetsims/gas-properties/issues/55
const IMAGE_PADDING = 2;
export default class ParticlesNode extends Sprites {
  /**
   * @param particleArrays - arrays of particles to render
   * @param imageProperties - an image for each array in particleArrays
   * @param modelViewTransform
   */
  constructor(particleArrays, imageProperties, modelViewTransform) {
    assert && assert(particleArrays.length === imageProperties.length);

    // a Sprite for each Particle array, indexed the same as particleArrays and imageProperties
    const sprites = imageProperties.map(imageProperty => {
      const imageToSpriteImage = image => {
        return new SpriteImage(image, new Vector2(image.width / 2, image.height / 2));
      };
      const sprite = new Sprite(imageToSpriteImage(imageProperty.value));
      imageProperty.lazyLink(image => {
        sprite.imageProperty.value = imageToSpriteImage(image);
      });
      return sprite;
    });

    // a SpriteInstance for each Particle
    const spriteInstances = [];
    super({
      sprites: sprites,
      spriteInstances: spriteInstances,
      renderer: 'webgl',
      pickable: false
    });
    this.particleArrays = particleArrays;
    this.modelViewTransform = modelViewTransform;
    this.sprites = sprites;
    this.spriteInstances = spriteInstances;
  }

  /**
   * Redraws the particle system.
   */
  update() {
    // Index into {SpriteInstance[]} this.spriteInstances
    let spriteInstancesIndex = 0;

    // For each array of Particles...
    for (let i = this.particleArrays.length - 1; i >= 0; i--) {
      const particleArray = this.particleArrays[i]; // {Particle[]}
      const sprite = this.sprites[i];

      // For each Particle...
      for (let j = particleArray.length - 1; j >= 0; j--) {
        const particle = particleArray[j]; // {Particle}

        // If we've run out of SpriteInstances, allocate one.
        if (this.spriteInstances.length === spriteInstancesIndex) {
          const newInstance = SpriteInstance.pool.fetch();
          newInstance.alpha = 1;
          newInstance.matrix.setToAffine(1 / IMAGE_SCALE, 0, 0, 0, 1 / IMAGE_SCALE, 0);
          this.spriteInstances.push(newInstance);
        }

        // For the next SpriteInstance, set its Sprite, and transform it to the particle's position.
        const spriteInstance = this.spriteInstances[spriteInstancesIndex++];
        spriteInstance.sprite = sprite;
        spriteInstance.matrix.set02(this.modelViewTransform.modelToViewX(particle.position.x));
        spriteInstance.matrix.set12(this.modelViewTransform.modelToViewY(particle.position.y));
      }
    }

    // SpriteInstances that are not being used are freed to the pool.
    while (this.spriteInstances.length > spriteInstancesIndex) {
      const spriteInstance = this.spriteInstances.pop();
      assert && assert(spriteInstance);
      spriteInstance.freeToPool();
    }
    this.invalidatePaint(); // results in a call to paintCanvas
  }

  /**
   * Converts a Particle to an HTMLCanvasElement.
   */
  static particleToCanvas(particle, modelViewTransform, particleImageProperty) {
    // Create a particle Node, scaled up to improve quality.
    const particleNode = new ParticleNode(particle, modelViewTransform);
    particleNode.setScaleMagnitude(IMAGE_SCALE, IMAGE_SCALE);

    // Provide our own integer width and height, so that we can reliably center the image
    const canvasWidth = Math.ceil(particleNode.width + IMAGE_PADDING);
    const canvasHeight = Math.ceil(particleNode.height + IMAGE_PADDING);

    // Convert the particle Node to an HTMLCanvasElement
    particleNode.toCanvas(canvas => {
      particleImageProperty.value = canvas;
    }, canvasWidth / 2, canvasHeight / 2, canvasWidth, canvasHeight);
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
}
gasProperties.register('ParticlesNode', ParticlesNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiU3ByaXRlIiwiU3ByaXRlSW1hZ2UiLCJTcHJpdGVJbnN0YW5jZSIsIlNwcml0ZXMiLCJnYXNQcm9wZXJ0aWVzIiwiUGFydGljbGVOb2RlIiwiSU1BR0VfU0NBTEUiLCJJTUFHRV9QQURESU5HIiwiUGFydGljbGVzTm9kZSIsImNvbnN0cnVjdG9yIiwicGFydGljbGVBcnJheXMiLCJpbWFnZVByb3BlcnRpZXMiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJhc3NlcnQiLCJsZW5ndGgiLCJzcHJpdGVzIiwibWFwIiwiaW1hZ2VQcm9wZXJ0eSIsImltYWdlVG9TcHJpdGVJbWFnZSIsImltYWdlIiwid2lkdGgiLCJoZWlnaHQiLCJzcHJpdGUiLCJ2YWx1ZSIsImxhenlMaW5rIiwic3ByaXRlSW5zdGFuY2VzIiwicmVuZGVyZXIiLCJwaWNrYWJsZSIsInVwZGF0ZSIsInNwcml0ZUluc3RhbmNlc0luZGV4IiwiaSIsInBhcnRpY2xlQXJyYXkiLCJqIiwicGFydGljbGUiLCJuZXdJbnN0YW5jZSIsInBvb2wiLCJmZXRjaCIsImFscGhhIiwibWF0cml4Iiwic2V0VG9BZmZpbmUiLCJwdXNoIiwic3ByaXRlSW5zdGFuY2UiLCJzZXQwMiIsIm1vZGVsVG9WaWV3WCIsInBvc2l0aW9uIiwieCIsInNldDEyIiwibW9kZWxUb1ZpZXdZIiwieSIsInBvcCIsImZyZWVUb1Bvb2wiLCJpbnZhbGlkYXRlUGFpbnQiLCJwYXJ0aWNsZVRvQ2FudmFzIiwicGFydGljbGVJbWFnZVByb3BlcnR5IiwicGFydGljbGVOb2RlIiwic2V0U2NhbGVNYWduaXR1ZGUiLCJjYW52YXNXaWR0aCIsIk1hdGgiLCJjZWlsIiwiY2FudmFzSGVpZ2h0IiwidG9DYW52YXMiLCJjYW52YXMiLCJkaXNwb3NlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQYXJ0aWNsZXNOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFBhcnRpY2xlc05vZGUgaXMgdGhlIGJhc2UgY2xhc3MgZm9yIHJlbmRlcmluZyBhIGNvbGxlY3Rpb24gb2YgcGFydGljbGVzIHVzaW5nIFNwcml0ZXMuIEl0IGlzIHVzZWQgaW4gYWxsIHNjcmVlbnMuXHJcbiAqIERvIG5vdCB0cmFuc2Zvcm0gdGhpcyBOb2RlISBJdCdzIG9yaWdpbiBtdXN0IGJlIGF0IHRoZSBvcmlnaW4gb2YgdGhlIHZpZXcgY29vcmRpbmF0ZSBmcmFtZS5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgTW9kZWxWaWV3VHJhbnNmb3JtMiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qcyc7XHJcbmltcG9ydCB7IFNwcml0ZSwgU3ByaXRlSW1hZ2UsIFNwcml0ZUluc3RhbmNlLCBTcHJpdGVzIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGdhc1Byb3BlcnRpZXMgZnJvbSAnLi4vLi4vZ2FzUHJvcGVydGllcy5qcyc7XHJcbmltcG9ydCBQYXJ0aWNsZSBmcm9tICcuLi9tb2RlbC9QYXJ0aWNsZS5qcyc7XHJcbmltcG9ydCBQYXJ0aWNsZU5vZGUgZnJvbSAnLi9QYXJ0aWNsZU5vZGUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IElNQUdFX1NDQUxFID0gMjsgLy8gc2NhbGUgaW1hZ2VzIHRvIGltcHJvdmUgcXVhbGl0eSwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9nYXMtcHJvcGVydGllcy9pc3N1ZXMvNTVcclxuY29uc3QgSU1BR0VfUEFERElORyA9IDI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQYXJ0aWNsZXNOb2RlIGV4dGVuZHMgU3ByaXRlcyB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgcGFydGljbGVBcnJheXM6IFBhcnRpY2xlW11bXTtcclxuICBwcml2YXRlIHJlYWRvbmx5IG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMjtcclxuICBwcml2YXRlIHJlYWRvbmx5IHNwcml0ZXM6IFNwcml0ZVtdO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgc3ByaXRlSW5zdGFuY2VzOiBTcHJpdGVJbnN0YW5jZVtdO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gcGFydGljbGVBcnJheXMgLSBhcnJheXMgb2YgcGFydGljbGVzIHRvIHJlbmRlclxyXG4gICAqIEBwYXJhbSBpbWFnZVByb3BlcnRpZXMgLSBhbiBpbWFnZSBmb3IgZWFjaCBhcnJheSBpbiBwYXJ0aWNsZUFycmF5c1xyXG4gICAqIEBwYXJhbSBtb2RlbFZpZXdUcmFuc2Zvcm1cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHBhcnRpY2xlQXJyYXlzOiBQYXJ0aWNsZVtdW10sXHJcbiAgICAgICAgICAgICAgICAgICAgICBpbWFnZVByb3BlcnRpZXM6IFRSZWFkT25seVByb3BlcnR5PEhUTUxDYW52YXNFbGVtZW50PltdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtOiBNb2RlbFZpZXdUcmFuc2Zvcm0yICkge1xyXG4gICAgXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBwYXJ0aWNsZUFycmF5cy5sZW5ndGggPT09IGltYWdlUHJvcGVydGllcy5sZW5ndGggKTtcclxuXHJcbiAgICAvLyBhIFNwcml0ZSBmb3IgZWFjaCBQYXJ0aWNsZSBhcnJheSwgaW5kZXhlZCB0aGUgc2FtZSBhcyBwYXJ0aWNsZUFycmF5cyBhbmQgaW1hZ2VQcm9wZXJ0aWVzXHJcbiAgICBjb25zdCBzcHJpdGVzOiBTcHJpdGVbXSA9IGltYWdlUHJvcGVydGllcy5tYXAoIGltYWdlUHJvcGVydHkgPT4ge1xyXG4gICAgICBjb25zdCBpbWFnZVRvU3ByaXRlSW1hZ2UgPSAoIGltYWdlOiBIVE1MQ2FudmFzRWxlbWVudCApID0+IHtcclxuICAgICAgICByZXR1cm4gbmV3IFNwcml0ZUltYWdlKCBpbWFnZSwgbmV3IFZlY3RvcjIoIGltYWdlLndpZHRoIC8gMiwgaW1hZ2UuaGVpZ2h0IC8gMiApICk7XHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHNwcml0ZSA9IG5ldyBTcHJpdGUoIGltYWdlVG9TcHJpdGVJbWFnZSggaW1hZ2VQcm9wZXJ0eS52YWx1ZSApICk7XHJcbiAgICAgIGltYWdlUHJvcGVydHkubGF6eUxpbmsoIGltYWdlID0+IHtcclxuICAgICAgICBzcHJpdGUuaW1hZ2VQcm9wZXJ0eS52YWx1ZSA9IGltYWdlVG9TcHJpdGVJbWFnZSggaW1hZ2UgKTtcclxuICAgICAgfSApO1xyXG4gICAgICByZXR1cm4gc3ByaXRlO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGEgU3ByaXRlSW5zdGFuY2UgZm9yIGVhY2ggUGFydGljbGVcclxuICAgIGNvbnN0IHNwcml0ZUluc3RhbmNlczogU3ByaXRlSW5zdGFuY2VbXSA9IFtdO1xyXG5cclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIHNwcml0ZXM6IHNwcml0ZXMsXHJcbiAgICAgIHNwcml0ZUluc3RhbmNlczogc3ByaXRlSW5zdGFuY2VzLFxyXG4gICAgICByZW5kZXJlcjogJ3dlYmdsJyxcclxuICAgICAgcGlja2FibGU6IGZhbHNlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5wYXJ0aWNsZUFycmF5cyA9IHBhcnRpY2xlQXJyYXlzO1xyXG4gICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0gPSBtb2RlbFZpZXdUcmFuc2Zvcm07XHJcbiAgICB0aGlzLnNwcml0ZXMgPSBzcHJpdGVzO1xyXG4gICAgdGhpcy5zcHJpdGVJbnN0YW5jZXMgPSBzcHJpdGVJbnN0YW5jZXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZWRyYXdzIHRoZSBwYXJ0aWNsZSBzeXN0ZW0uXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZSgpOiB2b2lkIHtcclxuXHJcbiAgICAvLyBJbmRleCBpbnRvIHtTcHJpdGVJbnN0YW5jZVtdfSB0aGlzLnNwcml0ZUluc3RhbmNlc1xyXG4gICAgbGV0IHNwcml0ZUluc3RhbmNlc0luZGV4ID0gMDtcclxuXHJcbiAgICAvLyBGb3IgZWFjaCBhcnJheSBvZiBQYXJ0aWNsZXMuLi5cclxuICAgIGZvciAoIGxldCBpID0gdGhpcy5wYXJ0aWNsZUFycmF5cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSApIHtcclxuXHJcbiAgICAgIGNvbnN0IHBhcnRpY2xlQXJyYXkgPSB0aGlzLnBhcnRpY2xlQXJyYXlzWyBpIF07IC8vIHtQYXJ0aWNsZVtdfVxyXG4gICAgICBjb25zdCBzcHJpdGUgPSB0aGlzLnNwcml0ZXNbIGkgXTtcclxuXHJcbiAgICAgIC8vIEZvciBlYWNoIFBhcnRpY2xlLi4uXHJcbiAgICAgIGZvciAoIGxldCBqID0gcGFydGljbGVBcnJheS5sZW5ndGggLSAxOyBqID49IDA7IGotLSApIHtcclxuXHJcbiAgICAgICAgY29uc3QgcGFydGljbGUgPSBwYXJ0aWNsZUFycmF5WyBqIF07IC8vIHtQYXJ0aWNsZX1cclxuXHJcbiAgICAgICAgLy8gSWYgd2UndmUgcnVuIG91dCBvZiBTcHJpdGVJbnN0YW5jZXMsIGFsbG9jYXRlIG9uZS5cclxuICAgICAgICBpZiAoIHRoaXMuc3ByaXRlSW5zdGFuY2VzLmxlbmd0aCA9PT0gc3ByaXRlSW5zdGFuY2VzSW5kZXggKSB7XHJcbiAgICAgICAgICBjb25zdCBuZXdJbnN0YW5jZSA9IFNwcml0ZUluc3RhbmNlLnBvb2wuZmV0Y2goKTtcclxuICAgICAgICAgIG5ld0luc3RhbmNlLmFscGhhID0gMTtcclxuICAgICAgICAgIG5ld0luc3RhbmNlLm1hdHJpeC5zZXRUb0FmZmluZSggMSAvIElNQUdFX1NDQUxFLCAwLCAwLCAwLCAxIC8gSU1BR0VfU0NBTEUsIDAgKTtcclxuICAgICAgICAgIHRoaXMuc3ByaXRlSW5zdGFuY2VzLnB1c2goIG5ld0luc3RhbmNlICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBGb3IgdGhlIG5leHQgU3ByaXRlSW5zdGFuY2UsIHNldCBpdHMgU3ByaXRlLCBhbmQgdHJhbnNmb3JtIGl0IHRvIHRoZSBwYXJ0aWNsZSdzIHBvc2l0aW9uLlxyXG4gICAgICAgIGNvbnN0IHNwcml0ZUluc3RhbmNlID0gdGhpcy5zcHJpdGVJbnN0YW5jZXNbIHNwcml0ZUluc3RhbmNlc0luZGV4KysgXTtcclxuICAgICAgICBzcHJpdGVJbnN0YW5jZS5zcHJpdGUgPSBzcHJpdGU7XHJcbiAgICAgICAgc3ByaXRlSW5zdGFuY2UubWF0cml4LnNldDAyKCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIHBhcnRpY2xlLnBvc2l0aW9uLnggKSApO1xyXG4gICAgICAgIHNwcml0ZUluc3RhbmNlLm1hdHJpeC5zZXQxMiggdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdZKCBwYXJ0aWNsZS5wb3NpdGlvbi55ICkgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFNwcml0ZUluc3RhbmNlcyB0aGF0IGFyZSBub3QgYmVpbmcgdXNlZCBhcmUgZnJlZWQgdG8gdGhlIHBvb2wuXHJcbiAgICB3aGlsZSAoIHRoaXMuc3ByaXRlSW5zdGFuY2VzLmxlbmd0aCA+IHNwcml0ZUluc3RhbmNlc0luZGV4ICkge1xyXG4gICAgICBjb25zdCBzcHJpdGVJbnN0YW5jZSA9IHRoaXMuc3ByaXRlSW5zdGFuY2VzLnBvcCgpITtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggc3ByaXRlSW5zdGFuY2UgKTtcclxuICAgICAgc3ByaXRlSW5zdGFuY2UuZnJlZVRvUG9vbCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaW52YWxpZGF0ZVBhaW50KCk7IC8vIHJlc3VsdHMgaW4gYSBjYWxsIHRvIHBhaW50Q2FudmFzXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb252ZXJ0cyBhIFBhcnRpY2xlIHRvIGFuIEhUTUxDYW52YXNFbGVtZW50LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgcGFydGljbGVUb0NhbnZhcyggcGFydGljbGU6IFBhcnRpY2xlLCBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZUltYWdlUHJvcGVydHk6IFByb3BlcnR5PEhUTUxDYW52YXNFbGVtZW50IHwgbnVsbD4gKTogdm9pZCB7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgcGFydGljbGUgTm9kZSwgc2NhbGVkIHVwIHRvIGltcHJvdmUgcXVhbGl0eS5cclxuICAgIGNvbnN0IHBhcnRpY2xlTm9kZSA9IG5ldyBQYXJ0aWNsZU5vZGUoIHBhcnRpY2xlLCBtb2RlbFZpZXdUcmFuc2Zvcm0gKTtcclxuICAgIHBhcnRpY2xlTm9kZS5zZXRTY2FsZU1hZ25pdHVkZSggSU1BR0VfU0NBTEUsIElNQUdFX1NDQUxFICk7XHJcblxyXG4gICAgLy8gUHJvdmlkZSBvdXIgb3duIGludGVnZXIgd2lkdGggYW5kIGhlaWdodCwgc28gdGhhdCB3ZSBjYW4gcmVsaWFibHkgY2VudGVyIHRoZSBpbWFnZVxyXG4gICAgY29uc3QgY2FudmFzV2lkdGggPSBNYXRoLmNlaWwoIHBhcnRpY2xlTm9kZS53aWR0aCArIElNQUdFX1BBRERJTkcgKTtcclxuICAgIGNvbnN0IGNhbnZhc0hlaWdodCA9IE1hdGguY2VpbCggcGFydGljbGVOb2RlLmhlaWdodCArIElNQUdFX1BBRERJTkcgKTtcclxuXHJcbiAgICAvLyBDb252ZXJ0IHRoZSBwYXJ0aWNsZSBOb2RlIHRvIGFuIEhUTUxDYW52YXNFbGVtZW50XHJcbiAgICBwYXJ0aWNsZU5vZGUudG9DYW52YXMoIGNhbnZhcyA9PiB7IHBhcnRpY2xlSW1hZ2VQcm9wZXJ0eS52YWx1ZSA9IGNhbnZhczsgfSxcclxuICAgICAgY2FudmFzV2lkdGggLyAyLCBjYW52YXNIZWlnaHQgLyAyLCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuZ2FzUHJvcGVydGllcy5yZWdpc3RlciggJ1BhcnRpY2xlc05vZGUnLCBQYXJ0aWNsZXNOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBSUEsT0FBT0EsT0FBTyxNQUFNLCtCQUErQjtBQUVuRCxTQUFTQyxNQUFNLEVBQUVDLFdBQVcsRUFBRUMsY0FBYyxFQUFFQyxPQUFPLFFBQVEsbUNBQW1DO0FBQ2hHLE9BQU9DLGFBQWEsTUFBTSx3QkFBd0I7QUFFbEQsT0FBT0MsWUFBWSxNQUFNLG1CQUFtQjs7QUFFNUM7QUFDQSxNQUFNQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDdkIsTUFBTUMsYUFBYSxHQUFHLENBQUM7QUFFdkIsZUFBZSxNQUFNQyxhQUFhLFNBQVNMLE9BQU8sQ0FBQztFQU9qRDtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ1NNLFdBQVdBLENBQUVDLGNBQTRCLEVBQzVCQyxlQUF1RCxFQUN2REMsa0JBQXVDLEVBQUc7SUFFNURDLE1BQU0sSUFBSUEsTUFBTSxDQUFFSCxjQUFjLENBQUNJLE1BQU0sS0FBS0gsZUFBZSxDQUFD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