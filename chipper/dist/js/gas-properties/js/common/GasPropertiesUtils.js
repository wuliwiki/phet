// Copyright 2019-2022, University of Colorado Boulder

/**
 * GasPropertiesUtils is a collection of utility functions used in this sim.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import dotRandom from '../../../dot/js/dotRandom.js';
import Utils from '../../../dot/js/Utils.js';
import gasProperties from '../gasProperties.js';
const GasPropertiesUtils = {
  /**
   * Generates n values with a Gaussian mean and deviation.
   * @param n - number of values to generate
   * @param mean - mean of the Gaussian
   * @param deviation - standard deviation of the Gaussian
   * @param threshold - acceptable difference between the desired and actual mean
   */
  getGaussianValues: function (n, mean, deviation, threshold) {
    assert && assert(Number.isInteger(n) && n > 0, `invalid n: ${n}`);
    assert && assert(isFinite(mean), `invalid mean: ${mean}`);
    assert && assert(isFinite(deviation), `invalid deviation: ${deviation}`);
    assert && assert(threshold >= 0, `invalid threshold: ${threshold}`);
    const values = [];
    let sum = 0;

    // Generate a random Gaussian sample whose values have the desired mean and standard deviation.
    for (let i = 0; i < n; i++) {
      const value = Utils.boxMullerTransform(mean, deviation, dotRandom);
      assert && assert(isFinite(value), `invalid value: ${value}`);
      values.push(value);
      sum += value;
    }
    assert && assert(values.length === n, 'wrong number of values');

    // Adjust values so that the actual mean matches the desired mean.
    const emergentMean = sum / n;
    const deltaMean = mean - emergentMean;
    sum = 0;
    for (let i = values.length - 1; i >= 0; i--) {
      const value = values[i] + deltaMean;
      assert && assert(isFinite(value), `invalid value: ${value}`);
      values[i] = value;
      sum += value;
    }

    // Verify that the actual mean is within the tolerance.
    const actualMean = sum / n;
    assert && assert(Math.abs(actualMean - mean) < threshold, `mean: ${mean}, actualMean: ${actualMean}`);
    return values;
  },
  /**
   * Determines the position of a point that is the reflection of a specified point across a line.
   * Used in collision response.
   * @param p - the point to reflect
   * @param pointOnLine - point on the line
   * @param lineAngle - angle of the line, in radians
   * @param reflectedPoint - the point to be mutated with the return value
   * @returns reflectedPoint mutated
   */
  reflectPointAcrossLine(p, pointOnLine, lineAngle, reflectedPoint) {
    const alpha = lineAngle % (Math.PI * 2);
    const gamma = Math.atan2(p.y - pointOnLine.y, p.x - pointOnLine.x) % (Math.PI * 2);
    const theta = (2 * alpha - gamma) % (Math.PI * 2);
    const d = p.distance(pointOnLine);
    reflectedPoint.setXY(pointOnLine.x + d * Math.cos(theta), pointOnLine.y + d * Math.sin(theta));
    return reflectedPoint;
  }
};
gasProperties.register('GasPropertiesUtils', GasPropertiesUtils);
export default GasPropertiesUtils;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJVdGlscyIsImdhc1Byb3BlcnRpZXMiLCJHYXNQcm9wZXJ0aWVzVXRpbHMiLCJnZXRHYXVzc2lhblZhbHVlcyIsIm4iLCJtZWFuIiwiZGV2aWF0aW9uIiwidGhyZXNob2xkIiwiYXNzZXJ0IiwiTnVtYmVyIiwiaXNJbnRlZ2VyIiwiaXNGaW5pdGUiLCJ2YWx1ZXMiLCJzdW0iLCJpIiwidmFsdWUiLCJib3hNdWxsZXJUcmFuc2Zvcm0iLCJwdXNoIiwibGVuZ3RoIiwiZW1lcmdlbnRNZWFuIiwiZGVsdGFNZWFuIiwiYWN0dWFsTWVhbiIsIk1hdGgiLCJhYnMiLCJyZWZsZWN0UG9pbnRBY3Jvc3NMaW5lIiwicCIsInBvaW50T25MaW5lIiwibGluZUFuZ2xlIiwicmVmbGVjdGVkUG9pbnQiLCJhbHBoYSIsIlBJIiwiZ2FtbWEiLCJhdGFuMiIsInkiLCJ4IiwidGhldGEiLCJkIiwiZGlzdGFuY2UiLCJzZXRYWSIsImNvcyIsInNpbiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiR2FzUHJvcGVydGllc1V0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEdhc1Byb3BlcnRpZXNVdGlscyBpcyBhIGNvbGxlY3Rpb24gb2YgdXRpbGl0eSBmdW5jdGlvbnMgdXNlZCBpbiB0aGlzIHNpbS5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgZG90UmFuZG9tIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9kb3RSYW5kb20uanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgZ2FzUHJvcGVydGllcyBmcm9tICcuLi9nYXNQcm9wZXJ0aWVzLmpzJztcclxuXHJcbmNvbnN0IEdhc1Byb3BlcnRpZXNVdGlscyA9IHtcclxuXHJcbiAgLyoqXHJcbiAgICogR2VuZXJhdGVzIG4gdmFsdWVzIHdpdGggYSBHYXVzc2lhbiBtZWFuIGFuZCBkZXZpYXRpb24uXHJcbiAgICogQHBhcmFtIG4gLSBudW1iZXIgb2YgdmFsdWVzIHRvIGdlbmVyYXRlXHJcbiAgICogQHBhcmFtIG1lYW4gLSBtZWFuIG9mIHRoZSBHYXVzc2lhblxyXG4gICAqIEBwYXJhbSBkZXZpYXRpb24gLSBzdGFuZGFyZCBkZXZpYXRpb24gb2YgdGhlIEdhdXNzaWFuXHJcbiAgICogQHBhcmFtIHRocmVzaG9sZCAtIGFjY2VwdGFibGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBkZXNpcmVkIGFuZCBhY3R1YWwgbWVhblxyXG4gICAqL1xyXG4gIGdldEdhdXNzaWFuVmFsdWVzOiBmdW5jdGlvbiggbjogbnVtYmVyLCBtZWFuOiBudW1iZXIsIGRldmlhdGlvbjogbnVtYmVyLCB0aHJlc2hvbGQ6IG51bWJlciApOiBudW1iZXJbXSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBOdW1iZXIuaXNJbnRlZ2VyKCBuICkgJiYgbiA+IDAsIGBpbnZhbGlkIG46ICR7bn1gICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBpc0Zpbml0ZSggbWVhbiApLCBgaW52YWxpZCBtZWFuOiAke21lYW59YCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggaXNGaW5pdGUoIGRldmlhdGlvbiApLCBgaW52YWxpZCBkZXZpYXRpb246ICR7ZGV2aWF0aW9ufWAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRocmVzaG9sZCA+PSAwLCBgaW52YWxpZCB0aHJlc2hvbGQ6ICR7dGhyZXNob2xkfWAgKTtcclxuXHJcbiAgICBjb25zdCB2YWx1ZXM6IG51bWJlcltdID0gW107XHJcbiAgICBsZXQgc3VtID0gMDtcclxuXHJcbiAgICAvLyBHZW5lcmF0ZSBhIHJhbmRvbSBHYXVzc2lhbiBzYW1wbGUgd2hvc2UgdmFsdWVzIGhhdmUgdGhlIGRlc2lyZWQgbWVhbiBhbmQgc3RhbmRhcmQgZGV2aWF0aW9uLlxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgbjsgaSsrICkge1xyXG4gICAgICBjb25zdCB2YWx1ZSA9IFV0aWxzLmJveE11bGxlclRyYW5zZm9ybSggbWVhbiwgZGV2aWF0aW9uLCBkb3RSYW5kb20gKTtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggaXNGaW5pdGUoIHZhbHVlICksIGBpbnZhbGlkIHZhbHVlOiAke3ZhbHVlfWAgKTtcclxuICAgICAgdmFsdWVzLnB1c2goIHZhbHVlICk7XHJcbiAgICAgIHN1bSArPSB2YWx1ZTtcclxuICAgIH1cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHZhbHVlcy5sZW5ndGggPT09IG4sICd3cm9uZyBudW1iZXIgb2YgdmFsdWVzJyApO1xyXG5cclxuICAgIC8vIEFkanVzdCB2YWx1ZXMgc28gdGhhdCB0aGUgYWN0dWFsIG1lYW4gbWF0Y2hlcyB0aGUgZGVzaXJlZCBtZWFuLlxyXG4gICAgY29uc3QgZW1lcmdlbnRNZWFuID0gc3VtIC8gbjtcclxuICAgIGNvbnN0IGRlbHRhTWVhbiA9IG1lYW4gLSBlbWVyZ2VudE1lYW47XHJcbiAgICBzdW0gPSAwO1xyXG4gICAgZm9yICggbGV0IGkgPSB2YWx1ZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0gKSB7XHJcbiAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzWyBpIF0gKyBkZWx0YU1lYW47XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIGlzRmluaXRlKCB2YWx1ZSApLCBgaW52YWxpZCB2YWx1ZTogJHt2YWx1ZX1gICk7XHJcbiAgICAgIHZhbHVlc1sgaSBdID0gdmFsdWU7XHJcbiAgICAgIHN1bSArPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWZXJpZnkgdGhhdCB0aGUgYWN0dWFsIG1lYW4gaXMgd2l0aGluIHRoZSB0b2xlcmFuY2UuXHJcbiAgICBjb25zdCBhY3R1YWxNZWFuID0gc3VtIC8gbjtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIE1hdGguYWJzKCBhY3R1YWxNZWFuIC0gbWVhbiApIDwgdGhyZXNob2xkLFxyXG4gICAgICBgbWVhbjogJHttZWFufSwgYWN0dWFsTWVhbjogJHthY3R1YWxNZWFufWAgKTtcclxuXHJcbiAgICByZXR1cm4gdmFsdWVzO1xyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIERldGVybWluZXMgdGhlIHBvc2l0aW9uIG9mIGEgcG9pbnQgdGhhdCBpcyB0aGUgcmVmbGVjdGlvbiBvZiBhIHNwZWNpZmllZCBwb2ludCBhY3Jvc3MgYSBsaW5lLlxyXG4gICAqIFVzZWQgaW4gY29sbGlzaW9uIHJlc3BvbnNlLlxyXG4gICAqIEBwYXJhbSBwIC0gdGhlIHBvaW50IHRvIHJlZmxlY3RcclxuICAgKiBAcGFyYW0gcG9pbnRPbkxpbmUgLSBwb2ludCBvbiB0aGUgbGluZVxyXG4gICAqIEBwYXJhbSBsaW5lQW5nbGUgLSBhbmdsZSBvZiB0aGUgbGluZSwgaW4gcmFkaWFuc1xyXG4gICAqIEBwYXJhbSByZWZsZWN0ZWRQb2ludCAtIHRoZSBwb2ludCB0byBiZSBtdXRhdGVkIHdpdGggdGhlIHJldHVybiB2YWx1ZVxyXG4gICAqIEByZXR1cm5zIHJlZmxlY3RlZFBvaW50IG11dGF0ZWRcclxuICAgKi9cclxuICByZWZsZWN0UG9pbnRBY3Jvc3NMaW5lKCBwOiBWZWN0b3IyLCBwb2ludE9uTGluZTogVmVjdG9yMiwgbGluZUFuZ2xlOiBudW1iZXIsIHJlZmxlY3RlZFBvaW50OiBWZWN0b3IyICk6IFZlY3RvcjIge1xyXG4gICAgY29uc3QgYWxwaGEgPSBsaW5lQW5nbGUgJSAoIE1hdGguUEkgKiAyICk7XHJcbiAgICBjb25zdCBnYW1tYSA9IE1hdGguYXRhbjIoICggcC55IC0gcG9pbnRPbkxpbmUueSApLCAoIHAueCAtIHBvaW50T25MaW5lLnggKSApICUgKCBNYXRoLlBJICogMiApO1xyXG4gICAgY29uc3QgdGhldGEgPSAoIDIgKiBhbHBoYSAtIGdhbW1hICkgJSAoIE1hdGguUEkgKiAyICk7XHJcbiAgICBjb25zdCBkID0gcC5kaXN0YW5jZSggcG9pbnRPbkxpbmUgKTtcclxuICAgIHJlZmxlY3RlZFBvaW50LnNldFhZKCBwb2ludE9uTGluZS54ICsgZCAqIE1hdGguY29zKCB0aGV0YSApLCBwb2ludE9uTGluZS55ICsgZCAqIE1hdGguc2luKCB0aGV0YSApICk7XHJcbiAgICByZXR1cm4gcmVmbGVjdGVkUG9pbnQ7XHJcbiAgfVxyXG59O1xyXG5cclxuZ2FzUHJvcGVydGllcy5yZWdpc3RlciggJ0dhc1Byb3BlcnRpZXNVdGlscycsIEdhc1Byb3BlcnRpZXNVdGlscyApO1xyXG5leHBvcnQgZGVmYXVsdCBHYXNQcm9wZXJ0aWVzVXRpbHM7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFNBQVMsTUFBTSw4QkFBOEI7QUFDcEQsT0FBT0MsS0FBSyxNQUFNLDBCQUEwQjtBQUU1QyxPQUFPQyxhQUFhLE1BQU0scUJBQXFCO0FBRS9DLE1BQU1DLGtCQUFrQixHQUFHO0VBRXpCO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLGlCQUFpQixFQUFFLFNBQUFBLENBQVVDLENBQVMsRUFBRUMsSUFBWSxFQUFFQyxTQUFpQixFQUFFQyxTQUFpQixFQUFhO0lBQ3JHQyxNQUFNLElBQUlBLE1BQU0sQ0FBRUMsTUFBTSxDQUFDQyxTQUFTLENBQUVOLENBQUUsQ0FBQyxJQUFJQSxDQUFDLEdBQUcsQ0FBQyxFQUFHLGNBQWFBLENBQUUsRUFBRSxDQUFDO0lBQ3JFSSxNQUFNLElBQUlBLE1BQU0sQ0FBRUcsUUFBUSxDQUFFTixJQUFLLENBQUMsRUFBRyxpQkFBZ0JBLElBQUssRUFBRSxDQUFDO0lBQzdERyxNQUFNLElBQUlBLE1BQU0sQ0FBRUcsUUFBUSxDQUFFTCxTQUFVLENBQUMsRUFBRyxzQkFBcUJBLFNBQVUsRUFBRSxDQUFDO0lBQzVFRSxNQUFNLElBQUlBLE1BQU0sQ0FBRUQsU0FBUyxJQUFJLENBQUMsRUFBRyxzQkFBcUJBLFNBQVUsRUFBRSxDQUFDO0lBRXJFLE1BQU1LLE1BQWdCLEdBQUcsRUFBRTtJQUMzQixJQUFJQyxHQUFHLEdBQUcsQ0FBQzs7SUFFWDtJQUNBLEtBQU0sSUFBSUMsQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHVixDQUFDLEVBQUVVLENBQUMsRUFBRSxFQUFHO01BQzVCLE1BQU1DLEtBQUssR0FBR2YsS0FBSyxDQUFDZ0Isa0JBQWtCLENBQUVYLElBQUksRUFBRUMsU0FBUyxFQUFFUCxTQUFVLENBQUM7TUFDcEVTLE1BQU0sSUFBSUEsTUFBTSxDQUFFRyxRQUFRLENBQUVJLEtBQU0sQ0FBQyxFQUFHLGtCQUFpQkEsS0FBTSxFQUFFLENBQUM7TUFDaEVILE1BQU0sQ0FBQ0ssSUFBSSxDQUFFRixLQUFNLENBQUM7TUFDcEJGLEdBQUcsSUFBSUUsS0FBSztJQUNkO0lBQ0FQLE1BQU0sSUFBSUEsTUFBTSxDQUFFSSxNQUFNLENBQUNNLE1BQU0sS0FBS2QsQ0FBQyxFQUFFLHdCQUF5QixDQUFDOztJQUVqRTtJQUNBLE1BQU1lLFlBQVksR0FBR04sR0FBRyxHQUFHVCxDQUFDO0lBQzVCLE1BQU1nQixTQUFTLEdBQUdmLElBQUksR0FBR2MsWUFBWTtJQUNyQ04sR0FBRyxHQUFHLENBQUM7SUFDUCxLQUFNLElBQUlDLENBQUMsR0FBR0YsTUFBTSxDQUFDTSxNQUFNLEdBQUcsQ0FBQyxFQUFFSixDQUFDLElBQUksQ0FBQyxFQUFFQSxDQUFDLEVBQUUsRUFBRztNQUM3QyxNQUFNQyxLQUFLLEdBQUdILE1BQU0sQ0FBRUUsQ0FBQyxDQUFFLEdBQUdNLFNBQVM7TUFDckNaLE1BQU0sSUFBSUEsTUFBTSxDQUFFRyxRQUFRLENBQUVJLEtBQU0sQ0FBQyxFQUFHLGtCQUFpQkEsS0FBTSxFQUFFLENBQUM7TUFDaEVILE1BQU0sQ0FBRUUsQ0FBQyxDQUFFLEdBQUdDLEtBQUs7TUFDbkJGLEdBQUcsSUFBSUUsS0FBSztJQUNkOztJQUVBO0lBQ0EsTUFBTU0sVUFBVSxHQUFHUixHQUFHLEdBQUdULENBQUM7SUFDMUJJLE1BQU0sSUFBSUEsTUFBTSxDQUFFYyxJQUFJLENBQUNDLEdBQUcsQ0FBRUYsVUFBVSxHQUFHaEIsSUFBSyxDQUFDLEdBQUdFLFNBQVMsRUFDeEQsU0FBUUYsSUFBSyxpQkFBZ0JnQixVQUFXLEVBQUUsQ0FBQztJQUU5QyxPQUFPVCxNQUFNO0VBQ2YsQ0FBQztFQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFWSxzQkFBc0JBLENBQUVDLENBQVUsRUFBRUMsV0FBb0IsRUFBRUMsU0FBaUIsRUFBRUMsY0FBdUIsRUFBWTtJQUM5RyxNQUFNQyxLQUFLLEdBQUdGLFNBQVMsSUFBS0wsSUFBSSxDQUFDUSxFQUFFLEdBQUcsQ0FBQyxDQUFFO0lBQ3pDLE1BQU1DLEtBQUssR0FBR1QsSUFBSSxDQUFDVSxLQUFLLENBQUlQLENBQUMsQ0FBQ1EsQ0FBQyxHQUFHUCxXQUFXLENBQUNPLENBQUMsRUFBTVIsQ0FBQyxDQUFDUyxDQUFDLEdBQUdSLFdBQVcsQ0FBQ1EsQ0FBSSxDQUFDLElBQUtaLElBQUksQ0FBQ1EsRUFBRSxHQUFHLENBQUMsQ0FBRTtJQUM5RixNQUFNSyxLQUFLLEdBQUcsQ0FBRSxDQUFDLEdBQUdOLEtBQUssR0FBR0UsS0FBSyxLQUFPVCxJQUFJLENBQUNRLEVBQUUsR0FBRyxDQUFDLENBQUU7SUFDckQsTUFBTU0sQ0FBQyxHQUFHWCxDQUFDLENBQUNZLFFBQVEsQ0FBRVgsV0FBWSxDQUFDO0lBQ25DRSxjQUFjLENBQUNVLEtBQUssQ0FBRVosV0FBVyxDQUFDUSxDQUFDLEdBQUdFLENBQUMsR0FBR2QsSUFBSSxDQUFDaUIsR0FBRyxDQUFFSixLQUFNLENBQUMsRUFBRVQsV0FBVyxDQUFDTyxDQUFDLEdBQUdHLENBQUMsR0FBR2QsSUFBSSxDQUFDa0IsR0FBRyxDQUFFTCxLQUFNLENBQUUsQ0FBQztJQUNwRyxPQUFPUCxjQUFjO0VBQ3ZCO0FBQ0YsQ0FBQztBQUVEM0IsYUFBYSxDQUFDd0MsUUFBUSxDQUFFLG9CQUFvQixFQUFFdkMsa0JBQW1CLENBQUM7QUFDbEUsZUFBZUEsa0JBQWtCIn0=