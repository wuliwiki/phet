// Copyright 2019-2022, University of Colorado Boulder

/**
 * DiffusionSettingsNode is the user interface for setting initial conditions in the 'Diffusion' screen.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import optionize, { combineOptions } from '../../../../phet-core/js/optionize.js';
import { AlignBox, AlignGroup, HBox, HStrut, Text, VBox } from '../../../../scenery/js/imports.js';
import GasPropertiesColors from '../../common/GasPropertiesColors.js';
import GasPropertiesConstants from '../../common/GasPropertiesConstants.js';
import GasPropertiesIconFactory from '../../common/view/GasPropertiesIconFactory.js';
import gasProperties from '../../gasProperties.js';
import GasPropertiesStrings from '../../GasPropertiesStrings.js';
import DiffusionSettings from '../model/DiffusionSettings.js';
import GasPropertiesSpinner from './GasPropertiesSpinner.js';

// constants
const ICON_SPACING = 10; // space between particle icon and spinner

export default class DiffusionSettingsNode extends VBox {
  /**
   * @param leftSettings - setting for the left side of the container
   * @param rightSettings - setting for the right side of the container
   * @param modelViewTransform
   * @param enabledProperty
   * @param providedOptions
   */
  constructor(leftSettings, rightSettings, modelViewTransform, enabledProperty, providedOptions) {
    const options = optionize()({
      // VBoxOptions
      spacing: 20,
      align: 'left'
    }, providedOptions);

    // To make all spinners have the same bounds width
    const spinnersAlignGroup = new AlignGroup({
      matchHorizontal: true
    });

    // Number of Particles
    const numberOfParticlesControl = new QuantityControl(GasPropertiesStrings.numberOfParticlesStringProperty, modelViewTransform, leftSettings.numberOfParticlesProperty, rightSettings.numberOfParticlesProperty, spinnersAlignGroup, {
      spinnerOptions: {
        enabledProperty: enabledProperty,
        deltaValue: DiffusionSettings.DELTAS.numberOfParticles
      },
      tandem: options.tandem.createTandem('numberOfParticlesControl')
    });

    // Mass (AMU)
    const massControl = new QuantityControl(GasPropertiesStrings.massAMUStringProperty, modelViewTransform, leftSettings.massProperty, rightSettings.massProperty, spinnersAlignGroup, {
      spinnerOptions: {
        enabledProperty: enabledProperty,
        deltaValue: DiffusionSettings.DELTAS.mass,
        numberDisplayOptions: {
          xMargin: 12.45 // mass spinners are narrower because they have fewer digits, compensate empirically
        }
      },

      tandem: options.tandem.createTandem('massControl')
    });

    // Radius (pm)
    const radiusControl = new QuantityControl(GasPropertiesStrings.radiusPmStringProperty, modelViewTransform, leftSettings.radiusProperty, rightSettings.radiusProperty, spinnersAlignGroup, {
      spinnerOptions: {
        enabledProperty: enabledProperty,
        deltaValue: DiffusionSettings.DELTAS.radius
      },
      tandem: options.tandem.createTandem('radiusControl')
    });

    // Initial Temperature (K)
    const initialTemperatureControl = new QuantityControl(GasPropertiesStrings.initialTemperatureKStringProperty, modelViewTransform, leftSettings.initialTemperatureProperty, rightSettings.initialTemperatureProperty, spinnersAlignGroup, {
      spinnerOptions: {
        enabledProperty: enabledProperty,
        deltaValue: DiffusionSettings.DELTAS.initialTemperature
      },
      tandem: options.tandem.createTandem('initialTemperatureControl')
    });
    options.children = [numberOfParticlesControl, massControl, radiusControl, initialTemperatureControl];
    super(options);
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
}

/**
 * A label and two spinners, for changing the same quantity for the left and right sides of the container.
 */

class QuantityControl extends VBox {
  /**
   * @param labelStringProperty
   * @param modelViewTransform
   * @param leftProperty - quantity for the left side of the container
   * @param rightProperty - quantity for the right side of the container
   * @param spinnersAlignGroup
   * @param providedOptions
   */
  constructor(labelStringProperty, modelViewTransform, leftProperty, rightProperty, spinnersAlignGroup, providedOptions) {
    const options = optionize()({
      // VBoxOptions
      spacing: 12,
      align: 'left'
    }, providedOptions);

    // label
    const labelText = new Text(labelStringProperty, {
      font: GasPropertiesConstants.CONTROL_FONT,
      fill: GasPropertiesColors.textFillProperty,
      maxWidth: 200,
      // determined empirically
      tandem: options.tandem.createTandem('labelText')
    });

    // icons
    const leftParticleIcon = GasPropertiesIconFactory.createDiffusionParticle1Icon(modelViewTransform);
    const rightParticleIcon = GasPropertiesIconFactory.createDiffusionParticle2Icon(modelViewTransform);

    // spinners, with uniform bounds width to facilitate layout
    const alignBoxOptions = {
      group: spinnersAlignGroup,
      xAlign: 'left'
    };
    const leftSpinner = new AlignBox(new GasPropertiesSpinner(leftProperty, combineOptions({
      tandem: options.tandem.createTandem('leftSpinner')
    }, options.spinnerOptions)), alignBoxOptions);
    const rightSpinner = new AlignBox(new GasPropertiesSpinner(rightProperty, combineOptions({
      tandem: options.tandem.createTandem('rightSpinner')
    }, options.spinnerOptions)), alignBoxOptions);

    // left icon and spinner
    const leftBox = new HBox({
      spacing: ICON_SPACING,
      children: [leftParticleIcon, leftSpinner]
    });

    // right icon and spinner
    const rightBox = new HBox({
      spacing: ICON_SPACING,
      children: [rightParticleIcon, rightSpinner]
    });

    // both controls, indented
    const hBox = new HBox({
      spacing: 30,
      children: [new HStrut(1), leftBox, rightBox]
    });
    options.children = [labelText, hBox];
    super(options);
  }
}
gasProperties.register('DiffusionSettingsNode', DiffusionSettingsNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJvcHRpb25pemUiLCJjb21iaW5lT3B0aW9ucyIsIkFsaWduQm94IiwiQWxpZ25Hcm91cCIsIkhCb3giLCJIU3RydXQiLCJUZXh0IiwiVkJveCIsIkdhc1Byb3BlcnRpZXNDb2xvcnMiLCJHYXNQcm9wZXJ0aWVzQ29uc3RhbnRzIiwiR2FzUHJvcGVydGllc0ljb25GYWN0b3J5IiwiZ2FzUHJvcGVydGllcyIsIkdhc1Byb3BlcnRpZXNTdHJpbmdzIiwiRGlmZnVzaW9uU2V0dGluZ3MiLCJHYXNQcm9wZXJ0aWVzU3Bpbm5lciIsIklDT05fU1BBQ0lORyIsIkRpZmZ1c2lvblNldHRpbmdzTm9kZSIsImNvbnN0cnVjdG9yIiwibGVmdFNldHRpbmdzIiwicmlnaHRTZXR0aW5ncyIsIm1vZGVsVmlld1RyYW5zZm9ybSIsImVuYWJsZWRQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJzcGFjaW5nIiwiYWxpZ24iLCJzcGlubmVyc0FsaWduR3JvdXAiLCJtYXRjaEhvcml6b250YWwiLCJudW1iZXJPZlBhcnRpY2xlc0NvbnRyb2wiLCJRdWFudGl0eUNvbnRyb2wiLCJudW1iZXJPZlBhcnRpY2xlc1N0cmluZ1Byb3BlcnR5IiwibnVtYmVyT2ZQYXJ0aWNsZXNQcm9wZXJ0eSIsInNwaW5uZXJPcHRpb25zIiwiZGVsdGFWYWx1ZSIsIkRFTFRBUyIsIm51bWJlck9mUGFydGljbGVzIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwibWFzc0NvbnRyb2wiLCJtYXNzQU1VU3RyaW5nUHJvcGVydHkiLCJtYXNzUHJvcGVydHkiLCJtYXNzIiwibnVtYmVyRGlzcGxheU9wdGlvbnMiLCJ4TWFyZ2luIiwicmFkaXVzQ29udHJvbCIsInJhZGl1c1BtU3RyaW5nUHJvcGVydHkiLCJyYWRpdXNQcm9wZXJ0eSIsInJhZGl1cyIsImluaXRpYWxUZW1wZXJhdHVyZUNvbnRyb2wiLCJpbml0aWFsVGVtcGVyYXR1cmVLU3RyaW5nUHJvcGVydHkiLCJpbml0aWFsVGVtcGVyYXR1cmVQcm9wZXJ0eSIsImluaXRpYWxUZW1wZXJhdHVyZSIsImNoaWxkcmVuIiwiZGlzcG9zZSIsImFzc2VydCIsImxhYmVsU3RyaW5nUHJvcGVydHkiLCJsZWZ0UHJvcGVydHkiLCJyaWdodFByb3BlcnR5IiwibGFiZWxUZXh0IiwiZm9udCIsIkNPTlRST0xfRk9OVCIsImZpbGwiLCJ0ZXh0RmlsbFByb3BlcnR5IiwibWF4V2lkdGgiLCJsZWZ0UGFydGljbGVJY29uIiwiY3JlYXRlRGlmZnVzaW9uUGFydGljbGUxSWNvbiIsInJpZ2h0UGFydGljbGVJY29uIiwiY3JlYXRlRGlmZnVzaW9uUGFydGljbGUySWNvbiIsImFsaWduQm94T3B0aW9ucyIsImdyb3VwIiwieEFsaWduIiwibGVmdFNwaW5uZXIiLCJyaWdodFNwaW5uZXIiLCJsZWZ0Qm94IiwicmlnaHRCb3giLCJoQm94IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJEaWZmdXNpb25TZXR0aW5nc05vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogRGlmZnVzaW9uU2V0dGluZ3NOb2RlIGlzIHRoZSB1c2VyIGludGVyZmFjZSBmb3Igc2V0dGluZyBpbml0aWFsIGNvbmRpdGlvbnMgaW4gdGhlICdEaWZmdXNpb24nIHNjcmVlbi5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBjb21iaW5lT3B0aW9ucywgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBNb2RlbFZpZXdUcmFuc2Zvcm0yIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdmlldy9Nb2RlbFZpZXdUcmFuc2Zvcm0yLmpzJztcclxuaW1wb3J0IHsgQWxpZ25Cb3gsIEFsaWduQm94T3B0aW9ucywgQWxpZ25Hcm91cCwgSEJveCwgSFN0cnV0LCBUZXh0LCBWQm94LCBWQm94T3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBHYXNQcm9wZXJ0aWVzQ29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi9HYXNQcm9wZXJ0aWVzQ29sb3JzLmpzJztcclxuaW1wb3J0IEdhc1Byb3BlcnRpZXNDb25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL0dhc1Byb3BlcnRpZXNDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgR2FzUHJvcGVydGllc0ljb25GYWN0b3J5IGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0dhc1Byb3BlcnRpZXNJY29uRmFjdG9yeS5qcyc7XHJcbmltcG9ydCBnYXNQcm9wZXJ0aWVzIGZyb20gJy4uLy4uL2dhc1Byb3BlcnRpZXMuanMnO1xyXG5pbXBvcnQgR2FzUHJvcGVydGllc1N0cmluZ3MgZnJvbSAnLi4vLi4vR2FzUHJvcGVydGllc1N0cmluZ3MuanMnO1xyXG5pbXBvcnQgRGlmZnVzaW9uU2V0dGluZ3MgZnJvbSAnLi4vbW9kZWwvRGlmZnVzaW9uU2V0dGluZ3MuanMnO1xyXG5pbXBvcnQgR2FzUHJvcGVydGllc1NwaW5uZXIsIHsgR2FzUHJvcGVydGllc1NwaW5uZXJPcHRpb25zIH0gZnJvbSAnLi9HYXNQcm9wZXJ0aWVzU3Bpbm5lci5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgSUNPTl9TUEFDSU5HID0gMTA7IC8vIHNwYWNlIGJldHdlZW4gcGFydGljbGUgaWNvbiBhbmQgc3Bpbm5lclxyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IEVtcHR5U2VsZk9wdGlvbnM7XHJcblxyXG50eXBlIERpZmZ1c2lvblNldHRpbmdzTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxWQm94T3B0aW9ucywgJ3RhbmRlbSc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGlmZnVzaW9uU2V0dGluZ3NOb2RlIGV4dGVuZHMgVkJveCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBsZWZ0U2V0dGluZ3MgLSBzZXR0aW5nIGZvciB0aGUgbGVmdCBzaWRlIG9mIHRoZSBjb250YWluZXJcclxuICAgKiBAcGFyYW0gcmlnaHRTZXR0aW5ncyAtIHNldHRpbmcgZm9yIHRoZSByaWdodCBzaWRlIG9mIHRoZSBjb250YWluZXJcclxuICAgKiBAcGFyYW0gbW9kZWxWaWV3VHJhbnNmb3JtXHJcbiAgICogQHBhcmFtIGVuYWJsZWRQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSBwcm92aWRlZE9wdGlvbnNcclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGxlZnRTZXR0aW5nczogRGlmZnVzaW9uU2V0dGluZ3MsIHJpZ2h0U2V0dGluZ3M6IERpZmZ1c2lvblNldHRpbmdzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtOiBNb2RlbFZpZXdUcmFuc2Zvcm0yLCBlbmFibGVkUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWRPcHRpb25zOiBEaWZmdXNpb25TZXR0aW5nc05vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8RGlmZnVzaW9uU2V0dGluZ3NOb2RlT3B0aW9ucywgU2VsZk9wdGlvbnMsIFZCb3hPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBWQm94T3B0aW9uc1xyXG4gICAgICBzcGFjaW5nOiAyMCxcclxuICAgICAgYWxpZ246ICdsZWZ0J1xyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gVG8gbWFrZSBhbGwgc3Bpbm5lcnMgaGF2ZSB0aGUgc2FtZSBib3VuZHMgd2lkdGhcclxuICAgIGNvbnN0IHNwaW5uZXJzQWxpZ25Hcm91cCA9IG5ldyBBbGlnbkdyb3VwKCB7XHJcbiAgICAgIG1hdGNoSG9yaXpvbnRhbDogdHJ1ZVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIE51bWJlciBvZiBQYXJ0aWNsZXNcclxuICAgIGNvbnN0IG51bWJlck9mUGFydGljbGVzQ29udHJvbCA9IG5ldyBRdWFudGl0eUNvbnRyb2woIEdhc1Byb3BlcnRpZXNTdHJpbmdzLm51bWJlck9mUGFydGljbGVzU3RyaW5nUHJvcGVydHksXHJcbiAgICAgIG1vZGVsVmlld1RyYW5zZm9ybSwgbGVmdFNldHRpbmdzLm51bWJlck9mUGFydGljbGVzUHJvcGVydHksIHJpZ2h0U2V0dGluZ3MubnVtYmVyT2ZQYXJ0aWNsZXNQcm9wZXJ0eSwgc3Bpbm5lcnNBbGlnbkdyb3VwLCB7XHJcbiAgICAgICAgc3Bpbm5lck9wdGlvbnM6IHtcclxuICAgICAgICAgIGVuYWJsZWRQcm9wZXJ0eTogZW5hYmxlZFByb3BlcnR5LFxyXG4gICAgICAgICAgZGVsdGFWYWx1ZTogRGlmZnVzaW9uU2V0dGluZ3MuREVMVEFTLm51bWJlck9mUGFydGljbGVzXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ251bWJlck9mUGFydGljbGVzQ29udHJvbCcgKVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgLy8gTWFzcyAoQU1VKVxyXG4gICAgY29uc3QgbWFzc0NvbnRyb2wgPSBuZXcgUXVhbnRpdHlDb250cm9sKCBHYXNQcm9wZXJ0aWVzU3RyaW5ncy5tYXNzQU1VU3RyaW5nUHJvcGVydHksIG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgbGVmdFNldHRpbmdzLm1hc3NQcm9wZXJ0eSwgcmlnaHRTZXR0aW5ncy5tYXNzUHJvcGVydHksIHNwaW5uZXJzQWxpZ25Hcm91cCwge1xyXG4gICAgICAgIHNwaW5uZXJPcHRpb25zOiB7XHJcbiAgICAgICAgICBlbmFibGVkUHJvcGVydHk6IGVuYWJsZWRQcm9wZXJ0eSxcclxuICAgICAgICAgIGRlbHRhVmFsdWU6IERpZmZ1c2lvblNldHRpbmdzLkRFTFRBUy5tYXNzLFxyXG4gICAgICAgICAgbnVtYmVyRGlzcGxheU9wdGlvbnM6IHtcclxuICAgICAgICAgICAgeE1hcmdpbjogMTIuNDUgLy8gbWFzcyBzcGlubmVycyBhcmUgbmFycm93ZXIgYmVjYXVzZSB0aGV5IGhhdmUgZmV3ZXIgZGlnaXRzLCBjb21wZW5zYXRlIGVtcGlyaWNhbGx5XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ21hc3NDb250cm9sJyApXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBSYWRpdXMgKHBtKVxyXG4gICAgY29uc3QgcmFkaXVzQ29udHJvbCA9IG5ldyBRdWFudGl0eUNvbnRyb2woIEdhc1Byb3BlcnRpZXNTdHJpbmdzLnJhZGl1c1BtU3RyaW5nUHJvcGVydHksIG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgbGVmdFNldHRpbmdzLnJhZGl1c1Byb3BlcnR5LCByaWdodFNldHRpbmdzLnJhZGl1c1Byb3BlcnR5LCBzcGlubmVyc0FsaWduR3JvdXAsIHtcclxuICAgICAgICBzcGlubmVyT3B0aW9uczoge1xyXG4gICAgICAgICAgZW5hYmxlZFByb3BlcnR5OiBlbmFibGVkUHJvcGVydHksXHJcbiAgICAgICAgICBkZWx0YVZhbHVlOiBEaWZmdXNpb25TZXR0aW5ncy5ERUxUQVMucmFkaXVzXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3JhZGl1c0NvbnRyb2wnIClcclxuICAgICAgfSApO1xyXG5cclxuICAgIC8vIEluaXRpYWwgVGVtcGVyYXR1cmUgKEspXHJcbiAgICBjb25zdCBpbml0aWFsVGVtcGVyYXR1cmVDb250cm9sID0gbmV3IFF1YW50aXR5Q29udHJvbCggR2FzUHJvcGVydGllc1N0cmluZ3MuaW5pdGlhbFRlbXBlcmF0dXJlS1N0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBtb2RlbFZpZXdUcmFuc2Zvcm0sIGxlZnRTZXR0aW5ncy5pbml0aWFsVGVtcGVyYXR1cmVQcm9wZXJ0eSwgcmlnaHRTZXR0aW5ncy5pbml0aWFsVGVtcGVyYXR1cmVQcm9wZXJ0eSwgc3Bpbm5lcnNBbGlnbkdyb3VwLCB7XHJcbiAgICAgICAgc3Bpbm5lck9wdGlvbnM6IHtcclxuICAgICAgICAgIGVuYWJsZWRQcm9wZXJ0eTogZW5hYmxlZFByb3BlcnR5LFxyXG4gICAgICAgICAgZGVsdGFWYWx1ZTogRGlmZnVzaW9uU2V0dGluZ3MuREVMVEFTLmluaXRpYWxUZW1wZXJhdHVyZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdpbml0aWFsVGVtcGVyYXR1cmVDb250cm9sJyApXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gW1xyXG4gICAgICBudW1iZXJPZlBhcnRpY2xlc0NvbnRyb2wsXHJcbiAgICAgIG1hc3NDb250cm9sLFxyXG4gICAgICByYWRpdXNDb250cm9sLFxyXG4gICAgICBpbml0aWFsVGVtcGVyYXR1cmVDb250cm9sXHJcbiAgICBdO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEEgbGFiZWwgYW5kIHR3byBzcGlubmVycywgZm9yIGNoYW5naW5nIHRoZSBzYW1lIHF1YW50aXR5IGZvciB0aGUgbGVmdCBhbmQgcmlnaHQgc2lkZXMgb2YgdGhlIGNvbnRhaW5lci5cclxuICovXHJcblxyXG50eXBlIFF1YW50aXR5Q29udHJvbFNlbGZPcHRpb25zID0ge1xyXG4gIHNwaW5uZXJPcHRpb25zPzogU3RyaWN0T21pdDxHYXNQcm9wZXJ0aWVzU3Bpbm5lck9wdGlvbnMsICd0YW5kZW0nPjtcclxufTtcclxuXHJcbnR5cGUgUXVhbnRpdHlDb250cm9sT3B0aW9ucyA9IFF1YW50aXR5Q29udHJvbFNlbGZPcHRpb25zICYgUGlja1JlcXVpcmVkPFZCb3hPcHRpb25zLCAndGFuZGVtJz47XHJcblxyXG5jbGFzcyBRdWFudGl0eUNvbnRyb2wgZXh0ZW5kcyBWQm94IHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIGxhYmVsU3RyaW5nUHJvcGVydHlcclxuICAgKiBAcGFyYW0gbW9kZWxWaWV3VHJhbnNmb3JtXHJcbiAgICogQHBhcmFtIGxlZnRQcm9wZXJ0eSAtIHF1YW50aXR5IGZvciB0aGUgbGVmdCBzaWRlIG9mIHRoZSBjb250YWluZXJcclxuICAgKiBAcGFyYW0gcmlnaHRQcm9wZXJ0eSAtIHF1YW50aXR5IGZvciB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgY29udGFpbmVyXHJcbiAgICogQHBhcmFtIHNwaW5uZXJzQWxpZ25Hcm91cFxyXG4gICAqIEBwYXJhbSBwcm92aWRlZE9wdGlvbnNcclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGxhYmVsU3RyaW5nUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4sIG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMixcclxuICAgICAgICAgICAgICAgICAgICAgIGxlZnRQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHksIHJpZ2h0UHJvcGVydHk6IE51bWJlclByb3BlcnR5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgc3Bpbm5lcnNBbGlnbkdyb3VwOiBBbGlnbkdyb3VwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWRPcHRpb25zOiBRdWFudGl0eUNvbnRyb2xPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8UXVhbnRpdHlDb250cm9sT3B0aW9ucywgU3RyaWN0T21pdDxRdWFudGl0eUNvbnRyb2xTZWxmT3B0aW9ucywgJ3NwaW5uZXJPcHRpb25zJz4sIFZCb3hPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBWQm94T3B0aW9uc1xyXG4gICAgICBzcGFjaW5nOiAxMixcclxuICAgICAgYWxpZ246ICdsZWZ0J1xyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gbGFiZWxcclxuICAgIGNvbnN0IGxhYmVsVGV4dCA9IG5ldyBUZXh0KCBsYWJlbFN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgIGZvbnQ6IEdhc1Byb3BlcnRpZXNDb25zdGFudHMuQ09OVFJPTF9GT05ULFxyXG4gICAgICBmaWxsOiBHYXNQcm9wZXJ0aWVzQ29sb3JzLnRleHRGaWxsUHJvcGVydHksXHJcbiAgICAgIG1heFdpZHRoOiAyMDAsIC8vIGRldGVybWluZWQgZW1waXJpY2FsbHlcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdsYWJlbFRleHQnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBpY29uc1xyXG4gICAgY29uc3QgbGVmdFBhcnRpY2xlSWNvbiA9IEdhc1Byb3BlcnRpZXNJY29uRmFjdG9yeS5jcmVhdGVEaWZmdXNpb25QYXJ0aWNsZTFJY29uKCBtb2RlbFZpZXdUcmFuc2Zvcm0gKTtcclxuICAgIGNvbnN0IHJpZ2h0UGFydGljbGVJY29uID0gR2FzUHJvcGVydGllc0ljb25GYWN0b3J5LmNyZWF0ZURpZmZ1c2lvblBhcnRpY2xlMkljb24oIG1vZGVsVmlld1RyYW5zZm9ybSApO1xyXG5cclxuICAgIC8vIHNwaW5uZXJzLCB3aXRoIHVuaWZvcm0gYm91bmRzIHdpZHRoIHRvIGZhY2lsaXRhdGUgbGF5b3V0XHJcbiAgICBjb25zdCBhbGlnbkJveE9wdGlvbnM6IEFsaWduQm94T3B0aW9ucyA9IHtcclxuICAgICAgZ3JvdXA6IHNwaW5uZXJzQWxpZ25Hcm91cCxcclxuICAgICAgeEFsaWduOiAnbGVmdCdcclxuICAgIH07XHJcbiAgICBjb25zdCBsZWZ0U3Bpbm5lciA9IG5ldyBBbGlnbkJveCggbmV3IEdhc1Byb3BlcnRpZXNTcGlubmVyKCBsZWZ0UHJvcGVydHksIGNvbWJpbmVPcHRpb25zPEdhc1Byb3BlcnRpZXNTcGlubmVyT3B0aW9ucz4oIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdsZWZ0U3Bpbm5lcicgKVxyXG4gICAgfSwgb3B0aW9ucy5zcGlubmVyT3B0aW9ucyApICksIGFsaWduQm94T3B0aW9ucyApO1xyXG4gICAgY29uc3QgcmlnaHRTcGlubmVyID0gbmV3IEFsaWduQm94KCBuZXcgR2FzUHJvcGVydGllc1NwaW5uZXIoIHJpZ2h0UHJvcGVydHksIGNvbWJpbmVPcHRpb25zPEdhc1Byb3BlcnRpZXNTcGlubmVyT3B0aW9ucz4oIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdyaWdodFNwaW5uZXInIClcclxuICAgIH0sIG9wdGlvbnMuc3Bpbm5lck9wdGlvbnMgKSApLCBhbGlnbkJveE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBsZWZ0IGljb24gYW5kIHNwaW5uZXJcclxuICAgIGNvbnN0IGxlZnRCb3ggPSBuZXcgSEJveCgge1xyXG4gICAgICBzcGFjaW5nOiBJQ09OX1NQQUNJTkcsXHJcbiAgICAgIGNoaWxkcmVuOiBbIGxlZnRQYXJ0aWNsZUljb24sIGxlZnRTcGlubmVyIF1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyByaWdodCBpY29uIGFuZCBzcGlubmVyXHJcbiAgICBjb25zdCByaWdodEJveCA9IG5ldyBIQm94KCB7XHJcbiAgICAgIHNwYWNpbmc6IElDT05fU1BBQ0lORyxcclxuICAgICAgY2hpbGRyZW46IFsgcmlnaHRQYXJ0aWNsZUljb24sIHJpZ2h0U3Bpbm5lciBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYm90aCBjb250cm9scywgaW5kZW50ZWRcclxuICAgIGNvbnN0IGhCb3ggPSBuZXcgSEJveCgge1xyXG4gICAgICBzcGFjaW5nOiAzMCxcclxuICAgICAgY2hpbGRyZW46IFsgbmV3IEhTdHJ1dCggMSApLCBsZWZ0Qm94LCByaWdodEJveCBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFsgbGFiZWxUZXh0LCBoQm94IF07XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuICB9XHJcbn1cclxuXHJcbmdhc1Byb3BlcnRpZXMucmVnaXN0ZXIoICdEaWZmdXNpb25TZXR0aW5nc05vZGUnLCBEaWZmdXNpb25TZXR0aW5nc05vZGUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBSUEsT0FBT0EsU0FBUyxJQUFJQyxjQUFjLFFBQTBCLHVDQUF1QztBQUluRyxTQUFTQyxRQUFRLEVBQW1CQyxVQUFVLEVBQUVDLElBQUksRUFBRUMsTUFBTSxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBcUIsbUNBQW1DO0FBQ2hJLE9BQU9DLG1CQUFtQixNQUFNLHFDQUFxQztBQUNyRSxPQUFPQyxzQkFBc0IsTUFBTSx3Q0FBd0M7QUFDM0UsT0FBT0Msd0JBQXdCLE1BQU0sK0NBQStDO0FBQ3BG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