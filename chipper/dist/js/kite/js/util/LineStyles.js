// Copyright 2013-2022, University of Colorado Boulder

/**
 * Styles needed to determine a stroked line shape. Generally immutable.
 *
 * Mirrors much of what is done with SVG/Canvas, see https://svgwg.org/svg2-draft/painting.html for details.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Utils from '../../../dot/js/Utils.js';
import merge from '../../../phet-core/js/merge.js';
import { Arc, kite, Line } from '../imports.js';

// constants
const lineLineIntersection = Utils.lineLineIntersection;
const DEFAULT_OPTIONS = {
  lineWidth: 1,
  lineCap: 'butt',
  lineJoin: 'miter',
  lineDash: [],
  lineDashOffset: 0,
  miterLimit: 10
};
export default class LineStyles {
  // The width of the line (will be offset to each side by lineWidth/2)

  // 'butt', 'round' or 'square' - Controls appearance at endpoints for non-closed subpaths.
  // - butt: straight-line at end point, going through the endpoint (perpendicular to the tangent)
  // - round: circular border with radius lineWidth/2 around endpoints
  // - square: straight-line past the end point (by lineWidth/2)
  // See: https://svgwg.org/svg2-draft/painting.html#LineCaps
  // 'miter', 'round' or 'bevel' - Controls appearance at joints between segments (at the point)
  // - miter: Use sharp corners (which aren't too sharp, see miterLimit). Extends edges until they meed.
  // - round: circular border with radius lineWidth/2 around joints
  // - bevel: directly joins the gap with a line segment.
  // See: https://svgwg.org/svg2-draft/painting.html#LineJoin
  // Even values in the array are the "dash" length, odd values are the "gap" length.
  // NOTE: If there is an odd number of entries, it behaves like lineDash.concat( lineDash ).
  // See: https://svgwg.org/svg2-draft/painting.html#StrokeDashing
  // Offset from the start of the subpath where the start of the line-dash array starts.
  // When to cut off lineJoin:miter to look like lineJoin:bevel. See https://svgwg.org/svg2-draft/painting.html
  constructor(options) {
    const filledOptions = merge({}, DEFAULT_OPTIONS, options);
    this.lineWidth = filledOptions.lineWidth;
    this.lineCap = filledOptions.lineCap;
    this.lineJoin = filledOptions.lineJoin;
    this.lineDash = filledOptions.lineDash;
    this.lineDashOffset = filledOptions.lineDashOffset;
    this.miterLimit = filledOptions.miterLimit;
    assert && assert(typeof this.lineWidth === 'number', `lineWidth should be a number: ${this.lineWidth}`);
    assert && assert(isFinite(this.lineWidth), `lineWidth should be a finite number: ${this.lineWidth}`);
    assert && assert(this.lineWidth >= 0, `lineWidth should be non-negative: ${this.lineWidth}`);
    assert && assert(this.lineCap === 'butt' || this.lineCap === 'round' || this.lineCap === 'square', `Invalid lineCap: ${this.lineCap}`);
    assert && assert(this.lineJoin === 'miter' || this.lineJoin === 'round' || this.lineJoin === 'bevel', `Invalid lineJoin: ${this.lineJoin}`);
    assert && assert(Array.isArray(this.lineDash), `lineDash should be an array: ${this.lineDash}`);
    assert && assert(_.every(this.lineDash, dash => typeof dash === 'number' && isFinite(dash) && dash >= 0), `Every lineDash should be a non-negative finite number: ${this.lineDash}`);
    assert && assert(typeof this.lineDashOffset === 'number', `lineDashOffset should be a number: ${this.lineDashOffset}`);
    assert && assert(isFinite(this.lineDashOffset), `lineDashOffset should be a finite number: ${this.lineDashOffset}`);
    assert && assert(typeof this.miterLimit === 'number', `miterLimit should be a number: ${this.miterLimit}`);
    assert && assert(isFinite(this.miterLimit), `miterLimit should be a finite number: ${this.miterLimit}`);
  }

  /**
   * Determines of this lineStyles is equal to the other LineStyles
   */
  equals(other) {
    const typical = this.lineWidth === other.lineWidth && this.lineCap === other.lineCap && this.lineJoin === other.lineJoin && this.miterLimit === other.miterLimit && this.lineDashOffset === other.lineDashOffset;
    if (!typical) {
      return false;
    }
    if (this.lineDash.length === other.lineDash.length) {
      for (let i = 0; i < this.lineDash.length; i++) {
        if (this.lineDash[i] !== other.lineDash[i]) {
          return false;
        }
      }
    } else {
      // line dashes must be different
      return false;
    }
    return true;
  }

  /**
   * Returns a copy of this LineStyles.
   */
  copy() {
    return new LineStyles({
      lineWidth: this.lineWidth,
      lineCap: this.lineCap,
      lineJoin: this.lineJoin,
      lineDash: this.lineDash,
      lineDashOffset: this.lineDashOffset,
      miterLimit: this.miterLimit
    });
  }

  /**
   * Creates an array of Segments that make up a line join, to the left side.
   *
   * Joins two segments together on the logical "left" side, at 'center' (where they meet), and un-normalized tangent
   * vectors in the direction of the stroking. To join on the "right" side, switch the tangent order and negate them.
   */
  leftJoin(center, fromTangent, toTangent) {
    fromTangent = fromTangent.normalized();
    toTangent = toTangent.normalized();

    // where our join path starts and ends
    const fromPoint = center.plus(fromTangent.perpendicular.negated().times(this.lineWidth / 2));
    const toPoint = center.plus(toTangent.perpendicular.negated().times(this.lineWidth / 2));
    const bevel = fromPoint.equals(toPoint) ? [] : [new Line(fromPoint, toPoint)];
    let fromAngle;
    let toAngle;
    let theta;

    // only insert a join on the non-acute-angle side
    // epsilon present for https://github.com/phetsims/kite/issues/73, where we don't want to join barely-existing
    // joins.
    if (fromTangent.perpendicular.dot(toTangent) > 1e-12) {
      switch (this.lineJoin) {
        case 'round':
          fromAngle = fromTangent.angle + Math.PI / 2;
          toAngle = toTangent.angle + Math.PI / 2;
          return [new Arc(center, this.lineWidth / 2, fromAngle, toAngle, true)];
        case 'miter':
          theta = fromTangent.angleBetween(toTangent.negated());
          if (1 / Math.sin(theta / 2) <= this.miterLimit && theta < Math.PI - 0.00001) {
            // draw the miter
            const miterPoint = lineLineIntersection(fromPoint, fromPoint.plus(fromTangent), toPoint, toPoint.plus(toTangent));
            if (miterPoint) {
              return [new Line(fromPoint, miterPoint), new Line(miterPoint, toPoint)];
            } else {
              return [new Line(fromPoint, toPoint)];
            }
          } else {
            // angle too steep, use bevel instead. same as below, but copied for linter
            return bevel;
          }
        case 'bevel':
          return bevel;
        default:
          throw new Error(`invalid lineJoin: ${this.lineJoin}`);
      }
    } else {
      // no join necessary here since we have the acute angle. just simple lineTo for now so that the next segment starts from the right place
      // TODO: can we prevent self-intersection here?
      return bevel;
    }
  }

  /**
   * Creates an array of Segments that make up a line join, to the right side.
   *
   * Joins two segments together on the logical "right" side, at 'center' (where they meet), and normalized tangent
   * vectors in the direction of the stroking. To join on the "left" side, switch the tangent order and negate them.
   */
  rightJoin(center, fromTangent, toTangent) {
    return this.leftJoin(center, toTangent.negated(), fromTangent.negated());
  }

  /**
   * Creates an array of Segments that make up a line cap from the endpoint 'center' in the direction of the tangent
   */
  cap(center, tangent) {
    tangent = tangent.normalized();
    const fromPoint = center.plus(tangent.perpendicular.times(-this.lineWidth / 2));
    const toPoint = center.plus(tangent.perpendicular.times(this.lineWidth / 2));
    let tangentAngle;
    let toLeft;
    let toRight;
    let toFront;
    let left;
    let right;
    switch (this.lineCap) {
      case 'butt':
        return [new Line(fromPoint, toPoint)];
      case 'round':
        tangentAngle = tangent.angle;
        return [new Arc(center, this.lineWidth / 2, tangentAngle + Math.PI / 2, tangentAngle - Math.PI / 2, true)];
      case 'square':
        toLeft = tangent.perpendicular.negated().times(this.lineWidth / 2);
        toRight = tangent.perpendicular.times(this.lineWidth / 2);
        toFront = tangent.times(this.lineWidth / 2);
        left = center.plus(toLeft).plus(toFront);
        right = center.plus(toRight).plus(toFront);
        return [new Line(fromPoint, left), new Line(left, right), new Line(right, toPoint)];
      default:
        throw new Error(`invalid lineCap: ${this.lineCap}`);
    }
  }
}
kite.register('LineStyles', LineStyles);
export { DEFAULT_OPTIONS as LINE_STYLE_DEFAULT_OPTIONS };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIm1lcmdlIiwiQXJjIiwia2l0ZSIsIkxpbmUiLCJsaW5lTGluZUludGVyc2VjdGlvbiIsIkRFRkFVTFRfT1BUSU9OUyIsImxpbmVXaWR0aCIsImxpbmVDYXAiLCJsaW5lSm9pbiIsImxpbmVEYXNoIiwibGluZURhc2hPZmZzZXQiLCJtaXRlckxpbWl0IiwiTGluZVN0eWxlcyIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsImZpbGxlZE9wdGlvbnMiLCJhc3NlcnQiLCJpc0Zpbml0ZSIsIkFycmF5IiwiaXNBcnJheSIsIl8iLCJldmVyeSIsImRhc2giLCJlcXVhbHMiLCJvdGhlciIsInR5cGljYWwiLCJsZW5ndGgiLCJpIiwiY29weSIsImxlZnRKb2luIiwiY2VudGVyIiwiZnJvbVRhbmdlbnQiLCJ0b1RhbmdlbnQiLCJub3JtYWxpemVkIiwiZnJvbVBvaW50IiwicGx1cyIsInBlcnBlbmRpY3VsYXIiLCJuZWdhdGVkIiwidGltZXMiLCJ0b1BvaW50IiwiYmV2ZWwiLCJmcm9tQW5nbGUiLCJ0b0FuZ2xlIiwidGhldGEiLCJkb3QiLCJhbmdsZSIsIk1hdGgiLCJQSSIsImFuZ2xlQmV0d2VlbiIsInNpbiIsIm1pdGVyUG9pbnQiLCJFcnJvciIsInJpZ2h0Sm9pbiIsImNhcCIsInRhbmdlbnQiLCJ0YW5nZW50QW5nbGUiLCJ0b0xlZnQiLCJ0b1JpZ2h0IiwidG9Gcm9udCIsImxlZnQiLCJyaWdodCIsInJlZ2lzdGVyIiwiTElORV9TVFlMRV9ERUZBVUxUX09QVElPTlMiXSwic291cmNlcyI6WyJMaW5lU3R5bGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDEzLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFN0eWxlcyBuZWVkZWQgdG8gZGV0ZXJtaW5lIGEgc3Ryb2tlZCBsaW5lIHNoYXBlLiBHZW5lcmFsbHkgaW1tdXRhYmxlLlxyXG4gKlxyXG4gKiBNaXJyb3JzIG11Y2ggb2Ygd2hhdCBpcyBkb25lIHdpdGggU1ZHL0NhbnZhcywgc2VlIGh0dHBzOi8vc3Znd2cub3JnL3N2ZzItZHJhZnQvcGFpbnRpbmcuaHRtbCBmb3IgZGV0YWlscy5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgeyBBcmMsIGtpdGUsIExpbmUsIFNlZ21lbnQgfSBmcm9tICcuLi9pbXBvcnRzLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBsaW5lTGluZUludGVyc2VjdGlvbiA9IFV0aWxzLmxpbmVMaW5lSW50ZXJzZWN0aW9uO1xyXG5cclxuY29uc3QgREVGQVVMVF9PUFRJT05TID0ge1xyXG4gIGxpbmVXaWR0aDogMSxcclxuICBsaW5lQ2FwOiAnYnV0dCcsXHJcbiAgbGluZUpvaW46ICdtaXRlcicsXHJcbiAgbGluZURhc2g6IFtdLFxyXG4gIGxpbmVEYXNoT2Zmc2V0OiAwLFxyXG4gIG1pdGVyTGltaXQ6IDEwXHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBMaW5lQ2FwID0gJ2J1dHQnIHwgJ3JvdW5kJyB8ICdzcXVhcmUnO1xyXG5leHBvcnQgdHlwZSBMaW5lSm9pbiA9ICdtaXRlcicgfCAncm91bmQnIHwgJ2JldmVsJztcclxuZXhwb3J0IHR5cGUgTGluZVN0eWxlc09wdGlvbnMgPSB7XHJcbiAgbGluZVdpZHRoPzogbnVtYmVyO1xyXG4gIGxpbmVDYXA/OiBMaW5lQ2FwO1xyXG4gIGxpbmVKb2luPzogTGluZUpvaW47XHJcbiAgbGluZURhc2g/OiBudW1iZXJbXTtcclxuICBsaW5lRGFzaE9mZnNldD86IG51bWJlcjtcclxuICBtaXRlckxpbWl0PzogbnVtYmVyO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGluZVN0eWxlcyB7XHJcblxyXG4gIC8vIFRoZSB3aWR0aCBvZiB0aGUgbGluZSAod2lsbCBiZSBvZmZzZXQgdG8gZWFjaCBzaWRlIGJ5IGxpbmVXaWR0aC8yKVxyXG4gIHB1YmxpYyBsaW5lV2lkdGg6IG51bWJlcjtcclxuXHJcbiAgLy8gJ2J1dHQnLCAncm91bmQnIG9yICdzcXVhcmUnIC0gQ29udHJvbHMgYXBwZWFyYW5jZSBhdCBlbmRwb2ludHMgZm9yIG5vbi1jbG9zZWQgc3VicGF0aHMuXHJcbiAgLy8gLSBidXR0OiBzdHJhaWdodC1saW5lIGF0IGVuZCBwb2ludCwgZ29pbmcgdGhyb3VnaCB0aGUgZW5kcG9pbnQgKHBlcnBlbmRpY3VsYXIgdG8gdGhlIHRhbmdlbnQpXHJcbiAgLy8gLSByb3VuZDogY2lyY3VsYXIgYm9yZGVyIHdpdGggcmFkaXVzIGxpbmVXaWR0aC8yIGFyb3VuZCBlbmRwb2ludHNcclxuICAvLyAtIHNxdWFyZTogc3RyYWlnaHQtbGluZSBwYXN0IHRoZSBlbmQgcG9pbnQgKGJ5IGxpbmVXaWR0aC8yKVxyXG4gIC8vIFNlZTogaHR0cHM6Ly9zdmd3Zy5vcmcvc3ZnMi1kcmFmdC9wYWludGluZy5odG1sI0xpbmVDYXBzXHJcbiAgcHVibGljIGxpbmVDYXA6IExpbmVDYXA7XHJcblxyXG4gIC8vICdtaXRlcicsICdyb3VuZCcgb3IgJ2JldmVsJyAtIENvbnRyb2xzIGFwcGVhcmFuY2UgYXQgam9pbnRzIGJldHdlZW4gc2VnbWVudHMgKGF0IHRoZSBwb2ludClcclxuICAvLyAtIG1pdGVyOiBVc2Ugc2hhcnAgY29ybmVycyAod2hpY2ggYXJlbid0IHRvbyBzaGFycCwgc2VlIG1pdGVyTGltaXQpLiBFeHRlbmRzIGVkZ2VzIHVudGlsIHRoZXkgbWVlZC5cclxuICAvLyAtIHJvdW5kOiBjaXJjdWxhciBib3JkZXIgd2l0aCByYWRpdXMgbGluZVdpZHRoLzIgYXJvdW5kIGpvaW50c1xyXG4gIC8vIC0gYmV2ZWw6IGRpcmVjdGx5IGpvaW5zIHRoZSBnYXAgd2l0aCBhIGxpbmUgc2VnbWVudC5cclxuICAvLyBTZWU6IGh0dHBzOi8vc3Znd2cub3JnL3N2ZzItZHJhZnQvcGFpbnRpbmcuaHRtbCNMaW5lSm9pblxyXG4gIHB1YmxpYyBsaW5lSm9pbjogTGluZUpvaW47XHJcblxyXG4gIC8vIEV2ZW4gdmFsdWVzIGluIHRoZSBhcnJheSBhcmUgdGhlIFwiZGFzaFwiIGxlbmd0aCwgb2RkIHZhbHVlcyBhcmUgdGhlIFwiZ2FwXCIgbGVuZ3RoLlxyXG4gIC8vIE5PVEU6IElmIHRoZXJlIGlzIGFuIG9kZCBudW1iZXIgb2YgZW50cmllcywgaXQgYmVoYXZlcyBsaWtlIGxpbmVEYXNoLmNvbmNhdCggbGluZURhc2ggKS5cclxuICAvLyBTZWU6IGh0dHBzOi8vc3Znd2cub3JnL3N2ZzItZHJhZnQvcGFpbnRpbmcuaHRtbCNTdHJva2VEYXNoaW5nXHJcbiAgcHVibGljIGxpbmVEYXNoOiBudW1iZXJbXTtcclxuXHJcbiAgLy8gT2Zmc2V0IGZyb20gdGhlIHN0YXJ0IG9mIHRoZSBzdWJwYXRoIHdoZXJlIHRoZSBzdGFydCBvZiB0aGUgbGluZS1kYXNoIGFycmF5IHN0YXJ0cy5cclxuICBwdWJsaWMgbGluZURhc2hPZmZzZXQ6IG51bWJlcjtcclxuXHJcbiAgLy8gV2hlbiB0byBjdXQgb2ZmIGxpbmVKb2luOm1pdGVyIHRvIGxvb2sgbGlrZSBsaW5lSm9pbjpiZXZlbC4gU2VlIGh0dHBzOi8vc3Znd2cub3JnL3N2ZzItZHJhZnQvcGFpbnRpbmcuaHRtbFxyXG4gIHB1YmxpYyBtaXRlckxpbWl0OiBudW1iZXI7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvciggb3B0aW9ucz86IExpbmVTdHlsZXNPcHRpb25zICkge1xyXG4gICAgY29uc3QgZmlsbGVkT3B0aW9ucyA9IG1lcmdlKCB7fSwgREVGQVVMVF9PUFRJT05TLCBvcHRpb25zICkgYXMgUmVxdWlyZWQ8TGluZVN0eWxlc09wdGlvbnM+O1xyXG5cclxuICAgIHRoaXMubGluZVdpZHRoID0gZmlsbGVkT3B0aW9ucy5saW5lV2lkdGg7XHJcbiAgICB0aGlzLmxpbmVDYXAgPSBmaWxsZWRPcHRpb25zLmxpbmVDYXA7XHJcbiAgICB0aGlzLmxpbmVKb2luID0gZmlsbGVkT3B0aW9ucy5saW5lSm9pbjtcclxuICAgIHRoaXMubGluZURhc2ggPSBmaWxsZWRPcHRpb25zLmxpbmVEYXNoO1xyXG4gICAgdGhpcy5saW5lRGFzaE9mZnNldCA9IGZpbGxlZE9wdGlvbnMubGluZURhc2hPZmZzZXQ7XHJcbiAgICB0aGlzLm1pdGVyTGltaXQgPSBmaWxsZWRPcHRpb25zLm1pdGVyTGltaXQ7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdHlwZW9mIHRoaXMubGluZVdpZHRoID09PSAnbnVtYmVyJywgYGxpbmVXaWR0aCBzaG91bGQgYmUgYSBudW1iZXI6ICR7dGhpcy5saW5lV2lkdGh9YCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggaXNGaW5pdGUoIHRoaXMubGluZVdpZHRoICksIGBsaW5lV2lkdGggc2hvdWxkIGJlIGEgZmluaXRlIG51bWJlcjogJHt0aGlzLmxpbmVXaWR0aH1gICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLmxpbmVXaWR0aCA+PSAwLCBgbGluZVdpZHRoIHNob3VsZCBiZSBub24tbmVnYXRpdmU6ICR7dGhpcy5saW5lV2lkdGh9YCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5saW5lQ2FwID09PSAnYnV0dCcgfHwgdGhpcy5saW5lQ2FwID09PSAncm91bmQnIHx8IHRoaXMubGluZUNhcCA9PT0gJ3NxdWFyZScsXHJcbiAgICAgIGBJbnZhbGlkIGxpbmVDYXA6ICR7dGhpcy5saW5lQ2FwfWAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMubGluZUpvaW4gPT09ICdtaXRlcicgfHwgdGhpcy5saW5lSm9pbiA9PT0gJ3JvdW5kJyB8fCB0aGlzLmxpbmVKb2luID09PSAnYmV2ZWwnLFxyXG4gICAgICBgSW52YWxpZCBsaW5lSm9pbjogJHt0aGlzLmxpbmVKb2lufWAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIEFycmF5LmlzQXJyYXkoIHRoaXMubGluZURhc2ggKSwgYGxpbmVEYXNoIHNob3VsZCBiZSBhbiBhcnJheTogJHt0aGlzLmxpbmVEYXNofWAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIF8uZXZlcnkoIHRoaXMubGluZURhc2gsIGRhc2ggPT4gKCB0eXBlb2YgZGFzaCA9PT0gJ251bWJlcicgKSAmJiBpc0Zpbml0ZSggZGFzaCApICYmIGRhc2ggPj0gMCApLFxyXG4gICAgICBgRXZlcnkgbGluZURhc2ggc2hvdWxkIGJlIGEgbm9uLW5lZ2F0aXZlIGZpbml0ZSBudW1iZXI6ICR7dGhpcy5saW5lRGFzaH1gICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0eXBlb2YgdGhpcy5saW5lRGFzaE9mZnNldCA9PT0gJ251bWJlcicsIGBsaW5lRGFzaE9mZnNldCBzaG91bGQgYmUgYSBudW1iZXI6ICR7dGhpcy5saW5lRGFzaE9mZnNldH1gICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBpc0Zpbml0ZSggdGhpcy5saW5lRGFzaE9mZnNldCApLCBgbGluZURhc2hPZmZzZXQgc2hvdWxkIGJlIGEgZmluaXRlIG51bWJlcjogJHt0aGlzLmxpbmVEYXNoT2Zmc2V0fWAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHR5cGVvZiB0aGlzLm1pdGVyTGltaXQgPT09ICdudW1iZXInLCBgbWl0ZXJMaW1pdCBzaG91bGQgYmUgYSBudW1iZXI6ICR7dGhpcy5taXRlckxpbWl0fWAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGlzRmluaXRlKCB0aGlzLm1pdGVyTGltaXQgKSwgYG1pdGVyTGltaXQgc2hvdWxkIGJlIGEgZmluaXRlIG51bWJlcjogJHt0aGlzLm1pdGVyTGltaXR9YCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGV0ZXJtaW5lcyBvZiB0aGlzIGxpbmVTdHlsZXMgaXMgZXF1YWwgdG8gdGhlIG90aGVyIExpbmVTdHlsZXNcclxuICAgKi9cclxuICBwdWJsaWMgZXF1YWxzKCBvdGhlcjogTGluZVN0eWxlcyApOiBib29sZWFuIHtcclxuICAgIGNvbnN0IHR5cGljYWwgPSB0aGlzLmxpbmVXaWR0aCA9PT0gb3RoZXIubGluZVdpZHRoICYmXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saW5lQ2FwID09PSBvdGhlci5saW5lQ2FwICYmXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saW5lSm9pbiA9PT0gb3RoZXIubGluZUpvaW4gJiZcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1pdGVyTGltaXQgPT09IG90aGVyLm1pdGVyTGltaXQgJiZcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxpbmVEYXNoT2Zmc2V0ID09PSBvdGhlci5saW5lRGFzaE9mZnNldDtcclxuICAgIGlmICggIXR5cGljYWwgKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIHRoaXMubGluZURhc2gubGVuZ3RoID09PSBvdGhlci5saW5lRGFzaC5sZW5ndGggKSB7XHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMubGluZURhc2gubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgaWYgKCB0aGlzLmxpbmVEYXNoWyBpIF0gIT09IG90aGVyLmxpbmVEYXNoWyBpIF0gKSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgLy8gbGluZSBkYXNoZXMgbXVzdCBiZSBkaWZmZXJlbnRcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhpcyBMaW5lU3R5bGVzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb3B5KCk6IExpbmVTdHlsZXMge1xyXG4gICAgcmV0dXJuIG5ldyBMaW5lU3R5bGVzKCB7XHJcbiAgICAgIGxpbmVXaWR0aDogdGhpcy5saW5lV2lkdGgsXHJcbiAgICAgIGxpbmVDYXA6IHRoaXMubGluZUNhcCxcclxuICAgICAgbGluZUpvaW46IHRoaXMubGluZUpvaW4sXHJcbiAgICAgIGxpbmVEYXNoOiB0aGlzLmxpbmVEYXNoLFxyXG4gICAgICBsaW5lRGFzaE9mZnNldDogdGhpcy5saW5lRGFzaE9mZnNldCxcclxuICAgICAgbWl0ZXJMaW1pdDogdGhpcy5taXRlckxpbWl0XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIFNlZ21lbnRzIHRoYXQgbWFrZSB1cCBhIGxpbmUgam9pbiwgdG8gdGhlIGxlZnQgc2lkZS5cclxuICAgKlxyXG4gICAqIEpvaW5zIHR3byBzZWdtZW50cyB0b2dldGhlciBvbiB0aGUgbG9naWNhbCBcImxlZnRcIiBzaWRlLCBhdCAnY2VudGVyJyAod2hlcmUgdGhleSBtZWV0KSwgYW5kIHVuLW5vcm1hbGl6ZWQgdGFuZ2VudFxyXG4gICAqIHZlY3RvcnMgaW4gdGhlIGRpcmVjdGlvbiBvZiB0aGUgc3Ryb2tpbmcuIFRvIGpvaW4gb24gdGhlIFwicmlnaHRcIiBzaWRlLCBzd2l0Y2ggdGhlIHRhbmdlbnQgb3JkZXIgYW5kIG5lZ2F0ZSB0aGVtLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBsZWZ0Sm9pbiggY2VudGVyOiBWZWN0b3IyLCBmcm9tVGFuZ2VudDogVmVjdG9yMiwgdG9UYW5nZW50OiBWZWN0b3IyICk6IFNlZ21lbnRbXSB7XHJcbiAgICBmcm9tVGFuZ2VudCA9IGZyb21UYW5nZW50Lm5vcm1hbGl6ZWQoKTtcclxuICAgIHRvVGFuZ2VudCA9IHRvVGFuZ2VudC5ub3JtYWxpemVkKCk7XHJcblxyXG4gICAgLy8gd2hlcmUgb3VyIGpvaW4gcGF0aCBzdGFydHMgYW5kIGVuZHNcclxuICAgIGNvbnN0IGZyb21Qb2ludCA9IGNlbnRlci5wbHVzKCBmcm9tVGFuZ2VudC5wZXJwZW5kaWN1bGFyLm5lZ2F0ZWQoKS50aW1lcyggdGhpcy5saW5lV2lkdGggLyAyICkgKTtcclxuICAgIGNvbnN0IHRvUG9pbnQgPSBjZW50ZXIucGx1cyggdG9UYW5nZW50LnBlcnBlbmRpY3VsYXIubmVnYXRlZCgpLnRpbWVzKCB0aGlzLmxpbmVXaWR0aCAvIDIgKSApO1xyXG5cclxuICAgIGNvbnN0IGJldmVsID0gKCBmcm9tUG9pbnQuZXF1YWxzKCB0b1BvaW50ICkgPyBbXSA6IFsgbmV3IExpbmUoIGZyb21Qb2ludCwgdG9Qb2ludCApIF0gKTtcclxuXHJcbiAgICBsZXQgZnJvbUFuZ2xlO1xyXG4gICAgbGV0IHRvQW5nbGU7XHJcbiAgICBsZXQgdGhldGE7XHJcblxyXG4gICAgLy8gb25seSBpbnNlcnQgYSBqb2luIG9uIHRoZSBub24tYWN1dGUtYW5nbGUgc2lkZVxyXG4gICAgLy8gZXBzaWxvbiBwcmVzZW50IGZvciBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMva2l0ZS9pc3N1ZXMvNzMsIHdoZXJlIHdlIGRvbid0IHdhbnQgdG8gam9pbiBiYXJlbHktZXhpc3RpbmdcclxuICAgIC8vIGpvaW5zLlxyXG4gICAgaWYgKCBmcm9tVGFuZ2VudC5wZXJwZW5kaWN1bGFyLmRvdCggdG9UYW5nZW50ICkgPiAxZS0xMiApIHtcclxuICAgICAgc3dpdGNoKCB0aGlzLmxpbmVKb2luICkge1xyXG4gICAgICAgIGNhc2UgJ3JvdW5kJzpcclxuICAgICAgICAgIGZyb21BbmdsZSA9IGZyb21UYW5nZW50LmFuZ2xlICsgTWF0aC5QSSAvIDI7XHJcbiAgICAgICAgICB0b0FuZ2xlID0gdG9UYW5nZW50LmFuZ2xlICsgTWF0aC5QSSAvIDI7XHJcbiAgICAgICAgICByZXR1cm4gWyBuZXcgQXJjKCBjZW50ZXIsIHRoaXMubGluZVdpZHRoIC8gMiwgZnJvbUFuZ2xlLCB0b0FuZ2xlLCB0cnVlICkgXTtcclxuICAgICAgICBjYXNlICdtaXRlcic6XHJcbiAgICAgICAgICB0aGV0YSA9IGZyb21UYW5nZW50LmFuZ2xlQmV0d2VlbiggdG9UYW5nZW50Lm5lZ2F0ZWQoKSApO1xyXG4gICAgICAgICAgaWYgKCAxIC8gTWF0aC5zaW4oIHRoZXRhIC8gMiApIDw9IHRoaXMubWl0ZXJMaW1pdCAmJiB0aGV0YSA8IE1hdGguUEkgLSAwLjAwMDAxICkge1xyXG4gICAgICAgICAgICAvLyBkcmF3IHRoZSBtaXRlclxyXG4gICAgICAgICAgICBjb25zdCBtaXRlclBvaW50ID0gbGluZUxpbmVJbnRlcnNlY3Rpb24oIGZyb21Qb2ludCwgZnJvbVBvaW50LnBsdXMoIGZyb21UYW5nZW50ICksIHRvUG9pbnQsIHRvUG9pbnQucGx1cyggdG9UYW5nZW50ICkgKTtcclxuICAgICAgICAgICAgaWYgKCBtaXRlclBvaW50ICkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgICAgICBuZXcgTGluZSggZnJvbVBvaW50LCBtaXRlclBvaW50ICksXHJcbiAgICAgICAgICAgICAgICBuZXcgTGluZSggbWl0ZXJQb2ludCwgdG9Qb2ludCApXHJcbiAgICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICAgICAgbmV3IExpbmUoIGZyb21Qb2ludCwgdG9Qb2ludCApXHJcbiAgICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGFuZ2xlIHRvbyBzdGVlcCwgdXNlIGJldmVsIGluc3RlYWQuIHNhbWUgYXMgYmVsb3csIGJ1dCBjb3BpZWQgZm9yIGxpbnRlclxyXG4gICAgICAgICAgICByZXR1cm4gYmV2ZWw7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgY2FzZSAnYmV2ZWwnOlxyXG4gICAgICAgICAgcmV0dXJuIGJldmVsO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIGBpbnZhbGlkIGxpbmVKb2luOiAke3RoaXMubGluZUpvaW59YCApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgLy8gbm8gam9pbiBuZWNlc3NhcnkgaGVyZSBzaW5jZSB3ZSBoYXZlIHRoZSBhY3V0ZSBhbmdsZS4ganVzdCBzaW1wbGUgbGluZVRvIGZvciBub3cgc28gdGhhdCB0aGUgbmV4dCBzZWdtZW50IHN0YXJ0cyBmcm9tIHRoZSByaWdodCBwbGFjZVxyXG4gICAgICAvLyBUT0RPOiBjYW4gd2UgcHJldmVudCBzZWxmLWludGVyc2VjdGlvbiBoZXJlP1xyXG4gICAgICByZXR1cm4gYmV2ZWw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIFNlZ21lbnRzIHRoYXQgbWFrZSB1cCBhIGxpbmUgam9pbiwgdG8gdGhlIHJpZ2h0IHNpZGUuXHJcbiAgICpcclxuICAgKiBKb2lucyB0d28gc2VnbWVudHMgdG9nZXRoZXIgb24gdGhlIGxvZ2ljYWwgXCJyaWdodFwiIHNpZGUsIGF0ICdjZW50ZXInICh3aGVyZSB0aGV5IG1lZXQpLCBhbmQgbm9ybWFsaXplZCB0YW5nZW50XHJcbiAgICogdmVjdG9ycyBpbiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBzdHJva2luZy4gVG8gam9pbiBvbiB0aGUgXCJsZWZ0XCIgc2lkZSwgc3dpdGNoIHRoZSB0YW5nZW50IG9yZGVyIGFuZCBuZWdhdGUgdGhlbS5cclxuICAgKi9cclxuICBwdWJsaWMgcmlnaHRKb2luKCBjZW50ZXI6IFZlY3RvcjIsIGZyb21UYW5nZW50OiBWZWN0b3IyLCB0b1RhbmdlbnQ6IFZlY3RvcjIgKTogU2VnbWVudFtdIHtcclxuICAgIHJldHVybiB0aGlzLmxlZnRKb2luKCBjZW50ZXIsIHRvVGFuZ2VudC5uZWdhdGVkKCksIGZyb21UYW5nZW50Lm5lZ2F0ZWQoKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBTZWdtZW50cyB0aGF0IG1ha2UgdXAgYSBsaW5lIGNhcCBmcm9tIHRoZSBlbmRwb2ludCAnY2VudGVyJyBpbiB0aGUgZGlyZWN0aW9uIG9mIHRoZSB0YW5nZW50XHJcbiAgICovXHJcbiAgcHVibGljIGNhcCggY2VudGVyOiBWZWN0b3IyLCB0YW5nZW50OiBWZWN0b3IyICk6IFNlZ21lbnRbXSB7XHJcbiAgICB0YW5nZW50ID0gdGFuZ2VudC5ub3JtYWxpemVkKCk7XHJcblxyXG4gICAgY29uc3QgZnJvbVBvaW50ID0gY2VudGVyLnBsdXMoIHRhbmdlbnQucGVycGVuZGljdWxhci50aW1lcyggLXRoaXMubGluZVdpZHRoIC8gMiApICk7XHJcbiAgICBjb25zdCB0b1BvaW50ID0gY2VudGVyLnBsdXMoIHRhbmdlbnQucGVycGVuZGljdWxhci50aW1lcyggdGhpcy5saW5lV2lkdGggLyAyICkgKTtcclxuXHJcbiAgICBsZXQgdGFuZ2VudEFuZ2xlO1xyXG4gICAgbGV0IHRvTGVmdDtcclxuICAgIGxldCB0b1JpZ2h0O1xyXG4gICAgbGV0IHRvRnJvbnQ7XHJcbiAgICBsZXQgbGVmdDtcclxuICAgIGxldCByaWdodDtcclxuXHJcbiAgICBzd2l0Y2goIHRoaXMubGluZUNhcCApIHtcclxuICAgICAgY2FzZSAnYnV0dCc6XHJcbiAgICAgICAgcmV0dXJuIFsgbmV3IExpbmUoIGZyb21Qb2ludCwgdG9Qb2ludCApIF07XHJcbiAgICAgIGNhc2UgJ3JvdW5kJzpcclxuICAgICAgICB0YW5nZW50QW5nbGUgPSB0YW5nZW50LmFuZ2xlO1xyXG4gICAgICAgIHJldHVybiBbIG5ldyBBcmMoIGNlbnRlciwgdGhpcy5saW5lV2lkdGggLyAyLCB0YW5nZW50QW5nbGUgKyBNYXRoLlBJIC8gMiwgdGFuZ2VudEFuZ2xlIC0gTWF0aC5QSSAvIDIsIHRydWUgKSBdO1xyXG4gICAgICBjYXNlICdzcXVhcmUnOlxyXG4gICAgICAgIHRvTGVmdCA9IHRhbmdlbnQucGVycGVuZGljdWxhci5uZWdhdGVkKCkudGltZXMoIHRoaXMubGluZVdpZHRoIC8gMiApO1xyXG4gICAgICAgIHRvUmlnaHQgPSB0YW5nZW50LnBlcnBlbmRpY3VsYXIudGltZXMoIHRoaXMubGluZVdpZHRoIC8gMiApO1xyXG4gICAgICAgIHRvRnJvbnQgPSB0YW5nZW50LnRpbWVzKCB0aGlzLmxpbmVXaWR0aCAvIDIgKTtcclxuXHJcbiAgICAgICAgbGVmdCA9IGNlbnRlci5wbHVzKCB0b0xlZnQgKS5wbHVzKCB0b0Zyb250ICk7XHJcbiAgICAgICAgcmlnaHQgPSBjZW50ZXIucGx1cyggdG9SaWdodCApLnBsdXMoIHRvRnJvbnQgKTtcclxuICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgbmV3IExpbmUoIGZyb21Qb2ludCwgbGVmdCApLFxyXG4gICAgICAgICAgbmV3IExpbmUoIGxlZnQsIHJpZ2h0ICksXHJcbiAgICAgICAgICBuZXcgTGluZSggcmlnaHQsIHRvUG9pbnQgKVxyXG4gICAgICAgIF07XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCBgaW52YWxpZCBsaW5lQ2FwOiAke3RoaXMubGluZUNhcH1gICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5raXRlLnJlZ2lzdGVyKCAnTGluZVN0eWxlcycsIExpbmVTdHlsZXMgKTtcclxuXHJcbmV4cG9ydCB7IERFRkFVTFRfT1BUSU9OUyBhcyBMSU5FX1NUWUxFX0RFRkFVTFRfT1BUSU9OUyB9O1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBTSwwQkFBMEI7QUFFNUMsT0FBT0MsS0FBSyxNQUFNLGdDQUFnQztBQUNsRCxTQUFTQyxHQUFHLEVBQUVDLElBQUksRUFBRUMsSUFBSSxRQUFpQixlQUFlOztBQUV4RDtBQUNB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