// Copyright 2013-2022, University of Colorado Boulder

/**
 * Basic model for depicting masses on a balance, meant to be used as a base
 * type.
 *
 * @author John Blanco
 */

import createObservableArray from '../../../../axon/js/createObservableArray.js';
import EnumerationDeprecatedProperty from '../../../../axon/js/EnumerationDeprecatedProperty.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import balancingAct from '../../balancingAct.js';
import ColumnState from './ColumnState.js';
import Fulcrum from './Fulcrum.js';
import LevelSupportColumn from './LevelSupportColumn.js';
import Plank from './Plank.js';

// constants
const FULCRUM_HEIGHT = 0.85; // In meters.
const PLANK_HEIGHT = 0.75; // In meters.

class BalanceModel {
  /**
   * @param {Tandem} tandem
   */
  constructor(tandem) {
    // Model elements
    this.fulcrum = new Fulcrum(new Dimension2(1, FULCRUM_HEIGHT));
    this.massList = createObservableArray();
    this.userControlledMasses = []; // Masses being controlled by user(s), potentially more than one in touch environment.

    this.columnStateProperty = new EnumerationDeprecatedProperty(ColumnState, ColumnState.DOUBLE_COLUMNS, {
      tandem: tandem.createTandem('columnStateProperty'),
      phetioReadOnly: true
    });
    this.plank = new Plank(new Vector2(0, PLANK_HEIGHT), new Vector2(0, FULCRUM_HEIGHT), this.columnStateProperty, this.userControlledMasses, tandem.createTandem('plank'));
    this.supportColumns = [new LevelSupportColumn(PLANK_HEIGHT, -1.625), new LevelSupportColumn(PLANK_HEIGHT, 1.625)];
  }

  /**
   * Step function, called by the framework, clocks time-dependent behavior.
   * @param {number} dt
   * @public
   */
  step(dt) {
    this.plank.step(dt);
    this.massList.forEach(mass => {
      mass.step(dt);
    });
  }

  /**
   * Add a mass to the model.  Subclasses generally do additional things.
   * @param mass
   * @public
   */
  addMass(mass) {
    this.massList.push(mass);
    // Add a listener that will update the list of user controlled masses
    // that is used by the plank to update the active drop positions.
    const userControlledMassesUpdater = userControlled => {
      if (userControlled) {
        this.userControlledMasses.push(mass);
      } else {
        this.userControlledMasses.splice(this.userControlledMasses.indexOf(mass), 1);
      }
    };
    mass.userControlledProperty.link(userControlledMassesUpdater);

    // Attach a reference for this listener to the mass so that it can be removed later.
    mass.userControlledMassesUpdater = userControlledMassesUpdater;
  }

  /**
   * Remove a mass from the model.  Sub-types often do additional things.
   * @param mass
   * @public
   */
  removeMass(mass) {
    this.massList.remove(mass);
    if (mass.userControlledMassesUpdater) {
      mass.userControlledProperty.unlink(mass.userControlledMassesUpdater);
      mass.userControlledMassesUpdater = null;
    }
  }

  /**
   * @public
   */
  reset() {
    this.plank.removeAllMasses();
    this.columnStateProperty.reset();
  }
}
balancingAct.register('BalanceModel', BalanceModel);
export default BalanceModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVPYnNlcnZhYmxlQXJyYXkiLCJFbnVtZXJhdGlvbkRlcHJlY2F0ZWRQcm9wZXJ0eSIsIkRpbWVuc2lvbjIiLCJWZWN0b3IyIiwiYmFsYW5jaW5nQWN0IiwiQ29sdW1uU3RhdGUiLCJGdWxjcnVtIiwiTGV2ZWxTdXBwb3J0Q29sdW1uIiwiUGxhbmsiLCJGVUxDUlVNX0hFSUdIVCIsIlBMQU5LX0hFSUdIVCIsIkJhbGFuY2VNb2RlbCIsImNvbnN0cnVjdG9yIiwidGFuZGVtIiwiZnVsY3J1bSIsIm1hc3NMaXN0IiwidXNlckNvbnRyb2xsZWRNYXNzZXMiLCJjb2x1bW5TdGF0ZVByb3BlcnR5IiwiRE9VQkxFX0NPTFVNTlMiLCJjcmVhdGVUYW5kZW0iLCJwaGV0aW9SZWFkT25seSIsInBsYW5rIiwic3VwcG9ydENvbHVtbnMiLCJzdGVwIiwiZHQiLCJmb3JFYWNoIiwibWFzcyIsImFkZE1hc3MiLCJwdXNoIiwidXNlckNvbnRyb2xsZWRNYXNzZXNVcGRhdGVyIiwidXNlckNvbnRyb2xsZWQiLCJzcGxpY2UiLCJpbmRleE9mIiwidXNlckNvbnRyb2xsZWRQcm9wZXJ0eSIsImxpbmsiLCJyZW1vdmVNYXNzIiwicmVtb3ZlIiwidW5saW5rIiwicmVzZXQiLCJyZW1vdmVBbGxNYXNzZXMiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkJhbGFuY2VNb2RlbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxMy0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBCYXNpYyBtb2RlbCBmb3IgZGVwaWN0aW5nIG1hc3NlcyBvbiBhIGJhbGFuY2UsIG1lYW50IHRvIGJlIHVzZWQgYXMgYSBiYXNlXHJcbiAqIHR5cGUuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICovXHJcblxyXG5pbXBvcnQgY3JlYXRlT2JzZXJ2YWJsZUFycmF5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvY3JlYXRlT2JzZXJ2YWJsZUFycmF5LmpzJztcclxuaW1wb3J0IEVudW1lcmF0aW9uRGVwcmVjYXRlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRW51bWVyYXRpb25EZXByZWNhdGVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IGJhbGFuY2luZ0FjdCBmcm9tICcuLi8uLi9iYWxhbmNpbmdBY3QuanMnO1xyXG5pbXBvcnQgQ29sdW1uU3RhdGUgZnJvbSAnLi9Db2x1bW5TdGF0ZS5qcyc7XHJcbmltcG9ydCBGdWxjcnVtIGZyb20gJy4vRnVsY3J1bS5qcyc7XHJcbmltcG9ydCBMZXZlbFN1cHBvcnRDb2x1bW4gZnJvbSAnLi9MZXZlbFN1cHBvcnRDb2x1bW4uanMnO1xyXG5pbXBvcnQgUGxhbmsgZnJvbSAnLi9QbGFuay5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgRlVMQ1JVTV9IRUlHSFQgPSAwLjg1OyAvLyBJbiBtZXRlcnMuXHJcbmNvbnN0IFBMQU5LX0hFSUdIVCA9IDAuNzU7IC8vIEluIG1ldGVycy5cclxuXHJcbmNsYXNzIEJhbGFuY2VNb2RlbCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7VGFuZGVtfSB0YW5kZW1cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggdGFuZGVtICkge1xyXG5cclxuXHJcbiAgICAvLyBNb2RlbCBlbGVtZW50c1xyXG4gICAgdGhpcy5mdWxjcnVtID0gbmV3IEZ1bGNydW0oIG5ldyBEaW1lbnNpb24yKCAxLCBGVUxDUlVNX0hFSUdIVCApICk7XHJcbiAgICB0aGlzLm1hc3NMaXN0ID0gY3JlYXRlT2JzZXJ2YWJsZUFycmF5KCk7XHJcbiAgICB0aGlzLnVzZXJDb250cm9sbGVkTWFzc2VzID0gW107IC8vIE1hc3NlcyBiZWluZyBjb250cm9sbGVkIGJ5IHVzZXIocyksIHBvdGVudGlhbGx5IG1vcmUgdGhhbiBvbmUgaW4gdG91Y2ggZW52aXJvbm1lbnQuXHJcblxyXG4gICAgdGhpcy5jb2x1bW5TdGF0ZVByb3BlcnR5ID0gbmV3IEVudW1lcmF0aW9uRGVwcmVjYXRlZFByb3BlcnR5KCBDb2x1bW5TdGF0ZSwgQ29sdW1uU3RhdGUuRE9VQkxFX0NPTFVNTlMsIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnY29sdW1uU3RhdGVQcm9wZXJ0eScgKSxcclxuICAgICAgcGhldGlvUmVhZE9ubHk6IHRydWVcclxuICAgIH0gKTtcclxuICAgIHRoaXMucGxhbmsgPSBuZXcgUGxhbmsoXHJcbiAgICAgIG5ldyBWZWN0b3IyKCAwLCBQTEFOS19IRUlHSFQgKSxcclxuICAgICAgbmV3IFZlY3RvcjIoIDAsIEZVTENSVU1fSEVJR0hUICksXHJcbiAgICAgIHRoaXMuY29sdW1uU3RhdGVQcm9wZXJ0eSxcclxuICAgICAgdGhpcy51c2VyQ29udHJvbGxlZE1hc3NlcyxcclxuICAgICAgdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3BsYW5rJyApXHJcbiAgICApO1xyXG4gICAgdGhpcy5zdXBwb3J0Q29sdW1ucyA9IFtcclxuICAgICAgbmV3IExldmVsU3VwcG9ydENvbHVtbiggUExBTktfSEVJR0hULCAtMS42MjUgKSxcclxuICAgICAgbmV3IExldmVsU3VwcG9ydENvbHVtbiggUExBTktfSEVJR0hULCAxLjYyNSApXHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RlcCBmdW5jdGlvbiwgY2FsbGVkIGJ5IHRoZSBmcmFtZXdvcmssIGNsb2NrcyB0aW1lLWRlcGVuZGVudCBiZWhhdmlvci5cclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHRcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc3RlcCggZHQgKSB7XHJcbiAgICB0aGlzLnBsYW5rLnN0ZXAoIGR0ICk7XHJcbiAgICB0aGlzLm1hc3NMaXN0LmZvckVhY2goIG1hc3MgPT4ge1xyXG4gICAgICBtYXNzLnN0ZXAoIGR0ICk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGQgYSBtYXNzIHRvIHRoZSBtb2RlbC4gIFN1YmNsYXNzZXMgZ2VuZXJhbGx5IGRvIGFkZGl0aW9uYWwgdGhpbmdzLlxyXG4gICAqIEBwYXJhbSBtYXNzXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGFkZE1hc3MoIG1hc3MgKSB7XHJcbiAgICB0aGlzLm1hc3NMaXN0LnB1c2goIG1hc3MgKTtcclxuICAgIC8vIEFkZCBhIGxpc3RlbmVyIHRoYXQgd2lsbCB1cGRhdGUgdGhlIGxpc3Qgb2YgdXNlciBjb250cm9sbGVkIG1hc3Nlc1xyXG4gICAgLy8gdGhhdCBpcyB1c2VkIGJ5IHRoZSBwbGFuayB0byB1cGRhdGUgdGhlIGFjdGl2ZSBkcm9wIHBvc2l0aW9ucy5cclxuICAgIGNvbnN0IHVzZXJDb250cm9sbGVkTWFzc2VzVXBkYXRlciA9IHVzZXJDb250cm9sbGVkID0+IHtcclxuICAgICAgaWYgKCB1c2VyQ29udHJvbGxlZCApIHtcclxuICAgICAgICB0aGlzLnVzZXJDb250cm9sbGVkTWFzc2VzLnB1c2goIG1hc3MgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB0aGlzLnVzZXJDb250cm9sbGVkTWFzc2VzLnNwbGljZSggdGhpcy51c2VyQ29udHJvbGxlZE1hc3Nlcy5pbmRleE9mKCBtYXNzICksIDEgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIG1hc3MudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5saW5rKCB1c2VyQ29udHJvbGxlZE1hc3Nlc1VwZGF0ZXIgKTtcclxuXHJcbiAgICAvLyBBdHRhY2ggYSByZWZlcmVuY2UgZm9yIHRoaXMgbGlzdGVuZXIgdG8gdGhlIG1hc3Mgc28gdGhhdCBpdCBjYW4gYmUgcmVtb3ZlZCBsYXRlci5cclxuICAgIG1hc3MudXNlckNvbnRyb2xsZWRNYXNzZXNVcGRhdGVyID0gdXNlckNvbnRyb2xsZWRNYXNzZXNVcGRhdGVyO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVtb3ZlIGEgbWFzcyBmcm9tIHRoZSBtb2RlbC4gIFN1Yi10eXBlcyBvZnRlbiBkbyBhZGRpdGlvbmFsIHRoaW5ncy5cclxuICAgKiBAcGFyYW0gbWFzc1xyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICByZW1vdmVNYXNzKCBtYXNzICkge1xyXG4gICAgdGhpcy5tYXNzTGlzdC5yZW1vdmUoIG1hc3MgKTtcclxuICAgIGlmICggbWFzcy51c2VyQ29udHJvbGxlZE1hc3Nlc1VwZGF0ZXIgKSB7XHJcbiAgICAgIG1hc3MudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS51bmxpbmsoIG1hc3MudXNlckNvbnRyb2xsZWRNYXNzZXNVcGRhdGVyICk7XHJcbiAgICAgIG1hc3MudXNlckNvbnRyb2xsZWRNYXNzZXNVcGRhdGVyID0gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICByZXNldCgpIHtcclxuICAgIHRoaXMucGxhbmsucmVtb3ZlQWxsTWFzc2VzKCk7XHJcbiAgICB0aGlzLmNvbHVtblN0YXRlUHJvcGVydHkucmVzZXQoKTtcclxuICB9XHJcbn1cclxuXHJcbmJhbGFuY2luZ0FjdC5yZWdpc3RlciggJ0JhbGFuY2VNb2RlbCcsIEJhbGFuY2VNb2RlbCApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgQmFsYW5jZU1vZGVsO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxxQkFBcUIsTUFBTSw4Q0FBOEM7QUFDaEYsT0FBT0MsNkJBQTZCLE1BQU0sc0RBQXNEO0FBQ2hHLE9BQU9DLFVBQVUsTUFBTSxrQ0FBa0M7QUFDekQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxZQUFZLE1BQU0sdUJBQXVCO0FBQ2hELE9BQU9DLFdBQVcsTUFBTSxrQkFBa0I7QUFDMUMsT0FBT0MsT0FBTyxNQUFNLGNBQWM7QUFDbEMsT0FBT0Msa0JBQWtCLE1BQU0seUJBQXlCO0FBQ3hELE9BQU9DLEtBQUssTUFBTSxZQUFZOztBQUU5QjtBQUNBLE1BQU1DLGNBQWMsR0FBRyxJQUFJLENBQUMsQ0FBQztBQUM3QixNQUFNQyxZQUFZLEdBQUcsSUFBSSxDQUFDLENBQUM7O0FBRTNCLE1BQU1DLFlBQVksQ0FBQztFQUVqQjtBQUNGO0FBQ0E7RUFDRUMsV0FBV0EsQ0FBRUMsTUFBTSxFQUFHO0lBR3BCO0lBQ0EsSUFBSSxDQUFDQyxPQUFPLEdBQUcsSUFBSVIsT0FBTyxDQUFFLElBQUlKLFVBQVUsQ0FBRSxDQUFDLEVBQUVPLGNBQWUsQ0FBRSxDQUFDO0lBQ2pFLElBQUksQ0FBQ00sUUFBUSxHQUFHZixxQkFBcUIsQ0FBQyxDQUFDO0lBQ3ZDLElBQUksQ0FBQ2dCLG9CQUFvQixHQUFHLEVBQUUsQ0FBQyxDQUFDOztJQUVoQyxJQUFJLENBQUNDLG1CQUFtQixHQUFHLElBQUloQiw2QkFBNkIsQ0FBRUksV0FBVyxFQUFFQSxXQUFXLENBQUNhLGNBQWMsRUFBRTtNQUNyR0wsTUFBTSxFQUFFQSxNQUFNLENBQUNNLFlBQVksQ0FBRSxxQkFBc0IsQ0FBQztNQUNwREMsY0FBYyxFQUFFO0lBQ2xCLENBQUUsQ0FBQztJQUNILElBQUksQ0FBQ0MsS0FBSyxHQUFHLElBQUliLEtBQUssQ0FDcEIsSUFBSUwsT0FBTyxDQUFFLENBQUMsRUFBRU8sWUFBYSxDQUFDLEVBQzlCLElBQUlQLE9BQU8sQ0FBRSxDQUFDLEVBQUVNLGNBQWUsQ0FBQyxFQUNoQyxJQUFJLENBQUNRLG1CQUFtQixFQUN4QixJQUFJLENBQUNELG9CQUFvQixFQUN6QkgsTUFBTSxDQUFDTSxZQUFZLENBQUUsT0FBUSxDQUMvQixDQUFDO0lBQ0QsSUFBSSxDQUFDRyxjQUFjLEdBQUcsQ0FDcEIsSUFBSWYsa0JBQWtCLENBQUVHLFlBQVksRUFBRSxDQUFDLEtBQU0sQ0FBQyxFQUM5QyxJQUFJSCxrQkFBa0IsQ0FBRUcsWUFBWSxFQUFFLEtBQU0sQ0FBQyxDQUM5QztFQUNIOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRWEsSUFBSUEsQ0FBRUMsRUFBRSxFQUFHO0lBQ1QsSUFBSSxDQUFDSCxLQUFLLENBQUNFLElBQUksQ0FBRUMsRUFBRyxDQUFDO0lBQ3JCLElBQUksQ0FBQ1QsUUFBUSxDQUFDVSxPQUFPLENBQUVDLElBQUksSUFBSTtNQUM3QkEsSUFBSSxDQUFDSCxJQUFJLENBQUVDLEVBQUcsQ0FBQztJQUNqQixDQUFFLENBQUM7RUFDTDs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0VHLE9BQU9BLENBQUVELElBQUksRUFBRztJQUNkLElBQUksQ0FBQ1gsUUFBUSxDQUFDYSxJQUFJLENBQUVGLElBQUssQ0FBQztJQUMxQjtJQUNBO0lBQ0EsTUFBTUcsMkJBQTJCLEdBQUdDLGNBQWMsSUFBSTtNQUNwRCxJQUFLQSxjQUFjLEVBQUc7UUFDcEIsSUFBSSxDQUFDZCxvQkFBb0IsQ0FBQ1ksSUFBSSxDQUFFRixJQUFLLENBQUM7TUFDeEMsQ0FBQyxNQUNJO1FBQ0gsSUFBSSxDQUFDVixvQkFBb0IsQ0FBQ2UsTUFBTSxDQUFFLElBQUksQ0FBQ2Ysb0JBQW9CLENBQUNnQixPQUFPLENBQUVOLElBQUssQ0FBQyxFQUFFLENBQUUsQ0FBQztNQUNsRjtJQUNGLENBQUM7SUFDREEsSUFBSSxDQUFDTyxzQkFBc0IsQ0FBQ0MsSUFBSSxDQUFFTCwyQkFBNEIsQ0FBQzs7SUFFL0Q7SUFDQUgsSUFBSSxDQUFDRywyQkFBMkIsR0FBR0EsMkJBQTJCO0VBQ2hFOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRU0sVUFBVUEsQ0FBRVQsSUFBSSxFQUFHO0lBQ2pCLElBQUksQ0FBQ1gsUUFBUSxDQUFDcUIsTUFBTSxDQUFFVixJQUFLLENBQUM7SUFDNUIsSUFBS0EsSUFBSSxDQUFDRywyQkFBMkIsRUFBRztNQUN0Q0gsSUFBSSxDQUFDTyxzQkFBc0IsQ0FBQ0ksTUFBTSxDQUFFWCxJQUFJLENBQUNHLDJCQUE0QixDQUFDO01BQ3RFSCxJQUFJLENBQUNHLDJCQUEyQixHQUFHLElBQUk7SUFDekM7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7RUFDRVMsS0FBS0EsQ0FBQSxFQUFHO0lBQ04sSUFBSSxDQUFDakIsS0FBSyxDQUFDa0IsZUFBZSxDQUFDLENBQUM7SUFDNUIsSUFBSSxDQUFDdEIsbUJBQW1CLENBQUNxQixLQUFLLENBQUMsQ0FBQztFQUNsQztBQUNGO0FBRUFsQyxZQUFZLENBQUNvQyxRQUFRLENBQUUsY0FBYyxFQUFFN0IsWUFBYSxDQUFDO0FBRXJELGVBQWVBLFlBQVkifQ==