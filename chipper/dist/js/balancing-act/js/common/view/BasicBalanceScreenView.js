// Copyright 2013-2023, University of Colorado Boulder

/**
 * ScreenView that displays items in the balance model, primarily the balance beam (i.e. the plank), the various masses,
 * and a floating control panel for controlling the visibility of labels, rulers, etc.
 *
 * @author John Blanco
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import EnumerationDeprecatedProperty from '../../../../axon/js/EnumerationDeprecatedProperty.js';
import Property from '../../../../axon/js/Property.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import ScreenView from '../../../../joist/js/ScreenView.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import OutsideBackgroundNode from '../../../../scenery-phet/js/OutsideBackgroundNode.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { HBox, HStrut, Node, Text, VBox, VStrut } from '../../../../scenery/js/imports.js';
import Panel from '../../../../sun/js/Panel.js';
import VerticalCheckboxGroup from '../../../../sun/js/VerticalCheckboxGroup.js';
import balancingAct from '../../balancingAct.js';
import BalancingActStrings from '../../BalancingActStrings.js';
import BASharedConstants from '../BASharedConstants.js';
import PositionIndicatorChoice from '../model/PositionIndicatorChoice.js';
import AttachmentBarNode from './AttachmentBarNode.js';
import ColumnOnOffController from './ColumnOnOffController.js';
import FulcrumNode from './FulcrumNode.js';
import LevelIndicatorNode from './LevelIndicatorNode.js';
import LevelSupportColumnNode from './LevelSupportColumnNode.js';
import MassNodeFactory from './MassNodeFactory.js';
import MysteryVectorNode from './MysteryVectorNode.js';
import PlankNode from './PlankNode.js';
import PositionedVectorNode from './PositionedVectorNode.js';
import PositionIndicatorControlPanel from './PositionIndicatorControlPanel.js';
import PositionMarkerSetNode from './PositionMarkerSetNode.js';
import RotatingRulerNode from './RotatingRulerNode.js';

// strings
const forcesFromObjectsString = BalancingActStrings.forcesFromObjects;
const levelString = BalancingActStrings.level;
const massLabelsString = BalancingActStrings.massLabels;
const showString = BalancingActStrings.show;

// constants
const X_MARGIN_IN_PANELS = 5;
const PANEL_TITLE_FONT = new PhetFont(16);
const PANEL_OPTION_FONT = {
  font: new PhetFont(14)
};
class BasicBalanceScreenView extends ScreenView {
  /**
   * @param {BalanceModel} model
   * @param {Tandem} tandem
   */
  constructor(model, tandem) {
    super({
      layoutBounds: BASharedConstants.LAYOUT_BOUNDS
    });
    const self = this;
    this.model = model;

    // Define the properties that control visibility of various display elements.
    this.viewProperties = {
      massLabelsVisibleProperty: new BooleanProperty(true, {
        tandem: tandem.createTandem('massLabelsVisibleProperty')
      }),
      forceVectorsFromObjectsVisibleProperty: new BooleanProperty(false, {
        tandem: tandem.createTandem('forceVectorsFromObjectsVisibleProperty')
      }),
      levelIndicatorVisibleProperty: new BooleanProperty(false, {
        tandem: tandem.createTandem('levelIndicatorVisibleProperty')
      }),
      positionMarkerStateProperty: new EnumerationDeprecatedProperty(PositionIndicatorChoice, PositionIndicatorChoice.NONE, {
        tandem: tandem.createTandem('positionMarkerStateProperty')
      })
    };

    // Create the model-view transform.  The primary units used in the model are meters, so significant zoom is used.
    // The multipliers for the 2nd parameter can be used to adjust where the point (0, 0) in the model, which is on the
    // ground just below the center of the balance, is positioned in the view.
    const modelViewTransform = ModelViewTransform2.createSinglePointScaleInvertedYMapping(Vector2.ZERO, new Vector2(this.layoutBounds.width * 0.375, this.layoutBounds.height * 0.79), 105);

    // @public {ModelViewTransform2} - model-view transform for this screen
    this.modelViewTransform = modelViewTransform;

    // Create a root node and send to back so that the layout bounds box can be made visible if needed.
    const root = new Node();
    this.addChild(root);
    root.moveToBack();

    // Add the background, which portrays the sky and ground.
    const skyAndGroundHeight = this.layoutBounds.height * 1.5;
    root.addChild(new OutsideBackgroundNode(this.layoutBounds.centerX, modelViewTransform.modelToViewY(0), this.layoutBounds.width * 2.5, skyAndGroundHeight, skyAndGroundHeight));

    // Set up a layer for non-mass model elements.
    this.nonMassLayer = new Node();
    root.addChild(this.nonMassLayer);

    // Set up a separate layer for the masses so that they will be out in front of the other elements of the model.
    const massesLayer = new Node();
    root.addChild(massesLayer);

    // @private {Map.<Mass,Node>} - a map of masses to their corresponding view elements
    this.massesToNodesMap = new Map();
    const handleMassAdded = addedMass => {
      // Create and add the view representation for this mass.
      const massNode = MassNodeFactory.createMassNode(addedMass, modelViewTransform, true, self.viewProperties.massLabelsVisibleProperty, model.columnStateProperty);
      massesLayer.addChild(massNode);
      this.massesToNodesMap.set(addedMass, massNode);

      // Move the mass to the front when grabbed so that layering stays reasonable.
      addedMass.userControlledProperty.link(userControlled => {
        if (userControlled) {
          massNode.moveToFront();
        }
      });

      // Add the removal listener for if and when this mass is removed from the model.
      const removalListener = removedMass => {
        if (removedMass === addedMass) {
          massesLayer.removeChild(massNode);
          this.massesToNodesMap.delete(removedMass);
          model.massList.removeItemRemovedListener(removalListener);
        }
      };
      model.massList.addItemRemovedListener(removalListener);
    };

    // Add initial mass representations.
    model.massList.forEach(handleMassAdded);

    // Whenever a mass is added to the model, create a graphic for it.
    model.massList.addItemAddedListener(handleMassAdded);

    // Add graphics for the plank, the fulcrum, the attachment bar, and the columns.
    this.nonMassLayer.addChild(new FulcrumNode(modelViewTransform, model.fulcrum));
    const plankNode = new PlankNode(modelViewTransform, model.plank);
    this.nonMassLayer.addChild(plankNode);
    this.nonMassLayer.addChild(new AttachmentBarNode(modelViewTransform, model.plank));
    model.supportColumns.forEach(supportColumn => {
      this.nonMassLayer.addChild(new LevelSupportColumnNode(modelViewTransform, supportColumn, model.columnStateProperty));
    });

    // Add the ruler.
    const rulersVisibleProperty = new Property(false);
    this.viewProperties.positionMarkerStateProperty.link(positionMarkerState => {
      rulersVisibleProperty.value = positionMarkerState === PositionIndicatorChoice.RULERS;
    });
    this.nonMassLayer.addChild(new RotatingRulerNode(model.plank, modelViewTransform, rulersVisibleProperty));

    // Add the position markers.
    const positionMarkersVisible = new Property(false);
    this.viewProperties.positionMarkerStateProperty.link(positionMarkerState => {
      positionMarkersVisible.value = positionMarkerState === PositionIndicatorChoice.MARKS;
    });
    this.nonMassLayer.addChild(new PositionMarkerSetNode(model.plank, modelViewTransform, positionMarkersVisible));

    // Add the level indicator node which will show whether the plank is balanced or not
    const levelIndicatorNode = new LevelIndicatorNode(modelViewTransform, model.plank);
    this.viewProperties.levelIndicatorVisibleProperty.link(visible => {
      levelIndicatorNode.visible = visible;
    });
    this.nonMassLayer.addChild(levelIndicatorNode);

    // Listen to the list of force vectors and manage their representations.
    model.plank.forceVectors.addItemAddedListener(addedMassForceVector => {
      // Add a representation for the new vector.
      let forceVectorNode;
      if (addedMassForceVector.isObfuscated()) {
        forceVectorNode = new MysteryVectorNode(addedMassForceVector.forceVectorProperty, this.viewProperties.forceVectorsFromObjectsVisibleProperty, modelViewTransform);
      } else {
        forceVectorNode = new PositionedVectorNode(addedMassForceVector.forceVectorProperty, 0.23,
        // Scaling factor, chosen to make size reasonable.
        this.viewProperties.forceVectorsFromObjectsVisibleProperty, modelViewTransform);
      }
      this.nonMassLayer.addChild(forceVectorNode);

      // Remove representation when corresponding vector removed from model.
      model.plank.forceVectors.addItemRemovedListener(removedMassForceVector => {
        if (removedMassForceVector === addedMassForceVector) {
          this.nonMassLayer.removeChild(forceVectorNode);
        }
      });
    });

    // Add the buttons that will control whether or not the support columns are in place.
    const columnControlPanel = new ColumnOnOffController(model.columnStateProperty, {
      center: modelViewTransform.modelToViewPosition(new Vector2(0, -0.5)),
      tandem: tandem.createTandem('columnControlPanel')
    });
    this.nonMassLayer.addChild(columnControlPanel);

    // The panels should fit in the space to the right of the plank.
    const maxControlPanelWidth = this.layoutBounds.maxX - plankNode.bounds.maxX - 20;

    // Add the control panel that will allow users to control the visibility of the various indicators.
    const showPanelTandem = tandem.createTandem('showPanel');
    const indicatorVisibilityCheckboxGroup = new VerticalCheckboxGroup([{
      createNode: () => new Text(massLabelsString, PANEL_OPTION_FONT),
      property: this.viewProperties.massLabelsVisibleProperty,
      label: massLabelsString,
      tandemName: 'massLabelsCheckbox'
    }, {
      createNode: () => new Text(forcesFromObjectsString, PANEL_OPTION_FONT),
      property: this.viewProperties.forceVectorsFromObjectsVisibleProperty,
      label: forcesFromObjectsString,
      tandemName: 'forcesFromObjectsCheckbox'
    }, {
      createNode: () => new Text(levelString, PANEL_OPTION_FONT),
      property: this.viewProperties.levelIndicatorVisibleProperty,
      label: levelString,
      tandemName: 'levelCheckbox'
    }], {
      checkboxOptions: {
        boxWidth: 15
      },
      spacing: 5,
      tandem: showPanelTandem
    });
    const titleToControlsVerticalSpace = 7;
    const indicatorVisibilityControlsVBox = new VBox({
      children: [new Text(showString, {
        font: PANEL_TITLE_FONT
      }), new VStrut(titleToControlsVerticalSpace), new HBox({
        children: [new HStrut(10), indicatorVisibilityCheckboxGroup]
      })],
      align: 'left'
    });
    const indicatorVisibilityControlPanel = new Panel(indicatorVisibilityControlsVBox, {
      xMargin: X_MARGIN_IN_PANELS,
      fill: 'rgb( 240, 240, 240 )',
      top: 5,
      right: this.layoutBounds.width - 10,
      maxWidth: maxControlPanelWidth
    });
    this.nonMassLayer.addChild(indicatorVisibilityControlPanel);

    // Add the control panel that will allow users to select between the various position markers, i.e. ruler, position
    // markers, or nothing.
    const positionControlPanel = new PositionIndicatorControlPanel(this.viewProperties.positionMarkerStateProperty, {
      left: indicatorVisibilityControlPanel.left,
      top: indicatorVisibilityControlPanel.bottom + 5,
      minWidth: indicatorVisibilityControlPanel.width,
      maxWidth: maxControlPanelWidth,
      tandem: tandem.createTandem('positionPanel')
    });
    this.nonMassLayer.addChild(positionControlPanel);

    // Add bounds for the control panels so that descendant types can see them for layout.
    this.controlPanelBounds = new Bounds2(indicatorVisibilityControlPanel.bounds.minX, positionControlPanel.bounds.minY, indicatorVisibilityControlPanel.bounds.maxX, positionControlPanel.bounds.maxY);

    // Reset All button.
    function resetClosure() {
      self.reset();
    }
    this.nonMassLayer.addChild(new ResetAllButton({
      listener: resetClosure,
      radius: BASharedConstants.RESET_ALL_BUTTON_RADIUS,
      right: indicatorVisibilityControlPanel.right,
      bottom: this.layoutBounds.height - 10,
      tandem: tandem.createTandem('resetAllButton')
    }));
  }

  /**
   * Get the node for the provided mass.
   * @param {Mass} mass
   * @returns {Node|undefined}
   * @public
   */
  getNodeForMass(mass) {
    return this.massesToNodesMap.get(mass);
  }

  // @public
  reset() {
    this.model.reset();
    _.values(this.viewProperties).forEach(viewProperty => {
      viewProperty.reset();
    });
  }
}
balancingAct.register('BasicBalanceScreenView', BasicBalanceScreenView);
export default BasicBalanceScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJFbnVtZXJhdGlvbkRlcHJlY2F0ZWRQcm9wZXJ0eSIsIlByb3BlcnR5IiwiQm91bmRzMiIsIlZlY3RvcjIiLCJTY3JlZW5WaWV3IiwiTW9kZWxWaWV3VHJhbnNmb3JtMiIsIlJlc2V0QWxsQnV0dG9uIiwiT3V0c2lkZUJhY2tncm91bmROb2RlIiwiUGhldEZvbnQiLCJIQm94IiwiSFN0cnV0IiwiTm9kZSIsIlRleHQiLCJWQm94IiwiVlN0cnV0IiwiUGFuZWwiLCJWZXJ0aWNhbENoZWNrYm94R3JvdXAiLCJiYWxhbmNpbmdBY3QiLCJCYWxhbmNpbmdBY3RTdHJpbmdzIiwiQkFTaGFyZWRDb25zdGFudHMiLCJQb3NpdGlvbkluZGljYXRvckNob2ljZSIsIkF0dGFjaG1lbnRCYXJOb2RlIiwiQ29sdW1uT25PZmZDb250cm9sbGVyIiwiRnVsY3J1bU5vZGUiLCJMZXZlbEluZGljYXRvck5vZGUiLCJMZXZlbFN1cHBvcnRDb2x1bW5Ob2RlIiwiTWFzc05vZGVGYWN0b3J5IiwiTXlzdGVyeVZlY3Rvck5vZGUiLCJQbGFua05vZGUiLCJQb3NpdGlvbmVkVmVjdG9yTm9kZSIsIlBvc2l0aW9uSW5kaWNhdG9yQ29udHJvbFBhbmVsIiwiUG9zaXRpb25NYXJrZXJTZXROb2RlIiwiUm90YXRpbmdSdWxlck5vZGUiLCJmb3JjZXNGcm9tT2JqZWN0c1N0cmluZyIsImZvcmNlc0Zyb21PYmplY3RzIiwibGV2ZWxTdHJpbmciLCJsZXZlbCIsIm1hc3NMYWJlbHNTdHJpbmciLCJtYXNzTGFiZWxzIiwic2hvd1N0cmluZyIsInNob3ciLCJYX01BUkdJTl9JTl9QQU5FTFMiLCJQQU5FTF9USVRMRV9GT05UIiwiUEFORUxfT1BUSU9OX0ZPTlQiLCJmb250IiwiQmFzaWNCYWxhbmNlU2NyZWVuVmlldyIsImNvbnN0cnVjdG9yIiwibW9kZWwiLCJ0YW5kZW0iLCJsYXlvdXRCb3VuZHMiLCJMQVlPVVRfQk9VTkRTIiwic2VsZiIsInZpZXdQcm9wZXJ0aWVzIiwibWFzc0xhYmVsc1Zpc2libGVQcm9wZXJ0eSIsImNyZWF0ZVRhbmRlbSIsImZvcmNlVmVjdG9yc0Zyb21PYmplY3RzVmlzaWJsZVByb3BlcnR5IiwibGV2ZWxJbmRpY2F0b3JWaXNpYmxlUHJvcGVydHkiLCJwb3NpdGlvbk1hcmtlclN0YXRlUHJvcGVydHkiLCJOT05FIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwiY3JlYXRlU2luZ2xlUG9pbnRTY2FsZUludmVydGVkWU1hcHBpbmciLCJaRVJPIiwid2lkdGgiLCJoZWlnaHQiLCJyb290IiwiYWRkQ2hpbGQiLCJtb3ZlVG9CYWNrIiwic2t5QW5kR3JvdW5kSGVpZ2h0IiwiY2VudGVyWCIsIm1vZGVsVG9WaWV3WSIsIm5vbk1hc3NMYXllciIsIm1hc3Nlc0xheWVyIiwibWFzc2VzVG9Ob2Rlc01hcCIsIk1hcCIsImhhbmRsZU1hc3NBZGRlZCIsImFkZGVkTWFzcyIsIm1hc3NOb2RlIiwiY3JlYXRlTWFzc05vZGUiLCJjb2x1bW5TdGF0ZVByb3BlcnR5Iiwic2V0IiwidXNlckNvbnRyb2xsZWRQcm9wZXJ0eSIsImxpbmsiLCJ1c2VyQ29udHJvbGxlZCIsIm1vdmVUb0Zyb250IiwicmVtb3ZhbExpc3RlbmVyIiwicmVtb3ZlZE1hc3MiLCJyZW1vdmVDaGlsZCIsImRlbGV0ZSIsIm1hc3NMaXN0IiwicmVtb3ZlSXRlbVJlbW92ZWRMaXN0ZW5lciIsImFkZEl0ZW1SZW1vdmVkTGlzdGVuZXIiLCJmb3JFYWNoIiwiYWRkSXRlbUFkZGVkTGlzdGVuZXIiLCJmdWxjcnVtIiwicGxhbmtOb2RlIiwicGxhbmsiLCJzdXBwb3J0Q29sdW1ucyIsInN1cHBvcnRDb2x1bW4iLCJydWxlcnNWaXNpYmxlUHJvcGVydHkiLCJwb3NpdGlvbk1hcmtlclN0YXRlIiwidmFsdWUiLCJSVUxFUlMiLCJwb3NpdGlvbk1hcmtlcnNWaXNpYmxlIiwiTUFSS1MiLCJsZXZlbEluZGljYXRvck5vZGUiLCJ2aXNpYmxlIiwiZm9yY2VWZWN0b3JzIiwiYWRkZWRNYXNzRm9yY2VWZWN0b3IiLCJmb3JjZVZlY3Rvck5vZGUiLCJpc09iZnVzY2F0ZWQiLCJmb3JjZVZlY3RvclByb3BlcnR5IiwicmVtb3ZlZE1hc3NGb3JjZVZlY3RvciIsImNvbHVtbkNvbnRyb2xQYW5lbCIsImNlbnRlciIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJtYXhDb250cm9sUGFuZWxXaWR0aCIsIm1heFgiLCJib3VuZHMiLCJzaG93UGFuZWxUYW5kZW0iLCJpbmRpY2F0b3JWaXNpYmlsaXR5Q2hlY2tib3hHcm91cCIsImNyZWF0ZU5vZGUiLCJwcm9wZXJ0eSIsImxhYmVsIiwidGFuZGVtTmFtZSIsImNoZWNrYm94T3B0aW9ucyIsImJveFdpZHRoIiwic3BhY2luZyIsInRpdGxlVG9Db250cm9sc1ZlcnRpY2FsU3BhY2UiLCJpbmRpY2F0b3JWaXNpYmlsaXR5Q29udHJvbHNWQm94IiwiY2hpbGRyZW4iLCJhbGlnbiIsImluZGljYXRvclZpc2liaWxpdHlDb250cm9sUGFuZWwiLCJ4TWFyZ2luIiwiZmlsbCIsInRvcCIsInJpZ2h0IiwibWF4V2lkdGgiLCJwb3NpdGlvbkNvbnRyb2xQYW5lbCIsImxlZnQiLCJib3R0b20iLCJtaW5XaWR0aCIsImNvbnRyb2xQYW5lbEJvdW5kcyIsIm1pblgiLCJtaW5ZIiwibWF4WSIsInJlc2V0Q2xvc3VyZSIsInJlc2V0IiwibGlzdGVuZXIiLCJyYWRpdXMiLCJSRVNFVF9BTExfQlVUVE9OX1JBRElVUyIsImdldE5vZGVGb3JNYXNzIiwibWFzcyIsImdldCIsIl8iLCJ2YWx1ZXMiLCJ2aWV3UHJvcGVydHkiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkJhc2ljQmFsYW5jZVNjcmVlblZpZXcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2NyZWVuVmlldyB0aGF0IGRpc3BsYXlzIGl0ZW1zIGluIHRoZSBiYWxhbmNlIG1vZGVsLCBwcmltYXJpbHkgdGhlIGJhbGFuY2UgYmVhbSAoaS5lLiB0aGUgcGxhbmspLCB0aGUgdmFyaW91cyBtYXNzZXMsXHJcbiAqIGFuZCBhIGZsb2F0aW5nIGNvbnRyb2wgcGFuZWwgZm9yIGNvbnRyb2xsaW5nIHRoZSB2aXNpYmlsaXR5IG9mIGxhYmVscywgcnVsZXJzLCBldGMuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IEVudW1lcmF0aW9uRGVwcmVjYXRlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRW51bWVyYXRpb25EZXByZWNhdGVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgU2NyZWVuVmlldyBmcm9tICcuLi8uLi8uLi8uLi9qb2lzdC9qcy9TY3JlZW5WaWV3LmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgUmVzZXRBbGxCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL2J1dHRvbnMvUmVzZXRBbGxCdXR0b24uanMnO1xyXG5pbXBvcnQgT3V0c2lkZUJhY2tncm91bmROb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9PdXRzaWRlQmFja2dyb3VuZE5vZGUuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgSEJveCwgSFN0cnV0LCBOb2RlLCBUZXh0LCBWQm94LCBWU3RydXQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUGFuZWwgZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL1BhbmVsLmpzJztcclxuaW1wb3J0IFZlcnRpY2FsQ2hlY2tib3hHcm91cCBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvVmVydGljYWxDaGVja2JveEdyb3VwLmpzJztcclxuaW1wb3J0IGJhbGFuY2luZ0FjdCBmcm9tICcuLi8uLi9iYWxhbmNpbmdBY3QuanMnO1xyXG5pbXBvcnQgQmFsYW5jaW5nQWN0U3RyaW5ncyBmcm9tICcuLi8uLi9CYWxhbmNpbmdBY3RTdHJpbmdzLmpzJztcclxuaW1wb3J0IEJBU2hhcmVkQ29uc3RhbnRzIGZyb20gJy4uL0JBU2hhcmVkQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IFBvc2l0aW9uSW5kaWNhdG9yQ2hvaWNlIGZyb20gJy4uL21vZGVsL1Bvc2l0aW9uSW5kaWNhdG9yQ2hvaWNlLmpzJztcclxuaW1wb3J0IEF0dGFjaG1lbnRCYXJOb2RlIGZyb20gJy4vQXR0YWNobWVudEJhck5vZGUuanMnO1xyXG5pbXBvcnQgQ29sdW1uT25PZmZDb250cm9sbGVyIGZyb20gJy4vQ29sdW1uT25PZmZDb250cm9sbGVyLmpzJztcclxuaW1wb3J0IEZ1bGNydW1Ob2RlIGZyb20gJy4vRnVsY3J1bU5vZGUuanMnO1xyXG5pbXBvcnQgTGV2ZWxJbmRpY2F0b3JOb2RlIGZyb20gJy4vTGV2ZWxJbmRpY2F0b3JOb2RlLmpzJztcclxuaW1wb3J0IExldmVsU3VwcG9ydENvbHVtbk5vZGUgZnJvbSAnLi9MZXZlbFN1cHBvcnRDb2x1bW5Ob2RlLmpzJztcclxuaW1wb3J0IE1hc3NOb2RlRmFjdG9yeSBmcm9tICcuL01hc3NOb2RlRmFjdG9yeS5qcyc7XHJcbmltcG9ydCBNeXN0ZXJ5VmVjdG9yTm9kZSBmcm9tICcuL015c3RlcnlWZWN0b3JOb2RlLmpzJztcclxuaW1wb3J0IFBsYW5rTm9kZSBmcm9tICcuL1BsYW5rTm9kZS5qcyc7XHJcbmltcG9ydCBQb3NpdGlvbmVkVmVjdG9yTm9kZSBmcm9tICcuL1Bvc2l0aW9uZWRWZWN0b3JOb2RlLmpzJztcclxuaW1wb3J0IFBvc2l0aW9uSW5kaWNhdG9yQ29udHJvbFBhbmVsIGZyb20gJy4vUG9zaXRpb25JbmRpY2F0b3JDb250cm9sUGFuZWwuanMnO1xyXG5pbXBvcnQgUG9zaXRpb25NYXJrZXJTZXROb2RlIGZyb20gJy4vUG9zaXRpb25NYXJrZXJTZXROb2RlLmpzJztcclxuaW1wb3J0IFJvdGF0aW5nUnVsZXJOb2RlIGZyb20gJy4vUm90YXRpbmdSdWxlck5vZGUuanMnO1xyXG5cclxuLy8gc3RyaW5nc1xyXG5jb25zdCBmb3JjZXNGcm9tT2JqZWN0c1N0cmluZyA9IEJhbGFuY2luZ0FjdFN0cmluZ3MuZm9yY2VzRnJvbU9iamVjdHM7XHJcbmNvbnN0IGxldmVsU3RyaW5nID0gQmFsYW5jaW5nQWN0U3RyaW5ncy5sZXZlbDtcclxuY29uc3QgbWFzc0xhYmVsc1N0cmluZyA9IEJhbGFuY2luZ0FjdFN0cmluZ3MubWFzc0xhYmVscztcclxuY29uc3Qgc2hvd1N0cmluZyA9IEJhbGFuY2luZ0FjdFN0cmluZ3Muc2hvdztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBYX01BUkdJTl9JTl9QQU5FTFMgPSA1O1xyXG5jb25zdCBQQU5FTF9USVRMRV9GT05UID0gbmV3IFBoZXRGb250KCAxNiApO1xyXG5jb25zdCBQQU5FTF9PUFRJT05fRk9OVCA9IHsgZm9udDogbmV3IFBoZXRGb250KCAxNCApIH07XHJcblxyXG5jbGFzcyBCYXNpY0JhbGFuY2VTY3JlZW5WaWV3IGV4dGVuZHMgU2NyZWVuVmlldyB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7QmFsYW5jZU1vZGVsfSBtb2RlbFxyXG4gICAqIEBwYXJhbSB7VGFuZGVtfSB0YW5kZW1cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbW9kZWwsIHRhbmRlbSApIHtcclxuICAgIHN1cGVyKCB7IGxheW91dEJvdW5kczogQkFTaGFyZWRDb25zdGFudHMuTEFZT1VUX0JPVU5EUyB9ICk7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcclxuXHJcbiAgICAvLyBEZWZpbmUgdGhlIHByb3BlcnRpZXMgdGhhdCBjb250cm9sIHZpc2liaWxpdHkgb2YgdmFyaW91cyBkaXNwbGF5IGVsZW1lbnRzLlxyXG4gICAgdGhpcy52aWV3UHJvcGVydGllcyA9IHtcclxuICAgICAgbWFzc0xhYmVsc1Zpc2libGVQcm9wZXJ0eTogbmV3IEJvb2xlYW5Qcm9wZXJ0eSggdHJ1ZSwge1xyXG4gICAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ21hc3NMYWJlbHNWaXNpYmxlUHJvcGVydHknIClcclxuICAgICAgfSApLFxyXG4gICAgICBmb3JjZVZlY3RvcnNGcm9tT2JqZWN0c1Zpc2libGVQcm9wZXJ0eTogbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UsIHtcclxuICAgICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdmb3JjZVZlY3RvcnNGcm9tT2JqZWN0c1Zpc2libGVQcm9wZXJ0eScgKVxyXG4gICAgICB9ICksXHJcbiAgICAgIGxldmVsSW5kaWNhdG9yVmlzaWJsZVByb3BlcnR5OiBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xldmVsSW5kaWNhdG9yVmlzaWJsZVByb3BlcnR5JyApXHJcbiAgICAgIH0gKSxcclxuICAgICAgcG9zaXRpb25NYXJrZXJTdGF0ZVByb3BlcnR5OiBuZXcgRW51bWVyYXRpb25EZXByZWNhdGVkUHJvcGVydHkoIFBvc2l0aW9uSW5kaWNhdG9yQ2hvaWNlLCBQb3NpdGlvbkluZGljYXRvckNob2ljZS5OT05FLCB7XHJcbiAgICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAncG9zaXRpb25NYXJrZXJTdGF0ZVByb3BlcnR5JyApXHJcbiAgICAgIH0gKVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIG1vZGVsLXZpZXcgdHJhbnNmb3JtLiAgVGhlIHByaW1hcnkgdW5pdHMgdXNlZCBpbiB0aGUgbW9kZWwgYXJlIG1ldGVycywgc28gc2lnbmlmaWNhbnQgem9vbSBpcyB1c2VkLlxyXG4gICAgLy8gVGhlIG11bHRpcGxpZXJzIGZvciB0aGUgMm5kIHBhcmFtZXRlciBjYW4gYmUgdXNlZCB0byBhZGp1c3Qgd2hlcmUgdGhlIHBvaW50ICgwLCAwKSBpbiB0aGUgbW9kZWwsIHdoaWNoIGlzIG9uIHRoZVxyXG4gICAgLy8gZ3JvdW5kIGp1c3QgYmVsb3cgdGhlIGNlbnRlciBvZiB0aGUgYmFsYW5jZSwgaXMgcG9zaXRpb25lZCBpbiB0aGUgdmlldy5cclxuICAgIGNvbnN0IG1vZGVsVmlld1RyYW5zZm9ybSA9IE1vZGVsVmlld1RyYW5zZm9ybTIuY3JlYXRlU2luZ2xlUG9pbnRTY2FsZUludmVydGVkWU1hcHBpbmcoXHJcbiAgICAgIFZlY3RvcjIuWkVSTyxcclxuICAgICAgbmV3IFZlY3RvcjIoIHRoaXMubGF5b3V0Qm91bmRzLndpZHRoICogMC4zNzUsIHRoaXMubGF5b3V0Qm91bmRzLmhlaWdodCAqIDAuNzkgKSxcclxuICAgICAgMTA1XHJcbiAgICApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge01vZGVsVmlld1RyYW5zZm9ybTJ9IC0gbW9kZWwtdmlldyB0cmFuc2Zvcm0gZm9yIHRoaXMgc2NyZWVuXHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSA9IG1vZGVsVmlld1RyYW5zZm9ybTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSByb290IG5vZGUgYW5kIHNlbmQgdG8gYmFjayBzbyB0aGF0IHRoZSBsYXlvdXQgYm91bmRzIGJveCBjYW4gYmUgbWFkZSB2aXNpYmxlIGlmIG5lZWRlZC5cclxuICAgIGNvbnN0IHJvb3QgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggcm9vdCApO1xyXG4gICAgcm9vdC5tb3ZlVG9CYWNrKCk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBiYWNrZ3JvdW5kLCB3aGljaCBwb3J0cmF5cyB0aGUgc2t5IGFuZCBncm91bmQuXHJcbiAgICBjb25zdCBza3lBbmRHcm91bmRIZWlnaHQgPSB0aGlzLmxheW91dEJvdW5kcy5oZWlnaHQgKiAxLjU7XHJcbiAgICByb290LmFkZENoaWxkKCBuZXcgT3V0c2lkZUJhY2tncm91bmROb2RlKFxyXG4gICAgICB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJYLFxyXG4gICAgICBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdZKCAwICksXHJcbiAgICAgIHRoaXMubGF5b3V0Qm91bmRzLndpZHRoICogMi41LFxyXG4gICAgICBza3lBbmRHcm91bmRIZWlnaHQsXHJcbiAgICAgIHNreUFuZEdyb3VuZEhlaWdodFxyXG4gICAgKSApO1xyXG5cclxuICAgIC8vIFNldCB1cCBhIGxheWVyIGZvciBub24tbWFzcyBtb2RlbCBlbGVtZW50cy5cclxuICAgIHRoaXMubm9uTWFzc0xheWVyID0gbmV3IE5vZGUoKTtcclxuICAgIHJvb3QuYWRkQ2hpbGQoIHRoaXMubm9uTWFzc0xheWVyICk7XHJcblxyXG4gICAgLy8gU2V0IHVwIGEgc2VwYXJhdGUgbGF5ZXIgZm9yIHRoZSBtYXNzZXMgc28gdGhhdCB0aGV5IHdpbGwgYmUgb3V0IGluIGZyb250IG9mIHRoZSBvdGhlciBlbGVtZW50cyBvZiB0aGUgbW9kZWwuXHJcbiAgICBjb25zdCBtYXNzZXNMYXllciA9IG5ldyBOb2RlKCk7XHJcbiAgICByb290LmFkZENoaWxkKCBtYXNzZXNMYXllciApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtNYXAuPE1hc3MsTm9kZT59IC0gYSBtYXAgb2YgbWFzc2VzIHRvIHRoZWlyIGNvcnJlc3BvbmRpbmcgdmlldyBlbGVtZW50c1xyXG4gICAgdGhpcy5tYXNzZXNUb05vZGVzTWFwID0gbmV3IE1hcCgpO1xyXG5cclxuICAgIGNvbnN0IGhhbmRsZU1hc3NBZGRlZCA9IGFkZGVkTWFzcyA9PiB7XHJcblxyXG4gICAgICAvLyBDcmVhdGUgYW5kIGFkZCB0aGUgdmlldyByZXByZXNlbnRhdGlvbiBmb3IgdGhpcyBtYXNzLlxyXG4gICAgICBjb25zdCBtYXNzTm9kZSA9IE1hc3NOb2RlRmFjdG9yeS5jcmVhdGVNYXNzTm9kZShcclxuICAgICAgICBhZGRlZE1hc3MsXHJcbiAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLFxyXG4gICAgICAgIHRydWUsXHJcbiAgICAgICAgc2VsZi52aWV3UHJvcGVydGllcy5tYXNzTGFiZWxzVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICAgIG1vZGVsLmNvbHVtblN0YXRlUHJvcGVydHlcclxuICAgICAgKTtcclxuICAgICAgbWFzc2VzTGF5ZXIuYWRkQ2hpbGQoIG1hc3NOb2RlICk7XHJcbiAgICAgIHRoaXMubWFzc2VzVG9Ob2Rlc01hcC5zZXQoIGFkZGVkTWFzcywgbWFzc05vZGUgKTtcclxuXHJcbiAgICAgIC8vIE1vdmUgdGhlIG1hc3MgdG8gdGhlIGZyb250IHdoZW4gZ3JhYmJlZCBzbyB0aGF0IGxheWVyaW5nIHN0YXlzIHJlYXNvbmFibGUuXHJcbiAgICAgIGFkZGVkTWFzcy51c2VyQ29udHJvbGxlZFByb3BlcnR5LmxpbmsoIHVzZXJDb250cm9sbGVkID0+IHtcclxuICAgICAgICBpZiAoIHVzZXJDb250cm9sbGVkICkge1xyXG4gICAgICAgICAgbWFzc05vZGUubW92ZVRvRnJvbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIC8vIEFkZCB0aGUgcmVtb3ZhbCBsaXN0ZW5lciBmb3IgaWYgYW5kIHdoZW4gdGhpcyBtYXNzIGlzIHJlbW92ZWQgZnJvbSB0aGUgbW9kZWwuXHJcbiAgICAgIGNvbnN0IHJlbW92YWxMaXN0ZW5lciA9IHJlbW92ZWRNYXNzID0+IHtcclxuICAgICAgICBpZiAoIHJlbW92ZWRNYXNzID09PSBhZGRlZE1hc3MgKSB7XHJcbiAgICAgICAgICBtYXNzZXNMYXllci5yZW1vdmVDaGlsZCggbWFzc05vZGUgKTtcclxuICAgICAgICAgIHRoaXMubWFzc2VzVG9Ob2Rlc01hcC5kZWxldGUoIHJlbW92ZWRNYXNzICk7XHJcbiAgICAgICAgICBtb2RlbC5tYXNzTGlzdC5yZW1vdmVJdGVtUmVtb3ZlZExpc3RlbmVyKCByZW1vdmFsTGlzdGVuZXIgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIG1vZGVsLm1hc3NMaXN0LmFkZEl0ZW1SZW1vdmVkTGlzdGVuZXIoIHJlbW92YWxMaXN0ZW5lciApO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBBZGQgaW5pdGlhbCBtYXNzIHJlcHJlc2VudGF0aW9ucy5cclxuICAgIG1vZGVsLm1hc3NMaXN0LmZvckVhY2goIGhhbmRsZU1hc3NBZGRlZCApO1xyXG5cclxuICAgIC8vIFdoZW5ldmVyIGEgbWFzcyBpcyBhZGRlZCB0byB0aGUgbW9kZWwsIGNyZWF0ZSBhIGdyYXBoaWMgZm9yIGl0LlxyXG4gICAgbW9kZWwubWFzc0xpc3QuYWRkSXRlbUFkZGVkTGlzdGVuZXIoIGhhbmRsZU1hc3NBZGRlZCApO1xyXG5cclxuICAgIC8vIEFkZCBncmFwaGljcyBmb3IgdGhlIHBsYW5rLCB0aGUgZnVsY3J1bSwgdGhlIGF0dGFjaG1lbnQgYmFyLCBhbmQgdGhlIGNvbHVtbnMuXHJcbiAgICB0aGlzLm5vbk1hc3NMYXllci5hZGRDaGlsZCggbmV3IEZ1bGNydW1Ob2RlKCBtb2RlbFZpZXdUcmFuc2Zvcm0sIG1vZGVsLmZ1bGNydW0gKSApO1xyXG4gICAgY29uc3QgcGxhbmtOb2RlID0gbmV3IFBsYW5rTm9kZSggbW9kZWxWaWV3VHJhbnNmb3JtLCBtb2RlbC5wbGFuayApO1xyXG4gICAgdGhpcy5ub25NYXNzTGF5ZXIuYWRkQ2hpbGQoIHBsYW5rTm9kZSApO1xyXG4gICAgdGhpcy5ub25NYXNzTGF5ZXIuYWRkQ2hpbGQoIG5ldyBBdHRhY2htZW50QmFyTm9kZSggbW9kZWxWaWV3VHJhbnNmb3JtLCBtb2RlbC5wbGFuayApICk7XHJcbiAgICBtb2RlbC5zdXBwb3J0Q29sdW1ucy5mb3JFYWNoKCBzdXBwb3J0Q29sdW1uID0+IHtcclxuICAgICAgdGhpcy5ub25NYXNzTGF5ZXIuYWRkQ2hpbGQoIG5ldyBMZXZlbFN1cHBvcnRDb2x1bW5Ob2RlKFxyXG4gICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgICBzdXBwb3J0Q29sdW1uLFxyXG4gICAgICAgIG1vZGVsLmNvbHVtblN0YXRlUHJvcGVydHlcclxuICAgICAgKSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgcnVsZXIuXHJcbiAgICBjb25zdCBydWxlcnNWaXNpYmxlUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIGZhbHNlICk7XHJcbiAgICB0aGlzLnZpZXdQcm9wZXJ0aWVzLnBvc2l0aW9uTWFya2VyU3RhdGVQcm9wZXJ0eS5saW5rKCBwb3NpdGlvbk1hcmtlclN0YXRlID0+IHtcclxuICAgICAgcnVsZXJzVmlzaWJsZVByb3BlcnR5LnZhbHVlID0gcG9zaXRpb25NYXJrZXJTdGF0ZSA9PT0gUG9zaXRpb25JbmRpY2F0b3JDaG9pY2UuUlVMRVJTO1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5ub25NYXNzTGF5ZXIuYWRkQ2hpbGQoIG5ldyBSb3RhdGluZ1J1bGVyTm9kZSggbW9kZWwucGxhbmssIG1vZGVsVmlld1RyYW5zZm9ybSwgcnVsZXJzVmlzaWJsZVByb3BlcnR5ICkgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIHBvc2l0aW9uIG1hcmtlcnMuXHJcbiAgICBjb25zdCBwb3NpdGlvbk1hcmtlcnNWaXNpYmxlID0gbmV3IFByb3BlcnR5KCBmYWxzZSApO1xyXG4gICAgdGhpcy52aWV3UHJvcGVydGllcy5wb3NpdGlvbk1hcmtlclN0YXRlUHJvcGVydHkubGluayggcG9zaXRpb25NYXJrZXJTdGF0ZSA9PiB7XHJcbiAgICAgIHBvc2l0aW9uTWFya2Vyc1Zpc2libGUudmFsdWUgPSBwb3NpdGlvbk1hcmtlclN0YXRlID09PSBQb3NpdGlvbkluZGljYXRvckNob2ljZS5NQVJLUztcclxuICAgIH0gKTtcclxuICAgIHRoaXMubm9uTWFzc0xheWVyLmFkZENoaWxkKCBuZXcgUG9zaXRpb25NYXJrZXJTZXROb2RlKCBtb2RlbC5wbGFuaywgbW9kZWxWaWV3VHJhbnNmb3JtLCBwb3NpdGlvbk1hcmtlcnNWaXNpYmxlICkgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGxldmVsIGluZGljYXRvciBub2RlIHdoaWNoIHdpbGwgc2hvdyB3aGV0aGVyIHRoZSBwbGFuayBpcyBiYWxhbmNlZCBvciBub3RcclxuICAgIGNvbnN0IGxldmVsSW5kaWNhdG9yTm9kZSA9IG5ldyBMZXZlbEluZGljYXRvck5vZGUoIG1vZGVsVmlld1RyYW5zZm9ybSwgbW9kZWwucGxhbmsgKTtcclxuICAgIHRoaXMudmlld1Byb3BlcnRpZXMubGV2ZWxJbmRpY2F0b3JWaXNpYmxlUHJvcGVydHkubGluayggdmlzaWJsZSA9PiB7XHJcbiAgICAgIGxldmVsSW5kaWNhdG9yTm9kZS52aXNpYmxlID0gdmlzaWJsZTtcclxuICAgIH0gKTtcclxuICAgIHRoaXMubm9uTWFzc0xheWVyLmFkZENoaWxkKCBsZXZlbEluZGljYXRvck5vZGUgKTtcclxuXHJcbiAgICAvLyBMaXN0ZW4gdG8gdGhlIGxpc3Qgb2YgZm9yY2UgdmVjdG9ycyBhbmQgbWFuYWdlIHRoZWlyIHJlcHJlc2VudGF0aW9ucy5cclxuICAgIG1vZGVsLnBsYW5rLmZvcmNlVmVjdG9ycy5hZGRJdGVtQWRkZWRMaXN0ZW5lciggYWRkZWRNYXNzRm9yY2VWZWN0b3IgPT4ge1xyXG4gICAgICAvLyBBZGQgYSByZXByZXNlbnRhdGlvbiBmb3IgdGhlIG5ldyB2ZWN0b3IuXHJcbiAgICAgIGxldCBmb3JjZVZlY3Rvck5vZGU7XHJcbiAgICAgIGlmICggYWRkZWRNYXNzRm9yY2VWZWN0b3IuaXNPYmZ1c2NhdGVkKCkgKSB7XHJcbiAgICAgICAgZm9yY2VWZWN0b3JOb2RlID0gbmV3IE15c3RlcnlWZWN0b3JOb2RlKFxyXG4gICAgICAgICAgYWRkZWRNYXNzRm9yY2VWZWN0b3IuZm9yY2VWZWN0b3JQcm9wZXJ0eSxcclxuICAgICAgICAgIHRoaXMudmlld1Byb3BlcnRpZXMuZm9yY2VWZWN0b3JzRnJvbU9iamVjdHNWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgICAgICBtb2RlbFZpZXdUcmFuc2Zvcm1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGZvcmNlVmVjdG9yTm9kZSA9IG5ldyBQb3NpdGlvbmVkVmVjdG9yTm9kZSggYWRkZWRNYXNzRm9yY2VWZWN0b3IuZm9yY2VWZWN0b3JQcm9wZXJ0eSxcclxuICAgICAgICAgIDAuMjMsICAvLyBTY2FsaW5nIGZhY3RvciwgY2hvc2VuIHRvIG1ha2Ugc2l6ZSByZWFzb25hYmxlLlxyXG4gICAgICAgICAgdGhpcy52aWV3UHJvcGVydGllcy5mb3JjZVZlY3RvcnNGcm9tT2JqZWN0c1Zpc2libGVQcm9wZXJ0eSxcclxuICAgICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5ub25NYXNzTGF5ZXIuYWRkQ2hpbGQoIGZvcmNlVmVjdG9yTm9kZSApO1xyXG5cclxuICAgICAgLy8gUmVtb3ZlIHJlcHJlc2VudGF0aW9uIHdoZW4gY29ycmVzcG9uZGluZyB2ZWN0b3IgcmVtb3ZlZCBmcm9tIG1vZGVsLlxyXG4gICAgICBtb2RlbC5wbGFuay5mb3JjZVZlY3RvcnMuYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciggcmVtb3ZlZE1hc3NGb3JjZVZlY3RvciA9PiB7XHJcbiAgICAgICAgaWYgKCByZW1vdmVkTWFzc0ZvcmNlVmVjdG9yID09PSBhZGRlZE1hc3NGb3JjZVZlY3RvciApIHtcclxuICAgICAgICAgIHRoaXMubm9uTWFzc0xheWVyLnJlbW92ZUNoaWxkKCBmb3JjZVZlY3Rvck5vZGUgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGJ1dHRvbnMgdGhhdCB3aWxsIGNvbnRyb2wgd2hldGhlciBvciBub3QgdGhlIHN1cHBvcnQgY29sdW1ucyBhcmUgaW4gcGxhY2UuXHJcbiAgICBjb25zdCBjb2x1bW5Db250cm9sUGFuZWwgPSBuZXcgQ29sdW1uT25PZmZDb250cm9sbGVyKCBtb2RlbC5jb2x1bW5TdGF0ZVByb3BlcnR5LCB7XHJcbiAgICAgIGNlbnRlcjogbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIG5ldyBWZWN0b3IyKCAwLCAtMC41ICkgKSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnY29sdW1uQ29udHJvbFBhbmVsJyApXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLm5vbk1hc3NMYXllci5hZGRDaGlsZCggY29sdW1uQ29udHJvbFBhbmVsICk7XHJcblxyXG4gICAgLy8gVGhlIHBhbmVscyBzaG91bGQgZml0IGluIHRoZSBzcGFjZSB0byB0aGUgcmlnaHQgb2YgdGhlIHBsYW5rLlxyXG4gICAgY29uc3QgbWF4Q29udHJvbFBhbmVsV2lkdGggPSB0aGlzLmxheW91dEJvdW5kcy5tYXhYIC0gcGxhbmtOb2RlLmJvdW5kcy5tYXhYIC0gMjA7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBjb250cm9sIHBhbmVsIHRoYXQgd2lsbCBhbGxvdyB1c2VycyB0byBjb250cm9sIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSB2YXJpb3VzIGluZGljYXRvcnMuXHJcbiAgICBjb25zdCBzaG93UGFuZWxUYW5kZW0gPSB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnc2hvd1BhbmVsJyApO1xyXG4gICAgY29uc3QgaW5kaWNhdG9yVmlzaWJpbGl0eUNoZWNrYm94R3JvdXAgPSBuZXcgVmVydGljYWxDaGVja2JveEdyb3VwKCBbIHtcclxuICAgICAgY3JlYXRlTm9kZTogKCkgPT4gbmV3IFRleHQoIG1hc3NMYWJlbHNTdHJpbmcsIFBBTkVMX09QVElPTl9GT05UICksXHJcbiAgICAgIHByb3BlcnR5OiB0aGlzLnZpZXdQcm9wZXJ0aWVzLm1hc3NMYWJlbHNWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgIGxhYmVsOiBtYXNzTGFiZWxzU3RyaW5nLFxyXG4gICAgICB0YW5kZW1OYW1lOiAnbWFzc0xhYmVsc0NoZWNrYm94J1xyXG4gICAgfSwge1xyXG4gICAgICBjcmVhdGVOb2RlOiAoKSA9PiBuZXcgVGV4dCggZm9yY2VzRnJvbU9iamVjdHNTdHJpbmcsIFBBTkVMX09QVElPTl9GT05UICksXHJcbiAgICAgIHByb3BlcnR5OiB0aGlzLnZpZXdQcm9wZXJ0aWVzLmZvcmNlVmVjdG9yc0Zyb21PYmplY3RzVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICBsYWJlbDogZm9yY2VzRnJvbU9iamVjdHNTdHJpbmcsXHJcbiAgICAgIHRhbmRlbU5hbWU6ICdmb3JjZXNGcm9tT2JqZWN0c0NoZWNrYm94J1xyXG4gICAgfSwge1xyXG4gICAgICBjcmVhdGVOb2RlOiAoKSA9PiBuZXcgVGV4dCggbGV2ZWxTdHJpbmcsIFBBTkVMX09QVElPTl9GT05UICksXHJcbiAgICAgIHByb3BlcnR5OiB0aGlzLnZpZXdQcm9wZXJ0aWVzLmxldmVsSW5kaWNhdG9yVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICBsYWJlbDogbGV2ZWxTdHJpbmcsXHJcbiAgICAgIHRhbmRlbU5hbWU6ICdsZXZlbENoZWNrYm94J1xyXG4gICAgfVxyXG4gICAgXSwge1xyXG4gICAgICBjaGVja2JveE9wdGlvbnM6IHsgYm94V2lkdGg6IDE1IH0sXHJcbiAgICAgIHNwYWNpbmc6IDUsXHJcbiAgICAgIHRhbmRlbTogc2hvd1BhbmVsVGFuZGVtXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCB0aXRsZVRvQ29udHJvbHNWZXJ0aWNhbFNwYWNlID0gNztcclxuICAgIGNvbnN0IGluZGljYXRvclZpc2liaWxpdHlDb250cm9sc1ZCb3ggPSBuZXcgVkJveCgge1xyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIG5ldyBUZXh0KCBzaG93U3RyaW5nLCB7IGZvbnQ6IFBBTkVMX1RJVExFX0ZPTlQgfSApLFxyXG4gICAgICAgIG5ldyBWU3RydXQoIHRpdGxlVG9Db250cm9sc1ZlcnRpY2FsU3BhY2UgKSxcclxuICAgICAgICBuZXcgSEJveCggeyBjaGlsZHJlbjogWyBuZXcgSFN0cnV0KCAxMCApLCBpbmRpY2F0b3JWaXNpYmlsaXR5Q2hlY2tib3hHcm91cCBdIH0gKVxyXG4gICAgICBdLFxyXG4gICAgICBhbGlnbjogJ2xlZnQnXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBpbmRpY2F0b3JWaXNpYmlsaXR5Q29udHJvbFBhbmVsID0gbmV3IFBhbmVsKCBpbmRpY2F0b3JWaXNpYmlsaXR5Q29udHJvbHNWQm94LCB7XHJcbiAgICAgIHhNYXJnaW46IFhfTUFSR0lOX0lOX1BBTkVMUyxcclxuICAgICAgZmlsbDogJ3JnYiggMjQwLCAyNDAsIDI0MCApJyxcclxuICAgICAgdG9wOiA1LFxyXG4gICAgICByaWdodDogdGhpcy5sYXlvdXRCb3VuZHMud2lkdGggLSAxMCxcclxuICAgICAgbWF4V2lkdGg6IG1heENvbnRyb2xQYW5lbFdpZHRoXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLm5vbk1hc3NMYXllci5hZGRDaGlsZCggaW5kaWNhdG9yVmlzaWJpbGl0eUNvbnRyb2xQYW5lbCApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgY29udHJvbCBwYW5lbCB0aGF0IHdpbGwgYWxsb3cgdXNlcnMgdG8gc2VsZWN0IGJldHdlZW4gdGhlIHZhcmlvdXMgcG9zaXRpb24gbWFya2VycywgaS5lLiBydWxlciwgcG9zaXRpb25cclxuICAgIC8vIG1hcmtlcnMsIG9yIG5vdGhpbmcuXHJcbiAgICBjb25zdCBwb3NpdGlvbkNvbnRyb2xQYW5lbCA9IG5ldyBQb3NpdGlvbkluZGljYXRvckNvbnRyb2xQYW5lbCggdGhpcy52aWV3UHJvcGVydGllcy5wb3NpdGlvbk1hcmtlclN0YXRlUHJvcGVydHksIHtcclxuICAgICAgbGVmdDogaW5kaWNhdG9yVmlzaWJpbGl0eUNvbnRyb2xQYW5lbC5sZWZ0LFxyXG4gICAgICB0b3A6IGluZGljYXRvclZpc2liaWxpdHlDb250cm9sUGFuZWwuYm90dG9tICsgNSxcclxuICAgICAgbWluV2lkdGg6IGluZGljYXRvclZpc2liaWxpdHlDb250cm9sUGFuZWwud2lkdGgsXHJcbiAgICAgIG1heFdpZHRoOiBtYXhDb250cm9sUGFuZWxXaWR0aCxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAncG9zaXRpb25QYW5lbCcgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5ub25NYXNzTGF5ZXIuYWRkQ2hpbGQoIHBvc2l0aW9uQ29udHJvbFBhbmVsICk7XHJcblxyXG4gICAgLy8gQWRkIGJvdW5kcyBmb3IgdGhlIGNvbnRyb2wgcGFuZWxzIHNvIHRoYXQgZGVzY2VuZGFudCB0eXBlcyBjYW4gc2VlIHRoZW0gZm9yIGxheW91dC5cclxuICAgIHRoaXMuY29udHJvbFBhbmVsQm91bmRzID0gbmV3IEJvdW5kczIoIGluZGljYXRvclZpc2liaWxpdHlDb250cm9sUGFuZWwuYm91bmRzLm1pblgsIHBvc2l0aW9uQ29udHJvbFBhbmVsLmJvdW5kcy5taW5ZLFxyXG4gICAgICBpbmRpY2F0b3JWaXNpYmlsaXR5Q29udHJvbFBhbmVsLmJvdW5kcy5tYXhYLCBwb3NpdGlvbkNvbnRyb2xQYW5lbC5ib3VuZHMubWF4WSApO1xyXG5cclxuICAgIC8vIFJlc2V0IEFsbCBidXR0b24uXHJcbiAgICBmdW5jdGlvbiByZXNldENsb3N1cmUoKSB7XHJcbiAgICAgIHNlbGYucmVzZXQoKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm5vbk1hc3NMYXllci5hZGRDaGlsZCggbmV3IFJlc2V0QWxsQnV0dG9uKCB7XHJcbiAgICAgIGxpc3RlbmVyOiByZXNldENsb3N1cmUsXHJcbiAgICAgIHJhZGl1czogQkFTaGFyZWRDb25zdGFudHMuUkVTRVRfQUxMX0JVVFRPTl9SQURJVVMsXHJcbiAgICAgIHJpZ2h0OiBpbmRpY2F0b3JWaXNpYmlsaXR5Q29udHJvbFBhbmVsLnJpZ2h0LFxyXG4gICAgICBib3R0b206IHRoaXMubGF5b3V0Qm91bmRzLmhlaWdodCAtIDEwLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdyZXNldEFsbEJ1dHRvbicgKVxyXG4gICAgfSApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIG5vZGUgZm9yIHRoZSBwcm92aWRlZCBtYXNzLlxyXG4gICAqIEBwYXJhbSB7TWFzc30gbWFzc1xyXG4gICAqIEByZXR1cm5zIHtOb2RlfHVuZGVmaW5lZH1cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZ2V0Tm9kZUZvck1hc3MoIG1hc3MgKSB7XHJcbiAgICByZXR1cm4gdGhpcy5tYXNzZXNUb05vZGVzTWFwLmdldCggbWFzcyApO1xyXG4gIH1cclxuXHJcbiAgLy8gQHB1YmxpY1xyXG4gIHJlc2V0KCkge1xyXG4gICAgdGhpcy5tb2RlbC5yZXNldCgpO1xyXG4gICAgXy52YWx1ZXMoIHRoaXMudmlld1Byb3BlcnRpZXMgKS5mb3JFYWNoKCB2aWV3UHJvcGVydHkgPT4geyB2aWV3UHJvcGVydHkucmVzZXQoKTsgfSApO1xyXG4gIH1cclxufVxyXG5cclxuYmFsYW5jaW5nQWN0LnJlZ2lzdGVyKCAnQmFzaWNCYWxhbmNlU2NyZWVuVmlldycsIEJhc2ljQmFsYW5jZVNjcmVlblZpZXcgKTtcclxuZXhwb3J0IGRlZmF1bHQgQmFzaWNCYWxhbmNlU2NyZWVuVmlldztcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyw2QkFBNkIsTUFBTSxzREFBc0Q7QUFDaEcsT0FBT0MsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxPQUFPLE1BQU0sK0JB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