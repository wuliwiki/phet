// Copyright 2014-2022, University of Colorado Boulder

/**
 * Model for multiply game in 'Arithmetic' simulation.
 *
 * @author Andrey Zelenkov (MLearner)
 * @author John Blanco
 */

import soundManager from '../../../../tambo/js/soundManager.js';
import arithmetic from '../../arithmetic.js';
import ArithmeticModel from '../../common/model/ArithmeticModel.js';
import GameState from '../../common/model/GameState.js';
class MultiplyModel extends ArithmeticModel {
  constructor(tandem) {
    super(tandem, {
      fillEquation: () => {
        this.problemModel.productProperty.set(Number(this.inputProperty.get()));
        this.submitAnswer();
      }
    });
  }

  // @public
  setUpUnansweredProblem() {
    // get available multiplier pair
    const multiplierPair = this.selectUnusedMultiplierPair();
    if (multiplierPair) {
      // reset the problem and score properties
      this.problemModel.multiplicandProperty.reset();
      this.problemModel.multiplierProperty.reset();
      this.problemModel.productProperty.reset();
      this.problemModel.possiblePointsProperty.reset();

      // set up the problem
      this.problemModel.multiplicandProperty.set(multiplierPair.multiplicand);
      this.problemModel.multiplierProperty.set(multiplierPair.multiplier);
      return true;
    }

    // All multiplier pairs have been used, so false is returned.
    return false;
  }

  /**
   * Automatically answer most of the problems.  This is useful for testing, since it can save time when evaluating
   * how the sim behaves when a user finishes answering all questions for a level.  We need to be very careful that
   * this is never available in the published sim.
   * @override
   * @protected
   */
  autoAnswer() {
    // make sure that sound is off, since otherwise it dings for every solved problem
    const soundState = soundManager.enabled;
    soundManager.enabled = false;

    // answer the questions
    const numQuestions = this.activeLevelModel.tableSize * this.activeLevelModel.tableSize;
    const numQuestionsToAnswer = numQuestions - 1;
    console.log('Automatically answering', numQuestionsToAnswer, 'of', numQuestions, 'questions.');
    _.times(numQuestionsToAnswer, () => {
      this.problemModel.productProperty.set(this.problemModel.multiplicandProperty.get() * this.problemModel.multiplierProperty.get());
      this.activeLevelModel.currentScoreProperty.value += this.problemModel.possiblePointsProperty.get();
      this.activeLevelModel.displayScoreProperty.set(this.activeLevelModel.currentScoreProperty.get());
      this.activeLevelModel.markCellAsUsed(this.problemModel.multiplicandProperty.get(), this.problemModel.multiplierProperty.get());
      this.stateProperty.set(GameState.DISPLAYING_CORRECT_ANSWER_FEEDBACK);
      this.nextProblem();
    });

    // restore the original sound state
    soundManager.enabled = soundState;
  }
}
arithmetic.register('MultiplyModel', MultiplyModel);
export default MultiplyModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzb3VuZE1hbmFnZXIiLCJhcml0aG1ldGljIiwiQXJpdGhtZXRpY01vZGVsIiwiR2FtZVN0YXRlIiwiTXVsdGlwbHlNb2RlbCIsImNvbnN0cnVjdG9yIiwidGFuZGVtIiwiZmlsbEVxdWF0aW9uIiwicHJvYmxlbU1vZGVsIiwicHJvZHVjdFByb3BlcnR5Iiwic2V0IiwiTnVtYmVyIiwiaW5wdXRQcm9wZXJ0eSIsImdldCIsInN1Ym1pdEFuc3dlciIsInNldFVwVW5hbnN3ZXJlZFByb2JsZW0iLCJtdWx0aXBsaWVyUGFpciIsInNlbGVjdFVudXNlZE11bHRpcGxpZXJQYWlyIiwibXVsdGlwbGljYW5kUHJvcGVydHkiLCJyZXNldCIsIm11bHRpcGxpZXJQcm9wZXJ0eSIsInBvc3NpYmxlUG9pbnRzUHJvcGVydHkiLCJtdWx0aXBsaWNhbmQiLCJtdWx0aXBsaWVyIiwiYXV0b0Fuc3dlciIsInNvdW5kU3RhdGUiLCJlbmFibGVkIiwibnVtUXVlc3Rpb25zIiwiYWN0aXZlTGV2ZWxNb2RlbCIsInRhYmxlU2l6ZSIsIm51bVF1ZXN0aW9uc1RvQW5zd2VyIiwiY29uc29sZSIsImxvZyIsIl8iLCJ0aW1lcyIsImN1cnJlbnRTY29yZVByb3BlcnR5IiwidmFsdWUiLCJkaXNwbGF5U2NvcmVQcm9wZXJ0eSIsIm1hcmtDZWxsQXNVc2VkIiwic3RhdGVQcm9wZXJ0eSIsIkRJU1BMQVlJTkdfQ09SUkVDVF9BTlNXRVJfRkVFREJBQ0siLCJuZXh0UHJvYmxlbSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTXVsdGlwbHlNb2RlbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBNb2RlbCBmb3IgbXVsdGlwbHkgZ2FtZSBpbiAnQXJpdGhtZXRpYycgc2ltdWxhdGlvbi5cclxuICpcclxuICogQGF1dGhvciBBbmRyZXkgWmVsZW5rb3YgKE1MZWFybmVyKVxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvXHJcbiAqL1xyXG5cclxuaW1wb3J0IHNvdW5kTWFuYWdlciBmcm9tICcuLi8uLi8uLi8uLi90YW1iby9qcy9zb3VuZE1hbmFnZXIuanMnO1xyXG5pbXBvcnQgYXJpdGhtZXRpYyBmcm9tICcuLi8uLi9hcml0aG1ldGljLmpzJztcclxuaW1wb3J0IEFyaXRobWV0aWNNb2RlbCBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvQXJpdGhtZXRpY01vZGVsLmpzJztcclxuaW1wb3J0IEdhbWVTdGF0ZSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvR2FtZVN0YXRlLmpzJztcclxuXHJcbmNsYXNzIE11bHRpcGx5TW9kZWwgZXh0ZW5kcyBBcml0aG1ldGljTW9kZWwge1xyXG5cclxuICBjb25zdHJ1Y3RvciggdGFuZGVtICkge1xyXG5cclxuICAgIHN1cGVyKCB0YW5kZW0sIHtcclxuICAgICAgZmlsbEVxdWF0aW9uOiAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5wcm9ibGVtTW9kZWwucHJvZHVjdFByb3BlcnR5LnNldCggTnVtYmVyKCB0aGlzLmlucHV0UHJvcGVydHkuZ2V0KCkgKSApO1xyXG4gICAgICAgIHRoaXMuc3VibWl0QW5zd2VyKCk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8vIEBwdWJsaWNcclxuICBzZXRVcFVuYW5zd2VyZWRQcm9ibGVtKCkge1xyXG5cclxuICAgIC8vIGdldCBhdmFpbGFibGUgbXVsdGlwbGllciBwYWlyXHJcbiAgICBjb25zdCBtdWx0aXBsaWVyUGFpciA9IHRoaXMuc2VsZWN0VW51c2VkTXVsdGlwbGllclBhaXIoKTtcclxuXHJcbiAgICBpZiAoIG11bHRpcGxpZXJQYWlyICkge1xyXG5cclxuICAgICAgLy8gcmVzZXQgdGhlIHByb2JsZW0gYW5kIHNjb3JlIHByb3BlcnRpZXNcclxuICAgICAgdGhpcy5wcm9ibGVtTW9kZWwubXVsdGlwbGljYW5kUHJvcGVydHkucmVzZXQoKTtcclxuICAgICAgdGhpcy5wcm9ibGVtTW9kZWwubXVsdGlwbGllclByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICAgIHRoaXMucHJvYmxlbU1vZGVsLnByb2R1Y3RQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgICB0aGlzLnByb2JsZW1Nb2RlbC5wb3NzaWJsZVBvaW50c1Byb3BlcnR5LnJlc2V0KCk7XHJcblxyXG4gICAgICAvLyBzZXQgdXAgdGhlIHByb2JsZW1cclxuICAgICAgdGhpcy5wcm9ibGVtTW9kZWwubXVsdGlwbGljYW5kUHJvcGVydHkuc2V0KCBtdWx0aXBsaWVyUGFpci5tdWx0aXBsaWNhbmQgKTtcclxuICAgICAgdGhpcy5wcm9ibGVtTW9kZWwubXVsdGlwbGllclByb3BlcnR5LnNldCggbXVsdGlwbGllclBhaXIubXVsdGlwbGllciApO1xyXG5cclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQWxsIG11bHRpcGxpZXIgcGFpcnMgaGF2ZSBiZWVuIHVzZWQsIHNvIGZhbHNlIGlzIHJldHVybmVkLlxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQXV0b21hdGljYWxseSBhbnN3ZXIgbW9zdCBvZiB0aGUgcHJvYmxlbXMuICBUaGlzIGlzIHVzZWZ1bCBmb3IgdGVzdGluZywgc2luY2UgaXQgY2FuIHNhdmUgdGltZSB3aGVuIGV2YWx1YXRpbmdcclxuICAgKiBob3cgdGhlIHNpbSBiZWhhdmVzIHdoZW4gYSB1c2VyIGZpbmlzaGVzIGFuc3dlcmluZyBhbGwgcXVlc3Rpb25zIGZvciBhIGxldmVsLiAgV2UgbmVlZCB0byBiZSB2ZXJ5IGNhcmVmdWwgdGhhdFxyXG4gICAqIHRoaXMgaXMgbmV2ZXIgYXZhaWxhYmxlIGluIHRoZSBwdWJsaXNoZWQgc2ltLlxyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqIEBwcm90ZWN0ZWRcclxuICAgKi9cclxuICBhdXRvQW5zd2VyKCkge1xyXG5cclxuICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHNvdW5kIGlzIG9mZiwgc2luY2Ugb3RoZXJ3aXNlIGl0IGRpbmdzIGZvciBldmVyeSBzb2x2ZWQgcHJvYmxlbVxyXG4gICAgY29uc3Qgc291bmRTdGF0ZSA9IHNvdW5kTWFuYWdlci5lbmFibGVkO1xyXG4gICAgc291bmRNYW5hZ2VyLmVuYWJsZWQgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBhbnN3ZXIgdGhlIHF1ZXN0aW9uc1xyXG4gICAgY29uc3QgbnVtUXVlc3Rpb25zID0gdGhpcy5hY3RpdmVMZXZlbE1vZGVsLnRhYmxlU2l6ZSAqIHRoaXMuYWN0aXZlTGV2ZWxNb2RlbC50YWJsZVNpemU7XHJcbiAgICBjb25zdCBudW1RdWVzdGlvbnNUb0Fuc3dlciA9IG51bVF1ZXN0aW9ucyAtIDE7XHJcbiAgICBjb25zb2xlLmxvZyggJ0F1dG9tYXRpY2FsbHkgYW5zd2VyaW5nJywgbnVtUXVlc3Rpb25zVG9BbnN3ZXIsICdvZicsIG51bVF1ZXN0aW9ucywgJ3F1ZXN0aW9ucy4nICk7XHJcbiAgICBfLnRpbWVzKCBudW1RdWVzdGlvbnNUb0Fuc3dlciwgKCkgPT4ge1xyXG4gICAgICB0aGlzLnByb2JsZW1Nb2RlbC5wcm9kdWN0UHJvcGVydHkuc2V0KFxyXG4gICAgICAgIHRoaXMucHJvYmxlbU1vZGVsLm11bHRpcGxpY2FuZFByb3BlcnR5LmdldCgpICogdGhpcy5wcm9ibGVtTW9kZWwubXVsdGlwbGllclByb3BlcnR5LmdldCgpXHJcbiAgICAgICk7XHJcbiAgICAgIHRoaXMuYWN0aXZlTGV2ZWxNb2RlbC5jdXJyZW50U2NvcmVQcm9wZXJ0eS52YWx1ZSArPSB0aGlzLnByb2JsZW1Nb2RlbC5wb3NzaWJsZVBvaW50c1Byb3BlcnR5LmdldCgpO1xyXG4gICAgICB0aGlzLmFjdGl2ZUxldmVsTW9kZWwuZGlzcGxheVNjb3JlUHJvcGVydHkuc2V0KCB0aGlzLmFjdGl2ZUxldmVsTW9kZWwuY3VycmVudFNjb3JlUHJvcGVydHkuZ2V0KCkgKTtcclxuICAgICAgdGhpcy5hY3RpdmVMZXZlbE1vZGVsLm1hcmtDZWxsQXNVc2VkKFxyXG4gICAgICAgIHRoaXMucHJvYmxlbU1vZGVsLm11bHRpcGxpY2FuZFByb3BlcnR5LmdldCgpLFxyXG4gICAgICAgIHRoaXMucHJvYmxlbU1vZGVsLm11bHRpcGxpZXJQcm9wZXJ0eS5nZXQoKVxyXG4gICAgICApO1xyXG4gICAgICB0aGlzLnN0YXRlUHJvcGVydHkuc2V0KCBHYW1lU3RhdGUuRElTUExBWUlOR19DT1JSRUNUX0FOU1dFUl9GRUVEQkFDSyApO1xyXG4gICAgICB0aGlzLm5leHRQcm9ibGVtKCk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gcmVzdG9yZSB0aGUgb3JpZ2luYWwgc291bmQgc3RhdGVcclxuICAgIHNvdW5kTWFuYWdlci5lbmFibGVkID0gc291bmRTdGF0ZTtcclxuICB9XHJcbn1cclxuXHJcbmFyaXRobWV0aWMucmVnaXN0ZXIoICdNdWx0aXBseU1vZGVsJywgTXVsdGlwbHlNb2RlbCApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgTXVsdGlwbHlNb2RlbDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxZQUFZLE1BQU0sc0NBQXNDO0FBQy9ELE9BQU9DLFVBQVUsTUFBTSxxQkFBcUI7QUFDNUMsT0FBT0MsZUFBZSxNQUFNLHVDQUF1QztBQUNuRSxPQUFPQyxTQUFTLE1BQU0saUNBQWlDO0FBRXZELE1BQU1DLGFBQWEsU0FBU0YsZUFBZSxDQUFDO0VBRTFDRyxXQUFXQSxDQUFFQyxNQUFNLEVBQUc7SUFFcEIsS0FBSyxDQUFFQSxNQUFNLEVBQUU7TUFDYkMsWUFBWSxFQUFFQSxDQUFBLEtBQU07UUFDbEIsSUFBSSxDQUFDQyxZQUFZLENBQUNDLGVBQWUsQ0FBQ0MsR0FBRyxDQUFFQyxNQUFNLENBQUUsSUFBSSxDQUFDQyxhQUFhLENBQUNDLEdBQUcsQ0FBQyxDQUFFLENBQUUsQ0FBQztRQUMzRSxJQUFJLENBQUNDLFlBQVksQ0FBQyxDQUFDO01BQ3JCO0lBQ0YsQ0FBRSxDQUFDO0VBQ0w7O0VBRUE7RUFD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