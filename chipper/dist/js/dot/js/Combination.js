// Copyright 2022, University of Colorado Boulder

/**
 * An immutable combination that represents a subset of a set
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import dot from './dot.js';
class Combination {
  /**
   * Creates a combination that will include elements where list[i] === true
   */
  constructor(inclusions) {
    this.inclusions = inclusions;
  }
  size() {
    return this.inclusions.length;
  }
  includes(index) {
    return this.inclusions[index];
  }

  /**
   * Applies the combination to an array, returning a new array with the used elements.
   */
  apply(array) {
    return array.filter((element, index) => this.inclusions[index]);
  }

  /**
   * Creates a new combination that is the inverse of this (includes the opposite elements)
   */
  inverted() {
    return new Combination(this.inclusions.map(inclusion => !inclusion));
  }
  getIncludedIndices() {
    return _.range(0, this.size()).filter(i => this.inclusions[i]);
  }
  toString() {
    return `C[${this.inclusions.map(i => i ? '1' : '0').join('')}]`;
  }
  equals(combination) {
    return this.inclusions.length === combination.inclusions.length && _.isEqual(this.inclusions, combination.inclusions);
  }

  /**
   * Creates an empty combination of a given size.
   */
  static empty(size) {
    return new Combination(_.range(0, size).map(() => false));
  }

  /**
   * Creates a full combination of a given size.
   */
  static full(size) {
    return new Combination(_.range(0, size).map(() => true));
  }

  /**
   * Lists all combinations from a given size
   */
  static combinations(size) {
    const combinations = [];
    const stack = [];
    (function recurse(index) {
      if (index === size) {
        combinations.push(new Combination(stack.slice()));
      } else {
        stack.push(false);
        recurse(index + 1);
        stack.pop();
        stack.push(true);
        recurse(index + 1);
        stack.pop();
      }
    })(0);
    return combinations;
  }

  /**
   * Calls a callback on every single possible permutation of the given Array
   *
   * @param array
   * @param callback - Called on each permuted version of the array possible
   */
  static forEachCombination(array, callback) {
    const stack = [];
    (function recurse(index) {
      if (index === array.length) {
        callback(stack);
      } else {
        recurse(index + 1);
        stack.push(array[index]);
        recurse(index + 1);
        stack.pop();
      }
    })(0);
  }
  static combinationsOf(array) {
    const results = [];
    Combination.forEachCombination(array, result => {
      results.push(result.slice());
    });
    return results;
  }
}
dot.register('Combination', Combination);
export default Combination;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3QiLCJDb21iaW5hdGlvbiIsImNvbnN0cnVjdG9yIiwiaW5jbHVzaW9ucyIsInNpemUiLCJsZW5ndGgiLCJpbmNsdWRlcyIsImluZGV4IiwiYXBwbHkiLCJhcnJheSIsImZpbHRlciIsImVsZW1lbnQiLCJpbnZlcnRlZCIsIm1hcCIsImluY2x1c2lvbiIsImdldEluY2x1ZGVkSW5kaWNlcyIsIl8iLCJyYW5nZSIsImkiLCJ0b1N0cmluZyIsImpvaW4iLCJlcXVhbHMiLCJjb21iaW5hdGlvbiIsImlzRXF1YWwiLCJlbXB0eSIsImZ1bGwiLCJjb21iaW5hdGlvbnMiLCJzdGFjayIsInJlY3Vyc2UiLCJwdXNoIiwic2xpY2UiLCJwb3AiLCJmb3JFYWNoQ29tYmluYXRpb24iLCJjYWxsYmFjayIsImNvbWJpbmF0aW9uc09mIiwicmVzdWx0cyIsInJlc3VsdCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQ29tYmluYXRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEFuIGltbXV0YWJsZSBjb21iaW5hdGlvbiB0aGF0IHJlcHJlc2VudHMgYSBzdWJzZXQgb2YgYSBzZXRcclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBkb3QgZnJvbSAnLi9kb3QuanMnO1xyXG5cclxuY2xhc3MgQ29tYmluYXRpb24ge1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgaW5jbHVzaW9uczogYm9vbGVhbltdO1xyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgY29tYmluYXRpb24gdGhhdCB3aWxsIGluY2x1ZGUgZWxlbWVudHMgd2hlcmUgbGlzdFtpXSA9PT0gdHJ1ZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggaW5jbHVzaW9uczogYm9vbGVhbltdICkge1xyXG4gICAgdGhpcy5pbmNsdXNpb25zID0gaW5jbHVzaW9ucztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzaXplKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5pbmNsdXNpb25zLmxlbmd0aDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBpbmNsdWRlcyggaW5kZXg6IG51bWJlciApOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmluY2x1c2lvbnNbIGluZGV4IF07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBcHBsaWVzIHRoZSBjb21iaW5hdGlvbiB0byBhbiBhcnJheSwgcmV0dXJuaW5nIGEgbmV3IGFycmF5IHdpdGggdGhlIHVzZWQgZWxlbWVudHMuXHJcbiAgICovXHJcbiAgcHVibGljIGFwcGx5PFQ+KCBhcnJheTogVFtdICk6IFRbXSB7XHJcbiAgICByZXR1cm4gYXJyYXkuZmlsdGVyKCAoIGVsZW1lbnQsIGluZGV4ICkgPT4gdGhpcy5pbmNsdXNpb25zWyBpbmRleCBdICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgbmV3IGNvbWJpbmF0aW9uIHRoYXQgaXMgdGhlIGludmVyc2Ugb2YgdGhpcyAoaW5jbHVkZXMgdGhlIG9wcG9zaXRlIGVsZW1lbnRzKVxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbnZlcnRlZCgpOiBDb21iaW5hdGlvbiB7XHJcbiAgICByZXR1cm4gbmV3IENvbWJpbmF0aW9uKCB0aGlzLmluY2x1c2lvbnMubWFwKCBpbmNsdXNpb24gPT4gIWluY2x1c2lvbiApICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0SW5jbHVkZWRJbmRpY2VzKCk6IG51bWJlcltdIHtcclxuICAgIHJldHVybiBfLnJhbmdlKCAwLCB0aGlzLnNpemUoKSApLmZpbHRlciggaSA9PiB0aGlzLmluY2x1c2lvbnNbIGkgXSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gYENbJHt0aGlzLmluY2x1c2lvbnMubWFwKCBpID0+IGkgPyAnMScgOiAnMCcgKS5qb2luKCAnJyApfV1gO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGVxdWFscyggY29tYmluYXRpb246IENvbWJpbmF0aW9uICk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5jbHVzaW9ucy5sZW5ndGggPT09IGNvbWJpbmF0aW9uLmluY2x1c2lvbnMubGVuZ3RoICYmIF8uaXNFcXVhbCggdGhpcy5pbmNsdXNpb25zLCBjb21iaW5hdGlvbi5pbmNsdXNpb25zICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGFuIGVtcHR5IGNvbWJpbmF0aW9uIG9mIGEgZ2l2ZW4gc2l6ZS5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGVtcHR5KCBzaXplOiBudW1iZXIgKTogQ29tYmluYXRpb24ge1xyXG4gICAgcmV0dXJuIG5ldyBDb21iaW5hdGlvbiggXy5yYW5nZSggMCwgc2l6ZSApLm1hcCggKCkgPT4gZmFsc2UgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhIGZ1bGwgY29tYmluYXRpb24gb2YgYSBnaXZlbiBzaXplLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgZnVsbCggc2l6ZTogbnVtYmVyICk6IENvbWJpbmF0aW9uIHtcclxuICAgIHJldHVybiBuZXcgQ29tYmluYXRpb24oIF8ucmFuZ2UoIDAsIHNpemUgKS5tYXAoICgpID0+IHRydWUgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTGlzdHMgYWxsIGNvbWJpbmF0aW9ucyBmcm9tIGEgZ2l2ZW4gc2l6ZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY29tYmluYXRpb25zKCBzaXplOiBudW1iZXIgKTogQ29tYmluYXRpb25bXSB7XHJcblxyXG4gICAgY29uc3QgY29tYmluYXRpb25zOiBDb21iaW5hdGlvbltdID0gW107XHJcbiAgICBjb25zdCBzdGFjazogYm9vbGVhbltdID0gW107XHJcblxyXG4gICAgKCBmdW5jdGlvbiByZWN1cnNlKCBpbmRleDogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgICBpZiAoIGluZGV4ID09PSBzaXplICkge1xyXG4gICAgICAgIGNvbWJpbmF0aW9ucy5wdXNoKCBuZXcgQ29tYmluYXRpb24oIHN0YWNrLnNsaWNlKCkgKSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHN0YWNrLnB1c2goIGZhbHNlICk7XHJcbiAgICAgICAgcmVjdXJzZSggaW5kZXggKyAxICk7XHJcbiAgICAgICAgc3RhY2sucG9wKCk7XHJcbiAgICAgICAgc3RhY2sucHVzaCggdHJ1ZSApO1xyXG4gICAgICAgIHJlY3Vyc2UoIGluZGV4ICsgMSApO1xyXG4gICAgICAgIHN0YWNrLnBvcCgpO1xyXG4gICAgICB9XHJcbiAgICB9ICkoIDAgKTtcclxuXHJcbiAgICByZXR1cm4gY29tYmluYXRpb25zO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FsbHMgYSBjYWxsYmFjayBvbiBldmVyeSBzaW5nbGUgcG9zc2libGUgcGVybXV0YXRpb24gb2YgdGhlIGdpdmVuIEFycmF5XHJcbiAgICpcclxuICAgKiBAcGFyYW0gYXJyYXlcclxuICAgKiBAcGFyYW0gY2FsbGJhY2sgLSBDYWxsZWQgb24gZWFjaCBwZXJtdXRlZCB2ZXJzaW9uIG9mIHRoZSBhcnJheSBwb3NzaWJsZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgZm9yRWFjaENvbWJpbmF0aW9uPFQ+KCBhcnJheTogVFtdLCBjYWxsYmFjazogKCBhcnJheTogcmVhZG9ubHkgVFtdICkgPT4gdm9pZCApOiB2b2lkIHtcclxuICAgIGNvbnN0IHN0YWNrOiBUW10gPSBbXTtcclxuXHJcbiAgICAoIGZ1bmN0aW9uIHJlY3Vyc2UoIGluZGV4OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICAgIGlmICggaW5kZXggPT09IGFycmF5Lmxlbmd0aCApIHtcclxuICAgICAgICBjYWxsYmFjayggc3RhY2sgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZWN1cnNlKCBpbmRleCArIDEgKTtcclxuICAgICAgICBzdGFjay5wdXNoKCBhcnJheVsgaW5kZXggXSApO1xyXG4gICAgICAgIHJlY3Vyc2UoIGluZGV4ICsgMSApO1xyXG4gICAgICAgIHN0YWNrLnBvcCgpO1xyXG4gICAgICB9XHJcbiAgICB9ICkoIDAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgY29tYmluYXRpb25zT2Y8VD4oIGFycmF5OiBUW10gKTogVFtdW10ge1xyXG4gICAgY29uc3QgcmVzdWx0czogVFtdW10gPSBbXTtcclxuICAgIENvbWJpbmF0aW9uLmZvckVhY2hDb21iaW5hdGlvbiggYXJyYXksIHJlc3VsdCA9PiB7XHJcbiAgICAgIHJlc3VsdHMucHVzaCggcmVzdWx0LnNsaWNlKCkgKTtcclxuICAgIH0gKTtcclxuICAgIHJldHVybiByZXN1bHRzO1xyXG4gIH1cclxufVxyXG5cclxuZG90LnJlZ2lzdGVyKCAnQ29tYmluYXRpb24nLCBDb21iaW5hdGlvbiApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgQ29tYmluYXRpb247Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEdBQUcsTUFBTSxVQUFVO0FBRTFCLE1BQU1DLFdBQVcsQ0FBQztFQUloQjtBQUNGO0FBQ0E7RUFDU0MsV0FBV0EsQ0FBRUMsVUFBcUIsRUFBRztJQUMxQyxJQUFJLENBQUNBLFVBQVUsR0FBR0EsVUFBVTtFQUM5QjtFQUVPQyxJQUFJQSxDQUFBLEVBQVc7SUFDcEIsT0FBTyxJQUFJLENBQUNELFVBQVUsQ0FBQ0UsTUFBTTtFQUMvQjtFQUVPQyxRQUFRQSxDQUFFQyxLQUFhLEVBQVk7SUFDeEMsT0FBTyxJQUFJLENBQUNKLFVBQVUsQ0FBRUksS0FBSyxDQUFFO0VBQ2pDOztFQUVBO0FBQ0Y7QUFDQTtFQUNTQyxLQUFLQSxDQUFLQyxLQUFVLEVBQVE7SUFD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