// Copyright 2013-2022, University of Colorado Boulder

/**
 * QR decomposition, based on Jama (http://math.nist.gov/javanumerics/jama/)
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import dot from './dot.js';
import Matrix from './Matrix.js';
const ArrayType = window.Float64Array || Array;
class QRDecomposition {
  /**
   * @param {Matrix} matrix
   */
  constructor(matrix) {
    this.matrix = matrix;

    // TODO: size!
    this.QR = matrix.getArrayCopy();
    const QR = this.QR;
    this.m = matrix.getRowDimension();
    const m = this.m;
    this.n = matrix.getColumnDimension();
    const n = this.n;
    this.Rdiag = new ArrayType(n);
    let i;
    let j;
    let k;

    // Main loop.
    for (k = 0; k < n; k++) {
      // Compute 2-norm of k-th column without under/overflow.
      let nrm = 0;
      for (i = k; i < m; i++) {
        nrm = Matrix.hypot(nrm, QR[this.matrix.index(i, k)]);
      }
      if (nrm !== 0.0) {
        // Form k-th Householder vector.
        if (QR[this.matrix.index(k, k)] < 0) {
          nrm = -nrm;
        }
        for (i = k; i < m; i++) {
          QR[this.matrix.index(i, k)] /= nrm;
        }
        QR[this.matrix.index(k, k)] += 1.0;

        // Apply transformation to remaining columns.
        for (j = k + 1; j < n; j++) {
          let s = 0.0;
          for (i = k; i < m; i++) {
            s += QR[this.matrix.index(i, k)] * QR[this.matrix.index(i, j)];
          }
          s = -s / QR[this.matrix.index(k, k)];
          for (i = k; i < m; i++) {
            QR[this.matrix.index(i, j)] += s * QR[this.matrix.index(i, k)];
          }
        }
      }
      this.Rdiag[k] = -nrm;
    }
  }

  /**
   * @public
   *
   * @returns {boolean}
   */
  isFullRank() {
    for (let j = 0; j < this.n; j++) {
      if (this.Rdiag[j] === 0) {
        return false;
      }
    }
    return true;
  }

  /**
   * @public
   *
   * @returns {Matrix}
   */
  getH() {
    const result = new Matrix(this.m, this.n);
    for (let i = 0; i < this.m; i++) {
      for (let j = 0; j < this.n; j++) {
        if (i >= j) {
          result.entries[result.index(i, j)] = this.QR[this.matrix.index(i, j)];
        } else {
          result.entries[result.index(i, j)] = 0.0;
        }
      }
    }
    return result;
  }

  /**
   * @public
   *
   * @returns {Matrix}
   */
  getR() {
    const result = new Matrix(this.n, this.n);
    for (let i = 0; i < this.n; i++) {
      for (let j = 0; j < this.n; j++) {
        if (i < j) {
          result.entries[result.index(i, j)] = this.QR[this.matrix.index(i, j)];
        } else if (i === j) {
          result.entries[result.index(i, j)] = this.Rdiag[i];
        } else {
          result.entries[result.index(i, j)] = 0.0;
        }
      }
    }
    return result;
  }

  /**
   * @public
   *
   * @returns {Matrix}
   */
  getQ() {
    let i;
    let j;
    let k;
    const result = new Matrix(this.m, this.n);
    for (k = this.n - 1; k >= 0; k--) {
      for (i = 0; i < this.m; i++) {
        result.entries[result.index(i, k)] = 0.0;
      }
      result.entries[result.index(k, k)] = 1.0;
      for (j = k; j < this.n; j++) {
        if (this.QR[this.matrix.index(k, k)] !== 0) {
          let s = 0.0;
          for (i = k; i < this.m; i++) {
            s += this.QR[this.matrix.index(i, k)] * result.entries[result.index(i, j)];
          }
          s = -s / this.QR[this.matrix.index(k, k)];
          for (i = k; i < this.m; i++) {
            result.entries[result.index(i, j)] += s * this.QR[this.matrix.index(i, k)];
          }
        }
      }
    }
    return result;
  }

  /**
   * @public
   *
   * @param {Matrix} matrix
   * @returns {Matrix}
   */
  solve(matrix) {
    if (matrix.getRowDimension() !== this.m) {
      throw new Error('Matrix row dimensions must agree.');
    }
    if (!this.isFullRank()) {
      throw new Error('Matrix is rank deficient.');
    }
    let i;
    let j;
    let k;

    // Copy right hand side
    const nx = matrix.getColumnDimension();
    const X = matrix.getArrayCopy();

    // Compute Y = transpose(Q)*matrix
    for (k = 0; k < this.n; k++) {
      for (j = 0; j < nx; j++) {
        let s = 0.0;
        for (i = k; i < this.m; i++) {
          s += this.QR[this.matrix.index(i, k)] * X[matrix.index(i, j)];
        }
        s = -s / this.QR[this.matrix.index(k, k)];
        for (i = k; i < this.m; i++) {
          X[matrix.index(i, j)] += s * this.QR[this.matrix.index(i, k)];
        }
      }
    }

    // Solve R*X = Y;
    for (k = this.n - 1; k >= 0; k--) {
      for (j = 0; j < nx; j++) {
        X[matrix.index(k, j)] /= this.Rdiag[k];
      }
      for (i = 0; i < k; i++) {
        for (j = 0; j < nx; j++) {
          X[matrix.index(i, j)] -= X[matrix.index(k, j)] * this.QR[this.matrix.index(i, k)];
        }
      }
    }
    return new Matrix(this.n, nx, X, true).getMatrix(0, this.n - 1, 0, nx - 1);
  }
}
dot.register('QRDecomposition', QRDecomposition);
export default QRDecomposition;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3QiLCJNYXRyaXgiLCJBcnJheVR5cGUiLCJ3aW5kb3ciLCJGbG9hdDY0QXJyYXkiLCJBcnJheSIsIlFSRGVjb21wb3NpdGlvbiIsImNvbnN0cnVjdG9yIiwibWF0cml4IiwiUVIiLCJnZXRBcnJheUNvcHkiLCJtIiwiZ2V0Um93RGltZW5zaW9uIiwibiIsImdldENvbHVtbkRpbWVuc2lvbiIsIlJkaWFnIiwiaSIsImoiLCJrIiwibnJtIiwiaHlwb3QiLCJpbmRleCIsInMiLCJpc0Z1bGxSYW5rIiwiZ2V0SCIsInJlc3VsdCIsImVudHJpZXMiLCJnZXRSIiwiZ2V0USIsInNvbHZlIiwiRXJyb3IiLCJueCIsIlgiLCJnZXRNYXRyaXgiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlFSRGVjb21wb3NpdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxMy0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBRUiBkZWNvbXBvc2l0aW9uLCBiYXNlZCBvbiBKYW1hIChodHRwOi8vbWF0aC5uaXN0Lmdvdi9qYXZhbnVtZXJpY3MvamFtYS8pXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgZG90IGZyb20gJy4vZG90LmpzJztcclxuaW1wb3J0IE1hdHJpeCBmcm9tICcuL01hdHJpeC5qcyc7XHJcblxyXG5jb25zdCBBcnJheVR5cGUgPSB3aW5kb3cuRmxvYXQ2NEFycmF5IHx8IEFycmF5O1xyXG5cclxuY2xhc3MgUVJEZWNvbXBvc2l0aW9uIHtcclxuICAvKipcclxuICAgKiBAcGFyYW0ge01hdHJpeH0gbWF0cml4XHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1hdHJpeCApIHtcclxuICAgIHRoaXMubWF0cml4ID0gbWF0cml4O1xyXG5cclxuICAgIC8vIFRPRE86IHNpemUhXHJcbiAgICB0aGlzLlFSID0gbWF0cml4LmdldEFycmF5Q29weSgpO1xyXG4gICAgY29uc3QgUVIgPSB0aGlzLlFSO1xyXG4gICAgdGhpcy5tID0gbWF0cml4LmdldFJvd0RpbWVuc2lvbigpO1xyXG4gICAgY29uc3QgbSA9IHRoaXMubTtcclxuICAgIHRoaXMubiA9IG1hdHJpeC5nZXRDb2x1bW5EaW1lbnNpb24oKTtcclxuICAgIGNvbnN0IG4gPSB0aGlzLm47XHJcblxyXG4gICAgdGhpcy5SZGlhZyA9IG5ldyBBcnJheVR5cGUoIG4gKTtcclxuXHJcbiAgICBsZXQgaTtcclxuICAgIGxldCBqO1xyXG4gICAgbGV0IGs7XHJcblxyXG4gICAgLy8gTWFpbiBsb29wLlxyXG4gICAgZm9yICggayA9IDA7IGsgPCBuOyBrKysgKSB7XHJcbiAgICAgIC8vIENvbXB1dGUgMi1ub3JtIG9mIGstdGggY29sdW1uIHdpdGhvdXQgdW5kZXIvb3ZlcmZsb3cuXHJcbiAgICAgIGxldCBucm0gPSAwO1xyXG4gICAgICBmb3IgKCBpID0gazsgaSA8IG07IGkrKyApIHtcclxuICAgICAgICBucm0gPSBNYXRyaXguaHlwb3QoIG5ybSwgUVJbIHRoaXMubWF0cml4LmluZGV4KCBpLCBrICkgXSApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIG5ybSAhPT0gMC4wICkge1xyXG4gICAgICAgIC8vIEZvcm0gay10aCBIb3VzZWhvbGRlciB2ZWN0b3IuXHJcbiAgICAgICAgaWYgKCBRUlsgdGhpcy5tYXRyaXguaW5kZXgoIGssIGsgKSBdIDwgMCApIHtcclxuICAgICAgICAgIG5ybSA9IC1ucm07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoIGkgPSBrOyBpIDwgbTsgaSsrICkge1xyXG4gICAgICAgICAgUVJbIHRoaXMubWF0cml4LmluZGV4KCBpLCBrICkgXSAvPSBucm07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFFSWyB0aGlzLm1hdHJpeC5pbmRleCggaywgayApIF0gKz0gMS4wO1xyXG5cclxuICAgICAgICAvLyBBcHBseSB0cmFuc2Zvcm1hdGlvbiB0byByZW1haW5pbmcgY29sdW1ucy5cclxuICAgICAgICBmb3IgKCBqID0gayArIDE7IGogPCBuOyBqKysgKSB7XHJcbiAgICAgICAgICBsZXQgcyA9IDAuMDtcclxuICAgICAgICAgIGZvciAoIGkgPSBrOyBpIDwgbTsgaSsrICkge1xyXG4gICAgICAgICAgICBzICs9IFFSWyB0aGlzLm1hdHJpeC5pbmRleCggaSwgayApIF0gKiBRUlsgdGhpcy5tYXRyaXguaW5kZXgoIGksIGogKSBdO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcyA9IC1zIC8gUVJbIHRoaXMubWF0cml4LmluZGV4KCBrLCBrICkgXTtcclxuICAgICAgICAgIGZvciAoIGkgPSBrOyBpIDwgbTsgaSsrICkge1xyXG4gICAgICAgICAgICBRUlsgdGhpcy5tYXRyaXguaW5kZXgoIGksIGogKSBdICs9IHMgKiBRUlsgdGhpcy5tYXRyaXguaW5kZXgoIGksIGsgKSBdO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICB0aGlzLlJkaWFnWyBrIF0gPSAtbnJtO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAgICovXHJcbiAgaXNGdWxsUmFuaygpIHtcclxuICAgIGZvciAoIGxldCBqID0gMDsgaiA8IHRoaXMubjsgaisrICkge1xyXG4gICAgICBpZiAoIHRoaXMuUmRpYWdbIGogXSA9PT0gMCApIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHJldHVybnMge01hdHJpeH1cclxuICAgKi9cclxuICBnZXRIKCkge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IE1hdHJpeCggdGhpcy5tLCB0aGlzLm4gKTtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMubTsgaSsrICkge1xyXG4gICAgICBmb3IgKCBsZXQgaiA9IDA7IGogPCB0aGlzLm47IGorKyApIHtcclxuICAgICAgICBpZiAoIGkgPj0gaiApIHtcclxuICAgICAgICAgIHJlc3VsdC5lbnRyaWVzWyByZXN1bHQuaW5kZXgoIGksIGogKSBdID0gdGhpcy5RUlsgdGhpcy5tYXRyaXguaW5kZXgoIGksIGogKSBdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHJlc3VsdC5lbnRyaWVzWyByZXN1bHQuaW5kZXgoIGksIGogKSBdID0gMC4wO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEByZXR1cm5zIHtNYXRyaXh9XHJcbiAgICovXHJcbiAgZ2V0UigpIHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBNYXRyaXgoIHRoaXMubiwgdGhpcy5uICk7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLm47IGkrKyApIHtcclxuICAgICAgZm9yICggbGV0IGogPSAwOyBqIDwgdGhpcy5uOyBqKysgKSB7XHJcbiAgICAgICAgaWYgKCBpIDwgaiApIHtcclxuICAgICAgICAgIHJlc3VsdC5lbnRyaWVzWyByZXN1bHQuaW5kZXgoIGksIGogKSBdID0gdGhpcy5RUlsgdGhpcy5tYXRyaXguaW5kZXgoIGksIGogKSBdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICggaSA9PT0gaiApIHtcclxuICAgICAgICAgIHJlc3VsdC5lbnRyaWVzWyByZXN1bHQuaW5kZXgoIGksIGogKSBdID0gdGhpcy5SZGlhZ1sgaSBdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHJlc3VsdC5lbnRyaWVzWyByZXN1bHQuaW5kZXgoIGksIGogKSBdID0gMC4wO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEByZXR1cm5zIHtNYXRyaXh9XHJcbiAgICovXHJcbiAgZ2V0USgpIHtcclxuICAgIGxldCBpO1xyXG4gICAgbGV0IGo7XHJcbiAgICBsZXQgaztcclxuICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBNYXRyaXgoIHRoaXMubSwgdGhpcy5uICk7XHJcbiAgICBmb3IgKCBrID0gdGhpcy5uIC0gMTsgayA+PSAwOyBrLS0gKSB7XHJcbiAgICAgIGZvciAoIGkgPSAwOyBpIDwgdGhpcy5tOyBpKysgKSB7XHJcbiAgICAgICAgcmVzdWx0LmVudHJpZXNbIHJlc3VsdC5pbmRleCggaSwgayApIF0gPSAwLjA7XHJcbiAgICAgIH1cclxuICAgICAgcmVzdWx0LmVudHJpZXNbIHJlc3VsdC5pbmRleCggaywgayApIF0gPSAxLjA7XHJcbiAgICAgIGZvciAoIGogPSBrOyBqIDwgdGhpcy5uOyBqKysgKSB7XHJcbiAgICAgICAgaWYgKCB0aGlzLlFSWyB0aGlzLm1hdHJpeC5pbmRleCggaywgayApIF0gIT09IDAgKSB7XHJcbiAgICAgICAgICBsZXQgcyA9IDAuMDtcclxuICAgICAgICAgIGZvciAoIGkgPSBrOyBpIDwgdGhpcy5tOyBpKysgKSB7XHJcbiAgICAgICAgICAgIHMgKz0gdGhpcy5RUlsgdGhpcy5tYXRyaXguaW5kZXgoIGksIGsgKSBdICogcmVzdWx0LmVudHJpZXNbIHJlc3VsdC5pbmRleCggaSwgaiApIF07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzID0gLXMgLyB0aGlzLlFSWyB0aGlzLm1hdHJpeC5pbmRleCggaywgayApIF07XHJcbiAgICAgICAgICBmb3IgKCBpID0gazsgaSA8IHRoaXMubTsgaSsrICkge1xyXG4gICAgICAgICAgICByZXN1bHQuZW50cmllc1sgcmVzdWx0LmluZGV4KCBpLCBqICkgXSArPSBzICogdGhpcy5RUlsgdGhpcy5tYXRyaXguaW5kZXgoIGksIGsgKSBdO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7TWF0cml4fSBtYXRyaXhcclxuICAgKiBAcmV0dXJucyB7TWF0cml4fVxyXG4gICAqL1xyXG4gIHNvbHZlKCBtYXRyaXggKSB7XHJcbiAgICBpZiAoIG1hdHJpeC5nZXRSb3dEaW1lbnNpb24oKSAhPT0gdGhpcy5tICkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoICdNYXRyaXggcm93IGRpbWVuc2lvbnMgbXVzdCBhZ3JlZS4nICk7XHJcbiAgICB9XHJcbiAgICBpZiAoICF0aGlzLmlzRnVsbFJhbmsoKSApIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCAnTWF0cml4IGlzIHJhbmsgZGVmaWNpZW50LicgKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgaTtcclxuICAgIGxldCBqO1xyXG4gICAgbGV0IGs7XHJcblxyXG4gICAgLy8gQ29weSByaWdodCBoYW5kIHNpZGVcclxuICAgIGNvbnN0IG54ID0gbWF0cml4LmdldENvbHVtbkRpbWVuc2lvbigpO1xyXG4gICAgY29uc3QgWCA9IG1hdHJpeC5nZXRBcnJheUNvcHkoKTtcclxuXHJcbiAgICAvLyBDb21wdXRlIFkgPSB0cmFuc3Bvc2UoUSkqbWF0cml4XHJcbiAgICBmb3IgKCBrID0gMDsgayA8IHRoaXMubjsgaysrICkge1xyXG4gICAgICBmb3IgKCBqID0gMDsgaiA8IG54OyBqKysgKSB7XHJcbiAgICAgICAgbGV0IHMgPSAwLjA7XHJcbiAgICAgICAgZm9yICggaSA9IGs7IGkgPCB0aGlzLm07IGkrKyApIHtcclxuICAgICAgICAgIHMgKz0gdGhpcy5RUlsgdGhpcy5tYXRyaXguaW5kZXgoIGksIGsgKSBdICogWFsgbWF0cml4LmluZGV4KCBpLCBqICkgXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcyA9IC1zIC8gdGhpcy5RUlsgdGhpcy5tYXRyaXguaW5kZXgoIGssIGsgKSBdO1xyXG4gICAgICAgIGZvciAoIGkgPSBrOyBpIDwgdGhpcy5tOyBpKysgKSB7XHJcbiAgICAgICAgICBYWyBtYXRyaXguaW5kZXgoIGksIGogKSBdICs9IHMgKiB0aGlzLlFSWyB0aGlzLm1hdHJpeC5pbmRleCggaSwgayApIF07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU29sdmUgUipYID0gWTtcclxuICAgIGZvciAoIGsgPSB0aGlzLm4gLSAxOyBrID49IDA7IGstLSApIHtcclxuICAgICAgZm9yICggaiA9IDA7IGogPCBueDsgaisrICkge1xyXG4gICAgICAgIFhbIG1hdHJpeC5pbmRleCggaywgaiApIF0gLz0gdGhpcy5SZGlhZ1sgayBdO1xyXG4gICAgICB9XHJcbiAgICAgIGZvciAoIGkgPSAwOyBpIDwgazsgaSsrICkge1xyXG4gICAgICAgIGZvciAoIGogPSAwOyBqIDwgbng7IGorKyApIHtcclxuICAgICAgICAgIFhbIG1hdHJpeC5pbmRleCggaSwgaiApIF0gLT0gWFsgbWF0cml4LmluZGV4KCBrLCBqICkgXSAqIHRoaXMuUVJbIHRoaXMubWF0cml4LmluZGV4KCBpLCBrICkgXTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgTWF0cml4KCB0aGlzLm4sIG54LCBYLCB0cnVlICkuZ2V0TWF0cml4KCAwLCB0aGlzLm4gLSAxLCAwLCBueCAtIDEgKTtcclxuICB9XHJcbn1cclxuXHJcbmRvdC5yZWdpc3RlciggJ1FSRGVjb21wb3NpdGlvbicsIFFSRGVjb21wb3NpdGlvbiApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgUVJEZWNvbXBvc2l0aW9uOyJdLCJtYXBwaW5ncyI6IkFBQUE7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