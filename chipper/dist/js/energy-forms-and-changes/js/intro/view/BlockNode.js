// Copyright 2014-2023, University of Colorado Boulder

/**
 * Node that represents a block in the view.  The blocks in the model are 2D, and this node gives them some perspective
 * in order to make them appear to be 3D.
 *
 * @author John Blanco
 * @author Martin Veillette
 * @author Jesse Greenberg
 */

import Matrix3 from '../../../../dot/js/Matrix3.js';
import Transform3 from '../../../../dot/js/Transform3.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import merge from '../../../../phet-core/js/merge.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Image, Node, Path, Rectangle, Text } from '../../../../scenery/js/imports.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import brickTextureFront_png from '../../../images/brickTextureFront_png.js';
import brickTextureRight_png from '../../../images/brickTextureRight_png.js';
import brickTextureTop_png from '../../../images/brickTextureTop_png.js';
import ironTextureFront_png from '../../../images/ironTextureFront_png.js';
import ironTextureRight_png from '../../../images/ironTextureRight_png.js';
import ironTextureTop_png from '../../../images/ironTextureTop_png.js';
import EFACConstants from '../../common/EFACConstants.js';
import EFACQueryParameters from '../../common/EFACQueryParameters.js';
import EnergyChunkNode from '../../common/view/EnergyChunkNode.js';
import energyFormsAndChanges from '../../energyFormsAndChanges.js';
import EnergyFormsAndChangesStrings from '../../EnergyFormsAndChangesStrings.js';
import BlockType from '../model/BlockType.js';
import EnergyChunkContainerSliceNode from './EnergyChunkContainerSliceNode.js';
import ThermalElementDragHandler from './ThermalElementDragHandler.js';
const brickString = EnergyFormsAndChangesStrings.brick;
const ironString = EnergyFormsAndChangesStrings.iron;

// constants
const BLOCK_IMAGES = {};
BLOCK_IMAGES[BlockType.BRICK] = {
  front: brickTextureFront_png,
  side: brickTextureRight_png,
  top: brickTextureTop_png
};
BLOCK_IMAGES[BlockType.IRON] = {
  front: ironTextureFront_png,
  side: ironTextureRight_png,
  top: ironTextureTop_png
};
const LABEL_FONT = new PhetFont(26);
const OUTLINE_LINE_WIDTH = 3;
const PERSPECTIVE_ANGLE = EFACConstants.BLOCK_PERSPECTIVE_ANGLE;
const BLOCK_ATTRIBUTES = {};
BLOCK_ATTRIBUTES[BlockType.IRON] = {
  label: ironString
};
BLOCK_ATTRIBUTES[BlockType.BRICK] = {
  label: brickString
};
class BlockNode extends Node {
  /**
   * @param {Block} block
   * @param {ModelViewTransform2} modelViewTransform
   * @param {function} constrainPosition
   * @param {BooleanProperty} simIsPlayingProperty
   * @param {Object} [options]
   */
  constructor(block, modelViewTransform, constrainPosition, simIsPlayingProperty, options) {
    options = merge({
      // Allow a node to be specified that will act as the parent for approaching energy chunks - this makes it so that
      // the energy chunks that are outside the block don't affect the bounds of the block.
      approachingEnergyChunksLayer: null,
      cursor: 'pointer',
      // phet-io
      tandem: Tandem.REQUIRED,
      phetioType: Node.NodeIO
    }, options);
    super(options);

    // @public (read-only)
    this.block = block;

    // extract the scale transform from the MVT so that we can separate the shape from the position of the block
    const scaleVector = modelViewTransform.matrix.getScaleVector();
    const scaleTransform = new Transform3(Matrix3.scaling(scaleVector.x, -scaleVector.y));

    // get a view representation of the block without perspective
    const blockRect = scaleTransform.transformShape(block.getUntransformedBounds());

    // create the shape for the front of the block
    const perspectiveEdgeSize = modelViewTransform.modelToViewDeltaX(block.getBounds().width * EFACConstants.BLOCK_PERSPECTIVE_EDGE_PROPORTION);
    const blockFaceOffset = new Vector2(-perspectiveEdgeSize / 2, 0).rotated(-PERSPECTIVE_ANGLE);
    const backCornersOffset = new Vector2(perspectiveEdgeSize, 0).rotated(-PERSPECTIVE_ANGLE);
    const lowerLeftFrontCorner = new Vector2(blockRect.minX, blockRect.getMaxY()).plus(blockFaceOffset);
    const lowerRightFrontCorner = new Vector2(blockRect.maxX, blockRect.getMaxY()).plus(blockFaceOffset);
    const upperRightFrontCorner = new Vector2(blockRect.maxX, blockRect.getMinY()).plus(blockFaceOffset);
    const upperLeftFrontCorner = new Vector2(blockRect.minX, blockRect.getMinY()).plus(blockFaceOffset);
    const upperLeftBackCorner = upperLeftFrontCorner.plus(backCornersOffset);
    const upperRightBackCorner = upperRightFrontCorner.plus(backCornersOffset);
    const lowerRightBackCorner = lowerRightFrontCorner.plus(backCornersOffset);

    // create the outline of the block
    const blockOutline = new Shape().moveToPoint(upperLeftBackCorner).lineToPoint(upperRightBackCorner).lineToPoint(upperRightFrontCorner).lineToPoint(upperLeftFrontCorner).lineToPoint(upperLeftBackCorner).moveToPoint(upperLeftFrontCorner).lineToPoint(lowerLeftFrontCorner).lineToPoint(lowerRightFrontCorner).lineToPoint(upperRightFrontCorner).moveToPoint(lowerRightFrontCorner).lineToPoint(lowerRightBackCorner).lineToPoint(upperRightBackCorner);

    // create the shape of the front of the block
    const blockFaceShape = new Shape();
    blockFaceShape.moveToPoint(upperRightFrontCorner).lineToPoint(upperLeftFrontCorner).lineToPoint(lowerLeftFrontCorner).lineToPoint(lowerRightFrontCorner).close();

    // create the shape of the top of the block
    const blockTopShape = new Shape();
    blockTopShape.moveToPoint(upperLeftFrontCorner).lineToPoint(upperLeftBackCorner).lineToPoint(upperRightBackCorner).lineToPoint(upperRightFrontCorner).close();

    // create the shape of the side of the block
    const blockSideShape = new Shape();
    blockSideShape.moveToPoint(upperRightBackCorner).lineToPoint(lowerRightBackCorner).lineToPoint(lowerRightFrontCorner).lineToPoint(upperRightFrontCorner).close();

    // Create the shape for the back of the block, which can only be seen when the block is transparent.  The lines are
    // shortened a little so that they don't stick out from behind the block.
    const lowerLeftBackCorner = lowerLeftFrontCorner.plus(backCornersOffset);
    const blockBackShape = new Shape();
    blockBackShape.moveToPoint(lowerLeftBackCorner).lineTo(lowerRightBackCorner.x - OUTLINE_LINE_WIDTH, lowerRightBackCorner.y).moveToPoint(lowerLeftBackCorner).lineTo(lowerLeftFrontCorner.x + Math.sin(PERSPECTIVE_ANGLE) * OUTLINE_LINE_WIDTH, lowerLeftFrontCorner.y - Math.cos(PERSPECTIVE_ANGLE) * OUTLINE_LINE_WIDTH).moveToPoint(lowerLeftBackCorner).lineTo(upperLeftBackCorner.x, upperLeftBackCorner.y + OUTLINE_LINE_WIDTH);
    const edgeColor = block.color.darkerColor(0.5);

    // add the back of the block
    const blockBack = new Path(blockBackShape, {
      lineWidth: OUTLINE_LINE_WIDTH,
      stroke: edgeColor,
      lineCap: 'round'
    });
    this.addChild(blockBack);

    // @private - create the layers where the energy chunks will be placed
    this.energyChunkRootNode = new Node();
    this.addChild(this.energyChunkRootNode);
    for (let i = block.slices.length - 1; i >= 0; i--) {
      this.energyChunkRootNode.addChild(new EnergyChunkContainerSliceNode(block.slices.get(i), modelViewTransform));
    }

    // add the face, top, and sides of the block
    const blockFace = this.createSurface(blockFaceShape, block.color, BLOCK_IMAGES[block.blockType] ? BLOCK_IMAGES[block.blockType].front : null);
    const blockTop = this.createSurface(blockTopShape, block.color, BLOCK_IMAGES[block.blockType] ? BLOCK_IMAGES[block.blockType].top : null);
    const blockSide = this.createSurface(blockSideShape, block.color, BLOCK_IMAGES[block.blockType] ? BLOCK_IMAGES[block.blockType].side : null);
    this.addChild(blockTop);
    this.addChild(blockSide);
    this.addChild(blockFace);

    // add the outline
    const frontOutline = new Path(blockOutline, {
      stroke: edgeColor,
      lineWidth: OUTLINE_LINE_WIDTH,
      lineCap: 'round',
      lineJoin: 'round'
    });
    this.addChild(frontOutline);
    if (EFACQueryParameters.show2DBlockBounds) {
      const blockBounds = scaleTransform.transformBounds2(block.getUntransformedBounds());

      // compensate for inverted Y axis when creating view representation
      this.addChild(new Rectangle(blockBounds.minX, blockBounds.minY - blockBounds.height, blockBounds.width, blockBounds.height, {
        fill: 'red',
        lineWidth: 1
      }));
    }

    // position and add the label
    const labelText = new Text(BLOCK_ATTRIBUTES[block.blockType].label, {
      font: LABEL_FONT,
      maxWidth: modelViewTransform.modelToViewDeltaX(EFACConstants.BLOCK_SURFACE_WIDTH * 0.9),
      centerX: (upperLeftFrontCorner.x + upperRightFrontCorner.x) / 2,
      centerY: (upperLeftFrontCorner.y + lowerLeftFrontCorner.y) / 2,
      tandem: options.tandem.createTandem('labelText'),
      phetioVisiblePropertyInstrumented: true
    });
    this.addChild(labelText);

    // watch for coming and going of energy chunks that are approaching this model element and add/remove them as needed
    block.approachingEnergyChunks.addItemAddedListener(addedEnergyChunk => {
      const energyChunkNode = new EnergyChunkNode(addedEnergyChunk, modelViewTransform);

      // if a node was specified for the approaching energy chunks, use it, otherwise make them a child of this node
      const parentNode = options.approachingEnergyChunkParentNode || this.energyChunkRootNode;
      parentNode.addChild(energyChunkNode);
      const removalListener = removedEnergyChunk => {
        if (removedEnergyChunk === addedEnergyChunk) {
          parentNode.removeChild(energyChunkNode);
          energyChunkNode.dispose();
          block.approachingEnergyChunks.removeItemRemovedListener(removalListener);
        }
      };
      block.approachingEnergyChunks.addItemRemovedListener(removalListener);
    });

    // make the block be transparent when the energy chunks are visible so that it looks like they are inside the block
    block.energyChunksVisibleProperty.link(energyChunksVisible => {
      const opacity = energyChunksVisible ? 0.5 : 1.0;
      blockFace.opacity = opacity;
      blockTop.opacity = opacity;
      blockSide.opacity = opacity;
      blockBack.opacity = opacity / 2; // make back less opaque to create a look of distance
      labelText.opacity = opacity;
      frontOutline.opacity = opacity;

      // don't bother displaying the back if the block is not in see-through mode
      blockBack.visible = energyChunksVisible;
    });

    // update the offset when the model position changes
    block.positionProperty.link(newPosition => {
      this.translation = modelViewTransform.modelToViewPosition(newPosition);

      // compensate the energy chunk layer so that the energy chunk nodes can handle their own positioning
      this.energyChunkRootNode.translation = modelViewTransform.modelToViewPosition(newPosition).rotated(Math.PI);
    });

    // add the drag handler
    this.addInputListener(new ThermalElementDragHandler(block, this, modelViewTransform, constrainPosition, simIsPlayingProperty, options.tandem.createTandem('dragListener')));
  }

  /**
   * convenience method to avoid code duplication - adds a node of the given shape, color, and texture (if specified)
   * @param {Shape} shape
   * @param {Color} fillColor
   * @param {Image} textureImage
   * @returns {Node}
   * @private
   */
  createSurface(shape, fillColor, textureImage) {
    let surfaceNode = null;
    if (textureImage) {
      // create a root node to which the texture and outline can be added separately
      surfaceNode = new Node();
      const textureClipNode = new Node({
        clipArea: shape
      });

      // create the texture image
      const texture = new Image(textureImage, {
        minWidth: shape.bounds.width,
        minHeight: shape.bounds.height,
        left: shape.bounds.minX,
        top: shape.bounds.minY
      });

      // add the texture to the clip node in order to clip it
      // texture.leftTop = new Vector2( shape.bounds.minX, shape.bounds.minY );
      textureClipNode.addChild(texture);

      // add texture node to the root
      surfaceNode.addChild(textureClipNode);

      // add the outline
      surfaceNode.addChild(new Path(shape));
    } else {
      // add filled shape using only color
      surfaceNode = new Path(shape, {
        fill: fillColor
      });
    }
    return surfaceNode;
  }
}
energyFormsAndChanges.register('BlockNode', BlockNode);
export default BlockNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNYXRyaXgzIiwiVHJhbnNmb3JtMyIsIlZlY3RvcjIiLCJTaGFwZSIsIm1lcmdlIiwiUGhldEZvbnQiLCJJbWFnZSIsIk5vZGUiLCJQYXRoIiwiUmVjdGFuZ2xlIiwiVGV4dCIsIlRhbmRlbSIsImJyaWNrVGV4dHVyZUZyb250X3BuZyIsImJyaWNrVGV4dHVyZVJpZ2h0X3BuZyIsImJyaWNrVGV4dHVyZVRvcF9wbmciLCJpcm9uVGV4dHVyZUZyb250X3BuZyIsImlyb25UZXh0dXJlUmlnaHRfcG5nIiwiaXJvblRleHR1cmVUb3BfcG5nIiwiRUZBQ0NvbnN0YW50cyIsIkVGQUNRdWVyeVBhcmFtZXRlcnMiLCJFbmVyZ3lDaHVua05vZGUiLCJlbmVyZ3lGb3Jtc0FuZENoYW5nZXMiLCJFbmVyZ3lGb3Jtc0FuZENoYW5nZXNTdHJpbmdzIiwiQmxvY2tUeXBlIiwiRW5lcmd5Q2h1bmtDb250YWluZXJTbGljZU5vZGUiLCJUaGVybWFsRWxlbWVudERyYWdIYW5kbGVyIiwiYnJpY2tTdHJpbmciLCJicmljayIsImlyb25TdHJpbmciLCJpcm9uIiwiQkxPQ0tfSU1BR0VTIiwiQlJJQ0siLCJmcm9udCIsInNpZGUiLCJ0b3AiLCJJUk9OIiwiTEFCRUxfRk9OVCIsIk9VVExJTkVfTElORV9XSURUSCIsIlBFUlNQRUNUSVZFX0FOR0xFIiwiQkxPQ0tfUEVSU1BFQ1RJVkVfQU5HTEUiLCJCTE9DS19BVFRSSUJVVEVTIiwibGFiZWwiLCJCbG9ja05vZGUiLCJjb25zdHJ1Y3RvciIsImJsb2NrIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwiY29uc3RyYWluUG9zaXRpb24iLCJzaW1Jc1BsYXlpbmdQcm9wZXJ0eSIsIm9wdGlvbnMiLCJhcHByb2FjaGluZ0VuZXJneUNodW5rc0xheWVyIiwiY3Vyc29yIiwidGFuZGVtIiwiUkVRVUlSRUQiLCJwaGV0aW9UeXBlIiwiTm9kZUlPIiwic2NhbGVWZWN0b3IiLCJtYXRyaXgiLCJnZXRTY2FsZVZlY3RvciIsInNjYWxlVHJhbnNmb3JtIiwic2NhbGluZyIsIngiLCJ5IiwiYmxvY2tSZWN0IiwidHJhbnNmb3JtU2hhcGUiLCJnZXRVbnRyYW5zZm9ybWVkQm91bmRzIiwicGVyc3BlY3RpdmVFZGdlU2l6ZSIsIm1vZGVsVG9WaWV3RGVsdGFYIiwiZ2V0Qm91bmRzIiwid2lkdGgiLCJCTE9DS19QRVJTUEVDVElWRV9FREdFX1BST1BPUlRJT04iLCJibG9ja0ZhY2VPZmZzZXQiLCJyb3RhdGVkIiwiYmFja0Nvcm5lcnNPZmZzZXQiLCJsb3dlckxlZnRGcm9udENvcm5lciIsIm1pblgiLCJnZXRNYXhZIiwicGx1cyIsImxvd2VyUmlnaHRGcm9udENvcm5lciIsIm1heFgiLCJ1cHBlclJpZ2h0RnJvbnRDb3JuZXIiLCJnZXRNaW5ZIiwidXBwZXJMZWZ0RnJvbnRDb3JuZXIiLCJ1cHBlckxlZnRCYWNrQ29ybmVyIiwidXBwZXJSaWdodEJhY2tDb3JuZXIiLCJsb3dlclJpZ2h0QmFja0Nvcm5lciIsImJsb2NrT3V0bGluZSIsIm1vdmVUb1BvaW50IiwibGluZVRvUG9pbnQiLCJibG9ja0ZhY2VTaGFwZSIsImNsb3NlIiwiYmxvY2tUb3BTaGFwZSIsImJsb2NrU2lkZVNoYXBlIiwibG93ZXJMZWZ0QmFja0Nvcm5lciIsImJsb2NrQmFja1NoYXBlIiwibGluZVRvIiwiTWF0aCIsInNpbiIsImNvcyIsImVkZ2VDb2xvciIsImNvbG9yIiwiZGFya2VyQ29sb3IiLCJibG9ja0JhY2siLCJsaW5lV2lkdGgiLCJzdHJva2UiLCJsaW5lQ2FwIiwiYWRkQ2hpbGQiLCJlbmVyZ3lDaHVua1Jvb3ROb2RlIiwiaSIsInNsaWNlcyIsImxlbmd0aCIsImdldCIsImJsb2NrRmFjZSIsImNyZWF0ZVN1cmZhY2UiLCJibG9ja1R5cGUiLCJibG9ja1RvcCIsImJsb2NrU2lkZSIsImZyb250T3V0bGluZSIsImxpbmVKb2luIiwic2hvdzJEQmxvY2tCb3VuZHMiLCJibG9ja0JvdW5kcyIsInRyYW5zZm9ybUJvdW5kczIiLCJtaW5ZIiwiaGVpZ2h0IiwiZmlsbCIsImxhYmVsVGV4dCIsImZvbnQiLCJtYXhXaWR0aCIsIkJMT0NLX1NVUkZBQ0VfV0lEVEgiLCJjZW50ZXJYIiwiY2VudGVyWSIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb1Zpc2libGVQcm9wZXJ0eUluc3RydW1lbnRlZCIsImFwcHJvYWNoaW5nRW5lcmd5Q2h1bmtzIiwiYWRkSXRlbUFkZGVkTGlzdGVuZXIiLCJhZGRlZEVuZXJneUNodW5rIiwiZW5lcmd5Q2h1bmtOb2RlIiwicGFyZW50Tm9kZSIsImFwcHJvYWNoaW5nRW5lcmd5Q2h1bmtQYXJlbnROb2RlIiwicmVtb3ZhbExpc3RlbmVyIiwicmVtb3ZlZEVuZXJneUNodW5rIiwicmVtb3ZlQ2hpbGQiLCJkaXNwb3NlIiwicmVtb3ZlSXRlbVJlbW92ZWRMaXN0ZW5lciIsImFkZEl0ZW1SZW1vdmVkTGlzdGVuZXIiLCJlbmVyZ3lDaHVua3NWaXNpYmxlUHJvcGVydHkiLCJsaW5rIiwiZW5lcmd5Q2h1bmtzVmlzaWJsZSIsIm9wYWNpdHkiLCJ2aXNpYmxlIiwicG9zaXRpb25Qcm9wZXJ0eSIsIm5ld1Bvc2l0aW9uIiwidHJhbnNsYXRpb24iLCJtb2RlbFRvVmlld1Bvc2l0aW9uIiwiUEkiLCJhZGRJbnB1dExpc3RlbmVyIiwic2hhcGUiLCJmaWxsQ29sb3IiLCJ0ZXh0dXJlSW1hZ2UiLCJzdXJmYWNlTm9kZSIsInRleHR1cmVDbGlwTm9kZSIsImNsaXBBcmVhIiwidGV4dHVyZSIsIm1pbldpZHRoIiwiYm91bmRzIiwibWluSGVpZ2h0IiwibGVmdCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQmxvY2tOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIE5vZGUgdGhhdCByZXByZXNlbnRzIGEgYmxvY2sgaW4gdGhlIHZpZXcuICBUaGUgYmxvY2tzIGluIHRoZSBtb2RlbCBhcmUgMkQsIGFuZCB0aGlzIG5vZGUgZ2l2ZXMgdGhlbSBzb21lIHBlcnNwZWN0aXZlXHJcbiAqIGluIG9yZGVyIHRvIG1ha2UgdGhlbSBhcHBlYXIgdG8gYmUgM0QuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICogQGF1dGhvciBNYXJ0aW4gVmVpbGxldHRlXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnXHJcbiAqL1xyXG5cclxuaW1wb3J0IE1hdHJpeDMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL01hdHJpeDMuanMnO1xyXG5pbXBvcnQgVHJhbnNmb3JtMyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVHJhbnNmb3JtMy5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IEltYWdlLCBOb2RlLCBQYXRoLCBSZWN0YW5nbGUsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgYnJpY2tUZXh0dXJlRnJvbnRfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9icmlja1RleHR1cmVGcm9udF9wbmcuanMnO1xyXG5pbXBvcnQgYnJpY2tUZXh0dXJlUmlnaHRfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9icmlja1RleHR1cmVSaWdodF9wbmcuanMnO1xyXG5pbXBvcnQgYnJpY2tUZXh0dXJlVG9wX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvYnJpY2tUZXh0dXJlVG9wX3BuZy5qcyc7XHJcbmltcG9ydCBpcm9uVGV4dHVyZUZyb250X3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvaXJvblRleHR1cmVGcm9udF9wbmcuanMnO1xyXG5pbXBvcnQgaXJvblRleHR1cmVSaWdodF9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2lyb25UZXh0dXJlUmlnaHRfcG5nLmpzJztcclxuaW1wb3J0IGlyb25UZXh0dXJlVG9wX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvaXJvblRleHR1cmVUb3BfcG5nLmpzJztcclxuaW1wb3J0IEVGQUNDb25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL0VGQUNDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgRUZBQ1F1ZXJ5UGFyYW1ldGVycyBmcm9tICcuLi8uLi9jb21tb24vRUZBQ1F1ZXJ5UGFyYW1ldGVycy5qcyc7XHJcbmltcG9ydCBFbmVyZ3lDaHVua05vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvRW5lcmd5Q2h1bmtOb2RlLmpzJztcclxuaW1wb3J0IGVuZXJneUZvcm1zQW5kQ2hhbmdlcyBmcm9tICcuLi8uLi9lbmVyZ3lGb3Jtc0FuZENoYW5nZXMuanMnO1xyXG5pbXBvcnQgRW5lcmd5Rm9ybXNBbmRDaGFuZ2VzU3RyaW5ncyBmcm9tICcuLi8uLi9FbmVyZ3lGb3Jtc0FuZENoYW5nZXNTdHJpbmdzLmpzJztcclxuaW1wb3J0IEJsb2NrVHlwZSBmcm9tICcuLi9tb2RlbC9CbG9ja1R5cGUuanMnO1xyXG5pbXBvcnQgRW5lcmd5Q2h1bmtDb250YWluZXJTbGljZU5vZGUgZnJvbSAnLi9FbmVyZ3lDaHVua0NvbnRhaW5lclNsaWNlTm9kZS5qcyc7XHJcbmltcG9ydCBUaGVybWFsRWxlbWVudERyYWdIYW5kbGVyIGZyb20gJy4vVGhlcm1hbEVsZW1lbnREcmFnSGFuZGxlci5qcyc7XHJcblxyXG5jb25zdCBicmlja1N0cmluZyA9IEVuZXJneUZvcm1zQW5kQ2hhbmdlc1N0cmluZ3MuYnJpY2s7XHJcbmNvbnN0IGlyb25TdHJpbmcgPSBFbmVyZ3lGb3Jtc0FuZENoYW5nZXNTdHJpbmdzLmlyb247XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgQkxPQ0tfSU1BR0VTID0ge307XHJcbkJMT0NLX0lNQUdFU1sgQmxvY2tUeXBlLkJSSUNLIF0gPSB7XHJcbiAgZnJvbnQ6IGJyaWNrVGV4dHVyZUZyb250X3BuZyxcclxuICBzaWRlOiBicmlja1RleHR1cmVSaWdodF9wbmcsXHJcbiAgdG9wOiBicmlja1RleHR1cmVUb3BfcG5nXHJcbn07XHJcbkJMT0NLX0lNQUdFU1sgQmxvY2tUeXBlLklST04gXSA9IHtcclxuICBmcm9udDogaXJvblRleHR1cmVGcm9udF9wbmcsXHJcbiAgc2lkZTogaXJvblRleHR1cmVSaWdodF9wbmcsXHJcbiAgdG9wOiBpcm9uVGV4dHVyZVRvcF9wbmdcclxufTtcclxuY29uc3QgTEFCRUxfRk9OVCA9IG5ldyBQaGV0Rm9udCggMjYgKTtcclxuY29uc3QgT1VUTElORV9MSU5FX1dJRFRIID0gMztcclxuY29uc3QgUEVSU1BFQ1RJVkVfQU5HTEUgPSBFRkFDQ29uc3RhbnRzLkJMT0NLX1BFUlNQRUNUSVZFX0FOR0xFO1xyXG5jb25zdCBCTE9DS19BVFRSSUJVVEVTID0ge307XHJcbkJMT0NLX0FUVFJJQlVURVNbIEJsb2NrVHlwZS5JUk9OIF0gPSB7IGxhYmVsOiBpcm9uU3RyaW5nIH07XHJcbkJMT0NLX0FUVFJJQlVURVNbIEJsb2NrVHlwZS5CUklDSyBdID0geyBsYWJlbDogYnJpY2tTdHJpbmcgfTtcclxuXHJcbmNsYXNzIEJsb2NrTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0Jsb2NrfSBibG9ja1xyXG4gICAqIEBwYXJhbSB7TW9kZWxWaWV3VHJhbnNmb3JtMn0gbW9kZWxWaWV3VHJhbnNmb3JtXHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gY29uc3RyYWluUG9zaXRpb25cclxuICAgKiBAcGFyYW0ge0Jvb2xlYW5Qcm9wZXJ0eX0gc2ltSXNQbGF5aW5nUHJvcGVydHlcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGJsb2NrLCBtb2RlbFZpZXdUcmFuc2Zvcm0sIGNvbnN0cmFpblBvc2l0aW9uLCBzaW1Jc1BsYXlpbmdQcm9wZXJ0eSwgb3B0aW9ucyApIHtcclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG5cclxuICAgICAgLy8gQWxsb3cgYSBub2RlIHRvIGJlIHNwZWNpZmllZCB0aGF0IHdpbGwgYWN0IGFzIHRoZSBwYXJlbnQgZm9yIGFwcHJvYWNoaW5nIGVuZXJneSBjaHVua3MgLSB0aGlzIG1ha2VzIGl0IHNvIHRoYXRcclxuICAgICAgLy8gdGhlIGVuZXJneSBjaHVua3MgdGhhdCBhcmUgb3V0c2lkZSB0aGUgYmxvY2sgZG9uJ3QgYWZmZWN0IHRoZSBib3VuZHMgb2YgdGhlIGJsb2NrLlxyXG4gICAgICBhcHByb2FjaGluZ0VuZXJneUNodW5rc0xheWVyOiBudWxsLFxyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcclxuXHJcbiAgICAgIC8vIHBoZXQtaW9cclxuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRUQsXHJcbiAgICAgIHBoZXRpb1R5cGU6IE5vZGUuTm9kZUlPXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpXHJcbiAgICB0aGlzLmJsb2NrID0gYmxvY2s7XHJcblxyXG4gICAgLy8gZXh0cmFjdCB0aGUgc2NhbGUgdHJhbnNmb3JtIGZyb20gdGhlIE1WVCBzbyB0aGF0IHdlIGNhbiBzZXBhcmF0ZSB0aGUgc2hhcGUgZnJvbSB0aGUgcG9zaXRpb24gb2YgdGhlIGJsb2NrXHJcbiAgICBjb25zdCBzY2FsZVZlY3RvciA9IG1vZGVsVmlld1RyYW5zZm9ybS5tYXRyaXguZ2V0U2NhbGVWZWN0b3IoKTtcclxuICAgIGNvbnN0IHNjYWxlVHJhbnNmb3JtID0gbmV3IFRyYW5zZm9ybTMoIE1hdHJpeDMuc2NhbGluZyggc2NhbGVWZWN0b3IueCwgLXNjYWxlVmVjdG9yLnkgKSApO1xyXG5cclxuICAgIC8vIGdldCBhIHZpZXcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGJsb2NrIHdpdGhvdXQgcGVyc3BlY3RpdmVcclxuICAgIGNvbnN0IGJsb2NrUmVjdCA9IHNjYWxlVHJhbnNmb3JtLnRyYW5zZm9ybVNoYXBlKCBibG9jay5nZXRVbnRyYW5zZm9ybWVkQm91bmRzKCkgKTtcclxuXHJcbiAgICAvLyBjcmVhdGUgdGhlIHNoYXBlIGZvciB0aGUgZnJvbnQgb2YgdGhlIGJsb2NrXHJcbiAgICBjb25zdCBwZXJzcGVjdGl2ZUVkZ2VTaXplID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFYKFxyXG4gICAgICBibG9jay5nZXRCb3VuZHMoKS53aWR0aCAqIEVGQUNDb25zdGFudHMuQkxPQ0tfUEVSU1BFQ1RJVkVfRURHRV9QUk9QT1JUSU9OXHJcbiAgICApO1xyXG4gICAgY29uc3QgYmxvY2tGYWNlT2Zmc2V0ID0gbmV3IFZlY3RvcjIoIC1wZXJzcGVjdGl2ZUVkZ2VTaXplIC8gMiwgMCApLnJvdGF0ZWQoIC1QRVJTUEVDVElWRV9BTkdMRSApO1xyXG4gICAgY29uc3QgYmFja0Nvcm5lcnNPZmZzZXQgPSBuZXcgVmVjdG9yMiggcGVyc3BlY3RpdmVFZGdlU2l6ZSwgMCApLnJvdGF0ZWQoIC1QRVJTUEVDVElWRV9BTkdMRSApO1xyXG4gICAgY29uc3QgbG93ZXJMZWZ0RnJvbnRDb3JuZXIgPSBuZXcgVmVjdG9yMiggYmxvY2tSZWN0Lm1pblgsIGJsb2NrUmVjdC5nZXRNYXhZKCkgKS5wbHVzKCBibG9ja0ZhY2VPZmZzZXQgKTtcclxuICAgIGNvbnN0IGxvd2VyUmlnaHRGcm9udENvcm5lciA9IG5ldyBWZWN0b3IyKCBibG9ja1JlY3QubWF4WCwgYmxvY2tSZWN0LmdldE1heFkoKSApLnBsdXMoIGJsb2NrRmFjZU9mZnNldCApO1xyXG4gICAgY29uc3QgdXBwZXJSaWdodEZyb250Q29ybmVyID0gbmV3IFZlY3RvcjIoIGJsb2NrUmVjdC5tYXhYLCBibG9ja1JlY3QuZ2V0TWluWSgpICkucGx1cyggYmxvY2tGYWNlT2Zmc2V0ICk7XHJcbiAgICBjb25zdCB1cHBlckxlZnRGcm9udENvcm5lciA9IG5ldyBWZWN0b3IyKCBibG9ja1JlY3QubWluWCwgYmxvY2tSZWN0LmdldE1pblkoKSApLnBsdXMoIGJsb2NrRmFjZU9mZnNldCApO1xyXG4gICAgY29uc3QgdXBwZXJMZWZ0QmFja0Nvcm5lciA9IHVwcGVyTGVmdEZyb250Q29ybmVyLnBsdXMoIGJhY2tDb3JuZXJzT2Zmc2V0ICk7XHJcbiAgICBjb25zdCB1cHBlclJpZ2h0QmFja0Nvcm5lciA9IHVwcGVyUmlnaHRGcm9udENvcm5lci5wbHVzKCBiYWNrQ29ybmVyc09mZnNldCApO1xyXG4gICAgY29uc3QgbG93ZXJSaWdodEJhY2tDb3JuZXIgPSBsb3dlclJpZ2h0RnJvbnRDb3JuZXIucGx1cyggYmFja0Nvcm5lcnNPZmZzZXQgKTtcclxuXHJcblxyXG4gICAgLy8gY3JlYXRlIHRoZSBvdXRsaW5lIG9mIHRoZSBibG9ja1xyXG4gICAgY29uc3QgYmxvY2tPdXRsaW5lID0gbmV3IFNoYXBlKClcclxuICAgICAgLm1vdmVUb1BvaW50KCB1cHBlckxlZnRCYWNrQ29ybmVyIClcclxuICAgICAgLmxpbmVUb1BvaW50KCB1cHBlclJpZ2h0QmFja0Nvcm5lciApXHJcbiAgICAgIC5saW5lVG9Qb2ludCggdXBwZXJSaWdodEZyb250Q29ybmVyIClcclxuICAgICAgLmxpbmVUb1BvaW50KCB1cHBlckxlZnRGcm9udENvcm5lciApXHJcbiAgICAgIC5saW5lVG9Qb2ludCggdXBwZXJMZWZ0QmFja0Nvcm5lciApXHJcbiAgICAgIC5tb3ZlVG9Qb2ludCggdXBwZXJMZWZ0RnJvbnRDb3JuZXIgKVxyXG4gICAgICAubGluZVRvUG9pbnQoIGxvd2VyTGVmdEZyb250Q29ybmVyIClcclxuICAgICAgLmxpbmVUb1BvaW50KCBsb3dlclJpZ2h0RnJvbnRDb3JuZXIgKVxyXG4gICAgICAubGluZVRvUG9pbnQoIHVwcGVyUmlnaHRGcm9udENvcm5lciApXHJcbiAgICAgIC5tb3ZlVG9Qb2ludCggbG93ZXJSaWdodEZyb250Q29ybmVyIClcclxuICAgICAgLmxpbmVUb1BvaW50KCBsb3dlclJpZ2h0QmFja0Nvcm5lciApXHJcbiAgICAgIC5saW5lVG9Qb2ludCggdXBwZXJSaWdodEJhY2tDb3JuZXIgKTtcclxuXHJcbiAgICAvLyBjcmVhdGUgdGhlIHNoYXBlIG9mIHRoZSBmcm9udCBvZiB0aGUgYmxvY2tcclxuICAgIGNvbnN0IGJsb2NrRmFjZVNoYXBlID0gbmV3IFNoYXBlKCk7XHJcbiAgICBibG9ja0ZhY2VTaGFwZS5tb3ZlVG9Qb2ludCggdXBwZXJSaWdodEZyb250Q29ybmVyIClcclxuICAgICAgLmxpbmVUb1BvaW50KCB1cHBlckxlZnRGcm9udENvcm5lciApXHJcbiAgICAgIC5saW5lVG9Qb2ludCggbG93ZXJMZWZ0RnJvbnRDb3JuZXIgKVxyXG4gICAgICAubGluZVRvUG9pbnQoIGxvd2VyUmlnaHRGcm9udENvcm5lciApXHJcbiAgICAgIC5jbG9zZSgpO1xyXG5cclxuICAgIC8vIGNyZWF0ZSB0aGUgc2hhcGUgb2YgdGhlIHRvcCBvZiB0aGUgYmxvY2tcclxuICAgIGNvbnN0IGJsb2NrVG9wU2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuICAgIGJsb2NrVG9wU2hhcGUubW92ZVRvUG9pbnQoIHVwcGVyTGVmdEZyb250Q29ybmVyIClcclxuICAgICAgLmxpbmVUb1BvaW50KCB1cHBlckxlZnRCYWNrQ29ybmVyIClcclxuICAgICAgLmxpbmVUb1BvaW50KCB1cHBlclJpZ2h0QmFja0Nvcm5lciApXHJcbiAgICAgIC5saW5lVG9Qb2ludCggdXBwZXJSaWdodEZyb250Q29ybmVyIClcclxuICAgICAgLmNsb3NlKCk7XHJcblxyXG4gICAgLy8gY3JlYXRlIHRoZSBzaGFwZSBvZiB0aGUgc2lkZSBvZiB0aGUgYmxvY2tcclxuICAgIGNvbnN0IGJsb2NrU2lkZVNoYXBlID0gbmV3IFNoYXBlKCk7XHJcbiAgICBibG9ja1NpZGVTaGFwZS5tb3ZlVG9Qb2ludCggdXBwZXJSaWdodEJhY2tDb3JuZXIgKVxyXG4gICAgICAubGluZVRvUG9pbnQoIGxvd2VyUmlnaHRCYWNrQ29ybmVyIClcclxuICAgICAgLmxpbmVUb1BvaW50KCBsb3dlclJpZ2h0RnJvbnRDb3JuZXIgKVxyXG4gICAgICAubGluZVRvUG9pbnQoIHVwcGVyUmlnaHRGcm9udENvcm5lciApXHJcbiAgICAgIC5jbG9zZSgpO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgc2hhcGUgZm9yIHRoZSBiYWNrIG9mIHRoZSBibG9jaywgd2hpY2ggY2FuIG9ubHkgYmUgc2VlbiB3aGVuIHRoZSBibG9jayBpcyB0cmFuc3BhcmVudC4gIFRoZSBsaW5lcyBhcmVcclxuICAgIC8vIHNob3J0ZW5lZCBhIGxpdHRsZSBzbyB0aGF0IHRoZXkgZG9uJ3Qgc3RpY2sgb3V0IGZyb20gYmVoaW5kIHRoZSBibG9jay5cclxuICAgIGNvbnN0IGxvd2VyTGVmdEJhY2tDb3JuZXIgPSBsb3dlckxlZnRGcm9udENvcm5lci5wbHVzKCBiYWNrQ29ybmVyc09mZnNldCApO1xyXG4gICAgY29uc3QgYmxvY2tCYWNrU2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuICAgIGJsb2NrQmFja1NoYXBlLm1vdmVUb1BvaW50KCBsb3dlckxlZnRCYWNrQ29ybmVyIClcclxuICAgICAgLmxpbmVUbyggbG93ZXJSaWdodEJhY2tDb3JuZXIueCAtIE9VVExJTkVfTElORV9XSURUSCwgbG93ZXJSaWdodEJhY2tDb3JuZXIueSApXHJcbiAgICAgIC5tb3ZlVG9Qb2ludCggbG93ZXJMZWZ0QmFja0Nvcm5lciApXHJcbiAgICAgIC5saW5lVG8oXHJcbiAgICAgICAgbG93ZXJMZWZ0RnJvbnRDb3JuZXIueCArIE1hdGguc2luKCBQRVJTUEVDVElWRV9BTkdMRSApICogT1VUTElORV9MSU5FX1dJRFRILFxyXG4gICAgICAgIGxvd2VyTGVmdEZyb250Q29ybmVyLnkgLSBNYXRoLmNvcyggUEVSU1BFQ1RJVkVfQU5HTEUgKSAqIE9VVExJTkVfTElORV9XSURUSFxyXG4gICAgICApXHJcbiAgICAgIC5tb3ZlVG9Qb2ludCggbG93ZXJMZWZ0QmFja0Nvcm5lciApXHJcbiAgICAgIC5saW5lVG8oIHVwcGVyTGVmdEJhY2tDb3JuZXIueCwgdXBwZXJMZWZ0QmFja0Nvcm5lci55ICsgT1VUTElORV9MSU5FX1dJRFRIICk7XHJcblxyXG4gICAgY29uc3QgZWRnZUNvbG9yID0gYmxvY2suY29sb3IuZGFya2VyQ29sb3IoIDAuNSApO1xyXG5cclxuICAgIC8vIGFkZCB0aGUgYmFjayBvZiB0aGUgYmxvY2tcclxuICAgIGNvbnN0IGJsb2NrQmFjayA9IG5ldyBQYXRoKCBibG9ja0JhY2tTaGFwZSwge1xyXG4gICAgICBsaW5lV2lkdGg6IE9VVExJTkVfTElORV9XSURUSCxcclxuICAgICAgc3Ryb2tlOiBlZGdlQ29sb3IsXHJcbiAgICAgIGxpbmVDYXA6ICdyb3VuZCdcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGJsb2NrQmFjayApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIC0gY3JlYXRlIHRoZSBsYXllcnMgd2hlcmUgdGhlIGVuZXJneSBjaHVua3Mgd2lsbCBiZSBwbGFjZWRcclxuICAgIHRoaXMuZW5lcmd5Q2h1bmtSb290Tm9kZSA9IG5ldyBOb2RlKCk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLmVuZXJneUNodW5rUm9vdE5vZGUgKTtcclxuICAgIGZvciAoIGxldCBpID0gYmxvY2suc2xpY2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tICkge1xyXG4gICAgICB0aGlzLmVuZXJneUNodW5rUm9vdE5vZGUuYWRkQ2hpbGQoIG5ldyBFbmVyZ3lDaHVua0NvbnRhaW5lclNsaWNlTm9kZSggYmxvY2suc2xpY2VzLmdldCggaSApLCBtb2RlbFZpZXdUcmFuc2Zvcm0gKSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGFkZCB0aGUgZmFjZSwgdG9wLCBhbmQgc2lkZXMgb2YgdGhlIGJsb2NrXHJcbiAgICBjb25zdCBibG9ja0ZhY2UgPSB0aGlzLmNyZWF0ZVN1cmZhY2UoXHJcbiAgICAgIGJsb2NrRmFjZVNoYXBlLFxyXG4gICAgICBibG9jay5jb2xvcixcclxuICAgICAgQkxPQ0tfSU1BR0VTWyBibG9jay5ibG9ja1R5cGUgXSA/IEJMT0NLX0lNQUdFU1sgYmxvY2suYmxvY2tUeXBlIF0uZnJvbnQgOiBudWxsXHJcbiAgICApO1xyXG4gICAgY29uc3QgYmxvY2tUb3AgPSB0aGlzLmNyZWF0ZVN1cmZhY2UoXHJcbiAgICAgIGJsb2NrVG9wU2hhcGUsXHJcbiAgICAgIGJsb2NrLmNvbG9yLFxyXG4gICAgICBCTE9DS19JTUFHRVNbIGJsb2NrLmJsb2NrVHlwZSBdID8gQkxPQ0tfSU1BR0VTWyBibG9jay5ibG9ja1R5cGUgXS50b3AgOiBudWxsXHJcbiAgICApO1xyXG4gICAgY29uc3QgYmxvY2tTaWRlID0gdGhpcy5jcmVhdGVTdXJmYWNlKFxyXG4gICAgICBibG9ja1NpZGVTaGFwZSxcclxuICAgICAgYmxvY2suY29sb3IsXHJcbiAgICAgIEJMT0NLX0lNQUdFU1sgYmxvY2suYmxvY2tUeXBlIF0gPyBCTE9DS19JTUFHRVNbIGJsb2NrLmJsb2NrVHlwZSBdLnNpZGUgOiBudWxsXHJcbiAgICApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggYmxvY2tUb3AgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGJsb2NrU2lkZSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggYmxvY2tGYWNlICk7XHJcblxyXG4gICAgLy8gYWRkIHRoZSBvdXRsaW5lXHJcbiAgICBjb25zdCBmcm9udE91dGxpbmUgPSBuZXcgUGF0aCggYmxvY2tPdXRsaW5lLCB7XHJcbiAgICAgIHN0cm9rZTogZWRnZUNvbG9yLFxyXG4gICAgICBsaW5lV2lkdGg6IE9VVExJTkVfTElORV9XSURUSCxcclxuICAgICAgbGluZUNhcDogJ3JvdW5kJyxcclxuICAgICAgbGluZUpvaW46ICdyb3VuZCdcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGZyb250T3V0bGluZSApO1xyXG5cclxuICAgIGlmICggRUZBQ1F1ZXJ5UGFyYW1ldGVycy5zaG93MkRCbG9ja0JvdW5kcyApIHtcclxuICAgICAgY29uc3QgYmxvY2tCb3VuZHMgPSBzY2FsZVRyYW5zZm9ybS50cmFuc2Zvcm1Cb3VuZHMyKCBibG9jay5nZXRVbnRyYW5zZm9ybWVkQm91bmRzKCkgKTtcclxuXHJcbiAgICAgIC8vIGNvbXBlbnNhdGUgZm9yIGludmVydGVkIFkgYXhpcyB3aGVuIGNyZWF0aW5nIHZpZXcgcmVwcmVzZW50YXRpb25cclxuICAgICAgdGhpcy5hZGRDaGlsZCggbmV3IFJlY3RhbmdsZShcclxuICAgICAgICBibG9ja0JvdW5kcy5taW5YLFxyXG4gICAgICAgIGJsb2NrQm91bmRzLm1pblkgLSBibG9ja0JvdW5kcy5oZWlnaHQsXHJcbiAgICAgICAgYmxvY2tCb3VuZHMud2lkdGgsXHJcbiAgICAgICAgYmxvY2tCb3VuZHMuaGVpZ2h0LFxyXG4gICAgICAgIHsgZmlsbDogJ3JlZCcsIGxpbmVXaWR0aDogMSB9XHJcbiAgICAgICkgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBwb3NpdGlvbiBhbmQgYWRkIHRoZSBsYWJlbFxyXG4gICAgY29uc3QgbGFiZWxUZXh0ID0gbmV3IFRleHQoIEJMT0NLX0FUVFJJQlVURVNbIGJsb2NrLmJsb2NrVHlwZSBdLmxhYmVsLCB7XHJcbiAgICAgIGZvbnQ6IExBQkVMX0ZPTlQsXHJcbiAgICAgIG1heFdpZHRoOiBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YVgoIEVGQUNDb25zdGFudHMuQkxPQ0tfU1VSRkFDRV9XSURUSCAqIDAuOSApLFxyXG4gICAgICBjZW50ZXJYOiAoIHVwcGVyTGVmdEZyb250Q29ybmVyLnggKyB1cHBlclJpZ2h0RnJvbnRDb3JuZXIueCApIC8gMixcclxuICAgICAgY2VudGVyWTogKCB1cHBlckxlZnRGcm9udENvcm5lci55ICsgbG93ZXJMZWZ0RnJvbnRDb3JuZXIueSApIC8gMixcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdsYWJlbFRleHQnICksXHJcbiAgICAgIHBoZXRpb1Zpc2libGVQcm9wZXJ0eUluc3RydW1lbnRlZDogdHJ1ZVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbGFiZWxUZXh0ICk7XHJcblxyXG4gICAgLy8gd2F0Y2ggZm9yIGNvbWluZyBhbmQgZ29pbmcgb2YgZW5lcmd5IGNodW5rcyB0aGF0IGFyZSBhcHByb2FjaGluZyB0aGlzIG1vZGVsIGVsZW1lbnQgYW5kIGFkZC9yZW1vdmUgdGhlbSBhcyBuZWVkZWRcclxuICAgIGJsb2NrLmFwcHJvYWNoaW5nRW5lcmd5Q2h1bmtzLmFkZEl0ZW1BZGRlZExpc3RlbmVyKCBhZGRlZEVuZXJneUNodW5rID0+IHtcclxuICAgICAgY29uc3QgZW5lcmd5Q2h1bmtOb2RlID0gbmV3IEVuZXJneUNodW5rTm9kZSggYWRkZWRFbmVyZ3lDaHVuaywgbW9kZWxWaWV3VHJhbnNmb3JtICk7XHJcblxyXG4gICAgICAvLyBpZiBhIG5vZGUgd2FzIHNwZWNpZmllZCBmb3IgdGhlIGFwcHJvYWNoaW5nIGVuZXJneSBjaHVua3MsIHVzZSBpdCwgb3RoZXJ3aXNlIG1ha2UgdGhlbSBhIGNoaWxkIG9mIHRoaXMgbm9kZVxyXG4gICAgICBjb25zdCBwYXJlbnROb2RlID0gb3B0aW9ucy5hcHByb2FjaGluZ0VuZXJneUNodW5rUGFyZW50Tm9kZSB8fCB0aGlzLmVuZXJneUNodW5rUm9vdE5vZGU7XHJcbiAgICAgIHBhcmVudE5vZGUuYWRkQ2hpbGQoIGVuZXJneUNodW5rTm9kZSApO1xyXG5cclxuICAgICAgY29uc3QgcmVtb3ZhbExpc3RlbmVyID0gcmVtb3ZlZEVuZXJneUNodW5rID0+IHtcclxuICAgICAgICBpZiAoIHJlbW92ZWRFbmVyZ3lDaHVuayA9PT0gYWRkZWRFbmVyZ3lDaHVuayApIHtcclxuICAgICAgICAgIHBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIGVuZXJneUNodW5rTm9kZSApO1xyXG4gICAgICAgICAgZW5lcmd5Q2h1bmtOb2RlLmRpc3Bvc2UoKTtcclxuICAgICAgICAgIGJsb2NrLmFwcHJvYWNoaW5nRW5lcmd5Q2h1bmtzLnJlbW92ZUl0ZW1SZW1vdmVkTGlzdGVuZXIoIHJlbW92YWxMaXN0ZW5lciApO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgYmxvY2suYXBwcm9hY2hpbmdFbmVyZ3lDaHVua3MuYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciggcmVtb3ZhbExpc3RlbmVyICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gbWFrZSB0aGUgYmxvY2sgYmUgdHJhbnNwYXJlbnQgd2hlbiB0aGUgZW5lcmd5IGNodW5rcyBhcmUgdmlzaWJsZSBzbyB0aGF0IGl0IGxvb2tzIGxpa2UgdGhleSBhcmUgaW5zaWRlIHRoZSBibG9ja1xyXG4gICAgYmxvY2suZW5lcmd5Q2h1bmtzVmlzaWJsZVByb3BlcnR5LmxpbmsoIGVuZXJneUNodW5rc1Zpc2libGUgPT4ge1xyXG4gICAgICBjb25zdCBvcGFjaXR5ID0gZW5lcmd5Q2h1bmtzVmlzaWJsZSA/IDAuNSA6IDEuMDtcclxuICAgICAgYmxvY2tGYWNlLm9wYWNpdHkgPSBvcGFjaXR5O1xyXG4gICAgICBibG9ja1RvcC5vcGFjaXR5ID0gb3BhY2l0eTtcclxuICAgICAgYmxvY2tTaWRlLm9wYWNpdHkgPSBvcGFjaXR5O1xyXG4gICAgICBibG9ja0JhY2sub3BhY2l0eSA9IG9wYWNpdHkgLyAyOyAvLyBtYWtlIGJhY2sgbGVzcyBvcGFxdWUgdG8gY3JlYXRlIGEgbG9vayBvZiBkaXN0YW5jZVxyXG4gICAgICBsYWJlbFRleHQub3BhY2l0eSA9IG9wYWNpdHk7XHJcbiAgICAgIGZyb250T3V0bGluZS5vcGFjaXR5ID0gb3BhY2l0eTtcclxuXHJcbiAgICAgIC8vIGRvbid0IGJvdGhlciBkaXNwbGF5aW5nIHRoZSBiYWNrIGlmIHRoZSBibG9jayBpcyBub3QgaW4gc2VlLXRocm91Z2ggbW9kZVxyXG4gICAgICBibG9ja0JhY2sudmlzaWJsZSA9IGVuZXJneUNodW5rc1Zpc2libGU7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gdXBkYXRlIHRoZSBvZmZzZXQgd2hlbiB0aGUgbW9kZWwgcG9zaXRpb24gY2hhbmdlc1xyXG4gICAgYmxvY2sucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCBuZXdQb3NpdGlvbiA9PiB7XHJcblxyXG4gICAgICB0aGlzLnRyYW5zbGF0aW9uID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIG5ld1Bvc2l0aW9uICk7XHJcblxyXG4gICAgICAvLyBjb21wZW5zYXRlIHRoZSBlbmVyZ3kgY2h1bmsgbGF5ZXIgc28gdGhhdCB0aGUgZW5lcmd5IGNodW5rIG5vZGVzIGNhbiBoYW5kbGUgdGhlaXIgb3duIHBvc2l0aW9uaW5nXHJcbiAgICAgIHRoaXMuZW5lcmd5Q2h1bmtSb290Tm9kZS50cmFuc2xhdGlvbiA9XHJcbiAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIG5ld1Bvc2l0aW9uICkucm90YXRlZCggTWF0aC5QSSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGFkZCB0aGUgZHJhZyBoYW5kbGVyXHJcbiAgICB0aGlzLmFkZElucHV0TGlzdGVuZXIoIG5ldyBUaGVybWFsRWxlbWVudERyYWdIYW5kbGVyKFxyXG4gICAgICBibG9jayxcclxuICAgICAgdGhpcyxcclxuICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLFxyXG4gICAgICBjb25zdHJhaW5Qb3NpdGlvbixcclxuICAgICAgc2ltSXNQbGF5aW5nUHJvcGVydHksXHJcbiAgICAgIG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RyYWdMaXN0ZW5lcicgKVxyXG4gICAgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogY29udmVuaWVuY2UgbWV0aG9kIHRvIGF2b2lkIGNvZGUgZHVwbGljYXRpb24gLSBhZGRzIGEgbm9kZSBvZiB0aGUgZ2l2ZW4gc2hhcGUsIGNvbG9yLCBhbmQgdGV4dHVyZSAoaWYgc3BlY2lmaWVkKVxyXG4gICAqIEBwYXJhbSB7U2hhcGV9IHNoYXBlXHJcbiAgICogQHBhcmFtIHtDb2xvcn0gZmlsbENvbG9yXHJcbiAgICogQHBhcmFtIHtJbWFnZX0gdGV4dHVyZUltYWdlXHJcbiAgICogQHJldHVybnMge05vZGV9XHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBjcmVhdGVTdXJmYWNlKCBzaGFwZSwgZmlsbENvbG9yLCB0ZXh0dXJlSW1hZ2UgKSB7XHJcblxyXG4gICAgbGV0IHN1cmZhY2VOb2RlID0gbnVsbDtcclxuXHJcbiAgICBpZiAoIHRleHR1cmVJbWFnZSApIHtcclxuXHJcbiAgICAgIC8vIGNyZWF0ZSBhIHJvb3Qgbm9kZSB0byB3aGljaCB0aGUgdGV4dHVyZSBhbmQgb3V0bGluZSBjYW4gYmUgYWRkZWQgc2VwYXJhdGVseVxyXG4gICAgICBzdXJmYWNlTm9kZSA9IG5ldyBOb2RlKCk7XHJcblxyXG4gICAgICBjb25zdCB0ZXh0dXJlQ2xpcE5vZGUgPSBuZXcgTm9kZSgge1xyXG4gICAgICAgIGNsaXBBcmVhOiBzaGFwZVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBjcmVhdGUgdGhlIHRleHR1cmUgaW1hZ2VcclxuICAgICAgY29uc3QgdGV4dHVyZSA9IG5ldyBJbWFnZSggdGV4dHVyZUltYWdlLCB7XHJcbiAgICAgICAgbWluV2lkdGg6IHNoYXBlLmJvdW5kcy53aWR0aCxcclxuICAgICAgICBtaW5IZWlnaHQ6IHNoYXBlLmJvdW5kcy5oZWlnaHQsXHJcbiAgICAgICAgbGVmdDogc2hhcGUuYm91bmRzLm1pblgsXHJcbiAgICAgICAgdG9wOiBzaGFwZS5ib3VuZHMubWluWVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBhZGQgdGhlIHRleHR1cmUgdG8gdGhlIGNsaXAgbm9kZSBpbiBvcmRlciB0byBjbGlwIGl0XHJcbiAgICAgIC8vIHRleHR1cmUubGVmdFRvcCA9IG5ldyBWZWN0b3IyKCBzaGFwZS5ib3VuZHMubWluWCwgc2hhcGUuYm91bmRzLm1pblkgKTtcclxuICAgICAgdGV4dHVyZUNsaXBOb2RlLmFkZENoaWxkKCB0ZXh0dXJlICk7XHJcblxyXG4gICAgICAvLyBhZGQgdGV4dHVyZSBub2RlIHRvIHRoZSByb290XHJcbiAgICAgIHN1cmZhY2VOb2RlLmFkZENoaWxkKCB0ZXh0dXJlQ2xpcE5vZGUgKTtcclxuXHJcbiAgICAgIC8vIGFkZCB0aGUgb3V0bGluZVxyXG4gICAgICBzdXJmYWNlTm9kZS5hZGRDaGlsZCggbmV3IFBhdGgoIHNoYXBlICkgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG5cclxuICAgICAgLy8gYWRkIGZpbGxlZCBzaGFwZSB1c2luZyBvbmx5IGNvbG9yXHJcbiAgICAgIHN1cmZhY2VOb2RlID0gbmV3IFBhdGgoIHNoYXBlLCB7IGZpbGw6IGZpbGxDb2xvciB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHN1cmZhY2VOb2RlO1xyXG4gIH1cclxufVxyXG5cclxuZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzLnJlZ2lzdGVyKCAnQmxvY2tOb2RlJywgQmxvY2tOb2RlICk7XHJcbmV4cG9ydCBkZWZhdWx0IEJsb2NrTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxVQUFVLE1BQU0sa0NBQWtDO0FBQ3pELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsU0FBU0MsS0FBSyxRQUFRLGdDQUFnQztBQUN0RCxPQUFPQyxLQUFLLE1BQU0sbUNBQW1DO0FBQ3JELE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsU0FBU0MsS0FBSyxFQUFFQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsU0FBUyxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ3RGLE9BQU9DLE1BQU0sTUFBTSxp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