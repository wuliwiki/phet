// Copyright 2014-2021, University of Colorado Boulder

/**
 * A type that represents the air in the model. Air can hold heat and exchange thermal energy with other model objects.
 *
 * @author John Blanco
 */

import createObservableArray from '../../../../axon/js/createObservableArray.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Vector2Property from '../../../../dot/js/Vector2Property.js';
import merge from '../../../../phet-core/js/merge.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import ReferenceIO from '../../../../tandem/js/types/ReferenceIO.js';
import EFACConstants from '../../common/EFACConstants.js';
import EnergyChunk from '../../common/model/EnergyChunk.js';
import EnergyChunkWanderController from '../../common/model/EnergyChunkWanderController.js';
import EnergyContainerCategory from '../../common/model/EnergyContainerCategory.js';
import EnergyType from '../../common/model/EnergyType.js';
import HeatTransferConstants from '../../common/model/HeatTransferConstants.js';
import ThermalContactArea from '../../common/model/ThermalContactArea.js';
import energyFormsAndChanges from '../../energyFormsAndChanges.js';

// constants

// 2D size of the air. It is sized such that it will extend off the left, right, and top edges of screen for the
// most common aspect ratios of the view.
const SIZE = new Dimension2(0.7, EFACConstants.INTRO_SCREEN_ENERGY_CHUNK_MAX_TRAVEL_HEIGHT);

// The thickness of the slice of air being modeled.  This is basically the z dimension, and is used solely for
// volume calculations.
const DEPTH = 0.1; // in meters

// constants that define the heat carrying capacity of the air.
const SPECIFIC_HEAT = 1012; // In J/kg-K, source = design document.
const DENSITY = 10; // In kg/m^3, far more dense than real air (real air is 0.001), done to make things cool faster

// derived constants
const VOLUME = SIZE.width * SIZE.height * DEPTH;
const MASS = VOLUME * DENSITY;
const INITIAL_ENERGY = MASS * SPECIFIC_HEAT * EFACConstants.ROOM_TEMPERATURE;
const THERMAL_CONTACT_AREA = new ThermalContactArea(new Bounds2(-SIZE.width / 2, 0, SIZE.width, SIZE.height), true);

// instance counter used for creating unique IDs
let instanceCounter = 0;
class Air {
  /**
   * @param {BooleanProperty} energyChunksVisibleProperty - visibility of energy chunks, used when creating new ones
   * @param {EnergyChunkGroup} energyChunkGroup
   * @param {EnergyChunkWanderControllerGroup} energyChunkWanderControllerGroup
   * @param {Object} [options]
   */
  constructor(energyChunksVisibleProperty, energyChunkGroup, energyChunkWanderControllerGroup, options) {
    options = merge({
      tandem: Tandem.REQUIRED
    }, options);

    // @private {BooleanProperty}
    this.energyChunksVisibleProperty = energyChunksVisibleProperty;

    // @public (read-only) - list of energy chunks owned by this model element
    this.energyChunkList = createObservableArray({
      tandem: options.tandem.createTandem('energyChunkList'),
      phetioType: createObservableArray.ObservableArrayIO(ReferenceIO(EnergyChunk.EnergyChunkIO))
    });

    // @public (read-only) {string} - unique ID
    this.id = `air-${instanceCounter++}`;

    // @private
    this.energyChunkGroup = energyChunkGroup;
    this.energyChunkWanderControllerGroup = energyChunkWanderControllerGroup;

    // @private {ObservableArrayDef.<EnergyChunkWanderController>} - wander controllers for energy chunks that are owned by
    // this model element but are wandering outside of it.
    this.energyChunkWanderControllers = createObservableArray({
      tandem: options.tandem.createTandem('energyChunkWanderControllers'),
      phetioType: createObservableArray.ObservableArrayIO(ReferenceIO(EnergyChunkWanderController.EnergyChunkWanderControllerIO))
    });

    // @private {number} - total energy of the air, accessible through getters/setters defined below
    this.energy = INITIAL_ENERGY;
  }

  /**
   * step function for this model element
   * @param {number} dt - delta time, in seconds
   * @public
   */
  step(dt) {
    const wanderControllers = this.energyChunkWanderControllers.slice();
    wanderControllers.forEach(wanderController => {
      wanderController.updatePosition(dt);
      if (wanderController.isDestinationReached()) {
        // The energy chuck has reached its destination, which for the air means it has risen out of view, so remove
        // it from the model.
        this.energyChunkList.remove(wanderController.energyChunk);
        this.energyChunkWanderControllers.remove(wanderController);
        this.energyChunkGroup.disposeElement(wanderController.energyChunk);
        this.energyChunkWanderControllerGroup.disposeElement(wanderController);
      }
    });
  }

  /**
   * @param {number} deltaEnergy
   * @public
   */
  changeEnergy(deltaEnergy) {
    // Do nothing - the air is considered to be a heat sink that can take or supply energy without changing
    // temperature.This was changed in Dec 2019 such that the air never gains or loses energy.  The motives for this
    // change are explained in https://github.com/phetsims/energy-forms-and-changes/issues/301.
  }

  /**
   * @returns {number}
   * @public
   */
  getEnergy() {
    return this.energy;
  }

  /**
   * @public
   */
  reset() {
    this.energy = INITIAL_ENERGY;
    this.energyChunkList.forEach(chunk => this.energyChunkGroup.disposeElement(chunk));
    this.energyChunkList.clear();
    this.energyChunkWanderControllers.forEach(wanderController => this.energyChunkWanderControllerGroup.disposeElement(wanderController));
    this.energyChunkWanderControllers.clear();
  }

  /**
   * exchange thermal energy with the provided energy container
   * @param {RectangularThermalMovableModelElement} energyContainer
   * @param {number} dt - time in seconds
   * @returns {number} - energy, in joules, that is transferred from air to the object, negative if energy was absosrbed
   * @public
   */
  exchangeEnergyWith(energyContainer, dt) {
    let energyToExchange = 0;
    const thermalContactLength = this.thermalContactArea.getThermalContactLength(energyContainer.thermalContactArea);
    if (thermalContactLength > 0) {
      // calculate the amount of energy to exchange based on the thermal differential
      const heatTransferConstant = HeatTransferConstants.getHeatTransferFactor(this.energyContainerCategory, energyContainer.energyContainerCategory);
      const numberOfFullTimeStepExchanges = Math.floor(dt / EFACConstants.MAX_HEAT_EXCHANGE_TIME_STEP);
      const leftoverTime = dt - numberOfFullTimeStepExchanges * EFACConstants.MAX_HEAT_EXCHANGE_TIME_STEP;
      for (let i = 0; i < numberOfFullTimeStepExchanges + 1; i++) {
        const timeStep = i < numberOfFullTimeStepExchanges ? EFACConstants.MAX_HEAT_EXCHANGE_TIME_STEP : leftoverTime;
        const thermalEnergyGained = (energyContainer.getTemperature() - this.getTemperature()) * thermalContactLength * heatTransferConstant * timeStep;
        energyToExchange += thermalEnergyGained;
      }

      // If the container has "excess energy", which can happen in cases such as where energy has been added to water
      // that is already at the boiling point, all of that energy should be dumped into the air.
      if (energyToExchange >= 0) {
        energyToExchange = Math.max(energyToExchange, energyContainer.getEnergyBeyondMaxTemperature());
      }

      // calculations are complete, do the actual exchange
      energyContainer.changeEnergy(-energyToExchange);
    }
    return -energyToExchange;
  }

  /**
   * @param {EnergyChunk} energyChunk
   * @param {Range} horizontalWanderConstraint
   * @public
   */
  addEnergyChunk(energyChunk, horizontalWanderConstraint) {
    energyChunk.zPositionProperty.value = 0;
    this.energyChunkList.push(energyChunk);
    this.energyChunkWanderControllers.push(this.energyChunkWanderControllerGroup.createNextElement(energyChunk, new Vector2Property(new Vector2(energyChunk.positionProperty.value.x, SIZE.height)), {
      horizontalWanderConstraint: horizontalWanderConstraint
    }));
  }

  /**
   * @returns {Vector2}
   * @public
   */
  getCenterPoint() {
    return new Vector2(0, SIZE.height / 2);
  }

  /**
   * create a new energy chunk at the top of the air above the specified point
   * @param {Vector2} point
   * @returns {EnergyChunk}
   * @public
   */
  requestEnergyChunk(point) {
    // create a new chunk at the top of the air above the specified point
    return this.energyChunkGroup.createNextElement(EnergyType.THERMAL, new Vector2(point.x, SIZE.height), new Vector2(0, 0), this.energyChunksVisibleProperty);
  }

  /**
   * get the thermal contact area for air, where thermal energy may be exchanged with other objects
   * @returns {ThermalContactArea}
   * @public
   */
  get thermalContactArea() {
    return THERMAL_CONTACT_AREA;
  }

  /**
   * get the air temperature
   * @returns {number}
   * @public
   */
  getTemperature() {
    return this.energy / (MASS * SPECIFIC_HEAT);
  }

  /**
   * @returns {EnergyContainerCategory}
   * @public
   */
  get energyContainerCategory() {
    return EnergyContainerCategory.AIR;
  }

  /**
   * @returns {number}
   * @public
   */
  getEnergyBeyondMaxTemperature() {
    // air temperature is unlimited
    return 0;
  }
}
energyFormsAndChanges.register('Air', Air);
export default Air;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVPYnNlcnZhYmxlQXJyYXkiLCJCb3VuZHMyIiwiRGltZW5zaW9uMiIsIlZlY3RvcjIiLCJWZWN0b3IyUHJvcGVydHkiLCJtZXJnZSIsIlRhbmRlbSIsIlJlZmVyZW5jZUlPIiwiRUZBQ0NvbnN0YW50cyIsIkVuZXJneUNodW5rIiwiRW5lcmd5Q2h1bmtXYW5kZXJDb250cm9sbGVyIiwiRW5lcmd5Q29udGFpbmVyQ2F0ZWdvcnkiLCJFbmVyZ3lUeXBlIiwiSGVhdFRyYW5zZmVyQ29uc3RhbnRzIiwiVGhlcm1hbENvbnRhY3RBcmVhIiwiZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzIiwiU0laRSIsIklOVFJPX1NDUkVFTl9FTkVSR1lfQ0hVTktfTUFYX1RSQVZFTF9IRUlHSFQiLCJERVBUSCIsIlNQRUNJRklDX0hFQVQiLCJERU5TSVRZIiwiVk9MVU1FIiwid2lkdGgiLCJoZWlnaHQiLCJNQVNTIiwiSU5JVElBTF9FTkVSR1kiLCJST09NX1RFTVBFUkFUVVJFIiwiVEhFUk1BTF9DT05UQUNUX0FSRUEiLCJpbnN0YW5jZUNvdW50ZXIiLCJBaXIiLCJjb25zdHJ1Y3RvciIsImVuZXJneUNodW5rc1Zpc2libGVQcm9wZXJ0eSIsImVuZXJneUNodW5rR3JvdXAiLCJlbmVyZ3lDaHVua1dhbmRlckNvbnRyb2xsZXJHcm91cCIsIm9wdGlvbnMiLCJ0YW5kZW0iLCJSRVFVSVJFRCIsImVuZXJneUNodW5rTGlzdCIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb1R5cGUiLCJPYnNlcnZhYmxlQXJyYXlJTyIsIkVuZXJneUNodW5rSU8iLCJpZCIsImVuZXJneUNodW5rV2FuZGVyQ29udHJvbGxlcnMiLCJFbmVyZ3lDaHVua1dhbmRlckNvbnRyb2xsZXJJTyIsImVuZXJneSIsInN0ZXAiLCJkdCIsIndhbmRlckNvbnRyb2xsZXJzIiwic2xpY2UiLCJmb3JFYWNoIiwid2FuZGVyQ29udHJvbGxlciIsInVwZGF0ZVBvc2l0aW9uIiwiaXNEZXN0aW5hdGlvblJlYWNoZWQiLCJyZW1vdmUiLCJlbmVyZ3lDaHVuayIsImRpc3Bvc2VFbGVtZW50IiwiY2hhbmdlRW5lcmd5IiwiZGVsdGFFbmVyZ3kiLCJnZXRFbmVyZ3kiLCJyZXNldCIsImNodW5rIiwiY2xlYXIiLCJleGNoYW5nZUVuZXJneVdpdGgiLCJlbmVyZ3lDb250YWluZXIiLCJlbmVyZ3lUb0V4Y2hhbmdlIiwidGhlcm1hbENvbnRhY3RMZW5ndGgiLCJ0aGVybWFsQ29udGFjdEFyZWEiLCJnZXRUaGVybWFsQ29udGFjdExlbmd0aCIsImhlYXRUcmFuc2ZlckNvbnN0YW50IiwiZ2V0SGVhdFRyYW5zZmVyRmFjdG9yIiwiZW5lcmd5Q29udGFpbmVyQ2F0ZWdvcnkiLCJudW1iZXJPZkZ1bGxUaW1lU3RlcEV4Y2hhbmdlcyIsIk1hdGgiLCJmbG9vciIsIk1BWF9IRUFUX0VYQ0hBTkdFX1RJTUVfU1RFUCIsImxlZnRvdmVyVGltZSIsImkiLCJ0aW1lU3RlcCIsInRoZXJtYWxFbmVyZ3lHYWluZWQiLCJnZXRUZW1wZXJhdHVyZSIsIm1heCIsImdldEVuZXJneUJleW9uZE1heFRlbXBlcmF0dXJlIiwiYWRkRW5lcmd5Q2h1bmsiLCJob3Jpem9udGFsV2FuZGVyQ29uc3RyYWludCIsInpQb3NpdGlvblByb3BlcnR5IiwidmFsdWUiLCJwdXNoIiwiY3JlYXRlTmV4dEVsZW1lbnQiLCJwb3NpdGlvblByb3BlcnR5IiwieCIsImdldENlbnRlclBvaW50IiwicmVxdWVzdEVuZXJneUNodW5rIiwicG9pbnQiLCJUSEVSTUFMIiwiQUlSIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJBaXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQSB0eXBlIHRoYXQgcmVwcmVzZW50cyB0aGUgYWlyIGluIHRoZSBtb2RlbC4gQWlyIGNhbiBob2xkIGhlYXQgYW5kIGV4Y2hhbmdlIHRoZXJtYWwgZW5lcmd5IHdpdGggb3RoZXIgbW9kZWwgb2JqZWN0cy5cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKi9cclxuXHJcbmltcG9ydCBjcmVhdGVPYnNlcnZhYmxlQXJyYXkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9jcmVhdGVPYnNlcnZhYmxlQXJyYXkuanMnO1xyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCBEaW1lbnNpb24yIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9EaW1lbnNpb24yLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMlByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IFJlZmVyZW5jZUlPIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9SZWZlcmVuY2VJTy5qcyc7XHJcbmltcG9ydCBFRkFDQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9FRkFDQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEVuZXJneUNodW5rIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9FbmVyZ3lDaHVuay5qcyc7XHJcbmltcG9ydCBFbmVyZ3lDaHVua1dhbmRlckNvbnRyb2xsZXIgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL0VuZXJneUNodW5rV2FuZGVyQ29udHJvbGxlci5qcyc7XHJcbmltcG9ydCBFbmVyZ3lDb250YWluZXJDYXRlZ29yeSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvRW5lcmd5Q29udGFpbmVyQ2F0ZWdvcnkuanMnO1xyXG5pbXBvcnQgRW5lcmd5VHlwZSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvRW5lcmd5VHlwZS5qcyc7XHJcbmltcG9ydCBIZWF0VHJhbnNmZXJDb25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL0hlYXRUcmFuc2ZlckNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBUaGVybWFsQ29udGFjdEFyZWEgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL1RoZXJtYWxDb250YWN0QXJlYS5qcyc7XHJcbmltcG9ydCBlbmVyZ3lGb3Jtc0FuZENoYW5nZXMgZnJvbSAnLi4vLi4vZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5cclxuLy8gMkQgc2l6ZSBvZiB0aGUgYWlyLiBJdCBpcyBzaXplZCBzdWNoIHRoYXQgaXQgd2lsbCBleHRlbmQgb2ZmIHRoZSBsZWZ0LCByaWdodCwgYW5kIHRvcCBlZGdlcyBvZiBzY3JlZW4gZm9yIHRoZVxyXG4vLyBtb3N0IGNvbW1vbiBhc3BlY3QgcmF0aW9zIG9mIHRoZSB2aWV3LlxyXG5jb25zdCBTSVpFID0gbmV3IERpbWVuc2lvbjIoIDAuNywgRUZBQ0NvbnN0YW50cy5JTlRST19TQ1JFRU5fRU5FUkdZX0NIVU5LX01BWF9UUkFWRUxfSEVJR0hUICk7XHJcblxyXG4vLyBUaGUgdGhpY2tuZXNzIG9mIHRoZSBzbGljZSBvZiBhaXIgYmVpbmcgbW9kZWxlZC4gIFRoaXMgaXMgYmFzaWNhbGx5IHRoZSB6IGRpbWVuc2lvbiwgYW5kIGlzIHVzZWQgc29sZWx5IGZvclxyXG4vLyB2b2x1bWUgY2FsY3VsYXRpb25zLlxyXG5jb25zdCBERVBUSCA9IDAuMTsgLy8gaW4gbWV0ZXJzXHJcblxyXG4vLyBjb25zdGFudHMgdGhhdCBkZWZpbmUgdGhlIGhlYXQgY2FycnlpbmcgY2FwYWNpdHkgb2YgdGhlIGFpci5cclxuY29uc3QgU1BFQ0lGSUNfSEVBVCA9IDEwMTI7IC8vIEluIEova2ctSywgc291cmNlID0gZGVzaWduIGRvY3VtZW50LlxyXG5jb25zdCBERU5TSVRZID0gMTA7IC8vIEluIGtnL21eMywgZmFyIG1vcmUgZGVuc2UgdGhhbiByZWFsIGFpciAocmVhbCBhaXIgaXMgMC4wMDEpLCBkb25lIHRvIG1ha2UgdGhpbmdzIGNvb2wgZmFzdGVyXHJcblxyXG4vLyBkZXJpdmVkIGNvbnN0YW50c1xyXG5jb25zdCBWT0xVTUUgPSBTSVpFLndpZHRoICogU0laRS5oZWlnaHQgKiBERVBUSDtcclxuY29uc3QgTUFTUyA9IFZPTFVNRSAqIERFTlNJVFk7XHJcbmNvbnN0IElOSVRJQUxfRU5FUkdZID0gTUFTUyAqIFNQRUNJRklDX0hFQVQgKiBFRkFDQ29uc3RhbnRzLlJPT01fVEVNUEVSQVRVUkU7XHJcbmNvbnN0IFRIRVJNQUxfQ09OVEFDVF9BUkVBID0gbmV3IFRoZXJtYWxDb250YWN0QXJlYSggbmV3IEJvdW5kczIoIC1TSVpFLndpZHRoIC8gMiwgMCwgU0laRS53aWR0aCwgU0laRS5oZWlnaHQgKSwgdHJ1ZSApO1xyXG5cclxuLy8gaW5zdGFuY2UgY291bnRlciB1c2VkIGZvciBjcmVhdGluZyB1bmlxdWUgSURzXHJcbmxldCBpbnN0YW5jZUNvdW50ZXIgPSAwO1xyXG5cclxuY2xhc3MgQWlyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtCb29sZWFuUHJvcGVydHl9IGVuZXJneUNodW5rc1Zpc2libGVQcm9wZXJ0eSAtIHZpc2liaWxpdHkgb2YgZW5lcmd5IGNodW5rcywgdXNlZCB3aGVuIGNyZWF0aW5nIG5ldyBvbmVzXHJcbiAgICogQHBhcmFtIHtFbmVyZ3lDaHVua0dyb3VwfSBlbmVyZ3lDaHVua0dyb3VwXHJcbiAgICogQHBhcmFtIHtFbmVyZ3lDaHVua1dhbmRlckNvbnRyb2xsZXJHcm91cH0gZW5lcmd5Q2h1bmtXYW5kZXJDb250cm9sbGVyR3JvdXBcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGVuZXJneUNodW5rc1Zpc2libGVQcm9wZXJ0eSwgZW5lcmd5Q2h1bmtHcm91cCwgZW5lcmd5Q2h1bmtXYW5kZXJDb250cm9sbGVyR3JvdXAsIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVEXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge0Jvb2xlYW5Qcm9wZXJ0eX1cclxuICAgIHRoaXMuZW5lcmd5Q2h1bmtzVmlzaWJsZVByb3BlcnR5ID0gZW5lcmd5Q2h1bmtzVmlzaWJsZVByb3BlcnR5O1xyXG5cclxuICAgIC8vIEBwdWJsaWMgKHJlYWQtb25seSkgLSBsaXN0IG9mIGVuZXJneSBjaHVua3Mgb3duZWQgYnkgdGhpcyBtb2RlbCBlbGVtZW50XHJcbiAgICB0aGlzLmVuZXJneUNodW5rTGlzdCA9IGNyZWF0ZU9ic2VydmFibGVBcnJheSgge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2VuZXJneUNodW5rTGlzdCcgKSxcclxuICAgICAgcGhldGlvVHlwZTogY3JlYXRlT2JzZXJ2YWJsZUFycmF5Lk9ic2VydmFibGVBcnJheUlPKCBSZWZlcmVuY2VJTyggRW5lcmd5Q2h1bmsuRW5lcmd5Q2h1bmtJTyApIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIHtzdHJpbmd9IC0gdW5pcXVlIElEXHJcbiAgICB0aGlzLmlkID0gYGFpci0ke2luc3RhbmNlQ291bnRlcisrfWA7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMuZW5lcmd5Q2h1bmtHcm91cCA9IGVuZXJneUNodW5rR3JvdXA7XHJcbiAgICB0aGlzLmVuZXJneUNodW5rV2FuZGVyQ29udHJvbGxlckdyb3VwID0gZW5lcmd5Q2h1bmtXYW5kZXJDb250cm9sbGVyR3JvdXA7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge09ic2VydmFibGVBcnJheURlZi48RW5lcmd5Q2h1bmtXYW5kZXJDb250cm9sbGVyPn0gLSB3YW5kZXIgY29udHJvbGxlcnMgZm9yIGVuZXJneSBjaHVua3MgdGhhdCBhcmUgb3duZWQgYnlcclxuICAgIC8vIHRoaXMgbW9kZWwgZWxlbWVudCBidXQgYXJlIHdhbmRlcmluZyBvdXRzaWRlIG9mIGl0LlxyXG4gICAgdGhpcy5lbmVyZ3lDaHVua1dhbmRlckNvbnRyb2xsZXJzID0gY3JlYXRlT2JzZXJ2YWJsZUFycmF5KCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZW5lcmd5Q2h1bmtXYW5kZXJDb250cm9sbGVycycgKSxcclxuICAgICAgcGhldGlvVHlwZTogY3JlYXRlT2JzZXJ2YWJsZUFycmF5Lk9ic2VydmFibGVBcnJheUlPKCBSZWZlcmVuY2VJTyggRW5lcmd5Q2h1bmtXYW5kZXJDb250cm9sbGVyLkVuZXJneUNodW5rV2FuZGVyQ29udHJvbGxlcklPICkgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtudW1iZXJ9IC0gdG90YWwgZW5lcmd5IG9mIHRoZSBhaXIsIGFjY2Vzc2libGUgdGhyb3VnaCBnZXR0ZXJzL3NldHRlcnMgZGVmaW5lZCBiZWxvd1xyXG4gICAgdGhpcy5lbmVyZ3kgPSBJTklUSUFMX0VORVJHWTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHN0ZXAgZnVuY3Rpb24gZm9yIHRoaXMgbW9kZWwgZWxlbWVudFxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBkdCAtIGRlbHRhIHRpbWUsIGluIHNlY29uZHNcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc3RlcCggZHQgKSB7XHJcbiAgICBjb25zdCB3YW5kZXJDb250cm9sbGVycyA9IHRoaXMuZW5lcmd5Q2h1bmtXYW5kZXJDb250cm9sbGVycy5zbGljZSgpO1xyXG5cclxuICAgIHdhbmRlckNvbnRyb2xsZXJzLmZvckVhY2goIHdhbmRlckNvbnRyb2xsZXIgPT4ge1xyXG4gICAgICB3YW5kZXJDb250cm9sbGVyLnVwZGF0ZVBvc2l0aW9uKCBkdCApO1xyXG4gICAgICBpZiAoIHdhbmRlckNvbnRyb2xsZXIuaXNEZXN0aW5hdGlvblJlYWNoZWQoKSApIHtcclxuXHJcbiAgICAgICAgLy8gVGhlIGVuZXJneSBjaHVjayBoYXMgcmVhY2hlZCBpdHMgZGVzdGluYXRpb24sIHdoaWNoIGZvciB0aGUgYWlyIG1lYW5zIGl0IGhhcyByaXNlbiBvdXQgb2Ygdmlldywgc28gcmVtb3ZlXHJcbiAgICAgICAgLy8gaXQgZnJvbSB0aGUgbW9kZWwuXHJcbiAgICAgICAgdGhpcy5lbmVyZ3lDaHVua0xpc3QucmVtb3ZlKCB3YW5kZXJDb250cm9sbGVyLmVuZXJneUNodW5rICk7XHJcbiAgICAgICAgdGhpcy5lbmVyZ3lDaHVua1dhbmRlckNvbnRyb2xsZXJzLnJlbW92ZSggd2FuZGVyQ29udHJvbGxlciApO1xyXG4gICAgICAgIHRoaXMuZW5lcmd5Q2h1bmtHcm91cC5kaXNwb3NlRWxlbWVudCggd2FuZGVyQ29udHJvbGxlci5lbmVyZ3lDaHVuayApO1xyXG4gICAgICAgIHRoaXMuZW5lcmd5Q2h1bmtXYW5kZXJDb250cm9sbGVyR3JvdXAuZGlzcG9zZUVsZW1lbnQoIHdhbmRlckNvbnRyb2xsZXIgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGRlbHRhRW5lcmd5XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNoYW5nZUVuZXJneSggZGVsdGFFbmVyZ3kgKSB7XHJcbiAgICAvLyBEbyBub3RoaW5nIC0gdGhlIGFpciBpcyBjb25zaWRlcmVkIHRvIGJlIGEgaGVhdCBzaW5rIHRoYXQgY2FuIHRha2Ugb3Igc3VwcGx5IGVuZXJneSB3aXRob3V0IGNoYW5naW5nXHJcbiAgICAvLyB0ZW1wZXJhdHVyZS5UaGlzIHdhcyBjaGFuZ2VkIGluIERlYyAyMDE5IHN1Y2ggdGhhdCB0aGUgYWlyIG5ldmVyIGdhaW5zIG9yIGxvc2VzIGVuZXJneS4gIFRoZSBtb3RpdmVzIGZvciB0aGlzXHJcbiAgICAvLyBjaGFuZ2UgYXJlIGV4cGxhaW5lZCBpbiBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZW5lcmd5LWZvcm1zLWFuZC1jaGFuZ2VzL2lzc3Vlcy8zMDEuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBnZXRFbmVyZ3koKSB7XHJcbiAgICByZXR1cm4gdGhpcy5lbmVyZ3k7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLmVuZXJneSA9IElOSVRJQUxfRU5FUkdZO1xyXG4gICAgdGhpcy5lbmVyZ3lDaHVua0xpc3QuZm9yRWFjaCggY2h1bmsgPT4gdGhpcy5lbmVyZ3lDaHVua0dyb3VwLmRpc3Bvc2VFbGVtZW50KCBjaHVuayApICk7XHJcbiAgICB0aGlzLmVuZXJneUNodW5rTGlzdC5jbGVhcigpO1xyXG5cclxuICAgIHRoaXMuZW5lcmd5Q2h1bmtXYW5kZXJDb250cm9sbGVycy5mb3JFYWNoKCB3YW5kZXJDb250cm9sbGVyID0+IHRoaXMuZW5lcmd5Q2h1bmtXYW5kZXJDb250cm9sbGVyR3JvdXAuZGlzcG9zZUVsZW1lbnQoIHdhbmRlckNvbnRyb2xsZXIgKSApO1xyXG4gICAgdGhpcy5lbmVyZ3lDaHVua1dhbmRlckNvbnRyb2xsZXJzLmNsZWFyKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBleGNoYW5nZSB0aGVybWFsIGVuZXJneSB3aXRoIHRoZSBwcm92aWRlZCBlbmVyZ3kgY29udGFpbmVyXHJcbiAgICogQHBhcmFtIHtSZWN0YW5ndWxhclRoZXJtYWxNb3ZhYmxlTW9kZWxFbGVtZW50fSBlbmVyZ3lDb250YWluZXJcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHQgLSB0aW1lIGluIHNlY29uZHNcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfSAtIGVuZXJneSwgaW4gam91bGVzLCB0aGF0IGlzIHRyYW5zZmVycmVkIGZyb20gYWlyIHRvIHRoZSBvYmplY3QsIG5lZ2F0aXZlIGlmIGVuZXJneSB3YXMgYWJzb3NyYmVkXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGV4Y2hhbmdlRW5lcmd5V2l0aCggZW5lcmd5Q29udGFpbmVyLCBkdCApIHtcclxuICAgIGxldCBlbmVyZ3lUb0V4Y2hhbmdlID0gMDtcclxuICAgIGNvbnN0IHRoZXJtYWxDb250YWN0TGVuZ3RoID0gdGhpcy50aGVybWFsQ29udGFjdEFyZWEuZ2V0VGhlcm1hbENvbnRhY3RMZW5ndGgoIGVuZXJneUNvbnRhaW5lci50aGVybWFsQ29udGFjdEFyZWEgKTtcclxuICAgIGlmICggdGhlcm1hbENvbnRhY3RMZW5ndGggPiAwICkge1xyXG5cclxuICAgICAgLy8gY2FsY3VsYXRlIHRoZSBhbW91bnQgb2YgZW5lcmd5IHRvIGV4Y2hhbmdlIGJhc2VkIG9uIHRoZSB0aGVybWFsIGRpZmZlcmVudGlhbFxyXG4gICAgICBjb25zdCBoZWF0VHJhbnNmZXJDb25zdGFudCA9IEhlYXRUcmFuc2ZlckNvbnN0YW50cy5nZXRIZWF0VHJhbnNmZXJGYWN0b3IoXHJcbiAgICAgICAgdGhpcy5lbmVyZ3lDb250YWluZXJDYXRlZ29yeSxcclxuICAgICAgICBlbmVyZ3lDb250YWluZXIuZW5lcmd5Q29udGFpbmVyQ2F0ZWdvcnlcclxuICAgICAgKTtcclxuICAgICAgY29uc3QgbnVtYmVyT2ZGdWxsVGltZVN0ZXBFeGNoYW5nZXMgPSBNYXRoLmZsb29yKCBkdCAvIEVGQUNDb25zdGFudHMuTUFYX0hFQVRfRVhDSEFOR0VfVElNRV9TVEVQICk7XHJcbiAgICAgIGNvbnN0IGxlZnRvdmVyVGltZSA9IGR0IC0gKCBudW1iZXJPZkZ1bGxUaW1lU3RlcEV4Y2hhbmdlcyAqIEVGQUNDb25zdGFudHMuTUFYX0hFQVRfRVhDSEFOR0VfVElNRV9TVEVQICk7XHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IG51bWJlck9mRnVsbFRpbWVTdGVwRXhjaGFuZ2VzICsgMTsgaSsrICkge1xyXG4gICAgICAgIGNvbnN0IHRpbWVTdGVwID0gaSA8IG51bWJlck9mRnVsbFRpbWVTdGVwRXhjaGFuZ2VzID8gRUZBQ0NvbnN0YW50cy5NQVhfSEVBVF9FWENIQU5HRV9USU1FX1NURVAgOiBsZWZ0b3ZlclRpbWU7XHJcbiAgICAgICAgY29uc3QgdGhlcm1hbEVuZXJneUdhaW5lZCA9ICggZW5lcmd5Q29udGFpbmVyLmdldFRlbXBlcmF0dXJlKCkgLSB0aGlzLmdldFRlbXBlcmF0dXJlKCkgKSAqXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZXJtYWxDb250YWN0TGVuZ3RoICogaGVhdFRyYW5zZmVyQ29uc3RhbnQgKiB0aW1lU3RlcDtcclxuICAgICAgICBlbmVyZ3lUb0V4Y2hhbmdlICs9IHRoZXJtYWxFbmVyZ3lHYWluZWQ7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIElmIHRoZSBjb250YWluZXIgaGFzIFwiZXhjZXNzIGVuZXJneVwiLCB3aGljaCBjYW4gaGFwcGVuIGluIGNhc2VzIHN1Y2ggYXMgd2hlcmUgZW5lcmd5IGhhcyBiZWVuIGFkZGVkIHRvIHdhdGVyXHJcbiAgICAgIC8vIHRoYXQgaXMgYWxyZWFkeSBhdCB0aGUgYm9pbGluZyBwb2ludCwgYWxsIG9mIHRoYXQgZW5lcmd5IHNob3VsZCBiZSBkdW1wZWQgaW50byB0aGUgYWlyLlxyXG4gICAgICBpZiAoIGVuZXJneVRvRXhjaGFuZ2UgPj0gMCApIHtcclxuICAgICAgICBlbmVyZ3lUb0V4Y2hhbmdlID0gTWF0aC5tYXgoIGVuZXJneVRvRXhjaGFuZ2UsIGVuZXJneUNvbnRhaW5lci5nZXRFbmVyZ3lCZXlvbmRNYXhUZW1wZXJhdHVyZSgpICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGNhbGN1bGF0aW9ucyBhcmUgY29tcGxldGUsIGRvIHRoZSBhY3R1YWwgZXhjaGFuZ2VcclxuICAgICAgZW5lcmd5Q29udGFpbmVyLmNoYW5nZUVuZXJneSggLWVuZXJneVRvRXhjaGFuZ2UgKTtcclxuICAgIH1cclxuICAgIHJldHVybiAtZW5lcmd5VG9FeGNoYW5nZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7RW5lcmd5Q2h1bmt9IGVuZXJneUNodW5rXHJcbiAgICogQHBhcmFtIHtSYW5nZX0gaG9yaXpvbnRhbFdhbmRlckNvbnN0cmFpbnRcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgYWRkRW5lcmd5Q2h1bmsoIGVuZXJneUNodW5rLCBob3Jpem9udGFsV2FuZGVyQ29uc3RyYWludCApIHtcclxuICAgIGVuZXJneUNodW5rLnpQb3NpdGlvblByb3BlcnR5LnZhbHVlID0gMDtcclxuICAgIHRoaXMuZW5lcmd5Q2h1bmtMaXN0LnB1c2goIGVuZXJneUNodW5rICk7XHJcbiAgICB0aGlzLmVuZXJneUNodW5rV2FuZGVyQ29udHJvbGxlcnMucHVzaCggdGhpcy5lbmVyZ3lDaHVua1dhbmRlckNvbnRyb2xsZXJHcm91cC5jcmVhdGVOZXh0RWxlbWVudChcclxuICAgICAgZW5lcmd5Q2h1bmssXHJcbiAgICAgIG5ldyBWZWN0b3IyUHJvcGVydHkoIG5ldyBWZWN0b3IyKCBlbmVyZ3lDaHVuay5wb3NpdGlvblByb3BlcnR5LnZhbHVlLngsIFNJWkUuaGVpZ2h0ICkgKSxcclxuICAgICAgeyBob3Jpem9udGFsV2FuZGVyQ29uc3RyYWludDogaG9yaXpvbnRhbFdhbmRlckNvbnN0cmFpbnQgfVxyXG4gICAgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHJldHVybnMge1ZlY3RvcjJ9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGdldENlbnRlclBvaW50KCkge1xyXG4gICAgcmV0dXJuIG5ldyBWZWN0b3IyKCAwLCBTSVpFLmhlaWdodCAvIDIgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGNyZWF0ZSBhIG5ldyBlbmVyZ3kgY2h1bmsgYXQgdGhlIHRvcCBvZiB0aGUgYWlyIGFib3ZlIHRoZSBzcGVjaWZpZWQgcG9pbnRcclxuICAgKiBAcGFyYW0ge1ZlY3RvcjJ9IHBvaW50XHJcbiAgICogQHJldHVybnMge0VuZXJneUNodW5rfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICByZXF1ZXN0RW5lcmd5Q2h1bmsoIHBvaW50ICkge1xyXG5cclxuICAgIC8vIGNyZWF0ZSBhIG5ldyBjaHVuayBhdCB0aGUgdG9wIG9mIHRoZSBhaXIgYWJvdmUgdGhlIHNwZWNpZmllZCBwb2ludFxyXG4gICAgcmV0dXJuIHRoaXMuZW5lcmd5Q2h1bmtHcm91cC5jcmVhdGVOZXh0RWxlbWVudChcclxuICAgICAgRW5lcmd5VHlwZS5USEVSTUFMLFxyXG4gICAgICBuZXcgVmVjdG9yMiggcG9pbnQueCwgU0laRS5oZWlnaHQgKSxcclxuICAgICAgbmV3IFZlY3RvcjIoIDAsIDAgKSxcclxuICAgICAgdGhpcy5lbmVyZ3lDaHVua3NWaXNpYmxlUHJvcGVydHlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBnZXQgdGhlIHRoZXJtYWwgY29udGFjdCBhcmVhIGZvciBhaXIsIHdoZXJlIHRoZXJtYWwgZW5lcmd5IG1heSBiZSBleGNoYW5nZWQgd2l0aCBvdGhlciBvYmplY3RzXHJcbiAgICogQHJldHVybnMge1RoZXJtYWxDb250YWN0QXJlYX1cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZ2V0IHRoZXJtYWxDb250YWN0QXJlYSgpIHtcclxuICAgIHJldHVybiBUSEVSTUFMX0NPTlRBQ1RfQVJFQTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGdldCB0aGUgYWlyIHRlbXBlcmF0dXJlXHJcbiAgICogQHJldHVybnMge251bWJlcn1cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZ2V0VGVtcGVyYXR1cmUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5lbmVyZ3kgLyAoIE1BU1MgKiBTUEVDSUZJQ19IRUFUICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcmV0dXJucyB7RW5lcmd5Q29udGFpbmVyQ2F0ZWdvcnl9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGdldCBlbmVyZ3lDb250YWluZXJDYXRlZ29yeSgpIHtcclxuICAgIHJldHVybiBFbmVyZ3lDb250YWluZXJDYXRlZ29yeS5BSVI7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBnZXRFbmVyZ3lCZXlvbmRNYXhUZW1wZXJhdHVyZSgpIHtcclxuXHJcbiAgICAvLyBhaXIgdGVtcGVyYXR1cmUgaXMgdW5saW1pdGVkXHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcbn1cclxuXHJcbmVuZXJneUZvcm1zQW5kQ2hhbmdlcy5yZWdpc3RlciggJ0FpcicsIEFpciApO1xyXG5leHBvcnQgZGVmYXVsdCBBaXI7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLHFCQUFxQixNQUFNLDhDQUE4QztBQUNoRixPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLFVBQVUsTUFBTSxrQ0FBa0M7QUFDekQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxlQUFlLE1BQU0sdUNBQXVDO0FBQ25FLE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsTUFBTSxNQUFNLGlDQUFpQztBQUNwRCxPQUFPQyxXQUFXLE1BQU0sNENBQTRDO0FBQ3BFLE9BQU9DLGFBQWEsTUFBTSwrQkFBK0I7QUFDekQsT0FBT0MsV0FBVyxNQUFNLG1DQUFtQztBQUMzRCxPQUFPQywyQkFBMkIsTUFBTSxtREFBbUQ7QUFDM0YsT0FBT0MsdUJBQXVCLE1BQU0sK0NBQStDO0FBQ25GLE9BQU9DLFVBQVUsTUFBTSxrQ0FBa0M7QUFDekQsT0FBT0MscUJBQXFCLE1BQU0sNkNBQTZDO0FBQy9FLE9BQU9DLGtCQUFrQixNQUFNLDBDQUEwQztBQUN6RSxPQUFPQyxxQkFBcUIsTUFBTSxnQ0FBZ0M7O0FB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