// Copyright 2016-2022, University of Colorado Boulder

/**
 * a Scenery Node that represents the sun, clouds, and a slider to control the level of cloudiness in the view
 *
 * @author John Blanco
 * @author Andrew Adare
 */

import Multilink from '../../../../axon/js/Multilink.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Matrix3 from '../../../../dot/js/Matrix3.js';
import Range from '../../../../dot/js/Range.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Color, HBox, Image, Node, Path, RadialGradient, Text, VBox } from '../../../../scenery/js/imports.js';
import Panel from '../../../../sun/js/Panel.js';
import VSlider from '../../../../sun/js/VSlider.js';
import cloud_png from '../../../images/cloud_png.js';
import EFACConstants from '../../common/EFACConstants.js';
import EFACQueryParameters from '../../common/EFACQueryParameters.js';
import EnergyChunkLayer from '../../common/view/EnergyChunkLayer.js';
import energyFormsAndChanges from '../../energyFormsAndChanges.js';
import EnergyFormsAndChangesStrings from '../../EnergyFormsAndChangesStrings.js';
import Cloud from '../model/Cloud.js';
import SunEnergySource from '../model/SunEnergySource.js';
import LightRays from './LightRays.js';
import MoveFadeModelElementNode from './MoveFadeModelElementNode.js';
const cloudsString = EnergyFormsAndChangesStrings.clouds;
const lotsString = EnergyFormsAndChangesStrings.lots;
const noneString = EnergyFormsAndChangesStrings.none;

// constants
const CONTROL_PANEL_TITLE_FONT = new PhetFont(16);
const CONTROL_PANEL_TEXT_MAX_WIDTH = 50;
const SLIDER_LABEL_FONT = new PhetFont(12);
class SunNode extends MoveFadeModelElementNode {
  /**
   * @param {SunEnergySource} sun Sun model element
   * @param {Property} energyChunksVisibleProperty
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Tandem} tandem
   */
  constructor(sun, energyChunksVisibleProperty, modelViewTransform, tandem) {
    super(sun, modelViewTransform, tandem);
    const sunCenter = modelViewTransform.modelToViewDelta(SunEnergySource.OFFSET_TO_CENTER_OF_SUN);
    const sunRadius = modelViewTransform.modelToViewDeltaX(sun.radius);
    const lightRays = new LightRays(sunCenter, sunRadius, 1000, 40, Color.YELLOW);
    this.addChild(lightRays);

    // turn off light rays when energy chunks are visible
    energyChunksVisibleProperty.link(chunksVisible => {
      lightRays.setVisible(!chunksVisible);
    });

    // add the sun
    const sunShape = Shape.ellipse(0, 0, sunRadius, sunRadius);
    const sunPath = new Path(sunShape, {
      fill: new RadialGradient(0, 0, 0, 0, 0, sunRadius).addColorStop(0, 'white').addColorStop(0.25, 'white').addColorStop(1, '#FFD700'),
      lineWidth: 1,
      stroke: 'yellow'
    });
    sunPath.setTranslation(sunCenter);

    // create a scale-only MVT since translation of the absorption shapes is done separately
    const scaleOnlyMVT = ModelViewTransform2.createSinglePointScaleInvertedYMapping(Vector2.ZERO, Vector2.ZERO, modelViewTransform.getMatrix().getScaleVector().x);

    // add clouds, initially transparent
    sun.clouds.forEach(cloud => {
      // make a light-absorbing shape from the cloud's absorption ellipse
      const cloudAbsorptionShape = cloud.getCloudAbsorptionReflectionShape();
      const translatedCloudAbsorptionShape = cloudAbsorptionShape.transformed(Matrix3.translation(-sun.positionProperty.value.x, -sun.positionProperty.value.y));
      const scaledAndTranslatedCloudAbsorptionShape = scaleOnlyMVT.modelToViewShape(translatedCloudAbsorptionShape);
      const lightAbsorbingShape = new LightAbsorbingShape(scaledAndTranslatedCloudAbsorptionShape, 0);
      cloud.existenceStrengthProperty.link(existenceStrength => {
        lightAbsorbingShape.absorptionCoefficientProperty.set(existenceStrength / 10);
      });
      lightRays.addLightAbsorbingShape(lightAbsorbingShape);
      const cloudNode = new CloudNode(cloud, modelViewTransform);
      cloudNode.opacity = 0;
      this.addChild(cloudNode);
      if (EFACQueryParameters.showHelperShapes) {
        this.addChild(new Path(scaledAndTranslatedCloudAbsorptionShape, {
          stroke: 'red'
        }));
      }
    });

    // add the energy chunks, which reside on their own layer
    this.addChild(new EnergyChunkLayer(sun.energyChunkList, modelViewTransform, {
      parentPositionProperty: sun.positionProperty
    }));
    this.addChild(sunPath);
    const cloudsPanelTandem = tandem.createTandem('cloudsPanel');

    // add slider panel to control cloudiness
    const slider = new VSlider(sun.cloudinessProportionProperty, new Range(0, 1), {
      top: 0,
      left: 0,
      tandem: cloudsPanelTandem.createTandem('slider')
    });
    const tickLabel = label => {
      return new Text(label, {
        font: SLIDER_LABEL_FONT,
        maxWidth: CONTROL_PANEL_TEXT_MAX_WIDTH
      });
    };
    slider.addMajorTick(0, tickLabel(noneString));
    slider.addMajorTick(1, tickLabel(lotsString));
    const titleText = new Text(cloudsString, {
      font: CONTROL_PANEL_TITLE_FONT,
      maxWidth: CONTROL_PANEL_TEXT_MAX_WIDTH
    });
    const iconNode = new Image(cloud_png, {
      scale: 0.25
    });
    const titleBox = new HBox({
      children: [titleText, iconNode],
      spacing: 10
    });
    const panelContent = new VBox({
      children: [titleBox, slider],
      spacing: 10,
      resize: false
    });
    this.addChild(new Panel(panelContent, {
      fill: EFACConstants.CONTROL_PANEL_BACKGROUND_COLOR,
      stroke: EFACConstants.CONTROL_PANEL_OUTLINE_STROKE,
      lineWidth: EFACConstants.CONTROL_PANEL_OUTLINE_LINE_WIDTH,
      cornerRadius: EFACConstants.CONTROL_PANEL_CORNER_RADIUS,
      centerX: 0,
      centerY: 0,
      resize: false,
      tandem: cloudsPanelTandem
    }));

    // add/remove the light-absorbing shape for the solar panel
    let currentLightAbsorbingShape = null;

    // visible absorption shape used for debugging
    let helperAbsorptionNode = null;
    Multilink.multilink([sun.activeProperty, sun.solarPanel.activeProperty], (sunActive, solarPanelActive) => {
      if (sunActive && solarPanelActive) {
        const absorptionShape = sun.solarPanel.getAbsorptionShape();
        const translatedAbsorptionShape = absorptionShape.transformed(Matrix3.translation(-sun.positionProperty.value.x, -sun.positionProperty.value.y));
        const scaledAndTranslatedAbsorptionShape = scaleOnlyMVT.modelToViewShape(translatedAbsorptionShape);
        currentLightAbsorbingShape = new LightAbsorbingShape(scaledAndTranslatedAbsorptionShape, 1);
        lightRays.addLightAbsorbingShape(currentLightAbsorbingShape);

        // for debug, show absorption shape outline with dotted line visible on top of SolarPanel's helper shape
        if (EFACQueryParameters.showHelperShapes) {
          helperAbsorptionNode = new Path(scaledAndTranslatedAbsorptionShape, {
            stroke: 'lime',
            lineDash: [4, 8]
          });
          this.addChild(helperAbsorptionNode);
        }
      } else if (currentLightAbsorbingShape !== null) {
        lightRays.removeLightAbsorbingShape(currentLightAbsorbingShape);
        currentLightAbsorbingShape = null;

        // for debug
        if (EFACQueryParameters.showHelperShapes && helperAbsorptionNode) {
          this.removeChild(helperAbsorptionNode);
          helperAbsorptionNode = null;
        }
      }
    });
  }
}
class LightAbsorbingShape {
  /**
   * inner type - a shape with observable light absorption coefficient
   * @param {Shape} shape
   * @param {number} initialAbsorptionCoefficient
   */
  constructor(shape, initialAbsorptionCoefficient) {
    // @public {NumberProperty}
    this.absorptionCoefficientProperty = new NumberProperty(initialAbsorptionCoefficient, {
      range: new Range(0, 1)
    });

    // @public (read-only) {Shape}
    this.shape = shape;
  }
}
class CloudNode extends Node {
  /**
   * inner type - a cloud
   * @param cloud
   * @param modelViewTransform
   */
  constructor(cloud, modelViewTransform) {
    super();
    const cloudNode = new Image(cloud_png);
    cloudNode.scale(modelViewTransform.modelToViewDeltaX(Cloud.WIDTH) / cloudNode.width, -modelViewTransform.modelToViewDeltaY(Cloud.HEIGHT) / cloudNode.height);
    this.addChild(cloudNode);
    this.center = modelViewTransform.modelToViewDelta(cloud.offsetFromParent);
    cloud.existenceStrengthProperty.link(opacity => {
      this.opacity = opacity;
    });
  }
}
energyFormsAndChanges.register('SunNode', SunNode);
export default SunNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJOdW1iZXJQcm9wZXJ0eSIsIk1hdHJpeDMiLCJSYW5nZSIsIlZlY3RvcjIiLCJTaGFwZSIsIk1vZGVsVmlld1RyYW5zZm9ybTIiLCJQaGV0Rm9udCIsIkNvbG9yIiwiSEJveCIsIkltYWdlIiwiTm9kZSIsIlBhdGgiLCJSYWRpYWxHcmFkaWVudCIsIlRleHQiLCJWQm94IiwiUGFuZWwiLCJWU2xpZGVyIiwiY2xvdWRfcG5nIiwiRUZBQ0NvbnN0YW50cyIsIkVGQUNRdWVyeVBhcmFtZXRlcnMiLCJFbmVyZ3lDaHVua0xheWVyIiwiZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzIiwiRW5lcmd5Rm9ybXNBbmRDaGFuZ2VzU3RyaW5ncyIsIkNsb3VkIiwiU3VuRW5lcmd5U291cmNlIiwiTGlnaHRSYXlzIiwiTW92ZUZhZGVNb2RlbEVsZW1lbnROb2RlIiwiY2xvdWRzU3RyaW5nIiwiY2xvdWRzIiwibG90c1N0cmluZyIsImxvdHMiLCJub25lU3RyaW5nIiwibm9uZSIsIkNPTlRST0xfUEFORUxfVElUTEVfRk9OVCIsIkNPTlRST0xfUEFORUxfVEVYVF9NQVhfV0lEVEgiLCJTTElERVJfTEFCRUxfRk9OVCIsIlN1bk5vZGUiLCJjb25zdHJ1Y3RvciIsInN1biIsImVuZXJneUNodW5rc1Zpc2libGVQcm9wZXJ0eSIsIm1vZGVsVmlld1RyYW5zZm9ybSIsInRhbmRlbSIsInN1bkNlbnRlciIsIm1vZGVsVG9WaWV3RGVsdGEiLCJPRkZTRVRfVE9fQ0VOVEVSX09GX1NVTiIsInN1blJhZGl1cyIsIm1vZGVsVG9WaWV3RGVsdGFYIiwicmFkaXVzIiwibGlnaHRSYXlzIiwiWUVMTE9XIiwiYWRkQ2hpbGQiLCJsaW5rIiwiY2h1bmtzVmlzaWJsZSIsInNldFZpc2libGUiLCJzdW5TaGFwZSIsImVsbGlwc2UiLCJzdW5QYXRoIiwiZmlsbCIsImFkZENvbG9yU3RvcCIsImxpbmVXaWR0aCIsInN0cm9rZSIsInNldFRyYW5zbGF0aW9uIiwic2NhbGVPbmx5TVZUIiwiY3JlYXRlU2luZ2xlUG9pbnRTY2FsZUludmVydGVkWU1hcHBpbmciLCJaRVJPIiwiZ2V0TWF0cml4IiwiZ2V0U2NhbGVWZWN0b3IiLCJ4IiwiZm9yRWFjaCIsImNsb3VkIiwiY2xvdWRBYnNvcnB0aW9uU2hhcGUiLCJnZXRDbG91ZEFic29ycHRpb25SZWZsZWN0aW9uU2hhcGUiLCJ0cmFuc2xhdGVkQ2xvdWRBYnNvcnB0aW9uU2hhcGUiLCJ0cmFuc2Zvcm1lZCIsInRyYW5zbGF0aW9uIiwicG9zaXRpb25Qcm9wZXJ0eSIsInZhbHVlIiwieSIsInNjYWxlZEFuZFRyYW5zbGF0ZWRDbG91ZEFic29ycHRpb25TaGFwZSIsIm1vZGVsVG9WaWV3U2hhcGUiLCJsaWdodEFic29yYmluZ1NoYXBlIiwiTGlnaHRBYnNvcmJpbmdTaGFwZSIsImV4aXN0ZW5jZVN0cmVuZ3RoUHJvcGVydHkiLCJleGlzdGVuY2VTdHJlbmd0aCIsImFic29ycHRpb25Db2VmZmljaWVudFByb3BlcnR5Iiwic2V0IiwiYWRkTGlnaHRBYnNvcmJpbmdTaGFwZSIsImNsb3VkTm9kZSIsIkNsb3VkTm9kZSIsIm9wYWNpdHkiLCJzaG93SGVscGVyU2hhcGVzIiwiZW5lcmd5Q2h1bmtMaXN0IiwicGFyZW50UG9zaXRpb25Qcm9wZXJ0eSIsImNsb3Vkc1BhbmVsVGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwic2xpZGVyIiwiY2xvdWRpbmVzc1Byb3BvcnRpb25Qcm9wZXJ0eSIsInRvcCIsImxlZnQiLCJ0aWNrTGFiZWwiLCJsYWJlbCIsImZvbnQiLCJtYXhXaWR0aCIsImFkZE1ham9yVGljayIsInRpdGxlVGV4dCIsImljb25Ob2RlIiwic2NhbGUiLCJ0aXRsZUJveCIsImNoaWxkcmVuIiwic3BhY2luZyIsInBhbmVsQ29udGVudCIsInJlc2l6ZSIsIkNPTlRST0xfUEFORUxfQkFDS0dST1VORF9DT0xPUiIsIkNPTlRST0xfUEFORUxfT1VUTElORV9TVFJPS0UiLCJDT05UUk9MX1BBTkVMX09VVExJTkVfTElORV9XSURUSCIsImNvcm5lclJhZGl1cyIsIkNPTlRST0xfUEFORUxfQ09STkVSX1JBRElVUyIsImNlbnRlclgiLCJjZW50ZXJZIiwiY3VycmVudExpZ2h0QWJzb3JiaW5nU2hhcGUiLCJoZWxwZXJBYnNvcnB0aW9uTm9kZSIsIm11bHRpbGluayIsImFjdGl2ZVByb3BlcnR5Iiwic29sYXJQYW5lbCIsInN1bkFjdGl2ZSIsInNvbGFyUGFuZWxBY3RpdmUiLCJhYnNvcnB0aW9uU2hhcGUiLCJnZXRBYnNvcnB0aW9uU2hhcGUiLCJ0cmFuc2xhdGVkQWJzb3JwdGlvblNoYXBlIiwic2NhbGVkQW5kVHJhbnNsYXRlZEFic29ycHRpb25TaGFwZSIsImxpbmVEYXNoIiwicmVtb3ZlTGlnaHRBYnNvcmJpbmdTaGFwZSIsInJlbW92ZUNoaWxkIiwic2hhcGUiLCJpbml0aWFsQWJzb3JwdGlvbkNvZWZmaWNpZW50IiwicmFuZ2UiLCJXSURUSCIsIndpZHRoIiwibW9kZWxUb1ZpZXdEZWx0YVkiLCJIRUlHSFQiLCJoZWlnaHQiLCJjZW50ZXIiLCJvZmZzZXRGcm9tUGFyZW50IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJTdW5Ob2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIGEgU2NlbmVyeSBOb2RlIHRoYXQgcmVwcmVzZW50cyB0aGUgc3VuLCBjbG91ZHMsIGFuZCBhIHNsaWRlciB0byBjb250cm9sIHRoZSBsZXZlbCBvZiBjbG91ZGluZXNzIGluIHRoZSB2aWV3XHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICogQGF1dGhvciBBbmRyZXcgQWRhcmVcclxuICovXHJcblxyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IE51bWJlclByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTnVtYmVyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTWF0cml4MyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvTWF0cml4My5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgQ29sb3IsIEhCb3gsIEltYWdlLCBOb2RlLCBQYXRoLCBSYWRpYWxHcmFkaWVudCwgVGV4dCwgVkJveCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBQYW5lbCBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvUGFuZWwuanMnO1xyXG5pbXBvcnQgVlNsaWRlciBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvVlNsaWRlci5qcyc7XHJcbmltcG9ydCBjbG91ZF9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2Nsb3VkX3BuZy5qcyc7XHJcbmltcG9ydCBFRkFDQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9FRkFDQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEVGQUNRdWVyeVBhcmFtZXRlcnMgZnJvbSAnLi4vLi4vY29tbW9uL0VGQUNRdWVyeVBhcmFtZXRlcnMuanMnO1xyXG5pbXBvcnQgRW5lcmd5Q2h1bmtMYXllciBmcm9tICcuLi8uLi9jb21tb24vdmlldy9FbmVyZ3lDaHVua0xheWVyLmpzJztcclxuaW1wb3J0IGVuZXJneUZvcm1zQW5kQ2hhbmdlcyBmcm9tICcuLi8uLi9lbmVyZ3lGb3Jtc0FuZENoYW5nZXMuanMnO1xyXG5pbXBvcnQgRW5lcmd5Rm9ybXNBbmRDaGFuZ2VzU3RyaW5ncyBmcm9tICcuLi8uLi9FbmVyZ3lGb3Jtc0FuZENoYW5nZXNTdHJpbmdzLmpzJztcclxuaW1wb3J0IENsb3VkIGZyb20gJy4uL21vZGVsL0Nsb3VkLmpzJztcclxuaW1wb3J0IFN1bkVuZXJneVNvdXJjZSBmcm9tICcuLi9tb2RlbC9TdW5FbmVyZ3lTb3VyY2UuanMnO1xyXG5pbXBvcnQgTGlnaHRSYXlzIGZyb20gJy4vTGlnaHRSYXlzLmpzJztcclxuaW1wb3J0IE1vdmVGYWRlTW9kZWxFbGVtZW50Tm9kZSBmcm9tICcuL01vdmVGYWRlTW9kZWxFbGVtZW50Tm9kZS5qcyc7XHJcblxyXG5jb25zdCBjbG91ZHNTdHJpbmcgPSBFbmVyZ3lGb3Jtc0FuZENoYW5nZXNTdHJpbmdzLmNsb3VkcztcclxuY29uc3QgbG90c1N0cmluZyA9IEVuZXJneUZvcm1zQW5kQ2hhbmdlc1N0cmluZ3MubG90cztcclxuY29uc3Qgbm9uZVN0cmluZyA9IEVuZXJneUZvcm1zQW5kQ2hhbmdlc1N0cmluZ3Mubm9uZTtcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBDT05UUk9MX1BBTkVMX1RJVExFX0ZPTlQgPSBuZXcgUGhldEZvbnQoIDE2ICk7XHJcbmNvbnN0IENPTlRST0xfUEFORUxfVEVYVF9NQVhfV0lEVEggPSA1MDtcclxuY29uc3QgU0xJREVSX0xBQkVMX0ZPTlQgPSBuZXcgUGhldEZvbnQoIDEyICk7XHJcblxyXG5jbGFzcyBTdW5Ob2RlIGV4dGVuZHMgTW92ZUZhZGVNb2RlbEVsZW1lbnROb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtTdW5FbmVyZ3lTb3VyY2V9IHN1biBTdW4gbW9kZWwgZWxlbWVudFxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHl9IGVuZXJneUNodW5rc1Zpc2libGVQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7TW9kZWxWaWV3VHJhbnNmb3JtMn0gbW9kZWxWaWV3VHJhbnNmb3JtXHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBzdW4sIGVuZXJneUNodW5rc1Zpc2libGVQcm9wZXJ0eSwgbW9kZWxWaWV3VHJhbnNmb3JtLCB0YW5kZW0gKSB7XHJcbiAgICBzdXBlciggc3VuLCBtb2RlbFZpZXdUcmFuc2Zvcm0sIHRhbmRlbSApO1xyXG5cclxuICAgIGNvbnN0IHN1bkNlbnRlciA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhKCBTdW5FbmVyZ3lTb3VyY2UuT0ZGU0VUX1RPX0NFTlRFUl9PRl9TVU4gKTtcclxuICAgIGNvbnN0IHN1blJhZGl1cyA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggc3VuLnJhZGl1cyApO1xyXG4gICAgY29uc3QgbGlnaHRSYXlzID0gbmV3IExpZ2h0UmF5cyggc3VuQ2VudGVyLCBzdW5SYWRpdXMsIDEwMDAsIDQwLCBDb2xvci5ZRUxMT1cgKTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBsaWdodFJheXMgKTtcclxuXHJcbiAgICAvLyB0dXJuIG9mZiBsaWdodCByYXlzIHdoZW4gZW5lcmd5IGNodW5rcyBhcmUgdmlzaWJsZVxyXG4gICAgZW5lcmd5Q2h1bmtzVmlzaWJsZVByb3BlcnR5LmxpbmsoIGNodW5rc1Zpc2libGUgPT4ge1xyXG4gICAgICBsaWdodFJheXMuc2V0VmlzaWJsZSggIWNodW5rc1Zpc2libGUgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBhZGQgdGhlIHN1blxyXG4gICAgY29uc3Qgc3VuU2hhcGUgPSBTaGFwZS5lbGxpcHNlKCAwLCAwLCBzdW5SYWRpdXMsIHN1blJhZGl1cyApO1xyXG4gICAgY29uc3Qgc3VuUGF0aCA9IG5ldyBQYXRoKCBzdW5TaGFwZSwge1xyXG4gICAgICBmaWxsOiBuZXcgUmFkaWFsR3JhZGllbnQoIDAsIDAsIDAsIDAsIDAsIHN1blJhZGl1cyApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggMCwgJ3doaXRlJyApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggMC4yNSwgJ3doaXRlJyApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggMSwgJyNGRkQ3MDAnICksXHJcbiAgICAgIGxpbmVXaWR0aDogMSxcclxuICAgICAgc3Ryb2tlOiAneWVsbG93J1xyXG4gICAgfSApO1xyXG5cclxuICAgIHN1blBhdGguc2V0VHJhbnNsYXRpb24oIHN1bkNlbnRlciApO1xyXG5cclxuICAgIC8vIGNyZWF0ZSBhIHNjYWxlLW9ubHkgTVZUIHNpbmNlIHRyYW5zbGF0aW9uIG9mIHRoZSBhYnNvcnB0aW9uIHNoYXBlcyBpcyBkb25lIHNlcGFyYXRlbHlcclxuICAgIGNvbnN0IHNjYWxlT25seU1WVCA9IE1vZGVsVmlld1RyYW5zZm9ybTIuY3JlYXRlU2luZ2xlUG9pbnRTY2FsZUludmVydGVkWU1hcHBpbmcoXHJcbiAgICAgIFZlY3RvcjIuWkVSTyxcclxuICAgICAgVmVjdG9yMi5aRVJPLFxyXG4gICAgICBtb2RlbFZpZXdUcmFuc2Zvcm0uZ2V0TWF0cml4KCkuZ2V0U2NhbGVWZWN0b3IoKS54XHJcbiAgICApO1xyXG5cclxuICAgIC8vIGFkZCBjbG91ZHMsIGluaXRpYWxseSB0cmFuc3BhcmVudFxyXG4gICAgc3VuLmNsb3Vkcy5mb3JFYWNoKCBjbG91ZCA9PiB7XHJcblxyXG4gICAgICAvLyBtYWtlIGEgbGlnaHQtYWJzb3JiaW5nIHNoYXBlIGZyb20gdGhlIGNsb3VkJ3MgYWJzb3JwdGlvbiBlbGxpcHNlXHJcbiAgICAgIGNvbnN0IGNsb3VkQWJzb3JwdGlvblNoYXBlID0gY2xvdWQuZ2V0Q2xvdWRBYnNvcnB0aW9uUmVmbGVjdGlvblNoYXBlKCk7XHJcbiAgICAgIGNvbnN0IHRyYW5zbGF0ZWRDbG91ZEFic29ycHRpb25TaGFwZSA9IGNsb3VkQWJzb3JwdGlvblNoYXBlLnRyYW5zZm9ybWVkKCBNYXRyaXgzLnRyYW5zbGF0aW9uKFxyXG4gICAgICAgIC1zdW4ucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS54LFxyXG4gICAgICAgIC1zdW4ucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS55XHJcbiAgICAgICkgKTtcclxuICAgICAgY29uc3Qgc2NhbGVkQW5kVHJhbnNsYXRlZENsb3VkQWJzb3JwdGlvblNoYXBlID0gc2NhbGVPbmx5TVZULm1vZGVsVG9WaWV3U2hhcGUoIHRyYW5zbGF0ZWRDbG91ZEFic29ycHRpb25TaGFwZSApO1xyXG4gICAgICBjb25zdCBsaWdodEFic29yYmluZ1NoYXBlID0gbmV3IExpZ2h0QWJzb3JiaW5nU2hhcGUoIHNjYWxlZEFuZFRyYW5zbGF0ZWRDbG91ZEFic29ycHRpb25TaGFwZSwgMCApO1xyXG5cclxuICAgICAgY2xvdWQuZXhpc3RlbmNlU3RyZW5ndGhQcm9wZXJ0eS5saW5rKCBleGlzdGVuY2VTdHJlbmd0aCA9PiB7XHJcbiAgICAgICAgbGlnaHRBYnNvcmJpbmdTaGFwZS5hYnNvcnB0aW9uQ29lZmZpY2llbnRQcm9wZXJ0eS5zZXQoIGV4aXN0ZW5jZVN0cmVuZ3RoIC8gMTAgKTtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgbGlnaHRSYXlzLmFkZExpZ2h0QWJzb3JiaW5nU2hhcGUoIGxpZ2h0QWJzb3JiaW5nU2hhcGUgKTtcclxuXHJcbiAgICAgIGNvbnN0IGNsb3VkTm9kZSA9IG5ldyBDbG91ZE5vZGUoIGNsb3VkLCBtb2RlbFZpZXdUcmFuc2Zvcm0gKTtcclxuICAgICAgY2xvdWROb2RlLm9wYWNpdHkgPSAwO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCBjbG91ZE5vZGUgKTtcclxuXHJcbiAgICAgIGlmICggRUZBQ1F1ZXJ5UGFyYW1ldGVycy5zaG93SGVscGVyU2hhcGVzICkge1xyXG4gICAgICAgIHRoaXMuYWRkQ2hpbGQoIG5ldyBQYXRoKCBzY2FsZWRBbmRUcmFuc2xhdGVkQ2xvdWRBYnNvcnB0aW9uU2hhcGUsIHtcclxuICAgICAgICAgIHN0cm9rZTogJ3JlZCdcclxuICAgICAgICB9ICkgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGFkZCB0aGUgZW5lcmd5IGNodW5rcywgd2hpY2ggcmVzaWRlIG9uIHRoZWlyIG93biBsYXllclxyXG4gICAgdGhpcy5hZGRDaGlsZCggbmV3IEVuZXJneUNodW5rTGF5ZXIoIHN1bi5lbmVyZ3lDaHVua0xpc3QsIG1vZGVsVmlld1RyYW5zZm9ybSwge1xyXG4gICAgICBwYXJlbnRQb3NpdGlvblByb3BlcnR5OiBzdW4ucG9zaXRpb25Qcm9wZXJ0eVxyXG4gICAgfSApICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBzdW5QYXRoICk7XHJcbiAgICBjb25zdCBjbG91ZHNQYW5lbFRhbmRlbSA9IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdjbG91ZHNQYW5lbCcgKTtcclxuXHJcbiAgICAvLyBhZGQgc2xpZGVyIHBhbmVsIHRvIGNvbnRyb2wgY2xvdWRpbmVzc1xyXG4gICAgY29uc3Qgc2xpZGVyID0gbmV3IFZTbGlkZXIoXHJcbiAgICAgIHN1bi5jbG91ZGluZXNzUHJvcG9ydGlvblByb3BlcnR5LFxyXG4gICAgICBuZXcgUmFuZ2UoIDAsIDEgKSwge1xyXG4gICAgICAgIHRvcDogMCwgbGVmdDogMCxcclxuICAgICAgICB0YW5kZW06IGNsb3Vkc1BhbmVsVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3NsaWRlcicgKVxyXG4gICAgICB9XHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHRpY2tMYWJlbCA9IGxhYmVsID0+IHtcclxuICAgICAgcmV0dXJuIG5ldyBUZXh0KCBsYWJlbCwge1xyXG4gICAgICAgIGZvbnQ6IFNMSURFUl9MQUJFTF9GT05ULFxyXG4gICAgICAgIG1heFdpZHRoOiBDT05UUk9MX1BBTkVMX1RFWFRfTUFYX1dJRFRIXHJcbiAgICAgIH0gKTtcclxuICAgIH07XHJcblxyXG4gICAgc2xpZGVyLmFkZE1ham9yVGljayggMCwgdGlja0xhYmVsKCBub25lU3RyaW5nICkgKTtcclxuICAgIHNsaWRlci5hZGRNYWpvclRpY2soIDEsIHRpY2tMYWJlbCggbG90c1N0cmluZyApICk7XHJcblxyXG4gICAgY29uc3QgdGl0bGVUZXh0ID0gbmV3IFRleHQoIGNsb3Vkc1N0cmluZywge1xyXG4gICAgICBmb250OiBDT05UUk9MX1BBTkVMX1RJVExFX0ZPTlQsXHJcbiAgICAgIG1heFdpZHRoOiBDT05UUk9MX1BBTkVMX1RFWFRfTUFYX1dJRFRIXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgaWNvbk5vZGUgPSBuZXcgSW1hZ2UoIGNsb3VkX3BuZywgeyBzY2FsZTogMC4yNSB9ICk7XHJcblxyXG4gICAgY29uc3QgdGl0bGVCb3ggPSBuZXcgSEJveCgge1xyXG4gICAgICBjaGlsZHJlbjogWyB0aXRsZVRleHQsIGljb25Ob2RlIF0sXHJcbiAgICAgIHNwYWNpbmc6IDEwXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgcGFuZWxDb250ZW50ID0gbmV3IFZCb3goIHtcclxuICAgICAgY2hpbGRyZW46IFsgdGl0bGVCb3gsIHNsaWRlciBdLFxyXG4gICAgICBzcGFjaW5nOiAxMCxcclxuICAgICAgcmVzaXplOiBmYWxzZVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIG5ldyBQYW5lbCggcGFuZWxDb250ZW50LCB7XHJcbiAgICAgIGZpbGw6IEVGQUNDb25zdGFudHMuQ09OVFJPTF9QQU5FTF9CQUNLR1JPVU5EX0NPTE9SLFxyXG4gICAgICBzdHJva2U6IEVGQUNDb25zdGFudHMuQ09OVFJPTF9QQU5FTF9PVVRMSU5FX1NUUk9LRSxcclxuICAgICAgbGluZVdpZHRoOiBFRkFDQ29uc3RhbnRzLkNPTlRST0xfUEFORUxfT1VUTElORV9MSU5FX1dJRFRILFxyXG4gICAgICBjb3JuZXJSYWRpdXM6IEVGQUNDb25zdGFudHMuQ09OVFJPTF9QQU5FTF9DT1JORVJfUkFESVVTLFxyXG4gICAgICBjZW50ZXJYOiAwLFxyXG4gICAgICBjZW50ZXJZOiAwLFxyXG4gICAgICByZXNpemU6IGZhbHNlLFxyXG4gICAgICB0YW5kZW06IGNsb3Vkc1BhbmVsVGFuZGVtXHJcbiAgICB9ICkgKTtcclxuXHJcbiAgICAvLyBhZGQvcmVtb3ZlIHRoZSBsaWdodC1hYnNvcmJpbmcgc2hhcGUgZm9yIHRoZSBzb2xhciBwYW5lbFxyXG4gICAgbGV0IGN1cnJlbnRMaWdodEFic29yYmluZ1NoYXBlID0gbnVsbDtcclxuXHJcbiAgICAvLyB2aXNpYmxlIGFic29ycHRpb24gc2hhcGUgdXNlZCBmb3IgZGVidWdnaW5nXHJcbiAgICBsZXQgaGVscGVyQWJzb3JwdGlvbk5vZGUgPSBudWxsO1xyXG5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoXHJcbiAgICAgIFsgc3VuLmFjdGl2ZVByb3BlcnR5LCBzdW4uc29sYXJQYW5lbC5hY3RpdmVQcm9wZXJ0eSBdLFxyXG4gICAgICAoIHN1bkFjdGl2ZSwgc29sYXJQYW5lbEFjdGl2ZSApID0+IHtcclxuXHJcbiAgICAgICAgaWYgKCBzdW5BY3RpdmUgJiYgc29sYXJQYW5lbEFjdGl2ZSApIHtcclxuICAgICAgICAgIGNvbnN0IGFic29ycHRpb25TaGFwZSA9IHN1bi5zb2xhclBhbmVsLmdldEFic29ycHRpb25TaGFwZSgpO1xyXG4gICAgICAgICAgY29uc3QgdHJhbnNsYXRlZEFic29ycHRpb25TaGFwZSA9IGFic29ycHRpb25TaGFwZS50cmFuc2Zvcm1lZCggTWF0cml4My50cmFuc2xhdGlvbihcclxuICAgICAgICAgICAgLXN1bi5wb3NpdGlvblByb3BlcnR5LnZhbHVlLngsXHJcbiAgICAgICAgICAgIC1zdW4ucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS55XHJcbiAgICAgICAgICApICk7XHJcbiAgICAgICAgICBjb25zdCBzY2FsZWRBbmRUcmFuc2xhdGVkQWJzb3JwdGlvblNoYXBlID0gc2NhbGVPbmx5TVZULm1vZGVsVG9WaWV3U2hhcGUoIHRyYW5zbGF0ZWRBYnNvcnB0aW9uU2hhcGUgKTtcclxuICAgICAgICAgIGN1cnJlbnRMaWdodEFic29yYmluZ1NoYXBlID0gbmV3IExpZ2h0QWJzb3JiaW5nU2hhcGUoIHNjYWxlZEFuZFRyYW5zbGF0ZWRBYnNvcnB0aW9uU2hhcGUsIDEgKTtcclxuXHJcbiAgICAgICAgICBsaWdodFJheXMuYWRkTGlnaHRBYnNvcmJpbmdTaGFwZSggY3VycmVudExpZ2h0QWJzb3JiaW5nU2hhcGUgKTtcclxuXHJcbiAgICAgICAgICAvLyBmb3IgZGVidWcsIHNob3cgYWJzb3JwdGlvbiBzaGFwZSBvdXRsaW5lIHdpdGggZG90dGVkIGxpbmUgdmlzaWJsZSBvbiB0b3Agb2YgU29sYXJQYW5lbCdzIGhlbHBlciBzaGFwZVxyXG4gICAgICAgICAgaWYgKCBFRkFDUXVlcnlQYXJhbWV0ZXJzLnNob3dIZWxwZXJTaGFwZXMgKSB7XHJcbiAgICAgICAgICAgIGhlbHBlckFic29ycHRpb25Ob2RlID0gbmV3IFBhdGgoIHNjYWxlZEFuZFRyYW5zbGF0ZWRBYnNvcnB0aW9uU2hhcGUsIHtcclxuICAgICAgICAgICAgICBzdHJva2U6ICdsaW1lJyxcclxuICAgICAgICAgICAgICBsaW5lRGFzaDogWyA0LCA4IF1cclxuICAgICAgICAgICAgfSApO1xyXG4gICAgICAgICAgICB0aGlzLmFkZENoaWxkKCBoZWxwZXJBYnNvcnB0aW9uTm9kZSApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICggY3VycmVudExpZ2h0QWJzb3JiaW5nU2hhcGUgIT09IG51bGwgKSB7XHJcbiAgICAgICAgICBsaWdodFJheXMucmVtb3ZlTGlnaHRBYnNvcmJpbmdTaGFwZSggY3VycmVudExpZ2h0QWJzb3JiaW5nU2hhcGUgKTtcclxuICAgICAgICAgIGN1cnJlbnRMaWdodEFic29yYmluZ1NoYXBlID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAvLyBmb3IgZGVidWdcclxuICAgICAgICAgIGlmICggRUZBQ1F1ZXJ5UGFyYW1ldGVycy5zaG93SGVscGVyU2hhcGVzICYmIGhlbHBlckFic29ycHRpb25Ob2RlICkge1xyXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUNoaWxkKCBoZWxwZXJBYnNvcnB0aW9uTm9kZSApO1xyXG4gICAgICAgICAgICBoZWxwZXJBYnNvcnB0aW9uTm9kZSA9IG51bGw7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgTGlnaHRBYnNvcmJpbmdTaGFwZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIGlubmVyIHR5cGUgLSBhIHNoYXBlIHdpdGggb2JzZXJ2YWJsZSBsaWdodCBhYnNvcnB0aW9uIGNvZWZmaWNpZW50XHJcbiAgICogQHBhcmFtIHtTaGFwZX0gc2hhcGVcclxuICAgKiBAcGFyYW0ge251bWJlcn0gaW5pdGlhbEFic29ycHRpb25Db2VmZmljaWVudFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBzaGFwZSwgaW5pdGlhbEFic29ycHRpb25Db2VmZmljaWVudCApIHtcclxuXHJcbiAgICAvLyBAcHVibGljIHtOdW1iZXJQcm9wZXJ0eX1cclxuICAgIHRoaXMuYWJzb3JwdGlvbkNvZWZmaWNpZW50UHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIGluaXRpYWxBYnNvcnB0aW9uQ29lZmZpY2llbnQsIHtcclxuICAgICAgcmFuZ2U6IG5ldyBSYW5nZSggMCwgMSApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAocmVhZC1vbmx5KSB7U2hhcGV9XHJcbiAgICB0aGlzLnNoYXBlID0gc2hhcGU7XHJcbiAgfVxyXG59XHJcblxyXG5jbGFzcyBDbG91ZE5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogaW5uZXIgdHlwZSAtIGEgY2xvdWRcclxuICAgKiBAcGFyYW0gY2xvdWRcclxuICAgKiBAcGFyYW0gbW9kZWxWaWV3VHJhbnNmb3JtXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGNsb3VkLCBtb2RlbFZpZXdUcmFuc2Zvcm0gKSB7XHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIGNvbnN0IGNsb3VkTm9kZSA9IG5ldyBJbWFnZSggY2xvdWRfcG5nICk7XHJcbiAgICBjbG91ZE5vZGUuc2NhbGUoXHJcbiAgICAgIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggQ2xvdWQuV0lEVEggKSAvIGNsb3VkTm9kZS53aWR0aCxcclxuICAgICAgLW1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWSggQ2xvdWQuSEVJR0hUICkgLyBjbG91ZE5vZGUuaGVpZ2h0XHJcbiAgICApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggY2xvdWROb2RlICk7XHJcblxyXG4gICAgdGhpcy5jZW50ZXIgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YSggY2xvdWQub2Zmc2V0RnJvbVBhcmVudCApO1xyXG5cclxuICAgIGNsb3VkLmV4aXN0ZW5jZVN0cmVuZ3RoUHJvcGVydHkubGluayggb3BhY2l0eSA9PiB7XHJcbiAgICAgIHRoaXMub3BhY2l0eSA9IG9wYWNpdHk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5lbmVyZ3lGb3Jtc0FuZENoYW5nZXMucmVnaXN0ZXIoICdTdW5Ob2RlJywgU3VuTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBTdW5Ob2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFNBQVMsTUFBTSxrQ0FBa0M7QUFDeEQsT0FBT0MsY0FBYyxNQUFNLHVDQUF1QztBQUNsRSxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxTQUFTQyxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELE9BQU9DLG1CQUFtQixNQUFNLHVEQUF1RDtBQUN2RixPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLEtBQUssRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUVDLElBQUksRUFBRUMsSUFBSSxFQUFFQyxj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