// Copyright 2018-2022, University of Colorado Boulder

/**
 * a scenery node that represents a light bulb in the view
 *
 * @author John Blanco
 * @author Andrew Adare
 * @author Jesse Greenberg
 * @author Chris Klusendorf (PhET Interactive Simulations)
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import merge from '../../../../phet-core/js/merge.js';
import { Color, Image } from '../../../../scenery/js/imports.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import elementBaseBack_png from '../../../images/elementBaseBack_png.js';
import elementBaseFront_png from '../../../images/elementBaseFront_png.js';
import fluorescentBack_png from '../../../images/fluorescentBack_png.js';
import fluorescentFront_png from '../../../images/fluorescentFront_png.js';
import fluorescentOnBack_png from '../../../images/fluorescentOnBack_png.js';
import fluorescentOnFront_png from '../../../images/fluorescentOnFront_png.js';
import incandescent_png from '../../../images/incandescent_png.js';
import incandescentOn_png from '../../../images/incandescentOn_png.js';
import wireBottomRight_png from '../../../images/wireBottomRight_png.js';
import wireStraight_png from '../../../images/wireStraight_png.js';
import EFACConstants from '../../common/EFACConstants.js';
import EnergyChunkLayer from '../../common/view/EnergyChunkLayer.js';
import energyFormsAndChanges from '../../energyFormsAndChanges.js';
import LightRays from './LightRays.js';
import MoveFadeModelElementNode from './MoveFadeModelElementNode.js';

// constants
const FLUORESCENT_BULB_TOP_OFFSET = 28;
const INCANDESCENT_BULB_TOP_OFFSET = 31;
class LightBulbNode extends MoveFadeModelElementNode {
  /**
   * @param {FluorescentBulb} lightBulb
   * @param {BooleanProperty} energyChunksVisibleProperty
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Object} [options]
   */
  constructor(lightBulb, energyChunksVisibleProperty, modelViewTransform, options) {
    options = merge({
      // LightBulbNode options
      bulbType: 'fluorescent',
      // phet-io
      tandem: Tandem.REQUIRED
    }, options);
    assert && assert(options.bulbType === 'fluorescent' || options.bulbType === 'incandescent', 'bulbType should be fluorescent or incandescent');
    super(lightBulb, modelViewTransform, options.tandem);
    const lightRays = new LightRays(Vector2.ZERO, 30, 400, 20, Color.YELLOW);
    this.addChild(lightRays);

    // only show the light rays when the energy chunks are not shown
    energyChunksVisibleProperty.link(visible => {
      lightRays.setVisible(!visible);
    });

    // add the images and the layer that will contain the energy chunks
    const wireStraightNode = new Image(wireStraight_png, {
      left: -110.5,
      top: 78,
      scale: EFACConstants.WIRE_IMAGE_SCALE
    });
    const wireBottomRightNode = new Image(wireBottomRight_png, {
      left: wireStraightNode.right - 4,
      bottom: wireStraightNode.bottom + 2.3,
      scale: EFACConstants.WIRE_IMAGE_SCALE
    });
    const elementBaseBackNode = new Image(elementBaseBack_png, {
      maxWidth: EFACConstants.ELEMENT_BASE_WIDTH,
      right: wireBottomRightNode.right + 22,
      top: wireBottomRightNode.top - 2.5
    });
    const elementBaseFrontNode = new Image(elementBaseFront_png, {
      maxWidth: elementBaseBackNode.width,
      centerX: elementBaseBackNode.centerX,
      top: wireBottomRightNode.top - 3
    });
    this.addChild(wireStraightNode);
    this.addChild(wireBottomRightNode);
    this.addChild(elementBaseBackNode);
    this.addChild(new EnergyChunkLayer(lightBulb.energyChunkList, modelViewTransform, {
      parentPositionProperty: lightBulb.positionProperty
    }));
    this.addChild(elementBaseFrontNode);
    if (options.bulbType === 'fluorescent') {
      const fluorescentOffBackNode = new Image(fluorescentBack_png, {
        centerX: elementBaseFrontNode.centerX,
        bottom: elementBaseFrontNode.top + FLUORESCENT_BULB_TOP_OFFSET
      });
      const fluorescentOnBackNode = new Image(fluorescentOnBack_png, {
        centerX: elementBaseFrontNode.centerX,
        bottom: elementBaseFrontNode.top + FLUORESCENT_BULB_TOP_OFFSET
      });
      const fluorescentOffFrontNode = new Image(fluorescentFront_png, {
        centerX: elementBaseFrontNode.centerX,
        bottom: elementBaseFrontNode.top + FLUORESCENT_BULB_TOP_OFFSET
      });
      const fluorescentOnFrontNode = new Image(fluorescentOnFront_png, {
        centerX: elementBaseFrontNode.centerX,
        bottom: elementBaseFrontNode.top + FLUORESCENT_BULB_TOP_OFFSET
      });
      this.addChild(fluorescentOffBackNode);
      this.addChild(fluorescentOnBackNode);
      this.addChild(fluorescentOffFrontNode);
      this.addChild(fluorescentOnFrontNode);

      // make bulb partially transparent when energy chunks visible
      energyChunksVisibleProperty.link(visible => {
        const opacity = visible ? 0.7 : 1.0;
        fluorescentOffFrontNode.setOpacity(opacity);
        fluorescentOffBackNode.setOpacity(opacity);
      });

      // center the light rays on the bulb image
      lightRays.y = fluorescentOnFrontNode.bounds.center.y - fluorescentOnFrontNode.bounds.height * 0.1;

      // update the transparency of the lit bulb based on model element
      lightBulb.litProportionProperty.link(litProportion => {
        const opacity = energyChunksVisibleProperty.get() ? 0.7 * litProportion : litProportion;
        fluorescentOnFrontNode.setOpacity(opacity);
        fluorescentOnBackNode.setOpacity(opacity);
        lightRays.setOpacity(opacity);
      });
    } else {
      const incandescentOffNode = new Image(incandescent_png, {
        centerX: elementBaseFrontNode.centerX,
        bottom: elementBaseFrontNode.top + INCANDESCENT_BULB_TOP_OFFSET
      });
      const incandescentOnNode = new Image(incandescentOn_png, {
        centerX: elementBaseFrontNode.centerX,
        bottom: elementBaseFrontNode.top + INCANDESCENT_BULB_TOP_OFFSET
      });
      this.addChild(incandescentOffNode);
      this.addChild(incandescentOnNode);

      // center the light rays on the bulb image
      lightRays.y = incandescentOnNode.bounds.center.y - incandescentOnNode.bounds.height * 0.1;

      // update the transparency of the lit bulb based on model element
      lightBulb.litProportionProperty.link(litProportion => {
        incandescentOnNode.setOpacity(litProportion);
        lightRays.setOpacity(litProportion);
      });
    }
  }
}
energyFormsAndChanges.register('LightBulbNode', LightBulbNode);
export default LightBulbNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwibWVyZ2UiLCJDb2xvciIsIkltYWdlIiwiVGFuZGVtIiwiZWxlbWVudEJhc2VCYWNrX3BuZyIsImVsZW1lbnRCYXNlRnJvbnRfcG5nIiwiZmx1b3Jlc2NlbnRCYWNrX3BuZyIsImZsdW9yZXNjZW50RnJvbnRfcG5nIiwiZmx1b3Jlc2NlbnRPbkJhY2tfcG5nIiwiZmx1b3Jlc2NlbnRPbkZyb250X3BuZyIsImluY2FuZGVzY2VudF9wbmciLCJpbmNhbmRlc2NlbnRPbl9wbmciLCJ3aXJlQm90dG9tUmlnaHRfcG5nIiwid2lyZVN0cmFpZ2h0X3BuZyIsIkVGQUNDb25zdGFudHMiLCJFbmVyZ3lDaHVua0xheWVyIiwiZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzIiwiTGlnaHRSYXlzIiwiTW92ZUZhZGVNb2RlbEVsZW1lbnROb2RlIiwiRkxVT1JFU0NFTlRfQlVMQl9UT1BfT0ZGU0VUIiwiSU5DQU5ERVNDRU5UX0JVTEJfVE9QX09GRlNFVCIsIkxpZ2h0QnVsYk5vZGUiLCJjb25zdHJ1Y3RvciIsImxpZ2h0QnVsYiIsImVuZXJneUNodW5rc1Zpc2libGVQcm9wZXJ0eSIsIm1vZGVsVmlld1RyYW5zZm9ybSIsIm9wdGlvbnMiLCJidWxiVHlwZSIsInRhbmRlbSIsIlJFUVVJUkVEIiwiYXNzZXJ0IiwibGlnaHRSYXlzIiwiWkVSTyIsIllFTExPVyIsImFkZENoaWxkIiwibGluayIsInZpc2libGUiLCJzZXRWaXNpYmxlIiwid2lyZVN0cmFpZ2h0Tm9kZSIsImxlZnQiLCJ0b3AiLCJzY2FsZSIsIldJUkVfSU1BR0VfU0NBTEUiLCJ3aXJlQm90dG9tUmlnaHROb2RlIiwicmlnaHQiLCJib3R0b20iLCJlbGVtZW50QmFzZUJhY2tOb2RlIiwibWF4V2lkdGgiLCJFTEVNRU5UX0JBU0VfV0lEVEgiLCJlbGVtZW50QmFzZUZyb250Tm9kZSIsIndpZHRoIiwiY2VudGVyWCIsImVuZXJneUNodW5rTGlzdCIsInBhcmVudFBvc2l0aW9uUHJvcGVydHkiLCJwb3NpdGlvblByb3BlcnR5IiwiZmx1b3Jlc2NlbnRPZmZCYWNrTm9kZSIsImZsdW9yZXNjZW50T25CYWNrTm9kZSIsImZsdW9yZXNjZW50T2ZmRnJvbnROb2RlIiwiZmx1b3Jlc2NlbnRPbkZyb250Tm9kZSIsIm9wYWNpdHkiLCJzZXRPcGFjaXR5IiwieSIsImJvdW5kcyIsImNlbnRlciIsImhlaWdodCIsImxpdFByb3BvcnRpb25Qcm9wZXJ0eSIsImxpdFByb3BvcnRpb24iLCJnZXQiLCJpbmNhbmRlc2NlbnRPZmZOb2RlIiwiaW5jYW5kZXNjZW50T25Ob2RlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJMaWdodEJ1bGJOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE4LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIGEgc2NlbmVyeSBub2RlIHRoYXQgcmVwcmVzZW50cyBhIGxpZ2h0IGJ1bGIgaW4gdGhlIHZpZXdcclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKiBAYXV0aG9yIEFuZHJldyBBZGFyZVxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZ1xyXG4gKiBAYXV0aG9yIENocmlzIEtsdXNlbmRvcmYgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IHsgQ29sb3IsIEltYWdlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IGVsZW1lbnRCYXNlQmFja19wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2VsZW1lbnRCYXNlQmFja19wbmcuanMnO1xyXG5pbXBvcnQgZWxlbWVudEJhc2VGcm9udF9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2VsZW1lbnRCYXNlRnJvbnRfcG5nLmpzJztcclxuaW1wb3J0IGZsdW9yZXNjZW50QmFja19wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2ZsdW9yZXNjZW50QmFja19wbmcuanMnO1xyXG5pbXBvcnQgZmx1b3Jlc2NlbnRGcm9udF9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2ZsdW9yZXNjZW50RnJvbnRfcG5nLmpzJztcclxuaW1wb3J0IGZsdW9yZXNjZW50T25CYWNrX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvZmx1b3Jlc2NlbnRPbkJhY2tfcG5nLmpzJztcclxuaW1wb3J0IGZsdW9yZXNjZW50T25Gcm9udF9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2ZsdW9yZXNjZW50T25Gcm9udF9wbmcuanMnO1xyXG5pbXBvcnQgaW5jYW5kZXNjZW50X3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvaW5jYW5kZXNjZW50X3BuZy5qcyc7XHJcbmltcG9ydCBpbmNhbmRlc2NlbnRPbl9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2luY2FuZGVzY2VudE9uX3BuZy5qcyc7XHJcbmltcG9ydCB3aXJlQm90dG9tUmlnaHRfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy93aXJlQm90dG9tUmlnaHRfcG5nLmpzJztcclxuaW1wb3J0IHdpcmVTdHJhaWdodF9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL3dpcmVTdHJhaWdodF9wbmcuanMnO1xyXG5pbXBvcnQgRUZBQ0NvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vRUZBQ0NvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBFbmVyZ3lDaHVua0xheWVyIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0VuZXJneUNodW5rTGF5ZXIuanMnO1xyXG5pbXBvcnQgZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzIGZyb20gJy4uLy4uL2VuZXJneUZvcm1zQW5kQ2hhbmdlcy5qcyc7XHJcbmltcG9ydCBMaWdodFJheXMgZnJvbSAnLi9MaWdodFJheXMuanMnO1xyXG5pbXBvcnQgTW92ZUZhZGVNb2RlbEVsZW1lbnROb2RlIGZyb20gJy4vTW92ZUZhZGVNb2RlbEVsZW1lbnROb2RlLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBGTFVPUkVTQ0VOVF9CVUxCX1RPUF9PRkZTRVQgPSAyODtcclxuY29uc3QgSU5DQU5ERVNDRU5UX0JVTEJfVE9QX09GRlNFVCA9IDMxO1xyXG5cclxuY2xhc3MgTGlnaHRCdWxiTm9kZSBleHRlbmRzIE1vdmVGYWRlTW9kZWxFbGVtZW50Tm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7Rmx1b3Jlc2NlbnRCdWxifSBsaWdodEJ1bGJcclxuICAgKiBAcGFyYW0ge0Jvb2xlYW5Qcm9wZXJ0eX0gZW5lcmd5Q2h1bmtzVmlzaWJsZVByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfSBtb2RlbFZpZXdUcmFuc2Zvcm1cclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGxpZ2h0QnVsYiwgZW5lcmd5Q2h1bmtzVmlzaWJsZVByb3BlcnR5LCBtb2RlbFZpZXdUcmFuc2Zvcm0sIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcblxyXG4gICAgICAvLyBMaWdodEJ1bGJOb2RlIG9wdGlvbnNcclxuICAgICAgYnVsYlR5cGU6ICdmbHVvcmVzY2VudCcsXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVEXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydChcclxuICAgICAgb3B0aW9ucy5idWxiVHlwZSA9PT0gJ2ZsdW9yZXNjZW50JyB8fCBvcHRpb25zLmJ1bGJUeXBlID09PSAnaW5jYW5kZXNjZW50JyxcclxuICAgICAgJ2J1bGJUeXBlIHNob3VsZCBiZSBmbHVvcmVzY2VudCBvciBpbmNhbmRlc2NlbnQnXHJcbiAgICApO1xyXG5cclxuICAgIHN1cGVyKCBsaWdodEJ1bGIsIG1vZGVsVmlld1RyYW5zZm9ybSwgb3B0aW9ucy50YW5kZW0gKTtcclxuXHJcbiAgICBjb25zdCBsaWdodFJheXMgPSBuZXcgTGlnaHRSYXlzKCBWZWN0b3IyLlpFUk8sIDMwLCA0MDAsIDIwLCBDb2xvci5ZRUxMT1cgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGxpZ2h0UmF5cyApO1xyXG5cclxuICAgIC8vIG9ubHkgc2hvdyB0aGUgbGlnaHQgcmF5cyB3aGVuIHRoZSBlbmVyZ3kgY2h1bmtzIGFyZSBub3Qgc2hvd25cclxuICAgIGVuZXJneUNodW5rc1Zpc2libGVQcm9wZXJ0eS5saW5rKCB2aXNpYmxlID0+IHtcclxuICAgICAgbGlnaHRSYXlzLnNldFZpc2libGUoICF2aXNpYmxlICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYWRkIHRoZSBpbWFnZXMgYW5kIHRoZSBsYXllciB0aGF0IHdpbGwgY29udGFpbiB0aGUgZW5lcmd5IGNodW5rc1xyXG4gICAgY29uc3Qgd2lyZVN0cmFpZ2h0Tm9kZSA9IG5ldyBJbWFnZSggd2lyZVN0cmFpZ2h0X3BuZywge1xyXG4gICAgICBsZWZ0OiAtMTEwLjUsXHJcbiAgICAgIHRvcDogNzgsXHJcbiAgICAgIHNjYWxlOiBFRkFDQ29uc3RhbnRzLldJUkVfSU1BR0VfU0NBTEVcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IHdpcmVCb3R0b21SaWdodE5vZGUgPSBuZXcgSW1hZ2UoIHdpcmVCb3R0b21SaWdodF9wbmcsIHtcclxuICAgICAgbGVmdDogd2lyZVN0cmFpZ2h0Tm9kZS5yaWdodCAtIDQsXHJcbiAgICAgIGJvdHRvbTogd2lyZVN0cmFpZ2h0Tm9kZS5ib3R0b20gKyAyLjMsXHJcbiAgICAgIHNjYWxlOiBFRkFDQ29uc3RhbnRzLldJUkVfSU1BR0VfU0NBTEVcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IGVsZW1lbnRCYXNlQmFja05vZGUgPSBuZXcgSW1hZ2UoIGVsZW1lbnRCYXNlQmFja19wbmcsIHtcclxuICAgICAgbWF4V2lkdGg6IEVGQUNDb25zdGFudHMuRUxFTUVOVF9CQVNFX1dJRFRILFxyXG4gICAgICByaWdodDogd2lyZUJvdHRvbVJpZ2h0Tm9kZS5yaWdodCArIDIyLFxyXG4gICAgICB0b3A6IHdpcmVCb3R0b21SaWdodE5vZGUudG9wIC0gMi41XHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBlbGVtZW50QmFzZUZyb250Tm9kZSA9IG5ldyBJbWFnZSggZWxlbWVudEJhc2VGcm9udF9wbmcsIHtcclxuICAgICAgbWF4V2lkdGg6IGVsZW1lbnRCYXNlQmFja05vZGUud2lkdGgsXHJcbiAgICAgIGNlbnRlclg6IGVsZW1lbnRCYXNlQmFja05vZGUuY2VudGVyWCxcclxuICAgICAgdG9wOiB3aXJlQm90dG9tUmlnaHROb2RlLnRvcCAtIDNcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCB3aXJlU3RyYWlnaHROb2RlICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB3aXJlQm90dG9tUmlnaHROb2RlICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBlbGVtZW50QmFzZUJhY2tOb2RlICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBuZXcgRW5lcmd5Q2h1bmtMYXllciggbGlnaHRCdWxiLmVuZXJneUNodW5rTGlzdCwgbW9kZWxWaWV3VHJhbnNmb3JtLCB7XHJcbiAgICAgIHBhcmVudFBvc2l0aW9uUHJvcGVydHk6IGxpZ2h0QnVsYi5wb3NpdGlvblByb3BlcnR5XHJcbiAgICB9ICkgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGVsZW1lbnRCYXNlRnJvbnROb2RlICk7XHJcblxyXG4gICAgaWYgKCBvcHRpb25zLmJ1bGJUeXBlID09PSAnZmx1b3Jlc2NlbnQnICkge1xyXG4gICAgICBjb25zdCBmbHVvcmVzY2VudE9mZkJhY2tOb2RlID0gbmV3IEltYWdlKCBmbHVvcmVzY2VudEJhY2tfcG5nLCB7XHJcbiAgICAgICAgY2VudGVyWDogZWxlbWVudEJhc2VGcm9udE5vZGUuY2VudGVyWCxcclxuICAgICAgICBib3R0b206IGVsZW1lbnRCYXNlRnJvbnROb2RlLnRvcCArIEZMVU9SRVNDRU5UX0JVTEJfVE9QX09GRlNFVFxyXG4gICAgICB9ICk7XHJcbiAgICAgIGNvbnN0IGZsdW9yZXNjZW50T25CYWNrTm9kZSA9IG5ldyBJbWFnZSggZmx1b3Jlc2NlbnRPbkJhY2tfcG5nLCB7XHJcbiAgICAgICAgY2VudGVyWDogZWxlbWVudEJhc2VGcm9udE5vZGUuY2VudGVyWCxcclxuICAgICAgICBib3R0b206IGVsZW1lbnRCYXNlRnJvbnROb2RlLnRvcCArIEZMVU9SRVNDRU5UX0JVTEJfVE9QX09GRlNFVFxyXG4gICAgICB9ICk7XHJcbiAgICAgIGNvbnN0IGZsdW9yZXNjZW50T2ZmRnJvbnROb2RlID0gbmV3IEltYWdlKCBmbHVvcmVzY2VudEZyb250X3BuZywge1xyXG4gICAgICAgIGNlbnRlclg6IGVsZW1lbnRCYXNlRnJvbnROb2RlLmNlbnRlclgsXHJcbiAgICAgICAgYm90dG9tOiBlbGVtZW50QmFzZUZyb250Tm9kZS50b3AgKyBGTFVPUkVTQ0VOVF9CVUxCX1RPUF9PRkZTRVRcclxuICAgICAgfSApO1xyXG4gICAgICBjb25zdCBmbHVvcmVzY2VudE9uRnJvbnROb2RlID0gbmV3IEltYWdlKCBmbHVvcmVzY2VudE9uRnJvbnRfcG5nLCB7XHJcbiAgICAgICAgY2VudGVyWDogZWxlbWVudEJhc2VGcm9udE5vZGUuY2VudGVyWCxcclxuICAgICAgICBib3R0b206IGVsZW1lbnRCYXNlRnJvbnROb2RlLnRvcCArIEZMVU9SRVNDRU5UX0JVTEJfVE9QX09GRlNFVFxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICB0aGlzLmFkZENoaWxkKCBmbHVvcmVzY2VudE9mZkJhY2tOb2RlICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIGZsdW9yZXNjZW50T25CYWNrTm9kZSApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCBmbHVvcmVzY2VudE9mZkZyb250Tm9kZSApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCBmbHVvcmVzY2VudE9uRnJvbnROb2RlICk7XHJcblxyXG4gICAgICAvLyBtYWtlIGJ1bGIgcGFydGlhbGx5IHRyYW5zcGFyZW50IHdoZW4gZW5lcmd5IGNodW5rcyB2aXNpYmxlXHJcbiAgICAgIGVuZXJneUNodW5rc1Zpc2libGVQcm9wZXJ0eS5saW5rKCB2aXNpYmxlID0+IHtcclxuICAgICAgICBjb25zdCBvcGFjaXR5ID0gdmlzaWJsZSA/IDAuNyA6IDEuMDtcclxuICAgICAgICBmbHVvcmVzY2VudE9mZkZyb250Tm9kZS5zZXRPcGFjaXR5KCBvcGFjaXR5ICk7XHJcbiAgICAgICAgZmx1b3Jlc2NlbnRPZmZCYWNrTm9kZS5zZXRPcGFjaXR5KCBvcGFjaXR5ICk7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIC8vIGNlbnRlciB0aGUgbGlnaHQgcmF5cyBvbiB0aGUgYnVsYiBpbWFnZVxyXG4gICAgICBsaWdodFJheXMueSA9IGZsdW9yZXNjZW50T25Gcm9udE5vZGUuYm91bmRzLmNlbnRlci55IC0gZmx1b3Jlc2NlbnRPbkZyb250Tm9kZS5ib3VuZHMuaGVpZ2h0ICogMC4xO1xyXG5cclxuICAgICAgLy8gdXBkYXRlIHRoZSB0cmFuc3BhcmVuY3kgb2YgdGhlIGxpdCBidWxiIGJhc2VkIG9uIG1vZGVsIGVsZW1lbnRcclxuICAgICAgbGlnaHRCdWxiLmxpdFByb3BvcnRpb25Qcm9wZXJ0eS5saW5rKCBsaXRQcm9wb3J0aW9uID0+IHtcclxuICAgICAgICBjb25zdCBvcGFjaXR5ID0gZW5lcmd5Q2h1bmtzVmlzaWJsZVByb3BlcnR5LmdldCgpID8gMC43ICogbGl0UHJvcG9ydGlvbiA6IGxpdFByb3BvcnRpb247XHJcbiAgICAgICAgZmx1b3Jlc2NlbnRPbkZyb250Tm9kZS5zZXRPcGFjaXR5KCBvcGFjaXR5ICk7XHJcbiAgICAgICAgZmx1b3Jlc2NlbnRPbkJhY2tOb2RlLnNldE9wYWNpdHkoIG9wYWNpdHkgKTtcclxuICAgICAgICBsaWdodFJheXMuc2V0T3BhY2l0eSggb3BhY2l0eSApO1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgY29uc3QgaW5jYW5kZXNjZW50T2ZmTm9kZSA9IG5ldyBJbWFnZSggaW5jYW5kZXNjZW50X3BuZywge1xyXG4gICAgICAgIGNlbnRlclg6IGVsZW1lbnRCYXNlRnJvbnROb2RlLmNlbnRlclgsXHJcbiAgICAgICAgYm90dG9tOiBlbGVtZW50QmFzZUZyb250Tm9kZS50b3AgKyBJTkNBTkRFU0NFTlRfQlVMQl9UT1BfT0ZGU0VUXHJcbiAgICAgIH0gKTtcclxuICAgICAgY29uc3QgaW5jYW5kZXNjZW50T25Ob2RlID0gbmV3IEltYWdlKCBpbmNhbmRlc2NlbnRPbl9wbmcsIHtcclxuICAgICAgICBjZW50ZXJYOiBlbGVtZW50QmFzZUZyb250Tm9kZS5jZW50ZXJYLFxyXG4gICAgICAgIGJvdHRvbTogZWxlbWVudEJhc2VGcm9udE5vZGUudG9wICsgSU5DQU5ERVNDRU5UX0JVTEJfVE9QX09GRlNFVFxyXG4gICAgICB9ICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIGluY2FuZGVzY2VudE9mZk5vZGUgKTtcclxuICAgICAgdGhpcy5hZGRDaGlsZCggaW5jYW5kZXNjZW50T25Ob2RlICk7XHJcblxyXG4gICAgICAvLyBjZW50ZXIgdGhlIGxpZ2h0IHJheXMgb24gdGhlIGJ1bGIgaW1hZ2VcclxuICAgICAgbGlnaHRSYXlzLnkgPSBpbmNhbmRlc2NlbnRPbk5vZGUuYm91bmRzLmNlbnRlci55IC0gaW5jYW5kZXNjZW50T25Ob2RlLmJvdW5kcy5oZWlnaHQgKiAwLjE7XHJcblxyXG4gICAgICAvLyB1cGRhdGUgdGhlIHRyYW5zcGFyZW5jeSBvZiB0aGUgbGl0IGJ1bGIgYmFzZWQgb24gbW9kZWwgZWxlbWVudFxyXG4gICAgICBsaWdodEJ1bGIubGl0UHJvcG9ydGlvblByb3BlcnR5LmxpbmsoIGxpdFByb3BvcnRpb24gPT4ge1xyXG4gICAgICAgIGluY2FuZGVzY2VudE9uTm9kZS5zZXRPcGFjaXR5KCBsaXRQcm9wb3J0aW9uICk7XHJcbiAgICAgICAgbGlnaHRSYXlzLnNldE9wYWNpdHkoIGxpdFByb3BvcnRpb24gKTtcclxuICAgICAgfSApO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzLnJlZ2lzdGVyKCAnTGlnaHRCdWxiTm9kZScsIExpZ2h0QnVsYk5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgTGlnaHRCdWxiTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxLQUFLLE1BQU0sbUNBQW1DO0FBQ3JELFNBQVNDLEtBQUssRUFBRUMsS0FBSyxRQUFRLG1DQUFtQztBQUNoRSxPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBQ3BELE9BQU9DLG1CQUFtQixNQUFNLHdDQUF3QztBQUN4RSxPQUFPQyxvQkFBb0IsTUFBTSx5Q0FBeUM7QUFDMUUsT0FBT0MsbUJBQW1CLE1BQU0sd0NBQXdDO0FBQ3hFLE9BQU9DLG9CQUFvQixNQUFNLHlDQUF5QztBQUMxRSxPQUFPQyxxQkFBcUIsTUFBTSwwQ0FBMEM7QUFDNUUsT0FBT0Msc0JBQXNCLE1BQU0sMkNBQTJDO0FBQzlFLE9BQU9DLGdCQUFnQixNQUFNLHFDQUFxQztBQUNsRSxPQUFPQyxrQkFBa0IsTUFBTSx1Q0FBdUM7QUFDdEUsT0FBT0MsbUJBQW1CLE1BQU0sd0NBQXdDO0FBQ3hFLE9BQU9DLGdCQUFnQixNQUFNLHFDQUFxQztBQUNsRSxPQUFPQyxhQUFhLE1BQU0sK0JBQStCO0FBQ3pELE9BQU9DLGdCQUFnQixNQUFNLHVDQUF1QztBQUNwRSxPQUFPQyxxQkFBcUIsTUFBTSxnQ0FBZ0M7QUFDbEUsT0FBT0MsU0FBUyxNQUFNLGdCQUFn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