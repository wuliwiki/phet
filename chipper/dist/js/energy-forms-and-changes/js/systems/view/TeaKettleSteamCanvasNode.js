// Copyright 2019-2021, University of Colorado Boulder

/**
 * A node for a concentrated column of steam.
 *
 * @author Chris Klusendorf (PhET Interactive Simulations)
 */

import dotRandom from '../../../../dot/js/dotRandom.js';
import Range from '../../../../dot/js/Range.js';
import Utils from '../../../../dot/js/Utils.js';
import merge from '../../../../phet-core/js/merge.js';
import { CanvasNode } from '../../../../scenery/js/imports.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import EFACConstants from '../../common/EFACConstants.js';
import energyFormsAndChanges from '../../energyFormsAndChanges.js';
import TeaKettle from '../model/TeaKettle.js';

// constants
const STEAM_BUBBLE_SPEED_RANGE = new Range(120, 150); // in screen coordinates / second
const STEAM_BUBBLE_DIAMETER_RANGE = new Range(12, 50); // in screen coordinates
const STEAM_BUBBLE_HEIGHT_RANGE = new Range(10, 160); // in screen coordinates
const STEAM_BUBBLE_RATE_RANGE = new Range(14, 20); // bubbles per second
const STEAM_BUBBLE_GROWTH_RATE = 3; // proportion per second
const STEAM_BUBBLE_MAX_OPACITY = 0.7; // proportion, 0 to 1

class TeaKettleSteamCanvasNode extends CanvasNode {
  /**
   * @param {Vector2} steamOrigin
   * @param {NumberProperty} energyOutputProperty
   * @param {number} maxEnergyOutput
   * @param {Object} [options]
   */
  constructor(steamOrigin, energyOutputProperty, maxEnergyOutput, options) {
    options = merge({
      steamAngle: TeaKettle.SPOUT_EXIT_ANGLE,
      // {number}
      steamFill: 'rgb(255,255,255)' // {string} - white
    }, options);
    super(options);

    // @private
    this.steamOrigin = steamOrigin;
    this.energyOutputProperty = energyOutputProperty;
    this.maxEnergyOutput = maxEnergyOutput;
    this.steamAngle = options.steamAngle;
    this.lastSteamAngle = this.steamAngle;
    this.steamAngleRange = new Range(this.steamAngle * 0.85, this.steamAngle * 1.1); // room for random variation
    this.preloadComplete = true;

    // @private
    this.bubbleProductionRemainder = 0;
    this.steamBubbles = [];

    // @private
    // canvas where the steam bubble image resides
    this.steamBubbleImageCanvas = document.createElement('canvas');
    this.steamBubbleImageCanvas.width = STEAM_BUBBLE_DIAMETER_RANGE.max;
    this.steamBubbleImageCanvas.height = STEAM_BUBBLE_DIAMETER_RANGE.max;
    const context = this.steamBubbleImageCanvas.getContext('2d');

    // draw a steam bubble centered in the steam bubble image canvas
    context.fillStyle = options.steamFill;
    context.beginPath();
    context.arc(STEAM_BUBBLE_DIAMETER_RANGE.max / 2, STEAM_BUBBLE_DIAMETER_RANGE.max / 2, STEAM_BUBBLE_DIAMETER_RANGE.max / 2, 0, Math.PI * 2, true);
    context.fill();
    this.mutate(options);

    // Preload steam animation after state has been set
    Tandem.PHET_IO_ENABLED && phet.phetio.phetioEngine.phetioStateEngine.stateSetEmitter.addListener(() => {
      this.preloadSteam();
    });
  }

  /**
   * Updates the number of steam bubbles and the position, size, and opacity of each one.
   * @param {number} dt
   * @public
   */
  step(dt) {
    const steamingProportion = this.energyOutputProperty.value / this.maxEnergyOutput;

    // add any new steam bubbles
    if (steamingProportion > 0) {
      const bubblesToProduceCalc = (STEAM_BUBBLE_RATE_RANGE.min + STEAM_BUBBLE_RATE_RANGE.getLength() * steamingProportion) * dt;
      let bubblesToProduce = Math.floor(bubblesToProduceCalc);
      this.bubbleProductionRemainder += bubblesToProduceCalc - bubblesToProduce;
      if (this.bubbleProductionRemainder >= 1) {
        bubblesToProduce += Math.floor(this.bubbleProductionRemainder);
        this.bubbleProductionRemainder -= Math.floor(this.bubbleProductionRemainder);
      }

      // allow for a small variation from the previous angle, as long as it's within the valid angle range
      let bubbleAngle = this.lastSteamAngle * (dotRandom.nextDouble() * (1.015 - 0.985) + 0.985);
      bubbleAngle = Utils.clamp(bubbleAngle, this.steamAngleRange.min, this.steamAngleRange.max);
      this.lastSteamAngle = bubbleAngle;

      // add new bubbles
      for (let i = 0; i < bubblesToProduce; i++) {
        const steamBubble = {
          x: this.steamOrigin.x,
          y: this.steamOrigin.y,
          radius: STEAM_BUBBLE_DIAMETER_RANGE.min / 2,
          angle: bubbleAngle,
          opacity: STEAM_BUBBLE_MAX_OPACITY
        };
        this.steamBubbles.push(steamBubble);
      }
    } else {
      this.preloadComplete = true;
    }

    // update the position and appearance of the existing steam bubbles
    const steamBubbleSpeed = STEAM_BUBBLE_SPEED_RANGE.min + steamingProportion * STEAM_BUBBLE_SPEED_RANGE.getLength();

    // create a copy to iterate over so we can splice the original when removing bubbles
    const steamBubblesCopy = [...this.steamBubbles];
    for (let i = 0; i < steamBubblesCopy.length; i++) {
      // update position
      const dy = -dt * steamBubbleSpeed;
      const dx = -dy / Math.tan(steamBubblesCopy[i].angle);
      steamBubblesCopy[i].y += dy;
      steamBubblesCopy[i].x += dx;

      // increase radius
      steamBubblesCopy[i].radius = steamBubblesCopy[i].radius * (1 + STEAM_BUBBLE_GROWTH_RATE * dt);

      // fade out the bubble as it reaches the end of its range
      const steamBubbleMaxHeight = STEAM_BUBBLE_HEIGHT_RANGE.min + steamingProportion * STEAM_BUBBLE_HEIGHT_RANGE.getLength();
      const heightFraction = Utils.clamp((this.steamOrigin.y - steamBubblesCopy[i].y) / steamBubbleMaxHeight, 0, 1);
      steamBubblesCopy[i].opacity = (1 - heightFraction) * STEAM_BUBBLE_MAX_OPACITY;

      // remove bubbles that are out of the current height range
      if (this.steamOrigin.y - steamBubblesCopy[i].y > steamBubbleMaxHeight) {
        this.steamBubbles.splice(i, 1);
        this.preloadComplete = true;
      }
    }
    this.preloadComplete && this.steamBubbles.length && this.invalidatePaint();
  }

  /**
   * Draws a steam bubble.
   * @param {CanvasRenderingContext2D} context
   * @param {Object} steamBubble
   * @private
   */
  drawSteamBubble(context, steamBubble) {
    context.globalAlpha = steamBubble.opacity;
    context.drawImage(this.steamBubbleImageCanvas, steamBubble.x - steamBubble.radius, steamBubble.y - steamBubble.radius, steamBubble.radius * 2, steamBubble.radius * 2);
  }

  /**
   * Paints the steam on the canvas node.
   * @param {CanvasRenderingContext2D} context
   * @public
   */
  paintCanvas(context) {
    for (let i = 0; i < this.steamBubbles.length; i++) {
      this.drawSteamBubble(context, this.steamBubbles[i]);
    }
  }

  /**
   * @public
   */
  reset() {
    this.steamBubbles.length = 0;
  }

  /**
   * Preloads the steam animation.
   * @private
   */
  preloadSteam() {
    this.preloadComplete = false;
    const dt = 1 / EFACConstants.FRAMES_PER_SECOND;
    while (!this.preloadComplete) {
      this.step(dt);
    }
  }
}
energyFormsAndChanges.register('TeaKettleSteamCanvasNode', TeaKettleSteamCanvasNode);
export default TeaKettleSteamCanvasNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJSYW5nZSIsIlV0aWxzIiwibWVyZ2UiLCJDYW52YXNOb2RlIiwiVGFuZGVtIiwiRUZBQ0NvbnN0YW50cyIsImVuZXJneUZvcm1zQW5kQ2hhbmdlcyIsIlRlYUtldHRsZSIsIlNURUFNX0JVQkJMRV9TUEVFRF9SQU5HRSIsIlNURUFNX0JVQkJMRV9ESUFNRVRFUl9SQU5HRSIsIlNURUFNX0JVQkJMRV9IRUlHSFRfUkFOR0UiLCJTVEVBTV9CVUJCTEVfUkFURV9SQU5HRSIsIlNURUFNX0JVQkJMRV9HUk9XVEhfUkFURSIsIlNURUFNX0JVQkJMRV9NQVhfT1BBQ0lUWSIsIlRlYUtldHRsZVN0ZWFtQ2FudmFzTm9kZSIsImNvbnN0cnVjdG9yIiwic3RlYW1PcmlnaW4iLCJlbmVyZ3lPdXRwdXRQcm9wZXJ0eSIsIm1heEVuZXJneU91dHB1dCIsIm9wdGlvbnMiLCJzdGVhbUFuZ2xlIiwiU1BPVVRfRVhJVF9BTkdMRSIsInN0ZWFtRmlsbCIsImxhc3RTdGVhbUFuZ2xlIiwic3RlYW1BbmdsZVJhbmdlIiwicHJlbG9hZENvbXBsZXRlIiwiYnViYmxlUHJvZHVjdGlvblJlbWFpbmRlciIsInN0ZWFtQnViYmxlcyIsInN0ZWFtQnViYmxlSW1hZ2VDYW52YXMiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ3aWR0aCIsIm1heCIsImhlaWdodCIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwiZmlsbFN0eWxlIiwiYmVnaW5QYXRoIiwiYXJjIiwiTWF0aCIsIlBJIiwiZmlsbCIsIm11dGF0ZSIsIlBIRVRfSU9fRU5BQkxFRCIsInBoZXQiLCJwaGV0aW8iLCJwaGV0aW9FbmdpbmUiLCJwaGV0aW9TdGF0ZUVuZ2luZSIsInN0YXRlU2V0RW1pdHRlciIsImFkZExpc3RlbmVyIiwicHJlbG9hZFN0ZWFtIiwic3RlcCIsImR0Iiwic3RlYW1pbmdQcm9wb3J0aW9uIiwidmFsdWUiLCJidWJibGVzVG9Qcm9kdWNlQ2FsYyIsIm1pbiIsImdldExlbmd0aCIsImJ1YmJsZXNUb1Byb2R1Y2UiLCJmbG9vciIsImJ1YmJsZUFuZ2xlIiwibmV4dERvdWJsZSIsImNsYW1wIiwiaSIsInN0ZWFtQnViYmxlIiwieCIsInkiLCJyYWRpdXMiLCJhbmdsZSIsIm9wYWNpdHkiLCJwdXNoIiwic3RlYW1CdWJibGVTcGVlZCIsInN0ZWFtQnViYmxlc0NvcHkiLCJsZW5ndGgiLCJkeSIsImR4IiwidGFuIiwic3RlYW1CdWJibGVNYXhIZWlnaHQiLCJoZWlnaHRGcmFjdGlvbiIsInNwbGljZSIsImludmFsaWRhdGVQYWludCIsImRyYXdTdGVhbUJ1YmJsZSIsImdsb2JhbEFscGhhIiwiZHJhd0ltYWdlIiwicGFpbnRDYW52YXMiLCJyZXNldCIsIkZSQU1FU19QRVJfU0VDT05EIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJUZWFLZXR0bGVTdGVhbUNhbnZhc05vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQSBub2RlIGZvciBhIGNvbmNlbnRyYXRlZCBjb2x1bW4gb2Ygc3RlYW0uXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgS2x1c2VuZG9yZiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgZG90UmFuZG9tIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9kb3RSYW5kb20uanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgeyBDYW52YXNOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IEVGQUNDb25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL0VGQUNDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzIGZyb20gJy4uLy4uL2VuZXJneUZvcm1zQW5kQ2hhbmdlcy5qcyc7XHJcbmltcG9ydCBUZWFLZXR0bGUgZnJvbSAnLi4vbW9kZWwvVGVhS2V0dGxlLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBTVEVBTV9CVUJCTEVfU1BFRURfUkFOR0UgPSBuZXcgUmFuZ2UoIDEyMCwgMTUwICk7IC8vIGluIHNjcmVlbiBjb29yZGluYXRlcyAvIHNlY29uZFxyXG5jb25zdCBTVEVBTV9CVUJCTEVfRElBTUVURVJfUkFOR0UgPSBuZXcgUmFuZ2UoIDEyLCA1MCApOyAvLyBpbiBzY3JlZW4gY29vcmRpbmF0ZXNcclxuY29uc3QgU1RFQU1fQlVCQkxFX0hFSUdIVF9SQU5HRSA9IG5ldyBSYW5nZSggMTAsIDE2MCApOyAvLyBpbiBzY3JlZW4gY29vcmRpbmF0ZXNcclxuY29uc3QgU1RFQU1fQlVCQkxFX1JBVEVfUkFOR0UgPSBuZXcgUmFuZ2UoIDE0LCAyMCApOyAvLyBidWJibGVzIHBlciBzZWNvbmRcclxuY29uc3QgU1RFQU1fQlVCQkxFX0dST1dUSF9SQVRFID0gMzsgLy8gcHJvcG9ydGlvbiBwZXIgc2Vjb25kXHJcbmNvbnN0IFNURUFNX0JVQkJMRV9NQVhfT1BBQ0lUWSA9IDAuNzsgLy8gcHJvcG9ydGlvbiwgMCB0byAxXHJcblxyXG5jbGFzcyBUZWFLZXR0bGVTdGVhbUNhbnZhc05vZGUgZXh0ZW5kcyBDYW52YXNOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBzdGVhbU9yaWdpblxyXG4gICAqIEBwYXJhbSB7TnVtYmVyUHJvcGVydHl9IGVuZXJneU91dHB1dFByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IG1heEVuZXJneU91dHB1dFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvciggc3RlYW1PcmlnaW4sIGVuZXJneU91dHB1dFByb3BlcnR5LCBtYXhFbmVyZ3lPdXRwdXQsIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcbiAgICAgIHN0ZWFtQW5nbGU6IFRlYUtldHRsZS5TUE9VVF9FWElUX0FOR0xFLCAvLyB7bnVtYmVyfVxyXG4gICAgICBzdGVhbUZpbGw6ICdyZ2IoMjU1LDI1NSwyNTUpJyAvLyB7c3RyaW5nfSAtIHdoaXRlXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5zdGVhbU9yaWdpbiA9IHN0ZWFtT3JpZ2luO1xyXG4gICAgdGhpcy5lbmVyZ3lPdXRwdXRQcm9wZXJ0eSA9IGVuZXJneU91dHB1dFByb3BlcnR5O1xyXG4gICAgdGhpcy5tYXhFbmVyZ3lPdXRwdXQgPSBtYXhFbmVyZ3lPdXRwdXQ7XHJcbiAgICB0aGlzLnN0ZWFtQW5nbGUgPSBvcHRpb25zLnN0ZWFtQW5nbGU7XHJcbiAgICB0aGlzLmxhc3RTdGVhbUFuZ2xlID0gdGhpcy5zdGVhbUFuZ2xlO1xyXG4gICAgdGhpcy5zdGVhbUFuZ2xlUmFuZ2UgPSBuZXcgUmFuZ2UoIHRoaXMuc3RlYW1BbmdsZSAqIDAuODUsIHRoaXMuc3RlYW1BbmdsZSAqIDEuMSApOyAvLyByb29tIGZvciByYW5kb20gdmFyaWF0aW9uXHJcbiAgICB0aGlzLnByZWxvYWRDb21wbGV0ZSA9IHRydWU7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMuYnViYmxlUHJvZHVjdGlvblJlbWFpbmRlciA9IDA7XHJcbiAgICB0aGlzLnN0ZWFtQnViYmxlcyA9IFtdO1xyXG5cclxuICAgIC8vIEBwcml2YXRlXHJcbiAgICAvLyBjYW52YXMgd2hlcmUgdGhlIHN0ZWFtIGJ1YmJsZSBpbWFnZSByZXNpZGVzXHJcbiAgICB0aGlzLnN0ZWFtQnViYmxlSW1hZ2VDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnY2FudmFzJyApO1xyXG4gICAgdGhpcy5zdGVhbUJ1YmJsZUltYWdlQ2FudmFzLndpZHRoID0gU1RFQU1fQlVCQkxFX0RJQU1FVEVSX1JBTkdFLm1heDtcclxuICAgIHRoaXMuc3RlYW1CdWJibGVJbWFnZUNhbnZhcy5oZWlnaHQgPSBTVEVBTV9CVUJCTEVfRElBTUVURVJfUkFOR0UubWF4O1xyXG4gICAgY29uc3QgY29udGV4dCA9IHRoaXMuc3RlYW1CdWJibGVJbWFnZUNhbnZhcy5nZXRDb250ZXh0KCAnMmQnICk7XHJcblxyXG4gICAgLy8gZHJhdyBhIHN0ZWFtIGJ1YmJsZSBjZW50ZXJlZCBpbiB0aGUgc3RlYW0gYnViYmxlIGltYWdlIGNhbnZhc1xyXG4gICAgY29udGV4dC5maWxsU3R5bGUgPSBvcHRpb25zLnN0ZWFtRmlsbDtcclxuICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XHJcbiAgICBjb250ZXh0LmFyYyhcclxuICAgICAgU1RFQU1fQlVCQkxFX0RJQU1FVEVSX1JBTkdFLm1heCAvIDIsXHJcbiAgICAgIFNURUFNX0JVQkJMRV9ESUFNRVRFUl9SQU5HRS5tYXggLyAyLFxyXG4gICAgICBTVEVBTV9CVUJCTEVfRElBTUVURVJfUkFOR0UubWF4IC8gMixcclxuICAgICAgMCxcclxuICAgICAgTWF0aC5QSSAqIDIsXHJcbiAgICAgIHRydWVcclxuICAgICk7XHJcbiAgICBjb250ZXh0LmZpbGwoKTtcclxuXHJcbiAgICB0aGlzLm11dGF0ZSggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIFByZWxvYWQgc3RlYW0gYW5pbWF0aW9uIGFmdGVyIHN0YXRlIGhhcyBiZWVuIHNldFxyXG4gICAgVGFuZGVtLlBIRVRfSU9fRU5BQkxFRCAmJiBwaGV0LnBoZXRpby5waGV0aW9FbmdpbmUucGhldGlvU3RhdGVFbmdpbmUuc3RhdGVTZXRFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgIHRoaXMucHJlbG9hZFN0ZWFtKCk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHRoZSBudW1iZXIgb2Ygc3RlYW0gYnViYmxlcyBhbmQgdGhlIHBvc2l0aW9uLCBzaXplLCBhbmQgb3BhY2l0eSBvZiBlYWNoIG9uZS5cclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHRcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc3RlcCggZHQgKSB7XHJcbiAgICBjb25zdCBzdGVhbWluZ1Byb3BvcnRpb24gPSB0aGlzLmVuZXJneU91dHB1dFByb3BlcnR5LnZhbHVlIC8gdGhpcy5tYXhFbmVyZ3lPdXRwdXQ7XHJcblxyXG4gICAgLy8gYWRkIGFueSBuZXcgc3RlYW0gYnViYmxlc1xyXG4gICAgaWYgKCBzdGVhbWluZ1Byb3BvcnRpb24gPiAwICkge1xyXG4gICAgICBjb25zdCBidWJibGVzVG9Qcm9kdWNlQ2FsYyA9XHJcbiAgICAgICAgKCBTVEVBTV9CVUJCTEVfUkFURV9SQU5HRS5taW4gKyBTVEVBTV9CVUJCTEVfUkFURV9SQU5HRS5nZXRMZW5ndGgoKSAqIHN0ZWFtaW5nUHJvcG9ydGlvbiApICogZHQ7XHJcbiAgICAgIGxldCBidWJibGVzVG9Qcm9kdWNlID0gTWF0aC5mbG9vciggYnViYmxlc1RvUHJvZHVjZUNhbGMgKTtcclxuXHJcbiAgICAgIHRoaXMuYnViYmxlUHJvZHVjdGlvblJlbWFpbmRlciArPSBidWJibGVzVG9Qcm9kdWNlQ2FsYyAtIGJ1YmJsZXNUb1Byb2R1Y2U7XHJcblxyXG4gICAgICBpZiAoIHRoaXMuYnViYmxlUHJvZHVjdGlvblJlbWFpbmRlciA+PSAxICkge1xyXG4gICAgICAgIGJ1YmJsZXNUb1Byb2R1Y2UgKz0gTWF0aC5mbG9vciggdGhpcy5idWJibGVQcm9kdWN0aW9uUmVtYWluZGVyICk7XHJcbiAgICAgICAgdGhpcy5idWJibGVQcm9kdWN0aW9uUmVtYWluZGVyIC09IE1hdGguZmxvb3IoIHRoaXMuYnViYmxlUHJvZHVjdGlvblJlbWFpbmRlciApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBhbGxvdyBmb3IgYSBzbWFsbCB2YXJpYXRpb24gZnJvbSB0aGUgcHJldmlvdXMgYW5nbGUsIGFzIGxvbmcgYXMgaXQncyB3aXRoaW4gdGhlIHZhbGlkIGFuZ2xlIHJhbmdlXHJcbiAgICAgIGxldCBidWJibGVBbmdsZSA9IHRoaXMubGFzdFN0ZWFtQW5nbGUgKiAoIGRvdFJhbmRvbS5uZXh0RG91YmxlKCkgKiAoIDEuMDE1IC0gMC45ODUgKSArIDAuOTg1ICk7XHJcbiAgICAgIGJ1YmJsZUFuZ2xlID0gVXRpbHMuY2xhbXAoIGJ1YmJsZUFuZ2xlLCB0aGlzLnN0ZWFtQW5nbGVSYW5nZS5taW4sIHRoaXMuc3RlYW1BbmdsZVJhbmdlLm1heCApO1xyXG4gICAgICB0aGlzLmxhc3RTdGVhbUFuZ2xlID0gYnViYmxlQW5nbGU7XHJcblxyXG4gICAgICAvLyBhZGQgbmV3IGJ1YmJsZXNcclxuICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgYnViYmxlc1RvUHJvZHVjZTsgaSsrICkge1xyXG4gICAgICAgIGNvbnN0IHN0ZWFtQnViYmxlID0ge1xyXG4gICAgICAgICAgeDogdGhpcy5zdGVhbU9yaWdpbi54LFxyXG4gICAgICAgICAgeTogdGhpcy5zdGVhbU9yaWdpbi55LFxyXG4gICAgICAgICAgcmFkaXVzOiBTVEVBTV9CVUJCTEVfRElBTUVURVJfUkFOR0UubWluIC8gMixcclxuICAgICAgICAgIGFuZ2xlOiBidWJibGVBbmdsZSxcclxuICAgICAgICAgIG9wYWNpdHk6IFNURUFNX0JVQkJMRV9NQVhfT1BBQ0lUWVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5zdGVhbUJ1YmJsZXMucHVzaCggc3RlYW1CdWJibGUgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMucHJlbG9hZENvbXBsZXRlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyB1cGRhdGUgdGhlIHBvc2l0aW9uIGFuZCBhcHBlYXJhbmNlIG9mIHRoZSBleGlzdGluZyBzdGVhbSBidWJibGVzXHJcbiAgICBjb25zdCBzdGVhbUJ1YmJsZVNwZWVkID0gU1RFQU1fQlVCQkxFX1NQRUVEX1JBTkdFLm1pbiArIHN0ZWFtaW5nUHJvcG9ydGlvbiAqIFNURUFNX0JVQkJMRV9TUEVFRF9SQU5HRS5nZXRMZW5ndGgoKTtcclxuXHJcbiAgICAvLyBjcmVhdGUgYSBjb3B5IHRvIGl0ZXJhdGUgb3ZlciBzbyB3ZSBjYW4gc3BsaWNlIHRoZSBvcmlnaW5hbCB3aGVuIHJlbW92aW5nIGJ1YmJsZXNcclxuICAgIGNvbnN0IHN0ZWFtQnViYmxlc0NvcHkgPSBbIC4uLnRoaXMuc3RlYW1CdWJibGVzIF07XHJcblxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgc3RlYW1CdWJibGVzQ29weS5sZW5ndGg7IGkrKyApIHtcclxuXHJcbiAgICAgIC8vIHVwZGF0ZSBwb3NpdGlvblxyXG4gICAgICBjb25zdCBkeSA9IC1kdCAqIHN0ZWFtQnViYmxlU3BlZWQ7XHJcbiAgICAgIGNvbnN0IGR4ID0gLWR5IC8gTWF0aC50YW4oIHN0ZWFtQnViYmxlc0NvcHlbIGkgXS5hbmdsZSApO1xyXG4gICAgICBzdGVhbUJ1YmJsZXNDb3B5WyBpIF0ueSArPSBkeTtcclxuICAgICAgc3RlYW1CdWJibGVzQ29weVsgaSBdLnggKz0gZHg7XHJcblxyXG4gICAgICAvLyBpbmNyZWFzZSByYWRpdXNcclxuICAgICAgc3RlYW1CdWJibGVzQ29weVsgaSBdLnJhZGl1cyA9IHN0ZWFtQnViYmxlc0NvcHlbIGkgXS5yYWRpdXMgKiAoIDEgKyAoIFNURUFNX0JVQkJMRV9HUk9XVEhfUkFURSAqIGR0ICkgKTtcclxuXHJcbiAgICAgIC8vIGZhZGUgb3V0IHRoZSBidWJibGUgYXMgaXQgcmVhY2hlcyB0aGUgZW5kIG9mIGl0cyByYW5nZVxyXG4gICAgICBjb25zdCBzdGVhbUJ1YmJsZU1heEhlaWdodCA9IFNURUFNX0JVQkJMRV9IRUlHSFRfUkFOR0UubWluICsgc3RlYW1pbmdQcm9wb3J0aW9uICogU1RFQU1fQlVCQkxFX0hFSUdIVF9SQU5HRS5nZXRMZW5ndGgoKTtcclxuICAgICAgY29uc3QgaGVpZ2h0RnJhY3Rpb24gPSBVdGlscy5jbGFtcCggKCB0aGlzLnN0ZWFtT3JpZ2luLnkgLSBzdGVhbUJ1YmJsZXNDb3B5WyBpIF0ueSApIC8gc3RlYW1CdWJibGVNYXhIZWlnaHQsIDAsIDEgKTtcclxuICAgICAgc3RlYW1CdWJibGVzQ29weVsgaSBdLm9wYWNpdHkgPSAoIDEgLSBoZWlnaHRGcmFjdGlvbiApICogU1RFQU1fQlVCQkxFX01BWF9PUEFDSVRZO1xyXG5cclxuICAgICAgLy8gcmVtb3ZlIGJ1YmJsZXMgdGhhdCBhcmUgb3V0IG9mIHRoZSBjdXJyZW50IGhlaWdodCByYW5nZVxyXG4gICAgICBpZiAoIHRoaXMuc3RlYW1PcmlnaW4ueSAtIHN0ZWFtQnViYmxlc0NvcHlbIGkgXS55ID4gc3RlYW1CdWJibGVNYXhIZWlnaHQgKSB7XHJcbiAgICAgICAgdGhpcy5zdGVhbUJ1YmJsZXMuc3BsaWNlKCBpLCAxICk7XHJcbiAgICAgICAgdGhpcy5wcmVsb2FkQ29tcGxldGUgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5wcmVsb2FkQ29tcGxldGUgJiYgdGhpcy5zdGVhbUJ1YmJsZXMubGVuZ3RoICYmIHRoaXMuaW52YWxpZGF0ZVBhaW50KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEcmF3cyBhIHN0ZWFtIGJ1YmJsZS5cclxuICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBzdGVhbUJ1YmJsZVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZHJhd1N0ZWFtQnViYmxlKCBjb250ZXh0LCBzdGVhbUJ1YmJsZSApIHtcclxuICAgIGNvbnRleHQuZ2xvYmFsQWxwaGEgPSBzdGVhbUJ1YmJsZS5vcGFjaXR5O1xyXG4gICAgY29udGV4dC5kcmF3SW1hZ2UoXHJcbiAgICAgIHRoaXMuc3RlYW1CdWJibGVJbWFnZUNhbnZhcyxcclxuICAgICAgc3RlYW1CdWJibGUueCAtIHN0ZWFtQnViYmxlLnJhZGl1cyxcclxuICAgICAgc3RlYW1CdWJibGUueSAtIHN0ZWFtQnViYmxlLnJhZGl1cyxcclxuICAgICAgc3RlYW1CdWJibGUucmFkaXVzICogMixcclxuICAgICAgc3RlYW1CdWJibGUucmFkaXVzICogMlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFBhaW50cyB0aGUgc3RlYW0gb24gdGhlIGNhbnZhcyBub2RlLlxyXG4gICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjb250ZXh0XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHBhaW50Q2FudmFzKCBjb250ZXh0ICkge1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5zdGVhbUJ1YmJsZXMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIHRoaXMuZHJhd1N0ZWFtQnViYmxlKCBjb250ZXh0LCB0aGlzLnN0ZWFtQnViYmxlc1sgaSBdICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLnN0ZWFtQnViYmxlcy5sZW5ndGggPSAwO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUHJlbG9hZHMgdGhlIHN0ZWFtIGFuaW1hdGlvbi5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIHByZWxvYWRTdGVhbSgpIHtcclxuICAgIHRoaXMucHJlbG9hZENvbXBsZXRlID0gZmFsc2U7XHJcbiAgICBjb25zdCBkdCA9IDEgLyBFRkFDQ29uc3RhbnRzLkZSQU1FU19QRVJfU0VDT05EO1xyXG5cclxuICAgIHdoaWxlICggIXRoaXMucHJlbG9hZENvbXBsZXRlICkge1xyXG4gICAgICB0aGlzLnN0ZXAoIGR0ICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5lbmVyZ3lGb3Jtc0FuZENoYW5nZXMucmVnaXN0ZXIoICdUZWFLZXR0bGVTdGVhbUNhbnZhc05vZGUnLCBUZWFLZXR0bGVTdGVhbUNhbnZhc05vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgVGVhS2V0dGxlU3RlYW1DYW52YXNOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxTQUFTLE1BQU0saUNBQWlDO0FBQ3ZELE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxLQUFLLE1BQU0sbUNBQW1DO0FBQ3JELFNBQVNDLFVBQVUsUUFBUSxtQ0FBbUM7QUFDOUQsT0FBT0MsTUFBTSxNQUFNLGlDQUFpQztBQUNwRCxPQUFPQyxhQUFhLE1BQU0sK0JBQStCO0FBQ3pELE9BQU9DLHFCQUFxQixNQUFNLGdDQUFnQztBQUNsRSxPQUFPQyxTQUFTLE1BQU0sdUJBQXVCOztBQUU3QztBQUNBLE1BQU1DLHdCQUF3QixHQUFHLElBQUlSLEtBQUssQ0FBRSxHQUFHLEVBQUUsR0FBSSxDQUFDLENBQUMsQ0FBQztBQUN4RCxNQUFNUywyQkFBMkIsR0FBRyxJQUFJVCxLQUFLLENBQUUsRUFBRSxFQUFFLEVBQUcsQ0FBQyxDQUFDLENBQUM7QUFDekQsTUFBTVUseUJBQXlCLEdBQUcsSUFBSVYsS0FBSyxDQUFFLEVBQUUsRUFBRSxHQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ3hELE1BQU1XLHVCQUF1QixHQUFHLElBQUlYLEtBQUssQ0FBRSxFQUFFLEVBQUUsRUFBRyxDQUFDLENBQUMsQ0FBQztBQUNyRCxNQUFNWSx3QkFBd0IsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUNwQyxNQUFNQyx3QkFBd0IsR0FBRyxHQUFHLENBQUMsQ0FBQzs7QUFFdEMsTUFBTUMsd0JBQXdCLFNBQVNYLFVBQVUsQ0FBQztFQUVoRDtBQUNG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