// Copyright 2016-2022, University of Colorado Boulder

/**
 * A Scenery Node that represents a ray of light in the view.  Rays of light can have shapes that reduce or block the
 * amount of light passing through.
 *
 * @author John Blanco
 * @author Andrew Adare
 */

import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Line as KiteLine, Shape } from '../../../../kite/js/imports.js';
import { Line, LinearGradient, Node, Path } from '../../../../scenery/js/imports.js';
import EFACConstants from '../../common/EFACConstants.js';
import energyFormsAndChanges from '../../energyFormsAndChanges.js';

// constants
const STROKE_THICKNESS = 2;
const SEARCH_ITERATIONS = 10;
class LightRayNode extends Node {
  /**
   * @param {Vector2} origin
   * @param {Vector2} endpoint
   * @param {Color} color
   */
  constructor(origin, endpoint, color) {
    super();

    // @private - data that defines this ray
    this.lightAbsorbingShapes = [];
    this.pointAndFadeValues = [];
    this.origin = origin;
    this.endpoint = endpoint;
    this.color = color;
    this.updateRay();

    // @private - A version of the updateRay function that is bound to this instance, used for adding to and removing
    // from light absorbing shapes.
    this.rayUpdater = this.updateRay.bind(this);
  }

  /**
   * add a shape that will potentially interact with this light ray
   * @param {LightAbsorbingShape} lightAbsorbingShape
   * @public
   */
  addLightAbsorbingShape(lightAbsorbingShape) {
    this.lightAbsorbingShapes.push(lightAbsorbingShape);
    lightAbsorbingShape.absorptionCoefficientProperty.link(this.rayUpdater);
  }

  /**
   * @param  {LightAbsorbingShape} lightAbsorbingShape
   * @public
   */
  removeLightAbsorbingShape(lightAbsorbingShape) {
    lightAbsorbingShape.absorptionCoefficientProperty.unlink(this.rayUpdater);
    _.pull(this.lightAbsorbingShapes, lightAbsorbingShape);
    this.updateRay();
  }

  /**
   * @private
   */
  updateRay() {
    this.removeAllChildren();
    this.pointAndFadeValues.length = 0;
    this.pointAndFadeValues.push(new PointAndFadeValue(this.origin, EFACConstants.FADE_COEFFICIENT_IN_AIR));
    this.pointAndFadeValues.push(new PointAndFadeValue(this.endpoint, 0));
    this.lightAbsorbingShapes.forEach(absorbingShape => {
      const entryPoint = this.getShapeEntryPoint(this.origin, this.endpoint, absorbingShape.shape);
      if (entryPoint !== null) {
        const fade = absorbingShape.absorptionCoefficientProperty.get();
        this.pointAndFadeValues.push(new PointAndFadeValue(entryPoint, fade));
        const exitPoint = this.getShapeExitPoint(this.origin, this.endpoint, absorbingShape.shape);
        if (exitPoint !== null) {
          this.pointAndFadeValues.push(new PointAndFadeValue(exitPoint, EFACConstants.FADE_COEFFICIENT_IN_AIR));
        }
      }
    });

    // sort the list of PointAndFadeValues by their distance from the origin, closest first
    const sortedPointAndFadeValues = _.sortBy(this.pointAndFadeValues, p => {
      return p.point.distance(this.origin);
    });
    const rayLength = this.origin.distance(this.endpoint);
    const rayGradient = new LinearGradient(this.origin.x, this.origin.y, this.endpoint.x, this.endpoint.y).addColorStop(0, this.color);
    let prevIntensity = this.color.alpha;
    for (let i = 0; i < sortedPointAndFadeValues.length - 1; i++) {
      const distanceFromOrigin = this.origin.distance(sortedPointAndFadeValues[i + 1].point);
      const distanceFromPreviousPoint = sortedPointAndFadeValues[i].point.distance(sortedPointAndFadeValues[i + 1].point);
      let intensityAtEndPoint = prevIntensity * Math.pow(Math.E, -sortedPointAndFadeValues[i].fadeValue * distanceFromPreviousPoint);
      intensityAtEndPoint = Utils.roundSymmetric(intensityAtEndPoint * 100) / 100; // round to nearest tenth

      const endPointColor = this.color.copy().setAlpha(intensityAtEndPoint);
      rayGradient.addColorStop(distanceFromOrigin / rayLength, endPointColor);
      prevIntensity = intensityAtEndPoint;
    }
    rayGradient.addColorStop(1, this.color.copy().setAlpha(0));
    const fadingRay = new Line(this.origin, this.endpoint, {
      stroke: rayGradient,
      lineWidth: STROKE_THICKNESS
    });
    this.addChild(fadingRay);
  }

  /**
   * finds the point at which this light ray enters a light absorbing shape
   *
   * @param {Vector2} origin
   * @param {Vector2} endpoint
   * @param {Shape} shape
   * @returns {Vector2|null}
   * @private
   */
  getShapeEntryPoint(origin, endpoint, shape) {
    const b = shape.bounds;
    const shapeRect = Shape.rect(b.minX, b.minY, b.getWidth(), b.getHeight());
    let entryPoint = null;
    if (shape.interiorIntersectsLineSegment(origin, endpoint)) {
      const boundsEntryPoint = this.getRectangleEntryPoint(origin, endpoint, shapeRect);
      if (boundsEntryPoint === null) {
        // DEBUG
        const l = new Line(origin, endpoint, {
          stroke: 'lime',
          lineWidth: 3
        });
        this.addChild(l);
        const p = new Path(shape, {
          stroke: 'red',
          lineWidth: 3
        });
        this.addChild(p);
        return null;
      }
      const boundsExitPoint = this.getRectangleExitPoint(origin, endpoint, shapeRect);
      const searchEndPoint = boundsExitPoint === null ? endpoint : boundsExitPoint;

      // Search linearly for edge of the shape.  BIG HAIRY NOTE - This will not work in all cases.  It worked for the
      // coarse shapes and rough bounds needed for this simulation.  Don't reuse if you need good general edge
      // finding.
      const angle = endpoint.minus(origin).angle;
      const incrementalDistance = boundsEntryPoint.distance(searchEndPoint) / SEARCH_ITERATIONS;
      for (let i = 0; i < SEARCH_ITERATIONS; i++) {
        const testPoint = boundsEntryPoint.plus(new Vector2(incrementalDistance * i, 0).rotated(angle));
        if (shape.bounds.containsPoint(testPoint)) {
          entryPoint = testPoint;
          break;
        }
      }
    }
    return entryPoint;
  }

  /**
   * finds the point at which this light ray exits a light absorbing shape
   *
   * @param {Vector2} origin
   * @param {Vector2} endpoint
   * @param {Shape} shape
   * @returns {Vector2}
   * @private
   */
  getShapeExitPoint(origin, endpoint, shape) {
    let exitPoint = null;
    if (shape.bounds.containsPoint(endpoint)) {
      // line ends inside shape, return null
      return null;
    }
    if (!shape.bounds.containsPoint(endpoint) && shape.interiorIntersectsLineSegment(origin, endpoint)) {
      // phase I - Do a binary search to locate the edge of the rectangle that encloses the shape
      const angle = endpoint.minus(origin).angle;
      let length = origin.distance(endpoint);
      let lengthChange = length / 2;
      for (let i = 0; i < SEARCH_ITERATIONS; i++) {
        const start = origin.plus(new Vector2(length, 0).rotated(angle));
        length += lengthChange * (shape.interiorIntersectsLineSegment(start, endpoint) ? 1 : -1);
        lengthChange = lengthChange / 2;
      }
      exitPoint = origin.plus(new Vector2(length, 0).rotated(angle));
    }
    return exitPoint;
  }

  /**
   * finds the point at which this light ray enters a rectangular shape
   * @param {Vector2} origin
   * @param {Vector2} endpoint
   * @param {Rectangle} rect
   * @returns {Vector2}
   * @private
   */
  getRectangleEntryPoint(origin, endpoint, rect) {
    const intersectingPoints = this.getRectangleLineIntersectionPoints(rect, new KiteLine(origin, endpoint));
    let closestIntersectionPoint = null;
    intersectingPoints.forEach(point => {
      if (closestIntersectionPoint === null || closestIntersectionPoint.distance(origin) > point.distance(origin)) {
        closestIntersectionPoint = point;
      }
    });
    return closestIntersectionPoint;
  }

  /**
   * finds the point at which this light ray exits a rectangular shape
   * @param  {Vector2} origin
   * @param  {Vector2} endpoint
   * @param  {Rectangle} rect
   * @returns {Vector2}
   * @private
   */
  getRectangleExitPoint(origin, endpoint, rect) {
    const intersectingPoints = this.getRectangleLineIntersectionPoints(rect, new KiteLine(origin, endpoint));
    if (intersectingPoints.length < 2) {
      // line either doesn't intersect or ends inside the rectangle
      return null;
    }
    let furthestIntersectionPoint = null;
    intersectingPoints.forEach(point => {
      if (furthestIntersectionPoint === null || furthestIntersectionPoint.distance(origin) < point.distance(origin)) {
        furthestIntersectionPoint = point;
      }
    });
    return furthestIntersectionPoint;
  }

  /**
   * @param {Rectangle} rect
   * @param {Line} line
   * @returns {Vector2[]}
   * @private
   */
  getRectangleLineIntersectionPoints(rect, line) {
    // corners of rect
    const p = [new Vector2(rect.bounds.minX, rect.bounds.minY), new Vector2(rect.bounds.minX, rect.bounds.maxY), new Vector2(rect.bounds.maxX, rect.bounds.maxY), new Vector2(rect.bounds.maxX, rect.bounds.minY)];

    // perimeter lines of rect
    const lines = [];
    lines.push(new KiteLine(p[0], p[1]));
    lines.push(new KiteLine(p[1], p[2]));
    lines.push(new KiteLine(p[2], p[3]));
    lines.push(new KiteLine(p[3], p[0]));
    const intersectingPoints = [];
    lines.forEach(rectLine => {
      const intersectingPoint = getLineIntersection(rectLine, line);
      if (intersectingPoint !== null) {
        intersectingPoints.push(intersectingPoint);
      }
    });
    return intersectingPoints;
  }
}
class PointAndFadeValue {
  /**
   * helper type that consolidates a point and a fade value
   * @param {Vector2} point - position
   * @param {number} fadeValue - Fade coefficient
   * @private
   */
  constructor(point, fadeValue) {
    this.point = point;
    this.fadeValue = fadeValue;
  }
}

/**
 * @param {KiteLine} line1
 * @param {KiteLine} line2
 * @returns {Vector2}
 * @private
 */
const getLineIntersection = (line1, line2) => {
  const start1 = line1.start;
  const start2 = line2.start;
  const end1 = line1.end;
  const end2 = line2.end;
  const denominator = (end1.x - start1.x) * (end2.y - start2.y) - (end1.y - start1.y) * (end2.x - start2.x);

  // Check if the lines are parallel, and thus don't intersect.
  if (denominator === 0) {
    return null;
  }
  const numerator = (start1.y - start2.y) * (end2.x - start2.x) - (start1.x - start2.x) * (end2.y - start2.y);
  const r = numerator / denominator;
  const numerator2 = (start1.y - start2.y) * (end1.x - start1.x) - (start1.x - start2.x) * (end1.y - start1.y);
  const s = numerator2 / denominator;
  if (r < 0 || r > 1 || s < 0 || s > 1) {
    return null;
  }

  // find intersection point
  return new Vector2(start1.x + r * (end1.x - start1.x), start1.y + r * (end1.y - start1.y));
};
energyFormsAndChanges.register('LightRayNode', LightRayNode);
export default LightRayNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlZlY3RvcjIiLCJMaW5lIiwiS2l0ZUxpbmUiLCJTaGFwZSIsIkxpbmVhckdyYWRpZW50IiwiTm9kZSIsIlBhdGgiLCJFRkFDQ29uc3RhbnRzIiwiZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzIiwiU1RST0tFX1RISUNLTkVTUyIsIlNFQVJDSF9JVEVSQVRJT05TIiwiTGlnaHRSYXlOb2RlIiwiY29uc3RydWN0b3IiLCJvcmlnaW4iLCJlbmRwb2ludCIsImNvbG9yIiwibGlnaHRBYnNvcmJpbmdTaGFwZXMiLCJwb2ludEFuZEZhZGVWYWx1ZXMiLCJ1cGRhdGVSYXkiLCJyYXlVcGRhdGVyIiwiYmluZCIsImFkZExpZ2h0QWJzb3JiaW5nU2hhcGUiLCJsaWdodEFic29yYmluZ1NoYXBlIiwicHVzaCIsImFic29ycHRpb25Db2VmZmljaWVudFByb3BlcnR5IiwibGluayIsInJlbW92ZUxpZ2h0QWJzb3JiaW5nU2hhcGUiLCJ1bmxpbmsiLCJfIiwicHVsbCIsInJlbW92ZUFsbENoaWxkcmVuIiwibGVuZ3RoIiwiUG9pbnRBbmRGYWRlVmFsdWUiLCJGQURFX0NPRUZGSUNJRU5UX0lOX0FJUiIsImZvckVhY2giLCJhYnNvcmJpbmdTaGFwZSIsImVudHJ5UG9pbnQiLCJnZXRTaGFwZUVudHJ5UG9pbnQiLCJzaGFwZSIsImZhZGUiLCJnZXQiLCJleGl0UG9pbnQiLCJnZXRTaGFwZUV4aXRQb2ludCIsInNvcnRlZFBvaW50QW5kRmFkZVZhbHVlcyIsInNvcnRCeSIsInAiLCJwb2ludCIsImRpc3RhbmNlIiwicmF5TGVuZ3RoIiwicmF5R3JhZGllbnQiLCJ4IiwieSIsImFkZENvbG9yU3RvcCIsInByZXZJbnRlbnNpdHkiLCJhbHBoYSIsImkiLCJkaXN0YW5jZUZyb21PcmlnaW4iLCJkaXN0YW5jZUZyb21QcmV2aW91c1BvaW50IiwiaW50ZW5zaXR5QXRFbmRQb2ludCIsIk1hdGgiLCJwb3ciLCJFIiwiZmFkZVZhbHVlIiwicm91bmRTeW1tZXRyaWMiLCJlbmRQb2ludENvbG9yIiwiY29weSIsInNldEFscGhhIiwiZmFkaW5nUmF5Iiwic3Ryb2tlIiwibGluZVdpZHRoIiwiYWRkQ2hpbGQiLCJiIiwiYm91bmRzIiwic2hhcGVSZWN0IiwicmVjdCIsIm1pblgiLCJtaW5ZIiwiZ2V0V2lkdGgiLCJnZXRIZWlnaHQiLCJpbnRlcmlvckludGVyc2VjdHNMaW5lU2VnbWVudCIsImJvdW5kc0VudHJ5UG9pbnQiLCJnZXRSZWN0YW5nbGVFbnRyeVBvaW50IiwibCIsImJvdW5kc0V4aXRQb2ludCIsImdldFJlY3RhbmdsZUV4aXRQb2ludCIsInNlYXJjaEVuZFBvaW50IiwiYW5nbGUiLCJtaW51cyIsImluY3JlbWVudGFsRGlzdGFuY2UiLCJ0ZXN0UG9pbnQiLCJwbHVzIiwicm90YXRlZCIsImNvbnRhaW5zUG9pbnQiLCJsZW5ndGhDaGFuZ2UiLCJzdGFydCIsImludGVyc2VjdGluZ1BvaW50cyIsImdldFJlY3RhbmdsZUxpbmVJbnRlcnNlY3Rpb25Qb2ludHMiLCJjbG9zZXN0SW50ZXJzZWN0aW9uUG9pbnQiLCJmdXJ0aGVzdEludGVyc2VjdGlvblBvaW50IiwibGluZSIsIm1heFkiLCJtYXhYIiwibGluZXMiLCJyZWN0TGluZSIsImludGVyc2VjdGluZ1BvaW50IiwiZ2V0TGluZUludGVyc2VjdGlvbiIsImxpbmUxIiwibGluZTIiLCJzdGFydDEiLCJzdGFydDIiLCJlbmQxIiwiZW5kIiwiZW5kMiIsImRlbm9taW5hdG9yIiwibnVtZXJhdG9yIiwiciIsIm51bWVyYXRvcjIiLCJzIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJMaWdodFJheU5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQSBTY2VuZXJ5IE5vZGUgdGhhdCByZXByZXNlbnRzIGEgcmF5IG9mIGxpZ2h0IGluIHRoZSB2aWV3LiAgUmF5cyBvZiBsaWdodCBjYW4gaGF2ZSBzaGFwZXMgdGhhdCByZWR1Y2Ugb3IgYmxvY2sgdGhlXHJcbiAqIGFtb3VudCBvZiBsaWdodCBwYXNzaW5nIHRocm91Z2guXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICogQGF1dGhvciBBbmRyZXcgQWRhcmVcclxuICovXHJcblxyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgeyBMaW5lIGFzIEtpdGVMaW5lLCBTaGFwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB7IExpbmUsIExpbmVhckdyYWRpZW50LCBOb2RlLCBQYXRoIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEVGQUNDb25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL0VGQUNDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzIGZyb20gJy4uLy4uL2VuZXJneUZvcm1zQW5kQ2hhbmdlcy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgU1RST0tFX1RISUNLTkVTUyA9IDI7XHJcbmNvbnN0IFNFQVJDSF9JVEVSQVRJT05TID0gMTA7XHJcblxyXG5jbGFzcyBMaWdodFJheU5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBvcmlnaW5cclxuICAgKiBAcGFyYW0ge1ZlY3RvcjJ9IGVuZHBvaW50XHJcbiAgICogQHBhcmFtIHtDb2xvcn0gY29sb3JcclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvciggb3JpZ2luLCBlbmRwb2ludCwgY29sb3IgKSB7XHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIC0gZGF0YSB0aGF0IGRlZmluZXMgdGhpcyByYXlcclxuICAgIHRoaXMubGlnaHRBYnNvcmJpbmdTaGFwZXMgPSBbXTtcclxuICAgIHRoaXMucG9pbnRBbmRGYWRlVmFsdWVzID0gW107XHJcbiAgICB0aGlzLm9yaWdpbiA9IG9yaWdpbjtcclxuICAgIHRoaXMuZW5kcG9pbnQgPSBlbmRwb2ludDtcclxuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcclxuXHJcbiAgICB0aGlzLnVwZGF0ZVJheSgpO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIC0gQSB2ZXJzaW9uIG9mIHRoZSB1cGRhdGVSYXkgZnVuY3Rpb24gdGhhdCBpcyBib3VuZCB0byB0aGlzIGluc3RhbmNlLCB1c2VkIGZvciBhZGRpbmcgdG8gYW5kIHJlbW92aW5nXHJcbiAgICAvLyBmcm9tIGxpZ2h0IGFic29yYmluZyBzaGFwZXMuXHJcbiAgICB0aGlzLnJheVVwZGF0ZXIgPSB0aGlzLnVwZGF0ZVJheS5iaW5kKCB0aGlzICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBhZGQgYSBzaGFwZSB0aGF0IHdpbGwgcG90ZW50aWFsbHkgaW50ZXJhY3Qgd2l0aCB0aGlzIGxpZ2h0IHJheVxyXG4gICAqIEBwYXJhbSB7TGlnaHRBYnNvcmJpbmdTaGFwZX0gbGlnaHRBYnNvcmJpbmdTaGFwZVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBhZGRMaWdodEFic29yYmluZ1NoYXBlKCBsaWdodEFic29yYmluZ1NoYXBlICkge1xyXG4gICAgdGhpcy5saWdodEFic29yYmluZ1NoYXBlcy5wdXNoKCBsaWdodEFic29yYmluZ1NoYXBlICk7XHJcbiAgICBsaWdodEFic29yYmluZ1NoYXBlLmFic29ycHRpb25Db2VmZmljaWVudFByb3BlcnR5LmxpbmsoIHRoaXMucmF5VXBkYXRlciApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtICB7TGlnaHRBYnNvcmJpbmdTaGFwZX0gbGlnaHRBYnNvcmJpbmdTaGFwZVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICByZW1vdmVMaWdodEFic29yYmluZ1NoYXBlKCBsaWdodEFic29yYmluZ1NoYXBlICkge1xyXG4gICAgbGlnaHRBYnNvcmJpbmdTaGFwZS5hYnNvcnB0aW9uQ29lZmZpY2llbnRQcm9wZXJ0eS51bmxpbmsoIHRoaXMucmF5VXBkYXRlciApO1xyXG4gICAgXy5wdWxsKCB0aGlzLmxpZ2h0QWJzb3JiaW5nU2hhcGVzLCBsaWdodEFic29yYmluZ1NoYXBlICk7XHJcbiAgICB0aGlzLnVwZGF0ZVJheSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICB1cGRhdGVSYXkoKSB7XHJcbiAgICB0aGlzLnJlbW92ZUFsbENoaWxkcmVuKCk7XHJcbiAgICB0aGlzLnBvaW50QW5kRmFkZVZhbHVlcy5sZW5ndGggPSAwO1xyXG5cclxuICAgIHRoaXMucG9pbnRBbmRGYWRlVmFsdWVzLnB1c2goIG5ldyBQb2ludEFuZEZhZGVWYWx1ZSggdGhpcy5vcmlnaW4sIEVGQUNDb25zdGFudHMuRkFERV9DT0VGRklDSUVOVF9JTl9BSVIgKSApO1xyXG4gICAgdGhpcy5wb2ludEFuZEZhZGVWYWx1ZXMucHVzaCggbmV3IFBvaW50QW5kRmFkZVZhbHVlKCB0aGlzLmVuZHBvaW50LCAwICkgKTtcclxuXHJcbiAgICB0aGlzLmxpZ2h0QWJzb3JiaW5nU2hhcGVzLmZvckVhY2goIGFic29yYmluZ1NoYXBlID0+IHtcclxuXHJcbiAgICAgIGNvbnN0IGVudHJ5UG9pbnQgPSB0aGlzLmdldFNoYXBlRW50cnlQb2ludCggdGhpcy5vcmlnaW4sIHRoaXMuZW5kcG9pbnQsIGFic29yYmluZ1NoYXBlLnNoYXBlICk7XHJcblxyXG4gICAgICBpZiAoIGVudHJ5UG9pbnQgIT09IG51bGwgKSB7XHJcbiAgICAgICAgY29uc3QgZmFkZSA9IGFic29yYmluZ1NoYXBlLmFic29ycHRpb25Db2VmZmljaWVudFByb3BlcnR5LmdldCgpO1xyXG4gICAgICAgIHRoaXMucG9pbnRBbmRGYWRlVmFsdWVzLnB1c2goIG5ldyBQb2ludEFuZEZhZGVWYWx1ZSggZW50cnlQb2ludCwgZmFkZSApICk7XHJcbiAgICAgICAgY29uc3QgZXhpdFBvaW50ID0gdGhpcy5nZXRTaGFwZUV4aXRQb2ludCggdGhpcy5vcmlnaW4sIHRoaXMuZW5kcG9pbnQsIGFic29yYmluZ1NoYXBlLnNoYXBlICk7XHJcbiAgICAgICAgaWYgKCBleGl0UG9pbnQgIT09IG51bGwgKSB7XHJcbiAgICAgICAgICB0aGlzLnBvaW50QW5kRmFkZVZhbHVlcy5wdXNoKCBuZXcgUG9pbnRBbmRGYWRlVmFsdWUoIGV4aXRQb2ludCwgRUZBQ0NvbnN0YW50cy5GQURFX0NPRUZGSUNJRU5UX0lOX0FJUiApICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gc29ydCB0aGUgbGlzdCBvZiBQb2ludEFuZEZhZGVWYWx1ZXMgYnkgdGhlaXIgZGlzdGFuY2UgZnJvbSB0aGUgb3JpZ2luLCBjbG9zZXN0IGZpcnN0XHJcbiAgICBjb25zdCBzb3J0ZWRQb2ludEFuZEZhZGVWYWx1ZXMgPSBfLnNvcnRCeSggdGhpcy5wb2ludEFuZEZhZGVWYWx1ZXMsIHAgPT4ge1xyXG4gICAgICByZXR1cm4gcC5wb2ludC5kaXN0YW5jZSggdGhpcy5vcmlnaW4gKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCByYXlMZW5ndGggPSB0aGlzLm9yaWdpbi5kaXN0YW5jZSggdGhpcy5lbmRwb2ludCApO1xyXG5cclxuICAgIGNvbnN0IHJheUdyYWRpZW50ID0gbmV3IExpbmVhckdyYWRpZW50KCB0aGlzLm9yaWdpbi54LCB0aGlzLm9yaWdpbi55LCB0aGlzLmVuZHBvaW50LngsIHRoaXMuZW5kcG9pbnQueSApXHJcbiAgICAgIC5hZGRDb2xvclN0b3AoIDAsIHRoaXMuY29sb3IgKTtcclxuXHJcbiAgICBsZXQgcHJldkludGVuc2l0eSA9IHRoaXMuY29sb3IuYWxwaGE7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBzb3J0ZWRQb2ludEFuZEZhZGVWYWx1ZXMubGVuZ3RoIC0gMTsgaSsrICkge1xyXG4gICAgICBjb25zdCBkaXN0YW5jZUZyb21PcmlnaW4gPSB0aGlzLm9yaWdpbi5kaXN0YW5jZSggc29ydGVkUG9pbnRBbmRGYWRlVmFsdWVzWyBpICsgMSBdLnBvaW50ICk7XHJcbiAgICAgIGNvbnN0IGRpc3RhbmNlRnJvbVByZXZpb3VzUG9pbnQgPSBzb3J0ZWRQb2ludEFuZEZhZGVWYWx1ZXNbIGkgXS5wb2ludC5kaXN0YW5jZSggc29ydGVkUG9pbnRBbmRGYWRlVmFsdWVzWyBpICsgMSBdLnBvaW50ICk7XHJcblxyXG4gICAgICBsZXQgaW50ZW5zaXR5QXRFbmRQb2ludCA9IHByZXZJbnRlbnNpdHkgKiBNYXRoLnBvdyggTWF0aC5FLCAtc29ydGVkUG9pbnRBbmRGYWRlVmFsdWVzWyBpIF0uZmFkZVZhbHVlICogZGlzdGFuY2VGcm9tUHJldmlvdXNQb2ludCApO1xyXG4gICAgICBpbnRlbnNpdHlBdEVuZFBvaW50ID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIGludGVuc2l0eUF0RW5kUG9pbnQgKiAxMDAgKSAvIDEwMDsgLy8gcm91bmQgdG8gbmVhcmVzdCB0ZW50aFxyXG5cclxuICAgICAgY29uc3QgZW5kUG9pbnRDb2xvciA9IHRoaXMuY29sb3IuY29weSgpLnNldEFscGhhKCBpbnRlbnNpdHlBdEVuZFBvaW50ICk7XHJcbiAgICAgIHJheUdyYWRpZW50LmFkZENvbG9yU3RvcCggZGlzdGFuY2VGcm9tT3JpZ2luIC8gcmF5TGVuZ3RoLCBlbmRQb2ludENvbG9yICk7XHJcblxyXG4gICAgICBwcmV2SW50ZW5zaXR5ID0gaW50ZW5zaXR5QXRFbmRQb2ludDtcclxuICAgIH1cclxuICAgIHJheUdyYWRpZW50LmFkZENvbG9yU3RvcCggMSwgdGhpcy5jb2xvci5jb3B5KCkuc2V0QWxwaGEoIDAgKSApO1xyXG5cclxuICAgIGNvbnN0IGZhZGluZ1JheSA9IG5ldyBMaW5lKCB0aGlzLm9yaWdpbiwgdGhpcy5lbmRwb2ludCwge1xyXG4gICAgICBzdHJva2U6IHJheUdyYWRpZW50LFxyXG4gICAgICBsaW5lV2lkdGg6IFNUUk9LRV9USElDS05FU1NcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGZhZGluZ1JheSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogZmluZHMgdGhlIHBvaW50IGF0IHdoaWNoIHRoaXMgbGlnaHQgcmF5IGVudGVycyBhIGxpZ2h0IGFic29yYmluZyBzaGFwZVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBvcmlnaW5cclxuICAgKiBAcGFyYW0ge1ZlY3RvcjJ9IGVuZHBvaW50XHJcbiAgICogQHBhcmFtIHtTaGFwZX0gc2hhcGVcclxuICAgKiBAcmV0dXJucyB7VmVjdG9yMnxudWxsfVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZ2V0U2hhcGVFbnRyeVBvaW50KCBvcmlnaW4sIGVuZHBvaW50LCBzaGFwZSApIHtcclxuICAgIGNvbnN0IGIgPSBzaGFwZS5ib3VuZHM7XHJcbiAgICBjb25zdCBzaGFwZVJlY3QgPSBTaGFwZS5yZWN0KCBiLm1pblgsIGIubWluWSwgYi5nZXRXaWR0aCgpLCBiLmdldEhlaWdodCgpICk7XHJcbiAgICBsZXQgZW50cnlQb2ludCA9IG51bGw7XHJcblxyXG4gICAgaWYgKCBzaGFwZS5pbnRlcmlvckludGVyc2VjdHNMaW5lU2VnbWVudCggb3JpZ2luLCBlbmRwb2ludCApICkge1xyXG4gICAgICBjb25zdCBib3VuZHNFbnRyeVBvaW50ID0gdGhpcy5nZXRSZWN0YW5nbGVFbnRyeVBvaW50KCBvcmlnaW4sIGVuZHBvaW50LCBzaGFwZVJlY3QgKTtcclxuICAgICAgaWYgKCBib3VuZHNFbnRyeVBvaW50ID09PSBudWxsICkge1xyXG5cclxuICAgICAgICAvLyBERUJVR1xyXG4gICAgICAgIGNvbnN0IGwgPSBuZXcgTGluZSggb3JpZ2luLCBlbmRwb2ludCwge1xyXG4gICAgICAgICAgc3Ryb2tlOiAnbGltZScsXHJcbiAgICAgICAgICBsaW5lV2lkdGg6IDNcclxuICAgICAgICB9ICk7XHJcbiAgICAgICAgdGhpcy5hZGRDaGlsZCggbCApO1xyXG5cclxuICAgICAgICBjb25zdCBwID0gbmV3IFBhdGgoIHNoYXBlLCB7XHJcbiAgICAgICAgICBzdHJva2U6ICdyZWQnLFxyXG4gICAgICAgICAgbGluZVdpZHRoOiAzXHJcbiAgICAgICAgfSApO1xyXG4gICAgICAgIHRoaXMuYWRkQ2hpbGQoIHAgKTtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBib3VuZHNFeGl0UG9pbnQgPSB0aGlzLmdldFJlY3RhbmdsZUV4aXRQb2ludCggb3JpZ2luLCBlbmRwb2ludCwgc2hhcGVSZWN0ICk7XHJcbiAgICAgIGNvbnN0IHNlYXJjaEVuZFBvaW50ID0gYm91bmRzRXhpdFBvaW50ID09PSBudWxsID8gZW5kcG9pbnQgOiBib3VuZHNFeGl0UG9pbnQ7XHJcblxyXG4gICAgICAvLyBTZWFyY2ggbGluZWFybHkgZm9yIGVkZ2Ugb2YgdGhlIHNoYXBlLiAgQklHIEhBSVJZIE5PVEUgLSBUaGlzIHdpbGwgbm90IHdvcmsgaW4gYWxsIGNhc2VzLiAgSXQgd29ya2VkIGZvciB0aGVcclxuICAgICAgLy8gY29hcnNlIHNoYXBlcyBhbmQgcm91Z2ggYm91bmRzIG5lZWRlZCBmb3IgdGhpcyBzaW11bGF0aW9uLiAgRG9uJ3QgcmV1c2UgaWYgeW91IG5lZWQgZ29vZCBnZW5lcmFsIGVkZ2VcclxuICAgICAgLy8gZmluZGluZy5cclxuICAgICAgY29uc3QgYW5nbGUgPSBlbmRwb2ludC5taW51cyggb3JpZ2luICkuYW5nbGU7XHJcbiAgICAgIGNvbnN0IGluY3JlbWVudGFsRGlzdGFuY2UgPSBib3VuZHNFbnRyeVBvaW50LmRpc3RhbmNlKCBzZWFyY2hFbmRQb2ludCApIC8gU0VBUkNIX0lURVJBVElPTlM7XHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IFNFQVJDSF9JVEVSQVRJT05TOyBpKysgKSB7XHJcbiAgICAgICAgY29uc3QgdGVzdFBvaW50ID0gYm91bmRzRW50cnlQb2ludC5wbHVzKCBuZXcgVmVjdG9yMiggaW5jcmVtZW50YWxEaXN0YW5jZSAqIGksIDAgKS5yb3RhdGVkKCBhbmdsZSApICk7XHJcbiAgICAgICAgaWYgKCBzaGFwZS5ib3VuZHMuY29udGFpbnNQb2ludCggdGVzdFBvaW50ICkgKSB7XHJcbiAgICAgICAgICBlbnRyeVBvaW50ID0gdGVzdFBvaW50O1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZW50cnlQb2ludDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGZpbmRzIHRoZSBwb2ludCBhdCB3aGljaCB0aGlzIGxpZ2h0IHJheSBleGl0cyBhIGxpZ2h0IGFic29yYmluZyBzaGFwZVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBvcmlnaW5cclxuICAgKiBAcGFyYW0ge1ZlY3RvcjJ9IGVuZHBvaW50XHJcbiAgICogQHBhcmFtIHtTaGFwZX0gc2hhcGVcclxuICAgKiBAcmV0dXJucyB7VmVjdG9yMn1cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGdldFNoYXBlRXhpdFBvaW50KCBvcmlnaW4sIGVuZHBvaW50LCBzaGFwZSApIHtcclxuICAgIGxldCBleGl0UG9pbnQgPSBudWxsO1xyXG5cclxuICAgIGlmICggc2hhcGUuYm91bmRzLmNvbnRhaW5zUG9pbnQoIGVuZHBvaW50ICkgKSB7XHJcblxyXG4gICAgICAvLyBsaW5lIGVuZHMgaW5zaWRlIHNoYXBlLCByZXR1cm4gbnVsbFxyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoICFzaGFwZS5ib3VuZHMuY29udGFpbnNQb2ludCggZW5kcG9pbnQgKSAmJiBzaGFwZS5pbnRlcmlvckludGVyc2VjdHNMaW5lU2VnbWVudCggb3JpZ2luLCBlbmRwb2ludCApICkge1xyXG5cclxuICAgICAgLy8gcGhhc2UgSSAtIERvIGEgYmluYXJ5IHNlYXJjaCB0byBsb2NhdGUgdGhlIGVkZ2Ugb2YgdGhlIHJlY3RhbmdsZSB0aGF0IGVuY2xvc2VzIHRoZSBzaGFwZVxyXG4gICAgICBjb25zdCBhbmdsZSA9IGVuZHBvaW50Lm1pbnVzKCBvcmlnaW4gKS5hbmdsZTtcclxuICAgICAgbGV0IGxlbmd0aCA9IG9yaWdpbi5kaXN0YW5jZSggZW5kcG9pbnQgKTtcclxuICAgICAgbGV0IGxlbmd0aENoYW5nZSA9IGxlbmd0aCAvIDI7XHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IFNFQVJDSF9JVEVSQVRJT05TOyBpKysgKSB7XHJcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBvcmlnaW4ucGx1cyggbmV3IFZlY3RvcjIoIGxlbmd0aCwgMCApLnJvdGF0ZWQoIGFuZ2xlICkgKTtcclxuICAgICAgICBsZW5ndGggKz0gbGVuZ3RoQ2hhbmdlICogKCBzaGFwZS5pbnRlcmlvckludGVyc2VjdHNMaW5lU2VnbWVudCggc3RhcnQsIGVuZHBvaW50ICkgPyAxIDogLTEgKTtcclxuICAgICAgICBsZW5ndGhDaGFuZ2UgPSBsZW5ndGhDaGFuZ2UgLyAyO1xyXG4gICAgICB9XHJcbiAgICAgIGV4aXRQb2ludCA9IG9yaWdpbi5wbHVzKCBuZXcgVmVjdG9yMiggbGVuZ3RoLCAwICkucm90YXRlZCggYW5nbGUgKSApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGV4aXRQb2ludDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGZpbmRzIHRoZSBwb2ludCBhdCB3aGljaCB0aGlzIGxpZ2h0IHJheSBlbnRlcnMgYSByZWN0YW5ndWxhciBzaGFwZVxyXG4gICAqIEBwYXJhbSB7VmVjdG9yMn0gb3JpZ2luXHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBlbmRwb2ludFxyXG4gICAqIEBwYXJhbSB7UmVjdGFuZ2xlfSByZWN0XHJcbiAgICogQHJldHVybnMge1ZlY3RvcjJ9XHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBnZXRSZWN0YW5nbGVFbnRyeVBvaW50KCBvcmlnaW4sIGVuZHBvaW50LCByZWN0ICkge1xyXG4gICAgY29uc3QgaW50ZXJzZWN0aW5nUG9pbnRzID0gdGhpcy5nZXRSZWN0YW5nbGVMaW5lSW50ZXJzZWN0aW9uUG9pbnRzKCByZWN0LCBuZXcgS2l0ZUxpbmUoIG9yaWdpbiwgZW5kcG9pbnQgKSApO1xyXG4gICAgbGV0IGNsb3Nlc3RJbnRlcnNlY3Rpb25Qb2ludCA9IG51bGw7XHJcbiAgICBpbnRlcnNlY3RpbmdQb2ludHMuZm9yRWFjaCggcG9pbnQgPT4ge1xyXG4gICAgICBpZiAoIGNsb3Nlc3RJbnRlcnNlY3Rpb25Qb2ludCA9PT0gbnVsbCB8fFxyXG4gICAgICAgICAgIGNsb3Nlc3RJbnRlcnNlY3Rpb25Qb2ludC5kaXN0YW5jZSggb3JpZ2luICkgPiBwb2ludC5kaXN0YW5jZSggb3JpZ2luICkgKSB7XHJcbiAgICAgICAgY2xvc2VzdEludGVyc2VjdGlvblBvaW50ID0gcG9pbnQ7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICByZXR1cm4gY2xvc2VzdEludGVyc2VjdGlvblBvaW50O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogZmluZHMgdGhlIHBvaW50IGF0IHdoaWNoIHRoaXMgbGlnaHQgcmF5IGV4aXRzIGEgcmVjdGFuZ3VsYXIgc2hhcGVcclxuICAgKiBAcGFyYW0gIHtWZWN0b3IyfSBvcmlnaW5cclxuICAgKiBAcGFyYW0gIHtWZWN0b3IyfSBlbmRwb2ludFxyXG4gICAqIEBwYXJhbSAge1JlY3RhbmdsZX0gcmVjdFxyXG4gICAqIEByZXR1cm5zIHtWZWN0b3IyfVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZ2V0UmVjdGFuZ2xlRXhpdFBvaW50KCBvcmlnaW4sIGVuZHBvaW50LCByZWN0ICkge1xyXG4gICAgY29uc3QgaW50ZXJzZWN0aW5nUG9pbnRzID0gdGhpcy5nZXRSZWN0YW5nbGVMaW5lSW50ZXJzZWN0aW9uUG9pbnRzKCByZWN0LCBuZXcgS2l0ZUxpbmUoIG9yaWdpbiwgZW5kcG9pbnQgKSApO1xyXG5cclxuICAgIGlmICggaW50ZXJzZWN0aW5nUG9pbnRzLmxlbmd0aCA8IDIgKSB7XHJcblxyXG4gICAgICAvLyBsaW5lIGVpdGhlciBkb2Vzbid0IGludGVyc2VjdCBvciBlbmRzIGluc2lkZSB0aGUgcmVjdGFuZ2xlXHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBmdXJ0aGVzdEludGVyc2VjdGlvblBvaW50ID0gbnVsbDtcclxuICAgIGludGVyc2VjdGluZ1BvaW50cy5mb3JFYWNoKCBwb2ludCA9PiB7XHJcbiAgICAgIGlmICggZnVydGhlc3RJbnRlcnNlY3Rpb25Qb2ludCA9PT0gbnVsbCB8fFxyXG4gICAgICAgICAgIGZ1cnRoZXN0SW50ZXJzZWN0aW9uUG9pbnQuZGlzdGFuY2UoIG9yaWdpbiApIDwgcG9pbnQuZGlzdGFuY2UoIG9yaWdpbiApICkge1xyXG4gICAgICAgIGZ1cnRoZXN0SW50ZXJzZWN0aW9uUG9pbnQgPSBwb2ludDtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIHJldHVybiBmdXJ0aGVzdEludGVyc2VjdGlvblBvaW50O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtSZWN0YW5nbGV9IHJlY3RcclxuICAgKiBAcGFyYW0ge0xpbmV9IGxpbmVcclxuICAgKiBAcmV0dXJucyB7VmVjdG9yMltdfVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZ2V0UmVjdGFuZ2xlTGluZUludGVyc2VjdGlvblBvaW50cyggcmVjdCwgbGluZSApIHtcclxuXHJcbiAgICAvLyBjb3JuZXJzIG9mIHJlY3RcclxuICAgIGNvbnN0IHAgPSBbXHJcbiAgICAgIG5ldyBWZWN0b3IyKCByZWN0LmJvdW5kcy5taW5YLCByZWN0LmJvdW5kcy5taW5ZICksXHJcbiAgICAgIG5ldyBWZWN0b3IyKCByZWN0LmJvdW5kcy5taW5YLCByZWN0LmJvdW5kcy5tYXhZICksXHJcbiAgICAgIG5ldyBWZWN0b3IyKCByZWN0LmJvdW5kcy5tYXhYLCByZWN0LmJvdW5kcy5tYXhZICksXHJcbiAgICAgIG5ldyBWZWN0b3IyKCByZWN0LmJvdW5kcy5tYXhYLCByZWN0LmJvdW5kcy5taW5ZIClcclxuICAgIF07XHJcblxyXG4gICAgLy8gcGVyaW1ldGVyIGxpbmVzIG9mIHJlY3RcclxuICAgIGNvbnN0IGxpbmVzID0gW107XHJcbiAgICBsaW5lcy5wdXNoKCBuZXcgS2l0ZUxpbmUoIHBbIDAgXSwgcFsgMSBdICkgKTtcclxuICAgIGxpbmVzLnB1c2goIG5ldyBLaXRlTGluZSggcFsgMSBdLCBwWyAyIF0gKSApO1xyXG4gICAgbGluZXMucHVzaCggbmV3IEtpdGVMaW5lKCBwWyAyIF0sIHBbIDMgXSApICk7XHJcbiAgICBsaW5lcy5wdXNoKCBuZXcgS2l0ZUxpbmUoIHBbIDMgXSwgcFsgMCBdICkgKTtcclxuXHJcbiAgICBjb25zdCBpbnRlcnNlY3RpbmdQb2ludHMgPSBbXTtcclxuICAgIGxpbmVzLmZvckVhY2goIHJlY3RMaW5lID0+IHtcclxuICAgICAgY29uc3QgaW50ZXJzZWN0aW5nUG9pbnQgPSBnZXRMaW5lSW50ZXJzZWN0aW9uKCByZWN0TGluZSwgbGluZSApO1xyXG4gICAgICBpZiAoIGludGVyc2VjdGluZ1BvaW50ICE9PSBudWxsICkge1xyXG4gICAgICAgIGludGVyc2VjdGluZ1BvaW50cy5wdXNoKCBpbnRlcnNlY3RpbmdQb2ludCApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgcmV0dXJuIGludGVyc2VjdGluZ1BvaW50cztcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIFBvaW50QW5kRmFkZVZhbHVlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogaGVscGVyIHR5cGUgdGhhdCBjb25zb2xpZGF0ZXMgYSBwb2ludCBhbmQgYSBmYWRlIHZhbHVlXHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBwb2ludCAtIHBvc2l0aW9uXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGZhZGVWYWx1ZSAtIEZhZGUgY29lZmZpY2llbnRcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBwb2ludCwgZmFkZVZhbHVlICkge1xyXG4gICAgdGhpcy5wb2ludCA9IHBvaW50O1xyXG4gICAgdGhpcy5mYWRlVmFsdWUgPSBmYWRlVmFsdWU7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQHBhcmFtIHtLaXRlTGluZX0gbGluZTFcclxuICogQHBhcmFtIHtLaXRlTGluZX0gbGluZTJcclxuICogQHJldHVybnMge1ZlY3RvcjJ9XHJcbiAqIEBwcml2YXRlXHJcbiAqL1xyXG5jb25zdCBnZXRMaW5lSW50ZXJzZWN0aW9uID0gKCBsaW5lMSwgbGluZTIgKSA9PiB7XHJcblxyXG4gIGNvbnN0IHN0YXJ0MSA9IGxpbmUxLnN0YXJ0O1xyXG4gIGNvbnN0IHN0YXJ0MiA9IGxpbmUyLnN0YXJ0O1xyXG4gIGNvbnN0IGVuZDEgPSBsaW5lMS5lbmQ7XHJcbiAgY29uc3QgZW5kMiA9IGxpbmUyLmVuZDtcclxuXHJcbiAgY29uc3QgZGVub21pbmF0b3IgPSAoICggZW5kMS54IC0gc3RhcnQxLnggKSAqICggZW5kMi55IC0gc3RhcnQyLnkgKSApIC1cclxuICAgICAgICAgICAgICAgICAgICAgICggKCBlbmQxLnkgLSBzdGFydDEueSApICogKCBlbmQyLnggLSBzdGFydDIueCApICk7XHJcblxyXG4gIC8vIENoZWNrIGlmIHRoZSBsaW5lcyBhcmUgcGFyYWxsZWwsIGFuZCB0aHVzIGRvbid0IGludGVyc2VjdC5cclxuICBpZiAoIGRlbm9taW5hdG9yID09PSAwICkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBjb25zdCBudW1lcmF0b3IgPSAoICggc3RhcnQxLnkgLSBzdGFydDIueSApICogKCBlbmQyLnggLSBzdGFydDIueCApICkgLVxyXG4gICAgICAgICAgICAgICAgICAgICggKCBzdGFydDEueCAtIHN0YXJ0Mi54ICkgKiAoIGVuZDIueSAtIHN0YXJ0Mi55ICkgKTtcclxuICBjb25zdCByID0gbnVtZXJhdG9yIC8gZGVub21pbmF0b3I7XHJcblxyXG4gIGNvbnN0IG51bWVyYXRvcjIgPSAoICggc3RhcnQxLnkgLSBzdGFydDIueSApICogKCBlbmQxLnggLSBzdGFydDEueCApICkgLVxyXG4gICAgICAgICAgICAgICAgICAgICAoICggc3RhcnQxLnggLSBzdGFydDIueCApICogKCBlbmQxLnkgLSBzdGFydDEueSApICk7XHJcbiAgY29uc3QgcyA9IG51bWVyYXRvcjIgLyBkZW5vbWluYXRvcjtcclxuXHJcbiAgaWYgKCAoIHIgPCAwIHx8IHIgPiAxICkgfHwgKCBzIDwgMCB8fCBzID4gMSApICkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvLyBmaW5kIGludGVyc2VjdGlvbiBwb2ludFxyXG4gIHJldHVybiBuZXcgVmVjdG9yMihcclxuICAgIHN0YXJ0MS54ICsgKCByICogKCBlbmQxLnggLSBzdGFydDEueCApICksXHJcbiAgICBzdGFydDEueSArICggciAqICggZW5kMS55IC0gc3RhcnQxLnkgKSApXHJcbiAgKTtcclxufTtcclxuXHJcbmVuZXJneUZvcm1zQW5kQ2hhbmdlcy5yZWdpc3RlciggJ0xpZ2h0UmF5Tm9kZScsIExpZ2h0UmF5Tm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBMaWdodFJheU5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsU0FBU0MsSUFBSSxJQUFJQyxRQUFRLEVBQUVDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDeEUsU0FBU0YsSUFBSSxFQUFFRyxjQUFjLEVBQUVDLElBQUksRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUNwRixPQUFPQyxhQUFhLE1BQU0sK0JBQStCO0FBQ3pELE9BQU9DLHFCQUFxQixNQUFNLGdDQUFnQzs7QUFFbEU7QUFDQSxNQUFN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