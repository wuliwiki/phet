// Copyright 2016-2022, University of Colorado Boulder

// Note: This file is a mashup of two ported Java files: Carousel and
// EnergySystemElementCarousel. Carousel.java was not ported to avoid confusion
// with the PhET Sun Carousel.js UI component.

/**
 * This type implements a model-based carousel for positionable model elements. Model elements are positioned based
 * on the current selection, and an API is provided that allows clients to change those selection. Changes to the
 * selected element are animated.
 *
 * @author John Blanco
 * @author Andrew Adare
 * @author Jesse Greenberg
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import EnumerationDeprecatedProperty from '../../../../axon/js/EnumerationDeprecatedProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import Easing from '../../../../twixt/js/Easing.js';
import energyFormsAndChanges from '../../energyFormsAndChanges.js';

// constants
const TRANSITION_DURATION = 0.75; // in seconds

class EnergySystemElementCarousel {
  /**
   * @param {EnergySystemElement[]} elements - array of elements to add to this carousel
   * @param {EnumerationDeprecated} elementNames - the names of the elements being added
   * @param {Vector2} selectedElementPosition - position where the selected model element should be
   * @param {Vector2} offsetBetweenElements - offset between elements in the carousel
   * @param {Tandem} tandem
   */
  constructor(elements, elementNames, selectedElementPosition, offsetBetweenElements, tandem) {
    // @public (read-only) {Vector2} - the position in model space where the currently selected element should be
    this.selectedElementPosition = selectedElementPosition;

    // @private {Vector2} - the offset between elements whose position is managed by this carousel
    this.offsetBetweenElements = offsetBetweenElements;

    // @public (read-only) {EnergySystemElement[]} - list of the elements whose position is managed by this carousel
    this.managedElements = [];

    // @public (read-only) {EnumerationDeprecated} - names that correspond to each element
    this.elementNames = elementNames;

    // add each element to the array of managed elements
    elements.forEach(element => this.add(element));

    /**
     * calculates the valid target indices for this carousel
     *
     * @param {number} numberOfElements
     * @returns {number[]}
     */
    const getValidTargetIndices = numberOfElements => {
      const validTargetIndices = [];
      _.times(numberOfElements, index => {
        validTargetIndices.push(index);
      });
      return validTargetIndices;
    };
    assert && assert(this.managedElements.length === this.elementNames.VALUES.length, 'The number of managed elements must equal the number of element name enumeration values');

    // @public (read-only) {NumberProperty} - indicates which element on the carousel is currently selected by index.
    // this index is the ground truth for managing the currently selected element, but is controlled by
    // targetElementNameProperty below.
    this.targetIndexProperty = new NumberProperty(0, {
      validValues: getValidTargetIndices(this.managedElements.length)
    });

    // @public (read-only) {EnumerationDeprecatedProperty} - this is for phet-io Studio so that Clients can select an element
    // by name instead of index
    this.targetElementNameProperty = new EnumerationDeprecatedProperty(elementNames, elementNames.VALUES[0], {
      tandem: tandem.createTandem('targetElementNameProperty'),
      phetioDocumentation: 'indicates which element on the carousel is currently selected by name'
    });

    // @public (read-only) {BooleanProperty}
    this.animationInProgressProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('animationInProgressProperty'),
      phetioReadOnly: true,
      phetioDocumentation: 'indicates whether an animation from one carousel position to another is in progress'
    });

    // @private - variables needed to manage carousel transitions
    this.elapsedTransitionTime = 0; // in seconds
    this.currentCarouselOffset = new Vector2(0, 0); // in meters
    this.initialCarouselOffset = new Vector2(0, 0); // in meters

    // set the variables needed for animation each time the target changes
    this.targetElementNameProperty.lazyLink(targetElement => {
      // update the target index
      this.targetIndexProperty.set(_.findIndex(this.elementNames.VALUES, targetElement));

      // set vars for the transition
      this.elapsedTransitionTime = 0;
      this.initialCarouselOffset = this.currentCarouselOffset;
      this.animationInProgressProperty.set(true);
    });

    // activate and deactivate energy system elements as they come into the center position
    this.animationInProgressProperty.lazyLink(animationInProgress => {
      // prevent deactivation from overwriting state values, see https://github.com/phetsims/energy-forms-and-changes/issues/337
      // activation can create extra EnergyChunks or clear them (which are instrumented since https://github.com/phetsims/energy-forms-and-changes/issues/350)
      if (phet.joist.sim.isSettingPhetioStateProperty.value) {
        return;
      }
      if (animationInProgress) {
        // deactivate elements while things are moving
        this.managedElements.forEach(element => {
          if (element.activeProperty.value) {
            element.deactivate();
          }
        });
      } else {
        // activate the element that is now in the active position
        this.getElement(this.targetIndexProperty.value).activate();
      }
    });

    // Don't animate the system elements when setting state for better user experience when launching the sim.
    Tandem.PHET_IO_ENABLED && phet.phetio.phetioEngine.phetioStateEngine.stateSetEmitter.addListener(() => {
      this.finishInProgressAnimation();
    });
  }

  /**
   * add element to list of managed elements
   * @param {EnergySystemElement} element - energy system element to be added to carousel
   * @private
   */
  add(element) {
    // set the element's position to be at the end of the carousel
    if (this.managedElements.length === 0) {
      element.positionProperty.set(this.selectedElementPosition);
    } else {
      const lastElement = this.managedElements[this.managedElements.length - 1];
      element.positionProperty.set(lastElement.positionProperty.value.plus(this.offsetBetweenElements));
    }

    // add element to the list of managed elements
    this.managedElements.push(element);

    // update opacities
    this.updateManagedElementOpacities();
  }

  /**
   * get an element from carousel by index
   * @param  {number} index Requested position in array of EnergySystemElements
   * @returns {EnergySystemElement}
   * @public
   */
  getElement(index) {
    assert && assert(index < this.managedElements.length, `carousel index out of range: ${index}`);
    return this.managedElements[index];
  }

  /**
   * get the currently selected element from carousel
   * @returns {EnergySystemElement|null}
   * @public
   */
  getSelectedElement() {
    const i = this.targetIndexProperty.get();
    if (i < this.managedElements.length) {
      return this.managedElements[i];
    }
    return null;
  }

  /**
   * sets the carousel to its target destination
   * @private
   */
  finishInProgressAnimation() {
    const targetCarouselOffset = this.offsetBetweenElements.times(-this.targetIndexProperty.get());
    this.currentCarouselOffset = targetCarouselOffset;
    this.updateManagedElementPositions();
    this.updateManagedElementOpacities();
    this.animationInProgressProperty.set(false);
  }

  /**
   * step this model element
   * @param {number} dt - time step, in seconds
   * @public
   */
  step(dt) {
    if (!this.atTargetPosition()) {
      this.elapsedTransitionTime += dt;
      const targetCarouselOffset = this.offsetBetweenElements.times(-this.targetIndexProperty.get());
      const totalTravelVector = targetCarouselOffset.minus(this.initialCarouselOffset);
      const transitionProportion = Utils.clamp(this.elapsedTransitionTime / TRANSITION_DURATION, 0, 1);
      this.currentCarouselOffset = this.initialCarouselOffset.plus(totalTravelVector.times(Easing.CUBIC_IN_OUT.value(transitionProportion)));
      if (transitionProportion === 1) {
        this.finishInProgressAnimation();
      } else {
        this.updateManagedElementPositions();
        this.updateManagedElementOpacities();
      }
    }
  }

  /**
   * sets the position in model space of each element based on the state of the carousel
   * @private
   */
  updateManagedElementPositions() {
    for (let i = 0; i < this.managedElements.length; i++) {
      let position = this.selectedElementPosition.plus(this.offsetBetweenElements.times(i));
      position = position.plus(this.currentCarouselOffset);
      this.managedElements[i].positionProperty.set(position);
    }
  }

  /**
   * sets the opacity of each element based on the state of the carousel. elements fade out as they get farther from
   * the active, selected position
   * @private
   */
  updateManagedElementOpacities() {
    this.managedElements.forEach(managedElement => {
      const distanceToSelection = managedElement.positionProperty.value.distance(this.selectedElementPosition);
      const opacity = Utils.clamp(1 - distanceToSelection / this.offsetBetweenElements.magnitude, 0, 1);
      managedElement.opacityProperty.set(opacity);
    });
  }

  /**
   * whether the current selected element is in its destination spot
   * @private
   * @returns {boolean}
   */
  atTargetPosition() {
    const targetCarouselOffset = this.offsetBetweenElements.times(-this.targetIndexProperty.value);
    return this.currentCarouselOffset.equals(targetCarouselOffset);
  }
}
energyFormsAndChanges.register('EnergySystemElementCarousel', EnergySystemElementCarousel);
export default EnergySystemElementCarousel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJFbnVtZXJhdGlvbkRlcHJlY2F0ZWRQcm9wZXJ0eSIsIk51bWJlclByb3BlcnR5IiwiVXRpbHMiLCJWZWN0b3IyIiwiVGFuZGVtIiwiRWFzaW5nIiwiZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzIiwiVFJBTlNJVElPTl9EVVJBVElPTiIsIkVuZXJneVN5c3RlbUVsZW1lbnRDYXJvdXNlbCIsImNvbnN0cnVjdG9yIiwiZWxlbWVudHMiLCJlbGVtZW50TmFtZXMiLCJzZWxlY3RlZEVsZW1lbnRQb3NpdGlvbiIsIm9mZnNldEJldHdlZW5FbGVtZW50cyIsInRhbmRlbSIsIm1hbmFnZWRFbGVtZW50cyIsImZvckVhY2giLCJlbGVtZW50IiwiYWRkIiwiZ2V0VmFsaWRUYXJnZXRJbmRpY2VzIiwibnVtYmVyT2ZFbGVtZW50cyIsInZhbGlkVGFyZ2V0SW5kaWNlcyIsIl8iLCJ0aW1lcyIsImluZGV4IiwicHVzaCIsImFzc2VydCIsImxlbmd0aCIsIlZBTFVFUyIsInRhcmdldEluZGV4UHJvcGVydHkiLCJ2YWxpZFZhbHVlcyIsInRhcmdldEVsZW1lbnROYW1lUHJvcGVydHkiLCJjcmVhdGVUYW5kZW0iLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwiYW5pbWF0aW9uSW5Qcm9ncmVzc1Byb3BlcnR5IiwicGhldGlvUmVhZE9ubHkiLCJlbGFwc2VkVHJhbnNpdGlvblRpbWUiLCJjdXJyZW50Q2Fyb3VzZWxPZmZzZXQiLCJpbml0aWFsQ2Fyb3VzZWxPZmZzZXQiLCJsYXp5TGluayIsInRhcmdldEVsZW1lbnQiLCJzZXQiLCJmaW5kSW5kZXgiLCJhbmltYXRpb25JblByb2dyZXNzIiwicGhldCIsImpvaXN0Iiwic2ltIiwiaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eSIsInZhbHVlIiwiYWN0aXZlUHJvcGVydHkiLCJkZWFjdGl2YXRlIiwiZ2V0RWxlbWVudCIsImFjdGl2YXRlIiwiUEhFVF9JT19FTkFCTEVEIiwicGhldGlvIiwicGhldGlvRW5naW5lIiwicGhldGlvU3RhdGVFbmdpbmUiLCJzdGF0ZVNldEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImZpbmlzaEluUHJvZ3Jlc3NBbmltYXRpb24iLCJwb3NpdGlvblByb3BlcnR5IiwibGFzdEVsZW1lbnQiLCJwbHVzIiwidXBkYXRlTWFuYWdlZEVsZW1lbnRPcGFjaXRpZXMiLCJnZXRTZWxlY3RlZEVsZW1lbnQiLCJpIiwiZ2V0IiwidGFyZ2V0Q2Fyb3VzZWxPZmZzZXQiLCJ1cGRhdGVNYW5hZ2VkRWxlbWVudFBvc2l0aW9ucyIsInN0ZXAiLCJkdCIsImF0VGFyZ2V0UG9zaXRpb24iLCJ0b3RhbFRyYXZlbFZlY3RvciIsIm1pbnVzIiwidHJhbnNpdGlvblByb3BvcnRpb24iLCJjbGFtcCIsIkNVQklDX0lOX09VVCIsInBvc2l0aW9uIiwibWFuYWdlZEVsZW1lbnQiLCJkaXN0YW5jZVRvU2VsZWN0aW9uIiwiZGlzdGFuY2UiLCJvcGFjaXR5IiwibWFnbml0dWRlIiwib3BhY2l0eVByb3BlcnR5IiwiZXF1YWxzIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJFbmVyZ3lTeXN0ZW1FbGVtZW50Q2Fyb3VzZWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vLyBOb3RlOiBUaGlzIGZpbGUgaXMgYSBtYXNodXAgb2YgdHdvIHBvcnRlZCBKYXZhIGZpbGVzOiBDYXJvdXNlbCBhbmRcclxuLy8gRW5lcmd5U3lzdGVtRWxlbWVudENhcm91c2VsLiBDYXJvdXNlbC5qYXZhIHdhcyBub3QgcG9ydGVkIHRvIGF2b2lkIGNvbmZ1c2lvblxyXG4vLyB3aXRoIHRoZSBQaEVUIFN1biBDYXJvdXNlbC5qcyBVSSBjb21wb25lbnQuXHJcblxyXG4vKipcclxuICogVGhpcyB0eXBlIGltcGxlbWVudHMgYSBtb2RlbC1iYXNlZCBjYXJvdXNlbCBmb3IgcG9zaXRpb25hYmxlIG1vZGVsIGVsZW1lbnRzLiBNb2RlbCBlbGVtZW50cyBhcmUgcG9zaXRpb25lZCBiYXNlZFxyXG4gKiBvbiB0aGUgY3VycmVudCBzZWxlY3Rpb24sIGFuZCBhbiBBUEkgaXMgcHJvdmlkZWQgdGhhdCBhbGxvd3MgY2xpZW50cyB0byBjaGFuZ2UgdGhvc2Ugc2VsZWN0aW9uLiBDaGFuZ2VzIHRvIHRoZVxyXG4gKiBzZWxlY3RlZCBlbGVtZW50IGFyZSBhbmltYXRlZC5cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKiBAYXV0aG9yIEFuZHJldyBBZGFyZVxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZ1xyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRW51bWVyYXRpb25EZXByZWNhdGVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbnVtZXJhdGlvbkRlcHJlY2F0ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IEVhc2luZyBmcm9tICcuLi8uLi8uLi8uLi90d2l4dC9qcy9FYXNpbmcuanMnO1xyXG5pbXBvcnQgZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzIGZyb20gJy4uLy4uL2VuZXJneUZvcm1zQW5kQ2hhbmdlcy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgVFJBTlNJVElPTl9EVVJBVElPTiA9IDAuNzU7IC8vIGluIHNlY29uZHNcclxuXHJcbmNsYXNzIEVuZXJneVN5c3RlbUVsZW1lbnRDYXJvdXNlbCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7RW5lcmd5U3lzdGVtRWxlbWVudFtdfSBlbGVtZW50cyAtIGFycmF5IG9mIGVsZW1lbnRzIHRvIGFkZCB0byB0aGlzIGNhcm91c2VsXHJcbiAgICogQHBhcmFtIHtFbnVtZXJhdGlvbkRlcHJlY2F0ZWR9IGVsZW1lbnROYW1lcyAtIHRoZSBuYW1lcyBvZiB0aGUgZWxlbWVudHMgYmVpbmcgYWRkZWRcclxuICAgKiBAcGFyYW0ge1ZlY3RvcjJ9IHNlbGVjdGVkRWxlbWVudFBvc2l0aW9uIC0gcG9zaXRpb24gd2hlcmUgdGhlIHNlbGVjdGVkIG1vZGVsIGVsZW1lbnQgc2hvdWxkIGJlXHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBvZmZzZXRCZXR3ZWVuRWxlbWVudHMgLSBvZmZzZXQgYmV0d2VlbiBlbGVtZW50cyBpbiB0aGUgY2Fyb3VzZWxcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGVsZW1lbnRzLCBlbGVtZW50TmFtZXMsIHNlbGVjdGVkRWxlbWVudFBvc2l0aW9uLCBvZmZzZXRCZXR3ZWVuRWxlbWVudHMsIHRhbmRlbSApIHtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIHtWZWN0b3IyfSAtIHRoZSBwb3NpdGlvbiBpbiBtb2RlbCBzcGFjZSB3aGVyZSB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGVsZW1lbnQgc2hvdWxkIGJlXHJcbiAgICB0aGlzLnNlbGVjdGVkRWxlbWVudFBvc2l0aW9uID0gc2VsZWN0ZWRFbGVtZW50UG9zaXRpb247XHJcblxyXG4gICAgLy8gQHByaXZhdGUge1ZlY3RvcjJ9IC0gdGhlIG9mZnNldCBiZXR3ZWVuIGVsZW1lbnRzIHdob3NlIHBvc2l0aW9uIGlzIG1hbmFnZWQgYnkgdGhpcyBjYXJvdXNlbFxyXG4gICAgdGhpcy5vZmZzZXRCZXR3ZWVuRWxlbWVudHMgPSBvZmZzZXRCZXR3ZWVuRWxlbWVudHM7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAocmVhZC1vbmx5KSB7RW5lcmd5U3lzdGVtRWxlbWVudFtdfSAtIGxpc3Qgb2YgdGhlIGVsZW1lbnRzIHdob3NlIHBvc2l0aW9uIGlzIG1hbmFnZWQgYnkgdGhpcyBjYXJvdXNlbFxyXG4gICAgdGhpcy5tYW5hZ2VkRWxlbWVudHMgPSBbXTtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIHtFbnVtZXJhdGlvbkRlcHJlY2F0ZWR9IC0gbmFtZXMgdGhhdCBjb3JyZXNwb25kIHRvIGVhY2ggZWxlbWVudFxyXG4gICAgdGhpcy5lbGVtZW50TmFtZXMgPSBlbGVtZW50TmFtZXM7XHJcblxyXG4gICAgLy8gYWRkIGVhY2ggZWxlbWVudCB0byB0aGUgYXJyYXkgb2YgbWFuYWdlZCBlbGVtZW50c1xyXG4gICAgZWxlbWVudHMuZm9yRWFjaCggZWxlbWVudCA9PiB0aGlzLmFkZCggZWxlbWVudCApICk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBjYWxjdWxhdGVzIHRoZSB2YWxpZCB0YXJnZXQgaW5kaWNlcyBmb3IgdGhpcyBjYXJvdXNlbFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBudW1iZXJPZkVsZW1lbnRzXHJcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyW119XHJcbiAgICAgKi9cclxuICAgIGNvbnN0IGdldFZhbGlkVGFyZ2V0SW5kaWNlcyA9IG51bWJlck9mRWxlbWVudHMgPT4ge1xyXG4gICAgICBjb25zdCB2YWxpZFRhcmdldEluZGljZXMgPSBbXTtcclxuICAgICAgXy50aW1lcyggbnVtYmVyT2ZFbGVtZW50cywgaW5kZXggPT4ge1xyXG4gICAgICAgIHZhbGlkVGFyZ2V0SW5kaWNlcy5wdXNoKCBpbmRleCApO1xyXG4gICAgICB9ICk7XHJcbiAgICAgIHJldHVybiB2YWxpZFRhcmdldEluZGljZXM7XHJcbiAgICB9O1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMubWFuYWdlZEVsZW1lbnRzLmxlbmd0aCA9PT0gdGhpcy5lbGVtZW50TmFtZXMuVkFMVUVTLmxlbmd0aCxcclxuICAgICAgJ1RoZSBudW1iZXIgb2YgbWFuYWdlZCBlbGVtZW50cyBtdXN0IGVxdWFsIHRoZSBudW1iZXIgb2YgZWxlbWVudCBuYW1lIGVudW1lcmF0aW9uIHZhbHVlcycgKTtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIHtOdW1iZXJQcm9wZXJ0eX0gLSBpbmRpY2F0ZXMgd2hpY2ggZWxlbWVudCBvbiB0aGUgY2Fyb3VzZWwgaXMgY3VycmVudGx5IHNlbGVjdGVkIGJ5IGluZGV4LlxyXG4gICAgLy8gdGhpcyBpbmRleCBpcyB0aGUgZ3JvdW5kIHRydXRoIGZvciBtYW5hZ2luZyB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGVsZW1lbnQsIGJ1dCBpcyBjb250cm9sbGVkIGJ5XHJcbiAgICAvLyB0YXJnZXRFbGVtZW50TmFtZVByb3BlcnR5IGJlbG93LlxyXG4gICAgdGhpcy50YXJnZXRJbmRleFByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCAwLCB7XHJcbiAgICAgIHZhbGlkVmFsdWVzOiBnZXRWYWxpZFRhcmdldEluZGljZXMoIHRoaXMubWFuYWdlZEVsZW1lbnRzLmxlbmd0aCApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAocmVhZC1vbmx5KSB7RW51bWVyYXRpb25EZXByZWNhdGVkUHJvcGVydHl9IC0gdGhpcyBpcyBmb3IgcGhldC1pbyBTdHVkaW8gc28gdGhhdCBDbGllbnRzIGNhbiBzZWxlY3QgYW4gZWxlbWVudFxyXG4gICAgLy8gYnkgbmFtZSBpbnN0ZWFkIG9mIGluZGV4XHJcbiAgICB0aGlzLnRhcmdldEVsZW1lbnROYW1lUHJvcGVydHkgPSBuZXcgRW51bWVyYXRpb25EZXByZWNhdGVkUHJvcGVydHkoIGVsZW1lbnROYW1lcywgZWxlbWVudE5hbWVzLlZBTFVFU1sgMCBdLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3RhcmdldEVsZW1lbnROYW1lUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdpbmRpY2F0ZXMgd2hpY2ggZWxlbWVudCBvbiB0aGUgY2Fyb3VzZWwgaXMgY3VycmVudGx5IHNlbGVjdGVkIGJ5IG5hbWUnXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAocmVhZC1vbmx5KSB7Qm9vbGVhblByb3BlcnR5fVxyXG4gICAgdGhpcy5hbmltYXRpb25JblByb2dyZXNzUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdhbmltYXRpb25JblByb2dyZXNzUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnaW5kaWNhdGVzIHdoZXRoZXIgYW4gYW5pbWF0aW9uIGZyb20gb25lIGNhcm91c2VsIHBvc2l0aW9uIHRvIGFub3RoZXIgaXMgaW4gcHJvZ3Jlc3MnXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgLSB2YXJpYWJsZXMgbmVlZGVkIHRvIG1hbmFnZSBjYXJvdXNlbCB0cmFuc2l0aW9uc1xyXG4gICAgdGhpcy5lbGFwc2VkVHJhbnNpdGlvblRpbWUgPSAwOyAvLyBpbiBzZWNvbmRzXHJcbiAgICB0aGlzLmN1cnJlbnRDYXJvdXNlbE9mZnNldCA9IG5ldyBWZWN0b3IyKCAwLCAwICk7IC8vIGluIG1ldGVyc1xyXG4gICAgdGhpcy5pbml0aWFsQ2Fyb3VzZWxPZmZzZXQgPSBuZXcgVmVjdG9yMiggMCwgMCApOyAvLyBpbiBtZXRlcnNcclxuXHJcbiAgICAvLyBzZXQgdGhlIHZhcmlhYmxlcyBuZWVkZWQgZm9yIGFuaW1hdGlvbiBlYWNoIHRpbWUgdGhlIHRhcmdldCBjaGFuZ2VzXHJcbiAgICB0aGlzLnRhcmdldEVsZW1lbnROYW1lUHJvcGVydHkubGF6eUxpbmsoIHRhcmdldEVsZW1lbnQgPT4ge1xyXG5cclxuICAgICAgLy8gdXBkYXRlIHRoZSB0YXJnZXQgaW5kZXhcclxuICAgICAgdGhpcy50YXJnZXRJbmRleFByb3BlcnR5LnNldCggXy5maW5kSW5kZXgoIHRoaXMuZWxlbWVudE5hbWVzLlZBTFVFUywgdGFyZ2V0RWxlbWVudCApICk7XHJcblxyXG4gICAgICAvLyBzZXQgdmFycyBmb3IgdGhlIHRyYW5zaXRpb25cclxuICAgICAgdGhpcy5lbGFwc2VkVHJhbnNpdGlvblRpbWUgPSAwO1xyXG4gICAgICB0aGlzLmluaXRpYWxDYXJvdXNlbE9mZnNldCA9IHRoaXMuY3VycmVudENhcm91c2VsT2Zmc2V0O1xyXG4gICAgICB0aGlzLmFuaW1hdGlvbkluUHJvZ3Jlc3NQcm9wZXJ0eS5zZXQoIHRydWUgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBhY3RpdmF0ZSBhbmQgZGVhY3RpdmF0ZSBlbmVyZ3kgc3lzdGVtIGVsZW1lbnRzIGFzIHRoZXkgY29tZSBpbnRvIHRoZSBjZW50ZXIgcG9zaXRpb25cclxuICAgIHRoaXMuYW5pbWF0aW9uSW5Qcm9ncmVzc1Byb3BlcnR5LmxhenlMaW5rKCBhbmltYXRpb25JblByb2dyZXNzID0+IHtcclxuXHJcbiAgICAgIC8vIHByZXZlbnQgZGVhY3RpdmF0aW9uIGZyb20gb3ZlcndyaXRpbmcgc3RhdGUgdmFsdWVzLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2VuZXJneS1mb3Jtcy1hbmQtY2hhbmdlcy9pc3N1ZXMvMzM3XHJcbiAgICAgIC8vIGFjdGl2YXRpb24gY2FuIGNyZWF0ZSBleHRyYSBFbmVyZ3lDaHVua3Mgb3IgY2xlYXIgdGhlbSAod2hpY2ggYXJlIGluc3RydW1lbnRlZCBzaW5jZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZW5lcmd5LWZvcm1zLWFuZC1jaGFuZ2VzL2lzc3Vlcy8zNTApXHJcbiAgICAgIGlmICggcGhldC5qb2lzdC5zaW0uaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCBhbmltYXRpb25JblByb2dyZXNzICkge1xyXG5cclxuICAgICAgICAvLyBkZWFjdGl2YXRlIGVsZW1lbnRzIHdoaWxlIHRoaW5ncyBhcmUgbW92aW5nXHJcbiAgICAgICAgdGhpcy5tYW5hZ2VkRWxlbWVudHMuZm9yRWFjaCggZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICBpZiAoIGVsZW1lbnQuYWN0aXZlUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuZGVhY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgLy8gYWN0aXZhdGUgdGhlIGVsZW1lbnQgdGhhdCBpcyBub3cgaW4gdGhlIGFjdGl2ZSBwb3NpdGlvblxyXG4gICAgICAgIHRoaXMuZ2V0RWxlbWVudCggdGhpcy50YXJnZXRJbmRleFByb3BlcnR5LnZhbHVlICkuYWN0aXZhdGUoKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIERvbid0IGFuaW1hdGUgdGhlIHN5c3RlbSBlbGVtZW50cyB3aGVuIHNldHRpbmcgc3RhdGUgZm9yIGJldHRlciB1c2VyIGV4cGVyaWVuY2Ugd2hlbiBsYXVuY2hpbmcgdGhlIHNpbS5cclxuICAgIFRhbmRlbS5QSEVUX0lPX0VOQUJMRUQgJiYgcGhldC5waGV0aW8ucGhldGlvRW5naW5lLnBoZXRpb1N0YXRlRW5naW5lLnN0YXRlU2V0RW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICB0aGlzLmZpbmlzaEluUHJvZ3Jlc3NBbmltYXRpb24oKTtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGFkZCBlbGVtZW50IHRvIGxpc3Qgb2YgbWFuYWdlZCBlbGVtZW50c1xyXG4gICAqIEBwYXJhbSB7RW5lcmd5U3lzdGVtRWxlbWVudH0gZWxlbWVudCAtIGVuZXJneSBzeXN0ZW0gZWxlbWVudCB0byBiZSBhZGRlZCB0byBjYXJvdXNlbFxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgYWRkKCBlbGVtZW50ICkge1xyXG5cclxuICAgIC8vIHNldCB0aGUgZWxlbWVudCdzIHBvc2l0aW9uIHRvIGJlIGF0IHRoZSBlbmQgb2YgdGhlIGNhcm91c2VsXHJcbiAgICBpZiAoIHRoaXMubWFuYWdlZEVsZW1lbnRzLmxlbmd0aCA9PT0gMCApIHtcclxuICAgICAgZWxlbWVudC5wb3NpdGlvblByb3BlcnR5LnNldCggdGhpcy5zZWxlY3RlZEVsZW1lbnRQb3NpdGlvbiApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNvbnN0IGxhc3RFbGVtZW50ID0gdGhpcy5tYW5hZ2VkRWxlbWVudHNbIHRoaXMubWFuYWdlZEVsZW1lbnRzLmxlbmd0aCAtIDEgXTtcclxuICAgICAgZWxlbWVudC5wb3NpdGlvblByb3BlcnR5LnNldCggbGFzdEVsZW1lbnQucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS5wbHVzKCB0aGlzLm9mZnNldEJldHdlZW5FbGVtZW50cyApICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYWRkIGVsZW1lbnQgdG8gdGhlIGxpc3Qgb2YgbWFuYWdlZCBlbGVtZW50c1xyXG4gICAgdGhpcy5tYW5hZ2VkRWxlbWVudHMucHVzaCggZWxlbWVudCApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSBvcGFjaXRpZXNcclxuICAgIHRoaXMudXBkYXRlTWFuYWdlZEVsZW1lbnRPcGFjaXRpZXMoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGdldCBhbiBlbGVtZW50IGZyb20gY2Fyb3VzZWwgYnkgaW5kZXhcclxuICAgKiBAcGFyYW0gIHtudW1iZXJ9IGluZGV4IFJlcXVlc3RlZCBwb3NpdGlvbiBpbiBhcnJheSBvZiBFbmVyZ3lTeXN0ZW1FbGVtZW50c1xyXG4gICAqIEByZXR1cm5zIHtFbmVyZ3lTeXN0ZW1FbGVtZW50fVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBnZXRFbGVtZW50KCBpbmRleCApIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGluZGV4IDwgdGhpcy5tYW5hZ2VkRWxlbWVudHMubGVuZ3RoLCBgY2Fyb3VzZWwgaW5kZXggb3V0IG9mIHJhbmdlOiAke2luZGV4fWAgKTtcclxuICAgIHJldHVybiB0aGlzLm1hbmFnZWRFbGVtZW50c1sgaW5kZXggXTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGdldCB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGVsZW1lbnQgZnJvbSBjYXJvdXNlbFxyXG4gICAqIEByZXR1cm5zIHtFbmVyZ3lTeXN0ZW1FbGVtZW50fG51bGx9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGdldFNlbGVjdGVkRWxlbWVudCgpIHtcclxuICAgIGNvbnN0IGkgPSB0aGlzLnRhcmdldEluZGV4UHJvcGVydHkuZ2V0KCk7XHJcbiAgICBpZiAoIGkgPCB0aGlzLm1hbmFnZWRFbGVtZW50cy5sZW5ndGggKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLm1hbmFnZWRFbGVtZW50c1sgaSBdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBzZXRzIHRoZSBjYXJvdXNlbCB0byBpdHMgdGFyZ2V0IGRlc3RpbmF0aW9uXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmaW5pc2hJblByb2dyZXNzQW5pbWF0aW9uKCkge1xyXG4gICAgY29uc3QgdGFyZ2V0Q2Fyb3VzZWxPZmZzZXQgPSB0aGlzLm9mZnNldEJldHdlZW5FbGVtZW50cy50aW1lcyggLXRoaXMudGFyZ2V0SW5kZXhQcm9wZXJ0eS5nZXQoKSApO1xyXG4gICAgdGhpcy5jdXJyZW50Q2Fyb3VzZWxPZmZzZXQgPSB0YXJnZXRDYXJvdXNlbE9mZnNldDtcclxuXHJcbiAgICB0aGlzLnVwZGF0ZU1hbmFnZWRFbGVtZW50UG9zaXRpb25zKCk7XHJcbiAgICB0aGlzLnVwZGF0ZU1hbmFnZWRFbGVtZW50T3BhY2l0aWVzKCk7XHJcblxyXG4gICAgdGhpcy5hbmltYXRpb25JblByb2dyZXNzUHJvcGVydHkuc2V0KCBmYWxzZSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogc3RlcCB0aGlzIG1vZGVsIGVsZW1lbnRcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHQgLSB0aW1lIHN0ZXAsIGluIHNlY29uZHNcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc3RlcCggZHQgKSB7XHJcbiAgICBpZiAoICF0aGlzLmF0VGFyZ2V0UG9zaXRpb24oKSApIHtcclxuICAgICAgdGhpcy5lbGFwc2VkVHJhbnNpdGlvblRpbWUgKz0gZHQ7XHJcbiAgICAgIGNvbnN0IHRhcmdldENhcm91c2VsT2Zmc2V0ID0gdGhpcy5vZmZzZXRCZXR3ZWVuRWxlbWVudHMudGltZXMoIC10aGlzLnRhcmdldEluZGV4UHJvcGVydHkuZ2V0KCkgKTtcclxuICAgICAgY29uc3QgdG90YWxUcmF2ZWxWZWN0b3IgPSB0YXJnZXRDYXJvdXNlbE9mZnNldC5taW51cyggdGhpcy5pbml0aWFsQ2Fyb3VzZWxPZmZzZXQgKTtcclxuICAgICAgY29uc3QgdHJhbnNpdGlvblByb3BvcnRpb24gPSBVdGlscy5jbGFtcCggdGhpcy5lbGFwc2VkVHJhbnNpdGlvblRpbWUgLyBUUkFOU0lUSU9OX0RVUkFUSU9OLCAwLCAxICk7XHJcbiAgICAgIHRoaXMuY3VycmVudENhcm91c2VsT2Zmc2V0ID1cclxuICAgICAgICB0aGlzLmluaXRpYWxDYXJvdXNlbE9mZnNldC5wbHVzKCB0b3RhbFRyYXZlbFZlY3Rvci50aW1lcyggRWFzaW5nLkNVQklDX0lOX09VVC52YWx1ZSggdHJhbnNpdGlvblByb3BvcnRpb24gKSApICk7XHJcblxyXG4gICAgICBpZiAoIHRyYW5zaXRpb25Qcm9wb3J0aW9uID09PSAxICkge1xyXG4gICAgICAgIHRoaXMuZmluaXNoSW5Qcm9ncmVzc0FuaW1hdGlvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMudXBkYXRlTWFuYWdlZEVsZW1lbnRQb3NpdGlvbnMoKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZU1hbmFnZWRFbGVtZW50T3BhY2l0aWVzKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHNldHMgdGhlIHBvc2l0aW9uIGluIG1vZGVsIHNwYWNlIG9mIGVhY2ggZWxlbWVudCBiYXNlZCBvbiB0aGUgc3RhdGUgb2YgdGhlIGNhcm91c2VsXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICB1cGRhdGVNYW5hZ2VkRWxlbWVudFBvc2l0aW9ucygpIHtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMubWFuYWdlZEVsZW1lbnRzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBsZXQgcG9zaXRpb24gPSB0aGlzLnNlbGVjdGVkRWxlbWVudFBvc2l0aW9uLnBsdXMoIHRoaXMub2Zmc2V0QmV0d2VlbkVsZW1lbnRzLnRpbWVzKCBpICkgKTtcclxuICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbi5wbHVzKCB0aGlzLmN1cnJlbnRDYXJvdXNlbE9mZnNldCApO1xyXG4gICAgICB0aGlzLm1hbmFnZWRFbGVtZW50c1sgaSBdLnBvc2l0aW9uUHJvcGVydHkuc2V0KCBwb3NpdGlvbiApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogc2V0cyB0aGUgb3BhY2l0eSBvZiBlYWNoIGVsZW1lbnQgYmFzZWQgb24gdGhlIHN0YXRlIG9mIHRoZSBjYXJvdXNlbC4gZWxlbWVudHMgZmFkZSBvdXQgYXMgdGhleSBnZXQgZmFydGhlciBmcm9tXHJcbiAgICogdGhlIGFjdGl2ZSwgc2VsZWN0ZWQgcG9zaXRpb25cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIHVwZGF0ZU1hbmFnZWRFbGVtZW50T3BhY2l0aWVzKCkge1xyXG4gICAgdGhpcy5tYW5hZ2VkRWxlbWVudHMuZm9yRWFjaCggbWFuYWdlZEVsZW1lbnQgPT4ge1xyXG4gICAgICBjb25zdCBkaXN0YW5jZVRvU2VsZWN0aW9uID0gbWFuYWdlZEVsZW1lbnQucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS5kaXN0YW5jZSggdGhpcy5zZWxlY3RlZEVsZW1lbnRQb3NpdGlvbiApO1xyXG4gICAgICBjb25zdCBvcGFjaXR5ID0gVXRpbHMuY2xhbXAoIDEgLSAoIGRpc3RhbmNlVG9TZWxlY3Rpb24gLyB0aGlzLm9mZnNldEJldHdlZW5FbGVtZW50cy5tYWduaXR1ZGUgKSwgMCwgMSApO1xyXG4gICAgICBtYW5hZ2VkRWxlbWVudC5vcGFjaXR5UHJvcGVydHkuc2V0KCBvcGFjaXR5ICk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiB3aGV0aGVyIHRoZSBjdXJyZW50IHNlbGVjdGVkIGVsZW1lbnQgaXMgaW4gaXRzIGRlc3RpbmF0aW9uIHNwb3RcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAqL1xyXG4gIGF0VGFyZ2V0UG9zaXRpb24oKSB7XHJcbiAgICBjb25zdCB0YXJnZXRDYXJvdXNlbE9mZnNldCA9IHRoaXMub2Zmc2V0QmV0d2VlbkVsZW1lbnRzLnRpbWVzKCAtdGhpcy50YXJnZXRJbmRleFByb3BlcnR5LnZhbHVlICk7XHJcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50Q2Fyb3VzZWxPZmZzZXQuZXF1YWxzKCB0YXJnZXRDYXJvdXNlbE9mZnNldCApO1xyXG4gIH1cclxufVxyXG5cclxuZW5lcmd5Rm9ybXNBbmRDaGFuZ2VzLnJlZ2lzdGVyKCAnRW5lcmd5U3lzdGVtRWxlbWVudENhcm91c2VsJywgRW5lcmd5U3lzdGVtRWxlbWVudENhcm91c2VsICk7XHJcbmV4cG9ydCBkZWZhdWx0IEVuZXJneVN5c3RlbUVsZW1lbnRDYXJvdXNlbDtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsNkJBQTZCLE1BQU0sc0RBQXNEO0FBQ2hHLE9BQU9DLGNBQWMsTUFBTSx1Q0FBdUM7QUFDbEUsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLE1BQU0sTUFBTSxpQ0FBaUM7QUFDcEQsT0FBT0MsTUFBTSxNQUFNLGdDQUFnQztBQUNuRCxPQUFPQyxxQkFBcUIsTUFBTSxnQ0FBZ0M7O0FBRWxFO0FBQ0EsTUFBTUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLENBQUM7O0FBRWxDLE1BQU1DLDJCQUEyQixDQUFDO0VBRWhDO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLFdBQVdBLENBQUVDLFFBQVEsRUFBRUMsWUFBWSxFQUFFQyx1QkFBdUIsRUFBRUMscUJBQXFCLEVBQUVDLE1BQU0sRUFBRztJQUU1RjtJQUNBLElBQUksQ0FBQ0YsdUJBQXVCLEdBQUdBLHVCQUF1Qjs7SUFFdEQ7SUFDQSxJQUFJLENBQUNDLHFCQUFxQixHQUFHQSxxQkFBcUI7O0lBRWxEO0lBQ0EsSUFBSSxDQUFDRSxlQUFlLEdBQUcsRUFBRTs7SUFFekI7SUFDQSxJQUFJLENBQUNKLFlBQVksR0FBR0EsWUFBWTs7SUFFaEM7SUFDQUQsUUFBUSxDQUFDTSxPQUFPLENBQUVDLE9BQU8sSUFBSSxJQUFJLENBQUNDLEdBQUcsQ0FBRUQsT0FBUSxDQUFFLENBQUM7O0lBRWxEO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtJQUNJLE1BQU1FLHFCQUFxQixHQUFHQyxnQkFBZ0IsSUFBSTtNQUNoRCxNQUFNQyxrQkFBa0IsR0FBRyxFQUFFO01BQzdCQyxDQUFDLENBQUNDLEtBQUssQ0FBRUgsZ0JBQWdCLEVBQUVJLEtBQUssSUFBSTtRQUNsQ0gsa0JBQWtCLENBQUNJLElBQUksQ0FBRUQsS0FBTSxDQUFDO01BQ2xDLENBQUUsQ0FBQztNQUNILE9BQU9ILGtCQUFrQjtJQUMzQixDQUFDO0lBRURLLE1BQU0sSUFBSUEsTUFBTSxDQUFFLElBQUksQ0FBQ1gsZUFBZSxDQUFDWSxNQUFNLEtBQUssSUFBSSxDQUFDaEIsWUFBWSxDQUFDaUIsTUFBTSxDQUFDRCxNQUFNLEVBQy9FLHlGQUEwRixDQUFDOztJQUU3RjtJQUNBO0lBQ0E7SUFDQSxJQUFJLENBQUNFLG1CQUFtQixHQUFHLElBQUk1QixjQUFjLENBQUUsQ0FBQyxFQUFFO01BQ2hENkIsV0FBVyxFQUFFWCxxQkFBcUIsQ0FBRSxJQUFJLENBQUNKLGVBQWUsQ0FBQ1ksTUFBTztJQUNsRSxDQUFFLENBQUM7O0lBRUg7SUFDQTtJQUNBLElBQUksQ0FBQ0kseUJBQXlCLEdBQUcsSUFBSS9CLDZCQUE2QixDQUFFVyxZQUFZLEVBQUVBLFlBQVksQ0FBQ2lCLE1BQU0sQ0FBRSxDQUFDLENBQUUsRUFBRTtNQUMxR2QsTUFBTSxFQUFFQSxNQUFNLENBQUNrQixZQUFZLENBQUUsMkJBQTRCLENBQUM7TUFDMURDLG1CQUFtQixFQUFFO0lBQ3ZCLENBQUUsQ0FBQzs7SUFFSDtJQUNBLElBQUksQ0FBQ0MsMkJBQTJCLEdBQUcsSUFBSW5DLGVBQWUsQ0FBRSxLQUFLLEVBQUU7TUFDN0RlLE1BQU0sRUFBRUEsTUFBTSxDQUFDa0IsWUFBWSxDQUFFLDZCQUE4QixDQUFDO01BQzVERyxjQUFjLEVBQUUsSUFBSTtNQUNwQkYsbUJBQW1CLEVBQUU7SUFDdkIsQ0FBRSxDQUFDOztJQUVIO0lBQ0EsSUFBSSxDQUFDRyxxQkFBcUIsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNoQyxJQUFJLENBQUNDLHFCQUFxQixHQUFHLElBQUlsQyxPQUFPLENBQUUsQ0FBQyxFQUFFLENBQUUsQ0FBQyxDQUFDLENBQUM7SUFDbEQsSUFBSSxDQUFDbUMscUJBQXFCLEdBQUcsSUFBSW5DLE9BQU8sQ0FBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDLENBQUMsQ0FBQzs7SUFFbEQ7SUFDQSxJQUFJLENBQUM0Qix5QkFBeUIsQ0FBQ1EsUUFBUSxDQUFFQyxhQUFhLElBQUk7TUFFeEQ7TUFDQSxJQUFJLENBQUNYLG1CQUFtQixDQUFDWSxHQUFHLENBQUVuQixDQUFDLENBQUNvQixTQUFTLENBQUUsSUFBSSxDQUFDL0IsWUFBWSxDQUFDaUIsTUFBTSxFQUFFWSxhQUFjLENBQUUsQ0FBQzs7TUFFdEY7TUFDQSxJQUFJLENBQUNKLHFCQUFxQixHQUFHLENBQUM7TUFDOUIsSUFBSSxDQUFDRSxxQkFBcUIsR0FBRyxJQUFJLENBQUNELHFCQUFxQjtNQUN2RCxJQUFJLENBQUNILDJCQUEyQixDQUFDTyxHQUFHLENBQUUsSUFBSyxDQUFDO0lBQzlDLENBQUUsQ0FBQzs7SUFFSDtJQUNBLElBQUksQ0FBQ1AsMkJBQTJCLENBQUNLLFFBQVEsQ0FBRUksbUJBQW1CLElBQUk7TUFFaEU7TUFDQTtNQUNBLElBQUtDLElBQUksQ0FBQ0MsS0FBSyxDQUFDQyxHQUFHLENBQUNDLDRCQUE0QixDQUFDQyxLQUFLLEVBQUc7UUFDdkQ7TUFDRjtNQUNBLElBQUtMLG1CQUFtQixFQUFHO1FBRXpCO1FBQ0EsSUFBSSxDQUFDNUIsZUFBZSxDQUFDQyxPQUFPLENBQUVDLE9BQU8sSUFBSTtVQUN2QyxJQUFLQSxPQUFPLENBQUNnQyxjQUFjLENBQUNELEtBQUssRUFBRztZQUNsQy9CLE9BQU8sQ0FBQ2lDLFVBQVUsQ0FBQyxDQUFDO1VBQ3RCO1FBQ0YsQ0FBRSxDQUFDO01BQ0wsQ0FBQyxNQUNJO1FBRUg7UUFDQSxJQUFJLENBQUNDLFVBQVUsQ0FBRSxJQUFJLENBQUN0QixtQkFBbUIsQ0FBQ21CLEtBQU0sQ0FBQyxDQUFDSSxRQUFRLENBQUMsQ0FBQztNQUM5RDtJQUNGLENBQUUsQ0FBQzs7SUFFSDtJQUNBaEQsTUFBTSxDQUFDaUQsZUFBZSxJQUFJVCxJQUFJLENBQUNVLE1BQU0sQ0FBQ0MsWUFBWSxDQUFDQyxpQkFBaUIsQ0FBQ0MsZUFBZSxDQUFDQyxXQUFXLENBQUUsTUFBTTtNQUN0RyxJQUFJLENBQUNDLHlCQUF5QixDQUFDLENBQUM7SUFDbEMsQ0FBRSxDQUFDO0VBQ0w7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNFekMsR0FBR0EsQ0FBRUQsT0FBTyxFQUFHO0lBRWI7SUFDQSxJQUFLLElBQUksQ0FBQ0YsZUFBZSxDQUFDWSxNQUFNLEtBQUssQ0FBQyxFQUFHO01BQ3ZDVixPQUFPLENBQUMyQyxnQkFBZ0IsQ0FBQ25CLEdBQUcsQ0FBRSxJQUFJLENBQUM3Qix1QkFBd0IsQ0FBQztJQUM5RCxDQUFDLE1BQ0k7TUFDSCxNQUFNaUQsV0FBVyxHQUFHLElBQUksQ0FBQzlDLGVBQWUsQ0FBRSxJQUFJLENBQUNBLGVBQWUsQ0FBQ1ksTUFBTSxHQUFHLENBQUMsQ0FBRTtNQUMzRVYsT0FBTyxDQUFDMkMsZ0JBQWdCLENBQUNuQixHQUFHLENBQUVvQixXQUFXLENBQUNELGdCQUFnQixDQUFDWixLQUFLLENBQUNjLElBQUksQ0FBRSxJQUFJLENBQUNqRCxxQkFBc0IsQ0FBRSxDQUFDO0lBQ3ZHOztJQUVBO0lBQ0EsSUFBSSxDQUFDRSxlQUFlLENBQUNVLElBQUksQ0FBRVIsT0FBUSxDQUFDOztJQUVwQztJQUNBLElBQUksQ0FBQzhDLDZCQUE2QixDQUFDLENBQUM7RUFDdEM7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VaLFVBQVVBLENBQUUzQixLQUFLLEVBQUc7SUFDbEJFLE1BQU0sSUFBSUEsTUFBTSxDQUFFRixLQUFLLEdBQUcsSUFBSSxDQUFDVCxlQUFlLENBQUNZLE1BQU0sRUFBRyxnQ0FBK0JILEtBQU0sRUFBRSxDQUFDO0lBQ2hHLE9BQU8sSUFBSSxDQUFDVCxlQUFlLENBQUVTLEtBQUssQ0FBRTtFQUN0Qzs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0V3QyxrQkFBa0JBLENBQUEsRUFBRztJQUNuQixNQUFNQyxDQUFDLEdBQUcsSUFBSSxDQUFDcEMsbUJBQW1CLENBQUNxQyxHQUFHLENBQUMsQ0FBQztJQUN4QyxJQUFLRCxDQUFDLEdBQUcsSUFBSSxDQUFDbEQsZUFBZSxDQUFDWSxNQUFNLEVBQUc7TUFDckMsT0FBTyxJQUFJLENBQUNaLGVBQWUsQ0FBRWtELENBQUMsQ0FBRTtJQUNsQztJQUNBLE9BQU8sSUFBSTtFQUNiOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0VBQ0VOLHlCQUF5QkEsQ0FBQSxFQUFHO0lBQzFCLE1BQU1RLG9CQUFvQixHQUFHLElBQUksQ0FBQ3RELHFCQUFxQixDQUFDVSxLQUFLLENBQUUsQ0FBQyxJQUFJLENBQUNNLG1CQUFtQixDQUFDcUMsR0FBRyxDQUFDLENBQUUsQ0FBQztJQUNoRyxJQUFJLENBQUM3QixxQkFBcUIsR0FBRzhCLG9CQUFvQjtJQUVqRCxJQUFJLENBQUNDLDZCQUE2QixDQUFDLENBQUM7SUFDcEMsSUFBSSxDQUFDTCw2QkFBNkIsQ0FBQyxDQUFDO0lBRXBDLElBQUksQ0FBQzdCLDJCQUEyQixDQUFDTyxHQUFHLENBQUUsS0FBTSxDQUFDO0VBQy9DOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRTRCLElBQUlBLENBQUVDLEVBQUUsRUFBRztJQUNULElBQUssQ0FBQyxJQUFJLENBQUNDLGdCQUFnQixDQUFDLENBQUMsRUFBRztNQUM5QixJQUFJLENBQUNuQyxxQkFBcUIsSUFBSWtDLEVBQUU7TUFDaEMsTUFBTUgsb0JBQW9CLEdBQUcsSUFBSSxDQUFDdEQscUJBQXFCLENBQUNVLEtBQUssQ0FBRSxDQUFDLElBQUksQ0FBQ00sbUJBQW1CLENBQUNxQyxHQUFHLENBQUMsQ0FBRSxDQUFDO01BQ2hHLE1BQU1NLGlCQUFpQixHQUFHTCxvQkFBb0IsQ0FBQ00sS0FBSyxDQUFFLElBQUksQ0FBQ25DLHFCQUFzQixDQUFDO01BQ2xGLE1BQU1vQyxvQkFBb0IsR0FBR3hFLEtBQUssQ0FBQ3lFLEtBQUssQ0FBRSxJQUFJLENBQUN2QyxxQkFBcUIsR0FBRzdCLG1CQUFtQixFQUFFLENBQUMsRUFBRSxDQUFFLENBQUM7TUFDbEcsSUFBSSxDQUFDOEIscUJBQXFCLEdBQ3hCLElBQUksQ0FBQ0MscUJBQXFCLENBQUN3QixJQUFJLENBQUVVLGlCQUFpQixDQUFDakQsS0FBSyxDQUFFbEIsTUFBTSxDQUFDdUUsWUFBWSxDQUFDNUIsS0FBSyxDQUFFMEIsb0JBQXFCLENBQUUsQ0FBRSxDQUFDO01BRWpILElBQUtBLG9CQUFvQixLQUFLLENBQUMsRUFBRztRQUNoQyxJQUFJLENBQUNmLHlCQUF5QixDQUFDLENBQUM7TUFDbEMsQ0FBQyxNQUNJO1FBQ0gsSUFBSSxDQUFDUyw2QkFBNkIsQ0FBQyxDQUFDO1FBQ3BDLElBQUksQ0FBQ0wsNkJBQTZCLENBQUMsQ0FBQztNQUN0QztJQUNGO0VBQ0Y7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7RUFDRUssNkJBQTZCQSxDQUFBLEVBQUc7SUFDOUIsS0FBTSxJQUFJSCxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUcsSUFBSSxDQUFDbEQsZUFBZSxDQUFDWSxNQUFNLEVBQUVzQyxDQUFDLEVBQUUsRUFBRztNQUN0RCxJQUFJWSxRQUFRLEdBQUcsSUFBSSxDQUFDakUsdUJBQXVCLENBQUNrRCxJQUFJLENBQUUsSUFBSSxDQUFDakQscUJBQXFCLENBQUNVLEtBQUssQ0FBRTBDLENBQUUsQ0FBRSxDQUFDO01BQ3pGWSxRQUFRLEdBQUdBLFFBQVEsQ0FBQ2YsSUFBSSxDQUFFLElBQUksQ0FBQ3pCLHFCQUFzQixDQUFDO01BQ3RELElBQUksQ0FBQ3RCLGVBQWUsQ0FBRWtELENBQUMsQ0FBRSxDQUFDTCxnQkFBZ0IsQ0FBQ25CLEdBQUcsQ0FBRW9DLFFBQVMsQ0FBQztJQUM1RDtFQUNGOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRWQsNkJBQTZCQSxDQUFBLEVBQUc7SUFDOUIsSUFBSSxDQUFDaEQsZUFBZSxDQUFDQyxPQUFPLENBQUU4RCxjQUFjLElBQUk7TUFDOUMsTUFBTUMsbUJBQW1CLEdBQUdELGNBQWMsQ0FBQ2xCLGdCQUFnQixDQUFDWixLQUFLLENBQUNnQyxRQUFRLENBQUUsSUFBSSxDQUFDcEUsdUJBQXdCLENBQUM7TUFDMUcsTUFBTXFFLE9BQU8sR0FBRy9FLEtBQUssQ0FBQ3lFLEtBQUssQ0FBRSxDQUFDLEdBQUtJLG1CQUFtQixHQUFHLElBQUksQ0FBQ2xFLHFCQUFxQixDQUFDcUUsU0FBVyxFQUFFLENBQUMsRUFBRSxDQUFFLENBQUM7TUFDdkdKLGNBQWMsQ0FBQ0ssZUFBZSxDQUFDMUMsR0FBRyxDQUFFd0MsT0FBUSxDQUFDO0lBQy9DLENBQUUsQ0FBQztFQUNMOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRVYsZ0JBQWdCQSxDQUFBLEVBQUc7SUFDakIsTUFBTUosb0JBQW9CLEdBQUcsSUFBSSxDQUFDdEQscUJBQXFCLENBQUNVLEtBQUssQ0FBRSxDQUFDLElBQUksQ0FBQ00sbUJBQW1CLENBQUNtQixLQUFNLENBQUM7SUFDaEcsT0FBTyxJQUFJLENBQUNYLHFCQUFxQixDQUFDK0MsTUFBTSxDQUFFakIsb0JBQXFCLENBQUM7RUFDbEU7QUFDRjtBQUVBN0QscUJBQXFCLENBQUMrRSxRQUFRLENBQUUsNkJBQTZCLEVBQUU3RSwyQkFBNEIsQ0FBQztBQUM1RixlQUFlQSwyQkFBMkIifQ==