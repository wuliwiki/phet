// Copyright 2018-2023, University of Colorado Boulder

/**
 * Draws the curve that is described by a quadratic equation.
 * The curve is labeled with the equation.
 * Performance is optimized to update only what's visible.
 *
 * @author Andrea Lin
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Range from '../../../../dot/js/Range.js';
import { Shape } from '../../../../kite/js/imports.js';
import optionize from '../../../../phet-core/js/optionize.js';
import { Node, Path } from '../../../../scenery/js/imports.js';
import GQEquationNode from '../../common/view/GQEquationNode.js';
import graphingQuadratics from '../../graphingQuadratics.js';
import GQConstants from '../GQConstants.js';
import GQEquationFactory from './GQEquationFactory.js';
export default class QuadraticNode extends Node {
  // quadratic curve, y = ax^2 + bx + c
  // equation on a translucent background

  // Makes positioning and rotating the equation a little easier to grok. equationParent will be rotated and translated,
  // while equationNode will be translated to adjust spacing between the equation and its associated curve.
  // ranges for equation placement, just inside the edges of the graph
  /**
   * @param quadraticProperty - the quadratic to be rendered
   * @param xRange - range of the graph's x-axis
   * @param yRange - range of the graph's y-axis
   * @param modelViewTransform
   * @param equationForm - form of the equation displayed on the curve
   * @param equationsVisibleProperty
   * @param [providedOptions]
   */
  constructor(quadraticProperty, xRange, yRange, modelViewTransform, equationForm, equationsVisibleProperty, providedOptions) {
    const options = optionize()({
      // SelfOptions
      preventVertexAndEquationOverlap: true,
      lineWidth: 1
    }, providedOptions);
    super(options);
    this.quadraticProperty = quadraticProperty;
    this.xRange = xRange;
    this.yRange = yRange;
    this.modelViewTransform = modelViewTransform;
    this.equationForm = equationForm;
    this.preventVertexAndEquationOverlap = options.preventVertexAndEquationOverlap;
    this.quadraticPath = new Path(null, {
      lineWidth: options.lineWidth
    });
    this.addChild(this.quadraticPath);
    this.equationNode = new GQEquationNode({
      maxWidth: 200 // determined empirically
    });

    this.equationParent = new Node({
      children: [this.equationNode]
    });
    this.addChild(this.equationParent);
    this.xEquationRange = new Range(xRange.min + GQConstants.EQUATION_X_MARGIN, xRange.max - GQConstants.EQUATION_X_MARGIN);
    this.yEquationRange = new Range(yRange.min + GQConstants.EQUATION_Y_MARGIN, yRange.max - GQConstants.EQUATION_Y_MARGIN);

    // updates the equation, but only when it's visible
    const quadraticListener = quadratic => {
      if (this.visible) {
        this.update(quadratic);
      }
    };
    quadraticProperty.link(quadraticListener); // unlink required in dispose

    // updates the equation when it is made visible
    const equationsVisibleListener = visible => {
      this.equationParent.visible = visible;
      if (visible) {
        this.updateEquation(this.quadraticProperty.value);
      }
    };
    equationsVisibleProperty.link(equationsVisibleListener); // unlink required in dispose

    // Update when this Node becomes visible.
    this.visibleProperty.link(visible => visible && this.update(this.quadraticProperty.value));
    this.disposeQuadraticNode = () => {
      if (quadraticProperty.hasListener(quadraticListener)) {
        quadraticProperty.unlink(quadraticListener);
      }
      if (equationsVisibleProperty.hasListener(equationsVisibleListener)) {
        equationsVisibleProperty.unlink(equationsVisibleListener);
      }
    };
  }
  dispose() {
    this.disposeQuadraticNode();
    super.dispose();
  }

  /**
   * Updates this Node to display the specified quadratic.
   */
  update(quadratic) {
    // update shape
    const bezierControlPoints = quadratic.getControlPoints(this.xRange);
    this.quadraticPath.shape = new Shape().moveToPoint(bezierControlPoints.startPoint).quadraticCurveToPoint(bezierControlPoints.controlPoint, bezierControlPoints.endPoint).transformed(this.modelViewTransform.getMatrix());

    // update color
    this.quadraticPath.stroke = quadratic.color;

    // update equation
    this.updateEquation(quadratic);
  }

  /**
   * Updates the equation displayed on the quadratic.
   */
  updateEquation(quadratic) {
    // update the equation text
    if (this.equationForm === 'standard') {
      this.equationNode.setTextString(GQEquationFactory.createStandardForm(quadratic));
    } else {
      this.equationNode.setTextString(GQEquationFactory.createVertexForm(quadratic));
    }

    // update the equation color
    this.equationNode.setTextFill(quadratic.color);

    // reset the origin for the equation
    this.equationNode.x = 0;
    this.equationNode.y = 0;

    // Position the equation.
    if (quadratic.a === 0) {
      // straight line: equation above left end of line
      const x = this.xEquationRange.min;
      const p = quadratic.getClosestPointInRange(x, this.xEquationRange, this.yEquationRange);
      assert && assert(this.xRange.contains(p.x) && this.yRange.contains(p.y), `p is off the graph: ${p}`);

      // rotate to match line's slope
      this.equationParent.rotation = -Math.atan(quadratic.b);

      // move equation to (x,y)
      this.equationParent.translation = this.modelViewTransform.modelToViewPosition(p);

      // space between line and equation
      this.equationNode.bottom = -GQConstants.EQUATION_CURVE_SPACING;
    } else {
      const vertex = quadratic.vertex;
      assert && assert(vertex);

      // parabola: pick a point on the parabola, at the edge of the graph
      const x = vertex.x >= 0 ? this.xEquationRange.min : this.xEquationRange.max;
      const p = quadratic.getClosestPointInRange(x, this.xEquationRange, this.yEquationRange);
      assert && assert(this.xRange.contains(p.x) && this.yRange.contains(p.y), `p is off the graph: ${p}`);

      // Width of the equation in model coordinates
      const equationModelWidth = Math.abs(this.modelViewTransform.viewToModelDeltaX(this.equationNode.width));
      if (this.preventVertexAndEquationOverlap && Math.abs(quadratic.a) >= 0.75 &&
      // a narrow parabola
      p.distance(vertex) <= equationModelWidth) {
        // When the equation and vertex are liable to overlap, place the equation (not rotated) to the left or right
        // of the parabola. See https://github.com/phetsims/graphing-quadratics/issues/39#issuecomment-426688827
        this.equationParent.rotation = 0;
        this.equationParent.translation = this.modelViewTransform.modelToViewPosition(p);
        if (p.x < vertex.x) {
          this.equationNode.right = -GQConstants.EQUATION_CURVE_SPACING;
        } else {
          this.equationNode.left = GQConstants.EQUATION_CURVE_SPACING;
        }
        if (p.y < 0) {
          this.equationNode.bottom = 0;
        }
      } else {
        // Place the equation on outside of the parabola, parallel to tangent line, at the edge of the graph.
        // rotate to match tangent's slope
        this.equationParent.rotation = -Math.atan(quadratic.getTangentSlope(p.x));

        // move equation to (x,y)
        this.equationParent.translation = this.modelViewTransform.modelToViewPosition(p);

        // when equation is on the right side of parabola, move it's origin to the right end of the equation
        if (p.x > vertex.x) {
          this.equationNode.right = 0;
        }

        // space between tangent line and equation
        if (quadratic.a >= 0) {
          this.equationNode.top = GQConstants.EQUATION_CURVE_SPACING;
        } else {
          this.equationNode.bottom = -GQConstants.EQUATION_CURVE_SPACING;
        }
      }
    }
  }
}
graphingQuadratics.register('QuadraticNode', QuadraticNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSYW5nZSIsIlNoYXBlIiwib3B0aW9uaXplIiwiTm9kZSIsIlBhdGgiLCJHUUVxdWF0aW9uTm9kZSIsImdyYXBoaW5nUXVhZHJhdGljcyIsIkdRQ29uc3RhbnRzIiwiR1FFcXVhdGlvbkZhY3RvcnkiLCJRdWFkcmF0aWNOb2RlIiwiY29uc3RydWN0b3IiLCJxdWFkcmF0aWNQcm9wZXJ0eSIsInhSYW5nZSIsInlSYW5nZSIsIm1vZGVsVmlld1RyYW5zZm9ybSIsImVxdWF0aW9uRm9ybSIsImVxdWF0aW9uc1Zpc2libGVQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJwcmV2ZW50VmVydGV4QW5kRXF1YXRpb25PdmVybGFwIiwibGluZVdpZHRoIiwicXVhZHJhdGljUGF0aCIsImFkZENoaWxkIiwiZXF1YXRpb25Ob2RlIiwibWF4V2lkdGgiLCJlcXVhdGlvblBhcmVudCIsImNoaWxkcmVuIiwieEVxdWF0aW9uUmFuZ2UiLCJtaW4iLCJFUVVBVElPTl9YX01BUkdJTiIsIm1heCIsInlFcXVhdGlvblJhbmdlIiwiRVFVQVRJT05fWV9NQVJHSU4iLCJxdWFkcmF0aWNMaXN0ZW5lciIsInF1YWRyYXRpYyIsInZpc2libGUiLCJ1cGRhdGUiLCJsaW5rIiwiZXF1YXRpb25zVmlzaWJsZUxpc3RlbmVyIiwidXBkYXRlRXF1YXRpb24iLCJ2YWx1ZSIsInZpc2libGVQcm9wZXJ0eSIsImRpc3Bvc2VRdWFkcmF0aWNOb2RlIiwiaGFzTGlzdGVuZXIiLCJ1bmxpbmsiLCJkaXNwb3NlIiwiYmV6aWVyQ29udHJvbFBvaW50cyIsImdldENvbnRyb2xQb2ludHMiLCJzaGFwZSIsIm1vdmVUb1BvaW50Iiwic3RhcnRQb2ludCIsInF1YWRyYXRpY0N1cnZlVG9Qb2ludCIsImNvbnRyb2xQb2ludCIsImVuZFBvaW50IiwidHJhbnNmb3JtZWQiLCJnZXRNYXRyaXgiLCJzdHJva2UiLCJjb2xvciIsInNldFRleHRTdHJpbmciLCJjcmVhdGVTdGFuZGFyZEZvcm0iLCJjcmVhdGVWZXJ0ZXhGb3JtIiwic2V0VGV4dEZpbGwiLCJ4IiwieSIsImEiLCJwIiwiZ2V0Q2xvc2VzdFBvaW50SW5SYW5nZSIsImFzc2VydCIsImNvbnRhaW5zIiwicm90YXRpb24iLCJNYXRoIiwiYXRhbiIsImIiLCJ0cmFuc2xhdGlvbiIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJib3R0b20iLCJFUVVBVElPTl9DVVJWRV9TUEFDSU5HIiwidmVydGV4IiwiZXF1YXRpb25Nb2RlbFdpZHRoIiwiYWJzIiwidmlld1RvTW9kZWxEZWx0YVgiLCJ3aWR0aCIsImRpc3RhbmNlIiwicmlnaHQiLCJsZWZ0IiwiZ2V0VGFuZ2VudFNsb3BlIiwidG9wIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJRdWFkcmF0aWNOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE4LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIERyYXdzIHRoZSBjdXJ2ZSB0aGF0IGlzIGRlc2NyaWJlZCBieSBhIHF1YWRyYXRpYyBlcXVhdGlvbi5cclxuICogVGhlIGN1cnZlIGlzIGxhYmVsZWQgd2l0aCB0aGUgZXF1YXRpb24uXHJcbiAqIFBlcmZvcm1hbmNlIGlzIG9wdGltaXplZCB0byB1cGRhdGUgb25seSB3aGF0J3MgdmlzaWJsZS5cclxuICpcclxuICogQGF1dGhvciBBbmRyZWEgTGluXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja09wdGlvbmFsIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrT3B0aW9uYWwuanMnO1xyXG5pbXBvcnQgTW9kZWxWaWV3VHJhbnNmb3JtMiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIE5vZGVPcHRpb25zLCBQYXRoLCBQYXRoT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBHUUVxdWF0aW9uTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9HUUVxdWF0aW9uTm9kZS5qcyc7XHJcbmltcG9ydCBncmFwaGluZ1F1YWRyYXRpY3MgZnJvbSAnLi4vLi4vZ3JhcGhpbmdRdWFkcmF0aWNzLmpzJztcclxuaW1wb3J0IEdRQ29uc3RhbnRzIGZyb20gJy4uL0dRQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IFF1YWRyYXRpYyBmcm9tICcuLi9tb2RlbC9RdWFkcmF0aWMuanMnO1xyXG5pbXBvcnQgR1FFcXVhdGlvbkZhY3RvcnkgZnJvbSAnLi9HUUVxdWF0aW9uRmFjdG9yeS5qcyc7XHJcbmltcG9ydCB7IEVxdWF0aW9uRm9ybSB9IGZyb20gJy4vR1FWaWV3UHJvcGVydGllcy5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIHByZXZlbnRWZXJ0ZXhBbmRFcXVhdGlvbk92ZXJsYXA/OiBib29sZWFuOyAvLyBwcmV2ZW50IGEgcGFyYWJvbGEncyB2ZXJ0ZXggYW5kIGVxdWF0aW9uIGZyb20gb3ZlcmxhcHBpbmdcclxufSAmIFBpY2tPcHRpb25hbDxQYXRoT3B0aW9ucywgJ2xpbmVXaWR0aCc+O1xyXG5cclxuZXhwb3J0IHR5cGUgUXVhZHJhdGljTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFBpY2tPcHRpb25hbDxOb2RlT3B0aW9ucywgJ3Zpc2libGVQcm9wZXJ0eSc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUXVhZHJhdGljTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IHF1YWRyYXRpY1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxRdWFkcmF0aWM+O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgeFJhbmdlOiBSYW5nZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IHlSYW5nZTogUmFuZ2U7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBlcXVhdGlvbkZvcm06IEVxdWF0aW9uRm9ybTtcclxuICBwcml2YXRlIHJlYWRvbmx5IHByZXZlbnRWZXJ0ZXhBbmRFcXVhdGlvbk92ZXJsYXA6IGJvb2xlYW47XHJcblxyXG4gIHByb3RlY3RlZCByZWFkb25seSBxdWFkcmF0aWNQYXRoOiBQYXRoOyAvLyBxdWFkcmF0aWMgY3VydmUsIHkgPSBheF4yICsgYnggKyBjXHJcbiAgcHJpdmF0ZSByZWFkb25seSBlcXVhdGlvbk5vZGU6IEdRRXF1YXRpb25Ob2RlOyAvLyBlcXVhdGlvbiBvbiBhIHRyYW5zbHVjZW50IGJhY2tncm91bmRcclxuXHJcbiAgLy8gTWFrZXMgcG9zaXRpb25pbmcgYW5kIHJvdGF0aW5nIHRoZSBlcXVhdGlvbiBhIGxpdHRsZSBlYXNpZXIgdG8gZ3Jvay4gZXF1YXRpb25QYXJlbnQgd2lsbCBiZSByb3RhdGVkIGFuZCB0cmFuc2xhdGVkLFxyXG4gIC8vIHdoaWxlIGVxdWF0aW9uTm9kZSB3aWxsIGJlIHRyYW5zbGF0ZWQgdG8gYWRqdXN0IHNwYWNpbmcgYmV0d2VlbiB0aGUgZXF1YXRpb24gYW5kIGl0cyBhc3NvY2lhdGVkIGN1cnZlLlxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZXF1YXRpb25QYXJlbnQ6IE5vZGU7XHJcblxyXG4gIC8vIHJhbmdlcyBmb3IgZXF1YXRpb24gcGxhY2VtZW50LCBqdXN0IGluc2lkZSB0aGUgZWRnZXMgb2YgdGhlIGdyYXBoXHJcbiAgcHJpdmF0ZSByZWFkb25seSB4RXF1YXRpb25SYW5nZTogUmFuZ2U7XHJcbiAgcHJpdmF0ZSByZWFkb25seSB5RXF1YXRpb25SYW5nZTogUmFuZ2U7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZVF1YWRyYXRpY05vZGU6ICgpID0+IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBxdWFkcmF0aWNQcm9wZXJ0eSAtIHRoZSBxdWFkcmF0aWMgdG8gYmUgcmVuZGVyZWRcclxuICAgKiBAcGFyYW0geFJhbmdlIC0gcmFuZ2Ugb2YgdGhlIGdyYXBoJ3MgeC1heGlzXHJcbiAgICogQHBhcmFtIHlSYW5nZSAtIHJhbmdlIG9mIHRoZSBncmFwaCdzIHktYXhpc1xyXG4gICAqIEBwYXJhbSBtb2RlbFZpZXdUcmFuc2Zvcm1cclxuICAgKiBAcGFyYW0gZXF1YXRpb25Gb3JtIC0gZm9ybSBvZiB0aGUgZXF1YXRpb24gZGlzcGxheWVkIG9uIHRoZSBjdXJ2ZVxyXG4gICAqIEBwYXJhbSBlcXVhdGlvbnNWaXNpYmxlUHJvcGVydHlcclxuICAgKiBAcGFyYW0gW3Byb3ZpZGVkT3B0aW9uc11cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHF1YWRyYXRpY1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxRdWFkcmF0aWM+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgeFJhbmdlOiBSYW5nZSwgeVJhbmdlOiBSYW5nZSxcclxuICAgICAgICAgICAgICAgICAgICAgIG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMixcclxuICAgICAgICAgICAgICAgICAgICAgIGVxdWF0aW9uRm9ybTogRXF1YXRpb25Gb3JtLFxyXG4gICAgICAgICAgICAgICAgICAgICAgZXF1YXRpb25zVmlzaWJsZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPixcclxuICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVkT3B0aW9ucz86IFF1YWRyYXRpY05vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8UXVhZHJhdGljTm9kZU9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgcHJldmVudFZlcnRleEFuZEVxdWF0aW9uT3ZlcmxhcDogdHJ1ZSxcclxuICAgICAgbGluZVdpZHRoOiAxXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMucXVhZHJhdGljUHJvcGVydHkgPSBxdWFkcmF0aWNQcm9wZXJ0eTtcclxuICAgIHRoaXMueFJhbmdlID0geFJhbmdlO1xyXG4gICAgdGhpcy55UmFuZ2UgPSB5UmFuZ2U7XHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSA9IG1vZGVsVmlld1RyYW5zZm9ybTtcclxuICAgIHRoaXMuZXF1YXRpb25Gb3JtID0gZXF1YXRpb25Gb3JtO1xyXG4gICAgdGhpcy5wcmV2ZW50VmVydGV4QW5kRXF1YXRpb25PdmVybGFwID0gb3B0aW9ucy5wcmV2ZW50VmVydGV4QW5kRXF1YXRpb25PdmVybGFwO1xyXG5cclxuICAgIHRoaXMucXVhZHJhdGljUGF0aCA9IG5ldyBQYXRoKCBudWxsLCB7XHJcbiAgICAgIGxpbmVXaWR0aDogb3B0aW9ucy5saW5lV2lkdGhcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMucXVhZHJhdGljUGF0aCApO1xyXG5cclxuICAgIHRoaXMuZXF1YXRpb25Ob2RlID0gbmV3IEdRRXF1YXRpb25Ob2RlKCB7XHJcbiAgICAgIG1heFdpZHRoOiAyMDAgLy8gZGV0ZXJtaW5lZCBlbXBpcmljYWxseVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZXF1YXRpb25QYXJlbnQgPSBuZXcgTm9kZSggeyBjaGlsZHJlbjogWyB0aGlzLmVxdWF0aW9uTm9kZSBdIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuZXF1YXRpb25QYXJlbnQgKTtcclxuXHJcbiAgICB0aGlzLnhFcXVhdGlvblJhbmdlID1cclxuICAgICAgbmV3IFJhbmdlKCB4UmFuZ2UubWluICsgR1FDb25zdGFudHMuRVFVQVRJT05fWF9NQVJHSU4sIHhSYW5nZS5tYXggLSBHUUNvbnN0YW50cy5FUVVBVElPTl9YX01BUkdJTiApO1xyXG4gICAgdGhpcy55RXF1YXRpb25SYW5nZSA9XHJcbiAgICAgIG5ldyBSYW5nZSggeVJhbmdlLm1pbiArIEdRQ29uc3RhbnRzLkVRVUFUSU9OX1lfTUFSR0lOLCB5UmFuZ2UubWF4IC0gR1FDb25zdGFudHMuRVFVQVRJT05fWV9NQVJHSU4gKTtcclxuXHJcbiAgICAvLyB1cGRhdGVzIHRoZSBlcXVhdGlvbiwgYnV0IG9ubHkgd2hlbiBpdCdzIHZpc2libGVcclxuICAgIGNvbnN0IHF1YWRyYXRpY0xpc3RlbmVyID0gKCBxdWFkcmF0aWM6IFF1YWRyYXRpYyApID0+IHtcclxuICAgICAgaWYgKCB0aGlzLnZpc2libGUgKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGUoIHF1YWRyYXRpYyApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgcXVhZHJhdGljUHJvcGVydHkubGluayggcXVhZHJhdGljTGlzdGVuZXIgKTsgLy8gdW5saW5rIHJlcXVpcmVkIGluIGRpc3Bvc2VcclxuXHJcbiAgICAvLyB1cGRhdGVzIHRoZSBlcXVhdGlvbiB3aGVuIGl0IGlzIG1hZGUgdmlzaWJsZVxyXG4gICAgY29uc3QgZXF1YXRpb25zVmlzaWJsZUxpc3RlbmVyID0gKCB2aXNpYmxlOiBib29sZWFuICkgPT4ge1xyXG4gICAgICB0aGlzLmVxdWF0aW9uUGFyZW50LnZpc2libGUgPSB2aXNpYmxlO1xyXG4gICAgICBpZiAoIHZpc2libGUgKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVFcXVhdGlvbiggdGhpcy5xdWFkcmF0aWNQcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgZXF1YXRpb25zVmlzaWJsZVByb3BlcnR5LmxpbmsoIGVxdWF0aW9uc1Zpc2libGVMaXN0ZW5lciApOyAvLyB1bmxpbmsgcmVxdWlyZWQgaW4gZGlzcG9zZVxyXG5cclxuICAgIC8vIFVwZGF0ZSB3aGVuIHRoaXMgTm9kZSBiZWNvbWVzIHZpc2libGUuXHJcbiAgICB0aGlzLnZpc2libGVQcm9wZXJ0eS5saW5rKCB2aXNpYmxlID0+IHZpc2libGUgJiYgdGhpcy51cGRhdGUoIHRoaXMucXVhZHJhdGljUHJvcGVydHkudmFsdWUgKSApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZVF1YWRyYXRpY05vZGUgPSAoKSA9PiB7XHJcbiAgICAgIGlmICggcXVhZHJhdGljUHJvcGVydHkuaGFzTGlzdGVuZXIoIHF1YWRyYXRpY0xpc3RlbmVyICkgKSB7XHJcbiAgICAgICAgcXVhZHJhdGljUHJvcGVydHkudW5saW5rKCBxdWFkcmF0aWNMaXN0ZW5lciApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICggZXF1YXRpb25zVmlzaWJsZVByb3BlcnR5Lmhhc0xpc3RlbmVyKCBlcXVhdGlvbnNWaXNpYmxlTGlzdGVuZXIgKSApIHtcclxuICAgICAgICBlcXVhdGlvbnNWaXNpYmxlUHJvcGVydHkudW5saW5rKCBlcXVhdGlvbnNWaXNpYmxlTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNwb3NlUXVhZHJhdGljTm9kZSgpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlcyB0aGlzIE5vZGUgdG8gZGlzcGxheSB0aGUgc3BlY2lmaWVkIHF1YWRyYXRpYy5cclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZSggcXVhZHJhdGljOiBRdWFkcmF0aWMgKTogdm9pZCB7XHJcblxyXG4gICAgLy8gdXBkYXRlIHNoYXBlXHJcbiAgICBjb25zdCBiZXppZXJDb250cm9sUG9pbnRzID0gcXVhZHJhdGljLmdldENvbnRyb2xQb2ludHMoIHRoaXMueFJhbmdlICk7XHJcbiAgICB0aGlzLnF1YWRyYXRpY1BhdGguc2hhcGUgPSBuZXcgU2hhcGUoKVxyXG4gICAgICAubW92ZVRvUG9pbnQoIGJlemllckNvbnRyb2xQb2ludHMuc3RhcnRQb2ludCApXHJcbiAgICAgIC5xdWFkcmF0aWNDdXJ2ZVRvUG9pbnQoIGJlemllckNvbnRyb2xQb2ludHMuY29udHJvbFBvaW50LCBiZXppZXJDb250cm9sUG9pbnRzLmVuZFBvaW50IClcclxuICAgICAgLnRyYW5zZm9ybWVkKCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5nZXRNYXRyaXgoKSApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSBjb2xvclxyXG4gICAgdGhpcy5xdWFkcmF0aWNQYXRoLnN0cm9rZSA9IHF1YWRyYXRpYy5jb2xvcjtcclxuXHJcbiAgICAvLyB1cGRhdGUgZXF1YXRpb25cclxuICAgIHRoaXMudXBkYXRlRXF1YXRpb24oIHF1YWRyYXRpYyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlcyB0aGUgZXF1YXRpb24gZGlzcGxheWVkIG9uIHRoZSBxdWFkcmF0aWMuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVFcXVhdGlvbiggcXVhZHJhdGljOiBRdWFkcmF0aWMgKTogdm9pZCB7XHJcblxyXG4gICAgLy8gdXBkYXRlIHRoZSBlcXVhdGlvbiB0ZXh0XHJcbiAgICBpZiAoIHRoaXMuZXF1YXRpb25Gb3JtID09PSAnc3RhbmRhcmQnICkge1xyXG4gICAgICB0aGlzLmVxdWF0aW9uTm9kZS5zZXRUZXh0U3RyaW5nKCBHUUVxdWF0aW9uRmFjdG9yeS5jcmVhdGVTdGFuZGFyZEZvcm0oIHF1YWRyYXRpYyApICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5lcXVhdGlvbk5vZGUuc2V0VGV4dFN0cmluZyggR1FFcXVhdGlvbkZhY3RvcnkuY3JlYXRlVmVydGV4Rm9ybSggcXVhZHJhdGljICkgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyB1cGRhdGUgdGhlIGVxdWF0aW9uIGNvbG9yXHJcbiAgICB0aGlzLmVxdWF0aW9uTm9kZS5zZXRUZXh0RmlsbCggcXVhZHJhdGljLmNvbG9yICk7XHJcblxyXG4gICAgLy8gcmVzZXQgdGhlIG9yaWdpbiBmb3IgdGhlIGVxdWF0aW9uXHJcbiAgICB0aGlzLmVxdWF0aW9uTm9kZS54ID0gMDtcclxuICAgIHRoaXMuZXF1YXRpb25Ob2RlLnkgPSAwO1xyXG5cclxuICAgIC8vIFBvc2l0aW9uIHRoZSBlcXVhdGlvbi5cclxuICAgIGlmICggcXVhZHJhdGljLmEgPT09IDAgKSB7XHJcblxyXG4gICAgICAvLyBzdHJhaWdodCBsaW5lOiBlcXVhdGlvbiBhYm92ZSBsZWZ0IGVuZCBvZiBsaW5lXHJcbiAgICAgIGNvbnN0IHggPSB0aGlzLnhFcXVhdGlvblJhbmdlLm1pbjtcclxuICAgICAgY29uc3QgcCA9IHF1YWRyYXRpYy5nZXRDbG9zZXN0UG9pbnRJblJhbmdlKCB4LCB0aGlzLnhFcXVhdGlvblJhbmdlLCB0aGlzLnlFcXVhdGlvblJhbmdlICk7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMueFJhbmdlLmNvbnRhaW5zKCBwLnggKSAmJiB0aGlzLnlSYW5nZS5jb250YWlucyggcC55ICksIGBwIGlzIG9mZiB0aGUgZ3JhcGg6ICR7cH1gICk7XHJcblxyXG4gICAgICAvLyByb3RhdGUgdG8gbWF0Y2ggbGluZSdzIHNsb3BlXHJcbiAgICAgIHRoaXMuZXF1YXRpb25QYXJlbnQucm90YXRpb24gPSAtTWF0aC5hdGFuKCBxdWFkcmF0aWMuYiApO1xyXG5cclxuICAgICAgLy8gbW92ZSBlcXVhdGlvbiB0byAoeCx5KVxyXG4gICAgICB0aGlzLmVxdWF0aW9uUGFyZW50LnRyYW5zbGF0aW9uID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggcCApO1xyXG5cclxuICAgICAgLy8gc3BhY2UgYmV0d2VlbiBsaW5lIGFuZCBlcXVhdGlvblxyXG4gICAgICB0aGlzLmVxdWF0aW9uTm9kZS5ib3R0b20gPSAtR1FDb25zdGFudHMuRVFVQVRJT05fQ1VSVkVfU1BBQ0lORztcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjb25zdCB2ZXJ0ZXggPSBxdWFkcmF0aWMudmVydGV4ITtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggdmVydGV4ICk7XHJcblxyXG4gICAgICAvLyBwYXJhYm9sYTogcGljayBhIHBvaW50IG9uIHRoZSBwYXJhYm9sYSwgYXQgdGhlIGVkZ2Ugb2YgdGhlIGdyYXBoXHJcbiAgICAgIGNvbnN0IHggPSAoIHZlcnRleC54ID49IDAgKSA/IHRoaXMueEVxdWF0aW9uUmFuZ2UubWluIDogdGhpcy54RXF1YXRpb25SYW5nZS5tYXg7XHJcbiAgICAgIGNvbnN0IHAgPSBxdWFkcmF0aWMuZ2V0Q2xvc2VzdFBvaW50SW5SYW5nZSggeCwgdGhpcy54RXF1YXRpb25SYW5nZSwgdGhpcy55RXF1YXRpb25SYW5nZSApO1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLnhSYW5nZS5jb250YWlucyggcC54ICkgJiYgdGhpcy55UmFuZ2UuY29udGFpbnMoIHAueSApLCBgcCBpcyBvZmYgdGhlIGdyYXBoOiAke3B9YCApO1xyXG5cclxuICAgICAgLy8gV2lkdGggb2YgdGhlIGVxdWF0aW9uIGluIG1vZGVsIGNvb3JkaW5hdGVzXHJcbiAgICAgIGNvbnN0IGVxdWF0aW9uTW9kZWxXaWR0aCA9IE1hdGguYWJzKCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbERlbHRhWCggdGhpcy5lcXVhdGlvbk5vZGUud2lkdGggKSApO1xyXG5cclxuICAgICAgaWYgKCB0aGlzLnByZXZlbnRWZXJ0ZXhBbmRFcXVhdGlvbk92ZXJsYXAgJiZcclxuICAgICAgICAgICBNYXRoLmFicyggcXVhZHJhdGljLmEgKSA+PSAwLjc1ICYmIC8vIGEgbmFycm93IHBhcmFib2xhXHJcbiAgICAgICAgICAgcC5kaXN0YW5jZSggdmVydGV4ICkgPD0gZXF1YXRpb25Nb2RlbFdpZHRoICkge1xyXG5cclxuICAgICAgICAvLyBXaGVuIHRoZSBlcXVhdGlvbiBhbmQgdmVydGV4IGFyZSBsaWFibGUgdG8gb3ZlcmxhcCwgcGxhY2UgdGhlIGVxdWF0aW9uIChub3Qgcm90YXRlZCkgdG8gdGhlIGxlZnQgb3IgcmlnaHRcclxuICAgICAgICAvLyBvZiB0aGUgcGFyYWJvbGEuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZ3JhcGhpbmctcXVhZHJhdGljcy9pc3N1ZXMvMzkjaXNzdWVjb21tZW50LTQyNjY4ODgyN1xyXG4gICAgICAgIHRoaXMuZXF1YXRpb25QYXJlbnQucm90YXRpb24gPSAwO1xyXG4gICAgICAgIHRoaXMuZXF1YXRpb25QYXJlbnQudHJhbnNsYXRpb24gPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBwICk7XHJcbiAgICAgICAgaWYgKCBwLnggPCB2ZXJ0ZXgueCApIHtcclxuICAgICAgICAgIHRoaXMuZXF1YXRpb25Ob2RlLnJpZ2h0ID0gLUdRQ29uc3RhbnRzLkVRVUFUSU9OX0NVUlZFX1NQQUNJTkc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5lcXVhdGlvbk5vZGUubGVmdCA9IEdRQ29uc3RhbnRzLkVRVUFUSU9OX0NVUlZFX1NQQUNJTkc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICggcC55IDwgMCApIHtcclxuICAgICAgICAgIHRoaXMuZXF1YXRpb25Ob2RlLmJvdHRvbSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAvLyBQbGFjZSB0aGUgZXF1YXRpb24gb24gb3V0c2lkZSBvZiB0aGUgcGFyYWJvbGEsIHBhcmFsbGVsIHRvIHRhbmdlbnQgbGluZSwgYXQgdGhlIGVkZ2Ugb2YgdGhlIGdyYXBoLlxyXG4gICAgICAgIC8vIHJvdGF0ZSB0byBtYXRjaCB0YW5nZW50J3Mgc2xvcGVcclxuICAgICAgICB0aGlzLmVxdWF0aW9uUGFyZW50LnJvdGF0aW9uID0gLU1hdGguYXRhbiggcXVhZHJhdGljLmdldFRhbmdlbnRTbG9wZSggcC54ICkgKTtcclxuXHJcbiAgICAgICAgLy8gbW92ZSBlcXVhdGlvbiB0byAoeCx5KVxyXG4gICAgICAgIHRoaXMuZXF1YXRpb25QYXJlbnQudHJhbnNsYXRpb24gPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBwICk7XHJcblxyXG4gICAgICAgIC8vIHdoZW4gZXF1YXRpb24gaXMgb24gdGhlIHJpZ2h0IHNpZGUgb2YgcGFyYWJvbGEsIG1vdmUgaXQncyBvcmlnaW4gdG8gdGhlIHJpZ2h0IGVuZCBvZiB0aGUgZXF1YXRpb25cclxuICAgICAgICBpZiAoIHAueCA+IHZlcnRleC54ICkge1xyXG4gICAgICAgICAgdGhpcy5lcXVhdGlvbk5vZGUucmlnaHQgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gc3BhY2UgYmV0d2VlbiB0YW5nZW50IGxpbmUgYW5kIGVxdWF0aW9uXHJcbiAgICAgICAgaWYgKCBxdWFkcmF0aWMuYSA+PSAwICkge1xyXG4gICAgICAgICAgdGhpcy5lcXVhdGlvbk5vZGUudG9wID0gR1FDb25zdGFudHMuRVFVQVRJT05fQ1VSVkVfU1BBQ0lORztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmVxdWF0aW9uTm9kZS5ib3R0b20gPSAtR1FDb25zdGFudHMuRVFVQVRJT05fQ1VSVkVfU1BBQ0lORztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmdyYXBoaW5nUXVhZHJhdGljcy5yZWdp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