// Copyright 2018-2023, University of Colorado Boulder

/**
 * GQSlider is the base type for sliders in this sim. It adds the following features to VSlider:
 *
 * - snap to interval (see interval)
 * - snap to zero (see snapToZero)
 * - skip zero (see skipZero)
 * - change the taper (see map and inverseMap)
 * - a label about the slider
 *
 * @author Andrea Lin
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DynamicProperty from '../../../../axon/js/DynamicProperty.js';
import Property from '../../../../axon/js/Property.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import Range from '../../../../dot/js/Range.js';
import Utils from '../../../../dot/js/Utils.js';
import optionize from '../../../../phet-core/js/optionize.js';
import { RichText, Text } from '../../../../scenery/js/imports.js';
import VSlider from '../../../../sun/js/VSlider.js';
import graphingQuadratics from '../../graphingQuadratics.js';
import GQConstants from '../GQConstants.js';
const IDENTITY_FUNCTION = value => value;
const DEFAULT_TICK_VALUES = [0];
const DEFAULT_TRACK_SIZE = new Dimension2(1, 130);
const DEFAULT_THUMB_SIZE = new Dimension2(40, 20);
export default class GQSlider extends VSlider {
  /**
   * @param symbol - the coefficient's symbol
   * @param coefficientProperty - the coefficient's value
   * @param [providedOptions]
   */
  constructor(symbol, coefficientProperty, providedOptions) {
    const options = optionize()({
      // SelfOptions
      map: IDENTITY_FUNCTION,
      inverseMap: IDENTITY_FUNCTION,
      interval: 1,
      skipZero: false,
      snapToZero: true,
      tickValues: DEFAULT_TICK_VALUES,
      labelColor: 'black',
      // SliderOptions
      trackSize: DEFAULT_TRACK_SIZE,
      thumbSize: DEFAULT_THUMB_SIZE,
      thumbTouchAreaXDilation: 8,
      // The slider controls an intermediate DynamicProperty, so link to the relevant model Property.
      phetioLinkedProperty: coefficientProperty
    }, providedOptions);
    assert && assert(options.interval > 0, `invalid interval: ${options.interval}`);

    // default and validation for snapToZeroEpsilon
    let snapToZeroEpsilon;
    if (options.snapToZero) {
      if (options.snapToZeroEpsilon === undefined) {
        snapToZeroEpsilon = options.interval;
      } else {
        snapToZeroEpsilon = options.snapToZeroEpsilon;
      }
      assert && assert(snapToZeroEpsilon >= 0 && snapToZeroEpsilon >= options.interval, `invalid snapToZeroEpsilon: ${snapToZeroEpsilon}`);
    }

    // make tick mark lines extend past the thumb
    const thumbSize = options.thumbSize;
    assert && assert(thumbSize);
    options.majorTickLength = thumbSize.width / 2 + 3;

    // apply constrains to the view value
    options.constrainValue = viewValue => {
      if (options.skipZero) {
        // map from view to model
        const newModelValue = options.inverseMap(viewValue);

        // skip zero
        if (Math.abs(newModelValue) < options.interval) {
          return options.map(newModelValue > 0 ? options.interval : -options.interval);
        }
      }

      // no constraint applied
      return viewValue;
    };

    // snap to zero when the drag ends
    if (!options.skipZero && options.snapToZero) {
      options.endDrag = () => {
        if (Math.abs(coefficientProperty.value) < snapToZeroEpsilon) {
          coefficientProperty.value = 0;
        }
      };
    }

    // Map between model and view domains, determines how the slider responds.
    // Do not instrument for PhET-iO, see https://github.com/phetsims/phet-io/issues/1374
    const sliderProperty = new DynamicProperty(new Property(coefficientProperty), {
      bidirectional: true,
      // map from model to view (coefficientProperty to sliderProperty)
      map: value => options.map(value),
      // map from view to model (sliderProperty to coefficientProperty), apply options.interval to model value
      inverseMap: value => Utils.roundToInterval(options.inverseMap(value), options.interval)
    });

    // Convert the range from model to view
    const sliderRange = new Range(options.map(coefficientProperty.range.min), options.map(coefficientProperty.range.max));
    super(sliderProperty, sliderRange, options);

    // Create the tick labels
    if (options.tickValues) {
      options.tickValues.forEach(tickValue => {
        this.addMajorTick(options.map(tickValue), new Text(tickValue, {
          font: GQConstants.SLIDER_TICK_LABEL_FONT
        }));
      });
    }

    // Label that appears above the slider.
    const label = new RichText(symbol, {
      font: GQConstants.SLIDER_LABEL_FONT,
      fill: options.labelColor,
      centerX: this.x,
      bottom: this.top - 2,
      maxWidth: 20,
      // determined empirically
      tandem: options.tandem.createTandem('labelText'),
      phetioDocumentation: 'the label above this slider'
    });
    this.addChild(label);
  }
}
graphingQuadratics.register('GQSlider', GQSlider);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEeW5hbWljUHJvcGVydHkiLCJQcm9wZXJ0eSIsIkRpbWVuc2lvbjIiLCJSYW5nZSIsIlV0aWxzIiwib3B0aW9uaXplIiwiUmljaFRleHQiLCJUZXh0IiwiVlNsaWRlciIsImdyYXBoaW5nUXVhZHJhdGljcyIsIkdRQ29uc3RhbnRzIiwiSURFTlRJVFlfRlVOQ1RJT04iLCJ2YWx1ZSIsIkRFRkFVTFRfVElDS19WQUxVRVMiLCJERUZBVUxUX1RSQUNLX1NJWkUiLCJERUZBVUxUX1RIVU1CX1NJWkUiLCJHUVNsaWRlciIsImNvbnN0cnVjdG9yIiwic3ltYm9sIiwiY29lZmZpY2llbnRQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJtYXAiLCJpbnZlcnNlTWFwIiwiaW50ZXJ2YWwiLCJza2lwWmVybyIsInNuYXBUb1plcm8iLCJ0aWNrVmFsdWVzIiwibGFiZWxDb2xvciIsInRyYWNrU2l6ZSIsInRodW1iU2l6ZSIsInRodW1iVG91Y2hBcmVhWERpbGF0aW9uIiwicGhldGlvTGlua2VkUHJvcGVydHkiLCJhc3NlcnQiLCJzbmFwVG9aZXJvRXBzaWxvbiIsInVuZGVmaW5lZCIsIm1ham9yVGlja0xlbmd0aCIsIndpZHRoIiwiY29uc3RyYWluVmFsdWUiLCJ2aWV3VmFsdWUiLCJuZXdNb2RlbFZhbHVlIiwiTWF0aCIsImFicyIsImVuZERyYWciLCJzbGlkZXJQcm9wZXJ0eSIsImJpZGlyZWN0aW9uYWwiLCJyb3VuZFRvSW50ZXJ2YWwiLCJzbGlkZXJSYW5nZSIsInJhbmdlIiwibWluIiwibWF4IiwiZm9yRWFjaCIsInRpY2tWYWx1ZSIsImFkZE1ham9yVGljayIsImZvbnQiLCJTTElERVJfVElDS19MQUJFTF9GT05UIiwibGFiZWwiLCJTTElERVJfTEFCRUxfRk9OVCIsImZpbGwiLCJjZW50ZXJYIiwieCIsImJvdHRvbSIsInRvcCIsIm1heFdpZHRoIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsImFkZENoaWxkIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJHUVNsaWRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBHUVNsaWRlciBpcyB0aGUgYmFzZSB0eXBlIGZvciBzbGlkZXJzIGluIHRoaXMgc2ltLiBJdCBhZGRzIHRoZSBmb2xsb3dpbmcgZmVhdHVyZXMgdG8gVlNsaWRlcjpcclxuICpcclxuICogLSBzbmFwIHRvIGludGVydmFsIChzZWUgaW50ZXJ2YWwpXHJcbiAqIC0gc25hcCB0byB6ZXJvIChzZWUgc25hcFRvWmVybylcclxuICogLSBza2lwIHplcm8gKHNlZSBza2lwWmVybylcclxuICogLSBjaGFuZ2UgdGhlIHRhcGVyIChzZWUgbWFwIGFuZCBpbnZlcnNlTWFwKVxyXG4gKiAtIGEgbGFiZWwgYWJvdXQgdGhlIHNsaWRlclxyXG4gKlxyXG4gKiBAYXV0aG9yIEFuZHJlYSBMaW5cclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgRHluYW1pY1Byb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRHluYW1pY1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IE51bWJlclByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTnVtYmVyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBEaW1lbnNpb24yIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9EaW1lbnNpb24yLmpzJztcclxuaW1wb3J0IFJhbmdlIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCB7IFJpY2hUZXh0LCBUQ29sb3IsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgVlNsaWRlciwgeyBWU2xpZGVyT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9WU2xpZGVyLmpzJztcclxuaW1wb3J0IGdyYXBoaW5nUXVhZHJhdGljcyBmcm9tICcuLi8uLi9ncmFwaGluZ1F1YWRyYXRpY3MuanMnO1xyXG5pbXBvcnQgR1FDb25zdGFudHMgZnJvbSAnLi4vR1FDb25zdGFudHMuanMnO1xyXG5cclxudHlwZSBUcmFuc2Zvcm1GdW5jdGlvbiA9ICggdmFsdWU6IG51bWJlciApID0+IG51bWJlcjtcclxuXHJcbmNvbnN0IElERU5USVRZX0ZVTkNUSU9OOiBUcmFuc2Zvcm1GdW5jdGlvbiA9IHZhbHVlID0+IHZhbHVlO1xyXG5jb25zdCBERUZBVUxUX1RJQ0tfVkFMVUVTID0gWyAwIF07XHJcbmNvbnN0IERFRkFVTFRfVFJBQ0tfU0laRSA9IG5ldyBEaW1lbnNpb24yKCAxLCAxMzAgKTtcclxuY29uc3QgREVGQVVMVF9USFVNQl9TSVpFID0gbmV3IERpbWVuc2lvbjIoIDQwLCAyMCApO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gbWFwcyBmcm9tIG1vZGVsIHRvIHZpZXcgKGNvZWZmaWNpZW50UHJvcGVydHkgdG8gc2xpZGVyUHJvcGVydHkpXHJcbiAgbWFwPzogVHJhbnNmb3JtRnVuY3Rpb247XHJcblxyXG4gIC8vIG1hcHMgZnJvbSB2aWV3IHRvIG1vZGVsIChzbGlkZXJQcm9wZXJ0eSB0byBjb2VmZmljaWVudFByb3BlcnR5KVxyXG4gIGludmVyc2VNYXA/OiBUcmFuc2Zvcm1GdW5jdGlvbjtcclxuXHJcbiAgLy8gY29lZmZpY2llbnRQcm9wZXJ0eS52YWx1ZSB3aWxsIGJlIHNldCB0byBhIG11bHRpcGxlIG9mIHRoaXMgdmFsdWUsIGluIG1vZGVsIGNvb3JkaW5hdGVzXHJcbiAgaW50ZXJ2YWw/OiBudW1iZXI7XHJcblxyXG4gIC8vIHdoZXRoZXIgdG8gc2tpcCB6ZXJvIHZhbHVlXHJcbiAgc2tpcFplcm8/OiBib29sZWFuO1xyXG5cclxuICAvLyB3aGV0aGVyIHRvIHNuYXAgdG8gemVybyB3aGVuIHRoZSBkcmFnIGVuZHNcclxuICBzbmFwVG9aZXJvPzogYm9vbGVhbjtcclxuXHJcbiAgLy8gU25hcCB0byB6ZXJvIHdoZW4gdGhpcyBjbG9zZSB0byB6ZXJvLiBJZ25vcmVkIGlmIHNuYXBUb1plcm86ZmFsc2UuXHJcbiAgLy8gTXVzdCBiZSA+PSBvcHRpb25zLmludGVydmFsLCBhbmQgZGVmYXVsdHMgdG8gb3B0aW9ucy5pbnRlcnZhbFxyXG4gIHNuYXBUb1plcm9FcHNpbG9uPzogbnVtYmVyO1xyXG5cclxuICAvLyBtb2RlbCB2YWx1ZXMgd2hlcmUgbWFqb3IgdGljayBtYXJrcyB3aWxsIGJlIHBsYWNlZFxyXG4gIHRpY2tWYWx1ZXM/OiBudW1iZXJbXSB8IG51bGw7XHJcblxyXG4gIC8vIGNvbG9yIG9mIHRoZSBsYWJlbCB0aGF0IGFwcGVhcnMgYWJvdmUgdGhlIHNsaWRlclxyXG4gIGxhYmVsQ29sb3I/OiBUQ29sb3I7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBHUVNsaWRlck9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmXHJcbiAgU3RyaWN0T21pdDxWU2xpZGVyT3B0aW9ucywgJ21ham9yVGlja0xlbmd0aCcgfCAnY29uc3RyYWluVmFsdWUnIHwgJ2VuZERyYWcnPiAmXHJcbiAgUGlja1JlcXVpcmVkPFZTbGlkZXJPcHRpb25zLCAndGFuZGVtJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHUVNsaWRlciBleHRlbmRzIFZTbGlkZXIge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gc3ltYm9sIC0gdGhlIGNvZWZmaWNpZW50J3Mgc3ltYm9sXHJcbiAgICogQHBhcmFtIGNvZWZmaWNpZW50UHJvcGVydHkgLSB0aGUgY29lZmZpY2llbnQncyB2YWx1ZVxyXG4gICAqIEBwYXJhbSBbcHJvdmlkZWRPcHRpb25zXVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvciggc3ltYm9sOiBzdHJpbmcsIGNvZWZmaWNpZW50UHJvcGVydHk6IE51bWJlclByb3BlcnR5LCBwcm92aWRlZE9wdGlvbnM6IEdRU2xpZGVyT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPEdRU2xpZGVyT3B0aW9ucywgU3RyaWN0T21pdDxTZWxmT3B0aW9ucywgJ3NuYXBUb1plcm9FcHNpbG9uJz4sIFZTbGlkZXJPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBTZWxmT3B0aW9uc1xyXG4gICAgICBtYXA6IElERU5USVRZX0ZVTkNUSU9OLFxyXG4gICAgICBpbnZlcnNlTWFwOiBJREVOVElUWV9GVU5DVElPTixcclxuICAgICAgaW50ZXJ2YWw6IDEsXHJcbiAgICAgIHNraXBaZXJvOiBmYWxzZSxcclxuICAgICAgc25hcFRvWmVybzogdHJ1ZSxcclxuICAgICAgdGlja1ZhbHVlczogREVGQVVMVF9USUNLX1ZBTFVFUyxcclxuICAgICAgbGFiZWxDb2xvcjogJ2JsYWNrJyxcclxuXHJcbiAgICAgIC8vIFNsaWRlck9wdGlvbnNcclxuICAgICAgdHJhY2tTaXplOiBERUZBVUxUX1RSQUNLX1NJWkUsXHJcbiAgICAgIHRodW1iU2l6ZTogREVGQVVMVF9USFVNQl9TSVpFLFxyXG4gICAgICB0aHVtYlRvdWNoQXJlYVhEaWxhdGlvbjogOCxcclxuXHJcbiAgICAgIC8vIFRoZSBzbGlkZXIgY29udHJvbHMgYW4gaW50ZXJtZWRpYXRlIER5bmFtaWNQcm9wZXJ0eSwgc28gbGluayB0byB0aGUgcmVsZXZhbnQgbW9kZWwgUHJvcGVydHkuXHJcbiAgICAgIHBoZXRpb0xpbmtlZFByb3BlcnR5OiBjb2VmZmljaWVudFByb3BlcnR5XHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zLmludGVydmFsID4gMCwgYGludmFsaWQgaW50ZXJ2YWw6ICR7b3B0aW9ucy5pbnRlcnZhbH1gICk7XHJcblxyXG4gICAgLy8gZGVmYXVsdCBhbmQgdmFsaWRhdGlvbiBmb3Igc25hcFRvWmVyb0Vwc2lsb25cclxuICAgIGxldCBzbmFwVG9aZXJvRXBzaWxvbjogbnVtYmVyO1xyXG4gICAgaWYgKCBvcHRpb25zLnNuYXBUb1plcm8gKSB7XHJcbiAgICAgIGlmICggb3B0aW9ucy5zbmFwVG9aZXJvRXBzaWxvbiA9PT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgIHNuYXBUb1plcm9FcHNpbG9uID0gb3B0aW9ucy5pbnRlcnZhbDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBzbmFwVG9aZXJvRXBzaWxvbiA9IG9wdGlvbnMuc25hcFRvWmVyb0Vwc2lsb247XHJcbiAgICAgIH1cclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggKCBzbmFwVG9aZXJvRXBzaWxvbiA+PSAwICkgJiYgKCBzbmFwVG9aZXJvRXBzaWxvbiA+PSBvcHRpb25zLmludGVydmFsICksXHJcbiAgICAgICAgYGludmFsaWQgc25hcFRvWmVyb0Vwc2lsb246ICR7c25hcFRvWmVyb0Vwc2lsb259YCApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIG1ha2UgdGljayBtYXJrIGxpbmVzIGV4dGVuZCBwYXN0IHRoZSB0aHVtYlxyXG4gICAgY29uc3QgdGh1bWJTaXplID0gb3B0aW9ucy50aHVtYlNpemUhO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGh1bWJTaXplICk7XHJcbiAgICBvcHRpb25zLm1ham9yVGlja0xlbmd0aCA9ICggdGh1bWJTaXplLndpZHRoIC8gMiApICsgMztcclxuXHJcbiAgICAvLyBhcHBseSBjb25zdHJhaW5zIHRvIHRoZSB2aWV3IHZhbHVlXHJcbiAgICBvcHRpb25zLmNvbnN0cmFpblZhbHVlID0gdmlld1ZhbHVlID0+IHtcclxuXHJcbiAgICAgIGlmICggb3B0aW9ucy5za2lwWmVybyApIHtcclxuXHJcbiAgICAgICAgLy8gbWFwIGZyb20gdmlldyB0byBtb2RlbFxyXG4gICAgICAgIGNvbnN0IG5ld01vZGVsVmFsdWUgPSBvcHRpb25zLmludmVyc2VNYXAoIHZpZXdWYWx1ZSApO1xyXG5cclxuICAgICAgICAvLyBza2lwIHplcm9cclxuICAgICAgICBpZiAoIE1hdGguYWJzKCBuZXdNb2RlbFZhbHVlICkgPCBvcHRpb25zLmludGVydmFsICkge1xyXG4gICAgICAgICAgcmV0dXJuIG9wdGlvbnMubWFwKCAoIG5ld01vZGVsVmFsdWUgPiAwICkgPyBvcHRpb25zLmludGVydmFsIDogLW9wdGlvbnMuaW50ZXJ2YWwgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIG5vIGNvbnN0cmFpbnQgYXBwbGllZFxyXG4gICAgICByZXR1cm4gdmlld1ZhbHVlO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBzbmFwIHRvIHplcm8gd2hlbiB0aGUgZHJhZyBlbmRzXHJcbiAgICBpZiAoICFvcHRpb25zLnNraXBaZXJvICYmIG9wdGlvbnMuc25hcFRvWmVybyApIHtcclxuICAgICAgb3B0aW9ucy5lbmREcmFnID0gKCkgPT4ge1xyXG4gICAgICAgIGlmICggKCBNYXRoLmFicyggY29lZmZpY2llbnRQcm9wZXJ0eS52YWx1ZSApIDwgc25hcFRvWmVyb0Vwc2lsb24gKSApIHtcclxuICAgICAgICAgIGNvZWZmaWNpZW50UHJvcGVydHkudmFsdWUgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBNYXAgYmV0d2VlbiBtb2RlbCBhbmQgdmlldyBkb21haW5zLCBkZXRlcm1pbmVzIGhvdyB0aGUgc2xpZGVyIHJlc3BvbmRzLlxyXG4gICAgLy8gRG8gbm90IGluc3RydW1lbnQgZm9yIFBoRVQtaU8sIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcGhldC1pby9pc3N1ZXMvMTM3NFxyXG4gICAgY29uc3Qgc2xpZGVyUHJvcGVydHkgPSBuZXcgRHluYW1pY1Byb3BlcnR5KCBuZXcgUHJvcGVydHkoIGNvZWZmaWNpZW50UHJvcGVydHkgKSwge1xyXG5cclxuICAgICAgYmlkaXJlY3Rpb25hbDogdHJ1ZSxcclxuXHJcbiAgICAgIC8vIG1hcCBmcm9tIG1vZGVsIHRvIHZpZXcgKGNvZWZmaWNpZW50UHJvcGVydHkgdG8gc2xpZGVyUHJvcGVydHkpXHJcbiAgICAgIG1hcDogKCB2YWx1ZTogbnVtYmVyICkgPT4gb3B0aW9ucy5tYXAoIHZhbHVlICksXHJcblxyXG4gICAgICAvLyBtYXAgZnJvbSB2aWV3IHRvIG1vZGVsIChzbGlkZXJQcm9wZXJ0eSB0byBjb2VmZmljaWVudFByb3BlcnR5KSwgYXBwbHkgb3B0aW9ucy5pbnRlcnZhbCB0byBtb2RlbCB2YWx1ZVxyXG4gICAgICBpbnZlcnNlTWFwOiAoIHZhbHVlOiBudW1iZXIgKSA9PiBVdGlscy5yb3VuZFRvSW50ZXJ2YWwoIG9wdGlvbnMuaW52ZXJzZU1hcCggdmFsdWUgKSwgb3B0aW9ucy5pbnRlcnZhbCApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQ29udmVydCB0aGUgcmFuZ2UgZnJvbSBtb2RlbCB0byB2aWV3XHJcbiAgICBjb25zdCBzbGlkZXJSYW5nZSA9IG5ldyBSYW5nZShcclxuICAgICAgb3B0aW9ucy5tYXAoIGNvZWZmaWNpZW50UHJvcGVydHkucmFuZ2UubWluICksXHJcbiAgICAgIG9wdGlvbnMubWFwKCBjb2VmZmljaWVudFByb3BlcnR5LnJhbmdlLm1heCApXHJcbiAgICApO1xyXG5cclxuICAgIHN1cGVyKCBzbGlkZXJQcm9wZXJ0eSwgc2xpZGVyUmFuZ2UsIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIHRpY2sgbGFiZWxzXHJcbiAgICBpZiAoIG9wdGlvbnMudGlja1ZhbHVlcyApIHtcclxuICAgICAgb3B0aW9ucy50aWNrVmFsdWVzLmZvckVhY2goIHRpY2tWYWx1ZSA9PiB7XHJcbiAgICAgICAgdGhpcy5hZGRNYWpvclRpY2soIG9wdGlvbnMubWFwKCB0aWNrVmFsdWUgKSwgbmV3IFRleHQoIHRpY2tWYWx1ZSwge1xyXG4gICAgICAgICAgZm9udDogR1FDb25zdGFudHMuU0xJREVSX1RJQ0tfTEFCRUxfRk9OVFxyXG4gICAgICAgIH0gKSApO1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTGFiZWwgdGhhdCBhcHBlYXJzIGFib3ZlIHRoZSBzbGlkZXIuXHJcbiAgICBjb25zdCBsYWJlbCA9IG5ldyBSaWNoVGV4dCggc3ltYm9sLCB7XHJcbiAgICAgIGZvbnQ6IEdRQ29uc3RhbnRzLlNMSURFUl9MQUJFTF9GT05ULFxyXG4gICAgICBmaWxsOiBvcHRpb25zLmxhYmVsQ29sb3IsXHJcbiAgICAgIGNlbnRlclg6IHRoaXMueCxcclxuICAgICAgYm90dG9tOiB0aGlzLnRvcCAtIDIsXHJcbiAgICAgIG1heFdpZHRoOiAyMCwgLy8gZGV0ZXJtaW5lZCBlbXBpcmljYWxseVxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xhYmVsVGV4dCcgKSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ3RoZSBsYWJlbCBhYm92ZSB0aGlzIHNsaWRlcidcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGxhYmVsICk7XHJcbiAgfVxyXG59XHJcblxyXG5ncmFwaGluZ1F1YWRyYXRpY3MucmVnaXN0ZXIoICdHUVNsaWRlcicsIEdRU2xpZGVyICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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