// Copyright 2014-2023, University of Colorado Boulder

/**
 * GQGraphNode is the base class for displaying the graph.
 *
 * @author Andrea Lin
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Property from '../../../../axon/js/Property.js';
import GraphNode from '../../../../graphing-lines/js/common/view/GraphNode.js';
import { Shape } from '../../../../kite/js/imports.js';
import optionize from '../../../../phet-core/js/optionize.js';
import { Node } from '../../../../scenery/js/imports.js';
import graphingQuadratics from '../../graphingQuadratics.js';
import GQConstants from '../GQConstants.js';
import QuadraticNode from './QuadraticNode.js';
export default class GQGraphNode extends Node {
  constructor(model, viewProperties, providedOptions) {
    const options = optionize()({
      // SelfOptions
      preventVertexAndEquationOverlap: true,
      otherCurves: [],
      decorations: []
    }, providedOptions);
    assert && assert(!options.tandem, 'GQGraphNode should not be instrumented');
    super(options);

    // Cartesian coordinates graph
    const graphNode = new GraphNode(model.graph, model.modelViewTransform);

    // Interactive quadratic curve
    const interactiveQuadraticNode = new QuadraticNode(model.quadraticProperty, model.graph.xRange, model.graph.yRange, model.modelViewTransform, viewProperties.equationForm, viewProperties.equationsVisibleProperty, {
      lineWidth: GQConstants.INTERACTIVE_QUADRATIC_LINE_WIDTH,
      preventVertexAndEquationOverlap: options.preventVertexAndEquationOverlap
    });

    // the saved line
    let savedQuadraticNode = null;

    // Parent for other lines, e.g. quadratic terms, directrix, axis of symmetry
    const otherCurvesLayer = new Node({
      children: options.otherCurves
    });

    // Parent for decorations, e.g. vertex, roots, manipulators
    const decorationsLayer = new Node({
      children: options.decorations
    });

    // All lines, clipped to the graph
    const allLinesParent = new Node({
      clipArea: Shape.rectangle(model.graph.xRange.min, model.graph.yRange.min, model.graph.xRange.getLength(), model.graph.yRange.getLength()).transformed(model.modelViewTransform.getMatrix()),
      children: [otherCurvesLayer, interactiveQuadraticNode]
    });

    // Everything that's on the graph
    const contentParent = new Node({
      children: [allLinesParent, decorationsLayer]
    });

    // rendering order
    this.addChild(graphNode);
    this.addChild(contentParent);

    // When the saved quadratic changes...
    model.savedQuadraticProperty.link(savedQuadratic => {
      // Remove and dispose of any previously-saved quadratic.
      if (savedQuadraticNode) {
        allLinesParent.removeChild(savedQuadraticNode);
        savedQuadraticNode.dispose();
        savedQuadraticNode = null;
      }
      if (savedQuadratic) {
        savedQuadraticNode = new QuadraticNode(new Property(savedQuadratic), model.graph.xRange, model.graph.yRange, model.modelViewTransform, viewProperties.equationForm, viewProperties.equationsVisibleProperty, {
          lineWidth: GQConstants.SAVED_QUADRATIC_LINE_WIDTH,
          preventVertexAndEquationOverlap: options.preventVertexAndEquationOverlap
        });

        // Add savedQuadraticNode to the foreground, so the user can see it.
        // See https://github.com/phetsims/graphing-quadratics/issues/36
        allLinesParent.addChild(savedQuadraticNode);

        // When restoring state, if savedQuadratic is identical to quadraticProperty, then leave it in front, so
        // the user can see it. Otherwise, move it to the back. Note that this does not address the corner case where
        // the instructional designer has changed quadraticProperty, then changed it back to match savedQuadratic.
        // We decided not to address that case, see https://github.com/phetsims/graphing-quadratics/issues/165.
        if (phet.joist.sim.isSettingPhetioStateProperty.value && !savedQuadratic.hasSameCoefficients(model.quadraticProperty.value)) {
          savedQuadraticNode.moveToBack();
        }
      }
    });

    // When a quadratic is saved, it is initially in front of quadraticProperty. Otherwise it wouldn't be visible
    // because they are identical. When quadraticProperty is changed BY THE USER, move the saved quadratic to the back.
    // If it's changed by restoring PhET-iO state, do nothing, because savedQuadraticProperty listener above will
    // handle it. See https://github.com/phetsims/graphing-quadratics/issues/36 and
    // https://github.com/phetsims/graphing-quadratics/issues/165.
    model.quadraticProperty.link(quadratic => {
      if (!phet.joist.sim.isSettingPhetioStateProperty.value) {
        savedQuadraticNode && savedQuadraticNode.moveToBack();
      }
    });

    // Show/hide the graph contents
    viewProperties.graphContentsVisibleProperty.link(visible => {
      contentParent.visible = visible;
      if (!visible) {
        decorationsLayer.interruptSubtreeInput(); // cancel interaction with graph contents
      }
    });
  }
}

graphingQuadratics.register('GQGraphNode', GQGraphNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIkdyYXBoTm9kZSIsIlNoYXBlIiwib3B0aW9uaXplIiwiTm9kZSIsImdyYXBoaW5nUXVhZHJhdGljcyIsIkdRQ29uc3RhbnRzIiwiUXVhZHJhdGljTm9kZSIsIkdRR3JhcGhOb2RlIiwiY29uc3RydWN0b3IiLCJtb2RlbCIsInZpZXdQcm9wZXJ0aWVzIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsInByZXZlbnRWZXJ0ZXhBbmRFcXVhdGlvbk92ZXJsYXAiLCJvdGhlckN1cnZlcyIsImRlY29yYXRpb25zIiwiYXNzZXJ0IiwidGFuZGVtIiwiZ3JhcGhOb2RlIiwiZ3JhcGgiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJpbnRlcmFjdGl2ZVF1YWRyYXRpY05vZGUiLCJxdWFkcmF0aWNQcm9wZXJ0eSIsInhSYW5nZSIsInlSYW5nZSIsImVxdWF0aW9uRm9ybSIsImVxdWF0aW9uc1Zpc2libGVQcm9wZXJ0eSIsImxpbmVXaWR0aCIsIklOVEVSQUNUSVZFX1FVQURSQVRJQ19MSU5FX1dJRFRIIiwic2F2ZWRRdWFkcmF0aWNOb2RlIiwib3RoZXJDdXJ2ZXNMYXllciIsImNoaWxkcmVuIiwiZGVjb3JhdGlvbnNMYXllciIsImFsbExpbmVzUGFyZW50IiwiY2xpcEFyZWEiLCJyZWN0YW5nbGUiLCJtaW4iLCJnZXRMZW5ndGgiLCJ0cmFuc2Zvcm1lZCIsImdldE1hdHJpeCIsImNvbnRlbnRQYXJlbnQiLCJhZGRDaGlsZCIsInNhdmVkUXVhZHJhdGljUHJvcGVydHkiLCJsaW5rIiwic2F2ZWRRdWFkcmF0aWMiLCJyZW1vdmVDaGlsZCIsImRpc3Bvc2UiLCJTQVZFRF9RVUFEUkFUSUNfTElORV9XSURUSCIsInBoZXQiLCJqb2lzdCIsInNpbSIsImlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkiLCJ2YWx1ZSIsImhhc1NhbWVDb2VmZmljaWVudHMiLCJtb3ZlVG9CYWNrIiwicXVhZHJhdGljIiwiZ3JhcGhDb250ZW50c1Zpc2libGVQcm9wZXJ0eSIsInZpc2libGUiLCJpbnRlcnJ1cHRTdWJ0cmVlSW5wdXQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkdRR3JhcGhOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEdRR3JhcGhOb2RlIGlzIHRoZSBiYXNlIGNsYXNzIGZvciBkaXNwbGF5aW5nIHRoZSBncmFwaC5cclxuICpcclxuICogQGF1dGhvciBBbmRyZWEgTGluXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgR3JhcGhOb2RlIGZyb20gJy4uLy4uLy4uLy4uL2dyYXBoaW5nLWxpbmVzL2pzL2NvbW1vbi92aWV3L0dyYXBoTm9kZS5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IHsgTm9kZSwgTm9kZU9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZ3JhcGhpbmdRdWFkcmF0aWNzIGZyb20gJy4uLy4uL2dyYXBoaW5nUXVhZHJhdGljcy5qcyc7XHJcbmltcG9ydCBHUUNvbnN0YW50cyBmcm9tICcuLi9HUUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBHUU1vZGVsIGZyb20gJy4uL21vZGVsL0dRTW9kZWwuanMnO1xyXG5pbXBvcnQgR1FWaWV3UHJvcGVydGllcyBmcm9tICcuL0dRVmlld1Byb3BlcnRpZXMuanMnO1xyXG5pbXBvcnQgUXVhZHJhdGljTm9kZSBmcm9tICcuL1F1YWRyYXRpY05vZGUuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gcHJldmVudCBhIHBhcmFib2xhJ3MgdmVydGV4IGFuZCBlcXVhdGlvbiBmcm9tIG92ZXJsYXBwaW5nXHJcbiAgcHJldmVudFZlcnRleEFuZEVxdWF0aW9uT3ZlcmxhcD86IGJvb2xlYW47XHJcblxyXG4gIC8vIG90aGVyIGN1cnZlcyB0byBiZSBkaXNwbGF5ZWQgKHRlcm1zLCBkaXJlY3RyaXgsIGF4aXMgb2Ygc3ltbWV0cnkpIHJlbmRlcmVkIGluIHRoZSBvcmRlciBwcm92aWRlZFxyXG4gIG90aGVyQ3VydmVzPzogTm9kZVtdO1xyXG5cclxuICAvLyBkZWNvcmF0aW9ucyAobWFuaXB1bGF0b3JzLCByb290cywuLi4pIHJlbmRlcmVkIGluIHRoZSBvcmRlciBwcm92aWRlZFxyXG4gIGRlY29yYXRpb25zPzogTm9kZVtdO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgR1FHcmFwaE5vZGVPcHRpb25zID0gU2VsZk9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHUUdyYXBoTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoIG1vZGVsOiBHUU1vZGVsLCB2aWV3UHJvcGVydGllczogR1FWaWV3UHJvcGVydGllcywgcHJvdmlkZWRPcHRpb25zPzogR1FHcmFwaE5vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8R1FHcmFwaE5vZGVPcHRpb25zLCBTZWxmT3B0aW9ucywgTm9kZU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNlbGZPcHRpb25zXHJcbiAgICAgIHByZXZlbnRWZXJ0ZXhBbmRFcXVhdGlvbk92ZXJsYXA6IHRydWUsXHJcbiAgICAgIG90aGVyQ3VydmVzOiBbXSxcclxuICAgICAgZGVjb3JhdGlvbnM6IFtdXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhb3B0aW9ucy50YW5kZW0sICdHUUdyYXBoTm9kZSBzaG91bGQgbm90IGJlIGluc3RydW1lbnRlZCcgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIENhcnRlc2lhbiBjb29yZGluYXRlcyBncmFwaFxyXG4gICAgY29uc3QgZ3JhcGhOb2RlID0gbmV3IEdyYXBoTm9kZSggbW9kZWwuZ3JhcGgsIG1vZGVsLm1vZGVsVmlld1RyYW5zZm9ybSApO1xyXG5cclxuICAgIC8vIEludGVyYWN0aXZlIHF1YWRyYXRpYyBjdXJ2ZVxyXG4gICAgY29uc3QgaW50ZXJhY3RpdmVRdWFkcmF0aWNOb2RlID0gbmV3IFF1YWRyYXRpY05vZGUoXHJcbiAgICAgIG1vZGVsLnF1YWRyYXRpY1Byb3BlcnR5LFxyXG4gICAgICBtb2RlbC5ncmFwaC54UmFuZ2UsXHJcbiAgICAgIG1vZGVsLmdyYXBoLnlSYW5nZSxcclxuICAgICAgbW9kZWwubW9kZWxWaWV3VHJhbnNmb3JtLFxyXG4gICAgICB2aWV3UHJvcGVydGllcy5lcXVhdGlvbkZvcm0sXHJcbiAgICAgIHZpZXdQcm9wZXJ0aWVzLmVxdWF0aW9uc1Zpc2libGVQcm9wZXJ0eSwge1xyXG4gICAgICAgIGxpbmVXaWR0aDogR1FDb25zdGFudHMuSU5URVJBQ1RJVkVfUVVBRFJBVElDX0xJTkVfV0lEVEgsXHJcbiAgICAgICAgcHJldmVudFZlcnRleEFuZEVxdWF0aW9uT3ZlcmxhcDogb3B0aW9ucy5wcmV2ZW50VmVydGV4QW5kRXF1YXRpb25PdmVybGFwXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyB0aGUgc2F2ZWQgbGluZVxyXG4gICAgbGV0IHNhdmVkUXVhZHJhdGljTm9kZTogUXVhZHJhdGljTm9kZSB8IG51bGwgPSBudWxsO1xyXG5cclxuICAgIC8vIFBhcmVudCBmb3Igb3RoZXIgbGluZXMsIGUuZy4gcXVhZHJhdGljIHRlcm1zLCBkaXJlY3RyaXgsIGF4aXMgb2Ygc3ltbWV0cnlcclxuICAgIGNvbnN0IG90aGVyQ3VydmVzTGF5ZXIgPSBuZXcgTm9kZSggeyBjaGlsZHJlbjogb3B0aW9ucy5vdGhlckN1cnZlcyB9ICk7XHJcblxyXG4gICAgLy8gUGFyZW50IGZvciBkZWNvcmF0aW9ucywgZS5nLiB2ZXJ0ZXgsIHJvb3RzLCBtYW5pcHVsYXRvcnNcclxuICAgIGNvbnN0IGRlY29yYXRpb25zTGF5ZXIgPSBuZXcgTm9kZSggeyBjaGlsZHJlbjogb3B0aW9ucy5kZWNvcmF0aW9ucyB9ICk7XHJcblxyXG4gICAgLy8gQWxsIGxpbmVzLCBjbGlwcGVkIHRvIHRoZSBncmFwaFxyXG4gICAgY29uc3QgYWxsTGluZXNQYXJlbnQgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjbGlwQXJlYTogU2hhcGUucmVjdGFuZ2xlKFxyXG4gICAgICAgIG1vZGVsLmdyYXBoLnhSYW5nZS5taW4sXHJcbiAgICAgICAgbW9kZWwuZ3JhcGgueVJhbmdlLm1pbixcclxuICAgICAgICBtb2RlbC5ncmFwaC54UmFuZ2UuZ2V0TGVuZ3RoKCksXHJcbiAgICAgICAgbW9kZWwuZ3JhcGgueVJhbmdlLmdldExlbmd0aCgpXHJcbiAgICAgICkudHJhbnNmb3JtZWQoIG1vZGVsLm1vZGVsVmlld1RyYW5zZm9ybS5nZXRNYXRyaXgoKSApLFxyXG4gICAgICBjaGlsZHJlbjogWyBvdGhlckN1cnZlc0xheWVyLCBpbnRlcmFjdGl2ZVF1YWRyYXRpY05vZGUgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEV2ZXJ5dGhpbmcgdGhhdCdzIG9uIHRoZSBncmFwaFxyXG4gICAgY29uc3QgY29udGVudFBhcmVudCA9IG5ldyBOb2RlKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbIGFsbExpbmVzUGFyZW50LCBkZWNvcmF0aW9uc0xheWVyIF1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyByZW5kZXJpbmcgb3JkZXJcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGdyYXBoTm9kZSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggY29udGVudFBhcmVudCApO1xyXG5cclxuICAgIC8vIFdoZW4gdGhlIHNhdmVkIHF1YWRyYXRpYyBjaGFuZ2VzLi4uXHJcbiAgICBtb2RlbC5zYXZlZFF1YWRyYXRpY1Byb3BlcnR5LmxpbmsoIHNhdmVkUXVhZHJhdGljID0+IHtcclxuXHJcbiAgICAgIC8vIFJlbW92ZSBhbmQgZGlzcG9zZSBvZiBhbnkgcHJldmlvdXNseS1zYXZlZCBxdWFkcmF0aWMuXHJcbiAgICAgIGlmICggc2F2ZWRRdWFkcmF0aWNOb2RlICkge1xyXG4gICAgICAgIGFsbExpbmVzUGFyZW50LnJlbW92ZUNoaWxkKCBzYXZlZFF1YWRyYXRpY05vZGUgKTtcclxuICAgICAgICBzYXZlZFF1YWRyYXRpY05vZGUuZGlzcG9zZSgpO1xyXG4gICAgICAgIHNhdmVkUXVhZHJhdGljTm9kZSA9IG51bGw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICggc2F2ZWRRdWFkcmF0aWMgKSB7XHJcbiAgICAgICAgc2F2ZWRRdWFkcmF0aWNOb2RlID0gbmV3IFF1YWRyYXRpY05vZGUoXHJcbiAgICAgICAgICBuZXcgUHJvcGVydHkoIHNhdmVkUXVhZHJhdGljICksXHJcbiAgICAgICAgICBtb2RlbC5ncmFwaC54UmFuZ2UsXHJcbiAgICAgICAgICBtb2RlbC5ncmFwaC55UmFuZ2UsXHJcbiAgICAgICAgICBtb2RlbC5tb2RlbFZpZXdUcmFuc2Zvcm0sXHJcbiAgICAgICAgICB2aWV3UHJvcGVydGllcy5lcXVhdGlvbkZvcm0sXHJcbiAgICAgICAgICB2aWV3UHJvcGVydGllcy5lcXVhdGlvbnNWaXNpYmxlUHJvcGVydHksIHtcclxuICAgICAgICAgICAgbGluZVdpZHRoOiBHUUNvbnN0YW50cy5TQVZFRF9RVUFEUkFUSUNfTElORV9XSURUSCxcclxuICAgICAgICAgICAgcHJldmVudFZlcnRleEFuZEVxdWF0aW9uT3ZlcmxhcDogb3B0aW9ucy5wcmV2ZW50VmVydGV4QW5kRXF1YXRpb25PdmVybGFwXHJcbiAgICAgICAgICB9ICk7XHJcblxyXG4gICAgICAgIC8vIEFkZCBzYXZlZFF1YWRyYXRpY05vZGUgdG8gdGhlIGZvcmVncm91bmQsIHNvIHRoZSB1c2VyIGNhbiBzZWUgaXQuXHJcbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmFwaGluZy1xdWFkcmF0aWNzL2lzc3Vlcy8zNlxyXG4gICAgICAgIGFsbExpbmVzUGFyZW50LmFkZENoaWxkKCBzYXZlZFF1YWRyYXRpY05vZGUgKTtcclxuXHJcbiAgICAgICAgLy8gV2hlbiByZXN0b3Jpbmcgc3RhdGUsIGlmIHNhdmVkUXVhZHJhdGljIGlzIGlkZW50aWNhbCB0byBxdWFkcmF0aWNQcm9wZXJ0eSwgdGhlbiBsZWF2ZSBpdCBpbiBmcm9udCwgc29cclxuICAgICAgICAvLyB0aGUgdXNlciBjYW4gc2VlIGl0LiBPdGhlcndpc2UsIG1vdmUgaXQgdG8gdGhlIGJhY2suIE5vdGUgdGhhdCB0aGlzIGRvZXMgbm90IGFkZHJlc3MgdGhlIGNvcm5lciBjYXNlIHdoZXJlXHJcbiAgICAgICAgLy8gdGhlIGluc3RydWN0aW9uYWwgZGVzaWduZXIgaGFzIGNoYW5nZWQgcXVhZHJhdGljUHJvcGVydHksIHRoZW4gY2hhbmdlZCBpdCBiYWNrIHRvIG1hdGNoIHNhdmVkUXVhZHJhdGljLlxyXG4gICAgICAgIC8vIFdlIGRlY2lkZWQgbm90IHRvIGFkZHJlc3MgdGhhdCBjYXNlLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2dyYXBoaW5nLXF1YWRyYXRpY3MvaXNzdWVzLzE2NS5cclxuICAgICAgICBpZiAoIHBoZXQuam9pc3Quc2ltLmlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkudmFsdWUgJiYgIXNhdmVkUXVhZHJhdGljLmhhc1NhbWVDb2VmZmljaWVudHMoIG1vZGVsLnF1YWRyYXRpY1Byb3BlcnR5LnZhbHVlICkgKSB7XHJcbiAgICAgICAgICBzYXZlZFF1YWRyYXRpY05vZGUubW92ZVRvQmFjaygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFdoZW4gYSBxdWFkcmF0aWMgaXMgc2F2ZWQsIGl0IGlzIGluaXRpYWxseSBpbiBmcm9udCBvZiBxdWFkcmF0aWNQcm9wZXJ0eS4gT3RoZXJ3aXNlIGl0IHdvdWxkbid0IGJlIHZpc2libGVcclxuICAgIC8vIGJlY2F1c2UgdGhleSBhcmUgaWRlbnRpY2FsLiBXaGVuIHF1YWRyYXRpY1Byb3BlcnR5IGlzIGNoYW5nZWQgQlkgVEhFIFVTRVIsIG1vdmUgdGhlIHNhdmVkIHF1YWRyYXRpYyB0byB0aGUgYmFjay5cclxuICAgIC8vIElmIGl0J3MgY2hhbmdlZCBieSByZXN0b3JpbmcgUGhFVC1pTyBzdGF0ZSwgZG8gbm90aGluZywgYmVjYXVzZSBzYXZlZFF1YWRyYXRpY1Byb3BlcnR5IGxpc3RlbmVyIGFib3ZlIHdpbGxcclxuICAgIC8vIGhhbmRsZSBpdC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmFwaGluZy1xdWFkcmF0aWNzL2lzc3Vlcy8zNiBhbmRcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmFwaGluZy1xdWFkcmF0aWNzL2lzc3Vlcy8xNjUuXHJcbiAgICBtb2RlbC5xdWFkcmF0aWNQcm9wZXJ0eS5saW5rKCBxdWFkcmF0aWMgPT4ge1xyXG4gICAgICBpZiAoICFwaGV0LmpvaXN0LnNpbS5pc1NldHRpbmdQaGV0aW9TdGF0ZVByb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICAgIHNhdmVkUXVhZHJhdGljTm9kZSAmJiBzYXZlZFF1YWRyYXRpY05vZGUubW92ZVRvQmFjaygpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gU2hvdy9oaWRlIHRoZSBncmFwaCBjb250ZW50c1xyXG4gICAgdmlld1Byb3BlcnRpZXMuZ3JhcGhDb250ZW50c1Zpc2libGVQcm9wZXJ0eS5saW5rKCB2aXNpYmxlID0+IHtcclxuICAgICAgY29udGVudFBhcmVudC52aXNpYmxlID0gdmlzaWJsZTtcclxuICAgICAgaWYgKCAhdmlzaWJsZSApIHtcclxuICAgICAgICBkZWNvcmF0aW9uc0xheWVyLmludGVycnVwdFN1YnRyZWVJbnB1dCgpOyAvLyBjYW5jZWwgaW50ZXJhY3Rpb24gd2l0aCBncmFwaCBjb250ZW50c1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5ncmFwaGluZ1F1YWRyYXRpY3MucmVnaXN0ZXIoICdHUUdyYXBoTm9kZScsIEdRR3JhcGhOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxTQUFTLE1BQU0sd0RBQXdEO0FBQzlFLFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDdEQsT0FBT0MsU0FBUyxNQUFNLHVDQUF1QztBQUM3RCxTQUFTQyxJQUFJLFFBQXFCLG1DQUFtQztBQUNyRSxPQUFPQyxrQkFBa0IsTUFBTSw2QkFBNkI7QUFDNUQsT0FBT0MsV0FBVyxNQUFNLG1CQUFtQjtBQUczQyxPQUFPQyxhQUFhLE1BQU0sb0JBQW9CO0FBZ0I5QyxlQUFlLE1BQU1DLFdBQVcsU0FBU0osSUFBSSxDQUFDO0VBRWxDSyxXQUFXQSxDQUFFQyxLQUFjLEVBQUVDLGNBQWdDLEVBQUVDLGVBQW9DLEVBQUc7SUFFOUcsTUFBTUMsT0FBTyxHQUFHVixTQUFTLENBQStDLENBQUMsQ0FBRTtNQUV6RTtNQUNBVywrQkFBK0IsRUFBRSxJQUFJO01BQ3JDQyxXQUFXLEVBQUUsRUFBRTtNQUNmQyxXQUFXLEVBQUU7SUFDZixDQUFDLEVBQUVKLGVBQWdCLENBQUM7SUFFcEJLLE1BQU0sSUFBSUEsTUFBTSxDQUFFLENBQUNKLE9BQU8sQ0FBQ0ssTUFBTSxFQUFFLHdDQUF5QyxDQUFDO0lBRTdFLEtBQUssQ0FBRUwsT0FBUSxDQUFDOztJQUVoQjtJQUNBLE1BQU1NLFNBQVMsR0FBRyxJQUFJbEIsU0FBUyxDQUFFUyxLQUFLLENBQUNVLEtBQUssRUFBRVYsS0FBSyxDQUFDVyxrQkFBbUIsQ0FBQzs7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