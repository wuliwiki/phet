// Copyright 2014-2020, University of Colorado Boulder

/**
 * Common ScreenView (base type) for Plinko Probability
 *
 * @author Martin Veillette (Berea College)
 * @author Guillermo Ramos (Berea College)
 * @author Denzell Barnett (Berea College)
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Bounds2 from '../../../../dot/js/Bounds2.js';
import ScreenView from '../../../../joist/js/ScreenView.js';
import merge from '../../../../phet-core/js/merge.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import EraserButton from '../../../../scenery-phet/js/buttons/EraserButton.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import SoundToggleButton from '../../../../scenery-phet/js/buttons/SoundToggleButton.js';
import plinkoProbability from '../../plinkoProbability.js';
import PlinkoProbabilityConstants from '../PlinkoProbabilityConstants.js';
import BallsNode from './BallsNode.js';
import Board from './Board.js';
import HistogramNode from './HistogramNode.js';
import Hopper from './Hopper.js';
import PegSoundGeneration from './PegSoundGeneration.js';
import PlinkoProbabilityViewProperties from './PlinkoProbabilityViewProperties.js';
class PlinkoProbabilityCommonView extends ScreenView {
  /**
   * @param {PlinkoProbabilityCommonModel} model
   * @param {Object} [options]
   */
  constructor(model, options) {
    options = merge({
      histogramMode: 'cylinder' // {string} see HISTOGRAM_MODE_VALUES
    }, options);
    super(options);

    // view-specific Properties
    const viewProperties = new PlinkoProbabilityViewProperties({
      histogramMode: options.histogramMode
    });
    this.viewProperties = viewProperties; // @protected

    const hopper = new Hopper(model.numberOfRowsProperty, {
      centerX: this.layoutBounds.maxX / 2 - 80,
      top: 10
    });
    const board = new Board({
      x: hopper.centerX,
      top: hopper.bottom + 10
    });

    // create the model view transform based on the triangular board of the galton board (excluding the dropped shadow)
    const viewTriangularBoardBounds = new Bounds2(board.left, board.top, board.left + board.size.width, board.top + board.size.height);
    const modelTriangularBoardBounds = model.galtonBoard.bounds;
    const modelViewTransform = ModelViewTransform2.createRectangleInvertedYMapping(modelTriangularBoardBounds, viewTriangularBoardBounds);

    // @protected
    this.viewTriangularBoardBounds = viewTriangularBoardBounds;
    this.modelViewTransform = modelViewTransform;
    const histogramModelBounds = PlinkoProbabilityConstants.HISTOGRAM_BOUNDS;
    const ballModelBounds = model.galtonBoard.bounds.union(histogramModelBounds);
    const ballViewBounds = this.modelViewTransform.modelToViewBounds(ballModelBounds).dilated(20);

    // renders all the balls
    const ballsNode = new BallsNode(model.balls, model.numberOfRowsProperty, viewProperties.histogramModeProperty, modelViewTransform, {
      canvasBounds: ballViewBounds
    });
    const histogramNode = new HistogramNode(viewProperties.histogramModeProperty, model, modelViewTransform, viewProperties.isTheoreticalHistogramVisibleProperty);
    this.histogramNode = histogramNode;
    const eraserButton = new EraserButton({
      iconWidth: 22,
      scale: 1.4,
      listener: () => {
        model.erase();
      },
      bottom: this.layoutBounds.maxY - 55,
      left: 40
    });

    // @protected sound generator for ball hitting peg
    this.pegSoundGeneration = new PegSoundGeneration(viewProperties.isSoundEnabledProperty);

    // Reset All Button at bottom right
    const resetAllButton = new ResetAllButton({
      listener: () => {
        model.reset();
        this.reset();
      },
      right: this.layoutBounds.maxX - PlinkoProbabilityConstants.PANEL_RIGHT_PADDING,
      bottom: this.layoutBounds.maxY - 10
    });

    // sound toggle button at bottom right
    const soundToggleButton = new SoundToggleButton(viewProperties.isSoundEnabledProperty, {
      right: resetAllButton.left - 20,
      centerY: resetAllButton.centerY,
      xMargin: 8
    });

    // add children to the scene graph
    this.addChild(board);
    this.addChild(ballsNode);
    this.addChild(eraserButton);
    this.addChild(histogramNode);
    this.addChild(hopper);
    this.addChild(soundToggleButton);
    this.addChild(resetAllButton);

    // Hide BallsNode when the hopper mode is not 'ball'.
    // unlink unnecessary since this instance exists for the lifetime of the sim.
    model.hopperModeProperty.link(hopperMode => {
      ballsNode.visible = hopperMode === 'ball';
    });

    // When switching to show bins, repaint the balls.
    // unlink unnecessary since this instance exists for the lifetime of the sim.
    viewProperties.histogramModeProperty.link(histogramMode => {
      if (histogramMode === 'cylinder') {
        ballsNode.invalidatePaint();
      }
    });

    // Repaint ballsNode when balls have moved.
    // See https://github.com/phetsims/plinko-probability/issues/62
    model.ballsMovedEmitter.addListener(() => {
      ballsNode.invalidatePaint();
    });

    // @protected used by subtypes
    this.hopper = hopper;
    this.ballsNode = ballsNode;
    this.eraserButton = eraserButton;
  }

  /**
   * @param {number} dt
   * @public
   */
  step(dt) {
    // increment time for sound generation
    this.pegSoundGeneration.step(dt);
  }

  /**
   * Reset function. The base type implementation does nothing. But reset is called by
   * the Reset All button listener and may be overridden in subtypes.  So it seemed
   * appropriate to include a no-op function here.
   *
   * @public
   */
  reset() {
    this.viewProperties.reset();
    this.pegSoundGeneration.reset();
  }
}
plinkoProbability.register('PlinkoProbabilityCommonView', PlinkoProbabilityCommonView);
export default PlinkoProbabilityCommonView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb3VuZHMyIiwiU2NyZWVuVmlldyIsIm1lcmdlIiwiTW9kZWxWaWV3VHJhbnNmb3JtMiIsIkVyYXNlckJ1dHRvbiIsIlJlc2V0QWxsQnV0dG9uIiwiU291bmRUb2dnbGVCdXR0b24iLCJwbGlua29Qcm9iYWJpbGl0eSIsIlBsaW5rb1Byb2JhYmlsaXR5Q29uc3RhbnRzIiwiQmFsbHNOb2RlIiwiQm9hcmQiLCJIaXN0b2dyYW1Ob2RlIiwiSG9wcGVyIiwiUGVnU291bmRHZW5lcmF0aW9uIiwiUGxpbmtvUHJvYmFiaWxpdHlWaWV3UHJvcGVydGllcyIsIlBsaW5rb1Byb2JhYmlsaXR5Q29tbW9uVmlldyIsImNvbnN0cnVjdG9yIiwibW9kZWwiLCJvcHRpb25zIiwiaGlzdG9ncmFtTW9kZSIsInZpZXdQcm9wZXJ0aWVzIiwiaG9wcGVyIiwibnVtYmVyT2ZSb3dzUHJvcGVydHkiLCJjZW50ZXJYIiwibGF5b3V0Qm91bmRzIiwibWF4WCIsInRvcCIsImJvYXJkIiwieCIsImJvdHRvbSIsInZpZXdUcmlhbmd1bGFyQm9hcmRCb3VuZHMiLCJsZWZ0Iiwic2l6ZSIsIndpZHRoIiwiaGVpZ2h0IiwibW9kZWxUcmlhbmd1bGFyQm9hcmRCb3VuZHMiLCJnYWx0b25Cb2FyZCIsImJvdW5kcyIsIm1vZGVsVmlld1RyYW5zZm9ybSIsImNyZWF0ZVJlY3RhbmdsZUludmVydGVkWU1hcHBpbmciLCJoaXN0b2dyYW1Nb2RlbEJvdW5kcyIsIkhJU1RPR1JBTV9CT1VORFMiLCJiYWxsTW9kZWxCb3VuZHMiLCJ1bmlvbiIsImJhbGxWaWV3Qm91bmRzIiwibW9kZWxUb1ZpZXdCb3VuZHMiLCJkaWxhdGVkIiwiYmFsbHNOb2RlIiwiYmFsbHMiLCJoaXN0b2dyYW1Nb2RlUHJvcGVydHkiLCJjYW52YXNCb3VuZHMiLCJoaXN0b2dyYW1Ob2RlIiwiaXNUaGVvcmV0aWNhbEhpc3RvZ3JhbVZpc2libGVQcm9wZXJ0eSIsImVyYXNlckJ1dHRvbiIsImljb25XaWR0aCIsInNjYWxlIiwibGlzdGVuZXIiLCJlcmFzZSIsIm1heFkiLCJwZWdTb3VuZEdlbmVyYXRpb24iLCJpc1NvdW5kRW5hYmxlZFByb3BlcnR5IiwicmVzZXRBbGxCdXR0b24iLCJyZXNldCIsInJpZ2h0IiwiUEFORUxfUklHSFRfUEFERElORyIsInNvdW5kVG9nZ2xlQnV0dG9uIiwiY2VudGVyWSIsInhNYXJnaW4iLCJhZGRDaGlsZCIsImhvcHBlck1vZGVQcm9wZXJ0eSIsImxpbmsiLCJob3BwZXJNb2RlIiwidmlzaWJsZSIsImludmFsaWRhdGVQYWludCIsImJhbGxzTW92ZWRFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJzdGVwIiwiZHQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlBsaW5rb1Byb2JhYmlsaXR5Q29tbW9uVmlldy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNC0yMDIwLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBDb21tb24gU2NyZWVuVmlldyAoYmFzZSB0eXBlKSBmb3IgUGxpbmtvIFByb2JhYmlsaXR5XHJcbiAqXHJcbiAqIEBhdXRob3IgTWFydGluIFZlaWxsZXR0ZSAoQmVyZWEgQ29sbGVnZSlcclxuICogQGF1dGhvciBHdWlsbGVybW8gUmFtb3MgKEJlcmVhIENvbGxlZ2UpXHJcbiAqIEBhdXRob3IgRGVuemVsbCBCYXJuZXR0IChCZXJlYSBDb2xsZWdlKVxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IFNjcmVlblZpZXcgZnJvbSAnLi4vLi4vLi4vLi4vam9pc3QvanMvU2NyZWVuVmlldy5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgTW9kZWxWaWV3VHJhbnNmb3JtMiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qcyc7XHJcbmltcG9ydCBFcmFzZXJCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL2J1dHRvbnMvRXJhc2VyQnV0dG9uLmpzJztcclxuaW1wb3J0IFJlc2V0QWxsQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL1Jlc2V0QWxsQnV0dG9uLmpzJztcclxuaW1wb3J0IFNvdW5kVG9nZ2xlQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL1NvdW5kVG9nZ2xlQnV0dG9uLmpzJztcclxuaW1wb3J0IHBsaW5rb1Byb2JhYmlsaXR5IGZyb20gJy4uLy4uL3BsaW5rb1Byb2JhYmlsaXR5LmpzJztcclxuaW1wb3J0IFBsaW5rb1Byb2JhYmlsaXR5Q29uc3RhbnRzIGZyb20gJy4uL1BsaW5rb1Byb2JhYmlsaXR5Q29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEJhbGxzTm9kZSBmcm9tICcuL0JhbGxzTm9kZS5qcyc7XHJcbmltcG9ydCBCb2FyZCBmcm9tICcuL0JvYXJkLmpzJztcclxuaW1wb3J0IEhpc3RvZ3JhbU5vZGUgZnJvbSAnLi9IaXN0b2dyYW1Ob2RlLmpzJztcclxuaW1wb3J0IEhvcHBlciBmcm9tICcuL0hvcHBlci5qcyc7XHJcbmltcG9ydCBQZWdTb3VuZEdlbmVyYXRpb24gZnJvbSAnLi9QZWdTb3VuZEdlbmVyYXRpb24uanMnO1xyXG5pbXBvcnQgUGxpbmtvUHJvYmFiaWxpdHlWaWV3UHJvcGVydGllcyBmcm9tICcuL1BsaW5rb1Byb2JhYmlsaXR5Vmlld1Byb3BlcnRpZXMuanMnO1xyXG5cclxuY2xhc3MgUGxpbmtvUHJvYmFiaWxpdHlDb21tb25WaWV3IGV4dGVuZHMgU2NyZWVuVmlldyB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7UGxpbmtvUHJvYmFiaWxpdHlDb21tb25Nb2RlbH0gbW9kZWxcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1vZGVsLCBvcHRpb25zICkge1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG4gICAgICBoaXN0b2dyYW1Nb2RlOiAnY3lsaW5kZXInIC8vIHtzdHJpbmd9IHNlZSBISVNUT0dSQU1fTU9ERV9WQUxVRVNcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIHZpZXctc3BlY2lmaWMgUHJvcGVydGllc1xyXG4gICAgY29uc3Qgdmlld1Byb3BlcnRpZXMgPSBuZXcgUGxpbmtvUHJvYmFiaWxpdHlWaWV3UHJvcGVydGllcygge1xyXG4gICAgICBoaXN0b2dyYW1Nb2RlOiBvcHRpb25zLmhpc3RvZ3JhbU1vZGVcclxuICAgIH0gKTtcclxuICAgIHRoaXMudmlld1Byb3BlcnRpZXMgPSB2aWV3UHJvcGVydGllczsgLy8gQHByb3RlY3RlZFxyXG5cclxuICAgIGNvbnN0IGhvcHBlciA9IG5ldyBIb3BwZXIoIG1vZGVsLm51bWJlck9mUm93c1Byb3BlcnR5LCB7XHJcbiAgICAgIGNlbnRlclg6IHRoaXMubGF5b3V0Qm91bmRzLm1heFggLyAyIC0gODAsXHJcbiAgICAgIHRvcDogMTBcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBib2FyZCA9IG5ldyBCb2FyZCgge1xyXG4gICAgICB4OiBob3BwZXIuY2VudGVyWCxcclxuICAgICAgdG9wOiBob3BwZXIuYm90dG9tICsgMTBcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBjcmVhdGUgdGhlIG1vZGVsIHZpZXcgdHJhbnNmb3JtIGJhc2VkIG9uIHRoZSB0cmlhbmd1bGFyIGJvYXJkIG9mIHRoZSBnYWx0b24gYm9hcmQgKGV4Y2x1ZGluZyB0aGUgZHJvcHBlZCBzaGFkb3cpXHJcbiAgICBjb25zdCB2aWV3VHJpYW5ndWxhckJvYXJkQm91bmRzID0gbmV3IEJvdW5kczIoIGJvYXJkLmxlZnQsIGJvYXJkLnRvcCwgYm9hcmQubGVmdCArIGJvYXJkLnNpemUud2lkdGgsIGJvYXJkLnRvcCArIGJvYXJkLnNpemUuaGVpZ2h0ICk7XHJcbiAgICBjb25zdCBtb2RlbFRyaWFuZ3VsYXJCb2FyZEJvdW5kcyA9IG1vZGVsLmdhbHRvbkJvYXJkLmJvdW5kcztcclxuICAgIGNvbnN0IG1vZGVsVmlld1RyYW5zZm9ybSA9IE1vZGVsVmlld1RyYW5zZm9ybTIuY3JlYXRlUmVjdGFuZ2xlSW52ZXJ0ZWRZTWFwcGluZyggbW9kZWxUcmlhbmd1bGFyQm9hcmRCb3VuZHMsIHZpZXdUcmlhbmd1bGFyQm9hcmRCb3VuZHMgKTtcclxuXHJcbiAgICAvLyBAcHJvdGVjdGVkXHJcbiAgICB0aGlzLnZpZXdUcmlhbmd1bGFyQm9hcmRCb3VuZHMgPSB2aWV3VHJpYW5ndWxhckJvYXJkQm91bmRzO1xyXG4gICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0gPSBtb2RlbFZpZXdUcmFuc2Zvcm07XHJcblxyXG4gICAgY29uc3QgaGlzdG9ncmFtTW9kZWxCb3VuZHMgPSBQbGlua29Qcm9iYWJpbGl0eUNvbnN0YW50cy5ISVNUT0dSQU1fQk9VTkRTO1xyXG4gICAgY29uc3QgYmFsbE1vZGVsQm91bmRzID0gbW9kZWwuZ2FsdG9uQm9hcmQuYm91bmRzLnVuaW9uKCBoaXN0b2dyYW1Nb2RlbEJvdW5kcyApO1xyXG4gICAgY29uc3QgYmFsbFZpZXdCb3VuZHMgPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0JvdW5kcyggYmFsbE1vZGVsQm91bmRzICkuZGlsYXRlZCggMjAgKTtcclxuXHJcbiAgICAvLyByZW5kZXJzIGFsbCB0aGUgYmFsbHNcclxuICAgIGNvbnN0IGJhbGxzTm9kZSA9IG5ldyBCYWxsc05vZGUoIG1vZGVsLmJhbGxzLCBtb2RlbC5udW1iZXJPZlJvd3NQcm9wZXJ0eSwgdmlld1Byb3BlcnRpZXMuaGlzdG9ncmFtTW9kZVByb3BlcnR5LCBtb2RlbFZpZXdUcmFuc2Zvcm0sIHtcclxuICAgICAgY2FudmFzQm91bmRzOiBiYWxsVmlld0JvdW5kc1xyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGhpc3RvZ3JhbU5vZGUgPSBuZXcgSGlzdG9ncmFtTm9kZShcclxuICAgICAgdmlld1Byb3BlcnRpZXMuaGlzdG9ncmFtTW9kZVByb3BlcnR5LFxyXG4gICAgICBtb2RlbCxcclxuICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLFxyXG4gICAgICB2aWV3UHJvcGVydGllcy5pc1RoZW9yZXRpY2FsSGlzdG9ncmFtVmlzaWJsZVByb3BlcnR5XHJcbiAgICApO1xyXG4gICAgdGhpcy5oaXN0b2dyYW1Ob2RlID0gaGlzdG9ncmFtTm9kZTtcclxuXHJcbiAgICBjb25zdCBlcmFzZXJCdXR0b24gPSBuZXcgRXJhc2VyQnV0dG9uKCB7XHJcbiAgICAgIGljb25XaWR0aDogMjIsXHJcbiAgICAgIHNjYWxlOiAxLjQsXHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB7IG1vZGVsLmVyYXNlKCk7IH0sXHJcbiAgICAgIGJvdHRvbTogdGhpcy5sYXlvdXRCb3VuZHMubWF4WSAtIDU1LFxyXG4gICAgICBsZWZ0OiA0MFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwcm90ZWN0ZWQgc291bmQgZ2VuZXJhdG9yIGZvciBiYWxsIGhpdHRpbmcgcGVnXHJcbiAgICB0aGlzLnBlZ1NvdW5kR2VuZXJhdGlvbiA9IG5ldyBQZWdTb3VuZEdlbmVyYXRpb24oIHZpZXdQcm9wZXJ0aWVzLmlzU291bmRFbmFibGVkUHJvcGVydHkgKTtcclxuXHJcbiAgICAvLyBSZXNldCBBbGwgQnV0dG9uIGF0IGJvdHRvbSByaWdodFxyXG4gICAgY29uc3QgcmVzZXRBbGxCdXR0b24gPSBuZXcgUmVzZXRBbGxCdXR0b24oIHtcclxuICAgICAgbGlzdGVuZXI6ICgpID0+IHtcclxuICAgICAgICBtb2RlbC5yZXNldCgpO1xyXG4gICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgfSxcclxuICAgICAgcmlnaHQ6IHRoaXMubGF5b3V0Qm91bmRzLm1heFggLSBQbGlua29Qcm9iYWJpbGl0eUNvbnN0YW50cy5QQU5FTF9SSUdIVF9QQURESU5HLFxyXG4gICAgICBib3R0b206IHRoaXMubGF5b3V0Qm91bmRzLm1heFkgLSAxMFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHNvdW5kIHRvZ2dsZSBidXR0b24gYXQgYm90dG9tIHJpZ2h0XHJcbiAgICBjb25zdCBzb3VuZFRvZ2dsZUJ1dHRvbiA9IG5ldyBTb3VuZFRvZ2dsZUJ1dHRvbiggdmlld1Byb3BlcnRpZXMuaXNTb3VuZEVuYWJsZWRQcm9wZXJ0eSwge1xyXG4gICAgICByaWdodDogcmVzZXRBbGxCdXR0b24ubGVmdCAtIDIwLFxyXG4gICAgICBjZW50ZXJZOiByZXNldEFsbEJ1dHRvbi5jZW50ZXJZLFxyXG4gICAgICB4TWFyZ2luOiA4XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYWRkIGNoaWxkcmVuIHRvIHRoZSBzY2VuZSBncmFwaFxyXG4gICAgdGhpcy5hZGRDaGlsZCggYm9hcmQgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGJhbGxzTm9kZSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggZXJhc2VyQnV0dG9uICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBoaXN0b2dyYW1Ob2RlICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBob3BwZXIgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHNvdW5kVG9nZ2xlQnV0dG9uICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCByZXNldEFsbEJ1dHRvbiApO1xyXG5cclxuICAgIC8vIEhpZGUgQmFsbHNOb2RlIHdoZW4gdGhlIGhvcHBlciBtb2RlIGlzIG5vdCAnYmFsbCcuXHJcbiAgICAvLyB1bmxpbmsgdW5uZWNlc3Nhcnkgc2luY2UgdGhpcyBpbnN0YW5jZSBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltLlxyXG4gICAgbW9kZWwuaG9wcGVyTW9kZVByb3BlcnR5LmxpbmsoIGhvcHBlck1vZGUgPT4ge1xyXG4gICAgICBiYWxsc05vZGUudmlzaWJsZSA9ICggaG9wcGVyTW9kZSA9PT0gJ2JhbGwnICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gV2hlbiBzd2l0Y2hpbmcgdG8gc2hvdyBiaW5zLCByZXBhaW50IHRoZSBiYWxscy5cclxuICAgIC8vIHVubGluayB1bm5lY2Vzc2FyeSBzaW5jZSB0aGlzIGluc3RhbmNlIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0uXHJcbiAgICB2aWV3UHJvcGVydGllcy5oaXN0b2dyYW1Nb2RlUHJvcGVydHkubGluayggaGlzdG9ncmFtTW9kZSA9PiB7XHJcbiAgICAgIGlmICggaGlzdG9ncmFtTW9kZSA9PT0gJ2N5bGluZGVyJyApIHtcclxuICAgICAgICBiYWxsc05vZGUuaW52YWxpZGF0ZVBhaW50KCk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBSZXBhaW50IGJhbGxzTm9kZSB3aGVuIGJhbGxzIGhhdmUgbW92ZWQuXHJcbiAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3BsaW5rby1wcm9iYWJpbGl0eS9pc3N1ZXMvNjJcclxuICAgIG1vZGVsLmJhbGxzTW92ZWRFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgIGJhbGxzTm9kZS5pbnZhbGlkYXRlUGFpbnQoKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBAcHJvdGVjdGVkIHVzZWQgYnkgc3VidHlwZXNcclxuICAgIHRoaXMuaG9wcGVyID0gaG9wcGVyO1xyXG4gICAgdGhpcy5iYWxsc05vZGUgPSBiYWxsc05vZGU7XHJcbiAgICB0aGlzLmVyYXNlckJ1dHRvbiA9IGVyYXNlckJ1dHRvbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBkdFxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBzdGVwKCBkdCApIHtcclxuXHJcbiAgICAvLyBpbmNyZW1lbnQgdGltZSBmb3Igc291bmQgZ2VuZXJhdGlvblxyXG4gICAgdGhpcy5wZWdTb3VuZEdlbmVyYXRpb24uc3RlcCggZHQgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc2V0IGZ1bmN0aW9uLiBUaGUgYmFzZSB0eXBlIGltcGxlbWVudGF0aW9uIGRvZXMgbm90aGluZy4gQnV0IHJlc2V0IGlzIGNhbGxlZCBieVxyXG4gICAqIHRoZSBSZXNldCBBbGwgYnV0dG9uIGxpc3RlbmVyIGFuZCBtYXkgYmUgb3ZlcnJpZGRlbiBpbiBzdWJ0eXBlcy4gIFNvIGl0IHNlZW1lZFxyXG4gICAqIGFwcHJvcHJpYXRlIHRvIGluY2x1ZGUgYSBuby1vcCBmdW5jdGlvbiBoZXJlLlxyXG4gICAqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHJlc2V0KCkge1xyXG4gICAgdGhpcy52aWV3UHJvcGVydGllcy5yZXNldCgpO1xyXG4gICAgdGhpcy5wZWdTb3VuZEdlbmVyYXRpb24ucmVzZXQoKTtcclxuICB9XHJcbn1cclxuXHJcbnBsaW5rb1Byb2JhYmlsaXR5LnJlZ2lzdGVyKCAnUGxpbmtvUHJvYmFiaWxpdHlDb21tb25WaWV3JywgUGxpbmtvUHJvYmFiaWxpdHlDb21tb25WaWV3ICk7XHJcbmV4cG9ydCBkZWZhdWx0IFBsaW5rb1Byb2JhYmlsaXR5Q29tbW9uVmlldzsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxVQUFVLE1BQU0sb0NBQW9DO0FBQzNELE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsbUJBQW1CLE1BQU0sdURBQXVEO0FBQ3ZGLE9BQU9DLFlBQVksTUFBTSxxREFBcUQ7QUFDOUUsT0FBT0MsY0FBYyxNQUFNLHVEQUF1RDtBQUNsRixPQUFPQyxpQkFBaUIsTUFBTSwwREFBMEQ7QUFDeEYsT0FBT0MsaUJBQWlCLE1BQU0sNEJBQTRCO0FBQzFELE9BQU9DLDBCQUEwQixNQUFNLGtD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