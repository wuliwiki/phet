// Copyright 2014-2021, University of Colorado Boulder

/**
 * Model for the 'Intro' screen
 *
 * @author Martin Veillette (Berea College)
 */

import PlinkoProbabilityCommonModel from '../../common/model/PlinkoProbabilityCommonModel.js';
import PlinkoProbabilityConstants from '../../common/PlinkoProbabilityConstants.js';
import PlinkoProbabilityQueryParameters from '../../common/PlinkoProbabilityQueryParameters.js';
import plinkoProbability from '../../plinkoProbability.js';
import IntroBall from './IntroBall.js';

// constants
const MAX_BALLS = PlinkoProbabilityQueryParameters.maxBallsIntro;
const PERSPECTIVE_TILT = Math.PI / 1.4; // in radians

class IntroModel extends PlinkoProbabilityCommonModel {
  /**
   */
  constructor() {
    super();
    const bounds = PlinkoProbabilityConstants.HISTOGRAM_BOUNDS;
    // the width of one bin is the total width divided by the number of columns
    const binWidth = bounds.width / (this.numberOfRowsProperty.get() + 1);
    const cylinderWidth = 0.95 * binWidth; // there is a small gap between each cylinder
    const ellipseHeight = cylinderWidth * Math.sin(PERSPECTIVE_TILT); // the height is the width times some perspective tilt

    this.cylinderInfo = {
      // @public (read-only)
      cylinderWidth: cylinderWidth,
      cylinderHeight: bounds.height * 0.87,
      // we want the cylinders to be shorter than the histogram
      ellipseHeight: ellipseHeight,
      // the height of the ellipse
      verticalOffset: 0.035,
      // gap between pegboard and cylinders
      top: bounds.maxY // the top of the cylinders
    };

    // @private
    this.launchedBallsNumber = 0; // number of balls created
    this.ballsToCreateNumber = 0; // number of balls in the creation queue

    // Stop dispensing balls when the ball mode is changed.
    this.ballModeProperty.lazyLink(ballMode => {
      if (this.ballsToCreateNumber > 0) {
        this.ballsToCreateNumber = 0;
        this.isBallCapReachedProperty.set(this.launchedBallsNumber >= MAX_BALLS);
      }
    });
  }

  /**
   * Time step function that is responsible for updating the position and status of the balls.
   *
   * @param {number} dt - time interval
   * @public
   */
  step(dt) {
    // Keep track of the time elapsed since the last ball was created
    this.ballCreationTimeElapsed += dt;

    // we only want to create a ball if:
    // there are balls waiting in line &&
    // the minimum time interval has passed 150 milliseconds &&
    // the number of launched balls is less than the maximum number of balls
    if (this.ballsToCreateNumber > 0 && this.ballCreationTimeElapsed > 0.150 && this.launchedBallsNumber < MAX_BALLS) {
      this.addNewBall(); // add a new ball
    }

    // Move balls
    let ballsMoved = false;
    const dtCapped = Math.min(0.1, dt * 5); // Cap the dt so that the balls don't make a big jump
    this.balls.forEach(ball => {
      const ballMoved = ball.step(dtCapped);
      ballsMoved = ballMoved || ballsMoved;
    });

    // Notify if balls moved
    if (ballsMoved) {
      this.ballsMovedEmitter.emit();
    }
  }

  /**
   * @override
   * @public
   */
  erase() {
    super.erase();
    this.ballsToCreateNumber = 0;
    this.launchedBallsNumber = 0;
  }

  /**
   * This function updates the number of balls to be launched which depends on the status of ballMode.
   * The cap of of the maximum number of balls to be launches is enforced by the step() function.
   *
   * @private
   */
  updateBallsToCreateNumber() {
    switch (this.ballModeProperty.get()) {
      // add one ball to the queue
      case 'oneBall':
        this.ballsToCreateNumber++;
        break;

      // add ten ball to the queue
      case 'tenBalls':
        this.ballsToCreateNumber += 10;
        break;

      // add max number of balls to the queue
      case 'maxBalls':
        this.ballsToCreateNumber += MAX_BALLS;
        break;
      default:
        throw new Error(`invalid ballMode: ${this.ballModeProperty.get()}`);
    }
  }

  /**
   * Add a new Ball to the model
   *
   * @private
   */
  addNewBall() {
    // create a new ball
    const addedBall = new IntroBall(this.probabilityProperty.get(), this.numberOfRowsProperty.get(), this.histogram.bins, this.cylinderInfo);
    this.launchedBallsNumber++; // increment the number of launched balls
    this.ballsToCreateNumber--; // decrease the number of balls in the queue

    this.ballCreationTimeElapsed = 0; //reset the time elapsed since the launched of the last ball

    // Disable the playButton when all the balls have been queued
    if (this.launchedBallsNumber + this.ballsToCreateNumber >= MAX_BALLS) {
      this.isBallCapReachedProperty.set(true);
    }
    this.histogram.updateBinCountAndOrientation(addedBall);
    this.balls.push(addedBall);

    // ballOutOfPegsEmitter is emitted when the addedBall leaves the last peg on the Galton board.
    const ballOutOfPegsListener = () => {
      this.histogram.addBallToHistogram(addedBall);
      addedBall.ballOutOfPegsEmitter.removeListener(ballOutOfPegsListener);
    };
    addedBall.ballOutOfPegsEmitter.addListener(ballOutOfPegsListener);
  }
}
plinkoProbability.register('IntroModel', IntroModel);
export default IntroModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQbGlua29Qcm9iYWJpbGl0eUNvbW1vbk1vZGVsIiwiUGxpbmtvUHJvYmFiaWxpdHlDb25zdGFudHMiLCJQbGlua29Qcm9iYWJpbGl0eVF1ZXJ5UGFyYW1ldGVycyIsInBsaW5rb1Byb2JhYmlsaXR5IiwiSW50cm9CYWxsIiwiTUFYX0JBTExTIiwibWF4QmFsbHNJbnRybyIsIlBFUlNQRUNUSVZFX1RJTFQiLCJNYXRoIiwiUEkiLCJJbnRyb01vZGVsIiwiY29uc3RydWN0b3IiLCJib3VuZHMiLCJISVNUT0dSQU1fQk9VTkRTIiwiYmluV2lkdGgiLCJ3aWR0aCIsIm51bWJlck9mUm93c1Byb3BlcnR5IiwiZ2V0IiwiY3lsaW5kZXJXaWR0aCIsImVsbGlwc2VIZWlnaHQiLCJzaW4iLCJjeWxpbmRlckluZm8iLCJjeWxpbmRlckhlaWdodCIsImhlaWdodCIsInZlcnRpY2FsT2Zmc2V0IiwidG9wIiwibWF4WSIsImxhdW5jaGVkQmFsbHNOdW1iZXIiLCJiYWxsc1RvQ3JlYXRlTnVtYmVyIiwiYmFsbE1vZGVQcm9wZXJ0eSIsImxhenlMaW5rIiwiYmFsbE1vZGUiLCJpc0JhbGxDYXBSZWFjaGVkUHJvcGVydHkiLCJzZXQiLCJzdGVwIiwiZHQiLCJiYWxsQ3JlYXRpb25UaW1lRWxhcHNlZCIsImFkZE5ld0JhbGwiLCJiYWxsc01vdmVkIiwiZHRDYXBwZWQiLCJtaW4iLCJiYWxscyIsImZvckVhY2giLCJiYWxsIiwiYmFsbE1vdmVkIiwiYmFsbHNNb3ZlZEVtaXR0ZXIiLCJlbWl0IiwiZXJhc2UiLCJ1cGRhdGVCYWxsc1RvQ3JlYXRlTnVtYmVyIiwiRXJyb3IiLCJhZGRlZEJhbGwiLCJwcm9iYWJpbGl0eVByb3BlcnR5IiwiaGlzdG9ncmFtIiwiYmlucyIsInVwZGF0ZUJpbkNvdW50QW5kT3JpZW50YXRpb24iLCJwdXNoIiwiYmFsbE91dE9mUGVnc0xpc3RlbmVyIiwiYWRkQmFsbFRvSGlzdG9ncmFtIiwiYmFsbE91dE9mUGVnc0VtaXR0ZXIiLCJyZW1vdmVMaXN0ZW5lciIsImFkZExpc3RlbmVyIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJJbnRyb01vZGVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjEsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIE1vZGVsIGZvciB0aGUgJ0ludHJvJyBzY3JlZW5cclxuICpcclxuICogQGF1dGhvciBNYXJ0aW4gVmVpbGxldHRlIChCZXJlYSBDb2xsZWdlKVxyXG4gKi9cclxuXHJcbmltcG9ydCBQbGlua29Qcm9iYWJpbGl0eUNvbW1vbk1vZGVsIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9QbGlua29Qcm9iYWJpbGl0eUNvbW1vbk1vZGVsLmpzJztcclxuaW1wb3J0IFBsaW5rb1Byb2JhYmlsaXR5Q29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9QbGlua29Qcm9iYWJpbGl0eUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBQbGlua29Qcm9iYWJpbGl0eVF1ZXJ5UGFyYW1ldGVycyBmcm9tICcuLi8uLi9jb21tb24vUGxpbmtvUHJvYmFiaWxpdHlRdWVyeVBhcmFtZXRlcnMuanMnO1xyXG5pbXBvcnQgcGxpbmtvUHJvYmFiaWxpdHkgZnJvbSAnLi4vLi4vcGxpbmtvUHJvYmFiaWxpdHkuanMnO1xyXG5pbXBvcnQgSW50cm9CYWxsIGZyb20gJy4vSW50cm9CYWxsLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBNQVhfQkFMTFMgPSBQbGlua29Qcm9iYWJpbGl0eVF1ZXJ5UGFyYW1ldGVycy5tYXhCYWxsc0ludHJvO1xyXG5jb25zdCBQRVJTUEVDVElWRV9USUxUID0gTWF0aC5QSSAvIDEuNDsgLy8gaW4gcmFkaWFuc1xyXG5cclxuY2xhc3MgSW50cm9Nb2RlbCBleHRlbmRzIFBsaW5rb1Byb2JhYmlsaXR5Q29tbW9uTW9kZWwge1xyXG4gIC8qKlxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICBjb25zdCBib3VuZHMgPSBQbGlua29Qcm9iYWJpbGl0eUNvbnN0YW50cy5ISVNUT0dSQU1fQk9VTkRTO1xyXG4gICAgLy8gdGhlIHdpZHRoIG9mIG9uZSBiaW4gaXMgdGhlIHRvdGFsIHdpZHRoIGRpdmlkZWQgYnkgdGhlIG51bWJlciBvZiBjb2x1bW5zXHJcbiAgICBjb25zdCBiaW5XaWR0aCA9IGJvdW5kcy53aWR0aCAvICggdGhpcy5udW1iZXJPZlJvd3NQcm9wZXJ0eS5nZXQoKSArIDEgKTtcclxuICAgIGNvbnN0IGN5bGluZGVyV2lkdGggPSAwLjk1ICogYmluV2lkdGg7IC8vIHRoZXJlIGlzIGEgc21hbGwgZ2FwIGJldHdlZW4gZWFjaCBjeWxpbmRlclxyXG4gICAgY29uc3QgZWxsaXBzZUhlaWdodCA9IGN5bGluZGVyV2lkdGggKiBNYXRoLnNpbiggUEVSU1BFQ1RJVkVfVElMVCApOyAvLyB0aGUgaGVpZ2h0IGlzIHRoZSB3aWR0aCB0aW1lcyBzb21lIHBlcnNwZWN0aXZlIHRpbHRcclxuXHJcbiAgICB0aGlzLmN5bGluZGVySW5mbyA9IHsgLy8gQHB1YmxpYyAocmVhZC1vbmx5KVxyXG4gICAgICBjeWxpbmRlcldpZHRoOiBjeWxpbmRlcldpZHRoLFxyXG4gICAgICBjeWxpbmRlckhlaWdodDogYm91bmRzLmhlaWdodCAqIDAuODcsIC8vIHdlIHdhbnQgdGhlIGN5bGluZGVycyB0byBiZSBzaG9ydGVyIHRoYW4gdGhlIGhpc3RvZ3JhbVxyXG4gICAgICBlbGxpcHNlSGVpZ2h0OiBlbGxpcHNlSGVpZ2h0LCAvLyB0aGUgaGVpZ2h0IG9mIHRoZSBlbGxpcHNlXHJcbiAgICAgIHZlcnRpY2FsT2Zmc2V0OiAwLjAzNSwgLy8gZ2FwIGJldHdlZW4gcGVnYm9hcmQgYW5kIGN5bGluZGVyc1xyXG4gICAgICB0b3A6IGJvdW5kcy5tYXhZIC8vIHRoZSB0b3Agb2YgdGhlIGN5bGluZGVyc1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5sYXVuY2hlZEJhbGxzTnVtYmVyID0gMDsgLy8gbnVtYmVyIG9mIGJhbGxzIGNyZWF0ZWRcclxuICAgIHRoaXMuYmFsbHNUb0NyZWF0ZU51bWJlciA9IDA7IC8vIG51bWJlciBvZiBiYWxscyBpbiB0aGUgY3JlYXRpb24gcXVldWVcclxuXHJcbiAgICAvLyBTdG9wIGRpc3BlbnNpbmcgYmFsbHMgd2hlbiB0aGUgYmFsbCBtb2RlIGlzIGNoYW5nZWQuXHJcbiAgICB0aGlzLmJhbGxNb2RlUHJvcGVydHkubGF6eUxpbmsoIGJhbGxNb2RlID0+IHtcclxuICAgICAgaWYgKCB0aGlzLmJhbGxzVG9DcmVhdGVOdW1iZXIgPiAwICkge1xyXG4gICAgICAgIHRoaXMuYmFsbHNUb0NyZWF0ZU51bWJlciA9IDA7XHJcbiAgICAgICAgdGhpcy5pc0JhbGxDYXBSZWFjaGVkUHJvcGVydHkuc2V0KCB0aGlzLmxhdW5jaGVkQmFsbHNOdW1iZXIgPj0gTUFYX0JBTExTICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBUaW1lIHN0ZXAgZnVuY3Rpb24gdGhhdCBpcyByZXNwb25zaWJsZSBmb3IgdXBkYXRpbmcgdGhlIHBvc2l0aW9uIGFuZCBzdGF0dXMgb2YgdGhlIGJhbGxzLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGR0IC0gdGltZSBpbnRlcnZhbFxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBzdGVwKCBkdCApIHtcclxuXHJcbiAgICAvLyBLZWVwIHRyYWNrIG9mIHRoZSB0aW1lIGVsYXBzZWQgc2luY2UgdGhlIGxhc3QgYmFsbCB3YXMgY3JlYXRlZFxyXG4gICAgdGhpcy5iYWxsQ3JlYXRpb25UaW1lRWxhcHNlZCArPSBkdDtcclxuXHJcbiAgICAvLyB3ZSBvbmx5IHdhbnQgdG8gY3JlYXRlIGEgYmFsbCBpZjpcclxuICAgIC8vIHRoZXJlIGFyZSBiYWxscyB3YWl0aW5nIGluIGxpbmUgJiZcclxuICAgIC8vIHRoZSBtaW5pbXVtIHRpbWUgaW50ZXJ2YWwgaGFzIHBhc3NlZCAxNTAgbWlsbGlzZWNvbmRzICYmXHJcbiAgICAvLyB0aGUgbnVtYmVyIG9mIGxhdW5jaGVkIGJhbGxzIGlzIGxlc3MgdGhhbiB0aGUgbWF4aW11bSBudW1iZXIgb2YgYmFsbHNcclxuICAgIGlmICggdGhpcy5iYWxsc1RvQ3JlYXRlTnVtYmVyID4gMCAmJiB0aGlzLmJhbGxDcmVhdGlvblRpbWVFbGFwc2VkID4gMC4xNTAgJiYgdGhpcy5sYXVuY2hlZEJhbGxzTnVtYmVyIDwgTUFYX0JBTExTICkge1xyXG4gICAgICB0aGlzLmFkZE5ld0JhbGwoKTsgLy8gYWRkIGEgbmV3IGJhbGxcclxuICAgIH1cclxuXHJcbiAgICAvLyBNb3ZlIGJhbGxzXHJcbiAgICBsZXQgYmFsbHNNb3ZlZCA9IGZhbHNlO1xyXG4gICAgY29uc3QgZHRDYXBwZWQgPSBNYXRoLm1pbiggMC4xLCBkdCAqIDUgKTsgLy8gQ2FwIHRoZSBkdCBzbyB0aGF0IHRoZSBiYWxscyBkb24ndCBtYWtlIGEgYmlnIGp1bXBcclxuICAgIHRoaXMuYmFsbHMuZm9yRWFjaCggYmFsbCA9PiB7XHJcbiAgICAgIGNvbnN0IGJhbGxNb3ZlZCA9IGJhbGwuc3RlcCggZHRDYXBwZWQgKTtcclxuICAgICAgYmFsbHNNb3ZlZCA9ICggYmFsbE1vdmVkIHx8IGJhbGxzTW92ZWQgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBOb3RpZnkgaWYgYmFsbHMgbW92ZWRcclxuICAgIGlmICggYmFsbHNNb3ZlZCApIHtcclxuICAgICAgdGhpcy5iYWxsc01vdmVkRW1pdHRlci5lbWl0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZXJhc2UoKSB7XHJcbiAgICBzdXBlci5lcmFzZSgpO1xyXG4gICAgdGhpcy5iYWxsc1RvQ3JlYXRlTnVtYmVyID0gMDtcclxuICAgIHRoaXMubGF1bmNoZWRCYWxsc051bWJlciA9IDA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGZ1bmN0aW9uIHVwZGF0ZXMgdGhlIG51bWJlciBvZiBiYWxscyB0byBiZSBsYXVuY2hlZCB3aGljaCBkZXBlbmRzIG9uIHRoZSBzdGF0dXMgb2YgYmFsbE1vZGUuXHJcbiAgICogVGhlIGNhcCBvZiBvZiB0aGUgbWF4aW11bSBudW1iZXIgb2YgYmFsbHMgdG8gYmUgbGF1bmNoZXMgaXMgZW5mb3JjZWQgYnkgdGhlIHN0ZXAoKSBmdW5jdGlvbi5cclxuICAgKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgdXBkYXRlQmFsbHNUb0NyZWF0ZU51bWJlcigpIHtcclxuICAgIHN3aXRjaCggdGhpcy5iYWxsTW9kZVByb3BlcnR5LmdldCgpICkge1xyXG5cclxuICAgICAgLy8gYWRkIG9uZSBiYWxsIHRvIHRoZSBxdWV1ZVxyXG4gICAgICBjYXNlICdvbmVCYWxsJzpcclxuICAgICAgICB0aGlzLmJhbGxzVG9DcmVhdGVOdW1iZXIrKztcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIC8vIGFkZCB0ZW4gYmFsbCB0byB0aGUgcXVldWVcclxuICAgICAgY2FzZSAndGVuQmFsbHMnOlxyXG4gICAgICAgIHRoaXMuYmFsbHNUb0NyZWF0ZU51bWJlciArPSAxMDtcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIC8vIGFkZCBtYXggbnVtYmVyIG9mIGJhbGxzIHRvIHRoZSBxdWV1ZVxyXG4gICAgICBjYXNlICdtYXhCYWxscyc6XHJcbiAgICAgICAgdGhpcy5iYWxsc1RvQ3JlYXRlTnVtYmVyICs9IE1BWF9CQUxMUztcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCBgaW52YWxpZCBiYWxsTW9kZTogJHt0aGlzLmJhbGxNb2RlUHJvcGVydHkuZ2V0KCl9YCApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWRkIGEgbmV3IEJhbGwgdG8gdGhlIG1vZGVsXHJcbiAgICpcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGFkZE5ld0JhbGwoKSB7XHJcblxyXG4gICAgLy8gY3JlYXRlIGEgbmV3IGJhbGxcclxuICAgIGNvbnN0IGFkZGVkQmFsbCA9IG5ldyBJbnRyb0JhbGwoIHRoaXMucHJvYmFiaWxpdHlQcm9wZXJ0eS5nZXQoKSwgdGhpcy5udW1iZXJPZlJvd3NQcm9wZXJ0eS5nZXQoKSxcclxuICAgICAgdGhpcy5oaXN0b2dyYW0uYmlucywgdGhpcy5jeWxpbmRlckluZm8gKTtcclxuXHJcbiAgICB0aGlzLmxhdW5jaGVkQmFsbHNOdW1iZXIrKzsgLy8gaW5jcmVtZW50IHRoZSBudW1iZXIgb2YgbGF1bmNoZWQgYmFsbHNcclxuICAgIHRoaXMuYmFsbHNUb0NyZWF0ZU51bWJlci0tOyAvLyBkZWNyZWFzZSB0aGUgbnVtYmVyIG9mIGJhbGxzIGluIHRoZSBxdWV1ZVxyXG5cclxuICAgIHRoaXMuYmFsbENyZWF0aW9uVGltZUVsYXBzZWQgPSAwOyAvL3Jlc2V0IHRoZSB0aW1lIGVsYXBzZWQgc2luY2UgdGhlIGxhdW5jaGVkIG9mIHRoZSBsYXN0IGJhbGxcclxuXHJcbiAgICAvLyBEaXNhYmxlIHRoZSBwbGF5QnV0dG9uIHdoZW4gYWxsIHRoZSBiYWxscyBoYXZlIGJlZW4gcXVldWVkXHJcbiAgICBpZiAoIHRoaXMubGF1bmNoZWRCYWxsc051bWJlciArIHRoaXMuYmFsbHNUb0NyZWF0ZU51bWJlciA+PSBNQVhfQkFMTFMgKSB7XHJcbiAgICAgIHRoaXMuaXNCYWxsQ2FwUmVhY2hlZFByb3BlcnR5LnNldCggdHJ1ZSApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaGlzdG9ncmFtLnVwZGF0ZUJpbkNvdW50QW5kT3JpZW50YXRpb24oIGFkZGVkQmFsbCApO1xyXG4gICAgdGhpcy5iYWxscy5wdXNoKCBhZGRlZEJhbGwgKTtcclxuXHJcbiAgICAvLyBiYWxsT3V0T2ZQZWdzRW1pdHRlciBpcyBlbWl0dGVkIHdoZW4gdGhlIGFkZGVkQmFsbCBsZWF2ZXMgdGhlIGxhc3QgcGVnIG9uIHRoZSBHYWx0b24gYm9hcmQuXHJcbiAgICBjb25zdCBiYWxsT3V0T2ZQZWdzTGlzdGVuZXIgPSAoKSA9PiB7XHJcbiAgICAgIHRoaXMuaGlzdG9ncmFtLmFkZEJhbGxUb0hpc3RvZ3JhbSggYWRkZWRCYWxsICk7XHJcbiAgICAgIGFkZGVkQmFsbC5iYWxsT3V0T2ZQZWdzRW1pdHRlci5yZW1vdmVMaXN0ZW5lciggYmFsbE91dE9mUGVnc0xpc3RlbmVyICk7XHJcbiAgICB9O1xyXG4gICAgYWRkZWRCYWxsLmJhbGxPdXRPZlBlZ3NFbWl0dGVyLmFkZExpc3RlbmVyKCBiYWxsT3V0T2ZQZWdzTGlzdGVuZXIgKTtcclxuICB9XHJcbn1cclxuXHJcbnBsaW5rb1Byb2JhYmlsaXR5LnJlZ2lzdGVyKCAnSW50cm9Nb2RlbCcsIEludHJvTW9kZWwgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IEludHJvTW9kZWw7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLDRCQUE0QixNQUFNLG9EQUFvRDtBQUM3RixPQUFPQywwQkFBMEIsTUFBTSw0Q0FBNEM7QUFDbkYsT0FBT0MsZ0NBQWdDLE1BQU0sa0RBQWtEO0FBQy9GLE9BQU9DLGlCQUFpQixNQUFNLDRCQUE0QjtBQUMxRCxPQUFPQyxTQUFTLE1BQU0sZ0JBQWdCOztBQUV0QztBQUNBLE1BQU1DLFNBQVMsR0FBR0gsZ0NBQWdDLENBQUNJLGFBQWE7QUFDaEUsTUFBTUMsZ0JBQWdCLEdBQUdDLElBQUksQ0FBQ0MsRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDOztBQUV4QyxNQUFNQyxVQUFVLFNBQVNWLDRCQUE0QixDQUFDO0VBQ3BEO0FBQ0Y7RUFDRVcsV0FBV0EsQ0FBQSxFQUFHO0lBQ1osS0FBSyxDQUFDLENBQUM7SUFFUCxNQUFNQyxNQUFNLEdBQUdYLDBCQUEwQixDQUFDWSxnQkFBZ0I7SUFDMUQ7SUFDQSxNQUFNQyxRQUFRLEdBQUdGLE1BQU0sQ0FBQ0csS0FBSyxJQUFLLElBQUksQ0FBQ0Msb0JBQW9CLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFFO0lBQ3ZFLE1BQU1DLGFBQWEsR0FBRyxJQUFJLEdBQUdKLFFBQVEsQ0FBQyxDQUFDO0lBQ3ZDLE1BQU1LLGFBQWEsR0FBR0QsYUFBYSxHQUFHVixJQUFJLENBQUNZLEdBQUcsQ0FBRWIsZ0JBQWlCLENBQUMsQ0FBQyxDQUFDOztJQUVwRSxJQUFJLENBQUNjLFlBQVksR0FBRztNQUFFO01BQ3BCSCxhQUFhLEVBQUVBLGFBQWE7TUFDNUJJLGNBQWMsRUFBRVYsTUFBTSxDQUFDVyxNQUFNLEdBQUcsSUFBSTtNQUFFO01BQ3RDSixhQUFhLEVBQUVBLGFBQWE7TUFBRTtNQUM5QkssY0FBYyxFQUFFLEtBQUs7TUFBRTtNQUN2QkMsR0FBRyxFQUFFYixNQUFNLENBQUNjLElBQUksQ0FBQztJQUNuQixDQUFDOztJQUVEO0lBQ0EsSUFBSSxDQUFDQyxtQkFBbUIsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUM5QixJQUFJLENBQUNDLG1CQUFtQixHQUFHLENBQUMsQ0FBQyxDQUFDOztJQUU5QjtJQUNBLElBQUksQ0FBQ0MsZ0JBQWdCLENBQUNDLFFBQVEsQ0FBRUMsUUFBUSxJQUFJO01BQzFDLElBQUssSUFBSSxDQUFDSCxtQkFBbUIsR0FBRyxDQUFDLEVBQUc7UUFDbEMsSUFBSSxDQUFDQSxtQkFBbUIsR0FBRyxDQUFDO1FBQzVCLElBQUksQ0FBQ0ksd0JBQXdCLENBQUNDLEdBQUcsQ0FBRSxJQUFJLENBQUNOLG1CQUFtQixJQUFJdEIsU0FBVSxDQUFDO01BQzVFO0lBQ0YsQ0FBRSxDQUFDO0VBQ0w7O0VBR0E7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0U2QixJQUFJQSxDQUFFQyxFQUFFLEVBQUc7SUFFVDtJQUNBLElBQUksQ0FBQ0MsdUJBQXVCLElBQUlELEVBQUU7O0lBRWxDO0lBQ0E7SUFDQTtJQUNBO0lBQ0EsSUFBSyxJQUFJLENBQUNQLG1CQUFtQixHQUFHLENBQUMsSUFBSSxJQUFJLENBQUNRLHVCQUF1QixHQUFHLEtBQUssSUFBSSxJQUFJLENBQUNULG1CQUFtQixHQUFHdEIsU0FBUyxFQUFHO01BQ2xILElBQUksQ0FBQ2dDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNyQjs7SUFFQTtJQUNBLElBQUlDLFVBQVUsR0FBRyxLQUFLO0lBQ3RCLE1BQU1DLFFBQVEsR0FBRy9CLElBQUksQ0FBQ2dDLEdBQUcsQ0FBRSxHQUFHLEVBQUVMLEVBQUUsR0FBRyxDQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzFDLElBQUksQ0FBQ00sS0FBSyxDQUFDQyxPQUFPLENBQUVDLElBQUksSUFBSTtNQUMxQixNQUFNQyxTQUFTLEdBQUdELElBQUksQ0FBQ1QsSUFBSSxDQUFFSyxRQUFTLENBQUM7TUFDdkNELFVBQVUsR0FBS00sU0FBUyxJQUFJTixVQUFZO0lBQzFDLENBQUUsQ0FBQzs7SUFFSDtJQUNBLElBQUtBLFVBQVUsRUFBRztNQUNoQixJQUFJLENBQUNPLGlCQUFpQixDQUFDQyxJQUFJLENBQUMsQ0FBQztJQUMvQjtFQUNGOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0VBQ0VDLEtBQUtBLENBQUEsRUFBRztJQUNOLEtBQUssQ0FBQ0EsS0FBSyxDQUFDLENBQUM7SUFDYixJQUFJLENBQUNuQixtQkFBbUIsR0FBRyxDQUFDO0lBQzVCLElBQUksQ0FBQ0QsbUJBQW1CLEdBQUcsQ0FBQztFQUM5Qjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRXFCLHlCQUF5QkEsQ0FBQSxFQUFHO0lBQzFCLFFBQVEsSUFBSSxDQUFDbkIsZ0JBQWdCLENBQUNaLEdBQUcsQ0FBQyxDQUFDO01BRWpDO01BQ0EsS0FBSyxTQUFTO1FBQ1osSUFBSSxDQUFDVyxtQkFBbUIsRUFBRTtRQUMxQjs7TUFFRjtNQUNBLEtBQUssVUFBVTtRQUNiLElBQUksQ0FBQ0EsbUJBQW1CLElBQUksRUFBRTtRQUM5Qjs7TUFFRjtNQUNBLEtBQUssVUFBVTtRQUNiLElBQUksQ0FBQ0EsbUJBQW1CLElBQUl2QixTQUFTO1FBQ3JDO01BRUY7UUFDRSxNQUFNLElBQUk0QyxLQUFLLENBQUcscUJBQW9CLElBQUksQ0FBQ3BCLGdCQUFnQixDQUFDWixHQUFHLENBQUMsQ0FBRSxFQUFFLENBQUM7SUFDekU7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0VvQixVQUFVQSxDQUFBLEVBQUc7SUFFWDtJQUNBLE1BQU1hLFNBQVMsR0FBRyxJQUFJOUMsU0FBUyxDQUFFLElBQUksQ0FBQytDLG1CQUFtQixDQUFDbEMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUNELG9CQUFvQixDQUFDQyxHQUFHLENBQUMsQ0FBQyxFQUM5RixJQUFJLENBQUNtQyxTQUFTLENBQUNDLElBQUksRUFBRSxJQUFJLENBQUNoQyxZQUFhLENBQUM7SUFFMUMsSUFBSSxDQUFDTSxtQkFBbUIsRUFBRSxDQUFDLENBQUM7SUFDNUIsSUFBSSxDQUFDQyxtQkFBbUIsRUFBRSxDQUFDLENBQUM7O0lBRTVCLElBQUksQ0FBQ1EsdUJBQXVCLEdBQUcsQ0FBQyxDQUFDLENBQUM7O0lBRWxDO0lBQ0EsSUFBSyxJQUFJLENBQUNULG1CQUFtQixHQUFHLElBQUksQ0FBQ0MsbUJBQW1CLElBQUl2QixTQUFTLEVBQUc7TUFDdEUsSUFBSSxDQUFDMkIsd0JBQXdCLENBQUNDLEdBQUcsQ0FBRSxJQUFLLENBQUM7SUFDM0M7SUFFQSxJQUFJLENBQUNtQixTQUFTLENBQUNFLDRCQUE0QixDQUFFSixTQUFVLENBQUM7SUFDeEQsSUFBSSxDQUFDVCxLQUFLLENBQUNjLElBQUksQ0FBRUwsU0FBVSxDQUFDOztJQUU1QjtJQUNBLE1BQU1NLHFCQUFxQixHQUFHQSxDQUFBLEtBQU07TUFDbEMsSUFBSSxDQUFDSixTQUFTLENBQUNLLGtCQUFrQixDQUFFUCxTQUFVLENBQUM7TUFDOUNBLFNBQVMsQ0FBQ1Esb0JBQW9CLENBQUNDLGNBQWMsQ0FBRUgscUJBQXNCLENBQUM7SUFDeEUsQ0FBQztJQUNETixTQUFTLENBQUNRLG9CQUFvQixDQUFDRSxXQUFXLENBQUVKLHFCQUFzQixDQUFDO0VBQ3JFO0FBQ0Y7QUFFQXJELGlCQUFpQixDQUFDMEQsUUFBUSxDQUFFLFlBQVksRUFBRW5ELFVBQVcsQ0FBQztBQUV0RCxlQUFlQSxVQUFVIn0=