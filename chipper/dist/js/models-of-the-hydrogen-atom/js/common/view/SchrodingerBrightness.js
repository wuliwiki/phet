// Copyright 2022, University of Colorado Boulder

/**
 * SchrodingerBrightness is responsible for representing Schrodinger states (and their associated wavefunctions)
 * as brightness. Brightness is computed on demand, then cached. The cache is configured for a fixed number of states,
 * and a fixed size 2D grid.
 *
 * In the Java implementation, this was class BrightnessCache in SchrodingerNode.java.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import SchrodingerModel from '../model/SchrodingerModel.js';
import modelsOfTheHydrogenAtom from '../../modelsOfTheHydrogenAtom.js';
const NUMBER_OF_HORIZONTAL_CELLS = 40;
const NUMBER_OF_VERTICAL_CELLS = NUMBER_OF_HORIZONTAL_CELLS;
const NUMBER_OF_DEPTH_CELLS = NUMBER_OF_HORIZONTAL_CELLS;
export default class SchrodingerBrightness {
  // [n][l][m][z][x]
  // reusable array for computing sums

  /**
   * @param hydrogenAtom
   * @param zoomedInBoxBounds - in view coordinates
   */
  constructor(hydrogenAtom, zoomedInBoxBounds) {
    this.hydrogenAtom = hydrogenAtom;
    const nMax = SchrodingerModel.getNumberOfStates();

    // Initialize brightness entries to null
    //TODO this is so ugly, ported from Java
    this.cache = Array(nMax);
    for (let n = 1; n <= nMax; n++) {
      const lSize = n;
      this.cache[n - 1] = Array(lSize);
      for (let l = 0; l < lSize; l++) {
        const mSize = l + 1;
        this.cache[n - 1][l] = Array(mSize);
        for (let m = 0; m < l + 1; m++) {
          const zSize = NUMBER_OF_VERTICAL_CELLS;
          this.cache[n - 1][l][m] = Array(zSize);
          for (let z = 0; z < zSize; z++) {
            for (let x = 0; x < NUMBER_OF_HORIZONTAL_CELLS; x++) {
              this.cache[n - 1][l][m] = null;
            }
          }
        }
      }
    }

    // Initialize sums with zeros
    //TODO this is so ugly
    this.sums = Array(NUMBER_OF_VERTICAL_CELLS);
    for (let i = 0; i < NUMBER_OF_VERTICAL_CELLS; i++) {
      this.sums[i] = Array(NUMBER_OF_HORIZONTAL_CELLS).fill(0);
    }

    // 3D cell size
    this.cellWidth = zoomedInBoxBounds.width / NUMBER_OF_HORIZONTAL_CELLS / 2;
    this.cellHeight = zoomedInBoxBounds.height / NUMBER_OF_VERTICAL_CELLS / 2;
    this.cellDepth = zoomedInBoxBounds.height / NUMBER_OF_DEPTH_CELLS / 2;
  }

  /**
   * Gets the 2D brightness for a state. If it's not already cached, compute it.
   */
  getBrightness(n, l, m) {
    let brightness = this.cache[n - 1][l][m];
    assert && assert(brightness !== undefined);
    if (brightness === null) {
      brightness = this.computeBrightness(n, l, m);
      this.cache[n - 1][l][m] = brightness;
    }
    return brightness;
  }

  /**
   * Computes the 2D brightness for a state.
   */
  computeBrightness(n, l, m) {
    // 2D array filled with zeros
    const brightness = Array(NUMBER_OF_VERTICAL_CELLS);
    for (let i = 0; i < NUMBER_OF_VERTICAL_CELLS; i++) {
      brightness[i] = Array(NUMBER_OF_HORIZONTAL_CELLS).fill(0);
    }
    let maxSum = 0;
    for (let row = 0; row < NUMBER_OF_VERTICAL_CELLS; row++) {
      const z = row * this.cellHeight + this.cellHeight / 2;
      assert && assert(z > 0);
      for (let column = 0; column < NUMBER_OF_HORIZONTAL_CELLS; column++) {
        const x = column * this.cellWidth + this.cellWidth / 2;
        assert && assert(x > 0);
        let sum = 0;
        for (let depth = 0; depth < NUMBER_OF_DEPTH_CELLS; depth++) {
          const y = depth * this.cellDepth + this.cellDepth / 2;
          assert && assert(y > 0);
          const probabilityDensity = this.hydrogenAtom.getProbabilityDensity(n, l, m, x, y, z);
          sum += probabilityDensity;
        }
        this.sums[row][column] = sum;
        if (sum > maxSum) {
          maxSum = sum;
        }
      }
    }
    for (let row = 0; row < NUMBER_OF_VERTICAL_CELLS; row++) {
      for (let column = 0; column < NUMBER_OF_HORIZONTAL_CELLS; column++) {
        let b = 0;
        if (maxSum > 0) {
          b = this.sums[row][column] / maxSum;
        }
        brightness[row][column] = b;
      }
    }
    return brightness;
  }
}
modelsOfTheHydrogenAtom.register('SchrodingerBrightness', SchrodingerBrightness);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTY2hyb2Rpbmdlck1vZGVsIiwibW9kZWxzT2ZUaGVIeWRyb2dlbkF0b20iLCJOVU1CRVJfT0ZfSE9SSVpPTlRBTF9DRUxMUyIsIk5VTUJFUl9PRl9WRVJUSUNBTF9DRUxMUyIsIk5VTUJFUl9PRl9ERVBUSF9DRUxMUyIsIlNjaHJvZGluZ2VyQnJpZ2h0bmVzcyIsImNvbnN0cnVjdG9yIiwiaHlkcm9nZW5BdG9tIiwiem9vbWVkSW5Cb3hCb3VuZHMiLCJuTWF4IiwiZ2V0TnVtYmVyT2ZTdGF0ZXMiLCJjYWNoZSIsIkFycmF5IiwibiIsImxTaXplIiwibCIsIm1TaXplIiwibSIsInpTaXplIiwieiIsIngiLCJzdW1zIiwiaSIsImZpbGwiLCJjZWxsV2lkdGgiLCJ3aWR0aCIsImNlbGxIZWlnaHQiLCJoZWlnaHQiLCJjZWxsRGVwdGgiLCJnZXRCcmlnaHRuZXNzIiwiYnJpZ2h0bmVzcyIsImFzc2VydCIsInVuZGVmaW5lZCIsImNvbXB1dGVCcmlnaHRuZXNzIiwibWF4U3VtIiwicm93IiwiY29sdW1uIiwic3VtIiwiZGVwdGgiLCJ5IiwicHJvYmFiaWxpdHlEZW5zaXR5IiwiZ2V0UHJvYmFiaWxpdHlEZW5zaXR5IiwiYiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiU2Nocm9kaW5nZXJCcmlnaHRuZXNzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTY2hyb2RpbmdlckJyaWdodG5lc3MgaXMgcmVzcG9uc2libGUgZm9yIHJlcHJlc2VudGluZyBTY2hyb2RpbmdlciBzdGF0ZXMgKGFuZCB0aGVpciBhc3NvY2lhdGVkIHdhdmVmdW5jdGlvbnMpXHJcbiAqIGFzIGJyaWdodG5lc3MuIEJyaWdodG5lc3MgaXMgY29tcHV0ZWQgb24gZGVtYW5kLCB0aGVuIGNhY2hlZC4gVGhlIGNhY2hlIGlzIGNvbmZpZ3VyZWQgZm9yIGEgZml4ZWQgbnVtYmVyIG9mIHN0YXRlcyxcclxuICogYW5kIGEgZml4ZWQgc2l6ZSAyRCBncmlkLlxyXG4gKlxyXG4gKiBJbiB0aGUgSmF2YSBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3YXMgY2xhc3MgQnJpZ2h0bmVzc0NhY2hlIGluIFNjaHJvZGluZ2VyTm9kZS5qYXZhLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBTY2hyb2Rpbmdlck1vZGVsIGZyb20gJy4uL21vZGVsL1NjaHJvZGluZ2VyTW9kZWwuanMnO1xyXG5pbXBvcnQgbW9kZWxzT2ZUaGVIeWRyb2dlbkF0b20gZnJvbSAnLi4vLi4vbW9kZWxzT2ZUaGVIeWRyb2dlbkF0b20uanMnO1xyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcblxyXG5jb25zdCBOVU1CRVJfT0ZfSE9SSVpPTlRBTF9DRUxMUyA9IDQwO1xyXG5jb25zdCBOVU1CRVJfT0ZfVkVSVElDQUxfQ0VMTFMgPSBOVU1CRVJfT0ZfSE9SSVpPTlRBTF9DRUxMUztcclxuY29uc3QgTlVNQkVSX09GX0RFUFRIX0NFTExTID0gTlVNQkVSX09GX0hPUklaT05UQUxfQ0VMTFM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTY2hyb2RpbmdlckJyaWdodG5lc3Mge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGh5ZHJvZ2VuQXRvbTogU2Nocm9kaW5nZXJNb2RlbDtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBjYWNoZTogQXJyYXk8QXJyYXk8QXJyYXk8bnVsbCB8IEFycmF5PEFycmF5PG51bWJlcj4+Pj4+OyAvLyBbbl1bbF1bbV1bel1beF1cclxuICBwcml2YXRlIHJlYWRvbmx5IHN1bXM6IEFycmF5PEFycmF5PG51bWJlcj4+OyAvLyByZXVzYWJsZSBhcnJheSBmb3IgY29tcHV0aW5nIHN1bXNcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBjZWxsV2lkdGg6IG51bWJlcjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNlbGxIZWlnaHQ6IG51bWJlcjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNlbGxEZXB0aDogbnVtYmVyO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gaHlkcm9nZW5BdG9tXHJcbiAgICogQHBhcmFtIHpvb21lZEluQm94Qm91bmRzIC0gaW4gdmlldyBjb29yZGluYXRlc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggaHlkcm9nZW5BdG9tOiBTY2hyb2Rpbmdlck1vZGVsLCB6b29tZWRJbkJveEJvdW5kczogQm91bmRzMiApIHtcclxuXHJcbiAgICB0aGlzLmh5ZHJvZ2VuQXRvbSA9IGh5ZHJvZ2VuQXRvbTtcclxuXHJcbiAgICBjb25zdCBuTWF4ID0gU2Nocm9kaW5nZXJNb2RlbC5nZXROdW1iZXJPZlN0YXRlcygpO1xyXG5cclxuICAgIC8vIEluaXRpYWxpemUgYnJpZ2h0bmVzcyBlbnRyaWVzIHRvIG51bGxcclxuICAgIC8vVE9ETyB0aGlzIGlzIHNvIHVnbHksIHBvcnRlZCBmcm9tIEphdmFcclxuICAgIHRoaXMuY2FjaGUgPSBBcnJheSggbk1heCApO1xyXG4gICAgZm9yICggbGV0IG4gPSAxOyBuIDw9IG5NYXg7IG4rKyApIHtcclxuICAgICAgY29uc3QgbFNpemUgPSBuO1xyXG4gICAgICB0aGlzLmNhY2hlWyBuIC0gMSBdID0gQXJyYXkoIGxTaXplICk7XHJcbiAgICAgIGZvciAoIGxldCBsID0gMDsgbCA8IGxTaXplOyBsKysgKSB7XHJcbiAgICAgICAgY29uc3QgbVNpemUgPSBsICsgMTtcclxuICAgICAgICB0aGlzLmNhY2hlWyBuIC0gMSBdWyBsIF0gPSBBcnJheSggbVNpemUgKTtcclxuICAgICAgICBmb3IgKCBsZXQgbSA9IDA7IG0gPCBsICsgMTsgbSsrICkge1xyXG4gICAgICAgICAgY29uc3QgelNpemUgPSBOVU1CRVJfT0ZfVkVSVElDQUxfQ0VMTFM7XHJcbiAgICAgICAgICB0aGlzLmNhY2hlWyBuIC0gMSBdWyBsIF1bIG0gXSA9IEFycmF5KCB6U2l6ZSApO1xyXG4gICAgICAgICAgZm9yICggbGV0IHogPSAwOyB6IDwgelNpemU7IHorKyApIHtcclxuICAgICAgICAgICAgZm9yICggbGV0IHggPSAwOyB4IDwgTlVNQkVSX09GX0hPUklaT05UQUxfQ0VMTFM7IHgrKyApIHtcclxuICAgICAgICAgICAgICB0aGlzLmNhY2hlWyBuIC0gMSBdWyBsIF1bIG0gXSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBJbml0aWFsaXplIHN1bXMgd2l0aCB6ZXJvc1xyXG4gICAgLy9UT0RPIHRoaXMgaXMgc28gdWdseVxyXG4gICAgdGhpcy5zdW1zID0gQXJyYXkoIE5VTUJFUl9PRl9WRVJUSUNBTF9DRUxMUyApO1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgTlVNQkVSX09GX1ZFUlRJQ0FMX0NFTExTOyBpKysgKSB7XHJcbiAgICAgIHRoaXMuc3Vtc1sgaSBdID0gQXJyYXkoIE5VTUJFUl9PRl9IT1JJWk9OVEFMX0NFTExTICkuZmlsbCggMCApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDNEIGNlbGwgc2l6ZVxyXG4gICAgdGhpcy5jZWxsV2lkdGggPSAoIHpvb21lZEluQm94Qm91bmRzLndpZHRoIC8gTlVNQkVSX09GX0hPUklaT05UQUxfQ0VMTFMgKSAvIDI7XHJcbiAgICB0aGlzLmNlbGxIZWlnaHQgPSAoIHpvb21lZEluQm94Qm91bmRzLmhlaWdodCAvIE5VTUJFUl9PRl9WRVJUSUNBTF9DRUxMUyApIC8gMjtcclxuICAgIHRoaXMuY2VsbERlcHRoID0gKCB6b29tZWRJbkJveEJvdW5kcy5oZWlnaHQgLyBOVU1CRVJfT0ZfREVQVEhfQ0VMTFMgKSAvIDI7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSAyRCBicmlnaHRuZXNzIGZvciBhIHN0YXRlLiBJZiBpdCdzIG5vdCBhbHJlYWR5IGNhY2hlZCwgY29tcHV0ZSBpdC5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0QnJpZ2h0bmVzcyggbjogbnVtYmVyLCBsOiBudW1iZXIsIG06IG51bWJlciApOiBudW1iZXJbXVtdIHtcclxuICAgIGxldCBicmlnaHRuZXNzOiBudW1iZXJbXVtdIHwgbnVsbCA9IHRoaXMuY2FjaGVbIG4gLSAxIF1bIGwgXVsgbSBdO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggYnJpZ2h0bmVzcyAhPT0gdW5kZWZpbmVkICk7XHJcbiAgICBpZiAoIGJyaWdodG5lc3MgPT09IG51bGwgKSB7XHJcbiAgICAgIGJyaWdodG5lc3MgPSB0aGlzLmNvbXB1dGVCcmlnaHRuZXNzKCBuLCBsLCBtICk7XHJcbiAgICAgIHRoaXMuY2FjaGVbIG4gLSAxIF1bIGwgXVsgbSBdID0gYnJpZ2h0bmVzcztcclxuICAgIH1cclxuICAgIHJldHVybiBicmlnaHRuZXNzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29tcHV0ZXMgdGhlIDJEIGJyaWdodG5lc3MgZm9yIGEgc3RhdGUuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjb21wdXRlQnJpZ2h0bmVzcyggbjogbnVtYmVyLCBsOiBudW1iZXIsIG06IG51bWJlciApOiBudW1iZXJbXVtdIHtcclxuXHJcbiAgICAvLyAyRCBhcnJheSBmaWxsZWQgd2l0aCB6ZXJvc1xyXG4gICAgY29uc3QgYnJpZ2h0bmVzcyA9IEFycmF5KCBOVU1CRVJfT0ZfVkVSVElDQUxfQ0VMTFMgKTtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IE5VTUJFUl9PRl9WRVJUSUNBTF9DRUxMUzsgaSsrICkge1xyXG4gICAgICBicmlnaHRuZXNzWyBpIF0gPSBBcnJheSggTlVNQkVSX09GX0hPUklaT05UQUxfQ0VMTFMgKS5maWxsKCAwICk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IG1heFN1bSA9IDA7XHJcblxyXG4gICAgZm9yICggbGV0IHJvdyA9IDA7IHJvdyA8IE5VTUJFUl9PRl9WRVJUSUNBTF9DRUxMUzsgcm93KysgKSB7XHJcbiAgICAgIGNvbnN0IHogPSAoIHJvdyAqIHRoaXMuY2VsbEhlaWdodCApICsgKCB0aGlzLmNlbGxIZWlnaHQgLyAyICk7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHogPiAwICk7XHJcbiAgICAgIGZvciAoIGxldCBjb2x1bW4gPSAwOyBjb2x1bW4gPCBOVU1CRVJfT0ZfSE9SSVpPTlRBTF9DRUxMUzsgY29sdW1uKysgKSB7XHJcbiAgICAgICAgY29uc3QgeCA9ICggY29sdW1uICogdGhpcy5jZWxsV2lkdGggKSArICggdGhpcy5jZWxsV2lkdGggLyAyICk7XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggeCA+IDAgKTtcclxuICAgICAgICBsZXQgc3VtID0gMDtcclxuICAgICAgICBmb3IgKCBsZXQgZGVwdGggPSAwOyBkZXB0aCA8IE5VTUJFUl9PRl9ERVBUSF9DRUxMUzsgZGVwdGgrKyApIHtcclxuICAgICAgICAgIGNvbnN0IHkgPSAoIGRlcHRoICogdGhpcy5jZWxsRGVwdGggKSArICggdGhpcy5jZWxsRGVwdGggLyAyICk7XHJcbiAgICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCB5ID4gMCApO1xyXG4gICAgICAgICAgY29uc3QgcHJvYmFiaWxpdHlEZW5zaXR5ID0gdGhpcy5oeWRyb2dlbkF0b20uZ2V0UHJvYmFiaWxpdHlEZW5zaXR5KCBuLCBsLCBtLCB4LCB5LCB6ICk7XHJcbiAgICAgICAgICBzdW0gKz0gcHJvYmFiaWxpdHlEZW5zaXR5O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnN1bXNbIHJvdyBdWyBjb2x1bW4gXSA9IHN1bTtcclxuICAgICAgICBpZiAoIHN1bSA+IG1heFN1bSApIHtcclxuICAgICAgICAgIG1heFN1bSA9IHN1bTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmb3IgKCBsZXQgcm93ID0gMDsgcm93IDwgTlVNQkVSX09GX1ZFUlRJQ0FMX0NFTExTOyByb3crKyApIHtcclxuICAgICAgZm9yICggbGV0IGNvbHVtbiA9IDA7IGNvbHVtbiA8IE5VTUJFUl9PRl9IT1JJWk9OVEFMX0NFTExTOyBjb2x1bW4rKyApIHtcclxuICAgICAgICBsZXQgYiA9IDA7XHJcbiAgICAgICAgaWYgKCBtYXhTdW0gPiAwICkge1xyXG4gICAgICAgICAgYiA9IHRoaXMuc3Vtc1sgcm93IF1bIGNvbHVtbiBdIC8gbWF4U3VtO1xyXG4gICAgICAgIH1cclxuICAgICAgICBicmlnaHRuZXNzWyByb3cgXVsgY29sdW1uIF0gPSBiO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGJyaWdodG5lc3M7XHJcbiAgfVxyXG59XHJcblxyXG5tb2RlbHNPZlRoZUh5ZHJvZ2VuQXRvbS5yZWdpc3RlciggJ1NjaHJvZGluZ2VyQnJpZ2h0bmVzcycsIFNjaHJvZGluZ2VyQnJpZ2h0bmVzcyApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGdCQUFnQixNQUFNLDhCQUE4QjtBQUMzRCxPQUFPQyx1QkFBdUIsTUFBTSxrQ0FBa0M7QUFHdEUsTUFBTUMsMEJBQTBCLEdBQUcsRUFBRTtBQUNyQyxNQUFNQyx3QkFBd0IsR0FBR0QsMEJBQTBCO0FBQzNELE1BQU1FLHFCQUFxQixHQUFHRiwwQkFBMEI7QUFFeEQsZUFBZSxNQUFNRyxxQkFBcUIsQ0FBQztFQUlpQztFQUM3Qjs7RUFNN0M7QUFDRjtBQUNBO0FBQ0E7RUFDU0MsV0FBV0EsQ0FBRUMsWUFBOEIsRUFBRUMsaUJBQTBCLEVBQUc7SUFFL0UsSUFBSSxDQUFDRCxZQUFZLEdBQUdBLFlBQVk7SUFFaEMsTUFBTUUsSUFBSSxHQUFHVCxnQkFBZ0IsQ0FBQ1UsaUJBQWlCLENBQUMsQ0FBQzs7SUFFakQ7SUFDQTtJQUNBLElBQUksQ0FBQ0MsS0FBSyxHQUFHQyxLQUFLLENBQUVILElBQUssQ0FBQztJQUMxQixLQUFNLElBQUlJLENBQUMsR0FB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