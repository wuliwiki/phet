// Copyright 2018-2021, University of Colorado Boulder

/**
 * Supertype for container nodes that show and track individual cell nodes (i.e. NOT the beaker container).
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { DragListener } from '../../../../scenery/js/imports.js';
import FractionsCommonColors from '../../common/view/FractionsCommonColors.js';
import fractionsCommon from '../../fractionsCommon.js';
import CellEntry from './CellEntry.js';
import ContainerNode from './ContainerNode.js';
class CellContainerNode extends ContainerNode {
  /**
   * @param {Container} container
   * @param {Object} [options]
   */
  constructor(container, options) {
    super(container, options);

    // @protected {Array.<CellEntry>}
    this.cellEntries = [];

    // @private {function}
    this.rebuildListener = this.rebuild.bind(this);
    this.container.cells.lengthProperty.lazyLink(this.rebuildListener);

    // @private {Property.<Color>}
    this.strokeProperty = new DerivedProperty([container.filledCellCountProperty, FractionsCommonColors.introContainerActiveBorderProperty, FractionsCommonColors.introContainerInactiveBorderProperty], (count, activeColor, inactiveColor) => {
      return count > 0 ? activeColor : inactiveColor;
    });
  }

  /**
   * Rebuilds the full container (required when the number of cells changes).
   * @protected
   */
  rebuild() {
    this.removeCellNodes();

    // Subtypes will override the main content
  }

  /**
   * Return the midpoint offset of this node.
   * @public
   * @override
   *
   * @param {number} index
   * @returns {Vector2}
   */
  getMidpointByIndex(index) {
    const cellEntry = this.cellEntries[index];
    if (cellEntry) {
      return cellEntry.node.translation;
    } else {
      return Vector2.ZERO;
    }
  }

  /**
   * Adds in a cell node, setting up listeners
   * @protected
   *
   * @param {Cell} cell
   * @param {Node} node
   */
  addCellNode(cell, node) {
    this.cellEntries.push(new CellEntry(cell, node));
    this.addChild(node);
    node.cursor = 'pointer';
    node.addInputListener(DragListener.createForwardingListener(event => this.cellDownCallback(cell, event)));
  }

  /**
   * Removes all of the cell nodes, and detaches their listeners.
   * @private
   */
  removeCellNodes() {
    while (this.cellEntries.length) {
      const cellEntry = this.cellEntries.pop();
      this.removeChild(cellEntry.node);
      cellEntry.dispose();
    }
  }

  /**
   * Releases references.
   * @public
   * @override
   */
  dispose() {
    this.removeCellNodes();
    this.container.cells.lengthProperty.unlink(this.rebuildListener);
    this.strokeProperty.dispose();
    super.dispose();
  }
}
fractionsCommon.register('CellContainerNode', CellContainerNode);
export default CellContainerNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJWZWN0b3IyIiwiRHJhZ0xpc3RlbmVyIiwiRnJhY3Rpb25zQ29tbW9uQ29sb3JzIiwiZnJhY3Rpb25zQ29tbW9uIiwiQ2VsbEVudHJ5IiwiQ29udGFpbmVyTm9kZSIsIkNlbGxDb250YWluZXJOb2RlIiwiY29uc3RydWN0b3IiLCJjb250YWluZXIiLCJvcHRpb25zIiwiY2VsbEVudHJpZXMiLCJyZWJ1aWxkTGlzdGVuZXIiLCJyZWJ1aWxkIiwiYmluZCIsImNlbGxzIiwibGVuZ3RoUHJvcGVydHkiLCJsYXp5TGluayIsInN0cm9rZVByb3BlcnR5IiwiZmlsbGVkQ2VsbENvdW50UHJvcGVydHkiLCJpbnRyb0NvbnRhaW5lckFjdGl2ZUJvcmRlclByb3BlcnR5IiwiaW50cm9Db250YWluZXJJbmFjdGl2ZUJvcmRlclByb3BlcnR5IiwiY291bnQiLCJhY3RpdmVDb2xvciIsImluYWN0aXZlQ29sb3IiLCJyZW1vdmVDZWxsTm9kZXMiLCJnZXRNaWRwb2ludEJ5SW5kZXgiLCJpbmRleCIsImNlbGxFbnRyeSIsIm5vZGUiLCJ0cmFuc2xhdGlvbiIsIlpFUk8iLCJhZGRDZWxsTm9kZSIsImNlbGwiLCJwdXNoIiwiYWRkQ2hpbGQiLCJjdXJzb3IiLCJhZGRJbnB1dExpc3RlbmVyIiwiY3JlYXRlRm9yd2FyZGluZ0xpc3RlbmVyIiwiZXZlbnQiLCJjZWxsRG93bkNhbGxiYWNrIiwibGVuZ3RoIiwicG9wIiwicmVtb3ZlQ2hpbGQiLCJkaXNwb3NlIiwidW5saW5rIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJDZWxsQ29udGFpbmVyTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDIxLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTdXBlcnR5cGUgZm9yIGNvbnRhaW5lciBub2RlcyB0aGF0IHNob3cgYW5kIHRyYWNrIGluZGl2aWR1YWwgY2VsbCBub2RlcyAoaS5lLiBOT1QgdGhlIGJlYWtlciBjb250YWluZXIpLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvbmF0aGFuIE9sc29uIDxqb25hdGhhbi5vbHNvbkBjb2xvcmFkby5lZHU+XHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgRHJhZ0xpc3RlbmVyIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEZyYWN0aW9uc0NvbW1vbkNvbG9ycyBmcm9tICcuLi8uLi9jb21tb24vdmlldy9GcmFjdGlvbnNDb21tb25Db2xvcnMuanMnO1xyXG5pbXBvcnQgZnJhY3Rpb25zQ29tbW9uIGZyb20gJy4uLy4uL2ZyYWN0aW9uc0NvbW1vbi5qcyc7XHJcbmltcG9ydCBDZWxsRW50cnkgZnJvbSAnLi9DZWxsRW50cnkuanMnO1xyXG5pbXBvcnQgQ29udGFpbmVyTm9kZSBmcm9tICcuL0NvbnRhaW5lck5vZGUuanMnO1xyXG5cclxuY2xhc3MgQ2VsbENvbnRhaW5lck5vZGUgZXh0ZW5kcyBDb250YWluZXJOb2RlIHtcclxuICAvKipcclxuICAgKiBAcGFyYW0ge0NvbnRhaW5lcn0gY29udGFpbmVyXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBjb250YWluZXIsIG9wdGlvbnMgKSB7XHJcbiAgICBzdXBlciggY29udGFpbmVyLCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gQHByb3RlY3RlZCB7QXJyYXkuPENlbGxFbnRyeT59XHJcbiAgICB0aGlzLmNlbGxFbnRyaWVzID0gW107XHJcblxyXG4gICAgLy8gQHByaXZhdGUge2Z1bmN0aW9ufVxyXG4gICAgdGhpcy5yZWJ1aWxkTGlzdGVuZXIgPSB0aGlzLnJlYnVpbGQuYmluZCggdGhpcyApO1xyXG4gICAgdGhpcy5jb250YWluZXIuY2VsbHMubGVuZ3RoUHJvcGVydHkubGF6eUxpbmsoIHRoaXMucmVidWlsZExpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge1Byb3BlcnR5LjxDb2xvcj59XHJcbiAgICB0aGlzLnN0cm9rZVByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggW1xyXG4gICAgICBjb250YWluZXIuZmlsbGVkQ2VsbENvdW50UHJvcGVydHksXHJcbiAgICAgIEZyYWN0aW9uc0NvbW1vbkNvbG9ycy5pbnRyb0NvbnRhaW5lckFjdGl2ZUJvcmRlclByb3BlcnR5LFxyXG4gICAgICBGcmFjdGlvbnNDb21tb25Db2xvcnMuaW50cm9Db250YWluZXJJbmFjdGl2ZUJvcmRlclByb3BlcnR5XHJcbiAgICBdLCAoIGNvdW50LCBhY3RpdmVDb2xvciwgaW5hY3RpdmVDb2xvciApID0+IHtcclxuICAgICAgcmV0dXJuIGNvdW50ID4gMCA/IGFjdGl2ZUNvbG9yIDogaW5hY3RpdmVDb2xvcjtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlYnVpbGRzIHRoZSBmdWxsIGNvbnRhaW5lciAocmVxdWlyZWQgd2hlbiB0aGUgbnVtYmVyIG9mIGNlbGxzIGNoYW5nZXMpLlxyXG4gICAqIEBwcm90ZWN0ZWRcclxuICAgKi9cclxuICByZWJ1aWxkKCkge1xyXG4gICAgdGhpcy5yZW1vdmVDZWxsTm9kZXMoKTtcclxuXHJcbiAgICAvLyBTdWJ0eXBlcyB3aWxsIG92ZXJyaWRlIHRoZSBtYWluIGNvbnRlbnRcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybiB0aGUgbWlkcG9pbnQgb2Zmc2V0IG9mIHRoaXMgbm9kZS5cclxuICAgKiBAcHVibGljXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge251bWJlcn0gaW5kZXhcclxuICAgKiBAcmV0dXJucyB7VmVjdG9yMn1cclxuICAgKi9cclxuICBnZXRNaWRwb2ludEJ5SW5kZXgoIGluZGV4ICkge1xyXG4gICAgY29uc3QgY2VsbEVudHJ5ID0gdGhpcy5jZWxsRW50cmllc1sgaW5kZXggXTtcclxuICAgIGlmICggY2VsbEVudHJ5ICkge1xyXG4gICAgICByZXR1cm4gY2VsbEVudHJ5Lm5vZGUudHJhbnNsYXRpb247XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgcmV0dXJuIFZlY3RvcjIuWkVSTztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZHMgaW4gYSBjZWxsIG5vZGUsIHNldHRpbmcgdXAgbGlzdGVuZXJzXHJcbiAgICogQHByb3RlY3RlZFxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtDZWxsfSBjZWxsXHJcbiAgICogQHBhcmFtIHtOb2RlfSBub2RlXHJcbiAgICovXHJcbiAgYWRkQ2VsbE5vZGUoIGNlbGwsIG5vZGUgKSB7XHJcbiAgICB0aGlzLmNlbGxFbnRyaWVzLnB1c2goIG5ldyBDZWxsRW50cnkoIGNlbGwsIG5vZGUgKSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbm9kZSApO1xyXG5cclxuICAgIG5vZGUuY3Vyc29yID0gJ3BvaW50ZXInO1xyXG4gICAgbm9kZS5hZGRJbnB1dExpc3RlbmVyKCBEcmFnTGlzdGVuZXIuY3JlYXRlRm9yd2FyZGluZ0xpc3RlbmVyKCBldmVudCA9PiB0aGlzLmNlbGxEb3duQ2FsbGJhY2soIGNlbGwsIGV2ZW50ICkgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVtb3ZlcyBhbGwgb2YgdGhlIGNlbGwgbm9kZXMsIGFuZCBkZXRhY2hlcyB0aGVpciBsaXN0ZW5lcnMuXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICByZW1vdmVDZWxsTm9kZXMoKSB7XHJcbiAgICB3aGlsZSAoIHRoaXMuY2VsbEVudHJpZXMubGVuZ3RoICkge1xyXG4gICAgICBjb25zdCBjZWxsRW50cnkgPSB0aGlzLmNlbGxFbnRyaWVzLnBvcCgpO1xyXG4gICAgICB0aGlzLnJlbW92ZUNoaWxkKCBjZWxsRW50cnkubm9kZSApO1xyXG4gICAgICBjZWxsRW50cnkuZGlzcG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVsZWFzZXMgcmVmZXJlbmNlcy5cclxuICAgKiBAcHVibGljXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICovXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIHRoaXMucmVtb3ZlQ2VsbE5vZGVzKCk7XHJcbiAgICB0aGlzLmNvbnRhaW5lci5jZWxscy5sZW5ndGhQcm9wZXJ0eS51bmxpbmsoIHRoaXMucmVidWlsZExpc3RlbmVyICk7XHJcbiAgICB0aGlzLnN0cm9rZVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuXHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5mcmFjdGlvbnNDb21tb24ucmVnaXN0ZXIoICdDZWxsQ29udGFpbmVyTm9kZScsIENlbGxDb250YWluZXJOb2RlICk7XHJcbmV4cG9ydCBkZWZhdWx0IENlbGxDb250YWluZXJOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsU0FBU0MsWUFBWSxRQUFRLG1DQUFtQztBQUNoRSxPQUFPQyxxQkFBcUIsTUFBTSw0Q0FBNEM7QUFDOUUsT0FBT0MsZUFBZSxNQUFNLDBCQUEwQjtBQUN0RCxPQUFPQyxTQUFTLE1BQU0sZ0JBQWdCO0FBQ3RDLE9BQU9DLGFBQWEsTUFBTSxvQkFBb0I7QUFFOUMsTUFBTUMsaUJBQWlCLFNBQVNELGFBQWEsQ0FBQztFQUM1QztBQUNGO0FBQ0E7QUFDQTtFQUNFRSxXQUFXQSxDQUFFQyxTQUFTLEVBQUVDLE9BQU8sRUFBRztJQUNoQyxLQUFLLENBQUVELFNBQVMsRUFBRUMsT0FBUSxDQUFDOztJQUUzQjtJQUNBLElBQUksQ0FBQ0MsV0FB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