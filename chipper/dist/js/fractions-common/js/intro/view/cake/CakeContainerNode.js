// Copyright 2018-2022, University of Colorado Boulder

/**
 * Container for the cake representation
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import { Shape } from '../../../../../kite/js/imports.js';
import { Path } from '../../../../../scenery/js/imports.js';
import fractionsCommon from '../../../fractionsCommon.js';
import CellContainerNode from '../CellContainerNode.js';
import CakeNode from './CakeNode.js';

// The order of indices for visual layering (for each denominator)
const layerOrder = {
  1: [0],
  2: [1, 0],
  3: [0, 1, 2],
  4: [0, 1, 2, 3],
  5: [1, 0, 2, 4, 3],
  6: [1, 0, 2, 3, 5, 4],
  7: [1, 0, 2, 3, 4, 6, 5],
  8: [1, 0, 2, 3, 4, 5, 7, 6]
};
const baseEllipseShape = Shape.segments([CakeNode.BASE_ELLIPSE], true).makeImmutable();
class CakeContainerNode extends CellContainerNode {
  /**
   * @param {Container} container
   * @param {Object} [options]
   */
  constructor(container, options) {
    super(container, options);

    // The shape of the ellipse is determined empirically based on the image
    this.addChild(new Path(baseEllipseShape, {
      fill: 'white',
      stroke: this.strokeProperty,
      scale: CakeNode.CAKE_DEFAULT_SCALE,
      translation: CakeNode.CAKE_OFFSET.negated()
    }));

    // @private {Path}
    this.gridPath = new Path(null, {
      stroke: this.strokeProperty,
      scale: CakeNode.CAKE_DEFAULT_SCALE,
      localBounds: CakeNode.CAKE_IMAGE_BOUNDS,
      translation: CakeNode.CAKE_OFFSET.negated()
    });
    this.addChild(this.gridPath);
    this.rebuild();
    this.mutate(options);
  }

  /**
   * Rebuilds the full container (required when the number of cells changes).
   * @protected
   * @override
   */
  rebuild() {
    super.rebuild();
    const denominator = this.container.cells.length;
    const gridShape = new Shape();
    for (let i = 0; i < denominator; i++) {
      const endPoint = CakeNode.getBaseIntersection(CakeNode.getStartAngle(denominator, i)).point;
      gridShape.moveToPoint(CakeNode.BASE_ELLIPSE_OFFSET_CENTER.blend(endPoint, 0.001)); // Work around chrome crash
      gridShape.lineToPoint(endPoint);
    }
    this.gridPath.shape = denominator > 1 ? gridShape : null;
    for (let i = 0; i < denominator; i++) {
      const index = layerOrder[denominator][i];
      const cell = this.container.cells.get(index);
      const cellNode = new CakeNode(denominator, index);
      cellNode.translation = cellNode.getOffset();
      this.addCellNode(cell, cellNode);
    }
  }

  /**
   * Return the midpoint offset of this node.
   * @public
   * @override
   *
   * @param {number} index
   * @returns {Vector2}
   */
  getMidpointByIndex(index) {
    return this.cellEntries[layerOrder[this.container.cells.length][index]].node.translation;
  }
}
fractionsCommon.register('CakeContainerNode', CakeContainerNode);
export default CakeContainerNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaGFwZSIsIlBhdGgiLCJmcmFjdGlvbnNDb21tb24iLCJDZWxsQ29udGFpbmVyTm9kZSIsIkNha2VOb2RlIiwibGF5ZXJPcmRlciIsImJhc2VFbGxpcHNlU2hhcGUiLCJzZWdtZW50cyIsIkJBU0VfRUxMSVBTRSIsIm1ha2VJbW11dGFibGUiLCJDYWtlQ29udGFpbmVyTm9kZSIsImNvbnN0cnVjdG9yIiwiY29udGFpbmVyIiwib3B0aW9ucyIsImFkZENoaWxkIiwiZmlsbCIsInN0cm9rZSIsInN0cm9rZVByb3BlcnR5Iiwic2NhbGUiLCJDQUtFX0RFRkFVTFRfU0NBTEUiLCJ0cmFuc2xhdGlvbiIsIkNBS0VfT0ZGU0VUIiwibmVnYXRlZCIsImdyaWRQYXRoIiwibG9jYWxCb3VuZHMiLCJDQUtFX0lNQUdFX0JPVU5EUyIsInJlYnVpbGQiLCJtdXRhdGUiLCJkZW5vbWluYXRvciIsImNlbGxzIiwibGVuZ3RoIiwiZ3JpZFNoYXBlIiwiaSIsImVuZFBvaW50IiwiZ2V0QmFzZUludGVyc2VjdGlvbiIsImdldFN0YXJ0QW5nbGUiLCJwb2ludCIsIm1vdmVUb1BvaW50IiwiQkFTRV9FTExJUFNFX09GRlNFVF9DRU5URVIiLCJibGVuZCIsImxpbmVUb1BvaW50Iiwic2hhcGUiLCJpbmRleCIsImNlbGwiLCJnZXQiLCJjZWxsTm9kZSIsImdldE9mZnNldCIsImFkZENlbGxOb2RlIiwiZ2V0TWlkcG9pbnRCeUluZGV4IiwiY2VsbEVudHJpZXMiLCJub2RlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJDYWtlQ29udGFpbmVyTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBDb250YWluZXIgZm9yIHRoZSBjYWtlIHJlcHJlc2VudGF0aW9uXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCB7IFBhdGggfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZnJhY3Rpb25zQ29tbW9uIGZyb20gJy4uLy4uLy4uL2ZyYWN0aW9uc0NvbW1vbi5qcyc7XHJcbmltcG9ydCBDZWxsQ29udGFpbmVyTm9kZSBmcm9tICcuLi9DZWxsQ29udGFpbmVyTm9kZS5qcyc7XHJcbmltcG9ydCBDYWtlTm9kZSBmcm9tICcuL0Nha2VOb2RlLmpzJztcclxuXHJcbi8vIFRoZSBvcmRlciBvZiBpbmRpY2VzIGZvciB2aXN1YWwgbGF5ZXJpbmcgKGZvciBlYWNoIGRlbm9taW5hdG9yKVxyXG5jb25zdCBsYXllck9yZGVyID0ge1xyXG4gIDE6IFsgMCBdLFxyXG4gIDI6IFsgMSwgMCBdLFxyXG4gIDM6IFsgMCwgMSwgMiBdLFxyXG4gIDQ6IFsgMCwgMSwgMiwgMyBdLFxyXG4gIDU6IFsgMSwgMCwgMiwgNCwgMyBdLFxyXG4gIDY6IFsgMSwgMCwgMiwgMywgNSwgNCBdLFxyXG4gIDc6IFsgMSwgMCwgMiwgMywgNCwgNiwgNSBdLFxyXG4gIDg6IFsgMSwgMCwgMiwgMywgNCwgNSwgNywgNiBdXHJcbn07XHJcbmNvbnN0IGJhc2VFbGxpcHNlU2hhcGUgPSBTaGFwZS5zZWdtZW50cyggWyBDYWtlTm9kZS5CQVNFX0VMTElQU0UgXSwgdHJ1ZSApLm1ha2VJbW11dGFibGUoKTtcclxuXHJcbmNsYXNzIENha2VDb250YWluZXJOb2RlIGV4dGVuZHMgQ2VsbENvbnRhaW5lck5vZGUge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7Q29udGFpbmVyfSBjb250YWluZXJcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGNvbnRhaW5lciwgb3B0aW9ucyApIHtcclxuICAgIHN1cGVyKCBjb250YWluZXIsIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBUaGUgc2hhcGUgb2YgdGhlIGVsbGlwc2UgaXMgZGV0ZXJtaW5lZCBlbXBpcmljYWxseSBiYXNlZCBvbiB0aGUgaW1hZ2VcclxuICAgIHRoaXMuYWRkQ2hpbGQoIG5ldyBQYXRoKCBiYXNlRWxsaXBzZVNoYXBlLCB7XHJcbiAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICAgIHN0cm9rZTogdGhpcy5zdHJva2VQcm9wZXJ0eSxcclxuICAgICAgc2NhbGU6IENha2VOb2RlLkNBS0VfREVGQVVMVF9TQ0FMRSxcclxuICAgICAgdHJhbnNsYXRpb246IENha2VOb2RlLkNBS0VfT0ZGU0VULm5lZ2F0ZWQoKVxyXG4gICAgfSApICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge1BhdGh9XHJcbiAgICB0aGlzLmdyaWRQYXRoID0gbmV3IFBhdGgoIG51bGwsIHtcclxuICAgICAgc3Ryb2tlOiB0aGlzLnN0cm9rZVByb3BlcnR5LFxyXG4gICAgICBzY2FsZTogQ2FrZU5vZGUuQ0FLRV9ERUZBVUxUX1NDQUxFLFxyXG4gICAgICBsb2NhbEJvdW5kczogQ2FrZU5vZGUuQ0FLRV9JTUFHRV9CT1VORFMsXHJcbiAgICAgIHRyYW5zbGF0aW9uOiBDYWtlTm9kZS5DQUtFX09GRlNFVC5uZWdhdGVkKClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuZ3JpZFBhdGggKTtcclxuXHJcbiAgICB0aGlzLnJlYnVpbGQoKTtcclxuICAgIHRoaXMubXV0YXRlKCBvcHRpb25zICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZWJ1aWxkcyB0aGUgZnVsbCBjb250YWluZXIgKHJlcXVpcmVkIHdoZW4gdGhlIG51bWJlciBvZiBjZWxscyBjaGFuZ2VzKS5cclxuICAgKiBAcHJvdGVjdGVkXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICovXHJcbiAgcmVidWlsZCgpIHtcclxuICAgIHN1cGVyLnJlYnVpbGQoKTtcclxuXHJcbiAgICBjb25zdCBkZW5vbWluYXRvciA9IHRoaXMuY29udGFpbmVyLmNlbGxzLmxlbmd0aDtcclxuXHJcbiAgICBjb25zdCBncmlkU2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGRlbm9taW5hdG9yOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IGVuZFBvaW50ID0gQ2FrZU5vZGUuZ2V0QmFzZUludGVyc2VjdGlvbiggQ2FrZU5vZGUuZ2V0U3RhcnRBbmdsZSggZGVub21pbmF0b3IsIGkgKSApLnBvaW50O1xyXG4gICAgICBncmlkU2hhcGUubW92ZVRvUG9pbnQoIENha2VOb2RlLkJBU0VfRUxMSVBTRV9PRkZTRVRfQ0VOVEVSLmJsZW5kKCBlbmRQb2ludCwgMC4wMDEgKSApOyAvLyBXb3JrIGFyb3VuZCBjaHJvbWUgY3Jhc2hcclxuICAgICAgZ3JpZFNoYXBlLmxpbmVUb1BvaW50KCBlbmRQb2ludCApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5ncmlkUGF0aC5zaGFwZSA9IGRlbm9taW5hdG9yID4gMSA/IGdyaWRTaGFwZSA6IG51bGw7XHJcblxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgZGVub21pbmF0b3I7IGkrKyApIHtcclxuICAgICAgY29uc3QgaW5kZXggPSBsYXllck9yZGVyWyBkZW5vbWluYXRvciBdWyBpIF07XHJcbiAgICAgIGNvbnN0IGNlbGwgPSB0aGlzLmNvbnRhaW5lci5jZWxscy5nZXQoIGluZGV4ICk7XHJcblxyXG4gICAgICBjb25zdCBjZWxsTm9kZSA9IG5ldyBDYWtlTm9kZSggZGVub21pbmF0b3IsIGluZGV4ICk7XHJcbiAgICAgIGNlbGxOb2RlLnRyYW5zbGF0aW9uID0gY2VsbE5vZGUuZ2V0T2Zmc2V0KCk7XHJcblxyXG4gICAgICB0aGlzLmFkZENlbGxOb2RlKCBjZWxsLCBjZWxsTm9kZSApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJuIHRoZSBtaWRwb2ludCBvZmZzZXQgb2YgdGhpcyBub2RlLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleFxyXG4gICAqIEByZXR1cm5zIHtWZWN0b3IyfVxyXG4gICAqL1xyXG4gIGdldE1pZHBvaW50QnlJbmRleCggaW5kZXggKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jZWxsRW50cmllc1sgbGF5ZXJPcmRlclsgdGhpcy5jb250YWluZXIuY2VsbHMubGVuZ3RoIF1bIGluZGV4IF0gXS5ub2RlLnRyYW5zbGF0aW9uO1xyXG4gIH1cclxufVxyXG5cclxuZnJhY3Rpb25zQ29tbW9uLnJlZ2lzdGVyKCAnQ2FrZUNvbnRhaW5lck5vZGUnLCBDYWtlQ29udGFpbmVyTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBDYWtlQ29udGFpbmVyTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBU0EsS0FBSyxRQUFRLG1DQUFtQztBQUN6RCxTQUFTQyxJQUFJLFFBQVEsc0NBQXNDO0FBQzNELE9BQU9DLGVBQWUsTUFBTSw2QkFBNkI7QUFDekQsT0FBT0MsaUJBQWlCLE1BQU0seUJBQXlCO0FBQ3ZELE9BQU9DLFFBQVEsTUFBTSxlQUFlOztBQUVwQztBQUNBLE1BQU1DLFVBQVUsR0FBRztFQUNqQixDQUFDLEVBQUUsQ0FBRSxDQUFDLENBQUU7RUFDUixDQUFDLEVBQUUsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxDQUFFO0VBQ1gsQ0FBQyxFQUFFLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUU7RUFDZCxDQUFDLEVBQUUsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUU7RUFDakIsQ0FBQyxFQUFFLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBRTtFQUNwQixDQUFDLEVBQUUsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFB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