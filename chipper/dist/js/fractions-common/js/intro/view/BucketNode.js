// Copyright 2018-2022, University of Colorado Boulder

/**
 * Displays a bucket of pieces.
 *
 * @author Vincent Davis (Berea College)
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import Random from '../../../../dot/js/Random.js';
import merge from '../../../../phet-core/js/merge.js';
import Bucket from '../../../../phetcommon/js/model/Bucket.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import BucketFront from '../../../../scenery-phet/js/bucket/BucketFront.js';
import BucketHole from '../../../../scenery-phet/js/bucket/BucketHole.js';
import PropertyFractionNode from '../../../../scenery-phet/js/PropertyFractionNode.js';
import { DragListener, HBox, Node } from '../../../../scenery/js/imports.js';
import FractionsCommonColors from '../../common/view/FractionsCommonColors.js';
import fractionsCommon from '../../fractionsCommon.js';
import Container from '../model/Container.js';
import IntroRepresentation from '../model/IntroRepresentation.js';
import BeakerContainerNode from './beaker/BeakerContainerNode.js';
import CakeContainerNode from './cake/CakeContainerNode.js';
import CircularContainerNode from './circular/CircularContainerNode.js';
import RectangularContainerNode from './rectangular/RectangularContainerNode.js';
import RectangularOrientation from './RectangularOrientation.js';

// constants
const IDENTITY_TRANSFORM = ModelViewTransform2.createIdentity();
class BucketNode extends Node {
  /**
   * @param {Property.<number>} denominatorProperty
   * @param {function} startPieceDrag
   * @param {function} createCellNode
   * @param {Property.<IntroRepresentation>} representationProperty
   * @param {Object} [options]
   */
  constructor(denominatorProperty, startPieceDrag, createCellNode, representationProperty, options) {
    options = merge({
      bucketWidth: 355
    }, options);

    // model of the bucket
    const bucket = new Bucket({
      baseColor: FractionsCommonColors.introBucketBackgroundProperty,
      size: new Dimension2(options.bucketWidth, 125),
      invertY: true
    });

    // creates bucketNode front
    const bucketFront = new BucketFront(bucket, IDENTITY_TRANSFORM);

    // creates hole of bucketNode
    const bucketHole = new BucketHole(bucket, IDENTITY_TRANSFORM);

    // creates icon Container
    const iconContainer = new Container();

    // fills one cell according to denominator property
    iconContainer.addCells(denominatorProperty.value);
    iconContainer.cells.get(0).fill();
    const representation = representationProperty.value;
    const iconNode = {
      [IntroRepresentation.CIRCLE]() {
        return new CircularContainerNode(iconContainer);
      },
      [IntroRepresentation.HORIZONTAL_BAR]() {
        return new RectangularContainerNode(iconContainer, {
          rectangularOrientation: RectangularOrientation.HORIZONTAL
        });
      },
      [IntroRepresentation.VERTICAL_BAR]() {
        return new RectangularContainerNode(iconContainer, {
          rectangularOrientation: RectangularOrientation.VERTICAL
        });
      },
      [IntroRepresentation.CAKE]() {
        return new CakeContainerNode(iconContainer);
      },
      [IntroRepresentation.BEAKER]() {
        return new BeakerContainerNode(iconContainer);
      }
    }[representation]();
    const availableCellWidth = {
      [IntroRepresentation.CIRCLE]() {
        return options.bucketWidth - 25;
      },
      [IntroRepresentation.HORIZONTAL_BAR]() {
        return options.bucketWidth - 35;
      },
      [IntroRepresentation.VERTICAL_BAR]() {
        return options.bucketWidth - 75;
      },
      [IntroRepresentation.CAKE]() {
        return options.bucketWidth - 45;
      },
      [IntroRepresentation.BEAKER]() {
        return options.bucketWidth - 55;
      }
    }[representation]();
    const verticalCellOffset = {
      [IntroRepresentation.CIRCLE]() {
        return height => -12 + height / 6;
      },
      [IntroRepresentation.HORIZONTAL_BAR]() {
        return height => 5;
      },
      [IntroRepresentation.VERTICAL_BAR]() {
        return height => 14 - height / 7;
      },
      [IntroRepresentation.CAKE]() {
        return height => 0;
      },
      [IntroRepresentation.BEAKER]() {
        return height => -10;
      }
    }[representation]();
    const cellQuantity = {
      [IntroRepresentation.CIRCLE]() {
        return 16;
      },
      [IntroRepresentation.HORIZONTAL_BAR]() {
        return 16;
      },
      [IntroRepresentation.VERTICAL_BAR]() {
        return 16;
      },
      [IntroRepresentation.CAKE]() {
        return 8;
      },
      [IntroRepresentation.BEAKER]() {
        return 8;
      }
    }[representation]();

    // layer to hold all the static cell nodes in the bucket
    const staticLayer = new Node();
    const propertyFractionNode = new PropertyFractionNode(new NumberProperty(1), denominatorProperty, {
      scale: 0.7
    });
    bucketFront.setLabel(new HBox({
      spacing: 15,
      children: [new Node({
        maxWidth: 100,
        maxHeight: 50,
        children: [iconNode]
      }), propertyFractionNode]
    }));
    options.children = [bucketHole, staticLayer, bucketFront];
    super(options);

    // @private {Property.<number>}
    this.denominatorProperty = denominatorProperty;

    // @private {PropertyFractionNode}
    this.propertyFractionNode = propertyFractionNode;

    // @private {BucketFront}
    this.bucketFront = bucketFront;

    // @private {BucketHole}
    this.bucketHole = bucketHole;

    // @private {Node}
    this.iconNode = iconNode;

    // @private {function}
    this.denominatorListener = denominator => {
      // take denominator, and the length of the icon container
      // find the difference add/remove that many cells from the container
      const difference = denominator - iconContainer.cells.length;
      if (difference > 0) {
        //add cells
        iconContainer.addCells(difference);
      } else if (difference < 0) {
        //remove cells
        iconContainer.removeCells(-difference);
      }
      const cellNode = createCellNode(denominator, 0, {});
      const bounds = representation === IntroRepresentation.CAKE ? cellNode.bounds : cellNode.getSafeTransformedVisibleBounds();
      // We generate a well-defined random sequence so that the appearance is consistent across runs
      const random = new Random({
        seed: 4 // https://xkcd.com/221/
      });

      const left = -availableCellWidth / 2 + bounds.width / 2;
      const right = availableCellWidth / 2 - bounds.width / 2;
      const numSections = cellQuantity;
      const children = [];
      for (let i = 0; i < numSections; i++) {
        // stochastic within its rectangle, so there is a more consistent layout
        const sectionLeft = left + (right - left) * i / numSections;
        const sectionRight = left + (right - left) * (i + 1) / numSections;
        const x = sectionLeft + (sectionRight - sectionLeft) * random.nextDouble();
        const y = (random.nextDouble() - 0.5) * 20 + verticalCellOffset(bounds.height);
        children.push(new Node({
          children: [cellNode],
          translation: bucketHole.center.plusXY(x, y).minus(bounds.center)
        }));
      }
      staticLayer.children = random.shuffle(children);
    };
    this.denominatorProperty.link(this.denominatorListener);

    // add listener to the bucket and static pieces
    const bucketListener = DragListener.createForwardingListener(startPieceDrag);
    [bucketHole, staticLayer, bucketFront].forEach(node => node.addInputListener(bucketListener));
  }

  /**
   * Releases references.
   * @public
   */
  dispose() {
    this.denominatorProperty.unlink(this.denominatorListener);
    this.propertyFractionNode.dispose();
    this.bucketFront.dispose();
    this.bucketHole.dispose();
    this.iconNode.dispose();
    super.dispose();
  }
}
fractionsCommon.register('BucketNode', BucketNode);
export default BucketNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOdW1iZXJQcm9wZXJ0eSIsIkRpbWVuc2lvbjIiLCJSYW5kb20iLCJtZXJnZSIsIkJ1Y2tldCIsIk1vZGVsVmlld1RyYW5zZm9ybTIiLCJCdWNrZXRGcm9udCIsIkJ1Y2tldEhvbGUiLCJQcm9wZXJ0eUZyYWN0aW9uTm9kZSIsIkRyYWdMaXN0ZW5lciIsIkhCb3giLCJOb2RlIiwiRnJhY3Rpb25zQ29tbW9uQ29sb3JzIiwiZnJhY3Rpb25zQ29tbW9uIiwiQ29udGFpbmVyIiwiSW50cm9SZXByZXNlbnRhdGlvbiIsIkJlYWtlckNvbnRhaW5lck5vZGUiLCJDYWtlQ29udGFpbmVyTm9kZSIsIkNpcmN1bGFyQ29udGFpbmVyTm9kZSIsIlJlY3Rhbmd1bGFyQ29udGFpbmVyTm9kZSIsIlJlY3Rhbmd1bGFyT3JpZW50YXRpb24iLCJJREVOVElUWV9UUkFOU0ZPUk0iLCJjcmVhdGVJZGVudGl0eSIsIkJ1Y2tldE5vZGUiLCJjb25zdHJ1Y3RvciIsImRlbm9taW5hdG9yUHJvcGVydHkiLCJzdGFydFBpZWNlRHJhZyIsImNyZWF0ZUNlbGxOb2RlIiwicmVwcmVzZW50YXRpb25Qcm9wZXJ0eSIsIm9wdGlvbnMiLCJidWNrZXRXaWR0aCIsImJ1Y2tldCIsImJhc2VDb2xvciIsImludHJvQnVja2V0QmFja2dyb3VuZFByb3BlcnR5Iiwic2l6ZSIsImludmVydFkiLCJidWNrZXRGcm9udCIsImJ1Y2tldEhvbGUiLCJpY29uQ29udGFpbmVyIiwiYWRkQ2VsbHMiLCJ2YWx1ZSIsImNlbGxzIiwiZ2V0IiwiZmlsbCIsInJlcHJlc2VudGF0aW9uIiwiaWNvbk5vZGUiLCJDSVJDTEUiLCJIT1JJWk9OVEFMX0JBUiIsInJlY3Rhbmd1bGFyT3JpZW50YXRpb24iLCJIT1JJWk9OVEFMIiwiVkVSVElDQUxfQkFSIiwiVkVSVElDQUwiLCJDQUtFIiwiQkVBS0VSIiwiYXZhaWxhYmxlQ2VsbFdpZHRoIiwidmVydGljYWxDZWxsT2Zmc2V0IiwiaGVpZ2h0IiwiY2VsbFF1YW50aXR5Iiwic3RhdGljTGF5ZXIiLCJwcm9wZXJ0eUZyYWN0aW9uTm9kZSIsInNjYWxlIiwic2V0TGFiZWwiLCJzcGFjaW5nIiwiY2hpbGRyZW4iLCJtYXhXaWR0aCIsIm1heEhlaWdodCIsImRlbm9taW5hdG9yTGlzdGVuZXIiLCJkZW5vbWluYXRvciIsImRpZmZlcmVuY2UiLCJsZW5ndGgiLCJyZW1vdmVDZWxscyIsImNlbGxOb2RlIiwiYm91bmRzIiwiZ2V0U2FmZVRyYW5zZm9ybWVkVmlzaWJsZUJvdW5kcyIsInJhbmRvbSIsInNlZWQiLCJsZWZ0Iiwid2lkdGgiLCJyaWdodCIsIm51bVNlY3Rpb25zIiwiaSIsInNlY3Rpb25MZWZ0Iiwic2VjdGlvblJpZ2h0IiwieCIsIm5leHREb3VibGUiLCJ5IiwicHVzaCIsInRyYW5zbGF0aW9uIiwiY2VudGVyIiwicGx1c1hZIiwibWludXMiLCJzaHVmZmxlIiwibGluayIsImJ1Y2tldExpc3RlbmVyIiwiY3JlYXRlRm9yd2FyZGluZ0xpc3RlbmVyIiwiZm9yRWFjaCIsIm5vZGUiLCJhZGRJbnB1dExpc3RlbmVyIiwiZGlzcG9zZSIsInVubGluayIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQnVja2V0Tm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBEaXNwbGF5cyBhIGJ1Y2tldCBvZiBwaWVjZXMuXHJcbiAqXHJcbiAqIEBhdXRob3IgVmluY2VudCBEYXZpcyAoQmVyZWEgQ29sbGVnZSlcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IERpbWVuc2lvbjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0RpbWVuc2lvbjIuanMnO1xyXG5pbXBvcnQgUmFuZG9tIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9SYW5kb20uanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IEJ1Y2tldCBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL21vZGVsL0J1Y2tldC5qcyc7XHJcbmltcG9ydCBNb2RlbFZpZXdUcmFuc2Zvcm0yIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdmlldy9Nb2RlbFZpZXdUcmFuc2Zvcm0yLmpzJztcclxuaW1wb3J0IEJ1Y2tldEZyb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idWNrZXQvQnVja2V0RnJvbnQuanMnO1xyXG5pbXBvcnQgQnVja2V0SG9sZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvYnVja2V0L0J1Y2tldEhvbGUuanMnO1xyXG5pbXBvcnQgUHJvcGVydHlGcmFjdGlvbk5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1Byb3BlcnR5RnJhY3Rpb25Ob2RlLmpzJztcclxuaW1wb3J0IHsgRHJhZ0xpc3RlbmVyLCBIQm94LCBOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEZyYWN0aW9uc0NvbW1vbkNvbG9ycyBmcm9tICcuLi8uLi9jb21tb24vdmlldy9GcmFjdGlvbnNDb21tb25Db2xvcnMuanMnO1xyXG5pbXBvcnQgZnJhY3Rpb25zQ29tbW9uIGZyb20gJy4uLy4uL2ZyYWN0aW9uc0NvbW1vbi5qcyc7XHJcbmltcG9ydCBDb250YWluZXIgZnJvbSAnLi4vbW9kZWwvQ29udGFpbmVyLmpzJztcclxuaW1wb3J0IEludHJvUmVwcmVzZW50YXRpb24gZnJvbSAnLi4vbW9kZWwvSW50cm9SZXByZXNlbnRhdGlvbi5qcyc7XHJcbmltcG9ydCBCZWFrZXJDb250YWluZXJOb2RlIGZyb20gJy4vYmVha2VyL0JlYWtlckNvbnRhaW5lck5vZGUuanMnO1xyXG5pbXBvcnQgQ2FrZUNvbnRhaW5lck5vZGUgZnJvbSAnLi9jYWtlL0Nha2VDb250YWluZXJOb2RlLmpzJztcclxuaW1wb3J0IENpcmN1bGFyQ29udGFpbmVyTm9kZSBmcm9tICcuL2NpcmN1bGFyL0NpcmN1bGFyQ29udGFpbmVyTm9kZS5qcyc7XHJcbmltcG9ydCBSZWN0YW5ndWxhckNvbnRhaW5lck5vZGUgZnJvbSAnLi9yZWN0YW5ndWxhci9SZWN0YW5ndWxhckNvbnRhaW5lck5vZGUuanMnO1xyXG5pbXBvcnQgUmVjdGFuZ3VsYXJPcmllbnRhdGlvbiBmcm9tICcuL1JlY3Rhbmd1bGFyT3JpZW50YXRpb24uanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IElERU5USVRZX1RSQU5TRk9STSA9IE1vZGVsVmlld1RyYW5zZm9ybTIuY3JlYXRlSWRlbnRpdHkoKTtcclxuXHJcbmNsYXNzIEJ1Y2tldE5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuICAvKipcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5LjxudW1iZXI+fSBkZW5vbWluYXRvclByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3RhcnRQaWVjZURyYWdcclxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjcmVhdGVDZWxsTm9kZVxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPEludHJvUmVwcmVzZW50YXRpb24+fSByZXByZXNlbnRhdGlvblByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBkZW5vbWluYXRvclByb3BlcnR5LCBzdGFydFBpZWNlRHJhZywgY3JlYXRlQ2VsbE5vZGUsIHJlcHJlc2VudGF0aW9uUHJvcGVydHksIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcbiAgICAgIGJ1Y2tldFdpZHRoOiAzNTVcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBtb2RlbCBvZiB0aGUgYnVja2V0XHJcbiAgICBjb25zdCBidWNrZXQgPSBuZXcgQnVja2V0KCB7XHJcbiAgICAgIGJhc2VDb2xvcjogRnJhY3Rpb25zQ29tbW9uQ29sb3JzLmludHJvQnVja2V0QmFja2dyb3VuZFByb3BlcnR5LFxyXG4gICAgICBzaXplOiBuZXcgRGltZW5zaW9uMiggb3B0aW9ucy5idWNrZXRXaWR0aCwgMTI1ICksXHJcbiAgICAgIGludmVydFk6IHRydWVcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBjcmVhdGVzIGJ1Y2tldE5vZGUgZnJvbnRcclxuICAgIGNvbnN0IGJ1Y2tldEZyb250ID0gbmV3IEJ1Y2tldEZyb250KCBidWNrZXQsIElERU5USVRZX1RSQU5TRk9STSApO1xyXG5cclxuICAgIC8vIGNyZWF0ZXMgaG9sZSBvZiBidWNrZXROb2RlXHJcbiAgICBjb25zdCBidWNrZXRIb2xlID0gbmV3IEJ1Y2tldEhvbGUoIGJ1Y2tldCwgSURFTlRJVFlfVFJBTlNGT1JNICk7XHJcblxyXG4gICAgLy8gY3JlYXRlcyBpY29uIENvbnRhaW5lclxyXG4gICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoKTtcclxuXHJcbiAgICAvLyBmaWxscyBvbmUgY2VsbCBhY2NvcmRpbmcgdG8gZGVub21pbmF0b3IgcHJvcGVydHlcclxuICAgIGljb25Db250YWluZXIuYWRkQ2VsbHMoIGRlbm9taW5hdG9yUHJvcGVydHkudmFsdWUgKTtcclxuICAgIGljb25Db250YWluZXIuY2VsbHMuZ2V0KCAwICkuZmlsbCgpO1xyXG5cclxuICAgIGNvbnN0IHJlcHJlc2VudGF0aW9uID0gcmVwcmVzZW50YXRpb25Qcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICBjb25zdCBpY29uTm9kZSA9IHtcclxuICAgICAgWyBJbnRyb1JlcHJlc2VudGF0aW9uLkNJUkNMRSBdKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2lyY3VsYXJDb250YWluZXJOb2RlKCBpY29uQ29udGFpbmVyICk7XHJcbiAgICAgIH0sXHJcbiAgICAgIFsgSW50cm9SZXByZXNlbnRhdGlvbi5IT1JJWk9OVEFMX0JBUiBdKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUmVjdGFuZ3VsYXJDb250YWluZXJOb2RlKCBpY29uQ29udGFpbmVyLCB7XHJcbiAgICAgICAgICByZWN0YW5ndWxhck9yaWVudGF0aW9uOiBSZWN0YW5ndWxhck9yaWVudGF0aW9uLkhPUklaT05UQUxcclxuICAgICAgICB9ICk7XHJcbiAgICAgIH0sXHJcbiAgICAgIFsgSW50cm9SZXByZXNlbnRhdGlvbi5WRVJUSUNBTF9CQVIgXSgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFJlY3Rhbmd1bGFyQ29udGFpbmVyTm9kZSggaWNvbkNvbnRhaW5lciwge1xyXG4gICAgICAgICAgcmVjdGFuZ3VsYXJPcmllbnRhdGlvbjogUmVjdGFuZ3VsYXJPcmllbnRhdGlvbi5WRVJUSUNBTFxyXG4gICAgICAgIH0gKTtcclxuICAgICAgfSxcclxuICAgICAgWyBJbnRyb1JlcHJlc2VudGF0aW9uLkNBS0UgXSgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IENha2VDb250YWluZXJOb2RlKCBpY29uQ29udGFpbmVyICk7XHJcbiAgICAgIH0sXHJcbiAgICAgIFsgSW50cm9SZXByZXNlbnRhdGlvbi5CRUFLRVIgXSgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEJlYWtlckNvbnRhaW5lck5vZGUoIGljb25Db250YWluZXIgKTtcclxuICAgICAgfVxyXG4gICAgfVsgcmVwcmVzZW50YXRpb24gXSgpO1xyXG5cclxuICAgIGNvbnN0IGF2YWlsYWJsZUNlbGxXaWR0aCA9IHtcclxuICAgICAgWyBJbnRyb1JlcHJlc2VudGF0aW9uLkNJUkNMRSBdKCkgeyByZXR1cm4gb3B0aW9ucy5idWNrZXRXaWR0aCAtIDI1OyB9LFxyXG4gICAgICBbIEludHJvUmVwcmVzZW50YXRpb24uSE9SSVpPTlRBTF9CQVIgXSgpIHsgcmV0dXJuIG9wdGlvbnMuYnVja2V0V2lkdGggLSAzNTsgfSxcclxuICAgICAgWyBJbnRyb1JlcHJlc2VudGF0aW9uLlZFUlRJQ0FMX0JBUiBdKCkgeyByZXR1cm4gb3B0aW9ucy5idWNrZXRXaWR0aCAtIDc1OyB9LFxyXG4gICAgICBbIEludHJvUmVwcmVzZW50YXRpb24uQ0FLRSBdKCkgeyByZXR1cm4gb3B0aW9ucy5idWNrZXRXaWR0aCAtIDQ1OyB9LFxyXG4gICAgICBbIEludHJvUmVwcmVzZW50YXRpb24uQkVBS0VSIF0oKSB7IHJldHVybiBvcHRpb25zLmJ1Y2tldFdpZHRoIC0gNTU7IH1cclxuICAgIH1bIHJlcHJlc2VudGF0aW9uIF0oKTtcclxuXHJcbiAgICBjb25zdCB2ZXJ0aWNhbENlbGxPZmZzZXQgPSB7XHJcbiAgICAgIFsgSW50cm9SZXByZXNlbnRhdGlvbi5DSVJDTEUgXSgpIHsgcmV0dXJuIGhlaWdodCA9PiAtMTIgKyBoZWlnaHQgLyA2OyB9LFxyXG4gICAgICBbIEludHJvUmVwcmVzZW50YXRpb24uSE9SSVpPTlRBTF9CQVIgXSgpIHsgcmV0dXJuIGhlaWdodCA9PiA1OyB9LFxyXG4gICAgICBbIEludHJvUmVwcmVzZW50YXRpb24uVkVSVElDQUxfQkFSIF0oKSB7IHJldHVybiBoZWlnaHQgPT4gMTQgLSBoZWlnaHQgLyA3OyB9LFxyXG4gICAgICBbIEludHJvUmVwcmVzZW50YXRpb24uQ0FLRSBdKCkgeyByZXR1cm4gaGVpZ2h0ID0+IDA7IH0sXHJcbiAgICAgIFsgSW50cm9SZXByZXNlbnRhdGlvbi5CRUFLRVIgXSgpIHsgcmV0dXJuIGhlaWdodCA9PiAtMTA7IH1cclxuICAgIH1bIHJlcHJlc2VudGF0aW9uIF0oKTtcclxuXHJcbiAgICBjb25zdCBjZWxsUXVhbnRpdHkgPSB7XHJcbiAgICAgIFsgSW50cm9SZXByZXNlbnRhdGlvbi5DSVJDTEUgXSgpIHsgcmV0dXJuIDE2OyB9LFxyXG4gICAgICBbIEludHJvUmVwcmVzZW50YXRpb24uSE9SSVpPTlRBTF9CQVIgXSgpIHsgcmV0dXJuIDE2OyB9LFxyXG4gICAgICBbIEludHJvUmVwcmVzZW50YXRpb24uVkVSVElDQUxfQkFSIF0oKSB7IHJldHVybiAxNjsgfSxcclxuICAgICAgWyBJbnRyb1JlcHJlc2VudGF0aW9uLkNBS0UgXSgpIHsgcmV0dXJuIDg7IH0sXHJcbiAgICAgIFsgSW50cm9SZXByZXNlbnRhdGlvbi5CRUFLRVIgXSgpIHsgcmV0dXJuIDg7IH1cclxuICAgIH1bIHJlcHJlc2VudGF0aW9uIF0oKTtcclxuXHJcbiAgICAvLyBsYXllciB0byBob2xkIGFsbCB0aGUgc3RhdGljIGNlbGwgbm9kZXMgaW4gdGhlIGJ1Y2tldFxyXG4gICAgY29uc3Qgc3RhdGljTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG5cclxuICAgIGNvbnN0IHByb3BlcnR5RnJhY3Rpb25Ob2RlID0gbmV3IFByb3BlcnR5RnJhY3Rpb25Ob2RlKCBuZXcgTnVtYmVyUHJvcGVydHkoIDEgKSwgZGVub21pbmF0b3JQcm9wZXJ0eSwge1xyXG4gICAgICBzY2FsZTogMC43XHJcbiAgICB9ICk7XHJcblxyXG4gICAgYnVja2V0RnJvbnQuc2V0TGFiZWwoIG5ldyBIQm94KCB7XHJcbiAgICAgIHNwYWNpbmc6IDE1LFxyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIG5ldyBOb2RlKCB7XHJcbiAgICAgICAgICBtYXhXaWR0aDogMTAwLFxyXG4gICAgICAgICAgbWF4SGVpZ2h0OiA1MCxcclxuICAgICAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgICAgIGljb25Ob2RlXHJcbiAgICAgICAgICBdXHJcbiAgICAgICAgfSApLFxyXG4gICAgICAgIHByb3BlcnR5RnJhY3Rpb25Ob2RlXHJcbiAgICAgIF1cclxuICAgIH0gKSApO1xyXG5cclxuICAgIG9wdGlvbnMuY2hpbGRyZW4gPSBbIGJ1Y2tldEhvbGUsIHN0YXRpY0xheWVyLCBidWNrZXRGcm9udCBdO1xyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7UHJvcGVydHkuPG51bWJlcj59XHJcbiAgICB0aGlzLmRlbm9taW5hdG9yUHJvcGVydHkgPSBkZW5vbWluYXRvclByb3BlcnR5O1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtQcm9wZXJ0eUZyYWN0aW9uTm9kZX1cclxuICAgIHRoaXMucHJvcGVydHlGcmFjdGlvbk5vZGUgPSBwcm9wZXJ0eUZyYWN0aW9uTm9kZTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7QnVja2V0RnJvbnR9XHJcbiAgICB0aGlzLmJ1Y2tldEZyb250ID0gYnVja2V0RnJvbnQ7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge0J1Y2tldEhvbGV9XHJcbiAgICB0aGlzLmJ1Y2tldEhvbGUgPSBidWNrZXRIb2xlO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtOb2RlfVxyXG4gICAgdGhpcy5pY29uTm9kZSA9IGljb25Ob2RlO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtmdW5jdGlvbn1cclxuICAgIHRoaXMuZGVub21pbmF0b3JMaXN0ZW5lciA9IGRlbm9taW5hdG9yID0+IHtcclxuICAgICAgLy8gdGFrZSBkZW5vbWluYXRvciwgYW5kIHRoZSBsZW5ndGggb2YgdGhlIGljb24gY29udGFpbmVyXHJcbiAgICAgIC8vIGZpbmQgdGhlIGRpZmZlcmVuY2UgYWRkL3JlbW92ZSB0aGF0IG1hbnkgY2VsbHMgZnJvbSB0aGUgY29udGFpbmVyXHJcbiAgICAgIGNvbnN0IGRpZmZlcmVuY2UgPSBkZW5vbWluYXRvciAtIGljb25Db250YWluZXIuY2VsbHMubGVuZ3RoO1xyXG4gICAgICBpZiAoIGRpZmZlcmVuY2UgPiAwICkge1xyXG5cclxuICAgICAgICAvL2FkZCBjZWxsc1xyXG4gICAgICAgIGljb25Db250YWluZXIuYWRkQ2VsbHMoIGRpZmZlcmVuY2UgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggZGlmZmVyZW5jZSA8IDAgKSB7XHJcblxyXG4gICAgICAgIC8vcmVtb3ZlIGNlbGxzXHJcbiAgICAgICAgaWNvbkNvbnRhaW5lci5yZW1vdmVDZWxscyggLWRpZmZlcmVuY2UgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgY2VsbE5vZGUgPSBjcmVhdGVDZWxsTm9kZSggZGVub21pbmF0b3IsIDAsIHt9ICk7XHJcbiAgICAgIGNvbnN0IGJvdW5kcyA9IHJlcHJlc2VudGF0aW9uID09PSBJbnRyb1JlcHJlc2VudGF0aW9uLkNBS0UgPyBjZWxsTm9kZS5ib3VuZHMgOiBjZWxsTm9kZS5nZXRTYWZlVHJhbnNmb3JtZWRWaXNpYmxlQm91bmRzKCk7XHJcbiAgICAgIC8vIFdlIGdlbmVyYXRlIGEgd2VsbC1kZWZpbmVkIHJhbmRvbSBzZXF1ZW5jZSBzbyB0aGF0IHRoZSBhcHBlYXJhbmNlIGlzIGNvbnNpc3RlbnQgYWNyb3NzIHJ1bnNcclxuICAgICAgY29uc3QgcmFuZG9tID0gbmV3IFJhbmRvbSgge1xyXG4gICAgICAgIHNlZWQ6IDQgLy8gaHR0cHM6Ly94a2NkLmNvbS8yMjEvXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIGNvbnN0IGxlZnQgPSAtYXZhaWxhYmxlQ2VsbFdpZHRoIC8gMiArIGJvdW5kcy53aWR0aCAvIDI7XHJcbiAgICAgIGNvbnN0IHJpZ2h0ID0gYXZhaWxhYmxlQ2VsbFdpZHRoIC8gMiAtIGJvdW5kcy53aWR0aCAvIDI7XHJcblxyXG4gICAgICBjb25zdCBudW1TZWN0aW9ucyA9IGNlbGxRdWFudGl0eTtcclxuICAgICAgY29uc3QgY2hpbGRyZW4gPSBbXTtcclxuICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgbnVtU2VjdGlvbnM7IGkrKyApIHtcclxuICAgICAgICAvLyBzdG9jaGFzdGljIHdpdGhpbiBpdHMgcmVjdGFuZ2xlLCBzbyB0aGVyZSBpcyBhIG1vcmUgY29uc2lzdGVudCBsYXlvdXRcclxuICAgICAgICBjb25zdCBzZWN0aW9uTGVmdCA9IGxlZnQgKyAoIHJpZ2h0IC0gbGVmdCApICogaSAvIG51bVNlY3Rpb25zO1xyXG4gICAgICAgIGNvbnN0IHNlY3Rpb25SaWdodCA9IGxlZnQgKyAoIHJpZ2h0IC0gbGVmdCApICogKCBpICsgMSApIC8gbnVtU2VjdGlvbnM7XHJcbiAgICAgICAgY29uc3QgeCA9IHNlY3Rpb25MZWZ0ICsgKCBzZWN0aW9uUmlnaHQgLSBzZWN0aW9uTGVmdCApICogcmFuZG9tLm5leHREb3VibGUoKTtcclxuICAgICAgICBjb25zdCB5ID0gKCByYW5kb20ubmV4dERvdWJsZSgpIC0gMC41ICkgKiAyMCArIHZlcnRpY2FsQ2VsbE9mZnNldCggYm91bmRzLmhlaWdodCApO1xyXG4gICAgICAgIGNoaWxkcmVuLnB1c2goIG5ldyBOb2RlKCB7XHJcbiAgICAgICAgICBjaGlsZHJlbjogWyBjZWxsTm9kZSBdLFxyXG4gICAgICAgICAgdHJhbnNsYXRpb246IGJ1Y2tldEhvbGUuY2VudGVyLnBsdXNYWSggeCwgeSApLm1pbnVzKCBib3VuZHMuY2VudGVyIClcclxuICAgICAgICB9ICkgKTtcclxuICAgICAgfVxyXG4gICAgICBzdGF0aWNMYXllci5jaGlsZHJlbiA9IHJhbmRvbS5zaHVmZmxlKCBjaGlsZHJlbiApO1xyXG4gICAgfTtcclxuICAgIHRoaXMuZGVub21pbmF0b3JQcm9wZXJ0eS5saW5rKCB0aGlzLmRlbm9taW5hdG9yTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBhZGQgbGlzdGVuZXIgdG8gdGhlIGJ1Y2tldCBhbmQgc3RhdGljIHBpZWNlc1xyXG4gICAgY29uc3QgYnVja2V0TGlzdGVuZXIgPSBEcmFnTGlzdGVuZXIuY3JlYXRlRm9yd2FyZGluZ0xpc3RlbmVyKCBzdGFydFBpZWNlRHJhZyApO1xyXG4gICAgWyBidWNrZXRIb2xlLCBzdGF0aWNMYXllciwgYnVja2V0RnJvbnQgXS5mb3JFYWNoKCBub2RlID0+IG5vZGUuYWRkSW5wdXRMaXN0ZW5lciggYnVja2V0TGlzdGVuZXIgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVsZWFzZXMgcmVmZXJlbmNlcy5cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIHRoaXMuZGVub21pbmF0b3JQcm9wZXJ0eS51bmxpbmsoIHRoaXMuZGVub21pbmF0b3JMaXN0ZW5lciApO1xyXG4gICAgdGhpcy5wcm9wZXJ0eUZyYWN0aW9uTm9kZS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLmJ1Y2tldEZyb250LmRpc3Bvc2UoKTtcclxuICAgIHRoaXMuYnVja2V0SG9sZS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLmljb25Ob2RlLmRpc3Bvc2UoKTtcclxuXHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5mcmFjdGlvbnNDb21tb24ucmVnaXN0ZXIoICdCdWNrZXROb2RlJywgQnVja2V0Tm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBCdWNrZXROb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGNBQWMsTUFBTSx1Q0FBdUM7QUFDbEUsT0FBT0MsVUFBVSxNQUFNLGtDQUFrQztBQUN6RCxPQUFPQyxNQUFNLE1BQU0sOEJBQThCO0FBQ2pELE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsTUFBTSxNQUFNLDJDQUEyQztBQUM5RCxPQUFPQyxtQkFBbUIsTUFBTSx1REFBdUQ7QUFDdkYsT0FBT0MsV0FBVyxNQUFNLG1EQUFtRDtBQUMzRSxPQUFPQyxVQUFVLE1BQU0sa0RBQWtEO0FBQ3pFLE9BQU9DLG9CQUFvQixNQUFNLHFEQUFxRDtBQUN0RixTQUFTQyxZQUFZLEVBQUVDLElBQUksRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUM1RSxPQUFPQyxxQkFBcUIsTUFBTSw0Q0FBNEM7QUFDOUUsT0FBT0MsZUFBZSxNQUFNLDBCQUEwQjtBQUN0RCxPQUFPQyxTQUFTLE1BQU0sdUJBQXVCO0FBQzdDLE9BQU9DLG1CQUFtQixNQUFNLGlDQUFpQztBQUNqRSxPQUFPQyxtQkFBbUIsTUFBTSxpQ0FBaUM7QUFDakUsT0FBT0MsaUJBQWlCLE1BQU0sNkJBQTZCO0FBQzNELE9BQU9DLHFCQUFxQixNQUFNLHFDQUFx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