// Copyright 2018-2023, University of Colorado Boulder

/**
 * ScreenView for the "Equality Lab" screen of Fractions: Equality
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Multilink from '../../../../axon/js/Multilink.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import MathSymbols from '../../../../scenery-phet/js/MathSymbols.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import PropertyFractionNode from '../../../../scenery-phet/js/PropertyFractionNode.js';
import { AlignBox, HBox, Node, Text, VBox } from '../../../../scenery/js/imports.js';
import Panel from '../../../../sun/js/Panel.js';
import FractionsCommonConstants from '../../common/FractionsCommonConstants.js';
import FractionsCommonGlobals from '../../common/FractionsCommonGlobals.js';
import FractionsCommonColors from '../../common/view/FractionsCommonColors.js';
import fractionsCommon from '../../fractionsCommon.js';
import Container from '../model/Container.js';
import IntroRepresentation from '../model/IntroRepresentation.js';
import BeakerContainerNode from './beaker/BeakerContainerNode.js';
import BeakerSceneNode from './beaker/BeakerSceneNode.js';
import CellSceneNode from './CellSceneNode.js';
import CircularContainerNode from './circular/CircularContainerNode.js';
import CircularSceneNode from './circular/CircularSceneNode.js';
import ContainerSetScreenView from './ContainerSetScreenView.js';
import IntroRadioButtonGroup from './IntroRadioButtonGroup.js';
import NumberLineNode from './numberline/NumberLineNode.js';
import NumberLineSceneNode from './numberline/NumberLineSceneNode.js';
import NumberLineOrientation from './NumberLineOrientation.js';
import RectangularContainerNode from './rectangular/RectangularContainerNode.js';
import RectangularSceneNode from './rectangular/RectangularSceneNode.js';
import RectangularOrientation from './RectangularOrientation.js';
import RoundNumberSpinner from './RoundNumberSpinner.js';

// constants
const MARGIN = FractionsCommonConstants.PANEL_MARGIN;
class EqualityLabScreenView extends ContainerSetScreenView {
  /**
   * @param {EqualityLabModel} model
   */
  constructor(model) {
    super(model, {
      spinnersOnRight: false
    });
    const equalsText = new Text(MathSymbols.EQUAL_TO, {
      font: new PhetFont(90)
    });
    const multipliedNumeratorProperty = new DerivedProperty([model.numeratorProperty, model.multiplierProperty], (numerator, multiplier) => {
      return numerator * multiplier;
    });
    const multipliedDenominatorProperty = new DerivedProperty([model.denominatorProperty, model.multiplierProperty], (denominator, multiplier) => {
      return denominator * multiplier;
    });
    const multipliedFractionNode = new PropertyFractionNode(multipliedNumeratorProperty, multipliedDenominatorProperty, {
      scale: 3,
      maxNumerator: model.numeratorProperty.range.max * model.multiplierProperty.range.max,
      maxDenominator: model.denominatorProperty.range.max * model.multiplierProperty.range.max
    });
    const multiplierSpinner = new RoundNumberSpinner(model.multiplierProperty, new DerivedProperty([model.multiplierProperty], multiplier => multiplier < model.multiplierProperty.range.max), new DerivedProperty([model.multiplierProperty], multiplier => multiplier > model.multiplierProperty.range.min), {
      baseColor: FractionsCommonColors.greenRoundArrowButtonProperty,
      rotation: Math.PI / 2
    });
    const circularIcon = CircularSceneNode.getIcon(true);
    const horizontalIcon = RectangularSceneNode.getIcon(RectangularOrientation.HORIZONTAL, true);
    const verticalIcon = RectangularSceneNode.getIcon(RectangularOrientation.VERTICAL, true);
    const beakerIcon = BeakerSceneNode.getIcon(true);
    const variableIcon = new Node({
      children: [circularIcon, horizontalIcon, verticalIcon, beakerIcon]
    });
    // No unlink needed, the ScreenView is permanent.
    model.representationProperty.link(representation => {
      circularIcon.visible = representation === IntroRepresentation.CIRCLE;
      horizontalIcon.visible = representation === IntroRepresentation.HORIZONTAL_BAR;
      verticalIcon.visible = representation === IntroRepresentation.VERTICAL_BAR;
      beakerIcon.visible = representation === IntroRepresentation.BEAKER;
    });
    const showNumberLineNode = new IntroRadioButtonGroup(model.showNumberLineProperty, [{
      value: false,
      createNode: () => variableIcon
    }, {
      value: true,
      createNode: () => NumberLineSceneNode.getIcon()
    }]);
    const showNumberLinePanel = new Panel(new AlignBox(showNumberLineNode, {
      group: this.topAlignGroup
    }), {
      fill: FractionsCommonColors.introPanelBackgroundProperty,
      xMargin: FractionsCommonConstants.PANEL_MARGIN,
      yMargin: FractionsCommonConstants.PANEL_MARGIN
    });
    const multipliedViewContainer = new Node({
      pickable: false
    });
    this.children = [equalsText, multipliedFractionNode, multiplierSpinner, showNumberLinePanel, multipliedViewContainer, ...this.children];

    // layout

    // We need to rescale some parts (which we can't just re-parent and put under a single node)
    const bottomControlScale = 0.85;
    this.adjustableFractionNode.scale(bottomControlScale);
    equalsText.scale(bottomControlScale);
    multipliedFractionNode.scale(bottomControlScale);
    multiplierSpinner.scale(bottomControlScale);

    // Center things with the equals sign at the center of the screen (with everything positioned based on it)
    equalsText.centerX = this.layoutBounds.centerX;
    this.adjustableFractionNode.right = equalsText.left - MARGIN;
    this.bucketContainer.right = this.adjustableFractionNode.left - MARGIN;
    multipliedFractionNode.left = equalsText.right + MARGIN;
    multiplierSpinner.left = multipliedFractionNode.right + MARGIN;

    // Align the left/right edges for the radio button groups and other controls.
    this.representationPanel.right = this.adjustableFractionNode.right;
    this.representationPanel.top = this.layoutBounds.top + MARGIN;
    showNumberLinePanel.left = multipliedFractionNode.left;
    showNumberLinePanel.top = this.layoutBounds.top + MARGIN;
    const centerY = this.layoutBounds.centerY - 40;
    this.viewContainer.y = centerY;
    multipliedViewContainer.y = centerY;

    // The bucket should always be at the bottom
    this.bucketContainer.bottom = this.layoutBounds.bottom - MARGIN;

    // Center the remaining controls adjacent to the bottom
    const bottomAlignY = this.layoutBounds.bottom - MARGIN - this.adjustableFractionNode.height / 2;
    this.adjustableFractionNode.centerY = bottomAlignY;
    equalsText.centerY = bottomAlignY;
    multipliedFractionNode.centerY = bottomAlignY;
    multiplierSpinner.centerY = bottomAlignY;

    // No unlink needed, the ScreenView is permanent.
    model.representationProperty.link(() => {
      this.viewContainer.right = this.representationPanel.right;
    });
    let containerNodes = [];
    let lastRepresentation = null;
    function spacedBox(numPerRow, nodes, representation) {
      return new VBox({
        center: Vector2.ZERO,
        spacing: CellSceneNode.getVerticalSpacing(representation),
        children: _.chunk(nodes, numPerRow).map(rowNodes => new HBox({
          spacing: CellSceneNode.getHorizontalSpacing(representation),
          children: rowNodes
        }))
      });
    }
    const semitransparentColorOverride = new DerivedProperty([FractionsCommonColors.equalityLabColorProperty], color => color.withAlpha(0.8));
    Multilink.multilink([model.representationProperty, model.showNumberLineProperty], (representation, showNumberLine) => {
      representation = showNumberLine ? IntroRepresentation.NUMBER_LINE : representation;
      if (representation !== lastRepresentation) {
        containerNodes.forEach(containerNode => containerNode.dispose());
        containerNodes = [];
        multipliedViewContainer.children.forEach(child => child.dispose());
        lastRepresentation = representation;
        const containers = model.multipliedContainers;
        const colorOverride = FractionsCommonColors.equalityLabColorProperty;
        let containerOffset = 0;
        if (representation === IntroRepresentation.CIRCLE) {
          containerNodes = containers.map(container => new CircularContainerNode(container, {
            colorOverride: colorOverride
          }));
          multipliedViewContainer.addChild(spacedBox(2, containerNodes, representation));
        } else if (representation === IntroRepresentation.HORIZONTAL_BAR) {
          containerNodes = containers.map(container => new RectangularContainerNode(container, {
            rectangularOrientation: RectangularOrientation.HORIZONTAL,
            colorOverride: colorOverride
          }));
          multipliedViewContainer.addChild(spacedBox(1, containerNodes, representation));
        } else if (representation === IntroRepresentation.VERTICAL_BAR) {
          containerNodes = containers.map(container => new RectangularContainerNode(container, {
            rectangularOrientation: RectangularOrientation.VERTICAL,
            colorOverride: colorOverride
          }));
          multipliedViewContainer.addChild(spacedBox(4, containerNodes, representation));
        } else if (representation === IntroRepresentation.BEAKER) {
          containerNodes = containers.map(container => new BeakerContainerNode(container, {
            colorOverride: FractionsCommonColors.equalityLabWaterProperty
          }));
          multipliedViewContainer.addChild(spacedBox(4, containerNodes, representation));
        } else if (representation === IntroRepresentation.NUMBER_LINE) {
          const multipliedNumberLine = new NumberLineNode(model.numeratorProperty, model.denominatorProperty, model.containerCountProperty, {
            multiplierProperty: model.multiplierProperty,
            orientation: NumberLineOrientation.VERTICAL,
            unitSize: 60,
            arrowFill: colorOverride,
            markerFill: semitransparentColorOverride,
            showArrow: true,
            markerLineWidth: 2,
            markerRadius: 8,
            arrowOffset: 15
          });
          containerNodes = [multipliedNumberLine];
          multipliedViewContainer.addChild(multipliedNumberLine);
          const parentLayoutPoint = multipliedNumberLine.localToParentPoint(multipliedNumberLine.localLayoutPoint);
          containerOffset = multipliedNumberLine.left - parentLayoutPoint.x;
        }
        if (multipliedViewContainer.bounds.isValid()) {
          multipliedViewContainer.left = multipliedFractionNode.left + containerOffset;
        }
      }
    });
  }

  /**
   * Creates the icon for the screen.
   * @public
   *
   * @returns {Node}
   */
  static createScreenIcon() {
    const leftContainer = new Container();
    const rightContainer = new Container();
    leftContainer.addCells(3);
    rightContainer.addCells(9);
    _.times(2, () => {
      leftContainer.getNextEmptyCell().setFilled(true);
    });
    _.times(6, () => {
      rightContainer.getNextEmptyCell().setFilled(true);
    });
    const equalsText = new Text(MathSymbols.EQUAL_TO, {
      font: new PhetFont(80)
    });
    const leftContainerNode = new RectangularContainerNode(leftContainer);
    const rightContainerNode = new RectangularContainerNode(rightContainer, {
      colorOverride: FractionsCommonColors.equalityLabColorProperty
    });
    return FractionsCommonGlobals.wrapIcon(new HBox({
      spacing: 13,
      children: [leftContainerNode, equalsText, rightContainerNode],
      scale: 1.5
    }), FractionsCommonColors.introScreenBackgroundProperty);
  }
}
fractionsCommon.register('EqualityLabScreenView', EqualityLabScreenView);
export default EqualityLabScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJNdWx0aWxpbmsiLCJWZWN0b3IyIiwiTWF0aFN5bWJvbHMiLCJQaGV0Rm9udCIsIlByb3BlcnR5RnJhY3Rpb25Ob2RlIiwiQWxpZ25Cb3giLCJIQm94IiwiTm9kZSIsIlRleHQiLCJWQm94IiwiUGFuZWwiLCJGcmFjdGlvbnNDb21tb25Db25zdGFudHMiLCJGcmFjdGlvbnNDb21tb25HbG9iYWxzIiwiRnJhY3Rpb25zQ29tbW9uQ29sb3JzIiwiZnJhY3Rpb25zQ29tbW9uIiwiQ29udGFpbmVyIiwiSW50cm9SZXByZXNlbnRhdGlvbiIsIkJlYWtlckNvbnRhaW5lck5vZGUiLCJCZWFrZXJTY2VuZU5vZGUiLCJDZWxsU2NlbmVOb2RlIiwiQ2lyY3VsYXJDb250YWluZXJOb2RlIiwiQ2lyY3VsYXJTY2VuZU5vZGUiLCJDb250YWluZXJTZXRTY3JlZW5WaWV3IiwiSW50cm9SYWRpb0J1dHRvbkdyb3VwIiwiTnVtYmVyTGluZU5vZGUiLCJOdW1iZXJMaW5lU2NlbmVOb2RlIiwiTnVtYmVyTGluZU9yaWVudGF0aW9uIiwiUmVjdGFuZ3VsYXJDb250YWluZXJOb2RlIiwiUmVjdGFuZ3VsYXJTY2VuZU5vZGUiLCJSZWN0YW5ndWxhck9yaWVudGF0aW9uIiwiUm91bmROdW1iZXJTcGlubmVyIiwiTUFSR0lOIiwiUEFORUxfTUFSR0lOIiwiRXF1YWxpdHlMYWJTY3JlZW5WaWV3IiwiY29uc3RydWN0b3IiLCJtb2RlbCIsInNwaW5uZXJzT25SaWdodCIsImVxdWFsc1RleHQiLCJFUVVBTF9UTyIsImZvbnQiLCJtdWx0aXBsaWVkTnVtZXJhdG9yUHJvcGVydHkiLCJudW1lcmF0b3JQcm9wZXJ0eSIsIm11bHRpcGxpZXJQcm9wZXJ0eSIsIm51bWVyYXRvciIsIm11bHRpcGxpZXIiLCJtdWx0aXBsaWVkRGVub21pbmF0b3JQcm9wZXJ0eSIsImRlbm9taW5hdG9yUHJvcGVydHkiLCJkZW5vbWluYXRvciIsIm11bHRpcGxpZWRGcmFjdGlvbk5vZGUiLCJzY2FsZSIsIm1heE51bWVyYXRvciIsInJhbmdlIiwibWF4IiwibWF4RGVub21pbmF0b3IiLCJtdWx0aXBsaWVyU3Bpbm5lciIsIm1pbiIsImJhc2VDb2xvciIsImdyZWVuUm91bmRBcnJvd0J1dHRvblByb3BlcnR5Iiwicm90YXRpb24iLCJNYXRoIiwiUEkiLCJjaXJjdWxhckljb24iLCJnZXRJY29uIiwiaG9yaXpvbnRhbEljb24iLCJIT1JJWk9OVEFMIiwidmVydGljYWxJY29uIiwiVkVSVElDQUwiLCJiZWFrZXJJY29uIiwidmFyaWFibGVJY29uIiwiY2hpbGRyZW4iLCJyZXByZXNlbnRhdGlvblByb3BlcnR5IiwibGluayIsInJlcHJlc2VudGF0aW9uIiwidmlzaWJsZSIsIkNJUkNMRSIsIkhPUklaT05UQUxfQkFSIiwiVkVSVElDQUxfQkFSIiwiQkVBS0VSIiwic2hvd051bWJlckxpbmVOb2RlIiwic2hvd051bWJlckxpbmVQcm9wZXJ0eSIsInZhbHVlIiwiY3JlYXRlTm9kZSIsInNob3dOdW1iZXJMaW5lUGFuZWwiLCJncm91cCIsInRvcEFsaWduR3JvdXAiLCJmaWxsIiwiaW50cm9QYW5lbEJhY2tncm91bmRQcm9wZXJ0eSIsInhNYXJnaW4iLCJ5TWFyZ2luIiwibXVsdGlwbGllZFZpZXdDb250YWluZXIiLCJwaWNrYWJsZSIsImJvdHRvbUNvbnRyb2xTY2FsZSIsImFkanVzdGFibGVGcmFjdGlvbk5vZGUiLCJjZW50ZXJYIiwibGF5b3V0Qm91bmRzIiwicmlnaHQiLCJsZWZ0IiwiYnVja2V0Q29udGFpbmVyIiwicmVwcmVzZW50YXRpb25QYW5lbCIsInRvcCIsImNlbnRlclkiLCJ2aWV3Q29udGFpbmVyIiwieSIsImJvdHRvbSIsImJvdHRvbUFsaWduWSIsImhlaWdodCIsImNvbnRhaW5lck5vZGVzIiwibGFzdFJlcHJlc2VudGF0aW9uIiwic3BhY2VkQm94IiwibnVtUGVyUm93Iiwibm9kZXMiLCJjZW50ZXIiLCJaRVJPIiwic3BhY2luZyIsImdldFZlcnRpY2FsU3BhY2luZyIsIl8iLCJjaHVuayIsIm1hcCIsInJvd05vZGVzIiwiZ2V0SG9yaXpvbnRhbFNwYWNpbmciLCJzZW1pdHJhbnNwYXJlbnRDb2xvck92ZXJyaWRlIiwiZXF1YWxpdHlMYWJDb2xvclByb3BlcnR5IiwiY29sb3IiLCJ3aXRoQWxwaGEiLCJtdWx0aWxpbmsiLCJzaG93TnVtYmVyTGluZSIsIk5VTUJFUl9MSU5FIiwiZm9yRWFjaCIsImNvbnRhaW5lck5vZGUiLCJkaXNwb3NlIiwiY2hpbGQiLCJjb250YWluZXJzIiwibXVsdGlwbGllZENvbnRhaW5lcnMiLCJjb2xvck92ZXJyaWRlIiwiY29udGFpbmVyT2Zmc2V0IiwiY29udGFpbmVyIiwiYWRkQ2hpbGQiLCJyZWN0YW5ndWxhck9yaWVudGF0aW9uIiwiZXF1YWxpdHlMYWJXYXRlclByb3BlcnR5IiwibXVsdGlwbGllZE51bWJlckxpbmUiLCJjb250YWluZXJDb3VudFByb3BlcnR5Iiwib3JpZW50YXRpb24iLCJ1bml0U2l6ZSIsImFycm93RmlsbCIsIm1hcmtlckZpbGwiLCJzaG93QXJyb3ciLCJtYXJrZXJMaW5lV2lkdGgiLCJtYXJrZXJSYWRpdXMiLCJhcnJvd09mZnNldCIsInBhcmVudExheW91dFBvaW50IiwibG9jYWxUb1BhcmVudFBvaW50IiwibG9jYWxMYXlvdXRQb2ludCIsIngiLCJib3VuZHMiLCJpc1ZhbGlkIiwiY3JlYXRlU2NyZWVuSWNvbiIsImxlZnRDb250YWluZXIiLCJyaWdodENvbnRhaW5lciIsImFkZENlbGxzIiwidGltZXMiLCJnZXROZXh0RW1wdHlDZWxsIiwic2V0RmlsbGVkIiwibGVmdENvbnRhaW5lck5vZGUiLCJyaWdodENvbnRhaW5lck5vZGUiLCJ3cmFwSWNvbiIsImludHJvU2NyZWVuQmFja2dyb3VuZFByb3BlcnR5IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJFcXVhbGl0eUxhYlNjcmVlblZpZXcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2NyZWVuVmlldyBmb3IgdGhlIFwiRXF1YWxpdHkgTGFiXCIgc2NyZWVuIG9mIEZyYWN0aW9uczogRXF1YWxpdHlcclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgTWF0aFN5bWJvbHMgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL01hdGhTeW1ib2xzLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eUZyYWN0aW9uTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUHJvcGVydHlGcmFjdGlvbk5vZGUuanMnO1xyXG5pbXBvcnQgeyBBbGlnbkJveCwgSEJveCwgTm9kZSwgVGV4dCwgVkJveCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBQYW5lbCBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvUGFuZWwuanMnO1xyXG5pbXBvcnQgRnJhY3Rpb25zQ29tbW9uQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9GcmFjdGlvbnNDb21tb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgRnJhY3Rpb25zQ29tbW9uR2xvYmFscyBmcm9tICcuLi8uLi9jb21tb24vRnJhY3Rpb25zQ29tbW9uR2xvYmFscy5qcyc7XHJcbmltcG9ydCBGcmFjdGlvbnNDb21tb25Db2xvcnMgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvRnJhY3Rpb25zQ29tbW9uQ29sb3JzLmpzJztcclxuaW1wb3J0IGZyYWN0aW9uc0NvbW1vbiBmcm9tICcuLi8uLi9mcmFjdGlvbnNDb21tb24uanMnO1xyXG5pbXBvcnQgQ29udGFpbmVyIGZyb20gJy4uL21vZGVsL0NvbnRhaW5lci5qcyc7XHJcbmltcG9ydCBJbnRyb1JlcHJlc2VudGF0aW9uIGZyb20gJy4uL21vZGVsL0ludHJvUmVwcmVzZW50YXRpb24uanMnO1xyXG5pbXBvcnQgQmVha2VyQ29udGFpbmVyTm9kZSBmcm9tICcuL2JlYWtlci9CZWFrZXJDb250YWluZXJOb2RlLmpzJztcclxuaW1wb3J0IEJlYWtlclNjZW5lTm9kZSBmcm9tICcuL2JlYWtlci9CZWFrZXJTY2VuZU5vZGUuanMnO1xyXG5pbXBvcnQgQ2VsbFNjZW5lTm9kZSBmcm9tICcuL0NlbGxTY2VuZU5vZGUuanMnO1xyXG5pbXBvcnQgQ2lyY3VsYXJDb250YWluZXJOb2RlIGZyb20gJy4vY2lyY3VsYXIvQ2lyY3VsYXJDb250YWluZXJOb2RlLmpzJztcclxuaW1wb3J0IENpcmN1bGFyU2NlbmVOb2RlIGZyb20gJy4vY2lyY3VsYXIvQ2lyY3VsYXJTY2VuZU5vZGUuanMnO1xyXG5pbXBvcnQgQ29udGFpbmVyU2V0U2NyZWVuVmlldyBmcm9tICcuL0NvbnRhaW5lclNldFNjcmVlblZpZXcuanMnO1xyXG5pbXBvcnQgSW50cm9SYWRpb0J1dHRvbkdyb3VwIGZyb20gJy4vSW50cm9SYWRpb0J1dHRvbkdyb3VwLmpzJztcclxuaW1wb3J0IE51bWJlckxpbmVOb2RlIGZyb20gJy4vbnVtYmVybGluZS9OdW1iZXJMaW5lTm9kZS5qcyc7XHJcbmltcG9ydCBOdW1iZXJMaW5lU2NlbmVOb2RlIGZyb20gJy4vbnVtYmVybGluZS9OdW1iZXJMaW5lU2NlbmVOb2RlLmpzJztcclxuaW1wb3J0IE51bWJlckxpbmVPcmllbnRhdGlvbiBmcm9tICcuL051bWJlckxpbmVPcmllbnRhdGlvbi5qcyc7XHJcbmltcG9ydCBSZWN0YW5ndWxhckNvbnRhaW5lck5vZGUgZnJvbSAnLi9yZWN0YW5ndWxhci9SZWN0YW5ndWxhckNvbnRhaW5lck5vZGUuanMnO1xyXG5pbXBvcnQgUmVjdGFuZ3VsYXJTY2VuZU5vZGUgZnJvbSAnLi9yZWN0YW5ndWxhci9SZWN0YW5ndWxhclNjZW5lTm9kZS5qcyc7XHJcbmltcG9ydCBSZWN0YW5ndWxhck9yaWVudGF0aW9uIGZyb20gJy4vUmVjdGFuZ3VsYXJPcmllbnRhdGlvbi5qcyc7XHJcbmltcG9ydCBSb3VuZE51bWJlclNwaW5uZXIgZnJvbSAnLi9Sb3VuZE51bWJlclNwaW5uZXIuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE1BUkdJTiA9IEZyYWN0aW9uc0NvbW1vbkNvbnN0YW50cy5QQU5FTF9NQVJHSU47XHJcblxyXG5jbGFzcyBFcXVhbGl0eUxhYlNjcmVlblZpZXcgZXh0ZW5kcyBDb250YWluZXJTZXRTY3JlZW5WaWV3IHtcclxuICAvKipcclxuICAgKiBAcGFyYW0ge0VxdWFsaXR5TGFiTW9kZWx9IG1vZGVsXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1vZGVsICkge1xyXG4gICAgc3VwZXIoIG1vZGVsLCB7XHJcbiAgICAgIHNwaW5uZXJzT25SaWdodDogZmFsc2VcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBlcXVhbHNUZXh0ID0gbmV3IFRleHQoIE1hdGhTeW1ib2xzLkVRVUFMX1RPLCB7IGZvbnQ6IG5ldyBQaGV0Rm9udCggOTAgKSB9ICk7XHJcblxyXG4gICAgY29uc3QgbXVsdGlwbGllZE51bWVyYXRvclByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBtb2RlbC5udW1lcmF0b3JQcm9wZXJ0eSwgbW9kZWwubXVsdGlwbGllclByb3BlcnR5IF0sICggbnVtZXJhdG9yLCBtdWx0aXBsaWVyICkgPT4ge1xyXG4gICAgICByZXR1cm4gbnVtZXJhdG9yICogbXVsdGlwbGllcjtcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IG11bHRpcGxpZWREZW5vbWluYXRvclByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBtb2RlbC5kZW5vbWluYXRvclByb3BlcnR5LCBtb2RlbC5tdWx0aXBsaWVyUHJvcGVydHkgXSwgKCBkZW5vbWluYXRvciwgbXVsdGlwbGllciApID0+IHtcclxuICAgICAgcmV0dXJuIGRlbm9taW5hdG9yICogbXVsdGlwbGllcjtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBtdWx0aXBsaWVkRnJhY3Rpb25Ob2RlID0gbmV3IFByb3BlcnR5RnJhY3Rpb25Ob2RlKCBtdWx0aXBsaWVkTnVtZXJhdG9yUHJvcGVydHksIG11bHRpcGxpZWREZW5vbWluYXRvclByb3BlcnR5LCB7XHJcbiAgICAgIHNjYWxlOiAzLFxyXG5cclxuICAgICAgbWF4TnVtZXJhdG9yOiBtb2RlbC5udW1lcmF0b3JQcm9wZXJ0eS5yYW5nZS5tYXggKiBtb2RlbC5tdWx0aXBsaWVyUHJvcGVydHkucmFuZ2UubWF4LFxyXG4gICAgICBtYXhEZW5vbWluYXRvcjogbW9kZWwuZGVub21pbmF0b3JQcm9wZXJ0eS5yYW5nZS5tYXggKiBtb2RlbC5tdWx0aXBsaWVyUHJvcGVydHkucmFuZ2UubWF4XHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgbXVsdGlwbGllclNwaW5uZXIgPSBuZXcgUm91bmROdW1iZXJTcGlubmVyKFxyXG4gICAgICBtb2RlbC5tdWx0aXBsaWVyUHJvcGVydHksXHJcbiAgICAgIG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgbW9kZWwubXVsdGlwbGllclByb3BlcnR5IF0sIG11bHRpcGxpZXIgPT4gbXVsdGlwbGllciA8IG1vZGVsLm11bHRpcGxpZXJQcm9wZXJ0eS5yYW5nZS5tYXggKSxcclxuICAgICAgbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBtb2RlbC5tdWx0aXBsaWVyUHJvcGVydHkgXSwgbXVsdGlwbGllciA9PiBtdWx0aXBsaWVyID4gbW9kZWwubXVsdGlwbGllclByb3BlcnR5LnJhbmdlLm1pbiApLCB7XHJcbiAgICAgICAgYmFzZUNvbG9yOiBGcmFjdGlvbnNDb21tb25Db2xvcnMuZ3JlZW5Sb3VuZEFycm93QnV0dG9uUHJvcGVydHksXHJcbiAgICAgICAgcm90YXRpb246IE1hdGguUEkgLyAyXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBjaXJjdWxhckljb24gPSBDaXJjdWxhclNjZW5lTm9kZS5nZXRJY29uKCB0cnVlICk7XHJcbiAgICBjb25zdCBob3Jpem9udGFsSWNvbiA9IFJlY3Rhbmd1bGFyU2NlbmVOb2RlLmdldEljb24oIFJlY3Rhbmd1bGFyT3JpZW50YXRpb24uSE9SSVpPTlRBTCwgdHJ1ZSApO1xyXG4gICAgY29uc3QgdmVydGljYWxJY29uID0gUmVjdGFuZ3VsYXJTY2VuZU5vZGUuZ2V0SWNvbiggUmVjdGFuZ3VsYXJPcmllbnRhdGlvbi5WRVJUSUNBTCwgdHJ1ZSApO1xyXG4gICAgY29uc3QgYmVha2VySWNvbiA9IEJlYWtlclNjZW5lTm9kZS5nZXRJY29uKCB0cnVlICk7XHJcbiAgICBjb25zdCB2YXJpYWJsZUljb24gPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIGNpcmN1bGFySWNvbixcclxuICAgICAgICBob3Jpem9udGFsSWNvbixcclxuICAgICAgICB2ZXJ0aWNhbEljb24sXHJcbiAgICAgICAgYmVha2VySWNvblxyXG4gICAgICBdXHJcbiAgICB9ICk7XHJcbiAgICAvLyBObyB1bmxpbmsgbmVlZGVkLCB0aGUgU2NyZWVuVmlldyBpcyBwZXJtYW5lbnQuXHJcbiAgICBtb2RlbC5yZXByZXNlbnRhdGlvblByb3BlcnR5LmxpbmsoIHJlcHJlc2VudGF0aW9uID0+IHtcclxuICAgICAgY2lyY3VsYXJJY29uLnZpc2libGUgPSByZXByZXNlbnRhdGlvbiA9PT0gSW50cm9SZXByZXNlbnRhdGlvbi5DSVJDTEU7XHJcbiAgICAgIGhvcml6b250YWxJY29uLnZpc2libGUgPSByZXByZXNlbnRhdGlvbiA9PT0gSW50cm9SZXByZXNlbnRhdGlvbi5IT1JJWk9OVEFMX0JBUjtcclxuICAgICAgdmVydGljYWxJY29uLnZpc2libGUgPSByZXByZXNlbnRhdGlvbiA9PT0gSW50cm9SZXByZXNlbnRhdGlvbi5WRVJUSUNBTF9CQVI7XHJcbiAgICAgIGJlYWtlckljb24udmlzaWJsZSA9IHJlcHJlc2VudGF0aW9uID09PSBJbnRyb1JlcHJlc2VudGF0aW9uLkJFQUtFUjtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBzaG93TnVtYmVyTGluZU5vZGUgPSBuZXcgSW50cm9SYWRpb0J1dHRvbkdyb3VwKCBtb2RlbC5zaG93TnVtYmVyTGluZVByb3BlcnR5LCBbXHJcbiAgICAgIHtcclxuICAgICAgICB2YWx1ZTogZmFsc2UsXHJcbiAgICAgICAgY3JlYXRlTm9kZTogKCkgPT4gdmFyaWFibGVJY29uXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICB2YWx1ZTogdHJ1ZSxcclxuICAgICAgICBjcmVhdGVOb2RlOiAoKSA9PiBOdW1iZXJMaW5lU2NlbmVOb2RlLmdldEljb24oKVxyXG4gICAgICB9XHJcbiAgICBdICk7XHJcblxyXG4gICAgY29uc3Qgc2hvd051bWJlckxpbmVQYW5lbCA9IG5ldyBQYW5lbCggbmV3IEFsaWduQm94KCBzaG93TnVtYmVyTGluZU5vZGUsIHtcclxuICAgICAgZ3JvdXA6IHRoaXMudG9wQWxpZ25Hcm91cFxyXG4gICAgfSApLCB7XHJcbiAgICAgIGZpbGw6IEZyYWN0aW9uc0NvbW1vbkNvbG9ycy5pbnRyb1BhbmVsQmFja2dyb3VuZFByb3BlcnR5LFxyXG4gICAgICB4TWFyZ2luOiBGcmFjdGlvbnNDb21tb25Db25zdGFudHMuUEFORUxfTUFSR0lOLFxyXG4gICAgICB5TWFyZ2luOiBGcmFjdGlvbnNDb21tb25Db25zdGFudHMuUEFORUxfTUFSR0lOXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgbXVsdGlwbGllZFZpZXdDb250YWluZXIgPSBuZXcgTm9kZSgge1xyXG4gICAgICBwaWNrYWJsZTogZmFsc2VcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmNoaWxkcmVuID0gW1xyXG4gICAgICBlcXVhbHNUZXh0LFxyXG4gICAgICBtdWx0aXBsaWVkRnJhY3Rpb25Ob2RlLFxyXG4gICAgICBtdWx0aXBsaWVyU3Bpbm5lcixcclxuICAgICAgc2hvd051bWJlckxpbmVQYW5lbCxcclxuICAgICAgbXVsdGlwbGllZFZpZXdDb250YWluZXIsXHJcbiAgICAgIC4uLnRoaXMuY2hpbGRyZW5cclxuICAgIF07XHJcblxyXG4gICAgLy8gbGF5b3V0XHJcblxyXG4gICAgLy8gV2UgbmVlZCB0byByZXNjYWxlIHNvbWUgcGFydHMgKHdoaWNoIHdlIGNhbid0IGp1c3QgcmUtcGFyZW50IGFuZCBwdXQgdW5kZXIgYSBzaW5nbGUgbm9kZSlcclxuICAgIGNvbnN0IGJvdHRvbUNvbnRyb2xTY2FsZSA9IDAuODU7XHJcbiAgICB0aGlzLmFkanVzdGFibGVGcmFjdGlvbk5vZGUuc2NhbGUoIGJvdHRvbUNvbnRyb2xTY2FsZSApO1xyXG4gICAgZXF1YWxzVGV4dC5zY2FsZSggYm90dG9tQ29udHJvbFNjYWxlICk7XHJcbiAgICBtdWx0aXBsaWVkRnJhY3Rpb25Ob2RlLnNjYWxlKCBib3R0b21Db250cm9sU2NhbGUgKTtcclxuICAgIG11bHRpcGxpZXJTcGlubmVyLnNjYWxlKCBib3R0b21Db250cm9sU2NhbGUgKTtcclxuXHJcbiAgICAvLyBDZW50ZXIgdGhpbmdzIHdpdGggdGhlIGVxdWFscyBzaWduIGF0IHRoZSBjZW50ZXIgb2YgdGhlIHNjcmVlbiAod2l0aCBldmVyeXRoaW5nIHBvc2l0aW9uZWQgYmFzZWQgb24gaXQpXHJcbiAgICBlcXVhbHNUZXh0LmNlbnRlclggPSB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJYO1xyXG4gICAgdGhpcy5hZGp1c3RhYmxlRnJhY3Rpb25Ob2RlLnJpZ2h0ID0gZXF1YWxzVGV4dC5sZWZ0IC0gTUFSR0lOO1xyXG4gICAgdGhpcy5idWNrZXRDb250YWluZXIucmlnaHQgPSB0aGlzLmFkanVzdGFibGVGcmFjdGlvbk5vZGUubGVmdCAtIE1BUkdJTjtcclxuICAgIG11bHRpcGxpZWRGcmFjdGlvbk5vZGUubGVmdCA9IGVxdWFsc1RleHQucmlnaHQgKyBNQVJHSU47XHJcbiAgICBtdWx0aXBsaWVyU3Bpbm5lci5sZWZ0ID0gbXVsdGlwbGllZEZyYWN0aW9uTm9kZS5yaWdodCArIE1BUkdJTjtcclxuXHJcbiAgICAvLyBBbGlnbiB0aGUgbGVmdC9yaWdodCBlZGdlcyBmb3IgdGhlIHJhZGlvIGJ1dHRvbiBncm91cHMgYW5kIG90aGVyIGNvbnRyb2xzLlxyXG4gICAgdGhpcy5yZXByZXNlbnRhdGlvblBhbmVsLnJpZ2h0ID0gdGhpcy5hZGp1c3RhYmxlRnJhY3Rpb25Ob2RlLnJpZ2h0O1xyXG4gICAgdGhpcy5yZXByZXNlbnRhdGlvblBhbmVsLnRvcCA9IHRoaXMubGF5b3V0Qm91bmRzLnRvcCArIE1BUkdJTjtcclxuICAgIHNob3dOdW1iZXJMaW5lUGFuZWwubGVmdCA9IG11bHRpcGxpZWRGcmFjdGlvbk5vZGUubGVmdDtcclxuICAgIHNob3dOdW1iZXJMaW5lUGFuZWwudG9wID0gdGhpcy5sYXlvdXRCb3VuZHMudG9wICsgTUFSR0lOO1xyXG5cclxuICAgIGNvbnN0IGNlbnRlclkgPSB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJZIC0gNDA7XHJcbiAgICB0aGlzLnZpZXdDb250YWluZXIueSA9IGNlbnRlclk7XHJcbiAgICBtdWx0aXBsaWVkVmlld0NvbnRhaW5lci55ID0gY2VudGVyWTtcclxuXHJcbiAgICAvLyBUaGUgYnVja2V0IHNob3VsZCBhbHdheXMgYmUgYXQgdGhlIGJvdHRvbVxyXG4gICAgdGhpcy5idWNrZXRDb250YWluZXIuYm90dG9tID0gdGhpcy5sYXlvdXRCb3VuZHMuYm90dG9tIC0gTUFSR0lOO1xyXG5cclxuICAgIC8vIENlbnRlciB0aGUgcmVtYWluaW5nIGNvbnRyb2xzIGFkamFjZW50IHRvIHRoZSBib3R0b21cclxuICAgIGNvbnN0IGJvdHRvbUFsaWduWSA9IHRoaXMubGF5b3V0Qm91bmRzLmJvdHRvbSAtIE1BUkdJTiAtIHRoaXMuYWRqdXN0YWJsZUZyYWN0aW9uTm9kZS5oZWlnaHQgLyAyO1xyXG4gICAgdGhpcy5hZGp1c3RhYmxlRnJhY3Rpb25Ob2RlLmNlbnRlclkgPSBib3R0b21BbGlnblk7XHJcbiAgICBlcXVhbHNUZXh0LmNlbnRlclkgPSBib3R0b21BbGlnblk7XHJcbiAgICBtdWx0aXBsaWVkRnJhY3Rpb25Ob2RlLmNlbnRlclkgPSBib3R0b21BbGlnblk7XHJcbiAgICBtdWx0aXBsaWVyU3Bpbm5lci5jZW50ZXJZID0gYm90dG9tQWxpZ25ZO1xyXG5cclxuICAgIC8vIE5vIHVubGluayBuZWVkZWQsIHRoZSBTY3JlZW5WaWV3IGlzIHBlcm1hbmVudC5cclxuICAgIG1vZGVsLnJlcHJlc2VudGF0aW9uUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICB0aGlzLnZpZXdDb250YWluZXIucmlnaHQgPSB0aGlzLnJlcHJlc2VudGF0aW9uUGFuZWwucmlnaHQ7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgbGV0IGNvbnRhaW5lck5vZGVzID0gW107XHJcbiAgICBsZXQgbGFzdFJlcHJlc2VudGF0aW9uID0gbnVsbDtcclxuXHJcbiAgICBmdW5jdGlvbiBzcGFjZWRCb3goIG51bVBlclJvdywgbm9kZXMsIHJlcHJlc2VudGF0aW9uICkge1xyXG4gICAgICByZXR1cm4gbmV3IFZCb3goIHtcclxuICAgICAgICBjZW50ZXI6IFZlY3RvcjIuWkVSTyxcclxuICAgICAgICBzcGFjaW5nOiBDZWxsU2NlbmVOb2RlLmdldFZlcnRpY2FsU3BhY2luZyggcmVwcmVzZW50YXRpb24gKSxcclxuICAgICAgICBjaGlsZHJlbjogXy5jaHVuayggbm9kZXMsIG51bVBlclJvdyApLm1hcCggcm93Tm9kZXMgPT4gbmV3IEhCb3goIHtcclxuICAgICAgICAgIHNwYWNpbmc6IENlbGxTY2VuZU5vZGUuZ2V0SG9yaXpvbnRhbFNwYWNpbmcoIHJlcHJlc2VudGF0aW9uICksXHJcbiAgICAgICAgICBjaGlsZHJlbjogcm93Tm9kZXNcclxuICAgICAgICB9ICkgKVxyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc2VtaXRyYW5zcGFyZW50Q29sb3JPdmVycmlkZSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFtcclxuICAgICAgRnJhY3Rpb25zQ29tbW9uQ29sb3JzLmVxdWFsaXR5TGFiQ29sb3JQcm9wZXJ0eVxyXG4gICAgXSwgY29sb3IgPT4gY29sb3Iud2l0aEFscGhhKCAwLjggKSApO1xyXG5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFsgbW9kZWwucmVwcmVzZW50YXRpb25Qcm9wZXJ0eSwgbW9kZWwuc2hvd051bWJlckxpbmVQcm9wZXJ0eSBdLCAoIHJlcHJlc2VudGF0aW9uLCBzaG93TnVtYmVyTGluZSApID0+IHtcclxuICAgICAgcmVwcmVzZW50YXRpb24gPSBzaG93TnVtYmVyTGluZSA/IEludHJvUmVwcmVzZW50YXRpb24uTlVNQkVSX0xJTkUgOiByZXByZXNlbnRhdGlvbjtcclxuICAgICAgaWYgKCByZXByZXNlbnRhdGlvbiAhPT0gbGFzdFJlcHJlc2VudGF0aW9uICkge1xyXG4gICAgICAgIGNvbnRhaW5lck5vZGVzLmZvckVhY2goIGNvbnRhaW5lck5vZGUgPT4gY29udGFpbmVyTm9kZS5kaXNwb3NlKCkgKTtcclxuICAgICAgICBjb250YWluZXJOb2RlcyA9IFtdO1xyXG4gICAgICAgIG11bHRpcGxpZWRWaWV3Q29udGFpbmVyLmNoaWxkcmVuLmZvckVhY2goIGNoaWxkID0+IGNoaWxkLmRpc3Bvc2UoKSApO1xyXG4gICAgICAgIGxhc3RSZXByZXNlbnRhdGlvbiA9IHJlcHJlc2VudGF0aW9uO1xyXG5cclxuICAgICAgICBjb25zdCBjb250YWluZXJzID0gbW9kZWwubXVsdGlwbGllZENvbnRhaW5lcnM7XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbG9yT3ZlcnJpZGUgPSBGcmFjdGlvbnNDb21tb25Db2xvcnMuZXF1YWxpdHlMYWJDb2xvclByb3BlcnR5O1xyXG4gICAgICAgIGxldCBjb250YWluZXJPZmZzZXQgPSAwO1xyXG5cclxuICAgICAgICBpZiAoIHJlcHJlc2VudGF0aW9uID09PSBJbnRyb1JlcHJlc2VudGF0aW9uLkNJUkNMRSApIHtcclxuICAgICAgICAgIGNvbnRhaW5lck5vZGVzID0gY29udGFpbmVycy5tYXAoIGNvbnRhaW5lciA9PiBuZXcgQ2lyY3VsYXJDb250YWluZXJOb2RlKCBjb250YWluZXIsIHtcclxuICAgICAgICAgICAgY29sb3JPdmVycmlkZTogY29sb3JPdmVycmlkZVxyXG4gICAgICAgICAgfSApICk7XHJcbiAgICAgICAgICBtdWx0aXBsaWVkVmlld0NvbnRhaW5lci5hZGRDaGlsZCggc3BhY2VkQm94KCAyLCBjb250YWluZXJOb2RlcywgcmVwcmVzZW50YXRpb24gKSApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICggcmVwcmVzZW50YXRpb24gPT09IEludHJvUmVwcmVzZW50YXRpb24uSE9SSVpPTlRBTF9CQVIgKSB7XHJcbiAgICAgICAgICBjb250YWluZXJOb2RlcyA9IGNvbnRhaW5lcnMubWFwKCBjb250YWluZXIgPT4gbmV3IFJlY3Rhbmd1bGFyQ29udGFpbmVyTm9kZSggY29udGFpbmVyLCB7XHJcbiAgICAgICAgICAgIHJlY3Rhbmd1bGFyT3JpZW50YXRpb246IFJlY3Rhbmd1bGFyT3JpZW50YXRpb24uSE9SSVpPTlRBTCxcclxuICAgICAgICAgICAgY29sb3JPdmVycmlkZTogY29sb3JPdmVycmlkZVxyXG4gICAgICAgICAgfSApICk7XHJcbiAgICAgICAgICBtdWx0aXBsaWVkVmlld0NvbnRhaW5lci5hZGRDaGlsZCggc3BhY2VkQm94KCAxLCBjb250YWluZXJOb2RlcywgcmVwcmVzZW50YXRpb24gKSApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICggcmVwcmVzZW50YXRpb24gPT09IEludHJvUmVwcmVzZW50YXRpb24uVkVSVElDQUxfQkFSICkge1xyXG4gICAgICAgICAgY29udGFpbmVyTm9kZXMgPSBjb250YWluZXJzLm1hcCggY29udGFpbmVyID0+IG5ldyBSZWN0YW5ndWxhckNvbnRhaW5lck5vZGUoIGNvbnRhaW5lciwge1xyXG4gICAgICAgICAgICByZWN0YW5ndWxhck9yaWVudGF0aW9uOiBSZWN0YW5ndWxhck9yaWVudGF0aW9uLlZFUlRJQ0FMLFxyXG4gICAgICAgICAgICBjb2xvck92ZXJyaWRlOiBjb2xvck92ZXJyaWRlXHJcbiAgICAgICAgICB9ICkgKTtcclxuICAgICAgICAgIG11bHRpcGxpZWRWaWV3Q29udGFpbmVyLmFkZENoaWxkKCBzcGFjZWRCb3goIDQsIGNvbnRhaW5lck5vZGVzLCByZXByZXNlbnRhdGlvbiApICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCByZXByZXNlbnRhdGlvbiA9PT0gSW50cm9SZXByZXNlbnRhdGlvbi5CRUFLRVIgKSB7XHJcbiAgICAgICAgICBjb250YWluZXJOb2RlcyA9IGNvbnRhaW5lcnMubWFwKCBjb250YWluZXIgPT4gbmV3IEJlYWtlckNvbnRhaW5lck5vZGUoIGNvbnRhaW5lciwge1xyXG4gICAgICAgICAgICBjb2xvck92ZXJyaWRlOiBGcmFjdGlvbnNDb21tb25Db2xvcnMuZXF1YWxpdHlMYWJXYXRlclByb3BlcnR5XHJcbiAgICAgICAgICB9ICkgKTtcclxuICAgICAgICAgIG11bHRpcGxpZWRWaWV3Q29udGFpbmVyLmFkZENoaWxkKCBzcGFjZWRCb3goIDQsIGNvbnRhaW5lck5vZGVzLCByZXByZXNlbnRhdGlvbiApICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCByZXByZXNlbnRhdGlvbiA9PT0gSW50cm9SZXByZXNlbnRhdGlvbi5OVU1CRVJfTElORSApIHtcclxuICAgICAgICAgIGNvbnN0IG11bHRpcGxpZWROdW1iZXJMaW5lID0gbmV3IE51bWJlckxpbmVOb2RlKCBtb2RlbC5udW1lcmF0b3JQcm9wZXJ0eSwgbW9kZWwuZGVub21pbmF0b3JQcm9wZXJ0eSwgbW9kZWwuY29udGFpbmVyQ291bnRQcm9wZXJ0eSwge1xyXG4gICAgICAgICAgICBtdWx0aXBsaWVyUHJvcGVydHk6IG1vZGVsLm11bHRpcGxpZXJQcm9wZXJ0eSxcclxuICAgICAgICAgICAgb3JpZW50YXRpb246IE51bWJlckxpbmVPcmllbnRhdGlvbi5WRVJUSUNBTCxcclxuICAgICAgICAgICAgdW5pdFNpemU6IDYwLFxyXG4gICAgICAgICAgICBhcnJvd0ZpbGw6IGNvbG9yT3ZlcnJpZGUsXHJcbiAgICAgICAgICAgIG1hcmtlckZpbGw6IHNlbWl0cmFuc3BhcmVudENvbG9yT3ZlcnJpZGUsXHJcbiAgICAgICAgICAgIHNob3dBcnJvdzogdHJ1ZSxcclxuICAgICAgICAgICAgbWFya2VyTGluZVdpZHRoOiAyLFxyXG4gICAgICAgICAgICBtYXJrZXJSYWRpdXM6IDgsXHJcbiAgICAgICAgICAgIGFycm93T2Zmc2V0OiAxNVxyXG4gICAgICAgICAgfSApO1xyXG4gICAgICAgICAgY29udGFpbmVyTm9kZXMgPSBbIG11bHRpcGxpZWROdW1iZXJMaW5lIF07XHJcbiAgICAgICAgICBtdWx0aXBsaWVkVmlld0NvbnRhaW5lci5hZGRDaGlsZCggbXVsdGlwbGllZE51bWJlckxpbmUgKTtcclxuXHJcbiAgICAgICAgICBjb25zdCBwYXJlbnRMYXlvdXRQb2ludCA9IG11bHRpcGxpZWROdW1iZXJMaW5lLmxvY2FsVG9QYXJlbnRQb2ludCggbXVsdGlwbGllZE51bWJlckxpbmUubG9jYWxMYXlvdXRQb2ludCApO1xyXG4gICAgICAgICAgY29udGFpbmVyT2Zmc2V0ID0gbXVsdGlwbGllZE51bWJlckxpbmUubGVmdCAtIHBhcmVudExheW91dFBvaW50Lng7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIG11bHRpcGxpZWRWaWV3Q29udGFpbmVyLmJvdW5kcy5pc1ZhbGlkKCkgKSB7XHJcbiAgICAgICAgICBtdWx0aXBsaWVkVmlld0NvbnRhaW5lci5sZWZ0ID0gbXVsdGlwbGllZEZyYWN0aW9uTm9kZS5sZWZ0ICsgY29udGFpbmVyT2Zmc2V0O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyB0aGUgaWNvbiBmb3IgdGhlIHNjcmVlbi5cclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7Tm9kZX1cclxuICAgKi9cclxuICBzdGF0aWMgY3JlYXRlU2NyZWVuSWNvbigpIHtcclxuICAgIGNvbnN0IGxlZnRDb250YWluZXIgPSBuZXcgQ29udGFpbmVyKCk7XHJcbiAgICBjb25zdCByaWdodENvbnRhaW5lciA9IG5ldyBDb250YWluZXIoKTtcclxuXHJcbiAgICBsZWZ0Q29udGFpbmVyLmFkZENlbGxzKCAzICk7XHJcbiAgICByaWdodENvbnRhaW5lci5hZGRDZWxscyggOSApO1xyXG5cclxuICAgIF8udGltZXMoIDIsICgpID0+IHtcclxuICAgICAgbGVmdENvbnRhaW5lci5nZXROZXh0RW1wdHlDZWxsKCkuc2V0RmlsbGVkKCB0cnVlICk7XHJcbiAgICB9ICk7XHJcbiAgICBfLnRpbWVzKCA2LCAoKSA9PiB7XHJcbiAgICAgIHJpZ2h0Q29udGFpbmVyLmdldE5leHRFbXB0eUNlbGwoKS5zZXRGaWxsZWQoIHRydWUgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBlcXVhbHNUZXh0ID0gbmV3IFRleHQoIE1hdGhTeW1ib2xzLkVRVUFMX1RPLCB7IGZvbnQ6IG5ldyBQaGV0Rm9udCggODAgKSB9ICk7XHJcblxyXG4gICAgY29uc3QgbGVmdENvbnRhaW5lck5vZGUgPSBuZXcgUmVjdGFuZ3VsYXJDb250YWluZXJOb2RlKCBsZWZ0Q29udGFpbmVyICk7XHJcbiAgICBjb25zdCByaWdodENvbnRhaW5lck5vZGUgPSBuZXcgUmVjdGFuZ3VsYXJDb250YWluZXJOb2RlKCByaWdodENvbnRhaW5lciwge1xyXG4gICAgICBjb2xvck92ZXJyaWRlOiBGcmFjdGlvbnNDb21tb25Db2xvcnMuZXF1YWxpdHlMYWJDb2xvclByb3BlcnR5XHJcbiAgICB9ICk7XHJcblxyXG4gICAgcmV0dXJuIEZyYWN0aW9uc0NvbW1vbkdsb2JhbHMud3JhcEljb24oIG5ldyBIQm94KCB7XHJcbiAgICAgIHNwYWNpbmc6IDEzLFxyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIGxlZnRDb250YWluZXJOb2RlLFxyXG4gICAgICAgIGVxdWFsc1RleHQsXHJcbiAgICAgICAgcmlnaHRDb250YWluZXJOb2RlXHJcbiAgICAgIF0sXHJcbiAgICAgIHNjYWxlOiAxLjVcclxuICAgIH0gKSwgRnJhY3Rpb25zQ29tbW9uQ29sb3JzLmludHJvU2NyZWVuQmFja2dyb3VuZFByb3BlcnR5ICk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZnJhY3Rpb25zQ29tbW9uLnJlZ2lzdGVyKCAnRXF1YWxpdHlMYWJTY3JlZW5WaWV3JywgRXF1YWxpdHlMYWJTY3JlZW5WaWV3ICk7XHJcbmV4cG9ydCBkZWZhdWx0IEVxdWFsaXR5TGFiU2NyZWVuVmlldzsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxTQUFTLE1BQU0sa0NBQWtDO0FBQ3hELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsV0FBVyxNQUFNLDRDQUE0QztBQUNwRSxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELE9BQU9DLG9CQUFvQixNQUFNLHFEQUFxRDtBQUN0RixTQUFTQyxRQUFRLEVBQUVDLElBQUksRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDcEYsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyx3QkFBd0IsTUFBTSwwQ0FBMEM7QUFDL0UsT0FBT0Msc0JBQXNCLE1BQU0sd0NBQXdDO0FBQzNFLE9B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