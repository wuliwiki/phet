// Copyright 2018-2022, University of Colorado Boulder

/**
 * Superclass for Group views.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import merge from '../../../../phet-core/js/merge.js';
import { DragListener, Node, PressListener } from '../../../../scenery/js/imports.js';
import fractionsCommon from '../../fractionsCommon.js';
import Group from '../model/Group.js';
class GroupNode extends Node {
  /**
   * @param {Group} group
   * @param {Object} [options]
   */
  constructor(group, options) {
    assert && assert(group instanceof Group);
    options = merge({
      // {boolean} - For pieces placed in stacks/containers, we don't care about the positionProperty. In addition,
      // pieces in stacks/containers ALSO care about not showing up when the piece is user-controlled or animating.
      isIcon: false,
      // {ModelViewTransform2|null}
      modelViewTransform: null,
      // {boolean}
      positioned: true,
      // {function|null} - Listeners for if drag listeners are attached. Passed the pointer.
      dragListener: null,
      dropListener: null,
      selectListener: null,
      // {Property.<boolean>}
      isSelectedProperty: new BooleanProperty(true) // takes ownership, will dispose at the end
    }, options);
    super();

    // @private {Group}
    this.group = group;

    // @private {boolean} - Whether this will just be a "read-only" icon, or a "read-write" view object
    this.isIcon = options.isIcon;

    // @private {ModelViewTransform2|null}
    this.modelViewTransform = options.modelViewTransform;

    // @private {Array.<*>}
    this.itemsToDispose = [];
    assert && assert(this.isIcon || this.modelViewTransform, 'Positioned GroupNodes need a MVT');

    // @private {function}
    this.visibilityListener = isAnimating => {
      if (!options.positioned) {
        this.visible = !isAnimating;
      }
    };
    this.group.isAnimatingProperty.link(this.visibilityListener);

    // @private {Property.<boolean>}
    this.isSelectedProperty = options.isSelectedProperty;
    this.itemsToDispose.push(this.isSelectedProperty);

    // @private {Node}
    this.displayLayer = new Node({
      cursor: 'pointer' // We are where our input listener is added
    });

    this.addChild(this.displayLayer);

    // @private {Node}
    this.controlLayer = new Node();
    this.addChild(this.controlLayer);
    if (!this.isIcon) {
      // @private {function}
      this.positionListener = position => {
        this.translation = this.modelViewTransform.modelToViewPosition(position);
      };
      this.group.positionProperty.link(this.positionListener);

      // @private {function}
      this.scaleListener = scale => {
        this.setScaleMagnitude(scale);
      };
      this.group.scaleProperty.link(this.scaleListener);

      // Don't allow touching once we start animating
      // @private {function}
      this.isAnimatingListener = isAnimating => {
        this.pickable = !isAnimating;
      };
      this.group.isAnimatingProperty.link(this.isAnimatingListener);
    }
  }

  /**
   * Hooks up drag handling.
   * @protected
   *
   * @param {Property.<Bounds2>} dragBoundsProperty
   * @param {Object} [options] - The main options object
   */
  attachDragListener(dragBoundsProperty, options) {
    let pointer = null;

    // @public {DragListener}
    this.dragListener = new DragListener({
      targetNode: this,
      dragBoundsProperty: dragBoundsProperty,
      transform: this.modelViewTransform,
      positionProperty: this.group.positionProperty,
      start: (event, listener) => {
        pointer = listener.pointer;
        options.selectListener && options.selectListener(pointer);
        this.moveToFront();
      },
      drag: () => {
        options.dragListener && options.dragListener(pointer);
      },
      end: () => {
        options.dropListener && options.dropListener(pointer);
      }
    });
    this.itemsToDispose.push(this.dragListener);
    this.displayLayer.addInputListener(this.dragListener);

    // @private {DragListener} - Listener for handling selection/release properly for the controls
    this.controlListener = new PressListener({
      targetNode: this,
      press: (event, listener) => {
        pointer = listener.pointer;
        options.selectListener && options.selectListener(event.pointer);
      },
      release: event => {
        options.dropListener && options.dropListener(pointer);
      },
      attach: false
    });
    this.itemsToDispose.push(this.controlListener);
    this.controlLayer.addInputListener(this.controlListener);
  }

  /**
   * Releases references.
   * @public
   * @override
   */
  dispose() {
    this.group.isAnimatingProperty.unlink(this.visibilityListener);
    this.positionListener && this.group.positionProperty.unlink(this.positionListener);
    this.scaleListener && this.group.scaleProperty.unlink(this.scaleListener);
    this.isAnimatingListener && this.group.isAnimatingProperty.unlink(this.isAnimatingListener);
    this.itemsToDispose.forEach(item => item.dispose());
    super.dispose();
  }
}
fractionsCommon.register('GroupNode', GroupNode);
export default GroupNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJtZXJnZSIsIkRyYWdMaXN0ZW5lciIsIk5vZGUiLCJQcmVzc0xpc3RlbmVyIiwiZnJhY3Rpb25zQ29tbW9uIiwiR3JvdXAiLCJHcm91cE5vZGUiLCJjb25zdHJ1Y3RvciIsImdyb3VwIiwib3B0aW9ucyIsImFzc2VydCIsImlzSWNvbiIsIm1vZGVsVmlld1RyYW5zZm9ybSIsInBvc2l0aW9uZWQiLCJkcmFnTGlzdGVuZXIiLCJkcm9wTGlzdGVuZXIiLCJzZWxlY3RMaXN0ZW5lciIsImlzU2VsZWN0ZWRQcm9wZXJ0eSIsIml0ZW1zVG9EaXNwb3NlIiwidmlzaWJpbGl0eUxpc3RlbmVyIiwiaXNBbmltYXRpbmciLCJ2aXNpYmxlIiwiaXNBbmltYXRpbmdQcm9wZXJ0eSIsImxpbmsiLCJwdXNoIiwiZGlzcGxheUxheWVyIiwiY3Vyc29yIiwiYWRkQ2hpbGQiLCJjb250cm9sTGF5ZXIiLCJwb3NpdGlvbkxpc3RlbmVyIiwicG9zaXRpb24iLCJ0cmFuc2xhdGlvbiIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJwb3NpdGlvblByb3BlcnR5Iiwic2NhbGVMaXN0ZW5lciIsInNjYWxlIiwic2V0U2NhbGVNYWduaXR1ZGUiLCJzY2FsZVByb3BlcnR5IiwiaXNBbmltYXRpbmdMaXN0ZW5lciIsInBpY2thYmxlIiwiYXR0YWNoRHJhZ0xpc3RlbmVyIiwiZHJhZ0JvdW5kc1Byb3BlcnR5IiwicG9pbnRlciIsInRhcmdldE5vZGUiLCJ0cmFuc2Zvcm0iLCJzdGFydCIsImV2ZW50IiwibGlzdGVuZXIiLCJtb3ZlVG9Gcm9udCIsImRyYWciLCJlbmQiLCJhZGRJbnB1dExpc3RlbmVyIiwiY29udHJvbExpc3RlbmVyIiwicHJlc3MiLCJyZWxlYXNlIiwiYXR0YWNoIiwiZGlzcG9zZSIsInVubGluayIsImZvckVhY2giLCJpdGVtIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJHcm91cE5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU3VwZXJjbGFzcyBmb3IgR3JvdXAgdmlld3MuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCB7IERyYWdMaXN0ZW5lciwgTm9kZSwgUHJlc3NMaXN0ZW5lciB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBmcmFjdGlvbnNDb21tb24gZnJvbSAnLi4vLi4vZnJhY3Rpb25zQ29tbW9uLmpzJztcclxuaW1wb3J0IEdyb3VwIGZyb20gJy4uL21vZGVsL0dyb3VwLmpzJztcclxuXHJcbmNsYXNzIEdyb3VwTm9kZSBleHRlbmRzIE5vZGUge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7R3JvdXB9IGdyb3VwXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBncm91cCwgb3B0aW9ucyApIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGdyb3VwIGluc3RhbmNlb2YgR3JvdXAgKTtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuICAgICAgLy8ge2Jvb2xlYW59IC0gRm9yIHBpZWNlcyBwbGFjZWQgaW4gc3RhY2tzL2NvbnRhaW5lcnMsIHdlIGRvbid0IGNhcmUgYWJvdXQgdGhlIHBvc2l0aW9uUHJvcGVydHkuIEluIGFkZGl0aW9uLFxyXG4gICAgICAvLyBwaWVjZXMgaW4gc3RhY2tzL2NvbnRhaW5lcnMgQUxTTyBjYXJlIGFib3V0IG5vdCBzaG93aW5nIHVwIHdoZW4gdGhlIHBpZWNlIGlzIHVzZXItY29udHJvbGxlZCBvciBhbmltYXRpbmcuXHJcbiAgICAgIGlzSWNvbjogZmFsc2UsXHJcblxyXG4gICAgICAvLyB7TW9kZWxWaWV3VHJhbnNmb3JtMnxudWxsfVxyXG4gICAgICBtb2RlbFZpZXdUcmFuc2Zvcm06IG51bGwsXHJcblxyXG4gICAgICAvLyB7Ym9vbGVhbn1cclxuICAgICAgcG9zaXRpb25lZDogdHJ1ZSxcclxuXHJcbiAgICAgIC8vIHtmdW5jdGlvbnxudWxsfSAtIExpc3RlbmVycyBmb3IgaWYgZHJhZyBsaXN0ZW5lcnMgYXJlIGF0dGFjaGVkLiBQYXNzZWQgdGhlIHBvaW50ZXIuXHJcbiAgICAgIGRyYWdMaXN0ZW5lcjogbnVsbCxcclxuICAgICAgZHJvcExpc3RlbmVyOiBudWxsLFxyXG4gICAgICBzZWxlY3RMaXN0ZW5lcjogbnVsbCxcclxuXHJcbiAgICAgIC8vIHtQcm9wZXJ0eS48Ym9vbGVhbj59XHJcbiAgICAgIGlzU2VsZWN0ZWRQcm9wZXJ0eTogbmV3IEJvb2xlYW5Qcm9wZXJ0eSggdHJ1ZSApIC8vIHRha2VzIG93bmVyc2hpcCwgd2lsbCBkaXNwb3NlIGF0IHRoZSBlbmRcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtHcm91cH1cclxuICAgIHRoaXMuZ3JvdXAgPSBncm91cDtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7Ym9vbGVhbn0gLSBXaGV0aGVyIHRoaXMgd2lsbCBqdXN0IGJlIGEgXCJyZWFkLW9ubHlcIiBpY29uLCBvciBhIFwicmVhZC13cml0ZVwiIHZpZXcgb2JqZWN0XHJcbiAgICB0aGlzLmlzSWNvbiA9IG9wdGlvbnMuaXNJY29uO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfG51bGx9XHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSA9IG9wdGlvbnMubW9kZWxWaWV3VHJhbnNmb3JtO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtBcnJheS48Kj59XHJcbiAgICB0aGlzLml0ZW1zVG9EaXNwb3NlID0gW107XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5pc0ljb24gfHwgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0sICdQb3NpdGlvbmVkIEdyb3VwTm9kZXMgbmVlZCBhIE1WVCcgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7ZnVuY3Rpb259XHJcbiAgICB0aGlzLnZpc2liaWxpdHlMaXN0ZW5lciA9IGlzQW5pbWF0aW5nID0+IHtcclxuICAgICAgaWYgKCAhb3B0aW9ucy5wb3NpdGlvbmVkICkge1xyXG4gICAgICAgIHRoaXMudmlzaWJsZSA9ICFpc0FuaW1hdGluZztcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHRoaXMuZ3JvdXAuaXNBbmltYXRpbmdQcm9wZXJ0eS5saW5rKCB0aGlzLnZpc2liaWxpdHlMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtQcm9wZXJ0eS48Ym9vbGVhbj59XHJcbiAgICB0aGlzLmlzU2VsZWN0ZWRQcm9wZXJ0eSA9IG9wdGlvbnMuaXNTZWxlY3RlZFByb3BlcnR5O1xyXG4gICAgdGhpcy5pdGVtc1RvRGlzcG9zZS5wdXNoKCB0aGlzLmlzU2VsZWN0ZWRQcm9wZXJ0eSApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtOb2RlfVxyXG4gICAgdGhpcy5kaXNwbGF5TGF5ZXIgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyAvLyBXZSBhcmUgd2hlcmUgb3VyIGlucHV0IGxpc3RlbmVyIGlzIGFkZGVkXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLmRpc3BsYXlMYXllciApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtOb2RlfVxyXG4gICAgdGhpcy5jb250cm9sTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5jb250cm9sTGF5ZXIgKTtcclxuXHJcbiAgICBpZiAoICF0aGlzLmlzSWNvbiApIHtcclxuICAgICAgLy8gQHByaXZhdGUge2Z1bmN0aW9ufVxyXG4gICAgICB0aGlzLnBvc2l0aW9uTGlzdGVuZXIgPSBwb3NpdGlvbiA9PiB7XHJcbiAgICAgICAgdGhpcy50cmFuc2xhdGlvbiA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIHBvc2l0aW9uICk7XHJcbiAgICAgIH07XHJcbiAgICAgIHRoaXMuZ3JvdXAucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCB0aGlzLnBvc2l0aW9uTGlzdGVuZXIgKTtcclxuXHJcbiAgICAgIC8vIEBwcml2YXRlIHtmdW5jdGlvbn1cclxuICAgICAgdGhpcy5zY2FsZUxpc3RlbmVyID0gc2NhbGUgPT4ge1xyXG4gICAgICAgIHRoaXMuc2V0U2NhbGVNYWduaXR1ZGUoIHNjYWxlICk7XHJcbiAgICAgIH07XHJcbiAgICAgIHRoaXMuZ3JvdXAuc2NhbGVQcm9wZXJ0eS5saW5rKCB0aGlzLnNjYWxlTGlzdGVuZXIgKTtcclxuXHJcbiAgICAgIC8vIERvbid0IGFsbG93IHRvdWNoaW5nIG9uY2Ugd2Ugc3RhcnQgYW5pbWF0aW5nXHJcbiAgICAgIC8vIEBwcml2YXRlIHtmdW5jdGlvbn1cclxuICAgICAgdGhpcy5pc0FuaW1hdGluZ0xpc3RlbmVyID0gaXNBbmltYXRpbmcgPT4ge1xyXG4gICAgICAgIHRoaXMucGlja2FibGUgPSAhaXNBbmltYXRpbmc7XHJcbiAgICAgIH07XHJcbiAgICAgIHRoaXMuZ3JvdXAuaXNBbmltYXRpbmdQcm9wZXJ0eS5saW5rKCB0aGlzLmlzQW5pbWF0aW5nTGlzdGVuZXIgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhvb2tzIHVwIGRyYWcgaGFuZGxpbmcuXHJcbiAgICogQHByb3RlY3RlZFxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Qm91bmRzMj59IGRyYWdCb3VuZHNQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gLSBUaGUgbWFpbiBvcHRpb25zIG9iamVjdFxyXG4gICAqL1xyXG4gIGF0dGFjaERyYWdMaXN0ZW5lciggZHJhZ0JvdW5kc1Byb3BlcnR5LCBvcHRpb25zICkge1xyXG5cclxuICAgIGxldCBwb2ludGVyID0gbnVsbDtcclxuXHJcbiAgICAvLyBAcHVibGljIHtEcmFnTGlzdGVuZXJ9XHJcbiAgICB0aGlzLmRyYWdMaXN0ZW5lciA9IG5ldyBEcmFnTGlzdGVuZXIoIHtcclxuICAgICAgdGFyZ2V0Tm9kZTogdGhpcyxcclxuICAgICAgZHJhZ0JvdW5kc1Byb3BlcnR5OiBkcmFnQm91bmRzUHJvcGVydHksXHJcbiAgICAgIHRyYW5zZm9ybTogdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0sXHJcbiAgICAgIHBvc2l0aW9uUHJvcGVydHk6IHRoaXMuZ3JvdXAucG9zaXRpb25Qcm9wZXJ0eSxcclxuICAgICAgc3RhcnQ6ICggZXZlbnQsIGxpc3RlbmVyICkgPT4ge1xyXG4gICAgICAgIHBvaW50ZXIgPSBsaXN0ZW5lci5wb2ludGVyO1xyXG5cclxuICAgICAgICBvcHRpb25zLnNlbGVjdExpc3RlbmVyICYmIG9wdGlvbnMuc2VsZWN0TGlzdGVuZXIoIHBvaW50ZXIgKTtcclxuICAgICAgICB0aGlzLm1vdmVUb0Zyb250KCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGRyYWc6ICgpID0+IHtcclxuICAgICAgICBvcHRpb25zLmRyYWdMaXN0ZW5lciAmJiBvcHRpb25zLmRyYWdMaXN0ZW5lciggcG9pbnRlciApO1xyXG4gICAgICB9LFxyXG4gICAgICBlbmQ6ICgpID0+IHtcclxuICAgICAgICBvcHRpb25zLmRyb3BMaXN0ZW5lciAmJiBvcHRpb25zLmRyb3BMaXN0ZW5lciggcG9pbnRlciApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLml0ZW1zVG9EaXNwb3NlLnB1c2goIHRoaXMuZHJhZ0xpc3RlbmVyICk7XHJcbiAgICB0aGlzLmRpc3BsYXlMYXllci5hZGRJbnB1dExpc3RlbmVyKCB0aGlzLmRyYWdMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtEcmFnTGlzdGVuZXJ9IC0gTGlzdGVuZXIgZm9yIGhhbmRsaW5nIHNlbGVjdGlvbi9yZWxlYXNlIHByb3Blcmx5IGZvciB0aGUgY29udHJvbHNcclxuICAgIHRoaXMuY29udHJvbExpc3RlbmVyID0gbmV3IFByZXNzTGlzdGVuZXIoIHtcclxuICAgICAgdGFyZ2V0Tm9kZTogdGhpcyxcclxuICAgICAgcHJlc3M6ICggZXZlbnQsIGxpc3RlbmVyICkgPT4ge1xyXG4gICAgICAgIHBvaW50ZXIgPSBsaXN0ZW5lci5wb2ludGVyO1xyXG5cclxuICAgICAgICBvcHRpb25zLnNlbGVjdExpc3RlbmVyICYmIG9wdGlvbnMuc2VsZWN0TGlzdGVuZXIoIGV2ZW50LnBvaW50ZXIgKTtcclxuICAgICAgfSxcclxuICAgICAgcmVsZWFzZTogZXZlbnQgPT4ge1xyXG4gICAgICAgIG9wdGlvbnMuZHJvcExpc3RlbmVyICYmIG9wdGlvbnMuZHJvcExpc3RlbmVyKCBwb2ludGVyICk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGF0dGFjaDogZmFsc2VcclxuICAgIH0gKTtcclxuICAgIHRoaXMuaXRlbXNUb0Rpc3Bvc2UucHVzaCggdGhpcy5jb250cm9sTGlzdGVuZXIgKTtcclxuICAgIHRoaXMuY29udHJvbExheWVyLmFkZElucHV0TGlzdGVuZXIoIHRoaXMuY29udHJvbExpc3RlbmVyICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZWxlYXNlcyByZWZlcmVuY2VzLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKi9cclxuICBkaXNwb3NlKCkge1xyXG4gICAgdGhpcy5ncm91cC5pc0FuaW1hdGluZ1Byb3BlcnR5LnVubGluayggdGhpcy52aXNpYmlsaXR5TGlzdGVuZXIgKTtcclxuICAgIHRoaXMucG9zaXRpb25MaXN0ZW5lciAmJiB0aGlzLmdyb3VwLnBvc2l0aW9uUHJvcGVydHkudW5saW5rKCB0aGlzLnBvc2l0aW9uTGlzdGVuZXIgKTtcclxuICAgIHRoaXMuc2NhbGVMaXN0ZW5lciAmJiB0aGlzLmdyb3VwLnNjYWxlUHJvcGVydHkudW5saW5rKCB0aGlzLnNjYWxlTGlzdGVuZXIgKTtcclxuICAgIHRoaXMuaXNBbmltYXRpbmdMaXN0ZW5lciAmJiB0aGlzLmdyb3VwLmlzQW5pbWF0aW5nUHJvcGVydHkudW5saW5rKCB0aGlzLmlzQW5pbWF0aW5nTGlzdGVuZXIgKTtcclxuICAgIHRoaXMuaXRlbXNUb0Rpc3Bvc2UuZm9yRWFjaCggaXRlbSA9PiBpdGVtLmRpc3Bvc2UoKSApO1xyXG5cclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbmZyYWN0aW9uc0NvbW1vbi5yZWdpc3RlciggJ0dyb3VwTm9kZScsIEdyb3VwTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBHcm91cE5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxTQUFTQyxZQUFZLEVBQUVDLElBQUksRUFBRUMsYUFBYSxRQUFRLG1DQUFtQztBQUNyRixPQUFPQyxlQUFlLE1BQU0sMEJBQTBCO0FBQ3RELE9BQU9DLEtBQUssTUFBTSxtQkFBbUI7QUFFckMsTUFBTUMsU0FBUyxTQUFTSixJQUFJLENBQUM7RUFDM0I7QUFDRjtBQUNBO0FBQ0E7RUFDRUssV0FBV0EsQ0FBRUMsS0FBSyxFQUFFQyxPQUFPLEVBQUc7SUFDNUJDLE1BQU0sSUFBSUEsTUFBTSxDQUFFRixLQUFLLFlBQVlILEtBQU0sQ0FBQztJQUUxQ0ksT0FBTyxHQUFHVCxLQUFLLENBQUU7TUFDZjtNQUNBO01BQ0FXLE1BQU0sRUFBRSxLQUFLO01BRWI7TUFDQUMsa0JBQWtCLEVBQUUsSUFBSTtNQUV4QjtNQUNBQyxVQUFVLEVBQUUsSUFBSTtNQUVoQjtNQUNBQyxZQUFZLEVBQUUsSUFBSTtNQUNsQkMsWUFBWSxFQUFFLElBQUk7TUFDbEJDLGNBQWMsRUFBRSxJQUFJO01BRXBCO01BQ0FDLGtCQUFrQixFQUFFLElBQUlsQixlQUFlLENBQUUsSUFBSyxDQUFDLENBQUM7SUFDbEQsQ0FBQyxFQUFFVSxPQUFRLENBQUM7SUFFWixLQUFLLENBQUMsQ0FBQzs7SUFFUDtJQUNBLElBQUksQ0FBQ0QsS0FBSyxHQUFHQSxLQUFLOztJQUVsQjtJQUNBLElBQUksQ0FBQ0csTUFBTSxHQUFHRixPQUFPLENBQUNFLE1BQU07O0lBRTVCO0lBQ0EsSUFBSSxDQUFDQyxrQkFBa0IsR0FBR0gsT0FBTyxDQUFDRyxrQkFBa0I7O0lBRXBEO0lBQ0EsSUFBSSxDQUFDTSxjQUFjLEdBQUcsRUFBRTtJQUV4QlIsTUFBTSxJQUFJQSxNQUFNLENBQUUsSUFBSSxDQUFDQyxNQUFNLElBQUksSUFBSSxDQUFDQyxrQkFBa0IsRUFBRSxrQ0FBbUMsQ0FBQzs7SUFFOUY7SUFDQSxJQUFJLENBQUNPLGtCQUFrQixHQUFHQyxXQUFXLElBQUk7TUFDdkMsSUFBSyxDQUFDWCxPQUFPLENBQUNJLFVBQVUsRUFBRztRQUN6QixJQUFJLENBQUNRLE9BQU8sR0FBRyxDQUFDRCxXQUFXO01BQzdCO0lBQ0YsQ0FBQztJQUNELElBQUksQ0FBQ1osS0FBSyxDQUFDYyxtQkFBbUIsQ0FBQ0MsSUFBSSxDQUFFLElBQUksQ0FBQ0osa0JBQW1CLENBQUM7O0lBRTlEO0lBQ0EsSUFBSSxDQUFDRixrQkFBa0IsR0FBR1IsT0FBTyxDQUFDUSxrQkFBa0I7SUFDcEQsSUFBSSxDQUFDQyxjQUFjLENBQUNNLElBQUksQ0FBRSxJQUFJLENBQUNQLGtCQUFtQixDQUFDOztJQUVuRDtJQUNBLElBQUksQ0FBQ1EsWUFBWSxHQUFHLElBQUl2QixJQUFJLENBQUU7TUFDNUJ3QixNQUFNLEVBQUUsU0FBUyxDQUFDO0lBQ3BCLENBQUUsQ0FBQzs7SUFDSCxJQUFJLENBQUNDLFFBQVEsQ0FBRSxJQUFJLENBQUNGLFlBQWEsQ0FBQzs7SUFFbEM7SUFDQSxJQUFJLENBQUNHLFlBQVksR0FBRyxJQUFJMUIsSUFBSSxDQUFDLENBQUM7SUFDOUIsSUFBSSxDQUFDeUIsUUFBUSxDQUFFLElBQUksQ0FBQ0MsWUFBYSxDQUFDO0lBRWxDLElBQUssQ0FBQyxJQUFJLENBQUNqQixNQUFNLEVBQUc7TUFDbEI7TUFDQSxJQUFJLENBQUNrQixnQkFBZ0IsR0FBR0MsUUFBUSxJQUFJO1FBQ2xDLElBQUksQ0FBQ0MsV0FBVyxHQUFHLElBQUksQ0FBQ25CLGtCQUFrQixDQUFDb0IsbUJBQW1CLENBQUVGLFFBQVMsQ0FBQztNQUM1RSxDQUFDO01BQ0QsSUFBSSxDQUFDdEIsS0FBSyxDQUFDeUIsZ0JBQWdCLENBQUNWLElBQUksQ0FBRSxJQUFJLENBQUNNLGdCQUFpQixDQUFDOztNQUV6RDtNQUNBLElBQUksQ0FBQ0ssYUFBYSxHQUFHQyxLQUFLLElBQUk7UUFDNUIsSUFBSSxDQUFDQyxpQkFBaUIsQ0FBRUQsS0FBTSxDQUFDO01BQ2pDLENBQUM7TUFDRCxJQUFJLENBQUMzQixLQUFLLENBQUM2QixhQUFhLENBQUNkLElBQUksQ0FBRSxJQUFJLENBQUNXLGFBQWMsQ0FBQzs7TUFFbkQ7TUFDQTtNQUNBLElBQUksQ0FBQ0ksbUJBQW1CLEdBQUdsQixXQUFXLElBQUk7UUFDeEMsSUFBSSxDQUFDbUIsUUFBUSxHQUFHLENBQUNuQixXQUFXO01BQzlCLENBQUM7TUFDRCxJQUFJLENBQUNaLEtBQUssQ0FBQ2MsbUJBQW1CLENBQUNDLElBQUksQ0FBRSxJQUFJLENBQUNlLG1CQUFvQixDQUFDO0lBQ2pFO0VBQ0Y7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRUUsa0JBQWtCQSxDQUFFQyxrQkFBa0IsRUFBRWhDLE9BQU8sRUFBRztJQUVoRCxJQUFJaUMsT0FBTyxHQUFHLElBQUk7O0lBRWxCO0lBQ0EsSUFBSSxDQUFDNUIsWUFBWSxHQUFHLElBQUliLFlBQVksQ0FBRTtNQUNwQzBDLFVBQVUsRUFBRSxJQUFJO01BQ2hCRixrQkFBa0IsRUFBRUEsa0JBQWtCO01BQ3RDRyxTQUFTLEVBQUUsSUFBSSxDQUFDaEMsa0JBQWtCO01BQ2xDcUIsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDekIsS0FBSyxDQUFDeUIsZ0JBQWdCO01BQzdDWSxLQUFLLEVBQUVBLENBQUVDLEtBQUssRUFBRUMsUUFBUSxLQUFNO1FBQzVCTCxPQUFPLEdBQUdLLFFBQVEsQ0FBQ0wsT0FBTztRQUUxQmpDLE9BQU8sQ0FBQ08sY0FBYyxJQUFJUCxPQUFPLENBQUNPLGNBQWMsQ0FBRTBCLE9BQVEsQ0FBQztRQUMzRCxJQUFJLENBQUNNLFdBQVcsQ0FBQyxDQUFDO01BQ3BCLENBQUM7TUFDREMsSUFBSSxFQUFFQSxDQUFBLEtBQU07UUFDVnhDLE9BQU8sQ0FBQ0ssWUFBWSxJQUFJTCxPQUFPLENBQUNLLFlBQVksQ0FBRTRCLE9BQVEsQ0FBQztNQUN6RCxDQUFDO01BQ0RRLEdBQUcsRUFBRUEsQ0FBQSxLQUFNO1FBQ1R6QyxPQUFPLENBQUNNLFlBQVksSUFBSU4sT0FBTyxDQUFDTSxZQUFZLENBQUUyQixPQUFRLENBQUM7TUFDekQ7SUFDRixDQUFFLENBQUM7SUFDSCxJQUFJLENBQUN4QixjQUFjLENBQUNNLElBQUksQ0FBRSxJQUFJLENBQUNWLFlBQWEsQ0FBQztJQUM3QyxJQUFJLENBQUNXLFlBQVksQ0FBQzBCLGdCQUFnQixDQUFFLElBQUksQ0FBQ3JDLFlBQWEsQ0FBQzs7SUFFdkQ7SUFDQSxJQUFJLENBQUNzQyxlQUFlLEdBQUcsSUFBSWpELGFBQWEsQ0FBRTtNQUN4Q3dDLFVBQVUsRUFBRSxJQUFJO01BQ2hCVSxLQUFLLEVBQUVBLENBQUVQLEtBQUssRUFBRUMsUUFBUSxLQUFNO1FBQzVCTCxPQUFPLEdBQUdLLFFBQVEsQ0FBQ0wsT0FBTztRQUUxQmpDLE9BQU8sQ0FBQ08sY0FBYyxJQUFJUCxPQUFPLENBQUNPLGNBQWMsQ0FBRThCLEtBQUssQ0FBQ0osT0FBUSxDQUFDO01BQ25FLENBQUM7TUFDRFksT0FBTyxFQUFFUixLQUFLLElBQUk7UUFDaEJyQyxPQUFPLENBQUNNLFlBQVksSUFBSU4sT0FBTyxDQUFDTSxZQUFZLENBQUUyQixPQUFRLENBQUM7TUFDekQsQ0FBQztNQUNEYSxNQUFNLEVBQUU7SUFDVixDQUFFLENBQUM7SUFDSCxJQUFJLENBQUNyQyxjQUFjLENBQUNNLElBQUksQ0FBRSxJQUFJLENBQUM0QixlQUFnQixDQUFDO0lBQ2hELElBQUksQ0FBQ3hCLFlBQVksQ0FBQ3VCLGdCQUFnQixDQUFFLElBQUksQ0FBQ0MsZUFBZ0IsQ0FBQztFQUM1RDs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0VJLE9BQU9BLENBQUEsRUFBRztJQUNSLElBQUksQ0FBQ2hELEtBQUssQ0FBQ2MsbUJBQW1CLENBQUNtQyxNQUFNLENBQUUsSUFBSSxDQUFDdEMsa0JBQW1CLENBQUM7SUFDaEUsSUFBSSxDQUFDVSxnQkFBZ0IsSUFBSSxJQUFJLENBQUNyQixLQUFLLENBQUN5QixnQkFBZ0IsQ0FBQ3dCLE1BQU0sQ0FBRSxJQUFJLENBQUM1QixnQkFBaUIsQ0FBQztJQUNwRixJQUFJLENBQUNLLGFBQWEsSUFBSSxJQUFJLENBQUMxQixLQUFLLENBQUM2QixhQUFhLENBQUNvQixNQUFNLENBQUUsSUFBSSxDQUFDdkIsYUFBYyxDQUFDO0lBQzNFLElBQUksQ0FBQ0ksbUJBQW1CLElBQUksSUFBSSxDQUFDOUIsS0FBSyxDQUFDYyxtQkFBbUIsQ0FBQ21DLE1BQU0sQ0FBRSxJQUFJLENBQUNuQixtQkFBb0IsQ0FBQztJQUM3RixJQUFJLENBQUNwQixjQUFjLENBQUN3QyxPQUFPLENBQUVDLElBQUksSUFBSUEsSUFBSSxDQUFDSCxPQUFPLENBQUMsQ0FBRSxDQUFDO0lBRXJELEtBQUssQ0FBQ0EsT0FBTyxDQUFDLENBQUM7RUFDakI7QUFDRjtBQUVBcEQsZUFBZSxDQUFDd0QsUUFBUSxDQUFFLFdBQVcsRUFBRXRELFNBQVUsQ0FBQztBQUNsRCxlQUFlQSxTQUFTIn0=