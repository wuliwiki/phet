// Copyright 2018-2021, University of Colorado Boulder

/**
 * View for a ShapeContainer.
 *
 * Its layout should be based around this node being centered (locally) around the proper origin
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import arrayRemove from '../../../../phet-core/js/arrayRemove.js';
import { Node } from '../../../../scenery/js/imports.js';
import fractionsCommon from '../../fractionsCommon.js';
import ShapeContainer from '../model/ShapeContainer.js';
import ShapeLayerNode from './ShapeLayerNode.js';
import ShapePieceNode from './ShapePieceNode.js';
class ShapeContainerNode extends Node {
  /**
   * @param {ShapeContainer} shapeContainer
   * @param {Object} [options]
   */
  constructor(shapeContainer, options) {
    assert && assert(shapeContainer instanceof ShapeContainer);
    super({
      translation: shapeContainer.offset
    });

    // @public {ShapeContainer}
    this.shapeContainer = shapeContainer;

    // @private {Array.<ShapePieceNode>}
    this.shapePieceNodes = [];

    // @private {ShapeLayerNode}
    this.shapeLayerNode = new ShapeLayerNode(shapeContainer.representation, shapeContainer.partitionDenominatorProperty);
    this.addChild(this.shapeLayerNode);

    // @private {Node}
    this.shapePieceLayer = this.shapeLayerNode.shapePieceLayer;

    // @private {function}
    this.shapePieceAddedListener = this.addShapePiece.bind(this);
    this.shapePieceRemovedListener = this.removeShapePiece.bind(this);
    this.shapeContainer.shapePieces.addItemAddedListener(this.shapePieceAddedListener);
    this.shapeContainer.shapePieces.addItemRemovedListener(this.shapePieceRemovedListener);
    this.shapeContainer.shapePieces.forEach(this.shapePieceAddedListener);
    this.mutate(options);
  }

  /**
   * Adds a ShapePiece's view
   * @private
   *
   * @param {ShapePiece} shapePiece
   */
  addShapePiece(shapePiece) {
    assert && assert(shapePiece.representation === this.shapeContainer.representation);
    const shapePieceNode = new ShapePieceNode(shapePiece);
    const ratio = this.shapeContainer.getShapeRatio(shapePiece);
    shapePieceNode.matrix = ShapeContainer.getShapeMatrix(ratio, shapePiece.fraction, shapePiece.representation);
    this.shapePieceNodes.push(shapePieceNode);
    this.shapePieceLayer.addChild(shapePieceNode);
  }

  /**
   * Removes a ShapePiece's view
   * @private
   *
   * @param {ShapePiece} shapePiece
   */
  removeShapePiece(shapePiece) {
    const shapePieceNode = _.find(this.shapePieceNodes, shapePieceNode => {
      return shapePieceNode.shapePiece === shapePiece;
    });
    assert && assert(shapePieceNode);
    arrayRemove(this.shapePieceNodes, shapePieceNode);
    this.shapePieceLayer.removeChild(shapePieceNode);
    shapePieceNode.dispose();
  }

  /**
   * Releases references.
   * @public
   * @override
   */
  dispose() {
    this.shapePieceNodes.forEach(shapePieceNode => shapePieceNode.dispose());
    this.shapeContainer.shapePieces.removeItemAddedListener(this.shapePieceAddedListener);
    this.shapeContainer.shapePieces.removeItemRemovedListener(this.shapePieceRemovedListener);
    this.shapeLayerNode.dispose();
    super.dispose();
  }
}
fractionsCommon.register('ShapeContainerNode', ShapeContainerNode);
export default ShapeContainerNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJhcnJheVJlbW92ZSIsIk5vZGUiLCJmcmFjdGlvbnNDb21tb24iLCJTaGFwZUNvbnRhaW5lciIsIlNoYXBlTGF5ZXJOb2RlIiwiU2hhcGVQaWVjZU5vZGUiLCJTaGFwZUNvbnRhaW5lck5vZGUiLCJjb25zdHJ1Y3RvciIsInNoYXBlQ29udGFpbmVyIiwib3B0aW9ucyIsImFzc2VydCIsInRyYW5zbGF0aW9uIiwib2Zmc2V0Iiwic2hhcGVQaWVjZU5vZGVzIiwic2hhcGVMYXllck5vZGUiLCJyZXByZXNlbnRhdGlvbiIsInBhcnRpdGlvbkRlbm9taW5hdG9yUHJvcGVydHkiLCJhZGRDaGlsZCIsInNoYXBlUGllY2VMYXllciIsInNoYXBlUGllY2VBZGRlZExpc3RlbmVyIiwiYWRkU2hhcGVQaWVjZSIsImJpbmQiLCJzaGFwZVBpZWNlUmVtb3ZlZExpc3RlbmVyIiwicmVtb3ZlU2hhcGVQaWVjZSIsInNoYXBlUGllY2VzIiwiYWRkSXRlbUFkZGVkTGlzdGVuZXIiLCJhZGRJdGVtUmVtb3ZlZExpc3RlbmVyIiwiZm9yRWFjaCIsIm11dGF0ZSIsInNoYXBlUGllY2UiLCJzaGFwZVBpZWNlTm9kZSIsInJhdGlvIiwiZ2V0U2hhcGVSYXRpbyIsIm1hdHJpeCIsImdldFNoYXBlTWF0cml4IiwiZnJhY3Rpb24iLCJwdXNoIiwiXyIsImZpbmQiLCJyZW1vdmVDaGlsZCIsImRpc3Bvc2UiLCJyZW1vdmVJdGVtQWRkZWRMaXN0ZW5lciIsInJlbW92ZUl0ZW1SZW1vdmVkTGlzdGVuZXIiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlNoYXBlQ29udGFpbmVyTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDIxLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBWaWV3IGZvciBhIFNoYXBlQ29udGFpbmVyLlxyXG4gKlxyXG4gKiBJdHMgbGF5b3V0IHNob3VsZCBiZSBiYXNlZCBhcm91bmQgdGhpcyBub2RlIGJlaW5nIGNlbnRlcmVkIChsb2NhbGx5KSBhcm91bmQgdGhlIHByb3BlciBvcmlnaW5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBhcnJheVJlbW92ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvYXJyYXlSZW1vdmUuanMnO1xyXG5pbXBvcnQgeyBOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGZyYWN0aW9uc0NvbW1vbiBmcm9tICcuLi8uLi9mcmFjdGlvbnNDb21tb24uanMnO1xyXG5pbXBvcnQgU2hhcGVDb250YWluZXIgZnJvbSAnLi4vbW9kZWwvU2hhcGVDb250YWluZXIuanMnO1xyXG5pbXBvcnQgU2hhcGVMYXllck5vZGUgZnJvbSAnLi9TaGFwZUxheWVyTm9kZS5qcyc7XHJcbmltcG9ydCBTaGFwZVBpZWNlTm9kZSBmcm9tICcuL1NoYXBlUGllY2VOb2RlLmpzJztcclxuXHJcbmNsYXNzIFNoYXBlQ29udGFpbmVyTm9kZSBleHRlbmRzIE5vZGUge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7U2hhcGVDb250YWluZXJ9IHNoYXBlQ29udGFpbmVyXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBzaGFwZUNvbnRhaW5lciwgb3B0aW9ucyApIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHNoYXBlQ29udGFpbmVyIGluc3RhbmNlb2YgU2hhcGVDb250YWluZXIgKTtcclxuXHJcbiAgICBzdXBlcigge1xyXG4gICAgICB0cmFuc2xhdGlvbjogc2hhcGVDb250YWluZXIub2Zmc2V0XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7U2hhcGVDb250YWluZXJ9XHJcbiAgICB0aGlzLnNoYXBlQ29udGFpbmVyID0gc2hhcGVDb250YWluZXI7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge0FycmF5LjxTaGFwZVBpZWNlTm9kZT59XHJcbiAgICB0aGlzLnNoYXBlUGllY2VOb2RlcyA9IFtdO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtTaGFwZUxheWVyTm9kZX1cclxuICAgIHRoaXMuc2hhcGVMYXllck5vZGUgPSBuZXcgU2hhcGVMYXllck5vZGUoIHNoYXBlQ29udGFpbmVyLnJlcHJlc2VudGF0aW9uLCBzaGFwZUNvbnRhaW5lci5wYXJ0aXRpb25EZW5vbWluYXRvclByb3BlcnR5ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLnNoYXBlTGF5ZXJOb2RlICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge05vZGV9XHJcbiAgICB0aGlzLnNoYXBlUGllY2VMYXllciA9IHRoaXMuc2hhcGVMYXllck5vZGUuc2hhcGVQaWVjZUxheWVyO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtmdW5jdGlvbn1cclxuICAgIHRoaXMuc2hhcGVQaWVjZUFkZGVkTGlzdGVuZXIgPSB0aGlzLmFkZFNoYXBlUGllY2UuYmluZCggdGhpcyApO1xyXG4gICAgdGhpcy5zaGFwZVBpZWNlUmVtb3ZlZExpc3RlbmVyID0gdGhpcy5yZW1vdmVTaGFwZVBpZWNlLmJpbmQoIHRoaXMgKTtcclxuXHJcbiAgICB0aGlzLnNoYXBlQ29udGFpbmVyLnNoYXBlUGllY2VzLmFkZEl0ZW1BZGRlZExpc3RlbmVyKCB0aGlzLnNoYXBlUGllY2VBZGRlZExpc3RlbmVyICk7XHJcbiAgICB0aGlzLnNoYXBlQ29udGFpbmVyLnNoYXBlUGllY2VzLmFkZEl0ZW1SZW1vdmVkTGlzdGVuZXIoIHRoaXMuc2hhcGVQaWVjZVJlbW92ZWRMaXN0ZW5lciApO1xyXG4gICAgdGhpcy5zaGFwZUNvbnRhaW5lci5zaGFwZVBpZWNlcy5mb3JFYWNoKCB0aGlzLnNoYXBlUGllY2VBZGRlZExpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZHMgYSBTaGFwZVBpZWNlJ3Mgdmlld1xyXG4gICAqIEBwcml2YXRlXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge1NoYXBlUGllY2V9IHNoYXBlUGllY2VcclxuICAgKi9cclxuICBhZGRTaGFwZVBpZWNlKCBzaGFwZVBpZWNlICkge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggc2hhcGVQaWVjZS5yZXByZXNlbnRhdGlvbiA9PT0gdGhpcy5zaGFwZUNvbnRhaW5lci5yZXByZXNlbnRhdGlvbiApO1xyXG5cclxuICAgIGNvbnN0IHNoYXBlUGllY2VOb2RlID0gbmV3IFNoYXBlUGllY2VOb2RlKCBzaGFwZVBpZWNlICk7XHJcblxyXG4gICAgY29uc3QgcmF0aW8gPSB0aGlzLnNoYXBlQ29udGFpbmVyLmdldFNoYXBlUmF0aW8oIHNoYXBlUGllY2UgKTtcclxuICAgIHNoYXBlUGllY2VOb2RlLm1hdHJpeCA9IFNoYXBlQ29udGFpbmVyLmdldFNoYXBlTWF0cml4KCByYXRpbywgc2hhcGVQaWVjZS5mcmFjdGlvbiwgc2hhcGVQaWVjZS5yZXByZXNlbnRhdGlvbiApO1xyXG5cclxuICAgIHRoaXMuc2hhcGVQaWVjZU5vZGVzLnB1c2goIHNoYXBlUGllY2VOb2RlICk7XHJcbiAgICB0aGlzLnNoYXBlUGllY2VMYXllci5hZGRDaGlsZCggc2hhcGVQaWVjZU5vZGUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbW92ZXMgYSBTaGFwZVBpZWNlJ3Mgdmlld1xyXG4gICAqIEBwcml2YXRlXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge1NoYXBlUGllY2V9IHNoYXBlUGllY2VcclxuICAgKi9cclxuICByZW1vdmVTaGFwZVBpZWNlKCBzaGFwZVBpZWNlICkge1xyXG4gICAgY29uc3Qgc2hhcGVQaWVjZU5vZGUgPSBfLmZpbmQoIHRoaXMuc2hhcGVQaWVjZU5vZGVzLCBzaGFwZVBpZWNlTm9kZSA9PiB7XHJcbiAgICAgIHJldHVybiBzaGFwZVBpZWNlTm9kZS5zaGFwZVBpZWNlID09PSBzaGFwZVBpZWNlO1xyXG4gICAgfSApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggc2hhcGVQaWVjZU5vZGUgKTtcclxuXHJcbiAgICBhcnJheVJlbW92ZSggdGhpcy5zaGFwZVBpZWNlTm9kZXMsIHNoYXBlUGllY2VOb2RlICk7XHJcbiAgICB0aGlzLnNoYXBlUGllY2VMYXllci5yZW1vdmVDaGlsZCggc2hhcGVQaWVjZU5vZGUgKTtcclxuICAgIHNoYXBlUGllY2VOb2RlLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbGVhc2VzIHJlZmVyZW5jZXMuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqL1xyXG4gIGRpc3Bvc2UoKSB7XHJcbiAgICB0aGlzLnNoYXBlUGllY2VOb2Rlcy5mb3JFYWNoKCBzaGFwZVBpZWNlTm9kZSA9PiBzaGFwZVBpZWNlTm9kZS5kaXNwb3NlKCkgKTtcclxuICAgIHRoaXMuc2hhcGVDb250YWluZXIuc2hhcGVQaWVjZXMucmVtb3ZlSXRlbUFkZGVkTGlzdGVuZXIoIHRoaXMuc2hhcGVQaWVjZUFkZGVkTGlzdGVuZXIgKTtcclxuICAgIHRoaXMuc2hhcGVDb250YWluZXIuc2hhcGVQaWVjZXMucmVtb3ZlSXRlbVJlbW92ZWRMaXN0ZW5lciggdGhpcy5zaGFwZVBpZWNlUmVtb3ZlZExpc3RlbmVyICk7XHJcbiAgICB0aGlzLnNoYXBlTGF5ZXJOb2RlLmRpc3Bvc2UoKTtcclxuXHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5mcmFjdGlvbnNDb21tb24ucmVnaXN0ZXIoICdTaGFwZUNvbnRhaW5lck5vZGUnLCBTaGFwZUNvbnRhaW5lck5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgU2hhcGVDb250YWluZXJOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsV0FBVyxNQUFNLHlDQUF5QztBQUNq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