// Copyright 2018-2022, University of Colorado Boulder

/**
 * View for a ShapePiece.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Multilink from '../../../../axon/js/Multilink.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import merge from '../../../../phet-core/js/merge.js';
import { Circle, DragListener, Node, Path, Rectangle } from '../../../../scenery/js/imports.js';
import FractionsCommonConstants from '../../common/FractionsCommonConstants.js';
import FractionsCommonColors from '../../common/view/FractionsCommonColors.js';
import fractionsCommon from '../../fractionsCommon.js';
import BuildingRepresentation from '../model/BuildingRepresentation.js';
import ShapePiece from '../model/ShapePiece.js';

// constants
const CIRCLE_RADIUS = FractionsCommonConstants.SHAPE_SIZE / 2;
const BAR_WIDTH = FractionsCommonConstants.SHAPE_SIZE;
const BAR_HEIGHT = FractionsCommonConstants.SHAPE_VERTICAL_BAR_HEIGHT;
const SHADOW_VECTOR = new Vector2(4, 4);
class ShapePieceNode extends Node {
  /**
   * @param {ShapePiece} shapePiece
   * @param {Object} [options]
   */
  constructor(shapePiece, options) {
    assert && assert(shapePiece instanceof ShapePiece);
    options = merge({
      // {function|null} - Called when it is dropped, with a single argument of whether it was from a touch.
      dropListener: null,
      // {boolean} - For pieces placed in stacks/containers, we don't care about the positionProperty. In addition,
      // pieces in stacks/containers ALSO care about not showing up when the piece is user-controlled or animating.
      positioned: false,
      // {ModelViewTransform2|null} - If positioned, a model-view-transform should be provided.
      modelViewTransform: null
    }, options);
    super();

    // @public {ShapePiece}
    this.shapePiece = shapePiece;

    // @private {boolean}
    this.positioned = options.positioned;

    // @private {ModelViewTransform2|null}
    this.modelViewTransform = options.modelViewTransform;
    assert && assert(!this.positioned || this.modelViewTransform, 'Positioned ShapePieceNodes need a MVT');
    const fractionValue = shapePiece.fraction.value;
    assert && assert(fractionValue <= 1);

    // @private {Node|null}
    this.viewNode = null;
    this.shadowNode = null;
    const nodeOptions = {
      fill: shapePiece.color,
      stroke: FractionsCommonColors.shapePieceStrokeProperty
    };
    const shadowOptions = {
      fill: FractionsCommonColors.shapeShadowProperty
    };
    if (shapePiece.representation === BuildingRepresentation.PIE) {
      if (fractionValue === 1) {
        this.viewNode = new Circle(CIRCLE_RADIUS, nodeOptions);
        this.shadowNode = new Circle(CIRCLE_RADIUS, shadowOptions);
      } else {
        const translation = ShapePiece.getSweptCentroid(shapePiece.fraction).negated();
        const sliceShape = new Shape().moveTo(translation.x, translation.y).lineTo(CIRCLE_RADIUS + translation.x, translation.y).arc(translation.x, translation.y, CIRCLE_RADIUS, 0, -fractionValue * 2 * Math.PI, true).close();
        this.viewNode = new Path(sliceShape, nodeOptions);
        this.shadowNode = new Path(sliceShape, shadowOptions);
      }
    } else if (shapePiece.representation === BuildingRepresentation.BAR) {
      const width = fractionValue * BAR_WIDTH;
      this.viewNode = new Rectangle(-width / 2, -BAR_HEIGHT / 2, width, BAR_HEIGHT, nodeOptions);
      this.shadowNode = new Rectangle(-width / 2, -BAR_HEIGHT / 2, width, BAR_HEIGHT, shadowOptions);
    } else {
      throw new Error(`Unsupported representation for ShapePieceNode: ${shapePiece.representation}`);
    }
    if (this.positioned) {
      // @private {Node}
      this.shadowContainer = new Node();
      this.shadowContainer.addChild(this.shadowNode);
      this.addChild(this.shadowContainer);
    }
    this.addChild(this.viewNode);

    // @private {function}
    this.positionListener = this.updatePosition.bind(this);
    this.scaleListener = this.updateScale.bind(this);
    this.rotationListener = this.updateRotation.bind(this);
    this.animatingListener = this.updateAnimating.bind(this);
    this.shadowListener = this.updateShadow.bind(this);
    if (this.positioned) {
      this.shapePiece.positionProperty.link(this.positionListener);
      this.shapePiece.scaleProperty.link(this.scaleListener);
      this.shapePiece.rotationProperty.link(this.rotationListener);
      this.shapePiece.isAnimatingProperty.link(this.animatingListener);
      this.shapePiece.shadowProperty.link(this.shadowListener);
    }

    // @private {function}
    this.visibilityListener = Multilink.multilink([shapePiece.isUserControlledProperty, shapePiece.isAnimatingProperty], (isUserControlled, isAnimating) => {
      if (!this.positioned) {
        this.visible = !isUserControlled && !isAnimating;
      }
    });
    let wasTouch = false;

    // @public {DragListener}
    this.dragListener = new DragListener({
      targetNode: this,
      transform: options.modelViewTransform,
      positionProperty: shapePiece.positionProperty,
      start: event => {
        wasTouch = event.pointer.isTouchLike();
      },
      end: () => {
        options.dropListener && options.dropListener(wasTouch);
      }
    });

    // No need to unlink, as we own the given Property (same lifetime, and we own the listener)
    this.dragListener.isUserControlledProperty.link(controlled => {
      shapePiece.isUserControlledProperty.value = controlled;
    });
    this.mutate(options);
  }

  /**
   * Updates the position of this node to correspond to the model position.
   * @public
   */
  updatePosition() {
    this.translation = this.modelViewTransform.modelToViewPosition(this.shapePiece.positionProperty.value);
  }

  /**
   * Updates the rotation of this node to correspond to the model rotation.
   * @public
   */
  updateRotation() {
    this.viewNode.rotation = this.shapePiece.rotationProperty.value;
    if (this.positioned) {
      this.shadowNode.rotation = this.shapePiece.rotationProperty.value;
    }
  }

  /**
   * Updates the scale of this node to correspond to the model scale.
   * @public
   */
  updateScale() {
    this.setScaleMagnitude(this.shapePiece.scaleProperty.value);
  }

  /**
   * Updates whether the shadow is visible or not
   * @public
   */
  updateShadow() {
    this.shadowContainer.translation = SHADOW_VECTOR.timesScalar(this.shapePiece.shadowProperty.value);
  }

  /**
   * Handles animation changes.
   * @public
   */
  updateAnimating() {
    if (this.shapePiece.isAnimatingProperty.value) {
      this.moveToBack();
      this.pickable = false;
    }
  }

  /**
   * Releases references.
   * @public
   * @override
   */
  dispose() {
    // Required disposal, since we are passing the isUserControlledProperty
    this.dragListener.dispose();
    this.visibilityListener.dispose();
    if (this.positioned) {
      this.shapePiece.positionProperty.unlink(this.positionListener);
      this.shapePiece.scaleProperty.unlink(this.scaleListener);
      this.shapePiece.rotationProperty.unlink(this.rotationListener);
      this.shapePiece.isAnimatingProperty.unlink(this.animatingListener);
      this.shapePiece.shadowProperty.unlink(this.shadowListener);
    }
    super.dispose();
  }
}
fractionsCommon.register('ShapePieceNode', ShapePieceNode);
export default ShapePieceNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJWZWN0b3IyIiwiU2hhcGUiLCJtZXJnZSIsIkNpcmNsZSIsIkRyYWdMaXN0ZW5lciIsIk5vZGUiLCJQYXRoIiwiUmVjdGFuZ2xlIiwiRnJhY3Rpb25zQ29tbW9uQ29uc3RhbnRzIiwiRnJhY3Rpb25zQ29tbW9uQ29sb3JzIiwiZnJhY3Rpb25zQ29tbW9uIiwiQnVpbGRpbmdSZXByZXNlbnRhdGlvbiIsIlNoYXBlUGllY2UiLCJDSVJDTEVfUkFESVVTIiwiU0hBUEVfU0laRSIsIkJBUl9XSURUSCIsIkJBUl9IRUlHSFQiLCJTSEFQRV9WRVJUSUNBTF9CQVJfSEVJR0hUIiwiU0hBRE9XX1ZFQ1RPUiIsIlNoYXBlUGllY2VOb2RlIiwiY29uc3RydWN0b3IiLCJzaGFwZVBpZWNlIiwib3B0aW9ucyIsImFzc2VydCIsImRyb3BMaXN0ZW5lciIsInBvc2l0aW9uZWQiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJmcmFjdGlvblZhbHVlIiwiZnJhY3Rpb24iLCJ2YWx1ZSIsInZpZXdOb2RlIiwic2hhZG93Tm9kZSIsIm5vZGVPcHRpb25zIiwiZmlsbCIsImNvbG9yIiwic3Ryb2tlIiwic2hhcGVQaWVjZVN0cm9rZVByb3BlcnR5Iiwic2hhZG93T3B0aW9ucyIsInNoYXBlU2hhZG93UHJvcGVydHkiLCJyZXByZXNlbnRhdGlvbiIsIlBJRSIsInRyYW5zbGF0aW9uIiwiZ2V0U3dlcHRDZW50cm9pZCIsIm5lZ2F0ZWQiLCJzbGljZVNoYXBlIiwibW92ZVRvIiwieCIsInkiLCJsaW5lVG8iLCJhcmMiLCJNYXRoIiwiUEkiLCJjbG9zZSIsIkJBUiIsIndpZHRoIiwiRXJyb3IiLCJzaGFkb3dDb250YWluZXIiLCJhZGRDaGlsZCIsInBvc2l0aW9uTGlzdGVuZXIiLCJ1cGRhdGVQb3NpdGlvbiIsImJpbmQiLCJzY2FsZUxpc3RlbmVyIiwidXBkYXRlU2NhbGUiLCJyb3RhdGlvbkxpc3RlbmVyIiwidXBkYXRlUm90YXRpb24iLCJhbmltYXRpbmdMaXN0ZW5lciIsInVwZGF0ZUFuaW1hdGluZyIsInNoYWRvd0xpc3RlbmVyIiwidXBkYXRlU2hhZG93IiwicG9zaXRpb25Qcm9wZXJ0eSIsImxpbmsiLCJzY2FsZVByb3BlcnR5Iiwicm90YXRpb25Qcm9wZXJ0eSIsImlzQW5pbWF0aW5nUHJvcGVydHkiLCJzaGFkb3dQcm9wZXJ0eSIsInZpc2liaWxpdHlMaXN0ZW5lciIsIm11bHRpbGluayIsImlzVXNlckNvbnRyb2xsZWRQcm9wZXJ0eSIsImlzVXNlckNvbnRyb2xsZWQiLCJpc0FuaW1hdGluZyIsInZpc2libGUiLCJ3YXNUb3VjaCIsImRyYWdMaXN0ZW5lciIsInRhcmdldE5vZGUiLCJ0cmFuc2Zvcm0iLCJzdGFydCIsImV2ZW50IiwicG9pbnRlciIsImlzVG91Y2hMaWtlIiwiZW5kIiwiY29udHJvbGxlZCIsIm11dGF0ZSIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJyb3RhdGlvbiIsInNldFNjYWxlTWFnbml0dWRlIiwidGltZXNTY2FsYXIiLCJtb3ZlVG9CYWNrIiwicGlja2FibGUiLCJkaXNwb3NlIiwidW5saW5rIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJTaGFwZVBpZWNlTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBWaWV3IGZvciBhIFNoYXBlUGllY2UuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgeyBDaXJjbGUsIERyYWdMaXN0ZW5lciwgTm9kZSwgUGF0aCwgUmVjdGFuZ2xlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEZyYWN0aW9uc0NvbW1vbkNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vRnJhY3Rpb25zQ29tbW9uQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEZyYWN0aW9uc0NvbW1vbkNvbG9ycyBmcm9tICcuLi8uLi9jb21tb24vdmlldy9GcmFjdGlvbnNDb21tb25Db2xvcnMuanMnO1xyXG5pbXBvcnQgZnJhY3Rpb25zQ29tbW9uIGZyb20gJy4uLy4uL2ZyYWN0aW9uc0NvbW1vbi5qcyc7XHJcbmltcG9ydCBCdWlsZGluZ1JlcHJlc2VudGF0aW9uIGZyb20gJy4uL21vZGVsL0J1aWxkaW5nUmVwcmVzZW50YXRpb24uanMnO1xyXG5pbXBvcnQgU2hhcGVQaWVjZSBmcm9tICcuLi9tb2RlbC9TaGFwZVBpZWNlLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBDSVJDTEVfUkFESVVTID0gRnJhY3Rpb25zQ29tbW9uQ29uc3RhbnRzLlNIQVBFX1NJWkUgLyAyO1xyXG5jb25zdCBCQVJfV0lEVEggPSBGcmFjdGlvbnNDb21tb25Db25zdGFudHMuU0hBUEVfU0laRTtcclxuY29uc3QgQkFSX0hFSUdIVCA9IEZyYWN0aW9uc0NvbW1vbkNvbnN0YW50cy5TSEFQRV9WRVJUSUNBTF9CQVJfSEVJR0hUO1xyXG5jb25zdCBTSEFET1dfVkVDVE9SID0gbmV3IFZlY3RvcjIoIDQsIDQgKTtcclxuXHJcbmNsYXNzIFNoYXBlUGllY2VOb2RlIGV4dGVuZHMgTm9kZSB7XHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtTaGFwZVBpZWNlfSBzaGFwZVBpZWNlXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBzaGFwZVBpZWNlLCBvcHRpb25zICkge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggc2hhcGVQaWVjZSBpbnN0YW5jZW9mIFNoYXBlUGllY2UgKTtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuICAgICAgLy8ge2Z1bmN0aW9ufG51bGx9IC0gQ2FsbGVkIHdoZW4gaXQgaXMgZHJvcHBlZCwgd2l0aCBhIHNpbmdsZSBhcmd1bWVudCBvZiB3aGV0aGVyIGl0IHdhcyBmcm9tIGEgdG91Y2guXHJcbiAgICAgIGRyb3BMaXN0ZW5lcjogbnVsbCxcclxuXHJcbiAgICAgIC8vIHtib29sZWFufSAtIEZvciBwaWVjZXMgcGxhY2VkIGluIHN0YWNrcy9jb250YWluZXJzLCB3ZSBkb24ndCBjYXJlIGFib3V0IHRoZSBwb3NpdGlvblByb3BlcnR5LiBJbiBhZGRpdGlvbixcclxuICAgICAgLy8gcGllY2VzIGluIHN0YWNrcy9jb250YWluZXJzIEFMU08gY2FyZSBhYm91dCBub3Qgc2hvd2luZyB1cCB3aGVuIHRoZSBwaWVjZSBpcyB1c2VyLWNvbnRyb2xsZWQgb3IgYW5pbWF0aW5nLlxyXG4gICAgICBwb3NpdGlvbmVkOiBmYWxzZSxcclxuXHJcbiAgICAgIC8vIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfG51bGx9IC0gSWYgcG9zaXRpb25lZCwgYSBtb2RlbC12aWV3LXRyYW5zZm9ybSBzaG91bGQgYmUgcHJvdmlkZWQuXHJcbiAgICAgIG1vZGVsVmlld1RyYW5zZm9ybTogbnVsbFxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7U2hhcGVQaWVjZX1cclxuICAgIHRoaXMuc2hhcGVQaWVjZSA9IHNoYXBlUGllY2U7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge2Jvb2xlYW59XHJcbiAgICB0aGlzLnBvc2l0aW9uZWQgPSBvcHRpb25zLnBvc2l0aW9uZWQ7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge01vZGVsVmlld1RyYW5zZm9ybTJ8bnVsbH1cclxuICAgIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtID0gb3B0aW9ucy5tb2RlbFZpZXdUcmFuc2Zvcm07XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggIXRoaXMucG9zaXRpb25lZCB8fCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSwgJ1Bvc2l0aW9uZWQgU2hhcGVQaWVjZU5vZGVzIG5lZWQgYSBNVlQnICk7XHJcblxyXG4gICAgY29uc3QgZnJhY3Rpb25WYWx1ZSA9IHNoYXBlUGllY2UuZnJhY3Rpb24udmFsdWU7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmcmFjdGlvblZhbHVlIDw9IDEgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7Tm9kZXxudWxsfVxyXG4gICAgdGhpcy52aWV3Tm9kZSA9IG51bGw7XHJcbiAgICB0aGlzLnNoYWRvd05vZGUgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0IG5vZGVPcHRpb25zID0ge1xyXG4gICAgICBmaWxsOiBzaGFwZVBpZWNlLmNvbG9yLFxyXG4gICAgICBzdHJva2U6IEZyYWN0aW9uc0NvbW1vbkNvbG9ycy5zaGFwZVBpZWNlU3Ryb2tlUHJvcGVydHlcclxuICAgIH07XHJcbiAgICBjb25zdCBzaGFkb3dPcHRpb25zID0ge1xyXG4gICAgICBmaWxsOiBGcmFjdGlvbnNDb21tb25Db2xvcnMuc2hhcGVTaGFkb3dQcm9wZXJ0eVxyXG4gICAgfTtcclxuICAgIGlmICggc2hhcGVQaWVjZS5yZXByZXNlbnRhdGlvbiA9PT0gQnVpbGRpbmdSZXByZXNlbnRhdGlvbi5QSUUgKSB7XHJcbiAgICAgIGlmICggZnJhY3Rpb25WYWx1ZSA9PT0gMSApIHtcclxuICAgICAgICB0aGlzLnZpZXdOb2RlID0gbmV3IENpcmNsZSggQ0lSQ0xFX1JBRElVUywgbm9kZU9wdGlvbnMgKTtcclxuICAgICAgICB0aGlzLnNoYWRvd05vZGUgPSBuZXcgQ2lyY2xlKCBDSVJDTEVfUkFESVVTLCBzaGFkb3dPcHRpb25zICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgY29uc3QgdHJhbnNsYXRpb24gPSBTaGFwZVBpZWNlLmdldFN3ZXB0Q2VudHJvaWQoIHNoYXBlUGllY2UuZnJhY3Rpb24gKS5uZWdhdGVkKCk7XHJcbiAgICAgICAgY29uc3Qgc2xpY2VTaGFwZSA9IG5ldyBTaGFwZSgpLm1vdmVUbyggdHJhbnNsYXRpb24ueCwgdHJhbnNsYXRpb24ueSApXHJcbiAgICAgICAgICAubGluZVRvKCBDSVJDTEVfUkFESVVTICsgdHJhbnNsYXRpb24ueCwgdHJhbnNsYXRpb24ueSApXHJcbiAgICAgICAgICAuYXJjKCB0cmFuc2xhdGlvbi54LCB0cmFuc2xhdGlvbi55LCBDSVJDTEVfUkFESVVTLCAwLCAtZnJhY3Rpb25WYWx1ZSAqIDIgKiBNYXRoLlBJLCB0cnVlIClcclxuICAgICAgICAgIC5jbG9zZSgpO1xyXG4gICAgICAgIHRoaXMudmlld05vZGUgPSBuZXcgUGF0aCggc2xpY2VTaGFwZSwgbm9kZU9wdGlvbnMgKTtcclxuICAgICAgICB0aGlzLnNoYWRvd05vZGUgPSBuZXcgUGF0aCggc2xpY2VTaGFwZSwgc2hhZG93T3B0aW9ucyApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggc2hhcGVQaWVjZS5yZXByZXNlbnRhdGlvbiA9PT0gQnVpbGRpbmdSZXByZXNlbnRhdGlvbi5CQVIgKSB7XHJcbiAgICAgIGNvbnN0IHdpZHRoID0gZnJhY3Rpb25WYWx1ZSAqIEJBUl9XSURUSDtcclxuICAgICAgdGhpcy52aWV3Tm9kZSA9IG5ldyBSZWN0YW5nbGUoIC13aWR0aCAvIDIsIC1CQVJfSEVJR0hUIC8gMiwgd2lkdGgsIEJBUl9IRUlHSFQsIG5vZGVPcHRpb25zICk7XHJcbiAgICAgIHRoaXMuc2hhZG93Tm9kZSA9IG5ldyBSZWN0YW5nbGUoIC13aWR0aCAvIDIsIC1CQVJfSEVJR0hUIC8gMiwgd2lkdGgsIEJBUl9IRUlHSFQsIHNoYWRvd09wdGlvbnMgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoIGBVbnN1cHBvcnRlZCByZXByZXNlbnRhdGlvbiBmb3IgU2hhcGVQaWVjZU5vZGU6ICR7c2hhcGVQaWVjZS5yZXByZXNlbnRhdGlvbn1gICk7XHJcbiAgICB9XHJcbiAgICBpZiAoIHRoaXMucG9zaXRpb25lZCApIHtcclxuICAgICAgLy8gQHByaXZhdGUge05vZGV9XHJcbiAgICAgIHRoaXMuc2hhZG93Q29udGFpbmVyID0gbmV3IE5vZGUoKTtcclxuICAgICAgdGhpcy5zaGFkb3dDb250YWluZXIuYWRkQ2hpbGQoIHRoaXMuc2hhZG93Tm9kZSApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCB0aGlzLnNoYWRvd0NvbnRhaW5lciApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy52aWV3Tm9kZSApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtmdW5jdGlvbn1cclxuICAgIHRoaXMucG9zaXRpb25MaXN0ZW5lciA9IHRoaXMudXBkYXRlUG9zaXRpb24uYmluZCggdGhpcyApO1xyXG4gICAgdGhpcy5zY2FsZUxpc3RlbmVyID0gdGhpcy51cGRhdGVTY2FsZS5iaW5kKCB0aGlzICk7XHJcbiAgICB0aGlzLnJvdGF0aW9uTGlzdGVuZXIgPSB0aGlzLnVwZGF0ZVJvdGF0aW9uLmJpbmQoIHRoaXMgKTtcclxuICAgIHRoaXMuYW5pbWF0aW5nTGlzdGVuZXIgPSB0aGlzLnVwZGF0ZUFuaW1hdGluZy5iaW5kKCB0aGlzICk7XHJcbiAgICB0aGlzLnNoYWRvd0xpc3RlbmVyID0gdGhpcy51cGRhdGVTaGFkb3cuYmluZCggdGhpcyApO1xyXG4gICAgaWYgKCB0aGlzLnBvc2l0aW9uZWQgKSB7XHJcbiAgICAgIHRoaXMuc2hhcGVQaWVjZS5wb3NpdGlvblByb3BlcnR5LmxpbmsoIHRoaXMucG9zaXRpb25MaXN0ZW5lciApO1xyXG4gICAgICB0aGlzLnNoYXBlUGllY2Uuc2NhbGVQcm9wZXJ0eS5saW5rKCB0aGlzLnNjYWxlTGlzdGVuZXIgKTtcclxuICAgICAgdGhpcy5zaGFwZVBpZWNlLnJvdGF0aW9uUHJvcGVydHkubGluayggdGhpcy5yb3RhdGlvbkxpc3RlbmVyICk7XHJcbiAgICAgIHRoaXMuc2hhcGVQaWVjZS5pc0FuaW1hdGluZ1Byb3BlcnR5LmxpbmsoIHRoaXMuYW5pbWF0aW5nTGlzdGVuZXIgKTtcclxuICAgICAgdGhpcy5zaGFwZVBpZWNlLnNoYWRvd1Byb3BlcnR5LmxpbmsoIHRoaXMuc2hhZG93TGlzdGVuZXIgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7ZnVuY3Rpb259XHJcbiAgICB0aGlzLnZpc2liaWxpdHlMaXN0ZW5lciA9IE11bHRpbGluay5tdWx0aWxpbmsoIFtcclxuICAgICAgc2hhcGVQaWVjZS5pc1VzZXJDb250cm9sbGVkUHJvcGVydHksXHJcbiAgICAgIHNoYXBlUGllY2UuaXNBbmltYXRpbmdQcm9wZXJ0eVxyXG4gICAgXSwgKCBpc1VzZXJDb250cm9sbGVkLCBpc0FuaW1hdGluZyApID0+IHtcclxuICAgICAgaWYgKCAhdGhpcy5wb3NpdGlvbmVkICkge1xyXG4gICAgICAgIHRoaXMudmlzaWJsZSA9ICFpc1VzZXJDb250cm9sbGVkICYmICFpc0FuaW1hdGluZztcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIGxldCB3YXNUb3VjaCA9IGZhbHNlO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge0RyYWdMaXN0ZW5lcn1cclxuICAgIHRoaXMuZHJhZ0xpc3RlbmVyID0gbmV3IERyYWdMaXN0ZW5lcigge1xyXG4gICAgICB0YXJnZXROb2RlOiB0aGlzLFxyXG4gICAgICB0cmFuc2Zvcm06IG9wdGlvbnMubW9kZWxWaWV3VHJhbnNmb3JtLFxyXG4gICAgICBwb3NpdGlvblByb3BlcnR5OiBzaGFwZVBpZWNlLnBvc2l0aW9uUHJvcGVydHksXHJcbiAgICAgIHN0YXJ0OiBldmVudCA9PiB7XHJcbiAgICAgICAgd2FzVG91Y2ggPSBldmVudC5wb2ludGVyLmlzVG91Y2hMaWtlKCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGVuZDogKCkgPT4ge1xyXG4gICAgICAgIG9wdGlvbnMuZHJvcExpc3RlbmVyICYmIG9wdGlvbnMuZHJvcExpc3RlbmVyKCB3YXNUb3VjaCApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gTm8gbmVlZCB0byB1bmxpbmssIGFzIHdlIG93biB0aGUgZ2l2ZW4gUHJvcGVydHkgKHNhbWUgbGlmZXRpbWUsIGFuZCB3ZSBvd24gdGhlIGxpc3RlbmVyKVxyXG4gICAgdGhpcy5kcmFnTGlzdGVuZXIuaXNVc2VyQ29udHJvbGxlZFByb3BlcnR5LmxpbmsoIGNvbnRyb2xsZWQgPT4ge1xyXG4gICAgICBzaGFwZVBpZWNlLmlzVXNlckNvbnRyb2xsZWRQcm9wZXJ0eS52YWx1ZSA9IGNvbnRyb2xsZWQ7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZXMgdGhlIHBvc2l0aW9uIG9mIHRoaXMgbm9kZSB0byBjb3JyZXNwb25kIHRvIHRoZSBtb2RlbCBwb3NpdGlvbi5cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgdXBkYXRlUG9zaXRpb24oKSB7XHJcbiAgICB0aGlzLnRyYW5zbGF0aW9uID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggdGhpcy5zaGFwZVBpZWNlLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZXMgdGhlIHJvdGF0aW9uIG9mIHRoaXMgbm9kZSB0byBjb3JyZXNwb25kIHRvIHRoZSBtb2RlbCByb3RhdGlvbi5cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgdXBkYXRlUm90YXRpb24oKSB7XHJcbiAgICB0aGlzLnZpZXdOb2RlLnJvdGF0aW9uID0gdGhpcy5zaGFwZVBpZWNlLnJvdGF0aW9uUHJvcGVydHkudmFsdWU7XHJcbiAgICBpZiAoIHRoaXMucG9zaXRpb25lZCApIHtcclxuICAgICAgdGhpcy5zaGFkb3dOb2RlLnJvdGF0aW9uID0gdGhpcy5zaGFwZVBpZWNlLnJvdGF0aW9uUHJvcGVydHkudmFsdWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHRoZSBzY2FsZSBvZiB0aGlzIG5vZGUgdG8gY29ycmVzcG9uZCB0byB0aGUgbW9kZWwgc2NhbGUuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHVwZGF0ZVNjYWxlKCkge1xyXG4gICAgdGhpcy5zZXRTY2FsZU1hZ25pdHVkZSggdGhpcy5zaGFwZVBpZWNlLnNjYWxlUHJvcGVydHkudmFsdWUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZXMgd2hldGhlciB0aGUgc2hhZG93IGlzIHZpc2libGUgb3Igbm90XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHVwZGF0ZVNoYWRvdygpIHtcclxuICAgIHRoaXMuc2hhZG93Q29udGFpbmVyLnRyYW5zbGF0aW9uID0gU0hBRE9XX1ZFQ1RPUi50aW1lc1NjYWxhciggdGhpcy5zaGFwZVBpZWNlLnNoYWRvd1Byb3BlcnR5LnZhbHVlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBIYW5kbGVzIGFuaW1hdGlvbiBjaGFuZ2VzLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICB1cGRhdGVBbmltYXRpbmcoKSB7XHJcbiAgICBpZiAoIHRoaXMuc2hhcGVQaWVjZS5pc0FuaW1hdGluZ1Byb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICB0aGlzLm1vdmVUb0JhY2soKTtcclxuICAgICAgdGhpcy5waWNrYWJsZSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVsZWFzZXMgcmVmZXJlbmNlcy5cclxuICAgKiBAcHVibGljXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICovXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIC8vIFJlcXVpcmVkIGRpc3Bvc2FsLCBzaW5jZSB3ZSBhcmUgcGFzc2luZyB0aGUgaXNVc2VyQ29udHJvbGxlZFByb3BlcnR5XHJcbiAgICB0aGlzLmRyYWdMaXN0ZW5lci5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLnZpc2liaWxpdHlMaXN0ZW5lci5kaXNwb3NlKCk7XHJcblxyXG4gICAgaWYgKCB0aGlzLnBvc2l0aW9uZWQgKSB7XHJcbiAgICAgIHRoaXMuc2hhcGVQaWVjZS5wb3NpdGlvblByb3BlcnR5LnVubGluayggdGhpcy5wb3NpdGlvbkxpc3RlbmVyICk7XHJcbiAgICAgIHRoaXMuc2hhcGVQaWVjZS5zY2FsZVByb3BlcnR5LnVubGluayggdGhpcy5zY2FsZUxpc3RlbmVyICk7XHJcbiAgICAgIHRoaXMuc2hhcGVQaWVjZS5yb3RhdGlvblByb3BlcnR5LnVubGluayggdGhpcy5yb3RhdGlvbkxpc3RlbmVyICk7XHJcbiAgICAgIHRoaXMuc2hhcGVQaWVjZS5pc0FuaW1hdGluZ1Byb3BlcnR5LnVubGluayggdGhpcy5hbmltYXRpbmdMaXN0ZW5lciApO1xyXG4gICAgICB0aGlzLnNoYXBlUGllY2Uuc2hhZG93UHJvcGVydHkudW5saW5rKCB0aGlzLnNoYWRvd0xpc3RlbmVyICk7XHJcbiAgICB9XHJcblxyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuZnJhY3Rpb25zQ29tbW9uLnJlZ2lzdGVyKCAnU2hhcGVQaWVjZU5vZGUnLCBTaGFwZVBpZWNlTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBTaGFwZVBpZWNlTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsU0FBUyxNQUFNLGtDQUFrQztBQUN4RCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDdEQsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxTQUFTQyxNQUFNLEVBQUVDLFlBQVksRUFBRUMs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