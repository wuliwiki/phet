// Copyright 2015-2023, University of Colorado Boulder

/**
 * Visual representation of a Builder.
 * Cards pass through the builder horizontally.
 * An 'input' slot is on the left end, 'output' slot on the right end.
 * Functions appear from left to right, in the order that they are applied.
 * This node is the ancestor for function nodes when they are in the builder.
 *
 * Origin is at the center of the input slot.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import { Shape } from '../../../../../kite/js/imports.js';
import merge from '../../../../../phet-core/js/merge.js';
import { LinearGradient, Node, Path } from '../../../../../scenery/js/imports.js';
import functionBuilder from '../../../functionBuilder.js';
import MoleCardNode from '../cards/MoleCardNode.js';
import FunctionNode from '../functions/FunctionNode.js';
import BuilderEndNode from './BuilderEndNode.js';
import FunctionSlotNode from './FunctionSlotNode.js';
export default class BuilderNode extends Node {
  /**
   * @param {Builder} builder
   * @param {Property.<boolean>} hideFunctionsProperty - whether to hide the indentity of functions in the builder
   * @param {Object} [options]
   */
  constructor(builder, hideFunctionsProperty, options) {
    options = merge({
      // body
      bodyStroke: 'black',
      bodyLineWidth: 1,
      // ends
      endRadiusX: 15,
      endStroke: 'black',
      endLineWidth: 1,
      // slots
      slotFill: 'white',
      slotStroke: 'black',
      slotLineWidth: 2,
      // function placeholders
      functionStroke: 'white',
      functionLineWidth: 1,
      functionLineDash: [3, 3]
    }, options);
    assert && assert(!options.x && !options.y, 'position is determined by model');
    options.x = builder.position.x;
    options.y = builder.position.y;

    // To improve readability of shape code
    const colorScheme = builder.colorScheme;
    const BODY_WIDTH = builder.width;
    const END_HEIGHT = builder.endHeight;
    const X_INSET = 0.15 * BODY_WIDTH;
    const Y_INSET = (END_HEIGHT - builder.waistHeight) / 2;

    // Gradient for the body
    const bodyGradient = new LinearGradient(0, 0, 1, END_HEIGHT).addColorStop(0, colorScheme.top).addColorStop(0.5, colorScheme.middle).addColorStop(1, colorScheme.bottom);

    // Body of the builder, described starting at upper-left and moving clockwise
    const bodyNode = new Path(new Shape().moveTo(0, 0).lineTo(X_INSET, Y_INSET).lineTo(BODY_WIDTH - X_INSET, Y_INSET).lineTo(BODY_WIDTH, 0).lineTo(BODY_WIDTH, END_HEIGHT).lineTo(BODY_WIDTH - X_INSET, END_HEIGHT - Y_INSET).lineTo(X_INSET, END_HEIGHT - Y_INSET).lineTo(0, END_HEIGHT).close(), {
      fill: bodyGradient,
      stroke: options.bodyStroke,
      lineWidth: options.bodyLineWidth,
      // origin at center of input slot
      x: 0,
      centerY: 0
    });

    // Options for the ends
    const END_OPTIONS = {
      radiusX: options.endRadiusX,
      radiusY: END_HEIGHT / 2,
      fill: colorScheme.ends,
      stroke: options.endStroke,
      lineWidth: options.endLineWidth,
      slotFill: options.slotFill,
      slotStroke: options.slotStroke,
      slotLineWidth: options.slotLineWidth,
      centerX: bodyNode.left,
      centerY: bodyNode.centerY
    };

    // Left end
    const leftEndNode = new BuilderEndNode('left', merge({}, END_OPTIONS, {
      centerX: bodyNode.left,
      centerY: bodyNode.centerY
    }));

    // Right end
    const rightEndNode = new BuilderEndNode('right', merge({}, END_OPTIONS, {
      centerX: bodyNode.right,
      centerY: bodyNode.centerY
    }));

    // slots and the function nodes that are in the slots
    const slotNodes = [];
    const functionNodes = []; // {FunctionNode[]}
    for (let i = 0; i < builder.numberOfSlots; i++) {
      slotNodes.push(new FunctionSlotNode({
        // centered at slot positions
        center: builder.slots[i].position.minus(builder.position)
      }));
      functionNodes[i] = null; // empty functions are null
    }

    assert && assert(functionNodes.length === builder.numberOfSlots);
    const slotsParent = new Node({
      children: slotNodes
    });
    const functionsParent = new Node();

    // 'moles under the carpet' that represents a card being dragged through the builder
    const moleCardsLayer = new Node();
    assert && assert(!options.children, 'decoration not supported');
    options.children = [bodyNode, slotsParent, functionsParent, moleCardsLayer, leftEndNode, rightEndNode];
    assert && assert(!options.clipArea, 'clipArea cannot be customized');
    options.clipArea = Shape.rect(0, -END_HEIGHT / 2, BODY_WIDTH, END_HEIGHT);
    super(options);

    // Hide/reveal the identify of functions in the builder.
    // unlink unnecessary, instances exist for lifetime of the sim
    hideFunctionsProperty.link(hideFunctions => {
      functionNodes.forEach(functionNode => {
        if (functionNode) {
          functionNode.identityVisibleProperty.set(!hideFunctions);
        }
      });
    });

    //------------------------------------------------------------------------------------------------------------------
    // Define properties in one place, so we can see what's available and document visibility

    // @public
    this.builder = builder; // (read-only)
    this.hideFunctionsProperty = hideFunctionsProperty;

    // @private
    this.functionNodes = functionNodes;
    this.functionsParent = functionsParent;
    this.moleCardsLayer = moleCardsLayer;
    this.seeInsideCardNode = null; // {CardNode} 1 card that may occupy the 'see inside' windows, see issue #44
  }

  /**
   * Returns all functions to the carousel immediately, no animation.
   *
   * @public
   */
  reset() {
    for (let i = 0; i < this.functionNodes.length; i++) {
      const functionNode = this.functionNodes[i];
      if (functionNode) {
        this.removeFunctionNode(functionNode);
        functionNode && functionNode.moveToCarousel();
      }
    }
  }

  /**
   * Adds a FunctionNode to the builder.
   *
   * @param {FunctionNode} functionNode
   * @param {number} slotNumber
   * @public
   */
  addFunctionNode(functionNode, slotNumber) {
    assert && assert(functionNode instanceof FunctionNode);
    assert && assert(this.builder.isValidSlotNumber(slotNumber));
    assert && assert(!this.containsFunctionNode(functionNode), 'function is already in builder');
    assert && assert(!this.functionNodes[slotNumber], `slot ${slotNumber} is occupied`);

    // add to view
    this.functionNodes[slotNumber] = functionNode;
    this.functionsParent.addChild(functionNode);
    functionNode.center = this.builder.slots[slotNumber].position.minus(this.builder.position); // center in slot

    // add to model
    this.builder.addFunctionInstance(functionNode.functionInstance, slotNumber);
    assert && assert(this.builder.containsFunctionInstance(functionNode.functionInstance));

    // hide the identity of function in the builder, if feature is enabled
    functionNode.identityVisibleProperty.set(!this.hideFunctionsProperty.get());
  }

  /**
   * Removes a FunctionNode from the builder.
   *
   * @param {FunctionNode} functionNode
   * @returns {number} slot number that functionNode was removed from
   * @public
   */
  removeFunctionNode(functionNode) {
    assert && assert(functionNode instanceof FunctionNode);
    const slotNumber = this.functionNodes.indexOf(functionNode);
    assert && assert(slotNumber !== -1, 'functionNode is not in builder');

    // remove from view, restore position in model coordinate frame
    this.functionNodes[slotNumber] = null;
    this.functionsParent.removeChild(functionNode);
    functionNode.center = functionNode.functionInstance.positionProperty.get();

    // remove from model
    this.builder.removeFunctionInstance(functionNode.functionInstance, slotNumber);
    assert && assert(!this.builder.containsFunctionInstance(functionNode.functionInstance));

    // reveal function's identity
    functionNode.identityVisibleProperty.set(true);
    return slotNumber;
  }

  /**
   * Gets the FunctionNode in the specified slot.
   *
   * @param {number} slotNumber
   * @returns {FunctionNode} null if the slot is empty
   * @public
   */
  getFunctionNode(slotNumber) {
    assert && assert(this.builder.isValidSlotNumber(slotNumber));
    return this.functionNodes[slotNumber];
  }

  /**
   * Does the builder contain the specified FunctionNode?
   *
   * @param {FunctionNode} functionNode
   * @returns {boolean}
   * @public
   */
  containsFunctionNode(functionNode) {
    assert && assert(functionNode instanceof FunctionNode);
    return this.functionNodes.indexOf(functionNode) !== -1;
  }

  /**
   * Adds the 'mole under the carpet' representation of a card.
   * Moles are added when cards are created, and persist for the lifetime of the sim.
   *
   * @param {Card} card
   * @public
   */
  addMole(card) {
    this.moleCardsLayer.addChild(new MoleCardNode(card, this.builder.position));
  }
}
functionBuilder.register('BuilderNode', BuilderNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaGFwZSIsIm1lcmdlIiwiTGluZWFyR3JhZGllbnQiLCJOb2RlIiwiUGF0aCIsImZ1bmN0aW9uQnVpbGRlciIsIk1vbGVDYXJkTm9kZSIsIkZ1bmN0aW9uTm9kZSIsIkJ1aWxkZXJFbmROb2RlIiwiRnVuY3Rpb25TbG90Tm9kZSIsIkJ1aWxkZXJOb2RlIiwiY29uc3RydWN0b3IiLCJidWlsZGVyIiwiaGlkZUZ1bmN0aW9uc1Byb3BlcnR5Iiwib3B0aW9ucyIsImJvZHlTdHJva2UiLCJib2R5TGluZVdpZHRoIiwiZW5kUmFkaXVzWCIsImVuZFN0cm9rZSIsImVuZExpbmVXaWR0aCIsInNsb3RGaWxsIiwic2xvdFN0cm9rZSIsInNsb3RMaW5lV2lkdGgiLCJmdW5jdGlvblN0cm9rZSIsImZ1bmN0aW9uTGluZVdpZHRoIiwiZnVuY3Rpb25MaW5lRGFzaCIsImFzc2VydCIsIngiLCJ5IiwicG9zaXRpb24iLCJjb2xvclNjaGVtZSIsIkJPRFlfV0lEVEgiLCJ3aWR0aCIsIkVORF9IRUlHSFQiLCJlbmRIZWlnaHQiLCJYX0lOU0VUIiwiWV9JTlNFVCIsIndhaXN0SGVpZ2h0IiwiYm9keUdyYWRpZW50IiwiYWRkQ29sb3JTdG9wIiwidG9wIiwibWlkZGxlIiwiYm90dG9tIiwiYm9keU5vZGUiLCJtb3ZlVG8iLCJsaW5lVG8iLCJjbG9zZSIsImZpbGwiLCJzdHJva2UiLCJsaW5lV2lkdGgiLCJjZW50ZXJZIiwiRU5EX09QVElPTlMiLCJyYWRpdXNYIiwicmFkaXVzWSIsImVuZHMiLCJjZW50ZXJYIiwibGVmdCIsImxlZnRFbmROb2RlIiwicmlnaHRFbmROb2RlIiwicmlnaHQiLCJzbG90Tm9kZXMiLCJmdW5jdGlvbk5vZGVzIiwiaSIsIm51bWJlck9mU2xvdHMiLCJwdXNoIiwiY2VudGVyIiwic2xvdHMiLCJtaW51cyIsImxlbmd0aCIsInNsb3RzUGFyZW50IiwiY2hpbGRyZW4iLCJmdW5jdGlvbnNQYXJlbnQiLCJtb2xlQ2FyZHNMYXllciIsImNsaXBBcmVhIiwicmVjdCIsImxpbmsiLCJoaWRlRnVuY3Rpb25zIiwiZm9yRWFjaCIsImZ1bmN0aW9uTm9kZSIsImlkZW50aXR5VmlzaWJsZVByb3BlcnR5Iiwic2V0Iiwic2VlSW5zaWRlQ2FyZE5vZGUiLCJyZXNldCIsInJlbW92ZUZ1bmN0aW9uTm9kZSIsIm1vdmVUb0Nhcm91c2VsIiwiYWRkRnVuY3Rpb25Ob2RlIiwic2xvdE51bWJlciIsImlzVmFsaWRTbG90TnVtYmVyIiwiY29udGFpbnNGdW5jdGlvbk5vZGUiLCJhZGRDaGlsZCIsImFkZEZ1bmN0aW9uSW5zdGFuY2UiLCJmdW5jdGlvbkluc3RhbmNlIiwiY29udGFpbnNGdW5jdGlvbkluc3RhbmNlIiwiZ2V0IiwiaW5kZXhPZiIsInJlbW92ZUNoaWxkIiwicG9zaXRpb25Qcm9wZXJ0eSIsInJlbW92ZUZ1bmN0aW9uSW5zdGFuY2UiLCJnZXRGdW5jdGlvbk5vZGUiLCJhZGRNb2xlIiwiY2FyZCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQnVpbGRlck5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTUtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVmlzdWFsIHJlcHJlc2VudGF0aW9uIG9mIGEgQnVpbGRlci5cclxuICogQ2FyZHMgcGFzcyB0aHJvdWdoIHRoZSBidWlsZGVyIGhvcml6b250YWxseS5cclxuICogQW4gJ2lucHV0JyBzbG90IGlzIG9uIHRoZSBsZWZ0IGVuZCwgJ291dHB1dCcgc2xvdCBvbiB0aGUgcmlnaHQgZW5kLlxyXG4gKiBGdW5jdGlvbnMgYXBwZWFyIGZyb20gbGVmdCB0byByaWdodCwgaW4gdGhlIG9yZGVyIHRoYXQgdGhleSBhcmUgYXBwbGllZC5cclxuICogVGhpcyBub2RlIGlzIHRoZSBhbmNlc3RvciBmb3IgZnVuY3Rpb24gbm9kZXMgd2hlbiB0aGV5IGFyZSBpbiB0aGUgYnVpbGRlci5cclxuICpcclxuICogT3JpZ2luIGlzIGF0IHRoZSBjZW50ZXIgb2YgdGhlIGlucHV0IHNsb3QuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IHsgTGluZWFyR3JhZGllbnQsIE5vZGUsIFBhdGggfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZnVuY3Rpb25CdWlsZGVyIGZyb20gJy4uLy4uLy4uL2Z1bmN0aW9uQnVpbGRlci5qcyc7XHJcbmltcG9ydCBNb2xlQ2FyZE5vZGUgZnJvbSAnLi4vY2FyZHMvTW9sZUNhcmROb2RlLmpzJztcclxuaW1wb3J0IEZ1bmN0aW9uTm9kZSBmcm9tICcuLi9mdW5jdGlvbnMvRnVuY3Rpb25Ob2RlLmpzJztcclxuaW1wb3J0IEJ1aWxkZXJFbmROb2RlIGZyb20gJy4vQnVpbGRlckVuZE5vZGUuanMnO1xyXG5pbXBvcnQgRnVuY3Rpb25TbG90Tm9kZSBmcm9tICcuL0Z1bmN0aW9uU2xvdE5vZGUuanMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQnVpbGRlck5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtCdWlsZGVyfSBidWlsZGVyXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IGhpZGVGdW5jdGlvbnNQcm9wZXJ0eSAtIHdoZXRoZXIgdG8gaGlkZSB0aGUgaW5kZW50aXR5IG9mIGZ1bmN0aW9ucyBpbiB0aGUgYnVpbGRlclxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggYnVpbGRlciwgaGlkZUZ1bmN0aW9uc1Byb3BlcnR5LCBvcHRpb25zICkge1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG5cclxuICAgICAgLy8gYm9keVxyXG4gICAgICBib2R5U3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBib2R5TGluZVdpZHRoOiAxLFxyXG5cclxuICAgICAgLy8gZW5kc1xyXG4gICAgICBlbmRSYWRpdXNYOiAxNSxcclxuICAgICAgZW5kU3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBlbmRMaW5lV2lkdGg6IDEsXHJcblxyXG4gICAgICAvLyBzbG90c1xyXG4gICAgICBzbG90RmlsbDogJ3doaXRlJyxcclxuICAgICAgc2xvdFN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgc2xvdExpbmVXaWR0aDogMixcclxuXHJcbiAgICAgIC8vIGZ1bmN0aW9uIHBsYWNlaG9sZGVyc1xyXG4gICAgICBmdW5jdGlvblN0cm9rZTogJ3doaXRlJyxcclxuICAgICAgZnVuY3Rpb25MaW5lV2lkdGg6IDEsXHJcbiAgICAgIGZ1bmN0aW9uTGluZURhc2g6IFsgMywgMyBdXHJcblxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICFvcHRpb25zLnggJiYgIW9wdGlvbnMueSwgJ3Bvc2l0aW9uIGlzIGRldGVybWluZWQgYnkgbW9kZWwnICk7XHJcbiAgICBvcHRpb25zLnggPSBidWlsZGVyLnBvc2l0aW9uLng7XHJcbiAgICBvcHRpb25zLnkgPSBidWlsZGVyLnBvc2l0aW9uLnk7XHJcblxyXG4gICAgLy8gVG8gaW1wcm92ZSByZWFkYWJpbGl0eSBvZiBzaGFwZSBjb2RlXHJcbiAgICBjb25zdCBjb2xvclNjaGVtZSA9IGJ1aWxkZXIuY29sb3JTY2hlbWU7XHJcbiAgICBjb25zdCBCT0RZX1dJRFRIID0gYnVpbGRlci53aWR0aDtcclxuICAgIGNvbnN0IEVORF9IRUlHSFQgPSBidWlsZGVyLmVuZEhlaWdodDtcclxuICAgIGNvbnN0IFhfSU5TRVQgPSAwLjE1ICogQk9EWV9XSURUSDtcclxuICAgIGNvbnN0IFlfSU5TRVQgPSAoIEVORF9IRUlHSFQgLSBidWlsZGVyLndhaXN0SGVpZ2h0ICkgLyAyO1xyXG5cclxuICAgIC8vIEdyYWRpZW50IGZvciB0aGUgYm9keVxyXG4gICAgY29uc3QgYm9keUdyYWRpZW50ID0gbmV3IExpbmVhckdyYWRpZW50KCAwLCAwLCAxLCBFTkRfSEVJR0hUIClcclxuICAgICAgLmFkZENvbG9yU3RvcCggMCwgY29sb3JTY2hlbWUudG9wIClcclxuICAgICAgLmFkZENvbG9yU3RvcCggMC41LCBjb2xvclNjaGVtZS5taWRkbGUgKVxyXG4gICAgICAuYWRkQ29sb3JTdG9wKCAxLCBjb2xvclNjaGVtZS5ib3R0b20gKTtcclxuXHJcbiAgICAvLyBCb2R5IG9mIHRoZSBidWlsZGVyLCBkZXNjcmliZWQgc3RhcnRpbmcgYXQgdXBwZXItbGVmdCBhbmQgbW92aW5nIGNsb2Nrd2lzZVxyXG4gICAgY29uc3QgYm9keU5vZGUgPSBuZXcgUGF0aCggbmV3IFNoYXBlKClcclxuICAgICAgLm1vdmVUbyggMCwgMCApXHJcbiAgICAgIC5saW5lVG8oIFhfSU5TRVQsIFlfSU5TRVQgKVxyXG4gICAgICAubGluZVRvKCBCT0RZX1dJRFRIIC0gWF9JTlNFVCwgWV9JTlNFVCApXHJcbiAgICAgIC5saW5lVG8oIEJPRFlfV0lEVEgsIDAgKVxyXG4gICAgICAubGluZVRvKCBCT0RZX1dJRFRILCBFTkRfSEVJR0hUIClcclxuICAgICAgLmxpbmVUbyggQk9EWV9XSURUSCAtIFhfSU5TRVQsIEVORF9IRUlHSFQgLSBZX0lOU0VUIClcclxuICAgICAgLmxpbmVUbyggWF9JTlNFVCwgRU5EX0hFSUdIVCAtIFlfSU5TRVQgKVxyXG4gICAgICAubGluZVRvKCAwLCBFTkRfSEVJR0hUIClcclxuICAgICAgLmNsb3NlKCksIHtcclxuICAgICAgZmlsbDogYm9keUdyYWRpZW50LFxyXG4gICAgICBzdHJva2U6IG9wdGlvbnMuYm9keVN0cm9rZSxcclxuICAgICAgbGluZVdpZHRoOiBvcHRpb25zLmJvZHlMaW5lV2lkdGgsXHJcblxyXG4gICAgICAvLyBvcmlnaW4gYXQgY2VudGVyIG9mIGlucHV0IHNsb3RcclxuICAgICAgeDogMCxcclxuICAgICAgY2VudGVyWTogMFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIE9wdGlvbnMgZm9yIHRoZSBlbmRzXHJcbiAgICBjb25zdCBFTkRfT1BUSU9OUyA9IHtcclxuICAgICAgcmFkaXVzWDogb3B0aW9ucy5lbmRSYWRpdXNYLFxyXG4gICAgICByYWRpdXNZOiBFTkRfSEVJR0hUIC8gMixcclxuICAgICAgZmlsbDogY29sb3JTY2hlbWUuZW5kcyxcclxuICAgICAgc3Ryb2tlOiBvcHRpb25zLmVuZFN0cm9rZSxcclxuICAgICAgbGluZVdpZHRoOiBvcHRpb25zLmVuZExpbmVXaWR0aCxcclxuICAgICAgc2xvdEZpbGw6IG9wdGlvbnMuc2xvdEZpbGwsXHJcbiAgICAgIHNsb3RTdHJva2U6IG9wdGlvbnMuc2xvdFN0cm9rZSxcclxuICAgICAgc2xvdExpbmVXaWR0aDogb3B0aW9ucy5zbG90TGluZVdpZHRoLFxyXG4gICAgICBjZW50ZXJYOiBib2R5Tm9kZS5sZWZ0LFxyXG4gICAgICBjZW50ZXJZOiBib2R5Tm9kZS5jZW50ZXJZXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIExlZnQgZW5kXHJcbiAgICBjb25zdCBsZWZ0RW5kTm9kZSA9IG5ldyBCdWlsZGVyRW5kTm9kZSggJ2xlZnQnLFxyXG4gICAgICBtZXJnZSgge30sIEVORF9PUFRJT05TLCB7XHJcbiAgICAgICAgY2VudGVyWDogYm9keU5vZGUubGVmdCxcclxuICAgICAgICBjZW50ZXJZOiBib2R5Tm9kZS5jZW50ZXJZXHJcbiAgICAgIH0gKSApO1xyXG5cclxuICAgIC8vIFJpZ2h0IGVuZFxyXG4gICAgY29uc3QgcmlnaHRFbmROb2RlID0gbmV3IEJ1aWxkZXJFbmROb2RlKCAncmlnaHQnLFxyXG4gICAgICBtZXJnZSgge30sIEVORF9PUFRJT05TLCB7XHJcbiAgICAgICAgY2VudGVyWDogYm9keU5vZGUucmlnaHQsXHJcbiAgICAgICAgY2VudGVyWTogYm9keU5vZGUuY2VudGVyWVxyXG4gICAgICB9ICkgKTtcclxuXHJcbiAgICAvLyBzbG90cyBhbmQgdGhlIGZ1bmN0aW9uIG5vZGVzIHRoYXQgYXJlIGluIHRoZSBzbG90c1xyXG4gICAgY29uc3Qgc2xvdE5vZGVzID0gW107XHJcbiAgICBjb25zdCBmdW5jdGlvbk5vZGVzID0gW107IC8vIHtGdW5jdGlvbk5vZGVbXX1cclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGJ1aWxkZXIubnVtYmVyT2ZTbG90czsgaSsrICkge1xyXG5cclxuICAgICAgc2xvdE5vZGVzLnB1c2goIG5ldyBGdW5jdGlvblNsb3ROb2RlKCB7XHJcbiAgICAgICAgLy8gY2VudGVyZWQgYXQgc2xvdCBwb3NpdGlvbnNcclxuICAgICAgICBjZW50ZXI6IGJ1aWxkZXIuc2xvdHNbIGkgXS5wb3NpdGlvbi5taW51cyggYnVpbGRlci5wb3NpdGlvbiApXHJcbiAgICAgIH0gKSApO1xyXG5cclxuICAgICAgZnVuY3Rpb25Ob2Rlc1sgaSBdID0gbnVsbDsgLy8gZW1wdHkgZnVuY3Rpb25zIGFyZSBudWxsXHJcbiAgICB9XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmdW5jdGlvbk5vZGVzLmxlbmd0aCA9PT0gYnVpbGRlci5udW1iZXJPZlNsb3RzICk7XHJcbiAgICBjb25zdCBzbG90c1BhcmVudCA9IG5ldyBOb2RlKCB7IGNoaWxkcmVuOiBzbG90Tm9kZXMgfSApO1xyXG4gICAgY29uc3QgZnVuY3Rpb25zUGFyZW50ID0gbmV3IE5vZGUoKTtcclxuXHJcbiAgICAvLyAnbW9sZXMgdW5kZXIgdGhlIGNhcnBldCcgdGhhdCByZXByZXNlbnRzIGEgY2FyZCBiZWluZyBkcmFnZ2VkIHRocm91Z2ggdGhlIGJ1aWxkZXJcclxuICAgIGNvbnN0IG1vbGVDYXJkc0xheWVyID0gbmV3IE5vZGUoKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhb3B0aW9ucy5jaGlsZHJlbiwgJ2RlY29yYXRpb24gbm90IHN1cHBvcnRlZCcgKTtcclxuICAgIG9wdGlvbnMuY2hpbGRyZW4gPSBbIGJvZHlOb2RlLCBzbG90c1BhcmVudCwgZnVuY3Rpb25zUGFyZW50LCBtb2xlQ2FyZHNMYXllciwgbGVmdEVuZE5vZGUsIHJpZ2h0RW5kTm9kZSBdO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICFvcHRpb25zLmNsaXBBcmVhLCAnY2xpcEFyZWEgY2Fubm90IGJlIGN1c3RvbWl6ZWQnICk7XHJcbiAgICBvcHRpb25zLmNsaXBBcmVhID0gU2hhcGUucmVjdCggMCwgLUVORF9IRUlHSFQgLyAyLCBCT0RZX1dJRFRILCBFTkRfSEVJR0hUICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBIaWRlL3JldmVhbCB0aGUgaWRlbnRpZnkgb2YgZnVuY3Rpb25zIGluIHRoZSBidWlsZGVyLlxyXG4gICAgLy8gdW5saW5rIHVubmVjZXNzYXJ5LCBpbnN0YW5jZXMgZXhpc3QgZm9yIGxpZmV0aW1lIG9mIHRoZSBzaW1cclxuICAgIGhpZGVGdW5jdGlvbnNQcm9wZXJ0eS5saW5rKCBoaWRlRnVuY3Rpb25zID0+IHtcclxuICAgICAgZnVuY3Rpb25Ob2Rlcy5mb3JFYWNoKCBmdW5jdGlvbk5vZGUgPT4ge1xyXG4gICAgICAgIGlmICggZnVuY3Rpb25Ob2RlICkge1xyXG4gICAgICAgICAgZnVuY3Rpb25Ob2RlLmlkZW50aXR5VmlzaWJsZVByb3BlcnR5LnNldCggIWhpZGVGdW5jdGlvbnMgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgLy8gRGVmaW5lIHByb3BlcnRpZXMgaW4gb25lIHBsYWNlLCBzbyB3ZSBjYW4gc2VlIHdoYXQncyBhdmFpbGFibGUgYW5kIGRvY3VtZW50IHZpc2liaWxpdHlcclxuXHJcbiAgICAvLyBAcHVibGljXHJcbiAgICB0aGlzLmJ1aWxkZXIgPSBidWlsZGVyOyAvLyAocmVhZC1vbmx5KVxyXG4gICAgdGhpcy5oaWRlRnVuY3Rpb25zUHJvcGVydHkgPSBoaWRlRnVuY3Rpb25zUHJvcGVydHk7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMuZnVuY3Rpb25Ob2RlcyA9IGZ1bmN0aW9uTm9kZXM7XHJcbiAgICB0aGlzLmZ1bmN0aW9uc1BhcmVudCA9IGZ1bmN0aW9uc1BhcmVudDtcclxuICAgIHRoaXMubW9sZUNhcmRzTGF5ZXIgPSBtb2xlQ2FyZHNMYXllcjtcclxuICAgIHRoaXMuc2VlSW5zaWRlQ2FyZE5vZGUgPSBudWxsOyAvLyB7Q2FyZE5vZGV9IDEgY2FyZCB0aGF0IG1heSBvY2N1cHkgdGhlICdzZWUgaW5zaWRlJyB3aW5kb3dzLCBzZWUgaXNzdWUgIzQ0XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIGFsbCBmdW5jdGlvbnMgdG8gdGhlIGNhcm91c2VsIGltbWVkaWF0ZWx5LCBubyBhbmltYXRpb24uXHJcbiAgICpcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmZ1bmN0aW9uTm9kZXMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IGZ1bmN0aW9uTm9kZSA9IHRoaXMuZnVuY3Rpb25Ob2Rlc1sgaSBdO1xyXG4gICAgICBpZiAoIGZ1bmN0aW9uTm9kZSApIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUZ1bmN0aW9uTm9kZSggZnVuY3Rpb25Ob2RlICk7XHJcbiAgICAgICAgZnVuY3Rpb25Ob2RlICYmIGZ1bmN0aW9uTm9kZS5tb3ZlVG9DYXJvdXNlbCgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGRzIGEgRnVuY3Rpb25Ob2RlIHRvIHRoZSBidWlsZGVyLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtGdW5jdGlvbk5vZGV9IGZ1bmN0aW9uTm9kZVxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBzbG90TnVtYmVyXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGFkZEZ1bmN0aW9uTm9kZSggZnVuY3Rpb25Ob2RlLCBzbG90TnVtYmVyICkge1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZ1bmN0aW9uTm9kZSBpbnN0YW5jZW9mIEZ1bmN0aW9uTm9kZSApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5idWlsZGVyLmlzVmFsaWRTbG90TnVtYmVyKCBzbG90TnVtYmVyICkgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICF0aGlzLmNvbnRhaW5zRnVuY3Rpb25Ob2RlKCBmdW5jdGlvbk5vZGUgKSwgJ2Z1bmN0aW9uIGlzIGFscmVhZHkgaW4gYnVpbGRlcicgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICF0aGlzLmZ1bmN0aW9uTm9kZXNbIHNsb3ROdW1iZXIgXSwgYHNsb3QgJHtzbG90TnVtYmVyfSBpcyBvY2N1cGllZGAgKTtcclxuXHJcbiAgICAvLyBhZGQgdG8gdmlld1xyXG4gICAgdGhpcy5mdW5jdGlvbk5vZGVzWyBzbG90TnVtYmVyIF0gPSBmdW5jdGlvbk5vZGU7XHJcbiAgICB0aGlzLmZ1bmN0aW9uc1BhcmVudC5hZGRDaGlsZCggZnVuY3Rpb25Ob2RlICk7XHJcbiAgICBmdW5jdGlvbk5vZGUuY2VudGVyID0gdGhpcy5idWlsZGVyLnNsb3RzWyBzbG90TnVtYmVyIF0ucG9zaXRpb24ubWludXMoIHRoaXMuYnVpbGRlci5wb3NpdGlvbiApOyAvLyBjZW50ZXIgaW4gc2xvdFxyXG5cclxuICAgIC8vIGFkZCB0byBtb2RlbFxyXG4gICAgdGhpcy5idWlsZGVyLmFkZEZ1bmN0aW9uSW5zdGFuY2UoIGZ1bmN0aW9uTm9kZS5mdW5jdGlvbkluc3RhbmNlLCBzbG90TnVtYmVyICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLmJ1aWxkZXIuY29udGFpbnNGdW5jdGlvbkluc3RhbmNlKCBmdW5jdGlvbk5vZGUuZnVuY3Rpb25JbnN0YW5jZSApICk7XHJcblxyXG4gICAgLy8gaGlkZSB0aGUgaWRlbnRpdHkgb2YgZnVuY3Rpb24gaW4gdGhlIGJ1aWxkZXIsIGlmIGZlYXR1cmUgaXMgZW5hYmxlZFxyXG4gICAgZnVuY3Rpb25Ob2RlLmlkZW50aXR5VmlzaWJsZVByb3BlcnR5LnNldCggIXRoaXMuaGlkZUZ1bmN0aW9uc1Byb3BlcnR5LmdldCgpICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmVzIGEgRnVuY3Rpb25Ob2RlIGZyb20gdGhlIGJ1aWxkZXIuXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge0Z1bmN0aW9uTm9kZX0gZnVuY3Rpb25Ob2RlXHJcbiAgICogQHJldHVybnMge251bWJlcn0gc2xvdCBudW1iZXIgdGhhdCBmdW5jdGlvbk5vZGUgd2FzIHJlbW92ZWQgZnJvbVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICByZW1vdmVGdW5jdGlvbk5vZGUoIGZ1bmN0aW9uTm9kZSApIHtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmdW5jdGlvbk5vZGUgaW5zdGFuY2VvZiBGdW5jdGlvbk5vZGUgKTtcclxuXHJcbiAgICBjb25zdCBzbG90TnVtYmVyID0gdGhpcy5mdW5jdGlvbk5vZGVzLmluZGV4T2YoIGZ1bmN0aW9uTm9kZSApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggc2xvdE51bWJlciAhPT0gLTEsICdmdW5jdGlvbk5vZGUgaXMgbm90IGluIGJ1aWxkZXInICk7XHJcblxyXG4gICAgLy8gcmVtb3ZlIGZyb20gdmlldywgcmVzdG9yZSBwb3NpdGlvbiBpbiBtb2RlbCBjb29yZGluYXRlIGZyYW1lXHJcbiAgICB0aGlzLmZ1bmN0aW9uTm9kZXNbIHNsb3ROdW1iZXIgXSA9IG51bGw7XHJcbiAgICB0aGlzLmZ1bmN0aW9uc1BhcmVudC5yZW1vdmVDaGlsZCggZnVuY3Rpb25Ob2RlICk7XHJcbiAgICBmdW5jdGlvbk5vZGUuY2VudGVyID0gZnVuY3Rpb25Ob2RlLmZ1bmN0aW9uSW5zdGFuY2UucG9zaXRpb25Qcm9wZXJ0eS5nZXQoKTtcclxuXHJcbiAgICAvLyByZW1vdmUgZnJvbSBtb2RlbFxyXG4gICAgdGhpcy5idWlsZGVyLnJlbW92ZUZ1bmN0aW9uSW5zdGFuY2UoIGZ1bmN0aW9uTm9kZS5mdW5jdGlvbkluc3RhbmNlLCBzbG90TnVtYmVyICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhdGhpcy5idWlsZGVyLmNvbnRhaW5zRnVuY3Rpb25JbnN0YW5jZSggZnVuY3Rpb25Ob2RlLmZ1bmN0aW9uSW5zdGFuY2UgKSApO1xyXG5cclxuICAgIC8vIHJldmVhbCBmdW5jdGlvbidzIGlkZW50aXR5XHJcbiAgICBmdW5jdGlvbk5vZGUuaWRlbnRpdHlWaXNpYmxlUHJvcGVydHkuc2V0KCB0cnVlICk7XHJcblxyXG4gICAgcmV0dXJuIHNsb3ROdW1iZXI7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBGdW5jdGlvbk5vZGUgaW4gdGhlIHNwZWNpZmllZCBzbG90LlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHNsb3ROdW1iZXJcclxuICAgKiBAcmV0dXJucyB7RnVuY3Rpb25Ob2RlfSBudWxsIGlmIHRoZSBzbG90IGlzIGVtcHR5XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGdldEZ1bmN0aW9uTm9kZSggc2xvdE51bWJlciApIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuYnVpbGRlci5pc1ZhbGlkU2xvdE51bWJlciggc2xvdE51bWJlciApICk7XHJcbiAgICByZXR1cm4gdGhpcy5mdW5jdGlvbk5vZGVzWyBzbG90TnVtYmVyIF07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEb2VzIHRoZSBidWlsZGVyIGNvbnRhaW4gdGhlIHNwZWNpZmllZCBGdW5jdGlvbk5vZGU/XHJcbiAgICpcclxuICAgKiBAcGFyYW0ge0Z1bmN0aW9uTm9kZX0gZnVuY3Rpb25Ob2RlXHJcbiAgICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNvbnRhaW5zRnVuY3Rpb25Ob2RlKCBmdW5jdGlvbk5vZGUgKSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmdW5jdGlvbk5vZGUgaW5zdGFuY2VvZiBGdW5jdGlvbk5vZGUgKTtcclxuICAgIHJldHVybiAoIHRoaXMuZnVuY3Rpb25Ob2Rlcy5pbmRleE9mKCBmdW5jdGlvbk5vZGUgKSAhPT0gLTEgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZHMgdGhlICdtb2xlIHVuZGVyIHRoZSBjYXJwZXQnIHJlcHJlc2VudGF0aW9uIG9mIGEgY2FyZC5cclxuICAgKiBNb2xlcyBhcmUgYWRkZWQgd2hlbiBjYXJkcyBhcmUgY3JlYXRlZCwgYW5kIHBlcnNpc3QgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtDYXJkfSBjYXJkXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGFkZE1vbGUoIGNhcmQgKSB7XHJcbiAgICB0aGlzLm1vbGVDYXJkc0xheWVyLmFkZENoaWxkKCBuZXcgTW9sZUNhcmROb2RlKCBjYXJkLCB0aGlzLmJ1aWxkZXIucG9zaXRpb24gKSApO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb25CdWlsZGVyLnJlZ2lzdGVyKCAnQnVpbGRlck5vZGUnLCBCdWlsZGVyTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTQSxLQUFLLFFBQVEsbUNBQW1DO0FBQ3pELE9BQU9DLEtBQUssTUFBTSxzQ0FBc0M7QUFDeEQsU0FBU0MsY0FBYyxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBUSxzQ0FBc0M7QUFDakYsT0FBT0MsZUFBZSxNQUFNLDZC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