// Copyright 2016-2023, University of Colorado Boulder

/**
 * Base type for all ScreenViews in this sim.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import ScreenView from '../../../../joist/js/ScreenView.js';
import merge from '../../../../phet-core/js/merge.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import { Node } from '../../../../scenery/js/imports.js';
import Animation from '../../../../twixt/js/Animation.js';
import Easing from '../../../../twixt/js/Easing.js';
import functionBuilder from '../../functionBuilder.js';
import FBConstants from '../FBConstants.js';
import FBQueryParameters from '../FBQueryParameters.js';
import SceneRadioButtonGroup from './SceneRadioButtonGroup.js';
export default class FBScreenView extends ScreenView {
  /**
   * @param {FBModel} model
   * @param {constructor} SceneNodeConstructor - constructor for SceneNode subtype
   * @param {Object} [options]
   */
  constructor(model, SceneNodeConstructor, options) {
    options = merge({
      layoutBounds: FBConstants.SCREEN_VIEW_LAYOUT_BOUNDS,
      sceneRadioButtonGroupYOffset: 20,
      // offset of SceneRadioButtonGroup from top of screen

      // Workaround for things shifting around while cards are dragging or animating.
      // See https://github.com/phetsims/scenery/issues/1289 and https://github.com/phetsims/function-builder/issues/146
      preventFit: true
    }, options);
    super(options);

    // If there's more than one scene, add a control for switching between scenes
    if (model.scenes.length > 1) {
      const sceneRadioButtonGroup = new SceneRadioButtonGroup(model.selectedSceneProperty, model.scenes, {
        centerX: this.layoutBounds.centerX,
        top: this.layoutBounds.top + options.sceneRadioButtonGroupYOffset
      });
      this.addChild(sceneRadioButtonGroup);
    }

    // Reset All button at bottom-right
    const resetAllButton = new ResetAllButton({
      right: this.layoutBounds.maxX + FBConstants.RESET_ALL_BUTTON_OFFSET.x,
      bottom: this.layoutBounds.maxY + FBConstants.RESET_ALL_BUTTON_OFFSET.y,
      listener: () => {
        // cancel drags that may be in progress
        this.interruptSubtreeInput();

        // reset view before model, or we'll see animation that's not desired
        sceneNodes.forEach(sceneNode => {
          sceneNode && sceneNode.reset();
        });
        model.reset();

        // move 1 of each card to the output carousel, for testing
        if (FBQueryParameters.populateOutput) {
          sceneNodes.forEach(sceneNode => {
            sceneNode && sceneNode.populateOutputCarousel();
          });
        }
      }
    });
    this.addChild(resetAllButton);

    // Parent for scenes
    const scenesParent = new Node();
    this.addChild(scenesParent);

    // Scene Nodes
    const sceneNodes = []; // {PatternsSceneNode[]}, with same order as scenes
    model.scenes.forEach(scene => {
      const sceneNode = new SceneNodeConstructor(scene, this.layoutBounds, {
        visible: false
      });
      sceneNodes.push(sceneNode);
      scenesParent.addChild(sceneNode);
    });

    /**
     * After the scene graph is fully constructed, populate parts of the model that
     * depend on the position of things in the view.
     */
    sceneNodes.forEach(sceneNode => {
      sceneNode && sceneNode.completeInitialization();
    });

    // {Animation} Fade between scenes
    let newFadeIn = null;
    let oldFadeOut = null;

    // unlink unnecessary, instances exist for lifetime of the sim
    model.selectedSceneProperty.link((scene, oldScene) => {
      // Stop any animation that is in progress
      oldFadeOut && oldFadeOut.stop();
      newFadeIn && newFadeIn.stop();

      // Get the Node that corresponds to the old scene
      const oldSceneNode = oldScene ? sceneNodes[model.scenes.indexOf(oldScene)] : null;

      // Get the Node that corresponds to the scene.
      const sceneIndex = model.scenes.indexOf(scene);
      assert && assert(sceneIndex !== -1);
      const sceneNode = sceneNodes[sceneIndex];

      // Fade scenes in/out as selection changes
      if (oldScene) {
        // fade out the old scene
        oldFadeOut = new Animation({
          duration: 0.5,
          // seconds
          easing: Easing.QUADRATIC_IN_OUT,
          object: oldSceneNode,
          attribute: 'opacity',
          from: oldSceneNode.opacity,
          to: 0
        });
        oldFadeOut.endedEmitter.addListener(function endedListener() {
          oldFadeOut.endedEmitter.removeListener(endedListener);

          // fade in the new scene
          newFadeIn = new Animation({
            duration: 0.5,
            // seconds
            easing: Easing.QUADRATIC_IN_OUT,
            object: sceneNode,
            attribute: 'opacity',
            from: sceneNode.opacity,
            to: 1
          });
          oldSceneNode.visible = false;
          sceneNode.visible = true;
          newFadeIn.start();
        });
        oldFadeOut.start();
      } else {
        // No animation for the initial selection
        sceneNode.visible = true;
      }
    });
  }
}
functionBuilder.register('FBScreenView', FBScreenView);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTY3JlZW5WaWV3IiwibWVyZ2UiLCJSZXNldEFsbEJ1dHRvbiIsIk5vZGUiLCJBbmltYXRpb24iLCJFYXNpbmciLCJmdW5jdGlvbkJ1aWxkZXIiLCJGQkNvbnN0YW50cyIsIkZCUXVlcnlQYXJhbWV0ZXJzIiwiU2NlbmVSYWRpb0J1dHRvbkdyb3VwIiwiRkJTY3JlZW5WaWV3IiwiY29uc3RydWN0b3IiLCJtb2RlbCIsIlNjZW5lTm9kZUNvbnN0cnVjdG9yIiwib3B0aW9ucyIsImxheW91dEJvdW5kcyIsIlNDUkVFTl9WSUVXX0xBWU9VVF9CT1VORFMiLCJzY2VuZVJhZGlvQnV0dG9uR3JvdXBZT2Zmc2V0IiwicHJldmVudEZpdCIsInNjZW5lcyIsImxlbmd0aCIsInNjZW5lUmFkaW9CdXR0b25Hcm91cCIsInNlbGVjdGVkU2NlbmVQcm9wZXJ0eSIsImNlbnRlclgiLCJ0b3AiLCJhZGRDaGlsZCIsInJlc2V0QWxsQnV0dG9uIiwicmlnaHQiLCJtYXhYIiwiUkVTRVRfQUxMX0JVVFRPTl9PRkZTRVQiLCJ4IiwiYm90dG9tIiwibWF4WSIsInkiLCJsaXN0ZW5lciIsImludGVycnVwdFN1YnRyZWVJbnB1dCIsInNjZW5lTm9kZXMiLCJmb3JFYWNoIiwic2NlbmVOb2RlIiwicmVzZXQiLCJwb3B1bGF0ZU91dHB1dCIsInBvcHVsYXRlT3V0cHV0Q2Fyb3VzZWwiLCJzY2VuZXNQYXJlbnQiLCJzY2VuZSIsInZpc2libGUiLCJwdXNoIiwiY29tcGxldGVJbml0aWFsaXphdGlvbiIsIm5ld0ZhZGVJbiIsIm9sZEZhZGVPdXQiLCJsaW5rIiwib2xkU2NlbmUiLCJzdG9wIiwib2xkU2NlbmVOb2RlIiwiaW5kZXhPZiIsInNjZW5lSW5kZXgiLCJhc3NlcnQiLCJkdXJhdGlvbiIsImVhc2luZyIsIlFVQURSQVRJQ19JTl9PVVQiLCJvYmplY3QiLCJhdHRyaWJ1dGUiLCJmcm9tIiwib3BhY2l0eSIsInRvIiwiZW5kZWRFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJlbmRlZExpc3RlbmVyIiwicmVtb3ZlTGlzdGVuZXIiLCJzdGFydCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRkJTY3JlZW5WaWV3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEJhc2UgdHlwZSBmb3IgYWxsIFNjcmVlblZpZXdzIGluIHRoaXMgc2ltLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBTY3JlZW5WaWV3IGZyb20gJy4uLy4uLy4uLy4uL2pvaXN0L2pzL1NjcmVlblZpZXcuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IFJlc2V0QWxsQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL1Jlc2V0QWxsQnV0dG9uLmpzJztcclxuaW1wb3J0IHsgTm9kZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBBbmltYXRpb24gZnJvbSAnLi4vLi4vLi4vLi4vdHdpeHQvanMvQW5pbWF0aW9uLmpzJztcclxuaW1wb3J0IEVhc2luZyBmcm9tICcuLi8uLi8uLi8uLi90d2l4dC9qcy9FYXNpbmcuanMnO1xyXG5pbXBvcnQgZnVuY3Rpb25CdWlsZGVyIGZyb20gJy4uLy4uL2Z1bmN0aW9uQnVpbGRlci5qcyc7XHJcbmltcG9ydCBGQkNvbnN0YW50cyBmcm9tICcuLi9GQkNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBGQlF1ZXJ5UGFyYW1ldGVycyBmcm9tICcuLi9GQlF1ZXJ5UGFyYW1ldGVycy5qcyc7XHJcbmltcG9ydCBTY2VuZVJhZGlvQnV0dG9uR3JvdXAgZnJvbSAnLi9TY2VuZVJhZGlvQnV0dG9uR3JvdXAuanMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRkJTY3JlZW5WaWV3IGV4dGVuZHMgU2NyZWVuVmlldyB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7RkJNb2RlbH0gbW9kZWxcclxuICAgKiBAcGFyYW0ge2NvbnN0cnVjdG9yfSBTY2VuZU5vZGVDb25zdHJ1Y3RvciAtIGNvbnN0cnVjdG9yIGZvciBTY2VuZU5vZGUgc3VidHlwZVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbW9kZWwsIFNjZW5lTm9kZUNvbnN0cnVjdG9yLCBvcHRpb25zICkge1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG4gICAgICBsYXlvdXRCb3VuZHM6IEZCQ29uc3RhbnRzLlNDUkVFTl9WSUVXX0xBWU9VVF9CT1VORFMsXHJcbiAgICAgIHNjZW5lUmFkaW9CdXR0b25Hcm91cFlPZmZzZXQ6IDIwLCAvLyBvZmZzZXQgb2YgU2NlbmVSYWRpb0J1dHRvbkdyb3VwIGZyb20gdG9wIG9mIHNjcmVlblxyXG5cclxuICAgICAgLy8gV29ya2Fyb3VuZCBmb3IgdGhpbmdzIHNoaWZ0aW5nIGFyb3VuZCB3aGlsZSBjYXJkcyBhcmUgZHJhZ2dpbmcgb3IgYW5pbWF0aW5nLlxyXG4gICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnkvaXNzdWVzLzEyODkgYW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9mdW5jdGlvbi1idWlsZGVyL2lzc3Vlcy8xNDZcclxuICAgICAgcHJldmVudEZpdDogdHJ1ZVxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gSWYgdGhlcmUncyBtb3JlIHRoYW4gb25lIHNjZW5lLCBhZGQgYSBjb250cm9sIGZvciBzd2l0Y2hpbmcgYmV0d2VlbiBzY2VuZXNcclxuICAgIGlmICggbW9kZWwuc2NlbmVzLmxlbmd0aCA+IDEgKSB7XHJcbiAgICAgIGNvbnN0IHNjZW5lUmFkaW9CdXR0b25Hcm91cCA9IG5ldyBTY2VuZVJhZGlvQnV0dG9uR3JvdXAoIG1vZGVsLnNlbGVjdGVkU2NlbmVQcm9wZXJ0eSwgbW9kZWwuc2NlbmVzLCB7XHJcbiAgICAgICAgY2VudGVyWDogdGhpcy5sYXlvdXRCb3VuZHMuY2VudGVyWCxcclxuICAgICAgICB0b3A6IHRoaXMubGF5b3V0Qm91bmRzLnRvcCArIG9wdGlvbnMuc2NlbmVSYWRpb0J1dHRvbkdyb3VwWU9mZnNldFxyXG4gICAgICB9ICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIHNjZW5lUmFkaW9CdXR0b25Hcm91cCApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJlc2V0IEFsbCBidXR0b24gYXQgYm90dG9tLXJpZ2h0XHJcbiAgICBjb25zdCByZXNldEFsbEJ1dHRvbiA9IG5ldyBSZXNldEFsbEJ1dHRvbigge1xyXG4gICAgICByaWdodDogdGhpcy5sYXlvdXRCb3VuZHMubWF4WCArIEZCQ29uc3RhbnRzLlJFU0VUX0FMTF9CVVRUT05fT0ZGU0VULngsXHJcbiAgICAgIGJvdHRvbTogdGhpcy5sYXlvdXRCb3VuZHMubWF4WSArIEZCQ29uc3RhbnRzLlJFU0VUX0FMTF9CVVRUT05fT0ZGU0VULnksXHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcblxyXG4gICAgICAgIC8vIGNhbmNlbCBkcmFncyB0aGF0IG1heSBiZSBpbiBwcm9ncmVzc1xyXG4gICAgICAgIHRoaXMuaW50ZXJydXB0U3VidHJlZUlucHV0KCk7XHJcblxyXG4gICAgICAgIC8vIHJlc2V0IHZpZXcgYmVmb3JlIG1vZGVsLCBvciB3ZSdsbCBzZWUgYW5pbWF0aW9uIHRoYXQncyBub3QgZGVzaXJlZFxyXG4gICAgICAgIHNjZW5lTm9kZXMuZm9yRWFjaCggc2NlbmVOb2RlID0+IHtcclxuICAgICAgICAgIHNjZW5lTm9kZSAmJiBzY2VuZU5vZGUucmVzZXQoKTtcclxuICAgICAgICB9ICk7XHJcbiAgICAgICAgbW9kZWwucmVzZXQoKTtcclxuXHJcbiAgICAgICAgLy8gbW92ZSAxIG9mIGVhY2ggY2FyZCB0byB0aGUgb3V0cHV0IGNhcm91c2VsLCBmb3IgdGVzdGluZ1xyXG4gICAgICAgIGlmICggRkJRdWVyeVBhcmFtZXRlcnMucG9wdWxhdGVPdXRwdXQgKSB7XHJcbiAgICAgICAgICBzY2VuZU5vZGVzLmZvckVhY2goIHNjZW5lTm9kZSA9PiB7XHJcbiAgICAgICAgICAgIHNjZW5lTm9kZSAmJiBzY2VuZU5vZGUucG9wdWxhdGVPdXRwdXRDYXJvdXNlbCgpO1xyXG4gICAgICAgICAgfSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggcmVzZXRBbGxCdXR0b24gKTtcclxuXHJcbiAgICAvLyBQYXJlbnQgZm9yIHNjZW5lc1xyXG4gICAgY29uc3Qgc2NlbmVzUGFyZW50ID0gbmV3IE5vZGUoKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHNjZW5lc1BhcmVudCApO1xyXG5cclxuICAgIC8vIFNjZW5lIE5vZGVzXHJcbiAgICBjb25zdCBzY2VuZU5vZGVzID0gW107IC8vIHtQYXR0ZXJuc1NjZW5lTm9kZVtdfSwgd2l0aCBzYW1lIG9yZGVyIGFzIHNjZW5lc1xyXG4gICAgbW9kZWwuc2NlbmVzLmZvckVhY2goIHNjZW5lID0+IHtcclxuICAgICAgY29uc3Qgc2NlbmVOb2RlID0gbmV3IFNjZW5lTm9kZUNvbnN0cnVjdG9yKCBzY2VuZSwgdGhpcy5sYXlvdXRCb3VuZHMsIHsgdmlzaWJsZTogZmFsc2UgfSApO1xyXG4gICAgICBzY2VuZU5vZGVzLnB1c2goIHNjZW5lTm9kZSApO1xyXG4gICAgICBzY2VuZXNQYXJlbnQuYWRkQ2hpbGQoIHNjZW5lTm9kZSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQWZ0ZXIgdGhlIHNjZW5lIGdyYXBoIGlzIGZ1bGx5IGNvbnN0cnVjdGVkLCBwb3B1bGF0ZSBwYXJ0cyBvZiB0aGUgbW9kZWwgdGhhdFxyXG4gICAgICogZGVwZW5kIG9uIHRoZSBwb3NpdGlvbiBvZiB0aGluZ3MgaW4gdGhlIHZpZXcuXHJcbiAgICAgKi9cclxuICAgIHNjZW5lTm9kZXMuZm9yRWFjaCggc2NlbmVOb2RlID0+IHtcclxuICAgICAgc2NlbmVOb2RlICYmIHNjZW5lTm9kZS5jb21wbGV0ZUluaXRpYWxpemF0aW9uKCk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8ge0FuaW1hdGlvbn0gRmFkZSBiZXR3ZWVuIHNjZW5lc1xyXG4gICAgbGV0IG5ld0ZhZGVJbiA9IG51bGw7XHJcbiAgICBsZXQgb2xkRmFkZU91dCA9IG51bGw7XHJcblxyXG4gICAgLy8gdW5saW5rIHVubmVjZXNzYXJ5LCBpbnN0YW5jZXMgZXhpc3QgZm9yIGxpZmV0aW1lIG9mIHRoZSBzaW1cclxuICAgIG1vZGVsLnNlbGVjdGVkU2NlbmVQcm9wZXJ0eS5saW5rKCAoIHNjZW5lLCBvbGRTY2VuZSApID0+IHtcclxuXHJcbiAgICAgIC8vIFN0b3AgYW55IGFuaW1hdGlvbiB0aGF0IGlzIGluIHByb2dyZXNzXHJcbiAgICAgIG9sZEZhZGVPdXQgJiYgb2xkRmFkZU91dC5zdG9wKCk7XHJcbiAgICAgIG5ld0ZhZGVJbiAmJiBuZXdGYWRlSW4uc3RvcCgpO1xyXG5cclxuICAgICAgLy8gR2V0IHRoZSBOb2RlIHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIG9sZCBzY2VuZVxyXG4gICAgICBjb25zdCBvbGRTY2VuZU5vZGUgPSBvbGRTY2VuZSA/IHNjZW5lTm9kZXNbIG1vZGVsLnNjZW5lcy5pbmRleE9mKCBvbGRTY2VuZSApIF0gOiBudWxsO1xyXG5cclxuICAgICAgLy8gR2V0IHRoZSBOb2RlIHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIHNjZW5lLlxyXG4gICAgICBjb25zdCBzY2VuZUluZGV4ID0gbW9kZWwuc2NlbmVzLmluZGV4T2YoIHNjZW5lICk7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHNjZW5lSW5kZXggIT09IC0xICk7XHJcbiAgICAgIGNvbnN0IHNjZW5lTm9kZSA9IHNjZW5lTm9kZXNbIHNjZW5lSW5kZXggXTtcclxuXHJcbiAgICAgIC8vIEZhZGUgc2NlbmVzIGluL291dCBhcyBzZWxlY3Rpb24gY2hhbmdlc1xyXG4gICAgICBpZiAoIG9sZFNjZW5lICkge1xyXG5cclxuICAgICAgICAvLyBmYWRlIG91dCB0aGUgb2xkIHNjZW5lXHJcbiAgICAgICAgb2xkRmFkZU91dCA9IG5ldyBBbmltYXRpb24oIHtcclxuICAgICAgICAgIGR1cmF0aW9uOiAwLjUsIC8vIHNlY29uZHNcclxuICAgICAgICAgIGVhc2luZzogRWFzaW5nLlFVQURSQVRJQ19JTl9PVVQsXHJcbiAgICAgICAgICBvYmplY3Q6IG9sZFNjZW5lTm9kZSxcclxuICAgICAgICAgIGF0dHJpYnV0ZTogJ29wYWNpdHknLFxyXG4gICAgICAgICAgZnJvbTogb2xkU2NlbmVOb2RlLm9wYWNpdHksXHJcbiAgICAgICAgICB0bzogMFxyXG4gICAgICAgIH0gKTtcclxuXHJcbiAgICAgICAgb2xkRmFkZU91dC5lbmRlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIGZ1bmN0aW9uIGVuZGVkTGlzdGVuZXIoKSB7XHJcblxyXG4gICAgICAgICAgb2xkRmFkZU91dC5lbmRlZEVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoIGVuZGVkTGlzdGVuZXIgKTtcclxuXHJcbiAgICAgICAgICAvLyBmYWRlIGluIHRoZSBuZXcgc2NlbmVcclxuICAgICAgICAgIG5ld0ZhZGVJbiA9IG5ldyBBbmltYXRpb24oIHtcclxuICAgICAgICAgICAgZHVyYXRpb246IDAuNSwgLy8gc2Vjb25kc1xyXG4gICAgICAgICAgICBlYXNpbmc6IEVhc2luZy5RVUFEUkFUSUNfSU5fT1VULFxyXG4gICAgICAgICAgICBvYmplY3Q6IHNjZW5lTm9kZSxcclxuICAgICAgICAgICAgYXR0cmlidXRlOiAnb3BhY2l0eScsXHJcbiAgICAgICAgICAgIGZyb206IHNjZW5lTm9kZS5vcGFjaXR5LFxyXG4gICAgICAgICAgICB0bzogMVxyXG4gICAgICAgICAgfSApO1xyXG5cclxuICAgICAgICAgIG9sZFNjZW5lTm9kZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICBzY2VuZU5vZGUudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICBuZXdGYWRlSW4uc3RhcnQoKTtcclxuICAgICAgICB9ICk7XHJcblxyXG4gICAgICAgIG9sZEZhZGVPdXQuc3RhcnQoKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgLy8gTm8gYW5pbWF0aW9uIGZvciB0aGUgaW5pdGlhbCBzZWxlY3Rpb25cclxuICAgICAgICBzY2VuZU5vZGUudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uQnVpbGRlci5yZWdpc3RlciggJ0ZCU2NyZWVuVmlldycsIEZCU2NyZWVuVmlldyApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxVQUFVLE1BQU0sb0NBQW9DO0FBQzNELE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsY0FBYyxNQUFNLHVEQUF1RDtBQUNsRixTQUFTQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ3hELE9BQU9DLFNBQVMsTUFBTSxtQ0FBbUM7QUFDekQsT0FBT0MsTUFBTSxNQUFNLGdDQUFnQztBQUNuRCxPQUFPQyxlQUFlLE1BQU0sMEJBQTBCO0FBQ3RELE9BQU9DLFdBQVcsTUFBTSxtQkFBbUI7QUFDM0MsT0FBT0MsaUJBQWlCLE1BQU0seUJBQXlCO0FBQ3ZELE9BQU9DLHFCQUFxQixNQUFNLDRCQUE0QjtBQUU5RCxlQUFlLE1BQU1DLFlBQVksU0FBU1YsVUFBVSxDQUFDO0VBRW5EO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRVcsV0FBV0EsQ0FBRUMsS0FBSyxFQUFFQyxvQkFBb0IsRUFBRUMsT0FBTyxFQUFHO0lBRWxEQSxPQUFPLEdBQUdiLEtBQUssQ0FBRTtNQUNmYyxZQUFZLEVBQUVSLFdBQVcs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