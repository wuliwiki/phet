// Copyright 2016-2023, University of Colorado Boulder

/**
 * Slope-intercept form of a set of linear functions.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import merge from '../../../../../phet-core/js/merge.js';
import functionBuilder from '../../../functionBuilder.js';
import FBSymbols from '../../FBSymbols.js';
import RationalNumber from '../RationalNumber.js';
export default class SlopeInterceptEquation {
  /**
   * @param {MathFunction[]} mathFunctions - the set of linear functions, in the order that they are applied
   * @param {Object} [options]
   */
  constructor(mathFunctions, options) {
    options = merge({
      xSymbol: FBSymbols.X // {string} string to use for input symbol, appears only in toString
    }, options);
    let slope = new RationalNumber(1, 1);
    let intercept = new RationalNumber(0, 1);
    for (let i = 0; i < mathFunctions.length; i++) {
      const mathFunction = mathFunctions[i];
      if (mathFunction.operator === FBSymbols.PLUS) {
        intercept = intercept.plus(mathFunction.operandProperty.get());
      } else if (mathFunction.operator === FBSymbols.MINUS) {
        intercept = intercept.minus(mathFunction.operandProperty.get());
      } else if (mathFunction.operator === FBSymbols.TIMES) {
        slope = slope.times(mathFunction.operandProperty.get());
        intercept = intercept.times(mathFunction.operandProperty.get());
      } else if (mathFunction.operator === FBSymbols.DIVIDE) {
        slope = slope.divide(mathFunction.operandProperty.get());
        intercept = intercept.divide(mathFunction.operandProperty.get());
      } else {
        throw new Error(`unsupported operator ${mathFunction.operator}`);
      }
    }

    // @private
    this.xSymbol = options.xSymbol;

    // @public (read-only)
    this.slope = slope; // {RationalNumber}
    this.intercept = intercept; // {RationalNumber}
  }

  /**
   * String representation, for debugging and (perhaps) PhET-iO.
   * Note that the logic flow herein is similar to SlopeInterceptEquationNode's constructor,
   * but constructs a string instead of a Node.
   *
   * @returns {string}
   * @public
   */
  toString() {
    let equation = '';

    // slope
    if (this.slope.valueOf() !== 0) {
      if (this.slope.valueOf() === 1) {
        equation = this.xSymbol;
      } else if (this.slope.isInteger()) {
        equation = this.slope.valueOf() + this.xSymbol;
      } else {
        equation = `(${this.slope.numerator}/${this.slope.denominator})${this.xSymbol}`;
      }
    }

    // intercept
    if (this.intercept.valueOf() !== 0) {
      if (this.intercept.valueOf() > 0) {
        equation = `${equation} ${FBSymbols.PLUS}`;
      } else {
        equation = `${equation} ${FBSymbols.MINUS}`;
      }
      if (this.intercept.isInteger()) {
        equation = `${equation} ${Math.abs(this.intercept.valueOf())}`;
      } else {
        equation = `${equation} ${Math.abs(this.intercept.numerator)}/${Math.abs(this.intercept.denominator)}`;
      }
    }
    return equation;
  }
}
functionBuilder.register('SlopeInterceptEquation', SlopeInterceptEquation);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtZXJnZSIsImZ1bmN0aW9uQnVpbGRlciIsIkZCU3ltYm9scyIsIlJhdGlvbmFsTnVtYmVyIiwiU2xvcGVJbnRlcmNlcHRFcXVhdGlvbiIsImNvbnN0cnVjdG9yIiwibWF0aEZ1bmN0aW9ucyIsIm9wdGlvbnMiLCJ4U3ltYm9sIiwiWCIsInNsb3BlIiwiaW50ZXJjZXB0IiwiaSIsImxlbmd0aCIsIm1hdGhGdW5jdGlvbiIsIm9wZXJhdG9yIiwiUExVUyIsInBsdXMiLCJvcGVyYW5kUHJvcGVydHkiLCJnZXQiLCJNSU5VUyIsIm1pbnVzIiwiVElNRVMiLCJ0aW1lcyIsIkRJVklERSIsImRpdmlkZSIsIkVycm9yIiwidG9TdHJpbmciLCJlcXVhdGlvbiIsInZhbHVlT2YiLCJpc0ludGVnZXIiLCJudW1lcmF0b3IiLCJkZW5vbWluYXRvciIsIk1hdGgiLCJhYnMiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlNsb3BlSW50ZXJjZXB0RXF1YXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2xvcGUtaW50ZXJjZXB0IGZvcm0gb2YgYSBzZXQgb2YgbGluZWFyIGZ1bmN0aW9ucy5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IGZ1bmN0aW9uQnVpbGRlciBmcm9tICcuLi8uLi8uLi9mdW5jdGlvbkJ1aWxkZXIuanMnO1xyXG5pbXBvcnQgRkJTeW1ib2xzIGZyb20gJy4uLy4uL0ZCU3ltYm9scy5qcyc7XHJcbmltcG9ydCBSYXRpb25hbE51bWJlciBmcm9tICcuLi9SYXRpb25hbE51bWJlci5qcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTbG9wZUludGVyY2VwdEVxdWF0aW9uIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtNYXRoRnVuY3Rpb25bXX0gbWF0aEZ1bmN0aW9ucyAtIHRoZSBzZXQgb2YgbGluZWFyIGZ1bmN0aW9ucywgaW4gdGhlIG9yZGVyIHRoYXQgdGhleSBhcmUgYXBwbGllZFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbWF0aEZ1bmN0aW9ucywgb3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuICAgICAgeFN5bWJvbDogRkJTeW1ib2xzLlggLy8ge3N0cmluZ30gc3RyaW5nIHRvIHVzZSBmb3IgaW5wdXQgc3ltYm9sLCBhcHBlYXJzIG9ubHkgaW4gdG9TdHJpbmdcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBsZXQgc2xvcGUgPSBuZXcgUmF0aW9uYWxOdW1iZXIoIDEsIDEgKTtcclxuICAgIGxldCBpbnRlcmNlcHQgPSBuZXcgUmF0aW9uYWxOdW1iZXIoIDAsIDEgKTtcclxuXHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXRoRnVuY3Rpb25zLmxlbmd0aDsgaSsrICkge1xyXG5cclxuICAgICAgY29uc3QgbWF0aEZ1bmN0aW9uID0gbWF0aEZ1bmN0aW9uc1sgaSBdO1xyXG5cclxuICAgICAgaWYgKCBtYXRoRnVuY3Rpb24ub3BlcmF0b3IgPT09IEZCU3ltYm9scy5QTFVTICkge1xyXG4gICAgICAgIGludGVyY2VwdCA9IGludGVyY2VwdC5wbHVzKCBtYXRoRnVuY3Rpb24ub3BlcmFuZFByb3BlcnR5LmdldCgpICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIG1hdGhGdW5jdGlvbi5vcGVyYXRvciA9PT0gRkJTeW1ib2xzLk1JTlVTICkge1xyXG4gICAgICAgIGludGVyY2VwdCA9IGludGVyY2VwdC5taW51cyggbWF0aEZ1bmN0aW9uLm9wZXJhbmRQcm9wZXJ0eS5nZXQoKSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBtYXRoRnVuY3Rpb24ub3BlcmF0b3IgPT09IEZCU3ltYm9scy5USU1FUyApIHtcclxuICAgICAgICBzbG9wZSA9IHNsb3BlLnRpbWVzKCBtYXRoRnVuY3Rpb24ub3BlcmFuZFByb3BlcnR5LmdldCgpICk7XHJcbiAgICAgICAgaW50ZXJjZXB0ID0gaW50ZXJjZXB0LnRpbWVzKCBtYXRoRnVuY3Rpb24ub3BlcmFuZFByb3BlcnR5LmdldCgpICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIG1hdGhGdW5jdGlvbi5vcGVyYXRvciA9PT0gRkJTeW1ib2xzLkRJVklERSApIHtcclxuICAgICAgICBzbG9wZSA9IHNsb3BlLmRpdmlkZSggbWF0aEZ1bmN0aW9uLm9wZXJhbmRQcm9wZXJ0eS5nZXQoKSApO1xyXG4gICAgICAgIGludGVyY2VwdCA9IGludGVyY2VwdC5kaXZpZGUoIG1hdGhGdW5jdGlvbi5vcGVyYW5kUHJvcGVydHkuZ2V0KCkgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIGB1bnN1cHBvcnRlZCBvcGVyYXRvciAke21hdGhGdW5jdGlvbi5vcGVyYXRvcn1gICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy54U3ltYm9sID0gb3B0aW9ucy54U3ltYm9sO1xyXG5cclxuICAgIC8vIEBwdWJsaWMgKHJlYWQtb25seSlcclxuICAgIHRoaXMuc2xvcGUgPSBzbG9wZTsgLy8ge1JhdGlvbmFsTnVtYmVyfVxyXG4gICAgdGhpcy5pbnRlcmNlcHQgPSBpbnRlcmNlcHQ7IC8vIHtSYXRpb25hbE51bWJlcn1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0cmluZyByZXByZXNlbnRhdGlvbiwgZm9yIGRlYnVnZ2luZyBhbmQgKHBlcmhhcHMpIFBoRVQtaU8uXHJcbiAgICogTm90ZSB0aGF0IHRoZSBsb2dpYyBmbG93IGhlcmVpbiBpcyBzaW1pbGFyIHRvIFNsb3BlSW50ZXJjZXB0RXF1YXRpb25Ob2RlJ3MgY29uc3RydWN0b3IsXHJcbiAgICogYnV0IGNvbnN0cnVjdHMgYSBzdHJpbmcgaW5zdGVhZCBvZiBhIE5vZGUuXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICB0b1N0cmluZygpIHtcclxuXHJcbiAgICBsZXQgZXF1YXRpb24gPSAnJztcclxuXHJcbiAgICAvLyBzbG9wZVxyXG4gICAgaWYgKCB0aGlzLnNsb3BlLnZhbHVlT2YoKSAhPT0gMCApIHtcclxuICAgICAgaWYgKCB0aGlzLnNsb3BlLnZhbHVlT2YoKSA9PT0gMSApIHtcclxuICAgICAgICBlcXVhdGlvbiA9IHRoaXMueFN5bWJvbDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggdGhpcy5zbG9wZS5pc0ludGVnZXIoKSApIHtcclxuICAgICAgICBlcXVhdGlvbiA9IHRoaXMuc2xvcGUudmFsdWVPZigpICsgdGhpcy54U3ltYm9sO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGVxdWF0aW9uID0gYCgke3RoaXMuc2xvcGUubnVtZXJhdG9yfS8ke3RoaXMuc2xvcGUuZGVub21pbmF0b3J9KSR7dGhpcy54U3ltYm9sfWA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBpbnRlcmNlcHRcclxuICAgIGlmICggdGhpcy5pbnRlcmNlcHQudmFsdWVPZigpICE9PSAwICkge1xyXG5cclxuICAgICAgaWYgKCB0aGlzLmludGVyY2VwdC52YWx1ZU9mKCkgPiAwICkge1xyXG4gICAgICAgIGVxdWF0aW9uID0gYCR7ZXF1YXRpb259ICR7RkJTeW1ib2xzLlBMVVN9YDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBlcXVhdGlvbiA9IGAke2VxdWF0aW9ufSAke0ZCU3ltYm9scy5NSU5VU31gO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIHRoaXMuaW50ZXJjZXB0LmlzSW50ZWdlcigpICkge1xyXG4gICAgICAgIGVxdWF0aW9uID0gYCR7ZXF1YXRpb259ICR7TWF0aC5hYnMoIHRoaXMuaW50ZXJjZXB0LnZhbHVlT2YoKSApfWA7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgZXF1YXRpb24gPSBgJHtlcXVhdGlvbn0gJHtNYXRoLmFicyggdGhpcy5pbnRlcmNlcHQubnVtZXJhdG9yICl9LyR7TWF0aC5hYnMoIHRoaXMuaW50ZXJjZXB0LmRlbm9taW5hdG9yICl9YDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBlcXVhdGlvbjtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uQnVpbGRlci5yZWdpc3RlciggJ1Nsb3BlSW50ZXJjZXB0RXF1YXRpb24nLCBTbG9wZUludGVyY2VwdEVxdWF0aW9uICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBTSxzQ0FBc0M7QUFDeEQsT0FBT0MsZUFBZSxNQUFNLDZCQUE2QjtBQUN6RCxPQUFPQyxTQUFTLE1BQU0sb0JBQW9CO0FBQzFDLE9BQU9DLGNBQWMsTUFBTSxzQkFBc0I7QUFFakQsZUFBZSxNQUFNQyxzQkFBc0IsQ0FBQztFQUUxQztBQUNGO0FBQ0E7QUFDQTtFQUNFQyxXQUFXQSxDQUFFQyxhQUFhLEVBQUVDLE9BQU8sRUFBRztJQUVwQ0EsT0FBTyxHQUFHUCxLQUFLLENBQUU7TUFDZlEsT0FBTyxFQUFFTixTQUFTLENBQUNPLENBQUMsQ0FBQztJQUN2QixDQUFDLEVBQUVGLE9BQVEsQ0FBQztJQUVaLElBQUlHLEtBQUssR0FBRyxJQUFJUCxjQUFjLENBQUUsQ0FBQyxFQUFFLENBQUUsQ0FBQztJQUN0QyxJQUFJUSxTQUFTLEdBQUcsSUFBSVIsY0FBYyxDQUFFLENBQUMsRUFBRSxDQUFFLENBQUM7SUFFMUMsS0FBTSxJQUFJUyxDQUFDLEdBQUcsQ0FBQyxFQUFF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