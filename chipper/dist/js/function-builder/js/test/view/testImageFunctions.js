// Copyright 2015-2023, University of Colorado Boulder

/**
 * Test the image functions that are used in the 'Patterns' screen.
 * Shows what all images look like for all functions.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import { Shape } from '../../../../kite/js/imports.js';
import { HBox, Image, Node, Path, Rectangle, VBox } from '../../../../scenery/js/imports.js';
import Carousel from '../../../../sun/js/Carousel.js';
import beaker_png from '../../../images/cards/beaker_png.js';
import butterfly_png from '../../../images/cards/butterfly_png.js';
import cherries_png from '../../../images/cards/cherries_png.js';
import circle_png from '../../../images/cards/circle_png.js';
import feet_png from '../../../images/cards/feet_png.js';
import planet_png from '../../../images/cards/planet_png.js';
import rectangle_png from '../../../images/cards/rectangle_png.js';
import snowflake_png from '../../../images/cards/snowflake_png.js';
import star_png from '../../../images/cards/star_png.js';
import stickFigure_png from '../../../images/cards/stickFigure_png.js';
import sun_png from '../../../images/cards/sun_png.js';
import triangle_png from '../../../images/cards/triangle_png.js';
import ImageFunction from '../../common/model/functions/ImageFunction.js';
import functionBuilder from '../../functionBuilder.js';
import FBCanvasUtils from '../../patterns/model/FBCanvasUtils.js';
import Erase from '../../patterns/model/functions/Erase.js';
import Grayscale from '../../patterns/model/functions/Grayscale.js';
import Identity from '../../patterns/model/functions/Identity.js';
import InvertRGB from '../../patterns/model/functions/InvertRGB.js';
import Mirror from '../../patterns/model/functions/Mirror.js';
import MysteryA from '../../patterns/model/functions/MysteryA.js';
import MysteryB from '../../patterns/model/functions/MysteryB.js';
import MysteryC from '../../patterns/model/functions/MysteryC.js';
import Rotate180 from '../../patterns/model/functions/Rotate180.js';
import Rotate90 from '../../patterns/model/functions/Rotate90.js';
import Shrink from '../../patterns/model/functions/Shrink.js';
import Warhol from '../../patterns/model/functions/Warhol.js';

/**
 * @param {Bounds2} layoutBounds
 * @returns {Node}
 */
export default function testImageFunctions(layoutBounds) {
  // a canvas for each input image
  const canvases = [FBCanvasUtils.createCanvasWithImage(feet_png), FBCanvasUtils.createCanvasWithImage(snowflake_png), FBCanvasUtils.createCanvasWithImage(butterfly_png), FBCanvasUtils.createCanvasWithImage(stickFigure_png), FBCanvasUtils.createCanvasWithImage(planet_png), FBCanvasUtils.createCanvasWithImage(sun_png), FBCanvasUtils.createCanvasWithImage(beaker_png), FBCanvasUtils.createCanvasWithImage(cherries_png), FBCanvasUtils.createCanvasWithImage(rectangle_png), FBCanvasUtils.createCanvasWithImage(circle_png), FBCanvasUtils.createCanvasWithImage(triangle_png), FBCanvasUtils.createCanvasWithImage(star_png)];

  // functions to be applied to the images
  const functions = [new Identity(), new Mirror(), new Rotate90(), new Grayscale(), new Rotate180(), new InvertRGB(), new Erase(), new Shrink(), new Warhol(), new MysteryA(), new MysteryB(), new MysteryC()];

  // a row of function icons
  const functionNodes = [];
  functions.forEach(functionInstance => {
    functionNodes.push(new TestFunctionNode(functionInstance, {
      scale: 0.45 // determined empirically, to make functions line up with images in carousel
    }));
  });

  const functionsBox = new HBox({
    children: functionNodes,
    spacing: 21
  });

  // carousel items
  const items = [];

  // A row for each card
  canvases.forEach(canvas => {
    const hBoxChildren = [];
    functions.forEach(functionInstance => {
      const outputCanvas = functionInstance.applyFunction(canvas);
      hBoxChildren.push(new TestCardNode(outputCanvas));
    });
    items.push({
      createNode: () => new HBox({
        children: hBoxChildren,
        spacing: 15
      })
    });
  });

  // vertical carousel to show the output images
  const carousel = new Carousel(items, {
    orientation: 'vertical',
    separatorsVisible: true,
    itemsPerPage: 4
  });
  return new VBox({
    children: [functionsBox, carousel],
    spacing: 15,
    center: layoutBounds.center
  });
}

/**
 * Use this simplified representation of a card, so that this test is not dependent on other sim code.
 */
class TestCardNode extends Node {
  /**
   * @param {HTMLCanvasElement} canvas - canvas that contains the card's image
   * @param {Object} [options]
   */
  constructor(canvas, options) {
    options = options || {};
    const backgroundNode = new Rectangle(0, 0, 60, 60, {
      cornerRadius: 5,
      fill: 'white',
      stroke: 'black',
      lineWidth: 1
    });
    const imageNode = new Image(canvas.toDataURL(), {
      initialWidth: canvas.width,
      initialHeight: canvas.height,
      scale: 0.3,
      // determined empirically
      center: backgroundNode.center
    });
    assert && assert(!options.children, 'decoration not supported');
    options.children = [backgroundNode, imageNode];
    super(options);
  }
}

/**
 * Use this simplified representation of a function, so that this test is not dependent on other sim code.
 */
class TestFunctionNode extends Node {
  /**
   * @param {ImageFunction} functionInstance
   * @param {Object} [options]
   */
  constructor(functionInstance, options) {
    assert && assert(functionInstance instanceof ImageFunction);
    options = options || {};
    const WIDTH = 120;
    const HEIGHT = 0.6 * WIDTH;
    const X_INSET = 0.15 * WIDTH;

    // Described from top-left, moving clockwise.
    const backgroundShape = new Shape().moveTo(0, 0).lineTo(WIDTH - X_INSET, 0).lineTo(WIDTH, HEIGHT / 2).lineTo(WIDTH - X_INSET, HEIGHT).lineTo(0, HEIGHT).lineTo(X_INSET, HEIGHT / 2).close();
    const backgroundNode = new Path(backgroundShape, functionInstance.viewOptions);
    const iconNode = new Node({
      children: [functionInstance.iconNode],
      center: backgroundNode.center
    });
    assert && assert(!options.children, 'decoration not supported');
    options.children = [backgroundNode, iconNode];
    super(options);
  }
}
functionBuilder.register('testImageFunctions', testImageFunctions);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaGFwZSIsIkhCb3giLCJJbWFnZSIsIk5vZGUiLCJQYXRoIiwiUmVjdGFuZ2xlIiwiVkJveCIsIkNhcm91c2VsIiwiYmVha2VyX3BuZyIsImJ1dHRlcmZseV9wbmciLCJjaGVycmllc19wbmciLCJjaXJjbGVfcG5nIiwiZmVldF9wbmciLCJwbGFuZXRfcG5nIiwicmVjdGFuZ2xlX3BuZyIsInNub3dmbGFrZV9wbmciLCJzdGFyX3BuZyIsInN0aWNrRmlndXJlX3BuZyIsInN1bl9wbmciLCJ0cmlhbmdsZV9wbmciLCJJbWFnZUZ1bmN0aW9uIiwiZnVuY3Rpb25CdWlsZGVyIiwiRkJDYW52YXNVdGlscyIsIkVyYXNlIiwiR3JheXNjYWxlIiwiSWRlbnRpdHkiLCJJbnZlcnRSR0IiLCJNaXJyb3IiLCJNeXN0ZXJ5QSIsIk15c3RlcnlCIiwiTXlzdGVyeUMiLCJSb3RhdGUxODAiLCJSb3RhdGU5MCIsIlNocmluayIsIldhcmhvbCIsInRlc3RJbWFnZUZ1bmN0aW9ucyIsImxheW91dEJvdW5kcyIsImNhbnZhc2VzIiwiY3JlYXRlQ2FudmFzV2l0aEltYWdlIiwiZnVuY3Rpb25zIiwiZnVuY3Rpb25Ob2RlcyIsImZvckVhY2giLCJmdW5jdGlvbkluc3RhbmNlIiwicHVzaCIsIlRlc3RGdW5jdGlvbk5vZGUiLCJzY2FsZSIsImZ1bmN0aW9uc0JveCIsImNoaWxkcmVuIiwic3BhY2luZyIsIml0ZW1zIiwiY2FudmFzIiwiaEJveENoaWxkcmVuIiwib3V0cHV0Q2FudmFzIiwiYXBwbHlGdW5jdGlvbiIsIlRlc3RDYXJkTm9kZSIsImNyZWF0ZU5vZGUiLCJjYXJvdXNlbCIsIm9yaWVudGF0aW9uIiwic2VwYXJhdG9yc1Zpc2libGUiLCJpdGVtc1BlclBhZ2UiLCJjZW50ZXIiLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJiYWNrZ3JvdW5kTm9kZSIsImNvcm5lclJhZGl1cyIsImZpbGwiLCJzdHJva2UiLCJsaW5lV2lkdGgiLCJpbWFnZU5vZGUiLCJ0b0RhdGFVUkwiLCJpbml0aWFsV2lkdGgiLCJ3aWR0aCIsImluaXRpYWxIZWlnaHQiLCJoZWlnaHQiLCJhc3NlcnQiLCJXSURUSCIsIkhFSUdIVCIsIlhfSU5TRVQiLCJiYWNrZ3JvdW5kU2hhcGUiLCJtb3ZlVG8iLCJsaW5lVG8iLCJjbG9zZSIsInZpZXdPcHRpb25zIiwiaWNvbk5vZGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbInRlc3RJbWFnZUZ1bmN0aW9ucy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBUZXN0IHRoZSBpbWFnZSBmdW5jdGlvbnMgdGhhdCBhcmUgdXNlZCBpbiB0aGUgJ1BhdHRlcm5zJyBzY3JlZW4uXHJcbiAqIFNob3dzIHdoYXQgYWxsIGltYWdlcyBsb29rIGxpa2UgZm9yIGFsbCBmdW5jdGlvbnMuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgeyBIQm94LCBJbWFnZSwgTm9kZSwgUGF0aCwgUmVjdGFuZ2xlLCBWQm94IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IENhcm91c2VsIGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9DYXJvdXNlbC5qcyc7XHJcbmltcG9ydCBiZWFrZXJfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9jYXJkcy9iZWFrZXJfcG5nLmpzJztcclxuaW1wb3J0IGJ1dHRlcmZseV9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2NhcmRzL2J1dHRlcmZseV9wbmcuanMnO1xyXG5pbXBvcnQgY2hlcnJpZXNfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9jYXJkcy9jaGVycmllc19wbmcuanMnO1xyXG5pbXBvcnQgY2lyY2xlX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvY2FyZHMvY2lyY2xlX3BuZy5qcyc7XHJcbmltcG9ydCBmZWV0X3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvY2FyZHMvZmVldF9wbmcuanMnO1xyXG5pbXBvcnQgcGxhbmV0X3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvY2FyZHMvcGxhbmV0X3BuZy5qcyc7XHJcbmltcG9ydCByZWN0YW5nbGVfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9jYXJkcy9yZWN0YW5nbGVfcG5nLmpzJztcclxuaW1wb3J0IHNub3dmbGFrZV9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2NhcmRzL3Nub3dmbGFrZV9wbmcuanMnO1xyXG5pbXBvcnQgc3Rhcl9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2NhcmRzL3N0YXJfcG5nLmpzJztcclxuaW1wb3J0IHN0aWNrRmlndXJlX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvY2FyZHMvc3RpY2tGaWd1cmVfcG5nLmpzJztcclxuaW1wb3J0IHN1bl9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2NhcmRzL3N1bl9wbmcuanMnO1xyXG5pbXBvcnQgdHJpYW5nbGVfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9jYXJkcy90cmlhbmdsZV9wbmcuanMnO1xyXG5pbXBvcnQgSW1hZ2VGdW5jdGlvbiBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvZnVuY3Rpb25zL0ltYWdlRnVuY3Rpb24uanMnO1xyXG5pbXBvcnQgZnVuY3Rpb25CdWlsZGVyIGZyb20gJy4uLy4uL2Z1bmN0aW9uQnVpbGRlci5qcyc7XHJcbmltcG9ydCBGQkNhbnZhc1V0aWxzIGZyb20gJy4uLy4uL3BhdHRlcm5zL21vZGVsL0ZCQ2FudmFzVXRpbHMuanMnO1xyXG5pbXBvcnQgRXJhc2UgZnJvbSAnLi4vLi4vcGF0dGVybnMvbW9kZWwvZnVuY3Rpb25zL0VyYXNlLmpzJztcclxuaW1wb3J0IEdyYXlzY2FsZSBmcm9tICcuLi8uLi9wYXR0ZXJucy9tb2RlbC9mdW5jdGlvbnMvR3JheXNjYWxlLmpzJztcclxuaW1wb3J0IElkZW50aXR5IGZyb20gJy4uLy4uL3BhdHRlcm5zL21vZGVsL2Z1bmN0aW9ucy9JZGVudGl0eS5qcyc7XHJcbmltcG9ydCBJbnZlcnRSR0IgZnJvbSAnLi4vLi4vcGF0dGVybnMvbW9kZWwvZnVuY3Rpb25zL0ludmVydFJHQi5qcyc7XHJcbmltcG9ydCBNaXJyb3IgZnJvbSAnLi4vLi4vcGF0dGVybnMvbW9kZWwvZnVuY3Rpb25zL01pcnJvci5qcyc7XHJcbmltcG9ydCBNeXN0ZXJ5QSBmcm9tICcuLi8uLi9wYXR0ZXJucy9tb2RlbC9mdW5jdGlvbnMvTXlzdGVyeUEuanMnO1xyXG5pbXBvcnQgTXlzdGVyeUIgZnJvbSAnLi4vLi4vcGF0dGVybnMvbW9kZWwvZnVuY3Rpb25zL015c3RlcnlCLmpzJztcclxuaW1wb3J0IE15c3RlcnlDIGZyb20gJy4uLy4uL3BhdHRlcm5zL21vZGVsL2Z1bmN0aW9ucy9NeXN0ZXJ5Qy5qcyc7XHJcbmltcG9ydCBSb3RhdGUxODAgZnJvbSAnLi4vLi4vcGF0dGVybnMvbW9kZWwvZnVuY3Rpb25zL1JvdGF0ZTE4MC5qcyc7XHJcbmltcG9ydCBSb3RhdGU5MCBmcm9tICcuLi8uLi9wYXR0ZXJucy9tb2RlbC9mdW5jdGlvbnMvUm90YXRlOTAuanMnO1xyXG5pbXBvcnQgU2hyaW5rIGZyb20gJy4uLy4uL3BhdHRlcm5zL21vZGVsL2Z1bmN0aW9ucy9TaHJpbmsuanMnO1xyXG5pbXBvcnQgV2FyaG9sIGZyb20gJy4uLy4uL3BhdHRlcm5zL21vZGVsL2Z1bmN0aW9ucy9XYXJob2wuanMnO1xyXG5cclxuLyoqXHJcbiAqIEBwYXJhbSB7Qm91bmRzMn0gbGF5b3V0Qm91bmRzXHJcbiAqIEByZXR1cm5zIHtOb2RlfVxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdGVzdEltYWdlRnVuY3Rpb25zKCBsYXlvdXRCb3VuZHMgKSB7XHJcblxyXG4gIC8vIGEgY2FudmFzIGZvciBlYWNoIGlucHV0IGltYWdlXHJcbiAgY29uc3QgY2FudmFzZXMgPSBbXHJcbiAgICBGQkNhbnZhc1V0aWxzLmNyZWF0ZUNhbnZhc1dpdGhJbWFnZSggZmVldF9wbmcgKSxcclxuICAgIEZCQ2FudmFzVXRpbHMuY3JlYXRlQ2FudmFzV2l0aEltYWdlKCBzbm93Zmxha2VfcG5nICksXHJcbiAgICBGQkNhbnZhc1V0aWxzLmNyZWF0ZUNhbnZhc1dpdGhJbWFnZSggYnV0dGVyZmx5X3BuZyApLFxyXG4gICAgRkJDYW52YXNVdGlscy5jcmVhdGVDYW52YXNXaXRoSW1hZ2UoIHN0aWNrRmlndXJlX3BuZyApLFxyXG4gICAgRkJDYW52YXNVdGlscy5jcmVhdGVDYW52YXNXaXRoSW1hZ2UoIHBsYW5ldF9wbmcgKSxcclxuICAgIEZCQ2FudmFzVXRpbHMuY3JlYXRlQ2FudmFzV2l0aEltYWdlKCBzdW5fcG5nICksXHJcbiAgICBGQkNhbnZhc1V0aWxzLmNyZWF0ZUNhbnZhc1dpdGhJbWFnZSggYmVha2VyX3BuZyApLFxyXG4gICAgRkJDYW52YXNVdGlscy5jcmVhdGVDYW52YXNXaXRoSW1hZ2UoIGNoZXJyaWVzX3BuZyApLFxyXG4gICAgRkJDYW52YXNVdGlscy5jcmVhdGVDYW52YXNXaXRoSW1hZ2UoIHJlY3RhbmdsZV9wbmcgKSxcclxuICAgIEZCQ2FudmFzVXRpbHMuY3JlYXRlQ2FudmFzV2l0aEltYWdlKCBjaXJjbGVfcG5nICksXHJcbiAgICBGQkNhbnZhc1V0aWxzLmNyZWF0ZUNhbnZhc1dpdGhJbWFnZSggdHJpYW5nbGVfcG5nICksXHJcbiAgICBGQkNhbnZhc1V0aWxzLmNyZWF0ZUNhbnZhc1dpdGhJbWFnZSggc3Rhcl9wbmcgKVxyXG4gIF07XHJcblxyXG4gIC8vIGZ1bmN0aW9ucyB0byBiZSBhcHBsaWVkIHRvIHRoZSBpbWFnZXNcclxuICBjb25zdCBmdW5jdGlvbnMgPSBbXHJcbiAgICBuZXcgSWRlbnRpdHkoKSxcclxuICAgIG5ldyBNaXJyb3IoKSxcclxuICAgIG5ldyBSb3RhdGU5MCgpLFxyXG4gICAgbmV3IEdyYXlzY2FsZSgpLFxyXG4gICAgbmV3IFJvdGF0ZTE4MCgpLFxyXG4gICAgbmV3IEludmVydFJHQigpLFxyXG4gICAgbmV3IEVyYXNlKCksXHJcbiAgICBuZXcgU2hyaW5rKCksXHJcbiAgICBuZXcgV2FyaG9sKCksXHJcbiAgICBuZXcgTXlzdGVyeUEoKSxcclxuICAgIG5ldyBNeXN0ZXJ5QigpLFxyXG4gICAgbmV3IE15c3RlcnlDKClcclxuICBdO1xyXG5cclxuICAvLyBhIHJvdyBvZiBmdW5jdGlvbiBpY29uc1xyXG4gIGNvbnN0IGZ1bmN0aW9uTm9kZXMgPSBbXTtcclxuICBmdW5jdGlvbnMuZm9yRWFjaCggZnVuY3Rpb25JbnN0YW5jZSA9PiB7XHJcbiAgICBmdW5jdGlvbk5vZGVzLnB1c2goIG5ldyBUZXN0RnVuY3Rpb25Ob2RlKCBmdW5jdGlvbkluc3RhbmNlLCB7XHJcbiAgICAgIHNjYWxlOiAwLjQ1IC8vIGRldGVybWluZWQgZW1waXJpY2FsbHksIHRvIG1ha2UgZnVuY3Rpb25zIGxpbmUgdXAgd2l0aCBpbWFnZXMgaW4gY2Fyb3VzZWxcclxuICAgIH0gKSApO1xyXG4gIH0gKTtcclxuICBjb25zdCBmdW5jdGlvbnNCb3ggPSBuZXcgSEJveCgge1xyXG4gICAgY2hpbGRyZW46IGZ1bmN0aW9uTm9kZXMsXHJcbiAgICBzcGFjaW5nOiAyMVxyXG4gIH0gKTtcclxuXHJcbiAgLy8gY2Fyb3VzZWwgaXRlbXNcclxuICBjb25zdCBpdGVtcyA9IFtdO1xyXG5cclxuICAvLyBBIHJvdyBmb3IgZWFjaCBjYXJkXHJcbiAgY2FudmFzZXMuZm9yRWFjaCggY2FudmFzID0+IHtcclxuXHJcbiAgICBjb25zdCBoQm94Q2hpbGRyZW4gPSBbXTtcclxuXHJcbiAgICBmdW5jdGlvbnMuZm9yRWFjaCggZnVuY3Rpb25JbnN0YW5jZSA9PiB7XHJcbiAgICAgIGNvbnN0IG91dHB1dENhbnZhcyA9IGZ1bmN0aW9uSW5zdGFuY2UuYXBwbHlGdW5jdGlvbiggY2FudmFzICk7XHJcbiAgICAgIGhCb3hDaGlsZHJlbi5wdXNoKCBuZXcgVGVzdENhcmROb2RlKCBvdXRwdXRDYW52YXMgKSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGl0ZW1zLnB1c2goIHtcclxuICAgICAgY3JlYXRlTm9kZTogKCkgPT4gbmV3IEhCb3goIHtcclxuICAgICAgICBjaGlsZHJlbjogaEJveENoaWxkcmVuLFxyXG4gICAgICAgIHNwYWNpbmc6IDE1XHJcbiAgICAgIH0gKVxyXG4gICAgfSApO1xyXG4gIH0gKTtcclxuXHJcbiAgLy8gdmVydGljYWwgY2Fyb3VzZWwgdG8gc2hvdyB0aGUgb3V0cHV0IGltYWdlc1xyXG4gIGNvbnN0IGNhcm91c2VsID0gbmV3IENhcm91c2VsKCBpdGVtcywge1xyXG4gICAgb3JpZW50YXRpb246ICd2ZXJ0aWNhbCcsXHJcbiAgICBzZXBhcmF0b3JzVmlzaWJsZTogdHJ1ZSxcclxuICAgIGl0ZW1zUGVyUGFnZTogNFxyXG4gIH0gKTtcclxuXHJcbiAgcmV0dXJuIG5ldyBWQm94KCB7XHJcbiAgICBjaGlsZHJlbjogWyBmdW5jdGlvbnNCb3gsIGNhcm91c2VsIF0sXHJcbiAgICBzcGFjaW5nOiAxNSxcclxuICAgIGNlbnRlcjogbGF5b3V0Qm91bmRzLmNlbnRlclxyXG4gIH0gKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFVzZSB0aGlzIHNpbXBsaWZpZWQgcmVwcmVzZW50YXRpb24gb2YgYSBjYXJkLCBzbyB0aGF0IHRoaXMgdGVzdCBpcyBub3QgZGVwZW5kZW50IG9uIG90aGVyIHNpbSBjb2RlLlxyXG4gKi9cclxuY2xhc3MgVGVzdENhcmROb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7SFRNTENhbnZhc0VsZW1lbnR9IGNhbnZhcyAtIGNhbnZhcyB0aGF0IGNvbnRhaW5zIHRoZSBjYXJkJ3MgaW1hZ2VcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGNhbnZhcywgb3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuXHJcbiAgICBjb25zdCBiYWNrZ3JvdW5kTm9kZSA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIDYwLCA2MCwge1xyXG4gICAgICBjb3JuZXJSYWRpdXM6IDUsXHJcbiAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgbGluZVdpZHRoOiAxXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgaW1hZ2VOb2RlID0gbmV3IEltYWdlKCBjYW52YXMudG9EYXRhVVJMKCksIHtcclxuICAgICAgaW5pdGlhbFdpZHRoOiBjYW52YXMud2lkdGgsXHJcbiAgICAgIGluaXRpYWxIZWlnaHQ6IGNhbnZhcy5oZWlnaHQsXHJcbiAgICAgIHNjYWxlOiAwLjMsICAvLyBkZXRlcm1pbmVkIGVtcGlyaWNhbGx5XHJcbiAgICAgIGNlbnRlcjogYmFja2dyb3VuZE5vZGUuY2VudGVyXHJcbiAgICB9ICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggIW9wdGlvbnMuY2hpbGRyZW4sICdkZWNvcmF0aW9uIG5vdCBzdXBwb3J0ZWQnICk7XHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gWyBiYWNrZ3JvdW5kTm9kZSwgaW1hZ2VOb2RlIF07XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBVc2UgdGhpcyBzaW1wbGlmaWVkIHJlcHJlc2VudGF0aW9uIG9mIGEgZnVuY3Rpb24sIHNvIHRoYXQgdGhpcyB0ZXN0IGlzIG5vdCBkZXBlbmRlbnQgb24gb3RoZXIgc2ltIGNvZGUuXHJcbiAqL1xyXG5jbGFzcyBUZXN0RnVuY3Rpb25Ob2RlIGV4dGVuZHMgTm9kZSB7XHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtJbWFnZUZ1bmN0aW9ufSBmdW5jdGlvbkluc3RhbmNlXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBmdW5jdGlvbkluc3RhbmNlLCBvcHRpb25zICkge1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZ1bmN0aW9uSW5zdGFuY2UgaW5zdGFuY2VvZiBJbWFnZUZ1bmN0aW9uICk7XHJcblxyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG4gICAgY29uc3QgV0lEVEggPSAxMjA7XHJcbiAgICBjb25zdCBIRUlHSFQgPSAwLjYgKiBXSURUSDtcclxuICAgIGNvbnN0IFhfSU5TRVQgPSAwLjE1ICogV0lEVEg7XHJcblxyXG4gICAgLy8gRGVzY3JpYmVkIGZyb20gdG9wLWxlZnQsIG1vdmluZyBjbG9ja3dpc2UuXHJcbiAgICBjb25zdCBiYWNrZ3JvdW5kU2hhcGUgPSBuZXcgU2hhcGUoKVxyXG4gICAgICAubW92ZVRvKCAwLCAwIClcclxuICAgICAgLmxpbmVUbyggV0lEVEggLSBYX0lOU0VULCAwIClcclxuICAgICAgLmxpbmVUbyggV0lEVEgsIEhFSUdIVCAvIDIgKVxyXG4gICAgICAubGluZVRvKCBXSURUSCAtIFhfSU5TRVQsIEhFSUdIVCApXHJcbiAgICAgIC5saW5lVG8oIDAsIEhFSUdIVCApXHJcbiAgICAgIC5saW5lVG8oIFhfSU5TRVQsIEhFSUdIVCAvIDIgKVxyXG4gICAgICAuY2xvc2UoKTtcclxuXHJcbiAgICBjb25zdCBiYWNrZ3JvdW5kTm9kZSA9IG5ldyBQYXRoKCBiYWNrZ3JvdW5kU2hhcGUsIGZ1bmN0aW9uSW5zdGFuY2Uudmlld09wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCBpY29uTm9kZSA9IG5ldyBOb2RlKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbIGZ1bmN0aW9uSW5zdGFuY2UuaWNvbk5vZGUgXSxcclxuICAgICAgY2VudGVyOiBiYWNrZ3JvdW5kTm9kZS5jZW50ZXJcclxuICAgIH0gKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhb3B0aW9ucy5jaGlsZHJlbiwgJ2RlY29yYXRpb24gbm90IHN1cHBvcnRlZCcgKTtcclxuICAgIG9wdGlvbnMuY2hpbGRyZW4gPSBbIGJhY2tncm91bmROb2RlLCBpY29uTm9kZSBdO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbkJ1aWxkZXIucmVnaXN0ZXIoICd0ZXN0SW1hZ2VGdW5jdGlvbnMnLCB0ZXN0SW1hZ2VGdW5jdGlvbnMgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTQSxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELFNBQVNDLElBQUksRUFBRUMsS0FBSyxFQUFFQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsU0FBUyxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQzVGLE9BQU9DLFFBQVEsTUFBTSxnQ0FBZ0M7QUFDckQsT0FBT0MsVUFBVSxNQUFNLHFDQUFxQztBQUM1RCxPQUFPQyxhQUFhLE1BQU0sd0NBQXdDO0FBQ2xFLE9BQU9DLFlBQVksTUFBTSx1Q0FBdUM7QUFDaEUsT0FBT0MsVUFBVSxNQUFNLHFDQUFxQztBQUM1RCxPQUFPQyxRQUFRLE1BQU0sbUNBQW1DO0FBQ3hELE9BQU9DLFVBQVUsTUFBTSxxQ0FBcUM7QUFDNUQsT0FBT0MsYUFBYSxNQUFNLHdDQUF3QztBQUNsRSxPQUFPQyxhQUFhLE1BQU0sd0NBQXdDO0FBQ2xFLE9BQU9DLFFBQVEsTUFBTSxtQ0FBbUM7QUFDeEQsT0FBT0MsZUFBZSxNQUFNLDBDQUEwQztBQUN0RSxPQUFPQyxPQUFPLE1BQU0sa0NBQWtDO0FBQ3RELE9BQU9DLFlBQVksTUFBTSx1Q0FBdUM7QUFDaEUsT0FBT0MsYUFBYSxNQUFNLCtDQUErQztBQUN6RSxPQUFPQyxlQUFlLE1BQU0sMEJBQTBCO0FBQ3RELE9BQU9DLGFBQWEsTUFBTSx1Q0FBdUM7QUFDakUsT0FBT0MsS0FBSyxNQUFNLHlDQUF5QztBQUMzRCxPQUFPQyxTQUFTLE1BQU0sNkNBQTZDO0FBQ25FLE9BQU9DLFFBQVEsTUFBTSw0Q0FBNEM7QUFDakUsT0FBT0MsU0FBUyxNQUFNLDZD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