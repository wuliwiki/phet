// Copyright 2016-2023, University of Colorado Boulder

/**
 * Scene for the 'Mystery' screen. Adds a button for generating challenges.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import merge from '../../../../phet-core/js/merge.js';
import EyeToggleButton from '../../../../scenery-phet/js/buttons/EyeToggleButton.js';
import RefreshButton from '../../../../scenery-phet/js/buttons/RefreshButton.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Text } from '../../../../scenery/js/imports.js';
import FBColors from '../../common/FBColors.js';
import FBQueryParameters from '../../common/FBQueryParameters.js';
import MysteryFunctionNode from '../../common/view/functions/MysteryFunctionNode.js';
import MathSceneNode from '../../common/view/MathSceneNode.js';
import functionBuilder from '../../functionBuilder.js';
import MysteryChallenges from '../model/MysteryChallenges.js';
export default class MysterySceneNode extends MathSceneNode {
  /**
   * @param {MysteryScene} scene - model for this scene
   * @param {Bounds2} layoutBounds - layoutBounds of the parent ScreenView
   * @param {Object} [options]
   */
  constructor(scene, layoutBounds, options) {
    options = merge({
      /*
       * Mystery scenes have a hidden function carousel, which is where we get functions for composing challenges.
       * This approach was necessary because the Mystery screen was added late in the development process, and
       * the existence of the function carousel was (by that point) required by too many things.
       */
      functionCarouselVisible: false,
      cardCarouselDefaultPageNumber: 1,
      // show cards 0-3 in input carousel
      functionsPerPage: 2,
      // functions per page in the functions carousel (which is invisible)
      hasTableDrawer: true,
      // include an XY table drawer
      hasGraphDrawer: true,
      // include an XY graph drawer
      hideFunctionsCheckboxVisible: false // hide this feature
    }, options);
    super(scene, layoutBounds, MysteryFunctionNode, options);

    // Toggle buttons below each builder slot, for revealing identity of functions
    this.revealProperties = []; // {Property.<boolean>[]}
    this.revealButtons = []; // {EyeToggleButton[]}
    for (let i = 0; i < scene.builder.numberOfSlots; i++) {
      /**
       * Create a closure for slotNumber using an IIFE
       * @param {MysterySceneNode} mysterySceneNode
       * @param {number} slotNumber
       */
      (function (mysterySceneNode, slotNumber) {
        // {Property.<boolean>} Property associated with the slot
        const revealProperty = new BooleanProperty(false);
        mysterySceneNode.revealProperties.push(revealProperty);

        // wire up Property to control the function that's in the slot
        // unlink unnecessary, instances exist for lifetime of the sim
        revealProperty.link(reveal => {
          const functionNode = mysterySceneNode.builderNode.getFunctionNode(slotNumber);
          if (functionNode) {
            functionNode.identityVisibleProperty.set(reveal);
          }
        });

        // button below the slot
        const slotPosition = scene.builder.slots[slotNumber].position;
        const revealButton = new EyeToggleButton(revealProperty, {
          baseColor: FBColors.HIDDEN_FUNCTION,
          scale: 0.75,
          centerX: slotPosition.x,
          top: slotPosition.y + 65
        });
        mysterySceneNode.revealButtons.push(revealButton);
        mysterySceneNode.controlsLayer.addChild(revealButton);

        // touchArea
        revealButton.touchArea = revealButton.localBounds.dilatedXY(25, 15);
      })(this, i);
    }

    // button for generating a new challenge
    const generateButton = new RefreshButton({
      listener: () => scene.nextChallenge(),
      iconHeight: 38,
      xMargin: 18,
      yMargin: 10,
      centerX: this.builderNode.centerX,
      top: this.builderNode.bottom + 65
    });
    this.addChild(generateButton);

    // @private shows the answer below the generate button, for debugging, i18n not required
    this.answerNode = new Text('answer', {
      font: new PhetFont(18),
      centerX: generateButton.centerX,
      top: generateButton.bottom + 10
    });
    if (phet.chipper.queryParameters.showAnswers) {
      this.addChild(this.answerNode);
    }

    // @private {Object} maps from operator to function container, created on demand by updateChallenge
    this.operatorToContainerMap = null;

    // Update when the challenge changes.
    // This can't be executed until the function carousel is populated.
    // unlink unnecessary, instances exist for lifetime of the sim
    scene.challengeProperty.lazyLink(challenge => {
      this.updateChallenge();
    });

    // Enable features based on number of cards that have been moved to the output carousel.
    // unlink unnecessary, instances exist for lifetime of the sim.
    this.outputCarousel.numberOfCardsProperty.link(numberOfCards => {
      // enabled function reveal buttons
      this.revealButtons.forEach(revealButton => {
        revealButton.enabled = revealButton.enabled || numberOfCards === 3;
      });

      // enable 'See Inside' checkbox
      this.seeInsideCheckbox.enabled = this.seeInsideCheckbox.enabled || numberOfCards === 1;
    });

    // @private
    this.scene = scene;
  }

  /**
   * @public
   * @override
   */
  reset() {
    super.reset();
    this.resetChallengeControls();
  }

  /**
   * Resets controls that need to be reset each time the challenge changes.
   *
   * @private
   */
  resetChallengeControls() {
    // reset Properties for revealing function identity
    this.revealProperties.forEach(revealProperty => revealProperty.reset());

    // disable buttons for revealing function identity
    this.revealButtons.forEach(revealButton => {
      revealButton.enabled = false;
    });

    // reset 'See Inside' property
    this.seeInsideProperty.reset();

    // disable 'See Inside' checkbox
    this.seeInsideCheckbox.enabled = false;
  }

  /**
   * Completes initialization by displaying the first challenge.
   *
   * @public
   * @override
   */
  completeInitialization() {
    super.completeInitialization();
    this.updateChallenge();
  }

  /**
   * Synchronizes the displayed challenge with the model.
   *
   * @private
   */
  updateChallenge() {
    this.resetCarousels();
    this.builderNode.reset();
    this.resetFunctions();
    this.resetCards();

    // create the map on demand, since it can't be done until the sim has been fully initialized
    if (!this.operatorToContainerMap) {
      this.operatorToContainerMap = {};
      this.functionContainers.forEach(functionContainer => {
        const contents = functionContainer.getContents();
        assert && assert(contents.length > 0, 'empty functionContainer');
        const operator = contents[0].functionInstance.operator;
        this.operatorToContainerMap[operator] = functionContainer;
      });
    }

    // convert the challenge from a string to an array of {operator: string, operand: number}
    const challenge = this.scene.challengeProperty.get();
    const challengeObjects = MysteryChallenges.parseChallenge(challenge);

    // transfer functions from carousel to builder, configured to match the challenge
    let slotNumber = 0;
    const colors = this.scene.getColors(); // {<Color|string>[]}
    challengeObjects.forEach(challengeObject => {
      // get the container that has functions for this operator
      const functionContainer = this.operatorToContainerMap[challengeObject.operator];
      assert && assert(functionContainer, `no functionContainer for operator ${challengeObject.operator}`);

      // get the first item in the container
      const functionNode = functionContainer.getContents()[0];
      assert && assert(functionNode, `no function for operator ${challengeObject.operator}`);
      const functionInstance = functionNode.functionInstance;

      // configure the function to match the challenge
      functionInstance.operandProperty.set(challengeObject.operand);
      functionInstance.fillProperty.set(colors[slotNumber]);

      // move the function to the builder
      functionNode.moveToBuilder(slotNumber);

      // hide the function's identity
      functionNode.identityVisibleProperty.set(false);
      slotNumber++;
    });

    // Resets controls that need to be reset each time the challenge changes.
    this.resetChallengeControls();

    // show the answer for debugging
    this.answerNode.string = `#${this.scene.challengePool.indexOf(challenge) + 1}: ${challenge}`;
    this.answerNode.centerX = this.builderNode.centerX;
    if (FBQueryParameters.populateOutput) {
      this.populateOutputCarousel();
    }
  }
}
functionBuilder.register('MysterySceneNode', MysterySceneNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJtZXJnZSIsIkV5ZVRvZ2dsZUJ1dHRvbiIsIlJlZnJlc2hCdXR0b24iLCJQaGV0Rm9udCIsIlRleHQiLCJGQkNvbG9ycyIsIkZCUXVlcnlQYXJhbWV0ZXJzIiwiTXlzdGVyeUZ1bmN0aW9uTm9kZSIsIk1hdGhTY2VuZU5vZGUiLCJmdW5jdGlvbkJ1aWxkZXIiLCJNeXN0ZXJ5Q2hhbGxlbmdlcyIsIk15c3RlcnlTY2VuZU5vZGUiLCJjb25zdHJ1Y3RvciIsInNjZW5lIiwibGF5b3V0Qm91bmRzIiwib3B0aW9ucyIsImZ1bmN0aW9uQ2Fyb3VzZWxWaXNpYmxlIiwiY2FyZENhcm91c2VsRGVmYXVsdFBhZ2VOdW1iZXIiLCJmdW5jdGlvbnNQZXJQYWdlIiwiaGFzVGFibGVEcmF3ZXIiLCJoYXNHcmFwaERyYXdlciIsImhpZGVGdW5jdGlvbnNDaGVja2JveFZpc2libGUiLCJyZXZlYWxQcm9wZXJ0aWVzIiwicmV2ZWFsQnV0dG9ucyIsImkiLCJidWlsZGVyIiwibnVtYmVyT2ZTbG90cyIsIm15c3RlcnlTY2VuZU5vZGUiLCJzbG90TnVtYmVyIiwicmV2ZWFsUHJvcGVydHkiLCJwdXNoIiwibGluayIsInJldmVhbCIsImZ1bmN0aW9uTm9kZSIsImJ1aWxkZXJOb2RlIiwiZ2V0RnVuY3Rpb25Ob2RlIiwiaWRlbnRpdHlWaXNpYmxlUHJvcGVydHkiLCJzZXQiLCJzbG90UG9zaXRpb24iLCJzbG90cyIsInBvc2l0aW9uIiwicmV2ZWFsQnV0dG9uIiwiYmFzZUNvbG9yIiwiSElEREVOX0ZVTkNUSU9OIiwic2NhbGUiLCJjZW50ZXJYIiwieCIsInRvcCIsInkiLCJjb250cm9sc0xheWVyIiwiYWRkQ2hpbGQiLCJ0b3VjaEFyZWEiLCJsb2NhbEJvdW5kcyIsImRpbGF0ZWRYWSIsImdlbmVyYXRlQnV0dG9uIiwibGlzdGVuZXIiLCJuZXh0Q2hhbGxlbmdlIiwiaWNvbkhlaWdodCIsInhNYXJnaW4iLCJ5TWFyZ2luIiwiYm90dG9tIiwiYW5zd2VyTm9kZSIsImZvbnQiLCJwaGV0IiwiY2hpcHBlciIsInF1ZXJ5UGFyYW1ldGVycyIsInNob3dBbnN3ZXJzIiwib3BlcmF0b3JUb0NvbnRhaW5lck1hcCIsImNoYWxsZW5nZVByb3BlcnR5IiwibGF6eUxpbmsiLCJjaGFsbGVuZ2UiLCJ1cGRhdGVDaGFsbGVuZ2UiLCJvdXRwdXRDYXJvdXNlbCIsIm51bWJlck9mQ2FyZHNQcm9wZXJ0eSIsIm51bWJlck9mQ2FyZHMiLCJmb3JFYWNoIiwiZW5hYmxlZCIsInNlZUluc2lkZUNoZWNrYm94IiwicmVzZXQiLCJyZXNldENoYWxsZW5nZUNvbnRyb2xzIiwic2VlSW5zaWRlUHJvcGVydHkiLCJjb21wbGV0ZUluaXRpYWxpemF0aW9uIiwicmVzZXRDYXJvdXNlbHMiLCJyZXNldEZ1bmN0aW9ucyIsInJlc2V0Q2FyZHMiLCJmdW5jdGlvbkNvbnRhaW5lcnMiLCJmdW5jdGlvbkNvbnRhaW5lciIsImNvbnRlbnRzIiwiZ2V0Q29udGVudHMiLCJhc3NlcnQiLCJsZW5ndGgiLCJvcGVyYXRvciIsImZ1bmN0aW9uSW5zdGFuY2UiLCJnZXQiLCJjaGFsbGVuZ2VPYmplY3RzIiwicGFyc2VDaGFsbGVuZ2UiLCJjb2xvcnMiLCJnZXRDb2xvcnMiLCJjaGFsbGVuZ2VPYmplY3QiLCJvcGVyYW5kUHJvcGVydHkiLCJvcGVyYW5kIiwiZmlsbFByb3BlcnR5IiwibW92ZVRvQnVpbGRlciIsInN0cmluZyIsImNoYWxsZW5nZVBvb2wiLCJpbmRleE9mIiwicG9wdWxhdGVPdXRwdXQiLCJwb3B1bGF0ZU91dHB1dENhcm91c2VsIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJNeXN0ZXJ5U2NlbmVOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFNjZW5lIGZvciB0aGUgJ015c3RlcnknIHNjcmVlbi4gQWRkcyBhIGJ1dHRvbiBmb3IgZ2VuZXJhdGluZyBjaGFsbGVuZ2VzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IEV5ZVRvZ2dsZUJ1dHRvbiBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvYnV0dG9ucy9FeWVUb2dnbGVCdXR0b24uanMnO1xyXG5pbXBvcnQgUmVmcmVzaEJ1dHRvbiBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvYnV0dG9ucy9SZWZyZXNoQnV0dG9uLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgRkJDb2xvcnMgZnJvbSAnLi4vLi4vY29tbW9uL0ZCQ29sb3JzLmpzJztcclxuaW1wb3J0IEZCUXVlcnlQYXJhbWV0ZXJzIGZyb20gJy4uLy4uL2NvbW1vbi9GQlF1ZXJ5UGFyYW1ldGVycy5qcyc7XHJcbmltcG9ydCBNeXN0ZXJ5RnVuY3Rpb25Ob2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L2Z1bmN0aW9ucy9NeXN0ZXJ5RnVuY3Rpb25Ob2RlLmpzJztcclxuaW1wb3J0IE1hdGhTY2VuZU5vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvTWF0aFNjZW5lTm9kZS5qcyc7XHJcbmltcG9ydCBmdW5jdGlvbkJ1aWxkZXIgZnJvbSAnLi4vLi4vZnVuY3Rpb25CdWlsZGVyLmpzJztcclxuaW1wb3J0IE15c3RlcnlDaGFsbGVuZ2VzIGZyb20gJy4uL21vZGVsL015c3RlcnlDaGFsbGVuZ2VzLmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE15c3RlcnlTY2VuZU5vZGUgZXh0ZW5kcyBNYXRoU2NlbmVOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtNeXN0ZXJ5U2NlbmV9IHNjZW5lIC0gbW9kZWwgZm9yIHRoaXMgc2NlbmVcclxuICAgKiBAcGFyYW0ge0JvdW5kczJ9IGxheW91dEJvdW5kcyAtIGxheW91dEJvdW5kcyBvZiB0aGUgcGFyZW50IFNjcmVlblZpZXdcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIHNjZW5lLCBsYXlvdXRCb3VuZHMsIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcblxyXG4gICAgICAvKlxyXG4gICAgICAgKiBNeXN0ZXJ5IHNjZW5lcyBoYXZlIGEgaGlkZGVuIGZ1bmN0aW9uIGNhcm91c2VsLCB3aGljaCBpcyB3aGVyZSB3ZSBnZXQgZnVuY3Rpb25zIGZvciBjb21wb3NpbmcgY2hhbGxlbmdlcy5cclxuICAgICAgICogVGhpcyBhcHByb2FjaCB3YXMgbmVjZXNzYXJ5IGJlY2F1c2UgdGhlIE15c3Rlcnkgc2NyZWVuIHdhcyBhZGRlZCBsYXRlIGluIHRoZSBkZXZlbG9wbWVudCBwcm9jZXNzLCBhbmRcclxuICAgICAgICogdGhlIGV4aXN0ZW5jZSBvZiB0aGUgZnVuY3Rpb24gY2Fyb3VzZWwgd2FzIChieSB0aGF0IHBvaW50KSByZXF1aXJlZCBieSB0b28gbWFueSB0aGluZ3MuXHJcbiAgICAgICAqL1xyXG4gICAgICBmdW5jdGlvbkNhcm91c2VsVmlzaWJsZTogZmFsc2UsXHJcblxyXG4gICAgICBjYXJkQ2Fyb3VzZWxEZWZhdWx0UGFnZU51bWJlcjogMSwgLy8gc2hvdyBjYXJkcyAwLTMgaW4gaW5wdXQgY2Fyb3VzZWxcclxuICAgICAgZnVuY3Rpb25zUGVyUGFnZTogMiwgLy8gZnVuY3Rpb25zIHBlciBwYWdlIGluIHRoZSBmdW5jdGlvbnMgY2Fyb3VzZWwgKHdoaWNoIGlzIGludmlzaWJsZSlcclxuICAgICAgaGFzVGFibGVEcmF3ZXI6IHRydWUsIC8vIGluY2x1ZGUgYW4gWFkgdGFibGUgZHJhd2VyXHJcbiAgICAgIGhhc0dyYXBoRHJhd2VyOiB0cnVlLCAvLyBpbmNsdWRlIGFuIFhZIGdyYXBoIGRyYXdlclxyXG4gICAgICBoaWRlRnVuY3Rpb25zQ2hlY2tib3hWaXNpYmxlOiBmYWxzZSAvLyBoaWRlIHRoaXMgZmVhdHVyZVxyXG5cclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggc2NlbmUsIGxheW91dEJvdW5kcywgTXlzdGVyeUZ1bmN0aW9uTm9kZSwgb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIFRvZ2dsZSBidXR0b25zIGJlbG93IGVhY2ggYnVpbGRlciBzbG90LCBmb3IgcmV2ZWFsaW5nIGlkZW50aXR5IG9mIGZ1bmN0aW9uc1xyXG4gICAgdGhpcy5yZXZlYWxQcm9wZXJ0aWVzID0gW107ICAvLyB7UHJvcGVydHkuPGJvb2xlYW4+W119XHJcbiAgICB0aGlzLnJldmVhbEJ1dHRvbnMgPSBbXTsgLy8ge0V5ZVRvZ2dsZUJ1dHRvbltdfVxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgc2NlbmUuYnVpbGRlci5udW1iZXJPZlNsb3RzOyBpKysgKSB7XHJcblxyXG4gICAgICAvKipcclxuICAgICAgICogQ3JlYXRlIGEgY2xvc3VyZSBmb3Igc2xvdE51bWJlciB1c2luZyBhbiBJSUZFXHJcbiAgICAgICAqIEBwYXJhbSB7TXlzdGVyeVNjZW5lTm9kZX0gbXlzdGVyeVNjZW5lTm9kZVxyXG4gICAgICAgKiBAcGFyYW0ge251bWJlcn0gc2xvdE51bWJlclxyXG4gICAgICAgKi9cclxuICAgICAgKCBmdW5jdGlvbiggbXlzdGVyeVNjZW5lTm9kZSwgc2xvdE51bWJlciApIHtcclxuXHJcbiAgICAgICAgLy8ge1Byb3BlcnR5Ljxib29sZWFuPn0gUHJvcGVydHkgYXNzb2NpYXRlZCB3aXRoIHRoZSBzbG90XHJcbiAgICAgICAgY29uc3QgcmV2ZWFsUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG4gICAgICAgIG15c3RlcnlTY2VuZU5vZGUucmV2ZWFsUHJvcGVydGllcy5wdXNoKCByZXZlYWxQcm9wZXJ0eSApO1xyXG5cclxuICAgICAgICAvLyB3aXJlIHVwIFByb3BlcnR5IHRvIGNvbnRyb2wgdGhlIGZ1bmN0aW9uIHRoYXQncyBpbiB0aGUgc2xvdFxyXG4gICAgICAgIC8vIHVubGluayB1bm5lY2Vzc2FyeSwgaW5zdGFuY2VzIGV4aXN0IGZvciBsaWZldGltZSBvZiB0aGUgc2ltXHJcbiAgICAgICAgcmV2ZWFsUHJvcGVydHkubGluayggcmV2ZWFsID0+IHtcclxuICAgICAgICAgIGNvbnN0IGZ1bmN0aW9uTm9kZSA9IG15c3RlcnlTY2VuZU5vZGUuYnVpbGRlck5vZGUuZ2V0RnVuY3Rpb25Ob2RlKCBzbG90TnVtYmVyICk7XHJcbiAgICAgICAgICBpZiAoIGZ1bmN0aW9uTm9kZSApIHtcclxuICAgICAgICAgICAgZnVuY3Rpb25Ob2RlLmlkZW50aXR5VmlzaWJsZVByb3BlcnR5LnNldCggcmV2ZWFsICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSApO1xyXG5cclxuICAgICAgICAvLyBidXR0b24gYmVsb3cgdGhlIHNsb3RcclxuICAgICAgICBjb25zdCBzbG90UG9zaXRpb24gPSBzY2VuZS5idWlsZGVyLnNsb3RzWyBzbG90TnVtYmVyIF0ucG9zaXRpb247XHJcbiAgICAgICAgY29uc3QgcmV2ZWFsQnV0dG9uID0gbmV3IEV5ZVRvZ2dsZUJ1dHRvbiggcmV2ZWFsUHJvcGVydHksIHtcclxuICAgICAgICAgIGJhc2VDb2xvcjogRkJDb2xvcnMuSElEREVOX0ZVTkNUSU9OLFxyXG4gICAgICAgICAgc2NhbGU6IDAuNzUsXHJcbiAgICAgICAgICBjZW50ZXJYOiBzbG90UG9zaXRpb24ueCxcclxuICAgICAgICAgIHRvcDogc2xvdFBvc2l0aW9uLnkgKyA2NVxyXG4gICAgICAgIH0gKTtcclxuICAgICAgICBteXN0ZXJ5U2NlbmVOb2RlLnJldmVhbEJ1dHRvbnMucHVzaCggcmV2ZWFsQnV0dG9uICk7XHJcbiAgICAgICAgbXlzdGVyeVNjZW5lTm9kZS5jb250cm9sc0xheWVyLmFkZENoaWxkKCByZXZlYWxCdXR0b24gKTtcclxuXHJcbiAgICAgICAgLy8gdG91Y2hBcmVhXHJcbiAgICAgICAgcmV2ZWFsQnV0dG9uLnRvdWNoQXJlYSA9IHJldmVhbEJ1dHRvbi5sb2NhbEJvdW5kcy5kaWxhdGVkWFkoIDI1LCAxNSApO1xyXG5cclxuICAgICAgfSApKCB0aGlzLCBpICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYnV0dG9uIGZvciBnZW5lcmF0aW5nIGEgbmV3IGNoYWxsZW5nZVxyXG4gICAgY29uc3QgZ2VuZXJhdGVCdXR0b24gPSBuZXcgUmVmcmVzaEJ1dHRvbigge1xyXG4gICAgICBsaXN0ZW5lcjogKCkgPT4gc2NlbmUubmV4dENoYWxsZW5nZSgpLFxyXG4gICAgICBpY29uSGVpZ2h0OiAzOCxcclxuICAgICAgeE1hcmdpbjogMTgsXHJcbiAgICAgIHlNYXJnaW46IDEwLFxyXG4gICAgICBjZW50ZXJYOiB0aGlzLmJ1aWxkZXJOb2RlLmNlbnRlclgsXHJcbiAgICAgIHRvcDogdGhpcy5idWlsZGVyTm9kZS5ib3R0b20gKyA2NVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggZ2VuZXJhdGVCdXR0b24gKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSBzaG93cyB0aGUgYW5zd2VyIGJlbG93IHRoZSBnZW5lcmF0ZSBidXR0b24sIGZvciBkZWJ1Z2dpbmcsIGkxOG4gbm90IHJlcXVpcmVkXHJcbiAgICB0aGlzLmFuc3dlck5vZGUgPSBuZXcgVGV4dCggJ2Fuc3dlcicsIHtcclxuICAgICAgZm9udDogbmV3IFBoZXRGb250KCAxOCApLFxyXG4gICAgICBjZW50ZXJYOiBnZW5lcmF0ZUJ1dHRvbi5jZW50ZXJYLFxyXG4gICAgICB0b3A6IGdlbmVyYXRlQnV0dG9uLmJvdHRvbSArIDEwXHJcbiAgICB9ICk7XHJcbiAgICBpZiAoIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuc2hvd0Fuc3dlcnMgKSB7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuYW5zd2VyTm9kZSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEBwcml2YXRlIHtPYmplY3R9IG1hcHMgZnJvbSBvcGVyYXRvciB0byBmdW5jdGlvbiBjb250YWluZXIsIGNyZWF0ZWQgb24gZGVtYW5kIGJ5IHVwZGF0ZUNoYWxsZW5nZVxyXG4gICAgdGhpcy5vcGVyYXRvclRvQ29udGFpbmVyTWFwID0gbnVsbDtcclxuXHJcbiAgICAvLyBVcGRhdGUgd2hlbiB0aGUgY2hhbGxlbmdlIGNoYW5nZXMuXHJcbiAgICAvLyBUaGlzIGNhbid0IGJlIGV4ZWN1dGVkIHVudGlsIHRoZSBmdW5jdGlvbiBjYXJvdXNlbCBpcyBwb3B1bGF0ZWQuXHJcbiAgICAvLyB1bmxpbmsgdW5uZWNlc3NhcnksIGluc3RhbmNlcyBleGlzdCBmb3IgbGlmZXRpbWUgb2YgdGhlIHNpbVxyXG4gICAgc2NlbmUuY2hhbGxlbmdlUHJvcGVydHkubGF6eUxpbmsoIGNoYWxsZW5nZSA9PiB7XHJcbiAgICAgIHRoaXMudXBkYXRlQ2hhbGxlbmdlKCk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gRW5hYmxlIGZlYXR1cmVzIGJhc2VkIG9uIG51bWJlciBvZiBjYXJkcyB0aGF0IGhhdmUgYmVlbiBtb3ZlZCB0byB0aGUgb3V0cHV0IGNhcm91c2VsLlxyXG4gICAgLy8gdW5saW5rIHVubmVjZXNzYXJ5LCBpbnN0YW5jZXMgZXhpc3QgZm9yIGxpZmV0aW1lIG9mIHRoZSBzaW0uXHJcbiAgICB0aGlzLm91dHB1dENhcm91c2VsLm51bWJlck9mQ2FyZHNQcm9wZXJ0eS5saW5rKCBudW1iZXJPZkNhcmRzID0+IHtcclxuXHJcbiAgICAgIC8vIGVuYWJsZWQgZnVuY3Rpb24gcmV2ZWFsIGJ1dHRvbnNcclxuICAgICAgdGhpcy5yZXZlYWxCdXR0b25zLmZvckVhY2goIHJldmVhbEJ1dHRvbiA9PiB7XHJcbiAgICAgICAgcmV2ZWFsQnV0dG9uLmVuYWJsZWQgPSByZXZlYWxCdXR0b24uZW5hYmxlZCB8fCAoIG51bWJlck9mQ2FyZHMgPT09IDMgKTtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgLy8gZW5hYmxlICdTZWUgSW5zaWRlJyBjaGVja2JveFxyXG4gICAgICB0aGlzLnNlZUluc2lkZUNoZWNrYm94LmVuYWJsZWQgPSB0aGlzLnNlZUluc2lkZUNoZWNrYm94LmVuYWJsZWQgfHwgKCBudW1iZXJPZkNhcmRzID09PSAxICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMuc2NlbmUgPSBzY2VuZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKi9cclxuICByZXNldCgpIHtcclxuICAgIHN1cGVyLnJlc2V0KCk7XHJcbiAgICB0aGlzLnJlc2V0Q2hhbGxlbmdlQ29udHJvbHMoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc2V0cyBjb250cm9scyB0aGF0IG5lZWQgdG8gYmUgcmVzZXQgZWFjaCB0aW1lIHRoZSBjaGFsbGVuZ2UgY2hhbmdlcy5cclxuICAgKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgcmVzZXRDaGFsbGVuZ2VDb250cm9scygpIHtcclxuXHJcbiAgICAvLyByZXNldCBQcm9wZXJ0aWVzIGZvciByZXZlYWxpbmcgZnVuY3Rpb24gaWRlbnRpdHlcclxuICAgIHRoaXMucmV2ZWFsUHJvcGVydGllcy5mb3JFYWNoKCByZXZlYWxQcm9wZXJ0eSA9PiByZXZlYWxQcm9wZXJ0eS5yZXNldCgpICk7XHJcblxyXG4gICAgLy8gZGlzYWJsZSBidXR0b25zIGZvciByZXZlYWxpbmcgZnVuY3Rpb24gaWRlbnRpdHlcclxuICAgIHRoaXMucmV2ZWFsQnV0dG9ucy5mb3JFYWNoKCByZXZlYWxCdXR0b24gPT4ge1xyXG4gICAgICByZXZlYWxCdXR0b24uZW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHJlc2V0ICdTZWUgSW5zaWRlJyBwcm9wZXJ0eVxyXG4gICAgdGhpcy5zZWVJbnNpZGVQcm9wZXJ0eS5yZXNldCgpO1xyXG5cclxuICAgIC8vIGRpc2FibGUgJ1NlZSBJbnNpZGUnIGNoZWNrYm94XHJcbiAgICB0aGlzLnNlZUluc2lkZUNoZWNrYm94LmVuYWJsZWQgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbXBsZXRlcyBpbml0aWFsaXphdGlvbiBieSBkaXNwbGF5aW5nIHRoZSBmaXJzdCBjaGFsbGVuZ2UuXHJcbiAgICpcclxuICAgKiBAcHVibGljXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICovXHJcbiAgY29tcGxldGVJbml0aWFsaXphdGlvbigpIHtcclxuICAgIHN1cGVyLmNvbXBsZXRlSW5pdGlhbGl6YXRpb24oKTtcclxuICAgIHRoaXMudXBkYXRlQ2hhbGxlbmdlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTeW5jaHJvbml6ZXMgdGhlIGRpc3BsYXllZCBjaGFsbGVuZ2Ugd2l0aCB0aGUgbW9kZWwuXHJcbiAgICpcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIHVwZGF0ZUNoYWxsZW5nZSgpIHtcclxuXHJcbiAgICB0aGlzLnJlc2V0Q2Fyb3VzZWxzKCk7XHJcbiAgICB0aGlzLmJ1aWxkZXJOb2RlLnJlc2V0KCk7XHJcbiAgICB0aGlzLnJlc2V0RnVuY3Rpb25zKCk7XHJcbiAgICB0aGlzLnJlc2V0Q2FyZHMoKTtcclxuXHJcbiAgICAvLyBjcmVhdGUgdGhlIG1hcCBvbiBkZW1hbmQsIHNpbmNlIGl0IGNhbid0IGJlIGRvbmUgdW50aWwgdGhlIHNpbSBoYXMgYmVlbiBmdWxseSBpbml0aWFsaXplZFxyXG4gICAgaWYgKCAhdGhpcy5vcGVyYXRvclRvQ29udGFpbmVyTWFwICkge1xyXG4gICAgICB0aGlzLm9wZXJhdG9yVG9Db250YWluZXJNYXAgPSB7fTtcclxuICAgICAgdGhpcy5mdW5jdGlvbkNvbnRhaW5lcnMuZm9yRWFjaCggZnVuY3Rpb25Db250YWluZXIgPT4ge1xyXG5cclxuICAgICAgICBjb25zdCBjb250ZW50cyA9IGZ1bmN0aW9uQ29udGFpbmVyLmdldENvbnRlbnRzKCk7XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggY29udGVudHMubGVuZ3RoID4gMCwgJ2VtcHR5IGZ1bmN0aW9uQ29udGFpbmVyJyApO1xyXG5cclxuICAgICAgICBjb25zdCBvcGVyYXRvciA9IGNvbnRlbnRzWyAwIF0uZnVuY3Rpb25JbnN0YW5jZS5vcGVyYXRvcjtcclxuICAgICAgICB0aGlzLm9wZXJhdG9yVG9Db250YWluZXJNYXBbIG9wZXJhdG9yIF0gPSBmdW5jdGlvbkNvbnRhaW5lcjtcclxuICAgICAgfSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGNvbnZlcnQgdGhlIGNoYWxsZW5nZSBmcm9tIGEgc3RyaW5nIHRvIGFuIGFycmF5IG9mIHtvcGVyYXRvcjogc3RyaW5nLCBvcGVyYW5kOiBudW1iZXJ9XHJcbiAgICBjb25zdCBjaGFsbGVuZ2UgPSB0aGlzLnNjZW5lLmNoYWxsZW5nZVByb3BlcnR5LmdldCgpO1xyXG4gICAgY29uc3QgY2hhbGxlbmdlT2JqZWN0cyA9IE15c3RlcnlDaGFsbGVuZ2VzLnBhcnNlQ2hhbGxlbmdlKCBjaGFsbGVuZ2UgKTtcclxuXHJcbiAgICAvLyB0cmFuc2ZlciBmdW5jdGlvbnMgZnJvbSBjYXJvdXNlbCB0byBidWlsZGVyLCBjb25maWd1cmVkIHRvIG1hdGNoIHRoZSBjaGFsbGVuZ2VcclxuICAgIGxldCBzbG90TnVtYmVyID0gMDtcclxuICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuc2NlbmUuZ2V0Q29sb3JzKCk7IC8vIHs8Q29sb3J8c3RyaW5nPltdfVxyXG4gICAgY2hhbGxlbmdlT2JqZWN0cy5mb3JFYWNoKCBjaGFsbGVuZ2VPYmplY3QgPT4ge1xyXG5cclxuICAgICAgLy8gZ2V0IHRoZSBjb250YWluZXIgdGhhdCBoYXMgZnVuY3Rpb25zIGZvciB0aGlzIG9wZXJhdG9yXHJcbiAgICAgIGNvbnN0IGZ1bmN0aW9uQ29udGFpbmVyID0gdGhpcy5vcGVyYXRvclRvQ29udGFpbmVyTWFwWyBjaGFsbGVuZ2VPYmplY3Qub3BlcmF0b3IgXTtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggZnVuY3Rpb25Db250YWluZXIsIGBubyBmdW5jdGlvbkNvbnRhaW5lciBmb3Igb3BlcmF0b3IgJHtjaGFsbGVuZ2VPYmplY3Qub3BlcmF0b3J9YCApO1xyXG5cclxuICAgICAgLy8gZ2V0IHRoZSBmaXJzdCBpdGVtIGluIHRoZSBjb250YWluZXJcclxuICAgICAgY29uc3QgZnVuY3Rpb25Ob2RlID0gZnVuY3Rpb25Db250YWluZXIuZ2V0Q29udGVudHMoKVsgMCBdO1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmdW5jdGlvbk5vZGUsIGBubyBmdW5jdGlvbiBmb3Igb3BlcmF0b3IgJHtjaGFsbGVuZ2VPYmplY3Qub3BlcmF0b3J9YCApO1xyXG4gICAgICBjb25zdCBmdW5jdGlvbkluc3RhbmNlID0gZnVuY3Rpb25Ob2RlLmZ1bmN0aW9uSW5zdGFuY2U7XHJcblxyXG4gICAgICAvLyBjb25maWd1cmUgdGhlIGZ1bmN0aW9uIHRvIG1hdGNoIHRoZSBjaGFsbGVuZ2VcclxuICAgICAgZnVuY3Rpb25JbnN0YW5jZS5vcGVyYW5kUHJvcGVydHkuc2V0KCBjaGFsbGVuZ2VPYmplY3Qub3BlcmFuZCApO1xyXG4gICAgICBmdW5jdGlvbkluc3RhbmNlLmZpbGxQcm9wZXJ0eS5zZXQoIGNvbG9yc1sgc2xvdE51bWJlciBdICk7XHJcblxyXG4gICAgICAvLyBtb3ZlIHRoZSBmdW5jdGlvbiB0byB0aGUgYnVpbGRlclxyXG4gICAgICBmdW5jdGlvbk5vZGUubW92ZVRvQnVpbGRlciggc2xvdE51bWJlciApO1xyXG5cclxuICAgICAgLy8gaGlkZSB0aGUgZnVuY3Rpb24ncyBpZGVudGl0eVxyXG4gICAgICBmdW5jdGlvbk5vZGUuaWRlbnRpdHlWaXNpYmxlUHJvcGVydHkuc2V0KCBmYWxzZSApO1xyXG5cclxuICAgICAgc2xvdE51bWJlcisrO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFJlc2V0cyBjb250cm9scyB0aGF0IG5lZWQgdG8gYmUgcmVzZXQgZWFjaCB0aW1lIHRoZSBjaGFsbGVuZ2UgY2hhbmdlcy5cclxuICAgIHRoaXMucmVzZXRDaGFsbGVuZ2VDb250cm9scygpO1xyXG5cclxuICAgIC8vIHNob3cgdGhlIGFuc3dlciBmb3IgZGVidWdnaW5nXHJcbiAgICB0aGlzLmFuc3dlck5vZGUuc3RyaW5nID0gYCMke3RoaXMuc2NlbmUuY2hhbGxlbmdlUG9vbC5pbmRleE9mKCBjaGFsbGVuZ2UgKSArIDF9OiAke2NoYWxsZW5nZX1gO1xyXG4gICAgdGhpcy5hbnN3ZXJOb2RlLmNlbnRlclggPSB0aGlzLmJ1aWxkZXJOb2RlLmNlbnRlclg7XHJcblxyXG4gICAgaWYgKCBGQlF1ZXJ5UGFyYW1ldGVycy5wb3B1bGF0ZU91dHB1dCApIHtcclxuICAgICAgdGhpcy5wb3B1bGF0ZU91dHB1dENhcm91c2VsKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbkJ1aWxkZXIucmVnaXN0ZXIoICdNeXN0ZXJ5U2NlbmVOb2RlJywgTXlzdGVyeVNjZW5lTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsZUFBZSxNQUFNLHdEQUF3RDtBQUNwRixPQUFPQyxhQUFhLE1BQU0sc0RBQXNEO0FBQ2hGLE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsU0FBU0MsSUFBSSxRQUFRLG1DQUFtQztBQUN4RCxPQUFPQyxRQUFRLE1BQU0sMEJBQTBCO0FBQy9DLE9BQU9DLGlCQUFpQixNQUFNLG1DQUFtQztBQUNqRSxPQUFPQyxtQkFB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