// Copyright 2020-2021, University of Colorado Boulder

/**
 * ControllableOperationNumberLineNode creates an OperationTrackingNumberLineNode and adds point controllers so that the
 * user can control point values and thus manipulate the operations.
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import PointControllerNode from '../../../../number-line-common/js/common/view/PointControllerNode.js';
import merge from '../../../../phet-core/js/merge.js';
import { Node } from '../../../../scenery/js/imports.js';
import numberLineOperations from '../../numberLineOperations.js';
import OperationTrackingNumberLineNode from './OperationTrackingNumberLineNode.js';
class ControllableOperationNumberLineNode extends Node {
  /**
   * @param {OperationTrackingNumberLine} numberLine
   * @param {PointController} initialValuePointController
   * @param {ObservableArrayDef.<PointController>} pointControllerObservableArray
   * @param {Bounds2} layoutBounds - the bounds into which this must be laid out
   * @param {Object} [options] - The options are specific to this class and its components, and are not propagated to
   * the superclass.
   */
  constructor(numberLine, initialValuePointController, pointControllerObservableArray, layoutBounds, options) {
    options = merge({
      numberLineNodeOptions: {
        pointNodeOptions: {
          radius: 6,
          labelOpacity: 0.7 // translucent point labels are needed so that short operations can be seen behind them
        }
      }
    }, options);
    super();

    // layer where the point controllers go so that they stay behind the points
    const pointControllerLayer = new Node();
    this.addChild(pointControllerLayer);

    // node that represents the number line itself
    const numberLineNode = new OperationTrackingNumberLineNode(numberLine, options.numberLineNodeOptions);
    this.addChild(numberLineNode);

    // point controller for the starting point on the number line, which is always present
    const initialValuePointControllerNode = new PointControllerNode(initialValuePointController);
    pointControllerLayer.addChild(initialValuePointControllerNode);

    // map of point controllers to nodes
    const pointControllerToNodeMap = new Map([[initialValuePointController, initialValuePointControllerNode]]);

    // point controller that is currently dragging if any, only one is allowed at a time
    let draggingPointController = null;

    // Define a closure that will update the pickable setting for the point controllers.  This exists because it's far
    // simpler to prevent simultaneous movements of the point controllers (which can occur in multi-touch environments)
    // than it is to support it.
    const updatePointControllerPickability = () => {
      // Check and update the dragging point controller variable.
      if (!draggingPointController || !draggingPointController.isDraggingProperty.value) {
        const allPointControllers = [initialValuePointController, ...pointControllerObservableArray];
        draggingPointController = allPointControllers.find(pc => pc.isDraggingProperty.value);
      }

      // Update the state of the point controller nodes based on which, if any, is currently being dragged.
      if (draggingPointController) {
        pointControllerToNodeMap.forEach((node, pointController) => {
          // Make sure that only the point controller being dragged is pickable.
          node.pickable = pointController === draggingPointController;

          // It's unlikely, but possible, for two controllers to get picked up in the same animation frame.  If that
          // happened and there is more than one point controller being dragged, cancel the interactions with any that
          // are not designated as the dragging point controller.
          if (pointController !== draggingPointController && pointController.isDraggingProperty.value) {
            node.interruptSubtreeInput();
          }
        });
      } else {
        // None of the point controllers are being dragged, so make sure all the point controller nodes are pickable.
        pointControllerToNodeMap.forEach(node => {
          node.pickable = true;
        });
      }
    };

    // Updated the pickability of all point controllers when the dragging state of one changes.  This number line node
    // is assumed to exist for the duration of the sim and therefore no unlink is necessary.
    initialValuePointController.isDraggingProperty.link(updatePointControllerPickability);

    // Add and remove nodes for the point controllers that come and go from the number line.
    pointControllerObservableArray.addItemAddedListener(addedPointController => {
      const pointControllerNode = new PointControllerNode(addedPointController);
      pointControllerToNodeMap.set(addedPointController, pointControllerNode);
      pointControllerLayer.addChild(pointControllerNode);
      addedPointController.isDraggingProperty.link(updatePointControllerPickability); // unlinked on removal
      const removalListener = removedPointController => {
        if (removedPointController === addedPointController) {
          pointControllerLayer.removeChild(pointControllerNode);
          pointControllerNode.dispose();
          pointControllerToNodeMap.delete(removedPointController);
          removedPointController.isDraggingProperty.unlink(updatePointControllerPickability);
          pointControllerObservableArray.removeItemRemovedListener(removalListener);
        }
      };
      pointControllerObservableArray.addItemRemovedListener(removalListener);
    });
  }
}
numberLineOperations.register('ControllableOperationNumberLineNode', ControllableOperationNumberLineNode);
export default ControllableOperationNumberLineNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQb2ludENvbnRyb2xsZXJOb2RlIiwibWVyZ2UiLCJOb2RlIiwibnVtYmVyTGluZU9wZXJhdGlvbnMiLCJPcGVyYXRpb25UcmFja2luZ051bWJlckxpbmVOb2RlIiwiQ29udHJvbGxhYmxlT3BlcmF0aW9uTnVtYmVyTGluZU5vZGUiLCJjb25zdHJ1Y3RvciIsIm51bWJlckxpbmUiLCJpbml0aWFsVmFsdWVQb2ludENvbnRyb2xsZXIiLCJwb2ludENvbnRyb2xsZXJPYnNlcnZhYmxlQXJyYXkiLCJsYXlvdXRCb3VuZHMiLCJvcHRpb25zIiwibnVtYmVyTGluZU5vZGVPcHRpb25zIiwicG9pbnROb2RlT3B0aW9ucyIsInJhZGl1cyIsImxhYmVsT3BhY2l0eSIsInBvaW50Q29udHJvbGxlckxheWVyIiwiYWRkQ2hpbGQiLCJudW1iZXJMaW5lTm9kZSIsImluaXRpYWxWYWx1ZVBvaW50Q29udHJvbGxlck5vZGUiLCJwb2ludENvbnRyb2xsZXJUb05vZGVNYXAiLCJNYXAiLCJkcmFnZ2luZ1BvaW50Q29udHJvbGxlciIsInVwZGF0ZVBvaW50Q29udHJvbGxlclBpY2thYmlsaXR5IiwiaXNEcmFnZ2luZ1Byb3BlcnR5IiwidmFsdWUiLCJhbGxQb2ludENvbnRyb2xsZXJzIiwiZmluZCIsInBjIiwiZm9yRWFjaCIsIm5vZGUiLCJwb2ludENvbnRyb2xsZXIiLCJwaWNrYWJsZSIsImludGVycnVwdFN1YnRyZWVJbnB1dCIsImxpbmsiLCJhZGRJdGVtQWRkZWRMaXN0ZW5lciIsImFkZGVkUG9pbnRDb250cm9sbGVyIiwicG9pbnRDb250cm9sbGVyTm9kZSIsInNldCIsInJlbW92YWxMaXN0ZW5lciIsInJlbW92ZWRQb2ludENvbnRyb2xsZXIiLCJyZW1vdmVDaGlsZCIsImRpc3Bvc2UiLCJkZWxldGUiLCJ1bmxpbmsiLCJyZW1vdmVJdGVtUmVtb3ZlZExpc3RlbmVyIiwiYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQ29udHJvbGxhYmxlT3BlcmF0aW9uTnVtYmVyTGluZU5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjAtMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQ29udHJvbGxhYmxlT3BlcmF0aW9uTnVtYmVyTGluZU5vZGUgY3JlYXRlcyBhbiBPcGVyYXRpb25UcmFja2luZ051bWJlckxpbmVOb2RlIGFuZCBhZGRzIHBvaW50IGNvbnRyb2xsZXJzIHNvIHRoYXQgdGhlXHJcbiAqIHVzZXIgY2FuIGNvbnRyb2wgcG9pbnQgdmFsdWVzIGFuZCB0aHVzIG1hbmlwdWxhdGUgdGhlIG9wZXJhdGlvbnMuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFBvaW50Q29udHJvbGxlck5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vbnVtYmVyLWxpbmUtY29tbW9uL2pzL2NvbW1vbi92aWV3L1BvaW50Q29udHJvbGxlck5vZGUuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IHsgTm9kZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBudW1iZXJMaW5lT3BlcmF0aW9ucyBmcm9tICcuLi8uLi9udW1iZXJMaW5lT3BlcmF0aW9ucy5qcyc7XHJcbmltcG9ydCBPcGVyYXRpb25UcmFja2luZ051bWJlckxpbmVOb2RlIGZyb20gJy4vT3BlcmF0aW9uVHJhY2tpbmdOdW1iZXJMaW5lTm9kZS5qcyc7XHJcblxyXG5jbGFzcyBDb250cm9sbGFibGVPcGVyYXRpb25OdW1iZXJMaW5lTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge09wZXJhdGlvblRyYWNraW5nTnVtYmVyTGluZX0gbnVtYmVyTGluZVxyXG4gICAqIEBwYXJhbSB7UG9pbnRDb250cm9sbGVyfSBpbml0aWFsVmFsdWVQb2ludENvbnRyb2xsZXJcclxuICAgKiBAcGFyYW0ge09ic2VydmFibGVBcnJheURlZi48UG9pbnRDb250cm9sbGVyPn0gcG9pbnRDb250cm9sbGVyT2JzZXJ2YWJsZUFycmF5XHJcbiAgICogQHBhcmFtIHtCb3VuZHMyfSBsYXlvdXRCb3VuZHMgLSB0aGUgYm91bmRzIGludG8gd2hpY2ggdGhpcyBtdXN0IGJlIGxhaWQgb3V0XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAtIFRoZSBvcHRpb25zIGFyZSBzcGVjaWZpYyB0byB0aGlzIGNsYXNzIGFuZCBpdHMgY29tcG9uZW50cywgYW5kIGFyZSBub3QgcHJvcGFnYXRlZCB0b1xyXG4gICAqIHRoZSBzdXBlcmNsYXNzLlxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBudW1iZXJMaW5lLCBpbml0aWFsVmFsdWVQb2ludENvbnRyb2xsZXIsIHBvaW50Q29udHJvbGxlck9ic2VydmFibGVBcnJheSwgbGF5b3V0Qm91bmRzLCBvcHRpb25zICkge1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG4gICAgICBudW1iZXJMaW5lTm9kZU9wdGlvbnM6IHtcclxuICAgICAgICBwb2ludE5vZGVPcHRpb25zOiB7XHJcbiAgICAgICAgICByYWRpdXM6IDYsXHJcbiAgICAgICAgICBsYWJlbE9wYWNpdHk6IDAuNyAvLyB0cmFuc2x1Y2VudCBwb2ludCBsYWJlbHMgYXJlIG5lZWRlZCBzbyB0aGF0IHNob3J0IG9wZXJhdGlvbnMgY2FuIGJlIHNlZW4gYmVoaW5kIHRoZW1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIC8vIGxheWVyIHdoZXJlIHRoZSBwb2ludCBjb250cm9sbGVycyBnbyBzbyB0aGF0IHRoZXkgc3RheSBiZWhpbmQgdGhlIHBvaW50c1xyXG4gICAgY29uc3QgcG9pbnRDb250cm9sbGVyTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggcG9pbnRDb250cm9sbGVyTGF5ZXIgKTtcclxuXHJcbiAgICAvLyBub2RlIHRoYXQgcmVwcmVzZW50cyB0aGUgbnVtYmVyIGxpbmUgaXRzZWxmXHJcbiAgICBjb25zdCBudW1iZXJMaW5lTm9kZSA9IG5ldyBPcGVyYXRpb25UcmFja2luZ051bWJlckxpbmVOb2RlKCBudW1iZXJMaW5lLCBvcHRpb25zLm51bWJlckxpbmVOb2RlT3B0aW9ucyApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbnVtYmVyTGluZU5vZGUgKTtcclxuXHJcbiAgICAvLyBwb2ludCBjb250cm9sbGVyIGZvciB0aGUgc3RhcnRpbmcgcG9pbnQgb24gdGhlIG51bWJlciBsaW5lLCB3aGljaCBpcyBhbHdheXMgcHJlc2VudFxyXG4gICAgY29uc3QgaW5pdGlhbFZhbHVlUG9pbnRDb250cm9sbGVyTm9kZSA9IG5ldyBQb2ludENvbnRyb2xsZXJOb2RlKCBpbml0aWFsVmFsdWVQb2ludENvbnRyb2xsZXIgKTtcclxuICAgIHBvaW50Q29udHJvbGxlckxheWVyLmFkZENoaWxkKCBpbml0aWFsVmFsdWVQb2ludENvbnRyb2xsZXJOb2RlICk7XHJcblxyXG4gICAgLy8gbWFwIG9mIHBvaW50IGNvbnRyb2xsZXJzIHRvIG5vZGVzXHJcbiAgICBjb25zdCBwb2ludENvbnRyb2xsZXJUb05vZGVNYXAgPSBuZXcgTWFwKCBbIFsgaW5pdGlhbFZhbHVlUG9pbnRDb250cm9sbGVyLCBpbml0aWFsVmFsdWVQb2ludENvbnRyb2xsZXJOb2RlIF0gXSApO1xyXG5cclxuICAgIC8vIHBvaW50IGNvbnRyb2xsZXIgdGhhdCBpcyBjdXJyZW50bHkgZHJhZ2dpbmcgaWYgYW55LCBvbmx5IG9uZSBpcyBhbGxvd2VkIGF0IGEgdGltZVxyXG4gICAgbGV0IGRyYWdnaW5nUG9pbnRDb250cm9sbGVyID0gbnVsbDtcclxuXHJcbiAgICAvLyBEZWZpbmUgYSBjbG9zdXJlIHRoYXQgd2lsbCB1cGRhdGUgdGhlIHBpY2thYmxlIHNldHRpbmcgZm9yIHRoZSBwb2ludCBjb250cm9sbGVycy4gIFRoaXMgZXhpc3RzIGJlY2F1c2UgaXQncyBmYXJcclxuICAgIC8vIHNpbXBsZXIgdG8gcHJldmVudCBzaW11bHRhbmVvdXMgbW92ZW1lbnRzIG9mIHRoZSBwb2ludCBjb250cm9sbGVycyAod2hpY2ggY2FuIG9jY3VyIGluIG11bHRpLXRvdWNoIGVudmlyb25tZW50cylcclxuICAgIC8vIHRoYW4gaXQgaXMgdG8gc3VwcG9ydCBpdC5cclxuICAgIGNvbnN0IHVwZGF0ZVBvaW50Q29udHJvbGxlclBpY2thYmlsaXR5ID0gKCkgPT4ge1xyXG5cclxuICAgICAgLy8gQ2hlY2sgYW5kIHVwZGF0ZSB0aGUgZHJhZ2dpbmcgcG9pbnQgY29udHJvbGxlciB2YXJpYWJsZS5cclxuICAgICAgaWYgKCAhZHJhZ2dpbmdQb2ludENvbnRyb2xsZXIgfHwgIWRyYWdnaW5nUG9pbnRDb250cm9sbGVyLmlzRHJhZ2dpbmdQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICBjb25zdCBhbGxQb2ludENvbnRyb2xsZXJzID0gWyBpbml0aWFsVmFsdWVQb2ludENvbnRyb2xsZXIsIC4uLnBvaW50Q29udHJvbGxlck9ic2VydmFibGVBcnJheSBdO1xyXG4gICAgICAgIGRyYWdnaW5nUG9pbnRDb250cm9sbGVyID0gYWxsUG9pbnRDb250cm9sbGVycy5maW5kKCBwYyA9PiBwYy5pc0RyYWdnaW5nUHJvcGVydHkudmFsdWUgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVXBkYXRlIHRoZSBzdGF0ZSBvZiB0aGUgcG9pbnQgY29udHJvbGxlciBub2RlcyBiYXNlZCBvbiB3aGljaCwgaWYgYW55LCBpcyBjdXJyZW50bHkgYmVpbmcgZHJhZ2dlZC5cclxuICAgICAgaWYgKCBkcmFnZ2luZ1BvaW50Q29udHJvbGxlciApIHtcclxuXHJcbiAgICAgICAgcG9pbnRDb250cm9sbGVyVG9Ob2RlTWFwLmZvckVhY2goICggbm9kZSwgcG9pbnRDb250cm9sbGVyICkgPT4ge1xyXG5cclxuICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IG9ubHkgdGhlIHBvaW50IGNvbnRyb2xsZXIgYmVpbmcgZHJhZ2dlZCBpcyBwaWNrYWJsZS5cclxuICAgICAgICAgIG5vZGUucGlja2FibGUgPSBwb2ludENvbnRyb2xsZXIgPT09IGRyYWdnaW5nUG9pbnRDb250cm9sbGVyO1xyXG5cclxuICAgICAgICAgIC8vIEl0J3MgdW5saWtlbHksIGJ1dCBwb3NzaWJsZSwgZm9yIHR3byBjb250cm9sbGVycyB0byBnZXQgcGlja2VkIHVwIGluIHRoZSBzYW1lIGFuaW1hdGlvbiBmcmFtZS4gIElmIHRoYXRcclxuICAgICAgICAgIC8vIGhhcHBlbmVkIGFuZCB0aGVyZSBpcyBtb3JlIHRoYW4gb25lIHBvaW50IGNvbnRyb2xsZXIgYmVpbmcgZHJhZ2dlZCwgY2FuY2VsIHRoZSBpbnRlcmFjdGlvbnMgd2l0aCBhbnkgdGhhdFxyXG4gICAgICAgICAgLy8gYXJlIG5vdCBkZXNpZ25hdGVkIGFzIHRoZSBkcmFnZ2luZyBwb2ludCBjb250cm9sbGVyLlxyXG4gICAgICAgICAgaWYgKCBwb2ludENvbnRyb2xsZXIgIT09IGRyYWdnaW5nUG9pbnRDb250cm9sbGVyICYmIHBvaW50Q29udHJvbGxlci5pc0RyYWdnaW5nUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgICAgIG5vZGUuaW50ZXJydXB0U3VidHJlZUlucHV0KCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAvLyBOb25lIG9mIHRoZSBwb2ludCBjb250cm9sbGVycyBhcmUgYmVpbmcgZHJhZ2dlZCwgc28gbWFrZSBzdXJlIGFsbCB0aGUgcG9pbnQgY29udHJvbGxlciBub2RlcyBhcmUgcGlja2FibGUuXHJcbiAgICAgICAgcG9pbnRDb250cm9sbGVyVG9Ob2RlTWFwLmZvckVhY2goIG5vZGUgPT4geyBub2RlLnBpY2thYmxlID0gdHJ1ZTsgfSApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIFVwZGF0ZWQgdGhlIHBpY2thYmlsaXR5IG9mIGFsbCBwb2ludCBjb250cm9sbGVycyB3aGVuIHRoZSBkcmFnZ2luZyBzdGF0ZSBvZiBvbmUgY2hhbmdlcy4gIFRoaXMgbnVtYmVyIGxpbmUgbm9kZVxyXG4gICAgLy8gaXMgYXNzdW1lZCB0byBleGlzdCBmb3IgdGhlIGR1cmF0aW9uIG9mIHRoZSBzaW0gYW5kIHRoZXJlZm9yZSBubyB1bmxpbmsgaXMgbmVjZXNzYXJ5LlxyXG4gICAgaW5pdGlhbFZhbHVlUG9pbnRDb250cm9sbGVyLmlzRHJhZ2dpbmdQcm9wZXJ0eS5saW5rKCB1cGRhdGVQb2ludENvbnRyb2xsZXJQaWNrYWJpbGl0eSApO1xyXG5cclxuICAgIC8vIEFkZCBhbmQgcmVtb3ZlIG5vZGVzIGZvciB0aGUgcG9pbnQgY29udHJvbGxlcnMgdGhhdCBjb21lIGFuZCBnbyBmcm9tIHRoZSBudW1iZXIgbGluZS5cclxuICAgIHBvaW50Q29udHJvbGxlck9ic2VydmFibGVBcnJheS5hZGRJdGVtQWRkZWRMaXN0ZW5lciggYWRkZWRQb2ludENvbnRyb2xsZXIgPT4ge1xyXG4gICAgICBjb25zdCBwb2ludENvbnRyb2xsZXJOb2RlID0gbmV3IFBvaW50Q29udHJvbGxlck5vZGUoIGFkZGVkUG9pbnRDb250cm9sbGVyICk7XHJcbiAgICAgIHBvaW50Q29udHJvbGxlclRvTm9kZU1hcC5zZXQoIGFkZGVkUG9pbnRDb250cm9sbGVyLCBwb2ludENvbnRyb2xsZXJOb2RlICk7XHJcbiAgICAgIHBvaW50Q29udHJvbGxlckxheWVyLmFkZENoaWxkKCBwb2ludENvbnRyb2xsZXJOb2RlICk7XHJcbiAgICAgIGFkZGVkUG9pbnRDb250cm9sbGVyLmlzRHJhZ2dpbmdQcm9wZXJ0eS5saW5rKCB1cGRhdGVQb2ludENvbnRyb2xsZXJQaWNrYWJpbGl0eSApOyAvLyB1bmxpbmtlZCBvbiByZW1vdmFsXHJcbiAgICAgIGNvbnN0IHJlbW92YWxMaXN0ZW5lciA9IHJlbW92ZWRQb2ludENvbnRyb2xsZXIgPT4ge1xyXG4gICAgICAgIGlmICggcmVtb3ZlZFBvaW50Q29udHJvbGxlciA9PT0gYWRkZWRQb2ludENvbnRyb2xsZXIgKSB7XHJcbiAgICAgICAgICBwb2ludENvbnRyb2xsZXJMYXllci5yZW1vdmVDaGlsZCggcG9pbnRDb250cm9sbGVyTm9kZSApO1xyXG4gICAgICAgICAgcG9pbnRDb250cm9sbGVyTm9kZS5kaXNwb3NlKCk7XHJcbiAgICAgICAgICBwb2ludENvbnRyb2xsZXJUb05vZGVNYXAuZGVsZXRlKCByZW1vdmVkUG9pbnRDb250cm9sbGVyICk7XHJcbiAgICAgICAgICByZW1vdmVkUG9pbnRDb250cm9sbGVyLmlzRHJhZ2dpbmdQcm9wZXJ0eS51bmxpbmsoIHVwZGF0ZVBvaW50Q29udHJvbGxlclBpY2thYmlsaXR5ICk7XHJcbiAgICAgICAgICBwb2ludENvbnRyb2xsZXJPYnNlcnZhYmxlQXJyYXkucmVtb3ZlSXRlbVJlbW92ZWRMaXN0ZW5lciggcmVtb3ZhbExpc3RlbmVyICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBwb2ludENvbnRyb2xsZXJPYnNlcnZhYmxlQXJyYXkuYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciggcmVtb3ZhbExpc3RlbmVyICk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5udW1iZXJMaW5lT3BlcmF0aW9ucy5yZWdpc3RlciggJ0NvbnRyb2xsYWJsZU9wZXJhdGlvbk51bWJlckxpbmVOb2RlJywgQ29udHJvbGxhYmxlT3BlcmF0aW9uTnVtYmVyTGluZU5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgQ29udHJvbGxhYmxlT3BlcmF0aW9uTnVtYmVyTGluZU5vZGU7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLG1CQUFtQixNQUFNLHNF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