// Copyright 2020-2022, University of Colorado Boulder

/**
 * @author John Blanco (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import ScreenView from '../../../../joist/js/ScreenView.js';
import NLCConstants from '../../../../number-line-common/js/common/NLCConstants.js';
import NLCheckbox from '../../../../number-line-common/js/common/view/NLCheckbox.js';
import NLCheckboxGroup from '../../../../number-line-common/js/common/view/NLCheckboxGroup.js';
import EraserButton from '../../../../scenery-phet/js/buttons/EraserButton.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import NLOConstants from '../../common/NLOConstants.js';
import ControllableOperationNumberLineNode from '../../common/view/ControllableOperationNumberLineNode.js';
import OperationEntryCarousel from '../../common/view/OperationEntryCarousel.js';
import numberLineOperations from '../../numberLineOperations.js';
import NumberLineOperationsStrings from '../../NumberLineOperationsStrings.js';
import DynamicOperationDescription from './DynamicOperationDescription.js';
import InitialNetWorthAccordionBox from './InitialNetWorthAccordionBox.js';
import NumericalExpressionAccordionBox from './NumericalExpressionAccordionBox.js';
class NLOOperationsScreenView extends ScreenView {
  /**
   * @param {NLOOperationsModel} model
   * @param {tandem} tandem
   */
  constructor(model, tandem) {
    super({
      tandem: tandem
    });

    // number line node
    const numberLineNode = new ControllableOperationNumberLineNode(model.numberLine, model.initialValuePointController, model.pointControllers, this.layoutBounds, {
      numberLineNodeOptions: {
        pointNodeOptions: {
          radius: 6
        },
        numberLineOperationNodeOptions: {
          useFinancialDescriptions: true,
          operationLabelFont: new PhetFont(22),
          operationDescriptionsFadeIn: true
        }
      }
    });
    this.addChild(numberLineNode);

    // checkboxes that will control the presentation options
    const checkboxes = [new NLCheckbox(model.numberLine.showOperationDescriptionsProperty, NumberLineOperationsStrings.operationDescriptions), new NLCheckbox(model.numberLine.showOperationLabelsProperty, NumberLineOperationsStrings.operationLabels), new NLCheckbox(model.numberLine.showPointLabelsProperty, NumberLineOperationsStrings.pointLabels), new NLCheckbox(model.numberLine.showTickMarksProperty, NumberLineOperationsStrings.tickMarks)];
    this.addChild(new NLCheckboxGroup(checkboxes));

    // accordion box containing a mathematical description of the operations on the number line
    const numericalExpressionAccordionBox = new NumericalExpressionAccordionBox(model.numberLine, {
      centerX: this.layoutBounds.centerX,
      top: this.layoutBounds.minY + NLCConstants.SCREEN_VIEW_Y_MARGIN,
      showTitleWhenExpanded: true,
      numericalExpressionOptions: {
        showCurrencyWhenEvaluated: true
      }
    });
    this.addChild(numericalExpressionAccordionBox);
    const commonEntryControlOptions = {
      numberPickerRangeProperty: model.numberLine.displayedRangeProperty,
      numberPickerOptions: {
        timerDelay: 400,
        timerInterval: 100
      }
    };

    // carousel with the operation entry controls
    const operationEntryCarousel = new OperationEntryCarousel(model.numberLine, {
      right: this.layoutBounds.maxX - NLOConstants.OPERATION_ENTRY_CAROUSEL_LEFT_INSET,
      top: this.layoutBounds.minY + NLCConstants.SCREEN_VIEW_Y_MARGIN,
      entryControl1Options: commonEntryControlOptions,
      entryControl2Options: commonEntryControlOptions
    });
    this.addChild(operationEntryCarousel);

    // A flag that tracks whether the operation entry carousel is "in focus", which in this context means that the most
    // recent pointer down event had the carousel in its trail.  See usages to better understand why this is needed.
    const operationEntryCarouselHasFocusProperty = new BooleanProperty(false);

    // Add a listener that detects when pointer down events occur that are outside the operation entry carousel and
    // updated a Property to reflect whether the carousel has focus.  This code was highly leveraged from some code that
    // exists for a similar purpose in BuildingLabScreenView.  See
    // https://github.com/phetsims/number-line-operations/issues/23.
    phet.joist.display.addInputListener({
      down: event => {
        const screen = phet.joist.sim.selectedScreenProperty.value;
        if (screen && screen.view === this) {
          // See if our press was a "miss" (trail length 1) or a hit on our screen (screen.view in the trail). This is
          // necessary to exclude home-screen clicks.
          const doesTrailMatch = _.includes(event.trail.nodes, screen.view) || event.trail.length <= 1;
          if (doesTrailMatch) {
            operationEntryCarouselHasFocusProperty.set(_.includes(event.trail.nodes, operationEntryCarousel));
          }
        }
      }
    });

    // local constant that tracks if a reset is in progress, needed by the dynamic operation description
    const resetInProgressProperty = new BooleanProperty(false);

    // @private {DynamicOperationDescription[]} - Textual descriptions of the operations that are shown as the user
    // manipulates a potential operation before adding it to the number line.
    this.dynamicOperationDescriptions = [];
    model.numberLine.operations.forEach((operation, index) => {
      const dynamicOperationDescription = new DynamicOperationDescription(model.numberLine.showOperationDescriptionsProperty, new Vector2(this.layoutBounds.centerX, this.layoutBounds.minY + 145),
      // y offset empirically determined
      new Vector2(this.layoutBounds.centerX, this.layoutBounds.minY + 215),
      // y offset empirically determined
      operation, index, operationEntryCarousel.selectedPageProperty, model.numberLine, resetInProgressProperty, operationEntryCarouselHasFocusProperty, {
        maxWidth: 300
      });
      this.addChild(dynamicOperationDescription);
      this.dynamicOperationDescriptions.push(dynamicOperationDescription);
    });

    // erase button
    const eraserButton = new EraserButton({
      iconWidth: NLOConstants.ERASER_BUTTON_ICON_WIDTH,
      right: this.layoutBounds.maxX - NLOConstants.ERASER_BUTTON_INSET,
      centerY: model.numberLine.centerPositionProperty.value.y,
      touchAreaXDilation: 8,
      touchAreaYDilation: 8,
      listener: () => {
        numberLineNode.interruptSubtreeInput();
        model.numberLine.deactivateAllOperations();
        operationEntryCarousel.reset();

        // By design, the operations are set to have values of zero rather than their default values when the eraser
        // button is used.
        model.numberLine.operations.forEach(operation => operation.amountProperty.set(0));
      }
    });
    this.addChild(eraserButton);

    // erase is disabled if there are no operations
    model.numberLine.operations.forEach(operation => {
      // Operation are permanent, so no unlink is needed.
      operation.isActiveProperty.link(() => {
        eraserButton.enabled = model.numberLine.getActiveOperations().length > 0;
      });
    });

    // initial net worth control
    const initialNetWorthAccordionBox = new InitialNetWorthAccordionBox(model.numberLine.startingValueProperty, model.numberLine.displayedRangeProperty, {
      centerX: this.layoutBounds.centerX,
      top: this.layoutBounds.maxY - 150
    });
    this.addChild(initialNetWorthAccordionBox);

    // reset all button
    const resetAllButton = new ResetAllButton({
      listener: () => {
        resetInProgressProperty.set(true);
        this.interruptSubtreeInput(); // cancel interactions that may be in progress
        numericalExpressionAccordionBox.reset();
        initialNetWorthAccordionBox.expandedProperty.reset();
        operationEntryCarousel.reset();
        model.reset();
        model.numberLine.deactivateAllOperations();
        resetInProgressProperty.set(false);
      },
      right: this.layoutBounds.maxX - NLCConstants.SCREEN_VIEW_X_MARGIN,
      bottom: this.layoutBounds.maxY - NLCConstants.SCREEN_VIEW_Y_MARGIN,
      tandem: tandem.createTandem('resetAllButton')
    });
    this.addChild(resetAllButton);
  }
}
numberLineOperations.register('NLOOperationsScreenView', NLOOperationsScreenView);
export default NLOOperationsScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJWZWN0b3IyIiwiU2NyZWVuVmlldyIsIk5MQ0NvbnN0YW50cyIsIk5MQ2hlY2tib3giLCJOTENoZWNrYm94R3JvdXAiLCJFcmFzZXJCdXR0b24iLCJSZXNldEFsbEJ1dHRvbiIsIlBoZXRGb250IiwiTkxPQ29uc3RhbnRzIiwiQ29udHJvbGxhYmxlT3BlcmF0aW9uTnVtYmVyTGluZU5vZGUiLCJPcGVyYXRpb25FbnRyeUNhcm91c2VsIiwibnVtYmVyTGluZU9wZXJhdGlvbnMiLCJOdW1iZXJMaW5lT3BlcmF0aW9uc1N0cmluZ3MiLCJEeW5hbWljT3BlcmF0aW9uRGVzY3JpcHRpb24iLCJJbml0aWFsTmV0V29ydGhBY2NvcmRpb25Cb3giLCJOdW1lcmljYWxFeHByZXNzaW9uQWNjb3JkaW9uQm94IiwiTkxPT3BlcmF0aW9uc1NjcmVlblZpZXciLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwidGFuZGVtIiwibnVtYmVyTGluZU5vZGUiLCJudW1iZXJMaW5lIiwiaW5pdGlhbFZhbHVlUG9pbnRDb250cm9sbGVyIiwicG9pbnRDb250cm9sbGVycyIsImxheW91dEJvdW5kcyIsIm51bWJlckxpbmVOb2RlT3B0aW9ucyIsInBvaW50Tm9kZU9wdGlvbnMiLCJyYWRpdXMiLCJudW1iZXJMaW5lT3BlcmF0aW9uTm9kZU9wdGlvbnMiLCJ1c2VGaW5hbmNpYWxEZXNjcmlwdGlvbnMiLCJvcGVyYXRpb25MYWJlbEZvbnQiLCJvcGVyYXRpb25EZXNjcmlwdGlvbnNGYWRlSW4iLCJhZGRDaGlsZCIsImNoZWNrYm94ZXMiLCJzaG93T3BlcmF0aW9uRGVzY3JpcHRpb25zUHJvcGVydHkiLCJvcGVyYXRpb25EZXNjcmlwdGlvbnMiLCJzaG93T3BlcmF0aW9uTGFiZWxzUHJvcGVydHkiLCJvcGVyYXRpb25MYWJlbHMiLCJzaG93UG9pbnRMYWJlbHNQcm9wZXJ0eSIsInBvaW50TGFiZWxzIiwic2hvd1RpY2tNYXJrc1Byb3BlcnR5IiwidGlja01hcmtzIiwibnVtZXJpY2FsRXhwcmVzc2lvbkFjY29yZGlvbkJveCIsImNlbnRlclgiLCJ0b3AiLCJtaW5ZIiwiU0NSRUVOX1ZJRVdfWV9NQVJHSU4iLCJzaG93VGl0bGVXaGVuRXhwYW5kZWQiLCJudW1lcmljYWxFeHByZXNzaW9uT3B0aW9ucyIsInNob3dDdXJyZW5jeVdoZW5FdmFsdWF0ZWQiLCJjb21tb25FbnRyeUNvbnRyb2xPcHRpb25zIiwibnVtYmVyUGlja2VyUmFuZ2VQcm9wZXJ0eSIsImRpc3BsYXllZFJhbmdlUHJvcGVydHkiLCJudW1iZXJQaWNrZXJPcHRpb25zIiwidGltZXJEZWxheSIsInRpbWVySW50ZXJ2YWwiLCJvcGVyYXRpb25FbnRyeUNhcm91c2VsIiwicmlnaHQiLCJtYXhYIiwiT1BFUkFUSU9OX0VOVFJZX0NBUk9VU0VMX0xFRlRfSU5TRVQiLCJlbnRyeUNvbnRyb2wxT3B0aW9ucyIsImVudHJ5Q29udHJvbDJPcHRpb25zIiwib3BlcmF0aW9uRW50cnlDYXJvdXNlbEhhc0ZvY3VzUHJvcGVydHkiLCJwaGV0Iiwiam9pc3QiLCJkaXNwbGF5IiwiYWRkSW5wdXRMaXN0ZW5lciIsImRvd24iLCJldmVudCIsInNjcmVlbiIsInNpbSIsInNlbGVjdGVkU2NyZWVuUHJvcGVydHkiLCJ2YWx1ZSIsInZpZXciLCJkb2VzVHJhaWxNYXRjaCIsIl8iLCJpbmNsdWRlcyIsInRyYWlsIiwibm9kZXMiLCJsZW5ndGgiLCJzZXQiLCJyZXNldEluUHJvZ3Jlc3NQcm9wZXJ0eSIsImR5bmFtaWNPcGVyYXRpb25EZXNjcmlwdGlvbnMiLCJvcGVyYXRpb25zIiwiZm9yRWFjaCIsIm9wZXJhdGlvbiIsImluZGV4IiwiZHluYW1pY09wZXJhdGlvbkRlc2NyaXB0aW9uIiwic2VsZWN0ZWRQYWdlUHJvcGVydHkiLCJtYXhXaWR0aCIsInB1c2giLCJlcmFzZXJCdXR0b24iLCJpY29uV2lkdGgiLCJFUkFTRVJfQlVUVE9OX0lDT05fV0lEVEgiLCJFUkFTRVJfQlVUVE9OX0lOU0VUIiwiY2VudGVyWSIsImNlbnRlclBvc2l0aW9uUHJvcGVydHkiLCJ5IiwidG91Y2hBcmVhWERpbGF0aW9uIiwidG91Y2hBcmVhWURpbGF0aW9uIiwibGlzdGVuZXIiLCJpbnRlcnJ1cHRTdWJ0cmVlSW5wdXQiLCJkZWFjdGl2YXRlQWxsT3BlcmF0aW9ucyIsInJlc2V0IiwiYW1vdW50UHJvcGVydHkiLCJpc0FjdGl2ZVByb3BlcnR5IiwibGluayIsImVuYWJsZWQiLCJnZXRBY3RpdmVPcGVyYXRpb25zIiwiaW5pdGlhbE5ldFdvcnRoQWNjb3JkaW9uQm94Iiwic3RhcnRpbmdWYWx1ZVByb3BlcnR5IiwibWF4WSIsInJlc2V0QWxsQnV0dG9uIiwiZXhwYW5kZWRQcm9wZXJ0eSIsIlNDUkVFTl9WSUVXX1hfTUFSR0lOIiwiYm90dG9tIiwiY3JlYXRlVGFuZGVtIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJOTE9PcGVyYXRpb25zU2NyZWVuVmlldy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBTY3JlZW5WaWV3IGZyb20gJy4uLy4uLy4uLy4uL2pvaXN0L2pzL1NjcmVlblZpZXcuanMnO1xyXG5pbXBvcnQgTkxDQ29uc3RhbnRzIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9qcy9jb21tb24vTkxDQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IE5MQ2hlY2tib3ggZnJvbSAnLi4vLi4vLi4vLi4vbnVtYmVyLWxpbmUtY29tbW9uL2pzL2NvbW1vbi92aWV3L05MQ2hlY2tib3guanMnO1xyXG5pbXBvcnQgTkxDaGVja2JveEdyb3VwIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9qcy9jb21tb24vdmlldy9OTENoZWNrYm94R3JvdXAuanMnO1xyXG5pbXBvcnQgRXJhc2VyQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL0VyYXNlckJ1dHRvbi5qcyc7XHJcbmltcG9ydCBSZXNldEFsbEJ1dHRvbiBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvYnV0dG9ucy9SZXNldEFsbEJ1dHRvbi5qcyc7XHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUGhldEZvbnQuanMnO1xyXG5pbXBvcnQgTkxPQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9OTE9Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgQ29udHJvbGxhYmxlT3BlcmF0aW9uTnVtYmVyTGluZU5vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvQ29udHJvbGxhYmxlT3BlcmF0aW9uTnVtYmVyTGluZU5vZGUuanMnO1xyXG5pbXBvcnQgT3BlcmF0aW9uRW50cnlDYXJvdXNlbCBmcm9tICcuLi8uLi9jb21tb24vdmlldy9PcGVyYXRpb25FbnRyeUNhcm91c2VsLmpzJztcclxuaW1wb3J0IG51bWJlckxpbmVPcGVyYXRpb25zIGZyb20gJy4uLy4uL251bWJlckxpbmVPcGVyYXRpb25zLmpzJztcclxuaW1wb3J0IE51bWJlckxpbmVPcGVyYXRpb25zU3RyaW5ncyBmcm9tICcuLi8uLi9OdW1iZXJMaW5lT3BlcmF0aW9uc1N0cmluZ3MuanMnO1xyXG5pbXBvcnQgRHluYW1pY09wZXJhdGlvbkRlc2NyaXB0aW9uIGZyb20gJy4vRHluYW1pY09wZXJhdGlvbkRlc2NyaXB0aW9uLmpzJztcclxuaW1wb3J0IEluaXRpYWxOZXRXb3J0aEFjY29yZGlvbkJveCBmcm9tICcuL0luaXRpYWxOZXRXb3J0aEFjY29yZGlvbkJveC5qcyc7XHJcbmltcG9ydCBOdW1lcmljYWxFeHByZXNzaW9uQWNjb3JkaW9uQm94IGZyb20gJy4vTnVtZXJpY2FsRXhwcmVzc2lvbkFjY29yZGlvbkJveC5qcyc7XHJcblxyXG5jbGFzcyBOTE9PcGVyYXRpb25zU2NyZWVuVmlldyBleHRlbmRzIFNjcmVlblZpZXcge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge05MT09wZXJhdGlvbnNNb2RlbH0gbW9kZWxcclxuICAgKiBAcGFyYW0ge3RhbmRlbX0gdGFuZGVtXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1vZGVsLCB0YW5kZW0gKSB7XHJcblxyXG4gICAgc3VwZXIoIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBudW1iZXIgbGluZSBub2RlXHJcbiAgICBjb25zdCBudW1iZXJMaW5lTm9kZSA9IG5ldyBDb250cm9sbGFibGVPcGVyYXRpb25OdW1iZXJMaW5lTm9kZShcclxuICAgICAgbW9kZWwubnVtYmVyTGluZSxcclxuICAgICAgbW9kZWwuaW5pdGlhbFZhbHVlUG9pbnRDb250cm9sbGVyLFxyXG4gICAgICBtb2RlbC5wb2ludENvbnRyb2xsZXJzLFxyXG4gICAgICB0aGlzLmxheW91dEJvdW5kcyxcclxuICAgICAge1xyXG4gICAgICAgIG51bWJlckxpbmVOb2RlT3B0aW9uczoge1xyXG4gICAgICAgICAgcG9pbnROb2RlT3B0aW9uczoge1xyXG4gICAgICAgICAgICByYWRpdXM6IDZcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBudW1iZXJMaW5lT3BlcmF0aW9uTm9kZU9wdGlvbnM6IHtcclxuICAgICAgICAgICAgdXNlRmluYW5jaWFsRGVzY3JpcHRpb25zOiB0cnVlLFxyXG4gICAgICAgICAgICBvcGVyYXRpb25MYWJlbEZvbnQ6IG5ldyBQaGV0Rm9udCggMjIgKSxcclxuICAgICAgICAgICAgb3BlcmF0aW9uRGVzY3JpcHRpb25zRmFkZUluOiB0cnVlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbnVtYmVyTGluZU5vZGUgKTtcclxuXHJcbiAgICAvLyBjaGVja2JveGVzIHRoYXQgd2lsbCBjb250cm9sIHRoZSBwcmVzZW50YXRpb24gb3B0aW9uc1xyXG4gICAgY29uc3QgY2hlY2tib3hlcyA9IFtcclxuICAgICAgbmV3IE5MQ2hlY2tib3goIG1vZGVsLm51bWJlckxpbmUuc2hvd09wZXJhdGlvbkRlc2NyaXB0aW9uc1Byb3BlcnR5LCBOdW1iZXJMaW5lT3BlcmF0aW9uc1N0cmluZ3Mub3BlcmF0aW9uRGVzY3JpcHRpb25zICksXHJcbiAgICAgIG5ldyBOTENoZWNrYm94KCBtb2RlbC5udW1iZXJMaW5lLnNob3dPcGVyYXRpb25MYWJlbHNQcm9wZXJ0eSwgTnVtYmVyTGluZU9wZXJhdGlvbnNTdHJpbmdzLm9wZXJhdGlvbkxhYmVscyApLFxyXG4gICAgICBuZXcgTkxDaGVja2JveCggbW9kZWwubnVtYmVyTGluZS5zaG93UG9pbnRMYWJlbHNQcm9wZXJ0eSwgTnVtYmVyTGluZU9wZXJhdGlvbnNTdHJpbmdzLnBvaW50TGFiZWxzICksXHJcbiAgICAgIG5ldyBOTENoZWNrYm94KCBtb2RlbC5udW1iZXJMaW5lLnNob3dUaWNrTWFya3NQcm9wZXJ0eSwgTnVtYmVyTGluZU9wZXJhdGlvbnNTdHJpbmdzLnRpY2tNYXJrcyApXHJcbiAgICBdO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbmV3IE5MQ2hlY2tib3hHcm91cCggY2hlY2tib3hlcyApICk7XHJcblxyXG4gICAgLy8gYWNjb3JkaW9uIGJveCBjb250YWluaW5nIGEgbWF0aGVtYXRpY2FsIGRlc2NyaXB0aW9uIG9mIHRoZSBvcGVyYXRpb25zIG9uIHRoZSBudW1iZXIgbGluZVxyXG4gICAgY29uc3QgbnVtZXJpY2FsRXhwcmVzc2lvbkFjY29yZGlvbkJveCA9IG5ldyBOdW1lcmljYWxFeHByZXNzaW9uQWNjb3JkaW9uQm94KCBtb2RlbC5udW1iZXJMaW5lLCB7XHJcbiAgICAgIGNlbnRlclg6IHRoaXMubGF5b3V0Qm91bmRzLmNlbnRlclgsXHJcbiAgICAgIHRvcDogdGhpcy5sYXlvdXRCb3VuZHMubWluWSArIE5MQ0NvbnN0YW50cy5TQ1JFRU5fVklFV19ZX01BUkdJTixcclxuICAgICAgc2hvd1RpdGxlV2hlbkV4cGFuZGVkOiB0cnVlLFxyXG4gICAgICBudW1lcmljYWxFeHByZXNzaW9uT3B0aW9uczoge1xyXG4gICAgICAgIHNob3dDdXJyZW5jeVdoZW5FdmFsdWF0ZWQ6IHRydWVcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbnVtZXJpY2FsRXhwcmVzc2lvbkFjY29yZGlvbkJveCApO1xyXG5cclxuICAgIGNvbnN0IGNvbW1vbkVudHJ5Q29udHJvbE9wdGlvbnMgPSB7XHJcbiAgICAgIG51bWJlclBpY2tlclJhbmdlUHJvcGVydHk6IG1vZGVsLm51bWJlckxpbmUuZGlzcGxheWVkUmFuZ2VQcm9wZXJ0eSxcclxuICAgICAgbnVtYmVyUGlja2VyT3B0aW9uczoge1xyXG4gICAgICAgIHRpbWVyRGVsYXk6IDQwMCxcclxuICAgICAgICB0aW1lckludGVydmFsOiAxMDBcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBjYXJvdXNlbCB3aXRoIHRoZSBvcGVyYXRpb24gZW50cnkgY29udHJvbHNcclxuICAgIGNvbnN0IG9wZXJhdGlvbkVudHJ5Q2Fyb3VzZWwgPSBuZXcgT3BlcmF0aW9uRW50cnlDYXJvdXNlbCggbW9kZWwubnVtYmVyTGluZSwge1xyXG4gICAgICByaWdodDogdGhpcy5sYXlvdXRCb3VuZHMubWF4WCAtIE5MT0NvbnN0YW50cy5PUEVSQVRJT05fRU5UUllfQ0FST1VTRUxfTEVGVF9JTlNFVCxcclxuICAgICAgdG9wOiB0aGlzLmxheW91dEJvdW5kcy5taW5ZICsgTkxDQ29uc3RhbnRzLlNDUkVFTl9WSUVXX1lfTUFSR0lOLFxyXG4gICAgICBlbnRyeUNvbnRyb2wxT3B0aW9uczogY29tbW9uRW50cnlDb250cm9sT3B0aW9ucyxcclxuICAgICAgZW50cnlDb250cm9sMk9wdGlvbnM6IGNvbW1vbkVudHJ5Q29udHJvbE9wdGlvbnNcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIG9wZXJhdGlvbkVudHJ5Q2Fyb3VzZWwgKTtcclxuXHJcbiAgICAvLyBBIGZsYWcgdGhhdCB0cmFja3Mgd2hldGhlciB0aGUgb3BlcmF0aW9uIGVudHJ5IGNhcm91c2VsIGlzIFwiaW4gZm9jdXNcIiwgd2hpY2ggaW4gdGhpcyBjb250ZXh0IG1lYW5zIHRoYXQgdGhlIG1vc3RcclxuICAgIC8vIHJlY2VudCBwb2ludGVyIGRvd24gZXZlbnQgaGFkIHRoZSBjYXJvdXNlbCBpbiBpdHMgdHJhaWwuICBTZWUgdXNhZ2VzIHRvIGJldHRlciB1bmRlcnN0YW5kIHdoeSB0aGlzIGlzIG5lZWRlZC5cclxuICAgIGNvbnN0IG9wZXJhdGlvbkVudHJ5Q2Fyb3VzZWxIYXNGb2N1c1Byb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuXHJcbiAgICAvLyBBZGQgYSBsaXN0ZW5lciB0aGF0IGRldGVjdHMgd2hlbiBwb2ludGVyIGRvd24gZXZlbnRzIG9jY3VyIHRoYXQgYXJlIG91dHNpZGUgdGhlIG9wZXJhdGlvbiBlbnRyeSBjYXJvdXNlbCBhbmRcclxuICAgIC8vIHVwZGF0ZWQgYSBQcm9wZXJ0eSB0byByZWZsZWN0IHdoZXRoZXIgdGhlIGNhcm91c2VsIGhhcyBmb2N1cy4gIFRoaXMgY29kZSB3YXMgaGlnaGx5IGxldmVyYWdlZCBmcm9tIHNvbWUgY29kZSB0aGF0XHJcbiAgICAvLyBleGlzdHMgZm9yIGEgc2ltaWxhciBwdXJwb3NlIGluIEJ1aWxkaW5nTGFiU2NyZWVuVmlldy4gIFNlZVxyXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL251bWJlci1saW5lLW9wZXJhdGlvbnMvaXNzdWVzLzIzLlxyXG4gICAgcGhldC5qb2lzdC5kaXNwbGF5LmFkZElucHV0TGlzdGVuZXIoIHtcclxuICAgICAgZG93bjogZXZlbnQgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNjcmVlbiA9IHBoZXQuam9pc3Quc2ltLnNlbGVjdGVkU2NyZWVuUHJvcGVydHkudmFsdWU7XHJcbiAgICAgICAgaWYgKCBzY3JlZW4gJiYgc2NyZWVuLnZpZXcgPT09IHRoaXMgKSB7XHJcblxyXG4gICAgICAgICAgLy8gU2VlIGlmIG91ciBwcmVzcyB3YXMgYSBcIm1pc3NcIiAodHJhaWwgbGVuZ3RoIDEpIG9yIGEgaGl0IG9uIG91ciBzY3JlZW4gKHNjcmVlbi52aWV3IGluIHRoZSB0cmFpbCkuIFRoaXMgaXNcclxuICAgICAgICAgIC8vIG5lY2Vzc2FyeSB0byBleGNsdWRlIGhvbWUtc2NyZWVuIGNsaWNrcy5cclxuICAgICAgICAgIGNvbnN0IGRvZXNUcmFpbE1hdGNoID0gXy5pbmNsdWRlcyggZXZlbnQudHJhaWwubm9kZXMsIHNjcmVlbi52aWV3ICkgfHwgZXZlbnQudHJhaWwubGVuZ3RoIDw9IDE7XHJcblxyXG4gICAgICAgICAgaWYgKCBkb2VzVHJhaWxNYXRjaCApIHtcclxuICAgICAgICAgICAgb3BlcmF0aW9uRW50cnlDYXJvdXNlbEhhc0ZvY3VzUHJvcGVydHkuc2V0KCBfLmluY2x1ZGVzKCBldmVudC50cmFpbC5ub2Rlcywgb3BlcmF0aW9uRW50cnlDYXJvdXNlbCApICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gbG9jYWwgY29uc3RhbnQgdGhhdCB0cmFja3MgaWYgYSByZXNldCBpcyBpbiBwcm9ncmVzcywgbmVlZGVkIGJ5IHRoZSBkeW5hbWljIG9wZXJhdGlvbiBkZXNjcmlwdGlvblxyXG4gICAgY29uc3QgcmVzZXRJblByb2dyZXNzUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtEeW5hbWljT3BlcmF0aW9uRGVzY3JpcHRpb25bXX0gLSBUZXh0dWFsIGRlc2NyaXB0aW9ucyBvZiB0aGUgb3BlcmF0aW9ucyB0aGF0IGFyZSBzaG93biBhcyB0aGUgdXNlclxyXG4gICAgLy8gbWFuaXB1bGF0ZXMgYSBwb3RlbnRpYWwgb3BlcmF0aW9uIGJlZm9yZSBhZGRpbmcgaXQgdG8gdGhlIG51bWJlciBsaW5lLlxyXG4gICAgdGhpcy5keW5hbWljT3BlcmF0aW9uRGVzY3JpcHRpb25zID0gW107XHJcbiAgICBtb2RlbC5udW1iZXJMaW5lLm9wZXJhdGlvbnMuZm9yRWFjaCggKCBvcGVyYXRpb24sIGluZGV4ICkgPT4ge1xyXG4gICAgICBjb25zdCBkeW5hbWljT3BlcmF0aW9uRGVzY3JpcHRpb24gPSBuZXcgRHluYW1pY09wZXJhdGlvbkRlc2NyaXB0aW9uKFxyXG4gICAgICAgIG1vZGVsLm51bWJlckxpbmUuc2hvd09wZXJhdGlvbkRlc2NyaXB0aW9uc1Byb3BlcnR5LFxyXG4gICAgICAgIG5ldyBWZWN0b3IyKCB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJYLCB0aGlzLmxheW91dEJvdW5kcy5taW5ZICsgMTQ1ICksIC8vIHkgb2Zmc2V0IGVtcGlyaWNhbGx5IGRldGVybWluZWRcclxuICAgICAgICBuZXcgVmVjdG9yMiggdGhpcy5sYXlvdXRCb3VuZHMuY2VudGVyWCwgdGhpcy5sYXlvdXRCb3VuZHMubWluWSArIDIxNSApLCAvLyB5IG9mZnNldCBlbXBpcmljYWxseSBkZXRlcm1pbmVkXHJcbiAgICAgICAgb3BlcmF0aW9uLFxyXG4gICAgICAgIGluZGV4LFxyXG4gICAgICAgIG9wZXJhdGlvbkVudHJ5Q2Fyb3VzZWwuc2VsZWN0ZWRQYWdlUHJvcGVydHksXHJcbiAgICAgICAgbW9kZWwubnVtYmVyTGluZSxcclxuICAgICAgICByZXNldEluUHJvZ3Jlc3NQcm9wZXJ0eSxcclxuICAgICAgICBvcGVyYXRpb25FbnRyeUNhcm91c2VsSGFzRm9jdXNQcm9wZXJ0eSxcclxuICAgICAgICB7IG1heFdpZHRoOiAzMDAgfVxyXG4gICAgICApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCBkeW5hbWljT3BlcmF0aW9uRGVzY3JpcHRpb24gKTtcclxuICAgICAgdGhpcy5keW5hbWljT3BlcmF0aW9uRGVzY3JpcHRpb25zLnB1c2goIGR5bmFtaWNPcGVyYXRpb25EZXNjcmlwdGlvbiApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGVyYXNlIGJ1dHRvblxyXG4gICAgY29uc3QgZXJhc2VyQnV0dG9uID0gbmV3IEVyYXNlckJ1dHRvbigge1xyXG4gICAgICBpY29uV2lkdGg6IE5MT0NvbnN0YW50cy5FUkFTRVJfQlVUVE9OX0lDT05fV0lEVEgsXHJcbiAgICAgIHJpZ2h0OiB0aGlzLmxheW91dEJvdW5kcy5tYXhYIC0gTkxPQ29uc3RhbnRzLkVSQVNFUl9CVVRUT05fSU5TRVQsXHJcbiAgICAgIGNlbnRlclk6IG1vZGVsLm51bWJlckxpbmUuY2VudGVyUG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS55LFxyXG4gICAgICB0b3VjaEFyZWFYRGlsYXRpb246IDgsXHJcbiAgICAgIHRvdWNoQXJlYVlEaWxhdGlvbjogOCxcclxuICAgICAgbGlzdGVuZXI6ICgpID0+IHtcclxuICAgICAgICBudW1iZXJMaW5lTm9kZS5pbnRlcnJ1cHRTdWJ0cmVlSW5wdXQoKTtcclxuICAgICAgICBtb2RlbC5udW1iZXJMaW5lLmRlYWN0aXZhdGVBbGxPcGVyYXRpb25zKCk7XHJcbiAgICAgICAgb3BlcmF0aW9uRW50cnlDYXJvdXNlbC5yZXNldCgpO1xyXG5cclxuICAgICAgICAvLyBCeSBkZXNpZ24sIHRoZSBvcGVyYXRpb25zIGFyZSBzZXQgdG8gaGF2ZSB2YWx1ZXMgb2YgemVybyByYXRoZXIgdGhhbiB0aGVpciBkZWZhdWx0IHZhbHVlcyB3aGVuIHRoZSBlcmFzZXJcclxuICAgICAgICAvLyBidXR0b24gaXMgdXNlZC5cclxuICAgICAgICBtb2RlbC5udW1iZXJMaW5lLm9wZXJhdGlvbnMuZm9yRWFjaCggb3BlcmF0aW9uID0+IG9wZXJhdGlvbi5hbW91bnRQcm9wZXJ0eS5zZXQoIDAgKSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBlcmFzZXJCdXR0b24gKTtcclxuXHJcbiAgICAvLyBlcmFzZSBpcyBkaXNhYmxlZCBpZiB0aGVyZSBhcmUgbm8gb3BlcmF0aW9uc1xyXG4gICAgbW9kZWwubnVtYmVyTGluZS5vcGVyYXRpb25zLmZvckVhY2goIG9wZXJhdGlvbiA9PiB7XHJcblxyXG4gICAgICAvLyBPcGVyYXRpb24gYXJlIHBlcm1hbmVudCwgc28gbm8gdW5saW5rIGlzIG5lZWRlZC5cclxuICAgICAgb3BlcmF0aW9uLmlzQWN0aXZlUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICAgIGVyYXNlckJ1dHRvbi5lbmFibGVkID0gbW9kZWwubnVtYmVyTGluZS5nZXRBY3RpdmVPcGVyYXRpb25zKCkubGVuZ3RoID4gMDtcclxuICAgICAgfSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGluaXRpYWwgbmV0IHdvcnRoIGNvbnRyb2xcclxuICAgIGNvbnN0IGluaXRpYWxOZXRXb3J0aEFjY29yZGlvbkJveCA9IG5ldyBJbml0aWFsTmV0V29ydGhBY2NvcmRpb25Cb3goIG1vZGVsLm51bWJlckxpbmUuc3RhcnRpbmdWYWx1ZVByb3BlcnR5LFxyXG4gICAgICBtb2RlbC5udW1iZXJMaW5lLmRpc3BsYXllZFJhbmdlUHJvcGVydHksXHJcbiAgICAgIHtcclxuICAgICAgICBjZW50ZXJYOiB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJYLFxyXG4gICAgICAgIHRvcDogdGhpcy5sYXlvdXRCb3VuZHMubWF4WSAtIDE1MFxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggaW5pdGlhbE5ldFdvcnRoQWNjb3JkaW9uQm94ICk7XHJcblxyXG4gICAgLy8gcmVzZXQgYWxsIGJ1dHRvblxyXG4gICAgY29uc3QgcmVzZXRBbGxCdXR0b24gPSBuZXcgUmVzZXRBbGxCdXR0b24oIHtcclxuICAgICAgbGlzdGVuZXI6ICgpID0+IHtcclxuICAgICAgICByZXNldEluUHJvZ3Jlc3NQcm9wZXJ0eS5zZXQoIHRydWUgKTtcclxuICAgICAgICB0aGlzLmludGVycnVwdFN1YnRyZWVJbnB1dCgpOyAvLyBjYW5jZWwgaW50ZXJhY3Rpb25zIHRoYXQgbWF5IGJlIGluIHByb2dyZXNzXHJcbiAgICAgICAgbnVtZXJpY2FsRXhwcmVzc2lvbkFjY29yZGlvbkJveC5yZXNldCgpO1xyXG4gICAgICAgIGluaXRpYWxOZXRXb3J0aEFjY29yZGlvbkJveC5leHBhbmRlZFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICAgICAgb3BlcmF0aW9uRW50cnlDYXJvdXNlbC5yZXNldCgpO1xyXG4gICAgICAgIG1vZGVsLnJlc2V0KCk7XHJcbiAgICAgICAgbW9kZWwubnVtYmVyTGluZS5kZWFjdGl2YXRlQWxsT3BlcmF0aW9ucygpO1xyXG4gICAgICAgIHJlc2V0SW5Qcm9ncmVzc1Byb3BlcnR5LnNldCggZmFsc2UgKTtcclxuICAgICAgfSxcclxuICAgICAgcmlnaHQ6IHRoaXMubGF5b3V0Qm91bmRzLm1heFggLSBOTENDb25zdGFudHMuU0NSRUVOX1ZJRVdfWF9NQVJHSU4sXHJcbiAgICAgIGJvdHRvbTogdGhpcy5sYXlvdXRCb3VuZHMubWF4WSAtIE5MQ0NvbnN0YW50cy5TQ1JFRU5fVklFV19ZX01BUkdJTixcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAncmVzZXRBbGxCdXR0b24nIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHJlc2V0QWxsQnV0dG9uICk7XHJcbiAgfVxyXG59XHJcblxyXG5udW1iZXJMaW5lT3BlcmF0aW9ucy5yZWdpc3RlciggJ05MT09wZXJhdGlvbnNTY3JlZW5WaWV3JywgTkxPT3BlcmF0aW9uc1NjcmVlblZpZXcgKTtcclxuZXhwb3J0IGRlZmF1bHQgTkxPT3BlcmF0aW9uc1NjcmVlblZpZXc7Il0sIm1hcHBpbmdzIjoi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