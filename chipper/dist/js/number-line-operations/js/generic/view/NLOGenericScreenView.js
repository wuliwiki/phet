// Copyright 2020-2022, University of Colorado Boulder

/**
 * NLOGenericScreenView is the main screen view for the "Generic" screen.
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import ScreenView from '../../../../joist/js/ScreenView.js';
import NLCConstants from '../../../../number-line-common/js/common/NLCConstants.js';
import NLCheckbox from '../../../../number-line-common/js/common/view/NLCheckbox.js';
import NLCheckboxGroup from '../../../../number-line-common/js/common/view/NLCheckboxGroup.js';
import NumberLineRangeSelector from '../../../../number-line-common/js/common/view/NumberLineRangeSelector.js';
import merge from '../../../../phet-core/js/merge.js';
import EraserButton from '../../../../scenery-phet/js/buttons/EraserButton.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Color, Node, Text } from '../../../../scenery/js/imports.js';
import Animation from '../../../../twixt/js/Animation.js';
import Easing from '../../../../twixt/js/Easing.js';
import NLOConstants from '../../common/NLOConstants.js';
import ControllableOperationNumberLineNode from '../../common/view/ControllableOperationNumberLineNode.js';
import OperationEntryCarousel from '../../common/view/OperationEntryCarousel.js';
import numberLineOperations from '../../numberLineOperations.js';
import NumberLineOperationsStrings from '../../NumberLineOperationsStrings.js';
import NumericalExpressionAccordionBox from '../../operations/view/NumericalExpressionAccordionBox.js';
import NLOGenericModel from '../model/NLOGenericModel.js';
import SingleDualNumberLineSelector from './SingleDualNumberLineSelector.js';

// constants
const SECONDARY_ENTRY_CAROUSEL_THEME_COLOR = new Color(0xE5BDF5);
const SECONDARY_CAROUSEL_BUTTON_OPTIONS = {
  arrowDirection: 'up'
};
class NLOGenericScreenView extends ScreenView {
  /**
   * @param {NLOGenericModel} model
   * @param {Tandem} tandem
   */
  constructor(model, tandem) {
    super({
      tandem: tandem
    });

    // checkboxes that will control the presentation options
    const checkboxes = [new NLCheckbox(model.primaryNumberLine.showOperationLabelsProperty, NumberLineOperationsStrings.operationLabels), new NLCheckbox(model.primaryNumberLine.showPointLabelsProperty, NumberLineOperationsStrings.pointLabels), new NLCheckbox(model.primaryNumberLine.showTickMarksProperty, NumberLineOperationsStrings.tickMarks)];
    const checkboxGroup = new NLCheckboxGroup(checkboxes);
    this.addChild(checkboxGroup);

    // Create and add the representation of the primary number line.
    const primaryNumberLineView = new InteractiveNumberLineView(model.primaryNumberLine, model.primaryLineInitialValuePointController, model.primaryNumberLinePointControllers, this.layoutBounds, {
      numericalExpressionAccordionBoxOptions: {
        top: this.layoutBounds.minY + NLCConstants.SCREEN_VIEW_Y_MARGIN
      },
      operationEntryCarouselOptions: {
        top: this.layoutBounds.minY + NLCConstants.SCREEN_VIEW_Y_MARGIN
      }
    });
    this.addChild(primaryNumberLineView);

    // layer where the secondary number line will live, here so that it can be shown and hidden
    const secondaryNumberLineLayer = new Node({
      visible: false,
      opacity: 0
    });
    this.addChild(secondaryNumberLineLayer);

    // Create and add the representation of the secondary number line.
    const secondaryNumberLineView = new InteractiveNumberLineView(model.secondaryNumberLine, model.secondaryLineInitialValuePointController, model.secondaryNumberLinePointControllers, this.layoutBounds, {
      numericalExpressionAccordionBoxOptions: {
        bottom: this.layoutBounds.maxY - NLCConstants.SCREEN_VIEW_Y_MARGIN
      },
      operationEntryCarouselOptions: {
        bottom: this.layoutBounds.maxY - NLCConstants.SCREEN_VIEW_Y_MARGIN,
        themeColor: SECONDARY_ENTRY_CAROUSEL_THEME_COLOR,
        entryControl1Options: SECONDARY_CAROUSEL_BUTTON_OPTIONS,
        entryControl2Options: SECONDARY_CAROUSEL_BUTTON_OPTIONS,
        pageControlPosition: OperationEntryCarousel.PageControlPosition.ABOVE
      }
    });
    secondaryNumberLineLayer.addChild(secondaryNumberLineView);

    // reset all button
    const resetAllButton = new ResetAllButton({
      listener: () => {
        this.interruptSubtreeInput(); // cancel interactions that may be in progress
        primaryNumberLineView.reset();
        secondaryNumberLineView.reset();
        model.reset();
      },
      right: this.layoutBounds.maxX - NLCConstants.SCREEN_VIEW_X_MARGIN,
      bottom: this.layoutBounds.maxY - NLCConstants.SCREEN_VIEW_Y_MARGIN,
      tandem: tandem.createTandem('resetAllButton')
    });
    this.addChild(resetAllButton);

    // Add the selector used to show/hide the second number line.
    const singleDualNumberLineSelector = new SingleDualNumberLineSelector(model.secondNumberLineVisibleProperty, {
      left: checkboxGroup.left,
      bottom: resetAllButton.centerY
    });
    this.addChild(singleDualNumberLineSelector);

    // The second number line is only visible when enabled, and fades in and out.  Monitor the model property that is
    // associated with this visibility and create animations for the fades.  No unlink is necessary.
    let secondaryNumberLineFadeAnimation = null;
    model.secondNumberLineVisibleProperty.lazyLink(isVisible => {
      const targetOpacity = isVisible ? 1 : 0;
      if (secondaryNumberLineLayer.opacity !== targetOpacity) {
        // Stop any previous animation.
        if (secondaryNumberLineFadeAnimation) {
          secondaryNumberLineFadeAnimation.stop();
        }
        secondaryNumberLineFadeAnimation = new Animation({
          duration: 0.5,
          from: secondaryNumberLineLayer.opacity,
          to: targetOpacity,
          easing: Easing.CUBIC_IN_OUT,
          setValue: newOpacityValue => {
            // If the number line is starting to fade out, cancel any current interactions and make it unpickable so
            // that no new interactions can be started.
            if (secondaryNumberLineLayer.opacity === 1 && newOpacityValue < 1) {
              secondaryNumberLineLayer.interruptSubtreeInput();
              secondaryNumberLineLayer.pickable = false;
            }

            // Update the opacity for the layer on which the number line and associated controls reside.
            secondaryNumberLineLayer.opacity = newOpacityValue;

            // Keep the visibility in sync with the opacity so that we don't have invisible interactive components.
            if (newOpacityValue > 0 && !secondaryNumberLineLayer.visible) {
              secondaryNumberLineLayer.visible = true;
            } else if (newOpacityValue === 0 && secondaryNumberLineLayer.visible) {
              secondaryNumberLineLayer.visible = false;
            }
          }
        });
        secondaryNumberLineFadeAnimation.start();
        secondaryNumberLineFadeAnimation.endedEmitter.addListener(() => {
          // If the number line has just faded in, make it pickable.
          if (secondaryNumberLineLayer.opacity === 1) {
            secondaryNumberLineLayer.pickable = true;
          }
          secondaryNumberLineFadeAnimation = null;
        });
      }
    });

    // Add the number line range selector.
    this.addChild(new NumberLineRangeSelector(model.primaryNumberLine.displayedRangeProperty, NLOGenericModel.NUMBER_LINE_RANGES, this, {
      left: singleDualNumberLineSelector.left,
      bottom: singleDualNumberLineSelector.top - 12
    }));

    // Keep the selected range of the secondary number line in sync with that of the primary.  No unlink is needed.
    model.primaryNumberLine.displayedRangeProperty.link(displayedRange => {
      model.secondaryNumberLine.displayedRangeProperty.set(displayedRange);
    });
  }
}

/**
 * InteractiveNumberLineView is an inner class to creates and positions the various view elements used to represent and
 * interact with a number line.  It exists primarily to avoid code duplication.
 */
class InteractiveNumberLineView extends Node {
  /**
   * Add the various view elements for the provided number line.  This method exists primarily to minimize code
   * duplication.
   * @param {OperationTrackingNumberLine} numberLine
   * @param {PointController} initialValuePointController
   * @param {ObservableArrayDef.<PointController>} pointControllerObservableArray
   * @param {Bounds2} layoutBounds - the bounds into which this must be laid out
   * @param {Object} [options] - These options are specific to this class and its components, and they are not
   * propagated to the superclass.
   */
  constructor(numberLine, initialValuePointController, pointControllerObservableArray, layoutBounds, options) {
    options = merge({
      numericalExpressionAccordionBoxOptions: {
        titleNode: new Text(NumberLineOperationsStrings.numericalExpression, {
          font: new PhetFont(18),
          maxWidth: 250
        }),
        centerX: layoutBounds.centerX
      },
      operationEntryCarouselOptions: {
        entryControl1Options: {
          increment: 1
        },
        entryControl2Options: {
          increment: 1
        },
        right: layoutBounds.maxX - NLOConstants.OPERATION_ENTRY_CAROUSEL_LEFT_INSET
      }
    }, options);
    super();

    // layer where the point controllers go so that they stay behind the points
    const pointControllerLayer = new Node();
    this.addChild(pointControllerLayer);

    // node that represents the number line itself
    const numberLineNode = new ControllableOperationNumberLineNode(numberLine, initialValuePointController, pointControllerObservableArray, layoutBounds, {
      numberLineNodeOptions: {
        numberLineOperationNodeOptions: {
          operationLabelFont: new PhetFont(22)
        }
      }
    });
    this.addChild(numberLineNode);

    // accordion box containing a mathematical description of the operations on the number line
    this.numericalExpressionAccordionBox = new NumericalExpressionAccordionBox(numberLine, options.numericalExpressionAccordionBoxOptions);
    this.addChild(this.numericalExpressionAccordionBox);

    // @private - carousel in which the operation entry controls reside
    this.operationEntryCarousel = new OperationEntryCarousel(numberLine, options.operationEntryCarouselOptions);
    this.addChild(this.operationEntryCarousel);

    // erase button
    const eraserButton = new EraserButton({
      iconWidth: NLOConstants.ERASER_BUTTON_ICON_WIDTH,
      right: layoutBounds.maxX - NLOConstants.ERASER_BUTTON_INSET,
      touchAreaXDilation: 8,
      touchAreaYDilation: 8,
      listener: () => {
        numberLineNode.interruptSubtreeInput();
        numberLine.deactivateAllOperations();
        this.operationEntryCarousel.reset();

        // By design, the operations are set to have values of zero rather than their default values when the eraser
        // button is used.
        numberLine.operations.forEach(operation => operation.amountProperty.set(0));
      }
    });
    this.addChild(eraserButton);

    // Erase is disabled if there are no operations.  No unlink is necessary.
    numberLine.operations.forEach(operation => {
      operation.isActiveProperty.link(() => {
        eraserButton.enabled = numberLine.getActiveOperations().length > 0;
      });
    });

    // Reposition the eraser button if the number line moves.  No unlink is necessary.
    numberLine.centerPositionProperty.link(position => {
      eraserButton.centerY = position.y;
    });

    // Monitor the points on the number line and make sure that the operation being manipulated is the one being shown
    // in the corresponding operation entry carousel.
    numberLine.residentPoints.addItemAddedListener(addedPoint => {
      // Hook up a listener to the new point that will make sure that the operation entry carousel is showing the
      // operation that is being manipulated.
      const pointIsDraggingListener = isDragging => {
        if (isDragging) {
          this.operationEntryCarousel.showOperationWithEndpoint(addedPoint);
        }
      };
      addedPoint.isDraggingProperty.lazyLink(pointIsDraggingListener);

      // Listen for when this point is removed and unhook the listener when it is.
      numberLine.residentPoints.addItemRemovedListener(function pointRemovedListener(removedPoint) {
        if (removedPoint === addedPoint) {
          removedPoint.isDraggingProperty.unlink(pointIsDraggingListener);
          numberLine.residentPoints.removeItemRemovedListener(pointRemovedListener);
        }
      });
    });
  }

  /**
   * @public
   */
  reset() {
    this.operationEntryCarousel.reset();
    this.numericalExpressionAccordionBox.reset();
  }
}
numberLineOperations.register('NLOGenericScreenView', NLOGenericScreenView);
export default NLOGenericScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTY3JlZW5WaWV3IiwiTkxDQ29uc3RhbnRzIiwiTkxDaGVja2JveCIsIk5MQ2hlY2tib3hHcm91cCIsIk51bWJlckxpbmVSYW5nZVNlbGVjdG9yIiwibWVyZ2UiLCJFcmFzZXJCdXR0b24iLCJSZXNldEFsbEJ1dHRvbiIsIlBoZXRGb250IiwiQ29sb3IiLCJOb2RlIiwiVGV4dCIsIkFuaW1hdGlvbiIsIkVhc2luZyIsIk5MT0NvbnN0YW50cyIsIkNvbnRyb2xsYWJsZU9wZXJhdGlvbk51bWJlckxpbmVOb2RlIiwiT3BlcmF0aW9uRW50cnlDYXJvdXNlbCIsIm51bWJlckxpbmVPcGVyYXRpb25zIiwiTnVtYmVyTGluZU9wZXJhdGlvbnNTdHJpbmdzIiwiTnVtZXJpY2FsRXhwcmVzc2lvbkFjY29yZGlvbkJveCIsIk5MT0dlbmVyaWNNb2RlbCIsIlNpbmdsZUR1YWxOdW1iZXJMaW5lU2VsZWN0b3IiLCJTRUNPTkRBUllfRU5UUllfQ0FST1VTRUxfVEhFTUVfQ09MT1IiLCJTRUNPTkRBUllfQ0FST1VTRUxfQlVUVE9OX09QVElPTlMiLCJhcnJvd0RpcmVjdGlvbiIsIk5MT0dlbmVyaWNTY3JlZW5WaWV3IiwiY29uc3RydWN0b3IiLCJtb2RlbCIsInRhbmRlbSIsImNoZWNrYm94ZXMiLCJwcmltYXJ5TnVtYmVyTGluZSIsInNob3dPcGVyYXRpb25MYWJlbHNQcm9wZXJ0eSIsIm9wZXJhdGlvbkxhYmVscyIsInNob3dQb2ludExhYmVsc1Byb3BlcnR5IiwicG9pbnRMYWJlbHMiLCJzaG93VGlja01hcmtzUHJvcGVydHkiLCJ0aWNrTWFya3MiLCJjaGVja2JveEdyb3VwIiwiYWRkQ2hpbGQiLCJwcmltYXJ5TnVtYmVyTGluZVZpZXciLCJJbnRlcmFjdGl2ZU51bWJlckxpbmVWaWV3IiwicHJpbWFyeUxpbmVJbml0aWFsVmFsdWVQb2ludENvbnRyb2xsZXIiLCJwcmltYXJ5TnVtYmVyTGluZVBvaW50Q29udHJvbGxlcnMiLCJsYXlvdXRCb3VuZHMiLCJudW1lcmljYWxFeHByZXNzaW9uQWNjb3JkaW9uQm94T3B0aW9ucyIsInRvcCIsIm1pblkiLCJTQ1JFRU5fVklFV19ZX01BUkdJTiIsIm9wZXJhdGlvbkVudHJ5Q2Fyb3VzZWxPcHRpb25zIiwic2Vjb25kYXJ5TnVtYmVyTGluZUxheWVyIiwidmlzaWJsZSIsIm9wYWNpdHkiLCJzZWNvbmRhcnlOdW1iZXJMaW5lVmlldyIsInNlY29uZGFyeU51bWJlckxpbmUiLCJzZWNvbmRhcnlMaW5lSW5pdGlhbFZhbHVlUG9pbnRDb250cm9sbGVyIiwic2Vjb25kYXJ5TnVtYmVyTGluZVBvaW50Q29udHJvbGxlcnMiLCJib3R0b20iLCJtYXhZIiwidGhlbWVDb2xvciIsImVudHJ5Q29udHJvbDFPcHRpb25zIiwiZW50cnlDb250cm9sMk9wdGlvbnMiLCJwYWdlQ29udHJvbFBvc2l0aW9uIiwiUGFnZUNvbnRyb2xQb3NpdGlvbiIsIkFCT1ZFIiwicmVzZXRBbGxCdXR0b24iLCJsaXN0ZW5lciIsImludGVycnVwdFN1YnRyZWVJbnB1dCIsInJlc2V0IiwicmlnaHQiLCJtYXhYIiwiU0NSRUVOX1ZJRVdfWF9NQVJHSU4iLCJjcmVhdGVUYW5kZW0iLCJzaW5nbGVEdWFsTnVtYmVyTGluZVNlbGVjdG9yIiwic2Vjb25kTnVtYmVyTGluZVZpc2libGVQcm9wZXJ0eSIsImxlZnQiLCJjZW50ZXJZIiwic2Vjb25kYXJ5TnVtYmVyTGluZUZhZGVBbmltYXRpb24iLCJsYXp5TGluayIsImlzVmlzaWJsZSIsInRhcmdldE9wYWNpdHkiLCJzdG9wIiwiZHVyYXRpb24iLCJmcm9tIiwidG8iLCJlYXNpbmciLCJDVUJJQ19JTl9PVVQiLCJzZXRWYWx1ZSIsIm5ld09wYWNpdHlWYWx1ZSIsInBpY2thYmxlIiwic3RhcnQiLCJlbmRlZEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImRpc3BsYXllZFJhbmdlUHJvcGVydHkiLCJOVU1CRVJfTElORV9SQU5HRVMiLCJsaW5rIiwiZGlzcGxheWVkUmFuZ2UiLCJzZXQiLCJudW1iZXJMaW5lIiwiaW5pdGlhbFZhbHVlUG9pbnRDb250cm9sbGVyIiwicG9pbnRDb250cm9sbGVyT2JzZXJ2YWJsZUFycmF5Iiwib3B0aW9ucyIsInRpdGxlTm9kZSIsIm51bWVyaWNhbEV4cHJlc3Npb24iLCJmb250IiwibWF4V2lkdGgiLCJjZW50ZXJYIiwiaW5jcmVtZW50IiwiT1BFUkFUSU9OX0VOVFJZX0NBUk9VU0VMX0xFRlRfSU5TRVQiLCJwb2ludENvbnRyb2xsZXJMYXllciIsIm51bWJlckxpbmVOb2RlIiwibnVtYmVyTGluZU5vZGVPcHRpb25zIiwibnVtYmVyTGluZU9wZXJhdGlvbk5vZGVPcHRpb25zIiwib3BlcmF0aW9uTGFiZWxGb250IiwibnVtZXJpY2FsRXhwcmVzc2lvbkFjY29yZGlvbkJveCIsIm9wZXJhdGlvbkVudHJ5Q2Fyb3VzZWwiLCJlcmFzZXJCdXR0b24iLCJpY29uV2lkdGgiLCJFUkFTRVJfQlVUVE9OX0lDT05fV0lEVEgiLCJFUkFTRVJfQlVUVE9OX0lOU0VUIiwidG91Y2hBcmVhWERpbGF0aW9uIiwidG91Y2hBcmVhWURpbGF0aW9uIiwiZGVhY3RpdmF0ZUFsbE9wZXJhdGlvbnMiLCJvcGVyYXRpb25zIiwiZm9yRWFjaCIsIm9wZXJhdGlvbiIsImFtb3VudFByb3BlcnR5IiwiaXNBY3RpdmVQcm9wZXJ0eSIsImVuYWJsZWQiLCJnZXRBY3RpdmVPcGVyYXRpb25zIiwibGVuZ3RoIiwiY2VudGVyUG9zaXRpb25Qcm9wZXJ0eSIsInBvc2l0aW9uIiwieSIsInJlc2lkZW50UG9pbnRzIiwiYWRkSXRlbUFkZGVkTGlzdGVuZXIiLCJhZGRlZFBvaW50IiwicG9pbnRJc0RyYWdnaW5nTGlzdGVuZXIiLCJpc0RyYWdnaW5nIiwic2hvd09wZXJhdGlvbldpdGhFbmRwb2ludCIsImlzRHJhZ2dpbmdQcm9wZXJ0eSIsImFkZEl0ZW1SZW1vdmVkTGlzdGVuZXIiLCJwb2ludFJlbW92ZWRMaXN0ZW5lciIsInJlbW92ZWRQb2ludCIsInVubGluayIsInJlbW92ZUl0ZW1SZW1vdmVkTGlzdGVuZXIiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIk5MT0dlbmVyaWNTY3JlZW5WaWV3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIwLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIE5MT0dlbmVyaWNTY3JlZW5WaWV3IGlzIHRoZSBtYWluIHNjcmVlbiB2aWV3IGZvciB0aGUgXCJHZW5lcmljXCIgc2NyZWVuLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBTY3JlZW5WaWV3IGZyb20gJy4uLy4uLy4uLy4uL2pvaXN0L2pzL1NjcmVlblZpZXcuanMnO1xyXG5pbXBvcnQgTkxDQ29uc3RhbnRzIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9qcy9jb21tb24vTkxDQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IE5MQ2hlY2tib3ggZnJvbSAnLi4vLi4vLi4vLi4vbnVtYmVyLWxpbmUtY29tbW9uL2pzL2NvbW1vbi92aWV3L05MQ2hlY2tib3guanMnO1xyXG5pbXBvcnQgTkxDaGVja2JveEdyb3VwIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9qcy9jb21tb24vdmlldy9OTENoZWNrYm94R3JvdXAuanMnO1xyXG5pbXBvcnQgTnVtYmVyTGluZVJhbmdlU2VsZWN0b3IgZnJvbSAnLi4vLi4vLi4vLi4vbnVtYmVyLWxpbmUtY29tbW9uL2pzL2NvbW1vbi92aWV3L051bWJlckxpbmVSYW5nZVNlbGVjdG9yLmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBFcmFzZXJCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL2J1dHRvbnMvRXJhc2VyQnV0dG9uLmpzJztcclxuaW1wb3J0IFJlc2V0QWxsQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL1Jlc2V0QWxsQnV0dG9uLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBOb2RlLCBUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEFuaW1hdGlvbiBmcm9tICcuLi8uLi8uLi8uLi90d2l4dC9qcy9BbmltYXRpb24uanMnO1xyXG5pbXBvcnQgRWFzaW5nIGZyb20gJy4uLy4uLy4uLy4uL3R3aXh0L2pzL0Vhc2luZy5qcyc7XHJcbmltcG9ydCBOTE9Db25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL05MT0NvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBDb250cm9sbGFibGVPcGVyYXRpb25OdW1iZXJMaW5lTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9Db250cm9sbGFibGVPcGVyYXRpb25OdW1iZXJMaW5lTm9kZS5qcyc7XHJcbmltcG9ydCBPcGVyYXRpb25FbnRyeUNhcm91c2VsIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L09wZXJhdGlvbkVudHJ5Q2Fyb3VzZWwuanMnO1xyXG5pbXBvcnQgbnVtYmVyTGluZU9wZXJhdGlvbnMgZnJvbSAnLi4vLi4vbnVtYmVyTGluZU9wZXJhdGlvbnMuanMnO1xyXG5pbXBvcnQgTnVtYmVyTGluZU9wZXJhdGlvbnNTdHJpbmdzIGZyb20gJy4uLy4uL051bWJlckxpbmVPcGVyYXRpb25zU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBOdW1lcmljYWxFeHByZXNzaW9uQWNjb3JkaW9uQm94IGZyb20gJy4uLy4uL29wZXJhdGlvbnMvdmlldy9OdW1lcmljYWxFeHByZXNzaW9uQWNjb3JkaW9uQm94LmpzJztcclxuaW1wb3J0IE5MT0dlbmVyaWNNb2RlbCBmcm9tICcuLi9tb2RlbC9OTE9HZW5lcmljTW9kZWwuanMnO1xyXG5pbXBvcnQgU2luZ2xlRHVhbE51bWJlckxpbmVTZWxlY3RvciBmcm9tICcuL1NpbmdsZUR1YWxOdW1iZXJMaW5lU2VsZWN0b3IuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IFNFQ09OREFSWV9FTlRSWV9DQVJPVVNFTF9USEVNRV9DT0xPUiA9IG5ldyBDb2xvciggMHhFNUJERjUgKTtcclxuY29uc3QgU0VDT05EQVJZX0NBUk9VU0VMX0JVVFRPTl9PUFRJT05TID0ge1xyXG4gIGFycm93RGlyZWN0aW9uOiAndXAnXHJcbn07XHJcblxyXG5jbGFzcyBOTE9HZW5lcmljU2NyZWVuVmlldyBleHRlbmRzIFNjcmVlblZpZXcge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge05MT0dlbmVyaWNNb2RlbH0gbW9kZWxcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1vZGVsLCB0YW5kZW0gKSB7XHJcblxyXG4gICAgc3VwZXIoIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBjaGVja2JveGVzIHRoYXQgd2lsbCBjb250cm9sIHRoZSBwcmVzZW50YXRpb24gb3B0aW9uc1xyXG4gICAgY29uc3QgY2hlY2tib3hlcyA9IFtcclxuICAgICAgbmV3IE5MQ2hlY2tib3goIG1vZGVsLnByaW1hcnlOdW1iZXJMaW5lLnNob3dPcGVyYXRpb25MYWJlbHNQcm9wZXJ0eSwgTnVtYmVyTGluZU9wZXJhdGlvbnNTdHJpbmdzLm9wZXJhdGlvbkxhYmVscyApLFxyXG4gICAgICBuZXcgTkxDaGVja2JveCggbW9kZWwucHJpbWFyeU51bWJlckxpbmUuc2hvd1BvaW50TGFiZWxzUHJvcGVydHksIE51bWJlckxpbmVPcGVyYXRpb25zU3RyaW5ncy5wb2ludExhYmVscyApLFxyXG4gICAgICBuZXcgTkxDaGVja2JveCggbW9kZWwucHJpbWFyeU51bWJlckxpbmUuc2hvd1RpY2tNYXJrc1Byb3BlcnR5LCBOdW1iZXJMaW5lT3BlcmF0aW9uc1N0cmluZ3MudGlja01hcmtzIClcclxuICAgIF07XHJcbiAgICBjb25zdCBjaGVja2JveEdyb3VwID0gbmV3IE5MQ2hlY2tib3hHcm91cCggY2hlY2tib3hlcyApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggY2hlY2tib3hHcm91cCApO1xyXG5cclxuICAgIC8vIENyZWF0ZSBhbmQgYWRkIHRoZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgcHJpbWFyeSBudW1iZXIgbGluZS5cclxuICAgIGNvbnN0IHByaW1hcnlOdW1iZXJMaW5lVmlldyA9IG5ldyBJbnRlcmFjdGl2ZU51bWJlckxpbmVWaWV3KFxyXG4gICAgICBtb2RlbC5wcmltYXJ5TnVtYmVyTGluZSxcclxuICAgICAgbW9kZWwucHJpbWFyeUxpbmVJbml0aWFsVmFsdWVQb2ludENvbnRyb2xsZXIsXHJcbiAgICAgIG1vZGVsLnByaW1hcnlOdW1iZXJMaW5lUG9pbnRDb250cm9sbGVycyxcclxuICAgICAgdGhpcy5sYXlvdXRCb3VuZHMsXHJcbiAgICAgIHtcclxuICAgICAgICBudW1lcmljYWxFeHByZXNzaW9uQWNjb3JkaW9uQm94T3B0aW9uczoge1xyXG4gICAgICAgICAgdG9wOiB0aGlzLmxheW91dEJvdW5kcy5taW5ZICsgTkxDQ29uc3RhbnRzLlNDUkVFTl9WSUVXX1lfTUFSR0lOXHJcbiAgICAgICAgfSxcclxuICAgICAgICBvcGVyYXRpb25FbnRyeUNhcm91c2VsT3B0aW9uczoge1xyXG4gICAgICAgICAgdG9wOiB0aGlzLmxheW91dEJvdW5kcy5taW5ZICsgTkxDQ29uc3RhbnRzLlNDUkVFTl9WSUVXX1lfTUFSR0lOXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggcHJpbWFyeU51bWJlckxpbmVWaWV3ICk7XHJcblxyXG4gICAgLy8gbGF5ZXIgd2hlcmUgdGhlIHNlY29uZGFyeSBudW1iZXIgbGluZSB3aWxsIGxpdmUsIGhlcmUgc28gdGhhdCBpdCBjYW4gYmUgc2hvd24gYW5kIGhpZGRlblxyXG4gICAgY29uc3Qgc2Vjb25kYXJ5TnVtYmVyTGluZUxheWVyID0gbmV3IE5vZGUoIHtcclxuICAgICAgdmlzaWJsZTogZmFsc2UsXHJcbiAgICAgIG9wYWNpdHk6IDBcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHNlY29uZGFyeU51bWJlckxpbmVMYXllciApO1xyXG5cclxuICAgIC8vIENyZWF0ZSBhbmQgYWRkIHRoZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc2Vjb25kYXJ5IG51bWJlciBsaW5lLlxyXG4gICAgY29uc3Qgc2Vjb25kYXJ5TnVtYmVyTGluZVZpZXcgPSBuZXcgSW50ZXJhY3RpdmVOdW1iZXJMaW5lVmlldyhcclxuICAgICAgbW9kZWwuc2Vjb25kYXJ5TnVtYmVyTGluZSxcclxuICAgICAgbW9kZWwuc2Vjb25kYXJ5TGluZUluaXRpYWxWYWx1ZVBvaW50Q29udHJvbGxlcixcclxuICAgICAgbW9kZWwuc2Vjb25kYXJ5TnVtYmVyTGluZVBvaW50Q29udHJvbGxlcnMsXHJcbiAgICAgIHRoaXMubGF5b3V0Qm91bmRzLFxyXG4gICAgICB7XHJcbiAgICAgICAgbnVtZXJpY2FsRXhwcmVzc2lvbkFjY29yZGlvbkJveE9wdGlvbnM6IHtcclxuICAgICAgICAgIGJvdHRvbTogdGhpcy5sYXlvdXRCb3VuZHMubWF4WSAtIE5MQ0NvbnN0YW50cy5TQ1JFRU5fVklFV19ZX01BUkdJTlxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb3BlcmF0aW9uRW50cnlDYXJvdXNlbE9wdGlvbnM6IHtcclxuICAgICAgICAgIGJvdHRvbTogdGhpcy5sYXlvdXRCb3VuZHMubWF4WSAtIE5MQ0NvbnN0YW50cy5TQ1JFRU5fVklFV19ZX01BUkdJTixcclxuICAgICAgICAgIHRoZW1lQ29sb3I6IFNFQ09OREFSWV9FTlRSWV9DQVJPVVNFTF9USEVNRV9DT0xPUixcclxuICAgICAgICAgIGVudHJ5Q29udHJvbDFPcHRpb25zOiBTRUNPTkRBUllfQ0FST1VTRUxfQlVUVE9OX09QVElPTlMsXHJcbiAgICAgICAgICBlbnRyeUNvbnRyb2wyT3B0aW9uczogU0VDT05EQVJZX0NBUk9VU0VMX0JVVFRPTl9PUFRJT05TLFxyXG4gICAgICAgICAgcGFnZUNvbnRyb2xQb3NpdGlvbjogT3BlcmF0aW9uRW50cnlDYXJvdXNlbC5QYWdlQ29udHJvbFBvc2l0aW9uLkFCT1ZFXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgc2Vjb25kYXJ5TnVtYmVyTGluZUxheWVyLmFkZENoaWxkKCBzZWNvbmRhcnlOdW1iZXJMaW5lVmlldyApO1xyXG5cclxuICAgIC8vIHJlc2V0IGFsbCBidXR0b25cclxuICAgIGNvbnN0IHJlc2V0QWxsQnV0dG9uID0gbmV3IFJlc2V0QWxsQnV0dG9uKCB7XHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5pbnRlcnJ1cHRTdWJ0cmVlSW5wdXQoKTsgLy8gY2FuY2VsIGludGVyYWN0aW9ucyB0aGF0IG1heSBiZSBpbiBwcm9ncmVzc1xyXG4gICAgICAgIHByaW1hcnlOdW1iZXJMaW5lVmlldy5yZXNldCgpO1xyXG4gICAgICAgIHNlY29uZGFyeU51bWJlckxpbmVWaWV3LnJlc2V0KCk7XHJcbiAgICAgICAgbW9kZWwucmVzZXQoKTtcclxuICAgICAgfSxcclxuICAgICAgcmlnaHQ6IHRoaXMubGF5b3V0Qm91bmRzLm1heFggLSBOTENDb25zdGFudHMuU0NSRUVOX1ZJRVdfWF9NQVJHSU4sXHJcbiAgICAgIGJvdHRvbTogdGhpcy5sYXlvdXRCb3VuZHMubWF4WSAtIE5MQ0NvbnN0YW50cy5TQ1JFRU5fVklFV19ZX01BUkdJTixcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAncmVzZXRBbGxCdXR0b24nIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHJlc2V0QWxsQnV0dG9uICk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBzZWxlY3RvciB1c2VkIHRvIHNob3cvaGlkZSB0aGUgc2Vjb25kIG51bWJlciBsaW5lLlxyXG4gICAgY29uc3Qgc2luZ2xlRHVhbE51bWJlckxpbmVTZWxlY3RvciA9IG5ldyBTaW5nbGVEdWFsTnVtYmVyTGluZVNlbGVjdG9yKCBtb2RlbC5zZWNvbmROdW1iZXJMaW5lVmlzaWJsZVByb3BlcnR5LCB7XHJcbiAgICAgIGxlZnQ6IGNoZWNrYm94R3JvdXAubGVmdCxcclxuICAgICAgYm90dG9tOiByZXNldEFsbEJ1dHRvbi5jZW50ZXJZXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBzaW5nbGVEdWFsTnVtYmVyTGluZVNlbGVjdG9yICk7XHJcblxyXG4gICAgLy8gVGhlIHNlY29uZCBudW1iZXIgbGluZSBpcyBvbmx5IHZpc2libGUgd2hlbiBlbmFibGVkLCBhbmQgZmFkZXMgaW4gYW5kIG91dC4gIE1vbml0b3IgdGhlIG1vZGVsIHByb3BlcnR5IHRoYXQgaXNcclxuICAgIC8vIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHZpc2liaWxpdHkgYW5kIGNyZWF0ZSBhbmltYXRpb25zIGZvciB0aGUgZmFkZXMuICBObyB1bmxpbmsgaXMgbmVjZXNzYXJ5LlxyXG4gICAgbGV0IHNlY29uZGFyeU51bWJlckxpbmVGYWRlQW5pbWF0aW9uID0gbnVsbDtcclxuICAgIG1vZGVsLnNlY29uZE51bWJlckxpbmVWaXNpYmxlUHJvcGVydHkubGF6eUxpbmsoIGlzVmlzaWJsZSA9PiB7XHJcbiAgICAgIGNvbnN0IHRhcmdldE9wYWNpdHkgPSBpc1Zpc2libGUgPyAxIDogMDtcclxuICAgICAgaWYgKCBzZWNvbmRhcnlOdW1iZXJMaW5lTGF5ZXIub3BhY2l0eSAhPT0gdGFyZ2V0T3BhY2l0eSApIHtcclxuXHJcbiAgICAgICAgLy8gU3RvcCBhbnkgcHJldmlvdXMgYW5pbWF0aW9uLlxyXG4gICAgICAgIGlmICggc2Vjb25kYXJ5TnVtYmVyTGluZUZhZGVBbmltYXRpb24gKSB7XHJcbiAgICAgICAgICBzZWNvbmRhcnlOdW1iZXJMaW5lRmFkZUFuaW1hdGlvbi5zdG9wKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZWNvbmRhcnlOdW1iZXJMaW5lRmFkZUFuaW1hdGlvbiA9IG5ldyBBbmltYXRpb24oIHtcclxuICAgICAgICAgIGR1cmF0aW9uOiAwLjUsXHJcbiAgICAgICAgICBmcm9tOiBzZWNvbmRhcnlOdW1iZXJMaW5lTGF5ZXIub3BhY2l0eSxcclxuICAgICAgICAgIHRvOiB0YXJnZXRPcGFjaXR5LFxyXG4gICAgICAgICAgZWFzaW5nOiBFYXNpbmcuQ1VCSUNfSU5fT1VULFxyXG4gICAgICAgICAgc2V0VmFsdWU6IG5ld09wYWNpdHlWYWx1ZSA9PiB7XHJcblxyXG4gICAgICAgICAgICAvLyBJZiB0aGUgbnVtYmVyIGxpbmUgaXMgc3RhcnRpbmcgdG8gZmFkZSBvdXQsIGNhbmNlbCBhbnkgY3VycmVudCBpbnRlcmFjdGlvbnMgYW5kIG1ha2UgaXQgdW5waWNrYWJsZSBzb1xyXG4gICAgICAgICAgICAvLyB0aGF0IG5vIG5ldyBpbnRlcmFjdGlvbnMgY2FuIGJlIHN0YXJ0ZWQuXHJcbiAgICAgICAgICAgIGlmICggc2Vjb25kYXJ5TnVtYmVyTGluZUxheWVyLm9wYWNpdHkgPT09IDEgJiYgbmV3T3BhY2l0eVZhbHVlIDwgMSApIHtcclxuICAgICAgICAgICAgICBzZWNvbmRhcnlOdW1iZXJMaW5lTGF5ZXIuaW50ZXJydXB0U3VidHJlZUlucHV0KCk7XHJcbiAgICAgICAgICAgICAgc2Vjb25kYXJ5TnVtYmVyTGluZUxheWVyLnBpY2thYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgb3BhY2l0eSBmb3IgdGhlIGxheWVyIG9uIHdoaWNoIHRoZSBudW1iZXIgbGluZSBhbmQgYXNzb2NpYXRlZCBjb250cm9scyByZXNpZGUuXHJcbiAgICAgICAgICAgIHNlY29uZGFyeU51bWJlckxpbmVMYXllci5vcGFjaXR5ID0gbmV3T3BhY2l0eVZhbHVlO1xyXG5cclxuICAgICAgICAgICAgLy8gS2VlcCB0aGUgdmlzaWJpbGl0eSBpbiBzeW5jIHdpdGggdGhlIG9wYWNpdHkgc28gdGhhdCB3ZSBkb24ndCBoYXZlIGludmlzaWJsZSBpbnRlcmFjdGl2ZSBjb21wb25lbnRzLlxyXG4gICAgICAgICAgICBpZiAoIG5ld09wYWNpdHlWYWx1ZSA+IDAgJiYgIXNlY29uZGFyeU51bWJlckxpbmVMYXllci52aXNpYmxlICkge1xyXG4gICAgICAgICAgICAgIHNlY29uZGFyeU51bWJlckxpbmVMYXllci52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICggbmV3T3BhY2l0eVZhbHVlID09PSAwICYmIHNlY29uZGFyeU51bWJlckxpbmVMYXllci52aXNpYmxlICkge1xyXG4gICAgICAgICAgICAgIHNlY29uZGFyeU51bWJlckxpbmVMYXllci52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9ICk7XHJcbiAgICAgICAgc2Vjb25kYXJ5TnVtYmVyTGluZUZhZGVBbmltYXRpb24uc3RhcnQoKTtcclxuICAgICAgICBzZWNvbmRhcnlOdW1iZXJMaW5lRmFkZUFuaW1hdGlvbi5lbmRlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuXHJcbiAgICAgICAgICAvLyBJZiB0aGUgbnVtYmVyIGxpbmUgaGFzIGp1c3QgZmFkZWQgaW4sIG1ha2UgaXQgcGlja2FibGUuXHJcbiAgICAgICAgICBpZiAoIHNlY29uZGFyeU51bWJlckxpbmVMYXllci5vcGFjaXR5ID09PSAxICkge1xyXG4gICAgICAgICAgICBzZWNvbmRhcnlOdW1iZXJMaW5lTGF5ZXIucGlja2FibGUgPSB0cnVlO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHNlY29uZGFyeU51bWJlckxpbmVGYWRlQW5pbWF0aW9uID0gbnVsbDtcclxuICAgICAgICB9ICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIG51bWJlciBsaW5lIHJhbmdlIHNlbGVjdG9yLlxyXG4gICAgdGhpcy5hZGRDaGlsZCggbmV3IE51bWJlckxpbmVSYW5nZVNlbGVjdG9yKFxyXG4gICAgICBtb2RlbC5wcmltYXJ5TnVtYmVyTGluZS5kaXNwbGF5ZWRSYW5nZVByb3BlcnR5LFxyXG4gICAgICBOTE9HZW5lcmljTW9kZWwuTlVNQkVSX0xJTkVfUkFOR0VTLFxyXG4gICAgICB0aGlzLFxyXG4gICAgICB7XHJcbiAgICAgICAgbGVmdDogc2luZ2xlRHVhbE51bWJlckxpbmVTZWxlY3Rvci5sZWZ0LFxyXG4gICAgICAgIGJvdHRvbTogc2luZ2xlRHVhbE51bWJlckxpbmVTZWxlY3Rvci50b3AgLSAxMlxyXG4gICAgICB9XHJcbiAgICApICk7XHJcblxyXG4gICAgLy8gS2VlcCB0aGUgc2VsZWN0ZWQgcmFuZ2Ugb2YgdGhlIHNlY29uZGFyeSBudW1iZXIgbGluZSBpbiBzeW5jIHdpdGggdGhhdCBvZiB0aGUgcHJpbWFyeS4gIE5vIHVubGluayBpcyBuZWVkZWQuXHJcbiAgICBtb2RlbC5wcmltYXJ5TnVtYmVyTGluZS5kaXNwbGF5ZWRSYW5nZVByb3BlcnR5LmxpbmsoIGRpc3BsYXllZFJhbmdlID0+IHtcclxuICAgICAgbW9kZWwuc2Vjb25kYXJ5TnVtYmVyTGluZS5kaXNwbGF5ZWRSYW5nZVByb3BlcnR5LnNldCggZGlzcGxheWVkUmFuZ2UgKTtcclxuICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbnRlcmFjdGl2ZU51bWJlckxpbmVWaWV3IGlzIGFuIGlubmVyIGNsYXNzIHRvIGNyZWF0ZXMgYW5kIHBvc2l0aW9ucyB0aGUgdmFyaW91cyB2aWV3IGVsZW1lbnRzIHVzZWQgdG8gcmVwcmVzZW50IGFuZFxyXG4gKiBpbnRlcmFjdCB3aXRoIGEgbnVtYmVyIGxpbmUuICBJdCBleGlzdHMgcHJpbWFyaWx5IHRvIGF2b2lkIGNvZGUgZHVwbGljYXRpb24uXHJcbiAqL1xyXG5jbGFzcyBJbnRlcmFjdGl2ZU51bWJlckxpbmVWaWV3IGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZCB0aGUgdmFyaW91cyB2aWV3IGVsZW1lbnRzIGZvciB0aGUgcHJvdmlkZWQgbnVtYmVyIGxpbmUuICBUaGlzIG1ldGhvZCBleGlzdHMgcHJpbWFyaWx5IHRvIG1pbmltaXplIGNvZGVcclxuICAgKiBkdXBsaWNhdGlvbi5cclxuICAgKiBAcGFyYW0ge09wZXJhdGlvblRyYWNraW5nTnVtYmVyTGluZX0gbnVtYmVyTGluZVxyXG4gICAqIEBwYXJhbSB7UG9pbnRDb250cm9sbGVyfSBpbml0aWFsVmFsdWVQb2ludENvbnRyb2xsZXJcclxuICAgKiBAcGFyYW0ge09ic2VydmFibGVBcnJheURlZi48UG9pbnRDb250cm9sbGVyPn0gcG9pbnRDb250cm9sbGVyT2JzZXJ2YWJsZUFycmF5XHJcbiAgICogQHBhcmFtIHtCb3VuZHMyfSBsYXlvdXRCb3VuZHMgLSB0aGUgYm91bmRzIGludG8gd2hpY2ggdGhpcyBtdXN0IGJlIGxhaWQgb3V0XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAtIFRoZXNlIG9wdGlvbnMgYXJlIHNwZWNpZmljIHRvIHRoaXMgY2xhc3MgYW5kIGl0cyBjb21wb25lbnRzLCBhbmQgdGhleSBhcmUgbm90XHJcbiAgICogcHJvcGFnYXRlZCB0byB0aGUgc3VwZXJjbGFzcy5cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbnVtYmVyTGluZSwgaW5pdGlhbFZhbHVlUG9pbnRDb250cm9sbGVyLCBwb2ludENvbnRyb2xsZXJPYnNlcnZhYmxlQXJyYXksIGxheW91dEJvdW5kcywgb3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuXHJcbiAgICAgIG51bWVyaWNhbEV4cHJlc3Npb25BY2NvcmRpb25Cb3hPcHRpb25zOiB7XHJcbiAgICAgICAgdGl0bGVOb2RlOiBuZXcgVGV4dCggTnVtYmVyTGluZU9wZXJhdGlvbnNTdHJpbmdzLm51bWVyaWNhbEV4cHJlc3Npb24sIHtcclxuICAgICAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTggKSxcclxuICAgICAgICAgIG1heFdpZHRoOiAyNTBcclxuICAgICAgICB9ICksXHJcbiAgICAgICAgY2VudGVyWDogbGF5b3V0Qm91bmRzLmNlbnRlclhcclxuICAgICAgfSxcclxuICAgICAgb3BlcmF0aW9uRW50cnlDYXJvdXNlbE9wdGlvbnM6IHtcclxuICAgICAgICBlbnRyeUNvbnRyb2wxT3B0aW9uczoge1xyXG4gICAgICAgICAgaW5jcmVtZW50OiAxXHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnRyeUNvbnRyb2wyT3B0aW9uczoge1xyXG4gICAgICAgICAgaW5jcmVtZW50OiAxXHJcbiAgICAgICAgfSxcclxuICAgICAgICByaWdodDogbGF5b3V0Qm91bmRzLm1heFggLSBOTE9Db25zdGFudHMuT1BFUkFUSU9OX0VOVFJZX0NBUk9VU0VMX0xFRlRfSU5TRVRcclxuICAgICAgfVxyXG5cclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIC8vIGxheWVyIHdoZXJlIHRoZSBwb2ludCBjb250cm9sbGVycyBnbyBzbyB0aGF0IHRoZXkgc3RheSBiZWhpbmQgdGhlIHBvaW50c1xyXG4gICAgY29uc3QgcG9pbnRDb250cm9sbGVyTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggcG9pbnRDb250cm9sbGVyTGF5ZXIgKTtcclxuXHJcbiAgICAvLyBub2RlIHRoYXQgcmVwcmVzZW50cyB0aGUgbnVtYmVyIGxpbmUgaXRzZWxmXHJcbiAgICBjb25zdCBudW1iZXJMaW5lTm9kZSA9IG5ldyBDb250cm9sbGFibGVPcGVyYXRpb25OdW1iZXJMaW5lTm9kZShcclxuICAgICAgbnVtYmVyTGluZSxcclxuICAgICAgaW5pdGlhbFZhbHVlUG9pbnRDb250cm9sbGVyLFxyXG4gICAgICBwb2ludENvbnRyb2xsZXJPYnNlcnZhYmxlQXJyYXksXHJcbiAgICAgIGxheW91dEJvdW5kcyxcclxuICAgICAge1xyXG4gICAgICAgIG51bWJlckxpbmVOb2RlT3B0aW9uczoge1xyXG4gICAgICAgICAgbnVtYmVyTGluZU9wZXJhdGlvbk5vZGVPcHRpb25zOiB7XHJcbiAgICAgICAgICAgIG9wZXJhdGlvbkxhYmVsRm9udDogbmV3IFBoZXRGb250KCAyMiApXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbnVtYmVyTGluZU5vZGUgKTtcclxuXHJcbiAgICAvLyBhY2NvcmRpb24gYm94IGNvbnRhaW5pbmcgYSBtYXRoZW1hdGljYWwgZGVzY3JpcHRpb24gb2YgdGhlIG9wZXJhdGlvbnMgb24gdGhlIG51bWJlciBsaW5lXHJcbiAgICB0aGlzLm51bWVyaWNhbEV4cHJlc3Npb25BY2NvcmRpb25Cb3ggPSBuZXcgTnVtZXJpY2FsRXhwcmVzc2lvbkFjY29yZGlvbkJveChcclxuICAgICAgbnVtYmVyTGluZSxcclxuICAgICAgb3B0aW9ucy5udW1lcmljYWxFeHByZXNzaW9uQWNjb3JkaW9uQm94T3B0aW9uc1xyXG4gICAgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMubnVtZXJpY2FsRXhwcmVzc2lvbkFjY29yZGlvbkJveCApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIC0gY2Fyb3VzZWwgaW4gd2hpY2ggdGhlIG9wZXJhdGlvbiBlbnRyeSBjb250cm9scyByZXNpZGVcclxuICAgIHRoaXMub3BlcmF0aW9uRW50cnlDYXJvdXNlbCA9IG5ldyBPcGVyYXRpb25FbnRyeUNhcm91c2VsKCBudW1iZXJMaW5lLCBvcHRpb25zLm9wZXJhdGlvbkVudHJ5Q2Fyb3VzZWxPcHRpb25zICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLm9wZXJhdGlvbkVudHJ5Q2Fyb3VzZWwgKTtcclxuXHJcbiAgICAvLyBlcmFzZSBidXR0b25cclxuICAgIGNvbnN0IGVyYXNlckJ1dHRvbiA9IG5ldyBFcmFzZXJCdXR0b24oIHtcclxuICAgICAgaWNvbldpZHRoOiBOTE9Db25zdGFudHMuRVJBU0VSX0JVVFRPTl9JQ09OX1dJRFRILFxyXG4gICAgICByaWdodDogbGF5b3V0Qm91bmRzLm1heFggLSBOTE9Db25zdGFudHMuRVJBU0VSX0JVVFRPTl9JTlNFVCxcclxuICAgICAgdG91Y2hBcmVhWERpbGF0aW9uOiA4LFxyXG4gICAgICB0b3VjaEFyZWFZRGlsYXRpb246IDgsXHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgbnVtYmVyTGluZU5vZGUuaW50ZXJydXB0U3VidHJlZUlucHV0KCk7XHJcbiAgICAgICAgbnVtYmVyTGluZS5kZWFjdGl2YXRlQWxsT3BlcmF0aW9ucygpO1xyXG4gICAgICAgIHRoaXMub3BlcmF0aW9uRW50cnlDYXJvdXNlbC5yZXNldCgpO1xyXG5cclxuICAgICAgICAvLyBCeSBkZXNpZ24sIHRoZSBvcGVyYXRpb25zIGFyZSBzZXQgdG8gaGF2ZSB2YWx1ZXMgb2YgemVybyByYXRoZXIgdGhhbiB0aGVpciBkZWZhdWx0IHZhbHVlcyB3aGVuIHRoZSBlcmFzZXJcclxuICAgICAgICAvLyBidXR0b24gaXMgdXNlZC5cclxuICAgICAgICBudW1iZXJMaW5lLm9wZXJhdGlvbnMuZm9yRWFjaCggb3BlcmF0aW9uID0+IG9wZXJhdGlvbi5hbW91bnRQcm9wZXJ0eS5zZXQoIDAgKSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBlcmFzZXJCdXR0b24gKTtcclxuXHJcbiAgICAvLyBFcmFzZSBpcyBkaXNhYmxlZCBpZiB0aGVyZSBhcmUgbm8gb3BlcmF0aW9ucy4gIE5vIHVubGluayBpcyBuZWNlc3NhcnkuXHJcbiAgICBudW1iZXJMaW5lLm9wZXJhdGlvbnMuZm9yRWFjaCggb3BlcmF0aW9uID0+IHtcclxuICAgICAgb3BlcmF0aW9uLmlzQWN0aXZlUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICAgIGVyYXNlckJ1dHRvbi5lbmFibGVkID0gbnVtYmVyTGluZS5nZXRBY3RpdmVPcGVyYXRpb25zKCkubGVuZ3RoID4gMDtcclxuICAgICAgfSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFJlcG9zaXRpb24gdGhlIGVyYXNlciBidXR0b24gaWYgdGhlIG51bWJlciBsaW5lIG1vdmVzLiAgTm8gdW5saW5rIGlzIG5lY2Vzc2FyeS5cclxuICAgIG51bWJlckxpbmUuY2VudGVyUG9zaXRpb25Qcm9wZXJ0eS5saW5rKCBwb3NpdGlvbiA9PiB7XHJcbiAgICAgIGVyYXNlckJ1dHRvbi5jZW50ZXJZID0gcG9zaXRpb24ueTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBNb25pdG9yIHRoZSBwb2ludHMgb24gdGhlIG51bWJlciBsaW5lIGFuZCBtYWtlIHN1cmUgdGhhdCB0aGUgb3BlcmF0aW9uIGJlaW5nIG1hbmlwdWxhdGVkIGlzIHRoZSBvbmUgYmVpbmcgc2hvd25cclxuICAgIC8vIGluIHRoZSBjb3JyZXNwb25kaW5nIG9wZXJhdGlvbiBlbnRyeSBjYXJvdXNlbC5cclxuICAgIG51bWJlckxpbmUucmVzaWRlbnRQb2ludHMuYWRkSXRlbUFkZGVkTGlzdGVuZXIoIGFkZGVkUG9pbnQgPT4ge1xyXG5cclxuICAgICAgLy8gSG9vayB1cCBhIGxpc3RlbmVyIHRvIHRoZSBuZXcgcG9pbnQgdGhhdCB3aWxsIG1ha2Ugc3VyZSB0aGF0IHRoZSBvcGVyYXRpb24gZW50cnkgY2Fyb3VzZWwgaXMgc2hvd2luZyB0aGVcclxuICAgICAgLy8gb3BlcmF0aW9uIHRoYXQgaXMgYmVpbmcgbWFuaXB1bGF0ZWQuXHJcbiAgICAgIGNvbnN0IHBvaW50SXNEcmFnZ2luZ0xpc3RlbmVyID0gaXNEcmFnZ2luZyA9PiB7XHJcbiAgICAgICAgaWYgKCBpc0RyYWdnaW5nICkge1xyXG4gICAgICAgICAgdGhpcy5vcGVyYXRpb25FbnRyeUNhcm91c2VsLnNob3dPcGVyYXRpb25XaXRoRW5kcG9pbnQoIGFkZGVkUG9pbnQgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIGFkZGVkUG9pbnQuaXNEcmFnZ2luZ1Byb3BlcnR5LmxhenlMaW5rKCBwb2ludElzRHJhZ2dpbmdMaXN0ZW5lciApO1xyXG5cclxuICAgICAgLy8gTGlzdGVuIGZvciB3aGVuIHRoaXMgcG9pbnQgaXMgcmVtb3ZlZCBhbmQgdW5ob29rIHRoZSBsaXN0ZW5lciB3aGVuIGl0IGlzLlxyXG4gICAgICBudW1iZXJMaW5lLnJlc2lkZW50UG9pbnRzLmFkZEl0ZW1SZW1vdmVkTGlzdGVuZXIoIGZ1bmN0aW9uIHBvaW50UmVtb3ZlZExpc3RlbmVyKCByZW1vdmVkUG9pbnQgKSB7XHJcbiAgICAgICAgaWYgKCByZW1vdmVkUG9pbnQgPT09IGFkZGVkUG9pbnQgKSB7XHJcbiAgICAgICAgICByZW1vdmVkUG9pbnQuaXNEcmFnZ2luZ1Byb3BlcnR5LnVubGluayggcG9pbnRJc0RyYWdnaW5nTGlzdGVuZXIgKTtcclxuICAgICAgICAgIG51bWJlckxpbmUucmVzaWRlbnRQb2ludHMucmVtb3ZlSXRlbVJlbW92ZWRMaXN0ZW5lciggcG9pbnRSZW1vdmVkTGlzdGVuZXIgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICByZXNldCgpIHtcclxuICAgIHRoaXMub3BlcmF0aW9uRW50cnlDYXJvdXNlbC5yZXNldCgpO1xyXG4gICAgdGhpcy5udW1lcmljYWxFeHByZXNzaW9uQWNjb3JkaW9uQm94LnJlc2V0KCk7XHJcbiAgfVxyXG59XHJcblxyXG5udW1iZXJMaW5lT3BlcmF0aW9ucy5yZWdpc3RlciggJ05MT0dlbmVyaWNTY3JlZW5WaWV3JywgTkxPR2VuZXJpY1NjcmVlblZpZXcgKTtcclxuZXhwb3J0IGRlZmF1bHQgTkxPR2VuZXJpY1NjcmVlblZpZXc7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFVBQVUsTUFBTSxvQ0FBb0M7QUFDM0QsT0FBT0MsWUFBWSxNQUFNLDBEQUEwRDtBQUNuRixPQUFPQyxVQUFVLE1BQU0sNkRBQTZEO0FBQ3BGLE9BQU9DLGVBQWUsTUFBTSxrRUFBa0U7QUFDOUYsT0FBT0MsdUJBQXVCLE1BQU0sMEVBQTBFO0FBQzlHLE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsWUFBWSxNQUFNLHFEQUFxRDtBQUM5RSxPQUFPQyxjQUFjLE1BQU0sdURBQXVEO0FBQ2xGLE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsU0FBU0MsS0FBSyxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDckUsT0FBT0MsU0FBUyxNQUFNLG1DQUFtQztBQUN6RCxPQUFPQyxNQUFNLE1BQU0sZ0NBQWdDO0FBQ25ELE9BQU9DLFlBQVksTUFBTSw4QkFBOEI7QUFDdkQsT0FBT0MsbUNBQW1DLE1BQU0sMERBQTBEO0FBQzFHLE9BQU9DLHNCQUFzQixNQUFNLDZDQUE2QztBQUNoRixPQUFPQyxvQkFBb0IsTUFBTSwrQkFBK0I7QUFDaEUsT0FBT0MsMkJBQTJCLE1BQU0sc0NBQXNDO0FBQzlFLE9BQU9DLCtCQUErQixNQUFNLDBEQUEwRDtBQUN0RyxPQUFPQyxlQUFlLE1BQU0sNkJBQTZCO0FBQ3pELE9BQU9DLDRCQUE0QixNQUFNLG1DQUFtQzs7QUFFNUU7QUFDQSxNQUFNQyxvQ0FBb0MsR0FBRyxJQUFJYixLQUFLLENBQUUsUUFBUyxDQUFDO0FBQ2xFLE1BQU1jLGlDQUFpQyxHQUFHO0VBQ3hDQyxjQUFjLEVBQUU7QUFDbEIsQ0FBQztBQUVELE1BQU1DLG9CQUFvQixTQUFTekIsVUFBVSxDQUFDO0VBRTVDO0FBQ0Y7QUFDQTtBQUNBO0VBQ0UwQixXQUFXQSxDQUFFQyxLQUFLLEVBQUVDLE1BQU0sRUFBRztJQUUzQixLQUFLLENBQUU7TUFDTEEsTUFBTSxFQUFFQTtJQUNWLENBQUUsQ0FBQzs7SUFFSDtJQUNBLE1BQU1DLFVBQVUsR0FBRyxDQUNqQixJQUFJM0IsVUFBVSxDQUFFeUIsS0FBSyxDQUFDRyxpQkFBaUIsQ0FBQ0MsMkJBQTJCLEVBQUViLDJCQUEyQixDQUFDYyxlQUFnQixDQUFDLEVBQ2xILElBQUk5QixVQUFVLENBQUV5QixLQUFLLENBQUNHLGlCQUFpQixDQUFDRyx1QkFBdUIsRUFBRWYsMkJBQTJCLENBQUNnQixXQUFZLENBQUMsRUFDMUcsSUFBSWhDLFVBQVUsQ0FBRXlCLEtBQUssQ0FBQ0csaUJBQWlCLENBQUNLLHFCQUFxQixFQUFFakIsMkJBQTJCLENBQUNrQixTQUFVLENBQUMsQ0FDdkc7SUFDRCxNQUFNQyxhQUFhLEdBQUcsSUFBSWxDLGVBQWUsQ0FBRTBCLFVBQVcsQ0FBQztJQUN2RCxJQUFJLENBQUNTLFFBQVEsQ0FBRUQsYUFBYyxDQUFDOztJQUU5QjtJQUNBLE1BQU1FLHFCQUFxQixHQUFHLElBQUlDLHlCQUF5QixDQUN6RGIsS0FBSyxDQUFDRyxpQkFBaUIsRUFDdkJILEtBQUssQ0FBQ2Msc0NBQXNDLEVBQzVDZCxLQUFLLENBQUNlLGlDQUFpQyxFQUN2QyxJQUFJLENBQUNDLFlBQVksRUFDakI7TUFDRUMsc0NBQXNDLEVBQUU7UUFDdENDLEdBQUcsRUFBRSxJQUFJLENBQUNGLFlBQVksQ0FBQ0csSUFBSSxHQUFHN0MsWUFBWSxDQUFDOEM7TUFDN0MsQ0FBQztNQUNEQyw2QkFBNkIsRUFBRTtRQUM3QkgsR0FBRyxFQUFFLElBQUksQ0FBQ0YsWUFBWSxDQUFDRyxJQUFJLEdBQUc3QyxZQUFZLENBQUM4QztNQUM3QztJQUNGLENBQ0YsQ0FBQztJQUNELElBQUksQ0FBQ1QsUUFBUSxDQUFFQyxxQkFBc0IsQ0FBQzs7SUFFdEM7SUFDQSxNQUFNVSx3QkFBd0IsR0FBRyxJQUFJdkMsSUFBSSxDQUFFO01BQ3pDd0MsT0FBTyxFQUFFLEtBQUs7TUFDZEMsT0FBTyxFQUFFO0lBQ1gsQ0FBRSxDQUFDO0lBQ0gsSUFBSSxDQUFDYixRQUFRLENBQUVXLHdCQUF5QixDQUFDOztJQUV6QztJQUNBLE1BQU1HLHVCQUF1QixHQUFHLElBQUlaLHlCQUF5QixDQUMzRGIsS0FBSyxDQUFDMEIsbUJBQW1CLEVBQ3pCMUIsS0FBSyxDQUFDMkIsd0NBQXdDLEVBQzlDM0IsS0FBSyxDQUFDNEIsbUNBQW1DLEVBQ3pDLElBQUksQ0FBQ1osWUFBWSxFQUNqQjtNQUNFQyxzQ0FBc0MsRUFBRTtRQUN0Q1ksTUFBTSxFQUFFLElBQUksQ0FBQ2IsWUFBWSxDQUFDYyxJQUFJLEdBQUd4RCxZQUFZLENBQUM4QztNQUNoRCxDQUFDO01BQ0RDLDZCQUE2QixFQUFFO1FBQzdCUSxNQUFNLEVBQUUsSUFBSSxDQUFDYixZQUFZLENBQUNjLElBQUksR0FBR3hELFlBQVksQ0FBQzhDLG9CQUFvQjtRQUNsRVcsVUFBVSxFQUFFcEMsb0NBQW9DO1FBQ2hEcUMsb0JBQW9CLEVBQUVwQyxpQ0FBaUM7UUFDdkRxQyxvQkFBb0IsRUFBRXJDLGlDQUFpQztRQUN2RHNDLG1CQUFtQixFQUFFN0Msc0JBQXNCLENBQUM4QyxtQkFBbUIsQ0FBQ0M7TUFDbEU7SUFDRixDQUNGLENBQUM7SUFDRGQsd0JBQXdCLENBQUNYLFFBQVEsQ0FBRWMsdUJBQXdCLENBQUM7O0lBRTVEO0lBQ0EsTUFBTVksY0FBYyxHQUFHLElBQUl6RCxjQUFjLENBQUU7TUFDekMwRCxRQUFRLEVBQUVBLENBQUEsS0FBTTtRQUNkLElBQUksQ0FBQ0MscUJBQXFCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIzQixxQkFBcUIsQ0FBQzRCLEtBQUssQ0FBQyxDQUFDO1FBQzdCZix1QkFBdUIsQ0FBQ2UsS0FBSyxDQUFDLENBQUM7UUFDL0J4QyxLQUFLLENBQUN3QyxLQUFLLENBQUMsQ0FBQztNQUNmLENBQUM7TUFDREMsS0FBSyxFQUFFLElBQUksQ0FBQ3pCLFlBQVksQ0FBQzBCLElBQUksR0FBR3BFLFlBQVksQ0FBQ3FFLG9CQUFvQjtNQUNqRWQsTUFBTSxFQUFFLElBQUksQ0FBQ2IsWUFBWSxDQUFDYyxJQUFJLEdBQUd4RCxZQUFZLENBQUM4QyxvQkFBb0I7TUFDbEVuQixNQUFNLEVBQUVBLE1BQU0sQ0FBQzJDLFlBQVksQ0FBRSxnQkFBaUI7SUFDaEQsQ0FBRSxDQUFDO0lBQ0gsSUFBSSxDQUFDakMsUUFBUSxDQUFFMEIsY0FBZSxDQUFDOztJQUUvQjtJQUNBLE1BQU1RLDRCQUE0QixHQUFHLElBQUluRCw0QkFBNEIsQ0FBRU0sS0FBSyxDQUFDOEMsK0JBQStCLEVBQUU7TUFDNUdDLElBQUksRUFBRXJDLGFBQWEsQ0FBQ3FDLElBQUk7TUFDeEJsQixNQUFNLEVBQUVRLGNBQWMsQ0FBQ1c7SUFDekIsQ0FBRSxDQUFDO0lBQ0gsSUFBSSxDQUFDckMsUUFBUSxDQUFFa0MsNEJBQTZCLENBQUM7O0lBRTdDO0lBQ0E7SUFDQSxJQUFJSSxnQ0FBZ0MsR0FBRyxJQUFJO0lBQzNDakQsS0FBSyxDQUFDOEMsK0JBQStCLENBQUNJLFFBQVEsQ0FBRUMsU0FBUyxJQUFJO01BQzNELE1BQU1DLGFBQWEsR0FBR0QsU0FBUyxHQUFHLENBQUMsR0FBRyxDQUFDO01BQ3ZDLElBQUs3Qix3QkFBd0IsQ0FBQ0UsT0FBTyxLQUFLNEIsYUFBYSxFQUFHO1FBRXhEO1FBQ0EsSUFBS0gsZ0NBQWdDLEVBQUc7VUFDdENBLGdDQUFnQyxDQUFDSSxJQUFJLENBQUMsQ0FBQztRQUN6QztRQUVBSixnQ0FBZ0MsR0FBRyxJQUFJaEUsU0FBUyxDQUFFO1VBQ2hEcUUsUUFBUSxFQUFFLEdBQUc7VUFDYkMsSUFBSSxFQUFFakMsd0JBQXdCLENBQUNFLE9BQU87VUFDdENnQyxFQUFFLEVBQUVKLGFBQWE7VUFDakJLLE1BQU0sRUFBRXZFLE1BQU0sQ0FBQ3dFLFlBQVk7VUFDM0JDLFFBQVEsRUFBRUMsZUFBZSxJQUFJO1lBRTNCO1lBQ0E7WUFDQSxJQUFLdEMsd0JBQXdCLENBQUNFLE9BQU8sS0FBSyxDQUFDLElBQUlvQyxlQUFlLEdBQUcsQ0FBQyxFQUFHO2NBQ25FdEMsd0JBQXdCLENBQUNpQixxQkFBcUIsQ0FBQyxDQUFDO2NBQ2hEakIsd0JBQXdCLENBQUN1QyxRQUFRLEdBQUcsS0FBSztZQUMzQzs7WUFFQTtZQUNBdkMsd0JBQXdCLENBQUNFLE9BQU8sR0FBR29DLGVBQWU7O1lBRWxEO1lBQ0EsSUFBS0EsZUFBZSxHQUFHLENBQUMsSUFBSSxDQUFDdEMsd0JBQXdCLENBQUNDLE9BQU8sRUFBRztjQUM5REQsd0JBQXdCLENBQUNDLE9BQU8sR0FBRyxJQUFJO1lBQ3pDLENBQUMsTUFDSSxJQUFLcUMsZUFBZSxLQUFLLENBQUMsSUFBSXRDLHdCQUF3QixDQUFDQyxPQUFPLEVBQUc7Y0FDcEVELHdCQUF3QixDQUFDQyxPQUFPLEdBQUcsS0FBSztZQUMxQztVQUNGO1FBQ0YsQ0FBRSxDQUFDO1FBQ0gwQixnQ0FBZ0MsQ0FBQ2EsS0FBSyxDQUFDLENBQUM7UUFDeENiLGdDQUFnQyxDQUFDYyxZQUFZLENBQUNDLFdBQVcsQ0FBRSxNQUFNO1VBRS9EO1VBQ0EsSUFBSzFDLHdCQUF3QixDQUFDRSxPQUFPLEtBQUssQ0FBQyxFQUFHO1lBQzVDRix3QkFBd0IsQ0FBQ3VDLFFBQVEsR0FBRyxJQUFJO1VBQzFDO1VBRUFaLGdDQUFnQyxHQUFHLElBQUk7UUFDekMsQ0FBRSxDQUFDO01BQ0w7SUFDRixDQUFFLENBQUM7O0lBRUg7SUFDQSxJQUFJLENBQUN0QyxRQUFRLENBQUUsSUFBSWxDLHVCQUF1QixDQUN4Q3VCLEtBQUssQ0FBQ0csaUJBQWlCLENBQUM4RCxzQkFBc0IsRUFDOUN4RSxlQUFlLENBQUN5RSxrQkFBa0IsRUFDbEMsSUFBSSxFQUNKO01BQ0VuQixJQUFJLEVBQUVGLDRCQUE0QixDQUFDRSxJQUFJO01BQ3ZDbEIsTUFBTSxFQUFFZ0IsNEJBQTRCLENBQUMzQixHQUFHLEdBQUc7SUFDN0MsQ0FDRixDQUFFLENBQUM7O0lBRUg7SUFDQWxCLEtBQUssQ0FBQ0csaUJBQWlCLENBQUM4RCxzQkFBc0IsQ0FBQ0UsSUFBSSxDQUFFQyxjQUFjLElBQUk7TUFDckVwRSxLQUFLLENBQUMwQixtQkFBbUIsQ0FBQ3VDLHNCQUFzQixDQUFDSSxHQUFHLENBQUVELGNBQWUsQ0FBQztJQUN4RSxDQUFFLENBQUM7RUFDTDtBQUNGOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTXZELHlCQUF5QixTQUFTOUIsSUFBSSxDQUFDO0VBRTNDO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VnQixXQUFXQSxDQUFFdUUsVUFBVSxFQUFFQywyQkFBMkIsRUFBRUMsOEJBQThCLEVBQUV4RCxZQUFZLEVBQUV5RCxPQUFPLEVBQUc7SUFFNUdBLE9BQU8sR0FBRy9GLEtBQUssQ0FBRTtNQUVmdUMsc0NBQXNDLEVBQUU7UUFDdEN5RCxTQUFTLEVBQUUsSUFBSTFGLElBQUksQ0FBRU8sMkJBQTJCLENBQUNvRixtQkFBbUIsRUFBRTtVQUNwRUMsSUFBSSxFQUFFLElBQUkvRixRQUFRLENBQUUsRUFBRyxDQUFDO1VBQ3hCZ0csUUFBUSxFQUFFO1FBQ1osQ0FBRSxDQUFDO1FBQ0hDLE9BQU8sRUFBRTlELFlBQVksQ0FBQzhEO01BQ3hCLENBQUM7TUFDRHpELDZCQUE2QixFQUFFO1FBQzdCVyxvQkFBb0IsRUFBRTtVQUNwQitDLFNBQVMsRUFBRTtRQUNiLENBQUM7UUFDRDlDLG9CQUFvQixFQUFFO1VBQ3BCOEMsU0FBUyxFQUFFO1FBQ2IsQ0FBQztRQUNEdEMsS0FBSyxFQUFFekIsWUFBWSxDQUFDMEIsSUFBSSxHQUFHdkQsWUFBWSxDQUFDNkY7TUFDMUM7SUFFRixDQUFDLEVBQUVQLE9BQVEsQ0FBQztJQUVaLEtBQUssQ0FBQyxDQUFDOztJQUVQO0lBQ0EsTUFBTVEsb0JBQW9CLEdBQUcsSUFBSWxHLElBQUksQ0FBQyxDQUFDO0lBQ3ZDLElBQUksQ0FBQzRCLFFBQVEsQ0FBRXNFLG9CQUFxQixDQUFDOztJQUVyQztJQUNBLE1BQU1DLGNBQWMsR0FBRyxJQUFJOUYsbUNBQW1DLENBQzVEa0YsVUFBVSxFQUNWQywyQkFBMkIsRUFDM0JDLDhCQUE4QixFQUM5QnhELFlBQVksRUFDWjtNQUNFbUUscUJBQXFCLEVBQUU7UUFDckJDLDhCQUE4QixFQUFFO1VBQzlCQyxrQkFBa0IsRUFBRSxJQUFJeEcsUUFBUSxDQUFFLEVBQUc7UUFDdkM7TUFDRjtJQUNGLENBQ0YsQ0FBQztJQUNELElBQUksQ0FBQzhCLFFBQVEsQ0FBRXVFLGNBQWUsQ0FBQzs7SUFFL0I7SUFDQSxJQUFJLENBQUNJLCtCQUErQixHQUFHLElBQUk5RiwrQkFBK0IsQ0FDeEU4RSxVQUFVLEVBQ1ZHLE9BQU8sQ0FBQ3hELHNDQUNWLENBQUM7SUFDRCxJQUFJLENBQUNOLFFBQVEsQ0FBRSxJQUFJLENBQUMyRSwrQkFBZ0MsQ0FBQzs7SUFFckQ7SUFDQSxJQUFJLENBQUNDLHNCQUFzQixHQUFHLElBQUlsRyxzQkFBc0IsQ0FBRWlGLFVBQVUsRUFBRUcsT0FBTyxDQUFDcEQsNkJBQThCLENBQUM7SUFDN0csSUFBSSxDQUFDVixRQUFRLENBQUUsSUFBSSxDQUFDNEUsc0JBQXVCLENBQUM7O0lBRTVDO0lBQ0EsTUFBTUMsWUFBWSxHQUFHLElBQUk3RyxZQUFZLENBQUU7TUFDckM4RyxTQUFTLEVBQUV0RyxZQUFZLENBQUN1Ryx3QkFBd0I7TUFDaERqRCxLQUFLLEVBQUV6QixZQUFZLENBQUMwQixJQUFJLEdBQUd2RCxZQUFZLENBQUN3RyxtQkFBbUI7TUFDM0RDLGtCQUFrQixFQUFFLENBQUM7TUFDckJDLGtCQUFrQixFQUFFLENBQUM7TUFDckJ2RCxRQUFRLEVBQUVBLENBQUEsS0FBTTtRQUNkNEMsY0FBYyxDQUFDM0MscUJBQXFCLENBQUMsQ0FBQztRQUN0QytCLFVBQVUsQ0FBQ3dCLHVCQUF1QixDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDUCxzQkFBc0IsQ0FBQy9DLEtBQUssQ0FBQyxDQUFDOztRQUVuQztRQUNBO1FBQ0E4QixVQUFVLENBQUN5QixVQUFVLENBQUNDLE9BQU8sQ0FBRUMsU0FBUyxJQUFJQSxTQUFTLENBQUNDLGNBQWMsQ0FBQzdCLEdBQUcsQ0FBRSxDQUFFLENBQUUsQ0FBQztNQUNqRjtJQUNGLENBQUUsQ0FBQztJQUNILElBQUksQ0FBQzFELFFBQVEsQ0FBRTZFLFlBQWEsQ0FBQzs7SUFFN0I7SUFDQWxCLFVBQVUsQ0FBQ3lCLFVBQVUsQ0FBQ0MsT0FBTyxDQUFFQyxTQUFTLElBQUk7TUFDMUNBLFNBQVMsQ0FBQ0UsZ0JBQWdCLENBQUNoQyxJQUFJLENBQUUsTUFBTTtRQUNyQ3FCLFlBQVksQ0FBQ1ksT0FBTyxHQUFHOUIsVUFBVSxDQUFDK0IsbUJBQW1CLENBQUMsQ0FBQyxDQUFDQyxNQUFNLEdBQUcsQ0FBQztNQUNwRSxDQUFFLENBQUM7SUFDTCxDQUFFLENBQUM7O0lBRUg7SUFDQWhDLFVBQVUsQ0FBQ2lDLHNCQUFzQixDQUFDcEMsSUFBSSxDQUFFcUMsUUFBUSxJQUFJO01BQ2xEaEIsWUFBWSxDQUFDeEMsT0FBTyxHQUFHd0QsUUFBUSxDQUFDQyxDQUFDO0lBQ25DLENBQUUsQ0FBQzs7SUFFSDtJQUNBO0lBQ0FuQyxVQUFVLENBQUNvQyxjQUFjLENBQUNDLG9CQUFvQixDQUFFQyxVQUFVLElBQUk7TUFFNUQ7TUFDQTtNQUNBLE1BQU1DLHVCQUF1QixHQUFHQyxVQUFVLElBQUk7UUFDNUMsSUFBS0EsVUFBVSxFQUFHO1VBQ2hCLElBQUksQ0FBQ3ZCLHNCQUFzQixDQUFDd0IseUJBQXlCLENBQUVILFVBQVcsQ0FBQztRQUNyRTtNQUNGLENBQUM7TUFDREEsVUFBVSxDQUFDSSxrQkFBa0IsQ0FBQzlELFFBQVEsQ0FBRTJELHVCQUF3QixDQUFDOztNQUVqRTtNQUNBdkMsVUFBVSxDQUFDb0MsY0FBYyxDQUFDTyxzQkFBc0IsQ0FBRSxTQUFTQyxvQkFBb0JBLENBQUVDLFlBQVksRUFBRztRQUM5RixJQUFLQSxZQUFZLEtBQUtQLFVBQVUsRUFBRztVQUNqQ08sWUFBWSxDQUFDSCxrQkFBa0IsQ0FBQ0ksTUFBTSxDQUFFUCx1QkFBd0IsQ0FBQztVQUNqRXZDLFVBQVUsQ0FBQ29DLGNBQWMsQ0FBQ1cseUJBQXlCLENBQUVILG9CQUFxQixDQUFDO1FBQzdFO01BQ0YsQ0FBRSxDQUFDO0lBQ0wsQ0FBRSxDQUFDO0VBQ0w7O0VBRUE7QUFDRjtBQUNBO0VBQ0UxRSxLQUFLQSxDQUFBLEVBQUc7SUFDTixJQUFJLENBQUMrQyxzQkFBc0IsQ0FBQy9DLEtBQUssQ0FBQyxDQUFDO0lBQ25DLElBQUksQ0FBQzhDLCtCQUErQixDQUFDOUMsS0FBSyxDQUFDLENBQUM7RUFDOUM7QUFDRjtBQUVBbEQsb0JBQW9CLENBQUNnSSxRQUFRLENBQUUsc0JBQXNCLEVBQUV4SCxvQkFBcUIsQ0FBQztBQUM3RSxlQUFlQSxvQkFBb0IifQ==