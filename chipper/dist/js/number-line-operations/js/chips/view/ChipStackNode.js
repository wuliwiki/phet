// Copyright 2020-2022, University of Colorado Boulder

/**
 * ChipStackNode is the view representation of a ValueItem that is intended to look like a stack of game (e.g. poker)
 * chips, with the size of the stack being dependent upon the value of the item being represented.
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import Property from '../../../../axon/js/Property.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Circle, Color, DragListener, LinearGradient, Node, Path, Text } from '../../../../scenery/js/imports.js';
import numberLineOperations from '../../numberLineOperations.js';

// constants
const CHIP_RADIUS = 23;
const STACKING_STAGGER_AMOUNT = new Vector2(-2, 2);
const SHADOW_OFFSET = new Vector2(5, 5);
const DRAG_OFFSET = new Vector2(0, -CHIP_RADIUS * 0.75);
class ChipStackNode extends Node {
  /**
   * @param {ValueItem} valueItem
   */
  constructor(valueItem) {
    assert && assert(valueItem.value >= -5 && valueItem.value <= 5 && valueItem.value !== 0, `cannot represent item with value ${valueItem.value}`);
    const chipFill = valueItem.value > 0 ? Color.YELLOW : Color.RED;
    const nextChipCenter = STACKING_STAGGER_AMOUNT.timesScalar(Math.abs(valueItem.value) - 1);

    // Add the layer where the chips will reside.
    const chipsLayer = new Node();

    // Create a shape that will be used to create the shadow.
    let shadowShape = null;

    // Create the chips and their shadows and add them to their respective layers.
    let topChip = null;
    _.times(Math.abs(valueItem.value), () => {
      const chip = new Circle(CHIP_RADIUS, {
        fill: chipFill,
        stroke: Color.BLACK,
        center: nextChipCenter
      });
      chipsLayer.addChild(chip);
      topChip = chip;

      // Add the next portions of the shadow shape.
      if (shadowShape) {
        shadowShape = shadowShape.shapeUnion(Shape.circle(nextChipCenter.x, nextChipCenter.y, CHIP_RADIUS));
      } else {
        shadowShape = Shape.circle(nextChipCenter.x, nextChipCenter.y, CHIP_RADIUS);
      }

      // Adjust the position where the next chip will go.
      nextChipCenter.subtract(STACKING_STAGGER_AMOUNT);
    });

    // Add the label to the top chip on the stack.
    const signChar = valueItem.value > 0 ? '+' : '';
    const labelNode = new Text(signChar + valueItem.value, {
      font: new PhetFont(22),
      center: Vector2.ZERO
    });
    topChip.addChild(labelNode);

    // Create the shadow from the shape.
    const vectorToShadowEdge = SHADOW_OFFSET.copy().setMagnitude(CHIP_RADIUS);
    const shadowNode = new Path(shadowShape, {
      fill: new LinearGradient(shadowShape.bounds.centerX, shadowShape.bounds.centerY, vectorToShadowEdge.x, vectorToShadowEdge.y).addColorStop(0.5, new Color(20, 20, 20, 0.4)).addColorStop(1, new Color(80, 80, 80, 0.2))
    });
    super({
      children: [shadowNode, chipsLayer],
      cursor: 'pointer'
    });

    // Move the shadow into position and make it visible when this item is being dragged.  No unlink is needed.
    valueItem.isDraggingProperty.link(isDragging => {
      shadowNode.visible = isDragging;
      if (isDragging) {
        shadowNode.translation = SHADOW_OFFSET;
      } else {
        shadowNode.translation = Vector2.ZERO;
      }
    });

    // Prevent this node from being grabbed when animating, unlink not necessary.
    valueItem.inProgressAnimationProperty.link(inProgressAnimation => {
      this.pickable = inProgressAnimation === null;
    });

    // drag handler
    this.addInputListener(new DragListener({
      dragBoundsProperty: new Property(this.layoutBounds),
      start: event => {
        valueItem.isDraggingProperty.value = true;
        valueItem.teleportTo(this.eventToPosition(event));
        this.moveToFront(); // move to the front of the z-order in whatever layer this node is in
      },

      drag: event => {
        valueItem.teleportTo(this.eventToPosition(event));
      },
      end: () => {
        valueItem.isDraggingProperty.value = false;
      }
    }));

    // Position this node based on the model element position.  Note that there is no model-view transform, since we are
    // using the same coordinate system in both the model and view.  No unlink is needed.
    valueItem.positionProperty.link(position => {
      this.center = position;
    });
  }

  /**
   * Convert a drag event to a position in model space.
   * @param {SceneryEvent} event
   * @returns {Vector2}
   * @private
   */
  eventToPosition(event) {
    // pointer position in parent coordinates
    const parentPoint = this.globalToParentPoint(event.pointer.point);
    return parentPoint.plus(DRAG_OFFSET);
  }
}
numberLineOperations.register('ChipStackNode', ChipStackNode);
export default ChipStackNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIlZlY3RvcjIiLCJTaGFwZSIsIlBoZXRGb250IiwiQ2lyY2xlIiwiQ29sb3IiLCJEcmFnTGlzdGVuZXIiLCJMaW5lYXJHcmFkaWVudCIsIk5vZGUiLCJQYXRoIiwiVGV4dCIsIm51bWJlckxpbmVPcGVyYXRpb25zIiwiQ0hJUF9SQURJVVMiLCJTVEFDS0lOR19TVEFHR0VSX0FNT1VOVCIsIlNIQURPV19PRkZTRVQiLCJEUkFHX09GRlNFVCIsIkNoaXBTdGFja05vZGUiLCJjb25zdHJ1Y3RvciIsInZhbHVlSXRlbSIsImFzc2VydCIsInZhbHVlIiwiY2hpcEZpbGwiLCJZRUxMT1ciLCJSRUQiLCJuZXh0Q2hpcENlbnRlciIsInRpbWVzU2NhbGFyIiwiTWF0aCIsImFicyIsImNoaXBzTGF5ZXIiLCJzaGFkb3dTaGFwZSIsInRvcENoaXAiLCJfIiwidGltZXMiLCJjaGlwIiwiZmlsbCIsInN0cm9rZSIsIkJMQUNLIiwiY2VudGVyIiwiYWRkQ2hpbGQiLCJzaGFwZVVuaW9uIiwiY2lyY2xlIiwieCIsInkiLCJzdWJ0cmFjdCIsInNpZ25DaGFyIiwibGFiZWxOb2RlIiwiZm9udCIsIlpFUk8iLCJ2ZWN0b3JUb1NoYWRvd0VkZ2UiLCJjb3B5Iiwic2V0TWFnbml0dWRlIiwic2hhZG93Tm9kZSIsImJvdW5kcyIsImNlbnRlclgiLCJjZW50ZXJZIiwiYWRkQ29sb3JTdG9wIiwiY2hpbGRyZW4iLCJjdXJzb3IiLCJpc0RyYWdnaW5nUHJvcGVydHkiLCJsaW5rIiwiaXNEcmFnZ2luZyIsInZpc2libGUiLCJ0cmFuc2xhdGlvbiIsImluUHJvZ3Jlc3NBbmltYXRpb25Qcm9wZXJ0eSIsImluUHJvZ3Jlc3NBbmltYXRpb24iLCJwaWNrYWJsZSIsImFkZElucHV0TGlzdGVuZXIiLCJkcmFnQm91bmRzUHJvcGVydHkiLCJsYXlvdXRCb3VuZHMiLCJzdGFydCIsImV2ZW50IiwidGVsZXBvcnRUbyIsImV2ZW50VG9Qb3NpdGlvbiIsIm1vdmVUb0Zyb250IiwiZHJhZyIsImVuZCIsInBvc2l0aW9uUHJvcGVydHkiLCJwb3NpdGlvbiIsInBhcmVudFBvaW50IiwiZ2xvYmFsVG9QYXJlbnRQb2ludCIsInBvaW50ZXIiLCJwb2ludCIsInBsdXMiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNoaXBTdGFja05vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjAtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQ2hpcFN0YWNrTm9kZSBpcyB0aGUgdmlldyByZXByZXNlbnRhdGlvbiBvZiBhIFZhbHVlSXRlbSB0aGF0IGlzIGludGVuZGVkIHRvIGxvb2sgbGlrZSBhIHN0YWNrIG9mIGdhbWUgKGUuZy4gcG9rZXIpXHJcbiAqIGNoaXBzLCB3aXRoIHRoZSBzaXplIG9mIHRoZSBzdGFjayBiZWluZyBkZXBlbmRlbnQgdXBvbiB0aGUgdmFsdWUgb2YgdGhlIGl0ZW0gYmVpbmcgcmVwcmVzZW50ZWQuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IENpcmNsZSwgQ29sb3IsIERyYWdMaXN0ZW5lciwgTGluZWFyR3JhZGllbnQsIE5vZGUsIFBhdGgsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbnVtYmVyTGluZU9wZXJhdGlvbnMgZnJvbSAnLi4vLi4vbnVtYmVyTGluZU9wZXJhdGlvbnMuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IENISVBfUkFESVVTID0gMjM7XHJcbmNvbnN0IFNUQUNLSU5HX1NUQUdHRVJfQU1PVU5UID0gbmV3IFZlY3RvcjIoIC0yLCAyICk7XHJcbmNvbnN0IFNIQURPV19PRkZTRVQgPSBuZXcgVmVjdG9yMiggNSwgNSApO1xyXG5jb25zdCBEUkFHX09GRlNFVCA9IG5ldyBWZWN0b3IyKCAwLCAtQ0hJUF9SQURJVVMgKiAwLjc1ICk7XHJcblxyXG5jbGFzcyBDaGlwU3RhY2tOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7VmFsdWVJdGVtfSB2YWx1ZUl0ZW1cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggdmFsdWVJdGVtICkge1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoXHJcbiAgICB2YWx1ZUl0ZW0udmFsdWUgPj0gLTUgJiYgdmFsdWVJdGVtLnZhbHVlIDw9IDUgJiYgdmFsdWVJdGVtLnZhbHVlICE9PSAwLFxyXG4gICAgICBgY2Fubm90IHJlcHJlc2VudCBpdGVtIHdpdGggdmFsdWUgJHt2YWx1ZUl0ZW0udmFsdWV9YFxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBjaGlwRmlsbCA9IHZhbHVlSXRlbS52YWx1ZSA+IDAgPyBDb2xvci5ZRUxMT1cgOiBDb2xvci5SRUQ7XHJcbiAgICBjb25zdCBuZXh0Q2hpcENlbnRlciA9IFNUQUNLSU5HX1NUQUdHRVJfQU1PVU5ULnRpbWVzU2NhbGFyKCBNYXRoLmFicyggdmFsdWVJdGVtLnZhbHVlICkgLSAxICk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBsYXllciB3aGVyZSB0aGUgY2hpcHMgd2lsbCByZXNpZGUuXHJcbiAgICBjb25zdCBjaGlwc0xheWVyID0gbmV3IE5vZGUoKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSBzaGFwZSB0aGF0IHdpbGwgYmUgdXNlZCB0byBjcmVhdGUgdGhlIHNoYWRvdy5cclxuICAgIGxldCBzaGFkb3dTaGFwZSA9IG51bGw7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBjaGlwcyBhbmQgdGhlaXIgc2hhZG93cyBhbmQgYWRkIHRoZW0gdG8gdGhlaXIgcmVzcGVjdGl2ZSBsYXllcnMuXHJcbiAgICBsZXQgdG9wQ2hpcCA9IG51bGw7XHJcbiAgICBfLnRpbWVzKCBNYXRoLmFicyggdmFsdWVJdGVtLnZhbHVlICksICgpID0+IHtcclxuICAgICAgY29uc3QgY2hpcCA9IG5ldyBDaXJjbGUoIENISVBfUkFESVVTLCB7XHJcbiAgICAgICAgZmlsbDogY2hpcEZpbGwsXHJcbiAgICAgICAgc3Ryb2tlOiBDb2xvci5CTEFDSyxcclxuICAgICAgICBjZW50ZXI6IG5leHRDaGlwQ2VudGVyXHJcbiAgICAgIH0gKTtcclxuICAgICAgY2hpcHNMYXllci5hZGRDaGlsZCggY2hpcCApO1xyXG4gICAgICB0b3BDaGlwID0gY2hpcDtcclxuXHJcbiAgICAgIC8vIEFkZCB0aGUgbmV4dCBwb3J0aW9ucyBvZiB0aGUgc2hhZG93IHNoYXBlLlxyXG4gICAgICBpZiAoIHNoYWRvd1NoYXBlICkge1xyXG4gICAgICAgIHNoYWRvd1NoYXBlID0gc2hhZG93U2hhcGUuc2hhcGVVbmlvbiggU2hhcGUuY2lyY2xlKCBuZXh0Q2hpcENlbnRlci54LCBuZXh0Q2hpcENlbnRlci55LCBDSElQX1JBRElVUyApICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgc2hhZG93U2hhcGUgPSBTaGFwZS5jaXJjbGUoIG5leHRDaGlwQ2VudGVyLngsIG5leHRDaGlwQ2VudGVyLnksIENISVBfUkFESVVTICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEFkanVzdCB0aGUgcG9zaXRpb24gd2hlcmUgdGhlIG5leHQgY2hpcCB3aWxsIGdvLlxyXG4gICAgICBuZXh0Q2hpcENlbnRlci5zdWJ0cmFjdCggU1RBQ0tJTkdfU1RBR0dFUl9BTU9VTlQgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGxhYmVsIHRvIHRoZSB0b3AgY2hpcCBvbiB0aGUgc3RhY2suXHJcbiAgICBjb25zdCBzaWduQ2hhciA9IHZhbHVlSXRlbS52YWx1ZSA+IDAgPyAnKycgOiAnJztcclxuICAgIGNvbnN0IGxhYmVsTm9kZSA9IG5ldyBUZXh0KFxyXG4gICAgICBzaWduQ2hhciArIHZhbHVlSXRlbS52YWx1ZSxcclxuICAgICAge1xyXG4gICAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMjIgKSxcclxuICAgICAgICBjZW50ZXI6IFZlY3RvcjIuWkVST1xyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgdG9wQ2hpcC5hZGRDaGlsZCggbGFiZWxOb2RlICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBzaGFkb3cgZnJvbSB0aGUgc2hhcGUuXHJcbiAgICBjb25zdCB2ZWN0b3JUb1NoYWRvd0VkZ2UgPSBTSEFET1dfT0ZGU0VULmNvcHkoKS5zZXRNYWduaXR1ZGUoIENISVBfUkFESVVTICk7XHJcbiAgICBjb25zdCBzaGFkb3dOb2RlID0gbmV3IFBhdGgoIHNoYWRvd1NoYXBlLCB7XHJcbiAgICAgIGZpbGw6IG5ldyBMaW5lYXJHcmFkaWVudCggc2hhZG93U2hhcGUuYm91bmRzLmNlbnRlclgsIHNoYWRvd1NoYXBlLmJvdW5kcy5jZW50ZXJZLCB2ZWN0b3JUb1NoYWRvd0VkZ2UueCwgdmVjdG9yVG9TaGFkb3dFZGdlLnkgKVxyXG4gICAgICAgIC5hZGRDb2xvclN0b3AoIDAuNSwgbmV3IENvbG9yKCAyMCwgMjAsIDIwLCAwLjQgKSApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggMSwgbmV3IENvbG9yKCA4MCwgODAsIDgwLCAwLjIgKSApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgc3VwZXIoIHtcclxuICAgICAgY2hpbGRyZW46IFsgc2hhZG93Tm9kZSwgY2hpcHNMYXllciBdLFxyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIE1vdmUgdGhlIHNoYWRvdyBpbnRvIHBvc2l0aW9uIGFuZCBtYWtlIGl0IHZpc2libGUgd2hlbiB0aGlzIGl0ZW0gaXMgYmVpbmcgZHJhZ2dlZC4gIE5vIHVubGluayBpcyBuZWVkZWQuXHJcbiAgICB2YWx1ZUl0ZW0uaXNEcmFnZ2luZ1Byb3BlcnR5LmxpbmsoIGlzRHJhZ2dpbmcgPT4ge1xyXG4gICAgICBzaGFkb3dOb2RlLnZpc2libGUgPSBpc0RyYWdnaW5nO1xyXG4gICAgICBpZiAoIGlzRHJhZ2dpbmcgKSB7XHJcbiAgICAgICAgc2hhZG93Tm9kZS50cmFuc2xhdGlvbiA9IFNIQURPV19PRkZTRVQ7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgc2hhZG93Tm9kZS50cmFuc2xhdGlvbiA9IFZlY3RvcjIuWkVSTztcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFByZXZlbnQgdGhpcyBub2RlIGZyb20gYmVpbmcgZ3JhYmJlZCB3aGVuIGFuaW1hdGluZywgdW5saW5rIG5vdCBuZWNlc3NhcnkuXHJcbiAgICB2YWx1ZUl0ZW0uaW5Qcm9ncmVzc0FuaW1hdGlvblByb3BlcnR5LmxpbmsoIGluUHJvZ3Jlc3NBbmltYXRpb24gPT4ge1xyXG4gICAgICB0aGlzLnBpY2thYmxlID0gaW5Qcm9ncmVzc0FuaW1hdGlvbiA9PT0gbnVsbDtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBkcmFnIGhhbmRsZXJcclxuICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggbmV3IERyYWdMaXN0ZW5lcigge1xyXG5cclxuICAgICAgZHJhZ0JvdW5kc1Byb3BlcnR5OiBuZXcgUHJvcGVydHkoIHRoaXMubGF5b3V0Qm91bmRzICksXHJcblxyXG4gICAgICBzdGFydDogZXZlbnQgPT4ge1xyXG4gICAgICAgIHZhbHVlSXRlbS5pc0RyYWdnaW5nUHJvcGVydHkudmFsdWUgPSB0cnVlO1xyXG4gICAgICAgIHZhbHVlSXRlbS50ZWxlcG9ydFRvKCB0aGlzLmV2ZW50VG9Qb3NpdGlvbiggZXZlbnQgKSApO1xyXG4gICAgICAgIHRoaXMubW92ZVRvRnJvbnQoKTsgLy8gbW92ZSB0byB0aGUgZnJvbnQgb2YgdGhlIHotb3JkZXIgaW4gd2hhdGV2ZXIgbGF5ZXIgdGhpcyBub2RlIGlzIGluXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBkcmFnOiBldmVudCA9PiB7XHJcbiAgICAgICAgdmFsdWVJdGVtLnRlbGVwb3J0VG8oIHRoaXMuZXZlbnRUb1Bvc2l0aW9uKCBldmVudCApICk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBlbmQ6ICgpID0+IHtcclxuICAgICAgICB2YWx1ZUl0ZW0uaXNEcmFnZ2luZ1Byb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0gKSApO1xyXG5cclxuICAgIC8vIFBvc2l0aW9uIHRoaXMgbm9kZSBiYXNlZCBvbiB0aGUgbW9kZWwgZWxlbWVudCBwb3NpdGlvbi4gIE5vdGUgdGhhdCB0aGVyZSBpcyBubyBtb2RlbC12aWV3IHRyYW5zZm9ybSwgc2luY2Ugd2UgYXJlXHJcbiAgICAvLyB1c2luZyB0aGUgc2FtZSBjb29yZGluYXRlIHN5c3RlbSBpbiBib3RoIHRoZSBtb2RlbCBhbmQgdmlldy4gIE5vIHVubGluayBpcyBuZWVkZWQuXHJcbiAgICB2YWx1ZUl0ZW0ucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCBwb3NpdGlvbiA9PiB7XHJcbiAgICAgIHRoaXMuY2VudGVyID0gcG9zaXRpb247XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb252ZXJ0IGEgZHJhZyBldmVudCB0byBhIHBvc2l0aW9uIGluIG1vZGVsIHNwYWNlLlxyXG4gICAqIEBwYXJhbSB7U2NlbmVyeUV2ZW50fSBldmVudFxyXG4gICAqIEByZXR1cm5zIHtWZWN0b3IyfVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZXZlbnRUb1Bvc2l0aW9uKCBldmVudCApIHtcclxuXHJcbiAgICAvLyBwb2ludGVyIHBvc2l0aW9uIGluIHBhcmVudCBjb29yZGluYXRlc1xyXG4gICAgY29uc3QgcGFyZW50UG9pbnQgPSB0aGlzLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKTtcclxuXHJcbiAgICByZXR1cm4gcGFyZW50UG9pbnQucGx1cyggRFJBR19PRkZTRVQgKTtcclxuICB9XHJcbn1cclxuXHJcbm51bWJlckxpbmVPcGVyYXRpb25zLnJlZ2lzdGVyKCAnQ2hpcFN0YWNrTm9kZScsIENoaXBTdGFja05vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgQ2hpcFN0YWNrTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxRQUFRLE1BQU0saUNBQWlDO0FBQ3RELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsU0FBU0MsS0FBSyxRQUFRLGdDQUFnQztBQUN0RCxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLE1BQU0sRUFBRUMsS0FBSyxFQUFFQyxZQUFZLEVBQUVDLGNBQWMsRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDakgsT0FBT0Msb0JBQW9CLE1BQU0sK0JBQStCOztBQUVoRTtBQUNBLE1BQU1DLFdBQVcsR0FBRyxFQUFFO0FBQ3RCLE1BQU1DLHVCQUF1QixHQUFHLElBQUlaLE9BQU8sQ0FBRSxDQUFDLENBQUMsRUFBRSxDQUFFLENBQUM7QUFDcEQsTUFBTWEsYUFBYSxHQUFHLElBQUliLE9BQU8sQ0FBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDO0FBQ3pDLE1BQU1jLFdBQVcsR0FBRyxJQUFJZCxPQUFPLENBQUUsQ0FBQyxFQUFFLENBQUNXLFdBQVcsR0FBRyxJQUFLLENBQUM7QUFFekQsTUFBTUksYUFBYSxTQUFTUixJQUFJLENBQUM7RUFFL0I7QUFDRjtBQUNBO0VBQ0VTLFdBQVdBLENBQUVDLFNBQVMsRUFBRztJQUV2QkMsTUFBTSxJQUFJQSxNQUFNLENBQ2hCRCxTQUFT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