// Copyright 2015-2023, University of Colorado Boulder

/**
 * Displays a Property of type {number} in a background rectangle.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../axon/js/DerivedProperty.js';
import TinyProperty from '../../axon/js/TinyProperty.js';
import Utils from '../../dot/js/Utils.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import StringUtils from '../../phetcommon/js/util/StringUtils.js';
import { Node, Rectangle, RichText, Text, ManualConstraint } from '../../scenery/js/imports.js';
import SunConstants from '../../sun/js/SunConstants.js';
import Tandem from '../../tandem/js/Tandem.js';
import IOType from '../../tandem/js/types/IOType.js';
import StringIO from '../../tandem/js/types/StringIO.js';
import MathSymbols from './MathSymbols.js';
import PhetFont from './PhetFont.js';
import sceneryPhet from './sceneryPhet.js';

// constants
const DEFAULT_FONT = new PhetFont(20);

// valid values for options.align and options.noValueAlign
const ALIGN_VALUES = ['center', 'left', 'right'];
const DEFAULT_DECIMAL_PLACES = 0;
export default class NumberDisplay extends Node {
  // called by dispose
  /**
   * @param numberProperty
   * @param displayRange - this range, with options.decimals or numberFormatter applied, is used to determine
   *                     - the display width. It is unrelated to the range of numberProperty.
   * @param providedOptions
   */
  constructor(numberProperty, displayRange, providedOptions) {
    const options = optionize()({
      align: 'right',
      valuePattern: SunConstants.VALUE_NAMED_PLACEHOLDER,
      decimalPlaces: DEFAULT_DECIMAL_PLACES,
      numberFormatter: null,
      useRichText: false,
      useFullHeight: false,
      textOptions: {
        font: DEFAULT_FONT,
        fill: 'black',
        maxWidth: null,
        // {number|null} if null, then it will be computed based on displayRange
        phetioReadOnly: true
      },
      xMargin: 8,
      yMargin: 2,
      cornerRadius: 0,
      backgroundFill: 'white',
      backgroundStroke: 'lightGray',
      backgroundLineWidth: 1,
      backgroundLineDash: [],
      minBackgroundWidth: 0,
      noValueString: MathSymbols.NO_VALUE,
      noValueAlign: null,
      noValuePattern: null,
      // phet-io
      tandem: Tandem.OPTIONAL,
      phetioType: NumberDisplay.NumberDisplayIO
    }, providedOptions);

    // valuePattern|decimalPlaces is mutually exclusive with numberFormatter
    if (assert) {
      const numberFormatterProvided = !!options.numberFormatter;
      const decimalPlacesProvided = options.decimalPlaces !== DEFAULT_DECIMAL_PLACES;
      const valuePatternProvided = options.valuePattern !== SunConstants.VALUE_NAMED_PLACEHOLDER;
      const decimalOrValueProvided = decimalPlacesProvided || valuePatternProvided;
      if (numberFormatterProvided || decimalOrValueProvided) {
        assert && assert(numberFormatterProvided !== decimalOrValueProvided, 'options.numberFormatter is mutually exclusive with options.valuePattern and options.decimalPlaces');
      }
    }
    const numberFormatterProperty = new TinyProperty(options.numberFormatter ? options.numberFormatter : value => {
      if (options.decimalPlaces === null) {
        return `${value}`;
      } else {
        return Utils.toFixed(value, options.decimalPlaces);
      }
    });
    assert && assert(!options.hasOwnProperty('unitsNode'), 'unitsNode is not a supported option');

    // Set default alignments and validate
    assert && assert(_.includes(ALIGN_VALUES, options.align), `invalid align: ${options.align}`);
    if (!options.noValueAlign) {
      options.noValueAlign = options.align;
    }
    assert && assert(_.includes(ALIGN_VALUES, options.noValueAlign), `invalid noValueAlign: ${options.noValueAlign}`);
    assert && assert(options.textOptions, 'did you accidentally set textOptions to null?');

    // Support numbered (old-style) placeholder by replacing it with the corresponding named placeholder.
    // See https://github.com/phetsims/scenery-phet/issues/446
    const replaceValuePatternValue = valuePattern => {
      if (valuePattern.includes(SunConstants.VALUE_NUMBERED_PLACEHOLDER)) {
        return StringUtils.format(valuePattern, SunConstants.VALUE_NAMED_PLACEHOLDER);
      } else {
        return valuePattern;
      }
    };
    const valuePatternProperty = typeof options.valuePattern === 'string' ? new TinyProperty(replaceValuePatternValue(options.valuePattern)) : new DerivedProperty([options.valuePattern], replaceValuePatternValue);
    assert && assert(!!phet.chipper.queryParameters.stringTest || valuePatternProperty.value.includes(SunConstants.VALUE_NAMED_PLACEHOLDER), `missing value placeholder in options.valuePattern: ${valuePatternProperty.value}`);

    // Set default and validate
    if (!options.noValuePattern) {
      // So we don't have duplicated Properties in our DerivedProperty (it's not supported by that)
      options.noValuePattern = new DerivedProperty([valuePatternProperty], x => x);
    }
    const noValuePatternProperty = typeof options.noValuePattern === 'string' ? new TinyProperty(options.noValuePattern) : options.noValuePattern;
    assert && assert(!!phet.chipper.queryParameters.stringTest || noValuePatternProperty.value.includes(SunConstants.VALUE_NAMED_PLACEHOLDER), `missing value placeholder in options.noValuePattern: ${noValuePatternProperty.value}`);

    // determine the widest value
    const minStringProperty = new DerivedProperty([numberFormatterProperty], numberFormatter => {
      return valueToString(displayRange.min, options.noValueString, numberFormatter);
    });
    const maxStringProperty = new DerivedProperty([numberFormatterProperty], numberFormatter => {
      return valueToString(displayRange.max, options.noValueString, numberFormatter);
    });
    const longestStringProperty = new DerivedProperty([valuePatternProperty, minStringProperty, maxStringProperty], (valuePattern, minString, maxString) => {
      return StringUtils.fillIn(valuePattern, {
        value: minString.length > maxString.length ? minString : maxString
      });
    });

    // value
    const Constructor = options.useRichText ? RichText : Text;
    const valueTextTandem = options.tandem.createTandem('valueText');
    const valueStringProperty = new DerivedProperty([numberProperty, noValuePatternProperty, valuePatternProperty, numberFormatterProperty], (value, noValuePattern, valuePatternValue, numberFormatter) => {
      const valuePattern = value === null && noValuePattern ? noValuePattern : valuePatternValue;
      // NOTE: this.numberFormatter could change, so we support a recomputeText() below that recomputes this derivation
      const stringValue = valueToString(value, options.noValueString, numberFormatter);
      return StringUtils.fillIn(valuePattern, {
        value: stringValue
      });
    }, {
      tandem: valueTextTandem.createTandem(Text.STRING_PROPERTY_TANDEM_NAME),
      phetioValueType: StringIO
    });
    const valueTextOptions = combineOptions({}, options.textOptions, {
      maxWidth: null // we are handling maxWidth manually, so we don't want to provide it initially.
    });

    const valueText = new Constructor(valueStringProperty, combineOptions({
      tandem: valueTextTandem
    }, valueTextOptions));
    const originalTextHeight = valueText.height;

    // background rectangle
    const backgroundNode = new Rectangle({
      cornerRadius: options.cornerRadius,
      fill: options.backgroundFill,
      stroke: options.backgroundStroke,
      lineWidth: options.backgroundLineWidth,
      lineDash: options.backgroundLineDash
    });

    // Manually set maxWidth later, adjusting it to the width of the longest string if it's null
    longestStringProperty.link(longestString => {
      const demoText = new Constructor(longestString, _.omit(valueTextOptions, 'tandem'));
      valueText.maxWidth = options.textOptions.maxWidth !== null ? options.textOptions.maxWidth : demoText.width !== 0 ? demoText.width : null;
      demoText.maxWidth = valueText.maxWidth;
      backgroundNode.rectWidth = Math.max(options.minBackgroundWidth, demoText.width + 2 * options.xMargin);
      backgroundNode.rectHeight = (options.useFullHeight ? originalTextHeight : demoText.height) + 2 * options.yMargin;
    });
    options.children = [backgroundNode, valueText];
    super();
    this.numberFormatterProperty = numberFormatterProperty;
    this.valueText = valueText;
    this.backgroundNode = backgroundNode;

    // Align the value in the background.
    ManualConstraint.create(this, [valueText, backgroundNode], (valueTextProxy, backgroundNodeProxy) => {
      // Alignment depends on whether we have a non-null value.
      const align = numberProperty.value === null ? options.noValueAlign : options.align;

      // horizontal alignment
      if (align === 'center') {
        valueTextProxy.centerX = backgroundNodeProxy.centerX;
      } else if (align === 'left') {
        valueTextProxy.left = backgroundNodeProxy.left + options.xMargin;
      } else {
        // right
        valueTextProxy.right = backgroundNodeProxy.right - options.xMargin;
      }

      // vertical alignment
      valueTextProxy.centerY = backgroundNodeProxy.centerY;
    });
    this.mutate(options);
    this.disposeNumberDisplay = () => {
      valueStringProperty.dispose();
      valuePatternProperty.dispose();
    };
  }
  setNumberFormatter(numberFormatter) {
    this.numberFormatterProperty.value = numberFormatter;
  }

  // Redraw the text when something other than the numberProperty changes (such as units, formatter, etc).
  // @deprecated
  recomputeText() {
    // no-op, not needed now
  }
  dispose() {
    this.disposeNumberDisplay();
    super.dispose();
  }

  /**
   * Sets the number text font.
   */
  setNumberFont(font) {
    this.valueText.font = font;
  }
  set numberFont(value) {
    this.setNumberFont(value);
  }

  /**
   * Sets the number text fill.
   */
  setNumberFill(fill) {
    this.valueText.fill = fill;
  }
  set numberFill(value) {
    this.setNumberFill(value);
  }

  /**
   * Sets the background fill.
   */
  setBackgroundFill(fill) {
    this.backgroundNode.fill = fill;
  }
  set backgroundFill(value) {
    this.setBackgroundFill(value);
  }
  get backgroundFill() {
    return this.getBackgroundFill();
  }

  /**
   * Gets the background fill.
   */
  getBackgroundFill() {
    return this.backgroundNode.fill;
  }

  /**
   * Sets the background stroke.
   */
  setBackgroundStroke(stroke) {
    this.backgroundNode.stroke = stroke;
  }
  set backgroundStroke(value) {
    this.setBackgroundStroke(value);
  }

  /**
   * Get the width of the background.
   */
  getBackgroundWidth() {
    return this.backgroundNode.getRectWidth();
  }

  /**
   * Set the width of the background node.
   */
  setBackgroundWidth(width) {
    this.backgroundNode.setRectWidth(width);
  }
  get backgroundWidth() {
    return this.getBackgroundWidth();
  }
  set backgroundWidth(width) {
    this.setBackgroundWidth(width);
  }
  static NumberDisplayIO = new IOType('NumberDisplayIO', {
    valueType: NumberDisplay,
    supertype: Node.NodeIO,
    documentation: 'A numeric readout with a background'
  });
}
sceneryPhet.register('NumberDisplay', NumberDisplay);

/**
 * Converts a numeric value to a string.
 * @param value
 * @param decimalPlaces - if null, use the full value
 * @param noValueString
 * @param numberFormatter - if provided, function that converts {number} => {string}
 */
const valueToString = (value, noValueString, numberFormatter) => {
  let stringValue = noValueString;
  if (value !== null) {
    stringValue = numberFormatter(value);
  }
  return stringValue;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJUaW55UHJvcGVydHkiLCJVdGlscyIsIm9wdGlvbml6ZSIsImNvbWJpbmVPcHRpb25zIiwiU3RyaW5nVXRpbHMiLCJOb2RlIiwiUmVjdGFuZ2xlIiwiUmljaFRleHQiLCJUZXh0IiwiTWFudWFsQ29uc3RyYWludCIsIlN1bkNvbnN0YW50cyIsIlRhbmRlbSIsIklPVHlwZSIsIlN0cmluZ0lPIiwiTWF0aFN5bWJvbHMiLCJQaGV0Rm9udCIsInNjZW5lcnlQaGV0IiwiREVGQVVMVF9GT05UIiwiQUxJR05fVkFMVUVTIiwiREVGQVVMVF9ERUNJTUFMX1BMQUNFUyIsIk51bWJlckRpc3BsYXkiLCJjb25zdHJ1Y3RvciIsIm51bWJlclByb3BlcnR5IiwiZGlzcGxheVJhbmdlIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImFsaWduIiwidmFsdWVQYXR0ZXJuIiwiVkFMVUVfTkFNRURfUExBQ0VIT0xERVIiLCJkZWNpbWFsUGxhY2VzIiwibnVtYmVyRm9ybWF0dGVyIiwidXNlUmljaFRleHQiLCJ1c2VGdWxsSGVpZ2h0IiwidGV4dE9wdGlvbnMiLCJmb250IiwiZmlsbCIsIm1heFdpZHRoIiwicGhldGlvUmVhZE9ubHkiLCJ4TWFyZ2luIiwieU1hcmdpbiIsImNvcm5lclJhZGl1cyIsImJhY2tncm91bmRGaWxsIiwiYmFja2dyb3VuZFN0cm9rZSIsImJhY2tncm91bmRMaW5lV2lkdGgiLCJiYWNrZ3JvdW5kTGluZURhc2giLCJtaW5CYWNrZ3JvdW5kV2lkdGgiLCJub1ZhbHVlU3RyaW5nIiwiTk9fVkFMVUUiLCJub1ZhbHVlQWxpZ24iLCJub1ZhbHVlUGF0dGVybiIsInRhbmRlbSIsIk9QVElPTkFMIiwicGhldGlvVHlwZSIsIk51bWJlckRpc3BsYXlJTyIsImFzc2VydCIsIm51bWJlckZvcm1hdHRlclByb3ZpZGVkIiwiZGVjaW1hbFBsYWNlc1Byb3ZpZGVkIiwidmFsdWVQYXR0ZXJuUHJvdmlkZWQiLCJkZWNpbWFsT3JWYWx1ZVByb3ZpZGVkIiwibnVtYmVyRm9ybWF0dGVyUHJvcGVydHkiLCJ2YWx1ZSIsInRvRml4ZWQiLCJoYXNPd25Qcm9wZXJ0eSIsIl8iLCJpbmNsdWRlcyIsInJlcGxhY2VWYWx1ZVBhdHRlcm5WYWx1ZSIsIlZBTFVFX05VTUJFUkVEX1BMQUNFSE9MREVSIiwiZm9ybWF0IiwidmFsdWVQYXR0ZXJuUHJvcGVydHkiLCJwaGV0IiwiY2hpcHBlciIsInF1ZXJ5UGFyYW1ldGVycyIsInN0cmluZ1Rlc3QiLCJ4Iiwibm9WYWx1ZVBhdHRlcm5Qcm9wZXJ0eSIsIm1pblN0cmluZ1Byb3BlcnR5IiwidmFsdWVUb1N0cmluZyIsIm1pbiIsIm1heFN0cmluZ1Byb3BlcnR5IiwibWF4IiwibG9uZ2VzdFN0cmluZ1Byb3BlcnR5IiwibWluU3RyaW5nIiwibWF4U3RyaW5nIiwiZmlsbEluIiwibGVuZ3RoIiwiQ29uc3RydWN0b3IiLCJ2YWx1ZVRleHRUYW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJ2YWx1ZVN0cmluZ1Byb3BlcnR5IiwidmFsdWVQYXR0ZXJuVmFsdWUiLCJzdHJpbmdWYWx1ZSIsIlNUUklOR19QUk9QRVJUWV9UQU5ERU1fTkFNRSIsInBoZXRpb1ZhbHVlVHlwZSIsInZhbHVlVGV4dE9wdGlvbnMiLCJ2YWx1ZVRleHQiLCJvcmlnaW5hbFRleHRIZWlnaHQiLCJoZWlnaHQiLCJiYWNrZ3JvdW5kTm9kZSIsInN0cm9rZSIsImxpbmVXaWR0aCIsImxpbmVEYXNoIiwibGluayIsImxvbmdlc3RTdHJpbmciLCJkZW1vVGV4dCIsIm9taXQiLCJ3aWR0aCIsInJlY3RXaWR0aCIsIk1hdGgiLCJyZWN0SGVpZ2h0IiwiY2hpbGRyZW4iLCJjcmVhdGUiLCJ2YWx1ZVRleHRQcm94eSIsImJhY2tncm91bmROb2RlUHJveHkiLCJjZW50ZXJYIiwibGVmdCIsInJpZ2h0IiwiY2VudGVyWSIsIm11dGF0ZSIsImRpc3Bvc2VOdW1iZXJEaXNwbGF5IiwiZGlzcG9zZSIsInNldE51bWJlckZvcm1hdHRlciIsInJlY29tcHV0ZVRleHQiLCJzZXROdW1iZXJGb250IiwibnVtYmVyRm9udCIsInNldE51bWJlckZpbGwiLCJudW1iZXJGaWxsIiwic2V0QmFja2dyb3VuZEZpbGwiLCJnZXRCYWNrZ3JvdW5kRmlsbCIsInNldEJhY2tncm91bmRTdHJva2UiLCJnZXRCYWNrZ3JvdW5kV2lkdGgiLCJnZXRSZWN0V2lkdGgiLCJzZXRCYWNrZ3JvdW5kV2lkdGgiLCJzZXRSZWN0V2lkdGgiLCJiYWNrZ3JvdW5kV2lkdGgiLCJ2YWx1ZVR5cGUiLCJzdXBlcnR5cGUiLCJOb2RlSU8iLCJkb2N1bWVudGF0aW9uIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJOdW1iZXJEaXNwbGF5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIERpc3BsYXlzIGEgUHJvcGVydHkgb2YgdHlwZSB7bnVtYmVyfSBpbiBhIGJhY2tncm91bmQgcmVjdGFuZ2xlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVGlueVByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvVGlueVByb3BlcnR5LmpzJztcclxuaW1wb3J0IFRQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1RQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IFJhbmdlIGZyb20gJy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCB7IEZvbnQsIFRQYWludCwgTm9kZSwgTm9kZU9wdGlvbnMsIFJlY3RhbmdsZSwgUmljaFRleHQsIFJpY2hUZXh0T3B0aW9ucywgVGV4dCwgVGV4dE9wdGlvbnMsIE1hbnVhbENvbnN0cmFpbnQgfSBmcm9tICcuLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgU3VuQ29uc3RhbnRzIGZyb20gJy4uLy4uL3N1bi9qcy9TdW5Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgSU9UeXBlIGZyb20gJy4uLy4uL3RhbmRlbS9qcy90eXBlcy9JT1R5cGUuanMnO1xyXG5pbXBvcnQgU3RyaW5nSU8gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL3R5cGVzL1N0cmluZ0lPLmpzJztcclxuaW1wb3J0IE1hdGhTeW1ib2xzIGZyb20gJy4vTWF0aFN5bWJvbHMuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuL3NjZW5lcnlQaGV0LmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBERUZBVUxUX0ZPTlQgPSBuZXcgUGhldEZvbnQoIDIwICk7XHJcblxyXG4vLyB2YWxpZCB2YWx1ZXMgZm9yIG9wdGlvbnMuYWxpZ24gYW5kIG9wdGlvbnMubm9WYWx1ZUFsaWduXHJcbmNvbnN0IEFMSUdOX1ZBTFVFUyA9IFsgJ2NlbnRlcicsICdsZWZ0JywgJ3JpZ2h0JyBdIGFzIGNvbnN0O1xyXG50eXBlIE51bWJlckRpc3BsYXlBbGlnbiA9IHR5cGVvZiBBTElHTl9WQUxVRVNbbnVtYmVyXTtcclxuXHJcbmNvbnN0IERFRkFVTFRfREVDSU1BTF9QTEFDRVMgPSAwO1xyXG5cclxudHlwZSBOdW1iZXJGb3JtYXR0ZXIgPSAoIG46IG51bWJlciApID0+IHN0cmluZztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcblxyXG4gIGFsaWduPzogTnVtYmVyRGlzcGxheUFsaWduO1xyXG5cclxuICAvLyBQYXR0ZXJuIHVzZWQgdG8gZm9ybWF0IHRoZSB2YWx1ZS5cclxuICAvLyBNdXN0IGNvbnRhaW4gU3VuQ29uc3RhbnRzLlZBTFVFX05BTUVEX1BMQUNFSE9MREVSIG9yIFN1bkNvbnN0YW50cy5WQUxVRV9OVU1CRVJFRF9QTEFDRUhPTERFUi5cclxuICB2YWx1ZVBhdHRlcm4/OiBzdHJpbmcgfCBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+O1xyXG5cclxuICAvLyBUaGUgbnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzIHRvIHNob3cuIElmIG51bGwsIHRoZSBmdWxsIHZhbHVlIGlzIGRpc3BsYXllZC5cclxuICAvLyBXZSBhdHRlbXB0ZWQgdG8gY2hhbmdlIHRoZSBkZWZhdWx0IHRvIG51bGwsIGJ1dCB0aGVyZSB3ZXJlIHRvbyBtYW55IHVzYWdlcyB0aGF0IHJlbGllZCBvbiB0aGUgMCBkZWZhdWx0LlxyXG4gIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS1waGV0L2lzc3Vlcy81MTFcclxuICBkZWNpbWFsUGxhY2VzPzogbnVtYmVyIHwgbnVsbDtcclxuXHJcbiAgLy8gVGFrZXMgYSB7bnVtYmVyfSBhbmQgcmV0dXJucyBhIHtzdHJpbmd9IGZvciBmdWxsIGNvbnRyb2wuIE11dHVhbGx5IGV4Y2x1c2l2ZSB3aXRoIHZhbHVlUGF0dGVybiBhbmRcclxuICAvLyBkZWNpbWFsUGxhY2VzLiAgTmFtZWQgXCJudW1iZXJGb3JtYXR0ZXJcIiBpbnN0ZWFkIG9mIFwiZm9ybWF0dGVyXCIgdG8gaGVscCBjbGFyaWZ5IHRoYXQgaXQgaXMgc2VwYXJhdGUgZnJvbSB0aGVcclxuICAvLyBub1ZhbHVlU3RyaW5nL0FsaWduL1BhdHRlcm4gZGVmaW5lZCBiZWxvdy5cclxuICBudW1iZXJGb3JtYXR0ZXI/OiAoICggbjogbnVtYmVyICkgPT4gc3RyaW5nICkgfCBudWxsO1xyXG5cclxuICB1c2VSaWNoVGV4dD86IGJvb2xlYW47XHJcblxyXG4gIC8vIElmIHNldCB0byB0cnVlLCB0aGUgc21hbGxlciB0ZXh0IGhlaWdodCAoZnJvbSBhcHBseWluZyB0aGUgbWF4V2lkdGgpIHdpbGwgTk9UIGJlIHVzZWQsIGFuZCBpbnN0ZWFkXHJcbiAgLy8gdGhlIGhlaWdodCBvZiB0aGUgdGV4dCAoYXMgaWYgdGhlcmUgd2FzIG5vIG1heFdpZHRoKSB3aWxsIGJlIHVzZWQgZm9yIGxheW91dCBhbmQgdGhlIGJhY2tncm91bmQuXHJcbiAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9kZW5zaXR5L2lzc3Vlcy8zNC5cclxuICB1c2VGdWxsSGVpZ2h0PzogYm9vbGVhbjtcclxuXHJcbiAgLy8gLy8gb3B0aW9ucyBwYXNzZWQgdG8gVGV4dCBvciBSaWNoVGV4dCAoZGVwZW5kaW5nIG9uIHRoZSB2YWx1ZSBvZiBvcHRpb25zLnVzZVJpY2hUZXh0KSB0aGF0IGRpc3BsYXlzIHRoZSB2YWx1ZVxyXG4gIHRleHRPcHRpb25zPzogVGV4dE9wdGlvbnMgfCBSaWNoVGV4dE9wdGlvbnM7XHJcblxyXG4gIHhNYXJnaW4/OiBudW1iZXI7XHJcbiAgeU1hcmdpbj86IG51bWJlcjtcclxuICBjb3JuZXJSYWRpdXM/OiBudW1iZXI7XHJcbiAgYmFja2dyb3VuZEZpbGw/OiBUUGFpbnQ7XHJcbiAgYmFja2dyb3VuZFN0cm9rZT86IFRQYWludDtcclxuICBiYWNrZ3JvdW5kTGluZVdpZHRoPzogbnVtYmVyO1xyXG4gIGJhY2tncm91bmRMaW5lRGFzaD86IG51bWJlcltdO1xyXG4gIG1pbkJhY2tncm91bmRXaWR0aD86IG51bWJlcjtcclxuXHJcbiAgLy8gb3B0aW9ucyByZWxhdGVkIHRvIGRpc3BsYXkgd2hlbiBudW1iZXJQcm9wZXJ0eS52YWx1ZSA9PT0gbnVsbFxyXG4gIG5vVmFsdWVTdHJpbmc/OiBzdHJpbmc7IC8vIGRlZmF1bHQgaXMgdGhlIFBoRVQgc3RhbmRhcmQsIGRvIG5vdCBvdmVycmlkZSBsaWdodGx5LlxyXG4gIG5vVmFsdWVBbGlnbj86IE51bWJlckRpc3BsYXlBbGlnbiB8IG51bGw7IC8vIHNlZSBBTElHTl9WQUxVRVMuIElmIG51bGwsIGRlZmF1bHRzIHRvIG9wdGlvbnMuYWxpZ25cclxuICBub1ZhbHVlUGF0dGVybj86IHN0cmluZyB8IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4gfCBudWxsOyAvLyBJZiBudWxsLCBkZWZhdWx0cyB0byBvcHRpb25zLnZhbHVlUGF0dGVyblxyXG59O1xyXG5leHBvcnQgdHlwZSBOdW1iZXJEaXNwbGF5T3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxOb2RlT3B0aW9ucywgJ2NoaWxkcmVuJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOdW1iZXJEaXNwbGF5IGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgbnVtYmVyRm9ybWF0dGVyUHJvcGVydHk6IFRQcm9wZXJ0eTxOdW1iZXJGb3JtYXR0ZXI+O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdmFsdWVUZXh0OiBSaWNoVGV4dCB8IFRleHQ7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBiYWNrZ3JvdW5kTm9kZTogUmVjdGFuZ2xlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZU51bWJlckRpc3BsYXk6ICgpID0+IHZvaWQ7IC8vIGNhbGxlZCBieSBkaXNwb3NlXHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBudW1iZXJQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSBkaXNwbGF5UmFuZ2UgLSB0aGlzIHJhbmdlLCB3aXRoIG9wdGlvbnMuZGVjaW1hbHMgb3IgbnVtYmVyRm9ybWF0dGVyIGFwcGxpZWQsIGlzIHVzZWQgdG8gZGV0ZXJtaW5lXHJcbiAgICogICAgICAgICAgICAgICAgICAgICAtIHRoZSBkaXNwbGF5IHdpZHRoLiBJdCBpcyB1bnJlbGF0ZWQgdG8gdGhlIHJhbmdlIG9mIG51bWJlclByb3BlcnR5LlxyXG4gICAqIEBwYXJhbSBwcm92aWRlZE9wdGlvbnNcclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG51bWJlclByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXIgfCBudWxsPiwgZGlzcGxheVJhbmdlOiBSYW5nZSwgcHJvdmlkZWRPcHRpb25zPzogTnVtYmVyRGlzcGxheU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxOdW1iZXJEaXNwbGF5T3B0aW9ucywgU2VsZk9wdGlvbnMsIE5vZGVPcHRpb25zPigpKCB7XHJcbiAgICAgIGFsaWduOiAncmlnaHQnLFxyXG4gICAgICB2YWx1ZVBhdHRlcm46IFN1bkNvbnN0YW50cy5WQUxVRV9OQU1FRF9QTEFDRUhPTERFUixcclxuICAgICAgZGVjaW1hbFBsYWNlczogREVGQVVMVF9ERUNJTUFMX1BMQUNFUyxcclxuICAgICAgbnVtYmVyRm9ybWF0dGVyOiBudWxsLFxyXG4gICAgICB1c2VSaWNoVGV4dDogZmFsc2UsXHJcbiAgICAgIHVzZUZ1bGxIZWlnaHQ6IGZhbHNlLFxyXG4gICAgICB0ZXh0T3B0aW9uczoge1xyXG4gICAgICAgIGZvbnQ6IERFRkFVTFRfRk9OVCxcclxuICAgICAgICBmaWxsOiAnYmxhY2snLFxyXG4gICAgICAgIG1heFdpZHRoOiBudWxsLCAvLyB7bnVtYmVyfG51bGx9IGlmIG51bGwsIHRoZW4gaXQgd2lsbCBiZSBjb21wdXRlZCBiYXNlZCBvbiBkaXNwbGF5UmFuZ2VcclxuICAgICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZVxyXG4gICAgICB9LFxyXG5cclxuICAgICAgeE1hcmdpbjogOCxcclxuICAgICAgeU1hcmdpbjogMixcclxuICAgICAgY29ybmVyUmFkaXVzOiAwLFxyXG4gICAgICBiYWNrZ3JvdW5kRmlsbDogJ3doaXRlJyxcclxuICAgICAgYmFja2dyb3VuZFN0cm9rZTogJ2xpZ2h0R3JheScsXHJcbiAgICAgIGJhY2tncm91bmRMaW5lV2lkdGg6IDEsXHJcbiAgICAgIGJhY2tncm91bmRMaW5lRGFzaDogW10sXHJcbiAgICAgIG1pbkJhY2tncm91bmRXaWR0aDogMCxcclxuXHJcbiAgICAgIG5vVmFsdWVTdHJpbmc6IE1hdGhTeW1ib2xzLk5PX1ZBTFVFLFxyXG4gICAgICBub1ZhbHVlQWxpZ246IG51bGwsXHJcbiAgICAgIG5vVmFsdWVQYXR0ZXJuOiBudWxsLFxyXG5cclxuICAgICAgLy8gcGhldC1pb1xyXG4gICAgICB0YW5kZW06IFRhbmRlbS5PUFRJT05BTCxcclxuICAgICAgcGhldGlvVHlwZTogTnVtYmVyRGlzcGxheS5OdW1iZXJEaXNwbGF5SU9cclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIC8vIHZhbHVlUGF0dGVybnxkZWNpbWFsUGxhY2VzIGlzIG11dHVhbGx5IGV4Y2x1c2l2ZSB3aXRoIG51bWJlckZvcm1hdHRlclxyXG4gICAgaWYgKCBhc3NlcnQgKSB7XHJcbiAgICAgIGNvbnN0IG51bWJlckZvcm1hdHRlclByb3ZpZGVkID0gISFvcHRpb25zLm51bWJlckZvcm1hdHRlcjtcclxuICAgICAgY29uc3QgZGVjaW1hbFBsYWNlc1Byb3ZpZGVkID0gb3B0aW9ucy5kZWNpbWFsUGxhY2VzICE9PSBERUZBVUxUX0RFQ0lNQUxfUExBQ0VTO1xyXG4gICAgICBjb25zdCB2YWx1ZVBhdHRlcm5Qcm92aWRlZCA9IG9wdGlvbnMudmFsdWVQYXR0ZXJuICE9PSBTdW5Db25zdGFudHMuVkFMVUVfTkFNRURfUExBQ0VIT0xERVI7XHJcbiAgICAgIGNvbnN0IGRlY2ltYWxPclZhbHVlUHJvdmlkZWQgPSBkZWNpbWFsUGxhY2VzUHJvdmlkZWQgfHwgdmFsdWVQYXR0ZXJuUHJvdmlkZWQ7XHJcbiAgICAgIGlmICggbnVtYmVyRm9ybWF0dGVyUHJvdmlkZWQgfHwgZGVjaW1hbE9yVmFsdWVQcm92aWRlZCApIHtcclxuICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBudW1iZXJGb3JtYXR0ZXJQcm92aWRlZCAhPT0gZGVjaW1hbE9yVmFsdWVQcm92aWRlZCxcclxuICAgICAgICAgICdvcHRpb25zLm51bWJlckZvcm1hdHRlciBpcyBtdXR1YWxseSBleGNsdXNpdmUgd2l0aCBvcHRpb25zLnZhbHVlUGF0dGVybiBhbmQgb3B0aW9ucy5kZWNpbWFsUGxhY2VzJyApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbnVtYmVyRm9ybWF0dGVyUHJvcGVydHkgPSBuZXcgVGlueVByb3BlcnR5KCBvcHRpb25zLm51bWJlckZvcm1hdHRlciA/IG9wdGlvbnMubnVtYmVyRm9ybWF0dGVyIDogKCB2YWx1ZTogbnVtYmVyICkgPT4ge1xyXG4gICAgICBpZiAoIG9wdGlvbnMuZGVjaW1hbFBsYWNlcyA9PT0gbnVsbCApIHtcclxuICAgICAgICByZXR1cm4gYCR7dmFsdWV9YDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gVXRpbHMudG9GaXhlZCggdmFsdWUsIG9wdGlvbnMuZGVjaW1hbFBsYWNlcyApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggIW9wdGlvbnMuaGFzT3duUHJvcGVydHkoICd1bml0c05vZGUnICksICd1bml0c05vZGUgaXMgbm90IGEgc3VwcG9ydGVkIG9wdGlvbicgKTtcclxuXHJcbiAgICAvLyBTZXQgZGVmYXVsdCBhbGlnbm1lbnRzIGFuZCB2YWxpZGF0ZVxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggXy5pbmNsdWRlcyggQUxJR05fVkFMVUVTLCBvcHRpb25zLmFsaWduICksIGBpbnZhbGlkIGFsaWduOiAke29wdGlvbnMuYWxpZ259YCApO1xyXG4gICAgaWYgKCAhb3B0aW9ucy5ub1ZhbHVlQWxpZ24gKSB7XHJcbiAgICAgIG9wdGlvbnMubm9WYWx1ZUFsaWduID0gb3B0aW9ucy5hbGlnbjtcclxuICAgIH1cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIF8uaW5jbHVkZXMoIEFMSUdOX1ZBTFVFUywgb3B0aW9ucy5ub1ZhbHVlQWxpZ24gKSwgYGludmFsaWQgbm9WYWx1ZUFsaWduOiAke29wdGlvbnMubm9WYWx1ZUFsaWdufWAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMudGV4dE9wdGlvbnMsICdkaWQgeW91IGFjY2lkZW50YWxseSBzZXQgdGV4dE9wdGlvbnMgdG8gbnVsbD8nICk7XHJcblxyXG4gICAgLy8gU3VwcG9ydCBudW1iZXJlZCAob2xkLXN0eWxlKSBwbGFjZWhvbGRlciBieSByZXBsYWNpbmcgaXQgd2l0aCB0aGUgY29ycmVzcG9uZGluZyBuYW1lZCBwbGFjZWhvbGRlci5cclxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS1waGV0L2lzc3Vlcy80NDZcclxuICAgIGNvbnN0IHJlcGxhY2VWYWx1ZVBhdHRlcm5WYWx1ZSA9ICggdmFsdWVQYXR0ZXJuOiBzdHJpbmcgKSA9PiB7XHJcbiAgICAgIGlmICggdmFsdWVQYXR0ZXJuLmluY2x1ZGVzKCBTdW5Db25zdGFudHMuVkFMVUVfTlVNQkVSRURfUExBQ0VIT0xERVIgKSApIHtcclxuICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuZm9ybWF0KCB2YWx1ZVBhdHRlcm4sIFN1bkNvbnN0YW50cy5WQUxVRV9OQU1FRF9QTEFDRUhPTERFUiApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZVBhdHRlcm47XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgdmFsdWVQYXR0ZXJuUHJvcGVydHkgPSAoIHR5cGVvZiBvcHRpb25zLnZhbHVlUGF0dGVybiA9PT0gJ3N0cmluZycgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IG5ldyBUaW55UHJvcGVydHkoIHJlcGxhY2VWYWx1ZVBhdHRlcm5WYWx1ZSggb3B0aW9ucy52YWx1ZVBhdHRlcm4gKSApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBvcHRpb25zLnZhbHVlUGF0dGVybiBdLCByZXBsYWNlVmFsdWVQYXR0ZXJuVmFsdWUgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhIXBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuc3RyaW5nVGVzdCB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWVQYXR0ZXJuUHJvcGVydHkudmFsdWUuaW5jbHVkZXMoIFN1bkNvbnN0YW50cy5WQUxVRV9OQU1FRF9QTEFDRUhPTERFUiApLFxyXG4gICAgICBgbWlzc2luZyB2YWx1ZSBwbGFjZWhvbGRlciBpbiBvcHRpb25zLnZhbHVlUGF0dGVybjogJHt2YWx1ZVBhdHRlcm5Qcm9wZXJ0eS52YWx1ZX1gICk7XHJcblxyXG4gICAgLy8gU2V0IGRlZmF1bHQgYW5kIHZhbGlkYXRlXHJcbiAgICBpZiAoICFvcHRpb25zLm5vVmFsdWVQYXR0ZXJuICkge1xyXG4gICAgICAvLyBTbyB3ZSBkb24ndCBoYXZlIGR1cGxpY2F0ZWQgUHJvcGVydGllcyBpbiBvdXIgRGVyaXZlZFByb3BlcnR5IChpdCdzIG5vdCBzdXBwb3J0ZWQgYnkgdGhhdClcclxuICAgICAgb3B0aW9ucy5ub1ZhbHVlUGF0dGVybiA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgdmFsdWVQYXR0ZXJuUHJvcGVydHkgXSwgeCA9PiB4ICk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBub1ZhbHVlUGF0dGVyblByb3BlcnR5ID0gdHlwZW9mIG9wdGlvbnMubm9WYWx1ZVBhdHRlcm4gPT09ICdzdHJpbmcnID8gbmV3IFRpbnlQcm9wZXJ0eSggb3B0aW9ucy5ub1ZhbHVlUGF0dGVybiApIDogb3B0aW9ucy5ub1ZhbHVlUGF0dGVybjtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhIXBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuc3RyaW5nVGVzdCB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgbm9WYWx1ZVBhdHRlcm5Qcm9wZXJ0eS52YWx1ZS5pbmNsdWRlcyggU3VuQ29uc3RhbnRzLlZBTFVFX05BTUVEX1BMQUNFSE9MREVSICksXHJcbiAgICAgIGBtaXNzaW5nIHZhbHVlIHBsYWNlaG9sZGVyIGluIG9wdGlvbnMubm9WYWx1ZVBhdHRlcm46ICR7bm9WYWx1ZVBhdHRlcm5Qcm9wZXJ0eS52YWx1ZX1gICk7XHJcblxyXG4gICAgLy8gZGV0ZXJtaW5lIHRoZSB3aWRlc3QgdmFsdWVcclxuICAgIGNvbnN0IG1pblN0cmluZ1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBudW1iZXJGb3JtYXR0ZXJQcm9wZXJ0eSBdLCBudW1iZXJGb3JtYXR0ZXIgPT4ge1xyXG4gICAgICByZXR1cm4gdmFsdWVUb1N0cmluZyggZGlzcGxheVJhbmdlLm1pbiwgb3B0aW9ucy5ub1ZhbHVlU3RyaW5nLCBudW1iZXJGb3JtYXR0ZXIgKTtcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IG1heFN0cmluZ1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBudW1iZXJGb3JtYXR0ZXJQcm9wZXJ0eSBdLCBudW1iZXJGb3JtYXR0ZXIgPT4ge1xyXG4gICAgICByZXR1cm4gdmFsdWVUb1N0cmluZyggZGlzcGxheVJhbmdlLm1heCwgb3B0aW9ucy5ub1ZhbHVlU3RyaW5nLCBudW1iZXJGb3JtYXR0ZXIgKTtcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IGxvbmdlc3RTdHJpbmdQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFtcclxuICAgICAgdmFsdWVQYXR0ZXJuUHJvcGVydHksXHJcbiAgICAgIG1pblN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBtYXhTdHJpbmdQcm9wZXJ0eVxyXG4gICAgXSwgKCB2YWx1ZVBhdHRlcm4sIG1pblN0cmluZywgbWF4U3RyaW5nICkgPT4ge1xyXG4gICAgICByZXR1cm4gU3RyaW5nVXRpbHMuZmlsbEluKCB2YWx1ZVBhdHRlcm4sIHtcclxuICAgICAgICB2YWx1ZTogKCAoIG1pblN0cmluZy5sZW5ndGggPiBtYXhTdHJpbmcubGVuZ3RoICkgPyBtaW5TdHJpbmcgOiBtYXhTdHJpbmcgKVxyXG4gICAgICB9ICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gdmFsdWVcclxuICAgIGNvbnN0IENvbnN0cnVjdG9yID0gb3B0aW9ucy51c2VSaWNoVGV4dCA/IFJpY2hUZXh0IDogVGV4dDtcclxuICAgIGNvbnN0IHZhbHVlVGV4dFRhbmRlbSA9IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3ZhbHVlVGV4dCcgKTtcclxuICAgIGNvbnN0IHZhbHVlU3RyaW5nUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbXHJcbiAgICAgIG51bWJlclByb3BlcnR5LFxyXG4gICAgICBub1ZhbHVlUGF0dGVyblByb3BlcnR5LFxyXG4gICAgICB2YWx1ZVBhdHRlcm5Qcm9wZXJ0eSxcclxuICAgICAgbnVtYmVyRm9ybWF0dGVyUHJvcGVydHlcclxuICAgIF0sICggdmFsdWUsIG5vVmFsdWVQYXR0ZXJuLCB2YWx1ZVBhdHRlcm5WYWx1ZSwgbnVtYmVyRm9ybWF0dGVyICkgPT4ge1xyXG4gICAgICBjb25zdCB2YWx1ZVBhdHRlcm4gPSAoIHZhbHVlID09PSBudWxsICYmIG5vVmFsdWVQYXR0ZXJuICkgPyBub1ZhbHVlUGF0dGVybiA6IHZhbHVlUGF0dGVyblZhbHVlO1xyXG4gICAgICAvLyBOT1RFOiB0aGlzLm51bWJlckZvcm1hdHRlciBjb3VsZCBjaGFuZ2UsIHNvIHdlIHN1cHBvcnQgYSByZWNvbXB1dGVUZXh0KCkgYmVsb3cgdGhhdCByZWNvbXB1dGVzIHRoaXMgZGVyaXZhdGlvblxyXG4gICAgICBjb25zdCBzdHJpbmdWYWx1ZSA9IHZhbHVlVG9TdHJpbmcoIHZhbHVlLCBvcHRpb25zLm5vVmFsdWVTdHJpbmcsIG51bWJlckZvcm1hdHRlciApO1xyXG4gICAgICByZXR1cm4gU3RyaW5nVXRpbHMuZmlsbEluKCB2YWx1ZVBhdHRlcm4sIHtcclxuICAgICAgICB2YWx1ZTogc3RyaW5nVmFsdWVcclxuICAgICAgfSApO1xyXG4gICAgfSwge1xyXG4gICAgICB0YW5kZW06IHZhbHVlVGV4dFRhbmRlbS5jcmVhdGVUYW5kZW0oIFRleHQuU1RSSU5HX1BST1BFUlRZX1RBTkRFTV9OQU1FICksXHJcbiAgICAgIHBoZXRpb1ZhbHVlVHlwZTogU3RyaW5nSU9cclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCB2YWx1ZVRleHRPcHRpb25zID0gY29tYmluZU9wdGlvbnM8VGV4dE9wdGlvbnMgfCBSaWNoVGV4dE9wdGlvbnM+KCB7fSwgb3B0aW9ucy50ZXh0T3B0aW9ucywge1xyXG4gICAgICBtYXhXaWR0aDogbnVsbCAvLyB3ZSBhcmUgaGFuZGxpbmcgbWF4V2lkdGggbWFudWFsbHksIHNvIHdlIGRvbid0IHdhbnQgdG8gcHJvdmlkZSBpdCBpbml0aWFsbHkuXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgdmFsdWVUZXh0OiBUZXh0IHwgUmljaFRleHQgPSBuZXcgQ29uc3RydWN0b3IoIHZhbHVlU3RyaW5nUHJvcGVydHksIGNvbWJpbmVPcHRpb25zPFRleHRPcHRpb25zIHwgUmljaFRleHRPcHRpb25zPigge1xyXG4gICAgICB0YW5kZW06IHZhbHVlVGV4dFRhbmRlbVxyXG4gICAgfSwgdmFsdWVUZXh0T3B0aW9ucyApICk7XHJcblxyXG4gICAgY29uc3Qgb3JpZ2luYWxUZXh0SGVpZ2h0ID0gdmFsdWVUZXh0LmhlaWdodDtcclxuXHJcbiAgICAvLyBiYWNrZ3JvdW5kIHJlY3RhbmdsZVxyXG4gICAgY29uc3QgYmFja2dyb3VuZE5vZGUgPSBuZXcgUmVjdGFuZ2xlKCB7XHJcbiAgICAgIGNvcm5lclJhZGl1czogb3B0aW9ucy5jb3JuZXJSYWRpdXMsXHJcbiAgICAgIGZpbGw6IG9wdGlvbnMuYmFja2dyb3VuZEZpbGwsXHJcbiAgICAgIHN0cm9rZTogb3B0aW9ucy5iYWNrZ3JvdW5kU3Ryb2tlLFxyXG4gICAgICBsaW5lV2lkdGg6IG9wdGlvbnMuYmFja2dyb3VuZExpbmVXaWR0aCxcclxuICAgICAgbGluZURhc2g6IG9wdGlvbnMuYmFja2dyb3VuZExpbmVEYXNoXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gTWFudWFsbHkgc2V0IG1heFdpZHRoIGxhdGVyLCBhZGp1c3RpbmcgaXQgdG8gdGhlIHdpZHRoIG9mIHRoZSBsb25nZXN0IHN0cmluZyBpZiBpdCdzIG51bGxcclxuICAgIGxvbmdlc3RTdHJpbmdQcm9wZXJ0eS5saW5rKCBsb25nZXN0U3RyaW5nID0+IHtcclxuICAgICAgY29uc3QgZGVtb1RleHQgPSBuZXcgQ29uc3RydWN0b3IoIGxvbmdlc3RTdHJpbmcsIF8ub21pdCggdmFsdWVUZXh0T3B0aW9ucywgJ3RhbmRlbScgKSApO1xyXG5cclxuICAgICAgdmFsdWVUZXh0Lm1heFdpZHRoID0gKCBvcHRpb25zLnRleHRPcHRpb25zLm1heFdpZHRoICE9PSBudWxsICkgPyBvcHRpb25zLnRleHRPcHRpb25zLm1heFdpZHRoISA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICggZGVtb1RleHQud2lkdGggIT09IDAgKSA/IGRlbW9UZXh0LndpZHRoIDogbnVsbDtcclxuICAgICAgZGVtb1RleHQubWF4V2lkdGggPSB2YWx1ZVRleHQubWF4V2lkdGg7XHJcblxyXG4gICAgICBiYWNrZ3JvdW5kTm9kZS5yZWN0V2lkdGggPSBNYXRoLm1heCggb3B0aW9ucy5taW5CYWNrZ3JvdW5kV2lkdGgsIGRlbW9UZXh0LndpZHRoICsgMiAqIG9wdGlvbnMueE1hcmdpbiApO1xyXG4gICAgICBiYWNrZ3JvdW5kTm9kZS5yZWN0SGVpZ2h0ID0gKCBvcHRpb25zLnVzZUZ1bGxIZWlnaHQgPyBvcmlnaW5hbFRleHRIZWlnaHQgOiBkZW1vVGV4dC5oZWlnaHQgKSArIDIgKiBvcHRpb25zLnlNYXJnaW47XHJcbiAgICB9ICk7XHJcblxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFsgYmFja2dyb3VuZE5vZGUsIHZhbHVlVGV4dCBdO1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5udW1iZXJGb3JtYXR0ZXJQcm9wZXJ0eSA9IG51bWJlckZvcm1hdHRlclByb3BlcnR5O1xyXG4gICAgdGhpcy52YWx1ZVRleHQgPSB2YWx1ZVRleHQ7XHJcbiAgICB0aGlzLmJhY2tncm91bmROb2RlID0gYmFja2dyb3VuZE5vZGU7XHJcblxyXG4gICAgLy8gQWxpZ24gdGhlIHZhbHVlIGluIHRoZSBiYWNrZ3JvdW5kLlxyXG4gICAgTWFudWFsQ29uc3RyYWludC5jcmVhdGUoIHRoaXMsIFsgdmFsdWVUZXh0LCBiYWNrZ3JvdW5kTm9kZSBdLCAoIHZhbHVlVGV4dFByb3h5LCBiYWNrZ3JvdW5kTm9kZVByb3h5ICkgPT4ge1xyXG5cclxuICAgICAgLy8gQWxpZ25tZW50IGRlcGVuZHMgb24gd2hldGhlciB3ZSBoYXZlIGEgbm9uLW51bGwgdmFsdWUuXHJcbiAgICAgIGNvbnN0IGFsaWduID0gKCBudW1iZXJQcm9wZXJ0eS52YWx1ZSA9PT0gbnVsbCApID8gb3B0aW9ucy5ub1ZhbHVlQWxpZ24gOiBvcHRpb25zLmFsaWduO1xyXG5cclxuICAgICAgLy8gaG9yaXpvbnRhbCBhbGlnbm1lbnRcclxuICAgICAgaWYgKCBhbGlnbiA9PT0gJ2NlbnRlcicgKSB7XHJcbiAgICAgICAgdmFsdWVUZXh0UHJveHkuY2VudGVyWCA9IGJhY2tncm91bmROb2RlUHJveHkuY2VudGVyWDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggYWxpZ24gPT09ICdsZWZ0JyApIHtcclxuICAgICAgICB2YWx1ZVRleHRQcm94eS5sZWZ0ID0gYmFja2dyb3VuZE5vZGVQcm94eS5sZWZ0ICsgb3B0aW9ucy54TWFyZ2luO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgeyAvLyByaWdodFxyXG4gICAgICAgIHZhbHVlVGV4dFByb3h5LnJpZ2h0ID0gYmFja2dyb3VuZE5vZGVQcm94eS5yaWdodCAtIG9wdGlvbnMueE1hcmdpbjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gdmVydGljYWwgYWxpZ25tZW50XHJcbiAgICAgIHZhbHVlVGV4dFByb3h5LmNlbnRlclkgPSBiYWNrZ3JvdW5kTm9kZVByb3h5LmNlbnRlclk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VOdW1iZXJEaXNwbGF5ID0gKCkgPT4ge1xyXG4gICAgICB2YWx1ZVN0cmluZ1Byb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgdmFsdWVQYXR0ZXJuUHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXROdW1iZXJGb3JtYXR0ZXIoIG51bWJlckZvcm1hdHRlcjogKCBuOiBudW1iZXIgKSA9PiBzdHJpbmcgKTogdm9pZCB7XHJcbiAgICB0aGlzLm51bWJlckZvcm1hdHRlclByb3BlcnR5LnZhbHVlID0gbnVtYmVyRm9ybWF0dGVyO1xyXG4gIH1cclxuXHJcbiAgLy8gUmVkcmF3IHRoZSB0ZXh0IHdoZW4gc29tZXRoaW5nIG90aGVyIHRoYW4gdGhlIG51bWJlclByb3BlcnR5IGNoYW5nZXMgKHN1Y2ggYXMgdW5pdHMsIGZvcm1hdHRlciwgZXRjKS5cclxuICAvLyBAZGVwcmVjYXRlZFxyXG4gIHB1YmxpYyByZWNvbXB1dGVUZXh0KCk6IHZvaWQge1xyXG4gICAgLy8gbm8tb3AsIG5vdCBuZWVkZWQgbm93XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZU51bWJlckRpc3BsYXkoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIG51bWJlciB0ZXh0IGZvbnQuXHJcbiAgICovXHJcbiAgcHVibGljIHNldE51bWJlckZvbnQoIGZvbnQ6IEZvbnQgKTogdm9pZCB7XHJcbiAgICB0aGlzLnZhbHVlVGV4dC5mb250ID0gZm9udDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgbnVtYmVyRm9udCggdmFsdWU6IEZvbnQgKSB7IHRoaXMuc2V0TnVtYmVyRm9udCggdmFsdWUgKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSBudW1iZXIgdGV4dCBmaWxsLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXROdW1iZXJGaWxsKCBmaWxsOiBUUGFpbnQgKTogdm9pZCB7XHJcbiAgICB0aGlzLnZhbHVlVGV4dC5maWxsID0gZmlsbDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgbnVtYmVyRmlsbCggdmFsdWU6IFRQYWludCApIHsgdGhpcy5zZXROdW1iZXJGaWxsKCB2YWx1ZSApOyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIGJhY2tncm91bmQgZmlsbC5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0QmFja2dyb3VuZEZpbGwoIGZpbGw6IFRQYWludCApOiB2b2lkIHtcclxuICAgIHRoaXMuYmFja2dyb3VuZE5vZGUuZmlsbCA9IGZpbGw7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IGJhY2tncm91bmRGaWxsKCB2YWx1ZTogVFBhaW50ICkgeyB0aGlzLnNldEJhY2tncm91bmRGaWxsKCB2YWx1ZSApOyB9XHJcblxyXG4gIHB1YmxpYyBnZXQgYmFja2dyb3VuZEZpbGwoKTogVFBhaW50IHtcclxuICAgIHJldHVybiB0aGlzLmdldEJhY2tncm91bmRGaWxsKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBiYWNrZ3JvdW5kIGZpbGwuXHJcbiAgICovXHJcbiAgcHVibGljIGdldEJhY2tncm91bmRGaWxsKCk6IFRQYWludCB7XHJcbiAgICByZXR1cm4gdGhpcy5iYWNrZ3JvdW5kTm9kZS5maWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgYmFja2dyb3VuZCBzdHJva2UuXHJcbiAgICovXHJcbiAgcHVibGljIHNldEJhY2tncm91bmRTdHJva2UoIHN0cm9rZTogVFBhaW50ICk6IHZvaWQge1xyXG4gICAgdGhpcy5iYWNrZ3JvdW5kTm9kZS5zdHJva2UgPSBzdHJva2U7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IGJhY2tncm91bmRTdHJva2UoIHZhbHVlOiBUUGFpbnQgKSB7IHRoaXMuc2V0QmFja2dyb3VuZFN0cm9rZSggdmFsdWUgKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIHdpZHRoIG9mIHRoZSBiYWNrZ3JvdW5kLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRCYWNrZ3JvdW5kV2lkdGgoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmJhY2tncm91bmROb2RlLmdldFJlY3RXaWR0aCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHRoZSB3aWR0aCBvZiB0aGUgYmFja2dyb3VuZCBub2RlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRCYWNrZ3JvdW5kV2lkdGgoIHdpZHRoOiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICB0aGlzLmJhY2tncm91bmROb2RlLnNldFJlY3RXaWR0aCggd2lkdGggKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgYmFja2dyb3VuZFdpZHRoKCk6IG51bWJlciB7IHJldHVybiB0aGlzLmdldEJhY2tncm91bmRXaWR0aCgpOyB9XHJcbiAgcHVibGljIHNldCBiYWNrZ3JvdW5kV2lkdGgoIHdpZHRoOiBudW1iZXIgKSB7IHRoaXMuc2V0QmFja2dyb3VuZFdpZHRoKCB3aWR0aCApOyB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgTnVtYmVyRGlzcGxheUlPID0gbmV3IElPVHlwZSggJ051bWJlckRpc3BsYXlJTycsIHtcclxuICAgIHZhbHVlVHlwZTogTnVtYmVyRGlzcGxheSxcclxuICAgIHN1cGVydHlwZTogTm9kZS5Ob2RlSU8sXHJcbiAgICBkb2N1bWVudGF0aW9uOiAnQSBudW1lcmljIHJlYWRvdXQgd2l0aCBhIGJhY2tncm91bmQnXHJcbiAgfSApO1xyXG59XHJcblxyXG5zY2VuZXJ5UGhldC5yZWdpc3RlciggJ051bWJlckRpc3BsYXknLCBOdW1iZXJEaXNwbGF5ICk7XHJcblxyXG4vKipcclxuICogQ29udmVydHMgYSBudW1lcmljIHZhbHVlIHRvIGEgc3RyaW5nLlxyXG4gKiBAcGFyYW0gdmFsdWVcclxuICogQHBhcmFtIGRlY2ltYWxQbGFjZXMgLSBpZiBudWxsLCB1c2UgdGhlIGZ1bGwgdmFsdWVcclxuICogQHBhcmFtIG5vVmFsdWVTdHJpbmdcclxuICogQHBhcmFtIG51bWJlckZvcm1hdHRlciAtIGlmIHByb3ZpZGVkLCBmdW5jdGlvbiB0aGF0IGNvbnZlcnRzIHtudW1iZXJ9ID0+IHtzdHJpbmd9XHJcbiAqL1xyXG5jb25zdCB2YWx1ZVRvU3RyaW5nID0gPFMgZXh0ZW5kcyBudW1iZXIgfCBudWxsPiggdmFsdWU6IFMsIG5vVmFsdWVTdHJpbmc6IHN0cmluZywgbnVtYmVyRm9ybWF0dGVyOiBOdW1iZXJGb3JtYXR0ZXIgKTogKCBTIGV4dGVuZHMgbnVsbCA/ICggc3RyaW5nIHwgbnVsbCApIDogc3RyaW5nICkgPT4ge1xyXG4gIGxldCBzdHJpbmdWYWx1ZSA9IG5vVmFsdWVTdHJpbmc7XHJcbiAgaWYgKCB2YWx1ZSAhPT0gbnVsbCApIHtcclxuICAgIHN0cmluZ1ZhbHVlID0gbnVtYmVyRm9ybWF0dGVyKCB2YWx1ZSApO1xyXG4gIH1cclxuICByZXR1cm4gc3RyaW5nVmFsdWU7XHJcbn07XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sa0NBQWtDO0FBQzlELE9BQU9DLFlBQVksTUFBTSwrQkFBK0I7QUFJeEQsT0FBT0MsS0FBSyxNQUFNLHVCQUF1QjtBQUN6QyxPQUFPQyxTQUFTLElBQUlD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