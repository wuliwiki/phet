// Copyright 2022, University of Colorado Boulder

/**
 * PlayPauseStepButtonGroup has a play & pause button, optional step-forward button, and optional step-back button.
 * It's typically a subcomponent of TimeControlNode, and was originally an inner class of TimeControlNode.
 *
 * @author Denzell Barnett (PhET Interactive Simulations)
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import SceneryPhetConstants from '../SceneryPhetConstants.js';
import PlayPauseButton from './PlayPauseButton.js';
import StepBackwardButton from './StepBackwardButton.js';
import StepForwardButton from './StepForwardButton.js';
import sceneryPhet from '../sceneryPhet.js';
import { HBox } from '../../../scenery/js/imports.js';
import optionize, { combineOptions } from '../../../phet-core/js/optionize.js';
import Tandem from '../../../tandem/js/Tandem.js';
import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import BooleanIO from '../../../tandem/js/types/BooleanIO.js';
import SceneryPhetStrings from '../SceneryPhetStrings.js';
const DEFAULT_STEP_BUTTON_RADIUS = 15;
const DEFAULT_STEP_BUTTON_TOUCH_AREA_DILATION = 5;
export default class PlayPauseStepButtonGroup extends HBox {
  constructor(isPlayingProperty, providedOptions) {
    const options = optionize()({
      // {boolean} - if true, a StepForwardButton is included in the button group
      includeStepForwardButton: true,
      // {boolean} - if true, a StepBackwardButton is included in the button group
      includeStepBackwardButton: false,
      // {number} horizontal space between Play/Pause and Step buttons
      playPauseStepXSpacing: 10,
      // Options for the PlayPauseButton
      playPauseButtonOptions: {
        radius: SceneryPhetConstants.DEFAULT_BUTTON_RADIUS,
        touchAreaDilation: 5
      },
      // Options for the StepBackwardButton
      stepBackwardButtonOptions: {
        radius: DEFAULT_STEP_BUTTON_RADIUS,
        touchAreaDilation: DEFAULT_STEP_BUTTON_TOUCH_AREA_DILATION
      },
      // Options for the StepForwardButton
      stepForwardButtonOptions: {
        radius: DEFAULT_STEP_BUTTON_RADIUS,
        touchAreaDilation: DEFAULT_STEP_BUTTON_TOUCH_AREA_DILATION
      },
      // HBoxOptions
      resize: false,
      // don't change layout if playPauseButton resizes with scaleFactorWhenNotPlaying

      // phet-io
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'ButtonGroup',
      // pdom
      tagName: 'div',
      // so that it can receive descriptions
      appendDescription: true,
      playingDescription: SceneryPhetStrings.a11y.playPauseStepButtonGroup.playingDescriptionStringProperty,
      pausedDescription: SceneryPhetStrings.a11y.playPauseStepButtonGroup.pausedDescriptionStringProperty
    }, providedOptions);

    // by default, the step buttons are enabled when isPlayingProperty is false, but only create a PhET-iO instrumented
    // Property if it is going to be used
    if (!options.stepForwardButtonOptions.enabledProperty || !options.stepBackwardButtonOptions.enabledProperty) {
      const defaultEnabledProperty = DerivedProperty.not(isPlayingProperty, {
        tandem: options.tandem.createTandem('enabledProperty'),
        phetioValueType: BooleanIO
      });
      if (!options.stepForwardButtonOptions.enabledProperty) {
        options.stepForwardButtonOptions.enabledProperty = defaultEnabledProperty;
      }
      if (!options.stepBackwardButtonOptions.enabledProperty) {
        options.stepBackwardButtonOptions.enabledProperty = defaultEnabledProperty;
      }
    }
    const children = [];
    const playPauseButton = new PlayPauseButton(isPlayingProperty, combineOptions({
      tandem: options.tandem.createTandem('playPauseButton'),
      phetioDocumentation: 'Button to control the animation in the simulation. This will also stop the model from stepping.'
    }, options.playPauseButtonOptions));
    children.push(playPauseButton);
    let stepForwardButton = null;
    if (options.includeStepForwardButton) {
      stepForwardButton = new StepForwardButton(combineOptions({
        tandem: options.tandem.createTandem('stepForwardButton'),
        phetioDocumentation: 'Progress the simulation a single model step forwards.'
      }, options.stepForwardButtonOptions));
      children.push(stepForwardButton);
    }
    let stepBackwardButton = null;
    if (options.includeStepBackwardButton) {
      stepBackwardButton = new StepBackwardButton(combineOptions({
        phetioDocumentation: 'Progress the simulation a single model step backwards.',
        tandem: options.tandem.createTandem('stepBackwardButton')
      }, options.stepBackwardButtonOptions));
      children.unshift(stepBackwardButton);
    }
    options.spacing = options.playPauseStepXSpacing;
    options.children = children;
    super(options);
    this.playPauseButton = playPauseButton;
    const playingListener = playing => {
      this.descriptionContent = playing ? options.playingDescription : options.pausedDescription;
    };
    isPlayingProperty.link(playingListener);
    this.disposePlayPauseStepButtonGroup = () => {
      isPlayingProperty.unlink(playingListener);
      playPauseButton.dispose();
      stepForwardButton && stepForwardButton.dispose();
      stepBackwardButton && stepBackwardButton.dispose();
    };
  }

  /**
   * Get the center of the PlayPauseButton, in the local coordinate frame of the PlayPauseStepButtonGroup.
   */
  getPlayPauseButtonCenter() {
    return this.playPauseButton.center;
  }
  dispose() {
    this.disposePlayPauseStepButtonGroup();
    super.dispose();
  }
}
sceneryPhet.register('PlayPauseStepButtonGroup', PlayPauseStepButtonGroup);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTY2VuZXJ5UGhldENvbnN0YW50cyIsIlBsYXlQYXVzZUJ1dHRvbiIsIlN0ZXBCYWNrd2FyZEJ1dHRvbiIsIlN0ZXBGb3J3YXJkQnV0dG9uIiwic2NlbmVyeVBoZXQiLCJIQm94Iiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJUYW5kZW0iLCJEZXJpdmVkUHJvcGVydHkiLCJCb29sZWFuSU8iLCJTY2VuZXJ5UGhldFN0cmluZ3MiLCJERUZBVUxUX1NURVBfQlVUVE9OX1JBRElVUyIsIkRFRkFVTFRfU1RFUF9CVVRUT05fVE9VQ0hfQVJFQV9ESUxBVElPTiIsIlBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cCIsImNvbnN0cnVjdG9yIiwiaXNQbGF5aW5nUHJvcGVydHkiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiaW5jbHVkZVN0ZXBGb3J3YXJkQnV0dG9uIiwiaW5jbHVkZVN0ZXBCYWNrd2FyZEJ1dHRvbiIsInBsYXlQYXVzZVN0ZXBYU3BhY2luZyIsInBsYXlQYXVzZUJ1dHRvbk9wdGlvbnMiLCJyYWRpdXMiLCJERUZBVUxUX0JVVFRPTl9SQURJVVMiLCJ0b3VjaEFyZWFEaWxhdGlvbiIsInN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMiLCJzdGVwRm9yd2FyZEJ1dHRvbk9wdGlvbnMiLCJyZXNpemUiLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInRhbmRlbU5hbWVTdWZmaXgiLCJ0YWdOYW1lIiwiYXBwZW5kRGVzY3JpcHRpb24iLCJwbGF5aW5nRGVzY3JpcHRpb24iLCJhMTF5IiwicGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwIiwicGxheWluZ0Rlc2NyaXB0aW9uU3RyaW5nUHJvcGVydHkiLCJwYXVzZWREZXNjcmlwdGlvbiIsInBhdXNlZERlc2NyaXB0aW9uU3RyaW5nUHJvcGVydHkiLCJlbmFibGVkUHJvcGVydHkiLCJkZWZhdWx0RW5hYmxlZFByb3BlcnR5Iiwibm90IiwiY3JlYXRlVGFuZGVtIiwicGhldGlvVmFsdWVUeXBlIiwiY2hpbGRyZW4iLCJwbGF5UGF1c2VCdXR0b24iLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwicHVzaCIsInN0ZXBGb3J3YXJkQnV0dG9uIiwic3RlcEJhY2t3YXJkQnV0dG9uIiwidW5zaGlmdCIsInNwYWNpbmciLCJwbGF5aW5nTGlzdGVuZXIiLCJwbGF5aW5nIiwiZGVzY3JpcHRpb25Db250ZW50IiwibGluayIsImRpc3Bvc2VQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXAiLCJ1bmxpbmsiLCJkaXNwb3NlIiwiZ2V0UGxheVBhdXNlQnV0dG9uQ2VudGVyIiwiY2VudGVyIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cCBoYXMgYSBwbGF5ICYgcGF1c2UgYnV0dG9uLCBvcHRpb25hbCBzdGVwLWZvcndhcmQgYnV0dG9uLCBhbmQgb3B0aW9uYWwgc3RlcC1iYWNrIGJ1dHRvbi5cclxuICogSXQncyB0eXBpY2FsbHkgYSBzdWJjb21wb25lbnQgb2YgVGltZUNvbnRyb2xOb2RlLCBhbmQgd2FzIG9yaWdpbmFsbHkgYW4gaW5uZXIgY2xhc3Mgb2YgVGltZUNvbnRyb2xOb2RlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIERlbnplbGwgQmFybmV0dCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgU2NlbmVyeVBoZXRDb25zdGFudHMgZnJvbSAnLi4vU2NlbmVyeVBoZXRDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBQbGF5UGF1c2VCdXR0b24sIHsgUGxheVBhdXNlQnV0dG9uT3B0aW9ucyB9IGZyb20gJy4vUGxheVBhdXNlQnV0dG9uLmpzJztcclxuaW1wb3J0IFN0ZXBCYWNrd2FyZEJ1dHRvbiwgeyBTdGVwQmFja3dhcmRCdXR0b25PcHRpb25zIH0gZnJvbSAnLi9TdGVwQmFja3dhcmRCdXR0b24uanMnO1xyXG5pbXBvcnQgU3RlcEZvcndhcmRCdXR0b24sIHsgU3RlcEZvcndhcmRCdXR0b25PcHRpb25zIH0gZnJvbSAnLi9TdGVwRm9yd2FyZEJ1dHRvbi5qcyc7XHJcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuLi9zY2VuZXJ5UGhldC5qcyc7XHJcbmltcG9ydCB7IEhCb3gsIEhCb3hPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBjb21iaW5lT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IEJvb2xlYW5JTyBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvQm9vbGVhbklPLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBTY2VuZXJ5UGhldFN0cmluZ3MgZnJvbSAnLi4vU2NlbmVyeVBoZXRTdHJpbmdzLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5cclxuY29uc3QgREVGQVVMVF9TVEVQX0JVVFRPTl9SQURJVVMgPSAxNTtcclxuY29uc3QgREVGQVVMVF9TVEVQX0JVVFRPTl9UT1VDSF9BUkVBX0RJTEFUSU9OID0gNTtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcblxyXG4gIC8vIGlmIHRydWUsIGEgU3RlcEZvcndhcmRCdXR0b24gaXMgaW5jbHVkZWQgaW4gdGhlIGJ1dHRvbiBncm91cFxyXG4gIGluY2x1ZGVTdGVwRm9yd2FyZEJ1dHRvbj86IGJvb2xlYW47XHJcblxyXG4gIC8vIGlmIHRydWUsIGEgU3RlcEJhY2t3YXJkQnV0dG9uIGlzIGluY2x1ZGVkIGluIHRoZSBidXR0b24gZ3JvdXBcclxuICBpbmNsdWRlU3RlcEJhY2t3YXJkQnV0dG9uPzogYm9vbGVhbjtcclxuXHJcbiAgLy8gaG9yaXpvbnRhbCBzcGFjZSBiZXR3ZWVuIFBsYXkvUGF1c2UgYW5kIFN0ZXAgYnV0dG9uc1xyXG4gIHBsYXlQYXVzZVN0ZXBYU3BhY2luZz86IG51bWJlcjtcclxuXHJcbiAgLy8gb3B0aW9ucyBmb3IgYnV0dG9uIHN1YmNvbXBvbmVudHNcclxuICBwbGF5UGF1c2VCdXR0b25PcHRpb25zPzogU3RyaWN0T21pdDxQbGF5UGF1c2VCdXR0b25PcHRpb25zLCAndGFuZGVtJyB8ICdwaGV0aW9Eb2N1bWVudGF0aW9uJz47XHJcbiAgc3RlcEZvcndhcmRCdXR0b25PcHRpb25zPzogU3RyaWN0T21pdDxTdGVwRm9yd2FyZEJ1dHRvbk9wdGlvbnMsICd0YW5kZW0nIHwgJ3BoZXRpb0RvY3VtZW50YXRpb24nPjtcclxuICBzdGVwQmFja3dhcmRCdXR0b25PcHRpb25zPzogU3RyaWN0T21pdDxTdGVwQmFja3dhcmRCdXR0b25PcHRpb25zLCAndGFuZGVtJyB8ICdwaGV0aW9Eb2N1bWVudGF0aW9uJz47XHJcblxyXG4gIC8vIHBkb20gLSBkZXNjcmlwdGlvbiBmb3IgdGhpcyBidXR0b24gZ3JvdXAgaW4gaXRzIHBsYXlpbmcgb3IgcGF1c2VkIHN0YXRlIGZyb20gdGhlIGlzUGxheWluZ1Byb3BlcnR5XHJcbiAgcGxheWluZ0Rlc2NyaXB0aW9uPzogc3RyaW5nIHwgVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPjtcclxuICBwYXVzZWREZXNjcmlwdGlvbj86IHN0cmluZyB8IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz47XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXBPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PEhCb3hPcHRpb25zLCAnc3BhY2luZycgfCAnY2hpbGRyZW4nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cCBleHRlbmRzIEhCb3gge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IHBsYXlQYXVzZUJ1dHRvbjogUGxheVBhdXNlQnV0dG9uO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZVBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cDogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBpc1BsYXlpbmdQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj4sIHByb3ZpZGVkT3B0aW9ucz86IFBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cE9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXBPcHRpb25zLCBTZWxmT3B0aW9ucywgSEJveE9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIHtib29sZWFufSAtIGlmIHRydWUsIGEgU3RlcEZvcndhcmRCdXR0b24gaXMgaW5jbHVkZWQgaW4gdGhlIGJ1dHRvbiBncm91cFxyXG4gICAgICBpbmNsdWRlU3RlcEZvcndhcmRCdXR0b246IHRydWUsXHJcblxyXG4gICAgICAvLyB7Ym9vbGVhbn0gLSBpZiB0cnVlLCBhIFN0ZXBCYWNrd2FyZEJ1dHRvbiBpcyBpbmNsdWRlZCBpbiB0aGUgYnV0dG9uIGdyb3VwXHJcbiAgICAgIGluY2x1ZGVTdGVwQmFja3dhcmRCdXR0b246IGZhbHNlLFxyXG5cclxuICAgICAgLy8ge251bWJlcn0gaG9yaXpvbnRhbCBzcGFjZSBiZXR3ZWVuIFBsYXkvUGF1c2UgYW5kIFN0ZXAgYnV0dG9uc1xyXG4gICAgICBwbGF5UGF1c2VTdGVwWFNwYWNpbmc6IDEwLFxyXG5cclxuICAgICAgLy8gT3B0aW9ucyBmb3IgdGhlIFBsYXlQYXVzZUJ1dHRvblxyXG4gICAgICBwbGF5UGF1c2VCdXR0b25PcHRpb25zOiB7XHJcbiAgICAgICAgcmFkaXVzOiBTY2VuZXJ5UGhldENvbnN0YW50cy5ERUZBVUxUX0JVVFRPTl9SQURJVVMsXHJcbiAgICAgICAgdG91Y2hBcmVhRGlsYXRpb246IDVcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIE9wdGlvbnMgZm9yIHRoZSBTdGVwQmFja3dhcmRCdXR0b25cclxuICAgICAgc3RlcEJhY2t3YXJkQnV0dG9uT3B0aW9uczoge1xyXG4gICAgICAgIHJhZGl1czogREVGQVVMVF9TVEVQX0JVVFRPTl9SQURJVVMsXHJcbiAgICAgICAgdG91Y2hBcmVhRGlsYXRpb246IERFRkFVTFRfU1RFUF9CVVRUT05fVE9VQ0hfQVJFQV9ESUxBVElPTlxyXG4gICAgICB9LFxyXG5cclxuICAgICAgLy8gT3B0aW9ucyBmb3IgdGhlIFN0ZXBGb3J3YXJkQnV0dG9uXHJcbiAgICAgIHN0ZXBGb3J3YXJkQnV0dG9uT3B0aW9uczoge1xyXG4gICAgICAgIHJhZGl1czogREVGQVVMVF9TVEVQX0JVVFRPTl9SQURJVVMsXHJcbiAgICAgICAgdG91Y2hBcmVhRGlsYXRpb246IERFRkFVTFRfU1RFUF9CVVRUT05fVE9VQ0hfQVJFQV9ESUxBVElPTlxyXG4gICAgICB9LFxyXG5cclxuICAgICAgLy8gSEJveE9wdGlvbnNcclxuICAgICAgcmVzaXplOiBmYWxzZSwgLy8gZG9uJ3QgY2hhbmdlIGxheW91dCBpZiBwbGF5UGF1c2VCdXR0b24gcmVzaXplcyB3aXRoIHNjYWxlRmFjdG9yV2hlbk5vdFBsYXlpbmdcclxuXHJcbiAgICAgIC8vIHBoZXQtaW9cclxuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRUQsXHJcbiAgICAgIHRhbmRlbU5hbWVTdWZmaXg6ICdCdXR0b25Hcm91cCcsXHJcblxyXG4gICAgICAvLyBwZG9tXHJcbiAgICAgIHRhZ05hbWU6ICdkaXYnLCAvLyBzbyB0aGF0IGl0IGNhbiByZWNlaXZlIGRlc2NyaXB0aW9uc1xyXG4gICAgICBhcHBlbmREZXNjcmlwdGlvbjogdHJ1ZSxcclxuICAgICAgcGxheWluZ0Rlc2NyaXB0aW9uOiBTY2VuZXJ5UGhldFN0cmluZ3MuYTExeS5wbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXAucGxheWluZ0Rlc2NyaXB0aW9uU3RyaW5nUHJvcGVydHksXHJcbiAgICAgIHBhdXNlZERlc2NyaXB0aW9uOiBTY2VuZXJ5UGhldFN0cmluZ3MuYTExeS5wbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXAucGF1c2VkRGVzY3JpcHRpb25TdHJpbmdQcm9wZXJ0eVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gYnkgZGVmYXVsdCwgdGhlIHN0ZXAgYnV0dG9ucyBhcmUgZW5hYmxlZCB3aGVuIGlzUGxheWluZ1Byb3BlcnR5IGlzIGZhbHNlLCBidXQgb25seSBjcmVhdGUgYSBQaEVULWlPIGluc3RydW1lbnRlZFxyXG4gICAgLy8gUHJvcGVydHkgaWYgaXQgaXMgZ29pbmcgdG8gYmUgdXNlZFxyXG4gICAgaWYgKCAoICFvcHRpb25zLnN0ZXBGb3J3YXJkQnV0dG9uT3B0aW9ucy5lbmFibGVkUHJvcGVydHkgKSB8fCAoICFvcHRpb25zLnN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMuZW5hYmxlZFByb3BlcnR5ICkgKSB7XHJcbiAgICAgIGNvbnN0IGRlZmF1bHRFbmFibGVkUHJvcGVydHkgPSBEZXJpdmVkUHJvcGVydHkubm90KCBpc1BsYXlpbmdQcm9wZXJ0eSwge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZW5hYmxlZFByb3BlcnR5JyApLFxyXG4gICAgICAgIHBoZXRpb1ZhbHVlVHlwZTogQm9vbGVhbklPXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIGlmICggIW9wdGlvbnMuc3RlcEZvcndhcmRCdXR0b25PcHRpb25zLmVuYWJsZWRQcm9wZXJ0eSApIHtcclxuXHJcbiAgICAgICAgb3B0aW9ucy5zdGVwRm9yd2FyZEJ1dHRvbk9wdGlvbnMuZW5hYmxlZFByb3BlcnR5ID0gZGVmYXVsdEVuYWJsZWRQcm9wZXJ0eTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoICFvcHRpb25zLnN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMuZW5hYmxlZFByb3BlcnR5ICkge1xyXG5cclxuICAgICAgICBvcHRpb25zLnN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMuZW5hYmxlZFByb3BlcnR5ID0gZGVmYXVsdEVuYWJsZWRQcm9wZXJ0eTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNoaWxkcmVuID0gW107XHJcblxyXG4gICAgY29uc3QgcGxheVBhdXNlQnV0dG9uID0gbmV3IFBsYXlQYXVzZUJ1dHRvbiggaXNQbGF5aW5nUHJvcGVydHksXHJcbiAgICAgIGNvbWJpbmVPcHRpb25zPFBsYXlQYXVzZUJ1dHRvbk9wdGlvbnM+KCB7XHJcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdwbGF5UGF1c2VCdXR0b24nICksXHJcbiAgICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ0J1dHRvbiB0byBjb250cm9sIHRoZSBhbmltYXRpb24gaW4gdGhlIHNpbXVsYXRpb24uIFRoaXMgd2lsbCBhbHNvIHN0b3AgdGhlIG1vZGVsIGZyb20gc3RlcHBpbmcuJ1xyXG4gICAgICB9LCBvcHRpb25zLnBsYXlQYXVzZUJ1dHRvbk9wdGlvbnMgKSApO1xyXG4gICAgY2hpbGRyZW4ucHVzaCggcGxheVBhdXNlQnV0dG9uICk7XHJcblxyXG4gICAgbGV0IHN0ZXBGb3J3YXJkQnV0dG9uOiBTdGVwRm9yd2FyZEJ1dHRvbiB8IG51bGwgPSBudWxsO1xyXG4gICAgaWYgKCBvcHRpb25zLmluY2x1ZGVTdGVwRm9yd2FyZEJ1dHRvbiApIHtcclxuICAgICAgc3RlcEZvcndhcmRCdXR0b24gPSBuZXcgU3RlcEZvcndhcmRCdXR0b24oXHJcbiAgICAgICAgY29tYmluZU9wdGlvbnM8U3RlcEZvcndhcmRCdXR0b25PcHRpb25zPigge1xyXG4gICAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdzdGVwRm9yd2FyZEJ1dHRvbicgKSxcclxuICAgICAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdQcm9ncmVzcyB0aGUgc2ltdWxhdGlvbiBhIHNpbmdsZSBtb2RlbCBzdGVwIGZvcndhcmRzLidcclxuICAgICAgICB9LCBvcHRpb25zLnN0ZXBGb3J3YXJkQnV0dG9uT3B0aW9ucyApICk7XHJcbiAgICAgIGNoaWxkcmVuLnB1c2goIHN0ZXBGb3J3YXJkQnV0dG9uICk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHN0ZXBCYWNrd2FyZEJ1dHRvbjogU3RlcEJhY2t3YXJkQnV0dG9uIHwgbnVsbCA9IG51bGw7XHJcbiAgICBpZiAoIG9wdGlvbnMuaW5jbHVkZVN0ZXBCYWNrd2FyZEJ1dHRvbiApIHtcclxuICAgICAgc3RlcEJhY2t3YXJkQnV0dG9uID0gbmV3IFN0ZXBCYWNrd2FyZEJ1dHRvbihcclxuICAgICAgICBjb21iaW5lT3B0aW9uczxTdGVwQmFja3dhcmRCdXR0b25PcHRpb25zPigge1xyXG4gICAgICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ1Byb2dyZXNzIHRoZSBzaW11bGF0aW9uIGEgc2luZ2xlIG1vZGVsIHN0ZXAgYmFja3dhcmRzLicsXHJcbiAgICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3N0ZXBCYWNrd2FyZEJ1dHRvbicgKVxyXG4gICAgICAgIH0sIG9wdGlvbnMuc3RlcEJhY2t3YXJkQnV0dG9uT3B0aW9ucyApICk7XHJcbiAgICAgIGNoaWxkcmVuLnVuc2hpZnQoIHN0ZXBCYWNrd2FyZEJ1dHRvbiApO1xyXG4gICAgfVxyXG5cclxuICAgIG9wdGlvbnMuc3BhY2luZyA9IG9wdGlvbnMucGxheVBhdXNlU3RlcFhTcGFjaW5nO1xyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IGNoaWxkcmVuO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5wbGF5UGF1c2VCdXR0b24gPSBwbGF5UGF1c2VCdXR0b247XHJcblxyXG4gICAgY29uc3QgcGxheWluZ0xpc3RlbmVyID0gKCBwbGF5aW5nOiBib29sZWFuICkgPT4ge1xyXG4gICAgICB0aGlzLmRlc2NyaXB0aW9uQ29udGVudCA9IHBsYXlpbmcgPyBvcHRpb25zLnBsYXlpbmdEZXNjcmlwdGlvbiA6IG9wdGlvbnMucGF1c2VkRGVzY3JpcHRpb247XHJcbiAgICB9O1xyXG4gICAgaXNQbGF5aW5nUHJvcGVydHkubGluayggcGxheWluZ0xpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwID0gKCkgPT4ge1xyXG4gICAgICBpc1BsYXlpbmdQcm9wZXJ0eS51bmxpbmsoIHBsYXlpbmdMaXN0ZW5lciApO1xyXG5cclxuICAgICAgcGxheVBhdXNlQnV0dG9uLmRpc3Bvc2UoKTtcclxuICAgICAgc3RlcEZvcndhcmRCdXR0b24gJiYgc3RlcEZvcndhcmRCdXR0b24uZGlzcG9zZSgpO1xyXG4gICAgICBzdGVwQmFja3dhcmRCdXR0b24gJiYgc3RlcEJhY2t3YXJkQnV0dG9uLmRpc3Bvc2UoKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIGNlbnRlciBvZiB0aGUgUGxheVBhdXNlQnV0dG9uLCBpbiB0aGUgbG9jYWwgY29vcmRpbmF0ZSBmcmFtZSBvZiB0aGUgUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRQbGF5UGF1c2VCdXR0b25DZW50ZXIoKTogVmVjdG9yMiB7XHJcbiAgICByZXR1cm4gdGhpcy5wbGF5UGF1c2VCdXR0b24uY2VudGVyO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXAoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbnNjZW5lcnlQaGV0LnJlZ2lzdGVyKCAnUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwJywgUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0Esb0JBQW9CLE1BQU0sNEJBQTRCO0FBRTdELE9BQU9DLGVBQWUsTUFBa0Msc0JBQXNCO0FBQzlFLE9BQU9DLGtCQUFrQixNQUFxQyx5QkFBeUI7QUFDdkYsT0FBT0MsaUJBQWlCLE1BQW9DLHdCQUF3QjtBQUNwRixPQUFPQyxXQUFXLE1BQU0sbUJBQW1CO0FBQzNDLFNBQVNDLElBQUksUUFBcUIsZ0NBQWdDO0FBQ2xFLE9BQU9DLFNBQVMsSUFBSUMsY0FBYyxRQUFRLG9DQUFvQztBQUM5RSxPQUFPQyxNQUFNLE1BQU0sOEJBQThCO0FBQ2pELE9BQU9DLGVBQWUsTUFBTSxxQ0FBcUM7QUFDakUsT0FBT0MsU0FBUyxNQUFNLHVDQUF1QztBQUc3RCxPQUFPQyxrQkFBa0IsTUFBTSwwQkFBMEI7QUFHekQsTUFBTUMsMEJBQTBCLEdBQUcsRUFBRTtBQUNyQyxNQUFNQyx1Q0FBdUMsR0FBRyxDQUFDO0FBeUJqRCxlQUFlLE1BQU1DLHdCQUF3QixTQUFTVCxJQUFJLENBQUM7RUFLbERVLFdBQVdBLENBQUVDLGlCQUFvQyxFQUFFQyxlQUFpRCxFQUFHO0lBRTVHLE1BQU1DLE9BQU8sR0FBR1osU0FBUyxDQUE0RCxDQUFDLENBQUU7TUFFdEY7TUFDQWEsd0JBQXdCLEVBQUUsSUFBSTtNQUU5QjtNQUNBQyx5QkFBeUIsRUFBRSxLQUFLO01BRWhDO01BQ0FDLHFCQUFxQixFQUFFLEVBQUU7TUFFekI7TUFDQUMsc0JBQXNCLEVBQUU7UUFDdEJDLE1BQU0sRUFBRXZCLG9CQUFvQixDQUFDd0IscUJBQXFCO1FBQ2xEQyxpQkFBaUIsRUFBRTtNQUNyQixDQUFDO01BRUQ7TUFDQUMseUJBQXlCLEVBQUU7UUFDekJILE1BQU0sRUFBRVgsMEJBQTBCO1FBQ2xDYSxpQkFBaUIsRUFBRVo7TUFDckIsQ0FBQztNQUVEO01BQ0FjLHdCQUF3QixFQUFFO1FBQ3hCSixNQUFNLEVBQUVYLDBCQUEwQjtRQUNsQ2EsaUJBQWlCLEVBQUVaO01BQ3JCLENBQUM7TUFFRDtNQUNBZSxNQUFNLEVBQUUsS0FBSztNQUFFOztNQUVmO01BQ0FDLE1BQU0sRUFBRXJCLE1BQU0sQ0FBQ3NCLFFBQVE7TUFDdkJDLGdCQUFnQixFQUFFLGFBQWE7TUFFL0I7TUFDQUMsT0FBTyxFQUFFLEtBQUs7TUFBRTtNQUNoQkMsaUJBQWlCLEVBQUUsSUFBSTtNQUN2QkMsa0JBQWtCLEVBQUV2QixrQkFBa0IsQ0FBQ3dCLElBQUksQ0FBQ0Msd0JBQXdCLENBQUNDLGdDQUFnQztNQUNyR0MsaUJBQWlCLEVBQUUzQixrQkFBa0IsQ0FBQ3dCLElBQUksQ0FBQ0Msd0JBQXdCLENBQUNHO0lBQ3RFLENBQUMsRUFBRXRCLGVBQWdCLENBQUM7O0lBRXBCO0lBQ0E7SUFDQSxJQUFPLENBQUNDLE9BQU8sQ0FBQ1Msd0JBQXdCLENBQUNhLGVBQWUsSUFBUSxDQUFDdEIsT0FBTyxDQUFDUSx5QkFBeUIsQ0FBQ2MsZUFBaUIsRUFBRztNQUNySCxNQUFNQyxzQkFBc0IsR0FBR2hDLGVBQWUsQ0FBQ2lDLEdBQUcsQ0FBRTFCLGlCQUFpQixFQUFFO1FBQ3JFYSxNQUFNLEVBQUVYLE9BQU8sQ0FBQ1csTUFBTSxDQUFDYyxZQUFZLENBQUUsaUJBQWtCLENBQUM7UUFDeERDLGVBQWUsRUFBRWxDO01BQ25CLENBQUUsQ0FBQztNQUVILElBQUssQ0FBQ1EsT0FBTyxDQUFDUyx3QkFBd0IsQ0FBQ2EsZUFBZSxFQUFHO1FBRXZEdEIsT0FBTyxDQUFDUyx3QkFBd0IsQ0FBQ2EsZUFBZSxHQUFHQyxzQkFBc0I7TUFDM0U7TUFDQSxJQUFLLENBQUN2QixPQUFPLENBQUNRLHlCQUF5QixDQUFDYyxlQUFlLEVBQUc7UUFFeER0QixPQUFPLENBQUNRLHlCQUF5QixDQUFDYyxlQUFlLEdBQUdDLHNCQUFzQjtNQUM1RTtJQUNGO0lBRUEsTUFBTUksUUFBUSxHQUFHLEVBQUU7SUFFbkIsTUFBTUMsZUFBZSxHQUFHLElBQUk3QyxlQUFlLENBQUVlLGlCQUFpQixFQUM1RFQsY0FBYyxDQUEwQjtNQUN0Q3NCLE1BQU0sRUFBRVgsT0FBTyxDQUFDVyxNQUFNLENBQUNjLFlBQVksQ0FBRSxpQkFBa0IsQ0FBQztNQUN4REksbUJBQW1CLEVBQUU7SUFDdkIsQ0FBQyxFQUFFN0IsT0FBTyxDQUFDSSxzQkFBdUIsQ0FBRSxDQUFDO0lBQ3ZDdUIsUUFBUSxDQUFDRyxJQUFJLENBQUVGLGVBQWdCLENBQUM7SUFFaEMsSUFBSUcsaUJBQTJDLEdBQUcsSUFBSTtJQUN0RCxJQUFLL0IsT0FBTyxDQUFDQyx3QkFBd0IsRUFBRztNQUN0QzhCLGlCQUFpQixHQUFHLElBQUk5QyxpQkFBaUIsQ0FDdkNJLGNBQWMsQ0FBNEI7UUFDeENzQixNQUFNLEVBQUVYLE9BQU8sQ0FBQ1csTUFBTSxDQUFDYyxZQUFZLENBQUUsbUJBQW9CLENBQUM7UUFDMURJLG1CQUFtQixFQUFFO01BQ3ZCLENBQUMsRUFBRTdCLE9BQU8sQ0FBQ1Msd0JBQXlCLENBQUUsQ0FBQztNQUN6Q2tCLFFBQVEsQ0FBQ0csSUFBSSxDQUFFQyxpQkFBa0IsQ0FBQztJQUNwQztJQUVBLElBQUlDLGtCQUE2QyxHQUFHLElBQUk7SUFDeEQsSUFBS2hDLE9BQU8sQ0FBQ0UseUJBQXlCLEVBQUc7TUFDdkM4QixrQkFBa0IsR0FBRyxJQUFJaEQsa0JBQWtCLENBQ3pDSyxjQUFjLENBQTZCO1FBQ3pDd0MsbUJBQW1CLEVBQUUsd0RBQXdEO1FBQzdFbEIsTUFBTSxFQUFFWCxPQUFPLENBQUNXLE1BQU0sQ0FBQ2MsWUFBWSxDQUFFLG9CQUFxQjtNQUM1RCxDQUFDLEVBQUV6QixPQUFPLENBQUNRLHlCQUEwQixDQUFFLENBQUM7TUFDMUNtQixRQUFRLENBQUNNLE9BQU8sQ0FBRUQsa0JBQW1CLENBQUM7SUFDeEM7SUFFQWhDLE9BQU8sQ0FBQ2tDLE9BQU8sR0FBR2xDLE9BQU8sQ0FBQ0cscUJBQXFCO0lBQy9DSCxPQUFPLENBQUMyQixRQUFRLEdBQUdBLFFBQVE7SUFFM0IsS0FBSyxDQUFFM0IsT0FBUSxDQUFDO0lBRWhCLElBQUksQ0FBQzRCLGVBQWUsR0FBR0EsZUFBZTtJQUV0QyxNQUFNTyxlQUFlLEdBQUtDLE9BQWdCLElBQU07TUFDOUMsSUFBSSxDQUFDQyxrQkFBa0IsR0FBR0QsT0FBTyxHQUFHcEMsT0FBTyxDQUFDZ0Isa0JBQWtCLEdBQUdoQixPQUFPLENBQUNvQixpQkFBaUI7SUFDNUYsQ0FBQztJQUNEdEIsaUJBQWlCLENBQUN3QyxJQUFJLENBQUVILGVBQWdCLENBQUM7SUFFekMsSUFBSSxDQUFDSSwrQkFBK0IsR0FBRyxNQUFNO01BQzNDekMsaUJBQWlCLENBQUMwQyxNQUFNLENBQUVMLGVBQWdCLENBQUM7TUFFM0NQLGVBQWUsQ0FBQ2EsT0FBTyxDQUFDLENBQUM7TUFDekJWLGlCQUFpQixJQUFJQSxpQkFBaUIsQ0FBQ1UsT0FBTyxDQUFDLENBQUM7TUFDaERULGtCQUFrQixJQUFJQSxrQkFBa0IsQ0FBQ1MsT0FBTyxDQUFDLENBQUM7SUFDcEQsQ0FBQztFQUNIOztFQUVBO0FBQ0Y7QUFDQTtFQUNTQyx3QkFBd0JBLENBQUEsRUFBWTtJQUN6QyxPQUFPLElBQUksQ0FBQ2QsZUFBZSxDQUFDZSxNQUFNO0VBQ3BDO0VBRWdCRixPQUFPQSxDQUFBLEVBQVM7SUFDOUIsSUFBSSxDQUFDRiwrQkFBK0IsQ0FBQyxDQUFDO0lBQ3RDLEtBQUssQ0FBQ0UsT0FBTyxDQUFDLENBQUM7RUFDakI7QUFDRjtBQUVBdkQsV0FBVyxDQUFDMEQsUUFBUSxDQUFFLDBCQUEwQixFQUFFaEQsd0JBQXlCLENBQUMifQ==