// Copyright 2014-2022, University of Colorado Boulder

/**
 * Eye dropper, with a button for dispensing whatever is in the dropper.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Property from '../../axon/js/Property.js';
import { Shape } from '../../kite/js/imports.js';
import InstanceRegistry from '../../phet-core/js/documentation/InstanceRegistry.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import { Circle, Image, Node, Path } from '../../scenery/js/imports.js';
import RoundMomentaryButton from '../../sun/js/buttons/RoundMomentaryButton.js';
import Tandem from '../../tandem/js/Tandem.js';
import eyeDropperBackground_png from '../images/eyeDropperBackground_png.js';
import eyeDropperForeground_png from '../images/eyeDropperForeground_png.js';
import sceneryPhet from './sceneryPhet.js';
import DerivedProperty from '../../axon/js/DerivedProperty.js';

// constants
const DEBUG_ORIGIN = false; // if true, put a red dot at the dropper's origin (bottom center)
const BUTTON_CENTER_Y_OFFSET = 32; // y-offset of button's center in dropper image file

export default class EyeDropperNode extends Node {
  // is the dropper dispensing?

  // is the dropper empty of fluid?

  // for clients who want to hide the button

  // fluid in the dropper

  // You'll need these if you want to create fluid coming out of the tip.
  static TIP_WIDTH = 15;
  static TIP_HEIGHT = 4;
  static GLASS_WIDTH = 46;

  // You'll need these if you want to put a label on the glass. Values are relative to bottom center.
  static GLASS_MIN_Y = -124;
  static GLASS_MAX_Y = -18;
  constructor(provideOptions) {
    const options = optionize()({
      // SelfOptions
      isDispensingProperty: new Property(false),
      isEmptyProperty: new Property(false),
      fluidColor: 'yellow',
      buttonOptions: {
        touchAreaDilation: 15,
        baseColor: 'red',
        radius: 18,
        listenerOptions: {
          // We want to be able to drag the dropper WHILE dispensing, see https://github.com/phetsims/ph-scale/issues/86
          attach: false
        }
      },
      // NodeOptions
      cursor: 'pointer',
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'DropperNode'
    }, provideOptions);
    super();
    this.isDispensingProperty = options.isDispensingProperty;
    this.isEmptyProperty = options.isEmptyProperty;

    // fluid fills the glass portion of the dropper, shape is specific to the dropper image file
    const fluidShape = new Shape().moveTo(-EyeDropperNode.TIP_WIDTH / 2, 0).lineTo(-EyeDropperNode.TIP_WIDTH / 2, -EyeDropperNode.TIP_HEIGHT).lineTo(-EyeDropperNode.GLASS_WIDTH / 2, EyeDropperNode.GLASS_MAX_Y).lineTo(-EyeDropperNode.GLASS_WIDTH / 2, EyeDropperNode.GLASS_MIN_Y).lineTo(EyeDropperNode.GLASS_WIDTH / 2, EyeDropperNode.GLASS_MIN_Y).lineTo(EyeDropperNode.GLASS_WIDTH / 2, EyeDropperNode.GLASS_MAX_Y).lineTo(EyeDropperNode.TIP_WIDTH / 2, -EyeDropperNode.TIP_HEIGHT).lineTo(EyeDropperNode.TIP_WIDTH / 2, 0).close();
    this.fluidNode = new Path(fluidShape, {
      fill: options.fluidColor,
      visibleProperty: DerivedProperty.not(this.isEmptyProperty) // visible when not empty
    });

    // body of the dropper, origin at bottom center
    const foreground = new Image(eyeDropperForeground_png);
    const background = new Image(eyeDropperBackground_png, {
      visibleProperty: this.isEmptyProperty // visible when empty
    });

    const bodyNode = new Node({
      children: [background, foreground]
    });
    bodyNode.x = -bodyNode.width / 2;
    bodyNode.y = -bodyNode.height;

    // button, centered in the dropper's bulb
    const button = new RoundMomentaryButton(this.isDispensingProperty, false, true, combineOptions({
      centerX: bodyNode.centerX,
      centerY: bodyNode.top + BUTTON_CENTER_Y_OFFSET,
      tandem: options.tandem.createTandem('button')
    }, options.buttonOptions));
    options.children = [this.fluidNode, bodyNode, button];

    // add a red dot at the origin
    if (DEBUG_ORIGIN) {
      options.children.push(new Circle({
        radius: 3,
        fill: 'red'
      }));
    }
    this.mutate(options);
    this.disposeEyeDropperNode = () => {
      button.dispose();
    };
    this.button = button;

    // support for binder documentation, stripped out in builds and only runs when ?binder is specified
    assert && phet.chipper.queryParameters.binder && InstanceRegistry.registerDataURL('scenery-phet', 'EyeDropperNode', this);
  }
  dispose() {
    this.disposeEyeDropperNode();
    super.dispose();
  }

  /**
   * Gets the color of the fluid in the dropper.
   */
  getFluidColor() {
    return this.fluidNode.fill;
  }

  /**
   * Sets the color of the fluid in the dropper.
   */
  setFluidColor(color) {
    this.fluidNode.fill = color;
  }
  get fluidColor() {
    return this.getFluidColor();
  }
  set fluidColor(value) {
    this.setFluidColor(value);
  }
}
sceneryPhet.register('EyeDropperNode', EyeDropperNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIlNoYXBlIiwiSW5zdGFuY2VSZWdpc3RyeSIsIm9wdGlvbml6ZSIsImNvbWJpbmVPcHRpb25zIiwiQ2lyY2xlIiwiSW1hZ2UiLCJOb2RlIiwiUGF0aCIsIlJvdW5kTW9tZW50YXJ5QnV0dG9uIiwiVGFuZGVtIiwiZXllRHJvcHBlckJhY2tncm91bmRfcG5nIiwiZXllRHJvcHBlckZvcmVncm91bmRfcG5nIiwic2NlbmVyeVBoZXQiLCJEZXJpdmVkUHJvcGVydHkiLCJERUJVR19PUklHSU4iLCJCVVRUT05fQ0VOVEVSX1lfT0ZGU0VUIiwiRXllRHJvcHBlck5vZGUiLCJUSVBfV0lEVEgiLCJUSVBfSEVJR0hUIiwiR0xBU1NfV0lEVEgiLCJHTEFTU19NSU5fWSIsIkdMQVNTX01BWF9ZIiwiY29uc3RydWN0b3IiLCJwcm92aWRlT3B0aW9ucyIsIm9wdGlvbnMiLCJpc0Rpc3BlbnNpbmdQcm9wZXJ0eSIsImlzRW1wdHlQcm9wZXJ0eSIsImZsdWlkQ29sb3IiLCJidXR0b25PcHRpb25zIiwidG91Y2hBcmVhRGlsYXRpb24iLCJiYXNlQ29sb3IiLCJyYWRpdXMiLCJsaXN0ZW5lck9wdGlvbnMiLCJhdHRhY2giLCJjdXJzb3IiLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInRhbmRlbU5hbWVTdWZmaXgiLCJmbHVpZFNoYXBlIiwibW92ZVRvIiwibGluZVRvIiwiY2xvc2UiLCJmbHVpZE5vZGUiLCJmaWxsIiwidmlzaWJsZVByb3BlcnR5Iiwibm90IiwiZm9yZWdyb3VuZCIsImJhY2tncm91bmQiLCJib2R5Tm9kZSIsImNoaWxkcmVuIiwieCIsIndpZHRoIiwieSIsImhlaWdodCIsImJ1dHRvbiIsImNlbnRlclgiLCJjZW50ZXJZIiwidG9wIiwiY3JlYXRlVGFuZGVtIiwicHVzaCIsIm11dGF0ZSIsImRpc3Bvc2VFeWVEcm9wcGVyTm9kZSIsImRpc3Bvc2UiLCJhc3NlcnQiLCJwaGV0IiwiY2hpcHBlciIsInF1ZXJ5UGFyYW1ldGVycyIsImJpbmRlciIsInJlZ2lzdGVyRGF0YVVSTCIsImdldEZsdWlkQ29sb3IiLCJzZXRGbHVpZENvbG9yIiwiY29sb3IiLCJ2YWx1ZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRXllRHJvcHBlck5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogRXllIGRyb3BwZXIsIHdpdGggYSBidXR0b24gZm9yIGRpc3BlbnNpbmcgd2hhdGV2ZXIgaXMgaW4gdGhlIGRyb3BwZXIuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEluc3RhbmNlUmVnaXN0cnkgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL2RvY3VtZW50YXRpb24vSW5zdGFuY2VSZWdpc3RyeS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgY29tYmluZU9wdGlvbnMgfSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IHsgQ2lyY2xlLCBJbWFnZSwgTm9kZSwgTm9kZU9wdGlvbnMsIFBhdGgsIFRQYWludCB9IGZyb20gJy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBSb3VuZE1vbWVudGFyeUJ1dHRvbiwgeyBSb3VuZE1vbWVudGFyeUJ1dHRvbk9wdGlvbnMgfSBmcm9tICcuLi8uLi9zdW4vanMvYnV0dG9ucy9Sb3VuZE1vbWVudGFyeUJ1dHRvbi5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBleWVEcm9wcGVyQmFja2dyb3VuZF9wbmcgZnJvbSAnLi4vaW1hZ2VzL2V5ZURyb3BwZXJCYWNrZ3JvdW5kX3BuZy5qcyc7XHJcbmltcG9ydCBleWVEcm9wcGVyRm9yZWdyb3VuZF9wbmcgZnJvbSAnLi4vaW1hZ2VzL2V5ZURyb3BwZXJGb3JlZ3JvdW5kX3BuZy5qcyc7XHJcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuL3NjZW5lcnlQaGV0LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgREVCVUdfT1JJR0lOID0gZmFsc2U7IC8vIGlmIHRydWUsIHB1dCBhIHJlZCBkb3QgYXQgdGhlIGRyb3BwZXIncyBvcmlnaW4gKGJvdHRvbSBjZW50ZXIpXHJcbmNvbnN0IEJVVFRPTl9DRU5URVJfWV9PRkZTRVQgPSAzMjsgLy8geS1vZmZzZXQgb2YgYnV0dG9uJ3MgY2VudGVyIGluIGRyb3BwZXIgaW1hZ2UgZmlsZVxyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gaXMgdGhlIGRyb3BwZXIgZGlzcGVuc2luZz9cclxuICBpc0Rpc3BlbnNpbmdQcm9wZXJ0eT86IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyBkb2VzIHRoZSBkcm9wcGVyIGFwcGVhciB0byBiZSBlbXB0eT9cclxuICBpc0VtcHR5UHJvcGVydHk/OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gY29sb3Igb2YgdGhlIGZsdWlkIGluIHRoZSBnbGFzc1xyXG4gIGZsdWlkQ29sb3I/OiBUUGFpbnQ7XHJcblxyXG4gIC8vIHByb3BhZ2F0ZWQgdG8gUm91bmRNb21lbnRhcnlCdXR0b25cclxuICBidXR0b25PcHRpb25zPzogUm91bmRNb21lbnRhcnlCdXR0b25PcHRpb25zO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgRXllRHJvcHBlck5vZGVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PE5vZGVPcHRpb25zLCAnY2hpbGRyZW4nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV5ZURyb3BwZXJOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8vIGlzIHRoZSBkcm9wcGVyIGRpc3BlbnNpbmc/XHJcbiAgcHVibGljIHJlYWRvbmx5IGlzRGlzcGVuc2luZ1Byb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gaXMgdGhlIGRyb3BwZXIgZW1wdHkgb2YgZmx1aWQ/XHJcbiAgcHVibGljIHJlYWRvbmx5IGlzRW1wdHlQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIGZvciBjbGllbnRzIHdobyB3YW50IHRvIGhpZGUgdGhlIGJ1dHRvblxyXG4gIHB1YmxpYyByZWFkb25seSBidXR0b246IE5vZGU7XHJcblxyXG4gIC8vIGZsdWlkIGluIHRoZSBkcm9wcGVyXHJcbiAgcHJpdmF0ZSByZWFkb25seSBmbHVpZE5vZGU6IFBhdGg7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZUV5ZURyb3BwZXJOb2RlOiAoKSA9PiB2b2lkO1xyXG5cclxuICAvLyBZb3UnbGwgbmVlZCB0aGVzZSBpZiB5b3Ugd2FudCB0byBjcmVhdGUgZmx1aWQgY29taW5nIG91dCBvZiB0aGUgdGlwLlxyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgVElQX1dJRFRIID0gMTU7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBUSVBfSEVJR0hUID0gNDtcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IEdMQVNTX1dJRFRIID0gNDY7XHJcblxyXG4gIC8vIFlvdSdsbCBuZWVkIHRoZXNlIGlmIHlvdSB3YW50IHRvIHB1dCBhIGxhYmVsIG9uIHRoZSBnbGFzcy4gVmFsdWVzIGFyZSByZWxhdGl2ZSB0byBib3R0b20gY2VudGVyLlxyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgR0xBU1NfTUlOX1kgPSAtMTI0O1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgR0xBU1NfTUFYX1kgPSAtMTg7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcHJvdmlkZU9wdGlvbnM/OiBFeWVEcm9wcGVyTm9kZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxFeWVEcm9wcGVyTm9kZU9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgaXNEaXNwZW5zaW5nUHJvcGVydHk6IG5ldyBQcm9wZXJ0eTxib29sZWFuPiggZmFsc2UgKSxcclxuICAgICAgaXNFbXB0eVByb3BlcnR5OiBuZXcgUHJvcGVydHk8Ym9vbGVhbj4oIGZhbHNlICksXHJcbiAgICAgIGZsdWlkQ29sb3I6ICd5ZWxsb3cnLFxyXG4gICAgICBidXR0b25PcHRpb25zOiB7XHJcbiAgICAgICAgdG91Y2hBcmVhRGlsYXRpb246IDE1LFxyXG4gICAgICAgIGJhc2VDb2xvcjogJ3JlZCcsXHJcbiAgICAgICAgcmFkaXVzOiAxOCxcclxuICAgICAgICBsaXN0ZW5lck9wdGlvbnM6IHtcclxuICAgICAgICAgIC8vIFdlIHdhbnQgdG8gYmUgYWJsZSB0byBkcmFnIHRoZSBkcm9wcGVyIFdISUxFIGRpc3BlbnNpbmcsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcGgtc2NhbGUvaXNzdWVzLzg2XHJcbiAgICAgICAgICBhdHRhY2g6IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG5cclxuICAgICAgLy8gTm9kZU9wdGlvbnNcclxuICAgICAgY3Vyc29yOiAncG9pbnRlcicsXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVELFxyXG4gICAgICB0YW5kZW1OYW1lU3VmZml4OiAnRHJvcHBlck5vZGUnXHJcbiAgICB9LCBwcm92aWRlT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5pc0Rpc3BlbnNpbmdQcm9wZXJ0eSA9IG9wdGlvbnMuaXNEaXNwZW5zaW5nUHJvcGVydHk7XHJcbiAgICB0aGlzLmlzRW1wdHlQcm9wZXJ0eSA9IG9wdGlvbnMuaXNFbXB0eVByb3BlcnR5O1xyXG5cclxuICAgIC8vIGZsdWlkIGZpbGxzIHRoZSBnbGFzcyBwb3J0aW9uIG9mIHRoZSBkcm9wcGVyLCBzaGFwZSBpcyBzcGVjaWZpYyB0byB0aGUgZHJvcHBlciBpbWFnZSBmaWxlXHJcbiAgICBjb25zdCBmbHVpZFNoYXBlID0gbmV3IFNoYXBlKClcclxuICAgICAgLm1vdmVUbyggLUV5ZURyb3BwZXJOb2RlLlRJUF9XSURUSCAvIDIsIDAgKVxyXG4gICAgICAubGluZVRvKCAtRXllRHJvcHBlck5vZGUuVElQX1dJRFRIIC8gMiwgLUV5ZURyb3BwZXJOb2RlLlRJUF9IRUlHSFQgKVxyXG4gICAgICAubGluZVRvKCAtRXllRHJvcHBlck5vZGUuR0xBU1NfV0lEVEggLyAyLCBFeWVEcm9wcGVyTm9kZS5HTEFTU19NQVhfWSApXHJcbiAgICAgIC5saW5lVG8oIC1FeWVEcm9wcGVyTm9kZS5HTEFTU19XSURUSCAvIDIsIEV5ZURyb3BwZXJOb2RlLkdMQVNTX01JTl9ZIClcclxuICAgICAgLmxpbmVUbyggRXllRHJvcHBlck5vZGUuR0xBU1NfV0lEVEggLyAyLCBFeWVEcm9wcGVyTm9kZS5HTEFTU19NSU5fWSApXHJcbiAgICAgIC5saW5lVG8oIEV5ZURyb3BwZXJOb2RlLkdMQVNTX1dJRFRIIC8gMiwgRXllRHJvcHBlck5vZGUuR0xBU1NfTUFYX1kgKVxyXG4gICAgICAubGluZVRvKCBFeWVEcm9wcGVyTm9kZS5USVBfV0lEVEggLyAyLCAtRXllRHJvcHBlck5vZGUuVElQX0hFSUdIVCApXHJcbiAgICAgIC5saW5lVG8oIEV5ZURyb3BwZXJOb2RlLlRJUF9XSURUSCAvIDIsIDAgKVxyXG4gICAgICAuY2xvc2UoKTtcclxuICAgIHRoaXMuZmx1aWROb2RlID0gbmV3IFBhdGgoIGZsdWlkU2hhcGUsIHtcclxuICAgICAgZmlsbDogb3B0aW9ucy5mbHVpZENvbG9yLFxyXG4gICAgICB2aXNpYmxlUHJvcGVydHk6IERlcml2ZWRQcm9wZXJ0eS5ub3QoIHRoaXMuaXNFbXB0eVByb3BlcnR5ICkgLy8gdmlzaWJsZSB3aGVuIG5vdCBlbXB0eVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGJvZHkgb2YgdGhlIGRyb3BwZXIsIG9yaWdpbiBhdCBib3R0b20gY2VudGVyXHJcbiAgICBjb25zdCBmb3JlZ3JvdW5kID0gbmV3IEltYWdlKCBleWVEcm9wcGVyRm9yZWdyb3VuZF9wbmcgKTtcclxuICAgIGNvbnN0IGJhY2tncm91bmQgPSBuZXcgSW1hZ2UoIGV5ZURyb3BwZXJCYWNrZ3JvdW5kX3BuZywge1xyXG4gICAgICB2aXNpYmxlUHJvcGVydHk6IHRoaXMuaXNFbXB0eVByb3BlcnR5IC8vIHZpc2libGUgd2hlbiBlbXB0eVxyXG4gICAgfSApO1xyXG4gICAgY29uc3QgYm9keU5vZGUgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogWyBiYWNrZ3JvdW5kLCBmb3JlZ3JvdW5kIF1cclxuICAgIH0gKTtcclxuICAgIGJvZHlOb2RlLnggPSAtYm9keU5vZGUud2lkdGggLyAyO1xyXG4gICAgYm9keU5vZGUueSA9IC1ib2R5Tm9kZS5oZWlnaHQ7XHJcblxyXG4gICAgLy8gYnV0dG9uLCBjZW50ZXJlZCBpbiB0aGUgZHJvcHBlcidzIGJ1bGJcclxuICAgIGNvbnN0IGJ1dHRvbiA9IG5ldyBSb3VuZE1vbWVudGFyeUJ1dHRvbiggdGhpcy5pc0Rpc3BlbnNpbmdQcm9wZXJ0eSwgZmFsc2UsIHRydWUsIGNvbWJpbmVPcHRpb25zPFJvdW5kTW9tZW50YXJ5QnV0dG9uT3B0aW9ucz4oIHtcclxuICAgICAgY2VudGVyWDogYm9keU5vZGUuY2VudGVyWCxcclxuICAgICAgY2VudGVyWTogYm9keU5vZGUudG9wICsgQlVUVE9OX0NFTlRFUl9ZX09GRlNFVCxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdidXR0b24nIClcclxuICAgIH0sIG9wdGlvbnMuYnV0dG9uT3B0aW9ucyApICk7XHJcblxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFsgdGhpcy5mbHVpZE5vZGUsIGJvZHlOb2RlLCBidXR0b24gXTtcclxuXHJcbiAgICAvLyBhZGQgYSByZWQgZG90IGF0IHRoZSBvcmlnaW5cclxuICAgIGlmICggREVCVUdfT1JJR0lOICkge1xyXG4gICAgICBvcHRpb25zLmNoaWxkcmVuLnB1c2goIG5ldyBDaXJjbGUoIHsgcmFkaXVzOiAzLCBmaWxsOiAncmVkJyB9ICkgKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm11dGF0ZSggb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZUV5ZURyb3BwZXJOb2RlID0gKCkgPT4ge1xyXG4gICAgICBidXR0b24uZGlzcG9zZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmJ1dHRvbiA9IGJ1dHRvbjtcclxuXHJcbiAgICAvLyBzdXBwb3J0IGZvciBiaW5kZXIgZG9jdW1lbnRhdGlvbiwgc3RyaXBwZWQgb3V0IGluIGJ1aWxkcyBhbmQgb25seSBydW5zIHdoZW4gP2JpbmRlciBpcyBzcGVjaWZpZWRcclxuICAgIGFzc2VydCAmJiBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmJpbmRlciAmJiBJbnN0YW5jZVJlZ2lzdHJ5LnJlZ2lzdGVyRGF0YVVSTCggJ3NjZW5lcnktcGhldCcsICdFeWVEcm9wcGVyTm9kZScsIHRoaXMgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNwb3NlRXllRHJvcHBlck5vZGUoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIGNvbG9yIG9mIHRoZSBmbHVpZCBpbiB0aGUgZHJvcHBlci5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Rmx1aWRDb2xvcigpOiBUUGFpbnQge1xyXG4gICAgcmV0dXJuIHRoaXMuZmx1aWROb2RlLmZpbGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSBjb2xvciBvZiB0aGUgZmx1aWQgaW4gdGhlIGRyb3BwZXIuXHJcbiAgICovXHJcbiAgcHVibGljIHNldEZsdWlkQ29sb3IoIGNvbG9yOiBUUGFpbnQgKTogdm9pZCB7XHJcbiAgICB0aGlzLmZsdWlkTm9kZS5maWxsID0gY29sb3I7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGZsdWlkQ29sb3IoKTogVFBhaW50IHtcclxuICAgIHJldHVybiB0aGlzLmdldEZsdWlkQ29sb3IoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgZmx1aWRDb2xvciggdmFsdWU6IFRQYWludCApIHtcclxuICAgIHRoaXMuc2V0Rmx1aWRDb2xvciggdmFsdWUgKTtcclxuICB9XHJcbn1cclxuXHJcbnNjZW5lcnlQaGV0LnJlZ2lzdGVyKCAnRXllRHJvcHBlck5vZGUnLCBFeWVEcm9wcGVyTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxRQUFRLE1BQU0sMkJBQTJCO0FBRWhELFNBQVNDLEtBQUssUUFBUSwwQkFBMEI7QUFDaEQsT0FBT0MsZ0JBQWdCLE1BQU0sc0RBQXNEO0FBQ25GLE9BQU9DLFNBQVMsSUFBSUMsY0FBYyxRQUFRLGlDQUFpQztBQUMzRSxTQUFTQyxNQUFNLEVBQUVDLEtBQUssRUFBRUMsSUFBSSxFQUFlQyxJQUFJLFFBQWdCLDZCQUE2QjtBQUM1RixPQUFPQyxvQkFBb0IsTUFBdUMsOENBQThDO0FBQ2hILE9BQU9DLE1BQU0sTUFBTSwyQkFBMkI7QUFDOUMsT0FBT0Msd0JBQXdCLE1BQU0sdUNBQXVDO0FBQzVFLE9BQU9DLHdCQUF3QixNQUFNLHVDQUF1QztBQUM1RSxPQUFPQyxXQUFXLE1BQU0sa0JBQWtCO0FBQzFDLE9BQU9DLGVBQWUsTUFBTSxrQ0FBa0M7O0FBRTlEO0FBQ0EsTUFBTUMsWUFBWSxHQUFHLEtBQUssQ0FBQyxDQUFDO0FBQzVCLE1BQU1DLHNCQUFzQixHQUFHLEVBQUUsQ0FBQyxDQUFDOztBQW1CbkMsZUFBZSxNQUFNQyxjQUFjLFNBQVNWLElBQUksQ0FBQztFQUUvQzs7RUFHQTs7RUFHQTs7RUFHQTs7RUFLQTtFQUNBLE9BQXVCVyxTQUFTLEdBQUcsRUFBRTtFQUNyQyxPQUF1QkMsVUFBVSxHQUFHLENBQUM7RUFDckMsT0FBdUJDLFdBQVcsR0FBRyxFQUFFOztFQUV2QztFQUNBLE9BQXVCQyxXQUFXLEdBQUcsQ0FBQyxHQUFHO0VBQ3pDLE9BQXVCQyxXQUFXLEdBQUcsQ0FBQyxFQUFFO0VBRWpDQyxXQUFXQSxDQUFFQyxjQUFzQyxFQUFHO0lBRTNELE1BQU1DLE9BQU8sR0FBR3RCLFNBQVMsQ0FBa0QsQ0FBQyxDQUFFO01BRTVFO01BQ0F1QixvQkFBb0IsRUFBRSxJQUFJMUIsUUFBUSxDQUFXLEtBQU0sQ0FBQztNQUNwRDJCLGVBQWUsRUFBRSxJQUFJM0IsUUFBUSxDQUFXLEtBQU0sQ0FBQztNQUMvQzRCLFVBQVUsRUFBRSxRQUFRO01BQ3BCQyxhQUFhLEVBQUU7UUFDYkMsaUJBQWlCLEVBQUUsRUFBRTtRQUNyQkMsU0FBUyxFQUFFLEtBQUs7UUFDaEJDLE1BQU0sRUFBRSxFQUFFO1FBQ1ZDLGVBQWUsRUFBRTtVQUNmO1VBQ0FDLE1BQU0sRUFBRTtRQUNWO01BQ0YsQ0FBQztNQUVEO01BQ0FDLE1BQU0sRUFBRSxTQUFTO01BQ2pCQyxNQUFNLEVBQUUxQixNQUFNLENBQUMyQixRQUFRO01BQ3ZCQyxnQkFBZ0IsRUFBRTtJQUNwQixDQUFDLEVBQUVkLGNBQWUsQ0FBQztJQUVuQixLQUFLLENBQUMsQ0FBQztJQUVQLElBQUksQ0FBQ0Usb0JBQW9CLEdBQUdELE9BQU8sQ0FBQ0Msb0JBQW9CO0lBQ3hELElBQUksQ0FBQ0MsZUFBZSxHQUFHRixPQUFPLENBQUNFLGVBQWU7O0lBRTlDO0lBQ0EsTUFBTVksVUFBVSxHQUFHLElBQUl0QyxLQUFLLENBQUMsQ0FBQyxDQUMzQnVDLE1BQU0sQ0FBRSxDQUFDdkIsY0FBYyxDQUFDQyxTQUFTLEdBQUcsQ0FBQyxFQUFFLENBQUUsQ0FBQyxDQUMxQ3VCLE1BQU0sQ0FBRSxDQUFDeEIsY0FBYyxDQUFDQyxTQUFTLEdBQUcsQ0FBQyxFQUFFLENBQUNELGNBQWMsQ0FBQ0UsVUFBVyxDQUFDLENBQ25Fc0IsTUFBTSxDQUFFLENBQUN4QixjQUFjLENBQUNHLFdBQVcsR0FBRyxDQUFDLEVBQUVILGNBQWMsQ0FBQ0ssV0FBWSxDQUFDLENBQ3JFbUIsTUFBTSxDQUFFLENBQUN4QixjQUFjLENBQUNHLFdBQVcsR0FBRyxDQUFDLEVBQUVILGNBQWMsQ0FBQ0ksV0FBWSxDQUFDLENBQ3JFb0IsTUFBTSxDQUFFeEIsY0FBYyxDQUFDRyxXQUFXLEdBQUcsQ0FBQyxFQUFFSCxjQUFjLENBQUNJLFdBQVksQ0FBQyxDQUNwRW9CLE1BQU0sQ0FBRXhCLGNBQWMsQ0FBQ0csV0FBVyxHQUFHLENBQUMsRUFBRUgsY0FBYyxDQUFDSyxXQUFZLENBQUMsQ0FDcEVtQixNQUFNLENBQUV4QixjQUFjLENBQUNDLFNBQVMsR0FBRyxDQUFDLEVBQUUsQ0FBQ0QsY0FBYyxDQUFDRSxVQUFXLENBQUMsQ0FDbEVzQixNQUFNLENBQUV4QixjQUFjLENBQUNDLFNBQVMsR0FBRyxDQUFDLEVBQUUsQ0FBRSxDQUFDLENBQ3pDd0IsS0FBSyxDQUFDLENBQUM7SUFDVixJQUFJLENBQUNDLFNBQVMsR0FBRyxJQUFJbkMsSUFBSSxDQUFFK0IsVUFBVSxFQUFFO01BQ3JDSyxJQUFJLEVBQUVuQixPQUFPLENBQUNHLFVBQVU7TUFDeEJpQixlQUFlLEVBQUUvQixlQUFlLENBQUNnQyxHQUFHLENBQUUsSUFBSSxDQUFDbkIsZUFBZ0IsQ0FBQyxDQUFDO0lBQy9ELENBQUUsQ0FBQzs7SUFFSDtJQUNBLE1BQU1vQixVQUFVLEdBQUcsSUFBSXpDLEtBQUssQ0FBRU0sd0JBQXlCLENBQUM7SUFDeEQsTUFBTW9DLFVBQVUsR0FBRyxJQUFJMUMsS0FBSyxDQUFFSyx3QkFBd0IsRUFBRTtNQUN0RGtDLGVBQWUsRUFBRSxJQUFJLENBQUNsQixlQUFlLENBQUM7SUFDeEMsQ0FBRSxDQUFDOztJQUNILE1BQU1zQixRQUFRLEdBQUcsSUFBSTFDLElBQUksQ0FBRTtNQUN6QjJDLFFBQVEsRUFBRSxDQUFFRixVQUFVLEVBQUVELFVBQVU7SUFDcEMsQ0FBRSxDQUFDO0lBQ0hFLFFBQVEsQ0FBQ0UsQ0FBQyxHQUFHLENBQUNGLFFBQVEsQ0FBQ0csS0FBSyxHQUFHLENBQUM7SUFDaENILFFBQVEsQ0FBQ0ksQ0FBQyxHQUFHLENBQUNKLFFBQVEsQ0FBQ0ssTUFBTTs7SUFFN0I7SUFDQSxNQUFNQyxNQUFNLEdBQUcsSUFBSTlDLG9CQUFvQixDQUFFLElBQUksQ0FBQ2lCLG9CQUFvQixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUV0QixjQUFjLENBQStCO01BQzVIb0QsT0FBTyxFQUFFUCxRQUFRLENBQUNPLE9BQU87TUFDekJDLE9BQU8sRUFBRVIsUUFBUSxDQUFDUyxHQUFHLEdBQUcxQyxzQkFBc0I7TUFDOUNvQixNQUFNLEVBQUVYLE9BQU8sQ0FBQ1csTUFBTSxDQUFDdUIsWUFBWSxDQUFFLFFBQVM7SUFDaEQsQ0FBQyxFQUFFbEMsT0FBTyxDQUFDSSxhQUFjLENBQUUsQ0FBQztJQUU1QkosT0FBTyxDQUFDeUIsUUFBUSxHQUFHLENBQUUsSUFBSSxDQUFDUCxTQUFTLEVBQUVNLFFBQVEsRUFBRU0sTUFBTSxDQUFFOztJQUV2RDtJQUNBLElBQUt4QyxZQUFZLEVBQUc7TUFDbEJVLE9BQU8sQ0FBQ3lCLFFBQVEsQ0FBQ1UsSUFBSSxDQUFFLElBQUl2RCxNQUFNLENBQUU7UUFBRTJCLE1BQU0sRUFBRSxDQUFDO1FBQUVZLElBQUksRUFBRTtNQUFNLENBQUUsQ0FBRSxDQUFDO0lBQ25FO0lBRUEsSUFBSSxDQUFDaUIsTUFBTSxDQUFFcEMsT0FBUSxDQUFDO0lBRXRCLElBQUksQ0FBQ3FDLHFCQUFxQixHQUFHLE1BQU07TUFDakNQLE1BQU0sQ0FBQ1EsT0FBTyxDQUFDLENBQUM7SUFDbEIsQ0FBQztJQUVELElBQUksQ0FBQ1IsTUFBTSxHQUFHQSxNQUFNOztJQUVwQjtJQUNBUyxNQUFNLElBQUlDLElBQUksQ0FBQ0MsT0FBTyxDQUFDQyxlQUFlLENBQUNDLE1BQU0sSUFBSWxFLGdCQUFnQixDQUFDbUUsZUFBZSxDQUFFLGNBQWMsRUFBRSxnQkFBZ0IsRUFBRSxJQUFLLENBQUM7RUFDN0g7RUFFZ0JOLE9BQU9BLENBQUEsRUFBUztJQUM5QixJQUFJLENBQUNELHFCQUFxQixDQUFDLENBQUM7SUFDNUIsS0FBSyxDQUFDQyxPQUFPLENBQUMsQ0FBQztFQUNqQjs7RUFFQTtBQUNGO0FBQ0E7RUFDU08sYUFBYUEsQ0FBQSxFQUFXO0lBQzdCLE9BQU8sSUFBSSxDQUFDM0IsU0FBUyxDQUFDQyxJQUFJO0VBQzVCOztFQUVBO0FBQ0Y7QUFDQTtFQUNTMkIsYUFBYUEsQ0FBRUMsS0FBYSxFQUFTO0lBQzFDLElBQUksQ0FBQzdCLFNBQVMsQ0FBQ0MsSUFBSSxHQUFHNEIsS0FBSztFQUM3QjtFQUVBLElBQVc1QyxVQUFVQSxDQUFBLEVBQVc7SUFDOUIsT0FBTyxJQUFJLENBQUMwQyxhQUFhLENBQUMsQ0FBQztFQUM3QjtFQUVBLElBQVcxQyxVQUFVQSxDQUFFNkMsS0FBYSxFQUFHO0lBQ3JDLElBQUksQ0FBQ0YsYUFBYSxDQUFFRSxLQUFNLENBQUM7RUFDN0I7QUFDRjtBQUVBNUQsV0FBVyxDQUFDNkQsUUFBUSxDQUFFLGdCQUFnQixFQUFFekQsY0FBZSxDQUFDIn0=