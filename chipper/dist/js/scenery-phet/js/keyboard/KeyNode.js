// Copyright 2017-2022, University of Colorado Boulder

/**
 * KeyNode looks like a keyboard key. It has a shadow rectangle under the key icon, with a slight offset so that it
 * has a 3D appearance.  KeyNodes are primarily used for accessibility to provide extra information about keyboard
 * navigation and functionality, but an icon could be used for any purpose.
 *
 * Each KeyNode has the same height by default, and icon will be scaled down if it is too large to maintain the proper
 * key height. The width will expand based on padding and the width of the icon in order to surround content fully.
 *
 * @author Jesse Greenberg
 */

import Bounds2 from '../../../dot/js/Bounds2.js';
import optionize from '../../../phet-core/js/optionize.js';
import { AlignBox, Node, Rectangle } from '../../../scenery/js/imports.js';
import sceneryPhet from '../sceneryPhet.js';

// All widths, offsets, and height values are in the ScreenView coordinate frame.

export default class KeyNode extends Node {
  constructor(keyIcon, providedOptions) {
    const options = optionize()({
      keyFill: 'white',
      keyShadowFill: 'black',
      lineWidth: 1.3,
      cornerRadius: 2,
      xShadowOffset: 1.7,
      yShadowOffset: 1.7,
      xMargin: 0,
      yMargin: 0,
      xAlign: 'center',
      yAlign: 'center',
      xPadding: 4,
      yPadding: 4,
      keyHeight: 23,
      minKeyWidth: 23,
      // default equal to keyHeight, a square key as the minimum.
      forceSquareKey: false
    }, providedOptions);

    // Add the height scale to a new node based on the height, with keyIcon as a child so that we don't mutate the parameter node.
    const heightScaleNode = new Node({
      children: [keyIcon]
    });

    // Add the scale to a new node based on the width
    const widthScaleNode = new Node({
      children: [heightScaleNode]
    });

    // place content in an align box so that the key surrounding the icon has minimum bounds calculated above
    // with support for margins
    const content = new AlignBox(widthScaleNode, {
      xAlign: options.xAlign,
      yAlign: options.yAlign,
      xMargin: options.xMargin,
      yMargin: options.yMargin
    });

    // background (shadow rectangle)
    const backgroundShadow = new Rectangle(0, 0, 1, 1, options.cornerRadius, options.cornerRadius, {
      fill: options.keyShadowFill
    });

    // foreground
    const whiteForeground = new Rectangle(0, 0, 1, 1, options.cornerRadius, options.cornerRadius, {
      fill: options.keyFill,
      stroke: 'black',
      lineWidth: options.lineWidth
    });
    keyIcon.boundsProperty.link(() => {
      // scale down the size of the keyIcon passed in if it is taller than the max height of the icon
      let heightScalar = 1;
      const availableHeightForKeyIcon = options.keyHeight - options.yPadding; // adjust for the vertical margin
      if (keyIcon.height > availableHeightForKeyIcon) {
        heightScalar = availableHeightForKeyIcon / keyIcon.height;
      }
      heightScaleNode.setScaleMagnitude(heightScalar);

      // Set the keyWidth to either be the minimum, or the width of the icon + padding, which ever is larger.
      let keyWidth = Math.max(options.minKeyWidth, heightScaleNode.width + options.xPadding);

      // Make the width the same as the height by scaling down the icon if necessary
      if (options.forceSquareKey) {
        // If we are forcing square, we may have to scale the node down to fit
        const availableWidthForKeyIcon = options.minKeyWidth - options.xPadding; // adjust for the horizontal margin

        let widthScalar = 1;
        if (keyIcon.width > availableWidthForKeyIcon) {
          widthScalar = availableWidthForKeyIcon / keyIcon.width;
        }

        // Set the width to the height to make sure the alignBounds below are set correctly as a square.
        keyWidth = options.keyHeight;
        widthScaleNode.setScaleMagnitude(widthScalar);
      }
      content.setAlignBounds(new Bounds2(0, 0, keyWidth, options.keyHeight));
      backgroundShadow.setRectBounds(content.bounds.shiftedXY(options.xShadowOffset, options.yShadowOffset));
      whiteForeground.setRectBounds(content.bounds);
    });

    // children of the icon node, including the background shadow, foreground key, and content icon
    options.children = [backgroundShadow, whiteForeground,
    // content on top
    content];
    super(options);
  }
}
sceneryPhet.register('KeyNode', KeyNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb3VuZHMyIiwib3B0aW9uaXplIiwiQWxpZ25Cb3giLCJOb2RlIiwiUmVjdGFuZ2xlIiwic2NlbmVyeVBoZXQiLCJLZXlOb2RlIiwiY29uc3RydWN0b3IiLCJrZXlJY29uIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImtleUZpbGwiLCJrZXlTaGFkb3dGaWxsIiwibGluZVdpZHRoIiwiY29ybmVyUmFkaXVzIiwieFNoYWRvd09mZnNldCIsInlTaGFkb3dPZmZzZXQiLCJ4TWFyZ2luIiwieU1hcmdpbiIsInhBbGlnbiIsInlBbGlnbiIsInhQYWRkaW5nIiwieVBhZGRpbmciLCJrZXlIZWlnaHQiLCJtaW5LZXlXaWR0aCIsImZvcmNlU3F1YXJlS2V5IiwiaGVpZ2h0U2NhbGVOb2RlIiwiY2hpbGRyZW4iLCJ3aWR0aFNjYWxlTm9kZSIsImNvbnRlbnQiLCJiYWNrZ3JvdW5kU2hhZG93IiwiZmlsbCIsIndoaXRlRm9yZWdyb3VuZCIsInN0cm9rZSIsImJvdW5kc1Byb3BlcnR5IiwibGluayIsImhlaWdodFNjYWxhciIsImF2YWlsYWJsZUhlaWdodEZvcktleUljb24iLCJoZWlnaHQiLCJzZXRTY2FsZU1hZ25pdHVkZSIsImtleVdpZHRoIiwiTWF0aCIsIm1heCIsIndpZHRoIiwiYXZhaWxhYmxlV2lkdGhGb3JLZXlJY29uIiwid2lkdGhTY2FsYXIiLCJzZXRBbGlnbkJvdW5kcyIsInNldFJlY3RCb3VuZHMiLCJib3VuZHMiLCJzaGlmdGVkWFkiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIktleU5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTctMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogS2V5Tm9kZSBsb29rcyBsaWtlIGEga2V5Ym9hcmQga2V5LiBJdCBoYXMgYSBzaGFkb3cgcmVjdGFuZ2xlIHVuZGVyIHRoZSBrZXkgaWNvbiwgd2l0aCBhIHNsaWdodCBvZmZzZXQgc28gdGhhdCBpdFxyXG4gKiBoYXMgYSAzRCBhcHBlYXJhbmNlLiAgS2V5Tm9kZXMgYXJlIHByaW1hcmlseSB1c2VkIGZvciBhY2Nlc3NpYmlsaXR5IHRvIHByb3ZpZGUgZXh0cmEgaW5mb3JtYXRpb24gYWJvdXQga2V5Ym9hcmRcclxuICogbmF2aWdhdGlvbiBhbmQgZnVuY3Rpb25hbGl0eSwgYnV0IGFuIGljb24gY291bGQgYmUgdXNlZCBmb3IgYW55IHB1cnBvc2UuXHJcbiAqXHJcbiAqIEVhY2ggS2V5Tm9kZSBoYXMgdGhlIHNhbWUgaGVpZ2h0IGJ5IGRlZmF1bHQsIGFuZCBpY29uIHdpbGwgYmUgc2NhbGVkIGRvd24gaWYgaXQgaXMgdG9vIGxhcmdlIHRvIG1haW50YWluIHRoZSBwcm9wZXJcclxuICoga2V5IGhlaWdodC4gVGhlIHdpZHRoIHdpbGwgZXhwYW5kIGJhc2VkIG9uIHBhZGRpbmcgYW5kIHRoZSB3aWR0aCBvZiB0aGUgaWNvbiBpbiBvcmRlciB0byBzdXJyb3VuZCBjb250ZW50IGZ1bGx5LlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZ1xyXG4gKi9cclxuXHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFN0cmljdE9taXQgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1N0cmljdE9taXQuanMnO1xyXG5pbXBvcnQgeyBBbGlnbkJveCwgTm9kZSwgTm9kZU9wdGlvbnMsIFJlY3RhbmdsZSwgVENvbG9yIH0gZnJvbSAnLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHNjZW5lcnlQaGV0IGZyb20gJy4uL3NjZW5lcnlQaGV0LmpzJztcclxuXHJcbnR5cGUgWEFsaWduID0gJ2xlZnQnIHwgJ2NlbnRlcicgfCAncmlnaHQnO1xyXG50eXBlIFlBbGlnbiA9ICd0b3AnIHwgJ2NlbnRlcicgfCAnYm90dG9tJztcclxuXHJcbi8vIEFsbCB3aWR0aHMsIG9mZnNldHMsIGFuZCBoZWlnaHQgdmFsdWVzIGFyZSBpbiB0aGUgU2NyZWVuVmlldyBjb29yZGluYXRlIGZyYW1lLlxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyBjb2xvciBhbmQgc3R5bGluZ1xyXG4gIGtleUZpbGw/OiBUQ29sb3I7XHJcbiAga2V5U2hhZG93RmlsbD86IFRDb2xvcjtcclxuICBsaW5lV2lkdGg/OiBudW1iZXI7IC8vIGxpbmUgd2lkdGggZm9yIHRoZSBrZXkgaWNvblxyXG4gIGNvcm5lclJhZGl1cz86IG51bWJlcjsgLy8gY29ybmVyIHJhZGl1cyBhcHBsaWVkIHRvIHRoZSBrZXkgYW5kIGl0cyBzaGFkb3dcclxuXHJcbiAgLy8gb2Zmc2V0IGZvciB0aGUgc2hhZG93IHJlY3RhbmdsZSByZWxhdGl2ZSB0byB0aGUgdG9wIGxlZnQgY29ybmVyIG9mIHRoZSBrZXlcclxuICB4U2hhZG93T2Zmc2V0PzogbnVtYmVyO1xyXG4gIHlTaGFkb3dPZmZzZXQ/OiBudW1iZXI7XHJcblxyXG4gIC8vIG1hcmdpbnMgc2V0IGJ5IEFsaWduQm94XHJcbiAgeE1hcmdpbj86IG51bWJlcjsgLy8gc2V0cyB0aGUgaG9yaXpvbnRhbCBtYXJnaW4gZm9yIHRoZSBpY29uIGZyb20gdGhlIGxlZnQvcmlnaHQgZWRnZVxyXG4gIHlNYXJnaW4/OiBudW1iZXI7IC8vIHNldCB0aGUgdmVydGljYWwgbWFyZ2luIGZvciB0aGUgaWNvbiBmcm9tIHRoZSB0b3AvYm90dG9uIGVkZ2VzXHJcblxyXG4gIC8vIGljb24gYWxpZ25lZCBpbiBjZW50ZXIgb2Yga2V5IGJ5IGRlZmF1bHRcclxuICB4QWxpZ24/OiBYQWxpZ247XHJcbiAgeUFsaWduPzogWUFsaWduO1xyXG5cclxuICAvLyB4IGFuZCB5IHBhZGRpbmcgYXJvdW5kIHRoZSBpY29uLCB3aWxsIGluY3JlYXNlIHRoZSBzaXplIG9mIHRoZSBrZXkgaWYgdGhlcmUgaXMgYXZhaWxhYmxlIHNwYWNlLFxyXG4gIC8vIG9yIHNjYWxlIGRvd24gdGhlIGljb24gaWYga2V5IGlzIGF0IG1heCB3aWR0aCBvciBoZWlnaHRcclxuICB4UGFkZGluZz86IG51bWJlcjtcclxuICB5UGFkZGluZz86IG51bWJlcjtcclxuXHJcbiAgLy8gS2V5IHdpbGwgYmUgYXQgbGVhc3QgdGhpcyB3aWRlLCBtYWtpbmcgaXQgcG9zc2libGUgdG8gc3Vycm91bmQgdGhlIGljb24gd2l0aCBleHRyYSBzcGFjZSBpZiBuZWNlc3NhcnkuXHJcbiAgLy8gVGhlIG1pbmltdW0gd2lkdGggb2YgdGhlIEtleU5vZGUgYWxsb3dlZCwgaWYgdGhlIGljb24gaXMgd2lkZXIsIHRoYW4gaXQgd2lsbCBleHBhbmQgZ3JhY2VmdWxseVxyXG4gIG1pbktleVdpZHRoPzogbnVtYmVyO1xyXG5cclxuICAvLyB0aGUgZGVzaXJlZCBoZWlnaHQgb2YgdGhlIEtleU5vZGU7IGljb24gd2lsbCBiZSBzY2FsZWQgZG93biBpZiB0b28gYmlnXHJcbiAga2V5SGVpZ2h0PzogbnVtYmVyO1xyXG5cclxuICAvLyBGb3JjZSB0aGUgd2lkdGggb2YgdGhlIEtleU5vZGUgdG8gYmUgdGhlIHNhbWUgd2lkdGggYXMgaGVpZ2h0LCBiYXNlZCBvbiB0aGUgaGVpZ2h0LlxyXG4gIC8vIFdpbGwgc2NhbGUgZG93biB0aGUgaWNvbiBpZiB0b28gd2lkZS5cclxuICBmb3JjZVNxdWFyZUtleT86IGJvb2xlYW47XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBLZXlOb2RlT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxOb2RlT3B0aW9ucywgJ2NoaWxkcmVuJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBLZXlOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcigga2V5SWNvbjogTm9kZSwgcHJvdmlkZWRPcHRpb25zPzogS2V5Tm9kZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxLZXlOb2RlT3B0aW9ucywgU2VsZk9wdGlvbnMsIE5vZGVPcHRpb25zPigpKCB7XHJcbiAgICAgIGtleUZpbGw6ICd3aGl0ZScsXHJcbiAgICAgIGtleVNoYWRvd0ZpbGw6ICdibGFjaycsXHJcbiAgICAgIGxpbmVXaWR0aDogMS4zLFxyXG4gICAgICBjb3JuZXJSYWRpdXM6IDIsXHJcbiAgICAgIHhTaGFkb3dPZmZzZXQ6IDEuNyxcclxuICAgICAgeVNoYWRvd09mZnNldDogMS43LFxyXG4gICAgICB4TWFyZ2luOiAwLFxyXG4gICAgICB5TWFyZ2luOiAwLFxyXG4gICAgICB4QWxpZ246ICdjZW50ZXInLFxyXG4gICAgICB5QWxpZ246ICdjZW50ZXInLFxyXG4gICAgICB4UGFkZGluZzogNCxcclxuICAgICAgeVBhZGRpbmc6IDQsXHJcbiAgICAgIGtleUhlaWdodDogMjMsXHJcbiAgICAgIG1pbktleVdpZHRoOiAyMywgLy8gZGVmYXVsdCBlcXVhbCB0byBrZXlIZWlnaHQsIGEgc3F1YXJlIGtleSBhcyB0aGUgbWluaW11bS5cclxuICAgICAgZm9yY2VTcXVhcmVLZXk6IGZhbHNlXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGhlaWdodCBzY2FsZSB0byBhIG5ldyBub2RlIGJhc2VkIG9uIHRoZSBoZWlnaHQsIHdpdGgga2V5SWNvbiBhcyBhIGNoaWxkIHNvIHRoYXQgd2UgZG9uJ3QgbXV0YXRlIHRoZSBwYXJhbWV0ZXIgbm9kZS5cclxuICAgIGNvbnN0IGhlaWdodFNjYWxlTm9kZSA9IG5ldyBOb2RlKCB7IGNoaWxkcmVuOiBbIGtleUljb24gXSB9ICk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBzY2FsZSB0byBhIG5ldyBub2RlIGJhc2VkIG9uIHRoZSB3aWR0aFxyXG4gICAgY29uc3Qgd2lkdGhTY2FsZU5vZGUgPSBuZXcgTm9kZSggeyBjaGlsZHJlbjogWyBoZWlnaHRTY2FsZU5vZGUgXSB9ICk7XHJcblxyXG4gICAgLy8gcGxhY2UgY29udGVudCBpbiBhbiBhbGlnbiBib3ggc28gdGhhdCB0aGUga2V5IHN1cnJvdW5kaW5nIHRoZSBpY29uIGhhcyBtaW5pbXVtIGJvdW5kcyBjYWxjdWxhdGVkIGFib3ZlXHJcbiAgICAvLyB3aXRoIHN1cHBvcnQgZm9yIG1hcmdpbnNcclxuICAgIGNvbnN0IGNvbnRlbnQgPSBuZXcgQWxpZ25Cb3goIHdpZHRoU2NhbGVOb2RlLCB7XHJcbiAgICAgIHhBbGlnbjogb3B0aW9ucy54QWxpZ24sXHJcbiAgICAgIHlBbGlnbjogb3B0aW9ucy55QWxpZ24sXHJcbiAgICAgIHhNYXJnaW46IG9wdGlvbnMueE1hcmdpbixcclxuICAgICAgeU1hcmdpbjogb3B0aW9ucy55TWFyZ2luXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYmFja2dyb3VuZCAoc2hhZG93IHJlY3RhbmdsZSlcclxuICAgIGNvbnN0IGJhY2tncm91bmRTaGFkb3cgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCAxLCAxLCBvcHRpb25zLmNvcm5lclJhZGl1cywgb3B0aW9ucy5jb3JuZXJSYWRpdXMsIHtcclxuICAgICAgZmlsbDogb3B0aW9ucy5rZXlTaGFkb3dGaWxsXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gZm9yZWdyb3VuZFxyXG4gICAgY29uc3Qgd2hpdGVGb3JlZ3JvdW5kID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgMSwgMSwgb3B0aW9ucy5jb3JuZXJSYWRpdXMsIG9wdGlvbnMuY29ybmVyUmFkaXVzLCB7XHJcbiAgICAgIGZpbGw6IG9wdGlvbnMua2V5RmlsbCxcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBsaW5lV2lkdGg6IG9wdGlvbnMubGluZVdpZHRoXHJcbiAgICB9ICk7XHJcblxyXG4gICAga2V5SWNvbi5ib3VuZHNQcm9wZXJ0eS5saW5rKCAoKSA9PiB7XHJcblxyXG4gICAgICAvLyBzY2FsZSBkb3duIHRoZSBzaXplIG9mIHRoZSBrZXlJY29uIHBhc3NlZCBpbiBpZiBpdCBpcyB0YWxsZXIgdGhhbiB0aGUgbWF4IGhlaWdodCBvZiB0aGUgaWNvblxyXG4gICAgICBsZXQgaGVpZ2h0U2NhbGFyID0gMTtcclxuICAgICAgY29uc3QgYXZhaWxhYmxlSGVpZ2h0Rm9yS2V5SWNvbiA9IG9wdGlvbnMua2V5SGVpZ2h0IC0gb3B0aW9ucy55UGFkZGluZzsgLy8gYWRqdXN0IGZvciB0aGUgdmVydGljYWwgbWFyZ2luXHJcbiAgICAgIGlmICgga2V5SWNvbi5oZWlnaHQgPiBhdmFpbGFibGVIZWlnaHRGb3JLZXlJY29uICkge1xyXG4gICAgICAgIGhlaWdodFNjYWxhciA9IGF2YWlsYWJsZUhlaWdodEZvcktleUljb24gLyBrZXlJY29uLmhlaWdodDtcclxuICAgICAgfVxyXG5cclxuICAgICAgaGVpZ2h0U2NhbGVOb2RlLnNldFNjYWxlTWFnbml0dWRlKCBoZWlnaHRTY2FsYXIgKTtcclxuXHJcbiAgICAgIC8vIFNldCB0aGUga2V5V2lkdGggdG8gZWl0aGVyIGJlIHRoZSBtaW5pbXVtLCBvciB0aGUgd2lkdGggb2YgdGhlIGljb24gKyBwYWRkaW5nLCB3aGljaCBldmVyIGlzIGxhcmdlci5cclxuICAgICAgbGV0IGtleVdpZHRoID0gTWF0aC5tYXgoIG9wdGlvbnMubWluS2V5V2lkdGgsIGhlaWdodFNjYWxlTm9kZS53aWR0aCArIG9wdGlvbnMueFBhZGRpbmcgKTtcclxuXHJcbiAgICAgIC8vIE1ha2UgdGhlIHdpZHRoIHRoZSBzYW1lIGFzIHRoZSBoZWlnaHQgYnkgc2NhbGluZyBkb3duIHRoZSBpY29uIGlmIG5lY2Vzc2FyeVxyXG4gICAgICBpZiAoIG9wdGlvbnMuZm9yY2VTcXVhcmVLZXkgKSB7XHJcblxyXG4gICAgICAgIC8vIElmIHdlIGFyZSBmb3JjaW5nIHNxdWFyZSwgd2UgbWF5IGhhdmUgdG8gc2NhbGUgdGhlIG5vZGUgZG93biB0byBmaXRcclxuICAgICAgICBjb25zdCBhdmFpbGFibGVXaWR0aEZvcktleUljb24gPSBvcHRpb25zLm1pbktleVdpZHRoIC0gb3B0aW9ucy54UGFkZGluZzsgLy8gYWRqdXN0IGZvciB0aGUgaG9yaXpvbnRhbCBtYXJnaW5cclxuXHJcbiAgICAgICAgbGV0IHdpZHRoU2NhbGFyID0gMTtcclxuICAgICAgICBpZiAoIGtleUljb24ud2lkdGggPiBhdmFpbGFibGVXaWR0aEZvcktleUljb24gKSB7XHJcbiAgICAgICAgICB3aWR0aFNjYWxhciA9IGF2YWlsYWJsZVdpZHRoRm9yS2V5SWNvbiAvIGtleUljb24ud2lkdGg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTZXQgdGhlIHdpZHRoIHRvIHRoZSBoZWlnaHQgdG8gbWFrZSBzdXJlIHRoZSBhbGlnbkJvdW5kcyBiZWxvdyBhcmUgc2V0IGNvcnJlY3RseSBhcyBhIHNxdWFyZS5cclxuICAgICAgICBrZXlXaWR0aCA9IG9wdGlvbnMua2V5SGVpZ2h0O1xyXG5cclxuICAgICAgICB3aWR0aFNjYWxlTm9kZS5zZXRTY2FsZU1hZ25pdHVkZSggd2lkdGhTY2FsYXIgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29udGVudC5zZXRBbGlnbkJvdW5kcyggbmV3IEJvdW5kczIoIDAsIDAsIGtleVdpZHRoLCBvcHRpb25zLmtleUhlaWdodCApICk7XHJcbiAgICAgIGJhY2tncm91bmRTaGFkb3cuc2V0UmVjdEJvdW5kcyggY29udGVudC5ib3VuZHMuc2hpZnRlZFhZKFxyXG4gICAgICAgIG9wdGlvbnMueFNoYWRvd09mZnNldCwgb3B0aW9ucy55U2hhZG93T2Zmc2V0ICkgKTtcclxuICAgICAgd2hpdGVGb3JlZ3JvdW5kLnNldFJlY3RCb3VuZHMoIGNvbnRlbnQuYm91bmRzICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gY2hpbGRyZW4gb2YgdGhlIGljb24gbm9kZSwgaW5jbHVkaW5nIHRoZSBiYWNrZ3JvdW5kIHNoYWRvdywgZm9yZWdyb3VuZCBrZXksIGFuZCBjb250ZW50IGljb25cclxuICAgIG9wdGlvbnMuY2hpbGRyZW4gPSBbXHJcblxyXG4gICAgICBiYWNrZ3JvdW5kU2hhZG93LFxyXG4gICAgICB3aGl0ZUZvcmVncm91bmQsXHJcblxyXG4gICAgICAvLyBjb250ZW50IG9uIHRvcFxyXG4gICAgICBjb250ZW50XHJcbiAgICBdO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcbiAgfVxyXG59XHJcblxyXG5zY2VuZXJ5UGhldC5yZWdpc3RlciggJ0tleU5vZGUnLCBLZXlOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0sNEJBQTRCO0FBQ2hELE9BQU9DLFNBQVMsTUFBTSxvQ0FBb0M7QUFFMUQsU0FBU0MsUUFBUSxFQUFFQyxJQUFJLEVBQWVDLFNBQVMsUUFBZ0IsZ0NBQWdDO0FBQy9GLE9BQU9DLFdBQVcsTUFBTSxtQkFBbUI7O0FBSzNDOztBQXdDQSxlQUFlLE1BQU1DLE9BQU8sU0FBU0gsSUFBSSxDQUFDO0VBRWpDSSxXQUFXQSxDQUFFQyxPQUFhLEVBQUVDLGVBQWdDLEVBQUc7SUFFcEUsTUFBTUMsT0FBTyxHQUFHVCxTQUFTLENBQTJDLENBQUMsQ0FBRTtNQUNyRVUsT0FBTyxFQUFFLE9BQU87TUFDaEJDLGFBQWEsRUFBRSxPQUFPO01BQ3RCQyxTQUFTLEVBQUUsR0FBRztNQUNkQyxZQUFZLEVBQUUsQ0FBQztNQUNmQyxhQUFhLEVBQUUsR0FBRztNQUNsQkMsYUFBYSxFQUFFLEdBQUc7TUFDbEJDLE9BQU8sRUFBRSxDQUFDO01BQ1ZDLE9BQU8sRUFBRSxDQUFDO01BQ1ZDLE1BQU0sRUFBRSxRQUFRO01BQ2hCQyxNQUFNLEVBQUUsUUFBUTtNQUNoQkMsUUFBUSxFQUFFLENBQUM7TUFDWEMsUUFBUSxFQUFFLENBQUM7TUFDWEMsU0FBUyxFQUFFLEVBQUU7TUFDYkMsV0FBVyxFQUFFLEVBQUU7TUFBRTtNQUNqQkMsY0FBYyxFQUFFO0lBQ2xCLENBQUMsRUFBRWhCLGVBQWdCLENBQUM7O0lBRXBCO0lBQ0EsTUFBTWlC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