// Copyright 2013-2022, University of Colorado Boulder

/**
 * Provides a 2-way mapping between wavelength and Color.
 * The mapping is performed using a color lookup table.
 *
 * Note that the sRGB colorspace is not capable of representing all visible colors.
 * So in converting visible wavelengths to Color, it is possible to lose some color information.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Utils from '../../dot/js/Utils.js';
import optionize from '../../phet-core/js/optionize.js';
import { Color } from '../../scenery/js/imports.js';
import sceneryPhet from './sceneryPhet.js';

// constants
const COLOR_MATCH_DELTA = 2; // Two colors match if their RGB components each differ by less than this amount.
const SPEED_OF_LIGHT = 299792458; // speed of light in a vacuum, in m/s

const VIOLET_WAVELENGTH = 380; // nm
const RED_WAVELENGTH = 780; // nm

// Create the color tables on demand, since they take up 282kb per table or so.
let REDUCED_INTENSITY_COLOR_TABLE = null;
let FULL_INTENSITY_COLOR_TABLE = null;

// TColor would be preferable, but Color.toColor does not currently support TColor.

const VisibleColor = {
  // public constants
  MIN_WAVELENGTH: VIOLET_WAVELENGTH,
  // in nm
  MAX_WAVELENGTH: RED_WAVELENGTH,
  // in nm
  MIN_FREQUENCY: SPEED_OF_LIGHT / RED_WAVELENGTH * 1E9,
  // in Hz
  MAX_FREQUENCY: SPEED_OF_LIGHT / VIOLET_WAVELENGTH * 1E9,
  // in Hz
  SPEED_OF_LIGHT: SPEED_OF_LIGHT,
  // speed of light in a vacuum, in m/s
  WHITE_WAVELENGTH: 0,
  /**
   * Converts a wavelength (in nm, rounded to the nearest integer) to a visible color.
   */
  wavelengthToColor: function (wavelength, providedOptions) {
    const options = optionize()({
      irColor: null,
      uvColor: null,
      reduceIntensityAtExtrema: true
    }, providedOptions);
    let color = null;
    if (wavelength === VisibleColor.WHITE_WAVELENGTH) {
      // white light
      color = Color.WHITE;
    } else if (wavelength < VisibleColor.MIN_WAVELENGTH) {
      // IR
      color = Color.toColor(options.irColor);
    } else if (wavelength > VisibleColor.MAX_WAVELENGTH) {
      // UV
      color = Color.toColor(options.uvColor);
    } else {
      // look up visible color
      const colorTable = getColorTable(options.reduceIntensityAtExtrema);
      color = colorTable[Utils.roundSymmetric(wavelength) - VisibleColor.MIN_WAVELENGTH];
    }
    assert && assert(color, `color not found for wavelength ${wavelength}`);
    return color;
  },
  /**
   * Converts a frequency (in Hz) to a visible color.
   */
  frequencyToColor: function (frequency, providedOptions) {
    const wavelengthInMeters = SPEED_OF_LIGHT / frequency;
    const wavelengthInNanometers = wavelengthInMeters * 1E9;
    return VisibleColor.wavelengthToColor(wavelengthInNanometers, providedOptions);
  },
  /**
   * Converts a Color to its corresponding wavelength. Relies on a color lookup table that is initialized the first
   * time that this method is called.  Color lookup is based on RGB component value; the alpha value is ignored.
   */
  colorToWavelength: function (color, reduceIntensityAtExtrema = true) {
    color = Color.toColor(color);
    let wavelength = -1;
    if (color.equals(Color.WHITE)) {
      wavelength = VisibleColor.WHITE_WAVELENGTH;
    } else {
      const colorTable = getColorTable(reduceIntensityAtExtrema);
      for (let i = 0; i < colorTable.length; i++) {
        if (Math.abs(color.getRed() - colorTable[i].getRed()) < COLOR_MATCH_DELTA && Math.abs(color.getGreen() - colorTable[i].getGreen()) < COLOR_MATCH_DELTA && Math.abs(color.getBlue() - colorTable[i].getBlue()) < COLOR_MATCH_DELTA) {
          wavelength = VisibleColor.MIN_WAVELENGTH + i;
          break;
        }
      }
    }
    assert && assert(wavelength !== -1, `no wavelength found for color ${color.toString()}`);
    return wavelength;
  }
};

/**
 * Creates a table that is used to map wavelength (in nm) to Color.
 * @param reduceIntensityAtExtrema - whether the intensity should be reduced and high and low wavelength
 */
function createColorTable(reduceIntensityAtExtrema) {
  const colorTable = [];

  // Allocate the lookup table
  const numWavelengths = Math.floor(VisibleColor.MAX_WAVELENGTH - VisibleColor.MIN_WAVELENGTH + 1);

  // Populate the lookup table
  let wavelength;
  let r;
  let g;
  let b;
  for (let i = 0; i < numWavelengths; i++) {
    // Create the RGB component values.
    wavelength = VisibleColor.MIN_WAVELENGTH + i;
    r = g = b = 0;

    // Determine the RGB component values.
    if (wavelength >= 380 && wavelength <= 440) {
      r = -1 * (wavelength - 440) / (440 - 380);
      g = 0;
      b = 1;
    } else if (wavelength > 440 && wavelength <= 490) {
      r = 0;
      g = (wavelength - 440) / (490 - 440);
      b = 1;
    } else if (wavelength > 490 && wavelength <= 510) {
      r = 0;
      g = 1;
      b = -1 * (wavelength - 510) / (510 - 490);
    } else if (wavelength > 510 && wavelength <= 580) {
      r = (wavelength - 510) / (580 - 510);
      g = 1;
      b = 0;
    } else if (wavelength > 580 && wavelength <= 645) {
      r = 1;
      g = -1 * (wavelength - 645) / (645 - 580);
      b = 0;
    } else if (wavelength > 645 && wavelength <= 780) {
      r = 1;
      g = 0;
      b = 0;
    }

    // Let the intensity fall off near the vision limits.
    let intensity;
    if (reduceIntensityAtExtrema && wavelength > 645) {
      intensity = 0.3 + 0.7 * (780 - wavelength) / (780 - 645);
    } else if (reduceIntensityAtExtrema && wavelength < 420) {
      intensity = 0.3 + 0.7 * (wavelength - 380) / (420 - 380);
    } else {
      intensity = 1;
    }
    const red = Utils.roundSymmetric(255 * (intensity * r));
    const green = Utils.roundSymmetric(255 * (intensity * g));
    const blue = Utils.roundSymmetric(255 * (intensity * b));
    const alpha = 1;

    // Add the color to the lookup array.
    colorTable[i] = new Color(red, green, blue, alpha);
  }
  return colorTable;
}

/**
 * Determines which color table to use based on the options.  This assumes options have been filled in by the call
 * site, hence uses config instead of options.
 */
function getColorTable(reduceIntensityAtExtrema) {
  if (reduceIntensityAtExtrema) {
    // cache for future use
    REDUCED_INTENSITY_COLOR_TABLE = REDUCED_INTENSITY_COLOR_TABLE || createColorTable(true);
    return REDUCED_INTENSITY_COLOR_TABLE;
  } else {
    // cache for future use
    FULL_INTENSITY_COLOR_TABLE = FULL_INTENSITY_COLOR_TABLE || createColorTable(false);
    return FULL_INTENSITY_COLOR_TABLE;
  }
}
sceneryPhet.register('VisibleColor', VisibleColor);
export default VisibleColor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIm9wdGlvbml6ZSIsIkNvbG9yIiwic2NlbmVyeVBoZXQiLCJDT0xPUl9NQVRDSF9ERUxUQSIsIlNQRUVEX09GX0xJR0hUIiwiVklPTEVUX1dBVkVMRU5HVEgiLCJSRURfV0FWRUxFTkdUSCIsIlJFRFVDRURfSU5URU5TSVRZX0NPTE9SX1RBQkxFIiwiRlVMTF9JTlRFTlNJVFlfQ09MT1JfVEFCTEUiLCJWaXNpYmxlQ29sb3IiLCJNSU5fV0FWRUxFTkdUSCIsIk1BWF9XQVZFTEVOR1RIIiwiTUlOX0ZSRVFVRU5DWSIsIk1BWF9GUkVRVUVOQ1kiLCJXSElURV9XQVZFTEVOR1RIIiwid2F2ZWxlbmd0aFRvQ29sb3IiLCJ3YXZlbGVuZ3RoIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImlyQ29sb3IiLCJ1dkNvbG9yIiwicmVkdWNlSW50ZW5zaXR5QXRFeHRyZW1hIiwiY29sb3IiLCJXSElURSIsInRvQ29sb3IiLCJjb2xvclRhYmxlIiwiZ2V0Q29sb3JUYWJsZSIsInJvdW5kU3ltbWV0cmljIiwiYXNzZXJ0IiwiZnJlcXVlbmN5VG9Db2xvciIsImZyZXF1ZW5jeSIsIndhdmVsZW5ndGhJbk1ldGVycyIsIndhdmVsZW5ndGhJbk5hbm9tZXRlcnMiLCJjb2xvclRvV2F2ZWxlbmd0aCIsImVxdWFscyIsImkiLCJsZW5ndGgiLCJNYXRoIiwiYWJzIiwiZ2V0UmVkIiwiZ2V0R3JlZW4iLCJnZXRCbHVlIiwidG9TdHJpbmciLCJjcmVhdGVDb2xvclRhYmxlIiwibnVtV2F2ZWxlbmd0aHMiLCJmbG9vciIsInIiLCJnIiwiYiIsImludGVuc2l0eSIsInJlZCIsImdyZWVuIiwiYmx1ZSIsImFscGhhIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJWaXNpYmxlQ29sb3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogUHJvdmlkZXMgYSAyLXdheSBtYXBwaW5nIGJldHdlZW4gd2F2ZWxlbmd0aCBhbmQgQ29sb3IuXHJcbiAqIFRoZSBtYXBwaW5nIGlzIHBlcmZvcm1lZCB1c2luZyBhIGNvbG9yIGxvb2t1cCB0YWJsZS5cclxuICpcclxuICogTm90ZSB0aGF0IHRoZSBzUkdCIGNvbG9yc3BhY2UgaXMgbm90IGNhcGFibGUgb2YgcmVwcmVzZW50aW5nIGFsbCB2aXNpYmxlIGNvbG9ycy5cclxuICogU28gaW4gY29udmVydGluZyB2aXNpYmxlIHdhdmVsZW5ndGhzIHRvIENvbG9yLCBpdCBpcyBwb3NzaWJsZSB0byBsb3NlIHNvbWUgY29sb3IgaW5mb3JtYXRpb24uXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCB7IENvbG9yIH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHNjZW5lcnlQaGV0IGZyb20gJy4vc2NlbmVyeVBoZXQuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IENPTE9SX01BVENIX0RFTFRBID0gMjsgLy8gVHdvIGNvbG9ycyBtYXRjaCBpZiB0aGVpciBSR0IgY29tcG9uZW50cyBlYWNoIGRpZmZlciBieSBsZXNzIHRoYW4gdGhpcyBhbW91bnQuXHJcbmNvbnN0IFNQRUVEX09GX0xJR0hUID0gMjk5NzkyNDU4OyAvLyBzcGVlZCBvZiBsaWdodCBpbiBhIHZhY3V1bSwgaW4gbS9zXHJcblxyXG5jb25zdCBWSU9MRVRfV0FWRUxFTkdUSCA9IDM4MDsgLy8gbm1cclxuY29uc3QgUkVEX1dBVkVMRU5HVEggPSA3ODA7IC8vIG5tXHJcblxyXG4vLyBDcmVhdGUgdGhlIGNvbG9yIHRhYmxlcyBvbiBkZW1hbmQsIHNpbmNlIHRoZXkgdGFrZSB1cCAyODJrYiBwZXIgdGFibGUgb3Igc28uXHJcbmxldCBSRURVQ0VEX0lOVEVOU0lUWV9DT0xPUl9UQUJMRTogQ29sb3JbXSB8IG51bGwgPSBudWxsO1xyXG5sZXQgRlVMTF9JTlRFTlNJVFlfQ09MT1JfVEFCTEU6IENvbG9yW10gfCBudWxsID0gbnVsbDtcclxuXHJcbi8vIFRDb2xvciB3b3VsZCBiZSBwcmVmZXJhYmxlLCBidXQgQ29sb3IudG9Db2xvciBkb2VzIG5vdCBjdXJyZW50bHkgc3VwcG9ydCBUQ29sb3IuXHJcbnR5cGUgVENvbG9yU3Vic2V0ID0gQ29sb3IgfCBzdHJpbmcgfCBudWxsO1xyXG5cclxuZXhwb3J0IHR5cGUgV2F2ZWxlbmd0aFRvQ29sb3JPcHRpb25zID0ge1xyXG4gIGlyQ29sb3I/OiBUQ29sb3JTdWJzZXQ7IC8vIGNvbG9yIHRvIHVzZSBmb3IgSVIgd2F2ZWxlbmd0aHNcclxuICB1dkNvbG9yPzogVENvbG9yU3Vic2V0OyAvLyBjb2xvciB0byB1c2UgZm9yIFVWIHdhdmVsZW5ndGhzXHJcbiAgcmVkdWNlSW50ZW5zaXR5QXRFeHRyZW1hPzogYm9vbGVhbjsgLy8gd2hldGhlciBpbnRlbnNpdHkgc2hvdWxkIGZhbGwgb2ZmIGF0IG1pbiBhbmQgbWF4IHdhdmVsZW5ndGhzXHJcbn07XHJcblxyXG5jb25zdCBWaXNpYmxlQ29sb3IgPSB7XHJcblxyXG4gIC8vIHB1YmxpYyBjb25zdGFudHNcclxuICBNSU5fV0FWRUxFTkdUSDogVklPTEVUX1dBVkVMRU5HVEgsIC8vIGluIG5tXHJcbiAgTUFYX1dBVkVMRU5HVEg6IFJFRF9XQVZFTEVOR1RILCAvLyBpbiBubVxyXG4gIE1JTl9GUkVRVUVOQ1k6IFNQRUVEX09GX0xJR0hUIC8gUkVEX1dBVkVMRU5HVEggKiAxRTksIC8vIGluIEh6XHJcbiAgTUFYX0ZSRVFVRU5DWTogU1BFRURfT0ZfTElHSFQgLyBWSU9MRVRfV0FWRUxFTkdUSCAqIDFFOSwgLy8gaW4gSHpcclxuICBTUEVFRF9PRl9MSUdIVDogU1BFRURfT0ZfTElHSFQsIC8vIHNwZWVkIG9mIGxpZ2h0IGluIGEgdmFjdXVtLCBpbiBtL3NcclxuICBXSElURV9XQVZFTEVOR1RIOiAwLFxyXG5cclxuICAvKipcclxuICAgKiBDb252ZXJ0cyBhIHdhdmVsZW5ndGggKGluIG5tLCByb3VuZGVkIHRvIHRoZSBuZWFyZXN0IGludGVnZXIpIHRvIGEgdmlzaWJsZSBjb2xvci5cclxuICAgKi9cclxuICB3YXZlbGVuZ3RoVG9Db2xvcjogZnVuY3Rpb24oIHdhdmVsZW5ndGg6IG51bWJlciwgcHJvdmlkZWRPcHRpb25zPzogV2F2ZWxlbmd0aFRvQ29sb3JPcHRpb25zICk6IENvbG9yIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFdhdmVsZW5ndGhUb0NvbG9yT3B0aW9ucz4oKSgge1xyXG4gICAgICBpckNvbG9yOiBudWxsLFxyXG4gICAgICB1dkNvbG9yOiBudWxsLFxyXG4gICAgICByZWR1Y2VJbnRlbnNpdHlBdEV4dHJlbWE6IHRydWVcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGxldCBjb2xvciA9IG51bGw7XHJcbiAgICBpZiAoIHdhdmVsZW5ndGggPT09IFZpc2libGVDb2xvci5XSElURV9XQVZFTEVOR1RIICkgeyAvLyB3aGl0ZSBsaWdodFxyXG4gICAgICBjb2xvciA9IENvbG9yLldISVRFO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIHdhdmVsZW5ndGggPCBWaXNpYmxlQ29sb3IuTUlOX1dBVkVMRU5HVEggKSB7IC8vIElSXHJcbiAgICAgIGNvbG9yID0gQ29sb3IudG9Db2xvciggb3B0aW9ucy5pckNvbG9yICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggd2F2ZWxlbmd0aCA+IFZpc2libGVDb2xvci5NQVhfV0FWRUxFTkdUSCApIHsgLy8gVVZcclxuICAgICAgY29sb3IgPSBDb2xvci50b0NvbG9yKCBvcHRpb25zLnV2Q29sb3IgKTtcclxuICAgIH1cclxuICAgIGVsc2UgeyAvLyBsb29rIHVwIHZpc2libGUgY29sb3JcclxuICAgICAgY29uc3QgY29sb3JUYWJsZSA9IGdldENvbG9yVGFibGUoIG9wdGlvbnMucmVkdWNlSW50ZW5zaXR5QXRFeHRyZW1hICk7XHJcbiAgICAgIGNvbG9yID0gY29sb3JUYWJsZVsgVXRpbHMucm91bmRTeW1tZXRyaWMoIHdhdmVsZW5ndGggKSAtIFZpc2libGVDb2xvci5NSU5fV0FWRUxFTkdUSCBdO1xyXG4gICAgfVxyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbG9yLCBgY29sb3Igbm90IGZvdW5kIGZvciB3YXZlbGVuZ3RoICR7d2F2ZWxlbmd0aH1gICk7XHJcbiAgICByZXR1cm4gY29sb3I7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogQ29udmVydHMgYSBmcmVxdWVuY3kgKGluIEh6KSB0byBhIHZpc2libGUgY29sb3IuXHJcbiAgICovXHJcbiAgZnJlcXVlbmN5VG9Db2xvcjogZnVuY3Rpb24oIGZyZXF1ZW5jeTogbnVtYmVyLCBwcm92aWRlZE9wdGlvbnM/OiBXYXZlbGVuZ3RoVG9Db2xvck9wdGlvbnMgKTogQ29sb3Ige1xyXG4gICAgY29uc3Qgd2F2ZWxlbmd0aEluTWV0ZXJzID0gU1BFRURfT0ZfTElHSFQgLyBmcmVxdWVuY3k7XHJcbiAgICBjb25zdCB3YXZlbGVuZ3RoSW5OYW5vbWV0ZXJzID0gd2F2ZWxlbmd0aEluTWV0ZXJzICogMUU5O1xyXG4gICAgcmV0dXJuIFZpc2libGVDb2xvci53YXZlbGVuZ3RoVG9Db2xvciggd2F2ZWxlbmd0aEluTmFub21ldGVycywgcHJvdmlkZWRPcHRpb25zICk7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogQ29udmVydHMgYSBDb2xvciB0byBpdHMgY29ycmVzcG9uZGluZyB3YXZlbGVuZ3RoLiBSZWxpZXMgb24gYSBjb2xvciBsb29rdXAgdGFibGUgdGhhdCBpcyBpbml0aWFsaXplZCB0aGUgZmlyc3RcclxuICAgKiB0aW1lIHRoYXQgdGhpcyBtZXRob2QgaXMgY2FsbGVkLiAgQ29sb3IgbG9va3VwIGlzIGJhc2VkIG9uIFJHQiBjb21wb25lbnQgdmFsdWU7IHRoZSBhbHBoYSB2YWx1ZSBpcyBpZ25vcmVkLlxyXG4gICAqL1xyXG4gIGNvbG9yVG9XYXZlbGVuZ3RoOiBmdW5jdGlvbiggY29sb3I6IFRDb2xvclN1YnNldCwgcmVkdWNlSW50ZW5zaXR5QXRFeHRyZW1hID0gdHJ1ZSApOiBudW1iZXIge1xyXG5cclxuICAgIGNvbG9yID0gQ29sb3IudG9Db2xvciggY29sb3IgKTtcclxuXHJcbiAgICBsZXQgd2F2ZWxlbmd0aCA9IC0xO1xyXG5cclxuICAgIGlmICggY29sb3IuZXF1YWxzKCBDb2xvci5XSElURSApICkge1xyXG4gICAgICB3YXZlbGVuZ3RoID0gVmlzaWJsZUNvbG9yLldISVRFX1dBVkVMRU5HVEg7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgY29uc3QgY29sb3JUYWJsZSA9IGdldENvbG9yVGFibGUoIHJlZHVjZUludGVuc2l0eUF0RXh0cmVtYSApO1xyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBjb2xvclRhYmxlLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgIGlmICggTWF0aC5hYnMoIGNvbG9yLmdldFJlZCgpIC0gY29sb3JUYWJsZVsgaSBdLmdldFJlZCgpICkgPCBDT0xPUl9NQVRDSF9ERUxUQSAmJlxyXG4gICAgICAgICAgICAgTWF0aC5hYnMoIGNvbG9yLmdldEdyZWVuKCkgLSBjb2xvclRhYmxlWyBpIF0uZ2V0R3JlZW4oKSApIDwgQ09MT1JfTUFUQ0hfREVMVEEgJiZcclxuICAgICAgICAgICAgIE1hdGguYWJzKCBjb2xvci5nZXRCbHVlKCkgLSBjb2xvclRhYmxlWyBpIF0uZ2V0Qmx1ZSgpICkgPCBDT0xPUl9NQVRDSF9ERUxUQSApIHtcclxuICAgICAgICAgIHdhdmVsZW5ndGggPSBWaXNpYmxlQ29sb3IuTUlOX1dBVkVMRU5HVEggKyBpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggd2F2ZWxlbmd0aCAhPT0gLTEsIGBubyB3YXZlbGVuZ3RoIGZvdW5kIGZvciBjb2xvciAke2NvbG9yLnRvU3RyaW5nKCl9YCApO1xyXG4gICAgcmV0dXJuIHdhdmVsZW5ndGg7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZXMgYSB0YWJsZSB0aGF0IGlzIHVzZWQgdG8gbWFwIHdhdmVsZW5ndGggKGluIG5tKSB0byBDb2xvci5cclxuICogQHBhcmFtIHJlZHVjZUludGVuc2l0eUF0RXh0cmVtYSAtIHdoZXRoZXIgdGhlIGludGVuc2l0eSBzaG91bGQgYmUgcmVkdWNlZCBhbmQgaGlnaCBhbmQgbG93IHdhdmVsZW5ndGhcclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZUNvbG9yVGFibGUoIHJlZHVjZUludGVuc2l0eUF0RXh0cmVtYTogYm9vbGVhbiApOiBDb2xvcltdIHtcclxuXHJcbiAgY29uc3QgY29sb3JUYWJsZSA9IFtdO1xyXG5cclxuICAvLyBBbGxvY2F0ZSB0aGUgbG9va3VwIHRhYmxlXHJcbiAgY29uc3QgbnVtV2F2ZWxlbmd0aHMgPSBNYXRoLmZsb29yKCBWaXNpYmxlQ29sb3IuTUFYX1dBVkVMRU5HVEggLSBWaXNpYmxlQ29sb3IuTUlOX1dBVkVMRU5HVEggKyAxICk7XHJcblxyXG4gIC8vIFBvcHVsYXRlIHRoZSBsb29rdXAgdGFibGVcclxuICBsZXQgd2F2ZWxlbmd0aDtcclxuICBsZXQgcjtcclxuICBsZXQgZztcclxuICBsZXQgYjtcclxuICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBudW1XYXZlbGVuZ3RoczsgaSsrICkge1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgUkdCIGNvbXBvbmVudCB2YWx1ZXMuXHJcbiAgICB3YXZlbGVuZ3RoID0gVmlzaWJsZUNvbG9yLk1JTl9XQVZFTEVOR1RIICsgaTtcclxuICAgIHIgPSBnID0gYiA9IDA7XHJcblxyXG4gICAgLy8gRGV0ZXJtaW5lIHRoZSBSR0IgY29tcG9uZW50IHZhbHVlcy5cclxuICAgIGlmICggd2F2ZWxlbmd0aCA+PSAzODAgJiYgd2F2ZWxlbmd0aCA8PSA0NDAgKSB7XHJcbiAgICAgIHIgPSAtMSAqICggd2F2ZWxlbmd0aCAtIDQ0MCApIC8gKCA0NDAgLSAzODAgKTtcclxuICAgICAgZyA9IDA7XHJcbiAgICAgIGIgPSAxO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIHdhdmVsZW5ndGggPiA0NDAgJiYgd2F2ZWxlbmd0aCA8PSA0OTAgKSB7XHJcbiAgICAgIHIgPSAwO1xyXG4gICAgICBnID0gKCB3YXZlbGVuZ3RoIC0gNDQwICkgLyAoIDQ5MCAtIDQ0MCApO1xyXG4gICAgICBiID0gMTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCB3YXZlbGVuZ3RoID4gNDkwICYmIHdhdmVsZW5ndGggPD0gNTEwICkge1xyXG4gICAgICByID0gMDtcclxuICAgICAgZyA9IDE7XHJcbiAgICAgIGIgPSAtMSAqICggd2F2ZWxlbmd0aCAtIDUxMCApIC8gKCA1MTAgLSA0OTAgKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCB3YXZlbGVuZ3RoID4gNTEwICYmIHdhdmVsZW5ndGggPD0gNTgwICkge1xyXG4gICAgICByID0gKCB3YXZlbGVuZ3RoIC0gNTEwICkgLyAoIDU4MCAtIDUxMCApO1xyXG4gICAgICBnID0gMTtcclxuICAgICAgYiA9IDA7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggd2F2ZWxlbmd0aCA+IDU4MCAmJiB3YXZlbGVuZ3RoIDw9IDY0NSApIHtcclxuICAgICAgciA9IDE7XHJcbiAgICAgIGcgPSAtMSAqICggd2F2ZWxlbmd0aCAtIDY0NSApIC8gKCA2NDUgLSA1ODAgKTtcclxuICAgICAgYiA9IDA7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggd2F2ZWxlbmd0aCA+IDY0NSAmJiB3YXZlbGVuZ3RoIDw9IDc4MCApIHtcclxuICAgICAgciA9IDE7XHJcbiAgICAgIGcgPSAwO1xyXG4gICAgICBiID0gMDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBMZXQgdGhlIGludGVuc2l0eSBmYWxsIG9mZiBuZWFyIHRoZSB2aXNpb24gbGltaXRzLlxyXG4gICAgbGV0IGludGVuc2l0eTtcclxuICAgIGlmICggcmVkdWNlSW50ZW5zaXR5QXRFeHRyZW1hICYmIHdhdmVsZW5ndGggPiA2NDUgKSB7XHJcbiAgICAgIGludGVuc2l0eSA9IDAuMyArIDAuNyAqICggNzgwIC0gd2F2ZWxlbmd0aCApIC8gKCA3ODAgLSA2NDUgKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCByZWR1Y2VJbnRlbnNpdHlBdEV4dHJlbWEgJiYgd2F2ZWxlbmd0aCA8IDQyMCApIHtcclxuICAgICAgaW50ZW5zaXR5ID0gMC4zICsgMC43ICogKCB3YXZlbGVuZ3RoIC0gMzgwICkgLyAoIDQyMCAtIDM4MCApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGludGVuc2l0eSA9IDE7XHJcbiAgICB9XHJcbiAgICBjb25zdCByZWQgPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggMjU1ICogKCBpbnRlbnNpdHkgKiByICkgKTtcclxuICAgIGNvbnN0IGdyZWVuID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIDI1NSAqICggaW50ZW5zaXR5ICogZyApICk7XHJcbiAgICBjb25zdCBibHVlID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIDI1NSAqICggaW50ZW5zaXR5ICogYiApICk7XHJcbiAgICBjb25zdCBhbHBoYSA9IDE7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBjb2xvciB0byB0aGUgbG9va3VwIGFycmF5LlxyXG4gICAgY29sb3JUYWJsZVsgaSBdID0gbmV3IENvbG9yKCByZWQsIGdyZWVuLCBibHVlLCBhbHBoYSApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNvbG9yVGFibGU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEZXRlcm1pbmVzIHdoaWNoIGNvbG9yIHRhYmxlIHRvIHVzZSBiYXNlZCBvbiB0aGUgb3B0aW9ucy4gIFRoaXMgYXNzdW1lcyBvcHRpb25zIGhhdmUgYmVlbiBmaWxsZWQgaW4gYnkgdGhlIGNhbGxcclxuICogc2l0ZSwgaGVuY2UgdXNlcyBjb25maWcgaW5zdGVhZCBvZiBvcHRpb25zLlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0Q29sb3JUYWJsZSggcmVkdWNlSW50ZW5zaXR5QXRFeHRyZW1hOiBib29sZWFuICk6IENvbG9yW10ge1xyXG4gIGlmICggcmVkdWNlSW50ZW5zaXR5QXRFeHRyZW1hICkge1xyXG5cclxuICAgIC8vIGNhY2hlIGZvciBmdXR1cmUgdXNlXHJcbiAgICBSRURVQ0VEX0lOVEVOU0lUWV9DT0xPUl9UQUJMRSA9IFJFRFVDRURfSU5URU5TSVRZX0NPTE9SX1RBQkxFIHx8IGNyZWF0ZUNvbG9yVGFibGUoIHRydWUgKTtcclxuICAgIHJldHVybiBSRURVQ0VEX0lOVEVOU0lUWV9DT0xPUl9UQUJMRTtcclxuICB9XHJcbiAgZWxzZSB7XHJcblxyXG4gICAgLy8gY2FjaGUgZm9yIGZ1dHVyZSB1c2VcclxuICAgIEZVTExfSU5URU5TSVRZX0NPTE9SX1RBQkxFID0gRlVMTF9JTlRFTlNJVFlfQ09MT1JfVEFCTEUgfHwgY3JlYXRlQ29sb3JUYWJsZSggZmFsc2UgKTtcclxuICAgIHJldHVybiBGVUxMX0lOVEVOU0lUWV9DT0xPUl9UQUJMRTtcclxuICB9XHJcbn1cclxuXHJcbnNjZW5lcnlQaGV0LnJlZ2lzdGVyKCAnVmlzaWJsZUNvbG9yJywgVmlzaWJsZUNvbG9yICk7XHJcbmV4cG9ydCBkZWZhdWx0IFZpc2libGVDb2xvcjsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxLQUFLLE1BQU0sdUJBQXVCO0FBQ3pDLE9BQU9DLFNBQVMsTUFBTSxpQ0FBaUM7QUFDdkQsU0FBU0MsS0FBSyxRQUFRLDZCQUE2QjtBQUNuRCxPQUFPQyxXQUFXLE1BQU0sa0JBQWtCOztBQUUxQztBQUNBLE1BQU1DLGlCQUFpQixHQUFHLENBQUMsQ0FB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