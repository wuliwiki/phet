// Copyright 2019-2022, University of Colorado Boulder

/**
 * A type of spinner UI component that supports 'fine' and 'coarse' changes to a numeric value.
 *
 *   <  <<  [ value ]  >>  >
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import InstanceRegistry from '../../phet-core/js/documentation/InstanceRegistry.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import { HBox, Node } from '../../scenery/js/imports.js';
import ArrowButton from '../../sun/js/buttons/ArrowButton.js';
import Tandem from '../../tandem/js/Tandem.js';
import NumberDisplay from './NumberDisplay.js';
import sceneryPhet from './sceneryPhet.js';
export default class FineCoarseSpinner extends Node {
  constructor(numberProperty, providedOptions) {
    const options = optionize()({
      // SelfOptions
      deltaFine: 1,
      deltaCoarse: 10,
      spacing: 10,
      // NodeOptions
      disabledOpacity: 0.5,
      // {number} opacity used to make the control look disabled
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'Spinner',
      phetioEnabledPropertyInstrumented: true
    }, providedOptions);
    const range = numberProperty.range;
    assert && assert(options.deltaFine > 0, `invalid deltaFine: ${options.deltaFine}`);
    assert && assert(options.deltaCoarse > 0, `invalid deltaCoarse: ${options.deltaCoarse}`);

    // options for the 'fine' arrow buttons, which show 1 arrow
    const fineButtonOptions = combineOptions({
      numberOfArrows: 1,
      arrowWidth: 12,
      // width of base
      arrowHeight: 14,
      // from tip to base

      // pointer areas
      touchAreaXDilation: 3,
      touchAreaYDilation: 3,
      mouseAreaXDilation: 0,
      mouseAreaYDilation: 0,
      // phet-io, as requested in https://github.com/phetsims/sun/issues/575
      enabledPropertyOptions: {
        phetioReadOnly: true,
        phetioFeatured: false
      }
    }, options.arrowButtonOptions);
    assert && assert(fineButtonOptions.arrowHeight !== undefined);
    const fineButtonArrowHeight = fineButtonOptions.arrowHeight;

    // options for the 'coarse' arrow buttons, which show 2 arrows
    const coarseButtonOptions = combineOptions({}, fineButtonOptions, {
      numberOfArrows: 2,
      arrowSpacing: -0.5 * fineButtonArrowHeight,
      // arrows overlap

      // phet-io, as requested in https://github.com/phetsims/sun/issues/575
      enabledPropertyOptions: {
        phetioReadOnly: true,
        phetioFeatured: false
      }
    });

    // <
    const decrementFineButton = new ArrowButton('left', () => {
      numberProperty.value = numberProperty.value - options.deltaFine;
    }, combineOptions({}, fineButtonOptions, {
      tandem: options.tandem.createTandem('decrementFineButton')
    }));

    // <<
    const decrementCoarseButton = new ArrowButton('left', () => {
      const delta = Math.min(options.deltaCoarse, numberProperty.value - range.min);
      numberProperty.value = numberProperty.value - delta;
    }, combineOptions({}, coarseButtonOptions, {
      tandem: options.tandem.createTandem('decrementCoarseButton')
    }));

    // [ value ]
    const numberDisplay = new NumberDisplay(numberProperty, range, combineOptions({
      tandem: options.tandem.createTandem('numberDisplay')
    }, options.numberDisplayOptions));

    // >
    const incrementFineButton = new ArrowButton('right', () => {
      numberProperty.value = numberProperty.value + options.deltaFine;
    }, combineOptions({}, fineButtonOptions, {
      tandem: options.tandem.createTandem('incrementFineButton')
    }));

    // >>
    const incrementCoarseButton = new ArrowButton('right', () => {
      const delta = Math.min(options.deltaCoarse, range.max - numberProperty.value);
      numberProperty.value = numberProperty.value + delta;
    }, combineOptions({}, coarseButtonOptions, {
      tandem: options.tandem.createTandem('incrementCoarseButton')
    }));

    // <  <<  [ value ]  >>  >
    const hBox = new HBox({
      spacing: options.spacing,
      children: [decrementFineButton, decrementCoarseButton, numberDisplay, incrementCoarseButton, incrementFineButton]
    });

    // Wrap in Node to hide HBox API.
    options.children = [hBox];
    super(options);

    // Disable the buttons when the value is at min or max of the range
    const numberPropertyListener = value => {
      // left buttons
      decrementFineButton.enabled = decrementCoarseButton.enabled = value !== range.min;

      // right buttons
      incrementFineButton.enabled = incrementCoarseButton.enabled = value !== range.max;
    };
    numberProperty.link(numberPropertyListener); // unlink required in dispose

    this.disposeFineCoarseSpinner = () => {
      if (numberProperty.hasListener(numberPropertyListener)) {
        numberProperty.unlink(numberPropertyListener);
      }

      // unregister tandems
      numberDisplay.dispose();
      decrementFineButton.dispose();
      decrementCoarseButton.dispose();
      incrementFineButton.dispose();
      incrementCoarseButton.dispose();
    };

    // Create a link to associated Property, so it's easier to find in Studio.
    this.addLinkedElement(numberProperty, {
      tandem: options.tandem.createTandem('property')
    });

    // support for binder documentation, stripped out in builds and only runs when ?binder is specified
    assert && phet.chipper.queryParameters.binder && InstanceRegistry.registerDataURL('scenery-phet', 'FineCoarseSpinner', this);
  }
  dispose() {
    this.disposeFineCoarseSpinner();
    super.dispose();
  }
}
sceneryPhet.register('FineCoarseSpinner', FineCoarseSpinner);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJJbnN0YW5jZVJlZ2lzdHJ5Iiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJIQm94IiwiTm9kZSIsIkFycm93QnV0dG9uIiwiVGFuZGVtIiwiTnVtYmVyRGlzcGxheSIsInNjZW5lcnlQaGV0IiwiRmluZUNvYXJzZVNwaW5uZXIiLCJjb25zdHJ1Y3RvciIsIm51bWJlclByb3BlcnR5IiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImRlbHRhRmluZSIsImRlbHRhQ29hcnNlIiwic3BhY2luZyIsImRpc2FibGVkT3BhY2l0eSIsInRhbmRlbSIsIlJFUVVJUkVEIiwidGFuZGVtTmFtZVN1ZmZpeCIsInBoZXRpb0VuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZCIsInJhbmdlIiwiYXNzZXJ0IiwiZmluZUJ1dHRvbk9wdGlvbnMiLCJudW1iZXJPZkFycm93cyIsImFycm93V2lkdGgiLCJhcnJvd0hlaWdodCIsInRvdWNoQXJlYVhEaWxhdGlvbiIsInRvdWNoQXJlYVlEaWxhdGlvbiIsIm1vdXNlQXJlYVhEaWxhdGlvbiIsIm1vdXNlQXJlYVlEaWxhdGlvbiIsImVuYWJsZWRQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9SZWFkT25seSIsInBoZXRpb0ZlYXR1cmVkIiwiYXJyb3dCdXR0b25PcHRpb25zIiwidW5kZWZpbmVkIiwiZmluZUJ1dHRvbkFycm93SGVpZ2h0IiwiY29hcnNlQnV0dG9uT3B0aW9ucyIsImFycm93U3BhY2luZyIsImRlY3JlbWVudEZpbmVCdXR0b24iLCJ2YWx1ZSIsImNyZWF0ZVRhbmRlbSIsImRlY3JlbWVudENvYXJzZUJ1dHRvbiIsImRlbHRhIiwiTWF0aCIsIm1pbiIsIm51bWJlckRpc3BsYXkiLCJudW1iZXJEaXNwbGF5T3B0aW9ucyIsImluY3JlbWVudEZpbmVCdXR0b24iLCJpbmNyZW1lbnRDb2Fyc2VCdXR0b24iLCJtYXgiLCJoQm94IiwiY2hpbGRyZW4iLCJudW1iZXJQcm9wZXJ0eUxpc3RlbmVyIiwiZW5hYmxlZCIsImxpbmsiLCJkaXNwb3NlRmluZUNvYXJzZVNwaW5uZXIiLCJoYXNMaXN0ZW5lciIsInVubGluayIsImRpc3Bvc2UiLCJhZGRMaW5rZWRFbGVtZW50IiwicGhldCIsImNoaXBwZXIiLCJxdWVyeVBhcmFtZXRlcnMiLCJiaW5kZXIiLCJyZWdpc3RlckRhdGFVUkwiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkZpbmVDb2Fyc2VTcGlubmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEEgdHlwZSBvZiBzcGlubmVyIFVJIGNvbXBvbmVudCB0aGF0IHN1cHBvcnRzICdmaW5lJyBhbmQgJ2NvYXJzZScgY2hhbmdlcyB0byBhIG51bWVyaWMgdmFsdWUuXHJcbiAqXHJcbiAqICAgPCAgPDwgIFsgdmFsdWUgXSAgPj4gID5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IEluc3RhbmNlUmVnaXN0cnkgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL2RvY3VtZW50YXRpb24vSW5zdGFuY2VSZWdpc3RyeS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgY29tYmluZU9wdGlvbnMgfSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IHsgSEJveCwgTm9kZSwgTm9kZU9wdGlvbnMgfSBmcm9tICcuLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgQXJyb3dCdXR0b24sIHsgQXJyb3dCdXR0b25PcHRpb25zIH0gZnJvbSAnLi4vLi4vc3VuL2pzL2J1dHRvbnMvQXJyb3dCdXR0b24uanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgTnVtYmVyRGlzcGxheSwgeyBOdW1iZXJEaXNwbGF5T3B0aW9ucyB9IGZyb20gJy4vTnVtYmVyRGlzcGxheS5qcyc7XHJcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuL3NjZW5lcnlQaGV0LmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgZGVsdGFGaW5lPzogbnVtYmVyOyAvLyBhbW91bnQgdG8gaW5jcmVtZW50L2RlY3JlbWVudCB3aGVuIHRoZSAnZmluZScgdHdlYWtlcnMgYXJlIHByZXNzZWRcclxuICBkZWx0YUNvYXJzZT86IG51bWJlcjsgLy8gYW1vdW50IHRvIGluY3JlbWVudC9kZWNyZW1lbnQgd2hlbiB0aGUgJ2NvYXJzZScgdHdlYWtlcnMgYXJlIHByZXNzZWRcclxuICBzcGFjaW5nPzogbnVtYmVyOyAvLyBob3Jpem9udGFsIHNwYWNlIGJldHdlZW4gc3ViY29tcG9uZW50c1xyXG4gIG51bWJlckRpc3BsYXlPcHRpb25zPzogU3RyaWN0T21pdDxOdW1iZXJEaXNwbGF5T3B0aW9ucywgJ3RhbmRlbSc+O1xyXG4gIGFycm93QnV0dG9uT3B0aW9ucz86IFN0cmljdE9taXQ8QXJyb3dCdXR0b25PcHRpb25zLCAnbnVtYmVyT2ZBcnJvd3MnIHwgJ3RhbmRlbSc+O1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgRmluZUNvYXJzZVNwaW5uZXJPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PE5vZGVPcHRpb25zLCAnY2hpbGRyZW4nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZpbmVDb2Fyc2VTcGlubmVyIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZUZpbmVDb2Fyc2VTcGlubmVyOiAoKSA9PiB2b2lkO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG51bWJlclByb3BlcnR5OiBOdW1iZXJQcm9wZXJ0eSwgcHJvdmlkZWRPcHRpb25zPzogRmluZUNvYXJzZVNwaW5uZXJPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8RmluZUNvYXJzZVNwaW5uZXJPcHRpb25zLFxyXG4gICAgICBTdHJpY3RPbWl0PFNlbGZPcHRpb25zLCAnbnVtYmVyRGlzcGxheU9wdGlvbnMnIHwgJ2Fycm93QnV0dG9uT3B0aW9ucyc+LCBOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgZGVsdGFGaW5lOiAxLFxyXG4gICAgICBkZWx0YUNvYXJzZTogMTAsXHJcbiAgICAgIHNwYWNpbmc6IDEwLFxyXG5cclxuICAgICAgLy8gTm9kZU9wdGlvbnNcclxuICAgICAgZGlzYWJsZWRPcGFjaXR5OiAwLjUsIC8vIHtudW1iZXJ9IG9wYWNpdHkgdXNlZCB0byBtYWtlIHRoZSBjb250cm9sIGxvb2sgZGlzYWJsZWRcclxuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRUQsXHJcbiAgICAgIHRhbmRlbU5hbWVTdWZmaXg6ICdTcGlubmVyJyxcclxuICAgICAgcGhldGlvRW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkOiB0cnVlXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCByYW5nZSA9IG51bWJlclByb3BlcnR5LnJhbmdlO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMuZGVsdGFGaW5lID4gMCwgYGludmFsaWQgZGVsdGFGaW5lOiAke29wdGlvbnMuZGVsdGFGaW5lfWAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMuZGVsdGFDb2Fyc2UgPiAwLCBgaW52YWxpZCBkZWx0YUNvYXJzZTogJHtvcHRpb25zLmRlbHRhQ29hcnNlfWAgKTtcclxuXHJcbiAgICAvLyBvcHRpb25zIGZvciB0aGUgJ2ZpbmUnIGFycm93IGJ1dHRvbnMsIHdoaWNoIHNob3cgMSBhcnJvd1xyXG4gICAgY29uc3QgZmluZUJ1dHRvbk9wdGlvbnM6IEFycm93QnV0dG9uT3B0aW9ucyA9IGNvbWJpbmVPcHRpb25zPEFycm93QnV0dG9uT3B0aW9ucz4oIHtcclxuICAgICAgbnVtYmVyT2ZBcnJvd3M6IDEsXHJcbiAgICAgIGFycm93V2lkdGg6IDEyLCAvLyB3aWR0aCBvZiBiYXNlXHJcbiAgICAgIGFycm93SGVpZ2h0OiAxNCwgLy8gZnJvbSB0aXAgdG8gYmFzZVxyXG5cclxuICAgICAgLy8gcG9pbnRlciBhcmVhc1xyXG4gICAgICB0b3VjaEFyZWFYRGlsYXRpb246IDMsXHJcbiAgICAgIHRvdWNoQXJlYVlEaWxhdGlvbjogMyxcclxuICAgICAgbW91c2VBcmVhWERpbGF0aW9uOiAwLFxyXG4gICAgICBtb3VzZUFyZWFZRGlsYXRpb246IDAsXHJcblxyXG4gICAgICAvLyBwaGV0LWlvLCBhcyByZXF1ZXN0ZWQgaW4gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3N1bi9pc3N1ZXMvNTc1XHJcbiAgICAgIGVuYWJsZWRQcm9wZXJ0eU9wdGlvbnM6IHtcclxuICAgICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZSxcclxuICAgICAgICBwaGV0aW9GZWF0dXJlZDogZmFsc2VcclxuICAgICAgfVxyXG4gICAgfSwgb3B0aW9ucy5hcnJvd0J1dHRvbk9wdGlvbnMgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmaW5lQnV0dG9uT3B0aW9ucy5hcnJvd0hlaWdodCAhPT0gdW5kZWZpbmVkICk7XHJcbiAgICBjb25zdCBmaW5lQnV0dG9uQXJyb3dIZWlnaHQgPSBmaW5lQnV0dG9uT3B0aW9ucy5hcnJvd0hlaWdodCE7XHJcblxyXG4gICAgLy8gb3B0aW9ucyBmb3IgdGhlICdjb2Fyc2UnIGFycm93IGJ1dHRvbnMsIHdoaWNoIHNob3cgMiBhcnJvd3NcclxuICAgIGNvbnN0IGNvYXJzZUJ1dHRvbk9wdGlvbnMgPSBjb21iaW5lT3B0aW9uczxBcnJvd0J1dHRvbk9wdGlvbnM+KCB7fSwgZmluZUJ1dHRvbk9wdGlvbnMsIHtcclxuICAgICAgbnVtYmVyT2ZBcnJvd3M6IDIsXHJcbiAgICAgIGFycm93U3BhY2luZzogLTAuNSAqIGZpbmVCdXR0b25BcnJvd0hlaWdodCwgLy8gYXJyb3dzIG92ZXJsYXBcclxuXHJcbiAgICAgIC8vIHBoZXQtaW8sIGFzIHJlcXVlc3RlZCBpbiBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc3VuL2lzc3Vlcy81NzVcclxuICAgICAgZW5hYmxlZFByb3BlcnR5T3B0aW9uczoge1xyXG4gICAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlLFxyXG4gICAgICAgIHBoZXRpb0ZlYXR1cmVkOiBmYWxzZVxyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gPFxyXG4gICAgY29uc3QgZGVjcmVtZW50RmluZUJ1dHRvbiA9IG5ldyBBcnJvd0J1dHRvbiggJ2xlZnQnLCAoICgpID0+IHtcclxuICAgICAgbnVtYmVyUHJvcGVydHkudmFsdWUgPSBudW1iZXJQcm9wZXJ0eS52YWx1ZSAtIG9wdGlvbnMuZGVsdGFGaW5lO1xyXG4gICAgfSApLCBjb21iaW5lT3B0aW9uczxBcnJvd0J1dHRvbk9wdGlvbnM+KCB7fSwgZmluZUJ1dHRvbk9wdGlvbnMsXHJcbiAgICAgIHsgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdkZWNyZW1lbnRGaW5lQnV0dG9uJyApIH0gKSApO1xyXG5cclxuICAgIC8vIDw8XHJcbiAgICBjb25zdCBkZWNyZW1lbnRDb2Fyc2VCdXR0b24gPSBuZXcgQXJyb3dCdXR0b24oICdsZWZ0JywgKCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGRlbHRhID0gTWF0aC5taW4oIG9wdGlvbnMuZGVsdGFDb2Fyc2UsIG51bWJlclByb3BlcnR5LnZhbHVlIC0gcmFuZ2UubWluICk7XHJcbiAgICAgIG51bWJlclByb3BlcnR5LnZhbHVlID0gbnVtYmVyUHJvcGVydHkudmFsdWUgLSBkZWx0YTtcclxuICAgIH0gKSwgY29tYmluZU9wdGlvbnM8QXJyb3dCdXR0b25PcHRpb25zPigge30sIGNvYXJzZUJ1dHRvbk9wdGlvbnMsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdkZWNyZW1lbnRDb2Fyc2VCdXR0b24nIClcclxuICAgIH0gKSApO1xyXG5cclxuICAgIC8vIFsgdmFsdWUgXVxyXG4gICAgY29uc3QgbnVtYmVyRGlzcGxheSA9IG5ldyBOdW1iZXJEaXNwbGF5KCBudW1iZXJQcm9wZXJ0eSwgcmFuZ2UsXHJcbiAgICAgIGNvbWJpbmVPcHRpb25zPE51bWJlckRpc3BsYXlPcHRpb25zPigge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnbnVtYmVyRGlzcGxheScgKVxyXG4gICAgICB9LCBvcHRpb25zLm51bWJlckRpc3BsYXlPcHRpb25zICkgKTtcclxuXHJcbiAgICAvLyA+XHJcbiAgICBjb25zdCBpbmNyZW1lbnRGaW5lQnV0dG9uID0gbmV3IEFycm93QnV0dG9uKCAncmlnaHQnLCAoICgpID0+IHtcclxuICAgICAgbnVtYmVyUHJvcGVydHkudmFsdWUgPSBudW1iZXJQcm9wZXJ0eS52YWx1ZSArIG9wdGlvbnMuZGVsdGFGaW5lO1xyXG4gICAgfSApLCBjb21iaW5lT3B0aW9uczxBcnJvd0J1dHRvbk9wdGlvbnM+KCB7fSwgZmluZUJ1dHRvbk9wdGlvbnMsXHJcbiAgICAgIHsgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdpbmNyZW1lbnRGaW5lQnV0dG9uJyApIH0gKSApO1xyXG5cclxuICAgIC8vID4+XHJcbiAgICBjb25zdCBpbmNyZW1lbnRDb2Fyc2VCdXR0b24gPSBuZXcgQXJyb3dCdXR0b24oICdyaWdodCcsICggKCkgPT4ge1xyXG4gICAgICBjb25zdCBkZWx0YSA9IE1hdGgubWluKCBvcHRpb25zLmRlbHRhQ29hcnNlLCByYW5nZS5tYXggLSBudW1iZXJQcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgICBudW1iZXJQcm9wZXJ0eS52YWx1ZSA9IG51bWJlclByb3BlcnR5LnZhbHVlICsgZGVsdGE7XHJcbiAgICB9ICksIGNvbWJpbmVPcHRpb25zPEFycm93QnV0dG9uT3B0aW9ucz4oIHt9LCBjb2Fyc2VCdXR0b25PcHRpb25zLFxyXG4gICAgICB7IHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnaW5jcmVtZW50Q29hcnNlQnV0dG9uJyApIH0gKSApO1xyXG5cclxuICAgIC8vIDwgIDw8ICBbIHZhbHVlIF0gID4+ICA+XHJcbiAgICBjb25zdCBoQm94ID0gbmV3IEhCb3goIHtcclxuICAgICAgc3BhY2luZzogb3B0aW9ucy5zcGFjaW5nLFxyXG4gICAgICBjaGlsZHJlbjogWyBkZWNyZW1lbnRGaW5lQnV0dG9uLCBkZWNyZW1lbnRDb2Fyc2VCdXR0b24sIG51bWJlckRpc3BsYXksIGluY3JlbWVudENvYXJzZUJ1dHRvbiwgaW5jcmVtZW50RmluZUJ1dHRvbiBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gV3JhcCBpbiBOb2RlIHRvIGhpZGUgSEJveCBBUEkuXHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gWyBoQm94IF07XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBEaXNhYmxlIHRoZSBidXR0b25zIHdoZW4gdGhlIHZhbHVlIGlzIGF0IG1pbiBvciBtYXggb2YgdGhlIHJhbmdlXHJcbiAgICBjb25zdCBudW1iZXJQcm9wZXJ0eUxpc3RlbmVyID0gKCB2YWx1ZTogbnVtYmVyICkgPT4ge1xyXG5cclxuICAgICAgLy8gbGVmdCBidXR0b25zXHJcbiAgICAgIGRlY3JlbWVudEZpbmVCdXR0b24uZW5hYmxlZCA9IGRlY3JlbWVudENvYXJzZUJ1dHRvbi5lbmFibGVkID0gKCB2YWx1ZSAhPT0gcmFuZ2UubWluICk7XHJcblxyXG4gICAgICAvLyByaWdodCBidXR0b25zXHJcbiAgICAgIGluY3JlbWVudEZpbmVCdXR0b24uZW5hYmxlZCA9IGluY3JlbWVudENvYXJzZUJ1dHRvbi5lbmFibGVkID0gKCB2YWx1ZSAhPT0gcmFuZ2UubWF4ICk7XHJcbiAgICB9O1xyXG4gICAgbnVtYmVyUHJvcGVydHkubGluayggbnVtYmVyUHJvcGVydHlMaXN0ZW5lciApOyAvLyB1bmxpbmsgcmVxdWlyZWQgaW4gZGlzcG9zZVxyXG5cclxuICAgIHRoaXMuZGlzcG9zZUZpbmVDb2Fyc2VTcGlubmVyID0gKCkgPT4ge1xyXG5cclxuICAgICAgaWYgKCBudW1iZXJQcm9wZXJ0eS5oYXNMaXN0ZW5lciggbnVtYmVyUHJvcGVydHlMaXN0ZW5lciApICkge1xyXG4gICAgICAgIG51bWJlclByb3BlcnR5LnVubGluayggbnVtYmVyUHJvcGVydHlMaXN0ZW5lciApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyB1bnJlZ2lzdGVyIHRhbmRlbXNcclxuICAgICAgbnVtYmVyRGlzcGxheS5kaXNwb3NlKCk7XHJcbiAgICAgIGRlY3JlbWVudEZpbmVCdXR0b24uZGlzcG9zZSgpO1xyXG4gICAgICBkZWNyZW1lbnRDb2Fyc2VCdXR0b24uZGlzcG9zZSgpO1xyXG4gICAgICBpbmNyZW1lbnRGaW5lQnV0dG9uLmRpc3Bvc2UoKTtcclxuICAgICAgaW5jcmVtZW50Q29hcnNlQnV0dG9uLmRpc3Bvc2UoKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgbGluayB0byBhc3NvY2lhdGVkIFByb3BlcnR5LCBzbyBpdCdzIGVhc2llciB0byBmaW5kIGluIFN0dWRpby5cclxuICAgIHRoaXMuYWRkTGlua2VkRWxlbWVudCggbnVtYmVyUHJvcGVydHksIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdwcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHN1cHBvcnQgZm9yIGJpbmRlciBkb2N1bWVudGF0aW9uLCBzdHJpcHBlZCBvdXQgaW4gYnVpbGRzIGFuZCBvbmx5IHJ1bnMgd2hlbiA/YmluZGVyIGlzIHNwZWNpZmllZFxyXG4gICAgYXNzZXJ0ICYmIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuYmluZGVyICYmIEluc3RhbmNlUmVnaXN0cnkucmVnaXN0ZXJEYXRhVVJMKCAnc2NlbmVyeS1waGV0JywgJ0ZpbmVDb2Fyc2VTcGlubmVyJywgdGhpcyApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VGaW5lQ29hcnNlU3Bpbm5lcigpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuc2NlbmVyeVBoZXQucmVnaXN0ZXIoICdGaW5lQ29hcnNlU3Bpbm5lcicsIEZpbmVDb2Fyc2VTcGlubmVyICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFJQSxPQUFPQSxnQkFBZ0IsTUFBTSxzREFBc0Q7QUFDbkYsT0FBT0MsU0FBUyxJQUFJQyxjQUFjLFFBQVEsaUNBQWlDO0FBQzNFLFNBQVNDLElBQUksRUFBRUMsSUFBSSxRQUFxQiw2QkFBNkI7QUFDckUsT0FBT0MsV0FBVyxNQUE4QixxQ0FBcUM7QUFDckYsT0FBT0MsTUFBTSxNQUFNLDJCQUEyQjtBQUM5QyxPQUFPQyxhQUFhLE1BQWdDLG9CQUFvQjtBQUN4RSxPQUFPQyxXQUFXLE1BQU0sa0JBQWtCO0FBWTFDLGVBQWUsTUFBTUMsaUJBQWlCLFNBQVNMLElBQUksQ0FBQztFQUkzQ00sV0FBV0EsQ0FBRUMsY0FBOEIsRUFBRUMsZUFBMEMsRUFBRztJQUUvRixNQUFNQyxPQUFPLEdBQUdaLFNBQVMsQ0FDOEQsQ0FBQyxDQUFFO01BRXhGO01BQ0FhLFNBQVMsRUFBRSxDQUFDO01BQ1pDLFdBQVcsRUFBRSxFQUFFO01BQ2ZDLE9BQU8sRUFBRSxFQUFFO01BRVg7TUFDQUMsZUFBZSxFQUFFLEdBQUc7TUFBRTtNQUN0QkMsTUFBTSxFQUFFWixNQUFNLENB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