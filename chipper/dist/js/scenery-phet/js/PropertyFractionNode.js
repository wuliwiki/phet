// Copyright 2019-2022, University of Colorado Boulder

/**
 * Displays a fraction based on a numerator/denominator Property pair.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import EnumerationDeprecated from '../../phet-core/js/EnumerationDeprecated.js';
import merge from '../../phet-core/js/merge.js';
import MixedFractionNode from './MixedFractionNode.js';
import sceneryPhet from './sceneryPhet.js';
class PropertyFractionNode extends MixedFractionNode {
  /**
   * @param {Property.<number>} numeratorProperty
   * @param {Property.<number>} denominatorProperty
   * @param {Object} [options]
   */
  constructor(numeratorProperty, denominatorProperty, options) {
    options = merge({
      // {PropertyFractionNode.DisplayType}
      type: PropertyFractionNode.DisplayType.IMPROPER,
      // {boolean}
      simplify: false,
      // {boolean}
      showZeroImproperFraction: true
    }, options);
    assert && assert(PropertyFractionNode.DisplayType.includes(options.type));
    assert && assert(typeof options.simplify === 'boolean');
    super(options);

    // @private {Property.<number>}
    this.numeratorProperty = numeratorProperty;
    this.denominatorProperty = denominatorProperty;

    // @private {function}
    this.propertyListener = this.updateFromProperties.bind(this);

    // @private {PropertyFractionNode.DisplayType}
    this.type = options.type;

    // @private {boolean}
    this.simplify = options.simplify;
    this.showZeroImproperFraction = options.showZeroImproperFraction;
    this.numeratorProperty.lazyLink(this.propertyListener);
    this.denominatorProperty.lazyLink(this.propertyListener);
    this.updateFromProperties();
  }

  /**
   * Updates our display based on our Property values.
   * @private
   */
  updateFromProperties() {
    const numerator = this.numeratorProperty.value;
    const denominator = this.denominatorProperty.value;
    const hasWhole = this.type === PropertyFractionNode.DisplayType.IMPROPER || !this.simplify || numerator === 0 || numerator >= denominator;
    const hasFraction = this.type === PropertyFractionNode.DisplayType.IMPROPER || !this.simplify || (this.showZeroImproperFraction ? numerator > 0 : numerator % denominator !== 0);
    this.denominator = hasFraction ? denominator : null;
    if (this.type === PropertyFractionNode.DisplayType.MIXED) {
      this.whole = hasWhole ? Math.floor(numerator / denominator) : null;
      this.numerator = hasFraction ? numerator % denominator : null;
    } else {
      this.numerator = numerator;
    }
  }

  /**
   * Releases references.
   * @public
   * @override
   */
  dispose() {
    this.numeratorProperty.unlink(this.propertyListener);
    this.denominatorProperty.unlink(this.propertyListener);
    super.dispose();
  }
}

// @public {EnumerationDeprecated}
PropertyFractionNode.DisplayType = EnumerationDeprecated.byKeys(['IMPROPER',
// e.g. 3/2
'MIXED' // e.g. 1 1/2
]);

sceneryPhet.register('PropertyFractionNode', PropertyFractionNode);
export default PropertyFractionNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFbnVtZXJhdGlvbkRlcHJlY2F0ZWQiLCJtZXJnZSIsIk1peGVkRnJhY3Rpb25Ob2RlIiwic2NlbmVyeVBoZXQiLCJQcm9wZXJ0eUZyYWN0aW9uTm9kZSIsImNvbnN0cnVjdG9yIiwibnVtZXJhdG9yUHJvcGVydHkiLCJkZW5vbWluYXRvclByb3BlcnR5Iiwib3B0aW9ucyIsInR5cGUiLCJEaXNwbGF5VHlwZSIsIklNUFJPUEVSIiwic2ltcGxpZnkiLCJzaG93WmVyb0ltcHJvcGVyRnJhY3Rpb24iLCJhc3NlcnQiLCJpbmNsdWRlcyIsInByb3BlcnR5TGlzdGVuZXIiLCJ1cGRhdGVGcm9tUHJvcGVydGllcyIsImJpbmQiLCJsYXp5TGluayIsIm51bWVyYXRvciIsInZhbHVlIiwiZGVub21pbmF0b3IiLCJoYXNXaG9sZSIsImhhc0ZyYWN0aW9uIiwiTUlYRUQiLCJ3aG9sZSIsIk1hdGgiLCJmbG9vciIsImRpc3Bvc2UiLCJ1bmxpbmsiLCJieUtleXMiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlByb3BlcnR5RnJhY3Rpb25Ob2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIERpc3BsYXlzIGEgZnJhY3Rpb24gYmFzZWQgb24gYSBudW1lcmF0b3IvZGVub21pbmF0b3IgUHJvcGVydHkgcGFpci5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBFbnVtZXJhdGlvbkRlcHJlY2F0ZWQgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL0VudW1lcmF0aW9uRGVwcmVjYXRlZC5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgTWl4ZWRGcmFjdGlvbk5vZGUgZnJvbSAnLi9NaXhlZEZyYWN0aW9uTm9kZS5qcyc7XHJcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuL3NjZW5lcnlQaGV0LmpzJztcclxuXHJcbmNsYXNzIFByb3BlcnR5RnJhY3Rpb25Ob2RlIGV4dGVuZHMgTWl4ZWRGcmFjdGlvbk5vZGUge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPG51bWJlcj59IG51bWVyYXRvclByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48bnVtYmVyPn0gZGVub21pbmF0b3JQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbnVtZXJhdG9yUHJvcGVydHksIGRlbm9taW5hdG9yUHJvcGVydHksIG9wdGlvbnMgKSB7XHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuICAgICAgLy8ge1Byb3BlcnR5RnJhY3Rpb25Ob2RlLkRpc3BsYXlUeXBlfVxyXG4gICAgICB0eXBlOiBQcm9wZXJ0eUZyYWN0aW9uTm9kZS5EaXNwbGF5VHlwZS5JTVBST1BFUixcclxuXHJcbiAgICAgIC8vIHtib29sZWFufVxyXG4gICAgICBzaW1wbGlmeTogZmFsc2UsXHJcblxyXG4gICAgICAvLyB7Ym9vbGVhbn1cclxuICAgICAgc2hvd1plcm9JbXByb3BlckZyYWN0aW9uOiB0cnVlXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggUHJvcGVydHlGcmFjdGlvbk5vZGUuRGlzcGxheVR5cGUuaW5jbHVkZXMoIG9wdGlvbnMudHlwZSApICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0eXBlb2Ygb3B0aW9ucy5zaW1wbGlmeSA9PT0gJ2Jvb2xlYW4nICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7UHJvcGVydHkuPG51bWJlcj59XHJcbiAgICB0aGlzLm51bWVyYXRvclByb3BlcnR5ID0gbnVtZXJhdG9yUHJvcGVydHk7XHJcbiAgICB0aGlzLmRlbm9taW5hdG9yUHJvcGVydHkgPSBkZW5vbWluYXRvclByb3BlcnR5O1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtmdW5jdGlvbn1cclxuICAgIHRoaXMucHJvcGVydHlMaXN0ZW5lciA9IHRoaXMudXBkYXRlRnJvbVByb3BlcnRpZXMuYmluZCggdGhpcyApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtQcm9wZXJ0eUZyYWN0aW9uTm9kZS5EaXNwbGF5VHlwZX1cclxuICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7Ym9vbGVhbn1cclxuICAgIHRoaXMuc2ltcGxpZnkgPSBvcHRpb25zLnNpbXBsaWZ5O1xyXG4gICAgdGhpcy5zaG93WmVyb0ltcHJvcGVyRnJhY3Rpb24gPSBvcHRpb25zLnNob3daZXJvSW1wcm9wZXJGcmFjdGlvbjtcclxuXHJcbiAgICB0aGlzLm51bWVyYXRvclByb3BlcnR5LmxhenlMaW5rKCB0aGlzLnByb3BlcnR5TGlzdGVuZXIgKTtcclxuICAgIHRoaXMuZGVub21pbmF0b3JQcm9wZXJ0eS5sYXp5TGluayggdGhpcy5wcm9wZXJ0eUxpc3RlbmVyICk7XHJcbiAgICB0aGlzLnVwZGF0ZUZyb21Qcm9wZXJ0aWVzKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIG91ciBkaXNwbGF5IGJhc2VkIG9uIG91ciBQcm9wZXJ0eSB2YWx1ZXMuXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICB1cGRhdGVGcm9tUHJvcGVydGllcygpIHtcclxuICAgIGNvbnN0IG51bWVyYXRvciA9IHRoaXMubnVtZXJhdG9yUHJvcGVydHkudmFsdWU7XHJcbiAgICBjb25zdCBkZW5vbWluYXRvciA9IHRoaXMuZGVub21pbmF0b3JQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICBjb25zdCBoYXNXaG9sZSA9IHRoaXMudHlwZSA9PT0gUHJvcGVydHlGcmFjdGlvbk5vZGUuRGlzcGxheVR5cGUuSU1QUk9QRVIgfHwgIXRoaXMuc2ltcGxpZnkgfHwgbnVtZXJhdG9yID09PSAwIHx8IG51bWVyYXRvciA+PSBkZW5vbWluYXRvcjtcclxuICAgIGNvbnN0IGhhc0ZyYWN0aW9uID0gdGhpcy50eXBlID09PSBQcm9wZXJ0eUZyYWN0aW9uTm9kZS5EaXNwbGF5VHlwZS5JTVBST1BFUiB8fCAhdGhpcy5zaW1wbGlmeSB8fCAoIHRoaXMuc2hvd1plcm9JbXByb3BlckZyYWN0aW9uID8gbnVtZXJhdG9yID4gMCA6ICggbnVtZXJhdG9yICUgZGVub21pbmF0b3IgIT09IDAgKSApO1xyXG5cclxuICAgIHRoaXMuZGVub21pbmF0b3IgPSBoYXNGcmFjdGlvbiA/IGRlbm9taW5hdG9yIDogbnVsbDtcclxuXHJcbiAgICBpZiAoIHRoaXMudHlwZSA9PT0gUHJvcGVydHlGcmFjdGlvbk5vZGUuRGlzcGxheVR5cGUuTUlYRUQgKSB7XHJcbiAgICAgIHRoaXMud2hvbGUgPSBoYXNXaG9sZSA/IE1hdGguZmxvb3IoIG51bWVyYXRvciAvIGRlbm9taW5hdG9yICkgOiBudWxsO1xyXG4gICAgICB0aGlzLm51bWVyYXRvciA9IGhhc0ZyYWN0aW9uID8gKCBudW1lcmF0b3IgJSBkZW5vbWluYXRvciApIDogbnVsbDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLm51bWVyYXRvciA9IG51bWVyYXRvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbGVhc2VzIHJlZmVyZW5jZXMuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqL1xyXG4gIGRpc3Bvc2UoKSB7XHJcbiAgICB0aGlzLm51bWVyYXRvclByb3BlcnR5LnVubGluayggdGhpcy5wcm9wZXJ0eUxpc3RlbmVyICk7XHJcbiAgICB0aGlzLmRlbm9taW5hdG9yUHJvcGVydHkudW5saW5rKCB0aGlzLnByb3BlcnR5TGlzdGVuZXIgKTtcclxuXHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBAcHVibGljIHtFbnVtZXJhdGlvbkRlcHJlY2F0ZWR9XHJcblByb3BlcnR5RnJhY3Rpb25Ob2RlLkRpc3BsYXlUeXBlID0gRW51bWVyYXRpb25EZXByZWNhdGVkLmJ5S2V5cyggW1xyXG4gICdJTVBST1BFUicsIC8vIGUuZy4gMy8yXHJcbiAgJ01JWEVEJyAvLyBlLmcuIDEgMS8yXHJcbl0gKTtcclxuXHJcbnNjZW5lcnlQaGV0LnJlZ2lzdGVyKCAnUHJvcGVydHlGcmFjdGlvbk5vZGUnLCBQcm9wZXJ0eUZyYWN0aW9uTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBQcm9wZXJ0eUZyYWN0aW9uTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EscUJBQXFCLE1BQU0sNkNBQTZDO0FBQy9FLE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsaUJBQWlCLE1BQU0sd0JBQXdCO0FBQ3RELE9BQU9DLFdBQVcsTUFBTSxrQkFBa0I7QUFFMUMsTUFBTUMsb0JBQW9CLFNBQVNGLGlCQUFpQixDQUFDO0VBQ25EO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRUcsV0FBV0EsQ0FBRUMsaUJBQWlCLEVBQUVDLG1CQUFtQixFQUFFQyxPQUFPLEVBQUc7SUFDN0RBLE9BQU8sR0FBR1AsS0FBSyxDQUFFO01BQ2Y7TUFDQVEsSUFBSSxFQUFFTCxvQkFBb0IsQ0FBQ00sV0FBVyxDQUFDQyxRQUFRO01BRS9DO01BQ0FDLFFBQVEsRUFBRSxLQUFLO01BRWY7TUFDQUMsd0JBQXdCLEVBQUU7SUFDNUIsQ0FBQyxFQUFFTCxPQUFRLENBQUM7SUFFWk0sTUFBTSxJQUFJQSxNQUFNLENBQUVWLG9CQUFvQixDQUFDTSxXQUFXLENBQUNLLFFBQVEsQ0FBRVAsT0FBTyxDQUFDQyxJQUFLLENBQUUsQ0FBQztJQUM3RUssTUFBTSxJQUFJQSxNQUFNLENBQUUsT0FBT04sT0FBTyxDQUFDSSxRQUFRLEtBQUssU0FBVSxDQUFDO0lBRXpE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