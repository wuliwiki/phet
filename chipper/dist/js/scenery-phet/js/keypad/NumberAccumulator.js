// Copyright 2017-2022, University of Colorado Boulder

/**
 * A key accumulator that collects user input for integer and floating point values, intended for use in conjunction
 * with the common-code keypad.
 *
 * @author Aadish Gupta
 * @author John Blanco
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import optionize from '../../../phet-core/js/optionize.js';
import Tandem from '../../../tandem/js/Tandem.js';
import NullableIO from '../../../tandem/js/types/NullableIO.js';
import NumberIO from '../../../tandem/js/types/NumberIO.js';
import StringIO from '../../../tandem/js/types/StringIO.js';
import sceneryPhet from '../sceneryPhet.js';
import AbstractKeyAccumulator from './AbstractKeyAccumulator.js';
import KeyID from './KeyID.js';

// constants
const NEGATIVE_CHAR = '\u2212';
const DECIMAL_CHAR = '.';

// Define the maximum integer that can be handled.  The portion with the explicit numeric value is necessary for IE11
// support, see https://github.com/phetsims/scenery-phet/issues/332.
const MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER || 9007199254740991;
const MAX_DIGITS = MAX_SAFE_INTEGER.toString().length - 1;
class NumberAccumulator extends AbstractKeyAccumulator {
  // string representation of the keys entered by the user

  // numerical value of the keys entered by the user

  constructor(providedOptions) {
    const options = optionize()({
      maxDigitsRightOfMantissa: 0,
      maxDigits: MAX_DIGITS,
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'NumberAccumulator'
    }, providedOptions);

    // verify option values
    assert && assert(options.maxDigits > 0 && options.maxDigits <= MAX_DIGITS, `maxDigits is out of range: ${options.maxDigits}`);
    assert && assert(options.maxDigitsRightOfMantissa >= 0 && options.maxDigitsRightOfMantissa <= options.maxDigits, `maxDigitsRightOfMantissa is out of range: ${options.maxDigitsRightOfMantissa}`);

    // Validators to be passed to AbstractKeyAccumulator
    const validators = [proposedKeys => {
      return this.getNumberOfDigits(proposedKeys) <= options.maxDigits && !(this.getNumberOfDigits(proposedKeys) === options.maxDigits && proposedKeys[proposedKeys.length - 1] === KeyID.DECIMAL) && this.getNumberOfDigitsRightOfMantissa(proposedKeys) <= options.maxDigitsRightOfMantissa;
    }];
    super(validators);
    this.stringProperty = new DerivedProperty([this.accumulatedKeysProperty], accumulatedKeys => {
      return this.keysToString(accumulatedKeys);
    }, {
      tandem: options.tandem.createTandem('stringProperty'),
      // eslint-disable-line bad-sim-text
      phetioValueType: StringIO
    });
    this.valueProperty = new DerivedProperty([this.stringProperty], stringValue => {
      return this.stringToInteger(stringValue);
    }, {
      tandem: options.tandem.createTandem('valueProperty'),
      phetioValueType: NullableIO(NumberIO)
    });
  }

  /**
   * Invoked when a key is pressed and creates proposed set of keys to be passed to the validator
   * @param keyIdentifier - identifier for the key pressed
   */
  handleKeyPressed(keyIdentifier) {
    const newArray = this.handleClearOnNextKeyPress(keyIdentifier);
    if (this.isDigit(keyIdentifier)) {
      this.removeLeadingZero(newArray);
      newArray.push(keyIdentifier);
    } else if (keyIdentifier === KeyID.BACKSPACE) {
      newArray.pop();
    } else if (keyIdentifier === KeyID.PLUS_MINUS) {
      // check if first element of array is instance of this class
      if (newArray.length > 0 && newArray[0] === KeyID.PLUS_MINUS) {
        newArray.shift();
      } else {
        newArray.unshift(keyIdentifier);
      }
    } else if (keyIdentifier === KeyID.DECIMAL) {
      if (!this.containsFloatingPoint(newArray)) {
        newArray.push(keyIdentifier);
      }
    } else {
      assert && assert(false, `unsupported keyIdentifier: ${keyIdentifier}`);
    }

    // Validate and update the keys
    this.validateKeys(newArray) && this.updateKeys(newArray);
  }

  /**
   * Removes leading zeros from the array.
   */
  removeLeadingZero(array) {
    if (this.valueProperty.get() === 0 && !this.containsFloatingPoint(array)) {
      array.pop();
    }
  }

  /**
   * Converts a set of keys to a string.
   */
  keysToString(keys) {
    let returnValue = '';
    let i = 0;

    // the plus/minus key (if present) will be first key, and indicates that the number is negative
    if (keys.length > 0 && keys[i] === KeyID.PLUS_MINUS) {
      returnValue = NEGATIVE_CHAR;
      i++;
    }

    // process remaining keys
    for (; i < keys.length; i++) {
      if (keys[i] === KeyID.DECIMAL) {
        returnValue = returnValue + DECIMAL_CHAR;
      } else {
        // the plus/minus key should be first if present
        assert && assert(this.isDigit(keys[i]), 'unexpected key type');
        returnValue = returnValue + keys[i];
      }
    }
    return returnValue;
  }

  /**
   * Converts a string representation to a number.
   */
  stringToInteger(stringValue) {
    let returnValue = null;

    // if stringValue contains something other than just a minus sign...
    if (stringValue.length > 0 && !(stringValue.length === 1 && stringValue.startsWith(NEGATIVE_CHAR)) && (this.getNumberOfDigitsLeftOfMantissa(this.accumulatedKeysProperty.get()) > 0 || this.getNumberOfDigitsRightOfMantissa(this.accumulatedKeysProperty.get()) > 0)) {
      // replace Unicode minus with vanilla '-', or parseInt will fail for negative numbers
      returnValue = Number(stringValue.replace(NEGATIVE_CHAR, '-').replace(DECIMAL_CHAR, '.'));
      assert && assert(!isNaN(returnValue), `invalid number: ${returnValue}`);
    }
    return returnValue;
  }

  /**
   * Gets the number of digits to the left of mantissa in the accumulator.
   */
  getNumberOfDigitsLeftOfMantissa(keys) {
    let numberOfDigits = 0;
    for (let i = 0; i < keys.length; i++) {
      if (this.isDigit(keys[i])) {
        numberOfDigits++;
      }
      if (keys[i] === KeyID.DECIMAL) {
        break;
      }
    }
    return numberOfDigits;
  }

  /**
   * Gets the number of digits to the right of mantissa in the accumulator.
   */
  getNumberOfDigitsRightOfMantissa(keys) {
    const decimalKeyIndex = keys.indexOf(KeyID.DECIMAL);
    let numberOfDigits = 0;
    if (decimalKeyIndex >= 0) {
      for (let i = decimalKeyIndex; i < keys.length; i++) {
        if (this.isDigit(keys[i])) {
          numberOfDigits++;
        }
      }
    }
    return numberOfDigits;
  }

  /**
   * Gets the number of digits in the accumulator.
   */
  getNumberOfDigits(keys) {
    let numberOfDigits = 0;
    for (let i = 0; i < keys.length; i++) {
      if (this.isDigit(keys[i])) {
        numberOfDigits++;
      }
    }
    return numberOfDigits;
  }

  /**
   * Gets the number of digits in the accumulator.
   */
  containsFloatingPoint(keys) {
    return keys.includes(KeyID.DECIMAL);
  }

  /**
   * Returns whether the character is valid digit or not
   */
  isDigit(char) {
    return char >= '0' && char <= '9';
  }

  /**
   * clear the accumulator
   */
  clear() {
    super.clear();
    this.setClearOnNextKeyPress(false);
  }
  dispose() {
    this.valueProperty.dispose();
    this.stringProperty.dispose();
    super.dispose();
  }
}
sceneryPhet.register('NumberAccumulator', NumberAccumulator);
export default NumberAccumulator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJvcHRpb25pemUiLCJUYW5kZW0iLCJOdWxsYWJsZUlPIiwiTnVtYmVySU8iLCJTdHJpbmdJTyIsInNjZW5lcnlQaGV0IiwiQWJzdHJhY3RLZXlBY2N1bXVsYXRvciIsIktleUlEIiwiTkVHQVRJVkVfQ0hBUiIsIkRFQ0lNQUxfQ0hBUiIsIk1BWF9TQUZFX0lOVEVHRVIiLCJOdW1iZXIiLCJNQVhfRElHSVRTIiwidG9TdHJpbmciLCJsZW5ndGgiLCJOdW1iZXJBY2N1bXVsYXRvciIsImNvbnN0cnVjdG9yIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsIm1heERpZ2l0c1JpZ2h0T2ZNYW50aXNzYSIsIm1heERpZ2l0cyIsInRhbmRlbSIsIlJFUVVJUkVEIiwidGFuZGVtTmFtZVN1ZmZpeCIsImFzc2VydCIsInZhbGlkYXRvcnMiLCJwcm9wb3NlZEtleXMiLCJnZXROdW1iZXJPZkRpZ2l0cyIsIkRFQ0lNQUwiLCJnZXROdW1iZXJPZkRpZ2l0c1JpZ2h0T2ZNYW50aXNzYSIsInN0cmluZ1Byb3BlcnR5IiwiYWNjdW11bGF0ZWRLZXlzUHJvcGVydHkiLCJhY2N1bXVsYXRlZEtleXMiLCJrZXlzVG9TdHJpbmciLCJjcmVhdGVUYW5kZW0iLCJwaGV0aW9WYWx1ZVR5cGUiLCJ2YWx1ZVByb3BlcnR5Iiwic3RyaW5nVmFsdWUiLCJzdHJpbmdUb0ludGVnZXIiLCJoYW5kbGVLZXlQcmVzc2VkIiwia2V5SWRlbnRpZmllciIsIm5ld0FycmF5IiwiaGFuZGxlQ2xlYXJPbk5leHRLZXlQcmVzcyIsImlzRGlnaXQiLCJyZW1vdmVMZWFkaW5nWmVybyIsInB1c2giLCJCQUNLU1BBQ0UiLCJwb3AiLCJQTFVTX01JTlVTIiwic2hpZnQiLCJ1bnNoaWZ0IiwiY29udGFpbnNGbG9hdGluZ1BvaW50IiwidmFsaWRhdGVLZXlzIiwidXBkYXRlS2V5cyIsImFycmF5IiwiZ2V0Iiwia2V5cyIsInJldHVyblZhbHVlIiwiaSIsInN0YXJ0c1dpdGgiLCJnZXROdW1iZXJPZkRpZ2l0c0xlZnRPZk1hbnRpc3NhIiwicmVwbGFjZSIsImlzTmFOIiwibnVtYmVyT2ZEaWdpdHMiLCJkZWNpbWFsS2V5SW5kZXgiLCJpbmRleE9mIiwiaW5jbHVkZXMiLCJjaGFyIiwiY2xlYXIiLCJzZXRDbGVhck9uTmV4dEtleVByZXNzIiwiZGlzcG9zZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTnVtYmVyQWNjdW11bGF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTctMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQSBrZXkgYWNjdW11bGF0b3IgdGhhdCBjb2xsZWN0cyB1c2VyIGlucHV0IGZvciBpbnRlZ2VyIGFuZCBmbG9hdGluZyBwb2ludCB2YWx1ZXMsIGludGVuZGVkIGZvciB1c2UgaW4gY29uanVuY3Rpb25cclxuICogd2l0aCB0aGUgY29tbW9uLWNvZGUga2V5cGFkLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEFhZGlzaCBHdXB0YVxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBOdWxsYWJsZUlPIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdWxsYWJsZUlPLmpzJztcclxuaW1wb3J0IE51bWJlcklPIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdW1iZXJJTy5qcyc7XHJcbmltcG9ydCBTdHJpbmdJTyBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvU3RyaW5nSU8uanMnO1xyXG5pbXBvcnQgc2NlbmVyeVBoZXQgZnJvbSAnLi4vc2NlbmVyeVBoZXQuanMnO1xyXG5pbXBvcnQgQWJzdHJhY3RLZXlBY2N1bXVsYXRvciBmcm9tICcuL0Fic3RyYWN0S2V5QWNjdW11bGF0b3IuanMnO1xyXG5pbXBvcnQgS2V5SUQsIHsgS2V5SURWYWx1ZSB9IGZyb20gJy4vS2V5SUQuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE5FR0FUSVZFX0NIQVIgPSAnXFx1MjIxMic7XHJcbmNvbnN0IERFQ0lNQUxfQ0hBUiA9ICcuJztcclxuXHJcbi8vIERlZmluZSB0aGUgbWF4aW11bSBpbnRlZ2VyIHRoYXQgY2FuIGJlIGhhbmRsZWQuICBUaGUgcG9ydGlvbiB3aXRoIHRoZSBleHBsaWNpdCBudW1lcmljIHZhbHVlIGlzIG5lY2Vzc2FyeSBmb3IgSUUxMVxyXG4vLyBzdXBwb3J0LCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnktcGhldC9pc3N1ZXMvMzMyLlxyXG5jb25zdCBNQVhfU0FGRV9JTlRFR0VSID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgfHwgOTAwNzE5OTI1NDc0MDk5MTtcclxuY29uc3QgTUFYX0RJR0lUUyA9IE1BWF9TQUZFX0lOVEVHRVIudG9TdHJpbmcoKS5sZW5ndGggLSAxO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICBtYXhEaWdpdHNSaWdodE9mTWFudGlzc2E/OiBudW1iZXI7XHJcbiAgbWF4RGlnaXRzPzogbnVtYmVyO1xyXG4gIHRhbmRlbT86IFRhbmRlbTtcclxuICB0YW5kZW1OYW1lU3VmZml4Pzogc3RyaW5nO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgTnVtYmVyQWNjdW11bGF0b3JPcHRpb25zID0gU2VsZk9wdGlvbnM7XHJcblxyXG5jbGFzcyBOdW1iZXJBY2N1bXVsYXRvciBleHRlbmRzIEFic3RyYWN0S2V5QWNjdW11bGF0b3Ige1xyXG5cclxuICAvLyBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGtleXMgZW50ZXJlZCBieSB0aGUgdXNlclxyXG4gIHB1YmxpYyByZWFkb25seSBzdHJpbmdQcm9wZXJ0eTogUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+O1xyXG5cclxuICAvLyBudW1lcmljYWwgdmFsdWUgb2YgdGhlIGtleXMgZW50ZXJlZCBieSB0aGUgdXNlclxyXG4gIHB1YmxpYyByZWFkb25seSB2YWx1ZVByb3BlcnR5OiBSZWFkT25seVByb3BlcnR5PG51bWJlciB8IG51bGw+O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3ZpZGVkT3B0aW9ucz86IE51bWJlckFjY3VtdWxhdG9yT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPE51bWJlckFjY3VtdWxhdG9yT3B0aW9ucywgU2VsZk9wdGlvbnM+KCkoIHtcclxuICAgICAgbWF4RGlnaXRzUmlnaHRPZk1hbnRpc3NhOiAwLFxyXG4gICAgICBtYXhEaWdpdHM6IE1BWF9ESUdJVFMsXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVELFxyXG4gICAgICB0YW5kZW1OYW1lU3VmZml4OiAnTnVtYmVyQWNjdW11bGF0b3InXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyB2ZXJpZnkgb3B0aW9uIHZhbHVlc1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5tYXhEaWdpdHMgPiAwICYmIG9wdGlvbnMubWF4RGlnaXRzIDw9IE1BWF9ESUdJVFMsXHJcbiAgICAgIGBtYXhEaWdpdHMgaXMgb3V0IG9mIHJhbmdlOiAke29wdGlvbnMubWF4RGlnaXRzfWAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMubWF4RGlnaXRzUmlnaHRPZk1hbnRpc3NhID49IDAgJiYgb3B0aW9ucy5tYXhEaWdpdHNSaWdodE9mTWFudGlzc2EgPD0gb3B0aW9ucy5tYXhEaWdpdHMsXHJcbiAgICAgIGBtYXhEaWdpdHNSaWdodE9mTWFudGlzc2EgaXMgb3V0IG9mIHJhbmdlOiAke29wdGlvbnMubWF4RGlnaXRzUmlnaHRPZk1hbnRpc3NhfWAgKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0b3JzIHRvIGJlIHBhc3NlZCB0byBBYnN0cmFjdEtleUFjY3VtdWxhdG9yXHJcbiAgICBjb25zdCB2YWxpZGF0b3JzID0gW1xyXG4gICAgICAoIHByb3Bvc2VkS2V5czogS2V5SURWYWx1ZVtdICkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldE51bWJlck9mRGlnaXRzKCBwcm9wb3NlZEtleXMgKSA8PSBvcHRpb25zLm1heERpZ2l0c1xyXG4gICAgICAgICAgICAgICAmJiAhKCB0aGlzLmdldE51bWJlck9mRGlnaXRzKCBwcm9wb3NlZEtleXMgKSA9PT0gb3B0aW9ucy5tYXhEaWdpdHNcclxuICAgICAgICAgICAgICAgJiYgcHJvcG9zZWRLZXlzWyBwcm9wb3NlZEtleXMubGVuZ3RoIC0gMSBdID09PSBLZXlJRC5ERUNJTUFMIClcclxuICAgICAgICAgICAgICAgJiYgdGhpcy5nZXROdW1iZXJPZkRpZ2l0c1JpZ2h0T2ZNYW50aXNzYSggcHJvcG9zZWRLZXlzICkgPD0gb3B0aW9ucy5tYXhEaWdpdHNSaWdodE9mTWFudGlzc2E7XHJcbiAgICAgIH1cclxuICAgIF07XHJcblxyXG4gICAgc3VwZXIoIHZhbGlkYXRvcnMgKTtcclxuXHJcbiAgICB0aGlzLnN0cmluZ1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyB0aGlzLmFjY3VtdWxhdGVkS2V5c1Byb3BlcnR5IF0sIGFjY3VtdWxhdGVkS2V5cyA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLmtleXNUb1N0cmluZyggYWNjdW11bGF0ZWRLZXlzICk7XHJcbiAgICB9LCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnc3RyaW5nUHJvcGVydHknICksIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgYmFkLXNpbS10ZXh0XHJcbiAgICAgIHBoZXRpb1ZhbHVlVHlwZTogU3RyaW5nSU9cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnZhbHVlUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIHRoaXMuc3RyaW5nUHJvcGVydHkgXSwgc3RyaW5nVmFsdWUgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5zdHJpbmdUb0ludGVnZXIoIHN0cmluZ1ZhbHVlICk7XHJcbiAgICB9LCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndmFsdWVQcm9wZXJ0eScgKSxcclxuICAgICAgcGhldGlvVmFsdWVUeXBlOiBOdWxsYWJsZUlPKCBOdW1iZXJJTyApXHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbnZva2VkIHdoZW4gYSBrZXkgaXMgcHJlc3NlZCBhbmQgY3JlYXRlcyBwcm9wb3NlZCBzZXQgb2Yga2V5cyB0byBiZSBwYXNzZWQgdG8gdGhlIHZhbGlkYXRvclxyXG4gICAqIEBwYXJhbSBrZXlJZGVudGlmaWVyIC0gaWRlbnRpZmllciBmb3IgdGhlIGtleSBwcmVzc2VkXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGhhbmRsZUtleVByZXNzZWQoIGtleUlkZW50aWZpZXI6IEtleUlEVmFsdWUgKTogdm9pZCB7XHJcbiAgICBjb25zdCBuZXdBcnJheSA9IHRoaXMuaGFuZGxlQ2xlYXJPbk5leHRLZXlQcmVzcygga2V5SWRlbnRpZmllciApO1xyXG4gICAgaWYgKCB0aGlzLmlzRGlnaXQoIGtleUlkZW50aWZpZXIgKSApIHtcclxuICAgICAgdGhpcy5yZW1vdmVMZWFkaW5nWmVybyggbmV3QXJyYXkgKTtcclxuICAgICAgbmV3QXJyYXkucHVzaCgga2V5SWRlbnRpZmllciApO1xyXG5cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBrZXlJZGVudGlmaWVyID09PSBLZXlJRC5CQUNLU1BBQ0UgKSB7XHJcbiAgICAgIG5ld0FycmF5LnBvcCgpO1xyXG5cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBrZXlJZGVudGlmaWVyID09PSBLZXlJRC5QTFVTX01JTlVTICkge1xyXG4gICAgICAvLyBjaGVjayBpZiBmaXJzdCBlbGVtZW50IG9mIGFycmF5IGlzIGluc3RhbmNlIG9mIHRoaXMgY2xhc3NcclxuICAgICAgaWYgKCBuZXdBcnJheS5sZW5ndGggPiAwICYmIG5ld0FycmF5WyAwIF0gPT09IEtleUlELlBMVVNfTUlOVVMgKSB7XHJcbiAgICAgICAgbmV3QXJyYXkuc2hpZnQoKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBuZXdBcnJheS51bnNoaWZ0KCBrZXlJZGVudGlmaWVyICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBrZXlJZGVudGlmaWVyID09PSBLZXlJRC5ERUNJTUFMICkge1xyXG4gICAgICBpZiAoICF0aGlzLmNvbnRhaW5zRmxvYXRpbmdQb2ludCggbmV3QXJyYXkgKSApIHtcclxuICAgICAgICBuZXdBcnJheS5wdXNoKCBrZXlJZGVudGlmaWVyICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmYWxzZSwgYHVuc3VwcG9ydGVkIGtleUlkZW50aWZpZXI6ICR7a2V5SWRlbnRpZmllcn1gICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmFsaWRhdGUgYW5kIHVwZGF0ZSB0aGUga2V5c1xyXG4gICAgdGhpcy52YWxpZGF0ZUtleXMoIG5ld0FycmF5ICkgJiYgdGhpcy51cGRhdGVLZXlzKCBuZXdBcnJheSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVtb3ZlcyBsZWFkaW5nIHplcm9zIGZyb20gdGhlIGFycmF5LlxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVtb3ZlTGVhZGluZ1plcm8oIGFycmF5OiBLZXlJRFZhbHVlW10gKTogdm9pZCB7XHJcbiAgICBpZiAoIHRoaXMudmFsdWVQcm9wZXJ0eS5nZXQoKSA9PT0gMCAmJiAhdGhpcy5jb250YWluc0Zsb2F0aW5nUG9pbnQoIGFycmF5ICkgKSB7XHJcbiAgICAgIGFycmF5LnBvcCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29udmVydHMgYSBzZXQgb2Yga2V5cyB0byBhIHN0cmluZy5cclxuICAgKi9cclxuICBwcml2YXRlIGtleXNUb1N0cmluZygga2V5czogS2V5SURWYWx1ZVtdICk6IHN0cmluZyB7XHJcblxyXG4gICAgbGV0IHJldHVyblZhbHVlID0gJyc7XHJcbiAgICBsZXQgaSA9IDA7XHJcblxyXG4gICAgLy8gdGhlIHBsdXMvbWludXMga2V5IChpZiBwcmVzZW50KSB3aWxsIGJlIGZpcnN0IGtleSwgYW5kIGluZGljYXRlcyB0aGF0IHRoZSBudW1iZXIgaXMgbmVnYXRpdmVcclxuICAgIGlmICgga2V5cy5sZW5ndGggPiAwICYmIGtleXNbIGkgXSA9PT0gS2V5SUQuUExVU19NSU5VUyApIHtcclxuICAgICAgcmV0dXJuVmFsdWUgPSBORUdBVElWRV9DSEFSO1xyXG4gICAgICBpKys7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcHJvY2VzcyByZW1haW5pbmcga2V5c1xyXG4gICAgZm9yICggOyBpIDwga2V5cy5sZW5ndGg7IGkrKyApIHtcclxuXHJcbiAgICAgIGlmICgga2V5c1sgaSBdID09PSBLZXlJRC5ERUNJTUFMICkge1xyXG4gICAgICAgIHJldHVyblZhbHVlID0gcmV0dXJuVmFsdWUgKyBERUNJTUFMX0NIQVI7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgIC8vIHRoZSBwbHVzL21pbnVzIGtleSBzaG91bGQgYmUgZmlyc3QgaWYgcHJlc2VudFxyXG4gICAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuaXNEaWdpdCgga2V5c1sgaSBdICksICd1bmV4cGVjdGVkIGtleSB0eXBlJyApO1xyXG4gICAgICAgIHJldHVyblZhbHVlID0gcmV0dXJuVmFsdWUgKyBrZXlzWyBpIF07XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb252ZXJ0cyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiB0byBhIG51bWJlci5cclxuICAgKi9cclxuICBwcml2YXRlIHN0cmluZ1RvSW50ZWdlciggc3RyaW5nVmFsdWU6IHN0cmluZyApOiBudW1iZXIgfCBudWxsIHtcclxuICAgIGxldCByZXR1cm5WYWx1ZSA9IG51bGw7XHJcblxyXG4gICAgLy8gaWYgc3RyaW5nVmFsdWUgY29udGFpbnMgc29tZXRoaW5nIG90aGVyIHRoYW4ganVzdCBhIG1pbnVzIHNpZ24uLi5cclxuICAgIGlmICggc3RyaW5nVmFsdWUubGVuZ3RoID4gMFxyXG4gICAgICAgICAmJiAhKCBzdHJpbmdWYWx1ZS5sZW5ndGggPT09IDEgJiYgc3RyaW5nVmFsdWUuc3RhcnRzV2l0aCggTkVHQVRJVkVfQ0hBUiApIClcclxuICAgICAgICAgJiYgKCB0aGlzLmdldE51bWJlck9mRGlnaXRzTGVmdE9mTWFudGlzc2EoIHRoaXMuYWNjdW11bGF0ZWRLZXlzUHJvcGVydHkuZ2V0KCkgKSA+IDAgfHxcclxuICAgICAgICAgICAgICB0aGlzLmdldE51bWJlck9mRGlnaXRzUmlnaHRPZk1hbnRpc3NhKCB0aGlzLmFjY3VtdWxhdGVkS2V5c1Byb3BlcnR5LmdldCgpICkgPiAwICkgKSB7XHJcblxyXG4gICAgICAvLyByZXBsYWNlIFVuaWNvZGUgbWludXMgd2l0aCB2YW5pbGxhICctJywgb3IgcGFyc2VJbnQgd2lsbCBmYWlsIGZvciBuZWdhdGl2ZSBudW1iZXJzXHJcbiAgICAgIHJldHVyblZhbHVlID0gTnVtYmVyKCBzdHJpbmdWYWx1ZS5yZXBsYWNlKCBORUdBVElWRV9DSEFSLCAnLScgKS5yZXBsYWNlKCBERUNJTUFMX0NIQVIsICcuJyApICk7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoICFpc05hTiggcmV0dXJuVmFsdWUgKSwgYGludmFsaWQgbnVtYmVyOiAke3JldHVyblZhbHVlfWAgKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBudW1iZXIgb2YgZGlnaXRzIHRvIHRoZSBsZWZ0IG9mIG1hbnRpc3NhIGluIHRoZSBhY2N1bXVsYXRvci5cclxuICAgKi9cclxuICBwcml2YXRlIGdldE51bWJlck9mRGlnaXRzTGVmdE9mTWFudGlzc2EoIGtleXM6IEtleUlEVmFsdWVbXSApOiBudW1iZXIge1xyXG4gICAgbGV0IG51bWJlck9mRGlnaXRzID0gMDtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGlmICggdGhpcy5pc0RpZ2l0KCBrZXlzWyBpIF0gKSApIHtcclxuICAgICAgICBudW1iZXJPZkRpZ2l0cysrO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIGtleXNbIGkgXSA9PT0gS2V5SUQuREVDSU1BTCApIHtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bWJlck9mRGlnaXRzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyB0aGUgbnVtYmVyIG9mIGRpZ2l0cyB0byB0aGUgcmlnaHQgb2YgbWFudGlzc2EgaW4gdGhlIGFjY3VtdWxhdG9yLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0TnVtYmVyT2ZEaWdpdHNSaWdodE9mTWFudGlzc2EoIGtleXM6IEtleUlEVmFsdWVbXSApOiBudW1iZXIge1xyXG4gICAgY29uc3QgZGVjaW1hbEtleUluZGV4ID0ga2V5cy5pbmRleE9mKCBLZXlJRC5ERUNJTUFMICk7XHJcbiAgICBsZXQgbnVtYmVyT2ZEaWdpdHMgPSAwO1xyXG4gICAgaWYgKCBkZWNpbWFsS2V5SW5kZXggPj0gMCApIHtcclxuICAgICAgZm9yICggbGV0IGkgPSBkZWNpbWFsS2V5SW5kZXg7IGkgPCBrZXlzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgIGlmICggdGhpcy5pc0RpZ2l0KCBrZXlzWyBpIF0gKSApIHtcclxuICAgICAgICAgIG51bWJlck9mRGlnaXRzKys7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVtYmVyT2ZEaWdpdHM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBudW1iZXIgb2YgZGlnaXRzIGluIHRoZSBhY2N1bXVsYXRvci5cclxuICAgKi9cclxuICBwcml2YXRlIGdldE51bWJlck9mRGlnaXRzKCBrZXlzOiBLZXlJRFZhbHVlW10gKTogbnVtYmVyIHtcclxuICAgIGxldCBudW1iZXJPZkRpZ2l0cyA9IDA7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBpZiAoIHRoaXMuaXNEaWdpdCgga2V5c1sgaSBdICkgKSB7XHJcbiAgICAgICAgbnVtYmVyT2ZEaWdpdHMrKztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bWJlck9mRGlnaXRzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyB0aGUgbnVtYmVyIG9mIGRpZ2l0cyBpbiB0aGUgYWNjdW11bGF0b3IuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjb250YWluc0Zsb2F0aW5nUG9pbnQoIGtleXM6IEtleUlEVmFsdWVbXSApOiBib29sZWFuIHtcclxuICAgIHJldHVybiBrZXlzLmluY2x1ZGVzKCBLZXlJRC5ERUNJTUFMICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGNoYXJhY3RlciBpcyB2YWxpZCBkaWdpdCBvciBub3RcclxuICAgKi9cclxuICBwcml2YXRlIGlzRGlnaXQoIGNoYXI6IEtleUlEVmFsdWUgKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gY2hhciA+PSAnMCcgJiYgY2hhciA8PSAnOSc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBjbGVhciB0aGUgYWNjdW11bGF0b3JcclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgY2xlYXIoKTogdm9pZCB7XHJcbiAgICBzdXBlci5jbGVhcigpO1xyXG4gICAgdGhpcy5zZXRDbGVhck9uTmV4dEtleVByZXNzKCBmYWxzZSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLnZhbHVlUHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgdGhpcy5zdHJpbmdQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5zY2VuZXJ5UGhldC5yZWdpc3RlciggJ051bWJlckFjY3VtdWxhdG9yJywgTnVtYmVyQWNjdW11bGF0b3IgKTtcclxuZXhwb3J0IGRlZmF1bHQgTnVtYmVyQWNjdW11bGF0b3I7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSxxQ0FBcUM7QUFFakUsT0FBT0MsU0FBUyxNQUFNLG9DQUFvQztBQUMxRCxPQUFPQyxNQUFNLE1BQU0sOEJBQThCO0FBQ2pELE9BQU9DLFVBQVUsTUFBTSx3Q0FBd0M7QUFDL0QsT0FBT0MsUUFBUSxNQUFNLHNDQUFzQztBQUMzRCxPQUFPQyxRQUFRLE1BQU0sc0NBQXNDO0FBQzNELE9BQU9DLFdBQVcsTUFBTSxtQkFBbUI7QUFDM0MsT0FBT0Msc0JBQXNCLE1BQU0sNkJBQTZCO0FBQ2hFLE9BQU9DLEtBQUssTUFBc0IsWUFBWTs7QUFFOUM7QUFDQSxNQUFNQyxhQUFhLEdBQUcsUUFBUTtBQUM5QixNQUFNQyxZQUFZLEdBQUcsR0FBRzs7QUFFeEI7QUFDQTtBQUNB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