// Copyright 2016-2022, University of Colorado Boulder

/**
 * A drawer that opens/closes to show/hide its contents.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import BooleanProperty from '../../axon/js/BooleanProperty.js';
import stepTimer from '../../axon/js/stepTimer.js';
import Dimension2 from '../../dot/js/Dimension2.js';
import { Shape } from '../../kite/js/imports.js';
import InstanceRegistry from '../../phet-core/js/documentation/InstanceRegistry.js';
import optionize from '../../phet-core/js/optionize.js';
import { Node, Path, PressListener, Rectangle } from '../../scenery/js/imports.js';
import Animation from '../../twixt/js/Animation.js';
import Easing from '../../twixt/js/Easing.js';
import sceneryPhet from './sceneryPhet.js';
export default class Drawer extends Node {
  // is the drawer open?

  // what's in the drawer

  // whether the drawer animates open/closed

  /**
   * @param contentsNode - contents of the drawer
   * @param provideOptions
   */
  constructor(contentsNode, provideOptions) {
    const options = optionize()({
      // SelfOptions
      size: null,
      cornerRadius: 0,
      xMargin: 0,
      yMargin: 0,
      open: true,
      handlePosition: 'top',
      handleSize: new Dimension2(70, 20),
      handleCornerRadius: 5,
      handleFill: 'rgb( 230, 230, 230 )',
      handleTouchAreaXDilation: 0,
      handleTouchAreaYDilation: 0,
      handleMouseAreaXDilation: 0,
      handleMouseAreaYDilation: 0,
      grippyDotRadius: 1,
      grippyDotColor: 'black',
      grippyDotRows: 2,
      grippyDotColumns: 4,
      grippyDotXSpacing: 9,
      grippyDotYSpacing: 5,
      beforeOpen: () => {
        contentsNode.visible = true;
      },
      afterClose: () => {
        contentsNode.visible = false;
      },
      animationEnabled: true,
      animationDuration: 0.5,
      stepEmitter: stepTimer
    }, provideOptions);

    // size of contents, adjusted for margins
    const CONTENTS_WIDTH = contentsNode.width + 2 * options.xMargin;
    const CONTENTS_HEIGHT = contentsNode.height + 2 * options.yMargin;

    // size of container
    const CONTAINER_WIDTH = options.size ? options.size.width : CONTENTS_WIDTH;
    const CONTAINER_HEIGHT = options.size ? options.size.height : CONTENTS_HEIGHT;

    // background
    const backgroundNode = new Rectangle(0, 0, CONTAINER_WIDTH, CONTAINER_HEIGHT, {
      fill: 'white',
      cornerRadius: options.cornerRadius
    });

    // border
    const borderNode = new Rectangle(0, 0, CONTAINER_WIDTH, CONTAINER_HEIGHT, {
      stroke: 'black',
      cornerRadius: options.cornerRadius
    });

    // scale contents to fit the container
    if (options.size) {
      const scale = Math.min(1, Math.min(CONTAINER_WIDTH / CONTENTS_WIDTH, CONTAINER_HEIGHT / CONTENTS_HEIGHT));
      contentsNode.setScaleMagnitude(scale);
    }

    // handle, rectangle with top or bottom corners rounded, the other corners square
    const HANDLE_RADII = options.handlePosition === 'top' ? {
      topLeft: options.handleCornerRadius,
      topRight: options.handleCornerRadius
    } : {
      bottomLeft: options.handleCornerRadius,
      bottomRight: options.handleCornerRadius
    };
    const handleShape = Shape.roundedRectangleWithRadii(0, 0, options.handleSize.width, options.handleSize.height, HANDLE_RADII);
    const handleNode = new Path(handleShape, {
      cursor: 'pointer',
      fill: options.handleFill,
      stroke: 'black'
    });

    // grippy dots on the handle
    const grippyDotsShape = new Shape();
    let grippyX = 0;
    let grippyY = 0;
    for (let row = 0; row < options.grippyDotRows; row++) {
      for (let column = 0; column < options.grippyDotColumns; column++) {
        grippyX = column * options.grippyDotXSpacing;
        grippyY = row * options.grippyDotYSpacing;
        grippyDotsShape.moveTo(grippyX, grippyY);
        grippyDotsShape.arc(grippyX, grippyY, options.grippyDotRadius, 0, 2 * Math.PI);
      }
    }
    const grippyDotsNode = new Path(grippyDotsShape, {
      fill: options.grippyDotColor,
      center: handleNode.center
    });
    handleNode.addChild(grippyDotsNode);

    // handle pointerArea
    if (options.handleTouchAreaXDilation !== 0 || options.handleTouchAreaYDilation !== 0) {
      const touchAreaShiftY = options.handlePosition === 'top' ? -options.handleTouchAreaYDilation : options.handleTouchAreaYDilation;
      handleNode.touchArea = handleNode.localBounds.dilatedXY(options.handleTouchAreaXDilation, options.handleTouchAreaYDilation).shiftedY(touchAreaShiftY);
    }
    if (options.handleMouseAreaXDilation !== 0 || options.handleMouseAreaYDilation !== 0) {
      const mouseAreaShiftY = options.handlePosition === 'top' ? -options.handleMouseAreaYDilation : options.handleMouseAreaYDilation;
      handleNode.mouseArea = handleNode.localBounds.dilatedXY(options.handleMouseAreaXDilation, options.handleMouseAreaYDilation).shiftedY(mouseAreaShiftY);
    }

    // layout, position the handle at center-top or center-bottom
    backgroundNode.x = 0;
    handleNode.centerX = backgroundNode.centerX;
    if (options.handlePosition === 'top') {
      handleNode.top = 0;
      backgroundNode.top = handleNode.bottom - 1;
    } else {
      backgroundNode.top = 0;
      handleNode.top = backgroundNode.bottom - 1;
    }
    borderNode.center = backgroundNode.center;
    contentsNode.center = backgroundNode.center;

    // put all of the moving pieces together
    const drawerNode = new Node({
      children: [handleNode, backgroundNode, contentsNode, borderNode]
    });

    // wrap the drawer with a clipping area, to show/hide the container
    options.children = [drawerNode];
    options.clipArea = Shape.bounds(drawerNode.bounds);
    super(options);
    this.contentsNode = contentsNode;
    this._animationEnabled = options.animationEnabled;
    const yOpen = 0;
    const yClosed = options.handlePosition === 'top' ? backgroundNode.height : -backgroundNode.height;
    drawerNode.y = options.open ? yOpen : yClosed;
    let animation = null; // animation that opens/closes the drawer

    this.openProperty = new BooleanProperty(options.open);

    // click on the handle to toggle between open and closed
    handleNode.addInputListener(new PressListener({
      press: (event, trail) => this.openProperty.set(!this.openProperty.get())
    }));

    // open/close the drawer
    const openObserver = open => {
      // stop any animation that's in progress
      animation && animation.stop();
      open && options.beforeOpen && options.beforeOpen();
      if (this._animationEnabled) {
        // Animate opening and closing of the drawer.
        animation = new Animation({
          stepEmitter: options.stepEmitter,
          duration: options.animationDuration,
          easing: Easing.QUADRATIC_IN_OUT,
          setValue: value => {
            drawerNode.y = value;
          },
          getValue: () => drawerNode.y,
          to: open ? yOpen : yClosed
        });
        animation.start();
      } else {
        // animation disabled, move immediately to new state
        drawerNode.y = open ? yOpen : yClosed;
        !open && options.afterClose && options.afterClose();
      }
    };
    this.openProperty.lazyLink(openObserver); // unlink in dispose

    this.disposeDrawer = () => {
      this.openProperty.unlink(openObserver);
      this.openProperty.dispose(); // will fail if clients haven't removed observers
    };

    // support for binder documentation, stripped out in builds and only runs when ?binder is specified
    assert && phet.chipper.queryParameters.binder && InstanceRegistry.registerDataURL('scenery-phet', 'Drawer', this);
  }
  dispose() {
    this.disposeDrawer();
    super.dispose();
  }

  /**
   * @param [animationEnabled]
   */
  reset(animationEnabled) {
    animationEnabled = animationEnabled === undefined ? this.animationEnabled : animationEnabled;

    // set the drawer to it's initial open/closed state, with or without animation
    const saveAnimationEnabled = this.animationEnabled;
    this.animationEnabled = animationEnabled;
    this.openProperty.reset();
    this.animationEnabled = saveAnimationEnabled;
  }

  /**
   * Determines whether animation is enabled for opening/closing drawer.
   */
  setAnimationEnabled(animationEnabled) {
    this._animationEnabled = animationEnabled;
  }
  set animationEnabled(value) {
    this.setAnimationEnabled(value);
  }
  get animationEnabled() {
    return this.getAnimationEnabled();
  }

  /**
   * Is animation enabled for opening/closing drawer?
   */
  getAnimationEnabled() {
    return this._animationEnabled;
  }
}
sceneryPhet.register('Drawer', Drawer);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJzdGVwVGltZXIiLCJEaW1lbnNpb24yIiwiU2hhcGUiLCJJbnN0YW5jZVJlZ2lzdHJ5Iiwib3B0aW9uaXplIiwiTm9kZSIsIlBhdGgiLCJQcmVzc0xpc3RlbmVyIiwiUmVjdGFuZ2xlIiwiQW5pbWF0aW9uIiwiRWFzaW5nIiwic2NlbmVyeVBoZXQiLCJEcmF3ZXIiLCJjb25zdHJ1Y3RvciIsImNvbnRlbnRzTm9kZSIsInByb3ZpZGVPcHRpb25zIiwib3B0aW9ucyIsInNpemUiLCJjb3JuZXJSYWRpdXMiLCJ4TWFyZ2luIiwieU1hcmdpbiIsIm9wZW4iLCJoYW5kbGVQb3NpdGlvbiIsImhhbmRsZVNpemUiLCJoYW5kbGVDb3JuZXJSYWRpdXMiLCJoYW5kbGVGaWxsIiwiaGFuZGxlVG91Y2hBcmVhWERpbGF0aW9uIiwiaGFuZGxlVG91Y2hBcmVhWURpbGF0aW9uIiwiaGFuZGxlTW91c2VBcmVhWERpbGF0aW9uIiwiaGFuZGxlTW91c2VBcmVhWURpbGF0aW9uIiwiZ3JpcHB5RG90UmFkaXVzIiwiZ3JpcHB5RG90Q29sb3IiLCJncmlwcHlEb3RSb3dzIiwiZ3JpcHB5RG90Q29sdW1ucyIsImdyaXBweURvdFhTcGFjaW5nIiwiZ3JpcHB5RG90WVNwYWNpbmciLCJiZWZvcmVPcGVuIiwidmlzaWJsZSIsImFmdGVyQ2xvc2UiLCJhbmltYXRpb25FbmFibGVkIiwiYW5pbWF0aW9uRHVyYXRpb24iLCJzdGVwRW1pdHRlciIsIkNPTlRFTlRTX1dJRFRIIiwid2lkdGgiLCJDT05URU5UU19IRUlHSFQiLCJoZWlnaHQiLCJDT05UQUlORVJfV0lEVEgiLCJDT05UQUlORVJfSEVJR0hUIiwiYmFja2dyb3VuZE5vZGUiLCJmaWxsIiwiYm9yZGVyTm9kZSIsInN0cm9rZSIsInNjYWxlIiwiTWF0aCIsIm1pbiIsInNldFNjYWxlTWFnbml0dWRlIiwiSEFORExFX1JBRElJIiwidG9wTGVmdCIsInRvcFJpZ2h0IiwiYm90dG9tTGVmdCIsImJvdHRvbVJpZ2h0IiwiaGFuZGxlU2hhcGUiLCJyb3VuZGVkUmVjdGFuZ2xlV2l0aFJhZGlpIiwiaGFuZGxlTm9kZSIsImN1cnNvciIsImdyaXBweURvdHNTaGFwZSIsImdyaXBweVgiLCJncmlwcHlZIiwicm93IiwiY29sdW1uIiwibW92ZVRvIiwiYXJjIiwiUEkiLCJncmlwcHlEb3RzTm9kZSIsImNlbnRlciIsImFkZENoaWxkIiwidG91Y2hBcmVhU2hpZnRZIiwidG91Y2hBcmVhIiwibG9jYWxCb3VuZHMiLCJkaWxhdGVkWFkiLCJzaGlmdGVkWSIsIm1vdXNlQXJlYVNoaWZ0WSIsIm1vdXNlQXJlYSIsIngiLCJjZW50ZXJYIiwidG9wIiwiYm90dG9tIiwiZHJhd2VyTm9kZSIsImNoaWxkcmVuIiwiY2xpcEFyZWEiLCJib3VuZHMiLCJfYW5pbWF0aW9uRW5hYmxlZCIsInlPcGVuIiwieUNsb3NlZCIsInkiLCJhbmltYXRpb24iLCJvcGVuUHJvcGVydHkiLCJhZGRJbnB1dExpc3RlbmVyIiwicHJlc3MiLCJldmVudCIsInRyYWlsIiwic2V0IiwiZ2V0Iiwib3Blbk9ic2VydmVyIiwic3RvcCIsImR1cmF0aW9uIiwiZWFzaW5nIiwiUVVBRFJBVElDX0lOX09VVCIsInNldFZhbHVlIiwidmFsdWUiLCJnZXRWYWx1ZSIsInRvIiwic3RhcnQiLCJsYXp5TGluayIsImRpc3Bvc2VEcmF3ZXIiLCJ1bmxpbmsiLCJkaXNwb3NlIiwiYXNzZXJ0IiwicGhldCIsImNoaXBwZXIiLCJxdWVyeVBhcmFtZXRlcnMiLCJiaW5kZXIiLCJyZWdpc3RlckRhdGFVUkwiLCJyZXNldCIsInVuZGVmaW5lZCIsInNhdmVBbmltYXRpb25FbmFibGVkIiwic2V0QW5pbWF0aW9uRW5hYmxlZCIsImdldEFuaW1hdGlvbkVuYWJsZWQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkRyYXdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNi0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBIGRyYXdlciB0aGF0IG9wZW5zL2Nsb3NlcyB0byBzaG93L2hpZGUgaXRzIGNvbnRlbnRzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IHN0ZXBUaW1lciBmcm9tICcuLi8uLi9heG9uL2pzL3N0ZXBUaW1lci5qcyc7XHJcbmltcG9ydCBUaW55RW1pdHRlciBmcm9tICcuLi8uLi9heG9uL2pzL1RpbnlFbWl0dGVyLmpzJztcclxuaW1wb3J0IERpbWVuc2lvbjIgZnJvbSAnLi4vLi4vZG90L2pzL0RpbWVuc2lvbjIuanMnO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBJbnN0YW5jZVJlZ2lzdHJ5IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9kb2N1bWVudGF0aW9uL0luc3RhbmNlUmVnaXN0cnkuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgeyBUQ29sb3IsIE5vZGUsIE5vZGVPcHRpb25zLCBQYXRoLCBQcmVzc0xpc3RlbmVyLCBSZWN0YW5nbGUgfSBmcm9tICcuLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgQW5pbWF0aW9uIGZyb20gJy4uLy4uL3R3aXh0L2pzL0FuaW1hdGlvbi5qcyc7XHJcbmltcG9ydCBFYXNpbmcgZnJvbSAnLi4vLi4vdHdpeHQvanMvRWFzaW5nLmpzJztcclxuaW1wb3J0IHNjZW5lcnlQaGV0IGZyb20gJy4vc2NlbmVyeVBoZXQuanMnO1xyXG5pbXBvcnQgVEVtaXR0ZXIgZnJvbSAnLi4vLi4vYXhvbi9qcy9URW1pdHRlci5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyBkcmF3ZXJcclxuICBzaXplPzogRGltZW5zaW9uMiB8IG51bGw7IC8vICFudWxsOiBjb250ZW50cyBzaXplZCB0byBmaXQgaW4gY29udGFpbmVyLCBudWxsOiBjb250YWluZXIgc2l6ZWQgdG8gZml0IGNvbnRlbnRzXHJcbiAgY29ybmVyUmFkaXVzPzogbnVtYmVyO1xyXG4gIHhNYXJnaW4/OiBudW1iZXI7XHJcbiAgeU1hcmdpbj86IG51bWJlcjtcclxuICBvcGVuPzogYm9vbGVhbjsgLy8gaXMgdGhlIGRyYXdlciBpbml0aWFsbHkgb3Blbj9cclxuXHJcbiAgLy8gaGFuZGxlXHJcbiAgaGFuZGxlUG9zaXRpb24/OiAndG9wJyB8ICdib3R0b20nO1xyXG4gIGhhbmRsZVNpemU/OiBEaW1lbnNpb24yO1xyXG4gIGhhbmRsZUNvcm5lclJhZGl1cz86IG51bWJlcjtcclxuICBoYW5kbGVGaWxsPzogVENvbG9yO1xyXG4gIGhhbmRsZVRvdWNoQXJlYVhEaWxhdGlvbj86IG51bWJlcjtcclxuICBoYW5kbGVUb3VjaEFyZWFZRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgaGFuZGxlTW91c2VBcmVhWERpbGF0aW9uPzogbnVtYmVyO1xyXG4gIGhhbmRsZU1vdXNlQXJlYVlEaWxhdGlvbj86IG51bWJlcjtcclxuXHJcbiAgLy8gZ3JpcHB5IGRvdHMgb24gaGFuZGxlXHJcbiAgZ3JpcHB5RG90UmFkaXVzPzogbnVtYmVyO1xyXG4gIGdyaXBweURvdENvbG9yPzogVENvbG9yO1xyXG4gIGdyaXBweURvdFJvd3M/OiBudW1iZXI7XHJcbiAgZ3JpcHB5RG90Q29sdW1ucz86IG51bWJlcjtcclxuICBncmlwcHlEb3RYU3BhY2luZz86IG51bWJlcjtcclxuICBncmlwcHlEb3RZU3BhY2luZz86IG51bWJlcjtcclxuXHJcbiAgLy8gQ2FsbGJhY2tzLiBUaGUgZGVmYXVsdCBiZWhhdmlvciBpcyB0byBtYWtlIGNvbnRlbnROb2RlIHZpc2libGUgb25seSB3aGlsZSB0aGUgZHJhd2VyIGlzIG9wZW4uXHJcbiAgLy8gVGhpcyBjYW4gcHJvdmlkZSBwZXJmb3JtYW5jZSBnYWlucyBpZiB5b3VyIGNvbnRlbnROb2RlIHVwZGF0ZXMgb25seSB3aGlsZSB2aXNpYmxlLlxyXG4gIGJlZm9yZU9wZW4/OiAoKSA9PiB2b2lkOyAvLyBjYWxsZWQgaW1tZWRpYXRlbHkgYmVmb3JlIHRoZSBkcmF3ZXIgaXMgb3BlbmVkXHJcbiAgYWZ0ZXJDbG9zZT86ICgpID0+IHZvaWQ7IC8vIGNhbGxlZCBpbW1lZGlhdGVseSBhZnRlciB0aGUgZHJhd2VyIGlzIGNsb3NlZFxyXG5cclxuICAvLyBhbmltYXRpb25cclxuICBhbmltYXRpb25FbmFibGVkPzogYm9vbGVhbjsgLy8gaXMgYW5pbWF0aW9uIGVuYWJsZWQgd2hlbiBvcGVuaW5nL2Nsb3NpbmcgdGhlIGRyYXdlcj9cclxuICBhbmltYXRpb25EdXJhdGlvbj86IG51bWJlcjsgLy8gZHVyYXRpb24gb2YgYW5pbWF0aW9uIChkcmF3ZXIgb3BlbmluZyBhbmQgY2xvc2luZykgaW4gc2Vjb25kc1xyXG4gIHN0ZXBFbWl0dGVyPzogVEVtaXR0ZXI8WyBudW1iZXIgXT4gfCBUaW55RW1pdHRlcjxbIG51bWJlciBdPiB8IG51bGw7IC8vIHNlZSBBbmltYXRpb24gb3B0aW9ucy5zdGVwRW1pdHRlclxyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgRHJhd2VyT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxOb2RlT3B0aW9ucywgJ2NoaWxkcmVuJyB8ICdjbGlwQXJlYSc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRHJhd2VyIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8vIGlzIHRoZSBkcmF3ZXIgb3Blbj9cclxuICBwdWJsaWMgcmVhZG9ubHkgb3BlblByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gd2hhdCdzIGluIHRoZSBkcmF3ZXJcclxuICBwdWJsaWMgcmVhZG9ubHkgY29udGVudHNOb2RlOiBOb2RlO1xyXG5cclxuICAvLyB3aGV0aGVyIHRoZSBkcmF3ZXIgYW5pbWF0ZXMgb3Blbi9jbG9zZWRcclxuICBwcml2YXRlIF9hbmltYXRpb25FbmFibGVkOiBib29sZWFuO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VEcmF3ZXI6ICgpID0+IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBjb250ZW50c05vZGUgLSBjb250ZW50cyBvZiB0aGUgZHJhd2VyXHJcbiAgICogQHBhcmFtIHByb3ZpZGVPcHRpb25zXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBjb250ZW50c05vZGU6IE5vZGUsIHByb3ZpZGVPcHRpb25zPzogRHJhd2VyT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPERyYXdlck9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgc2l6ZTogbnVsbCxcclxuICAgICAgY29ybmVyUmFkaXVzOiAwLFxyXG4gICAgICB4TWFyZ2luOiAwLFxyXG4gICAgICB5TWFyZ2luOiAwLFxyXG4gICAgICBvcGVuOiB0cnVlLFxyXG4gICAgICBoYW5kbGVQb3NpdGlvbjogJ3RvcCcsXHJcbiAgICAgIGhhbmRsZVNpemU6IG5ldyBEaW1lbnNpb24yKCA3MCwgMjAgKSxcclxuICAgICAgaGFuZGxlQ29ybmVyUmFkaXVzOiA1LFxyXG4gICAgICBoYW5kbGVGaWxsOiAncmdiKCAyMzAsIDIzMCwgMjMwICknLFxyXG4gICAgICBoYW5kbGVUb3VjaEFyZWFYRGlsYXRpb246IDAsXHJcbiAgICAgIGhhbmRsZVRvdWNoQXJlYVlEaWxhdGlvbjogMCxcclxuICAgICAgaGFuZGxlTW91c2VBcmVhWERpbGF0aW9uOiAwLFxyXG4gICAgICBoYW5kbGVNb3VzZUFyZWFZRGlsYXRpb246IDAsXHJcbiAgICAgIGdyaXBweURvdFJhZGl1czogMSxcclxuICAgICAgZ3JpcHB5RG90Q29sb3I6ICdibGFjaycsXHJcbiAgICAgIGdyaXBweURvdFJvd3M6IDIsXHJcbiAgICAgIGdyaXBweURvdENvbHVtbnM6IDQsXHJcbiAgICAgIGdyaXBweURvdFhTcGFjaW5nOiA5LFxyXG4gICAgICBncmlwcHlEb3RZU3BhY2luZzogNSxcclxuICAgICAgYmVmb3JlT3BlbjogKCkgPT4geyBjb250ZW50c05vZGUudmlzaWJsZSA9IHRydWU7IH0sXHJcbiAgICAgIGFmdGVyQ2xvc2U6ICgpID0+IHsgY29udGVudHNOb2RlLnZpc2libGUgPSBmYWxzZTsgfSxcclxuICAgICAgYW5pbWF0aW9uRW5hYmxlZDogdHJ1ZSxcclxuICAgICAgYW5pbWF0aW9uRHVyYXRpb246IDAuNSxcclxuICAgICAgc3RlcEVtaXR0ZXI6IHN0ZXBUaW1lclxyXG4gICAgfSwgcHJvdmlkZU9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBzaXplIG9mIGNvbnRlbnRzLCBhZGp1c3RlZCBmb3IgbWFyZ2luc1xyXG4gICAgY29uc3QgQ09OVEVOVFNfV0lEVEggPSBjb250ZW50c05vZGUud2lkdGggKyAoIDIgKiBvcHRpb25zLnhNYXJnaW4gKTtcclxuICAgIGNvbnN0IENPTlRFTlRTX0hFSUdIVCA9IGNvbnRlbnRzTm9kZS5oZWlnaHQgKyAoIDIgKiBvcHRpb25zLnlNYXJnaW4gKTtcclxuXHJcbiAgICAvLyBzaXplIG9mIGNvbnRhaW5lclxyXG4gICAgY29uc3QgQ09OVEFJTkVSX1dJRFRIID0gb3B0aW9ucy5zaXplID8gb3B0aW9ucy5zaXplLndpZHRoIDogQ09OVEVOVFNfV0lEVEg7XHJcbiAgICBjb25zdCBDT05UQUlORVJfSEVJR0hUID0gb3B0aW9ucy5zaXplID8gb3B0aW9ucy5zaXplLmhlaWdodCA6IENPTlRFTlRTX0hFSUdIVDtcclxuXHJcbiAgICAvLyBiYWNrZ3JvdW5kXHJcbiAgICBjb25zdCBiYWNrZ3JvdW5kTm9kZSA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIENPTlRBSU5FUl9XSURUSCwgQ09OVEFJTkVSX0hFSUdIVCwge1xyXG4gICAgICBmaWxsOiAnd2hpdGUnLFxyXG4gICAgICBjb3JuZXJSYWRpdXM6IG9wdGlvbnMuY29ybmVyUmFkaXVzXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYm9yZGVyXHJcbiAgICBjb25zdCBib3JkZXJOb2RlID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgQ09OVEFJTkVSX1dJRFRILCBDT05UQUlORVJfSEVJR0hULCB7XHJcbiAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgY29ybmVyUmFkaXVzOiBvcHRpb25zLmNvcm5lclJhZGl1c1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHNjYWxlIGNvbnRlbnRzIHRvIGZpdCB0aGUgY29udGFpbmVyXHJcbiAgICBpZiAoIG9wdGlvbnMuc2l6ZSApIHtcclxuICAgICAgY29uc3Qgc2NhbGUgPSBNYXRoLm1pbiggMSwgTWF0aC5taW4oIENPTlRBSU5FUl9XSURUSCAvIENPTlRFTlRTX1dJRFRILCBDT05UQUlORVJfSEVJR0hUIC8gQ09OVEVOVFNfSEVJR0hUICkgKTtcclxuICAgICAgY29udGVudHNOb2RlLnNldFNjYWxlTWFnbml0dWRlKCBzY2FsZSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGhhbmRsZSwgcmVjdGFuZ2xlIHdpdGggdG9wIG9yIGJvdHRvbSBjb3JuZXJzIHJvdW5kZWQsIHRoZSBvdGhlciBjb3JuZXJzIHNxdWFyZVxyXG4gICAgY29uc3QgSEFORExFX1JBRElJID0gKCBvcHRpb25zLmhhbmRsZVBvc2l0aW9uID09PSAndG9wJyApID8ge1xyXG4gICAgICB0b3BMZWZ0OiBvcHRpb25zLmhhbmRsZUNvcm5lclJhZGl1cyxcclxuICAgICAgdG9wUmlnaHQ6IG9wdGlvbnMuaGFuZGxlQ29ybmVyUmFkaXVzXHJcbiAgICB9IDoge1xyXG4gICAgICBib3R0b21MZWZ0OiBvcHRpb25zLmhhbmRsZUNvcm5lclJhZGl1cyxcclxuICAgICAgYm90dG9tUmlnaHQ6IG9wdGlvbnMuaGFuZGxlQ29ybmVyUmFkaXVzXHJcbiAgICB9O1xyXG4gICAgY29uc3QgaGFuZGxlU2hhcGUgPSBTaGFwZS5yb3VuZGVkUmVjdGFuZ2xlV2l0aFJhZGlpKCAwLCAwLCBvcHRpb25zLmhhbmRsZVNpemUud2lkdGgsIG9wdGlvbnMuaGFuZGxlU2l6ZS5oZWlnaHQsIEhBTkRMRV9SQURJSSApO1xyXG4gICAgY29uc3QgaGFuZGxlTm9kZSA9IG5ldyBQYXRoKCBoYW5kbGVTaGFwZSwge1xyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcclxuICAgICAgZmlsbDogb3B0aW9ucy5oYW5kbGVGaWxsLFxyXG4gICAgICBzdHJva2U6ICdibGFjaydcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBncmlwcHkgZG90cyBvbiB0aGUgaGFuZGxlXHJcbiAgICBjb25zdCBncmlwcHlEb3RzU2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuICAgIGxldCBncmlwcHlYID0gMDtcclxuICAgIGxldCBncmlwcHlZID0gMDtcclxuICAgIGZvciAoIGxldCByb3cgPSAwOyByb3cgPCBvcHRpb25zLmdyaXBweURvdFJvd3M7IHJvdysrICkge1xyXG4gICAgICBmb3IgKCBsZXQgY29sdW1uID0gMDsgY29sdW1uIDwgb3B0aW9ucy5ncmlwcHlEb3RDb2x1bW5zOyBjb2x1bW4rKyApIHtcclxuICAgICAgICBncmlwcHlYID0gY29sdW1uICogb3B0aW9ucy5ncmlwcHlEb3RYU3BhY2luZztcclxuICAgICAgICBncmlwcHlZID0gcm93ICogb3B0aW9ucy5ncmlwcHlEb3RZU3BhY2luZztcclxuICAgICAgICBncmlwcHlEb3RzU2hhcGUubW92ZVRvKCBncmlwcHlYLCBncmlwcHlZICk7XHJcbiAgICAgICAgZ3JpcHB5RG90c1NoYXBlLmFyYyggZ3JpcHB5WCwgZ3JpcHB5WSwgb3B0aW9ucy5ncmlwcHlEb3RSYWRpdXMsIDAsIDIgKiBNYXRoLlBJICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnN0IGdyaXBweURvdHNOb2RlID0gbmV3IFBhdGgoIGdyaXBweURvdHNTaGFwZSwge1xyXG4gICAgICBmaWxsOiBvcHRpb25zLmdyaXBweURvdENvbG9yLFxyXG4gICAgICBjZW50ZXI6IGhhbmRsZU5vZGUuY2VudGVyXHJcbiAgICB9ICk7XHJcbiAgICBoYW5kbGVOb2RlLmFkZENoaWxkKCBncmlwcHlEb3RzTm9kZSApO1xyXG5cclxuICAgIC8vIGhhbmRsZSBwb2ludGVyQXJlYVxyXG4gICAgaWYgKCBvcHRpb25zLmhhbmRsZVRvdWNoQXJlYVhEaWxhdGlvbiAhPT0gMCB8fCBvcHRpb25zLmhhbmRsZVRvdWNoQXJlYVlEaWxhdGlvbiAhPT0gMCApIHtcclxuICAgICAgY29uc3QgdG91Y2hBcmVhU2hpZnRZID0gKCBvcHRpb25zLmhhbmRsZVBvc2l0aW9uID09PSAndG9wJyApID8gLW9wdGlvbnMuaGFuZGxlVG91Y2hBcmVhWURpbGF0aW9uIDogb3B0aW9ucy5oYW5kbGVUb3VjaEFyZWFZRGlsYXRpb247XHJcbiAgICAgIGhhbmRsZU5vZGUudG91Y2hBcmVhID0gaGFuZGxlTm9kZS5sb2NhbEJvdW5kcy5kaWxhdGVkWFkoIG9wdGlvbnMuaGFuZGxlVG91Y2hBcmVhWERpbGF0aW9uLCBvcHRpb25zLmhhbmRsZVRvdWNoQXJlYVlEaWxhdGlvbiApLnNoaWZ0ZWRZKCB0b3VjaEFyZWFTaGlmdFkgKTtcclxuICAgIH1cclxuICAgIGlmICggb3B0aW9ucy5oYW5kbGVNb3VzZUFyZWFYRGlsYXRpb24gIT09IDAgfHwgb3B0aW9ucy5oYW5kbGVNb3VzZUFyZWFZRGlsYXRpb24gIT09IDAgKSB7XHJcbiAgICAgIGNvbnN0IG1vdXNlQXJlYVNoaWZ0WSA9ICggb3B0aW9ucy5oYW5kbGVQb3NpdGlvbiA9PT0gJ3RvcCcgKSA/IC1vcHRpb25zLmhhbmRsZU1vdXNlQXJlYVlEaWxhdGlvbiA6IG9wdGlvbnMuaGFuZGxlTW91c2VBcmVhWURpbGF0aW9uO1xyXG4gICAgICBoYW5kbGVOb2RlLm1vdXNlQXJlYSA9IGhhbmRsZU5vZGUubG9jYWxCb3VuZHMuZGlsYXRlZFhZKCBvcHRpb25zLmhhbmRsZU1vdXNlQXJlYVhEaWxhdGlvbiwgb3B0aW9ucy5oYW5kbGVNb3VzZUFyZWFZRGlsYXRpb24gKS5zaGlmdGVkWSggbW91c2VBcmVhU2hpZnRZICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gbGF5b3V0LCBwb3NpdGlvbiB0aGUgaGFuZGxlIGF0IGNlbnRlci10b3Agb3IgY2VudGVyLWJvdHRvbVxyXG4gICAgYmFja2dyb3VuZE5vZGUueCA9IDA7XHJcbiAgICBoYW5kbGVOb2RlLmNlbnRlclggPSBiYWNrZ3JvdW5kTm9kZS5jZW50ZXJYO1xyXG4gICAgaWYgKCBvcHRpb25zLmhhbmRsZVBvc2l0aW9uID09PSAndG9wJyApIHtcclxuICAgICAgaGFuZGxlTm9kZS50b3AgPSAwO1xyXG4gICAgICBiYWNrZ3JvdW5kTm9kZS50b3AgPSBoYW5kbGVOb2RlLmJvdHRvbSAtIDE7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgYmFja2dyb3VuZE5vZGUudG9wID0gMDtcclxuICAgICAgaGFuZGxlTm9kZS50b3AgPSBiYWNrZ3JvdW5kTm9kZS5ib3R0b20gLSAxO1xyXG4gICAgfVxyXG4gICAgYm9yZGVyTm9kZS5jZW50ZXIgPSBiYWNrZ3JvdW5kTm9kZS5jZW50ZXI7XHJcbiAgICBjb250ZW50c05vZGUuY2VudGVyID0gYmFja2dyb3VuZE5vZGUuY2VudGVyO1xyXG5cclxuICAgIC8vIHB1dCBhbGwgb2YgdGhlIG1vdmluZyBwaWVjZXMgdG9nZXRoZXJcclxuICAgIGNvbnN0IGRyYXdlck5vZGUgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogWyBoYW5kbGVOb2RlLCBiYWNrZ3JvdW5kTm9kZSwgY29udGVudHNOb2RlLCBib3JkZXJOb2RlIF1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB3cmFwIHRoZSBkcmF3ZXIgd2l0aCBhIGNsaXBwaW5nIGFyZWEsIHRvIHNob3cvaGlkZSB0aGUgY29udGFpbmVyXHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gWyBkcmF3ZXJOb2RlIF07XHJcbiAgICBvcHRpb25zLmNsaXBBcmVhID0gU2hhcGUuYm91bmRzKCBkcmF3ZXJOb2RlLmJvdW5kcyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5jb250ZW50c05vZGUgPSBjb250ZW50c05vZGU7XHJcbiAgICB0aGlzLl9hbmltYXRpb25FbmFibGVkID0gb3B0aW9ucy5hbmltYXRpb25FbmFibGVkO1xyXG5cclxuICAgIGNvbnN0IHlPcGVuID0gMDtcclxuICAgIGNvbnN0IHlDbG9zZWQgPSAoIG9wdGlvbnMuaGFuZGxlUG9zaXRpb24gPT09ICd0b3AnICkgPyBiYWNrZ3JvdW5kTm9kZS5oZWlnaHQgOiAtYmFja2dyb3VuZE5vZGUuaGVpZ2h0O1xyXG4gICAgZHJhd2VyTm9kZS55ID0gb3B0aW9ucy5vcGVuID8geU9wZW4gOiB5Q2xvc2VkO1xyXG5cclxuICAgIGxldCBhbmltYXRpb246IEFuaW1hdGlvbiB8IG51bGwgPSBudWxsOyAvLyBhbmltYXRpb24gdGhhdCBvcGVucy9jbG9zZXMgdGhlIGRyYXdlclxyXG5cclxuICAgIHRoaXMub3BlblByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggb3B0aW9ucy5vcGVuICk7XHJcblxyXG4gICAgLy8gY2xpY2sgb24gdGhlIGhhbmRsZSB0byB0b2dnbGUgYmV0d2VlbiBvcGVuIGFuZCBjbG9zZWRcclxuICAgIGhhbmRsZU5vZGUuYWRkSW5wdXRMaXN0ZW5lciggbmV3IFByZXNzTGlzdGVuZXIoIHtcclxuICAgICAgcHJlc3M6ICggZXZlbnQsIHRyYWlsICkgPT4gdGhpcy5vcGVuUHJvcGVydHkuc2V0KCAhdGhpcy5vcGVuUHJvcGVydHkuZ2V0KCkgKVxyXG4gICAgfSApICk7XHJcblxyXG4gICAgLy8gb3Blbi9jbG9zZSB0aGUgZHJhd2VyXHJcbiAgICBjb25zdCBvcGVuT2JzZXJ2ZXIgPSAoIG9wZW46IGJvb2xlYW4gKSA9PiB7XHJcblxyXG4gICAgICAvLyBzdG9wIGFueSBhbmltYXRpb24gdGhhdCdzIGluIHByb2dyZXNzXHJcbiAgICAgIGFuaW1hdGlvbiAmJiBhbmltYXRpb24uc3RvcCgpO1xyXG5cclxuICAgICAgb3BlbiAmJiBvcHRpb25zLmJlZm9yZU9wZW4gJiYgb3B0aW9ucy5iZWZvcmVPcGVuKCk7XHJcblxyXG4gICAgICBpZiAoIHRoaXMuX2FuaW1hdGlvbkVuYWJsZWQgKSB7XHJcblxyXG4gICAgICAgIC8vIEFuaW1hdGUgb3BlbmluZyBhbmQgY2xvc2luZyBvZiB0aGUgZHJhd2VyLlxyXG4gICAgICAgIGFuaW1hdGlvbiA9IG5ldyBBbmltYXRpb24oIHtcclxuICAgICAgICAgIHN0ZXBFbWl0dGVyOiBvcHRpb25zLnN0ZXBFbWl0dGVyLFxyXG4gICAgICAgICAgZHVyYXRpb246IG9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24sXHJcbiAgICAgICAgICBlYXNpbmc6IEVhc2luZy5RVUFEUkFUSUNfSU5fT1VULFxyXG4gICAgICAgICAgc2V0VmFsdWU6ICggdmFsdWU6IG51bWJlciApID0+IHsgZHJhd2VyTm9kZS55ID0gdmFsdWU7IH0sXHJcbiAgICAgICAgICBnZXRWYWx1ZTogKCkgPT4gZHJhd2VyTm9kZS55LFxyXG4gICAgICAgICAgdG86IG9wZW4gPyB5T3BlbiA6IHlDbG9zZWRcclxuICAgICAgICB9ICk7XHJcbiAgICAgICAgYW5pbWF0aW9uLnN0YXJ0KCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgIC8vIGFuaW1hdGlvbiBkaXNhYmxlZCwgbW92ZSBpbW1lZGlhdGVseSB0byBuZXcgc3RhdGVcclxuICAgICAgICBkcmF3ZXJOb2RlLnkgPSBvcGVuID8geU9wZW4gOiB5Q2xvc2VkO1xyXG4gICAgICAgICFvcGVuICYmIG9wdGlvbnMuYWZ0ZXJDbG9zZSAmJiBvcHRpb25zLmFmdGVyQ2xvc2UoKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHRoaXMub3BlblByb3BlcnR5LmxhenlMaW5rKCBvcGVuT2JzZXJ2ZXIgKTsgLy8gdW5saW5rIGluIGRpc3Bvc2VcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VEcmF3ZXIgPSAoKSA9PiB7XHJcbiAgICAgIHRoaXMub3BlblByb3BlcnR5LnVubGluayggb3Blbk9ic2VydmVyICk7XHJcbiAgICAgIHRoaXMub3BlblByb3BlcnR5LmRpc3Bvc2UoKTsgLy8gd2lsbCBmYWlsIGlmIGNsaWVudHMgaGF2ZW4ndCByZW1vdmVkIG9ic2VydmVyc1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBzdXBwb3J0IGZvciBiaW5kZXIgZG9jdW1lbnRhdGlvbiwgc3RyaXBwZWQgb3V0IGluIGJ1aWxkcyBhbmQgb25seSBydW5zIHdoZW4gP2JpbmRlciBpcyBzcGVjaWZpZWRcclxuICAgIGFzc2VydCAmJiBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmJpbmRlciAmJiBJbnN0YW5jZVJlZ2lzdHJ5LnJlZ2lzdGVyRGF0YVVSTCggJ3NjZW5lcnktcGhldCcsICdEcmF3ZXInLCB0aGlzICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZURyYXdlcigpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIFthbmltYXRpb25FbmFibGVkXVxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldCggYW5pbWF0aW9uRW5hYmxlZD86IGJvb2xlYW4gKTogdm9pZCB7XHJcblxyXG4gICAgYW5pbWF0aW9uRW5hYmxlZCA9ICggYW5pbWF0aW9uRW5hYmxlZCA9PT0gdW5kZWZpbmVkICkgPyB0aGlzLmFuaW1hdGlvbkVuYWJsZWQgOiBhbmltYXRpb25FbmFibGVkO1xyXG5cclxuICAgIC8vIHNldCB0aGUgZHJhd2VyIHRvIGl0J3MgaW5pdGlhbCBvcGVuL2Nsb3NlZCBzdGF0ZSwgd2l0aCBvciB3aXRob3V0IGFuaW1hdGlvblxyXG4gICAgY29uc3Qgc2F2ZUFuaW1hdGlvbkVuYWJsZWQgPSB0aGlzLmFuaW1hdGlvbkVuYWJsZWQ7XHJcbiAgICB0aGlzLmFuaW1hdGlvbkVuYWJsZWQgPSBhbmltYXRpb25FbmFibGVkO1xyXG4gICAgdGhpcy5vcGVuUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuYW5pbWF0aW9uRW5hYmxlZCA9IHNhdmVBbmltYXRpb25FbmFibGVkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIGFuaW1hdGlvbiBpcyBlbmFibGVkIGZvciBvcGVuaW5nL2Nsb3NpbmcgZHJhd2VyLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRBbmltYXRpb25FbmFibGVkKCBhbmltYXRpb25FbmFibGVkOiBib29sZWFuICk6IHZvaWQge1xyXG4gICAgdGhpcy5fYW5pbWF0aW9uRW5hYmxlZCA9IGFuaW1hdGlvbkVuYWJsZWQ7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IGFuaW1hdGlvbkVuYWJsZWQoIHZhbHVlOiBib29sZWFuICkgeyB0aGlzLnNldEFuaW1hdGlvbkVuYWJsZWQoIHZhbHVlICk7IH1cclxuXHJcbiAgcHVibGljIGdldCBhbmltYXRpb25FbmFibGVkKCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy5nZXRBbmltYXRpb25FbmFibGVkKCk7IH1cclxuXHJcbiAgLyoqXHJcbiAgICogSXMgYW5pbWF0aW9uIGVuYWJsZWQgZm9yIG9wZW5pbmcvY2xvc2luZyBkcmF3ZXI/XHJcbiAgICovXHJcbiAgcHVibGljIGdldEFuaW1hdGlvbkVuYWJsZWQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5fYW5pbWF0aW9uRW5hYmxlZDtcclxuICB9XHJcblxyXG59XHJcblxyXG5zY2VuZXJ5UGhldC5yZWdpc3RlciggJ0RyYXdlcicsIERyYXdlciAp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