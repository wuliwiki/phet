// Copyright 2018-2023, University of Colorado Boulder

/**
 * BeakerNode draws a pseudo-3D cylindrical beaker, with optional tick marks, containing a solution.
 * Based on the value of solutionLevelProperty, it fills the beaker with solution from the bottom up.
 * The Beaker and solution use flat style shading and highlights to provide pseudo-3D dimension.
 *
 * @author Marla Schulz <marla.schulz@colorado.edu>
 */

import { Shape } from '../../kite/js/imports.js';
import SceneryPhetColors from './SceneryPhetColors.js';
import sceneryPhet from './sceneryPhet.js';
import { Node, PaintColorProperty, Path } from '../../scenery/js/imports.js';
import optionize from '../../phet-core/js/optionize.js';
export default class BeakerNode extends Node {
  constructor(solutionLevelProperty, providedOptions) {
    assert && assert(solutionLevelProperty.range.min >= 0 && solutionLevelProperty.range.max <= 1, 'SolutionLevelProperty must be a NumberProperty with min >= 0 and max <= 1');

    // Generates highlight and shading when a custom solutionFill is provided.
    const originalGlareFill = providedOptions?.solutionFill !== undefined ? providedOptions.solutionFill : SceneryPhetColors.solutionShineFillProperty;
    const originalShadowFill = providedOptions?.solutionFill !== undefined ? providedOptions.solutionFill : SceneryPhetColors.solutionShadowFillProperty;

    // Keep our solution glare/shadow up-to-date if solutionFill is a Property<Color> and it changes
    const solutionGlareFillProperty = new PaintColorProperty(originalGlareFill, {
      luminanceFactor: 0.5
    });
    const solutionShadowFillProperty = new PaintColorProperty(originalShadowFill, {
      luminanceFactor: -0.2
    });
    const options = optionize()({
      emptyBeakerFill: SceneryPhetColors.emptyBeakerFillProperty,
      solutionFill: SceneryPhetColors.solutionFillProperty,
      solutionGlareFill: solutionGlareFillProperty,
      solutionShadowFill: solutionShadowFillProperty,
      beakerGlareFill: SceneryPhetColors.beakerShineFillProperty,
      beakerStroke: SceneryPhetColors.beakerStroke,
      lineWidth: 1,
      beakerHeight: 100,
      beakerWidth: 60,
      yRadiusOfEnds: 12,
      ticksVisible: false,
      numberOfTicks: 3,
      tickStroke: SceneryPhetColors.tickStroke
    }, providedOptions);
    const xRadius = options.beakerWidth / 2;
    const centerTop = -options.beakerHeight / 2;
    const centerBottom = options.beakerHeight / 2;

    // Beaker structure and glare shapes
    const beakerGlareShape = new Shape().moveTo(-xRadius * 0.6, centerTop * 0.6).verticalLineTo(centerBottom * 0.85).lineTo(-xRadius * 0.5, centerBottom * 0.9).verticalLineTo(centerTop * 0.55).close();
    const beakerFrontShape = new Shape().ellipticalArc(0, centerBottom, xRadius, options.yRadiusOfEnds, 0, 0, Math.PI, false).ellipticalArc(0, centerTop, xRadius, options.yRadiusOfEnds, 0, Math.PI, 0, true).close();
    const beakerBackTopShape = new Shape().ellipticalArc(0, centerTop, xRadius, options.yRadiusOfEnds, 0, Math.PI, 0, false);
    const beakerBackShape = new Shape().ellipticalArc(0, centerTop, xRadius, options.yRadiusOfEnds, 0, Math.PI, 0, false).ellipticalArc(0, centerBottom, xRadius, options.yRadiusOfEnds, 0, 0, Math.PI, true).close();
    const beakerBottomShape = new Shape().ellipticalArc(0, centerBottom, xRadius, options.yRadiusOfEnds, 0, 0, 2 * Math.PI, false);

    // Water fill and shading paths
    const solutionSide = new Path(null, {
      fill: options.solutionFill,
      pickable: false
    });
    const solutionTop = new Path(null, {
      fill: options.solutionFill,
      pickable: false
    });
    const solutionFrontEdge = new Path(null, {
      fill: options.solutionShadowFill,
      pickable: false
    });
    const solutionBackEdge = new Path(null, {
      fill: options.solutionShadowFill,
      opacity: 0.6,
      pickable: false
    });
    const solutionGlare = new Path(null, {
      fill: options.solutionGlareFill
    });

    // Beaker structure and glare paths
    const beakerFront = new Path(beakerFrontShape, {
      stroke: options.beakerStroke,
      lineWidth: options.lineWidth
    });
    const beakerBack = new Path(beakerBackShape, {
      stroke: options.beakerStroke,
      lineWidth: options.lineWidth,
      fill: options.emptyBeakerFill
    });
    const beakerBackTop = new Path(beakerBackTopShape, {
      stroke: options.beakerStroke,
      lineWidth: options.lineWidth
    });
    beakerBack.setScaleMagnitude(-1, 1);
    const beakerBottom = new Path(beakerBottomShape, {
      stroke: options.beakerStroke,
      fill: options.emptyBeakerFill,
      pickable: false
    });
    const beakerGlare = new Path(beakerGlareShape.getOffsetShape(2), {
      fill: options.beakerGlareFill
    });
    const tickDivision = 1 / (options.numberOfTicks + 1);
    const ticksShape = new Shape();
    let y = centerBottom;
    for (let i = 0; i < options.numberOfTicks; i++) {
      y -= options.beakerHeight * tickDivision;
      const centralAngle = Math.PI * 0.83;
      const offsetAngle = Math.PI * (i % 2 === 0 ? 0.07 : 0.1);
      ticksShape.ellipticalArc(0, y, xRadius, options.yRadiusOfEnds, 0, centralAngle + offsetAngle, centralAngle - offsetAngle, true).newSubpath();
    }
    const ticks = new Path(ticksShape, {
      stroke: options.tickStroke,
      lineWidth: 1.5,
      pickable: false,
      visible: options.ticksVisible
    });

    // solution level adjustment listener
    const solutionLevelListener = solutionLevel => {
      const centerLiquidY = centerBottom - options.beakerHeight * solutionLevel;
      const solutionTopShape = new Shape().ellipticalArc(0, centerLiquidY, xRadius, options.yRadiusOfEnds, 0, 0, Math.PI * 2, false).close();
      const solutionSideShape = new Shape().ellipticalArc(0, centerLiquidY, xRadius, options.yRadiusOfEnds, 0, Math.PI, 0, true).ellipticalArc(0, centerBottom, xRadius, options.yRadiusOfEnds, 0, 0, Math.PI, false).close();
      const solutionFrontEdgeShape = new Shape().ellipticalArc(0, centerLiquidY + 1, xRadius, options.yRadiusOfEnds + 2, 0, Math.PI, 0, true).ellipticalArc(0, centerLiquidY, xRadius, options.yRadiusOfEnds, 0, 0, Math.PI, false);
      const solutionBackEdgeShape = new Shape().ellipticalArc(0, centerBottom - 1, xRadius, options.yRadiusOfEnds + 4, Math.PI, Math.PI, 0, true).ellipticalArc(0, centerBottom, xRadius, options.yRadiusOfEnds, Math.PI, 0, Math.PI, false);
      const solutionCrescentShape = new Shape().ellipticalArc(xRadius * 0.2, centerLiquidY, options.yRadiusOfEnds * 0.75, xRadius * 0.4, Math.PI * 1.5, Math.PI, 0, true).ellipticalArc(xRadius * 0.2, centerLiquidY, options.yRadiusOfEnds * 0.75, xRadius * 0.6, Math.PI * 1.5, 0, Math.PI, false);
      solutionTop.shape = solutionTopShape;
      solutionSide.shape = solutionSideShape;
      solutionFrontEdge.shape = solutionFrontEdgeShape;
      solutionBackEdge.shape = solutionBackEdgeShape;
      solutionGlare.shape = solutionCrescentShape;

      // Set solution visibility based on solution level
      if (solutionLevel < 0.001) {
        solutionTop.visible = false;
        solutionSide.visible = false;
        solutionFrontEdge.visible = false;
        solutionBackEdge.visible = false;
        solutionGlare.visible = false;
      } else {
        // Prevents back edge from appearing when solution level empty.  Only compute this when the solutionBackEdge
        // will be shown, because when computed for very small solutionLevel it triggers a kite corner case problem
        // see https://github.com/phetsims/kite/issues/98
        solutionBackEdge.clipArea = Shape.union([solutionTopShape, solutionSideShape]);
        solutionTop.visible = true;
        solutionSide.visible = true;
        solutionFrontEdge.visible = true;
        solutionBackEdge.visible = true;
        solutionGlare.visible = true;
      }
    };
    solutionLevelProperty.link(solutionLevelListener);

    // Prevents front edge from dipping below beaker boundary when dragged all the way down.
    solutionFrontEdge.clipArea = Shape.union([beakerFrontShape, beakerBottomShape]);
    options.children = [beakerBack, beakerBottom, solutionSide, solutionBackEdge, solutionTop, solutionGlare, solutionFrontEdge, beakerBackTop, beakerFront, ticks, beakerGlare];
    super(options);
    this.ticks = ticks;
    this.disposeBeakerNode = () => {
      solutionGlareFillProperty.dispose();
      solutionShadowFillProperty.dispose();
      solutionLevelProperty.unlink(solutionLevelListener);
    };
  }
  dispose() {
    this.disposeBeakerNode();
    super.dispose();
  }
  setTicksVisible(visible) {
    this.ticks.visible = visible;
  }
}
sceneryPhet.register('BeakerNode', BeakerNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaGFwZSIsIlNjZW5lcnlQaGV0Q29sb3JzIiwic2NlbmVyeVBoZXQiLCJOb2RlIiwiUGFpbnRDb2xvclByb3BlcnR5IiwiUGF0aCIsIm9wdGlvbml6ZSIsIkJlYWtlck5vZGUiLCJjb25zdHJ1Y3RvciIsInNvbHV0aW9uTGV2ZWxQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsImFzc2VydCIsInJhbmdlIiwibWluIiwibWF4Iiwib3JpZ2luYWxHbGFyZUZpbGwiLCJzb2x1dGlvbkZpbGwiLCJ1bmRlZmluZWQiLCJzb2x1dGlvblNoaW5lRmlsbFByb3BlcnR5Iiwib3JpZ2luYWxTaGFkb3dGaWxsIiwic29sdXRpb25TaGFkb3dGaWxsUHJvcGVydHkiLCJzb2x1dGlvbkdsYXJlRmlsbFByb3BlcnR5IiwibHVtaW5hbmNlRmFjdG9yIiwib3B0aW9ucyIsImVtcHR5QmVha2VyRmlsbCIsImVtcHR5QmVha2VyRmlsbFByb3BlcnR5Iiwic29sdXRpb25GaWxsUHJvcGVydHkiLCJzb2x1dGlvbkdsYXJlRmlsbCIsInNvbHV0aW9uU2hhZG93RmlsbCIsImJlYWtlckdsYXJlRmlsbCIsImJlYWtlclNoaW5lRmlsbFByb3BlcnR5IiwiYmVha2VyU3Ryb2tlIiwibGluZVdpZHRoIiwiYmVha2VySGVpZ2h0IiwiYmVha2VyV2lkdGgiLCJ5UmFkaXVzT2ZFbmRzIiwidGlja3NWaXNpYmxlIiwibnVtYmVyT2ZUaWNrcyIsInRpY2tTdHJva2UiLCJ4UmFkaXVzIiwiY2VudGVyVG9wIiwiY2VudGVyQm90dG9tIiwiYmVha2VyR2xhcmVTaGFwZSIsIm1vdmVUbyIsInZlcnRpY2FsTGluZVRvIiwibGluZVRvIiwiY2xvc2UiLCJiZWFrZXJGcm9udFNoYXBlIiwiZWxsaXB0aWNhbEFyYyIsIk1hdGgiLCJQSSIsImJlYWtlckJhY2tUb3BTaGFwZSIsImJlYWtlckJhY2tTaGFwZSIsImJlYWtlckJvdHRvbVNoYXBlIiwic29sdXRpb25TaWRlIiwiZmlsbCIsInBpY2thYmxlIiwic29sdXRpb25Ub3AiLCJzb2x1dGlvbkZyb250RWRnZSIsInNvbHV0aW9uQmFja0VkZ2UiLCJvcGFjaXR5Iiwic29sdXRpb25HbGFyZSIsImJlYWtlckZyb250Iiwic3Ryb2tlIiwiYmVha2VyQmFjayIsImJlYWtlckJhY2tUb3AiLCJzZXRTY2FsZU1hZ25pdHVkZSIsImJlYWtlckJvdHRvbSIsImJlYWtlckdsYXJlIiwiZ2V0T2Zmc2V0U2hhcGUiLCJ0aWNrRGl2aXNpb24iLCJ0aWNrc1NoYXBlIiwieSIsImkiLCJjZW50cmFsQW5nbGUiLCJvZmZzZXRBbmdsZSIsIm5ld1N1YnBhdGgiLCJ0aWNrcyIsInZpc2libGUiLCJzb2x1dGlvbkxldmVsTGlzdGVuZXIiLCJzb2x1dGlvbkxldmVsIiwiY2VudGVyTGlxdWlkWSIsInNvbHV0aW9uVG9wU2hhcGUiLCJzb2x1dGlvblNpZGVTaGFwZSIsInNvbHV0aW9uRnJvbnRFZGdlU2hhcGUiLCJzb2x1dGlvbkJhY2tFZGdlU2hhcGUiLCJzb2x1dGlvbkNyZXNjZW50U2hhcGUiLCJzaGFwZSIsImNsaXBBcmVhIiwidW5pb24iLCJsaW5rIiwiY2hpbGRyZW4iLCJkaXNwb3NlQmVha2VyTm9kZSIsImRpc3Bvc2UiLCJ1bmxpbmsiLCJzZXRUaWNrc1Zpc2libGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkJlYWtlck5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQmVha2VyTm9kZSBkcmF3cyBhIHBzZXVkby0zRCBjeWxpbmRyaWNhbCBiZWFrZXIsIHdpdGggb3B0aW9uYWwgdGljayBtYXJrcywgY29udGFpbmluZyBhIHNvbHV0aW9uLlxyXG4gKiBCYXNlZCBvbiB0aGUgdmFsdWUgb2Ygc29sdXRpb25MZXZlbFByb3BlcnR5LCBpdCBmaWxscyB0aGUgYmVha2VyIHdpdGggc29sdXRpb24gZnJvbSB0aGUgYm90dG9tIHVwLlxyXG4gKiBUaGUgQmVha2VyIGFuZCBzb2x1dGlvbiB1c2UgZmxhdCBzdHlsZSBzaGFkaW5nIGFuZCBoaWdobGlnaHRzIHRvIHByb3ZpZGUgcHNldWRvLTNEIGRpbWVuc2lvbi5cclxuICpcclxuICogQGF1dGhvciBNYXJsYSBTY2h1bHogPG1hcmxhLnNjaHVsekBjb2xvcmFkby5lZHU+XHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgU2NlbmVyeVBoZXRDb2xvcnMgZnJvbSAnLi9TY2VuZXJ5UGhldENvbG9ycy5qcyc7XHJcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuL3NjZW5lcnlQaGV0LmpzJztcclxuaW1wb3J0IHsgTm9kZSwgTm9kZU9wdGlvbnMsIFBhaW50Q29sb3JQcm9wZXJ0eSwgUGF0aCwgVENvbG9yLCBUUGFpbnQgfSBmcm9tICcuLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBUUmFuZ2VkUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9UUmFuZ2VkUHJvcGVydHkuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICBlbXB0eUJlYWtlckZpbGw/OiBUUGFpbnQ7XHJcbiAgc29sdXRpb25GaWxsPzogVENvbG9yO1xyXG4gIHNvbHV0aW9uU2hhZG93RmlsbD86IFRQYWludDtcclxuICBzb2x1dGlvbkdsYXJlRmlsbD86IFRQYWludDtcclxuICBiZWFrZXJHbGFyZUZpbGw/OiBUUGFpbnQ7XHJcbiAgYmVha2VySGVpZ2h0PzogbnVtYmVyO1xyXG4gIGJlYWtlcldpZHRoPzogbnVtYmVyO1xyXG4gIHlSYWRpdXNPZkVuZHM/OiBudW1iZXI7IC8vIHJhZGl1cyBvZiB0aGUgZWxsaXBzZXMgdXNlZCBmb3IgdGhlIGVuZHMsIHRvIHByb3ZpZGUgM0QgcGVyc3BlY3RpdmVcclxuICB0aWNrc1Zpc2libGU/OiBib29sZWFuO1xyXG4gIHRpY2tTdHJva2U/OiBUUGFpbnQ7XHJcbiAgYmVha2VyU3Ryb2tlPzogVFBhaW50O1xyXG4gIGxpbmVXaWR0aD86IG51bWJlcjtcclxuICBudW1iZXJPZlRpY2tzPzogbnVtYmVyOyAvLyBUaGUgbnVtYmVyIG9mIHRpY2sgbWFya3Mgc2hvd24gb24gYmVha2VyLlxyXG59O1xyXG5leHBvcnQgdHlwZSBCZWFrZXJOb2RlT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxOb2RlT3B0aW9ucywgJ2NoaWxkcmVuJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCZWFrZXJOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgdGlja3M6IFBhdGg7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlQmVha2VyTm9kZTogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBzb2x1dGlvbkxldmVsUHJvcGVydHk6IFRSYW5nZWRQcm9wZXJ0eSwgcHJvdmlkZWRPcHRpb25zPzogQmVha2VyTm9kZU9wdGlvbnMgKSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBzb2x1dGlvbkxldmVsUHJvcGVydHkucmFuZ2UubWluID49IDAgJiYgc29sdXRpb25MZXZlbFByb3BlcnR5LnJhbmdlLm1heCA8PSAxLFxyXG4gICAgICAnU29sdXRpb25MZXZlbFByb3BlcnR5IG11c3QgYmUgYSBOdW1iZXJQcm9wZXJ0eSB3aXRoIG1pbiA+PSAwIGFuZCBtYXggPD0gMScgKTtcclxuXHJcbiAgICAvLyBHZW5lcmF0ZXMgaGlnaGxpZ2h0IGFuZCBzaGFkaW5nIHdoZW4gYSBjdXN0b20gc29sdXRpb25GaWxsIGlzIHByb3ZpZGVkLlxyXG4gICAgY29uc3Qgb3JpZ2luYWxHbGFyZUZpbGwgPSBwcm92aWRlZE9wdGlvbnM/LnNvbHV0aW9uRmlsbCAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gcHJvdmlkZWRPcHRpb25zLnNvbHV0aW9uRmlsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFNjZW5lcnlQaGV0Q29sb3JzLnNvbHV0aW9uU2hpbmVGaWxsUHJvcGVydHk7XHJcbiAgICBjb25zdCBvcmlnaW5hbFNoYWRvd0ZpbGwgPSBwcm92aWRlZE9wdGlvbnM/LnNvbHV0aW9uRmlsbCAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHByb3ZpZGVkT3B0aW9ucy5zb2x1dGlvbkZpbGxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFNjZW5lcnlQaGV0Q29sb3JzLnNvbHV0aW9uU2hhZG93RmlsbFByb3BlcnR5O1xyXG5cclxuICAgIC8vIEtlZXAgb3VyIHNvbHV0aW9uIGdsYXJlL3NoYWRvdyB1cC10by1kYXRlIGlmIHNvbHV0aW9uRmlsbCBpcyBhIFByb3BlcnR5PENvbG9yPiBhbmQgaXQgY2hhbmdlc1xyXG4gICAgY29uc3Qgc29sdXRpb25HbGFyZUZpbGxQcm9wZXJ0eSA9IG5ldyBQYWludENvbG9yUHJvcGVydHkoIG9yaWdpbmFsR2xhcmVGaWxsLCB7IGx1bWluYW5jZUZhY3RvcjogMC41IH0gKTtcclxuICAgIGNvbnN0IHNvbHV0aW9uU2hhZG93RmlsbFByb3BlcnR5ID0gbmV3IFBhaW50Q29sb3JQcm9wZXJ0eSggb3JpZ2luYWxTaGFkb3dGaWxsLCB7IGx1bWluYW5jZUZhY3RvcjogLTAuMiB9ICk7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxCZWFrZXJOb2RlT3B0aW9ucywgU2VsZk9wdGlvbnMsIE5vZGVPcHRpb25zPigpKCB7XHJcbiAgICAgIGVtcHR5QmVha2VyRmlsbDogU2NlbmVyeVBoZXRDb2xvcnMuZW1wdHlCZWFrZXJGaWxsUHJvcGVydHksXHJcbiAgICAgIHNvbHV0aW9uRmlsbDogU2NlbmVyeVBoZXRDb2xvcnMuc29sdXRpb25GaWxsUHJvcGVydHksXHJcbiAgICAgIHNvbHV0aW9uR2xhcmVGaWxsOiBzb2x1dGlvbkdsYXJlRmlsbFByb3BlcnR5LFxyXG4gICAgICBzb2x1dGlvblNoYWRvd0ZpbGw6IHNvbHV0aW9uU2hhZG93RmlsbFByb3BlcnR5LFxyXG4gICAgICBiZWFrZXJHbGFyZUZpbGw6IFNjZW5lcnlQaGV0Q29sb3JzLmJlYWtlclNoaW5lRmlsbFByb3BlcnR5LFxyXG4gICAgICBiZWFrZXJTdHJva2U6IFNjZW5lcnlQaGV0Q29sb3JzLmJlYWtlclN0cm9rZSxcclxuICAgICAgbGluZVdpZHRoOiAxLFxyXG4gICAgICBiZWFrZXJIZWlnaHQ6IDEwMCxcclxuICAgICAgYmVha2VyV2lkdGg6IDYwLFxyXG4gICAgICB5UmFkaXVzT2ZFbmRzOiAxMixcclxuICAgICAgdGlja3NWaXNpYmxlOiBmYWxzZSxcclxuICAgICAgbnVtYmVyT2ZUaWNrczogMyxcclxuICAgICAgdGlja1N0cm9rZTogU2NlbmVyeVBoZXRDb2xvcnMudGlja1N0cm9rZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgeFJhZGl1cyA9IG9wdGlvbnMuYmVha2VyV2lkdGggLyAyO1xyXG5cclxuICAgIGNvbnN0IGNlbnRlclRvcCA9IC1vcHRpb25zLmJlYWtlckhlaWdodCAvIDI7XHJcbiAgICBjb25zdCBjZW50ZXJCb3R0b20gPSBvcHRpb25zLmJlYWtlckhlaWdodCAvIDI7XHJcblxyXG4gICAgLy8gQmVha2VyIHN0cnVjdHVyZSBhbmQgZ2xhcmUgc2hhcGVzXHJcbiAgICBjb25zdCBiZWFrZXJHbGFyZVNoYXBlID0gbmV3IFNoYXBlKClcclxuICAgICAgLm1vdmVUbyggLXhSYWRpdXMgKiAwLjYsIGNlbnRlclRvcCAqIDAuNiApXHJcbiAgICAgIC52ZXJ0aWNhbExpbmVUbyggY2VudGVyQm90dG9tICogMC44NSApXHJcbiAgICAgIC5saW5lVG8oIC14UmFkaXVzICogMC41LCBjZW50ZXJCb3R0b20gKiAwLjkgKVxyXG4gICAgICAudmVydGljYWxMaW5lVG8oIGNlbnRlclRvcCAqIDAuNTUgKVxyXG4gICAgICAuY2xvc2UoKTtcclxuXHJcbiAgICBjb25zdCBiZWFrZXJGcm9udFNoYXBlID0gbmV3IFNoYXBlKClcclxuICAgICAgLmVsbGlwdGljYWxBcmMoIDAsIGNlbnRlckJvdHRvbSwgeFJhZGl1cywgb3B0aW9ucy55UmFkaXVzT2ZFbmRzLCAwLCAwLCBNYXRoLlBJLCBmYWxzZSApXHJcbiAgICAgIC5lbGxpcHRpY2FsQXJjKCAwLCBjZW50ZXJUb3AsIHhSYWRpdXMsIG9wdGlvbnMueVJhZGl1c09mRW5kcywgMCwgTWF0aC5QSSwgMCwgdHJ1ZSApXHJcbiAgICAgIC5jbG9zZSgpO1xyXG5cclxuICAgIGNvbnN0IGJlYWtlckJhY2tUb3BTaGFwZSA9IG5ldyBTaGFwZSgpXHJcbiAgICAgIC5lbGxpcHRpY2FsQXJjKCAwLCBjZW50ZXJUb3AsIHhSYWRpdXMsIG9wdGlvbnMueVJhZGl1c09mRW5kcywgMCwgTWF0aC5QSSwgMCwgZmFsc2UgKTtcclxuXHJcbiAgICBjb25zdCBiZWFrZXJCYWNrU2hhcGUgPSBuZXcgU2hhcGUoKVxyXG4gICAgICAuZWxsaXB0aWNhbEFyYyggMCwgY2VudGVyVG9wLCB4UmFkaXVzLCBvcHRpb25zLnlSYWRpdXNPZkVuZHMsIDAsIE1hdGguUEksIDAsIGZhbHNlIClcclxuICAgICAgLmVsbGlwdGljYWxBcmMoIDAsIGNlbnRlckJvdHRvbSwgeFJhZGl1cywgb3B0aW9ucy55UmFkaXVzT2ZFbmRzLCAwLCAwLCBNYXRoLlBJLCB0cnVlIClcclxuICAgICAgLmNsb3NlKCk7XHJcblxyXG4gICAgY29uc3QgYmVha2VyQm90dG9tU2hhcGUgPSBuZXcgU2hhcGUoKVxyXG4gICAgICAuZWxsaXB0aWNhbEFyYyggMCwgY2VudGVyQm90dG9tLCB4UmFkaXVzLCBvcHRpb25zLnlSYWRpdXNPZkVuZHMsIDAsIDAsIDIgKiBNYXRoLlBJLCBmYWxzZSApO1xyXG5cclxuICAgIC8vIFdhdGVyIGZpbGwgYW5kIHNoYWRpbmcgcGF0aHNcclxuICAgIGNvbnN0IHNvbHV0aW9uU2lkZSA9IG5ldyBQYXRoKCBudWxsLCB7XHJcbiAgICAgIGZpbGw6IG9wdGlvbnMuc29sdXRpb25GaWxsLFxyXG4gICAgICBwaWNrYWJsZTogZmFsc2VcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IHNvbHV0aW9uVG9wID0gbmV3IFBhdGgoIG51bGwsIHtcclxuICAgICAgZmlsbDogb3B0aW9ucy5zb2x1dGlvbkZpbGwsXHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZVxyXG4gICAgfSApO1xyXG4gICAgY29uc3Qgc29sdXRpb25Gcm9udEVkZ2UgPSBuZXcgUGF0aCggbnVsbCwge1xyXG4gICAgICBmaWxsOiBvcHRpb25zLnNvbHV0aW9uU2hhZG93RmlsbCxcclxuICAgICAgcGlja2FibGU6IGZhbHNlXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBzb2x1dGlvbkJhY2tFZGdlID0gbmV3IFBhdGgoIG51bGwsIHtcclxuICAgICAgZmlsbDogb3B0aW9ucy5zb2x1dGlvblNoYWRvd0ZpbGwsXHJcbiAgICAgIG9wYWNpdHk6IDAuNixcclxuICAgICAgcGlja2FibGU6IGZhbHNlXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBzb2x1dGlvbkdsYXJlID0gbmV3IFBhdGgoIG51bGwsIHtcclxuICAgICAgZmlsbDogb3B0aW9ucy5zb2x1dGlvbkdsYXJlRmlsbFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEJlYWtlciBzdHJ1Y3R1cmUgYW5kIGdsYXJlIHBhdGhzXHJcbiAgICBjb25zdCBiZWFrZXJGcm9udCA9IG5ldyBQYXRoKCBiZWFrZXJGcm9udFNoYXBlLCB7XHJcbiAgICAgIHN0cm9rZTogb3B0aW9ucy5iZWFrZXJTdHJva2UsXHJcbiAgICAgIGxpbmVXaWR0aDogb3B0aW9ucy5saW5lV2lkdGhcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBiZWFrZXJCYWNrID0gbmV3IFBhdGgoIGJlYWtlckJhY2tTaGFwZSwge1xyXG4gICAgICBzdHJva2U6IG9wdGlvbnMuYmVha2VyU3Ryb2tlLFxyXG4gICAgICBsaW5lV2lkdGg6IG9wdGlvbnMubGluZVdpZHRoLFxyXG4gICAgICBmaWxsOiBvcHRpb25zLmVtcHR5QmVha2VyRmlsbFxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGJlYWtlckJhY2tUb3AgPSBuZXcgUGF0aCggYmVha2VyQmFja1RvcFNoYXBlLCB7XHJcbiAgICAgIHN0cm9rZTogb3B0aW9ucy5iZWFrZXJTdHJva2UsXHJcbiAgICAgIGxpbmVXaWR0aDogb3B0aW9ucy5saW5lV2lkdGhcclxuICAgIH0gKTtcclxuXHJcbiAgICBiZWFrZXJCYWNrLnNldFNjYWxlTWFnbml0dWRlKCAtMSwgMSApO1xyXG5cclxuICAgIGNvbnN0IGJlYWtlckJvdHRvbSA9IG5ldyBQYXRoKCBiZWFrZXJCb3R0b21TaGFwZSwge1xyXG4gICAgICBzdHJva2U6IG9wdGlvbnMuYmVha2VyU3Ryb2tlLFxyXG4gICAgICBmaWxsOiBvcHRpb25zLmVtcHR5QmVha2VyRmlsbCxcclxuICAgICAgcGlja2FibGU6IGZhbHNlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgYmVha2VyR2xhcmUgPSBuZXcgUGF0aCggYmVha2VyR2xhcmVTaGFwZS5nZXRPZmZzZXRTaGFwZSggMiApLCB7XHJcbiAgICAgIGZpbGw6IG9wdGlvbnMuYmVha2VyR2xhcmVGaWxsXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgdGlja0RpdmlzaW9uID0gMSAvICggb3B0aW9ucy5udW1iZXJPZlRpY2tzICsgMSApO1xyXG4gICAgY29uc3QgdGlja3NTaGFwZSA9IG5ldyBTaGFwZSgpO1xyXG4gICAgbGV0IHkgPSBjZW50ZXJCb3R0b207XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBvcHRpb25zLm51bWJlck9mVGlja3M7IGkrKyApIHtcclxuICAgICAgeSAtPSBvcHRpb25zLmJlYWtlckhlaWdodCAqIHRpY2tEaXZpc2lvbjtcclxuICAgICAgY29uc3QgY2VudHJhbEFuZ2xlID0gTWF0aC5QSSAqIDAuODM7XHJcbiAgICAgIGNvbnN0IG9mZnNldEFuZ2xlID0gTWF0aC5QSSAqICggaSAlIDIgPT09IDAgPyAwLjA3IDogMC4xICk7XHJcbiAgICAgIHRpY2tzU2hhcGUuZWxsaXB0aWNhbEFyYyggMCwgeSwgeFJhZGl1cywgb3B0aW9ucy55UmFkaXVzT2ZFbmRzLCAwLCBjZW50cmFsQW5nbGUgKyBvZmZzZXRBbmdsZSwgY2VudHJhbEFuZ2xlIC0gb2Zmc2V0QW5nbGUsIHRydWUgKS5uZXdTdWJwYXRoKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdGlja3MgPSBuZXcgUGF0aCggdGlja3NTaGFwZSwge1xyXG4gICAgICBzdHJva2U6IG9wdGlvbnMudGlja1N0cm9rZSxcclxuICAgICAgbGluZVdpZHRoOiAxLjUsXHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZSxcclxuICAgICAgdmlzaWJsZTogb3B0aW9ucy50aWNrc1Zpc2libGVcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBzb2x1dGlvbiBsZXZlbCBhZGp1c3RtZW50IGxpc3RlbmVyXHJcbiAgICBjb25zdCBzb2x1dGlvbkxldmVsTGlzdGVuZXIgPSAoIHNvbHV0aW9uTGV2ZWw6IG51bWJlciApID0+IHtcclxuICAgICAgY29uc3QgY2VudGVyTGlxdWlkWSA9IGNlbnRlckJvdHRvbSAtIG9wdGlvbnMuYmVha2VySGVpZ2h0ICogc29sdXRpb25MZXZlbDtcclxuICAgICAgY29uc3Qgc29sdXRpb25Ub3BTaGFwZSA9IG5ldyBTaGFwZSgpXHJcbiAgICAgICAgLmVsbGlwdGljYWxBcmMoIDAsIGNlbnRlckxpcXVpZFksIHhSYWRpdXMsIG9wdGlvbnMueVJhZGl1c09mRW5kcywgMCwgMCwgTWF0aC5QSSAqIDIsIGZhbHNlIClcclxuICAgICAgICAuY2xvc2UoKTtcclxuICAgICAgY29uc3Qgc29sdXRpb25TaWRlU2hhcGUgPSBuZXcgU2hhcGUoKVxyXG4gICAgICAgIC5lbGxpcHRpY2FsQXJjKCAwLCBjZW50ZXJMaXF1aWRZLCB4UmFkaXVzLCBvcHRpb25zLnlSYWRpdXNPZkVuZHMsIDAsIE1hdGguUEksIDAsIHRydWUgKVxyXG4gICAgICAgIC5lbGxpcHRpY2FsQXJjKCAwLCBjZW50ZXJCb3R0b20sIHhSYWRpdXMsIG9wdGlvbnMueVJhZGl1c09mRW5kcywgMCwgMCwgTWF0aC5QSSwgZmFsc2UgKVxyXG4gICAgICAgIC5jbG9zZSgpO1xyXG4gICAgICBjb25zdCBzb2x1dGlvbkZyb250RWRnZVNoYXBlID0gbmV3IFNoYXBlKClcclxuICAgICAgICAuZWxsaXB0aWNhbEFyYyggMCwgY2VudGVyTGlxdWlkWSArIDEsIHhSYWRpdXMsIG9wdGlvbnMueVJhZGl1c09mRW5kcyArIDIsIDAsIE1hdGguUEksIDAsIHRydWUgKVxyXG4gICAgICAgIC5lbGxpcHRpY2FsQXJjKCAwLCBjZW50ZXJMaXF1aWRZLCB4UmFkaXVzLCBvcHRpb25zLnlSYWRpdXNPZkVuZHMsIDAsIDAsIE1hdGguUEksIGZhbHNlICk7XHJcbiAgICAgIGNvbnN0IHNvbHV0aW9uQmFja0VkZ2VTaGFwZSA9IG5ldyBTaGFwZSgpXHJcbiAgICAgICAgLmVsbGlwdGljYWxBcmMoIDAsIGNlbnRlckJvdHRvbSAtIDEsIHhSYWRpdXMsIG9wdGlvbnMueVJhZGl1c09mRW5kcyArIDQsIE1hdGguUEksIE1hdGguUEksIDAsIHRydWUgKVxyXG4gICAgICAgIC5lbGxpcHRpY2FsQXJjKCAwLCBjZW50ZXJCb3R0b20sIHhSYWRpdXMsIG9wdGlvbnMueVJhZGl1c09mRW5kcywgTWF0aC5QSSwgMCwgTWF0aC5QSSwgZmFsc2UgKTtcclxuICAgICAgY29uc3Qgc29sdXRpb25DcmVzY2VudFNoYXBlID0gbmV3IFNoYXBlKClcclxuICAgICAgICAuZWxsaXB0aWNhbEFyYyggeFJhZGl1cyAqIDAuMiwgY2VudGVyTGlxdWlkWSwgb3B0aW9ucy55UmFkaXVzT2ZFbmRzICogMC43NSwgeFJhZGl1cyAqIDAuNCwgTWF0aC5QSSAqIDEuNSwgTWF0aC5QSSwgMCwgdHJ1ZSApXHJcbiAgICAgICAgLmVsbGlwdGljYWxBcmMoIHhSYWRpdXMgKiAwLjIsIGNlbnRlckxpcXVpZFksIG9wdGlvbnMueVJhZGl1c09mRW5kcyAqIDAuNzUsIHhSYWRpdXMgKiAwLjYsIE1hdGguUEkgKiAxLjUsIDAsIE1hdGguUEksIGZhbHNlICk7XHJcblxyXG4gICAgICBzb2x1dGlvblRvcC5zaGFwZSA9IHNvbHV0aW9uVG9wU2hhcGU7XHJcbiAgICAgIHNvbHV0aW9uU2lkZS5zaGFwZSA9IHNvbHV0aW9uU2lkZVNoYXBlO1xyXG4gICAgICBzb2x1dGlvbkZyb250RWRnZS5zaGFwZSA9IHNvbHV0aW9uRnJvbnRFZGdlU2hhcGU7XHJcbiAgICAgIHNvbHV0aW9uQmFja0VkZ2Uuc2hhcGUgPSBzb2x1dGlvbkJhY2tFZGdlU2hhcGU7XHJcbiAgICAgIHNvbHV0aW9uR2xhcmUuc2hhcGUgPSBzb2x1dGlvbkNyZXNjZW50U2hhcGU7XHJcblxyXG4gICAgICAvLyBTZXQgc29sdXRpb24gdmlzaWJpbGl0eSBiYXNlZCBvbiBzb2x1dGlvbiBsZXZlbFxyXG4gICAgICBpZiAoIHNvbHV0aW9uTGV2ZWwgPCAwLjAwMSApIHtcclxuICAgICAgICBzb2x1dGlvblRvcC52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgc29sdXRpb25TaWRlLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICBzb2x1dGlvbkZyb250RWRnZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgc29sdXRpb25CYWNrRWRnZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgc29sdXRpb25HbGFyZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgIC8vIFByZXZlbnRzIGJhY2sgZWRnZSBmcm9tIGFwcGVhcmluZyB3aGVuIHNvbHV0aW9uIGxldmVsIGVtcHR5LiAgT25seSBjb21wdXRlIHRoaXMgd2hlbiB0aGUgc29sdXRpb25CYWNrRWRnZVxyXG4gICAgICAgIC8vIHdpbGwgYmUgc2hvd24sIGJlY2F1c2Ugd2hlbiBjb21wdXRlZCBmb3IgdmVyeSBzbWFsbCBzb2x1dGlvbkxldmVsIGl0IHRyaWdnZXJzIGEga2l0ZSBjb3JuZXIgY2FzZSBwcm9ibGVtXHJcbiAgICAgICAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9raXRlL2lzc3Vlcy85OFxyXG4gICAgICAgIHNvbHV0aW9uQmFja0VkZ2UuY2xpcEFyZWEgPSBTaGFwZS51bmlvbiggWyBzb2x1dGlvblRvcFNoYXBlLCBzb2x1dGlvblNpZGVTaGFwZSBdICk7XHJcblxyXG4gICAgICAgIHNvbHV0aW9uVG9wLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIHNvbHV0aW9uU2lkZS52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICBzb2x1dGlvbkZyb250RWRnZS52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICBzb2x1dGlvbkJhY2tFZGdlLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIHNvbHV0aW9uR2xhcmUudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBzb2x1dGlvbkxldmVsUHJvcGVydHkubGluayggc29sdXRpb25MZXZlbExpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gUHJldmVudHMgZnJvbnQgZWRnZSBmcm9tIGRpcHBpbmcgYmVsb3cgYmVha2VyIGJvdW5kYXJ5IHdoZW4gZHJhZ2dlZCBhbGwgdGhlIHdheSBkb3duLlxyXG4gICAgc29sdXRpb25Gcm9udEVkZ2UuY2xpcEFyZWEgPSBTaGFwZS51bmlvbiggWyBiZWFrZXJGcm9udFNoYXBlLCBiZWFrZXJCb3R0b21TaGFwZSBdICk7XHJcblxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFtcclxuICAgICAgYmVha2VyQmFjayxcclxuICAgICAgYmVha2VyQm90dG9tLFxyXG4gICAgICBzb2x1dGlvblNpZGUsXHJcbiAgICAgIHNvbHV0aW9uQmFja0VkZ2UsXHJcbiAgICAgIHNvbHV0aW9uVG9wLFxyXG4gICAgICBzb2x1dGlvbkdsYXJlLFxyXG4gICAgICBzb2x1dGlvbkZyb250RWRnZSxcclxuICAgICAgYmVha2VyQmFja1RvcCxcclxuICAgICAgYmVha2VyRnJvbnQsXHJcbiAgICAgIHRpY2tzLFxyXG4gICAgICBiZWFrZXJHbGFyZVxyXG4gICAgXTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMudGlja3MgPSB0aWNrcztcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VCZWFrZXJOb2RlID0gKCkgPT4ge1xyXG4gICAgICBzb2x1dGlvbkdsYXJlRmlsbFByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgc29sdXRpb25TaGFkb3dGaWxsUHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgICBzb2x1dGlvbkxldmVsUHJvcGVydHkudW5saW5rKCBzb2x1dGlvbkxldmVsTGlzdGVuZXIgKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZUJlYWtlck5vZGUoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRUaWNrc1Zpc2libGUoIHZpc2libGU6IGJvb2xlYW4gKTogdm9pZCB7XHJcbiAgICB0aGlzLnRpY2tzLnZpc2libGUgPSB2aXNpYmxlO1xyXG4gIH1cclxufVxyXG5cclxuc2NlbmVyeVBoZXQucmVnaXN0ZXIoICdCZWFrZXJOb2RlJywgQmVha2VyTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBU0EsS0FBSyxRQUFRLDBCQUEwQjtBQUNoRCxPQUFPQyxpQkFBaUIsTUFBTSx3QkFBd0I7QUFDdEQsT0FBT0MsV0FBVyxNQUFNLGtCQUFrQjtBQUMxQyxTQUFTQyxJ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