// Copyright 2014-2023, University of Colorado Boulder

/**
 * ScientificNotationNode displays a number in scientific notation, M x 10^E, where:
 * - M is the mantissa
 * - E is the exponent, a positive or negative integer
 *
 * For example, with 2 decimal places in the mantissa, 0.0002342 would be written as 2.34 x 10^-4.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Utils from '../../dot/js/Utils.js';
import InstanceRegistry from '../../phet-core/js/documentation/InstanceRegistry.js';
import optionize from '../../phet-core/js/optionize.js';
import { Node, Text } from '../../scenery/js/imports.js';
import MathSymbols from './MathSymbols.js';
import PhetFont from './PhetFont.js';
import sceneryPhet from './sceneryPhet.js';

// options for toScientificNotation

// return type of toScientificNotation

export default class ScientificNotationNode extends Node {
  // width of space between mantissa and 'x 10'

  // the height of capital letters (aka cap line)

  // parts of the representation, 'M x 10^E'

  constructor(valueProperty, providedOptions) {
    const options = optionize()({
      // SelfOptions
      fill: 'black',
      font: new PhetFont(20),
      exponent: null,
      // exponent will be computed
      mantissaDecimalPlaces: 1,
      exponentScale: 0.75,
      showIntegersAsMantissaOnly: false,
      showZeroAsInteger: true,
      showZeroExponent: false,
      exponentXSpacing: 2,
      exponentYOffset: 0,
      capHeightScale: 0.75,
      nullValueString: MathSymbols.NO_VALUE
    }, providedOptions);
    super();
    this.valueProperty = valueProperty;
    this.options = options;
    const textOptions = {
      font: options.font,
      fill: options.fill
    };

    // Compute font metrics that we'll need for layout.
    const tmpText = new Text(' ', textOptions);
    this.mantissaXSpacing = tmpText.width;
    this.capHeight = options.capHeightScale * (tmpText.top - tmpText.y);
    this.mantissaNode = new Text('?', textOptions);
    this.timesTenNode = new Text('?', textOptions);
    this.exponentNode = new Text('?', optionize()({
      scale: options.exponentScale,
      // exponent is scaled!
      centerY: this.timesTenNode.y + this.capHeight + options.exponentYOffset
    }, textOptions));

    // We'll start with just the mantissaNode. update will add the other Nodes as appropriate.
    assert && assert(!options.children, 'ScientificNotationNode sets children');
    options.children = [this.mantissaNode];
    this.mutate(options);
    const valuePropertyObserver = this.update.bind(this);
    valueProperty.link(valuePropertyObserver);
    this.disposeScientificNotationNode = () => {
      if (valueProperty.hasListener(valuePropertyObserver)) {
        valueProperty.unlink(valuePropertyObserver);
      }
    };

    // support for binder documentation, stripped out in builds and only runs when ?binder is specified
    assert && phet.chipper.queryParameters.binder && InstanceRegistry.registerDataURL('scenery-phet', 'ScientificNotationNode', this);
  }
  dispose() {
    this.disposeScientificNotationNode();
    super.dispose();
  }
  update(value) {
    const options = this.options;

    // NOTE: Adding and removing nodes is more expensive than changing visibility, but results in correct bounds.
    // So this implementation sets this.children based on which child Nodes should be visible.

    if (value === null) {
      // no value
      this.mantissaNode.string = options.nullValueString;
      this.children = [this.mantissaNode];
    } else if (!isFinite(value)) {
      // use built-in toFixed to format values that are not finite
      // NaN -> 'NaN', Infinity -> 'Infinity', etc.
      this.mantissaNode.string = value.toFixed(0); // eslint-disable-line bad-sim-text
      this.children = [this.mantissaNode];
    } else if (Math.floor(value) === value && options.showIntegersAsMantissaOnly) {
      // show integers as mantissa only, 'M'
      this.mantissaNode.string = value;
      this.children = [this.mantissaNode];
    } else {
      const scientificNotation = ScientificNotationNode.toScientificNotation(value, options);
      if (parseFloat(scientificNotation.mantissa) === 0 && options.showZeroAsInteger) {
        // show '0 x 10^E' as '0'
        this.mantissaNode.string = '0';
        this.children = [this.mantissaNode];
      } else if (scientificNotation.exponent === '0' && !options.showZeroExponent) {
        // show 'M x 10^0' as 'M'
        this.mantissaNode.string = scientificNotation.mantissa;
        this.children = [this.mantissaNode];
      } else {
        // show 'M x 10^E'
        this.mantissaNode.string = scientificNotation.mantissa;
        this.timesTenNode.string = 'x 10';
        this.exponentNode.string = scientificNotation.exponent;
        this.children = [this.mantissaNode, this.exponentNode, this.timesTenNode];

        // adjust layout
        this.timesTenNode.left = this.mantissaNode.right + this.mantissaXSpacing;
        this.exponentNode.left = this.timesTenNode.right + options.exponentXSpacing;
      }
    }
  }

  /**
   * Converts a number to scientific-notation format: M x 10^E, with mantissa M and exponent E.
   */
  static toScientificNotation(value, providedOptions) {
    assert && assert(isFinite(value), `value must be finite: ${value}`);
    const options = optionize()({
      mantissaDecimalPlaces: 1,
      exponent: null // exponent will be computed
    }, providedOptions);
    let mantissa;
    let exponent;
    if (options.exponent !== null) {
      // M x 10^E, where E is options.exponent
      //TODO https://github.com/phetsims/dot/issues/113 division here and in Utils.toFixed can result in floating-point error that affects rounding
      mantissa = Utils.toFixed(value / Math.pow(10, options.exponent), options.mantissaDecimalPlaces);
      exponent = options.exponent.toString();
    } else {
      // Convert to a string in exponential notation, where the mantissa has 1 digit to the left of the decimal place.
      //TODO https://github.com/phetsims/scenery-phet/issues/613 toExponential uses Number.toFixed, which doesn't round the same on all platforms
      const exponentialString = value.toExponential(options.mantissaDecimalPlaces);

      // Break into mantissa and exponent tokens.
      const tokens = exponentialString.toLowerCase().split('e');
      mantissa = tokens[0];
      exponent = tokens[1];

      // The exponent token include a '+' or '-' sign. Remove the '+' sign from positive exponents.
      if (exponent.startsWith('+')) {
        exponent = exponent.substring(1, exponent.length);
      }
    }

    // mantissa x 10^exponent
    return {
      mantissa: mantissa,
      exponent: exponent
    };
  }
}
sceneryPhet.register('ScientificNotationNode', ScientificNotationNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIkluc3RhbmNlUmVnaXN0cnkiLCJvcHRpb25pemUiLCJOb2RlIiwiVGV4dCIsIk1hdGhTeW1ib2xzIiwiUGhldEZvbnQiLCJzY2VuZXJ5UGhldCIsIlNjaWVudGlmaWNOb3RhdGlvbk5vZGUiLCJjb25zdHJ1Y3RvciIsInZhbHVlUHJvcGVydHkiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiZmlsbCIsImZvbnQiLCJleHBvbmVudCIsIm1hbnRpc3NhRGVjaW1hbFBsYWNlcyIsImV4cG9uZW50U2NhbGUiLCJzaG93SW50ZWdlcnNBc01hbnRpc3NhT25seSIsInNob3daZXJvQXNJbnRlZ2VyIiwic2hvd1plcm9FeHBvbmVudCIsImV4cG9uZW50WFNwYWNpbmciLCJleHBvbmVudFlPZmZzZXQiLCJjYXBIZWlnaHRTY2FsZSIsIm51bGxWYWx1ZVN0cmluZyIsIk5PX1ZBTFVFIiwidGV4dE9wdGlvbnMiLCJ0bXBUZXh0IiwibWFudGlzc2FYU3BhY2luZyIsIndpZHRoIiwiY2FwSGVpZ2h0IiwidG9wIiwieSIsIm1hbnRpc3NhTm9kZSIsInRpbWVzVGVuTm9kZSIsImV4cG9uZW50Tm9kZSIsInNjYWxlIiwiY2VudGVyWSIsImFzc2VydCIsImNoaWxkcmVuIiwibXV0YXRlIiwidmFsdWVQcm9wZXJ0eU9ic2VydmVyIiwidXBkYXRlIiwiYmluZCIsImxpbmsiLCJkaXNwb3NlU2NpZW50aWZpY05vdGF0aW9uTm9kZSIsImhhc0xpc3RlbmVyIiwidW5saW5rIiwicGhldCIsImNoaXBwZXIiLCJxdWVyeVBhcmFtZXRlcnMiLCJiaW5kZXIiLCJyZWdpc3RlckRhdGFVUkwiLCJkaXNwb3NlIiwidmFsdWUiLCJzdHJpbmciLCJpc0Zpbml0ZSIsInRvRml4ZWQiLCJNYXRoIiwiZmxvb3IiLCJzY2llbnRpZmljTm90YXRpb24iLCJ0b1NjaWVudGlmaWNOb3RhdGlvbiIsInBhcnNlRmxvYXQiLCJtYW50aXNzYSIsImxlZnQiLCJyaWdodCIsInBvdyIsInRvU3RyaW5nIiwiZXhwb25lbnRpYWxTdHJpbmciLCJ0b0V4cG9uZW50aWFsIiwidG9rZW5zIiwidG9Mb3dlckNhc2UiLCJzcGxpdCIsInN0YXJ0c1dpdGgiLCJzdWJzdHJpbmciLCJsZW5ndGgiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlNjaWVudGlmaWNOb3RhdGlvbk5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2NpZW50aWZpY05vdGF0aW9uTm9kZSBkaXNwbGF5cyBhIG51bWJlciBpbiBzY2llbnRpZmljIG5vdGF0aW9uLCBNIHggMTBeRSwgd2hlcmU6XHJcbiAqIC0gTSBpcyB0aGUgbWFudGlzc2FcclxuICogLSBFIGlzIHRoZSBleHBvbmVudCwgYSBwb3NpdGl2ZSBvciBuZWdhdGl2ZSBpbnRlZ2VyXHJcbiAqXHJcbiAqIEZvciBleGFtcGxlLCB3aXRoIDIgZGVjaW1hbCBwbGFjZXMgaW4gdGhlIG1hbnRpc3NhLCAwLjAwMDIzNDIgd291bGQgYmUgd3JpdHRlbiBhcyAyLjM0IHggMTBeLTQuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IEluc3RhbmNlUmVnaXN0cnkgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL2RvY3VtZW50YXRpb24vSW5zdGFuY2VSZWdpc3RyeS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCB7IEZvbnQsIFRDb2xvciwgTm9kZSwgTm9kZU9wdGlvbnMsIFRleHQsIFRleHRPcHRpb25zIH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IE1hdGhTeW1ib2xzIGZyb20gJy4vTWF0aFN5bWJvbHMuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuL3NjZW5lcnlQaGV0LmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgZmlsbD86IFRDb2xvcjtcclxuICBmb250PzogRm9udDtcclxuICBleHBvbmVudD86IG51bWJlciB8IG51bGw7IC8vIGlmIG51bGwsIGV4cG9uZW50IHdpbGwgYmUgY29tcHV0ZWQgc28gdGhhdCBtYW50aXNzYSBoYXMgMSBkaWdpdCB0byB0aGUgbGVmdCBvZiB0aGUgZGVjaW1hbCBwb2ludFxyXG4gIG1hbnRpc3NhRGVjaW1hbFBsYWNlcz86IG51bWJlcjtcclxuICBleHBvbmVudFNjYWxlPzogbnVtYmVyOyAvLyBzY2FsZSBvZiB0aGUgZXhwb25lbnQsIHJlbGF0aXZlIHRvIHRoZSBzaXplIG9mIHRoZSAnMTAnXHJcbiAgc2hvd0ludGVnZXJzQXNNYW50aXNzYU9ubHk/OiBib29sZWFuOyAvLyBpZiB0cnVlLCBzaG93IDgwMDAgYXMgJzgwMDAnLCBvdGhlcndpc2UgJzggeCAxMF4zJ1xyXG4gIHNob3daZXJvQXNJbnRlZ2VyPzogYm9vbGVhbjsgLy8gaWYgdHJ1ZSwgc2hvdyAnMCB4IDEwXkUnIGFzICcwJ1xyXG4gIHNob3daZXJvRXhwb25lbnQ/OiBib29sZWFuOyAvLyBpZiBmYWxzZSwgc2hvdyAnTSB4IDEwXjAnIGFzICdNJ1xyXG4gIGV4cG9uZW50WFNwYWNpbmc/OiBudW1iZXI7IC8vIHNwYWNlIHRvIGxlZnQgb2YgZXhwb25lbnRcclxuICBleHBvbmVudFlPZmZzZXQ/OiBudW1iZXI7IC8vIG9mZnNldCBvZiBleHBvbmVudCdzIGNlbnRlciBmcm9tIGNhcCBsaW5lXHJcbiAgY2FwSGVpZ2h0U2NhbGU/OiBudW1iZXI7IC8vIGZ1ZGdlIGZhY3RvciBmb3IgY29tcHV0aW5nIHRoaXMuY2FwSGVpZ2h0LCBjb21wZW5zYXRlcyBmb3IgaW5hY2N1cmFjeSBvZiBUZXh0LmhlaWdodFxyXG4gIG51bGxWYWx1ZVN0cmluZz86IHN0cmluZzsgLy8gaWYgdGhlIHZhbHVlIGlzIG51bGwsIGRpc3BsYXkgdGhpcyBzdHJpbmdcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFNjaWVudGlmaWNOb3RhdGlvbk5vZGVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PE5vZGVPcHRpb25zLCAnY2hpbGRyZW4nPjtcclxuXHJcbi8vIG9wdGlvbnMgZm9yIHRvU2NpZW50aWZpY05vdGF0aW9uXHJcbmV4cG9ydCB0eXBlIFRvU2NpZW50aWZpY05vdGF0aW9uT3B0aW9ucyA9IFBpY2s8U2NpZW50aWZpY05vdGF0aW9uTm9kZU9wdGlvbnMsICdtYW50aXNzYURlY2ltYWxQbGFjZXMnIHwgJ2V4cG9uZW50Jz47XHJcblxyXG4vLyByZXR1cm4gdHlwZSBvZiB0b1NjaWVudGlmaWNOb3RhdGlvblxyXG5leHBvcnQgdHlwZSBTY2llbnRpZmljTm90YXRpb24gPSB7XHJcbiAgbWFudGlzc2E6IHN0cmluZztcclxuICBleHBvbmVudDogc3RyaW5nO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2NpZW50aWZpY05vdGF0aW9uTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgdmFsdWVQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyIHwgbnVsbD47XHJcbiAgcHJpdmF0ZSByZWFkb25seSBvcHRpb25zOiBSZXF1aXJlZDxTZWxmT3B0aW9ucz47XHJcblxyXG4gIC8vIHdpZHRoIG9mIHNwYWNlIGJldHdlZW4gbWFudGlzc2EgYW5kICd4IDEwJ1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbWFudGlzc2FYU3BhY2luZzogbnVtYmVyO1xyXG5cclxuICAvLyB0aGUgaGVpZ2h0IG9mIGNhcGl0YWwgbGV0dGVycyAoYWthIGNhcCBsaW5lKVxyXG4gIHByaXZhdGUgcmVhZG9ubHkgY2FwSGVpZ2h0OiBudW1iZXI7XHJcblxyXG4gIC8vIHBhcnRzIG9mIHRoZSByZXByZXNlbnRhdGlvbiwgJ00geCAxMF5FJ1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbWFudGlzc2FOb2RlOiBUZXh0O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdGltZXNUZW5Ob2RlOiBUZXh0O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZXhwb25lbnROb2RlOiBUZXh0O1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VTY2llbnRpZmljTm90YXRpb25Ob2RlOiAoKSA9PiB2b2lkO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHZhbHVlUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PG51bWJlciB8IG51bGw+LCBwcm92aWRlZE9wdGlvbnM/OiBTY2llbnRpZmljTm90YXRpb25Ob2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFNjaWVudGlmaWNOb3RhdGlvbk5vZGVPcHRpb25zLCBTZWxmT3B0aW9ucywgTm9kZU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNlbGZPcHRpb25zXHJcbiAgICAgIGZpbGw6ICdibGFjaycsXHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMjAgKSxcclxuICAgICAgZXhwb25lbnQ6IG51bGwsIC8vIGV4cG9uZW50IHdpbGwgYmUgY29tcHV0ZWRcclxuICAgICAgbWFudGlzc2FEZWNpbWFsUGxhY2VzOiAxLFxyXG4gICAgICBleHBvbmVudFNjYWxlOiAwLjc1LFxyXG4gICAgICBzaG93SW50ZWdlcnNBc01hbnRpc3NhT25seTogZmFsc2UsXHJcbiAgICAgIHNob3daZXJvQXNJbnRlZ2VyOiB0cnVlLFxyXG4gICAgICBzaG93WmVyb0V4cG9uZW50OiBmYWxzZSxcclxuICAgICAgZXhwb25lbnRYU3BhY2luZzogMixcclxuICAgICAgZXhwb25lbnRZT2Zmc2V0OiAwLFxyXG4gICAgICBjYXBIZWlnaHRTY2FsZTogMC43NSxcclxuICAgICAgbnVsbFZhbHVlU3RyaW5nOiBNYXRoU3ltYm9scy5OT19WQUxVRVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICB0aGlzLnZhbHVlUHJvcGVydHkgPSB2YWx1ZVByb3BlcnR5O1xyXG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcclxuXHJcbiAgICBjb25zdCB0ZXh0T3B0aW9ucyA9IHsgZm9udDogb3B0aW9ucy5mb250LCBmaWxsOiBvcHRpb25zLmZpbGwgfTtcclxuXHJcbiAgICAvLyBDb21wdXRlIGZvbnQgbWV0cmljcyB0aGF0IHdlJ2xsIG5lZWQgZm9yIGxheW91dC5cclxuICAgIGNvbnN0IHRtcFRleHQgPSBuZXcgVGV4dCggJyAnLCB0ZXh0T3B0aW9ucyApO1xyXG4gICAgdGhpcy5tYW50aXNzYVhTcGFjaW5nID0gdG1wVGV4dC53aWR0aDtcclxuICAgIHRoaXMuY2FwSGVpZ2h0ID0gb3B0aW9ucy5jYXBIZWlnaHRTY2FsZSAqICggdG1wVGV4dC50b3AgLSB0bXBUZXh0LnkgKTtcclxuXHJcbiAgICB0aGlzLm1hbnRpc3NhTm9kZSA9IG5ldyBUZXh0KCAnPycsIHRleHRPcHRpb25zICk7XHJcbiAgICB0aGlzLnRpbWVzVGVuTm9kZSA9IG5ldyBUZXh0KCAnPycsIHRleHRPcHRpb25zICk7XHJcbiAgICB0aGlzLmV4cG9uZW50Tm9kZSA9IG5ldyBUZXh0KCAnPycsIG9wdGlvbml6ZTxUZXh0T3B0aW9ucywgRW1wdHlTZWxmT3B0aW9ucywgVGV4dE9wdGlvbnM+KCkoIHtcclxuICAgICAgc2NhbGU6IG9wdGlvbnMuZXhwb25lbnRTY2FsZSwgLy8gZXhwb25lbnQgaXMgc2NhbGVkIVxyXG4gICAgICBjZW50ZXJZOiB0aGlzLnRpbWVzVGVuTm9kZS55ICsgdGhpcy5jYXBIZWlnaHQgKyBvcHRpb25zLmV4cG9uZW50WU9mZnNldFxyXG4gICAgfSwgdGV4dE9wdGlvbnMgKSApO1xyXG5cclxuICAgIC8vIFdlJ2xsIHN0YXJ0IHdpdGgganVzdCB0aGUgbWFudGlzc2FOb2RlLiB1cGRhdGUgd2lsbCBhZGQgdGhlIG90aGVyIE5vZGVzIGFzIGFwcHJvcHJpYXRlLlxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggIW9wdGlvbnMuY2hpbGRyZW4sICdTY2llbnRpZmljTm90YXRpb25Ob2RlIHNldHMgY2hpbGRyZW4nICk7XHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gWyB0aGlzLm1hbnRpc3NhTm9kZSBdO1xyXG5cclxuICAgIHRoaXMubXV0YXRlKCBvcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgdmFsdWVQcm9wZXJ0eU9ic2VydmVyID0gdGhpcy51cGRhdGUuYmluZCggdGhpcyApO1xyXG4gICAgdmFsdWVQcm9wZXJ0eS5saW5rKCB2YWx1ZVByb3BlcnR5T2JzZXJ2ZXIgKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VTY2llbnRpZmljTm90YXRpb25Ob2RlID0gKCkgPT4ge1xyXG4gICAgICBpZiAoIHZhbHVlUHJvcGVydHkuaGFzTGlzdGVuZXIoIHZhbHVlUHJvcGVydHlPYnNlcnZlciApICkge1xyXG4gICAgICAgIHZhbHVlUHJvcGVydHkudW5saW5rKCB2YWx1ZVByb3BlcnR5T2JzZXJ2ZXIgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBzdXBwb3J0IGZvciBiaW5kZXIgZG9jdW1lbnRhdGlvbiwgc3RyaXBwZWQgb3V0IGluIGJ1aWxkcyBhbmQgb25seSBydW5zIHdoZW4gP2JpbmRlciBpcyBzcGVjaWZpZWRcclxuICAgIGFzc2VydCAmJiBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmJpbmRlciAmJiBJbnN0YW5jZVJlZ2lzdHJ5LnJlZ2lzdGVyRGF0YVVSTCggJ3NjZW5lcnktcGhldCcsICdTY2llbnRpZmljTm90YXRpb25Ob2RlJywgdGhpcyApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VTY2llbnRpZmljTm90YXRpb25Ob2RlKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZSggdmFsdWU6IG51bWJlciB8IG51bGwgKTogdm9pZCB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcclxuXHJcbiAgICAvLyBOT1RFOiBBZGRpbmcgYW5kIHJlbW92aW5nIG5vZGVzIGlzIG1vcmUgZXhwZW5zaXZlIHRoYW4gY2hhbmdpbmcgdmlzaWJpbGl0eSwgYnV0IHJlc3VsdHMgaW4gY29ycmVjdCBib3VuZHMuXHJcbiAgICAvLyBTbyB0aGlzIGltcGxlbWVudGF0aW9uIHNldHMgdGhpcy5jaGlsZHJlbiBiYXNlZCBvbiB3aGljaCBjaGlsZCBOb2RlcyBzaG91bGQgYmUgdmlzaWJsZS5cclxuXHJcbiAgICBpZiAoIHZhbHVlID09PSBudWxsICkge1xyXG5cclxuICAgICAgLy8gbm8gdmFsdWVcclxuICAgICAgdGhpcy5tYW50aXNzYU5vZGUuc3RyaW5nID0gb3B0aW9ucy5udWxsVmFsdWVTdHJpbmc7XHJcbiAgICAgIHRoaXMuY2hpbGRyZW4gPSBbIHRoaXMubWFudGlzc2FOb2RlIF07XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggIWlzRmluaXRlKCB2YWx1ZSApICkge1xyXG5cclxuICAgICAgLy8gdXNlIGJ1aWx0LWluIHRvRml4ZWQgdG8gZm9ybWF0IHZhbHVlcyB0aGF0IGFyZSBub3QgZmluaXRlXHJcbiAgICAgIC8vIE5hTiAtPiAnTmFOJywgSW5maW5pdHkgLT4gJ0luZmluaXR5JywgZXRjLlxyXG4gICAgICB0aGlzLm1hbnRpc3NhTm9kZS5zdHJpbmcgPSB2YWx1ZS50b0ZpeGVkKCAwICk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgYmFkLXNpbS10ZXh0XHJcbiAgICAgIHRoaXMuY2hpbGRyZW4gPSBbIHRoaXMubWFudGlzc2FOb2RlIF07XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggTWF0aC5mbG9vciggdmFsdWUgKSA9PT0gdmFsdWUgJiYgb3B0aW9ucy5zaG93SW50ZWdlcnNBc01hbnRpc3NhT25seSApIHtcclxuXHJcbiAgICAgIC8vIHNob3cgaW50ZWdlcnMgYXMgbWFudGlzc2Egb25seSwgJ00nXHJcbiAgICAgIHRoaXMubWFudGlzc2FOb2RlLnN0cmluZyA9IHZhbHVlO1xyXG4gICAgICB0aGlzLmNoaWxkcmVuID0gWyB0aGlzLm1hbnRpc3NhTm9kZSBdO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNvbnN0IHNjaWVudGlmaWNOb3RhdGlvbiA9IFNjaWVudGlmaWNOb3RhdGlvbk5vZGUudG9TY2llbnRpZmljTm90YXRpb24oIHZhbHVlLCBvcHRpb25zICk7XHJcblxyXG4gICAgICBpZiAoIHBhcnNlRmxvYXQoIHNjaWVudGlmaWNOb3RhdGlvbi5tYW50aXNzYSApID09PSAwICYmIG9wdGlvbnMuc2hvd1plcm9Bc0ludGVnZXIgKSB7XHJcblxyXG4gICAgICAgIC8vIHNob3cgJzAgeCAxMF5FJyBhcyAnMCdcclxuICAgICAgICB0aGlzLm1hbnRpc3NhTm9kZS5zdHJpbmcgPSAnMCc7XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IFsgdGhpcy5tYW50aXNzYU5vZGUgXTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggc2NpZW50aWZpY05vdGF0aW9uLmV4cG9uZW50ID09PSAnMCcgJiYgIW9wdGlvbnMuc2hvd1plcm9FeHBvbmVudCApIHtcclxuXHJcbiAgICAgICAgLy8gc2hvdyAnTSB4IDEwXjAnIGFzICdNJ1xyXG4gICAgICAgIHRoaXMubWFudGlzc2FOb2RlLnN0cmluZyA9IHNjaWVudGlmaWNOb3RhdGlvbi5tYW50aXNzYTtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuID0gWyB0aGlzLm1hbnRpc3NhTm9kZSBdO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAvLyBzaG93ICdNIHggMTBeRSdcclxuICAgICAgICB0aGlzLm1hbnRpc3NhTm9kZS5zdHJpbmcgPSBzY2llbnRpZmljTm90YXRpb24ubWFudGlzc2E7XHJcbiAgICAgICAgdGhpcy50aW1lc1Rlbk5vZGUuc3RyaW5nID0gJ3ggMTAnO1xyXG4gICAgICAgIHRoaXMuZXhwb25lbnROb2RlLnN0cmluZyA9IHNjaWVudGlmaWNOb3RhdGlvbi5leHBvbmVudDtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuID0gWyB0aGlzLm1hbnRpc3NhTm9kZSwgdGhpcy5leHBvbmVudE5vZGUsIHRoaXMudGltZXNUZW5Ob2RlIF07XHJcblxyXG4gICAgICAgIC8vIGFkanVzdCBsYXlvdXRcclxuICAgICAgICB0aGlzLnRpbWVzVGVuTm9kZS5sZWZ0ID0gdGhpcy5tYW50aXNzYU5vZGUucmlnaHQgKyB0aGlzLm1hbnRpc3NhWFNwYWNpbmc7XHJcbiAgICAgICAgdGhpcy5leHBvbmVudE5vZGUubGVmdCA9IHRoaXMudGltZXNUZW5Ob2RlLnJpZ2h0ICsgb3B0aW9ucy5leHBvbmVudFhTcGFjaW5nO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb252ZXJ0cyBhIG51bWJlciB0byBzY2llbnRpZmljLW5vdGF0aW9uIGZvcm1hdDogTSB4IDEwXkUsIHdpdGggbWFudGlzc2EgTSBhbmQgZXhwb25lbnQgRS5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIHRvU2NpZW50aWZpY05vdGF0aW9uKCB2YWx1ZTogbnVtYmVyLCBwcm92aWRlZE9wdGlvbnM/OiBUb1NjaWVudGlmaWNOb3RhdGlvbk9wdGlvbnMgKTogU2NpZW50aWZpY05vdGF0aW9uIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGlzRmluaXRlKCB2YWx1ZSApLCBgdmFsdWUgbXVzdCBiZSBmaW5pdGU6ICR7dmFsdWV9YCApO1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8VG9TY2llbnRpZmljTm90YXRpb25PcHRpb25zLCBFbXB0eVNlbGZPcHRpb25zLCBUb1NjaWVudGlmaWNOb3RhdGlvbk9wdGlvbnM+KCkoIHtcclxuICAgICAgbWFudGlzc2FEZWNpbWFsUGxhY2VzOiAxLFxyXG4gICAgICBleHBvbmVudDogbnVsbCAvLyBleHBvbmVudCB3aWxsIGJlIGNvbXB1dGVkXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBsZXQgbWFudGlzc2E6IHN0cmluZztcclxuICAgIGxldCBleHBvbmVudDogc3RyaW5nO1xyXG4gICAgaWYgKCBvcHRpb25zLmV4cG9uZW50ICE9PSBudWxsICkge1xyXG5cclxuICAgICAgLy8gTSB4IDEwXkUsIHdoZXJlIEUgaXMgb3B0aW9ucy5leHBvbmVudFxyXG4gICAgICAvL1RPRE8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2RvdC9pc3N1ZXMvMTEzIGRpdmlzaW9uIGhlcmUgYW5kIGluIFV0aWxzLnRvRml4ZWQgY2FuIHJlc3VsdCBpbiBmbG9hdGluZy1wb2ludCBlcnJvciB0aGF0IGFmZmVjdHMgcm91bmRpbmdcclxuICAgICAgbWFudGlzc2EgPSBVdGlscy50b0ZpeGVkKCB2YWx1ZSAvIE1hdGgucG93KCAxMCwgb3B0aW9ucy5leHBvbmVudCApLCBvcHRpb25zLm1hbnRpc3NhRGVjaW1hbFBsYWNlcyApO1xyXG4gICAgICBleHBvbmVudCA9IG9wdGlvbnMuZXhwb25lbnQudG9TdHJpbmcoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG5cclxuICAgICAgLy8gQ29udmVydCB0byBhIHN0cmluZyBpbiBleHBvbmVudGlhbCBub3RhdGlvbiwgd2hlcmUgdGhlIG1hbnRpc3NhIGhhcyAxIGRpZ2l0IHRvIHRoZSBsZWZ0IG9mIHRoZSBkZWNpbWFsIHBsYWNlLlxyXG4gICAgICAvL1RPRE8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnktcGhldC9pc3N1ZXMvNjEzIHRvRXhwb25lbnRpYWwgdXNlcyBOdW1iZXIudG9GaXhlZCwgd2hpY2ggZG9lc24ndCByb3VuZCB0aGUgc2FtZSBvbiBhbGwgcGxhdGZvcm1zXHJcbiAgICAgIGNvbnN0IGV4cG9uZW50aWFsU3RyaW5nID0gdmFsdWUudG9FeHBvbmVudGlhbCggb3B0aW9ucy5tYW50aXNzYURlY2ltYWxQbGFjZXMgKTtcclxuXHJcbiAgICAgIC8vIEJyZWFrIGludG8gbWFudGlzc2EgYW5kIGV4cG9uZW50IHRva2Vucy5cclxuICAgICAgY29uc3QgdG9rZW5zID0gZXhwb25lbnRpYWxTdHJpbmcudG9Mb3dlckNhc2UoKS5zcGxpdCggJ2UnICk7XHJcbiAgICAgIG1hbnRpc3NhID0gdG9rZW5zWyAwIF07XHJcbiAgICAgIGV4cG9uZW50ID0gdG9rZW5zWyAxIF07XHJcblxyXG4gICAgICAvLyBUaGUgZXhwb25lbnQgdG9rZW4gaW5jbHVkZSBhICcrJyBvciAnLScgc2lnbi4gUmVtb3ZlIHRoZSAnKycgc2lnbiBmcm9tIHBvc2l0aXZlIGV4cG9uZW50cy5cclxuICAgICAgaWYgKCBleHBvbmVudC5zdGFydHNXaXRoKCAnKycgKSApIHtcclxuICAgICAgICBleHBvbmVudCA9IGV4cG9uZW50LnN1YnN0cmluZyggMSwgZXhwb25lbnQubGVuZ3RoICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBtYW50aXNzYSB4IDEwXmV4cG9uZW50XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBtYW50aXNzYTogbWFudGlzc2EsXHJcbiAgICAgIGV4cG9uZW50OiBleHBvbmVudFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbnNjZW5lcnlQaGV0LnJlZ2lzdGVyKCAnU2NpZW50aWZpY05vdGF0aW9uTm9kZScsIFNjaWVudGlmaWNOb3RhdGlvbk5vZGUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVB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