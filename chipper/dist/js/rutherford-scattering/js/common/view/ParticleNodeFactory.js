// Copyright 2016-2022, University of Colorado Boulder

/**
 * Factory for creating particle nodes.
 *
 * @author Dave Schmitz (Schmitzware)
 */

import platform from '../../../../phet-core/js/platform.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import { Circle, Image, Line, Node, RadialGradient } from '../../../../scenery/js/imports.js';
import plumPuddingIcon_png from '../../../images/plumPuddingIcon_png.js';
import rutherfordScattering from '../../rutherfordScattering.js';
import RSColors from '../RSColors.js';

// constants
const SPECULAR_HIGHLITE_COLOR = 'rgb(200,200,200)';
const ELECTRON_COLOR = 'rgb(135,135,205)';
const PROTON_COLOR = 'rgb(255,69,0)';
const NEUTRON_COLOR = 'rgb(192,192,192)';
const PARTICLE_COLOR = 'rgb(255,0,255)';
const ENERGY_LEVEL_COLOR = 'rgb(128,128,128)';
const ELECTRON_RADIUS = 2.5;
const PROTON_RADIUS = 4;
const NEUTRON_RADIUS = 4;
const PARTICLE_RADIUS = 2;
const NUCLEUS_RADIUS = 2;
const ENERGY_LEVEL_LINE_LENGTH = 5;
const ParticleNodeFactory = {
  /**
   * Creates an electron node.
   * @returns {Node}
   * @public
   */
  createElectron() {
    return new Node({
      children: [new ParticleNode(ELECTRON_RADIUS, ELECTRON_COLOR)]
    });
  },
  /**
   * Creates a proton node.
   * @returns {Node}
   * @public
   */
  createProton() {
    return new Node({
      children: [new ParticleNode(PROTON_RADIUS, PROTON_COLOR)]
    });
  },
  /**
   * Creates a neutron node.
   * @returns {Node}
   * @public
   */
  createNeutron() {
    return new Node({
      children: [new ParticleNode(NEUTRON_RADIUS, NEUTRON_COLOR)]
    });
  },
  /**
   * Draw a proton with canvas using the provided context
   *
   * @param  {number} x
   * @param  {number} y
   * @param  {CanvasRenderingContext2D} context
   */
  drawProtonWithCanvas(x, y, context) {
    drawParticleWithCanvas(x, y, PROTON_RADIUS, PROTON_COLOR, context);
  },
  /**
   * Draw a neutron with canvas using the provided context
   *
   * @param  {number} x
   * @param  {number} y
   * @param  {CanvasRenderingContext2D} context
   */
  drawNeutronWithCanvas(x, y, context) {
    drawParticleWithCanvas(x, y, NEUTRON_RADIUS, NEUTRON_COLOR, context);
  },
  /**
   * Creates a nucleus node, represented by a small circle.
   * @returns {Node}
   * @public
   */
  createNucleus() {
    return new Node({
      children: [new Circle(NUCLEUS_RADIUS, {
        fill: RSColors.nucleusColorProperty
      })]
    });
  },
  /**
   * Create an icon for the legend describing the energy level of an electron
   * @returns {Node} [description]
   */
  createEnergyLevel() {
    return new Node({
      children: [new Line(0, 0, ENERGY_LEVEL_LINE_LENGTH, 0, {
        stroke: ENERGY_LEVEL_COLOR
      }), new Line(2 * ENERGY_LEVEL_LINE_LENGTH, 0, 3 * ENERGY_LEVEL_LINE_LENGTH, 0, {
        stroke: ENERGY_LEVEL_COLOR
      }), new Line(4 * ENERGY_LEVEL_LINE_LENGTH, 0, 5 * ENERGY_LEVEL_LINE_LENGTH, 0, {
        stroke: ENERGY_LEVEL_COLOR
      })]
    });
  },
  /**
   * Create an icon for the legend describing the particle trace, represented as an arrow
   * @returns {Node}
   */
  createParticleTrace() {
    return new Node({
      children: [new ArrowNode(0, 0, 20, 0, {
        fill: PARTICLE_COLOR,
        tailWidth: 2,
        headHeight: 10
      })]
    });
  },
  /**
   * Creates an alpha particle node, represented by two protons and two neutrons.
   * @returns {Node}
   * @public
   */
  createNucleusAlpha() {
    return new Node({
      children: [new ParticleNode(NEUTRON_RADIUS, NEUTRON_COLOR, {
        x: NEUTRON_RADIUS - 1,
        y: -NEUTRON_RADIUS
      }), new ParticleNode(NEUTRON_RADIUS, NEUTRON_COLOR, {
        x: -NEUTRON_RADIUS + 1,
        y: NEUTRON_RADIUS
      }), new ParticleNode(PROTON_RADIUS, PROTON_COLOR, {
        x: -PROTON_RADIUS + 1,
        y: -PROTON_RADIUS + 1
      }), new ParticleNode(PROTON_RADIUS, PROTON_COLOR, {
        x: PROTON_RADIUS - 1,
        y: PROTON_RADIUS - 1
      })]
    });
  },
  /**
   * Creates an alpha particle node, represented by a small circle.
   * @returns {Node}
   * @public
   */
  createParticleAlpha() {
    return new Node({
      children: [new Circle(PARTICLE_RADIUS, {
        fill: PARTICLE_COLOR
      })]
    });
  },
  /**
   * Creates a plum pudding image.
   * @returns {Node}
   * @public
   */
  createPlumPuddingIcon() {
    return new Node({
      children: [new Image(plumPuddingIcon_png, {
        scale: 0.06
      })]
    });
  }
};
rutherfordScattering.register('ParticleNodeFactory', ParticleNodeFactory);
class ParticleNode extends Circle {
  /**
   * @param {number} radius
   * @param {Color|String} color
   * @param {Object} [options]
   * @private
   */
  constructor(radius, color, options) {
    options = options || {};
    assert && assert(!options.fill);
    options.fill = new RadialGradient(radius * 0.1, radius * 0.7, 0.2, -radius * 0.2, -radius * 0.3, radius * 2).addColorStop(0, SPECULAR_HIGHLITE_COLOR).addColorStop(0.33, color).addColorStop(1, 'black');
    super(radius, options);
  }
}

/**
 * Draw a particle on a canvas using the provided context.  The particle is at position (x,y) in the
 * coordinate frames of the canvas.
 *
 * @param  {number} x
 * @param  {number} y
 * @param  {number} radius
 * @param  {string} color
 * @param  {CanvasRenderingContext2D} context
 */
const drawParticleWithCanvas = (x, y, radius, color, context) => {
  // draw the circle
  context.beginPath();
  context.arc(x, y, radius, 0, 2 * Math.PI, false);
  const useConcentric = !!platform.safari;
  const x0 = useConcentric ? x - 0.066 : x + radius * 0.1;
  const y0 = useConcentric ? y + 0.2 * radius : y + radius * 0.7;
  const x1 = useConcentric ? x - 0.066 : x + -radius * 0.2;
  const y1 = useConcentric ? y + 0.2 * radius : y + -radius * 0.3;

  // create the radial gradient from the center of the arc
  const gradient = context.createRadialGradient(x0, y0, 0.2, x1, y1, radius * 2);
  gradient.addColorStop(0, SPECULAR_HIGHLITE_COLOR);
  gradient.addColorStop(0.33, color);
  gradient.addColorStop(1, 'black');
  context.fillStyle = gradient;

  // fill and close so that the context can be used to draw more particles
  context.fill();
  context.closePath();
};
export default ParticleNodeFactory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwbGF0Zm9ybSIsIkFycm93Tm9kZSIsIkNpcmNsZSIsIkltYWdlIiwiTGluZSIsIk5vZGUiLCJSYWRpYWxHcmFkaWVudCIsInBsdW1QdWRkaW5nSWNvbl9wbmciLCJydXRoZXJmb3JkU2NhdHRlcmluZyIsIlJTQ29sb3JzIiwiU1BFQ1VMQVJfSElHSExJVEVfQ09MT1IiLCJFTEVDVFJPTl9DT0xPUiIsIlBST1RPTl9DT0xPUiIsIk5FVVRST05fQ09MT1IiLCJQQVJUSUNMRV9DT0xPUiIsIkVORVJHWV9MRVZFTF9DT0xPUiIsIkVMRUNUUk9OX1JBRElVUyIsIlBST1RPTl9SQURJVVMiLCJORVVUUk9OX1JBRElVUyIsIlBBUlRJQ0xFX1JBRElVUyIsIk5VQ0xFVVNfUkFESVVTIiwiRU5FUkdZX0xFVkVMX0xJTkVfTEVOR1RIIiwiUGFydGljbGVOb2RlRmFjdG9yeSIsImNyZWF0ZUVsZWN0cm9uIiwiY2hpbGRyZW4iLCJQYXJ0aWNsZU5vZGUiLCJjcmVhdGVQcm90b24iLCJjcmVhdGVOZXV0cm9uIiwiZHJhd1Byb3RvbldpdGhDYW52YXMiLCJ4IiwieSIsImNvbnRleHQiLCJkcmF3UGFydGljbGVXaXRoQ2FudmFzIiwiZHJhd05ldXRyb25XaXRoQ2FudmFzIiwiY3JlYXRlTnVjbGV1cyIsImZpbGwiLCJudWNsZXVzQ29sb3JQcm9wZXJ0eSIsImNyZWF0ZUVuZXJneUxldmVsIiwic3Ryb2tlIiwiY3JlYXRlUGFydGljbGVUcmFjZSIsInRhaWxXaWR0aCIsImhlYWRIZWlnaHQiLCJjcmVhdGVOdWNsZXVzQWxwaGEiLCJjcmVhdGVQYXJ0aWNsZUFscGhhIiwiY3JlYXRlUGx1bVB1ZGRpbmdJY29uIiwic2NhbGUiLCJyZWdpc3RlciIsImNvbnN0cnVjdG9yIiwicmFkaXVzIiwiY29sb3IiLCJvcHRpb25zIiwiYXNzZXJ0IiwiYWRkQ29sb3JTdG9wIiwiYmVnaW5QYXRoIiwiYXJjIiwiTWF0aCIsIlBJIiwidXNlQ29uY2VudHJpYyIsInNhZmFyaSIsIngwIiwieTAiLCJ4MSIsInkxIiwiZ3JhZGllbnQiLCJjcmVhdGVSYWRpYWxHcmFkaWVudCIsImZpbGxTdHlsZSIsImNsb3NlUGF0aCJdLCJzb3VyY2VzIjpbIlBhcnRpY2xlTm9kZUZhY3RvcnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogRmFjdG9yeSBmb3IgY3JlYXRpbmcgcGFydGljbGUgbm9kZXMuXHJcbiAqXHJcbiAqIEBhdXRob3IgRGF2ZSBTY2htaXR6IChTY2htaXR6d2FyZSlcclxuICovXHJcblxyXG5pbXBvcnQgcGxhdGZvcm0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3BsYXRmb3JtLmpzJztcclxuaW1wb3J0IEFycm93Tm9kZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvQXJyb3dOb2RlLmpzJztcclxuaW1wb3J0IHsgQ2lyY2xlLCBJbWFnZSwgTGluZSwgTm9kZSwgUmFkaWFsR3JhZGllbnQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgcGx1bVB1ZGRpbmdJY29uX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvcGx1bVB1ZGRpbmdJY29uX3BuZy5qcyc7XHJcbmltcG9ydCBydXRoZXJmb3JkU2NhdHRlcmluZyBmcm9tICcuLi8uLi9ydXRoZXJmb3JkU2NhdHRlcmluZy5qcyc7XHJcbmltcG9ydCBSU0NvbG9ycyBmcm9tICcuLi9SU0NvbG9ycy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgU1BFQ1VMQVJfSElHSExJVEVfQ09MT1IgPSAncmdiKDIwMCwyMDAsMjAwKSc7XHJcbmNvbnN0IEVMRUNUUk9OX0NPTE9SID0gJ3JnYigxMzUsMTM1LDIwNSknO1xyXG5jb25zdCBQUk9UT05fQ09MT1IgPSAncmdiKDI1NSw2OSwwKSc7XHJcbmNvbnN0IE5FVVRST05fQ09MT1IgPSAncmdiKDE5MiwxOTIsMTkyKSc7XHJcbmNvbnN0IFBBUlRJQ0xFX0NPTE9SID0gJ3JnYigyNTUsMCwyNTUpJztcclxuY29uc3QgRU5FUkdZX0xFVkVMX0NPTE9SID0gJ3JnYigxMjgsMTI4LDEyOCknO1xyXG5jb25zdCBFTEVDVFJPTl9SQURJVVMgPSAyLjU7XHJcbmNvbnN0IFBST1RPTl9SQURJVVMgPSA0O1xyXG5jb25zdCBORVVUUk9OX1JBRElVUyA9IDQ7XHJcbmNvbnN0IFBBUlRJQ0xFX1JBRElVUyA9IDI7XHJcbmNvbnN0IE5VQ0xFVVNfUkFESVVTID0gMjtcclxuY29uc3QgRU5FUkdZX0xFVkVMX0xJTkVfTEVOR1RIID0gNTtcclxuXHJcblxyXG5jb25zdCBQYXJ0aWNsZU5vZGVGYWN0b3J5ID0ge1xyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGFuIGVsZWN0cm9uIG5vZGUuXHJcbiAgICogQHJldHVybnMge05vZGV9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNyZWF0ZUVsZWN0cm9uKCkge1xyXG4gICAgcmV0dXJuIG5ldyBOb2RlKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgbmV3IFBhcnRpY2xlTm9kZSggRUxFQ1RST05fUkFESVVTLCBFTEVDVFJPTl9DT0xPUiApXHJcbiAgICAgIF1cclxuICAgIH0gKTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgcHJvdG9uIG5vZGUuXHJcbiAgICogQHJldHVybnMge05vZGV9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNyZWF0ZVByb3RvbigpIHtcclxuICAgIHJldHVybiBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIG5ldyBQYXJ0aWNsZU5vZGUoIFBST1RPTl9SQURJVVMsIFBST1RPTl9DT0xPUiApXHJcbiAgICAgIF1cclxuICAgIH0gKTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgbmV1dHJvbiBub2RlLlxyXG4gICAqIEByZXR1cm5zIHtOb2RlfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBjcmVhdGVOZXV0cm9uKCkge1xyXG4gICAgcmV0dXJuIG5ldyBOb2RlKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgbmV3IFBhcnRpY2xlTm9kZSggTkVVVFJPTl9SQURJVVMsIE5FVVRST05fQ09MT1IgKVxyXG4gICAgICBdXHJcbiAgICB9ICk7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogRHJhdyBhIHByb3RvbiB3aXRoIGNhbnZhcyB1c2luZyB0aGUgcHJvdmlkZWQgY29udGV4dFxyXG4gICAqXHJcbiAgICogQHBhcmFtICB7bnVtYmVyfSB4XHJcbiAgICogQHBhcmFtICB7bnVtYmVyfSB5XHJcbiAgICogQHBhcmFtICB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjb250ZXh0XHJcbiAgICovXHJcbiAgZHJhd1Byb3RvbldpdGhDYW52YXMoIHgsIHksIGNvbnRleHQgKSB7XHJcbiAgICBkcmF3UGFydGljbGVXaXRoQ2FudmFzKCB4LCB5LCBQUk9UT05fUkFESVVTLCBQUk9UT05fQ09MT1IsIGNvbnRleHQgKTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiBEcmF3IGEgbmV1dHJvbiB3aXRoIGNhbnZhcyB1c2luZyB0aGUgcHJvdmlkZWQgY29udGV4dFxyXG4gICAqXHJcbiAgICogQHBhcmFtICB7bnVtYmVyfSB4XHJcbiAgICogQHBhcmFtICB7bnVtYmVyfSB5XHJcbiAgICogQHBhcmFtICB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjb250ZXh0XHJcbiAgICovXHJcbiAgZHJhd05ldXRyb25XaXRoQ2FudmFzKCB4LCB5LCBjb250ZXh0ICkge1xyXG4gICAgZHJhd1BhcnRpY2xlV2l0aENhbnZhcyggeCwgeSwgTkVVVFJPTl9SQURJVVMsIE5FVVRST05fQ09MT1IsIGNvbnRleHQgKTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgbnVjbGV1cyBub2RlLCByZXByZXNlbnRlZCBieSBhIHNtYWxsIGNpcmNsZS5cclxuICAgKiBAcmV0dXJucyB7Tm9kZX1cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgY3JlYXRlTnVjbGV1cygpIHtcclxuICAgIHJldHVybiBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIG5ldyBDaXJjbGUoIE5VQ0xFVVNfUkFESVVTLCB7IGZpbGw6IFJTQ29sb3JzLm51Y2xldXNDb2xvclByb3BlcnR5IH0gKVxyXG4gICAgICBdXHJcbiAgICB9ICk7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGFuIGljb24gZm9yIHRoZSBsZWdlbmQgZGVzY3JpYmluZyB0aGUgZW5lcmd5IGxldmVsIG9mIGFuIGVsZWN0cm9uXHJcbiAgICogQHJldHVybnMge05vZGV9IFtkZXNjcmlwdGlvbl1cclxuICAgKi9cclxuICBjcmVhdGVFbmVyZ3lMZXZlbCgpIHtcclxuICAgIHJldHVybiBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIG5ldyBMaW5lKCAwLCAwLCBFTkVSR1lfTEVWRUxfTElORV9MRU5HVEgsIDAsIHsgc3Ryb2tlOiBFTkVSR1lfTEVWRUxfQ09MT1IgfSApLFxyXG4gICAgICAgIG5ldyBMaW5lKCAyICogRU5FUkdZX0xFVkVMX0xJTkVfTEVOR1RILCAwLCAzICogRU5FUkdZX0xFVkVMX0xJTkVfTEVOR1RILCAwLCB7IHN0cm9rZTogRU5FUkdZX0xFVkVMX0NPTE9SIH0gKSxcclxuICAgICAgICBuZXcgTGluZSggNCAqIEVORVJHWV9MRVZFTF9MSU5FX0xFTkdUSCwgMCwgNSAqIEVORVJHWV9MRVZFTF9MSU5FX0xFTkdUSCwgMCwgeyBzdHJva2U6IEVORVJHWV9MRVZFTF9DT0xPUiB9IClcclxuICAgICAgXVxyXG4gICAgfSApO1xyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBhbiBpY29uIGZvciB0aGUgbGVnZW5kIGRlc2NyaWJpbmcgdGhlIHBhcnRpY2xlIHRyYWNlLCByZXByZXNlbnRlZCBhcyBhbiBhcnJvd1xyXG4gICAqIEByZXR1cm5zIHtOb2RlfVxyXG4gICAqL1xyXG4gIGNyZWF0ZVBhcnRpY2xlVHJhY2UoKSB7XHJcbiAgICByZXR1cm4gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBuZXcgQXJyb3dOb2RlKCAwLCAwLCAyMCwgMCwge1xyXG4gICAgICAgICAgZmlsbDogUEFSVElDTEVfQ09MT1IsXHJcbiAgICAgICAgICB0YWlsV2lkdGg6IDIsXHJcbiAgICAgICAgICBoZWFkSGVpZ2h0OiAxMFxyXG4gICAgICAgIH0gKVxyXG4gICAgICBdXHJcbiAgICB9ICk7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhbiBhbHBoYSBwYXJ0aWNsZSBub2RlLCByZXByZXNlbnRlZCBieSB0d28gcHJvdG9ucyBhbmQgdHdvIG5ldXRyb25zLlxyXG4gICAqIEByZXR1cm5zIHtOb2RlfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBjcmVhdGVOdWNsZXVzQWxwaGEoKSB7XHJcbiAgICByZXR1cm4gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBuZXcgUGFydGljbGVOb2RlKCBORVVUUk9OX1JBRElVUywgTkVVVFJPTl9DT0xPUiwgeyB4OiBORVVUUk9OX1JBRElVUyAtIDEsIHk6IC1ORVVUUk9OX1JBRElVUyB9ICksXHJcbiAgICAgICAgbmV3IFBhcnRpY2xlTm9kZSggTkVVVFJPTl9SQURJVVMsIE5FVVRST05fQ09MT1IsIHsgeDogLU5FVVRST05fUkFESVVTICsgMSwgeTogTkVVVFJPTl9SQURJVVMgfSApLFxyXG4gICAgICAgIG5ldyBQYXJ0aWNsZU5vZGUoIFBST1RPTl9SQURJVVMsIFBST1RPTl9DT0xPUiwgeyB4OiAtUFJPVE9OX1JBRElVUyArIDEsIHk6IC1QUk9UT05fUkFESVVTICsgMSB9ICksXHJcbiAgICAgICAgbmV3IFBhcnRpY2xlTm9kZSggUFJPVE9OX1JBRElVUywgUFJPVE9OX0NPTE9SLCB7IHg6IFBST1RPTl9SQURJVVMgLSAxLCB5OiBQUk9UT05fUkFESVVTIC0gMSB9IClcclxuICAgICAgXVxyXG4gICAgfSApO1xyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYW4gYWxwaGEgcGFydGljbGUgbm9kZSwgcmVwcmVzZW50ZWQgYnkgYSBzbWFsbCBjaXJjbGUuXHJcbiAgICogQHJldHVybnMge05vZGV9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNyZWF0ZVBhcnRpY2xlQWxwaGEoKSB7XHJcbiAgICByZXR1cm4gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBuZXcgQ2lyY2xlKCBQQVJUSUNMRV9SQURJVVMsIHsgZmlsbDogUEFSVElDTEVfQ09MT1IgfSApXHJcbiAgICAgIF1cclxuICAgIH0gKTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgcGx1bSBwdWRkaW5nIGltYWdlLlxyXG4gICAqIEByZXR1cm5zIHtOb2RlfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBjcmVhdGVQbHVtUHVkZGluZ0ljb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBuZXcgSW1hZ2UoIHBsdW1QdWRkaW5nSWNvbl9wbmcsIHsgc2NhbGU6IDAuMDYgfSApXHJcbiAgICAgIF1cclxuICAgIH0gKTtcclxuICB9XHJcblxyXG59O1xyXG5cclxucnV0aGVyZm9yZFNjYXR0ZXJpbmcucmVnaXN0ZXIoICdQYXJ0aWNsZU5vZGVGYWN0b3J5JywgUGFydGljbGVOb2RlRmFjdG9yeSApO1xyXG5cclxuY2xhc3MgUGFydGljbGVOb2RlIGV4dGVuZHMgQ2lyY2xlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHJhZGl1c1xyXG4gICAqIEBwYXJhbSB7Q29sb3J8U3RyaW5nfSBjb2xvclxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCByYWRpdXMsIGNvbG9yLCBvcHRpb25zICkge1xyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhb3B0aW9ucy5maWxsICk7XHJcblxyXG4gICAgb3B0aW9ucy5maWxsID0gbmV3IFJhZGlhbEdyYWRpZW50KCByYWRpdXMgKiAwLjEsIHJhZGl1cyAqIDAuNywgMC4yLCAtcmFkaXVzICogMC4yLCAtcmFkaXVzICogMC4zLCByYWRpdXMgKiAyIClcclxuICAgICAgLmFkZENvbG9yU3RvcCggMCwgU1BFQ1VMQVJfSElHSExJVEVfQ09MT1IgKVxyXG4gICAgICAuYWRkQ29sb3JTdG9wKCAwLjMzLCBjb2xvciApXHJcbiAgICAgIC5hZGRDb2xvclN0b3AoIDEsICdibGFjaycgKTtcclxuICAgIHN1cGVyKCByYWRpdXMsIG9wdGlvbnMgKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEcmF3IGEgcGFydGljbGUgb24gYSBjYW52YXMgdXNpbmcgdGhlIHByb3ZpZGVkIGNvbnRleHQuICBUaGUgcGFydGljbGUgaXMgYXQgcG9zaXRpb24gKHgseSkgaW4gdGhlXHJcbiAqIGNvb3JkaW5hdGUgZnJhbWVzIG9mIHRoZSBjYW52YXMuXHJcbiAqXHJcbiAqIEBwYXJhbSAge251bWJlcn0geFxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHlcclxuICogQHBhcmFtICB7bnVtYmVyfSByYWRpdXNcclxuICogQHBhcmFtICB7c3RyaW5nfSBjb2xvclxyXG4gKiBAcGFyYW0gIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGNvbnRleHRcclxuICovXHJcbmNvbnN0IGRyYXdQYXJ0aWNsZVdpdGhDYW52YXMgPSAoIHgsIHksIHJhZGl1cywgY29sb3IsIGNvbnRleHQgKSA9PiB7XHJcbiAgLy8gZHJhdyB0aGUgY2lyY2xlXHJcbiAgY29udGV4dC5iZWdpblBhdGgoKTtcclxuICBjb250ZXh0LmFyYyggeCwgeSwgcmFkaXVzLCAwLCAyICogTWF0aC5QSSwgZmFsc2UgKTtcclxuXHJcbiAgY29uc3QgdXNlQ29uY2VudHJpYyA9ICEhcGxhdGZvcm0uc2FmYXJpO1xyXG4gIGNvbnN0IHgwID0gdXNlQ29uY2VudHJpYyA/IHggLSAwLjA2NiA6IHggKyByYWRpdXMgKiAwLjE7XHJcbiAgY29uc3QgeTAgPSB1c2VDb25jZW50cmljID8geSArIDAuMiAqIHJhZGl1cyA6IHkgKyByYWRpdXMgKiAwLjc7XHJcbiAgY29uc3QgeDEgPSB1c2VDb25jZW50cmljID8geCAtIDAuMDY2IDogeCArIC1yYWRpdXMgKiAwLjI7XHJcbiAgY29uc3QgeTEgPSB1c2VDb25jZW50cmljID8geSArIDAuMiAqIHJhZGl1cyA6IHkgKyAtcmFkaXVzICogMC4zO1xyXG5cclxuICAvLyBjcmVhdGUgdGhlIHJhZGlhbCBncmFkaWVudCBmcm9tIHRoZSBjZW50ZXIgb2YgdGhlIGFyY1xyXG4gIGNvbnN0IGdyYWRpZW50ID0gY29udGV4dC5jcmVhdGVSYWRpYWxHcmFkaWVudCggeDAsIHkwLCAwLjIsIHgxLCB5MSwgcmFkaXVzICogMiApO1xyXG4gIGdyYWRpZW50LmFkZENvbG9yU3RvcCggMCwgU1BFQ1VMQVJfSElHSExJVEVfQ09MT1IgKTtcclxuICBncmFkaWVudC5hZGRDb2xvclN0b3AoIDAuMzMsIGNvbG9yICk7XHJcbiAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKCAxLCAnYmxhY2snICk7XHJcbiAgY29udGV4dC5maWxsU3R5bGUgPSBncmFkaWVudDtcclxuXHJcbiAgLy8gZmlsbCBhbmQgY2xvc2Ugc28gdGhhdCB0aGUgY29udGV4dCBjYW4gYmUgdXNlZCB0byBkcmF3IG1vcmUgcGFydGljbGVzXHJcbiAgY29udGV4dC5maWxsKCk7XHJcbiAgY29udGV4dC5jbG9zZVBhdGgoKTtcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0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