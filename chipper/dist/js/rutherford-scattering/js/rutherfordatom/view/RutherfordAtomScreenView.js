// Copyright 2016-2023, University of Colorado Boulder

/**
 * View for the 'Rutherford Atom' screen.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { AlignGroup, colorProfileProperty, Image, Node, SceneryConstants, Text } from '../../../../scenery/js/imports.js';
import RectangularRadioButtonGroup from '../../../../sun/js/buttons/RectangularRadioButtonGroup.js';
import atom_png from '../../../images/atom_png.js';
import atomProjector_png from '../../../images/atomProjector_png.js';
import RSColors from '../../common/RSColors.js';
import RSQueryParameters from '../../common/RSQueryParameters.js';
import AlphaParticlePropertiesPanel from '../../common/view/AlphaParticlePropertiesPanel.js';
import NuclearParticleLegendPanel from '../../common/view/NuclearParticleLegendPanel.js';
import ParticleLegendPanel from '../../common/view/ParticleLegendPanel.js';
import RSBaseScreenView from '../../common/view/RSBaseScreenView.js';
import ScaleInfoNode from '../../common/view/ScaleInfoNode.js';
import rutherfordScattering from '../../rutherfordScattering.js';
import RutherfordScatteringStrings from '../../RutherfordScatteringStrings.js';
import AtomParticleLegendPanel from './AtomParticleLegendPanel.js';
import AtomPropertiesPanel from './AtomPropertiesPanel.js';
import AtomSpaceNode from './AtomSpaceNode.js';
import NucleusSpaceNode from './NucleusSpaceNode.js';
import RutherfordNucleusNode from './RutherfordNucleusNode.js';

// constants
const pattern0AtomicScaleString = RutherfordScatteringStrings.pattern['0atomicScale'];
const pattern0NuclearScaleString = RutherfordScatteringStrings.pattern['0nuclearScale'];
const switchScaleString = RutherfordScatteringStrings.a11y.switchScale;
const switchScaleDescriptionString = RutherfordScatteringStrings.a11y.switchScaleDescription;
const nuclearScaleViewString = RutherfordScatteringStrings.a11y.nuclearScaleView;
const atomicScaleViewString = RutherfordScatteringStrings.a11y.atomicScaleView;
class RutherfordAtomScreenView extends RSBaseScreenView {
  /**
   * @param {RutherfordAtomModel} model
   */
  constructor(model) {
    const nucleusScaleString = StringUtils.format(pattern0NuclearScaleString, '1.5 x 10<sup>-13</sup>');
    const atomicScaleString = StringUtils.format(pattern0AtomicScaleString, '6.0 x 10<sup>-10</sup>');
    super(model, nucleusScaleString, createSpaceNode, {
      includeElectronLegend: false
    });

    // scale info for the 'atom' scene, only visible when atom scene is selected
    const atomicScaleInfoNode = new ScaleInfoNode(atomicScaleString, this.spaceNode.getWidth(), {
      center: this.scaleInfoNode.center
    });
    this.addChild(atomicScaleInfoNode);

    // create the panels of the control panel on the right
    const createPanels = () => {
      let legendContent;
      const atomSceneVisible = model.sceneProperty.value === 'atom';

      // create content for the control panels
      const atomLegendContent = AtomParticleLegendPanel.createPanelContent({
        resize: false
      });
      const nuclearLegendContent = NuclearParticleLegendPanel.createPanelContent({
        resize: false,
        includeElectron: false,
        includePlumPudding: false
      });
      const particlePropertiesContent = AlphaParticlePropertiesPanel.createPanelContent(model.energyInteractionProperty, model.alphaParticleEnergyProperty, this.showAlphaTraceProperty, {
        resize: false
      });
      const atomPropertiesContent = AtomPropertiesPanel.createPanelContent(model, {
        resize: false
      });

      // make sure that content for all panels are aligned and the legend content is aligned to the left
      // this content does not include title
      const contentAlignGroup = new AlignGroup({
        matchVertical: false
      });
      const atomContentBox = contentAlignGroup.createBox(atomLegendContent, {
        xAlign: ParticleLegendPanel.LEGEND_CONTENT_ALIGN
      });
      const nuclearContentBox = contentAlignGroup.createBox(nuclearLegendContent, {
        xAlign: ParticleLegendPanel.LEGEND_CONTENT_ALIGN
      });
      const particlePropertiesContentBox = contentAlignGroup.createBox(particlePropertiesContent);
      const atromPropertiesContentBox = contentAlignGroup.createBox(atomPropertiesContent);

      // create content for the legend panels
      if (atomSceneVisible) {
        legendContent = atomContentBox;
      } else {
        legendContent = nuclearContentBox;
      }

      // create the panels
      const panelOptions = {
        resize: false
      };
      const legendPanel = atomSceneVisible ? new AtomParticleLegendPanel(legendContent, panelOptions) : new NuclearParticleLegendPanel(legendContent, panelOptions);
      const particlePropertiesPanel = new AlphaParticlePropertiesPanel(particlePropertiesContentBox, panelOptions);
      const atomPropertiesPanel = new AtomPropertiesPanel(atromPropertiesContentBox, panelOptions);
      return [legendPanel, particlePropertiesPanel, atomPropertiesPanel];
    };

    // when various panels are added/removed due to changing color profile or scene, reset the accessible order
    const restorePDOMOrder = () => {
      this.pdomPlayAreaNode.pdomOrder = [this.gunNode];
      this.pdomControlAreaNode.pdomOrder = _.uniq(this.pdomControlAreaNode.pdomOrder.concat([this.controlPanel, this.sceneRadioButtonGroup].filter(_.identity)));
    };

    // {Node} control panel is created below by sceneProperty listener, to correspond to scene
    let controlPanel = null;

    // for the 'Atom' scene, the beam should be semi-transparent, the scale indicator
    // should be updated, and the control/legend panels need to change
    // no need to unlink, screen view exists for life of sim
    model.sceneProperty.link(scene => {
      const beam = this.beamNode;
      const atomSceneVisible = scene === 'atom';

      // update visibility of scene specific scale info
      this.scaleInfoNode.visible = !atomSceneVisible;
      atomicScaleInfoNode.visible = atomSceneVisible;

      // recenter the gun beam and set new fill
      beam.centerX = this.gunNode.centerX;
      beam.fill = atomSceneVisible ? RSColors.atomBeamColorProperty : RSColors.nucleusBeamColorProperty;

      // dispose and remove the old control panel
      if (controlPanel) {
        this.removeChild(controlPanel);
        controlPanel.dispose();
      }

      // create the new control panel
      const panels = createPanels();
      controlPanel = this.createControlPanel(panels);
      this.addChild(controlPanel);
      restorePDOMOrder();
    });

    /**
     * Create the RadioButonGroup that will act as the scene selection control in this sim. New buttons must be
     * created every time the color profile changes.
     *
     * @param {Image} atomIconImage - the icon for the atomic scene, changes with color profile
     * @returns {RectangularRadioButtonGroup} - returns a RectangularRadioButtonGroup that must be disposed when profile changes
     */
    const createRadioButtons = atomIconImage => new RectangularRadioButtonGroup(model.sceneProperty, [{
      value: 'atom',
      createNode: () => new Image(atomIconImage, {
        scale: 0.18
      }),
      labelContent: atomicScaleViewString
    }, {
      value: 'nucleus',
      createNode: () => RutherfordNucleusNode.RutherfordNucleusIcon(20, 20),
      labelContent: nuclearScaleViewString
    }], {
      orientation: 'vertical',
      spacing: 15,
      left: this.targetMaterialNode.left,
      top: this.spaceNode.top,
      radioButtonOptions: {
        baseColor: RSColors.panelColorProperty.value,
        // TODO: update this when requested
        yMargin: 8,
        buttonAppearanceStrategyOptions: {
          deselectedStroke: RSColors.panelBorderColorProperty.value,
          // TODO: update this when requested
          selectedStroke: RSColors.radioButtonBorderColorProperty,
          // TODO: update this when requested
          selectedLineWidth: 2,
          deselectedLineWidth: 1.5
        }
      },
      maxWidth: this.targetMaterialNode.width,
      tagName: 'div',
      descriptionContent: switchScaleDescriptionString,
      labelTagName: 'h3',
      labelContent: switchScaleString,
      appendDescription: true
    });

    // @private
    this.sceneRadioButtonGroup = createRadioButtons(atom_png);
    this.pdomControlAreaNode.addChild(this.sceneRadioButtonGroup);

    // if the background, panel or stroke colors change, draw a new button group
    // no need to unlink, screen view exists for life of sim
    colorProfileProperty.link(profileName => {
      // remove and dispose of the old button group
      this.pdomControlAreaNode.removeChild(this.sceneRadioButtonGroup);
      this.sceneRadioButtonGroup.dispose();

      // get the correct image for the 'atom' scene icon
      const iconImage = profileName === SceneryConstants.PROJECTOR_COLOR_PROFILE ? atomProjector_png : atom_png;

      // create the new radio button group
      const newButtonGroup = createRadioButtons(iconImage);
      this.sceneRadioButtonGroup = newButtonGroup;
      this.pdomControlAreaNode.addChild(newButtonGroup);

      // add laser, all control panels, and scene buttons to pdomOrder, must be set after
      // creating new radio buttons
      restorePDOMOrder();
    });
    restorePDOMOrder();
  }
}

/**
 * Create the node in which atoms and alpha particles are rendered.  Node contains both
 * scene representations, and visibility is controlled from this node.
 *
 * @param {RutherfordAtomModel} model
 * @param {Property.<boolean>} showAlphaTraceProperty
 * @param {ModelViewTransform2} modelViewTransform
 * @param {Bounds2} canvasBounds
 * @returns {Node}
 */
const createSpaceNode = (model, showAlphaTraceProperty, modelViewTransform, canvasBounds) => {
  // create the single nucleus representation scene
  const nucleusSpaceNode = new NucleusSpaceNode(model, showAlphaTraceProperty, modelViewTransform, {
    canvasBounds: canvasBounds
  });

  // create the multiple atom representation scene
  const atomSpaceNode = new AtomSpaceNode(model, showAlphaTraceProperty, modelViewTransform, {
    canvasBounds: canvasBounds
  });
  if (RSQueryParameters.showErrorCount) {
    // show the number of particles that were removed from the space in error
    const errorCountPattern = 'Error count: {{numRemoved}}';
    const errorText = new Text('', {
      font: new PhetFont(18),
      fill: 'red',
      leftBottom: atomSpaceNode.leftTop
    });
    atomSpaceNode.addChild(errorText);
    let atomsRemoved = 0;
    model.atomSpace.particleRemovedFromAtomEmitter.addListener(particle => {
      atomsRemoved += 1;
      errorText.string = StringUtils.fillIn(errorCountPattern, {
        numRemoved: atomsRemoved
      });
    });
  }

  // update view on model step
  model.addStepListener(dt => {
    nucleusSpaceNode.invalidatePaint();
    atomSpaceNode.invalidatePaint();
  });

  // update which scene is visible and remove all particles
  // no need to unlink, screen view exists for life of sim
  model.sceneProperty.link(scene => {
    const nucleusVisible = scene === 'nucleus';

    // set visibility of model space
    model.nucleusSpace.isVisible = nucleusVisible;
    model.atomSpace.isVisible = !nucleusVisible;

    // set node visibility
    nucleusSpaceNode.visible = nucleusVisible;
    atomSpaceNode.visible = !nucleusVisible;
    model.removeAllParticles();
  });
  return new Node({
    children: [nucleusSpaceNode, atomSpaceNode]
  });
};
rutherfordScattering.register('RutherfordAtomScreenView', RutherfordAtomScreenView);
export default RutherfordAtomScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTdHJpbmdVdGlscyIsIlBoZXRGb250IiwiQWxpZ25Hcm91cCIsImNvbG9yUHJvZmlsZVByb3BlcnR5IiwiSW1hZ2UiLCJOb2RlIiwiU2NlbmVyeUNvbnN0YW50cyIsIlRleHQiLCJSZWN0YW5ndWxhclJhZGlvQnV0dG9uR3JvdXAiLCJhdG9tX3BuZyIsImF0b21Qcm9qZWN0b3JfcG5nIiwiUlNDb2xvcnMiLCJSU1F1ZXJ5UGFyYW1ldGVycyIsIkFscGhhUGFydGljbGVQcm9wZXJ0aWVzUGFuZWwiLCJOdWNsZWFyUGFydGljbGVMZWdlbmRQYW5lbCIsIlBhcnRpY2xlTGVnZW5kUGFuZWwiLCJSU0Jhc2VTY3JlZW5WaWV3IiwiU2NhbGVJbmZvTm9kZSIsInJ1dGhlcmZvcmRTY2F0dGVyaW5nIiwiUnV0aGVyZm9yZFNjYXR0ZXJpbmdTdHJpbmdzIiwiQXRvbVBhcnRpY2xlTGVnZW5kUGFuZWwiLCJBdG9tUHJvcGVydGllc1BhbmVsIiwiQXRvbVNwYWNlTm9kZSIsIk51Y2xldXNTcGFjZU5vZGUiLCJSdXRoZXJmb3JkTnVjbGV1c05vZGUiLCJwYXR0ZXJuMEF0b21pY1NjYWxlU3RyaW5nIiwicGF0dGVybiIsInBhdHRlcm4wTnVjbGVhclNjYWxlU3RyaW5nIiwic3dpdGNoU2NhbGVTdHJpbmciLCJhMTF5Iiwic3dpdGNoU2NhbGUiLCJzd2l0Y2hTY2FsZURlc2NyaXB0aW9uU3RyaW5nIiwic3dpdGNoU2NhbGVEZXNjcmlwdGlvbiIsIm51Y2xlYXJTY2FsZVZpZXdTdHJpbmciLCJudWNsZWFyU2NhbGVWaWV3IiwiYXRvbWljU2NhbGVWaWV3U3RyaW5nIiwiYXRvbWljU2NhbGVWaWV3IiwiUnV0aGVyZm9yZEF0b21TY3JlZW5WaWV3IiwiY29uc3RydWN0b3IiLCJtb2RlbCIsIm51Y2xldXNTY2FsZVN0cmluZyIsImZvcm1hdCIsImF0b21pY1NjYWxlU3RyaW5nIiwiY3JlYXRlU3BhY2VOb2RlIiwiaW5jbHVkZUVsZWN0cm9uTGVnZW5kIiwiYXRvbWljU2NhbGVJbmZvTm9kZSIsInNwYWNlTm9kZSIsImdldFdpZHRoIiwiY2VudGVyIiwic2NhbGVJbmZvTm9kZSIsImFkZENoaWxkIiwiY3JlYXRlUGFuZWxzIiwibGVnZW5kQ29udGVudCIsImF0b21TY2VuZVZpc2libGUiLCJzY2VuZVByb3BlcnR5IiwidmFsdWUiLCJhdG9tTGVnZW5kQ29udGVudCIsImNyZWF0ZVBhbmVsQ29udGVudCIsInJlc2l6ZSIsIm51Y2xlYXJMZWdlbmRDb250ZW50IiwiaW5jbHVkZUVsZWN0cm9uIiwiaW5jbHVkZVBsdW1QdWRkaW5nIiwicGFydGljbGVQcm9wZXJ0aWVzQ29udGVudCIsImVuZXJneUludGVyYWN0aW9uUHJvcGVydHkiLCJhbHBoYVBhcnRpY2xlRW5lcmd5UHJvcGVydHkiLCJzaG93QWxwaGFUcmFjZVByb3BlcnR5IiwiYXRvbVByb3BlcnRpZXNDb250ZW50IiwiY29udGVudEFsaWduR3JvdXAiLCJtYXRjaFZlcnRpY2FsIiwiYXRvbUNvbnRlbnRCb3giLCJjcmVhdGVCb3giLCJ4QWxpZ24iLCJMRUdFTkRfQ09OVEVOVF9BTElHTiIsIm51Y2xlYXJDb250ZW50Qm94IiwicGFydGljbGVQcm9wZXJ0aWVzQ29udGVudEJveCIsImF0cm9tUHJvcGVydGllc0NvbnRlbnRCb3giLCJwYW5lbE9wdGlvbnMiLCJsZWdlbmRQYW5lbCIsInBhcnRpY2xlUHJvcGVydGllc1BhbmVsIiwiYXRvbVByb3BlcnRpZXNQYW5lbCIsInJlc3RvcmVQRE9NT3JkZXIiLCJwZG9tUGxheUFyZWFOb2RlIiwicGRvbU9yZGVyIiwiZ3VuTm9kZSIsInBkb21Db250cm9sQXJlYU5vZGUiLCJfIiwidW5pcSIsImNvbmNhdCIsImNvbnRyb2xQYW5lbCIsInNjZW5lUmFkaW9CdXR0b25Hcm91cCIsImZpbHRlciIsImlkZW50aXR5IiwibGluayIsInNjZW5lIiwiYmVhbSIsImJlYW1Ob2RlIiwidmlzaWJsZSIsImNlbnRlclgiLCJmaWxsIiwiYXRvbUJlYW1Db2xvclByb3BlcnR5IiwibnVjbGV1c0JlYW1Db2xvclByb3BlcnR5IiwicmVtb3ZlQ2hpbGQiLCJkaXNwb3NlIiwicGFuZWxzIiwiY3JlYXRlQ29udHJvbFBhbmVsIiwiY3JlYXRlUmFkaW9CdXR0b25zIiwiYXRvbUljb25JbWFnZSIsImNyZWF0ZU5vZGUiLCJzY2FsZSIsImxhYmVsQ29udGVudCIsIlJ1dGhlcmZvcmROdWNsZXVzSWNvbiIsIm9yaWVudGF0aW9uIiwic3BhY2luZyIsImxlZnQiLCJ0YXJnZXRNYXRlcmlhbE5vZGUiLCJ0b3AiLCJyYWRpb0J1dHRvbk9wdGlvbnMiLCJiYXNlQ29sb3IiLCJwYW5lbENvbG9yUHJvcGVydHkiLCJ5TWFyZ2luIiwiYnV0dG9uQXBwZWFyYW5jZVN0cmF0ZWd5T3B0aW9ucyIsImRlc2VsZWN0ZWRTdHJva2UiLCJwYW5lbEJvcmRlckNvbG9yUHJvcGVydHkiLCJzZWxlY3RlZFN0cm9rZSIsInJhZGlvQnV0dG9uQm9yZGVyQ29sb3JQcm9wZXJ0eSIsInNlbGVjdGVkTGluZVdpZHRoIiwiZGVzZWxlY3RlZExpbmVXaWR0aCIsIm1heFdpZHRoIiwid2lkdGgiLCJ0YWdOYW1lIiwiZGVzY3JpcHRpb25Db250ZW50IiwibGFiZWxUYWdOYW1lIiwiYXBwZW5kRGVzY3JpcHRpb24iLCJwcm9maWxlTmFtZSIsImljb25JbWFnZSIsIlBST0pFQ1RPUl9DT0xPUl9QUk9GSUxFIiwibmV3QnV0dG9uR3JvdXAiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJjYW52YXNCb3VuZHMiLCJudWNsZXVzU3BhY2VOb2RlIiwiYXRvbVNwYWNlTm9kZSIsInNob3dFcnJvckNvdW50IiwiZXJyb3JDb3VudFBhdHRlcm4iLCJlcnJvclRleHQiLCJmb250IiwibGVmdEJvdHRvbSIsImxlZnRUb3AiLCJhdG9tc1JlbW92ZWQiLCJhdG9tU3BhY2UiLCJwYXJ0aWNsZVJlbW92ZWRGcm9tQXRvbUVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsInBhcnRpY2xlIiwic3RyaW5nIiwiZmlsbEluIiwibnVtUmVtb3ZlZCIsImFkZFN0ZXBMaXN0ZW5lciIsImR0IiwiaW52YWxpZGF0ZVBhaW50IiwibnVjbGV1c1Zpc2libGUiLCJudWNsZXVzU3BhY2UiLCJpc1Zpc2libGUiLCJyZW1vdmVBbGxQYXJ0aWNsZXMiLCJjaGlsZHJlbiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUnV0aGVyZm9yZEF0b21TY3JlZW5WaWV3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFZpZXcgZm9yIHRoZSAnUnV0aGVyZm9yZCBBdG9tJyBzY3JlZW4uXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUGhldEZvbnQuanMnO1xyXG5pbXBvcnQgeyBBbGlnbkdyb3VwLCBjb2xvclByb2ZpbGVQcm9wZXJ0eSwgSW1hZ2UsIE5vZGUsIFNjZW5lcnlDb25zdGFudHMsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwIGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9idXR0b25zL1JlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cC5qcyc7XHJcbmltcG9ydCBhdG9tX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvYXRvbV9wbmcuanMnO1xyXG5pbXBvcnQgYXRvbVByb2plY3Rvcl9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2F0b21Qcm9qZWN0b3JfcG5nLmpzJztcclxuaW1wb3J0IFJTQ29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi9SU0NvbG9ycy5qcyc7XHJcbmltcG9ydCBSU1F1ZXJ5UGFyYW1ldGVycyBmcm9tICcuLi8uLi9jb21tb24vUlNRdWVyeVBhcmFtZXRlcnMuanMnO1xyXG5pbXBvcnQgQWxwaGFQYXJ0aWNsZVByb3BlcnRpZXNQYW5lbCBmcm9tICcuLi8uLi9jb21tb24vdmlldy9BbHBoYVBhcnRpY2xlUHJvcGVydGllc1BhbmVsLmpzJztcclxuaW1wb3J0IE51Y2xlYXJQYXJ0aWNsZUxlZ2VuZFBhbmVsIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L051Y2xlYXJQYXJ0aWNsZUxlZ2VuZFBhbmVsLmpzJztcclxuaW1wb3J0IFBhcnRpY2xlTGVnZW5kUGFuZWwgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvUGFydGljbGVMZWdlbmRQYW5lbC5qcyc7XHJcbmltcG9ydCBSU0Jhc2VTY3JlZW5WaWV3IGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L1JTQmFzZVNjcmVlblZpZXcuanMnO1xyXG5pbXBvcnQgU2NhbGVJbmZvTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9TY2FsZUluZm9Ob2RlLmpzJztcclxuaW1wb3J0IHJ1dGhlcmZvcmRTY2F0dGVyaW5nIGZyb20gJy4uLy4uL3J1dGhlcmZvcmRTY2F0dGVyaW5nLmpzJztcclxuaW1wb3J0IFJ1dGhlcmZvcmRTY2F0dGVyaW5nU3RyaW5ncyBmcm9tICcuLi8uLi9SdXRoZXJmb3JkU2NhdHRlcmluZ1N0cmluZ3MuanMnO1xyXG5pbXBvcnQgQXRvbVBhcnRpY2xlTGVnZW5kUGFuZWwgZnJvbSAnLi9BdG9tUGFydGljbGVMZWdlbmRQYW5lbC5qcyc7XHJcbmltcG9ydCBBdG9tUHJvcGVydGllc1BhbmVsIGZyb20gJy4vQXRvbVByb3BlcnRpZXNQYW5lbC5qcyc7XHJcbmltcG9ydCBBdG9tU3BhY2VOb2RlIGZyb20gJy4vQXRvbVNwYWNlTm9kZS5qcyc7XHJcbmltcG9ydCBOdWNsZXVzU3BhY2VOb2RlIGZyb20gJy4vTnVjbGV1c1NwYWNlTm9kZS5qcyc7XHJcbmltcG9ydCBSdXRoZXJmb3JkTnVjbGV1c05vZGUgZnJvbSAnLi9SdXRoZXJmb3JkTnVjbGV1c05vZGUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IHBhdHRlcm4wQXRvbWljU2NhbGVTdHJpbmcgPSBSdXRoZXJmb3JkU2NhdHRlcmluZ1N0cmluZ3MucGF0dGVyblsgJzBhdG9taWNTY2FsZScgXTtcclxuY29uc3QgcGF0dGVybjBOdWNsZWFyU2NhbGVTdHJpbmcgPSBSdXRoZXJmb3JkU2NhdHRlcmluZ1N0cmluZ3MucGF0dGVyblsgJzBudWNsZWFyU2NhbGUnIF07XHJcbmNvbnN0IHN3aXRjaFNjYWxlU3RyaW5nID0gUnV0aGVyZm9yZFNjYXR0ZXJpbmdTdHJpbmdzLmExMXkuc3dpdGNoU2NhbGU7XHJcbmNvbnN0IHN3aXRjaFNjYWxlRGVzY3JpcHRpb25TdHJpbmcgPSBSdXRoZXJmb3JkU2NhdHRlcmluZ1N0cmluZ3MuYTExeS5zd2l0Y2hTY2FsZURlc2NyaXB0aW9uO1xyXG5jb25zdCBudWNsZWFyU2NhbGVWaWV3U3RyaW5nID0gUnV0aGVyZm9yZFNjYXR0ZXJpbmdTdHJpbmdzLmExMXkubnVjbGVhclNjYWxlVmlldztcclxuY29uc3QgYXRvbWljU2NhbGVWaWV3U3RyaW5nID0gUnV0aGVyZm9yZFNjYXR0ZXJpbmdTdHJpbmdzLmExMXkuYXRvbWljU2NhbGVWaWV3O1xyXG5cclxuY2xhc3MgUnV0aGVyZm9yZEF0b21TY3JlZW5WaWV3IGV4dGVuZHMgUlNCYXNlU2NyZWVuVmlldyB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7UnV0aGVyZm9yZEF0b21Nb2RlbH0gbW9kZWxcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbW9kZWwgKSB7XHJcblxyXG4gICAgY29uc3QgbnVjbGV1c1NjYWxlU3RyaW5nID0gU3RyaW5nVXRpbHMuZm9ybWF0KCBwYXR0ZXJuME51Y2xlYXJTY2FsZVN0cmluZywgJzEuNSB4IDEwPHN1cD4tMTM8L3N1cD4nICk7XHJcbiAgICBjb25zdCBhdG9taWNTY2FsZVN0cmluZyA9IFN0cmluZ1V0aWxzLmZvcm1hdCggcGF0dGVybjBBdG9taWNTY2FsZVN0cmluZywgJzYuMCB4IDEwPHN1cD4tMTA8L3N1cD4nICk7XHJcblxyXG4gICAgc3VwZXIoIG1vZGVsLCBudWNsZXVzU2NhbGVTdHJpbmcsIGNyZWF0ZVNwYWNlTm9kZSwge1xyXG4gICAgICBpbmNsdWRlRWxlY3Ryb25MZWdlbmQ6IGZhbHNlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gc2NhbGUgaW5mbyBmb3IgdGhlICdhdG9tJyBzY2VuZSwgb25seSB2aXNpYmxlIHdoZW4gYXRvbSBzY2VuZSBpcyBzZWxlY3RlZFxyXG4gICAgY29uc3QgYXRvbWljU2NhbGVJbmZvTm9kZSA9IG5ldyBTY2FsZUluZm9Ob2RlKCBhdG9taWNTY2FsZVN0cmluZywgdGhpcy5zcGFjZU5vZGUuZ2V0V2lkdGgoKSwge1xyXG4gICAgICBjZW50ZXI6IHRoaXMuc2NhbGVJbmZvTm9kZS5jZW50ZXJcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGF0b21pY1NjYWxlSW5mb05vZGUgKTtcclxuXHJcbiAgICAvLyBjcmVhdGUgdGhlIHBhbmVscyBvZiB0aGUgY29udHJvbCBwYW5lbCBvbiB0aGUgcmlnaHRcclxuICAgIGNvbnN0IGNyZWF0ZVBhbmVscyA9ICgpID0+IHtcclxuXHJcbiAgICAgIGxldCBsZWdlbmRDb250ZW50O1xyXG4gICAgICBjb25zdCBhdG9tU2NlbmVWaXNpYmxlID0gbW9kZWwuc2NlbmVQcm9wZXJ0eS52YWx1ZSA9PT0gJ2F0b20nO1xyXG5cclxuICAgICAgLy8gY3JlYXRlIGNvbnRlbnQgZm9yIHRoZSBjb250cm9sIHBhbmVsc1xyXG4gICAgICBjb25zdCBhdG9tTGVnZW5kQ29udGVudCA9IEF0b21QYXJ0aWNsZUxlZ2VuZFBhbmVsLmNyZWF0ZVBhbmVsQ29udGVudCggeyByZXNpemU6IGZhbHNlIH0gKTtcclxuICAgICAgY29uc3QgbnVjbGVhckxlZ2VuZENvbnRlbnQgPSBOdWNsZWFyUGFydGljbGVMZWdlbmRQYW5lbC5jcmVhdGVQYW5lbENvbnRlbnQoIHtcclxuICAgICAgICByZXNpemU6IGZhbHNlLFxyXG4gICAgICAgIGluY2x1ZGVFbGVjdHJvbjogZmFsc2UsXHJcbiAgICAgICAgaW5jbHVkZVBsdW1QdWRkaW5nOiBmYWxzZVxyXG4gICAgICB9ICk7XHJcbiAgICAgIGNvbnN0IHBhcnRpY2xlUHJvcGVydGllc0NvbnRlbnQgPSBBbHBoYVBhcnRpY2xlUHJvcGVydGllc1BhbmVsLmNyZWF0ZVBhbmVsQ29udGVudCggbW9kZWwuZW5lcmd5SW50ZXJhY3Rpb25Qcm9wZXJ0eSwgbW9kZWwuYWxwaGFQYXJ0aWNsZUVuZXJneVByb3BlcnR5LCB0aGlzLnNob3dBbHBoYVRyYWNlUHJvcGVydHksIHsgcmVzaXplOiBmYWxzZSB9ICk7XHJcbiAgICAgIGNvbnN0IGF0b21Qcm9wZXJ0aWVzQ29udGVudCA9IEF0b21Qcm9wZXJ0aWVzUGFuZWwuY3JlYXRlUGFuZWxDb250ZW50KCBtb2RlbCwgeyByZXNpemU6IGZhbHNlIH0gKTtcclxuXHJcbiAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IGNvbnRlbnQgZm9yIGFsbCBwYW5lbHMgYXJlIGFsaWduZWQgYW5kIHRoZSBsZWdlbmQgY29udGVudCBpcyBhbGlnbmVkIHRvIHRoZSBsZWZ0XHJcbiAgICAgIC8vIHRoaXMgY29udGVudCBkb2VzIG5vdCBpbmNsdWRlIHRpdGxlXHJcbiAgICAgIGNvbnN0IGNvbnRlbnRBbGlnbkdyb3VwID0gbmV3IEFsaWduR3JvdXAoIHsgbWF0Y2hWZXJ0aWNhbDogZmFsc2UgfSApO1xyXG4gICAgICBjb25zdCBhdG9tQ29udGVudEJveCA9IGNvbnRlbnRBbGlnbkdyb3VwLmNyZWF0ZUJveCggYXRvbUxlZ2VuZENvbnRlbnQsIHsgeEFsaWduOiBQYXJ0aWNsZUxlZ2VuZFBhbmVsLkxFR0VORF9DT05URU5UX0FMSUdOIH0gKTtcclxuICAgICAgY29uc3QgbnVjbGVhckNvbnRlbnRCb3ggPSBjb250ZW50QWxpZ25Hcm91cC5jcmVhdGVCb3goIG51Y2xlYXJMZWdlbmRDb250ZW50LCB7IHhBbGlnbjogUGFydGljbGVMZWdlbmRQYW5lbC5MRUdFTkRfQ09OVEVOVF9BTElHTiB9ICk7XHJcbiAgICAgIGNvbnN0IHBhcnRpY2xlUHJvcGVydGllc0NvbnRlbnRCb3ggPSBjb250ZW50QWxpZ25Hcm91cC5jcmVhdGVCb3goIHBhcnRpY2xlUHJvcGVydGllc0NvbnRlbnQgKTtcclxuICAgICAgY29uc3QgYXRyb21Qcm9wZXJ0aWVzQ29udGVudEJveCA9IGNvbnRlbnRBbGlnbkdyb3VwLmNyZWF0ZUJveCggYXRvbVByb3BlcnRpZXNDb250ZW50ICk7XHJcblxyXG4gICAgICAvLyBjcmVhdGUgY29udGVudCBmb3IgdGhlIGxlZ2VuZCBwYW5lbHNcclxuICAgICAgaWYgKCBhdG9tU2NlbmVWaXNpYmxlICkge1xyXG4gICAgICAgIGxlZ2VuZENvbnRlbnQgPSBhdG9tQ29udGVudEJveDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBsZWdlbmRDb250ZW50ID0gbnVjbGVhckNvbnRlbnRCb3g7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGNyZWF0ZSB0aGUgcGFuZWxzXHJcbiAgICAgIGNvbnN0IHBhbmVsT3B0aW9ucyA9IHsgcmVzaXplOiBmYWxzZSB9O1xyXG4gICAgICBjb25zdCBsZWdlbmRQYW5lbCA9IGF0b21TY2VuZVZpc2libGUgPyBuZXcgQXRvbVBhcnRpY2xlTGVnZW5kUGFuZWwoIGxlZ2VuZENvbnRlbnQsIHBhbmVsT3B0aW9ucyApIDogbmV3IE51Y2xlYXJQYXJ0aWNsZUxlZ2VuZFBhbmVsKCBsZWdlbmRDb250ZW50LCBwYW5lbE9wdGlvbnMgKTtcclxuICAgICAgY29uc3QgcGFydGljbGVQcm9wZXJ0aWVzUGFuZWwgPSBuZXcgQWxwaGFQYXJ0aWNsZVByb3BlcnRpZXNQYW5lbCggcGFydGljbGVQcm9wZXJ0aWVzQ29udGVudEJveCwgcGFuZWxPcHRpb25zICk7XHJcbiAgICAgIGNvbnN0IGF0b21Qcm9wZXJ0aWVzUGFuZWwgPSBuZXcgQXRvbVByb3BlcnRpZXNQYW5lbCggYXRyb21Qcm9wZXJ0aWVzQ29udGVudEJveCwgcGFuZWxPcHRpb25zICk7XHJcblxyXG4gICAgICByZXR1cm4gW1xyXG4gICAgICAgIGxlZ2VuZFBhbmVsLFxyXG4gICAgICAgIHBhcnRpY2xlUHJvcGVydGllc1BhbmVsLFxyXG4gICAgICAgIGF0b21Qcm9wZXJ0aWVzUGFuZWxcclxuICAgICAgXTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gd2hlbiB2YXJpb3VzIHBhbmVscyBhcmUgYWRkZWQvcmVtb3ZlZCBkdWUgdG8gY2hhbmdpbmcgY29sb3IgcHJvZmlsZSBvciBzY2VuZSwgcmVzZXQgdGhlIGFjY2Vzc2libGUgb3JkZXJcclxuICAgIGNvbnN0IHJlc3RvcmVQRE9NT3JkZXIgPSAoKSA9PiB7XHJcbiAgICAgIHRoaXMucGRvbVBsYXlBcmVhTm9kZS5wZG9tT3JkZXIgPSBbIHRoaXMuZ3VuTm9kZSBdO1xyXG4gICAgICB0aGlzLnBkb21Db250cm9sQXJlYU5vZGUucGRvbU9yZGVyID0gXy51bmlxKCB0aGlzLnBkb21Db250cm9sQXJlYU5vZGUucGRvbU9yZGVyLmNvbmNhdCggW1xyXG4gICAgICAgIHRoaXMuY29udHJvbFBhbmVsLFxyXG4gICAgICAgIHRoaXMuc2NlbmVSYWRpb0J1dHRvbkdyb3VwXHJcbiAgICAgIF0uZmlsdGVyKCBfLmlkZW50aXR5ICkgKSApO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyB7Tm9kZX0gY29udHJvbCBwYW5lbCBpcyBjcmVhdGVkIGJlbG93IGJ5IHNjZW5lUHJvcGVydHkgbGlzdGVuZXIsIHRvIGNvcnJlc3BvbmQgdG8gc2NlbmVcclxuICAgIGxldCBjb250cm9sUGFuZWwgPSBudWxsO1xyXG5cclxuICAgIC8vIGZvciB0aGUgJ0F0b20nIHNjZW5lLCB0aGUgYmVhbSBzaG91bGQgYmUgc2VtaS10cmFuc3BhcmVudCwgdGhlIHNjYWxlIGluZGljYXRvclxyXG4gICAgLy8gc2hvdWxkIGJlIHVwZGF0ZWQsIGFuZCB0aGUgY29udHJvbC9sZWdlbmQgcGFuZWxzIG5lZWQgdG8gY2hhbmdlXHJcbiAgICAvLyBubyBuZWVkIHRvIHVubGluaywgc2NyZWVuIHZpZXcgZXhpc3RzIGZvciBsaWZlIG9mIHNpbVxyXG4gICAgbW9kZWwuc2NlbmVQcm9wZXJ0eS5saW5rKCBzY2VuZSA9PiB7XHJcbiAgICAgIGNvbnN0IGJlYW0gPSB0aGlzLmJlYW1Ob2RlO1xyXG4gICAgICBjb25zdCBhdG9tU2NlbmVWaXNpYmxlID0gc2NlbmUgPT09ICdhdG9tJztcclxuXHJcbiAgICAgIC8vIHVwZGF0ZSB2aXNpYmlsaXR5IG9mIHNjZW5lIHNwZWNpZmljIHNjYWxlIGluZm9cclxuICAgICAgdGhpcy5zY2FsZUluZm9Ob2RlLnZpc2libGUgPSAhYXRvbVNjZW5lVmlzaWJsZTtcclxuICAgICAgYXRvbWljU2NhbGVJbmZvTm9kZS52aXNpYmxlID0gYXRvbVNjZW5lVmlzaWJsZTtcclxuXHJcbiAgICAgIC8vIHJlY2VudGVyIHRoZSBndW4gYmVhbSBhbmQgc2V0IG5ldyBmaWxsXHJcbiAgICAgIGJlYW0uY2VudGVyWCA9IHRoaXMuZ3VuTm9kZS5jZW50ZXJYO1xyXG4gICAgICBiZWFtLmZpbGwgPSBhdG9tU2NlbmVWaXNpYmxlID8gUlNDb2xvcnMuYXRvbUJlYW1Db2xvclByb3BlcnR5IDogUlNDb2xvcnMubnVjbGV1c0JlYW1Db2xvclByb3BlcnR5O1xyXG5cclxuICAgICAgLy8gZGlzcG9zZSBhbmQgcmVtb3ZlIHRoZSBvbGQgY29udHJvbCBwYW5lbFxyXG4gICAgICBpZiAoIGNvbnRyb2xQYW5lbCApIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUNoaWxkKCBjb250cm9sUGFuZWwgKTtcclxuICAgICAgICBjb250cm9sUGFuZWwuZGlzcG9zZSgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBjcmVhdGUgdGhlIG5ldyBjb250cm9sIHBhbmVsXHJcbiAgICAgIGNvbnN0IHBhbmVscyA9IGNyZWF0ZVBhbmVscygpO1xyXG4gICAgICBjb250cm9sUGFuZWwgPSB0aGlzLmNyZWF0ZUNvbnRyb2xQYW5lbCggcGFuZWxzICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIGNvbnRyb2xQYW5lbCApO1xyXG5cclxuICAgICAgcmVzdG9yZVBET01PcmRlcigpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIHRoZSBSYWRpb0J1dG9uR3JvdXAgdGhhdCB3aWxsIGFjdCBhcyB0aGUgc2NlbmUgc2VsZWN0aW9uIGNvbnRyb2wgaW4gdGhpcyBzaW0uIE5ldyBidXR0b25zIG11c3QgYmVcclxuICAgICAqIGNyZWF0ZWQgZXZlcnkgdGltZSB0aGUgY29sb3IgcHJvZmlsZSBjaGFuZ2VzLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7SW1hZ2V9IGF0b21JY29uSW1hZ2UgLSB0aGUgaWNvbiBmb3IgdGhlIGF0b21pYyBzY2VuZSwgY2hhbmdlcyB3aXRoIGNvbG9yIHByb2ZpbGVcclxuICAgICAqIEByZXR1cm5zIHtSZWN0YW5ndWxhclJhZGlvQnV0dG9uR3JvdXB9IC0gcmV0dXJucyBhIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cCB0aGF0IG11c3QgYmUgZGlzcG9zZWQgd2hlbiBwcm9maWxlIGNoYW5nZXNcclxuICAgICAqL1xyXG4gICAgY29uc3QgY3JlYXRlUmFkaW9CdXR0b25zID0gYXRvbUljb25JbWFnZSA9PiBuZXcgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwKCBtb2RlbC5zY2VuZVByb3BlcnR5LCBbXHJcbiAgICAgIHsgdmFsdWU6ICdhdG9tJywgY3JlYXRlTm9kZTogKCkgPT4gbmV3IEltYWdlKCBhdG9tSWNvbkltYWdlLCB7IHNjYWxlOiAwLjE4IH0gKSwgbGFiZWxDb250ZW50OiBhdG9taWNTY2FsZVZpZXdTdHJpbmcgfSxcclxuICAgICAgeyB2YWx1ZTogJ251Y2xldXMnLCBjcmVhdGVOb2RlOiAoKSA9PiBSdXRoZXJmb3JkTnVjbGV1c05vZGUuUnV0aGVyZm9yZE51Y2xldXNJY29uKCAyMCwgMjAgKSwgbGFiZWxDb250ZW50OiBudWNsZWFyU2NhbGVWaWV3U3RyaW5nIH1cclxuICAgIF0sIHtcclxuICAgICAgb3JpZW50YXRpb246ICd2ZXJ0aWNhbCcsXHJcbiAgICAgIHNwYWNpbmc6IDE1LFxyXG4gICAgICBsZWZ0OiB0aGlzLnRhcmdldE1hdGVyaWFsTm9kZS5sZWZ0LFxyXG4gICAgICB0b3A6IHRoaXMuc3BhY2VOb2RlLnRvcCxcclxuICAgICAgcmFkaW9CdXR0b25PcHRpb25zOiB7XHJcbiAgICAgICAgYmFzZUNvbG9yOiBSU0NvbG9ycy5wYW5lbENvbG9yUHJvcGVydHkudmFsdWUsIC8vIFRPRE86IHVwZGF0ZSB0aGlzIHdoZW4gcmVxdWVzdGVkXHJcbiAgICAgICAgeU1hcmdpbjogOCxcclxuICAgICAgICBidXR0b25BcHBlYXJhbmNlU3RyYXRlZ3lPcHRpb25zOiB7XHJcbiAgICAgICAgICBkZXNlbGVjdGVkU3Ryb2tlOiBSU0NvbG9ycy5wYW5lbEJvcmRlckNvbG9yUHJvcGVydHkudmFsdWUsIC8vIFRPRE86IHVwZGF0ZSB0aGlzIHdoZW4gcmVxdWVzdGVkXHJcbiAgICAgICAgICBzZWxlY3RlZFN0cm9rZTogUlNDb2xvcnMucmFkaW9CdXR0b25Cb3JkZXJDb2xvclByb3BlcnR5LCAvLyBUT0RPOiB1cGRhdGUgdGhpcyB3aGVuIHJlcXVlc3RlZFxyXG4gICAgICAgICAgc2VsZWN0ZWRMaW5lV2lkdGg6IDIsXHJcbiAgICAgICAgICBkZXNlbGVjdGVkTGluZVdpZHRoOiAxLjVcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIG1heFdpZHRoOiB0aGlzLnRhcmdldE1hdGVyaWFsTm9kZS53aWR0aCxcclxuXHJcbiAgICAgIHRhZ05hbWU6ICdkaXYnLFxyXG4gICAgICBkZXNjcmlwdGlvbkNvbnRlbnQ6IHN3aXRjaFNjYWxlRGVzY3JpcHRpb25TdHJpbmcsXHJcbiAgICAgIGxhYmVsVGFnTmFtZTogJ2gzJyxcclxuICAgICAgbGFiZWxDb250ZW50OiBzd2l0Y2hTY2FsZVN0cmluZyxcclxuICAgICAgYXBwZW5kRGVzY3JpcHRpb246IHRydWVcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5zY2VuZVJhZGlvQnV0dG9uR3JvdXAgPSBjcmVhdGVSYWRpb0J1dHRvbnMoIGF0b21fcG5nICk7XHJcbiAgICB0aGlzLnBkb21Db250cm9sQXJlYU5vZGUuYWRkQ2hpbGQoIHRoaXMuc2NlbmVSYWRpb0J1dHRvbkdyb3VwICk7XHJcblxyXG4gICAgLy8gaWYgdGhlIGJhY2tncm91bmQsIHBhbmVsIG9yIHN0cm9rZSBjb2xvcnMgY2hhbmdlLCBkcmF3IGEgbmV3IGJ1dHRvbiBncm91cFxyXG4gICAgLy8gbm8gbmVlZCB0byB1bmxpbmssIHNjcmVlbiB2aWV3IGV4aXN0cyBmb3IgbGlmZSBvZiBzaW1cclxuICAgIGNvbG9yUHJvZmlsZVByb3BlcnR5LmxpbmsoIHByb2ZpbGVOYW1lID0+IHtcclxuXHJcbiAgICAgIC8vIHJlbW92ZSBhbmQgZGlzcG9zZSBvZiB0aGUgb2xkIGJ1dHRvbiBncm91cFxyXG4gICAgICB0aGlzLnBkb21Db250cm9sQXJlYU5vZGUucmVtb3ZlQ2hpbGQoIHRoaXMuc2NlbmVSYWRpb0J1dHRvbkdyb3VwICk7XHJcbiAgICAgIHRoaXMuc2NlbmVSYWRpb0J1dHRvbkdyb3VwLmRpc3Bvc2UoKTtcclxuXHJcbiAgICAgIC8vIGdldCB0aGUgY29ycmVjdCBpbWFnZSBmb3IgdGhlICdhdG9tJyBzY2VuZSBpY29uXHJcbiAgICAgIGNvbnN0IGljb25JbWFnZSA9ICggcHJvZmlsZU5hbWUgPT09IFNjZW5lcnlDb25zdGFudHMuUFJPSkVDVE9SX0NPTE9SX1BST0ZJTEUgKSA/IGF0b21Qcm9qZWN0b3JfcG5nIDogYXRvbV9wbmc7XHJcblxyXG4gICAgICAvLyBjcmVhdGUgdGhlIG5ldyByYWRpbyBidXR0b24gZ3JvdXBcclxuICAgICAgY29uc3QgbmV3QnV0dG9uR3JvdXAgPSBjcmVhdGVSYWRpb0J1dHRvbnMoIGljb25JbWFnZSApO1xyXG4gICAgICB0aGlzLnNjZW5lUmFkaW9CdXR0b25Hcm91cCA9IG5ld0J1dHRvbkdyb3VwO1xyXG4gICAgICB0aGlzLnBkb21Db250cm9sQXJlYU5vZGUuYWRkQ2hpbGQoIG5ld0J1dHRvbkdyb3VwICk7XHJcblxyXG4gICAgICAvLyBhZGQgbGFzZXIsIGFsbCBjb250cm9sIHBhbmVscywgYW5kIHNjZW5lIGJ1dHRvbnMgdG8gcGRvbU9yZGVyLCBtdXN0IGJlIHNldCBhZnRlclxyXG4gICAgICAvLyBjcmVhdGluZyBuZXcgcmFkaW8gYnV0dG9uc1xyXG4gICAgICByZXN0b3JlUERPTU9yZGVyKCk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgcmVzdG9yZVBET01PcmRlcigpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSB0aGUgbm9kZSBpbiB3aGljaCBhdG9tcyBhbmQgYWxwaGEgcGFydGljbGVzIGFyZSByZW5kZXJlZC4gIE5vZGUgY29udGFpbnMgYm90aFxyXG4gKiBzY2VuZSByZXByZXNlbnRhdGlvbnMsIGFuZCB2aXNpYmlsaXR5IGlzIGNvbnRyb2xsZWQgZnJvbSB0aGlzIG5vZGUuXHJcbiAqXHJcbiAqIEBwYXJhbSB7UnV0aGVyZm9yZEF0b21Nb2RlbH0gbW9kZWxcclxuICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IHNob3dBbHBoYVRyYWNlUHJvcGVydHlcclxuICogQHBhcmFtIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfSBtb2RlbFZpZXdUcmFuc2Zvcm1cclxuICogQHBhcmFtIHtCb3VuZHMyfSBjYW52YXNCb3VuZHNcclxuICogQHJldHVybnMge05vZGV9XHJcbiAqL1xyXG5jb25zdCBjcmVhdGVTcGFjZU5vZGUgPSAoIG1vZGVsLCBzaG93QWxwaGFUcmFjZVByb3BlcnR5LCBtb2RlbFZpZXdUcmFuc2Zvcm0sIGNhbnZhc0JvdW5kcyApID0+IHtcclxuXHJcbiAgLy8gY3JlYXRlIHRoZSBzaW5nbGUgbnVjbGV1cyByZXByZXNlbnRhdGlvbiBzY2VuZVxyXG4gIGNvbnN0IG51Y2xldXNTcGFjZU5vZGUgPSBuZXcgTnVjbGV1c1NwYWNlTm9kZSggbW9kZWwsIHNob3dBbHBoYVRyYWNlUHJvcGVydHksIG1vZGVsVmlld1RyYW5zZm9ybSwge1xyXG4gICAgY2FudmFzQm91bmRzOiBjYW52YXNCb3VuZHNcclxuICB9ICk7XHJcblxyXG4gIC8vIGNyZWF0ZSB0aGUgbXVsdGlwbGUgYXRvbSByZXByZXNlbnRhdGlvbiBzY2VuZVxyXG4gIGNvbnN0IGF0b21TcGFjZU5vZGUgPSBuZXcgQXRvbVNwYWNlTm9kZSggbW9kZWwsIHNob3dBbHBoYVRyYWNlUHJvcGVydHksIG1vZGVsVmlld1RyYW5zZm9ybSwge1xyXG4gICAgY2FudmFzQm91bmRzOiBjYW52YXNCb3VuZHNcclxuICB9ICk7XHJcblxyXG4gIGlmICggUlNRdWVyeVBhcmFtZXRlcnMuc2hvd0Vycm9yQ291bnQgKSB7XHJcbiAgICAvLyBzaG93IHRoZSBudW1iZXIgb2YgcGFydGljbGVzIHRoYXQgd2VyZSByZW1vdmVkIGZyb20gdGhlIHNwYWNlIGluIGVycm9yXHJcbiAgICBjb25zdCBlcnJvckNvdW50UGF0dGVybiA9ICdFcnJvciBjb3VudDoge3tudW1SZW1vdmVkfX0nO1xyXG4gICAgY29uc3QgZXJyb3JUZXh0ID0gbmV3IFRleHQoICcnLCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTggKSxcclxuICAgICAgZmlsbDogJ3JlZCcsXHJcbiAgICAgIGxlZnRCb3R0b206IGF0b21TcGFjZU5vZGUubGVmdFRvcFxyXG4gICAgfSApO1xyXG4gICAgYXRvbVNwYWNlTm9kZS5hZGRDaGlsZCggZXJyb3JUZXh0ICk7XHJcblxyXG4gICAgbGV0IGF0b21zUmVtb3ZlZCA9IDA7XHJcbiAgICBtb2RlbC5hdG9tU3BhY2UucGFydGljbGVSZW1vdmVkRnJvbUF0b21FbWl0dGVyLmFkZExpc3RlbmVyKCBwYXJ0aWNsZSA9PiB7XHJcbiAgICAgIGF0b21zUmVtb3ZlZCArPSAxO1xyXG4gICAgICBlcnJvclRleHQuc3RyaW5nID0gU3RyaW5nVXRpbHMuZmlsbEluKCBlcnJvckNvdW50UGF0dGVybiwge1xyXG4gICAgICAgIG51bVJlbW92ZWQ6IGF0b21zUmVtb3ZlZFxyXG4gICAgICB9ICk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvLyB1cGRhdGUgdmlldyBvbiBtb2RlbCBzdGVwXHJcbiAgbW9kZWwuYWRkU3RlcExpc3RlbmVyKCBkdCA9PiB7XHJcbiAgICBudWNsZXVzU3BhY2VOb2RlLmludmFsaWRhdGVQYWludCgpO1xyXG4gICAgYXRvbVNwYWNlTm9kZS5pbnZhbGlkYXRlUGFpbnQoKTtcclxuICB9ICk7XHJcblxyXG4gIC8vIHVwZGF0ZSB3aGljaCBzY2VuZSBpcyB2aXNpYmxlIGFuZCByZW1vdmUgYWxsIHBhcnRpY2xlc1xyXG4gIC8vIG5vIG5lZWQgdG8gdW5saW5rLCBzY3JlZW4gdmlldyBleGlzdHMgZm9yIGxpZmUgb2Ygc2ltXHJcbiAgbW9kZWwuc2NlbmVQcm9wZXJ0eS5saW5rKCBzY2VuZSA9PiB7XHJcbiAgICBjb25zdCBudWNsZXVzVmlzaWJsZSA9IHNjZW5lID09PSAnbnVjbGV1cyc7XHJcblxyXG4gICAgLy8gc2V0IHZpc2liaWxpdHkgb2YgbW9kZWwgc3BhY2VcclxuICAgIG1vZGVsLm51Y2xldXNTcGFjZS5pc1Zpc2libGUgPSBudWNsZXVzVmlzaWJsZTtcclxuICAgIG1vZGVsLmF0b21TcGFjZS5pc1Zpc2libGUgPSAhbnVjbGV1c1Zpc2libGU7XHJcblxyXG4gICAgLy8gc2V0IG5vZGUgdmlzaWJpbGl0eVxyXG4gICAgbnVjbGV1c1NwYWNlTm9kZS52aXNpYmxlID0gbnVjbGV1c1Zpc2libGU7XHJcbiAgICBhdG9tU3BhY2VOb2RlLnZpc2libGUgPSAhbnVjbGV1c1Zpc2libGU7XHJcblxyXG4gICAgbW9kZWwucmVtb3ZlQWxsUGFydGljbGVzKCk7XHJcbiAgfSApO1xyXG5cclxuICByZXR1cm4gbmV3IE5vZGUoIHtcclxuICAgIGNoaWxkcmVuOiBbIG51Y2xldXNTcGFjZU5vZGUsIGF0b21TcGFjZU5vZGUgXVxyXG4gIH0gKTtcclxufTtcclxuXHJcbnJ1dGhlcmZvcmRTY2F0dGVyaW5nLnJlZ2lzdGVyKCAnUnV0aGVyZm9yZEF0b21TY3JlZW5WaWV3JywgUnV0aGVyZm9yZEF0b21TY3JlZW5WaWV3ICk7XHJcbmV4cG9ydCBkZWZhdWx0IFJ1dGhlcmZvcmRBdG9tU2NyZWVuVmlldzsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsV0FBVyxNQUFNLCtDQUErQztBQUN2RSxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLFVBQVUsRUFBRUMsb0JBQW9CLEVBQUVDLEtBQUssRUFBRUMsSUFBSSxFQUFFQyxnQkFBZ0IsRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUN6SCxPQUFPQywyQkFBMkIsTUFBTSwyREFBMkQ7QUFDbkcsT0FBT0MsUUFBUSxNQUFNLDZCQUE2QjtBQUNsRCxPQUFPQyxpQkFBaUIsTUFBTSxzQ0FBc0M7QUFDcEUsT0FBT0MsUUFBUSxNQUFNLDBCQUEwQjtBQUMvQyxPQUFPQyxpQkFBaUIsTUFBTSxtQ0FBbUM7QUFDakUsT0FBT0MsNEJBQTRCLE1BQU0sbURBQW1EO0FBQzVGLE9BQU9DLDBCQUEwQixNQUFNLGlEQUFpRDtBQUN4RixPQUFPQyxtQkFBbUIsTUFBTSwwQ0FBMEM7QUFDMUUsT0FBT0MsZ0JBQWdCLE1BQU0sdUNBQXVDO0FBQ3BFLE9BQU9DLGFBQWEsTUFBTSxvQ0FBb0M7QUFDOUQsT0FBT0Msb0JBQW9CLE1BQU0sK0JBQStCO0FBQ2hFLE9BQU9DLDJCQUEyQixNQUFNLHNDQUFzQztBQUM5RSxPQUFPQyx1QkFBdUIsTUFBTSw4QkFBOEI7QUFDbEUsT0FBT0MsbUJBQW1CLE1BQU0sMEJBQTBCO0FBQzFELE9BQU9DLGFBQWEsTUFBTSxvQkFBb0I7QUFDOUMsT0FBT0MsZ0JBQWdCLE1BQU0sdUJBQXVCO0FBQ3BELE9BQU9DLHFCQUFxQixNQUFNLDRCQUE0Qjs7QUFFOUQ7QUFDQSxNQUFNQyx5QkFBeUIsR0FBR04sMkJBQTJC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