// Copyright 2016-2021, University of Colorado Boulder

/**
 * Visual representation of a Rutherford atom
 *
 * @author Dave Schmitz (Schmitzware)
 */

import Property from '../../../../axon/js/Property.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import { CanvasNode } from '../../../../scenery/js/imports.js';
import RSColors from '../../common/RSColors.js';
import RSConstants from '../../common/RSConstants.js';
import ParticleNodeFactory from '../../common/view/ParticleNodeFactory.js';
import rutherfordScattering from '../../rutherfordScattering.js';
import RutherfordNucleus from '../model/RutherfordNucleus.js';

// constants
const MIN_NUCLEUS_RADIUS = 20; // view coordinates
const OUTLINE_LINE_WIDTH = 1.5;
const OUTLINE_LINE_DASH = [2, 3];
const MIN_PARTICLE_COUNT = RSConstants.MIN_PROTON_COUNT + RSConstants.MIN_NEUTRON_COUNT;
const MAX_PARTICLE_COUNT = RSConstants.MAX_PROTON_COUNT + RSConstants.MAX_NEUTRON_COUNT;
const PARTICLE_COUNT_EXP = 0.333;
class RutherfordNucleusNode extends CanvasNode {
  /**
   * The Rutherford atom is build by randomly drawing proton & neutron images to a CanvasNode. This canvas is then
   * rendered to an Image.
   *
   * @param {Property.<boolean>} userInteractionProperty - is the user changing the model
   * @param {Property.<boolean>} protonCountProperty
   * @param {Property.<boolean>} neutronCountProperty
   * @param {Object} [options]
   */
  constructor(userInteractionProperty, protonCountProperty, neutronCountProperty, rutherfordNucleus, options) {
    // max radius of an atom with MAX protons & neutrons
    const maxRadius = MIN_NUCLEUS_RADIUS / Math.pow(MIN_PARTICLE_COUNT, PARTICLE_COUNT_EXP) * Math.pow(MAX_PARTICLE_COUNT, PARTICLE_COUNT_EXP);

    // set canvasBounds based on max radius of atom
    options = options || {};
    options.canvasBounds = new Bounds2(0, 0, 2 * maxRadius, 2 * maxRadius);
    super(options);

    // @private
    this.userInteractionProperty = userInteractionProperty;

    // @private
    this.rutherfordNucleus = rutherfordNucleus;

    // @private - switch to render the outline or full atom
    this.renderAtomOutline = false;

    // @private - the final rendered Rutherford atom
    this.image = null;

    // @private - the image to use as the proton
    this.protonImage = null;

    // @private - the image to use as the neutron
    this.neutronImage = null;

    // @private
    this.radius = MIN_NUCLEUS_RADIUS;

    // @private
    this.numberOfProtons = RSConstants.MIN_PROTON_COUNT;

    // @private
    this.numberOfNeutrons = RSConstants.MIN_NEUTRON_COUNT;

    // @private - flags that track when it is time to redraw the nucleus
    this.isDirty = false;
    this.timeSinceDirty = 0; // ms

    // generate proton image - asynchronous
    const protonNode = ParticleNodeFactory.createProton();
    protonNode.toImage((image, x, y) => {
      this.protonImage = image;
      this.updateAtomImage();
      this.timeSinceDirty = 0;
    });

    // generate neutron image - asynchronous
    const neutronNode = ParticleNodeFactory.createNeutron();
    neutronNode.toImage((image, x, y) => {
      this.neutronImage = image;
      this.updateAtomImage();
      this.timeSinceDirty = 0;
    });

    // update atom image when proton count changes
    const protonCountListener = propertyValue => {
      this.numberOfProtons = propertyValue;
      this.renderAtomOutline = this.userInteractionProperty.value; // Only render the outline when interacting
      this.updateAtomImage();
      this.timeSinceDirty = 0;
    };
    protonCountProperty.link(protonCountListener);

    // update atom image when neutron count changes
    const neutronCountListener = propertyValue => {
      this.numberOfNeutrons = propertyValue;
      this.renderAtomOutline = this.userInteractionProperty.value; // Only render the outline when interacting
      this.updateAtomImage();
      this.timeSinceDirty = 0;
    };
    neutronCountProperty.link(neutronCountListener);

    // update atom image when user interaction stops
    const userInteractionListener = userInteraction => {
      if (this.renderAtomOutline) {
        this.renderAtomOutline = false;
        this.updateAtomImage();
        this.timeSinceDirty = 0;
      }
    };
    userInteractionProperty.link(userInteractionListener);

    // @private - paint function for the Nucleus, bound to this CanvasNode
    this.boundPaintNucleus = paintNucleusIcon.bind(this);
    this.invalidatePaint();

    // @private
    this.disposeRutherfordNucleusNode = () => {
      protonCountProperty.unlink(protonCountListener);
      neutronCountProperty.unlink(neutronCountListener);
      userInteractionProperty.unlink(userInteractionListener);
    };
  }

  /**
   * Make this node eligible for garbage collection
   * @public
   */
  dispose() {
    this.disposeRutherfordNucleusNode();
  }

  /**
   * renders a new atom image based on proton/neutron counts
   * @private
   */
  updateAtomImage() {
    // Calculate the radius of the nucleus
    const currentParticles = this.numberOfProtons + this.numberOfNeutrons;
    const C = MIN_NUCLEUS_RADIUS / Math.pow(MIN_PARTICLE_COUNT, PARTICLE_COUNT_EXP);
    this.radius = C * Math.pow(currentParticles, PARTICLE_COUNT_EXP);
    assert && assert(this.radius > 0, 'Rutherford atom radius <= 0');
    this.invalidatePaint();

    // generate atom image - asynchronous
    this.toImage((image, x, y) => {
      // @public (read-only)
      this.image = image;
    });
  }

  /**
   * Renders the Rutherford atom either as a simple radius outline or as a detailed proton/neutron atom
   * @param {CanvasRenderingContext2D} context
   * @private
   */
  paintCanvas(context) {
    const bounds = this.canvasBounds;

    // clear
    context.clearRect(bounds.getX(), bounds.getY(), bounds.getWidth(), bounds.getHeight());
    this.renderAtomOutline = this.userInteractionProperty.value;

    // outline rendering
    if (this.renderAtomOutline) {
      context.beginPath();
      context.lineWidth = OUTLINE_LINE_WIDTH;
      context.setLineDash(OUTLINE_LINE_DASH);
      context.strokeStyle = RSColors.nucleusOutlineColorProperty.get().toCSS();
      context.arc(this.centerX, this.centerY, this.radius, 0, 2 * Math.PI);
      context.stroke();
    } else {
      // Detailed rendering

      // Slight chance the images used are not loaded. In that case, return & try again on next frame
      if (this.protonImage === null || this.neutronImage === null) {
        return;
      }
      this.boundPaintNucleus(this.rutherfordNucleus, bounds, context, 'canvasImage');

      // notify as dirty so that the nucleus gets redrawn
      this.isDirty = true;
    }
  }

  /**
   * Create an icon of the Rutherford Nucleus with the desired number of protons and neutrons.
   *
   * @param {number} protonCount
   * @param {number} neutronCount
   * @public
   */
  static RutherfordNucleusIcon(protonCount, neutronCount) {
    // create static properties and nucleus for the icon
    const protonCountProperty = new Property(protonCount);
    const neutronCountProperty = new Property(neutronCount);
    const nucleus = new RutherfordNucleus(protonCountProperty, neutronCountProperty);
    return new IconCanvasNode(nucleus);
  }
}
rutherfordScattering.register('RutherfordNucleusNode', RutherfordNucleusNode);
class IconCanvasNode extends CanvasNode {
  /**
   * Constructor for an icon representation of the Rutherford Nucleus.  This has no attached listeners,
   * and is a static representation of the nucleus.
   *
   * @param  {RutherfordNucleus} nucleus
   * @param  {Object} options
   */
  constructor(nucleus, options) {
    // max radius of an atom with MAX protons & neutrons
    const numberOfParticles = nucleus.protonCountProperty.get() + nucleus.neutronCountProperty.get();
    const maxRadius = MIN_NUCLEUS_RADIUS / Math.pow(MIN_PARTICLE_COUNT, PARTICLE_COUNT_EXP) * Math.pow(numberOfParticles, PARTICLE_COUNT_EXP);

    // used to center elements drawn in the context
    const nucleusBounds = new Bounds2(0, 0, 2 * maxRadius, 2 * maxRadius);

    // set canvasBounds based on max radius of atom
    options = options || {};
    options.canvasBounds = nucleusBounds;
    super(options);

    // @private
    this.nucleusBounds = nucleusBounds;
    this.nucleus = nucleus;

    // @private - listener to paint the icon, bound to this CanvasNode
    this.boundPaintNucleusIcon = paintNucleusIcon.bind(this);
    this.invalidatePaint();
  }

  /**
   * Paint function for the canvas node
   *
   * @param  {CanvasRenderingContext2D} context
   * @protected @override
   */
  paintCanvas(context) {
    // paint the nucleus with canvas arcs - slower than image, but better resolution for icons
    this.boundPaintNucleusIcon(this.nucleus, this.canvasBounds, context, 'canvasArc');
  }
}

/**
 * Paint a nucleus icon with canvas.  A 'render method' is used to determine the style of rendering.
 * render options are 'canvasArc' and 'canvasImage'.  'canvasArc' is a slower option, but has better
 * resolution, and is good for icons.  'canvasImage' is faster and is good for dynamic elements that
 * need to change frequenly, but it tends to have poor resolution at larger scales.
 *
 * @param  {RutherfordNucleus} nucleus
 * @param  {Bounds2} nucleusBounds description
 * @param  {CanvasRenderingContext2D} context
 * @param  {string} render - 'canvasArc' | 'canvasImage', determines rendering method, see above
 */
const paintNucleusIcon = function (nucleus, nucleusBounds, context, render) {
  const protons = nucleus.protons.slice();
  const neutrons = nucleus.neutrons.slice();
  const nucleons = protons.concat(neutrons);

  // get the number of layers in the particle
  let zLayer = 0;
  nucleons.forEach(nucleon => {
    if (nucleon.zLayerProperty.get() > zLayer) {
      zLayer = nucleon.zLayerProperty.get();
    }
  });

  // add the layers, starting from the largest which is in the back
  for (let i = zLayer; i >= 0; i--) {
    nucleons.forEach(nucleon => {
      if (nucleon.zLayerProperty.get() === i) {
        let xN = nucleon.positionProperty.get().x;
        let yN = nucleon.positionProperty.get().y;
        if (render === 'canvasArc') {
          // drawing with arcs is a little slower, but the result is less pixilated, so
          // this method is good for drawing icons

          // if using canvas arcs to render the nucleus, offset by center of bounds
          xN += nucleusBounds.centerX;
          yN += nucleusBounds.centerY;
          if (nucleon.type === 'neutron') {
            ParticleNodeFactory.drawNeutronWithCanvas(xN, yN, context);
          } else {
            ParticleNodeFactory.drawProtonWithCanvas(xN, yN, context);
          }
        } else if (render === 'canvasImage') {
          // drawing with image is a bit faster but the result can be pixilated when scaled, so this
          // should be used when rendering a nucleus that should change frequently and rapidly

          // if drawing with images, offset by bounds of the image
          xN += this.center.x - this.neutronImage.width / 2;
          yN += this.center.y - this.neutronImage.height / 2;
          if (nucleon.type === 'neutron') {
            context.drawImage(this.neutronImage, xN, yN, this.neutronImage.width, this.neutronImage.height);
          } else {
            context.drawImage(this.protonImage, xN, yN, this.protonImage.width, this.protonImage.height);
          }
        }
      }
    });
  }
};
export default RutherfordNucleusNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIkJvdW5kczIiLCJDYW52YXNOb2RlIiwiUlNDb2xvcnMiLCJSU0NvbnN0YW50cyIsIlBhcnRpY2xlTm9kZUZhY3RvcnkiLCJydXRoZXJmb3JkU2NhdHRlcmluZyIsIlJ1dGhlcmZvcmROdWNsZXVzIiwiTUlOX05VQ0xFVVNfUkFESVVTIiwiT1VUTElORV9MSU5FX1dJRFRIIiwiT1VUTElORV9MSU5FX0RBU0giLCJNSU5fUEFSVElDTEVfQ09VTlQiLCJNSU5fUFJPVE9OX0NPVU5UIiwiTUlOX05FVVRST05fQ09VTlQiLCJNQVhfUEFSVElDTEVfQ09VTlQiLCJNQVhfUFJPVE9OX0NPVU5UIiwiTUFYX05FVVRST05fQ09VTlQiLCJQQVJUSUNMRV9DT1VOVF9FWFAiLCJSdXRoZXJmb3JkTnVjbGV1c05vZGUiLCJjb25zdHJ1Y3RvciIsInVzZXJJbnRlcmFjdGlvblByb3BlcnR5IiwicHJvdG9uQ291bnRQcm9wZXJ0eSIsIm5ldXRyb25Db3VudFByb3BlcnR5IiwicnV0aGVyZm9yZE51Y2xldXMiLCJvcHRpb25zIiwibWF4UmFkaXVzIiwiTWF0aCIsInBvdyIsImNhbnZhc0JvdW5kcyIsInJlbmRlckF0b21PdXRsaW5lIiwiaW1hZ2UiLCJwcm90b25JbWFnZSIsIm5ldXRyb25JbWFnZSIsInJhZGl1cyIsIm51bWJlck9mUHJvdG9ucyIsIm51bWJlck9mTmV1dHJvbnMiLCJpc0RpcnR5IiwidGltZVNpbmNlRGlydHkiLCJwcm90b25Ob2RlIiwiY3JlYXRlUHJvdG9uIiwidG9JbWFnZSIsIngiLCJ5IiwidXBkYXRlQXRvbUltYWdlIiwibmV1dHJvbk5vZGUiLCJjcmVhdGVOZXV0cm9uIiwicHJvdG9uQ291bnRMaXN0ZW5lciIsInByb3BlcnR5VmFsdWUiLCJ2YWx1ZSIsImxpbmsiLCJuZXV0cm9uQ291bnRMaXN0ZW5lciIsInVzZXJJbnRlcmFjdGlvbkxpc3RlbmVyIiwidXNlckludGVyYWN0aW9uIiwiYm91bmRQYWludE51Y2xldXMiLCJwYWludE51Y2xldXNJY29uIiwiYmluZCIsImludmFsaWRhdGVQYWludCIsImRpc3Bvc2VSdXRoZXJmb3JkTnVjbGV1c05vZGUiLCJ1bmxpbmsiLCJkaXNwb3NlIiwiY3VycmVudFBhcnRpY2xlcyIsIkMiLCJhc3NlcnQiLCJwYWludENhbnZhcyIsImNvbnRleHQiLCJib3VuZHMiLCJjbGVhclJlY3QiLCJnZXRYIiwiZ2V0WSIsImdldFdpZHRoIiwiZ2V0SGVpZ2h0IiwiYmVnaW5QYXRoIiwibGluZVdpZHRoIiwic2V0TGluZURhc2giLCJzdHJva2VTdHlsZSIsIm51Y2xldXNPdXRsaW5lQ29sb3JQcm9wZXJ0eSIsImdldCIsInRvQ1NTIiwiYXJjIiwiY2VudGVyWCIsImNlbnRlclkiLCJQSSIsInN0cm9rZSIsIlJ1dGhlcmZvcmROdWNsZXVzSWNvbiIsInByb3RvbkNvdW50IiwibmV1dHJvbkNvdW50IiwibnVjbGV1cyIsIkljb25DYW52YXNOb2RlIiwicmVnaXN0ZXIiLCJudW1iZXJPZlBhcnRpY2xlcyIsIm51Y2xldXNCb3VuZHMiLCJib3VuZFBhaW50TnVjbGV1c0ljb24iLCJyZW5kZXIiLCJwcm90b25zIiwic2xpY2UiLCJuZXV0cm9ucyIsIm51Y2xlb25zIiwiY29uY2F0IiwiekxheWVyIiwiZm9yRWFjaCIsIm51Y2xlb24iLCJ6TGF5ZXJQcm9wZXJ0eSIsImkiLCJ4TiIsInBvc2l0aW9uUHJvcGVydHkiLCJ5TiIsInR5cGUiLCJkcmF3TmV1dHJvbldpdGhDYW52YXMiLCJkcmF3UHJvdG9uV2l0aENhbnZhcyIsImNlbnRlciIsIndpZHRoIiwiaGVpZ2h0IiwiZHJhd0ltYWdlIl0sInNvdXJjZXMiOlsiUnV0aGVyZm9yZE51Y2xldXNOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjEsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFZpc3VhbCByZXByZXNlbnRhdGlvbiBvZiBhIFJ1dGhlcmZvcmQgYXRvbVxyXG4gKlxyXG4gKiBAYXV0aG9yIERhdmUgU2NobWl0eiAoU2NobWl0endhcmUpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCB7IENhbnZhc05vZGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUlNDb2xvcnMgZnJvbSAnLi4vLi4vY29tbW9uL1JTQ29sb3JzLmpzJztcclxuaW1wb3J0IFJTQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9SU0NvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBQYXJ0aWNsZU5vZGVGYWN0b3J5IGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L1BhcnRpY2xlTm9kZUZhY3RvcnkuanMnO1xyXG5pbXBvcnQgcnV0aGVyZm9yZFNjYXR0ZXJpbmcgZnJvbSAnLi4vLi4vcnV0aGVyZm9yZFNjYXR0ZXJpbmcuanMnO1xyXG5pbXBvcnQgUnV0aGVyZm9yZE51Y2xldXMgZnJvbSAnLi4vbW9kZWwvUnV0aGVyZm9yZE51Y2xldXMuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE1JTl9OVUNMRVVTX1JBRElVUyA9IDIwOyAvLyB2aWV3IGNvb3JkaW5hdGVzXHJcbmNvbnN0IE9VVExJTkVfTElORV9XSURUSCA9IDEuNTtcclxuY29uc3QgT1VUTElORV9MSU5FX0RBU0ggPSBbIDIsIDMgXTtcclxuY29uc3QgTUlOX1BBUlRJQ0xFX0NPVU5UID0gUlNDb25zdGFudHMuTUlOX1BST1RPTl9DT1VOVCArIFJTQ29uc3RhbnRzLk1JTl9ORVVUUk9OX0NPVU5UO1xyXG5jb25zdCBNQVhfUEFSVElDTEVfQ09VTlQgPSBSU0NvbnN0YW50cy5NQVhfUFJPVE9OX0NPVU5UICsgUlNDb25zdGFudHMuTUFYX05FVVRST05fQ09VTlQ7XHJcbmNvbnN0IFBBUlRJQ0xFX0NPVU5UX0VYUCA9IDAuMzMzO1xyXG5cclxuY2xhc3MgUnV0aGVyZm9yZE51Y2xldXNOb2RlIGV4dGVuZHMgQ2FudmFzTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSBSdXRoZXJmb3JkIGF0b20gaXMgYnVpbGQgYnkgcmFuZG9tbHkgZHJhd2luZyBwcm90b24gJiBuZXV0cm9uIGltYWdlcyB0byBhIENhbnZhc05vZGUuIFRoaXMgY2FudmFzIGlzIHRoZW5cclxuICAgKiByZW5kZXJlZCB0byBhbiBJbWFnZS5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPGJvb2xlYW4+fSB1c2VySW50ZXJhY3Rpb25Qcm9wZXJ0eSAtIGlzIHRoZSB1c2VyIGNoYW5naW5nIHRoZSBtb2RlbFxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPGJvb2xlYW4+fSBwcm90b25Db3VudFByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IG5ldXRyb25Db3VudFByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCB1c2VySW50ZXJhY3Rpb25Qcm9wZXJ0eSwgcHJvdG9uQ291bnRQcm9wZXJ0eSwgbmV1dHJvbkNvdW50UHJvcGVydHksIHJ1dGhlcmZvcmROdWNsZXVzLCBvcHRpb25zICkge1xyXG5cclxuICAgIC8vIG1heCByYWRpdXMgb2YgYW4gYXRvbSB3aXRoIE1BWCBwcm90b25zICYgbmV1dHJvbnNcclxuICAgIGNvbnN0IG1heFJhZGl1cyA9IE1JTl9OVUNMRVVTX1JBRElVUyAvIE1hdGgucG93KCBNSU5fUEFSVElDTEVfQ09VTlQsIFBBUlRJQ0xFX0NPVU5UX0VYUCApICpcclxuICAgICAgICAgICAgICAgICAgICAgIE1hdGgucG93KCBNQVhfUEFSVElDTEVfQ09VTlQsIFBBUlRJQ0xFX0NPVU5UX0VYUCApO1xyXG5cclxuICAgIC8vIHNldCBjYW52YXNCb3VuZHMgYmFzZWQgb24gbWF4IHJhZGl1cyBvZiBhdG9tXHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuICAgIG9wdGlvbnMuY2FudmFzQm91bmRzID0gbmV3IEJvdW5kczIoIDAsIDAsIDIgKiBtYXhSYWRpdXMsIDIgKiBtYXhSYWRpdXMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlXHJcbiAgICB0aGlzLnVzZXJJbnRlcmFjdGlvblByb3BlcnR5ID0gdXNlckludGVyYWN0aW9uUHJvcGVydHk7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMucnV0aGVyZm9yZE51Y2xldXMgPSBydXRoZXJmb3JkTnVjbGV1cztcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSAtIHN3aXRjaCB0byByZW5kZXIgdGhlIG91dGxpbmUgb3IgZnVsbCBhdG9tXHJcbiAgICB0aGlzLnJlbmRlckF0b21PdXRsaW5lID0gZmFsc2U7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgLSB0aGUgZmluYWwgcmVuZGVyZWQgUnV0aGVyZm9yZCBhdG9tXHJcbiAgICB0aGlzLmltYWdlID0gbnVsbDtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSAtIHRoZSBpbWFnZSB0byB1c2UgYXMgdGhlIHByb3RvblxyXG4gICAgdGhpcy5wcm90b25JbWFnZSA9IG51bGw7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgLSB0aGUgaW1hZ2UgdG8gdXNlIGFzIHRoZSBuZXV0cm9uXHJcbiAgICB0aGlzLm5ldXRyb25JbWFnZSA9IG51bGw7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMucmFkaXVzID0gTUlOX05VQ0xFVVNfUkFESVVTO1xyXG5cclxuICAgIC8vIEBwcml2YXRlXHJcbiAgICB0aGlzLm51bWJlck9mUHJvdG9ucyA9IFJTQ29uc3RhbnRzLk1JTl9QUk9UT05fQ09VTlQ7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMubnVtYmVyT2ZOZXV0cm9ucyA9IFJTQ29uc3RhbnRzLk1JTl9ORVVUUk9OX0NPVU5UO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIC0gZmxhZ3MgdGhhdCB0cmFjayB3aGVuIGl0IGlzIHRpbWUgdG8gcmVkcmF3IHRoZSBudWNsZXVzXHJcbiAgICB0aGlzLmlzRGlydHkgPSBmYWxzZTtcclxuICAgIHRoaXMudGltZVNpbmNlRGlydHkgPSAwOyAvLyBtc1xyXG5cclxuICAgIC8vIGdlbmVyYXRlIHByb3RvbiBpbWFnZSAtIGFzeW5jaHJvbm91c1xyXG4gICAgY29uc3QgcHJvdG9uTm9kZSA9IFBhcnRpY2xlTm9kZUZhY3RvcnkuY3JlYXRlUHJvdG9uKCk7XHJcbiAgICBwcm90b25Ob2RlLnRvSW1hZ2UoICggaW1hZ2UsIHgsIHkgKSA9PiB7XHJcbiAgICAgIHRoaXMucHJvdG9uSW1hZ2UgPSBpbWFnZTtcclxuICAgICAgdGhpcy51cGRhdGVBdG9tSW1hZ2UoKTtcclxuICAgICAgdGhpcy50aW1lU2luY2VEaXJ0eSA9IDA7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gZ2VuZXJhdGUgbmV1dHJvbiBpbWFnZSAtIGFzeW5jaHJvbm91c1xyXG4gICAgY29uc3QgbmV1dHJvbk5vZGUgPSBQYXJ0aWNsZU5vZGVGYWN0b3J5LmNyZWF0ZU5ldXRyb24oKTtcclxuICAgIG5ldXRyb25Ob2RlLnRvSW1hZ2UoICggaW1hZ2UsIHgsIHkgKSA9PiB7XHJcbiAgICAgIHRoaXMubmV1dHJvbkltYWdlID0gaW1hZ2U7XHJcbiAgICAgIHRoaXMudXBkYXRlQXRvbUltYWdlKCk7XHJcbiAgICAgIHRoaXMudGltZVNpbmNlRGlydHkgPSAwO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSBhdG9tIGltYWdlIHdoZW4gcHJvdG9uIGNvdW50IGNoYW5nZXNcclxuICAgIGNvbnN0IHByb3RvbkNvdW50TGlzdGVuZXIgPSBwcm9wZXJ0eVZhbHVlID0+IHtcclxuICAgICAgdGhpcy5udW1iZXJPZlByb3RvbnMgPSBwcm9wZXJ0eVZhbHVlO1xyXG4gICAgICB0aGlzLnJlbmRlckF0b21PdXRsaW5lID0gdGhpcy51c2VySW50ZXJhY3Rpb25Qcm9wZXJ0eS52YWx1ZTsgIC8vIE9ubHkgcmVuZGVyIHRoZSBvdXRsaW5lIHdoZW4gaW50ZXJhY3RpbmdcclxuICAgICAgdGhpcy51cGRhdGVBdG9tSW1hZ2UoKTtcclxuICAgICAgdGhpcy50aW1lU2luY2VEaXJ0eSA9IDA7XHJcbiAgICB9O1xyXG4gICAgcHJvdG9uQ291bnRQcm9wZXJ0eS5saW5rKCBwcm90b25Db3VudExpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gdXBkYXRlIGF0b20gaW1hZ2Ugd2hlbiBuZXV0cm9uIGNvdW50IGNoYW5nZXNcclxuICAgIGNvbnN0IG5ldXRyb25Db3VudExpc3RlbmVyID0gcHJvcGVydHlWYWx1ZSA9PiB7XHJcbiAgICAgIHRoaXMubnVtYmVyT2ZOZXV0cm9ucyA9IHByb3BlcnR5VmFsdWU7XHJcbiAgICAgIHRoaXMucmVuZGVyQXRvbU91dGxpbmUgPSB0aGlzLnVzZXJJbnRlcmFjdGlvblByb3BlcnR5LnZhbHVlOyAvLyBPbmx5IHJlbmRlciB0aGUgb3V0bGluZSB3aGVuIGludGVyYWN0aW5nXHJcbiAgICAgIHRoaXMudXBkYXRlQXRvbUltYWdlKCk7XHJcbiAgICAgIHRoaXMudGltZVNpbmNlRGlydHkgPSAwO1xyXG4gICAgfTtcclxuICAgIG5ldXRyb25Db3VudFByb3BlcnR5LmxpbmsoIG5ldXRyb25Db3VudExpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gdXBkYXRlIGF0b20gaW1hZ2Ugd2hlbiB1c2VyIGludGVyYWN0aW9uIHN0b3BzXHJcbiAgICBjb25zdCB1c2VySW50ZXJhY3Rpb25MaXN0ZW5lciA9IHVzZXJJbnRlcmFjdGlvbiA9PiB7XHJcbiAgICAgIGlmICggdGhpcy5yZW5kZXJBdG9tT3V0bGluZSApIHtcclxuICAgICAgICB0aGlzLnJlbmRlckF0b21PdXRsaW5lID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy51cGRhdGVBdG9tSW1hZ2UoKTtcclxuICAgICAgICB0aGlzLnRpbWVTaW5jZURpcnR5ID0gMDtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHVzZXJJbnRlcmFjdGlvblByb3BlcnR5LmxpbmsoIHVzZXJJbnRlcmFjdGlvbkxpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgLSBwYWludCBmdW5jdGlvbiBmb3IgdGhlIE51Y2xldXMsIGJvdW5kIHRvIHRoaXMgQ2FudmFzTm9kZVxyXG4gICAgdGhpcy5ib3VuZFBhaW50TnVjbGV1cyA9IHBhaW50TnVjbGV1c0ljb24uYmluZCggdGhpcyApO1xyXG5cclxuICAgIHRoaXMuaW52YWxpZGF0ZVBhaW50KCk7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMuZGlzcG9zZVJ1dGhlcmZvcmROdWNsZXVzTm9kZSA9ICgpID0+IHtcclxuICAgICAgcHJvdG9uQ291bnRQcm9wZXJ0eS51bmxpbmsoIHByb3RvbkNvdW50TGlzdGVuZXIgKTtcclxuICAgICAgbmV1dHJvbkNvdW50UHJvcGVydHkudW5saW5rKCBuZXV0cm9uQ291bnRMaXN0ZW5lciApO1xyXG4gICAgICB1c2VySW50ZXJhY3Rpb25Qcm9wZXJ0eS51bmxpbmsoIHVzZXJJbnRlcmFjdGlvbkxpc3RlbmVyICk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFrZSB0aGlzIG5vZGUgZWxpZ2libGUgZm9yIGdhcmJhZ2UgY29sbGVjdGlvblxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBkaXNwb3NlKCkge1xyXG4gICAgdGhpcy5kaXNwb3NlUnV0aGVyZm9yZE51Y2xldXNOb2RlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiByZW5kZXJzIGEgbmV3IGF0b20gaW1hZ2UgYmFzZWQgb24gcHJvdG9uL25ldXRyb24gY291bnRzXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICB1cGRhdGVBdG9tSW1hZ2UoKSB7XHJcblxyXG4gICAgLy8gQ2FsY3VsYXRlIHRoZSByYWRpdXMgb2YgdGhlIG51Y2xldXNcclxuICAgIGNvbnN0IGN1cnJlbnRQYXJ0aWNsZXMgPSB0aGlzLm51bWJlck9mUHJvdG9ucyArIHRoaXMubnVtYmVyT2ZOZXV0cm9ucztcclxuICAgIGNvbnN0IEMgPSBNSU5fTlVDTEVVU19SQURJVVMgLyBNYXRoLnBvdyggTUlOX1BBUlRJQ0xFX0NPVU5ULCBQQVJUSUNMRV9DT1VOVF9FWFAgKTtcclxuICAgIHRoaXMucmFkaXVzID0gQyAqIE1hdGgucG93KCBjdXJyZW50UGFydGljbGVzLCBQQVJUSUNMRV9DT1VOVF9FWFAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMucmFkaXVzID4gMCwgJ1J1dGhlcmZvcmQgYXRvbSByYWRpdXMgPD0gMCcgKTtcclxuXHJcbiAgICB0aGlzLmludmFsaWRhdGVQYWludCgpO1xyXG5cclxuICAgIC8vIGdlbmVyYXRlIGF0b20gaW1hZ2UgLSBhc3luY2hyb25vdXNcclxuICAgIHRoaXMudG9JbWFnZSggKCBpbWFnZSwgeCwgeSApID0+IHtcclxuICAgICAgLy8gQHB1YmxpYyAocmVhZC1vbmx5KVxyXG4gICAgICB0aGlzLmltYWdlID0gaW1hZ2U7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW5kZXJzIHRoZSBSdXRoZXJmb3JkIGF0b20gZWl0aGVyIGFzIGEgc2ltcGxlIHJhZGl1cyBvdXRsaW5lIG9yIGFzIGEgZGV0YWlsZWQgcHJvdG9uL25ldXRyb24gYXRvbVxyXG4gICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjb250ZXh0XHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBwYWludENhbnZhcyggY29udGV4dCApIHtcclxuXHJcbiAgICBjb25zdCBib3VuZHMgPSB0aGlzLmNhbnZhc0JvdW5kcztcclxuXHJcbiAgICAvLyBjbGVhclxyXG4gICAgY29udGV4dC5jbGVhclJlY3QoIGJvdW5kcy5nZXRYKCksIGJvdW5kcy5nZXRZKCksIGJvdW5kcy5nZXRXaWR0aCgpLCBib3VuZHMuZ2V0SGVpZ2h0KCkgKTtcclxuICAgIHRoaXMucmVuZGVyQXRvbU91dGxpbmUgPSB0aGlzLnVzZXJJbnRlcmFjdGlvblByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgIC8vIG91dGxpbmUgcmVuZGVyaW5nXHJcbiAgICBpZiAoIHRoaXMucmVuZGVyQXRvbU91dGxpbmUgKSB7XHJcbiAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XHJcbiAgICAgIGNvbnRleHQubGluZVdpZHRoID0gT1VUTElORV9MSU5FX1dJRFRIO1xyXG4gICAgICBjb250ZXh0LnNldExpbmVEYXNoKCBPVVRMSU5FX0xJTkVfREFTSCApO1xyXG4gICAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gUlNDb2xvcnMubnVjbGV1c091dGxpbmVDb2xvclByb3BlcnR5LmdldCgpLnRvQ1NTKCk7XHJcbiAgICAgIGNvbnRleHQuYXJjKCB0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWSwgdGhpcy5yYWRpdXMsIDAsIDIgKiBNYXRoLlBJICk7XHJcbiAgICAgIGNvbnRleHQuc3Ryb2tlKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHsgIC8vIERldGFpbGVkIHJlbmRlcmluZ1xyXG5cclxuICAgICAgLy8gU2xpZ2h0IGNoYW5jZSB0aGUgaW1hZ2VzIHVzZWQgYXJlIG5vdCBsb2FkZWQuIEluIHRoYXQgY2FzZSwgcmV0dXJuICYgdHJ5IGFnYWluIG9uIG5leHQgZnJhbWVcclxuICAgICAgaWYgKCB0aGlzLnByb3RvbkltYWdlID09PSBudWxsIHx8IHRoaXMubmV1dHJvbkltYWdlID09PSBudWxsICkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5ib3VuZFBhaW50TnVjbGV1cyggdGhpcy5ydXRoZXJmb3JkTnVjbGV1cywgYm91bmRzLCBjb250ZXh0LCAnY2FudmFzSW1hZ2UnICk7XHJcblxyXG4gICAgICAvLyBub3RpZnkgYXMgZGlydHkgc28gdGhhdCB0aGUgbnVjbGV1cyBnZXRzIHJlZHJhd25cclxuICAgICAgdGhpcy5pc0RpcnR5ID0gdHJ1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGUgYW4gaWNvbiBvZiB0aGUgUnV0aGVyZm9yZCBOdWNsZXVzIHdpdGggdGhlIGRlc2lyZWQgbnVtYmVyIG9mIHByb3RvbnMgYW5kIG5ldXRyb25zLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHByb3RvbkNvdW50XHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IG5ldXRyb25Db3VudFxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBzdGF0aWMgUnV0aGVyZm9yZE51Y2xldXNJY29uKCBwcm90b25Db3VudCwgbmV1dHJvbkNvdW50ICkge1xyXG5cclxuICAgIC8vIGNyZWF0ZSBzdGF0aWMgcHJvcGVydGllcyBhbmQgbnVjbGV1cyBmb3IgdGhlIGljb25cclxuICAgIGNvbnN0IHByb3RvbkNvdW50UHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIHByb3RvbkNvdW50ICk7XHJcbiAgICBjb25zdCBuZXV0cm9uQ291bnRQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggbmV1dHJvbkNvdW50ICk7XHJcbiAgICBjb25zdCBudWNsZXVzID0gbmV3IFJ1dGhlcmZvcmROdWNsZXVzKCBwcm90b25Db3VudFByb3BlcnR5LCBuZXV0cm9uQ291bnRQcm9wZXJ0eSApO1xyXG5cclxuICAgIHJldHVybiBuZXcgSWNvbkNhbnZhc05vZGUoIG51Y2xldXMgKTtcclxuICB9XHJcbn1cclxuXHJcbnJ1dGhlcmZvcmRTY2F0dGVyaW5nLnJlZ2lzdGVyKCAnUnV0aGVyZm9yZE51Y2xldXNOb2RlJywgUnV0aGVyZm9yZE51Y2xldXNOb2RlICk7XHJcblxyXG5jbGFzcyBJY29uQ2FudmFzTm9kZSBleHRlbmRzIENhbnZhc05vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBDb25zdHJ1Y3RvciBmb3IgYW4gaWNvbiByZXByZXNlbnRhdGlvbiBvZiB0aGUgUnV0aGVyZm9yZCBOdWNsZXVzLiAgVGhpcyBoYXMgbm8gYXR0YWNoZWQgbGlzdGVuZXJzLFxyXG4gICAqIGFuZCBpcyBhIHN0YXRpYyByZXByZXNlbnRhdGlvbiBvZiB0aGUgbnVjbGV1cy5cclxuICAgKlxyXG4gICAqIEBwYXJhbSAge1J1dGhlcmZvcmROdWNsZXVzfSBudWNsZXVzXHJcbiAgICogQHBhcmFtICB7T2JqZWN0fSBvcHRpb25zXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG51Y2xldXMsIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgLy8gbWF4IHJhZGl1cyBvZiBhbiBhdG9tIHdpdGggTUFYIHByb3RvbnMgJiBuZXV0cm9uc1xyXG4gICAgY29uc3QgbnVtYmVyT2ZQYXJ0aWNsZXMgPSBudWNsZXVzLnByb3RvbkNvdW50UHJvcGVydHkuZ2V0KCkgKyBudWNsZXVzLm5ldXRyb25Db3VudFByb3BlcnR5LmdldCgpO1xyXG4gICAgY29uc3QgbWF4UmFkaXVzID0gTUlOX05VQ0xFVVNfUkFESVVTIC8gTWF0aC5wb3coIE1JTl9QQVJUSUNMRV9DT1VOVCwgUEFSVElDTEVfQ09VTlRfRVhQICkgKlxyXG4gICAgICAgICAgICAgICAgICAgICAgTWF0aC5wb3coIG51bWJlck9mUGFydGljbGVzLCBQQVJUSUNMRV9DT1VOVF9FWFAgKTtcclxuXHJcbiAgICAvLyB1c2VkIHRvIGNlbnRlciBlbGVtZW50cyBkcmF3biBpbiB0aGUgY29udGV4dFxyXG4gICAgY29uc3QgbnVjbGV1c0JvdW5kcyA9IG5ldyBCb3VuZHMyKCAwLCAwLCAyICogbWF4UmFkaXVzLCAyICogbWF4UmFkaXVzICk7XHJcblxyXG4gICAgLy8gc2V0IGNhbnZhc0JvdW5kcyBiYXNlZCBvbiBtYXggcmFkaXVzIG9mIGF0b21cclxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG4gICAgb3B0aW9ucy5jYW52YXNCb3VuZHMgPSBudWNsZXVzQm91bmRzO1xyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5udWNsZXVzQm91bmRzID0gbnVjbGV1c0JvdW5kcztcclxuICAgIHRoaXMubnVjbGV1cyA9IG51Y2xldXM7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgLSBsaXN0ZW5lciB0byBwYWludCB0aGUgaWNvbiwgYm91bmQgdG8gdGhpcyBDYW52YXNOb2RlXHJcbiAgICB0aGlzLmJvdW5kUGFpbnROdWNsZXVzSWNvbiA9IHBhaW50TnVjbGV1c0ljb24uYmluZCggdGhpcyApO1xyXG5cclxuICAgIHRoaXMuaW52YWxpZGF0ZVBhaW50KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQYWludCBmdW5jdGlvbiBmb3IgdGhlIGNhbnZhcyBub2RlXHJcbiAgICpcclxuICAgKiBAcGFyYW0gIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGNvbnRleHRcclxuICAgKiBAcHJvdGVjdGVkIEBvdmVycmlkZVxyXG4gICAqL1xyXG4gIHBhaW50Q2FudmFzKCBjb250ZXh0ICkge1xyXG5cclxuICAgIC8vIHBhaW50IHRoZSBudWNsZXVzIHdpdGggY2FudmFzIGFyY3MgLSBzbG93ZXIgdGhhbiBpbWFnZSwgYnV0IGJldHRlciByZXNvbHV0aW9uIGZvciBpY29uc1xyXG4gICAgdGhpcy5ib3VuZFBhaW50TnVjbGV1c0ljb24oIHRoaXMubnVjbGV1cywgdGhpcy5jYW52YXNCb3VuZHMsIGNvbnRleHQsICdjYW52YXNBcmMnICk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogUGFpbnQgYSBudWNsZXVzIGljb24gd2l0aCBjYW52YXMuICBBICdyZW5kZXIgbWV0aG9kJyBpcyB1c2VkIHRvIGRldGVybWluZSB0aGUgc3R5bGUgb2YgcmVuZGVyaW5nLlxyXG4gKiByZW5kZXIgb3B0aW9ucyBhcmUgJ2NhbnZhc0FyYycgYW5kICdjYW52YXNJbWFnZScuICAnY2FudmFzQXJjJyBpcyBhIHNsb3dlciBvcHRpb24sIGJ1dCBoYXMgYmV0dGVyXHJcbiAqIHJlc29sdXRpb24sIGFuZCBpcyBnb29kIGZvciBpY29ucy4gICdjYW52YXNJbWFnZScgaXMgZmFzdGVyIGFuZCBpcyBnb29kIGZvciBkeW5hbWljIGVsZW1lbnRzIHRoYXRcclxuICogbmVlZCB0byBjaGFuZ2UgZnJlcXVlbmx5LCBidXQgaXQgdGVuZHMgdG8gaGF2ZSBwb29yIHJlc29sdXRpb24gYXQgbGFyZ2VyIHNjYWxlcy5cclxuICpcclxuICogQHBhcmFtICB7UnV0aGVyZm9yZE51Y2xldXN9IG51Y2xldXNcclxuICogQHBhcmFtICB7Qm91bmRzMn0gbnVjbGV1c0JvdW5kcyBkZXNjcmlwdGlvblxyXG4gKiBAcGFyYW0gIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGNvbnRleHRcclxuICogQHBhcmFtICB7c3RyaW5nfSByZW5kZXIgLSAnY2FudmFzQXJjJyB8ICdjYW52YXNJbWFnZScsIGRldGVybWluZXMgcmVuZGVyaW5nIG1ldGhvZCwgc2VlIGFib3ZlXHJcbiAqL1xyXG5jb25zdCBwYWludE51Y2xldXNJY29uID0gZnVuY3Rpb24oIG51Y2xldXMsIG51Y2xldXNCb3VuZHMsIGNvbnRleHQsIHJlbmRlciApIHtcclxuICBjb25zdCBwcm90b25zID0gbnVjbGV1cy5wcm90b25zLnNsaWNlKCk7XHJcbiAgY29uc3QgbmV1dHJvbnMgPSBudWNsZXVzLm5ldXRyb25zLnNsaWNlKCk7XHJcbiAgY29uc3QgbnVjbGVvbnMgPSBwcm90b25zLmNvbmNhdCggbmV1dHJvbnMgKTtcclxuXHJcbiAgLy8gZ2V0IHRoZSBudW1iZXIgb2YgbGF5ZXJzIGluIHRoZSBwYXJ0aWNsZVxyXG4gIGxldCB6TGF5ZXIgPSAwO1xyXG4gIG51Y2xlb25zLmZvckVhY2goIG51Y2xlb24gPT4ge1xyXG4gICAgaWYgKCBudWNsZW9uLnpMYXllclByb3BlcnR5LmdldCgpID4gekxheWVyICkge1xyXG4gICAgICB6TGF5ZXIgPSBudWNsZW9uLnpMYXllclByb3BlcnR5LmdldCgpO1xyXG4gICAgfVxyXG4gIH0gKTtcclxuXHJcbiAgLy8gYWRkIHRoZSBsYXllcnMsIHN0YXJ0aW5nIGZyb20gdGhlIGxhcmdlc3Qgd2hpY2ggaXMgaW4gdGhlIGJhY2tcclxuICBmb3IgKCBsZXQgaSA9IHpMYXllcjsgaSA+PSAwOyBpLS0gKSB7XHJcbiAgICBudWNsZW9ucy5mb3JFYWNoKCBudWNsZW9uID0+IHtcclxuICAgICAgaWYgKCBudWNsZW9uLnpMYXllclByb3BlcnR5LmdldCgpID09PSBpICkge1xyXG4gICAgICAgIGxldCB4TiA9IG51Y2xlb24ucG9zaXRpb25Qcm9wZXJ0eS5nZXQoKS54O1xyXG4gICAgICAgIGxldCB5TiA9IG51Y2xlb24ucG9zaXRpb25Qcm9wZXJ0eS5nZXQoKS55O1xyXG5cclxuICAgICAgICBpZiAoIHJlbmRlciA9PT0gJ2NhbnZhc0FyYycgKSB7XHJcbiAgICAgICAgICAvLyBkcmF3aW5nIHdpdGggYXJjcyBpcyBhIGxpdHRsZSBzbG93ZXIsIGJ1dCB0aGUgcmVzdWx0IGlzIGxlc3MgcGl4aWxhdGVkLCBzb1xyXG4gICAgICAgICAgLy8gdGhpcyBtZXRob2QgaXMgZ29vZCBmb3IgZHJhd2luZyBpY29uc1xyXG5cclxuICAgICAgICAgIC8vIGlmIHVzaW5nIGNhbnZhcyBhcmNzIHRvIHJlbmRlciB0aGUgbnVjbGV1cywgb2Zmc2V0IGJ5IGNlbnRlciBvZiBib3VuZHNcclxuICAgICAgICAgIHhOICs9IG51Y2xldXNCb3VuZHMuY2VudGVyWDtcclxuICAgICAgICAgIHlOICs9IG51Y2xldXNCb3VuZHMuY2VudGVyWTtcclxuICAgICAgICAgIGlmICggbnVjbGVvbi50eXBlID09PSAnbmV1dHJvbicgKSB7XHJcbiAgICAgICAgICAgIFBhcnRpY2xlTm9kZUZhY3RvcnkuZHJhd05ldXRyb25XaXRoQ2FudmFzKCB4TiwgeU4sIGNvbnRleHQgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBQYXJ0aWNsZU5vZGVGYWN0b3J5LmRyYXdQcm90b25XaXRoQ2FudmFzKCB4TiwgeU4sIGNvbnRleHQgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIHJlbmRlciA9PT0gJ2NhbnZhc0ltYWdlJyApIHtcclxuICAgICAgICAgIC8vIGRyYXdpbmcgd2l0aCBpbWFnZSBpcyBhIGJpdCBmYXN0ZXIgYnV0IHRoZSByZXN1bHQgY2FuIGJlIHBpeGlsYXRlZCB3aGVuIHNjYWxlZCwgc28gdGhpc1xyXG4gICAgICAgICAgLy8gc2hvdWxkIGJlIHVzZWQgd2hlbiByZW5kZXJpbmcgYSBudWNsZXVzIHRoYXQgc2hvdWxkIGNoYW5nZSBmcmVxdWVudGx5IGFuZCByYXBpZGx5XHJcblxyXG4gICAgICAgICAgLy8gaWYgZHJhd2luZyB3aXRoIGltYWdlcywgb2Zmc2V0IGJ5IGJvdW5kcyBvZiB0aGUgaW1hZ2VcclxuICAgICAgICAgIHhOICs9ICggdGhpcy5jZW50ZXIueCAtIHRoaXMubmV1dHJvbkltYWdlLndpZHRoIC8gMiApO1xyXG4gICAgICAgICAgeU4gKz0gKCB0aGlzLmNlbnRlci55IC0gdGhpcy5uZXV0cm9uSW1hZ2UuaGVpZ2h0IC8gMiApO1xyXG5cclxuICAgICAgICAgIGlmICggbnVjbGVvbi50eXBlID09PSAnbmV1dHJvbicgKSB7XHJcbiAgICAgICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKCB0aGlzLm5ldXRyb25JbWFnZSwgeE4sIHlOLCB0aGlzLm5ldXRyb25JbWFnZS53aWR0aCwgdGhpcy5uZXV0cm9uSW1hZ2UuaGVpZ2h0ICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoIHRoaXMucHJvdG9uSW1hZ2UsIHhOLCB5TiwgdGhpcy5wcm90b25JbWFnZS53aWR0aCwgdGhpcy5wcm90b25JbWFnZS5oZWlnaHQgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBSdXRoZXJmb3JkTnVjbGV1c05vZGU7Il0sIm1hcHBpbmdzIjoiQUFB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