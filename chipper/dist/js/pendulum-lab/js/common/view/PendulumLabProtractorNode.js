// Copyright 2014-2023, University of Colorado Boulder

/**
 * Protractor node in 'Pendulum Lab' simulation.
 *
 * @author Andrey Zelenkov (Mlearner)
 */

import Multilink from '../../../../axon/js/Multilink.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import merge from '../../../../phet-core/js/merge.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import { Circle, Line, Node, Path, Text } from '../../../../scenery/js/imports.js';
import pendulumLab from '../../pendulumLab.js';
import PendulumLabStrings from '../../PendulumLabStrings.js';
import PendulumLabConstants from '../PendulumLabConstants.js';
const degreesPatternString = PendulumLabStrings.degreesPattern;

// constants
const LINE_LENGTH_DEFAULT = 3.6;
const PENDULUM_TICK_LENGTH = 14.7;
const RADIUS = 106;
const TICK_5_LENGTH = 7.3;
const TICK_10_LENGTH = 11;
class PendulumLabProtractorNode extends Node {
  /**
   * @param {Array.<Pendulum>} pendula - Array of pendulum models.
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Object} [options] for protractor node.
   */
  constructor(pendula, modelViewTransform, options) {
    const centralDashLine = new Line(0, 0, 0, modelViewTransform.modelToViewDeltaX(pendula[0].lengthRange.max), {
      stroke: PendulumLabConstants.FIRST_PENDULUM_COLOR,
      lineDash: [4, 7]
    });
    const pivotDot = new Circle(2, {
      fill: 'black'
    });
    const pivotCircle = new Circle(5, {
      stroke: PendulumLabConstants.FIRST_PENDULUM_COLOR
    });

    // create background ticks
    const protractorShape = new Shape();
    for (let currentAngleDegrees = 0; currentAngleDegrees <= 180; currentAngleDegrees += 1) {
      let tickLength;

      // calculate the angle in radians
      const currentAngle = Utils.toRadians(currentAngleDegrees);

      // if the angle is a multiple of 10 then make the tick the longest length
      if (currentAngleDegrees % 10 === 0) {
        tickLength = TICK_10_LENGTH;
      }
      // if the angle is 5 the give it medium length
      else if (currentAngleDegrees % 5 === 0) {
        tickLength = TICK_5_LENGTH;
      }
      // otherwise make the length short
      else {
        tickLength = LINE_LENGTH_DEFAULT;
      }

      // draw the tick first by finding the two positions then by drawing a line between them
      protractorShape.moveToPoint(Vector2.createPolar(RADIUS, currentAngle));
      protractorShape.lineToPoint(Vector2.createPolar(RADIUS + tickLength, currentAngle));
    }
    const protractorPath = new Path(protractorShape, {
      stroke: 'black',
      lineWidth: 0.5
    });

    // Layer for the ticks (angle of release) associated with each pendulum
    const pendulaTickLayers = [new Node(), new Node()];

    // Layer for degrees labels
    const degreesLayer = new Node();
    super(merge({
      pickable: false,
      translation: modelViewTransform.modelToViewPosition(Vector2.ZERO),
      children: [centralDashLine, pivotDot, pivotCircle, degreesLayer, protractorPath, pendulaTickLayers[1], pendulaTickLayers[0]]
    }, options));

    // add ticks for pendulum
    pendula.forEach((pendulum, pendulumIndex) => {
      const tickNodeLeft = new Line(RADIUS - PENDULUM_TICK_LENGTH - 2, 0, RADIUS - 2, 0, {
        stroke: pendulum.color,
        lineWidth: 2
      });
      pendulaTickLayers[pendulumIndex].addChild(tickNodeLeft);
      const tickNodeRight = new Line(RADIUS - PENDULUM_TICK_LENGTH - 2, 0, RADIUS - 2, 0, {
        stroke: pendulum.color,
        lineWidth: 2
      });
      pendulaTickLayers[pendulumIndex].addChild(tickNodeRight);
      const updateTicksPosition = () => {
        if (pendulum.isUserControlledProperty.value) {
          tickNodeLeft.setRotation(Math.PI / 2 - pendulum.angleProperty.value);
          tickNodeRight.setRotation(Math.PI / 2 + pendulum.angleProperty.value);
        }
      };

      // add number of degrees text
      const degreesText = new Text('0', {
        centerY: 15,
        font: PendulumLabConstants.PROTRACTOR_DEGREES_FONT,
        fill: pendulum.color
      });
      degreesLayer.addChild(degreesText);
      const updateDegreesText = () => {
        if (pendulum.isUserControlledProperty.value) {
          const degrees = Utils.toDegrees(pendulum.angleProperty.value);
          assert && assert(degrees <= 180 && degrees >= -180, 'Out of range angle');
          degreesText.string = StringUtils.fillIn(degreesPatternString, {
            degrees: Utils.toFixed(degrees, 0)
          });
          if (pendulumIndex === 0) {
            degreesText.right = -25;
          } else {
            // must be pendulumIndex===1
            degreesText.left = 35;
          }
        }
      };

      // update tick position, present for the lifetime of the sim
      pendulum.angleProperty.link(() => {
        updateTicksPosition();
        updateDegreesText();
      });

      // set ticks visibility observer, present for the lifetime of the sim
      Multilink.multilink([pendulum.isTickVisibleProperty, pendulum.isVisibleProperty], (isTickVisible, isVisible) => {
        tickNodeLeft.visible = isTickVisible && isVisible;
        tickNodeRight.visible = isTickVisible && isVisible;
        updateTicksPosition();
      });

      // set degrees text visibility observer, present for the lifetime of the sim
      pendulum.isUserControlledProperty.link(isUserControlled => {
        degreesText.visible = isUserControlled;
        updateDegreesText();
        updateTicksPosition();
      });
    });
  }
}
pendulumLab.register('PendulumLabProtractorNode', PendulumLabProtractorNode);
export default PendulumLabProtractorNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJVdGlscyIsIlZlY3RvcjIiLCJTaGFwZSIsIm1lcmdlIiwiU3RyaW5nVXRpbHMiLCJDaXJjbGUiLCJMaW5lIiwiTm9kZSIsIlBhdGgiLCJUZXh0IiwicGVuZHVsdW1MYWIiLCJQZW5kdWx1bUxhYlN0cmluZ3MiLCJQZW5kdWx1bUxhYkNvbnN0YW50cyIsImRlZ3JlZXNQYXR0ZXJuU3RyaW5nIiwiZGVncmVlc1BhdHRlcm4iLCJMSU5FX0xFTkdUSF9ERUZBVUxUIiwiUEVORFVMVU1fVElDS19MRU5HVEgiLCJSQURJVVMiLCJUSUNLXzVfTEVOR1RIIiwiVElDS18xMF9MRU5HVEgiLCJQZW5kdWx1bUxhYlByb3RyYWN0b3JOb2RlIiwiY29uc3RydWN0b3IiLCJwZW5kdWxhIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwib3B0aW9ucyIsImNlbnRyYWxEYXNoTGluZSIsIm1vZGVsVG9WaWV3RGVsdGFYIiwibGVuZ3RoUmFuZ2UiLCJtYXgiLCJzdHJva2UiLCJGSVJTVF9QRU5EVUxVTV9DT0xPUiIsImxpbmVEYXNoIiwicGl2b3REb3QiLCJmaWxsIiwicGl2b3RDaXJjbGUiLCJwcm90cmFjdG9yU2hhcGUiLCJjdXJyZW50QW5nbGVEZWdyZWVzIiwidGlja0xlbmd0aCIsImN1cnJlbnRBbmdsZSIsInRvUmFkaWFucyIsIm1vdmVUb1BvaW50IiwiY3JlYXRlUG9sYXIiLCJsaW5lVG9Qb2ludCIsInByb3RyYWN0b3JQYXRoIiwibGluZVdpZHRoIiwicGVuZHVsYVRpY2tMYXllcnMiLCJkZWdyZWVzTGF5ZXIiLCJwaWNrYWJsZSIsInRyYW5zbGF0aW9uIiwibW9kZWxUb1ZpZXdQb3NpdGlvbiIsIlpFUk8iLCJjaGlsZHJlbiIsImZvckVhY2giLCJwZW5kdWx1bSIsInBlbmR1bHVtSW5kZXgiLCJ0aWNrTm9kZUxlZnQiLCJjb2xvciIsImFkZENoaWxkIiwidGlja05vZGVSaWdodCIsInVwZGF0ZVRpY2tzUG9zaXRpb24iLCJpc1VzZXJDb250cm9sbGVkUHJvcGVydHkiLCJ2YWx1ZSIsInNldFJvdGF0aW9uIiwiTWF0aCIsIlBJIiwiYW5nbGVQcm9wZXJ0eSIsImRlZ3JlZXNUZXh0IiwiY2VudGVyWSIsImZvbnQiLCJQUk9UUkFDVE9SX0RFR1JFRVNfRk9OVCIsInVwZGF0ZURlZ3JlZXNUZXh0IiwiZGVncmVlcyIsInRvRGVncmVlcyIsImFzc2VydCIsInN0cmluZyIsImZpbGxJbiIsInRvRml4ZWQiLCJyaWdodCIsImxlZnQiLCJsaW5rIiwibXVsdGlsaW5rIiwiaXNUaWNrVmlzaWJsZVByb3BlcnR5IiwiaXNWaXNpYmxlUHJvcGVydHkiLCJpc1RpY2tWaXNpYmxlIiwiaXNWaXNpYmxlIiwidmlzaWJsZSIsImlzVXNlckNvbnRyb2xsZWQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlBlbmR1bHVtTGFiUHJvdHJhY3Rvck5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogUHJvdHJhY3RvciBub2RlIGluICdQZW5kdWx1bSBMYWInIHNpbXVsYXRpb24uXHJcbiAqXHJcbiAqIEBhdXRob3IgQW5kcmV5IFplbGVua292IChNbGVhcm5lcilcclxuICovXHJcblxyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCB7IENpcmNsZSwgTGluZSwgTm9kZSwgUGF0aCwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBwZW5kdWx1bUxhYiBmcm9tICcuLi8uLi9wZW5kdWx1bUxhYi5qcyc7XHJcbmltcG9ydCBQZW5kdWx1bUxhYlN0cmluZ3MgZnJvbSAnLi4vLi4vUGVuZHVsdW1MYWJTdHJpbmdzLmpzJztcclxuaW1wb3J0IFBlbmR1bHVtTGFiQ29uc3RhbnRzIGZyb20gJy4uL1BlbmR1bHVtTGFiQ29uc3RhbnRzLmpzJztcclxuXHJcbmNvbnN0IGRlZ3JlZXNQYXR0ZXJuU3RyaW5nID0gUGVuZHVsdW1MYWJTdHJpbmdzLmRlZ3JlZXNQYXR0ZXJuO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IExJTkVfTEVOR1RIX0RFRkFVTFQgPSAzLjY7XHJcbmNvbnN0IFBFTkRVTFVNX1RJQ0tfTEVOR1RIID0gMTQuNztcclxuY29uc3QgUkFESVVTID0gMTA2O1xyXG5jb25zdCBUSUNLXzVfTEVOR1RIID0gNy4zO1xyXG5jb25zdCBUSUNLXzEwX0xFTkdUSCA9IDExO1xyXG5cclxuY2xhc3MgUGVuZHVsdW1MYWJQcm90cmFjdG9yTm9kZSBleHRlbmRzIE5vZGUge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7QXJyYXkuPFBlbmR1bHVtPn0gcGVuZHVsYSAtIEFycmF5IG9mIHBlbmR1bHVtIG1vZGVscy5cclxuICAgKiBAcGFyYW0ge01vZGVsVmlld1RyYW5zZm9ybTJ9IG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gZm9yIHByb3RyYWN0b3Igbm9kZS5cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggcGVuZHVsYSwgbW9kZWxWaWV3VHJhbnNmb3JtLCBvcHRpb25zICkge1xyXG4gICAgY29uc3QgY2VudHJhbERhc2hMaW5lID0gbmV3IExpbmUoIDAsIDAsIDAsIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggcGVuZHVsYVsgMCBdLmxlbmd0aFJhbmdlLm1heCApLCB7XHJcbiAgICAgIHN0cm9rZTogUGVuZHVsdW1MYWJDb25zdGFudHMuRklSU1RfUEVORFVMVU1fQ09MT1IsXHJcbiAgICAgIGxpbmVEYXNoOiBbIDQsIDcgXVxyXG4gICAgfSApO1xyXG4gICAgY29uc3QgcGl2b3REb3QgPSBuZXcgQ2lyY2xlKCAyLCB7IGZpbGw6ICdibGFjaycgfSApO1xyXG4gICAgY29uc3QgcGl2b3RDaXJjbGUgPSBuZXcgQ2lyY2xlKCA1LCB7IHN0cm9rZTogUGVuZHVsdW1MYWJDb25zdGFudHMuRklSU1RfUEVORFVMVU1fQ09MT1IgfSApO1xyXG5cclxuICAgIC8vIGNyZWF0ZSBiYWNrZ3JvdW5kIHRpY2tzXHJcbiAgICBjb25zdCBwcm90cmFjdG9yU2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuICAgIGZvciAoIGxldCBjdXJyZW50QW5nbGVEZWdyZWVzID0gMDsgY3VycmVudEFuZ2xlRGVncmVlcyA8PSAxODA7IGN1cnJlbnRBbmdsZURlZ3JlZXMgKz0gMSApIHtcclxuICAgICAgbGV0IHRpY2tMZW5ndGg7XHJcblxyXG4gICAgICAvLyBjYWxjdWxhdGUgdGhlIGFuZ2xlIGluIHJhZGlhbnNcclxuICAgICAgY29uc3QgY3VycmVudEFuZ2xlID0gVXRpbHMudG9SYWRpYW5zKCBjdXJyZW50QW5nbGVEZWdyZWVzICk7XHJcblxyXG4gICAgICAvLyBpZiB0aGUgYW5nbGUgaXMgYSBtdWx0aXBsZSBvZiAxMCB0aGVuIG1ha2UgdGhlIHRpY2sgdGhlIGxvbmdlc3QgbGVuZ3RoXHJcbiAgICAgIGlmICggY3VycmVudEFuZ2xlRGVncmVlcyAlIDEwID09PSAwICkge1xyXG4gICAgICAgIHRpY2tMZW5ndGggPSBUSUNLXzEwX0xFTkdUSDtcclxuICAgICAgfVxyXG4gICAgICAvLyBpZiB0aGUgYW5nbGUgaXMgNSB0aGUgZ2l2ZSBpdCBtZWRpdW0gbGVuZ3RoXHJcbiAgICAgIGVsc2UgaWYgKCBjdXJyZW50QW5nbGVEZWdyZWVzICUgNSA9PT0gMCApIHtcclxuICAgICAgICB0aWNrTGVuZ3RoID0gVElDS181X0xFTkdUSDtcclxuICAgICAgfVxyXG4gICAgICAvLyBvdGhlcndpc2UgbWFrZSB0aGUgbGVuZ3RoIHNob3J0XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRpY2tMZW5ndGggPSBMSU5FX0xFTkdUSF9ERUZBVUxUO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBkcmF3IHRoZSB0aWNrIGZpcnN0IGJ5IGZpbmRpbmcgdGhlIHR3byBwb3NpdGlvbnMgdGhlbiBieSBkcmF3aW5nIGEgbGluZSBiZXR3ZWVuIHRoZW1cclxuICAgICAgcHJvdHJhY3RvclNoYXBlLm1vdmVUb1BvaW50KCBWZWN0b3IyLmNyZWF0ZVBvbGFyKCBSQURJVVMsIGN1cnJlbnRBbmdsZSApICk7XHJcbiAgICAgIHByb3RyYWN0b3JTaGFwZS5saW5lVG9Qb2ludCggVmVjdG9yMi5jcmVhdGVQb2xhciggUkFESVVTICsgdGlja0xlbmd0aCwgY3VycmVudEFuZ2xlICkgKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHByb3RyYWN0b3JQYXRoID0gbmV3IFBhdGgoIHByb3RyYWN0b3JTaGFwZSwge1xyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGxpbmVXaWR0aDogMC41XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gTGF5ZXIgZm9yIHRoZSB0aWNrcyAoYW5nbGUgb2YgcmVsZWFzZSkgYXNzb2NpYXRlZCB3aXRoIGVhY2ggcGVuZHVsdW1cclxuICAgIGNvbnN0IHBlbmR1bGFUaWNrTGF5ZXJzID0gWyBuZXcgTm9kZSgpLCBuZXcgTm9kZSgpIF07XHJcblxyXG4gICAgLy8gTGF5ZXIgZm9yIGRlZ3JlZXMgbGFiZWxzXHJcbiAgICBjb25zdCBkZWdyZWVzTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG5cclxuICAgIHN1cGVyKCBtZXJnZSgge1xyXG4gICAgICBwaWNrYWJsZTogZmFsc2UsXHJcbiAgICAgIHRyYW5zbGF0aW9uOiBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggVmVjdG9yMi5aRVJPICksXHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgY2VudHJhbERhc2hMaW5lLFxyXG4gICAgICAgIHBpdm90RG90LFxyXG4gICAgICAgIHBpdm90Q2lyY2xlLFxyXG4gICAgICAgIGRlZ3JlZXNMYXllcixcclxuICAgICAgICBwcm90cmFjdG9yUGF0aCxcclxuICAgICAgICBwZW5kdWxhVGlja0xheWVyc1sgMSBdLFxyXG4gICAgICAgIHBlbmR1bGFUaWNrTGF5ZXJzWyAwIF1cclxuICAgICAgXVxyXG4gICAgfSwgb3B0aW9ucyApICk7XHJcblxyXG5cclxuICAgIC8vIGFkZCB0aWNrcyBmb3IgcGVuZHVsdW1cclxuICAgIHBlbmR1bGEuZm9yRWFjaCggKCBwZW5kdWx1bSwgcGVuZHVsdW1JbmRleCApID0+IHtcclxuICAgICAgY29uc3QgdGlja05vZGVMZWZ0ID0gbmV3IExpbmUoIFJBRElVUyAtIFBFTkRVTFVNX1RJQ0tfTEVOR1RIIC0gMiwgMCwgUkFESVVTIC0gMiwgMCwge1xyXG4gICAgICAgIHN0cm9rZTogcGVuZHVsdW0uY29sb3IsXHJcbiAgICAgICAgbGluZVdpZHRoOiAyXHJcbiAgICAgIH0gKTtcclxuICAgICAgcGVuZHVsYVRpY2tMYXllcnNbIHBlbmR1bHVtSW5kZXggXS5hZGRDaGlsZCggdGlja05vZGVMZWZ0ICk7XHJcbiAgICAgIGNvbnN0IHRpY2tOb2RlUmlnaHQgPSBuZXcgTGluZSggUkFESVVTIC0gUEVORFVMVU1fVElDS19MRU5HVEggLSAyLCAwLCBSQURJVVMgLSAyLCAwLCB7XHJcbiAgICAgICAgc3Ryb2tlOiBwZW5kdWx1bS5jb2xvcixcclxuICAgICAgICBsaW5lV2lkdGg6IDJcclxuICAgICAgfSApO1xyXG4gICAgICBwZW5kdWxhVGlja0xheWVyc1sgcGVuZHVsdW1JbmRleCBdLmFkZENoaWxkKCB0aWNrTm9kZVJpZ2h0ICk7XHJcblxyXG4gICAgICBjb25zdCB1cGRhdGVUaWNrc1Bvc2l0aW9uID0gKCkgPT4ge1xyXG4gICAgICAgIGlmICggcGVuZHVsdW0uaXNVc2VyQ29udHJvbGxlZFByb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICAgICAgdGlja05vZGVMZWZ0LnNldFJvdGF0aW9uKCBNYXRoLlBJIC8gMiAtIHBlbmR1bHVtLmFuZ2xlUHJvcGVydHkudmFsdWUgKTtcclxuICAgICAgICAgIHRpY2tOb2RlUmlnaHQuc2V0Um90YXRpb24oIE1hdGguUEkgLyAyICsgcGVuZHVsdW0uYW5nbGVQcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIGFkZCBudW1iZXIgb2YgZGVncmVlcyB0ZXh0XHJcbiAgICAgIGNvbnN0IGRlZ3JlZXNUZXh0ID0gbmV3IFRleHQoICcwJywge1xyXG4gICAgICAgIGNlbnRlclk6IDE1LFxyXG4gICAgICAgIGZvbnQ6IFBlbmR1bHVtTGFiQ29uc3RhbnRzLlBST1RSQUNUT1JfREVHUkVFU19GT05ULFxyXG4gICAgICAgIGZpbGw6IHBlbmR1bHVtLmNvbG9yXHJcbiAgICAgIH0gKTtcclxuICAgICAgZGVncmVlc0xheWVyLmFkZENoaWxkKCBkZWdyZWVzVGV4dCApO1xyXG5cclxuICAgICAgY29uc3QgdXBkYXRlRGVncmVlc1RleHQgPSAoKSA9PiB7XHJcbiAgICAgICAgaWYgKCBwZW5kdWx1bS5pc1VzZXJDb250cm9sbGVkUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgICBjb25zdCBkZWdyZWVzID0gVXRpbHMudG9EZWdyZWVzKCBwZW5kdWx1bS5hbmdsZVByb3BlcnR5LnZhbHVlICk7XHJcbiAgICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBkZWdyZWVzIDw9IDE4MCAmJiBkZWdyZWVzID49IC0xODAsICdPdXQgb2YgcmFuZ2UgYW5nbGUnICk7XHJcblxyXG4gICAgICAgICAgZGVncmVlc1RleHQuc3RyaW5nID0gU3RyaW5nVXRpbHMuZmlsbEluKCBkZWdyZWVzUGF0dGVyblN0cmluZywge1xyXG4gICAgICAgICAgICBkZWdyZWVzOiBVdGlscy50b0ZpeGVkKCBkZWdyZWVzLCAwIClcclxuICAgICAgICAgIH0gKTtcclxuICAgICAgICAgIGlmICggcGVuZHVsdW1JbmRleCA9PT0gMCApIHtcclxuICAgICAgICAgICAgZGVncmVlc1RleHQucmlnaHQgPSAtMjU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gbXVzdCBiZSBwZW5kdWx1bUluZGV4PT09MVxyXG4gICAgICAgICAgICBkZWdyZWVzVGV4dC5sZWZ0ID0gMzU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gdXBkYXRlIHRpY2sgcG9zaXRpb24sIHByZXNlbnQgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltXHJcbiAgICAgIHBlbmR1bHVtLmFuZ2xlUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICAgIHVwZGF0ZVRpY2tzUG9zaXRpb24oKTtcclxuICAgICAgICB1cGRhdGVEZWdyZWVzVGV4dCgpO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBzZXQgdGlja3MgdmlzaWJpbGl0eSBvYnNlcnZlciwgcHJlc2VudCBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW1cclxuICAgICAgTXVsdGlsaW5rLm11bHRpbGluayggWyBwZW5kdWx1bS5pc1RpY2tWaXNpYmxlUHJvcGVydHksIHBlbmR1bHVtLmlzVmlzaWJsZVByb3BlcnR5IF0sICggaXNUaWNrVmlzaWJsZSwgaXNWaXNpYmxlICkgPT4ge1xyXG4gICAgICAgIHRpY2tOb2RlTGVmdC52aXNpYmxlID0gaXNUaWNrVmlzaWJsZSAmJiBpc1Zpc2libGU7XHJcbiAgICAgICAgdGlja05vZGVSaWdodC52aXNpYmxlID0gaXNUaWNrVmlzaWJsZSAmJiBpc1Zpc2libGU7XHJcbiAgICAgICAgdXBkYXRlVGlja3NQb3NpdGlvbigpO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBzZXQgZGVncmVlcyB0ZXh0IHZpc2liaWxpdHkgb2JzZXJ2ZXIsIHByZXNlbnQgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltXHJcbiAgICAgIHBlbmR1bHVtLmlzVXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5saW5rKCBpc1VzZXJDb250cm9sbGVkID0+IHtcclxuICAgICAgICBkZWdyZWVzVGV4dC52aXNpYmxlID0gaXNVc2VyQ29udHJvbGxlZDtcclxuICAgICAgICB1cGRhdGVEZWdyZWVzVGV4dCgpO1xyXG4gICAgICAgIHVwZGF0ZVRpY2tzUG9zaXRpb24oKTtcclxuICAgICAgfSApO1xyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxucGVuZHVsdW1MYWIucmVnaXN0ZXIoICdQZW5kdWx1bUxhYlByb3RyYWN0b3JOb2RlJywgUGVuZHVsdW1MYWJQcm90cmFjdG9yTm9kZSApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgUGVuZHVsdW1MYWJQcm90cmFjdG9yTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsU0FBUyxNQUFNLGtDQUFrQztBQUN4RCxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsU0FBU0MsS0FBSyxRQUFRLGdDQUFnQztBQUN0RCxPQUFPQyxLQUFLLE1BQU0sbUNBQW1DO0FBQ3JELE9BQU9DLFdBQVcsTUFBTSwrQ0FBK0M7QUFDdkUsU0FBU0MsTUFBTSxFQUFFQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsSUFBSSxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ2xGLE9BQU9DLFdBQVcsTUFBTSxzQkFBc0I7QUFDOUMsT0FBT0Msa0JBQWtCLE1BQU0sNkJBQTZCO0FBQzVELE9BQU9DLG9CQUFvQixNQUFNLDRCQUE0QjtBQUU3RCxNQUFNQyxv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