// Copyright 2019-2022, University of Colorado Boulder

/**
 * MolarityAlertManager is responsible for generating and adding alerts to the utteranceQueue. This file is responsible
 * for all of the interfacing with utteranceQueue for the whole sim.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 * @author Taylor Want (PhET Interactive Simulations)
 */

import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import Alerter from '../../../../scenery-phet/js/accessibility/describers/Alerter.js';
import ActivationUtterance from '../../../../utterance-queue/js/ActivationUtterance.js';
import Utterance from '../../../../utterance-queue/js/Utterance.js';
import ValueChangeUtterance from '../../../../utterance-queue/js/ValueChangeUtterance.js';
import molarity from '../../molarity.js';
import MolarityStrings from '../../MolarityStrings.js';
const atMaxConcentrationAlertPatternString = MolarityStrings.a11y.atMaxConcentrationAlertPattern;
const noSoluteAlertString = MolarityStrings.a11y.noSoluteAlert;
const qualitativeSaturatedValueTextPatternString = MolarityStrings.a11y.qualitative.saturatedValueTextPattern;
const qualitativeSliderAlertPatternString = MolarityStrings.a11y.qualitative.sliderAlertPattern;
const quantitativeSaturatedValueTextPatternString = MolarityStrings.a11y.quantitative.saturatedValueTextPattern;
const quantitativeSliderAlertPatternString = MolarityStrings.a11y.quantitative.sliderAlertPattern;
const solutionValuesCheckedAlertString = MolarityStrings.a11y.solutionValuesCheckedAlert;
const solutionValuesUncheckedAlertString = MolarityStrings.a11y.solutionValuesUncheckedAlert;
class MolarityAlertManager extends Alerter {
  /**
   * Initialize the alert manager, linking to the needed model Properties.
   * @param {Node} node
   * @param {MacroSolution} solution - from MolarityModel.
   * @param {Property.<boolean>} useQuantitativeDescriptionsProperty - whether or not to use qualitative or
   *                                                                   quantitative descriptions.
   * @param {ConcentrationDescriber} concentrationDescriber
   * @param {PrecipitateAmountDescriber} precipitateAmountDescriber
   * @param {SoluteAmountDescriber} soluteAmountDescriber
   * @param {VolumeDescriber} volumeDescriber
   * @param {SoluteDescriber} soluteDescriber
   * @param {Property.<boolean>} valuesVisibleProperty - toggles display for whether the "solution values" checkbox is
   *                                                     checked.
   * @public
   */
  constructor(node, solution, useQuantitativeDescriptionsProperty, concentrationDescriber, precipitateAmountDescriber, soluteAmountDescriber, volumeDescriber, soluteDescriber, valuesVisibleProperty) {
    super({
      descriptionAlertNode: node
    });

    // @private - utterances with specific jobs so that duplicates are overwritten in the queue.
    this.saturationUtterance = new Utterance();
    this.sliderUtterance = new ValueChangeUtterance();
    this.soluteUtterance = new ActivationUtterance();
    this.valuesVisibleUtterance = new ActivationUtterance();

    // @private
    this.concentrationDescriber = concentrationDescriber;
    this.precipitateAmountDescriber = precipitateAmountDescriber;
    this.soluteDescriber = soluteDescriber;
    this.solution = solution;
    this.useQuantitativeDescriptionsProperty = useQuantitativeDescriptionsProperty;

    // An alert is read out when the solute is changed.
    solution.soluteProperty.lazyLink(() => this.alertSoluteChanged());

    // An alert is read out when the valuesVisibleProperty changes.
    valuesVisibleProperty.lazyLink(newValue => this.alertValuesVisibleChanged(newValue));
  }

  /**
   * Alert when a user driven (likely from a slider) solution value was changed.
   * @param {{getStringsFromSliderChange:function():StringsFromSliderChange, getRegionChanged:function():boolean}} describer
   * @private
   */
  alertSolutionQuantityChanged(describer) {
    // A special alert is read out if the solution is at max concentration without any precipitate.
    if (!this.solution.isSaturated() && this.solution.atMaxConcentration()) {
      this.alertMaxConcentrationNotSaturated();
    }

    // alert when the solution has just become saturated, or has just become unsaturated.
    else if (this.concentrationDescriber.saturationValueChanged) {
      this.alertNewlySaturated();
    }

    // alert when there is no solute in the solution (so the solution is just water)
    else if (!this.solution.hasSolute()) {
      this.alertNoSolute(this.useQuantitativeDescriptionsProperty);
    }

    // quantitative alerts (when the 'solution values' checkbox is checked)
    else if (this.useQuantitativeDescriptionsProperty.value) {
      this.alertSliderQuantitative();
    }

    // qualitative alerts (when the 'solution values' checkbox is unchecked)
    else {
      this.alertSliderQualitative(describer.getStringsFromSliderChange(), describer.getRegionChanged());
    }
  }

  /**
   * Alert when the solution is exactly at the max concentration point without any precipitate
   * @private
   */
  alertMaxConcentrationNotSaturated() {
    this.sliderUtterance.alert = StringUtils.fillIn(atMaxConcentrationAlertPatternString, {
      concentration: this.concentrationDescriber.getCurrentConcentrationClause(true)
    });
    this.alertDescriptionUtterance(this.sliderUtterance);
  }

  /**
   * Alert when the solution is either newly saturated or newly unsaturated.
   * @private
   */
  alertNewlySaturated() {
    this.forEachUtteranceQueue(utteranceQueue => {
      // sliderUtterance must be removed from the queue because it is otherwise possible to get stale slider alerts that no
      // longer make sense with the current saturation state.
      if (utteranceQueue.hasUtterance(this.sliderUtterance)) {
        utteranceQueue.removeUtterance(this.sliderUtterance);
      }
      this.saturationUtterance.alert = this.precipitateAmountDescriber.getSaturationChangedString();
      utteranceQueue.addToFront(this.saturationUtterance);
    });
  }

  /**
   * Alerts when there is no solute in the beaker.
   * @private
   */
  alertNoSolute() {
    assert && assert(!this.solution.hasSolute(), 'no solute alert triggered with solute in the beaker');
    this.sliderUtterance.alert = noSoluteAlertString;
    this.alertDescriptionUtterance(this.sliderUtterance);
  }

  /**
   * Alerts when there is a change in solute.
   * @private
   */
  alertSoluteChanged() {
    this.soluteUtterance.alert = this.soluteDescriber.getSoluteChangedAlertString(this.useQuantitativeDescriptionsProperty);
    this.alertDescriptionUtterance(this.soluteUtterance);
  }

  /**
   * Alerts when there is a change in the valuesVisibleProperty
   * @param {Property.<boolean>} valuesVisibleProperty
   * @private
   */
  alertValuesVisibleChanged(valuesVisibleProperty) {
    this.valuesVisibleUtterance.alert = valuesVisibleProperty ? solutionValuesCheckedAlertString : solutionValuesUncheckedAlertString;
    this.alertDescriptionUtterance(this.valuesVisibleUtterance);
  }

  /**
   * When qualitative descriptions are being used and SoluteAmountProperty or VolumeProperty changes, creates an alert.
   * @param {StringsFromSliderChange} changeStrings - contains multiple strings.
   * @param {boolean} quantityRegionChanged - indicates whether the changed Property (SoluteAmount or Volume) has changed
   * description regions.
   * @private
   */
  alertSliderQualitative(changeStrings, quantityRegionChanged) {
    assert && assert(!this.useQuantitativeDescriptionsProperty.value, 'quantitative descriptions should be used.');
    let alertText = '';

    // alert text is different based on whether or not the solution is saturated.
    if (this.solution.isSaturated()) {
      alertText = StringUtils.fillIn(qualitativeSaturatedValueTextPatternString, {
        propertyAmountChange: changeStrings.quantityChangeString,
        solidsChange: this.precipitateAmountDescriber.getPrecipitateAmountChangeString(),
        stillSaturatedClause: this.precipitateAmountDescriber.getStillSaturatedClause()
      });
    } else {
      // information about the state of solution (particularly its concentration is appended to the alert if the descriptive
      // region has changed for any relevant quantity.
      const includeStateInfo = quantityRegionChanged || this.concentrationDescriber.concentrationRegionChanged;
      alertText = StringUtils.fillIn(qualitativeSliderAlertPatternString, {
        quantityChange: changeStrings.quantityChangeString,
        colorChange: changeStrings.colorChangeString,
        stateInfo: includeStateInfo ? this.concentrationDescriber.getQualitativeConcentrationDescription() : ''
      });
    }
    this.sliderUtterance.alert = alertText;
    this.alertDescriptionUtterance(this.sliderUtterance);
  }

  /**
   * When quantitative descriptions are used, and SoluteAmountProperty or VolumeProperty changes, creates an alert.
   * @private
   */
  alertSliderQuantitative() {
    assert && assert(this.useQuantitativeDescriptionsProperty.value, 'qualitative descriptions should be used.');
    let alertText = '';
    if (this.solution.isSaturated()) {
      alertText = StringUtils.fillIn(quantitativeSaturatedValueTextPatternString, {
        solidsChange: this.precipitateAmountDescriber.getPrecipitateAmountChangeString(true),
        stillSaturatedClause: this.precipitateAmountDescriber.getStillSaturatedClause()
      });
    } else {
      alertText = StringUtils.fillIn(quantitativeSliderAlertPatternString, {
        concentrationChange: this.concentrationDescriber.getConcentrationChangeString(),
        concentration: this.concentrationDescriber.getCurrentConcentrationClause(),
        colorChange: this.concentrationDescriber.getColorChangeString()
      });
    }
    this.sliderUtterance.alert = alertText;
    this.alertDescriptionUtterance(this.sliderUtterance);
  }
}

/**
 * This contains two strings; these strings can be used as component pieces of longer alert strings.
 * @typedef StringsFromSliderChange
 * @type {Object}
 * @property {string} colorChangeString - describing the color change of the solute
 * @property {string} quantityChangeString - describing the slider quantity that changed
 */

molarity.register('MolarityAlertManager', MolarityAlertManager);
export default MolarityAlertManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTdHJpbmdVdGlscyIsIkFsZXJ0ZXIiLCJBY3RpdmF0aW9uVXR0ZXJhbmNlIiwiVXR0ZXJhbmNlIiwiVmFsdWVDaGFuZ2VVdHRlcmFuY2UiLCJtb2xhcml0eSIsIk1vbGFyaXR5U3RyaW5ncyIsImF0TWF4Q29uY2VudHJhdGlvbkFsZXJ0UGF0dGVyblN0cmluZyIsImExMXkiLCJhdE1heENvbmNlbnRyYXRpb25BbGVydFBhdHRlcm4iLCJub1NvbHV0ZUFsZXJ0U3RyaW5nIiwibm9Tb2x1dGVBbGVydCIsInF1YWxpdGF0aXZlU2F0dXJhdGVkVmFsdWVUZXh0UGF0dGVyblN0cmluZyIsInF1YWxpdGF0aXZlIiwic2F0dXJhdGVkVmFsdWVUZXh0UGF0dGVybiIsInF1YWxpdGF0aXZlU2xpZGVyQWxlcnRQYXR0ZXJuU3RyaW5nIiwic2xpZGVyQWxlcnRQYXR0ZXJuIiwicXVhbnRpdGF0aXZlU2F0dXJhdGVkVmFsdWVUZXh0UGF0dGVyblN0cmluZyIsInF1YW50aXRhdGl2ZSIsInF1YW50aXRhdGl2ZVNsaWRlckFsZXJ0UGF0dGVyblN0cmluZyIsInNvbHV0aW9uVmFsdWVzQ2hlY2tlZEFsZXJ0U3RyaW5nIiwic29sdXRpb25WYWx1ZXNDaGVja2VkQWxlcnQiLCJzb2x1dGlvblZhbHVlc1VuY2hlY2tlZEFsZXJ0U3RyaW5nIiwic29sdXRpb25WYWx1ZXNVbmNoZWNrZWRBbGVydCIsIk1vbGFyaXR5QWxlcnRNYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJub2RlIiwic29sdXRpb24iLCJ1c2VRdWFudGl0YXRpdmVEZXNjcmlwdGlvbnNQcm9wZXJ0eSIsImNvbmNlbnRyYXRpb25EZXNjcmliZXIiLCJwcmVjaXBpdGF0ZUFtb3VudERlc2NyaWJlciIsInNvbHV0ZUFtb3VudERlc2NyaWJlciIsInZvbHVtZURlc2NyaWJlciIsInNvbHV0ZURlc2NyaWJlciIsInZhbHVlc1Zpc2libGVQcm9wZXJ0eSIsImRlc2NyaXB0aW9uQWxlcnROb2RlIiwic2F0dXJhdGlvblV0dGVyYW5jZSIsInNsaWRlclV0dGVyYW5jZSIsInNvbHV0ZVV0dGVyYW5jZSIsInZhbHVlc1Zpc2libGVVdHRlcmFuY2UiLCJzb2x1dGVQcm9wZXJ0eSIsImxhenlMaW5rIiwiYWxlcnRTb2x1dGVDaGFuZ2VkIiwibmV3VmFsdWUiLCJhbGVydFZhbHVlc1Zpc2libGVDaGFuZ2VkIiwiYWxlcnRTb2x1dGlvblF1YW50aXR5Q2hhbmdlZCIsImRlc2NyaWJlciIsImlzU2F0dXJhdGVkIiwiYXRNYXhDb25jZW50cmF0aW9uIiwiYWxlcnRNYXhDb25jZW50cmF0aW9uTm90U2F0dXJhdGVkIiwic2F0dXJhdGlvblZhbHVlQ2hhbmdlZCIsImFsZXJ0TmV3bHlTYXR1cmF0ZWQiLCJoYXNTb2x1dGUiLCJhbGVydE5vU29sdXRlIiwidmFsdWUiLCJhbGVydFNsaWRlclF1YW50aXRhdGl2ZSIsImFsZXJ0U2xpZGVyUXVhbGl0YXRpdmUiLCJnZXRTdHJpbmdzRnJvbVNsaWRlckNoYW5nZSIsImdldFJlZ2lvbkNoYW5nZWQiLCJhbGVydCIsImZpbGxJbiIsImNvbmNlbnRyYXRpb24iLCJnZXRDdXJyZW50Q29uY2VudHJhdGlvbkNsYXVzZSIsImFsZXJ0RGVzY3JpcHRpb25VdHRlcmFuY2UiLCJmb3JFYWNoVXR0ZXJhbmNlUXVldWUiLCJ1dHRlcmFuY2VRdWV1ZSIsImhhc1V0dGVyYW5jZSIsInJlbW92ZVV0dGVyYW5jZSIsImdldFNhdHVyYXRpb25DaGFuZ2VkU3RyaW5nIiwiYWRkVG9Gcm9udCIsImFzc2VydCIsImdldFNvbHV0ZUNoYW5nZWRBbGVydFN0cmluZyIsImNoYW5nZVN0cmluZ3MiLCJxdWFudGl0eVJlZ2lvbkNoYW5nZWQiLCJhbGVydFRleHQiLCJwcm9wZXJ0eUFtb3VudENoYW5nZSIsInF1YW50aXR5Q2hhbmdlU3RyaW5nIiwic29saWRzQ2hhbmdlIiwiZ2V0UHJlY2lwaXRhdGVBbW91bnRDaGFuZ2VTdHJpbmciLCJzdGlsbFNhdHVyYXRlZENsYXVzZSIsImdldFN0aWxsU2F0dXJhdGVkQ2xhdXNlIiwiaW5jbHVkZVN0YXRlSW5mbyIsImNvbmNlbnRyYXRpb25SZWdpb25DaGFuZ2VkIiwicXVhbnRpdHlDaGFuZ2UiLCJjb2xvckNoYW5nZSIsImNvbG9yQ2hhbmdlU3RyaW5nIiwic3RhdGVJbmZvIiwiZ2V0UXVhbGl0YXRpdmVDb25jZW50cmF0aW9uRGVzY3JpcHRpb24iLCJjb25jZW50cmF0aW9uQ2hhbmdlIiwiZ2V0Q29uY2VudHJhdGlvbkNoYW5nZVN0cmluZyIsImdldENvbG9yQ2hhbmdlU3RyaW5nIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJNb2xhcml0eUFsZXJ0TWFuYWdlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBNb2xhcml0eUFsZXJ0TWFuYWdlciBpcyByZXNwb25zaWJsZSBmb3IgZ2VuZXJhdGluZyBhbmQgYWRkaW5nIGFsZXJ0cyB0byB0aGUgdXR0ZXJhbmNlUXVldWUuIFRoaXMgZmlsZSBpcyByZXNwb25zaWJsZVxyXG4gKiBmb3IgYWxsIG9mIHRoZSBpbnRlcmZhY2luZyB3aXRoIHV0dGVyYW5jZVF1ZXVlIGZvciB0aGUgd2hvbGUgc2ltLlxyXG4gKlxyXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgVGF5bG9yIFdhbnQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCBBbGVydGVyIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9hY2Nlc3NpYmlsaXR5L2Rlc2NyaWJlcnMvQWxlcnRlci5qcyc7XHJcbmltcG9ydCBBY3RpdmF0aW9uVXR0ZXJhbmNlIGZyb20gJy4uLy4uLy4uLy4uL3V0dGVyYW5jZS1xdWV1ZS9qcy9BY3RpdmF0aW9uVXR0ZXJhbmNlLmpzJztcclxuaW1wb3J0IFV0dGVyYW5jZSBmcm9tICcuLi8uLi8uLi8uLi91dHRlcmFuY2UtcXVldWUvanMvVXR0ZXJhbmNlLmpzJztcclxuaW1wb3J0IFZhbHVlQ2hhbmdlVXR0ZXJhbmNlIGZyb20gJy4uLy4uLy4uLy4uL3V0dGVyYW5jZS1xdWV1ZS9qcy9WYWx1ZUNoYW5nZVV0dGVyYW5jZS5qcyc7XHJcbmltcG9ydCBtb2xhcml0eSBmcm9tICcuLi8uLi9tb2xhcml0eS5qcyc7XHJcbmltcG9ydCBNb2xhcml0eVN0cmluZ3MgZnJvbSAnLi4vLi4vTW9sYXJpdHlTdHJpbmdzLmpzJztcclxuXHJcbmNvbnN0IGF0TWF4Q29uY2VudHJhdGlvbkFsZXJ0UGF0dGVyblN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5LmF0TWF4Q29uY2VudHJhdGlvbkFsZXJ0UGF0dGVybjtcclxuY29uc3Qgbm9Tb2x1dGVBbGVydFN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5Lm5vU29sdXRlQWxlcnQ7XHJcbmNvbnN0IHF1YWxpdGF0aXZlU2F0dXJhdGVkVmFsdWVUZXh0UGF0dGVyblN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5LnF1YWxpdGF0aXZlLnNhdHVyYXRlZFZhbHVlVGV4dFBhdHRlcm47XHJcbmNvbnN0IHF1YWxpdGF0aXZlU2xpZGVyQWxlcnRQYXR0ZXJuU3RyaW5nID0gTW9sYXJpdHlTdHJpbmdzLmExMXkucXVhbGl0YXRpdmUuc2xpZGVyQWxlcnRQYXR0ZXJuO1xyXG5jb25zdCBxdWFudGl0YXRpdmVTYXR1cmF0ZWRWYWx1ZVRleHRQYXR0ZXJuU3RyaW5nID0gTW9sYXJpdHlTdHJpbmdzLmExMXkucXVhbnRpdGF0aXZlLnNhdHVyYXRlZFZhbHVlVGV4dFBhdHRlcm47XHJcbmNvbnN0IHF1YW50aXRhdGl2ZVNsaWRlckFsZXJ0UGF0dGVyblN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5LnF1YW50aXRhdGl2ZS5zbGlkZXJBbGVydFBhdHRlcm47XHJcbmNvbnN0IHNvbHV0aW9uVmFsdWVzQ2hlY2tlZEFsZXJ0U3RyaW5nID0gTW9sYXJpdHlTdHJpbmdzLmExMXkuc29sdXRpb25WYWx1ZXNDaGVja2VkQWxlcnQ7XHJcbmNvbnN0IHNvbHV0aW9uVmFsdWVzVW5jaGVja2VkQWxlcnRTdHJpbmcgPSBNb2xhcml0eVN0cmluZ3MuYTExeS5zb2x1dGlvblZhbHVlc1VuY2hlY2tlZEFsZXJ0O1xyXG5cclxuY2xhc3MgTW9sYXJpdHlBbGVydE1hbmFnZXIgZXh0ZW5kcyBBbGVydGVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogSW5pdGlhbGl6ZSB0aGUgYWxlcnQgbWFuYWdlciwgbGlua2luZyB0byB0aGUgbmVlZGVkIG1vZGVsIFByb3BlcnRpZXMuXHJcbiAgICogQHBhcmFtIHtOb2RlfSBub2RlXHJcbiAgICogQHBhcmFtIHtNYWNyb1NvbHV0aW9ufSBzb2x1dGlvbiAtIGZyb20gTW9sYXJpdHlNb2RlbC5cclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5Ljxib29sZWFuPn0gdXNlUXVhbnRpdGF0aXZlRGVzY3JpcHRpb25zUHJvcGVydHkgLSB3aGV0aGVyIG9yIG5vdCB0byB1c2UgcXVhbGl0YXRpdmUgb3JcclxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWFudGl0YXRpdmUgZGVzY3JpcHRpb25zLlxyXG4gICAqIEBwYXJhbSB7Q29uY2VudHJhdGlvbkRlc2NyaWJlcn0gY29uY2VudHJhdGlvbkRlc2NyaWJlclxyXG4gICAqIEBwYXJhbSB7UHJlY2lwaXRhdGVBbW91bnREZXNjcmliZXJ9IHByZWNpcGl0YXRlQW1vdW50RGVzY3JpYmVyXHJcbiAgICogQHBhcmFtIHtTb2x1dGVBbW91bnREZXNjcmliZXJ9IHNvbHV0ZUFtb3VudERlc2NyaWJlclxyXG4gICAqIEBwYXJhbSB7Vm9sdW1lRGVzY3JpYmVyfSB2b2x1bWVEZXNjcmliZXJcclxuICAgKiBAcGFyYW0ge1NvbHV0ZURlc2NyaWJlcn0gc29sdXRlRGVzY3JpYmVyXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IHZhbHVlc1Zpc2libGVQcm9wZXJ0eSAtIHRvZ2dsZXMgZGlzcGxheSBmb3Igd2hldGhlciB0aGUgXCJzb2x1dGlvbiB2YWx1ZXNcIiBjaGVja2JveCBpc1xyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvciggbm9kZSwgc29sdXRpb24sIHVzZVF1YW50aXRhdGl2ZURlc2NyaXB0aW9uc1Byb3BlcnR5LCBjb25jZW50cmF0aW9uRGVzY3JpYmVyLCBwcmVjaXBpdGF0ZUFtb3VudERlc2NyaWJlcixcclxuICAgICAgICAgICAgICAgc29sdXRlQW1vdW50RGVzY3JpYmVyLCB2b2x1bWVEZXNjcmliZXIsIHNvbHV0ZURlc2NyaWJlciwgdmFsdWVzVmlzaWJsZVByb3BlcnR5ICkge1xyXG4gICAgc3VwZXIoIHtcclxuICAgICAgZGVzY3JpcHRpb25BbGVydE5vZGU6IG5vZGVcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSAtIHV0dGVyYW5jZXMgd2l0aCBzcGVjaWZpYyBqb2JzIHNvIHRoYXQgZHVwbGljYXRlcyBhcmUgb3ZlcndyaXR0ZW4gaW4gdGhlIHF1ZXVlLlxyXG4gICAgdGhpcy5zYXR1cmF0aW9uVXR0ZXJhbmNlID0gbmV3IFV0dGVyYW5jZSgpO1xyXG4gICAgdGhpcy5zbGlkZXJVdHRlcmFuY2UgPSBuZXcgVmFsdWVDaGFuZ2VVdHRlcmFuY2UoKTtcclxuICAgIHRoaXMuc29sdXRlVXR0ZXJhbmNlID0gbmV3IEFjdGl2YXRpb25VdHRlcmFuY2UoKTtcclxuICAgIHRoaXMudmFsdWVzVmlzaWJsZVV0dGVyYW5jZSA9IG5ldyBBY3RpdmF0aW9uVXR0ZXJhbmNlKCk7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMuY29uY2VudHJhdGlvbkRlc2NyaWJlciA9IGNvbmNlbnRyYXRpb25EZXNjcmliZXI7XHJcbiAgICB0aGlzLnByZWNpcGl0YXRlQW1vdW50RGVzY3JpYmVyID0gcHJlY2lwaXRhdGVBbW91bnREZXNjcmliZXI7XHJcbiAgICB0aGlzLnNvbHV0ZURlc2NyaWJlciA9IHNvbHV0ZURlc2NyaWJlcjtcclxuICAgIHRoaXMuc29sdXRpb24gPSBzb2x1dGlvbjtcclxuICAgIHRoaXMudXNlUXVhbnRpdGF0aXZlRGVzY3JpcHRpb25zUHJvcGVydHkgPSB1c2VRdWFudGl0YXRpdmVEZXNjcmlwdGlvbnNQcm9wZXJ0eTtcclxuXHJcbiAgICAvLyBBbiBhbGVydCBpcyByZWFkIG91dCB3aGVuIHRoZSBzb2x1dGUgaXMgY2hhbmdlZC5cclxuICAgIHNvbHV0aW9uLnNvbHV0ZVByb3BlcnR5LmxhenlMaW5rKCAoKSA9PiB0aGlzLmFsZXJ0U29sdXRlQ2hhbmdlZCgpICk7XHJcblxyXG4gICAgLy8gQW4gYWxlcnQgaXMgcmVhZCBvdXQgd2hlbiB0aGUgdmFsdWVzVmlzaWJsZVByb3BlcnR5IGNoYW5nZXMuXHJcbiAgICB2YWx1ZXNWaXNpYmxlUHJvcGVydHkubGF6eUxpbmsoIG5ld1ZhbHVlID0+IHRoaXMuYWxlcnRWYWx1ZXNWaXNpYmxlQ2hhbmdlZCggbmV3VmFsdWUgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWxlcnQgd2hlbiBhIHVzZXIgZHJpdmVuIChsaWtlbHkgZnJvbSBhIHNsaWRlcikgc29sdXRpb24gdmFsdWUgd2FzIGNoYW5nZWQuXHJcbiAgICogQHBhcmFtIHt7Z2V0U3RyaW5nc0Zyb21TbGlkZXJDaGFuZ2U6ZnVuY3Rpb24oKTpTdHJpbmdzRnJvbVNsaWRlckNoYW5nZSwgZ2V0UmVnaW9uQ2hhbmdlZDpmdW5jdGlvbigpOmJvb2xlYW59fSBkZXNjcmliZXJcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGFsZXJ0U29sdXRpb25RdWFudGl0eUNoYW5nZWQoIGRlc2NyaWJlciApIHtcclxuXHJcbiAgICAvLyBBIHNwZWNpYWwgYWxlcnQgaXMgcmVhZCBvdXQgaWYgdGhlIHNvbHV0aW9uIGlzIGF0IG1heCBjb25jZW50cmF0aW9uIHdpdGhvdXQgYW55IHByZWNpcGl0YXRlLlxyXG4gICAgaWYgKCAhdGhpcy5zb2x1dGlvbi5pc1NhdHVyYXRlZCgpICYmIHRoaXMuc29sdXRpb24uYXRNYXhDb25jZW50cmF0aW9uKCkgKSB7XHJcbiAgICAgIHRoaXMuYWxlcnRNYXhDb25jZW50cmF0aW9uTm90U2F0dXJhdGVkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYWxlcnQgd2hlbiB0aGUgc29sdXRpb24gaGFzIGp1c3QgYmVjb21lIHNhdHVyYXRlZCwgb3IgaGFzIGp1c3QgYmVjb21lIHVuc2F0dXJhdGVkLlxyXG4gICAgZWxzZSBpZiAoIHRoaXMuY29uY2VudHJhdGlvbkRlc2NyaWJlci5zYXR1cmF0aW9uVmFsdWVDaGFuZ2VkICkge1xyXG4gICAgICB0aGlzLmFsZXJ0TmV3bHlTYXR1cmF0ZWQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBhbGVydCB3aGVuIHRoZXJlIGlzIG5vIHNvbHV0ZSBpbiB0aGUgc29sdXRpb24gKHNvIHRoZSBzb2x1dGlvbiBpcyBqdXN0IHdhdGVyKVxyXG4gICAgZWxzZSBpZiAoICF0aGlzLnNvbHV0aW9uLmhhc1NvbHV0ZSgpICkge1xyXG4gICAgICB0aGlzLmFsZXJ0Tm9Tb2x1dGUoIHRoaXMudXNlUXVhbnRpdGF0aXZlRGVzY3JpcHRpb25zUHJvcGVydHkgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBxdWFudGl0YXRpdmUgYWxlcnRzICh3aGVuIHRoZSAnc29sdXRpb24gdmFsdWVzJyBjaGVja2JveCBpcyBjaGVja2VkKVxyXG4gICAgZWxzZSBpZiAoIHRoaXMudXNlUXVhbnRpdGF0aXZlRGVzY3JpcHRpb25zUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgIHRoaXMuYWxlcnRTbGlkZXJRdWFudGl0YXRpdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBxdWFsaXRhdGl2ZSBhbGVydHMgKHdoZW4gdGhlICdzb2x1dGlvbiB2YWx1ZXMnIGNoZWNrYm94IGlzIHVuY2hlY2tlZClcclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLmFsZXJ0U2xpZGVyUXVhbGl0YXRpdmUoIGRlc2NyaWJlci5nZXRTdHJpbmdzRnJvbVNsaWRlckNoYW5nZSgpLCBkZXNjcmliZXIuZ2V0UmVnaW9uQ2hhbmdlZCgpICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBbGVydCB3aGVuIHRoZSBzb2x1dGlvbiBpcyBleGFjdGx5IGF0IHRoZSBtYXggY29uY2VudHJhdGlvbiBwb2ludCB3aXRob3V0IGFueSBwcmVjaXBpdGF0ZVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgYWxlcnRNYXhDb25jZW50cmF0aW9uTm90U2F0dXJhdGVkKCkge1xyXG4gICAgdGhpcy5zbGlkZXJVdHRlcmFuY2UuYWxlcnQgPSBTdHJpbmdVdGlscy5maWxsSW4oIGF0TWF4Q29uY2VudHJhdGlvbkFsZXJ0UGF0dGVyblN0cmluZywge1xyXG4gICAgICBjb25jZW50cmF0aW9uOiB0aGlzLmNvbmNlbnRyYXRpb25EZXNjcmliZXIuZ2V0Q3VycmVudENvbmNlbnRyYXRpb25DbGF1c2UoIHRydWUgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hbGVydERlc2NyaXB0aW9uVXR0ZXJhbmNlKCB0aGlzLnNsaWRlclV0dGVyYW5jZSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWxlcnQgd2hlbiB0aGUgc29sdXRpb24gaXMgZWl0aGVyIG5ld2x5IHNhdHVyYXRlZCBvciBuZXdseSB1bnNhdHVyYXRlZC5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGFsZXJ0TmV3bHlTYXR1cmF0ZWQoKSB7XHJcbiAgICB0aGlzLmZvckVhY2hVdHRlcmFuY2VRdWV1ZSggdXR0ZXJhbmNlUXVldWUgPT4ge1xyXG5cclxuICAgICAgLy8gc2xpZGVyVXR0ZXJhbmNlIG11c3QgYmUgcmVtb3ZlZCBmcm9tIHRoZSBxdWV1ZSBiZWNhdXNlIGl0IGlzIG90aGVyd2lzZSBwb3NzaWJsZSB0byBnZXQgc3RhbGUgc2xpZGVyIGFsZXJ0cyB0aGF0IG5vXHJcbiAgICAgIC8vIGxvbmdlciBtYWtlIHNlbnNlIHdpdGggdGhlIGN1cnJlbnQgc2F0dXJhdGlvbiBzdGF0ZS5cclxuICAgICAgaWYgKCB1dHRlcmFuY2VRdWV1ZS5oYXNVdHRlcmFuY2UoIHRoaXMuc2xpZGVyVXR0ZXJhbmNlICkgKSB7XHJcbiAgICAgICAgdXR0ZXJhbmNlUXVldWUucmVtb3ZlVXR0ZXJhbmNlKCB0aGlzLnNsaWRlclV0dGVyYW5jZSApO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuc2F0dXJhdGlvblV0dGVyYW5jZS5hbGVydCA9IHRoaXMucHJlY2lwaXRhdGVBbW91bnREZXNjcmliZXIuZ2V0U2F0dXJhdGlvbkNoYW5nZWRTdHJpbmcoKTtcclxuICAgICAgdXR0ZXJhbmNlUXVldWUuYWRkVG9Gcm9udCggdGhpcy5zYXR1cmF0aW9uVXR0ZXJhbmNlICk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBbGVydHMgd2hlbiB0aGVyZSBpcyBubyBzb2x1dGUgaW4gdGhlIGJlYWtlci5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGFsZXJ0Tm9Tb2x1dGUoKSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhdGhpcy5zb2x1dGlvbi5oYXNTb2x1dGUoKSwgJ25vIHNvbHV0ZSBhbGVydCB0cmlnZ2VyZWQgd2l0aCBzb2x1dGUgaW4gdGhlIGJlYWtlcicgKTtcclxuICAgIHRoaXMuc2xpZGVyVXR0ZXJhbmNlLmFsZXJ0ID0gbm9Tb2x1dGVBbGVydFN0cmluZztcclxuICAgIHRoaXMuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggdGhpcy5zbGlkZXJVdHRlcmFuY2UgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFsZXJ0cyB3aGVuIHRoZXJlIGlzIGEgY2hhbmdlIGluIHNvbHV0ZS5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGFsZXJ0U29sdXRlQ2hhbmdlZCgpIHtcclxuICAgIHRoaXMuc29sdXRlVXR0ZXJhbmNlLmFsZXJ0ID0gdGhpcy5zb2x1dGVEZXNjcmliZXIuZ2V0U29sdXRlQ2hhbmdlZEFsZXJ0U3RyaW5nKCB0aGlzLnVzZVF1YW50aXRhdGl2ZURlc2NyaXB0aW9uc1Byb3BlcnR5ICk7XHJcbiAgICB0aGlzLmFsZXJ0RGVzY3JpcHRpb25VdHRlcmFuY2UoIHRoaXMuc29sdXRlVXR0ZXJhbmNlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBbGVydHMgd2hlbiB0aGVyZSBpcyBhIGNoYW5nZSBpbiB0aGUgdmFsdWVzVmlzaWJsZVByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IHZhbHVlc1Zpc2libGVQcm9wZXJ0eVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgYWxlcnRWYWx1ZXNWaXNpYmxlQ2hhbmdlZCggdmFsdWVzVmlzaWJsZVByb3BlcnR5ICkge1xyXG4gICAgdGhpcy52YWx1ZXNWaXNpYmxlVXR0ZXJhbmNlLmFsZXJ0ID0gdmFsdWVzVmlzaWJsZVByb3BlcnR5ID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvbHV0aW9uVmFsdWVzQ2hlY2tlZEFsZXJ0U3RyaW5nIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvbHV0aW9uVmFsdWVzVW5jaGVja2VkQWxlcnRTdHJpbmc7XHJcbiAgICB0aGlzLmFsZXJ0RGVzY3JpcHRpb25VdHRlcmFuY2UoIHRoaXMudmFsdWVzVmlzaWJsZVV0dGVyYW5jZSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogV2hlbiBxdWFsaXRhdGl2ZSBkZXNjcmlwdGlvbnMgYXJlIGJlaW5nIHVzZWQgYW5kIFNvbHV0ZUFtb3VudFByb3BlcnR5IG9yIFZvbHVtZVByb3BlcnR5IGNoYW5nZXMsIGNyZWF0ZXMgYW4gYWxlcnQuXHJcbiAgICogQHBhcmFtIHtTdHJpbmdzRnJvbVNsaWRlckNoYW5nZX0gY2hhbmdlU3RyaW5ncyAtIGNvbnRhaW5zIG11bHRpcGxlIHN0cmluZ3MuXHJcbiAgICogQHBhcmFtIHtib29sZWFufSBxdWFudGl0eVJlZ2lvbkNoYW5nZWQgLSBpbmRpY2F0ZXMgd2hldGhlciB0aGUgY2hhbmdlZCBQcm9wZXJ0eSAoU29sdXRlQW1vdW50IG9yIFZvbHVtZSkgaGFzIGNoYW5nZWRcclxuICAgKiBkZXNjcmlwdGlvbiByZWdpb25zLlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgYWxlcnRTbGlkZXJRdWFsaXRhdGl2ZSggY2hhbmdlU3RyaW5ncywgcXVhbnRpdHlSZWdpb25DaGFuZ2VkICkge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggIXRoaXMudXNlUXVhbnRpdGF0aXZlRGVzY3JpcHRpb25zUHJvcGVydHkudmFsdWUsICdxdWFudGl0YXRpdmUgZGVzY3JpcHRpb25zIHNob3VsZCBiZSB1c2VkLicgKTtcclxuICAgIGxldCBhbGVydFRleHQgPSAnJztcclxuXHJcbiAgICAvLyBhbGVydCB0ZXh0IGlzIGRpZmZlcmVudCBiYXNlZCBvbiB3aGV0aGVyIG9yIG5vdCB0aGUgc29sdXRpb24gaXMgc2F0dXJhdGVkLlxyXG4gICAgaWYgKCB0aGlzLnNvbHV0aW9uLmlzU2F0dXJhdGVkKCkgKSB7XHJcbiAgICAgIGFsZXJ0VGV4dCA9IFN0cmluZ1V0aWxzLmZpbGxJbiggcXVhbGl0YXRpdmVTYXR1cmF0ZWRWYWx1ZVRleHRQYXR0ZXJuU3RyaW5nLCB7XHJcbiAgICAgICAgcHJvcGVydHlBbW91bnRDaGFuZ2U6IGNoYW5nZVN0cmluZ3MucXVhbnRpdHlDaGFuZ2VTdHJpbmcsXHJcbiAgICAgICAgc29saWRzQ2hhbmdlOiB0aGlzLnByZWNpcGl0YXRlQW1vdW50RGVzY3JpYmVyLmdldFByZWNpcGl0YXRlQW1vdW50Q2hhbmdlU3RyaW5nKCksXHJcbiAgICAgICAgc3RpbGxTYXR1cmF0ZWRDbGF1c2U6IHRoaXMucHJlY2lwaXRhdGVBbW91bnREZXNjcmliZXIuZ2V0U3RpbGxTYXR1cmF0ZWRDbGF1c2UoKVxyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuXHJcbiAgICAgIC8vIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzdGF0ZSBvZiBzb2x1dGlvbiAocGFydGljdWxhcmx5IGl0cyBjb25jZW50cmF0aW9uIGlzIGFwcGVuZGVkIHRvIHRoZSBhbGVydCBpZiB0aGUgZGVzY3JpcHRpdmVcclxuICAgICAgLy8gcmVnaW9uIGhhcyBjaGFuZ2VkIGZvciBhbnkgcmVsZXZhbnQgcXVhbnRpdHkuXHJcbiAgICAgIGNvbnN0IGluY2x1ZGVTdGF0ZUluZm8gPSBxdWFudGl0eVJlZ2lvbkNoYW5nZWQgfHwgdGhpcy5jb25jZW50cmF0aW9uRGVzY3JpYmVyLmNvbmNlbnRyYXRpb25SZWdpb25DaGFuZ2VkO1xyXG4gICAgICBhbGVydFRleHQgPSBTdHJpbmdVdGlscy5maWxsSW4oIHF1YWxpdGF0aXZlU2xpZGVyQWxlcnRQYXR0ZXJuU3RyaW5nLCB7XHJcbiAgICAgICAgcXVhbnRpdHlDaGFuZ2U6IGNoYW5nZVN0cmluZ3MucXVhbnRpdHlDaGFuZ2VTdHJpbmcsXHJcbiAgICAgICAgY29sb3JDaGFuZ2U6IGNoYW5nZVN0cmluZ3MuY29sb3JDaGFuZ2VTdHJpbmcsXHJcbiAgICAgICAgc3RhdGVJbmZvOiBpbmNsdWRlU3RhdGVJbmZvID8gdGhpcy5jb25jZW50cmF0aW9uRGVzY3JpYmVyLmdldFF1YWxpdGF0aXZlQ29uY2VudHJhdGlvbkRlc2NyaXB0aW9uKCkgOiAnJ1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zbGlkZXJVdHRlcmFuY2UuYWxlcnQgPSBhbGVydFRleHQ7XHJcbiAgICB0aGlzLmFsZXJ0RGVzY3JpcHRpb25VdHRlcmFuY2UoIHRoaXMuc2xpZGVyVXR0ZXJhbmNlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBXaGVuIHF1YW50aXRhdGl2ZSBkZXNjcmlwdGlvbnMgYXJlIHVzZWQsIGFuZCBTb2x1dGVBbW91bnRQcm9wZXJ0eSBvciBWb2x1bWVQcm9wZXJ0eSBjaGFuZ2VzLCBjcmVhdGVzIGFuIGFsZXJ0LlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgYWxlcnRTbGlkZXJRdWFudGl0YXRpdmUoKSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLnVzZVF1YW50aXRhdGl2ZURlc2NyaXB0aW9uc1Byb3BlcnR5LnZhbHVlLCAncXVhbGl0YXRpdmUgZGVzY3JpcHRpb25zIHNob3VsZCBiZSB1c2VkLicgKTtcclxuICAgIGxldCBhbGVydFRleHQgPSAnJztcclxuICAgIGlmICggdGhpcy5zb2x1dGlvbi5pc1NhdHVyYXRlZCgpICkge1xyXG4gICAgICBhbGVydFRleHQgPSBTdHJpbmdVdGlscy5maWxsSW4oIHF1YW50aXRhdGl2ZVNhdHVyYXRlZFZhbHVlVGV4dFBhdHRlcm5TdHJpbmcsIHtcclxuICAgICAgICBzb2xpZHNDaGFuZ2U6IHRoaXMucHJlY2lwaXRhdGVBbW91bnREZXNjcmliZXIuZ2V0UHJlY2lwaXRhdGVBbW91bnRDaGFuZ2VTdHJpbmcoIHRydWUgKSxcclxuICAgICAgICBzdGlsbFNhdHVyYXRlZENsYXVzZTogdGhpcy5wcmVjaXBpdGF0ZUFtb3VudERlc2NyaWJlci5nZXRTdGlsbFNhdHVyYXRlZENsYXVzZSgpXHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBhbGVydFRleHQgPSBTdHJpbmdVdGlscy5maWxsSW4oIHF1YW50aXRhdGl2ZVNsaWRlckFsZXJ0UGF0dGVyblN0cmluZywge1xyXG4gICAgICAgIGNvbmNlbnRyYXRpb25DaGFuZ2U6IHRoaXMuY29uY2VudHJhdGlvbkRlc2NyaWJlci5nZXRDb25jZW50cmF0aW9uQ2hhbmdlU3RyaW5nKCksXHJcbiAgICAgICAgY29uY2VudHJhdGlvbjogdGhpcy5jb25jZW50cmF0aW9uRGVzY3JpYmVyLmdldEN1cnJlbnRDb25jZW50cmF0aW9uQ2xhdXNlKCksXHJcbiAgICAgICAgY29sb3JDaGFuZ2U6IHRoaXMuY29uY2VudHJhdGlvbkRlc2NyaWJlci5nZXRDb2xvckNoYW5nZVN0cmluZygpXHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNsaWRlclV0dGVyYW5jZS5hbGVydCA9IGFsZXJ0VGV4dDtcclxuICAgIHRoaXMuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggdGhpcy5zbGlkZXJVdHRlcmFuY2UgKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUaGlzIGNvbnRhaW5zIHR3byBzdHJpbmdzOyB0aGVzZSBzdHJpbmdzIGNhbiBiZSB1c2VkIGFzIGNvbXBvbmVudCBwaWVjZXMgb2YgbG9uZ2VyIGFsZXJ0IHN0cmluZ3MuXHJcbiAqIEB0eXBlZGVmIFN0cmluZ3NGcm9tU2xpZGVyQ2hhbmdlXHJcbiAqIEB0eXBlIHtPYmplY3R9XHJcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjb2xvckNoYW5nZVN0cmluZyAtIGRlc2NyaWJpbmcgdGhlIGNvbG9yIGNoYW5nZSBvZiB0aGUgc29sdXRlXHJcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBxdWFudGl0eUNoYW5nZVN0cmluZyAtIGRlc2NyaWJpbmcgdGhlIHNsaWRlciBxdWFudGl0eSB0aGF0IGNoYW5nZWRcclxuICovXHJcblxyXG5tb2xhcml0eS5yZWdpc3RlciggJ01vbGFyaXR5QWxlcnRNYW5hZ2VyJywgTW9sYXJpdHlBbGVydE1hbmFnZXIgKTtcclxuZXhwb3J0IGRlZmF1bHQgTW9sYXJpdHlBbGVydE1hbmFnZXI7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxXQUFXLE1BQU0sK0NBQStDO0FBQ3ZFLE9BQU9DLE9BQU8sTUFBTSxpRUFBaUU7QUFDckYsT0FBT0MsbUJBQW1CLE1BQU0sdURBQXVE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