// Copyright 2019-2022, University of Colorado Boulder

/**
 * ConcentrationDescriber is responsible for formulating  strings about Solution.concentrationProperty. This includes
 * descriptions set in the PDOM, as well as context responses set through UtteranceQueue.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 * @author Taylor Want (PhET Interactive Simulations)
 */

import Utils from '../../../../../dot/js/Utils.js';
import StringUtils from '../../../../../phetcommon/js/util/StringUtils.js';
import molarity from '../../../molarity.js';
import MolarityStrings from '../../../MolarityStrings.js';
import MolarityConstants from '../../MolarityConstants.js';
const quantityChangeColorChangePatternString = MolarityStrings.a11y.quantityChange.colorChangePattern;
const quantitativeConcentrationAndUnitString = MolarityStrings.a11y.quantitative.concentrationAndUnit;
const quantityChangeConcentrationChangePatternString = MolarityStrings.a11y.quantityChange.concentrationChangePattern;
const beakerConcentrationRangePatternString = MolarityStrings.a11y.beaker.concentrationRangePattern;
const qualitativeConcentrationStateClausePatternString = MolarityStrings.a11y.qualitative.concentrationStateClausePattern;
const quantitativeConcentrationStatePatternString = MolarityStrings.a11y.quantitative.concentrationStatePattern;

// Concentration region strings
const concentrationRegionsPassiveZeroConcentrationString = MolarityStrings.a11y.concentrationRegions.passive.zeroConcentration;
const concentrationRegionsPassiveLowConcentrationString = MolarityStrings.a11y.concentrationRegions.passive.lowConcentration;
const concentrationRegionsPassiveSlightlyConcentratedString = MolarityStrings.a11y.concentrationRegions.passive.slightlyConcentrated;
const concentrationRegionsPassiveNotVeryConcentratedString = MolarityStrings.a11y.concentrationRegions.passive.notVeryConcentrated;
const concentrationRegionsPassiveVeryConcentratedString = MolarityStrings.a11y.concentrationRegions.passive.veryConcentrated;
const concentrationRegionsPassiveHighlyConcentratedString = MolarityStrings.a11y.concentrationRegions.passive.highlyConcentrated;
const concentrationRegionsPassiveMaxConcentrationString = MolarityStrings.a11y.concentrationRegions.passive.maxConcentration;

// Concentration active region strings
const concentrationRegionsActiveHasZeroConcentrationString = MolarityStrings.a11y.concentrationRegions.active.hasZeroConcentration;
const concentrationRegionsActiveHasLowConcentrationString = MolarityStrings.a11y.concentrationRegions.active.hasLowConcentration;
const concentrationRegionsActiveIsSlightlyConcentratedString = MolarityStrings.a11y.concentrationRegions.active.isSlightlyConcentrated;
const concentrationRegionsActiveIsNotVeryConcentratedString = MolarityStrings.a11y.concentrationRegions.active.isNotVeryConcentrated;
const concentrationRegionsActiveIsVeryConcentratedString = MolarityStrings.a11y.concentrationRegions.active.isVeryConcentrated;
const concentrationRegionsActiveIsHighlyConcentratedString = MolarityStrings.a11y.concentrationRegions.active.isHighlyConcentrated;
const concentrationRegionsActiveHasMaxConcentrationString = MolarityStrings.a11y.concentrationRegions.active.hasMaxConcentration;

// Change strings
const lessCapitalizedString = MolarityStrings.a11y.less.capitalized;
const lessLowercaseString = MolarityStrings.a11y.less.lowercase;
const moreCapitalizedString = MolarityStrings.a11y.more.capitalized;
const moreLowercaseString = MolarityStrings.a11y.more.lowercase;
const quantityChangeLighterString = MolarityStrings.a11y.quantityChange.lighter;
const quantityChangeDarkerString = MolarityStrings.a11y.quantityChange.darker;

// constants
const ACTIVE_CONCENTRATION_STRINGS = [concentrationRegionsActiveHasZeroConcentrationString, concentrationRegionsActiveHasLowConcentrationString, concentrationRegionsActiveIsSlightlyConcentratedString, concentrationRegionsActiveIsNotVeryConcentratedString, concentrationRegionsActiveIsVeryConcentratedString, concentrationRegionsActiveIsHighlyConcentratedString, concentrationRegionsActiveHasMaxConcentrationString];
const CONCENTRATION_STRINGS = [concentrationRegionsPassiveZeroConcentrationString, concentrationRegionsPassiveLowConcentrationString, concentrationRegionsPassiveSlightlyConcentratedString, concentrationRegionsPassiveNotVeryConcentratedString, concentrationRegionsPassiveVeryConcentratedString, concentrationRegionsPassiveHighlyConcentratedString, concentrationRegionsPassiveMaxConcentrationString];
class ConcentrationDescriber {
  /**
   * @param {MacroSolution} solution - from MolarityModel
   * @param {Property.<boolean>} useQuantitativeDescriptionsProperty
   */
  constructor(solution, useQuantitativeDescriptionsProperty) {
    // @private
    this.solution = solution;
    this.soluteProperty = solution.soluteProperty;
    this.concentrationProperty = solution.concentrationProperty;
    const precipitateAmountProperty = solution.precipitateAmountProperty;
    this.useQuantitativeDescriptionsProperty = useQuantitativeDescriptionsProperty;

    // @public {boolean|null} - tracks whether the solution has most recently gone from saturated to unsaturated or
    // vice-versa.
    this.saturationValueChanged = null;

    // @private {boolean} - tracks the most recent saturation state of the solution
    let lastSaturationValue = false;

    // @private {boolean|null} - should only be updated and accessed when the concentrationProperty changes, so
    // while it will be null on initialization, it will only be accessed when it holds boolean values (True if concentrationProperty
    // has increased, False if it has decreased)
    this.concentrationIncreased = null;

    // @public (read-only) {boolean|null} - tracks whether the descriptive regions for concentrationProperty has changed
    // (since region changes trigger the different descriptive text in the aria-live alerts).
    this.concentrationRegionChanged = null;

    // @private {Number} - tracks the last calculated concentration region index.
    let lastConcentrationIndex = this.getCurrentConcentrationIndex();

    // update fields (documented above) when concentrationProperty changes
    this.concentrationProperty.lazyLink((newValue, oldValue) => {
      const newConcentrationIndex = concentrationToIndex(this.concentrationProperty.value, this.soluteProperty.value.saturatedConcentration);
      const newSaturationValue = this.solution.isSaturated();

      // newValue will never be equal to oldValue, since this is updated within a Property link.
      this.concentrationIncreased = newValue > oldValue;
      this.concentrationRegionChanged = newConcentrationIndex !== lastConcentrationIndex;
      lastConcentrationIndex = newConcentrationIndex;
      this.saturationValueChanged = newSaturationValue !== lastSaturationValue;
      lastSaturationValue = newSaturationValue;
    });

    // update saturationValueChanged field when precipitateAmountProperty changes. This is necessary because
    // concentrationProperty stops changing once the solution is saturated, which makes the detection of a change in
    // saturation not possible without also listening to changes in precipitateAmountProperty.
    precipitateAmountProperty.lazyLink(() => {
      const newSaturationValue = this.solution.isSaturated();
      this.saturationValueChanged = newSaturationValue !== lastSaturationValue;
      lastSaturationValue = newSaturationValue;
    });
  }

  /**
   * Calculates the index of the current concentration region using the saturated concentration of the solute and
   * the current concentration
   * @public
   * @returns {Number} - index of the current concentration region
   * */
  getCurrentConcentrationIndex() {
    return concentrationToIndex(this.concentrationProperty.value, this.soluteProperty.value.saturatedConcentration);
  }

  /**
   * Gets the current value of concentration either quantitatively or quantitatively to plug into descriptions.
   * Qualitative description can be in active or passive voice depending on isPassive parameter.
   * @param {boolean} [isPassive] - ignored if using quantitative descriptions
   * @public
   * @returns {string} - description of current concentration (e.g. "1.500 Molar" or "is very concentrated")
   */
  getCurrentConcentrationClause(isPassive = false) {
    const concentration = this.concentrationProperty.value;
    if (this.useQuantitativeDescriptionsProperty.value) {
      return StringUtils.fillIn(quantitativeConcentrationAndUnitString, {
        concentration: Utils.toFixed(concentration, MolarityConstants.CONCENTRATION_DECIMAL_PLACES)
      });
    } else {
      const index = concentrationToIndex(this.concentrationProperty.value, this.soluteProperty.value.saturatedConcentration);
      return isPassive ? CONCENTRATION_STRINGS[index] : ACTIVE_CONCENTRATION_STRINGS[index];
    }
  }

  /**
   * Creates a string describing the concentration range of the current solute.
   * @public
   * @returns {string} - description of concentration range (e.g. "concentration readout range 0 to 0.5 molar")
   */
  getCurrentConcentrationRangeClause() {
    const concentrationMin = MolarityConstants.CONCENTRATION_RANGE.min;
    const concentrationMax = MolarityConstants.CONCENTRATION_RANGE.max;
    const clampedConcentration = Utils.clamp(this.getCurrentSaturatedConcentration(), concentrationMin, concentrationMax);

    // The described max concentration in this clause is the maximum of the displayed concentration range for solutes
    // with a max concentration larger than the displayed concentration range max, and is the solute's actual max
    // concentration if it is less than the displayed concentration range max.
    const displayedMaxConcentration = Utils.toFixed(clampedConcentration, MolarityConstants.SOLUTE_AMOUNT_DECIMAL_PLACES);
    return StringUtils.fillIn(beakerConcentrationRangePatternString, {
      maxConcentration: Utils.toFixed(displayedMaxConcentration, MolarityConstants.CONCENTRATION_DECIMAL_PLACES)
    });
  }

  /**
   * Gets the saturated concentration level of the currently selected solute.
   * @public
   * @returns {number}
   */
  getCurrentSaturatedConcentration() {
    return this.soluteProperty.value.saturatedConcentration;
  }

  /**
   * Creates a string that describes the concentration of in the beaker
   * {Property.<boolean>} useQuantitativeDescriptionsProperty
   * @public
   * @returns {string} - e.g. "concentration 1.400 molar" or "is very concentrated"
   */
  getBeakerConcentrationString(useQuantitativeDescriptionsProperty) {
    const quantitativeString = StringUtils.fillIn(quantitativeConcentrationStatePatternString, {
      concentration: this.getCurrentConcentrationClause()
    });
    return useQuantitativeDescriptionsProperty.value ? quantitativeString : this.getCurrentConcentrationClause();
  }

  /**
   * Creates a substring to describe how concentration has changed
   * @param [isCapitalized] {boolean}
   * @public
   * @returns {string} - example: "more concentrated"
   */
  getConcentrationChangeString(isCapitalized = true) {
    assert && assert(!this.solution.isSaturated(), 'concentration cannot change when saturated');
    let moreLessString = isCapitalized ? lessCapitalizedString : lessLowercaseString;
    if (this.concentrationIncreased) {
      moreLessString = isCapitalized ? moreCapitalizedString : moreLowercaseString;
    }
    return StringUtils.fillIn(quantityChangeConcentrationChangePatternString, {
      moreLess: moreLessString
    });
  }

  /**
   * Creates a substring to describe how the color of the solution has changed
   * @public
   * @returns {string} - example: "Solution lighter"
   */
  getColorChangeString() {
    assert && assert(!this.solution.isSaturated(), 'color cannot change when saturated');
    return StringUtils.fillIn(quantityChangeColorChangePatternString, {
      lighterDarker: this.concentrationIncreased ? quantityChangeDarkerString : quantityChangeLighterString
    });
  }

  /**
   * Creates the qualitative substrings to describe the concentration "state" of the solution.
   * @public
   * @returns {string} - example: "Solution very concentrated".
   * */
  getQualitativeConcentrationDescription() {
    assert && assert(!this.useQuantitativeDescriptionsProperty.value, 'qualitative descriptions expected');
    return StringUtils.fillIn(qualitativeConcentrationStateClausePatternString, {
      concentration: this.getCurrentConcentrationClause(true)
    });
  }
}

/**
 * Calculates the which item to use from the CONCENTRATION_STRINGS array.
 * @param {number} currentConcentration
 * @param {number} saturatedConcentrationForSolute - the saturation point for a specific solute.
 * @returns {number} index to access a region from CONCENTRATION_STRINGS
 */
const concentrationToIndex = (currentConcentration, saturatedConcentrationForSolute) => {
  assert && assert(currentConcentration <= saturatedConcentrationForSolute, 'concentration cannot be higher than saturatedConcentration');

  // compare against un-rounded concentration since these two are single value regions
  // Handle single value region cases before iterating through evenly spaced regions.
  if (currentConcentration === saturatedConcentrationForSolute) {
    return CONCENTRATION_STRINGS.length - 1;
  } else if (currentConcentration === MolarityConstants.CONCENTRATION_RANGE.min) {
    return 0;
  } else {
    // Concentration regions are evenly spaced within the region from 0 to max concentration for a given solute except
    // for the lowest region (zero) and the highest region (max concentration) which are single value regions.
    const scaleIncrement = saturatedConcentrationForSolute / (CONCENTRATION_STRINGS.length - 2);
    const concentrationRounded = Utils.toFixedNumber(currentConcentration, MolarityConstants.CONCENTRATION_DECIMAL_PLACES);

    // don't count the first and last concentration string
    for (let i = 1; i < CONCENTRATION_STRINGS.length - 2; i++) {
      if (concentrationRounded <= (i + 1) * scaleIncrement) {
        return i;
      }
    }
  }
  assert && assert(false, 'unexpected concentration');
  return -1;
};
molarity.register('ConcentrationDescriber', ConcentrationDescriber);
export default ConcentrationDescriber;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlN0cmluZ1V0aWxzIiwibW9sYXJpdHkiLCJNb2xhcml0eVN0cmluZ3MiLCJNb2xhcml0eUNvbnN0YW50cyIsInF1YW50aXR5Q2hhbmdlQ29sb3JDaGFuZ2VQYXR0ZXJuU3RyaW5nIiwiYTExeSIsInF1YW50aXR5Q2hhbmdlIiwiY29sb3JDaGFuZ2VQYXR0ZXJuIiwicXVhbnRpdGF0aXZlQ29uY2VudHJhdGlvbkFuZFVuaXRTdHJpbmciLCJxdWFudGl0YXRpdmUiLCJjb25jZW50cmF0aW9uQW5kVW5pdCIsInF1YW50aXR5Q2hhbmdlQ29uY2VudHJhdGlvbkNoYW5nZVBhdHRlcm5TdHJpbmciLCJjb25jZW50cmF0aW9uQ2hhbmdlUGF0dGVybiIsImJlYWtlckNvbmNlbnRyYXRpb25SYW5nZVBhdHRlcm5TdHJpbmciLCJiZWFrZXIiLCJjb25jZW50cmF0aW9uUmFuZ2VQYXR0ZXJuIiwicXVhbGl0YXRpdmVDb25jZW50cmF0aW9uU3RhdGVDbGF1c2VQYXR0ZXJuU3RyaW5nIiwicXVhbGl0YXRpdmUiLCJjb25jZW50cmF0aW9uU3RhdGVDbGF1c2VQYXR0ZXJuIiwicXVhbnRpdGF0aXZlQ29uY2VudHJhdGlvblN0YXRlUGF0dGVyblN0cmluZyIsImNvbmNlbnRyYXRpb25TdGF0ZVBhdHRlcm4iLCJjb25jZW50cmF0aW9uUmVnaW9uc1Bhc3NpdmVaZXJvQ29uY2VudHJhdGlvblN0cmluZyIsImNvbmNlbnRyYXRpb25SZWdpb25zIiwicGFzc2l2ZSIsInplcm9Db25jZW50cmF0aW9uIiwiY29uY2VudHJhdGlvblJlZ2lvbnNQYXNzaXZlTG93Q29uY2VudHJhdGlvblN0cmluZyIsImxvd0NvbmNlbnRyYXRpb24iLCJjb25jZW50cmF0aW9uUmVnaW9uc1Bhc3NpdmVTbGlnaHRseUNvbmNlbnRyYXRlZFN0cmluZyIsInNsaWdodGx5Q29uY2VudHJhdGVkIiwiY29uY2VudHJhdGlvblJlZ2lvbnNQYXNzaXZlTm90VmVyeUNvbmNlbnRyYXRlZFN0cmluZyIsIm5vdFZlcnlDb25jZW50cmF0ZWQiLCJjb25jZW50cmF0aW9uUmVnaW9uc1Bhc3NpdmVWZXJ5Q29uY2VudHJhdGVkU3RyaW5nIiwidmVyeUNvbmNlbnRyYXRlZCIsImNvbmNlbnRyYXRpb25SZWdpb25zUGFzc2l2ZUhpZ2hseUNvbmNlbnRyYXRlZFN0cmluZyIsImhpZ2hseUNvbmNlbnRyYXRlZCIsImNvbmNlbnRyYXRpb25SZWdpb25zUGFzc2l2ZU1heENvbmNlbnRyYXRpb25TdHJpbmciLCJtYXhDb25jZW50cmF0aW9uIiwiY29uY2VudHJhdGlvblJlZ2lvbnNBY3RpdmVIYXNaZXJvQ29uY2VudHJhdGlvblN0cmluZyIsImFjdGl2ZSIsImhhc1plcm9Db25jZW50cmF0aW9uIiwiY29uY2VudHJhdGlvblJlZ2lvbnNBY3RpdmVIYXNMb3dDb25jZW50cmF0aW9uU3RyaW5nIiwiaGFzTG93Q29uY2VudHJhdGlvbiIsImNvbmNlbnRyYXRpb25SZWdpb25zQWN0aXZlSXNTbGlnaHRseUNvbmNlbnRyYXRlZFN0cmluZyIsImlzU2xpZ2h0bHlDb25jZW50cmF0ZWQiLCJjb25jZW50cmF0aW9uUmVnaW9uc0FjdGl2ZUlzTm90VmVyeUNvbmNlbnRyYXRlZFN0cmluZyIsImlzTm90VmVyeUNvbmNlbnRyYXRlZCIsImNvbmNlbnRyYXRpb25SZWdpb25zQWN0aXZlSXNWZXJ5Q29uY2VudHJhdGVkU3RyaW5nIiwiaXNWZXJ5Q29uY2VudHJhdGVkIiwiY29uY2VudHJhdGlvblJlZ2lvbnNBY3RpdmVJc0hpZ2hseUNvbmNlbnRyYXRlZFN0cmluZyIsImlzSGlnaGx5Q29uY2VudHJhdGVkIiwiY29uY2VudHJhdGlvblJlZ2lvbnNBY3RpdmVIYXNNYXhDb25jZW50cmF0aW9uU3RyaW5nIiwiaGFzTWF4Q29uY2VudHJhdGlvbiIsImxlc3NDYXBpdGFsaXplZFN0cmluZyIsImxlc3MiLCJjYXBpdGFsaXplZCIsImxlc3NMb3dlcmNhc2VTdHJpbmciLCJsb3dlcmNhc2UiLCJtb3JlQ2FwaXRhbGl6ZWRTdHJpbmciLCJtb3JlIiwibW9yZUxvd2VyY2FzZVN0cmluZyIsInF1YW50aXR5Q2hhbmdlTGlnaHRlclN0cmluZyIsImxpZ2h0ZXIiLCJxdWFudGl0eUNoYW5nZURhcmtlclN0cmluZyIsImRhcmtlciIsIkFDVElWRV9DT05DRU5UUkFUSU9OX1NUUklOR1MiLCJDT05DRU5UUkFUSU9OX1NUUklOR1MiLCJDb25jZW50cmF0aW9uRGVzY3JpYmVyIiwiY29uc3RydWN0b3IiLCJzb2x1dGlvbiIsInVzZVF1YW50aXRhdGl2ZURlc2NyaXB0aW9uc1Byb3BlcnR5Iiwic29sdXRlUHJvcGVydHkiLCJjb25jZW50cmF0aW9uUHJvcGVydHkiLCJwcmVjaXBpdGF0ZUFtb3VudFByb3BlcnR5Iiwic2F0dXJhdGlvblZhbHVlQ2hhbmdlZCIsImxhc3RTYXR1cmF0aW9uVmFsdWUiLCJjb25jZW50cmF0aW9uSW5jcmVhc2VkIiwiY29uY2VudHJhdGlvblJlZ2lvbkNoYW5nZWQiLCJsYXN0Q29uY2VudHJhdGlvbkluZGV4IiwiZ2V0Q3VycmVudENvbmNlbnRyYXRpb25JbmRleCIsImxhenlMaW5rIiwibmV3VmFsdWUiLCJvbGRWYWx1ZSIsIm5ld0NvbmNlbnRyYXRpb25JbmRleCIsImNvbmNlbnRyYXRpb25Ub0luZGV4IiwidmFsdWUiLCJzYXR1cmF0ZWRDb25jZW50cmF0aW9uIiwibmV3U2F0dXJhdGlvblZhbHVlIiwiaXNTYXR1cmF0ZWQiLCJnZXRDdXJyZW50Q29uY2VudHJhdGlvbkNsYXVzZSIsImlzUGFzc2l2ZSIsImNvbmNlbnRyYXRpb24iLCJmaWxsSW4iLCJ0b0ZpeGVkIiwiQ09OQ0VOVFJBVElPTl9ERUNJTUFMX1BMQUNFUyIsImluZGV4IiwiZ2V0Q3VycmVudENvbmNlbnRyYXRpb25SYW5nZUNsYXVzZSIsImNvbmNlbnRyYXRpb25NaW4iLCJDT05DRU5UUkFUSU9OX1JBTkdFIiwibWluIiwiY29uY2VudHJhdGlvbk1heCIsIm1heCIsImNsYW1wZWRDb25jZW50cmF0aW9uIiwiY2xhbXAiLCJnZXRDdXJyZW50U2F0dXJhdGVkQ29uY2VudHJhdGlvbiIsImRpc3BsYXllZE1heENvbmNlbnRyYXRpb24iLCJTT0xVVEVfQU1PVU5UX0RFQ0lNQUxfUExBQ0VTIiwiZ2V0QmVha2VyQ29uY2VudHJhdGlvblN0cmluZyIsInF1YW50aXRhdGl2ZVN0cmluZyIsImdldENvbmNlbnRyYXRpb25DaGFuZ2VTdHJpbmciLCJpc0NhcGl0YWxpemVkIiwiYXNzZXJ0IiwibW9yZUxlc3NTdHJpbmciLCJtb3JlTGVzcyIsImdldENvbG9yQ2hhbmdlU3RyaW5nIiwibGlnaHRlckRhcmtlciIsImdldFF1YWxpdGF0aXZlQ29uY2VudHJhdGlvbkRlc2NyaXB0aW9uIiwiY3VycmVudENvbmNlbnRyYXRpb24iLCJzYXR1cmF0ZWRDb25jZW50cmF0aW9uRm9yU29sdXRlIiwibGVuZ3RoIiwic2NhbGVJbmNyZW1lbnQiLCJjb25jZW50cmF0aW9uUm91bmRlZCIsInRvRml4ZWROdW1iZXIiLCJpIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJDb25jZW50cmF0aW9uRGVzY3JpYmVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIENvbmNlbnRyYXRpb25EZXNjcmliZXIgaXMgcmVzcG9uc2libGUgZm9yIGZvcm11bGF0aW5nICBzdHJpbmdzIGFib3V0IFNvbHV0aW9uLmNvbmNlbnRyYXRpb25Qcm9wZXJ0eS4gVGhpcyBpbmNsdWRlc1xyXG4gKiBkZXNjcmlwdGlvbnMgc2V0IGluIHRoZSBQRE9NLCBhcyB3ZWxsIGFzIGNvbnRleHQgcmVzcG9uc2VzIHNldCB0aHJvdWdoIFV0dGVyYW5jZVF1ZXVlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgVGF5bG9yIFdhbnQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBTdHJpbmdVdGlscyBmcm9tICcuLi8uLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3V0aWwvU3RyaW5nVXRpbHMuanMnO1xyXG5pbXBvcnQgbW9sYXJpdHkgZnJvbSAnLi4vLi4vLi4vbW9sYXJpdHkuanMnO1xyXG5pbXBvcnQgTW9sYXJpdHlTdHJpbmdzIGZyb20gJy4uLy4uLy4uL01vbGFyaXR5U3RyaW5ncy5qcyc7XHJcbmltcG9ydCBNb2xhcml0eUNvbnN0YW50cyBmcm9tICcuLi8uLi9Nb2xhcml0eUNvbnN0YW50cy5qcyc7XHJcblxyXG5jb25zdCBxdWFudGl0eUNoYW5nZUNvbG9yQ2hhbmdlUGF0dGVyblN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5LnF1YW50aXR5Q2hhbmdlLmNvbG9yQ2hhbmdlUGF0dGVybjtcclxuY29uc3QgcXVhbnRpdGF0aXZlQ29uY2VudHJhdGlvbkFuZFVuaXRTdHJpbmcgPSBNb2xhcml0eVN0cmluZ3MuYTExeS5xdWFudGl0YXRpdmUuY29uY2VudHJhdGlvbkFuZFVuaXQ7XHJcbmNvbnN0IHF1YW50aXR5Q2hhbmdlQ29uY2VudHJhdGlvbkNoYW5nZVBhdHRlcm5TdHJpbmcgPSBNb2xhcml0eVN0cmluZ3MuYTExeS5xdWFudGl0eUNoYW5nZS5jb25jZW50cmF0aW9uQ2hhbmdlUGF0dGVybjtcclxuY29uc3QgYmVha2VyQ29uY2VudHJhdGlvblJhbmdlUGF0dGVyblN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5LmJlYWtlci5jb25jZW50cmF0aW9uUmFuZ2VQYXR0ZXJuO1xyXG5jb25zdCBxdWFsaXRhdGl2ZUNvbmNlbnRyYXRpb25TdGF0ZUNsYXVzZVBhdHRlcm5TdHJpbmcgPSBNb2xhcml0eVN0cmluZ3MuYTExeS5xdWFsaXRhdGl2ZS5jb25jZW50cmF0aW9uU3RhdGVDbGF1c2VQYXR0ZXJuO1xyXG5jb25zdCBxdWFudGl0YXRpdmVDb25jZW50cmF0aW9uU3RhdGVQYXR0ZXJuU3RyaW5nID0gTW9sYXJpdHlTdHJpbmdzLmExMXkucXVhbnRpdGF0aXZlLmNvbmNlbnRyYXRpb25TdGF0ZVBhdHRlcm47XHJcblxyXG4vLyBDb25jZW50cmF0aW9uIHJlZ2lvbiBzdHJpbmdzXHJcbmNvbnN0IGNvbmNlbnRyYXRpb25SZWdpb25zUGFzc2l2ZVplcm9Db25jZW50cmF0aW9uU3RyaW5nID0gTW9sYXJpdHlTdHJpbmdzLmExMXkuY29uY2VudHJhdGlvblJlZ2lvbnMucGFzc2l2ZS56ZXJvQ29uY2VudHJhdGlvbjtcclxuY29uc3QgY29uY2VudHJhdGlvblJlZ2lvbnNQYXNzaXZlTG93Q29uY2VudHJhdGlvblN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5LmNvbmNlbnRyYXRpb25SZWdpb25zLnBhc3NpdmUubG93Q29uY2VudHJhdGlvbjtcclxuY29uc3QgY29uY2VudHJhdGlvblJlZ2lvbnNQYXNzaXZlU2xpZ2h0bHlDb25jZW50cmF0ZWRTdHJpbmcgPSBNb2xhcml0eVN0cmluZ3MuYTExeS5jb25jZW50cmF0aW9uUmVnaW9ucy5wYXNzaXZlLnNsaWdodGx5Q29uY2VudHJhdGVkO1xyXG5jb25zdCBjb25jZW50cmF0aW9uUmVnaW9uc1Bhc3NpdmVOb3RWZXJ5Q29uY2VudHJhdGVkU3RyaW5nID0gTW9sYXJpdHlTdHJpbmdzLmExMXkuY29uY2VudHJhdGlvblJlZ2lvbnMucGFzc2l2ZS5ub3RWZXJ5Q29uY2VudHJhdGVkO1xyXG5jb25zdCBjb25jZW50cmF0aW9uUmVnaW9uc1Bhc3NpdmVWZXJ5Q29uY2VudHJhdGVkU3RyaW5nID0gTW9sYXJpdHlTdHJpbmdzLmExMXkuY29uY2VudHJhdGlvblJlZ2lvbnMucGFzc2l2ZS52ZXJ5Q29uY2VudHJhdGVkO1xyXG5jb25zdCBjb25jZW50cmF0aW9uUmVnaW9uc1Bhc3NpdmVIaWdobHlDb25jZW50cmF0ZWRTdHJpbmcgPSBNb2xhcml0eVN0cmluZ3MuYTExeS5jb25jZW50cmF0aW9uUmVnaW9ucy5wYXNzaXZlLmhpZ2hseUNvbmNlbnRyYXRlZDtcclxuY29uc3QgY29uY2VudHJhdGlvblJlZ2lvbnNQYXNzaXZlTWF4Q29uY2VudHJhdGlvblN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5LmNvbmNlbnRyYXRpb25SZWdpb25zLnBhc3NpdmUubWF4Q29uY2VudHJhdGlvbjtcclxuXHJcbi8vIENvbmNlbnRyYXRpb24gYWN0aXZlIHJlZ2lvbiBzdHJpbmdzXHJcbmNvbnN0IGNvbmNlbnRyYXRpb25SZWdpb25zQWN0aXZlSGFzWmVyb0NvbmNlbnRyYXRpb25TdHJpbmcgPSBNb2xhcml0eVN0cmluZ3MuYTExeS5jb25jZW50cmF0aW9uUmVnaW9ucy5hY3RpdmUuaGFzWmVyb0NvbmNlbnRyYXRpb247XHJcbmNvbnN0IGNvbmNlbnRyYXRpb25SZWdpb25zQWN0aXZlSGFzTG93Q29uY2VudHJhdGlvblN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5LmNvbmNlbnRyYXRpb25SZWdpb25zLmFjdGl2ZS5oYXNMb3dDb25jZW50cmF0aW9uO1xyXG5jb25zdCBjb25jZW50cmF0aW9uUmVnaW9uc0FjdGl2ZUlzU2xpZ2h0bHlDb25jZW50cmF0ZWRTdHJpbmcgPSBNb2xhcml0eVN0cmluZ3MuYTExeS5jb25jZW50cmF0aW9uUmVnaW9ucy5hY3RpdmUuaXNTbGlnaHRseUNvbmNlbnRyYXRlZDtcclxuY29uc3QgY29uY2VudHJhdGlvblJlZ2lvbnNBY3RpdmVJc05vdFZlcnlDb25jZW50cmF0ZWRTdHJpbmcgPSBNb2xhcml0eVN0cmluZ3MuYTExeS5jb25jZW50cmF0aW9uUmVnaW9ucy5hY3RpdmUuaXNOb3RWZXJ5Q29uY2VudHJhdGVkO1xyXG5jb25zdCBjb25jZW50cmF0aW9uUmVnaW9uc0FjdGl2ZUlzVmVyeUNvbmNlbnRyYXRlZFN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5LmNvbmNlbnRyYXRpb25SZWdpb25zLmFjdGl2ZS5pc1ZlcnlDb25jZW50cmF0ZWQ7XHJcbmNvbnN0IGNvbmNlbnRyYXRpb25SZWdpb25zQWN0aXZlSXNIaWdobHlDb25jZW50cmF0ZWRTdHJpbmcgPSBNb2xhcml0eVN0cmluZ3MuYTExeS5jb25jZW50cmF0aW9uUmVnaW9ucy5hY3RpdmUuaXNIaWdobHlDb25jZW50cmF0ZWQ7XHJcbmNvbnN0IGNvbmNlbnRyYXRpb25SZWdpb25zQWN0aXZlSGFzTWF4Q29uY2VudHJhdGlvblN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5LmNvbmNlbnRyYXRpb25SZWdpb25zLmFjdGl2ZS5oYXNNYXhDb25jZW50cmF0aW9uO1xyXG5cclxuLy8gQ2hhbmdlIHN0cmluZ3NcclxuY29uc3QgbGVzc0NhcGl0YWxpemVkU3RyaW5nID0gTW9sYXJpdHlTdHJpbmdzLmExMXkubGVzcy5jYXBpdGFsaXplZDtcclxuY29uc3QgbGVzc0xvd2VyY2FzZVN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5Lmxlc3MubG93ZXJjYXNlO1xyXG5jb25zdCBtb3JlQ2FwaXRhbGl6ZWRTdHJpbmcgPSBNb2xhcml0eVN0cmluZ3MuYTExeS5tb3JlLmNhcGl0YWxpemVkO1xyXG5jb25zdCBtb3JlTG93ZXJjYXNlU3RyaW5nID0gTW9sYXJpdHlTdHJpbmdzLmExMXkubW9yZS5sb3dlcmNhc2U7XHJcbmNvbnN0IHF1YW50aXR5Q2hhbmdlTGlnaHRlclN0cmluZyA9IE1vbGFyaXR5U3RyaW5ncy5hMTF5LnF1YW50aXR5Q2hhbmdlLmxpZ2h0ZXI7XHJcbmNvbnN0IHF1YW50aXR5Q2hhbmdlRGFya2VyU3RyaW5nID0gTW9sYXJpdHlTdHJpbmdzLmExMXkucXVhbnRpdHlDaGFuZ2UuZGFya2VyO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IEFDVElWRV9DT05DRU5UUkFUSU9OX1NUUklOR1MgPSBbXHJcbiAgY29uY2VudHJhdGlvblJlZ2lvbnNBY3RpdmVIYXNaZXJvQ29uY2VudHJhdGlvblN0cmluZyxcclxuICBjb25jZW50cmF0aW9uUmVnaW9uc0FjdGl2ZUhhc0xvd0NvbmNlbnRyYXRpb25TdHJpbmcsXHJcbiAgY29uY2VudHJhdGlvblJlZ2lvbnNBY3RpdmVJc1NsaWdodGx5Q29uY2VudHJhdGVkU3RyaW5nLFxyXG4gIGNvbmNlbnRyYXRpb25SZWdpb25zQWN0aXZlSXNOb3RWZXJ5Q29uY2VudHJhdGVkU3RyaW5nLFxyXG4gIGNvbmNlbnRyYXRpb25SZWdpb25zQWN0aXZlSXNWZXJ5Q29uY2VudHJhdGVkU3RyaW5nLFxyXG4gIGNvbmNlbnRyYXRpb25SZWdpb25zQWN0aXZlSXNIaWdobHlDb25jZW50cmF0ZWRTdHJpbmcsXHJcbiAgY29uY2VudHJhdGlvblJlZ2lvbnNBY3RpdmVIYXNNYXhDb25jZW50cmF0aW9uU3RyaW5nXHJcbl07XHJcblxyXG5jb25zdCBDT05DRU5UUkFUSU9OX1NUUklOR1MgPSBbXHJcbiAgY29uY2VudHJhdGlvblJlZ2lvbnNQYXNzaXZlWmVyb0NvbmNlbnRyYXRpb25TdHJpbmcsXHJcbiAgY29uY2VudHJhdGlvblJlZ2lvbnNQYXNzaXZlTG93Q29uY2VudHJhdGlvblN0cmluZyxcclxuICBjb25jZW50cmF0aW9uUmVnaW9uc1Bhc3NpdmVTbGlnaHRseUNvbmNlbnRyYXRlZFN0cmluZyxcclxuICBjb25jZW50cmF0aW9uUmVnaW9uc1Bhc3NpdmVOb3RWZXJ5Q29uY2VudHJhdGVkU3RyaW5nLFxyXG4gIGNvbmNlbnRyYXRpb25SZWdpb25zUGFzc2l2ZVZlcnlDb25jZW50cmF0ZWRTdHJpbmcsXHJcbiAgY29uY2VudHJhdGlvblJlZ2lvbnNQYXNzaXZlSGlnaGx5Q29uY2VudHJhdGVkU3RyaW5nLFxyXG4gIGNvbmNlbnRyYXRpb25SZWdpb25zUGFzc2l2ZU1heENvbmNlbnRyYXRpb25TdHJpbmdcclxuXTtcclxuXHJcbmNsYXNzIENvbmNlbnRyYXRpb25EZXNjcmliZXIge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge01hY3JvU29sdXRpb259IHNvbHV0aW9uIC0gZnJvbSBNb2xhcml0eU1vZGVsXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IHVzZVF1YW50aXRhdGl2ZURlc2NyaXB0aW9uc1Byb3BlcnR5XHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIHNvbHV0aW9uLCB1c2VRdWFudGl0YXRpdmVEZXNjcmlwdGlvbnNQcm9wZXJ0eSApIHtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5zb2x1dGlvbiA9IHNvbHV0aW9uO1xyXG4gICAgdGhpcy5zb2x1dGVQcm9wZXJ0eSA9IHNvbHV0aW9uLnNvbHV0ZVByb3BlcnR5O1xyXG4gICAgdGhpcy5jb25jZW50cmF0aW9uUHJvcGVydHkgPSBzb2x1dGlvbi5jb25jZW50cmF0aW9uUHJvcGVydHk7XHJcbiAgICBjb25zdCBwcmVjaXBpdGF0ZUFtb3VudFByb3BlcnR5ID0gc29sdXRpb24ucHJlY2lwaXRhdGVBbW91bnRQcm9wZXJ0eTtcclxuICAgIHRoaXMudXNlUXVhbnRpdGF0aXZlRGVzY3JpcHRpb25zUHJvcGVydHkgPSB1c2VRdWFudGl0YXRpdmVEZXNjcmlwdGlvbnNQcm9wZXJ0eTtcclxuXHJcbiAgICAvLyBAcHVibGljIHtib29sZWFufG51bGx9IC0gdHJhY2tzIHdoZXRoZXIgdGhlIHNvbHV0aW9uIGhhcyBtb3N0IHJlY2VudGx5IGdvbmUgZnJvbSBzYXR1cmF0ZWQgdG8gdW5zYXR1cmF0ZWQgb3JcclxuICAgIC8vIHZpY2UtdmVyc2EuXHJcbiAgICB0aGlzLnNhdHVyYXRpb25WYWx1ZUNoYW5nZWQgPSBudWxsO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtib29sZWFufSAtIHRyYWNrcyB0aGUgbW9zdCByZWNlbnQgc2F0dXJhdGlvbiBzdGF0ZSBvZiB0aGUgc29sdXRpb25cclxuICAgIGxldCBsYXN0U2F0dXJhdGlvblZhbHVlID0gZmFsc2U7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge2Jvb2xlYW58bnVsbH0gLSBzaG91bGQgb25seSBiZSB1cGRhdGVkIGFuZCBhY2Nlc3NlZCB3aGVuIHRoZSBjb25jZW50cmF0aW9uUHJvcGVydHkgY2hhbmdlcywgc29cclxuICAgIC8vIHdoaWxlIGl0IHdpbGwgYmUgbnVsbCBvbiBpbml0aWFsaXphdGlvbiwgaXQgd2lsbCBvbmx5IGJlIGFjY2Vzc2VkIHdoZW4gaXQgaG9sZHMgYm9vbGVhbiB2YWx1ZXMgKFRydWUgaWYgY29uY2VudHJhdGlvblByb3BlcnR5XHJcbiAgICAvLyBoYXMgaW5jcmVhc2VkLCBGYWxzZSBpZiBpdCBoYXMgZGVjcmVhc2VkKVxyXG4gICAgdGhpcy5jb25jZW50cmF0aW9uSW5jcmVhc2VkID0gbnVsbDtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIHtib29sZWFufG51bGx9IC0gdHJhY2tzIHdoZXRoZXIgdGhlIGRlc2NyaXB0aXZlIHJlZ2lvbnMgZm9yIGNvbmNlbnRyYXRpb25Qcm9wZXJ0eSBoYXMgY2hhbmdlZFxyXG4gICAgLy8gKHNpbmNlIHJlZ2lvbiBjaGFuZ2VzIHRyaWdnZXIgdGhlIGRpZmZlcmVudCBkZXNjcmlwdGl2ZSB0ZXh0IGluIHRoZSBhcmlhLWxpdmUgYWxlcnRzKS5cclxuICAgIHRoaXMuY29uY2VudHJhdGlvblJlZ2lvbkNoYW5nZWQgPSBudWxsO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtOdW1iZXJ9IC0gdHJhY2tzIHRoZSBsYXN0IGNhbGN1bGF0ZWQgY29uY2VudHJhdGlvbiByZWdpb24gaW5kZXguXHJcbiAgICBsZXQgbGFzdENvbmNlbnRyYXRpb25JbmRleCA9IHRoaXMuZ2V0Q3VycmVudENvbmNlbnRyYXRpb25JbmRleCgpO1xyXG5cclxuICAgIC8vIHVwZGF0ZSBmaWVsZHMgKGRvY3VtZW50ZWQgYWJvdmUpIHdoZW4gY29uY2VudHJhdGlvblByb3BlcnR5IGNoYW5nZXNcclxuICAgIHRoaXMuY29uY2VudHJhdGlvblByb3BlcnR5LmxhenlMaW5rKCAoIG5ld1ZhbHVlLCBvbGRWYWx1ZSApID0+IHtcclxuICAgICAgY29uc3QgbmV3Q29uY2VudHJhdGlvbkluZGV4ID0gY29uY2VudHJhdGlvblRvSW5kZXgoIHRoaXMuY29uY2VudHJhdGlvblByb3BlcnR5LnZhbHVlLFxyXG4gICAgICAgIHRoaXMuc29sdXRlUHJvcGVydHkudmFsdWUuc2F0dXJhdGVkQ29uY2VudHJhdGlvbiApO1xyXG4gICAgICBjb25zdCBuZXdTYXR1cmF0aW9uVmFsdWUgPSB0aGlzLnNvbHV0aW9uLmlzU2F0dXJhdGVkKCk7XHJcblxyXG4gICAgICAvLyBuZXdWYWx1ZSB3aWxsIG5ldmVyIGJlIGVxdWFsIHRvIG9sZFZhbHVlLCBzaW5jZSB0aGlzIGlzIHVwZGF0ZWQgd2l0aGluIGEgUHJvcGVydHkgbGluay5cclxuICAgICAgdGhpcy5jb25jZW50cmF0aW9uSW5jcmVhc2VkID0gbmV3VmFsdWUgPiBvbGRWYWx1ZTtcclxuICAgICAgdGhpcy5jb25jZW50cmF0aW9uUmVnaW9uQ2hhbmdlZCA9IG5ld0NvbmNlbnRyYXRpb25JbmRleCAhPT0gbGFzdENvbmNlbnRyYXRpb25JbmRleDtcclxuICAgICAgbGFzdENvbmNlbnRyYXRpb25JbmRleCA9IG5ld0NvbmNlbnRyYXRpb25JbmRleDtcclxuICAgICAgdGhpcy5zYXR1cmF0aW9uVmFsdWVDaGFuZ2VkID0gbmV3U2F0dXJhdGlvblZhbHVlICE9PSBsYXN0U2F0dXJhdGlvblZhbHVlO1xyXG4gICAgICBsYXN0U2F0dXJhdGlvblZhbHVlID0gbmV3U2F0dXJhdGlvblZhbHVlO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSBzYXR1cmF0aW9uVmFsdWVDaGFuZ2VkIGZpZWxkIHdoZW4gcHJlY2lwaXRhdGVBbW91bnRQcm9wZXJ0eSBjaGFuZ2VzLiBUaGlzIGlzIG5lY2Vzc2FyeSBiZWNhdXNlXHJcbiAgICAvLyBjb25jZW50cmF0aW9uUHJvcGVydHkgc3RvcHMgY2hhbmdpbmcgb25jZSB0aGUgc29sdXRpb24gaXMgc2F0dXJhdGVkLCB3aGljaCBtYWtlcyB0aGUgZGV0ZWN0aW9uIG9mIGEgY2hhbmdlIGluXHJcbiAgICAvLyBzYXR1cmF0aW9uIG5vdCBwb3NzaWJsZSB3aXRob3V0IGFsc28gbGlzdGVuaW5nIHRvIGNoYW5nZXMgaW4gcHJlY2lwaXRhdGVBbW91bnRQcm9wZXJ0eS5cclxuICAgIHByZWNpcGl0YXRlQW1vdW50UHJvcGVydHkubGF6eUxpbmsoICgpID0+IHtcclxuICAgICAgY29uc3QgbmV3U2F0dXJhdGlvblZhbHVlID0gdGhpcy5zb2x1dGlvbi5pc1NhdHVyYXRlZCgpO1xyXG4gICAgICB0aGlzLnNhdHVyYXRpb25WYWx1ZUNoYW5nZWQgPSBuZXdTYXR1cmF0aW9uVmFsdWUgIT09IGxhc3RTYXR1cmF0aW9uVmFsdWU7XHJcbiAgICAgIGxhc3RTYXR1cmF0aW9uVmFsdWUgPSBuZXdTYXR1cmF0aW9uVmFsdWU7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxjdWxhdGVzIHRoZSBpbmRleCBvZiB0aGUgY3VycmVudCBjb25jZW50cmF0aW9uIHJlZ2lvbiB1c2luZyB0aGUgc2F0dXJhdGVkIGNvbmNlbnRyYXRpb24gb2YgdGhlIHNvbHV0ZSBhbmRcclxuICAgKiB0aGUgY3VycmVudCBjb25jZW50cmF0aW9uXHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEByZXR1cm5zIHtOdW1iZXJ9IC0gaW5kZXggb2YgdGhlIGN1cnJlbnQgY29uY2VudHJhdGlvbiByZWdpb25cclxuICAgKiAqL1xyXG4gIGdldEN1cnJlbnRDb25jZW50cmF0aW9uSW5kZXgoKSB7XHJcbiAgICByZXR1cm4gY29uY2VudHJhdGlvblRvSW5kZXgoIHRoaXMuY29uY2VudHJhdGlvblByb3BlcnR5LnZhbHVlLCB0aGlzLnNvbHV0ZVByb3BlcnR5LnZhbHVlLnNhdHVyYXRlZENvbmNlbnRyYXRpb24gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIGN1cnJlbnQgdmFsdWUgb2YgY29uY2VudHJhdGlvbiBlaXRoZXIgcXVhbnRpdGF0aXZlbHkgb3IgcXVhbnRpdGF0aXZlbHkgdG8gcGx1ZyBpbnRvIGRlc2NyaXB0aW9ucy5cclxuICAgKiBRdWFsaXRhdGl2ZSBkZXNjcmlwdGlvbiBjYW4gYmUgaW4gYWN0aXZlIG9yIHBhc3NpdmUgdm9pY2UgZGVwZW5kaW5nIG9uIGlzUGFzc2l2ZSBwYXJhbWV0ZXIuXHJcbiAgICogQHBhcmFtIHtib29sZWFufSBbaXNQYXNzaXZlXSAtIGlnbm9yZWQgaWYgdXNpbmcgcXVhbnRpdGF0aXZlIGRlc2NyaXB0aW9uc1xyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIGRlc2NyaXB0aW9uIG9mIGN1cnJlbnQgY29uY2VudHJhdGlvbiAoZS5nLiBcIjEuNTAwIE1vbGFyXCIgb3IgXCJpcyB2ZXJ5IGNvbmNlbnRyYXRlZFwiKVxyXG4gICAqL1xyXG4gIGdldEN1cnJlbnRDb25jZW50cmF0aW9uQ2xhdXNlKCBpc1Bhc3NpdmUgPSBmYWxzZSApIHtcclxuICAgIGNvbnN0IGNvbmNlbnRyYXRpb24gPSB0aGlzLmNvbmNlbnRyYXRpb25Qcm9wZXJ0eS52YWx1ZTtcclxuICAgIGlmICggdGhpcy51c2VRdWFudGl0YXRpdmVEZXNjcmlwdGlvbnNQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgcmV0dXJuIFN0cmluZ1V0aWxzLmZpbGxJbiggcXVhbnRpdGF0aXZlQ29uY2VudHJhdGlvbkFuZFVuaXRTdHJpbmcsIHtcclxuICAgICAgICBjb25jZW50cmF0aW9uOiBVdGlscy50b0ZpeGVkKCBjb25jZW50cmF0aW9uLCBNb2xhcml0eUNvbnN0YW50cy5DT05DRU5UUkFUSU9OX0RFQ0lNQUxfUExBQ0VTIClcclxuICAgICAgfSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gY29uY2VudHJhdGlvblRvSW5kZXgoIHRoaXMuY29uY2VudHJhdGlvblByb3BlcnR5LnZhbHVlLCB0aGlzLnNvbHV0ZVByb3BlcnR5LnZhbHVlLnNhdHVyYXRlZENvbmNlbnRyYXRpb24gKTtcclxuICAgICAgcmV0dXJuIGlzUGFzc2l2ZSA/IENPTkNFTlRSQVRJT05fU1RSSU5HU1sgaW5kZXggXSA6IEFDVElWRV9DT05DRU5UUkFUSU9OX1NUUklOR1NbIGluZGV4IF07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgc3RyaW5nIGRlc2NyaWJpbmcgdGhlIGNvbmNlbnRyYXRpb24gcmFuZ2Ugb2YgdGhlIGN1cnJlbnQgc29sdXRlLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIGRlc2NyaXB0aW9uIG9mIGNvbmNlbnRyYXRpb24gcmFuZ2UgKGUuZy4gXCJjb25jZW50cmF0aW9uIHJlYWRvdXQgcmFuZ2UgMCB0byAwLjUgbW9sYXJcIilcclxuICAgKi9cclxuICBnZXRDdXJyZW50Q29uY2VudHJhdGlvblJhbmdlQ2xhdXNlKCkge1xyXG5cclxuICAgIGNvbnN0IGNvbmNlbnRyYXRpb25NaW4gPSBNb2xhcml0eUNvbnN0YW50cy5DT05DRU5UUkFUSU9OX1JBTkdFLm1pbjtcclxuICAgIGNvbnN0IGNvbmNlbnRyYXRpb25NYXggPSBNb2xhcml0eUNvbnN0YW50cy5DT05DRU5UUkFUSU9OX1JBTkdFLm1heDtcclxuICAgIGNvbnN0IGNsYW1wZWRDb25jZW50cmF0aW9uID0gVXRpbHMuY2xhbXAoIHRoaXMuZ2V0Q3VycmVudFNhdHVyYXRlZENvbmNlbnRyYXRpb24oKSwgY29uY2VudHJhdGlvbk1pbiwgY29uY2VudHJhdGlvbk1heCApO1xyXG5cclxuICAgIC8vIFRoZSBkZXNjcmliZWQgbWF4IGNvbmNlbnRyYXRpb24gaW4gdGhpcyBjbGF1c2UgaXMgdGhlIG1heGltdW0gb2YgdGhlIGRpc3BsYXllZCBjb25jZW50cmF0aW9uIHJhbmdlIGZvciBzb2x1dGVzXHJcbiAgICAvLyB3aXRoIGEgbWF4IGNvbmNlbnRyYXRpb24gbGFyZ2VyIHRoYW4gdGhlIGRpc3BsYXllZCBjb25jZW50cmF0aW9uIHJhbmdlIG1heCwgYW5kIGlzIHRoZSBzb2x1dGUncyBhY3R1YWwgbWF4XHJcbiAgICAvLyBjb25jZW50cmF0aW9uIGlmIGl0IGlzIGxlc3MgdGhhbiB0aGUgZGlzcGxheWVkIGNvbmNlbnRyYXRpb24gcmFuZ2UgbWF4LlxyXG4gICAgY29uc3QgZGlzcGxheWVkTWF4Q29uY2VudHJhdGlvbiA9IFV0aWxzLnRvRml4ZWQoIGNsYW1wZWRDb25jZW50cmF0aW9uLCBNb2xhcml0eUNvbnN0YW50cy5TT0xVVEVfQU1PVU5UX0RFQ0lNQUxfUExBQ0VTICk7XHJcblxyXG4gICAgcmV0dXJuIFN0cmluZ1V0aWxzLmZpbGxJbiggYmVha2VyQ29uY2VudHJhdGlvblJhbmdlUGF0dGVyblN0cmluZywge1xyXG4gICAgICBtYXhDb25jZW50cmF0aW9uOiBVdGlscy50b0ZpeGVkKCBkaXNwbGF5ZWRNYXhDb25jZW50cmF0aW9uLCBNb2xhcml0eUNvbnN0YW50cy5DT05DRU5UUkFUSU9OX0RFQ0lNQUxfUExBQ0VTIClcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIHNhdHVyYXRlZCBjb25jZW50cmF0aW9uIGxldmVsIG9mIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgc29sdXRlLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqL1xyXG4gIGdldEN1cnJlbnRTYXR1cmF0ZWRDb25jZW50cmF0aW9uKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuc29sdXRlUHJvcGVydHkudmFsdWUuc2F0dXJhdGVkQ29uY2VudHJhdGlvbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBzdHJpbmcgdGhhdCBkZXNjcmliZXMgdGhlIGNvbmNlbnRyYXRpb24gb2YgaW4gdGhlIGJlYWtlclxyXG4gICAqIHtQcm9wZXJ0eS48Ym9vbGVhbj59IHVzZVF1YW50aXRhdGl2ZURlc2NyaXB0aW9uc1Byb3BlcnR5XHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IC0gZS5nLiBcImNvbmNlbnRyYXRpb24gMS40MDAgbW9sYXJcIiBvciBcImlzIHZlcnkgY29uY2VudHJhdGVkXCJcclxuICAgKi9cclxuICBnZXRCZWFrZXJDb25jZW50cmF0aW9uU3RyaW5nKCB1c2VRdWFudGl0YXRpdmVEZXNjcmlwdGlvbnNQcm9wZXJ0eSApIHtcclxuICAgIGNvbnN0IHF1YW50aXRhdGl2ZVN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggcXVhbnRpdGF0aXZlQ29uY2VudHJhdGlvblN0YXRlUGF0dGVyblN0cmluZywge1xyXG4gICAgICBjb25jZW50cmF0aW9uOiB0aGlzLmdldEN1cnJlbnRDb25jZW50cmF0aW9uQ2xhdXNlKClcclxuICAgIH0gKTtcclxuICAgIHJldHVybiB1c2VRdWFudGl0YXRpdmVEZXNjcmlwdGlvbnNQcm9wZXJ0eS52YWx1ZSA/IHF1YW50aXRhdGl2ZVN0cmluZyA6IHRoaXMuZ2V0Q3VycmVudENvbmNlbnRyYXRpb25DbGF1c2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBzdWJzdHJpbmcgdG8gZGVzY3JpYmUgaG93IGNvbmNlbnRyYXRpb24gaGFzIGNoYW5nZWRcclxuICAgKiBAcGFyYW0gW2lzQ2FwaXRhbGl6ZWRdIHtib29sZWFufVxyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIGV4YW1wbGU6IFwibW9yZSBjb25jZW50cmF0ZWRcIlxyXG4gICAqL1xyXG4gIGdldENvbmNlbnRyYXRpb25DaGFuZ2VTdHJpbmcoIGlzQ2FwaXRhbGl6ZWQgPSB0cnVlICkge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggIXRoaXMuc29sdXRpb24uaXNTYXR1cmF0ZWQoKSwgJ2NvbmNlbnRyYXRpb24gY2Fubm90IGNoYW5nZSB3aGVuIHNhdHVyYXRlZCcgKTtcclxuXHJcbiAgICBsZXQgbW9yZUxlc3NTdHJpbmcgPSBpc0NhcGl0YWxpemVkID8gbGVzc0NhcGl0YWxpemVkU3RyaW5nIDogbGVzc0xvd2VyY2FzZVN0cmluZztcclxuICAgIGlmICggdGhpcy5jb25jZW50cmF0aW9uSW5jcmVhc2VkICkge1xyXG4gICAgICBtb3JlTGVzc1N0cmluZyA9IGlzQ2FwaXRhbGl6ZWQgPyBtb3JlQ2FwaXRhbGl6ZWRTdHJpbmcgOiBtb3JlTG93ZXJjYXNlU3RyaW5nO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFN0cmluZ1V0aWxzLmZpbGxJbiggcXVhbnRpdHlDaGFuZ2VDb25jZW50cmF0aW9uQ2hhbmdlUGF0dGVyblN0cmluZywge1xyXG4gICAgICBtb3JlTGVzczogbW9yZUxlc3NTdHJpbmdcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBzdWJzdHJpbmcgdG8gZGVzY3JpYmUgaG93IHRoZSBjb2xvciBvZiB0aGUgc29sdXRpb24gaGFzIGNoYW5nZWRcclxuICAgKiBAcHVibGljXHJcbiAgICogQHJldHVybnMge3N0cmluZ30gLSBleGFtcGxlOiBcIlNvbHV0aW9uIGxpZ2h0ZXJcIlxyXG4gICAqL1xyXG4gIGdldENvbG9yQ2hhbmdlU3RyaW5nKCkge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggIXRoaXMuc29sdXRpb24uaXNTYXR1cmF0ZWQoKSwgJ2NvbG9yIGNhbm5vdCBjaGFuZ2Ugd2hlbiBzYXR1cmF0ZWQnICk7XHJcblxyXG4gICAgcmV0dXJuIFN0cmluZ1V0aWxzLmZpbGxJbiggcXVhbnRpdHlDaGFuZ2VDb2xvckNoYW5nZVBhdHRlcm5TdHJpbmcsIHtcclxuICAgICAgbGlnaHRlckRhcmtlcjogdGhpcy5jb25jZW50cmF0aW9uSW5jcmVhc2VkID8gcXVhbnRpdHlDaGFuZ2VEYXJrZXJTdHJpbmcgOiBxdWFudGl0eUNoYW5nZUxpZ2h0ZXJTdHJpbmdcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgdGhlIHF1YWxpdGF0aXZlIHN1YnN0cmluZ3MgdG8gZGVzY3JpYmUgdGhlIGNvbmNlbnRyYXRpb24gXCJzdGF0ZVwiIG9mIHRoZSBzb2x1dGlvbi5cclxuICAgKiBAcHVibGljXHJcbiAgICogQHJldHVybnMge3N0cmluZ30gLSBleGFtcGxlOiBcIlNvbHV0aW9uIHZlcnkgY29uY2VudHJhdGVkXCIuXHJcbiAgICogKi9cclxuICBnZXRRdWFsaXRhdGl2ZUNvbmNlbnRyYXRpb25EZXNjcmlwdGlvbigpIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICF0aGlzLnVzZVF1YW50aXRhdGl2ZURlc2NyaXB0aW9uc1Byb3BlcnR5LnZhbHVlLCAncXVhbGl0YXRpdmUgZGVzY3JpcHRpb25zIGV4cGVjdGVkJyApO1xyXG4gICAgcmV0dXJuIFN0cmluZ1V0aWxzLmZpbGxJbiggcXVhbGl0YXRpdmVDb25jZW50cmF0aW9uU3RhdGVDbGF1c2VQYXR0ZXJuU3RyaW5nLCB7XHJcbiAgICAgIGNvbmNlbnRyYXRpb246IHRoaXMuZ2V0Q3VycmVudENvbmNlbnRyYXRpb25DbGF1c2UoIHRydWUgKVxyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENhbGN1bGF0ZXMgdGhlIHdoaWNoIGl0ZW0gdG8gdXNlIGZyb20gdGhlIENPTkNFTlRSQVRJT05fU1RSSU5HUyBhcnJheS5cclxuICogQHBhcmFtIHtudW1iZXJ9IGN1cnJlbnRDb25jZW50cmF0aW9uXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzYXR1cmF0ZWRDb25jZW50cmF0aW9uRm9yU29sdXRlIC0gdGhlIHNhdHVyYXRpb24gcG9pbnQgZm9yIGEgc3BlY2lmaWMgc29sdXRlLlxyXG4gKiBAcmV0dXJucyB7bnVtYmVyfSBpbmRleCB0byBhY2Nlc3MgYSByZWdpb24gZnJvbSBDT05DRU5UUkFUSU9OX1NUUklOR1NcclxuICovXHJcbmNvbnN0IGNvbmNlbnRyYXRpb25Ub0luZGV4ID0gKCBjdXJyZW50Q29uY2VudHJhdGlvbiwgc2F0dXJhdGVkQ29uY2VudHJhdGlvbkZvclNvbHV0ZSApID0+IHtcclxuICBhc3NlcnQgJiYgYXNzZXJ0KCBjdXJyZW50Q29uY2VudHJhdGlvbiA8PSBzYXR1cmF0ZWRDb25jZW50cmF0aW9uRm9yU29sdXRlLCAnY29uY2VudHJhdGlvbiBjYW5ub3QgYmUgaGlnaGVyIHRoYW4gc2F0dXJhdGVkQ29uY2VudHJhdGlvbicgKTtcclxuXHJcbiAgLy8gY29tcGFyZSBhZ2FpbnN0IHVuLXJvdW5kZWQgY29uY2VudHJhdGlvbiBzaW5jZSB0aGVzZSB0d28gYXJlIHNpbmdsZSB2YWx1ZSByZWdpb25zXHJcbiAgLy8gSGFuZGxlIHNpbmdsZSB2YWx1ZSByZWdpb24gY2FzZXMgYmVmb3JlIGl0ZXJhdGluZyB0aHJvdWdoIGV2ZW5seSBzcGFjZWQgcmVnaW9ucy5cclxuICBpZiAoIGN1cnJlbnRDb25jZW50cmF0aW9uID09PSBzYXR1cmF0ZWRDb25jZW50cmF0aW9uRm9yU29sdXRlICkge1xyXG4gICAgcmV0dXJuIENPTkNFTlRSQVRJT05fU1RSSU5HUy5sZW5ndGggLSAxO1xyXG4gIH1cclxuICBlbHNlIGlmICggY3VycmVudENvbmNlbnRyYXRpb24gPT09IE1vbGFyaXR5Q29uc3RhbnRzLkNPTkNFTlRSQVRJT05fUkFOR0UubWluICkge1xyXG4gICAgcmV0dXJuIDA7XHJcbiAgfVxyXG4gIGVsc2Uge1xyXG5cclxuICAgIC8vIENvbmNlbnRyYXRpb24gcmVnaW9ucyBhcmUgZXZlbmx5IHNwYWNlZCB3aXRoaW4gdGhlIHJlZ2lvbiBmcm9tIDAgdG8gbWF4IGNvbmNlbnRyYXRpb24gZm9yIGEgZ2l2ZW4gc29sdXRlIGV4Y2VwdFxyXG4gICAgLy8gZm9yIHRoZSBsb3dlc3QgcmVnaW9uICh6ZXJvKSBhbmQgdGhlIGhpZ2hlc3QgcmVnaW9uIChtYXggY29uY2VudHJhdGlvbikgd2hpY2ggYXJlIHNpbmdsZSB2YWx1ZSByZWdpb25zLlxyXG4gICAgY29uc3Qgc2NhbGVJbmNyZW1lbnQgPSBzYXR1cmF0ZWRDb25jZW50cmF0aW9uRm9yU29sdXRlIC8gKCBDT05DRU5UUkFUSU9OX1NUUklOR1MubGVuZ3RoIC0gMiApO1xyXG4gICAgY29uc3QgY29uY2VudHJhdGlvblJvdW5kZWQgPSBVdGlscy50b0ZpeGVkTnVtYmVyKCBjdXJyZW50Q29uY2VudHJhdGlvbiwgTW9sYXJpdHlDb25zdGFudHMuQ09OQ0VOVFJBVElPTl9ERUNJTUFMX1BMQUNFUyApO1xyXG5cclxuICAgIC8vIGRvbid0IGNvdW50IHRoZSBmaXJzdCBhbmQgbGFzdCBjb25jZW50cmF0aW9uIHN0cmluZ1xyXG4gICAgZm9yICggbGV0IGkgPSAxOyBpIDwgQ09OQ0VOVFJBVElPTl9TVFJJTkdTLmxlbmd0aCAtIDI7IGkrKyApIHtcclxuICAgICAgaWYgKCBjb25jZW50cmF0aW9uUm91bmRlZCA8PSAoIGkgKyAxICkgKiBzY2FsZUluY3JlbWVudCApIHtcclxuICAgICAgICByZXR1cm4gaTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBhc3NlcnQgJiYgYXNzZXJ0KCBmYWxzZSwgJ3VuZXhwZWN0ZWQgY29uY2VudHJhdGlvbicgKTtcclxuICByZXR1cm4gLTE7XHJcbn07XHJcblxyXG5tb2xhcml0eS5yZWdpc3RlciggJ0NvbmNlbnRyYXRpb25EZXNjcmliZXInLCBDb25jZW50cmF0aW9uRGVzY3JpYmVyICk7XHJcbmV4cG9ydCBkZWZhdWx0IENvbmNlbnRyYXRpb25EZXNjcmliZXI7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxLQUFLLE1BQU0sZ0NBQWdDO0FBQ2xELE9BQU9DLFdBQVcsTUFBTSxrREFBa0Q7QUFDMUUsT0FBT0MsUUFBUSxNQUFNLHNCQUFzQjtBQUMzQyxPQUFPQyxlQUFlLE1BQU0sNkJBQTZCO0FBQ3pELE9BQU9DLGlCQUFpQixNQUFNLDRCQUE0QjtBQUUxRCxNQUFNQyxzQ0FBc0MsR0FBR0YsZUFBZSxDQUFDRyxJQUFJLENBQUNDLGNBQWMsQ0FBQ0Msa0JBQWtCO0FBQ3JHLE1BQU1DLHNDQUFzQyxHQUFHTixlQUFlLENBQUNHLElBQUksQ0FBQ0ksWUFBWSxDQUFDQyxvQkFBb0I7QUFDckcsTUFBTUMsOENBQThDLEdBQUdULGVBQWUsQ0FBQ0csSUFBSSxDQUFDQyxjQUFjLENBQUNNLDBCQUEwQjtBQUNySCxNQUFNQyxxQ0FBcUMsR0FBR1gsZUFBZSxDQUFDRyxJQUFJLENBQUNTLE1B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