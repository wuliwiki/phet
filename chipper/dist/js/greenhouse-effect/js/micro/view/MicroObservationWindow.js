// Copyright 2021-2022, University of Colorado Boulder

/**
 * Window for Molecules And Light which holds the photon emitter, photons, and molecules of the photon absorption model.
 * This is where the user observes interactions between photons and molecules.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

// modules
// const Shape = require( '/kite/js/Shape' );  // See below for comment on temporary replacement of clipArea shape.
import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Node, Rectangle, Text } from '../../../../scenery/js/imports.js';
import RectangularPushButton from '../../../../sun/js/buttons/RectangularPushButton.js';
import greenhouseEffect from '../../greenhouseEffect.js';
import GreenhouseEffectStrings from '../../GreenhouseEffectStrings.js';
import MicroPhotonNode from './MicroPhotonNode.js';
import MoleculeNode from './MoleculeNode.js';
import MoleculeUtils from './MoleculeUtils.js';
import ObservationWindowDescriber from './ObservationWindowDescriber.js';
import PhotonEmitterNode from './PhotonEmitterNode.js';
const buttonNodeReturnMoleculeStringProperty = GreenhouseEffectStrings.ButtonNode.ReturnMoleculeStringProperty;
const observationWindowLabelStringProperty = GreenhouseEffectStrings.a11y.observationWindowLabelStringProperty;
const geometryLabelPatternStringProperty = GreenhouseEffectStrings.a11y.geometryLabelPatternStringProperty;

// constants
const PHOTON_EMITTER_WIDTH = 125;
const CORNER_RADIUS = 7;

// The emitter is a little to the right of the emission point so that photons "slide" into view from the emitter and
// don't "pop" into free space, see https://github.com/phetsims/molecules-and-light/issues/324.
const EMITTER_OFFSET = new Vector2(100, 0);
class MicroObservationWindow extends Rectangle {
  /**
   * Constructor for a Molecules and Light observation window.
   *
   * @param {PhotonAbsorptionModel} photonAbsorptionModel
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Tandem} tandem
   */
  constructor(photonAbsorptionModel, modelViewTransform, tandem) {
    // Supertype constructor
    super(0, 0, 500, 300, CORNER_RADIUS, CORNER_RADIUS, {
      fill: 'black',
      // pdom
      tagName: 'div',
      labelTagName: 'h3',
      labelContent: observationWindowLabelStringProperty.value
    });
    this.modelViewTransform = modelViewTransform; // @private
    this.photonAbsorptionModel = photonAbsorptionModel; // @private

    // Width of the 'window frame' which surrounds the observation window.
    this.frameLineWidth = 5;

    // @public (read-only) - keeps track of whether the 'Restore Molecule' button should be visible.
    this.returnMoleculeButtonVisibleProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('returnMoleculeButtonVisibleProperty')
    });

    // Add the layers for molecules, photons, and photon emitters.
    const moleculeLayer = new Node();
    this.addChild(moleculeLayer);
    const photonLayer = new Node();
    this.addChild(photonLayer);
    const photonEmitterLayer = new Node();
    this.addChild(photonEmitterLayer);

    // Create and add the photon emitter.
    const photonEmitterNode = new PhotonEmitterNode(PHOTON_EMITTER_WIDTH, photonAbsorptionModel, tandem.createTandem('photonEmitterNode'));
    photonEmitterNode.rightCenter = modelViewTransform.modelToViewPosition(photonAbsorptionModel.getPhotonEmissionPosition().plus(EMITTER_OFFSET)).plus(new Vector2(0, photonEmitterNode.openSciEdLabelHeight / 2));
    photonEmitterLayer.addChild(photonEmitterNode);

    // TODO: This clip area has been replaced with a layered rectangle in MicroScreenView because of a
    // Safari specific SVG bug caused by clipping.  Once we discover the cause of this bug, the clipping area can
    // replace the layered rectangle in MicroScreenView.  See
    // https://github.com/phetsims/molecules-and-light/issues/105 and https://github.com/phetsims/scenery/issues/412.
    // Add a clip area around the edge of the window frame to clean up photon and molecule removal from screen.
    //    this.clipArea = new Shape().roundRect(
    //      this.left,
    //      this.top,this.width,
    //
    //      this.height,
    //      CORNER_RADIUS, CORNER_RADIUS ); // @private

    // Define bounds for where a particle should be removed from the scene.  Bounds are larger than those of the
    // clipping area so that particles have a chance to cleanly slide out of the window before being removed.
    this.particleRemovalBounds = this.bounds.copy().dilate(20); // @private

    // Add the button for restoring molecules that break apart.
    const buttonContent = new Text(buttonNodeReturnMoleculeStringProperty.value, {
      font: new PhetFont(13)
    });
    // If necessary, scale the button content for translation purposes.  Max button width is half the width of the
    // observation window.
    const maxButtonWidth = this.width / 2;
    if (buttonContent.width > maxButtonWidth) {
      buttonContent.scale(maxButtonWidth / buttonContent.width);
    }
    // @private
    this.returnMoleculeButtonNode = new RectangularPushButton({
      content: buttonContent,
      baseColor: 'rgb(247, 151, 34)',
      touchAreaXDilation: 7,
      touchAreaYDilation: 7,
      listener: () => {
        // pdom
        // move focus to the emission control slider only when the button is clicked
        // retain focus on other elements if button was clicked without focus
        photonEmitterNode.button.focus();
        photonAbsorptionModel.restoreActiveMolecule();
        this.returnMoleculeButtonVisibleProperty.set(false);
        this.moleculeCheckBounds();
      },
      tandem: tandem.createTandem('returnMoleculeButton'),
      // pdom
      appendDescription: true,
      ariaLabel: buttonNodeReturnMoleculeStringProperty.value
    });
    this.returnMoleculeButtonNode.rightTop = new Vector2(this.width - 2 * this.frameLineWidth - 10, 10);
    this.addChild(this.returnMoleculeButtonNode);

    // function for adding a molecule to this window and hooking up a removal listener
    const addMoleculeToWindow = molecule => {
      const moleculeNode = new MoleculeNode(molecule, this.modelViewTransform); //Create the molecule node.
      moleculeLayer.addChild(moleculeNode);

      // Determine if it is time to remove molecule and update restore molecule button visibility.
      const centerOfGravityObserver = () => {
        this.moleculeCheckBounds();
      };
      molecule.centerOfGravityProperty.link(centerOfGravityObserver);
      const removalListener = removedMolecule => {
        if (removedMolecule === molecule) {
          molecule.centerOfGravityProperty.unlink(centerOfGravityObserver);
          moleculeLayer.removeChild(moleculeNode);
          photonAbsorptionModel.activeMolecules.removeItemRemovedListener(removalListener);
        }
      };
      photonAbsorptionModel.activeMolecules.addItemRemovedListener(removalListener);
    };

    // Add the initial molecules.
    photonAbsorptionModel.activeMolecules.forEach(addMoleculeToWindow);

    // Set up an event listener for adding and removing molecules.
    photonAbsorptionModel.activeMolecules.addItemAddedListener(addMoleculeToWindow);

    // Set up the event listeners for adding and removing photons.
    photonAbsorptionModel.photonGroup.elementCreatedEmitter.addListener(addedPhoton => {
      const photonNode = new MicroPhotonNode(addedPhoton, this.modelViewTransform);
      photonLayer.addChild(photonNode);

      // Watch photon positions and determine if photon should be removed from window.
      const photonPositionObserver = () => {
        this.photonCheckBounds();
      };
      addedPhoton.positionProperty.link(photonPositionObserver);
      const removalListener = removedPhoton => {
        if (removedPhoton === addedPhoton) {
          addedPhoton.positionProperty.hasListener(photonPositionObserver) && addedPhoton.positionProperty.unlink(photonPositionObserver);
          photonLayer.removeChild(photonNode);
          photonAbsorptionModel.photonGroup.elementDisposedEmitter.removeListener(removalListener);
        }
      };
      photonAbsorptionModel.photonGroup.elementDisposedEmitter.addListener(removalListener);
    });

    // If a new molecule is chosen with the molecule control panel, remove the "Restore Molecule" button.
    this.photonAbsorptionModel.photonTargetProperty.link(() => {
      this.returnMoleculeButtonVisibleProperty.set(false);
    });
    this.returnMoleculeButtonVisibleProperty.link(visible => {
      // hide the return molecule button
      this.returnMoleculeButtonNode.visible = visible;
    });

    // pdom
    // @public - generates descriptions for the target molecule
    this.describer = new ObservationWindowDescriber(photonAbsorptionModel, this, modelViewTransform);

    // pdom - list that describes the state of contents in the Observation Window
    const phaseItem = new Node({
      tagName: 'li'
    });
    const geometryLabelItem = new Node({
      tagName: 'li'
    });
    const geometryDescriptionItem = new Node({
      tagName: 'li'
    });

    // pdom - attach listeners that will describe the initial phase of photons passing through the molecule
    this.describer.attachInitialPhaseDescriptionListeners(phaseItem);

    // pdom - when a new molecule is added to the observation window, add listeners that will generate descriptions
    // for its state - also add to the initial active molecule
    photonAbsorptionModel.activeMolecules.addItemAddedListener(molecule => {
      this.describer.attachAbsorptionDescriptionListeners(molecule, phaseItem);

      // adding new target molecule, geometry descriptions are accurate
      if (molecule === photonAbsorptionModel.targetMolecule) {
        geometryLabelItem.visible = true;
        geometryDescriptionItem.visible = true;
      }

      // when the molecule breaks apart, hide the geometryLabelItem and geometryDescriptionItem, because they
      // described the molecule before it broke apart
      molecule.brokeApartEmitter.addListener(() => {
        geometryLabelItem.visible = false;
        geometryDescriptionItem.visible = false;
      });
    });
    this.describer.attachAbsorptionDescriptionListeners(photonAbsorptionModel.targetMolecule, phaseItem);

    // pdom - update geometry descriptions when target changes
    photonAbsorptionModel.photonTargetProperty.link(() => {
      const targetMolecule = photonAbsorptionModel.targetMolecule;
      geometryLabelItem.accessibleName = StringUtils.fillIn(geometryLabelPatternStringProperty.value, {
        geometry: MoleculeUtils.getGeometryLabel(targetMolecule)
      });
      geometryDescriptionItem.accessibleName = MoleculeUtils.getGeometryDescription(targetMolecule);
    });
    const descriptionList = new Node({
      tagName: 'ul',
      children: [phaseItem, geometryLabelItem, geometryDescriptionItem]
    });
    this.addChild(descriptionList);

    // pdom - description list first
    this.pdomOrder = [descriptionList, photonEmitterNode];
  }

  /**
   * Update the visibility of the button that restores molecules that have broken apart.  This button should be
   * visible only when one or more molecules are off the screen.
   * @private
   */
  moleculeCheckBounds() {
    const moleculesToRemove = [];
    for (let molecule = 0; molecule < this.photonAbsorptionModel.activeMolecules.length; molecule++) {
      if (!this.particleRemovalBounds.containsPoint(this.modelViewTransform.modelToViewPosition(this.photonAbsorptionModel.activeMolecules.get(molecule).getCenterOfGravityPos()))) {
        moleculesToRemove.push(this.photonAbsorptionModel.activeMolecules.get(molecule));
        this.returnMoleculeButtonVisibleProperty.set(true);
        break;
      }
    }
    this.photonAbsorptionModel.activeMolecules.removeAll(moleculesToRemove);
  }

  /**
   * Check to see if any photons collide with the observation window.  If there is a collision, remove the photon
   * from the model.
   * @private
   */
  photonCheckBounds() {
    const photonsToRemove = this.photonAbsorptionModel.photonGroup.filter(photon => {
      const position = this.modelViewTransform.modelToViewPosition(photon.positionProperty.get());
      return !this.particleRemovalBounds.containsPoint(position);
    });
    photonsToRemove.forEach(photon => this.photonAbsorptionModel.photonGroup.disposeElement(photon));
  }

  /**
   * Step the describer, as some descriptions are time dependent.
   * @public
   *
   * @param {number} dt
   */
  step(dt) {
    this.describer.step(dt);
  }
}
greenhouseEffect.register('MicroObservationWindow', MicroObservationWindow);
export default MicroObservationWindow;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJWZWN0b3IyIiwiU3RyaW5nVXRpbHMiLCJQaGV0Rm9udCIsIk5vZGUiLCJSZWN0YW5nbGUiLCJUZXh0IiwiUmVjdGFuZ3VsYXJQdXNoQnV0dG9uIiwiZ3JlZW5ob3VzZUVmZmVjdCIsIkdyZWVuaG91c2VFZmZlY3RTdHJpbmdzIiwiTWljcm9QaG90b25Ob2RlIiwiTW9sZWN1bGVOb2RlIiwiTW9sZWN1bGVVdGlscyIsIk9ic2VydmF0aW9uV2luZG93RGVzY3JpYmVyIiwiUGhvdG9uRW1pdHRlck5vZGUiLCJidXR0b25Ob2RlUmV0dXJuTW9sZWN1bGVTdHJpbmdQcm9wZXJ0eSIsIkJ1dHRvbk5vZGUiLCJSZXR1cm5Nb2xlY3VsZVN0cmluZ1Byb3BlcnR5Iiwib2JzZXJ2YXRpb25XaW5kb3dMYWJlbFN0cmluZ1Byb3BlcnR5IiwiYTExeSIsImdlb21ldHJ5TGFiZWxQYXR0ZXJuU3RyaW5nUHJvcGVydHkiLCJQSE9UT05fRU1JVFRFUl9XSURUSCIsIkNPUk5FUl9SQURJVVMiLCJFTUlUVEVSX09GRlNFVCIsIk1pY3JvT2JzZXJ2YXRpb25XaW5kb3ciLCJjb25zdHJ1Y3RvciIsInBob3RvbkFic29ycHRpb25Nb2RlbCIsIm1vZGVsVmlld1RyYW5zZm9ybSIsInRhbmRlbSIsImZpbGwiLCJ0YWdOYW1lIiwibGFiZWxUYWdOYW1lIiwibGFiZWxDb250ZW50IiwidmFsdWUiLCJmcmFtZUxpbmVXaWR0aCIsInJldHVybk1vbGVjdWxlQnV0dG9uVmlzaWJsZVByb3BlcnR5IiwiY3JlYXRlVGFuZGVtIiwibW9sZWN1bGVMYXllciIsImFkZENoaWxkIiwicGhvdG9uTGF5ZXIiLCJwaG90b25FbWl0dGVyTGF5ZXIiLCJwaG90b25FbWl0dGVyTm9kZSIsInJpZ2h0Q2VudGVyIiwibW9kZWxUb1ZpZXdQb3NpdGlvbiIsImdldFBob3RvbkVtaXNzaW9uUG9zaXRpb24iLCJwbHVzIiwib3BlblNjaUVkTGFiZWxIZWlnaHQiLCJwYXJ0aWNsZVJlbW92YWxCb3VuZHMiLCJib3VuZHMiLCJjb3B5IiwiZGlsYXRlIiwiYnV0dG9uQ29udGVudCIsImZvbnQiLCJtYXhCdXR0b25XaWR0aCIsIndpZHRoIiwic2NhbGUiLCJyZXR1cm5Nb2xlY3VsZUJ1dHRvbk5vZGUiLCJjb250ZW50IiwiYmFzZUNvbG9yIiwidG91Y2hBcmVhWERpbGF0aW9uIiwidG91Y2hBcmVhWURpbGF0aW9uIiwibGlzdGVuZXIiLCJidXR0b24iLCJmb2N1cyIsInJlc3RvcmVBY3RpdmVNb2xlY3VsZSIsInNldCIsIm1vbGVjdWxlQ2hlY2tCb3VuZHMiLCJhcHBlbmREZXNjcmlwdGlvbiIsImFyaWFMYWJlbCIsInJpZ2h0VG9wIiwiYWRkTW9sZWN1bGVUb1dpbmRvdyIsIm1vbGVjdWxlIiwibW9sZWN1bGVOb2RlIiwiY2VudGVyT2ZHcmF2aXR5T2JzZXJ2ZXIiLCJjZW50ZXJPZkdyYXZpdHlQcm9wZXJ0eSIsImxpbmsiLCJyZW1vdmFsTGlzdGVuZXIiLCJyZW1vdmVkTW9sZWN1bGUiLCJ1bmxpbmsiLCJyZW1vdmVDaGlsZCIsImFjdGl2ZU1vbGVjdWxlcyIsInJlbW92ZUl0ZW1SZW1vdmVkTGlzdGVuZXIiLCJhZGRJdGVtUmVtb3ZlZExpc3RlbmVyIiwiZm9yRWFjaCIsImFkZEl0ZW1BZGRlZExpc3RlbmVyIiwicGhvdG9uR3JvdXAiLCJlbGVtZW50Q3JlYXRlZEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImFkZGVkUGhvdG9uIiwicGhvdG9uTm9kZSIsInBob3RvblBvc2l0aW9uT2JzZXJ2ZXIiLCJwaG90b25DaGVja0JvdW5kcyIsInBvc2l0aW9uUHJvcGVydHkiLCJyZW1vdmVkUGhvdG9uIiwiaGFzTGlzdGVuZXIiLCJlbGVtZW50RGlzcG9zZWRFbWl0dGVyIiwicmVtb3ZlTGlzdGVuZXIiLCJwaG90b25UYXJnZXRQcm9wZXJ0eSIsInZpc2libGUiLCJkZXNjcmliZXIiLCJwaGFzZUl0ZW0iLCJnZW9tZXRyeUxhYmVsSXRlbSIsImdlb21ldHJ5RGVzY3JpcHRpb25JdGVtIiwiYXR0YWNoSW5pdGlhbFBoYXNlRGVzY3JpcHRpb25MaXN0ZW5lcnMiLCJhdHRhY2hBYnNvcnB0aW9uRGVzY3JpcHRpb25MaXN0ZW5lcnMiLCJ0YXJnZXRNb2xlY3VsZSIsImJyb2tlQXBhcnRFbWl0dGVyIiwiYWNjZXNzaWJsZU5hbWUiLCJmaWxsSW4iLCJnZW9tZXRyeSIsImdldEdlb21ldHJ5TGFiZWwiLCJnZXRHZW9tZXRyeURlc2NyaXB0aW9uIiwiZGVzY3JpcHRpb25MaXN0IiwiY2hpbGRyZW4iLCJwZG9tT3JkZXIiLCJtb2xlY3VsZXNUb1JlbW92ZSIsImxlbmd0aCIsImNvbnRhaW5zUG9pbnQiLCJnZXQiLCJnZXRDZW50ZXJPZkdyYXZpdHlQb3MiLCJwdXNoIiwicmVtb3ZlQWxsIiwicGhvdG9uc1RvUmVtb3ZlIiwiZmlsdGVyIiwicGhvdG9uIiwicG9zaXRpb24iLCJkaXNwb3NlRWxlbWVudCIsInN0ZXAiLCJkdCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTWljcm9PYnNlcnZhdGlvbldpbmRvdy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBXaW5kb3cgZm9yIE1vbGVjdWxlcyBBbmQgTGlnaHQgd2hpY2ggaG9sZHMgdGhlIHBob3RvbiBlbWl0dGVyLCBwaG90b25zLCBhbmQgbW9sZWN1bGVzIG9mIHRoZSBwaG90b24gYWJzb3JwdGlvbiBtb2RlbC5cclxuICogVGhpcyBpcyB3aGVyZSB0aGUgdXNlciBvYnNlcnZlcyBpbnRlcmFjdGlvbnMgYmV0d2VlbiBwaG90b25zIGFuZCBtb2xlY3VsZXMuXHJcbiAqXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcblxyXG4vLyBtb2R1bGVzXHJcbi8vIGNvbnN0IFNoYXBlID0gcmVxdWlyZSggJy9raXRlL2pzL1NoYXBlJyApOyAgLy8gU2VlIGJlbG93IGZvciBjb21tZW50IG9uIHRlbXBvcmFyeSByZXBsYWNlbWVudCBvZiBjbGlwQXJlYSBzaGFwZS5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUGhldEZvbnQuanMnO1xyXG5pbXBvcnQgeyBOb2RlLCBSZWN0YW5nbGUsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUmVjdGFuZ3VsYXJQdXNoQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9idXR0b25zL1JlY3Rhbmd1bGFyUHVzaEJ1dHRvbi5qcyc7XHJcbmltcG9ydCBncmVlbmhvdXNlRWZmZWN0IGZyb20gJy4uLy4uL2dyZWVuaG91c2VFZmZlY3QuanMnO1xyXG5pbXBvcnQgR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MgZnJvbSAnLi4vLi4vR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuanMnO1xyXG5pbXBvcnQgTWljcm9QaG90b25Ob2RlIGZyb20gJy4vTWljcm9QaG90b25Ob2RlLmpzJztcclxuaW1wb3J0IE1vbGVjdWxlTm9kZSBmcm9tICcuL01vbGVjdWxlTm9kZS5qcyc7XHJcbmltcG9ydCBNb2xlY3VsZVV0aWxzIGZyb20gJy4vTW9sZWN1bGVVdGlscy5qcyc7XHJcbmltcG9ydCBPYnNlcnZhdGlvbldpbmRvd0Rlc2NyaWJlciBmcm9tICcuL09ic2VydmF0aW9uV2luZG93RGVzY3JpYmVyLmpzJztcclxuaW1wb3J0IFBob3RvbkVtaXR0ZXJOb2RlIGZyb20gJy4vUGhvdG9uRW1pdHRlck5vZGUuanMnO1xyXG5cclxuY29uc3QgYnV0dG9uTm9kZVJldHVybk1vbGVjdWxlU3RyaW5nUHJvcGVydHkgPSBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5CdXR0b25Ob2RlLlJldHVybk1vbGVjdWxlU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IG9ic2VydmF0aW9uV2luZG93TGFiZWxTdHJpbmdQcm9wZXJ0eSA9IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmExMXkub2JzZXJ2YXRpb25XaW5kb3dMYWJlbFN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBnZW9tZXRyeUxhYmVsUGF0dGVyblN0cmluZ1Byb3BlcnR5ID0gR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuYTExeS5nZW9tZXRyeUxhYmVsUGF0dGVyblN0cmluZ1Byb3BlcnR5O1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IFBIT1RPTl9FTUlUVEVSX1dJRFRIID0gMTI1O1xyXG5jb25zdCBDT1JORVJfUkFESVVTID0gNztcclxuXHJcbi8vIFRoZSBlbWl0dGVyIGlzIGEgbGl0dGxlIHRvIHRoZSByaWdodCBvZiB0aGUgZW1pc3Npb24gcG9pbnQgc28gdGhhdCBwaG90b25zIFwic2xpZGVcIiBpbnRvIHZpZXcgZnJvbSB0aGUgZW1pdHRlciBhbmRcclxuLy8gZG9uJ3QgXCJwb3BcIiBpbnRvIGZyZWUgc3BhY2UsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbW9sZWN1bGVzLWFuZC1saWdodC9pc3N1ZXMvMzI0LlxyXG5jb25zdCBFTUlUVEVSX09GRlNFVCA9IG5ldyBWZWN0b3IyKCAxMDAsIDAgKTtcclxuXHJcbmNsYXNzIE1pY3JvT2JzZXJ2YXRpb25XaW5kb3cgZXh0ZW5kcyBSZWN0YW5nbGUge1xyXG4gIC8qKlxyXG4gICAqIENvbnN0cnVjdG9yIGZvciBhIE1vbGVjdWxlcyBhbmQgTGlnaHQgb2JzZXJ2YXRpb24gd2luZG93LlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtQaG90b25BYnNvcnB0aW9uTW9kZWx9IHBob3RvbkFic29ycHRpb25Nb2RlbFxyXG4gICAqIEBwYXJhbSB7TW9kZWxWaWV3VHJhbnNmb3JtMn0gbW9kZWxWaWV3VHJhbnNmb3JtXHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBwaG90b25BYnNvcnB0aW9uTW9kZWwsIG1vZGVsVmlld1RyYW5zZm9ybSwgdGFuZGVtICkge1xyXG5cclxuICAgIC8vIFN1cGVydHlwZSBjb25zdHJ1Y3RvclxyXG4gICAgc3VwZXIoIDAsIDAsIDUwMCwgMzAwLCBDT1JORVJfUkFESVVTLCBDT1JORVJfUkFESVVTLCB7XHJcbiAgICAgIGZpbGw6ICdibGFjaycsXHJcblxyXG4gICAgICAvLyBwZG9tXHJcbiAgICAgIHRhZ05hbWU6ICdkaXYnLFxyXG4gICAgICBsYWJlbFRhZ05hbWU6ICdoMycsXHJcbiAgICAgIGxhYmVsQ29udGVudDogb2JzZXJ2YXRpb25XaW5kb3dMYWJlbFN0cmluZ1Byb3BlcnR5LnZhbHVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0gPSBtb2RlbFZpZXdUcmFuc2Zvcm07IC8vIEBwcml2YXRlXHJcbiAgICB0aGlzLnBob3RvbkFic29ycHRpb25Nb2RlbCA9IHBob3RvbkFic29ycHRpb25Nb2RlbDsgLy8gQHByaXZhdGVcclxuXHJcbiAgICAvLyBXaWR0aCBvZiB0aGUgJ3dpbmRvdyBmcmFtZScgd2hpY2ggc3Vycm91bmRzIHRoZSBvYnNlcnZhdGlvbiB3aW5kb3cuXHJcbiAgICB0aGlzLmZyYW1lTGluZVdpZHRoID0gNTtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIC0ga2VlcHMgdHJhY2sgb2Ygd2hldGhlciB0aGUgJ1Jlc3RvcmUgTW9sZWN1bGUnIGJ1dHRvbiBzaG91bGQgYmUgdmlzaWJsZS5cclxuICAgIHRoaXMucmV0dXJuTW9sZWN1bGVCdXR0b25WaXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdyZXR1cm5Nb2xlY3VsZUJ1dHRvblZpc2libGVQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgbGF5ZXJzIGZvciBtb2xlY3VsZXMsIHBob3RvbnMsIGFuZCBwaG90b24gZW1pdHRlcnMuXHJcbiAgICBjb25zdCBtb2xlY3VsZUxheWVyID0gbmV3IE5vZGUoKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIG1vbGVjdWxlTGF5ZXIgKTtcclxuXHJcbiAgICBjb25zdCBwaG90b25MYXllciA9IG5ldyBOb2RlKCk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBwaG90b25MYXllciApO1xyXG5cclxuICAgIGNvbnN0IHBob3RvbkVtaXR0ZXJMYXllciA9IG5ldyBOb2RlKCk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBwaG90b25FbWl0dGVyTGF5ZXIgKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYW5kIGFkZCB0aGUgcGhvdG9uIGVtaXR0ZXIuXHJcbiAgICBjb25zdCBwaG90b25FbWl0dGVyTm9kZSA9IG5ldyBQaG90b25FbWl0dGVyTm9kZSggUEhPVE9OX0VNSVRURVJfV0lEVEgsIHBob3RvbkFic29ycHRpb25Nb2RlbCwgdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Bob3RvbkVtaXR0ZXJOb2RlJyApICk7XHJcbiAgICBwaG90b25FbWl0dGVyTm9kZS5yaWdodENlbnRlciA9ICggbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIHBob3RvbkFic29ycHRpb25Nb2RlbC5nZXRQaG90b25FbWlzc2lvblBvc2l0aW9uKCkucGx1cyggRU1JVFRFUl9PRkZTRVQgKSApLnBsdXMoIG5ldyBWZWN0b3IyKCAwLCBwaG90b25FbWl0dGVyTm9kZS5vcGVuU2NpRWRMYWJlbEhlaWdodCAvIDIgKSApICk7XHJcbiAgICBwaG90b25FbWl0dGVyTGF5ZXIuYWRkQ2hpbGQoIHBob3RvbkVtaXR0ZXJOb2RlICk7XHJcblxyXG4gICAgLy8gVE9ETzogVGhpcyBjbGlwIGFyZWEgaGFzIGJlZW4gcmVwbGFjZWQgd2l0aCBhIGxheWVyZWQgcmVjdGFuZ2xlIGluIE1pY3JvU2NyZWVuVmlldyBiZWNhdXNlIG9mIGFcclxuICAgIC8vIFNhZmFyaSBzcGVjaWZpYyBTVkcgYnVnIGNhdXNlZCBieSBjbGlwcGluZy4gIE9uY2Ugd2UgZGlzY292ZXIgdGhlIGNhdXNlIG9mIHRoaXMgYnVnLCB0aGUgY2xpcHBpbmcgYXJlYSBjYW5cclxuICAgIC8vIHJlcGxhY2UgdGhlIGxheWVyZWQgcmVjdGFuZ2xlIGluIE1pY3JvU2NyZWVuVmlldy4gIFNlZVxyXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL21vbGVjdWxlcy1hbmQtbGlnaHQvaXNzdWVzLzEwNSBhbmQgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3NjZW5lcnkvaXNzdWVzLzQxMi5cclxuICAgIC8vIEFkZCBhIGNsaXAgYXJlYSBhcm91bmQgdGhlIGVkZ2Ugb2YgdGhlIHdpbmRvdyBmcmFtZSB0byBjbGVhbiB1cCBwaG90b24gYW5kIG1vbGVjdWxlIHJlbW92YWwgZnJvbSBzY3JlZW4uXHJcbiAgICAvLyAgICB0aGlzLmNsaXBBcmVhID0gbmV3IFNoYXBlKCkucm91bmRSZWN0KFxyXG4gICAgLy8gICAgICB0aGlzLmxlZnQsXHJcbiAgICAvLyAgICAgIHRoaXMudG9wLHRoaXMud2lkdGgsXHJcbiAgICAvL1xyXG4gICAgLy8gICAgICB0aGlzLmhlaWdodCxcclxuICAgIC8vICAgICAgQ09STkVSX1JBRElVUywgQ09STkVSX1JBRElVUyApOyAvLyBAcHJpdmF0ZVxyXG5cclxuICAgIC8vIERlZmluZSBib3VuZHMgZm9yIHdoZXJlIGEgcGFydGljbGUgc2hvdWxkIGJlIHJlbW92ZWQgZnJvbSB0aGUgc2NlbmUuICBCb3VuZHMgYXJlIGxhcmdlciB0aGFuIHRob3NlIG9mIHRoZVxyXG4gICAgLy8gY2xpcHBpbmcgYXJlYSBzbyB0aGF0IHBhcnRpY2xlcyBoYXZlIGEgY2hhbmNlIHRvIGNsZWFubHkgc2xpZGUgb3V0IG9mIHRoZSB3aW5kb3cgYmVmb3JlIGJlaW5nIHJlbW92ZWQuXHJcbiAgICB0aGlzLnBhcnRpY2xlUmVtb3ZhbEJvdW5kcyA9IHRoaXMuYm91bmRzLmNvcHkoKS5kaWxhdGUoIDIwICk7IC8vIEBwcml2YXRlXHJcblxyXG4gICAgLy8gQWRkIHRoZSBidXR0b24gZm9yIHJlc3RvcmluZyBtb2xlY3VsZXMgdGhhdCBicmVhayBhcGFydC5cclxuICAgIGNvbnN0IGJ1dHRvbkNvbnRlbnQgPSBuZXcgVGV4dCggYnV0dG9uTm9kZVJldHVybk1vbGVjdWxlU3RyaW5nUHJvcGVydHkudmFsdWUsIHsgZm9udDogbmV3IFBoZXRGb250KCAxMyApIH0gKTtcclxuICAgIC8vIElmIG5lY2Vzc2FyeSwgc2NhbGUgdGhlIGJ1dHRvbiBjb250ZW50IGZvciB0cmFuc2xhdGlvbiBwdXJwb3Nlcy4gIE1heCBidXR0b24gd2lkdGggaXMgaGFsZiB0aGUgd2lkdGggb2YgdGhlXHJcbiAgICAvLyBvYnNlcnZhdGlvbiB3aW5kb3cuXHJcbiAgICBjb25zdCBtYXhCdXR0b25XaWR0aCA9IHRoaXMud2lkdGggLyAyO1xyXG4gICAgaWYgKCBidXR0b25Db250ZW50LndpZHRoID4gbWF4QnV0dG9uV2lkdGggKSB7XHJcbiAgICAgIGJ1dHRvbkNvbnRlbnQuc2NhbGUoIG1heEJ1dHRvbldpZHRoIC8gYnV0dG9uQ29udGVudC53aWR0aCApO1xyXG4gICAgfVxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMucmV0dXJuTW9sZWN1bGVCdXR0b25Ob2RlID0gbmV3IFJlY3Rhbmd1bGFyUHVzaEJ1dHRvbigge1xyXG4gICAgICBjb250ZW50OiBidXR0b25Db250ZW50LFxyXG4gICAgICBiYXNlQ29sb3I6ICdyZ2IoMjQ3LCAxNTEsIDM0KScsXHJcbiAgICAgIHRvdWNoQXJlYVhEaWxhdGlvbjogNyxcclxuICAgICAgdG91Y2hBcmVhWURpbGF0aW9uOiA3LFxyXG4gICAgICBsaXN0ZW5lcjogKCkgPT4ge1xyXG4gICAgICAgIC8vIHBkb21cclxuICAgICAgICAvLyBtb3ZlIGZvY3VzIHRvIHRoZSBlbWlzc2lvbiBjb250cm9sIHNsaWRlciBvbmx5IHdoZW4gdGhlIGJ1dHRvbiBpcyBjbGlja2VkXHJcbiAgICAgICAgLy8gcmV0YWluIGZvY3VzIG9uIG90aGVyIGVsZW1lbnRzIGlmIGJ1dHRvbiB3YXMgY2xpY2tlZCB3aXRob3V0IGZvY3VzXHJcbiAgICAgICAgcGhvdG9uRW1pdHRlck5vZGUuYnV0dG9uLmZvY3VzKCk7XHJcblxyXG4gICAgICAgIHBob3RvbkFic29ycHRpb25Nb2RlbC5yZXN0b3JlQWN0aXZlTW9sZWN1bGUoKTtcclxuICAgICAgICB0aGlzLnJldHVybk1vbGVjdWxlQnV0dG9uVmlzaWJsZVByb3BlcnR5LnNldCggZmFsc2UgKTtcclxuICAgICAgICB0aGlzLm1vbGVjdWxlQ2hlY2tCb3VuZHMoKTtcclxuICAgICAgfSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAncmV0dXJuTW9sZWN1bGVCdXR0b24nICksXHJcblxyXG4gICAgICAvLyBwZG9tXHJcbiAgICAgIGFwcGVuZERlc2NyaXB0aW9uOiB0cnVlLFxyXG4gICAgICBhcmlhTGFiZWw6IGJ1dHRvbk5vZGVSZXR1cm5Nb2xlY3VsZVN0cmluZ1Byb3BlcnR5LnZhbHVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5yZXR1cm5Nb2xlY3VsZUJ1dHRvbk5vZGUucmlnaHRUb3AgPSAoIG5ldyBWZWN0b3IyKCB0aGlzLndpZHRoIC0gMiAqIHRoaXMuZnJhbWVMaW5lV2lkdGggLSAxMCwgMTAgKSApO1xyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMucmV0dXJuTW9sZWN1bGVCdXR0b25Ob2RlICk7XHJcblxyXG4gICAgLy8gZnVuY3Rpb24gZm9yIGFkZGluZyBhIG1vbGVjdWxlIHRvIHRoaXMgd2luZG93IGFuZCBob29raW5nIHVwIGEgcmVtb3ZhbCBsaXN0ZW5lclxyXG4gICAgY29uc3QgYWRkTW9sZWN1bGVUb1dpbmRvdyA9IG1vbGVjdWxlID0+IHtcclxuICAgICAgY29uc3QgbW9sZWN1bGVOb2RlID0gbmV3IE1vbGVjdWxlTm9kZSggbW9sZWN1bGUsIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtICk7IC8vQ3JlYXRlIHRoZSBtb2xlY3VsZSBub2RlLlxyXG4gICAgICBtb2xlY3VsZUxheWVyLmFkZENoaWxkKCBtb2xlY3VsZU5vZGUgKTtcclxuXHJcbiAgICAgIC8vIERldGVybWluZSBpZiBpdCBpcyB0aW1lIHRvIHJlbW92ZSBtb2xlY3VsZSBhbmQgdXBkYXRlIHJlc3RvcmUgbW9sZWN1bGUgYnV0dG9uIHZpc2liaWxpdHkuXHJcbiAgICAgIGNvbnN0IGNlbnRlck9mR3Jhdml0eU9ic2VydmVyID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMubW9sZWN1bGVDaGVja0JvdW5kcygpO1xyXG4gICAgICB9O1xyXG4gICAgICBtb2xlY3VsZS5jZW50ZXJPZkdyYXZpdHlQcm9wZXJ0eS5saW5rKCBjZW50ZXJPZkdyYXZpdHlPYnNlcnZlciApO1xyXG5cclxuICAgICAgY29uc3QgcmVtb3ZhbExpc3RlbmVyID0gcmVtb3ZlZE1vbGVjdWxlID0+IHtcclxuICAgICAgICBpZiAoIHJlbW92ZWRNb2xlY3VsZSA9PT0gbW9sZWN1bGUgKSB7XHJcbiAgICAgICAgICBtb2xlY3VsZS5jZW50ZXJPZkdyYXZpdHlQcm9wZXJ0eS51bmxpbmsoIGNlbnRlck9mR3Jhdml0eU9ic2VydmVyICk7XHJcbiAgICAgICAgICBtb2xlY3VsZUxheWVyLnJlbW92ZUNoaWxkKCBtb2xlY3VsZU5vZGUgKTtcclxuICAgICAgICAgIHBob3RvbkFic29ycHRpb25Nb2RlbC5hY3RpdmVNb2xlY3VsZXMucmVtb3ZlSXRlbVJlbW92ZWRMaXN0ZW5lciggcmVtb3ZhbExpc3RlbmVyICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBwaG90b25BYnNvcnB0aW9uTW9kZWwuYWN0aXZlTW9sZWN1bGVzLmFkZEl0ZW1SZW1vdmVkTGlzdGVuZXIoIHJlbW92YWxMaXN0ZW5lciApO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGluaXRpYWwgbW9sZWN1bGVzLlxyXG4gICAgcGhvdG9uQWJzb3JwdGlvbk1vZGVsLmFjdGl2ZU1vbGVjdWxlcy5mb3JFYWNoKCBhZGRNb2xlY3VsZVRvV2luZG93ICk7XHJcblxyXG4gICAgLy8gU2V0IHVwIGFuIGV2ZW50IGxpc3RlbmVyIGZvciBhZGRpbmcgYW5kIHJlbW92aW5nIG1vbGVjdWxlcy5cclxuICAgIHBob3RvbkFic29ycHRpb25Nb2RlbC5hY3RpdmVNb2xlY3VsZXMuYWRkSXRlbUFkZGVkTGlzdGVuZXIoIGFkZE1vbGVjdWxlVG9XaW5kb3cgKTtcclxuXHJcbiAgICAvLyBTZXQgdXAgdGhlIGV2ZW50IGxpc3RlbmVycyBmb3IgYWRkaW5nIGFuZCByZW1vdmluZyBwaG90b25zLlxyXG4gICAgcGhvdG9uQWJzb3JwdGlvbk1vZGVsLnBob3Rvbkdyb3VwLmVsZW1lbnRDcmVhdGVkRW1pdHRlci5hZGRMaXN0ZW5lciggYWRkZWRQaG90b24gPT4ge1xyXG4gICAgICBjb25zdCBwaG90b25Ob2RlID0gbmV3IE1pY3JvUGhvdG9uTm9kZSggYWRkZWRQaG90b24sIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtICk7XHJcbiAgICAgIHBob3RvbkxheWVyLmFkZENoaWxkKCBwaG90b25Ob2RlICk7XHJcblxyXG4gICAgICAvLyBXYXRjaCBwaG90b24gcG9zaXRpb25zIGFuZCBkZXRlcm1pbmUgaWYgcGhvdG9uIHNob3VsZCBiZSByZW1vdmVkIGZyb20gd2luZG93LlxyXG4gICAgICBjb25zdCBwaG90b25Qb3NpdGlvbk9ic2VydmVyID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucGhvdG9uQ2hlY2tCb3VuZHMoKTtcclxuICAgICAgfTtcclxuICAgICAgYWRkZWRQaG90b24ucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCBwaG90b25Qb3NpdGlvbk9ic2VydmVyICk7XHJcblxyXG4gICAgICBjb25zdCByZW1vdmFsTGlzdGVuZXIgPSByZW1vdmVkUGhvdG9uID0+IHtcclxuICAgICAgICBpZiAoIHJlbW92ZWRQaG90b24gPT09IGFkZGVkUGhvdG9uICkge1xyXG4gICAgICAgICAgYWRkZWRQaG90b24ucG9zaXRpb25Qcm9wZXJ0eS5oYXNMaXN0ZW5lciggcGhvdG9uUG9zaXRpb25PYnNlcnZlciApICYmIGFkZGVkUGhvdG9uLnBvc2l0aW9uUHJvcGVydHkudW5saW5rKCBwaG90b25Qb3NpdGlvbk9ic2VydmVyICk7XHJcbiAgICAgICAgICBwaG90b25MYXllci5yZW1vdmVDaGlsZCggcGhvdG9uTm9kZSApO1xyXG4gICAgICAgICAgcGhvdG9uQWJzb3JwdGlvbk1vZGVsLnBob3Rvbkdyb3VwLmVsZW1lbnREaXNwb3NlZEVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoIHJlbW92YWxMaXN0ZW5lciApO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIHBob3RvbkFic29ycHRpb25Nb2RlbC5waG90b25Hcm91cC5lbGVtZW50RGlzcG9zZWRFbWl0dGVyLmFkZExpc3RlbmVyKCByZW1vdmFsTGlzdGVuZXIgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBJZiBhIG5ldyBtb2xlY3VsZSBpcyBjaG9zZW4gd2l0aCB0aGUgbW9sZWN1bGUgY29udHJvbCBwYW5lbCwgcmVtb3ZlIHRoZSBcIlJlc3RvcmUgTW9sZWN1bGVcIiBidXR0b24uXHJcbiAgICB0aGlzLnBob3RvbkFic29ycHRpb25Nb2RlbC5waG90b25UYXJnZXRQcm9wZXJ0eS5saW5rKCAoKSA9PiB7XHJcbiAgICAgIHRoaXMucmV0dXJuTW9sZWN1bGVCdXR0b25WaXNpYmxlUHJvcGVydHkuc2V0KCBmYWxzZSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMucmV0dXJuTW9sZWN1bGVCdXR0b25WaXNpYmxlUHJvcGVydHkubGluayggdmlzaWJsZSA9PiB7XHJcblxyXG4gICAgICAvLyBoaWRlIHRoZSByZXR1cm4gbW9sZWN1bGUgYnV0dG9uXHJcbiAgICAgIHRoaXMucmV0dXJuTW9sZWN1bGVCdXR0b25Ob2RlLnZpc2libGUgPSB2aXNpYmxlO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHBkb21cclxuICAgIC8vIEBwdWJsaWMgLSBnZW5lcmF0ZXMgZGVzY3JpcHRpb25zIGZvciB0aGUgdGFyZ2V0IG1vbGVjdWxlXHJcbiAgICB0aGlzLmRlc2NyaWJlciA9IG5ldyBPYnNlcnZhdGlvbldpbmRvd0Rlc2NyaWJlciggcGhvdG9uQWJzb3JwdGlvbk1vZGVsLCB0aGlzLCBtb2RlbFZpZXdUcmFuc2Zvcm0gKTtcclxuXHJcbiAgICAvLyBwZG9tIC0gbGlzdCB0aGF0IGRlc2NyaWJlcyB0aGUgc3RhdGUgb2YgY29udGVudHMgaW4gdGhlIE9ic2VydmF0aW9uIFdpbmRvd1xyXG4gICAgY29uc3QgcGhhc2VJdGVtID0gbmV3IE5vZGUoIHsgdGFnTmFtZTogJ2xpJyB9ICk7XHJcbiAgICBjb25zdCBnZW9tZXRyeUxhYmVsSXRlbSA9IG5ldyBOb2RlKCB7IHRhZ05hbWU6ICdsaScgfSApO1xyXG4gICAgY29uc3QgZ2VvbWV0cnlEZXNjcmlwdGlvbkl0ZW0gPSBuZXcgTm9kZSggeyB0YWdOYW1lOiAnbGknIH0gKTtcclxuXHJcbiAgICAvLyBwZG9tIC0gYXR0YWNoIGxpc3RlbmVycyB0aGF0IHdpbGwgZGVzY3JpYmUgdGhlIGluaXRpYWwgcGhhc2Ugb2YgcGhvdG9ucyBwYXNzaW5nIHRocm91Z2ggdGhlIG1vbGVjdWxlXHJcbiAgICB0aGlzLmRlc2NyaWJlci5hdHRhY2hJbml0aWFsUGhhc2VEZXNjcmlwdGlvbkxpc3RlbmVycyggcGhhc2VJdGVtICk7XHJcblxyXG4gICAgLy8gcGRvbSAtIHdoZW4gYSBuZXcgbW9sZWN1bGUgaXMgYWRkZWQgdG8gdGhlIG9ic2VydmF0aW9uIHdpbmRvdywgYWRkIGxpc3RlbmVycyB0aGF0IHdpbGwgZ2VuZXJhdGUgZGVzY3JpcHRpb25zXHJcbiAgICAvLyBmb3IgaXRzIHN0YXRlIC0gYWxzbyBhZGQgdG8gdGhlIGluaXRpYWwgYWN0aXZlIG1vbGVjdWxlXHJcbiAgICBwaG90b25BYnNvcnB0aW9uTW9kZWwuYWN0aXZlTW9sZWN1bGVzLmFkZEl0ZW1BZGRlZExpc3RlbmVyKCBtb2xlY3VsZSA9PiB7XHJcbiAgICAgIHRoaXMuZGVzY3JpYmVyLmF0dGFjaEFic29ycHRpb25EZXNjcmlwdGlvbkxpc3RlbmVycyggbW9sZWN1bGUsIHBoYXNlSXRlbSApO1xyXG5cclxuICAgICAgLy8gYWRkaW5nIG5ldyB0YXJnZXQgbW9sZWN1bGUsIGdlb21ldHJ5IGRlc2NyaXB0aW9ucyBhcmUgYWNjdXJhdGVcclxuICAgICAgaWYgKCBtb2xlY3VsZSA9PT0gcGhvdG9uQWJzb3JwdGlvbk1vZGVsLnRhcmdldE1vbGVjdWxlICkge1xyXG4gICAgICAgIGdlb21ldHJ5TGFiZWxJdGVtLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIGdlb21ldHJ5RGVzY3JpcHRpb25JdGVtLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyB3aGVuIHRoZSBtb2xlY3VsZSBicmVha3MgYXBhcnQsIGhpZGUgdGhlIGdlb21ldHJ5TGFiZWxJdGVtIGFuZCBnZW9tZXRyeURlc2NyaXB0aW9uSXRlbSwgYmVjYXVzZSB0aGV5XHJcbiAgICAgIC8vIGRlc2NyaWJlZCB0aGUgbW9sZWN1bGUgYmVmb3JlIGl0IGJyb2tlIGFwYXJ0XHJcbiAgICAgIG1vbGVjdWxlLmJyb2tlQXBhcnRFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgICAgZ2VvbWV0cnlMYWJlbEl0ZW0udmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIGdlb21ldHJ5RGVzY3JpcHRpb25JdGVtLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgfSApO1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5kZXNjcmliZXIuYXR0YWNoQWJzb3JwdGlvbkRlc2NyaXB0aW9uTGlzdGVuZXJzKCBwaG90b25BYnNvcnB0aW9uTW9kZWwudGFyZ2V0TW9sZWN1bGUsIHBoYXNlSXRlbSApO1xyXG5cclxuICAgIC8vIHBkb20gLSB1cGRhdGUgZ2VvbWV0cnkgZGVzY3JpcHRpb25zIHdoZW4gdGFyZ2V0IGNoYW5nZXNcclxuICAgIHBob3RvbkFic29ycHRpb25Nb2RlbC5waG90b25UYXJnZXRQcm9wZXJ0eS5saW5rKCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRhcmdldE1vbGVjdWxlID0gcGhvdG9uQWJzb3JwdGlvbk1vZGVsLnRhcmdldE1vbGVjdWxlO1xyXG5cclxuICAgICAgZ2VvbWV0cnlMYWJlbEl0ZW0uYWNjZXNzaWJsZU5hbWUgPSBTdHJpbmdVdGlscy5maWxsSW4oIGdlb21ldHJ5TGFiZWxQYXR0ZXJuU3RyaW5nUHJvcGVydHkudmFsdWUsIHtcclxuICAgICAgICBnZW9tZXRyeTogTW9sZWN1bGVVdGlscy5nZXRHZW9tZXRyeUxhYmVsKCB0YXJnZXRNb2xlY3VsZSApXHJcbiAgICAgIH0gKTtcclxuICAgICAgZ2VvbWV0cnlEZXNjcmlwdGlvbkl0ZW0uYWNjZXNzaWJsZU5hbWUgPSBNb2xlY3VsZVV0aWxzLmdldEdlb21ldHJ5RGVzY3JpcHRpb24oIHRhcmdldE1vbGVjdWxlICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgZGVzY3JpcHRpb25MaXN0ID0gbmV3IE5vZGUoIHtcclxuICAgICAgdGFnTmFtZTogJ3VsJyxcclxuICAgICAgY2hpbGRyZW46IFsgcGhhc2VJdGVtLCBnZW9tZXRyeUxhYmVsSXRlbSwgZ2VvbWV0cnlEZXNjcmlwdGlvbkl0ZW0gXVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggZGVzY3JpcHRpb25MaXN0ICk7XHJcblxyXG4gICAgLy8gcGRvbSAtIGRlc2NyaXB0aW9uIGxpc3QgZmlyc3RcclxuICAgIHRoaXMucGRvbU9yZGVyID0gWyBkZXNjcmlwdGlvbkxpc3QsIHBob3RvbkVtaXR0ZXJOb2RlIF07XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBidXR0b24gdGhhdCByZXN0b3JlcyBtb2xlY3VsZXMgdGhhdCBoYXZlIGJyb2tlbiBhcGFydC4gIFRoaXMgYnV0dG9uIHNob3VsZCBiZVxyXG4gICAqIHZpc2libGUgb25seSB3aGVuIG9uZSBvciBtb3JlIG1vbGVjdWxlcyBhcmUgb2ZmIHRoZSBzY3JlZW4uXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBtb2xlY3VsZUNoZWNrQm91bmRzKCkge1xyXG5cclxuICAgIGNvbnN0IG1vbGVjdWxlc1RvUmVtb3ZlID0gW107XHJcbiAgICBmb3IgKCBsZXQgbW9sZWN1bGUgPSAwOyBtb2xlY3VsZSA8IHRoaXMucGhvdG9uQWJzb3JwdGlvbk1vZGVsLmFjdGl2ZU1vbGVjdWxlcy5sZW5ndGg7IG1vbGVjdWxlKysgKSB7XHJcbiAgICAgIGlmICggIXRoaXMucGFydGljbGVSZW1vdmFsQm91bmRzLmNvbnRhaW5zUG9pbnQoIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIHRoaXMucGhvdG9uQWJzb3JwdGlvbk1vZGVsLmFjdGl2ZU1vbGVjdWxlcy5nZXQoIG1vbGVjdWxlICkuZ2V0Q2VudGVyT2ZHcmF2aXR5UG9zKCkgKSApICkge1xyXG4gICAgICAgIG1vbGVjdWxlc1RvUmVtb3ZlLnB1c2goIHRoaXMucGhvdG9uQWJzb3JwdGlvbk1vZGVsLmFjdGl2ZU1vbGVjdWxlcy5nZXQoIG1vbGVjdWxlICkgKTtcclxuICAgICAgICB0aGlzLnJldHVybk1vbGVjdWxlQnV0dG9uVmlzaWJsZVByb3BlcnR5LnNldCggdHJ1ZSApO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLnBob3RvbkFic29ycHRpb25Nb2RlbC5hY3RpdmVNb2xlY3VsZXMucmVtb3ZlQWxsKCBtb2xlY3VsZXNUb1JlbW92ZSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgdG8gc2VlIGlmIGFueSBwaG90b25zIGNvbGxpZGUgd2l0aCB0aGUgb2JzZXJ2YXRpb24gd2luZG93LiAgSWYgdGhlcmUgaXMgYSBjb2xsaXNpb24sIHJlbW92ZSB0aGUgcGhvdG9uXHJcbiAgICogZnJvbSB0aGUgbW9kZWwuXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBwaG90b25DaGVja0JvdW5kcygpIHtcclxuXHJcbiAgICBjb25zdCBwaG90b25zVG9SZW1vdmUgPSB0aGlzLnBob3RvbkFic29ycHRpb25Nb2RlbC5waG90b25Hcm91cC5maWx0ZXIoIHBob3RvbiA9PiB7XHJcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggcGhvdG9uLnBvc2l0aW9uUHJvcGVydHkuZ2V0KCkgKTtcclxuICAgICAgcmV0dXJuICF0aGlzLnBhcnRpY2xlUmVtb3ZhbEJvdW5kcy5jb250YWluc1BvaW50KCBwb3NpdGlvbiApO1xyXG4gICAgfSApO1xyXG4gICAgcGhvdG9uc1RvUmVtb3ZlLmZvckVhY2goIHBob3RvbiA9PiB0aGlzLnBob3RvbkFic29ycHRpb25Nb2RlbC5waG90b25Hcm91cC5kaXNwb3NlRWxlbWVudCggcGhvdG9uICkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0ZXAgdGhlIGRlc2NyaWJlciwgYXMgc29tZSBkZXNjcmlwdGlvbnMgYXJlIHRpbWUgZGVwZW5kZW50LlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBkdFxyXG4gICAqL1xyXG4gIHN0ZXAoIGR0ICkge1xyXG4gICAgdGhpcy5kZXNjcmliZXIuc3RlcCggZHQgKTtcclxuICB9XHJcbn1cclxuXHJcbmdyZWVuaG91c2VFZmZlY3QucmVnaXN0ZXIoICdNaWNyb09ic2VydmF0aW9uV2luZG93JywgTWljcm9PYnNlcnZhdGlvbldpbmRvdyApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgTWljcm9PYnNl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