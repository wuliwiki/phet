// Copyright 2021-2022, University of Colorado Boulder

/**
 * Manages PDOM content that describes the MicroObservationWindow. This contains a single light source, and a target
 * molecule. This will describe the state of the target molecule as it absorbs and emits photons or breaks
 * apart into constituent molecules.
 *
 * When the photon wavelength or target molecule changes, we describe an initial state where photons
 * are passing through the molecule. As soon as a photon is absorbed, we describe the excited state
 * of the molecule (vibrating/glowing/rotating/etc.). Once the photon is re-emitted, the ground state
 * energy phase is described. The initial state description for photons passing through the molecule is
 * not re-applied until the photon wavelength or target molecule changes again.
 *
 * TODO: accessibleName was replaced throughout with innerContent because of https://github.com/phetsims/scenery/issues/1026
 * If that issue is fixed, accessibleName can be used again
 *
 * @author Jesse Greenberg
 */

import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import MovementAlerter from '../../../../scenery-phet/js/accessibility/describers/MovementAlerter.js';
import greenhouseEffect from '../../greenhouseEffect.js';
import GreenhouseEffectStrings from '../../GreenhouseEffectStrings.js';
import PhotonTarget from '../model/PhotonTarget.js';
import WavelengthConstants from '../model/WavelengthConstants.js';
import ActiveMoleculeAlertManager from './ActiveMoleculeAlertManager.js';
import ObservationWindowAlertManager from './ObservationWindowAlertManager.js';
const emptySpaceStringProperty = GreenhouseEffectStrings.a11y.emptySpaceStringProperty;
const photonEmitterOffDescriptionPatternStringProperty = GreenhouseEffectStrings.a11y.photonEmitterOffDescriptionPatternStringProperty;
const targetMoleculePatternStringProperty = GreenhouseEffectStrings.a11y.targetMoleculePatternStringProperty;
const inactiveAndPassesPhaseDescriptionPatternStringProperty = GreenhouseEffectStrings.a11y.inactiveAndPassesPhaseDescriptionPatternStringProperty;
const emissionPhaseDescriptionPatternStringProperty = GreenhouseEffectStrings.a11y.emissionPhaseDescriptionPatternStringProperty;
const moleculePiecesGoneStringProperty = GreenhouseEffectStrings.a11y.moleculePiecesGoneStringProperty;
const breakApartDescriptionWithFloatPatternStringProperty = GreenhouseEffectStrings.a11y.breakApartDescriptionWithFloatPatternStringProperty;
class ObservationWindowDescriber {
  /**
   * @param {PhotonAbsorptionModel} model
   * @param {MicroObservationWindow} observationWindow - the AlertManager sends alerts through this Node
   * @param {ModelViewTransform2} modelViewTransform
   */
  constructor(model, observationWindow, modelViewTransform) {
    // @private {PhotonAbsorptionModel}
    this.model = model;

    // @private {ModelViewTransform2} - to describe photon emission motion in scenery coordinate frame
    this.modelViewTransform = modelViewTransform;

    // @private {boolean} - state of molecule when we absorb a photon, tracked so that we can accurately describe what
    // stops happening when the photon is re-emitted - the Molecule Properties tracking these things may have already
    // reset upon emission so tracking these explicitly is more robust
    this.moleculeVibrating = false;
    this.moleculeRotating = false;
    this.moleculeRotatingClockwise = false;
    this.moleculeRotatingCounterClockwise = false;
    this.moleculeHighElectronicEnergyState = false;
    this.moleculeBrokeApart = false;

    // @private - responsible for general alerts involving things in the observation window
    this.alertManager = new ObservationWindowAlertManager(observationWindow);
    this.alertManager.initialize(model, observationWindow.returnMoleculeButtonVisibleProperty);

    // @private {ActiveMoleculeAlertManager} - responsible for alerts specifically related to photon/molecule
    // interaction
    this.activeMoleculeAlertManager = new ActiveMoleculeAlertManager(model, observationWindow, modelViewTransform);

    // @private {number} while a photon is absorbed the model photonWavelengthProperty may change - we want
    // to describe the absorbed photon not the photon wavelength currently being emitted
    this.wavelengthOnAbsorption = model.photonWavelengthProperty.get();
  }

  /**
   * Step the alert manater in time.
   * @public
   *
   * @param {number} dt - in seconds
   */
  step(dt) {
    this.activeMoleculeAlertManager.step(dt);
  }

  /**
   * Attach listeners to this PhotonAbsorptionModel that will set the description content on the provided Node
   * that describes the "initial" phase where photons are passing through the molecule.
   *
   * When the photon wavelength changes or the light source slider turns on or off, we go back to describing
   * the initial phase where photons pass through the molecule. The only exception is when there is no target
   * molecule - in this case we keep the description that guides the user to the 'return molecule' button.
   * @public
   *
   * @param {Node} descriptionNode
   */
  attachInitialPhaseDescriptionListeners(descriptionNode) {
    this.model.photonWavelengthProperty.link(photonWavelength => {
      if (this.model.targetMolecule) {
        descriptionNode.innerContent = this.getInitialPhaseDescription(this.model.photonEmitterOnProperty.get(), photonWavelength, this.model.photonTargetProperty.get());
      }
    });

    // when the molecule turns on or off, reset description content to initial description
    this.model.photonEmitterOnProperty.link(on => {
      if (this.model.targetMolecule) {
        descriptionNode.innerContent = this.getInitialPhaseDescription(on, this.model.photonWavelengthProperty.get(), this.model.photonTargetProperty.get());
      }
    });
  }

  /**
   * Attach listeners to a Molecule that will update a provided Node's description content. These Properties
   * are fully disposed when the molecule is disposed so listener removal should not be necessary.
   * @public
   *
   * @param {Molecule} molecule
   * @param {Node} descriptionNode
   */
  attachAbsorptionDescriptionListeners(molecule, descriptionNode) {
    // new target molecule added, reset to initial phase description
    if (molecule === this.model.targetMolecule) {
      descriptionNode.innerContent = this.getInitialPhaseDescription(this.model.photonEmitterOnProperty.get(), this.model.photonWavelengthProperty.get(), this.model.photonTargetProperty.get());
    }

    // vibration
    molecule.currentVibrationRadiansProperty.lazyLink(vibrationRadians => {
      this.moleculeVibrating = molecule.vibratingProperty.get();
      if (this.moleculeVibrating) {
        this.wavelengthOnAbsorption = this.model.photonWavelengthProperty.get();
        descriptionNode.innerContent = this.activeMoleculeAlertManager.getVibrationPhaseDescription(vibrationRadians);
      }
    });

    // rotation
    molecule.rotatingProperty.lazyLink(rotating => {
      this.moleculeRotating = rotating;
      this.moleculeRotatingClockwise = molecule.rotationDirectionClockwiseProperty.get();
      if (rotating) {
        this.wavelengthOnAbsorption = this.model.photonWavelengthProperty.get();
        descriptionNode.innerContent = this.activeMoleculeAlertManager.getRotationPhaseDescription();
      }
    });

    // high electronic energy state (glowing)
    molecule.highElectronicEnergyStateProperty.lazyLink(highEnergy => {
      this.moleculeHighElectronicEnergyState = highEnergy;
      if (highEnergy) {
        this.wavelengthOnAbsorption = this.model.photonWavelengthProperty.get();
        descriptionNode.innerContent = this.activeMoleculeAlertManager.getHighElectronicEnergyPhaseDescription();
      }
    });

    // re-emission
    molecule.photonEmittedEmitter.addListener(photon => {
      descriptionNode.innerContent = this.getEmissionPhaseDescription(photon);
    });

    // break apart
    molecule.brokeApartEmitter.addListener((moleculeA, moleculeB) => {
      this.moleculeBrokeApart = true;
      this.wavelengthOnAbsorption = this.model.photonWavelengthProperty.get();
      const breakApartDescription = this.activeMoleculeAlertManager.getBreakApartPhaseDescription(moleculeA, moleculeB);
      const floatingAwayDescription = this.alertManager.getMoleculesFloatingAwayDescription(moleculeA, moleculeB);
      descriptionNode.innerContent = StringUtils.fillIn(breakApartDescriptionWithFloatPatternStringProperty.value, {
        description: breakApartDescription,
        floatDescription: floatingAwayDescription
      });
      const activeMolecules = this.model.activeMolecules;

      // When the constituent molecules are added to the list of active molecules, add a listener that
      // will describe their removal once they are removed - only needs to be added once on the
      // first addition of a constituent molecule. Must be added on molecule addition because they
      // do not exist in activeMolecules at the time of break apart.
      const addMoleculeRemovalListener = () => {
        const describeMoleculesRemoved = molecule => {
          // only update description if the removed molecule is one of the constituents after a break apart
          if (molecule === moleculeA || molecule === moleculeB) {
            // cant use this here because the active molecule
            if (!this.model.hasBothConstituentMolecules(moleculeA, moleculeB)) {
              descriptionNode.innerContent = moleculePiecesGoneStringProperty.value;
            }
          }
        };
        activeMolecules.addItemRemovedListener(describeMoleculesRemoved);

        // itemRemoved listener has been added, can remove the itemAdded listener immediately
        activeMolecules.removeItemAddedListener(addMoleculeRemovalListener);
      };
      activeMolecules.addItemAddedListener(addMoleculeRemovalListener);
    });
  }

  /**
   * Get the description of photon/molecule phase for initial interaction. This will be when photons
   * start to emit and are passing through the molecule. Once a photon is absorbed a new description strategy begins
   * where we describe the absorption.
   *
   * This description is specific to the summary of the observation window.
   * @private
   *
   * @param {boolean} emitterOn
   * @param {number} photonWavelength
   * @param {PhotonTarget} photonTarget
   * @returns {string}
   */
  getInitialPhaseDescription(emitterOn, photonWavelength, photonTarget) {
    const targetMolecule = this.model.targetMolecule;
    const lightSourceString = WavelengthConstants.getLightSourceName(photonWavelength);
    let targetString;
    if (targetMolecule) {
      targetString = StringUtils.fillIn(targetMoleculePatternStringProperty.value, {
        photonTarget: PhotonTarget.getMoleculeName(photonTarget)
      });
    } else {
      targetString = emptySpaceStringProperty.value;
    }
    if (!emitterOn) {
      // no photons moving, indicate to the user to begin firing photons
      return StringUtils.fillIn(photonEmitterOffDescriptionPatternStringProperty.value, {
        lightSource: lightSourceString,
        target: targetString
      });
    } else {
      return StringUtils.fillIn(inactiveAndPassesPhaseDescriptionPatternStringProperty.value, {
        lightSource: lightSourceString,
        target: targetString
      });
    }
  }

  /**
   * Get a description of the molecule after it emits a photon. Will return something like
   * "Absorbed Infrared photon emitted from Carbon Dioxide molecule up and to the left."
   * @private
   *
   * @param {Photon} photon - the emitted photon
   * @returns {string}
   */
  getEmissionPhaseDescription(photon) {
    const photonTargetString = PhotonTarget.getMoleculeName(this.model.photonTargetProperty.get());
    const lightSourceString = WavelengthConstants.getLightSourceName(photon.wavelength);
    const emissionAngle = Math.atan2(photon.vy, photon.vx);
    const directionString = MovementAlerter.getDirectionDescriptionFromAngle(emissionAngle, {
      modelViewTransform: this.modelViewTransform
    });
    return StringUtils.fillIn(emissionPhaseDescriptionPatternStringProperty.value, {
      photonTarget: photonTargetString,
      lightSource: lightSourceString,
      direction: directionString
    });
  }
}
greenhouseEffect.register('ObservationWindowDescriber', ObservationWindowDescriber);
export default ObservationWindowDescriber;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTdHJpbmdVdGlscyIsIk1vdmVtZW50QWxlcnRlciIsImdyZWVuaG91c2VFZmZlY3QiLCJHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncyIsIlBob3RvblRhcmdldCIsIldhdmVsZW5ndGhDb25zdGFudHMiLCJBY3RpdmVNb2xlY3VsZUFsZXJ0TWFuYWdlciIsIk9ic2VydmF0aW9uV2luZG93QWxlcnRNYW5hZ2VyIiwiZW1wdHlTcGFjZVN0cmluZ1Byb3BlcnR5IiwiYTExeSIsInBob3RvbkVtaXR0ZXJPZmZEZXNjcmlwdGlvblBhdHRlcm5TdHJpbmdQcm9wZXJ0eSIsInRhcmdldE1vbGVjdWxlUGF0dGVyblN0cmluZ1Byb3BlcnR5IiwiaW5hY3RpdmVBbmRQYXNzZXNQaGFzZURlc2NyaXB0aW9uUGF0dGVyblN0cmluZ1Byb3BlcnR5IiwiZW1pc3Npb25QaGFzZURlc2NyaXB0aW9uUGF0dGVyblN0cmluZ1Byb3BlcnR5IiwibW9sZWN1bGVQaWVjZXNHb25lU3RyaW5nUHJvcGVydHkiLCJicmVha0FwYXJ0RGVzY3JpcHRpb25XaXRoRmxvYXRQYXR0ZXJuU3RyaW5nUHJvcGVydHkiLCJPYnNlcnZhdGlvbldpbmRvd0Rlc2NyaWJlciIsImNvbnN0cnVjdG9yIiwibW9kZWwiLCJvYnNlcnZhdGlvbldpbmRvdyIsIm1vZGVsVmlld1RyYW5zZm9ybSIsIm1vbGVjdWxlVmlicmF0aW5nIiwibW9sZWN1bGVSb3RhdGluZyIsIm1vbGVjdWxlUm90YXRpbmdDbG9ja3dpc2UiLCJtb2xlY3VsZVJvdGF0aW5nQ291bnRlckNsb2Nrd2lzZSIsIm1vbGVjdWxlSGlnaEVsZWN0cm9uaWNFbmVyZ3lTdGF0ZSIsIm1vbGVjdWxlQnJva2VBcGFydCIsImFsZXJ0TWFuYWdlciIsImluaXRpYWxpemUiLCJyZXR1cm5Nb2xlY3VsZUJ1dHRvblZpc2libGVQcm9wZXJ0eSIsImFjdGl2ZU1vbGVjdWxlQWxlcnRNYW5hZ2VyIiwid2F2ZWxlbmd0aE9uQWJzb3JwdGlvbiIsInBob3RvbldhdmVsZW5ndGhQcm9wZXJ0eSIsImdldCIsInN0ZXAiLCJkdCIsImF0dGFjaEluaXRpYWxQaGFzZURlc2NyaXB0aW9uTGlzdGVuZXJzIiwiZGVzY3JpcHRpb25Ob2RlIiwibGluayIsInBob3RvbldhdmVsZW5ndGgiLCJ0YXJnZXRNb2xlY3VsZSIsImlubmVyQ29udGVudCIsImdldEluaXRpYWxQaGFzZURlc2NyaXB0aW9uIiwicGhvdG9uRW1pdHRlck9uUHJvcGVydHkiLCJwaG90b25UYXJnZXRQcm9wZXJ0eSIsIm9uIiwiYXR0YWNoQWJzb3JwdGlvbkRlc2NyaXB0aW9uTGlzdGVuZXJzIiwibW9sZWN1bGUiLCJjdXJyZW50VmlicmF0aW9uUmFkaWFuc1Byb3BlcnR5IiwibGF6eUxpbmsiLCJ2aWJyYXRpb25SYWRpYW5zIiwidmlicmF0aW5nUHJvcGVydHkiLCJnZXRWaWJyYXRpb25QaGFzZURlc2NyaXB0aW9uIiwicm90YXRpbmdQcm9wZXJ0eSIsInJvdGF0aW5nIiwicm90YXRpb25EaXJlY3Rpb25DbG9ja3dpc2VQcm9wZXJ0eSIsImdldFJvdGF0aW9uUGhhc2VEZXNjcmlwdGlvbiIsImhpZ2hFbGVjdHJvbmljRW5lcmd5U3RhdGVQcm9wZXJ0eSIsImhpZ2hFbmVyZ3kiLCJnZXRIaWdoRWxlY3Ryb25pY0VuZXJneVBoYXNlRGVzY3JpcHRpb24iLCJwaG90b25FbWl0dGVkRW1pdHRlciIsImFkZExpc3RlbmVyIiwicGhvdG9uIiwiZ2V0RW1pc3Npb25QaGFzZURlc2NyaXB0aW9uIiwiYnJva2VBcGFydEVtaXR0ZXIiLCJtb2xlY3VsZUEiLCJtb2xlY3VsZUIiLCJicmVha0FwYXJ0RGVzY3JpcHRpb24iLCJnZXRCcmVha0FwYXJ0UGhhc2VEZXNjcmlwdGlvbiIsImZsb2F0aW5nQXdheURlc2NyaXB0aW9uIiwiZ2V0TW9sZWN1bGVzRmxvYXRpbmdBd2F5RGVzY3JpcHRpb24iLCJmaWxsSW4iLCJ2YWx1ZSIsImRlc2NyaXB0aW9uIiwiZmxvYXREZXNjcmlwdGlvbiIsImFjdGl2ZU1vbGVjdWxlcyIsImFkZE1vbGVjdWxlUmVtb3ZhbExpc3RlbmVyIiwiZGVzY3JpYmVNb2xlY3VsZXNSZW1vdmVkIiwiaGFzQm90aENvbnN0aXR1ZW50TW9sZWN1bGVzIiwiYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciIsInJlbW92ZUl0ZW1BZGRlZExpc3RlbmVyIiwiYWRkSXRlbUFkZGVkTGlzdGVuZXIiLCJlbWl0dGVyT24iLCJwaG90b25UYXJnZXQiLCJsaWdodFNvdXJjZVN0cmluZyIsImdldExpZ2h0U291cmNlTmFtZSIsInRhcmdldFN0cmluZyIsImdldE1vbGVjdWxlTmFtZSIsImxpZ2h0U291cmNlIiwidGFyZ2V0IiwicGhvdG9uVGFyZ2V0U3RyaW5nIiwid2F2ZWxlbmd0aCIsImVtaXNzaW9uQW5nbGUiLCJNYXRoIiwiYXRhbjIiLCJ2eSIsInZ4IiwiZGlyZWN0aW9uU3RyaW5nIiwiZ2V0RGlyZWN0aW9uRGVzY3JpcHRpb25Gcm9tQW5nbGUiLCJkaXJlY3Rpb24iLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIk9ic2VydmF0aW9uV2luZG93RGVzY3JpYmVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIE1hbmFnZXMgUERPTSBjb250ZW50IHRoYXQgZGVzY3JpYmVzIHRoZSBNaWNyb09ic2VydmF0aW9uV2luZG93LiBUaGlzIGNvbnRhaW5zIGEgc2luZ2xlIGxpZ2h0IHNvdXJjZSwgYW5kIGEgdGFyZ2V0XHJcbiAqIG1vbGVjdWxlLiBUaGlzIHdpbGwgZGVzY3JpYmUgdGhlIHN0YXRlIG9mIHRoZSB0YXJnZXQgbW9sZWN1bGUgYXMgaXQgYWJzb3JicyBhbmQgZW1pdHMgcGhvdG9ucyBvciBicmVha3NcclxuICogYXBhcnQgaW50byBjb25zdGl0dWVudCBtb2xlY3VsZXMuXHJcbiAqXHJcbiAqIFdoZW4gdGhlIHBob3RvbiB3YXZlbGVuZ3RoIG9yIHRhcmdldCBtb2xlY3VsZSBjaGFuZ2VzLCB3ZSBkZXNjcmliZSBhbiBpbml0aWFsIHN0YXRlIHdoZXJlIHBob3RvbnNcclxuICogYXJlIHBhc3NpbmcgdGhyb3VnaCB0aGUgbW9sZWN1bGUuIEFzIHNvb24gYXMgYSBwaG90b24gaXMgYWJzb3JiZWQsIHdlIGRlc2NyaWJlIHRoZSBleGNpdGVkIHN0YXRlXHJcbiAqIG9mIHRoZSBtb2xlY3VsZSAodmlicmF0aW5nL2dsb3dpbmcvcm90YXRpbmcvZXRjLikuIE9uY2UgdGhlIHBob3RvbiBpcyByZS1lbWl0dGVkLCB0aGUgZ3JvdW5kIHN0YXRlXHJcbiAqIGVuZXJneSBwaGFzZSBpcyBkZXNjcmliZWQuIFRoZSBpbml0aWFsIHN0YXRlIGRlc2NyaXB0aW9uIGZvciBwaG90b25zIHBhc3NpbmcgdGhyb3VnaCB0aGUgbW9sZWN1bGUgaXNcclxuICogbm90IHJlLWFwcGxpZWQgdW50aWwgdGhlIHBob3RvbiB3YXZlbGVuZ3RoIG9yIHRhcmdldCBtb2xlY3VsZSBjaGFuZ2VzIGFnYWluLlxyXG4gKlxyXG4gKiBUT0RPOiBhY2Nlc3NpYmxlTmFtZSB3YXMgcmVwbGFjZWQgdGhyb3VnaG91dCB3aXRoIGlubmVyQ29udGVudCBiZWNhdXNlIG9mIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zY2VuZXJ5L2lzc3Vlcy8xMDI2XHJcbiAqIElmIHRoYXQgaXNzdWUgaXMgZml4ZWQsIGFjY2Vzc2libGVOYW1lIGNhbiBiZSB1c2VkIGFnYWluXHJcbiAqXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnXHJcbiAqL1xyXG5cclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCBNb3ZlbWVudEFsZXJ0ZXIgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL2FjY2Vzc2liaWxpdHkvZGVzY3JpYmVycy9Nb3ZlbWVudEFsZXJ0ZXIuanMnO1xyXG5pbXBvcnQgZ3JlZW5ob3VzZUVmZmVjdCBmcm9tICcuLi8uLi9ncmVlbmhvdXNlRWZmZWN0LmpzJztcclxuaW1wb3J0IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzIGZyb20gJy4uLy4uL0dyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmpzJztcclxuaW1wb3J0IFBob3RvblRhcmdldCBmcm9tICcuLi9tb2RlbC9QaG90b25UYXJnZXQuanMnO1xyXG5pbXBvcnQgV2F2ZWxlbmd0aENvbnN0YW50cyBmcm9tICcuLi9tb2RlbC9XYXZlbGVuZ3RoQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEFjdGl2ZU1vbGVjdWxlQWxlcnRNYW5hZ2VyIGZyb20gJy4vQWN0aXZlTW9sZWN1bGVBbGVydE1hbmFnZXIuanMnO1xyXG5pbXBvcnQgT2JzZXJ2YXRpb25XaW5kb3dBbGVydE1hbmFnZXIgZnJvbSAnLi9PYnNlcnZhdGlvbldpbmRvd0FsZXJ0TWFuYWdlci5qcyc7XHJcblxyXG5jb25zdCBlbXB0eVNwYWNlU3RyaW5nUHJvcGVydHkgPSBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5hMTF5LmVtcHR5U3BhY2VTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgcGhvdG9uRW1pdHRlck9mZkRlc2NyaXB0aW9uUGF0dGVyblN0cmluZ1Byb3BlcnR5ID0gR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuYTExeS5waG90b25FbWl0dGVyT2ZmRGVzY3JpcHRpb25QYXR0ZXJuU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHRhcmdldE1vbGVjdWxlUGF0dGVyblN0cmluZ1Byb3BlcnR5ID0gR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuYTExeS50YXJnZXRNb2xlY3VsZVBhdHRlcm5TdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgaW5hY3RpdmVBbmRQYXNzZXNQaGFzZURlc2NyaXB0aW9uUGF0dGVyblN0cmluZ1Byb3BlcnR5ID0gR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuYTExeS5pbmFjdGl2ZUFuZFBhc3Nlc1BoYXNlRGVzY3JpcHRpb25QYXR0ZXJuU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGVtaXNzaW9uUGhhc2VEZXNjcmlwdGlvblBhdHRlcm5TdHJpbmdQcm9wZXJ0eSA9IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmExMXkuZW1pc3Npb25QaGFzZURlc2NyaXB0aW9uUGF0dGVyblN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBtb2xlY3VsZVBpZWNlc0dvbmVTdHJpbmdQcm9wZXJ0eSA9IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmExMXkubW9sZWN1bGVQaWVjZXNHb25lU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGJyZWFrQXBhcnREZXNjcmlwdGlvbldpdGhGbG9hdFBhdHRlcm5TdHJpbmdQcm9wZXJ0eSA9IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmExMXkuYnJlYWtBcGFydERlc2NyaXB0aW9uV2l0aEZsb2F0UGF0dGVyblN0cmluZ1Byb3BlcnR5O1xyXG5cclxuY2xhc3MgT2JzZXJ2YXRpb25XaW5kb3dEZXNjcmliZXIge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1Bob3RvbkFic29ycHRpb25Nb2RlbH0gbW9kZWxcclxuICAgKiBAcGFyYW0ge01pY3JvT2JzZXJ2YXRpb25XaW5kb3d9IG9ic2VydmF0aW9uV2luZG93IC0gdGhlIEFsZXJ0TWFuYWdlciBzZW5kcyBhbGVydHMgdGhyb3VnaCB0aGlzIE5vZGVcclxuICAgKiBAcGFyYW0ge01vZGVsVmlld1RyYW5zZm9ybTJ9IG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBtb2RlbCwgb2JzZXJ2YXRpb25XaW5kb3csIG1vZGVsVmlld1RyYW5zZm9ybSApIHtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7UGhvdG9uQWJzb3JwdGlvbk1vZGVsfVxyXG4gICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtNb2RlbFZpZXdUcmFuc2Zvcm0yfSAtIHRvIGRlc2NyaWJlIHBob3RvbiBlbWlzc2lvbiBtb3Rpb24gaW4gc2NlbmVyeSBjb29yZGluYXRlIGZyYW1lXHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSA9IG1vZGVsVmlld1RyYW5zZm9ybTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7Ym9vbGVhbn0gLSBzdGF0ZSBvZiBtb2xlY3VsZSB3aGVuIHdlIGFic29yYiBhIHBob3RvbiwgdHJhY2tlZCBzbyB0aGF0IHdlIGNhbiBhY2N1cmF0ZWx5IGRlc2NyaWJlIHdoYXRcclxuICAgIC8vIHN0b3BzIGhhcHBlbmluZyB3aGVuIHRoZSBwaG90b24gaXMgcmUtZW1pdHRlZCAtIHRoZSBNb2xlY3VsZSBQcm9wZXJ0aWVzIHRyYWNraW5nIHRoZXNlIHRoaW5ncyBtYXkgaGF2ZSBhbHJlYWR5XHJcbiAgICAvLyByZXNldCB1cG9uIGVtaXNzaW9uIHNvIHRyYWNraW5nIHRoZXNlIGV4cGxpY2l0bHkgaXMgbW9yZSByb2J1c3RcclxuICAgIHRoaXMubW9sZWN1bGVWaWJyYXRpbmcgPSBmYWxzZTtcclxuICAgIHRoaXMubW9sZWN1bGVSb3RhdGluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5tb2xlY3VsZVJvdGF0aW5nQ2xvY2t3aXNlID0gZmFsc2U7XHJcbiAgICB0aGlzLm1vbGVjdWxlUm90YXRpbmdDb3VudGVyQ2xvY2t3aXNlID0gZmFsc2U7XHJcbiAgICB0aGlzLm1vbGVjdWxlSGlnaEVsZWN0cm9uaWNFbmVyZ3lTdGF0ZSA9IGZhbHNlO1xyXG4gICAgdGhpcy5tb2xlY3VsZUJyb2tlQXBhcnQgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSAtIHJlc3BvbnNpYmxlIGZvciBnZW5lcmFsIGFsZXJ0cyBpbnZvbHZpbmcgdGhpbmdzIGluIHRoZSBvYnNlcnZhdGlvbiB3aW5kb3dcclxuICAgIHRoaXMuYWxlcnRNYW5hZ2VyID0gbmV3IE9ic2VydmF0aW9uV2luZG93QWxlcnRNYW5hZ2VyKCBvYnNlcnZhdGlvbldpbmRvdyApO1xyXG4gICAgdGhpcy5hbGVydE1hbmFnZXIuaW5pdGlhbGl6ZSggbW9kZWwsIG9ic2VydmF0aW9uV2luZG93LnJldHVybk1vbGVjdWxlQnV0dG9uVmlzaWJsZVByb3BlcnR5ICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge0FjdGl2ZU1vbGVjdWxlQWxlcnRNYW5hZ2VyfSAtIHJlc3BvbnNpYmxlIGZvciBhbGVydHMgc3BlY2lmaWNhbGx5IHJlbGF0ZWQgdG8gcGhvdG9uL21vbGVjdWxlXHJcbiAgICAvLyBpbnRlcmFjdGlvblxyXG4gICAgdGhpcy5hY3RpdmVNb2xlY3VsZUFsZXJ0TWFuYWdlciA9IG5ldyBBY3RpdmVNb2xlY3VsZUFsZXJ0TWFuYWdlciggbW9kZWwsIG9ic2VydmF0aW9uV2luZG93LCBtb2RlbFZpZXdUcmFuc2Zvcm0gKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7bnVtYmVyfSB3aGlsZSBhIHBob3RvbiBpcyBhYnNvcmJlZCB0aGUgbW9kZWwgcGhvdG9uV2F2ZWxlbmd0aFByb3BlcnR5IG1heSBjaGFuZ2UgLSB3ZSB3YW50XHJcbiAgICAvLyB0byBkZXNjcmliZSB0aGUgYWJzb3JiZWQgcGhvdG9uIG5vdCB0aGUgcGhvdG9uIHdhdmVsZW5ndGggY3VycmVudGx5IGJlaW5nIGVtaXR0ZWRcclxuICAgIHRoaXMud2F2ZWxlbmd0aE9uQWJzb3JwdGlvbiA9IG1vZGVsLnBob3RvbldhdmVsZW5ndGhQcm9wZXJ0eS5nZXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0ZXAgdGhlIGFsZXJ0IG1hbmF0ZXIgaW4gdGltZS5cclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHQgLSBpbiBzZWNvbmRzXHJcbiAgICovXHJcbiAgc3RlcCggZHQgKSB7XHJcbiAgICB0aGlzLmFjdGl2ZU1vbGVjdWxlQWxlcnRNYW5hZ2VyLnN0ZXAoIGR0ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBdHRhY2ggbGlzdGVuZXJzIHRvIHRoaXMgUGhvdG9uQWJzb3JwdGlvbk1vZGVsIHRoYXQgd2lsbCBzZXQgdGhlIGRlc2NyaXB0aW9uIGNvbnRlbnQgb24gdGhlIHByb3ZpZGVkIE5vZGVcclxuICAgKiB0aGF0IGRlc2NyaWJlcyB0aGUgXCJpbml0aWFsXCIgcGhhc2Ugd2hlcmUgcGhvdG9ucyBhcmUgcGFzc2luZyB0aHJvdWdoIHRoZSBtb2xlY3VsZS5cclxuICAgKlxyXG4gICAqIFdoZW4gdGhlIHBob3RvbiB3YXZlbGVuZ3RoIGNoYW5nZXMgb3IgdGhlIGxpZ2h0IHNvdXJjZSBzbGlkZXIgdHVybnMgb24gb3Igb2ZmLCB3ZSBnbyBiYWNrIHRvIGRlc2NyaWJpbmdcclxuICAgKiB0aGUgaW5pdGlhbCBwaGFzZSB3aGVyZSBwaG90b25zIHBhc3MgdGhyb3VnaCB0aGUgbW9sZWN1bGUuIFRoZSBvbmx5IGV4Y2VwdGlvbiBpcyB3aGVuIHRoZXJlIGlzIG5vIHRhcmdldFxyXG4gICAqIG1vbGVjdWxlIC0gaW4gdGhpcyBjYXNlIHdlIGtlZXAgdGhlIGRlc2NyaXB0aW9uIHRoYXQgZ3VpZGVzIHRoZSB1c2VyIHRvIHRoZSAncmV0dXJuIG1vbGVjdWxlJyBidXR0b24uXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHtOb2RlfSBkZXNjcmlwdGlvbk5vZGVcclxuICAgKi9cclxuICBhdHRhY2hJbml0aWFsUGhhc2VEZXNjcmlwdGlvbkxpc3RlbmVycyggZGVzY3JpcHRpb25Ob2RlICkge1xyXG4gICAgdGhpcy5tb2RlbC5waG90b25XYXZlbGVuZ3RoUHJvcGVydHkubGluayggcGhvdG9uV2F2ZWxlbmd0aCA9PiB7XHJcbiAgICAgIGlmICggdGhpcy5tb2RlbC50YXJnZXRNb2xlY3VsZSApIHtcclxuICAgICAgICBkZXNjcmlwdGlvbk5vZGUuaW5uZXJDb250ZW50ID0gdGhpcy5nZXRJbml0aWFsUGhhc2VEZXNjcmlwdGlvbiggdGhpcy5tb2RlbC5waG90b25FbWl0dGVyT25Qcm9wZXJ0eS5nZXQoKSwgcGhvdG9uV2F2ZWxlbmd0aCwgdGhpcy5tb2RlbC5waG90b25UYXJnZXRQcm9wZXJ0eS5nZXQoKSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gd2hlbiB0aGUgbW9sZWN1bGUgdHVybnMgb24gb3Igb2ZmLCByZXNldCBkZXNjcmlwdGlvbiBjb250ZW50IHRvIGluaXRpYWwgZGVzY3JpcHRpb25cclxuICAgIHRoaXMubW9kZWwucGhvdG9uRW1pdHRlck9uUHJvcGVydHkubGluayggb24gPT4ge1xyXG4gICAgICBpZiAoIHRoaXMubW9kZWwudGFyZ2V0TW9sZWN1bGUgKSB7XHJcbiAgICAgICAgZGVzY3JpcHRpb25Ob2RlLmlubmVyQ29udGVudCA9IHRoaXMuZ2V0SW5pdGlhbFBoYXNlRGVzY3JpcHRpb24oIG9uLCB0aGlzLm1vZGVsLnBob3RvbldhdmVsZW5ndGhQcm9wZXJ0eS5nZXQoKSwgdGhpcy5tb2RlbC5waG90b25UYXJnZXRQcm9wZXJ0eS5nZXQoKSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBdHRhY2ggbGlzdGVuZXJzIHRvIGEgTW9sZWN1bGUgdGhhdCB3aWxsIHVwZGF0ZSBhIHByb3ZpZGVkIE5vZGUncyBkZXNjcmlwdGlvbiBjb250ZW50LiBUaGVzZSBQcm9wZXJ0aWVzXHJcbiAgICogYXJlIGZ1bGx5IGRpc3Bvc2VkIHdoZW4gdGhlIG1vbGVjdWxlIGlzIGRpc3Bvc2VkIHNvIGxpc3RlbmVyIHJlbW92YWwgc2hvdWxkIG5vdCBiZSBuZWNlc3NhcnkuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHtNb2xlY3VsZX0gbW9sZWN1bGVcclxuICAgKiBAcGFyYW0ge05vZGV9IGRlc2NyaXB0aW9uTm9kZVxyXG4gICAqL1xyXG4gIGF0dGFjaEFic29ycHRpb25EZXNjcmlwdGlvbkxpc3RlbmVycyggbW9sZWN1bGUsIGRlc2NyaXB0aW9uTm9kZSApIHtcclxuXHJcbiAgICAvLyBuZXcgdGFyZ2V0IG1vbGVjdWxlIGFkZGVkLCByZXNldCB0byBpbml0aWFsIHBoYXNlIGRlc2NyaXB0aW9uXHJcbiAgICBpZiAoIG1vbGVjdWxlID09PSB0aGlzLm1vZGVsLnRhcmdldE1vbGVjdWxlICkge1xyXG4gICAgICBkZXNjcmlwdGlvbk5vZGUuaW5uZXJDb250ZW50ID0gdGhpcy5nZXRJbml0aWFsUGhhc2VEZXNjcmlwdGlvbiggdGhpcy5tb2RlbC5waG90b25FbWl0dGVyT25Qcm9wZXJ0eS5nZXQoKSwgdGhpcy5tb2RlbC5waG90b25XYXZlbGVuZ3RoUHJvcGVydHkuZ2V0KCksIHRoaXMubW9kZWwucGhvdG9uVGFyZ2V0UHJvcGVydHkuZ2V0KCkgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyB2aWJyYXRpb25cclxuICAgIG1vbGVjdWxlLmN1cnJlbnRWaWJyYXRpb25SYWRpYW5zUHJvcGVydHkubGF6eUxpbmsoIHZpYnJhdGlvblJhZGlhbnMgPT4ge1xyXG4gICAgICB0aGlzLm1vbGVjdWxlVmlicmF0aW5nID0gbW9sZWN1bGUudmlicmF0aW5nUHJvcGVydHkuZ2V0KCk7XHJcblxyXG4gICAgICBpZiAoIHRoaXMubW9sZWN1bGVWaWJyYXRpbmcgKSB7XHJcbiAgICAgICAgdGhpcy53YXZlbGVuZ3RoT25BYnNvcnB0aW9uID0gdGhpcy5tb2RlbC5waG90b25XYXZlbGVuZ3RoUHJvcGVydHkuZ2V0KCk7XHJcbiAgICAgICAgZGVzY3JpcHRpb25Ob2RlLmlubmVyQ29udGVudCA9IHRoaXMuYWN0aXZlTW9sZWN1bGVBbGVydE1hbmFnZXIuZ2V0VmlicmF0aW9uUGhhc2VEZXNjcmlwdGlvbiggdmlicmF0aW9uUmFkaWFucyApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gcm90YXRpb25cclxuICAgIG1vbGVjdWxlLnJvdGF0aW5nUHJvcGVydHkubGF6eUxpbmsoIHJvdGF0aW5nID0+IHtcclxuICAgICAgdGhpcy5tb2xlY3VsZVJvdGF0aW5nID0gcm90YXRpbmc7XHJcbiAgICAgIHRoaXMubW9sZWN1bGVSb3RhdGluZ0Nsb2Nrd2lzZSA9IG1vbGVjdWxlLnJvdGF0aW9uRGlyZWN0aW9uQ2xvY2t3aXNlUHJvcGVydHkuZ2V0KCk7XHJcblxyXG4gICAgICBpZiAoIHJvdGF0aW5nICkge1xyXG4gICAgICAgIHRoaXMud2F2ZWxlbmd0aE9uQWJzb3JwdGlvbiA9IHRoaXMubW9kZWwucGhvdG9uV2F2ZWxlbmd0aFByb3BlcnR5LmdldCgpO1xyXG4gICAgICAgIGRlc2NyaXB0aW9uTm9kZS5pbm5lckNvbnRlbnQgPSB0aGlzLmFjdGl2ZU1vbGVjdWxlQWxlcnRNYW5hZ2VyLmdldFJvdGF0aW9uUGhhc2VEZXNjcmlwdGlvbigpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gaGlnaCBlbGVjdHJvbmljIGVuZXJneSBzdGF0ZSAoZ2xvd2luZylcclxuICAgIG1vbGVjdWxlLmhpZ2hFbGVjdHJvbmljRW5lcmd5U3RhdGVQcm9wZXJ0eS5sYXp5TGluayggaGlnaEVuZXJneSA9PiB7XHJcbiAgICAgIHRoaXMubW9sZWN1bGVIaWdoRWxlY3Ryb25pY0VuZXJneVN0YXRlID0gaGlnaEVuZXJneTtcclxuXHJcbiAgICAgIGlmICggaGlnaEVuZXJneSApIHtcclxuICAgICAgICB0aGlzLndhdmVsZW5ndGhPbkFic29ycHRpb24gPSB0aGlzLm1vZGVsLnBob3RvbldhdmVsZW5ndGhQcm9wZXJ0eS5nZXQoKTtcclxuICAgICAgICBkZXNjcmlwdGlvbk5vZGUuaW5uZXJDb250ZW50ID0gdGhpcy5hY3RpdmVNb2xlY3VsZUFsZXJ0TWFuYWdlci5nZXRIaWdoRWxlY3Ryb25pY0VuZXJneVBoYXNlRGVzY3JpcHRpb24oKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHJlLWVtaXNzaW9uXHJcbiAgICBtb2xlY3VsZS5waG90b25FbWl0dGVkRW1pdHRlci5hZGRMaXN0ZW5lciggcGhvdG9uID0+IHtcclxuICAgICAgZGVzY3JpcHRpb25Ob2RlLmlubmVyQ29udGVudCA9IHRoaXMuZ2V0RW1pc3Npb25QaGFzZURlc2NyaXB0aW9uKCBwaG90b24gKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBicmVhayBhcGFydFxyXG4gICAgbW9sZWN1bGUuYnJva2VBcGFydEVtaXR0ZXIuYWRkTGlzdGVuZXIoICggbW9sZWN1bGVBLCBtb2xlY3VsZUIgKSA9PiB7XHJcbiAgICAgIHRoaXMubW9sZWN1bGVCcm9rZUFwYXJ0ID0gdHJ1ZTtcclxuICAgICAgdGhpcy53YXZlbGVuZ3RoT25BYnNvcnB0aW9uID0gdGhpcy5tb2RlbC5waG90b25XYXZlbGVuZ3RoUHJvcGVydHkuZ2V0KCk7XHJcblxyXG4gICAgICBjb25zdCBicmVha0FwYXJ0RGVzY3JpcHRpb24gPSB0aGlzLmFjdGl2ZU1vbGVjdWxlQWxlcnRNYW5hZ2VyLmdldEJyZWFrQXBhcnRQaGFzZURlc2NyaXB0aW9uKCBtb2xlY3VsZUEsIG1vbGVjdWxlQiApO1xyXG4gICAgICBjb25zdCBmbG9hdGluZ0F3YXlEZXNjcmlwdGlvbiA9IHRoaXMuYWxlcnRNYW5hZ2VyLmdldE1vbGVjdWxlc0Zsb2F0aW5nQXdheURlc2NyaXB0aW9uKCBtb2xlY3VsZUEsIG1vbGVjdWxlQiApO1xyXG5cclxuICAgICAgZGVzY3JpcHRpb25Ob2RlLmlubmVyQ29udGVudCA9IFN0cmluZ1V0aWxzLmZpbGxJbiggYnJlYWtBcGFydERlc2NyaXB0aW9uV2l0aEZsb2F0UGF0dGVyblN0cmluZ1Byb3BlcnR5LnZhbHVlLCB7XHJcbiAgICAgICAgZGVzY3JpcHRpb246IGJyZWFrQXBhcnREZXNjcmlwdGlvbixcclxuICAgICAgICBmbG9hdERlc2NyaXB0aW9uOiBmbG9hdGluZ0F3YXlEZXNjcmlwdGlvblxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICBjb25zdCBhY3RpdmVNb2xlY3VsZXMgPSB0aGlzLm1vZGVsLmFjdGl2ZU1vbGVjdWxlcztcclxuXHJcbiAgICAgIC8vIFdoZW4gdGhlIGNvbnN0aXR1ZW50IG1vbGVjdWxlcyBhcmUgYWRkZWQgdG8gdGhlIGxpc3Qgb2YgYWN0aXZlIG1vbGVjdWxlcywgYWRkIGEgbGlzdGVuZXIgdGhhdFxyXG4gICAgICAvLyB3aWxsIGRlc2NyaWJlIHRoZWlyIHJlbW92YWwgb25jZSB0aGV5IGFyZSByZW1vdmVkIC0gb25seSBuZWVkcyB0byBiZSBhZGRlZCBvbmNlIG9uIHRoZVxyXG4gICAgICAvLyBmaXJzdCBhZGRpdGlvbiBvZiBhIGNvbnN0aXR1ZW50IG1vbGVjdWxlLiBNdXN0IGJlIGFkZGVkIG9uIG1vbGVjdWxlIGFkZGl0aW9uIGJlY2F1c2UgdGhleVxyXG4gICAgICAvLyBkbyBub3QgZXhpc3QgaW4gYWN0aXZlTW9sZWN1bGVzIGF0IHRoZSB0aW1lIG9mIGJyZWFrIGFwYXJ0LlxyXG4gICAgICBjb25zdCBhZGRNb2xlY3VsZVJlbW92YWxMaXN0ZW5lciA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBkZXNjcmliZU1vbGVjdWxlc1JlbW92ZWQgPSBtb2xlY3VsZSA9PiB7XHJcblxyXG4gICAgICAgICAgLy8gb25seSB1cGRhdGUgZGVzY3JpcHRpb24gaWYgdGhlIHJlbW92ZWQgbW9sZWN1bGUgaXMgb25lIG9mIHRoZSBjb25zdGl0dWVudHMgYWZ0ZXIgYSBicmVhayBhcGFydFxyXG4gICAgICAgICAgaWYgKCBtb2xlY3VsZSA9PT0gbW9sZWN1bGVBIHx8IG1vbGVjdWxlID09PSBtb2xlY3VsZUIgKSB7XHJcblxyXG4gICAgICAgICAgICAvLyBjYW50IHVzZSB0aGlzIGhlcmUgYmVjYXVzZSB0aGUgYWN0aXZlIG1vbGVjdWxlXHJcbiAgICAgICAgICAgIGlmICggIXRoaXMubW9kZWwuaGFzQm90aENvbnN0aXR1ZW50TW9sZWN1bGVzKCBtb2xlY3VsZUEsIG1vbGVjdWxlQiApICkge1xyXG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uTm9kZS5pbm5lckNvbnRlbnQgPSBtb2xlY3VsZVBpZWNlc0dvbmVTdHJpbmdQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGFjdGl2ZU1vbGVjdWxlcy5hZGRJdGVtUmVtb3ZlZExpc3RlbmVyKCBkZXNjcmliZU1vbGVjdWxlc1JlbW92ZWQgKTtcclxuXHJcbiAgICAgICAgLy8gaXRlbVJlbW92ZWQgbGlzdGVuZXIgaGFzIGJlZW4gYWRkZWQsIGNhbiByZW1vdmUgdGhlIGl0ZW1BZGRlZCBsaXN0ZW5lciBpbW1lZGlhdGVseVxyXG4gICAgICAgIGFjdGl2ZU1vbGVjdWxlcy5yZW1vdmVJdGVtQWRkZWRMaXN0ZW5lciggYWRkTW9sZWN1bGVSZW1vdmFsTGlzdGVuZXIgKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGFjdGl2ZU1vbGVjdWxlcy5hZGRJdGVtQWRkZWRMaXN0ZW5lciggYWRkTW9sZWN1bGVSZW1vdmFsTGlzdGVuZXIgKTtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgZGVzY3JpcHRpb24gb2YgcGhvdG9uL21vbGVjdWxlIHBoYXNlIGZvciBpbml0aWFsIGludGVyYWN0aW9uLiBUaGlzIHdpbGwgYmUgd2hlbiBwaG90b25zXHJcbiAgICogc3RhcnQgdG8gZW1pdCBhbmQgYXJlIHBhc3NpbmcgdGhyb3VnaCB0aGUgbW9sZWN1bGUuIE9uY2UgYSBwaG90b24gaXMgYWJzb3JiZWQgYSBuZXcgZGVzY3JpcHRpb24gc3RyYXRlZ3kgYmVnaW5zXHJcbiAgICogd2hlcmUgd2UgZGVzY3JpYmUgdGhlIGFic29ycHRpb24uXHJcbiAgICpcclxuICAgKiBUaGlzIGRlc2NyaXB0aW9uIGlzIHNwZWNpZmljIHRvIHRoZSBzdW1tYXJ5IG9mIHRoZSBvYnNlcnZhdGlvbiB3aW5kb3cuXHJcbiAgICogQHByaXZhdGVcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gZW1pdHRlck9uXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHBob3RvbldhdmVsZW5ndGhcclxuICAgKiBAcGFyYW0ge1Bob3RvblRhcmdldH0gcGhvdG9uVGFyZ2V0XHJcbiAgICogQHJldHVybnMge3N0cmluZ31cclxuICAgKi9cclxuICBnZXRJbml0aWFsUGhhc2VEZXNjcmlwdGlvbiggZW1pdHRlck9uLCBwaG90b25XYXZlbGVuZ3RoLCBwaG90b25UYXJnZXQgKSB7XHJcbiAgICBjb25zdCB0YXJnZXRNb2xlY3VsZSA9IHRoaXMubW9kZWwudGFyZ2V0TW9sZWN1bGU7XHJcblxyXG4gICAgY29uc3QgbGlnaHRTb3VyY2VTdHJpbmcgPSBXYXZlbGVuZ3RoQ29uc3RhbnRzLmdldExpZ2h0U291cmNlTmFtZSggcGhvdG9uV2F2ZWxlbmd0aCApO1xyXG5cclxuICAgIGxldCB0YXJnZXRTdHJpbmc7XHJcbiAgICBpZiAoIHRhcmdldE1vbGVjdWxlICkge1xyXG4gICAgICB0YXJnZXRTdHJpbmcgPSBTdHJpbmdVdGlscy5maWxsSW4oIHRhcmdldE1vbGVjdWxlUGF0dGVyblN0cmluZ1Byb3BlcnR5LnZhbHVlLCB7XHJcbiAgICAgICAgcGhvdG9uVGFyZ2V0OiBQaG90b25UYXJnZXQuZ2V0TW9sZWN1bGVOYW1lKCBwaG90b25UYXJnZXQgKVxyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgdGFyZ2V0U3RyaW5nID0gZW1wdHlTcGFjZVN0cmluZ1Byb3BlcnR5LnZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICggIWVtaXR0ZXJPbiApIHtcclxuXHJcbiAgICAgIC8vIG5vIHBob3RvbnMgbW92aW5nLCBpbmRpY2F0ZSB0byB0aGUgdXNlciB0byBiZWdpbiBmaXJpbmcgcGhvdG9uc1xyXG4gICAgICByZXR1cm4gU3RyaW5nVXRpbHMuZmlsbEluKCBwaG90b25FbWl0dGVyT2ZmRGVzY3JpcHRpb25QYXR0ZXJuU3RyaW5nUHJvcGVydHkudmFsdWUsIHtcclxuICAgICAgICBsaWdodFNvdXJjZTogbGlnaHRTb3VyY2VTdHJpbmcsXHJcbiAgICAgICAgdGFyZ2V0OiB0YXJnZXRTdHJpbmdcclxuICAgICAgfSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHJldHVybiBTdHJpbmdVdGlscy5maWxsSW4oIGluYWN0aXZlQW5kUGFzc2VzUGhhc2VEZXNjcmlwdGlvblBhdHRlcm5TdHJpbmdQcm9wZXJ0eS52YWx1ZSwge1xyXG4gICAgICAgIGxpZ2h0U291cmNlOiBsaWdodFNvdXJjZVN0cmluZyxcclxuICAgICAgICB0YXJnZXQ6IHRhcmdldFN0cmluZ1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYSBkZXNjcmlwdGlvbiBvZiB0aGUgbW9sZWN1bGUgYWZ0ZXIgaXQgZW1pdHMgYSBwaG90b24uIFdpbGwgcmV0dXJuIHNvbWV0aGluZyBsaWtlXHJcbiAgICogXCJBYnNvcmJlZCBJbmZyYXJlZCBwaG90b24gZW1pdHRlZCBmcm9tIENhcmJvbiBEaW94aWRlIG1vbGVjdWxlIHVwIGFuZCB0byB0aGUgbGVmdC5cIlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge1Bob3Rvbn0gcGhvdG9uIC0gdGhlIGVtaXR0ZWQgcGhvdG9uXHJcbiAgICogQHJldHVybnMge3N0cmluZ31cclxuICAgKi9cclxuICBnZXRFbWlzc2lvblBoYXNlRGVzY3JpcHRpb24oIHBob3RvbiApIHtcclxuICAgIGNvbnN0IHBob3RvblRhcmdldFN0cmluZyA9IFBob3RvblRhcmdldC5nZXRNb2xlY3VsZU5hbWUoIHRoaXMubW9kZWwucGhvdG9uVGFyZ2V0UHJvcGVydHkuZ2V0KCkgKTtcclxuICAgIGNvbnN0IGxpZ2h0U291cmNlU3RyaW5nID0gV2F2ZWxlbmd0aENvbnN0YW50cy5nZXRMaWdodFNvdXJjZU5hbWUoIHBob3Rvbi53YXZlbGVuZ3RoICk7XHJcblxyXG4gICAgY29uc3QgZW1pc3Npb25BbmdsZSA9IE1hdGguYXRhbjIoIHBob3Rvbi52eSwgcGhvdG9uLnZ4ICk7XHJcbiAgICBjb25zdCBkaXJlY3Rpb25TdHJpbmcgPSBNb3ZlbWVudEFsZXJ0ZXIuZ2V0RGlyZWN0aW9uRGVzY3JpcHRpb25Gcm9tQW5nbGUoIGVtaXNzaW9uQW5nbGUsIHtcclxuICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtOiB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAgfSApO1xyXG5cclxuICAgIHJldHVybiBTdHJpbmdVdGlscy5maWxsSW4oIGVtaXNzaW9uUGhhc2VEZXNjcmlwdGlvblBhdHRlcm5TdHJpbmdQcm9wZXJ0eS52YWx1ZSwge1xyXG4gICAgICBwaG90b25UYXJnZXQ6IHBob3RvblRhcmdldFN0cmluZyxcclxuICAgICAgbGlnaHRTb3VyY2U6IGxpZ2h0U291cmNlU3RyaW5nLFxyXG4gICAgICBkaXJlY3Rpb246IGRpcmVjdGlvblN0cmluZ1xyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxuZ3JlZW5ob3VzZUVmZmVjdC5yZWdpc3RlciggJ09ic2VydmF0aW9uV2luZG93RGVzY3JpYmVyJywgT2JzZXJ2YXRpb25XaW5kb3dEZXNjcmliZXIgKTtcclxuZXhwb3J0IGRlZmF1bHQgT2JzZXJ2YXRpb25XaW5kb3dEZXNjcmliZXI7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxXQUFXLE1BQU0sK0NBQStDO0FBQ3ZFLE9BQU9DLGVBQWUsTUFBTSx5RUFBeUU7QUFDckcsT0FBT0MsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBQ3hELE9BQU9DLHVCQUF1QixNQUFNLGtDQUFrQztBQUN0RSxPQUFPQyxZQUFZLE1BQU0sMEJBQTBCO0FBQ25ELE9BQU9DLG1CQUFtQixNQUFNLGlDQUFpQztBQUNqRSxPQUFPQywwQkFBMEIsTUFBTSxpQ0FBaUM7QUFDeEUsT0FBT0MsNkJBQTZCLE1BQU0sb0NBQW9DO0FBRTlFLE1BQU1DLHdCQUF3QixHQUFHTCx1QkFBdUIsQ0FBQ00sSUFBSSxDQUFDRCx3QkFBd0I7QUFDdEYsTUFBTUUsZ0RBQWdELEdBQUdQLHVCQUF1QixDQUFDTSxJQUFJLENBQUNDLGdEQUFnRDtBQUN0SSxNQUFNQyxtQ0FBbUMsR0FBR1IsdUJBQXVCLENBQUNNLElBQUksQ0FBQ0UsbUNBQW1DO0FBQzVHLE1BQU1DLHNEQUFz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