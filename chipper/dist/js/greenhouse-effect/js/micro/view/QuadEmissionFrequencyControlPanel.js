// Copyright 2021-2022, University of Colorado Boulder

/**
 * This is a control panel that is intended for use in the play area and that allows the setting of 4 different photon
 * emission frequencies.
 *
 * @author John Blanco (PhET Interactive Simulations)
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { HBox, Image, Node, Text } from '../../../../scenery/js/imports.js';
import RectangularRadioButtonGroup from '../../../../sun/js/buttons/RectangularRadioButtonGroup.js';
import multiSelectionSoundPlayerFactory from '../../../../tambo/js/multiSelectionSoundPlayerFactory.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import flashlight_png from '../../../mipmaps/flashlight_png.js';
import infraredSource_png from '../../../mipmaps/infraredSource_png.js';
import microwaveSource_png from '../../../mipmaps/microwaveSource_png.js';
import uvSource_png from '../../../mipmaps/uvSource_png.js';
import greenhouseEffect from '../../greenhouseEffect.js';
import GreenhouseEffectStrings from '../../GreenhouseEffectStrings.js';
import MicroPhoton from '../model/MicroPhoton.js';
import WavelengthConstants from '../model/WavelengthConstants.js';
import MicroPhotonNode from './MicroPhotonNode.js';
const quadWavelengthSelectorHigherEnergyStringProperty = GreenhouseEffectStrings.QuadWavelengthSelector.HigherEnergyStringProperty;
const quadWavelengthSelectorInfraredStringProperty = GreenhouseEffectStrings.QuadWavelengthSelector.InfraredStringProperty;
const quadWavelengthSelectorMicrowaveStringProperty = GreenhouseEffectStrings.QuadWavelengthSelector.MicrowaveStringProperty;
const quadWavelengthSelectorUltravioletStringProperty = GreenhouseEffectStrings.QuadWavelengthSelector.UltravioletStringProperty;
const quadWavelengthSelectorVisibleStringProperty = GreenhouseEffectStrings.QuadWavelengthSelector.VisibleStringProperty;
const lightSourcesStringProperty = GreenhouseEffectStrings.a11y.lightSourcesStringProperty;
const lightSourceRadioButtonHelpTextStringProperty = GreenhouseEffectStrings.a11y.lightSourceRadioButtonHelpTextStringProperty;

// Description data for the 'Energy Arrow'
const ARROW_LENGTH = 200;
const ARROW_HEAD_HEIGHT = 15;
const ARROW_HEAD_WIDTH = 20;
const ARROW_TAIL_WIDTH = 1;
const ARROW_COLOR = 'black';

// Create a layout box which holds a single panel of this control panel.
const createRadioButtonContent = (emitterImage, photonNode) => {
  emitterImage.scale(0.27); // Scale emitter image to fit in the panel, scale factor determined empirically.
  return new HBox({
    spacing: 10,
    children: [emitterImage, photonNode]
  });
};
class QuadEmissionFrequencyControlPanel extends Node {
  /**
   * Constructor for the control panel of emitted photon frequency.
   *
   * @param {PhotonAbsorptionModel} photonAbsorptionModel
   * @param {Tandem} tandem
   */
  constructor(photonAbsorptionModel, tandem) {
    // Supertype constructor
    super({
      tagName: 'div',
      labelTagName: 'h3',
      labelContent: lightSourcesStringProperty.value,
      descriptionContent: lightSourceRadioButtonHelpTextStringProperty.value
    });

    // Initialize the photon nodes for the control panel.  Identity model view transform is used because these photon
    // nodes do not correspond to anything in the model.  They are just visual elements of the control panel.
    const identityTransform = ModelViewTransform2.createIdentity();
    const microwavePhotonNode = new MicroPhotonNode(new MicroPhoton(WavelengthConstants.MICRO_WAVELENGTH, {
      tandem: Tandem.OPT_OUT
    }), identityTransform);
    const infraredPhotonNode = new MicroPhotonNode(new MicroPhoton(WavelengthConstants.IR_WAVELENGTH, {
      tandem: Tandem.OPT_OUT
    }), identityTransform);
    const visiblePhotonNode = new MicroPhotonNode(new MicroPhoton(WavelengthConstants.VISIBLE_WAVELENGTH, {
      tandem: Tandem.OPT_OUT
    }), identityTransform);
    const ultravioletPhotonNode = new MicroPhotonNode(new MicroPhoton(WavelengthConstants.UV_WAVELENGTH, {
      tandem: Tandem.OPT_OUT
    }), identityTransform);

    // Load the radio button content into an array of object literals which holds the node, label string, and
    // value for each button.
    const labelFont = new PhetFont(18);

    // This is sort of hack to pass through the tandem of the radioButtonGroupMember to its child.
    const microwaveTandemName = 'microwaveRadioButton';
    const infraredTandemName = 'infraredRadioButton';
    const visibleTandemName = 'visibleRadioButton';
    const ultravioletTandemName = 'ultravioletRadioButton';
    const radioButtonGroupTandem = tandem.createTandem('radioButtonGroup');
    const microwaveRadioButtonContent = createRadioButtonContent(new Image(microwaveSource_png), microwavePhotonNode);
    const infraredPhotonRadioButtonContent = createRadioButtonContent(new Image(infraredSource_png), infraredPhotonNode);
    const visiblePhotonRadioButtonContent = createRadioButtonContent(new Image(flashlight_png), visiblePhotonNode);
    const ultravioletPhotonRadioButtonContent = createRadioButtonContent(new Image(uvSource_png), ultravioletPhotonNode);
    const radioButtonContent = [{
      createNode: () => microwaveRadioButtonContent,
      value: WavelengthConstants.MICRO_WAVELENGTH,
      label: new Text(quadWavelengthSelectorMicrowaveStringProperty, {
        font: labelFont,
        tandem: radioButtonGroupTandem.createTandem(microwaveTandemName).createTandem('microwaveRadioButtonLabelText')
      }),
      tandemName: microwaveTandemName,
      labelContent: quadWavelengthSelectorMicrowaveStringProperty.value
    }, {
      createNode: () => infraredPhotonRadioButtonContent,
      value: WavelengthConstants.IR_WAVELENGTH,
      label: new Text(quadWavelengthSelectorInfraredStringProperty, {
        font: labelFont,
        tandem: radioButtonGroupTandem.createTandem(infraredTandemName).createTandem('infraredRadioButtonLabelText')
      }),
      tandemName: infraredTandemName,
      labelContent: quadWavelengthSelectorInfraredStringProperty.value
    }, {
      createNode: () => visiblePhotonRadioButtonContent,
      value: WavelengthConstants.VISIBLE_WAVELENGTH,
      label: new Text(quadWavelengthSelectorVisibleStringProperty, {
        font: labelFont,
        tandem: radioButtonGroupTandem.createTandem(visibleTandemName).createTandem('visibleRadioButtonLabelText')
      }),
      tandemName: visibleTandemName,
      labelContent: quadWavelengthSelectorVisibleStringProperty.value
    }, {
      createNode: () => ultravioletPhotonRadioButtonContent,
      value: WavelengthConstants.UV_WAVELENGTH,
      label: new Text(quadWavelengthSelectorUltravioletStringProperty, {
        font: labelFont,
        tandem: radioButtonGroupTandem.createTandem(ultravioletTandemName).createTandem('ultravioletRadioButtonLabelText')
      }),
      tandemName: ultravioletTandemName,
      labelContent: quadWavelengthSelectorUltravioletStringProperty.value
    }];

    // Scale the radio button text.  This is done mostly to support translations.
    // Determine the max width of panels in the radio button group.
    const panelWidth = _.maxBy([microwaveRadioButtonContent, infraredPhotonRadioButtonContent, visiblePhotonRadioButtonContent, ultravioletPhotonRadioButtonContent], content => content.width).width;

    // Calculate the minimum scale factor that must be applied to each label. Ensures constant font size for all labels.
    let scaleFactor = 1;
    _.each(radioButtonContent, content => {
      const labelWidth = content.label.width;
      scaleFactor = Math.min(scaleFactor, panelWidth / labelWidth);
    });

    // If necessary, scale down each label by the minimum scale value.
    if (scaleFactor < 1) {
      _.each(radioButtonContent, content => {
        content.label.scale(scaleFactor);
      });
    }

    // Create sound generators for the radio buttons.  This is done because by default the sound generators for radio
    // button groups decrease in pitch from left to right, but these radio buttons will be selecting higher frequency
    // light from left to right, so this seems more intuitive.
    const radioButtonSoundPlayers = [];
    _.times(radioButtonContent.length, index => {
      radioButtonSoundPlayers.push(multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(radioButtonContent.length - index - 1));
    });
    const radioButtonGroup = new RectangularRadioButtonGroup(photonAbsorptionModel.photonWavelengthProperty, radioButtonContent, {
      orientation: 'horizontal',
      spacing: 15,
      radioButtonOptions: {
        baseColor: 'black',
        cornerRadius: 7,
        xMargin: 5,
        yMargin: 8,
        buttonAppearanceStrategyOptions: {
          selectedStroke: 'rgb(47,101,209)',
          selectedLineWidth: 3,
          deselectedLineWidth: 0
        }
      },
      soundPlayers: radioButtonSoundPlayers,
      tandem: radioButtonGroupTandem
    });

    // Draw an arrow node to illustrate energy of the emitted photons.
    const energyText = new Text(quadWavelengthSelectorHigherEnergyStringProperty, {
      font: new PhetFont(19)
    });
    const energyArrow = new ArrowNode(0, 0, ARROW_LENGTH, 0, {
      fill: ARROW_COLOR,
      stroke: ARROW_COLOR,
      headHeight: ARROW_HEAD_HEIGHT,
      headWidth: ARROW_HEAD_WIDTH,
      tailWidth: ARROW_TAIL_WIDTH,
      tandem: tandem.createTandem('energyArrow')
    });

    // Scale the text below the arrow node. Max text length is the arrow tail length minus twice the head width.
    if (energyText.width > ARROW_LENGTH - 2 * ARROW_HEAD_WIDTH) {
      energyText.scale((ARROW_LENGTH - 2 * ARROW_HEAD_WIDTH) / energyText.width);
    }

    // Set the positions of all components of the control panel.
    energyArrow.centerX = energyText.centerX = radioButtonGroup.centerX; // All have the same center x component.
    energyArrow.top = radioButtonGroup.bottom + 15; // Arrow is below the buttons by an offset which is chosen empirically.
    energyText.top = energyArrow.bottom;

    // Add all components to the control panel.
    this.addChild(radioButtonGroup);
    this.addChild(energyArrow);
    this.addChild(energyText);
  }
}
greenhouseEffect.register('QuadEmissionFrequencyControlPanel', QuadEmissionFrequencyControlPanel);
export default QuadEmissionFrequencyControlPanel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNb2RlbFZpZXdUcmFuc2Zvcm0yIiwiQXJyb3dOb2RlIiwiUGhldEZvbnQiLCJIQm94IiwiSW1hZ2UiLCJOb2RlIiwiVGV4dCIsIlJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cCIsIm11bHRpU2VsZWN0aW9uU291bmRQbGF5ZXJGYWN0b3J5IiwiVGFuZGVtIiwiZmxhc2hsaWdodF9wbmciLCJpbmZyYXJlZFNvdXJjZV9wbmciLCJtaWNyb3dhdmVTb3VyY2VfcG5nIiwidXZTb3VyY2VfcG5nIiwiZ3JlZW5ob3VzZUVmZmVjdCIsIkdyZWVuaG91c2VFZmZlY3RTdHJpbmdzIiwiTWljcm9QaG90b24iLCJXYXZlbGVuZ3RoQ29uc3RhbnRzIiwiTWljcm9QaG90b25Ob2RlIiwicXVhZFdhdmVsZW5ndGhTZWxlY3RvckhpZ2hlckVuZXJneVN0cmluZ1Byb3BlcnR5IiwiUXVhZFdhdmVsZW5ndGhTZWxlY3RvciIsIkhpZ2hlckVuZXJneVN0cmluZ1Byb3BlcnR5IiwicXVhZFdhdmVsZW5ndGhTZWxlY3RvckluZnJhcmVkU3RyaW5nUHJvcGVydHkiLCJJbmZyYXJlZFN0cmluZ1Byb3BlcnR5IiwicXVhZFdhdmVsZW5ndGhTZWxlY3Rvck1pY3Jvd2F2ZVN0cmluZ1Byb3BlcnR5IiwiTWljcm93YXZlU3RyaW5nUHJvcGVydHkiLCJxdWFkV2F2ZWxlbmd0aFNlbGVjdG9yVWx0cmF2aW9sZXRTdHJpbmdQcm9wZXJ0eSIsIlVsdHJhdmlvbGV0U3RyaW5nUHJvcGVydHkiLCJxdWFkV2F2ZWxlbmd0aFNlbGVjdG9yVmlzaWJsZVN0cmluZ1Byb3BlcnR5IiwiVmlzaWJsZVN0cmluZ1Byb3BlcnR5IiwibGlnaHRTb3VyY2VzU3RyaW5nUHJvcGVydHkiLCJhMTF5IiwibGlnaHRTb3VyY2VSYWRpb0J1dHRvbkhlbHBUZXh0U3RyaW5nUHJvcGVydHkiLCJBUlJPV19MRU5HVEgiLCJBUlJPV19IRUFEX0hFSUdIVCIsIkFSUk9XX0hFQURfV0lEVEgiLCJBUlJPV19UQUlMX1dJRFRIIiwiQVJST1dfQ09MT1IiLCJjcmVhdGVSYWRpb0J1dHRvbkNvbnRlbnQiLCJlbWl0dGVySW1hZ2UiLCJwaG90b25Ob2RlIiwic2NhbGUiLCJzcGFjaW5nIiwiY2hpbGRyZW4iLCJRdWFkRW1pc3Npb25GcmVxdWVuY3lDb250cm9sUGFuZWwiLCJjb25zdHJ1Y3RvciIsInBob3RvbkFic29ycHRpb25Nb2RlbCIsInRhbmRlbSIsInRhZ05hbWUiLCJsYWJlbFRhZ05hbWUiLCJsYWJlbENvbnRlbnQiLCJ2YWx1ZSIsImRlc2NyaXB0aW9uQ29udGVudCIsImlkZW50aXR5VHJhbnNmb3JtIiwiY3JlYXRlSWRlbnRpdHkiLCJtaWNyb3dhdmVQaG90b25Ob2RlIiwiTUlDUk9fV0FWRUxFTkdUSCIsIk9QVF9PVVQiLCJpbmZyYXJlZFBob3Rvbk5vZGUiLCJJUl9XQVZFTEVOR1RIIiwidmlzaWJsZVBob3Rvbk5vZGUiLCJWSVNJQkxFX1dBVkVMRU5HVEgiLCJ1bHRyYXZpb2xldFBob3Rvbk5vZGUiLCJVVl9XQVZFTEVOR1RIIiwibGFiZWxGb250IiwibWljcm93YXZlVGFuZGVtTmFtZSIsImluZnJhcmVkVGFuZGVtTmFtZSIsInZpc2libGVUYW5kZW1OYW1lIiwidWx0cmF2aW9sZXRUYW5kZW1OYW1lIiwicmFkaW9CdXR0b25Hcm91cFRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsIm1pY3Jvd2F2ZVJhZGlvQnV0dG9uQ29udGVudCIsImluZnJhcmVkUGhvdG9uUmFkaW9CdXR0b25Db250ZW50IiwidmlzaWJsZVBob3RvblJhZGlvQnV0dG9uQ29udGVudCIsInVsdHJhdmlvbGV0UGhvdG9uUmFkaW9CdXR0b25Db250ZW50IiwicmFkaW9CdXR0b25Db250ZW50IiwiY3JlYXRlTm9kZSIsImxhYmVsIiwiZm9udCIsInRhbmRlbU5hbWUiLCJwYW5lbFdpZHRoIiwiXyIsIm1heEJ5IiwiY29udGVudCIsIndpZHRoIiwic2NhbGVGYWN0b3IiLCJlYWNoIiwibGFiZWxXaWR0aCIsIk1hdGgiLCJtaW4iLCJyYWRpb0J1dHRvblNvdW5kUGxheWVycyIsInRpbWVzIiwibGVuZ3RoIiwiaW5kZXgiLCJwdXNoIiwiZ2V0U2VsZWN0aW9uU291bmRQbGF5ZXIiLCJyYWRpb0J1dHRvbkdyb3VwIiwicGhvdG9uV2F2ZWxlbmd0aFByb3BlcnR5Iiwib3JpZW50YXRpb24iLCJyYWRpb0J1dHRvbk9wdGlvbnMiLCJiYXNlQ29sb3IiLCJjb3JuZXJSYWRpdXMiLCJ4TWFyZ2luIiwieU1hcmdpbiIsImJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneU9wdGlvbnMiLCJzZWxlY3RlZFN0cm9rZSIsInNlbGVjdGVkTGluZVdpZHRoIiwiZGVzZWxlY3RlZExpbmVXaWR0aCIsInNvdW5kUGxheWVycyIsImVuZXJneVRleHQiLCJlbmVyZ3lBcnJvdyIsImZpbGwiLCJzdHJva2UiLCJoZWFkSGVpZ2h0IiwiaGVhZFdpZHRoIiwidGFpbFdpZHRoIiwiY2VudGVyWCIsInRvcCIsImJvdHRvbSIsImFkZENoaWxkIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJRdWFkRW1pc3Npb25GcmVxdWVuY3lDb250cm9sUGFuZWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjEtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhpcyBpcyBhIGNvbnRyb2wgcGFuZWwgdGhhdCBpcyBpbnRlbmRlZCBmb3IgdXNlIGluIHRoZSBwbGF5IGFyZWEgYW5kIHRoYXQgYWxsb3dzIHRoZSBzZXR0aW5nIG9mIDQgZGlmZmVyZW50IHBob3RvblxyXG4gKiBlbWlzc2lvbiBmcmVxdWVuY2llcy5cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmcgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgQXJyb3dOb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9BcnJvd05vZGUuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgSEJveCwgSW1hZ2UsIE5vZGUsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwIGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9idXR0b25zL1JlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cC5qcyc7XHJcbmltcG9ydCBtdWx0aVNlbGVjdGlvblNvdW5kUGxheWVyRmFjdG9yeSBmcm9tICcuLi8uLi8uLi8uLi90YW1iby9qcy9tdWx0aVNlbGVjdGlvblNvdW5kUGxheWVyRmFjdG9yeS5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBmbGFzaGxpZ2h0X3BuZyBmcm9tICcuLi8uLi8uLi9taXBtYXBzL2ZsYXNobGlnaHRfcG5nLmpzJztcclxuaW1wb3J0IGluZnJhcmVkU291cmNlX3BuZyBmcm9tICcuLi8uLi8uLi9taXBtYXBzL2luZnJhcmVkU291cmNlX3BuZy5qcyc7XHJcbmltcG9ydCBtaWNyb3dhdmVTb3VyY2VfcG5nIGZyb20gJy4uLy4uLy4uL21pcG1hcHMvbWljcm93YXZlU291cmNlX3BuZy5qcyc7XHJcbmltcG9ydCB1dlNvdXJjZV9wbmcgZnJvbSAnLi4vLi4vLi4vbWlwbWFwcy91dlNvdXJjZV9wbmcuanMnO1xyXG5pbXBvcnQgZ3JlZW5ob3VzZUVmZmVjdCBmcm9tICcuLi8uLi9ncmVlbmhvdXNlRWZmZWN0LmpzJztcclxuaW1wb3J0IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzIGZyb20gJy4uLy4uL0dyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmpzJztcclxuaW1wb3J0IE1pY3JvUGhvdG9uIGZyb20gJy4uL21vZGVsL01pY3JvUGhvdG9uLmpzJztcclxuaW1wb3J0IFdhdmVsZW5ndGhDb25zdGFudHMgZnJvbSAnLi4vbW9kZWwvV2F2ZWxlbmd0aENvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBNaWNyb1Bob3Rvbk5vZGUgZnJvbSAnLi9NaWNyb1Bob3Rvbk5vZGUuanMnO1xyXG5cclxuY29uc3QgcXVhZFdhdmVsZW5ndGhTZWxlY3RvckhpZ2hlckVuZXJneVN0cmluZ1Byb3BlcnR5ID0gR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuUXVhZFdhdmVsZW5ndGhTZWxlY3Rvci5IaWdoZXJFbmVyZ3lTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgcXVhZFdhdmVsZW5ndGhTZWxlY3RvckluZnJhcmVkU3RyaW5nUHJvcGVydHkgPSBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5RdWFkV2F2ZWxlbmd0aFNlbGVjdG9yLkluZnJhcmVkU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHF1YWRXYXZlbGVuZ3RoU2VsZWN0b3JNaWNyb3dhdmVTdHJpbmdQcm9wZXJ0eSA9IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLlF1YWRXYXZlbGVuZ3RoU2VsZWN0b3IuTWljcm93YXZlU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHF1YWRXYXZlbGVuZ3RoU2VsZWN0b3JVbHRyYXZpb2xldFN0cmluZ1Byb3BlcnR5ID0gR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuUXVhZFdhdmVsZW5ndGhTZWxlY3Rvci5VbHRyYXZpb2xldFN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBxdWFkV2F2ZWxlbmd0aFNlbGVjdG9yVmlzaWJsZVN0cmluZ1Byb3BlcnR5ID0gR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuUXVhZFdhdmVsZW5ndGhTZWxlY3Rvci5WaXNpYmxlU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGxpZ2h0U291cmNlc1N0cmluZ1Byb3BlcnR5ID0gR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuYTExeS5saWdodFNvdXJjZXNTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgbGlnaHRTb3VyY2VSYWRpb0J1dHRvbkhlbHBUZXh0U3RyaW5nUHJvcGVydHkgPSBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5hMTF5LmxpZ2h0U291cmNlUmFkaW9CdXR0b25IZWxwVGV4dFN0cmluZ1Byb3BlcnR5O1xyXG5cclxuLy8gRGVzY3JpcHRpb24gZGF0YSBmb3IgdGhlICdFbmVyZ3kgQXJyb3cnXHJcbmNvbnN0IEFSUk9XX0xFTkdUSCA9IDIwMDtcclxuY29uc3QgQVJST1dfSEVBRF9IRUlHSFQgPSAxNTtcclxuY29uc3QgQVJST1dfSEVBRF9XSURUSCA9IDIwO1xyXG5jb25zdCBBUlJPV19UQUlMX1dJRFRIID0gMTtcclxuY29uc3QgQVJST1dfQ09MT1IgPSAnYmxhY2snO1xyXG5cclxuLy8gQ3JlYXRlIGEgbGF5b3V0IGJveCB3aGljaCBob2xkcyBhIHNpbmdsZSBwYW5lbCBvZiB0aGlzIGNvbnRyb2wgcGFuZWwuXHJcbmNvbnN0IGNyZWF0ZVJhZGlvQnV0dG9uQ29udGVudCA9ICggZW1pdHRlckltYWdlLCBwaG90b25Ob2RlICkgPT4ge1xyXG4gIGVtaXR0ZXJJbWFnZS5zY2FsZSggMC4yNyApOyAvLyBTY2FsZSBlbWl0dGVyIGltYWdlIHRvIGZpdCBpbiB0aGUgcGFuZWwsIHNjYWxlIGZhY3RvciBkZXRlcm1pbmVkIGVtcGlyaWNhbGx5LlxyXG4gIHJldHVybiBuZXcgSEJveCggeyBzcGFjaW5nOiAxMCwgY2hpbGRyZW46IFsgZW1pdHRlckltYWdlLCBwaG90b25Ob2RlIF0gfSApO1xyXG59O1xyXG5cclxuY2xhc3MgUXVhZEVtaXNzaW9uRnJlcXVlbmN5Q29udHJvbFBhbmVsIGV4dGVuZHMgTm9kZSB7XHJcbiAgLyoqXHJcbiAgICogQ29uc3RydWN0b3IgZm9yIHRoZSBjb250cm9sIHBhbmVsIG9mIGVtaXR0ZWQgcGhvdG9uIGZyZXF1ZW5jeS5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7UGhvdG9uQWJzb3JwdGlvbk1vZGVsfSBwaG90b25BYnNvcnB0aW9uTW9kZWxcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIHBob3RvbkFic29ycHRpb25Nb2RlbCwgdGFuZGVtICkge1xyXG5cclxuICAgIC8vIFN1cGVydHlwZSBjb25zdHJ1Y3RvclxyXG4gICAgc3VwZXIoIHtcclxuICAgICAgdGFnTmFtZTogJ2RpdicsXHJcbiAgICAgIGxhYmVsVGFnTmFtZTogJ2gzJyxcclxuICAgICAgbGFiZWxDb250ZW50OiBsaWdodFNvdXJjZXNTdHJpbmdQcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgZGVzY3JpcHRpb25Db250ZW50OiBsaWdodFNvdXJjZVJhZGlvQnV0dG9uSGVscFRleHRTdHJpbmdQcm9wZXJ0eS52YWx1ZVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEluaXRpYWxpemUgdGhlIHBob3RvbiBub2RlcyBmb3IgdGhlIGNvbnRyb2wgcGFuZWwuICBJZGVudGl0eSBtb2RlbCB2aWV3IHRyYW5zZm9ybSBpcyB1c2VkIGJlY2F1c2UgdGhlc2UgcGhvdG9uXHJcbiAgICAvLyBub2RlcyBkbyBub3QgY29ycmVzcG9uZCB0byBhbnl0aGluZyBpbiB0aGUgbW9kZWwuICBUaGV5IGFyZSBqdXN0IHZpc3VhbCBlbGVtZW50cyBvZiB0aGUgY29udHJvbCBwYW5lbC5cclxuICAgIGNvbnN0IGlkZW50aXR5VHJhbnNmb3JtID0gTW9kZWxWaWV3VHJhbnNmb3JtMi5jcmVhdGVJZGVudGl0eSgpO1xyXG4gICAgY29uc3QgbWljcm93YXZlUGhvdG9uTm9kZSA9IG5ldyBNaWNyb1Bob3Rvbk5vZGUoXHJcbiAgICAgIG5ldyBNaWNyb1Bob3RvbiggV2F2ZWxlbmd0aENvbnN0YW50cy5NSUNST19XQVZFTEVOR1RILCB7IHRhbmRlbTogVGFuZGVtLk9QVF9PVVQgfSApLFxyXG4gICAgICBpZGVudGl0eVRyYW5zZm9ybVxyXG4gICAgKTtcclxuICAgIGNvbnN0IGluZnJhcmVkUGhvdG9uTm9kZSA9IG5ldyBNaWNyb1Bob3Rvbk5vZGUoXHJcbiAgICAgIG5ldyBNaWNyb1Bob3RvbiggV2F2ZWxlbmd0aENvbnN0YW50cy5JUl9XQVZFTEVOR1RILCB7IHRhbmRlbTogVGFuZGVtLk9QVF9PVVQgfSApLFxyXG4gICAgICBpZGVudGl0eVRyYW5zZm9ybVxyXG4gICAgKTtcclxuICAgIGNvbnN0IHZpc2libGVQaG90b25Ob2RlID0gbmV3IE1pY3JvUGhvdG9uTm9kZShcclxuICAgICAgbmV3IE1pY3JvUGhvdG9uKCBXYXZlbGVuZ3RoQ29uc3RhbnRzLlZJU0lCTEVfV0FWRUxFTkdUSCwgeyB0YW5kZW06IFRhbmRlbS5PUFRfT1VUIH0gKSxcclxuICAgICAgaWRlbnRpdHlUcmFuc2Zvcm1cclxuICAgICk7XHJcbiAgICBjb25zdCB1bHRyYXZpb2xldFBob3Rvbk5vZGUgPSBuZXcgTWljcm9QaG90b25Ob2RlKFxyXG4gICAgICBuZXcgTWljcm9QaG90b24oIFdhdmVsZW5ndGhDb25zdGFudHMuVVZfV0FWRUxFTkdUSCwgeyB0YW5kZW06IFRhbmRlbS5PUFRfT1VUIH0gKSxcclxuICAgICAgaWRlbnRpdHlUcmFuc2Zvcm1cclxuICAgICk7XHJcblxyXG4gICAgLy8gTG9hZCB0aGUgcmFkaW8gYnV0dG9uIGNvbnRlbnQgaW50byBhbiBhcnJheSBvZiBvYmplY3QgbGl0ZXJhbHMgd2hpY2ggaG9sZHMgdGhlIG5vZGUsIGxhYmVsIHN0cmluZywgYW5kXHJcbiAgICAvLyB2YWx1ZSBmb3IgZWFjaCBidXR0b24uXHJcbiAgICBjb25zdCBsYWJlbEZvbnQgPSBuZXcgUGhldEZvbnQoIDE4ICk7XHJcblxyXG4gICAgLy8gVGhpcyBpcyBzb3J0IG9mIGhhY2sgdG8gcGFzcyB0aHJvdWdoIHRoZSB0YW5kZW0gb2YgdGhlIHJhZGlvQnV0dG9uR3JvdXBNZW1iZXIgdG8gaXRzIGNoaWxkLlxyXG4gICAgY29uc3QgbWljcm93YXZlVGFuZGVtTmFtZSA9ICdtaWNyb3dhdmVSYWRpb0J1dHRvbic7XHJcbiAgICBjb25zdCBpbmZyYXJlZFRhbmRlbU5hbWUgPSAnaW5mcmFyZWRSYWRpb0J1dHRvbic7XHJcbiAgICBjb25zdCB2aXNpYmxlVGFuZGVtTmFtZSA9ICd2aXNpYmxlUmFkaW9CdXR0b24nO1xyXG4gICAgY29uc3QgdWx0cmF2aW9sZXRUYW5kZW1OYW1lID0gJ3VsdHJhdmlvbGV0UmFkaW9CdXR0b24nO1xyXG4gICAgY29uc3QgcmFkaW9CdXR0b25Hcm91cFRhbmRlbSA9IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdyYWRpb0J1dHRvbkdyb3VwJyApO1xyXG4gICAgY29uc3QgbWljcm93YXZlUmFkaW9CdXR0b25Db250ZW50ID0gY3JlYXRlUmFkaW9CdXR0b25Db250ZW50KCBuZXcgSW1hZ2UoIG1pY3Jvd2F2ZVNvdXJjZV9wbmcgKSwgbWljcm93YXZlUGhvdG9uTm9kZSApO1xyXG4gICAgY29uc3QgaW5mcmFyZWRQaG90b25SYWRpb0J1dHRvbkNvbnRlbnQgPSBjcmVhdGVSYWRpb0J1dHRvbkNvbnRlbnQoIG5ldyBJbWFnZSggaW5mcmFyZWRTb3VyY2VfcG5nICksIGluZnJhcmVkUGhvdG9uTm9kZSApO1xyXG4gICAgY29uc3QgdmlzaWJsZVBob3RvblJhZGlvQnV0dG9uQ29udGVudCA9IGNyZWF0ZVJhZGlvQnV0dG9uQ29udGVudCggbmV3IEltYWdlKCBmbGFzaGxpZ2h0X3BuZyApLCB2aXNpYmxlUGhvdG9uTm9kZSApO1xyXG4gICAgY29uc3QgdWx0cmF2aW9sZXRQaG90b25SYWRpb0J1dHRvbkNvbnRlbnQgPSBjcmVhdGVSYWRpb0J1dHRvbkNvbnRlbnQoIG5ldyBJbWFnZSggdXZTb3VyY2VfcG5nICksIHVsdHJhdmlvbGV0UGhvdG9uTm9kZSApO1xyXG4gICAgY29uc3QgcmFkaW9CdXR0b25Db250ZW50ID0gWyB7XHJcbiAgICAgIGNyZWF0ZU5vZGU6ICgpID0+IG1pY3Jvd2F2ZVJhZGlvQnV0dG9uQ29udGVudCxcclxuICAgICAgdmFsdWU6IFdhdmVsZW5ndGhDb25zdGFudHMuTUlDUk9fV0FWRUxFTkdUSCxcclxuICAgICAgbGFiZWw6IG5ldyBUZXh0KCBxdWFkV2F2ZWxlbmd0aFNlbGVjdG9yTWljcm93YXZlU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgICBmb250OiBsYWJlbEZvbnQsXHJcbiAgICAgICAgdGFuZGVtOiByYWRpb0J1dHRvbkdyb3VwVGFuZGVtLmNyZWF0ZVRhbmRlbSggbWljcm93YXZlVGFuZGVtTmFtZSApLmNyZWF0ZVRhbmRlbSggJ21pY3Jvd2F2ZVJhZGlvQnV0dG9uTGFiZWxUZXh0JyApXHJcbiAgICAgIH0gKSxcclxuICAgICAgdGFuZGVtTmFtZTogbWljcm93YXZlVGFuZGVtTmFtZSxcclxuICAgICAgbGFiZWxDb250ZW50OiBxdWFkV2F2ZWxlbmd0aFNlbGVjdG9yTWljcm93YXZlU3RyaW5nUHJvcGVydHkudmFsdWVcclxuICAgIH0sIHtcclxuICAgICAgY3JlYXRlTm9kZTogKCkgPT4gaW5mcmFyZWRQaG90b25SYWRpb0J1dHRvbkNvbnRlbnQsXHJcbiAgICAgIHZhbHVlOiBXYXZlbGVuZ3RoQ29uc3RhbnRzLklSX1dBVkVMRU5HVEgsXHJcbiAgICAgIGxhYmVsOiBuZXcgVGV4dCggcXVhZFdhdmVsZW5ndGhTZWxlY3RvckluZnJhcmVkU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgICBmb250OiBsYWJlbEZvbnQsXHJcbiAgICAgICAgdGFuZGVtOiByYWRpb0J1dHRvbkdyb3VwVGFuZGVtLmNyZWF0ZVRhbmRlbSggaW5mcmFyZWRUYW5kZW1OYW1lICkuY3JlYXRlVGFuZGVtKCAnaW5mcmFyZWRSYWRpb0J1dHRvbkxhYmVsVGV4dCcgKVxyXG4gICAgICB9ICksXHJcbiAgICAgIHRhbmRlbU5hbWU6IGluZnJhcmVkVGFuZGVtTmFtZSxcclxuICAgICAgbGFiZWxDb250ZW50OiBxdWFkV2F2ZWxlbmd0aFNlbGVjdG9ySW5mcmFyZWRTdHJpbmdQcm9wZXJ0eS52YWx1ZVxyXG4gICAgfSwge1xyXG4gICAgICBjcmVhdGVOb2RlOiAoKSA9PiB2aXNpYmxlUGhvdG9uUmFkaW9CdXR0b25Db250ZW50LFxyXG4gICAgICB2YWx1ZTogV2F2ZWxlbmd0aENvbnN0YW50cy5WSVNJQkxFX1dBVkVMRU5HVEgsXHJcbiAgICAgIGxhYmVsOiBuZXcgVGV4dCggcXVhZFdhdmVsZW5ndGhTZWxlY3RvclZpc2libGVTdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICAgIGZvbnQ6IGxhYmVsRm9udCxcclxuICAgICAgICB0YW5kZW06IHJhZGlvQnV0dG9uR3JvdXBUYW5kZW0uY3JlYXRlVGFuZGVtKCB2aXNpYmxlVGFuZGVtTmFtZSApLmNyZWF0ZVRhbmRlbSggJ3Zpc2libGVSYWRpb0J1dHRvbkxhYmVsVGV4dCcgKVxyXG4gICAgICB9ICksXHJcbiAgICAgIHRhbmRlbU5hbWU6IHZpc2libGVUYW5kZW1OYW1lLFxyXG4gICAgICBsYWJlbENvbnRlbnQ6IHF1YWRXYXZlbGVuZ3RoU2VsZWN0b3JWaXNpYmxlU3RyaW5nUHJvcGVydHkudmFsdWVcclxuICAgIH0sIHtcclxuICAgICAgY3JlYXRlTm9kZTogKCkgPT4gdWx0cmF2aW9sZXRQaG90b25SYWRpb0J1dHRvbkNvbnRlbnQsXHJcbiAgICAgIHZhbHVlOiBXYXZlbGVuZ3RoQ29uc3RhbnRzLlVWX1dBVkVMRU5HVEgsXHJcbiAgICAgIGxhYmVsOiBuZXcgVGV4dCggcXVhZFdhdmVsZW5ndGhTZWxlY3RvclVsdHJhdmlvbGV0U3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgICBmb250OiBsYWJlbEZvbnQsXHJcbiAgICAgICAgdGFuZGVtOiByYWRpb0J1dHRvbkdyb3VwVGFuZGVtLmNyZWF0ZVRhbmRlbSggdWx0cmF2aW9sZXRUYW5kZW1OYW1lICkuY3JlYXRlVGFuZGVtKCAndWx0cmF2aW9sZXRSYWRpb0J1dHRvbkxhYmVsVGV4dCcgKVxyXG4gICAgICB9ICksXHJcbiAgICAgIHRhbmRlbU5hbWU6IHVsdHJhdmlvbGV0VGFuZGVtTmFtZSxcclxuICAgICAgbGFiZWxDb250ZW50OiBxdWFkV2F2ZWxlbmd0aFNlbGVjdG9yVWx0cmF2aW9sZXRTdHJpbmdQcm9wZXJ0eS52YWx1ZVxyXG4gICAgfSBdO1xyXG5cclxuICAgIC8vIFNjYWxlIHRoZSByYWRpbyBidXR0b24gdGV4dC4gIFRoaXMgaXMgZG9uZSBtb3N0bHkgdG8gc3VwcG9ydCB0cmFuc2xhdGlvbnMuXHJcbiAgICAvLyBEZXRlcm1pbmUgdGhlIG1heCB3aWR0aCBvZiBwYW5lbHMgaW4gdGhlIHJhZGlvIGJ1dHRvbiBncm91cC5cclxuICAgIGNvbnN0IHBhbmVsV2lkdGggPSBfLm1heEJ5KCBbIG1pY3Jvd2F2ZVJhZGlvQnV0dG9uQ29udGVudCwgaW5mcmFyZWRQaG90b25SYWRpb0J1dHRvbkNvbnRlbnQsIHZpc2libGVQaG90b25SYWRpb0J1dHRvbkNvbnRlbnQsIHVsdHJhdmlvbGV0UGhvdG9uUmFkaW9CdXR0b25Db250ZW50IF0sIGNvbnRlbnQgPT4gY29udGVudC53aWR0aCApLndpZHRoO1xyXG5cclxuICAgIC8vIENhbGN1bGF0ZSB0aGUgbWluaW11bSBzY2FsZSBmYWN0b3IgdGhhdCBtdXN0IGJlIGFwcGxpZWQgdG8gZWFjaCBsYWJlbC4gRW5zdXJlcyBjb25zdGFudCBmb250IHNpemUgZm9yIGFsbCBsYWJlbHMuXHJcbiAgICBsZXQgc2NhbGVGYWN0b3IgPSAxO1xyXG4gICAgXy5lYWNoKCByYWRpb0J1dHRvbkNvbnRlbnQsIGNvbnRlbnQgPT4ge1xyXG4gICAgICBjb25zdCBsYWJlbFdpZHRoID0gY29udGVudC5sYWJlbC53aWR0aDtcclxuICAgICAgc2NhbGVGYWN0b3IgPSBNYXRoLm1pbiggc2NhbGVGYWN0b3IsIHBhbmVsV2lkdGggLyBsYWJlbFdpZHRoICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gSWYgbmVjZXNzYXJ5LCBzY2FsZSBkb3duIGVhY2ggbGFiZWwgYnkgdGhlIG1pbmltdW0gc2NhbGUgdmFsdWUuXHJcbiAgICBpZiAoIHNjYWxlRmFjdG9yIDwgMSApIHtcclxuICAgICAgXy5lYWNoKCByYWRpb0J1dHRvbkNvbnRlbnQsIGNvbnRlbnQgPT4ge1xyXG4gICAgICAgIGNvbnRlbnQubGFiZWwuc2NhbGUoIHNjYWxlRmFjdG9yICk7XHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgc291bmQgZ2VuZXJhdG9ycyBmb3IgdGhlIHJhZGlvIGJ1dHRvbnMuICBUaGlzIGlzIGRvbmUgYmVjYXVzZSBieSBkZWZhdWx0IHRoZSBzb3VuZCBnZW5lcmF0b3JzIGZvciByYWRpb1xyXG4gICAgLy8gYnV0dG9uIGdyb3VwcyBkZWNyZWFzZSBpbiBwaXRjaCBmcm9tIGxlZnQgdG8gcmlnaHQsIGJ1dCB0aGVzZSByYWRpbyBidXR0b25zIHdpbGwgYmUgc2VsZWN0aW5nIGhpZ2hlciBmcmVxdWVuY3lcclxuICAgIC8vIGxpZ2h0IGZyb20gbGVmdCB0byByaWdodCwgc28gdGhpcyBzZWVtcyBtb3JlIGludHVpdGl2ZS5cclxuICAgIGNvbnN0IHJhZGlvQnV0dG9uU291bmRQbGF5ZXJzID0gW107XHJcbiAgICBfLnRpbWVzKCByYWRpb0J1dHRvbkNvbnRlbnQubGVuZ3RoLCBpbmRleCA9PiB7XHJcbiAgICAgIHJhZGlvQnV0dG9uU291bmRQbGF5ZXJzLnB1c2goXHJcbiAgICAgICAgbXVsdGlTZWxlY3Rpb25Tb3VuZFBsYXllckZhY3RvcnkuZ2V0U2VsZWN0aW9uU291bmRQbGF5ZXIoIHJhZGlvQnV0dG9uQ29udGVudC5sZW5ndGggLSBpbmRleCAtIDEgKVxyXG4gICAgICApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHJhZGlvQnV0dG9uR3JvdXAgPSBuZXcgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwKCBwaG90b25BYnNvcnB0aW9uTW9kZWwucGhvdG9uV2F2ZWxlbmd0aFByb3BlcnR5LCByYWRpb0J1dHRvbkNvbnRlbnQsIHtcclxuICAgICAgb3JpZW50YXRpb246ICdob3Jpem9udGFsJyxcclxuICAgICAgc3BhY2luZzogMTUsXHJcbiAgICAgIHJhZGlvQnV0dG9uT3B0aW9uczoge1xyXG4gICAgICAgIGJhc2VDb2xvcjogJ2JsYWNrJyxcclxuICAgICAgICBjb3JuZXJSYWRpdXM6IDcsXHJcbiAgICAgICAgeE1hcmdpbjogNSxcclxuICAgICAgICB5TWFyZ2luOiA4LFxyXG4gICAgICAgIGJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneU9wdGlvbnM6IHtcclxuICAgICAgICAgIHNlbGVjdGVkU3Ryb2tlOiAncmdiKDQ3LDEwMSwyMDkpJyxcclxuICAgICAgICAgIHNlbGVjdGVkTGluZVdpZHRoOiAzLFxyXG4gICAgICAgICAgZGVzZWxlY3RlZExpbmVXaWR0aDogMFxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgc291bmRQbGF5ZXJzOiByYWRpb0J1dHRvblNvdW5kUGxheWVycyxcclxuICAgICAgdGFuZGVtOiByYWRpb0J1dHRvbkdyb3VwVGFuZGVtXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gRHJhdyBhbiBhcnJvdyBub2RlIHRvIGlsbHVzdHJhdGUgZW5lcmd5IG9mIHRoZSBlbWl0dGVkIHBob3RvbnMuXHJcbiAgICBjb25zdCBlbmVyZ3lUZXh0ID0gbmV3IFRleHQoIHF1YWRXYXZlbGVuZ3RoU2VsZWN0b3JIaWdoZXJFbmVyZ3lTdHJpbmdQcm9wZXJ0eSwgeyBmb250OiBuZXcgUGhldEZvbnQoIDE5ICkgfSApO1xyXG4gICAgY29uc3QgZW5lcmd5QXJyb3cgPSBuZXcgQXJyb3dOb2RlKCAwLCAwLCBBUlJPV19MRU5HVEgsIDAsIHtcclxuICAgICAgZmlsbDogQVJST1dfQ09MT1IsXHJcbiAgICAgIHN0cm9rZTogQVJST1dfQ09MT1IsXHJcbiAgICAgIGhlYWRIZWlnaHQ6IEFSUk9XX0hFQURfSEVJR0hULFxyXG4gICAgICBoZWFkV2lkdGg6IEFSUk9XX0hFQURfV0lEVEgsXHJcbiAgICAgIHRhaWxXaWR0aDogQVJST1dfVEFJTF9XSURUSCxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZW5lcmd5QXJyb3cnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBTY2FsZSB0aGUgdGV4dCBiZWxvdyB0aGUgYXJyb3cgbm9kZS4gTWF4IHRleHQgbGVuZ3RoIGlzIHRoZSBhcnJvdyB0YWlsIGxlbmd0aCBtaW51cyB0d2ljZSB0aGUgaGVhZCB3aWR0aC5cclxuICAgIGlmICggZW5lcmd5VGV4dC53aWR0aCA+IEFSUk9XX0xFTkdUSCAtIDIgKiBBUlJPV19IRUFEX1dJRFRIICkge1xyXG4gICAgICBlbmVyZ3lUZXh0LnNjYWxlKCAoIEFSUk9XX0xFTkdUSCAtIDIgKiBBUlJPV19IRUFEX1dJRFRIICkgLyBlbmVyZ3lUZXh0LndpZHRoICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2V0IHRoZSBwb3NpdGlvbnMgb2YgYWxsIGNvbXBvbmVudHMgb2YgdGhlIGNvbnRyb2wgcGFuZWwuXHJcbiAgICBlbmVyZ3lBcnJvdy5jZW50ZXJYID0gZW5lcmd5VGV4dC5jZW50ZXJYID0gcmFkaW9CdXR0b25Hcm91cC5jZW50ZXJYOyAvLyBBbGwgaGF2ZSB0aGUgc2FtZSBjZW50ZXIgeCBjb21wb25lbnQuXHJcbiAgICBlbmVyZ3lBcnJvdy50b3AgPSByYWRpb0J1dHRvbkdyb3VwLmJvdHRvbSArIDE1OyAvLyBBcnJvdyBpcyBiZWxvdyB0aGUgYnV0dG9ucyBieSBhbiBvZmZzZXQgd2hpY2ggaXMgY2hvc2VuIGVtcGlyaWNhbGx5LlxyXG4gICAgZW5lcmd5VGV4dC50b3AgPSBlbmVyZ3lBcnJvdy5ib3R0b207XHJcblxyXG4gICAgLy8gQWRkIGFsbCBjb21wb25lbnRzIHRvIHRoZSBjb250cm9sIHBhbmVsLlxyXG4gICAgdGhpcy5hZGRDaGlsZCggcmFkaW9CdXR0b25Hcm91cCApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggZW5lcmd5QXJyb3cgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGVuZXJneVRleHQgKTtcclxuICB9XHJcbn1cclxuXHJcbmdyZWVuaG91c2VFZmZlY3QucmVnaXN0ZXIoICdRdWFkRW1pc3Npb25GcmVxdWVuY3lDb250cm9sUGFuZWwnLCBRdWFkRW1pc3Npb25GcmVxdWVuY3lDb250cm9sUGFuZWwgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFF1YWRFbWlzc2lvbkZyZXF1ZW5jeUNvbnRyb2xQYW5lbDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxtQkFBbUIsTUFBTSx1REFBdUQ7QUFDdkYsT0FBT0MsU0FBUyxNQUFNLDBDQUEwQztBQUNoRSxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLElBQUksRUFBRUMsS0FBSyxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDM0UsT0FBT0MsMkJBQTJCLE1BQU0sMkRBQTJEO0FBQ25HLE9BQU9DLGdDQUFnQyxNQUFNLDBEQUEwRDtBQUN2RyxPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBQ3BELE9BQU9DLGNBQWMsTUFBTSxvQ0FBb0M7QUFDL0QsT0FBT0Msa0JBQWtCLE1BQU0sd0NBQXdDO0FBQ3ZFLE9BQU9DLG1CQUFtQixNQUFNLHlDQUF5QztBQUN6RSxPQUFPQyxZQUFZLE1BQU0sa0NBQWtDO0FBQzNELE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxPQUFPQyx1QkFBdUIsTUFBTSxrQ0FBa0M7QUFDdEUsT0FBT0MsV0FBVyxNQUFNLHlCQUF5QjtBQUNqRCxPQUFPQyxtQkFBbUIsTUFBTSxpQ0FBaUM7QUFDakUsT0FBT0MsZUFBZSxNQUFNLHNCQUFzQjtBQUVsRCxNQUFNQyxnREFBZ0QsR0FBR0osdUJBQXVCLENBQUNLLHNCQUFzQixDQUFDQywwQkFBMEI7QUFDbEksTUFBTUMsNENBQTRDLEdBQUdQLHVCQUF1QixDQUFDSyxzQkFBc0IsQ0FBQ0csc0JB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