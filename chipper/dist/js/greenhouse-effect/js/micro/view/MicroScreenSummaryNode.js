// Copyright 2021-2022, University of Colorado Boulder

/**
 * TODO: Type Documentation
 * @author Jesse Greenberg
 */

import Multilink from '../../../../axon/js/Multilink.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import { Node } from '../../../../scenery/js/imports.js';
import greenhouseEffect from '../../greenhouseEffect.js';
import GreenhouseEffectStrings from '../../GreenhouseEffectStrings.js';
import PhotonTarget from '../model/PhotonTarget.js';
import WavelengthConstants from '../model/WavelengthConstants.js';
const playAreaSummaryStringProperty = GreenhouseEffectStrings.a11y.playAreaSummaryStringProperty;
const controlAreaSummaryStringProperty = GreenhouseEffectStrings.a11y.controlAreaSummaryStringProperty;
const interactionHintStringProperty = GreenhouseEffectStrings.a11y.interactionHintStringProperty;
const simIsPausedStringProperty = GreenhouseEffectStrings.a11y.simIsPausedStringProperty;
const simIsPausedOnSlowSpeedStringProperty = GreenhouseEffectStrings.a11y.simIsPausedOnSlowSpeedStringProperty;
const dynamicPlayingScreenSummaryPatternStringProperty = GreenhouseEffectStrings.a11y.dynamicPlayingScreenSummaryPatternStringProperty;
const dynamicPausedScreenSummaryPatternStringProperty = GreenhouseEffectStrings.a11y.dynamicPausedScreenSummaryPatternStringProperty;
const targetMoleculePatternStringProperty = GreenhouseEffectStrings.a11y.targetMoleculePatternStringProperty;
const screenSummaryWithHintPatternStringProperty = GreenhouseEffectStrings.a11y.screenSummaryWithHintPatternStringProperty;
const emitsPhotonsStringProperty = GreenhouseEffectStrings.a11y.emitsPhotonsStringProperty;
const emitsPhotonsOnSlowSpeedStringProperty = GreenhouseEffectStrings.a11y.emitsPhotonsOnSlowSpeedStringProperty;
const isOffAndPointsStringProperty = GreenhouseEffectStrings.a11y.isOffAndPointsStringProperty;
const emptySpaceStringProperty = GreenhouseEffectStrings.a11y.emptySpaceStringProperty;
class MicroScreenSummaryNode extends Node {
  /**
   * @param {PhotonAbsorptionModel} model
   * @param {BooleanProperty} returnMoleculeButtonVisibleProperty
   */
  constructor(model, returnMoleculeButtonVisibleProperty) {
    super();

    // @private {PhotonAbsorptionModel}
    this.model = model;

    // @private {BooleanProperty}
    this.returnMoleculeButtonVisibleProperty = returnMoleculeButtonVisibleProperty;

    // static summary of the play area
    this.addChild(new Node({
      tagName: 'p',
      accessibleName: playAreaSummaryStringProperty.value
    }));

    // static summary of the control area
    this.addChild(new Node({
      tagName: 'p',
      accessibleName: controlAreaSummaryStringProperty.value
    }));

    // dynamic overview that stays up to date with sim
    const dynamicDescription = new Node({
      tagName: 'p'
    });
    this.addChild(dynamicDescription);
    const summaryProperties = [model.photonWavelengthProperty, model.photonEmitterOnProperty, model.photonTargetProperty, model.runningProperty, model.slowMotionProperty, returnMoleculeButtonVisibleProperty];
    Multilink.multilink(summaryProperties, () => {
      // TODO: Maybe use accessibleName instead if https://github.com/phetsims/scenery/issues/1026 is fixed
      dynamicDescription.innerContent = this.getSummaryString();
    });

    // In addition to the above Properties, update summary when molecules are removed (which may not update the photon
    // target) to describe empty space.
    model.activeMolecules.addItemRemovedListener(() => {
      dynamicDescription.innerContent = this.getSummaryString();
    });

    // interaction hint, add a hint about the "Play" button if sim is paused
    const interactionHint = new Node({
      tagName: 'p',
      innerContent: interactionHintStringProperty.value
    });
    this.addChild(interactionHint);
  }

  /**
   * Get the dynamic summary for the simulation, something like
   * "Currently, Infrared light source is off and points at carbon monoxide molecule." or
   * "Currently, sim is paused on slow speed. Infrared photon emits photons fast and directly at Carbon Monoxide molecule."
   * @private
   *
   * @returns {string}
   */
  getSummaryString() {
    const targetMolecule = this.model.targetMolecule;
    const lightSourceString = WavelengthConstants.getLightSourceName(this.model.photonWavelengthProperty.get());
    const emitterOn = this.model.photonEmitterOnProperty.get();
    const slowMotion = this.model.slowMotionProperty.get();
    let targetString;
    if (targetMolecule) {
      targetString = StringUtils.fillIn(targetMoleculePatternStringProperty.value, {
        photonTarget: PhotonTarget.getMoleculeName(this.model.photonTargetProperty.get())
      });
    } else {
      targetString = emptySpaceStringProperty.value;
    }
    let screenSummaryString;
    let emissionDescriptionString;
    if (this.model.runningProperty.get()) {
      // if running, slow speed is described with the photon emission description
      if (emitterOn) {
        emissionDescriptionString = slowMotion ? emitsPhotonsOnSlowSpeedStringProperty.value : emitsPhotonsStringProperty.value;
      } else {
        emissionDescriptionString = isOffAndPointsStringProperty.value;
      }
      screenSummaryString = StringUtils.fillIn(dynamicPlayingScreenSummaryPatternStringProperty.value, {
        lightSource: lightSourceString,
        emissionDescription: emissionDescriptionString,
        target: targetString
      });
    } else {
      const playingStateString = slowMotion ? simIsPausedOnSlowSpeedStringProperty.value : simIsPausedStringProperty.value;
      emissionDescriptionString = emitterOn ? emitsPhotonsStringProperty.value : isOffAndPointsStringProperty.value;
      screenSummaryString = StringUtils.fillIn(dynamicPausedScreenSummaryPatternStringProperty.value, {
        playingState: playingStateString,
        lightSource: lightSourceString,
        emissionDescription: emissionDescriptionString,
        target: targetString
      });
    }

    // if the "New Molecule" button is visible, include a description of its existence in the screen summary
    if (this.returnMoleculeButtonVisibleProperty.get()) {
      return StringUtils.fillIn(screenSummaryWithHintPatternStringProperty.value, {
        summary: screenSummaryString
      });
    } else {
      return screenSummaryString;
    }
  }
}
greenhouseEffect.register('MicroScreenSummaryNode', MicroScreenSummaryNode);
export default MicroScreenSummaryNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJTdHJpbmdVdGlscyIsIk5vZGUiLCJncmVlbmhvdXNlRWZmZWN0IiwiR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MiLCJQaG90b25UYXJnZXQiLCJXYXZlbGVuZ3RoQ29uc3RhbnRzIiwicGxheUFyZWFTdW1tYXJ5U3RyaW5nUHJvcGVydHkiLCJhMTF5IiwiY29udHJvbEFyZWFTdW1tYXJ5U3RyaW5nUHJvcGVydHkiLCJpbnRlcmFjdGlvbkhpbnRTdHJpbmdQcm9wZXJ0eSIsInNpbUlzUGF1c2VkU3RyaW5nUHJvcGVydHkiLCJzaW1Jc1BhdXNlZE9uU2xvd1NwZWVkU3RyaW5nUHJvcGVydHkiLCJkeW5hbWljUGxheWluZ1NjcmVlblN1bW1hcnlQYXR0ZXJuU3RyaW5nUHJvcGVydHkiLCJkeW5hbWljUGF1c2VkU2NyZWVuU3VtbWFyeVBhdHRlcm5TdHJpbmdQcm9wZXJ0eSIsInRhcmdldE1vbGVjdWxlUGF0dGVyblN0cmluZ1Byb3BlcnR5Iiwic2NyZWVuU3VtbWFyeVdpdGhIaW50UGF0dGVyblN0cmluZ1Byb3BlcnR5IiwiZW1pdHNQaG90b25zU3RyaW5nUHJvcGVydHkiLCJlbWl0c1Bob3RvbnNPblNsb3dTcGVlZFN0cmluZ1Byb3BlcnR5IiwiaXNPZmZBbmRQb2ludHNTdHJpbmdQcm9wZXJ0eSIsImVtcHR5U3BhY2VTdHJpbmdQcm9wZXJ0eSIsIk1pY3JvU2NyZWVuU3VtbWFyeU5vZGUiLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwicmV0dXJuTW9sZWN1bGVCdXR0b25WaXNpYmxlUHJvcGVydHkiLCJhZGRDaGlsZCIsInRhZ05hbWUiLCJhY2Nlc3NpYmxlTmFtZSIsInZhbHVlIiwiZHluYW1pY0Rlc2NyaXB0aW9uIiwic3VtbWFyeVByb3BlcnRpZXMiLCJwaG90b25XYXZlbGVuZ3RoUHJvcGVydHkiLCJwaG90b25FbWl0dGVyT25Qcm9wZXJ0eSIsInBob3RvblRhcmdldFByb3BlcnR5IiwicnVubmluZ1Byb3BlcnR5Iiwic2xvd01vdGlvblByb3BlcnR5IiwibXVsdGlsaW5rIiwiaW5uZXJDb250ZW50IiwiZ2V0U3VtbWFyeVN0cmluZyIsImFjdGl2ZU1vbGVjdWxlcyIsImFkZEl0ZW1SZW1vdmVkTGlzdGVuZXIiLCJpbnRlcmFjdGlvbkhpbnQiLCJ0YXJnZXRNb2xlY3VsZSIsImxpZ2h0U291cmNlU3RyaW5nIiwiZ2V0TGlnaHRTb3VyY2VOYW1lIiwiZ2V0IiwiZW1pdHRlck9uIiwic2xvd01vdGlvbiIsInRhcmdldFN0cmluZyIsImZpbGxJbiIsInBob3RvblRhcmdldCIsImdldE1vbGVjdWxlTmFtZSIsInNjcmVlblN1bW1hcnlTdHJpbmciLCJlbWlzc2lvbkRlc2NyaXB0aW9uU3RyaW5nIiwibGlnaHRTb3VyY2UiLCJlbWlzc2lvbkRlc2NyaXB0aW9uIiwidGFyZ2V0IiwicGxheWluZ1N0YXRlU3RyaW5nIiwicGxheWluZ1N0YXRlIiwic3VtbWFyeSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTWljcm9TY3JlZW5TdW1tYXJ5Tm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBUT0RPOiBUeXBlIERvY3VtZW50YXRpb25cclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmdcclxuICovXHJcblxyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCB7IE5vZGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZ3JlZW5ob3VzZUVmZmVjdCBmcm9tICcuLi8uLi9ncmVlbmhvdXNlRWZmZWN0LmpzJztcclxuaW1wb3J0IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzIGZyb20gJy4uLy4uL0dyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmpzJztcclxuaW1wb3J0IFBob3RvblRhcmdldCBmcm9tICcuLi9tb2RlbC9QaG90b25UYXJnZXQuanMnO1xyXG5pbXBvcnQgV2F2ZWxlbmd0aENvbnN0YW50cyBmcm9tICcuLi9tb2RlbC9XYXZlbGVuZ3RoQ29uc3RhbnRzLmpzJztcclxuXHJcbmNvbnN0IHBsYXlBcmVhU3VtbWFyeVN0cmluZ1Byb3BlcnR5ID0gR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuYTExeS5wbGF5QXJlYVN1bW1hcnlTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgY29udHJvbEFyZWFTdW1tYXJ5U3RyaW5nUHJvcGVydHkgPSBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5hMTF5LmNvbnRyb2xBcmVhU3VtbWFyeVN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBpbnRlcmFjdGlvbkhpbnRTdHJpbmdQcm9wZXJ0eSA9IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmExMXkuaW50ZXJhY3Rpb25IaW50U3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHNpbUlzUGF1c2VkU3RyaW5nUHJvcGVydHkgPSBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5hMTF5LnNpbUlzUGF1c2VkU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHNpbUlzUGF1c2VkT25TbG93U3BlZWRTdHJpbmdQcm9wZXJ0eSA9IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmExMXkuc2ltSXNQYXVzZWRPblNsb3dTcGVlZFN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBkeW5hbWljUGxheWluZ1NjcmVlblN1bW1hcnlQYXR0ZXJuU3RyaW5nUHJvcGVydHkgPSBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5hMTF5LmR5bmFtaWNQbGF5aW5nU2NyZWVuU3VtbWFyeVBhdHRlcm5TdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgZHluYW1pY1BhdXNlZFNjcmVlblN1bW1hcnlQYXR0ZXJuU3RyaW5nUHJvcGVydHkgPSBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5hMTF5LmR5bmFtaWNQYXVzZWRTY3JlZW5TdW1tYXJ5UGF0dGVyblN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCB0YXJnZXRNb2xlY3VsZVBhdHRlcm5TdHJpbmdQcm9wZXJ0eSA9IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmExMXkudGFyZ2V0TW9sZWN1bGVQYXR0ZXJuU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHNjcmVlblN1bW1hcnlXaXRoSGludFBhdHRlcm5TdHJpbmdQcm9wZXJ0eSA9IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmExMXkuc2NyZWVuU3VtbWFyeVdpdGhIaW50UGF0dGVyblN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBlbWl0c1Bob3RvbnNTdHJpbmdQcm9wZXJ0eSA9IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmExMXkuZW1pdHNQaG90b25zU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGVtaXRzUGhvdG9uc09uU2xvd1NwZWVkU3RyaW5nUHJvcGVydHkgPSBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5hMTF5LmVtaXRzUGhvdG9uc09uU2xvd1NwZWVkU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGlzT2ZmQW5kUG9pbnRzU3RyaW5nUHJvcGVydHkgPSBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5hMTF5LmlzT2ZmQW5kUG9pbnRzU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGVtcHR5U3BhY2VTdHJpbmdQcm9wZXJ0eSA9IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmExMXkuZW1wdHlTcGFjZVN0cmluZ1Byb3BlcnR5O1xyXG5cclxuY2xhc3MgTWljcm9TY3JlZW5TdW1tYXJ5Tm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1Bob3RvbkFic29ycHRpb25Nb2RlbH0gbW9kZWxcclxuICAgKiBAcGFyYW0ge0Jvb2xlYW5Qcm9wZXJ0eX0gcmV0dXJuTW9sZWN1bGVCdXR0b25WaXNpYmxlUHJvcGVydHlcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbW9kZWwsIHJldHVybk1vbGVjdWxlQnV0dG9uVmlzaWJsZVByb3BlcnR5ICkge1xyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7UGhvdG9uQWJzb3JwdGlvbk1vZGVsfVxyXG4gICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtCb29sZWFuUHJvcGVydHl9XHJcbiAgICB0aGlzLnJldHVybk1vbGVjdWxlQnV0dG9uVmlzaWJsZVByb3BlcnR5ID0gcmV0dXJuTW9sZWN1bGVCdXR0b25WaXNpYmxlUHJvcGVydHk7XHJcblxyXG4gICAgLy8gc3RhdGljIHN1bW1hcnkgb2YgdGhlIHBsYXkgYXJlYVxyXG4gICAgdGhpcy5hZGRDaGlsZCggbmV3IE5vZGUoIHtcclxuICAgICAgdGFnTmFtZTogJ3AnLFxyXG4gICAgICBhY2Nlc3NpYmxlTmFtZTogcGxheUFyZWFTdW1tYXJ5U3RyaW5nUHJvcGVydHkudmFsdWVcclxuICAgIH0gKSApO1xyXG5cclxuICAgIC8vIHN0YXRpYyBzdW1tYXJ5IG9mIHRoZSBjb250cm9sIGFyZWFcclxuICAgIHRoaXMuYWRkQ2hpbGQoIG5ldyBOb2RlKCB7XHJcbiAgICAgIHRhZ05hbWU6ICdwJyxcclxuICAgICAgYWNjZXNzaWJsZU5hbWU6IGNvbnRyb2xBcmVhU3VtbWFyeVN0cmluZ1Byb3BlcnR5LnZhbHVlXHJcbiAgICB9ICkgKTtcclxuXHJcbiAgICAvLyBkeW5hbWljIG92ZXJ2aWV3IHRoYXQgc3RheXMgdXAgdG8gZGF0ZSB3aXRoIHNpbVxyXG4gICAgY29uc3QgZHluYW1pY0Rlc2NyaXB0aW9uID0gbmV3IE5vZGUoIHsgdGFnTmFtZTogJ3AnIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGR5bmFtaWNEZXNjcmlwdGlvbiApO1xyXG5cclxuICAgIGNvbnN0IHN1bW1hcnlQcm9wZXJ0aWVzID0gW1xyXG4gICAgICBtb2RlbC5waG90b25XYXZlbGVuZ3RoUHJvcGVydHksXHJcbiAgICAgIG1vZGVsLnBob3RvbkVtaXR0ZXJPblByb3BlcnR5LFxyXG4gICAgICBtb2RlbC5waG90b25UYXJnZXRQcm9wZXJ0eSxcclxuICAgICAgbW9kZWwucnVubmluZ1Byb3BlcnR5LFxyXG4gICAgICBtb2RlbC5zbG93TW90aW9uUHJvcGVydHksXHJcbiAgICAgIHJldHVybk1vbGVjdWxlQnV0dG9uVmlzaWJsZVByb3BlcnR5XHJcbiAgICBdO1xyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayggc3VtbWFyeVByb3BlcnRpZXMsICgpID0+IHtcclxuXHJcbiAgICAgIC8vIFRPRE86IE1heWJlIHVzZSBhY2Nlc3NpYmxlTmFtZSBpbnN0ZWFkIGlmIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zY2VuZXJ5L2lzc3Vlcy8xMDI2IGlzIGZpeGVkXHJcbiAgICAgIGR5bmFtaWNEZXNjcmlwdGlvbi5pbm5lckNvbnRlbnQgPSB0aGlzLmdldFN1bW1hcnlTdHJpbmcoKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBJbiBhZGRpdGlvbiB0byB0aGUgYWJvdmUgUHJvcGVydGllcywgdXBkYXRlIHN1bW1hcnkgd2hlbiBtb2xlY3VsZXMgYXJlIHJlbW92ZWQgKHdoaWNoIG1heSBub3QgdXBkYXRlIHRoZSBwaG90b25cclxuICAgIC8vIHRhcmdldCkgdG8gZGVzY3JpYmUgZW1wdHkgc3BhY2UuXHJcbiAgICBtb2RlbC5hY3RpdmVNb2xlY3VsZXMuYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICBkeW5hbWljRGVzY3JpcHRpb24uaW5uZXJDb250ZW50ID0gdGhpcy5nZXRTdW1tYXJ5U3RyaW5nKCk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gaW50ZXJhY3Rpb24gaGludCwgYWRkIGEgaGludCBhYm91dCB0aGUgXCJQbGF5XCIgYnV0dG9uIGlmIHNpbSBpcyBwYXVzZWRcclxuICAgIGNvbnN0IGludGVyYWN0aW9uSGludCA9IG5ldyBOb2RlKCB7IHRhZ05hbWU6ICdwJywgaW5uZXJDb250ZW50OiBpbnRlcmFjdGlvbkhpbnRTdHJpbmdQcm9wZXJ0eS52YWx1ZSB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBpbnRlcmFjdGlvbkhpbnQgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgZHluYW1pYyBzdW1tYXJ5IGZvciB0aGUgc2ltdWxhdGlvbiwgc29tZXRoaW5nIGxpa2VcclxuICAgKiBcIkN1cnJlbnRseSwgSW5mcmFyZWQgbGlnaHQgc291cmNlIGlzIG9mZiBhbmQgcG9pbnRzIGF0IGNhcmJvbiBtb25veGlkZSBtb2xlY3VsZS5cIiBvclxyXG4gICAqIFwiQ3VycmVudGx5LCBzaW0gaXMgcGF1c2VkIG9uIHNsb3cgc3BlZWQuIEluZnJhcmVkIHBob3RvbiBlbWl0cyBwaG90b25zIGZhc3QgYW5kIGRpcmVjdGx5IGF0IENhcmJvbiBNb25veGlkZSBtb2xlY3VsZS5cIlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gICAqL1xyXG4gIGdldFN1bW1hcnlTdHJpbmcoKSB7XHJcbiAgICBjb25zdCB0YXJnZXRNb2xlY3VsZSA9IHRoaXMubW9kZWwudGFyZ2V0TW9sZWN1bGU7XHJcbiAgICBjb25zdCBsaWdodFNvdXJjZVN0cmluZyA9IFdhdmVsZW5ndGhDb25zdGFudHMuZ2V0TGlnaHRTb3VyY2VOYW1lKCB0aGlzLm1vZGVsLnBob3RvbldhdmVsZW5ndGhQcm9wZXJ0eS5nZXQoKSApO1xyXG4gICAgY29uc3QgZW1pdHRlck9uID0gdGhpcy5tb2RlbC5waG90b25FbWl0dGVyT25Qcm9wZXJ0eS5nZXQoKTtcclxuICAgIGNvbnN0IHNsb3dNb3Rpb24gPSB0aGlzLm1vZGVsLnNsb3dNb3Rpb25Qcm9wZXJ0eS5nZXQoKTtcclxuXHJcbiAgICBsZXQgdGFyZ2V0U3RyaW5nO1xyXG4gICAgaWYgKCB0YXJnZXRNb2xlY3VsZSApIHtcclxuICAgICAgdGFyZ2V0U3RyaW5nID0gU3RyaW5nVXRpbHMuZmlsbEluKCB0YXJnZXRNb2xlY3VsZVBhdHRlcm5TdHJpbmdQcm9wZXJ0eS52YWx1ZSwge1xyXG4gICAgICAgIHBob3RvblRhcmdldDogUGhvdG9uVGFyZ2V0LmdldE1vbGVjdWxlTmFtZSggdGhpcy5tb2RlbC5waG90b25UYXJnZXRQcm9wZXJ0eS5nZXQoKSApXHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0YXJnZXRTdHJpbmcgPSBlbXB0eVNwYWNlU3RyaW5nUHJvcGVydHkudmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHNjcmVlblN1bW1hcnlTdHJpbmc7XHJcbiAgICBsZXQgZW1pc3Npb25EZXNjcmlwdGlvblN0cmluZztcclxuICAgIGlmICggdGhpcy5tb2RlbC5ydW5uaW5nUHJvcGVydHkuZ2V0KCkgKSB7XHJcblxyXG4gICAgICAvLyBpZiBydW5uaW5nLCBzbG93IHNwZWVkIGlzIGRlc2NyaWJlZCB3aXRoIHRoZSBwaG90b24gZW1pc3Npb24gZGVzY3JpcHRpb25cclxuICAgICAgaWYgKCBlbWl0dGVyT24gKSB7XHJcbiAgICAgICAgZW1pc3Npb25EZXNjcmlwdGlvblN0cmluZyA9IHNsb3dNb3Rpb24gP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0c1Bob3RvbnNPblNsb3dTcGVlZFN0cmluZ1Byb3BlcnR5LnZhbHVlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdHNQaG90b25zU3RyaW5nUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgZW1pc3Npb25EZXNjcmlwdGlvblN0cmluZyA9IGlzT2ZmQW5kUG9pbnRzU3RyaW5nUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHNjcmVlblN1bW1hcnlTdHJpbmcgPSBTdHJpbmdVdGlscy5maWxsSW4oIGR5bmFtaWNQbGF5aW5nU2NyZWVuU3VtbWFyeVBhdHRlcm5TdHJpbmdQcm9wZXJ0eS52YWx1ZSwge1xyXG4gICAgICAgIGxpZ2h0U291cmNlOiBsaWdodFNvdXJjZVN0cmluZyxcclxuICAgICAgICBlbWlzc2lvbkRlc2NyaXB0aW9uOiBlbWlzc2lvbkRlc2NyaXB0aW9uU3RyaW5nLFxyXG4gICAgICAgIHRhcmdldDogdGFyZ2V0U3RyaW5nXHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjb25zdCBwbGF5aW5nU3RhdGVTdHJpbmcgPSBzbG93TW90aW9uID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2ltSXNQYXVzZWRPblNsb3dTcGVlZFN0cmluZ1Byb3BlcnR5LnZhbHVlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2ltSXNQYXVzZWRTdHJpbmdQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgZW1pc3Npb25EZXNjcmlwdGlvblN0cmluZyA9IGVtaXR0ZXJPbiA/IGVtaXRzUGhvdG9uc1N0cmluZ1Byb3BlcnR5LnZhbHVlIDogaXNPZmZBbmRQb2ludHNTdHJpbmdQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICAgIHNjcmVlblN1bW1hcnlTdHJpbmcgPSBTdHJpbmdVdGlscy5maWxsSW4oIGR5bmFtaWNQYXVzZWRTY3JlZW5TdW1tYXJ5UGF0dGVyblN0cmluZ1Byb3BlcnR5LnZhbHVlLCB7XHJcbiAgICAgICAgcGxheWluZ1N0YXRlOiBwbGF5aW5nU3RhdGVTdHJpbmcsXHJcbiAgICAgICAgbGlnaHRTb3VyY2U6IGxpZ2h0U291cmNlU3RyaW5nLFxyXG4gICAgICAgIGVtaXNzaW9uRGVzY3JpcHRpb246IGVtaXNzaW9uRGVzY3JpcHRpb25TdHJpbmcsXHJcbiAgICAgICAgdGFyZ2V0OiB0YXJnZXRTdHJpbmdcclxuICAgICAgfSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGlmIHRoZSBcIk5ldyBNb2xlY3VsZVwiIGJ1dHRvbiBpcyB2aXNpYmxlLCBpbmNsdWRlIGEgZGVzY3JpcHRpb24gb2YgaXRzIGV4aXN0ZW5jZSBpbiB0aGUgc2NyZWVuIHN1bW1hcnlcclxuICAgIGlmICggdGhpcy5yZXR1cm5Nb2xlY3VsZUJ1dHRvblZpc2libGVQcm9wZXJ0eS5nZXQoKSApIHtcclxuICAgICAgcmV0dXJuIFN0cmluZ1V0aWxzLmZpbGxJbiggc2NyZWVuU3VtbWFyeVdpdGhIaW50UGF0dGVyblN0cmluZ1Byb3BlcnR5LnZhbHVlLCB7XHJcbiAgICAgICAgc3VtbWFyeTogc2NyZWVuU3VtbWFyeVN0cmluZ1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgcmV0dXJuIHNjcmVlblN1bW1hcnlTdHJpbmc7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5ncmVlbmhvdXNlRWZmZWN0LnJlZ2lzdGVyKCAnTWljcm9TY3JlZW5TdW1tYXJ5Tm9kZScsIE1pY3JvU2NyZWVuU3VtbWFyeU5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgTWljcm9TY3JlZW5TdW1tYXJ5Tm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFNBQVMsTUFBTSxrQ0FBa0M7QUFDeEQsT0FBT0MsV0FBVyxNQUFNLCtDQUErQztBQUN2RSxTQUFTQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ3hELE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxPQUFPQyx1QkFBdUIsTUFBTSxrQ0FBa0M7QUFDdEUsT0FBT0MsWUFBWSxNQUFNLDBCQUEwQjtBQUNuRCxPQUFPQyxtQkFBbUIsTUFBTSxpQ0FBaUM7QUFFakUsTUFBTUMsNkJBQTZCLEdBQUdILHVCQUF1QixDQUFDSSxJQUFJLENBQUNELDZCQUE2QjtBQUNoRyxNQUFNRSxnQ0FBZ0MsR0FBR0wsdUJBQXVCLENBQUNJLElBQUksQ0FBQ0MsZ0NBQWdDO0FBQ3RHLE1BQU1DLDZCQUE2QixHQUFHTix1QkFBdUIsQ0FBQ0ksSUFBSSxDQUFDRSw2QkFBNkI7QUFDaEcsTUFBTUMseUJBQXlCLEdBQUdQLHVCQUF1QixD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