// Copyright 2021, University of Colorado Boulder

/**
 * Class that represents CH4 (methane) in the model. The CH4 molecule has atom and bond positions which make
 * the molecule appear three dimensional because it was important to convey the bond angles which were
 * innacurate in two dimensions. No 3D model is used to render this, but offsets are applied to atom
 * positions to create the appearance of three dimensions.
 *
 * @author John Blanco
 * @author Jesse Greenberg
 */

import Vector2 from '../../../../../dot/js/Vector2.js';
import greenhouseEffect from '../../../greenhouseEffect.js';
import Atom from '../atoms/Atom.js';
import AtomicBond from '../atoms/AtomicBond.js';
import Molecule from '../Molecule.js';
import VibrationStrategy from '../VibrationStrategy.js';
import WavelengthConstants from '../WavelengthConstants.js';

// Model Data for Methane
const INITIAL_CARBON_HYDROGEN_DISTANCE = 155; // In picometers.

// Assume that the angle from the carbon to the hydrogen is 45 degrees.
const BOND_ANGLE = Math.PI * 0.9;
const ROTATED_HORIZONTAL_INITIAL_CARBON_HYDROGEN_DISTANCE = INITIAL_CARBON_HYDROGEN_DISTANCE * Math.cos(BOND_ANGLE);
const ROTATED_VERTICAL_INITIAL_CARBON_HYDROGEN_DISTANCE = INITIAL_CARBON_HYDROGEN_DISTANCE * Math.sin(BOND_ANGLE);

// offset applied to positions of atoms to create the effect of 3D appearance
const PERSPECTIVE_OFFSET = 30;
const HYDROGEN_VIBRATION_DISTANCE = 30;
const HYDROGEN_VIBRATION_ANGLE = Math.PI / 4;
const HYDROGEN_VIBRATION_DISTANCE_X = HYDROGEN_VIBRATION_DISTANCE * Math.cos(HYDROGEN_VIBRATION_ANGLE);
const HYDROGEN_VIBRATION_DISTANCE_Y = HYDROGEN_VIBRATION_DISTANCE * Math.sin(HYDROGEN_VIBRATION_ANGLE);
class CH4 extends Molecule {
  /**
   * Constructor for a Methane molecule.
   *
   * @param {Object} [options]
   */
  constructor(options) {
    // Supertype constructor
    super(options);

    // Instance data for the CH4 molecule - @private
    this.carbonAtom = Atom.carbon();
    this.hydrogenAtom1 = Atom.hydrogen({
      topLayer: true
    });
    this.hydrogenAtom2 = Atom.hydrogen();
    this.hydrogenAtom3 = Atom.hydrogen();
    this.hydrogenAtom4 = Atom.hydrogen({
      topLayer: true
    });

    // Configure the base class.
    this.addAtom(this.carbonAtom);
    this.addAtom(this.hydrogenAtom1);
    this.addAtom(this.hydrogenAtom2);
    this.addAtom(this.hydrogenAtom3);
    this.addAtom(this.hydrogenAtom4);
    this.addAtomicBond(new AtomicBond(this.carbonAtom, this.hydrogenAtom1, {
      topLayer: true,
      atom1PositionOffset: new Vector2(0, PERSPECTIVE_OFFSET)
    }));
    this.addAtomicBond(new AtomicBond(this.carbonAtom, this.hydrogenAtom2));
    this.addAtomicBond(new AtomicBond(this.carbonAtom, this.hydrogenAtom3));
    this.addAtomicBond(new AtomicBond(this.carbonAtom, this.hydrogenAtom4, {
      topLayer: true,
      atom1PositionOffset: new Vector2(PERSPECTIVE_OFFSET / 2, -PERSPECTIVE_OFFSET)
    }));

    // Set up the photon wavelengths to absorb.
    this.setPhotonAbsorptionStrategy(WavelengthConstants.IR_WAVELENGTH, new VibrationStrategy(this));

    // Set the initial offsets.
    this.initializeAtomOffsets();
  }

  /**
   * Set the initial positions of the atoms which compose this molecule.
   * @private
   * @override
   */
  initializeAtomOffsets() {
    this.addInitialAtomCogOffset(this.carbonAtom, new Vector2(0, 0));
    this.addInitialAtomCogOffset(this.hydrogenAtom1, new Vector2(-0, INITIAL_CARBON_HYDROGEN_DISTANCE));
    this.addInitialAtomCogOffset(this.hydrogenAtom2, new Vector2(ROTATED_HORIZONTAL_INITIAL_CARBON_HYDROGEN_DISTANCE, -ROTATED_VERTICAL_INITIAL_CARBON_HYDROGEN_DISTANCE));
    this.addInitialAtomCogOffset(this.hydrogenAtom3, new Vector2(-ROTATED_HORIZONTAL_INITIAL_CARBON_HYDROGEN_DISTANCE, -ROTATED_VERTICAL_INITIAL_CARBON_HYDROGEN_DISTANCE + PERSPECTIVE_OFFSET));
    this.addInitialAtomCogOffset(this.hydrogenAtom4, new Vector2(PERSPECTIVE_OFFSET, -INITIAL_CARBON_HYDROGEN_DISTANCE + PERSPECTIVE_OFFSET));
    this.updateAtomPositions();
  }

  /**
   * Set the vibration behavior for this CH4 molecule. Initialize and set center of gravity position offsets for the
   * composing atoms in its vibration cycle.
   * @public
   *
   * @param {number} vibrationRadians - Where this molecule is in its vibration cycle in radians.
   */
  setVibration(vibrationRadians) {
    // super.setVibration( vibrationRadians );

    this.currentVibrationRadiansProperty.set(vibrationRadians);
    const multFactor = 1.5 * Math.sin(vibrationRadians);
    if (vibrationRadians !== 0) {
      this.addInitialAtomCogOffset(this.hydrogenAtom1, new Vector2(multFactor * HYDROGEN_VIBRATION_DISTANCE_X, INITIAL_CARBON_HYDROGEN_DISTANCE + -Math.abs(multFactor) * HYDROGEN_VIBRATION_DISTANCE_Y));
      this.addInitialAtomCogOffset(this.hydrogenAtom2, new Vector2(ROTATED_HORIZONTAL_INITIAL_CARBON_HYDROGEN_DISTANCE + multFactor * HYDROGEN_VIBRATION_DISTANCE_X, -ROTATED_VERTICAL_INITIAL_CARBON_HYDROGEN_DISTANCE - multFactor * HYDROGEN_VIBRATION_DISTANCE_Y));
      this.addInitialAtomCogOffset(this.hydrogenAtom3, new Vector2(-ROTATED_HORIZONTAL_INITIAL_CARBON_HYDROGEN_DISTANCE - multFactor * HYDROGEN_VIBRATION_DISTANCE_X, -ROTATED_VERTICAL_INITIAL_CARBON_HYDROGEN_DISTANCE - multFactor * HYDROGEN_VIBRATION_DISTANCE_Y + PERSPECTIVE_OFFSET));
      this.addInitialAtomCogOffset(this.hydrogenAtom4, new Vector2(PERSPECTIVE_OFFSET + multFactor * HYDROGEN_VIBRATION_DISTANCE_X, -INITIAL_CARBON_HYDROGEN_DISTANCE + Math.abs(multFactor) * HYDROGEN_VIBRATION_DISTANCE_Y + PERSPECTIVE_OFFSET));

      // Position the carbon atom so that the center of mass of the molecule remains the same.
      const carbonXPos = -(this.hydrogenAtom1.mass / this.carbonAtom.mass) * (this.getInitialAtomCogOffset(this.hydrogenAtom1).x + this.getInitialAtomCogOffset(this.hydrogenAtom2).x + this.getInitialAtomCogOffset(this.hydrogenAtom3).x + this.getInitialAtomCogOffset(this.hydrogenAtom4).x);
      const carbonYPos = -(this.hydrogenAtom1.mass / this.carbonAtom.mass) * (this.getInitialAtomCogOffset(this.hydrogenAtom1).y + this.getInitialAtomCogOffset(this.hydrogenAtom2).y + this.getInitialAtomCogOffset(this.hydrogenAtom3).y + this.getInitialAtomCogOffset(this.hydrogenAtom4).y);
      this.addInitialAtomCogOffset(this.carbonAtom, new Vector2(carbonXPos, carbonYPos));
    } else {
      this.initializeAtomOffsets();
    }
    this.updateAtomPositions();
  }
}
greenhouseEffect.register('CH4', CH4);
export default CH4;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiZ3JlZW5ob3VzZUVmZmVjdCIsIkF0b20iLCJBdG9taWNCb25kIiwiTW9sZWN1bGUiLCJWaWJyYXRpb25TdHJhdGVneSIsIldhdmVsZW5ndGhDb25zdGFudHMiLCJJTklUSUFMX0NBUkJPTl9IWURST0dFTl9ESVNUQU5DRSIsIkJPTkRfQU5HTEUiLCJNYXRoIiwiUEkiLCJST1RBVEVEX0hPUklaT05UQUxfSU5JVElBTF9DQVJCT05fSFlEUk9HRU5fRElTVEFOQ0UiLCJjb3MiLCJST1RBVEVEX1ZFUlRJQ0FMX0lOSVRJQUxfQ0FSQk9OX0hZRFJPR0VOX0RJU1RBTkNFIiwic2luIiwiUEVSU1BFQ1RJVkVfT0ZGU0VUIiwiSFlEUk9HRU5fVklCUkFUSU9OX0RJU1RBTkNFIiwiSFlEUk9HRU5fVklCUkFUSU9OX0FOR0xFIiwiSFlEUk9HRU5fVklCUkFUSU9OX0RJU1RBTkNFX1giLCJIWURST0dFTl9WSUJSQVRJT05fRElTVEFOQ0VfWSIsIkNINCIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsImNhcmJvbkF0b20iLCJjYXJib24iLCJoeWRyb2dlbkF0b20xIiwiaHlkcm9nZW4iLCJ0b3BMYXllciIsImh5ZHJvZ2VuQXRvbTIiLCJoeWRyb2dlbkF0b20zIiwiaHlkcm9nZW5BdG9tNCIsImFkZEF0b20iLCJhZGRBdG9taWNCb25kIiwiYXRvbTFQb3NpdGlvbk9mZnNldCIsInNldFBob3RvbkFic29ycHRpb25TdHJhdGVneSIsIklSX1dBVkVMRU5HVEgiLCJpbml0aWFsaXplQXRvbU9mZnNldHMiLCJhZGRJbml0aWFsQXRvbUNvZ09mZnNldCIsInVwZGF0ZUF0b21Qb3NpdGlvbnMiLCJzZXRWaWJyYXRpb24iLCJ2aWJyYXRpb25SYWRpYW5zIiwiY3VycmVudFZpYnJhdGlvblJhZGlhbnNQcm9wZXJ0eSIsInNldCIsIm11bHRGYWN0b3IiLCJhYnMiLCJjYXJib25YUG9zIiwibWFzcyIsImdldEluaXRpYWxBdG9tQ29nT2Zmc2V0IiwieCIsImNhcmJvbllQb3MiLCJ5IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJDSDQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjEsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIENsYXNzIHRoYXQgcmVwcmVzZW50cyBDSDQgKG1ldGhhbmUpIGluIHRoZSBtb2RlbC4gVGhlIENINCBtb2xlY3VsZSBoYXMgYXRvbSBhbmQgYm9uZCBwb3NpdGlvbnMgd2hpY2ggbWFrZVxyXG4gKiB0aGUgbW9sZWN1bGUgYXBwZWFyIHRocmVlIGRpbWVuc2lvbmFsIGJlY2F1c2UgaXQgd2FzIGltcG9ydGFudCB0byBjb252ZXkgdGhlIGJvbmQgYW5nbGVzIHdoaWNoIHdlcmVcclxuICogaW5uYWN1cmF0ZSBpbiB0d28gZGltZW5zaW9ucy4gTm8gM0QgbW9kZWwgaXMgdXNlZCB0byByZW5kZXIgdGhpcywgYnV0IG9mZnNldHMgYXJlIGFwcGxpZWQgdG8gYXRvbVxyXG4gKiBwb3NpdGlvbnMgdG8gY3JlYXRlIHRoZSBhcHBlYXJhbmNlIG9mIHRocmVlIGRpbWVuc2lvbnMuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmdcclxuICovXHJcblxyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBncmVlbmhvdXNlRWZmZWN0IGZyb20gJy4uLy4uLy4uL2dyZWVuaG91c2VFZmZlY3QuanMnO1xyXG5pbXBvcnQgQXRvbSBmcm9tICcuLi9hdG9tcy9BdG9tLmpzJztcclxuaW1wb3J0IEF0b21pY0JvbmQgZnJvbSAnLi4vYXRvbXMvQXRvbWljQm9uZC5qcyc7XHJcbmltcG9ydCBNb2xlY3VsZSBmcm9tICcuLi9Nb2xlY3VsZS5qcyc7XHJcbmltcG9ydCBWaWJyYXRpb25TdHJhdGVneSBmcm9tICcuLi9WaWJyYXRpb25TdHJhdGVneS5qcyc7XHJcbmltcG9ydCBXYXZlbGVuZ3RoQ29uc3RhbnRzIGZyb20gJy4uL1dhdmVsZW5ndGhDb25zdGFudHMuanMnO1xyXG5cclxuLy8gTW9kZWwgRGF0YSBmb3IgTWV0aGFuZVxyXG5jb25zdCBJTklUSUFMX0NBUkJPTl9IWURST0dFTl9ESVNUQU5DRSA9IDE1NTsgLy8gSW4gcGljb21ldGVycy5cclxuXHJcbi8vIEFzc3VtZSB0aGF0IHRoZSBhbmdsZSBmcm9tIHRoZSBjYXJib24gdG8gdGhlIGh5ZHJvZ2VuIGlzIDQ1IGRlZ3JlZXMuXHJcbmNvbnN0IEJPTkRfQU5HTEUgPSBNYXRoLlBJICogMC45O1xyXG5jb25zdCBST1RBVEVEX0hPUklaT05UQUxfSU5JVElBTF9DQVJCT05fSFlEUk9HRU5fRElTVEFOQ0UgPSBJTklUSUFMX0NBUkJPTl9IWURST0dFTl9ESVNUQU5DRSAqIE1hdGguY29zKCBCT05EX0FOR0xFICk7XHJcbmNvbnN0IFJPVEFURURfVkVSVElDQUxfSU5JVElBTF9DQVJCT05fSFlEUk9HRU5fRElTVEFOQ0UgPSBJTklUSUFMX0NBUkJPTl9IWURST0dFTl9ESVNUQU5DRSAqIE1hdGguc2luKCBCT05EX0FOR0xFICk7XHJcblxyXG4vLyBvZmZzZXQgYXBwbGllZCB0byBwb3NpdGlvbnMgb2YgYXRvbXMgdG8gY3JlYXRlIHRoZSBlZmZlY3Qgb2YgM0QgYXBwZWFyYW5jZVxyXG5jb25zdCBQRVJTUEVDVElWRV9PRkZTRVQgPSAzMDtcclxuXHJcbmNvbnN0IEhZRFJPR0VOX1ZJQlJBVElPTl9ESVNUQU5DRSA9IDMwO1xyXG5jb25zdCBIWURST0dFTl9WSUJSQVRJT05fQU5HTEUgPSBNYXRoLlBJIC8gNDtcclxuY29uc3QgSFlEUk9HRU5fVklCUkFUSU9OX0RJU1RBTkNFX1ggPSBIWURST0dFTl9WSUJSQVRJT05fRElTVEFOQ0UgKiBNYXRoLmNvcyggSFlEUk9HRU5fVklCUkFUSU9OX0FOR0xFICk7XHJcbmNvbnN0IEhZRFJPR0VOX1ZJQlJBVElPTl9ESVNUQU5DRV9ZID0gSFlEUk9HRU5fVklCUkFUSU9OX0RJU1RBTkNFICogTWF0aC5zaW4oIEhZRFJPR0VOX1ZJQlJBVElPTl9BTkdMRSApO1xyXG5cclxuY2xhc3MgQ0g0IGV4dGVuZHMgTW9sZWN1bGUge1xyXG5cclxuICAvKipcclxuICAgKiBDb25zdHJ1Y3RvciBmb3IgYSBNZXRoYW5lIG1vbGVjdWxlLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBvcHRpb25zICkge1xyXG5cclxuICAgIC8vIFN1cGVydHlwZSBjb25zdHJ1Y3RvclxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBJbnN0YW5jZSBkYXRhIGZvciB0aGUgQ0g0IG1vbGVjdWxlIC0gQHByaXZhdGVcclxuICAgIHRoaXMuY2FyYm9uQXRvbSA9IEF0b20uY2FyYm9uKCk7XHJcbiAgICB0aGlzLmh5ZHJvZ2VuQXRvbTEgPSBBdG9tLmh5ZHJvZ2VuKCB7IHRvcExheWVyOiB0cnVlIH0gKTtcclxuICAgIHRoaXMuaHlkcm9nZW5BdG9tMiA9IEF0b20uaHlkcm9nZW4oKTtcclxuICAgIHRoaXMuaHlkcm9nZW5BdG9tMyA9IEF0b20uaHlkcm9nZW4oKTtcclxuICAgIHRoaXMuaHlkcm9nZW5BdG9tNCA9IEF0b20uaHlkcm9nZW4oIHsgdG9wTGF5ZXI6IHRydWUgfSApO1xyXG5cclxuICAgIC8vIENvbmZpZ3VyZSB0aGUgYmFzZSBjbGFzcy5cclxuICAgIHRoaXMuYWRkQXRvbSggdGhpcy5jYXJib25BdG9tICk7XHJcbiAgICB0aGlzLmFkZEF0b20oIHRoaXMuaHlkcm9nZW5BdG9tMSApO1xyXG4gICAgdGhpcy5hZGRBdG9tKCB0aGlzLmh5ZHJvZ2VuQXRvbTIgKTtcclxuICAgIHRoaXMuYWRkQXRvbSggdGhpcy5oeWRyb2dlbkF0b20zICk7XHJcbiAgICB0aGlzLmFkZEF0b20oIHRoaXMuaHlkcm9nZW5BdG9tNCApO1xyXG4gICAgdGhpcy5hZGRBdG9taWNCb25kKCBuZXcgQXRvbWljQm9uZCggdGhpcy5jYXJib25BdG9tLCB0aGlzLmh5ZHJvZ2VuQXRvbTEsIHsgdG9wTGF5ZXI6IHRydWUsIGF0b20xUG9zaXRpb25PZmZzZXQ6IG5ldyBWZWN0b3IyKCAwLCBQRVJTUEVDVElWRV9PRkZTRVQgKSB9ICkgKTtcclxuICAgIHRoaXMuYWRkQXRvbWljQm9uZCggbmV3IEF0b21pY0JvbmQoIHRoaXMuY2FyYm9uQXRvbSwgdGhpcy5oeWRyb2dlbkF0b20yICkgKTtcclxuICAgIHRoaXMuYWRkQXRvbWljQm9uZCggbmV3IEF0b21pY0JvbmQoIHRoaXMuY2FyYm9uQXRvbSwgdGhpcy5oeWRyb2dlbkF0b20zICkgKTtcclxuICAgIHRoaXMuYWRkQXRvbWljQm9uZCggbmV3IEF0b21pY0JvbmQoIHRoaXMuY2FyYm9uQXRvbSwgdGhpcy5oeWRyb2dlbkF0b200LCB7IHRvcExheWVyOiB0cnVlLCBhdG9tMVBvc2l0aW9uT2Zmc2V0OiBuZXcgVmVjdG9yMiggUEVSU1BFQ1RJVkVfT0ZGU0VUIC8gMiwgLVBFUlNQRUNUSVZFX09GRlNFVCApIH0gKSApO1xyXG5cclxuICAgIC8vIFNldCB1cCB0aGUgcGhvdG9uIHdhdmVsZW5ndGhzIHRvIGFic29yYi5cclxuICAgIHRoaXMuc2V0UGhvdG9uQWJzb3JwdGlvblN0cmF0ZWd5KCBXYXZlbGVuZ3RoQ29uc3RhbnRzLklSX1dBVkVMRU5HVEgsIG5ldyBWaWJyYXRpb25TdHJhdGVneSggdGhpcyApICk7XHJcblxyXG4gICAgLy8gU2V0IHRoZSBpbml0aWFsIG9mZnNldHMuXHJcbiAgICB0aGlzLmluaXRpYWxpemVBdG9tT2Zmc2V0cygpO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCB0aGUgaW5pdGlhbCBwb3NpdGlvbnMgb2YgdGhlIGF0b21zIHdoaWNoIGNvbXBvc2UgdGhpcyBtb2xlY3VsZS5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqL1xyXG4gIGluaXRpYWxpemVBdG9tT2Zmc2V0cygpIHtcclxuXHJcbiAgICB0aGlzLmFkZEluaXRpYWxBdG9tQ29nT2Zmc2V0KCB0aGlzLmNhcmJvbkF0b20sIG5ldyBWZWN0b3IyKCAwLCAwICkgKTtcclxuICAgIHRoaXMuYWRkSW5pdGlhbEF0b21Db2dPZmZzZXQoIHRoaXMuaHlkcm9nZW5BdG9tMSwgbmV3IFZlY3RvcjIoIC0wLFxyXG4gICAgICBJTklUSUFMX0NBUkJPTl9IWURST0dFTl9ESVNUQU5DRSApICk7XHJcbiAgICB0aGlzLmFkZEluaXRpYWxBdG9tQ29nT2Zmc2V0KCB0aGlzLmh5ZHJvZ2VuQXRvbTIsIG5ldyBWZWN0b3IyKCBST1RBVEVEX0hPUklaT05UQUxfSU5JVElBTF9DQVJCT05fSFlEUk9HRU5fRElTVEFOQ0UsXHJcbiAgICAgIC1ST1RBVEVEX1ZFUlRJQ0FMX0lOSVRJQUxfQ0FSQk9OX0hZRFJPR0VOX0RJU1RBTkNFICkgKTtcclxuICAgIHRoaXMuYWRkSW5pdGlhbEF0b21Db2dPZmZzZXQoIHRoaXMuaHlkcm9nZW5BdG9tMywgbmV3IFZlY3RvcjIoIC1ST1RBVEVEX0hPUklaT05UQUxfSU5JVElBTF9DQVJCT05fSFlEUk9HRU5fRElTVEFOQ0UsXHJcbiAgICAgIC1ST1RBVEVEX1ZFUlRJQ0FMX0lOSVRJQUxfQ0FSQk9OX0hZRFJPR0VOX0RJU1RBTkNFICsgUEVSU1BFQ1RJVkVfT0ZGU0VUICkgKTtcclxuICAgIHRoaXMuYWRkSW5pdGlhbEF0b21Db2dPZmZzZXQoIHRoaXMuaHlkcm9nZW5BdG9tNCwgbmV3IFZlY3RvcjIoIFBFUlNQRUNUSVZFX09GRlNFVCxcclxuICAgICAgLUlOSVRJQUxfQ0FSQk9OX0hZRFJPR0VOX0RJU1RBTkNFICsgUEVSU1BFQ1RJVkVfT0ZGU0VUICkgKTtcclxuXHJcbiAgICB0aGlzLnVwZGF0ZUF0b21Qb3NpdGlvbnMoKTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIHZpYnJhdGlvbiBiZWhhdmlvciBmb3IgdGhpcyBDSDQgbW9sZWN1bGUuIEluaXRpYWxpemUgYW5kIHNldCBjZW50ZXIgb2YgZ3Jhdml0eSBwb3NpdGlvbiBvZmZzZXRzIGZvciB0aGVcclxuICAgKiBjb21wb3NpbmcgYXRvbXMgaW4gaXRzIHZpYnJhdGlvbiBjeWNsZS5cclxuICAgKiBAcHVibGljXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge251bWJlcn0gdmlicmF0aW9uUmFkaWFucyAtIFdoZXJlIHRoaXMgbW9sZWN1bGUgaXMgaW4gaXRzIHZpYnJhdGlvbiBjeWNsZSBpbiByYWRpYW5zLlxyXG4gICAqL1xyXG4gIHNldFZpYnJhdGlvbiggdmlicmF0aW9uUmFkaWFucyApIHtcclxuXHJcbiAgICAvLyBzdXBlci5zZXRWaWJyYXRpb24oIHZpYnJhdGlvblJhZGlhbnMgKTtcclxuXHJcbiAgICB0aGlzLmN1cnJlbnRWaWJyYXRpb25SYWRpYW5zUHJvcGVydHkuc2V0KCB2aWJyYXRpb25SYWRpYW5zICk7XHJcbiAgICBjb25zdCBtdWx0RmFjdG9yID0gMS41ICogTWF0aC5zaW4oIHZpYnJhdGlvblJhZGlhbnMgKTtcclxuXHJcbiAgICBpZiAoIHZpYnJhdGlvblJhZGlhbnMgIT09IDAgKSB7XHJcblxyXG4gICAgICB0aGlzLmFkZEluaXRpYWxBdG9tQ29nT2Zmc2V0KCB0aGlzLmh5ZHJvZ2VuQXRvbTEsIG5ldyBWZWN0b3IyKCBtdWx0RmFjdG9yICogSFlEUk9HRU5fVklCUkFUSU9OX0RJU1RBTkNFX1gsXHJcbiAgICAgICAgSU5JVElBTF9DQVJCT05fSFlEUk9HRU5fRElTVEFOQ0UgKyAtTWF0aC5hYnMoIG11bHRGYWN0b3IgKSAqIEhZRFJPR0VOX1ZJQlJBVElPTl9ESVNUQU5DRV9ZICkgKTtcclxuICAgICAgdGhpcy5hZGRJbml0aWFsQXRvbUNvZ09mZnNldCggdGhpcy5oeWRyb2dlbkF0b20yLCBuZXcgVmVjdG9yMiggUk9UQVRFRF9IT1JJWk9OVEFMX0lOSVRJQUxfQ0FSQk9OX0hZRFJPR0VOX0RJU1RBTkNFICsgbXVsdEZhY3RvciAqIEhZRFJPR0VOX1ZJQlJBVElPTl9ESVNUQU5DRV9YLFxyXG4gICAgICAgIC1ST1RBVEVEX1ZFUlRJQ0FMX0lOSVRJQUxfQ0FSQk9OX0hZRFJPR0VOX0RJU1RBTkNFIC0gbXVsdEZhY3RvciAqIEhZRFJPR0VOX1ZJQlJBVElPTl9ESVNUQU5DRV9ZICkgKTtcclxuICAgICAgdGhpcy5hZGRJbml0aWFsQXRvbUNvZ09mZnNldCggdGhpcy5oeWRyb2dlbkF0b20zLCBuZXcgVmVjdG9yMiggLVJPVEFURURfSE9SSVpPTlRBTF9JTklUSUFMX0NBUkJPTl9IWURST0dFTl9ESVNUQU5DRSAtIG11bHRGYWN0b3IgKiBIWURST0dFTl9WSUJSQVRJT05fRElTVEFOQ0VfWCxcclxuICAgICAgICAtUk9UQVRFRF9WRVJUSUNBTF9JTklUSUFMX0NBUkJPTl9IWURST0dFTl9ESVNUQU5DRSAtIG11bHRGYWN0b3IgKiBIWURST0dFTl9WSUJSQVRJT05fRElTVEFOQ0VfWSArIFBFUlNQRUNUSVZFX09GRlNFVCApICk7XHJcbiAgICAgIHRoaXMuYWRkSW5pdGlhbEF0b21Db2dPZmZzZXQoIHRoaXMuaHlkcm9nZW5BdG9tNCwgbmV3IFZlY3RvcjIoIFBFUlNQRUNUSVZFX09GRlNFVCArIG11bHRGYWN0b3IgKiBIWURST0dFTl9WSUJSQVRJT05fRElTVEFOQ0VfWCxcclxuICAgICAgICAtSU5JVElBTF9DQVJCT05fSFlEUk9HRU5fRElTVEFOQ0UgKyBNYXRoLmFicyggbXVsdEZhY3RvciApICogSFlEUk9HRU5fVklCUkFUSU9OX0RJU1RBTkNFX1kgKyBQRVJTUEVDVElWRV9PRkZTRVQgKSApO1xyXG5cclxuICAgICAgLy8gUG9zaXRpb24gdGhlIGNhcmJvbiBhdG9tIHNvIHRoYXQgdGhlIGNlbnRlciBvZiBtYXNzIG9mIHRoZSBtb2xlY3VsZSByZW1haW5zIHRoZSBzYW1lLlxyXG4gICAgICBjb25zdCBjYXJib25YUG9zID0gLSggdGhpcy5oeWRyb2dlbkF0b20xLm1hc3MgLyB0aGlzLmNhcmJvbkF0b20ubWFzcyApICpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICggdGhpcy5nZXRJbml0aWFsQXRvbUNvZ09mZnNldCggdGhpcy5oeWRyb2dlbkF0b20xICkueCArIHRoaXMuZ2V0SW5pdGlhbEF0b21Db2dPZmZzZXQoIHRoaXMuaHlkcm9nZW5BdG9tMiApLnggK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEluaXRpYWxBdG9tQ29nT2Zmc2V0KCB0aGlzLmh5ZHJvZ2VuQXRvbTMgKS54ICsgdGhpcy5nZXRJbml0aWFsQXRvbUNvZ09mZnNldCggdGhpcy5oeWRyb2dlbkF0b200ICkueCApO1xyXG4gICAgICBjb25zdCBjYXJib25ZUG9zID0gLSggdGhpcy5oeWRyb2dlbkF0b20xLm1hc3MgLyB0aGlzLmNhcmJvbkF0b20ubWFzcyApICpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICggdGhpcy5nZXRJbml0aWFsQXRvbUNvZ09mZnNldCggdGhpcy5oeWRyb2dlbkF0b20xICkueSArIHRoaXMuZ2V0SW5pdGlhbEF0b21Db2dPZmZzZXQoIHRoaXMuaHlkcm9nZW5BdG9tMiApLnkgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldEluaXRpYWxBdG9tQ29nT2Zmc2V0KCB0aGlzLmh5ZHJvZ2VuQXRvbTMgKS55ICsgdGhpcy5nZXRJbml0aWFsQXRvbUNvZ09mZnNldCggdGhpcy5oeWRyb2dlbkF0b200ICkueSApO1xyXG4gICAgICB0aGlzLmFkZEluaXRpYWxBdG9tQ29nT2Zmc2V0KCB0aGlzLmNhcmJvbkF0b20sIG5ldyBWZWN0b3IyKCBjYXJib25YUG9zLCBjYXJib25ZUG9zICkgKTtcclxuICAgIH1cclxuXHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5pbml0aWFsaXplQXRvbU9mZnNldHMoKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnVwZGF0ZUF0b21Qb3NpdGlvbnMoKTtcclxuICB9XHJcbn1cclxuXHJcbmdyZWVuaG91c2VFZmZlY3QucmVnaXN0ZXIoICdDSDQnLCBDSDQgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IENINDsiXSwibWFwcGluZ3Mi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