// Copyright 2022, University of Colorado Boulder

/**
 * SolarIntensitySoundPlayer is used to produce sounds for the slider that controls photon intensity.  It is
 * basically just a sound clip with a high-pass filter in the signal chain.
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import SoundClip from '../../../../tambo/js/sound-generators/SoundClip.js';
import greenhouseEffect from '../../greenhouseEffect.js';
import optionize from '../../../../phet-core/js/optionize.js';
import layerModelBaseSliderSound_mp3 from '../../../sounds/layerModelBaseSliderSound_mp3.js';
import phetAudioContext from '../../../../tambo/js/phetAudioContext.js';
import SoundGenerator from '../../../../tambo/js/sound-generators/SoundGenerator.js';

// types for options

class SolarIntensitySoundPlayer extends SoundGenerator {
  // sound clip played for sounds in the middle, i.e. not at either the min or max
  middleSoundClip = new SoundClip(layerModelBaseSliderSound_mp3);

  // sound clip played at min and max values
  boundarySoundClip = new SoundClip(layerModelBaseSliderSound_mp3, {
    initialPlaybackRate: 0.667
  });
  constructor(solarIntensityProperty, solarIntensityRange, providedOptions) {
    const options = optionize()({}, providedOptions);
    super(options);

    // Make the parameters available to the methods.
    this.solarIntensityProperty = solarIntensityProperty;
    this.solarIntensityRange = solarIntensityRange;

    // Create a low-pass filter that will change as the solar intensity changes.
    const lowPassFilter = new BiquadFilterNode(phetAudioContext);
    lowPassFilter.type = 'lowpass';

    // Connect the filter to the audio output path.
    lowPassFilter.connect(this.masterGainNode);

    // Adjust the cutoff frequency of the filter as the solar intensity changes.
    solarIntensityProperty.link(solarIntensity => {
      const normalizedSolarIntensity = (solarIntensity - solarIntensityRange.min) / solarIntensityRange.getLength();

      // Map the solar intensity into a cutoff frequency.  This is a very empirical mapping, and is quite dependent on
      // the frequency content of the underlying sound, so feel free to adjust as needed.
      const cutoffFrequency = Math.max(Math.pow(normalizedSolarIntensity, 2) * 5000, 300);

      // Set the cutoff frequency.
      lowPassFilter.frequency.setTargetAtTime(cutoffFrequency, phetAudioContext.currentTime, 0.015);
    });

    // Hook up the sound clips to the filter.
    this.middleSoundClip.connect(lowPassFilter);
    this.boundarySoundClip.connect(lowPassFilter);
  }

  /**
   * Play the boundary sound if at the min or max of the range, or the middle sound if not.
   */
  play() {
    const solarIntensity = this.solarIntensityProperty.value;
    if (solarIntensity > this.solarIntensityRange.min && solarIntensity < this.solarIntensityRange.max) {
      this.middleSoundClip.play();
    } else {
      this.boundarySoundClip.play();
    }
  }

  /**
   * Stop the sounds.  This isn't expected to be used much in this context, it's here primarily to complete the
   * TSoundPlayer interface.
   */
  stop() {
    this.middleSoundClip.stop();
    this.boundarySoundClip.stop();
  }
}
greenhouseEffect.register('SolarIntensitySoundPlayer', SolarIntensitySoundPlayer);
export default SolarIntensitySoundPlayer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTb3VuZENsaXAiLCJncmVlbmhvdXNlRWZmZWN0Iiwib3B0aW9uaXplIiwibGF5ZXJNb2RlbEJhc2VTbGlkZXJTb3VuZF9tcDMiLCJwaGV0QXVkaW9Db250ZXh0IiwiU291bmRHZW5lcmF0b3IiLCJTb2xhckludGVuc2l0eVNvdW5kUGxheWVyIiwibWlkZGxlU291bmRDbGlwIiwiYm91bmRhcnlTb3VuZENsaXAiLCJpbml0aWFsUGxheWJhY2tSYXRlIiwiY29uc3RydWN0b3IiLCJzb2xhckludGVuc2l0eVByb3BlcnR5Iiwic29sYXJJbnRlbnNpdHlSYW5nZSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJsb3dQYXNzRmlsdGVyIiwiQmlxdWFkRmlsdGVyTm9kZSIsInR5cGUiLCJjb25uZWN0IiwibWFzdGVyR2Fpbk5vZGUiLCJsaW5rIiwic29sYXJJbnRlbnNpdHkiLCJub3JtYWxpemVkU29sYXJJbnRlbnNpdHkiLCJtaW4iLCJnZXRMZW5ndGgiLCJjdXRvZmZGcmVxdWVuY3kiLCJNYXRoIiwibWF4IiwicG93IiwiZnJlcXVlbmN5Iiwic2V0VGFyZ2V0QXRUaW1lIiwiY3VycmVudFRpbWUiLCJwbGF5IiwidmFsdWUiLCJzdG9wIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJTb2xhckludGVuc2l0eVNvdW5kUGxheWVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTb2xhckludGVuc2l0eVNvdW5kUGxheWVyIGlzIHVzZWQgdG8gcHJvZHVjZSBzb3VuZHMgZm9yIHRoZSBzbGlkZXIgdGhhdCBjb250cm9scyBwaG90b24gaW50ZW5zaXR5LiAgSXQgaXNcclxuICogYmFzaWNhbGx5IGp1c3QgYSBzb3VuZCBjbGlwIHdpdGggYSBoaWdoLXBhc3MgZmlsdGVyIGluIHRoZSBzaWduYWwgY2hhaW4uXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFJhbmdlIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBTb3VuZENsaXAgZnJvbSAnLi4vLi4vLi4vLi4vdGFtYm8vanMvc291bmQtZ2VuZXJhdG9ycy9Tb3VuZENsaXAuanMnO1xyXG5pbXBvcnQgZ3JlZW5ob3VzZUVmZmVjdCBmcm9tICcuLi8uLi9ncmVlbmhvdXNlRWZmZWN0LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IGxheWVyTW9kZWxCYXNlU2xpZGVyU291bmRfbXAzIGZyb20gJy4uLy4uLy4uL3NvdW5kcy9sYXllck1vZGVsQmFzZVNsaWRlclNvdW5kX21wMy5qcyc7XHJcbmltcG9ydCBwaGV0QXVkaW9Db250ZXh0IGZyb20gJy4uLy4uLy4uLy4uL3RhbWJvL2pzL3BoZXRBdWRpb0NvbnRleHQuanMnO1xyXG5pbXBvcnQgVFNvdW5kUGxheWVyIGZyb20gJy4uLy4uLy4uLy4uL3RhbWJvL2pzL1RTb3VuZFBsYXllci5qcyc7XHJcbmltcG9ydCBTb3VuZEdlbmVyYXRvciwgeyBTb3VuZEdlbmVyYXRvck9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi90YW1iby9qcy9zb3VuZC1nZW5lcmF0b3JzL1NvdW5kR2VuZXJhdG9yLmpzJztcclxuXHJcbi8vIHR5cGVzIGZvciBvcHRpb25zXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSBFbXB0eVNlbGZPcHRpb25zO1xyXG50eXBlIFNvbGFySW50ZW5zaXR5U291bmRQbGF5ZXJPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTb3VuZEdlbmVyYXRvck9wdGlvbnM7XHJcblxyXG5jbGFzcyBTb2xhckludGVuc2l0eVNvdW5kUGxheWVyIGV4dGVuZHMgU291bmRHZW5lcmF0b3IgaW1wbGVtZW50cyBUU291bmRQbGF5ZXIge1xyXG5cclxuICAvLyBzb3VuZCBjbGlwIHBsYXllZCBmb3Igc291bmRzIGluIHRoZSBtaWRkbGUsIGkuZS4gbm90IGF0IGVpdGhlciB0aGUgbWluIG9yIG1heFxyXG4gIHByaXZhdGUgcmVhZG9ubHkgbWlkZGxlU291bmRDbGlwOiBTb3VuZENsaXAgPSBuZXcgU291bmRDbGlwKCBsYXllck1vZGVsQmFzZVNsaWRlclNvdW5kX21wMyApO1xyXG5cclxuICAvLyBzb3VuZCBjbGlwIHBsYXllZCBhdCBtaW4gYW5kIG1heCB2YWx1ZXNcclxuICBwcml2YXRlIHJlYWRvbmx5IGJvdW5kYXJ5U291bmRDbGlwOiBTb3VuZENsaXAgPSBuZXcgU291bmRDbGlwKCBsYXllck1vZGVsQmFzZVNsaWRlclNvdW5kX21wMywge1xyXG4gICAgICBpbml0aWFsUGxheWJhY2tSYXRlOiAwLjY2N1xyXG4gICAgfVxyXG4gICk7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgc29sYXJJbnRlbnNpdHlQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHk7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBzb2xhckludGVuc2l0eVJhbmdlOiBSYW5nZTtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBzb2xhckludGVuc2l0eVByb3BlcnR5OiBOdW1iZXJQcm9wZXJ0eSxcclxuICAgICAgICAgICAgICAgICAgICAgIHNvbGFySW50ZW5zaXR5UmFuZ2U6IFJhbmdlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWRPcHRpb25zPzogU29sYXJJbnRlbnNpdHlTb3VuZFBsYXllck9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxTb2xhckludGVuc2l0eVNvdW5kUGxheWVyT3B0aW9ucywgU2VsZk9wdGlvbnMsIFNvdW5kR2VuZXJhdG9yT3B0aW9ucz4oKSgge30sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gTWFrZSB0aGUgcGFyYW1ldGVycyBhdmFpbGFibGUgdG8gdGhlIG1ldGhvZHMuXHJcbiAgICB0aGlzLnNvbGFySW50ZW5zaXR5UHJvcGVydHkgPSBzb2xhckludGVuc2l0eVByb3BlcnR5O1xyXG4gICAgdGhpcy5zb2xhckludGVuc2l0eVJhbmdlID0gc29sYXJJbnRlbnNpdHlSYW5nZTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSBsb3ctcGFzcyBmaWx0ZXIgdGhhdCB3aWxsIGNoYW5nZSBhcyB0aGUgc29sYXIgaW50ZW5zaXR5IGNoYW5nZXMuXHJcbiAgICBjb25zdCBsb3dQYXNzRmlsdGVyID0gbmV3IEJpcXVhZEZpbHRlck5vZGUoIHBoZXRBdWRpb0NvbnRleHQgKTtcclxuICAgIGxvd1Bhc3NGaWx0ZXIudHlwZSA9ICdsb3dwYXNzJztcclxuXHJcbiAgICAvLyBDb25uZWN0IHRoZSBmaWx0ZXIgdG8gdGhlIGF1ZGlvIG91dHB1dCBwYXRoLlxyXG4gICAgbG93UGFzc0ZpbHRlci5jb25uZWN0KCB0aGlzLm1hc3RlckdhaW5Ob2RlICk7XHJcblxyXG4gICAgLy8gQWRqdXN0IHRoZSBjdXRvZmYgZnJlcXVlbmN5IG9mIHRoZSBmaWx0ZXIgYXMgdGhlIHNvbGFyIGludGVuc2l0eSBjaGFuZ2VzLlxyXG4gICAgc29sYXJJbnRlbnNpdHlQcm9wZXJ0eS5saW5rKCBzb2xhckludGVuc2l0eSA9PiB7XHJcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWRTb2xhckludGVuc2l0eSA9ICggc29sYXJJbnRlbnNpdHkgLSBzb2xhckludGVuc2l0eVJhbmdlLm1pbiApIC8gc29sYXJJbnRlbnNpdHlSYW5nZS5nZXRMZW5ndGgoKTtcclxuXHJcbiAgICAgIC8vIE1hcCB0aGUgc29sYXIgaW50ZW5zaXR5IGludG8gYSBjdXRvZmYgZnJlcXVlbmN5LiAgVGhpcyBpcyBhIHZlcnkgZW1waXJpY2FsIG1hcHBpbmcsIGFuZCBpcyBxdWl0ZSBkZXBlbmRlbnQgb25cclxuICAgICAgLy8gdGhlIGZyZXF1ZW5jeSBjb250ZW50IG9mIHRoZSB1bmRlcmx5aW5nIHNvdW5kLCBzbyBmZWVsIGZyZWUgdG8gYWRqdXN0IGFzIG5lZWRlZC5cclxuICAgICAgY29uc3QgY3V0b2ZmRnJlcXVlbmN5ID0gTWF0aC5tYXgoIE1hdGgucG93KCBub3JtYWxpemVkU29sYXJJbnRlbnNpdHksIDIgKSAqIDUwMDAsIDMwMCApO1xyXG5cclxuICAgICAgLy8gU2V0IHRoZSBjdXRvZmYgZnJlcXVlbmN5LlxyXG4gICAgICBsb3dQYXNzRmlsdGVyLmZyZXF1ZW5jeS5zZXRUYXJnZXRBdFRpbWUoIGN1dG9mZkZyZXF1ZW5jeSwgcGhldEF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSwgMC4wMTUgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBIb29rIHVwIHRoZSBzb3VuZCBjbGlwcyB0byB0aGUgZmlsdGVyLlxyXG4gICAgdGhpcy5taWRkbGVTb3VuZENsaXAuY29ubmVjdCggbG93UGFzc0ZpbHRlciApO1xyXG4gICAgdGhpcy5ib3VuZGFyeVNvdW5kQ2xpcC5jb25uZWN0KCBsb3dQYXNzRmlsdGVyICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQbGF5IHRoZSBib3VuZGFyeSBzb3VuZCBpZiBhdCB0aGUgbWluIG9yIG1heCBvZiB0aGUgcmFuZ2UsIG9yIHRoZSBtaWRkbGUgc291bmQgaWYgbm90LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBwbGF5KCk6IHZvaWQge1xyXG4gICAgY29uc3Qgc29sYXJJbnRlbnNpdHkgPSB0aGlzLnNvbGFySW50ZW5zaXR5UHJvcGVydHkudmFsdWU7XHJcbiAgICBpZiAoIHNvbGFySW50ZW5zaXR5ID4gdGhpcy5zb2xhckludGVuc2l0eVJhbmdlLm1pbiAmJiBzb2xhckludGVuc2l0eSA8IHRoaXMuc29sYXJJbnRlbnNpdHlSYW5nZS5tYXggKSB7XHJcbiAgICAgIHRoaXMubWlkZGxlU291bmRDbGlwLnBsYXkoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLmJvdW5kYXJ5U291bmRDbGlwLnBsYXkoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0b3AgdGhlIHNvdW5kcy4gIFRoaXMgaXNuJ3QgZXhwZWN0ZWQgdG8gYmUgdXNlZCBtdWNoIGluIHRoaXMgY29udGV4dCwgaXQncyBoZXJlIHByaW1hcmlseSB0byBjb21wbGV0ZSB0aGVcclxuICAgKiBUU291bmRQbGF5ZXIgaW50ZXJmYWNlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdG9wKCk6IHZvaWQge1xyXG4gICAgdGhpcy5taWRkbGVTb3VuZENsaXAuc3RvcCgpO1xyXG4gICAgdGhpcy5ib3VuZGFyeVNvdW5kQ2xpcC5zdG9wKCk7XHJcbiAgfVxyXG59XHJcblxyXG5ncmVlbmhvdXNlRWZmZWN0LnJlZ2lzdGVyKCAnU29sYXJJbnRlbnNpdHlTb3VuZFBsYXllcicsIFNvbGFySW50ZW5zaXR5U291bmRQbGF5ZXIgKTtcclxuZXhwb3J0IGRlZmF1bHQgU29sYXJJbnRlbnNpdHlTb3VuZFBsYXllcjsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFHQSxPQUFPQSxTQUFTLE1BQU0sb0RBQW9EO0FBQzFFLE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxPQUFPQyxTQUFTLE1BQTRCLHVDQUF1QztBQUVuRixPQUFPQyw2QkFBNkIsTUFBTSxrREFBa0Q7QUFDNUYsT0FBT0MsZ0JBQWdCLE1BQU0sMENBQTBDO0FBRXZFLE9BQU9DLGNBQWMsTUFBaUMseURBQXlEOztBQUUvRzs7QUFJQSxNQUFNQyx5QkFBeUIsU0FBU0QsY0FBYyxDQUF5QjtFQUU3RTtFQUNpQkUsZUFBZSxHQUFjLElBQUlQLFNBQVMsQ0FBRUcsNkJBQThCLENBQUM7O0VBRTVGO0VBQ2lCSyxpQkFBaUIsR0FBYyxJQUFJUixTQUFTLENBQUVHLDZCQUE2QixFQUFFO0lBQzFGTSxtQkFBbUIsRUFBRTtFQUN2QixDQUNGLENBQUM7RUFLTUMsV0FBV0EsQ0FBRUMsc0JBQXNDLEVBQ3RDQyxtQkFBMEIsRUFDMUJDLGVBQWtELEVBQUc7SUFFdkUsTUFBTUMsT0FBTyxHQUFHWixTQUFTLENBQXVFLENBQUMsQ0FBRSxDQUFDLENBQUMsRUFBRVcsZUFBZ0IsQ0FBQztJQUV4SCxLQUFLLENBQUVDLE9BQVEsQ0FBQzs7SUFFaEI7SUFDQSxJQUFJLENBQUNILHNCQUFzQixHQUFHQSxzQkFBc0I7SUFDcEQsSUFBSSxDQUFDQyxtQkFBbUIsR0FBR0EsbUJBQW1COztJQUU5QztJQUNBLE1BQU1HLGFBQWEsR0FBRyxJQUFJQyxnQkFBZ0IsQ0FBRVosZ0JBQWlCLENBQUM7SUFDOURXLGFBQWEsQ0FBQ0UsSUFBSSxHQUFHLFNBQVM7O0lBRTlCO0lBQ0FGLGFBQWEsQ0FBQ0csT0FBTyxDQUFFLElBQUksQ0FBQ0MsY0FBZSxDQUFDOztJQUU1QztJQUNBUixzQkFBc0IsQ0FBQ1MsSUFBSSxDQUFFQyxjQUFjLElBQUk7TUFDN0MsTUFBTUMsd0JBQXdCLEdBQUcsQ0FBRUQsY0FBYyxHQUFHVCxtQkFBbUIsQ0FBQ1csR0FBRyxJQUFLWCxtQkFBbUIsQ0FBQ1ksU0FBUyxDQUFDLENBQUM7O01BRS9HO01BQ0E7TUFDQSxNQUFNQyxlQUFlLEdBQUdDLElBQUksQ0FBQ0MsR0FBRyxDQUFFRCxJQUFJLENBQUNFLEdBQUcsQ0FBRU4sd0JBQXdCLEVBQUUsQ0FBRSxDQUFDLEdBQUcsSUFBSSxFQUFFLEdBQUksQ0FBQzs7TUFFdkY7TUFDQVAsYUFBYSxDQUFDYyxTQUFTLENBQUNDLGVBQWUsQ0FBRUwsZUFBZSxFQUFFckIsZ0JBQWdCLENBQUMyQixXQUFXLEVBQUUsS0FBTSxDQUFDO0lBQ2pHLENBQUUsQ0FBQzs7SUFFSDtJQUNBLElBQUksQ0FBQ3hCLGVBQWUsQ0FBQ1csT0FBTyxDQUFFSCxhQUFjLENBQUM7SUFDN0MsSUFBSSxDQUFDUCxpQkFBaUIsQ0FBQ1UsT0FBTyxDQUFFSCxhQUFjLENBQUM7RUFDakQ7O0VBRUE7QUFDRjtBQUNBO0VBQ1NpQixJQUFJQSxDQUFBLEVBQVM7SUFDbEIsTUFBTVgsY0FBYyxHQUFHLElBQUksQ0FBQ1Ysc0JBQXNCLENBQUNzQixLQUFLO0lBQ3hELElBQUtaLGNBQWMsR0FBRyxJQUFJLENBQUNULG1CQUFtQixDQUFDVyxHQUFHLElBQUlGLGNBQWMsR0FBRyxJQUFJLENBQUNULG1CQUFtQixDQUFDZSxHQUFHLEVBQUc7TUFDcEcsSUFBSSxDQUFDcEIsZUFBZSxDQUFDeUIsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQyxNQUNJO01BQ0gsSUFBSSxDQUFDeEIsaUJBQWlCLENBQUN3QixJQUFJLENBQUMsQ0FBQztJQUMvQjtFQUNGOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0VBQ1NFLElBQUlBLENBQUEsRUFBUztJQUNsQixJQUFJLENBQUMzQixlQUFlLENBQUMyQixJQUFJLENBQUMsQ0FBQztJQUMzQixJQUFJLENBQUMxQixpQkFBaUIsQ0FBQzBCLElBQUksQ0FBQyxDQUFDO0VBQy9CO0FBQ0Y7QUFFQWpDLGdCQUFnQixDQUFDa0MsUUFBUSxDQUFFLDJCQUEyQixFQUFFN0IseUJBQTBCLENBQUM7QUFDbkYsZUFBZUEseUJBQXlCIn0=