// Copyright 2022, University of Colorado Boulder

/**
 * IrAbsorbanceSoundPlayer is used to produce sounds for the slider that controls the infrared (IR) absorbance of a set
 * of IR-absorbing layers in an atmosphere.  It does this by cross-fading between two sound clips.
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import SoundClip from '../../../../tambo/js/sound-generators/SoundClip.js';
import greenhouseEffect from '../../greenhouseEffect.js';
import SoundGenerator from '../../../../tambo/js/sound-generators/SoundGenerator.js';
import layerModelBaseSliderSound_mp3 from '../../../sounds/layerModelBaseSliderSound_mp3.js';
import phetAudioContext from '../../../../tambo/js/phetAudioContext.js';

// types for options

class IrAbsorbanceSoundPlayer extends SoundGenerator {
  // sound clip played for sounds in the middle, i.e. not at either the min or max
  // private readonly middleSoundClip: SoundClip = new SoundClip( layerModelBaseSliderSound_mp3 );
  middleSoundClip = new SoundClip(layerModelBaseSliderSound_mp3, {
    initialPlaybackRate: 1 / Math.pow(2, 1 / 6) // one musical step below the natural playback rate
  });

  // sound clip played at min and max values
  boundarySoundClip = new SoundClip(layerModelBaseSliderSound_mp3, {
    initialPlaybackRate: 0.667
  });
  constructor(irAbsorbanceProperty, irAbsorbanceRange, providedOptions) {
    super(providedOptions);

    // Make the parameters available to the methods.
    this.irAbsorbanceProperty = irAbsorbanceProperty;
    this.irAbsorbanceRange = irAbsorbanceRange;

    // Create a low-pass filter that will change as the solar intensity changes.
    const lowPassFilter = new BiquadFilterNode(phetAudioContext);
    lowPassFilter.type = 'lowpass';

    // Connect the filter to the audio output path.
    lowPassFilter.connect(this.masterGainNode);

    // Adjust the cutoff frequency of the filter as the solar intensity changes.
    irAbsorbanceProperty.link(solarIntensity => {
      const normalizedIrAbsorbance = (solarIntensity - irAbsorbanceRange.min) / irAbsorbanceRange.getLength();

      // Map the IR absorbance into a cutoff frequency.  This is a very empirical mapping, and is quite dependent on
      // the frequency content of the underlying sound, so feel free to adjust as needed.
      const cutoffFrequency = Math.pow(1 - 0.75 * normalizedIrAbsorbance, 3) * 8000;

      // Set the cutoff frequency.
      lowPassFilter.frequency.setTargetAtTime(cutoffFrequency, phetAudioContext.currentTime, 0.015);
    });

    // Hook up the sound clips to the filter.
    this.middleSoundClip.connect(lowPassFilter);
    this.boundarySoundClip.connect(lowPassFilter);
  }

  /**
   * Play the sound.
   */
  play() {
    const irAbsorbance = this.irAbsorbanceProperty.value;
    if (irAbsorbance > this.irAbsorbanceRange.min && irAbsorbance < this.irAbsorbanceRange.max) {
      this.middleSoundClip.play();
    } else {
      this.boundarySoundClip.play();
    }
  }

  /**
   * Stop the sounds.  This isn't expected to be used much, but is necessary for the TSoundPlayer interface.
   */
  stop() {
    this.middleSoundClip.stop();
    this.boundarySoundClip.stop();
  }
}
greenhouseEffect.register('IrAbsorbanceSoundPlayer', IrAbsorbanceSoundPlayer);
export default IrAbsorbanceSoundPlayer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTb3VuZENsaXAiLCJncmVlbmhvdXNlRWZmZWN0IiwiU291bmRHZW5lcmF0b3IiLCJsYXllck1vZGVsQmFzZVNsaWRlclNvdW5kX21wMyIsInBoZXRBdWRpb0NvbnRleHQiLCJJckFic29yYmFuY2VTb3VuZFBsYXllciIsIm1pZGRsZVNvdW5kQ2xpcCIsImluaXRpYWxQbGF5YmFja1JhdGUiLCJNYXRoIiwicG93IiwiYm91bmRhcnlTb3VuZENsaXAiLCJjb25zdHJ1Y3RvciIsImlyQWJzb3JiYW5jZVByb3BlcnR5IiwiaXJBYnNvcmJhbmNlUmFuZ2UiLCJwcm92aWRlZE9wdGlvbnMiLCJsb3dQYXNzRmlsdGVyIiwiQmlxdWFkRmlsdGVyTm9kZSIsInR5cGUiLCJjb25uZWN0IiwibWFzdGVyR2Fpbk5vZGUiLCJsaW5rIiwic29sYXJJbnRlbnNpdHkiLCJub3JtYWxpemVkSXJBYnNvcmJhbmNlIiwibWluIiwiZ2V0TGVuZ3RoIiwiY3V0b2ZmRnJlcXVlbmN5IiwiZnJlcXVlbmN5Iiwic2V0VGFyZ2V0QXRUaW1lIiwiY3VycmVudFRpbWUiLCJwbGF5IiwiaXJBYnNvcmJhbmNlIiwidmFsdWUiLCJtYXgiLCJzdG9wIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJJckFic29yYmFuY2VTb3VuZFBsYXllci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogSXJBYnNvcmJhbmNlU291bmRQbGF5ZXIgaXMgdXNlZCB0byBwcm9kdWNlIHNvdW5kcyBmb3IgdGhlIHNsaWRlciB0aGF0IGNvbnRyb2xzIHRoZSBpbmZyYXJlZCAoSVIpIGFic29yYmFuY2Ugb2YgYSBzZXRcclxuICogb2YgSVItYWJzb3JiaW5nIGxheWVycyBpbiBhbiBhdG1vc3BoZXJlLiAgSXQgZG9lcyB0aGlzIGJ5IGNyb3NzLWZhZGluZyBiZXR3ZWVuIHR3byBzb3VuZCBjbGlwcy5cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IFNvdW5kQ2xpcCwgeyBTb3VuZENsaXBPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vdGFtYm8vanMvc291bmQtZ2VuZXJhdG9ycy9Tb3VuZENsaXAuanMnO1xyXG5pbXBvcnQgZ3JlZW5ob3VzZUVmZmVjdCBmcm9tICcuLi8uLi9ncmVlbmhvdXNlRWZmZWN0LmpzJztcclxuaW1wb3J0IE51bWJlclByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTnVtYmVyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgU291bmRHZW5lcmF0b3IgZnJvbSAnLi4vLi4vLi4vLi4vdGFtYm8vanMvc291bmQtZ2VuZXJhdG9ycy9Tb3VuZEdlbmVyYXRvci5qcyc7XHJcbmltcG9ydCBUU291bmRQbGF5ZXIgZnJvbSAnLi4vLi4vLi4vLi4vdGFtYm8vanMvVFNvdW5kUGxheWVyLmpzJztcclxuaW1wb3J0IGxheWVyTW9kZWxCYXNlU2xpZGVyU291bmRfbXAzIGZyb20gJy4uLy4uLy4uL3NvdW5kcy9sYXllck1vZGVsQmFzZVNsaWRlclNvdW5kX21wMy5qcyc7XHJcbmltcG9ydCBwaGV0QXVkaW9Db250ZXh0IGZyb20gJy4uLy4uLy4uLy4uL3RhbWJvL2pzL3BoZXRBdWRpb0NvbnRleHQuanMnO1xyXG5pbXBvcnQgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcblxyXG4vLyB0eXBlcyBmb3Igb3B0aW9uc1xyXG50eXBlIFNlbGZPcHRpb25zID0gRW1wdHlTZWxmT3B0aW9ucztcclxudHlwZSBJckFic29yYmFuY2VTb3VuZFBsYXllck9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFNvdW5kQ2xpcE9wdGlvbnM7XHJcblxyXG5jbGFzcyBJckFic29yYmFuY2VTb3VuZFBsYXllciBleHRlbmRzIFNvdW5kR2VuZXJhdG9yIGltcGxlbWVudHMgVFNvdW5kUGxheWVyIHtcclxuXHJcbiAgLy8gc291bmQgY2xpcCBwbGF5ZWQgZm9yIHNvdW5kcyBpbiB0aGUgbWlkZGxlLCBpLmUuIG5vdCBhdCBlaXRoZXIgdGhlIG1pbiBvciBtYXhcclxuICAvLyBwcml2YXRlIHJlYWRvbmx5IG1pZGRsZVNvdW5kQ2xpcDogU291bmRDbGlwID0gbmV3IFNvdW5kQ2xpcCggbGF5ZXJNb2RlbEJhc2VTbGlkZXJTb3VuZF9tcDMgKTtcclxuICBwcml2YXRlIHJlYWRvbmx5IG1pZGRsZVNvdW5kQ2xpcDogU291bmRDbGlwID0gbmV3IFNvdW5kQ2xpcCggbGF5ZXJNb2RlbEJhc2VTbGlkZXJTb3VuZF9tcDMsIHtcclxuICAgIGluaXRpYWxQbGF5YmFja1JhdGU6IDEgLyBNYXRoLnBvdyggMiwgMSAvIDYgKSAvLyBvbmUgbXVzaWNhbCBzdGVwIGJlbG93IHRoZSBuYXR1cmFsIHBsYXliYWNrIHJhdGVcclxuICB9ICk7XHJcblxyXG4gIC8vIHNvdW5kIGNsaXAgcGxheWVkIGF0IG1pbiBhbmQgbWF4IHZhbHVlc1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgYm91bmRhcnlTb3VuZENsaXA6IFNvdW5kQ2xpcCA9IG5ldyBTb3VuZENsaXAoIGxheWVyTW9kZWxCYXNlU2xpZGVyU291bmRfbXAzLCB7XHJcbiAgICAgIGluaXRpYWxQbGF5YmFja1JhdGU6IDAuNjY3XHJcbiAgICB9XHJcbiAgKTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBpckFic29yYmFuY2VQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHk7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBpckFic29yYmFuY2VSYW5nZTogUmFuZ2U7XHJcblxyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGlyQWJzb3JiYW5jZVByb3BlcnR5OiBOdW1iZXJQcm9wZXJ0eSxcclxuICAgICAgICAgICAgICAgICAgICAgIGlyQWJzb3JiYW5jZVJhbmdlOiBSYW5nZSxcclxuICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVkT3B0aW9ucz86IElyQWJzb3JiYW5jZVNvdW5kUGxheWVyT3B0aW9ucyApIHtcclxuXHJcbiAgICBzdXBlciggcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gTWFrZSB0aGUgcGFyYW1ldGVycyBhdmFpbGFibGUgdG8gdGhlIG1ldGhvZHMuXHJcbiAgICB0aGlzLmlyQWJzb3JiYW5jZVByb3BlcnR5ID0gaXJBYnNvcmJhbmNlUHJvcGVydHk7XHJcbiAgICB0aGlzLmlyQWJzb3JiYW5jZVJhbmdlID0gaXJBYnNvcmJhbmNlUmFuZ2U7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgbG93LXBhc3MgZmlsdGVyIHRoYXQgd2lsbCBjaGFuZ2UgYXMgdGhlIHNvbGFyIGludGVuc2l0eSBjaGFuZ2VzLlxyXG4gICAgY29uc3QgbG93UGFzc0ZpbHRlciA9IG5ldyBCaXF1YWRGaWx0ZXJOb2RlKCBwaGV0QXVkaW9Db250ZXh0ICk7XHJcbiAgICBsb3dQYXNzRmlsdGVyLnR5cGUgPSAnbG93cGFzcyc7XHJcblxyXG4gICAgLy8gQ29ubmVjdCB0aGUgZmlsdGVyIHRvIHRoZSBhdWRpbyBvdXRwdXQgcGF0aC5cclxuICAgIGxvd1Bhc3NGaWx0ZXIuY29ubmVjdCggdGhpcy5tYXN0ZXJHYWluTm9kZSApO1xyXG5cclxuICAgIC8vIEFkanVzdCB0aGUgY3V0b2ZmIGZyZXF1ZW5jeSBvZiB0aGUgZmlsdGVyIGFzIHRoZSBzb2xhciBpbnRlbnNpdHkgY2hhbmdlcy5cclxuICAgIGlyQWJzb3JiYW5jZVByb3BlcnR5LmxpbmsoIHNvbGFySW50ZW5zaXR5ID0+IHtcclxuICAgICAgY29uc3Qgbm9ybWFsaXplZElyQWJzb3JiYW5jZSA9ICggc29sYXJJbnRlbnNpdHkgLSBpckFic29yYmFuY2VSYW5nZS5taW4gKSAvIGlyQWJzb3JiYW5jZVJhbmdlLmdldExlbmd0aCgpO1xyXG5cclxuICAgICAgLy8gTWFwIHRoZSBJUiBhYnNvcmJhbmNlIGludG8gYSBjdXRvZmYgZnJlcXVlbmN5LiAgVGhpcyBpcyBhIHZlcnkgZW1waXJpY2FsIG1hcHBpbmcsIGFuZCBpcyBxdWl0ZSBkZXBlbmRlbnQgb25cclxuICAgICAgLy8gdGhlIGZyZXF1ZW5jeSBjb250ZW50IG9mIHRoZSB1bmRlcmx5aW5nIHNvdW5kLCBzbyBmZWVsIGZyZWUgdG8gYWRqdXN0IGFzIG5lZWRlZC5cclxuICAgICAgY29uc3QgY3V0b2ZmRnJlcXVlbmN5ID0gTWF0aC5wb3coIDEgLSAwLjc1ICogbm9ybWFsaXplZElyQWJzb3JiYW5jZSwgMyApICogODAwMDtcclxuXHJcbiAgICAgIC8vIFNldCB0aGUgY3V0b2ZmIGZyZXF1ZW5jeS5cclxuICAgICAgbG93UGFzc0ZpbHRlci5mcmVxdWVuY3kuc2V0VGFyZ2V0QXRUaW1lKCBjdXRvZmZGcmVxdWVuY3ksIHBoZXRBdWRpb0NvbnRleHQuY3VycmVudFRpbWUsIDAuMDE1ICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gSG9vayB1cCB0aGUgc291bmQgY2xpcHMgdG8gdGhlIGZpbHRlci5cclxuICAgIHRoaXMubWlkZGxlU291bmRDbGlwLmNvbm5lY3QoIGxvd1Bhc3NGaWx0ZXIgKTtcclxuICAgIHRoaXMuYm91bmRhcnlTb3VuZENsaXAuY29ubmVjdCggbG93UGFzc0ZpbHRlciApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUGxheSB0aGUgc291bmQuXHJcbiAgICovXHJcbiAgcHVibGljIHBsYXkoKTogdm9pZCB7XHJcbiAgICBjb25zdCBpckFic29yYmFuY2UgPSB0aGlzLmlyQWJzb3JiYW5jZVByb3BlcnR5LnZhbHVlO1xyXG4gICAgaWYgKCBpckFic29yYmFuY2UgPiB0aGlzLmlyQWJzb3JiYW5jZVJhbmdlLm1pbiAmJiBpckFic29yYmFuY2UgPCB0aGlzLmlyQWJzb3JiYW5jZVJhbmdlLm1heCApIHtcclxuICAgICAgdGhpcy5taWRkbGVTb3VuZENsaXAucGxheSgpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMuYm91bmRhcnlTb3VuZENsaXAucGxheSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RvcCB0aGUgc291bmRzLiAgVGhpcyBpc24ndCBleHBlY3RlZCB0byBiZSB1c2VkIG11Y2gsIGJ1dCBpcyBuZWNlc3NhcnkgZm9yIHRoZSBUU291bmRQbGF5ZXIgaW50ZXJmYWNlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdG9wKCk6IHZvaWQge1xyXG4gICAgdGhpcy5taWRkbGVTb3VuZENsaXAuc3RvcCgpO1xyXG4gICAgdGhpcy5ib3VuZGFyeVNvdW5kQ2xpcC5zdG9wKCk7XHJcbiAgfVxyXG59XHJcblxyXG5ncmVlbmhvdXNlRWZmZWN0LnJlZ2lzdGVyKCAnSXJBYnNvcmJhbmNlU291bmRQbGF5ZXInLCBJckFic29yYmFuY2VTb3VuZFBsYXllciApO1xyXG5leHBvcnQgZGVmYXVsdCBJckFic29yYmFuY2VTb3VuZFBsYXllcjsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFHQSxPQUFPQSxTQUFTLE1BQTRCLG9EQUFvRDtBQUNoRyxPQUFPQyxnQkFBZ0IsTUFBTSwyQkFBMkI7QUFFeEQsT0FBT0MsY0FBYyxNQUFNLHlEQUF5RDtBQUVwRixPQUFPQyw2QkFBNkIsTUFBTSxrREFBa0Q7QUFDNUYsT0FBT0MsZ0JBQWdCLE1BQU0sMENBQTBDOztBQUd2RTs7QUFJQSxNQUFNQyx1QkFBdUIsU0FBU0gsY0FBYyxDQUF5QjtFQUUzRTtFQUNBO0VBQ2lCSSxlQUFlLEdBQWMsSUFBSU4sU0FBUyxDQUFFRyw2QkFBNkIsRUFBRTtJQUMxRkksbUJBQW1CLEVBQUUsQ0FBQyxHQUFHQyxJQUFJLENBQUNDLEdBQUcsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUUsQ0FBQyxDQUFDO0VBQ2hELENBQUUsQ0FBQzs7RUFFSDtFQUNpQkMsaUJBQWlCLEdBQWMsSUFBSVYsU0FBUyxDQUFFRyw2QkFBNkIsRUFBRTtJQUMxRkksbUJBQW1CLEVBQUU7RUFDdkIsQ0FDRixDQUFDO0VBTU1JLFdBQVdBLENBQUVDLG9CQUFvQyxFQUNwQ0MsaUJBQXdCLEVBQ3hCQyxlQUFnRCxFQUFHO0lBRXJFLEtBQUssQ0FBRUEsZUFBZ0IsQ0FBQzs7SUFFeEI7SUFDQSxJQUFJLENBQUNGLG9CQUFvQixHQUFHQSxvQkFBb0I7SUFDaEQsSUFBSSxDQUFDQyxpQkFBaUIsR0FBR0EsaUJBQWlCOztJQUUxQztJQUNBLE1BQU1FLGFBQWEsR0FBRyxJQUFJQyxnQkFBZ0IsQ0FBRVosZ0JBQWlCLENBQUM7SUFDOURXLGFBQWEsQ0FBQ0UsSUFBSSxHQUFHLFNBQVM7O0lBRTlCO0lBQ0FGLGFBQWEsQ0FBQ0csT0FBTyxDQUFFLElBQUksQ0FBQ0MsY0FBZSxDQUFDOztJQUU1QztJQUNBUCxvQkFBb0IsQ0FBQ1EsSUFBSSxDQUFFQyxjQUFjLElBQUk7TUFDM0MsTUFBTUMsc0JBQXNCLEdBQUcsQ0FBRUQsY0FBYyxHQUFHUixpQkFBaUIsQ0FBQ1UsR0FBRyxJQUFLVixpQkFBaUIsQ0FBQ1csU0FBUyxDQUFDLENBQUM7O01BRXpHO01BQ0E7TUFDQSxNQUFNQyxlQUFlLEdBQUdqQixJQUFJLENBQUNDLEdBQUcsQ0FBRSxDQUFDLEdBQUcsSUFBSSxHQUFHYSxzQkFBc0IsRUFBRSxDQUFFLENBQUMsR0FBRyxJQUFJOztNQUUvRTtNQUNBUCxhQUFhLENBQUNXLFNBQVMsQ0FBQ0MsZUFBZSxDQUFFRixlQUFlLEVBQUVyQixnQkFBZ0IsQ0FBQ3dCLFdBQVcsRUFBRSxLQUFNLENBQUM7SUFDakcsQ0FBRSxDQUFDOztJQUVIO0lBQ0EsSUFBSSxDQUFDdEIsZUFBZSxDQUFDWSxPQUFPLENBQUVILGFBQWMsQ0FBQztJQUM3QyxJQUFJLENBQUNMLGlCQUFpQixDQUFDUSxPQUFPLENBQUVILGFBQWMsQ0FBQztFQUNqRDs7RUFFQTtBQUNGO0FBQ0E7RUFDU2MsSUFBSUEsQ0FBQSxFQUFTO0lBQ2xCLE1BQU1DLFlBQVksR0FBRyxJQUFJLENBQUNsQixvQkFBb0IsQ0FBQ21CLEtBQUs7SUFDcEQsSUFBS0QsWUFBWSxHQUFHLElBQUksQ0FBQ2pCLGlCQUFpQixDQUFDVSxHQUFHLElBQUlPLFlBQVksR0FBRyxJQUFJLENBQUNqQixpQkFBaUIsQ0FBQ21CLEdBQUcsRUFBRztNQUM1RixJQUFJLENBQUMxQixlQUFlLENBQUN1QixJQUFJLENBQUMsQ0FBQztJQUM3QixDQUFDLE1BQ0k7TUFDSCxJQUFJLENBQUNuQixpQkFBaUIsQ0FBQ21CLElBQUksQ0FBQyxDQUFDO0lBQy9CO0VBQ0Y7O0VBRUE7QUFDRjtBQUNBO0VBQ1NJLElBQUlBLENBQUEsRUFBUztJQUNsQixJQUFJLENBQUMzQixlQUFlLENBQUMyQixJQUFJLENBQUMsQ0FBQztJQUMzQixJQUFJLENBQUN2QixpQkFBaUIsQ0FBQ3VCLElBQUksQ0FBQyxDQUFDO0VBQy9CO0FBQ0Y7QUFFQWhDLGdCQUFnQixDQUFDaUMsUUFBUSxDQUFFLHlCQUF5QixFQUFFN0IsdUJBQXdCLENBQUM7QUFDL0UsZUFBZUEsdUJBQXVCIn0=