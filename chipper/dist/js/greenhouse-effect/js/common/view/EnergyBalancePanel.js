// Copyright 2021-2023, University of Colorado Boulder

/**
 * EnergyBalancePanel is a panel that portrays a plot of the energy balance at a point in the atmosphere, showing the
 * energy in, energy out, and the net energy.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 * @author John Blanco (PhET Interactive Simulations)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Multilink from '../../../../axon/js/Multilink.js';
import AxisLine from '../../../../bamboo/js/AxisLine.js';
import ChartRectangle from '../../../../bamboo/js/ChartRectangle.js';
import ChartTransform from '../../../../bamboo/js/ChartTransform.js';
import TickLabelSet from '../../../../bamboo/js/TickLabelSet.js';
import UpDownArrowPlot from '../../../../bamboo/js/UpDownArrowPlot.js';
import Range from '../../../../dot/js/Range.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import optionize from '../../../../phet-core/js/optionize.js';
import Orientation from '../../../../phet-core/js/Orientation.js';
import { Node, scenery, Text, VBox } from '../../../../scenery/js/imports.js';
import Panel from '../../../../sun/js/Panel.js';
import SoundLevelEnum from '../../../../tambo/js/SoundLevelEnum.js';
import soundManager from '../../../../tambo/js/soundManager.js';
import GreenhouseEffectStrings from '../../GreenhouseEffectStrings.js';
import GreenhouseEffectConstants from '../GreenhouseEffectConstants.js';
import EnergyAbsorbingEmittingLayer from '../model/EnergyAbsorbingEmittingLayer.js';
import SunEnergySource from '../model/SunEnergySource.js';
import EnergyDescriber from './describers/EnergyDescriber.js';
import EnergyBalanceSoundGenerator from './EnergyBalanceSoundGenerator.js';

// constants
const BAR_COLOR = 'rgb(0,187,115)';
const BAR_STROKE = 'grey';
const PLOT_VIEW_WIDTH = 100; // view coordinates
const PLOT_VIEW_HEIGHT = 120; // view coordinates

// types
class EnergyBalancePanel extends Panel {
  /**
   * @param energyBalanceVisibleProperty - a Property that controls whether this Panel is visible in the view
   * @param netEnergyInProperty
   * @param netEnergyOutProperty
   * @param inRadiativeBalanceProperty
   * @param sunIsShiningProperty
   * @param [providedOptions]
   */
  constructor(energyBalanceVisibleProperty, netEnergyInProperty, netEnergyOutProperty, inRadiativeBalanceProperty, sunIsShiningProperty, providedOptions) {
    const options = optionize()({
      // panel options
      cornerRadius: 5,
      xMargin: 10,
      yMargin: 10,
      // pdom
      tagName: 'div',
      labelTagName: 'h4',
      labelContent: GreenhouseEffectStrings.energyBalancePanel.titleStringProperty
    }, providedOptions);

    // title
    const titleText = new Text(GreenhouseEffectStrings.energyBalancePanel.titleStringProperty, {
      font: GreenhouseEffectConstants.TITLE_FONT,
      maxWidth: 150
    });
    const subTitleText = new Text(GreenhouseEffectStrings.energyBalancePanel.subTitleStringProperty, {
      font: GreenhouseEffectConstants.CONTENT_FONT,
      maxWidth: 120
    });
    const titleNode = new VBox({
      spacing: 5,
      children: [titleText, subTitleText]
    });

    // Energy "In" needs to be plotted in the negative y direction to match other graphics related to energy flux
    // in this sim
    const negatedEnergyInProperty = new DerivedProperty([netEnergyInProperty], netEnergyIn => -netEnergyIn);

    // TODO: Use model.netInflowOfEnergyProperty instead of this custom one.
    const netEnergyProperty = new DerivedProperty([negatedEnergyInProperty, netEnergyOutProperty], (netIn, netOut) => netIn + netOut);

    // the plot
    const balancePlot = new EnergyBalancePlot(negatedEnergyInProperty, netEnergyOutProperty, netEnergyProperty);
    const content = new VBox({
      spacing: 5,
      children: [titleNode, balancePlot]
    });
    super(content, options);

    // Make the plot available to the step method.
    this.balancePlot = balancePlot;

    // listeners
    energyBalanceVisibleProperty.link(visible => {
      this.visible = visible;
    });

    // sound generation
    this.energyBalanceSoundGenerator = new EnergyBalanceSoundGenerator(netEnergyProperty, inRadiativeBalanceProperty, {
      initialOutputLevel: 0.3,
      enableControlProperties: [energyBalanceVisibleProperty]
    });
    soundManager.addSoundGenerator(this.energyBalanceSoundGenerator, {
      sonificationLevel: SoundLevelEnum.EXTRA
    });

    // pdom
    Multilink.multilink([netEnergyProperty, inRadiativeBalanceProperty, sunIsShiningProperty], (netEnergy, inRadiativeBalance, sunIsShining) => {
      if (!sunIsShining) {
        // describe no flow of energy and a hint to start sunlight to make use of the energy balance panel
        this.descriptionContent = GreenhouseEffectStrings.a11y.noFlowOfEnergyHintDescriptionStringProperty;
      } else {
        this.descriptionContent = EnergyDescriber.getNetEnergyAtAtmosphereDescription(-netEnergy, inRadiativeBalance);
      }
    });
  }

  /**
   * time-based behavior
   * @param dt - delta time, in seconds
   */
  step(dt) {
    this.energyBalanceSoundGenerator.step(dt);
    this.balancePlot.update();
  }
}

/**
 * Inner class for the actual Plot, using bamboo.
 */
class EnergyBalancePlot extends Node {
  /**
   * @param netEnergyInProperty - Representing net energy in
   * @param netEnergyOutProperty - Representing net energy out
   * @param netEnergyProperty - Representing net energy of the system
   */
  constructor(netEnergyInProperty, netEnergyOutProperty, netEnergyProperty) {
    super();

    // position of each bar, in model coordinates
    const inEnergyModelPosition = 0;
    const outEnergyModelPosition = 1;
    const netEnergyModelPosition = 2;
    const horizontalModelRange = new Range(inEnergyModelPosition, netEnergyModelPosition);

    // range of the entire plot, in model watts, based on the max output of the sun
    const verticalModelSpan = SunEnergySource.OUTPUT_ENERGY_RATE * EnergyAbsorbingEmittingLayer.SURFACE_AREA * 2;
    const chartTransform = new ChartTransform({
      viewWidth: PLOT_VIEW_WIDTH,
      modelXRange: horizontalModelRange,
      viewHeight: PLOT_VIEW_HEIGHT,
      modelYRange: new Range(-verticalModelSpan, verticalModelSpan)
    });

    // the dataSet for the barPlot gets set in a multilink of the provided energy Properties
    const barPlot = new UpDownArrowPlot(chartTransform, [], {
      pointToPaintableFields: () => {
        return {
          fill: BAR_COLOR,
          stroke: BAR_STROKE
        };
      }
    });
    const axisLine = new AxisLine(chartTransform, Orientation.HORIZONTAL, {
      stroke: 'grey',
      lineDash: [10, 5]
    });

    // labels
    const labelOptions = {
      font: GreenhouseEffectConstants.CONTENT_FONT,
      maxWidth: 30
    };
    const gridLabels = new TickLabelSet(chartTransform, Orientation.HORIZONTAL, 1, {
      // the 'extent' is extra spacing between tick marks and labels, negative value because this is vertically
      // above the plot
      extent: -30,
      // place the labels at the max value of the plot
      value: verticalModelSpan,
      createLabel: value => {
        return value === inEnergyModelPosition ? new Text(GreenhouseEffectStrings.energyBalancePanel.inStringProperty, labelOptions) : value === outEnergyModelPosition ? new Text(GreenhouseEffectStrings.energyBalancePanel.outStringProperty, labelOptions) : new Text(GreenhouseEffectStrings.energyBalancePanel.netStringProperty, labelOptions);
      }
    });

    // contains all plot components and provides consistent bounds as the arrows change size with model data
    const chartRectangle = new ChartRectangle(chartTransform, {
      children: [axisLine, barPlot, gridLabels]
    });
    this.addChild(chartRectangle);

    // The arrows will be clipped if they extend outside the bounds of the plot, and this clipping should make sure
    // that they don't overlap with the labels.  Also, the clip area can't be too small in the x-direction or the edges
    // of the arrow heads can be cut off (see https://github.com/phetsims/greenhouse-effect/issues/240).
    barPlot.clipArea = Shape.bounds(this.bounds.withMinY(gridLabels.bounds.maxY).dilateX(5));

    // Make the plot and the energy properties visible to the update method.
    this.barPlot = barPlot;
    this.netEnergyInProperty = netEnergyInProperty;
    this.netEnergyOutProperty = netEnergyOutProperty;
    this.netEnergyProperty = netEnergyProperty;
  }

  /**
   * Update the bar chart.  This is done in a method rather than linking to properties because the latter approach was
   * updating multiple times per frame and causing some performance issues.  See
   * https://github.com/phetsims/greenhouse-effect/issues/265.
   */
  update() {
    this.barPlot.setDataSet([new Vector2(0, this.netEnergyInProperty.value), new Vector2(1, this.netEnergyOutProperty.value), new Vector2(2, this.netEnergyProperty.value)]);
  }
}
scenery.register('EnergyBalancePanel', EnergyBalancePanel);
export default EnergyBalancePanel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJNdWx0aWxpbmsiLCJBeGlzTGluZSIsIkNoYXJ0UmVjdGFuZ2xlIiwiQ2hhcnRUcmFuc2Zvcm0iLCJUaWNrTGFiZWxTZXQiLCJVcERvd25BcnJvd1Bsb3QiLCJSYW5nZSIsIlZlY3RvcjIiLCJTaGFwZSIsIm9wdGlvbml6ZSIsIk9yaWVudGF0aW9uIiwiTm9kZSIsInNjZW5lcnkiLCJUZXh0IiwiVkJveCIsIlBhbmVsIiwiU291bmRMZXZlbEVudW0iLCJzb3VuZE1hbmFnZXIiLCJHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncyIsIkdyZWVuaG91c2VFZmZlY3RDb25zdGFudHMiLCJFbmVyZ3lBYnNvcmJpbmdFbWl0dGluZ0xheWVyIiwiU3VuRW5lcmd5U291cmNlIiwiRW5lcmd5RGVzY3JpYmVyIiwiRW5lcmd5QmFsYW5jZVNvdW5kR2VuZXJhdG9yIiwiQkFSX0NPTE9SIiwiQkFSX1NUUk9LRSIsIlBMT1RfVklFV19XSURUSCIsIlBMT1RfVklFV19IRUlHSFQiLCJFbmVyZ3lCYWxhbmNlUGFuZWwiLCJjb25zdHJ1Y3RvciIsImVuZXJneUJhbGFuY2VWaXNpYmxlUHJvcGVydHkiLCJuZXRFbmVyZ3lJblByb3BlcnR5IiwibmV0RW5lcmd5T3V0UHJvcGVydHkiLCJpblJhZGlhdGl2ZUJhbGFuY2VQcm9wZXJ0eSIsInN1bklzU2hpbmluZ1Byb3BlcnR5IiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImNvcm5lclJhZGl1cyIsInhNYXJnaW4iLCJ5TWFyZ2luIiwidGFnTmFtZSIsImxhYmVsVGFnTmFtZSIsImxhYmVsQ29udGVudCIsImVuZXJneUJhbGFuY2VQYW5lbCIsInRpdGxlU3RyaW5nUHJvcGVydHkiLCJ0aXRsZVRleHQiLCJmb250IiwiVElUTEVfRk9OVCIsIm1heFdpZHRoIiwic3ViVGl0bGVUZXh0Iiwic3ViVGl0bGVTdHJpbmdQcm9wZXJ0eSIsIkNPTlRFTlRfRk9OVCIsInRpdGxlTm9kZSIsInNwYWNpbmciLCJjaGlsZHJlbiIsIm5lZ2F0ZWRFbmVyZ3lJblByb3BlcnR5IiwibmV0RW5lcmd5SW4iLCJuZXRFbmVyZ3lQcm9wZXJ0eSIsIm5ldEluIiwibmV0T3V0IiwiYmFsYW5jZVBsb3QiLCJFbmVyZ3lCYWxhbmNlUGxvdCIsImNvbnRlbnQiLCJsaW5rIiwidmlzaWJsZSIsImVuZXJneUJhbGFuY2VTb3VuZEdlbmVyYXRvciIsImluaXRpYWxPdXRwdXRMZXZlbCIsImVuYWJsZUNvbnRyb2xQcm9wZXJ0aWVzIiwiYWRkU291bmRHZW5lcmF0b3IiLCJzb25pZmljYXRpb25MZXZlbCIsIkVYVFJBIiwibXVsdGlsaW5rIiwibmV0RW5lcmd5IiwiaW5SYWRpYXRpdmVCYWxhbmNlIiwic3VuSXNTaGluaW5nIiwiZGVzY3JpcHRpb25Db250ZW50IiwiYTExeSIsIm5vRmxvd09mRW5lcmd5SGludERlc2NyaXB0aW9uU3RyaW5nUHJvcGVydHkiLCJnZXROZXRFbmVyZ3lBdEF0bW9zcGhlcmVEZXNjcmlwdGlvbiIsInN0ZXAiLCJkdCIsInVwZGF0ZSIsImluRW5lcmd5TW9kZWxQb3NpdGlvbiIsIm91dEVuZXJneU1vZGVsUG9zaXRpb24iLCJuZXRFbmVyZ3lNb2RlbFBvc2l0aW9uIiwiaG9yaXpvbnRhbE1vZGVsUmFuZ2UiLCJ2ZXJ0aWNhbE1vZGVsU3BhbiIsIk9VVFBVVF9FTkVSR1lfUkFURSIsIlNVUkZBQ0VfQVJFQSIsImNoYXJ0VHJhbnNmb3JtIiwidmlld1dpZHRoIiwibW9kZWxYUmFuZ2UiLCJ2aWV3SGVpZ2h0IiwibW9kZWxZUmFuZ2UiLCJiYXJQbG90IiwicG9pbnRUb1BhaW50YWJsZUZpZWxkcyIsImZpbGwiLCJzdHJva2UiLCJheGlzTGluZSIsIkhPUklaT05UQUwiLCJsaW5lRGFzaCIsImxhYmVsT3B0aW9ucyIsImdyaWRMYWJlbHMiLCJleHRlbnQiLCJ2YWx1ZSIsImNyZWF0ZUxhYmVsIiwiaW5TdHJpbmdQcm9wZXJ0eSIsIm91dFN0cmluZ1Byb3BlcnR5IiwibmV0U3RyaW5nUHJvcGVydHkiLCJjaGFydFJlY3RhbmdsZSIsImFkZENoaWxkIiwiY2xpcEFyZWEiLCJib3VuZHMiLCJ3aXRoTWluWSIsIm1heFkiLCJkaWxhdGVYIiwic2V0RGF0YVNldCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRW5lcmd5QmFsYW5jZVBhbmVsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEVuZXJneUJhbGFuY2VQYW5lbCBpcyBhIHBhbmVsIHRoYXQgcG9ydHJheXMgYSBwbG90IG9mIHRoZSBlbmVyZ3kgYmFsYW5jZSBhdCBhIHBvaW50IGluIHRoZSBhdG1vc3BoZXJlLCBzaG93aW5nIHRoZVxyXG4gKiBlbmVyZ3kgaW4sIGVuZXJneSBvdXQsIGFuZCB0aGUgbmV0IGVuZXJneS5cclxuICpcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmcgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IEF4aXNMaW5lIGZyb20gJy4uLy4uLy4uLy4uL2JhbWJvby9qcy9BeGlzTGluZS5qcyc7XHJcbmltcG9ydCBDaGFydFJlY3RhbmdsZSBmcm9tICcuLi8uLi8uLi8uLi9iYW1ib28vanMvQ2hhcnRSZWN0YW5nbGUuanMnO1xyXG5pbXBvcnQgQ2hhcnRUcmFuc2Zvcm0gZnJvbSAnLi4vLi4vLi4vLi4vYmFtYm9vL2pzL0NoYXJ0VHJhbnNmb3JtLmpzJztcclxuaW1wb3J0IFRpY2tMYWJlbFNldCBmcm9tICcuLi8uLi8uLi8uLi9iYW1ib28vanMvVGlja0xhYmVsU2V0LmpzJztcclxuaW1wb3J0IFVwRG93bkFycm93UGxvdCBmcm9tICcuLi8uLi8uLi8uLi9iYW1ib28vanMvVXBEb3duQXJyb3dQbG90LmpzJztcclxuaW1wb3J0IFJhbmdlIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IEVtcHR5U2VsZk9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IE9yaWVudGF0aW9uIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9PcmllbnRhdGlvbi5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIHNjZW5lcnksIFRleHQsIFZCb3ggfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUGFuZWwsIHsgUGFuZWxPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL1BhbmVsLmpzJztcclxuaW1wb3J0IFNvdW5kTGV2ZWxFbnVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbWJvL2pzL1NvdW5kTGV2ZWxFbnVtLmpzJztcclxuaW1wb3J0IHNvdW5kTWFuYWdlciBmcm9tICcuLi8uLi8uLi8uLi90YW1iby9qcy9zb3VuZE1hbmFnZXIuanMnO1xyXG5pbXBvcnQgR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MgZnJvbSAnLi4vLi4vR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuanMnO1xyXG5pbXBvcnQgR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cyBmcm9tICcuLi9HcmVlbmhvdXNlRWZmZWN0Q29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEVuZXJneUFic29yYmluZ0VtaXR0aW5nTGF5ZXIgZnJvbSAnLi4vbW9kZWwvRW5lcmd5QWJzb3JiaW5nRW1pdHRpbmdMYXllci5qcyc7XHJcbmltcG9ydCBTdW5FbmVyZ3lTb3VyY2UgZnJvbSAnLi4vbW9kZWwvU3VuRW5lcmd5U291cmNlLmpzJztcclxuaW1wb3J0IEVuZXJneURlc2NyaWJlciBmcm9tICcuL2Rlc2NyaWJlcnMvRW5lcmd5RGVzY3JpYmVyLmpzJztcclxuaW1wb3J0IEVuZXJneUJhbGFuY2VTb3VuZEdlbmVyYXRvciBmcm9tICcuL0VuZXJneUJhbGFuY2VTb3VuZEdlbmVyYXRvci5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgQkFSX0NPTE9SID0gJ3JnYigwLDE4NywxMTUpJztcclxuY29uc3QgQkFSX1NUUk9LRSA9ICdncmV5JztcclxuY29uc3QgUExPVF9WSUVXX1dJRFRIID0gMTAwOyAvLyB2aWV3IGNvb3JkaW5hdGVzXHJcbmNvbnN0IFBMT1RfVklFV19IRUlHSFQgPSAxMjA7IC8vIHZpZXcgY29vcmRpbmF0ZXNcclxuXHJcbi8vIHR5cGVzXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSBFbXB0eVNlbGZPcHRpb25zO1xyXG5leHBvcnQgdHlwZSBFbmVyZ3lCYWxhbmNlUGFuZWxPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBQYW5lbE9wdGlvbnM7XHJcblxyXG5jbGFzcyBFbmVyZ3lCYWxhbmNlUGFuZWwgZXh0ZW5kcyBQYW5lbCB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZW5lcmd5QmFsYW5jZVNvdW5kR2VuZXJhdG9yOiBFbmVyZ3lCYWxhbmNlU291bmRHZW5lcmF0b3I7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBiYWxhbmNlUGxvdDogRW5lcmd5QmFsYW5jZVBsb3Q7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBlbmVyZ3lCYWxhbmNlVmlzaWJsZVByb3BlcnR5IC0gYSBQcm9wZXJ0eSB0aGF0IGNvbnRyb2xzIHdoZXRoZXIgdGhpcyBQYW5lbCBpcyB2aXNpYmxlIGluIHRoZSB2aWV3XHJcbiAgICogQHBhcmFtIG5ldEVuZXJneUluUHJvcGVydHlcclxuICAgKiBAcGFyYW0gbmV0RW5lcmd5T3V0UHJvcGVydHlcclxuICAgKiBAcGFyYW0gaW5SYWRpYXRpdmVCYWxhbmNlUHJvcGVydHlcclxuICAgKiBAcGFyYW0gc3VuSXNTaGluaW5nUHJvcGVydHlcclxuICAgKiBAcGFyYW0gW3Byb3ZpZGVkT3B0aW9uc11cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGVuZXJneUJhbGFuY2VWaXNpYmxlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgbmV0RW5lcmd5SW5Qcm9wZXJ0eTogUHJvcGVydHk8bnVtYmVyPixcclxuICAgICAgICAgICAgICAgICAgICAgIG5ldEVuZXJneU91dFByb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgaW5SYWRpYXRpdmVCYWxhbmNlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgc3VuSXNTaGluaW5nUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWRPcHRpb25zPzogRW5lcmd5QmFsYW5jZVBhbmVsT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPEVuZXJneUJhbGFuY2VQYW5lbE9wdGlvbnMsIFNlbGZPcHRpb25zLCBQYW5lbE9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIHBhbmVsIG9wdGlvbnNcclxuICAgICAgY29ybmVyUmFkaXVzOiA1LFxyXG4gICAgICB4TWFyZ2luOiAxMCxcclxuICAgICAgeU1hcmdpbjogMTAsXHJcblxyXG4gICAgICAvLyBwZG9tXHJcbiAgICAgIHRhZ05hbWU6ICdkaXYnLFxyXG4gICAgICBsYWJlbFRhZ05hbWU6ICdoNCcsXHJcbiAgICAgIGxhYmVsQ29udGVudDogR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuZW5lcmd5QmFsYW5jZVBhbmVsLnRpdGxlU3RyaW5nUHJvcGVydHlcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIC8vIHRpdGxlXHJcbiAgICBjb25zdCB0aXRsZVRleHQgPSBuZXcgVGV4dCggR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuZW5lcmd5QmFsYW5jZVBhbmVsLnRpdGxlU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgZm9udDogR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cy5USVRMRV9GT05ULFxyXG4gICAgICBtYXhXaWR0aDogMTUwXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBzdWJUaXRsZVRleHQgPSBuZXcgVGV4dCggR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuZW5lcmd5QmFsYW5jZVBhbmVsLnN1YlRpdGxlU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgZm9udDogR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cy5DT05URU5UX0ZPTlQsXHJcbiAgICAgIG1heFdpZHRoOiAxMjBcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IHRpdGxlTm9kZSA9IG5ldyBWQm94KCB7XHJcbiAgICAgIHNwYWNpbmc6IDUsXHJcbiAgICAgIGNoaWxkcmVuOiBbIHRpdGxlVGV4dCwgc3ViVGl0bGVUZXh0IF1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBFbmVyZ3kgXCJJblwiIG5lZWRzIHRvIGJlIHBsb3R0ZWQgaW4gdGhlIG5lZ2F0aXZlIHkgZGlyZWN0aW9uIHRvIG1hdGNoIG90aGVyIGdyYXBoaWNzIHJlbGF0ZWQgdG8gZW5lcmd5IGZsdXhcclxuICAgIC8vIGluIHRoaXMgc2ltXHJcbiAgICBjb25zdCBuZWdhdGVkRW5lcmd5SW5Qcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPiA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgbmV0RW5lcmd5SW5Qcm9wZXJ0eSBdLFxyXG4gICAgICBuZXRFbmVyZ3lJbiA9PiAtbmV0RW5lcmd5SW5cclxuICAgICk7XHJcblxyXG4gICAgLy8gVE9ETzogVXNlIG1vZGVsLm5ldEluZmxvd09mRW5lcmd5UHJvcGVydHkgaW5zdGVhZCBvZiB0aGlzIGN1c3RvbSBvbmUuXHJcbiAgICBjb25zdCBuZXRFbmVyZ3lQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPiA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgbmVnYXRlZEVuZXJneUluUHJvcGVydHksIG5ldEVuZXJneU91dFByb3BlcnR5IF0sXHJcbiAgICAgICggbmV0SW4sIG5ldE91dCApID0+IG5ldEluICsgbmV0T3V0XHJcbiAgICApO1xyXG5cclxuICAgIC8vIHRoZSBwbG90XHJcbiAgICBjb25zdCBiYWxhbmNlUGxvdCA9IG5ldyBFbmVyZ3lCYWxhbmNlUGxvdCggbmVnYXRlZEVuZXJneUluUHJvcGVydHksIG5ldEVuZXJneU91dFByb3BlcnR5LCBuZXRFbmVyZ3lQcm9wZXJ0eSApO1xyXG5cclxuICAgIGNvbnN0IGNvbnRlbnQgPSBuZXcgVkJveCgge1xyXG4gICAgICBzcGFjaW5nOiA1LFxyXG4gICAgICBjaGlsZHJlbjogWyB0aXRsZU5vZGUsIGJhbGFuY2VQbG90IF1cclxuICAgIH0gKTtcclxuXHJcbiAgICBzdXBlciggY29udGVudCwgb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIE1ha2UgdGhlIHBsb3QgYXZhaWxhYmxlIHRvIHRoZSBzdGVwIG1ldGhvZC5cclxuICAgIHRoaXMuYmFsYW5jZVBsb3QgPSBiYWxhbmNlUGxvdDtcclxuXHJcbiAgICAvLyBsaXN0ZW5lcnNcclxuICAgIGVuZXJneUJhbGFuY2VWaXNpYmxlUHJvcGVydHkubGluayggdmlzaWJsZSA9PiB7XHJcbiAgICAgIHRoaXMudmlzaWJsZSA9IHZpc2libGU7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gc291bmQgZ2VuZXJhdGlvblxyXG4gICAgdGhpcy5lbmVyZ3lCYWxhbmNlU291bmRHZW5lcmF0b3IgPSBuZXcgRW5lcmd5QmFsYW5jZVNvdW5kR2VuZXJhdG9yKCBuZXRFbmVyZ3lQcm9wZXJ0eSwgaW5SYWRpYXRpdmVCYWxhbmNlUHJvcGVydHksIHtcclxuICAgICAgaW5pdGlhbE91dHB1dExldmVsOiAwLjMsXHJcbiAgICAgIGVuYWJsZUNvbnRyb2xQcm9wZXJ0aWVzOiBbIGVuZXJneUJhbGFuY2VWaXNpYmxlUHJvcGVydHkgXVxyXG4gICAgfSApO1xyXG4gICAgc291bmRNYW5hZ2VyLmFkZFNvdW5kR2VuZXJhdG9yKCB0aGlzLmVuZXJneUJhbGFuY2VTb3VuZEdlbmVyYXRvciwgeyBzb25pZmljYXRpb25MZXZlbDogU291bmRMZXZlbEVudW0uRVhUUkEgfSApO1xyXG5cclxuICAgIC8vIHBkb21cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFsgbmV0RW5lcmd5UHJvcGVydHksIGluUmFkaWF0aXZlQmFsYW5jZVByb3BlcnR5LCBzdW5Jc1NoaW5pbmdQcm9wZXJ0eSBdLCAoIG5ldEVuZXJneSwgaW5SYWRpYXRpdmVCYWxhbmNlLCBzdW5Jc1NoaW5pbmcgKSA9PiB7XHJcblxyXG4gICAgICBpZiAoICFzdW5Jc1NoaW5pbmcgKSB7XHJcblxyXG4gICAgICAgIC8vIGRlc2NyaWJlIG5vIGZsb3cgb2YgZW5lcmd5IGFuZCBhIGhpbnQgdG8gc3RhcnQgc3VubGlnaHQgdG8gbWFrZSB1c2Ugb2YgdGhlIGVuZXJneSBiYWxhbmNlIHBhbmVsXHJcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbkNvbnRlbnQgPSBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5hMTF5Lm5vRmxvd09mRW5lcmd5SGludERlc2NyaXB0aW9uU3RyaW5nUHJvcGVydHk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbkNvbnRlbnQgPSBFbmVyZ3lEZXNjcmliZXIuZ2V0TmV0RW5lcmd5QXRBdG1vc3BoZXJlRGVzY3JpcHRpb24oIC1uZXRFbmVyZ3ksIGluUmFkaWF0aXZlQmFsYW5jZSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiB0aW1lLWJhc2VkIGJlaGF2aW9yXHJcbiAgICogQHBhcmFtIGR0IC0gZGVsdGEgdGltZSwgaW4gc2Vjb25kc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGVwKCBkdDogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgdGhpcy5lbmVyZ3lCYWxhbmNlU291bmRHZW5lcmF0b3Iuc3RlcCggZHQgKTtcclxuICAgIHRoaXMuYmFsYW5jZVBsb3QudXBkYXRlKCk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogSW5uZXIgY2xhc3MgZm9yIHRoZSBhY3R1YWwgUGxvdCwgdXNpbmcgYmFtYm9vLlxyXG4gKi9cclxuY2xhc3MgRW5lcmd5QmFsYW5jZVBsb3QgZXh0ZW5kcyBOb2RlIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IGJhclBsb3Q6IFVwRG93bkFycm93UGxvdDtcclxuICBwcml2YXRlIHJlYWRvbmx5IG5ldEVuZXJneUluUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PG51bWJlcj47XHJcbiAgcHJpdmF0ZSByZWFkb25seSBuZXRFbmVyZ3lPdXRQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IG5ldEVuZXJneVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXI+O1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gbmV0RW5lcmd5SW5Qcm9wZXJ0eSAtIFJlcHJlc2VudGluZyBuZXQgZW5lcmd5IGluXHJcbiAgICogQHBhcmFtIG5ldEVuZXJneU91dFByb3BlcnR5IC0gUmVwcmVzZW50aW5nIG5ldCBlbmVyZ3kgb3V0XHJcbiAgICogQHBhcmFtIG5ldEVuZXJneVByb3BlcnR5IC0gUmVwcmVzZW50aW5nIG5ldCBlbmVyZ3kgb2YgdGhlIHN5c3RlbVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbmV0RW5lcmd5SW5Qcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPixcclxuICAgICAgICAgICAgICAgICAgICAgIG5ldEVuZXJneU91dFByb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgbmV0RW5lcmd5UHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PG51bWJlcj4gKSB7XHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIC8vIHBvc2l0aW9uIG9mIGVhY2ggYmFyLCBpbiBtb2RlbCBjb29yZGluYXRlc1xyXG4gICAgY29uc3QgaW5FbmVyZ3lNb2RlbFBvc2l0aW9uID0gMDtcclxuICAgIGNvbnN0IG91dEVuZXJneU1vZGVsUG9zaXRpb24gPSAxO1xyXG4gICAgY29uc3QgbmV0RW5lcmd5TW9kZWxQb3NpdGlvbiA9IDI7XHJcbiAgICBjb25zdCBob3Jpem9udGFsTW9kZWxSYW5nZSA9IG5ldyBSYW5nZSggaW5FbmVyZ3lNb2RlbFBvc2l0aW9uLCBuZXRFbmVyZ3lNb2RlbFBvc2l0aW9uICk7XHJcblxyXG4gICAgLy8gcmFuZ2Ugb2YgdGhlIGVudGlyZSBwbG90LCBpbiBtb2RlbCB3YXR0cywgYmFzZWQgb24gdGhlIG1heCBvdXRwdXQgb2YgdGhlIHN1blxyXG4gICAgY29uc3QgdmVydGljYWxNb2RlbFNwYW4gPSBTdW5FbmVyZ3lTb3VyY2UuT1VUUFVUX0VORVJHWV9SQVRFICogRW5lcmd5QWJzb3JiaW5nRW1pdHRpbmdMYXllci5TVVJGQUNFX0FSRUEgKiAyO1xyXG5cclxuICAgIGNvbnN0IGNoYXJ0VHJhbnNmb3JtID0gbmV3IENoYXJ0VHJhbnNmb3JtKCB7XHJcbiAgICAgIHZpZXdXaWR0aDogUExPVF9WSUVXX1dJRFRILFxyXG4gICAgICBtb2RlbFhSYW5nZTogaG9yaXpvbnRhbE1vZGVsUmFuZ2UsXHJcbiAgICAgIHZpZXdIZWlnaHQ6IFBMT1RfVklFV19IRUlHSFQsXHJcbiAgICAgIG1vZGVsWVJhbmdlOiBuZXcgUmFuZ2UoIC12ZXJ0aWNhbE1vZGVsU3BhbiwgdmVydGljYWxNb2RlbFNwYW4gKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHRoZSBkYXRhU2V0IGZvciB0aGUgYmFyUGxvdCBnZXRzIHNldCBpbiBhIG11bHRpbGluayBvZiB0aGUgcHJvdmlkZWQgZW5lcmd5IFByb3BlcnRpZXNcclxuICAgIGNvbnN0IGJhclBsb3QgPSBuZXcgVXBEb3duQXJyb3dQbG90KCBjaGFydFRyYW5zZm9ybSwgW10sIHtcclxuICAgICAgcG9pbnRUb1BhaW50YWJsZUZpZWxkczogKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB7IGZpbGw6IEJBUl9DT0xPUiwgc3Ryb2tlOiBCQVJfU1RST0tFIH07XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBheGlzTGluZSA9IG5ldyBBeGlzTGluZSggY2hhcnRUcmFuc2Zvcm0sIE9yaWVudGF0aW9uLkhPUklaT05UQUwsIHtcclxuICAgICAgc3Ryb2tlOiAnZ3JleScsXHJcbiAgICAgIGxpbmVEYXNoOiBbIDEwLCA1IF1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBsYWJlbHNcclxuICAgIGNvbnN0IGxhYmVsT3B0aW9ucyA9IHsgZm9udDogR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cy5DT05URU5UX0ZPTlQsIG1heFdpZHRoOiAzMCB9O1xyXG4gICAgY29uc3QgZ3JpZExhYmVscyA9IG5ldyBUaWNrTGFiZWxTZXQoIGNoYXJ0VHJhbnNmb3JtLCBPcmllbnRhdGlvbi5IT1JJWk9OVEFMLCAxLCB7XHJcblxyXG4gICAgICAvLyB0aGUgJ2V4dGVudCcgaXMgZXh0cmEgc3BhY2luZyBiZXR3ZWVuIHRpY2sgbWFya3MgYW5kIGxhYmVscywgbmVnYXRpdmUgdmFsdWUgYmVjYXVzZSB0aGlzIGlzIHZlcnRpY2FsbHlcclxuICAgICAgLy8gYWJvdmUgdGhlIHBsb3RcclxuICAgICAgZXh0ZW50OiAtMzAsXHJcblxyXG4gICAgICAvLyBwbGFjZSB0aGUgbGFiZWxzIGF0IHRoZSBtYXggdmFsdWUgb2YgdGhlIHBsb3RcclxuICAgICAgdmFsdWU6IHZlcnRpY2FsTW9kZWxTcGFuLFxyXG5cclxuICAgICAgY3JlYXRlTGFiZWw6ICggdmFsdWU6IG51bWJlciApID0+IHtcclxuICAgICAgICByZXR1cm4gdmFsdWUgPT09IGluRW5lcmd5TW9kZWxQb3NpdGlvbiA/XHJcbiAgICAgICAgICAgICAgIG5ldyBUZXh0KCBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5lbmVyZ3lCYWxhbmNlUGFuZWwuaW5TdHJpbmdQcm9wZXJ0eSwgbGFiZWxPcHRpb25zICkgOlxyXG4gICAgICAgICAgICAgICB2YWx1ZSA9PT0gb3V0RW5lcmd5TW9kZWxQb3NpdGlvbiA/IG5ldyBUZXh0KCBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5lbmVyZ3lCYWxhbmNlUGFuZWwub3V0U3RyaW5nUHJvcGVydHksIGxhYmVsT3B0aW9ucyApIDpcclxuICAgICAgICAgICAgICAgbmV3IFRleHQoIEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmVuZXJneUJhbGFuY2VQYW5lbC5uZXRTdHJpbmdQcm9wZXJ0eSwgbGFiZWxPcHRpb25zICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBjb250YWlucyBhbGwgcGxvdCBjb21wb25lbnRzIGFuZCBwcm92aWRlcyBjb25zaXN0ZW50IGJvdW5kcyBhcyB0aGUgYXJyb3dzIGNoYW5nZSBzaXplIHdpdGggbW9kZWwgZGF0YVxyXG4gICAgY29uc3QgY2hhcnRSZWN0YW5nbGUgPSBuZXcgQ2hhcnRSZWN0YW5nbGUoIGNoYXJ0VHJhbnNmb3JtLCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbIGF4aXNMaW5lLCBiYXJQbG90LCBncmlkTGFiZWxzIF1cclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGNoYXJ0UmVjdGFuZ2xlICk7XHJcblxyXG4gICAgLy8gVGhlIGFycm93cyB3aWxsIGJlIGNsaXBwZWQgaWYgdGhleSBleHRlbmQgb3V0c2lkZSB0aGUgYm91bmRzIG9mIHRoZSBwbG90LCBhbmQgdGhpcyBjbGlwcGluZyBzaG91bGQgbWFrZSBzdXJlXHJcbiAgICAvLyB0aGF0IHRoZXkgZG9uJ3Qgb3ZlcmxhcCB3aXRoIHRoZSBsYWJlbHMuICBBbHNvLCB0aGUgY2xpcCBhcmVhIGNhbid0IGJlIHRvbyBzbWFsbCBpbiB0aGUgeC1kaXJlY3Rpb24gb3IgdGhlIGVkZ2VzXHJcbiAgICAvLyBvZiB0aGUgYXJyb3cgaGVhZHMgY2FuIGJlIGN1dCBvZmYgKHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZ3JlZW5ob3VzZS1lZmZlY3QvaXNzdWVzLzI0MCkuXHJcbiAgICBiYXJQbG90LmNsaXBBcmVhID0gU2hhcGUuYm91bmRzKCB0aGlzLmJvdW5kcy53aXRoTWluWSggZ3JpZExhYmVscy5ib3VuZHMubWF4WSApLmRpbGF0ZVgoIDUgKSApO1xyXG5cclxuICAgIC8vIE1ha2UgdGhlIHBsb3QgYW5kIHRoZSBlbmVyZ3kgcHJvcGVydGllcyB2aXNpYmxlIHRvIHRoZSB1cGRhdGUgbWV0aG9kLlxyXG4gICAgdGhpcy5iYXJQbG90ID0gYmFyUGxvdDtcclxuICAgIHRoaXMubmV0RW5lcmd5SW5Qcm9wZXJ0eSA9IG5ldEVuZXJneUluUHJvcGVydHk7XHJcbiAgICB0aGlzLm5ldEVuZXJneU91dFByb3BlcnR5ID0gbmV0RW5lcmd5T3V0UHJvcGVydHk7XHJcbiAgICB0aGlzLm5ldEVuZXJneVByb3BlcnR5ID0gbmV0RW5lcmd5UHJvcGVydHk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgdGhlIGJhciBjaGFydC4gIFRoaXMgaXMgZG9uZSBpbiBhIG1ldGhvZCByYXRoZXIgdGhhbiBsaW5raW5nIHRvIHByb3BlcnRpZXMgYmVjYXVzZSB0aGUgbGF0dGVyIGFwcHJvYWNoIHdhc1xyXG4gICAqIHVwZGF0aW5nIG11bHRpcGxlIHRpbWVzIHBlciBmcmFtZSBhbmQgY2F1c2luZyBzb21lIHBlcmZvcm1hbmNlIGlzc3Vlcy4gIFNlZVxyXG4gICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmVlbmhvdXNlLWVmZmVjdC9pc3N1ZXMvMjY1LlxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGUoKTogdm9pZCB7XHJcbiAgICB0aGlzLmJhclBsb3Quc2V0RGF0YVNldCggW1xyXG4gICAgICBuZXcgVmVjdG9yMiggMCwgdGhpcy5uZXRFbmVyZ3lJblByb3BlcnR5LnZhbHVlICksXHJcbiAgICAgIG5ldyBWZWN0b3IyKCAxLCB0aGlzLm5ldEVuZXJneU91dFByb3BlcnR5LnZhbHVlICksXHJcbiAgICAgIG5ldyBWZWN0b3IyKCAyLCB0aGlzLm5ldEVuZXJneVByb3BlcnR5LnZhbHVlIClcclxuICAgIF0gKTtcclxuICB9XHJcbn1cclxuXHJcbnNjZW5lcnkucmVnaXN0ZXIoICdFbmVyZ3lCYWxhbmNlUGFuZWwnLCBFbmVyZ3lCYWxhbmNlUGFuZWwgKTtcclxuZXhwb3J0IGRlZmF1bHQgRW5lcmd5QmFsYW5jZVBhbmVsO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsU0FBUyxNQUFNLGtDQUFrQztBQUd4RCxPQUFPQyxRQUFRLE1BQU0sbUNBQW1DO0FBQ3hELE9BQU9DLGNBQWMsTUFBTSx5Q0FBeUM7QUFDcEUsT0FBT0MsY0FBYyxNQUFNLHlDQUF5QztBQUNwRSxPQUFPQyxZQUFZLE1BQU0sdUNBQXVDO0FBQ2hFLE9BQU9DLGVBQWUsTUFBTSwwQ0FBMEM7QUFDdEUsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDdEQsT0FBT0MsU0FB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