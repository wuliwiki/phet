// Copyright 2021-2022, University of Colorado Boulder

/**
 * Responsible for generating and timing alerts related to gas concentration in this sim. A polling method is used
 * to time the alerts and determine how model variables have changed to create an accurate description.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 * @author John Blanco (PhET Interactive Simulations)
 *
 *
 * TODO: 1/5/2022 - This is named GasConcentrationAlerter, but it's doing more than just talking about the state.  We
 *                  should consider a new name, perhaps LayerModelStateAlerter or something along those lines.  See
 *                  https://github.com/phetsims/greenhouse-effect/issues/129.
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Utils from '../../../../dot/js/Utils.js';
import optionize from '../../../../phet-core/js/optionize.js';
import Alerter from '../../../../scenery-phet/js/accessibility/describers/Alerter.js';
import Utterance from '../../../../utterance-queue/js/Utterance.js';
import greenhouseEffect from '../../greenhouseEffect.js';
import ConcentrationModel, { ConcentrationControlMode } from '../model/ConcentrationModel.js';
import LayersModel from '../model/LayersModel.js';
import ConcentrationDescriber from './describers/ConcentrationDescriber.js';
import EnergyDescriber from './describers/EnergyDescriber.js';
import RadiationDescriber from './describers/RadiationDescriber.js';
import TemperatureDescriber from './describers/TemperatureDescriber.js';

// number of decimal places to pay attention to in the temperature values
const TEMPERATURE_DECIMAL_PLACES = 1;

// in seconds, how frequently to send an alert to the UtteranceQueue describing changing concentrations
const ALERT_INTERVAL = 4;

// in seconds, how long to wait before the next alert after changing the concentration value
const ALERT_DELAY_AFTER_CHANGING_CONCENTRATION = 2;

// How many times a terse temperature alert should be spoken before a verbose temperature alert is used. Note this
// is a counting variable, not in units of time.
const NUMBER_OF_TERSE_TEMPERATURE_ALERTS = 2;

// A higher delay before waiting for the Utterance to stabilize so that we don't hear information about the new
// scene in the observation window when rapidly changing dates. This value is longer than the default press and
// hold delay for most operating systems so that we don't get an initial change response when you first press down and
// hold. This delay needs to be shorter than ALERT_DELAY_AFTER_CHANGING_CONCENTRATION or else the alerts could come
// through in the wrong order.
const delayAfterChangingDate = 1.5; // in seconds
assert && assert(delayAfterChangingDate < ALERT_DELAY_AFTER_CHANGING_CONCENTRATION, 'delay will cause alerts to be out of order');
const DATE_CHANGE_UTTERANCE_OPTIONS = {
  alertStableDelay: delayAfterChangingDate * 1000 // UtteranceQueue uses ms
};

// The parts of the model that are described as they change over time, more slowly behind ALERT_INTERVAL.

// The model state that should be described as soon as possible every time it changes,

class GasConcentrationAlerter extends Alerter {
  // reference to the model, used in the methods

  // Time that has passed since last alert, when this equals ALERT_INTERVAL, a new alert is sent the UtteranceQueue.

  // The number of times that the temperature change alert has been announced. Whenever the concentration value changes
  // this count is reset. Every time this counter is an interval of NUMBER_OF_TERSE_TEMPERATURE_ALERTS, a more
  // verbose temperature description is used. Otherwise, a very terse alert is used. This is an attempt to reduce how
  // much is spoken every ALERT_INTERVAL
  // When true, an extra verbose fragment about the surface temperature will be included. This will be true whenever
  // the concentration changes.
  // After a change in concentration control mode we are going to describe temperatures as 'stabilizing' to give a more
  // generic description of changes and prevent overwhelming the user with too much information. See
  // https://github.com/phetsims/greenhouse-effect/issues/199#issuecomment-1211220790
  describeTemperatureAsStabilizing = false;

  // Snapshot of the important described model Properties that are used every time we generate a description. Actual
  // initial values are populated on construction.
  // Utterances that describe the changing scene and concentration when controlling by date. Using
  // reusable Utterances allows this information to "collapse" in the queue and only the most
  // recent change is heard when rapid updates happen.
  observationWindowSceneUtterance = new Utterance(DATE_CHANGE_UTTERANCE_OPTIONS);
  concentrationChangeUtterance = new Utterance(DATE_CHANGE_UTTERANCE_OPTIONS);
  constructor(model, providedOptions) {
    const options = optionize()({
      // This alerter and simulation does not support Voicing.
      alertToVoicing: false
    }, providedOptions);
    super(options);
    this.model = model;
    this.useVerboseSurfaceTemperatureAlert = true;
    this.temperatureChangeAlertCount = 0;
    this.timeSinceLastAlert = 0;
    this.outgoingEnergyProperty = model.outerSpace.incomingUpwardMovingEnergyRateTracker.energyRateProperty;
    this.incomingEnergyProperty = model.sunEnergySource.outputEnergyRateTracker.energyRateProperty;
    this.netEnergyProperty = new DerivedProperty([this.incomingEnergyProperty, this.outgoingEnergyProperty], (inEnergy, outEnergy) => {
      return inEnergy - outEnergy;
    });
    this.previousPeriodicNotificationModelState = this.savePeriodicNotificationModelState();
    this.previousImmediateNotificationModelState = this.saveImmediateNotificationModelState();

    // When we reach equilibrium at the ground layer, announce that state immediately. This doesn't need to be
    // ordered in with the other alerts so it doesn't need to be in the polling solution. But it could be moved
    // to "immediate" state model if that is more clear in the future.
    model.groundLayer.atEquilibriumProperty.lazyLink(atEquilibrium => {
      if (atEquilibrium) {
        this.alert(TemperatureDescriber.getSurfaceTemperatureStableString(model.surfaceTemperatureKelvinProperty.value, model.surfaceThermometerVisibleProperty.value, model.surfaceTemperatureVisibleProperty.value, model.temperatureUnitsProperty.value, model.concentrationControlModeProperty.value, model.dateProperty.value));
      }
    });

    // Announce the temperature when the user changes the units. This is unrelated to the concentration and temperature
    // change alerts that happen in the polling implementation so it can stay in a linked listener. But this could
    // move to "immediate" state model someday if that is more clear.
    model.temperatureUnitsProperty.lazyLink(temperatureUnits => {
      this.alert(TemperatureDescriber.getQuantitativeTemperatureDescription(model.surfaceTemperatureKelvinProperty.value, temperatureUnits));
    });

    // Whenever the concentration changes, use the most verbose form of the temperature change alert.
    model.concentrationProperty.link(() => {
      this.useVerboseSurfaceTemperatureAlert = true;
      this.temperatureChangeAlertCount = 0;

      // after changing concentration, we should quickly hear content instead of waiting the full ALERT_INTERVAL
      this.timeSinceLastAlert = ALERT_INTERVAL - ALERT_DELAY_AFTER_CHANGING_CONCENTRATION;
      assert && assert(this.timeSinceLastAlert >= 0, 'setting timing variable to a negative value, your interval values need adjusting');
    });
    model.concentrationControlModeProperty.lazyLink(() => {
      // After changing the concentration control mode, reset the `timeSinceLastAlert` so we have a full delay
      // before describing the new scene
      this.timeSinceLastAlert = 0;

      // After a change in concentration control mode, temperature changes are described as 'stabilizing', see
      // declaration for more information.
      this.describeTemperatureAsStabilizing = true;
    });

    // Alert when the sun starts shining, with unique hint that warns nothing will happen if the sim is paused. This
    // alert is unrelated to concentration and temperature alerts that happen in the polling so it can stay in a
    // linked listener. But it could move to the polling implementation in "immediate state model" if that is more
    // clear.
    model.sunEnergySource.isShiningProperty.lazyLink(() => {
      this.alert(RadiationDescriber.getSunlightStartedDescription(model.isPlayingProperty.value));
    });
  }

  /**
   * Save the model state that is used for descriptions that occur periodically at every ALERT_INTERVAL.
   */
  savePeriodicNotificationModelState() {
    this.previousPeriodicNotificationModelState = this.previousPeriodicNotificationModelState || {
      temperature: 0,
      concentration: 0,
      outgoingEnergy: 0,
      netInflowOfEnergy: 0,
      concentrationControlMode: this.model.concentrationControlModeProperty.value
    };
    this.previousPeriodicNotificationModelState.temperature = this.getCurrentTemperature();
    this.previousPeriodicNotificationModelState.concentration = this.model.concentrationProperty.value;
    this.previousPeriodicNotificationModelState.outgoingEnergy = this.outgoingEnergyProperty.value;
    this.previousPeriodicNotificationModelState.netInflowOfEnergy = this.model.netInflowOfEnergyProperty.value;
    this.previousPeriodicNotificationModelState.concentrationControlMode = this.model.concentrationControlModeProperty.value;
    return this.previousPeriodicNotificationModelState;
  }
  saveImmediateNotificationModelState() {
    this.previousImmediateNotificationModelState = this.previousImmediateNotificationModelState || {
      cloudEnabled: this.model.cloudEnabledProperty.value,
      concentrationControlMode: this.model.concentrationControlModeProperty.value,
      concentrationDate: this.model.dateProperty.value
    };
    this.previousImmediateNotificationModelState.cloudEnabled = this.model.cloudEnabledProperty.value;
    this.previousImmediateNotificationModelState.concentrationControlMode = this.model.concentrationControlModeProperty.value;
    this.previousImmediateNotificationModelState.concentrationDate = this.model.dateProperty.value;
    return this.previousImmediateNotificationModelState;
  }

  /**
   * Do some rounding on the current temperature so that we don't alert when the changes are too small.
   */
  getCurrentTemperature() {
    return Utils.toFixedNumber(this.model.surfaceTemperatureKelvinProperty.value, TEMPERATURE_DECIMAL_PLACES);
  }

  /**
   * Create new alerts if the state of the simulation has changed and timing variables indicate it is time. This step
   * function should be called every view step, regardless of whether the model is playing because certain alerts
   * describe updates that are unrelated to the changing concentration model (see
   * "previousImmediateNotificationModelState").
   *
   * @param dt - in seconds
   */
  step(dt) {
    // Start by alerting "immediate" model changes. These are updates that need to be described as soon as they change.
    const currentControlMode = this.model.concentrationControlModeProperty.value;
    if (this.previousImmediateNotificationModelState.concentrationControlMode !== currentControlMode) {
      if (currentControlMode === ConcentrationControlMode.BY_DATE) {
        // If controlling by date, include a description of the selected date.
        this.alert(ConcentrationDescriber.getTimePeriodChangeDescription(this.model.dateProperty.value));
      } else {
        // In manual mode, describe the relative level of concentration.
        this.alert(ConcentrationDescriber.getCurrentConcentrationLevelsDescription(this.model.concentrationProperty.value));
      }
    }
    const currentDate = this.model.dateProperty.value;
    const previousDate = this.previousImmediateNotificationModelState.concentrationDate;
    if (previousDate !== currentDate) {
      this.observationWindowSceneUtterance.alert = ConcentrationDescriber.getObservationWindowNowTimePeriodDescription(currentDate);
      this.concentrationChangeUtterance.alert = ConcentrationDescriber.getQualitativeConcentrationChangeDescription(ConcentrationModel.getConcentrationForDate(previousDate), previousDate, ConcentrationModel.getConcentrationForDate(currentDate));
      this.alert(this.observationWindowSceneUtterance);
      this.alert(this.concentrationChangeUtterance);
    }
    const cloudEnabled = this.model.cloudEnabledProperty.value;
    if (this.previousImmediateNotificationModelState.cloudEnabled !== cloudEnabled) {
      this.alert(ConcentrationDescriber.getSkyCloudChangeDescription(cloudEnabled, this.model.sunEnergySource.isShiningProperty.value));
    }

    // Now alert "periodic" changes. These are update that are only described every ALERT_INTERVAL.
    // "periodic" alerts will only progress if the model is currently stepping as well
    if (this.model.isPlayingProperty.value) {
      this.timeSinceLastAlert += dt;
    }
    if (this.timeSinceLastAlert > ALERT_INTERVAL) {
      const previousControlModeFromPeriodState = this.previousPeriodicNotificationModelState.concentrationControlMode;
      const currentTemperature = this.getCurrentTemperature();
      const currentConcentration = this.model.concentrationProperty.value;
      if (!this.model.groundLayer.atEquilibriumProperty.value) {
        // Infrared radiation descriptions are only present if concentration changed while the concentration control
        // mode stayed the same
        if (previousControlModeFromPeriodState === currentControlMode) {
          // First, a description of the changing radiation redirecting back to the surface - this should only happen if
          // there was some change to the concentration.
          if (this.model.isInfraredPresent() && currentConcentration !== this.previousPeriodicNotificationModelState.concentration) {
            const radiationRedirectingAlert = RadiationDescriber.getRadiationRedirectionDescription(currentConcentration, this.previousPeriodicNotificationModelState.concentration);
            radiationRedirectingAlert && this.alert(radiationRedirectingAlert);
          }

          // Then, description of the changing surface temperature - again, only if there is some change in the
          // concentration.
          if (this.model.isInfraredPresent() && currentConcentration !== this.previousPeriodicNotificationModelState.concentration) {
            const surfaceRadiationAlertString = RadiationDescriber.getRadiationFromSurfaceChangeDescription(this.model.concentrationProperty.value, this.previousPeriodicNotificationModelState.concentration);
            surfaceRadiationAlertString && this.alert(surfaceRadiationAlertString);
          }
        }

        // Then, a description of the changing temperature - this should get described at interval even if there
        // is no change in concentration. There is a delay after concentration changes to avoid spamming the user with
        // too much information after concentration changes. Depending on how many times it has been spoken a terse
        // form of it may be used (handled in getSurfaceTemperatureChangeString).

        // To reduce verbosity the temperature value is included only every NUMBER_OF_TERSE_TEMPERATURE_ALERTS that
        // this response is created. Temperature must also be visible in the view.
        const includeTemperatureValue = this.model.surfaceThermometerVisibleProperty.value && this.temperatureChangeAlertCount === 0;
        const temperatureAlertString = TemperatureDescriber.getSurfaceTemperatureChangeString(this.previousPeriodicNotificationModelState.temperature, currentTemperature, includeTemperatureValue, this.model.temperatureUnitsProperty.value, this.useVerboseSurfaceTemperatureAlert,
        // when the control mode changes, it was requested that the temperature be described as 'stabilizing'
        // instead of 'warming' or 'cooling',
        // see https://github.com/phetsims/greenhouse-effect/issues/199#issuecomment-1211220790
        this.describeTemperatureAsStabilizing);
        temperatureAlertString && this.alert(temperatureAlertString);

        // reset counter if we have spoken the terse form of the temperature change alert enough times
        this.temperatureChangeAlertCount = this.temperatureChangeAlertCount >= NUMBER_OF_TERSE_TEMPERATURE_ALERTS ? 0 : this.temperatureChangeAlertCount + 1;

        // not verbose until concentration changes again
        this.useVerboseSurfaceTemperatureAlert = false;

        // Accurately describe temperature alerts next iteration.
        this.describeTemperatureAsStabilizing = false;
      }
      if (previousControlModeFromPeriodState === currentControlMode) {
        if (this.model.energyBalanceVisibleProperty.value) {
          // Did the energy balance change in such a way that we need to describe it?
          const currentNetInflowOfEnergy = this.model.netInflowOfEnergyProperty.value;
          const previousNetInflowOfEnergy = this.previousPeriodicNotificationModelState.netInflowOfEnergy;
          if (previousNetInflowOfEnergy < -LayersModel.RADIATIVE_BALANCE_THRESHOLD && currentNetInflowOfEnergy > -LayersModel.RADIATIVE_BALANCE_THRESHOLD || previousNetInflowOfEnergy > LayersModel.RADIATIVE_BALANCE_THRESHOLD && currentNetInflowOfEnergy < LayersModel.RADIATIVE_BALANCE_THRESHOLD || Math.abs(previousNetInflowOfEnergy) < LayersModel.RADIATIVE_BALANCE_THRESHOLD && Math.abs(currentNetInflowOfEnergy) > LayersModel.RADIATIVE_BALANCE_THRESHOLD) {
            // Yep.
            const outgoingEnergyAlertString = EnergyDescriber.getNetEnergyAtAtmosphereDescription(currentNetInflowOfEnergy, this.model.inRadiativeBalanceProperty.value);
            outgoingEnergyAlertString && this.alert(outgoingEnergyAlertString);
          }
        }
      }
      this.savePeriodicNotificationModelState();
      this.timeSinceLastAlert = 0;
    }
    this.saveImmediateNotificationModelState();
  }

  /**
   * Reset this to its initial state.  For this to work properly, the model must be reset prior to calling this method.
   */
  reset() {
    this.temperatureChangeAlertCount = 0;
    this.timeSinceLastAlert = 0;
    this.describeTemperatureAsStabilizing = false;
    this.savePeriodicNotificationModelState();
    this.saveImmediateNotificationModelState();
  }
}
greenhouseEffect.register('GasConcentrationAlerter', GasConcentrationAlerter);
export default GasConcentrationAlerter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJVdGlscyIsIm9wdGlvbml6ZSIsIkFsZXJ0ZXIiLCJVdHRlcmFuY2UiLCJncmVlbmhvdXNlRWZmZWN0IiwiQ29uY2VudHJhdGlvbk1vZGVsIiwiQ29uY2VudHJhdGlvbkNvbnRyb2xNb2RlIiwiTGF5ZXJzTW9kZWwiLCJDb25jZW50cmF0aW9uRGVzY3JpYmVyIiwiRW5lcmd5RGVzY3JpYmVyIiwiUmFkaWF0aW9uRGVzY3JpYmVyIiwiVGVtcGVyYXR1cmVEZXNjcmliZXIiLCJURU1QRVJBVFVSRV9ERUNJTUFMX1BMQUNFUyIsIkFMRVJUX0lOVEVSVkFMIiwiQUxFUlRfREVMQVlfQUZURVJfQ0hBTkdJTkdfQ09OQ0VOVFJBVElPTiIsIk5VTUJFUl9PRl9URVJTRV9URU1QRVJBVFVSRV9BTEVSVFMiLCJkZWxheUFmdGVyQ2hhbmdpbmdEYXRlIiwiYXNzZXJ0IiwiREFURV9DSEFOR0VfVVRURVJBTkNFX09QVElPTlMiLCJhbGVydFN0YWJsZURlbGF5IiwiR2FzQ29uY2VudHJhdGlvbkFsZXJ0ZXIiLCJkZXNjcmliZVRlbXBlcmF0dXJlQXNTdGFiaWxpemluZyIsIm9ic2VydmF0aW9uV2luZG93U2NlbmVVdHRlcmFuY2UiLCJjb25jZW50cmF0aW9uQ2hhbmdlVXR0ZXJhbmNlIiwiY29uc3RydWN0b3IiLCJtb2RlbCIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJhbGVydFRvVm9pY2luZyIsInVzZVZlcmJvc2VTdXJmYWNlVGVtcGVyYXR1cmVBbGVydCIsInRlbXBlcmF0dXJlQ2hhbmdlQWxlcnRDb3VudCIsInRpbWVTaW5jZUxhc3RBbGVydCIsIm91dGdvaW5nRW5lcmd5UHJvcGVydHkiLCJvdXRlclNwYWNlIiwiaW5jb21pbmdVcHdhcmRNb3ZpbmdFbmVyZ3lSYXRlVHJhY2tlciIsImVuZXJneVJhdGVQcm9wZXJ0eSIsImluY29taW5nRW5lcmd5UHJvcGVydHkiLCJzdW5FbmVyZ3lTb3VyY2UiLCJvdXRwdXRFbmVyZ3lSYXRlVHJhY2tlciIsIm5ldEVuZXJneVByb3BlcnR5IiwiaW5FbmVyZ3kiLCJvdXRFbmVyZ3kiLCJwcmV2aW91c1BlcmlvZGljTm90aWZpY2F0aW9uTW9kZWxTdGF0ZSIsInNhdmVQZXJpb2RpY05vdGlmaWNhdGlvbk1vZGVsU3RhdGUiLCJwcmV2aW91c0ltbWVkaWF0ZU5vdGlmaWNhdGlvbk1vZGVsU3RhdGUiLCJzYXZlSW1tZWRpYXRlTm90aWZpY2F0aW9uTW9kZWxTdGF0ZSIsImdyb3VuZExheWVyIiwiYXRFcXVpbGlicml1bVByb3BlcnR5IiwibGF6eUxpbmsiLCJhdEVxdWlsaWJyaXVtIiwiYWxlcnQiLCJnZXRTdXJmYWNlVGVtcGVyYXR1cmVTdGFibGVTdHJpbmciLCJzdXJmYWNlVGVtcGVyYXR1cmVLZWx2aW5Qcm9wZXJ0eSIsInZhbHVlIiwic3VyZmFjZVRoZXJtb21ldGVyVmlzaWJsZVByb3BlcnR5Iiwic3VyZmFjZVRlbXBlcmF0dXJlVmlzaWJsZVByb3BlcnR5IiwidGVtcGVyYXR1cmVVbml0c1Byb3BlcnR5IiwiY29uY2VudHJhdGlvbkNvbnRyb2xNb2RlUHJvcGVydHkiLCJkYXRlUHJvcGVydHkiLCJ0ZW1wZXJhdHVyZVVuaXRzIiwiZ2V0UXVhbnRpdGF0aXZlVGVtcGVyYXR1cmVEZXNjcmlwdGlvbiIsImNvbmNlbnRyYXRpb25Qcm9wZXJ0eSIsImxpbmsiLCJpc1NoaW5pbmdQcm9wZXJ0eSIsImdldFN1bmxpZ2h0U3RhcnRlZERlc2NyaXB0aW9uIiwiaXNQbGF5aW5nUHJvcGVydHkiLCJ0ZW1wZXJhdHVyZSIsImNvbmNlbnRyYXRpb24iLCJvdXRnb2luZ0VuZXJneSIsIm5ldEluZmxvd09mRW5lcmd5IiwiY29uY2VudHJhdGlvbkNvbnRyb2xNb2RlIiwiZ2V0Q3VycmVudFRlbXBlcmF0dXJlIiwibmV0SW5mbG93T2ZFbmVyZ3lQcm9wZXJ0eSIsImNsb3VkRW5hYmxlZCIsImNsb3VkRW5hYmxlZFByb3BlcnR5IiwiY29uY2VudHJhdGlvbkRhdGUiLCJ0b0ZpeGVkTnVtYmVyIiwic3RlcCIsImR0IiwiY3VycmVudENvbnRyb2xNb2RlIiwiQllfREFURSIsImdldFRpbWVQZXJpb2RDaGFuZ2VEZXNjcmlwdGlvbiIsImdldEN1cnJlbnRDb25jZW50cmF0aW9uTGV2ZWxzRGVzY3JpcHRpb24iLCJjdXJyZW50RGF0ZSIsInByZXZpb3VzRGF0ZSIsImdldE9ic2VydmF0aW9uV2luZG93Tm93VGltZVBlcmlvZERlc2NyaXB0aW9uIiwiZ2V0UXVhbGl0YXRpdmVDb25jZW50cmF0aW9uQ2hhbmdlRGVzY3JpcHRpb24iLCJnZXRDb25jZW50cmF0aW9uRm9yRGF0ZSIsImdldFNreUNsb3VkQ2hhbmdlRGVzY3JpcHRpb24iLCJwcmV2aW91c0NvbnRyb2xNb2RlRnJvbVBlcmlvZFN0YXRlIiwiY3VycmVudFRlbXBlcmF0dXJlIiwiY3VycmVudENvbmNlbnRyYXRpb24iLCJpc0luZnJhcmVkUHJlc2VudCIsInJhZGlhdGlvblJlZGlyZWN0aW5nQWxlcnQiLCJnZXRSYWRpYXRpb25SZWRpcmVjdGlvbkRlc2NyaXB0aW9uIiwic3VyZmFjZVJhZGlhdGlvbkFsZXJ0U3RyaW5nIiwiZ2V0UmFkaWF0aW9uRnJvbVN1cmZhY2VDaGFuZ2VEZXNjcmlwdGlvbiIsImluY2x1ZGVUZW1wZXJhdHVyZVZhbHVlIiwidGVtcGVyYXR1cmVBbGVydFN0cmluZyIsImdldFN1cmZhY2VUZW1wZXJhdHVyZUNoYW5nZVN0cmluZyIsImVuZXJneUJhbGFuY2VWaXNpYmxlUHJvcGVydHkiLCJjdXJyZW50TmV0SW5mbG93T2ZFbmVyZ3kiLCJwcmV2aW91c05ldEluZmxvd09mRW5lcmd5IiwiUkFESUFUSVZFX0JBTEFOQ0VfVEhSRVNIT0xEIiwiTWF0aCIsImFicyIsIm91dGdvaW5nRW5lcmd5QWxlcnRTdHJpbmciLCJnZXROZXRFbmVyZ3lBdEF0bW9zcGhlcmVEZXNjcmlwdGlvbiIsImluUmFkaWF0aXZlQmFsYW5jZVByb3BlcnR5IiwicmVzZXQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkdhc0NvbmNlbnRyYXRpb25BbGVydGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFJlc3BvbnNpYmxlIGZvciBnZW5lcmF0aW5nIGFuZCB0aW1pbmcgYWxlcnRzIHJlbGF0ZWQgdG8gZ2FzIGNvbmNlbnRyYXRpb24gaW4gdGhpcyBzaW0uIEEgcG9sbGluZyBtZXRob2QgaXMgdXNlZFxyXG4gKiB0byB0aW1lIHRoZSBhbGVydHMgYW5kIGRldGVybWluZSBob3cgbW9kZWwgdmFyaWFibGVzIGhhdmUgY2hhbmdlZCB0byBjcmVhdGUgYW4gYWNjdXJhdGUgZGVzY3JpcHRpb24uXHJcbiAqXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKlxyXG4gKlxyXG4gKiBUT0RPOiAxLzUvMjAyMiAtIFRoaXMgaXMgbmFtZWQgR2FzQ29uY2VudHJhdGlvbkFsZXJ0ZXIsIGJ1dCBpdCdzIGRvaW5nIG1vcmUgdGhhbiBqdXN0IHRhbGtpbmcgYWJvdXQgdGhlIHN0YXRlLiAgV2VcclxuICogICAgICAgICAgICAgICAgICBzaG91bGQgY29uc2lkZXIgYSBuZXcgbmFtZSwgcGVyaGFwcyBMYXllck1vZGVsU3RhdGVBbGVydGVyIG9yIHNvbWV0aGluZyBhbG9uZyB0aG9zZSBsaW5lcy4gIFNlZVxyXG4gKiAgICAgICAgICAgICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmVlbmhvdXNlLWVmZmVjdC9pc3N1ZXMvMTI5LlxyXG4gKi9cclxuXHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgQWxlcnRlciwgeyBBbGVydGVyT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9hY2Nlc3NpYmlsaXR5L2Rlc2NyaWJlcnMvQWxlcnRlci5qcyc7XHJcbmltcG9ydCBVdHRlcmFuY2UgZnJvbSAnLi4vLi4vLi4vLi4vdXR0ZXJhbmNlLXF1ZXVlL2pzL1V0dGVyYW5jZS5qcyc7XHJcbmltcG9ydCBncmVlbmhvdXNlRWZmZWN0IGZyb20gJy4uLy4uL2dyZWVuaG91c2VFZmZlY3QuanMnO1xyXG5pbXBvcnQgQ29uY2VudHJhdGlvbk1vZGVsLCB7IENvbmNlbnRyYXRpb25Db250cm9sTW9kZSwgQ29uY2VudHJhdGlvbkRhdGUgfSBmcm9tICcuLi9tb2RlbC9Db25jZW50cmF0aW9uTW9kZWwuanMnO1xyXG5pbXBvcnQgTGF5ZXJzTW9kZWwgZnJvbSAnLi4vbW9kZWwvTGF5ZXJzTW9kZWwuanMnO1xyXG5pbXBvcnQgQ29uY2VudHJhdGlvbkRlc2NyaWJlciBmcm9tICcuL2Rlc2NyaWJlcnMvQ29uY2VudHJhdGlvbkRlc2NyaWJlci5qcyc7XHJcbmltcG9ydCBFbmVyZ3lEZXNjcmliZXIgZnJvbSAnLi9kZXNjcmliZXJzL0VuZXJneURlc2NyaWJlci5qcyc7XHJcbmltcG9ydCBSYWRpYXRpb25EZXNjcmliZXIgZnJvbSAnLi9kZXNjcmliZXJzL1JhZGlhdGlvbkRlc2NyaWJlci5qcyc7XHJcbmltcG9ydCBUZW1wZXJhdHVyZURlc2NyaWJlciBmcm9tICcuL2Rlc2NyaWJlcnMvVGVtcGVyYXR1cmVEZXNjcmliZXIuanMnO1xyXG5cclxuLy8gbnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzIHRvIHBheSBhdHRlbnRpb24gdG8gaW4gdGhlIHRlbXBlcmF0dXJlIHZhbHVlc1xyXG5jb25zdCBURU1QRVJBVFVSRV9ERUNJTUFMX1BMQUNFUyA9IDE7XHJcblxyXG4vLyBpbiBzZWNvbmRzLCBob3cgZnJlcXVlbnRseSB0byBzZW5kIGFuIGFsZXJ0IHRvIHRoZSBVdHRlcmFuY2VRdWV1ZSBkZXNjcmliaW5nIGNoYW5naW5nIGNvbmNlbnRyYXRpb25zXHJcbmNvbnN0IEFMRVJUX0lOVEVSVkFMID0gNDtcclxuXHJcbi8vIGluIHNlY29uZHMsIGhvdyBsb25nIHRvIHdhaXQgYmVmb3JlIHRoZSBuZXh0IGFsZXJ0IGFmdGVyIGNoYW5naW5nIHRoZSBjb25jZW50cmF0aW9uIHZhbHVlXHJcbmNvbnN0IEFMRVJUX0RFTEFZX0FGVEVSX0NIQU5HSU5HX0NPTkNFTlRSQVRJT04gPSAyO1xyXG5cclxuLy8gSG93IG1hbnkgdGltZXMgYSB0ZXJzZSB0ZW1wZXJhdHVyZSBhbGVydCBzaG91bGQgYmUgc3Bva2VuIGJlZm9yZSBhIHZlcmJvc2UgdGVtcGVyYXR1cmUgYWxlcnQgaXMgdXNlZC4gTm90ZSB0aGlzXHJcbi8vIGlzIGEgY291bnRpbmcgdmFyaWFibGUsIG5vdCBpbiB1bml0cyBvZiB0aW1lLlxyXG5jb25zdCBOVU1CRVJfT0ZfVEVSU0VfVEVNUEVSQVRVUkVfQUxFUlRTID0gMjtcclxuXHJcbi8vIEEgaGlnaGVyIGRlbGF5IGJlZm9yZSB3YWl0aW5nIGZvciB0aGUgVXR0ZXJhbmNlIHRvIHN0YWJpbGl6ZSBzbyB0aGF0IHdlIGRvbid0IGhlYXIgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG5ld1xyXG4vLyBzY2VuZSBpbiB0aGUgb2JzZXJ2YXRpb24gd2luZG93IHdoZW4gcmFwaWRseSBjaGFuZ2luZyBkYXRlcy4gVGhpcyB2YWx1ZSBpcyBsb25nZXIgdGhhbiB0aGUgZGVmYXVsdCBwcmVzcyBhbmRcclxuLy8gaG9sZCBkZWxheSBmb3IgbW9zdCBvcGVyYXRpbmcgc3lzdGVtcyBzbyB0aGF0IHdlIGRvbid0IGdldCBhbiBpbml0aWFsIGNoYW5nZSByZXNwb25zZSB3aGVuIHlvdSBmaXJzdCBwcmVzcyBkb3duIGFuZFxyXG4vLyBob2xkLiBUaGlzIGRlbGF5IG5lZWRzIHRvIGJlIHNob3J0ZXIgdGhhbiBBTEVSVF9ERUxBWV9BRlRFUl9DSEFOR0lOR19DT05DRU5UUkFUSU9OIG9yIGVsc2UgdGhlIGFsZXJ0cyBjb3VsZCBjb21lXHJcbi8vIHRocm91Z2ggaW4gdGhlIHdyb25nIG9yZGVyLlxyXG5jb25zdCBkZWxheUFmdGVyQ2hhbmdpbmdEYXRlID0gMS41OyAvLyBpbiBzZWNvbmRzXHJcbmFzc2VydCAmJiBhc3NlcnQoIGRlbGF5QWZ0ZXJDaGFuZ2luZ0RhdGUgPCBBTEVSVF9ERUxBWV9BRlRFUl9DSEFOR0lOR19DT05DRU5UUkFUSU9OLFxyXG4gICdkZWxheSB3aWxsIGNhdXNlIGFsZXJ0cyB0byBiZSBvdXQgb2Ygb3JkZXInICk7XHJcbmNvbnN0IERBVEVfQ0hBTkdFX1VUVEVSQU5DRV9PUFRJT05TID0ge1xyXG4gIGFsZXJ0U3RhYmxlRGVsYXk6IGRlbGF5QWZ0ZXJDaGFuZ2luZ0RhdGUgKiAxMDAwIC8vIFV0dGVyYW5jZVF1ZXVlIHVzZXMgbXNcclxufTtcclxuXHJcbi8vIFRoZSBwYXJ0cyBvZiB0aGUgbW9kZWwgdGhhdCBhcmUgZGVzY3JpYmVkIGFzIHRoZXkgY2hhbmdlIG92ZXIgdGltZSwgbW9yZSBzbG93bHkgYmVoaW5kIEFMRVJUX0lOVEVSVkFMLlxyXG50eXBlIFByZXZpb3VzUGVyaW9kaWNOb3RpZmljYXRpb25Nb2RlbFN0YXRlID0ge1xyXG4gIHRlbXBlcmF0dXJlOiBudW1iZXI7XHJcbiAgY29uY2VudHJhdGlvbjogbnVtYmVyO1xyXG4gIG91dGdvaW5nRW5lcmd5OiBudW1iZXI7XHJcbiAgbmV0SW5mbG93T2ZFbmVyZ3k6IG51bWJlcjtcclxuXHJcbiAgLy8gVGhpcyBpcyBpbiBtb3RoIHBlcmlvZGljIGFuZCBpbW1lZGlhdGUgc3RhdGUgLSB3aGVuIHRoaXMgY2hhbmdlcyB3ZSBuZWVkIHRvIG5vdGlmeSBzb21lIGluZm9ybWF0aW9uIGltbWVkaWF0ZWx5XHJcbiAgLy8gYW5kIHNvbWUgaW5mb3JtYXRpb24gYXQgdGhlIG5leHQgQUxFUlRfSU5URVJWQUwgcmVsYXRlZCB0byB0aGlzIGNoYW5nZS5cclxuICBjb25jZW50cmF0aW9uQ29udHJvbE1vZGU6IENvbmNlbnRyYXRpb25Db250cm9sTW9kZTtcclxufTtcclxuXHJcbi8vIFRoZSBtb2RlbCBzdGF0ZSB0aGF0IHNob3VsZCBiZSBkZXNjcmliZWQgYXMgc29vbiBhcyBwb3NzaWJsZSBldmVyeSB0aW1lIGl0IGNoYW5nZXMsXHJcbnR5cGUgUHJldmlvdXNJbW1lZGlhdGVOb3RpZmljYXRpb25Nb2RlbFN0YXRlID0ge1xyXG4gIGNvbmNlbnRyYXRpb25Db250cm9sTW9kZTogQ29uY2VudHJhdGlvbkNvbnRyb2xNb2RlO1xyXG4gIGNsb3VkRW5hYmxlZDogYm9vbGVhbjtcclxuICBjb25jZW50cmF0aW9uRGF0ZTogQ29uY2VudHJhdGlvbkRhdGU7XHJcbn07XHJcblxyXG5jbGFzcyBHYXNDb25jZW50cmF0aW9uQWxlcnRlciBleHRlbmRzIEFsZXJ0ZXIge1xyXG5cclxuICAvLyByZWZlcmVuY2UgdG8gdGhlIG1vZGVsLCB1c2VkIGluIHRoZSBtZXRob2RzXHJcbiAgcHJpdmF0ZSByZWFkb25seSBtb2RlbDogQ29uY2VudHJhdGlvbk1vZGVsO1xyXG5cclxuICAvLyBUaW1lIHRoYXQgaGFzIHBhc3NlZCBzaW5jZSBsYXN0IGFsZXJ0LCB3aGVuIHRoaXMgZXF1YWxzIEFMRVJUX0lOVEVSVkFMLCBhIG5ldyBhbGVydCBpcyBzZW50IHRoZSBVdHRlcmFuY2VRdWV1ZS5cclxuICBwcml2YXRlIHRpbWVTaW5jZUxhc3RBbGVydDogbnVtYmVyO1xyXG5cclxuICAvLyBUaGUgbnVtYmVyIG9mIHRpbWVzIHRoYXQgdGhlIHRlbXBlcmF0dXJlIGNoYW5nZSBhbGVydCBoYXMgYmVlbiBhbm5vdW5jZWQuIFdoZW5ldmVyIHRoZSBjb25jZW50cmF0aW9uIHZhbHVlIGNoYW5nZXNcclxuICAvLyB0aGlzIGNvdW50IGlzIHJlc2V0LiBFdmVyeSB0aW1lIHRoaXMgY291bnRlciBpcyBhbiBpbnRlcnZhbCBvZiBOVU1CRVJfT0ZfVEVSU0VfVEVNUEVSQVRVUkVfQUxFUlRTLCBhIG1vcmVcclxuICAvLyB2ZXJib3NlIHRlbXBlcmF0dXJlIGRlc2NyaXB0aW9uIGlzIHVzZWQuIE90aGVyd2lzZSwgYSB2ZXJ5IHRlcnNlIGFsZXJ0IGlzIHVzZWQuIFRoaXMgaXMgYW4gYXR0ZW1wdCB0byByZWR1Y2UgaG93XHJcbiAgLy8gbXVjaCBpcyBzcG9rZW4gZXZlcnkgQUxFUlRfSU5URVJWQUxcclxuICBwcml2YXRlIHRlbXBlcmF0dXJlQ2hhbmdlQWxlcnRDb3VudDogbnVtYmVyO1xyXG5cclxuICAvLyBXaGVuIHRydWUsIGFuIGV4dHJhIHZlcmJvc2UgZnJhZ21lbnQgYWJvdXQgdGhlIHN1cmZhY2UgdGVtcGVyYXR1cmUgd2lsbCBiZSBpbmNsdWRlZC4gVGhpcyB3aWxsIGJlIHRydWUgd2hlbmV2ZXJcclxuICAvLyB0aGUgY29uY2VudHJhdGlvbiBjaGFuZ2VzLlxyXG4gIHByaXZhdGUgdXNlVmVyYm9zZVN1cmZhY2VUZW1wZXJhdHVyZUFsZXJ0OiBib29sZWFuO1xyXG5cclxuICAvLyBBZnRlciBhIGNoYW5nZSBpbiBjb25jZW50cmF0aW9uIGNvbnRyb2wgbW9kZSB3ZSBhcmUgZ29pbmcgdG8gZGVzY3JpYmUgdGVtcGVyYXR1cmVzIGFzICdzdGFiaWxpemluZycgdG8gZ2l2ZSBhIG1vcmVcclxuICAvLyBnZW5lcmljIGRlc2NyaXB0aW9uIG9mIGNoYW5nZXMgYW5kIHByZXZlbnQgb3ZlcndoZWxtaW5nIHRoZSB1c2VyIHdpdGggdG9vIG11Y2ggaW5mb3JtYXRpb24uIFNlZVxyXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmVlbmhvdXNlLWVmZmVjdC9pc3N1ZXMvMTk5I2lzc3VlY29tbWVudC0xMjExMjIwNzkwXHJcbiAgcHJpdmF0ZSBkZXNjcmliZVRlbXBlcmF0dXJlQXNTdGFiaWxpemluZyA9IGZhbHNlO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IG91dGdvaW5nRW5lcmd5UHJvcGVydHk6IE51bWJlclByb3BlcnR5O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgaW5jb21pbmdFbmVyZ3lQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHk7XHJcbiAgcHJpdmF0ZSBuZXRFbmVyZ3lQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPjtcclxuXHJcbiAgLy8gU25hcHNob3Qgb2YgdGhlIGltcG9ydGFudCBkZXNjcmliZWQgbW9kZWwgUHJvcGVydGllcyB0aGF0IGFyZSB1c2VkIGV2ZXJ5IHRpbWUgd2UgZ2VuZXJhdGUgYSBkZXNjcmlwdGlvbi4gQWN0dWFsXHJcbiAgLy8gaW5pdGlhbCB2YWx1ZXMgYXJlIHBvcHVsYXRlZCBvbiBjb25zdHJ1Y3Rpb24uXHJcbiAgcHJpdmF0ZSBwcmV2aW91c1BlcmlvZGljTm90aWZpY2F0aW9uTW9kZWxTdGF0ZTogUHJldmlvdXNQZXJpb2RpY05vdGlmaWNhdGlvbk1vZGVsU3RhdGU7XHJcblxyXG4gIHByaXZhdGUgcHJldmlvdXNJbW1lZGlhdGVOb3RpZmljYXRpb25Nb2RlbFN0YXRlOiBQcmV2aW91c0ltbWVkaWF0ZU5vdGlmaWNhdGlvbk1vZGVsU3RhdGU7XHJcblxyXG4gIC8vIFV0dGVyYW5jZXMgdGhhdCBkZXNjcmliZSB0aGUgY2hhbmdpbmcgc2NlbmUgYW5kIGNvbmNlbnRyYXRpb24gd2hlbiBjb250cm9sbGluZyBieSBkYXRlLiBVc2luZ1xyXG4gIC8vIHJldXNhYmxlIFV0dGVyYW5jZXMgYWxsb3dzIHRoaXMgaW5mb3JtYXRpb24gdG8gXCJjb2xsYXBzZVwiIGluIHRoZSBxdWV1ZSBhbmQgb25seSB0aGUgbW9zdFxyXG4gIC8vIHJlY2VudCBjaGFuZ2UgaXMgaGVhcmQgd2hlbiByYXBpZCB1cGRhdGVzIGhhcHBlbi5cclxuICBwcml2YXRlIHJlYWRvbmx5IG9ic2VydmF0aW9uV2luZG93U2NlbmVVdHRlcmFuY2UgPSBuZXcgVXR0ZXJhbmNlKCBEQVRFX0NIQU5HRV9VVFRFUkFOQ0VfT1BUSU9OUyApO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY29uY2VudHJhdGlvbkNoYW5nZVV0dGVyYW5jZSA9IG5ldyBVdHRlcmFuY2UoIERBVEVfQ0hBTkdFX1VUVEVSQU5DRV9PUFRJT05TICk7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbW9kZWw6IENvbmNlbnRyYXRpb25Nb2RlbCwgcHJvdmlkZWRPcHRpb25zPzogQWxlcnRlck9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxBbGVydGVyT3B0aW9ucywgRW1wdHlTZWxmT3B0aW9ucywgQWxlcnRlck9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFRoaXMgYWxlcnRlciBhbmQgc2ltdWxhdGlvbiBkb2VzIG5vdCBzdXBwb3J0IFZvaWNpbmcuXHJcbiAgICAgIGFsZXJ0VG9Wb2ljaW5nOiBmYWxzZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLm1vZGVsID0gbW9kZWw7XHJcbiAgICB0aGlzLnVzZVZlcmJvc2VTdXJmYWNlVGVtcGVyYXR1cmVBbGVydCA9IHRydWU7XHJcbiAgICB0aGlzLnRlbXBlcmF0dXJlQ2hhbmdlQWxlcnRDb3VudCA9IDA7XHJcbiAgICB0aGlzLnRpbWVTaW5jZUxhc3RBbGVydCA9IDA7XHJcblxyXG4gICAgdGhpcy5vdXRnb2luZ0VuZXJneVByb3BlcnR5ID0gbW9kZWwub3V0ZXJTcGFjZS5pbmNvbWluZ1Vwd2FyZE1vdmluZ0VuZXJneVJhdGVUcmFja2VyLmVuZXJneVJhdGVQcm9wZXJ0eTtcclxuICAgIHRoaXMuaW5jb21pbmdFbmVyZ3lQcm9wZXJ0eSA9IG1vZGVsLnN1bkVuZXJneVNvdXJjZS5vdXRwdXRFbmVyZ3lSYXRlVHJhY2tlci5lbmVyZ3lSYXRlUHJvcGVydHk7XHJcblxyXG4gICAgdGhpcy5uZXRFbmVyZ3lQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgdGhpcy5pbmNvbWluZ0VuZXJneVByb3BlcnR5LCB0aGlzLm91dGdvaW5nRW5lcmd5UHJvcGVydHkgXSxcclxuICAgICAgKCBpbkVuZXJneSwgb3V0RW5lcmd5ICkgPT4ge1xyXG4gICAgICAgIHJldHVybiBpbkVuZXJneSAtIG91dEVuZXJneTtcclxuICAgICAgfSApO1xyXG5cclxuICAgIHRoaXMucHJldmlvdXNQZXJpb2RpY05vdGlmaWNhdGlvbk1vZGVsU3RhdGUgPSB0aGlzLnNhdmVQZXJpb2RpY05vdGlmaWNhdGlvbk1vZGVsU3RhdGUoKTtcclxuICAgIHRoaXMucHJldmlvdXNJbW1lZGlhdGVOb3RpZmljYXRpb25Nb2RlbFN0YXRlID0gdGhpcy5zYXZlSW1tZWRpYXRlTm90aWZpY2F0aW9uTW9kZWxTdGF0ZSgpO1xyXG5cclxuICAgIC8vIFdoZW4gd2UgcmVhY2ggZXF1aWxpYnJpdW0gYXQgdGhlIGdyb3VuZCBsYXllciwgYW5ub3VuY2UgdGhhdCBzdGF0ZSBpbW1lZGlhdGVseS4gVGhpcyBkb2Vzbid0IG5lZWQgdG8gYmVcclxuICAgIC8vIG9yZGVyZWQgaW4gd2l0aCB0aGUgb3RoZXIgYWxlcnRzIHNvIGl0IGRvZXNuJ3QgbmVlZCB0byBiZSBpbiB0aGUgcG9sbGluZyBzb2x1dGlvbi4gQnV0IGl0IGNvdWxkIGJlIG1vdmVkXHJcbiAgICAvLyB0byBcImltbWVkaWF0ZVwiIHN0YXRlIG1vZGVsIGlmIHRoYXQgaXMgbW9yZSBjbGVhciBpbiB0aGUgZnV0dXJlLlxyXG4gICAgbW9kZWwuZ3JvdW5kTGF5ZXIuYXRFcXVpbGlicml1bVByb3BlcnR5LmxhenlMaW5rKCBhdEVxdWlsaWJyaXVtID0+IHtcclxuICAgICAgaWYgKCBhdEVxdWlsaWJyaXVtICkge1xyXG4gICAgICAgIHRoaXMuYWxlcnQoIFRlbXBlcmF0dXJlRGVzY3JpYmVyLmdldFN1cmZhY2VUZW1wZXJhdHVyZVN0YWJsZVN0cmluZyhcclxuICAgICAgICAgIG1vZGVsLnN1cmZhY2VUZW1wZXJhdHVyZUtlbHZpblByb3BlcnR5LnZhbHVlLFxyXG4gICAgICAgICAgbW9kZWwuc3VyZmFjZVRoZXJtb21ldGVyVmlzaWJsZVByb3BlcnR5LnZhbHVlLFxyXG4gICAgICAgICAgbW9kZWwuc3VyZmFjZVRlbXBlcmF0dXJlVmlzaWJsZVByb3BlcnR5LnZhbHVlLFxyXG4gICAgICAgICAgbW9kZWwudGVtcGVyYXR1cmVVbml0c1Byb3BlcnR5LnZhbHVlLFxyXG4gICAgICAgICAgbW9kZWwuY29uY2VudHJhdGlvbkNvbnRyb2xNb2RlUHJvcGVydHkudmFsdWUsXHJcbiAgICAgICAgICBtb2RlbC5kYXRlUHJvcGVydHkudmFsdWVcclxuICAgICAgICApICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBBbm5vdW5jZSB0aGUgdGVtcGVyYXR1cmUgd2hlbiB0aGUgdXNlciBjaGFuZ2VzIHRoZSB1bml0cy4gVGhpcyBpcyB1bnJlbGF0ZWQgdG8gdGhlIGNvbmNlbnRyYXRpb24gYW5kIHRlbXBlcmF0dXJlXHJcbiAgICAvLyBjaGFuZ2UgYWxlcnRzIHRoYXQgaGFwcGVuIGluIHRoZSBwb2xsaW5nIGltcGxlbWVudGF0aW9uIHNvIGl0IGNhbiBzdGF5IGluIGEgbGlua2VkIGxpc3RlbmVyLiBCdXQgdGhpcyBjb3VsZFxyXG4gICAgLy8gbW92ZSB0byBcImltbWVkaWF0ZVwiIHN0YXRlIG1vZGVsIHNvbWVkYXkgaWYgdGhhdCBpcyBtb3JlIGNsZWFyLlxyXG4gICAgbW9kZWwudGVtcGVyYXR1cmVVbml0c1Byb3BlcnR5LmxhenlMaW5rKCB0ZW1wZXJhdHVyZVVuaXRzID0+IHtcclxuICAgICAgdGhpcy5hbGVydCggVGVtcGVyYXR1cmVEZXNjcmliZXIuZ2V0UXVhbnRpdGF0aXZlVGVtcGVyYXR1cmVEZXNjcmlwdGlvbihcclxuICAgICAgICBtb2RlbC5zdXJmYWNlVGVtcGVyYXR1cmVLZWx2aW5Qcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgICB0ZW1wZXJhdHVyZVVuaXRzXHJcbiAgICAgICkgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBXaGVuZXZlciB0aGUgY29uY2VudHJhdGlvbiBjaGFuZ2VzLCB1c2UgdGhlIG1vc3QgdmVyYm9zZSBmb3JtIG9mIHRoZSB0ZW1wZXJhdHVyZSBjaGFuZ2UgYWxlcnQuXHJcbiAgICBtb2RlbC5jb25jZW50cmF0aW9uUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICB0aGlzLnVzZVZlcmJvc2VTdXJmYWNlVGVtcGVyYXR1cmVBbGVydCA9IHRydWU7XHJcbiAgICAgIHRoaXMudGVtcGVyYXR1cmVDaGFuZ2VBbGVydENvdW50ID0gMDtcclxuXHJcbiAgICAgIC8vIGFmdGVyIGNoYW5naW5nIGNvbmNlbnRyYXRpb24sIHdlIHNob3VsZCBxdWlja2x5IGhlYXIgY29udGVudCBpbnN0ZWFkIG9mIHdhaXRpbmcgdGhlIGZ1bGwgQUxFUlRfSU5URVJWQUxcclxuICAgICAgdGhpcy50aW1lU2luY2VMYXN0QWxlcnQgPSBBTEVSVF9JTlRFUlZBTCAtIEFMRVJUX0RFTEFZX0FGVEVSX0NIQU5HSU5HX0NPTkNFTlRSQVRJT047XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMudGltZVNpbmNlTGFzdEFsZXJ0ID49IDAsICdzZXR0aW5nIHRpbWluZyB2YXJpYWJsZSB0byBhIG5lZ2F0aXZlIHZhbHVlLCB5b3VyIGludGVydmFsIHZhbHVlcyBuZWVkIGFkanVzdGluZycgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBtb2RlbC5jb25jZW50cmF0aW9uQ29udHJvbE1vZGVQcm9wZXJ0eS5sYXp5TGluayggKCkgPT4ge1xyXG5cclxuICAgICAgLy8gQWZ0ZXIgY2hhbmdpbmcgdGhlIGNvbmNlbnRyYXRpb24gY29udHJvbCBtb2RlLCByZXNldCB0aGUgYHRpbWVTaW5jZUxhc3RBbGVydGAgc28gd2UgaGF2ZSBhIGZ1bGwgZGVsYXlcclxuICAgICAgLy8gYmVmb3JlIGRlc2NyaWJpbmcgdGhlIG5ldyBzY2VuZVxyXG4gICAgICB0aGlzLnRpbWVTaW5jZUxhc3RBbGVydCA9IDA7XHJcblxyXG4gICAgICAvLyBBZnRlciBhIGNoYW5nZSBpbiBjb25jZW50cmF0aW9uIGNvbnRyb2wgbW9kZSwgdGVtcGVyYXR1cmUgY2hhbmdlcyBhcmUgZGVzY3JpYmVkIGFzICdzdGFiaWxpemluZycsIHNlZVxyXG4gICAgICAvLyBkZWNsYXJhdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cclxuICAgICAgdGhpcy5kZXNjcmliZVRlbXBlcmF0dXJlQXNTdGFiaWxpemluZyA9IHRydWU7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQWxlcnQgd2hlbiB0aGUgc3VuIHN0YXJ0cyBzaGluaW5nLCB3aXRoIHVuaXF1ZSBoaW50IHRoYXQgd2FybnMgbm90aGluZyB3aWxsIGhhcHBlbiBpZiB0aGUgc2ltIGlzIHBhdXNlZC4gVGhpc1xyXG4gICAgLy8gYWxlcnQgaXMgdW5yZWxhdGVkIHRvIGNvbmNlbnRyYXRpb24gYW5kIHRlbXBlcmF0dXJlIGFsZXJ0cyB0aGF0IGhhcHBlbiBpbiB0aGUgcG9sbGluZyBzbyBpdCBjYW4gc3RheSBpbiBhXHJcbiAgICAvLyBsaW5rZWQgbGlzdGVuZXIuIEJ1dCBpdCBjb3VsZCBtb3ZlIHRvIHRoZSBwb2xsaW5nIGltcGxlbWVudGF0aW9uIGluIFwiaW1tZWRpYXRlIHN0YXRlIG1vZGVsXCIgaWYgdGhhdCBpcyBtb3JlXHJcbiAgICAvLyBjbGVhci5cclxuICAgIG1vZGVsLnN1bkVuZXJneVNvdXJjZS5pc1NoaW5pbmdQcm9wZXJ0eS5sYXp5TGluayggKCkgPT4ge1xyXG4gICAgICB0aGlzLmFsZXJ0KCBSYWRpYXRpb25EZXNjcmliZXIuZ2V0U3VubGlnaHRTdGFydGVkRGVzY3JpcHRpb24oIG1vZGVsLmlzUGxheWluZ1Byb3BlcnR5LnZhbHVlICkgKTtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNhdmUgdGhlIG1vZGVsIHN0YXRlIHRoYXQgaXMgdXNlZCBmb3IgZGVzY3JpcHRpb25zIHRoYXQgb2NjdXIgcGVyaW9kaWNhbGx5IGF0IGV2ZXJ5IEFMRVJUX0lOVEVSVkFMLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgc2F2ZVBlcmlvZGljTm90aWZpY2F0aW9uTW9kZWxTdGF0ZSgpOiBQcmV2aW91c1BlcmlvZGljTm90aWZpY2F0aW9uTW9kZWxTdGF0ZSB7XHJcbiAgICB0aGlzLnByZXZpb3VzUGVyaW9kaWNOb3RpZmljYXRpb25Nb2RlbFN0YXRlID0gdGhpcy5wcmV2aW91c1BlcmlvZGljTm90aWZpY2F0aW9uTW9kZWxTdGF0ZSB8fCB7XHJcbiAgICAgIHRlbXBlcmF0dXJlOiAwLFxyXG4gICAgICBjb25jZW50cmF0aW9uOiAwLFxyXG4gICAgICBvdXRnb2luZ0VuZXJneTogMCxcclxuICAgICAgbmV0SW5mbG93T2ZFbmVyZ3k6IDAsXHJcbiAgICAgIGNvbmNlbnRyYXRpb25Db250cm9sTW9kZTogdGhpcy5tb2RlbC5jb25jZW50cmF0aW9uQ29udHJvbE1vZGVQcm9wZXJ0eS52YWx1ZVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnByZXZpb3VzUGVyaW9kaWNOb3RpZmljYXRpb25Nb2RlbFN0YXRlLnRlbXBlcmF0dXJlID0gdGhpcy5nZXRDdXJyZW50VGVtcGVyYXR1cmUoKTtcclxuICAgIHRoaXMucHJldmlvdXNQZXJpb2RpY05vdGlmaWNhdGlvbk1vZGVsU3RhdGUuY29uY2VudHJhdGlvbiA9IHRoaXMubW9kZWwuY29uY2VudHJhdGlvblByb3BlcnR5LnZhbHVlO1xyXG4gICAgdGhpcy5wcmV2aW91c1BlcmlvZGljTm90aWZpY2F0aW9uTW9kZWxTdGF0ZS5vdXRnb2luZ0VuZXJneSA9IHRoaXMub3V0Z29pbmdFbmVyZ3lQcm9wZXJ0eS52YWx1ZTtcclxuICAgIHRoaXMucHJldmlvdXNQZXJpb2RpY05vdGlmaWNhdGlvbk1vZGVsU3RhdGUubmV0SW5mbG93T2ZFbmVyZ3kgPSB0aGlzLm1vZGVsLm5ldEluZmxvd09mRW5lcmd5UHJvcGVydHkudmFsdWU7XHJcbiAgICB0aGlzLnByZXZpb3VzUGVyaW9kaWNOb3RpZmljYXRpb25Nb2RlbFN0YXRlLmNvbmNlbnRyYXRpb25Db250cm9sTW9kZSA9IHRoaXMubW9kZWwuY29uY2VudHJhdGlvbkNvbnRyb2xNb2RlUHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMucHJldmlvdXNQZXJpb2RpY05vdGlmaWNhdGlvbk1vZGVsU3RhdGU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNhdmVJbW1lZGlhdGVOb3RpZmljYXRpb25Nb2RlbFN0YXRlKCk6IFByZXZpb3VzSW1tZWRpYXRlTm90aWZpY2F0aW9uTW9kZWxTdGF0ZSB7XHJcbiAgICB0aGlzLnByZXZpb3VzSW1tZWRpYXRlTm90aWZpY2F0aW9uTW9kZWxTdGF0ZSA9IHRoaXMucHJldmlvdXNJbW1lZGlhdGVOb3RpZmljYXRpb25Nb2RlbFN0YXRlIHx8IHtcclxuICAgICAgY2xvdWRFbmFibGVkOiB0aGlzLm1vZGVsLmNsb3VkRW5hYmxlZFByb3BlcnR5LnZhbHVlLFxyXG4gICAgICBjb25jZW50cmF0aW9uQ29udHJvbE1vZGU6IHRoaXMubW9kZWwuY29uY2VudHJhdGlvbkNvbnRyb2xNb2RlUHJvcGVydHkudmFsdWUsXHJcbiAgICAgIGNvbmNlbnRyYXRpb25EYXRlOiB0aGlzLm1vZGVsLmRhdGVQcm9wZXJ0eS52YWx1ZVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnByZXZpb3VzSW1tZWRpYXRlTm90aWZpY2F0aW9uTW9kZWxTdGF0ZS5jbG91ZEVuYWJsZWQgPSB0aGlzLm1vZGVsLmNsb3VkRW5hYmxlZFByb3BlcnR5LnZhbHVlO1xyXG4gICAgdGhpcy5wcmV2aW91c0ltbWVkaWF0ZU5vdGlmaWNhdGlvbk1vZGVsU3RhdGUuY29uY2VudHJhdGlvbkNvbnRyb2xNb2RlID0gdGhpcy5tb2RlbC5jb25jZW50cmF0aW9uQ29udHJvbE1vZGVQcm9wZXJ0eS52YWx1ZTtcclxuICAgIHRoaXMucHJldmlvdXNJbW1lZGlhdGVOb3RpZmljYXRpb25Nb2RlbFN0YXRlLmNvbmNlbnRyYXRpb25EYXRlID0gdGhpcy5tb2RlbC5kYXRlUHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMucHJldmlvdXNJbW1lZGlhdGVOb3RpZmljYXRpb25Nb2RlbFN0YXRlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRG8gc29tZSByb3VuZGluZyBvbiB0aGUgY3VycmVudCB0ZW1wZXJhdHVyZSBzbyB0aGF0IHdlIGRvbid0IGFsZXJ0IHdoZW4gdGhlIGNoYW5nZXMgYXJlIHRvbyBzbWFsbC5cclxuICAgKi9cclxuICBwcml2YXRlIGdldEN1cnJlbnRUZW1wZXJhdHVyZSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIFV0aWxzLnRvRml4ZWROdW1iZXIoXHJcbiAgICAgIHRoaXMubW9kZWwuc3VyZmFjZVRlbXBlcmF0dXJlS2VsdmluUHJvcGVydHkudmFsdWUsXHJcbiAgICAgIFRFTVBFUkFUVVJFX0RFQ0lNQUxfUExBQ0VTXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIG5ldyBhbGVydHMgaWYgdGhlIHN0YXRlIG9mIHRoZSBzaW11bGF0aW9uIGhhcyBjaGFuZ2VkIGFuZCB0aW1pbmcgdmFyaWFibGVzIGluZGljYXRlIGl0IGlzIHRpbWUuIFRoaXMgc3RlcFxyXG4gICAqIGZ1bmN0aW9uIHNob3VsZCBiZSBjYWxsZWQgZXZlcnkgdmlldyBzdGVwLCByZWdhcmRsZXNzIG9mIHdoZXRoZXIgdGhlIG1vZGVsIGlzIHBsYXlpbmcgYmVjYXVzZSBjZXJ0YWluIGFsZXJ0c1xyXG4gICAqIGRlc2NyaWJlIHVwZGF0ZXMgdGhhdCBhcmUgdW5yZWxhdGVkIHRvIHRoZSBjaGFuZ2luZyBjb25jZW50cmF0aW9uIG1vZGVsIChzZWVcclxuICAgKiBcInByZXZpb3VzSW1tZWRpYXRlTm90aWZpY2F0aW9uTW9kZWxTdGF0ZVwiKS5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBkdCAtIGluIHNlY29uZHNcclxuICAgKi9cclxuICBwdWJsaWMgc3RlcCggZHQ6IG51bWJlciApOiB2b2lkIHtcclxuXHJcbiAgICAvLyBTdGFydCBieSBhbGVydGluZyBcImltbWVkaWF0ZVwiIG1vZGVsIGNoYW5nZXMuIFRoZXNlIGFyZSB1cGRhdGVzIHRoYXQgbmVlZCB0byBiZSBkZXNjcmliZWQgYXMgc29vbiBhcyB0aGV5IGNoYW5nZS5cclxuICAgIGNvbnN0IGN1cnJlbnRDb250cm9sTW9kZSA9IHRoaXMubW9kZWwuY29uY2VudHJhdGlvbkNvbnRyb2xNb2RlUHJvcGVydHkudmFsdWU7XHJcbiAgICBpZiAoIHRoaXMucHJldmlvdXNJbW1lZGlhdGVOb3RpZmljYXRpb25Nb2RlbFN0YXRlLmNvbmNlbnRyYXRpb25Db250cm9sTW9kZSAhPT0gY3VycmVudENvbnRyb2xNb2RlICkge1xyXG4gICAgICBpZiAoIGN1cnJlbnRDb250cm9sTW9kZSA9PT0gQ29uY2VudHJhdGlvbkNvbnRyb2xNb2RlLkJZX0RBVEUgKSB7XHJcblxyXG4gICAgICAgIC8vIElmIGNvbnRyb2xsaW5nIGJ5IGRhdGUsIGluY2x1ZGUgYSBkZXNjcmlwdGlvbiBvZiB0aGUgc2VsZWN0ZWQgZGF0ZS5cclxuICAgICAgICB0aGlzLmFsZXJ0KCBDb25jZW50cmF0aW9uRGVzY3JpYmVyLmdldFRpbWVQZXJpb2RDaGFuZ2VEZXNjcmlwdGlvbiggdGhpcy5tb2RlbC5kYXRlUHJvcGVydHkudmFsdWUgKSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAvLyBJbiBtYW51YWwgbW9kZSwgZGVzY3JpYmUgdGhlIHJlbGF0aXZlIGxldmVsIG9mIGNvbmNlbnRyYXRpb24uXHJcbiAgICAgICAgdGhpcy5hbGVydCggQ29uY2VudHJhdGlvbkRlc2NyaWJlci5nZXRDdXJyZW50Q29uY2VudHJhdGlvbkxldmVsc0Rlc2NyaXB0aW9uKCB0aGlzLm1vZGVsLmNvbmNlbnRyYXRpb25Qcm9wZXJ0eS52YWx1ZSApICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjdXJyZW50RGF0ZSA9IHRoaXMubW9kZWwuZGF0ZVByb3BlcnR5LnZhbHVlO1xyXG4gICAgY29uc3QgcHJldmlvdXNEYXRlID0gdGhpcy5wcmV2aW91c0ltbWVkaWF0ZU5vdGlmaWNhdGlvbk1vZGVsU3RhdGUuY29uY2VudHJhdGlvbkRhdGU7XHJcbiAgICBpZiAoIHByZXZpb3VzRGF0ZSAhPT0gY3VycmVudERhdGUgKSB7XHJcbiAgICAgIHRoaXMub2JzZXJ2YXRpb25XaW5kb3dTY2VuZVV0dGVyYW5jZS5hbGVydCA9IENvbmNlbnRyYXRpb25EZXNjcmliZXIuZ2V0T2JzZXJ2YXRpb25XaW5kb3dOb3dUaW1lUGVyaW9kRGVzY3JpcHRpb24oIGN1cnJlbnREYXRlICk7XHJcbiAgICAgIHRoaXMuY29uY2VudHJhdGlvbkNoYW5nZVV0dGVyYW5jZS5hbGVydCA9IENvbmNlbnRyYXRpb25EZXNjcmliZXIuZ2V0UXVhbGl0YXRpdmVDb25jZW50cmF0aW9uQ2hhbmdlRGVzY3JpcHRpb24oXHJcbiAgICAgICAgQ29uY2VudHJhdGlvbk1vZGVsLmdldENvbmNlbnRyYXRpb25Gb3JEYXRlKCBwcmV2aW91c0RhdGUgKSxcclxuICAgICAgICBwcmV2aW91c0RhdGUsIENvbmNlbnRyYXRpb25Nb2RlbC5nZXRDb25jZW50cmF0aW9uRm9yRGF0ZSggY3VycmVudERhdGUgKVxyXG4gICAgICApO1xyXG4gICAgICB0aGlzLmFsZXJ0KCB0aGlzLm9ic2VydmF0aW9uV2luZG93U2NlbmVVdHRlcmFuY2UgKTtcclxuICAgICAgdGhpcy5hbGVydCggdGhpcy5jb25jZW50cmF0aW9uQ2hhbmdlVXR0ZXJhbmNlICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2xvdWRFbmFibGVkID0gdGhpcy5tb2RlbC5jbG91ZEVuYWJsZWRQcm9wZXJ0eS52YWx1ZTtcclxuICAgIGlmICggdGhpcy5wcmV2aW91c0ltbWVkaWF0ZU5vdGlmaWNhdGlvbk1vZGVsU3RhdGUuY2xvdWRFbmFibGVkICE9PSBjbG91ZEVuYWJsZWQgKSB7XHJcbiAgICAgIHRoaXMuYWxlcnQoIENvbmNlbnRyYXRpb25EZXNjcmliZXIuZ2V0U2t5Q2xvdWRDaGFuZ2VEZXNjcmlwdGlvbihcclxuICAgICAgICBjbG91ZEVuYWJsZWQsXHJcbiAgICAgICAgdGhpcy5tb2RlbC5zdW5FbmVyZ3lTb3VyY2UuaXNTaGluaW5nUHJvcGVydHkudmFsdWVcclxuICAgICAgKSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIE5vdyBhbGVydCBcInBlcmlvZGljXCIgY2hhbmdlcy4gVGhlc2UgYXJlIHVwZGF0ZSB0aGF0IGFyZSBvbmx5IGRlc2NyaWJlZCBldmVyeSBBTEVSVF9JTlRFUlZBTC5cclxuICAgIC8vIFwicGVyaW9kaWNcIiBhbGVydHMgd2lsbCBvbmx5IHByb2dyZXNzIGlmIHRoZSBtb2RlbCBpcyBjdXJyZW50bHkgc3RlcHBpbmcgYXMgd2VsbFxyXG4gICAgaWYgKCB0aGlzLm1vZGVsLmlzUGxheWluZ1Byb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICB0aGlzLnRpbWVTaW5jZUxhc3RBbGVydCArPSBkdDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIHRoaXMudGltZVNpbmNlTGFzdEFsZXJ0ID4gQUxFUlRfSU5URVJWQUwgKSB7XHJcbiAgICAgIGNvbnN0IHByZXZpb3VzQ29udHJvbE1vZGVGcm9tUGVyaW9kU3RhdGUgPSB0aGlzLnByZXZpb3VzUGVyaW9kaWNOb3RpZmljYXRpb25Nb2RlbFN0YXRlLmNvbmNlbnRyYXRpb25Db250cm9sTW9kZTtcclxuICAgICAgY29uc3QgY3VycmVudFRlbXBlcmF0dXJlID0gdGhpcy5nZXRDdXJyZW50VGVtcGVyYXR1cmUoKTtcclxuICAgICAgY29uc3QgY3VycmVudENvbmNlbnRyYXRpb24gPSB0aGlzLm1vZGVsLmNvbmNlbnRyYXRpb25Qcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICAgIGlmICggIXRoaXMubW9kZWwuZ3JvdW5kTGF5ZXIuYXRFcXVpbGlicml1bVByb3BlcnR5LnZhbHVlICkge1xyXG5cclxuICAgICAgICAvLyBJbmZyYXJlZCByYWRpYXRpb24gZGVzY3JpcHRpb25zIGFyZSBvbmx5IHByZXNlbnQgaWYgY29uY2VudHJhdGlvbiBjaGFuZ2VkIHdoaWxlIHRoZSBjb25jZW50cmF0aW9uIGNvbnRyb2xcclxuICAgICAgICAvLyBtb2RlIHN0YXllZCB0aGUgc2FtZVxyXG4gICAgICAgIGlmICggcHJldmlvdXNDb250cm9sTW9kZUZyb21QZXJpb2RTdGF0ZSA9PT0gY3VycmVudENvbnRyb2xNb2RlICkge1xyXG5cclxuICAgICAgICAgIC8vIEZpcnN0LCBhIGRlc2NyaXB0aW9uIG9mIHRoZSBjaGFuZ2luZyByYWRpYXRpb24gcmVkaXJlY3RpbmcgYmFjayB0byB0aGUgc3VyZmFjZSAtIHRoaXMgc2hvdWxkIG9ubHkgaGFwcGVuIGlmXHJcbiAgICAgICAgICAvLyB0aGVyZSB3YXMgc29tZSBjaGFuZ2UgdG8gdGhlIGNvbmNlbnRyYXRpb24uXHJcbiAgICAgICAgICBpZiAoIHRoaXMubW9kZWwuaXNJbmZyYXJlZFByZXNlbnQoKSAmJiBjdXJyZW50Q29uY2VudHJhdGlvbiAhPT0gdGhpcy5wcmV2aW91c1BlcmlvZGljTm90aWZpY2F0aW9uTW9kZWxTdGF0ZS5jb25jZW50cmF0aW9uICkge1xyXG4gICAgICAgICAgICBjb25zdCByYWRpYXRpb25SZWRpcmVjdGluZ0FsZXJ0ID0gUmFkaWF0aW9uRGVzY3JpYmVyLmdldFJhZGlhdGlvblJlZGlyZWN0aW9uRGVzY3JpcHRpb24oIGN1cnJlbnRDb25jZW50cmF0aW9uLCB0aGlzLnByZXZpb3VzUGVyaW9kaWNOb3RpZmljYXRpb25Nb2RlbFN0YXRlLmNvbmNlbnRyYXRpb24gKTtcclxuICAgICAgICAgICAgcmFkaWF0aW9uUmVkaXJlY3RpbmdBbGVydCAmJiB0aGlzLmFsZXJ0KCByYWRpYXRpb25SZWRpcmVjdGluZ0FsZXJ0ICk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgLy8gVGhlbiwgZGVzY3JpcHRpb24gb2YgdGhlIGNoYW5naW5nIHN1cmZhY2UgdGVtcGVyYXR1cmUgLSBhZ2Fpbiwgb25seSBpZiB0aGVyZSBpcyBzb21lIGNoYW5nZSBpbiB0aGVcclxuICAgICAgICAgIC8vIGNvbmNlbnRyYXRpb24uXHJcbiAgICAgICAgICBpZiAoIHRoaXMubW9kZWwuaXNJbmZyYXJlZFByZXNlbnQoKSAmJiBjdXJyZW50Q29uY2VudHJhdGlvbiAhPT0gdGhpcy5wcmV2aW91c1BlcmlvZGljTm90aWZpY2F0aW9uTW9kZWxTdGF0ZS5jb25jZW50cmF0aW9uICkge1xyXG4gICAgICAgICAgICBjb25zdCBzdXJmYWNlUmFkaWF0aW9uQWxlcnRTdHJpbmcgPSBSYWRpYXRpb25EZXNjcmliZXIuZ2V0UmFkaWF0aW9uRnJvbVN1cmZhY2VDaGFuZ2VEZXNjcmlwdGlvbihcclxuICAgICAgICAgICAgICB0aGlzLm1vZGVsLmNvbmNlbnRyYXRpb25Qcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgICAgICAgICB0aGlzLnByZXZpb3VzUGVyaW9kaWNOb3RpZmljYXRpb25Nb2RlbFN0YXRlLmNvbmNlbnRyYXRpb25cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgc3VyZmFjZVJhZGlhdGlvbkFsZXJ0U3RyaW5nICYmIHRoaXMuYWxlcnQoIHN1cmZhY2VSYWRpYXRpb25BbGVydFN0cmluZyApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVGhlbiwgYSBkZXNjcmlwdGlvbiBvZiB0aGUgY2hhbmdpbmcgdGVtcGVyYXR1cmUgLSB0aGlzIHNob3VsZCBnZXQgZGVzY3JpYmVkIGF0IGludGVydmFsIGV2ZW4gaWYgdGhlcmVcclxuICAgICAgICAvLyBpcyBubyBjaGFuZ2UgaW4gY29uY2VudHJhdGlvbi4gVGhlcmUgaXMgYSBkZWxheSBhZnRlciBjb25jZW50cmF0aW9uIGNoYW5nZXMgdG8gYXZvaWQgc3BhbW1pbmcgdGhlIHVzZXIgd2l0aFxyXG4gICAgICAgIC8vIHRvbyBtdWNoIGluZm9ybWF0aW9uIGFmdGVyIGNvbmNlbnRyYXRpb24gY2hhbmdlcy4gRGVwZW5kaW5nIG9uIGhvdyBtYW55IHRpbWVzIGl0IGhhcyBiZWVuIHNwb2tlbiBhIHRlcnNlXHJcbiAgICAgICAgLy8gZm9ybSBvZiBpdCBtYXkgYmUgdXNlZCAoaGFuZGxlZCBpbiBnZXRTdXJmYWNlVGVtcGVyYXR1cmVDaGFuZ2VTdHJpbmcpLlxyXG5cclxuICAgICAgICAvLyBUbyByZWR1Y2UgdmVyYm9zaXR5IHRoZSB0ZW1wZXJhdHVyZSB2YWx1ZSBpcyBpbmNsdWRlZCBvbmx5IGV2ZXJ5IE5VTUJFUl9PRl9URVJTRV9URU1QRVJBVFVSRV9BTEVSVFMgdGhhdFxyXG4gICAgICAgIC8vIHRoaXMgcmVzcG9uc2UgaXMgY3JlYXRlZC4gVGVtcGVyYXR1cmUgbXVzdCBhbHNvIGJlIHZpc2libGUgaW4gdGhlIHZpZXcuXHJcbiAgICAgICAgY29uc3QgaW5jbHVkZVRlbXBlcmF0dXJlVmFsdWUgPSB0aGlzLm1vZGVsLnN1cmZhY2VUaGVybW9tZXRlclZpc2libGVQcm9wZXJ0eS52YWx1ZSAmJiB0aGlzLnRlbXBlcmF0dXJlQ2hhbmdlQWxlcnRDb3VudCA9PT0gMDtcclxuXHJcbiAgICAgICAgY29uc3QgdGVtcGVyYXR1cmVBbGVydFN0cmluZyA9IFRlbXBlcmF0dXJlRGVzY3JpYmVyLmdldFN1cmZhY2VUZW1wZXJhdHVyZUNoYW5nZVN0cmluZyhcclxuICAgICAgICAgIHRoaXMucHJldmlvdXNQZXJpb2RpY05vdGlmaWNhdGlvbk1vZGVsU3RhdGUudGVtcGVyYXR1cmUsXHJcbiAgICAgICAgICBjdXJyZW50VGVtcGVyYXR1cmUsXHJcbiAgICAgICAgICBpbmNsdWRlVGVtcGVyYXR1cmVWYWx1ZSxcclxuICAgICAgICAgIHRoaXMubW9kZWwudGVtcGVyYXR1cmVVbml0c1Byb3BlcnR5LnZhbHVlLFxyXG4gICAgICAgICAgdGhpcy51c2VWZXJib3NlU3VyZmFjZVRlbXBlcmF0dXJlQWxlcnQsXHJcblxyXG4gICAgICAgICAgLy8gd2hlbiB0aGUgY29udHJvbCBtb2RlIGNoYW5nZXMsIGl0IHdhcyByZXF1ZXN0ZWQgdGhhdCB0aGUgdGVtcGVyYXR1cmUgYmUgZGVzY3JpYmVkIGFzICdzdGFiaWxpemluZydcclxuICAgICAgICAgIC8vIGluc3RlYWQgb2YgJ3dhcm1pbmcnIG9yICdjb29saW5nJyxcclxuICAgICAgICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZ3JlZW5ob3VzZS1lZmZlY3QvaXNzdWVzLzE5OSNpc3N1ZWNvbW1lbnQtMTIxMTIyMDc5MFxyXG4gICAgICAgICAgdGhpcy5kZXNjcmliZVRlbXBlcmF0dXJlQXNTdGFiaWxpemluZ1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGVtcGVyYXR1cmVBbGVydFN0cmluZyAmJiB0aGlzLmFsZXJ0KCB0ZW1wZXJhdHVyZUFsZXJ0U3RyaW5nICk7XHJcblxyXG4gICAgICAgIC8vIHJlc2V0IGNvdW50ZXIgaWYgd2UgaGF2ZSBzcG9rZW4gdGhlIHRlcnNlIGZvcm0gb2YgdGhlIHRlbXBlcmF0dXJlIGNoYW5nZSBhbGVydCBlbm91Z2ggdGltZXNcclxuICAgICAgICB0aGlzLnRlbXBlcmF0dXJlQ2hhbmdlQWxlcnRDb3VudCA9IHRoaXMudGVtcGVyYXR1cmVDaGFuZ2VBbGVydENvdW50ID49IE5VTUJFUl9PRl9URVJTRV9URU1QRVJBVFVSRV9BTEVSVFMgPyAwIDogdGhpcy50ZW1wZXJhdHVyZUNoYW5nZUFsZXJ0Q291bnQgKyAxO1xyXG5cclxuICAgICAgICAvLyBub3QgdmVyYm9zZSB1bnRpbCBjb25jZW50cmF0aW9uIGNoYW5nZXMgYWdhaW5cclxuICAgICAgICB0aGlzLnVzZVZlcmJvc2VTdXJmYWNlVGVtcGVyYXR1cmVBbGVydCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAvLyBBY2N1cmF0ZWx5IGRlc2NyaWJlIHRlbXBlcmF0dXJlIGFsZXJ0cyBuZXh0IGl0ZXJhdGlvbi5cclxuICAgICAgICB0aGlzLmRlc2NyaWJlVGVtcGVyYXR1cmVBc1N0YWJpbGl6aW5nID0gZmFsc2U7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICggcHJldmlvdXNDb250cm9sTW9kZUZyb21QZXJpb2RTdGF0ZSA9PT0gY3VycmVudENvbnRyb2xNb2RlICkge1xyXG4gICAgICAgIGlmICggdGhpcy5tb2RlbC5lbmVyZ3lCYWxhbmNlVmlzaWJsZVByb3BlcnR5LnZhbHVlICkge1xyXG5cclxuICAgICAgICAgIC8vIERpZCB0aGUgZW5lcmd5IGJhbGFuY2UgY2hhbmdlIGluIHN1Y2ggYSB3YXkgdGhhdCB3ZSBuZWVkIHRvIGRlc2NyaWJlIGl0P1xyXG4gICAgICAgICAgY29uc3QgY3VycmVudE5ldEluZmxvd09mRW5lcmd5ID0gdGhpcy5tb2RlbC5uZXRJbmZsb3dPZkVuZXJneVByb3BlcnR5LnZhbHVlO1xyXG4gICAgICAgICAgY29uc3QgcHJldmlvdXNOZXRJbmZsb3dPZkVuZXJneSA9IHRoaXMucHJldmlvdXNQZXJpb2RpY05vdGlmaWNhdGlvbk1vZGVsU3RhdGUubmV0SW5mbG93T2ZFbmVyZ3k7XHJcbiAgICAgICAgICBpZiAoICggcHJldmlvdXNOZXRJbmZsb3dPZkVuZXJneSA8IC1MYXllcnNNb2RlbC5SQURJQVRJVkVfQkFMQU5DRV9USFJFU0hPTEQgJiZcclxuICAgICAgICAgICAgICAgICBjdXJyZW50TmV0SW5mbG93T2ZFbmVyZ3kgPiAtTGF5ZXJzTW9kZWwuUkFESUFUSVZFX0JBTEFOQ0VfVEhSRVNIT0xEICkgfHxcclxuICAgICAgICAgICAgICAgKCBwcmV2aW91c05ldEluZmxvd09mRW5lcmd5ID4gTGF5ZXJzTW9kZWwuUkFESUFUSVZFX0JBTEFOQ0VfVEhSRVNIT0xEICYmXHJcbiAgICAgICAgICAgICAgICAgY3VycmVudE5ldEluZmxvd09mRW5lcmd5IDwgTGF5ZXJzTW9kZWwuUkFESUFUSVZFX0JBTEFOQ0VfVEhSRVNIT0xEICkgfHxcclxuICAgICAgICAgICAgICAgKCBNYXRoLmFicyggcHJldmlvdXNOZXRJbmZsb3dPZkVuZXJneSApIDwgTGF5ZXJzTW9kZWwuUkFESUFUSVZFX0JBTEFOQ0VfVEhSRVNIT0xEICYmXHJcbiAgICAgICAgICAgICAgICAgTWF0aC5hYnMoIGN1cnJlbnROZXRJbmZsb3dPZkVuZXJneSApID4gTGF5ZXJzTW9kZWwuUkFESUFUSVZFX0JBTEFOQ0VfVEhSRVNIT0xEICkgKSB7XHJcblxyXG4gICAgICAgICAgICAvLyBZZXAuXHJcbiAgICAgICAgICAgIGNvbnN0IG91dGdvaW5nRW5lcmd5QWxlcnRTdHJpbmcgPSBFbmVyZ3lEZXNjcmliZXIuZ2V0TmV0RW5lcmd5QXRBdG1vc3BoZXJlRGVzY3JpcHRpb24oXHJcbiAgICAgICAgICAgICAgY3VycmVudE5ldEluZmxvd09mRW5lcmd5LFxyXG4gICAgICAgICAgICAgIHRoaXMubW9kZWwuaW5SYWRpYXRpdmVCYWxhbmNlUHJvcGVydHkudmFsdWVcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgb3V0Z29pbmdFbmVyZ3lBbGVydFN0cmluZyAmJiB0aGlzLmFsZXJ0KCBvdXRnb2luZ0VuZXJneUFsZXJ0U3RyaW5nICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLnNhdmVQZXJpb2RpY05vdGlmaWNhdGlvbk1vZGVsU3RhdGUoKTtcclxuICAgICAgdGhpcy50aW1lU2luY2VMYXN0QWxlcnQgPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2F2ZUltbWVkaWF0ZU5vdGlmaWNhdGlvbk1vZGVsU3RhdGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc2V0IHRoaXMgdG8gaXRzIGluaXRpYWwgc3RhdGUuICBGb3IgdGhpcyB0byB3b3JrIHByb3Blcmx5LCB0aGUgbW9kZWwgbXVzdCBiZSByZXNldCBwcmlvciB0byBjYWxsaW5nIHRoaXMgbWV0aG9kLlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMudGVtcGVyYXR1cmVDaGFuZ2VBbGVydENvdW50ID0gMDtcclxuICAgIHRoaXMudGltZVNpbmNlTGFzdEFsZXJ0ID0gMDtcclxuICAgIHRoaXMuZGVzY3JpYmVUZW1wZXJhdHVyZUFzU3RhYmlsaXppbmcgPSBmYWxzZTtcclxuICAgIHRoaXMuc2F2ZVBlcmlvZGljTm90aWZpY2F0aW9uTW9kZWxTdGF0ZSgpO1xyXG4gICAgdGhpcy5zYXZlSW1tZWRpYXRlTm90aWZpY2F0aW9uTW9kZWxTdGF0ZSgpO1xyXG4gIH1cclxufVxyXG5cclxuZ3JlZW5ob3VzZUVmZmVjdC5yZWdpc3RlciggJ0dhc0NvbmNlbnRyYXRpb25BbGVydGVyJywgR2FzQ29uY2VudHJhdGlvbkFsZXJ0ZXIgKTtcclxuZXhwb3J0IGRlZmF1bHQgR2FzQ29uY2VudHJhdGlvbkFsZXJ0ZXI7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFHcEUsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxTQUFTLE1BQTRCLHVDQUF1QztBQUNuRixPQUFPQyxPQUFPLE1BQTBCLGlFQUFpRTtBQUN6RyxPQUFPQyxTQUFTLE1BQU0sNkNBQTZDO0FBQ25FLE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxPQUFPQyxrQkFBa0IsSUFBSUMsd0JBQXdCLFFBQTJCLGdDQUFnQztBQUNoSCxPQUFPQyxXQUFXLE1BQU0seUJBQXlCO0FBQ2pELE9BQU9DLHNCQUFzQixNQUFNLHdDQUF3QztBQUMzRSxPQUFPQyxlQUFlLE1BQU0saUNBQWlDO0FBQzdELE9BQU9DLGtCQUFrQixNQUFNLG9DQUFvQztBQUNuRSxPQUFPQyxvQkFBb0IsTUFBTSxzQ0FBc0M7O0FBRXZFO0FBQ0EsTUFBTUMsMEJBQTBCLEdBQUcsQ0FBQzs7QUFFcEM7QUFDQSxNQUFNQyxjQUFjLEdBQUcs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