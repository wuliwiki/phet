// Copyright 2021-2023, University of Colorado Boulder

/**
 * ThermometerAndReadout is a Scenery Node that depicts a thermometer and a numerical readout that indicates the
 * temperature.  Based on configuration options, the readout can either be a combo box from which the user can select
 * different units (e.g. Fahrenheit or Celsius), or a simple readout that just shows the temperature.  Options can be
 * used to adjust the size and appearance.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 * @author John Blanco (PhET Interactive Simulations)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import PatternStringProperty from '../../../../axon/js/PatternStringProperty.js';
import Range from '../../../../dot/js/Range.js';
import Enumeration from '../../../../phet-core/js/Enumeration.js';
import EnumerationValue from '../../../../phet-core/js/EnumerationValue.js';
import optionize from '../../../../phet-core/js/optionize.js';
import NumberDisplay from '../../../../scenery-phet/js/NumberDisplay.js';
import ThermometerNode from '../../../../scenery-phet/js/ThermometerNode.js';
import { Color, Node } from '../../../../scenery/js/imports.js';
import ComboBox from '../../../../sun/js/ComboBox.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import greenhouseEffect from '../../greenhouseEffect.js';
import GreenhouseEffectStrings from '../../GreenhouseEffectStrings.js';
import GreenhouseEffectConstants from '../GreenhouseEffectConstants.js';
import GreenhouseEffectQueryParameters from '../GreenhouseEffectQueryParameters.js';
import GreenhouseEffectUtils from '../GreenhouseEffectUtils.js';
import GroundLayer from '../model/GroundLayer.js';
import TemperatureUnits from '../model/TemperatureUnits.js';
import TemperatureDescriber from './describers/TemperatureDescriber.js';
import GreenhouseEffectObservationWindow from './GreenhouseEffectObservationWindow.js';

// constants
const THERMOMETER_TO_READOUT_DISTANCE = 15; // in screen coordinates
const DECIMAL_PLACES_IN_READOUT = GreenhouseEffectQueryParameters.showAdditionalTemperatureDigits ? 3 : 1;
const kelvinUnitsStringProperty = GreenhouseEffectStrings.temperature.units.kelvinStringProperty;
const celsiusUnitsStringProperty = GreenhouseEffectStrings.temperature.units.celsiusStringProperty;
const fahrenheitUnitsStringProperty = GreenhouseEffectStrings.temperature.units.fahrenheitStringProperty;
class ReadoutType extends EnumerationValue {
  static SELECTABLE = new ReadoutType();
  static FIXED = new ReadoutType();
  static enumeration = new Enumeration(ReadoutType);
}
class ThermometerAndReadout extends Node {
  /**
   * @param model
   * @param [providedOptions]
   */
  constructor(model, providedOptions) {
    const options = optionize()({
      minTemperature: GroundLayer.MINIMUM_EARTH_AT_NIGHT_TEMPERATURE,
      maxTemperature: GreenhouseEffectObservationWindow.EXPECTED_MAX_TEMPERATURE + 3,
      // readout type that will be shown below the thermometer, either SELECTABLE (i.e. a combo box) or fixed
      readoutType: ReadoutType.SELECTABLE,
      // parent node used for the combo box list, only used for SELECTABLE readout
      listParentNode: null,
      // options passed along to the ThermometerNode
      thermometerNodeOptions: {
        bulbDiameter: 40,
        tubeHeight: 150,
        tubeWidth: 20,
        backgroundFill: 'white'
      },
      // phet-io
      tandem: Tandem.REQUIRED
    }, providedOptions);

    // options passed to the supertype later in mutate
    super();

    // visibility
    model.surfaceThermometerVisibleProperty.linkAttribute(this, 'visible');

    // thermometer - range chosen empirically to make it look reasonable in the sim
    const thermometerNode = new ThermometerNode(model.surfaceTemperatureKelvinProperty, options.minTemperature, options.maxTemperature, options.thermometerNodeOptions);
    this.addChild(thermometerNode);

    // ranges for each temperature Property, so the NumberDisplay can determine space needed for each readout
    const kelvinRange = model.surfaceTemperatureKelvinProperty.range;
    const celsiusRange = new Range(GreenhouseEffectUtils.kelvinToCelsius(kelvinRange.min), GreenhouseEffectUtils.kelvinToCelsius(kelvinRange.max));
    const fahrenheitRange = new Range(GreenhouseEffectUtils.kelvinToFahrenheit(kelvinRange.min), GreenhouseEffectUtils.kelvinToFahrenheit(kelvinRange.max));
    if (options.readoutType === ReadoutType.SELECTABLE) {
      const comboBoxItems = [ThermometerAndReadout.createComboBoxItem(kelvinUnitsStringProperty, model.surfaceTemperatureKelvinProperty, model.surfaceTemperatureKelvinProperty.range, TemperatureUnits.KELVIN, `kelvin${ComboBox.ITEM_TANDEM_NAME_SUFFIX}`), ThermometerAndReadout.createComboBoxItem(celsiusUnitsStringProperty, model.surfaceTemperatureCelsiusProperty, celsiusRange, TemperatureUnits.CELSIUS, `celsius${ComboBox.ITEM_TANDEM_NAME_SUFFIX}`), ThermometerAndReadout.createComboBoxItem(fahrenheitUnitsStringProperty, model.surfaceTemperatureFahrenheitProperty, fahrenheitRange, TemperatureUnits.FAHRENHEIT, `fahrenheit${ComboBox.ITEM_TANDEM_NAME_SUFFIX}`)];
      const comboBox = new ComboBox(model.temperatureUnitsProperty, comboBoxItems, options.listParentNode || this, {
        align: 'right',
        listPosition: 'above',
        yMargin: 4,
        xMargin: 4,
        centerTop: thermometerNode.centerBottom.plusXY(0, THERMOMETER_TO_READOUT_DISTANCE),
        // pdom
        helpText: GreenhouseEffectStrings.a11y.temperatureUnitsHelpTextStringProperty,
        accessibleName: GreenhouseEffectStrings.a11y.temperatureUnitsLabelStringProperty,
        // phet-io
        tandem: options.tandem.createTandem('comboBox')
      });
      this.addChild(comboBox);

      // Make sure the NumberDisplays are all the same width.  This has to be done after the ComboBox is constructed
      // because the ComboBox creates these nodes using a passed-in creator function.  See
      // https://github.com/phetsims/greenhouse-effect/issues/256.
      const maxItemWidth = Math.max(..._.map(comboBox.nodes, 'width'));
      comboBox.nodes.forEach(node => {
        if (node instanceof NumberDisplay) {
          node.setBackgroundWidth(maxItemWidth);
        }
      });
    } else {
      // Create a derived property for the value that will be displayed as the temperature.
      const temperatureValueProperty = new DerivedProperty([model.surfaceTemperatureKelvinProperty, model.temperatureUnitsProperty], (temperature, temperatureUnits) => temperatureUnits === TemperatureUnits.KELVIN ? temperature : temperatureUnits === TemperatureUnits.CELSIUS ? GreenhouseEffectUtils.kelvinToCelsius(temperature) : GreenhouseEffectUtils.kelvinToFahrenheit(temperature));
      const unitsStringProperty = new DerivedProperty([model.temperatureUnitsProperty, GreenhouseEffectStrings.temperature.units.kelvinStringProperty, GreenhouseEffectStrings.temperature.units.celsiusStringProperty, GreenhouseEffectStrings.temperature.units.fahrenheitStringProperty], (units, kelvinUnitsString, celsiusUnitsString, fahrenheitUnitsString) => {
        return units === TemperatureUnits.KELVIN ? kelvinUnitsString : units === TemperatureUnits.CELSIUS ? celsiusUnitsString : fahrenheitUnitsString;
      });

      // Create the temperature readout.
      const temperatureReadout = new NumberDisplay(temperatureValueProperty, new Range(0, 999), {
        centerTop: thermometerNode.centerBottom.plusXY(0, THERMOMETER_TO_READOUT_DISTANCE),
        backgroundStroke: Color.BLACK,
        decimalPlaces: DECIMAL_PLACES_IN_READOUT,
        noValueAlign: 'center',
        cornerRadius: 3,
        xMargin: 12,
        yMargin: 3,
        textOptions: {
          font: GreenhouseEffectConstants.CONTENT_FONT,
          maxWidth: 100
        },
        valuePattern: new PatternStringProperty(GreenhouseEffectStrings.temperature.units.valueUnitsPatternStringProperty, {
          units: unitsStringProperty
        })
      });
      this.addChild(temperatureReadout);
    }

    // mutate with layout options after the Node has been assembled
    this.mutate(options);
  }

  /**
   * Create a ComboBox item for the units combo box. The Node for the ComboBox item is a NumberDisplay showing the
   * current value of temperature in those units.
   */
  static createComboBoxItem(unitsStringProperty, property, propertyRange, propertyValue, tandemName) {
    const numberDisplayOptions = {
      backgroundStroke: null,
      decimalPlaces: DECIMAL_PLACES_IN_READOUT,
      textOptions: {
        font: GreenhouseEffectConstants.CONTENT_FONT,
        maxWidth: 120
      },
      valuePattern: new PatternStringProperty(GreenhouseEffectStrings.temperature.units.valueUnitsPatternStringProperty, {
        units: unitsStringProperty
      })
    };
    return {
      value: propertyValue,
      createNode: () => new NumberDisplay(property, propertyRange, numberDisplayOptions),
      tandemName: tandemName,
      a11yName: TemperatureDescriber.getTemperatureUnitsString(propertyValue)
    };
  }

  // static values
  static ReadoutType = ReadoutType;
}
greenhouseEffect.register('ThermometerAndReadout', ThermometerAndReadout);
export default ThermometerAndReadout;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJQYXR0ZXJuU3RyaW5nUHJvcGVydHkiLCJSYW5nZSIsIkVudW1lcmF0aW9uIiwiRW51bWVyYXRpb25WYWx1ZSIsIm9wdGlvbml6ZSIsIk51bWJlckRpc3BsYXkiLCJUaGVybW9tZXRlck5vZGUiLCJDb2xvciIsIk5vZGUiLCJDb21ib0JveCIsIlRhbmRlbSIsImdyZWVuaG91c2VFZmZlY3QiLCJHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncyIsIkdyZWVuaG91c2VFZmZlY3RDb25zdGFudHMiLCJHcmVlbmhvdXNlRWZmZWN0UXVlcnlQYXJhbWV0ZXJzIiwiR3JlZW5ob3VzZUVmZmVjdFV0aWxzIiwiR3JvdW5kTGF5ZXIiLCJUZW1wZXJhdHVyZVVuaXRzIiwiVGVtcGVyYXR1cmVEZXNjcmliZXIiLCJHcmVlbmhvdXNlRWZmZWN0T2JzZXJ2YXRpb25XaW5kb3ciLCJUSEVSTU9NRVRFUl9UT19SRUFET1VUX0RJU1RBTkNFIiwiREVDSU1BTF9QTEFDRVNfSU5fUkVBRE9VVCIsInNob3dBZGRpdGlvbmFsVGVtcGVyYXR1cmVEaWdpdHMiLCJrZWx2aW5Vbml0c1N0cmluZ1Byb3BlcnR5IiwidGVtcGVyYXR1cmUiLCJ1bml0cyIsImtlbHZpblN0cmluZ1Byb3BlcnR5IiwiY2Vsc2l1c1VuaXRzU3RyaW5nUHJvcGVydHkiLCJjZWxzaXVzU3RyaW5nUHJvcGVydHkiLCJmYWhyZW5oZWl0VW5pdHNTdHJpbmdQcm9wZXJ0eSIsImZhaHJlbmhlaXRTdHJpbmdQcm9wZXJ0eSIsIlJlYWRvdXRUeXBlIiwiU0VMRUNUQUJMRSIsIkZJWEVEIiwiZW51bWVyYXRpb24iLCJUaGVybW9tZXRlckFuZFJlYWRvdXQiLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsIm1pblRlbXBlcmF0dXJlIiwiTUlOSU1VTV9FQVJUSF9BVF9OSUdIVF9URU1QRVJBVFVSRSIsIm1heFRlbXBlcmF0dXJlIiwiRVhQRUNURURfTUFYX1RFTVBFUkFUVVJFIiwicmVhZG91dFR5cGUiLCJsaXN0UGFyZW50Tm9kZSIsInRoZXJtb21ldGVyTm9kZU9wdGlvbnMiLCJidWxiRGlhbWV0ZXIiLCJ0dWJlSGVpZ2h0IiwidHViZVdpZHRoIiwiYmFja2dyb3VuZEZpbGwiLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInN1cmZhY2VUaGVybW9tZXRlclZpc2libGVQcm9wZXJ0eSIsImxpbmtBdHRyaWJ1dGUiLCJ0aGVybW9tZXRlck5vZGUiLCJzdXJmYWNlVGVtcGVyYXR1cmVLZWx2aW5Qcm9wZXJ0eSIsImFkZENoaWxkIiwia2VsdmluUmFuZ2UiLCJyYW5nZSIsImNlbHNpdXNSYW5nZSIsImtlbHZpblRvQ2Vsc2l1cyIsIm1pbiIsIm1heCIsImZhaHJlbmhlaXRSYW5nZSIsImtlbHZpblRvRmFocmVuaGVpdCIsImNvbWJvQm94SXRlbXMiLCJjcmVhdGVDb21ib0JveEl0ZW0iLCJLRUxWSU4iLCJJVEVNX1RBTkRFTV9OQU1FX1NVRkZJWCIsInN1cmZhY2VUZW1wZXJhdHVyZUNlbHNpdXNQcm9wZXJ0eSIsIkNFTFNJVVMiLCJzdXJmYWNlVGVtcGVyYXR1cmVGYWhyZW5oZWl0UHJvcGVydHkiLCJGQUhSRU5IRUlUIiwiY29tYm9Cb3giLCJ0ZW1wZXJhdHVyZVVuaXRzUHJvcGVydHkiLCJhbGlnbiIsImxpc3RQb3NpdGlvbiIsInlNYXJnaW4iLCJ4TWFyZ2luIiwiY2VudGVyVG9wIiwiY2VudGVyQm90dG9tIiwicGx1c1hZIiwiaGVscFRleHQiLCJhMTF5IiwidGVtcGVyYXR1cmVVbml0c0hlbHBUZXh0U3RyaW5nUHJvcGVydHkiLCJhY2Nlc3NpYmxlTmFtZSIsInRlbXBlcmF0dXJlVW5pdHNMYWJlbFN0cmluZ1Byb3BlcnR5IiwiY3JlYXRlVGFuZGVtIiwibWF4SXRlbVdpZHRoIiwiTWF0aCIsIl8iLCJtYXAiLCJub2RlcyIsImZvckVhY2giLCJub2RlIiwic2V0QmFja2dyb3VuZFdpZHRoIiwidGVtcGVyYXR1cmVWYWx1ZVByb3BlcnR5IiwidGVtcGVyYXR1cmVVbml0cyIsInVuaXRzU3RyaW5nUHJvcGVydHkiLCJrZWx2aW5Vbml0c1N0cmluZyIsImNlbHNpdXNVbml0c1N0cmluZyIsImZhaHJlbmhlaXRVbml0c1N0cmluZyIsInRlbXBlcmF0dXJlUmVhZG91dCIsImJhY2tncm91bmRTdHJva2UiLCJCTEFDSyIsImRlY2ltYWxQbGFjZXMiLCJub1ZhbHVlQWxpZ24iLCJjb3JuZXJSYWRpdXMiLCJ0ZXh0T3B0aW9ucyIsImZvbnQiLCJDT05URU5UX0ZPTlQiLCJtYXhXaWR0aCIsInZhbHVlUGF0dGVybiIsInZhbHVlVW5pdHNQYXR0ZXJuU3RyaW5nUHJvcGVydHkiLCJtdXRhdGUiLCJwcm9wZXJ0eSIsInByb3BlcnR5UmFuZ2UiLCJwcm9wZXJ0eVZhbHVlIiwidGFuZGVtTmFtZSIsIm51bWJlckRpc3BsYXlPcHRpb25zIiwidmFsdWUiLCJjcmVhdGVOb2RlIiwiYTExeU5hbWUiLCJnZXRUZW1wZXJhdHVyZVVuaXRzU3RyaW5nIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJUaGVybW9tZXRlckFuZFJlYWRvdXQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjEtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhlcm1vbWV0ZXJBbmRSZWFkb3V0IGlzIGEgU2NlbmVyeSBOb2RlIHRoYXQgZGVwaWN0cyBhIHRoZXJtb21ldGVyIGFuZCBhIG51bWVyaWNhbCByZWFkb3V0IHRoYXQgaW5kaWNhdGVzIHRoZVxyXG4gKiB0ZW1wZXJhdHVyZS4gIEJhc2VkIG9uIGNvbmZpZ3VyYXRpb24gb3B0aW9ucywgdGhlIHJlYWRvdXQgY2FuIGVpdGhlciBiZSBhIGNvbWJvIGJveCBmcm9tIHdoaWNoIHRoZSB1c2VyIGNhbiBzZWxlY3RcclxuICogZGlmZmVyZW50IHVuaXRzIChlLmcuIEZhaHJlbmhlaXQgb3IgQ2Vsc2l1cyksIG9yIGEgc2ltcGxlIHJlYWRvdXQgdGhhdCBqdXN0IHNob3dzIHRoZSB0ZW1wZXJhdHVyZS4gIE9wdGlvbnMgY2FuIGJlXHJcbiAqIHVzZWQgdG8gYWRqdXN0IHRoZSBzaXplIGFuZCBhcHBlYXJhbmNlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBKb2huIEJsYW5jbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFBhdHRlcm5TdHJpbmdQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1BhdHRlcm5TdHJpbmdQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IFJhbmdlIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBFbnVtZXJhdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvRW51bWVyYXRpb24uanMnO1xyXG5pbXBvcnQgRW51bWVyYXRpb25WYWx1ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvRW51bWVyYXRpb25WYWx1ZS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBOdW1iZXJEaXNwbGF5IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9OdW1iZXJEaXNwbGF5LmpzJztcclxuaW1wb3J0IFRoZXJtb21ldGVyTm9kZSwgeyBUaGVybW9tZXRlck5vZGVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1RoZXJtb21ldGVyTm9kZS5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBOb2RlLCBOb2RlT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBDb21ib0JveCwgeyBDb21ib0JveEl0ZW0gfSBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvQ29tYm9Cb3guanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgZ3JlZW5ob3VzZUVmZmVjdCBmcm9tICcuLi8uLi9ncmVlbmhvdXNlRWZmZWN0LmpzJztcclxuaW1wb3J0IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzIGZyb20gJy4uLy4uL0dyZWVuaG91c2VFZmZlY3RTdHJpbmdzLmpzJztcclxuaW1wb3J0IEdyZWVuaG91c2VFZmZlY3RDb25zdGFudHMgZnJvbSAnLi4vR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBHcmVlbmhvdXNlRWZmZWN0UXVlcnlQYXJhbWV0ZXJzIGZyb20gJy4uL0dyZWVuaG91c2VFZmZlY3RRdWVyeVBhcmFtZXRlcnMuanMnO1xyXG5pbXBvcnQgR3JlZW5ob3VzZUVmZmVjdFV0aWxzIGZyb20gJy4uL0dyZWVuaG91c2VFZmZlY3RVdGlscy5qcyc7XHJcbmltcG9ydCBHcm91bmRMYXllciBmcm9tICcuLi9tb2RlbC9Hcm91bmRMYXllci5qcyc7XHJcbmltcG9ydCBMYXllcnNNb2RlbCBmcm9tICcuLi9tb2RlbC9MYXllcnNNb2RlbC5qcyc7XHJcbmltcG9ydCBUZW1wZXJhdHVyZVVuaXRzIGZyb20gJy4uL21vZGVsL1RlbXBlcmF0dXJlVW5pdHMuanMnO1xyXG5pbXBvcnQgVGVtcGVyYXR1cmVEZXNjcmliZXIgZnJvbSAnLi9kZXNjcmliZXJzL1RlbXBlcmF0dXJlRGVzY3JpYmVyLmpzJztcclxuaW1wb3J0IEdyZWVuaG91c2VFZmZlY3RPYnNlcnZhdGlvbldpbmRvdyBmcm9tICcuL0dyZWVuaG91c2VFZmZlY3RPYnNlcnZhdGlvbldpbmRvdy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgVEhFUk1PTUVURVJfVE9fUkVBRE9VVF9ESVNUQU5DRSA9IDE1OyAvLyBpbiBzY3JlZW4gY29vcmRpbmF0ZXNcclxuY29uc3QgREVDSU1BTF9QTEFDRVNfSU5fUkVBRE9VVCA9IEdyZWVuaG91c2VFZmZlY3RRdWVyeVBhcmFtZXRlcnMuc2hvd0FkZGl0aW9uYWxUZW1wZXJhdHVyZURpZ2l0cyA/IDMgOiAxO1xyXG5jb25zdCBrZWx2aW5Vbml0c1N0cmluZ1Byb3BlcnR5ID0gR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MudGVtcGVyYXR1cmUudW5pdHMua2VsdmluU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGNlbHNpdXNVbml0c1N0cmluZ1Byb3BlcnR5ID0gR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MudGVtcGVyYXR1cmUudW5pdHMuY2Vsc2l1c1N0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBmYWhyZW5oZWl0VW5pdHNTdHJpbmdQcm9wZXJ0eSA9IEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLnRlbXBlcmF0dXJlLnVuaXRzLmZhaHJlbmhlaXRTdHJpbmdQcm9wZXJ0eTtcclxuXHJcbmNsYXNzIFJlYWRvdXRUeXBlIGV4dGVuZHMgRW51bWVyYXRpb25WYWx1ZSB7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBTRUxFQ1RBQkxFID0gbmV3IFJlYWRvdXRUeXBlKCk7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBGSVhFRCA9IG5ldyBSZWFkb3V0VHlwZSgpO1xyXG5cclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IGVudW1lcmF0aW9uID0gbmV3IEVudW1lcmF0aW9uKCBSZWFkb3V0VHlwZSApO1xyXG59XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIG1pblRlbXBlcmF0dXJlPzogbnVtYmVyO1xyXG4gIG1heFRlbXBlcmF0dXJlPzogbnVtYmVyO1xyXG4gIHJlYWRvdXRUeXBlPzogUmVhZG91dFR5cGU7XHJcbiAgbGlzdFBhcmVudE5vZGU/OiBOb2RlIHwgbnVsbDtcclxuICB0aGVybW9tZXRlck5vZGVPcHRpb25zPzogVGhlcm1vbWV0ZXJOb2RlT3B0aW9ucztcclxuICB0YW5kZW0/OiBUYW5kZW07XHJcbn07XHJcblxyXG50eXBlIFRoZXJtb21ldGVyQW5kUmVhZG91dE9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIE5vZGVPcHRpb25zO1xyXG5cclxuY2xhc3MgVGhlcm1vbWV0ZXJBbmRSZWFkb3V0IGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBtb2RlbFxyXG4gICAqIEBwYXJhbSBbcHJvdmlkZWRPcHRpb25zXVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbW9kZWw6IExheWVyc01vZGVsLCBwcm92aWRlZE9wdGlvbnM/OiBUaGVybW9tZXRlckFuZFJlYWRvdXRPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8VGhlcm1vbWV0ZXJBbmRSZWFkb3V0T3B0aW9ucywgU2VsZk9wdGlvbnMsIE5vZGVPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICBtaW5UZW1wZXJhdHVyZTogR3JvdW5kTGF5ZXIuTUlOSU1VTV9FQVJUSF9BVF9OSUdIVF9URU1QRVJBVFVSRSxcclxuICAgICAgbWF4VGVtcGVyYXR1cmU6IEdyZWVuaG91c2VFZmZlY3RPYnNlcnZhdGlvbldpbmRvdy5FWFBFQ1RFRF9NQVhfVEVNUEVSQVRVUkUgKyAzLFxyXG5cclxuICAgICAgLy8gcmVhZG91dCB0eXBlIHRoYXQgd2lsbCBiZSBzaG93biBiZWxvdyB0aGUgdGhlcm1vbWV0ZXIsIGVpdGhlciBTRUxFQ1RBQkxFIChpLmUuIGEgY29tYm8gYm94KSBvciBmaXhlZFxyXG4gICAgICByZWFkb3V0VHlwZTogUmVhZG91dFR5cGUuU0VMRUNUQUJMRSxcclxuXHJcbiAgICAgIC8vIHBhcmVudCBub2RlIHVzZWQgZm9yIHRoZSBjb21ibyBib3ggbGlzdCwgb25seSB1c2VkIGZvciBTRUxFQ1RBQkxFIHJlYWRvdXRcclxuICAgICAgbGlzdFBhcmVudE5vZGU6IG51bGwsXHJcblxyXG4gICAgICAvLyBvcHRpb25zIHBhc3NlZCBhbG9uZyB0byB0aGUgVGhlcm1vbWV0ZXJOb2RlXHJcbiAgICAgIHRoZXJtb21ldGVyTm9kZU9wdGlvbnM6IHtcclxuICAgICAgICBidWxiRGlhbWV0ZXI6IDQwLFxyXG4gICAgICAgIHR1YmVIZWlnaHQ6IDE1MCxcclxuICAgICAgICB0dWJlV2lkdGg6IDIwLFxyXG4gICAgICAgIGJhY2tncm91bmRGaWxsOiAnd2hpdGUnXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVEXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBvcHRpb25zIHBhc3NlZCB0byB0aGUgc3VwZXJ0eXBlIGxhdGVyIGluIG11dGF0ZVxyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICAvLyB2aXNpYmlsaXR5XHJcbiAgICBtb2RlbC5zdXJmYWNlVGhlcm1vbWV0ZXJWaXNpYmxlUHJvcGVydHkubGlua0F0dHJpYnV0ZSggdGhpcywgJ3Zpc2libGUnICk7XHJcblxyXG4gICAgLy8gdGhlcm1vbWV0ZXIgLSByYW5nZSBjaG9zZW4gZW1waXJpY2FsbHkgdG8gbWFrZSBpdCBsb29rIHJlYXNvbmFibGUgaW4gdGhlIHNpbVxyXG4gICAgY29uc3QgdGhlcm1vbWV0ZXJOb2RlID0gbmV3IFRoZXJtb21ldGVyTm9kZSggbW9kZWwuc3VyZmFjZVRlbXBlcmF0dXJlS2VsdmluUHJvcGVydHksIG9wdGlvbnMubWluVGVtcGVyYXR1cmUsIG9wdGlvbnMubWF4VGVtcGVyYXR1cmUsIG9wdGlvbnMudGhlcm1vbWV0ZXJOb2RlT3B0aW9ucyApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhlcm1vbWV0ZXJOb2RlICk7XHJcblxyXG4gICAgLy8gcmFuZ2VzIGZvciBlYWNoIHRlbXBlcmF0dXJlIFByb3BlcnR5LCBzbyB0aGUgTnVtYmVyRGlzcGxheSBjYW4gZGV0ZXJtaW5lIHNwYWNlIG5lZWRlZCBmb3IgZWFjaCByZWFkb3V0XHJcbiAgICBjb25zdCBrZWx2aW5SYW5nZSA9IG1vZGVsLnN1cmZhY2VUZW1wZXJhdHVyZUtlbHZpblByb3BlcnR5LnJhbmdlO1xyXG4gICAgY29uc3QgY2Vsc2l1c1JhbmdlID0gbmV3IFJhbmdlKFxyXG4gICAgICBHcmVlbmhvdXNlRWZmZWN0VXRpbHMua2VsdmluVG9DZWxzaXVzKCBrZWx2aW5SYW5nZS5taW4gKSxcclxuICAgICAgR3JlZW5ob3VzZUVmZmVjdFV0aWxzLmtlbHZpblRvQ2Vsc2l1cygga2VsdmluUmFuZ2UubWF4IClcclxuICAgICk7XHJcbiAgICBjb25zdCBmYWhyZW5oZWl0UmFuZ2UgPSBuZXcgUmFuZ2UoXHJcbiAgICAgIEdyZWVuaG91c2VFZmZlY3RVdGlscy5rZWx2aW5Ub0ZhaHJlbmhlaXQoIGtlbHZpblJhbmdlLm1pbiApLFxyXG4gICAgICBHcmVlbmhvdXNlRWZmZWN0VXRpbHMua2VsdmluVG9GYWhyZW5oZWl0KCBrZWx2aW5SYW5nZS5tYXggKVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAoIG9wdGlvbnMucmVhZG91dFR5cGUgPT09IFJlYWRvdXRUeXBlLlNFTEVDVEFCTEUgKSB7XHJcblxyXG4gICAgICBjb25zdCBjb21ib0JveEl0ZW1zID0gW1xyXG4gICAgICAgIFRoZXJtb21ldGVyQW5kUmVhZG91dC5jcmVhdGVDb21ib0JveEl0ZW0oXHJcbiAgICAgICAgICBrZWx2aW5Vbml0c1N0cmluZ1Byb3BlcnR5LFxyXG4gICAgICAgICAgbW9kZWwuc3VyZmFjZVRlbXBlcmF0dXJlS2VsdmluUHJvcGVydHksXHJcbiAgICAgICAgICBtb2RlbC5zdXJmYWNlVGVtcGVyYXR1cmVLZWx2aW5Qcm9wZXJ0eS5yYW5nZSxcclxuICAgICAgICAgIFRlbXBlcmF0dXJlVW5pdHMuS0VMVklOLFxyXG4gICAgICAgICAgYGtlbHZpbiR7Q29tYm9Cb3guSVRFTV9UQU5ERU1fTkFNRV9TVUZGSVh9YFxyXG4gICAgICAgICksXHJcbiAgICAgICAgVGhlcm1vbWV0ZXJBbmRSZWFkb3V0LmNyZWF0ZUNvbWJvQm94SXRlbShcclxuICAgICAgICAgIGNlbHNpdXNVbml0c1N0cmluZ1Byb3BlcnR5LFxyXG4gICAgICAgICAgbW9kZWwuc3VyZmFjZVRlbXBlcmF0dXJlQ2Vsc2l1c1Byb3BlcnR5LFxyXG4gICAgICAgICAgY2Vsc2l1c1JhbmdlLFxyXG4gICAgICAgICAgVGVtcGVyYXR1cmVVbml0cy5DRUxTSVVTLFxyXG4gICAgICAgICAgYGNlbHNpdXMke0NvbWJvQm94LklURU1fVEFOREVNX05BTUVfU1VGRklYfWBcclxuICAgICAgICApLFxyXG4gICAgICAgIFRoZXJtb21ldGVyQW5kUmVhZG91dC5jcmVhdGVDb21ib0JveEl0ZW0oXHJcbiAgICAgICAgICBmYWhyZW5oZWl0VW5pdHNTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgICAgIG1vZGVsLnN1cmZhY2VUZW1wZXJhdHVyZUZhaHJlbmhlaXRQcm9wZXJ0eSxcclxuICAgICAgICAgIGZhaHJlbmhlaXRSYW5nZSxcclxuICAgICAgICAgIFRlbXBlcmF0dXJlVW5pdHMuRkFIUkVOSEVJVCxcclxuICAgICAgICAgIGBmYWhyZW5oZWl0JHtDb21ib0JveC5JVEVNX1RBTkRFTV9OQU1FX1NVRkZJWH1gXHJcbiAgICAgICAgKVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgY29uc3QgY29tYm9Cb3ggPSBuZXcgQ29tYm9Cb3goIG1vZGVsLnRlbXBlcmF0dXJlVW5pdHNQcm9wZXJ0eSwgY29tYm9Cb3hJdGVtcywgb3B0aW9ucy5saXN0UGFyZW50Tm9kZSB8fCB0aGlzLCB7XHJcbiAgICAgICAgYWxpZ246ICdyaWdodCcsXHJcbiAgICAgICAgbGlzdFBvc2l0aW9uOiAnYWJvdmUnLFxyXG4gICAgICAgIHlNYXJnaW46IDQsXHJcbiAgICAgICAgeE1hcmdpbjogNCxcclxuICAgICAgICBjZW50ZXJUb3A6IHRoZXJtb21ldGVyTm9kZS5jZW50ZXJCb3R0b20ucGx1c1hZKCAwLCBUSEVSTU9NRVRFUl9UT19SRUFET1VUX0RJU1RBTkNFICksXHJcblxyXG4gICAgICAgIC8vIHBkb21cclxuICAgICAgICBoZWxwVGV4dDogR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuYTExeS50ZW1wZXJhdHVyZVVuaXRzSGVscFRleHRTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgICBhY2Nlc3NpYmxlTmFtZTogR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuYTExeS50ZW1wZXJhdHVyZVVuaXRzTGFiZWxTdHJpbmdQcm9wZXJ0eSxcclxuXHJcbiAgICAgICAgLy8gcGhldC1pb1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnY29tYm9Cb3gnIClcclxuICAgICAgfSApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCBjb21ib0JveCApO1xyXG5cclxuICAgICAgLy8gTWFrZSBzdXJlIHRoZSBOdW1iZXJEaXNwbGF5cyBhcmUgYWxsIHRoZSBzYW1lIHdpZHRoLiAgVGhpcyBoYXMgdG8gYmUgZG9uZSBhZnRlciB0aGUgQ29tYm9Cb3ggaXMgY29uc3RydWN0ZWRcclxuICAgICAgLy8gYmVjYXVzZSB0aGUgQ29tYm9Cb3ggY3JlYXRlcyB0aGVzZSBub2RlcyB1c2luZyBhIHBhc3NlZC1pbiBjcmVhdG9yIGZ1bmN0aW9uLiAgU2VlXHJcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmVlbmhvdXNlLWVmZmVjdC9pc3N1ZXMvMjU2LlxyXG4gICAgICBjb25zdCBtYXhJdGVtV2lkdGggPSBNYXRoLm1heCggLi4uXy5tYXAoIGNvbWJvQm94Lm5vZGVzLCAnd2lkdGgnICkgKTtcclxuICAgICAgY29tYm9Cb3gubm9kZXMuZm9yRWFjaCggKCBub2RlOiBOb2RlICkgPT4ge1xyXG4gICAgICAgIGlmICggbm9kZSBpbnN0YW5jZW9mIE51bWJlckRpc3BsYXkgKSB7XHJcbiAgICAgICAgICBub2RlLnNldEJhY2tncm91bmRXaWR0aCggbWF4SXRlbVdpZHRoICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuXHJcbiAgICAgIC8vIENyZWF0ZSBhIGRlcml2ZWQgcHJvcGVydHkgZm9yIHRoZSB2YWx1ZSB0aGF0IHdpbGwgYmUgZGlzcGxheWVkIGFzIHRoZSB0ZW1wZXJhdHVyZS5cclxuICAgICAgY29uc3QgdGVtcGVyYXR1cmVWYWx1ZVByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eShcclxuICAgICAgICBbIG1vZGVsLnN1cmZhY2VUZW1wZXJhdHVyZUtlbHZpblByb3BlcnR5LCBtb2RlbC50ZW1wZXJhdHVyZVVuaXRzUHJvcGVydHkgXSxcclxuICAgICAgICAoIHRlbXBlcmF0dXJlLCB0ZW1wZXJhdHVyZVVuaXRzICkgPT5cclxuICAgICAgICAgIHRlbXBlcmF0dXJlVW5pdHMgPT09IFRlbXBlcmF0dXJlVW5pdHMuS0VMVklOID8gdGVtcGVyYXR1cmUgOlxyXG4gICAgICAgICAgdGVtcGVyYXR1cmVVbml0cyA9PT0gVGVtcGVyYXR1cmVVbml0cy5DRUxTSVVTID8gR3JlZW5ob3VzZUVmZmVjdFV0aWxzLmtlbHZpblRvQ2Vsc2l1cyggdGVtcGVyYXR1cmUgKSA6XHJcbiAgICAgICAgICBHcmVlbmhvdXNlRWZmZWN0VXRpbHMua2VsdmluVG9GYWhyZW5oZWl0KCB0ZW1wZXJhdHVyZSApXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBjb25zdCB1bml0c1N0cmluZ1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eShcclxuICAgICAgICBbXHJcbiAgICAgICAgICBtb2RlbC50ZW1wZXJhdHVyZVVuaXRzUHJvcGVydHksXHJcbiAgICAgICAgICBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy50ZW1wZXJhdHVyZS51bml0cy5rZWx2aW5TdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgICAgIEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLnRlbXBlcmF0dXJlLnVuaXRzLmNlbHNpdXNTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgICAgIEdyZWVuaG91c2VFZmZlY3RTdHJpbmdzLnRlbXBlcmF0dXJlLnVuaXRzLmZhaHJlbmhlaXRTdHJpbmdQcm9wZXJ0eVxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgKCB1bml0cywga2VsdmluVW5pdHNTdHJpbmcsIGNlbHNpdXNVbml0c1N0cmluZywgZmFocmVuaGVpdFVuaXRzU3RyaW5nICkgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIHVuaXRzID09PSBUZW1wZXJhdHVyZVVuaXRzLktFTFZJTiA/IGtlbHZpblVuaXRzU3RyaW5nIDpcclxuICAgICAgICAgICAgICAgICB1bml0cyA9PT0gVGVtcGVyYXR1cmVVbml0cy5DRUxTSVVTID8gY2Vsc2l1c1VuaXRzU3RyaW5nIDpcclxuICAgICAgICAgICAgICAgICBmYWhyZW5oZWl0VW5pdHNTdHJpbmc7XHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gQ3JlYXRlIHRoZSB0ZW1wZXJhdHVyZSByZWFkb3V0LlxyXG4gICAgICBjb25zdCB0ZW1wZXJhdHVyZVJlYWRvdXQgPSBuZXcgTnVtYmVyRGlzcGxheSggdGVtcGVyYXR1cmVWYWx1ZVByb3BlcnR5LCBuZXcgUmFuZ2UoIDAsIDk5OSApLCB7XHJcbiAgICAgICAgY2VudGVyVG9wOiB0aGVybW9tZXRlck5vZGUuY2VudGVyQm90dG9tLnBsdXNYWSggMCwgVEhFUk1PTUVURVJfVE9fUkVBRE9VVF9ESVNUQU5DRSApLFxyXG4gICAgICAgIGJhY2tncm91bmRTdHJva2U6IENvbG9yLkJMQUNLLFxyXG4gICAgICAgIGRlY2ltYWxQbGFjZXM6IERFQ0lNQUxfUExBQ0VTX0lOX1JFQURPVVQsXHJcbiAgICAgICAgbm9WYWx1ZUFsaWduOiAnY2VudGVyJyxcclxuICAgICAgICBjb3JuZXJSYWRpdXM6IDMsXHJcbiAgICAgICAgeE1hcmdpbjogMTIsXHJcbiAgICAgICAgeU1hcmdpbjogMyxcclxuICAgICAgICB0ZXh0T3B0aW9uczoge1xyXG4gICAgICAgICAgZm9udDogR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cy5DT05URU5UX0ZPTlQsXHJcbiAgICAgICAgICBtYXhXaWR0aDogMTAwXHJcbiAgICAgICAgfSxcclxuICAgICAgICB2YWx1ZVBhdHRlcm46IG5ldyBQYXR0ZXJuU3RyaW5nUHJvcGVydHkoXHJcbiAgICAgICAgICBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy50ZW1wZXJhdHVyZS51bml0cy52YWx1ZVVuaXRzUGF0dGVyblN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICAgICAgeyB1bml0czogdW5pdHNTdHJpbmdQcm9wZXJ0eSB9XHJcbiAgICAgICAgKVxyXG4gICAgICB9ICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIHRlbXBlcmF0dXJlUmVhZG91dCApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIG11dGF0ZSB3aXRoIGxheW91dCBvcHRpb25zIGFmdGVyIHRoZSBOb2RlIGhhcyBiZWVuIGFzc2VtYmxlZFxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBhIENvbWJvQm94IGl0ZW0gZm9yIHRoZSB1bml0cyBjb21ibyBib3guIFRoZSBOb2RlIGZvciB0aGUgQ29tYm9Cb3ggaXRlbSBpcyBhIE51bWJlckRpc3BsYXkgc2hvd2luZyB0aGVcclxuICAgKiBjdXJyZW50IHZhbHVlIG9mIHRlbXBlcmF0dXJlIGluIHRob3NlIHVuaXRzLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIGNyZWF0ZUNvbWJvQm94SXRlbSggdW5pdHNTdHJpbmdQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXI+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlSYW5nZTogUmFuZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVZhbHVlOiBUZW1wZXJhdHVyZVVuaXRzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFuZGVtTmFtZTogc3RyaW5nICk6IENvbWJvQm94SXRlbTxUZW1wZXJhdHVyZVVuaXRzPiB7XHJcblxyXG4gICAgY29uc3QgbnVtYmVyRGlzcGxheU9wdGlvbnMgPSB7XHJcbiAgICAgIGJhY2tncm91bmRTdHJva2U6IG51bGwsXHJcbiAgICAgIGRlY2ltYWxQbGFjZXM6IERFQ0lNQUxfUExBQ0VTX0lOX1JFQURPVVQsXHJcbiAgICAgIHRleHRPcHRpb25zOiB7XHJcbiAgICAgICAgZm9udDogR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cy5DT05URU5UX0ZPTlQsXHJcbiAgICAgICAgbWF4V2lkdGg6IDEyMFxyXG4gICAgICB9LFxyXG4gICAgICB2YWx1ZVBhdHRlcm46IG5ldyBQYXR0ZXJuU3RyaW5nUHJvcGVydHkoXHJcbiAgICAgICAgR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MudGVtcGVyYXR1cmUudW5pdHMudmFsdWVVbml0c1BhdHRlcm5TdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICAgICAgdW5pdHM6IHVuaXRzU3RyaW5nUHJvcGVydHlcclxuICAgICAgICB9IClcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdmFsdWU6IHByb3BlcnR5VmFsdWUsXHJcbiAgICAgIGNyZWF0ZU5vZGU6ICgpID0+IG5ldyBOdW1iZXJEaXNwbGF5KCBwcm9wZXJ0eSwgcHJvcGVydHlSYW5nZSwgbnVtYmVyRGlzcGxheU9wdGlvbnMgKSxcclxuICAgICAgdGFuZGVtTmFtZTogdGFuZGVtTmFtZSxcclxuICAgICAgYTExeU5hbWU6IFRlbXBlcmF0dXJlRGVzY3JpYmVyLmdldFRlbXBlcmF0dXJlVW5pdHNTdHJpbmcoIHByb3BlcnR5VmFsdWUgKVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIHN0YXRpYyB2YWx1ZXNcclxuICBwdWJsaWMgc3RhdGljIFJlYWRvdXRUeXBlID0gUmVhZG91dFR5cGU7XHJcbn1cclxuXHJcbmdyZWVuaG91c2VFZmZlY3QucmVnaXN0ZXIoICdUaGVybW9tZXRlckFuZFJlYWRvdXQnLCBUaGVybW9tZXRlckFuZFJlYWRvdXQgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFRoZXJtb21ldGVyQW5kUmVhZG91dDtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxxQkFBcUIsTUFBTSw4Q0FBOEM7QUFFaEYsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxXQUFXLE1BQU0seUNBQXlDO0FBQ2pFLE9BQU9DLGdCQUFnQixNQUFNLDhDQUE4QztBQUMzRSxPQUFPQyxTQUFTLE1BQU0sdUNBQXVDO0FBQzdELE9BQU9DLGFBQWEsTUFBTSw4Q0FBOEM7QUFDeEUsT0FBT0MsZUFBZSxNQUFrQyxnREFBZ0Q7QUFDeEcsU0FBU0MsS0FBSyxFQUFFQyxJQUFJLFFBQXFCLG1DQUFtQztBQUM1RSxPQUFPQyxRQUFRLE1BQXdCLGdDQUFnQztBQUN2RSxPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBQ3BELE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxPQUFPQyx1QkFBdUIsTUFBTSxrQ0FBa0M7QUFDdEUsT0FBT0MseUJBQXlCLE1BQU0saUNBQWlDO0FBQ3ZFLE9BQU9DLCtCQUErQixNQUFNLHVDQUF1QztBQUNuRixPQUFPQyxxQkFBcUIsTUFBTSw2QkFBNkI7QUFDL0QsT0FBT0MsV0FBVyxNQUFNLHlCQUF5QjtBQUVqRCxPQUFPQyxnQkFBZ0IsTUFBTSw4QkFBOEI7QUFDM0QsT0FBT0Msb0JBQW9CLE1BQU0sc0NBQXNDO0FBQ3ZFLE9BQU9DLGlDQUFpQyxNQUFNLHdDQUF3Qzs7QUFFdEY7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