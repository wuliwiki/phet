// Copyright 2021-2022, University of Colorado Boulder

/**
 * Node for a Cloud in the Greenhouse Effect simulation.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 * @author John Blanco (PhET Interactive Simulations)
 */

import dotRandom from '../../../../dot/js/dotRandom.js';
import { Shape } from '../../../../kite/js/imports.js';
import optionize from '../../../../phet-core/js/optionize.js';
import { Color, Node, Path } from '../../../../scenery/js/imports.js';
import greenhouseEffect from '../../greenhouseEffect.js';
// constants
const CLOUD_FILL = new Color(255, 255, 255, 0.75);
const CLOUD_BACKGROUND_STROKE = Color.BLACK;
class CloudNode extends Node {
  constructor(cloud, modelViewTransform, providedOptions) {
    const options = optionize()({
      showReferenceEllipse: false
    }, providedOptions);
    super(options);
    const cloudPath = new Path(CloudNode.createCloudShape(modelViewTransform.modelToViewPosition(cloud.position), Math.abs(modelViewTransform.modelToViewDeltaX(cloud.width)), Math.abs(modelViewTransform.modelToViewDeltaY(cloud.height))), {
      fill: CLOUD_FILL,
      stroke: CLOUD_BACKGROUND_STROKE,
      miterLimit: 1
    });
    this.addChild(cloudPath);

    // If specified, show an ellipse that corresponds to the strict model shape of the cloud.  This is useful for debug.
    if (options.showReferenceEllipse) {
      this.addChild(new Path(modelViewTransform.modelToViewShape(cloud.modelShape), {
        fill: new Color(255, 0, 0, 0.5),
        stroke: new Color(255, 0, 0, 0.9),
        lineWidth: 3
      }));
    }

    // Control the visibility of the cloud.
    const cloudEnabledObserver = enabled => {
      this.visible = enabled;
    };
    cloud.enabledProperty.link(cloudEnabledObserver);
    this.disposeCloudNode = () => {
      cloud.enabledProperty.unlink(cloudEnabledObserver);
    };
  }

  /**
   * Create a blobby cloud-like shape to represent the cloud. Returns a Shape to be used with a Path.
   *
   * TODO: This may be temporary, since we may have artwork or may refine the look of the cloud sometime in the future.
   *       See https://github.com/phetsims/greenhouse-effect/issues/49.
   */
  static createCloudShape(position, width, height) {
    const circleShapes = [];
    let drawnWidth = 0;
    const leftBound = position.x - width / 2;
    const rightBound = position.x + width / 2;

    // limits for circle sizes, empirically determined
    const circleMinimumRadius = height * 0.5;
    const circleMaximumRadius = height * 0.7;

    // horizontal position of the circle being drawn, updated with each iteration
    let arcCenterX = leftBound;

    // The vertical position is shifted down slightly so that the bottom of the cloud can look flat and still contain
    // the elliptical shape that is used in the model.
    const adjustedReferenceCenterY = position.y + circleMaximumRadius * 0.3;

    // max random shift up or down in the Y direction, empirically determined
    const maxYShift = circleMaximumRadius * 0.025;

    // used to align the circles
    let firstCircleRadius = 0;

    // Add a set of overlapping circles with some randomness of size and position to create the cloud shape.
    while (leftBound + drawnWidth < rightBound) {
      const proportionDrawn = drawnWidth / width;

      // The radius is random, but limited by the height and the Y position within the cloud.  The circles on the ends
      // are a little smaller than those in the middle.
      let minArcRadius = circleMinimumRadius;
      let maxArcRadius = circleMaximumRadius;
      if (proportionDrawn < 0.25) {
        // This circle is on the left side, scale it down a bit.
        const reductionMultiplier = 1 - 2 * (0.25 - proportionDrawn);
        minArcRadius = reductionMultiplier * minArcRadius;
        maxArcRadius = reductionMultiplier * maxArcRadius;
      } else if (proportionDrawn > 0.75) {
        // This circle is on the right side, scale it down a bit.
        const reductionMultiplier = 0.5 + 2 * (1 - proportionDrawn);
        minArcRadius = reductionMultiplier * minArcRadius;
        maxArcRadius = reductionMultiplier * maxArcRadius;
      }

      // Choose the arc radius using randomness and the constraints determined above.
      const arcRadius = dotRandom.nextDoubleBetween(minArcRadius, maxArcRadius);
      if (circleShapes.length === 0) {
        // Keep track of the radius of the first circle so we can use it later to line things up.
        firstCircleRadius = arcRadius;
      }
      arcCenterX = arcCenterX + arcRadius;

      // Adjust the Y position so that the bottom of the cloud is more flat than the top.
      const arcCenterY = firstCircleRadius ? adjustedReferenceCenterY - (arcRadius - firstCircleRadius) - dotRandom.nextDoubleBetween(-maxYShift, maxYShift) : adjustedReferenceCenterY;

      // Add this circle to our collection.
      const circleShape = Shape.arc(arcCenterX, arcCenterY, arcRadius, 0, 2 * Math.PI);
      circleShapes.push(circleShape);
      drawnWidth = arcCenterX + arcRadius - leftBound;
    }
    return Shape.union(circleShapes);
  }

  /**
   * Free memory references to avoid leaks.
   */
  dispose() {
    this.disposeCloudNode();
    super.dispose();
  }
}
greenhouseEffect.register('CloudNode', CloudNode);
export default CloudNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJTaGFwZSIsIm9wdGlvbml6ZSIsIkNvbG9yIiwiTm9kZSIsIlBhdGgiLCJncmVlbmhvdXNlRWZmZWN0IiwiQ0xPVURfRklMTCIsIkNMT1VEX0JBQ0tHUk9VTkRfU1RST0tFIiwiQkxBQ0siLCJDbG91ZE5vZGUiLCJjb25zdHJ1Y3RvciIsImNsb3VkIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsInNob3dSZWZlcmVuY2VFbGxpcHNlIiwiY2xvdWRQYXRoIiwiY3JlYXRlQ2xvdWRTaGFwZSIsIm1vZGVsVG9WaWV3UG9zaXRpb24iLCJwb3NpdGlvbiIsIk1hdGgiLCJhYnMiLCJtb2RlbFRvVmlld0RlbHRhWCIsIndpZHRoIiwibW9kZWxUb1ZpZXdEZWx0YVkiLCJoZWlnaHQiLCJmaWxsIiwic3Ryb2tlIiwibWl0ZXJMaW1pdCIsImFkZENoaWxkIiwibW9kZWxUb1ZpZXdTaGFwZSIsIm1vZGVsU2hhcGUiLCJsaW5lV2lkdGgiLCJjbG91ZEVuYWJsZWRPYnNlcnZlciIsImVuYWJsZWQiLCJ2aXNpYmxlIiwiZW5hYmxlZFByb3BlcnR5IiwibGluayIsImRpc3Bvc2VDbG91ZE5vZGUiLCJ1bmxpbmsiLCJjaXJjbGVTaGFwZXMiLCJkcmF3bldpZHRoIiwibGVmdEJvdW5kIiwieCIsInJpZ2h0Qm91bmQiLCJjaXJjbGVNaW5pbXVtUmFkaXVzIiwiY2lyY2xlTWF4aW11bVJhZGl1cyIsImFyY0NlbnRlclgiLCJhZGp1c3RlZFJlZmVyZW5jZUNlbnRlclkiLCJ5IiwibWF4WVNoaWZ0IiwiZmlyc3RDaXJjbGVSYWRpdXMiLCJwcm9wb3J0aW9uRHJhd24iLCJtaW5BcmNSYWRpdXMiLCJtYXhBcmNSYWRpdXMiLCJyZWR1Y3Rpb25NdWx0aXBsaWVyIiwiYXJjUmFkaXVzIiwibmV4dERvdWJsZUJldHdlZW4iLCJsZW5ndGgiLCJhcmNDZW50ZXJZIiwiY2lyY2xlU2hhcGUiLCJhcmMiLCJQSSIsInB1c2giLCJ1bmlvbiIsImRpc3Bvc2UiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNsb3VkTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBOb2RlIGZvciBhIENsb3VkIGluIHRoZSBHcmVlbmhvdXNlIEVmZmVjdCBzaW11bGF0aW9uLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBKb2huIEJsYW5jbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgZG90UmFuZG9tIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9kb3RSYW5kb20uanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgeyBDb2xvciwgTm9kZSwgTm9kZU9wdGlvbnMsIFBhdGggfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZ3JlZW5ob3VzZUVmZmVjdCBmcm9tICcuLi8uLi9ncmVlbmhvdXNlRWZmZWN0LmpzJztcclxuaW1wb3J0IENsb3VkIGZyb20gJy4uL21vZGVsL0Nsb3VkLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBDTE9VRF9GSUxMID0gbmV3IENvbG9yKCAyNTUsIDI1NSwgMjU1LCAwLjc1ICk7XHJcbmNvbnN0IENMT1VEX0JBQ0tHUk9VTkRfU1RST0tFID0gQ29sb3IuQkxBQ0s7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyB1c2VmdWwgZm9yIGRlYnVnZ2luZ1xyXG4gIHNob3dSZWZlcmVuY2VFbGxpcHNlPzogYm9vbGVhbjtcclxufTtcclxudHlwZSBDbG91ZE5vZGVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBOb2RlT3B0aW9ucztcclxuXHJcbmNsYXNzIENsb3VkTm9kZSBleHRlbmRzIE5vZGUge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZUNsb3VkTm9kZTogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBjbG91ZDogQ2xvdWQsIG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMiwgcHJvdmlkZWRPcHRpb25zPzogQ2xvdWROb2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPENsb3VkTm9kZU9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG4gICAgICBzaG93UmVmZXJlbmNlRWxsaXBzZTogZmFsc2VcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgY2xvdWRQYXRoID0gbmV3IFBhdGgoIENsb3VkTm9kZS5jcmVhdGVDbG91ZFNoYXBlKFxyXG4gICAgICBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggY2xvdWQucG9zaXRpb24gKSxcclxuICAgICAgTWF0aC5hYnMoIG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggY2xvdWQud2lkdGggKSApLFxyXG4gICAgICBNYXRoLmFicyggbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFZKCBjbG91ZC5oZWlnaHQgKSApXHJcbiAgICApLCB7XHJcbiAgICAgIGZpbGw6IENMT1VEX0ZJTEwsXHJcbiAgICAgIHN0cm9rZTogQ0xPVURfQkFDS0dST1VORF9TVFJPS0UsXHJcbiAgICAgIG1pdGVyTGltaXQ6IDFcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGNsb3VkUGF0aCApO1xyXG5cclxuICAgIC8vIElmIHNwZWNpZmllZCwgc2hvdyBhbiBlbGxpcHNlIHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIHN0cmljdCBtb2RlbCBzaGFwZSBvZiB0aGUgY2xvdWQuICBUaGlzIGlzIHVzZWZ1bCBmb3IgZGVidWcuXHJcbiAgICBpZiAoIG9wdGlvbnMuc2hvd1JlZmVyZW5jZUVsbGlwc2UgKSB7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIG5ldyBQYXRoKCBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdTaGFwZSggY2xvdWQubW9kZWxTaGFwZSApLCB7XHJcbiAgICAgICAgZmlsbDogbmV3IENvbG9yKCAyNTUsIDAsIDAsIDAuNSApLFxyXG4gICAgICAgIHN0cm9rZTogbmV3IENvbG9yKCAyNTUsIDAsIDAsIDAuOSApLFxyXG4gICAgICAgIGxpbmVXaWR0aDogM1xyXG4gICAgICB9ICkgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDb250cm9sIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBjbG91ZC5cclxuICAgIGNvbnN0IGNsb3VkRW5hYmxlZE9ic2VydmVyID0gKCBlbmFibGVkOiBib29sZWFuICkgPT4geyB0aGlzLnZpc2libGUgPSBlbmFibGVkO307XHJcbiAgICBjbG91ZC5lbmFibGVkUHJvcGVydHkubGluayggY2xvdWRFbmFibGVkT2JzZXJ2ZXIgKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VDbG91ZE5vZGUgPSAoKSA9PiB7XHJcbiAgICAgIGNsb3VkLmVuYWJsZWRQcm9wZXJ0eS51bmxpbmsoIGNsb3VkRW5hYmxlZE9ic2VydmVyICk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGEgYmxvYmJ5IGNsb3VkLWxpa2Ugc2hhcGUgdG8gcmVwcmVzZW50IHRoZSBjbG91ZC4gUmV0dXJucyBhIFNoYXBlIHRvIGJlIHVzZWQgd2l0aCBhIFBhdGguXHJcbiAgICpcclxuICAgKiBUT0RPOiBUaGlzIG1heSBiZSB0ZW1wb3JhcnksIHNpbmNlIHdlIG1heSBoYXZlIGFydHdvcmsgb3IgbWF5IHJlZmluZSB0aGUgbG9vayBvZiB0aGUgY2xvdWQgc29tZXRpbWUgaW4gdGhlIGZ1dHVyZS5cclxuICAgKiAgICAgICBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2dyZWVuaG91c2UtZWZmZWN0L2lzc3Vlcy80OS5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGNyZWF0ZUNsb3VkU2hhcGUoIHBvc2l0aW9uOiBWZWN0b3IyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciApOiBTaGFwZSB7XHJcblxyXG4gICAgY29uc3QgY2lyY2xlU2hhcGVzID0gW107XHJcbiAgICBsZXQgZHJhd25XaWR0aCA9IDA7XHJcbiAgICBjb25zdCBsZWZ0Qm91bmQgPSBwb3NpdGlvbi54IC0gd2lkdGggLyAyO1xyXG4gICAgY29uc3QgcmlnaHRCb3VuZCA9IHBvc2l0aW9uLnggKyB3aWR0aCAvIDI7XHJcblxyXG4gICAgLy8gbGltaXRzIGZvciBjaXJjbGUgc2l6ZXMsIGVtcGlyaWNhbGx5IGRldGVybWluZWRcclxuICAgIGNvbnN0IGNpcmNsZU1pbmltdW1SYWRpdXMgPSBoZWlnaHQgKiAwLjU7XHJcbiAgICBjb25zdCBjaXJjbGVNYXhpbXVtUmFkaXVzID0gaGVpZ2h0ICogMC43O1xyXG5cclxuICAgIC8vIGhvcml6b250YWwgcG9zaXRpb24gb2YgdGhlIGNpcmNsZSBiZWluZyBkcmF3biwgdXBkYXRlZCB3aXRoIGVhY2ggaXRlcmF0aW9uXHJcbiAgICBsZXQgYXJjQ2VudGVyWCA9IGxlZnRCb3VuZDtcclxuXHJcbiAgICAvLyBUaGUgdmVydGljYWwgcG9zaXRpb24gaXMgc2hpZnRlZCBkb3duIHNsaWdodGx5IHNvIHRoYXQgdGhlIGJvdHRvbSBvZiB0aGUgY2xvdWQgY2FuIGxvb2sgZmxhdCBhbmQgc3RpbGwgY29udGFpblxyXG4gICAgLy8gdGhlIGVsbGlwdGljYWwgc2hhcGUgdGhhdCBpcyB1c2VkIGluIHRoZSBtb2RlbC5cclxuICAgIGNvbnN0IGFkanVzdGVkUmVmZXJlbmNlQ2VudGVyWSA9IHBvc2l0aW9uLnkgKyBjaXJjbGVNYXhpbXVtUmFkaXVzICogMC4zO1xyXG5cclxuICAgIC8vIG1heCByYW5kb20gc2hpZnQgdXAgb3IgZG93biBpbiB0aGUgWSBkaXJlY3Rpb24sIGVtcGlyaWNhbGx5IGRldGVybWluZWRcclxuICAgIGNvbnN0IG1heFlTaGlmdCA9IGNpcmNsZU1heGltdW1SYWRpdXMgKiAwLjAyNTtcclxuXHJcbiAgICAvLyB1c2VkIHRvIGFsaWduIHRoZSBjaXJjbGVzXHJcbiAgICBsZXQgZmlyc3RDaXJjbGVSYWRpdXMgPSAwO1xyXG5cclxuICAgIC8vIEFkZCBhIHNldCBvZiBvdmVybGFwcGluZyBjaXJjbGVzIHdpdGggc29tZSByYW5kb21uZXNzIG9mIHNpemUgYW5kIHBvc2l0aW9uIHRvIGNyZWF0ZSB0aGUgY2xvdWQgc2hhcGUuXHJcbiAgICB3aGlsZSAoIGxlZnRCb3VuZCArIGRyYXduV2lkdGggPCByaWdodEJvdW5kICkge1xyXG5cclxuICAgICAgY29uc3QgcHJvcG9ydGlvbkRyYXduID0gZHJhd25XaWR0aCAvIHdpZHRoO1xyXG5cclxuICAgICAgLy8gVGhlIHJhZGl1cyBpcyByYW5kb20sIGJ1dCBsaW1pdGVkIGJ5IHRoZSBoZWlnaHQgYW5kIHRoZSBZIHBvc2l0aW9uIHdpdGhpbiB0aGUgY2xvdWQuICBUaGUgY2lyY2xlcyBvbiB0aGUgZW5kc1xyXG4gICAgICAvLyBhcmUgYSBsaXR0bGUgc21hbGxlciB0aGFuIHRob3NlIGluIHRoZSBtaWRkbGUuXHJcbiAgICAgIGxldCBtaW5BcmNSYWRpdXMgPSBjaXJjbGVNaW5pbXVtUmFkaXVzO1xyXG4gICAgICBsZXQgbWF4QXJjUmFkaXVzID0gY2lyY2xlTWF4aW11bVJhZGl1cztcclxuICAgICAgaWYgKCBwcm9wb3J0aW9uRHJhd24gPCAwLjI1ICkge1xyXG5cclxuICAgICAgICAvLyBUaGlzIGNpcmNsZSBpcyBvbiB0aGUgbGVmdCBzaWRlLCBzY2FsZSBpdCBkb3duIGEgYml0LlxyXG4gICAgICAgIGNvbnN0IHJlZHVjdGlvbk11bHRpcGxpZXIgPSAxIC0gMiAqICggMC4yNSAtIHByb3BvcnRpb25EcmF3biApO1xyXG4gICAgICAgIG1pbkFyY1JhZGl1cyA9IHJlZHVjdGlvbk11bHRpcGxpZXIgKiBtaW5BcmNSYWRpdXM7XHJcbiAgICAgICAgbWF4QXJjUmFkaXVzID0gcmVkdWN0aW9uTXVsdGlwbGllciAqIG1heEFyY1JhZGl1cztcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggcHJvcG9ydGlvbkRyYXduID4gMC43NSApIHtcclxuXHJcbiAgICAgICAgLy8gVGhpcyBjaXJjbGUgaXMgb24gdGhlIHJpZ2h0IHNpZGUsIHNjYWxlIGl0IGRvd24gYSBiaXQuXHJcbiAgICAgICAgY29uc3QgcmVkdWN0aW9uTXVsdGlwbGllciA9IDAuNSArIDIgKiAoIDEgLSBwcm9wb3J0aW9uRHJhd24gKTtcclxuICAgICAgICBtaW5BcmNSYWRpdXMgPSByZWR1Y3Rpb25NdWx0aXBsaWVyICogbWluQXJjUmFkaXVzO1xyXG4gICAgICAgIG1heEFyY1JhZGl1cyA9IHJlZHVjdGlvbk11bHRpcGxpZXIgKiBtYXhBcmNSYWRpdXM7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENob29zZSB0aGUgYXJjIHJhZGl1cyB1c2luZyByYW5kb21uZXNzIGFuZCB0aGUgY29uc3RyYWludHMgZGV0ZXJtaW5lZCBhYm92ZS5cclxuICAgICAgY29uc3QgYXJjUmFkaXVzID0gZG90UmFuZG9tLm5leHREb3VibGVCZXR3ZWVuKCBtaW5BcmNSYWRpdXMsIG1heEFyY1JhZGl1cyApO1xyXG5cclxuICAgICAgaWYgKCBjaXJjbGVTaGFwZXMubGVuZ3RoID09PSAwICkge1xyXG5cclxuICAgICAgICAvLyBLZWVwIHRyYWNrIG9mIHRoZSByYWRpdXMgb2YgdGhlIGZpcnN0IGNpcmNsZSBzbyB3ZSBjYW4gdXNlIGl0IGxhdGVyIHRvIGxpbmUgdGhpbmdzIHVwLlxyXG4gICAgICAgIGZpcnN0Q2lyY2xlUmFkaXVzID0gYXJjUmFkaXVzO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBhcmNDZW50ZXJYID0gYXJjQ2VudGVyWCArIGFyY1JhZGl1cztcclxuXHJcbiAgICAgIC8vIEFkanVzdCB0aGUgWSBwb3NpdGlvbiBzbyB0aGF0IHRoZSBib3R0b20gb2YgdGhlIGNsb3VkIGlzIG1vcmUgZmxhdCB0aGFuIHRoZSB0b3AuXHJcbiAgICAgIGNvbnN0IGFyY0NlbnRlclkgPSBmaXJzdENpcmNsZVJhZGl1cyA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBhZGp1c3RlZFJlZmVyZW5jZUNlbnRlclkgLSAoIGFyY1JhZGl1cyAtIGZpcnN0Q2lyY2xlUmFkaXVzICkgLSBkb3RSYW5kb20ubmV4dERvdWJsZUJldHdlZW4oIC1tYXhZU2hpZnQsIG1heFlTaGlmdCApIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgIGFkanVzdGVkUmVmZXJlbmNlQ2VudGVyWTtcclxuXHJcbiAgICAgIC8vIEFkZCB0aGlzIGNpcmNsZSB0byBvdXIgY29sbGVjdGlvbi5cclxuICAgICAgY29uc3QgY2lyY2xlU2hhcGUgPSBTaGFwZS5hcmMoIGFyY0NlbnRlclgsIGFyY0NlbnRlclksIGFyY1JhZGl1cywgMCwgMiAqIE1hdGguUEkgKTtcclxuICAgICAgY2lyY2xlU2hhcGVzLnB1c2goIGNpcmNsZVNoYXBlICk7XHJcblxyXG4gICAgICBkcmF3bldpZHRoID0gYXJjQ2VudGVyWCArIGFyY1JhZGl1cyAtIGxlZnRCb3VuZDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gU2hhcGUudW5pb24oIGNpcmNsZVNoYXBlcyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRnJlZSBtZW1vcnkgcmVmZXJlbmNlcyB0byBhdm9pZCBsZWFrcy5cclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZUNsb3VkTm9kZSgpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuZ3JlZW5ob3VzZUVmZmVjdC5yZWdpc3RlciggJ0Nsb3VkTm9kZScsIENsb3VkTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBDbG91ZE5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsU0FBUyxNQUFNLGlDQUFpQztBQUV2RCxTQUFTQyxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELE9BQU9DLFNBQVMsTUFBTSx1Q0FBdUM7QUFFN0QsU0FBU0MsS0FBSyxFQUFFQyxJQUFJLEVBQWVDLElBQUksUUFBUSxtQ0FBbUM7QUFDbEYsT0FBT0MsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBR3hEO0FBQ0EsTUFBTUMsVUFBVSxHQUFHLElBQUlKLEtBQUssQ0FBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFLLENBQUM7QUFDbkQsTUFBTUssdUJBQXVCLEdBQUdMLEtBQUssQ0FBQ00sS0FBSztBQVMzQyxNQUFNQyxTQUFTLFNBQVNOLElBQUksQ0FBQztFQUdwQk8sV0FBV0EsQ0FBRUMsS0FBWSxFQUFFQyxrQkFBdUMsRUFBRUMsZUFBa0MsRUFBRztJQUU5RyxNQUFNQyxPQUFPLEdBQUdiLFNBQVMsQ0FBNkMsQ0FBQyxDQUFFO01BQ3ZFYyxvQkFBb0IsRUFBRTtJQUN4QixDQUFDLEVBQUVGLGVBQWdCLENBQUM7SUFFcEIsS0FBSyxDQUFFQyxPQUFRLENBQUM7SUFFaEIsTUFBTUUsU0FBUyxHQUFHLElBQUlaLElBQUksQ0FBRUssU0FBUyxDQUFDUSxnQkFBZ0IsQ0FDcERMLGtCQUFrQixDQUFDTSxtQkFBbUIsQ0FB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