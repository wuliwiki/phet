// Copyright 2021-2022, University of Colorado Boulder

/**
 * Legend in GreenhouseEffect to show representations of sunlight and infrared energy.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 * @author John Blanco (PhET Interactive Simulations)
 */

import { Shape } from '../../../../kite/js/imports.js';
import Enumeration from '../../../../phet-core/js/Enumeration.js';
import EnumerationValue from '../../../../phet-core/js/EnumerationValue.js';
import optionize, { combineOptions } from '../../../../phet-core/js/optionize.js';
import { GridBox, Image, Path, Text, VBox } from '../../../../scenery/js/imports.js';
import Panel from '../../../../sun/js/Panel.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import infraredPhoton_png from '../../../images/infraredPhoton_png.js';
import visiblePhoton_png from '../../../images/visiblePhoton_png.js';
import greenhouseEffect from '../../greenhouseEffect.js';
import GreenhouseEffectStrings from '../../GreenhouseEffectStrings.js';
import GreenhouseEffectColors from '../GreenhouseEffectColors.js';
import GreenhouseEffectConstants from '../GreenhouseEffectConstants.js';

// constants
const WAVE_ICON_AMPLITUDE = 7;
const MAX_PHOTON_WIDTH = 15;

// An empirically determined value for the size of the label-icon portion of the panel, used to keep the alignment
// consistent between the wave and photon versions of this legend.
const TOTAL_LEGEND_AREA_HEIGHT = 45;

// margin for panel contents
const PANEL_MARGIN = 8;

// The legend can display photon or wave representation of energy, see energyRepresentation option
class EnergyRepresentation extends EnumerationValue {
  static PHOTON = new EnergyRepresentation();
  static WAVE = new EnergyRepresentation();
  static enumeration = new Enumeration(EnergyRepresentation);
}
class EnergyLegend extends Panel {
  /**
   * @param width - width of the legend, it needs to be wider than its contents for layout in screen view
   * @param [providedOptions]
   */
  constructor(width, providedOptions) {
    const options = optionize()({
      // the energy icons will either display a photon or wave, depending on this option
      energyRepresentation: EnergyRepresentation.PHOTON,
      // Panel options
      fill: GreenhouseEffectColors.energyLegendBackgroundColorProperty,
      minWidth: width,
      xMargin: PANEL_MARGIN,
      yMargin: PANEL_MARGIN,
      // pdom
      tagName: 'div',
      labelTagName: 'h3',
      labelContent: GreenhouseEffectStrings.a11y.energyLegend.titleStringProperty,
      descriptionTagName: 'p',
      descriptionContent: GreenhouseEffectStrings.a11y.energyLegend.inObservationWindowStringProperty,
      // phet-io
      tandem: Tandem.REQUIRED
    }, providedOptions);

    // title
    const titleText = new Text(GreenhouseEffectStrings.energyLegend.titleStringProperty, {
      font: GreenhouseEffectConstants.TITLE_FONT,
      fill: 'white',
      maxWidth: width - 2 * PANEL_MARGIN,
      tandem: options.tandem.createTandem('titleText')
    });

    // options for legend labels
    const labelOptions = {
      font: GreenhouseEffectConstants.LABEL_FONT,
      fill: 'white',
      maxWidth: width * 0.75
    };

    // labels
    const sunlightLabelText = new Text(GreenhouseEffectStrings.sunlightStringProperty, combineOptions({}, labelOptions, {
      tandem: options.tandem.createTandem('sunlightLabelText')
    }));
    const infraredLabelText = new Text(GreenhouseEffectStrings.infraredStringProperty, combineOptions({}, labelOptions, {
      tandem: options.tandem.createTandem('infraredLabelText')
    }));

    // create the icons
    let sunlightIcon;
    let infraredIcon;
    if (options.energyRepresentation === EnergyRepresentation.WAVE) {
      const sunlightWavelength = 15;
      const sunlightWavelengths = 3.5;
      const infraredWavelengths = 2.5;
      sunlightIcon = createWaveIcon(sunlightWavelength, sunlightWavelengths, {
        stroke: GreenhouseEffectColors.sunlightColorProperty
      });
      infraredIcon = createWaveIcon(sunlightWavelength * sunlightWavelengths / infraredWavelengths, infraredWavelengths, {
        stroke: GreenhouseEffectColors.infraredColorProperty
      });
    } else {
      const photonIconOptions = {
        maxWidth: MAX_PHOTON_WIDTH
      };
      sunlightIcon = new Image(visiblePhoton_png, photonIconOptions);
      infraredIcon = new Image(infraredPhoton_png, photonIconOptions);
    }

    // Calculate the vertical spacing for the grid box in a way that will keep it consistent between the wave and photon
    // representations.
    const gridBoxYSpacing = TOTAL_LEGEND_AREA_HEIGHT - Math.max(sunlightLabelText.height, sunlightIcon.height) - Math.max(infraredLabelText.height, infraredIcon.height);
    assert && assert(gridBoxYSpacing >= 0, 'insufficient space for legend area');

    // Create a grid box to align the labels and the icons that represent the different light wavelengths.
    const gridBox = new GridBox({
      rows: [[sunlightLabelText, sunlightIcon], [infraredLabelText, infraredIcon]],
      xSpacing: 8,
      ySpacing: gridBoxYSpacing,
      layoutOptions: {
        align: 'left'
      },
      xAlign: 'right',
      yAlign: 'center',
      maxWidth: width - PANEL_MARGIN * 2
    });
    const content = new VBox({
      spacing: 7,
      children: [titleText, gridBox],
      // pdom
      tagName: 'ul'
    });
    super(content, options);
  }

  // static values
  static EnergyRepresentation = EnergyRepresentation;
}

/**
 * Creates a wave icon for the legend.
 * @param wavelength - wavelength for the wave icon in view coordinates
 * @param wavelengthsToDraw - how many wavelengths to draw for the icon
 * @param [options] - options for the wave Path
 */
const createWaveIcon = (wavelength, wavelengthsToDraw, options) => {
  options = combineOptions({
    lineWidth: 1.5
  }, options);
  const iconLength = wavelength * wavelengthsToDraw;
  const wavelengthRadians = wavelength / (Math.PI * 2);
  const numberOfWavePoints = 100;
  const waveShape = new Shape();
  waveShape.moveTo(0, -Math.cos(0) * WAVE_ICON_AMPLITUDE);
  for (let x = 0; x < iconLength; x += iconLength / numberOfWavePoints) {
    waveShape.lineTo(x, -Math.cos(x / wavelengthRadians) * WAVE_ICON_AMPLITUDE);
  }
  return new Path(waveShape, options);
};
greenhouseEffect.register('EnergyLegend', EnergyLegend);
export default EnergyLegend;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaGFwZSIsIkVudW1lcmF0aW9uIiwiRW51bWVyYXRpb25WYWx1ZSIsIm9wdGlvbml6ZSIsImNvbWJpbmVPcHRpb25zIiwiR3JpZEJveCIsIkltYWdlIiwiUGF0aCIsIlRleHQiLCJWQm94IiwiUGFuZWwiLCJUYW5kZW0iLCJpbmZyYXJlZFBob3Rvbl9wbmciLCJ2aXNpYmxlUGhvdG9uX3BuZyIsImdyZWVuaG91c2VFZmZlY3QiLCJHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncyIsIkdyZWVuaG91c2VFZmZlY3RDb2xvcnMiLCJHcmVlbmhvdXNlRWZmZWN0Q29uc3RhbnRzIiwiV0FWRV9JQ09OX0FNUExJVFVERSIsIk1BWF9QSE9UT05fV0lEVEgiLCJUT1RBTF9MRUdFTkRfQVJFQV9IRUlHSFQiLCJQQU5FTF9NQVJHSU4iLCJFbmVyZ3lSZXByZXNlbnRhdGlvbiIsIlBIT1RPTiIsIldBVkUiLCJlbnVtZXJhdGlvbiIsIkVuZXJneUxlZ2VuZCIsImNvbnN0cnVjdG9yIiwid2lkdGgiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiZW5lcmd5UmVwcmVzZW50YXRpb24iLCJmaWxsIiwiZW5lcmd5TGVnZW5kQmFja2dyb3VuZENvbG9yUHJvcGVydHkiLCJtaW5XaWR0aCIsInhNYXJnaW4iLCJ5TWFyZ2luIiwidGFnTmFtZSIsImxhYmVsVGFnTmFtZSIsImxhYmVsQ29udGVudCIsImExMXkiLCJlbmVyZ3lMZWdlbmQiLCJ0aXRsZVN0cmluZ1Byb3BlcnR5IiwiZGVzY3JpcHRpb25UYWdOYW1lIiwiZGVzY3JpcHRpb25Db250ZW50IiwiaW5PYnNlcnZhdGlvbldpbmRvd1N0cmluZ1Byb3BlcnR5IiwidGFuZGVtIiwiUkVRVUlSRUQiLCJ0aXRsZVRleHQiLCJmb250IiwiVElUTEVfRk9OVCIsIm1heFdpZHRoIiwiY3JlYXRlVGFuZGVtIiwibGFiZWxPcHRpb25zIiwiTEFCRUxfRk9OVCIsInN1bmxpZ2h0TGFiZWxUZXh0Iiwic3VubGlnaHRTdHJpbmdQcm9wZXJ0eSIsImluZnJhcmVkTGFiZWxUZXh0IiwiaW5mcmFyZWRTdHJpbmdQcm9wZXJ0eSIsInN1bmxpZ2h0SWNvbiIsImluZnJhcmVkSWNvbiIsInN1bmxpZ2h0V2F2ZWxlbmd0aCIsInN1bmxpZ2h0V2F2ZWxlbmd0aHMiLCJpbmZyYXJlZFdhdmVsZW5ndGhzIiwiY3JlYXRlV2F2ZUljb24iLCJzdHJva2UiLCJzdW5saWdodENvbG9yUHJvcGVydHkiLCJpbmZyYXJlZENvbG9yUHJvcGVydHkiLCJwaG90b25JY29uT3B0aW9ucyIsImdyaWRCb3hZU3BhY2luZyIsIk1hdGgiLCJtYXgiLCJoZWlnaHQiLCJhc3NlcnQiLCJncmlkQm94Iiwicm93cyIsInhTcGFjaW5nIiwieVNwYWNpbmciLCJsYXlvdXRPcHRpb25zIiwiYWxpZ24iLCJ4QWxpZ24iLCJ5QWxpZ24iLCJjb250ZW50Iiwic3BhY2luZyIsImNoaWxkcmVuIiwid2F2ZWxlbmd0aCIsIndhdmVsZW5ndGhzVG9EcmF3IiwibGluZVdpZHRoIiwiaWNvbkxlbmd0aCIsIndhdmVsZW5ndGhSYWRpYW5zIiwiUEkiLCJudW1iZXJPZldhdmVQb2ludHMiLCJ3YXZlU2hhcGUiLCJtb3ZlVG8iLCJjb3MiLCJ4IiwibGluZVRvIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJFbmVyZ3lMZWdlbmQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjEtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogTGVnZW5kIGluIEdyZWVuaG91c2VFZmZlY3QgdG8gc2hvdyByZXByZXNlbnRhdGlvbnMgb2Ygc3VubGlnaHQgYW5kIGluZnJhcmVkIGVuZXJneS5cclxuICpcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmcgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgRW51bWVyYXRpb24gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL0VudW1lcmF0aW9uLmpzJztcclxuaW1wb3J0IEVudW1lcmF0aW9uVmFsdWUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL0VudW1lcmF0aW9uVmFsdWUuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCB7IEdyaWRCb3gsIEltYWdlLCBQYXRoLCBQYXRoT3B0aW9ucywgVGV4dCwgVGV4dE9wdGlvbnMsIFZCb3ggfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUGFuZWwsIHsgUGFuZWxPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL1BhbmVsLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IGluZnJhcmVkUGhvdG9uX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvaW5mcmFyZWRQaG90b25fcG5nLmpzJztcclxuaW1wb3J0IHZpc2libGVQaG90b25fcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy92aXNpYmxlUGhvdG9uX3BuZy5qcyc7XHJcbmltcG9ydCBncmVlbmhvdXNlRWZmZWN0IGZyb20gJy4uLy4uL2dyZWVuaG91c2VFZmZlY3QuanMnO1xyXG5pbXBvcnQgR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MgZnJvbSAnLi4vLi4vR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuanMnO1xyXG5pbXBvcnQgR3JlZW5ob3VzZUVmZmVjdENvbG9ycyBmcm9tICcuLi9HcmVlbmhvdXNlRWZmZWN0Q29sb3JzLmpzJztcclxuaW1wb3J0IEdyZWVuaG91c2VFZmZlY3RDb25zdGFudHMgZnJvbSAnLi4vR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgV0FWRV9JQ09OX0FNUExJVFVERSA9IDc7XHJcbmNvbnN0IE1BWF9QSE9UT05fV0lEVEggPSAxNTtcclxuXHJcbi8vIEFuIGVtcGlyaWNhbGx5IGRldGVybWluZWQgdmFsdWUgZm9yIHRoZSBzaXplIG9mIHRoZSBsYWJlbC1pY29uIHBvcnRpb24gb2YgdGhlIHBhbmVsLCB1c2VkIHRvIGtlZXAgdGhlIGFsaWdubWVudFxyXG4vLyBjb25zaXN0ZW50IGJldHdlZW4gdGhlIHdhdmUgYW5kIHBob3RvbiB2ZXJzaW9ucyBvZiB0aGlzIGxlZ2VuZC5cclxuY29uc3QgVE9UQUxfTEVHRU5EX0FSRUFfSEVJR0hUID0gNDU7XHJcblxyXG4vLyBtYXJnaW4gZm9yIHBhbmVsIGNvbnRlbnRzXHJcbmNvbnN0IFBBTkVMX01BUkdJTiA9IDg7XHJcblxyXG4vLyBUaGUgbGVnZW5kIGNhbiBkaXNwbGF5IHBob3RvbiBvciB3YXZlIHJlcHJlc2VudGF0aW9uIG9mIGVuZXJneSwgc2VlIGVuZXJneVJlcHJlc2VudGF0aW9uIG9wdGlvblxyXG5jbGFzcyBFbmVyZ3lSZXByZXNlbnRhdGlvbiBleHRlbmRzIEVudW1lcmF0aW9uVmFsdWUge1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgUEhPVE9OID0gbmV3IEVuZXJneVJlcHJlc2VudGF0aW9uKCk7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBXQVZFID0gbmV3IEVuZXJneVJlcHJlc2VudGF0aW9uKCk7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBlbnVtZXJhdGlvbiA9IG5ldyBFbnVtZXJhdGlvbiggRW5lcmd5UmVwcmVzZW50YXRpb24gKTtcclxufVxyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICBlbmVyZ3lSZXByZXNlbnRhdGlvbj86IEVuZXJneVJlcHJlc2VudGF0aW9uO1xyXG59O1xyXG5leHBvcnQgdHlwZSBFbmVyZ3lMZWdlbmRPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBQYW5lbE9wdGlvbnM7XHJcblxyXG5jbGFzcyBFbmVyZ3lMZWdlbmQgZXh0ZW5kcyBQYW5lbCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB3aWR0aCAtIHdpZHRoIG9mIHRoZSBsZWdlbmQsIGl0IG5lZWRzIHRvIGJlIHdpZGVyIHRoYW4gaXRzIGNvbnRlbnRzIGZvciBsYXlvdXQgaW4gc2NyZWVuIHZpZXdcclxuICAgKiBAcGFyYW0gW3Byb3ZpZGVkT3B0aW9uc11cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHdpZHRoOiBudW1iZXIsIHByb3ZpZGVkT3B0aW9ucz86IEVuZXJneUxlZ2VuZE9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxFbmVyZ3lMZWdlbmRPcHRpb25zLCBTZWxmT3B0aW9ucywgUGFuZWxPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyB0aGUgZW5lcmd5IGljb25zIHdpbGwgZWl0aGVyIGRpc3BsYXkgYSBwaG90b24gb3Igd2F2ZSwgZGVwZW5kaW5nIG9uIHRoaXMgb3B0aW9uXHJcbiAgICAgIGVuZXJneVJlcHJlc2VudGF0aW9uOiBFbmVyZ3lSZXByZXNlbnRhdGlvbi5QSE9UT04sXHJcblxyXG4gICAgICAvLyBQYW5lbCBvcHRpb25zXHJcbiAgICAgIGZpbGw6IEdyZWVuaG91c2VFZmZlY3RDb2xvcnMuZW5lcmd5TGVnZW5kQmFja2dyb3VuZENvbG9yUHJvcGVydHksXHJcbiAgICAgIG1pbldpZHRoOiB3aWR0aCxcclxuICAgICAgeE1hcmdpbjogUEFORUxfTUFSR0lOLFxyXG4gICAgICB5TWFyZ2luOiBQQU5FTF9NQVJHSU4sXHJcblxyXG4gICAgICAvLyBwZG9tXHJcbiAgICAgIHRhZ05hbWU6ICdkaXYnLFxyXG4gICAgICBsYWJlbFRhZ05hbWU6ICdoMycsXHJcbiAgICAgIGxhYmVsQ29udGVudDogR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuYTExeS5lbmVyZ3lMZWdlbmQudGl0bGVTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgZGVzY3JpcHRpb25UYWdOYW1lOiAncCcsXHJcbiAgICAgIGRlc2NyaXB0aW9uQ29udGVudDogR3JlZW5ob3VzZUVmZmVjdFN0cmluZ3MuYTExeS5lbmVyZ3lMZWdlbmQuaW5PYnNlcnZhdGlvbldpbmRvd1N0cmluZ1Byb3BlcnR5LFxyXG5cclxuICAgICAgLy8gcGhldC1pb1xyXG4gICAgICB0YW5kZW06IFRhbmRlbS5SRVFVSVJFRFxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gdGl0bGVcclxuICAgIGNvbnN0IHRpdGxlVGV4dCA9IG5ldyBUZXh0KCBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5lbmVyZ3lMZWdlbmQudGl0bGVTdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICBmb250OiBHcmVlbmhvdXNlRWZmZWN0Q29uc3RhbnRzLlRJVExFX0ZPTlQsXHJcbiAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICAgIG1heFdpZHRoOiB3aWR0aCAtIDIgKiBQQU5FTF9NQVJHSU4sXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndGl0bGVUZXh0JyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gb3B0aW9ucyBmb3IgbGVnZW5kIGxhYmVsc1xyXG4gICAgY29uc3QgbGFiZWxPcHRpb25zID0ge1xyXG4gICAgICBmb250OiBHcmVlbmhvdXNlRWZmZWN0Q29uc3RhbnRzLkxBQkVMX0ZPTlQsXHJcbiAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICAgIG1heFdpZHRoOiB3aWR0aCAqIDAuNzVcclxuICAgIH07XHJcblxyXG4gICAgLy8gbGFiZWxzXHJcbiAgICBjb25zdCBzdW5saWdodExhYmVsVGV4dCA9IG5ldyBUZXh0KFxyXG4gICAgICBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5zdW5saWdodFN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBjb21iaW5lT3B0aW9uczxUZXh0T3B0aW9ucz4oIHt9LCBsYWJlbE9wdGlvbnMsIHsgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdzdW5saWdodExhYmVsVGV4dCcgKSB9IClcclxuICAgICk7XHJcbiAgICBjb25zdCBpbmZyYXJlZExhYmVsVGV4dCA9IG5ldyBUZXh0KFxyXG4gICAgICBHcmVlbmhvdXNlRWZmZWN0U3RyaW5ncy5pbmZyYXJlZFN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBjb21iaW5lT3B0aW9uczxUZXh0T3B0aW9ucz4oIHt9LCBsYWJlbE9wdGlvbnMsIHsgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdpbmZyYXJlZExhYmVsVGV4dCcgKSB9IClcclxuICAgICk7XHJcblxyXG4gICAgLy8gY3JlYXRlIHRoZSBpY29uc1xyXG4gICAgbGV0IHN1bmxpZ2h0SWNvbjtcclxuICAgIGxldCBpbmZyYXJlZEljb247XHJcbiAgICBpZiAoIG9wdGlvbnMuZW5lcmd5UmVwcmVzZW50YXRpb24gPT09IEVuZXJneVJlcHJlc2VudGF0aW9uLldBVkUgKSB7XHJcbiAgICAgIGNvbnN0IHN1bmxpZ2h0V2F2ZWxlbmd0aCA9IDE1O1xyXG4gICAgICBjb25zdCBzdW5saWdodFdhdmVsZW5ndGhzID0gMy41O1xyXG4gICAgICBjb25zdCBpbmZyYXJlZFdhdmVsZW5ndGhzID0gMi41O1xyXG4gICAgICBzdW5saWdodEljb24gPSBjcmVhdGVXYXZlSWNvbiggc3VubGlnaHRXYXZlbGVuZ3RoLCBzdW5saWdodFdhdmVsZW5ndGhzLCB7XHJcbiAgICAgICAgc3Ryb2tlOiBHcmVlbmhvdXNlRWZmZWN0Q29sb3JzLnN1bmxpZ2h0Q29sb3JQcm9wZXJ0eVxyXG4gICAgICB9ICk7XHJcbiAgICAgIGluZnJhcmVkSWNvbiA9IGNyZWF0ZVdhdmVJY29uKFxyXG4gICAgICAgIHN1bmxpZ2h0V2F2ZWxlbmd0aCAqIHN1bmxpZ2h0V2F2ZWxlbmd0aHMgLyBpbmZyYXJlZFdhdmVsZW5ndGhzLFxyXG4gICAgICAgIGluZnJhcmVkV2F2ZWxlbmd0aHMsXHJcbiAgICAgICAgeyBzdHJva2U6IEdyZWVuaG91c2VFZmZlY3RDb2xvcnMuaW5mcmFyZWRDb2xvclByb3BlcnR5IH1cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjb25zdCBwaG90b25JY29uT3B0aW9ucyA9IHsgbWF4V2lkdGg6IE1BWF9QSE9UT05fV0lEVEggfTtcclxuICAgICAgc3VubGlnaHRJY29uID0gbmV3IEltYWdlKCB2aXNpYmxlUGhvdG9uX3BuZywgcGhvdG9uSWNvbk9wdGlvbnMgKTtcclxuICAgICAgaW5mcmFyZWRJY29uID0gbmV3IEltYWdlKCBpbmZyYXJlZFBob3Rvbl9wbmcsIHBob3Rvbkljb25PcHRpb25zICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2FsY3VsYXRlIHRoZSB2ZXJ0aWNhbCBzcGFjaW5nIGZvciB0aGUgZ3JpZCBib3ggaW4gYSB3YXkgdGhhdCB3aWxsIGtlZXAgaXQgY29uc2lzdGVudCBiZXR3ZWVuIHRoZSB3YXZlIGFuZCBwaG90b25cclxuICAgIC8vIHJlcHJlc2VudGF0aW9ucy5cclxuICAgIGNvbnN0IGdyaWRCb3hZU3BhY2luZyA9IFRPVEFMX0xFR0VORF9BUkVBX0hFSUdIVCAtXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLm1heCggc3VubGlnaHRMYWJlbFRleHQuaGVpZ2h0LCBzdW5saWdodEljb24uaGVpZ2h0ICkgLVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5tYXgoIGluZnJhcmVkTGFiZWxUZXh0LmhlaWdodCwgaW5mcmFyZWRJY29uLmhlaWdodCApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGdyaWRCb3hZU3BhY2luZyA+PSAwLCAnaW5zdWZmaWNpZW50IHNwYWNlIGZvciBsZWdlbmQgYXJlYScgKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSBncmlkIGJveCB0byBhbGlnbiB0aGUgbGFiZWxzIGFuZCB0aGUgaWNvbnMgdGhhdCByZXByZXNlbnQgdGhlIGRpZmZlcmVudCBsaWdodCB3YXZlbGVuZ3Rocy5cclxuICAgIGNvbnN0IGdyaWRCb3ggPSBuZXcgR3JpZEJveCgge1xyXG4gICAgICByb3dzOiBbXHJcbiAgICAgICAgWyBzdW5saWdodExhYmVsVGV4dCwgc3VubGlnaHRJY29uIF0sXHJcbiAgICAgICAgWyBpbmZyYXJlZExhYmVsVGV4dCwgaW5mcmFyZWRJY29uIF1cclxuICAgICAgXSxcclxuICAgICAgeFNwYWNpbmc6IDgsXHJcbiAgICAgIHlTcGFjaW5nOiBncmlkQm94WVNwYWNpbmcsXHJcbiAgICAgIGxheW91dE9wdGlvbnM6IHtcclxuICAgICAgICBhbGlnbjogJ2xlZnQnXHJcbiAgICAgIH0sXHJcbiAgICAgIHhBbGlnbjogJ3JpZ2h0JyxcclxuICAgICAgeUFsaWduOiAnY2VudGVyJyxcclxuICAgICAgbWF4V2lkdGg6IHdpZHRoIC0gUEFORUxfTUFSR0lOICogMlxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGNvbnRlbnQgPSBuZXcgVkJveCgge1xyXG4gICAgICBzcGFjaW5nOiA3LFxyXG4gICAgICBjaGlsZHJlbjogWyB0aXRsZVRleHQsIGdyaWRCb3ggXSxcclxuXHJcbiAgICAgIC8vIHBkb21cclxuICAgICAgdGFnTmFtZTogJ3VsJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHN1cGVyKCBjb250ZW50LCBvcHRpb25zICk7XHJcbiAgfVxyXG5cclxuICAvLyBzdGF0aWMgdmFsdWVzXHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBFbmVyZ3lSZXByZXNlbnRhdGlvbiA9IEVuZXJneVJlcHJlc2VudGF0aW9uO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlcyBhIHdhdmUgaWNvbiBmb3IgdGhlIGxlZ2VuZC5cclxuICogQHBhcmFtIHdhdmVsZW5ndGggLSB3YXZlbGVuZ3RoIGZvciB0aGUgd2F2ZSBpY29uIGluIHZpZXcgY29vcmRpbmF0ZXNcclxuICogQHBhcmFtIHdhdmVsZW5ndGhzVG9EcmF3IC0gaG93IG1hbnkgd2F2ZWxlbmd0aHMgdG8gZHJhdyBmb3IgdGhlIGljb25cclxuICogQHBhcmFtIFtvcHRpb25zXSAtIG9wdGlvbnMgZm9yIHRoZSB3YXZlIFBhdGhcclxuICovXHJcbmNvbnN0IGNyZWF0ZVdhdmVJY29uID0gKCB3YXZlbGVuZ3RoOiBudW1iZXIsIHdhdmVsZW5ndGhzVG9EcmF3OiBudW1iZXIsIG9wdGlvbnM/OiBQYXRoT3B0aW9ucyApID0+IHtcclxuXHJcbiAgb3B0aW9ucyA9IGNvbWJpbmVPcHRpb25zPFBhdGhPcHRpb25zPigge1xyXG4gICAgbGluZVdpZHRoOiAxLjVcclxuICB9LCBvcHRpb25zICk7XHJcblxyXG4gIGNvbnN0IGljb25MZW5ndGggPSB3YXZlbGVuZ3RoICogd2F2ZWxlbmd0aHNUb0RyYXc7XHJcbiAgY29uc3Qgd2F2ZWxlbmd0aFJhZGlhbnMgPSB3YXZlbGVuZ3RoIC8gKCBNYXRoLlBJICogMiApO1xyXG5cclxuICBjb25zdCBudW1iZXJPZldhdmVQb2ludHMgPSAxMDA7XHJcbiAgY29uc3Qgd2F2ZVNoYXBlID0gbmV3IFNoYXBlKCk7XHJcbiAgd2F2ZVNoYXBlLm1vdmVUbyggMCwgLU1hdGguY29zKCAwICkgKiBXQVZFX0lDT05fQU1QTElUVURFICk7XHJcbiAgZm9yICggbGV0IHggPSAwOyB4IDwgaWNvbkxlbmd0aDsgeCArPSBpY29uTGVuZ3RoIC8gbnVtYmVyT2ZXYXZlUG9pbnRzICkge1xyXG4gICAgd2F2ZVNoYXBlLmxpbmVUbyggeCwgLU1hdGguY29zKCB4IC8gd2F2ZWxlbmd0aFJhZGlhbnMgKSAqIFdBVkVfSUNPTl9BTVBMSVRVREUgKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBuZXcgUGF0aCggd2F2ZVNoYXBlLCBvcHRpb25zICk7XHJcbn07XHJcblxyXG5ncmVlbmhvdXNlRWZmZWN0LnJlZ2lzdGVyKCAnRW5lcmd5TGVnZW5kJywgRW5lcmd5TGVnZW5kICk7XHJcbmV4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