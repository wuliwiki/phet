// Copyright 2021-2022, University of Colorado Boulder

/**
 * The LayersModel of GreenhouseEffect is a superclass for several of the sim screens. It is responsible for creating
 * and managing the layers that absorb and radiate heat, thus modeling the capture of heat energy in Earth's atmosphere.
 *
 * @author John Blanco (PhET Interactive Simulations)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import EnumerationProperty from '../../../../axon/js/EnumerationProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Range from '../../../../dot/js/Range.js';
import optionize, { combineOptions } from '../../../../phet-core/js/optionize.js';
import ArrayIO from '../../../../tandem/js/types/ArrayIO.js';
import IOType from '../../../../tandem/js/types/IOType.js';
import greenhouseEffect from '../../greenhouseEffect.js';
import GreenhouseEffectConstants from '../GreenhouseEffectConstants.js';
import GreenhouseEffectQueryParameters from '../GreenhouseEffectQueryParameters.js';
import GreenhouseEffectUtils from '../GreenhouseEffectUtils.js';
import AtmosphereLayer from './AtmosphereLayer.js';
import EMEnergyPacket from './EMEnergyPacket.js';
import EnergyAbsorbingEmittingLayer from './EnergyAbsorbingEmittingLayer.js';
import FluxMeter from './FluxMeter.js';
import GreenhouseEffectModel from './GreenhouseEffectModel.js';
import GroundLayer from './GroundLayer.js';
import SpaceEnergySink from './SpaceEnergySink.js';
import SunEnergySource from './SunEnergySource.js';
import TemperatureUnits from './TemperatureUnits.js';

// constants
const HEIGHT_OF_ATMOSPHERE = 50000; // in meters
const DEFAULT_NUMBER_OF_ATMOSPHERE_LAYERS = 12; // empirically determined to give us good behavior for temperature and energy flux
const SUNLIGHT_SPAN = GreenhouseEffectConstants.SUNLIGHT_SPAN;
const MODEL_TIME_STEP = 1 / 60; // in seconds, originally derived from the most common animation frame rate
const RADIATIVE_BALANCE_THRESHOLD = 5; // in watts per square meter, empirically determined

// map used to set the default temperature units based on the value of a query parameter
const mapLetterToTemperatureUnits = new Map([['K', TemperatureUnits.KELVIN], ['C', TemperatureUnits.CELSIUS], ['F', TemperatureUnits.FAHRENHEIT]]);
const DEFAULT_TEMPERATURE_UNITS = mapLetterToTemperatureUnits.get(GreenhouseEffectQueryParameters.defaultTemperatureUnits);
class LayersModel extends GreenhouseEffectModel {
  // whether the amount of energy coming in from the sun matches that going back out to space, within a threshold

  // Net inflow of energy into the Earth at the top of the atmosphere.  When this is positive, more energy is coming
  // into the Earth than is leaving, so it should be heating up.  When negative, the Earth is releasing energy and
  // thus cooling down.
  // packets of electromagnetic energy that are moving up and down in the model
  // main energy source coming into the system
  // the energy-absorbing-and-emitting layers for the atmosphere
  // a cloud that may or may not be present, and that reflects sunlight if it is
  cloud = null;

  // model of the ground that absorbs energy, heats up, and radiates infrared energy

  // the endpoint where energy radiating from the top of the atmosphere goes

  // used to track how much stepping of the model needs to occur

  // model of a meter that can measure the energy flux moving through the atmosphere

  // whether the thermometer measuring surface temperature is visible

  // whether the "Energy Balance" display is visible

  // whether the glowing representation of surface temperature is visible

  // fields with self-explanatory names

  /**
   * @param [tandem]
   * @param [providedOptions]
   */
  constructor(tandem, providedOptions) {
    const options = optionize()({
      numberOfAtmosphereLayers: DEFAULT_NUMBER_OF_ATMOSPHERE_LAYERS,
      minimumGroundTemperature: GroundLayer.MINIMUM_EARTH_AT_NIGHT_TEMPERATURE,
      initialAtmosphereLayerAbsorptionProportion: 0,
      atmosphereLayersInitiallyActive: true,
      fluxMeterPresent: false,
      fluxMeterOptions: {}
    }, providedOptions);
    super(tandem, options);
    this.surfaceTemperatureKelvinProperty = new NumberProperty(0, {
      range: new Range(0, 520),
      units: 'K',
      tandem: tandem.createTandem('surfaceTemperatureKelvinProperty'),
      phetioReadOnly: true,
      phetioHighFrequency: true
    });
    this.surfaceTemperatureCelsiusProperty = new DerivedProperty([this.surfaceTemperatureKelvinProperty], GreenhouseEffectUtils.kelvinToCelsius);
    this.surfaceTemperatureFahrenheitProperty = new DerivedProperty([this.surfaceTemperatureKelvinProperty], GreenhouseEffectUtils.kelvinToFahrenheit);
    this.netInflowOfEnergyProperty = new NumberProperty(0, {
      tandem: tandem.createTandem('netInflowOfEnergyProperty'),
      phetioReadOnly: true
    });
    this.inRadiativeBalanceProperty = new BooleanProperty(true, {
      tandem: tandem.createTandem('inRadiativeBalanceProperty'),
      phetioReadOnly: true
    });
    assert && assert(DEFAULT_TEMPERATURE_UNITS, 'something is wrong with the default temperature units');
    this.temperatureUnitsProperty = new EnumerationProperty(DEFAULT_TEMPERATURE_UNITS, {
      tandem: tandem.createTandem('temperatureUnitsProperty')
    });
    this.surfaceThermometerVisibleProperty = new BooleanProperty(true, {
      tandem: tandem.createTandem('surfaceThermometerVisibleProperty')
    });
    this.energyBalanceVisibleProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('energyBalanceVisibleProperty')
    });
    this.surfaceTemperatureVisibleProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('surfaceTemperatureVisibleProperty')
    });
    this.fluxMeterVisibleProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('fluxMeterVisibleProperty')
    });
    this.emEnergyPackets = [];
    this.sunEnergySource = new SunEnergySource(EnergyAbsorbingEmittingLayer.SURFACE_AREA, this.emEnergyPackets, tandem.createTandem('sunEnergySource'));
    this.groundLayer = new GroundLayer(tandem.createTandem('groundLayer'), {
      minimumTemperature: options.minimumGroundTemperature
    });
    this.atmosphereLayers = [];
    const atmosphereLayersTandem = tandem.createTandem('atmosphereLayers');

    // The atmosphere layers are evenly spaced between the ground and the top of the atmosphere.
    const distanceBetweenAtmosphereLayers = HEIGHT_OF_ATMOSPHERE / (options.numberOfAtmosphereLayers + 1);

    // Add the atmosphere layers.  These MUST be added in order of increasing altitude, since other code assumes that
    // this is the case.
    _.times(options.numberOfAtmosphereLayers, index => {
      const atmosphereLayer = new AtmosphereLayer(distanceBetweenAtmosphereLayers * (index + 1), atmosphereLayersTandem.createTandem(`layer${index}`), {
        initiallyActive: options.atmosphereLayersInitiallyActive,
        initialEnergyAbsorptionProportion: options.initialAtmosphereLayerAbsorptionProportion
      });
      this.atmosphereLayers.push(atmosphereLayer);
    });

    // the endpoint where energy radiating from the top of the atmosphere goes
    this.outerSpace = new SpaceEnergySink(HEIGHT_OF_ATMOSPHERE, tandem.createTandem('outerSpace'));

    //  Create the model component for the FluxMeter if the options indicate that it should be present.
    if (options.fluxMeterPresent) {
      const fluxMeterOptions = combineOptions({
        tandem: tandem.createTandem('fluxMeter')
      }, options.fluxMeterOptions);
      this.fluxMeter = new FluxMeter(this.atmosphereLayers, fluxMeterOptions);
    } else {
      this.fluxMeter = null;
    }
    this.modelSteppingTime = 0;

    // Connect up the surface temperature property to that of the ground layer model element.
    this.groundLayer.temperatureProperty.link(groundTemperature => {
      this.surfaceTemperatureKelvinProperty.set(groundTemperature);
    });
  }
  stepModel(dt) {
    // Step the model components by a consistent dt in order to avoid instabilities in the layer interactions.  See
    // https://github.com/phetsims/greenhouse-effect/issues/48 for information on why this is necessary.
    this.modelSteppingTime += dt;
    while (this.modelSteppingTime >= MODEL_TIME_STEP) {
      // Add the energy produced by the sun to the system.
      this.sunEnergySource.produceEnergy(MODEL_TIME_STEP);

      // Step the energy packets, which causes them to move.
      this.emEnergyPackets.forEach(emEnergyPacket => {
        emEnergyPacket.step(MODEL_TIME_STEP);
      });

      // Check for interaction between the energy packets and ground, the atmosphere, clouds, and space.
      this.groundLayer.interactWithEnergy(this.emEnergyPackets, MODEL_TIME_STEP);
      this.atmosphereLayers.forEach(atmosphereLayer => {
        atmosphereLayer.interactWithEnergy(this.emEnergyPackets, MODEL_TIME_STEP);
      });
      if (this.cloud) {
        this.cloud.interactWithEnergy(this.emEnergyPackets, MODEL_TIME_STEP);
      }
      this.outerSpace.interactWithEnergy(this.emEnergyPackets, MODEL_TIME_STEP);

      // If the flux meter is present, have it measure the flux.
      if (this.fluxMeter) {
        this.fluxMeter.measureEnergyPacketFlux(this.emEnergyPackets, MODEL_TIME_STEP);
      }

      // Adjust remaining time for stepping the model.
      this.modelSteppingTime -= MODEL_TIME_STEP;
    }

    // Update the Property that tracks whether the system as a whole is in radiative balance.
    const energyGoingIntoSpace = this.outerSpace.incomingUpwardMovingEnergyRateTracker.energyRateProperty.value / EnergyAbsorbingEmittingLayer.SURFACE_AREA;
    const energyComingFromSun = this.sunEnergySource.getOutputEnergyRate();
    this.netInflowOfEnergyProperty.set(energyComingFromSun - energyGoingIntoSpace);
    this.inRadiativeBalanceProperty.set(Math.abs(energyComingFromSun - energyGoingIntoSpace) < RADIATIVE_BALANCE_THRESHOLD);
    super.stepModel(dt);
  }

  /**
   * Find a layer, if there is one, that would be crossed by an object traveling from the start altitude to the end
   * altitude.  If there are none, null is returned.  If there are several, the first one that would be crossed is
   * returned.
   *
   * Comparisons are exclusive for the first altitude, inclusive for the second.  See the code for details.
   *
   * This is intended to be pretty efficient, hence the use of regular 'for' loops and 'break' statements.
   */
  findCrossedAtmosphereLayer(startAltitude, endAltitude) {
    let crossedLayer = null;
    if (startAltitude < endAltitude) {
      for (let i = 0; i < this.atmosphereLayers.length; i++) {
        const atmosphereLayer = this.atmosphereLayers[i];
        if (atmosphereLayer.isActiveProperty.value && startAltitude < atmosphereLayer.altitude && endAltitude >= atmosphereLayer.altitude) {
          crossedLayer = atmosphereLayer;
          break;
        }
      }
    } else if (startAltitude > endAltitude) {
      for (let i = this.atmosphereLayers.length - 1; i >= 0; i--) {
        const atmosphereLayer = this.atmosphereLayers[i];
        if (atmosphereLayer.isActiveProperty.value && startAltitude > atmosphereLayer.altitude && endAltitude <= atmosphereLayer.altitude) {
          crossedLayer = atmosphereLayer;
          break;
        }
      }
    }
    return crossedLayer;
  }

  /**
   * Getter method that is true when infrared radiation is present.
   * TODO: Should this actually be implemented in subclasses and actually test for the presence of IR?
   */
  isInfraredPresent() {
    return this.groundLayer.temperatureProperty.value > this.groundLayer.minimumTemperature;
  }

  /**
   * Resets all aspects of the model.
   */
  reset() {
    super.reset();
    this.netInflowOfEnergyProperty.reset();
    this.fluxMeterVisibleProperty.reset();
    this.energyBalanceVisibleProperty.reset();
    this.surfaceThermometerVisibleProperty.reset();
    this.temperatureUnitsProperty.reset();
    this.sunEnergySource.reset();
    this.groundLayer.reset();
    this.atmosphereLayers.forEach(atmosphereLayer => {
      atmosphereLayer.reset();
    });
    this.emEnergyPackets.length = 0;
    if (this.fluxMeter) {
      this.fluxMeter.reset();
    }
  }

  /**
   * for phet-io
   */
  toStateObject() {
    return {
      emEnergyPackets: ArrayIO(EMEnergyPacket.EMEnergyPacketIO).toStateObject(this.emEnergyPackets)
    };
  }

  /**
   * for phet-io
   */
  applyState(stateObject) {
    // Other objects have a reference to the energy packets, so we don't want to overwrite it.  Instead, clear it, then
    // copy in the contents of the state object.
    this.emEnergyPackets.length = 0;
    this.emEnergyPackets.push(...ArrayIO(EMEnergyPacket.EMEnergyPacketIO).fromStateObject(stateObject.emEnergyPackets));
  }

  /**
   * Returns a map of state keys and their associated IOTypes, see IOType for details.
   */
  static STATE_SCHEMA = {
    emEnergyPackets: ArrayIO(EMEnergyPacket.EMEnergyPacketIO)
  };

  // statics
  static HEIGHT_OF_ATMOSPHERE = HEIGHT_OF_ATMOSPHERE;
  static SUNLIGHT_SPAN = SUNLIGHT_SPAN;
  static RADIATIVE_BALANCE_THRESHOLD = RADIATIVE_BALANCE_THRESHOLD;

  /**
   * LayersModelIO handles PhET-iO serialization of the LayersModel. Because serialization involves accessing private
   * members, it delegates to LayersModel. The methods that LayersModelIO overrides are typical of 'Dynamic element
   * serialization', as described in the Serialization section of
   * https://github.com/phetsims/phet-io/blob/master/doc/phet-io-instrumentation-technical-guide.md#serialization
   */
  static LayersModelIO = new IOType('LayersModelIO', {
    valueType: LayersModel,
    stateSchema: LayersModel.STATE_SCHEMA,
    toStateObject: layersModel => layersModel.toStateObject(),
    applyState: (layersModel, stateObject) => layersModel.applyState(stateObject)
  });
}
greenhouseEffect.register('LayersModel', LayersModel);
export default LayersModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJFbnVtZXJhdGlvblByb3BlcnR5IiwiTnVtYmVyUHJvcGVydHkiLCJSYW5nZSIsIm9wdGlvbml6ZSIsImNvbWJpbmVPcHRpb25zIiwiQXJyYXlJTyIsIklPVHlwZSIsImdyZWVuaG91c2VFZmZlY3QiLCJHcmVlbmhvdXNlRWZmZWN0Q29uc3RhbnRzIiwiR3JlZW5ob3VzZUVmZmVjdFF1ZXJ5UGFyYW1ldGVycyIsIkdyZWVuaG91c2VFZmZlY3RVdGlscyIsIkF0bW9zcGhlcmVMYXllciIsIkVNRW5lcmd5UGFja2V0IiwiRW5lcmd5QWJzb3JiaW5nRW1pdHRpbmdMYXllciIsIkZsdXhNZXRlciIsIkdyZWVuaG91c2VFZmZlY3RNb2RlbCIsIkdyb3VuZExheWVyIiwiU3BhY2VFbmVyZ3lTaW5rIiwiU3VuRW5lcmd5U291cmNlIiwiVGVtcGVyYXR1cmVVbml0cyIsIkhFSUdIVF9PRl9BVE1PU1BIRVJFIiwiREVGQVVMVF9OVU1CRVJfT0ZfQVRNT1NQSEVSRV9MQVlFUlMiLCJTVU5MSUdIVF9TUEFOIiwiTU9ERUxfVElNRV9TVEVQIiwiUkFESUFUSVZFX0JBTEFOQ0VfVEhSRVNIT0xEIiwibWFwTGV0dGVyVG9UZW1wZXJhdHVyZVVuaXRzIiwiTWFwIiwiS0VMVklOIiwiQ0VMU0lVUyIsIkZBSFJFTkhFSVQiLCJERUZBVUxUX1RFTVBFUkFUVVJFX1VOSVRTIiwiZ2V0IiwiZGVmYXVsdFRlbXBlcmF0dXJlVW5pdHMiLCJMYXllcnNNb2RlbCIsImNsb3VkIiwiY29uc3RydWN0b3IiLCJ0YW5kZW0iLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwibnVtYmVyT2ZBdG1vc3BoZXJlTGF5ZXJzIiwibWluaW11bUdyb3VuZFRlbXBlcmF0dXJlIiwiTUlOSU1VTV9FQVJUSF9BVF9OSUdIVF9URU1QRVJBVFVSRSIsImluaXRpYWxBdG1vc3BoZXJlTGF5ZXJBYnNvcnB0aW9uUHJvcG9ydGlvbiIsImF0bW9zcGhlcmVMYXllcnNJbml0aWFsbHlBY3RpdmUiLCJmbHV4TWV0ZXJQcmVzZW50IiwiZmx1eE1ldGVyT3B0aW9ucyIsInN1cmZhY2VUZW1wZXJhdHVyZUtlbHZpblByb3BlcnR5IiwicmFuZ2UiLCJ1bml0cyIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb1JlYWRPbmx5IiwicGhldGlvSGlnaEZyZXF1ZW5jeSIsInN1cmZhY2VUZW1wZXJhdHVyZUNlbHNpdXNQcm9wZXJ0eSIsImtlbHZpblRvQ2Vsc2l1cyIsInN1cmZhY2VUZW1wZXJhdHVyZUZhaHJlbmhlaXRQcm9wZXJ0eSIsImtlbHZpblRvRmFocmVuaGVpdCIsIm5ldEluZmxvd09mRW5lcmd5UHJvcGVydHkiLCJpblJhZGlhdGl2ZUJhbGFuY2VQcm9wZXJ0eSIsImFzc2VydCIsInRlbXBlcmF0dXJlVW5pdHNQcm9wZXJ0eSIsInN1cmZhY2VUaGVybW9tZXRlclZpc2libGVQcm9wZXJ0eSIsImVuZXJneUJhbGFuY2VWaXNpYmxlUHJvcGVydHkiLCJzdXJmYWNlVGVtcGVyYXR1cmVWaXNpYmxlUHJvcGVydHkiLCJmbHV4TWV0ZXJWaXNpYmxlUHJvcGVydHkiLCJlbUVuZXJneVBhY2tldHMiLCJzdW5FbmVyZ3lTb3VyY2UiLCJTVVJGQUNFX0FSRUEiLCJncm91bmRMYXllciIsIm1pbmltdW1UZW1wZXJhdHVyZSIsImF0bW9zcGhlcmVMYXllcnMiLCJhdG1vc3BoZXJlTGF5ZXJzVGFuZGVtIiwiZGlzdGFuY2VCZXR3ZWVuQXRtb3NwaGVyZUxheWVycyIsIl8iLCJ0aW1lcyIsImluZGV4IiwiYXRtb3NwaGVyZUxheWVyIiwiaW5pdGlhbGx5QWN0aXZlIiwiaW5pdGlhbEVuZXJneUFic29ycHRpb25Qcm9wb3J0aW9uIiwicHVzaCIsIm91dGVyU3BhY2UiLCJmbHV4TWV0ZXIiLCJtb2RlbFN0ZXBwaW5nVGltZSIsInRlbXBlcmF0dXJlUHJvcGVydHkiLCJsaW5rIiwiZ3JvdW5kVGVtcGVyYXR1cmUiLCJzZXQiLCJzdGVwTW9kZWwiLCJkdCIsInByb2R1Y2VFbmVyZ3kiLCJmb3JFYWNoIiwiZW1FbmVyZ3lQYWNrZXQiLCJzdGVwIiwiaW50ZXJhY3RXaXRoRW5lcmd5IiwibWVhc3VyZUVuZXJneVBhY2tldEZsdXgiLCJlbmVyZ3lHb2luZ0ludG9TcGFjZSIsImluY29taW5nVXB3YXJkTW92aW5nRW5lcmd5UmF0ZVRyYWNrZXIiLCJlbmVyZ3lSYXRlUHJvcGVydHkiLCJ2YWx1ZSIsImVuZXJneUNvbWluZ0Zyb21TdW4iLCJnZXRPdXRwdXRFbmVyZ3lSYXRlIiwiTWF0aCIsImFicyIsImZpbmRDcm9zc2VkQXRtb3NwaGVyZUxheWVyIiwic3RhcnRBbHRpdHVkZSIsImVuZEFsdGl0dWRlIiwiY3Jvc3NlZExheWVyIiwiaSIsImxlbmd0aCIsImlzQWN0aXZlUHJvcGVydHkiLCJhbHRpdHVkZSIsImlzSW5mcmFyZWRQcmVzZW50IiwicmVzZXQiLCJ0b1N0YXRlT2JqZWN0IiwiRU1FbmVyZ3lQYWNrZXRJTyIsImFwcGx5U3RhdGUiLCJzdGF0ZU9iamVjdCIsImZyb21TdGF0ZU9iamVjdCIsIlNUQVRFX1NDSEVNQSIsIkxheWVyc01vZGVsSU8iLCJ2YWx1ZVR5cGUiLCJzdGF0ZVNjaGVtYSIsImxheWVyc01vZGVsIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJMYXllcnNNb2RlbC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBUaGUgTGF5ZXJzTW9kZWwgb2YgR3JlZW5ob3VzZUVmZmVjdCBpcyBhIHN1cGVyY2xhc3MgZm9yIHNldmVyYWwgb2YgdGhlIHNpbSBzY3JlZW5zLiBJdCBpcyByZXNwb25zaWJsZSBmb3IgY3JlYXRpbmdcclxuICogYW5kIG1hbmFnaW5nIHRoZSBsYXllcnMgdGhhdCBhYnNvcmIgYW5kIHJhZGlhdGUgaGVhdCwgdGh1cyBtb2RlbGluZyB0aGUgY2FwdHVyZSBvZiBoZWF0IGVuZXJneSBpbiBFYXJ0aCdzIGF0bW9zcGhlcmUuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IEVudW1lcmF0aW9uUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbnVtZXJhdGlvblByb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBBcnJheUlPIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9BcnJheUlPLmpzJztcclxuaW1wb3J0IElPVHlwZSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvSU9UeXBlLmpzJztcclxuaW1wb3J0IGdyZWVuaG91c2VFZmZlY3QgZnJvbSAnLi4vLi4vZ3JlZW5ob3VzZUVmZmVjdC5qcyc7XHJcbmltcG9ydCBHcmVlbmhvdXNlRWZmZWN0Q29uc3RhbnRzIGZyb20gJy4uL0dyZWVuaG91c2VFZmZlY3RDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgR3JlZW5ob3VzZUVmZmVjdFF1ZXJ5UGFyYW1ldGVycyBmcm9tICcuLi9HcmVlbmhvdXNlRWZmZWN0UXVlcnlQYXJhbWV0ZXJzLmpzJztcclxuaW1wb3J0IEdyZWVuaG91c2VFZmZlY3RVdGlscyBmcm9tICcuLi9HcmVlbmhvdXNlRWZmZWN0VXRpbHMuanMnO1xyXG5pbXBvcnQgQXRtb3NwaGVyZUxheWVyIGZyb20gJy4vQXRtb3NwaGVyZUxheWVyLmpzJztcclxuaW1wb3J0IENsb3VkIGZyb20gJy4vQ2xvdWQuanMnO1xyXG5pbXBvcnQgRU1FbmVyZ3lQYWNrZXQsIHsgRU1FbmVyZ3lQYWNrZXRTdGF0ZU9iamVjdCB9IGZyb20gJy4vRU1FbmVyZ3lQYWNrZXQuanMnO1xyXG5pbXBvcnQgRW5lcmd5QWJzb3JiaW5nRW1pdHRpbmdMYXllciBmcm9tICcuL0VuZXJneUFic29yYmluZ0VtaXR0aW5nTGF5ZXIuanMnO1xyXG5pbXBvcnQgRmx1eE1ldGVyLCB7IEZsdXhNZXRlck9wdGlvbnMgfSBmcm9tICcuL0ZsdXhNZXRlci5qcyc7XHJcbmltcG9ydCBHcmVlbmhvdXNlRWZmZWN0TW9kZWwsIHsgR3JlZW5ob3VzZUVmZmVjdE1vZGVsT3B0aW9ucyB9IGZyb20gJy4vR3JlZW5ob3VzZUVmZmVjdE1vZGVsLmpzJztcclxuaW1wb3J0IEdyb3VuZExheWVyIGZyb20gJy4vR3JvdW5kTGF5ZXIuanMnO1xyXG5pbXBvcnQgU3BhY2VFbmVyZ3lTaW5rIGZyb20gJy4vU3BhY2VFbmVyZ3lTaW5rLmpzJztcclxuaW1wb3J0IFN1bkVuZXJneVNvdXJjZSBmcm9tICcuL1N1bkVuZXJneVNvdXJjZS5qcyc7XHJcbmltcG9ydCBUZW1wZXJhdHVyZVVuaXRzIGZyb20gJy4vVGVtcGVyYXR1cmVVbml0cy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgSEVJR0hUX09GX0FUTU9TUEhFUkUgPSA1MDAwMDsgLy8gaW4gbWV0ZXJzXHJcbmNvbnN0IERFRkFVTFRfTlVNQkVSX09GX0FUTU9TUEhFUkVfTEFZRVJTID0gMTI7IC8vIGVtcGlyaWNhbGx5IGRldGVybWluZWQgdG8gZ2l2ZSB1cyBnb29kIGJlaGF2aW9yIGZvciB0ZW1wZXJhdHVyZSBhbmQgZW5lcmd5IGZsdXhcclxuY29uc3QgU1VOTElHSFRfU1BBTiA9IEdyZWVuaG91c2VFZmZlY3RDb25zdGFudHMuU1VOTElHSFRfU1BBTjtcclxuY29uc3QgTU9ERUxfVElNRV9TVEVQID0gMSAvIDYwOyAvLyBpbiBzZWNvbmRzLCBvcmlnaW5hbGx5IGRlcml2ZWQgZnJvbSB0aGUgbW9zdCBjb21tb24gYW5pbWF0aW9uIGZyYW1lIHJhdGVcclxuY29uc3QgUkFESUFUSVZFX0JBTEFOQ0VfVEhSRVNIT0xEID0gNTsgLy8gaW4gd2F0dHMgcGVyIHNxdWFyZSBtZXRlciwgZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG5cclxuLy8gbWFwIHVzZWQgdG8gc2V0IHRoZSBkZWZhdWx0IHRlbXBlcmF0dXJlIHVuaXRzIGJhc2VkIG9uIHRoZSB2YWx1ZSBvZiBhIHF1ZXJ5IHBhcmFtZXRlclxyXG5jb25zdCBtYXBMZXR0ZXJUb1RlbXBlcmF0dXJlVW5pdHMgPSBuZXcgTWFwPHN0cmluZywgVGVtcGVyYXR1cmVVbml0cz4oIFtcclxuICBbICdLJywgVGVtcGVyYXR1cmVVbml0cy5LRUxWSU4gXSxcclxuICBbICdDJywgVGVtcGVyYXR1cmVVbml0cy5DRUxTSVVTIF0sXHJcbiAgWyAnRicsIFRlbXBlcmF0dXJlVW5pdHMuRkFIUkVOSEVJVCBdXHJcbl0gKTtcclxuY29uc3QgREVGQVVMVF9URU1QRVJBVFVSRV9VTklUUyA9IG1hcExldHRlclRvVGVtcGVyYXR1cmVVbml0cy5nZXQoIEdyZWVuaG91c2VFZmZlY3RRdWVyeVBhcmFtZXRlcnMuZGVmYXVsdFRlbXBlcmF0dXJlVW5pdHMhICk7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyBtaW4gdGVtcGVyYXR1cmUgdGhhdCB0aGUgZ3JvdW5kIGlzIGFsbG93ZWQgdG8gcmVhY2gsIGluIEtlbHZpblxyXG4gIG1pbmltdW1Hcm91bmRUZW1wZXJhdHVyZT86IG51bWJlcjtcclxuXHJcbiAgLy8gdGhlIG51bWJlciBvZiBlbmVyZ3kgYWJzb3JiaW5nIGFuZCBlbWl0dGluZyBsYXllcnMgaW4gdGhlIGF0bW9zcGhlcmVcclxuICBudW1iZXJPZkF0bW9zcGhlcmVMYXllcnM/OiBudW1iZXI7XHJcblxyXG4gIC8vIGluZGljYXRlcyB3aGV0aGVyIHRoZSBsYXllcnMgaW4gdGhlIGF0bW9zcGhlcmUgYXJlIGluaXRpYWxseSBhY3RpdmUgb3IgaW5hY3RpdmVcclxuICBhdG1vc3BoZXJlTGF5ZXJzSW5pdGlhbGx5QWN0aXZlPzogYm9vbGVhbjtcclxuXHJcbiAgLy8gcHJvcG9ydGlvbiBvZiBlbmVyZ3kgdGhhdCBjcm9zc2VzIGFuIGF0bW9zcGhlcmUgbGF5ZXIgdGhhdCBpcyBhYnNvcmJlZCwgMCBmb3Igbm9uZSwgMSBmb3IgMTAwJVxyXG4gIGluaXRpYWxBdG1vc3BoZXJlTGF5ZXJBYnNvcnB0aW9uUHJvcG9ydGlvbj86IG51bWJlcjtcclxuXHJcbiAgLy8gd2hldGhlciBhIGZsdXggbWV0ZXIgc2hvdWxkIGJlIHByZXNlbnQgaW4gdGhpcyBtb2RlbFxyXG4gIGZsdXhNZXRlclByZXNlbnQ/OiBib29sZWFuO1xyXG5cclxuICAvLyBvcHRpb25zIHRoYXQgYXJlIHBhc3MgdGhyb3VnaCB0byB0aGUgZmx1eCBtZXRlciBpZiBwcmVzZW50XHJcbiAgZmx1eE1ldGVyT3B0aW9ucz86IEZsdXhNZXRlck9wdGlvbnM7XHJcbn07XHJcbmV4cG9ydCB0eXBlIExheWVyc01vZGVsT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgR3JlZW5ob3VzZUVmZmVjdE1vZGVsT3B0aW9ucztcclxuXHJcbmNsYXNzIExheWVyc01vZGVsIGV4dGVuZHMgR3JlZW5ob3VzZUVmZmVjdE1vZGVsIHtcclxuXHJcbiAgLy8gd2hldGhlciB0aGUgYW1vdW50IG9mIGVuZXJneSBjb21pbmcgaW4gZnJvbSB0aGUgc3VuIG1hdGNoZXMgdGhhdCBnb2luZyBiYWNrIG91dCB0byBzcGFjZSwgd2l0aGluIGEgdGhyZXNob2xkXHJcbiAgcHVibGljIHJlYWRvbmx5IGluUmFkaWF0aXZlQmFsYW5jZVByb3BlcnR5OiBCb29sZWFuUHJvcGVydHk7XHJcblxyXG4gIC8vIE5ldCBpbmZsb3cgb2YgZW5lcmd5IGludG8gdGhlIEVhcnRoIGF0IHRoZSB0b3Agb2YgdGhlIGF0bW9zcGhlcmUuICBXaGVuIHRoaXMgaXMgcG9zaXRpdmUsIG1vcmUgZW5lcmd5IGlzIGNvbWluZ1xyXG4gIC8vIGludG8gdGhlIEVhcnRoIHRoYW4gaXMgbGVhdmluZywgc28gaXQgc2hvdWxkIGJlIGhlYXRpbmcgdXAuICBXaGVuIG5lZ2F0aXZlLCB0aGUgRWFydGggaXMgcmVsZWFzaW5nIGVuZXJneSBhbmRcclxuICAvLyB0aHVzIGNvb2xpbmcgZG93bi5cclxuICBwdWJsaWMgcmVhZG9ubHkgbmV0SW5mbG93T2ZFbmVyZ3lQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHk7XHJcblxyXG4gIC8vIHBhY2tldHMgb2YgZWxlY3Ryb21hZ25ldGljIGVuZXJneSB0aGF0IGFyZSBtb3ZpbmcgdXAgYW5kIGRvd24gaW4gdGhlIG1vZGVsXHJcbiAgcHJpdmF0ZSByZWFkb25seSBlbUVuZXJneVBhY2tldHM6IEVNRW5lcmd5UGFja2V0W107XHJcblxyXG4gIC8vIG1haW4gZW5lcmd5IHNvdXJjZSBjb21pbmcgaW50byB0aGUgc3lzdGVtXHJcbiAgcHVibGljIHJlYWRvbmx5IHN1bkVuZXJneVNvdXJjZTogU3VuRW5lcmd5U291cmNlO1xyXG5cclxuICAvLyB0aGUgZW5lcmd5LWFic29yYmluZy1hbmQtZW1pdHRpbmcgbGF5ZXJzIGZvciB0aGUgYXRtb3NwaGVyZVxyXG4gIHB1YmxpYyByZWFkb25seSBhdG1vc3BoZXJlTGF5ZXJzOiBBdG1vc3BoZXJlTGF5ZXJbXTtcclxuXHJcbiAgLy8gYSBjbG91ZCB0aGF0IG1heSBvciBtYXkgbm90IGJlIHByZXNlbnQsIGFuZCB0aGF0IHJlZmxlY3RzIHN1bmxpZ2h0IGlmIGl0IGlzXHJcbiAgcHVibGljIGNsb3VkOiBDbG91ZCB8IG51bGwgPSBudWxsO1xyXG5cclxuICAvLyBtb2RlbCBvZiB0aGUgZ3JvdW5kIHRoYXQgYWJzb3JicyBlbmVyZ3ksIGhlYXRzIHVwLCBhbmQgcmFkaWF0ZXMgaW5mcmFyZWQgZW5lcmd5XHJcbiAgcHVibGljIHJlYWRvbmx5IGdyb3VuZExheWVyOiBHcm91bmRMYXllcjtcclxuXHJcbiAgLy8gdGhlIGVuZHBvaW50IHdoZXJlIGVuZXJneSByYWRpYXRpbmcgZnJvbSB0aGUgdG9wIG9mIHRoZSBhdG1vc3BoZXJlIGdvZXNcclxuICBwdWJsaWMgcmVhZG9ubHkgb3V0ZXJTcGFjZTogU3BhY2VFbmVyZ3lTaW5rO1xyXG5cclxuICAvLyB1c2VkIHRvIHRyYWNrIGhvdyBtdWNoIHN0ZXBwaW5nIG9mIHRoZSBtb2RlbCBuZWVkcyB0byBvY2N1clxyXG4gIHByaXZhdGUgbW9kZWxTdGVwcGluZ1RpbWU6IG51bWJlcjtcclxuXHJcbiAgLy8gbW9kZWwgb2YgYSBtZXRlciB0aGF0IGNhbiBtZWFzdXJlIHRoZSBlbmVyZ3kgZmx1eCBtb3ZpbmcgdGhyb3VnaCB0aGUgYXRtb3NwaGVyZVxyXG4gIHB1YmxpYyByZWFkb25seSBmbHV4TWV0ZXI6IEZsdXhNZXRlciB8IG51bGw7XHJcblxyXG4gIC8vIHdoZXRoZXIgdGhlIHRoZXJtb21ldGVyIG1lYXN1cmluZyBzdXJmYWNlIHRlbXBlcmF0dXJlIGlzIHZpc2libGVcclxuICBwdWJsaWMgcmVhZG9ubHkgc3VyZmFjZVRoZXJtb21ldGVyVmlzaWJsZVByb3BlcnR5OiBCb29sZWFuUHJvcGVydHk7XHJcblxyXG4gIC8vIHdoZXRoZXIgdGhlIFwiRW5lcmd5IEJhbGFuY2VcIiBkaXNwbGF5IGlzIHZpc2libGVcclxuICBwdWJsaWMgcmVhZG9ubHkgZW5lcmd5QmFsYW5jZVZpc2libGVQcm9wZXJ0eTogQm9vbGVhblByb3BlcnR5O1xyXG5cclxuICAvLyB3aGV0aGVyIHRoZSBnbG93aW5nIHJlcHJlc2VudGF0aW9uIG9mIHN1cmZhY2UgdGVtcGVyYXR1cmUgaXMgdmlzaWJsZVxyXG4gIHB1YmxpYyByZWFkb25seSBzdXJmYWNlVGVtcGVyYXR1cmVWaXNpYmxlUHJvcGVydHk6IEJvb2xlYW5Qcm9wZXJ0eTtcclxuXHJcbiAgLy8gZmllbGRzIHdpdGggc2VsZi1leHBsYW5hdG9yeSBuYW1lc1xyXG4gIHB1YmxpYyByZWFkb25seSBzdXJmYWNlVGVtcGVyYXR1cmVLZWx2aW5Qcm9wZXJ0eTogTnVtYmVyUHJvcGVydHk7XHJcbiAgcHVibGljIHJlYWRvbmx5IHN1cmZhY2VUZW1wZXJhdHVyZUNlbHNpdXNQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgc3VyZmFjZVRlbXBlcmF0dXJlRmFocmVuaGVpdFByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXI+O1xyXG4gIHB1YmxpYyByZWFkb25seSB0ZW1wZXJhdHVyZVVuaXRzUHJvcGVydHk6IEVudW1lcmF0aW9uUHJvcGVydHk8VGVtcGVyYXR1cmVVbml0cz47XHJcbiAgcHVibGljIHJlYWRvbmx5IGZsdXhNZXRlclZpc2libGVQcm9wZXJ0eTogQm9vbGVhblByb3BlcnR5O1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gW3RhbmRlbV1cclxuICAgKiBAcGFyYW0gW3Byb3ZpZGVkT3B0aW9uc11cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHRhbmRlbTogVGFuZGVtLCBwcm92aWRlZE9wdGlvbnM/OiBMYXllcnNNb2RlbE9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxMYXllcnNNb2RlbE9wdGlvbnMsIFNlbGZPcHRpb25zLCBHcmVlbmhvdXNlRWZmZWN0TW9kZWxPcHRpb25zPigpKCB7XHJcbiAgICAgIG51bWJlck9mQXRtb3NwaGVyZUxheWVyczogREVGQVVMVF9OVU1CRVJfT0ZfQVRNT1NQSEVSRV9MQVlFUlMsXHJcbiAgICAgIG1pbmltdW1Hcm91bmRUZW1wZXJhdHVyZTogR3JvdW5kTGF5ZXIuTUlOSU1VTV9FQVJUSF9BVF9OSUdIVF9URU1QRVJBVFVSRSxcclxuICAgICAgaW5pdGlhbEF0bW9zcGhlcmVMYXllckFic29ycHRpb25Qcm9wb3J0aW9uOiAwLFxyXG4gICAgICBhdG1vc3BoZXJlTGF5ZXJzSW5pdGlhbGx5QWN0aXZlOiB0cnVlLFxyXG4gICAgICBmbHV4TWV0ZXJQcmVzZW50OiBmYWxzZSxcclxuICAgICAgZmx1eE1ldGVyT3B0aW9uczoge31cclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCB0YW5kZW0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLnN1cmZhY2VUZW1wZXJhdHVyZUtlbHZpblByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCAwLCB7XHJcbiAgICAgIHJhbmdlOiBuZXcgUmFuZ2UoIDAsIDUyMCApLFxyXG4gICAgICB1bml0czogJ0snLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdzdXJmYWNlVGVtcGVyYXR1cmVLZWx2aW5Qcm9wZXJ0eScgKSxcclxuICAgICAgcGhldGlvUmVhZE9ubHk6IHRydWUsXHJcbiAgICAgIHBoZXRpb0hpZ2hGcmVxdWVuY3k6IHRydWVcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnN1cmZhY2VUZW1wZXJhdHVyZUNlbHNpdXNQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgdGhpcy5zdXJmYWNlVGVtcGVyYXR1cmVLZWx2aW5Qcm9wZXJ0eSBdLFxyXG4gICAgICBHcmVlbmhvdXNlRWZmZWN0VXRpbHMua2VsdmluVG9DZWxzaXVzXHJcbiAgICApO1xyXG5cclxuICAgIHRoaXMuc3VyZmFjZVRlbXBlcmF0dXJlRmFocmVuaGVpdFByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eShcclxuICAgICAgWyB0aGlzLnN1cmZhY2VUZW1wZXJhdHVyZUtlbHZpblByb3BlcnR5IF0sXHJcbiAgICAgIEdyZWVuaG91c2VFZmZlY3RVdGlscy5rZWx2aW5Ub0ZhaHJlbmhlaXRcclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5uZXRJbmZsb3dPZkVuZXJneVByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCAwLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ25ldEluZmxvd09mRW5lcmd5UHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5pblJhZGlhdGl2ZUJhbGFuY2VQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUsIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnaW5SYWRpYXRpdmVCYWxhbmNlUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggREVGQVVMVF9URU1QRVJBVFVSRV9VTklUUywgJ3NvbWV0aGluZyBpcyB3cm9uZyB3aXRoIHRoZSBkZWZhdWx0IHRlbXBlcmF0dXJlIHVuaXRzJyApO1xyXG4gICAgdGhpcy50ZW1wZXJhdHVyZVVuaXRzUHJvcGVydHkgPSBuZXcgRW51bWVyYXRpb25Qcm9wZXJ0eSggREVGQVVMVF9URU1QRVJBVFVSRV9VTklUUyEsIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAndGVtcGVyYXR1cmVVbml0c1Byb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5zdXJmYWNlVGhlcm1vbWV0ZXJWaXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3N1cmZhY2VUaGVybW9tZXRlclZpc2libGVQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZW5lcmd5QmFsYW5jZVZpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2VuZXJneUJhbGFuY2VWaXNpYmxlUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnN1cmZhY2VUZW1wZXJhdHVyZVZpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3N1cmZhY2VUZW1wZXJhdHVyZVZpc2libGVQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZmx1eE1ldGVyVmlzaWJsZVByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UsIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZmx1eE1ldGVyVmlzaWJsZVByb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5lbUVuZXJneVBhY2tldHMgPSBbXTtcclxuXHJcbiAgICB0aGlzLnN1bkVuZXJneVNvdXJjZSA9IG5ldyBTdW5FbmVyZ3lTb3VyY2UoXHJcbiAgICAgIEVuZXJneUFic29yYmluZ0VtaXR0aW5nTGF5ZXIuU1VSRkFDRV9BUkVBLFxyXG4gICAgICB0aGlzLmVtRW5lcmd5UGFja2V0cyxcclxuICAgICAgdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3N1bkVuZXJneVNvdXJjZScgKVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLmdyb3VuZExheWVyID0gbmV3IEdyb3VuZExheWVyKCB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZ3JvdW5kTGF5ZXInICksIHtcclxuICAgICAgbWluaW11bVRlbXBlcmF0dXJlOiBvcHRpb25zLm1pbmltdW1Hcm91bmRUZW1wZXJhdHVyZVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuYXRtb3NwaGVyZUxheWVycyA9IFtdO1xyXG5cclxuICAgIGNvbnN0IGF0bW9zcGhlcmVMYXllcnNUYW5kZW0gPSB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnYXRtb3NwaGVyZUxheWVycycgKTtcclxuXHJcbiAgICAvLyBUaGUgYXRtb3NwaGVyZSBsYXllcnMgYXJlIGV2ZW5seSBzcGFjZWQgYmV0d2VlbiB0aGUgZ3JvdW5kIGFuZCB0aGUgdG9wIG9mIHRoZSBhdG1vc3BoZXJlLlxyXG4gICAgY29uc3QgZGlzdGFuY2VCZXR3ZWVuQXRtb3NwaGVyZUxheWVycyA9IEhFSUdIVF9PRl9BVE1PU1BIRVJFIC8gKCBvcHRpb25zLm51bWJlck9mQXRtb3NwaGVyZUxheWVycyArIDEgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGF0bW9zcGhlcmUgbGF5ZXJzLiAgVGhlc2UgTVVTVCBiZSBhZGRlZCBpbiBvcmRlciBvZiBpbmNyZWFzaW5nIGFsdGl0dWRlLCBzaW5jZSBvdGhlciBjb2RlIGFzc3VtZXMgdGhhdFxyXG4gICAgLy8gdGhpcyBpcyB0aGUgY2FzZS5cclxuICAgIF8udGltZXMoIG9wdGlvbnMubnVtYmVyT2ZBdG1vc3BoZXJlTGF5ZXJzLCBpbmRleCA9PiB7XHJcbiAgICAgIGNvbnN0IGF0bW9zcGhlcmVMYXllciA9IG5ldyBBdG1vc3BoZXJlTGF5ZXIoXHJcbiAgICAgICAgZGlzdGFuY2VCZXR3ZWVuQXRtb3NwaGVyZUxheWVycyAqICggaW5kZXggKyAxICksXHJcbiAgICAgICAgYXRtb3NwaGVyZUxheWVyc1RhbmRlbS5jcmVhdGVUYW5kZW0oIGBsYXllciR7aW5kZXh9YCApLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGluaXRpYWxseUFjdGl2ZTogb3B0aW9ucy5hdG1vc3BoZXJlTGF5ZXJzSW5pdGlhbGx5QWN0aXZlLFxyXG4gICAgICAgICAgaW5pdGlhbEVuZXJneUFic29ycHRpb25Qcm9wb3J0aW9uOiBvcHRpb25zLmluaXRpYWxBdG1vc3BoZXJlTGF5ZXJBYnNvcnB0aW9uUHJvcG9ydGlvblxyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuICAgICAgdGhpcy5hdG1vc3BoZXJlTGF5ZXJzLnB1c2goIGF0bW9zcGhlcmVMYXllciApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHRoZSBlbmRwb2ludCB3aGVyZSBlbmVyZ3kgcmFkaWF0aW5nIGZyb20gdGhlIHRvcCBvZiB0aGUgYXRtb3NwaGVyZSBnb2VzXHJcbiAgICB0aGlzLm91dGVyU3BhY2UgPSBuZXcgU3BhY2VFbmVyZ3lTaW5rKCBIRUlHSFRfT0ZfQVRNT1NQSEVSRSwgdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ291dGVyU3BhY2UnICkgKTtcclxuXHJcbiAgICAvLyAgQ3JlYXRlIHRoZSBtb2RlbCBjb21wb25lbnQgZm9yIHRoZSBGbHV4TWV0ZXIgaWYgdGhlIG9wdGlvbnMgaW5kaWNhdGUgdGhhdCBpdCBzaG91bGQgYmUgcHJlc2VudC5cclxuICAgIGlmICggb3B0aW9ucy5mbHV4TWV0ZXJQcmVzZW50ICkge1xyXG5cclxuICAgICAgY29uc3QgZmx1eE1ldGVyT3B0aW9ucyA9IGNvbWJpbmVPcHRpb25zPEZsdXhNZXRlck9wdGlvbnM+KCB7XHJcbiAgICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZmx1eE1ldGVyJyApXHJcbiAgICAgIH0sIG9wdGlvbnMuZmx1eE1ldGVyT3B0aW9ucyApO1xyXG5cclxuICAgICAgdGhpcy5mbHV4TWV0ZXIgPSBuZXcgRmx1eE1ldGVyKCB0aGlzLmF0bW9zcGhlcmVMYXllcnMsIGZsdXhNZXRlck9wdGlvbnMgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLmZsdXhNZXRlciA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5tb2RlbFN0ZXBwaW5nVGltZSA9IDA7XHJcblxyXG4gICAgLy8gQ29ubmVjdCB1cCB0aGUgc3VyZmFjZSB0ZW1wZXJhdHVyZSBwcm9wZXJ0eSB0byB0aGF0IG9mIHRoZSBncm91bmQgbGF5ZXIgbW9kZWwgZWxlbWVudC5cclxuICAgIHRoaXMuZ3JvdW5kTGF5ZXIudGVtcGVyYXR1cmVQcm9wZXJ0eS5saW5rKCBncm91bmRUZW1wZXJhdHVyZSA9PiB7XHJcbiAgICAgIHRoaXMuc3VyZmFjZVRlbXBlcmF0dXJlS2VsdmluUHJvcGVydHkuc2V0KCBncm91bmRUZW1wZXJhdHVyZSApO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIHN0ZXBNb2RlbCggZHQ6IG51bWJlciApOiB2b2lkIHtcclxuXHJcbiAgICAvLyBTdGVwIHRoZSBtb2RlbCBjb21wb25lbnRzIGJ5IGEgY29uc2lzdGVudCBkdCBpbiBvcmRlciB0byBhdm9pZCBpbnN0YWJpbGl0aWVzIGluIHRoZSBsYXllciBpbnRlcmFjdGlvbnMuICBTZWVcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmVlbmhvdXNlLWVmZmVjdC9pc3N1ZXMvNDggZm9yIGluZm9ybWF0aW9uIG9uIHdoeSB0aGlzIGlzIG5lY2Vzc2FyeS5cclxuICAgIHRoaXMubW9kZWxTdGVwcGluZ1RpbWUgKz0gZHQ7XHJcblxyXG4gICAgd2hpbGUgKCB0aGlzLm1vZGVsU3RlcHBpbmdUaW1lID49IE1PREVMX1RJTUVfU1RFUCApIHtcclxuXHJcbiAgICAgIC8vIEFkZCB0aGUgZW5lcmd5IHByb2R1Y2VkIGJ5IHRoZSBzdW4gdG8gdGhlIHN5c3RlbS5cclxuICAgICAgdGhpcy5zdW5FbmVyZ3lTb3VyY2UucHJvZHVjZUVuZXJneSggTU9ERUxfVElNRV9TVEVQICk7XHJcblxyXG4gICAgICAvLyBTdGVwIHRoZSBlbmVyZ3kgcGFja2V0cywgd2hpY2ggY2F1c2VzIHRoZW0gdG8gbW92ZS5cclxuICAgICAgdGhpcy5lbUVuZXJneVBhY2tldHMuZm9yRWFjaCggZW1FbmVyZ3lQYWNrZXQgPT4geyBlbUVuZXJneVBhY2tldC5zdGVwKCBNT0RFTF9USU1FX1NURVAgKTsgfSApO1xyXG5cclxuICAgICAgLy8gQ2hlY2sgZm9yIGludGVyYWN0aW9uIGJldHdlZW4gdGhlIGVuZXJneSBwYWNrZXRzIGFuZCBncm91bmQsIHRoZSBhdG1vc3BoZXJlLCBjbG91ZHMsIGFuZCBzcGFjZS5cclxuICAgICAgdGhpcy5ncm91bmRMYXllci5pbnRlcmFjdFdpdGhFbmVyZ3koIHRoaXMuZW1FbmVyZ3lQYWNrZXRzLCBNT0RFTF9USU1FX1NURVAgKTtcclxuICAgICAgdGhpcy5hdG1vc3BoZXJlTGF5ZXJzLmZvckVhY2goIGF0bW9zcGhlcmVMYXllciA9PiB7XHJcbiAgICAgICAgYXRtb3NwaGVyZUxheWVyLmludGVyYWN0V2l0aEVuZXJneSggdGhpcy5lbUVuZXJneVBhY2tldHMsIE1PREVMX1RJTUVfU1RFUCApO1xyXG4gICAgICB9ICk7XHJcbiAgICAgIGlmICggdGhpcy5jbG91ZCApIHtcclxuICAgICAgICB0aGlzLmNsb3VkLmludGVyYWN0V2l0aEVuZXJneSggdGhpcy5lbUVuZXJneVBhY2tldHMsIE1PREVMX1RJTUVfU1RFUCApO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMub3V0ZXJTcGFjZS5pbnRlcmFjdFdpdGhFbmVyZ3koIHRoaXMuZW1FbmVyZ3lQYWNrZXRzLCBNT0RFTF9USU1FX1NURVAgKTtcclxuXHJcbiAgICAgIC8vIElmIHRoZSBmbHV4IG1ldGVyIGlzIHByZXNlbnQsIGhhdmUgaXQgbWVhc3VyZSB0aGUgZmx1eC5cclxuICAgICAgaWYgKCB0aGlzLmZsdXhNZXRlciApIHtcclxuICAgICAgICB0aGlzLmZsdXhNZXRlci5tZWFzdXJlRW5lcmd5UGFja2V0Rmx1eCggdGhpcy5lbUVuZXJneVBhY2tldHMsIE1PREVMX1RJTUVfU1RFUCApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBBZGp1c3QgcmVtYWluaW5nIHRpbWUgZm9yIHN0ZXBwaW5nIHRoZSBtb2RlbC5cclxuICAgICAgdGhpcy5tb2RlbFN0ZXBwaW5nVGltZSAtPSBNT0RFTF9USU1FX1NURVA7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVXBkYXRlIHRoZSBQcm9wZXJ0eSB0aGF0IHRyYWNrcyB3aGV0aGVyIHRoZSBzeXN0ZW0gYXMgYSB3aG9sZSBpcyBpbiByYWRpYXRpdmUgYmFsYW5jZS5cclxuICAgIGNvbnN0IGVuZXJneUdvaW5nSW50b1NwYWNlID0gdGhpcy5vdXRlclNwYWNlLmluY29taW5nVXB3YXJkTW92aW5nRW5lcmd5UmF0ZVRyYWNrZXIuZW5lcmd5UmF0ZVByb3BlcnR5LnZhbHVlIC9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRW5lcmd5QWJzb3JiaW5nRW1pdHRpbmdMYXllci5TVVJGQUNFX0FSRUE7XHJcbiAgICBjb25zdCBlbmVyZ3lDb21pbmdGcm9tU3VuID0gdGhpcy5zdW5FbmVyZ3lTb3VyY2UuZ2V0T3V0cHV0RW5lcmd5UmF0ZSgpO1xyXG4gICAgdGhpcy5uZXRJbmZsb3dPZkVuZXJneVByb3BlcnR5LnNldCggZW5lcmd5Q29taW5nRnJvbVN1biAtIGVuZXJneUdvaW5nSW50b1NwYWNlICk7XHJcbiAgICB0aGlzLmluUmFkaWF0aXZlQmFsYW5jZVByb3BlcnR5LnNldChcclxuICAgICAgTWF0aC5hYnMoIGVuZXJneUNvbWluZ0Zyb21TdW4gLSBlbmVyZ3lHb2luZ0ludG9TcGFjZSApIDwgUkFESUFUSVZFX0JBTEFOQ0VfVEhSRVNIT0xEXHJcbiAgICApO1xyXG5cclxuICAgIHN1cGVyLnN0ZXBNb2RlbCggZHQgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZpbmQgYSBsYXllciwgaWYgdGhlcmUgaXMgb25lLCB0aGF0IHdvdWxkIGJlIGNyb3NzZWQgYnkgYW4gb2JqZWN0IHRyYXZlbGluZyBmcm9tIHRoZSBzdGFydCBhbHRpdHVkZSB0byB0aGUgZW5kXHJcbiAgICogYWx0aXR1ZGUuICBJZiB0aGVyZSBhcmUgbm9uZSwgbnVsbCBpcyByZXR1cm5lZC4gIElmIHRoZXJlIGFyZSBzZXZlcmFsLCB0aGUgZmlyc3Qgb25lIHRoYXQgd291bGQgYmUgY3Jvc3NlZCBpc1xyXG4gICAqIHJldHVybmVkLlxyXG4gICAqXHJcbiAgICogQ29tcGFyaXNvbnMgYXJlIGV4Y2x1c2l2ZSBmb3IgdGhlIGZpcnN0IGFsdGl0dWRlLCBpbmNsdXNpdmUgZm9yIHRoZSBzZWNvbmQuICBTZWUgdGhlIGNvZGUgZm9yIGRldGFpbHMuXHJcbiAgICpcclxuICAgKiBUaGlzIGlzIGludGVuZGVkIHRvIGJlIHByZXR0eSBlZmZpY2llbnQsIGhlbmNlIHRoZSB1c2Ugb2YgcmVndWxhciAnZm9yJyBsb29wcyBhbmQgJ2JyZWFrJyBzdGF0ZW1lbnRzLlxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBmaW5kQ3Jvc3NlZEF0bW9zcGhlcmVMYXllciggc3RhcnRBbHRpdHVkZTogbnVtYmVyLCBlbmRBbHRpdHVkZTogbnVtYmVyICk6IEF0bW9zcGhlcmVMYXllciB8IG51bGwge1xyXG4gICAgbGV0IGNyb3NzZWRMYXllciA9IG51bGw7XHJcbiAgICBpZiAoIHN0YXJ0QWx0aXR1ZGUgPCBlbmRBbHRpdHVkZSApIHtcclxuICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5hdG1vc3BoZXJlTGF5ZXJzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgIGNvbnN0IGF0bW9zcGhlcmVMYXllciA9IHRoaXMuYXRtb3NwaGVyZUxheWVyc1sgaSBdO1xyXG4gICAgICAgIGlmICggYXRtb3NwaGVyZUxheWVyLmlzQWN0aXZlUHJvcGVydHkudmFsdWUgJiZcclxuICAgICAgICAgICAgIHN0YXJ0QWx0aXR1ZGUgPCBhdG1vc3BoZXJlTGF5ZXIuYWx0aXR1ZGUgJiZcclxuICAgICAgICAgICAgIGVuZEFsdGl0dWRlID49IGF0bW9zcGhlcmVMYXllci5hbHRpdHVkZSApIHtcclxuXHJcbiAgICAgICAgICBjcm9zc2VkTGF5ZXIgPSBhdG1vc3BoZXJlTGF5ZXI7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBzdGFydEFsdGl0dWRlID4gZW5kQWx0aXR1ZGUgKSB7XHJcbiAgICAgIGZvciAoIGxldCBpID0gdGhpcy5hdG1vc3BoZXJlTGF5ZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tICkge1xyXG4gICAgICAgIGNvbnN0IGF0bW9zcGhlcmVMYXllciA9IHRoaXMuYXRtb3NwaGVyZUxheWVyc1sgaSBdO1xyXG4gICAgICAgIGlmICggYXRtb3NwaGVyZUxheWVyLmlzQWN0aXZlUHJvcGVydHkudmFsdWUgJiZcclxuICAgICAgICAgICAgIHN0YXJ0QWx0aXR1ZGUgPiBhdG1vc3BoZXJlTGF5ZXIuYWx0aXR1ZGUgJiZcclxuICAgICAgICAgICAgIGVuZEFsdGl0dWRlIDw9IGF0bW9zcGhlcmVMYXllci5hbHRpdHVkZSApIHtcclxuXHJcbiAgICAgICAgICBjcm9zc2VkTGF5ZXIgPSBhdG1vc3BoZXJlTGF5ZXI7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBjcm9zc2VkTGF5ZXI7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXR0ZXIgbWV0aG9kIHRoYXQgaXMgdHJ1ZSB3aGVuIGluZnJhcmVkIHJhZGlhdGlvbiBpcyBwcmVzZW50LlxyXG4gICAqIFRPRE86IFNob3VsZCB0aGlzIGFjdHVhbGx5IGJlIGltcGxlbWVudGVkIGluIHN1YmNsYXNzZXMgYW5kIGFjdHVhbGx5IHRlc3QgZm9yIHRoZSBwcmVzZW5jZSBvZiBJUj9cclxuICAgKi9cclxuICBwdWJsaWMgaXNJbmZyYXJlZFByZXNlbnQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5ncm91bmRMYXllci50ZW1wZXJhdHVyZVByb3BlcnR5LnZhbHVlID4gdGhpcy5ncm91bmRMYXllci5taW5pbXVtVGVtcGVyYXR1cmU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNldHMgYWxsIGFzcGVjdHMgb2YgdGhlIG1vZGVsLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSByZXNldCgpOiB2b2lkIHtcclxuICAgIHN1cGVyLnJlc2V0KCk7XHJcblxyXG4gICAgdGhpcy5uZXRJbmZsb3dPZkVuZXJneVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmZsdXhNZXRlclZpc2libGVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5lbmVyZ3lCYWxhbmNlVmlzaWJsZVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnN1cmZhY2VUaGVybW9tZXRlclZpc2libGVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy50ZW1wZXJhdHVyZVVuaXRzUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuc3VuRW5lcmd5U291cmNlLnJlc2V0KCk7XHJcbiAgICB0aGlzLmdyb3VuZExheWVyLnJlc2V0KCk7XHJcbiAgICB0aGlzLmF0bW9zcGhlcmVMYXllcnMuZm9yRWFjaCggYXRtb3NwaGVyZUxheWVyID0+IHsgYXRtb3NwaGVyZUxheWVyLnJlc2V0KCk7IH0gKTtcclxuICAgIHRoaXMuZW1FbmVyZ3lQYWNrZXRzLmxlbmd0aCA9IDA7XHJcbiAgICBpZiAoIHRoaXMuZmx1eE1ldGVyICkge1xyXG4gICAgICB0aGlzLmZsdXhNZXRlci5yZXNldCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogZm9yIHBoZXQtaW9cclxuICAgKi9cclxuICBwdWJsaWMgdG9TdGF0ZU9iamVjdCgpOiBMYXllcnNNb2RlbFN0YXRlT2JqZWN0IHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGVtRW5lcmd5UGFja2V0czogQXJyYXlJTyggRU1FbmVyZ3lQYWNrZXQuRU1FbmVyZ3lQYWNrZXRJTyApLnRvU3RhdGVPYmplY3QoIHRoaXMuZW1FbmVyZ3lQYWNrZXRzIClcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBmb3IgcGhldC1pb1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhcHBseVN0YXRlKCBzdGF0ZU9iamVjdDogTGF5ZXJzTW9kZWxTdGF0ZU9iamVjdCApOiB2b2lkIHtcclxuXHJcbiAgICAvLyBPdGhlciBvYmplY3RzIGhhdmUgYSByZWZlcmVuY2UgdG8gdGhlIGVuZXJneSBwYWNrZXRzLCBzbyB3ZSBkb24ndCB3YW50IHRvIG92ZXJ3cml0ZSBpdC4gIEluc3RlYWQsIGNsZWFyIGl0LCB0aGVuXHJcbiAgICAvLyBjb3B5IGluIHRoZSBjb250ZW50cyBvZiB0aGUgc3RhdGUgb2JqZWN0LlxyXG4gICAgdGhpcy5lbUVuZXJneVBhY2tldHMubGVuZ3RoID0gMDtcclxuICAgIHRoaXMuZW1FbmVyZ3lQYWNrZXRzLnB1c2goXHJcbiAgICAgIC4uLkFycmF5SU8oIEVNRW5lcmd5UGFja2V0LkVNRW5lcmd5UGFja2V0SU8gKS5mcm9tU3RhdGVPYmplY3QoIHN0YXRlT2JqZWN0LmVtRW5lcmd5UGFja2V0cyApXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyBhIG1hcCBvZiBzdGF0ZSBrZXlzIGFuZCB0aGVpciBhc3NvY2lhdGVkIElPVHlwZXMsIHNlZSBJT1R5cGUgZm9yIGRldGFpbHMuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBTVEFURV9TQ0hFTUE6IFJlY29yZDxzdHJpbmcsIElPVHlwZT4gPSB7XHJcbiAgICBlbUVuZXJneVBhY2tldHM6IEFycmF5SU8oIEVNRW5lcmd5UGFja2V0LkVNRW5lcmd5UGFja2V0SU8gKVxyXG4gIH07XHJcblxyXG4gIC8vIHN0YXRpY3NcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IEhFSUdIVF9PRl9BVE1PU1BIRVJFID0gSEVJR0hUX09GX0FUTU9TUEhFUkU7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBTVU5MSUdIVF9TUEFOID0gU1VOTElHSFRfU1BBTjtcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IFJBRElBVElWRV9CQUxBTkNFX1RIUkVTSE9MRCA9IFJBRElBVElWRV9CQUxBTkNFX1RIUkVTSE9MRDtcclxuXHJcbiAgLyoqXHJcbiAgICogTGF5ZXJzTW9kZWxJTyBoYW5kbGVzIFBoRVQtaU8gc2VyaWFsaXphdGlvbiBvZiB0aGUgTGF5ZXJzTW9kZWwuIEJlY2F1c2Ugc2VyaWFsaXphdGlvbiBpbnZvbHZlcyBhY2Nlc3NpbmcgcHJpdmF0ZVxyXG4gICAqIG1lbWJlcnMsIGl0IGRlbGVnYXRlcyB0byBMYXllcnNNb2RlbC4gVGhlIG1ldGhvZHMgdGhhdCBMYXllcnNNb2RlbElPIG92ZXJyaWRlcyBhcmUgdHlwaWNhbCBvZiAnRHluYW1pYyBlbGVtZW50XHJcbiAgICogc2VyaWFsaXphdGlvbicsIGFzIGRlc2NyaWJlZCBpbiB0aGUgU2VyaWFsaXphdGlvbiBzZWN0aW9uIG9mXHJcbiAgICogaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3BoZXQtaW8vYmxvYi9tYXN0ZXIvZG9jL3BoZXQtaW8taW5zdHJ1bWVudGF0aW9uLXRlY2huaWNhbC1ndWlkZS5tZCNzZXJpYWxpemF0aW9uXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBMYXllcnNNb2RlbElPOiBJT1R5cGUgPSBuZXcgSU9UeXBlKCAnTGF5ZXJzTW9kZWxJTycsIHtcclxuICAgIHZhbHVlVHlwZTogTGF5ZXJzTW9kZWwsXHJcbiAgICBzdGF0ZVNjaGVtYTogTGF5ZXJzTW9kZWwuU1RBVEVfU0NIRU1BLFxyXG4gICAgdG9TdGF0ZU9iamVjdDogKCBsYXllcnNNb2RlbDogTGF5ZXJzTW9kZWwgKSA9PiBsYXllcnNNb2RlbC50b1N0YXRlT2JqZWN0KCksXHJcbiAgICBhcHBseVN0YXRlOiAoIGxheWVyc01vZGVsOiBMYXllcnNNb2RlbCwgc3RhdGVPYmplY3Q6IExheWVyc01vZGVsU3RhdGVPYmplY3QgKSA9PiBsYXllcnNNb2RlbC5hcHBseVN0YXRlKCBzdGF0ZU9iamVjdFxyXG4gICAgKVxyXG4gIH0gKTtcclxufVxyXG5cclxudHlwZSBMYXllcnNNb2RlbFN0YXRlT2JqZWN0ID0ge1xyXG4gIGVtRW5lcmd5UGFja2V0czogRU1FbmVyZ3lQYWNrZXRTdGF0ZU9iamVjdFtdO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgeyBMYXllcnNNb2RlbFN0YXRlT2JqZWN0IH07XHJcblxyXG5ncmVlbmhvdXNlRWZmZWN0LnJlZ2lzdGVyKCAnTGF5ZXJzTW9kZWwnLCBMYXllcnNNb2RlbCApO1xyXG5leHBvcnQgZGVmYXVsdCBMYXllcnNNb2RlbDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxtQkFBbUIsTUFBTSw0Q0FBNEM7QUFFNUUsT0FBT0MsY0FBYyxNQUFNLHVDQUF1QztBQUNsRSxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLFNBQVMsSUFBSUMsY0FBYyxRQUFRLHVDQUF1QztBQUVqRixPQUFPQyxPQUFPLE1BQU0sd0NBQXdDO0FBQzVELE9BQU9DLE1BQU0sTUFBTSx1Q0FBdUM7QUFDMUQsT0FBT0MsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBQ3hELE9BQU9DLHlCQUF5QixNQUFNLGlDQUFpQztBQUN2RSxPQUFPQywrQkFBK0IsTUFBTSx1Q0FBdUM7QUFDbkYsT0FBT0MscUJBQXFCLE1BQU0sNkJBQTZCO0FBQy9ELE9BQU9DLGVBQWUsTUFBTSxzQkFBc0I7QUFFbEQsT0FBT0MsY0FBYyxNQUFxQyxxQkFBcUI7QUFDL0UsT0FBT0MsNEJBQTRCLE1BQU0sbUNBQW1DO0FBQzVFLE9BQU9DLFNBQVMsTUFBNEIsZ0JBQWdCO0FBQzVELE9BQU9DLHFCQUFxQixNQUF3Qyw0QkFBNEI7QUFDaEcsT0FBT0MsV0FBVyxNQUFNLGtCQUFrQjtBQUMxQyxPQUFPQyxlQUFlLE1BQU0sc0JBQXNCO0FBQ2xELE9BQU9DLGVBQWUsTUFBTSxzQkFBc0I7QUFDbEQsT0FBT0MsZ0JBQWdCLE1BQU0sdUJBQXVCOztBQUVwRDtBQUNBLE1BQU1DLG9CQUFvQixHQUFHLEtBQUssQ0FBQyxD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