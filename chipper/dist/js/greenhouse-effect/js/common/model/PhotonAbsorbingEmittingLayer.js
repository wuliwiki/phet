// Copyright 2021-2022, University of Colorado Boulder

/**
 * PhotonAbsorbingEmittingLayer is a model element that is responsible for absorbing and re-emitting individual photons
 * at the altitude where an AtmosphereLayer exists.  It does this based on the absorbance of the atmosphere layer.
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import dotRandom from '../../../../dot/js/dotRandom.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Enumeration from '../../../../phet-core/js/Enumeration.js';
import EnumerationValue from '../../../../phet-core/js/EnumerationValue.js';
import optionize from '../../../../phet-core/js/optionize.js';
import greenhouseEffect from '../../greenhouseEffect.js';
import GreenhouseEffectConstants from '../GreenhouseEffectConstants.js';
import AtmosphereLayer from './AtmosphereLayer.js';
// enum that enumerates the possible results when testing whether a photon crossed a layer
class PhotonCrossingTestResult extends EnumerationValue {
  static FULLY_ABOVE = new PhotonCrossingTestResult();
  static FULLY_BELOW = new PhotonCrossingTestResult();
  static CROSSED_BUT_IGNORED = new PhotonCrossingTestResult();
  static CROSSED_AND_ABSORBED = new PhotonCrossingTestResult();
  static NONE = new PhotonCrossingTestResult();
  static enumeration = new Enumeration(PhotonCrossingTestResult);
}
class PhotonAbsorbingEmittingLayer {
  constructor(photons, atmosphereLayer, providedOptions) {
    const options = optionize()({
      thickness: 0,
      photonMaxLateralJumpProportion: 0.01,
      photonAbsorptionTime: 0.1,
      absorbanceMultiplier: 1
    }, providedOptions);
    this.photons = photons;
    this.atmosphereLayer = atmosphereLayer;
    this.atLeastOnePhotonAbsorbedProperty = new BooleanProperty(false);
    this.thickness = options.thickness;

    // a Map that is used to track the amount of time that an absorbed photon has been absorbed into this layer
    this.photonToAbsorbedTimeMap = new Map();

    // options that control various aspects of the photon re-emission process
    this.photonAbsorptionTime = options.photonAbsorptionTime;
    this.photonMaxJumpDistance = options.photonMaxLateralJumpProportion * AtmosphereLayer.WIDTH;
    this.absorbanceMultiplier = options.absorbanceMultiplier;
  }

  /**
   * Check a photon for whether it has crossed this layer and, if so, decide based on the layer's absorbance and some
   * random factors whether the photon should be absorbed and, if so, do the absorption.
   * @param photon - the photon to be tested
   * @returns - an enum value indicating the type of interaction that occurred
   */
  checkForPhotonInteraction(photon) {
    let result = PhotonCrossingTestResult.NONE;
    const previousPhotonAltitude = photon.previousPosition.y;
    const currentPhotonAltitude = photon.positionProperty.value.y;
    const layerAltitude = this.atmosphereLayer.altitude;

    // TODO: The design team is working on improving how the absorption and re-emission of photons looks.  On 6/1/2022
    //       the thickness of the layers was adjusted to be quite thin so that the photons didn't appear to jump across
    //       the layers.  This will need to be refined once the visual portrayal is finalized.  See
    //       https://github.com/phetsims/greenhouse-effect/issues/167.
    const bottomOfLayerAltitude = layerAltitude - this.thickness * 0.0001;
    const topOfLayerAltitude = layerAltitude + this.thickness * 0.0001;

    // TODO: This is a little hard to read, consider CROSSED_INDETERMINATE in the first portion, then post process, or something.
    if (previousPhotonAltitude < bottomOfLayerAltitude) {
      if (currentPhotonAltitude < bottomOfLayerAltitude) {
        result = PhotonCrossingTestResult.FULLY_BELOW;
      } else {
        result = PhotonCrossingTestResult.CROSSED_BUT_IGNORED;
      }
    } else if (previousPhotonAltitude > topOfLayerAltitude) {
      if (currentPhotonAltitude > topOfLayerAltitude) {
        result = PhotonCrossingTestResult.FULLY_ABOVE;
      } else {
        result = PhotonCrossingTestResult.CROSSED_BUT_IGNORED;
      }
    }

    // If the photon has crossed this layer, check whether it should be absorbed.
    if (this.atmosphereLayer.isActiveProperty.value && result === PhotonCrossingTestResult.CROSSED_BUT_IGNORED) {
      // Decide whether to absorb the photon based on the absorption proportion and a random value.
      if (dotRandom.nextDouble() <= this.atmosphereLayer.energyAbsorptionProportionProperty.value * this.absorbanceMultiplier) {
        // Absorb the photon by removing it from the list and adding it to the local map that will track the time for
        // which it has been absorbed in this layer.
        this.photons.remove(photon);
        this.photonToAbsorbedTimeMap.set(photon, 0);
        this.atLeastOnePhotonAbsorbedProperty.set(true);
        result = PhotonCrossingTestResult.CROSSED_AND_ABSORBED;
      }
    }
    return result;
  }

  /**
   * Re-emit any previously absorbed photons that are ready.
   * @param dt - delta time, in seconds
   */
  step(dt) {
    // For each of the photons that have been absorbed into this layer, decide whether it should be re-emitted and, if
    // so, decide where and in what direction.  If not, update the absorbed time.
    for (const [photon, absorptionTime] of this.photonToAbsorbedTimeMap) {
      const updatedAbsorptionTime = absorptionTime + dt;
      if (updatedAbsorptionTime > this.photonAbsorptionTime) {
        // This photon has been around long enough, and it's time to release it.
        photon.velocity.set(PhotonAbsorbingEmittingLayer.createPhotonReleaseVelocity());
        photon.positionProperty.set(this.createPhotonReleasePosition(photon));
        photon.resetPreviousPosition();
        this.photonToAbsorbedTimeMap.delete(photon);
        this.photons.push(photon);
      } else {
        this.photonToAbsorbedTimeMap.set(photon, updatedAbsorptionTime);
      }
    }
  }
  reset() {
    this.photonToAbsorbedTimeMap.clear();
    this.atLeastOnePhotonAbsorbedProperty.reset();
  }

  /**
   * Create a release position that is random and based on the option that specifies the horizontal variation and the
   * altitude of the layer.
   */
  createPhotonReleasePosition(photon) {
    const jump = this.photonMaxJumpDistance * dotRandom.nextDoubleBetween(-1, 1);
    return new Vector2(photon.positionProperty.value.x + jump, this.atmosphereLayer.altitude);
  }

  /**
   * Create the release velocity for this photon.  The speed must be the simulation's value for the speed of light,
   * but the direction can be generally up or down and within a "code" of possible directions.
   */
  static createPhotonReleaseVelocity() {
    const velocity = new Vector2(0, GreenhouseEffectConstants.SPEED_OF_LIGHT);

    // Randomly determine if the general direction should be up or down.
    if (dotRandom.nextBoolean()) {
      velocity.setY(-velocity.y);
    }

    // Add some randomness to the general direction.
    velocity.rotate(dotRandom.nextDoubleBetween(-1, 1) * Math.PI / 4);
    return velocity;
  }
}
export { PhotonCrossingTestResult };
greenhouseEffect.register('PhotonAbsorbingEmittingLayer', PhotonAbsorbingEmittingLayer);
export default PhotonAbsorbingEmittingLayer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJkb3RSYW5kb20iLCJWZWN0b3IyIiwiRW51bWVyYXRpb24iLCJFbnVtZXJhdGlvblZhbHVlIiwib3B0aW9uaXplIiwiZ3JlZW5ob3VzZUVmZmVjdCIsIkdyZWVuaG91c2VFZmZlY3RDb25zdGFudHMiLCJBdG1vc3BoZXJlTGF5ZXIiLCJQaG90b25Dcm9zc2luZ1Rlc3RSZXN1bHQiLCJGVUxMWV9BQk9WRSIsIkZVTExZX0JFTE9XIiwiQ1JPU1NFRF9CVVRfSUdOT1JFRCIsIkNST1NTRURfQU5EX0FCU09SQkVEIiwiTk9ORSIsImVudW1lcmF0aW9uIiwiUGhvdG9uQWJzb3JiaW5nRW1pdHRpbmdMYXllciIsImNvbnN0cnVjdG9yIiwicGhvdG9ucyIsImF0bW9zcGhlcmVMYXllciIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ0aGlja25lc3MiLCJwaG90b25NYXhMYXRlcmFsSnVtcFByb3BvcnRpb24iLCJwaG90b25BYnNvcnB0aW9uVGltZSIsImFic29yYmFuY2VNdWx0aXBsaWVyIiwiYXRMZWFzdE9uZVBob3RvbkFic29yYmVkUHJvcGVydHkiLCJwaG90b25Ub0Fic29yYmVkVGltZU1hcCIsIk1hcCIsInBob3Rvbk1heEp1bXBEaXN0YW5jZSIsIldJRFRIIiwiY2hlY2tGb3JQaG90b25JbnRlcmFjdGlvbiIsInBob3RvbiIsInJlc3VsdCIsInByZXZpb3VzUGhvdG9uQWx0aXR1ZGUiLCJwcmV2aW91c1Bvc2l0aW9uIiwieSIsImN1cnJlbnRQaG90b25BbHRpdHVkZSIsInBvc2l0aW9uUHJvcGVydHkiLCJ2YWx1ZSIsImxheWVyQWx0aXR1ZGUiLCJhbHRpdHVkZSIsImJvdHRvbU9mTGF5ZXJBbHRpdHVkZSIsInRvcE9mTGF5ZXJBbHRpdHVkZSIsImlzQWN0aXZlUHJvcGVydHkiLCJuZXh0RG91YmxlIiwiZW5lcmd5QWJzb3JwdGlvblByb3BvcnRpb25Qcm9wZXJ0eSIsInJlbW92ZSIsInNldCIsInN0ZXAiLCJkdCIsImFic29ycHRpb25UaW1lIiwidXBkYXRlZEFic29ycHRpb25UaW1lIiwidmVsb2NpdHkiLCJjcmVhdGVQaG90b25SZWxlYXNlVmVsb2NpdHkiLCJjcmVhdGVQaG90b25SZWxlYXNlUG9zaXRpb24iLCJyZXNldFByZXZpb3VzUG9zaXRpb24iLCJkZWxldGUiLCJwdXNoIiwicmVzZXQiLCJjbGVhciIsImp1bXAiLCJuZXh0RG91YmxlQmV0d2VlbiIsIngiLCJTUEVFRF9PRl9MSUdIVCIsIm5leHRCb29sZWFuIiwic2V0WSIsInJvdGF0ZSIsIk1hdGgiLCJQSSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUGhvdG9uQWJzb3JiaW5nRW1pdHRpbmdMYXllci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBQaG90b25BYnNvcmJpbmdFbWl0dGluZ0xheWVyIGlzIGEgbW9kZWwgZWxlbWVudCB0aGF0IGlzIHJlc3BvbnNpYmxlIGZvciBhYnNvcmJpbmcgYW5kIHJlLWVtaXR0aW5nIGluZGl2aWR1YWwgcGhvdG9uc1xyXG4gKiBhdCB0aGUgYWx0aXR1ZGUgd2hlcmUgYW4gQXRtb3NwaGVyZUxheWVyIGV4aXN0cy4gIEl0IGRvZXMgdGhpcyBiYXNlZCBvbiB0aGUgYWJzb3JiYW5jZSBvZiB0aGUgYXRtb3NwaGVyZSBsYXllci5cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZUFycmF5IH0gZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9jcmVhdGVPYnNlcnZhYmxlQXJyYXkuanMnO1xyXG5pbXBvcnQgZG90UmFuZG9tIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9kb3RSYW5kb20uanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBFbnVtZXJhdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvRW51bWVyYXRpb24uanMnO1xyXG5pbXBvcnQgRW51bWVyYXRpb25WYWx1ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvRW51bWVyYXRpb25WYWx1ZS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBncmVlbmhvdXNlRWZmZWN0IGZyb20gJy4uLy4uL2dyZWVuaG91c2VFZmZlY3QuanMnO1xyXG5pbXBvcnQgR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cyBmcm9tICcuLi9HcmVlbmhvdXNlRWZmZWN0Q29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEF0bW9zcGhlcmVMYXllciBmcm9tICcuL0F0bW9zcGhlcmVMYXllci5qcyc7XHJcbmltcG9ydCBQaG90b24gZnJvbSAnLi9QaG90b24uanMnO1xyXG5cclxuLy8gZW51bSB0aGF0IGVudW1lcmF0ZXMgdGhlIHBvc3NpYmxlIHJlc3VsdHMgd2hlbiB0ZXN0aW5nIHdoZXRoZXIgYSBwaG90b24gY3Jvc3NlZCBhIGxheWVyXHJcbmNsYXNzIFBob3RvbkNyb3NzaW5nVGVzdFJlc3VsdCBleHRlbmRzIEVudW1lcmF0aW9uVmFsdWUge1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgRlVMTFlfQUJPVkUgPSBuZXcgUGhvdG9uQ3Jvc3NpbmdUZXN0UmVzdWx0KCk7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBGVUxMWV9CRUxPVyA9IG5ldyBQaG90b25Dcm9zc2luZ1Rlc3RSZXN1bHQoKTtcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IENST1NTRURfQlVUX0lHTk9SRUQgPSBuZXcgUGhvdG9uQ3Jvc3NpbmdUZXN0UmVzdWx0KCk7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBDUk9TU0VEX0FORF9BQlNPUkJFRCA9IG5ldyBQaG90b25Dcm9zc2luZ1Rlc3RSZXN1bHQoKTtcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IE5PTkUgPSBuZXcgUGhvdG9uQ3Jvc3NpbmdUZXN0UmVzdWx0KCk7XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgZW51bWVyYXRpb24gPSBuZXcgRW51bWVyYXRpb24oIFBob3RvbkNyb3NzaW5nVGVzdFJlc3VsdCApO1xyXG59XHJcblxyXG50eXBlIFBob3RvbkFic29yYmluZ0VtaXR0aW5nTGF5ZXJPcHRpb25zID0ge1xyXG5cclxuICAvLyB0aGlja25lc3Mgb2YgdGhlIGxheWVyLCBpbiBtZXRlcnNcclxuICB0aGlja25lc3M/OiBudW1iZXI7XHJcblxyXG4gIC8vIFRoaXMgdmFsdWUgcmVwcmVzZW50cyB0aGUgbWF4aW11bSBsYXRlcmFsIGRpc3RhbmNlLCBleHByZXNzZWQgaW4gcHJvcG9ydGlvbiBvZiB0aGUgdG90YWwgbGF5ZXIgd2lkdGgsIGJldHdlZW5cclxuICAvLyB3aGVyZSBhIHBob3RvbiBpcyBhYnNvcmJlZCBpbiBhIGxheWVyIHRvIHdoZXJlIGl0IGlzIHJlLWVtaXR0ZWQuXHJcbiAgcGhvdG9uTWF4TGF0ZXJhbEp1bXBQcm9wb3J0aW9uPzogbnVtYmVyO1xyXG5cclxuICAvLyB0aGUgdGltZSB0aGF0IGEgcGhvdG9uIGlzIGFic29yYmVkIGludG8gYSBsYXllciBiZWZvcmUgYmVpbmcgcmUtZW1pdHRlZFxyXG4gIHBob3RvbkFic29ycHRpb25UaW1lPzogbnVtYmVyO1xyXG5cclxuICAvLyBBIG11bHRpcGxpZXIgdGhhdCBpcyB1c2VkIG9uIHRoZSBsYXllcidzIGFic29yYmFuY2UgdmFsdWUgd2hlbiBkZWNpZGluZyB3aGV0aGVyIHRvIGFic29yYiBhIHBob3Rvbi4gIFRoaXMgY2FuIGJlXHJcbiAgLy8gdXNlZCB0byBpbmNyZWFzZSBvciBkZWNyZWFzZSB0aGUgYW1vdW50IG9mIHBob3RvbnMgYWJzb3JiZWQgYmV5b25kIHdoYXQgaGFwcGVucyBcIm5hdHVyYWxseVwiLCBpLmUuIGJhc2VkIG9uIHRoZVxyXG4gIC8vIGFic29yYmFuY2Ugb2YgdGhlIGNvcnJlc3BvbmRpbmcgQXRtb3NwaGVyZUxheWVyLiAgTm90ZSB0aGF0IHRoaXMgZG9lcyAqbm90KiBjaGFuZ2UgdGhlIGVuZXJneSBhYnNvcmJhbmNlIGJlaGF2aW9yLFxyXG4gIC8vIGFuZCB0aHVzIHdvdWxkIGhhdmUgbm8gaW1wYWN0IG9uIHRoZSB0ZW1wZXJhdHVyZSB2YWx1ZXMuXHJcbiAgYWJzb3JiYW5jZU11bHRpcGxpZXI/OiBudW1iZXI7XHJcbn07XHJcblxyXG5jbGFzcyBQaG90b25BYnNvcmJpbmdFbWl0dGluZ0xheWVyIHtcclxuICBwdWJsaWMgcmVhZG9ubHkgdGhpY2tuZXNzOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBwaG90b25BYnNvcnB0aW9uVGltZTogbnVtYmVyO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcGhvdG9uTWF4SnVtcERpc3RhbmNlOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBhYnNvcmJhbmNlTXVsdGlwbGllcjogbnVtYmVyO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcGhvdG9uVG9BYnNvcmJlZFRpbWVNYXA6IE1hcDxQaG90b24sIG51bWJlcj47XHJcbiAgcHVibGljIHJlYWRvbmx5IHBob3RvbnM6IE9ic2VydmFibGVBcnJheTxQaG90b24+O1xyXG4gIHByaXZhdGUgYXRtb3NwaGVyZUxheWVyOiBBdG1vc3BoZXJlTGF5ZXI7XHJcbiAgcHVibGljIGF0TGVhc3RPbmVQaG90b25BYnNvcmJlZFByb3BlcnR5OiBCb29sZWFuUHJvcGVydHk7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcGhvdG9uczogT2JzZXJ2YWJsZUFycmF5PFBob3Rvbj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBhdG1vc3BoZXJlTGF5ZXI6IEF0bW9zcGhlcmVMYXllcixcclxuICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVkT3B0aW9ucz86IFBob3RvbkFic29yYmluZ0VtaXR0aW5nTGF5ZXJPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8UGhvdG9uQWJzb3JiaW5nRW1pdHRpbmdMYXllck9wdGlvbnM+KCkoIHtcclxuICAgICAgdGhpY2tuZXNzOiAwLFxyXG4gICAgICBwaG90b25NYXhMYXRlcmFsSnVtcFByb3BvcnRpb246IDAuMDEsXHJcbiAgICAgIHBob3RvbkFic29ycHRpb25UaW1lOiAwLjEsXHJcbiAgICAgIGFic29yYmFuY2VNdWx0aXBsaWVyOiAxXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLnBob3RvbnMgPSBwaG90b25zO1xyXG4gICAgdGhpcy5hdG1vc3BoZXJlTGF5ZXIgPSBhdG1vc3BoZXJlTGF5ZXI7XHJcbiAgICB0aGlzLmF0TGVhc3RPbmVQaG90b25BYnNvcmJlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuICAgIHRoaXMudGhpY2tuZXNzID0gb3B0aW9ucy50aGlja25lc3M7XHJcblxyXG4gICAgLy8gYSBNYXAgdGhhdCBpcyB1c2VkIHRvIHRyYWNrIHRoZSBhbW91bnQgb2YgdGltZSB0aGF0IGFuIGFic29yYmVkIHBob3RvbiBoYXMgYmVlbiBhYnNvcmJlZCBpbnRvIHRoaXMgbGF5ZXJcclxuICAgIHRoaXMucGhvdG9uVG9BYnNvcmJlZFRpbWVNYXAgPSBuZXcgTWFwPFBob3RvbiwgbnVtYmVyPigpO1xyXG5cclxuICAgIC8vIG9wdGlvbnMgdGhhdCBjb250cm9sIHZhcmlvdXMgYXNwZWN0cyBvZiB0aGUgcGhvdG9uIHJlLWVtaXNzaW9uIHByb2Nlc3NcclxuICAgIHRoaXMucGhvdG9uQWJzb3JwdGlvblRpbWUgPSBvcHRpb25zLnBob3RvbkFic29ycHRpb25UaW1lO1xyXG4gICAgdGhpcy5waG90b25NYXhKdW1wRGlzdGFuY2UgPSBvcHRpb25zLnBob3Rvbk1heExhdGVyYWxKdW1wUHJvcG9ydGlvbiAqIEF0bW9zcGhlcmVMYXllci5XSURUSDtcclxuICAgIHRoaXMuYWJzb3JiYW5jZU11bHRpcGxpZXIgPSBvcHRpb25zLmFic29yYmFuY2VNdWx0aXBsaWVyO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgYSBwaG90b24gZm9yIHdoZXRoZXIgaXQgaGFzIGNyb3NzZWQgdGhpcyBsYXllciBhbmQsIGlmIHNvLCBkZWNpZGUgYmFzZWQgb24gdGhlIGxheWVyJ3MgYWJzb3JiYW5jZSBhbmQgc29tZVxyXG4gICAqIHJhbmRvbSBmYWN0b3JzIHdoZXRoZXIgdGhlIHBob3RvbiBzaG91bGQgYmUgYWJzb3JiZWQgYW5kLCBpZiBzbywgZG8gdGhlIGFic29ycHRpb24uXHJcbiAgICogQHBhcmFtIHBob3RvbiAtIHRoZSBwaG90b24gdG8gYmUgdGVzdGVkXHJcbiAgICogQHJldHVybnMgLSBhbiBlbnVtIHZhbHVlIGluZGljYXRpbmcgdGhlIHR5cGUgb2YgaW50ZXJhY3Rpb24gdGhhdCBvY2N1cnJlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjaGVja0ZvclBob3RvbkludGVyYWN0aW9uKCBwaG90b246IFBob3RvbiApOiBQaG90b25Dcm9zc2luZ1Rlc3RSZXN1bHQge1xyXG4gICAgbGV0IHJlc3VsdCA9IFBob3RvbkNyb3NzaW5nVGVzdFJlc3VsdC5OT05FO1xyXG4gICAgY29uc3QgcHJldmlvdXNQaG90b25BbHRpdHVkZSA9IHBob3Rvbi5wcmV2aW91c1Bvc2l0aW9uLnk7XHJcbiAgICBjb25zdCBjdXJyZW50UGhvdG9uQWx0aXR1ZGUgPSBwaG90b24ucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS55O1xyXG4gICAgY29uc3QgbGF5ZXJBbHRpdHVkZSA9IHRoaXMuYXRtb3NwaGVyZUxheWVyLmFsdGl0dWRlO1xyXG5cclxuICAgIC8vIFRPRE86IFRoZSBkZXNpZ24gdGVhbSBpcyB3b3JraW5nIG9uIGltcHJvdmluZyBob3cgdGhlIGFic29ycHRpb24gYW5kIHJlLWVtaXNzaW9uIG9mIHBob3RvbnMgbG9va3MuICBPbiA2LzEvMjAyMlxyXG4gICAgLy8gICAgICAgdGhlIHRoaWNrbmVzcyBvZiB0aGUgbGF5ZXJzIHdhcyBhZGp1c3RlZCB0byBiZSBxdWl0ZSB0aGluIHNvIHRoYXQgdGhlIHBob3RvbnMgZGlkbid0IGFwcGVhciB0byBqdW1wIGFjcm9zc1xyXG4gICAgLy8gICAgICAgdGhlIGxheWVycy4gIFRoaXMgd2lsbCBuZWVkIHRvIGJlIHJlZmluZWQgb25jZSB0aGUgdmlzdWFsIHBvcnRyYXlhbCBpcyBmaW5hbGl6ZWQuICBTZWVcclxuICAgIC8vICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmVlbmhvdXNlLWVmZmVjdC9pc3N1ZXMvMTY3LlxyXG4gICAgY29uc3QgYm90dG9tT2ZMYXllckFsdGl0dWRlID0gbGF5ZXJBbHRpdHVkZSAtIHRoaXMudGhpY2tuZXNzICogMC4wMDAxO1xyXG4gICAgY29uc3QgdG9wT2ZMYXllckFsdGl0dWRlID0gbGF5ZXJBbHRpdHVkZSArIHRoaXMudGhpY2tuZXNzICogMC4wMDAxO1xyXG5cclxuICAgIC8vIFRPRE86IFRoaXMgaXMgYSBsaXR0bGUgaGFyZCB0byByZWFkLCBjb25zaWRlciBDUk9TU0VEX0lOREVURVJNSU5BVEUgaW4gdGhlIGZpcnN0IHBvcnRpb24sIHRoZW4gcG9zdCBwcm9jZXNzLCBvciBzb21ldGhpbmcuXHJcbiAgICBpZiAoIHByZXZpb3VzUGhvdG9uQWx0aXR1ZGUgPCBib3R0b21PZkxheWVyQWx0aXR1ZGUgKSB7XHJcbiAgICAgIGlmICggY3VycmVudFBob3RvbkFsdGl0dWRlIDwgYm90dG9tT2ZMYXllckFsdGl0dWRlICkge1xyXG4gICAgICAgIHJlc3VsdCA9IFBob3RvbkNyb3NzaW5nVGVzdFJlc3VsdC5GVUxMWV9CRUxPVztcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXN1bHQgPSBQaG90b25Dcm9zc2luZ1Rlc3RSZXN1bHQuQ1JPU1NFRF9CVVRfSUdOT1JFRDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIHByZXZpb3VzUGhvdG9uQWx0aXR1ZGUgPiB0b3BPZkxheWVyQWx0aXR1ZGUgKSB7XHJcbiAgICAgIGlmICggY3VycmVudFBob3RvbkFsdGl0dWRlID4gdG9wT2ZMYXllckFsdGl0dWRlICkge1xyXG4gICAgICAgIHJlc3VsdCA9IFBob3RvbkNyb3NzaW5nVGVzdFJlc3VsdC5GVUxMWV9BQk9WRTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXN1bHQgPSBQaG90b25Dcm9zc2luZ1Rlc3RSZXN1bHQuQ1JPU1NFRF9CVVRfSUdOT1JFRDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIElmIHRoZSBwaG90b24gaGFzIGNyb3NzZWQgdGhpcyBsYXllciwgY2hlY2sgd2hldGhlciBpdCBzaG91bGQgYmUgYWJzb3JiZWQuXHJcbiAgICBpZiAoIHRoaXMuYXRtb3NwaGVyZUxheWVyLmlzQWN0aXZlUHJvcGVydHkudmFsdWUgJiYgcmVzdWx0ID09PSBQaG90b25Dcm9zc2luZ1Rlc3RSZXN1bHQuQ1JPU1NFRF9CVVRfSUdOT1JFRCApIHtcclxuXHJcbiAgICAgIC8vIERlY2lkZSB3aGV0aGVyIHRvIGFic29yYiB0aGUgcGhvdG9uIGJhc2VkIG9uIHRoZSBhYnNvcnB0aW9uIHByb3BvcnRpb24gYW5kIGEgcmFuZG9tIHZhbHVlLlxyXG4gICAgICBpZiAoIGRvdFJhbmRvbS5uZXh0RG91YmxlKCkgPD1cclxuICAgICAgICAgICAoIHRoaXMuYXRtb3NwaGVyZUxheWVyLmVuZXJneUFic29ycHRpb25Qcm9wb3J0aW9uUHJvcGVydHkudmFsdWUgKiB0aGlzLmFic29yYmFuY2VNdWx0aXBsaWVyICkgKSB7XHJcblxyXG4gICAgICAgIC8vIEFic29yYiB0aGUgcGhvdG9uIGJ5IHJlbW92aW5nIGl0IGZyb20gdGhlIGxpc3QgYW5kIGFkZGluZyBpdCB0byB0aGUgbG9jYWwgbWFwIHRoYXQgd2lsbCB0cmFjayB0aGUgdGltZSBmb3JcclxuICAgICAgICAvLyB3aGljaCBpdCBoYXMgYmVlbiBhYnNvcmJlZCBpbiB0aGlzIGxheWVyLlxyXG4gICAgICAgIHRoaXMucGhvdG9ucy5yZW1vdmUoIHBob3RvbiApO1xyXG4gICAgICAgIHRoaXMucGhvdG9uVG9BYnNvcmJlZFRpbWVNYXAuc2V0KCBwaG90b24sIDAgKTtcclxuICAgICAgICB0aGlzLmF0TGVhc3RPbmVQaG90b25BYnNvcmJlZFByb3BlcnR5LnNldCggdHJ1ZSApO1xyXG4gICAgICAgIHJlc3VsdCA9IFBob3RvbkNyb3NzaW5nVGVzdFJlc3VsdC5DUk9TU0VEX0FORF9BQlNPUkJFRDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZS1lbWl0IGFueSBwcmV2aW91c2x5IGFic29yYmVkIHBob3RvbnMgdGhhdCBhcmUgcmVhZHkuXHJcbiAgICogQHBhcmFtIGR0IC0gZGVsdGEgdGltZSwgaW4gc2Vjb25kc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGVwKCBkdDogbnVtYmVyICk6IHZvaWQge1xyXG5cclxuICAgIC8vIEZvciBlYWNoIG9mIHRoZSBwaG90b25zIHRoYXQgaGF2ZSBiZWVuIGFic29yYmVkIGludG8gdGhpcyBsYXllciwgZGVjaWRlIHdoZXRoZXIgaXQgc2hvdWxkIGJlIHJlLWVtaXR0ZWQgYW5kLCBpZlxyXG4gICAgLy8gc28sIGRlY2lkZSB3aGVyZSBhbmQgaW4gd2hhdCBkaXJlY3Rpb24uICBJZiBub3QsIHVwZGF0ZSB0aGUgYWJzb3JiZWQgdGltZS5cclxuICAgIGZvciAoIGNvbnN0IFsgcGhvdG9uLCBhYnNvcnB0aW9uVGltZSBdIG9mIHRoaXMucGhvdG9uVG9BYnNvcmJlZFRpbWVNYXAgKSB7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZWRBYnNvcnB0aW9uVGltZSA9IGFic29ycHRpb25UaW1lICsgZHQ7XHJcbiAgICAgIGlmICggdXBkYXRlZEFic29ycHRpb25UaW1lID4gdGhpcy5waG90b25BYnNvcnB0aW9uVGltZSApIHtcclxuXHJcbiAgICAgICAgLy8gVGhpcyBwaG90b24gaGFzIGJlZW4gYXJvdW5kIGxvbmcgZW5vdWdoLCBhbmQgaXQncyB0aW1lIHRvIHJlbGVhc2UgaXQuXHJcbiAgICAgICAgcGhvdG9uLnZlbG9jaXR5LnNldCggUGhvdG9uQWJzb3JiaW5nRW1pdHRpbmdMYXllci5jcmVhdGVQaG90b25SZWxlYXNlVmVsb2NpdHkoKSApO1xyXG4gICAgICAgIHBob3Rvbi5wb3NpdGlvblByb3BlcnR5LnNldCggdGhpcy5jcmVhdGVQaG90b25SZWxlYXNlUG9zaXRpb24oIHBob3RvbiApICk7XHJcbiAgICAgICAgcGhvdG9uLnJlc2V0UHJldmlvdXNQb3NpdGlvbigpO1xyXG4gICAgICAgIHRoaXMucGhvdG9uVG9BYnNvcmJlZFRpbWVNYXAuZGVsZXRlKCBwaG90b24gKTtcclxuICAgICAgICB0aGlzLnBob3RvbnMucHVzaCggcGhvdG9uICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdGhpcy5waG90b25Ub0Fic29yYmVkVGltZU1hcC5zZXQoIHBob3RvbiwgdXBkYXRlZEFic29ycHRpb25UaW1lICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMucGhvdG9uVG9BYnNvcmJlZFRpbWVNYXAuY2xlYXIoKTtcclxuICAgIHRoaXMuYXRMZWFzdE9uZVBob3RvbkFic29yYmVkUHJvcGVydHkucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBhIHJlbGVhc2UgcG9zaXRpb24gdGhhdCBpcyByYW5kb20gYW5kIGJhc2VkIG9uIHRoZSBvcHRpb24gdGhhdCBzcGVjaWZpZXMgdGhlIGhvcml6b250YWwgdmFyaWF0aW9uIGFuZCB0aGVcclxuICAgKiBhbHRpdHVkZSBvZiB0aGUgbGF5ZXIuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjcmVhdGVQaG90b25SZWxlYXNlUG9zaXRpb24oIHBob3RvbjogUGhvdG9uICk6IFZlY3RvcjIge1xyXG4gICAgY29uc3QganVtcCA9IHRoaXMucGhvdG9uTWF4SnVtcERpc3RhbmNlICogZG90UmFuZG9tLm5leHREb3VibGVCZXR3ZWVuKCAtMSwgMSApO1xyXG4gICAgcmV0dXJuIG5ldyBWZWN0b3IyKCBwaG90b24ucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS54ICsganVtcCwgdGhpcy5hdG1vc3BoZXJlTGF5ZXIuYWx0aXR1ZGUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSB0aGUgcmVsZWFzZSB2ZWxvY2l0eSBmb3IgdGhpcyBwaG90b24uICBUaGUgc3BlZWQgbXVzdCBiZSB0aGUgc2ltdWxhdGlvbidzIHZhbHVlIGZvciB0aGUgc3BlZWQgb2YgbGlnaHQsXHJcbiAgICogYnV0IHRoZSBkaXJlY3Rpb24gY2FuIGJlIGdlbmVyYWxseSB1cCBvciBkb3duIGFuZCB3aXRoaW4gYSBcImNvZGVcIiBvZiBwb3NzaWJsZSBkaXJlY3Rpb25zLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIGNyZWF0ZVBob3RvblJlbGVhc2VWZWxvY2l0eSgpOiBWZWN0b3IyIHtcclxuICAgIGNvbnN0IHZlbG9jaXR5ID0gbmV3IFZlY3RvcjIoIDAsIEdyZWVuaG91c2VFZmZlY3RDb25zdGFudHMuU1BFRURfT0ZfTElHSFQgKTtcclxuXHJcbiAgICAvLyBSYW5kb21seSBkZXRlcm1pbmUgaWYgdGhlIGdlbmVyYWwgZGlyZWN0aW9uIHNob3VsZCBiZSB1cCBvciBkb3duLlxyXG4gICAgaWYgKCBkb3RSYW5kb20ubmV4dEJvb2xlYW4oKSApIHtcclxuICAgICAgdmVsb2NpdHkuc2V0WSggLXZlbG9jaXR5LnkgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBZGQgc29tZSByYW5kb21uZXNzIHRvIHRoZSBnZW5lcmFsIGRpcmVjdGlvbi5cclxuICAgIHZlbG9jaXR5LnJvdGF0ZSggZG90UmFuZG9tLm5leHREb3VibGVCZXR3ZWVuKCAtMSwgMSApICogTWF0aC5QSSAvIDQgKTtcclxuXHJcbiAgICByZXR1cm4gdmVsb2NpdHk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgdHlwZSB7IFBob3RvbkFic29yYmluZ0VtaXR0aW5nTGF5ZXJPcHRpb25zIH07XHJcbmV4cG9ydCB7IFBob3RvbkNyb3NzaW5nVGVzdFJlc3VsdCB9O1xyXG5cclxuZ3JlZW5ob3VzZUVmZmVjdC5yZWdpc3RlciggJ1Bob3RvbkFic29yYmluZ0VtaXR0aW5nTGF5ZXInLCBQaG90b25BYnNvcmJpbmdFbWl0dGluZ0xheWVyICk7XHJcbmV4cG9ydCBkZWZhdWx0IFBob3RvbkFic29yYmluZ0VtaXR0aW5nTGF5ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUVwRSxPQUFPQyxTQUFTLE1BQU0saUNBQWlDO0FBQ3ZELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsV0FBVyxNQUFNLHlDQUF5QztBQUNqRSxPQUFPQyxnQkFBZ0IsTUFBTSw4Q0FBOEM7QUFDM0UsT0FBT0MsU0FBUyxNQUFNLHVDQUF1QztBQUM3RCxPQUFPQyxnQkFBZ0IsTUFBTSwyQkFBMkI7QUFDeEQsT0FBT0MseUJBQXlCLE1BQU0saUNBQWlDO0FBQ3ZFLE9BQU9DLGVBQWUsTUFBTSxzQkFBc0I7QUFHbEQ7QUFDQSxNQUFNQyx3QkFBd0IsU0FBU0wsZ0JBQWdCLENBQUM7RUFDdEQsT0FBdUJNLFdBQVcsR0FBRyxJQUFJRCx3QkFBd0IsQ0FBQyxDQUFDO0VBQ25FLE9BQXVCRSxXQUFXLEdBQUcsSUFBSUYsd0JBQXdCLENBQUMsQ0FBQztFQUNuRSxPQUF1QkcsbUJBQW1CLEdBQUcsSUFBSUgsd0JBQXdCLENBQUMsQ0FBQztFQUMzRSxPQUF1Qkksb0JBQW9CLEdB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