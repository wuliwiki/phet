// Copyright 2021-2022, University of Colorado Boulder

/**
 * Photon is a model of a simple photon with the attributes needed by the Greenhouse Effect simulation.
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import Vector2Property from '../../../../dot/js/Vector2Property.js';
import Enumeration from '../../../../phet-core/js/Enumeration.js';
import EnumerationValue from '../../../../phet-core/js/EnumerationValue.js';
import optionize from '../../../../phet-core/js/optionize.js';
import EnumerationIO from '../../../../tandem/js/types/EnumerationIO.js';
import IOType from '../../../../tandem/js/types/IOType.js';
import NumberIO from '../../../../tandem/js/types/NumberIO.js';
import StringIO from '../../../../tandem/js/types/StringIO.js';
import greenhouseEffect from '../../greenhouseEffect.js';
import GreenhouseEffectConstants from '../GreenhouseEffectConstants.js';

// constants
const PHOTON_SPEED = GreenhouseEffectConstants.SPEED_OF_LIGHT;

// TODO - These should be consolidated with the molecules-and-light code, see https://github.com/phetsims/greenhouse-effect/issues/19
const IR_WAVELENGTH = GreenhouseEffectConstants.INFRARED_WAVELENGTH;
const VISIBLE_WAVELENGTH = GreenhouseEffectConstants.VISIBLE_WAVELENGTH;
const SUPPORTED_WAVELENGTHS = [IR_WAVELENGTH, VISIBLE_WAVELENGTH];

// types and enumerations
class ShowState extends EnumerationValue {
  static ALWAYS = new ShowState();
  static ONLY_IN_MORE_PHOTONS_MODE = new ShowState();
  static enumeration = new Enumeration(ShowState);
}
// TODO: Consider just having a direction instead of a velocity, which is what is done elsewhere in the sim, since
//       photons should always be moving at the speed of light.
class Photon {
  // position in model space in meters

  // previous position, used for checking when the photon has crossed some threshold

  // velocity vector in m/s

  // wavelength in meters

  // This flag determines whether this photon should always be shown in the view or only shown when the "more photons"
  // mode has been set.
  constructor(initialPosition, wavelength, providedOptions) {
    const options = optionize()({
      initialVelocity: null,
      showState: ShowState.ALWAYS
    }, providedOptions);
    assert && assert(SUPPORTED_WAVELENGTHS.includes(wavelength), 'unsupported wavelength');
    this.wavelength = wavelength;
    this.positionProperty = new Vector2Property(initialPosition);
    this.previousPosition = new Vector2(initialPosition.x, initialPosition.y);
    this.velocity = options.initialVelocity || new Vector2(0, PHOTON_SPEED);
    this.showState = options.showState;
  }

  /**
   * Step the model in time.
   * @param dt - delta time, in seconds
   */
  step(dt) {
    // Keep track of the previous position, meaning the position just prior to the most recent update.  This is used to
    // detect whether a photon has crossed a boundary.
    this.previousPosition.set(this.positionProperty.value);

    // Update the position.
    this.positionProperty.set(this.positionProperty.value.plus(this.velocity.timesScalar(dt)));
  }

  /**
   * convenience method for determining whether this is a visible photon
   */
  get isVisible() {
    return this.wavelength === GreenhouseEffectConstants.VISIBLE_WAVELENGTH;
  }

  /**
   * convenience method for determining whether this is an infrared photon
   */
  get isInfrared() {
    return this.wavelength === GreenhouseEffectConstants.INFRARED_WAVELENGTH;
  }

  /**
   * Reset the previous position by making it match the current position.  This is generally used when a photon is
   * being released from something, and we don't want to detect false layer crossing after the release.
   */
  resetPreviousPosition() {
    this.previousPosition.set(this.positionProperty.value);
  }
  toStateObject() {
    return {
      position: this.positionProperty.value.toStateObject(),
      previousPosition: this.previousPosition.toStateObject(),
      wavelength: this.wavelength,
      velocity: this.velocity.toStateObject(),
      showState: EnumerationIO(ShowState).toStateObject(this.showState)
    };
  }

  // static values
  static IR_WAVELENGTH = IR_WAVELENGTH;
  static VISIBLE_WAVELENGTH = VISIBLE_WAVELENGTH;
  static SPEED = PHOTON_SPEED;
  static ShowState = ShowState;

  // phet-io
  static PhotonIO = new IOType('PhotonIO', {
    valueType: Photon,
    stateSchema: {
      position: Vector2.Vector2IO,
      previousPosition: Vector2.Vector2IO,
      wavelength: NumberIO,
      velocity: Vector2.Vector2IO,
      showState: StringIO
    },
    toStateObject: photon => photon.toStateObject(),
    fromStateObject: stateObject => new Photon(Vector2.fromStateObject(stateObject.position), stateObject.wavelength, {
      initialVelocity: Vector2.fromStateObject(stateObject.velocity),
      showState: EnumerationIO(ShowState).fromStateObject(stateObject.showState)
    })
  });
}
greenhouseEffect.register('Photon', Photon);
export { ShowState };
export default Photon;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiVmVjdG9yMlByb3BlcnR5IiwiRW51bWVyYXRpb24iLCJFbnVtZXJhdGlvblZhbHVlIiwib3B0aW9uaXplIiwiRW51bWVyYXRpb25JTyIsIklPVHlwZSIsIk51bWJlcklPIiwiU3RyaW5nSU8iLCJncmVlbmhvdXNlRWZmZWN0IiwiR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cyIsIlBIT1RPTl9TUEVFRCIsIlNQRUVEX09GX0xJR0hUIiwiSVJfV0FWRUxFTkdUSCIsIklORlJBUkVEX1dBVkVMRU5HVEgiLCJWSVNJQkxFX1dBVkVMRU5HVEgiLCJTVVBQT1JURURfV0FWRUxFTkdUSFMiLCJTaG93U3RhdGUiLCJBTFdBWVMiLCJPTkxZX0lOX01PUkVfUEhPVE9OU19NT0RFIiwiZW51bWVyYXRpb24iLCJQaG90b24iLCJjb25zdHJ1Y3RvciIsImluaXRpYWxQb3NpdGlvbiIsIndhdmVsZW5ndGgiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiaW5pdGlhbFZlbG9jaXR5Iiwic2hvd1N0YXRlIiwiYXNzZXJ0IiwiaW5jbHVkZXMiLCJwb3NpdGlvblByb3BlcnR5IiwicHJldmlvdXNQb3NpdGlvbiIsIngiLCJ5IiwidmVsb2NpdHkiLCJzdGVwIiwiZHQiLCJzZXQiLCJ2YWx1ZSIsInBsdXMiLCJ0aW1lc1NjYWxhciIsImlzVmlzaWJsZSIsImlzSW5mcmFyZWQiLCJyZXNldFByZXZpb3VzUG9zaXRpb24iLCJ0b1N0YXRlT2JqZWN0IiwicG9zaXRpb24iLCJTUEVFRCIsIlBob3RvbklPIiwidmFsdWVUeXBlIiwic3RhdGVTY2hlbWEiLCJWZWN0b3IySU8iLCJwaG90b24iLCJmcm9tU3RhdGVPYmplY3QiLCJzdGF0ZU9iamVjdCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUGhvdG9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIxLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFBob3RvbiBpcyBhIG1vZGVsIG9mIGEgc2ltcGxlIHBob3RvbiB3aXRoIHRoZSBhdHRyaWJ1dGVzIG5lZWRlZCBieSB0aGUgR3JlZW5ob3VzZSBFZmZlY3Qgc2ltdWxhdGlvbi5cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgVmVjdG9yMiwgeyBWZWN0b3IyU3RhdGVPYmplY3QgfSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBWZWN0b3IyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBFbnVtZXJhdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvRW51bWVyYXRpb24uanMnO1xyXG5pbXBvcnQgRW51bWVyYXRpb25WYWx1ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvRW51bWVyYXRpb25WYWx1ZS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBFbnVtZXJhdGlvbklPIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9FbnVtZXJhdGlvbklPLmpzJztcclxuaW1wb3J0IElPVHlwZSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvSU9UeXBlLmpzJztcclxuaW1wb3J0IE51bWJlcklPIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdW1iZXJJTy5qcyc7XHJcbmltcG9ydCBTdHJpbmdJTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvU3RyaW5nSU8uanMnO1xyXG5pbXBvcnQgZ3JlZW5ob3VzZUVmZmVjdCBmcm9tICcuLi8uLi9ncmVlbmhvdXNlRWZmZWN0LmpzJztcclxuaW1wb3J0IEdyZWVuaG91c2VFZmZlY3RDb25zdGFudHMgZnJvbSAnLi4vR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgUEhPVE9OX1NQRUVEID0gR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cy5TUEVFRF9PRl9MSUdIVDtcclxuXHJcbi8vIFRPRE8gLSBUaGVzZSBzaG91bGQgYmUgY29uc29saWRhdGVkIHdpdGggdGhlIG1vbGVjdWxlcy1hbmQtbGlnaHQgY29kZSwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmVlbmhvdXNlLWVmZmVjdC9pc3N1ZXMvMTlcclxuY29uc3QgSVJfV0FWRUxFTkdUSCA9IEdyZWVuaG91c2VFZmZlY3RDb25zdGFudHMuSU5GUkFSRURfV0FWRUxFTkdUSDtcclxuY29uc3QgVklTSUJMRV9XQVZFTEVOR1RIID0gR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cy5WSVNJQkxFX1dBVkVMRU5HVEg7XHJcbmNvbnN0IFNVUFBPUlRFRF9XQVZFTEVOR1RIUyA9IFsgSVJfV0FWRUxFTkdUSCwgVklTSUJMRV9XQVZFTEVOR1RIIF07XHJcblxyXG4vLyB0eXBlcyBhbmQgZW51bWVyYXRpb25zXHJcbmNsYXNzIFNob3dTdGF0ZSBleHRlbmRzIEVudW1lcmF0aW9uVmFsdWUge1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgQUxXQVlTID0gbmV3IFNob3dTdGF0ZSgpO1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgT05MWV9JTl9NT1JFX1BIT1RPTlNfTU9ERSA9IG5ldyBTaG93U3RhdGUoKTtcclxuXHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBlbnVtZXJhdGlvbiA9IG5ldyBFbnVtZXJhdGlvbiggU2hvd1N0YXRlICk7XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIFBob3Rvbk9wdGlvbnMgPSB7XHJcblxyXG4gIC8vIGluaXRpYWwgdmVsb2NpdHkgb2YgdGhlIHBob3Rvbiwgd2lsbCBiZSBjcmVhdGVkIGlmIG5vdCBzdXBwbGllZFxyXG4gIGluaXRpYWxWZWxvY2l0eT86IFZlY3RvcjIgfCBudWxsO1xyXG5cclxuICAvLyB3aGV0aGVyIHRoaXMgcGhvdG9uIHNob3VsZCBhbHdheXMgYmUgc2hvd24gaW4gdGhlIHZpZXcgb3Igb25seSBpbiBcIm1vcmUgcGhvdG9uc1wiIG1vZGVcclxuICBzaG93U3RhdGU/OiBTaG93U3RhdGU7XHJcbn07XHJcblxyXG4vLyBUT0RPOiBDb25zaWRlciBqdXN0IGhhdmluZyBhIGRpcmVjdGlvbiBpbnN0ZWFkIG9mIGEgdmVsb2NpdHksIHdoaWNoIGlzIHdoYXQgaXMgZG9uZSBlbHNld2hlcmUgaW4gdGhlIHNpbSwgc2luY2VcclxuLy8gICAgICAgcGhvdG9ucyBzaG91bGQgYWx3YXlzIGJlIG1vdmluZyBhdCB0aGUgc3BlZWQgb2YgbGlnaHQuXHJcblxyXG5jbGFzcyBQaG90b24ge1xyXG5cclxuICAvLyBwb3NpdGlvbiBpbiBtb2RlbCBzcGFjZSBpbiBtZXRlcnNcclxuICBwdWJsaWMgcmVhZG9ubHkgcG9zaXRpb25Qcm9wZXJ0eTogVmVjdG9yMlByb3BlcnR5O1xyXG5cclxuICAvLyBwcmV2aW91cyBwb3NpdGlvbiwgdXNlZCBmb3IgY2hlY2tpbmcgd2hlbiB0aGUgcGhvdG9uIGhhcyBjcm9zc2VkIHNvbWUgdGhyZXNob2xkXHJcbiAgcHVibGljIHJlYWRvbmx5IHByZXZpb3VzUG9zaXRpb246IFZlY3RvcjI7XHJcblxyXG4gIC8vIHZlbG9jaXR5IHZlY3RvciBpbiBtL3NcclxuICBwdWJsaWMgcmVhZG9ubHkgdmVsb2NpdHk6IFZlY3RvcjI7XHJcblxyXG4gIC8vIHdhdmVsZW5ndGggaW4gbWV0ZXJzXHJcbiAgcHVibGljIHJlYWRvbmx5IHdhdmVsZW5ndGg6IG51bWJlcjtcclxuXHJcbiAgLy8gVGhpcyBmbGFnIGRldGVybWluZXMgd2hldGhlciB0aGlzIHBob3RvbiBzaG91bGQgYWx3YXlzIGJlIHNob3duIGluIHRoZSB2aWV3IG9yIG9ubHkgc2hvd24gd2hlbiB0aGUgXCJtb3JlIHBob3RvbnNcIlxyXG4gIC8vIG1vZGUgaGFzIGJlZW4gc2V0LlxyXG4gIHB1YmxpYyByZWFkb25seSBzaG93U3RhdGU6IFNob3dTdGF0ZTtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBpbml0aWFsUG9zaXRpb246IFZlY3RvcjIsIHdhdmVsZW5ndGg6IG51bWJlciwgcHJvdmlkZWRPcHRpb25zPzogUGhvdG9uT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFBob3Rvbk9wdGlvbnM+KCkoIHtcclxuICAgICAgaW5pdGlhbFZlbG9jaXR5OiBudWxsLFxyXG4gICAgICBzaG93U3RhdGU6IFNob3dTdGF0ZS5BTFdBWVNcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIFNVUFBPUlRFRF9XQVZFTEVOR1RIUy5pbmNsdWRlcyggd2F2ZWxlbmd0aCApLCAndW5zdXBwb3J0ZWQgd2F2ZWxlbmd0aCcgKTtcclxuXHJcbiAgICB0aGlzLndhdmVsZW5ndGggPSB3YXZlbGVuZ3RoO1xyXG4gICAgdGhpcy5wb3NpdGlvblByb3BlcnR5ID0gbmV3IFZlY3RvcjJQcm9wZXJ0eSggaW5pdGlhbFBvc2l0aW9uICk7XHJcbiAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24gPSBuZXcgVmVjdG9yMiggaW5pdGlhbFBvc2l0aW9uLngsIGluaXRpYWxQb3NpdGlvbi55ICk7XHJcbiAgICB0aGlzLnZlbG9jaXR5ID0gb3B0aW9ucy5pbml0aWFsVmVsb2NpdHkgfHwgbmV3IFZlY3RvcjIoIDAsIFBIT1RPTl9TUEVFRCApO1xyXG4gICAgdGhpcy5zaG93U3RhdGUgPSBvcHRpb25zLnNob3dTdGF0ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0ZXAgdGhlIG1vZGVsIGluIHRpbWUuXHJcbiAgICogQHBhcmFtIGR0IC0gZGVsdGEgdGltZSwgaW4gc2Vjb25kc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGVwKCBkdDogbnVtYmVyICk6IHZvaWQge1xyXG5cclxuICAgIC8vIEtlZXAgdHJhY2sgb2YgdGhlIHByZXZpb3VzIHBvc2l0aW9uLCBtZWFuaW5nIHRoZSBwb3NpdGlvbiBqdXN0IHByaW9yIHRvIHRoZSBtb3N0IHJlY2VudCB1cGRhdGUuICBUaGlzIGlzIHVzZWQgdG9cclxuICAgIC8vIGRldGVjdCB3aGV0aGVyIGEgcGhvdG9uIGhhcyBjcm9zc2VkIGEgYm91bmRhcnkuXHJcbiAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uc2V0KCB0aGlzLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgKTtcclxuXHJcbiAgICAvLyBVcGRhdGUgdGhlIHBvc2l0aW9uLlxyXG4gICAgdGhpcy5wb3NpdGlvblByb3BlcnR5LnNldCggdGhpcy5wb3NpdGlvblByb3BlcnR5LnZhbHVlLnBsdXMoIHRoaXMudmVsb2NpdHkudGltZXNTY2FsYXIoIGR0ICkgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogY29udmVuaWVuY2UgbWV0aG9kIGZvciBkZXRlcm1pbmluZyB3aGV0aGVyIHRoaXMgaXMgYSB2aXNpYmxlIHBob3RvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgaXNWaXNpYmxlKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMud2F2ZWxlbmd0aCA9PT0gR3JlZW5ob3VzZUVmZmVjdENvbnN0YW50cy5WSVNJQkxFX1dBVkVMRU5HVEg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBjb252ZW5pZW5jZSBtZXRob2QgZm9yIGRldGVybWluaW5nIHdoZXRoZXIgdGhpcyBpcyBhbiBpbmZyYXJlZCBwaG90b25cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGlzSW5mcmFyZWQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy53YXZlbGVuZ3RoID09PSBHcmVlbmhvdXNlRWZmZWN0Q29uc3RhbnRzLklORlJBUkVEX1dBVkVMRU5HVEg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNldCB0aGUgcHJldmlvdXMgcG9zaXRpb24gYnkgbWFraW5nIGl0IG1hdGNoIHRoZSBjdXJyZW50IHBvc2l0aW9uLiAgVGhpcyBpcyBnZW5lcmFsbHkgdXNlZCB3aGVuIGEgcGhvdG9uIGlzXHJcbiAgICogYmVpbmcgcmVsZWFzZWQgZnJvbSBzb21ldGhpbmcsIGFuZCB3ZSBkb24ndCB3YW50IHRvIGRldGVjdCBmYWxzZSBsYXllciBjcm9zc2luZyBhZnRlciB0aGUgcmVsZWFzZS5cclxuICAgKi9cclxuICBwdWJsaWMgcmVzZXRQcmV2aW91c1Bvc2l0aW9uKCk6IHZvaWQge1xyXG4gICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLnNldCggdGhpcy5wb3NpdGlvblByb3BlcnR5LnZhbHVlICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdG9TdGF0ZU9iamVjdCgpOiBQaG90b25TdGF0ZU9iamVjdCB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBwb3NpdGlvbjogdGhpcy5wb3NpdGlvblByb3BlcnR5LnZhbHVlLnRvU3RhdGVPYmplY3QoKSxcclxuICAgICAgcHJldmlvdXNQb3NpdGlvbjogdGhpcy5wcmV2aW91c1Bvc2l0aW9uLnRvU3RhdGVPYmplY3QoKSxcclxuICAgICAgd2F2ZWxlbmd0aDogdGhpcy53YXZlbGVuZ3RoLFxyXG4gICAgICB2ZWxvY2l0eTogdGhpcy52ZWxvY2l0eS50b1N0YXRlT2JqZWN0KCksXHJcbiAgICAgIHNob3dTdGF0ZTogRW51bWVyYXRpb25JTyggU2hvd1N0YXRlICkudG9TdGF0ZU9iamVjdCggdGhpcy5zaG93U3RhdGUgKVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIHN0YXRpYyB2YWx1ZXNcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IElSX1dBVkVMRU5HVEggPSBJUl9XQVZFTEVOR1RIO1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgVklTSUJMRV9XQVZFTEVOR1RIID0gVklTSUJMRV9XQVZFTEVOR1RIO1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgU1BFRUQgPSBQSE9UT05fU1BFRUQ7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBTaG93U3RhdGUgPSBTaG93U3RhdGU7XHJcblxyXG4gIC8vIHBoZXQtaW9cclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IFBob3RvbklPID0gbmV3IElPVHlwZTxQaG90b24sIFBob3RvblN0YXRlT2JqZWN0PiggJ1Bob3RvbklPJywge1xyXG4gICAgdmFsdWVUeXBlOiBQaG90b24sXHJcbiAgICBzdGF0ZVNjaGVtYToge1xyXG4gICAgICBwb3NpdGlvbjogVmVjdG9yMi5WZWN0b3IySU8sXHJcbiAgICAgIHByZXZpb3VzUG9zaXRpb246IFZlY3RvcjIuVmVjdG9yMklPLFxyXG4gICAgICB3YXZlbGVuZ3RoOiBOdW1iZXJJTyxcclxuICAgICAgdmVsb2NpdHk6IFZlY3RvcjIuVmVjdG9yMklPLFxyXG4gICAgICBzaG93U3RhdGU6IFN0cmluZ0lPXHJcbiAgICB9LFxyXG4gICAgdG9TdGF0ZU9iamVjdDogKCBwaG90b246IFBob3RvbiApID0+IHBob3Rvbi50b1N0YXRlT2JqZWN0KCksXHJcbiAgICBmcm9tU3RhdGVPYmplY3Q6ICggc3RhdGVPYmplY3Q6IFBob3RvblN0YXRlT2JqZWN0ICkgPT4gbmV3IFBob3RvbihcclxuICAgICAgVmVjdG9yMi5mcm9tU3RhdGVPYmplY3QoIHN0YXRlT2JqZWN0LnBvc2l0aW9uICksXHJcbiAgICAgIHN0YXRlT2JqZWN0LndhdmVsZW5ndGgsIHtcclxuICAgICAgICBpbml0aWFsVmVsb2NpdHk6IFZlY3RvcjIuZnJvbVN0YXRlT2JqZWN0KCBzdGF0ZU9iamVjdC52ZWxvY2l0eSApLFxyXG4gICAgICAgIHNob3dTdGF0ZTogRW51bWVyYXRpb25JTyggU2hvd1N0YXRlICkuZnJvbVN0YXRlT2JqZWN0KCBzdGF0ZU9iamVjdC5zaG93U3RhdGUgKVxyXG4gICAgICB9XHJcbiAgICApXHJcbiAgfSApO1xyXG59XHJcblxyXG5leHBvcnQgdHlwZSBQaG90b25TdGF0ZU9iamVjdCA9IHtcclxuICBwb3NpdGlvbjogVmVjdG9yMlN0YXRlT2JqZWN0O1xyXG4gIHByZXZpb3VzUG9zaXRpb246IFZlY3RvcjJTdGF0ZU9iamVjdDtcclxuICB3YXZlbGVuZ3RoOiBudW1iZXI7XHJcbiAgdmVsb2NpdHk6IFZlY3RvcjJTdGF0ZU9iamVjdDtcclxuICBzaG93U3RhdGU6IHN0cmluZztcclxufTtcclxuXHJcbmdyZWVuaG91c2VFZmZlY3QucmVnaXN0ZXIoICdQaG90b24nLCBQaG90b24gKTtcclxuZXhwb3J0IHsgU2hvd1N0YXRlIH07XHJcbmV4cG9ydCBkZWZhdWx0IFBob3RvbjtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE9BQU8sTUFBOEIsK0JBQStCO0FBQzNFLE9BQU9DLGVBQWUsTUFBTSx1Q0FBdUM7QUFDbkUsT0FBT0MsV0FBVyxNQUFNLHlDQUF5QztBQUNqRSxPQUFPQyxnQkFBZ0IsTUFBTSw4Q0FBOEM7QUFDM0UsT0FBT0MsU0FBUyxNQUFNLHVDQUF1QztBQUM3RCxPQUFPQyxhQUFhLE1BQU0sOENBQThDO0FBQ3hFLE9BQU9DLE1BQU0sTUFBTSx1Q0FBdUM7QUFDMUQsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxPQUFPQyx5QkFBeUIsTUFBTSxpQ0FBaUM7O0FBRXZFO0FBQ0EsTUFBTUMsWUFBWSxHQUFHRCx5QkFBeUIsQ0FBQ0UsY0FBYzs7QUFFN0Q7QUFDQSxNQUFNQyxhQUFhLEdBQUdILHlCQUF5QixDQUFDSSxtQkFBbUI7QUFDbkUsTUFBTUMsa0JBQWtCLEdBQUdMLHlCQUF5QixDQUFDSyxrQkFBa0I7QUFDdkUsTUFBTUMscUJBQXFCLEdBQUcsQ0FBRUgsYUFBYSxFQUFFRSxrQkFBa0IsQ0FBRTs7QUFFbkU7QUFDQSxNQUFNRSxTQUFTLFNBQVNkLGdCQUFnQixDQUFDO0VBQ3ZDLE9BQXVCZSxNQUFNLEdBQUcsSUFB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