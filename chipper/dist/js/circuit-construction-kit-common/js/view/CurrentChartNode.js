// Copyright 2019-2023, University of Colorado Boulder

/**
 * Shows the voltage as a function of time on a scrolling chart.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import createObservableArray from '../../../axon/js/createObservableArray.js';
import Vector2 from '../../../dot/js/Vector2.js';
import CCKCConstants from '../CCKCConstants.js';
import CircuitConstructionKitCommonStrings from '../CircuitConstructionKitCommonStrings.js';
import circuitConstructionKitCommon from '../circuitConstructionKitCommon.js';
import CCKCChartNode from './CCKCChartNode.js';
import optionize from '../../../phet-core/js/optionize.js';
const currentWithUnitsStringProperty = CircuitConstructionKitCommonStrings.currentWithUnitsStringProperty;
export default class CurrentChartNode extends CCKCChartNode {
  /**
   * @param circuitNode
   * @param timeProperty
   * @param visibleBoundsProperty
   * @param [providedOptions]
   */
  constructor(circuitNode, timeProperty, visibleBoundsProperty, providedOptions) {
    const options = optionize()({}, providedOptions);
    super(circuitNode, timeProperty, visibleBoundsProperty, createObservableArray(), currentWithUnitsStringProperty, providedOptions);
    this.probeNode1 = this.addProbeNode(CCKCConstants.CHART_SERIES_COLOR, CCKCConstants.CHART_SERIES_COLOR, 5, 10, this.aboveBottomLeft1Property, options.tandem.createTandem('probeNode'));
    this.lastStepTime = null;
  }

  /**
   * Records data and displays it on the chart
   * @param time - total elapsed time in seconds
   * @param dt - delta time since last update
   */
  step(time, dt) {
    if (this.meter.isActiveProperty.value) {
      const ammeterConnection = this.circuitNode.getCurrent(this.probeNode1);
      const current = ammeterConnection === null ? null : ammeterConnection.current;
      this.series.push(current === null ? null : new Vector2(time, current || 0));
      while (this.series[0] === null || this.series.length > 0 && this.series[0].x < this.timeProperty.value - CCKCConstants.NUMBER_OF_TIME_DIVISIONS) {
        this.series.shift();
      }
    }
    this.updatePen();
    this.lastStepTime = time;
  }
  sampleLatestValue() {
    // Avoid trouble during fuzzboard startup
    if (this.lastStepTime === null) {
      return;
    }
    this.series.pop();
    const ammeterConnection = this.circuitNode.getCurrent(this.probeNode1);
    const current = ammeterConnection === null ? null : ammeterConnection.current;
    assert && assert(typeof this.lastStepTime === 'number');
    if (typeof this.lastStepTime === 'number') {
      this.series.push(current === null ? null : new Vector2(this.lastStepTime, current || 0));
    }
    this.updatePen();
  }
}
circuitConstructionKitCommon.register('CurrentChartNode', CurrentChartNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVPYnNlcnZhYmxlQXJyYXkiLCJWZWN0b3IyIiwiQ0NLQ0NvbnN0YW50cyIsIkNpcmN1aXRDb25zdHJ1Y3Rpb25LaXRDb21tb25TdHJpbmdzIiwiY2lyY3VpdENvbnN0cnVjdGlvbktpdENvbW1vbiIsIkNDS0NDaGFydE5vZGUiLCJvcHRpb25pemUiLCJjdXJyZW50V2l0aFVuaXRzU3RyaW5nUHJvcGVydHkiLCJDdXJyZW50Q2hhcnROb2RlIiwiY29uc3RydWN0b3IiLCJjaXJjdWl0Tm9kZSIsInRpbWVQcm9wZXJ0eSIsInZpc2libGVCb3VuZHNQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJwcm9iZU5vZGUxIiwiYWRkUHJvYmVOb2RlIiwiQ0hBUlRfU0VSSUVTX0NPTE9SIiwiYWJvdmVCb3R0b21MZWZ0MVByb3BlcnR5IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwibGFzdFN0ZXBUaW1lIiwic3RlcCIsInRpbWUiLCJkdCIsIm1ldGVyIiwiaXNBY3RpdmVQcm9wZXJ0eSIsInZhbHVlIiwiYW1tZXRlckNvbm5lY3Rpb24iLCJnZXRDdXJyZW50IiwiY3VycmVudCIsInNlcmllcyIsInB1c2giLCJsZW5ndGgiLCJ4IiwiTlVNQkVSX09GX1RJTUVfRElWSVNJT05TIiwic2hpZnQiLCJ1cGRhdGVQZW4iLCJzYW1wbGVMYXRlc3RWYWx1ZSIsInBvcCIsImFzc2VydCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQ3VycmVudENoYXJ0Tm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTaG93cyB0aGUgdm9sdGFnZSBhcyBhIGZ1bmN0aW9uIG9mIHRpbWUgb24gYSBzY3JvbGxpbmcgY2hhcnQuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IGNyZWF0ZU9ic2VydmFibGVBcnJheSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL2NyZWF0ZU9ic2VydmFibGVBcnJheS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IENDS0NDb25zdGFudHMgZnJvbSAnLi4vQ0NLQ0NvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBDaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uU3RyaW5ncyBmcm9tICcuLi9DaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBjaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uIGZyb20gJy4uL2NpcmN1aXRDb25zdHJ1Y3Rpb25LaXRDb21tb24uanMnO1xyXG5pbXBvcnQgQ0NLQ0NoYXJ0Tm9kZSwgeyBDQ0tDQ2hhcnROb2RlT3B0aW9ucyB9IGZyb20gJy4vQ0NLQ0NoYXJ0Tm9kZS5qcyc7XHJcbmltcG9ydCBDaXJjdWl0Tm9kZSBmcm9tICcuL0NpcmN1aXROb2RlLmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCBDQ0tDUHJvYmVOb2RlIGZyb20gJy4vQ0NLQ1Byb2JlTm9kZS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5cclxuY29uc3QgY3VycmVudFdpdGhVbml0c1N0cmluZ1Byb3BlcnR5ID0gQ2lyY3VpdENvbnN0cnVjdGlvbktpdENvbW1vblN0cmluZ3MuY3VycmVudFdpdGhVbml0c1N0cmluZ1Byb3BlcnR5O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ3VycmVudENoYXJ0Tm9kZSBleHRlbmRzIENDS0NDaGFydE5vZGUge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcHJvYmVOb2RlMTogQ0NLQ1Byb2JlTm9kZTtcclxuICBwcml2YXRlIGxhc3RTdGVwVGltZTogbnVtYmVyIHwgbnVsbDtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIGNpcmN1aXROb2RlXHJcbiAgICogQHBhcmFtIHRpbWVQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB2aXNpYmxlQm91bmRzUHJvcGVydHlcclxuICAgKiBAcGFyYW0gW3Byb3ZpZGVkT3B0aW9uc11cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGNpcmN1aXROb2RlOiBDaXJjdWl0Tm9kZSwgdGltZVByb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+LCB2aXNpYmxlQm91bmRzUHJvcGVydHk6IFByb3BlcnR5PEJvdW5kczI+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWRPcHRpb25zPzogQ0NLQ0NoYXJ0Tm9kZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxDQ0tDQ2hhcnROb2RlT3B0aW9ucywgRW1wdHlTZWxmT3B0aW9ucywgQ0NLQ0NoYXJ0Tm9kZU9wdGlvbnM+KCkoIHt9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggY2lyY3VpdE5vZGUsIHRpbWVQcm9wZXJ0eSwgdmlzaWJsZUJvdW5kc1Byb3BlcnR5LCBjcmVhdGVPYnNlcnZhYmxlQXJyYXkoKSwgY3VycmVudFdpdGhVbml0c1N0cmluZ1Byb3BlcnR5LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLnByb2JlTm9kZTEgPSB0aGlzLmFkZFByb2JlTm9kZShcclxuICAgICAgQ0NLQ0NvbnN0YW50cy5DSEFSVF9TRVJJRVNfQ09MT1IsXHJcbiAgICAgIENDS0NDb25zdGFudHMuQ0hBUlRfU0VSSUVTX0NPTE9SLFxyXG4gICAgICA1LFxyXG4gICAgICAxMCxcclxuICAgICAgdGhpcy5hYm92ZUJvdHRvbUxlZnQxUHJvcGVydHksXHJcbiAgICAgIG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Byb2JlTm9kZScgKVxyXG4gICAgKTtcclxuICAgIHRoaXMubGFzdFN0ZXBUaW1lID0gbnVsbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlY29yZHMgZGF0YSBhbmQgZGlzcGxheXMgaXQgb24gdGhlIGNoYXJ0XHJcbiAgICogQHBhcmFtIHRpbWUgLSB0b3RhbCBlbGFwc2VkIHRpbWUgaW4gc2Vjb25kc1xyXG4gICAqIEBwYXJhbSBkdCAtIGRlbHRhIHRpbWUgc2luY2UgbGFzdCB1cGRhdGVcclxuICAgKi9cclxuICBwdWJsaWMgc3RlcCggdGltZTogbnVtYmVyLCBkdDogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgaWYgKCB0aGlzLm1ldGVyLmlzQWN0aXZlUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgIGNvbnN0IGFtbWV0ZXJDb25uZWN0aW9uID0gdGhpcy5jaXJjdWl0Tm9kZS5nZXRDdXJyZW50KCB0aGlzLnByb2JlTm9kZTEgKTtcclxuICAgICAgY29uc3QgY3VycmVudCA9IGFtbWV0ZXJDb25uZWN0aW9uID09PSBudWxsID8gbnVsbCA6IGFtbWV0ZXJDb25uZWN0aW9uLmN1cnJlbnQ7XHJcbiAgICAgIHRoaXMuc2VyaWVzLnB1c2goIGN1cnJlbnQgPT09IG51bGwgPyBudWxsIDogbmV3IFZlY3RvcjIoIHRpbWUsIGN1cnJlbnQgfHwgMCApICk7XHJcbiAgICAgIHdoaWxlICggKCB0aGlzLnNlcmllc1sgMCBdID09PSBudWxsICkgfHxcclxuICAgICAgICAgICAgICAoIHRoaXMuc2VyaWVzLmxlbmd0aCA+IDAgJiYgdGhpcy5zZXJpZXNbIDAgXS54IDwgdGhpcy50aW1lUHJvcGVydHkudmFsdWUgLSBDQ0tDQ29uc3RhbnRzLk5VTUJFUl9PRl9USU1FX0RJVklTSU9OUyApICkge1xyXG4gICAgICAgIHRoaXMuc2VyaWVzLnNoaWZ0KCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMudXBkYXRlUGVuKCk7XHJcbiAgICB0aGlzLmxhc3RTdGVwVGltZSA9IHRpbWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2FtcGxlTGF0ZXN0VmFsdWUoKTogdm9pZCB7XHJcblxyXG4gICAgLy8gQXZvaWQgdHJvdWJsZSBkdXJpbmcgZnV6emJvYXJkIHN0YXJ0dXBcclxuICAgIGlmICggdGhpcy5sYXN0U3RlcFRpbWUgPT09IG51bGwgKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnNlcmllcy5wb3AoKTtcclxuXHJcbiAgICBjb25zdCBhbW1ldGVyQ29ubmVjdGlvbiA9IHRoaXMuY2lyY3VpdE5vZGUuZ2V0Q3VycmVudCggdGhpcy5wcm9iZU5vZGUxICk7XHJcbiAgICBjb25zdCBjdXJyZW50ID0gYW1tZXRlckNvbm5lY3Rpb24gPT09IG51bGwgPyBudWxsIDogYW1tZXRlckNvbm5lY3Rpb24uY3VycmVudDtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHR5cGVvZiB0aGlzLmxhc3RTdGVwVGltZSA9PT0gJ251bWJlcicgKTtcclxuICAgIGlmICggdHlwZW9mIHRoaXMubGFzdFN0ZXBUaW1lID09PSAnbnVtYmVyJyApIHtcclxuICAgICAgdGhpcy5zZXJpZXMucHVzaCggY3VycmVudCA9PT0gbnVsbCA/IG51bGwgOiBuZXcgVmVjdG9yMiggdGhpcy5sYXN0U3RlcFRpbWUsIGN1cnJlbnQgfHwgMCApICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy51cGRhdGVQZW4oKTtcclxuICB9XHJcbn1cclxuXHJcbmNpcmN1aXRDb25zdHJ1Y3Rpb25LaXRDb21tb24ucmVnaXN0ZXIoICdDdXJyZW50Q2hhcnROb2RlJywgQ3VycmVudENoYXJ0Tm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxxQkFBcUIsTUFBTSwyQ0FBMkM7QUFDN0UsT0FBT0MsT0FBTyxNQUFNLDRCQUE0QjtB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