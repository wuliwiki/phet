// Copyright 2021-2023, University of Colorado Boulder

/**
 * For debugging current values and directions.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import ArrowNode from '../../../scenery-phet/js/ArrowNode.js';
import { Node, Text } from '../../../scenery/js/imports.js';
import Panel from '../../../sun/js/Panel.js';
import circuitConstructionKitCommon from '../circuitConstructionKitCommon.js';
import CurrentSense from '../model/CurrentSense.js';
export default class CircuitDebugLayer extends Node {
  constructor(circuitNode) {
    super();
    this.circuitNode = circuitNode;
    this.rebuild();
  }
  step() {
    this.rebuild();
  }
  rebuild() {
    this.removeAllChildren();
    this.circuitNode.circuit.circuitElements.forEach(circuitElement => {
      const start = circuitElement.startVertexProperty.value.positionProperty.value;
      const end = circuitElement.endVertexProperty.value.positionProperty.value;
      let arrowNode = null;
      let sign = 0;
      if (circuitElement.currentProperty.value > 0) {
        sign = +1;
      }
      if (circuitElement.currentProperty.value < 0) {
        sign = -1;
      }
      if (sign === +1) {
        arrowNode = new ArrowNode(start.x, start.y, end.x, end.y, {
          fill: 'red',
          stroke: 'black',
          lineWidth: 1
        });
      } else if (sign === -1) {
        arrowNode = new ArrowNode(end.x, end.y, start.x, start.y, {
          fill: 'red',
          stroke: 'black',
          lineWidth: 1
        });
      } else {
        arrowNode = new ArrowNode(start.x, start.y, end.x, end.y, {
          fill: 'white',
          stroke: 'black',
          lineWidth: 1
        });
      }
      this.addChild(arrowNode);
      const offset = end.minus(start).perpendicular.normalized().timesScalar(10);
      const senseNode = new ArrowNode(start.x + offset.x, start.y + offset.y, end.x + offset.x, end.y + offset.y, {
        fill: 'green'
      });
      this.addChild(senseNode);
      const textNode = new Text(circuitElement.currentProperty.value.toFixed(4)); // eslint-disable-line bad-sim-text
      const panel = new Panel(textNode, {
        center: arrowNode.center,
        fill: circuitElement.currentSenseProperty.value === CurrentSense.FORWARD ? 'green' : circuitElement.currentSenseProperty.value === CurrentSense.BACKWARD ? 'rgba(137, 196, 244, 1)' : 'white'
      });
      this.addChild(panel);
    });
  }
}
circuitConstructionKitCommon.register('CircuitDebugLayer', CircuitDebugLayer);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBcnJvd05vZGUiLCJOb2RlIiwiVGV4dCIsIlBhbmVsIiwiY2lyY3VpdENvbnN0cnVjdGlvbktpdENvbW1vbiIsIkN1cnJlbnRTZW5zZSIsIkNpcmN1aXREZWJ1Z0xheWVyIiwiY29uc3RydWN0b3IiLCJjaXJjdWl0Tm9kZSIsInJlYnVpbGQiLCJzdGVwIiwicmVtb3ZlQWxsQ2hpbGRyZW4iLCJjaXJjdWl0IiwiY2lyY3VpdEVsZW1lbnRzIiwiZm9yRWFjaCIsImNpcmN1aXRFbGVtZW50Iiwic3RhcnQiLCJzdGFydFZlcnRleFByb3BlcnR5IiwidmFsdWUiLCJwb3NpdGlvblByb3BlcnR5IiwiZW5kIiwiZW5kVmVydGV4UHJvcGVydHkiLCJhcnJvd05vZGUiLCJzaWduIiwiY3VycmVudFByb3BlcnR5IiwieCIsInkiLCJmaWxsIiwic3Ryb2tlIiwibGluZVdpZHRoIiwiYWRkQ2hpbGQiLCJvZmZzZXQiLCJtaW51cyIsInBlcnBlbmRpY3VsYXIiLCJub3JtYWxpemVkIiwidGltZXNTY2FsYXIiLCJzZW5zZU5vZGUiLCJ0ZXh0Tm9kZSIsInRvRml4ZWQiLCJwYW5lbCIsImNlbnRlciIsImN1cnJlbnRTZW5zZVByb3BlcnR5IiwiRk9SV0FSRCIsIkJBQ0tXQVJEIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJDaXJjdWl0RGVidWdMYXllci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBGb3IgZGVidWdnaW5nIGN1cnJlbnQgdmFsdWVzIGFuZCBkaXJlY3Rpb25zLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBBcnJvd05vZGUgZnJvbSAnLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL0Fycm93Tm9kZS5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIFRleHQgfSBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUGFuZWwgZnJvbSAnLi4vLi4vLi4vc3VuL2pzL1BhbmVsLmpzJztcclxuaW1wb3J0IGNpcmN1aXRDb25zdHJ1Y3Rpb25LaXRDb21tb24gZnJvbSAnLi4vY2lyY3VpdENvbnN0cnVjdGlvbktpdENvbW1vbi5qcyc7XHJcbmltcG9ydCBDaXJjdWl0Tm9kZSBmcm9tICcuL0NpcmN1aXROb2RlLmpzJztcclxuaW1wb3J0IEN1cnJlbnRTZW5zZSBmcm9tICcuLi9tb2RlbC9DdXJyZW50U2Vuc2UuanMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2lyY3VpdERlYnVnTGF5ZXIgZXh0ZW5kcyBOb2RlIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNpcmN1aXROb2RlOiBDaXJjdWl0Tm9kZTtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBjaXJjdWl0Tm9kZTogQ2lyY3VpdE5vZGUgKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gICAgdGhpcy5jaXJjdWl0Tm9kZSA9IGNpcmN1aXROb2RlO1xyXG4gICAgdGhpcy5yZWJ1aWxkKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RlcCgpOiB2b2lkIHtcclxuICAgIHRoaXMucmVidWlsZCgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZWJ1aWxkKCk6IHZvaWQge1xyXG4gICAgdGhpcy5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgdGhpcy5jaXJjdWl0Tm9kZS5jaXJjdWl0LmNpcmN1aXRFbGVtZW50cy5mb3JFYWNoKCBjaXJjdWl0RWxlbWVudCA9PiB7XHJcbiAgICAgIGNvbnN0IHN0YXJ0ID0gY2lyY3VpdEVsZW1lbnQuc3RhcnRWZXJ0ZXhQcm9wZXJ0eS52YWx1ZS5wb3NpdGlvblByb3BlcnR5LnZhbHVlO1xyXG4gICAgICBjb25zdCBlbmQgPSBjaXJjdWl0RWxlbWVudC5lbmRWZXJ0ZXhQcm9wZXJ0eS52YWx1ZS5wb3NpdGlvblByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgICAgbGV0IGFycm93Tm9kZSA9IG51bGw7XHJcbiAgICAgIGxldCBzaWduID0gMDtcclxuICAgICAgaWYgKCBjaXJjdWl0RWxlbWVudC5jdXJyZW50UHJvcGVydHkudmFsdWUgPiAwICkge1xyXG4gICAgICAgIHNpZ24gPSArMTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIGNpcmN1aXRFbGVtZW50LmN1cnJlbnRQcm9wZXJ0eS52YWx1ZSA8IDAgKSB7XHJcbiAgICAgICAgc2lnbiA9IC0xO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICggc2lnbiA9PT0gKzEgKSB7XHJcbiAgICAgICAgYXJyb3dOb2RlID0gbmV3IEFycm93Tm9kZSggc3RhcnQueCwgc3RhcnQueSwgZW5kLngsIGVuZC55LCB7XHJcbiAgICAgICAgICBmaWxsOiAncmVkJyxcclxuICAgICAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgICAgIGxpbmVXaWR0aDogMVxyXG4gICAgICAgIH0gKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggc2lnbiA9PT0gLTEgKSB7XHJcbiAgICAgICAgYXJyb3dOb2RlID0gbmV3IEFycm93Tm9kZSggZW5kLngsIGVuZC55LCBzdGFydC54LCBzdGFydC55LCB7XHJcbiAgICAgICAgICBmaWxsOiAncmVkJyxcclxuICAgICAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgICAgIGxpbmVXaWR0aDogMVxyXG4gICAgICAgIH0gKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBhcnJvd05vZGUgPSBuZXcgQXJyb3dOb2RlKCBzdGFydC54LCBzdGFydC55LCBlbmQueCwgZW5kLnksIHtcclxuICAgICAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICAgICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgICAgICBsaW5lV2lkdGg6IDFcclxuICAgICAgICB9ICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIGFycm93Tm9kZSApO1xyXG5cclxuICAgICAgY29uc3Qgb2Zmc2V0ID0gZW5kLm1pbnVzKCBzdGFydCApLnBlcnBlbmRpY3VsYXIubm9ybWFsaXplZCgpLnRpbWVzU2NhbGFyKCAxMCApO1xyXG4gICAgICBjb25zdCBzZW5zZU5vZGUgPSBuZXcgQXJyb3dOb2RlKCBzdGFydC54ICsgb2Zmc2V0LngsIHN0YXJ0LnkgKyBvZmZzZXQueSwgZW5kLnggKyBvZmZzZXQueCwgZW5kLnkgKyBvZmZzZXQueSwge1xyXG4gICAgICAgIGZpbGw6ICdncmVlbidcclxuICAgICAgfSApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCBzZW5zZU5vZGUgKTtcclxuXHJcbiAgICAgIGNvbnN0IHRleHROb2RlID0gbmV3IFRleHQoIGNpcmN1aXRFbGVtZW50LmN1cnJlbnRQcm9wZXJ0eS52YWx1ZS50b0ZpeGVkKCA0ICkgKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBiYWQtc2ltLXRleHRcclxuICAgICAgY29uc3QgcGFuZWwgPSBuZXcgUGFuZWwoIHRleHROb2RlLCB7XHJcbiAgICAgICAgY2VudGVyOiBhcnJvd05vZGUuY2VudGVyLFxyXG4gICAgICAgIGZpbGw6IGNpcmN1aXRFbGVtZW50LmN1cnJlbnRTZW5zZVByb3BlcnR5LnZhbHVlID09PSBDdXJyZW50U2Vuc2UuRk9SV0FSRCA/ICdncmVlbicgOlxyXG4gICAgICAgICAgICAgIGNpcmN1aXRFbGVtZW50LmN1cnJlbnRTZW5zZVByb3BlcnR5LnZhbHVlID09PSBDdXJyZW50U2Vuc2UuQkFDS1dBUkQgPyAncmdiYSgxMzcsIDE5NiwgMjQ0LCAxKScgOlxyXG4gICAgICAgICAgICAgICd3aGl0ZSdcclxuICAgICAgfSApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCBwYW5lbCApO1xyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxuY2lyY3VpdENvbnN0cnVjdGlvbktpdENvbW1vbi5yZWdpc3RlciggJ0NpcmN1aXREZWJ1Z0xheWVyJywgQ2lyY3Vp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