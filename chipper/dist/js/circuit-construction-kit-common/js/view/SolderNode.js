// Copyright 2016-2023, University of Colorado Boulder

/**
 * Shows the silver solder at a connected vertex.  This is not interactive and is behind everything else.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import { Circle, Node } from '../../../scenery/js/imports.js';
import circuitConstructionKitCommon from '../circuitConstructionKitCommon.js';
// constants
const SOLDER_COLOR = '#ae9f9e';

// for hit testing with probes, in view coordinates
const SOLDER_RADIUS = 11.2;

// {Image} raster created by init() for WebGL usage
const CIRCLE_NODE = new Circle(SOLDER_RADIUS, {
  fill: SOLDER_COLOR
}).rasterized({
  wrap: false
});
export default class SolderNode extends Node {
  // added by CircuitNode during dragging, used for relative drag position.

  // Identifies the images used to render this node so they can be prepopulated in the WebGL sprite sheet.
  static webglSpriteNodes = [CIRCLE_NODE];

  // radius of solder in model=view coordinates, for hit testing with probes
  static SOLDER_RADIUS = SOLDER_RADIUS;
  constructor(circuitNode, vertex) {
    assert && assert(CIRCLE_NODE, 'solder image should exist before creating SolderNode');
    const circuit = circuitNode.circuit;
    super({
      children: [CIRCLE_NODE],
      // Avoid bounds computation for this node since it is not pickable, and it was showing up in the profiler
      preventFit: true,
      pickable: false
    });
    this.vertex = vertex;
    this.startOffset = null;

    // Update the fill when the number of attached components changes.
    const updateFill = () => {
      // defensive copies for callbacks cause listeners to get called during disposal, avoid calling
      // Node API after disposed
      if (!this.isDisposed) {
        this.visible = circuit.countCircuitElements(vertex) > 1;
      }
    };
    circuit.vertexGroup.elementCreatedEmitter.addListener(updateFill);
    circuit.vertexGroup.elementDisposedEmitter.addListener(updateFill);

    // In Black Box, other wires can be detached from a vertex and this should also update the solder
    circuit.circuitElements.addItemAddedListener(updateFill);
    circuit.circuitElements.addItemRemovedListener(updateFill);
    const updateSolderNodePosition = this.setTranslation.bind(this);
    vertex.positionProperty.link(updateSolderNodePosition);
    this.disposeSolderNode = () => {
      vertex.positionProperty.unlink(updateSolderNodePosition);
      circuit.vertexGroup.elementCreatedEmitter.removeListener(updateFill);
      circuit.vertexGroup.elementDisposedEmitter.removeListener(updateFill);

      // In Black Box, other wires can be detached from a vertex and this should also update the solder
      circuit.circuitElements.removeItemAddedListener(updateFill);
      circuit.circuitElements.removeItemRemovedListener(updateFill);
    };
    updateFill();
  }

  /**
   * Eliminate resources when no longer used.
   */
  dispose() {
    this.disposeSolderNode();
    super.dispose();
  }
}
circuitConstructionKitCommon.register('SolderNode', SolderNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDaXJjbGUiLCJOb2RlIiwiY2lyY3VpdENvbnN0cnVjdGlvbktpdENvbW1vbiIsIlNPTERFUl9DT0xPUiIsIlNPTERFUl9SQURJVVMiLCJDSVJDTEVfTk9ERSIsImZpbGwiLCJyYXN0ZXJpemVkIiwid3JhcCIsIlNvbGRlck5vZGUiLCJ3ZWJnbFNwcml0ZU5vZGVzIiwiY29uc3RydWN0b3IiLCJjaXJjdWl0Tm9kZSIsInZlcnRleCIsImFzc2VydCIsImNpcmN1aXQiLCJjaGlsZHJlbiIsInByZXZlbnRGaXQiLCJwaWNrYWJsZSIsInN0YXJ0T2Zmc2V0IiwidXBkYXRlRmlsbCIsImlzRGlzcG9zZWQiLCJ2aXNpYmxlIiwiY291bnRDaXJjdWl0RWxlbWVudHMiLCJ2ZXJ0ZXhHcm91cCIsImVsZW1lbnRDcmVhdGVkRW1pdHRlciIsImFkZExpc3RlbmVyIiwiZWxlbWVudERpc3Bvc2VkRW1pdHRlciIsImNpcmN1aXRFbGVtZW50cyIsImFkZEl0ZW1BZGRlZExpc3RlbmVyIiwiYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciIsInVwZGF0ZVNvbGRlck5vZGVQb3NpdGlvbiIsInNldFRyYW5zbGF0aW9uIiwiYmluZCIsInBvc2l0aW9uUHJvcGVydHkiLCJsaW5rIiwiZGlzcG9zZVNvbGRlck5vZGUiLCJ1bmxpbmsiLCJyZW1vdmVMaXN0ZW5lciIsInJlbW92ZUl0ZW1BZGRlZExpc3RlbmVyIiwicmVtb3ZlSXRlbVJlbW92ZWRMaXN0ZW5lciIsImRpc3Bvc2UiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlNvbGRlck5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2hvd3MgdGhlIHNpbHZlciBzb2xkZXIgYXQgYSBjb25uZWN0ZWQgdmVydGV4LiAgVGhpcyBpcyBub3QgaW50ZXJhY3RpdmUgYW5kIGlzIGJlaGluZCBldmVyeXRoaW5nIGVsc2UuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgeyBDaXJjbGUsIE5vZGUgfSBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgY2lyY3VpdENvbnN0cnVjdGlvbktpdENvbW1vbiBmcm9tICcuLi9jaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uLmpzJztcclxuaW1wb3J0IFZlcnRleCBmcm9tICcuLi9tb2RlbC9WZXJ0ZXguanMnO1xyXG5pbXBvcnQgQ2lyY3VpdE5vZGUgZnJvbSAnLi9DaXJjdWl0Tm9kZS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgU09MREVSX0NPTE9SID0gJyNhZTlmOWUnO1xyXG5cclxuLy8gZm9yIGhpdCB0ZXN0aW5nIHdpdGggcHJvYmVzLCBpbiB2aWV3IGNvb3JkaW5hdGVzXHJcbmNvbnN0IFNPTERFUl9SQURJVVMgPSAxMS4yO1xyXG5cclxuLy8ge0ltYWdlfSByYXN0ZXIgY3JlYXRlZCBieSBpbml0KCkgZm9yIFdlYkdMIHVzYWdlXHJcbmNvbnN0IENJUkNMRV9OT0RFID0gbmV3IENpcmNsZSggU09MREVSX1JBRElVUywgeyBmaWxsOiBTT0xERVJfQ09MT1IgfSApLnJhc3Rlcml6ZWQoIHsgd3JhcDogZmFsc2UgfSApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU29sZGVyTm9kZSBleHRlbmRzIE5vZGUge1xyXG4gIHB1YmxpYyByZWFkb25seSB2ZXJ0ZXg6IFZlcnRleDtcclxuXHJcbiAgLy8gYWRkZWQgYnkgQ2lyY3VpdE5vZGUgZHVyaW5nIGRyYWdnaW5nLCB1c2VkIGZvciByZWxhdGl2ZSBkcmFnIHBvc2l0aW9uLlxyXG4gIHByaXZhdGUgcmVhZG9ubHkgc3RhcnRPZmZzZXQ6IFZlY3RvcjIgfCBudWxsO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZVNvbGRlck5vZGU6ICgpID0+IHZvaWQ7XHJcblxyXG4gIC8vIElkZW50aWZpZXMgdGhlIGltYWdlcyB1c2VkIHRvIHJlbmRlciB0aGlzIG5vZGUgc28gdGhleSBjYW4gYmUgcHJlcG9wdWxhdGVkIGluIHRoZSBXZWJHTCBzcHJpdGUgc2hlZXQuXHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSB3ZWJnbFNwcml0ZU5vZGVzID0gWyBDSVJDTEVfTk9ERSBdO1xyXG5cclxuICAvLyByYWRpdXMgb2Ygc29sZGVyIGluIG1vZGVsPXZpZXcgY29vcmRpbmF0ZXMsIGZvciBoaXQgdGVzdGluZyB3aXRoIHByb2Jlc1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgU09MREVSX1JBRElVUyA9IFNPTERFUl9SQURJVVM7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggY2lyY3VpdE5vZGU6IENpcmN1aXROb2RlLCB2ZXJ0ZXg6IFZlcnRleCApIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIENJUkNMRV9OT0RFLCAnc29sZGVyIGltYWdlIHNob3VsZCBleGlzdCBiZWZvcmUgY3JlYXRpbmcgU29sZGVyTm9kZScgKTtcclxuXHJcbiAgICBjb25zdCBjaXJjdWl0ID0gY2lyY3VpdE5vZGUuY2lyY3VpdDtcclxuXHJcbiAgICBzdXBlcigge1xyXG4gICAgICBjaGlsZHJlbjogWyBDSVJDTEVfTk9ERSBdLFxyXG5cclxuICAgICAgLy8gQXZvaWQgYm91bmRzIGNvbXB1dGF0aW9uIGZvciB0aGlzIG5vZGUgc2luY2UgaXQgaXMgbm90IHBpY2thYmxlLCBhbmQgaXQgd2FzIHNob3dpbmcgdXAgaW4gdGhlIHByb2ZpbGVyXHJcbiAgICAgIHByZXZlbnRGaXQ6IHRydWUsXHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMudmVydGV4ID0gdmVydGV4O1xyXG4gICAgdGhpcy5zdGFydE9mZnNldCA9IG51bGw7XHJcblxyXG4gICAgLy8gVXBkYXRlIHRoZSBmaWxsIHdoZW4gdGhlIG51bWJlciBvZiBhdHRhY2hlZCBjb21wb25lbnRzIGNoYW5nZXMuXHJcbiAgICBjb25zdCB1cGRhdGVGaWxsID0gKCkgPT4ge1xyXG5cclxuICAgICAgLy8gZGVmZW5zaXZlIGNvcGllcyBmb3IgY2FsbGJhY2tzIGNhdXNlIGxpc3RlbmVycyB0byBnZXQgY2FsbGVkIGR1cmluZyBkaXNwb3NhbCwgYXZvaWQgY2FsbGluZ1xyXG4gICAgICAvLyBOb2RlIEFQSSBhZnRlciBkaXNwb3NlZFxyXG4gICAgICBpZiAoICF0aGlzLmlzRGlzcG9zZWQgKSB7XHJcbiAgICAgICAgdGhpcy52aXNpYmxlID0gY2lyY3VpdC5jb3VudENpcmN1aXRFbGVtZW50cyggdmVydGV4ICkgPiAxO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgY2lyY3VpdC52ZXJ0ZXhHcm91cC5lbGVtZW50Q3JlYXRlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIHVwZGF0ZUZpbGwgKTtcclxuICAgIGNpcmN1aXQudmVydGV4R3JvdXAuZWxlbWVudERpc3Bvc2VkRW1pdHRlci5hZGRMaXN0ZW5lciggdXBkYXRlRmlsbCApO1xyXG5cclxuICAgIC8vIEluIEJsYWNrIEJveCwgb3RoZXIgd2lyZXMgY2FuIGJlIGRldGFjaGVkIGZyb20gYSB2ZXJ0ZXggYW5kIHRoaXMgc2hvdWxkIGFsc28gdXBkYXRlIHRoZSBzb2xkZXJcclxuICAgIGNpcmN1aXQuY2lyY3VpdEVsZW1lbnRzLmFkZEl0ZW1BZGRlZExpc3RlbmVyKCB1cGRhdGVGaWxsICk7XHJcbiAgICBjaXJjdWl0LmNpcmN1aXRFbGVtZW50cy5hZGRJdGVtUmVtb3ZlZExpc3RlbmVyKCB1cGRhdGVGaWxsICk7XHJcblxyXG4gICAgY29uc3QgdXBkYXRlU29sZGVyTm9kZVBvc2l0aW9uID0gdGhpcy5zZXRUcmFuc2xhdGlvbi5iaW5kKCB0aGlzICk7XHJcblxyXG4gICAgdmVydGV4LnBvc2l0aW9uUHJvcGVydHkubGluayggdXBkYXRlU29sZGVyTm9kZVBvc2l0aW9uICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlU29sZGVyTm9kZSA9ICgpID0+IHtcclxuXHJcbiAgICAgIHZlcnRleC5wb3NpdGlvblByb3BlcnR5LnVubGluayggdXBkYXRlU29sZGVyTm9kZVBvc2l0aW9uICk7XHJcblxyXG4gICAgICBjaXJjdWl0LnZlcnRleEdyb3VwLmVsZW1lbnRDcmVhdGVkRW1pdHRlci5yZW1vdmVMaXN0ZW5lciggdXBkYXRlRmlsbCApO1xyXG4gICAgICBjaXJjdWl0LnZlcnRleEdyb3VwLmVsZW1lbnREaXNwb3NlZEVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoIHVwZGF0ZUZpbGwgKTtcclxuXHJcbiAgICAgIC8vIEluIEJsYWNrIEJveCwgb3RoZXIgd2lyZXMgY2FuIGJlIGRldGFjaGVkIGZyb20gYSB2ZXJ0ZXggYW5kIHRoaXMgc2hvdWxkIGFsc28gdXBkYXRlIHRoZSBzb2xkZXJcclxuICAgICAgY2lyY3VpdC5jaXJjdWl0RWxlbWVudHMucmVtb3ZlSXRlbUFkZGVkTGlzdGVuZXIoIHVwZGF0ZUZpbGwgKTtcclxuICAgICAgY2lyY3VpdC5jaXJjdWl0RWxlbWVudHMucmVtb3ZlSXRlbVJlbW92ZWRMaXN0ZW5lciggdXBkYXRlRmlsbCApO1xyXG4gICAgfTtcclxuXHJcbiAgICB1cGRhdGVGaWxsKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBFbGltaW5hdGUgcmVzb3VyY2VzIHdoZW4gbm8gbG9uZ2VyIHVzZWQuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VTb2xkZXJOb2RlKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5jaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uLnJlZ2lzdGVyKCAnU29sZGVyTm9kZScsIFNvbGRlck5vZGUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FB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