// Copyright 2017-2023, University of Colorado Boulder

/**
 * When enabled, shows the readout above circuit elements, such as "9.0 V" for a 9 volt battery.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Matrix3 from '../../../dot/js/Matrix3.js';
import Utils from '../../../dot/js/Utils.js';
import Vector2 from '../../../dot/js/Vector2.js';
import StringUtils from '../../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../../scenery-phet/js/PhetFont.js';
import { Color, RichText, Text, VBox } from '../../../scenery/js/imports.js';
import Panel from '../../../sun/js/Panel.js';
import CCKCConstants from '../CCKCConstants.js';
import CCKCQueryParameters from '../CCKCQueryParameters.js';
import CircuitConstructionKitCommonStrings from '../CircuitConstructionKitCommonStrings.js';
import circuitConstructionKitCommon from '../circuitConstructionKitCommon.js';
import Capacitor from '../model/Capacitor.js';
import Fuse from '../model/Fuse.js';
import Inductor from '../model/Inductor.js';
import LightBulb from '../model/LightBulb.js';
import Resistor from '../model/Resistor.js';
import Switch from '../model/Switch.js';
import VoltageSource from '../model/VoltageSource.js';
import Multilink from '../../../axon/js/Multilink.js';
import { combineOptions } from '../../../phet-core/js/optionize.js';
import CCKCColors from './CCKCColors.js';
const capacitanceFaradsSymbolStringProperty = CircuitConstructionKitCommonStrings.capacitanceFaradsSymbolStringProperty;
const fuseValueStringProperty = CircuitConstructionKitCommonStrings.fuseValueStringProperty;
const inductanceHenriesSymbolStringProperty = CircuitConstructionKitCommonStrings.inductanceHenriesSymbolStringProperty;
const resistanceOhmsSymbolStringProperty = CircuitConstructionKitCommonStrings.resistanceOhmsSymbolStringProperty;
const voltageUnitsStringProperty = CircuitConstructionKitCommonStrings.voltageUnitsStringProperty;

// constants
const VERTICAL_OFFSET = 24;

// Big enough to see when zoomed out
const FONT = new PhetFont({
  size: 22
});

/**
 * For convenience, creates a Text node with empty content and the specified tandem.
 * @param tandem
 * @param [providedOptions]
 */
const createText = (tandem, providedOptions) => new Text('', combineOptions({
  tandem: tandem,
  font: FONT,
  fill: CCKCColors.textFillProperty
}, providedOptions));

/**
 * For convenience, creates a RichText node with empty content and the specified tandem.
 * @param tandem
 * @param [providedOptions]
 */
const createRichText = (tandem, providedOptions) => new RichText('', combineOptions({
  tandem: tandem,
  font: FONT
}, providedOptions));
const infinitySpan = '<span style="font-size: 26px; font-family: serif;"><b>âˆž</b></span>';
export default class ValueNode extends Panel {
  /**
   * @param sourceResistanceProperty - user-specified value for internal resistance for batteries
   * @param circuitElement
   * @param showValuesProperty
   * @param viewTypeProperty
   * @param tandem
   */
  constructor(sourceResistanceProperty, circuitElement, showValuesProperty, viewTypeProperty, tandem) {
    const contentNode = new VBox({
      maxWidth: 130
    });
    let readoutValueNode;
    let update = null;
    if (circuitElement instanceof VoltageSource) {
      const voltageText = createText(tandem.createTandem('voltageText'));
      const voltageMultilink = Multilink.multilink([circuitElement.voltageProperty, voltageUnitsStringProperty], (voltage, voltageString) => {
        voltageText.string = StringUtils.fillIn(voltageString, {
          voltage: Utils.toFixed(voltage, circuitElement.numberOfDecimalPlaces)
        });
        update && update();
      });

      // Battery readouts shows voltage and internal resistance if it is nonzero
      readoutValueNode = new VBox({
        align: 'right',
        children: [voltageText]
      });
      const resistanceNode = createText(tandem.createTandem('resistanceText'));
      const sourceResistanceMultilink = Multilink.multilink([sourceResistanceProperty, resistanceOhmsSymbolStringProperty], (sourceResistance, sourceResistanceString) => {
        resistanceNode.string = StringUtils.fillIn(sourceResistanceString, {
          resistance: Utils.toFixed(sourceResistance, 1)
        });

        // If the children should change, update them here
        const desiredChildren = sourceResistance > CCKCQueryParameters.batteryMinimumResistance ? [voltageText, resistanceNode] : [voltageText];

        // Only set children if changed
        if (readoutValueNode.getChildrenCount() !== desiredChildren.length) {
          readoutValueNode.children = desiredChildren;
        }
        update && update();
      });
      contentNode.disposeEmitter.addListener(() => {
        voltageMultilink.dispose();
        sourceResistanceMultilink.dispose();
      });
    } else if (circuitElement instanceof Resistor || circuitElement instanceof LightBulb) {
      readoutValueNode = createText(tandem.createTandem('resistanceText'));

      // Items like the hand and dog and high resistance resistor shouldn't show ".0"

      const resistanceMultilink = Multilink.multilink([circuitElement.resistanceProperty, resistanceOhmsSymbolStringProperty], (resistance, resistanceString) => {
        readoutValueNode.string = StringUtils.fillIn(resistanceString, {
          resistance: Utils.toFixed(resistance, circuitElement.numberOfDecimalPlaces)
        });
        update && update();
      });
      contentNode.disposeEmitter.addListener(() => resistanceMultilink.dispose());
    } else if (circuitElement instanceof Capacitor) {
      readoutValueNode = createText(tandem.createTandem('capacitorText'));

      // Items like the hand and dog and high resistance resistor shouldn't show ".0"

      const capacitanceMultilink = Multilink.multilink([circuitElement.capacitanceProperty, capacitanceFaradsSymbolStringProperty], (capacitance, capacitanceString) => {
        readoutValueNode.string = StringUtils.fillIn(capacitanceString, {
          resistance: Utils.toFixed(capacitance, circuitElement.numberOfDecimalPlaces)
        });
        update && update();
      });
      contentNode.disposeEmitter.addListener(() => capacitanceMultilink.dispose());
    } else if (circuitElement instanceof Inductor) {
      readoutValueNode = createText(tandem.createTandem('inductorText'));
      const inductanceMultilink = Multilink.multilink([circuitElement.inductanceProperty, inductanceHenriesSymbolStringProperty], (inductance, inductanceString) => {
        readoutValueNode.string = StringUtils.fillIn(inductanceString, {
          resistance: Utils.toFixed(inductance, circuitElement.numberOfDecimalPlaces)
        });
        update && update();
      });
      contentNode.disposeEmitter.addListener(() => inductanceMultilink.dispose());
    } else if (circuitElement instanceof Switch) {
      // Make it easier to read the infinity symbol, see https://github.com/phetsims/circuit-construction-kit-dc/issues/135
      readoutValueNode = createRichText(tandem.createTandem('switchText'));
      const switchMultilink = Multilink.multilink([circuitElement.resistanceProperty, resistanceOhmsSymbolStringProperty], (resistance, resistanceString) => {
        readoutValueNode.string = StringUtils.fillIn(resistanceString, {
          // Using a serif font makes the infinity symbol look less lopsided
          resistance: resistance > 100000 ? infinitySpan : '0'
        });

        // Account for the switch open and close geometry for positioning the label.  When the switch is open
        // the label must be higher
        update && update();
      });
      contentNode.disposeEmitter.addListener(() => switchMultilink.dispose());
    } else if (circuitElement instanceof Fuse) {
      readoutValueNode = createRichText(tandem.createTandem('fuseText'), {
        align: 'right',
        fill: CCKCColors.textFillProperty
      });
      const multilink = Multilink.multilink([circuitElement.resistanceProperty, circuitElement.currentRatingProperty, fuseValueStringProperty], (resistance, currentRating, fuseValueString) => {
        const milliOhmString = resistance === CCKCConstants.MAX_RESISTANCE ? infinitySpan : Utils.toFixed(resistance * 1000, circuitElement.numberOfDecimalPlaces);
        readoutValueNode.string = StringUtils.fillIn(fuseValueString, {
          // Convert to milli
          resistance: milliOhmString,
          currentRating: Utils.toFixed(currentRating, circuitElement.numberOfDecimalPlaces)
        });
        update && update();
      });
      contentNode.disposeEmitter.addListener(() => multilink.dispose());
    } else {
      throw new Error(`ValueNode cannot be shown for ${circuitElement.constructor.name}`);
    }
    assert && assert(readoutValueNode, 'Content node should be defined');
    if (CCKCQueryParameters.showCurrents) {
      const text = new Text('', {
        fill: CCKCColors.textFillProperty
      });
      Multilink.multilink([circuitElement.currentProperty, circuitElement.currentSenseProperty], (current, sense) => {
        text.string = sense.toString() + ', ' + current.toFixed(4); // eslint-disable-line bad-sim-text
      });

      readoutValueNode = new VBox({
        children: [readoutValueNode, text]
      });
    }
    const customLabelNode = new Text('', {
      font: FONT,
      fill: CCKCColors.textFillProperty
    });
    contentNode.children = [customLabelNode, readoutValueNode];
    super(contentNode, {
      stroke: null,
      fill: new Color(255, 255, 255, 0.6),
      // put transparency in the color so that the children aren't transparent
      tandem: tandem,
      cornerRadius: 3,
      xMargin: 3,
      yMargin: 1,
      visiblePropertyOptions: {
        phetioReadOnly: true // controlled by the CircuitElement.isValueDisplayableProperty
      },

      pickable: false
    });
    const matrix = Matrix3.identity();
    update = () => {
      readoutValueNode.visible = showValuesProperty.value && circuitElement.isValueDisplayableProperty.value;
      const customLabelText = circuitElement.labelStringProperty.value;
      customLabelNode.string = customLabelText;
      customLabelNode.visible = customLabelText.length > 0;

      // For a light bulb, choose the part of the filament in the top center for the label, see
      // https://github.com/phetsims/circuit-construction-kit-common/issues/325
      const distance = circuitElement instanceof LightBulb ? 0.56 : 0.5;

      // The label partially overlaps the component to make it clear which label goes with which component
      circuitElement.updateMatrixForPoint(circuitElement.chargePathLength * distance, matrix);
      const delta = Vector2.createPolar(VERTICAL_OFFSET, matrix.rotation + 3 * Math.PI / 2);

      // Put the label above the circuit element, see https://github.com/phetsims/circuit-construction-kit-common/issues/845
      if (delta.y > 0) {
        delta.y = -delta.y;
      }
      this.centerBottom = matrix.translation.plus(delta.timesScalar(0.8));
    };
    circuitElement.vertexMovedEmitter.addListener(update);
    circuitElement.isValueDisplayableProperty.link(update);
    update();
    showValuesProperty.link(update);
    viewTypeProperty.link(update);
    circuitElement.labelStringProperty.link(update);
    this.disposeValueNode = () => {
      contentNode.dispose();
      circuitElement.vertexMovedEmitter.removeListener(update);
      showValuesProperty.unlink(update);
      viewTypeProperty.unlink(update);
      circuitElement.labelStringProperty.unlink(update);
    };
  }
  dispose() {
    super.dispose();
    this.disposeValueNode();
  }
}
circuitConstructionKitCommon.register('ValueNode', ValueNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNYXRyaXgzIiwiVXRpbHMiLCJWZWN0b3IyIiwiU3RyaW5nVXRpbHMiLCJQaGV0Rm9udCIsIkNvbG9yIiwiUmljaFRleHQiLCJUZXh0IiwiVkJveCIsIlBhbmVsIiwiQ0NLQ0NvbnN0YW50cyIsIkNDS0NRdWVyeVBhcmFtZXRlcnMiLCJDaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uU3RyaW5ncyIsImNpcmN1aXRDb25zdHJ1Y3Rpb25LaXRDb21tb24iLCJDYXBhY2l0b3IiLCJGdXNlIiwiSW5kdWN0b3IiLCJMaWdodEJ1bGIiLCJSZXNpc3RvciIsIlN3aXRjaCIsIlZvbHRhZ2VTb3VyY2UiLCJNdWx0aWxpbmsiLCJjb21iaW5lT3B0aW9ucyIsIkNDS0NDb2xvcnMiLCJjYXBhY2l0YW5jZUZhcmFkc1N5bWJvbFN0cmluZ1Byb3BlcnR5IiwiZnVzZVZhbHVlU3RyaW5nUHJvcGVydHkiLCJpbmR1Y3RhbmNlSGVucmllc1N5bWJvbFN0cmluZ1Byb3BlcnR5IiwicmVzaXN0YW5jZU9obXNTeW1ib2xTdHJpbmdQcm9wZXJ0eSIsInZvbHRhZ2VVbml0c1N0cmluZ1Byb3BlcnR5IiwiVkVSVElDQUxfT0ZGU0VUIiwiRk9OVCIsInNpemUiLCJjcmVhdGVUZXh0IiwidGFuZGVtIiwicHJvdmlkZWRPcHRpb25zIiwiZm9udCIsImZpbGwiLCJ0ZXh0RmlsbFByb3BlcnR5IiwiY3JlYXRlUmljaFRleHQiLCJpbmZpbml0eVNwYW4iLCJWYWx1ZU5vZGUiLCJjb25zdHJ1Y3RvciIsInNvdXJjZVJlc2lzdGFuY2VQcm9wZXJ0eSIsImNpcmN1aXRFbGVtZW50Iiwic2hvd1ZhbHVlc1Byb3BlcnR5Iiwidmlld1R5cGVQcm9wZXJ0eSIsImNvbnRlbnROb2RlIiwibWF4V2lkdGgiLCJyZWFkb3V0VmFsdWVOb2RlIiwidXBkYXRlIiwidm9sdGFnZVRleHQiLCJjcmVhdGVUYW5kZW0iLCJ2b2x0YWdlTXVsdGlsaW5rIiwibXVsdGlsaW5rIiwidm9sdGFnZVByb3BlcnR5Iiwidm9sdGFnZSIsInZvbHRhZ2VTdHJpbmciLCJzdHJpbmciLCJmaWxsSW4iLCJ0b0ZpeGVkIiwibnVtYmVyT2ZEZWNpbWFsUGxhY2VzIiwiYWxpZ24iLCJjaGlsZHJlbiIsInJlc2lzdGFuY2VOb2RlIiwic291cmNlUmVzaXN0YW5jZU11bHRpbGluayIsInNvdXJjZVJlc2lzdGFuY2UiLCJzb3VyY2VSZXNpc3RhbmNlU3RyaW5nIiwicmVzaXN0YW5jZSIsImRlc2lyZWRDaGlsZHJlbiIsImJhdHRlcnlNaW5pbXVtUmVzaXN0YW5jZSIsImdldENoaWxkcmVuQ291bnQiLCJsZW5ndGgiLCJkaXNwb3NlRW1pdHRlciIsImFkZExpc3RlbmVyIiwiZGlzcG9zZSIsInJlc2lzdGFuY2VNdWx0aWxpbmsiLCJyZXNpc3RhbmNlUHJvcGVydHkiLCJyZXNpc3RhbmNlU3RyaW5nIiwiY2FwYWNpdGFuY2VNdWx0aWxpbmsiLCJjYXBhY2l0YW5jZVByb3BlcnR5IiwiY2FwYWNpdGFuY2UiLCJjYXBhY2l0YW5jZVN0cmluZyIsImluZHVjdGFuY2VNdWx0aWxpbmsiLCJpbmR1Y3RhbmNlUHJvcGVydHkiLCJpbmR1Y3RhbmNlIiwiaW5kdWN0YW5jZVN0cmluZyIsInN3aXRjaE11bHRpbGluayIsImN1cnJlbnRSYXRpbmdQcm9wZXJ0eSIsImN1cnJlbnRSYXRpbmciLCJmdXNlVmFsdWVTdHJpbmciLCJtaWxsaU9obVN0cmluZyIsIk1BWF9SRVNJU1RBTkNFIiwiRXJyb3IiLCJuYW1lIiwiYXNzZXJ0Iiwic2hvd0N1cnJlbnRzIiwidGV4dCIsImN1cnJlbnRQcm9wZXJ0eSIsImN1cnJlbnRTZW5zZVByb3BlcnR5IiwiY3VycmVudCIsInNlbnNlIiwidG9TdHJpbmciLCJjdXN0b21MYWJlbE5vZGUiLCJzdHJva2UiLCJjb3JuZXJSYWRpdXMiLCJ4TWFyZ2luIiwieU1hcmdpbiIsInZpc2libGVQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9SZWFkT25seSIsInBpY2thYmxlIiwibWF0cml4IiwiaWRlbnRpdHkiLCJ2aXNpYmxlIiwidmFsdWUiLCJpc1ZhbHVlRGlzcGxheWFibGVQcm9wZXJ0eSIsImN1c3RvbUxhYmVsVGV4dCIsImxhYmVsU3RyaW5nUHJvcGVydHkiLCJkaXN0YW5jZSIsInVwZGF0ZU1hdHJpeEZvclBvaW50IiwiY2hhcmdlUGF0aExlbmd0aCIsImRlbHRhIiwiY3JlYXRlUG9sYXIiLCJyb3RhdGlvbiIsIk1hdGgiLCJQSSIsInkiLCJjZW50ZXJCb3R0b20iLCJ0cmFuc2xhdGlvbiIsInBsdXMiLCJ0aW1lc1NjYWxhciIsInZlcnRleE1vdmVkRW1pdHRlciIsImxpbmsiLCJkaXNwb3NlVmFsdWVOb2RlIiwicmVtb3ZlTGlzdGVuZXIiLCJ1bmxpbmsiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlZhbHVlTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNy0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBXaGVuIGVuYWJsZWQsIHNob3dzIHRoZSByZWFkb3V0IGFib3ZlIGNpcmN1aXQgZWxlbWVudHMsIHN1Y2ggYXMgXCI5LjAgVlwiIGZvciBhIDkgdm9sdCBiYXR0ZXJ5LlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IE1hdHJpeDMgZnJvbSAnLi4vLi4vLi4vZG90L2pzL01hdHJpeDMuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBOb2RlLCBSaWNoVGV4dCwgUmljaFRleHRPcHRpb25zLCBUZXh0LCBUZXh0T3B0aW9ucywgVkJveCB9IGZyb20gJy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBQYW5lbCBmcm9tICcuLi8uLi8uLi9zdW4vanMvUGFuZWwuanMnO1xyXG5pbXBvcnQgQ0NLQ0NvbnN0YW50cyBmcm9tICcuLi9DQ0tDQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IENDS0NRdWVyeVBhcmFtZXRlcnMgZnJvbSAnLi4vQ0NLQ1F1ZXJ5UGFyYW1ldGVycy5qcyc7XHJcbmltcG9ydCBDaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uU3RyaW5ncyBmcm9tICcuLi9DaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBjaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uIGZyb20gJy4uL2NpcmN1aXRDb25zdHJ1Y3Rpb25LaXRDb21tb24uanMnO1xyXG5pbXBvcnQgQ2FwYWNpdG9yIGZyb20gJy4uL21vZGVsL0NhcGFjaXRvci5qcyc7XHJcbmltcG9ydCBGdXNlIGZyb20gJy4uL21vZGVsL0Z1c2UuanMnO1xyXG5pbXBvcnQgSW5kdWN0b3IgZnJvbSAnLi4vbW9kZWwvSW5kdWN0b3IuanMnO1xyXG5pbXBvcnQgTGlnaHRCdWxiIGZyb20gJy4uL21vZGVsL0xpZ2h0QnVsYi5qcyc7XHJcbmltcG9ydCBSZXNpc3RvciBmcm9tICcuLi9tb2RlbC9SZXNpc3Rvci5qcyc7XHJcbmltcG9ydCBTd2l0Y2ggZnJvbSAnLi4vbW9kZWwvU3dpdGNoLmpzJztcclxuaW1wb3J0IFZvbHRhZ2VTb3VyY2UgZnJvbSAnLi4vbW9kZWwvVm9sdGFnZVNvdXJjZS5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBDaXJjdWl0RWxlbWVudCBmcm9tICcuLi9tb2RlbC9DaXJjdWl0RWxlbWVudC5qcyc7XHJcbmltcG9ydCBDaXJjdWl0RWxlbWVudFZpZXdUeXBlIGZyb20gJy4uL21vZGVsL0NpcmN1aXRFbGVtZW50Vmlld1R5cGUuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IHsgY29tYmluZU9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IENDS0NDb2xvcnMgZnJvbSAnLi9DQ0tDQ29sb3JzLmpzJztcclxuXHJcbmNvbnN0IGNhcGFjaXRhbmNlRmFyYWRzU3ltYm9sU3RyaW5nUHJvcGVydHkgPSBDaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uU3RyaW5ncy5jYXBhY2l0YW5jZUZhcmFkc1N5bWJvbFN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBmdXNlVmFsdWVTdHJpbmdQcm9wZXJ0eSA9IENpcmN1aXRDb25zdHJ1Y3Rpb25LaXRDb21tb25TdHJpbmdzLmZ1c2VWYWx1ZVN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBpbmR1Y3RhbmNlSGVucmllc1N5bWJvbFN0cmluZ1Byb3BlcnR5ID0gQ2lyY3VpdENvbnN0cnVjdGlvbktpdENvbW1vblN0cmluZ3MuaW5kdWN0YW5jZUhlbnJpZXNTeW1ib2xTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgcmVzaXN0YW5jZU9obXNTeW1ib2xTdHJpbmdQcm9wZXJ0eSA9IENpcmN1aXRDb25zdHJ1Y3Rpb25LaXRDb21tb25TdHJpbmdzLnJlc2lzdGFuY2VPaG1zU3ltYm9sU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IHZvbHRhZ2VVbml0c1N0cmluZ1Byb3BlcnR5ID0gQ2lyY3VpdENvbnN0cnVjdGlvbktpdENvbW1vblN0cmluZ3Mudm9sdGFnZVVuaXRzU3RyaW5nUHJvcGVydHk7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgVkVSVElDQUxfT0ZGU0VUID0gMjQ7XHJcblxyXG4vLyBCaWcgZW5vdWdoIHRvIHNlZSB3aGVuIHpvb21lZCBvdXRcclxuY29uc3QgRk9OVCA9IG5ldyBQaGV0Rm9udCggeyBzaXplOiAyMiB9ICk7XHJcblxyXG4vKipcclxuICogRm9yIGNvbnZlbmllbmNlLCBjcmVhdGVzIGEgVGV4dCBub2RlIHdpdGggZW1wdHkgY29udGVudCBhbmQgdGhlIHNwZWNpZmllZCB0YW5kZW0uXHJcbiAqIEBwYXJhbSB0YW5kZW1cclxuICogQHBhcmFtIFtwcm92aWRlZE9wdGlvbnNdXHJcbiAqL1xyXG5jb25zdCBjcmVhdGVUZXh0ID0gKCB0YW5kZW06IFRhbmRlbSwgcHJvdmlkZWRPcHRpb25zPzogVGV4dE9wdGlvbnMgKSA9PiBuZXcgVGV4dCggJycsIGNvbWJpbmVPcHRpb25zPFRleHRPcHRpb25zPigge1xyXG4gIHRhbmRlbTogdGFuZGVtLFxyXG4gIGZvbnQ6IEZPTlQsXHJcbiAgZmlsbDogQ0NLQ0NvbG9ycy50ZXh0RmlsbFByb3BlcnR5XHJcbn0sIHByb3ZpZGVkT3B0aW9ucyApICk7XHJcblxyXG4vKipcclxuICogRm9yIGNvbnZlbmllbmNlLCBjcmVhdGVzIGEgUmljaFRleHQgbm9kZSB3aXRoIGVtcHR5IGNvbnRlbnQgYW5kIHRoZSBzcGVjaWZpZWQgdGFuZGVtLlxyXG4gKiBAcGFyYW0gdGFuZGVtXHJcbiAqIEBwYXJhbSBbcHJvdmlkZWRPcHRpb25zXVxyXG4gKi9cclxuY29uc3QgY3JlYXRlUmljaFRleHQgPSAoIHRhbmRlbTogVGFuZGVtLCBwcm92aWRlZE9wdGlvbnM/OiBSaWNoVGV4dE9wdGlvbnMgKSA9PiBuZXcgUmljaFRleHQoICcnLCBjb21iaW5lT3B0aW9uczxUZXh0T3B0aW9ucz4oIHtcclxuICB0YW5kZW06IHRhbmRlbSxcclxuICBmb250OiBGT05UXHJcbn0sIHByb3ZpZGVkT3B0aW9ucyApICk7XHJcblxyXG5jb25zdCBpbmZpbml0eVNwYW4gPSAnPHNwYW4gc3R5bGU9XCJmb250LXNpemU6IDI2cHg7IGZvbnQtZmFtaWx5OiBzZXJpZjtcIj48Yj7iiJ48L2I+PC9zcGFuPic7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBWYWx1ZU5vZGUgZXh0ZW5kcyBQYW5lbCB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlVmFsdWVOb2RlOiAoKSA9PiB2b2lkO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gc291cmNlUmVzaXN0YW5jZVByb3BlcnR5IC0gdXNlci1zcGVjaWZpZWQgdmFsdWUgZm9yIGludGVybmFsIHJlc2lzdGFuY2UgZm9yIGJhdHRlcmllc1xyXG4gICAqIEBwYXJhbSBjaXJjdWl0RWxlbWVudFxyXG4gICAqIEBwYXJhbSBzaG93VmFsdWVzUHJvcGVydHlcclxuICAgKiBAcGFyYW0gdmlld1R5cGVQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB0YW5kZW1cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHNvdXJjZVJlc2lzdGFuY2VQcm9wZXJ0eTogUHJvcGVydHk8bnVtYmVyPiwgY2lyY3VpdEVsZW1lbnQ6IENpcmN1aXRFbGVtZW50LCBzaG93VmFsdWVzUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+LCB2aWV3VHlwZVByb3BlcnR5OiBQcm9wZXJ0eTxDaXJjdWl0RWxlbWVudFZpZXdUeXBlPiwgdGFuZGVtOiBUYW5kZW0gKSB7XHJcblxyXG4gICAgY29uc3QgY29udGVudE5vZGUgPSBuZXcgVkJveCgge1xyXG4gICAgICBtYXhXaWR0aDogMTMwXHJcbiAgICB9ICk7XHJcblxyXG4gICAgbGV0IHJlYWRvdXRWYWx1ZU5vZGU6IE5vZGUgfCBudWxsO1xyXG4gICAgbGV0IHVwZGF0ZTogbnVsbCB8ICggKCkgPT4gdm9pZCApID0gbnVsbDtcclxuICAgIGlmICggY2lyY3VpdEVsZW1lbnQgaW5zdGFuY2VvZiBWb2x0YWdlU291cmNlICkge1xyXG5cclxuICAgICAgY29uc3Qgdm9sdGFnZVRleHQgPSBjcmVhdGVUZXh0KCB0YW5kZW0uY3JlYXRlVGFuZGVtKCAndm9sdGFnZVRleHQnICkgKTtcclxuXHJcbiAgICAgIGNvbnN0IHZvbHRhZ2VNdWx0aWxpbmsgPSBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIGNpcmN1aXRFbGVtZW50LnZvbHRhZ2VQcm9wZXJ0eSwgdm9sdGFnZVVuaXRzU3RyaW5nUHJvcGVydHkgXSwgKCB2b2x0YWdlLCB2b2x0YWdlU3RyaW5nICkgPT4ge1xyXG4gICAgICAgIHZvbHRhZ2VUZXh0LnN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggdm9sdGFnZVN0cmluZywge1xyXG4gICAgICAgICAgdm9sdGFnZTogVXRpbHMudG9GaXhlZCggdm9sdGFnZSwgY2lyY3VpdEVsZW1lbnQubnVtYmVyT2ZEZWNpbWFsUGxhY2VzIClcclxuICAgICAgICB9ICk7XHJcbiAgICAgICAgdXBkYXRlICYmIHVwZGF0ZSgpO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBCYXR0ZXJ5IHJlYWRvdXRzIHNob3dzIHZvbHRhZ2UgYW5kIGludGVybmFsIHJlc2lzdGFuY2UgaWYgaXQgaXMgbm9uemVyb1xyXG4gICAgICByZWFkb3V0VmFsdWVOb2RlID0gbmV3IFZCb3goIHtcclxuICAgICAgICBhbGlnbjogJ3JpZ2h0JyxcclxuICAgICAgICBjaGlsZHJlbjogWyB2b2x0YWdlVGV4dCBdXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc2lzdGFuY2VOb2RlID0gY3JlYXRlVGV4dCggdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Jlc2lzdGFuY2VUZXh0JyApICk7XHJcblxyXG4gICAgICBjb25zdCBzb3VyY2VSZXNpc3RhbmNlTXVsdGlsaW5rID0gTXVsdGlsaW5rLm11bHRpbGluayggWyBzb3VyY2VSZXNpc3RhbmNlUHJvcGVydHksIHJlc2lzdGFuY2VPaG1zU3ltYm9sU3RyaW5nUHJvcGVydHkgXSwgKCBzb3VyY2VSZXNpc3RhbmNlLCBzb3VyY2VSZXNpc3RhbmNlU3RyaW5nICkgPT4ge1xyXG4gICAgICAgIHJlc2lzdGFuY2VOb2RlLnN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggc291cmNlUmVzaXN0YW5jZVN0cmluZywge1xyXG4gICAgICAgICAgcmVzaXN0YW5jZTogVXRpbHMudG9GaXhlZCggc291cmNlUmVzaXN0YW5jZSwgMSApXHJcbiAgICAgICAgfSApO1xyXG5cclxuICAgICAgICAvLyBJZiB0aGUgY2hpbGRyZW4gc2hvdWxkIGNoYW5nZSwgdXBkYXRlIHRoZW0gaGVyZVxyXG4gICAgICAgIGNvbnN0IGRlc2lyZWRDaGlsZHJlbiA9IHNvdXJjZVJlc2lzdGFuY2UgPiBDQ0tDUXVlcnlQYXJhbWV0ZXJzLmJhdHRlcnlNaW5pbXVtUmVzaXN0YW5jZSA/IFsgdm9sdGFnZVRleHQsIHJlc2lzdGFuY2VOb2RlIF0gOiBbIHZvbHRhZ2VUZXh0IF07XHJcblxyXG4gICAgICAgIC8vIE9ubHkgc2V0IGNoaWxkcmVuIGlmIGNoYW5nZWRcclxuICAgICAgICBpZiAoIHJlYWRvdXRWYWx1ZU5vZGUhLmdldENoaWxkcmVuQ291bnQoKSAhPT0gZGVzaXJlZENoaWxkcmVuLmxlbmd0aCApIHtcclxuICAgICAgICAgIHJlYWRvdXRWYWx1ZU5vZGUhLmNoaWxkcmVuID0gZGVzaXJlZENoaWxkcmVuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB1cGRhdGUgJiYgdXBkYXRlKCk7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIGNvbnRlbnROb2RlLmRpc3Bvc2VFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgICAgdm9sdGFnZU11bHRpbGluay5kaXNwb3NlKCk7XHJcbiAgICAgICAgc291cmNlUmVzaXN0YW5jZU11bHRpbGluay5kaXNwb3NlKCk7XHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuXHJcbiAgICBlbHNlIGlmICggY2lyY3VpdEVsZW1lbnQgaW5zdGFuY2VvZiBSZXNpc3RvciB8fFxyXG4gICAgICAgICAgICAgIGNpcmN1aXRFbGVtZW50IGluc3RhbmNlb2YgTGlnaHRCdWxiICkge1xyXG4gICAgICByZWFkb3V0VmFsdWVOb2RlID0gY3JlYXRlVGV4dCggdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Jlc2lzdGFuY2VUZXh0JyApICk7XHJcblxyXG4gICAgICAvLyBJdGVtcyBsaWtlIHRoZSBoYW5kIGFuZCBkb2cgYW5kIGhpZ2ggcmVzaXN0YW5jZSByZXNpc3RvciBzaG91bGRuJ3Qgc2hvdyBcIi4wXCJcclxuXHJcbiAgICAgIGNvbnN0IHJlc2lzdGFuY2VNdWx0aWxpbmsgPSBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIGNpcmN1aXRFbGVtZW50LnJlc2lzdGFuY2VQcm9wZXJ0eSwgcmVzaXN0YW5jZU9obXNTeW1ib2xTdHJpbmdQcm9wZXJ0eSBdLCAoIHJlc2lzdGFuY2UsIHJlc2lzdGFuY2VTdHJpbmcgKSA9PiB7XHJcbiAgICAgICAgKCByZWFkb3V0VmFsdWVOb2RlIGFzIFRleHQgKS5zdHJpbmcgPSBTdHJpbmdVdGlscy5maWxsSW4oIHJlc2lzdGFuY2VTdHJpbmcsIHtcclxuICAgICAgICAgIHJlc2lzdGFuY2U6IFV0aWxzLnRvRml4ZWQoIHJlc2lzdGFuY2UsIGNpcmN1aXRFbGVtZW50Lm51bWJlck9mRGVjaW1hbFBsYWNlcyApXHJcbiAgICAgICAgfSApO1xyXG4gICAgICAgIHVwZGF0ZSAmJiB1cGRhdGUoKTtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgY29udGVudE5vZGUuZGlzcG9zZUVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHJlc2lzdGFuY2VNdWx0aWxpbmsuZGlzcG9zZSgpICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggY2lyY3VpdEVsZW1lbnQgaW5zdGFuY2VvZiBDYXBhY2l0b3IgKSB7XHJcbiAgICAgIHJlYWRvdXRWYWx1ZU5vZGUgPSBjcmVhdGVUZXh0KCB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnY2FwYWNpdG9yVGV4dCcgKSApO1xyXG5cclxuICAgICAgLy8gSXRlbXMgbGlrZSB0aGUgaGFuZCBhbmQgZG9nIGFuZCBoaWdoIHJlc2lzdGFuY2UgcmVzaXN0b3Igc2hvdWxkbid0IHNob3cgXCIuMFwiXHJcblxyXG4gICAgICBjb25zdCBjYXBhY2l0YW5jZU11bHRpbGluayA9IE11bHRpbGluay5tdWx0aWxpbmsoIFsgY2lyY3VpdEVsZW1lbnQuY2FwYWNpdGFuY2VQcm9wZXJ0eSwgY2FwYWNpdGFuY2VGYXJhZHNTeW1ib2xTdHJpbmdQcm9wZXJ0eSBdLCAoIGNhcGFjaXRhbmNlLCBjYXBhY2l0YW5jZVN0cmluZyApID0+IHtcclxuICAgICAgICAoIHJlYWRvdXRWYWx1ZU5vZGUgYXMgVGV4dCApLnN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggY2FwYWNpdGFuY2VTdHJpbmcsIHtcclxuICAgICAgICAgIHJlc2lzdGFuY2U6IFV0aWxzLnRvRml4ZWQoIGNhcGFjaXRhbmNlLCBjaXJjdWl0RWxlbWVudC5udW1iZXJPZkRlY2ltYWxQbGFjZXMgKVxyXG4gICAgICAgIH0gKTtcclxuICAgICAgICB1cGRhdGUgJiYgdXBkYXRlKCk7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIGNvbnRlbnROb2RlLmRpc3Bvc2VFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiBjYXBhY2l0YW5jZU11bHRpbGluay5kaXNwb3NlKCkgKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBjaXJjdWl0RWxlbWVudCBpbnN0YW5jZW9mIEluZHVjdG9yICkge1xyXG4gICAgICByZWFkb3V0VmFsdWVOb2RlID0gY3JlYXRlVGV4dCggdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2luZHVjdG9yVGV4dCcgKSApO1xyXG5cclxuICAgICAgY29uc3QgaW5kdWN0YW5jZU11bHRpbGluayA9IE11bHRpbGluay5tdWx0aWxpbmsoIFsgY2lyY3VpdEVsZW1lbnQuaW5kdWN0YW5jZVByb3BlcnR5LCBpbmR1Y3RhbmNlSGVucmllc1N5bWJvbFN0cmluZ1Byb3BlcnR5IF0sICggaW5kdWN0YW5jZSwgaW5kdWN0YW5jZVN0cmluZyApID0+IHtcclxuICAgICAgICAoIHJlYWRvdXRWYWx1ZU5vZGUgYXMgVGV4dCApLnN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggaW5kdWN0YW5jZVN0cmluZywge1xyXG4gICAgICAgICAgcmVzaXN0YW5jZTogVXRpbHMudG9GaXhlZCggaW5kdWN0YW5jZSwgY2lyY3VpdEVsZW1lbnQubnVtYmVyT2ZEZWNpbWFsUGxhY2VzIClcclxuICAgICAgICB9ICk7XHJcbiAgICAgICAgdXBkYXRlICYmIHVwZGF0ZSgpO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICBjb250ZW50Tm9kZS5kaXNwb3NlRW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4gaW5kdWN0YW5jZU11bHRpbGluay5kaXNwb3NlKCkgKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBjaXJjdWl0RWxlbWVudCBpbnN0YW5jZW9mIFN3aXRjaCApIHtcclxuXHJcbiAgICAgIC8vIE1ha2UgaXQgZWFzaWVyIHRvIHJlYWQgdGhlIGluZmluaXR5IHN5bWJvbCwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jaXJjdWl0LWNvbnN0cnVjdGlvbi1raXQtZGMvaXNzdWVzLzEzNVxyXG4gICAgICByZWFkb3V0VmFsdWVOb2RlID0gY3JlYXRlUmljaFRleHQoIHRhbmRlbS5jcmVhdGVUYW5kZW0oICdzd2l0Y2hUZXh0JyApICk7XHJcblxyXG4gICAgICBjb25zdCBzd2l0Y2hNdWx0aWxpbmsgPSBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIGNpcmN1aXRFbGVtZW50LnJlc2lzdGFuY2VQcm9wZXJ0eSwgcmVzaXN0YW5jZU9obXNTeW1ib2xTdHJpbmdQcm9wZXJ0eSBdLCAoIHJlc2lzdGFuY2UsIHJlc2lzdGFuY2VTdHJpbmcgKSA9PiB7XHJcbiAgICAgICAgKCByZWFkb3V0VmFsdWVOb2RlIGFzIFJpY2hUZXh0ICkuc3RyaW5nID0gU3RyaW5nVXRpbHMuZmlsbEluKCByZXNpc3RhbmNlU3RyaW5nLCB7XHJcblxyXG4gICAgICAgICAgLy8gVXNpbmcgYSBzZXJpZiBmb250IG1ha2VzIHRoZSBpbmZpbml0eSBzeW1ib2wgbG9vayBsZXNzIGxvcHNpZGVkXHJcbiAgICAgICAgICByZXNpc3RhbmNlOiByZXNpc3RhbmNlID4gMTAwMDAwID8gaW5maW5pdHlTcGFuIDogJzAnXHJcbiAgICAgICAgfSApO1xyXG5cclxuICAgICAgICAvLyBBY2NvdW50IGZvciB0aGUgc3dpdGNoIG9wZW4gYW5kIGNsb3NlIGdlb21ldHJ5IGZvciBwb3NpdGlvbmluZyB0aGUgbGFiZWwuICBXaGVuIHRoZSBzd2l0Y2ggaXMgb3BlblxyXG4gICAgICAgIC8vIHRoZSBsYWJlbCBtdXN0IGJlIGhpZ2hlclxyXG4gICAgICAgIHVwZGF0ZSAmJiB1cGRhdGUoKTtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgY29udGVudE5vZGUuZGlzcG9zZUVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHN3aXRjaE11bHRpbGluay5kaXNwb3NlKCkgKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBjaXJjdWl0RWxlbWVudCBpbnN0YW5jZW9mIEZ1c2UgKSB7XHJcbiAgICAgIHJlYWRvdXRWYWx1ZU5vZGUgPSBjcmVhdGVSaWNoVGV4dCggdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2Z1c2VUZXh0JyApLCB7XHJcbiAgICAgICAgYWxpZ246ICdyaWdodCcsXHJcbiAgICAgICAgZmlsbDogQ0NLQ0NvbG9ycy50ZXh0RmlsbFByb3BlcnR5XHJcbiAgICAgIH0gKTtcclxuICAgICAgY29uc3QgbXVsdGlsaW5rID0gTXVsdGlsaW5rLm11bHRpbGluayggWyBjaXJjdWl0RWxlbWVudC5yZXNpc3RhbmNlUHJvcGVydHksIGNpcmN1aXRFbGVtZW50LmN1cnJlbnRSYXRpbmdQcm9wZXJ0eSwgZnVzZVZhbHVlU3RyaW5nUHJvcGVydHkgXSxcclxuICAgICAgICAoIHJlc2lzdGFuY2UsIGN1cnJlbnRSYXRpbmcsIGZ1c2VWYWx1ZVN0cmluZyApID0+IHtcclxuICAgICAgICAgIGNvbnN0IG1pbGxpT2htU3RyaW5nID0gcmVzaXN0YW5jZSA9PT0gQ0NLQ0NvbnN0YW50cy5NQVhfUkVTSVNUQU5DRSA/IGluZmluaXR5U3BhbiA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLnRvRml4ZWQoIHJlc2lzdGFuY2UgKiAxMDAwLCBjaXJjdWl0RWxlbWVudC5udW1iZXJPZkRlY2ltYWxQbGFjZXMgKTtcclxuICAgICAgICAgICggcmVhZG91dFZhbHVlTm9kZSBhcyBSaWNoVGV4dCApLnN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggZnVzZVZhbHVlU3RyaW5nLCB7XHJcblxyXG4gICAgICAgICAgICAvLyBDb252ZXJ0IHRvIG1pbGxpXHJcbiAgICAgICAgICAgIHJlc2lzdGFuY2U6IG1pbGxpT2htU3RyaW5nLFxyXG4gICAgICAgICAgICBjdXJyZW50UmF0aW5nOiBVdGlscy50b0ZpeGVkKCBjdXJyZW50UmF0aW5nLCBjaXJjdWl0RWxlbWVudC5udW1iZXJPZkRlY2ltYWxQbGFjZXMgKVxyXG4gICAgICAgICAgfSApO1xyXG4gICAgICAgICAgdXBkYXRlICYmIHVwZGF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuICAgICAgY29udGVudE5vZGUuZGlzcG9zZUVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IG11bHRpbGluay5kaXNwb3NlKCkgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoIGBWYWx1ZU5vZGUgY2Fubm90IGJlIHNob3duIGZvciAke2NpcmN1aXRFbGVtZW50LmNvbnN0cnVjdG9yLm5hbWV9YCApO1xyXG4gICAgfVxyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHJlYWRvdXRWYWx1ZU5vZGUsICdDb250ZW50IG5vZGUgc2hvdWxkIGJlIGRlZmluZWQnICk7XHJcblxyXG4gICAgaWYgKCBDQ0tDUXVlcnlQYXJhbWV0ZXJzLnNob3dDdXJyZW50cyApIHtcclxuICAgICAgY29uc3QgdGV4dCA9IG5ldyBUZXh0KCAnJywgeyBmaWxsOiBDQ0tDQ29sb3JzLnRleHRGaWxsUHJvcGVydHkgfSApO1xyXG4gICAgICBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIGNpcmN1aXRFbGVtZW50LmN1cnJlbnRQcm9wZXJ0eSwgY2lyY3VpdEVsZW1lbnQuY3VycmVudFNlbnNlUHJvcGVydHkgXSwgKCBjdXJyZW50LCBzZW5zZSApID0+IHtcclxuICAgICAgICB0ZXh0LnN0cmluZyA9IHNlbnNlLnRvU3RyaW5nKCkgKyAnLCAnICsgY3VycmVudC50b0ZpeGVkKCA0ICk7Ly8gZXNsaW50LWRpc2FibGUtbGluZSBiYWQtc2ltLXRleHRcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgcmVhZG91dFZhbHVlTm9kZSA9IG5ldyBWQm94KCB7IGNoaWxkcmVuOiBbIHJlYWRvdXRWYWx1ZU5vZGUsIHRleHQgXSB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY3VzdG9tTGFiZWxOb2RlID0gbmV3IFRleHQoICcnLCB7IGZvbnQ6IEZPTlQsIGZpbGw6IENDS0NDb2xvcnMudGV4dEZpbGxQcm9wZXJ0eSB9ICk7XHJcbiAgICBjb250ZW50Tm9kZS5jaGlsZHJlbiA9IFtcclxuICAgICAgY3VzdG9tTGFiZWxOb2RlLFxyXG4gICAgICByZWFkb3V0VmFsdWVOb2RlXHJcbiAgICBdO1xyXG5cclxuICAgIHN1cGVyKCBjb250ZW50Tm9kZSwge1xyXG4gICAgICBzdHJva2U6IG51bGwsXHJcbiAgICAgIGZpbGw6IG5ldyBDb2xvciggMjU1LCAyNTUsIDI1NSwgMC42ICksIC8vIHB1dCB0cmFuc3BhcmVuY3kgaW4gdGhlIGNvbG9yIHNvIHRoYXQgdGhlIGNoaWxkcmVuIGFyZW4ndCB0cmFuc3BhcmVudFxyXG4gICAgICB0YW5kZW06IHRhbmRlbSxcclxuICAgICAgY29ybmVyUmFkaXVzOiAzLFxyXG4gICAgICB4TWFyZ2luOiAzLFxyXG4gICAgICB5TWFyZ2luOiAxLFxyXG4gICAgICB2aXNpYmxlUHJvcGVydHlPcHRpb25zOiB7XHJcbiAgICAgICAgcGhldGlvUmVhZE9ubHk6IHRydWUgLy8gY29udHJvbGxlZCBieSB0aGUgQ2lyY3VpdEVsZW1lbnQuaXNWYWx1ZURpc3BsYXlhYmxlUHJvcGVydHlcclxuICAgICAgfSxcclxuICAgICAgcGlja2FibGU6IGZhbHNlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgbWF0cml4ID0gTWF0cml4My5pZGVudGl0eSgpO1xyXG5cclxuICAgIHVwZGF0ZSA9ICgpID0+IHtcclxuXHJcbiAgICAgIHJlYWRvdXRWYWx1ZU5vZGUhLnZpc2libGUgPSBzaG93VmFsdWVzUHJvcGVydHkudmFsdWUgJiYgY2lyY3VpdEVsZW1lbnQuaXNWYWx1ZURpc3BsYXlhYmxlUHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgICBjb25zdCBjdXN0b21MYWJlbFRleHQgPSBjaXJjdWl0RWxlbWVudC5sYWJlbFN0cmluZ1Byb3BlcnR5LnZhbHVlO1xyXG4gICAgICBjdXN0b21MYWJlbE5vZGUuc3RyaW5nID0gY3VzdG9tTGFiZWxUZXh0O1xyXG4gICAgICBjdXN0b21MYWJlbE5vZGUudmlzaWJsZSA9IGN1c3RvbUxhYmVsVGV4dC5sZW5ndGggPiAwO1xyXG5cclxuICAgICAgLy8gRm9yIGEgbGlnaHQgYnVsYiwgY2hvb3NlIHRoZSBwYXJ0IG9mIHRoZSBmaWxhbWVudCBpbiB0aGUgdG9wIGNlbnRlciBmb3IgdGhlIGxhYmVsLCBzZWVcclxuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NpcmN1aXQtY29uc3RydWN0aW9uLWtpdC1jb21tb24vaXNzdWVzLzMyNVxyXG4gICAgICBjb25zdCBkaXN0YW5jZSA9IGNpcmN1aXRFbGVtZW50IGluc3RhbmNlb2YgTGlnaHRCdWxiID8gMC41NiA6IDAuNTtcclxuXHJcbiAgICAgIC8vIFRoZSBsYWJlbCBwYXJ0aWFsbHkgb3ZlcmxhcHMgdGhlIGNvbXBvbmVudCB0byBtYWtlIGl0IGNsZWFyIHdoaWNoIGxhYmVsIGdvZXMgd2l0aCB3aGljaCBjb21wb25lbnRcclxuICAgICAgY2lyY3VpdEVsZW1lbnQudXBkYXRlTWF0cml4Rm9yUG9pbnQoIGNpcmN1aXRFbGVtZW50LmNoYXJnZVBhdGhMZW5ndGggKiBkaXN0YW5jZSwgbWF0cml4ICk7XHJcbiAgICAgIGNvbnN0IGRlbHRhID0gVmVjdG9yMi5jcmVhdGVQb2xhciggVkVSVElDQUxfT0ZGU0VULCBtYXRyaXgucm90YXRpb24gKyAzICogTWF0aC5QSSAvIDIgKTtcclxuXHJcbiAgICAgIC8vIFB1dCB0aGUgbGFiZWwgYWJvdmUgdGhlIGNpcmN1aXQgZWxlbWVudCwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jaXJjdWl0LWNvbnN0cnVjdGlvbi1raXQtY29tbW9uL2lzc3Vlcy84NDVcclxuICAgICAgaWYgKCBkZWx0YS55ID4gMCApIHtcclxuICAgICAgICBkZWx0YS55ID0gLWRlbHRhLnk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5jZW50ZXJCb3R0b20gPSBtYXRyaXgudHJhbnNsYXRpb24ucGx1cyggZGVsdGEudGltZXNTY2FsYXIoIDAuOCApICk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNpcmN1aXRFbGVtZW50LnZlcnRleE1vdmVkRW1pdHRlci5hZGRMaXN0ZW5lciggdXBkYXRlICk7XHJcbiAgICBjaXJjdWl0RWxlbWVudC5pc1ZhbHVlRGlzcGxheWFibGVQcm9wZXJ0eS5saW5rKCB1cGRhdGUgKTtcclxuXHJcbiAgICB1cGRhdGUoKTtcclxuICAgIHNob3dWYWx1ZXNQcm9wZXJ0eS5saW5rKCB1cGRhdGUgKTtcclxuICAgIHZpZXdUeXBlUHJvcGVydHkubGluayggdXBkYXRlICk7XHJcbiAgICBjaXJjdWl0RWxlbWVudC5sYWJlbFN0cmluZ1Byb3BlcnR5LmxpbmsoIHVwZGF0ZSApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZVZhbHVlTm9kZSA9ICgpID0+IHtcclxuICAgICAgY29udGVudE5vZGUuZGlzcG9zZSgpO1xyXG4gICAgICBjaXJjdWl0RWxlbWVudC52ZXJ0ZXhNb3ZlZEVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoIHVwZGF0ZSEgKTtcclxuICAgICAgc2hvd1ZhbHVlc1Byb3BlcnR5LnVubGluayggdXBkYXRlISApO1xyXG4gICAgICB2aWV3VHlwZVByb3BlcnR5LnVubGluayggdXBkYXRlISApO1xyXG4gICAgICBjaXJjdWl0RWxlbWVudC5sYWJlbFN0cmluZ1Byb3BlcnR5LnVubGluayggdXBkYXRlISApO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gICAgdGhpcy5kaXNwb3NlVmFsdWVOb2RlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5jaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uLnJlZ2lzdGVyKCAnVmFsdWVOb2RlJywgVmFsdWVOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLE9BQU9BLE9BQU8sTUFBTSw0QkFBNEI7QUFDaEQsT0FBT0MsS0FBSyxNQUFNLDBCQUEwQjtBQUM1QyxPQUFPQyxPQUFPLE1BQU0sNEJBQTRCO0FBQ2hELE9BQU9DLFdBQVcsTUFBTSw0Q0FBNEM7QUFDcEUsT0FBT0MsUUFBUSxNQUFNLHNDQUFzQztBQUMzRCxTQUFTQyxLQUFLLEVBQVFDLFFBQVEsRUFBbUJDLElBQUksRUFBZUMsSUFBSSxRQUFRLGdDQUFnQztBQUNoSCxPQUFPQyxLQUFLLE1BQU0sMEJBQTBCO0FBQzVDLE9BQU9DLGFBQWEsTUFBTSxxQkFBcUI7QUFDL0MsT0FBT0MsbUJBQW1CLE1BQU0sMkJBQTJCO0FBQzNELE9BQU9DLG1DQUFtQyxNQUFNLDJDQUEyQztBQUMzRixPQUFPQyw0QkFBNEIsTUFBTSxvQ0FBb0M7QUFDN0UsT0FBT0MsU0FBUyxNQUFNLHVCQUF1QjtBQUM3QyxPQUFPQyxJQUFJLE1BQU0sa0JBQWtCO0FBQ25DLE9BQU9DLFFBQVEsTUFBTSxzQkFBc0I7QUFDM0MsT0FBT0MsU0FBUyxNQUFNLHVCQUF1QjtBQUM3QyxPQUFPQyxRQUFRLE1BQU0sc0JBQXNCO0FBQzNDLE9B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