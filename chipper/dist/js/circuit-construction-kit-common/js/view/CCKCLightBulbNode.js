// Copyright 2015-2023, University of Colorado Boulder

/**
 * Named CCKCLightBulbNode to avoid collisions with SCENERY_PHET/LightBulbNode. Renders the bulb shape
 * and brightness lines. Note that the socket is rendered in LightBulbSocketNode.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import NumberProperty from '../../../axon/js/NumberProperty.js';
import Matrix3 from '../../../dot/js/Matrix3.js';
import Utils from '../../../dot/js/Utils.js';
import Vector2 from '../../../dot/js/Vector2.js';
import { Shape } from '../../../kite/js/imports.js';
import { Color, Image, Node, Path } from '../../../scenery/js/imports.js';
import lightBulbMiddleHigh_png from '../../mipmaps/lightBulbMiddleHigh_png.js';
import lightBulbMiddleReal_png from '../../mipmaps/lightBulbMiddleReal_png.js';
import lightBulbFrontReal_png from '../../images/lightBulbFrontReal_png.js';
import lightBulbMiddle_png from '../../mipmaps/lightBulbMiddle_png.js';
import CCKCConstants from '../CCKCConstants.js';
import circuitConstructionKitCommon from '../circuitConstructionKitCommon.js';
import CustomLightBulbNode from './CustomLightBulbNode.js';
import FixedCircuitElementNode from './FixedCircuitElementNode.js';
import LightBulbSocketNode from './LightBulbSocketNode.js';
import schematicTypeProperty from './schematicTypeProperty.js';
import LightBulb from '../model/LightBulb.js';
import CircuitElementViewType from '../model/CircuitElementViewType.js';
import Tandem from '../../../tandem/js/Tandem.js';
import SchematicType from './SchematicType.js';
import Multilink from '../../../axon/js/Multilink.js';
import { combineOptions } from '../../../phet-core/js/optionize.js';

// constants
const SCRATCH_MATRIX = new Matrix3();

// The height from the vertex to the center of the light bulb schematic circle
const LEAD_Y = -73;

// The "blip" in the filament that looks like an upside down "u" semicircle
const INNER_RADIUS = 5;

/**
 * Determine the brightness for a given power
 * @param multiplier - steepness of the function
 * @param power - the power through the light bulb
 */
const toBrightness = (multiplier, power) => {
  const maximumBrightness = 1;

  // power at which the brightness becomes 1
  const maximumPower = 2000;
  return Math.log(1 + power * multiplier) * maximumBrightness / Math.log(1 + maximumPower * multiplier);
};
export default class CCKCLightBulbNode extends FixedCircuitElementNode {
  /**
   * @param screenView - main screen view, null for icon
   * @param circuitNode, null for icon
   * @param lightBulb - the light bulb model
   * @param showResultsProperty - true if the sim can display values
   * @param viewTypeProperty
   * @param tandem
   * @param [providedOptions]
   */
  constructor(screenView, circuitNode, lightBulb, showResultsProperty, viewTypeProperty, tandem, providedOptions) {
    const filledOptions = combineOptions({
      isIcon: false,
      useHitTestForSensors: true
    }, providedOptions);
    const brightnessProperty = new NumberProperty(0);
    const updateBrightness = Multilink.multilink([lightBulb.currentProperty, showResultsProperty, lightBulb.resistanceProperty], (current, running, resistance) => {
      const power = Math.abs(current * current * resistance);
      let brightness = toBrightness(0.35, power);

      // Workaround for SCENERY_PHET/LightBulbNode which shows highlight even for current = 1E-16, so clamp it off
      // see https://github.com/phetsims/scenery-phet/issues/225
      if (brightness < 1E-6) {
        brightness = 0;
      }
      brightnessProperty.value = Utils.clamp(brightness, 0, 1);
    });
    let lightBulbNode = new CustomLightBulbNode(brightnessProperty, {
      isReal: lightBulb.isReal
    });

    // The isIcon must show the socket as well
    if (filledOptions.isIcon) {
      lightBulbNode = new Image(lightBulb.isExtreme ? lightBulbMiddleHigh_png : lightBulb.isReal ? lightBulbMiddleReal_png : lightBulbMiddle_png, {
        scale: 0.37
      });

      // tack on the socket
      if (lightBulb.isReal) {
        lightBulbNode.addChild(new Image(lightBulbFrontReal_png));
      }
    }

    // Schematic creation begins here.

    // In order to support phet-io customization at an angle, we must use the normalized (upright) positions.
    const normalizedPoints = LightBulb.createSamplePoints(lightBulb.startPositionProperty.get());
    const startPosition = normalizedPoints[0];
    const endPosition = normalizedPoints[1];
    const delta = endPosition.minus(startPosition);
    const rightLeadX = delta.x;
    const schematicCircleRadius = delta.x / 2;

    /**
     * Adds the schematic circle with filament to the given Shape.
     * @param shape
     * @returns Shape
     */
    const addIEEESchematicCircle = shape => shape

    // Outer circle
    .moveTo(0, LEAD_Y).arc(rightLeadX / 2, LEAD_Y, schematicCircleRadius, Math.PI, -Math.PI, true)

    // Filament
    .moveTo(0, LEAD_Y).arc(schematicCircleRadius, LEAD_Y, INNER_RADIUS, Math.PI, 0, false).lineTo(rightLeadX, LEAD_Y);
    const schematicCircleDiameter = 2 * schematicCircleRadius;
    const cosPi4 = Math.cos(Math.PI / 4);
    const sinPi4 = Math.sin(Math.PI / 4);
    const addIECSchematicCircle = shape => shape.moveTo(0, LEAD_Y)

    // the circle
    .arc(rightLeadX / 2, LEAD_Y, schematicCircleRadius, Math.PI, -Math.PI, true)

    // go to circle center to draw the 'x' (2 crossed lines) inside it.
    // Addition of 0.5 seems to visually work better!
    .moveTo(schematicCircleRadius + 0.5, LEAD_Y)

    // a line from center to circumference
    .lineToRelative(schematicCircleRadius * cosPi4, -schematicCircleRadius * sinPi4)

    // continue the line to the other side of the circle
    .lineToRelative(-schematicCircleDiameter * cosPi4, schematicCircleDiameter * sinPi4)

    // repeat to draw the other line at 90 degrees to the first
    .moveTo(schematicCircleRadius, LEAD_Y).lineToRelative(-schematicCircleRadius * cosPi4, -schematicCircleRadius * sinPi4).lineToRelative(schematicCircleDiameter * cosPi4, schematicCircleDiameter * sinPi4);
    const addLeads = shape => shape

    // Left lead
    .moveTo(0, 0).lineTo(0, LEAD_Y)

    // Right lead
    .moveTo(rightLeadX, LEAD_Y).lineTo(rightLeadX, delta.y);
    const ieeeShapeWithLeads = addLeads(addIEEESchematicCircle(new Shape()));
    const iecShapeWithLeads = addLeads(addIECSchematicCircle(new Shape()));
    const ieeeShapeIcon = addIEEESchematicCircle(new Shape()).transformed(Matrix3.scaling(1.75));
    const iecShapeIcon = addIECSchematicCircle(new Shape()).transformed(Matrix3.scaling(1.75));
    const schematicNode = new Path(ieeeShapeIcon, {
      stroke: Color.BLACK,
      lineWidth: filledOptions.isIcon ? 4 : CCKCConstants.SCHEMATIC_LINE_WIDTH
    });
    if (filledOptions.isIcon) {
      schematicNode.center = lightBulbNode.center.plusXY(0, 22);
    }
    const updateSchematicType = schematicType => {
      if (filledOptions.isIcon) {
        schematicNode.shape = schematicType === SchematicType.IEEE ? ieeeShapeIcon : iecShapeIcon;
      } else {
        schematicNode.shape = schematicType === SchematicType.IEEE ? ieeeShapeWithLeads : iecShapeWithLeads;
      }
    };
    schematicTypeProperty.link(updateSchematicType);

    // Expand the pointer areas with a defensive copy, see https://github.com/phetsims/circuit-construction-kit-common/issues/310
    if (!filledOptions.isIcon) {
      schematicNode.mouseArea = schematicNode.bounds.dilated(2);
      schematicNode.touchArea = schematicNode.mouseArea;
    }
    super(screenView, circuitNode, lightBulb, viewTypeProperty, lightBulbNode, schematicNode, tandem, filledOptions);

    // node that contains the light rays so they can be easily positioned
    this.rayNodeContainer = new Node({
      // keep centering and translation
      children: lightBulbNode instanceof CustomLightBulbNode ? [lightBulbNode.raysNode] : []
    });
    let viewListener = null;
    if (circuitNode) {
      // Render the socket node in the front
      this.socketNode = new LightBulbSocketNode(screenView, circuitNode, lightBulb, viewTypeProperty, Tandem.OPT_OUT, filledOptions);
      viewListener = view => {
        this.rayNodeContainer.visible = view === CircuitElementViewType.LIFELIKE;
      };
      viewTypeProperty.link(viewListener);
      circuitNode && !lightBulb.phetioIsArchetype && circuitNode.lightBulbSocketLayer.addChild(this.socketNode);

      // Light rays are supposed to be behind everything else,
      // see https://github.com/phetsims/circuit-construction-kit-common/issues/161
      circuitNode && circuitNode.addChildToBackground(this.rayNodeContainer);
    } else {
      this.socketNode = null;
    }
    this.disposeCircuitConstructionKitLightBulbNode = () => {
      updateBrightness.dispose();
      if (this.socketNode) {
        this.socketNode && circuitNode && circuitNode.lightBulbSocketLayer.removeChild(this.socketNode);

        // Light rays are supposed to be behind everything else,
        // see https://github.com/phetsims/circuit-construction-kit-common/issues/161
        circuitNode && circuitNode.removeChildFromBackground(this.rayNodeContainer);
        viewTypeProperty.unlink(viewListener);
        this.socketNode.dispose();
        schematicTypeProperty.unlink(updateSchematicType);
      } else {
        assert && assert(false, 'socketNode should be defined');
      }
    };
  }

  /**
   * Multiple updates may happen per frame, they are batched and updated once in the view step to improve performance.
   * CCKCLightBulbNode calls updateRender for its child socket node
   */
  updateRender() {
    const startPosition = this.circuitElement.startPositionProperty.get();
    const endPosition = this.circuitElement.endPositionProperty.get();
    const angle = Vector2.getAngleBetweenVectors(startPosition, endPosition) + Math.PI / 4;

    // Update the node transform in a single step, see #66
    SCRATCH_MATRIX.setToTranslationRotationPoint(startPosition, angle);
    this.contentNode.setMatrix(SCRATCH_MATRIX);
    this.rayNodeContainer.setMatrix(SCRATCH_MATRIX);
    this.highlightNode && this.highlightNode.setMatrix(SCRATCH_MATRIX);
    this.socketNode && this.socketNode.updateRender();
  }

  /**
   * Dispose when no longer used.
   */
  dispose() {
    this.disposeCircuitConstructionKitLightBulbNode();
    super.dispose();
  }

  /**
   * Maintain the opacity of the brightness lines while changing the opacity of the light bulb itself.
   */
  updateOpacityOnInteractiveChange() {

    // TODO (black-box-study): Make the light bulb images look faded out.
  }
}
circuitConstructionKitCommon.register('CCKCLightBulbNode', CCKCLightBulbNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOdW1iZXJQcm9wZXJ0eSIsIk1hdHJpeDMiLCJVdGlscyIsIlZlY3RvcjIiLCJTaGFwZSIsIkNvbG9yIiwiSW1hZ2UiLCJOb2RlIiwiUGF0aCIsImxpZ2h0QnVsYk1pZGRsZUhpZ2hfcG5nIiwibGlnaHRCdWxiTWlkZGxlUmVhbF9wbmciLCJsaWdodEJ1bGJGcm9udFJlYWxfcG5nIiwibGlnaHRCdWxiTWlkZGxlX3BuZyIsIkNDS0NDb25zdGFudHMiLCJjaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uIiwiQ3VzdG9tTGlnaHRCdWxiTm9kZSIsIkZpeGVkQ2lyY3VpdEVsZW1lbnROb2RlIiwiTGlnaHRCdWxiU29ja2V0Tm9kZSIsInNjaGVtYXRpY1R5cGVQcm9wZXJ0eSIsIkxpZ2h0QnVsYiIsIkNpcmN1aXRFbGVtZW50Vmlld1R5cGUiLCJUYW5kZW0iLCJTY2hlbWF0aWNUeXBlIiwiTXVsdGlsaW5rIiwiY29tYmluZU9wdGlvbnMiLCJTQ1JBVENIX01BVFJJWCIsIkxFQURfWSIsIklOTkVSX1JBRElVUyIsInRvQnJpZ2h0bmVzcyIsIm11bHRpcGxpZXIiLCJwb3dlciIsIm1heGltdW1CcmlnaHRuZXNzIiwibWF4aW11bVBvd2VyIiwiTWF0aCIsImxvZyIsIkNDS0NMaWdodEJ1bGJOb2RlIiwiY29uc3RydWN0b3IiLCJzY3JlZW5WaWV3IiwiY2lyY3VpdE5vZGUiLCJsaWdodEJ1bGIiLCJzaG93UmVzdWx0c1Byb3BlcnR5Iiwidmlld1R5cGVQcm9wZXJ0eSIsInRhbmRlbSIsInByb3ZpZGVkT3B0aW9ucyIsImZpbGxlZE9wdGlvbnMiLCJpc0ljb24iLCJ1c2VIaXRUZXN0Rm9yU2Vuc29ycyIsImJyaWdodG5lc3NQcm9wZXJ0eSIsInVwZGF0ZUJyaWdodG5lc3MiLCJtdWx0aWxpbmsiLCJjdXJyZW50UHJvcGVydHkiLCJyZXNpc3RhbmNlUHJvcGVydHkiLCJjdXJyZW50IiwicnVubmluZyIsInJlc2lzdGFuY2UiLCJhYnMiLCJicmlnaHRuZXNzIiwidmFsdWUiLCJjbGFtcCIsImxpZ2h0QnVsYk5vZGUiLCJpc1JlYWwiLCJpc0V4dHJlbWUiLCJzY2FsZSIsImFkZENoaWxkIiwibm9ybWFsaXplZFBvaW50cyIsImNyZWF0ZVNhbXBsZVBvaW50cyIsInN0YXJ0UG9zaXRpb25Qcm9wZXJ0eSIsImdldCIsInN0YXJ0UG9zaXRpb24iLCJlbmRQb3NpdGlvbiIsImRlbHRhIiwibWludXMiLCJyaWdodExlYWRYIiwieCIsInNjaGVtYXRpY0NpcmNsZVJhZGl1cyIsImFkZElFRUVTY2hlbWF0aWNDaXJjbGUiLCJzaGFwZSIsIm1vdmVUbyIsImFyYyIsIlBJIiwibGluZVRvIiwic2NoZW1hdGljQ2lyY2xlRGlhbWV0ZXIiLCJjb3NQaTQiLCJjb3MiLCJzaW5QaTQiLCJzaW4iLCJhZGRJRUNTY2hlbWF0aWNDaXJjbGUiLCJsaW5lVG9SZWxhdGl2ZSIsImFkZExlYWRzIiwieSIsImllZWVTaGFwZVdpdGhMZWFkcyIsImllY1NoYXBlV2l0aExlYWRzIiwiaWVlZVNoYXBlSWNvbiIsInRyYW5zZm9ybWVkIiwic2NhbGluZyIsImllY1NoYXBlSWNvbiIsInNjaGVtYXRpY05vZGUiLCJzdHJva2UiLCJCTEFDSyIsImxpbmVXaWR0aCIsIlNDSEVNQVRJQ19MSU5FX1dJRFRIIiwiY2VudGVyIiwicGx1c1hZIiwidXBkYXRlU2NoZW1hdGljVHlwZSIsInNjaGVtYXRpY1R5cGUiLCJJRUVFIiwibGluayIsIm1vdXNlQXJlYSIsImJvdW5kcyIsImRpbGF0ZWQiLCJ0b3VjaEFyZWEiLCJyYXlOb2RlQ29udGFpbmVyIiwiY2hpbGRyZW4iLCJyYXlzTm9kZSIsInZpZXdMaXN0ZW5lciIsInNvY2tldE5vZGUiLCJPUFRfT1VUIiwidmlldyIsInZpc2libGUiLCJMSUZFTElLRSIsInBoZXRpb0lzQXJjaGV0eXBlIiwibGlnaHRCdWxiU29ja2V0TGF5ZXIiLCJhZGRDaGlsZFRvQmFja2dyb3VuZCIsImRpc3Bvc2VDaXJjdWl0Q29uc3RydWN0aW9uS2l0TGlnaHRCdWxiTm9kZSIsImRpc3Bvc2UiLCJyZW1vdmVDaGlsZCIsInJlbW92ZUNoaWxkRnJvbUJhY2tncm91bmQiLCJ1bmxpbmsiLCJhc3NlcnQiLCJ1cGRhdGVSZW5kZXIiLCJjaXJjdWl0RWxlbWVudCIsImVuZFBvc2l0aW9uUHJvcGVydHkiLCJhbmdsZSIsImdldEFuZ2xlQmV0d2VlblZlY3RvcnMiLCJzZXRUb1RyYW5zbGF0aW9uUm90YXRpb25Qb2ludCIsImNvbnRlbnROb2RlIiwic2V0TWF0cml4IiwiaGlnaGxpZ2h0Tm9kZSIsInVwZGF0ZU9wYWNpdHlPbkludGVyYWN0aXZlQ2hhbmdlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJDQ0tDTGlnaHRCdWxiTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBOYW1lZCBDQ0tDTGlnaHRCdWxiTm9kZSB0byBhdm9pZCBjb2xsaXNpb25zIHdpdGggU0NFTkVSWV9QSEVUL0xpZ2h0QnVsYk5vZGUuIFJlbmRlcnMgdGhlIGJ1bGIgc2hhcGVcclxuICogYW5kIGJyaWdodG5lc3MgbGluZXMuIE5vdGUgdGhhdCB0aGUgc29ja2V0IGlzIHJlbmRlcmVkIGluIExpZ2h0QnVsYlNvY2tldE5vZGUuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IE51bWJlclByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvTnVtYmVyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBNYXRyaXgzIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9NYXRyaXgzLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgeyBDb2xvciwgSW1hZ2UsIE5vZGUsIFBhdGggfSBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbGlnaHRCdWxiTWlkZGxlSGlnaF9wbmcgZnJvbSAnLi4vLi4vbWlwbWFwcy9saWdodEJ1bGJNaWRkbGVIaWdoX3BuZy5qcyc7XHJcbmltcG9ydCBsaWdodEJ1bGJNaWRkbGVSZWFsX3BuZyBmcm9tICcuLi8uLi9taXBtYXBzL2xpZ2h0QnVsYk1pZGRsZVJlYWxfcG5nLmpzJztcclxuaW1wb3J0IGxpZ2h0QnVsYkZyb250UmVhbF9wbmcgZnJvbSAnLi4vLi4vaW1hZ2VzL2xpZ2h0QnVsYkZyb250UmVhbF9wbmcuanMnO1xyXG5pbXBvcnQgbGlnaHRCdWxiTWlkZGxlX3BuZyBmcm9tICcuLi8uLi9taXBtYXBzL2xpZ2h0QnVsYk1pZGRsZV9wbmcuanMnO1xyXG5pbXBvcnQgQ0NLQ0NvbnN0YW50cyBmcm9tICcuLi9DQ0tDQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IGNpcmN1aXRDb25zdHJ1Y3Rpb25LaXRDb21tb24gZnJvbSAnLi4vY2lyY3VpdENvbnN0cnVjdGlvbktpdENvbW1vbi5qcyc7XHJcbmltcG9ydCBDdXN0b21MaWdodEJ1bGJOb2RlIGZyb20gJy4vQ3VzdG9tTGlnaHRCdWxiTm9kZS5qcyc7XHJcbmltcG9ydCBGaXhlZENpcmN1aXRFbGVtZW50Tm9kZSwgeyBGaXhlZENpcmN1aXRFbGVtZW50Tm9kZU9wdGlvbnMgfSBmcm9tICcuL0ZpeGVkQ2lyY3VpdEVsZW1lbnROb2RlLmpzJztcclxuaW1wb3J0IExpZ2h0QnVsYlNvY2tldE5vZGUgZnJvbSAnLi9MaWdodEJ1bGJTb2NrZXROb2RlLmpzJztcclxuaW1wb3J0IHNjaGVtYXRpY1R5cGVQcm9wZXJ0eSBmcm9tICcuL3NjaGVtYXRpY1R5cGVQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBDQ0tDU2NyZWVuVmlldyBmcm9tICcuL0NDS0NTY3JlZW5WaWV3LmpzJztcclxuaW1wb3J0IENpcmN1aXROb2RlIGZyb20gJy4vQ2lyY3VpdE5vZGUuanMnO1xyXG5pbXBvcnQgTGlnaHRCdWxiIGZyb20gJy4uL21vZGVsL0xpZ2h0QnVsYi5qcyc7XHJcbmltcG9ydCBDaXJjdWl0RWxlbWVudFZpZXdUeXBlIGZyb20gJy4uL21vZGVsL0NpcmN1aXRFbGVtZW50Vmlld1R5cGUuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgU2NoZW1hdGljVHlwZSBmcm9tICcuL1NjaGVtYXRpY1R5cGUuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IHsgY29tYmluZU9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBTQ1JBVENIX01BVFJJWCA9IG5ldyBNYXRyaXgzKCk7XHJcblxyXG4vLyBUaGUgaGVpZ2h0IGZyb20gdGhlIHZlcnRleCB0byB0aGUgY2VudGVyIG9mIHRoZSBsaWdodCBidWxiIHNjaGVtYXRpYyBjaXJjbGVcclxuY29uc3QgTEVBRF9ZID0gLTczO1xyXG5cclxuLy8gVGhlIFwiYmxpcFwiIGluIHRoZSBmaWxhbWVudCB0aGF0IGxvb2tzIGxpa2UgYW4gdXBzaWRlIGRvd24gXCJ1XCIgc2VtaWNpcmNsZVxyXG5jb25zdCBJTk5FUl9SQURJVVMgPSA1O1xyXG5cclxuLyoqXHJcbiAqIERldGVybWluZSB0aGUgYnJpZ2h0bmVzcyBmb3IgYSBnaXZlbiBwb3dlclxyXG4gKiBAcGFyYW0gbXVsdGlwbGllciAtIHN0ZWVwbmVzcyBvZiB0aGUgZnVuY3Rpb25cclxuICogQHBhcmFtIHBvd2VyIC0gdGhlIHBvd2VyIHRocm91Z2ggdGhlIGxpZ2h0IGJ1bGJcclxuICovXHJcbmNvbnN0IHRvQnJpZ2h0bmVzcyA9ICggbXVsdGlwbGllcjogbnVtYmVyLCBwb3dlcjogbnVtYmVyICkgPT4ge1xyXG4gIGNvbnN0IG1heGltdW1CcmlnaHRuZXNzID0gMTtcclxuXHJcbiAgLy8gcG93ZXIgYXQgd2hpY2ggdGhlIGJyaWdodG5lc3MgYmVjb21lcyAxXHJcbiAgY29uc3QgbWF4aW11bVBvd2VyID0gMjAwMDtcclxuICByZXR1cm4gTWF0aC5sb2coIDEgKyBwb3dlciAqIG11bHRpcGxpZXIgKSAqIG1heGltdW1CcmlnaHRuZXNzIC8gTWF0aC5sb2coIDEgKyBtYXhpbXVtUG93ZXIgKiBtdWx0aXBsaWVyICk7XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDQ0tDTGlnaHRCdWxiTm9kZSBleHRlbmRzIEZpeGVkQ2lyY3VpdEVsZW1lbnROb2RlIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IHJheU5vZGVDb250YWluZXI6IE5vZGU7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlQ2lyY3VpdENvbnN0cnVjdGlvbktpdExpZ2h0QnVsYk5vZGU6ICgpID0+IHZvaWQ7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBzb2NrZXROb2RlOiBMaWdodEJ1bGJTb2NrZXROb2RlIHwgbnVsbDtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHNjcmVlblZpZXcgLSBtYWluIHNjcmVlbiB2aWV3LCBudWxsIGZvciBpY29uXHJcbiAgICogQHBhcmFtIGNpcmN1aXROb2RlLCBudWxsIGZvciBpY29uXHJcbiAgICogQHBhcmFtIGxpZ2h0QnVsYiAtIHRoZSBsaWdodCBidWxiIG1vZGVsXHJcbiAgICogQHBhcmFtIHNob3dSZXN1bHRzUHJvcGVydHkgLSB0cnVlIGlmIHRoZSBzaW0gY2FuIGRpc3BsYXkgdmFsdWVzXHJcbiAgICogQHBhcmFtIHZpZXdUeXBlUHJvcGVydHlcclxuICAgKiBAcGFyYW0gdGFuZGVtXHJcbiAgICogQHBhcmFtIFtwcm92aWRlZE9wdGlvbnNdXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBzY3JlZW5WaWV3OiBDQ0tDU2NyZWVuVmlldyB8IG51bGwsIGNpcmN1aXROb2RlOiBDaXJjdWl0Tm9kZSB8IG51bGwsIGxpZ2h0QnVsYjogTGlnaHRCdWxiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgc2hvd1Jlc3VsdHNQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj4sIHZpZXdUeXBlUHJvcGVydHk6IFByb3BlcnR5PENpcmN1aXRFbGVtZW50Vmlld1R5cGU+LCB0YW5kZW06IFRhbmRlbSwgcHJvdmlkZWRPcHRpb25zPzogRml4ZWRDaXJjdWl0RWxlbWVudE5vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IGZpbGxlZE9wdGlvbnMgPSBjb21iaW5lT3B0aW9uczxGaXhlZENpcmN1aXRFbGVtZW50Tm9kZU9wdGlvbnM+KCB7XHJcbiAgICAgIGlzSWNvbjogZmFsc2UsXHJcbiAgICAgIHVzZUhpdFRlc3RGb3JTZW5zb3JzOiB0cnVlXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCBicmlnaHRuZXNzUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIDAgKTtcclxuICAgIGNvbnN0IHVwZGF0ZUJyaWdodG5lc3MgPSBNdWx0aWxpbmsubXVsdGlsaW5rKFxyXG4gICAgICBbIGxpZ2h0QnVsYi5jdXJyZW50UHJvcGVydHksIHNob3dSZXN1bHRzUHJvcGVydHksIGxpZ2h0QnVsYi5yZXNpc3RhbmNlUHJvcGVydHkgXSxcclxuICAgICAgKCBjdXJyZW50LCBydW5uaW5nLCByZXNpc3RhbmNlICkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHBvd2VyID0gTWF0aC5hYnMoIGN1cnJlbnQgKiBjdXJyZW50ICogcmVzaXN0YW5jZSApO1xyXG5cclxuICAgICAgICBsZXQgYnJpZ2h0bmVzcyA9IHRvQnJpZ2h0bmVzcyggMC4zNSwgcG93ZXIgKTtcclxuXHJcbiAgICAgICAgLy8gV29ya2Fyb3VuZCBmb3IgU0NFTkVSWV9QSEVUL0xpZ2h0QnVsYk5vZGUgd2hpY2ggc2hvd3MgaGlnaGxpZ2h0IGV2ZW4gZm9yIGN1cnJlbnQgPSAxRS0xNiwgc28gY2xhbXAgaXQgb2ZmXHJcbiAgICAgICAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zY2VuZXJ5LXBoZXQvaXNzdWVzLzIyNVxyXG4gICAgICAgIGlmICggYnJpZ2h0bmVzcyA8IDFFLTYgKSB7XHJcbiAgICAgICAgICBicmlnaHRuZXNzID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGJyaWdodG5lc3NQcm9wZXJ0eS52YWx1ZSA9IFV0aWxzLmNsYW1wKCBicmlnaHRuZXNzLCAwLCAxICk7XHJcbiAgICAgIH0gKTtcclxuICAgIGxldCBsaWdodEJ1bGJOb2RlOiBDdXN0b21MaWdodEJ1bGJOb2RlIHwgSW1hZ2UgPSBuZXcgQ3VzdG9tTGlnaHRCdWxiTm9kZSggYnJpZ2h0bmVzc1Byb3BlcnR5LCB7XHJcbiAgICAgIGlzUmVhbDogbGlnaHRCdWxiLmlzUmVhbFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFRoZSBpc0ljb24gbXVzdCBzaG93IHRoZSBzb2NrZXQgYXMgd2VsbFxyXG4gICAgaWYgKCBmaWxsZWRPcHRpb25zLmlzSWNvbiApIHtcclxuICAgICAgbGlnaHRCdWxiTm9kZSA9IG5ldyBJbWFnZSggbGlnaHRCdWxiLmlzRXh0cmVtZSA/IGxpZ2h0QnVsYk1pZGRsZUhpZ2hfcG5nIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRCdWxiLmlzUmVhbCA/IGxpZ2h0QnVsYk1pZGRsZVJlYWxfcG5nIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlnaHRCdWxiTWlkZGxlX3BuZywgeyBzY2FsZTogMC4zNyB9ICk7XHJcblxyXG4gICAgICAvLyB0YWNrIG9uIHRoZSBzb2NrZXRcclxuICAgICAgaWYgKCBsaWdodEJ1bGIuaXNSZWFsICkge1xyXG4gICAgICAgIGxpZ2h0QnVsYk5vZGUuYWRkQ2hpbGQoIG5ldyBJbWFnZSggbGlnaHRCdWxiRnJvbnRSZWFsX3BuZyApICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBTY2hlbWF0aWMgY3JlYXRpb24gYmVnaW5zIGhlcmUuXHJcblxyXG4gICAgLy8gSW4gb3JkZXIgdG8gc3VwcG9ydCBwaGV0LWlvIGN1c3RvbWl6YXRpb24gYXQgYW4gYW5nbGUsIHdlIG11c3QgdXNlIHRoZSBub3JtYWxpemVkICh1cHJpZ2h0KSBwb3NpdGlvbnMuXHJcbiAgICBjb25zdCBub3JtYWxpemVkUG9pbnRzID0gTGlnaHRCdWxiLmNyZWF0ZVNhbXBsZVBvaW50cyggbGlnaHRCdWxiLnN0YXJ0UG9zaXRpb25Qcm9wZXJ0eS5nZXQoKSApO1xyXG4gICAgY29uc3Qgc3RhcnRQb3NpdGlvbiA9IG5vcm1hbGl6ZWRQb2ludHNbIDAgXTtcclxuICAgIGNvbnN0IGVuZFBvc2l0aW9uID0gbm9ybWFsaXplZFBvaW50c1sgMSBdO1xyXG5cclxuICAgIGNvbnN0IGRlbHRhID0gZW5kUG9zaXRpb24ubWludXMoIHN0YXJ0UG9zaXRpb24gKTtcclxuXHJcbiAgICBjb25zdCByaWdodExlYWRYID0gZGVsdGEueDtcclxuICAgIGNvbnN0IHNjaGVtYXRpY0NpcmNsZVJhZGl1cyA9IGRlbHRhLnggLyAyO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQWRkcyB0aGUgc2NoZW1hdGljIGNpcmNsZSB3aXRoIGZpbGFtZW50IHRvIHRoZSBnaXZlbiBTaGFwZS5cclxuICAgICAqIEBwYXJhbSBzaGFwZVxyXG4gICAgICogQHJldHVybnMgU2hhcGVcclxuICAgICAqL1xyXG4gICAgY29uc3QgYWRkSUVFRVNjaGVtYXRpY0NpcmNsZSA9ICggc2hhcGU6IFNoYXBlICkgPT4gc2hhcGVcclxuXHJcbiAgICAgIC8vIE91dGVyIGNpcmNsZVxyXG4gICAgICAubW92ZVRvKCAwLCBMRUFEX1kgKVxyXG4gICAgICAuYXJjKCByaWdodExlYWRYIC8gMiwgTEVBRF9ZLCBzY2hlbWF0aWNDaXJjbGVSYWRpdXMsIE1hdGguUEksIC1NYXRoLlBJLCB0cnVlIClcclxuXHJcbiAgICAgIC8vIEZpbGFtZW50XHJcbiAgICAgIC5tb3ZlVG8oIDAsIExFQURfWSApXHJcbiAgICAgIC5hcmMoIHNjaGVtYXRpY0NpcmNsZVJhZGl1cywgTEVBRF9ZLCBJTk5FUl9SQURJVVMsIE1hdGguUEksIDAsIGZhbHNlIClcclxuICAgICAgLmxpbmVUbyggcmlnaHRMZWFkWCwgTEVBRF9ZICk7XHJcblxyXG4gICAgY29uc3Qgc2NoZW1hdGljQ2lyY2xlRGlhbWV0ZXIgPSAyICogc2NoZW1hdGljQ2lyY2xlUmFkaXVzO1xyXG4gICAgY29uc3QgY29zUGk0ID0gTWF0aC5jb3MoIE1hdGguUEkgLyA0ICk7XHJcbiAgICBjb25zdCBzaW5QaTQgPSBNYXRoLnNpbiggTWF0aC5QSSAvIDQgKTtcclxuXHJcbiAgICBjb25zdCBhZGRJRUNTY2hlbWF0aWNDaXJjbGUgPSAoIHNoYXBlOiBTaGFwZSApID0+IHNoYXBlXHJcblxyXG4gICAgICAubW92ZVRvKCAwLCBMRUFEX1kgKVxyXG5cclxuICAgICAgLy8gdGhlIGNpcmNsZVxyXG4gICAgICAuYXJjKCByaWdodExlYWRYIC8gMiwgTEVBRF9ZLCBzY2hlbWF0aWNDaXJjbGVSYWRpdXMsIE1hdGguUEksIC1NYXRoLlBJLCB0cnVlIClcclxuXHJcbiAgICAgIC8vIGdvIHRvIGNpcmNsZSBjZW50ZXIgdG8gZHJhdyB0aGUgJ3gnICgyIGNyb3NzZWQgbGluZXMpIGluc2lkZSBpdC5cclxuICAgICAgLy8gQWRkaXRpb24gb2YgMC41IHNlZW1zIHRvIHZpc3VhbGx5IHdvcmsgYmV0dGVyIVxyXG4gICAgICAubW92ZVRvKCBzY2hlbWF0aWNDaXJjbGVSYWRpdXMgKyAwLjUsIExFQURfWSApXHJcblxyXG4gICAgICAvLyBhIGxpbmUgZnJvbSBjZW50ZXIgdG8gY2lyY3VtZmVyZW5jZVxyXG4gICAgICAubGluZVRvUmVsYXRpdmUoIHNjaGVtYXRpY0NpcmNsZVJhZGl1cyAqIGNvc1BpNCwgLXNjaGVtYXRpY0NpcmNsZVJhZGl1cyAqIHNpblBpNCApXHJcblxyXG4gICAgICAvLyBjb250aW51ZSB0aGUgbGluZSB0byB0aGUgb3RoZXIgc2lkZSBvZiB0aGUgY2lyY2xlXHJcbiAgICAgIC5saW5lVG9SZWxhdGl2ZSggLXNjaGVtYXRpY0NpcmNsZURpYW1ldGVyICogY29zUGk0LCBzY2hlbWF0aWNDaXJjbGVEaWFtZXRlciAqIHNpblBpNCApXHJcblxyXG4gICAgICAvLyByZXBlYXQgdG8gZHJhdyB0aGUgb3RoZXIgbGluZSBhdCA5MCBkZWdyZWVzIHRvIHRoZSBmaXJzdFxyXG4gICAgICAubW92ZVRvKCBzY2hlbWF0aWNDaXJjbGVSYWRpdXMsIExFQURfWSApXHJcbiAgICAgIC5saW5lVG9SZWxhdGl2ZSggLXNjaGVtYXRpY0NpcmNsZVJhZGl1cyAqIGNvc1BpNCwgLXNjaGVtYXRpY0NpcmNsZVJhZGl1cyAqIHNpblBpNCApXHJcbiAgICAgIC5saW5lVG9SZWxhdGl2ZSggc2NoZW1hdGljQ2lyY2xlRGlhbWV0ZXIgKiBjb3NQaTQsIHNjaGVtYXRpY0NpcmNsZURpYW1ldGVyICogc2luUGk0ICk7XHJcblxyXG4gICAgY29uc3QgYWRkTGVhZHMgPSAoIHNoYXBlOiBTaGFwZSApID0+IHNoYXBlXHJcblxyXG4gICAgICAvLyBMZWZ0IGxlYWRcclxuICAgICAgLm1vdmVUbyggMCwgMCApXHJcbiAgICAgIC5saW5lVG8oIDAsIExFQURfWSApXHJcblxyXG4gICAgICAvLyBSaWdodCBsZWFkXHJcbiAgICAgIC5tb3ZlVG8oIHJpZ2h0TGVhZFgsIExFQURfWSApXHJcbiAgICAgIC5saW5lVG8oIHJpZ2h0TGVhZFgsIGRlbHRhLnkgKTtcclxuICAgIGNvbnN0IGllZWVTaGFwZVdpdGhMZWFkcyA9IGFkZExlYWRzKCBhZGRJRUVFU2NoZW1hdGljQ2lyY2xlKCBuZXcgU2hhcGUoKSApICk7XHJcbiAgICBjb25zdCBpZWNTaGFwZVdpdGhMZWFkcyA9IGFkZExlYWRzKCBhZGRJRUNTY2hlbWF0aWNDaXJjbGUoIG5ldyBTaGFwZSgpICkgKTtcclxuXHJcbiAgICBjb25zdCBpZWVlU2hhcGVJY29uID0gYWRkSUVFRVNjaGVtYXRpY0NpcmNsZSggbmV3IFNoYXBlKCkgKS50cmFuc2Zvcm1lZCggTWF0cml4My5zY2FsaW5nKCAxLjc1ICkgKTtcclxuICAgIGNvbnN0IGllY1NoYXBlSWNvbiA9IGFkZElFQ1NjaGVtYXRpY0NpcmNsZSggbmV3IFNoYXBlKCkgKS50cmFuc2Zvcm1lZCggTWF0cml4My5zY2FsaW5nKCAxLjc1ICkgKTtcclxuXHJcbiAgICBjb25zdCBzY2hlbWF0aWNOb2RlID0gbmV3IFBhdGgoIGllZWVTaGFwZUljb24sIHtcclxuICAgICAgc3Ryb2tlOiBDb2xvci5CTEFDSyxcclxuICAgICAgbGluZVdpZHRoOiBmaWxsZWRPcHRpb25zLmlzSWNvbiA/IDQgOiBDQ0tDQ29uc3RhbnRzLlNDSEVNQVRJQ19MSU5FX1dJRFRIXHJcbiAgICB9ICk7XHJcblxyXG4gICAgaWYgKCBmaWxsZWRPcHRpb25zLmlzSWNvbiApIHtcclxuICAgICAgc2NoZW1hdGljTm9kZS5jZW50ZXIgPSBsaWdodEJ1bGJOb2RlLmNlbnRlci5wbHVzWFkoIDAsIDIyICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXBkYXRlU2NoZW1hdGljVHlwZSA9ICggc2NoZW1hdGljVHlwZTogU2NoZW1hdGljVHlwZSApID0+IHtcclxuICAgICAgaWYgKCBmaWxsZWRPcHRpb25zLmlzSWNvbiApIHtcclxuICAgICAgICBzY2hlbWF0aWNOb2RlLnNoYXBlID0gc2NoZW1hdGljVHlwZSA9PT0gU2NoZW1hdGljVHlwZS5JRUVFID8gaWVlZVNoYXBlSWNvbiA6IGllY1NoYXBlSWNvbjtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBzY2hlbWF0aWNOb2RlLnNoYXBlID0gc2NoZW1hdGljVHlwZSA9PT0gU2NoZW1hdGljVHlwZS5JRUVFID8gaWVlZVNoYXBlV2l0aExlYWRzIDogaWVjU2hhcGVXaXRoTGVhZHM7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBzY2hlbWF0aWNUeXBlUHJvcGVydHkubGluayggdXBkYXRlU2NoZW1hdGljVHlwZSApO1xyXG5cclxuICAgIC8vIEV4cGFuZCB0aGUgcG9pbnRlciBhcmVhcyB3aXRoIGEgZGVmZW5zaXZlIGNvcHksIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2lyY3VpdC1jb25zdHJ1Y3Rpb24ta2l0LWNvbW1vbi9pc3N1ZXMvMzEwXHJcbiAgICBpZiAoICFmaWxsZWRPcHRpb25zLmlzSWNvbiApIHtcclxuICAgICAgc2NoZW1hdGljTm9kZS5tb3VzZUFyZWEgPSBzY2hlbWF0aWNOb2RlLmJvdW5kcy5kaWxhdGVkKCAyICk7XHJcbiAgICAgIHNjaGVtYXRpY05vZGUudG91Y2hBcmVhID0gc2NoZW1hdGljTm9kZS5tb3VzZUFyZWE7XHJcbiAgICB9XHJcblxyXG4gICAgc3VwZXIoXHJcbiAgICAgIHNjcmVlblZpZXcsXHJcbiAgICAgIGNpcmN1aXROb2RlLFxyXG4gICAgICBsaWdodEJ1bGIsXHJcbiAgICAgIHZpZXdUeXBlUHJvcGVydHksXHJcbiAgICAgIGxpZ2h0QnVsYk5vZGUsXHJcbiAgICAgIHNjaGVtYXRpY05vZGUsXHJcbiAgICAgIHRhbmRlbSxcclxuICAgICAgZmlsbGVkT3B0aW9uc1xyXG4gICAgKTtcclxuXHJcbiAgICAvLyBub2RlIHRoYXQgY29udGFpbnMgdGhlIGxpZ2h0IHJheXMgc28gdGhleSBjYW4gYmUgZWFzaWx5IHBvc2l0aW9uZWRcclxuICAgIHRoaXMucmF5Tm9kZUNvbnRhaW5lciA9IG5ldyBOb2RlKCB7XHJcblxyXG4gICAgICAvLyBrZWVwIGNlbnRlcmluZyBhbmQgdHJhbnNsYXRpb25cclxuICAgICAgY2hpbGRyZW46IGxpZ2h0QnVsYk5vZGUgaW5zdGFuY2VvZiBDdXN0b21MaWdodEJ1bGJOb2RlID8gWyBsaWdodEJ1bGJOb2RlLnJheXNOb2RlISBdIDogW11cclxuICAgIH0gKTtcclxuXHJcbiAgICBsZXQgdmlld0xpc3RlbmVyOiAoICggdmlldzogQ2lyY3VpdEVsZW1lbnRWaWV3VHlwZSApID0+IHZvaWQgKSB8IG51bGwgPSBudWxsO1xyXG4gICAgaWYgKCBjaXJjdWl0Tm9kZSApIHtcclxuXHJcbiAgICAgIC8vIFJlbmRlciB0aGUgc29ja2V0IG5vZGUgaW4gdGhlIGZyb250XHJcbiAgICAgIHRoaXMuc29ja2V0Tm9kZSA9IG5ldyBMaWdodEJ1bGJTb2NrZXROb2RlKFxyXG4gICAgICAgIHNjcmVlblZpZXcsXHJcbiAgICAgICAgY2lyY3VpdE5vZGUsXHJcbiAgICAgICAgbGlnaHRCdWxiLFxyXG4gICAgICAgIHZpZXdUeXBlUHJvcGVydHksXHJcbiAgICAgICAgVGFuZGVtLk9QVF9PVVQsXHJcbiAgICAgICAgZmlsbGVkT3B0aW9uc1xyXG4gICAgICApO1xyXG4gICAgICB2aWV3TGlzdGVuZXIgPSAoIHZpZXc6IENpcmN1aXRFbGVtZW50Vmlld1R5cGUgKSA9PiB7XHJcbiAgICAgICAgdGhpcy5yYXlOb2RlQ29udGFpbmVyLnZpc2libGUgPSB2aWV3ID09PSBDaXJjdWl0RWxlbWVudFZpZXdUeXBlLkxJRkVMSUtFO1xyXG4gICAgICB9O1xyXG4gICAgICB2aWV3VHlwZVByb3BlcnR5LmxpbmsoIHZpZXdMaXN0ZW5lciApO1xyXG4gICAgICBjaXJjdWl0Tm9kZSAmJiAhbGlnaHRCdWxiLnBoZXRpb0lzQXJjaGV0eXBlICYmIGNpcmN1aXROb2RlLmxpZ2h0QnVsYlNvY2tldExheWVyLmFkZENoaWxkKCB0aGlzLnNvY2tldE5vZGUgKTtcclxuXHJcbiAgICAgIC8vIExpZ2h0IHJheXMgYXJlIHN1cHBvc2VkIHRvIGJlIGJlaGluZCBldmVyeXRoaW5nIGVsc2UsXHJcbiAgICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2lyY3VpdC1jb25zdHJ1Y3Rpb24ta2l0LWNvbW1vbi9pc3N1ZXMvMTYxXHJcbiAgICAgIGNpcmN1aXROb2RlICYmIGNpcmN1aXROb2RlLmFkZENoaWxkVG9CYWNrZ3JvdW5kKCB0aGlzLnJheU5vZGVDb250YWluZXIgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLnNvY2tldE5vZGUgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZGlzcG9zZUNpcmN1aXRDb25zdHJ1Y3Rpb25LaXRMaWdodEJ1bGJOb2RlID0gKCkgPT4ge1xyXG4gICAgICB1cGRhdGVCcmlnaHRuZXNzLmRpc3Bvc2UoKTtcclxuICAgICAgaWYgKCB0aGlzLnNvY2tldE5vZGUgKSB7XHJcbiAgICAgICAgdGhpcy5zb2NrZXROb2RlICYmIGNpcmN1aXROb2RlICYmIGNpcmN1aXROb2RlLmxpZ2h0QnVsYlNvY2tldExheWVyLnJlbW92ZUNoaWxkKCB0aGlzLnNvY2tldE5vZGUgKTtcclxuXHJcbiAgICAgICAgLy8gTGlnaHQgcmF5cyBhcmUgc3VwcG9zZWQgdG8gYmUgYmVoaW5kIGV2ZXJ5dGhpbmcgZWxzZSxcclxuICAgICAgICAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NpcmN1aXQtY29uc3RydWN0aW9uLWtpdC1jb21tb24vaXNzdWVzLzE2MVxyXG4gICAgICAgIGNpcmN1aXROb2RlICYmIGNpcmN1aXROb2RlLnJlbW92ZUNoaWxkRnJvbUJhY2tncm91bmQoIHRoaXMucmF5Tm9kZUNvbnRhaW5lciApO1xyXG4gICAgICAgIHZpZXdUeXBlUHJvcGVydHkudW5saW5rKCB2aWV3TGlzdGVuZXIhICk7XHJcbiAgICAgICAgdGhpcy5zb2NrZXROb2RlLmRpc3Bvc2UoKTtcclxuICAgICAgICBzY2hlbWF0aWNUeXBlUHJvcGVydHkudW5saW5rKCB1cGRhdGVTY2hlbWF0aWNUeXBlICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdzb2NrZXROb2RlIHNob3VsZCBiZSBkZWZpbmVkJyApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTXVsdGlwbGUgdXBkYXRlcyBtYXkgaGFwcGVuIHBlciBmcmFtZSwgdGhleSBhcmUgYmF0Y2hlZCBhbmQgdXBkYXRlZCBvbmNlIGluIHRoZSB2aWV3IHN0ZXAgdG8gaW1wcm92ZSBwZXJmb3JtYW5jZS5cclxuICAgKiBDQ0tDTGlnaHRCdWxiTm9kZSBjYWxscyB1cGRhdGVSZW5kZXIgZm9yIGl0cyBjaGlsZCBzb2NrZXQgbm9kZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSB1cGRhdGVSZW5kZXIoKTogdm9pZCB7XHJcbiAgICBjb25zdCBzdGFydFBvc2l0aW9uID0gdGhpcy5jaXJjdWl0RWxlbWVudC5zdGFydFBvc2l0aW9uUHJvcGVydHkuZ2V0KCk7XHJcbiAgICBjb25zdCBlbmRQb3NpdGlvbiA9IHRoaXMuY2lyY3VpdEVsZW1lbnQuZW5kUG9zaXRpb25Qcm9wZXJ0eS5nZXQoKTtcclxuICAgIGNvbnN0IGFuZ2xlID0gVmVjdG9yMi5nZXRBbmdsZUJldHdlZW5WZWN0b3JzKCBzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbiApICsgTWF0aC5QSSAvIDQ7XHJcblxyXG4gICAgLy8gVXBkYXRlIHRoZSBub2RlIHRyYW5zZm9ybSBpbiBhIHNpbmdsZSBzdGVwLCBzZWUgIzY2XHJcbiAgICBTQ1JBVENIX01BVFJJWC5zZXRUb1RyYW5zbGF0aW9uUm90YXRpb25Qb2ludCggc3RhcnRQb3NpdGlvbiwgYW5nbGUgKTtcclxuICAgIHRoaXMuY29udGVudE5vZGUuc2V0TWF0cml4KCBTQ1JBVENIX01BVFJJWCApO1xyXG4gICAgdGhpcy5yYXlOb2RlQ29udGFpbmVyLnNldE1hdHJpeCggU0NSQVRDSF9NQVRSSVggKTtcclxuICAgIHRoaXMuaGlnaGxpZ2h0Tm9kZSAmJiB0aGlzLmhpZ2hsaWdodE5vZGUuc2V0TWF0cml4KCBTQ1JBVENIX01BVFJJWCApO1xyXG5cclxuICAgIHRoaXMuc29ja2V0Tm9kZSAmJiB0aGlzLnNvY2tldE5vZGUudXBkYXRlUmVuZGVyKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEaXNwb3NlIHdoZW4gbm8gbG9uZ2VyIHVzZWQuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VDaXJjdWl0Q29uc3RydWN0aW9uS2l0TGlnaHRCdWxiTm9kZSgpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFpbnRhaW4gdGhlIG9wYWNpdHkgb2YgdGhlIGJyaWdodG5lc3MgbGluZXMgd2hpbGUgY2hhbmdpbmcgdGhlIG9wYWNpdHkgb2YgdGhlIGxpZ2h0IGJ1bGIgaXRzZWxmLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSB1cGRhdGVPcGFjaXR5T25JbnRlcmFjdGl2ZUNoYW5nZSgpOiB2b2lkIHtcclxuXHJcbiAgICAvLyBUT0RPIChibGFjay1ib3gtc3R1ZHkpOiBNYWtlIHRoZSBsaWdodCBidWxiIGltYWdlcyBsb29rIGZhZGVkIG91dC5cclxuICB9XHJcbn1cclxuXHJcbmNpcmN1aXRDb25zdHJ1Y3Rpb25LaXRDb21tb24ucmVnaXN0ZXIoICdDQ0tDTGlnaHRCdWxiTm9kZScsIENDS0NMaWdodEJ1bGJOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsY0FBYyxNQUFNLG9DQUFvQztBQUUvRCxPQUFPQyxPQUFPLE1BQU0sNEJBQTRCO0FBQ2hELE9BQU9DLEtBQUssTUFBTSwwQkFBMEI7QUFDNUMsT0FBT0MsT0FBTyxNQUFNLDRCQUE0QjtBQUNoRCxTQUFTQyxLQUFLLFFBQVEsNkJBQTZCO0FBQ25ELFNBQVNDLEtBQUssRUFBRUMsS0FBSyxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBUSxnQ0FBZ0M7QUFDekUsT0FBT0MsdUJBQXVCLE1BQU0sMENBQTBDO0FBQzlFLE9BQU9DLHVCQUF1QixNQUFNLDBDQUEwQztBQUM5RSxP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