// Copyright 2019-2023, University of Colorado Boulder

/**
 * This node shows a fuse.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Matrix3 from '../../../dot/js/Matrix3.js';
import Utils from '../../../dot/js/Utils.js';
import Vector2 from '../../../dot/js/Vector2.js';
import { Shape } from '../../../kite/js/imports.js';
import { Color, Image, Node, Path, Rectangle } from '../../../scenery/js/imports.js';
import fuse_png from '../../images/fuse_png.js';
import CCKCConstants from '../CCKCConstants.js';
import circuitConstructionKitCommon from '../circuitConstructionKitCommon.js';
import FixedCircuitElementNode from './FixedCircuitElementNode.js';
import FuseTripAnimation from './FuseTripAnimation.js';
import schematicTypeProperty from './schematicTypeProperty.js';
import SchematicType from './SchematicType.js';
import optionize from '../../../phet-core/js/optionize.js';

// constants
const SCHEMATIC_STEM_WIDTH = 20;
const HORIZONTAL_ZIG_ZAG_DISTANCE = 5;
const VERTICAL_ZIG_ZAG_HEIGHT = 4;
const CAP_WIDTH = 15; // horizontal size of each cap in the image
const SPLIT_DY = 13; // in view coordinates, amplitude of the zig-zag pattern when the fuse is tripped
const SPLIT_DX = 8; // in view coordinates, half the distance of the split part of the fuse when tripped
const VERTICAL_GLASS_MARGIN = 3;
const DEFAULT_GLASS_FILL = '#c3dbfd';
export default class FuseNode extends FixedCircuitElementNode {
  // Identifies the images used to render this node so they can be prepopulated in the WebGL sprite sheet.
  static webglSpriteNodes = [new Image(fuse_png)];

  /**
   * @param screenView - main screen view, null for isIcon
   * @param circuitNode, null for isIcon
   * @param fuse
   * @param viewTypeProperty
   * @param tandem
   * @param [providedOptions]
   */
  constructor(screenView, circuitNode, fuse, viewTypeProperty, tandem, providedOptions) {
    const options = optionize()({
      isIcon: false,
      useHitTestForSensors: true
    }, providedOptions);
    const fuseImageNode = new Image(fuse_png, {
      scale: 0.691
    });
    const numberOfZigZags = (fuseImageNode.width - CAP_WIDTH * 2) / HORIZONTAL_ZIG_ZAG_DISTANCE / 2;

    // zig-zag shape
    const startPoint = new Vector2(CAP_WIDTH, 0);
    const endPoint = new Vector2(fuseImageNode.width - CAP_WIDTH, 0);
    const filamentShape = new Shape().moveToPoint(startPoint).zigZagToPoint(endPoint, VERTICAL_ZIG_ZAG_HEIGHT, Utils.roundSymmetric(numberOfZigZags), false);
    const brokenFilamentShape = new Shape().moveToPoint(startPoint).zigZagToPoint(new Vector2(fuseImageNode.width / 2 - SPLIT_DX, SPLIT_DY), VERTICAL_ZIG_ZAG_HEIGHT, Utils.roundSymmetric(numberOfZigZags / 2) - 1, false);
    brokenFilamentShape.moveToPoint(endPoint);
    brokenFilamentShape.zigZagToPoint(new Vector2(fuseImageNode.width / 2 + SPLIT_DX, -SPLIT_DY), VERTICAL_ZIG_ZAG_HEIGHT, Utils.roundSymmetric(numberOfZigZags / 2) - 1, false);
    const filamentPath = new Path(filamentShape, {
      stroke: '#302b2b',
      lineWidth: 4,
      center: fuseImageNode.center
    });

    // Fuse filament thickness is proportional to its current rating
    const updateFilamentPathLineWidth = currentRating => filamentPath.setLineWidth(Utils.linear(fuse.currentRatingProperty.range.min, fuse.currentRatingProperty.range.max, 1, 4, currentRating));
    fuse.currentRatingProperty.link(updateFilamentPathLineWidth);

    // Glass covering
    const glassNode = new Rectangle(CAP_WIDTH, VERTICAL_GLASS_MARGIN, fuseImageNode.width - CAP_WIDTH * 2, fuseImageNode.height - VERTICAL_GLASS_MARGIN * 2, {
      fill: DEFAULT_GLASS_FILL,
      opacity: 0.5,
      stroke: 'black',
      lineWidth: 0.5
    });
    const lifelikeFuseNode = new Node({
      children: [filamentPath, glassNode, fuseImageNode]
    });

    // Schematic view is a line with a box around it, looks the same whether tripped or untripped.
    const boxHeight = 30;
    const boxWidth = fuse.chargePathLength - SCHEMATIC_STEM_WIDTH * 2;
    let schematicShape = new Shape().moveTo(0, 0).lineToRelative(fuse.chargePathLength, 0).moveTo(0, 0).rect(SCHEMATIC_STEM_WIDTH, -boxHeight / 2, boxWidth, boxHeight);

    // Icons should appear the same in the toolbox, see
    // https://github.com/phetsims/circuit-construction-kit-common/issues/389
    const width = options.isIcon ? CCKCConstants.RESISTOR_LENGTH : fuse.distanceBetweenVertices;
    lifelikeFuseNode.mutate({
      scale: width / lifelikeFuseNode.width
    });
    const scale = lifelikeFuseNode.width / schematicShape.bounds.width;
    schematicShape = schematicShape.transformed(Matrix3.scale(scale, scale));
    const schematicNode = new Path(schematicShape, {
      stroke: Color.BLACK,
      lineWidth: CCKCConstants.SCHEMATIC_LINE_WIDTH
    });

    ///// IEC fuse: also a box with two horizontal leads (left and right) and two small vertical lines on the inside
    // (see https://github.com/phetsims/circuit-construction-kit-common/issues/429 for a figure)

    const boxLength7th = boxWidth / 7;
    const fuseIEC = new Shape().moveTo(0, schematicShape.bounds.centerY)

    // left horizontal lead
    .lineToRelative(SCHEMATIC_STEM_WIDTH, 0)

    // upper half of the box
    .lineToRelative(0, -boxHeight / 2).lineToRelative(boxWidth, 0).lineToRelative(0, boxHeight / 2)

    // right horizontal lead
    .lineToRelative(SCHEMATIC_STEM_WIDTH, 0)

    // go back along the right horizontal lead
    .lineToRelative(-SCHEMATIC_STEM_WIDTH, 0)

    // lower half og the box
    .lineToRelative(0, boxHeight / 2).lineToRelative(-boxWidth, 0)

    // small left vertical line. Place it at x = boxLength / 7 (seems to be visually a good place)
    .lineToRelative(0, -boxHeight).lineToRelative(boxLength7th, 0).lineToRelative(0, boxHeight)

    /* small right vertical line: the 1st 'lineToRelative' below takes to starting point, at the cost
    of drawing a line on an already existing one. */.lineToRelative(boxWidth - 2 * boxLength7th, 0).lineToRelative(0, -boxHeight);
    const updateSchematicType = schematicType => {
      schematicNode.shape = schematicType === SchematicType.IEEE || schematicType === SchematicType.BRITISH ? schematicShape : fuseIEC;
    };
    schematicTypeProperty.link(updateSchematicType);

    // Center vertically to match the FixedCircuitElementNode assumption that origin is center left
    schematicNode.centerY = 0;
    lifelikeFuseNode.centerY = 0;

    // Expand the pointer areas with a defensive copy, see
    // https://github.com/phetsims/circuit-construction-kit-common/issues/310
    schematicNode.mouseArea = schematicNode.bounds.copy();
    schematicNode.touchArea = schematicNode.bounds.copy();
    super(screenView, circuitNode, fuse, viewTypeProperty, lifelikeFuseNode, schematicNode, tandem, options);
    this.fuse = fuse;

    // Update the look when the fuse is tripped
    const updateTripped = isTripped => {
      if (isTripped && !phet.joist.sim.isSettingPhetioStateProperty.value) {
        circuitNode.addChild(new FuseTripAnimation({
          center: this.center
        }));
      }
      glassNode.fill = isTripped ? '#4e4e4e' : DEFAULT_GLASS_FILL;
      filamentPath.shape = isTripped ? brokenFilamentShape : filamentShape;
    };
    if (!options.isIcon) {
      this.fuse.isTrippedProperty.link(updateTripped);
    }
    this.disposeFuseNode = () => {
      lifelikeFuseNode.dispose();
      fuse.currentRatingProperty.unlink(updateFilamentPathLineWidth);
      if (!options.isIcon) {
        this.fuse.isTrippedProperty.unlink(updateTripped);
      }
      schematicTypeProperty.unlink(updateSchematicType);
    };
  }
  dispose() {
    this.disposeFuseNode();
    super.dispose();
  }
}
circuitConstructionKitCommon.register('FuseNode', FuseNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNYXRyaXgzIiwiVXRpbHMiLCJWZWN0b3IyIiwiU2hhcGUiLCJDb2xvciIsIkltYWdlIiwiTm9kZSIsIlBhdGgiLCJSZWN0YW5nbGUiLCJmdXNlX3BuZyIsIkNDS0NDb25zdGFudHMiLCJjaXJjdWl0Q29uc3RydWN0aW9uS2l0Q29tbW9uIiwiRml4ZWRDaXJjdWl0RWxlbWVudE5vZGUiLCJGdXNlVHJpcEFuaW1hdGlvbiIsInNjaGVtYXRpY1R5cGVQcm9wZXJ0eSIsIlNjaGVtYXRpY1R5cGUiLCJvcHRpb25pemUiLCJTQ0hFTUFUSUNfU1RFTV9XSURUSCIsIkhPUklaT05UQUxfWklHX1pBR19ESVNUQU5DRSIsIlZFUlRJQ0FMX1pJR19aQUdfSEVJR0hUIiwiQ0FQX1dJRFRIIiwiU1BMSVRfRFkiLCJTUExJVF9EWCIsIlZFUlRJQ0FMX0dMQVNTX01BUkdJTiIsIkRFRkFVTFRfR0xBU1NfRklMTCIsIkZ1c2VOb2RlIiwid2ViZ2xTcHJpdGVOb2RlcyIsImNvbnN0cnVjdG9yIiwic2NyZWVuVmlldyIsImNpcmN1aXROb2RlIiwiZnVzZSIsInZpZXdUeXBlUHJvcGVydHkiLCJ0YW5kZW0iLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiaXNJY29uIiwidXNlSGl0VGVzdEZvclNlbnNvcnMiLCJmdXNlSW1hZ2VOb2RlIiwic2NhbGUiLCJudW1iZXJPZlppZ1phZ3MiLCJ3aWR0aCIsInN0YXJ0UG9pbnQiLCJlbmRQb2ludCIsImZpbGFtZW50U2hhcGUiLCJtb3ZlVG9Qb2ludCIsInppZ1phZ1RvUG9pbnQiLCJyb3VuZFN5bW1ldHJpYyIsImJyb2tlbkZpbGFtZW50U2hhcGUiLCJmaWxhbWVudFBhdGgiLCJzdHJva2UiLCJsaW5lV2lkdGgiLCJjZW50ZXIiLCJ1cGRhdGVGaWxhbWVudFBhdGhMaW5lV2lkdGgiLCJjdXJyZW50UmF0aW5nIiwic2V0TGluZVdpZHRoIiwibGluZWFyIiwiY3VycmVudFJhdGluZ1Byb3BlcnR5IiwicmFuZ2UiLCJtaW4iLCJtYXgiLCJsaW5rIiwiZ2xhc3NOb2RlIiwiaGVpZ2h0IiwiZmlsbCIsIm9wYWNpdHkiLCJsaWZlbGlrZUZ1c2VOb2RlIiwiY2hpbGRyZW4iLCJib3hIZWlnaHQiLCJib3hXaWR0aCIsImNoYXJnZVBhdGhMZW5ndGgiLCJzY2hlbWF0aWNTaGFwZSIsIm1vdmVUbyIsImxpbmVUb1JlbGF0aXZlIiwicmVjdCIsIlJFU0lTVE9SX0xFTkdUSCIsImRpc3RhbmNlQmV0d2VlblZlcnRpY2VzIiwibXV0YXRlIiwiYm91bmRzIiwidHJhbnNmb3JtZWQiLCJzY2hlbWF0aWNOb2RlIiwiQkxBQ0siLCJTQ0hFTUFUSUNfTElORV9XSURUSCIsImJveExlbmd0aDd0aCIsImZ1c2VJRUMiLCJjZW50ZXJZIiwidXBkYXRlU2NoZW1hdGljVHlwZSIsInNjaGVtYXRpY1R5cGUiLCJzaGFwZSIsIklFRUUiLCJCUklUSVNIIiwibW91c2VBcmVhIiwiY29weSIsInRvdWNoQXJlYSIsInVwZGF0ZVRyaXBwZWQiLCJpc1RyaXBwZWQiLCJwaGV0Iiwiam9pc3QiLCJzaW0iLCJpc1NldHRpbmdQaGV0aW9TdGF0ZVByb3BlcnR5IiwidmFsdWUiLCJhZGRDaGlsZCIsImlzVHJpcHBlZFByb3BlcnR5IiwiZGlzcG9zZUZ1c2VOb2RlIiwiZGlzcG9zZSIsInVubGluayIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRnVzZU5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhpcyBub2RlIHNob3dzIGEgZnVzZS5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBNYXRyaXgzIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9NYXRyaXgzLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgeyBDb2xvciwgSW1hZ2UsIE5vZGUsIFBhdGgsIFJlY3RhbmdsZSB9IGZyb20gJy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBmdXNlX3BuZyBmcm9tICcuLi8uLi9pbWFnZXMvZnVzZV9wbmcuanMnO1xyXG5pbXBvcnQgQ0NLQ0NvbnN0YW50cyBmcm9tICcuLi9DQ0tDQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IGNpcmN1aXRDb25zdHJ1Y3Rpb25LaXRDb21tb24gZnJvbSAnLi4vY2lyY3VpdENvbnN0cnVjdGlvbktpdENvbW1vbi5qcyc7XHJcbmltcG9ydCBDaXJjdWl0RWxlbWVudFZpZXdUeXBlIGZyb20gJy4uL21vZGVsL0NpcmN1aXRFbGVtZW50Vmlld1R5cGUuanMnO1xyXG5pbXBvcnQgRnVzZSBmcm9tICcuLi9tb2RlbC9GdXNlLmpzJztcclxuaW1wb3J0IENDS0NTY3JlZW5WaWV3IGZyb20gJy4vQ0NLQ1NjcmVlblZpZXcuanMnO1xyXG5pbXBvcnQgQ2lyY3VpdE5vZGUgZnJvbSAnLi9DaXJjdWl0Tm9kZS5qcyc7XHJcbmltcG9ydCBGaXhlZENpcmN1aXRFbGVtZW50Tm9kZSwgeyBGaXhlZENpcmN1aXRFbGVtZW50Tm9kZU9wdGlvbnMgfSBmcm9tICcuL0ZpeGVkQ2lyY3VpdEVsZW1lbnROb2RlLmpzJztcclxuaW1wb3J0IEZ1c2VUcmlwQW5pbWF0aW9uIGZyb20gJy4vRnVzZVRyaXBBbmltYXRpb24uanMnO1xyXG5pbXBvcnQgc2NoZW1hdGljVHlwZVByb3BlcnR5IGZyb20gJy4vc2NoZW1hdGljVHlwZVByb3BlcnR5LmpzJztcclxuaW1wb3J0IFNjaGVtYXRpY1R5cGUgZnJvbSAnLi9TY2hlbWF0aWNUeXBlLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgU0NIRU1BVElDX1NURU1fV0lEVEggPSAyMDtcclxuY29uc3QgSE9SSVpPTlRBTF9aSUdfWkFHX0RJU1RBTkNFID0gNTtcclxuY29uc3QgVkVSVElDQUxfWklHX1pBR19IRUlHSFQgPSA0O1xyXG5jb25zdCBDQVBfV0lEVEggPSAxNTsgLy8gaG9yaXpvbnRhbCBzaXplIG9mIGVhY2ggY2FwIGluIHRoZSBpbWFnZVxyXG5jb25zdCBTUExJVF9EWSA9IDEzOyAvLyBpbiB2aWV3IGNvb3JkaW5hdGVzLCBhbXBsaXR1ZGUgb2YgdGhlIHppZy16YWcgcGF0dGVybiB3aGVuIHRoZSBmdXNlIGlzIHRyaXBwZWRcclxuY29uc3QgU1BMSVRfRFggPSA4OyAvLyBpbiB2aWV3IGNvb3JkaW5hdGVzLCBoYWxmIHRoZSBkaXN0YW5jZSBvZiB0aGUgc3BsaXQgcGFydCBvZiB0aGUgZnVzZSB3aGVuIHRyaXBwZWRcclxuY29uc3QgVkVSVElDQUxfR0xBU1NfTUFSR0lOID0gMztcclxuY29uc3QgREVGQVVMVF9HTEFTU19GSUxMID0gJyNjM2RiZmQnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IEVtcHR5U2VsZk9wdGlvbnM7XHJcbnR5cGUgRnVzZU5vZGVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBGaXhlZENpcmN1aXRFbGVtZW50Tm9kZU9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGdXNlTm9kZSBleHRlbmRzIEZpeGVkQ2lyY3VpdEVsZW1lbnROb2RlIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IGZ1c2U6IEZ1c2U7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlRnVzZU5vZGU6ICgpID0+IHZvaWQ7XHJcblxyXG4gIC8vIElkZW50aWZpZXMgdGhlIGltYWdlcyB1c2VkIHRvIHJlbmRlciB0aGlzIG5vZGUgc28gdGhleSBjYW4gYmUgcHJlcG9wdWxhdGVkIGluIHRoZSBXZWJHTCBzcHJpdGUgc2hlZXQuXHJcbiAgcHVibGljIHN0YXRpYyBvdmVycmlkZSByZWFkb25seSB3ZWJnbFNwcml0ZU5vZGVzID0gW1xyXG4gICAgbmV3IEltYWdlKCBmdXNlX3BuZyApXHJcbiAgXTtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHNjcmVlblZpZXcgLSBtYWluIHNjcmVlbiB2aWV3LCBudWxsIGZvciBpc0ljb25cclxuICAgKiBAcGFyYW0gY2lyY3VpdE5vZGUsIG51bGwgZm9yIGlzSWNvblxyXG4gICAqIEBwYXJhbSBmdXNlXHJcbiAgICogQHBhcmFtIHZpZXdUeXBlUHJvcGVydHlcclxuICAgKiBAcGFyYW0gdGFuZGVtXHJcbiAgICogQHBhcmFtIFtwcm92aWRlZE9wdGlvbnNdXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBzY3JlZW5WaWV3OiBDQ0tDU2NyZWVuVmlldyB8IG51bGwsIGNpcmN1aXROb2RlOiBDaXJjdWl0Tm9kZSB8IG51bGwsIGZ1c2U6IEZ1c2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICB2aWV3VHlwZVByb3BlcnR5OiBQcm9wZXJ0eTxDaXJjdWl0RWxlbWVudFZpZXdUeXBlPiwgdGFuZGVtOiBUYW5kZW0sIHByb3ZpZGVkT3B0aW9ucz86IEZ1c2VOb2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPEZ1c2VOb2RlT3B0aW9ucywgU2VsZk9wdGlvbnMsIEZpeGVkQ2lyY3VpdEVsZW1lbnROb2RlT3B0aW9ucz4oKSgge1xyXG4gICAgICBpc0ljb246IGZhbHNlLFxyXG4gICAgICB1c2VIaXRUZXN0Rm9yU2Vuc29yczogdHJ1ZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgZnVzZUltYWdlTm9kZSA9IG5ldyBJbWFnZSggZnVzZV9wbmcsIHsgc2NhbGU6IDAuNjkxIH0gKTtcclxuICAgIGNvbnN0IG51bWJlck9mWmlnWmFncyA9ICggZnVzZUltYWdlTm9kZS53aWR0aCAtIENBUF9XSURUSCAqIDIgKSAvIEhPUklaT05UQUxfWklHX1pBR19ESVNUQU5DRSAvIDI7XHJcblxyXG4gICAgLy8gemlnLXphZyBzaGFwZVxyXG4gICAgY29uc3Qgc3RhcnRQb2ludCA9IG5ldyBWZWN0b3IyKCBDQVBfV0lEVEgsIDAgKTtcclxuICAgIGNvbnN0IGVuZFBvaW50ID0gbmV3IFZlY3RvcjIoIGZ1c2VJbWFnZU5vZGUud2lkdGggLSBDQVBfV0lEVEgsIDAgKTtcclxuICAgIGNvbnN0IGZpbGFtZW50U2hhcGUgPSBuZXcgU2hhcGUoKS5tb3ZlVG9Qb2ludCggc3RhcnRQb2ludCApXHJcbiAgICAgIC56aWdaYWdUb1BvaW50KCBlbmRQb2ludCwgVkVSVElDQUxfWklHX1pBR19IRUlHSFQsIFV0aWxzLnJvdW5kU3ltbWV0cmljKCBudW1iZXJPZlppZ1phZ3MgKSwgZmFsc2UgKTtcclxuXHJcbiAgICBjb25zdCBicm9rZW5GaWxhbWVudFNoYXBlID0gbmV3IFNoYXBlKCkubW92ZVRvUG9pbnQoIHN0YXJ0UG9pbnQgKVxyXG4gICAgICAuemlnWmFnVG9Qb2ludCggbmV3IFZlY3RvcjIoIGZ1c2VJbWFnZU5vZGUud2lkdGggLyAyIC0gU1BMSVRfRFgsIFNQTElUX0RZICksIFZFUlRJQ0FMX1pJR19aQUdfSEVJR0hULCBVdGlscy5yb3VuZFN5bW1ldHJpYyggbnVtYmVyT2ZaaWdaYWdzIC8gMiApIC0gMSwgZmFsc2UgKTtcclxuICAgIGJyb2tlbkZpbGFtZW50U2hhcGUubW92ZVRvUG9pbnQoIGVuZFBvaW50ICk7XHJcbiAgICBicm9rZW5GaWxhbWVudFNoYXBlXHJcbiAgICAgIC56aWdaYWdUb1BvaW50KCBuZXcgVmVjdG9yMiggZnVzZUltYWdlTm9kZS53aWR0aCAvIDIgKyBTUExJVF9EWCwgLVNQTElUX0RZICksIFZFUlRJQ0FMX1pJR19aQUdfSEVJR0hULCBVdGlscy5yb3VuZFN5bW1ldHJpYyggbnVtYmVyT2ZaaWdaYWdzIC8gMiApIC0gMSwgZmFsc2UgKTtcclxuXHJcbiAgICBjb25zdCBmaWxhbWVudFBhdGggPSBuZXcgUGF0aCggZmlsYW1lbnRTaGFwZSwge1xyXG4gICAgICBzdHJva2U6ICcjMzAyYjJiJyxcclxuICAgICAgbGluZVdpZHRoOiA0LFxyXG4gICAgICBjZW50ZXI6IGZ1c2VJbWFnZU5vZGUuY2VudGVyXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gRnVzZSBmaWxhbWVudCB0aGlja25lc3MgaXMgcHJvcG9ydGlvbmFsIHRvIGl0cyBjdXJyZW50IHJhdGluZ1xyXG4gICAgY29uc3QgdXBkYXRlRmlsYW1lbnRQYXRoTGluZVdpZHRoID0gKCBjdXJyZW50UmF0aW5nOiBudW1iZXIgKSA9PiBmaWxhbWVudFBhdGguc2V0TGluZVdpZHRoKCBVdGlscy5saW5lYXIoXHJcbiAgICAgIGZ1c2UuY3VycmVudFJhdGluZ1Byb3BlcnR5LnJhbmdlLm1pbiwgZnVzZS5jdXJyZW50UmF0aW5nUHJvcGVydHkucmFuZ2UubWF4LCAxLCA0LCBjdXJyZW50UmF0aW5nXHJcbiAgICApICk7XHJcbiAgICBmdXNlLmN1cnJlbnRSYXRpbmdQcm9wZXJ0eS5saW5rKCB1cGRhdGVGaWxhbWVudFBhdGhMaW5lV2lkdGggKTtcclxuXHJcbiAgICAvLyBHbGFzcyBjb3ZlcmluZ1xyXG4gICAgY29uc3QgZ2xhc3NOb2RlID0gbmV3IFJlY3RhbmdsZSggQ0FQX1dJRFRILCBWRVJUSUNBTF9HTEFTU19NQVJHSU4sIGZ1c2VJbWFnZU5vZGUud2lkdGggLSBDQVBfV0lEVEggKiAyLCBmdXNlSW1hZ2VOb2RlLmhlaWdodCAtIFZFUlRJQ0FMX0dMQVNTX01BUkdJTiAqIDIsIHtcclxuICAgICAgZmlsbDogREVGQVVMVF9HTEFTU19GSUxMLFxyXG4gICAgICBvcGFjaXR5OiAwLjUsXHJcbiAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgbGluZVdpZHRoOiAwLjVcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBsaWZlbGlrZUZ1c2VOb2RlID0gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFsgZmlsYW1lbnRQYXRoLCBnbGFzc05vZGUsIGZ1c2VJbWFnZU5vZGUgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFNjaGVtYXRpYyB2aWV3IGlzIGEgbGluZSB3aXRoIGEgYm94IGFyb3VuZCBpdCwgbG9va3MgdGhlIHNhbWUgd2hldGhlciB0cmlwcGVkIG9yIHVudHJpcHBlZC5cclxuICAgIGNvbnN0IGJveEhlaWdodCA9IDMwO1xyXG4gICAgY29uc3QgYm94V2lkdGggPSBmdXNlLmNoYXJnZVBhdGhMZW5ndGggLSBTQ0hFTUFUSUNfU1RFTV9XSURUSCAqIDI7XHJcbiAgICBsZXQgc2NoZW1hdGljU2hhcGUgPSBuZXcgU2hhcGUoKVxyXG4gICAgICAubW92ZVRvKCAwLCAwIClcclxuICAgICAgLmxpbmVUb1JlbGF0aXZlKCBmdXNlLmNoYXJnZVBhdGhMZW5ndGgsIDAgKVxyXG4gICAgICAubW92ZVRvKCAwLCAwIClcclxuICAgICAgLnJlY3QoIFNDSEVNQVRJQ19TVEVNX1dJRFRILCAtYm94SGVpZ2h0IC8gMiwgYm94V2lkdGgsIGJveEhlaWdodCApO1xyXG5cclxuICAgIC8vIEljb25zIHNob3VsZCBhcHBlYXIgdGhlIHNhbWUgaW4gdGhlIHRvb2xib3gsIHNlZVxyXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NpcmN1aXQtY29uc3RydWN0aW9uLWtpdC1jb21tb24vaXNzdWVzLzM4OVxyXG4gICAgY29uc3Qgd2lkdGggPSBvcHRpb25zLmlzSWNvbiA/IENDS0NDb25zdGFudHMuUkVTSVNUT1JfTEVOR1RIIDogZnVzZS5kaXN0YW5jZUJldHdlZW5WZXJ0aWNlcztcclxuICAgIGxpZmVsaWtlRnVzZU5vZGUubXV0YXRlKCB7IHNjYWxlOiB3aWR0aCAvIGxpZmVsaWtlRnVzZU5vZGUud2lkdGggfSApO1xyXG5cclxuICAgIGNvbnN0IHNjYWxlID0gbGlmZWxpa2VGdXNlTm9kZS53aWR0aCAvIHNjaGVtYXRpY1NoYXBlLmJvdW5kcy53aWR0aDtcclxuICAgIHNjaGVtYXRpY1NoYXBlID0gc2NoZW1hdGljU2hhcGUudHJhbnNmb3JtZWQoIE1hdHJpeDMuc2NhbGUoIHNjYWxlLCBzY2FsZSApICk7XHJcbiAgICBjb25zdCBzY2hlbWF0aWNOb2RlID0gbmV3IFBhdGgoIHNjaGVtYXRpY1NoYXBlLCB7XHJcbiAgICAgIHN0cm9rZTogQ29sb3IuQkxBQ0ssXHJcbiAgICAgIGxpbmVXaWR0aDogQ0NLQ0NvbnN0YW50cy5TQ0hFTUFUSUNfTElORV9XSURUSFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vLy8vIElFQyBmdXNlOiBhbHNvIGEgYm94IHdpdGggdHdvIGhvcml6b250YWwgbGVhZHMgKGxlZnQgYW5kIHJpZ2h0KSBhbmQgdHdvIHNtYWxsIHZlcnRpY2FsIGxpbmVzIG9uIHRoZSBpbnNpZGVcclxuICAgIC8vIChzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NpcmN1aXQtY29uc3RydWN0aW9uLWtpdC1jb21tb24vaXNzdWVzLzQyOSBmb3IgYSBmaWd1cmUpXHJcblxyXG4gICAgY29uc3QgYm94TGVuZ3RoN3RoID0gYm94V2lkdGggLyA3O1xyXG4gICAgY29uc3QgZnVzZUlFQyA9IG5ldyBTaGFwZSgpXHJcbiAgICAgIC5tb3ZlVG8oIDAsIHNjaGVtYXRpY1NoYXBlLmJvdW5kcy5jZW50ZXJZIClcclxuXHJcbiAgICAgIC8vIGxlZnQgaG9yaXpvbnRhbCBsZWFkXHJcbiAgICAgIC5saW5lVG9SZWxhdGl2ZSggU0NIRU1BVElDX1NURU1fV0lEVEgsIDAgKVxyXG5cclxuICAgICAgLy8gdXBwZXIgaGFsZiBvZiB0aGUgYm94XHJcbiAgICAgIC5saW5lVG9SZWxhdGl2ZSggMCwgLWJveEhlaWdodCAvIDIgKVxyXG4gICAgICAubGluZVRvUmVsYXRpdmUoIGJveFdpZHRoLCAwIClcclxuICAgICAgLmxpbmVUb1JlbGF0aXZlKCAwLCBib3hIZWlnaHQgLyAyIClcclxuXHJcbiAgICAgIC8vIHJpZ2h0IGhvcml6b250YWwgbGVhZFxyXG4gICAgICAubGluZVRvUmVsYXRpdmUoIFNDSEVNQVRJQ19TVEVNX1dJRFRILCAwIClcclxuXHJcbiAgICAgIC8vIGdvIGJhY2sgYWxvbmcgdGhlIHJpZ2h0IGhvcml6b250YWwgbGVhZFxyXG4gICAgICAubGluZVRvUmVsYXRpdmUoIC1TQ0hFTUFUSUNfU1RFTV9XSURUSCwgMCApXHJcblxyXG4gICAgICAvLyBsb3dlciBoYWxmIG9nIHRoZSBib3hcclxuICAgICAgLmxpbmVUb1JlbGF0aXZlKCAwLCBib3hIZWlnaHQgLyAyIClcclxuICAgICAgLmxpbmVUb1JlbGF0aXZlKCAtYm94V2lkdGgsIDAgKVxyXG5cclxuICAgICAgLy8gc21hbGwgbGVmdCB2ZXJ0aWNhbCBsaW5lLiBQbGFjZSBpdCBhdCB4ID0gYm94TGVuZ3RoIC8gNyAoc2VlbXMgdG8gYmUgdmlzdWFsbHkgYSBnb29kIHBsYWNlKVxyXG4gICAgICAubGluZVRvUmVsYXRpdmUoIDAsIC1ib3hIZWlnaHQgKVxyXG4gICAgICAubGluZVRvUmVsYXRpdmUoIGJveExlbmd0aDd0aCwgMCApXHJcbiAgICAgIC5saW5lVG9SZWxhdGl2ZSggMCwgYm94SGVpZ2h0IClcclxuXHJcbiAgICAgIC8qIHNtYWxsIHJpZ2h0IHZlcnRpY2FsIGxpbmU6IHRoZSAxc3QgJ2xpbmVUb1JlbGF0aXZlJyBiZWxvdyB0YWtlcyB0byBzdGFydGluZyBwb2ludCwgYXQgdGhlIGNvc3RcclxuICAgICAgb2YgZHJhd2luZyBhIGxpbmUgb24gYW4gYWxyZWFkeSBleGlzdGluZyBvbmUuICovXHJcbiAgICAgIC5saW5lVG9SZWxhdGl2ZSggYm94V2lkdGggLSAyICogYm94TGVuZ3RoN3RoLCAwIClcclxuICAgICAgLmxpbmVUb1JlbGF0aXZlKCAwLCAtYm94SGVpZ2h0ICk7XHJcblxyXG4gICAgY29uc3QgdXBkYXRlU2NoZW1hdGljVHlwZSA9ICggc2NoZW1hdGljVHlwZTogU2NoZW1hdGljVHlwZSApID0+IHtcclxuICAgICAgc2NoZW1hdGljTm9kZS5zaGFwZSA9ICggc2NoZW1hdGljVHlwZSA9PT0gU2NoZW1hdGljVHlwZS5JRUVFIHx8IHNjaGVtYXRpY1R5cGUgPT09IFNjaGVtYXRpY1R5cGUuQlJJVElTSCApID8gc2NoZW1hdGljU2hhcGUgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVzZUlFQztcclxuICAgIH07XHJcbiAgICBzY2hlbWF0aWNUeXBlUHJvcGVydHkubGluayggdXBkYXRlU2NoZW1hdGljVHlwZSApO1xyXG5cclxuICAgIC8vIENlbnRlciB2ZXJ0aWNhbGx5IHRvIG1hdGNoIHRoZSBGaXhlZENpcmN1aXRFbGVtZW50Tm9kZSBhc3N1bXB0aW9uIHRoYXQgb3JpZ2luIGlzIGNlbnRlciBsZWZ0XHJcbiAgICBzY2hlbWF0aWNOb2RlLmNlbnRlclkgPSAwO1xyXG4gICAgbGlmZWxpa2VGdXNlTm9kZS5jZW50ZXJZID0gMDtcclxuXHJcbiAgICAvLyBFeHBhbmQgdGhlIHBvaW50ZXIgYXJlYXMgd2l0aCBhIGRlZmVuc2l2ZSBjb3B5LCBzZWVcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jaXJjdWl0LWNvbnN0cnVjdGlvbi1raXQtY29tbW9uL2lzc3Vlcy8zMTBcclxuICAgIHNjaGVtYXRpY05vZGUubW91c2VBcmVhID0gc2NoZW1hdGljTm9kZS5ib3VuZHMuY29weSgpO1xyXG4gICAgc2NoZW1hdGljTm9kZS50b3VjaEFyZWEgPSBzY2hlbWF0aWNOb2RlLmJvdW5kcy5jb3B5KCk7XHJcblxyXG4gICAgc3VwZXIoIHNjcmVlblZpZXcsIGNpcmN1aXROb2RlLCBmdXNlLCB2aWV3VHlwZVByb3BlcnR5LCBsaWZlbGlrZUZ1c2VOb2RlLCBzY2hlbWF0aWNOb2RlLCB0YW5kZW0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLmZ1c2UgPSBmdXNlO1xyXG5cclxuICAgIC8vIFVwZGF0ZSB0aGUgbG9vayB3aGVuIHRoZSBmdXNlIGlzIHRyaXBwZWRcclxuICAgIGNvbnN0IHVwZGF0ZVRyaXBwZWQgPSAoIGlzVHJpcHBlZDogYm9vbGVhbiApID0+IHtcclxuICAgICAgaWYgKCBpc1RyaXBwZWQgJiYgIXBoZXQuam9pc3Quc2ltLmlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgY2lyY3VpdE5vZGUhLmFkZENoaWxkKCBuZXcgRnVzZVRyaXBBbmltYXRpb24oIHsgY2VudGVyOiB0aGlzLmNlbnRlciB9ICkgKTtcclxuICAgICAgfVxyXG4gICAgICBnbGFzc05vZGUuZmlsbCA9IGlzVHJpcHBlZCA/ICcjNGU0ZTRlJyA6IERFRkFVTFRfR0xBU1NfRklMTDtcclxuICAgICAgZmlsYW1lbnRQYXRoLnNoYXBlID0gaXNUcmlwcGVkID8gYnJva2VuRmlsYW1lbnRTaGFwZSA6IGZpbGFtZW50U2hhcGU7XHJcbiAgICB9O1xyXG4gICAgaWYgKCAhb3B0aW9ucy5pc0ljb24gKSB7XHJcbiAgICAgIHRoaXMuZnVzZS5pc1RyaXBwZWRQcm9wZXJ0eS5saW5rKCB1cGRhdGVUcmlwcGVkICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlRnVzZU5vZGUgPSAoKSA9PiB7XHJcbiAgICAgIGxpZmVsaWtlRnVzZU5vZGUuZGlzcG9zZSgpO1xyXG4gICAgICBmdXNlLmN1cnJlbnRSYXRpbmdQcm9wZXJ0eS51bmxpbmsoIHVwZGF0ZUZpbGFtZW50UGF0aExpbmVXaWR0aCApO1xyXG4gICAgICBpZiAoICFvcHRpb25zLmlzSWNvbiApIHtcclxuICAgICAgICB0aGlzLmZ1c2UuaXNUcmlwcGVkUHJvcGVydHkudW5saW5rKCB1cGRhdGVUcmlwcGVkICk7XHJcbiAgICAgIH1cclxuICAgICAgc2NoZW1hdGljVHlwZVByb3BlcnR5LnVubGluayggdXBkYXRlU2NoZW1hdGljVHlwZSApO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNwb3NlRnVzZU5vZGUoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbmNpcmN1aXRDb25zdHJ1Y3Rpb25LaXRDb21tb24ucmVnaXN0ZXIoICdGdXNlTm9kZScsIEZ1c2VOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLE9BQU9BLE9BQU8sTUFBTSw0QkFBNEI7QUFDaEQsT0FBT0MsS0FBSyxNQUFNLDBCQUEwQjtBQUM1QyxPQUFPQyxPQUFPLE1BQU0sNEJBQTRCO0FBQ2hELFNBQVNDLEtBQUssUUFBUSw2QkFBNkI7QUFDbkQsU0FBU0MsS0FBSyxFQUFFQyxLQUFLLEVBQUVDLElBQUksRUFBRUMsSUFBSSxFQUFFQyxTQUFTLFFBQVEsZ0NBQWdDO0FBRXBGLE9BQU9DLFFBQVEsTUFBTSwwQkFBMEI7QUFDL0MsT0FBT0MsYUFBYSxNQUFNLHFCQUFxQjtBQUMvQyxPQUFPQyw0QkFBNEIsTUFBTSxvQ0FBb0M7QUFLN0UsT0FBT0MsdUJBQXVCLE1BQTBDLDhCQUE4QjtBQUN0RyxPQUFPQyxpQkFBaUIsTUFBTSx3QkFBd0I7QUFDdEQsT0FBT0MscUJBQXFCLE1BQU0sNEJBQTRCO0FBQzlELE9BQU9DLGFBQWEsTUFBTSxvQkFBb0I7QUFDOUMsT0FBT0MsU0FBUyxNQUE0QixvQ0FBb0M7O0FBRWhGO0FBQ0EsTUFBTUMsb0JBQW9CLEdBQUcsRUFBRTtBQUMvQixNQUFNQywyQkFBMkIsR0FBRyxDQUFDO0FBQ3JDLE1BQU1DLHVCQUF1QixHQUFHLENBQUM7QUFDakMsTUFBTUMsU0FBUyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0FBQ3RCLE1BQU1DLFFBQVEsR0FBRyxFQUFFLENBQUMsQ0FBQztBQUNyQixNQUFNQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDcEIsTUFBTUMscUJBQXFC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