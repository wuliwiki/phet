// Copyright 2023, University of Colorado Boulder

/**
 * Controls a specific animated value for an Animation.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Property from '../../axon/js/Property.js';
import TinyProperty from '../../axon/js/TinyProperty.js';
import optionize from '../../phet-core/js/optionize.js';
import Easing from './Easing.js';
import twixt from './twixt.js';

// Types of things where the default blend/distance/add options will work

class AnimationTarget {
  // Computed start/end values for the animation (once the animation finishes the delay and begins)
  startingValue = null;
  endingValue = null;

  /**
   * NOTE: Generally don't use this directly. Instead, use Animation, providing config for one or more targets.
   *
   * Every animation target needs two things:
   *
   * 1. A way of getting/setting the animated value (`setValue`/`getValue`, `property`, or `object`/`attribute`).
   * 2. A way of determining the value to animate toward (`to` or `delta`).
   */
  constructor(providedConfig) {
    const config = optionize()({
      setValue: null,
      getValue: null,
      property: null,
      object: null,
      attribute: null,
      to: null,
      delta: null,
      speed: null,
      from: null,
      easing: Easing.CUBIC_IN_OUT,
      // @ts-expect-error - Not sure how to tell it that the default doesn't work for some types, since we can't use the trickier object
      blend: AnimationTarget.DEFAULT_BLEND,
      // @ts-expect-error - Not sure how to tell it that the default doesn't work for some types, since we can't use the trickier object
      distance: AnimationTarget.DEFAULT_DISTANCE,
      // @ts-expect-error - Not sure how to tell it that the default doesn't work for some types, since we can't use the trickier object
      add: AnimationTarget.DEFAULT_ADD
    }, providedConfig);
    assert && assert(+(config.property !== null) + +(config.object !== null) + +(config.setValue !== null) === 1, 'Should have one (and only one) way of defining how to set the animated value. Use one of property/object/setValue');
    assert && assert(config.setValue === null || typeof config.setValue === 'function', 'If setValue is provided, it should be a function.');
    assert && assert(config.setValue === null || config.from !== null || typeof config.getValue === 'function', 'If setValue is provided and no "from" value is specified, then getValue needs to be a function.');
    assert && assert(config.to !== null || config.delta !== null, 'Need something to animate to, use to/delta');
    assert && assert(config.property === null || (config.property instanceof Property || config.property instanceof TinyProperty) && config.property.isSettable(), 'If property is provided, it should be a settable Property or TinyProperty');
    assert && assert(config.object === null || typeof config.object === 'object' && typeof config.attribute === 'string', 'If object is provided, then object should be an object, and attribute should be a string.');
    assert && assert(config.easing instanceof Easing, 'The easing should be of type Easing');
    assert && assert(typeof config.blend === 'function', 'The blend option should be a function');
    assert && assert(typeof config.distance === 'function', 'The distance option should be a function');
    assert && assert(typeof config.add === 'function', 'The add option should be a function');

    // If `object` is provided, create the associated getter/setter
    if (config.object) {
      assert && assert(config.attribute !== null);

      // @ts-expect-error - We know that config.object is an object, but TS doesn't
      config.setValue = AnimationTarget.OBJECT_SET(config.object, config.attribute);
      // @ts-expect-error - We know that config.object is an object, but TS doesn't
      config.getValue = AnimationTarget.OBJECT_GET(config.object, config.attribute);
    }

    // If `property` is provided, create the associated getter/setter
    if (config.property) {
      config.setValue = AnimationTarget.PROPERTY_SET(config.property);
      config.getValue = AnimationTarget.PROPERTY_GET(config.property);
    }
    assert && assert(config.setValue !== null);
    this.getValue = config.getValue;
    this.setValue = config.setValue;
    this.easing = config.easing;
    this.from = config.from;
    this.to = config.to;
    this.delta = config.delta;
    this.speed = config.speed; // Saved config to help determine the length of the animation
    this.blend = config.blend;
    this.distance = config.distance;
    this.add = config.add;
  }

  /**
   * Default blending function for the `blend` function.
   */

  static DEFAULT_BLEND(a, b, ratio) {
    assert && assert(isFinite(ratio) && ratio >= 0 && ratio <= 1, `Invalid ratio: ${ratio}`);
    if (ratio === 0) {
      return a;
    }
    if (ratio === 1) {
      return b;
    }
    if (typeof a === 'number' && typeof b === 'number') {
      // @ts-expect-error - It can't detect we're in the T === number case.
      return a + (b - a) * ratio;
    }
    if (typeof a === 'object' && typeof b === 'object' && typeof a.blend === 'function') {
      return a.blend(b, ratio);
    }
    throw new Error(`Blending not supported for: ${JSON.stringify(a)}, ${JSON.stringify(b)}, pass in a blend option`);
  }

  /**
   * Default distance function for the `distance` option (used for the `speed` option)
   */

  static DEFAULT_DISTANCE(a, b) {
    if (typeof a === 'number' && typeof b === 'number') {
      return Math.abs(a - b);
    }
    if (typeof a === 'object' && typeof b === 'object' && typeof a.distance === 'function') {
      return a.distance(b);
    }
    throw new Error(`Distance (required for speed) by default not supported for: ${JSON.stringify(a)}, ${JSON.stringify(b)}, pass in a distance option`);
  }

  /**
   * Default addition function for the `add` option (used for the `delta` option)
   */

  static DEFAULT_ADD(a, b) {
    if (typeof a === 'number' && typeof b === 'number') {
      // @ts-expect-error - It can't detect we're in the T === number case.
      return a + b;
    }
    if (typeof a === 'object' && typeof b === 'object' && typeof a.plus === 'function') {
      return a.plus(b);
    }
    throw new Error(`Addition (required for delta) by default not supported for: ${JSON.stringify(a)}, ${JSON.stringify(b)}, pass in an add option`);
  }

  /**
   * Helper function for creating a setter closure for object[ attribute ].
   */
  static OBJECT_SET(object, attribute) {
    return function (value) {
      object[attribute] = value;
    };
  }

  /**
   * Helper function for creating a getter closure for object[ attribute ].
   */
  static OBJECT_GET(object, attribute) {
    return function () {
      return object[attribute];
    };
  }

  /**
   * Helper function for creating a setter closure for Properties
   */
  static PROPERTY_SET(property) {
    return function (value) {
      property.value = value;
    };
  }

  /**
   * Helper function for creating a getter closure for Properties
   */
  static PROPERTY_GET(property) {
    return function () {
      return property.value;
    };
  }

  /**
   * Computes the starting and ending values of this target.
   *
   * Generally called when the animation is just about to begin, so it can look up the current value if necessary.
   */
  computeStartEnd() {
    assert && assert(this.to !== null || this.delta !== null);
    assert && assert(this.from !== null || this.getValue !== null);
    this.startingValue = this.from !== null ? this.from : this.getValue();
    this.endingValue = this.to !== null ? this.to : this.add(this.startingValue, this.delta);
  }

  /**
   * Updates the value of this target.
   *
   * @param ratio - How far along (from 0 to 1) in the animation.
   */
  update(ratio) {
    // These should be non-null by this point
    assert && assert(this.setValue !== null);
    assert && assert(this.startingValue !== null);
    assert && assert(this.endingValue !== null);
    this.setValue(this.blend(this.startingValue, this.endingValue, this.easing.value(ratio)));
  }

  /**
   * Whether this target can define the duration of an animation.
   */
  hasPreferredDuration() {
    return this.speed !== null;
  }

  /**
   * Returns the preferred duration of this target (or null if not defined).
   */
  getPreferredDuration() {
    assert && assert(this.startingValue !== null);
    assert && assert(this.delta !== null);
    return this.speed === null ? null : this.speed * this.distance(this.startingValue, this.delta);
  }
}
twixt.register('AnimationTarget', AnimationTarget);
export default AnimationTarget;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIlRpbnlQcm9wZXJ0eSIsIm9wdGlvbml6ZSIsIkVhc2luZyIsInR3aXh0IiwiQW5pbWF0aW9uVGFyZ2V0Iiwic3RhcnRpbmdWYWx1ZSIsImVuZGluZ1ZhbHVlIiwiY29uc3RydWN0b3IiLCJwcm92aWRlZENvbmZpZyIsImNvbmZpZyIsInNldFZhbHVlIiwiZ2V0VmFsdWUiLCJwcm9wZXJ0eSIsIm9iamVjdCIsImF0dHJpYnV0ZSIsInRvIiwiZGVsdGEiLCJzcGVlZCIsImZyb20iLCJlYXNpbmciLCJDVUJJQ19JTl9PVVQiLCJibGVuZCIsIkRFRkFVTFRfQkxFTkQiLCJkaXN0YW5jZSIsIkRFRkFVTFRfRElTVEFOQ0UiLCJhZGQiLCJERUZBVUxUX0FERCIsImFzc2VydCIsImlzU2V0dGFibGUiLCJPQkpFQ1RfU0VUIiwiT0JKRUNUX0dFVCIsIlBST1BFUlRZX1NFVCIsIlBST1BFUlRZX0dFVCIsImEiLCJiIiwicmF0aW8iLCJpc0Zpbml0ZSIsIkVycm9yIiwiSlNPTiIsInN0cmluZ2lmeSIsIk1hdGgiLCJhYnMiLCJwbHVzIiwidmFsdWUiLCJjb21wdXRlU3RhcnRFbmQiLCJ1cGRhdGUiLCJoYXNQcmVmZXJyZWREdXJhdGlvbiIsImdldFByZWZlcnJlZER1cmF0aW9uIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJBbmltYXRpb25UYXJnZXQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIENvbnRyb2xzIGEgc3BlY2lmaWMgYW5pbWF0ZWQgdmFsdWUgZm9yIGFuIEFuaW1hdGlvbi5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFRpbnlQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1RpbnlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBWZWN0b3IzIGZyb20gJy4uLy4uL2RvdC9qcy9WZWN0b3IzLmpzJztcclxuaW1wb3J0IFZlY3RvcjQgZnJvbSAnLi4vLi4vZG90L2pzL1ZlY3RvcjQuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgS2V5c01hdGNoaW5nIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9LZXlzTWF0Y2hpbmcuanMnO1xyXG5pbXBvcnQgeyBDb2xvciB9IGZyb20gJy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBFYXNpbmcgZnJvbSAnLi9FYXNpbmcuanMnO1xyXG5pbXBvcnQgdHdpeHQgZnJvbSAnLi90d2l4dC5qcyc7XHJcblxyXG50eXBlIEJsZW5kRnVuY3Rpb248VD4gPSAoIGE6IFQsIGI6IFQsIGZyYWN0aW9uOiBudW1iZXIgKSA9PiBUO1xyXG50eXBlIERpc3RhbmNlRnVuY3Rpb248VD4gPSAoIGE6IFQsIGI6IFQgKSA9PiBudW1iZXI7XHJcbnR5cGUgQWRkRnVuY3Rpb248VD4gPSAoIGE6IFQsIGI6IFQgKSA9PiBUO1xyXG5cclxudHlwZSBJbnRlcm5hbEFuaW1hdGlvblRhcmdldE9wdGlvbnM8VCwgT2JqID0gdW5rbm93bj4gPSB7XHJcbiAgLypcclxuICAgKiBOT1RFOiBPbmUgb2YgYHNldFZhbHVlYC9gcHJvcGVydHlgL2BvYmplY3RgIGlzIFJFUVVJUkVELlxyXG4gICAqXHJcbiAgICogVGhlIGFuaW1hdGlvbiBuZWVkcyB0byBiZSBhYmxlIHRvIHNldCAoYW5kIHNvbWV0aW1lcyBnZXQpIHRoZSB2YWx1ZSBiZWluZyBhbmltYXRlZC4gSW4gdGhlIG1vc3QgZ2VuZXJhbCBjYXNlLFxyXG4gICAqIGEgZ2V0dGVyL3NldHRlciBwYWlyIChnZXRWYWx1ZSBhbmQgc2V0VmFsdWUpIGNhbiBiZSBwcm92aWRlZC5cclxuICAgKlxyXG4gICAqIEZvciBjb252ZW5pZW5jZSwgQW5pbWF0aW9uVGFyZ2V0IGFsc28gc3VwcG9ydHMgcGFzc2luZyBpbiBhbiBheG9uIFByb3BlcnR5IChwcm9wZXJ0eTopLCBvciBzZXR0aW5nIHVwIGZvciBhblxyXG4gICAqIGFzc2lnbm1lbnQgdG8gYW4gb2JqZWN0IHdpdGggb2JqZWN0L2F0dHJpYnV0ZSAoYWNjZXNzZXMgYXMgYG9iamVjdFsgYXR0cmlidXRlIF1gKS5cclxuICAgKlxyXG4gICAqIEUuZy46XHJcbiAgICpcclxuICAgKiBuZXcgQW5pbWF0aW9uKCB7XHJcbiAgICogICBzZXRWYWx1ZTogZnVuY3Rpb24oIHZhbHVlICkgeyB3aW5kb3cudmFsdWUgPSB2YWx1ZSAqIDEwOyB9LFxyXG4gICAqICAgZ2V0VmFsdWU6IGZ1bmN0aW9uKCkgeyByZXR1cm4gd2luZG93LnZhbHVlIC8gMTA7IH0sXHJcbiAgICogICAvLyBvdGhlciBjb25maWdcclxuICAgKiB9IClcclxuICAgKlxyXG4gICAqIHZhciBzb21lVmVjdG9yUHJvcGVydHkgPSBuZXcgcGhldC5heG9uLlByb3BlcnR5KCBuZXcgcGhldC5kb3QuVmVjdG9yMiggMTAsIDUgKSApO1xyXG4gICAqIG5ldyBBbmltYXRpb24oIHtcclxuICAgKiAgIHByb3BlcnR5OiBzb21lVmVjdG9yUHJvcGVydHksXHJcbiAgICogICAvLyBvdGhlciBjb25maWdcclxuICAgKiB9IClcclxuICAgKlxyXG4gICAqIHZhciBvYmogPSB7IHg6IDUgfTtcclxuICAgKiBuZXcgQW5pbWF0aW9uKCB7XHJcbiAgICogICBvYmplY3Q6IG9iaixcclxuICAgKiAgIGF0dHJpYnV0ZTogJ3gnLFxyXG4gICAqICAgLy8gb3RoZXIgY29uZmlnXHJcbiAgICogfSApXHJcbiAgICpcclxuICAgKiBOT1RFOiBudWxsIHZhbHVlcyBhcmUgbm90IHN1cHBvcnRlZCwgYXMgaXQgaXMgdXNlZCBhcyB0aGUgXCJubyB2YWx1ZVwiIHZhbHVlLCBhbmQgYW5pbWF0aW5nIHRvd2FyZHMgXCJudWxsXCJcclxuICAgKiB1c3VhbGx5IHdvdWxkbid0IG1ha2Ugc2Vuc2UgKGV2ZW4gaWYgeW91IGRlZmluZSB0aGUgcHJvcGVyIGludGVycG9sYXRpb24gZnVuY3Rpb24pLlxyXG4gICAqL1xyXG5cclxuICAvLyBJZiBwcm92aWRlZCwgaXQgc2hvdWxkIGJlIGEgZnVuY3Rpb24gdGhhdCBhY3RzIGFzIFwic2V0dGluZ1wiIHRoZSB2YWx1ZSBvZiB0aGUgYW5pbWF0aW9uLlxyXG4gIC8vIE5PVEU6IGRvIG5vdCBwcm92aWRlIHRoaXMgYW5kIHByb3BlcnR5L29iamVjdC5cclxuICBzZXRWYWx1ZT86ICggKCB2YWx1ZTogVCApID0+IHZvaWQgKSB8IG51bGw7XHJcblxyXG4gIC8vIElmIHByb3ZpZGVkLCBpdCBzaG91bGQgYmUgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlIGN1cnJlbnQgdmFsdWUgdGhhdCB3aWxsIGJlIGFuaW1hdGVkLlxyXG4gIC8vIE5PVEU6IFRoaXMgY2FuIGJlIG9taXR0ZWQsIGV2ZW4gaWYgc2V0VmFsdWUgaXMgcHJvdmlkZWQsIGlmIHRoZSBgZnJvbWAgb3B0aW9uIGlzIHNldCAoYXMgdGhlIGN1cnJlbnQgdmFsdWUgd291bGRcclxuICAvLyBqdXN0IGJlIGlnbm9yZWQpLlxyXG4gIGdldFZhbHVlPzogKCAoKSA9PiBUICkgfCBudWxsO1xyXG5cclxuICAvLyBJZiBwcm92aWRlZCwgaXQgc2hvdWxkIGJlIGFuIGF4b24gUHJvcGVydHkgd2l0aCB0aGUgY3VycmVudCB2YWx1ZS4gSXQgd2lsbCBiZSBtb2RpZmllZCBieSB0aGUgYW5pbWF0aW9uLlxyXG4gIC8vIE5PVEU6IGRvIG5vdCBwcm92aWRlIHRoaXMgYW5kIHNldFZhbHVlL29iamVjdFxyXG4gIHByb3BlcnR5PzogVFByb3BlcnR5PFQ+IHwgbnVsbDtcclxuXHJcbiAgLy8gSWYgcHJvdmlkZWQsIGl0IHNob3VsZCBwb2ludCB0byBhbiBvYmplY3Qgd2hlcmUgYG9iamVjdFsgYXR0cmlidXRlIF1gIGlzIHRoZSB2YWx1ZSB0byBiZSBtb2RpZmllZFxyXG4gIC8vIGJ5IHRoZSBhbmltYXRpb24uIE5PVEU6IGRvIG5vdCBwcm92aWRlIHRoaXMgYW5kIHNldFZhbHVlL3Byb3BlcnR5XHJcbiAgb2JqZWN0PzogT2JqIHwgbnVsbDtcclxuXHJcbiAgLy8gSWYgYG9iamVjdGAgaXMgcHJvdmlkZWQsIGl0IHNob3VsZCBiZSBhIHN0cmluZyBzdWNoIHRoYXQgYG9iamVjdFsgYXR0cmlidXRlIF1gIGlzIHRoZSB2YWx1ZSB0byBiZSBtb2RpZmllZC5cclxuICBhdHRyaWJ1dGU/OiBLZXlzTWF0Y2hpbmc8T2JqLCBUPiB8IG51bGw7XHJcblxyXG4gIC8qXHJcbiAgICogTk9URTogb25lIG9mIGB0b2AvYGRlbHRhYCBpcyBSRVFVSVJFRC5cclxuICAgKlxyXG4gICAqIFRoZSBlbmQgdmFsdWUgb2YgdGhlIGFuaW1hdGlvbiBuZWVkcyB0byBiZSBzcGVjaWZpZWQsIGJ1dCB0aGVyZSBhcmUgbXVsdGlwbGUgd2F5cyB0byBkbyBzby4gSWYgeW91IGtub3cgdGhlXHJcbiAgICogZXhhY3QgZW5kIHZhbHVlLCBpdCBjYW4gYmUgcHJvdmlkZWQgd2l0aCBgdG86IHZhbHVlYC4gVGhlbiBldmVyeSB0aW1lIHRoZSBhbmltYXRpb24gaXMgcnVuLCBpdCB3aWxsIGdvIHRvIHRoYXRcclxuICAgKiB2YWx1ZS5cclxuICAgKlxyXG4gICAqIEl0IGlzIGFsc28gcG9zc2libGUgdG8gcHJvdmlkZSBgZGVsdGE6IHZhbHVlYCB3aGljaCB3aWxsIGFwcGx5IGEgcmVsYXRpdmUgYW5pbWF0aW9uIGJ5IHRoYXQgYW1vdW50IChlLmcuIGZvclxyXG4gICAqIG51bWJlcnMsIGBkZWx0YTogNWAgd291bGQgaW5kaWNhdGUgdGhhdCB0aGUgYW5pbWF0aW9uIHdpbGwgaW5jcmVhc2UgdGhlIHZhbHVlIGJ5IDUgZXZlcnkgdGltZSBpdCBpcyBydW4pLlxyXG4gICAqL1xyXG5cclxuICAvLyBJZiBwcm92aWRlZCwgdGhlIGFuaW1hdGlvbiB3aWxsIHRyZWF0IHRoaXMgYXMgdGhlIGVuZCB2YWx1ZSAod2hhdCBpdCBhbmltYXRlcyB0b3dhcmQpLlxyXG4gIHRvPzogVCB8IG51bGw7XHJcblxyXG4gIC8vIElmIHByb3ZpZGVkLCB0aGUgYW5pbWF0aW9uIHdpbGwgdHJlYXQgdGhlIGVuZGluZyB2YWx1ZSBvZiB0aGUgYW5pbWF0aW9uIGFzIHRoZSBzdGFydGluZyB2YWx1ZSBwbHVzIHRoaXMgZGVsdGFcclxuICAvLyB2YWx1ZS4gVG8gZGV0ZXJtaW5lIHRoZSBleGFjdCB2YWx1ZSwgdGhlIGBhZGRgIG9wdGlvbiB3aWxsIGJlIHVzZWQgKHdoaWNoIGJ5IGRlZmF1bHQgaGFuZGxlc1xyXG4gIC8vIG51bWJlci9WZWN0b3IyL1ZlY3RvcjMvVmVjdG9yNCBhcyBleHBlY3RlZCkuIFRoZSBhbmltYXRpb24gY2FuIGJlIHJ1biBtdWx0aXBsZSB0aW1lcywgYW5kIGVhY2ggdGltZSBpdCB3aWxsIHVzZVxyXG4gIC8vIHRoZSBcInN0YXJ0aW5nXCIgdmFsdWUgZnJvbSBsYXN0IHRpbWUgKHVubGVzcyB0aGUgYGZyb21gIG9wdGlvbiBpcyB1c2VkKS5cclxuICBkZWx0YT86IFQgfCBudWxsO1xyXG5cclxuICAvLyBJZiBwcm92aWRlZCwgdGhlIGFuaW1hdGlvbidzIGxlbmd0aCB3aWxsIGJlIHRoaXMgdmFsdWUgKHNlY29uZHMvdW5pdCkgdGltZXMgdGhlIFwiZGlzdGFuY2VcIiBiZXR3ZWVuIHRoZSBzdGFydCBhbmRcclxuICAvLyBlbmQgdmFsdWUgb2YgdGhlIGFuaW1hdGlvbi4gVGhlIGBkaXN0YW5jZWAgb3B0aW9uIGNhbiBiZSB1c2VkIHRvIHNwZWNpZnkgYSB3YXkgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UsIGFuZCB3b3Jrc1xyXG4gIC8vIGJ5IGRlZmF1bHQgYXMgZXhwZWN0ZWQgZm9yIG51bWJlci9WZWN0b3IyL1ZlY3RvcjMvVmVjdG9yNC5cclxuICBzcGVlZD86IG51bWJlciB8IG51bGw7XHJcblxyXG4gIC8vIElmIHByb3ZpZGVkLCB0aGUgYW5pbWF0aW9uIHdpbGwgc3RhcnQgZnJvbSB0aGlzIHZhbHVlIChpbnN0ZWFkIG9mIGdldHRpbmcgdGhlIGN1cnJlbnQgdmFsdWUgdG8gc3RhcnQgZnJvbSkuXHJcbiAgZnJvbT86IFQgfCBudWxsO1xyXG5cclxuICAvLyBDb250cm9scyB0aGUgcmVsYXRpdmUgbW90aW9uIGZyb20gdGhlIHN0YXJ0aW5nIHZhbHVlIHRvIHRoZSBlbmRpbmcgdmFsdWUuIFNlZSBFYXNpbmcuanMgZm9yIGluZm8uXHJcbiAgZWFzaW5nPzogRWFzaW5nO1xyXG5cclxuICAvLyBTaG91bGQgYmUgb2YgdGhlIGZvcm0gYGZ1bmN0aW9uKCBzdGFydDogeyp9LCBlbmQ6IHsqfSwgcmF0aW86IHtudW1iZXJ9ICk6IHsqfWAgd2hlcmUgdGhlIHJhdGlvIHdpbGwgYmUgYmV0d2VlbiAwXHJcbiAgLy8gYW5kIDEgKGluY2x1c2l2ZSkuIElmIHRoZSByYXRpbyBpcyAwLCBpdCBzaG91bGQgcmV0dXJuIHRoZSBzdGFydGluZyB2YWx1ZSwgaWYgdGhlIHJhdGlvIGlzIDEsIGl0IHNob3VsZCByZXR1cm4gdGhlXHJcbiAgLy8gZW5kaW5nIHZhbHVlLCBhbmQgb3RoZXJ3aXNlIGl0IHNob3VsZCByZXR1cm4gdGhlIGJlc3QgaW50ZXJwb2xhdGlvbiBwb3NzaWJsZSBiZXR3ZWVuIHRoZSB0d28gdmFsdWVzLiBUaGUgZGVmYXVsdFxyXG4gIC8vIHNob3VsZCB3b3JrIGZvciBudW1iZXIvVmVjdG9yMi9WZWN0b3IzL1ZlY3RvcjQvQ29sb3IsIGJ1dCBmb3Igb3RoZXIgdHlwZXMgZWl0aGVyIGBzdGFydC5ibGVuZCggZW5kLCByYXRpbyApYCBzaG91bGRcclxuICAvLyBiZSBkZWZpbmVkIGFuZCB3b3JrLCBvciB0aGlzIGZ1bmN0aW9uIHNob3VsZCBiZSBvdmVycmlkZGVuLlxyXG4gIGJsZW5kPzogQmxlbmRGdW5jdGlvbjxUPjtcclxuXHJcbiAgLy8gU2hvdWxkIGJlIG9mIHRoZSBmb3JtIGBmdW5jdGlvbiggc3RhcnQ6IHsqfSwgZW5kOiB7Kn0gKToge251bWJlcn1gLCBhbmQgaXQgc2hvdWxkIHJldHVybiBhIG1lYXN1cmVcclxuICAvLyBvZiBkaXN0YW5jZSAoYSBtZXRyaWMpIGJldHdlZW4gdGhlIHR3byB2YWx1ZXMuIFRoaXMgaXMgb25seSB1c2VkIGZvciBpZiB0aGUgYHNwZWVkYCBvcHRpb24gaXMgcHJvdmlkZWQgKHNvIGl0XHJcbiAgLy8gY2FuIGRldGVybWluZSB0aGUgbGVuZ3RoIG9mIHRoZSBhbmltYXRpb24pLiBUaGUgZGVmYXVsdCBzaG91bGQgd29yayBmb3IgbnVtYmVyL1ZlY3RvcjIvVmVjdG9yMy9WZWN0b3I0LlxyXG4gIGRpc3RhbmNlPzogRGlzdGFuY2VGdW5jdGlvbjxUPjtcclxuXHJcbiAgLy8gU2hvdWxkIGJlIG9mIHRoZSBmb3JtIGBmdW5jdGlvbiggc3RhcnQ6IHsqfSwgZGVsdGE6IHsqfSApOiB7Kn1gIHdoZXJlIGl0IGFkZHMgdG9nZXRoZXIgYSB2YWx1ZVxyXG4gIC8vIGFuZCBhIFwiZGVsdGFcIiAodXN1YWxseSBqdXN0IGEgdmFsdWUgb2YgdGhlIHNhbWUgdHlwZSkgYW5kIHJldHVybnMgdGhlIHJlc3VsdC4gVGhpcyBpcyB1c2VkIGZvciB0aGUgYGRlbHRhYFxyXG4gIC8vIG9wdGlvbi4gVGhlIGRlZmF1bHQgc2hvdWxkIHdvcmsgZm9yIG51bWJlci9WZWN0b3IyL1ZlY3RvcjMvVmVjdG9yNC5cclxuICBhZGQ/OiBBZGRGdW5jdGlvbjxUPjtcclxufTtcclxuXHJcbi8vIFR5cGVzIG9mIHRoaW5ncyB3aGVyZSB0aGUgZGVmYXVsdCBibGVuZC9kaXN0YW5jZS9hZGQgb3B0aW9ucyB3aWxsIHdvcmtcclxudHlwZSBEZWZhdWx0QmxlbmRhYmxlVHlwZTxUPiA9IG51bWJlciB8IHsgYmxlbmQ6ICggYjogVCwgcmF0aW86IG51bWJlciApID0+IFQgfTtcclxudHlwZSBEZWZhdWx0RGlzdGFuY2VhYmxlVHlwZTxUPiA9IG51bWJlciB8IHsgZGlzdGFuY2U6ICggYjogVCApID0+IG51bWJlciB9O1xyXG50eXBlIERlZmF1bHRBZGRhYmxlVHlwZTxUPiA9IG51bWJlciB8IHsgcGx1czogKCBiOiBUICkgPT4gVCB9O1xyXG5cclxuZXhwb3J0IHR5cGUgQW5pbWF0aW9uVGFyZ2V0T3B0aW9uczxUID0gdW5rbm93biwgT2JqID0gdW5rbm93bj4gPSBJbnRlcm5hbEFuaW1hdGlvblRhcmdldE9wdGlvbnM8VCwgT2JqPjtcclxuXHJcbmNsYXNzIEFuaW1hdGlvblRhcmdldDxULCBPYmogPSB1bmtub3duPiB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgc2V0VmFsdWU6ICggKCB2YWx1ZTogVCApID0+IHZvaWQgKTtcclxuICBwcml2YXRlIHJlYWRvbmx5IGdldFZhbHVlOiAoICgpID0+IFQgKSB8IG51bGw7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBlYXNpbmc6IEVhc2luZztcclxuICBwcml2YXRlIHJlYWRvbmx5IHRvOiBUIHwgbnVsbDtcclxuICBwcml2YXRlIHJlYWRvbmx5IGZyb206IFQgfCBudWxsO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGVsdGE6IFQgfCBudWxsO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgc3BlZWQ6IG51bWJlciB8IG51bGw7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBibGVuZDogQmxlbmRGdW5jdGlvbjxUPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3RhbmNlOiBEaXN0YW5jZUZ1bmN0aW9uPFQ+O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgYWRkOiBBZGRGdW5jdGlvbjxUPjtcclxuXHJcbiAgLy8gQ29tcHV0ZWQgc3RhcnQvZW5kIHZhbHVlcyBmb3IgdGhlIGFuaW1hdGlvbiAob25jZSB0aGUgYW5pbWF0aW9uIGZpbmlzaGVzIHRoZSBkZWxheSBhbmQgYmVnaW5zKVxyXG4gIHByaXZhdGUgc3RhcnRpbmdWYWx1ZTogVCB8IG51bGwgPSBudWxsO1xyXG4gIHByaXZhdGUgZW5kaW5nVmFsdWU6IFQgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgLyoqXHJcbiAgICogTk9URTogR2VuZXJhbGx5IGRvbid0IHVzZSB0aGlzIGRpcmVjdGx5LiBJbnN0ZWFkLCB1c2UgQW5pbWF0aW9uLCBwcm92aWRpbmcgY29uZmlnIGZvciBvbmUgb3IgbW9yZSB0YXJnZXRzLlxyXG4gICAqXHJcbiAgICogRXZlcnkgYW5pbWF0aW9uIHRhcmdldCBuZWVkcyB0d28gdGhpbmdzOlxyXG4gICAqXHJcbiAgICogMS4gQSB3YXkgb2YgZ2V0dGluZy9zZXR0aW5nIHRoZSBhbmltYXRlZCB2YWx1ZSAoYHNldFZhbHVlYC9gZ2V0VmFsdWVgLCBgcHJvcGVydHlgLCBvciBgb2JqZWN0YC9gYXR0cmlidXRlYCkuXHJcbiAgICogMi4gQSB3YXkgb2YgZGV0ZXJtaW5pbmcgdGhlIHZhbHVlIHRvIGFuaW1hdGUgdG93YXJkIChgdG9gIG9yIGBkZWx0YWApLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcHJvdmlkZWRDb25maWc6IEFuaW1hdGlvblRhcmdldE9wdGlvbnM8VCwgT2JqPiApIHtcclxuXHJcbiAgICBjb25zdCBjb25maWcgPSBvcHRpb25pemU8SW50ZXJuYWxBbmltYXRpb25UYXJnZXRPcHRpb25zPFQsIE9iaj4sIEludGVybmFsQW5pbWF0aW9uVGFyZ2V0T3B0aW9uczxULCBPYmo+PigpKCB7XHJcbiAgICAgIHNldFZhbHVlOiBudWxsLFxyXG4gICAgICBnZXRWYWx1ZTogbnVsbCxcclxuICAgICAgcHJvcGVydHk6IG51bGwsXHJcbiAgICAgIG9iamVjdDogbnVsbCxcclxuICAgICAgYXR0cmlidXRlOiBudWxsLFxyXG4gICAgICB0bzogbnVsbCxcclxuICAgICAgZGVsdGE6IG51bGwsXHJcbiAgICAgIHNwZWVkOiBudWxsLFxyXG4gICAgICBmcm9tOiBudWxsLFxyXG4gICAgICBlYXNpbmc6IEVhc2luZy5DVUJJQ19JTl9PVVQsXHJcblxyXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC0gTm90IHN1cmUgaG93IHRvIHRlbGwgaXQgdGhhdCB0aGUgZGVmYXVsdCBkb2Vzbid0IHdvcmsgZm9yIHNvbWUgdHlwZXMsIHNpbmNlIHdlIGNhbid0IHVzZSB0aGUgdHJpY2tpZXIgb2JqZWN0XHJcbiAgICAgIGJsZW5kOiBBbmltYXRpb25UYXJnZXQuREVGQVVMVF9CTEVORCxcclxuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIE5vdCBzdXJlIGhvdyB0byB0ZWxsIGl0IHRoYXQgdGhlIGRlZmF1bHQgZG9lc24ndCB3b3JrIGZvciBzb21lIHR5cGVzLCBzaW5jZSB3ZSBjYW4ndCB1c2UgdGhlIHRyaWNraWVyIG9iamVjdFxyXG4gICAgICBkaXN0YW5jZTogQW5pbWF0aW9uVGFyZ2V0LkRFRkFVTFRfRElTVEFOQ0UsXHJcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgLSBOb3Qgc3VyZSBob3cgdG8gdGVsbCBpdCB0aGF0IHRoZSBkZWZhdWx0IGRvZXNuJ3Qgd29yayBmb3Igc29tZSB0eXBlcywgc2luY2Ugd2UgY2FuJ3QgdXNlIHRoZSB0cmlja2llciBvYmplY3RcclxuICAgICAgYWRkOiBBbmltYXRpb25UYXJnZXQuREVGQVVMVF9BRERcclxuICAgIH0sIHByb3ZpZGVkQ29uZmlnICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggKyggY29uZmlnLnByb3BlcnR5ICE9PSBudWxsICkgKyArKCBjb25maWcub2JqZWN0ICE9PSBudWxsICkgKyArKCBjb25maWcuc2V0VmFsdWUgIT09IG51bGwgKSA9PT0gMSxcclxuICAgICAgJ1Nob3VsZCBoYXZlIG9uZSAoYW5kIG9ubHkgb25lKSB3YXkgb2YgZGVmaW5pbmcgaG93IHRvIHNldCB0aGUgYW5pbWF0ZWQgdmFsdWUuIFVzZSBvbmUgb2YgcHJvcGVydHkvb2JqZWN0L3NldFZhbHVlJyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbmZpZy5zZXRWYWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgY29uZmlnLnNldFZhbHVlID09PSAnZnVuY3Rpb24nLFxyXG4gICAgICAnSWYgc2V0VmFsdWUgaXMgcHJvdmlkZWQsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uLicgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjb25maWcuc2V0VmFsdWUgPT09IG51bGwgfHwgY29uZmlnLmZyb20gIT09IG51bGwgfHwgdHlwZW9mIGNvbmZpZy5nZXRWYWx1ZSA9PT0gJ2Z1bmN0aW9uJyxcclxuICAgICAgJ0lmIHNldFZhbHVlIGlzIHByb3ZpZGVkIGFuZCBubyBcImZyb21cIiB2YWx1ZSBpcyBzcGVjaWZpZWQsIHRoZW4gZ2V0VmFsdWUgbmVlZHMgdG8gYmUgYSBmdW5jdGlvbi4nICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY29uZmlnLnRvICE9PSBudWxsIHx8IGNvbmZpZy5kZWx0YSAhPT0gbnVsbCxcclxuICAgICAgJ05lZWQgc29tZXRoaW5nIHRvIGFuaW1hdGUgdG8sIHVzZSB0by9kZWx0YScgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KFxyXG4gICAgICBjb25maWcucHJvcGVydHkgPT09IG51bGwgfHxcclxuICAgICAgKCAoIGNvbmZpZy5wcm9wZXJ0eSBpbnN0YW5jZW9mIFByb3BlcnR5IHx8IGNvbmZpZy5wcm9wZXJ0eSBpbnN0YW5jZW9mIFRpbnlQcm9wZXJ0eSApICYmIGNvbmZpZy5wcm9wZXJ0eS5pc1NldHRhYmxlKCkgKSxcclxuICAgICAgJ0lmIHByb3BlcnR5IGlzIHByb3ZpZGVkLCBpdCBzaG91bGQgYmUgYSBzZXR0YWJsZSBQcm9wZXJ0eSBvciBUaW55UHJvcGVydHknICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY29uZmlnLm9iamVjdCA9PT0gbnVsbCB8fCAoIHR5cGVvZiBjb25maWcub2JqZWN0ID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgY29uZmlnLmF0dHJpYnV0ZSA9PT0gJ3N0cmluZycgKSxcclxuICAgICAgJ0lmIG9iamVjdCBpcyBwcm92aWRlZCwgdGhlbiBvYmplY3Qgc2hvdWxkIGJlIGFuIG9iamVjdCwgYW5kIGF0dHJpYnV0ZSBzaG91bGQgYmUgYSBzdHJpbmcuJyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbmZpZy5lYXNpbmcgaW5zdGFuY2VvZiBFYXNpbmcsICdUaGUgZWFzaW5nIHNob3VsZCBiZSBvZiB0eXBlIEVhc2luZycgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHR5cGVvZiBjb25maWcuYmxlbmQgPT09ICdmdW5jdGlvbicsICdUaGUgYmxlbmQgb3B0aW9uIHNob3VsZCBiZSBhIGZ1bmN0aW9uJyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdHlwZW9mIGNvbmZpZy5kaXN0YW5jZSA9PT0gJ2Z1bmN0aW9uJywgJ1RoZSBkaXN0YW5jZSBvcHRpb24gc2hvdWxkIGJlIGEgZnVuY3Rpb24nICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0eXBlb2YgY29uZmlnLmFkZCA9PT0gJ2Z1bmN0aW9uJywgJ1RoZSBhZGQgb3B0aW9uIHNob3VsZCBiZSBhIGZ1bmN0aW9uJyApO1xyXG5cclxuICAgIC8vIElmIGBvYmplY3RgIGlzIHByb3ZpZGVkLCBjcmVhdGUgdGhlIGFzc29jaWF0ZWQgZ2V0dGVyL3NldHRlclxyXG4gICAgaWYgKCBjb25maWcub2JqZWN0ICkge1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjb25maWcuYXR0cmlidXRlICE9PSBudWxsICk7XHJcblxyXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC0gV2Uga25vdyB0aGF0IGNvbmZpZy5vYmplY3QgaXMgYW4gb2JqZWN0LCBidXQgVFMgZG9lc24ndFxyXG4gICAgICBjb25maWcuc2V0VmFsdWUgPSBBbmltYXRpb25UYXJnZXQuT0JKRUNUX1NFVCggY29uZmlnLm9iamVjdCwgY29uZmlnLmF0dHJpYnV0ZSEgKTtcclxuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIFdlIGtub3cgdGhhdCBjb25maWcub2JqZWN0IGlzIGFuIG9iamVjdCwgYnV0IFRTIGRvZXNuJ3RcclxuICAgICAgY29uZmlnLmdldFZhbHVlID0gQW5pbWF0aW9uVGFyZ2V0Lk9CSkVDVF9HRVQoIGNvbmZpZy5vYmplY3QsIGNvbmZpZy5hdHRyaWJ1dGUhICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgYHByb3BlcnR5YCBpcyBwcm92aWRlZCwgY3JlYXRlIHRoZSBhc3NvY2lhdGVkIGdldHRlci9zZXR0ZXJcclxuICAgIGlmICggY29uZmlnLnByb3BlcnR5ICkge1xyXG4gICAgICBjb25maWcuc2V0VmFsdWUgPSBBbmltYXRpb25UYXJnZXQuUFJPUEVSVFlfU0VUKCBjb25maWcucHJvcGVydHkgKTtcclxuICAgICAgY29uZmlnLmdldFZhbHVlID0gQW5pbWF0aW9uVGFyZ2V0LlBST1BFUlRZX0dFVCggY29uZmlnLnByb3BlcnR5ICk7XHJcbiAgICB9XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY29uZmlnLnNldFZhbHVlICE9PSBudWxsICk7XHJcblxyXG4gICAgdGhpcy5nZXRWYWx1ZSA9IGNvbmZpZy5nZXRWYWx1ZTtcclxuICAgIHRoaXMuc2V0VmFsdWUgPSBjb25maWcuc2V0VmFsdWUhO1xyXG4gICAgdGhpcy5lYXNpbmcgPSBjb25maWcuZWFzaW5nO1xyXG4gICAgdGhpcy5mcm9tID0gY29uZmlnLmZyb207XHJcbiAgICB0aGlzLnRvID0gY29uZmlnLnRvO1xyXG4gICAgdGhpcy5kZWx0YSA9IGNvbmZpZy5kZWx0YTtcclxuICAgIHRoaXMuc3BlZWQgPSBjb25maWcuc3BlZWQ7IC8vIFNhdmVkIGNvbmZpZyB0byBoZWxwIGRldGVybWluZSB0aGUgbGVuZ3RoIG9mIHRoZSBhbmltYXRpb25cclxuICAgIHRoaXMuYmxlbmQgPSBjb25maWcuYmxlbmQ7XHJcbiAgICB0aGlzLmRpc3RhbmNlID0gY29uZmlnLmRpc3RhbmNlO1xyXG4gICAgdGhpcy5hZGQgPSBjb25maWcuYWRkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVmYXVsdCBibGVuZGluZyBmdW5jdGlvbiBmb3IgdGhlIGBibGVuZGAgZnVuY3Rpb24uXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0JMRU5EKCBhOiBudW1iZXIsIGI6IG51bWJlciwgcmF0aW86IG51bWJlciApOiBudW1iZXI7XHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0JMRU5EKCBhOiBDb2xvciwgYjogQ29sb3IsIHJhdGlvOiBudW1iZXIgKTogQ29sb3I7XHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0JMRU5EKCBhOiBWZWN0b3IyLCBiOiBWZWN0b3IyLCByYXRpbzogbnVtYmVyICk6IFZlY3RvcjI7XHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0JMRU5EKCBhOiBWZWN0b3IzLCBiOiBWZWN0b3IzLCByYXRpbzogbnVtYmVyICk6IFZlY3RvcjM7XHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0JMRU5EKCBhOiBWZWN0b3I0LCBiOiBWZWN0b3I0LCByYXRpbzogbnVtYmVyICk6IFZlY3RvcjQ7XHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0JMRU5EPFQgZXh0ZW5kcyBEZWZhdWx0QmxlbmRhYmxlVHlwZTxUPj4oIGE6IFQsIGI6IFQsIHJhdGlvOiBudW1iZXIgKTogVCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBpc0Zpbml0ZSggcmF0aW8gKSAmJiByYXRpbyA+PSAwICYmIHJhdGlvIDw9IDEsIGBJbnZhbGlkIHJhdGlvOiAke3JhdGlvfWAgKTtcclxuXHJcbiAgICBpZiAoIHJhdGlvID09PSAwICkgeyByZXR1cm4gYTsgfVxyXG4gICAgaWYgKCByYXRpbyA9PT0gMSApIHsgcmV0dXJuIGI7IH1cclxuXHJcbiAgICBpZiAoIHR5cGVvZiBhID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgYiA9PT0gJ251bWJlcicgKSB7XHJcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgLSBJdCBjYW4ndCBkZXRlY3Qgd2UncmUgaW4gdGhlIFQgPT09IG51bWJlciBjYXNlLlxyXG4gICAgICByZXR1cm4gYSArICggYiAtIGEgKSAqIHJhdGlvO1xyXG4gICAgfVxyXG4gICAgaWYgKCB0eXBlb2YgYSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGIgPT09ICdvYmplY3QnICYmIHR5cGVvZiBhLmJsZW5kID09PSAnZnVuY3Rpb24nICkge1xyXG4gICAgICByZXR1cm4gYS5ibGVuZCggYiwgcmF0aW8gKTtcclxuICAgIH1cclxuXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoIGBCbGVuZGluZyBub3Qgc3VwcG9ydGVkIGZvcjogJHtKU09OLnN0cmluZ2lmeSggYSApfSwgJHtKU09OLnN0cmluZ2lmeSggYiApfSwgcGFzcyBpbiBhIGJsZW5kIG9wdGlvbmAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERlZmF1bHQgZGlzdGFuY2UgZnVuY3Rpb24gZm9yIHRoZSBgZGlzdGFuY2VgIG9wdGlvbiAodXNlZCBmb3IgdGhlIGBzcGVlZGAgb3B0aW9uKVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgREVGQVVMVF9ESVNUQU5DRSggYTogbnVtYmVyLCBiOiBudW1iZXIgKTogbnVtYmVyO1xyXG4gIHB1YmxpYyBzdGF0aWMgREVGQVVMVF9ESVNUQU5DRSggYTogVmVjdG9yMiwgYjogVmVjdG9yMiApOiBudW1iZXI7XHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0RJU1RBTkNFKCBhOiBWZWN0b3IzLCBiOiBWZWN0b3IzICk6IG51bWJlcjtcclxuICBwdWJsaWMgc3RhdGljIERFRkFVTFRfRElTVEFOQ0UoIGE6IFZlY3RvcjQsIGI6IFZlY3RvcjQgKTogbnVtYmVyO1xyXG4gIHB1YmxpYyBzdGF0aWMgREVGQVVMVF9ESVNUQU5DRTxUIGV4dGVuZHMgRGVmYXVsdERpc3RhbmNlYWJsZVR5cGU8VD4+KCBhOiBULCBiOiBUICk6IG51bWJlciB7XHJcbiAgICBpZiAoIHR5cGVvZiBhID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgYiA9PT0gJ251bWJlcicgKSB7XHJcbiAgICAgIHJldHVybiBNYXRoLmFicyggYSAtIGIgKTtcclxuICAgIH1cclxuICAgIGlmICggdHlwZW9mIGEgPT09ICdvYmplY3QnICYmIHR5cGVvZiBiID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgYS5kaXN0YW5jZSA9PT0gJ2Z1bmN0aW9uJyApIHtcclxuICAgICAgcmV0dXJuIGEuZGlzdGFuY2UoIGIgKTtcclxuICAgIH1cclxuXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoIGBEaXN0YW5jZSAocmVxdWlyZWQgZm9yIHNwZWVkKSBieSBkZWZhdWx0IG5vdCBzdXBwb3J0ZWQgZm9yOiAke0pTT04uc3RyaW5naWZ5KCBhICl9LCAke0pTT04uc3RyaW5naWZ5KCBiICl9LCBwYXNzIGluIGEgZGlzdGFuY2Ugb3B0aW9uYCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVmYXVsdCBhZGRpdGlvbiBmdW5jdGlvbiBmb3IgdGhlIGBhZGRgIG9wdGlvbiAodXNlZCBmb3IgdGhlIGBkZWx0YWAgb3B0aW9uKVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgREVGQVVMVF9BREQoIGE6IG51bWJlciwgYjogbnVtYmVyICk6IG51bWJlcjtcclxuICBwdWJsaWMgc3RhdGljIERFRkFVTFRfQUREKCBhOiBWZWN0b3IyLCBiOiBWZWN0b3IyICk6IFZlY3RvcjI7XHJcbiAgcHVibGljIHN0YXRpYyBERUZBVUxUX0FERCggYTogVmVjdG9yMywgYjogVmVjdG9yMyApOiBWZWN0b3IzO1xyXG4gIHB1YmxpYyBzdGF0aWMgREVGQVVMVF9BREQoIGE6IFZlY3RvcjQsIGI6IFZlY3RvcjQgKTogVmVjdG9yNDtcclxuICBwdWJsaWMgc3RhdGljIERFRkFVTFRfQUREPFQgZXh0ZW5kcyBEZWZhdWx0QWRkYWJsZVR5cGU8VD4+KCBhOiBULCBiOiBUICk6IFQge1xyXG4gICAgaWYgKCB0eXBlb2YgYSA9PT0gJ251bWJlcicgJiYgdHlwZW9mIGIgPT09ICdudW1iZXInICkge1xyXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC0gSXQgY2FuJ3QgZGV0ZWN0IHdlJ3JlIGluIHRoZSBUID09PSBudW1iZXIgY2FzZS5cclxuICAgICAgcmV0dXJuIGEgKyBiO1xyXG4gICAgfVxyXG4gICAgaWYgKCB0eXBlb2YgYSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGIgPT09ICdvYmplY3QnICYmIHR5cGVvZiBhLnBsdXMgPT09ICdmdW5jdGlvbicgKSB7XHJcbiAgICAgIHJldHVybiBhLnBsdXMoIGIgKTtcclxuICAgIH1cclxuXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoIGBBZGRpdGlvbiAocmVxdWlyZWQgZm9yIGRlbHRhKSBieSBkZWZhdWx0IG5vdCBzdXBwb3J0ZWQgZm9yOiAke0pTT04uc3RyaW5naWZ5KCBhICl9LCAke0pTT04uc3RyaW5naWZ5KCBiICl9LCBwYXNzIGluIGFuIGFkZCBvcHRpb25gICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBIZWxwZXIgZnVuY3Rpb24gZm9yIGNyZWF0aW5nIGEgc2V0dGVyIGNsb3N1cmUgZm9yIG9iamVjdFsgYXR0cmlidXRlIF0uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgT0JKRUNUX1NFVDxPYmosIEF0dHIgZXh0ZW5kcyBrZXlvZiBPYmo+KCBvYmplY3Q6IE9iaiwgYXR0cmlidXRlOiBBdHRyICk6ICggdmFsdWU6IE9ialsgQXR0ciBdICkgPT4gdm9pZCB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24oIHZhbHVlICkge1xyXG4gICAgICBvYmplY3RbIGF0dHJpYnV0ZSBdID0gdmFsdWU7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGVscGVyIGZ1bmN0aW9uIGZvciBjcmVhdGluZyBhIGdldHRlciBjbG9zdXJlIGZvciBvYmplY3RbIGF0dHJpYnV0ZSBdLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIE9CSkVDVF9HRVQ8T2JqLCBBdHRyIGV4dGVuZHMga2V5b2YgT2JqPiggb2JqZWN0OiBPYmosIGF0dHJpYnV0ZTogQXR0ciApOiAoKSA9PiBPYmpbIEF0dHIgXSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XHJcbiAgICAgIHJldHVybiBvYmplY3RbIGF0dHJpYnV0ZSBdO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhlbHBlciBmdW5jdGlvbiBmb3IgY3JlYXRpbmcgYSBzZXR0ZXIgY2xvc3VyZSBmb3IgUHJvcGVydGllc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIFBST1BFUlRZX1NFVDxUPiggcHJvcGVydHk6IFRQcm9wZXJ0eTxUPiApOiAoIHZhbHVlOiBUICkgPT4gdm9pZCB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24oIHZhbHVlICkge1xyXG4gICAgICBwcm9wZXJ0eS52YWx1ZSA9IHZhbHVlO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhlbHBlciBmdW5jdGlvbiBmb3IgY3JlYXRpbmcgYSBnZXR0ZXIgY2xvc3VyZSBmb3IgUHJvcGVydGllc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIFBST1BFUlRZX0dFVDxUPiggcHJvcGVydHk6IFRQcm9wZXJ0eTxUPiApOiAoKSA9PiBUIHtcclxuICAgIHJldHVybiBmdW5jdGlvbigpIHtcclxuICAgICAgcmV0dXJuIHByb3BlcnR5LnZhbHVlO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbXB1dGVzIHRoZSBzdGFydGluZyBhbmQgZW5kaW5nIHZhbHVlcyBvZiB0aGlzIHRhcmdldC5cclxuICAgKlxyXG4gICAqIEdlbmVyYWxseSBjYWxsZWQgd2hlbiB0aGUgYW5pbWF0aW9uIGlzIGp1c3QgYWJvdXQgdG8gYmVnaW4sIHNvIGl0IGNhbiBsb29rIHVwIHRoZSBjdXJyZW50IHZhbHVlIGlmIG5lY2Vzc2FyeS5cclxuICAgKi9cclxuICBwdWJsaWMgY29tcHV0ZVN0YXJ0RW5kKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy50byAhPT0gbnVsbCB8fCB0aGlzLmRlbHRhICE9PSBudWxsICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLmZyb20gIT09IG51bGwgfHwgdGhpcy5nZXRWYWx1ZSAhPT0gbnVsbCApO1xyXG5cclxuICAgIHRoaXMuc3RhcnRpbmdWYWx1ZSA9ICggdGhpcy5mcm9tICE9PSBudWxsICkgPyB0aGlzLmZyb20gOiB0aGlzLmdldFZhbHVlISgpO1xyXG4gICAgdGhpcy5lbmRpbmdWYWx1ZSA9ICggdGhpcy50byAhPT0gbnVsbCApID8gdGhpcy50byA6IHRoaXMuYWRkKCB0aGlzLnN0YXJ0aW5nVmFsdWUsIHRoaXMuZGVsdGEhICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHRoZSB2YWx1ZSBvZiB0aGlzIHRhcmdldC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSByYXRpbyAtIEhvdyBmYXIgYWxvbmcgKGZyb20gMCB0byAxKSBpbiB0aGUgYW5pbWF0aW9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGUoIHJhdGlvOiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICAvLyBUaGVzZSBzaG91bGQgYmUgbm9uLW51bGwgYnkgdGhpcyBwb2ludFxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5zZXRWYWx1ZSAhPT0gbnVsbCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5zdGFydGluZ1ZhbHVlICE9PSBudWxsICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLmVuZGluZ1ZhbHVlICE9PSBudWxsICk7XHJcblxyXG4gICAgdGhpcy5zZXRWYWx1ZSggdGhpcy5ibGVuZCggdGhpcy5zdGFydGluZ1ZhbHVlISwgdGhpcy5lbmRpbmdWYWx1ZSEsIHRoaXMuZWFzaW5nLnZhbHVlKCByYXRpbyApICkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFdoZXRoZXIgdGhpcyB0YXJnZXQgY2FuIGRlZmluZSB0aGUgZHVyYXRpb24gb2YgYW4gYW5pbWF0aW9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBoYXNQcmVmZXJyZWREdXJhdGlvbigpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnNwZWVkICE9PSBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgcHJlZmVycmVkIGR1cmF0aW9uIG9mIHRoaXMgdGFyZ2V0IChvciBudWxsIGlmIG5vdCBkZWZpbmVkKS5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0UHJlZmVycmVkRHVyYXRpb24oKTogbnVtYmVyIHwgbnVsbCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLnN0YXJ0aW5nVmFsdWUgIT09IG51bGwgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuZGVsdGEgIT09IG51bGwgKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5zcGVlZCA9PT0gbnVsbCA/IG51bGwgOiB0aGlzLnNwZWVkICogdGhpcy5kaXN0YW5jZSggdGhpcy5zdGFydGluZ1ZhbHVlISwgdGhpcy5kZWx0YSEgKTtcclxuICB9XHJcbn1cclxuXHJcbnR3aXh0LnJlZ2lzdGVyKCAnQW5pbWF0aW9uVGFyZ2V0JywgQW5pbWF0aW9uVGFyZ2V0ICk7XHJcbmV4cG9ydCBkZWZhdWx0IEFuaW1hdGlvblRhcmdldDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLDJCQUEyQjtBQUNoRCxPQUFPQyxZQUFZLE1BQU0sK0JBQStCO0FBS3hELE9BQU9DLFNBQVMsTUFBTSxpQ0FBaUM7QUFHdkQsT0FBT0MsTUFBTSxNQUFNLGFBQWE7QUFDaEMsT0FBT0MsS0FBSyxNQUFNLFlBQVk7O0FBOEc5Qjs7QUFPQSxNQUFNQyxlQUFlLENBQW1CO0VBYXRDO0VBQ1FDLGFBQWEsR0FBYSxJQUFJO0VBQzlCQyxXQUFXLEdBQWEsSUFBSTs7RUFFcEM7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNT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