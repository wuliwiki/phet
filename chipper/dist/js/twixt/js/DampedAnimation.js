// Copyright 2017-2023, University of Colorado Boulder

/**
 * WARNING: PROTOTYPE, see https://github.com/phetsims/twixt/issues/3 before using!
 * Not fully documented or stabilized. May be deleted.
 *
 * Handles a single dimension of damped harmonic-oscillator motion (like a damped spring pulling towards the target).
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import TinyProperty from '../../axon/js/TinyProperty.js';
import DampedHarmonic from '../../dot/js/DampedHarmonic.js';
import optionize from '../../phet-core/js/optionize.js';
import twixt from './twixt.js';
class DampedAnimation {
  timeElapsed = 0;
  constructor(providedOptions) {
    const options = optionize()({
      valueProperty: new TinyProperty(0),
      velocityProperty: new TinyProperty(0),
      damping: 1,
      force: 1,
      targetValue: 0
    }, providedOptions);
    this.valueProperty = options.valueProperty;
    this.velocityProperty = options.velocityProperty;
    this._damping = options.damping;
    this._force = options.force;
    this._targetValue = options.targetValue;
    this.recompute();
  }

  /**
   * Returns the target value
   */
  get targetValue() {
    return this._targetValue;
  }

  /**
   * Change the target value that we are moving toward.
   */
  set targetValue(value) {
    this._targetValue = value;
    this.recompute();
  }

  /**
   * Returns the damping value
   */
  get damping() {
    return this._damping;
  }

  /**
   * Sets the damping value.
   */
  set damping(value) {
    this._damping = value;
    this.recompute();
  }

  /**
   * Returns the force value
   */
  get force() {
    return this._force;
  }

  /**
   * Sets the force value.
   */
  set force(value) {
    this._force = value;
    this.recompute();
  }

  /**
   * On a change, we need to recompute our harmonic (that plots out the motion to the target)
   */
  recompute() {
    this.timeElapsed = 0;
    this.harmonic = new DampedHarmonic(1, Math.sqrt(4 * this._force) * this._damping, this._force, this.valueProperty.value - this._targetValue, this.velocityProperty.value);
  }

  /**
   * Steps the animation forward in time.
   */
  step(dt) {
    this.timeElapsed += dt;
    this.valueProperty.value = this._targetValue + this.harmonic.getValue(this.timeElapsed);
    this.velocityProperty.value = this.harmonic.getDerivative(this.timeElapsed);
  }
}
twixt.register('DampedAnimation', DampedAnimation);
export default DampedAnimation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJUaW55UHJvcGVydHkiLCJEYW1wZWRIYXJtb25pYyIsIm9wdGlvbml6ZSIsInR3aXh0IiwiRGFtcGVkQW5pbWF0aW9uIiwidGltZUVsYXBzZWQiLCJjb25zdHJ1Y3RvciIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ2YWx1ZVByb3BlcnR5IiwidmVsb2NpdHlQcm9wZXJ0eSIsImRhbXBpbmciLCJmb3JjZSIsInRhcmdldFZhbHVlIiwiX2RhbXBpbmciLCJfZm9yY2UiLCJfdGFyZ2V0VmFsdWUiLCJyZWNvbXB1dGUiLCJ2YWx1ZSIsImhhcm1vbmljIiwiTWF0aCIsInNxcnQiLCJzdGVwIiwiZHQiLCJnZXRWYWx1ZSIsImdldERlcml2YXRpdmUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkRhbXBlZEFuaW1hdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNy0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBXQVJOSU5HOiBQUk9UT1RZUEUsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvdHdpeHQvaXNzdWVzLzMgYmVmb3JlIHVzaW5nIVxyXG4gKiBOb3QgZnVsbHkgZG9jdW1lbnRlZCBvciBzdGFiaWxpemVkLiBNYXkgYmUgZGVsZXRlZC5cclxuICpcclxuICogSGFuZGxlcyBhIHNpbmdsZSBkaW1lbnNpb24gb2YgZGFtcGVkIGhhcm1vbmljLW9zY2lsbGF0b3IgbW90aW9uIChsaWtlIGEgZGFtcGVkIHNwcmluZyBwdWxsaW5nIHRvd2FyZHMgdGhlIHRhcmdldCkuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgVGlueVByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvVGlueVByb3BlcnR5LmpzJztcclxuaW1wb3J0IFRQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1RQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBEYW1wZWRIYXJtb25pYyBmcm9tICcuLi8uLi9kb3QvanMvRGFtcGVkSGFybW9uaWMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgdHdpeHQgZnJvbSAnLi90d2l4dC5qcyc7XHJcblxyXG5leHBvcnQgdHlwZSBEYW1wZWRBbmltYXRpb25PcHRpb25zID0ge1xyXG4gIC8vIFRoZSBjdXJyZW50IHZhbHVlL3Bvc2l0aW9uLlxyXG4gIHZhbHVlUHJvcGVydHk/OiBUUHJvcGVydHk8bnVtYmVyPjtcclxuXHJcbiAgLy8gVGhlIGN1cnJlbnQgZGVyaXZhdGl2ZSBvZiB0aGUgdmFsdWVcclxuICB2ZWxvY2l0eVByb3BlcnR5PzogVFByb3BlcnR5PG51bWJlcj47XHJcblxyXG4gIC8vIFByb3BvcnRpb24gb2YgZGFtcGluZyBhcHBsaWVkLCByZWxhdGl2ZSB0byBjcml0aWNhbCBkYW1waW5nLiBUaHVzOlxyXG4gIC8vIC0gZGFtcGluZyA9IDE6IENyaXRpY2FsbHkgZGFtcGVkIChmYXN0ZXN0IGFwcHJvYWNoIHRvd2FyZHMgdGhlIHRhcmdldCB3aXRob3V0IG92ZXJzaG9vdGluZylcclxuICAvLyAtIGRhbXBpbmcgPCAxOiBVbmRlcmRhbXBlZCAod2lsbCBvdmVyc2hvb3QgdGhlIHRhcmdldCB3aXRoIGV4cG9uZW50aWFsbHktZGVjYXlpbmcgb3NjaWxsYXRpb24pXHJcbiAgLy8gLSBkYW1waW5nID4gMTogT3ZlcmRhbXBlZCAod2lsbCBhcHByb2FjaCB3aXRoIGFuIGV4cG9uZW50aWFsIGN1cnZlKVxyXG4gIGRhbXBpbmc/OiBudW1iZXI7XHJcblxyXG4gIC8vIENvZWZmaWNpZW50IHRoYXQgZGV0ZXJtaW5lcyB0aGUgYW1vdW50IG9mIGZvcmNlIFwicHVzaGluZ1wiIHRvd2FyZHMgdGhlIHRhcmdldCAod2lsbCBiZSBwcm9wb3J0aW9uYWxcclxuICAvLyB0byB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgdGFyZ2V0KS5cclxuICBmb3JjZT86IG51bWJlcjtcclxuXHJcbiAgLy8gVGhlIHRhcmdldCB2YWx1ZSB0aGF0IHdlIGFyZSBhbmltYXRpbmcgdG93YXJkcy5cclxuICB0YXJnZXRWYWx1ZT86IG51bWJlcjtcclxufTtcclxuXHJcbmNsYXNzIERhbXBlZEFuaW1hdGlvbiB7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSB2YWx1ZVByb3BlcnR5OiBUUHJvcGVydHk8bnVtYmVyPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgdmVsb2NpdHlQcm9wZXJ0eTogVFByb3BlcnR5PG51bWJlcj47XHJcblxyXG4gIHByaXZhdGUgX2RhbXBpbmc6IG51bWJlcjtcclxuICBwcml2YXRlIF9mb3JjZTogbnVtYmVyO1xyXG4gIHByaXZhdGUgX3RhcmdldFZhbHVlOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBoYXJtb25pYyE6IERhbXBlZEhhcm1vbmljO1xyXG5cclxuICBwdWJsaWMgdGltZUVsYXBzZWQgPSAwO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3ZpZGVkT3B0aW9ucz86IERhbXBlZEFuaW1hdGlvbk9wdGlvbnMgKSB7XHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPERhbXBlZEFuaW1hdGlvbk9wdGlvbnMsIERhbXBlZEFuaW1hdGlvbk9wdGlvbnM+KCkoIHtcclxuICAgICAgdmFsdWVQcm9wZXJ0eTogbmV3IFRpbnlQcm9wZXJ0eSggMCApLFxyXG4gICAgICB2ZWxvY2l0eVByb3BlcnR5OiBuZXcgVGlueVByb3BlcnR5KCAwICksXHJcbiAgICAgIGRhbXBpbmc6IDEsXHJcbiAgICAgIGZvcmNlOiAxLFxyXG4gICAgICB0YXJnZXRWYWx1ZTogMFxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy52YWx1ZVByb3BlcnR5ID0gb3B0aW9ucy52YWx1ZVByb3BlcnR5O1xyXG4gICAgdGhpcy52ZWxvY2l0eVByb3BlcnR5ID0gb3B0aW9ucy52ZWxvY2l0eVByb3BlcnR5O1xyXG5cclxuICAgIHRoaXMuX2RhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmc7XHJcbiAgICB0aGlzLl9mb3JjZSA9IG9wdGlvbnMuZm9yY2U7XHJcbiAgICB0aGlzLl90YXJnZXRWYWx1ZSA9IG9wdGlvbnMudGFyZ2V0VmFsdWU7XHJcblxyXG4gICAgdGhpcy5yZWNvbXB1dGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIHRhcmdldCB2YWx1ZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgdGFyZ2V0VmFsdWUoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLl90YXJnZXRWYWx1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoYW5nZSB0aGUgdGFyZ2V0IHZhbHVlIHRoYXQgd2UgYXJlIG1vdmluZyB0b3dhcmQuXHJcbiAgICovXHJcbiAgcHVibGljIHNldCB0YXJnZXRWYWx1ZSggdmFsdWU6IG51bWJlciApIHtcclxuICAgIHRoaXMuX3RhcmdldFZhbHVlID0gdmFsdWU7XHJcblxyXG4gICAgdGhpcy5yZWNvbXB1dGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIGRhbXBpbmcgdmFsdWVcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGRhbXBpbmcoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLl9kYW1waW5nO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgZGFtcGluZyB2YWx1ZS5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0IGRhbXBpbmcoIHZhbHVlOiBudW1iZXIgKSB7XHJcbiAgICB0aGlzLl9kYW1waW5nID0gdmFsdWU7XHJcblxyXG4gICAgdGhpcy5yZWNvbXB1dGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIGZvcmNlIHZhbHVlXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBmb3JjZSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX2ZvcmNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgZm9yY2UgdmFsdWUuXHJcbiAgICovXHJcbiAgcHVibGljIHNldCBmb3JjZSggdmFsdWU6IG51bWJlciApIHtcclxuICAgIHRoaXMuX2ZvcmNlID0gdmFsdWU7XHJcblxyXG4gICAgdGhpcy5yZWNvbXB1dGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE9uIGEgY2hhbmdlLCB3ZSBuZWVkIHRvIHJlY29tcHV0ZSBvdXIgaGFybW9uaWMgKHRoYXQgcGxvdHMgb3V0IHRoZSBtb3Rpb24gdG8gdGhlIHRhcmdldClcclxuICAgKi9cclxuICBwcml2YXRlIHJlY29tcHV0ZSgpOiB2b2lkIHtcclxuICAgIHRoaXMudGltZUVsYXBzZWQgPSAwO1xyXG4gICAgdGhpcy5oYXJtb25pYyA9IG5ldyBEYW1wZWRIYXJtb25pYyggMSwgTWF0aC5zcXJ0KCA0ICogdGhpcy5fZm9yY2UgKSAqIHRoaXMuX2RhbXBpbmcsIHRoaXMuX2ZvcmNlLCB0aGlzLnZhbHVlUHJvcGVydHkudmFsdWUgLSB0aGlzLl90YXJnZXRWYWx1ZSwgdGhpcy52ZWxvY2l0eVByb3BlcnR5LnZhbHVlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdGVwcyB0aGUgYW5pbWF0aW9uIGZvcndhcmQgaW4gdGltZS5cclxuICAgKi9cclxuICBwdWJsaWMgc3RlcCggZHQ6IG51bWJlciApOiB2b2lkIHtcclxuICAgIHRoaXMudGltZUVsYXBzZWQgKz0gZHQ7XHJcblxyXG4gICAgdGhpcy52YWx1ZVByb3BlcnR5LnZhbHVlID0gdGhpcy5fdGFyZ2V0VmFsdWUgKyB0aGlzLmhhcm1vbmljLmdldFZhbHVlKCB0aGlzLnRpbWVFbGFwc2VkICk7XHJcbiAgICB0aGlzLnZlbG9jaXR5UHJvcGVydHkudmFsdWUgPSB0aGlzLmhhcm1vbmljLmdldERlcml2YXRpdmUoIHRoaXMudGltZUVsYXBzZWQgKTtcclxuICB9XHJcbn1cclxuXHJcbnR3aXh0LnJlZ2lzdGVyKCAnRGFtcGVkQW5pbWF0aW9uJywgRGFtcGVkQW5pbWF0aW9uICk7XHJcbmV4cG9ydCBkZWZhdWx0IERhbXBlZEFuaW1hdGlvbjsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsWUFBWSxNQUFNLCtCQUErQjtBQUV4RCxPQUFPQyxjQUFjLE1BQU0sZ0NBQWdDO0FBQzNELE9BQU9DLFNBQVMsTUFBTSxpQ0FBaUM7QUFDdkQsT0FBT0MsS0FBSyxNQUFNLFlBQVk7QUF1QjlCLE1BQU1DLGVBQWUsQ0FBQztFQVViQyxXQUFXLEdBQUcsQ0FBQztFQUVmQyxXQUFXQSxDQUFFQyxlQUF3QyxFQUFHO0lBQzdELE1BQU1DLE9BQU8sR0FBR04sU0FBUyxDQUFpRCxDQUFDLENBQUU7TUFDM0VPLGFBQWEsRUFBRSxJQUFJVCxZQUFZLENBQUUsQ0FBRSxDQUFDO01BQ3BDVSxnQkFBZ0IsRUFBRSxJQUFJVixZQUFZLENBQUUsQ0FBRSxDQUFDO01BQ3ZDVyxPQUFPLEVBQUUsQ0FBQztNQUNWQyxLQUFLLEVBQUUsQ0FBQztNQUNSQyxXQUFXLEVBQUU7SUFDZixDQUFDLEVBQUVOLGVBQWdCLENBQUM7SUFFcEIsSUFBSSxDQUFDRSxhQUFhLEdBQUdELE9BQU8sQ0FBQ0MsYUFBYTtJQUMxQyxJQUFJLENBQUNDLGdCQUFnQixHQUFHRixPQUFPLENBQUNFLGdCQUFnQjtJQUVoRCxJQUFJLENBQUNJLFFBQVEsR0FBR04sT0FBTyxDQUFDRyxPQUFPO0lBQy9CLElBQUksQ0FBQ0ksTUFBTSxHQUFHUCxPQUFPLENBQUNJLEtBQUs7SUFDM0IsSUFBSSxDQUFDSSxZQUFZLEdBQUdSLE9BQU8sQ0FBQ0ssV0FBVztJQUV2QyxJQUFJLENBQUNJLFNBQVMsQ0FBQyxDQUFDO0VBQ2xCOztFQUVBO0FBQ0Y7QUFDQTtFQUNFLElBQVdKLFdBQVdBLENBQUEsRUFBVztJQUMvQixPQUFPLElBQUksQ0FBQ0csWUFBWTtFQUMxQjs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxJQUFXSCxXQUFXQSxDQUFFSyxLQUFhLEVBQUc7SUFDdEMsSUFBSSxDQUFDRixZQUFZLEdBQUdFLEtBQUs7SUFFekIsSUFBSSxDQUFDRCxTQUFTLENBQUMsQ0FBQztFQUNsQjs7RUFFQTtBQUNGO0FBQ0E7RUFDRSxJQUFXTixPQUFPQSxDQUFBLEVBQVc7SUFDM0IsT0FBTyxJQUFJLENBQUNHLFFBQVE7RUFDdEI7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsSUFBV0gsT0FBT0EsQ0FBRU8sS0FBYSxFQUFHO0lBQ2xDLElBQUksQ0FBQ0osUUFBUSxHQUFHSSxLQUFLO0lBRXJCLElBQUksQ0FBQ0QsU0FBUyxDQUFDLENBQUM7RUFDbEI7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsSUFBV0wsS0FBS0EsQ0FBQSxFQUFXO0lBQ3pCLE9BQU8sSUFBSSxDQUFDRyxNQUFNO0VBQ3BCOztFQUVBO0FBQ0Y7QUFDQTtFQUNFLElBQVdILEtBQUtBLENBQUVNLEtBQWEsRUFBRztJQUNoQyxJQUFJLENBQUNILE1BQU0sR0FBR0csS0FBSztJQUVuQixJQUFJLENBQUNELFNBQVMsQ0FBQyxDQUFDO0VBQ2xCOztFQUVBO0FBQ0Y7QUFDQTtFQUNVQSxTQUFTQSxDQUFBLEVBQVM7SUFDeEIsSUFBSSxDQUFDWixXQUFXLEdBQUcsQ0FBQztJQUNwQixJQUFJLENBQUNjLFFBQVEsR0FBRyxJQUFJbEIsY0FBYyxDQUFFLENBQUMsRUFBRW1CLElBQUksQ0FBQ0MsSUFBSSxDQUFFLENBQUMsR0FBRyxJQUFJLENBQUNOLE1BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQ0QsUUFBUSxFQUFFLElBQUksQ0FBQ0MsTUFBTSxFQUFFLElBQUksQ0FBQ04sYUFBYSxDQUFDUyxLQUFLLEdBQUcsSUFBSSxDQUFDRixZQUFZLEVBQUUsSUFBSSxDQUFDTixnQkFBZ0IsQ0FBQ1EsS0FBTSxDQUFDO0VBQy9LOztFQUVBO0FBQ0Y7QUFDQTtFQUNTSSxJQUFJQSxDQUFFQyxFQUFVLEVBQVM7SUFDOUIsSUFBSSxDQUFDbEIsV0FBVyxJQUFJa0IsRUFBRTtJQUV0QixJQUFJLENBQUNkLGFBQWEsQ0FBQ1MsS0FBSyxHQUFHLElBQUksQ0FBQ0YsWUFBWSxHQUFHLElBQUksQ0FBQ0csUUFBUSxDQUFDSyxRQUFRLENBQUUsSUFBSSxDQUFDbkIsV0FBWSxDQUFDO0lBQ3pGLElBQUksQ0FBQ0ssZ0JBQWdCLENBQUNRLEtBQUssR0FBRyxJQUFJLENBQUNDLFFBQVEsQ0FBQ00sYUFBYSxDQUFFLElBQUksQ0FBQ3BCLFdBQVksQ0FBQztFQUMvRTtBQUNGO0FBRUFGLEtBQUssQ0FBQ3VCLFFBQVEsQ0FBRSxpQkFBaUIsRUFBRXRCLGVBQWdCLENBQUM7QUFDcEQsZUFBZUEsZUFBZSJ9