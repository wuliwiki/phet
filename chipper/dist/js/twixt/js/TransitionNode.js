// Copyright 2023, University of Colorado Boulder

/**
 * Holds content, and can transition to other content with a variety of animations. During a transition, there is always
 * the "from" content that animates out, and the "to" content that animates in.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import { Shape } from '../../kite/js/imports.js';
import optionize from '../../phet-core/js/optionize.js';
import { Node } from '../../scenery/js/imports.js';
import Transition from './Transition.js';
import twixt from './twixt.js';
class TransitionNode extends Node {
  // When animating, it is the content that we are animating away from. Otherwise, it holds the main content node.

  // Holds the content that we are animating towards.
  toContent = null;

  // If we are animating, this will be non-null

  /**
   * NOTE: The content's transform/pickability/visibility/opacity/clipArea/etc. can be modified, and will be reset to
   * the default value
   *
   * @param transitionBoundsProperty - Use visibleBoundsProperty (from the ScreenView) for full-screen transitions.
   *                                   Generally TransitionNode assumes all content, when it has no transform applied,
   *                                   is meant to by laid out within these bounds.
   * @param [options]
   */
  constructor(transitionBoundsProperty, providedOptions) {
    const options = optionize()({
      content: null,
      useBoundsClip: true,
      cachedNodes: []
    }, providedOptions);
    assert && assert(!options.children, 'Children should not be specified, since cachedNodes will be applied');
    super();
    this.transitionBoundsProperty = transitionBoundsProperty;
    this.useBoundsClip = options.useBoundsClip;
    this.cachedNodes = options.cachedNodes;
    this.fromContent = options.content;
    this.children = this.cachedNodes;
    for (let i = 0; i < this.cachedNodes.length; i++) {
      const cachedNode = this.cachedNodes[i];
      cachedNode.visible = cachedNode === this.fromContent;
    }
    if (this.fromContent && !_.includes(this.cachedNodes, this.fromContent)) {
      this.addChild(this.fromContent);
    }
    this.transition = null;
    this.paddingNode = new Node();
    this.addChild(this.paddingNode);
    this.boundsListener = this.onBoundsChange.bind(this);
    this.transitionBoundsProperty.link(this.boundsListener);
    this.mutate(options);
  }

  /**
   * Steps forward in time, animating the transition.
   */
  step(dt) {
    this.transition && this.transition.step(dt);
  }

  /**
   * Interrupts the transition, ending it and resetting the animated values.
   */
  interrupt() {
    this.transition && this.transition.stop();
  }

  /**
   * Called on bounds changes.
   */
  onBoundsChange(bounds) {
    this.interrupt();
    if (this.useBoundsClip) {
      this.clipArea = Shape.bounds(bounds);
    }

    // Provide a localBounds override so that we take up at least the provided bounds. This makes layout easier so
    // that the TransitionNode always provides consistent bounds with clipping. See
    // https://github.com/phetsims/twixt/issues/15.
    this.paddingNode.localBounds = bounds;
  }

  /**
   * Start a transition to replace our content with the new content, using Transition.slideLeft.
   *
   * @param content - If null, the current content will still animate out (with nothing replacing it).
   * @param config - Passed as config to the Animation. Usually a duration should be included.
   * @returns - Available to add end listeners, etc.
   */
  slideLeftTo(content, config) {
    this.interrupt();
    return this.startTransition(content, Transition.slideLeft(this.transitionBoundsProperty.value, this.fromContent, content, config));
  }

  /**
   * Start a transition to replace our content with the new content, using Transition.slideRight.
   *
   * @param content - If null, the current content will still animate out (with nothing replacing it).
   * @param config - Passed as config to the Animation. Usually a duration should be included.
   * @returns - Available to add end listeners, etc.
   */
  slideRightTo(content, config) {
    this.interrupt();
    return this.startTransition(content, Transition.slideRight(this.transitionBoundsProperty.value, this.fromContent, content, config));
  }

  /**
   * Start a transition to replace our content with the new content, using Transition.slideUp.
   *
   * @param content - If null, the current content will still animate out (with nothing replacing it).
   * @param config - Passed as config to the Animation. Usually a duration should be included.
   * @returns - Available to add end listeners, etc.
   */
  slideUpTo(content, config) {
    this.interrupt();
    return this.startTransition(content, Transition.slideUp(this.transitionBoundsProperty.value, this.fromContent, content, config));
  }

  /**
   * Start a transition to replace our content with the new content, using Transition.slideDown.
   *
   * @param content - If null, the current content will still animate out (with nothing replacing it).
   * @param config - Passed as config to the Animation. Usually a duration should be included.
   * @returns - Available to add end listeners, etc.
   */
  slideDownTo(content, config) {
    this.interrupt();
    return this.startTransition(content, Transition.slideDown(this.transitionBoundsProperty.value, this.fromContent, content, config));
  }

  /**
   * Start a transition to replace our content with the new content, using Transition.wipeLeft.
   *
   * @param content - If null, the current content will still animate out (with nothing replacing it).
   * @param config - Passed as config to the Animation. Usually a duration should be included.
   * @returns - Available to add end listeners, etc.
   */
  wipeLeftTo(content, config) {
    this.interrupt();
    return this.startTransition(content, Transition.wipeLeft(this.transitionBoundsProperty.value, this.fromContent, content, config));
  }

  /**
   * Start a transition to replace our content with the new content, using Transition.wipeRight.
   *
   * @param content - If null, the current content will still animate out (with nothing replacing it).
   * @param config - Passed as config to the Animation. Usually a duration should be included.
   * @returns - Available to add end listeners, etc.
   */
  wipeRightTo(content, config) {
    this.interrupt();
    return this.startTransition(content, Transition.wipeRight(this.transitionBoundsProperty.value, this.fromContent, content, config));
  }

  /**
   * Start a transition to replace our content with the new content, using Transition.wipeUp.
   *
   * @param content - If null, the current content will still animate out (with nothing replacing it).
   * @param config - Passed as config to the Animation. Usually a duration should be included.
   * @returns - Available to add end listeners, etc.
   */
  wipeUpTo(content, config) {
    this.interrupt();
    return this.startTransition(content, Transition.wipeUp(this.transitionBoundsProperty.value, this.fromContent, content, config));
  }

  /**
   * Start a transition to replace our content with the new content, using Transition.wipeDown.
   *
   * @param content - If null, the current content will still animate out (with nothing replacing it).
   * @param config - Passed as config to the Animation. Usually a duration should be included.
   * @returns - Available to add end listeners, etc.
   */
  wipeDownTo(content, config) {
    this.interrupt();
    return this.startTransition(content, Transition.wipeDown(this.transitionBoundsProperty.value, this.fromContent, content, config));
  }

  /**
   * Start a transition to replace our content with the new content, using Transition.dissolve.
   *
   * @param content - If null, the current content will still animate out (with nothing replacing it).
   * @param config - Passed as config to the Animation. Usually a duration should be included.
   * @returns - Available to add end listeners, etc.
   */
  dissolveTo(content, config) {
    this.interrupt();
    return this.startTransition(content, Transition.dissolve(this.fromContent, content, config));
  }

  /**
   * Starts a transition, and hooks up a listener to handle state changes when it ends.
   *
   * @returns - Available to add end listeners, etc. (chained)
   */
  startTransition(content, transition) {
    // Stop animating if we were before
    this.interrupt();
    this.toContent = content;
    if (content) {
      if (_.includes(this.cachedNodes, content)) {
        content.visible = true;
      } else {
        this.addChild(content);
      }
      assert && assert(this.hasChild(content), 'Should always have the content as a child at the start of a transition');
    }
    this.transition = transition;

    // Simplifies many things if the user can't mess with things while animating.
    if (this.fromContent) {
      this.fromContent.pickable = false;
    }
    if (this.toContent) {
      this.toContent.pickable = false;
    }
    transition.endedEmitter.addListener(() => {
      if (this.fromContent) {
        this.fromContent.pickable = null;
      }
      if (this.toContent) {
        this.toContent.pickable = null;
      }
      this.transition = null;
      if (this.fromContent) {
        if (_.includes(this.cachedNodes, this.fromContent)) {
          this.fromContent.visible = false;
        } else {
          this.removeChild(this.fromContent);
        }
        assert && assert(this.hasChild(this.fromContent) === _.includes(this.cachedNodes, this.fromContent), 'Should have removed the child if it is not included in our cachedNodes');
      }
      this.fromContent = this.toContent;
      this.toContent = null;
    });
    transition.start();
    return transition;
  }
  dispose() {
    this.interrupt();
    this.transitionBoundsProperty.unlink(this.boundsListener);
    super.dispose();
  }
}
twixt.register('TransitionNode', TransitionNode);
export default TransitionNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaGFwZSIsIm9wdGlvbml6ZSIsIk5vZGUiLCJUcmFuc2l0aW9uIiwidHdpeHQiLCJUcmFuc2l0aW9uTm9kZSIsInRvQ29udGVudCIsImNvbnN0cnVjdG9yIiwidHJhbnNpdGlvbkJvdW5kc1Byb3BlcnR5IiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImNvbnRlbnQiLCJ1c2VCb3VuZHNDbGlwIiwiY2FjaGVkTm9kZXMiLCJhc3NlcnQiLCJjaGlsZHJlbiIsImZyb21Db250ZW50IiwiaSIsImxlbmd0aCIsImNhY2hlZE5vZGUiLCJ2aXNpYmxlIiwiXyIsImluY2x1ZGVzIiwiYWRkQ2hpbGQiLCJ0cmFuc2l0aW9uIiwicGFkZGluZ05vZGUiLCJib3VuZHNMaXN0ZW5lciIsIm9uQm91bmRzQ2hhbmdlIiwiYmluZCIsImxpbmsiLCJtdXRhdGUiLCJzdGVwIiwiZHQiLCJpbnRlcnJ1cHQiLCJzdG9wIiwiYm91bmRzIiwiY2xpcEFyZWEiLCJsb2NhbEJvdW5kcyIsInNsaWRlTGVmdFRvIiwiY29uZmlnIiwic3RhcnRUcmFuc2l0aW9uIiwic2xpZGVMZWZ0IiwidmFsdWUiLCJzbGlkZVJpZ2h0VG8iLCJzbGlkZVJpZ2h0Iiwic2xpZGVVcFRvIiwic2xpZGVVcCIsInNsaWRlRG93blRvIiwic2xpZGVEb3duIiwid2lwZUxlZnRUbyIsIndpcGVMZWZ0Iiwid2lwZVJpZ2h0VG8iLCJ3aXBlUmlnaHQiLCJ3aXBlVXBUbyIsIndpcGVVcCIsIndpcGVEb3duVG8iLCJ3aXBlRG93biIsImRpc3NvbHZlVG8iLCJkaXNzb2x2ZSIsImhhc0NoaWxkIiwicGlja2FibGUiLCJlbmRlZEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsInJlbW92ZUNoaWxkIiwic3RhcnQiLCJkaXNwb3NlIiwidW5saW5rIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJUcmFuc2l0aW9uTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogSG9sZHMgY29udGVudCwgYW5kIGNhbiB0cmFuc2l0aW9uIHRvIG90aGVyIGNvbnRlbnQgd2l0aCBhIHZhcmlldHkgb2YgYW5pbWF0aW9ucy4gRHVyaW5nIGEgdHJhbnNpdGlvbiwgdGhlcmUgaXMgYWx3YXlzXHJcbiAqIHRoZSBcImZyb21cIiBjb250ZW50IHRoYXQgYW5pbWF0ZXMgb3V0LCBhbmQgdGhlIFwidG9cIiBjb250ZW50IHRoYXQgYW5pbWF0ZXMgaW4uXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIE5vZGVPcHRpb25zIH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFRyYW5zaXRpb24sIHsgRGlzc29sdmVUcmFuc2l0aW9uT3B0aW9ucywgU2xpZGVUcmFuc2l0aW9uT3B0aW9ucywgV2lwZVRyYW5zaXRpb25PcHRpb25zIH0gZnJvbSAnLi9UcmFuc2l0aW9uLmpzJztcclxuaW1wb3J0IHR3aXh0IGZyb20gJy4vdHdpeHQuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICAvLyBPcHRpb25hbGx5IG1heSBoYXZlIGluaXRpYWwgY29udGVudFxyXG4gIGNvbnRlbnQ/OiBOb2RlIHwgbnVsbDtcclxuXHJcbiAgLy8gSWYgdHJ1ZSwgYSBjbGlwIGFyZWEgd2lsbCBiZSBzZXQgdG8gdGhlIHZhbHVlIG9mIHRoZSB0cmFuc2l0aW9uQm91bmRzUHJvcGVydHkgc28gdGhhdCBvdXRzaWRlIGNvbnRlbnQgd29uJ3QgYmVcclxuICAvLyBzaG93bi5cclxuICB1c2VCb3VuZHNDbGlwPzogYm9vbGVhbjtcclxuXHJcbiAgLy8gQW55IG5vZGUgc3BlY2lmaWVkIGluIHRoaXMgYXJyYXkgd2lsbCBiZSBhZGRlZCBhcyBhIHBlcm1hbmVudCBjaGlsZCBpbnRlcm5hbGx5LCBzbyB0aGF0IHRyYW5zaXRpb25zIHRvL2Zyb20gaXRcclxuICAvLyBkb2Vzbid0IGluY3VyIGhpZ2hlciBwZXJmb3JtYW5jZSBwZW5hbHRpZXMuIEl0IHdpbGwgaW5zdGVhZCBqdXN0IGJlIGludmlzaWJsZSB3aGVuIG5vdCBpbnZvbHZlZCBpbiBhIHRyYW5zaXRpb24uXHJcbiAgLy8gUGVyZm9ybWFuY2UgaXNzdWVzIHdlcmUgaW5pdGlhbGx5IG5vdGVkIGluXHJcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2VxdWFsaXR5LWV4cGxvcmVyL2lzc3Vlcy83NS4gQWRkaXRpb25hbCBub3RlcyBpblxyXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy90d2l4dC9pc3N1ZXMvMTcuXHJcbiAgY2FjaGVkTm9kZXM/OiBOb2RlW107XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBUcmFuc2l0aW9uTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFN0cmljdE9taXQ8Tm9kZU9wdGlvbnMsICdjaGlsZHJlbic+O1xyXG5cclxuY2xhc3MgVHJhbnNpdGlvbk5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSB0cmFuc2l0aW9uQm91bmRzUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PEJvdW5kczI+O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdXNlQm91bmRzQ2xpcDogYm9vbGVhbjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNhY2hlZE5vZGVzOiBOb2RlW107XHJcblxyXG4gIC8vIFdoZW4gYW5pbWF0aW5nLCBpdCBpcyB0aGUgY29udGVudCB0aGF0IHdlIGFyZSBhbmltYXRpbmcgYXdheSBmcm9tLiBPdGhlcndpc2UsIGl0IGhvbGRzIHRoZSBtYWluIGNvbnRlbnQgbm9kZS5cclxuICBwcml2YXRlIGZyb21Db250ZW50OiBOb2RlIHwgbnVsbDtcclxuXHJcbiAgLy8gSG9sZHMgdGhlIGNvbnRlbnQgdGhhdCB3ZSBhcmUgYW5pbWF0aW5nIHRvd2FyZHMuXHJcbiAgcHJpdmF0ZSB0b0NvbnRlbnQ6IE5vZGUgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgLy8gSWYgd2UgYXJlIGFuaW1hdGluZywgdGhpcyB3aWxsIGJlIG5vbi1udWxsXHJcbiAgcHJpdmF0ZSB0cmFuc2l0aW9uOiBUcmFuc2l0aW9uIHwgbnVsbDtcclxuXHJcbiAgcHJpdmF0ZSBwYWRkaW5nTm9kZTogTm9kZTtcclxuICBwcml2YXRlIGJvdW5kc0xpc3RlbmVyOiAoIGJvdW5kczogQm91bmRzMiApID0+IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIE5PVEU6IFRoZSBjb250ZW50J3MgdHJhbnNmb3JtL3BpY2thYmlsaXR5L3Zpc2liaWxpdHkvb3BhY2l0eS9jbGlwQXJlYS9ldGMuIGNhbiBiZSBtb2RpZmllZCwgYW5kIHdpbGwgYmUgcmVzZXQgdG9cclxuICAgKiB0aGUgZGVmYXVsdCB2YWx1ZVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHRyYW5zaXRpb25Cb3VuZHNQcm9wZXJ0eSAtIFVzZSB2aXNpYmxlQm91bmRzUHJvcGVydHkgKGZyb20gdGhlIFNjcmVlblZpZXcpIGZvciBmdWxsLXNjcmVlbiB0cmFuc2l0aW9ucy5cclxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR2VuZXJhbGx5IFRyYW5zaXRpb25Ob2RlIGFzc3VtZXMgYWxsIGNvbnRlbnQsIHdoZW4gaXQgaGFzIG5vIHRyYW5zZm9ybSBhcHBsaWVkLFxyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpcyBtZWFudCB0byBieSBsYWlkIG91dCB3aXRoaW4gdGhlc2UgYm91bmRzLlxyXG4gICAqIEBwYXJhbSBbb3B0aW9uc11cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHRyYW5zaXRpb25Cb3VuZHNQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Qm91bmRzMj4sIHByb3ZpZGVkT3B0aW9ucz86IFRyYW5zaXRpb25Ob2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFRyYW5zaXRpb25Ob2RlT3B0aW9ucywgU2VsZk9wdGlvbnMsIE5vZGVPcHRpb25zPigpKCB7XHJcbiAgICAgIGNvbnRlbnQ6IG51bGwsXHJcbiAgICAgIHVzZUJvdW5kc0NsaXA6IHRydWUsXHJcbiAgICAgIGNhY2hlZE5vZGVzOiBbXVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggIW9wdGlvbnMuY2hpbGRyZW4sICdDaGlsZHJlbiBzaG91bGQgbm90IGJlIHNwZWNpZmllZCwgc2luY2UgY2FjaGVkTm9kZXMgd2lsbCBiZSBhcHBsaWVkJyApO1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy50cmFuc2l0aW9uQm91bmRzUHJvcGVydHkgPSB0cmFuc2l0aW9uQm91bmRzUHJvcGVydHk7XHJcbiAgICB0aGlzLnVzZUJvdW5kc0NsaXAgPSBvcHRpb25zLnVzZUJvdW5kc0NsaXA7XHJcbiAgICB0aGlzLmNhY2hlZE5vZGVzID0gb3B0aW9ucy5jYWNoZWROb2RlcztcclxuICAgIHRoaXMuZnJvbUNvbnRlbnQgPSBvcHRpb25zLmNvbnRlbnQ7XHJcblxyXG4gICAgdGhpcy5jaGlsZHJlbiA9IHRoaXMuY2FjaGVkTm9kZXM7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmNhY2hlZE5vZGVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBjb25zdCBjYWNoZWROb2RlID0gdGhpcy5jYWNoZWROb2Rlc1sgaSBdO1xyXG4gICAgICBjYWNoZWROb2RlLnZpc2libGUgPSBjYWNoZWROb2RlID09PSB0aGlzLmZyb21Db250ZW50O1xyXG4gICAgfVxyXG5cclxuICAgIGlmICggdGhpcy5mcm9tQ29udGVudCAmJiAhXy5pbmNsdWRlcyggdGhpcy5jYWNoZWROb2RlcywgdGhpcy5mcm9tQ29udGVudCApICkge1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCB0aGlzLmZyb21Db250ZW50ICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy50cmFuc2l0aW9uID0gbnVsbDtcclxuXHJcbiAgICB0aGlzLnBhZGRpbmdOb2RlID0gbmV3IE5vZGUoKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMucGFkZGluZ05vZGUgKTtcclxuXHJcbiAgICB0aGlzLmJvdW5kc0xpc3RlbmVyID0gdGhpcy5vbkJvdW5kc0NoYW5nZS5iaW5kKCB0aGlzICk7XHJcbiAgICB0aGlzLnRyYW5zaXRpb25Cb3VuZHNQcm9wZXJ0eS5saW5rKCB0aGlzLmJvdW5kc0xpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0ZXBzIGZvcndhcmQgaW4gdGltZSwgYW5pbWF0aW5nIHRoZSB0cmFuc2l0aW9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGVwKCBkdDogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgdGhpcy50cmFuc2l0aW9uICYmIHRoaXMudHJhbnNpdGlvbi5zdGVwKCBkdCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSW50ZXJydXB0cyB0aGUgdHJhbnNpdGlvbiwgZW5kaW5nIGl0IGFuZCByZXNldHRpbmcgdGhlIGFuaW1hdGVkIHZhbHVlcy5cclxuICAgKi9cclxuICBwdWJsaWMgaW50ZXJydXB0KCk6IHZvaWQge1xyXG4gICAgdGhpcy50cmFuc2l0aW9uICYmIHRoaXMudHJhbnNpdGlvbi5zdG9wKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxsZWQgb24gYm91bmRzIGNoYW5nZXMuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBvbkJvdW5kc0NoYW5nZSggYm91bmRzOiBCb3VuZHMyICk6IHZvaWQge1xyXG4gICAgdGhpcy5pbnRlcnJ1cHQoKTtcclxuXHJcbiAgICBpZiAoIHRoaXMudXNlQm91bmRzQ2xpcCApIHtcclxuICAgICAgdGhpcy5jbGlwQXJlYSA9IFNoYXBlLmJvdW5kcyggYm91bmRzICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUHJvdmlkZSBhIGxvY2FsQm91bmRzIG92ZXJyaWRlIHNvIHRoYXQgd2UgdGFrZSB1cCBhdCBsZWFzdCB0aGUgcHJvdmlkZWQgYm91bmRzLiBUaGlzIG1ha2VzIGxheW91dCBlYXNpZXIgc29cclxuICAgIC8vIHRoYXQgdGhlIFRyYW5zaXRpb25Ob2RlIGFsd2F5cyBwcm92aWRlcyBjb25zaXN0ZW50IGJvdW5kcyB3aXRoIGNsaXBwaW5nLiBTZWVcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy90d2l4dC9pc3N1ZXMvMTUuXHJcbiAgICB0aGlzLnBhZGRpbmdOb2RlLmxvY2FsQm91bmRzID0gYm91bmRzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgYSB0cmFuc2l0aW9uIHRvIHJlcGxhY2Ugb3VyIGNvbnRlbnQgd2l0aCB0aGUgbmV3IGNvbnRlbnQsIHVzaW5nIFRyYW5zaXRpb24uc2xpZGVMZWZ0LlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGNvbnRlbnQgLSBJZiBudWxsLCB0aGUgY3VycmVudCBjb250ZW50IHdpbGwgc3RpbGwgYW5pbWF0ZSBvdXQgKHdpdGggbm90aGluZyByZXBsYWNpbmcgaXQpLlxyXG4gICAqIEBwYXJhbSBjb25maWcgLSBQYXNzZWQgYXMgY29uZmlnIHRvIHRoZSBBbmltYXRpb24uIFVzdWFsbHkgYSBkdXJhdGlvbiBzaG91bGQgYmUgaW5jbHVkZWQuXHJcbiAgICogQHJldHVybnMgLSBBdmFpbGFibGUgdG8gYWRkIGVuZCBsaXN0ZW5lcnMsIGV0Yy5cclxuICAgKi9cclxuICBwdWJsaWMgc2xpZGVMZWZ0VG8oIGNvbnRlbnQ6IE5vZGUgfCBudWxsLCBjb25maWc/OiBTbGlkZVRyYW5zaXRpb25PcHRpb25zICk6IFRyYW5zaXRpb24ge1xyXG4gICAgdGhpcy5pbnRlcnJ1cHQoKTtcclxuICAgIHJldHVybiB0aGlzLnN0YXJ0VHJhbnNpdGlvbiggY29udGVudCwgVHJhbnNpdGlvbi5zbGlkZUxlZnQoIHRoaXMudHJhbnNpdGlvbkJvdW5kc1Byb3BlcnR5LnZhbHVlLCB0aGlzLmZyb21Db250ZW50LCBjb250ZW50LCBjb25maWcgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgYSB0cmFuc2l0aW9uIHRvIHJlcGxhY2Ugb3VyIGNvbnRlbnQgd2l0aCB0aGUgbmV3IGNvbnRlbnQsIHVzaW5nIFRyYW5zaXRpb24uc2xpZGVSaWdodC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBjb250ZW50IC0gSWYgbnVsbCwgdGhlIGN1cnJlbnQgY29udGVudCB3aWxsIHN0aWxsIGFuaW1hdGUgb3V0ICh3aXRoIG5vdGhpbmcgcmVwbGFjaW5nIGl0KS5cclxuICAgKiBAcGFyYW0gY29uZmlnIC0gUGFzc2VkIGFzIGNvbmZpZyB0byB0aGUgQW5pbWF0aW9uLiBVc3VhbGx5IGEgZHVyYXRpb24gc2hvdWxkIGJlIGluY2x1ZGVkLlxyXG4gICAqIEByZXR1cm5zIC0gQXZhaWxhYmxlIHRvIGFkZCBlbmQgbGlzdGVuZXJzLCBldGMuXHJcbiAgICovXHJcbiAgcHVibGljIHNsaWRlUmlnaHRUbyggY29udGVudDogTm9kZSB8IG51bGwsIGNvbmZpZz86IFNsaWRlVHJhbnNpdGlvbk9wdGlvbnMgKTogVHJhbnNpdGlvbiB7XHJcbiAgICB0aGlzLmludGVycnVwdCgpO1xyXG4gICAgcmV0dXJuIHRoaXMuc3RhcnRUcmFuc2l0aW9uKCBjb250ZW50LCBUcmFuc2l0aW9uLnNsaWRlUmlnaHQoIHRoaXMudHJhbnNpdGlvbkJvdW5kc1Byb3BlcnR5LnZhbHVlLCB0aGlzLmZyb21Db250ZW50LCBjb250ZW50LCBjb25maWcgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgYSB0cmFuc2l0aW9uIHRvIHJlcGxhY2Ugb3VyIGNvbnRlbnQgd2l0aCB0aGUgbmV3IGNvbnRlbnQsIHVzaW5nIFRyYW5zaXRpb24uc2xpZGVVcC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBjb250ZW50IC0gSWYgbnVsbCwgdGhlIGN1cnJlbnQgY29udGVudCB3aWxsIHN0aWxsIGFuaW1hdGUgb3V0ICh3aXRoIG5vdGhpbmcgcmVwbGFjaW5nIGl0KS5cclxuICAgKiBAcGFyYW0gY29uZmlnIC0gUGFzc2VkIGFzIGNvbmZpZyB0byB0aGUgQW5pbWF0aW9uLiBVc3VhbGx5IGEgZHVyYXRpb24gc2hvdWxkIGJlIGluY2x1ZGVkLlxyXG4gICAqIEByZXR1cm5zIC0gQXZhaWxhYmxlIHRvIGFkZCBlbmQgbGlzdGVuZXJzLCBldGMuXHJcbiAgICovXHJcbiAgcHVibGljIHNsaWRlVXBUbyggY29udGVudDogTm9kZSB8IG51bGwsIGNvbmZpZz86IFNsaWRlVHJhbnNpdGlvbk9wdGlvbnMgKTogVHJhbnNpdGlvbiB7XHJcbiAgICB0aGlzLmludGVycnVwdCgpO1xyXG4gICAgcmV0dXJuIHRoaXMuc3RhcnRUcmFuc2l0aW9uKCBjb250ZW50LCBUcmFuc2l0aW9uLnNsaWRlVXAoIHRoaXMudHJhbnNpdGlvbkJvdW5kc1Byb3BlcnR5LnZhbHVlLCB0aGlzLmZyb21Db250ZW50LCBjb250ZW50LCBjb25maWcgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgYSB0cmFuc2l0aW9uIHRvIHJlcGxhY2Ugb3VyIGNvbnRlbnQgd2l0aCB0aGUgbmV3IGNvbnRlbnQsIHVzaW5nIFRyYW5zaXRpb24uc2xpZGVEb3duLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGNvbnRlbnQgLSBJZiBudWxsLCB0aGUgY3VycmVudCBjb250ZW50IHdpbGwgc3RpbGwgYW5pbWF0ZSBvdXQgKHdpdGggbm90aGluZyByZXBsYWNpbmcgaXQpLlxyXG4gICAqIEBwYXJhbSBjb25maWcgLSBQYXNzZWQgYXMgY29uZmlnIHRvIHRoZSBBbmltYXRpb24uIFVzdWFsbHkgYSBkdXJhdGlvbiBzaG91bGQgYmUgaW5jbHVkZWQuXHJcbiAgICogQHJldHVybnMgLSBBdmFpbGFibGUgdG8gYWRkIGVuZCBsaXN0ZW5lcnMsIGV0Yy5cclxuICAgKi9cclxuICBwdWJsaWMgc2xpZGVEb3duVG8oIGNvbnRlbnQ6IE5vZGUgfCBudWxsLCBjb25maWc/OiBTbGlkZVRyYW5zaXRpb25PcHRpb25zICk6IFRyYW5zaXRpb24ge1xyXG4gICAgdGhpcy5pbnRlcnJ1cHQoKTtcclxuICAgIHJldHVybiB0aGlzLnN0YXJ0VHJhbnNpdGlvbiggY29udGVudCwgVHJhbnNpdGlvbi5zbGlkZURvd24oIHRoaXMudHJhbnNpdGlvbkJvdW5kc1Byb3BlcnR5LnZhbHVlLCB0aGlzLmZyb21Db250ZW50LCBjb250ZW50LCBjb25maWcgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgYSB0cmFuc2l0aW9uIHRvIHJlcGxhY2Ugb3VyIGNvbnRlbnQgd2l0aCB0aGUgbmV3IGNvbnRlbnQsIHVzaW5nIFRyYW5zaXRpb24ud2lwZUxlZnQuXHJcbiAgICpcclxuICAgKiBAcGFyYW0gY29udGVudCAtIElmIG51bGwsIHRoZSBjdXJyZW50IGNvbnRlbnQgd2lsbCBzdGlsbCBhbmltYXRlIG91dCAod2l0aCBub3RoaW5nIHJlcGxhY2luZyBpdCkuXHJcbiAgICogQHBhcmFtIGNvbmZpZyAtIFBhc3NlZCBhcyBjb25maWcgdG8gdGhlIEFuaW1hdGlvbi4gVXN1YWxseSBhIGR1cmF0aW9uIHNob3VsZCBiZSBpbmNsdWRlZC5cclxuICAgKiBAcmV0dXJucyAtIEF2YWlsYWJsZSB0byBhZGQgZW5kIGxpc3RlbmVycywgZXRjLlxyXG4gICAqL1xyXG4gIHB1YmxpYyB3aXBlTGVmdFRvKCBjb250ZW50OiBOb2RlIHwgbnVsbCwgY29uZmlnPzogV2lwZVRyYW5zaXRpb25PcHRpb25zICk6IFRyYW5zaXRpb24ge1xyXG4gICAgdGhpcy5pbnRlcnJ1cHQoKTtcclxuICAgIHJldHVybiB0aGlzLnN0YXJ0VHJhbnNpdGlvbiggY29udGVudCwgVHJhbnNpdGlvbi53aXBlTGVmdCggdGhpcy50cmFuc2l0aW9uQm91bmRzUHJvcGVydHkudmFsdWUsIHRoaXMuZnJvbUNvbnRlbnQsIGNvbnRlbnQsIGNvbmZpZyApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdGFydCBhIHRyYW5zaXRpb24gdG8gcmVwbGFjZSBvdXIgY29udGVudCB3aXRoIHRoZSBuZXcgY29udGVudCwgdXNpbmcgVHJhbnNpdGlvbi53aXBlUmlnaHQuXHJcbiAgICpcclxuICAgKiBAcGFyYW0gY29udGVudCAtIElmIG51bGwsIHRoZSBjdXJyZW50IGNvbnRlbnQgd2lsbCBzdGlsbCBhbmltYXRlIG91dCAod2l0aCBub3RoaW5nIHJlcGxhY2luZyBpdCkuXHJcbiAgICogQHBhcmFtIGNvbmZpZyAtIFBhc3NlZCBhcyBjb25maWcgdG8gdGhlIEFuaW1hdGlvbi4gVXN1YWxseSBhIGR1cmF0aW9uIHNob3VsZCBiZSBpbmNsdWRlZC5cclxuICAgKiBAcmV0dXJucyAtIEF2YWlsYWJsZSB0byBhZGQgZW5kIGxpc3RlbmVycywgZXRjLlxyXG4gICAqL1xyXG4gIHB1YmxpYyB3aXBlUmlnaHRUbyggY29udGVudDogTm9kZSB8IG51bGwsIGNvbmZpZz86IFdpcGVUcmFuc2l0aW9uT3B0aW9ucyApOiBUcmFuc2l0aW9uIHtcclxuICAgIHRoaXMuaW50ZXJydXB0KCk7XHJcbiAgICByZXR1cm4gdGhpcy5zdGFydFRyYW5zaXRpb24oIGNvbnRlbnQsIFRyYW5zaXRpb24ud2lwZVJpZ2h0KCB0aGlzLnRyYW5zaXRpb25Cb3VuZHNQcm9wZXJ0eS52YWx1ZSwgdGhpcy5mcm9tQ29udGVudCwgY29udGVudCwgY29uZmlnICkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0YXJ0IGEgdHJhbnNpdGlvbiB0byByZXBsYWNlIG91ciBjb250ZW50IHdpdGggdGhlIG5ldyBjb250ZW50LCB1c2luZyBUcmFuc2l0aW9uLndpcGVVcC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBjb250ZW50IC0gSWYgbnVsbCwgdGhlIGN1cnJlbnQgY29udGVudCB3aWxsIHN0aWxsIGFuaW1hdGUgb3V0ICh3aXRoIG5vdGhpbmcgcmVwbGFjaW5nIGl0KS5cclxuICAgKiBAcGFyYW0gY29uZmlnIC0gUGFzc2VkIGFzIGNvbmZpZyB0byB0aGUgQW5pbWF0aW9uLiBVc3VhbGx5IGEgZHVyYXRpb24gc2hvdWxkIGJlIGluY2x1ZGVkLlxyXG4gICAqIEByZXR1cm5zIC0gQXZhaWxhYmxlIHRvIGFkZCBlbmQgbGlzdGVuZXJzLCBldGMuXHJcbiAgICovXHJcbiAgcHVibGljIHdpcGVVcFRvKCBjb250ZW50OiBOb2RlIHwgbnVsbCwgY29uZmlnPzogV2lwZVRyYW5zaXRpb25PcHRpb25zICk6IFRyYW5zaXRpb24ge1xyXG4gICAgdGhpcy5pbnRlcnJ1cHQoKTtcclxuICAgIHJldHVybiB0aGlzLnN0YXJ0VHJhbnNpdGlvbiggY29udGVudCwgVHJhbnNpdGlvbi53aXBlVXAoIHRoaXMudHJhbnNpdGlvbkJvdW5kc1Byb3BlcnR5LnZhbHVlLCB0aGlzLmZyb21Db250ZW50LCBjb250ZW50LCBjb25maWcgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgYSB0cmFuc2l0aW9uIHRvIHJlcGxhY2Ugb3VyIGNvbnRlbnQgd2l0aCB0aGUgbmV3IGNvbnRlbnQsIHVzaW5nIFRyYW5zaXRpb24ud2lwZURvd24uXHJcbiAgICpcclxuICAgKiBAcGFyYW0gY29udGVudCAtIElmIG51bGwsIHRoZSBjdXJyZW50IGNvbnRlbnQgd2lsbCBzdGlsbCBhbmltYXRlIG91dCAod2l0aCBub3RoaW5nIHJlcGxhY2luZyBpdCkuXHJcbiAgICogQHBhcmFtIGNvbmZpZyAtIFBhc3NlZCBhcyBjb25maWcgdG8gdGhlIEFuaW1hdGlvbi4gVXN1YWxseSBhIGR1cmF0aW9uIHNob3VsZCBiZSBpbmNsdWRlZC5cclxuICAgKiBAcmV0dXJucyAtIEF2YWlsYWJsZSB0byBhZGQgZW5kIGxpc3RlbmVycywgZXRjLlxyXG4gICAqL1xyXG4gIHB1YmxpYyB3aXBlRG93blRvKCBjb250ZW50OiBOb2RlIHwgbnVsbCwgY29uZmlnPzogV2lwZVRyYW5zaXRpb25PcHRpb25zICk6IFRyYW5zaXRpb24ge1xyXG4gICAgdGhpcy5pbnRlcnJ1cHQoKTtcclxuICAgIHJldHVybiB0aGlzLnN0YXJ0VHJhbnNpdGlvbiggY29udGVudCwgVHJhbnNpdGlvbi53aXBlRG93biggdGhpcy50cmFuc2l0aW9uQm91bmRzUHJvcGVydHkudmFsdWUsIHRoaXMuZnJvbUNvbnRlbnQsIGNvbnRlbnQsIGNvbmZpZyApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdGFydCBhIHRyYW5zaXRpb24gdG8gcmVwbGFjZSBvdXIgY29udGVudCB3aXRoIHRoZSBuZXcgY29udGVudCwgdXNpbmcgVHJhbnNpdGlvbi5kaXNzb2x2ZS5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBjb250ZW50IC0gSWYgbnVsbCwgdGhlIGN1cnJlbnQgY29udGVudCB3aWxsIHN0aWxsIGFuaW1hdGUgb3V0ICh3aXRoIG5vdGhpbmcgcmVwbGFjaW5nIGl0KS5cclxuICAgKiBAcGFyYW0gY29uZmlnIC0gUGFzc2VkIGFzIGNvbmZpZyB0byB0aGUgQW5pbWF0aW9uLiBVc3VhbGx5IGEgZHVyYXRpb24gc2hvdWxkIGJlIGluY2x1ZGVkLlxyXG4gICAqIEByZXR1cm5zIC0gQXZhaWxhYmxlIHRvIGFkZCBlbmQgbGlzdGVuZXJzLCBldGMuXHJcbiAgICovXHJcbiAgcHVibGljIGRpc3NvbHZlVG8oIGNvbnRlbnQ6IE5vZGUgfCBudWxsLCBjb25maWc/OiBEaXNzb2x2ZVRyYW5zaXRpb25PcHRpb25zICk6IFRyYW5zaXRpb24ge1xyXG4gICAgdGhpcy5pbnRlcnJ1cHQoKTtcclxuICAgIHJldHVybiB0aGlzLnN0YXJ0VHJhbnNpdGlvbiggY29udGVudCwgVHJhbnNpdGlvbi5kaXNzb2x2ZSggdGhpcy5mcm9tQ29udGVudCwgY29udGVudCwgY29uZmlnICkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0YXJ0cyBhIHRyYW5zaXRpb24sIGFuZCBob29rcyB1cCBhIGxpc3RlbmVyIHRvIGhhbmRsZSBzdGF0ZSBjaGFuZ2VzIHdoZW4gaXQgZW5kcy5cclxuICAgKlxyXG4gICAqIEByZXR1cm5zIC0gQXZhaWxhYmxlIHRvIGFkZCBlbmQgbGlzdGVuZXJzLCBldGMuIChjaGFpbmVkKVxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhcnRUcmFuc2l0aW9uKCBjb250ZW50OiBOb2RlIHwgbnVsbCwgdHJhbnNpdGlvbjogVHJhbnNpdGlvbiApOiBUcmFuc2l0aW9uIHtcclxuXHJcbiAgICAvLyBTdG9wIGFuaW1hdGluZyBpZiB3ZSB3ZXJlIGJlZm9yZVxyXG4gICAgdGhpcy5pbnRlcnJ1cHQoKTtcclxuXHJcbiAgICB0aGlzLnRvQ29udGVudCA9IGNvbnRlbnQ7XHJcblxyXG4gICAgaWYgKCBjb250ZW50ICkge1xyXG4gICAgICBpZiAoIF8uaW5jbHVkZXMoIHRoaXMuY2FjaGVkTm9kZXMsIGNvbnRlbnQgKSApIHtcclxuICAgICAgICBjb250ZW50LnZpc2libGUgPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYWRkQ2hpbGQoIGNvbnRlbnQgKTtcclxuICAgICAgfVxyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLmhhc0NoaWxkKCBjb250ZW50ICksXHJcbiAgICAgICAgJ1Nob3VsZCBhbHdheXMgaGF2ZSB0aGUgY29udGVudCBhcyBhIGNoaWxkIGF0IHRoZSBzdGFydCBvZiBhIHRyYW5zaXRpb24nICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy50cmFuc2l0aW9uID0gdHJhbnNpdGlvbjtcclxuXHJcbiAgICAvLyBTaW1wbGlmaWVzIG1hbnkgdGhpbmdzIGlmIHRoZSB1c2VyIGNhbid0IG1lc3Mgd2l0aCB0aGluZ3Mgd2hpbGUgYW5pbWF0aW5nLlxyXG4gICAgaWYgKCB0aGlzLmZyb21Db250ZW50ICkge1xyXG4gICAgICB0aGlzLmZyb21Db250ZW50LnBpY2thYmxlID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoIHRoaXMudG9Db250ZW50ICkge1xyXG4gICAgICB0aGlzLnRvQ29udGVudC5waWNrYWJsZSA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHRyYW5zaXRpb24uZW5kZWRFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgIGlmICggdGhpcy5mcm9tQ29udGVudCApIHtcclxuICAgICAgICB0aGlzLmZyb21Db250ZW50LnBpY2thYmxlID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIHRoaXMudG9Db250ZW50ICkge1xyXG4gICAgICAgIHRoaXMudG9Db250ZW50LnBpY2thYmxlID0gbnVsbDtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy50cmFuc2l0aW9uID0gbnVsbDtcclxuXHJcbiAgICAgIGlmICggdGhpcy5mcm9tQ29udGVudCApIHtcclxuICAgICAgICBpZiAoIF8uaW5jbHVkZXMoIHRoaXMuY2FjaGVkTm9kZXMsIHRoaXMuZnJvbUNvbnRlbnQgKSApIHtcclxuICAgICAgICAgIHRoaXMuZnJvbUNvbnRlbnQudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGQoIHRoaXMuZnJvbUNvbnRlbnQgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5oYXNDaGlsZCggdGhpcy5mcm9tQ29udGVudCApID09PSBfLmluY2x1ZGVzKCB0aGlzLmNhY2hlZE5vZGVzLCB0aGlzLmZyb21Db250ZW50ICksXHJcbiAgICAgICAgICAnU2hvdWxkIGhhdmUgcmVtb3ZlZCB0aGUgY2hpbGQgaWYgaXQgaXMgbm90IGluY2x1ZGVkIGluIG91ciBjYWNoZWROb2RlcycgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5mcm9tQ29udGVudCA9IHRoaXMudG9Db250ZW50O1xyXG4gICAgICB0aGlzLnRvQ29udGVudCA9IG51bGw7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdHJhbnNpdGlvbi5zdGFydCgpO1xyXG5cclxuICAgIHJldHVybiB0cmFuc2l0aW9uO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmludGVycnVwdCgpO1xyXG4gICAgdGhpcy50cmFuc2l0aW9uQm91bmRzUHJvcGVydHkudW5saW5rKCB0aGlzLmJvdW5kc0xpc3RlbmVyICk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG50d2l4dC5yZWdpc3RlciggJ1RyYW5zaXRpb25Ob2RlJywgVHJhbnNpdGlvbk5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgVHJhbnNpdGlvbk5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBSUEsU0FBU0EsS0FBSyxRQUFRLDBCQUEwQjtBQUNoRCxPQUFPQyxTQUFTLE1BQU0saUNBQWlDO0FBRXZELFNBQVNDLElBQUksUUFBcUIsNkJBQTZCO0FBQy9ELE9BQU9DLFVBQVUsTUFBb0YsaUJBQWlCO0FBQ3RILE9BQU9DLEtBQUssTUFBTSxZQUFZO0FBb0I5QixNQUFNQyxjQUFjLFNBQVNILElBQUksQ0FBQztFQU1oQzs7RUFHQTtFQUNRSSxTQUFTLEdBQWdCLElBQUk7O0VBRXJDOztFQU1BO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFD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