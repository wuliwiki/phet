// Copyright 2015-2023, University of Colorado Boulder

/**
 * The robotic arm used to pull the spring(s).
 * Origin is at the left-center of the red box.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Dimension2 from '../../../../dot/js/Dimension2.js';
import Utils from '../../../../dot/js/Utils.js';
import { Shape } from '../../../../kite/js/imports.js';
import { DragListener, LinearGradient, Node, Path, Rectangle } from '../../../../scenery/js/imports.js';
import hookesLaw from '../../hookesLaw.js';
import HookesLawColors from '../HookesLawColors.js';
import HookesLawConstants from '../HookesLawConstants.js';
import HingeNode from './HingeNode.js';
import optionize from '../../../../phet-core/js/optionize.js';
// constants
const PINCER_RADIUS = 35;
const PINCER_LINE_WIDTH = 6;
const PINCER_OVERLAP = 2;
const ARM_HEIGHT = 14;
const ARM_GRADIENT = new LinearGradient(0, 0, 0, ARM_HEIGHT).addColorStop(0, HookesLawColors.ROBOTIC_ARM_FILL).addColorStop(0.3, 'white').addColorStop(1, HookesLawColors.ROBOTIC_ARM_FILL);
const BOX_SIZE = new Dimension2(20, 60);
const BOX_GRADIENT = new LinearGradient(0, 0, 0, BOX_SIZE.height).addColorStop(0, HookesLawColors.ROBOTIC_ARM_FILL).addColorStop(0.5, 'white').addColorStop(1, HookesLawColors.ROBOTIC_ARM_FILL);
export default class RoboticArmNode extends Node {
  constructor(roboticArm, leftRangeProperty,
  // dynamic range of the left (movable) end of the arm, units = m
  numberOfInteractionsInProgressProperty,
  // number of interactions in progress that affect displacement
  providedOptions) {
    const options = optionize()({
      // SelfOptions
      unitDisplacementLength: 1,
      displacementInterval: null,
      // NodeOptions
      cursor: 'pointer',
      phetioInputEnabledPropertyInstrumented: true,
      visiblePropertyOptions: {
        phetioReadOnly: true
      }
    }, providedOptions);

    // red box at right end of the arm, origin is at left-center
    const redBox = new Rectangle(0, 0, 7, 30, {
      stroke: 'black',
      fill: HookesLawColors.HINGE,
      // same color as hinge
      lineWidth: 0.5,
      left: 0,
      centerY: 0
    });

    // gradient box to the right of red box
    const gradientBox = new Rectangle(0, 0, BOX_SIZE.width, BOX_SIZE.height, {
      stroke: 'black',
      fill: BOX_GRADIENT,
      lineWidth: 0.5,
      left: redBox.right - 1,
      centerY: 0
    });

    // arm will be sized and positioned by Property observer
    const armNode = new Rectangle(0, 0, 1, ARM_HEIGHT, {
      fill: ARM_GRADIENT,
      stroke: HookesLawColors.ROBOTIC_ARM_STROKE,
      lineWidth: 0.5
    });
    const topPincerClosedNode = createTopPincerClosed({
      stroke: HookesLawColors.PINCERS_STROKE,
      lineWidth: PINCER_LINE_WIDTH,
      left: 0,
      bottom: PINCER_OVERLAP
    });
    const topPincerOpenNode = new Path(new Shape().arc(0, 0, PINCER_RADIUS, -0.8 * Math.PI, 0), {
      stroke: HookesLawColors.PINCERS_STROKE,
      lineWidth: PINCER_LINE_WIDTH,
      right: topPincerClosedNode.right,
      bottom: 0
    });
    const bottomPincerClosedNode = createBottomPincerClosed({
      stroke: HookesLawColors.PINCERS_STROKE,
      lineWidth: PINCER_LINE_WIDTH,
      left: 0,
      top: -PINCER_OVERLAP
    });
    const bottomPincerOpenNode = new Path(new Shape().arc(0, 0, PINCER_RADIUS, 0.8 * Math.PI, 0, true), {
      stroke: HookesLawColors.PINCERS_STROKE,
      lineWidth: PINCER_LINE_WIDTH,
      right: bottomPincerClosedNode.right,
      top: 0
    });

    // hinge, where the pincers are attached
    const hingeNode = new HingeNode({
      x: topPincerClosedNode.right - 12,
      // dependent on image file
      centerY: 0 // dependent on image file
    });

    // pincers and hinge are draggable, other parts are not
    const draggableNode = new Node({
      children: [topPincerClosedNode, topPincerOpenNode, bottomPincerClosedNode, bottomPincerOpenNode, hingeNode]
    });
    draggableNode.touchArea = draggableNode.localBounds.dilatedXY(0.3 * draggableNode.width, 0.2 * draggableNode.height);

    // Drag the pincers or hinge
    let startOffsetX = 0;
    const dragHandler = new DragListener({
      allowTouchSnag: true,
      start: event => {
        numberOfInteractionsInProgressProperty.value = numberOfInteractionsInProgressProperty.value + 1;
        const length = options.unitDisplacementLength * (roboticArm.leftProperty.value - roboticArm.right);
        startOffsetX = draggableNode.globalToParentPoint(event.pointer.point).x - length;
      },
      drag: event => {
        const parentX = draggableNode.globalToParentPoint(event.pointer.point).x - startOffsetX;
        const length = parentX / options.unitDisplacementLength;
        let left = leftRangeProperty.value.constrainValue(roboticArm.right + length);

        // constrain to multiples of a specific interval, see #54
        if (options.displacementInterval) {
          left = Utils.roundToInterval(left, options.displacementInterval);
        }
        left = Utils.toFixedNumber(left, HookesLawConstants.DISPLACEMENT_DECIMAL_PLACES);
        phet.log && phet.log('>>>>> RoboticArmNode drag');
        roboticArm.leftProperty.value = left;
      },
      end: () => {
        numberOfInteractionsInProgressProperty.value = numberOfInteractionsInProgressProperty.value - 1;
      },
      // phet-io
      tandem: options.tandem.createTandem('dragListener')
    });
    draggableNode.addInputListener(dragHandler);
    roboticArm.leftProperty.link(left => {
      // move the pincers and hinge
      draggableNode.x = options.unitDisplacementLength * (left - roboticArm.right);

      // resize the arm
      const overlap = 10; // hide ends of arm behind hinge and box
      const armLength = gradientBox.left - draggableNode.right + 2 * overlap;
      armNode.setRect(0, 0, armLength, ARM_HEIGHT);
      armNode.right = gradientBox.left + overlap;
      armNode.centerY = 0;
    });
    options.children = [armNode, redBox, gradientBox, draggableNode];
    super(options);

    // We are not PhET-iO instrumenting the subcomponents of this Node, and it is one of those subcomponents
    // that is draggable.  So instrument this Node's inputEnabledProperty, and use it to control the interactivity
    // of the subcomponent.
    this.inputEnabledProperty.link(inputEnabled => {
      draggableNode.inputEnabledProperty.value = inputEnabled;
    });
    this.topPincerClosedNode = topPincerClosedNode;
    this.topPincerOpenNode = topPincerOpenNode;
    this.bottomPincerClosedNode = bottomPincerClosedNode;
    this.bottomPincerOpenNode = bottomPincerOpenNode;
  }
  setPincersOpen(pincersOpen) {
    this.topPincerOpenNode.visible = this.bottomPincerOpenNode.visible = pincersOpen;
    this.topPincerClosedNode.visible = this.bottomPincerClosedNode.visible = !pincersOpen;
  }

  /**
   * Creates an icon that represents this node.
   */
  static createIcon(options) {
    const topPincerNode = createTopPincerClosed({
      stroke: HookesLawColors.PINCERS_STROKE,
      lineWidth: PINCER_LINE_WIDTH,
      bottom: PINCER_OVERLAP
    });
    const bottomPincerNode = createBottomPincerClosed({
      stroke: HookesLawColors.PINCERS_STROKE,
      lineWidth: PINCER_LINE_WIDTH,
      top: -PINCER_OVERLAP
    });
    const hingeNode = new HingeNode({
      left: topPincerNode.right - 12,
      centerY: 0
    });
    const armNode = new Rectangle(0, 0, 20, ARM_HEIGHT, {
      fill: ARM_GRADIENT,
      stroke: HookesLawColors.ROBOTIC_ARM_STROKE,
      lineWidth: 0.5,
      left: hingeNode.right - 5,
      centerY: hingeNode.centerY
    });
    options.children = [topPincerNode, bottomPincerNode, armNode, hingeNode];
    return new Node(options);
  }
}

/**
 * Creates the top pincer in closed position.
 */
function createTopPincerClosed(options) {
  return new Path(new Shape().arc(0, 0, PINCER_RADIUS, -0.9 * Math.PI, -0.1 * Math.PI), options);
}

/**
 * Creates the bottom pincer in closed position.
 */
function createBottomPincerClosed(options) {
  return new Path(new Shape().arc(0, 0, PINCER_RADIUS, 0.9 * Math.PI, 0.1 * Math.PI, true), options);
}
hookesLaw.register('RoboticArmNode', RoboticArmNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEaW1lbnNpb24yIiwiVXRpbHMiLCJTaGFwZSIsIkRyYWdMaXN0ZW5lciIsIkxpbmVhckdyYWRpZW50IiwiTm9kZSIsIlBhdGgiLCJSZWN0YW5nbGUiLCJob29rZXNMYXciLCJIb29rZXNMYXdDb2xvcnMiLCJIb29rZXNMYXdDb25zdGFudHMiLCJIaW5nZU5vZGUiLCJvcHRpb25pemUiLCJQSU5DRVJfUkFESVVTIiwiUElOQ0VSX0xJTkVfV0lEVEgiLCJQSU5DRVJfT1ZFUkxBUCIsIkFSTV9IRUlHSFQiLCJBUk1fR1JBRElFTlQiLCJhZGRDb2xvclN0b3AiLCJST0JPVElDX0FSTV9GSUxMIiwiQk9YX1NJWkUiLCJCT1hfR1JBRElFTlQiLCJoZWlnaHQiLCJSb2JvdGljQXJtTm9kZSIsImNvbnN0cnVjdG9yIiwicm9ib3RpY0FybSIsImxlZnRSYW5nZVByb3BlcnR5IiwibnVtYmVyT2ZJbnRlcmFjdGlvbnNJblByb2dyZXNzUHJvcGVydHkiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwidW5pdERpc3BsYWNlbWVudExlbmd0aCIsImRpc3BsYWNlbWVudEludGVydmFsIiwiY3Vyc29yIiwicGhldGlvSW5wdXRFbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQiLCJ2aXNpYmxlUHJvcGVydHlPcHRpb25zIiwicGhldGlvUmVhZE9ubHkiLCJyZWRCb3giLCJzdHJva2UiLCJmaWxsIiwiSElOR0UiLCJsaW5lV2lkdGgiLCJsZWZ0IiwiY2VudGVyWSIsImdyYWRpZW50Qm94Iiwid2lkdGgiLCJyaWdodCIsImFybU5vZGUiLCJST0JPVElDX0FSTV9TVFJPS0UiLCJ0b3BQaW5jZXJDbG9zZWROb2RlIiwiY3JlYXRlVG9wUGluY2VyQ2xvc2VkIiwiUElOQ0VSU19TVFJPS0UiLCJib3R0b20iLCJ0b3BQaW5jZXJPcGVuTm9kZSIsImFyYyIsIk1hdGgiLCJQSSIsImJvdHRvbVBpbmNlckNsb3NlZE5vZGUiLCJjcmVhdGVCb3R0b21QaW5jZXJDbG9zZWQiLCJ0b3AiLCJib3R0b21QaW5jZXJPcGVuTm9kZSIsImhpbmdlTm9kZSIsIngiLCJkcmFnZ2FibGVOb2RlIiwiY2hpbGRyZW4iLCJ0b3VjaEFyZWEiLCJsb2NhbEJvdW5kcyIsImRpbGF0ZWRYWSIsInN0YXJ0T2Zmc2V0WCIsImRyYWdIYW5kbGVyIiwiYWxsb3dUb3VjaFNuYWciLCJzdGFydCIsImV2ZW50IiwidmFsdWUiLCJsZW5ndGgiLCJsZWZ0UHJvcGVydHkiLCJnbG9iYWxUb1BhcmVudFBvaW50IiwicG9pbnRlciIsInBvaW50IiwiZHJhZyIsInBhcmVudFgiLCJjb25zdHJhaW5WYWx1ZSIsInJvdW5kVG9JbnRlcnZhbCIsInRvRml4ZWROdW1iZXIiLCJESVNQTEFDRU1FTlRfREVDSU1BTF9QTEFDRVMiLCJwaGV0IiwibG9nIiwiZW5kIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwiYWRkSW5wdXRMaXN0ZW5lciIsImxpbmsiLCJvdmVybGFwIiwiYXJtTGVuZ3RoIiwic2V0UmVjdCIsImlucHV0RW5hYmxlZFByb3BlcnR5IiwiaW5wdXRFbmFibGVkIiwic2V0UGluY2Vyc09wZW4iLCJwaW5jZXJzT3BlbiIsInZpc2libGUiLCJjcmVhdGVJY29uIiwidG9wUGluY2VyTm9kZSIsImJvdHRvbVBpbmNlck5vZGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlJvYm90aWNBcm1Ob2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFRoZSByb2JvdGljIGFybSB1c2VkIHRvIHB1bGwgdGhlIHNwcmluZyhzKS5cclxuICogT3JpZ2luIGlzIGF0IHRoZSBsZWZ0LWNlbnRlciBvZiB0aGUgcmVkIGJveC5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgeyBEcmFnTGlzdGVuZXIsIExpbmVhckdyYWRpZW50LCBOb2RlLCBOb2RlT3B0aW9ucywgTm9kZVRyYW5zbGF0aW9uT3B0aW9ucywgUGF0aCwgUGF0aE9wdGlvbnMsIFJlY3RhbmdsZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBob29rZXNMYXcgZnJvbSAnLi4vLi4vaG9va2VzTGF3LmpzJztcclxuaW1wb3J0IEhvb2tlc0xhd0NvbG9ycyBmcm9tICcuLi9Ib29rZXNMYXdDb2xvcnMuanMnO1xyXG5pbXBvcnQgSG9va2VzTGF3Q29uc3RhbnRzIGZyb20gJy4uL0hvb2tlc0xhd0NvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBIaW5nZU5vZGUgZnJvbSAnLi9IaW5nZU5vZGUuanMnO1xyXG5pbXBvcnQgUm9ib3RpY0FybSBmcm9tICcuLi9tb2RlbC9Sb2JvdGljQXJtLmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgUElOQ0VSX1JBRElVUyA9IDM1O1xyXG5jb25zdCBQSU5DRVJfTElORV9XSURUSCA9IDY7XHJcbmNvbnN0IFBJTkNFUl9PVkVSTEFQID0gMjtcclxuY29uc3QgQVJNX0hFSUdIVCA9IDE0O1xyXG5jb25zdCBBUk1fR1JBRElFTlQgPSBuZXcgTGluZWFyR3JhZGllbnQoIDAsIDAsIDAsIEFSTV9IRUlHSFQgKVxyXG4gIC5hZGRDb2xvclN0b3AoIDAsIEhvb2tlc0xhd0NvbG9ycy5ST0JPVElDX0FSTV9GSUxMIClcclxuICAuYWRkQ29sb3JTdG9wKCAwLjMsICd3aGl0ZScgKVxyXG4gIC5hZGRDb2xvclN0b3AoIDEsIEhvb2tlc0xhd0NvbG9ycy5ST0JPVElDX0FSTV9GSUxMICk7XHJcbmNvbnN0IEJPWF9TSVpFID0gbmV3IERpbWVuc2lvbjIoIDIwLCA2MCApO1xyXG5jb25zdCBCT1hfR1JBRElFTlQgPSBuZXcgTGluZWFyR3JhZGllbnQoIDAsIDAsIDAsIEJPWF9TSVpFLmhlaWdodCApXHJcbiAgLmFkZENvbG9yU3RvcCggMCwgSG9va2VzTGF3Q29sb3JzLlJPQk9USUNfQVJNX0ZJTEwgKVxyXG4gIC5hZGRDb2xvclN0b3AoIDAuNSwgJ3doaXRlJyApXHJcbiAgLmFkZENvbG9yU3RvcCggMSwgSG9va2VzTGF3Q29sb3JzLlJPQk9USUNfQVJNX0ZJTEwgKTtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgdW5pdERpc3BsYWNlbWVudExlbmd0aD86IG51bWJlcjsgLy8gdmlldyBsZW5ndGggb2YgYSAxbSBkaXNwbGFjZW1lbnRcclxuICBkaXNwbGFjZW1lbnRJbnRlcnZhbD86IG51bWJlciB8IG51bGw7IC8vIGRyYWdnaW5nIHRoZSBhcm0gd2lsbCBzbmFwIHRvIG11bHRpcGxlcyBvZiB0aGlzIGludGVydmFsLCBudWxsIGlmIG5vIHNuYXBwaW5nXHJcbn07XHJcblxyXG50eXBlIFJvYm90aWNBcm1Ob2RlT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgTm9kZVRyYW5zbGF0aW9uT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxOb2RlT3B0aW9ucywgJ3RhbmRlbSc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUm9ib3RpY0FybU5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSB0b3BQaW5jZXJDbG9zZWROb2RlOiBOb2RlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdG9wUGluY2VyT3Blbk5vZGU6IE5vZGU7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBib3R0b21QaW5jZXJDbG9zZWROb2RlOiBOb2RlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgYm90dG9tUGluY2VyT3Blbk5vZGU6IE5vZGU7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvciggcm9ib3RpY0FybTogUm9ib3RpY0FybSxcclxuICAgICAgICAgICAgICAgICAgICAgIGxlZnRSYW5nZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxSYW5nZT4sIC8vIGR5bmFtaWMgcmFuZ2Ugb2YgdGhlIGxlZnQgKG1vdmFibGUpIGVuZCBvZiB0aGUgYXJtLCB1bml0cyA9IG1cclxuICAgICAgICAgICAgICAgICAgICAgIG51bWJlck9mSW50ZXJhY3Rpb25zSW5Qcm9ncmVzc1Byb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+LCAvLyBudW1iZXIgb2YgaW50ZXJhY3Rpb25zIGluIHByb2dyZXNzIHRoYXQgYWZmZWN0IGRpc3BsYWNlbWVudFxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWRPcHRpb25zOiBSb2JvdGljQXJtTm9kZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxSb2JvdGljQXJtTm9kZU9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgdW5pdERpc3BsYWNlbWVudExlbmd0aDogMSxcclxuICAgICAgZGlzcGxhY2VtZW50SW50ZXJ2YWw6IG51bGwsXHJcblxyXG4gICAgICAvLyBOb2RlT3B0aW9uc1xyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcclxuICAgICAgcGhldGlvSW5wdXRFbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQ6IHRydWUsXHJcbiAgICAgIHZpc2libGVQcm9wZXJ0eU9wdGlvbnM6IHsgcGhldGlvUmVhZE9ubHk6IHRydWUgfVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gcmVkIGJveCBhdCByaWdodCBlbmQgb2YgdGhlIGFybSwgb3JpZ2luIGlzIGF0IGxlZnQtY2VudGVyXHJcbiAgICBjb25zdCByZWRCb3ggPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCA3LCAzMCwge1xyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGZpbGw6IEhvb2tlc0xhd0NvbG9ycy5ISU5HRSwgLy8gc2FtZSBjb2xvciBhcyBoaW5nZVxyXG4gICAgICBsaW5lV2lkdGg6IDAuNSxcclxuICAgICAgbGVmdDogMCxcclxuICAgICAgY2VudGVyWTogMFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGdyYWRpZW50IGJveCB0byB0aGUgcmlnaHQgb2YgcmVkIGJveFxyXG4gICAgY29uc3QgZ3JhZGllbnRCb3ggPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBCT1hfU0laRS53aWR0aCwgQk9YX1NJWkUuaGVpZ2h0LCB7XHJcbiAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgZmlsbDogQk9YX0dSQURJRU5ULFxyXG4gICAgICBsaW5lV2lkdGg6IDAuNSxcclxuICAgICAgbGVmdDogcmVkQm94LnJpZ2h0IC0gMSxcclxuICAgICAgY2VudGVyWTogMFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGFybSB3aWxsIGJlIHNpemVkIGFuZCBwb3NpdGlvbmVkIGJ5IFByb3BlcnR5IG9ic2VydmVyXHJcbiAgICBjb25zdCBhcm1Ob2RlID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgMSwgQVJNX0hFSUdIVCwge1xyXG4gICAgICBmaWxsOiBBUk1fR1JBRElFTlQsXHJcbiAgICAgIHN0cm9rZTogSG9va2VzTGF3Q29sb3JzLlJPQk9USUNfQVJNX1NUUk9LRSxcclxuICAgICAgbGluZVdpZHRoOiAwLjVcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCB0b3BQaW5jZXJDbG9zZWROb2RlID0gY3JlYXRlVG9wUGluY2VyQ2xvc2VkKCB7XHJcbiAgICAgIHN0cm9rZTogSG9va2VzTGF3Q29sb3JzLlBJTkNFUlNfU1RST0tFLFxyXG4gICAgICBsaW5lV2lkdGg6IFBJTkNFUl9MSU5FX1dJRFRILFxyXG4gICAgICBsZWZ0OiAwLFxyXG4gICAgICBib3R0b206IFBJTkNFUl9PVkVSTEFQXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgdG9wUGluY2VyT3Blbk5vZGUgPSBuZXcgUGF0aCggbmV3IFNoYXBlKCkuYXJjKCAwLCAwLCBQSU5DRVJfUkFESVVTLCAtMC44ICogTWF0aC5QSSwgMCApLCB7XHJcbiAgICAgIHN0cm9rZTogSG9va2VzTGF3Q29sb3JzLlBJTkNFUlNfU1RST0tFLFxyXG4gICAgICBsaW5lV2lkdGg6IFBJTkNFUl9MSU5FX1dJRFRILFxyXG4gICAgICByaWdodDogdG9wUGluY2VyQ2xvc2VkTm9kZS5yaWdodCxcclxuICAgICAgYm90dG9tOiAwXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgYm90dG9tUGluY2VyQ2xvc2VkTm9kZSA9IGNyZWF0ZUJvdHRvbVBpbmNlckNsb3NlZCgge1xyXG4gICAgICBzdHJva2U6IEhvb2tlc0xhd0NvbG9ycy5QSU5DRVJTX1NUUk9LRSxcclxuICAgICAgbGluZVdpZHRoOiBQSU5DRVJfTElORV9XSURUSCxcclxuICAgICAgbGVmdDogMCxcclxuICAgICAgdG9wOiAtUElOQ0VSX09WRVJMQVBcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBib3R0b21QaW5jZXJPcGVuTm9kZSA9IG5ldyBQYXRoKCBuZXcgU2hhcGUoKS5hcmMoIDAsIDAsIFBJTkNFUl9SQURJVVMsIDAuOCAqIE1hdGguUEksIDAsIHRydWUgKSwge1xyXG4gICAgICBzdHJva2U6IEhvb2tlc0xhd0NvbG9ycy5QSU5DRVJTX1NUUk9LRSxcclxuICAgICAgbGluZVdpZHRoOiBQSU5DRVJfTElORV9XSURUSCxcclxuICAgICAgcmlnaHQ6IGJvdHRvbVBpbmNlckNsb3NlZE5vZGUucmlnaHQsXHJcbiAgICAgIHRvcDogMFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGhpbmdlLCB3aGVyZSB0aGUgcGluY2VycyBhcmUgYXR0YWNoZWRcclxuICAgIGNvbnN0IGhpbmdlTm9kZSA9IG5ldyBIaW5nZU5vZGUoIHtcclxuICAgICAgeDogdG9wUGluY2VyQ2xvc2VkTm9kZS5yaWdodCAtIDEyLCAvLyBkZXBlbmRlbnQgb24gaW1hZ2UgZmlsZVxyXG4gICAgICBjZW50ZXJZOiAwIC8vIGRlcGVuZGVudCBvbiBpbWFnZSBmaWxlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gcGluY2VycyBhbmQgaGluZ2UgYXJlIGRyYWdnYWJsZSwgb3RoZXIgcGFydHMgYXJlIG5vdFxyXG4gICAgY29uc3QgZHJhZ2dhYmxlTm9kZSA9IG5ldyBOb2RlKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgdG9wUGluY2VyQ2xvc2VkTm9kZSwgdG9wUGluY2VyT3Blbk5vZGUsXHJcbiAgICAgICAgYm90dG9tUGluY2VyQ2xvc2VkTm9kZSwgYm90dG9tUGluY2VyT3Blbk5vZGUsXHJcbiAgICAgICAgaGluZ2VOb2RlXHJcbiAgICAgIF1cclxuICAgIH0gKTtcclxuICAgIGRyYWdnYWJsZU5vZGUudG91Y2hBcmVhID0gZHJhZ2dhYmxlTm9kZS5sb2NhbEJvdW5kcy5kaWxhdGVkWFkoIDAuMyAqIGRyYWdnYWJsZU5vZGUud2lkdGgsIDAuMiAqIGRyYWdnYWJsZU5vZGUuaGVpZ2h0ICk7XHJcblxyXG4gICAgLy8gRHJhZyB0aGUgcGluY2VycyBvciBoaW5nZVxyXG4gICAgbGV0IHN0YXJ0T2Zmc2V0WCA9IDA7XHJcbiAgICBjb25zdCBkcmFnSGFuZGxlciA9IG5ldyBEcmFnTGlzdGVuZXIoIHtcclxuXHJcbiAgICAgIGFsbG93VG91Y2hTbmFnOiB0cnVlLFxyXG5cclxuICAgICAgc3RhcnQ6IGV2ZW50ID0+IHtcclxuICAgICAgICBudW1iZXJPZkludGVyYWN0aW9uc0luUHJvZ3Jlc3NQcm9wZXJ0eS52YWx1ZSA9ICggbnVtYmVyT2ZJbnRlcmFjdGlvbnNJblByb2dyZXNzUHJvcGVydHkudmFsdWUgKyAxICk7XHJcbiAgICAgICAgY29uc3QgbGVuZ3RoID0gb3B0aW9ucy51bml0RGlzcGxhY2VtZW50TGVuZ3RoICogKCByb2JvdGljQXJtLmxlZnRQcm9wZXJ0eS52YWx1ZSAtIHJvYm90aWNBcm0ucmlnaHQgKTtcclxuICAgICAgICBzdGFydE9mZnNldFggPSBkcmFnZ2FibGVOb2RlLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKS54IC0gbGVuZ3RoO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgZHJhZzogZXZlbnQgPT4ge1xyXG4gICAgICAgIGNvbnN0IHBhcmVudFggPSBkcmFnZ2FibGVOb2RlLmdsb2JhbFRvUGFyZW50UG9pbnQoIGV2ZW50LnBvaW50ZXIucG9pbnQgKS54IC0gc3RhcnRPZmZzZXRYO1xyXG4gICAgICAgIGNvbnN0IGxlbmd0aCA9IHBhcmVudFggLyBvcHRpb25zLnVuaXREaXNwbGFjZW1lbnRMZW5ndGg7XHJcbiAgICAgICAgbGV0IGxlZnQgPSBsZWZ0UmFuZ2VQcm9wZXJ0eS52YWx1ZS5jb25zdHJhaW5WYWx1ZSggcm9ib3RpY0FybS5yaWdodCArIGxlbmd0aCApO1xyXG5cclxuICAgICAgICAvLyBjb25zdHJhaW4gdG8gbXVsdGlwbGVzIG9mIGEgc3BlY2lmaWMgaW50ZXJ2YWwsIHNlZSAjNTRcclxuICAgICAgICBpZiAoIG9wdGlvbnMuZGlzcGxhY2VtZW50SW50ZXJ2YWwgKSB7XHJcbiAgICAgICAgICBsZWZ0ID0gVXRpbHMucm91bmRUb0ludGVydmFsKCBsZWZ0LCBvcHRpb25zLmRpc3BsYWNlbWVudEludGVydmFsICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxlZnQgPSBVdGlscy50b0ZpeGVkTnVtYmVyKCBsZWZ0LCBIb29rZXNMYXdDb25zdGFudHMuRElTUExBQ0VNRU5UX0RFQ0lNQUxfUExBQ0VTICk7XHJcblxyXG4gICAgICAgIHBoZXQubG9nICYmIHBoZXQubG9nKCAnPj4+Pj4gUm9ib3RpY0FybU5vZGUgZHJhZycgKTtcclxuICAgICAgICByb2JvdGljQXJtLmxlZnRQcm9wZXJ0eS52YWx1ZSA9IGxlZnQ7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBlbmQ6ICgpID0+IHtcclxuICAgICAgICBudW1iZXJPZkludGVyYWN0aW9uc0luUHJvZ3Jlc3NQcm9wZXJ0eS52YWx1ZSA9ICggbnVtYmVyT2ZJbnRlcmFjdGlvbnNJblByb2dyZXNzUHJvcGVydHkudmFsdWUgLSAxICk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZHJhZ0xpc3RlbmVyJyApXHJcbiAgICB9ICk7XHJcbiAgICBkcmFnZ2FibGVOb2RlLmFkZElucHV0TGlzdGVuZXIoIGRyYWdIYW5kbGVyICk7XHJcblxyXG4gICAgcm9ib3RpY0FybS5sZWZ0UHJvcGVydHkubGluayggbGVmdCA9PiB7XHJcblxyXG4gICAgICAvLyBtb3ZlIHRoZSBwaW5jZXJzIGFuZCBoaW5nZVxyXG4gICAgICBkcmFnZ2FibGVOb2RlLnggPSBvcHRpb25zLnVuaXREaXNwbGFjZW1lbnRMZW5ndGggKiAoIGxlZnQgLSByb2JvdGljQXJtLnJpZ2h0ICk7XHJcblxyXG4gICAgICAvLyByZXNpemUgdGhlIGFybVxyXG4gICAgICBjb25zdCBvdmVybGFwID0gMTA7IC8vIGhpZGUgZW5kcyBvZiBhcm0gYmVoaW5kIGhpbmdlIGFuZCBib3hcclxuICAgICAgY29uc3QgYXJtTGVuZ3RoID0gKCBncmFkaWVudEJveC5sZWZ0IC0gZHJhZ2dhYmxlTm9kZS5yaWdodCApICsgKCAyICogb3ZlcmxhcCApO1xyXG4gICAgICBhcm1Ob2RlLnNldFJlY3QoIDAsIDAsIGFybUxlbmd0aCwgQVJNX0hFSUdIVCApO1xyXG4gICAgICBhcm1Ob2RlLnJpZ2h0ID0gZ3JhZGllbnRCb3gubGVmdCArIG92ZXJsYXA7XHJcbiAgICAgIGFybU5vZGUuY2VudGVyWSA9IDA7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFsgYXJtTm9kZSwgcmVkQm94LCBncmFkaWVudEJveCwgZHJhZ2dhYmxlTm9kZSBdO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gV2UgYXJlIG5vdCBQaEVULWlPIGluc3RydW1lbnRpbmcgdGhlIHN1YmNvbXBvbmVudHMgb2YgdGhpcyBOb2RlLCBhbmQgaXQgaXMgb25lIG9mIHRob3NlIHN1YmNvbXBvbmVudHNcclxuICAgIC8vIHRoYXQgaXMgZHJhZ2dhYmxlLiAgU28gaW5zdHJ1bWVudCB0aGlzIE5vZGUncyBpbnB1dEVuYWJsZWRQcm9wZXJ0eSwgYW5kIHVzZSBpdCB0byBjb250cm9sIHRoZSBpbnRlcmFjdGl2aXR5XHJcbiAgICAvLyBvZiB0aGUgc3ViY29tcG9uZW50LlxyXG4gICAgdGhpcy5pbnB1dEVuYWJsZWRQcm9wZXJ0eS5saW5rKCBpbnB1dEVuYWJsZWQgPT4ge1xyXG4gICAgICBkcmFnZ2FibGVOb2RlLmlucHV0RW5hYmxlZFByb3BlcnR5LnZhbHVlID0gaW5wdXRFbmFibGVkO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMudG9wUGluY2VyQ2xvc2VkTm9kZSA9IHRvcFBpbmNlckNsb3NlZE5vZGU7XHJcbiAgICB0aGlzLnRvcFBpbmNlck9wZW5Ob2RlID0gdG9wUGluY2VyT3Blbk5vZGU7XHJcbiAgICB0aGlzLmJvdHRvbVBpbmNlckNsb3NlZE5vZGUgPSBib3R0b21QaW5jZXJDbG9zZWROb2RlO1xyXG4gICAgdGhpcy5ib3R0b21QaW5jZXJPcGVuTm9kZSA9IGJvdHRvbVBpbmNlck9wZW5Ob2RlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldFBpbmNlcnNPcGVuKCBwaW5jZXJzT3BlbjogYm9vbGVhbiApOiB2b2lkIHtcclxuICAgIHRoaXMudG9wUGluY2VyT3Blbk5vZGUudmlzaWJsZSA9IHRoaXMuYm90dG9tUGluY2VyT3Blbk5vZGUudmlzaWJsZSA9IHBpbmNlcnNPcGVuO1xyXG4gICAgdGhpcy50b3BQaW5jZXJDbG9zZWROb2RlLnZpc2libGUgPSB0aGlzLmJvdHRvbVBpbmNlckNsb3NlZE5vZGUudmlzaWJsZSA9ICFwaW5jZXJzT3BlbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYW4gaWNvbiB0aGF0IHJlcHJlc2VudHMgdGhpcyBub2RlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlSWNvbiggb3B0aW9uczogTm9kZU9wdGlvbnMgKTogTm9kZSB7XHJcblxyXG4gICAgY29uc3QgdG9wUGluY2VyTm9kZSA9IGNyZWF0ZVRvcFBpbmNlckNsb3NlZCgge1xyXG4gICAgICBzdHJva2U6IEhvb2tlc0xhd0NvbG9ycy5QSU5DRVJTX1NUUk9LRSxcclxuICAgICAgbGluZVdpZHRoOiBQSU5DRVJfTElORV9XSURUSCxcclxuICAgICAgYm90dG9tOiBQSU5DRVJfT1ZFUkxBUFxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGJvdHRvbVBpbmNlck5vZGUgPSBjcmVhdGVCb3R0b21QaW5jZXJDbG9zZWQoIHtcclxuICAgICAgc3Ryb2tlOiBIb29rZXNMYXdDb2xvcnMuUElOQ0VSU19TVFJPS0UsXHJcbiAgICAgIGxpbmVXaWR0aDogUElOQ0VSX0xJTkVfV0lEVEgsXHJcbiAgICAgIHRvcDogLVBJTkNFUl9PVkVSTEFQXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgaGluZ2VOb2RlID0gbmV3IEhpbmdlTm9kZSgge1xyXG4gICAgICBsZWZ0OiB0b3BQaW5jZXJOb2RlLnJpZ2h0IC0gMTIsXHJcbiAgICAgIGNlbnRlclk6IDBcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBhcm1Ob2RlID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgMjAsIEFSTV9IRUlHSFQsIHtcclxuICAgICAgZmlsbDogQVJNX0dSQURJRU5ULFxyXG4gICAgICBzdHJva2U6IEhvb2tlc0xhd0NvbG9ycy5ST0JPVElDX0FSTV9TVFJPS0UsXHJcbiAgICAgIGxpbmVXaWR0aDogMC41LFxyXG4gICAgICBsZWZ0OiBoaW5nZU5vZGUucmlnaHQgLSA1LFxyXG4gICAgICBjZW50ZXJZOiBoaW5nZU5vZGUuY2VudGVyWVxyXG4gICAgfSApO1xyXG5cclxuICAgIG9wdGlvbnMuY2hpbGRyZW4gPSBbIHRvcFBpbmNlck5vZGUsIGJvdHRvbVBpbmNlck5vZGUsIGFybU5vZGUsIGhpbmdlTm9kZSBdO1xyXG4gICAgcmV0dXJuIG5ldyBOb2RlKCBvcHRpb25zICk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlcyB0aGUgdG9wIHBpbmNlciBpbiBjbG9zZWQgcG9zaXRpb24uXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVUb3BQaW5jZXJDbG9zZWQoIG9wdGlvbnM6IFBhdGhPcHRpb25zICk6IE5vZGUge1xyXG4gIHJldHVybiBuZXcgUGF0aCggbmV3IFNoYXBlKCkuYXJjKCAwLCAwLCBQSU5DRVJfUkFESVVTLCAtMC45ICogTWF0aC5QSSwgLTAuMSAqIE1hdGguUEkgKSwgb3B0aW9ucyApO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlcyB0aGUgYm90dG9tIHBpbmNlciBpbiBjbG9zZWQgcG9zaXRpb24uXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVCb3R0b21QaW5jZXJDbG9zZWQoIG9wdGlvbnM6IFBhdGhPcHRpb25zICk6IE5vZGUge1xyXG4gIHJldHVybiBuZXcgUGF0aCggbmV3IFNoYXBlKCkuYXJjKCAwLCAwLCBQSU5DRVJfUkFESVVTLCAwLjkgKiBNYXRoLlBJLCAwLjEgKiBNYXRoLlBJLCB0cnVlICksIG9wdGlvbnMgKTtcclxufVxyXG5cclxuaG9va2VzTGF3LnJlZ2lzdGVyKCAnUm9ib3RpY0FybU5vZGUnLCBSb2JvdGljQXJtTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFVBQVUsTUFBTSxrQ0FBa0M7QUFFekQsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxTQUFTQyxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELFNBQVNDLFlBQVksRUFBRUMsY0FBYyxFQUFFQyxJQUFJLEVBQXVDQyxJQUFJLEVBQWVDLFNBQVMsUUFBUSxtQ0FBbUM7QUFDekosT0FBT0MsU0FBUyxNQUFNLG9CQUFvQjtBQUMxQyxPQUFPQyxlQUFlLE1BQU0sdUJBQXVCO0FBQ25ELE9BQU9DLGtCQUFrQixNQUFNLDBCQUEwQjtBQUN6RCxPQUFPQyxTQUFTLE1BQU0sZ0JBQWdCO0FBSXRDLE9BQU9DLFNBQVMsTUFBTSx1Q0FBdUM7QUFHN0Q7QUFDQSxNQUFNQyxhQUFhLEdBQUcsRUFBRTtBQUN4QixNQUFNQyxpQkFBaUIsR0FBRyxDQUFDO0FBQzNCLE1BQU1DLGNBQWMsR0FBRyxDQUFDO0FBQ3hCLE1BQU1DLFVBQVUsR0FBRyxFQUFFO0FBQ3JCLE1BQU1DLFlBQVksR0FBRyxJQUFJYixjQUFjLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUVZLFVBQVcsQ0FBQyxDQUMzREUsWUFBWSxDQUFFLENBQUMsRUFBRVQsZUFBZSxDQUFDVSxnQkFBaUIsQ0FBQyxDQUNuREQsWUFBWSxDQUFFLEdBQUcsRUFBRSxPQUFRLENBQUMsQ0FDNUJBLFlBQVksQ0FBRSxDQUFDLEVBQUVULGVBQWUsQ0FBQ1UsZ0JBQWlCLENBQUM7QUFDdEQsTUFBTUMsUUFBUSxHQUFHLElBQUlwQixVQUFVLENBQUUsRUFBRSxFQUFFLEVBQUcsQ0FBQztBQUN6QyxNQUFNcUIsWUFBWSxHQUFHLElBQUlqQixjQUFjLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUVnQixR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