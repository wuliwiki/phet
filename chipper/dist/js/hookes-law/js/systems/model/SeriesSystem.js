// Copyright 2015-2022, University of Colorado Boulder

/**
 * Model of 2 springs in series, pulled by a robotic arm.
 *
 * Feq = F1 = F2
 * keq = 1 / ( 1/k1 + 1/k2 )
 * xeq = x1 + x2
 * Eeq = E1 + E2
 *
 * where:
 *
 * F = applied force, N/m
 * k = spring constant, N/m
 * x = displacement from equilibrium position, m
 * E = stored energy, J
 * subscript "1" is for the left spring
 * subscript "2" is for the right spring
 * subscript "eq" is a spring that is equivalent to the 2 springs in series
 *
 * In the equations above, subscript "1" applies to the left spring, "2" applied to the right spring.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import RangeWithValue from '../../../../dot/js/RangeWithValue.js';
import RoboticArm from '../../common/model/RoboticArm.js';
import Spring from '../../common/model/Spring.js';
import hookesLaw from '../../hookesLaw.js';
export default class SeriesSystem {
  // left spring
  // right spring, in series with the left spring, with identical configuration
  // the single spring that is equivalent to the 2 springs in series
  // robotic arm, attached to right end of equivalent spring

  constructor(tandem) {
    //------------------------------------------------
    // Components of the system

    this.leftSpring = new Spring({
      logName: 'leftSpring',
      left: 0,
      // x position of the left end of the spring, units = m
      equilibriumLength: 0.75,
      // length of the spring at equilibrium, units = m
      springConstantRange: new RangeWithValue(200, 600, 200),
      // range and initial value of k1, units = N/m
      appliedForceRange: new RangeWithValue(-100, 100, 0),
      // range and initial value of Feq, units = N
      tandem: tandem.createTandem('leftSpring'),
      phetioDocumentation: 'The left spring in the series system'
    });
    this.rightSpring = new Spring({
      logName: 'rightSpring',
      left: this.leftSpring.rightProperty.value,
      // attached to the right end of the left spring
      equilibriumLength: this.leftSpring.equilibriumLength,
      springConstantRange: this.leftSpring.springConstantRange,
      appliedForceRange: this.leftSpring.appliedForceRange,
      tandem: tandem.createTandem('rightSpring'),
      phetioDocumentation: 'The right spring in the series system'
    });
    this.equivalentSpring = new Spring({
      logName: 'equivalentSpring',
      left: this.leftSpring.leftProperty.value,
      equilibriumLength: this.leftSpring.equilibriumLength + this.rightSpring.equilibriumLength,
      // keq = 1 / ( 1/k1 + 1/k2 )
      springConstantRange: new RangeWithValue(1 / (1 / this.leftSpring.springConstantRange.min + 1 / this.rightSpring.springConstantRange.min), 1 / (1 / this.leftSpring.springConstantRange.max + 1 / this.rightSpring.springConstantRange.max), 1 / (1 / this.leftSpring.springConstantRange.defaultValue + 1 / this.rightSpring.springConstantRange.defaultValue)),
      appliedForceRange: this.leftSpring.appliedForceRange,
      // Feq = F1 = F2
      tandem: tandem.createTandem('equivalentSpring'),
      phetioDocumentation: 'The single spring that is equivalent to the 2 springs in series'
    });
    assert && assert(this.equivalentSpring.displacementProperty.value === 0); // equivalent spring is at equilibrium

    this.roboticArm = new RoboticArm({
      left: this.equivalentSpring.rightProperty.value,
      right: this.equivalentSpring.rightProperty.value + this.equivalentSpring.lengthProperty.value,
      tandem: tandem.createTandem('roboticArm')
    });

    //------------------------------------------------
    // Property observers

    // Feq = F1 = F2
    this.equivalentSpring.appliedForceProperty.link(appliedForce => {
      this.leftSpring.appliedForceProperty.value = appliedForce; // F1 = Feq
      this.rightSpring.appliedForceProperty.value = appliedForce; // F2 = Feq
    });

    // keq = 1 / ( 1/k1 + 1/k2 )
    const updateEquivalentSpringConstant = () => {
      const leftSpringConstant = this.leftSpring.springConstantProperty.value;
      const rightSpringConstant = this.rightSpring.springConstantProperty.value;
      this.equivalentSpring.springConstantProperty.value = 1 / (1 / leftSpringConstant + 1 / rightSpringConstant);
    };
    this.leftSpring.springConstantProperty.link(updateEquivalentSpringConstant);
    this.rightSpring.springConstantProperty.link(updateEquivalentSpringConstant);

    // Robotic arm sets displacement of equivalent spring.
    let ignoreUpdates = false; // Used to prevent updates until both springs have been modified.
    this.roboticArm.leftProperty.link(left => {
      if (!ignoreUpdates) {
        // this will affect the displacement of both springs
        ignoreUpdates = true;
        this.equivalentSpring.displacementProperty.value = left - this.equivalentSpring.equilibriumXProperty.value;
        ignoreUpdates = false;
      }
    });

    // Connect right spring to left spring.
    this.leftSpring.rightProperty.link(right => {
      this.rightSpring.leftProperty.value = right;
    });

    // Connect robotic arm to equivalent spring.
    this.equivalentSpring.rightProperty.link(right => {
      this.roboticArm.leftProperty.value = right;
    });

    //------------------------------------------------
    // Check for conditions supported by the general Spring model that aren't allowed by this system

    this.leftSpring.leftProperty.lazyLink(left => {
      throw new Error(`Left end of left spring must remain fixed, left=${left}`);
    });
    this.equivalentSpring.leftProperty.lazyLink(left => {
      throw new Error(`Left end of equivalent spring must remain fixed, left=${left}`);
    });
    this.equivalentSpring.equilibriumXProperty.lazyLink(equilibriumX => {
      throw new Error(`Equilibrium position of equivalent spring must remain fixed, equilibriumX=${equilibriumX}`);
    });
  }
  reset() {
    this.leftSpring.reset();
    this.rightSpring.reset();
    this.roboticArm.reset();
    this.equivalentSpring.reset();
  }
}
hookesLaw.register('SeriesSystem', SeriesSystem);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSYW5nZVdpdGhWYWx1ZSIsIlJvYm90aWNBcm0iLCJTcHJpbmciLCJob29rZXNMYXciLCJTZXJpZXNTeXN0ZW0iLCJjb25zdHJ1Y3RvciIsInRhbmRlbSIsImxlZnRTcHJpbmciLCJsb2dOYW1lIiwibGVmdCIsImVxdWlsaWJyaXVtTGVuZ3RoIiwic3ByaW5nQ29uc3RhbnRSYW5nZSIsImFwcGxpZWRGb3JjZVJhbmdlIiwiY3JlYXRlVGFuZGVtIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsInJpZ2h0U3ByaW5nIiwicmlnaHRQcm9wZXJ0eSIsInZhbHVlIiwiZXF1aXZhbGVudFNwcmluZyIsImxlZnRQcm9wZXJ0eSIsIm1pbiIsIm1heCIsImRlZmF1bHRWYWx1ZSIsImFzc2VydCIsImRpc3BsYWNlbWVudFByb3BlcnR5Iiwicm9ib3RpY0FybSIsInJpZ2h0IiwibGVuZ3RoUHJvcGVydHkiLCJhcHBsaWVkRm9yY2VQcm9wZXJ0eSIsImxpbmsiLCJhcHBsaWVkRm9yY2UiLCJ1cGRhdGVFcXVpdmFsZW50U3ByaW5nQ29uc3RhbnQiLCJsZWZ0U3ByaW5nQ29uc3RhbnQiLCJzcHJpbmdDb25zdGFudFByb3BlcnR5IiwicmlnaHRTcHJpbmdDb25zdGFudCIsImlnbm9yZVVwZGF0ZXMiLCJlcXVpbGlicml1bVhQcm9wZXJ0eSIsImxhenlMaW5rIiwiRXJyb3IiLCJlcXVpbGlicml1bVgiLCJyZXNldCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiU2VyaWVzU3lzdGVtLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIE1vZGVsIG9mIDIgc3ByaW5ncyBpbiBzZXJpZXMsIHB1bGxlZCBieSBhIHJvYm90aWMgYXJtLlxyXG4gKlxyXG4gKiBGZXEgPSBGMSA9IEYyXHJcbiAqIGtlcSA9IDEgLyAoIDEvazEgKyAxL2syIClcclxuICogeGVxID0geDEgKyB4MlxyXG4gKiBFZXEgPSBFMSArIEUyXHJcbiAqXHJcbiAqIHdoZXJlOlxyXG4gKlxyXG4gKiBGID0gYXBwbGllZCBmb3JjZSwgTi9tXHJcbiAqIGsgPSBzcHJpbmcgY29uc3RhbnQsIE4vbVxyXG4gKiB4ID0gZGlzcGxhY2VtZW50IGZyb20gZXF1aWxpYnJpdW0gcG9zaXRpb24sIG1cclxuICogRSA9IHN0b3JlZCBlbmVyZ3ksIEpcclxuICogc3Vic2NyaXB0IFwiMVwiIGlzIGZvciB0aGUgbGVmdCBzcHJpbmdcclxuICogc3Vic2NyaXB0IFwiMlwiIGlzIGZvciB0aGUgcmlnaHQgc3ByaW5nXHJcbiAqIHN1YnNjcmlwdCBcImVxXCIgaXMgYSBzcHJpbmcgdGhhdCBpcyBlcXVpdmFsZW50IHRvIHRoZSAyIHNwcmluZ3MgaW4gc2VyaWVzXHJcbiAqXHJcbiAqIEluIHRoZSBlcXVhdGlvbnMgYWJvdmUsIHN1YnNjcmlwdCBcIjFcIiBhcHBsaWVzIHRvIHRoZSBsZWZ0IHNwcmluZywgXCIyXCIgYXBwbGllZCB0byB0aGUgcmlnaHQgc3ByaW5nLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBSYW5nZVdpdGhWYWx1ZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2VXaXRoVmFsdWUuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgUm9ib3RpY0FybSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvUm9ib3RpY0FybS5qcyc7XHJcbmltcG9ydCBTcHJpbmcgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL1NwcmluZy5qcyc7XHJcbmltcG9ydCBob29rZXNMYXcgZnJvbSAnLi4vLi4vaG9va2VzTGF3LmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlcmllc1N5c3RlbSB7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSBsZWZ0U3ByaW5nOiBTcHJpbmc7IC8vIGxlZnQgc3ByaW5nXHJcbiAgcHVibGljIHJlYWRvbmx5IHJpZ2h0U3ByaW5nOiBTcHJpbmc7IC8vIHJpZ2h0IHNwcmluZywgaW4gc2VyaWVzIHdpdGggdGhlIGxlZnQgc3ByaW5nLCB3aXRoIGlkZW50aWNhbCBjb25maWd1cmF0aW9uXHJcbiAgcHVibGljIHJlYWRvbmx5IGVxdWl2YWxlbnRTcHJpbmc6IFNwcmluZzsgLy8gdGhlIHNpbmdsZSBzcHJpbmcgdGhhdCBpcyBlcXVpdmFsZW50IHRvIHRoZSAyIHNwcmluZ3MgaW4gc2VyaWVzXHJcbiAgcHVibGljIHJlYWRvbmx5IHJvYm90aWNBcm06IFJvYm90aWNBcm07IC8vIHJvYm90aWMgYXJtLCBhdHRhY2hlZCB0byByaWdodCBlbmQgb2YgZXF1aXZhbGVudCBzcHJpbmdcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCB0YW5kZW06IFRhbmRlbSApIHtcclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgLy8gQ29tcG9uZW50cyBvZiB0aGUgc3lzdGVtXHJcblxyXG4gICAgdGhpcy5sZWZ0U3ByaW5nID0gbmV3IFNwcmluZygge1xyXG4gICAgICBsb2dOYW1lOiAnbGVmdFNwcmluZycsXHJcbiAgICAgIGxlZnQ6IDAsIC8vIHggcG9zaXRpb24gb2YgdGhlIGxlZnQgZW5kIG9mIHRoZSBzcHJpbmcsIHVuaXRzID0gbVxyXG4gICAgICBlcXVpbGlicml1bUxlbmd0aDogMC43NSwgLy8gbGVuZ3RoIG9mIHRoZSBzcHJpbmcgYXQgZXF1aWxpYnJpdW0sIHVuaXRzID0gbVxyXG4gICAgICBzcHJpbmdDb25zdGFudFJhbmdlOiBuZXcgUmFuZ2VXaXRoVmFsdWUoIDIwMCwgNjAwLCAyMDAgKSwgLy8gcmFuZ2UgYW5kIGluaXRpYWwgdmFsdWUgb2YgazEsIHVuaXRzID0gTi9tXHJcbiAgICAgIGFwcGxpZWRGb3JjZVJhbmdlOiBuZXcgUmFuZ2VXaXRoVmFsdWUoIC0xMDAsIDEwMCwgMCApLCAvLyByYW5nZSBhbmQgaW5pdGlhbCB2YWx1ZSBvZiBGZXEsIHVuaXRzID0gTlxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdsZWZ0U3ByaW5nJyApLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnVGhlIGxlZnQgc3ByaW5nIGluIHRoZSBzZXJpZXMgc3lzdGVtJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMucmlnaHRTcHJpbmcgPSBuZXcgU3ByaW5nKCB7XHJcbiAgICAgIGxvZ05hbWU6ICdyaWdodFNwcmluZycsXHJcbiAgICAgIGxlZnQ6IHRoaXMubGVmdFNwcmluZy5yaWdodFByb3BlcnR5LnZhbHVlLCAvLyBhdHRhY2hlZCB0byB0aGUgcmlnaHQgZW5kIG9mIHRoZSBsZWZ0IHNwcmluZ1xyXG4gICAgICBlcXVpbGlicml1bUxlbmd0aDogdGhpcy5sZWZ0U3ByaW5nLmVxdWlsaWJyaXVtTGVuZ3RoLFxyXG4gICAgICBzcHJpbmdDb25zdGFudFJhbmdlOiB0aGlzLmxlZnRTcHJpbmcuc3ByaW5nQ29uc3RhbnRSYW5nZSxcclxuICAgICAgYXBwbGllZEZvcmNlUmFuZ2U6IHRoaXMubGVmdFNwcmluZy5hcHBsaWVkRm9yY2VSYW5nZSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAncmlnaHRTcHJpbmcnICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdUaGUgcmlnaHQgc3ByaW5nIGluIHRoZSBzZXJpZXMgc3lzdGVtJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZXF1aXZhbGVudFNwcmluZyA9IG5ldyBTcHJpbmcoIHtcclxuICAgICAgbG9nTmFtZTogJ2VxdWl2YWxlbnRTcHJpbmcnLFxyXG4gICAgICBsZWZ0OiB0aGlzLmxlZnRTcHJpbmcubGVmdFByb3BlcnR5LnZhbHVlLFxyXG4gICAgICBlcXVpbGlicml1bUxlbmd0aDogdGhpcy5sZWZ0U3ByaW5nLmVxdWlsaWJyaXVtTGVuZ3RoICsgdGhpcy5yaWdodFNwcmluZy5lcXVpbGlicml1bUxlbmd0aCxcclxuICAgICAgLy8ga2VxID0gMSAvICggMS9rMSArIDEvazIgKVxyXG4gICAgICBzcHJpbmdDb25zdGFudFJhbmdlOiBuZXcgUmFuZ2VXaXRoVmFsdWUoXHJcbiAgICAgICAgMSAvICggKCAxIC8gdGhpcy5sZWZ0U3ByaW5nLnNwcmluZ0NvbnN0YW50UmFuZ2UubWluICkgKyAoIDEgLyB0aGlzLnJpZ2h0U3ByaW5nLnNwcmluZ0NvbnN0YW50UmFuZ2UubWluICkgKSxcclxuICAgICAgICAxIC8gKCAoIDEgLyB0aGlzLmxlZnRTcHJpbmcuc3ByaW5nQ29uc3RhbnRSYW5nZS5tYXggKSArICggMSAvIHRoaXMucmlnaHRTcHJpbmcuc3ByaW5nQ29uc3RhbnRSYW5nZS5tYXggKSApLFxyXG4gICAgICAgIDEgLyAoICggMSAvIHRoaXMubGVmdFNwcmluZy5zcHJpbmdDb25zdGFudFJhbmdlLmRlZmF1bHRWYWx1ZSApICsgKCAxIC8gdGhpcy5yaWdodFNwcmluZy5zcHJpbmdDb25zdGFudFJhbmdlLmRlZmF1bHRWYWx1ZSApICkgKSxcclxuICAgICAgYXBwbGllZEZvcmNlUmFuZ2U6IHRoaXMubGVmdFNwcmluZy5hcHBsaWVkRm9yY2VSYW5nZSwgLy8gRmVxID0gRjEgPSBGMlxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdlcXVpdmFsZW50U3ByaW5nJyApLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnVGhlIHNpbmdsZSBzcHJpbmcgdGhhdCBpcyBlcXVpdmFsZW50IHRvIHRoZSAyIHNwcmluZ3MgaW4gc2VyaWVzJ1xyXG4gICAgfSApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5lcXVpdmFsZW50U3ByaW5nLmRpc3BsYWNlbWVudFByb3BlcnR5LnZhbHVlID09PSAwICk7IC8vIGVxdWl2YWxlbnQgc3ByaW5nIGlzIGF0IGVxdWlsaWJyaXVtXHJcblxyXG4gICAgdGhpcy5yb2JvdGljQXJtID0gbmV3IFJvYm90aWNBcm0oIHtcclxuICAgICAgbGVmdDogdGhpcy5lcXVpdmFsZW50U3ByaW5nLnJpZ2h0UHJvcGVydHkudmFsdWUsXHJcbiAgICAgIHJpZ2h0OiB0aGlzLmVxdWl2YWxlbnRTcHJpbmcucmlnaHRQcm9wZXJ0eS52YWx1ZSArIHRoaXMuZXF1aXZhbGVudFNwcmluZy5sZW5ndGhQcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAncm9ib3RpY0FybScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAvLyBQcm9wZXJ0eSBvYnNlcnZlcnNcclxuXHJcbiAgICAvLyBGZXEgPSBGMSA9IEYyXHJcbiAgICB0aGlzLmVxdWl2YWxlbnRTcHJpbmcuYXBwbGllZEZvcmNlUHJvcGVydHkubGluayggYXBwbGllZEZvcmNlID0+IHtcclxuICAgICAgdGhpcy5sZWZ0U3ByaW5nLmFwcGxpZWRGb3JjZVByb3BlcnR5LnZhbHVlID0gYXBwbGllZEZvcmNlOyAvLyBGMSA9IEZlcVxyXG4gICAgICB0aGlzLnJpZ2h0U3ByaW5nLmFwcGxpZWRGb3JjZVByb3BlcnR5LnZhbHVlID0gYXBwbGllZEZvcmNlOyAvLyBGMiA9IEZlcVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGtlcSA9IDEgLyAoIDEvazEgKyAxL2syIClcclxuICAgIGNvbnN0IHVwZGF0ZUVxdWl2YWxlbnRTcHJpbmdDb25zdGFudCA9ICgpID0+IHtcclxuICAgICAgY29uc3QgbGVmdFNwcmluZ0NvbnN0YW50ID0gdGhpcy5sZWZ0U3ByaW5nLnNwcmluZ0NvbnN0YW50UHJvcGVydHkudmFsdWU7XHJcbiAgICAgIGNvbnN0IHJpZ2h0U3ByaW5nQ29uc3RhbnQgPSB0aGlzLnJpZ2h0U3ByaW5nLnNwcmluZ0NvbnN0YW50UHJvcGVydHkudmFsdWU7XHJcbiAgICAgIHRoaXMuZXF1aXZhbGVudFNwcmluZy5zcHJpbmdDb25zdGFudFByb3BlcnR5LnZhbHVlID0gKCAxIC8gKCAoIDEgLyBsZWZ0U3ByaW5nQ29uc3RhbnQgKSArICggMSAvIHJpZ2h0U3ByaW5nQ29uc3RhbnQgKSApICk7XHJcbiAgICB9O1xyXG4gICAgdGhpcy5sZWZ0U3ByaW5nLnNwcmluZ0NvbnN0YW50UHJvcGVydHkubGluayggdXBkYXRlRXF1aXZhbGVudFNwcmluZ0NvbnN0YW50ICk7XHJcbiAgICB0aGlzLnJpZ2h0U3ByaW5nLnNwcmluZ0NvbnN0YW50UHJvcGVydHkubGluayggdXBkYXRlRXF1aXZhbGVudFNwcmluZ0NvbnN0YW50ICk7XHJcblxyXG4gICAgLy8gUm9ib3RpYyBhcm0gc2V0cyBkaXNwbGFjZW1lbnQgb2YgZXF1aXZhbGVudCBzcHJpbmcuXHJcbiAgICBsZXQgaWdub3JlVXBkYXRlcyA9IGZhbHNlOyAvLyBVc2VkIHRvIHByZXZlbnQgdXBkYXRlcyB1bnRpbCBib3RoIHNwcmluZ3MgaGF2ZSBiZWVuIG1vZGlmaWVkLlxyXG4gICAgdGhpcy5yb2JvdGljQXJtLmxlZnRQcm9wZXJ0eS5saW5rKCBsZWZ0ID0+IHtcclxuICAgICAgaWYgKCAhaWdub3JlVXBkYXRlcyApIHtcclxuICAgICAgICAvLyB0aGlzIHdpbGwgYWZmZWN0IHRoZSBkaXNwbGFjZW1lbnQgb2YgYm90aCBzcHJpbmdzXHJcbiAgICAgICAgaWdub3JlVXBkYXRlcyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5lcXVpdmFsZW50U3ByaW5nLmRpc3BsYWNlbWVudFByb3BlcnR5LnZhbHVlID0gKCBsZWZ0IC0gdGhpcy5lcXVpdmFsZW50U3ByaW5nLmVxdWlsaWJyaXVtWFByb3BlcnR5LnZhbHVlICk7XHJcbiAgICAgICAgaWdub3JlVXBkYXRlcyA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQ29ubmVjdCByaWdodCBzcHJpbmcgdG8gbGVmdCBzcHJpbmcuXHJcbiAgICB0aGlzLmxlZnRTcHJpbmcucmlnaHRQcm9wZXJ0eS5saW5rKCByaWdodCA9PiB7XHJcbiAgICAgIHRoaXMucmlnaHRTcHJpbmcubGVmdFByb3BlcnR5LnZhbHVlID0gcmlnaHQ7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQ29ubmVjdCByb2JvdGljIGFybSB0byBlcXVpdmFsZW50IHNwcmluZy5cclxuICAgIHRoaXMuZXF1aXZhbGVudFNwcmluZy5yaWdodFByb3BlcnR5LmxpbmsoIHJpZ2h0ID0+IHtcclxuICAgICAgdGhpcy5yb2JvdGljQXJtLmxlZnRQcm9wZXJ0eS52YWx1ZSA9IHJpZ2h0O1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAvLyBDaGVjayBmb3IgY29uZGl0aW9ucyBzdXBwb3J0ZWQgYnkgdGhlIGdlbmVyYWwgU3ByaW5nIG1vZGVsIHRoYXQgYXJlbid0IGFsbG93ZWQgYnkgdGhpcyBzeXN0ZW1cclxuXHJcbiAgICB0aGlzLmxlZnRTcHJpbmcubGVmdFByb3BlcnR5LmxhenlMaW5rKCBsZWZ0ID0+IHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCBgTGVmdCBlbmQgb2YgbGVmdCBzcHJpbmcgbXVzdCByZW1haW4gZml4ZWQsIGxlZnQ9JHtsZWZ0fWAgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmVxdWl2YWxlbnRTcHJpbmcubGVmdFByb3BlcnR5LmxhenlMaW5rKCBsZWZ0ID0+IHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCBgTGVmdCBlbmQgb2YgZXF1aXZhbGVudCBzcHJpbmcgbXVzdCByZW1haW4gZml4ZWQsIGxlZnQ9JHtsZWZ0fWAgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmVxdWl2YWxlbnRTcHJpbmcuZXF1aWxpYnJpdW1YUHJvcGVydHkubGF6eUxpbmsoIGVxdWlsaWJyaXVtWCA9PiB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvciggYEVxdWlsaWJyaXVtIHBvc2l0aW9uIG9mIGVxdWl2YWxlbnQgc3ByaW5nIG11c3QgcmVtYWluIGZpeGVkLCBlcXVpbGlicml1bVg9JHtlcXVpbGlicml1bVh9YCApO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5sZWZ0U3ByaW5nLnJlc2V0KCk7XHJcbiAgICB0aGlzLnJpZ2h0U3ByaW5nLnJlc2V0KCk7XHJcbiAgICB0aGlzLnJvYm90aWNBcm0ucmVzZXQoKTtcclxuICAgIHRoaXMuZXF1aXZhbGVudFNwcmluZy5yZXNldCgpO1xyXG4gIH1cclxufVxyXG5cclxuaG9va2VzTGF3LnJlZ2lzdGVyKCAnU2VyaWVzU3lzdGVtJywgU2VyaWVzU3lzdGVtICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxjQUFjLE1BQU0sc0NBQXNDO0FBRWpFLE9BQU9DLFVBQVUsTUFBTSxrQ0FBa0M7QUFDekQsT0FBT0MsTUFBTSxNQUFNLDhCQUE4QjtBQUNqRCxPQUFPQyxTQUFTLE1BQU0sb0JBQW9CO0FBRTFDLGVBQWUsTUFBTUMsWUFBWSxDQUFDO0VBRUk7RUFDQztFQUNLO0VBQ0Y7O0VBRWpDQyxXQUFXQSxDQUFFQyxNQUFjLEVBQUc7SUFFbkM7SUFDQTs7SUFFQSxJQUFJLENBQUNDLFVBQVUsR0FBRyxJQUFJTCxNQUFNLENBQUU7TUFDNUJNLE9BQU8sRUFBRSxZQUFZO01BQ3JCQyxJQUFJLEVBQUUsQ0FBQztNQUFFO01BQ1RDLGlCQUFpQixFQUFFLElBQUk7TUFBRTtNQUN6QkMsbUJBQW1CLEVBQUUsSUFBSVgsY0FBYyxDQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBSSxDQUFDO01BQUU7TUFDMURZLGlCQUFpQixFQUFFLElBQUlaLGNBQWMsQ0FBRSxDQUFDLEdBQUcs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