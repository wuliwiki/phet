// Copyright 2015-2022, University of Colorado Boulder

/**
 * SeriesSystemNode is two springs in series, a robotic arm, and all visual representations that go with them.
 * The origin is at the point where the spring attaches to the wall.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Multilink from '../../../../axon/js/Multilink.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Utils from '../../../../dot/js/Utils.js';
import optionize from '../../../../phet-core/js/optionize.js';
import { Node } from '../../../../scenery/js/imports.js';
import HookesLawColors from '../../common/HookesLawColors.js';
import HookesLawConstants from '../../common/HookesLawConstants.js';
import AppliedForceVectorNode from '../../common/view/AppliedForceVectorNode.js';
import DisplacementVectorNode from '../../common/view/DisplacementVectorNode.js';
import EquilibriumPositionNode from '../../common/view/EquilibriumPositionNode.js';
import HookesLawSpringNode from '../../common/view/HookesLawSpringNode.js';
import NibNode from '../../common/view/NibNode.js';
import RoboticArmNode from '../../common/view/RoboticArmNode.js';
import SpringForceVectorNode from '../../common/view/SpringForceVectorNode.js';
import WallNode from '../../common/view/WallNode.js';
import hookesLaw from '../../hookesLaw.js';
import SeriesSpringControls from './SeriesSpringControls.js';
import SpringForceRepresentation from './SpringForceRepresentation.js';
export default class SeriesSystemNode extends Node {
  constructor(system, viewProperties, providedOptions) {
    const options = optionize()({
      // SelfOptions
      unitDisplacementLength: 1
    }, providedOptions);

    // to improve readability
    const leftSpring = system.leftSpring;
    const rightSpring = system.rightSpring;
    const roboticArm = system.roboticArm;
    const equivalentSpring = system.equivalentSpring;

    // This sim operates in 1 dimension (x), so center everything on y = 0.
    const yOrigin = 0;

    // number of interactions in progress that affect displacement
    const numberOfInteractionsInProgressProperty = new NumberProperty(0, {
      numberType: 'Integer',
      isValidValue: value => value >= 0
    });

    //------------------------------------------------
    // Scene graph

    // origin is at right-center of wall
    const wallNode = new WallNode(HookesLawConstants.WALL_SIZE, {
      right: options.unitDisplacementLength * leftSpring.leftProperty.value,
      centerY: yOrigin
    });
    const leftSpringNode = new HookesLawSpringNode(leftSpring, {
      unitDisplacementLength: options.unitDisplacementLength,
      loops: HookesLawConstants.SERIES_SPRINGS_LOOPS,
      frontColor: HookesLawColors.LEFT_SPRING_FRONT,
      middleColor: HookesLawColors.LEFT_SPRING_MIDDLE,
      backColor: HookesLawColors.LEFT_SPRING_BACK,
      // use x,y exclusively for layout, other translation options are inaccurate because we're using boundsMethod:'none'
      x: options.unitDisplacementLength * leftSpring.leftProperty.value,
      y: yOrigin
    });
    const rightSpringNode = new HookesLawSpringNode(rightSpring, {
      unitDisplacementLength: options.unitDisplacementLength,
      loops: HookesLawConstants.SERIES_SPRINGS_LOOPS,
      frontColor: HookesLawColors.RIGHT_SPRING_FRONT,
      middleColor: HookesLawColors.RIGHT_SPRING_MIDDLE,
      backColor: HookesLawColors.RIGHT_SPRING_BACK,
      // use x,y exclusively for layout, other translation options are inaccurate because we're using boundsMethod:'none'
      // x is based on rightSpring.leftProperty
      y: yOrigin
    });

    // pincers grab this
    const nibNode = new NibNode({
      fill: HookesLawColors.RIGHT_SPRING_MIDDLE,
      // x is based on rightSpring.rightProperty
      centerY: yOrigin
    });
    const roboticArmNode = new RoboticArmNode(roboticArm, rightSpring.rightRangeProperty, numberOfInteractionsInProgressProperty, {
      unitDisplacementLength: options.unitDisplacementLength,
      x: options.unitDisplacementLength * roboticArm.right,
      y: yOrigin,
      tandem: options.tandem.createTandem('roboticArmNode')
    });
    const equilibriumPositionNode = new EquilibriumPositionNode(wallNode.height, {
      centerX: options.unitDisplacementLength * equivalentSpring.equilibriumXProperty.value,
      centerY: yOrigin,
      visibleProperty: viewProperties.equilibriumPositionVisibleProperty,
      tandem: options.tandem.createTandem('equilibriumPositionNode')
    });
    const leftSpringForceVectorNode = new SpringForceVectorNode(leftSpring.springForceProperty, viewProperties.valuesVisibleProperty, {
      fill: HookesLawColors.LEFT_SPRING,
      decimalPlaces: HookesLawConstants.SERIES_SPRING_FORCE_COMPONENTS_DECIMAL_PLACES,
      // x is determined by leftSpring.rightProperty
      // bottom determined empirically, leftSpringNode.top is not accurate because we're using boundsMethod:'none'
      bottom: leftSpringNode.y - 65,
      tandem: options.tandem.createTandem('leftSpringForceVectorNode')
    });
    const leftAppliedForceVectorNode = new AppliedForceVectorNode(leftSpring.appliedForceProperty, viewProperties.valuesVisibleProperty, {
      fill: HookesLawColors.RIGHT_SPRING,
      // x is determined by leftSpring.rightProperty
      y: leftSpringForceVectorNode.y,
      tandem: options.tandem.createTandem('leftAppliedForceVectorNode')
    });
    const rightSpringForceVectorNode = new SpringForceVectorNode(rightSpring.springForceProperty, viewProperties.valuesVisibleProperty, {
      fill: HookesLawColors.RIGHT_SPRING,
      decimalPlaces: HookesLawConstants.SERIES_SPRING_FORCE_COMPONENTS_DECIMAL_PLACES,
      // x is determined by rightSpring.rightProperty
      bottom: leftSpringForceVectorNode.top - 10,
      tandem: options.tandem.createTandem('rightSpringForceVectorNode')
    });
    const appliedForceVectorNode = new AppliedForceVectorNode(equivalentSpring.appliedForceProperty, viewProperties.valuesVisibleProperty, {
      // x is determined by rightSpring.rightProperty
      y: rightSpringForceVectorNode.y,
      visibleProperty: viewProperties.appliedForceVectorVisibleProperty,
      tandem: options.tandem.createTandem('appliedForceVectorNode')
    });
    const totalSpringForceVectorNode = new SpringForceVectorNode(equivalentSpring.springForceProperty, viewProperties.valuesVisibleProperty, {
      // x is determined by rightSpring.rightProperty
      y: appliedForceVectorNode.y,
      tandem: options.tandem.createTandem('totalSpringForceVectorNode')
    });
    const displacementVectorNode = new DisplacementVectorNode(equivalentSpring.displacementProperty, viewProperties.valuesVisibleProperty, {
      unitDisplacementLength: options.unitDisplacementLength,
      x: equilibriumPositionNode.centerX,
      // top determined empirically, leftSpringNode.bottom is not accurate because we're using boundMethod:'none'
      top: leftSpringNode.y + 50,
      visibleProperty: viewProperties.displacementVectorVisibleProperty,
      tandem: options.tandem.createTandem('displacementVectorNode')
    });
    const springControls = new SeriesSpringControls(system, numberOfInteractionsInProgressProperty, {
      centerX: wallNode.left + (roboticArmNode.right - wallNode.left) / 2,
      top: wallNode.bottom + 25,
      maxWidth: roboticArmNode.right - wallNode.left,
      // constrain width for i18n
      tandem: options.tandem.createTandem('springControls')
    });
    options.children = [equilibriumPositionNode, roboticArmNode, leftSpringNode, rightSpringNode, wallNode, nibNode, leftSpringForceVectorNode, leftAppliedForceVectorNode, rightSpringForceVectorNode, appliedForceVectorNode, totalSpringForceVectorNode, displacementVectorNode, springControls];

    //------------------------------------------------
    // Property observers

    // move the right spring
    rightSpring.leftProperty.link(left => {
      // use x for positioning, other translation options are inaccurate because we're using boundsMethod:'none'
      rightSpringNode.x = options.unitDisplacementLength * left;
    });

    // switch between different spring force representations
    Multilink.multilink([viewProperties.springForceVectorVisibleProperty, viewProperties.springForceRepresentationProperty], (springForceVectorVisible, springForceRepresentation) => {
      // total
      totalSpringForceVectorNode.visible = springForceVectorVisible && springForceRepresentation === SpringForceRepresentation.TOTAL;

      // components
      const componentsVisible = springForceVectorVisible && springForceRepresentation === SpringForceRepresentation.COMPONENTS;
      rightSpringForceVectorNode.visible = leftSpringForceVectorNode.visible = leftAppliedForceVectorNode.visible = componentsVisible;
    });

    // position the vectors
    equivalentSpring.rightProperty.link(right => {
      appliedForceVectorNode.x = totalSpringForceVectorNode.x = options.unitDisplacementLength * right;
    });
    leftSpring.rightProperty.link(right => {
      leftSpringForceVectorNode.x = leftAppliedForceVectorNode.x = options.unitDisplacementLength * right;
    });
    rightSpring.rightProperty.link(right => {
      rightSpringForceVectorNode.x = nibNode.x = options.unitDisplacementLength * right;
    });

    // Open pincers when displacement is zero and no user interactions affecting displacement are talking place.
    Multilink.multilink([numberOfInteractionsInProgressProperty, equivalentSpring.displacementProperty], (numberOfInteractions, displacement) => {
      assert && assert(numberOfInteractions >= 0);
      const fixedDisplacement = Utils.toFixedNumber(displacement, HookesLawConstants.DISPLACEMENT_DECIMAL_PLACES);
      roboticArmNode.setPincersOpen(numberOfInteractions === 0 && fixedDisplacement === 0);
    });
    super(options);
  }
}
hookesLaw.register('SeriesSystemNode', SeriesSystemNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJOdW1iZXJQcm9wZXJ0eSIsIlV0aWxzIiwib3B0aW9uaXplIiwiTm9kZSIsIkhvb2tlc0xhd0NvbG9ycyIsIkhvb2tlc0xhd0NvbnN0YW50cyIsIkFwcGxpZWRGb3JjZVZlY3Rvck5vZGUiLCJEaXNwbGFjZW1lbnRWZWN0b3JOb2RlIiwiRXF1aWxpYnJpdW1Qb3NpdGlvbk5vZGUiLCJIb29rZXNMYXdTcHJpbmdOb2RlIiwiTmliTm9kZSIsIlJvYm90aWNBcm1Ob2RlIiwiU3ByaW5nRm9yY2VWZWN0b3JOb2RlIiwiV2FsbE5vZGUiLCJob29rZXNMYXciLCJTZXJpZXNTcHJpbmdDb250cm9scyIsIlNwcmluZ0ZvcmNlUmVwcmVzZW50YXRpb24iLCJTZXJpZXNTeXN0ZW1Ob2RlIiwiY29uc3RydWN0b3IiLCJzeXN0ZW0iLCJ2aWV3UHJvcGVydGllcyIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ1bml0RGlzcGxhY2VtZW50TGVuZ3RoIiwibGVmdFNwcmluZyIsInJpZ2h0U3ByaW5nIiwicm9ib3RpY0FybSIsImVxdWl2YWxlbnRTcHJpbmciLCJ5T3JpZ2luIiwibnVtYmVyT2ZJbnRlcmFjdGlvbnNJblByb2dyZXNzUHJvcGVydHkiLCJudW1iZXJUeXBlIiwiaXNWYWxpZFZhbHVlIiwidmFsdWUiLCJ3YWxsTm9kZSIsIldBTExfU0laRSIsInJpZ2h0IiwibGVmdFByb3BlcnR5IiwiY2VudGVyWSIsImxlZnRTcHJpbmdOb2RlIiwibG9vcHMiLCJTRVJJRVNfU1BSSU5HU19MT09QUyIsImZyb250Q29sb3IiLCJMRUZUX1NQUklOR19GUk9OVCIsIm1pZGRsZUNvbG9yIiwiTEVGVF9TUFJJTkdfTUlERExFIiwiYmFja0NvbG9yIiwiTEVGVF9TUFJJTkdfQkFDSyIsIngiLCJ5IiwicmlnaHRTcHJpbmdOb2RlIiwiUklHSFRfU1BSSU5HX0ZST05UIiwiUklHSFRfU1BSSU5HX01JRERMRSIsIlJJR0hUX1NQUklOR19CQUNLIiwibmliTm9kZSIsImZpbGwiLCJyb2JvdGljQXJtTm9kZSIsInJpZ2h0UmFuZ2VQcm9wZXJ0eSIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsImVxdWlsaWJyaXVtUG9zaXRpb25Ob2RlIiwiaGVpZ2h0IiwiY2VudGVyWCIsImVxdWlsaWJyaXVtWFByb3BlcnR5IiwidmlzaWJsZVByb3BlcnR5IiwiZXF1aWxpYnJpdW1Qb3NpdGlvblZpc2libGVQcm9wZXJ0eSIsImxlZnRTcHJpbmdGb3JjZVZlY3Rvck5vZGUiLCJzcHJpbmdGb3JjZVByb3BlcnR5IiwidmFsdWVzVmlzaWJsZVByb3BlcnR5IiwiTEVGVF9TUFJJTkciLCJkZWNpbWFsUGxhY2VzIiwiU0VSSUVTX1NQUklOR19GT1JDRV9DT01QT05FTlRTX0RFQ0lNQUxfUExBQ0VTIiwiYm90dG9tIiwibGVmdEFwcGxpZWRGb3JjZVZlY3Rvck5vZGUiLCJhcHBsaWVkRm9yY2VQcm9wZXJ0eSIsIlJJR0hUX1NQUklORyIsInJpZ2h0U3ByaW5nRm9yY2VWZWN0b3JOb2RlIiwidG9wIiwiYXBwbGllZEZvcmNlVmVjdG9yTm9kZSIsImFwcGxpZWRGb3JjZVZlY3RvclZpc2libGVQcm9wZXJ0eSIsInRvdGFsU3ByaW5nRm9yY2VWZWN0b3JOb2RlIiwiZGlzcGxhY2VtZW50VmVjdG9yTm9kZSIsImRpc3BsYWNlbWVudFByb3BlcnR5IiwiZGlzcGxhY2VtZW50VmVjdG9yVmlzaWJsZVByb3BlcnR5Iiwic3ByaW5nQ29udHJvbHMiLCJsZWZ0IiwibWF4V2lkdGgiLCJjaGlsZHJlbiIsImxpbmsiLCJtdWx0aWxpbmsiLCJzcHJpbmdGb3JjZVZlY3RvclZpc2libGVQcm9wZXJ0eSIsInNwcmluZ0ZvcmNlUmVwcmVzZW50YXRpb25Qcm9wZXJ0eSIsInNwcmluZ0ZvcmNlVmVjdG9yVmlzaWJsZSIsInNwcmluZ0ZvcmNlUmVwcmVzZW50YXRpb24iLCJ2aXNpYmxlIiwiVE9UQUwiLCJjb21wb25lbnRzVmlzaWJsZSIsIkNPTVBPTkVOVFMiLCJyaWdodFByb3BlcnR5IiwibnVtYmVyT2ZJbnRlcmFjdGlvbnMiLCJkaXNwbGFjZW1lbnQiLCJhc3NlcnQiLCJmaXhlZERpc3BsYWNlbWVudCIsInRvRml4ZWROdW1iZXIiLCJESVNQTEFDRU1FTlRfREVDSU1BTF9QTEFDRVMiLCJzZXRQaW5jZXJzT3BlbiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiU2VyaWVzU3lzdGVtTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTZXJpZXNTeXN0ZW1Ob2RlIGlzIHR3byBzcHJpbmdzIGluIHNlcmllcywgYSByb2JvdGljIGFybSwgYW5kIGFsbCB2aXN1YWwgcmVwcmVzZW50YXRpb25zIHRoYXQgZ28gd2l0aCB0aGVtLlxyXG4gKiBUaGUgb3JpZ2luIGlzIGF0IHRoZSBwb2ludCB3aGVyZSB0aGUgc3ByaW5nIGF0dGFjaGVzIHRvIHRoZSB3YWxsLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgeyBOb2RlLCBOb2RlT3B0aW9ucywgTm9kZVRyYW5zbGF0aW9uT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBIb29rZXNMYXdDb2xvcnMgZnJvbSAnLi4vLi4vY29tbW9uL0hvb2tlc0xhd0NvbG9ycy5qcyc7XHJcbmltcG9ydCBIb29rZXNMYXdDb25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL0hvb2tlc0xhd0NvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBBcHBsaWVkRm9yY2VWZWN0b3JOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0FwcGxpZWRGb3JjZVZlY3Rvck5vZGUuanMnO1xyXG5pbXBvcnQgRGlzcGxhY2VtZW50VmVjdG9yTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9EaXNwbGFjZW1lbnRWZWN0b3JOb2RlLmpzJztcclxuaW1wb3J0IEVxdWlsaWJyaXVtUG9zaXRpb25Ob2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0VxdWlsaWJyaXVtUG9zaXRpb25Ob2RlLmpzJztcclxuaW1wb3J0IEhvb2tlc0xhd1NwcmluZ05vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvSG9va2VzTGF3U3ByaW5nTm9kZS5qcyc7XHJcbmltcG9ydCBOaWJOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L05pYk5vZGUuanMnO1xyXG5pbXBvcnQgUm9ib3RpY0FybU5vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvUm9ib3RpY0FybU5vZGUuanMnO1xyXG5pbXBvcnQgU3ByaW5nRm9yY2VWZWN0b3JOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L1NwcmluZ0ZvcmNlVmVjdG9yTm9kZS5qcyc7XHJcbmltcG9ydCBXYWxsTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9XYWxsTm9kZS5qcyc7XHJcbmltcG9ydCBob29rZXNMYXcgZnJvbSAnLi4vLi4vaG9va2VzTGF3LmpzJztcclxuaW1wb3J0IFNlcmllc1N5c3RlbSBmcm9tICcuLi9tb2RlbC9TZXJpZXNTeXN0ZW0uanMnO1xyXG5pbXBvcnQgU2VyaWVzU3ByaW5nQ29udHJvbHMgZnJvbSAnLi9TZXJpZXNTcHJpbmdDb250cm9scy5qcyc7XHJcbmltcG9ydCBTcHJpbmdGb3JjZVJlcHJlc2VudGF0aW9uIGZyb20gJy4vU3ByaW5nRm9yY2VSZXByZXNlbnRhdGlvbi5qcyc7XHJcbmltcG9ydCBTeXN0ZW1zVmlld1Byb3BlcnRpZXMgZnJvbSAnLi9TeXN0ZW1zVmlld1Byb3BlcnRpZXMuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICB1bml0RGlzcGxhY2VtZW50TGVuZ3RoPzogbnVtYmVyOyAvLyB2aWV3IGxlbmd0aCBvZiAxIG1ldGVyIG9mIGRpc3BsYWNlbWVudFxyXG59O1xyXG5cclxudHlwZSBTZXJpZXNTeXN0ZW1Ob2RlT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgTm9kZVRyYW5zbGF0aW9uT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxOb2RlT3B0aW9ucywgJ3RhbmRlbScgfCAndmlzaWJsZVByb3BlcnR5Jz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZXJpZXNTeXN0ZW1Ob2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvciggc3lzdGVtOiBTZXJpZXNTeXN0ZW0sIHZpZXdQcm9wZXJ0aWVzOiBTeXN0ZW1zVmlld1Byb3BlcnRpZXMsIHByb3ZpZGVkT3B0aW9uczogU2VyaWVzU3lzdGVtTm9kZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxTZXJpZXNTeXN0ZW1Ob2RlT3B0aW9ucywgU2VsZk9wdGlvbnMsIE5vZGVPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBTZWxmT3B0aW9uc1xyXG4gICAgICB1bml0RGlzcGxhY2VtZW50TGVuZ3RoOiAxXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyB0byBpbXByb3ZlIHJlYWRhYmlsaXR5XHJcbiAgICBjb25zdCBsZWZ0U3ByaW5nID0gc3lzdGVtLmxlZnRTcHJpbmc7XHJcbiAgICBjb25zdCByaWdodFNwcmluZyA9IHN5c3RlbS5yaWdodFNwcmluZztcclxuICAgIGNvbnN0IHJvYm90aWNBcm0gPSBzeXN0ZW0ucm9ib3RpY0FybTtcclxuICAgIGNvbnN0IGVxdWl2YWxlbnRTcHJpbmcgPSBzeXN0ZW0uZXF1aXZhbGVudFNwcmluZztcclxuXHJcbiAgICAvLyBUaGlzIHNpbSBvcGVyYXRlcyBpbiAxIGRpbWVuc2lvbiAoeCksIHNvIGNlbnRlciBldmVyeXRoaW5nIG9uIHkgPSAwLlxyXG4gICAgY29uc3QgeU9yaWdpbiA9IDA7XHJcblxyXG4gICAgLy8gbnVtYmVyIG9mIGludGVyYWN0aW9ucyBpbiBwcm9ncmVzcyB0aGF0IGFmZmVjdCBkaXNwbGFjZW1lbnRcclxuICAgIGNvbnN0IG51bWJlck9mSW50ZXJhY3Rpb25zSW5Qcm9ncmVzc1Byb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCAwLCB7XHJcbiAgICAgIG51bWJlclR5cGU6ICdJbnRlZ2VyJyxcclxuICAgICAgaXNWYWxpZFZhbHVlOiB2YWx1ZSA9PiAoIHZhbHVlID49IDAgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAvLyBTY2VuZSBncmFwaFxyXG5cclxuICAgIC8vIG9yaWdpbiBpcyBhdCByaWdodC1jZW50ZXIgb2Ygd2FsbFxyXG4gICAgY29uc3Qgd2FsbE5vZGUgPSBuZXcgV2FsbE5vZGUoIEhvb2tlc0xhd0NvbnN0YW50cy5XQUxMX1NJWkUsIHtcclxuICAgICAgcmlnaHQ6IG9wdGlvbnMudW5pdERpc3BsYWNlbWVudExlbmd0aCAqIGxlZnRTcHJpbmcubGVmdFByb3BlcnR5LnZhbHVlLFxyXG4gICAgICBjZW50ZXJZOiB5T3JpZ2luXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgbGVmdFNwcmluZ05vZGUgPSBuZXcgSG9va2VzTGF3U3ByaW5nTm9kZSggbGVmdFNwcmluZywge1xyXG4gICAgICB1bml0RGlzcGxhY2VtZW50TGVuZ3RoOiBvcHRpb25zLnVuaXREaXNwbGFjZW1lbnRMZW5ndGgsXHJcbiAgICAgIGxvb3BzOiBIb29rZXNMYXdDb25zdGFudHMuU0VSSUVTX1NQUklOR1NfTE9PUFMsXHJcbiAgICAgIGZyb250Q29sb3I6IEhvb2tlc0xhd0NvbG9ycy5MRUZUX1NQUklOR19GUk9OVCxcclxuICAgICAgbWlkZGxlQ29sb3I6IEhvb2tlc0xhd0NvbG9ycy5MRUZUX1NQUklOR19NSURETEUsXHJcbiAgICAgIGJhY2tDb2xvcjogSG9va2VzTGF3Q29sb3JzLkxFRlRfU1BSSU5HX0JBQ0ssXHJcbiAgICAgIC8vIHVzZSB4LHkgZXhjbHVzaXZlbHkgZm9yIGxheW91dCwgb3RoZXIgdHJhbnNsYXRpb24gb3B0aW9ucyBhcmUgaW5hY2N1cmF0ZSBiZWNhdXNlIHdlJ3JlIHVzaW5nIGJvdW5kc01ldGhvZDonbm9uZSdcclxuICAgICAgeDogb3B0aW9ucy51bml0RGlzcGxhY2VtZW50TGVuZ3RoICogbGVmdFNwcmluZy5sZWZ0UHJvcGVydHkudmFsdWUsXHJcbiAgICAgIHk6IHlPcmlnaW5cclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCByaWdodFNwcmluZ05vZGUgPSBuZXcgSG9va2VzTGF3U3ByaW5nTm9kZSggcmlnaHRTcHJpbmcsIHtcclxuICAgICAgdW5pdERpc3BsYWNlbWVudExlbmd0aDogb3B0aW9ucy51bml0RGlzcGxhY2VtZW50TGVuZ3RoLFxyXG4gICAgICBsb29wczogSG9va2VzTGF3Q29uc3RhbnRzLlNFUklFU19TUFJJTkdTX0xPT1BTLFxyXG4gICAgICBmcm9udENvbG9yOiBIb29rZXNMYXdDb2xvcnMuUklHSFRfU1BSSU5HX0ZST05ULFxyXG4gICAgICBtaWRkbGVDb2xvcjogSG9va2VzTGF3Q29sb3JzLlJJR0hUX1NQUklOR19NSURETEUsXHJcbiAgICAgIGJhY2tDb2xvcjogSG9va2VzTGF3Q29sb3JzLlJJR0hUX1NQUklOR19CQUNLLFxyXG4gICAgICAvLyB1c2UgeCx5IGV4Y2x1c2l2ZWx5IGZvciBsYXlvdXQsIG90aGVyIHRyYW5zbGF0aW9uIG9wdGlvbnMgYXJlIGluYWNjdXJhdGUgYmVjYXVzZSB3ZSdyZSB1c2luZyBib3VuZHNNZXRob2Q6J25vbmUnXHJcbiAgICAgIC8vIHggaXMgYmFzZWQgb24gcmlnaHRTcHJpbmcubGVmdFByb3BlcnR5XHJcbiAgICAgIHk6IHlPcmlnaW5cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBwaW5jZXJzIGdyYWIgdGhpc1xyXG4gICAgY29uc3QgbmliTm9kZSA9IG5ldyBOaWJOb2RlKCB7XHJcbiAgICAgIGZpbGw6IEhvb2tlc0xhd0NvbG9ycy5SSUdIVF9TUFJJTkdfTUlERExFLFxyXG4gICAgICAvLyB4IGlzIGJhc2VkIG9uIHJpZ2h0U3ByaW5nLnJpZ2h0UHJvcGVydHlcclxuICAgICAgY2VudGVyWTogeU9yaWdpblxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHJvYm90aWNBcm1Ob2RlID0gbmV3IFJvYm90aWNBcm1Ob2RlKCByb2JvdGljQXJtLCByaWdodFNwcmluZy5yaWdodFJhbmdlUHJvcGVydHksIG51bWJlck9mSW50ZXJhY3Rpb25zSW5Qcm9ncmVzc1Byb3BlcnR5LCB7XHJcbiAgICAgIHVuaXREaXNwbGFjZW1lbnRMZW5ndGg6IG9wdGlvbnMudW5pdERpc3BsYWNlbWVudExlbmd0aCxcclxuICAgICAgeDogb3B0aW9ucy51bml0RGlzcGxhY2VtZW50TGVuZ3RoICogcm9ib3RpY0FybS5yaWdodCxcclxuICAgICAgeTogeU9yaWdpbixcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdyb2JvdGljQXJtTm9kZScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGVxdWlsaWJyaXVtUG9zaXRpb25Ob2RlID0gbmV3IEVxdWlsaWJyaXVtUG9zaXRpb25Ob2RlKCB3YWxsTm9kZS5oZWlnaHQsIHtcclxuICAgICAgY2VudGVyWDogb3B0aW9ucy51bml0RGlzcGxhY2VtZW50TGVuZ3RoICogZXF1aXZhbGVudFNwcmluZy5lcXVpbGlicml1bVhQcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgY2VudGVyWTogeU9yaWdpbixcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiB2aWV3UHJvcGVydGllcy5lcXVpbGlicml1bVBvc2l0aW9uVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2VxdWlsaWJyaXVtUG9zaXRpb25Ob2RlJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgbGVmdFNwcmluZ0ZvcmNlVmVjdG9yTm9kZSA9IG5ldyBTcHJpbmdGb3JjZVZlY3Rvck5vZGUoXHJcbiAgICAgIGxlZnRTcHJpbmcuc3ByaW5nRm9yY2VQcm9wZXJ0eSwgdmlld1Byb3BlcnRpZXMudmFsdWVzVmlzaWJsZVByb3BlcnR5LCB7XHJcbiAgICAgICAgZmlsbDogSG9va2VzTGF3Q29sb3JzLkxFRlRfU1BSSU5HLFxyXG4gICAgICAgIGRlY2ltYWxQbGFjZXM6IEhvb2tlc0xhd0NvbnN0YW50cy5TRVJJRVNfU1BSSU5HX0ZPUkNFX0NPTVBPTkVOVFNfREVDSU1BTF9QTEFDRVMsXHJcbiAgICAgICAgLy8geCBpcyBkZXRlcm1pbmVkIGJ5IGxlZnRTcHJpbmcucmlnaHRQcm9wZXJ0eVxyXG4gICAgICAgIC8vIGJvdHRvbSBkZXRlcm1pbmVkIGVtcGlyaWNhbGx5LCBsZWZ0U3ByaW5nTm9kZS50b3AgaXMgbm90IGFjY3VyYXRlIGJlY2F1c2Ugd2UncmUgdXNpbmcgYm91bmRzTWV0aG9kOidub25lJ1xyXG4gICAgICAgIGJvdHRvbTogbGVmdFNwcmluZ05vZGUueSAtIDY1LFxyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnbGVmdFNwcmluZ0ZvcmNlVmVjdG9yTm9kZScgKVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgbGVmdEFwcGxpZWRGb3JjZVZlY3Rvck5vZGUgPSBuZXcgQXBwbGllZEZvcmNlVmVjdG9yTm9kZShcclxuICAgICAgbGVmdFNwcmluZy5hcHBsaWVkRm9yY2VQcm9wZXJ0eSwgdmlld1Byb3BlcnRpZXMudmFsdWVzVmlzaWJsZVByb3BlcnR5LCB7XHJcbiAgICAgICAgZmlsbDogSG9va2VzTGF3Q29sb3JzLlJJR0hUX1NQUklORyxcclxuICAgICAgICAvLyB4IGlzIGRldGVybWluZWQgYnkgbGVmdFNwcmluZy5yaWdodFByb3BlcnR5XHJcbiAgICAgICAgeTogbGVmdFNwcmluZ0ZvcmNlVmVjdG9yTm9kZS55LFxyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnbGVmdEFwcGxpZWRGb3JjZVZlY3Rvck5vZGUnIClcclxuICAgICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHJpZ2h0U3ByaW5nRm9yY2VWZWN0b3JOb2RlID0gbmV3IFNwcmluZ0ZvcmNlVmVjdG9yTm9kZShcclxuICAgICAgcmlnaHRTcHJpbmcuc3ByaW5nRm9yY2VQcm9wZXJ0eSwgdmlld1Byb3BlcnRpZXMudmFsdWVzVmlzaWJsZVByb3BlcnR5LCB7XHJcbiAgICAgICAgZmlsbDogSG9va2VzTGF3Q29sb3JzLlJJR0hUX1NQUklORyxcclxuICAgICAgICBkZWNpbWFsUGxhY2VzOiBIb29rZXNMYXdDb25zdGFudHMuU0VSSUVTX1NQUklOR19GT1JDRV9DT01QT05FTlRTX0RFQ0lNQUxfUExBQ0VTLFxyXG4gICAgICAgIC8vIHggaXMgZGV0ZXJtaW5lZCBieSByaWdodFNwcmluZy5yaWdodFByb3BlcnR5XHJcbiAgICAgICAgYm90dG9tOiBsZWZ0U3ByaW5nRm9yY2VWZWN0b3JOb2RlLnRvcCAtIDEwLFxyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncmlnaHRTcHJpbmdGb3JjZVZlY3Rvck5vZGUnIClcclxuICAgICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGFwcGxpZWRGb3JjZVZlY3Rvck5vZGUgPSBuZXcgQXBwbGllZEZvcmNlVmVjdG9yTm9kZShcclxuICAgICAgZXF1aXZhbGVudFNwcmluZy5hcHBsaWVkRm9yY2VQcm9wZXJ0eSwgdmlld1Byb3BlcnRpZXMudmFsdWVzVmlzaWJsZVByb3BlcnR5LCB7XHJcbiAgICAgICAgLy8geCBpcyBkZXRlcm1pbmVkIGJ5IHJpZ2h0U3ByaW5nLnJpZ2h0UHJvcGVydHlcclxuICAgICAgICB5OiByaWdodFNwcmluZ0ZvcmNlVmVjdG9yTm9kZS55LFxyXG4gICAgICAgIHZpc2libGVQcm9wZXJ0eTogdmlld1Byb3BlcnRpZXMuYXBwbGllZEZvcmNlVmVjdG9yVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnYXBwbGllZEZvcmNlVmVjdG9yTm9kZScgKVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgdG90YWxTcHJpbmdGb3JjZVZlY3Rvck5vZGUgPSBuZXcgU3ByaW5nRm9yY2VWZWN0b3JOb2RlKFxyXG4gICAgICBlcXVpdmFsZW50U3ByaW5nLnNwcmluZ0ZvcmNlUHJvcGVydHksIHZpZXdQcm9wZXJ0aWVzLnZhbHVlc1Zpc2libGVQcm9wZXJ0eSwge1xyXG4gICAgICAgIC8vIHggaXMgZGV0ZXJtaW5lZCBieSByaWdodFNwcmluZy5yaWdodFByb3BlcnR5XHJcbiAgICAgICAgeTogYXBwbGllZEZvcmNlVmVjdG9yTm9kZS55LFxyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndG90YWxTcHJpbmdGb3JjZVZlY3Rvck5vZGUnIClcclxuICAgICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGRpc3BsYWNlbWVudFZlY3Rvck5vZGUgPSBuZXcgRGlzcGxhY2VtZW50VmVjdG9yTm9kZShcclxuICAgICAgZXF1aXZhbGVudFNwcmluZy5kaXNwbGFjZW1lbnRQcm9wZXJ0eSwgdmlld1Byb3BlcnRpZXMudmFsdWVzVmlzaWJsZVByb3BlcnR5LCB7XHJcbiAgICAgICAgdW5pdERpc3BsYWNlbWVudExlbmd0aDogb3B0aW9ucy51bml0RGlzcGxhY2VtZW50TGVuZ3RoLFxyXG4gICAgICAgIHg6IGVxdWlsaWJyaXVtUG9zaXRpb25Ob2RlLmNlbnRlclgsXHJcbiAgICAgICAgLy8gdG9wIGRldGVybWluZWQgZW1waXJpY2FsbHksIGxlZnRTcHJpbmdOb2RlLmJvdHRvbSBpcyBub3QgYWNjdXJhdGUgYmVjYXVzZSB3ZSdyZSB1c2luZyBib3VuZE1ldGhvZDonbm9uZSdcclxuICAgICAgICB0b3A6IGxlZnRTcHJpbmdOb2RlLnkgKyA1MCxcclxuICAgICAgICB2aXNpYmxlUHJvcGVydHk6IHZpZXdQcm9wZXJ0aWVzLmRpc3BsYWNlbWVudFZlY3RvclZpc2libGVQcm9wZXJ0eSxcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2Rpc3BsYWNlbWVudFZlY3Rvck5vZGUnIClcclxuICAgICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHNwcmluZ0NvbnRyb2xzID0gbmV3IFNlcmllc1NwcmluZ0NvbnRyb2xzKCBzeXN0ZW0sIG51bWJlck9mSW50ZXJhY3Rpb25zSW5Qcm9ncmVzc1Byb3BlcnR5LCB7XHJcbiAgICAgIGNlbnRlclg6IHdhbGxOb2RlLmxlZnQgKyAoIHJvYm90aWNBcm1Ob2RlLnJpZ2h0IC0gd2FsbE5vZGUubGVmdCApIC8gMixcclxuICAgICAgdG9wOiB3YWxsTm9kZS5ib3R0b20gKyAyNSxcclxuICAgICAgbWF4V2lkdGg6IHJvYm90aWNBcm1Ob2RlLnJpZ2h0IC0gd2FsbE5vZGUubGVmdCwgLy8gY29uc3RyYWluIHdpZHRoIGZvciBpMThuXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnc3ByaW5nQ29udHJvbHMnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gW1xyXG4gICAgICBlcXVpbGlicml1bVBvc2l0aW9uTm9kZSwgcm9ib3RpY0FybU5vZGUsIGxlZnRTcHJpbmdOb2RlLCByaWdodFNwcmluZ05vZGUsIHdhbGxOb2RlLCBuaWJOb2RlLFxyXG4gICAgICBsZWZ0U3ByaW5nRm9yY2VWZWN0b3JOb2RlLCBsZWZ0QXBwbGllZEZvcmNlVmVjdG9yTm9kZSwgcmlnaHRTcHJpbmdGb3JjZVZlY3Rvck5vZGUsXHJcbiAgICAgIGFwcGxpZWRGb3JjZVZlY3Rvck5vZGUsIHRvdGFsU3ByaW5nRm9yY2VWZWN0b3JOb2RlLCBkaXNwbGFjZW1lbnRWZWN0b3JOb2RlLFxyXG4gICAgICBzcHJpbmdDb250cm9sc1xyXG4gICAgXTtcclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgLy8gUHJvcGVydHkgb2JzZXJ2ZXJzXHJcblxyXG4gICAgLy8gbW92ZSB0aGUgcmlnaHQgc3ByaW5nXHJcbiAgICByaWdodFNwcmluZy5sZWZ0UHJvcGVydHkubGluayggbGVmdCA9PiB7XHJcbiAgICAgIC8vIHVzZSB4IGZvciBwb3NpdGlvbmluZywgb3RoZXIgdHJhbnNsYXRpb24gb3B0aW9ucyBhcmUgaW5hY2N1cmF0ZSBiZWNhdXNlIHdlJ3JlIHVzaW5nIGJvdW5kc01ldGhvZDonbm9uZSdcclxuICAgICAgcmlnaHRTcHJpbmdOb2RlLnggPSAoIG9wdGlvbnMudW5pdERpc3BsYWNlbWVudExlbmd0aCAqIGxlZnQgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBzd2l0Y2ggYmV0d2VlbiBkaWZmZXJlbnQgc3ByaW5nIGZvcmNlIHJlcHJlc2VudGF0aW9uc1xyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayggWyB2aWV3UHJvcGVydGllcy5zcHJpbmdGb3JjZVZlY3RvclZpc2libGVQcm9wZXJ0eSwgdmlld1Byb3BlcnRpZXMuc3ByaW5nRm9yY2VSZXByZXNlbnRhdGlvblByb3BlcnR5IF0sXHJcbiAgICAgICggc3ByaW5nRm9yY2VWZWN0b3JWaXNpYmxlLCBzcHJpbmdGb3JjZVJlcHJlc2VudGF0aW9uICkgPT4ge1xyXG5cclxuICAgICAgICAvLyB0b3RhbFxyXG4gICAgICAgIHRvdGFsU3ByaW5nRm9yY2VWZWN0b3JOb2RlLnZpc2libGUgPVxyXG4gICAgICAgICAgc3ByaW5nRm9yY2VWZWN0b3JWaXNpYmxlICYmICggc3ByaW5nRm9yY2VSZXByZXNlbnRhdGlvbiA9PT0gU3ByaW5nRm9yY2VSZXByZXNlbnRhdGlvbi5UT1RBTCApO1xyXG5cclxuICAgICAgICAvLyBjb21wb25lbnRzXHJcbiAgICAgICAgY29uc3QgY29tcG9uZW50c1Zpc2libGUgPVxyXG4gICAgICAgICAgc3ByaW5nRm9yY2VWZWN0b3JWaXNpYmxlICYmICggc3ByaW5nRm9yY2VSZXByZXNlbnRhdGlvbiA9PT0gU3ByaW5nRm9yY2VSZXByZXNlbnRhdGlvbi5DT01QT05FTlRTICk7XHJcbiAgICAgICAgcmlnaHRTcHJpbmdGb3JjZVZlY3Rvck5vZGUudmlzaWJsZSA9IGxlZnRTcHJpbmdGb3JjZVZlY3Rvck5vZGUudmlzaWJsZSA9IGxlZnRBcHBsaWVkRm9yY2VWZWN0b3JOb2RlLnZpc2libGUgPSBjb21wb25lbnRzVmlzaWJsZTtcclxuICAgICAgfSApO1xyXG5cclxuICAgIC8vIHBvc2l0aW9uIHRoZSB2ZWN0b3JzXHJcbiAgICBlcXVpdmFsZW50U3ByaW5nLnJpZ2h0UHJvcGVydHkubGluayggcmlnaHQgPT4ge1xyXG4gICAgICBhcHBsaWVkRm9yY2VWZWN0b3JOb2RlLnggPSB0b3RhbFNwcmluZ0ZvcmNlVmVjdG9yTm9kZS54ID0gKCBvcHRpb25zLnVuaXREaXNwbGFjZW1lbnRMZW5ndGggKiByaWdodCApO1xyXG4gICAgfSApO1xyXG4gICAgbGVmdFNwcmluZy5yaWdodFByb3BlcnR5LmxpbmsoIHJpZ2h0ID0+IHtcclxuICAgICAgbGVmdFNwcmluZ0ZvcmNlVmVjdG9yTm9kZS54ID0gbGVmdEFwcGxpZWRGb3JjZVZlY3Rvck5vZGUueCA9ICggb3B0aW9ucy51bml0RGlzcGxhY2VtZW50TGVuZ3RoICogcmlnaHQgKTtcclxuICAgIH0gKTtcclxuICAgIHJpZ2h0U3ByaW5nLnJpZ2h0UHJvcGVydHkubGluayggcmlnaHQgPT4ge1xyXG4gICAgICByaWdodFNwcmluZ0ZvcmNlVmVjdG9yTm9kZS54ID0gbmliTm9kZS54ID0gKCBvcHRpb25zLnVuaXREaXNwbGFjZW1lbnRMZW5ndGggKiByaWdodCApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIE9wZW4gcGluY2VycyB3aGVuIGRpc3BsYWNlbWVudCBpcyB6ZXJvIGFuZCBubyB1c2VyIGludGVyYWN0aW9ucyBhZmZlY3RpbmcgZGlzcGxhY2VtZW50IGFyZSB0YWxraW5nIHBsYWNlLlxyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayggWyBudW1iZXJPZkludGVyYWN0aW9uc0luUHJvZ3Jlc3NQcm9wZXJ0eSwgZXF1aXZhbGVudFNwcmluZy5kaXNwbGFjZW1lbnRQcm9wZXJ0eSBdLFxyXG4gICAgICAoIG51bWJlck9mSW50ZXJhY3Rpb25zLCBkaXNwbGFjZW1lbnQgKSA9PiB7XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggbnVtYmVyT2ZJbnRlcmFjdGlvbnMgPj0gMCApO1xyXG4gICAgICAgIGNvbnN0IGZpeGVkRGlzcGxhY2VtZW50ID0gVXRpbHMudG9GaXhlZE51bWJlciggZGlzcGxhY2VtZW50LCBIb29rZXNMYXdDb25zdGFudHMuRElTUExBQ0VNRU5UX0RFQ0lNQUxfUExBQ0VTICk7XHJcbiAgICAgICAgcm9ib3RpY0FybU5vZGUuc2V0UGluY2Vyc09wZW4oIG51bWJlck9mSW50ZXJhY3Rpb25zID09PSAwICYmIGZpeGVkRGlzcGxhY2VtZW50ID09PSAwICk7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG4gIH1cclxufVxyXG5cclxuaG9va2VzTGF3LnJlZ2lzdGVyKCAnU2VyaWVzU3lzdGVtTm9kZScsIFNlcmllc1N5c3RlbU5vZGUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxTQUFTLE1BQU0sa0NBQWtDO0FBQ3hELE9BQU9DLGNBQWMsTUFBTSx1Q0FBdUM7QUFDbEUsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxTQUFTLE1BQU0sdUNBQXVDO0FBRTdELFNBQVNDLElBQUksUUFBNkMsbUNBQW1DO0FBQzdGLE9BQU9DLGVBQWUsTUFBTSxpQ0FBaUM7QUFDN0QsT0FBT0Msa0JBQWtCLE1BQU0sb0NBQW9DO0FBQ25FLE9BQU9DLHNCQUFzQixNQUFNLDZDQUE2QztBQUNoRixPQUFPQyxzQkFBc0IsTUFBTSw2Q0FBNkM7QUFDaEYsT0FBT0MsdUJBQXVCLE1BQU0sOENBQThDO0FBQ2xGLE9BQU9DLG1CQUFtQixNQUFNLDBDQUEwQztBQUMxRSxPQUFPQyxPQUFPLE1BQU0sOEJBQThCO0FBQ2xELE9BQU9DLGNBQWMsTUFBTSxxQ0FBcUM7QUFDaEUsT0FBT0MscUJBQXFCLE1BQU0sNENBQTRDO0FBQzlFLE9BQU9DLFFBQVEsTUFBTSwrQkFBK0I7QUFDcEQsT0FBT0MsU0FBUyxNQUFNLG9CQUFvQjtBQUUxQyxPQUFPQyxvQkFBb0IsTUFBTSwyQkFBMkI7QUFDNUQsT0FBT0MseUJBQXlCLE1BQU0sZ0NBQWdDO0FBU3RFLGVBQWUsTUFBTUMsZ0JBQWdCLFNBQVNkLElBQUksQ0FBQztFQUUxQ2UsV0FBV0EsQ0FBRUMsTUFBb0IsRUFBRUMsY0FBcUMsRUFBRUMsZUFBd0MsRUFBRztJQUUxSCxNQUFNQyxPQUFPLEdBQUdwQixTQUFTLENBQW9ELENBQUMsQ0FBRTtNQUU5RTtNQUNBcUIsc0JBQXNCLEVBQUU7SUFDMUIsQ0FBQyxFQUFFRixlQUFnQixDQUFDOztJQUVwQjtJQUNBLE1BQU1HLFVBQVUsR0FBR0wsTUFBTSxDQUFDSyxVQUFVO0lBQ3BDLE1BQU1DLFdBQVcsR0FBR04sTUFBTSxDQUFDTSxXQUFXO0lBQ3RDLE1BQU1DLFVBQVUsR0FBR1AsTUFBTSxDQUFDTyxVQUFVO0lBQ3BDLE1BQU1DLGdCQUFnQixHQUFHUixNQUFNLENBQUNRLGdCQUFnQjs7SUFFaEQ7SUFDQSxNQUFNQyxPQUFPLEdBQUcsQ0FBQzs7SUFFakI7SUFDQSxNQUFNQyxzQ0FBc0MsR0FBRyxJQUFJN0IsY0FBYyxDQUFFLENBQUMsRUFBRTtNQUNwRThCLFVBQVUsRUFBRSxTQUFTO01BQ3JCQyxZQUFZLEVBQUVDLEtBQUssSUFBTUEsS0FBSyxJQUFJO0lBQ3BDLENBQUUsQ0FBQzs7SUFFSDtJQUNBOztJQUVBO0lBQ0EsTUFBTUMsUUFBUSxHQUFHLElBQUlwQixRQUFRLENBQUVSLGtCQUFrQixDQUFDNkIsU0FBUyxFQUFFO01BQzNEQyxLQUFLLEVBQUViLE9BQU8sQ0FBQ0Msc0JBQXNCLEdBQUdDLFVBQVUsQ0FBQ1ksWUFBWSxDQUFDSixLQUFLO01BQ3JFSyxPQUFPLEVBQUVUO0lBQ1gsQ0FBRSxDQUFDO0lBRUgsTUFBTVUsY0FBYyxHQUFHLElBQUk3QixtQkFBbUIsQ0FBRWUsVUFBVSxFQUFFO01BQzFERCxzQkFBc0IsRUFBRUQsT0FBTyxDQUFDQyxzQkFBc0I7TUFDdERnQixLQUFLLEVBQUVsQyxrQkFBa0IsQ0FBQ21DLG9CQUFvQjtNQUM5Q0MsVUFBVSxFQUFFckMsZUFBZSxDQUFDc0MsaUJBQWlCO01BQzdDQyxXQUFXLEVBQUV2QyxlQUFlLENBQUN3QyxrQkFBa0I7TUFDL0NDLFNBQVMsRUFBRXpDLGVBQWUsQ0FBQzBDLGdCQUFnQjtNQUMzQztNQUNBQyxDQUFDLEVBQUV6QixPQUFPLENBQUNDLHNCQUFzQixHQUFHQyxVQUFVLENBQUNZLFlBQVksQ0FBQ0osS0FBSztNQUNqRWdCLENBQUMsRUFBRXBCO0lBQ0wsQ0FBRSxDQUFDO0lBRUgsTUFBTXFCLGVBQWUsR0FBRyxJQUFJeEMsbUJBQW1CLENBQUVnQixXQUFXLEVBQUU7TUFDNURGLHNCQUFzQixFQUFFRCxPQUFPLENBQUNDLHNCQUFzQjtNQUN0RGdCLEtBQUssRUFBRWxDLGtCQUFrQixDQUFDbUMsb0JBQW9CO01BQzlDQyxVQUFVLEVBQUVyQyxlQUFlLENBQUM4QyxrQkFBa0I7TUFDOUNQLFdBQVcsRUFBRXZDLGVBQWUsQ0FBQytDLG1CQUFtQjtNQUNoRE4sU0FBUyxFQUFFekMsZUFBZSxDQUFDZ0QsaUJBQWlCO01BQzVDO01BQ0E7TUFDQUosQ0FBQyxFQUFFcEI7SUFDTCxDQUFFLENBQUM7O0lBRUg7SUFDQSxNQUFNeUIsT0FBTyxHQUFHLElBQUkzQyxPQUFPLENBQUU7TUFDM0I0QyxJQUFJLEVBQUVsRCxlQUFlLENBQUMrQyxtQkFBbUI7TUFDekM7TUFDQWQsT0FBTyxFQUFFVDtJQUNYLENBQUUsQ0FBQztJQUVILE1BQU0yQixjQUFjLEdBQUcsSUFBSTVDLGNBQWMsQ0FBRWUsVUFBVSxFQUFFRCxXQUFXLENBQUMrQixrQkFBa0IsRUFBRTNCLHNDQUFzQyxFQUFFO01BQzdITixzQkFBc0IsRUFBRUQsT0FBTyxDQUFDQyxzQkFBc0I7TUFDdER3QixDQUFDLEVBQUV6QixPQUFPLENBQUNDLHNCQUFzQixHQUFHRyxVQUFVLENBQUNTLEtBQUs7TUFDcERhLENBQUMsRUFBRXBCLE9BQU87TUFDVjZCLE1BQU0sRUFBRW5DLE9BQU8sQ0FBQ21DLE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLGdCQUFpQjtJQUN4RCxDQUFFLENBQUM7SUFFSCxNQUFNQyx1QkFBdUIsR0FBRyxJQUFJbkQsdUJBQXVCLENBQUV5QixRQUFRLENBQUMyQixNQUFNLEVBQUU7TUFDNUVDLE9BQU8sRUFBRXZDLE9BQU8sQ0FBQ0Msc0JBQXNCLEdBQUdJLGdCQUFnQixDQUFDbUMsb0JBQW9CLENBQUM5QixLQUFLO01BQ3JGSyxPQUFPLEVBQUVULE9BQU87TUFDaEJtQyxlQUFlLEVBQUUzQyxjQUFjLENBQUM0QyxrQ0FBa0M7TUFDbEVQLE1BQU0sRUFBRW5DLE9BQU8sQ0FBQ21DLE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLHlCQUEwQjtJQUNqRSxDQUFFLENBQUM7SUFFSCxNQUFNTyx5QkFBeUIsR0FBRyxJQUFJckQscUJBQXFCLENBQ3pEWSxVQUFVLENBQUMwQyxtQkFBbUIsRUFBRTlDLGNBQWMsQ0FBQytDLHFCQUFxQixFQUFFO01BQ3BFYixJQUFJLEVBQUVsRCxlQUFlLENBQUNnRSxXQUFXO01BQ2pDQyxhQUFhLEVBQUVoRSxrQkFBa0IsQ0FBQ2lFLDZDQUE2QztNQUMvRTtNQUNBO01BQ0FDLE1BQU0sRUFBRWpDLGNBQWMsQ0FBQ1UsQ0FBQyxHQUFHLEVBQUU7TUFDN0JTLE1BQU0sRUFBRW5DLE9BQU8sQ0FBQ21DLE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLDJCQUE0QjtJQUNuRSxDQUFFLENBQUM7SUFFTCxNQUFNYywwQkFBMEIsR0FBRyxJQUFJbEUsc0JBQXNCLENBQzNEa0IsVUFBVSxDQUFDaUQsb0JBQW9CLEVBQUVyRCxjQUFjLENBQUMrQyxxQkFBcUIsRUFBRTtNQUNyRWIsSUFBSSxFQUFFbEQsZUFBZSxDQUFDc0UsWUFBWTtNQUNsQztNQUNBMUIsQ0FBQyxFQUFFaUIseUJBQXlCLENBQUNqQixDQUFDO01BQzlCUyxNQUFNLEVBQUVuQyxPQUFPLENBQUNtQyxNQUFNLENBQUNDLFlBQVksQ0FBRSw0QkFBNkI7SUFDcEUsQ0FBRSxDQUFDO0lBRUwsTUFBTWlCLDBCQUEwQixHQUFHLElBQUkvRCxxQkFBcUIsQ0FDMURhLFdBQVcsQ0FBQ3lDLG1CQUFtQixFQUFFOUMsY0FBYyxDQUFDK0MscUJBQXFCLEVBQUU7TUFDckViLElBQUksRUFBRWxELGVBQWUsQ0FBQ3NFLFlBQVk7TUFDbENMLGFBQWEsRUFBRWhFLGtCQUFrQixDQUFDaUUsNkNBQTZDO01BQy9FO01BQ0FDLE1BQU0sRUFBRU4seUJBQXlCLENBQUNXLEdBQUcsR0FBRyxFQUFFO01BQzFDbkIsTUFBTSxFQUFFbkMsT0FBTyxDQUFDbUMsTUFBTSxDQUFDQyxZQUFZLENBQUUsNEJBQTZCO0lBQ3BFLENBQUUsQ0FBQztJQUVMLE1BQU1tQixzQkFBc0IsR0FBRyxJQUFJdkUsc0JBQXNCLENBQ3ZEcUIsZ0JBQWdCLENBQUM4QyxvQkFBb0IsRUFBRXJELGNBQWMsQ0FBQytDLHFCQUFxQixFQUFFO01BQzNFO01BQ0FuQixDQUFDLEVBQUUyQiwwQkFBMEIsQ0FBQzNCLENBQUM7TUFDL0JlLGVBQWUsRUFBRTNDLGNBQWMsQ0FBQzBELGlDQUFpQztNQUNqRXJCLE1BQU0sRUFBRW5DLE9BQU8sQ0FBQ21DLE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLHdCQUF5QjtJQUNoRSxDQUFFLENBQUM7SUFFTCxNQUFNcUIsMEJBQTBCLEdBQUcsSUFBSW5FLHFCQUFxQixDQUMxRGUsZ0JBQWdCLENBQUN1QyxtQkFBbUIsRUFBRTlDLGNBQWMsQ0FBQytDLHFCQUFxQixFQUFFO01BQzFFO01BQ0FuQixDQUFDLEVBQUU2QixzQkFBc0IsQ0FBQzdCLENBQUM7TUFDM0JTLE1BQU0sRUFBRW5DLE9BQU8sQ0FBQ21DLE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLDRCQUE2QjtJQUNwRSxDQUFFLENBQUM7SUFFTCxNQUFNc0Isc0JBQXNCLEdBQUcsSUFBSXpFLHNCQUFzQixDQUN2RG9CLGdCQUFnQixDQUFDc0Qsb0JBQW9CLEVBQUU3RCxjQUFjLENBQUMrQyxxQkFBcUIsRUFBRTtNQUMzRTVDLHNCQUFzQixFQUFFRCxPQUFPLENBQUNDLHNCQUFzQjtNQUN0RHdCLENBQUMsRUFBRVksdUJBQXVCLENBQUNFLE9BQU87TUFDbEM7TUFDQWUsR0FBRyxFQUFFdEMsY0FBYyxDQUFDVSxDQUFDLEdBQUcsRUFBRTtNQUMxQmUsZUFBZSxFQUFFM0MsY0FBYyxDQUFDOEQsaUNBQWlDO01BQ2pFekIsTUFBTSxFQUFFbkMsT0FBTyxDQUFDbUMsTUFBTSxDQUFDQyxZQUFZLENBQUUsd0JBQXlCO0lBQ2hFLENBQUUsQ0FBQztJQUVMLE1BQU15QixjQUFjLEdBQUcsSUFBSXBFLG9CQUFvQixDQUFFSSxNQUFNLEVBQUVVLHNDQUFzQyxFQUFFO01BQy9GZ0MsT0FBTyxFQUFFNUIsUUFBUSxDQUFDbUQsSUFBSSxHQUFHLENBQUU3QixjQUFjLENBQUNwQixLQUFLLEdBQUdGLFFBQVEsQ0FBQ21ELElBQUksSUFBSyxDQUFDO01BQ3JFUixHQUFHLEVBQUUzQyxRQUFRLENBQUNzQyxNQUFNLEdBQUcsRUFBRTtNQUN6QmMsUUFBUSxFQUFFOUIsY0FBYyxDQUFDcEIsS0FBSyxHQUFHRixRQUFRLENBQUNtRCxJQUFJO01BQUU7TUFDaEQzQixNQUFNLEVBQUVuQyxPQUFPLENBQUNtQyxNQUFNLENBQUNDLFlBQVksQ0FBRSxnQkFBaUI7SUFDeEQsQ0FBRSxDQUFDO0lBRUhwQyxPQUFPLENBQUNnRSxRQUFRLEdBQUcsQ0FDakIzQix1QkFBdUIsRUFBRUosY0FBYyxFQUFFakIsY0FBYyxFQUFFVyxlQUFlLEVBQUVoQixRQUFRLEVBQUVvQixPQUFPLEVBQzNGWSx5QkFBeUIsRUFBRU8sMEJBQTBCLEVBQUVHLDBCQUEwQixFQUNqRkUsc0JBQXNCLEVBQUVFLDBCQUEwQixFQUFFQyxzQkFBc0IsRUFDMUVHLGNBQWMsQ0FDZjs7SUFFRDtJQUNBOztJQUVBO0lBQ0ExRCxXQUFXLENBQUNXLFlBQVksQ0FBQ21ELElBQUksQ0FBRUgsSUFBSSxJQUFJO01BQ3JDO01BQ0FuQyxlQUFlLENBQUNGLENBQUMsR0FBS3pCLE9BQU8sQ0FBQ0Msc0JBQXNCLEdBQUc2RCxJQUFNO0lBQy9ELENBQUUsQ0FBQzs7SUFFSDtJQUNBckYsU0FBUyxDQUFDeUYsU0FBUyxDQUFFLENBQUVwRSxjQUFjLENBQUNxRSxnQ0FBZ0MsRUFBRXJFLGNBQWMsQ0FBQ3NFLGlDQUFpQyxDQUFFLEVBQ3hILENBQUVDLHdCQUF3QixFQUFFQyx5QkFBeUIsS0FBTTtNQUV6RDtNQUNBYiwwQkFBMEIsQ0FBQ2MsT0FBTyxHQUNoQ0Ysd0JBQXdCLElBQU1DLHlCQUF5QixLQUFLNUUseUJBQXlCLENBQUM4RSxLQUFPOztNQUUvRjtNQUNBLE1BQU1DLGlCQUFpQixHQUNyQkosd0JBQXdCLElBQU1DLHlCQUF5QixLQUFLNUUseUJBQXlCLENBQUNnRixVQUFZO01BQ3BHckIsMEJBQTBCLENBQUNrQixPQUFPLEdBQUc1Qix5QkFBeUIsQ0FBQzRCLE9BQU8sR0FBR3JCLDBCQUEwQixDQUFDcUIsT0FBTyxHQUFHRSxpQkFBaUI7SUFDakksQ0FBRSxDQUFDOztJQUVMO0lBQ0FwRSxnQkFBZ0IsQ0FBQ3NFLGFBQWEsQ0FBQ1YsSUFBSSxDQUFFcEQsS0FBSyxJQUFJO01BQzVDMEMsc0JBQXNCLENBQUM5QixDQUFDLEdBQUdnQywwQkFBMEIsQ0FBQ2hDLENBQUMsR0FBS3pCLE9BQU8sQ0FBQ0Msc0JBQXNCLEdBQUdZLEtBQU87SUFDdEcsQ0FBRSxDQUFDO0lBQ0hYLFVBQVUsQ0FBQ3lFLGFBQWEsQ0FBQ1YsSUFBSSxDQUFFcEQsS0FBSyxJQUFJO01BQ3RDOEIseUJBQXlCLENBQUNsQixDQUFDLEdBQUd5QiwwQkFBMEIsQ0FBQ3pCLENBQUMsR0FBS3pCLE9BQU8sQ0FBQ0Msc0JBQXNCLEdBQUdZLEtBQU87SUFDekcsQ0FBRSxDQUFDO0lBQ0hWLFdBQVcsQ0FBQ3dFLGFBQWEsQ0FBQ1YsSUFBSSxDQUFFcEQsS0FBSyxJQUFJO01BQ3ZDd0MsMEJBQTBCLENBQUM1QixDQUFDLEdBQUdNLE9BQU8sQ0FBQ04sQ0FBQyxHQUFLekIsT0FBTyxDQUFDQyxzQkFBc0IsR0FBR1ksS0FBTztJQUN2RixDQUFFLENBQUM7O0lBRUg7SUFDQXBDLFNBQVMsQ0FBQ3lGLFNBQVMsQ0FBRSxDQUFFM0Qsc0NBQXNDLEVBQUVGLGdCQUFnQixDQUFDc0Qsb0JBQW9CLENBQUUsRUFDcEcsQ0FBRWlCLG9CQUFvQixFQUFFQyxZQUFZLEtBQU07TUFDeENDLE1BQU0sSUFBSUEsTUFBTSxDQUFFRixvQkFBb0IsSUFBSSxDQUFFLENBQUM7TUFDN0MsTUFBTUcsaUJBQWlCLEdBQUdwRyxLQUFLLENBQUNxRyxhQUFhLENBQUVILFlBQVksRUFBRTlGLGtCQUFrQixDQUFDa0csMkJBQTRCLENBQUM7TUFDN0doRCxjQUFjLENBQUNpRCxjQUFjLENBQUVOLG9CQUFvQixLQUFLLENBQUMsSUFBSUcsaUJBQWlCLEtBQUssQ0FBRSxDQUFDO0lBQ3hGLENBQUUsQ0FBQztJQUVMLEtBQUssQ0FBRS9FLE9BQVEsQ0FBQztFQUNsQjtBQUNGO0FBRUFSLFNBQVMsQ0FBQzJGLFFBQVEsQ0FBRSxrQkFBa0IsRUFBRXhGLGdCQUFpQixDQUFDIn0=