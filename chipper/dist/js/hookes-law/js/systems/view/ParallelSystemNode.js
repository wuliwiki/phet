// Copyright 2015-2022, University of Colorado Boulder

/**
 * Two springs in parallel, a robotic arm, and all of the visual representations that go with them.
 * Origin is at the point where the springs attach to the wall.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Multilink from '../../../../axon/js/Multilink.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import Utils from '../../../../dot/js/Utils.js';
import optionize from '../../../../phet-core/js/optionize.js';
import { Line, Node } from '../../../../scenery/js/imports.js';
import HookesLawColors from '../../common/HookesLawColors.js';
import HookesLawConstants from '../../common/HookesLawConstants.js';
import AppliedForceVectorNode from '../../common/view/AppliedForceVectorNode.js';
import DisplacementVectorNode from '../../common/view/DisplacementVectorNode.js';
import EquilibriumPositionNode from '../../common/view/EquilibriumPositionNode.js';
import HookesLawSpringNode from '../../common/view/HookesLawSpringNode.js';
import NibNode from '../../common/view/NibNode.js';
import RoboticArmNode from '../../common/view/RoboticArmNode.js';
import SpringForceVectorNode from '../../common/view/SpringForceVectorNode.js';
import WallNode from '../../common/view/WallNode.js';
import hookesLaw from '../../hookesLaw.js';
import ParallelSpringControls from './ParallelSpringControls.js';
import SpringForceRepresentation from './SpringForceRepresentation.js';
// constants
const WALL_SIZE = new Dimension2(HookesLawConstants.WALL_SIZE.width, 300); // wall is taller than other systems

export default class ParallelSystemNode extends Node {
  constructor(system, viewProperties, providedOptions) {
    const options = optionize()({
      // SelfOptions
      unitDisplacementLength: 1
    }, providedOptions);
    assert && assert(options.unitDisplacementLength > 0);

    // to improve readability
    const topSpring = system.topSpring;
    const bottomSpring = system.bottomSpring;
    const roboticArm = system.roboticArm;
    const equivalentSpring = system.equivalentSpring;

    // This sim operates in 1 dimension (x), so center everything on y = 0.
    const yOrigin = 0;

    // number of interactions in progress that affect displacement
    const numberOfInteractionsInProgressProperty = new NumberProperty(0, {
      numberType: 'Integer',
      isValidValue: value => value >= 0
    });

    //------------------------------------------------
    // Scene graph

    // origin is at right-center of wall
    const wallNode = new WallNode(WALL_SIZE, {
      right: options.unitDisplacementLength * equivalentSpring.leftProperty.value,
      centerY: yOrigin
    });
    const topSpringNode = new HookesLawSpringNode(topSpring, {
      unitDisplacementLength: options.unitDisplacementLength,
      loops: HookesLawConstants.PARALLEL_SPRINGS_LOOPS,
      frontColor: HookesLawColors.TOP_SPRING_FRONT,
      middleColor: HookesLawColors.TOP_SPRING_MIDDLE,
      backColor: HookesLawColors.TOP_SPRING_BACK,
      // use x,y exclusively for layout, other translation options are inaccurate because we're using boundsMethod:'none'
      x: options.unitDisplacementLength * topSpring.leftProperty.value,
      y: wallNode.top + 0.25 * wallNode.height
    });
    const bottomSpringNode = new HookesLawSpringNode(bottomSpring, {
      unitDisplacementLength: options.unitDisplacementLength,
      loops: HookesLawConstants.PARALLEL_SPRINGS_LOOPS,
      frontColor: HookesLawColors.BOTTOM_SPRING_FRONT,
      middleColor: HookesLawColors.BOTTOM_SPRING_MIDDLE,
      backColor: HookesLawColors.BOTTOM_SPRING_BACK,
      // use x,y exclusively for layout, other translation options are inaccurate because we're using boundsMethod:'none'
      x: options.unitDisplacementLength * bottomSpring.leftProperty.value,
      y: wallNode.bottom - 0.25 * wallNode.height
    });
    const roboticArmNode = new RoboticArmNode(roboticArm, equivalentSpring.rightRangeProperty, numberOfInteractionsInProgressProperty, {
      unitDisplacementLength: options.unitDisplacementLength,
      x: options.unitDisplacementLength * roboticArm.right,
      y: yOrigin,
      tandem: options.tandem.createTandem('roboticArmNode')
    });

    // right ends of both springs are connected to this
    const trussOverlap = 10;
    const trussNode = new Line(0, topSpringNode.y - trussOverlap, 0, bottomSpringNode.y + trussOverlap, {
      lineWidth: 4,
      stroke: 'black'
    });

    // pincers grab this
    const nibNode = new NibNode({
      fill: 'black',
      // x is determined by rightSpring.leftProperty
      centerY: yOrigin
    });
    const equilibriumPositionNode = new EquilibriumPositionNode(wallNode.height, {
      centerX: options.unitDisplacementLength * equivalentSpring.equilibriumXProperty.value,
      centerY: yOrigin,
      visibleProperty: viewProperties.equilibriumPositionVisibleProperty,
      tandem: options.tandem.createTandem('equilibriumPositionNode')
    });
    const appliedForceVectorNode = new AppliedForceVectorNode(equivalentSpring.appliedForceProperty, viewProperties.valuesVisibleProperty, {
      // x is determined by bottomSpring.rightProperty
      // bottom determined empirically, topSpringNode.top is not accurate because we're using boundsMethod:'none'
      bottom: topSpringNode.y - 80,
      visibleProperty: viewProperties.appliedForceVectorVisibleProperty,
      tandem: options.tandem.createTandem('appliedForceVectorNode')
    });
    const totalSpringForceVectorNode = new SpringForceVectorNode(equivalentSpring.springForceProperty, viewProperties.valuesVisibleProperty, {
      // x is determined by bottomSpring.rightProperty
      centerY: appliedForceVectorNode.centerY,
      tandem: options.tandem.createTandem('totalSpringForceVectorNode')
    });
    const topSpringForceVectorNode = new SpringForceVectorNode(topSpring.springForceProperty, viewProperties.valuesVisibleProperty, {
      fill: HookesLawColors.TOP_SPRING,
      decimalPlaces: HookesLawConstants.PARALLEL_SPRING_FORCE_COMPONENTS_DECIMAL_PLACES,
      // x is determined by topSpring.rightProperty
      centerY: totalSpringForceVectorNode.top,
      tandem: options.tandem.createTandem('topSpringForceVectorNode')
    });
    const bottomSpringForceVectorNode = new SpringForceVectorNode(bottomSpring.springForceProperty, viewProperties.valuesVisibleProperty, {
      fill: HookesLawColors.BOTTOM_SPRING,
      decimalPlaces: HookesLawConstants.PARALLEL_SPRING_FORCE_COMPONENTS_DECIMAL_PLACES,
      // x is determined by bottomSpring.rightProperty
      centerY: totalSpringForceVectorNode.bottom,
      tandem: options.tandem.createTandem('bottomSpringForceVectorNode')
    });
    const displacementVectorNode = new DisplacementVectorNode(equivalentSpring.displacementProperty, viewProperties.valuesVisibleProperty, {
      unitDisplacementLength: options.unitDisplacementLength,
      x: equilibriumPositionNode.centerX,
      // top determined empirically, bottomSpringNode.bottom is not accurate because we're using boundMethod:'none'
      top: bottomSpringNode.y + 50,
      visibleProperty: viewProperties.displacementVectorVisibleProperty,
      tandem: options.tandem.createTandem('displacementVectorNode')
    });
    const springControls = new ParallelSpringControls(system, numberOfInteractionsInProgressProperty, {
      centerX: wallNode.left + (roboticArmNode.right - wallNode.left) / 2,
      top: wallNode.bottom + 25,
      maxWidth: roboticArmNode.right - wallNode.left,
      // constrain width for i18n
      tandem: options.tandem.createTandem('springControls')
    });
    options.children = [equilibriumPositionNode, roboticArmNode, topSpringNode, bottomSpringNode, wallNode, trussNode, nibNode, topSpringForceVectorNode, bottomSpringForceVectorNode, appliedForceVectorNode, totalSpringForceVectorNode, displacementVectorNode, springControls];

    //------------------------------------------------
    // Property observers

    // switch between different spring force representations
    Multilink.multilink([viewProperties.springForceVectorVisibleProperty, viewProperties.springForceRepresentationProperty], (springForceVectorVisible, springForceRepresentation) => {
      // total
      totalSpringForceVectorNode.visible = springForceVectorVisible && springForceRepresentation === SpringForceRepresentation.TOTAL;
      // components
      const componentsVisible = springForceVectorVisible && springForceRepresentation === SpringForceRepresentation.COMPONENTS;
      bottomSpringForceVectorNode.visible = topSpringForceVectorNode.visible = componentsVisible;
    });

    // position the vectors and truss
    equivalentSpring.rightProperty.link(right => {
      trussNode.x = nibNode.x = appliedForceVectorNode.x = totalSpringForceVectorNode.x = options.unitDisplacementLength * right;
    });
    topSpring.rightProperty.link(right => {
      topSpringForceVectorNode.x = options.unitDisplacementLength * right;
    });
    bottomSpring.rightProperty.link(right => {
      bottomSpringForceVectorNode.x = options.unitDisplacementLength * right;
    });

    // Open pincers when displacement is zero and no user interactions affecting displacement are talking place.
    Multilink.multilink([numberOfInteractionsInProgressProperty, equivalentSpring.displacementProperty], (numberOfInteractions, displacement) => {
      assert && assert(numberOfInteractions >= 0);
      const fixedDisplacement = Utils.toFixedNumber(displacement, HookesLawConstants.DISPLACEMENT_DECIMAL_PLACES);
      roboticArmNode.setPincersOpen(numberOfInteractions === 0 && fixedDisplacement === 0);
    });
    super(options);
  }
}
hookesLaw.register('ParallelSystemNode', ParallelSystemNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJOdW1iZXJQcm9wZXJ0eSIsIkRpbWVuc2lvbjIiLCJVdGlscyIsIm9wdGlvbml6ZSIsIkxpbmUiLCJOb2RlIiwiSG9va2VzTGF3Q29sb3JzIiwiSG9va2VzTGF3Q29uc3RhbnRzIiwiQXBwbGllZEZvcmNlVmVjdG9yTm9kZSIsIkRpc3BsYWNlbWVudFZlY3Rvck5vZGUiLCJFcXVpbGlicml1bVBvc2l0aW9uTm9kZSIsIkhvb2tlc0xhd1NwcmluZ05vZGUiLCJOaWJOb2RlIiwiUm9ib3RpY0FybU5vZGUiLCJTcHJpbmdGb3JjZVZlY3Rvck5vZGUiLCJXYWxsTm9kZSIsImhvb2tlc0xhdyIsIlBhcmFsbGVsU3ByaW5nQ29udHJvbHMiLCJTcHJpbmdGb3JjZVJlcHJlc2VudGF0aW9uIiwiV0FMTF9TSVpFIiwid2lkdGgiLCJQYXJhbGxlbFN5c3RlbU5vZGUiLCJjb25zdHJ1Y3RvciIsInN5c3RlbSIsInZpZXdQcm9wZXJ0aWVzIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsInVuaXREaXNwbGFjZW1lbnRMZW5ndGgiLCJhc3NlcnQiLCJ0b3BTcHJpbmciLCJib3R0b21TcHJpbmciLCJyb2JvdGljQXJtIiwiZXF1aXZhbGVudFNwcmluZyIsInlPcmlnaW4iLCJudW1iZXJPZkludGVyYWN0aW9uc0luUHJvZ3Jlc3NQcm9wZXJ0eSIsIm51bWJlclR5cGUiLCJpc1ZhbGlkVmFsdWUiLCJ2YWx1ZSIsIndhbGxOb2RlIiwicmlnaHQiLCJsZWZ0UHJvcGVydHkiLCJjZW50ZXJZIiwidG9wU3ByaW5nTm9kZSIsImxvb3BzIiwiUEFSQUxMRUxfU1BSSU5HU19MT09QUyIsImZyb250Q29sb3IiLCJUT1BfU1BSSU5HX0ZST05UIiwibWlkZGxlQ29sb3IiLCJUT1BfU1BSSU5HX01JRERMRSIsImJhY2tDb2xvciIsIlRPUF9TUFJJTkdfQkFDSyIsIngiLCJ5IiwidG9wIiwiaGVpZ2h0IiwiYm90dG9tU3ByaW5nTm9kZSIsIkJPVFRPTV9TUFJJTkdfRlJPTlQiLCJCT1RUT01fU1BSSU5HX01JRERMRSIsIkJPVFRPTV9TUFJJTkdfQkFDSyIsImJvdHRvbSIsInJvYm90aWNBcm1Ob2RlIiwicmlnaHRSYW5nZVByb3BlcnR5IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwidHJ1c3NPdmVybGFwIiwidHJ1c3NOb2RlIiwibGluZVdpZHRoIiwic3Ryb2tlIiwibmliTm9kZSIsImZpbGwiLCJlcXVpbGlicml1bVBvc2l0aW9uTm9kZSIsImNlbnRlclgiLCJlcXVpbGlicml1bVhQcm9wZXJ0eSIsInZpc2libGVQcm9wZXJ0eSIsImVxdWlsaWJyaXVtUG9zaXRpb25WaXNpYmxlUHJvcGVydHkiLCJhcHBsaWVkRm9yY2VWZWN0b3JOb2RlIiwiYXBwbGllZEZvcmNlUHJvcGVydHkiLCJ2YWx1ZXNWaXNpYmxlUHJvcGVydHkiLCJhcHBsaWVkRm9yY2VWZWN0b3JWaXNpYmxlUHJvcGVydHkiLCJ0b3RhbFNwcmluZ0ZvcmNlVmVjdG9yTm9kZSIsInNwcmluZ0ZvcmNlUHJvcGVydHkiLCJ0b3BTcHJpbmdGb3JjZVZlY3Rvck5vZGUiLCJUT1BfU1BSSU5HIiwiZGVjaW1hbFBsYWNlcyIsIlBBUkFMTEVMX1NQUklOR19GT1JDRV9DT01QT05FTlRTX0RFQ0lNQUxfUExBQ0VTIiwiYm90dG9tU3ByaW5nRm9yY2VWZWN0b3JOb2RlIiwiQk9UVE9NX1NQUklORyIsImRpc3BsYWNlbWVudFZlY3Rvck5vZGUiLCJkaXNwbGFjZW1lbnRQcm9wZXJ0eSIsImRpc3BsYWNlbWVudFZlY3RvclZpc2libGVQcm9wZXJ0eSIsInNwcmluZ0NvbnRyb2xzIiwibGVmdCIsIm1heFdpZHRoIiwiY2hpbGRyZW4iLCJtdWx0aWxpbmsiLCJzcHJpbmdGb3JjZVZlY3RvclZpc2libGVQcm9wZXJ0eSIsInNwcmluZ0ZvcmNlUmVwcmVzZW50YXRpb25Qcm9wZXJ0eSIsInNwcmluZ0ZvcmNlVmVjdG9yVmlzaWJsZSIsInNwcmluZ0ZvcmNlUmVwcmVzZW50YXRpb24iLCJ2aXNpYmxlIiwiVE9UQUwiLCJjb21wb25lbnRzVmlzaWJsZSIsIkNPTVBPTkVOVFMiLCJyaWdodFByb3BlcnR5IiwibGluayIsIm51bWJlck9mSW50ZXJhY3Rpb25zIiwiZGlzcGxhY2VtZW50IiwiZml4ZWREaXNwbGFjZW1lbnQiLCJ0b0ZpeGVkTnVtYmVyIiwiRElTUExBQ0VNRU5UX0RFQ0lNQUxfUExBQ0VTIiwic2V0UGluY2Vyc09wZW4iLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlBhcmFsbGVsU3lzdGVtTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBUd28gc3ByaW5ncyBpbiBwYXJhbGxlbCwgYSByb2JvdGljIGFybSwgYW5kIGFsbCBvZiB0aGUgdmlzdWFsIHJlcHJlc2VudGF0aW9ucyB0aGF0IGdvIHdpdGggdGhlbS5cclxuICogT3JpZ2luIGlzIGF0IHRoZSBwb2ludCB3aGVyZSB0aGUgc3ByaW5ncyBhdHRhY2ggdG8gdGhlIHdhbGwuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IERpbWVuc2lvbjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0RpbWVuc2lvbjIuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuaW1wb3J0IHsgTGluZSwgTm9kZSwgTm9kZU9wdGlvbnMsIE5vZGVUcmFuc2xhdGlvbk9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgSG9va2VzTGF3Q29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi9Ib29rZXNMYXdDb2xvcnMuanMnO1xyXG5pbXBvcnQgSG9va2VzTGF3Q29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9Ib29rZXNMYXdDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgQXBwbGllZEZvcmNlVmVjdG9yTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9BcHBsaWVkRm9yY2VWZWN0b3JOb2RlLmpzJztcclxuaW1wb3J0IERpc3BsYWNlbWVudFZlY3Rvck5vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvRGlzcGxhY2VtZW50VmVjdG9yTm9kZS5qcyc7XHJcbmltcG9ydCBFcXVpbGlicml1bVBvc2l0aW9uTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9FcXVpbGlicml1bVBvc2l0aW9uTm9kZS5qcyc7XHJcbmltcG9ydCBIb29rZXNMYXdTcHJpbmdOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0hvb2tlc0xhd1NwcmluZ05vZGUuanMnO1xyXG5pbXBvcnQgTmliTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9OaWJOb2RlLmpzJztcclxuaW1wb3J0IFJvYm90aWNBcm1Ob2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L1JvYm90aWNBcm1Ob2RlLmpzJztcclxuaW1wb3J0IFNwcmluZ0ZvcmNlVmVjdG9yTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9TcHJpbmdGb3JjZVZlY3Rvck5vZGUuanMnO1xyXG5pbXBvcnQgV2FsbE5vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvV2FsbE5vZGUuanMnO1xyXG5pbXBvcnQgaG9va2VzTGF3IGZyb20gJy4uLy4uL2hvb2tlc0xhdy5qcyc7XHJcbmltcG9ydCBQYXJhbGxlbFN5c3RlbSBmcm9tICcuLi9tb2RlbC9QYXJhbGxlbFN5c3RlbS5qcyc7XHJcbmltcG9ydCBQYXJhbGxlbFNwcmluZ0NvbnRyb2xzIGZyb20gJy4vUGFyYWxsZWxTcHJpbmdDb250cm9scy5qcyc7XHJcbmltcG9ydCBTcHJpbmdGb3JjZVJlcHJlc2VudGF0aW9uIGZyb20gJy4vU3ByaW5nRm9yY2VSZXByZXNlbnRhdGlvbi5qcyc7XHJcbmltcG9ydCBTeXN0ZW1zVmlld1Byb3BlcnRpZXMgZnJvbSAnLi9TeXN0ZW1zVmlld1Byb3BlcnRpZXMuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IFdBTExfU0laRSA9IG5ldyBEaW1lbnNpb24yKCBIb29rZXNMYXdDb25zdGFudHMuV0FMTF9TSVpFLndpZHRoLCAzMDAgKTsgLy8gd2FsbCBpcyB0YWxsZXIgdGhhbiBvdGhlciBzeXN0ZW1zXHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIHVuaXREaXNwbGFjZW1lbnRMZW5ndGg/OiBudW1iZXI7IC8vIHZpZXcgbGVuZ3RoIG9mIDEgbWV0ZXIgb2YgZGlzcGxhY2VtZW50XHJcbn07XHJcblxyXG50eXBlIFBhcmFsbGVsU3lzdGVtTm9kZU5vZGVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBOb2RlVHJhbnNsYXRpb25PcHRpb25zICZcclxuICBQaWNrUmVxdWlyZWQ8Tm9kZU9wdGlvbnMsICd0YW5kZW0nIHwgJ3Zpc2libGVQcm9wZXJ0eSc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGFyYWxsZWxTeXN0ZW1Ob2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvciggc3lzdGVtOiBQYXJhbGxlbFN5c3RlbSwgdmlld1Byb3BlcnRpZXM6IFN5c3RlbXNWaWV3UHJvcGVydGllcywgcHJvdmlkZWRPcHRpb25zOiBQYXJhbGxlbFN5c3RlbU5vZGVOb2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFBhcmFsbGVsU3lzdGVtTm9kZU5vZGVPcHRpb25zLCBTZWxmT3B0aW9ucywgTm9kZU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNlbGZPcHRpb25zXHJcbiAgICAgIHVuaXREaXNwbGFjZW1lbnRMZW5ndGg6IDFcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMudW5pdERpc3BsYWNlbWVudExlbmd0aCA+IDAgKTtcclxuXHJcbiAgICAvLyB0byBpbXByb3ZlIHJlYWRhYmlsaXR5XHJcbiAgICBjb25zdCB0b3BTcHJpbmcgPSBzeXN0ZW0udG9wU3ByaW5nO1xyXG4gICAgY29uc3QgYm90dG9tU3ByaW5nID0gc3lzdGVtLmJvdHRvbVNwcmluZztcclxuICAgIGNvbnN0IHJvYm90aWNBcm0gPSBzeXN0ZW0ucm9ib3RpY0FybTtcclxuICAgIGNvbnN0IGVxdWl2YWxlbnRTcHJpbmcgPSBzeXN0ZW0uZXF1aXZhbGVudFNwcmluZztcclxuXHJcbiAgICAvLyBUaGlzIHNpbSBvcGVyYXRlcyBpbiAxIGRpbWVuc2lvbiAoeCksIHNvIGNlbnRlciBldmVyeXRoaW5nIG9uIHkgPSAwLlxyXG4gICAgY29uc3QgeU9yaWdpbiA9IDA7XHJcblxyXG4gICAgLy8gbnVtYmVyIG9mIGludGVyYWN0aW9ucyBpbiBwcm9ncmVzcyB0aGF0IGFmZmVjdCBkaXNwbGFjZW1lbnRcclxuICAgIGNvbnN0IG51bWJlck9mSW50ZXJhY3Rpb25zSW5Qcm9ncmVzc1Byb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCAwLCB7XHJcbiAgICAgIG51bWJlclR5cGU6ICdJbnRlZ2VyJyxcclxuICAgICAgaXNWYWxpZFZhbHVlOiB2YWx1ZSA9PiAoIHZhbHVlID49IDAgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAvLyBTY2VuZSBncmFwaFxyXG5cclxuICAgIC8vIG9yaWdpbiBpcyBhdCByaWdodC1jZW50ZXIgb2Ygd2FsbFxyXG4gICAgY29uc3Qgd2FsbE5vZGUgPSBuZXcgV2FsbE5vZGUoIFdBTExfU0laRSwge1xyXG4gICAgICByaWdodDogb3B0aW9ucy51bml0RGlzcGxhY2VtZW50TGVuZ3RoICogZXF1aXZhbGVudFNwcmluZy5sZWZ0UHJvcGVydHkudmFsdWUsXHJcbiAgICAgIGNlbnRlclk6IHlPcmlnaW5cclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCB0b3BTcHJpbmdOb2RlID0gbmV3IEhvb2tlc0xhd1NwcmluZ05vZGUoIHRvcFNwcmluZywge1xyXG4gICAgICB1bml0RGlzcGxhY2VtZW50TGVuZ3RoOiBvcHRpb25zLnVuaXREaXNwbGFjZW1lbnRMZW5ndGgsXHJcbiAgICAgIGxvb3BzOiBIb29rZXNMYXdDb25zdGFudHMuUEFSQUxMRUxfU1BSSU5HU19MT09QUyxcclxuICAgICAgZnJvbnRDb2xvcjogSG9va2VzTGF3Q29sb3JzLlRPUF9TUFJJTkdfRlJPTlQsXHJcbiAgICAgIG1pZGRsZUNvbG9yOiBIb29rZXNMYXdDb2xvcnMuVE9QX1NQUklOR19NSURETEUsXHJcbiAgICAgIGJhY2tDb2xvcjogSG9va2VzTGF3Q29sb3JzLlRPUF9TUFJJTkdfQkFDSyxcclxuICAgICAgLy8gdXNlIHgseSBleGNsdXNpdmVseSBmb3IgbGF5b3V0LCBvdGhlciB0cmFuc2xhdGlvbiBvcHRpb25zIGFyZSBpbmFjY3VyYXRlIGJlY2F1c2Ugd2UncmUgdXNpbmcgYm91bmRzTWV0aG9kOidub25lJ1xyXG4gICAgICB4OiBvcHRpb25zLnVuaXREaXNwbGFjZW1lbnRMZW5ndGggKiB0b3BTcHJpbmcubGVmdFByb3BlcnR5LnZhbHVlLFxyXG4gICAgICB5OiB3YWxsTm9kZS50b3AgKyAoIDAuMjUgKiB3YWxsTm9kZS5oZWlnaHQgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGJvdHRvbVNwcmluZ05vZGUgPSBuZXcgSG9va2VzTGF3U3ByaW5nTm9kZSggYm90dG9tU3ByaW5nLCB7XHJcbiAgICAgIHVuaXREaXNwbGFjZW1lbnRMZW5ndGg6IG9wdGlvbnMudW5pdERpc3BsYWNlbWVudExlbmd0aCxcclxuICAgICAgbG9vcHM6IEhvb2tlc0xhd0NvbnN0YW50cy5QQVJBTExFTF9TUFJJTkdTX0xPT1BTLFxyXG4gICAgICBmcm9udENvbG9yOiBIb29rZXNMYXdDb2xvcnMuQk9UVE9NX1NQUklOR19GUk9OVCxcclxuICAgICAgbWlkZGxlQ29sb3I6IEhvb2tlc0xhd0NvbG9ycy5CT1RUT01fU1BSSU5HX01JRERMRSxcclxuICAgICAgYmFja0NvbG9yOiBIb29rZXNMYXdDb2xvcnMuQk9UVE9NX1NQUklOR19CQUNLLFxyXG4gICAgICAvLyB1c2UgeCx5IGV4Y2x1c2l2ZWx5IGZvciBsYXlvdXQsIG90aGVyIHRyYW5zbGF0aW9uIG9wdGlvbnMgYXJlIGluYWNjdXJhdGUgYmVjYXVzZSB3ZSdyZSB1c2luZyBib3VuZHNNZXRob2Q6J25vbmUnXHJcbiAgICAgIHg6IG9wdGlvbnMudW5pdERpc3BsYWNlbWVudExlbmd0aCAqIGJvdHRvbVNwcmluZy5sZWZ0UHJvcGVydHkudmFsdWUsXHJcbiAgICAgIHk6IHdhbGxOb2RlLmJvdHRvbSAtICggMC4yNSAqIHdhbGxOb2RlLmhlaWdodCApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3Qgcm9ib3RpY0FybU5vZGUgPSBuZXcgUm9ib3RpY0FybU5vZGUoIHJvYm90aWNBcm0sIGVxdWl2YWxlbnRTcHJpbmcucmlnaHRSYW5nZVByb3BlcnR5LCBudW1iZXJPZkludGVyYWN0aW9uc0luUHJvZ3Jlc3NQcm9wZXJ0eSwge1xyXG4gICAgICB1bml0RGlzcGxhY2VtZW50TGVuZ3RoOiBvcHRpb25zLnVuaXREaXNwbGFjZW1lbnRMZW5ndGgsXHJcbiAgICAgIHg6IG9wdGlvbnMudW5pdERpc3BsYWNlbWVudExlbmd0aCAqIHJvYm90aWNBcm0ucmlnaHQsXHJcbiAgICAgIHk6IHlPcmlnaW4sXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncm9ib3RpY0FybU5vZGUnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyByaWdodCBlbmRzIG9mIGJvdGggc3ByaW5ncyBhcmUgY29ubmVjdGVkIHRvIHRoaXNcclxuICAgIGNvbnN0IHRydXNzT3ZlcmxhcCA9IDEwO1xyXG4gICAgY29uc3QgdHJ1c3NOb2RlID0gbmV3IExpbmUoIDAsIHRvcFNwcmluZ05vZGUueSAtIHRydXNzT3ZlcmxhcCwgMCwgYm90dG9tU3ByaW5nTm9kZS55ICsgdHJ1c3NPdmVybGFwLCB7XHJcbiAgICAgIGxpbmVXaWR0aDogNCxcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gcGluY2VycyBncmFiIHRoaXNcclxuICAgIGNvbnN0IG5pYk5vZGUgPSBuZXcgTmliTm9kZSgge1xyXG4gICAgICBmaWxsOiAnYmxhY2snLFxyXG4gICAgICAvLyB4IGlzIGRldGVybWluZWQgYnkgcmlnaHRTcHJpbmcubGVmdFByb3BlcnR5XHJcbiAgICAgIGNlbnRlclk6IHlPcmlnaW5cclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBlcXVpbGlicml1bVBvc2l0aW9uTm9kZSA9IG5ldyBFcXVpbGlicml1bVBvc2l0aW9uTm9kZSggd2FsbE5vZGUuaGVpZ2h0LCB7XHJcbiAgICAgIGNlbnRlclg6IG9wdGlvbnMudW5pdERpc3BsYWNlbWVudExlbmd0aCAqIGVxdWl2YWxlbnRTcHJpbmcuZXF1aWxpYnJpdW1YUHJvcGVydHkudmFsdWUsXHJcbiAgICAgIGNlbnRlclk6IHlPcmlnaW4sXHJcbiAgICAgIHZpc2libGVQcm9wZXJ0eTogdmlld1Byb3BlcnRpZXMuZXF1aWxpYnJpdW1Qb3NpdGlvblZpc2libGVQcm9wZXJ0eSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdlcXVpbGlicml1bVBvc2l0aW9uTm9kZScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGFwcGxpZWRGb3JjZVZlY3Rvck5vZGUgPSBuZXcgQXBwbGllZEZvcmNlVmVjdG9yTm9kZShcclxuICAgICAgZXF1aXZhbGVudFNwcmluZy5hcHBsaWVkRm9yY2VQcm9wZXJ0eSwgdmlld1Byb3BlcnRpZXMudmFsdWVzVmlzaWJsZVByb3BlcnR5LCB7XHJcbiAgICAgICAgLy8geCBpcyBkZXRlcm1pbmVkIGJ5IGJvdHRvbVNwcmluZy5yaWdodFByb3BlcnR5XHJcbiAgICAgICAgLy8gYm90dG9tIGRldGVybWluZWQgZW1waXJpY2FsbHksIHRvcFNwcmluZ05vZGUudG9wIGlzIG5vdCBhY2N1cmF0ZSBiZWNhdXNlIHdlJ3JlIHVzaW5nIGJvdW5kc01ldGhvZDonbm9uZSdcclxuICAgICAgICBib3R0b206IHRvcFNwcmluZ05vZGUueSAtIDgwLFxyXG4gICAgICAgIHZpc2libGVQcm9wZXJ0eTogdmlld1Byb3BlcnRpZXMuYXBwbGllZEZvcmNlVmVjdG9yVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnYXBwbGllZEZvcmNlVmVjdG9yTm9kZScgKVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgdG90YWxTcHJpbmdGb3JjZVZlY3Rvck5vZGUgPSBuZXcgU3ByaW5nRm9yY2VWZWN0b3JOb2RlKFxyXG4gICAgICBlcXVpdmFsZW50U3ByaW5nLnNwcmluZ0ZvcmNlUHJvcGVydHksIHZpZXdQcm9wZXJ0aWVzLnZhbHVlc1Zpc2libGVQcm9wZXJ0eSwge1xyXG4gICAgICAgIC8vIHggaXMgZGV0ZXJtaW5lZCBieSBib3R0b21TcHJpbmcucmlnaHRQcm9wZXJ0eVxyXG4gICAgICAgIGNlbnRlclk6IGFwcGxpZWRGb3JjZVZlY3Rvck5vZGUuY2VudGVyWSxcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3RvdGFsU3ByaW5nRm9yY2VWZWN0b3JOb2RlJyApXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCB0b3BTcHJpbmdGb3JjZVZlY3Rvck5vZGUgPSBuZXcgU3ByaW5nRm9yY2VWZWN0b3JOb2RlKFxyXG4gICAgICB0b3BTcHJpbmcuc3ByaW5nRm9yY2VQcm9wZXJ0eSwgdmlld1Byb3BlcnRpZXMudmFsdWVzVmlzaWJsZVByb3BlcnR5LCB7XHJcbiAgICAgICAgZmlsbDogSG9va2VzTGF3Q29sb3JzLlRPUF9TUFJJTkcsXHJcbiAgICAgICAgZGVjaW1hbFBsYWNlczogSG9va2VzTGF3Q29uc3RhbnRzLlBBUkFMTEVMX1NQUklOR19GT1JDRV9DT01QT05FTlRTX0RFQ0lNQUxfUExBQ0VTLFxyXG4gICAgICAgIC8vIHggaXMgZGV0ZXJtaW5lZCBieSB0b3BTcHJpbmcucmlnaHRQcm9wZXJ0eVxyXG4gICAgICAgIGNlbnRlclk6IHRvdGFsU3ByaW5nRm9yY2VWZWN0b3JOb2RlLnRvcCxcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3RvcFNwcmluZ0ZvcmNlVmVjdG9yTm9kZScgKVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgYm90dG9tU3ByaW5nRm9yY2VWZWN0b3JOb2RlID0gbmV3IFNwcmluZ0ZvcmNlVmVjdG9yTm9kZShcclxuICAgICAgYm90dG9tU3ByaW5nLnNwcmluZ0ZvcmNlUHJvcGVydHksIHZpZXdQcm9wZXJ0aWVzLnZhbHVlc1Zpc2libGVQcm9wZXJ0eSwge1xyXG4gICAgICAgIGZpbGw6IEhvb2tlc0xhd0NvbG9ycy5CT1RUT01fU1BSSU5HLFxyXG4gICAgICAgIGRlY2ltYWxQbGFjZXM6IEhvb2tlc0xhd0NvbnN0YW50cy5QQVJBTExFTF9TUFJJTkdfRk9SQ0VfQ09NUE9ORU5UU19ERUNJTUFMX1BMQUNFUyxcclxuICAgICAgICAvLyB4IGlzIGRldGVybWluZWQgYnkgYm90dG9tU3ByaW5nLnJpZ2h0UHJvcGVydHlcclxuICAgICAgICBjZW50ZXJZOiB0b3RhbFNwcmluZ0ZvcmNlVmVjdG9yTm9kZS5ib3R0b20sXHJcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdib3R0b21TcHJpbmdGb3JjZVZlY3Rvck5vZGUnIClcclxuICAgICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGRpc3BsYWNlbWVudFZlY3Rvck5vZGUgPSBuZXcgRGlzcGxhY2VtZW50VmVjdG9yTm9kZShcclxuICAgICAgZXF1aXZhbGVudFNwcmluZy5kaXNwbGFjZW1lbnRQcm9wZXJ0eSwgdmlld1Byb3BlcnRpZXMudmFsdWVzVmlzaWJsZVByb3BlcnR5LCB7XHJcbiAgICAgICAgdW5pdERpc3BsYWNlbWVudExlbmd0aDogb3B0aW9ucy51bml0RGlzcGxhY2VtZW50TGVuZ3RoLFxyXG4gICAgICAgIHg6IGVxdWlsaWJyaXVtUG9zaXRpb25Ob2RlLmNlbnRlclgsXHJcbiAgICAgICAgLy8gdG9wIGRldGVybWluZWQgZW1waXJpY2FsbHksIGJvdHRvbVNwcmluZ05vZGUuYm90dG9tIGlzIG5vdCBhY2N1cmF0ZSBiZWNhdXNlIHdlJ3JlIHVzaW5nIGJvdW5kTWV0aG9kOidub25lJ1xyXG4gICAgICAgIHRvcDogYm90dG9tU3ByaW5nTm9kZS55ICsgNTAsXHJcbiAgICAgICAgdmlzaWJsZVByb3BlcnR5OiB2aWV3UHJvcGVydGllcy5kaXNwbGFjZW1lbnRWZWN0b3JWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdkaXNwbGFjZW1lbnRWZWN0b3JOb2RlJyApXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBzcHJpbmdDb250cm9scyA9IG5ldyBQYXJhbGxlbFNwcmluZ0NvbnRyb2xzKCBzeXN0ZW0sIG51bWJlck9mSW50ZXJhY3Rpb25zSW5Qcm9ncmVzc1Byb3BlcnR5LCB7XHJcbiAgICAgIGNlbnRlclg6IHdhbGxOb2RlLmxlZnQgKyAoIHJvYm90aWNBcm1Ob2RlLnJpZ2h0IC0gd2FsbE5vZGUubGVmdCApIC8gMixcclxuICAgICAgdG9wOiB3YWxsTm9kZS5ib3R0b20gKyAyNSxcclxuICAgICAgbWF4V2lkdGg6IHJvYm90aWNBcm1Ob2RlLnJpZ2h0IC0gd2FsbE5vZGUubGVmdCwgLy8gY29uc3RyYWluIHdpZHRoIGZvciBpMThuXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnc3ByaW5nQ29udHJvbHMnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gW1xyXG4gICAgICBlcXVpbGlicml1bVBvc2l0aW9uTm9kZSwgcm9ib3RpY0FybU5vZGUsIHRvcFNwcmluZ05vZGUsIGJvdHRvbVNwcmluZ05vZGUsIHdhbGxOb2RlLCB0cnVzc05vZGUsIG5pYk5vZGUsXHJcbiAgICAgIHRvcFNwcmluZ0ZvcmNlVmVjdG9yTm9kZSwgYm90dG9tU3ByaW5nRm9yY2VWZWN0b3JOb2RlLFxyXG4gICAgICBhcHBsaWVkRm9yY2VWZWN0b3JOb2RlLCB0b3RhbFNwcmluZ0ZvcmNlVmVjdG9yTm9kZSwgZGlzcGxhY2VtZW50VmVjdG9yTm9kZSxcclxuICAgICAgc3ByaW5nQ29udHJvbHNcclxuICAgIF07XHJcblxyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAgIC8vIFByb3BlcnR5IG9ic2VydmVyc1xyXG5cclxuICAgIC8vIHN3aXRjaCBiZXR3ZWVuIGRpZmZlcmVudCBzcHJpbmcgZm9yY2UgcmVwcmVzZW50YXRpb25zXHJcbiAgICBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIHZpZXdQcm9wZXJ0aWVzLnNwcmluZ0ZvcmNlVmVjdG9yVmlzaWJsZVByb3BlcnR5LCB2aWV3UHJvcGVydGllcy5zcHJpbmdGb3JjZVJlcHJlc2VudGF0aW9uUHJvcGVydHkgXSxcclxuICAgICAgKCBzcHJpbmdGb3JjZVZlY3RvclZpc2libGUsIHNwcmluZ0ZvcmNlUmVwcmVzZW50YXRpb24gKSA9PiB7XHJcbiAgICAgICAgLy8gdG90YWxcclxuICAgICAgICB0b3RhbFNwcmluZ0ZvcmNlVmVjdG9yTm9kZS52aXNpYmxlID1cclxuICAgICAgICAgIHNwcmluZ0ZvcmNlVmVjdG9yVmlzaWJsZSAmJiAoIHNwcmluZ0ZvcmNlUmVwcmVzZW50YXRpb24gPT09IFNwcmluZ0ZvcmNlUmVwcmVzZW50YXRpb24uVE9UQUwgKTtcclxuICAgICAgICAvLyBjb21wb25lbnRzXHJcbiAgICAgICAgY29uc3QgY29tcG9uZW50c1Zpc2libGUgPVxyXG4gICAgICAgICAgc3ByaW5nRm9yY2VWZWN0b3JWaXNpYmxlICYmICggc3ByaW5nRm9yY2VSZXByZXNlbnRhdGlvbiA9PT0gU3ByaW5nRm9yY2VSZXByZXNlbnRhdGlvbi5DT01QT05FTlRTICk7XHJcbiAgICAgICAgYm90dG9tU3ByaW5nRm9yY2VWZWN0b3JOb2RlLnZpc2libGUgPSB0b3BTcHJpbmdGb3JjZVZlY3Rvck5vZGUudmlzaWJsZSA9IGNvbXBvbmVudHNWaXNpYmxlO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgLy8gcG9zaXRpb24gdGhlIHZlY3RvcnMgYW5kIHRydXNzXHJcbiAgICBlcXVpdmFsZW50U3ByaW5nLnJpZ2h0UHJvcGVydHkubGluayggcmlnaHQgPT4ge1xyXG4gICAgICB0cnVzc05vZGUueCA9IG5pYk5vZGUueCA9IGFwcGxpZWRGb3JjZVZlY3Rvck5vZGUueCA9IHRvdGFsU3ByaW5nRm9yY2VWZWN0b3JOb2RlLnggPSAoIG9wdGlvbnMudW5pdERpc3BsYWNlbWVudExlbmd0aCAqIHJpZ2h0ICk7XHJcbiAgICB9ICk7XHJcbiAgICB0b3BTcHJpbmcucmlnaHRQcm9wZXJ0eS5saW5rKCByaWdodCA9PiB7XHJcbiAgICAgIHRvcFNwcmluZ0ZvcmNlVmVjdG9yTm9kZS54ID0gb3B0aW9ucy51bml0RGlzcGxhY2VtZW50TGVuZ3RoICogcmlnaHQ7XHJcbiAgICB9ICk7XHJcbiAgICBib3R0b21TcHJpbmcucmlnaHRQcm9wZXJ0eS5saW5rKCByaWdodCA9PiB7XHJcbiAgICAgIGJvdHRvbVNwcmluZ0ZvcmNlVmVjdG9yTm9kZS54ID0gb3B0aW9ucy51bml0RGlzcGxhY2VtZW50TGVuZ3RoICogcmlnaHQ7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gT3BlbiBwaW5jZXJzIHdoZW4gZGlzcGxhY2VtZW50IGlzIHplcm8gYW5kIG5vIHVzZXIgaW50ZXJhY3Rpb25zIGFmZmVjdGluZyBkaXNwbGFjZW1lbnQgYXJlIHRhbGtpbmcgcGxhY2UuXHJcbiAgICBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIG51bWJlck9mSW50ZXJhY3Rpb25zSW5Qcm9ncmVzc1Byb3BlcnR5LCBlcXVpdmFsZW50U3ByaW5nLmRpc3BsYWNlbWVudFByb3BlcnR5IF0sXHJcbiAgICAgICggbnVtYmVyT2ZJbnRlcmFjdGlvbnMsIGRpc3BsYWNlbWVudCApID0+IHtcclxuICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBudW1iZXJPZkludGVyYWN0aW9ucyA+PSAwICk7XHJcbiAgICAgICAgY29uc3QgZml4ZWREaXNwbGFjZW1lbnQgPSBVdGlscy50b0ZpeGVkTnVtYmVyKCBkaXNwbGFjZW1lbnQsIEhvb2tlc0xhd0NvbnN0YW50cy5ESVNQTEFDRU1FTlRfREVDSU1BTF9QTEFDRVMgKTtcclxuICAgICAgICByb2JvdGljQXJtTm9kZS5zZXRQaW5jZXJzT3BlbiggbnVtYmVyT2ZJbnRlcmFjdGlvbnMgPT09IDAgJiYgZml4ZWREaXNwbGFjZW1lbnQgPT09IDAgKTtcclxuICAgICAgfSApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcbiAgfVxyXG59XHJcblxyXG5ob29rZXNMYXcucmVnaXN0ZXIoICdQYXJhbGxlbFN5c3RlbU5vZGUnLCBQYXJhbGxlbFN5c3RlbU5vZGUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxTQUFTLE1BQU0sa0NBQWtDO0FBQ3hELE9BQU9DLGNBQWMsTUFBTSx1Q0FBdUM7QUFDbEUs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