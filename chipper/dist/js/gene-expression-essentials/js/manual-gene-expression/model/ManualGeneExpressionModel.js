// Copyright 2015-2021, University of Colorado Boulder

/**
 * Primary model for the 'Expression' screen.  This model interacts with the user (via the view) to allow them to
 * synthesize proteins from the information coded in the DNA strand by manually manipulating the various biomolecules
 * that are involved in the process.
 *
 * The point (0,0) in model space is at the leftmost edge of the DNA strand, and at the vertical center of the strand.
 *
 * @author Sharfudeen Ashraf
 * @author Mohamed Safi
 * @author John Blanco
 * @author Aadish Gupta
 */

import createObservableArray from '../../../../axon/js/createObservableArray.js';
import Property from '../../../../axon/js/Property.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import Utils from '../../../../dot/js/Utils.js';
import GEEConstants from '../../common/GEEConstants.js';
import DnaMolecule from '../../common/model/DnaMolecule.js';
import GeneA from '../../common/model/GeneA.js';
import GeneExpressionModel from '../../common/model/GeneExpressionModel.js';
import MotionBounds from '../../common/model/motion-strategies/MotionBounds.js';
import Protein from '../../common/model/Protein.js';
import geneExpressionEssentials from '../../geneExpressionEssentials.js';
import GeneB from './GeneB.js';
import GeneC from './GeneC.js';
import ProteinA from './ProteinA.js';
import ProteinB from './ProteinB.js';
import ProteinC from './ProteinC.js';

// constants
// Stage size for the mobile biomolecules, which is basically the area in which the molecules can move. These are
// empirically determined such that the molecules don't move off of the screen when looking at a given gene.
const BIOMOLECULE_STAGE_WIDTH = 10000; // In picometers.
const BIOMOLECULE_STAGE_HEIGHT = 6000; // In picometers.

// size of the DNA strand
const NUM_BASE_PAIRS_ON_DNA_STRAND = 2000;
class ManualGeneExpressionModel extends GeneExpressionModel {
  /**
   */
  constructor() {
    super();

    // @private {DnaMolecule} - the DNA strand, which is where the genes reside and where the polymerase does its
    // transcription, and where a lot of the action within this model takes place.
    this.dnaMolecule = new DnaMolecule(this, NUM_BASE_PAIRS_ON_DNA_STRAND, -NUM_BASE_PAIRS_ON_DNA_STRAND * GEEConstants.DISTANCE_BETWEEN_BASE_PAIRS / 4, false);
    this.dnaMolecule.addGene(new GeneA(this.dnaMolecule, NUM_BASE_PAIRS_ON_DNA_STRAND / 4 - GeneA.NUM_BASE_PAIRS / 2));
    this.dnaMolecule.addGene(new GeneB(this.dnaMolecule, NUM_BASE_PAIRS_ON_DNA_STRAND / 2 - GeneB.NUM_BASE_PAIRS / 2));
    this.dnaMolecule.addGene(new GeneC(this.dnaMolecule, NUM_BASE_PAIRS_ON_DNA_STRAND * 3 / 4 - GeneC.NUM_BASE_PAIRS / 2));

    // list of mobile biomolecules in the model, excluding mRNA
    this.mobileBiomoleculeList = createObservableArray(); // @public

    // list of mRNA molecules in the sim - These are kept separate because they are treated a bit differently than the
    // other mobile biomolecules.
    this.messengerRnaList = createObservableArray(); // @public

    // The gene that the user is focusing on, other gene activity is suspended.  Start with the 0th gene in the DNA
    // (leftmost). Initialize variables that are dependent upon the DNA.
    this.activeGeneProperty = new Property(this.dnaMolecule.getGenes()[0]); // @public(read-only)

    // List of areas where biomolecules should not be allowed.  These are generally populated by the view in order to
    // keep biomolecules from wandering over the toolboxes and collection areas.
    this.offLimitsMotionSpaces = []; //@private

    // Properties that track how many of the various proteins have been collected.
    this.proteinACollectedProperty = new Property(0); // @public(read-only)
    this.proteinBCollectedProperty = new Property(0); // @public(read-only)
    this.proteinCCollectedProperty = new Property(0); // @public(read-only)

    // Map of the protein collection count properties to the protein types, used to obtain the count property based on
    // the type of protein.
    this.mapProteinClassToCollectedCount = {
      ProteinA: this.proteinACollectedProperty,
      ProteinB: this.proteinBCollectedProperty,
      ProteinC: this.proteinCCollectedProperty
    };

    // Rectangle that describes the "protein capture area".  When a protein is dropped by the user over this area, it
    // is considered to be captured.
    // Initially it is empty and is set by call to the function setProteinCaptureArea()
    this.proteinCaptureArea = Bounds2.NOTHING.copy(); // @private
  }

  /**
   * main step function for this model
   * @param {number} dt
   * @public
   */
  step(dt) {
    this.mobileBiomoleculeList.forEach(mobileBiomolecule => {
      mobileBiomolecule.step(dt);
    });
    this.messengerRnaList.forEach(messengerRna => {
      messengerRna.step(dt);
    });
    this.dnaMolecule.step(dt);
  }

  /**
   * @returns {DnaMolecule}
   * @public
   */
  getDnaMolecule() {
    return this.dnaMolecule;
  }

  /**
   * Switch to the previous gene
   * @public
   */
  previousGene() {
    this.switchToGeneRelative(-1);
  }

  /**
   * Switch to the next gene
   * @public
   */
  nextGene() {
    this.switchToGeneRelative(+1);
  }

  /**
   * @param {Bounds2} newCaptureAreaBounds
   * @public
   */
  setProteinCaptureArea(newCaptureAreaBounds) {
    this.proteinCaptureArea.set(newCaptureAreaBounds);
  }

  /**
   * @param {string} proteinType
   * @returns {Property}
   * @public
   */
  getCollectedCounterForProteinType(proteinType) {
    return this.mapProteinClassToCollectedCount[proteinType];
  }

  /**
   * @param {number} i
   * @private
   */
  switchToGeneRelative(i) {
    const genes = this.dnaMolecule.getGenes();
    const index = Utils.clamp(0, genes.indexOf(this.activeGeneProperty.get()) + i, genes.length - 1);
    this.activeGeneProperty.set(genes[index]);
  }

  /**
   * @param {number} i
   * @private
   */
  activateGene(i) {
    this.activeGeneProperty.set(this.dnaMolecule.getGenes()[i]);
  }

  /**
   * @override
   * @param {MobileBiomolecule} mobileBiomolecule
   * @public
   */
  addMobileBiomolecule(mobileBiomolecule) {
    const self = this;
    this.mobileBiomoleculeList.add(mobileBiomolecule);
    mobileBiomolecule.setMotionBounds(this.getBoundsForActiveGene());

    // Hook up an observer that will activate and deactivate placement hints for this molecule.
    mobileBiomolecule.userControlledProperty.link((isUserControlled, wasUserControlled) => {
      if (isUserControlled) {
        this.dnaMolecule.activateHints(mobileBiomolecule);
        this.messengerRnaList.forEach(messengerRna => {
          messengerRna.activateHints(mobileBiomolecule);
        });
      } else {
        if (wasUserControlled) {
          // The user dropped this biomolecule, so deactivate any hints that were showing where it could be placed.
          this.dnaMolecule.deactivateAllHints();
          this.messengerRnaList.forEach(messengerRna => {
            messengerRna.deactivateAllHints();
          });

          // See if this is a protein being placed in the capture area.
          if (this.proteinCaptureArea.containsPoint(mobileBiomolecule.getPosition()) && mobileBiomolecule instanceof Protein) {
            // The user has dropped this protein in the capture area. So capture it.
            this.captureProtein(mobileBiomolecule);
          }
        }
      }
    });

    // Hook up an observer that will remove this biomolecule from the model if its existence strength reaches zero.
    mobileBiomolecule.existenceStrengthProperty.link(function existenceStrengthChangeHandler(existenceStrength) {
      if (existenceStrength === 0) {
        self.removeMobileBiomolecule(mobileBiomolecule);
        mobileBiomolecule.existenceStrengthProperty.unlink(existenceStrengthChangeHandler);
      }
    });
  }

  /**
   * Get a list of all mobile biomolecules that overlap with the provided shape.
   *
   * @param {Bounds2} testShapeBounds - Bounds, in model coordinate, to test for overlap.
   * @returns {Array.<MobileBiomolecule>} List of molecules that overlap with the provided bounds.
   * @public
   */
  getOverlappingBiomolecules(testShapeBounds) {
    const overlappingBiomolecules = [];
    this.mobileBiomoleculeList.forEach(mobileBiomolecule => {
      if (mobileBiomolecule.bounds.intersectsBounds(testShapeBounds)) {
        overlappingBiomolecules.push(mobileBiomolecule);
      }
    });
    return overlappingBiomolecules;
  }

  /**
   * Capture the specified protein, which means that it is actually removed from the model and the associated
   * capture count property is incremented.
   * @param {Protein} protein
   * @private
   */
  captureProtein(protein) {
    if (protein instanceof ProteinA) {
      this.proteinACollectedProperty.set(this.proteinACollectedProperty.get() + 1);
    }
    if (protein instanceof ProteinB) {
      this.proteinBCollectedProperty.set(this.proteinBCollectedProperty.get() + 1);
    }
    if (protein instanceof ProteinC) {
      this.proteinCCollectedProperty.set(this.proteinCCollectedProperty.get() + 1);
    }
    this.mobileBiomoleculeList.remove(protein);
  }

  /**
   * @param {Protein} proteinClassType
   * @returns {number}
   * @public
   */
  getProteinCount(proteinClassType) {
    let count = 0;
    this.mobileBiomoleculeList.forEach(mobileBiomolecule => {
      if (mobileBiomolecule instanceof proteinClassType) {
        count++;
      }
    });
    return count;
  }

  /**
   * @param {MobileBiomolecule} mobileBiomolecule
   * @public
   */
  removeMobileBiomolecule(mobileBiomolecule) {
    this.mobileBiomoleculeList.remove(mobileBiomolecule);
  }

  /**
   * @param {MessengerRna} messengerRna
   * @public
   */
  addMessengerRna(messengerRna) {
    this.messengerRnaList.add(messengerRna);
    messengerRna.setMotionBounds(this.getBoundsForActiveGene());
  }

  /**
   * @param {MessengerRna} messengerRnaBeingDestroyed
   * @public
   */
  removeMessengerRna(messengerRnaBeingDestroyed) {
    this.messengerRnaList.remove(messengerRnaBeingDestroyed);
  }

  /**
   * @override
   * @returns {ObservableArrayDef}
   * @public
   */
  getMessengerRnaList() {
    return this.messengerRnaList;
  }

  /**
   * Resets the model to initial state
   * @public
   */
  reset() {
    this.mobileBiomoleculeList.clear();
    this.messengerRnaList.clear();
    this.dnaMolecule.reset();
    this.proteinACollectedProperty.reset();
    this.proteinBCollectedProperty.reset();
    this.proteinCCollectedProperty.reset();
    this.activateGene(0);
  }

  /**
   * Add a space where the biomolecules should not be allowed to wander. This is generally used by the view to prevent
   * biomolecules from moving over toolboxes and such.
   *
   * @param {Bounds2} newOffLimitsSpace
   * @public
   */
  addOffLimitsMotionSpace(newOffLimitsSpace) {
    for (let i = 0; i < this.offLimitsMotionSpaces.length; i++) {
      const offLimitsMotionSpace = this.offLimitsMotionSpaces[i];
      if (offLimitsMotionSpace.equals(newOffLimitsSpace)) {
        // An equivalent space already exists, so don't bother adding this one.
        return;
      }
    }
    // Add the new one to the list.
    this.offLimitsMotionSpaces.push(newOffLimitsSpace);
  }

  /**
   * Get the motion bounds for any biomolecule that is going to be associated with the currently active gene.  This is
   * used to keep the biomolecules from wandering outside of the area that the user can see.
   * @private
   */
  getBoundsForActiveGene() {
    // The bottom bounds are intended to be roughly at the bottom of the viewport.  The value was empirically determined.
    const bottomYPos = GEEConstants.DNA_MOLECULE_Y_POS - 2100;

    // Get the nominal bounds for this gene.
    const bounds = new Bounds2(this.activeGeneProperty.get().getCenterX() - BIOMOLECULE_STAGE_WIDTH / 2, bottomYPos, this.activeGeneProperty.get().getCenterX() - BIOMOLECULE_STAGE_WIDTH / 2 + BIOMOLECULE_STAGE_WIDTH, bottomYPos + BIOMOLECULE_STAGE_HEIGHT);
    const motionBounds = new MotionBounds(bounds);
    // Subtract off any off limits areas.
    this.offLimitsMotionSpaces.forEach(offLimitMotionSpace => {
      if (bounds.intersectsBounds(offLimitMotionSpace)) {
        motionBounds.addOffLimitMotionSpace(offLimitMotionSpace);
      }
    });
    return motionBounds;
  }
}
geneExpressionEssentials.register('ManualGeneExpressionModel', ManualGeneExpressionModel);
export default ManualGeneExpressionModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVPYnNlcnZhYmxlQXJyYXkiLCJQcm9wZXJ0eSIsIkJvdW5kczIiLCJVdGlscyIsIkdFRUNvbnN0YW50cyIsIkRuYU1vbGVjdWxlIiwiR2VuZUEiLCJHZW5lRXhwcmVzc2lvbk1vZGVsIiwiTW90aW9uQm91bmRzIiwiUHJvdGVpbiIsImdlbmVFeHByZXNzaW9uRXNzZW50aWFscyIsIkdlbmVCIiwiR2VuZUMiLCJQcm90ZWluQSIsIlByb3RlaW5CIiwiUHJvdGVpbkMiLCJCSU9NT0xFQ1VMRV9TVEFHRV9XSURUSCIsIkJJT01PTEVDVUxFX1NUQUdFX0hFSUdIVCIsIk5VTV9CQVNFX1BBSVJTX09OX0ROQV9TVFJBTkQiLCJNYW51YWxHZW5lRXhwcmVzc2lvbk1vZGVsIiwiY29uc3RydWN0b3IiLCJkbmFNb2xlY3VsZSIsIkRJU1RBTkNFX0JFVFdFRU5fQkFTRV9QQUlSUyIsImFkZEdlbmUiLCJOVU1fQkFTRV9QQUlSUyIsIm1vYmlsZUJpb21vbGVjdWxlTGlzdCIsIm1lc3NlbmdlclJuYUxpc3QiLCJhY3RpdmVHZW5lUHJvcGVydHkiLCJnZXRHZW5lcyIsIm9mZkxpbWl0c01vdGlvblNwYWNlcyIsInByb3RlaW5BQ29sbGVjdGVkUHJvcGVydHkiLCJwcm90ZWluQkNvbGxlY3RlZFByb3BlcnR5IiwicHJvdGVpbkNDb2xsZWN0ZWRQcm9wZXJ0eSIsIm1hcFByb3RlaW5DbGFzc1RvQ29sbGVjdGVkQ291bnQiLCJwcm90ZWluQ2FwdHVyZUFyZWEiLCJOT1RISU5HIiwiY29weSIsInN0ZXAiLCJkdCIsImZvckVhY2giLCJtb2JpbGVCaW9tb2xlY3VsZSIsIm1lc3NlbmdlclJuYSIsImdldERuYU1vbGVjdWxlIiwicHJldmlvdXNHZW5lIiwic3dpdGNoVG9HZW5lUmVsYXRpdmUiLCJuZXh0R2VuZSIsInNldFByb3RlaW5DYXB0dXJlQXJlYSIsIm5ld0NhcHR1cmVBcmVhQm91bmRzIiwic2V0IiwiZ2V0Q29sbGVjdGVkQ291bnRlckZvclByb3RlaW5UeXBlIiwicHJvdGVpblR5cGUiLCJpIiwiZ2VuZXMiLCJpbmRleCIsImNsYW1wIiwiaW5kZXhPZiIsImdldCIsImxlbmd0aCIsImFjdGl2YXRlR2VuZSIsImFkZE1vYmlsZUJpb21vbGVjdWxlIiwic2VsZiIsImFkZCIsInNldE1vdGlvbkJvdW5kcyIsImdldEJvdW5kc0ZvckFjdGl2ZUdlbmUiLCJ1c2VyQ29udHJvbGxlZFByb3BlcnR5IiwibGluayIsImlzVXNlckNvbnRyb2xsZWQiLCJ3YXNVc2VyQ29udHJvbGxlZCIsImFjdGl2YXRlSGludHMiLCJkZWFjdGl2YXRlQWxsSGludHMiLCJjb250YWluc1BvaW50IiwiZ2V0UG9zaXRpb24iLCJjYXB0dXJlUHJvdGVpbiIsImV4aXN0ZW5jZVN0cmVuZ3RoUHJvcGVydHkiLCJleGlzdGVuY2VTdHJlbmd0aENoYW5nZUhhbmRsZXIiLCJleGlzdGVuY2VTdHJlbmd0aCIsInJlbW92ZU1vYmlsZUJpb21vbGVjdWxlIiwidW5saW5rIiwiZ2V0T3ZlcmxhcHBpbmdCaW9tb2xlY3VsZXMiLCJ0ZXN0U2hhcGVCb3VuZHMiLCJvdmVybGFwcGluZ0Jpb21vbGVjdWxlcyIsImJvdW5kcyIsImludGVyc2VjdHNCb3VuZHMiLCJwdXNoIiwicHJvdGVpbiIsInJlbW92ZSIsImdldFByb3RlaW5Db3VudCIsInByb3RlaW5DbGFzc1R5cGUiLCJjb3VudCIsImFkZE1lc3NlbmdlclJuYSIsInJlbW92ZU1lc3NlbmdlclJuYSIsIm1lc3NlbmdlclJuYUJlaW5nRGVzdHJveWVkIiwiZ2V0TWVzc2VuZ2VyUm5hTGlzdCIsInJlc2V0IiwiY2xlYXIiLCJhZGRPZmZMaW1pdHNNb3Rpb25TcGFjZSIsIm5ld09mZkxpbWl0c1NwYWNlIiwib2ZmTGltaXRzTW90aW9uU3BhY2UiLCJlcXVhbHMiLCJib3R0b21ZUG9zIiwiRE5BX01PTEVDVUxFX1lfUE9TIiwiZ2V0Q2VudGVyWCIsIm1vdGlvbkJvdW5kcyIsIm9mZkxpbWl0TW90aW9uU3BhY2UiLCJhZGRPZmZMaW1pdE1vdGlvblNwYWNlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJNYW51YWxHZW5lRXhwcmVzc2lvbk1vZGVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjEsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFByaW1hcnkgbW9kZWwgZm9yIHRoZSAnRXhwcmVzc2lvbicgc2NyZWVuLiAgVGhpcyBtb2RlbCBpbnRlcmFjdHMgd2l0aCB0aGUgdXNlciAodmlhIHRoZSB2aWV3KSB0byBhbGxvdyB0aGVtIHRvXHJcbiAqIHN5bnRoZXNpemUgcHJvdGVpbnMgZnJvbSB0aGUgaW5mb3JtYXRpb24gY29kZWQgaW4gdGhlIEROQSBzdHJhbmQgYnkgbWFudWFsbHkgbWFuaXB1bGF0aW5nIHRoZSB2YXJpb3VzIGJpb21vbGVjdWxlc1xyXG4gKiB0aGF0IGFyZSBpbnZvbHZlZCBpbiB0aGUgcHJvY2Vzcy5cclxuICpcclxuICogVGhlIHBvaW50ICgwLDApIGluIG1vZGVsIHNwYWNlIGlzIGF0IHRoZSBsZWZ0bW9zdCBlZGdlIG9mIHRoZSBETkEgc3RyYW5kLCBhbmQgYXQgdGhlIHZlcnRpY2FsIGNlbnRlciBvZiB0aGUgc3RyYW5kLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNoYXJmdWRlZW4gQXNocmFmXHJcbiAqIEBhdXRob3IgTW9oYW1lZCBTYWZpXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICogQGF1dGhvciBBYWRpc2ggR3VwdGFcclxuICovXHJcblxyXG5pbXBvcnQgY3JlYXRlT2JzZXJ2YWJsZUFycmF5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvY3JlYXRlT2JzZXJ2YWJsZUFycmF5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgR0VFQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9HRUVDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgRG5hTW9sZWN1bGUgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL0RuYU1vbGVjdWxlLmpzJztcclxuaW1wb3J0IEdlbmVBIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9HZW5lQS5qcyc7XHJcbmltcG9ydCBHZW5lRXhwcmVzc2lvbk1vZGVsIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9HZW5lRXhwcmVzc2lvbk1vZGVsLmpzJztcclxuaW1wb3J0IE1vdGlvbkJvdW5kcyBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvbW90aW9uLXN0cmF0ZWdpZXMvTW90aW9uQm91bmRzLmpzJztcclxuaW1wb3J0IFByb3RlaW4gZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL1Byb3RlaW4uanMnO1xyXG5pbXBvcnQgZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzIGZyb20gJy4uLy4uL2dlbmVFeHByZXNzaW9uRXNzZW50aWFscy5qcyc7XHJcbmltcG9ydCBHZW5lQiBmcm9tICcuL0dlbmVCLmpzJztcclxuaW1wb3J0IEdlbmVDIGZyb20gJy4vR2VuZUMuanMnO1xyXG5pbXBvcnQgUHJvdGVpbkEgZnJvbSAnLi9Qcm90ZWluQS5qcyc7XHJcbmltcG9ydCBQcm90ZWluQiBmcm9tICcuL1Byb3RlaW5CLmpzJztcclxuaW1wb3J0IFByb3RlaW5DIGZyb20gJy4vUHJvdGVpbkMuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbi8vIFN0YWdlIHNpemUgZm9yIHRoZSBtb2JpbGUgYmlvbW9sZWN1bGVzLCB3aGljaCBpcyBiYXNpY2FsbHkgdGhlIGFyZWEgaW4gd2hpY2ggdGhlIG1vbGVjdWxlcyBjYW4gbW92ZS4gVGhlc2UgYXJlXHJcbi8vIGVtcGlyaWNhbGx5IGRldGVybWluZWQgc3VjaCB0aGF0IHRoZSBtb2xlY3VsZXMgZG9uJ3QgbW92ZSBvZmYgb2YgdGhlIHNjcmVlbiB3aGVuIGxvb2tpbmcgYXQgYSBnaXZlbiBnZW5lLlxyXG5jb25zdCBCSU9NT0xFQ1VMRV9TVEFHRV9XSURUSCA9IDEwMDAwOyAvLyBJbiBwaWNvbWV0ZXJzLlxyXG5jb25zdCBCSU9NT0xFQ1VMRV9TVEFHRV9IRUlHSFQgPSA2MDAwOyAvLyBJbiBwaWNvbWV0ZXJzLlxyXG5cclxuLy8gc2l6ZSBvZiB0aGUgRE5BIHN0cmFuZFxyXG5jb25zdCBOVU1fQkFTRV9QQUlSU19PTl9ETkFfU1RSQU5EID0gMjAwMDtcclxuXHJcbmNsYXNzIE1hbnVhbEdlbmVFeHByZXNzaW9uTW9kZWwgZXh0ZW5kcyBHZW5lRXhwcmVzc2lvbk1vZGVsIHtcclxuXHJcbiAgLyoqXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtEbmFNb2xlY3VsZX0gLSB0aGUgRE5BIHN0cmFuZCwgd2hpY2ggaXMgd2hlcmUgdGhlIGdlbmVzIHJlc2lkZSBhbmQgd2hlcmUgdGhlIHBvbHltZXJhc2UgZG9lcyBpdHNcclxuICAgIC8vIHRyYW5zY3JpcHRpb24sIGFuZCB3aGVyZSBhIGxvdCBvZiB0aGUgYWN0aW9uIHdpdGhpbiB0aGlzIG1vZGVsIHRha2VzIHBsYWNlLlxyXG4gICAgdGhpcy5kbmFNb2xlY3VsZSA9IG5ldyBEbmFNb2xlY3VsZShcclxuICAgICAgdGhpcyxcclxuICAgICAgTlVNX0JBU0VfUEFJUlNfT05fRE5BX1NUUkFORCxcclxuICAgICAgLU5VTV9CQVNFX1BBSVJTX09OX0ROQV9TVFJBTkQgKiBHRUVDb25zdGFudHMuRElTVEFOQ0VfQkVUV0VFTl9CQVNFX1BBSVJTIC8gNCxcclxuICAgICAgZmFsc2VcclxuICAgICk7XHJcbiAgICB0aGlzLmRuYU1vbGVjdWxlLmFkZEdlbmUoIG5ldyBHZW5lQSggdGhpcy5kbmFNb2xlY3VsZSwgTlVNX0JBU0VfUEFJUlNfT05fRE5BX1NUUkFORCAvIDQgLSBHZW5lQS5OVU1fQkFTRV9QQUlSUyAvIDIgKSApO1xyXG4gICAgdGhpcy5kbmFNb2xlY3VsZS5hZGRHZW5lKCBuZXcgR2VuZUIoIHRoaXMuZG5hTW9sZWN1bGUsIE5VTV9CQVNFX1BBSVJTX09OX0ROQV9TVFJBTkQgLyAyIC0gR2VuZUIuTlVNX0JBU0VfUEFJUlMgLyAyICkgKTtcclxuICAgIHRoaXMuZG5hTW9sZWN1bGUuYWRkR2VuZSggbmV3IEdlbmVDKCB0aGlzLmRuYU1vbGVjdWxlLCBOVU1fQkFTRV9QQUlSU19PTl9ETkFfU1RSQU5EICogMyAvIDQgLSBHZW5lQy5OVU1fQkFTRV9QQUlSUyAvIDIgKSApO1xyXG5cclxuICAgIC8vIGxpc3Qgb2YgbW9iaWxlIGJpb21vbGVjdWxlcyBpbiB0aGUgbW9kZWwsIGV4Y2x1ZGluZyBtUk5BXHJcbiAgICB0aGlzLm1vYmlsZUJpb21vbGVjdWxlTGlzdCA9IGNyZWF0ZU9ic2VydmFibGVBcnJheSgpOyAvLyBAcHVibGljXHJcblxyXG4gICAgLy8gbGlzdCBvZiBtUk5BIG1vbGVjdWxlcyBpbiB0aGUgc2ltIC0gVGhlc2UgYXJlIGtlcHQgc2VwYXJhdGUgYmVjYXVzZSB0aGV5IGFyZSB0cmVhdGVkIGEgYml0IGRpZmZlcmVudGx5IHRoYW4gdGhlXHJcbiAgICAvLyBvdGhlciBtb2JpbGUgYmlvbW9sZWN1bGVzLlxyXG4gICAgdGhpcy5tZXNzZW5nZXJSbmFMaXN0ID0gY3JlYXRlT2JzZXJ2YWJsZUFycmF5KCk7IC8vIEBwdWJsaWNcclxuXHJcbiAgICAvLyBUaGUgZ2VuZSB0aGF0IHRoZSB1c2VyIGlzIGZvY3VzaW5nIG9uLCBvdGhlciBnZW5lIGFjdGl2aXR5IGlzIHN1c3BlbmRlZC4gIFN0YXJ0IHdpdGggdGhlIDB0aCBnZW5lIGluIHRoZSBETkFcclxuICAgIC8vIChsZWZ0bW9zdCkuIEluaXRpYWxpemUgdmFyaWFibGVzIHRoYXQgYXJlIGRlcGVuZGVudCB1cG9uIHRoZSBETkEuXHJcbiAgICB0aGlzLmFjdGl2ZUdlbmVQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggdGhpcy5kbmFNb2xlY3VsZS5nZXRHZW5lcygpWyAwIF0gKTsgLy8gQHB1YmxpYyhyZWFkLW9ubHkpXHJcblxyXG4gICAgLy8gTGlzdCBvZiBhcmVhcyB3aGVyZSBiaW9tb2xlY3VsZXMgc2hvdWxkIG5vdCBiZSBhbGxvd2VkLiAgVGhlc2UgYXJlIGdlbmVyYWxseSBwb3B1bGF0ZWQgYnkgdGhlIHZpZXcgaW4gb3JkZXIgdG9cclxuICAgIC8vIGtlZXAgYmlvbW9sZWN1bGVzIGZyb20gd2FuZGVyaW5nIG92ZXIgdGhlIHRvb2xib3hlcyBhbmQgY29sbGVjdGlvbiBhcmVhcy5cclxuICAgIHRoaXMub2ZmTGltaXRzTW90aW9uU3BhY2VzID0gW107IC8vQHByaXZhdGVcclxuXHJcbiAgICAvLyBQcm9wZXJ0aWVzIHRoYXQgdHJhY2sgaG93IG1hbnkgb2YgdGhlIHZhcmlvdXMgcHJvdGVpbnMgaGF2ZSBiZWVuIGNvbGxlY3RlZC5cclxuICAgIHRoaXMucHJvdGVpbkFDb2xsZWN0ZWRQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggMCApOyAvLyBAcHVibGljKHJlYWQtb25seSlcclxuICAgIHRoaXMucHJvdGVpbkJDb2xsZWN0ZWRQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggMCApOyAvLyBAcHVibGljKHJlYWQtb25seSlcclxuICAgIHRoaXMucHJvdGVpbkNDb2xsZWN0ZWRQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggMCApOyAvLyBAcHVibGljKHJlYWQtb25seSlcclxuXHJcbiAgICAvLyBNYXAgb2YgdGhlIHByb3RlaW4gY29sbGVjdGlvbiBjb3VudCBwcm9wZXJ0aWVzIHRvIHRoZSBwcm90ZWluIHR5cGVzLCB1c2VkIHRvIG9idGFpbiB0aGUgY291bnQgcHJvcGVydHkgYmFzZWQgb25cclxuICAgIC8vIHRoZSB0eXBlIG9mIHByb3RlaW4uXHJcbiAgICB0aGlzLm1hcFByb3RlaW5DbGFzc1RvQ29sbGVjdGVkQ291bnQgPSB7XHJcbiAgICAgIFByb3RlaW5BOiB0aGlzLnByb3RlaW5BQ29sbGVjdGVkUHJvcGVydHksXHJcbiAgICAgIFByb3RlaW5COiB0aGlzLnByb3RlaW5CQ29sbGVjdGVkUHJvcGVydHksXHJcbiAgICAgIFByb3RlaW5DOiB0aGlzLnByb3RlaW5DQ29sbGVjdGVkUHJvcGVydHlcclxuICAgIH07XHJcblxyXG4gICAgLy8gUmVjdGFuZ2xlIHRoYXQgZGVzY3JpYmVzIHRoZSBcInByb3RlaW4gY2FwdHVyZSBhcmVhXCIuICBXaGVuIGEgcHJvdGVpbiBpcyBkcm9wcGVkIGJ5IHRoZSB1c2VyIG92ZXIgdGhpcyBhcmVhLCBpdFxyXG4gICAgLy8gaXMgY29uc2lkZXJlZCB0byBiZSBjYXB0dXJlZC5cclxuICAgIC8vIEluaXRpYWxseSBpdCBpcyBlbXB0eSBhbmQgaXMgc2V0IGJ5IGNhbGwgdG8gdGhlIGZ1bmN0aW9uIHNldFByb3RlaW5DYXB0dXJlQXJlYSgpXHJcbiAgICB0aGlzLnByb3RlaW5DYXB0dXJlQXJlYSA9IEJvdW5kczIuTk9USElORy5jb3B5KCk7IC8vIEBwcml2YXRlXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBtYWluIHN0ZXAgZnVuY3Rpb24gZm9yIHRoaXMgbW9kZWxcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHRcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc3RlcCggZHQgKSB7XHJcblxyXG4gICAgdGhpcy5tb2JpbGVCaW9tb2xlY3VsZUxpc3QuZm9yRWFjaCggbW9iaWxlQmlvbW9sZWN1bGUgPT4ge1xyXG4gICAgICBtb2JpbGVCaW9tb2xlY3VsZS5zdGVwKCBkdCApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMubWVzc2VuZ2VyUm5hTGlzdC5mb3JFYWNoKCBtZXNzZW5nZXJSbmEgPT4ge1xyXG4gICAgICBtZXNzZW5nZXJSbmEuc3RlcCggZHQgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmRuYU1vbGVjdWxlLnN0ZXAoIGR0ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcmV0dXJucyB7RG5hTW9sZWN1bGV9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGdldERuYU1vbGVjdWxlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZG5hTW9sZWN1bGU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTd2l0Y2ggdG8gdGhlIHByZXZpb3VzIGdlbmVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcHJldmlvdXNHZW5lKCkge1xyXG4gICAgdGhpcy5zd2l0Y2hUb0dlbmVSZWxhdGl2ZSggLTEgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN3aXRjaCB0byB0aGUgbmV4dCBnZW5lXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIG5leHRHZW5lKCkge1xyXG4gICAgdGhpcy5zd2l0Y2hUb0dlbmVSZWxhdGl2ZSggKzEgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7Qm91bmRzMn0gbmV3Q2FwdHVyZUFyZWFCb3VuZHNcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc2V0UHJvdGVpbkNhcHR1cmVBcmVhKCBuZXdDYXB0dXJlQXJlYUJvdW5kcyApIHtcclxuICAgIHRoaXMucHJvdGVpbkNhcHR1cmVBcmVhLnNldCggbmV3Q2FwdHVyZUFyZWFCb3VuZHMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwcm90ZWluVHlwZVxyXG4gICAqIEByZXR1cm5zIHtQcm9wZXJ0eX1cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZ2V0Q29sbGVjdGVkQ291bnRlckZvclByb3RlaW5UeXBlKCBwcm90ZWluVHlwZSApIHtcclxuICAgIHJldHVybiB0aGlzLm1hcFByb3RlaW5DbGFzc1RvQ29sbGVjdGVkQ291bnRbIHByb3RlaW5UeXBlIF07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge251bWJlcn0gaVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgc3dpdGNoVG9HZW5lUmVsYXRpdmUoIGkgKSB7XHJcbiAgICBjb25zdCBnZW5lcyA9IHRoaXMuZG5hTW9sZWN1bGUuZ2V0R2VuZXMoKTtcclxuICAgIGNvbnN0IGluZGV4ID0gVXRpbHMuY2xhbXAoIDAsIGdlbmVzLmluZGV4T2YoIHRoaXMuYWN0aXZlR2VuZVByb3BlcnR5LmdldCgpICkgKyBpLCBnZW5lcy5sZW5ndGggLSAxICk7XHJcbiAgICB0aGlzLmFjdGl2ZUdlbmVQcm9wZXJ0eS5zZXQoIGdlbmVzWyBpbmRleCBdICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge251bWJlcn0gaVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgYWN0aXZhdGVHZW5lKCBpICkge1xyXG4gICAgdGhpcy5hY3RpdmVHZW5lUHJvcGVydHkuc2V0KCB0aGlzLmRuYU1vbGVjdWxlLmdldEdlbmVzKClbIGkgXSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICogQHBhcmFtIHtNb2JpbGVCaW9tb2xlY3VsZX0gbW9iaWxlQmlvbW9sZWN1bGVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgYWRkTW9iaWxlQmlvbW9sZWN1bGUoIG1vYmlsZUJpb21vbGVjdWxlICkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICB0aGlzLm1vYmlsZUJpb21vbGVjdWxlTGlzdC5hZGQoIG1vYmlsZUJpb21vbGVjdWxlICk7XHJcbiAgICBtb2JpbGVCaW9tb2xlY3VsZS5zZXRNb3Rpb25Cb3VuZHMoIHRoaXMuZ2V0Qm91bmRzRm9yQWN0aXZlR2VuZSgpICk7XHJcblxyXG4gICAgLy8gSG9vayB1cCBhbiBvYnNlcnZlciB0aGF0IHdpbGwgYWN0aXZhdGUgYW5kIGRlYWN0aXZhdGUgcGxhY2VtZW50IGhpbnRzIGZvciB0aGlzIG1vbGVjdWxlLlxyXG4gICAgbW9iaWxlQmlvbW9sZWN1bGUudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5saW5rKCAoIGlzVXNlckNvbnRyb2xsZWQsIHdhc1VzZXJDb250cm9sbGVkICkgPT4ge1xyXG5cclxuICAgICAgaWYgKCBpc1VzZXJDb250cm9sbGVkICkge1xyXG4gICAgICAgIHRoaXMuZG5hTW9sZWN1bGUuYWN0aXZhdGVIaW50cyggbW9iaWxlQmlvbW9sZWN1bGUgKTtcclxuICAgICAgICB0aGlzLm1lc3NlbmdlclJuYUxpc3QuZm9yRWFjaCggbWVzc2VuZ2VyUm5hID0+IHtcclxuICAgICAgICAgIG1lc3NlbmdlclJuYS5hY3RpdmF0ZUhpbnRzKCBtb2JpbGVCaW9tb2xlY3VsZSApO1xyXG4gICAgICAgIH0gKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgaWYgKCB3YXNVc2VyQ29udHJvbGxlZCApIHtcclxuXHJcbiAgICAgICAgICAvLyBUaGUgdXNlciBkcm9wcGVkIHRoaXMgYmlvbW9sZWN1bGUsIHNvIGRlYWN0aXZhdGUgYW55IGhpbnRzIHRoYXQgd2VyZSBzaG93aW5nIHdoZXJlIGl0IGNvdWxkIGJlIHBsYWNlZC5cclxuICAgICAgICAgIHRoaXMuZG5hTW9sZWN1bGUuZGVhY3RpdmF0ZUFsbEhpbnRzKCk7XHJcbiAgICAgICAgICB0aGlzLm1lc3NlbmdlclJuYUxpc3QuZm9yRWFjaCggbWVzc2VuZ2VyUm5hID0+IHtcclxuICAgICAgICAgICAgbWVzc2VuZ2VyUm5hLmRlYWN0aXZhdGVBbGxIaW50cygpO1xyXG4gICAgICAgICAgfSApO1xyXG5cclxuICAgICAgICAgIC8vIFNlZSBpZiB0aGlzIGlzIGEgcHJvdGVpbiBiZWluZyBwbGFjZWQgaW4gdGhlIGNhcHR1cmUgYXJlYS5cclxuICAgICAgICAgIGlmICggdGhpcy5wcm90ZWluQ2FwdHVyZUFyZWEuY29udGFpbnNQb2ludCggbW9iaWxlQmlvbW9sZWN1bGUuZ2V0UG9zaXRpb24oKSApICYmXHJcbiAgICAgICAgICAgICAgIG1vYmlsZUJpb21vbGVjdWxlIGluc3RhbmNlb2YgUHJvdGVpbiApIHtcclxuXHJcbiAgICAgICAgICAgIC8vIFRoZSB1c2VyIGhhcyBkcm9wcGVkIHRoaXMgcHJvdGVpbiBpbiB0aGUgY2FwdHVyZSBhcmVhLiBTbyBjYXB0dXJlIGl0LlxyXG4gICAgICAgICAgICB0aGlzLmNhcHR1cmVQcm90ZWluKCBtb2JpbGVCaW9tb2xlY3VsZSApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEhvb2sgdXAgYW4gb2JzZXJ2ZXIgdGhhdCB3aWxsIHJlbW92ZSB0aGlzIGJpb21vbGVjdWxlIGZyb20gdGhlIG1vZGVsIGlmIGl0cyBleGlzdGVuY2Ugc3RyZW5ndGggcmVhY2hlcyB6ZXJvLlxyXG4gICAgbW9iaWxlQmlvbW9sZWN1bGUuZXhpc3RlbmNlU3RyZW5ndGhQcm9wZXJ0eS5saW5rKCBmdW5jdGlvbiBleGlzdGVuY2VTdHJlbmd0aENoYW5nZUhhbmRsZXIoIGV4aXN0ZW5jZVN0cmVuZ3RoICkge1xyXG4gICAgICBpZiAoIGV4aXN0ZW5jZVN0cmVuZ3RoID09PSAwICkge1xyXG4gICAgICAgIHNlbGYucmVtb3ZlTW9iaWxlQmlvbW9sZWN1bGUoIG1vYmlsZUJpb21vbGVjdWxlICk7XHJcbiAgICAgICAgbW9iaWxlQmlvbW9sZWN1bGUuZXhpc3RlbmNlU3RyZW5ndGhQcm9wZXJ0eS51bmxpbmsoIGV4aXN0ZW5jZVN0cmVuZ3RoQ2hhbmdlSGFuZGxlciApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYSBsaXN0IG9mIGFsbCBtb2JpbGUgYmlvbW9sZWN1bGVzIHRoYXQgb3ZlcmxhcCB3aXRoIHRoZSBwcm92aWRlZCBzaGFwZS5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Qm91bmRzMn0gdGVzdFNoYXBlQm91bmRzIC0gQm91bmRzLCBpbiBtb2RlbCBjb29yZGluYXRlLCB0byB0ZXN0IGZvciBvdmVybGFwLlxyXG4gICAqIEByZXR1cm5zIHtBcnJheS48TW9iaWxlQmlvbW9sZWN1bGU+fSBMaXN0IG9mIG1vbGVjdWxlcyB0aGF0IG92ZXJsYXAgd2l0aCB0aGUgcHJvdmlkZWQgYm91bmRzLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBnZXRPdmVybGFwcGluZ0Jpb21vbGVjdWxlcyggdGVzdFNoYXBlQm91bmRzICkge1xyXG5cclxuICAgIGNvbnN0IG92ZXJsYXBwaW5nQmlvbW9sZWN1bGVzID0gW107XHJcblxyXG4gICAgdGhpcy5tb2JpbGVCaW9tb2xlY3VsZUxpc3QuZm9yRWFjaCggbW9iaWxlQmlvbW9sZWN1bGUgPT4ge1xyXG4gICAgICBpZiAoIG1vYmlsZUJpb21vbGVjdWxlLmJvdW5kcy5pbnRlcnNlY3RzQm91bmRzKCB0ZXN0U2hhcGVCb3VuZHMgKSApIHtcclxuXHJcbiAgICAgICAgb3ZlcmxhcHBpbmdCaW9tb2xlY3VsZXMucHVzaCggbW9iaWxlQmlvbW9sZWN1bGUgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIHJldHVybiBvdmVybGFwcGluZ0Jpb21vbGVjdWxlcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhcHR1cmUgdGhlIHNwZWNpZmllZCBwcm90ZWluLCB3aGljaCBtZWFucyB0aGF0IGl0IGlzIGFjdHVhbGx5IHJlbW92ZWQgZnJvbSB0aGUgbW9kZWwgYW5kIHRoZSBhc3NvY2lhdGVkXHJcbiAgICogY2FwdHVyZSBjb3VudCBwcm9wZXJ0eSBpcyBpbmNyZW1lbnRlZC5cclxuICAgKiBAcGFyYW0ge1Byb3RlaW59IHByb3RlaW5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGNhcHR1cmVQcm90ZWluKCBwcm90ZWluICkge1xyXG4gICAgaWYgKCBwcm90ZWluIGluc3RhbmNlb2YgUHJvdGVpbkEgKSB7XHJcbiAgICAgIHRoaXMucHJvdGVpbkFDb2xsZWN0ZWRQcm9wZXJ0eS5zZXQoIHRoaXMucHJvdGVpbkFDb2xsZWN0ZWRQcm9wZXJ0eS5nZXQoKSArIDEgKTtcclxuICAgIH1cclxuICAgIGlmICggcHJvdGVpbiBpbnN0YW5jZW9mIFByb3RlaW5CICkge1xyXG4gICAgICB0aGlzLnByb3RlaW5CQ29sbGVjdGVkUHJvcGVydHkuc2V0KCB0aGlzLnByb3RlaW5CQ29sbGVjdGVkUHJvcGVydHkuZ2V0KCkgKyAxICk7XHJcbiAgICB9XHJcbiAgICBpZiAoIHByb3RlaW4gaW5zdGFuY2VvZiBQcm90ZWluQyApIHtcclxuICAgICAgdGhpcy5wcm90ZWluQ0NvbGxlY3RlZFByb3BlcnR5LnNldCggdGhpcy5wcm90ZWluQ0NvbGxlY3RlZFByb3BlcnR5LmdldCgpICsgMSApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5tb2JpbGVCaW9tb2xlY3VsZUxpc3QucmVtb3ZlKCBwcm90ZWluICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1Byb3RlaW59IHByb3RlaW5DbGFzc1R5cGVcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBnZXRQcm90ZWluQ291bnQoIHByb3RlaW5DbGFzc1R5cGUgKSB7XHJcbiAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgdGhpcy5tb2JpbGVCaW9tb2xlY3VsZUxpc3QuZm9yRWFjaCggbW9iaWxlQmlvbW9sZWN1bGUgPT4ge1xyXG4gICAgICBpZiAoIG1vYmlsZUJpb21vbGVjdWxlIGluc3RhbmNlb2YgcHJvdGVpbkNsYXNzVHlwZSApIHtcclxuICAgICAgICBjb3VudCsrO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICByZXR1cm4gY291bnQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge01vYmlsZUJpb21vbGVjdWxlfSBtb2JpbGVCaW9tb2xlY3VsZVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICByZW1vdmVNb2JpbGVCaW9tb2xlY3VsZSggbW9iaWxlQmlvbW9sZWN1bGUgKSB7XHJcbiAgICB0aGlzLm1vYmlsZUJpb21vbGVjdWxlTGlzdC5yZW1vdmUoIG1vYmlsZUJpb21vbGVjdWxlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge01lc3NlbmdlclJuYX0gbWVzc2VuZ2VyUm5hXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGFkZE1lc3NlbmdlclJuYSggbWVzc2VuZ2VyUm5hICkge1xyXG4gICAgdGhpcy5tZXNzZW5nZXJSbmFMaXN0LmFkZCggbWVzc2VuZ2VyUm5hICk7XHJcbiAgICBtZXNzZW5nZXJSbmEuc2V0TW90aW9uQm91bmRzKCB0aGlzLmdldEJvdW5kc0ZvckFjdGl2ZUdlbmUoKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtNZXNzZW5nZXJSbmF9IG1lc3NlbmdlclJuYUJlaW5nRGVzdHJveWVkXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHJlbW92ZU1lc3NlbmdlclJuYSggbWVzc2VuZ2VyUm5hQmVpbmdEZXN0cm95ZWQgKSB7XHJcbiAgICB0aGlzLm1lc3NlbmdlclJuYUxpc3QucmVtb3ZlKCBtZXNzZW5nZXJSbmFCZWluZ0Rlc3Ryb3llZCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICogQHJldHVybnMge09ic2VydmFibGVBcnJheURlZn1cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZ2V0TWVzc2VuZ2VyUm5hTGlzdCgpIHtcclxuICAgIHJldHVybiB0aGlzLm1lc3NlbmdlclJuYUxpc3Q7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNldHMgdGhlIG1vZGVsIHRvIGluaXRpYWwgc3RhdGVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLm1vYmlsZUJpb21vbGVjdWxlTGlzdC5jbGVhcigpO1xyXG4gICAgdGhpcy5tZXNzZW5nZXJSbmFMaXN0LmNsZWFyKCk7XHJcbiAgICB0aGlzLmRuYU1vbGVjdWxlLnJlc2V0KCk7XHJcbiAgICB0aGlzLnByb3RlaW5BQ29sbGVjdGVkUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMucHJvdGVpbkJDb2xsZWN0ZWRQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5wcm90ZWluQ0NvbGxlY3RlZFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmFjdGl2YXRlR2VuZSggMCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWRkIGEgc3BhY2Ugd2hlcmUgdGhlIGJpb21vbGVjdWxlcyBzaG91bGQgbm90IGJlIGFsbG93ZWQgdG8gd2FuZGVyLiBUaGlzIGlzIGdlbmVyYWxseSB1c2VkIGJ5IHRoZSB2aWV3IHRvIHByZXZlbnRcclxuICAgKiBiaW9tb2xlY3VsZXMgZnJvbSBtb3Zpbmcgb3ZlciB0b29sYm94ZXMgYW5kIHN1Y2guXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge0JvdW5kczJ9IG5ld09mZkxpbWl0c1NwYWNlXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGFkZE9mZkxpbWl0c01vdGlvblNwYWNlKCBuZXdPZmZMaW1pdHNTcGFjZSApIHtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMub2ZmTGltaXRzTW90aW9uU3BhY2VzLmxlbmd0aDsgaSsrICkge1xyXG5cclxuICAgICAgY29uc3Qgb2ZmTGltaXRzTW90aW9uU3BhY2UgPSB0aGlzLm9mZkxpbWl0c01vdGlvblNwYWNlc1sgaSBdO1xyXG4gICAgICBpZiAoIG9mZkxpbWl0c01vdGlvblNwYWNlLmVxdWFscyggbmV3T2ZmTGltaXRzU3BhY2UgKSApIHtcclxuICAgICAgICAvLyBBbiBlcXVpdmFsZW50IHNwYWNlIGFscmVhZHkgZXhpc3RzLCBzbyBkb24ndCBib3RoZXIgYWRkaW5nIHRoaXMgb25lLlxyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gQWRkIHRoZSBuZXcgb25lIHRvIHRoZSBsaXN0LlxyXG4gICAgdGhpcy5vZmZMaW1pdHNNb3Rpb25TcGFjZXMucHVzaCggbmV3T2ZmTGltaXRzU3BhY2UgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgbW90aW9uIGJvdW5kcyBmb3IgYW55IGJpb21vbGVjdWxlIHRoYXQgaXMgZ29pbmcgdG8gYmUgYXNzb2NpYXRlZCB3aXRoIHRoZSBjdXJyZW50bHkgYWN0aXZlIGdlbmUuICBUaGlzIGlzXHJcbiAgICogdXNlZCB0byBrZWVwIHRoZSBiaW9tb2xlY3VsZXMgZnJvbSB3YW5kZXJpbmcgb3V0c2lkZSBvZiB0aGUgYXJlYSB0aGF0IHRoZSB1c2VyIGNhbiBzZWUuXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBnZXRCb3VuZHNGb3JBY3RpdmVHZW5lKCkge1xyXG5cclxuICAgIC8vIFRoZSBib3R0b20gYm91bmRzIGFyZSBpbnRlbmRlZCB0byBiZSByb3VnaGx5IGF0IHRoZSBib3R0b20gb2YgdGhlIHZpZXdwb3J0LiAgVGhlIHZhbHVlIHdhcyBlbXBpcmljYWxseSBkZXRlcm1pbmVkLlxyXG4gICAgY29uc3QgYm90dG9tWVBvcyA9IEdFRUNvbnN0YW50cy5ETkFfTU9MRUNVTEVfWV9QT1MgLSAyMTAwO1xyXG5cclxuICAgIC8vIEdldCB0aGUgbm9taW5hbCBib3VuZHMgZm9yIHRoaXMgZ2VuZS5cclxuICAgIGNvbnN0IGJvdW5kcyA9IG5ldyBCb3VuZHMyKCB0aGlzLmFjdGl2ZUdlbmVQcm9wZXJ0eS5nZXQoKS5nZXRDZW50ZXJYKCkgLSBCSU9NT0xFQ1VMRV9TVEFHRV9XSURUSCAvIDIsXHJcbiAgICAgIGJvdHRvbVlQb3MsXHJcbiAgICAgIHRoaXMuYWN0aXZlR2VuZVByb3BlcnR5LmdldCgpLmdldENlbnRlclgoKSAtIEJJT01PTEVDVUxFX1NUQUdFX1dJRFRIIC8gMiArIEJJT01PTEVDVUxFX1NUQUdFX1dJRFRILFxyXG4gICAgICBib3R0b21ZUG9zICsgQklPTU9MRUNVTEVfU1RBR0VfSEVJR0hUICk7XHJcblxyXG4gICAgY29uc3QgbW90aW9uQm91bmRzID0gbmV3IE1vdGlvbkJvdW5kcyggYm91bmRzICk7XHJcbiAgICAvLyBTdWJ0cmFjdCBvZmYgYW55IG9mZiBsaW1pdHMgYXJlYXMuXHJcbiAgICB0aGlzLm9mZkxpbWl0c01vdGlvblNwYWNlcy5mb3JFYWNoKCBvZmZMaW1pdE1vdGlvblNwYWNlID0+IHtcclxuICAgICAgaWYgKCBib3VuZHMuaW50ZXJzZWN0c0JvdW5kcyggb2ZmTGltaXRNb3Rpb25TcGFjZSApICkge1xyXG4gICAgICAgIG1vdGlvbkJvdW5kcy5hZGRPZmZMaW1pdE1vdGlvblNwYWNlKCBvZmZMaW1pdE1vdGlvblNwYWNlICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIHJldHVybiBtb3Rpb25Cb3VuZHM7XHJcbiAgfVxyXG59XHJcblxyXG5nZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMucmVnaXN0ZXIoICdNYW51YWxHZW5lRXhwcmVzc2lvbk1vZGVsJywgTWFudWFsR2VuZUV4cHJlc3Npb25Nb2RlbCApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgTWFudWFsR2VuZUV4cHJlc3Npb25Nb2RlbDsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxxQkFBcUIsTUFBTSw4Q0FBOEM7QUFDaEYsT0FBT0MsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsWUFBWSxNQUFNLDhCQUE4QjtBQUN2RCxPQUFPQyxXQUFXLE1BQU0sbUNBQW1DO0FBQzNELE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsbUJBQW1CLE1BQU0sMkNBQTJDO0FBQzNFLE9BQU9DLFlBQVksTUFBTSxzREFBc0Q7QUFDL0UsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyx3QkFBd0IsTUFBTSxtQ0FBbUM7QUFDeEUsT0FBT0MsS0FBSyxNQUFNLFlBQVk7QUFDOUIsT0FBT0MsS0FBSyxNQUFNLFlBQVk7QUFDOUIsT0FBT0MsUUFBUSxNQUFNLGVBQWU7QUFDcEMsT0FBT0MsUUFBUSxN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