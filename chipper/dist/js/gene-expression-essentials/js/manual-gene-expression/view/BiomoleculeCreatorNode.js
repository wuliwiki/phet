// Copyright 2015-2022, University of Colorado Boulder

/**
 * This class defines a node that can be used in the view to create biomolecules in the model. It is intended for use in
 * panels, often referred to as "toolboxes". It is generalized so that the parameters allow it to create any sort of
 * biomolecule.
 *
 * @author Sharfudeen Ashraf
 * @author John Blanco
 * @author Aadish Gupta
 */

import { DragListener, Node, SceneryConstants } from '../../../../scenery/js/imports.js';
import geneExpressionEssentials from '../../geneExpressionEssentials.js';
class BiomoleculeCreatorNode extends Node {
  /**
   * @param {Path} appearanceNode - Node that represents the appearance of this creator node, generally looks like the
   * thing being created.
   * @param {ManualGeneExpressionScreenView} screenView - Screen view upon which this node ultimately resides.  This is
   * needed for figuring out where in model space this node exists and obtaining the node that represent the biomolecule
   * in the view.
   * @param {ModelViewTransform2} modelViewTransform - Model view transform.
   * @param {Function} moleculeCreator -  Function object that knows how to create the model element and add it to the
   * model.
   * @param {Function} moleculeDestroyer
   * @param enclosingToolboxNode - Toolbox in which this creator node is  contained.  This is needed in order to
   * determine when the created model element is returned to the toolbox.
   */
  constructor(appearanceNode, screenView, modelViewTransform, moleculeCreator, moleculeDestroyer, enclosingToolboxNode) {
    super({
      cursor: 'pointer'
    });

    // @private - values used in methods
    this.screenView = screenView;
    this.modelViewTransform = modelViewTransform;
    this.appearanceNode = appearanceNode;
    this.biomolecule = null;

    // Appearance Node is a bioMolecule Node which has its own DragHandler, since the node within the creator Node only
    // serves as a icon, it shouldn't be pickable - otherwise the DragHandler of the BioMolecule takes over the
    // Input Listener of the creator Node
    appearanceNode.pickable = false;
    this.mouseArea = appearanceNode.bounds.dilated(2);
    this.touchArea = appearanceNode.bounds.dilated(5);

    // Add a listener that will create a biomolecule, then forward drag events to created node in the view.
    this.addInputListener(DragListener.createForwardingListener(event => {
      // Set the node to look faded out so that something is still visible. This acts as a legend in the toolbox.
      this.pickable = false;
      appearanceNode.opacity = SceneryConstants.DISABLED_OPACITY;

      // Convert the screenView position to the corresponding position in the model.
      const modelPosition = this.getModelPosition(event.pointer.point);

      // Create a biomolecule and add it to the model.
      this.biomolecule = moleculeCreator(modelPosition);
      this.biomolecule.userControlledProperty.set(true);

      // Add an observer to watch for this model element to be returned.
      this.userControlledListener = userControlled => {
        if (!userControlled) {
          // The user has released this biomolecule.  If it was dropped above the return bounds (which are generally
          // the bounds of the toolbox where this creator node resides), then the model element should be removed from
          // the model.  Otherwise the model will handle this change.
          const inBox = enclosingToolboxNode.bounds.containsPoint(modelViewTransform.modelToViewPosition(this.biomolecule.getPosition()));
          if (inBox) {
            moleculeDestroyer(this.biomolecule);
            this.biomolecule.userControlledProperty.unlink(this.userControlledListener);

            // Update this node to reflect that it's in a state where it can create a new biomolecule.
            this.appearanceNode.opacity = 1;
            this.pickable = true;

            // Update internal state.
            this.biomolecule = null;
          }
        }
      };
      this.biomolecule.userControlledProperty.link(this.userControlledListener);

      // Get the node that was added to the view for this biomolecule.
      const biomoleculeNode = screenView.mobileBiomoleculeToNodeMap.get(this.biomolecule);

      // Forward the event to the view node's drag handler.
      biomoleculeNode.dragHandler.press(event, biomoleculeNode);
    }));

    // Add the main node with which the user will interact.
    this.addChild(appearanceNode);
  }

  /**
   * Resets the Biomolecules as legends
   * @public
   */
  reset() {
    if (this.biomolecule !== null) {
      // Since there was an active biomolecule when reset was invoked, there should also be a listener on the user
      // controlled property.  Make sure that there is.
      assert && assert(this.biomolecule.userControlledProperty.hasListener(this.userControlledListener), 'the creator node should never be in a state where it has a biomolecule without a user-controlled listener');
      this.biomolecule.userControlledProperty.unlink(this.userControlledListener);
      this.userControlledListener = null;
      this.biomolecule = null;
    }
    this.appearanceNode.opacity = 1;
    this.pickable = true;
  }

  /**
   * @param {Vector2} point
   * @returns {Vector2}
   * @private
   */
  getModelPosition(point) {
    const screenViewPosition = this.screenView.globalToLocalPoint(point);
    const adjustedCanvasPos = screenViewPosition.minus(this.screenView.viewPortOffset);
    return this.modelViewTransform.viewToModelPosition(adjustedCanvasPos);
  }
}
geneExpressionEssentials.register('BiomoleculeCreatorNode', BiomoleculeCreatorNode);
export default BiomoleculeCreatorNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEcmFnTGlzdGVuZXIiLCJOb2RlIiwiU2NlbmVyeUNvbnN0YW50cyIsImdlbmVFeHByZXNzaW9uRXNzZW50aWFscyIsIkJpb21vbGVjdWxlQ3JlYXRvck5vZGUiLCJjb25zdHJ1Y3RvciIsImFwcGVhcmFuY2VOb2RlIiwic2NyZWVuVmlldyIsIm1vZGVsVmlld1RyYW5zZm9ybSIsIm1vbGVjdWxlQ3JlYXRvciIsIm1vbGVjdWxlRGVzdHJveWVyIiwiZW5jbG9zaW5nVG9vbGJveE5vZGUiLCJjdXJzb3IiLCJiaW9tb2xlY3VsZSIsInBpY2thYmxlIiwibW91c2VBcmVhIiwiYm91bmRzIiwiZGlsYXRlZCIsInRvdWNoQXJlYSIsImFkZElucHV0TGlzdGVuZXIiLCJjcmVhdGVGb3J3YXJkaW5nTGlzdGVuZXIiLCJldmVudCIsIm9wYWNpdHkiLCJESVNBQkxFRF9PUEFDSVRZIiwibW9kZWxQb3NpdGlvbiIsImdldE1vZGVsUG9zaXRpb24iLCJwb2ludGVyIiwicG9pbnQiLCJ1c2VyQ29udHJvbGxlZFByb3BlcnR5Iiwic2V0IiwidXNlckNvbnRyb2xsZWRMaXN0ZW5lciIsInVzZXJDb250cm9sbGVkIiwiaW5Cb3giLCJjb250YWluc1BvaW50IiwibW9kZWxUb1ZpZXdQb3NpdGlvbiIsImdldFBvc2l0aW9uIiwidW5saW5rIiwibGluayIsImJpb21vbGVjdWxlTm9kZSIsIm1vYmlsZUJpb21vbGVjdWxlVG9Ob2RlTWFwIiwiZ2V0IiwiZHJhZ0hhbmRsZXIiLCJwcmVzcyIsImFkZENoaWxkIiwicmVzZXQiLCJhc3NlcnQiLCJoYXNMaXN0ZW5lciIsInNjcmVlblZpZXdQb3NpdGlvbiIsImdsb2JhbFRvTG9jYWxQb2ludCIsImFkanVzdGVkQ2FudmFzUG9zIiwibWludXMiLCJ2aWV3UG9ydE9mZnNldCIsInZpZXdUb01vZGVsUG9zaXRpb24iLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkJpb21vbGVjdWxlQ3JlYXRvck5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTUtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhpcyBjbGFzcyBkZWZpbmVzIGEgbm9kZSB0aGF0IGNhbiBiZSB1c2VkIGluIHRoZSB2aWV3IHRvIGNyZWF0ZSBiaW9tb2xlY3VsZXMgaW4gdGhlIG1vZGVsLiBJdCBpcyBpbnRlbmRlZCBmb3IgdXNlIGluXHJcbiAqIHBhbmVscywgb2Z0ZW4gcmVmZXJyZWQgdG8gYXMgXCJ0b29sYm94ZXNcIi4gSXQgaXMgZ2VuZXJhbGl6ZWQgc28gdGhhdCB0aGUgcGFyYW1ldGVycyBhbGxvdyBpdCB0byBjcmVhdGUgYW55IHNvcnQgb2ZcclxuICogYmlvbW9sZWN1bGUuXHJcbiAqXHJcbiAqIEBhdXRob3IgU2hhcmZ1ZGVlbiBBc2hyYWZcclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKiBAYXV0aG9yIEFhZGlzaCBHdXB0YVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IERyYWdMaXN0ZW5lciwgTm9kZSwgU2NlbmVyeUNvbnN0YW50cyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBnZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMgZnJvbSAnLi4vLi4vZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzLmpzJztcclxuXHJcbmNsYXNzIEJpb21vbGVjdWxlQ3JlYXRvck5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtQYXRofSBhcHBlYXJhbmNlTm9kZSAtIE5vZGUgdGhhdCByZXByZXNlbnRzIHRoZSBhcHBlYXJhbmNlIG9mIHRoaXMgY3JlYXRvciBub2RlLCBnZW5lcmFsbHkgbG9va3MgbGlrZSB0aGVcclxuICAgKiB0aGluZyBiZWluZyBjcmVhdGVkLlxyXG4gICAqIEBwYXJhbSB7TWFudWFsR2VuZUV4cHJlc3Npb25TY3JlZW5WaWV3fSBzY3JlZW5WaWV3IC0gU2NyZWVuIHZpZXcgdXBvbiB3aGljaCB0aGlzIG5vZGUgdWx0aW1hdGVseSByZXNpZGVzLiAgVGhpcyBpc1xyXG4gICAqIG5lZWRlZCBmb3IgZmlndXJpbmcgb3V0IHdoZXJlIGluIG1vZGVsIHNwYWNlIHRoaXMgbm9kZSBleGlzdHMgYW5kIG9idGFpbmluZyB0aGUgbm9kZSB0aGF0IHJlcHJlc2VudCB0aGUgYmlvbW9sZWN1bGVcclxuICAgKiBpbiB0aGUgdmlldy5cclxuICAgKiBAcGFyYW0ge01vZGVsVmlld1RyYW5zZm9ybTJ9IG1vZGVsVmlld1RyYW5zZm9ybSAtIE1vZGVsIHZpZXcgdHJhbnNmb3JtLlxyXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IG1vbGVjdWxlQ3JlYXRvciAtICBGdW5jdGlvbiBvYmplY3QgdGhhdCBrbm93cyBob3cgdG8gY3JlYXRlIHRoZSBtb2RlbCBlbGVtZW50IGFuZCBhZGQgaXQgdG8gdGhlXHJcbiAgICogbW9kZWwuXHJcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gbW9sZWN1bGVEZXN0cm95ZXJcclxuICAgKiBAcGFyYW0gZW5jbG9zaW5nVG9vbGJveE5vZGUgLSBUb29sYm94IGluIHdoaWNoIHRoaXMgY3JlYXRvciBub2RlIGlzICBjb250YWluZWQuICBUaGlzIGlzIG5lZWRlZCBpbiBvcmRlciB0b1xyXG4gICAqIGRldGVybWluZSB3aGVuIHRoZSBjcmVhdGVkIG1vZGVsIGVsZW1lbnQgaXMgcmV0dXJuZWQgdG8gdGhlIHRvb2xib3guXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGFwcGVhcmFuY2VOb2RlLCBzY3JlZW5WaWV3LCBtb2RlbFZpZXdUcmFuc2Zvcm0sIG1vbGVjdWxlQ3JlYXRvciwgbW9sZWN1bGVEZXN0cm95ZXIsIGVuY2xvc2luZ1Rvb2xib3hOb2RlICkge1xyXG4gICAgc3VwZXIoIHsgY3Vyc29yOiAncG9pbnRlcicgfSApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIC0gdmFsdWVzIHVzZWQgaW4gbWV0aG9kc1xyXG4gICAgdGhpcy5zY3JlZW5WaWV3ID0gc2NyZWVuVmlldztcclxuICAgIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtID0gbW9kZWxWaWV3VHJhbnNmb3JtO1xyXG4gICAgdGhpcy5hcHBlYXJhbmNlTm9kZSA9IGFwcGVhcmFuY2VOb2RlO1xyXG4gICAgdGhpcy5iaW9tb2xlY3VsZSA9IG51bGw7XHJcblxyXG4gICAgLy8gQXBwZWFyYW5jZSBOb2RlIGlzIGEgYmlvTW9sZWN1bGUgTm9kZSB3aGljaCBoYXMgaXRzIG93biBEcmFnSGFuZGxlciwgc2luY2UgdGhlIG5vZGUgd2l0aGluIHRoZSBjcmVhdG9yIE5vZGUgb25seVxyXG4gICAgLy8gc2VydmVzIGFzIGEgaWNvbiwgaXQgc2hvdWxkbid0IGJlIHBpY2thYmxlIC0gb3RoZXJ3aXNlIHRoZSBEcmFnSGFuZGxlciBvZiB0aGUgQmlvTW9sZWN1bGUgdGFrZXMgb3ZlciB0aGVcclxuICAgIC8vIElucHV0IExpc3RlbmVyIG9mIHRoZSBjcmVhdG9yIE5vZGVcclxuICAgIGFwcGVhcmFuY2VOb2RlLnBpY2thYmxlID0gZmFsc2U7XHJcblxyXG4gICAgdGhpcy5tb3VzZUFyZWEgPSBhcHBlYXJhbmNlTm9kZS5ib3VuZHMuZGlsYXRlZCggMiApO1xyXG4gICAgdGhpcy50b3VjaEFyZWEgPSBhcHBlYXJhbmNlTm9kZS5ib3VuZHMuZGlsYXRlZCggNSApO1xyXG5cclxuICAgIC8vIEFkZCBhIGxpc3RlbmVyIHRoYXQgd2lsbCBjcmVhdGUgYSBiaW9tb2xlY3VsZSwgdGhlbiBmb3J3YXJkIGRyYWcgZXZlbnRzIHRvIGNyZWF0ZWQgbm9kZSBpbiB0aGUgdmlldy5cclxuICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggRHJhZ0xpc3RlbmVyLmNyZWF0ZUZvcndhcmRpbmdMaXN0ZW5lciggZXZlbnQgPT4ge1xyXG5cclxuICAgICAgLy8gU2V0IHRoZSBub2RlIHRvIGxvb2sgZmFkZWQgb3V0IHNvIHRoYXQgc29tZXRoaW5nIGlzIHN0aWxsIHZpc2libGUuIFRoaXMgYWN0cyBhcyBhIGxlZ2VuZCBpbiB0aGUgdG9vbGJveC5cclxuICAgICAgdGhpcy5waWNrYWJsZSA9IGZhbHNlO1xyXG4gICAgICBhcHBlYXJhbmNlTm9kZS5vcGFjaXR5ID0gU2NlbmVyeUNvbnN0YW50cy5ESVNBQkxFRF9PUEFDSVRZO1xyXG5cclxuICAgICAgLy8gQ29udmVydCB0aGUgc2NyZWVuVmlldyBwb3NpdGlvbiB0byB0aGUgY29ycmVzcG9uZGluZyBwb3NpdGlvbiBpbiB0aGUgbW9kZWwuXHJcbiAgICAgIGNvbnN0IG1vZGVsUG9zaXRpb24gPSB0aGlzLmdldE1vZGVsUG9zaXRpb24oIGV2ZW50LnBvaW50ZXIucG9pbnQgKTtcclxuXHJcbiAgICAgIC8vIENyZWF0ZSBhIGJpb21vbGVjdWxlIGFuZCBhZGQgaXQgdG8gdGhlIG1vZGVsLlxyXG4gICAgICB0aGlzLmJpb21vbGVjdWxlID0gbW9sZWN1bGVDcmVhdG9yKCBtb2RlbFBvc2l0aW9uICk7XHJcbiAgICAgIHRoaXMuYmlvbW9sZWN1bGUudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5zZXQoIHRydWUgKTtcclxuXHJcbiAgICAgIC8vIEFkZCBhbiBvYnNlcnZlciB0byB3YXRjaCBmb3IgdGhpcyBtb2RlbCBlbGVtZW50IHRvIGJlIHJldHVybmVkLlxyXG4gICAgICB0aGlzLnVzZXJDb250cm9sbGVkTGlzdGVuZXIgPSB1c2VyQ29udHJvbGxlZCA9PiB7XHJcbiAgICAgICAgaWYgKCAhdXNlckNvbnRyb2xsZWQgKSB7XHJcblxyXG4gICAgICAgICAgLy8gVGhlIHVzZXIgaGFzIHJlbGVhc2VkIHRoaXMgYmlvbW9sZWN1bGUuICBJZiBpdCB3YXMgZHJvcHBlZCBhYm92ZSB0aGUgcmV0dXJuIGJvdW5kcyAod2hpY2ggYXJlIGdlbmVyYWxseVxyXG4gICAgICAgICAgLy8gdGhlIGJvdW5kcyBvZiB0aGUgdG9vbGJveCB3aGVyZSB0aGlzIGNyZWF0b3Igbm9kZSByZXNpZGVzKSwgdGhlbiB0aGUgbW9kZWwgZWxlbWVudCBzaG91bGQgYmUgcmVtb3ZlZCBmcm9tXHJcbiAgICAgICAgICAvLyB0aGUgbW9kZWwuICBPdGhlcndpc2UgdGhlIG1vZGVsIHdpbGwgaGFuZGxlIHRoaXMgY2hhbmdlLlxyXG4gICAgICAgICAgY29uc3QgaW5Cb3ggPSBlbmNsb3NpbmdUb29sYm94Tm9kZS5ib3VuZHMuY29udGFpbnNQb2ludChcclxuICAgICAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIHRoaXMuYmlvbW9sZWN1bGUuZ2V0UG9zaXRpb24oKSApXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgaWYgKCBpbkJveCApIHtcclxuICAgICAgICAgICAgbW9sZWN1bGVEZXN0cm95ZXIoIHRoaXMuYmlvbW9sZWN1bGUgKTtcclxuICAgICAgICAgICAgdGhpcy5iaW9tb2xlY3VsZS51c2VyQ29udHJvbGxlZFByb3BlcnR5LnVubGluayggdGhpcy51c2VyQ29udHJvbGxlZExpc3RlbmVyICk7XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhpcyBub2RlIHRvIHJlZmxlY3QgdGhhdCBpdCdzIGluIGEgc3RhdGUgd2hlcmUgaXQgY2FuIGNyZWF0ZSBhIG5ldyBiaW9tb2xlY3VsZS5cclxuICAgICAgICAgICAgdGhpcy5hcHBlYXJhbmNlTm9kZS5vcGFjaXR5ID0gMTtcclxuICAgICAgICAgICAgdGhpcy5waWNrYWJsZSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGUgaW50ZXJuYWwgc3RhdGUuXHJcbiAgICAgICAgICAgIHRoaXMuYmlvbW9sZWN1bGUgPSBudWxsO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIHRoaXMuYmlvbW9sZWN1bGUudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5saW5rKCB0aGlzLnVzZXJDb250cm9sbGVkTGlzdGVuZXIgKTtcclxuXHJcbiAgICAgIC8vIEdldCB0aGUgbm9kZSB0aGF0IHdhcyBhZGRlZCB0byB0aGUgdmlldyBmb3IgdGhpcyBiaW9tb2xlY3VsZS5cclxuICAgICAgY29uc3QgYmlvbW9sZWN1bGVOb2RlID0gc2NyZWVuVmlldy5tb2JpbGVCaW9tb2xlY3VsZVRvTm9kZU1hcC5nZXQoIHRoaXMuYmlvbW9sZWN1bGUgKTtcclxuXHJcbiAgICAgIC8vIEZvcndhcmQgdGhlIGV2ZW50IHRvIHRoZSB2aWV3IG5vZGUncyBkcmFnIGhhbmRsZXIuXHJcbiAgICAgIGJpb21vbGVjdWxlTm9kZS5kcmFnSGFuZGxlci5wcmVzcyggZXZlbnQsIGJpb21vbGVjdWxlTm9kZSApO1xyXG4gICAgfSApICk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBtYWluIG5vZGUgd2l0aCB3aGljaCB0aGUgdXNlciB3aWxsIGludGVyYWN0LlxyXG4gICAgdGhpcy5hZGRDaGlsZCggYXBwZWFyYW5jZU5vZGUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc2V0cyB0aGUgQmlvbW9sZWN1bGVzIGFzIGxlZ2VuZHNcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICBpZiAoIHRoaXMuYmlvbW9sZWN1bGUgIT09IG51bGwgKSB7XHJcblxyXG4gICAgICAvLyBTaW5jZSB0aGVyZSB3YXMgYW4gYWN0aXZlIGJpb21vbGVjdWxlIHdoZW4gcmVzZXQgd2FzIGludm9rZWQsIHRoZXJlIHNob3VsZCBhbHNvIGJlIGEgbGlzdGVuZXIgb24gdGhlIHVzZXJcclxuICAgICAgLy8gY29udHJvbGxlZCBwcm9wZXJ0eS4gIE1ha2Ugc3VyZSB0aGF0IHRoZXJlIGlzLlxyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KFxyXG4gICAgICAgIHRoaXMuYmlvbW9sZWN1bGUudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5oYXNMaXN0ZW5lciggdGhpcy51c2VyQ29udHJvbGxlZExpc3RlbmVyICksXHJcbiAgICAgICAgJ3RoZSBjcmVhdG9yIG5vZGUgc2hvdWxkIG5ldmVyIGJlIGluIGEgc3RhdGUgd2hlcmUgaXQgaGFzIGEgYmlvbW9sZWN1bGUgd2l0aG91dCBhIHVzZXItY29udHJvbGxlZCBsaXN0ZW5lcidcclxuICAgICAgKTtcclxuXHJcbiAgICAgIHRoaXMuYmlvbW9sZWN1bGUudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS51bmxpbmsoIHRoaXMudXNlckNvbnRyb2xsZWRMaXN0ZW5lciApO1xyXG4gICAgICB0aGlzLnVzZXJDb250cm9sbGVkTGlzdGVuZXIgPSBudWxsO1xyXG4gICAgICB0aGlzLmJpb21vbGVjdWxlID0gbnVsbDtcclxuICAgIH1cclxuICAgIHRoaXMuYXBwZWFyYW5jZU5vZGUub3BhY2l0eSA9IDE7XHJcbiAgICB0aGlzLnBpY2thYmxlID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7VmVjdG9yMn0gcG9pbnRcclxuICAgKiBAcmV0dXJucyB7VmVjdG9yMn1cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGdldE1vZGVsUG9zaXRpb24oIHBvaW50ICkge1xyXG4gICAgY29uc3Qgc2NyZWVuVmlld1Bvc2l0aW9uID0gdGhpcy5zY3JlZW5WaWV3Lmdsb2JhbFRvTG9jYWxQb2ludCggcG9pbnQgKTtcclxuICAgIGNvbnN0IGFkanVzdGVkQ2FudmFzUG9zID0gc2NyZWVuVmlld1Bvc2l0aW9uLm1pbnVzKCB0aGlzLnNjcmVlblZpZXcudmlld1BvcnRPZmZzZXQgKTtcclxuICAgIHJldHVybiB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS52aWV3VG9Nb2RlbFBvc2l0aW9uKCBhZGp1c3RlZENhbnZhc1BvcyApO1xyXG4gIH1cclxufVxyXG5cclxuZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzLnJlZ2lzdGVyKCAnQmlvbW9sZWN1bGVDcmVhdG9yTm9kZScsIEJpb21vbGVjdWxlQ3JlYXRvck5vZGUgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IEJpb21vbGVjdWxlQ3JlYXRvck5vZGU7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFNBQVNBLFlBQVksRUFBRUMs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