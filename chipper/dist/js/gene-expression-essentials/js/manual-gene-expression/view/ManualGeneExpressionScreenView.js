// Copyright 2015-2022, University of Colorado Boulder

/**
 * Screen View for Manual Gene Expression screen
 * @author Sharfudeen Ashraf
 * @author John Blanco
 * @author Aadish Gupta
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import ScreenView from '../../../../joist/js/ScreenView.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { HBox, Node, Text } from '../../../../scenery/js/imports.js';
import RectangularPushButton from '../../../../sun/js/buttons/RectangularPushButton.js';
import Animation from '../../../../twixt/js/Animation.js';
import Easing from '../../../../twixt/js/Easing.js';
import DnaMoleculeNode from '../../common/view/DnaMoleculeNode.js';
import MessengerRnaNode from '../../common/view/MessengerRnaNode.js';
import MobileBiomoleculeNode from '../../common/view/MobileBiomoleculeNode.js';
import PlacementHintNode from '../../common/view/PlacementHintNode.js';
import geneExpressionEssentials from '../../geneExpressionEssentials.js';
import GeneExpressionEssentialsStrings from '../../GeneExpressionEssentialsStrings.js';
import BiomoleculeToolboxNode from './BiomoleculeToolboxNode.js';
import ProteinCollectionNode from './ProteinCollectionNode.js';

// constants
const GENE_TO_GENE_ANIMATION_TIME = 1; // in seconds
const INSET = 15; // inset for several of the controls, in view coordinates

const nextGeneString = GeneExpressionEssentialsStrings.nextGene;
const previousGeneString = GeneExpressionEssentialsStrings.previousGene;
class ManualGeneExpressionScreenView extends ScreenView {
  /**
   * @param {ManualGeneExpressionModel} model
   */
  constructor(model) {
    super({
      preventFit: true
    });
    this.viewPortOffset = new Vector2(0, 0);
    const biomoleculeToolboxNodeList = []; // array containing the toolbox nodes used to create biomolecules

    // Set up the model-view transform. The multiplier factors for the 2nd point can be adjusted to shift the center
    // right or left, and the scale factor can be adjusted to zoom in or out (smaller numbers zoom out, larger ones zoom
    // in).
    this.modelViewTransform = ModelViewTransform2.createSinglePointScaleInvertedYMapping(Vector2.ZERO, new Vector2(this.layoutBounds.width * 0.48, this.layoutBounds.height * 0.64), 0.1 // "zoom factor" - smaller zooms out, larger zooms in
    );

    // Set up the node where all controls that need to be below the biomolecules should be placed.  This node and its
    // children will stay in one place and not scroll.
    const backControlsLayer = new Node();
    this.addChild(backControlsLayer);

    // Set up the root node for all model objects. Nodes placed under this one will scroll when the user moves along the
    // DNA strand.
    this.modelRootNode = new Node();
    this.addChild(this.modelRootNode);

    // Add some layers for enforcing some z-order relationships needed in order to keep things looking good.
    const dnaLayer = new Node();
    this.modelRootNode.addChild(dnaLayer);
    const biomoleculeToolboxLayer = new Node();
    this.modelRootNode.addChild(biomoleculeToolboxLayer);
    const messengerRnaLayer = new Node();
    this.modelRootNode.addChild(messengerRnaLayer);
    const topBiomoleculeLayer = new Node();
    this.modelRootNode.addChild(topBiomoleculeLayer);
    const placementHintLayer = new Node();
    this.modelRootNode.addChild(placementHintLayer);

    // Set up the node where all controls that need to be above the biomolecules should be placed. This node and its
    // children will stay in one place and not scroll.
    const frontControlsLayer = new Node();
    this.addChild(frontControlsLayer);

    // Add the representation of the DNA strand.
    this.dnaMoleculeNode = new DnaMoleculeNode(model.getDnaMolecule(), this.modelViewTransform, 3, true);
    dnaLayer.addChild(this.dnaMoleculeNode);

    // Add the placement hints that go on the DNA molecule. These exist on their own layer so that they can be seen
    // above any molecules that are attached to the DNA strand.
    model.getDnaMolecule().getGenes().forEach(gene => {
      gene.getPlacementHints().forEach(placementHint => {
        placementHintLayer.addChild(new PlacementHintNode(this.modelViewTransform, placementHint));
      });
    });

    // Add the protein collection box.
    const proteinCollectionNode = new ProteinCollectionNode(model, this.modelViewTransform);
    proteinCollectionNode.x = this.layoutBounds.width - proteinCollectionNode.bounds.width - INSET;
    proteinCollectionNode.y = INSET;
    backControlsLayer.addChild(proteinCollectionNode);

    // Add any initial molecules.
    model.mobileBiomoleculeList.forEach(biomolecule => {
      topBiomoleculeLayer.addChild(new MobileBiomoleculeNode(this.modelViewTransform, biomolecule));
    });

    // @public (read-only) Map.<MobileBiomolecule,MobileBiomoleculeNode> - A map of the mobile biomolecules to the nodes
    // that represent each in the view.
    this.mobileBiomoleculeToNodeMap = new Map();

    // Watch for and handle comings and goings of biomolecules in the model. Most, but not all, of the biomolecules
    // are handled by this. Some others are handled as special cases, see below.
    model.mobileBiomoleculeList.addItemAddedListener(addedBiomolecule => {
      // Add a node to the view when a new mobile biomolecule is added to the model.
      const biomoleculeNode = new MobileBiomoleculeNode(this.modelViewTransform, addedBiomolecule);
      topBiomoleculeLayer.addChild(biomoleculeNode);
      this.mobileBiomoleculeToNodeMap.set(addedBiomolecule, biomoleculeNode);

      // Handle removal of the mobile biomolecule.
      const removeItemListener = removedBiomolecule => {
        if (removedBiomolecule === addedBiomolecule) {
          topBiomoleculeLayer.removeChild(biomoleculeNode);
          this.mobileBiomoleculeToNodeMap.delete(addedBiomolecule);
          model.mobileBiomoleculeList.removeItemRemovedListener(removeItemListener);
        }
      };
      model.mobileBiomoleculeList.addItemRemovedListener(removeItemListener);
    });

    // Watch for and handle comings and goings of messenger RNA.
    model.messengerRnaList.addItemAddedListener(addedMessengerRna => {
      const messengerRnaNode = new MessengerRnaNode(this.modelViewTransform, addedMessengerRna);
      messengerRnaLayer.addChild(messengerRnaNode);
      function removeItemListener(removedMessengerRna) {
        if (removedMessengerRna === addedMessengerRna) {
          messengerRnaLayer.removeChild(messengerRnaNode);
          model.messengerRnaList.removeItemRemovedListener(removeItemListener); // Clean up memory leak
        }
      }

      model.messengerRnaList.addItemRemovedListener(removeItemListener);
    });

    // Add the toolboxes from which the various biomolecules can be moved  into the active area of the sim.
    model.getDnaMolecule().getGenes().forEach(gene => {
      const biomoleculeToolboxNode = new BiomoleculeToolboxNode(model, this, this.modelViewTransform, gene);
      biomoleculeToolboxNode.x = this.modelViewTransform.modelToViewX(gene.getCenterX()) - this.layoutBounds.getWidth() / 2 + INSET;
      biomoleculeToolboxNode.y = INSET;
      biomoleculeToolboxNodeList.push(biomoleculeToolboxNode);
      biomoleculeToolboxLayer.addChild(biomoleculeToolboxNode);
      model.addOffLimitsMotionSpace(this.modelViewTransform.viewToModelBounds(biomoleculeToolboxNode.bounds));
    });

    // define a convenience function that allows quick setting of the pickability of the toolbox nodes
    function setBiomoleculeToolboxPickability(pickable) {
      biomoleculeToolboxNodeList.forEach(biomoleculeToolboxNode => {
        biomoleculeToolboxNode.pickable = pickable;
      });
    }

    // add button for moving to next gene
    const nextGeneButtonContent = new HBox({
      children: [new Text(nextGeneString, {
        font: new PhetFont({
          size: 18
        }),
        maxWidth: 120
      }), new ArrowNode(0, 0, 20, 0, {
        headHeight: 8,
        headWidth: 10,
        tailWidth: 5
      })],
      spacing: 5
    });
    const nextGeneButton = new RectangularPushButton({
      content: nextGeneButtonContent,
      listener: () => {
        model.nextGene();
      },
      baseColor: 'yellow',
      stroke: 'black',
      lineWidth: 1
    });
    nextGeneButton.x = this.layoutBounds.width - nextGeneButton.width - 20;
    nextGeneButton.y = this.modelViewTransform.modelToViewY(model.getDnaMolecule().getLeftEdgePosition().y) + 90;

    // add buttons for moving to previous gene
    const previousGeneButtonContent = new HBox({
      children: [new ArrowNode(0, 0, -20, 0, {
        headHeight: 8,
        headWidth: 10,
        tailWidth: 5
      }), new Text(previousGeneString, {
        font: new PhetFont({
          size: 18
        }),
        maxWidth: 120
      })],
      spacing: 5
    });
    const previousGeneButton = new RectangularPushButton({
      content: previousGeneButtonContent,
      listener: () => {
        model.previousGene();
      },
      baseColor: 'yellow',
      stroke: 'black',
      lineWidth: 1
    });
    previousGeneButton.x = 20;
    previousGeneButton.y = this.modelViewTransform.modelToViewY(model.getDnaMolecule().getLeftEdgePosition().y) + 90;

    // set the position of model root node based on first gene
    this.modelRootNode.x = -this.modelViewTransform.modelToViewX(model.dnaMolecule.getGenes()[0].getCenterX()) + this.layoutBounds.width / 2;

    // Monitor the active gene and move the view port to be centered on it whenever it changes.
    model.activeGeneProperty.link(gene => {
      // update the enabled state of the buttons that navigate between genes
      nextGeneButton.enabled = !(gene === model.dnaMolecule.getLastGene());
      previousGeneButton.enabled = !(gene === model.dnaMolecule.getGenes()[0]);

      // disable interaction with the toolbox node to prevent race conditions
      setBiomoleculeToolboxPickability(false);

      // set the offset of the viewport
      this.viewPortOffset.setXY(-this.modelViewTransform.modelToViewX(gene.getCenterX()) + this.layoutBounds.width / 2, 0);

      // create and run the animation that will move the view to the selected gene
      const modelRootNodeAnimator = new Animation({
        duration: GENE_TO_GENE_ANIMATION_TIME,
        easing: Easing.CUBIC_IN_OUT,
        setValue: newXPos => {
          this.modelRootNode.x = newXPos;
        },
        from: this.modelRootNode.x,
        to: this.viewPortOffset.x
      });
      modelRootNodeAnimator.finishEmitter.addListener(() => {
        this.modelRootNode.visible = true;
        this.modelRootNode.pickable = null;
        const boundsInControlNode = proteinCollectionNode.getBounds().copy();
        const boundsAfterTransform = boundsInControlNode.transform(this.modelRootNode.getTransform().getInverse());
        const boundsInModel = this.modelViewTransform.viewToModelBounds(boundsAfterTransform);
        model.setProteinCaptureArea(boundsInModel);
        model.addOffLimitsMotionSpace(boundsInModel);
        setBiomoleculeToolboxPickability(true);
      });
      modelRootNodeAnimator.start();
    });
    frontControlsLayer.addChild(nextGeneButton);
    frontControlsLayer.addChild(previousGeneButton);

    // Create and add the Reset All Button in the bottom right, which resets the model
    const resetAllButton = new ResetAllButton({
      listener: () => {
        this.interruptSubtreeInput(); // cancel user interactions
        model.reset();
        biomoleculeToolboxNodeList.forEach(biomoleculeToolboxNode => {
          biomoleculeToolboxNode.reset();
        });
      },
      right: this.layoutBounds.maxX - 10,
      bottom: this.layoutBounds.maxY - 10
    });
    frontControlsLayer.addChild(resetAllButton);
  }

  /**
   * @public
   */
  step() {
    this.dnaMoleculeNode.step();
  }
}
geneExpressionEssentials.register('ManualGeneExpressionScreenView', ManualGeneExpressionScreenView);
export default ManualGeneExpressionScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiU2NyZWVuVmlldyIsIk1vZGVsVmlld1RyYW5zZm9ybTIiLCJBcnJvd05vZGUiLCJSZXNldEFsbEJ1dHRvbiIsIlBoZXRGb250IiwiSEJveCIsIk5vZGUiLCJUZXh0IiwiUmVjdGFuZ3VsYXJQdXNoQnV0dG9uIiwiQW5pbWF0aW9uIiwiRWFzaW5nIiwiRG5hTW9sZWN1bGVOb2RlIiwiTWVzc2VuZ2VyUm5hTm9kZSIsIk1vYmlsZUJpb21vbGVjdWxlTm9kZSIsIlBsYWNlbWVudEhpbnROb2RlIiwiZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzIiwiR2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzU3RyaW5ncyIsIkJpb21vbGVjdWxlVG9vbGJveE5vZGUiLCJQcm90ZWluQ29sbGVjdGlvbk5vZGUiLCJHRU5FX1RPX0dFTkVfQU5JTUFUSU9OX1RJTUUiLCJJTlNFVCIsIm5leHRHZW5lU3RyaW5nIiwibmV4dEdlbmUiLCJwcmV2aW91c0dlbmVTdHJpbmciLCJwcmV2aW91c0dlbmUiLCJNYW51YWxHZW5lRXhwcmVzc2lvblNjcmVlblZpZXciLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwicHJldmVudEZpdCIsInZpZXdQb3J0T2Zmc2V0IiwiYmlvbW9sZWN1bGVUb29sYm94Tm9kZUxpc3QiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJjcmVhdGVTaW5nbGVQb2ludFNjYWxlSW52ZXJ0ZWRZTWFwcGluZyIsIlpFUk8iLCJsYXlvdXRCb3VuZHMiLCJ3aWR0aCIsImhlaWdodCIsImJhY2tDb250cm9sc0xheWVyIiwiYWRkQ2hpbGQiLCJtb2RlbFJvb3ROb2RlIiwiZG5hTGF5ZXIiLCJiaW9tb2xlY3VsZVRvb2xib3hMYXllciIsIm1lc3NlbmdlclJuYUxheWVyIiwidG9wQmlvbW9sZWN1bGVMYXllciIsInBsYWNlbWVudEhpbnRMYXllciIsImZyb250Q29udHJvbHNMYXllciIsImRuYU1vbGVjdWxlTm9kZSIsImdldERuYU1vbGVjdWxlIiwiZ2V0R2VuZXMiLCJmb3JFYWNoIiwiZ2VuZSIsImdldFBsYWNlbWVudEhpbnRzIiwicGxhY2VtZW50SGludCIsInByb3RlaW5Db2xsZWN0aW9uTm9kZSIsIngiLCJib3VuZHMiLCJ5IiwibW9iaWxlQmlvbW9sZWN1bGVMaXN0IiwiYmlvbW9sZWN1bGUiLCJtb2JpbGVCaW9tb2xlY3VsZVRvTm9kZU1hcCIsIk1hcCIsImFkZEl0ZW1BZGRlZExpc3RlbmVyIiwiYWRkZWRCaW9tb2xlY3VsZSIsImJpb21vbGVjdWxlTm9kZSIsInNldCIsInJlbW92ZUl0ZW1MaXN0ZW5lciIsInJlbW92ZWRCaW9tb2xlY3VsZSIsInJlbW92ZUNoaWxkIiwiZGVsZXRlIiwicmVtb3ZlSXRlbVJlbW92ZWRMaXN0ZW5lciIsImFkZEl0ZW1SZW1vdmVkTGlzdGVuZXIiLCJtZXNzZW5nZXJSbmFMaXN0IiwiYWRkZWRNZXNzZW5nZXJSbmEiLCJtZXNzZW5nZXJSbmFOb2RlIiwicmVtb3ZlZE1lc3NlbmdlclJuYSIsImJpb21vbGVjdWxlVG9vbGJveE5vZGUiLCJtb2RlbFRvVmlld1giLCJnZXRDZW50ZXJYIiwiZ2V0V2lkdGgiLCJwdXNoIiwiYWRkT2ZmTGltaXRzTW90aW9uU3BhY2UiLCJ2aWV3VG9Nb2RlbEJvdW5kcyIsInNldEJpb21vbGVjdWxlVG9vbGJveFBpY2thYmlsaXR5IiwicGlja2FibGUiLCJuZXh0R2VuZUJ1dHRvbkNvbnRlbnQiLCJjaGlsZHJlbiIsImZvbnQiLCJzaXplIiwibWF4V2lkdGgiLCJoZWFkSGVpZ2h0IiwiaGVhZFdpZHRoIiwidGFpbFdpZHRoIiwic3BhY2luZyIsIm5leHRHZW5lQnV0dG9uIiwiY29udGVudCIsImxpc3RlbmVyIiwiYmFzZUNvbG9yIiwic3Ryb2tlIiwibGluZVdpZHRoIiwibW9kZWxUb1ZpZXdZIiwiZ2V0TGVmdEVkZ2VQb3NpdGlvbiIsInByZXZpb3VzR2VuZUJ1dHRvbkNvbnRlbnQiLCJwcmV2aW91c0dlbmVCdXR0b24iLCJkbmFNb2xlY3VsZSIsImFjdGl2ZUdlbmVQcm9wZXJ0eSIsImxpbmsiLCJlbmFibGVkIiwiZ2V0TGFzdEdlbmUiLCJzZXRYWSIsIm1vZGVsUm9vdE5vZGVBbmltYXRvciIsImR1cmF0aW9uIiwiZWFzaW5nIiwiQ1VCSUNfSU5fT1VUIiwic2V0VmFsdWUiLCJuZXdYUG9zIiwiZnJvbSIsInRvIiwiZmluaXNoRW1pdHRlciIsImFkZExpc3RlbmVyIiwidmlzaWJsZSIsImJvdW5kc0luQ29udHJvbE5vZGUiLCJnZXRCb3VuZHMiLCJjb3B5IiwiYm91bmRzQWZ0ZXJUcmFuc2Zvcm0iLCJ0cmFuc2Zvcm0iLCJnZXRUcmFuc2Zvcm0iLCJnZXRJbnZlcnNlIiwiYm91bmRzSW5Nb2RlbCIsInNldFByb3RlaW5DYXB0dXJlQXJlYSIsInN0YXJ0IiwicmVzZXRBbGxCdXR0b24iLCJpbnRlcnJ1cHRTdWJ0cmVlSW5wdXQiLCJyZXNldCIsInJpZ2h0IiwibWF4WCIsImJvdHRvbSIsIm1heFkiLCJzdGVwIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJNYW51YWxHZW5lRXhwcmVzc2lvblNjcmVlblZpZXcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTUtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2NyZWVuIFZpZXcgZm9yIE1hbnVhbCBHZW5lIEV4cHJlc3Npb24gc2NyZWVuXHJcbiAqIEBhdXRob3IgU2hhcmZ1ZGVlbiBBc2hyYWZcclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKiBAYXV0aG9yIEFhZGlzaCBHdXB0YVxyXG4gKi9cclxuXHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IFNjcmVlblZpZXcgZnJvbSAnLi4vLi4vLi4vLi4vam9pc3QvanMvU2NyZWVuVmlldy5qcyc7XHJcbmltcG9ydCBNb2RlbFZpZXdUcmFuc2Zvcm0yIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdmlldy9Nb2RlbFZpZXdUcmFuc2Zvcm0yLmpzJztcclxuaW1wb3J0IEFycm93Tm9kZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvQXJyb3dOb2RlLmpzJztcclxuaW1wb3J0IFJlc2V0QWxsQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL1Jlc2V0QWxsQnV0dG9uLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IEhCb3gsIE5vZGUsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUmVjdGFuZ3VsYXJQdXNoQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9idXR0b25zL1JlY3Rhbmd1bGFyUHVzaEJ1dHRvbi5qcyc7XHJcbmltcG9ydCBBbmltYXRpb24gZnJvbSAnLi4vLi4vLi4vLi4vdHdpeHQvanMvQW5pbWF0aW9uLmpzJztcclxuaW1wb3J0IEVhc2luZyBmcm9tICcuLi8uLi8uLi8uLi90d2l4dC9qcy9FYXNpbmcuanMnO1xyXG5pbXBvcnQgRG5hTW9sZWN1bGVOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0RuYU1vbGVjdWxlTm9kZS5qcyc7XHJcbmltcG9ydCBNZXNzZW5nZXJSbmFOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L01lc3NlbmdlclJuYU5vZGUuanMnO1xyXG5pbXBvcnQgTW9iaWxlQmlvbW9sZWN1bGVOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L01vYmlsZUJpb21vbGVjdWxlTm9kZS5qcyc7XHJcbmltcG9ydCBQbGFjZW1lbnRIaW50Tm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9QbGFjZW1lbnRIaW50Tm9kZS5qcyc7XHJcbmltcG9ydCBnZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMgZnJvbSAnLi4vLi4vZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzLmpzJztcclxuaW1wb3J0IEdlbmVFeHByZXNzaW9uRXNzZW50aWFsc1N0cmluZ3MgZnJvbSAnLi4vLi4vR2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBCaW9tb2xlY3VsZVRvb2xib3hOb2RlIGZyb20gJy4vQmlvbW9sZWN1bGVUb29sYm94Tm9kZS5qcyc7XHJcbmltcG9ydCBQcm90ZWluQ29sbGVjdGlvbk5vZGUgZnJvbSAnLi9Qcm90ZWluQ29sbGVjdGlvbk5vZGUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IEdFTkVfVE9fR0VORV9BTklNQVRJT05fVElNRSA9IDE7IC8vIGluIHNlY29uZHNcclxuY29uc3QgSU5TRVQgPSAxNTsgLy8gaW5zZXQgZm9yIHNldmVyYWwgb2YgdGhlIGNvbnRyb2xzLCBpbiB2aWV3IGNvb3JkaW5hdGVzXHJcblxyXG5jb25zdCBuZXh0R2VuZVN0cmluZyA9IEdlbmVFeHByZXNzaW9uRXNzZW50aWFsc1N0cmluZ3MubmV4dEdlbmU7XHJcbmNvbnN0IHByZXZpb3VzR2VuZVN0cmluZyA9IEdlbmVFeHByZXNzaW9uRXNzZW50aWFsc1N0cmluZ3MucHJldmlvdXNHZW5lO1xyXG5cclxuY2xhc3MgTWFudWFsR2VuZUV4cHJlc3Npb25TY3JlZW5WaWV3IGV4dGVuZHMgU2NyZWVuVmlldyB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7TWFudWFsR2VuZUV4cHJlc3Npb25Nb2RlbH0gbW9kZWxcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbW9kZWwgKSB7XHJcblxyXG4gICAgc3VwZXIoIHsgcHJldmVudEZpdDogdHJ1ZSB9ICk7XHJcbiAgICB0aGlzLnZpZXdQb3J0T2Zmc2V0ID0gbmV3IFZlY3RvcjIoIDAsIDAgKTtcclxuICAgIGNvbnN0IGJpb21vbGVjdWxlVG9vbGJveE5vZGVMaXN0ID0gW107IC8vIGFycmF5IGNvbnRhaW5pbmcgdGhlIHRvb2xib3ggbm9kZXMgdXNlZCB0byBjcmVhdGUgYmlvbW9sZWN1bGVzXHJcblxyXG4gICAgLy8gU2V0IHVwIHRoZSBtb2RlbC12aWV3IHRyYW5zZm9ybS4gVGhlIG11bHRpcGxpZXIgZmFjdG9ycyBmb3IgdGhlIDJuZCBwb2ludCBjYW4gYmUgYWRqdXN0ZWQgdG8gc2hpZnQgdGhlIGNlbnRlclxyXG4gICAgLy8gcmlnaHQgb3IgbGVmdCwgYW5kIHRoZSBzY2FsZSBmYWN0b3IgY2FuIGJlIGFkanVzdGVkIHRvIHpvb20gaW4gb3Igb3V0IChzbWFsbGVyIG51bWJlcnMgem9vbSBvdXQsIGxhcmdlciBvbmVzIHpvb21cclxuICAgIC8vIGluKS5cclxuICAgIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtID0gTW9kZWxWaWV3VHJhbnNmb3JtMi5jcmVhdGVTaW5nbGVQb2ludFNjYWxlSW52ZXJ0ZWRZTWFwcGluZyhcclxuICAgICAgVmVjdG9yMi5aRVJPLFxyXG4gICAgICBuZXcgVmVjdG9yMiggdGhpcy5sYXlvdXRCb3VuZHMud2lkdGggKiAwLjQ4LCB0aGlzLmxheW91dEJvdW5kcy5oZWlnaHQgKiAwLjY0ICksXHJcbiAgICAgIDAuMSAvLyBcInpvb20gZmFjdG9yXCIgLSBzbWFsbGVyIHpvb21zIG91dCwgbGFyZ2VyIHpvb21zIGluXHJcbiAgICApO1xyXG5cclxuICAgIC8vIFNldCB1cCB0aGUgbm9kZSB3aGVyZSBhbGwgY29udHJvbHMgdGhhdCBuZWVkIHRvIGJlIGJlbG93IHRoZSBiaW9tb2xlY3VsZXMgc2hvdWxkIGJlIHBsYWNlZC4gIFRoaXMgbm9kZSBhbmQgaXRzXHJcbiAgICAvLyBjaGlsZHJlbiB3aWxsIHN0YXkgaW4gb25lIHBsYWNlIGFuZCBub3Qgc2Nyb2xsLlxyXG4gICAgY29uc3QgYmFja0NvbnRyb2xzTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggYmFja0NvbnRyb2xzTGF5ZXIgKTtcclxuXHJcbiAgICAvLyBTZXQgdXAgdGhlIHJvb3Qgbm9kZSBmb3IgYWxsIG1vZGVsIG9iamVjdHMuIE5vZGVzIHBsYWNlZCB1bmRlciB0aGlzIG9uZSB3aWxsIHNjcm9sbCB3aGVuIHRoZSB1c2VyIG1vdmVzIGFsb25nIHRoZVxyXG4gICAgLy8gRE5BIHN0cmFuZC5cclxuICAgIHRoaXMubW9kZWxSb290Tm9kZSA9IG5ldyBOb2RlKCk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLm1vZGVsUm9vdE5vZGUgKTtcclxuXHJcbiAgICAvLyBBZGQgc29tZSBsYXllcnMgZm9yIGVuZm9yY2luZyBzb21lIHotb3JkZXIgcmVsYXRpb25zaGlwcyBuZWVkZWQgaW4gb3JkZXIgdG8ga2VlcCB0aGluZ3MgbG9va2luZyBnb29kLlxyXG4gICAgY29uc3QgZG5hTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5tb2RlbFJvb3ROb2RlLmFkZENoaWxkKCBkbmFMYXllciApO1xyXG4gICAgY29uc3QgYmlvbW9sZWN1bGVUb29sYm94TGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5tb2RlbFJvb3ROb2RlLmFkZENoaWxkKCBiaW9tb2xlY3VsZVRvb2xib3hMYXllciApO1xyXG4gICAgY29uc3QgbWVzc2VuZ2VyUm5hTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5tb2RlbFJvb3ROb2RlLmFkZENoaWxkKCBtZXNzZW5nZXJSbmFMYXllciApO1xyXG4gICAgY29uc3QgdG9wQmlvbW9sZWN1bGVMYXllciA9IG5ldyBOb2RlKCk7XHJcbiAgICB0aGlzLm1vZGVsUm9vdE5vZGUuYWRkQ2hpbGQoIHRvcEJpb21vbGVjdWxlTGF5ZXIgKTtcclxuICAgIGNvbnN0IHBsYWNlbWVudEhpbnRMYXllciA9IG5ldyBOb2RlKCk7XHJcbiAgICB0aGlzLm1vZGVsUm9vdE5vZGUuYWRkQ2hpbGQoIHBsYWNlbWVudEhpbnRMYXllciApO1xyXG5cclxuICAgIC8vIFNldCB1cCB0aGUgbm9kZSB3aGVyZSBhbGwgY29udHJvbHMgdGhhdCBuZWVkIHRvIGJlIGFib3ZlIHRoZSBiaW9tb2xlY3VsZXMgc2hvdWxkIGJlIHBsYWNlZC4gVGhpcyBub2RlIGFuZCBpdHNcclxuICAgIC8vIGNoaWxkcmVuIHdpbGwgc3RheSBpbiBvbmUgcGxhY2UgYW5kIG5vdCBzY3JvbGwuXHJcbiAgICBjb25zdCBmcm9udENvbnRyb2xzTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggZnJvbnRDb250cm9sc0xheWVyICk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgRE5BIHN0cmFuZC5cclxuICAgIHRoaXMuZG5hTW9sZWN1bGVOb2RlID0gbmV3IERuYU1vbGVjdWxlTm9kZSggbW9kZWwuZ2V0RG5hTW9sZWN1bGUoKSwgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0sIDMsIHRydWUgKTtcclxuICAgIGRuYUxheWVyLmFkZENoaWxkKCB0aGlzLmRuYU1vbGVjdWxlTm9kZSApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgcGxhY2VtZW50IGhpbnRzIHRoYXQgZ28gb24gdGhlIEROQSBtb2xlY3VsZS4gVGhlc2UgZXhpc3Qgb24gdGhlaXIgb3duIGxheWVyIHNvIHRoYXQgdGhleSBjYW4gYmUgc2VlblxyXG4gICAgLy8gYWJvdmUgYW55IG1vbGVjdWxlcyB0aGF0IGFyZSBhdHRhY2hlZCB0byB0aGUgRE5BIHN0cmFuZC5cclxuICAgIG1vZGVsLmdldERuYU1vbGVjdWxlKCkuZ2V0R2VuZXMoKS5mb3JFYWNoKCBnZW5lID0+IHtcclxuICAgICAgZ2VuZS5nZXRQbGFjZW1lbnRIaW50cygpLmZvckVhY2goIHBsYWNlbWVudEhpbnQgPT4ge1xyXG4gICAgICAgIHBsYWNlbWVudEhpbnRMYXllci5hZGRDaGlsZCggbmV3IFBsYWNlbWVudEhpbnROb2RlKCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSwgcGxhY2VtZW50SGludCApICk7XHJcbiAgICAgIH0gKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIHByb3RlaW4gY29sbGVjdGlvbiBib3guXHJcbiAgICBjb25zdCBwcm90ZWluQ29sbGVjdGlvbk5vZGUgPSBuZXcgUHJvdGVpbkNvbGxlY3Rpb25Ob2RlKCBtb2RlbCwgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0gKTtcclxuICAgIHByb3RlaW5Db2xsZWN0aW9uTm9kZS54ID0gdGhpcy5sYXlvdXRCb3VuZHMud2lkdGggLSBwcm90ZWluQ29sbGVjdGlvbk5vZGUuYm91bmRzLndpZHRoIC0gSU5TRVQ7XHJcbiAgICBwcm90ZWluQ29sbGVjdGlvbk5vZGUueSA9IElOU0VUO1xyXG4gICAgYmFja0NvbnRyb2xzTGF5ZXIuYWRkQ2hpbGQoIHByb3RlaW5Db2xsZWN0aW9uTm9kZSApO1xyXG5cclxuICAgIC8vIEFkZCBhbnkgaW5pdGlhbCBtb2xlY3VsZXMuXHJcbiAgICBtb2RlbC5tb2JpbGVCaW9tb2xlY3VsZUxpc3QuZm9yRWFjaCggYmlvbW9sZWN1bGUgPT4ge1xyXG4gICAgICB0b3BCaW9tb2xlY3VsZUxheWVyLmFkZENoaWxkKCBuZXcgTW9iaWxlQmlvbW9sZWN1bGVOb2RlKCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSwgYmlvbW9sZWN1bGUgKSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMgKHJlYWQtb25seSkgTWFwLjxNb2JpbGVCaW9tb2xlY3VsZSxNb2JpbGVCaW9tb2xlY3VsZU5vZGU+IC0gQSBtYXAgb2YgdGhlIG1vYmlsZSBiaW9tb2xlY3VsZXMgdG8gdGhlIG5vZGVzXHJcbiAgICAvLyB0aGF0IHJlcHJlc2VudCBlYWNoIGluIHRoZSB2aWV3LlxyXG4gICAgdGhpcy5tb2JpbGVCaW9tb2xlY3VsZVRvTm9kZU1hcCA9IG5ldyBNYXAoKTtcclxuXHJcbiAgICAvLyBXYXRjaCBmb3IgYW5kIGhhbmRsZSBjb21pbmdzIGFuZCBnb2luZ3Mgb2YgYmlvbW9sZWN1bGVzIGluIHRoZSBtb2RlbC4gTW9zdCwgYnV0IG5vdCBhbGwsIG9mIHRoZSBiaW9tb2xlY3VsZXNcclxuICAgIC8vIGFyZSBoYW5kbGVkIGJ5IHRoaXMuIFNvbWUgb3RoZXJzIGFyZSBoYW5kbGVkIGFzIHNwZWNpYWwgY2FzZXMsIHNlZSBiZWxvdy5cclxuICAgIG1vZGVsLm1vYmlsZUJpb21vbGVjdWxlTGlzdC5hZGRJdGVtQWRkZWRMaXN0ZW5lciggYWRkZWRCaW9tb2xlY3VsZSA9PiB7XHJcblxyXG4gICAgICAvLyBBZGQgYSBub2RlIHRvIHRoZSB2aWV3IHdoZW4gYSBuZXcgbW9iaWxlIGJpb21vbGVjdWxlIGlzIGFkZGVkIHRvIHRoZSBtb2RlbC5cclxuICAgICAgY29uc3QgYmlvbW9sZWN1bGVOb2RlID0gbmV3IE1vYmlsZUJpb21vbGVjdWxlTm9kZSggdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0sIGFkZGVkQmlvbW9sZWN1bGUgKTtcclxuICAgICAgdG9wQmlvbW9sZWN1bGVMYXllci5hZGRDaGlsZCggYmlvbW9sZWN1bGVOb2RlICk7XHJcbiAgICAgIHRoaXMubW9iaWxlQmlvbW9sZWN1bGVUb05vZGVNYXAuc2V0KCBhZGRlZEJpb21vbGVjdWxlLCBiaW9tb2xlY3VsZU5vZGUgKTtcclxuXHJcbiAgICAgIC8vIEhhbmRsZSByZW1vdmFsIG9mIHRoZSBtb2JpbGUgYmlvbW9sZWN1bGUuXHJcbiAgICAgIGNvbnN0IHJlbW92ZUl0ZW1MaXN0ZW5lciA9IHJlbW92ZWRCaW9tb2xlY3VsZSA9PiB7XHJcbiAgICAgICAgaWYgKCByZW1vdmVkQmlvbW9sZWN1bGUgPT09IGFkZGVkQmlvbW9sZWN1bGUgKSB7XHJcbiAgICAgICAgICB0b3BCaW9tb2xlY3VsZUxheWVyLnJlbW92ZUNoaWxkKCBiaW9tb2xlY3VsZU5vZGUgKTtcclxuICAgICAgICAgIHRoaXMubW9iaWxlQmlvbW9sZWN1bGVUb05vZGVNYXAuZGVsZXRlKCBhZGRlZEJpb21vbGVjdWxlICk7XHJcbiAgICAgICAgICBtb2RlbC5tb2JpbGVCaW9tb2xlY3VsZUxpc3QucmVtb3ZlSXRlbVJlbW92ZWRMaXN0ZW5lciggcmVtb3ZlSXRlbUxpc3RlbmVyICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBtb2RlbC5tb2JpbGVCaW9tb2xlY3VsZUxpc3QuYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciggcmVtb3ZlSXRlbUxpc3RlbmVyICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gV2F0Y2ggZm9yIGFuZCBoYW5kbGUgY29taW5ncyBhbmQgZ29pbmdzIG9mIG1lc3NlbmdlciBSTkEuXHJcbiAgICBtb2RlbC5tZXNzZW5nZXJSbmFMaXN0LmFkZEl0ZW1BZGRlZExpc3RlbmVyKCBhZGRlZE1lc3NlbmdlclJuYSA9PiB7XHJcblxyXG4gICAgICBjb25zdCBtZXNzZW5nZXJSbmFOb2RlID0gbmV3IE1lc3NlbmdlclJuYU5vZGUoIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLCBhZGRlZE1lc3NlbmdlclJuYSApO1xyXG4gICAgICBtZXNzZW5nZXJSbmFMYXllci5hZGRDaGlsZCggbWVzc2VuZ2VyUm5hTm9kZSApO1xyXG5cclxuICAgICAgZnVuY3Rpb24gcmVtb3ZlSXRlbUxpc3RlbmVyKCByZW1vdmVkTWVzc2VuZ2VyUm5hICkge1xyXG4gICAgICAgIGlmICggcmVtb3ZlZE1lc3NlbmdlclJuYSA9PT0gYWRkZWRNZXNzZW5nZXJSbmEgKSB7XHJcbiAgICAgICAgICBtZXNzZW5nZXJSbmFMYXllci5yZW1vdmVDaGlsZCggbWVzc2VuZ2VyUm5hTm9kZSApO1xyXG4gICAgICAgICAgbW9kZWwubWVzc2VuZ2VyUm5hTGlzdC5yZW1vdmVJdGVtUmVtb3ZlZExpc3RlbmVyKCByZW1vdmVJdGVtTGlzdGVuZXIgKTsvLyBDbGVhbiB1cCBtZW1vcnkgbGVha1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgbW9kZWwubWVzc2VuZ2VyUm5hTGlzdC5hZGRJdGVtUmVtb3ZlZExpc3RlbmVyKCByZW1vdmVJdGVtTGlzdGVuZXIgKTtcclxuXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSB0b29sYm94ZXMgZnJvbSB3aGljaCB0aGUgdmFyaW91cyBiaW9tb2xlY3VsZXMgY2FuIGJlIG1vdmVkICBpbnRvIHRoZSBhY3RpdmUgYXJlYSBvZiB0aGUgc2ltLlxyXG4gICAgbW9kZWwuZ2V0RG5hTW9sZWN1bGUoKS5nZXRHZW5lcygpLmZvckVhY2goIGdlbmUgPT4ge1xyXG4gICAgICBjb25zdCBiaW9tb2xlY3VsZVRvb2xib3hOb2RlID0gbmV3IEJpb21vbGVjdWxlVG9vbGJveE5vZGUoIG1vZGVsLCB0aGlzLCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSwgZ2VuZSApO1xyXG4gICAgICBiaW9tb2xlY3VsZVRvb2xib3hOb2RlLnggPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIGdlbmUuZ2V0Q2VudGVyWCgpICkgLSB0aGlzLmxheW91dEJvdW5kcy5nZXRXaWR0aCgpIC8gMiArIElOU0VUO1xyXG4gICAgICBiaW9tb2xlY3VsZVRvb2xib3hOb2RlLnkgPSBJTlNFVDtcclxuICAgICAgYmlvbW9sZWN1bGVUb29sYm94Tm9kZUxpc3QucHVzaCggYmlvbW9sZWN1bGVUb29sYm94Tm9kZSApO1xyXG4gICAgICBiaW9tb2xlY3VsZVRvb2xib3hMYXllci5hZGRDaGlsZCggYmlvbW9sZWN1bGVUb29sYm94Tm9kZSApO1xyXG4gICAgICBtb2RlbC5hZGRPZmZMaW1pdHNNb3Rpb25TcGFjZSggdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0udmlld1RvTW9kZWxCb3VuZHMoIGJpb21vbGVjdWxlVG9vbGJveE5vZGUuYm91bmRzICkgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBkZWZpbmUgYSBjb252ZW5pZW5jZSBmdW5jdGlvbiB0aGF0IGFsbG93cyBxdWljayBzZXR0aW5nIG9mIHRoZSBwaWNrYWJpbGl0eSBvZiB0aGUgdG9vbGJveCBub2Rlc1xyXG4gICAgZnVuY3Rpb24gc2V0QmlvbW9sZWN1bGVUb29sYm94UGlja2FiaWxpdHkoIHBpY2thYmxlICkge1xyXG4gICAgICBiaW9tb2xlY3VsZVRvb2xib3hOb2RlTGlzdC5mb3JFYWNoKCBiaW9tb2xlY3VsZVRvb2xib3hOb2RlID0+IHtcclxuICAgICAgICBiaW9tb2xlY3VsZVRvb2xib3hOb2RlLnBpY2thYmxlID0gcGlja2FibGU7XHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBhZGQgYnV0dG9uIGZvciBtb3ZpbmcgdG8gbmV4dCBnZW5lXHJcbiAgICBjb25zdCBuZXh0R2VuZUJ1dHRvbkNvbnRlbnQgPSBuZXcgSEJveCgge1xyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIG5ldyBUZXh0KCBuZXh0R2VuZVN0cmluZywge1xyXG4gICAgICAgICAgZm9udDogbmV3IFBoZXRGb250KCB7IHNpemU6IDE4IH0gKSxcclxuICAgICAgICAgIG1heFdpZHRoOiAxMjBcclxuICAgICAgICB9ICksXHJcbiAgICAgICAgbmV3IEFycm93Tm9kZSggMCwgMCwgMjAsIDAsIHtcclxuICAgICAgICAgIGhlYWRIZWlnaHQ6IDgsXHJcbiAgICAgICAgICBoZWFkV2lkdGg6IDEwLFxyXG4gICAgICAgICAgdGFpbFdpZHRoOiA1XHJcbiAgICAgICAgfSApXHJcbiAgICAgIF0sXHJcbiAgICAgIHNwYWNpbmc6IDVcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IG5leHRHZW5lQnV0dG9uID0gbmV3IFJlY3Rhbmd1bGFyUHVzaEJ1dHRvbigge1xyXG4gICAgICBjb250ZW50OiBuZXh0R2VuZUJ1dHRvbkNvbnRlbnQsXHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgbW9kZWwubmV4dEdlbmUoKTtcclxuICAgICAgfSxcclxuICAgICAgYmFzZUNvbG9yOiAneWVsbG93JyxcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBsaW5lV2lkdGg6IDFcclxuICAgIH0gKTtcclxuXHJcbiAgICBuZXh0R2VuZUJ1dHRvbi54ID0gdGhpcy5sYXlvdXRCb3VuZHMud2lkdGggLSBuZXh0R2VuZUJ1dHRvbi53aWR0aCAtIDIwO1xyXG4gICAgbmV4dEdlbmVCdXR0b24ueSA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggbW9kZWwuZ2V0RG5hTW9sZWN1bGUoKS5nZXRMZWZ0RWRnZVBvc2l0aW9uKCkueSApICsgOTA7XHJcblxyXG4gICAgLy8gYWRkIGJ1dHRvbnMgZm9yIG1vdmluZyB0byBwcmV2aW91cyBnZW5lXHJcbiAgICBjb25zdCBwcmV2aW91c0dlbmVCdXR0b25Db250ZW50ID0gbmV3IEhCb3goIHtcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBuZXcgQXJyb3dOb2RlKCAwLCAwLCAtMjAsIDAsIHtcclxuICAgICAgICAgIGhlYWRIZWlnaHQ6IDgsXHJcbiAgICAgICAgICBoZWFkV2lkdGg6IDEwLFxyXG4gICAgICAgICAgdGFpbFdpZHRoOiA1XHJcbiAgICAgICAgfSApLFxyXG4gICAgICAgIG5ldyBUZXh0KCBwcmV2aW91c0dlbmVTdHJpbmcsIHtcclxuICAgICAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggeyBzaXplOiAxOCB9ICksXHJcbiAgICAgICAgICBtYXhXaWR0aDogMTIwXHJcbiAgICAgICAgfSApXHJcbiAgICAgIF0sXHJcbiAgICAgIHNwYWNpbmc6IDVcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IHByZXZpb3VzR2VuZUJ1dHRvbiA9IG5ldyBSZWN0YW5ndWxhclB1c2hCdXR0b24oIHtcclxuICAgICAgY29udGVudDogcHJldmlvdXNHZW5lQnV0dG9uQ29udGVudCxcclxuICAgICAgbGlzdGVuZXI6ICgpID0+IHtcclxuICAgICAgICBtb2RlbC5wcmV2aW91c0dlbmUoKTtcclxuICAgICAgfSxcclxuICAgICAgYmFzZUNvbG9yOiAneWVsbG93JyxcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBsaW5lV2lkdGg6IDFcclxuICAgIH0gKTtcclxuXHJcbiAgICBwcmV2aW91c0dlbmVCdXR0b24ueCA9IDIwO1xyXG4gICAgcHJldmlvdXNHZW5lQnV0dG9uLnkgPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1koIG1vZGVsLmdldERuYU1vbGVjdWxlKCkuZ2V0TGVmdEVkZ2VQb3NpdGlvbigpLnkgKSArIDkwO1xyXG5cclxuICAgIC8vIHNldCB0aGUgcG9zaXRpb24gb2YgbW9kZWwgcm9vdCBub2RlIGJhc2VkIG9uIGZpcnN0IGdlbmVcclxuICAgIHRoaXMubW9kZWxSb290Tm9kZS54ID0gLXRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WCggbW9kZWwuZG5hTW9sZWN1bGUuZ2V0R2VuZXMoKVsgMCBdLmdldENlbnRlclgoKSApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICsgdGhpcy5sYXlvdXRCb3VuZHMud2lkdGggLyAyO1xyXG5cclxuICAgIC8vIE1vbml0b3IgdGhlIGFjdGl2ZSBnZW5lIGFuZCBtb3ZlIHRoZSB2aWV3IHBvcnQgdG8gYmUgY2VudGVyZWQgb24gaXQgd2hlbmV2ZXIgaXQgY2hhbmdlcy5cclxuICAgIG1vZGVsLmFjdGl2ZUdlbmVQcm9wZXJ0eS5saW5rKCBnZW5lID0+IHtcclxuXHJcbiAgICAgIC8vIHVwZGF0ZSB0aGUgZW5hYmxlZCBzdGF0ZSBvZiB0aGUgYnV0dG9ucyB0aGF0IG5hdmlnYXRlIGJldHdlZW4gZ2VuZXNcclxuICAgICAgbmV4dEdlbmVCdXR0b24uZW5hYmxlZCA9ICEoIGdlbmUgPT09IG1vZGVsLmRuYU1vbGVjdWxlLmdldExhc3RHZW5lKCkgKTtcclxuICAgICAgcHJldmlvdXNHZW5lQnV0dG9uLmVuYWJsZWQgPSAhKCBnZW5lID09PSBtb2RlbC5kbmFNb2xlY3VsZS5nZXRHZW5lcygpWyAwIF0gKTtcclxuXHJcbiAgICAgIC8vIGRpc2FibGUgaW50ZXJhY3Rpb24gd2l0aCB0aGUgdG9vbGJveCBub2RlIHRvIHByZXZlbnQgcmFjZSBjb25kaXRpb25zXHJcbiAgICAgIHNldEJpb21vbGVjdWxlVG9vbGJveFBpY2thYmlsaXR5KCBmYWxzZSApO1xyXG5cclxuICAgICAgLy8gc2V0IHRoZSBvZmZzZXQgb2YgdGhlIHZpZXdwb3J0XHJcbiAgICAgIHRoaXMudmlld1BvcnRPZmZzZXQuc2V0WFkoIC10aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIGdlbmUuZ2V0Q2VudGVyWCgpICkgKyB0aGlzLmxheW91dEJvdW5kcy53aWR0aCAvIDIsIDAgKTtcclxuXHJcbiAgICAgIC8vIGNyZWF0ZSBhbmQgcnVuIHRoZSBhbmltYXRpb24gdGhhdCB3aWxsIG1vdmUgdGhlIHZpZXcgdG8gdGhlIHNlbGVjdGVkIGdlbmVcclxuICAgICAgY29uc3QgbW9kZWxSb290Tm9kZUFuaW1hdG9yID0gbmV3IEFuaW1hdGlvbigge1xyXG4gICAgICAgIGR1cmF0aW9uOiBHRU5FX1RPX0dFTkVfQU5JTUFUSU9OX1RJTUUsXHJcbiAgICAgICAgZWFzaW5nOiBFYXNpbmcuQ1VCSUNfSU5fT1VULFxyXG4gICAgICAgIHNldFZhbHVlOiBuZXdYUG9zID0+IHtcclxuICAgICAgICAgIHRoaXMubW9kZWxSb290Tm9kZS54ID0gbmV3WFBvcztcclxuICAgICAgICB9LFxyXG4gICAgICAgIGZyb206IHRoaXMubW9kZWxSb290Tm9kZS54LFxyXG4gICAgICAgIHRvOiB0aGlzLnZpZXdQb3J0T2Zmc2V0LnhcclxuICAgICAgfSApO1xyXG4gICAgICBtb2RlbFJvb3ROb2RlQW5pbWF0b3IuZmluaXNoRW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICAgIHRoaXMubW9kZWxSb290Tm9kZS52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLm1vZGVsUm9vdE5vZGUucGlja2FibGUgPSBudWxsO1xyXG4gICAgICAgIGNvbnN0IGJvdW5kc0luQ29udHJvbE5vZGUgPSBwcm90ZWluQ29sbGVjdGlvbk5vZGUuZ2V0Qm91bmRzKCkuY29weSgpO1xyXG4gICAgICAgIGNvbnN0IGJvdW5kc0FmdGVyVHJhbnNmb3JtID0gYm91bmRzSW5Db250cm9sTm9kZS50cmFuc2Zvcm0oIHRoaXMubW9kZWxSb290Tm9kZS5nZXRUcmFuc2Zvcm0oKS5nZXRJbnZlcnNlKCkgKTtcclxuICAgICAgICBjb25zdCBib3VuZHNJbk1vZGVsID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0udmlld1RvTW9kZWxCb3VuZHMoIGJvdW5kc0FmdGVyVHJhbnNmb3JtICk7XHJcbiAgICAgICAgbW9kZWwuc2V0UHJvdGVpbkNhcHR1cmVBcmVhKCBib3VuZHNJbk1vZGVsICk7XHJcbiAgICAgICAgbW9kZWwuYWRkT2ZmTGltaXRzTW90aW9uU3BhY2UoIGJvdW5kc0luTW9kZWwgKTtcclxuICAgICAgICBzZXRCaW9tb2xlY3VsZVRvb2xib3hQaWNrYWJpbGl0eSggdHJ1ZSApO1xyXG4gICAgICB9ICk7XHJcbiAgICAgIG1vZGVsUm9vdE5vZGVBbmltYXRvci5zdGFydCgpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGZyb250Q29udHJvbHNMYXllci5hZGRDaGlsZCggbmV4dEdlbmVCdXR0b24gKTtcclxuICAgIGZyb250Q29udHJvbHNMYXllci5hZGRDaGlsZCggcHJldmlvdXNHZW5lQnV0dG9uICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGFuZCBhZGQgdGhlIFJlc2V0IEFsbCBCdXR0b24gaW4gdGhlIGJvdHRvbSByaWdodCwgd2hpY2ggcmVzZXRzIHRoZSBtb2RlbFxyXG4gICAgY29uc3QgcmVzZXRBbGxCdXR0b24gPSBuZXcgUmVzZXRBbGxCdXR0b24oIHtcclxuICAgICAgbGlzdGVuZXI6ICgpID0+IHtcclxuICAgICAgICB0aGlzLmludGVycnVwdFN1YnRyZWVJbnB1dCgpOyAvLyBjYW5jZWwgdXNlciBpbnRlcmFjdGlvbnNcclxuICAgICAgICBtb2RlbC5yZXNldCgpO1xyXG4gICAgICAgIGJpb21vbGVjdWxlVG9vbGJveE5vZGVMaXN0LmZvckVhY2goIGJpb21vbGVjdWxlVG9vbGJveE5vZGUgPT4ge1xyXG4gICAgICAgICAgYmlvbW9sZWN1bGVUb29sYm94Tm9kZS5yZXNldCgpO1xyXG4gICAgICAgIH0gKTtcclxuICAgICAgfSxcclxuICAgICAgcmlnaHQ6IHRoaXMubGF5b3V0Qm91bmRzLm1heFggLSAxMCxcclxuICAgICAgYm90dG9tOiB0aGlzLmxheW91dEJvdW5kcy5tYXhZIC0gMTBcclxuICAgIH0gKTtcclxuICAgIGZyb250Q29udHJvbHNMYXllci5hZGRDaGlsZCggcmVzZXRBbGxCdXR0b24gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBzdGVwKCkge1xyXG4gICAgdGhpcy5kbmFNb2xlY3VsZU5vZGUuc3RlcCgpO1xyXG4gIH1cclxufVxyXG5cclxuZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzLnJlZ2lzdGVyKCAnTWFudWFsR2VuZUV4cHJlc3Npb25TY3JlZW5WaWV3JywgTWFudWFsR2VuZUV4cHJlc3Npb25TY3JlZW5WaWV3ICk7XHJcbmV4cG9ydCBkZWZhdWx0IE1hbnVhbEdlbmVFeHByZXNzaW9uU2NyZWVuVmlldzsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLFVBQVUsTUFBTSxvQ0FBb0M7QUFDM0QsT0FBT0MsbUJBQW1CLE1BQU0sdURBQXVEO0FBQ3ZGLE9BQU9DLFNBQVMsTUFBTSwwQ0FBMEM7QUFDaEUsT0FBT0MsY0FBYyxNQUFNLHVEQUF1RDtBQUNsRixPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLElBQUksRUFBRUMsSUFBSSxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ3BFLE9BQU9DLHFCQUFxQixNQUFNLHFEQUFxRDtBQUN2RixPQUFPQyxTQUFTLE1BQU0sbUNBQW1DO0FBQ3pELE9BQU9DLE1BQU0sTUFBTSxnQ0FBZ0M7QUFDbkQsT0FBT0MsZUFBZSxNQUFNLHNDQUFzQztBQUNsRSxPQUFPQyxnQkFBZ0IsTUFBTSx1Q0FBdUM7QUFDcEUsT0FBT0MscUJBQXFCLE1BQU0sNENBQTRDO0FBQzlFLE9BQU9DLGlCQUFpQixNQUFNLHdDQUF3QztBQUN0RSxPQUFPQyx3QkFBd0IsTUFBTSxtQ0FBbUM7QUFDeEUsT0FBT0MsK0JBQStCLE1BQU0sMENBQTBDO0FBQ3RGLE9BQU9D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