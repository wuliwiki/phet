// Copyright 2015-2021, University of Colorado Boulder

/**
 * Base class for all biomolecules (i.e. RNA polymerase, transcription factors, etc.) that move around within the
 * cell. This is a very central type within this simulation. This base class provides the basic infrastructure for
 * defining the shape, the movement, and the attachment behavior (i.e. how one biomolecule interacts with others in the
 * simulation). The specific, unique behavior for each biomolecule is implemented in the sub-types.
 *
 * @author John Blanco
 * @author Mohamed Safi
 * @author Aadish Gupta
 */

//modules
import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import Property from '../../../../axon/js/Property.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Vector3 from '../../../../dot/js/Vector3.js';
import { Color } from '../../../../scenery/js/imports.js';
import geneExpressionEssentials from '../../geneExpressionEssentials.js';
import MotionBounds from './motion-strategies/MotionBounds.js';
import ShapeChangingModelElement from './ShapeChangingModelElement.js';
class MobileBiomolecule extends ShapeChangingModelElement {
  /**
   * @param {GeneExpressionModel} model
   * @param {Shape} initialShape
   * @param {Color} baseColor
   */
  constructor(model, initialShape, baseColor) {
    super(initialShape);

    // @private {MotionStrategy} - Motion strategy that governs how this biomolecule moves. This changes as the molecule
    // interacts with other portions of the model.
    this.motionStrategy = null; // @private

    // @public (read-only) {Property.<Bounds2>} - bounds within which this biomolecule is allowed to move
    this.motionBoundsProperty = new Property(new MotionBounds());

    // @public (read-only) {Property.<number>} - Position on the Z axis. This is handled much differently than for the x
    // and y axes, which can be set to any value. The Z axis only goes between 0 (all the way to the front) and -1 (all
    // the way to the back).
    this.zPositionProperty = new Property(0);

    // @private {boolean} - flag that tracks whether motion in Z dimension is enabled
    this.zMotionEnabled = false;

    // @public (read-only) {Property.<number>} - a value that represents this biomolecule's "existence strength", which
    // is used primarily to fade out of existence. The range for this is 1 (full existence) to 0 (non-existent).
    this.existenceStrengthProperty = new Property(1);

    // @public {BooleanProperty} - a flag that is used to let the view know whether or not this biomolecule is in a
    // state where it is okay for the user to move it around
    this.movableByUserProperty = new BooleanProperty(true);

    // @public {BooleanProperty} - a flag that indicates whether or not this biomolecule is attached to the DNA strand.
    // Some biomolecules never attach to DNA, so it may never become true. This should only be set by subclasses.
    this.attachedToDnaProperty = new BooleanProperty(false);

    // @public {Property.<Color>} - Color to use when displaying this biomolecule to the user. This is a bit out of
    // place here, and has nothing to do with the fact that the molecule moves. This was just a convenient place to put
    // it (so far).
    this.colorProperty = new Property(Color.BLACK); // @public

    // @publich {BooleanProperty} Property that tracks whether this biomolecule is user controlled. If it is, it
    // shouldn't try to move or interact with anything. Handle changes in user control.
    this.userControlledProperty = new BooleanProperty(false); // @public

    // @private - Reference to the model in which this biomolecule exists. This is needed in case the biomolecule needs
    // to locate or create other biomolecules.
    this.model = model;

    // @protected {AttachmentStateMachine} - state machine that controls how the molecule interacts with other model
    // objects (primarily other biomolecules) in terms of attaching, detaching, etc.
    this.attachmentStateMachine = this.createAttachmentStateMachine();
    if (baseColor) {
      this.colorProperty.set(baseColor);
    }
    const handleUserControlledChanged = (isUserControlled, wasUserControlled) => {
      if (isUserControlled && !wasUserControlled) {
        this.handleGrabbedByUser();
      } else if (wasUserControlled && !isUserControlled) {
        this.handleReleasedByUser();
      }
    };
    this.userControlledProperty.link(handleUserControlledChanged);
    this.disposeMobileBiomolecule = () => {
      this.userControlledProperty.unlink(handleUserControlledChanged);
    };
  }

  /**
   * @public
   */
  dispose() {
    this.motionStrategy.dispose();
    this.disposeMobileBiomolecule();
    super.dispose();
  }

  /**
   * Method used to set the attachment state machine during construction. This is overridden in descendant classes in
   * order to supply this base class with different attachment behavior.
   *
   * @returns {AttachmentStateMachine}
   * @public
   */
  createAttachmentStateMachine() {
    throw new Error('createAttachmentStateMachine should be implemented in descendant classes of MobileBiomolecule');
  }

  /**
   * handle the case where the user grabs this model object (i.e. starts dragging it with the mouse or a finger)
   * @protected
   */
  handleGrabbedByUser() {
    // The user has grabbed this node. This should cause any existing or pending attachments to be severed.
    this.attachmentStateMachine.forceImmediateUnattachedAndAvailable();
  }

  /**
   * Handle the case where the user was controlling this model object (i.e. dragging it with the mouse) and has
   * released it. Override this if unique behavior is needed in a subclass.
   * @protected
   */
  handleReleasedByUser() {
    // The user has released this node after moving it. This does nothing in the base class.
  }

  /**
   * @param {number} dt
   * @public
   */
  step(dt) {
    if (!this.userControlledProperty.get()) {
      // Set a new position in model space based on the current motion strategy.
      if (this.zMotionEnabled) {
        this.setPosition3D(this.motionStrategy.getNextPosition3D(this.getPosition3D(), this.bounds, dt));
      } else {
        const currentPosition = this.getPosition();
        this.setPosition(this.motionStrategy.getNextPosition(currentPosition, this.bounds, dt));
      }

      // Update the state of the attachment state machine.
      this.attachmentStateMachine.step(dt);
    }
  }

  /**
   * Get the position, including a Z component. True 3D is not fully supported in this simulation, but a limited Z axis
   * is used in some cases to make biomolecules look like they are "off in the distance".
   *
   * @returns {Vector3} Position in 3D space. Z values are limited to be from zero to negative one, inclusive.
   * @private
   */
  getPosition3D() {
    const position = this.positionProperty.get();
    return new Vector3(position.x, position.y, this.zPositionProperty.get());
  }

  /**
   * @param {Vector3} position
   * @public
   */
  setPosition3D(position) {
    this.setPositionXY(position.x, position.y);
    this.zPositionProperty.set(position.z);
  }

  /**
   * Turn on/off 3D motion. Turning it on means that biomolecules will move in the Z dimension, which is depicted in
   * the view in such a way to make them look closer or further from the viewer.
   *
   * @param {boolean} zMotionEnabled
   * @public
   */
  set3DMotionEnabled(zMotionEnabled) {
    this.zMotionEnabled = zMotionEnabled;
  }

  /**
   * Get the direction to move when detaching from other molecules (including DNA). Can be changed in subclasses,
   * default is to move up.
   *
   * @returns {Vector2} Vector indicated the direction.
   * @public
   */
  getDetachDirection() {
    return new Vector2(0, 1);
  }

  /**
   * @returns {GeneExpressionModel}
   * @public
   */
  getModel() {
    return this.model;
  }

  /**
   * @param  {MotionBounds} motionBounds
   * @public
   */
  setMotionBounds(motionBounds) {
    this.motionBoundsProperty.set(motionBounds);
    this.motionBoundsProperty.notifyListenersStatic();
  }

  /**
   * Add the specified messenger RNA to the model.
   * @param {MessengerRna} messengerRna
   * @public
   */
  spawnMessengerRna(messengerRna) {
    this.model.addMessengerRna(messengerRna);
  }

  /**
   * Force this biomolecule to detach from anything to which it is currently attached or to abort any pending
   * attachments.
   * @public
   */
  forceDetach() {
    if (this.attachmentStateMachine.isAttached()) {
      this.attachmentStateMachine.detach();
    } else if (this.attachmentStateMachine.isMovingTowardAttachment()) {
      this.attachmentStateMachine.forceImmediateUnattachedAndAvailable();
    }
  }

  /**
   * Force this molecule to abort any pending attachment. This will NOT cause an attachment that is already consummated
   * to be broken.
   * @public
   */
  forceAbortPendingAttachment() {
    if (this.attachmentStateMachine.isMovingTowardAttachment()) {
      this.attachmentStateMachine.forceImmediateUnattachedAndAvailable();
    }
  }

  /**
   * Command the biomolecule to changes its conformation, which, for the purposes of this simulation, means that both
   * the color and the shape may change. This functionality is needed by some of the biomolecules, mostly when they
   * attach to something. The default does nothing, and it is up to the individual molecules to override in order to
   * implement their specific conformation change behavior.
   *
   * @param {number} changeFactor - Value, from 0 to 1, representing the degree of change from the nominal configuration.
   * @public
   */
  changeConformation(changeFactor) {
    // Should never be called if not implemented.
    throw new Error('changeConformation should be implemented in descendant classes of MobileBiomolecule');
  }

  /**
   * @override
   * Search for other biomolecules (and perhaps additional model elements) to which this biomolecule may legitimately
   * attach and, if any are founds, propose an attachment to them.
   *
   * @returns {} Attachment site of accepted attachment, null if no attachments were proposed or if all were rejected.
   * @public
   */
  proposeAttachments() {
    return null;
  }

  /**
   * @param {MotionStrategy} motionStrategy
   * @public
   */
  setMotionStrategy(motionStrategy) {
    if (this.motionStrategy) {
      this.motionStrategy.dispose();
    }
    this.motionStrategy = motionStrategy;
  }
}
geneExpressionEssentials.register('MobileBiomolecule', MobileBiomolecule);
export default MobileBiomolecule;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJQcm9wZXJ0eSIsIlZlY3RvcjIiLCJWZWN0b3IzIiwiQ29sb3IiLCJnZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMiLCJNb3Rpb25Cb3VuZHMiLCJTaGFwZUNoYW5naW5nTW9kZWxFbGVtZW50IiwiTW9iaWxlQmlvbW9sZWN1bGUiLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwiaW5pdGlhbFNoYXBlIiwiYmFzZUNvbG9yIiwibW90aW9uU3RyYXRlZ3kiLCJtb3Rpb25Cb3VuZHNQcm9wZXJ0eSIsInpQb3NpdGlvblByb3BlcnR5Iiwiek1vdGlvbkVuYWJsZWQiLCJleGlzdGVuY2VTdHJlbmd0aFByb3BlcnR5IiwibW92YWJsZUJ5VXNlclByb3BlcnR5IiwiYXR0YWNoZWRUb0RuYVByb3BlcnR5IiwiY29sb3JQcm9wZXJ0eSIsIkJMQUNLIiwidXNlckNvbnRyb2xsZWRQcm9wZXJ0eSIsImF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUiLCJjcmVhdGVBdHRhY2htZW50U3RhdGVNYWNoaW5lIiwic2V0IiwiaGFuZGxlVXNlckNvbnRyb2xsZWRDaGFuZ2VkIiwiaXNVc2VyQ29udHJvbGxlZCIsIndhc1VzZXJDb250cm9sbGVkIiwiaGFuZGxlR3JhYmJlZEJ5VXNlciIsImhhbmRsZVJlbGVhc2VkQnlVc2VyIiwibGluayIsImRpc3Bvc2VNb2JpbGVCaW9tb2xlY3VsZSIsInVubGluayIsImRpc3Bvc2UiLCJFcnJvciIsImZvcmNlSW1tZWRpYXRlVW5hdHRhY2hlZEFuZEF2YWlsYWJsZSIsInN0ZXAiLCJkdCIsImdldCIsInNldFBvc2l0aW9uM0QiLCJnZXROZXh0UG9zaXRpb24zRCIsImdldFBvc2l0aW9uM0QiLCJib3VuZHMiLCJjdXJyZW50UG9zaXRpb24iLCJnZXRQb3NpdGlvbiIsInNldFBvc2l0aW9uIiwiZ2V0TmV4dFBvc2l0aW9uIiwicG9zaXRpb24iLCJwb3NpdGlvblByb3BlcnR5IiwieCIsInkiLCJzZXRQb3NpdGlvblhZIiwieiIsInNldDNETW90aW9uRW5hYmxlZCIsImdldERldGFjaERpcmVjdGlvbiIsImdldE1vZGVsIiwic2V0TW90aW9uQm91bmRzIiwibW90aW9uQm91bmRzIiwibm90aWZ5TGlzdGVuZXJzU3RhdGljIiwic3Bhd25NZXNzZW5nZXJSbmEiLCJtZXNzZW5nZXJSbmEiLCJhZGRNZXNzZW5nZXJSbmEiLCJmb3JjZURldGFjaCIsImlzQXR0YWNoZWQiLCJkZXRhY2giLCJpc01vdmluZ1Rvd2FyZEF0dGFjaG1lbnQiLCJmb3JjZUFib3J0UGVuZGluZ0F0dGFjaG1lbnQiLCJjaGFuZ2VDb25mb3JtYXRpb24iLCJjaGFuZ2VGYWN0b3IiLCJwcm9wb3NlQXR0YWNobWVudHMiLCJzZXRNb3Rpb25TdHJhdGVneSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTW9iaWxlQmlvbW9sZWN1bGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTUtMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQmFzZSBjbGFzcyBmb3IgYWxsIGJpb21vbGVjdWxlcyAoaS5lLiBSTkEgcG9seW1lcmFzZSwgdHJhbnNjcmlwdGlvbiBmYWN0b3JzLCBldGMuKSB0aGF0IG1vdmUgYXJvdW5kIHdpdGhpbiB0aGVcclxuICogY2VsbC4gVGhpcyBpcyBhIHZlcnkgY2VudHJhbCB0eXBlIHdpdGhpbiB0aGlzIHNpbXVsYXRpb24uIFRoaXMgYmFzZSBjbGFzcyBwcm92aWRlcyB0aGUgYmFzaWMgaW5mcmFzdHJ1Y3R1cmUgZm9yXHJcbiAqIGRlZmluaW5nIHRoZSBzaGFwZSwgdGhlIG1vdmVtZW50LCBhbmQgdGhlIGF0dGFjaG1lbnQgYmVoYXZpb3IgKGkuZS4gaG93IG9uZSBiaW9tb2xlY3VsZSBpbnRlcmFjdHMgd2l0aCBvdGhlcnMgaW4gdGhlXHJcbiAqIHNpbXVsYXRpb24pLiBUaGUgc3BlY2lmaWMsIHVuaXF1ZSBiZWhhdmlvciBmb3IgZWFjaCBiaW9tb2xlY3VsZSBpcyBpbXBsZW1lbnRlZCBpbiB0aGUgc3ViLXR5cGVzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvXHJcbiAqIEBhdXRob3IgTW9oYW1lZCBTYWZpXHJcbiAqIEBhdXRob3IgQWFkaXNoIEd1cHRhXHJcbiAqL1xyXG5cclxuLy9tb2R1bGVzXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IFZlY3RvcjMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjMuanMnO1xyXG5pbXBvcnQgeyBDb2xvciB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBnZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMgZnJvbSAnLi4vLi4vZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzLmpzJztcclxuaW1wb3J0IE1vdGlvbkJvdW5kcyBmcm9tICcuL21vdGlvbi1zdHJhdGVnaWVzL01vdGlvbkJvdW5kcy5qcyc7XHJcbmltcG9ydCBTaGFwZUNoYW5naW5nTW9kZWxFbGVtZW50IGZyb20gJy4vU2hhcGVDaGFuZ2luZ01vZGVsRWxlbWVudC5qcyc7XHJcblxyXG5jbGFzcyBNb2JpbGVCaW9tb2xlY3VsZSBleHRlbmRzIFNoYXBlQ2hhbmdpbmdNb2RlbEVsZW1lbnQge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0dlbmVFeHByZXNzaW9uTW9kZWx9IG1vZGVsXHJcbiAgICogQHBhcmFtIHtTaGFwZX0gaW5pdGlhbFNoYXBlXHJcbiAgICogQHBhcmFtIHtDb2xvcn0gYmFzZUNvbG9yXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1vZGVsLCBpbml0aWFsU2hhcGUsIGJhc2VDb2xvciApIHtcclxuXHJcbiAgICBzdXBlciggaW5pdGlhbFNoYXBlICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge01vdGlvblN0cmF0ZWd5fSAtIE1vdGlvbiBzdHJhdGVneSB0aGF0IGdvdmVybnMgaG93IHRoaXMgYmlvbW9sZWN1bGUgbW92ZXMuIFRoaXMgY2hhbmdlcyBhcyB0aGUgbW9sZWN1bGVcclxuICAgIC8vIGludGVyYWN0cyB3aXRoIG90aGVyIHBvcnRpb25zIG9mIHRoZSBtb2RlbC5cclxuICAgIHRoaXMubW90aW9uU3RyYXRlZ3kgPSBudWxsOyAvLyBAcHJpdmF0ZVxyXG5cclxuICAgIC8vIEBwdWJsaWMgKHJlYWQtb25seSkge1Byb3BlcnR5LjxCb3VuZHMyPn0gLSBib3VuZHMgd2l0aGluIHdoaWNoIHRoaXMgYmlvbW9sZWN1bGUgaXMgYWxsb3dlZCB0byBtb3ZlXHJcbiAgICB0aGlzLm1vdGlvbkJvdW5kc1Byb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBuZXcgTW90aW9uQm91bmRzKCkgKTtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIHtQcm9wZXJ0eS48bnVtYmVyPn0gLSBQb3NpdGlvbiBvbiB0aGUgWiBheGlzLiBUaGlzIGlzIGhhbmRsZWQgbXVjaCBkaWZmZXJlbnRseSB0aGFuIGZvciB0aGUgeFxyXG4gICAgLy8gYW5kIHkgYXhlcywgd2hpY2ggY2FuIGJlIHNldCB0byBhbnkgdmFsdWUuIFRoZSBaIGF4aXMgb25seSBnb2VzIGJldHdlZW4gMCAoYWxsIHRoZSB3YXkgdG8gdGhlIGZyb250KSBhbmQgLTEgKGFsbFxyXG4gICAgLy8gdGhlIHdheSB0byB0aGUgYmFjaykuXHJcbiAgICB0aGlzLnpQb3NpdGlvblByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCAwICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge2Jvb2xlYW59IC0gZmxhZyB0aGF0IHRyYWNrcyB3aGV0aGVyIG1vdGlvbiBpbiBaIGRpbWVuc2lvbiBpcyBlbmFibGVkXHJcbiAgICB0aGlzLnpNb3Rpb25FbmFibGVkID0gZmFsc2U7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAocmVhZC1vbmx5KSB7UHJvcGVydHkuPG51bWJlcj59IC0gYSB2YWx1ZSB0aGF0IHJlcHJlc2VudHMgdGhpcyBiaW9tb2xlY3VsZSdzIFwiZXhpc3RlbmNlIHN0cmVuZ3RoXCIsIHdoaWNoXHJcbiAgICAvLyBpcyB1c2VkIHByaW1hcmlseSB0byBmYWRlIG91dCBvZiBleGlzdGVuY2UuIFRoZSByYW5nZSBmb3IgdGhpcyBpcyAxIChmdWxsIGV4aXN0ZW5jZSkgdG8gMCAobm9uLWV4aXN0ZW50KS5cclxuICAgIHRoaXMuZXhpc3RlbmNlU3RyZW5ndGhQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggMSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge0Jvb2xlYW5Qcm9wZXJ0eX0gLSBhIGZsYWcgdGhhdCBpcyB1c2VkIHRvIGxldCB0aGUgdmlldyBrbm93IHdoZXRoZXIgb3Igbm90IHRoaXMgYmlvbW9sZWN1bGUgaXMgaW4gYVxyXG4gICAgLy8gc3RhdGUgd2hlcmUgaXQgaXMgb2theSBmb3IgdGhlIHVzZXIgdG8gbW92ZSBpdCBhcm91bmRcclxuICAgIHRoaXMubW92YWJsZUJ5VXNlclByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggdHJ1ZSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge0Jvb2xlYW5Qcm9wZXJ0eX0gLSBhIGZsYWcgdGhhdCBpbmRpY2F0ZXMgd2hldGhlciBvciBub3QgdGhpcyBiaW9tb2xlY3VsZSBpcyBhdHRhY2hlZCB0byB0aGUgRE5BIHN0cmFuZC5cclxuICAgIC8vIFNvbWUgYmlvbW9sZWN1bGVzIG5ldmVyIGF0dGFjaCB0byBETkEsIHNvIGl0IG1heSBuZXZlciBiZWNvbWUgdHJ1ZS4gVGhpcyBzaG91bGQgb25seSBiZSBzZXQgYnkgc3ViY2xhc3Nlcy5cclxuICAgIHRoaXMuYXR0YWNoZWRUb0RuYVByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuXHJcbiAgICAvLyBAcHVibGljIHtQcm9wZXJ0eS48Q29sb3I+fSAtIENvbG9yIHRvIHVzZSB3aGVuIGRpc3BsYXlpbmcgdGhpcyBiaW9tb2xlY3VsZSB0byB0aGUgdXNlci4gVGhpcyBpcyBhIGJpdCBvdXQgb2ZcclxuICAgIC8vIHBsYWNlIGhlcmUsIGFuZCBoYXMgbm90aGluZyB0byBkbyB3aXRoIHRoZSBmYWN0IHRoYXQgdGhlIG1vbGVjdWxlIG1vdmVzLiBUaGlzIHdhcyBqdXN0IGEgY29udmVuaWVudCBwbGFjZSB0byBwdXRcclxuICAgIC8vIGl0IChzbyBmYXIpLlxyXG4gICAgdGhpcy5jb2xvclByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBDb2xvci5CTEFDSyApOyAvLyBAcHVibGljXHJcblxyXG4gICAgLy8gQHB1YmxpY2gge0Jvb2xlYW5Qcm9wZXJ0eX0gUHJvcGVydHkgdGhhdCB0cmFja3Mgd2hldGhlciB0aGlzIGJpb21vbGVjdWxlIGlzIHVzZXIgY29udHJvbGxlZC4gSWYgaXQgaXMsIGl0XHJcbiAgICAvLyBzaG91bGRuJ3QgdHJ5IHRvIG1vdmUgb3IgaW50ZXJhY3Qgd2l0aCBhbnl0aGluZy4gSGFuZGxlIGNoYW5nZXMgaW4gdXNlciBjb250cm9sLlxyXG4gICAgdGhpcy51c2VyQ29udHJvbGxlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTsgLy8gQHB1YmxpY1xyXG5cclxuICAgIC8vIEBwcml2YXRlIC0gUmVmZXJlbmNlIHRvIHRoZSBtb2RlbCBpbiB3aGljaCB0aGlzIGJpb21vbGVjdWxlIGV4aXN0cy4gVGhpcyBpcyBuZWVkZWQgaW4gY2FzZSB0aGUgYmlvbW9sZWN1bGUgbmVlZHNcclxuICAgIC8vIHRvIGxvY2F0ZSBvciBjcmVhdGUgb3RoZXIgYmlvbW9sZWN1bGVzLlxyXG4gICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xyXG5cclxuICAgIC8vIEBwcm90ZWN0ZWQge0F0dGFjaG1lbnRTdGF0ZU1hY2hpbmV9IC0gc3RhdGUgbWFjaGluZSB0aGF0IGNvbnRyb2xzIGhvdyB0aGUgbW9sZWN1bGUgaW50ZXJhY3RzIHdpdGggb3RoZXIgbW9kZWxcclxuICAgIC8vIG9iamVjdHMgKHByaW1hcmlseSBvdGhlciBiaW9tb2xlY3VsZXMpIGluIHRlcm1zIG9mIGF0dGFjaGluZywgZGV0YWNoaW5nLCBldGMuXHJcbiAgICB0aGlzLmF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUgPSB0aGlzLmNyZWF0ZUF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUoKTtcclxuXHJcbiAgICBpZiAoIGJhc2VDb2xvciApIHtcclxuICAgICAgdGhpcy5jb2xvclByb3BlcnR5LnNldCggYmFzZUNvbG9yICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaGFuZGxlVXNlckNvbnRyb2xsZWRDaGFuZ2VkID0gKCBpc1VzZXJDb250cm9sbGVkLCB3YXNVc2VyQ29udHJvbGxlZCApID0+IHtcclxuICAgICAgaWYgKCBpc1VzZXJDb250cm9sbGVkICYmICF3YXNVc2VyQ29udHJvbGxlZCApIHtcclxuICAgICAgICB0aGlzLmhhbmRsZUdyYWJiZWRCeVVzZXIoKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggd2FzVXNlckNvbnRyb2xsZWQgJiYgIWlzVXNlckNvbnRyb2xsZWQgKSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVSZWxlYXNlZEJ5VXNlcigpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMudXNlckNvbnRyb2xsZWRQcm9wZXJ0eS5saW5rKCBoYW5kbGVVc2VyQ29udHJvbGxlZENoYW5nZWQgKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VNb2JpbGVCaW9tb2xlY3VsZSA9ICgpID0+IHtcclxuICAgICAgdGhpcy51c2VyQ29udHJvbGxlZFByb3BlcnR5LnVubGluayggaGFuZGxlVXNlckNvbnRyb2xsZWRDaGFuZ2VkICk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGRpc3Bvc2UoKSB7XHJcbiAgICB0aGlzLm1vdGlvblN0cmF0ZWd5LmRpc3Bvc2UoKTtcclxuICAgIHRoaXMuZGlzcG9zZU1vYmlsZUJpb21vbGVjdWxlKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNZXRob2QgdXNlZCB0byBzZXQgdGhlIGF0dGFjaG1lbnQgc3RhdGUgbWFjaGluZSBkdXJpbmcgY29uc3RydWN0aW9uLiBUaGlzIGlzIG92ZXJyaWRkZW4gaW4gZGVzY2VuZGFudCBjbGFzc2VzIGluXHJcbiAgICogb3JkZXIgdG8gc3VwcGx5IHRoaXMgYmFzZSBjbGFzcyB3aXRoIGRpZmZlcmVudCBhdHRhY2htZW50IGJlaGF2aW9yLlxyXG4gICAqXHJcbiAgICogQHJldHVybnMge0F0dGFjaG1lbnRTdGF0ZU1hY2hpbmV9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNyZWF0ZUF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUoKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoICdjcmVhdGVBdHRhY2htZW50U3RhdGVNYWNoaW5lIHNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBkZXNjZW5kYW50IGNsYXNzZXMgb2YgTW9iaWxlQmlvbW9sZWN1bGUnICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgdGhlIHVzZXIgZ3JhYnMgdGhpcyBtb2RlbCBvYmplY3QgKGkuZS4gc3RhcnRzIGRyYWdnaW5nIGl0IHdpdGggdGhlIG1vdXNlIG9yIGEgZmluZ2VyKVxyXG4gICAqIEBwcm90ZWN0ZWRcclxuICAgKi9cclxuICBoYW5kbGVHcmFiYmVkQnlVc2VyKCkge1xyXG4gICAgLy8gVGhlIHVzZXIgaGFzIGdyYWJiZWQgdGhpcyBub2RlLiBUaGlzIHNob3VsZCBjYXVzZSBhbnkgZXhpc3Rpbmcgb3IgcGVuZGluZyBhdHRhY2htZW50cyB0byBiZSBzZXZlcmVkLlxyXG4gICAgdGhpcy5hdHRhY2htZW50U3RhdGVNYWNoaW5lLmZvcmNlSW1tZWRpYXRlVW5hdHRhY2hlZEFuZEF2YWlsYWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIHdhcyBjb250cm9sbGluZyB0aGlzIG1vZGVsIG9iamVjdCAoaS5lLiBkcmFnZ2luZyBpdCB3aXRoIHRoZSBtb3VzZSkgYW5kIGhhc1xyXG4gICAqIHJlbGVhc2VkIGl0LiBPdmVycmlkZSB0aGlzIGlmIHVuaXF1ZSBiZWhhdmlvciBpcyBuZWVkZWQgaW4gYSBzdWJjbGFzcy5cclxuICAgKiBAcHJvdGVjdGVkXHJcbiAgICovXHJcbiAgaGFuZGxlUmVsZWFzZWRCeVVzZXIoKSB7XHJcbiAgICAvLyBUaGUgdXNlciBoYXMgcmVsZWFzZWQgdGhpcyBub2RlIGFmdGVyIG1vdmluZyBpdC4gVGhpcyBkb2VzIG5vdGhpbmcgaW4gdGhlIGJhc2UgY2xhc3MuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHRcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc3RlcCggZHQgKSB7XHJcblxyXG4gICAgaWYgKCAhdGhpcy51c2VyQ29udHJvbGxlZFByb3BlcnR5LmdldCgpICkge1xyXG5cclxuICAgICAgLy8gU2V0IGEgbmV3IHBvc2l0aW9uIGluIG1vZGVsIHNwYWNlIGJhc2VkIG9uIHRoZSBjdXJyZW50IG1vdGlvbiBzdHJhdGVneS5cclxuICAgICAgaWYgKCB0aGlzLnpNb3Rpb25FbmFibGVkICkge1xyXG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb24zRCggdGhpcy5tb3Rpb25TdHJhdGVneS5nZXROZXh0UG9zaXRpb24zRCggdGhpcy5nZXRQb3NpdGlvbjNEKCksIHRoaXMuYm91bmRzLCBkdCApICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgY29uc3QgY3VycmVudFBvc2l0aW9uID0gdGhpcy5nZXRQb3NpdGlvbigpO1xyXG4gICAgICAgIHRoaXMuc2V0UG9zaXRpb24oIHRoaXMubW90aW9uU3RyYXRlZ3kuZ2V0TmV4dFBvc2l0aW9uKCBjdXJyZW50UG9zaXRpb24sIHRoaXMuYm91bmRzLCBkdCApICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFVwZGF0ZSB0aGUgc3RhdGUgb2YgdGhlIGF0dGFjaG1lbnQgc3RhdGUgbWFjaGluZS5cclxuICAgICAgdGhpcy5hdHRhY2htZW50U3RhdGVNYWNoaW5lLnN0ZXAoIGR0ICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIHBvc2l0aW9uLCBpbmNsdWRpbmcgYSBaIGNvbXBvbmVudC4gVHJ1ZSAzRCBpcyBub3QgZnVsbHkgc3VwcG9ydGVkIGluIHRoaXMgc2ltdWxhdGlvbiwgYnV0IGEgbGltaXRlZCBaIGF4aXNcclxuICAgKiBpcyB1c2VkIGluIHNvbWUgY2FzZXMgdG8gbWFrZSBiaW9tb2xlY3VsZXMgbG9vayBsaWtlIHRoZXkgYXJlIFwib2ZmIGluIHRoZSBkaXN0YW5jZVwiLlxyXG4gICAqXHJcbiAgICogQHJldHVybnMge1ZlY3RvcjN9IFBvc2l0aW9uIGluIDNEIHNwYWNlLiBaIHZhbHVlcyBhcmUgbGltaXRlZCB0byBiZSBmcm9tIHplcm8gdG8gbmVnYXRpdmUgb25lLCBpbmNsdXNpdmUuXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBnZXRQb3NpdGlvbjNEKCkge1xyXG4gICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLnBvc2l0aW9uUHJvcGVydHkuZ2V0KCk7XHJcbiAgICByZXR1cm4gbmV3IFZlY3RvcjMoIHBvc2l0aW9uLngsIHBvc2l0aW9uLnksIHRoaXMuelBvc2l0aW9uUHJvcGVydHkuZ2V0KCkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7VmVjdG9yM30gcG9zaXRpb25cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc2V0UG9zaXRpb24zRCggcG9zaXRpb24gKSB7XHJcbiAgICB0aGlzLnNldFBvc2l0aW9uWFkoIHBvc2l0aW9uLngsIHBvc2l0aW9uLnkgKTtcclxuICAgIHRoaXMuelBvc2l0aW9uUHJvcGVydHkuc2V0KCBwb3NpdGlvbi56ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUdXJuIG9uL29mZiAzRCBtb3Rpb24uIFR1cm5pbmcgaXQgb24gbWVhbnMgdGhhdCBiaW9tb2xlY3VsZXMgd2lsbCBtb3ZlIGluIHRoZSBaIGRpbWVuc2lvbiwgd2hpY2ggaXMgZGVwaWN0ZWQgaW5cclxuICAgKiB0aGUgdmlldyBpbiBzdWNoIGEgd2F5IHRvIG1ha2UgdGhlbSBsb29rIGNsb3NlciBvciBmdXJ0aGVyIGZyb20gdGhlIHZpZXdlci5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gek1vdGlvbkVuYWJsZWRcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc2V0M0RNb3Rpb25FbmFibGVkKCB6TW90aW9uRW5hYmxlZCApIHtcclxuICAgIHRoaXMuek1vdGlvbkVuYWJsZWQgPSB6TW90aW9uRW5hYmxlZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgZGlyZWN0aW9uIHRvIG1vdmUgd2hlbiBkZXRhY2hpbmcgZnJvbSBvdGhlciBtb2xlY3VsZXMgKGluY2x1ZGluZyBETkEpLiBDYW4gYmUgY2hhbmdlZCBpbiBzdWJjbGFzc2VzLFxyXG4gICAqIGRlZmF1bHQgaXMgdG8gbW92ZSB1cC5cclxuICAgKlxyXG4gICAqIEByZXR1cm5zIHtWZWN0b3IyfSBWZWN0b3IgaW5kaWNhdGVkIHRoZSBkaXJlY3Rpb24uXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGdldERldGFjaERpcmVjdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgVmVjdG9yMiggMCwgMSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHJldHVybnMge0dlbmVFeHByZXNzaW9uTW9kZWx9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGdldE1vZGVsKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubW9kZWw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gIHtNb3Rpb25Cb3VuZHN9IG1vdGlvbkJvdW5kc1xyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBzZXRNb3Rpb25Cb3VuZHMoIG1vdGlvbkJvdW5kcyApIHtcclxuICAgIHRoaXMubW90aW9uQm91bmRzUHJvcGVydHkuc2V0KCBtb3Rpb25Cb3VuZHMgKTtcclxuICAgIHRoaXMubW90aW9uQm91bmRzUHJvcGVydHkubm90aWZ5TGlzdGVuZXJzU3RhdGljKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGQgdGhlIHNwZWNpZmllZCBtZXNzZW5nZXIgUk5BIHRvIHRoZSBtb2RlbC5cclxuICAgKiBAcGFyYW0ge01lc3NlbmdlclJuYX0gbWVzc2VuZ2VyUm5hXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHNwYXduTWVzc2VuZ2VyUm5hKCBtZXNzZW5nZXJSbmEgKSB7XHJcbiAgICB0aGlzLm1vZGVsLmFkZE1lc3NlbmdlclJuYSggbWVzc2VuZ2VyUm5hICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGb3JjZSB0aGlzIGJpb21vbGVjdWxlIHRvIGRldGFjaCBmcm9tIGFueXRoaW5nIHRvIHdoaWNoIGl0IGlzIGN1cnJlbnRseSBhdHRhY2hlZCBvciB0byBhYm9ydCBhbnkgcGVuZGluZ1xyXG4gICAqIGF0dGFjaG1lbnRzLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBmb3JjZURldGFjaCgpIHtcclxuICAgIGlmICggdGhpcy5hdHRhY2htZW50U3RhdGVNYWNoaW5lLmlzQXR0YWNoZWQoKSApIHtcclxuICAgICAgdGhpcy5hdHRhY2htZW50U3RhdGVNYWNoaW5lLmRldGFjaCgpO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIHRoaXMuYXR0YWNobWVudFN0YXRlTWFjaGluZS5pc01vdmluZ1Rvd2FyZEF0dGFjaG1lbnQoKSApIHtcclxuICAgICAgdGhpcy5hdHRhY2htZW50U3RhdGVNYWNoaW5lLmZvcmNlSW1tZWRpYXRlVW5hdHRhY2hlZEFuZEF2YWlsYWJsZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRm9yY2UgdGhpcyBtb2xlY3VsZSB0byBhYm9ydCBhbnkgcGVuZGluZyBhdHRhY2htZW50LiBUaGlzIHdpbGwgTk9UIGNhdXNlIGFuIGF0dGFjaG1lbnQgdGhhdCBpcyBhbHJlYWR5IGNvbnN1bW1hdGVkXHJcbiAgICogdG8gYmUgYnJva2VuLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBmb3JjZUFib3J0UGVuZGluZ0F0dGFjaG1lbnQoKSB7XHJcbiAgICBpZiAoIHRoaXMuYXR0YWNobWVudFN0YXRlTWFjaGluZS5pc01vdmluZ1Rvd2FyZEF0dGFjaG1lbnQoKSApIHtcclxuICAgICAgdGhpcy5hdHRhY2htZW50U3RhdGVNYWNoaW5lLmZvcmNlSW1tZWRpYXRlVW5hdHRhY2hlZEFuZEF2YWlsYWJsZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29tbWFuZCB0aGUgYmlvbW9sZWN1bGUgdG8gY2hhbmdlcyBpdHMgY29uZm9ybWF0aW9uLCB3aGljaCwgZm9yIHRoZSBwdXJwb3NlcyBvZiB0aGlzIHNpbXVsYXRpb24sIG1lYW5zIHRoYXQgYm90aFxyXG4gICAqIHRoZSBjb2xvciBhbmQgdGhlIHNoYXBlIG1heSBjaGFuZ2UuIFRoaXMgZnVuY3Rpb25hbGl0eSBpcyBuZWVkZWQgYnkgc29tZSBvZiB0aGUgYmlvbW9sZWN1bGVzLCBtb3N0bHkgd2hlbiB0aGV5XHJcbiAgICogYXR0YWNoIHRvIHNvbWV0aGluZy4gVGhlIGRlZmF1bHQgZG9lcyBub3RoaW5nLCBhbmQgaXQgaXMgdXAgdG8gdGhlIGluZGl2aWR1YWwgbW9sZWN1bGVzIHRvIG92ZXJyaWRlIGluIG9yZGVyIHRvXHJcbiAgICogaW1wbGVtZW50IHRoZWlyIHNwZWNpZmljIGNvbmZvcm1hdGlvbiBjaGFuZ2UgYmVoYXZpb3IuXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge251bWJlcn0gY2hhbmdlRmFjdG9yIC0gVmFsdWUsIGZyb20gMCB0byAxLCByZXByZXNlbnRpbmcgdGhlIGRlZ3JlZSBvZiBjaGFuZ2UgZnJvbSB0aGUgbm9taW5hbCBjb25maWd1cmF0aW9uLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBjaGFuZ2VDb25mb3JtYXRpb24oIGNoYW5nZUZhY3RvciApIHtcclxuICAgIC8vIFNob3VsZCBuZXZlciBiZSBjYWxsZWQgaWYgbm90IGltcGxlbWVudGVkLlxyXG4gICAgdGhyb3cgbmV3IEVycm9yKCAnY2hhbmdlQ29uZm9ybWF0aW9uIHNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBkZXNjZW5kYW50IGNsYXNzZXMgb2YgTW9iaWxlQmlvbW9sZWN1bGUnICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBTZWFyY2ggZm9yIG90aGVyIGJpb21vbGVjdWxlcyAoYW5kIHBlcmhhcHMgYWRkaXRpb25hbCBtb2RlbCBlbGVtZW50cykgdG8gd2hpY2ggdGhpcyBiaW9tb2xlY3VsZSBtYXkgbGVnaXRpbWF0ZWx5XHJcbiAgICogYXR0YWNoIGFuZCwgaWYgYW55IGFyZSBmb3VuZHMsIHByb3Bvc2UgYW4gYXR0YWNobWVudCB0byB0aGVtLlxyXG4gICAqXHJcbiAgICogQHJldHVybnMge30gQXR0YWNobWVudCBzaXRlIG9mIGFjY2VwdGVkIGF0dGFjaG1lbnQsIG51bGwgaWYgbm8gYXR0YWNobWVudHMgd2VyZSBwcm9wb3NlZCBvciBpZiBhbGwgd2VyZSByZWplY3RlZC5cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcHJvcG9zZUF0dGFjaG1lbnRzKCkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge01vdGlvblN0cmF0ZWd5fSBtb3Rpb25TdHJhdGVneVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBzZXRNb3Rpb25TdHJhdGVneSggbW90aW9uU3RyYXRlZ3kgKSB7XHJcbiAgICBpZiAoIHRoaXMubW90aW9uU3RyYXRlZ3kgKSB7XHJcbiAgICAgIHRoaXMubW90aW9uU3RyYXRlZ3kuZGlzcG9zZSgpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5tb3Rpb25TdHJhdGVneSA9IG1vdGlvblN0cmF0ZWd5O1xyXG4gIH1cclxufVxyXG5cclxuZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzLnJlZ2lzdGVyKCAnTW9iaWxlQmlvbW9sZWN1bGUnLCBNb2JpbGVCaW9tb2xlY3VsZSApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgTW9iaWxlQmlvbW9sZWN1bGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsU0FBU0MsS0FBSyxRQUFRLG1DQUFtQztBQUN6RCxPQUFPQyx3QkFBd0IsTUFBTSxtQ0FBbUM7QUFDeEUsT0FBT0MsWUFBWSxNQUFNLHFDQUFxQztBQUM5RCxPQUFPQyx5QkFBeUIsTUFBTSxnQ0FBZ0M7QUFFdEUsTUFBTUMsaUJBQWlCLFNBQVNELHlCQUF5QixDQUFDO0VBRXhEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRUUsV0FBV0EsQ0FBRUMsS0FBSyxFQUFFQyxZQUFZLEVBQUVDLFNBQVMsRUFBRztJQUU1QyxLQUFLLENBQUVELFlBQWEsQ0FBQzs7SUFFckI7SUFDQTtJQUNBLElBQUksQ0FBQ0UsY0FBYyxHQUFHLElBQUksQ0FBQyxDQUFDOztJQUU1QjtJQUNBLElBQUksQ0FBQ0Msb0JBQW9CLEdBQUcsSUFBSWIsUUFBUSxDQUFFLElBQUlLLFlBQVksQ0FBQyxDQUFFLENBQUM7O0lBRTlEO0lBQ0E7SUFDQTtJQUNBLElBQUksQ0FBQ1MsaUJBQWlCLEdBQUcsSUFBSWQsUUFB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