// Copyright 2015-2021, University of Colorado Boulder

/**
 * This class defines a motion strategy that produces a random walk, meaning that items using this strategy will move in
 * one direction for a while, then switch directions and move in another.
 *
 * @author John Blanco
 * @author Mohamed Safi
 * @author Aadish Gupta
 */

import dotRandom from '../../../../../dot/js/dotRandom.js';
import Utils from '../../../../../dot/js/Utils.js';
import Vector2 from '../../../../../dot/js/Vector2.js';
import Vector3 from '../../../../../dot/js/Vector3.js';
import geneExpressionEssentials from '../../../geneExpressionEssentials.js';
import MotionStrategy from './MotionStrategy.js';

// constants
const MIN_XY_VELOCITY = 200; // In picometers/s
const MAX_XY_VELOCITY = 400; // In picometers/s
const MIN_Z_VELOCITY = 0.3; // In normalized units per sec
const MAX_Z_VELOCITY = 0.6; // In normalized units per sec
const MIN_TIME_IN_ONE_DIRECTION = 0.25; // In seconds.
const MAX_TIME_IN_ONE_DIRECTION = 0.8; // In seconds.

// Vector used for intermediate calculations - Added to avoid excessive creation of Vector3 instances - Ashraf
const nextPosition3DScratchVector = new Vector3(0, 0, 0);
class RandomWalkMotionStrategy extends MotionStrategy {
  /**
   * @param {Property} motionBoundsProperty
   */
  constructor(motionBoundsProperty) {
    super();
    this.directionChangeCountdown = 0; // @private
    this.currentMotionVector2D = new Vector2(0, 0); // @private
    this.currentZVelocity = 0; // @private

    const handleMotionBoundsChanged = motionBounds => {
      this.motionBounds = motionBounds;
    };
    motionBoundsProperty.link(handleMotionBoundsChanged);
    this.disposeRandomWalkMotionStrategy = () => {
      motionBoundsProperty.unlink(handleMotionBoundsChanged);
    };
  }

  /**
   * @override
   * @public
   */
  dispose() {
    this.disposeRandomWalkMotionStrategy();
  }

  /**
   * @override
   * @param {Vector2} currentPosition
   * @param {Bounds2} bounds
   * @param {number} dt
   * @returns {Vector2}
   * @public
   */
  getNextPosition(currentPosition, bounds, dt) {
    nextPosition3DScratchVector.x = currentPosition.x;
    nextPosition3DScratchVector.y = currentPosition.y;
    nextPosition3DScratchVector.z = 0;
    const position3D = this.getNextPosition3D(nextPosition3DScratchVector, bounds, dt);
    return new Vector2(position3D.x, position3D.y);
  }

  /**
   * @returns {number}
   * @private
   */
  generateDirectionChangeCountdownValue() {
    return MIN_TIME_IN_ONE_DIRECTION + dotRandom.nextDouble() * (MAX_TIME_IN_ONE_DIRECTION - MIN_TIME_IN_ONE_DIRECTION);
  }

  /**
   * @override
   * @param {Vector3} currentPosition
   * @param {Bounds2} bounds
   * @param {number} dt
   * @returns {Vector3}
   * @public
   */
  getNextPosition3D(currentPosition, bounds, dt) {
    this.directionChangeCountdown -= dt;
    if (this.directionChangeCountdown <= 0) {
      // Time to change direction.
      const newXYVelocity = MIN_XY_VELOCITY + dotRandom.nextDouble() * (MAX_XY_VELOCITY - MIN_XY_VELOCITY);
      const newXYAngle = Math.PI * 2 * dotRandom.nextDouble();
      this.currentMotionVector2D = Vector2.createPolar(newXYVelocity, newXYAngle);
      this.currentZVelocity = MIN_Z_VELOCITY + dotRandom.nextDouble() * (MAX_Z_VELOCITY - MIN_Z_VELOCITY);
      this.currentZVelocity = dotRandom.nextBoolean() ? -this.currentZVelocity : this.currentZVelocity;

      // Reset the countdown timer.
      this.directionChangeCountdown = this.generateDirectionChangeCountdownValue();
    }

    // Make sure that current motion will not cause the model element to move outside of the motion bounds.
    if (!this.motionBounds.testIfInMotionBoundsWithDelta(bounds, this.currentMotionVector2D, dt)) {
      // The current motion vector would take this element out of bounds, so it needs to "bounce".
      this.currentMotionVector2D = this.getMotionVectorForBounce(bounds, this.currentMotionVector2D, dt, MAX_XY_VELOCITY);

      // Reset the timer.
      this.directionChangeCountdown = this.generateDirectionChangeCountdownValue();
    }

    // To prevent odd-looking situations, the Z direction is limited so that biomolecules don't appear transparent
    // when on top of the DNA molecule.
    const minZ = this.getMinZ(bounds, currentPosition);

    // Calculate the next position based on current motion.
    return new Vector3(currentPosition.x + this.currentMotionVector2D.x * dt, currentPosition.y + this.currentMotionVector2D.y * dt, Utils.clamp(currentPosition.z + this.currentZVelocity * dt, minZ, 0));
  }
}
geneExpressionEssentials.register('RandomWalkMotionStrategy', RandomWalkMotionStrategy);
export default RandomWalkMotionStrategy;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJVdGlscyIsIlZlY3RvcjIiLCJWZWN0b3IzIiwiZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzIiwiTW90aW9uU3RyYXRlZ3kiLCJNSU5fWFlfVkVMT0NJVFkiLCJNQVhfWFlfVkVMT0NJVFkiLCJNSU5fWl9WRUxPQ0lUWSIsIk1BWF9aX1ZFTE9DSVRZIiwiTUlOX1RJTUVfSU5fT05FX0RJUkVDVElPTiIsIk1BWF9USU1FX0lOX09ORV9ESVJFQ1RJT04iLCJuZXh0UG9zaXRpb24zRFNjcmF0Y2hWZWN0b3IiLCJSYW5kb21XYWxrTW90aW9uU3RyYXRlZ3kiLCJjb25zdHJ1Y3RvciIsIm1vdGlvbkJvdW5kc1Byb3BlcnR5IiwiZGlyZWN0aW9uQ2hhbmdlQ291bnRkb3duIiwiY3VycmVudE1vdGlvblZlY3RvcjJEIiwiY3VycmVudFpWZWxvY2l0eSIsImhhbmRsZU1vdGlvbkJvdW5kc0NoYW5nZWQiLCJtb3Rpb25Cb3VuZHMiLCJsaW5rIiwiZGlzcG9zZVJhbmRvbVdhbGtNb3Rpb25TdHJhdGVneSIsInVubGluayIsImRpc3Bvc2UiLCJnZXROZXh0UG9zaXRpb24iLCJjdXJyZW50UG9zaXRpb24iLCJib3VuZHMiLCJkdCIsIngiLCJ5IiwieiIsInBvc2l0aW9uM0QiLCJnZXROZXh0UG9zaXRpb24zRCIsImdlbmVyYXRlRGlyZWN0aW9uQ2hhbmdlQ291bnRkb3duVmFsdWUiLCJuZXh0RG91YmxlIiwibmV3WFlWZWxvY2l0eSIsIm5ld1hZQW5nbGUiLCJNYXRoIiwiUEkiLCJjcmVhdGVQb2xhciIsIm5leHRCb29sZWFuIiwidGVzdElmSW5Nb3Rpb25Cb3VuZHNXaXRoRGVsdGEiLCJnZXRNb3Rpb25WZWN0b3JGb3JCb3VuY2UiLCJtaW5aIiwiZ2V0TWluWiIsImNsYW1wIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJSYW5kb21XYWxrTW90aW9uU3RyYXRlZ3kuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTUtMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhpcyBjbGFzcyBkZWZpbmVzIGEgbW90aW9uIHN0cmF0ZWd5IHRoYXQgcHJvZHVjZXMgYSByYW5kb20gd2FsaywgbWVhbmluZyB0aGF0IGl0ZW1zIHVzaW5nIHRoaXMgc3RyYXRlZ3kgd2lsbCBtb3ZlIGluXHJcbiAqIG9uZSBkaXJlY3Rpb24gZm9yIGEgd2hpbGUsIHRoZW4gc3dpdGNoIGRpcmVjdGlvbnMgYW5kIG1vdmUgaW4gYW5vdGhlci5cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKiBAYXV0aG9yIE1vaGFtZWQgU2FmaVxyXG4gKiBAYXV0aG9yIEFhZGlzaCBHdXB0YVxyXG4gKi9cclxuXHJcbmltcG9ydCBkb3RSYW5kb20gZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL2RvdFJhbmRvbS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBWZWN0b3IzIGZyb20gJy4uLy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IzLmpzJztcclxuaW1wb3J0IGdlbmVFeHByZXNzaW9uRXNzZW50aWFscyBmcm9tICcuLi8uLi8uLi9nZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMuanMnO1xyXG5pbXBvcnQgTW90aW9uU3RyYXRlZ3kgZnJvbSAnLi9Nb3Rpb25TdHJhdGVneS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgTUlOX1hZX1ZFTE9DSVRZID0gMjAwOyAvLyBJbiBwaWNvbWV0ZXJzL3NcclxuY29uc3QgTUFYX1hZX1ZFTE9DSVRZID0gNDAwOyAvLyBJbiBwaWNvbWV0ZXJzL3NcclxuY29uc3QgTUlOX1pfVkVMT0NJVFkgPSAwLjM7IC8vIEluIG5vcm1hbGl6ZWQgdW5pdHMgcGVyIHNlY1xyXG5jb25zdCBNQVhfWl9WRUxPQ0lUWSA9IDAuNjsgLy8gSW4gbm9ybWFsaXplZCB1bml0cyBwZXIgc2VjXHJcbmNvbnN0IE1JTl9USU1FX0lOX09ORV9ESVJFQ1RJT04gPSAwLjI1OyAvLyBJbiBzZWNvbmRzLlxyXG5jb25zdCBNQVhfVElNRV9JTl9PTkVfRElSRUNUSU9OID0gMC44OyAvLyBJbiBzZWNvbmRzLlxyXG5cclxuLy8gVmVjdG9yIHVzZWQgZm9yIGludGVybWVkaWF0ZSBjYWxjdWxhdGlvbnMgLSBBZGRlZCB0byBhdm9pZCBleGNlc3NpdmUgY3JlYXRpb24gb2YgVmVjdG9yMyBpbnN0YW5jZXMgLSBBc2hyYWZcclxuY29uc3QgbmV4dFBvc2l0aW9uM0RTY3JhdGNoVmVjdG9yID0gbmV3IFZlY3RvcjMoIDAsIDAsIDAgKTtcclxuXHJcbmNsYXNzIFJhbmRvbVdhbGtNb3Rpb25TdHJhdGVneSBleHRlbmRzIE1vdGlvblN0cmF0ZWd5IHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eX0gbW90aW9uQm91bmRzUHJvcGVydHlcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbW90aW9uQm91bmRzUHJvcGVydHkgKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gICAgdGhpcy5kaXJlY3Rpb25DaGFuZ2VDb3VudGRvd24gPSAwOyAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5jdXJyZW50TW90aW9uVmVjdG9yMkQgPSBuZXcgVmVjdG9yMiggMCwgMCApOyAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5jdXJyZW50WlZlbG9jaXR5ID0gMDsgLy8gQHByaXZhdGVcclxuXHJcbiAgICBjb25zdCBoYW5kbGVNb3Rpb25Cb3VuZHNDaGFuZ2VkID0gbW90aW9uQm91bmRzID0+IHtcclxuICAgICAgdGhpcy5tb3Rpb25Cb3VuZHMgPSBtb3Rpb25Cb3VuZHM7XHJcbiAgICB9O1xyXG5cclxuICAgIG1vdGlvbkJvdW5kc1Byb3BlcnR5LmxpbmsoIGhhbmRsZU1vdGlvbkJvdW5kc0NoYW5nZWQgKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VSYW5kb21XYWxrTW90aW9uU3RyYXRlZ3kgPSAoKSA9PiB7XHJcbiAgICAgIG1vdGlvbkJvdW5kc1Byb3BlcnR5LnVubGluayggaGFuZGxlTW90aW9uQm91bmRzQ2hhbmdlZCApO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBkaXNwb3NlKCkge1xyXG4gICAgdGhpcy5kaXNwb3NlUmFuZG9tV2Fsa01vdGlvblN0cmF0ZWd5KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBAcGFyYW0ge1ZlY3RvcjJ9IGN1cnJlbnRQb3NpdGlvblxyXG4gICAqIEBwYXJhbSB7Qm91bmRzMn0gYm91bmRzXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGR0XHJcbiAgICogQHJldHVybnMge1ZlY3RvcjJ9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGdldE5leHRQb3NpdGlvbiggY3VycmVudFBvc2l0aW9uLCBib3VuZHMsIGR0ICkge1xyXG4gICAgbmV4dFBvc2l0aW9uM0RTY3JhdGNoVmVjdG9yLnggPSBjdXJyZW50UG9zaXRpb24ueDtcclxuICAgIG5leHRQb3NpdGlvbjNEU2NyYXRjaFZlY3Rvci55ID0gY3VycmVudFBvc2l0aW9uLnk7XHJcbiAgICBuZXh0UG9zaXRpb24zRFNjcmF0Y2hWZWN0b3IueiA9IDA7XHJcbiAgICBjb25zdCBwb3NpdGlvbjNEID0gdGhpcy5nZXROZXh0UG9zaXRpb24zRCggbmV4dFBvc2l0aW9uM0RTY3JhdGNoVmVjdG9yLCBib3VuZHMsIGR0ICk7XHJcbiAgICByZXR1cm4gbmV3IFZlY3RvcjIoIHBvc2l0aW9uM0QueCwgcG9zaXRpb24zRC55ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZ2VuZXJhdGVEaXJlY3Rpb25DaGFuZ2VDb3VudGRvd25WYWx1ZSgpIHtcclxuICAgIHJldHVybiBNSU5fVElNRV9JTl9PTkVfRElSRUNUSU9OICsgZG90UmFuZG9tLm5leHREb3VibGUoKSAqXHJcbiAgICAgICAgICAgKCBNQVhfVElNRV9JTl9PTkVfRElSRUNUSU9OIC0gTUlOX1RJTUVfSU5fT05FX0RJUkVDVElPTiApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICogQHBhcmFtIHtWZWN0b3IzfSBjdXJyZW50UG9zaXRpb25cclxuICAgKiBAcGFyYW0ge0JvdW5kczJ9IGJvdW5kc1xyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBkdFxyXG4gICAqIEByZXR1cm5zIHtWZWN0b3IzfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBnZXROZXh0UG9zaXRpb24zRCggY3VycmVudFBvc2l0aW9uLCBib3VuZHMsIGR0ICkge1xyXG4gICAgdGhpcy5kaXJlY3Rpb25DaGFuZ2VDb3VudGRvd24gLT0gZHQ7XHJcbiAgICBpZiAoIHRoaXMuZGlyZWN0aW9uQ2hhbmdlQ291bnRkb3duIDw9IDAgKSB7XHJcblxyXG4gICAgICAvLyBUaW1lIHRvIGNoYW5nZSBkaXJlY3Rpb24uXHJcbiAgICAgIGNvbnN0IG5ld1hZVmVsb2NpdHkgPSBNSU5fWFlfVkVMT0NJVFkgKyBkb3RSYW5kb20ubmV4dERvdWJsZSgpICogKCBNQVhfWFlfVkVMT0NJVFkgLSBNSU5fWFlfVkVMT0NJVFkgKTtcclxuICAgICAgY29uc3QgbmV3WFlBbmdsZSA9IE1hdGguUEkgKiAyICogZG90UmFuZG9tLm5leHREb3VibGUoKTtcclxuICAgICAgdGhpcy5jdXJyZW50TW90aW9uVmVjdG9yMkQgPSBWZWN0b3IyLmNyZWF0ZVBvbGFyKCBuZXdYWVZlbG9jaXR5LCBuZXdYWUFuZ2xlICk7XHJcbiAgICAgIHRoaXMuY3VycmVudFpWZWxvY2l0eSA9IE1JTl9aX1ZFTE9DSVRZICsgZG90UmFuZG9tLm5leHREb3VibGUoKSAqICggTUFYX1pfVkVMT0NJVFkgLSBNSU5fWl9WRUxPQ0lUWSApO1xyXG4gICAgICB0aGlzLmN1cnJlbnRaVmVsb2NpdHkgPSBkb3RSYW5kb20ubmV4dEJvb2xlYW4oKSA/IC10aGlzLmN1cnJlbnRaVmVsb2NpdHkgOiB0aGlzLmN1cnJlbnRaVmVsb2NpdHk7XHJcblxyXG4gICAgICAvLyBSZXNldCB0aGUgY291bnRkb3duIHRpbWVyLlxyXG4gICAgICB0aGlzLmRpcmVjdGlvbkNoYW5nZUNvdW50ZG93biA9IHRoaXMuZ2VuZXJhdGVEaXJlY3Rpb25DaGFuZ2VDb3VudGRvd25WYWx1ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGN1cnJlbnQgbW90aW9uIHdpbGwgbm90IGNhdXNlIHRoZSBtb2RlbCBlbGVtZW50IHRvIG1vdmUgb3V0c2lkZSBvZiB0aGUgbW90aW9uIGJvdW5kcy5cclxuICAgIGlmICggIXRoaXMubW90aW9uQm91bmRzLnRlc3RJZkluTW90aW9uQm91bmRzV2l0aERlbHRhKCBib3VuZHMsIHRoaXMuY3VycmVudE1vdGlvblZlY3RvcjJELCBkdCApICkge1xyXG5cclxuICAgICAgLy8gVGhlIGN1cnJlbnQgbW90aW9uIHZlY3RvciB3b3VsZCB0YWtlIHRoaXMgZWxlbWVudCBvdXQgb2YgYm91bmRzLCBzbyBpdCBuZWVkcyB0byBcImJvdW5jZVwiLlxyXG4gICAgICB0aGlzLmN1cnJlbnRNb3Rpb25WZWN0b3IyRCA9IHRoaXMuZ2V0TW90aW9uVmVjdG9yRm9yQm91bmNlKCBib3VuZHMsIHRoaXMuY3VycmVudE1vdGlvblZlY3RvcjJELCBkdCwgTUFYX1hZX1ZFTE9DSVRZICk7XHJcblxyXG4gICAgICAvLyBSZXNldCB0aGUgdGltZXIuXHJcbiAgICAgIHRoaXMuZGlyZWN0aW9uQ2hhbmdlQ291bnRkb3duID0gdGhpcy5nZW5lcmF0ZURpcmVjdGlvbkNoYW5nZUNvdW50ZG93blZhbHVlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVG8gcHJldmVudCBvZGQtbG9va2luZyBzaXR1YXRpb25zLCB0aGUgWiBkaXJlY3Rpb24gaXMgbGltaXRlZCBzbyB0aGF0IGJpb21vbGVjdWxlcyBkb24ndCBhcHBlYXIgdHJhbnNwYXJlbnRcclxuICAgIC8vIHdoZW4gb24gdG9wIG9mIHRoZSBETkEgbW9sZWN1bGUuXHJcbiAgICBjb25zdCBtaW5aID0gdGhpcy5nZXRNaW5aKCBib3VuZHMsIGN1cnJlbnRQb3NpdGlvbiApO1xyXG5cclxuICAgIC8vIENhbGN1bGF0ZSB0aGUgbmV4dCBwb3NpdGlvbiBiYXNlZCBvbiBjdXJyZW50IG1vdGlvbi5cclxuICAgIHJldHVybiBuZXcgVmVjdG9yMyhcclxuICAgICAgY3VycmVudFBvc2l0aW9uLnggKyB0aGlzLmN1cnJlbnRNb3Rpb25WZWN0b3IyRC54ICogZHQsXHJcbiAgICAgIGN1cnJlbnRQb3NpdGlvbi55ICsgdGhpcy5jdXJyZW50TW90aW9uVmVjdG9yMkQueSAqIGR0LFxyXG4gICAgICBVdGlscy5jbGFtcCggY3VycmVudFBvc2l0aW9uLnogKyB0aGlzLmN1cnJlbnRaVmVsb2NpdHkgKiBkdCwgbWluWiwgMCApXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzLnJlZ2lzdGVyKCAnUmFuZG9tV2Fsa01vdGlvblN0cmF0ZWd5JywgUmFuZG9tV2Fsa01vdGlvblN0cmF0ZWd5ICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBSYW5kb21XYWxrTW90aW9uU3RyYXRlZ3k7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFNBQVMsTUFBTSxvQ0FBb0M7QUFDMUQsT0FBT0MsS0FBSyxNQUFNLGdDQUFnQztBQUNsRCxPQUFPQyxPQUFPLE1BQU0sa0NBQWtDO0FBQ3RELE9BQU9DLE9BQU8sTUFBTSxrQ0FBa0M7QUFDdEQsT0FBT0Msd0JBQXdCLE1BQU0sc0NBQXNDO0FBQzNFLE9BQU9DLGNBQWMsTUFBTSxxQkFBcUI7O0FBRWhEO0FB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