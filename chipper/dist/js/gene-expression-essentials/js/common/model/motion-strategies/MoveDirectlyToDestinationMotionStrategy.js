// Copyright 2015-2020, University of Colorado Boulder

/**
 * A motion strategy that moves directly to the specified destination
 * @author John Blanco
 * @author Mohamed Safi
 * @author Aadish Gupta
 */

import Utils from '../../../../../dot/js/Utils.js';
import Vector2 from '../../../../../dot/js/Vector2.js';
import Vector3 from '../../../../../dot/js/Vector3.js';
import geneExpressionEssentials from '../../../geneExpressionEssentials.js';
import MotionStrategy from './MotionStrategy.js';

// constants
const MAX_Z_VELOCITY = 10; // Max Z velocity in normalized units.

class MoveDirectlyToDestinationMotionStrategy extends MotionStrategy {
  /**
   * @param {Property} destinationProperty
   * @param {Property} motionBoundsProperty
   * @param {Vector2} destinationOffset
   * @param {number} velocity
   */
  constructor(destinationProperty, motionBoundsProperty, destinationOffset, velocity) {
    super();
    const handleMotionBoundsChanged = motionBounds => {
      this.motionBounds = motionBounds;
    };
    motionBoundsProperty.link(handleMotionBoundsChanged);
    this.disposeMoveDirectlyToDestinationMotionStrategy = () => {
      motionBoundsProperty.unlink(handleMotionBoundsChanged);
    };
    this.velocityVector2D = new Vector2(0, 0); // @private

    // Destination to which this motion strategy moves. Note that it is potentially a moving target.
    this.destinationProperty = destinationProperty; // @private

    // Fixed offset from the destination position property used when computing the actual target destination. This is
    // useful in cases where something needs to move such that some point that is not its center is positioned at the
    // destination.
    this.offsetFromDestination = destinationOffset; //@private

    // Scalar velocity with which the controlled item travels.
    this.scalarVelocity2D = velocity; //@private
  }

  /**
   * @override
   * @public
   */
  dispose() {
    this.disposeMoveDirectlyToDestinationMotionStrategy();
  }

  /**
   * @override
   * @param {Vector2} currentPosition
   * @param {Bounds2} bounds
   * @param {number} dt
   * @returns {Vector2}
   * @public
   */
  getNextPosition(currentPosition, bounds, dt) {
    const nextPosition3D = this.getNextPosition3D(new Vector3(currentPosition.x, currentPosition.y, 0), bounds, dt);
    return new Vector2(nextPosition3D.x, nextPosition3D.y);
  }

  /**
   * @param {Vector2} currentPosition
   * @param {Vector2} destination
   * @param {number} velocity
   * @private
   */
  updateVelocityVector2D(currentPosition, destination, velocity) {
    if (currentPosition.distance(destination) === 0) {
      this.velocityVector2D.setXY(0, 0);
    } else {
      this.velocityVector2D.set(destination.minus(currentPosition).setMagnitude(velocity));
    }
  }

  /**
   * @override
   * @param {Vector3} currentPosition3D
   * @param {Bounds2} bounds
   * @param {number} dt
   * @returns {Vector3}
   * @public
   */
  getNextPosition3D(currentPosition3D, bounds, dt) {
    // destination is assumed to always have a Z value of 0, i.e. at the "surface"
    const currentDestination3D = new Vector3(this.destinationProperty.get().x - this.offsetFromDestination.x, this.destinationProperty.get().y - this.offsetFromDestination.y, 0);
    const currentDestination2D = new Vector2(this.destinationProperty.get().x - this.offsetFromDestination.x, this.destinationProperty.get().y - this.offsetFromDestination.y);
    const currentPosition2D = new Vector2(currentPosition3D.x, currentPosition3D.y);
    this.updateVelocityVector2D(currentPosition2D, new Vector2(currentDestination3D.x, currentDestination3D.y), this.scalarVelocity2D);

    // make the Z velocity such that the front (i.e. z = 0) will be reached at the same time as the destination in XY
    // space
    const distanceToDestination2D = currentPosition2D.distance(this.destinationProperty.get());
    let zVelocity;
    if (distanceToDestination2D > 0) {
      zVelocity = Math.min(Math.abs(currentPosition3D.z) / (currentPosition2D.distance(this.destinationProperty.get()) / this.scalarVelocity2D), MAX_Z_VELOCITY);
    } else {
      zVelocity = MAX_Z_VELOCITY;
    }

    // make sure that the current motion won't move the model element past the destination
    const distanceToDestination = currentPosition2D.distance(currentDestination2D);
    if (this.velocityVector2D.magnitude * dt > distanceToDestination) {
      return currentDestination3D;
    }

    // calculate the next position based on the motion vector
    return new Vector3(currentPosition3D.x + this.velocityVector2D.x * dt, currentPosition3D.y + this.velocityVector2D.y * dt, Utils.clamp(currentPosition3D.z + zVelocity * dt, -1, 0));
  }
}
geneExpressionEssentials.register('MoveDirectlyToDestinationMotionStrategy', MoveDirectlyToDestinationMotionStrategy);
export default MoveDirectlyToDestinationMotionStrategy;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlZlY3RvcjIiLCJWZWN0b3IzIiwiZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzIiwiTW90aW9uU3RyYXRlZ3kiLCJNQVhfWl9WRUxPQ0lUWSIsIk1vdmVEaXJlY3RseVRvRGVzdGluYXRpb25Nb3Rpb25TdHJhdGVneSIsImNvbnN0cnVjdG9yIiwiZGVzdGluYXRpb25Qcm9wZXJ0eSIsIm1vdGlvbkJvdW5kc1Byb3BlcnR5IiwiZGVzdGluYXRpb25PZmZzZXQiLCJ2ZWxvY2l0eSIsImhhbmRsZU1vdGlvbkJvdW5kc0NoYW5nZWQiLCJtb3Rpb25Cb3VuZHMiLCJsaW5rIiwiZGlzcG9zZU1vdmVEaXJlY3RseVRvRGVzdGluYXRpb25Nb3Rpb25TdHJhdGVneSIsInVubGluayIsInZlbG9jaXR5VmVjdG9yMkQiLCJvZmZzZXRGcm9tRGVzdGluYXRpb24iLCJzY2FsYXJWZWxvY2l0eTJEIiwiZGlzcG9zZSIsImdldE5leHRQb3NpdGlvbiIsImN1cnJlbnRQb3NpdGlvbiIsImJvdW5kcyIsImR0IiwibmV4dFBvc2l0aW9uM0QiLCJnZXROZXh0UG9zaXRpb24zRCIsIngiLCJ5IiwidXBkYXRlVmVsb2NpdHlWZWN0b3IyRCIsImRlc3RpbmF0aW9uIiwiZGlzdGFuY2UiLCJzZXRYWSIsInNldCIsIm1pbnVzIiwic2V0TWFnbml0dWRlIiwiY3VycmVudFBvc2l0aW9uM0QiLCJjdXJyZW50RGVzdGluYXRpb24zRCIsImdldCIsImN1cnJlbnREZXN0aW5hdGlvbjJEIiwiY3VycmVudFBvc2l0aW9uMkQiLCJkaXN0YW5jZVRvRGVzdGluYXRpb24yRCIsInpWZWxvY2l0eSIsIk1hdGgiLCJtaW4iLCJhYnMiLCJ6IiwiZGlzdGFuY2VUb0Rlc3RpbmF0aW9uIiwibWFnbml0dWRlIiwiY2xhbXAiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIk1vdmVEaXJlY3RseVRvRGVzdGluYXRpb25Nb3Rpb25TdHJhdGVneS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNS0yMDIwLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBIG1vdGlvbiBzdHJhdGVneSB0aGF0IG1vdmVzIGRpcmVjdGx5IHRvIHRoZSBzcGVjaWZpZWQgZGVzdGluYXRpb25cclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKiBAYXV0aG9yIE1vaGFtZWQgU2FmaVxyXG4gKiBAYXV0aG9yIEFhZGlzaCBHdXB0YVxyXG4gKi9cclxuXHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBWZWN0b3IzIGZyb20gJy4uLy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IzLmpzJztcclxuaW1wb3J0IGdlbmVFeHByZXNzaW9uRXNzZW50aWFscyBmcm9tICcuLi8uLi8uLi9nZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMuanMnO1xyXG5pbXBvcnQgTW90aW9uU3RyYXRlZ3kgZnJvbSAnLi9Nb3Rpb25TdHJhdGVneS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgTUFYX1pfVkVMT0NJVFkgPSAxMDsgLy8gTWF4IFogdmVsb2NpdHkgaW4gbm9ybWFsaXplZCB1bml0cy5cclxuXHJcbmNsYXNzIE1vdmVEaXJlY3RseVRvRGVzdGluYXRpb25Nb3Rpb25TdHJhdGVneSBleHRlbmRzIE1vdGlvblN0cmF0ZWd5IHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eX0gZGVzdGluYXRpb25Qcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHl9IG1vdGlvbkJvdW5kc1Byb3BlcnR5XHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBkZXN0aW5hdGlvbk9mZnNldFxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB2ZWxvY2l0eVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBkZXN0aW5hdGlvblByb3BlcnR5LCBtb3Rpb25Cb3VuZHNQcm9wZXJ0eSwgZGVzdGluYXRpb25PZmZzZXQsIHZlbG9jaXR5ICkge1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgY29uc3QgaGFuZGxlTW90aW9uQm91bmRzQ2hhbmdlZCA9IG1vdGlvbkJvdW5kcyA9PiB7XHJcbiAgICAgIHRoaXMubW90aW9uQm91bmRzID0gbW90aW9uQm91bmRzO1xyXG4gICAgfTtcclxuXHJcbiAgICBtb3Rpb25Cb3VuZHNQcm9wZXJ0eS5saW5rKCBoYW5kbGVNb3Rpb25Cb3VuZHNDaGFuZ2VkICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlTW92ZURpcmVjdGx5VG9EZXN0aW5hdGlvbk1vdGlvblN0cmF0ZWd5ID0gKCkgPT4ge1xyXG4gICAgICBtb3Rpb25Cb3VuZHNQcm9wZXJ0eS51bmxpbmsoIGhhbmRsZU1vdGlvbkJvdW5kc0NoYW5nZWQgKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy52ZWxvY2l0eVZlY3RvcjJEID0gbmV3IFZlY3RvcjIoIDAsIDAgKTsgLy8gQHByaXZhdGVcclxuXHJcbiAgICAvLyBEZXN0aW5hdGlvbiB0byB3aGljaCB0aGlzIG1vdGlvbiBzdHJhdGVneSBtb3Zlcy4gTm90ZSB0aGF0IGl0IGlzIHBvdGVudGlhbGx5IGEgbW92aW5nIHRhcmdldC5cclxuICAgIHRoaXMuZGVzdGluYXRpb25Qcm9wZXJ0eSA9IGRlc3RpbmF0aW9uUHJvcGVydHk7IC8vIEBwcml2YXRlXHJcblxyXG4gICAgLy8gRml4ZWQgb2Zmc2V0IGZyb20gdGhlIGRlc3RpbmF0aW9uIHBvc2l0aW9uIHByb3BlcnR5IHVzZWQgd2hlbiBjb21wdXRpbmcgdGhlIGFjdHVhbCB0YXJnZXQgZGVzdGluYXRpb24uIFRoaXMgaXNcclxuICAgIC8vIHVzZWZ1bCBpbiBjYXNlcyB3aGVyZSBzb21ldGhpbmcgbmVlZHMgdG8gbW92ZSBzdWNoIHRoYXQgc29tZSBwb2ludCB0aGF0IGlzIG5vdCBpdHMgY2VudGVyIGlzIHBvc2l0aW9uZWQgYXQgdGhlXHJcbiAgICAvLyBkZXN0aW5hdGlvbi5cclxuICAgIHRoaXMub2Zmc2V0RnJvbURlc3RpbmF0aW9uID0gZGVzdGluYXRpb25PZmZzZXQ7IC8vQHByaXZhdGVcclxuXHJcbiAgICAvLyBTY2FsYXIgdmVsb2NpdHkgd2l0aCB3aGljaCB0aGUgY29udHJvbGxlZCBpdGVtIHRyYXZlbHMuXHJcbiAgICB0aGlzLnNjYWxhclZlbG9jaXR5MkQgPSB2ZWxvY2l0eTsgLy9AcHJpdmF0ZVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGRpc3Bvc2UoKSB7XHJcbiAgICB0aGlzLmRpc3Bvc2VNb3ZlRGlyZWN0bHlUb0Rlc3RpbmF0aW9uTW90aW9uU3RyYXRlZ3koKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqIEBwYXJhbSB7VmVjdG9yMn0gY3VycmVudFBvc2l0aW9uXHJcbiAgICogQHBhcmFtIHtCb3VuZHMyfSBib3VuZHNcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHRcclxuICAgKiBAcmV0dXJucyB7VmVjdG9yMn1cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZ2V0TmV4dFBvc2l0aW9uKCBjdXJyZW50UG9zaXRpb24sIGJvdW5kcywgZHQgKSB7XHJcbiAgICBjb25zdCBuZXh0UG9zaXRpb24zRCA9IHRoaXMuZ2V0TmV4dFBvc2l0aW9uM0QoIG5ldyBWZWN0b3IzKCBjdXJyZW50UG9zaXRpb24ueCwgY3VycmVudFBvc2l0aW9uLnksIDAgKSwgYm91bmRzLCBkdCApO1xyXG4gICAgcmV0dXJuIG5ldyBWZWN0b3IyKCBuZXh0UG9zaXRpb24zRC54LCBuZXh0UG9zaXRpb24zRC55ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1ZlY3RvcjJ9IGN1cnJlbnRQb3NpdGlvblxyXG4gICAqIEBwYXJhbSB7VmVjdG9yMn0gZGVzdGluYXRpb25cclxuICAgKiBAcGFyYW0ge251bWJlcn0gdmVsb2NpdHlcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIHVwZGF0ZVZlbG9jaXR5VmVjdG9yMkQoIGN1cnJlbnRQb3NpdGlvbiwgZGVzdGluYXRpb24sIHZlbG9jaXR5ICkge1xyXG4gICAgaWYgKCBjdXJyZW50UG9zaXRpb24uZGlzdGFuY2UoIGRlc3RpbmF0aW9uICkgPT09IDAgKSB7XHJcbiAgICAgIHRoaXMudmVsb2NpdHlWZWN0b3IyRC5zZXRYWSggMCwgMCApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMudmVsb2NpdHlWZWN0b3IyRC5zZXQoIGRlc3RpbmF0aW9uLm1pbnVzKCBjdXJyZW50UG9zaXRpb24gKS5zZXRNYWduaXR1ZGUoIHZlbG9jaXR5ICkgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBvdmVycmlkZVxyXG4gICAqIEBwYXJhbSB7VmVjdG9yM30gY3VycmVudFBvc2l0aW9uM0RcclxuICAgKiBAcGFyYW0ge0JvdW5kczJ9IGJvdW5kc1xyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBkdFxyXG4gICAqIEByZXR1cm5zIHtWZWN0b3IzfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBnZXROZXh0UG9zaXRpb24zRCggY3VycmVudFBvc2l0aW9uM0QsIGJvdW5kcywgZHQgKSB7XHJcblxyXG4gICAgLy8gZGVzdGluYXRpb24gaXMgYXNzdW1lZCB0byBhbHdheXMgaGF2ZSBhIFogdmFsdWUgb2YgMCwgaS5lLiBhdCB0aGUgXCJzdXJmYWNlXCJcclxuICAgIGNvbnN0IGN1cnJlbnREZXN0aW5hdGlvbjNEID0gbmV3IFZlY3RvcjMoXHJcbiAgICAgIHRoaXMuZGVzdGluYXRpb25Qcm9wZXJ0eS5nZXQoKS54IC0gdGhpcy5vZmZzZXRGcm9tRGVzdGluYXRpb24ueCxcclxuICAgICAgdGhpcy5kZXN0aW5hdGlvblByb3BlcnR5LmdldCgpLnkgLSB0aGlzLm9mZnNldEZyb21EZXN0aW5hdGlvbi55LFxyXG4gICAgICAwXHJcbiAgICApO1xyXG4gICAgY29uc3QgY3VycmVudERlc3RpbmF0aW9uMkQgPSBuZXcgVmVjdG9yMihcclxuICAgICAgdGhpcy5kZXN0aW5hdGlvblByb3BlcnR5LmdldCgpLnggLSB0aGlzLm9mZnNldEZyb21EZXN0aW5hdGlvbi54LFxyXG4gICAgICB0aGlzLmRlc3RpbmF0aW9uUHJvcGVydHkuZ2V0KCkueSAtIHRoaXMub2Zmc2V0RnJvbURlc3RpbmF0aW9uLnlcclxuICAgICk7XHJcbiAgICBjb25zdCBjdXJyZW50UG9zaXRpb24yRCA9IG5ldyBWZWN0b3IyKCBjdXJyZW50UG9zaXRpb24zRC54LCBjdXJyZW50UG9zaXRpb24zRC55ICk7XHJcbiAgICB0aGlzLnVwZGF0ZVZlbG9jaXR5VmVjdG9yMkQoXHJcbiAgICAgIGN1cnJlbnRQb3NpdGlvbjJELFxyXG4gICAgICBuZXcgVmVjdG9yMiggY3VycmVudERlc3RpbmF0aW9uM0QueCwgY3VycmVudERlc3RpbmF0aW9uM0QueSApLFxyXG4gICAgICB0aGlzLnNjYWxhclZlbG9jaXR5MkRcclxuICAgICk7XHJcblxyXG4gICAgLy8gbWFrZSB0aGUgWiB2ZWxvY2l0eSBzdWNoIHRoYXQgdGhlIGZyb250IChpLmUuIHogPSAwKSB3aWxsIGJlIHJlYWNoZWQgYXQgdGhlIHNhbWUgdGltZSBhcyB0aGUgZGVzdGluYXRpb24gaW4gWFlcclxuICAgIC8vIHNwYWNlXHJcbiAgICBjb25zdCBkaXN0YW5jZVRvRGVzdGluYXRpb24yRCA9IGN1cnJlbnRQb3NpdGlvbjJELmRpc3RhbmNlKCB0aGlzLmRlc3RpbmF0aW9uUHJvcGVydHkuZ2V0KCkgKTtcclxuICAgIGxldCB6VmVsb2NpdHk7XHJcbiAgICBpZiAoIGRpc3RhbmNlVG9EZXN0aW5hdGlvbjJEID4gMCApIHtcclxuICAgICAgelZlbG9jaXR5ID0gTWF0aC5taW4oXHJcbiAgICAgICAgTWF0aC5hYnMoIGN1cnJlbnRQb3NpdGlvbjNELnogKSAvICggY3VycmVudFBvc2l0aW9uMkQuZGlzdGFuY2UoIHRoaXMuZGVzdGluYXRpb25Qcm9wZXJ0eS5nZXQoKSApIC8gdGhpcy5zY2FsYXJWZWxvY2l0eTJEICksXHJcbiAgICAgICAgTUFYX1pfVkVMT0NJVFlcclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB6VmVsb2NpdHkgPSBNQVhfWl9WRUxPQ0lUWTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgY3VycmVudCBtb3Rpb24gd29uJ3QgbW92ZSB0aGUgbW9kZWwgZWxlbWVudCBwYXN0IHRoZSBkZXN0aW5hdGlvblxyXG4gICAgY29uc3QgZGlzdGFuY2VUb0Rlc3RpbmF0aW9uID0gY3VycmVudFBvc2l0aW9uMkQuZGlzdGFuY2UoIGN1cnJlbnREZXN0aW5hdGlvbjJEICk7XHJcbiAgICBpZiAoIHRoaXMudmVsb2NpdHlWZWN0b3IyRC5tYWduaXR1ZGUgKiBkdCA+IGRpc3RhbmNlVG9EZXN0aW5hdGlvbiApIHtcclxuICAgICAgcmV0dXJuIGN1cnJlbnREZXN0aW5hdGlvbjNEO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGNhbGN1bGF0ZSB0aGUgbmV4dCBwb3NpdGlvbiBiYXNlZCBvbiB0aGUgbW90aW9uIHZlY3RvclxyXG4gICAgcmV0dXJuIG5ldyBWZWN0b3IzKFxyXG4gICAgICBjdXJyZW50UG9zaXRpb24zRC54ICsgdGhpcy52ZWxvY2l0eVZlY3RvcjJELnggKiBkdCxcclxuICAgICAgY3VycmVudFBvc2l0aW9uM0QueSArIHRoaXMudmVsb2NpdHlWZWN0b3IyRC55ICogZHQsXHJcbiAgICAgIFV0aWxzLmNsYW1wKCBjdXJyZW50UG9zaXRpb24zRC56ICsgelZlbG9jaXR5ICogZHQsIC0xLCAwIClcclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5nZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMucmVnaXN0ZXIoICdNb3ZlRGlyZWN0bHlUb0Rlc3RpbmF0aW9uTW90aW9uU3RyYXRlZ3knLCBNb3ZlRGlyZWN0bHlUb0Rlc3RpbmF0aW9uTW90aW9uU3RyYXRlZ3kgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IE1vdmVEaXJlY3RseVRvRGVzdGluYXRpb25Nb3Rpb25TdHJhdGVneTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsS0FBSyxNQUFNLGdDQUFnQztBQUNsRCxPQUFPQyxPQUFPLE1BQU0sa0NBQWtDO0FBQ3RELE9BQU9DLE9BQU8sTUFBTSxrQ0FBa0M7QUFDdEQsT0FBT0Msd0JBQXdCLE1BQU0sc0NBQXNDO0FBQzNFLE9BQU9DLGNBQWMsTUFBTSxxQkFBcUI7O0FBRWhEO0FBQ0EsTUFBTUMsY0FBYyxHQUFHLEVBQUUsQ0FBQyxDQUFDOztBQUUzQixNQUFNQyx1Q0FBdUMsU0FBU0YsY0FBYyxDQUFDO0VBRW5FO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFRyxXQUFXQSxDQUFFQyxtQkFBbUIsRUFBRUMsb0JBQW9CLEVBQUVDLGlCQUFpQixFQUFFQyxRQUFRLEVBQUc7SUFFcEYsS0FBSyxDQUFDLENBQUM7SUFFUCxNQUFNQyx5QkFBeUIsR0FBR0MsWUFBWSxJQUFJO01BQ2hELElBQUksQ0FBQ0EsWUFBWSxHQUFHQSxZQUFZO0lBQ2xDLENBQUM7SUFFREosb0JBQW9CLENBQUNLLElBQUksQ0FBRUYseUJBQTBCLENBQUM7SUFFdEQsSUFBSSxDQUFDRyw4Q0FBOEMsR0FBRyxNQUFNO01BQzFETixvQkFBb0IsQ0FBQ08sTUFBTSxDQUFFSix5QkFBMEIsQ0FBQztJQUMxRCxDQUFDO0lBRUQsSUFBSSxDQUFDSyxnQkFBZ0IsR0FBRyxJQUFJaEIsT0FBTyxDQUFFLENBQUMsRUFBRSxDQUFFLENBQUMsQ0FBQyxDQUFDOztJQUU3QztJQUNBLElBQUksQ0FBQ08sbUJBQW1CLEdBQUdBLG1CQUFtQixDQUFDLENBQUM7O0lBRWhEO0lBQ0E7SUFDQTtJQUNBLElBQUksQ0FBQ1UscUJBQXFCLEdBQUdSLGlCQUFpQixDQUFDLENBQUM7O0lB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