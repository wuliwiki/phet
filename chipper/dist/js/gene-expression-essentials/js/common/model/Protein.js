// Copyright 2015-2021, University of Colorado Boulder

/**
 * Base class for proteins. Defines the methods used for growing a protein.
 *
 * @author John Blanco
 * @author Mohamed Safi
 * @author Aadish Gupta
 */

//modules
import Property from '../../../../axon/js/Property.js';
import geneExpressionEssentials from '../../geneExpressionEssentials.js';
import GenericUnattachedAndAvailableState from './attachment-state-machines/GenericUnattachedAndAvailableState.js';
import ProteinAttachmentStateMachine from './attachment-state-machines/ProteinAttachmentStateMachine.js';
import MobileBiomolecule from './MobileBiomolecule.js';

// constants
const MAX_GROWTH_FACTOR = 1; // Max value for the growth factor, indicates that it is fully grown.

class Protein extends MobileBiomolecule {
  /**
   * @param {GeneExpressionModel} model
   * @param {Shape} initialShape
   * @param {Color} baseColor
   */
  constructor(model, initialShape, baseColor) {
    super(model, initialShape, baseColor);

    // Property that gets set when this protein is fully formed and released.
    this.fullGrownProperty = new Property(false); // @public(read-only)

    // A value between 0 and 1 that defines how fully developed, or "grown"  this protein is.
    this.fullSizeProportion = 0; // @private
  }

  /**
   * @override
   * Create the attachment state machine that will govern the way in which this biomolecule attaches to and detaches
   * from other biomolecules.
   * @returns {ProteinAttachmentStateMachine}
   * @public
   */
  createAttachmentStateMachine() {
    return new ProteinAttachmentStateMachine(this);
  }

  /**
   * Set the size of this protein by specifying the proportion of its full size.
   * @param {number} proportion - Value between 0 and 1 indicating the proportion of this protein's fully grown size
   * @public
   */
  setFullSizeProportion(proportion) {
    assert && assert(proportion >= 0 && proportion <= 1, `proportion value out of range: ${proportion}`);
    if (this.fullSizeProportion !== proportion) {
      this.fullSizeProportion = proportion;
      this.shapeProperty.set(this.getScaledShape(proportion));

      // force an update of the fill
      this.colorProperty.notifyListenersStatic();
    }
  }

  /**
   * @returns {number}
   * @public
   */
  getFullSizeProportion() {
    return this.fullSizeProportion;
  }

  /**
   * @param {number} growthFactor
   * @protected
   */
  getScaledShape(growthFactor) {
    throw new Error('getScaledShape should be implemented in descendant classes of Protein');
  }

  /**
   * Method to get an untranslated (in terms of position, not language) version of this protein's shape when it fully
   * grown. This is intended for use in creating control panel shapes that match this protein's shape.
   *
   * @returns {Shape} representing the fully developed protein.
   * @public
   */
  getFullyGrownShape() {
    return this.getScaledShape(MAX_GROWTH_FACTOR);
  }

  /**
   * @public
   */
  createInstance() {
    throw new Error('createInstance should be implemented in descendant classes of Protein');
  }

  /**
   * Release this protein from the ribosome and allow it to drift around in the cell.
   * @public
   */
  release() {
    this.attachmentStateMachine.setState(new GenericUnattachedAndAvailableState());
    this.fullGrownProperty.set(true);
  }

  /**
   * Set the position of this protein such that its "attachment point", which is the point from which it grows when it
   * is being synthesized, is at the specified position.
   *
   * @param attachmentPointPosition
   * @public
   */
  setAttachmentPointPosition(attachmentPointPosition) {
    throw new Error('setAttachmentPointPosition should be implemented in descendant classes of Protein');
  }
}
geneExpressionEssentials.register('Protein', Protein);
export default Protein;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsImdlbmVFeHByZXNzaW9uRXNzZW50aWFscyIsIkdlbmVyaWNVbmF0dGFjaGVkQW5kQXZhaWxhYmxlU3RhdGUiLCJQcm90ZWluQXR0YWNobWVudFN0YXRlTWFjaGluZSIsIk1vYmlsZUJpb21vbGVjdWxlIiwiTUFYX0dST1dUSF9GQUNUT1IiLCJQcm90ZWluIiwiY29uc3RydWN0b3IiLCJtb2RlbCIsImluaXRpYWxTaGFwZSIsImJhc2VDb2xvciIsImZ1bGxHcm93blByb3BlcnR5IiwiZnVsbFNpemVQcm9wb3J0aW9uIiwiY3JlYXRlQXR0YWNobWVudFN0YXRlTWFjaGluZSIsInNldEZ1bGxTaXplUHJvcG9ydGlvbiIsInByb3BvcnRpb24iLCJhc3NlcnQiLCJzaGFwZVByb3BlcnR5Iiwic2V0IiwiZ2V0U2NhbGVkU2hhcGUiLCJjb2xvclByb3BlcnR5Iiwibm90aWZ5TGlzdGVuZXJzU3RhdGljIiwiZ2V0RnVsbFNpemVQcm9wb3J0aW9uIiwiZ3Jvd3RoRmFjdG9yIiwiRXJyb3IiLCJnZXRGdWxseUdyb3duU2hhcGUiLCJjcmVhdGVJbnN0YW5jZSIsInJlbGVhc2UiLCJhdHRhY2htZW50U3RhdGVNYWNoaW5lIiwic2V0U3RhdGUiLCJzZXRBdHRhY2htZW50UG9pbnRQb3NpdGlvbiIsImF0dGFjaG1lbnRQb2ludFBvc2l0aW9uIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQcm90ZWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjEsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEJhc2UgY2xhc3MgZm9yIHByb3RlaW5zLiBEZWZpbmVzIHRoZSBtZXRob2RzIHVzZWQgZm9yIGdyb3dpbmcgYSBwcm90ZWluLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvXHJcbiAqIEBhdXRob3IgTW9oYW1lZCBTYWZpXHJcbiAqIEBhdXRob3IgQWFkaXNoIEd1cHRhXHJcbiAqL1xyXG5cclxuXHJcbi8vbW9kdWxlc1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBnZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMgZnJvbSAnLi4vLi4vZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzLmpzJztcclxuaW1wb3J0IEdlbmVyaWNVbmF0dGFjaGVkQW5kQXZhaWxhYmxlU3RhdGUgZnJvbSAnLi9hdHRhY2htZW50LXN0YXRlLW1hY2hpbmVzL0dlbmVyaWNVbmF0dGFjaGVkQW5kQXZhaWxhYmxlU3RhdGUuanMnO1xyXG5pbXBvcnQgUHJvdGVpbkF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUgZnJvbSAnLi9hdHRhY2htZW50LXN0YXRlLW1hY2hpbmVzL1Byb3RlaW5BdHRhY2htZW50U3RhdGVNYWNoaW5lLmpzJztcclxuaW1wb3J0IE1vYmlsZUJpb21vbGVjdWxlIGZyb20gJy4vTW9iaWxlQmlvbW9sZWN1bGUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE1BWF9HUk9XVEhfRkFDVE9SID0gMTsgLy8gTWF4IHZhbHVlIGZvciB0aGUgZ3Jvd3RoIGZhY3RvciwgaW5kaWNhdGVzIHRoYXQgaXQgaXMgZnVsbHkgZ3Jvd24uXHJcblxyXG5jbGFzcyBQcm90ZWluIGV4dGVuZHMgTW9iaWxlQmlvbW9sZWN1bGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0dlbmVFeHByZXNzaW9uTW9kZWx9IG1vZGVsXHJcbiAgICogQHBhcmFtIHtTaGFwZX0gaW5pdGlhbFNoYXBlXHJcbiAgICogQHBhcmFtIHtDb2xvcn0gYmFzZUNvbG9yXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1vZGVsLCBpbml0aWFsU2hhcGUsIGJhc2VDb2xvciApIHtcclxuICAgIHN1cGVyKCBtb2RlbCwgaW5pdGlhbFNoYXBlLCBiYXNlQ29sb3IgKTtcclxuXHJcbiAgICAvLyBQcm9wZXJ0eSB0aGF0IGdldHMgc2V0IHdoZW4gdGhpcyBwcm90ZWluIGlzIGZ1bGx5IGZvcm1lZCBhbmQgcmVsZWFzZWQuXHJcbiAgICB0aGlzLmZ1bGxHcm93blByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBmYWxzZSApOyAvLyBAcHVibGljKHJlYWQtb25seSlcclxuXHJcbiAgICAvLyBBIHZhbHVlIGJldHdlZW4gMCBhbmQgMSB0aGF0IGRlZmluZXMgaG93IGZ1bGx5IGRldmVsb3BlZCwgb3IgXCJncm93blwiICB0aGlzIHByb3RlaW4gaXMuXHJcbiAgICB0aGlzLmZ1bGxTaXplUHJvcG9ydGlvbiA9IDA7IC8vIEBwcml2YXRlXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBDcmVhdGUgdGhlIGF0dGFjaG1lbnQgc3RhdGUgbWFjaGluZSB0aGF0IHdpbGwgZ292ZXJuIHRoZSB3YXkgaW4gd2hpY2ggdGhpcyBiaW9tb2xlY3VsZSBhdHRhY2hlcyB0byBhbmQgZGV0YWNoZXNcclxuICAgKiBmcm9tIG90aGVyIGJpb21vbGVjdWxlcy5cclxuICAgKiBAcmV0dXJucyB7UHJvdGVpbkF0dGFjaG1lbnRTdGF0ZU1hY2hpbmV9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNyZWF0ZUF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUoKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb3RlaW5BdHRhY2htZW50U3RhdGVNYWNoaW5lKCB0aGlzICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIHNpemUgb2YgdGhpcyBwcm90ZWluIGJ5IHNwZWNpZnlpbmcgdGhlIHByb3BvcnRpb24gb2YgaXRzIGZ1bGwgc2l6ZS5cclxuICAgKiBAcGFyYW0ge251bWJlcn0gcHJvcG9ydGlvbiAtIFZhbHVlIGJldHdlZW4gMCBhbmQgMSBpbmRpY2F0aW5nIHRoZSBwcm9wb3J0aW9uIG9mIHRoaXMgcHJvdGVpbidzIGZ1bGx5IGdyb3duIHNpemVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc2V0RnVsbFNpemVQcm9wb3J0aW9uKCBwcm9wb3J0aW9uICkge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggcHJvcG9ydGlvbiA+PSAwICYmIHByb3BvcnRpb24gPD0gMSwgYHByb3BvcnRpb24gdmFsdWUgb3V0IG9mIHJhbmdlOiAke3Byb3BvcnRpb259YCApO1xyXG4gICAgaWYgKCB0aGlzLmZ1bGxTaXplUHJvcG9ydGlvbiAhPT0gcHJvcG9ydGlvbiApIHtcclxuICAgICAgdGhpcy5mdWxsU2l6ZVByb3BvcnRpb24gPSBwcm9wb3J0aW9uO1xyXG4gICAgICB0aGlzLnNoYXBlUHJvcGVydHkuc2V0KCB0aGlzLmdldFNjYWxlZFNoYXBlKCBwcm9wb3J0aW9uICkgKTtcclxuXHJcbiAgICAgIC8vIGZvcmNlIGFuIHVwZGF0ZSBvZiB0aGUgZmlsbFxyXG4gICAgICB0aGlzLmNvbG9yUHJvcGVydHkubm90aWZ5TGlzdGVuZXJzU3RhdGljKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBnZXRGdWxsU2l6ZVByb3BvcnRpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5mdWxsU2l6ZVByb3BvcnRpb247XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZ3Jvd3RoRmFjdG9yXHJcbiAgICogQHByb3RlY3RlZFxyXG4gICAqL1xyXG4gIGdldFNjYWxlZFNoYXBlKCBncm93dGhGYWN0b3IgKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoICdnZXRTY2FsZWRTaGFwZSBzaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gZGVzY2VuZGFudCBjbGFzc2VzIG9mIFByb3RlaW4nICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNZXRob2QgdG8gZ2V0IGFuIHVudHJhbnNsYXRlZCAoaW4gdGVybXMgb2YgcG9zaXRpb24sIG5vdCBsYW5ndWFnZSkgdmVyc2lvbiBvZiB0aGlzIHByb3RlaW4ncyBzaGFwZSB3aGVuIGl0IGZ1bGx5XHJcbiAgICogZ3Jvd24uIFRoaXMgaXMgaW50ZW5kZWQgZm9yIHVzZSBpbiBjcmVhdGluZyBjb250cm9sIHBhbmVsIHNoYXBlcyB0aGF0IG1hdGNoIHRoaXMgcHJvdGVpbidzIHNoYXBlLlxyXG4gICAqXHJcbiAgICogQHJldHVybnMge1NoYXBlfSByZXByZXNlbnRpbmcgdGhlIGZ1bGx5IGRldmVsb3BlZCBwcm90ZWluLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBnZXRGdWxseUdyb3duU2hhcGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRTY2FsZWRTaGFwZSggTUFYX0dST1dUSF9GQUNUT1IgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBjcmVhdGVJbnN0YW5jZSgpIHtcclxuICAgIHRocm93IG5ldyBFcnJvciggJ2NyZWF0ZUluc3RhbmNlIHNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBkZXNjZW5kYW50IGNsYXNzZXMgb2YgUHJvdGVpbicgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbGVhc2UgdGhpcyBwcm90ZWluIGZyb20gdGhlIHJpYm9zb21lIGFuZCBhbGxvdyBpdCB0byBkcmlmdCBhcm91bmQgaW4gdGhlIGNlbGwuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHJlbGVhc2UoKSB7XHJcbiAgICB0aGlzLmF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUuc2V0U3RhdGUoIG5ldyBHZW5lcmljVW5hdHRhY2hlZEFuZEF2YWlsYWJsZVN0YXRlKCkgKTtcclxuICAgIHRoaXMuZnVsbEdyb3duUHJvcGVydHkuc2V0KCB0cnVlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIHBvc2l0aW9uIG9mIHRoaXMgcHJvdGVpbiBzdWNoIHRoYXQgaXRzIFwiYXR0YWNobWVudCBwb2ludFwiLCB3aGljaCBpcyB0aGUgcG9pbnQgZnJvbSB3aGljaCBpdCBncm93cyB3aGVuIGl0XHJcbiAgICogaXMgYmVpbmcgc3ludGhlc2l6ZWQsIGlzIGF0IHRoZSBzcGVjaWZpZWQgcG9zaXRpb24uXHJcbiAgICpcclxuICAgKiBAcGFyYW0gYXR0YWNobWVudFBvaW50UG9zaXRpb25cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc2V0QXR0YWNobWVudFBvaW50UG9zaXRpb24oIGF0dGFjaG1lbnRQb2ludFBvc2l0aW9uICkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCAnc2V0QXR0YWNobWVudFBvaW50UG9zaXRpb24gc2hvdWxkIGJlIGltcGxlbWVudGVkIGluIGRlc2NlbmRhbnQgY2xhc3NlcyBvZiBQcm90ZWluJyApO1xyXG4gIH1cclxufVxyXG5cclxuZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzLnJlZ2lzdGVyKCAnUHJvdGVpbicsIFByb3RlaW4gKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFByb3RlaW47Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFHQTtBQUNBLE9BQU9BLFFBQVEsTUFBTSxpQ0FBaUM7QUFDdEQsT0FBT0Msd0JBQXdCLE1BQU0sbUNBQW1DO0FBQ3hFLE9BQU9DLGtDQUFrQyxNQUFNLG1FQUFtRTtBQUNsSCxPQUFPQyw2QkFBNkIsTUFBTSw4REFBOEQ7QUFDeEcsT0FBT0MsaUJBQWlCLE1BQU0sd0JBQXdCOztBQUV0RDtBQUNBLE1BQU1DLGlCQUFpQixHQUFHLENBQUMsQ0FBQyxDQUFDOztBQUU3QixNQUFNQyxPQUFPLFNBQVNGLGlCQUFpQixDQUFDO0VBRXRDO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRUcsV0FBV0EsQ0FBRUMsS0FBSyxFQUFFQyxZQUFZLEVBQUVDLFNBQVMsRUFBRztJQUM1QyxLQUFLLENBQUVGLEtBQUssRUFBRUMsWUFBWSxFQUFFQyxTQUFVLENBQUM7O0lBRXZDO0lBQ0EsSUFBSSxDQUFDQyxpQkFBaUIsR0FBRyxJQUFJWCxRQUFRLENBQUUsS0FBTSxDQUFDLENBQUMsQ0FBQzs7SUFFaEQ7SUFDQSxJQUFJLENBQUNZLGtCQUFrQixHQUFHLENBQUMsQ0FBQyxDQUFDO0VBQy9COztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLDRCQUE0QkEsQ0FBQSxFQUFHO0lBQzdCLE9BQU8sSUFBSVYsNkJBQTZCLENBQUUsSUFBSyxDQUFDO0VBQ2xEOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRVcscUJBQXFCQSxDQUFFQyxVQUFVLEVBQUc7SUFDbENDLE1BQU0sSUFBSUEsTUFBTSxDQUFFRCxVQUFVLElBQUksQ0FBQyxJQUFJQSxVQUFVLElBQUksQ0FBQyxFQUFHLGtDQUFpQ0EsVUFBVyxFQUFFLENBQUM7SUFDdEcsSUFBSyxJQUFJLENBQUNILGtCQUFrQixLQUFLRyxVQUFVLEVBQUc7TUFDNUMsSUFBSSxDQUFDSCxrQkFBa0IsR0FBR0csVUFBVTtNQUNwQyxJQUFJLENBQUNFLGFBQWEsQ0FBQ0MsR0FBRyxDQUFFLElBQUksQ0FBQ0MsY0FBYyxDQUFFSixVQUFXLENBQUUsQ0FBQzs7TUFFM0Q7TUFDQSxJQUFJLENBQUNLLGFBQWEsQ0FBQ0MscUJBQXFCLENBQUMsQ0FBQztJQUM1QztFQUNGOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0VBQ0VDLHFCQUFxQkEsQ0FBQSxFQUFHO0lBQ3RCLE9BQU8sSUFBSSxDQUFDVixrQkFBa0I7RUFDaEM7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7RUFDRU8sY0FBY0EsQ0FBRUksWUFBWSxFQUFHO0lBQzdCLE1BQU0sSUFBSUMsS0FBSyxDQUFFLHVFQUF3RSxDQUFDO0VBQzVGOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLGtCQUFrQkEsQ0FBQSxFQUFHO0lBQ25CLE9BQU8sSUFBSSxDQUFDTixjQUFjLENBQUVkLGlCQUFrQixDQUFDO0VBQ2pEOztFQUVBO0FBQ0Y7QUFDQTtFQUNFcUIsY0FBY0EsQ0FBQSxFQUFHO0lBQ2YsTUFBTSxJQUFJRixLQUFLLENBQUUsdUVBQXdFLENBQUM7RUFDNUY7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7RUFDRUcsT0FBT0EsQ0FBQSxFQUFHO0lBQ1IsSUFBSSxDQUFDQyxzQkFBc0IsQ0FBQ0MsUUFBUSxDQUFFLElBQUkzQixrQ0FBa0MsQ0FBQyxDQUFFLENBQUM7SUFDaEYsSUFBSSxDQUFDUyxpQkFBaUIsQ0FBQ08sR0FBRyxDQUFFLElBQUssQ0FBQztFQUNwQzs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFWSwwQkFBMEJBLENBQUVDLHVCQUF1QixFQUFHO0lBQ3BELE1BQU0sSUFBSVAsS0FBSyxDQUFFLG1GQUFvRixDQUFDO0VBQ3hHO0FBQ0Y7QUFFQXZCLHdCQUF3QixDQUFDK0IsUUFBUSxDQUFFLFNBQVMsRUFBRTFCLE9BQVEsQ0FBQztBQUV2RCxlQUFlQSxPQUFPIn0=