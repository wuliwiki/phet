// Copyright 2015-2020, University of Colorado Boulder

/**
 * Base class for the attachment state machines that define how the various biomolecules attach to one another, how they
 * detach from one another, how they find other biomolecules to attach to, and so forth.
 *
 * @author John Blanco
 * @author Mohamed Safi
 * @author Aadish Gupta
 */

import Vector2 from '../../../../../dot/js/Vector2.js';
import geneExpressionEssentials from '../../../geneExpressionEssentials.js';
class AttachmentStateMachine {
  /**
   * @abstract class
   * @param {MobileBiomolecule} biomolecule
   */
  constructor(biomolecule) {
    // Reference to the biomolecule controlled by this state machine.
    this.biomolecule = biomolecule; //@public

    // Attachment site. When this is non-null, the biomolecule is either attached to this point or moving towards
    // attachment with it.
    this.attachmentSite = null; //@public

    // Current attachment state. Changes with each state transition.
    this.attachmentState = null; //@public

    // Offset to use when moving towards attachment sites. This is used when the molecule attaches to an attachment site
    // at some position other than its geometric center.
    this.destinationOffset = new Vector2(0, 0); //@public
  }

  /**
   * Step function for the attachment state machine, which in turn calls the step function of attachment state
   * @param {number} dt
   * @public
   */
  step(dt) {
    // Step the current state in time.
    this.attachmentState.step(this, dt);
  }

  /**
   * Find out if the biomolecule using this state machine is currently attached to anything (i.e. another biomolecule).
   * @returns {boolean} true if attached to something, false if not.
   * @public
   */
  isAttached() {
    return this.attachmentSite !== null && this.attachmentSite.isMoleculeAttached();
  }

  /**
   * Find out if the biomolecule using this state machine is currently moving towards attachment with another molecule.
   * @returns {boolean} true if moving towards attachment, false if already attached or if no attachment is pending.
   * @public
   */
  isMovingTowardAttachment() {
    return this.attachmentSite !== null && !this.attachmentSite.isMoleculeAttached();
  }

  /**
   * Detach the biomolecule from any current attachments. This will cause the molecule to go into the
   * unattached-but-unavailable state for some period of time, after which it will become available again.
   * @public
   */
  detach() {
    throw new Error('detach should be implemented in descendant classes of AttachmentStateMachine .');
  }

  /**
   * Move immediately into the unattached-and-available state. This is generally done only when the user has grabbed
   * the associated molecule. Calling this when already in this state is harmless.
   * @public
   */
  forceImmediateUnattachedAndAvailable() {
    throw new Error(' forceImmediateUnattachedAndAvailable should be implemented in descendant classes of AttachmentStateMachine .');
  }

  /**
   * Move immediately into the unattached-but-unavailable state. This is generally done only when the user has released
   * the associated molecule in a place where it needs to move away.
   * @public
   */
  forceImmediateUnattachedButUnavailable() {
    throw new Error(' forceImmediateUnattachedButUnavailable should be implemented in descendant classes of AttachmentStateMachine .');
  }

  /**
   * Set a new attachment state. This calls the "entered" method of the attachment state, so this should be used
   * instead of directly setting the state.
   * @param {AttachmentState} attachmentState
   * @public
   */
  setState(attachmentState) {
    this.attachmentState = attachmentState;
    this.attachmentState.entered(this);
  }

  /**
   * Sets the destination offset for the biomolecule
   * @param {Vector2} offset
   * @protected
   */
  setDestinationOffset(offset) {
    this.destinationOffset.setXY(offset.x, offset.y);
  }
}
geneExpressionEssentials.register('AttachmentStateMachine', AttachmentStateMachine);
export default AttachmentStateMachine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzIiwiQXR0YWNobWVudFN0YXRlTWFjaGluZSIsImNvbnN0cnVjdG9yIiwiYmlvbW9sZWN1bGUiLCJhdHRhY2htZW50U2l0ZSIsImF0dGFjaG1lbnRTdGF0ZSIsImRlc3RpbmF0aW9uT2Zmc2V0Iiwic3RlcCIsImR0IiwiaXNBdHRhY2hlZCIsImlzTW9sZWN1bGVBdHRhY2hlZCIsImlzTW92aW5nVG93YXJkQXR0YWNobWVudCIsImRldGFjaCIsIkVycm9yIiwiZm9yY2VJbW1lZGlhdGVVbmF0dGFjaGVkQW5kQXZhaWxhYmxlIiwiZm9yY2VJbW1lZGlhdGVVbmF0dGFjaGVkQnV0VW5hdmFpbGFibGUiLCJzZXRTdGF0ZSIsImVudGVyZWQiLCJzZXREZXN0aW5hdGlvbk9mZnNldCIsIm9mZnNldCIsInNldFhZIiwieCIsInkiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTUtMjAyMCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQmFzZSBjbGFzcyBmb3IgdGhlIGF0dGFjaG1lbnQgc3RhdGUgbWFjaGluZXMgdGhhdCBkZWZpbmUgaG93IHRoZSB2YXJpb3VzIGJpb21vbGVjdWxlcyBhdHRhY2ggdG8gb25lIGFub3RoZXIsIGhvdyB0aGV5XHJcbiAqIGRldGFjaCBmcm9tIG9uZSBhbm90aGVyLCBob3cgdGhleSBmaW5kIG90aGVyIGJpb21vbGVjdWxlcyB0byBhdHRhY2ggdG8sIGFuZCBzbyBmb3J0aC5cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKiBAYXV0aG9yIE1vaGFtZWQgU2FmaVxyXG4gKiBAYXV0aG9yIEFhZGlzaCBHdXB0YVxyXG4gKi9cclxuXHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IGdlbmVFeHByZXNzaW9uRXNzZW50aWFscyBmcm9tICcuLi8uLi8uLi9nZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMuanMnO1xyXG5cclxuY2xhc3MgQXR0YWNobWVudFN0YXRlTWFjaGluZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBhYnN0cmFjdCBjbGFzc1xyXG4gICAqIEBwYXJhbSB7TW9iaWxlQmlvbW9sZWN1bGV9IGJpb21vbGVjdWxlXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGJpb21vbGVjdWxlICkge1xyXG5cclxuICAgIC8vIFJlZmVyZW5jZSB0byB0aGUgYmlvbW9sZWN1bGUgY29udHJvbGxlZCBieSB0aGlzIHN0YXRlIG1hY2hpbmUuXHJcbiAgICB0aGlzLmJpb21vbGVjdWxlID0gYmlvbW9sZWN1bGU7IC8vQHB1YmxpY1xyXG5cclxuICAgIC8vIEF0dGFjaG1lbnQgc2l0ZS4gV2hlbiB0aGlzIGlzIG5vbi1udWxsLCB0aGUgYmlvbW9sZWN1bGUgaXMgZWl0aGVyIGF0dGFjaGVkIHRvIHRoaXMgcG9pbnQgb3IgbW92aW5nIHRvd2FyZHNcclxuICAgIC8vIGF0dGFjaG1lbnQgd2l0aCBpdC5cclxuICAgIHRoaXMuYXR0YWNobWVudFNpdGUgPSBudWxsOyAvL0BwdWJsaWNcclxuXHJcbiAgICAvLyBDdXJyZW50IGF0dGFjaG1lbnQgc3RhdGUuIENoYW5nZXMgd2l0aCBlYWNoIHN0YXRlIHRyYW5zaXRpb24uXHJcbiAgICB0aGlzLmF0dGFjaG1lbnRTdGF0ZSA9IG51bGw7IC8vQHB1YmxpY1xyXG5cclxuICAgIC8vIE9mZnNldCB0byB1c2Ugd2hlbiBtb3ZpbmcgdG93YXJkcyBhdHRhY2htZW50IHNpdGVzLiBUaGlzIGlzIHVzZWQgd2hlbiB0aGUgbW9sZWN1bGUgYXR0YWNoZXMgdG8gYW4gYXR0YWNobWVudCBzaXRlXHJcbiAgICAvLyBhdCBzb21lIHBvc2l0aW9uIG90aGVyIHRoYW4gaXRzIGdlb21ldHJpYyBjZW50ZXIuXHJcbiAgICB0aGlzLmRlc3RpbmF0aW9uT2Zmc2V0ID0gbmV3IFZlY3RvcjIoIDAsIDAgKTsgLy9AcHVibGljXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdGVwIGZ1bmN0aW9uIGZvciB0aGUgYXR0YWNobWVudCBzdGF0ZSBtYWNoaW5lLCB3aGljaCBpbiB0dXJuIGNhbGxzIHRoZSBzdGVwIGZ1bmN0aW9uIG9mIGF0dGFjaG1lbnQgc3RhdGVcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHRcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc3RlcCggZHQgKSB7XHJcbiAgICAvLyBTdGVwIHRoZSBjdXJyZW50IHN0YXRlIGluIHRpbWUuXHJcbiAgICB0aGlzLmF0dGFjaG1lbnRTdGF0ZS5zdGVwKCB0aGlzLCBkdCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmluZCBvdXQgaWYgdGhlIGJpb21vbGVjdWxlIHVzaW5nIHRoaXMgc3RhdGUgbWFjaGluZSBpcyBjdXJyZW50bHkgYXR0YWNoZWQgdG8gYW55dGhpbmcgKGkuZS4gYW5vdGhlciBiaW9tb2xlY3VsZSkuXHJcbiAgICogQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgYXR0YWNoZWQgdG8gc29tZXRoaW5nLCBmYWxzZSBpZiBub3QuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGlzQXR0YWNoZWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5hdHRhY2htZW50U2l0ZSAhPT0gbnVsbCAmJiB0aGlzLmF0dGFjaG1lbnRTaXRlLmlzTW9sZWN1bGVBdHRhY2hlZCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmluZCBvdXQgaWYgdGhlIGJpb21vbGVjdWxlIHVzaW5nIHRoaXMgc3RhdGUgbWFjaGluZSBpcyBjdXJyZW50bHkgbW92aW5nIHRvd2FyZHMgYXR0YWNobWVudCB3aXRoIGFub3RoZXIgbW9sZWN1bGUuXHJcbiAgICogQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgbW92aW5nIHRvd2FyZHMgYXR0YWNobWVudCwgZmFsc2UgaWYgYWxyZWFkeSBhdHRhY2hlZCBvciBpZiBubyBhdHRhY2htZW50IGlzIHBlbmRpbmcuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGlzTW92aW5nVG93YXJkQXR0YWNobWVudCgpIHtcclxuICAgIHJldHVybiB0aGlzLmF0dGFjaG1lbnRTaXRlICE9PSBudWxsICYmICF0aGlzLmF0dGFjaG1lbnRTaXRlLmlzTW9sZWN1bGVBdHRhY2hlZCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGV0YWNoIHRoZSBiaW9tb2xlY3VsZSBmcm9tIGFueSBjdXJyZW50IGF0dGFjaG1lbnRzLiBUaGlzIHdpbGwgY2F1c2UgdGhlIG1vbGVjdWxlIHRvIGdvIGludG8gdGhlXHJcbiAgICogdW5hdHRhY2hlZC1idXQtdW5hdmFpbGFibGUgc3RhdGUgZm9yIHNvbWUgcGVyaW9kIG9mIHRpbWUsIGFmdGVyIHdoaWNoIGl0IHdpbGwgYmVjb21lIGF2YWlsYWJsZSBhZ2Fpbi5cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZGV0YWNoKCkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCAnZGV0YWNoIHNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBkZXNjZW5kYW50IGNsYXNzZXMgb2YgQXR0YWNobWVudFN0YXRlTWFjaGluZSAuJyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTW92ZSBpbW1lZGlhdGVseSBpbnRvIHRoZSB1bmF0dGFjaGVkLWFuZC1hdmFpbGFibGUgc3RhdGUuIFRoaXMgaXMgZ2VuZXJhbGx5IGRvbmUgb25seSB3aGVuIHRoZSB1c2VyIGhhcyBncmFiYmVkXHJcbiAgICogdGhlIGFzc29jaWF0ZWQgbW9sZWN1bGUuIENhbGxpbmcgdGhpcyB3aGVuIGFscmVhZHkgaW4gdGhpcyBzdGF0ZSBpcyBoYXJtbGVzcy5cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZm9yY2VJbW1lZGlhdGVVbmF0dGFjaGVkQW5kQXZhaWxhYmxlKCkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCAnIGZvcmNlSW1tZWRpYXRlVW5hdHRhY2hlZEFuZEF2YWlsYWJsZSBzaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gZGVzY2VuZGFudCBjbGFzc2VzIG9mIEF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUgLicgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1vdmUgaW1tZWRpYXRlbHkgaW50byB0aGUgdW5hdHRhY2hlZC1idXQtdW5hdmFpbGFibGUgc3RhdGUuIFRoaXMgaXMgZ2VuZXJhbGx5IGRvbmUgb25seSB3aGVuIHRoZSB1c2VyIGhhcyByZWxlYXNlZFxyXG4gICAqIHRoZSBhc3NvY2lhdGVkIG1vbGVjdWxlIGluIGEgcGxhY2Ugd2hlcmUgaXQgbmVlZHMgdG8gbW92ZSBhd2F5LlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBmb3JjZUltbWVkaWF0ZVVuYXR0YWNoZWRCdXRVbmF2YWlsYWJsZSgpIHtcclxuICAgIHRocm93IG5ldyBFcnJvciggJyBmb3JjZUltbWVkaWF0ZVVuYXR0YWNoZWRCdXRVbmF2YWlsYWJsZSBzaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gZGVzY2VuZGFudCBjbGFzc2VzIG9mIEF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUgLicgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCBhIG5ldyBhdHRhY2htZW50IHN0YXRlLiBUaGlzIGNhbGxzIHRoZSBcImVudGVyZWRcIiBtZXRob2Qgb2YgdGhlIGF0dGFjaG1lbnQgc3RhdGUsIHNvIHRoaXMgc2hvdWxkIGJlIHVzZWRcclxuICAgKiBpbnN0ZWFkIG9mIGRpcmVjdGx5IHNldHRpbmcgdGhlIHN0YXRlLlxyXG4gICAqIEBwYXJhbSB7QXR0YWNobWVudFN0YXRlfSBhdHRhY2htZW50U3RhdGVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc2V0U3RhdGUoIGF0dGFjaG1lbnRTdGF0ZSApIHtcclxuICAgIHRoaXMuYXR0YWNobWVudFN0YXRlID0gYXR0YWNobWVudFN0YXRlO1xyXG4gICAgdGhpcy5hdHRhY2htZW50U3RhdGUuZW50ZXJlZCggdGhpcyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgZGVzdGluYXRpb24gb2Zmc2V0IGZvciB0aGUgYmlvbW9sZWN1bGVcclxuICAgKiBAcGFyYW0ge1ZlY3RvcjJ9IG9mZnNldFxyXG4gICAqIEBwcm90ZWN0ZWRcclxuICAgKi9cclxuICBzZXREZXN0aW5hdGlvbk9mZnNldCggb2Zmc2V0ICkge1xyXG4gICAgdGhpcy5kZXN0aW5hdGlvbk9mZnNldC5zZXRYWSggb2Zmc2V0LngsIG9mZnNldC55ICk7XHJcbiAgfVxyXG59XHJcblxyXG5nZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMucmVnaXN0ZXIoICdBdHRhY2htZW50U3RhdGVNYWNoaW5lJywgQXR0YWNobWVudFN0YXRlTWFjaGluZSApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgQXR0YWNobWVudFN0YXRlTWFjaGluZTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE9BQU8sTUFBTSxrQ0FBa0M7QUFDdEQsT0FBT0Msd0JBQXdCLE1BQU0sc0NBQXNDO0FBRTNFLE1BQU1DLHNCQUFzQixDQUFDO0VBRTNCO0FBQ0Y7QUFDQTtBQUNBO0VBQ0VDLFdBQVdBLENBQUVDLFdBQVcsRUFBRztJQUV6QjtJQUNBLElBQUksQ0FBQ0EsV0FBVyxHQUFHQSxXQUFXLENBQUMsQ0FBQzs7SUFFaEM7SUFDQTtJQUNBLElBQUksQ0FBQ0MsY0FBYyxHQUFHLElBQUksQ0FBQyxDQUFDOztJQUU1QjtJQUNBLElBQUksQ0FBQ0MsZUFBZSxHQUFHLElBQUksQ0FBQyxDQUFDOztJQUU3QjtJQUNBO0lBQ0EsSUFBSSxDQUFDQyxpQkFBaUIsR0FBRyxJQUFJUCxPQUFPLENBQUUsQ0FBQyxFQUFFLENBQUUsQ0FBQyxDQUFDLENBQUM7RUFDaEQ7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNFUSxJQUFJQSxDQUFFQyxFQUFFLEVBQUc7SUFDVDtJQUNBLElBQUksQ0FBQ0gsZUFBZSxDQUFDRSxJQUFJLENBQUUsSUFBSSxFQUFFQyxFQUFHLENBQUM7RUFDdkM7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNFQyxVQUFVQSxDQUFBLEVBQUc7SUFDWCxPQUFPLElBQUksQ0FBQ0wsY0FBYyxLQUFLLElBQUksSUFBSSxJQUFJLENBQUNBLGNBQWMsQ0FBQ00sa0JBQWtCLENBQUMsQ0FBQztFQUNqRjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLHdCQUF3QkEsQ0FBQSxFQUFHO0lBQ3pCLE9BQU8sSUFBSSxDQUFDUCxjQUFjLEtBQUssSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDQSxjQUFjLENBQUNNLGtCQUFrQixDQUFDLENBQUM7RUFDbEY7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNFRSxNQUFNQSxDQUFBLEVBQUc7SUFDUCxNQUFNLElBQUlDLEtBQUssQ0FBRSxnRkFBaUYsQ0FBQztFQUNyRzs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLG9DQUFvQ0EsQ0FBQSxFQUFHO0lBQ3JDLE1BQU0sSUFBSUQsS0FBSyxDQUFFLCtHQUFnSCxDQUFDO0VBQ3BJOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRUUsc0NBQXNDQSxDQUFBLEVBQUc7SUFDdkMsTUFBTSxJQUFJRixLQUFLLENBQUUsaUhBQWtILENBQUM7RUFDdEk7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VHLFFBQVFBLENBQUVYLGVBQWUsRUFBRztJQUMxQixJQUFJLENBQUNBLGVBQWUsR0FBR0EsZUFBZTtJQUN0QyxJQUFJLENBQUNBLGVBQWUsQ0FBQ1ksT0FBTyxDQUFFLElBQUssQ0FBQztFQUN0Qzs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLG9CQUFvQkEsQ0FBRUMsTUFBTSxFQUFHO0lBQzdCLElBQUksQ0FBQ2IsaUJBQWlCLENBQUNjLEtBQUssQ0FBRUQsTUFBTSxDQUFDRSxDQUFDLEVBQUVGLE1BQU0sQ0FBQ0csQ0FBRSxDQUFDO0VBQ3BEO0FBQ0Y7QUFFQXRCLHdCQUF3QixDQUFDdUIsUUFBUSxDQUFFLHdCQUF3QixFQUFFdEIsc0JBQXVCLENBQUM7QUFFckYsZUFBZUEsc0JBQXNCIn0=