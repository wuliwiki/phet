// Copyright 2015-2020, University of Colorado Boulder

/**
 * Attachment state machine for all RNA Polymerase molecules. This uses the generic behavior for all but the "attached"
 * state, and has several sub-states for the attached site.  See the code for details.
 *
 * @author John Blanco
 * @author Mohamed Safi
 * @author Aadish Gupta
 */

import Property from '../../../../../axon/js/Property.js';
import Vector2 from '../../../../../dot/js/Vector2.js';
import geneExpressionEssentials from '../../../geneExpressionEssentials.js';
import AttachmentSite from '../AttachmentSite.js';
import DnaSeparation from '../DnaSeparation.js';
import AttachedAndConformingState from './AttachedAndConformingState.js';
import AttachedAndDeconformingState from './AttachedAndDeconformingState.js';
import AttachedAndTranscribingState from './AttachedAndTranscribingState.js';
import AttachedToDnaNotTranscribingState from './AttachedToDnaNotTranscribingState.js';
import GenericAttachmentStateMachine from './GenericAttachmentStateMachine.js';

// constants
const HALF_LIFE_FOR_HALF_AFFINITY = 1.5; // In seconds.  Half-life of attachment to a site with affinity of 0.5.

class RnaPolymeraseAttachmentStateMachine extends GenericAttachmentStateMachine {
  /**
   * @param {RnaPolymerase} rnaPolymerase
   */
  constructor(rnaPolymerase) {
    super(rnaPolymerase);
    this.attachedAndWanderingState = new AttachedToDnaNotTranscribingState(this); //@public
    this.attachedAndConformingState = new AttachedAndConformingState(this); //@public
    this.attachedAndTranscribingState = new AttachedAndTranscribingState(this); //@public
    this.attachedAndDeconformingState = new AttachedAndDeconformingState(this); //@public

    // RNA polymerase that is being controlled by this state machine.
    this.rnaPolymerase = rnaPolymerase; //@public

    // Set up a new "attached" state, since the behavior is different from the default.
    this.attachedState = this.attachedAndWanderingState; //@public

    // Separator used to deform the DNA strand when the RNA polymerase is transcribing it.
    //@public
    this.dnaStrandSeparation = new DnaSeparation(rnaPolymerase.getPosition().x, rnaPolymerase.bounds.getHeight() * 0.9);

    // This attachment site is used by the state machine to get the polymerase something to attach to when transcribing.
    // This is a bit hokey, but was a lot easier than trying to move to each and every base pair in the DNA strand.
    //@public
    this.transcribingAttachmentSite = new AttachmentSite(rnaPolymerase, new Vector2(0, 0), 1);

    // Threshold for the detachment algorithm, used in deciding whether or not to detach completely from the DNA at a
    // given time step.
    //@public
    this.detachFromDnaThreshold = new Property(1.0);

    // A flag that tracks whether this state machine should use the "recycle mode", which causes the polymerase to
    // return to some new position once it has completed transcription.
    //@public
    this.recycleMode = false;

    //@public
    this.recycleReturnZones = [];

    // Initialize the attachment site used when transcribing.
    this.transcribingAttachmentSite.attachedOrAttachingMoleculeProperty.set(rnaPolymerase);
  }

  /**
   * this override makes sure that the polymerase has returned to its normal shape before detaching from DNA
   * @override
   * @public
   */
  forceImmediateUnattachedAndAvailable() {
    if (this.attachmentState === this.attachedAndDeconformingState) {
      this.attachmentState.detachFromDna();
    }
    super.forceImmediateUnattachedAndAvailable();
  }

  /**
   * @param {boolean} recycleMode
   * @public
   */
  setRecycleMode(recycleMode) {
    this.recycleMode = recycleMode;
  }

  /**
   * @param {Bounds2} recycleReturnZone
   * @public
   */
  addRecycleReturnZone(recycleReturnZone) {
    this.recycleReturnZones.push(recycleReturnZone);
  }

  /**
   * Calculate the probability of detachment from the current base pair during the provided time interval. This uses
   * the same mathematics as is used for calculating probabilities of decay for radioactive atomic nuclei.
   *
   * @param {number} affinity
   * @param {number} dt
   * @returns {number}
   * @public
   */
  calculateProbabilityOfDetachment(affinity, dt) {
    return 1 - Math.exp(-0.693 * dt / this.calculateHalfLifeFromAffinity(affinity));
  }

  /**
   * Map an affinity value to a half life of attachment
   * @param {number} affinity
   * @returns {number}
   * @public
   */
  calculateHalfLifeFromAffinity(affinity) {
    return HALF_LIFE_FOR_HALF_AFFINITY * (affinity / (1 - affinity));
  }

  /**
   * @param p {Vector2}
   * @param boundsList {Array <Rectangle>}
   * @returns {boolean}
   * @public
   */
  pointContainedInBoundsList(p, boundsList) {
    for (let i = 0; i < boundsList.length; i++) {
      const bounds = boundsList[i];
      if (bounds.containsPoint(p)) {
        return true;
      }
    }
    return false;
  }
}
geneExpressionEssentials.register('RnaPolymeraseAttachmentStateMachine', RnaPolymeraseAttachmentStateMachine);
export default RnaPolymeraseAttachmentStateMachine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIlZlY3RvcjIiLCJnZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMiLCJBdHRhY2htZW50U2l0ZSIsIkRuYVNlcGFyYXRpb24iLCJBdHRhY2hlZEFuZENvbmZvcm1pbmdTdGF0ZSIsIkF0dGFjaGVkQW5kRGVjb25mb3JtaW5nU3RhdGUiLCJBdHRhY2hlZEFuZFRyYW5zY3JpYmluZ1N0YXRlIiwiQXR0YWNoZWRUb0RuYU5vdFRyYW5zY3JpYmluZ1N0YXRlIiwiR2VuZXJpY0F0dGFjaG1lbnRTdGF0ZU1hY2hpbmUiLCJIQUxGX0xJRkVfRk9SX0hBTEZfQUZGSU5JVFkiLCJSbmFQb2x5bWVyYXNlQXR0YWNobWVudFN0YXRlTWFjaGluZSIsImNvbnN0cnVjdG9yIiwicm5hUG9seW1lcmFzZSIsImF0dGFjaGVkQW5kV2FuZGVyaW5nU3RhdGUiLCJhdHRhY2hlZEFuZENvbmZvcm1pbmdTdGF0ZSIsImF0dGFjaGVkQW5kVHJhbnNjcmliaW5nU3RhdGUiLCJhdHRhY2hlZEFuZERlY29uZm9ybWluZ1N0YXRlIiwiYXR0YWNoZWRTdGF0ZSIsImRuYVN0cmFuZFNlcGFyYXRpb24iLCJnZXRQb3NpdGlvbiIsIngiLCJib3VuZHMiLCJnZXRIZWlnaHQiLCJ0cmFuc2NyaWJpbmdBdHRhY2htZW50U2l0ZSIsImRldGFjaEZyb21EbmFUaHJlc2hvbGQiLCJyZWN5Y2xlTW9kZSIsInJlY3ljbGVSZXR1cm5ab25lcyIsImF0dGFjaGVkT3JBdHRhY2hpbmdNb2xlY3VsZVByb3BlcnR5Iiwic2V0IiwiZm9yY2VJbW1lZGlhdGVVbmF0dGFjaGVkQW5kQXZhaWxhYmxlIiwiYXR0YWNobWVudFN0YXRlIiwiZGV0YWNoRnJvbURuYSIsInNldFJlY3ljbGVNb2RlIiwiYWRkUmVjeWNsZVJldHVyblpvbmUiLCJyZWN5Y2xlUmV0dXJuWm9uZSIsInB1c2giLCJjYWxjdWxhdGVQcm9iYWJpbGl0eU9mRGV0YWNobWVudCIsImFmZmluaXR5IiwiZHQiLCJNYXRoIiwiZXhwIiwiY2FsY3VsYXRlSGFsZkxpZmVGcm9tQWZmaW5pdHkiLCJwb2ludENvbnRhaW5lZEluQm91bmRzTGlzdCIsInAiLCJib3VuZHNMaXN0IiwiaSIsImxlbmd0aCIsImNvbnRhaW5zUG9pbnQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlJuYVBvbHltZXJhc2VBdHRhY2htZW50U3RhdGVNYWNoaW5lLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjAsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEF0dGFjaG1lbnQgc3RhdGUgbWFjaGluZSBmb3IgYWxsIFJOQSBQb2x5bWVyYXNlIG1vbGVjdWxlcy4gVGhpcyB1c2VzIHRoZSBnZW5lcmljIGJlaGF2aW9yIGZvciBhbGwgYnV0IHRoZSBcImF0dGFjaGVkXCJcclxuICogc3RhdGUsIGFuZCBoYXMgc2V2ZXJhbCBzdWItc3RhdGVzIGZvciB0aGUgYXR0YWNoZWQgc2l0ZS4gIFNlZSB0aGUgY29kZSBmb3IgZGV0YWlscy5cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKiBAYXV0aG9yIE1vaGFtZWQgU2FmaVxyXG4gKiBAYXV0aG9yIEFhZGlzaCBHdXB0YVxyXG4gKi9cclxuXHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzIGZyb20gJy4uLy4uLy4uL2dlbmVFeHByZXNzaW9uRXNzZW50aWFscy5qcyc7XHJcbmltcG9ydCBBdHRhY2htZW50U2l0ZSBmcm9tICcuLi9BdHRhY2htZW50U2l0ZS5qcyc7XHJcbmltcG9ydCBEbmFTZXBhcmF0aW9uIGZyb20gJy4uL0RuYVNlcGFyYXRpb24uanMnO1xyXG5pbXBvcnQgQXR0YWNoZWRBbmRDb25mb3JtaW5nU3RhdGUgZnJvbSAnLi9BdHRhY2hlZEFuZENvbmZvcm1pbmdTdGF0ZS5qcyc7XHJcbmltcG9ydCBBdHRhY2hlZEFuZERlY29uZm9ybWluZ1N0YXRlIGZyb20gJy4vQXR0YWNoZWRBbmREZWNvbmZvcm1pbmdTdGF0ZS5qcyc7XHJcbmltcG9ydCBBdHRhY2hlZEFuZFRyYW5zY3JpYmluZ1N0YXRlIGZyb20gJy4vQXR0YWNoZWRBbmRUcmFuc2NyaWJpbmdTdGF0ZS5qcyc7XHJcbmltcG9ydCBBdHRhY2hlZFRvRG5hTm90VHJhbnNjcmliaW5nU3RhdGUgZnJvbSAnLi9BdHRhY2hlZFRvRG5hTm90VHJhbnNjcmliaW5nU3RhdGUuanMnO1xyXG5pbXBvcnQgR2VuZXJpY0F0dGFjaG1lbnRTdGF0ZU1hY2hpbmUgZnJvbSAnLi9HZW5lcmljQXR0YWNobWVudFN0YXRlTWFjaGluZS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgSEFMRl9MSUZFX0ZPUl9IQUxGX0FGRklOSVRZID0gMS41OyAvLyBJbiBzZWNvbmRzLiAgSGFsZi1saWZlIG9mIGF0dGFjaG1lbnQgdG8gYSBzaXRlIHdpdGggYWZmaW5pdHkgb2YgMC41LlxyXG5cclxuY2xhc3MgUm5hUG9seW1lcmFzZUF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUgZXh0ZW5kcyBHZW5lcmljQXR0YWNobWVudFN0YXRlTWFjaGluZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7Um5hUG9seW1lcmFzZX0gcm5hUG9seW1lcmFzZVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBybmFQb2x5bWVyYXNlICkge1xyXG4gICAgc3VwZXIoIHJuYVBvbHltZXJhc2UgKTtcclxuICAgIHRoaXMuYXR0YWNoZWRBbmRXYW5kZXJpbmdTdGF0ZSA9IG5ldyBBdHRhY2hlZFRvRG5hTm90VHJhbnNjcmliaW5nU3RhdGUoIHRoaXMgKTsgLy9AcHVibGljXHJcbiAgICB0aGlzLmF0dGFjaGVkQW5kQ29uZm9ybWluZ1N0YXRlID0gbmV3IEF0dGFjaGVkQW5kQ29uZm9ybWluZ1N0YXRlKCB0aGlzICk7IC8vQHB1YmxpY1xyXG4gICAgdGhpcy5hdHRhY2hlZEFuZFRyYW5zY3JpYmluZ1N0YXRlID0gbmV3IEF0dGFjaGVkQW5kVHJhbnNjcmliaW5nU3RhdGUoIHRoaXMgKTsgLy9AcHVibGljXHJcbiAgICB0aGlzLmF0dGFjaGVkQW5kRGVjb25mb3JtaW5nU3RhdGUgPSBuZXcgQXR0YWNoZWRBbmREZWNvbmZvcm1pbmdTdGF0ZSggdGhpcyApOyAvL0BwdWJsaWNcclxuXHJcbiAgICAvLyBSTkEgcG9seW1lcmFzZSB0aGF0IGlzIGJlaW5nIGNvbnRyb2xsZWQgYnkgdGhpcyBzdGF0ZSBtYWNoaW5lLlxyXG4gICAgdGhpcy5ybmFQb2x5bWVyYXNlID0gcm5hUG9seW1lcmFzZTsgLy9AcHVibGljXHJcblxyXG4gICAgLy8gU2V0IHVwIGEgbmV3IFwiYXR0YWNoZWRcIiBzdGF0ZSwgc2luY2UgdGhlIGJlaGF2aW9yIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBkZWZhdWx0LlxyXG4gICAgdGhpcy5hdHRhY2hlZFN0YXRlID0gdGhpcy5hdHRhY2hlZEFuZFdhbmRlcmluZ1N0YXRlOyAvL0BwdWJsaWNcclxuXHJcbiAgICAvLyBTZXBhcmF0b3IgdXNlZCB0byBkZWZvcm0gdGhlIEROQSBzdHJhbmQgd2hlbiB0aGUgUk5BIHBvbHltZXJhc2UgaXMgdHJhbnNjcmliaW5nIGl0LlxyXG4gICAgLy9AcHVibGljXHJcbiAgICB0aGlzLmRuYVN0cmFuZFNlcGFyYXRpb24gPSBuZXcgRG5hU2VwYXJhdGlvbiggcm5hUG9seW1lcmFzZS5nZXRQb3NpdGlvbigpLngsIHJuYVBvbHltZXJhc2UuYm91bmRzLmdldEhlaWdodCgpICogMC45ICk7XHJcblxyXG4gICAgLy8gVGhpcyBhdHRhY2htZW50IHNpdGUgaXMgdXNlZCBieSB0aGUgc3RhdGUgbWFjaGluZSB0byBnZXQgdGhlIHBvbHltZXJhc2Ugc29tZXRoaW5nIHRvIGF0dGFjaCB0byB3aGVuIHRyYW5zY3JpYmluZy5cclxuICAgIC8vIFRoaXMgaXMgYSBiaXQgaG9rZXksIGJ1dCB3YXMgYSBsb3QgZWFzaWVyIHRoYW4gdHJ5aW5nIHRvIG1vdmUgdG8gZWFjaCBhbmQgZXZlcnkgYmFzZSBwYWlyIGluIHRoZSBETkEgc3RyYW5kLlxyXG4gICAgLy9AcHVibGljXHJcbiAgICB0aGlzLnRyYW5zY3JpYmluZ0F0dGFjaG1lbnRTaXRlID0gbmV3IEF0dGFjaG1lbnRTaXRlKCBybmFQb2x5bWVyYXNlLCBuZXcgVmVjdG9yMiggMCwgMCApLCAxICk7XHJcblxyXG4gICAgLy8gVGhyZXNob2xkIGZvciB0aGUgZGV0YWNobWVudCBhbGdvcml0aG0sIHVzZWQgaW4gZGVjaWRpbmcgd2hldGhlciBvciBub3QgdG8gZGV0YWNoIGNvbXBsZXRlbHkgZnJvbSB0aGUgRE5BIGF0IGFcclxuICAgIC8vIGdpdmVuIHRpbWUgc3RlcC5cclxuICAgIC8vQHB1YmxpY1xyXG4gICAgdGhpcy5kZXRhY2hGcm9tRG5hVGhyZXNob2xkID0gbmV3IFByb3BlcnR5KCAxLjAgKTtcclxuXHJcbiAgICAvLyBBIGZsYWcgdGhhdCB0cmFja3Mgd2hldGhlciB0aGlzIHN0YXRlIG1hY2hpbmUgc2hvdWxkIHVzZSB0aGUgXCJyZWN5Y2xlIG1vZGVcIiwgd2hpY2ggY2F1c2VzIHRoZSBwb2x5bWVyYXNlIHRvXHJcbiAgICAvLyByZXR1cm4gdG8gc29tZSBuZXcgcG9zaXRpb24gb25jZSBpdCBoYXMgY29tcGxldGVkIHRyYW5zY3JpcHRpb24uXHJcbiAgICAvL0BwdWJsaWNcclxuICAgIHRoaXMucmVjeWNsZU1vZGUgPSBmYWxzZTtcclxuXHJcbiAgICAvL0BwdWJsaWNcclxuICAgIHRoaXMucmVjeWNsZVJldHVyblpvbmVzID0gW107XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZSB0aGUgYXR0YWNobWVudCBzaXRlIHVzZWQgd2hlbiB0cmFuc2NyaWJpbmcuXHJcbiAgICB0aGlzLnRyYW5zY3JpYmluZ0F0dGFjaG1lbnRTaXRlLmF0dGFjaGVkT3JBdHRhY2hpbmdNb2xlY3VsZVByb3BlcnR5LnNldCggcm5hUG9seW1lcmFzZSApO1xyXG5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHRoaXMgb3ZlcnJpZGUgbWFrZXMgc3VyZSB0aGF0IHRoZSBwb2x5bWVyYXNlIGhhcyByZXR1cm5lZCB0byBpdHMgbm9ybWFsIHNoYXBlIGJlZm9yZSBkZXRhY2hpbmcgZnJvbSBETkFcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZm9yY2VJbW1lZGlhdGVVbmF0dGFjaGVkQW5kQXZhaWxhYmxlKCkge1xyXG4gICAgaWYgKCB0aGlzLmF0dGFjaG1lbnRTdGF0ZSA9PT0gdGhpcy5hdHRhY2hlZEFuZERlY29uZm9ybWluZ1N0YXRlICkge1xyXG4gICAgICB0aGlzLmF0dGFjaG1lbnRTdGF0ZS5kZXRhY2hGcm9tRG5hKCk7XHJcbiAgICB9XHJcbiAgICBzdXBlci5mb3JjZUltbWVkaWF0ZVVuYXR0YWNoZWRBbmRBdmFpbGFibGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gcmVjeWNsZU1vZGVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc2V0UmVjeWNsZU1vZGUoIHJlY3ljbGVNb2RlICkge1xyXG4gICAgdGhpcy5yZWN5Y2xlTW9kZSA9IHJlY3ljbGVNb2RlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtCb3VuZHMyfSByZWN5Y2xlUmV0dXJuWm9uZVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBhZGRSZWN5Y2xlUmV0dXJuWm9uZSggcmVjeWNsZVJldHVyblpvbmUgKSB7XHJcbiAgICB0aGlzLnJlY3ljbGVSZXR1cm5ab25lcy5wdXNoKCByZWN5Y2xlUmV0dXJuWm9uZSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FsY3VsYXRlIHRoZSBwcm9iYWJpbGl0eSBvZiBkZXRhY2htZW50IGZyb20gdGhlIGN1cnJlbnQgYmFzZSBwYWlyIGR1cmluZyB0aGUgcHJvdmlkZWQgdGltZSBpbnRlcnZhbC4gVGhpcyB1c2VzXHJcbiAgICogdGhlIHNhbWUgbWF0aGVtYXRpY3MgYXMgaXMgdXNlZCBmb3IgY2FsY3VsYXRpbmcgcHJvYmFiaWxpdGllcyBvZiBkZWNheSBmb3IgcmFkaW9hY3RpdmUgYXRvbWljIG51Y2xlaS5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBhZmZpbml0eVxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBkdFxyXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNhbGN1bGF0ZVByb2JhYmlsaXR5T2ZEZXRhY2htZW50KCBhZmZpbml0eSwgZHQgKSB7XHJcbiAgICByZXR1cm4gMSAtIE1hdGguZXhwKCAtMC42OTMgKiBkdCAvIHRoaXMuY2FsY3VsYXRlSGFsZkxpZmVGcm9tQWZmaW5pdHkoIGFmZmluaXR5ICkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBhbiBhZmZpbml0eSB2YWx1ZSB0byBhIGhhbGYgbGlmZSBvZiBhdHRhY2htZW50XHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGFmZmluaXR5XHJcbiAgICogQHJldHVybnMge251bWJlcn1cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgY2FsY3VsYXRlSGFsZkxpZmVGcm9tQWZmaW5pdHkoIGFmZmluaXR5ICkge1xyXG4gICAgcmV0dXJuIEhBTEZfTElGRV9GT1JfSEFMRl9BRkZJTklUWSAqICggYWZmaW5pdHkgLyAoIDEgLSBhZmZpbml0eSApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gcCB7VmVjdG9yMn1cclxuICAgKiBAcGFyYW0gYm91bmRzTGlzdCB7QXJyYXkgPFJlY3RhbmdsZT59XHJcbiAgICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHBvaW50Q29udGFpbmVkSW5Cb3VuZHNMaXN0KCBwLCBib3VuZHNMaXN0ICkge1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgYm91bmRzTGlzdC5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgYm91bmRzID0gYm91bmRzTGlzdFsgaSBdO1xyXG4gICAgICBpZiAoIGJvdW5kcy5jb250YWluc1BvaW50KCBwICkgKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbmdlbmVFeHByZXNzaW9uRXNzZW50aWFscy5yZWdpc3RlciggJ1JuYVBvbHltZXJhc2VBdHRhY2htZW50U3RhdGVNYWNoaW5lJywgUm5hUG9seW1lcmFzZUF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFJuYVBvbHltZXJhc2VBdHRhY2htZW50U3RhdGVNYWNoaW5lO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLG9DQUFvQztBQUN6RCxPQUFPQyxPQUFPLE1BQU0sa0NBQWtDO0FBQ3RELE9BQU9DLHdCQUF3QixNQUFNLHNDQUFzQztBQUMzRSxPQUFPQyxjQUFjLE1BQU0sc0JBQXNCO0FBQ2pELE9BQU9DLGFBQWEsTUFBTSxxQkFBcUI7QUFDL0MsT0FBT0MsMEJBQTBCLE1BQU0saUNBQWlDO0FBQ3hFLE9BQU9DLDRCQUE0QixNQUFNLG1DQUFtQztBQUM1RSxPQUFPQyw0QkFBNEIsTUFBTSxtQ0FBbUM7QUFDNUUsT0FBT0MsaUNBQWlDLE1BQU0sd0NBQXdDO0FBQ3RGLE9BQU9DLDZCQUE2QixNQUFNLG9DQUFvQzs7QUFFOUU7QUFDQSxNQUFNQywyQkFBMkIsR0FBRyxHQUFHLENBQUMsQ0FBQzs7QUFFekMsTUFBTUMsbUNBQW1DLFNBQVNGLDZCQUE2QixDQUFDO0VBRTlFO0FBQ0Y7QUFDQTtFQUNFRyxXQUFXQSxDQUFFQyxhQUFhLEVBQUc7SUFDM0IsS0FBSyxDQUFFQSxhQUFjLENB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