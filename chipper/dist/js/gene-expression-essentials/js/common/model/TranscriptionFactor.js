// Copyright 2015-2021, University of Colorado Boulder

/**
 * Class that represents a transcription factor in the model. There are multiple transcription factors, and some are
 * positive (in the sense that they increase the likelihood of transcription) and some are negative (i.e. the reduce the
 * likelihood of transcription).
 *
 * @author John Blanco
 * @author Mohamed Safi
 * @author Aadish Gupta
 */

import Dimension2 from '../../../../dot/js/Dimension2.js';
import dotRandom from '../../../../dot/js/dotRandom.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Color } from '../../../../scenery/js/imports.js';
import geneExpressionEssentials from '../../geneExpressionEssentials.js';
import TranscriptionFactorAttachmentStateMachine from './attachment-state-machines/TranscriptionFactorAttachmentStateMachine.js';
import BioShapeUtils from './BioShapeUtils.js';
import MobileBiomolecule from './MobileBiomolecule.js';
import StubGeneExpressionModel from './StubGeneExpressionModel.js';
import TranscriptionFactorConfig from './TranscriptionFactorConfig.js';

// constants
const WIDTH = 325; // In nanometers.
const HEIGHT = 240; // In nanometers.
const SIZE = new Dimension2(WIDTH, HEIGHT);
class TranscriptionFactor extends MobileBiomolecule {
  /**
   * @param {GeneExpressionModel} model
   * @param {TranscriptionFactorConfig} config
   * @param {Vector2} initialPosition
   */
  constructor(model, config, initialPosition) {
    model = model || new StubGeneExpressionModel();
    initialPosition = initialPosition || new Vector2(0, 0);
    super(model, config.shape, config.baseColor);

    // Configuration used to create this transcription factor, used when comparing factors and creating copies.
    this.config = config; // @private
    this.setPosition(initialPosition);
  }

  /**
   * Get an indication of whether this transcription factor is positive (enhances transcription) or negative
   * (prevents or decreases likelihood of transcription).
   *
   * @returns {boolean}
   * @public
   */
  isPositive() {
    return this.config.isPositive;
  }

  /**
   * @override
   * Overridden in order to provide some unique behavior for transcription factors.
   * @returns {TranscriptionFactorAttachmentStateMachine}
   * @public
   */
  createAttachmentStateMachine() {
    return new TranscriptionFactorAttachmentStateMachine(this);
  }

  /**
   * @override
   * @public
   */
  handleReleasedByUser() {
    super.handleReleasedByUser();

    // A case that is unique to transcription factors: If released on top of another biomolecule on the DNA strand, go
    // directly into the detaching state so that this drifts away from the DNA. This makes it clear the you can't have
    // two transcription factors in the same place on the DNA.

    const moleculesShapes = this.model.getOverlappingBiomolecules(this.bounds);
    for (let i = 0; i < moleculesShapes.length; i++) {
      const biomolecule = moleculesShapes[i];
      if (biomolecule !== this && biomolecule.attachedToDnaProperty.get()) {
        this.attachmentStateMachine.forceImmediateUnattachedButUnavailable();
        break;
      }
    }
  }

  /**
   * @override
   * @returns {Vector2}
   * @public
   */
  getDetachDirection() {
    // Randomly either up or down when detaching from DNA.
    return dotRandom.nextBoolean() ? new Vector2(0, 1) : new Vector2(0, -1);
  }

  /**
   * @override
   * @returns {AttachmentSite}
   * @public
   */
  proposeAttachments() {
    // Transcription factors only attach to DNA.
    return this.model.getDnaMolecule().considerProposalFromTranscriptionFactor(this);
  }

  /**
   * @returns {TranscriptionFactorConfig}
   * @public
   */
  getConfig() {
    return this.config;
  }
}

// static definitions of all the transcription factor configurations that are used by this sim
TranscriptionFactor.TRANSCRIPTION_FACTOR_CONFIG_GENE_1_POS = new TranscriptionFactorConfig(BioShapeUtils.createRandomShape(SIZE, 1014), true, Color.yellow);
TranscriptionFactor.TRANSCRIPTION_FACTOR_CONFIG_GENE_1_NEG = new TranscriptionFactorConfig(BioShapeUtils.createRandomShape(SIZE, 2000), false, Color.red);
TranscriptionFactor.TRANSCRIPTION_FACTOR_CONFIG_GENE_2_POS_1 = new TranscriptionFactorConfig(BioShapeUtils.createRandomShape(SIZE, 3004), true, Color.orange);
TranscriptionFactor.TRANSCRIPTION_FACTOR_CONFIG_GENE_2_POS_2 = new TranscriptionFactorConfig(BioShapeUtils.createRandomShape(SIZE, 1), true, new Color(0, 255, 127));
TranscriptionFactor.TRANSCRIPTION_FACTOR_CONFIG_GENE_2_NEG = new TranscriptionFactorConfig(BioShapeUtils.createRandomShape(SIZE, 4000), false, new Color(255, 255, 255));
TranscriptionFactor.TRANSCRIPTION_FACTOR_CONFIG_GENE_3_POS_1 = new TranscriptionFactorConfig(BioShapeUtils.createRandomShape(SIZE, 58), true, new Color(255, 127, 0));
TranscriptionFactor.TRANSCRIPTION_FACTOR_CONFIG_GENE_3_POS_2 = new TranscriptionFactorConfig(BioShapeUtils.createRandomShape(SIZE, 96), true, new Color(255, 99, 71));
TranscriptionFactor.TRANSCRIPTION_FACTOR_CONFIG_GENE_3_NEG = new TranscriptionFactorConfig(BioShapeUtils.createRandomShape(SIZE, 40), false, Color.magenta);
geneExpressionEssentials.register('TranscriptionFactor', TranscriptionFactor);
export default TranscriptionFactor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEaW1lbnNpb24yIiwiZG90UmFuZG9tIiwiVmVjdG9yMiIsIkNvbG9yIiwiZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzIiwiVHJhbnNjcmlwdGlvbkZhY3RvckF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUiLCJCaW9TaGFwZVV0aWxzIiwiTW9iaWxlQmlvbW9sZWN1bGUiLCJTdHViR2VuZUV4cHJlc3Npb25Nb2RlbCIsIlRyYW5zY3JpcHRpb25GYWN0b3JDb25maWciLCJXSURUSCIsIkhFSUdIVCIsIlNJWkUiLCJUcmFuc2NyaXB0aW9uRmFjdG9yIiwiY29uc3RydWN0b3IiLCJtb2RlbCIsImNvbmZpZyIsImluaXRpYWxQb3NpdGlvbiIsInNoYXBlIiwiYmFzZUNvbG9yIiwic2V0UG9zaXRpb24iLCJpc1Bvc2l0aXZlIiwiY3JlYXRlQXR0YWNobWVudFN0YXRlTWFjaGluZSIsImhhbmRsZVJlbGVhc2VkQnlVc2VyIiwibW9sZWN1bGVzU2hhcGVzIiwiZ2V0T3ZlcmxhcHBpbmdCaW9tb2xlY3VsZXMiLCJib3VuZHMiLCJpIiwibGVuZ3RoIiwiYmlvbW9sZWN1bGUiLCJhdHRhY2hlZFRvRG5hUHJvcGVydHkiLCJnZXQiLCJhdHRhY2htZW50U3RhdGVNYWNoaW5lIiwiZm9yY2VJbW1lZGlhdGVVbmF0dGFjaGVkQnV0VW5hdmFpbGFibGUiLCJnZXREZXRhY2hEaXJlY3Rpb24iLCJuZXh0Qm9vbGVhbiIsInByb3Bvc2VBdHRhY2htZW50cyIsImdldERuYU1vbGVjdWxlIiwiY29uc2lkZXJQcm9wb3NhbEZyb21UcmFuc2NyaXB0aW9uRmFjdG9yIiwiZ2V0Q29uZmlnIiwiVFJBTlNDUklQVElPTl9GQUNUT1JfQ09ORklHX0dFTkVfMV9QT1MiLCJjcmVhdGVSYW5kb21TaGFwZSIsInllbGxvdyIsIlRSQU5TQ1JJUFRJT05fRkFDVE9SX0NPTkZJR19HRU5FXzFfTkVHIiwicmVkIiwiVFJBTlNDUklQVElPTl9GQUNUT1JfQ09ORklHX0dFTkVfMl9QT1NfMSIsIm9yYW5nZSIsIlRSQU5TQ1JJUFRJT05fRkFDVE9SX0NPTkZJR19HRU5FXzJfUE9TXzIiLCJUUkFOU0NSSVBUSU9OX0ZBQ1RPUl9DT05GSUdfR0VORV8yX05FRyIsIlRSQU5TQ1JJUFRJT05fRkFDVE9SX0NPTkZJR19HRU5FXzNfUE9TXzEiLCJUUkFOU0NSSVBUSU9OX0ZBQ1RPUl9DT05GSUdfR0VORV8zX1BPU18yIiwiVFJBTlNDUklQVElPTl9GQUNUT1JfQ09ORklHX0dFTkVfM19ORUciLCJtYWdlbnRhIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJUcmFuc2NyaXB0aW9uRmFjdG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE1LTIwMjEsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIENsYXNzIHRoYXQgcmVwcmVzZW50cyBhIHRyYW5zY3JpcHRpb24gZmFjdG9yIGluIHRoZSBtb2RlbC4gVGhlcmUgYXJlIG11bHRpcGxlIHRyYW5zY3JpcHRpb24gZmFjdG9ycywgYW5kIHNvbWUgYXJlXHJcbiAqIHBvc2l0aXZlIChpbiB0aGUgc2Vuc2UgdGhhdCB0aGV5IGluY3JlYXNlIHRoZSBsaWtlbGlob29kIG9mIHRyYW5zY3JpcHRpb24pIGFuZCBzb21lIGFyZSBuZWdhdGl2ZSAoaS5lLiB0aGUgcmVkdWNlIHRoZVxyXG4gKiBsaWtlbGlob29kIG9mIHRyYW5zY3JpcHRpb24pLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvXHJcbiAqIEBhdXRob3IgTW9oYW1lZCBTYWZpXHJcbiAqIEBhdXRob3IgQWFkaXNoIEd1cHRhXHJcbiAqL1xyXG5cclxuaW1wb3J0IERpbWVuc2lvbjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0RpbWVuc2lvbjIuanMnO1xyXG5pbXBvcnQgZG90UmFuZG9tIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9kb3RSYW5kb20uanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCB7IENvbG9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGdlbmVFeHByZXNzaW9uRXNzZW50aWFscyBmcm9tICcuLi8uLi9nZW5lRXhwcmVzc2lvbkVzc2VudGlhbHMuanMnO1xyXG5pbXBvcnQgVHJhbnNjcmlwdGlvbkZhY3RvckF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUgZnJvbSAnLi9hdHRhY2htZW50LXN0YXRlLW1hY2hpbmVzL1RyYW5zY3JpcHRpb25GYWN0b3JBdHRhY2htZW50U3RhdGVNYWNoaW5lLmpzJztcclxuaW1wb3J0IEJpb1NoYXBlVXRpbHMgZnJvbSAnLi9CaW9TaGFwZVV0aWxzLmpzJztcclxuaW1wb3J0IE1vYmlsZUJpb21vbGVjdWxlIGZyb20gJy4vTW9iaWxlQmlvbW9sZWN1bGUuanMnO1xyXG5pbXBvcnQgU3R1YkdlbmVFeHByZXNzaW9uTW9kZWwgZnJvbSAnLi9TdHViR2VuZUV4cHJlc3Npb25Nb2RlbC5qcyc7XHJcbmltcG9ydCBUcmFuc2NyaXB0aW9uRmFjdG9yQ29uZmlnIGZyb20gJy4vVHJhbnNjcmlwdGlvbkZhY3RvckNvbmZpZy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgV0lEVEggPSAzMjU7ICAgLy8gSW4gbmFub21ldGVycy5cclxuY29uc3QgSEVJR0hUID0gMjQwOyAgLy8gSW4gbmFub21ldGVycy5cclxuY29uc3QgU0laRSA9IG5ldyBEaW1lbnNpb24yKCBXSURUSCwgSEVJR0hUICk7XHJcblxyXG5jbGFzcyBUcmFuc2NyaXB0aW9uRmFjdG9yIGV4dGVuZHMgTW9iaWxlQmlvbW9sZWN1bGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0dlbmVFeHByZXNzaW9uTW9kZWx9IG1vZGVsXHJcbiAgICogQHBhcmFtIHtUcmFuc2NyaXB0aW9uRmFjdG9yQ29uZmlnfSBjb25maWdcclxuICAgKiBAcGFyYW0ge1ZlY3RvcjJ9IGluaXRpYWxQb3NpdGlvblxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBtb2RlbCwgY29uZmlnLCBpbml0aWFsUG9zaXRpb24gKSB7XHJcbiAgICBtb2RlbCA9IG1vZGVsIHx8IG5ldyBTdHViR2VuZUV4cHJlc3Npb25Nb2RlbCgpO1xyXG4gICAgaW5pdGlhbFBvc2l0aW9uID0gaW5pdGlhbFBvc2l0aW9uIHx8IG5ldyBWZWN0b3IyKCAwLCAwICk7XHJcbiAgICBzdXBlciggbW9kZWwsIGNvbmZpZy5zaGFwZSwgY29uZmlnLmJhc2VDb2xvciApO1xyXG5cclxuICAgIC8vIENvbmZpZ3VyYXRpb24gdXNlZCB0byBjcmVhdGUgdGhpcyB0cmFuc2NyaXB0aW9uIGZhY3RvciwgdXNlZCB3aGVuIGNvbXBhcmluZyBmYWN0b3JzIGFuZCBjcmVhdGluZyBjb3BpZXMuXHJcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZzsgLy8gQHByaXZhdGVcclxuICAgIHRoaXMuc2V0UG9zaXRpb24oIGluaXRpYWxQb3NpdGlvbiApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGFuIGluZGljYXRpb24gb2Ygd2hldGhlciB0aGlzIHRyYW5zY3JpcHRpb24gZmFjdG9yIGlzIHBvc2l0aXZlIChlbmhhbmNlcyB0cmFuc2NyaXB0aW9uKSBvciBuZWdhdGl2ZVxyXG4gICAqIChwcmV2ZW50cyBvciBkZWNyZWFzZXMgbGlrZWxpaG9vZCBvZiB0cmFuc2NyaXB0aW9uKS5cclxuICAgKlxyXG4gICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBpc1Bvc2l0aXZlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmlzUG9zaXRpdmU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBPdmVycmlkZGVuIGluIG9yZGVyIHRvIHByb3ZpZGUgc29tZSB1bmlxdWUgYmVoYXZpb3IgZm9yIHRyYW5zY3JpcHRpb24gZmFjdG9ycy5cclxuICAgKiBAcmV0dXJucyB7VHJhbnNjcmlwdGlvbkZhY3RvckF0dGFjaG1lbnRTdGF0ZU1hY2hpbmV9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNyZWF0ZUF0dGFjaG1lbnRTdGF0ZU1hY2hpbmUoKSB7XHJcbiAgICByZXR1cm4gbmV3IFRyYW5zY3JpcHRpb25GYWN0b3JBdHRhY2htZW50U3RhdGVNYWNoaW5lKCB0aGlzICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgaGFuZGxlUmVsZWFzZWRCeVVzZXIoKSB7XHJcbiAgICBzdXBlci5oYW5kbGVSZWxlYXNlZEJ5VXNlcigpO1xyXG5cclxuICAgIC8vIEEgY2FzZSB0aGF0IGlzIHVuaXF1ZSB0byB0cmFuc2NyaXB0aW9uIGZhY3RvcnM6IElmIHJlbGVhc2VkIG9uIHRvcCBvZiBhbm90aGVyIGJpb21vbGVjdWxlIG9uIHRoZSBETkEgc3RyYW5kLCBnb1xyXG4gICAgLy8gZGlyZWN0bHkgaW50byB0aGUgZGV0YWNoaW5nIHN0YXRlIHNvIHRoYXQgdGhpcyBkcmlmdHMgYXdheSBmcm9tIHRoZSBETkEuIFRoaXMgbWFrZXMgaXQgY2xlYXIgdGhlIHlvdSBjYW4ndCBoYXZlXHJcbiAgICAvLyB0d28gdHJhbnNjcmlwdGlvbiBmYWN0b3JzIGluIHRoZSBzYW1lIHBsYWNlIG9uIHRoZSBETkEuXHJcblxyXG4gICAgY29uc3QgbW9sZWN1bGVzU2hhcGVzID0gdGhpcy5tb2RlbC5nZXRPdmVybGFwcGluZ0Jpb21vbGVjdWxlcyggdGhpcy5ib3VuZHMgKTtcclxuXHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBtb2xlY3VsZXNTaGFwZXMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IGJpb21vbGVjdWxlID0gbW9sZWN1bGVzU2hhcGVzWyBpIF07XHJcbiAgICAgIGlmICggYmlvbW9sZWN1bGUgIT09IHRoaXMgJiYgYmlvbW9sZWN1bGUuYXR0YWNoZWRUb0RuYVByb3BlcnR5LmdldCgpICkge1xyXG4gICAgICAgIHRoaXMuYXR0YWNobWVudFN0YXRlTWFjaGluZS5mb3JjZUltbWVkaWF0ZVVuYXR0YWNoZWRCdXRVbmF2YWlsYWJsZSgpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBAcmV0dXJucyB7VmVjdG9yMn1cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgZ2V0RGV0YWNoRGlyZWN0aW9uKCkge1xyXG4gICAgLy8gUmFuZG9tbHkgZWl0aGVyIHVwIG9yIGRvd24gd2hlbiBkZXRhY2hpbmcgZnJvbSBETkEuXHJcbiAgICByZXR1cm4gZG90UmFuZG9tLm5leHRCb29sZWFuKCkgPyBuZXcgVmVjdG9yMiggMCwgMSApIDogbmV3IFZlY3RvcjIoIDAsIC0xICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKiBAcmV0dXJucyB7QXR0YWNobWVudFNpdGV9XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHByb3Bvc2VBdHRhY2htZW50cygpIHtcclxuXHJcbiAgICAvLyBUcmFuc2NyaXB0aW9uIGZhY3RvcnMgb25seSBhdHRhY2ggdG8gRE5BLlxyXG4gICAgcmV0dXJuIHRoaXMubW9kZWwuZ2V0RG5hTW9sZWN1bGUoKS5jb25zaWRlclByb3Bvc2FsRnJvbVRyYW5zY3JpcHRpb25GYWN0b3IoIHRoaXMgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEByZXR1cm5zIHtUcmFuc2NyaXB0aW9uRmFjdG9yQ29uZmlnfVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBnZXRDb25maWcoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jb25maWc7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuXHJcbi8vIHN0YXRpYyBkZWZpbml0aW9ucyBvZiBhbGwgdGhlIHRyYW5zY3JpcHRpb24gZmFjdG9yIGNvbmZpZ3VyYXRpb25zIHRoYXQgYXJlIHVzZWQgYnkgdGhpcyBzaW1cclxuVHJhbnNjcmlwdGlvbkZhY3Rvci5UUkFOU0NSSVBUSU9OX0ZBQ1RPUl9DT05GSUdfR0VORV8xX1BPUyA9IG5ldyBUcmFuc2NyaXB0aW9uRmFjdG9yQ29uZmlnKFxyXG4gIEJpb1NoYXBlVXRpbHMuY3JlYXRlUmFuZG9tU2hhcGUoIFNJWkUsIDEwMTQgKSxcclxuICB0cnVlLFxyXG4gIENvbG9yLnllbGxvd1xyXG4pO1xyXG5UcmFuc2NyaXB0aW9uRmFjdG9yLlRSQU5TQ1JJUFRJT05fRkFDVE9SX0NPTkZJR19HRU5FXzFfTkVHID0gbmV3IFRyYW5zY3JpcHRpb25GYWN0b3JDb25maWcoXHJcbiAgQmlvU2hhcGVVdGlscy5jcmVhdGVSYW5kb21TaGFwZSggU0laRSwgMjAwMCApLFxyXG4gIGZhbHNlLFxyXG4gIENvbG9yLnJlZFxyXG4pO1xyXG5UcmFuc2NyaXB0aW9uRmFjdG9yLlRSQU5TQ1JJUFRJT05fRkFDVE9SX0NPTkZJR19HRU5FXzJfUE9TXzEgPSBuZXcgVHJhbnNjcmlwdGlvbkZhY3RvckNvbmZpZyhcclxuICBCaW9TaGFwZVV0aWxzLmNyZWF0ZVJhbmRvbVNoYXBlKCBTSVpFLCAzMDA0ICksXHJcbiAgdHJ1ZSxcclxuICBDb2xvci5vcmFuZ2VcclxuKTtcclxuVHJhbnNjcmlwdGlvbkZhY3Rvci5UUkFOU0NSSVBUSU9OX0ZBQ1RPUl9DT05GSUdfR0VORV8yX1BPU18yID0gbmV3IFRyYW5zY3JpcHRpb25GYWN0b3JDb25maWcoXHJcbiAgQmlvU2hhcGVVdGlscy5jcmVhdGVSYW5kb21TaGFwZSggU0laRSwgMSApLFxyXG4gIHRydWUsXHJcbiAgbmV3IENvbG9yKCAwLCAyNTUsIDEyNyApXHJcbik7XHJcblRyYW5zY3JpcHRpb25GYWN0b3IuVFJBTlNDUklQVElPTl9GQUNUT1JfQ09ORklHX0dFTkVfMl9ORUcgPSBuZXcgVHJhbnNjcmlwdGlvbkZhY3RvckNvbmZpZyhcclxuICBCaW9TaGFwZVV0aWxzLmNyZWF0ZVJhbmRvbVNoYXBlKCBTSVpFLCA0MDAwICksXHJcbiAgZmFsc2UsXHJcbiAgbmV3IENvbG9yKCAyNTUsIDI1NSwgMjU1IClcclxuKTtcclxuVHJhbnNjcmlwdGlvbkZhY3Rvci5UUkFOU0NSSVBUSU9OX0ZBQ1RPUl9DT05GSUdfR0VORV8zX1BPU18xID0gbmV3IFRyYW5zY3JpcHRpb25GYWN0b3JDb25maWcoXHJcbiAgQmlvU2hhcGVVdGlscy5jcmVhdGVSYW5kb21TaGFwZSggU0laRSwgNTggKSxcclxuICB0cnVlLFxyXG4gIG5ldyBDb2xvciggMjU1LCAxMjcsIDAgKVxyXG4pO1xyXG5UcmFuc2NyaXB0aW9uRmFjdG9yLlRSQU5TQ1JJUFRJT05fRkFDVE9SX0NPTkZJR19HRU5FXzNfUE9TXzIgPSBuZXcgVHJhbnNjcmlwdGlvbkZhY3RvckNvbmZpZyhcclxuICBCaW9TaGFwZVV0aWxzLmNyZWF0ZVJhbmRvbVNoYXBlKCBTSVpFLCA5NiApLFxyXG4gIHRydWUsXHJcbiAgbmV3IENvbG9yKCAyNTUsIDk5LCA3MSApXHJcbik7XHJcblRyYW5zY3JpcHRpb25GYWN0b3IuVFJBTlNDUklQVElPTl9GQUNUT1JfQ09ORklHX0dFTkVfM19ORUcgPSBuZXcgVHJhbnNjcmlwdGlvbkZhY3RvckNvbmZpZyhcclxuICBCaW9TaGFwZVV0aWxzLmNyZWF0ZVJhbmRvbVNoYXBlKCBTSVpFLCA0MCApLFxyXG4gIGZhbHNlLFxyXG4gIENvbG9yLm1hZ2VudGFcclxuKTtcclxuXHJcbmdlbmVFeHByZXNzaW9uRXNzZW50aWFscy5yZWdpc3RlciggJ1RyYW5zY3JpcHRpb25GYWN0b3InLCBUcmFuc2NyaXB0aW9uRmFjdG9yICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBUcmFuc2NyaXB0aW9uRmFjdG9yOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFVBQVUsTUFBTSxrQ0FBa0M7QUFDekQsT0FBT0MsU0FBUyxNQUFNLGlDQUFpQztBQUN2RCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FB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