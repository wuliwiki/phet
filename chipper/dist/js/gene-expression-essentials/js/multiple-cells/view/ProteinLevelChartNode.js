// Copyright 2015-2022, University of Colorado Boulder

/**
 * This class defines a node that displays the average protein level for a population of cells. It in turns call Griddle
 * library for drawing the graph
 *
 * @author John Blanco
 * @author Aadish Gupta
 */

import Range from '../../../../dot/js/Range.js';
import DynamicSeries from '../../../../griddle/js/DynamicSeries.js';
import XYChartNode from '../../../../griddle/js/XYChartNode.js';
import PhetColorScheme from '../../../../scenery-phet/js/PhetColorScheme.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { LinearGradient, Node, Rectangle, Text } from '../../../../scenery/js/imports.js';
import Panel from '../../../../sun/js/Panel.js';
import GEEConstants from '../../common/GEEConstants.js';
import geneExpressionEssentials from '../../geneExpressionEssentials.js';
import GeneExpressionEssentialsStrings from '../../GeneExpressionEssentialsStrings.js';
import ColorChangingCellNode from './ColorChangingCellNode.js';

// constants
const PLOT_WIDTH = 400;
const PLOT_HEIGHT = 120;
const COLOR_KEY_WIDTH = 20;
const TIME_SPAN = 30;
const averageProteinLevelString = GeneExpressionEssentialsStrings.averageProteinLevel;
const averageProteinLevelVsTimeString = GeneExpressionEssentialsStrings.averageProteinLevelVsTime;
const lotsString = GeneExpressionEssentialsStrings.lots;
const noneString = GeneExpressionEssentialsStrings.none;
const timeString = GeneExpressionEssentialsStrings.time;
class ProteinLevelChartNode extends Panel {
  /**
   * @param {Property.<number>} averageProteinLevelProperty
   */
  constructor(averageProteinLevelProperty) {
    const contentNode = new Node();
    const verticalRange = new Range(0, 170);
    const chart = new XYChartNode({
      width: PLOT_WIDTH,
      height: PLOT_HEIGHT,
      cornerRadius: 0,
      defaultModelXRange: new Range(0, 30),
      defaultModelYRange: verticalRange,
      majorHorizontalLineSpacing: verticalRange.max / 7,
      majorVerticalLineSpacing: 2,
      gridNodeOptions: {
        majorLineOptions: {
          lineDash: [2, 1],
          stroke: 'grey'
        }
      },
      showVerticalGridLabels: false,
      gridLabelOptions: {
        font: new PhetFont(12)
      }
    });
    const dataSeries = new DynamicSeries({
      color: PhetColorScheme.RED_COLORBLIND,
      lineWidth: 2,
      lineJoin: 'round'
    });
    chart.addDynamicSeries(dataSeries);
    contentNode.addChild(chart);

    // graph title
    const titleNode = new Text(averageProteinLevelVsTimeString, {
      font: new PhetFont({
        size: 16,
        weight: 'bold'
      }),
      maxWidth: PLOT_WIDTH
    });
    contentNode.addChild(titleNode);
    titleNode.centerX = chart.centerX;
    titleNode.bottom = chart.top - 10;

    // x axis label
    const xLabel = new Text(timeString, {
      font: new PhetFont({
        size: 12
      }),
      maxWidth: PLOT_WIDTH
    });
    contentNode.addChild(xLabel);
    xLabel.centerX = chart.centerX;
    xLabel.top = chart.bottom + 10;

    // y axis label
    const proteinLevelColorKey = new Rectangle(chart.left, chart.top, COLOR_KEY_WIDTH, PLOT_HEIGHT, {
      fill: new LinearGradient(chart.left, chart.top, chart.left + COLOR_KEY_WIDTH, chart.top + PLOT_HEIGHT).addColorStop(0, ColorChangingCellNode.FlorescentFillColor).addColorStop(1, ColorChangingCellNode.NominalFillColor),
      stroke: '#000',
      lineWidth: 1
    });
    contentNode.addChild(proteinLevelColorKey);
    proteinLevelColorKey.top = chart.top;
    proteinLevelColorKey.right = chart.left - 5;
    const lotsNode = new Text(lotsString, {
      font: new PhetFont(12),
      maxWidth: 50
    });
    contentNode.addChild(lotsNode);
    lotsNode.centerY = proteinLevelColorKey.top;
    lotsNode.right = proteinLevelColorKey.left - 5;
    const noneNode = new Text(noneString, {
      font: new PhetFont(12),
      maxWidth: 50
    });
    contentNode.addChild(noneNode);
    noneNode.centerY = proteinLevelColorKey.bottom;
    noneNode.right = proteinLevelColorKey.left - 5;
    const yLabelNode = new Text(averageProteinLevelString, {
      font: new PhetFont(13),
      maxWidth: PLOT_HEIGHT + 10
    });
    yLabelNode.setRotation(3 * Math.PI / 2);
    yLabelNode.centerY = proteinLevelColorKey.centerY;
    yLabelNode.right = contentNode.left - 5;
    contentNode.addChild(yLabelNode);
    super(contentNode, {
      cornerRadius: GEEConstants.CORNER_RADIUS,
      fill: 'lightgrey',
      xMargin: 10,
      yMargin: 10
    });

    // @private
    this.simRunningTime = 0;
    this.timeOffset = 0;
    this.averageProteinLevelProperty = averageProteinLevelProperty;
    this.dataSeries = dataSeries;
  }

  /**
   * @param {number} dt
   * @public
   */
  addDataPoint(dt) {
    this.simRunningTime += dt;
    if (this.simRunningTime - this.timeOffset > TIME_SPAN) {
      // if the end of the chart has been reached, clear it
      this.dataSeries.clear();
    }
    if (this.dataSeries.getLength() === 0) {
      // This is the first data added after the most recent clear, so record the time offset.
      this.timeOffset = this.simRunningTime;
    }

    // add the data to the chart
    this.dataSeries.addXYDataPoint(this.simRunningTime - this.timeOffset, this.averageProteinLevelProperty.get());
  }

  /**
   * @public
   */
  reset() {
    this.simRunningTime = 0;
    this.timeOffset = 0;
    this.dataSeries.clear();
  }
}
geneExpressionEssentials.register('ProteinLevelChartNode', ProteinLevelChartNode);
export default ProteinLevelChartNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSYW5nZSIsIkR5bmFtaWNTZXJpZXMiLCJYWUNoYXJ0Tm9kZSIsIlBoZXRDb2xvclNjaGVtZSIsIlBoZXRGb250IiwiTGluZWFyR3JhZGllbnQiLCJOb2RlIiwiUmVjdGFuZ2xlIiwiVGV4dCIsIlBhbmVsIiwiR0VFQ29uc3RhbnRzIiwiZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzIiwiR2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzU3RyaW5ncyIsIkNvbG9yQ2hhbmdpbmdDZWxsTm9kZSIsIlBMT1RfV0lEVEgiLCJQTE9UX0hFSUdIVCIsIkNPTE9SX0tFWV9XSURUSCIsIlRJTUVfU1BBTiIsImF2ZXJhZ2VQcm90ZWluTGV2ZWxTdHJpbmciLCJhdmVyYWdlUHJvdGVpbkxldmVsIiwiYXZlcmFnZVByb3RlaW5MZXZlbFZzVGltZVN0cmluZyIsImF2ZXJhZ2VQcm90ZWluTGV2ZWxWc1RpbWUiLCJsb3RzU3RyaW5nIiwibG90cyIsIm5vbmVTdHJpbmciLCJub25lIiwidGltZVN0cmluZyIsInRpbWUiLCJQcm90ZWluTGV2ZWxDaGFydE5vZGUiLCJjb25zdHJ1Y3RvciIsImF2ZXJhZ2VQcm90ZWluTGV2ZWxQcm9wZXJ0eSIsImNvbnRlbnROb2RlIiwidmVydGljYWxSYW5nZSIsImNoYXJ0Iiwid2lkdGgiLCJoZWlnaHQiLCJjb3JuZXJSYWRpdXMiLCJkZWZhdWx0TW9kZWxYUmFuZ2UiLCJkZWZhdWx0TW9kZWxZUmFuZ2UiLCJtYWpvckhvcml6b250YWxMaW5lU3BhY2luZyIsIm1heCIsIm1ham9yVmVydGljYWxMaW5lU3BhY2luZyIsImdyaWROb2RlT3B0aW9ucyIsIm1ham9yTGluZU9wdGlvbnMiLCJsaW5lRGFzaCIsInN0cm9rZSIsInNob3dWZXJ0aWNhbEdyaWRMYWJlbHMiLCJncmlkTGFiZWxPcHRpb25zIiwiZm9udCIsImRhdGFTZXJpZXMiLCJjb2xvciIsIlJFRF9DT0xPUkJMSU5EIiwibGluZVdpZHRoIiwibGluZUpvaW4iLCJhZGREeW5hbWljU2VyaWVzIiwiYWRkQ2hpbGQiLCJ0aXRsZU5vZGUiLCJzaXplIiwid2VpZ2h0IiwibWF4V2lkdGgiLCJjZW50ZXJYIiwiYm90dG9tIiwidG9wIiwieExhYmVsIiwicHJvdGVpbkxldmVsQ29sb3JLZXkiLCJsZWZ0IiwiZmlsbCIsImFkZENvbG9yU3RvcCIsIkZsb3Jlc2NlbnRGaWxsQ29sb3IiLCJOb21pbmFsRmlsbENvbG9yIiwicmlnaHQiLCJsb3RzTm9kZSIsImNlbnRlclkiLCJub25lTm9kZSIsInlMYWJlbE5vZGUiLCJzZXRSb3RhdGlvbiIsIk1hdGgiLCJQSSIsIkNPUk5FUl9SQURJVVMiLCJ4TWFyZ2luIiwieU1hcmdpbiIsInNpbVJ1bm5pbmdUaW1lIiwidGltZU9mZnNldCIsImFkZERhdGFQb2ludCIsImR0IiwiY2xlYXIiLCJnZXRMZW5ndGgiLCJhZGRYWURhdGFQb2ludCIsImdldCIsInJlc2V0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQcm90ZWluTGV2ZWxDaGFydE5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTUtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhpcyBjbGFzcyBkZWZpbmVzIGEgbm9kZSB0aGF0IGRpc3BsYXlzIHRoZSBhdmVyYWdlIHByb3RlaW4gbGV2ZWwgZm9yIGEgcG9wdWxhdGlvbiBvZiBjZWxscy4gSXQgaW4gdHVybnMgY2FsbCBHcmlkZGxlXHJcbiAqIGxpYnJhcnkgZm9yIGRyYXdpbmcgdGhlIGdyYXBoXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICogQGF1dGhvciBBYWRpc2ggR3VwdGFcclxuICovXHJcblxyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IER5bmFtaWNTZXJpZXMgZnJvbSAnLi4vLi4vLi4vLi4vZ3JpZGRsZS9qcy9EeW5hbWljU2VyaWVzLmpzJztcclxuaW1wb3J0IFhZQ2hhcnROb2RlIGZyb20gJy4uLy4uLy4uLy4uL2dyaWRkbGUvanMvWFlDaGFydE5vZGUuanMnO1xyXG5pbXBvcnQgUGhldENvbG9yU2NoZW1lIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Q29sb3JTY2hlbWUuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgTGluZWFyR3JhZGllbnQsIE5vZGUsIFJlY3RhbmdsZSwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBQYW5lbCBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvUGFuZWwuanMnO1xyXG5pbXBvcnQgR0VFQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9HRUVDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzIGZyb20gJy4uLy4uL2dlbmVFeHByZXNzaW9uRXNzZW50aWFscy5qcyc7XHJcbmltcG9ydCBHZW5lRXhwcmVzc2lvbkVzc2VudGlhbHNTdHJpbmdzIGZyb20gJy4uLy4uL0dlbmVFeHByZXNzaW9uRXNzZW50aWFsc1N0cmluZ3MuanMnO1xyXG5pbXBvcnQgQ29sb3JDaGFuZ2luZ0NlbGxOb2RlIGZyb20gJy4vQ29sb3JDaGFuZ2luZ0NlbGxOb2RlLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBQTE9UX1dJRFRIID0gNDAwO1xyXG5jb25zdCBQTE9UX0hFSUdIVCA9IDEyMDtcclxuY29uc3QgQ09MT1JfS0VZX1dJRFRIID0gMjA7XHJcbmNvbnN0IFRJTUVfU1BBTiA9IDMwO1xyXG5cclxuY29uc3QgYXZlcmFnZVByb3RlaW5MZXZlbFN0cmluZyA9IEdlbmVFeHByZXNzaW9uRXNzZW50aWFsc1N0cmluZ3MuYXZlcmFnZVByb3RlaW5MZXZlbDtcclxuY29uc3QgYXZlcmFnZVByb3RlaW5MZXZlbFZzVGltZVN0cmluZyA9IEdlbmVFeHByZXNzaW9uRXNzZW50aWFsc1N0cmluZ3MuYXZlcmFnZVByb3RlaW5MZXZlbFZzVGltZTtcclxuY29uc3QgbG90c1N0cmluZyA9IEdlbmVFeHByZXNzaW9uRXNzZW50aWFsc1N0cmluZ3MubG90cztcclxuY29uc3Qgbm9uZVN0cmluZyA9IEdlbmVFeHByZXNzaW9uRXNzZW50aWFsc1N0cmluZ3Mubm9uZTtcclxuY29uc3QgdGltZVN0cmluZyA9IEdlbmVFeHByZXNzaW9uRXNzZW50aWFsc1N0cmluZ3MudGltZTtcclxuXHJcbmNsYXNzIFByb3RlaW5MZXZlbENoYXJ0Tm9kZSBleHRlbmRzIFBhbmVsIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48bnVtYmVyPn0gYXZlcmFnZVByb3RlaW5MZXZlbFByb3BlcnR5XHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGF2ZXJhZ2VQcm90ZWluTGV2ZWxQcm9wZXJ0eSApIHtcclxuXHJcbiAgICBjb25zdCBjb250ZW50Tm9kZSA9IG5ldyBOb2RlKCk7XHJcblxyXG4gICAgY29uc3QgdmVydGljYWxSYW5nZSA9IG5ldyBSYW5nZSggMCwgMTcwICk7XHJcbiAgICBjb25zdCBjaGFydCA9IG5ldyBYWUNoYXJ0Tm9kZSgge1xyXG4gICAgICB3aWR0aDogUExPVF9XSURUSCxcclxuICAgICAgaGVpZ2h0OiBQTE9UX0hFSUdIVCxcclxuICAgICAgY29ybmVyUmFkaXVzOiAwLFxyXG5cclxuICAgICAgZGVmYXVsdE1vZGVsWFJhbmdlOiBuZXcgUmFuZ2UoIDAsIDMwICksXHJcbiAgICAgIGRlZmF1bHRNb2RlbFlSYW5nZTogdmVydGljYWxSYW5nZSxcclxuXHJcbiAgICAgIG1ham9ySG9yaXpvbnRhbExpbmVTcGFjaW5nOiB2ZXJ0aWNhbFJhbmdlLm1heCAvIDcsXHJcbiAgICAgIG1ham9yVmVydGljYWxMaW5lU3BhY2luZzogMixcclxuXHJcbiAgICAgIGdyaWROb2RlT3B0aW9uczoge1xyXG4gICAgICAgIG1ham9yTGluZU9wdGlvbnM6IHtcclxuICAgICAgICAgIGxpbmVEYXNoOiBbIDIsIDEgXSxcclxuICAgICAgICAgIHN0cm9rZTogJ2dyZXknXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG5cclxuICAgICAgc2hvd1ZlcnRpY2FsR3JpZExhYmVsczogZmFsc2UsXHJcbiAgICAgIGdyaWRMYWJlbE9wdGlvbnM6IHtcclxuICAgICAgICBmb250OiBuZXcgUGhldEZvbnQoIDEyIClcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGRhdGFTZXJpZXMgPSBuZXcgRHluYW1pY1Nlcmllcygge1xyXG4gICAgICBjb2xvcjogUGhldENvbG9yU2NoZW1lLlJFRF9DT0xPUkJMSU5ELFxyXG4gICAgICBsaW5lV2lkdGg6IDIsXHJcbiAgICAgIGxpbmVKb2luOiAncm91bmQnXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY2hhcnQuYWRkRHluYW1pY1NlcmllcyggZGF0YVNlcmllcyApO1xyXG5cclxuICAgIGNvbnRlbnROb2RlLmFkZENoaWxkKCBjaGFydCApO1xyXG5cclxuICAgIC8vIGdyYXBoIHRpdGxlXHJcbiAgICBjb25zdCB0aXRsZU5vZGUgPSBuZXcgVGV4dCggYXZlcmFnZVByb3RlaW5MZXZlbFZzVGltZVN0cmluZywge1xyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIHsgc2l6ZTogMTYsIHdlaWdodDogJ2JvbGQnIH0gKSxcclxuICAgICAgbWF4V2lkdGg6IFBMT1RfV0lEVEhcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb250ZW50Tm9kZS5hZGRDaGlsZCggdGl0bGVOb2RlICk7XHJcbiAgICB0aXRsZU5vZGUuY2VudGVyWCA9IGNoYXJ0LmNlbnRlclg7XHJcbiAgICB0aXRsZU5vZGUuYm90dG9tID0gY2hhcnQudG9wIC0gMTA7XHJcblxyXG4gICAgLy8geCBheGlzIGxhYmVsXHJcbiAgICBjb25zdCB4TGFiZWwgPSBuZXcgVGV4dCggdGltZVN0cmluZywge1xyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIHsgc2l6ZTogMTIgfSApLFxyXG4gICAgICBtYXhXaWR0aDogUExPVF9XSURUSFxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnRlbnROb2RlLmFkZENoaWxkKCB4TGFiZWwgKTtcclxuICAgIHhMYWJlbC5jZW50ZXJYID0gY2hhcnQuY2VudGVyWDtcclxuICAgIHhMYWJlbC50b3AgPSBjaGFydC5ib3R0b20gKyAxMDtcclxuXHJcbiAgICAvLyB5IGF4aXMgbGFiZWxcclxuICAgIGNvbnN0IHByb3RlaW5MZXZlbENvbG9yS2V5ID0gbmV3IFJlY3RhbmdsZSggY2hhcnQubGVmdCwgY2hhcnQudG9wLCBDT0xPUl9LRVlfV0lEVEgsIFBMT1RfSEVJR0hULCB7XHJcbiAgICAgIGZpbGw6IG5ldyBMaW5lYXJHcmFkaWVudCggY2hhcnQubGVmdCwgY2hhcnQudG9wLCBjaGFydC5sZWZ0ICsgQ09MT1JfS0VZX1dJRFRILCBjaGFydC50b3AgKyBQTE9UX0hFSUdIVCApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggMCwgQ29sb3JDaGFuZ2luZ0NlbGxOb2RlLkZsb3Jlc2NlbnRGaWxsQ29sb3IgKVxyXG4gICAgICAgIC5hZGRDb2xvclN0b3AoIDEsIENvbG9yQ2hhbmdpbmdDZWxsTm9kZS5Ob21pbmFsRmlsbENvbG9yICksXHJcbiAgICAgIHN0cm9rZTogJyMwMDAnLFxyXG4gICAgICBsaW5lV2lkdGg6IDFcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb250ZW50Tm9kZS5hZGRDaGlsZCggcHJvdGVpbkxldmVsQ29sb3JLZXkgKTtcclxuXHJcbiAgICBwcm90ZWluTGV2ZWxDb2xvcktleS50b3AgPSBjaGFydC50b3A7XHJcbiAgICBwcm90ZWluTGV2ZWxDb2xvcktleS5yaWdodCA9IGNoYXJ0LmxlZnQgLSA1O1xyXG5cclxuICAgIGNvbnN0IGxvdHNOb2RlID0gbmV3IFRleHQoIGxvdHNTdHJpbmcsIHtcclxuICAgICAgZm9udDogbmV3IFBoZXRGb250KCAxMiApLFxyXG4gICAgICBtYXhXaWR0aDogNTBcclxuICAgIH0gKTtcclxuICAgIGNvbnRlbnROb2RlLmFkZENoaWxkKCBsb3RzTm9kZSApO1xyXG4gICAgbG90c05vZGUuY2VudGVyWSA9IHByb3RlaW5MZXZlbENvbG9yS2V5LnRvcDtcclxuICAgIGxvdHNOb2RlLnJpZ2h0ID0gcHJvdGVpbkxldmVsQ29sb3JLZXkubGVmdCAtIDU7XHJcblxyXG4gICAgY29uc3Qgbm9uZU5vZGUgPSBuZXcgVGV4dCggbm9uZVN0cmluZywge1xyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIDEyICksXHJcbiAgICAgIG1heFdpZHRoOiA1MFxyXG4gICAgfSApO1xyXG4gICAgY29udGVudE5vZGUuYWRkQ2hpbGQoIG5vbmVOb2RlICk7XHJcbiAgICBub25lTm9kZS5jZW50ZXJZID0gcHJvdGVpbkxldmVsQ29sb3JLZXkuYm90dG9tO1xyXG4gICAgbm9uZU5vZGUucmlnaHQgPSBwcm90ZWluTGV2ZWxDb2xvcktleS5sZWZ0IC0gNTtcclxuXHJcbiAgICBjb25zdCB5TGFiZWxOb2RlID0gbmV3IFRleHQoIGF2ZXJhZ2VQcm90ZWluTGV2ZWxTdHJpbmcsIHtcclxuICAgICAgZm9udDogbmV3IFBoZXRGb250KCAxMyApLFxyXG4gICAgICBtYXhXaWR0aDogUExPVF9IRUlHSFQgKyAxMFxyXG4gICAgfSApO1xyXG4gICAgeUxhYmVsTm9kZS5zZXRSb3RhdGlvbiggMyAqIE1hdGguUEkgLyAyICk7XHJcblxyXG4gICAgeUxhYmVsTm9kZS5jZW50ZXJZID0gcHJvdGVpbkxldmVsQ29sb3JLZXkuY2VudGVyWTtcclxuICAgIHlMYWJlbE5vZGUucmlnaHQgPSBjb250ZW50Tm9kZS5sZWZ0IC0gNTtcclxuXHJcbiAgICBjb250ZW50Tm9kZS5hZGRDaGlsZCggeUxhYmVsTm9kZSApO1xyXG4gICAgc3VwZXIoIGNvbnRlbnROb2RlLCB7XHJcbiAgICAgIGNvcm5lclJhZGl1czogR0VFQ29uc3RhbnRzLkNPUk5FUl9SQURJVVMsXHJcbiAgICAgIGZpbGw6ICdsaWdodGdyZXknLFxyXG4gICAgICB4TWFyZ2luOiAxMCxcclxuICAgICAgeU1hcmdpbjogMTBcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5zaW1SdW5uaW5nVGltZSA9IDA7XHJcbiAgICB0aGlzLnRpbWVPZmZzZXQgPSAwO1xyXG4gICAgdGhpcy5hdmVyYWdlUHJvdGVpbkxldmVsUHJvcGVydHkgPSBhdmVyYWdlUHJvdGVpbkxldmVsUHJvcGVydHk7XHJcbiAgICB0aGlzLmRhdGFTZXJpZXMgPSBkYXRhU2VyaWVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGR0XHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGFkZERhdGFQb2ludCggZHQgKSB7XHJcbiAgICB0aGlzLnNpbVJ1bm5pbmdUaW1lICs9IGR0O1xyXG4gICAgaWYgKCB0aGlzLnNpbVJ1bm5pbmdUaW1lIC0gdGhpcy50aW1lT2Zmc2V0ID4gVElNRV9TUEFOICkge1xyXG5cclxuICAgICAgLy8gaWYgdGhlIGVuZCBvZiB0aGUgY2hhcnQgaGFzIGJlZW4gcmVhY2hlZCwgY2xlYXIgaXRcclxuICAgICAgdGhpcy5kYXRhU2VyaWVzLmNsZWFyKCk7XHJcbiAgICB9XHJcbiAgICBpZiAoIHRoaXMuZGF0YVNlcmllcy5nZXRMZW5ndGgoKSA9PT0gMCApIHtcclxuXHJcbiAgICAgIC8vIFRoaXMgaXMgdGhlIGZpcnN0IGRhdGEgYWRkZWQgYWZ0ZXIgdGhlIG1vc3QgcmVjZW50IGNsZWFyLCBzbyByZWNvcmQgdGhlIHRpbWUgb2Zmc2V0LlxyXG4gICAgICB0aGlzLnRpbWVPZmZzZXQgPSB0aGlzLnNpbVJ1bm5pbmdUaW1lO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGFkZCB0aGUgZGF0YSB0byB0aGUgY2hhcnRcclxuICAgIHRoaXMuZGF0YVNlcmllcy5hZGRYWURhdGFQb2ludCggdGhpcy5zaW1SdW5uaW5nVGltZSAtIHRoaXMudGltZU9mZnNldCwgdGhpcy5hdmVyYWdlUHJvdGVpbkxldmVsUHJvcGVydHkuZ2V0KCkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICByZXNldCgpIHtcclxuICAgIHRoaXMuc2ltUnVubmluZ1RpbWUgPSAwO1xyXG4gICAgdGhpcy50aW1lT2Zmc2V0ID0gMDtcclxuICAgIHRoaXMuZGF0YVNlcmllcy5jbGVhcigpO1xyXG4gIH1cclxufVxyXG5cclxuZ2VuZUV4cHJlc3Npb25Fc3NlbnRpYWxzLnJlZ2lzdGVyKCAnUHJvdGVpbkxldmVsQ2hhcnROb2RlJywgUHJvdGVpbkxldmVsQ2hhcnROb2RlICk7XHJcbmV4cG9ydCBkZWZhdWx0IFByb3RlaW5MZXZlbENoYXJ0Tm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsYUFBYSxNQUFNLHlDQUF5QztBQUNuRSxPQUFPQyxXQUFXLE1BQU0sdUNBQXVDO0FBQy9ELE9BQU9DLGVBQWUsTUFBTSxnREFBZ0Q7QUFDNUUsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxTQUFTQyxjQUFjLEVBQUVDLElBQUksRUFBRUMsU0FBUyxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ3pGLE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsWUFBWSxNQUFNLDhCQUE4QjtBQUN2RCxPQUFPQyx3QkFBd0IsTUFBTSxtQ0FBbUM7QUFDeEUsT0FBT0MsK0JBQStCLE1BQU0sMENBQTBDO0FBQ3RGLE9BQU9DLHFCQUFxQixNQUFNLDRCQUE0Qjs7QUFFOUQ7QUFDQSxNQUFNQyxVQUFVLEdBQUcsR0FBRztBQUN0QixNQUFNQyxXQUFXLEdBQUcsR0FBRztBQUN2QixNQUFNQyxlQUFlLEdBQUcsRUFBRTtBQUMxQixNQUFNQyxTQUFTLEdBQUcsRUFBRTtBQUVwQixNQUFNQyx5QkFBeUIsR0FBR04sK0JBQStCLENBQUNPLG1CQUFt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