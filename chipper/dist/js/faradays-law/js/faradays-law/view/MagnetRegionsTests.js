// Copyright 2018-2021, University of Colorado Boulder

/**
 * Tests for screen summary descriptions for balloons-and-static-electricity. These descriptions are invisible, but
 * available for screen reader users.
 *
 * @author Michael Barlow (PhET Interactive Simulations)
 */

// modules
// const FaradaysLawScreenView = require( '/faradays-law/js/faradays-law/view/FaradaysLawScreenView' );
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import FaradaysLawConstants from '../FaradaysLawConstants.js';
import FaradaysLawModel from '../model/FaradaysLawModel.js';
import MagnetRegionManager from './MagnetRegionManager.js';

// create model and view

const {
  test
} = QUnit;
const model = new FaradaysLawModel(FaradaysLawConstants.LAYOUT_BOUNDS, Tandem.ROOT_TEST.createTandem('model'));
QUnit.module('MagnetRegionManager');
const columnWidth = Utils.roundSymmetric(FaradaysLawConstants.LAYOUT_BOUNDS.getWidth() / 3);
const rowHeight = Utils.roundSymmetric(FaradaysLawConstants.LAYOUT_BOUNDS.getHeight() / 3);
let x = columnWidth / 2; // center of col 1
let y = rowHeight / 2; // center of row 1
const v = new Vector2(x, y);
test('get column numbers', assert => {
  assert.equal(MagnetRegionManager.getColumn(x), 0, `${x} is in column 0`);
  x += columnWidth;
  assert.equal(MagnetRegionManager.getColumn(x), 1, `${x} is in column 1`);
  x += columnWidth;
  assert.equal(MagnetRegionManager.getColumn(x), 2, `${x} is in column 2`);
  x += columnWidth;
  assert.equal(MagnetRegionManager.getColumn(x), 2, `${x} is in column 2`);
  x = -1; // outside layout bounds -> still col 1
  assert.equal(MagnetRegionManager.getColumn(x), 0, `${x} is in column 0`);
});
test('get row numbers', assert => {
  assert.equal(MagnetRegionManager.getRow(y), 0, `${y} in row 0`);
  y += rowHeight;
  assert.notEqual(MagnetRegionManager.getRow(y), 0, `${y} not in row 0`);
  assert.equal(MagnetRegionManager.getRow(y), 1, `${y} in row 1`);
  y += rowHeight;
  assert.equal(MagnetRegionManager.getRow(y), 2, `${y} in row 2`);
  y += rowHeight;
  assert.equal(MagnetRegionManager.getRow(y), 2, `${y} in row 2`);
  y = 1000;
  assert.equal(MagnetRegionManager.getRow(y), 2, `${y} in row 2`);
});
test('get region numbers', assert => {
  x = columnWidth / 2;
  y = rowHeight / 2;
  model.reset();
  const regionTester = new MagnetRegionManager(model);
  assert.equal(regionTester.getPositionRegion(v), 0, `point ${x}, ${y} in region 0`);
  v.addXY(columnWidth, 0);
  assert.equal(regionTester.getPositionRegion(v), 1, `point ${v.x}, ${v.y} in region 1`);
  v.addXY(columnWidth, 0);
  assert.equal(regionTester.getPositionRegion(v), 2, `point ${v.x}, ${v.y} in region 2`);
  v.setXY(x, v.y + rowHeight);
  assert.equal(regionTester.getPositionRegion(v), 3, `point ${v.x}, ${v.y} in region 3`);
  v.addXY(columnWidth, 0);
  assert.equal(regionTester.getPositionRegion(v), 4, `point ${v.x}, ${v.y} in region 4`);
  v.addXY(columnWidth, 0);
  assert.equal(regionTester.getPositionRegion(v), 5, `point ${v.x}, ${v.y} in region 5`);
  v.setXY(x, v.y + rowHeight);
  assert.equal(regionTester.getPositionRegion(v), 6, `point ${v.x}, ${v.y} in region 6`);
  v.addXY(columnWidth, 0);
  assert.equal(regionTester.getPositionRegion(v), 7, `point ${v.x}, ${v.y} in region 7`);
  v.addXY(columnWidth, 0);
  assert.equal(regionTester.getPositionRegion(v), 8, `point ${v.x}, ${v.y} in region 8`);
});
test('get magnet edge notification', assert => {
  model.reset();
  const regionTester = new MagnetRegionManager(model);
  const halfMagnetWidth = Utils.roundSymmetric(FaradaysLawConstants.MAGNET_WIDTH / 2);
  const halfMagnetHeight = Utils.roundSymmetric(FaradaysLawConstants.MAGNET_HEIGHT / 2);

  // set position to middle of vertical bounds and left edge
  v.setXY(FaradaysLawConstants.LAYOUT_BOUNDS.minX + halfMagnetWidth, FaradaysLawConstants.LAYOUT_BOUNDS.center.y);
  assert.equal(regionTester.isVectorAtEdge(v), true, `${v} is on the edge`);
  v.addXY(5, 0); // edge tolerance is 5, should return false
  assert.equal(regionTester.isVectorAtEdge(v), true, `${v} on edge`);
  v.addXY(1, 0); // edge tolerance is 5, should return false
  assert.equal(regionTester.isVectorAtEdge(v), false, `${v} not on edge`);

  // set position to middle of vertical bounds and left edge
  v.setXY(FaradaysLawConstants.LAYOUT_BOUNDS.maxX - halfMagnetWidth, FaradaysLawConstants.LAYOUT_BOUNDS.center.y);
  assert.equal(regionTester.isVectorAtEdge(v), true, `${v} is on the edge`);
  v.addXY(-5, 0); // edge tolerance is 5, should return false
  assert.equal(regionTester.isVectorAtEdge(v), true, `${v} on edge`);
  v.addXY(-1, 0); // edge tolerance is 5, should return false
  assert.equal(regionTester.isVectorAtEdge(v), false, `${v} not on edge`);
  v.setXY(FaradaysLawConstants.LAYOUT_BOUNDS.center.x, FaradaysLawConstants.LAYOUT_BOUNDS.minY + halfMagnetHeight);
  assert.equal(regionTester.isVectorAtEdge(v), true, `${v} is on the edge`);
  v.addXY(0, 5); // edge tolerance is 5, should return false
  assert.equal(regionTester.isVectorAtEdge(v), true, `${v} on edge`);
  v.addXY(0, 1); // edge tolerance is 5, should return false
  assert.equal(regionTester.isVectorAtEdge(v), false, `${v} not on edge`);
  v.setXY(FaradaysLawConstants.LAYOUT_BOUNDS.center.x, FaradaysLawConstants.LAYOUT_BOUNDS.maxY - halfMagnetHeight);
  assert.equal(regionTester.isVectorAtEdge(v), true, `${v} is on the edge`);
  v.addXY(0, -5); // edge tolerance is 5, should return false
  assert.equal(regionTester.isVectorAtEdge(v), true, `${v} on edge`);
  v.addXY(0, -1); // edge tolerance is 5, should return false
  assert.equal(regionTester.isVectorAtEdge(v), false, `${v} not on edge`);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlZlY3RvcjIiLCJUYW5kZW0iLCJGYXJhZGF5c0xhd0NvbnN0YW50cyIsIkZhcmFkYXlzTGF3TW9kZWwiLCJNYWduZXRSZWdpb25NYW5hZ2VyIiwidGVzdCIsIlFVbml0IiwibW9kZWwiLCJMQVlPVVRfQk9VTkRTIiwiUk9PVF9URVNUIiwiY3JlYXRlVGFuZGVtIiwibW9kdWxlIiwiY29sdW1uV2lkdGgiLCJyb3VuZFN5bW1ldHJpYyIsImdldFdpZHRoIiwicm93SGVpZ2h0IiwiZ2V0SGVpZ2h0IiwieCIsInkiLCJ2IiwiYXNzZXJ0IiwiZXF1YWwiLCJnZXRDb2x1bW4iLCJnZXRSb3ciLCJub3RFcXVhbCIsInJlc2V0IiwicmVnaW9uVGVzdGVyIiwiZ2V0UG9zaXRpb25SZWdpb24iLCJhZGRYWSIsInNldFhZIiwiaGFsZk1hZ25ldFdpZHRoIiwiTUFHTkVUX1dJRFRIIiwiaGFsZk1hZ25ldEhlaWdodCIsIk1BR05FVF9IRUlHSFQiLCJtaW5YIiwiY2VudGVyIiwiaXNWZWN0b3JBdEVkZ2UiLCJtYXhYIiwibWluWSIsIm1heFkiXSwic291cmNlcyI6WyJNYWduZXRSZWdpb25zVGVzdHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMSwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGVzdHMgZm9yIHNjcmVlbiBzdW1tYXJ5IGRlc2NyaXB0aW9ucyBmb3IgYmFsbG9vbnMtYW5kLXN0YXRpYy1lbGVjdHJpY2l0eS4gVGhlc2UgZGVzY3JpcHRpb25zIGFyZSBpbnZpc2libGUsIGJ1dFxyXG4gKiBhdmFpbGFibGUgZm9yIHNjcmVlbiByZWFkZXIgdXNlcnMuXHJcbiAqXHJcbiAqIEBhdXRob3IgTWljaGFlbCBCYXJsb3cgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuLy8gbW9kdWxlc1xyXG4vLyBjb25zdCBGYXJhZGF5c0xhd1NjcmVlblZpZXcgPSByZXF1aXJlKCAnL2ZhcmFkYXlzLWxhdy9qcy9mYXJhZGF5cy1sYXcvdmlldy9GYXJhZGF5c0xhd1NjcmVlblZpZXcnICk7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBGYXJhZGF5c0xhd0NvbnN0YW50cyBmcm9tICcuLi9GYXJhZGF5c0xhd0NvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBGYXJhZGF5c0xhd01vZGVsIGZyb20gJy4uL21vZGVsL0ZhcmFkYXlzTGF3TW9kZWwuanMnO1xyXG5pbXBvcnQgTWFnbmV0UmVnaW9uTWFuYWdlciBmcm9tICcuL01hZ25ldFJlZ2lvbk1hbmFnZXIuanMnO1xyXG5cclxuLy8gY3JlYXRlIG1vZGVsIGFuZCB2aWV3XHJcblxyXG5cclxuY29uc3QgeyB0ZXN0IH0gPSBRVW5pdDtcclxuXHJcbmNvbnN0IG1vZGVsID0gbmV3IEZhcmFkYXlzTGF3TW9kZWwoIEZhcmFkYXlzTGF3Q29uc3RhbnRzLkxBWU9VVF9CT1VORFMsIFRhbmRlbS5ST09UX1RFU1QuY3JlYXRlVGFuZGVtKCAnbW9kZWwnICkgKTtcclxuXHJcblFVbml0Lm1vZHVsZSggJ01hZ25ldFJlZ2lvbk1hbmFnZXInICk7XHJcblxyXG5jb25zdCBjb2x1bW5XaWR0aCA9IFV0aWxzLnJvdW5kU3ltbWV0cmljKCBGYXJhZGF5c0xhd0NvbnN0YW50cy5MQVlPVVRfQk9VTkRTLmdldFdpZHRoKCkgLyAzICk7XHJcbmNvbnN0IHJvd0hlaWdodCA9IFV0aWxzLnJvdW5kU3ltbWV0cmljKCBGYXJhZGF5c0xhd0NvbnN0YW50cy5MQVlPVVRfQk9VTkRTLmdldEhlaWdodCgpIC8gMyApO1xyXG5cclxubGV0IHggPSBjb2x1bW5XaWR0aCAvIDI7IC8vIGNlbnRlciBvZiBjb2wgMVxyXG5sZXQgeSA9IHJvd0hlaWdodCAvIDI7IC8vIGNlbnRlciBvZiByb3cgMVxyXG5jb25zdCB2ID0gbmV3IFZlY3RvcjIoIHgsIHkgKTtcclxuXHJcbnRlc3QoICdnZXQgY29sdW1uIG51bWJlcnMnLCBhc3NlcnQgPT4ge1xyXG4gIGFzc2VydC5lcXVhbCggTWFnbmV0UmVnaW9uTWFuYWdlci5nZXRDb2x1bW4oIHggKSwgMCwgYCR7eH0gaXMgaW4gY29sdW1uIDBgICk7XHJcblxyXG4gIHggKz0gY29sdW1uV2lkdGg7XHJcbiAgYXNzZXJ0LmVxdWFsKCBNYWduZXRSZWdpb25NYW5hZ2VyLmdldENvbHVtbiggeCApLCAxLCBgJHt4fSBpcyBpbiBjb2x1bW4gMWAgKTtcclxuXHJcbiAgeCArPSBjb2x1bW5XaWR0aDtcclxuICBhc3NlcnQuZXF1YWwoIE1hZ25ldFJlZ2lvbk1hbmFnZXIuZ2V0Q29sdW1uKCB4ICksIDIsIGAke3h9IGlzIGluIGNvbHVtbiAyYCApO1xyXG5cclxuICB4ICs9IGNvbHVtbldpZHRoO1xyXG4gIGFzc2VydC5lcXVhbCggTWFnbmV0UmVnaW9uTWFuYWdlci5nZXRDb2x1bW4oIHggKSwgMiwgYCR7eH0gaXMgaW4gY29sdW1uIDJgICk7XHJcblxyXG4gIHggPSAtMTsgLy8gb3V0c2lkZSBsYXlvdXQgYm91bmRzIC0+IHN0aWxsIGNvbCAxXHJcbiAgYXNzZXJ0LmVxdWFsKCBNYWduZXRSZWdpb25NYW5hZ2VyLmdldENvbHVtbiggeCApLCAwLCBgJHt4fSBpcyBpbiBjb2x1bW4gMGAgKTtcclxufSApO1xyXG5cclxudGVzdCggJ2dldCByb3cgbnVtYmVycycsIGFzc2VydCA9PiB7XHJcblxyXG4gIGFzc2VydC5lcXVhbCggTWFnbmV0UmVnaW9uTWFuYWdlci5nZXRSb3coIHkgKSwgMCwgYCR7eX0gaW4gcm93IDBgICk7XHJcblxyXG4gIHkgKz0gcm93SGVpZ2h0O1xyXG4gIGFzc2VydC5ub3RFcXVhbCggTWFnbmV0UmVnaW9uTWFuYWdlci5nZXRSb3coIHkgKSwgMCwgYCR7eX0gbm90IGluIHJvdyAwYCApO1xyXG4gIGFzc2VydC5lcXVhbCggTWFnbmV0UmVnaW9uTWFuYWdlci5nZXRSb3coIHkgKSwgMSwgYCR7eX0gaW4gcm93IDFgICk7XHJcblxyXG4gIHkgKz0gcm93SGVpZ2h0O1xyXG4gIGFzc2VydC5lcXVhbCggTWFnbmV0UmVnaW9uTWFuYWdlci5nZXRSb3coIHkgKSwgMiwgYCR7eX0gaW4gcm93IDJgICk7XHJcblxyXG4gIHkgKz0gcm93SGVpZ2h0O1xyXG4gIGFzc2VydC5lcXVhbCggTWFnbmV0UmVnaW9uTWFuYWdlci5nZXRSb3coIHkgKSwgMiwgYCR7eX0gaW4gcm93IDJgICk7XHJcblxyXG4gIHkgPSAxMDAwO1xyXG4gIGFzc2VydC5lcXVhbCggTWFnbmV0UmVnaW9uTWFuYWdlci5nZXRSb3coIHkgKSwgMiwgYCR7eX0gaW4gcm93IDJgICk7XHJcbn0gKTtcclxuXHJcbnRlc3QoICdnZXQgcmVnaW9uIG51bWJlcnMnLCBhc3NlcnQgPT4ge1xyXG5cclxuICB4ID0gY29sdW1uV2lkdGggLyAyO1xyXG4gIHkgPSByb3dIZWlnaHQgLyAyO1xyXG5cclxuICBtb2RlbC5yZXNldCgpO1xyXG4gIGNvbnN0IHJlZ2lvblRlc3RlciA9IG5ldyBNYWduZXRSZWdpb25NYW5hZ2VyKCBtb2RlbCApO1xyXG5cclxuICBhc3NlcnQuZXF1YWwoIHJlZ2lvblRlc3Rlci5nZXRQb3NpdGlvblJlZ2lvbiggdiApLCAwLCBgcG9pbnQgJHt4fSwgJHt5fSBpbiByZWdpb24gMGAgKTtcclxuXHJcbiAgdi5hZGRYWSggY29sdW1uV2lkdGgsIDAgKTtcclxuICBhc3NlcnQuZXF1YWwoIHJlZ2lvblRlc3Rlci5nZXRQb3NpdGlvblJlZ2lvbiggdiApLCAxLCBgcG9pbnQgJHt2Lnh9LCAke3YueX0gaW4gcmVnaW9uIDFgICk7XHJcblxyXG4gIHYuYWRkWFkoIGNvbHVtbldpZHRoLCAwICk7XHJcbiAgYXNzZXJ0LmVxdWFsKCByZWdpb25UZXN0ZXIuZ2V0UG9zaXRpb25SZWdpb24oIHYgKSwgMiwgYHBvaW50ICR7di54fSwgJHt2Lnl9IGluIHJlZ2lvbiAyYCApO1xyXG5cclxuICB2LnNldFhZKCB4LCB2LnkgKyByb3dIZWlnaHQgKTtcclxuICBhc3NlcnQuZXF1YWwoIHJlZ2lvblRlc3Rlci5nZXRQb3NpdGlvblJlZ2lvbiggdiApLCAzLCBgcG9pbnQgJHt2Lnh9LCAke3YueX0gaW4gcmVnaW9uIDNgICk7XHJcblxyXG4gIHYuYWRkWFkoIGNvbHVtbldpZHRoLCAwICk7XHJcbiAgYXNzZXJ0LmVxdWFsKCByZWdpb25UZXN0ZXIuZ2V0UG9zaXRpb25SZWdpb24oIHYgKSwgNCwgYHBvaW50ICR7di54fSwgJHt2Lnl9IGluIHJlZ2lvbiA0YCApO1xyXG5cclxuICB2LmFkZFhZKCBjb2x1bW5XaWR0aCwgMCApO1xyXG4gIGFzc2VydC5lcXVhbCggcmVnaW9uVGVzdGVyLmdldFBvc2l0aW9uUmVnaW9uKCB2ICksIDUsIGBwb2ludCAke3YueH0sICR7di55fSBpbiByZWdpb24gNWAgKTtcclxuXHJcbiAgdi5zZXRYWSggeCwgdi55ICsgcm93SGVpZ2h0ICk7XHJcbiAgYXNzZXJ0LmVxdWFsKCByZWdpb25UZXN0ZXIuZ2V0UG9zaXRpb25SZWdpb24oIHYgKSwgNiwgYHBvaW50ICR7di54fSwgJHt2Lnl9IGluIHJlZ2lvbiA2YCApO1xyXG5cclxuICB2LmFkZFhZKCBjb2x1bW5XaWR0aCwgMCApO1xyXG4gIGFzc2VydC5lcXVhbCggcmVnaW9uVGVzdGVyLmdldFBvc2l0aW9uUmVnaW9uKCB2ICksIDcsIGBwb2ludCAke3YueH0sICR7di55fSBpbiByZWdpb24gN2AgKTtcclxuXHJcbiAgdi5hZGRYWSggY29sdW1uV2lkdGgsIDAgKTtcclxuICBhc3NlcnQuZXF1YWwoIHJlZ2lvblRlc3Rlci5nZXRQb3NpdGlvblJlZ2lvbiggdiApLCA4LCBgcG9pbnQgJHt2Lnh9LCAke3YueX0gaW4gcmVnaW9uIDhgICk7XHJcbn0gKTtcclxuXHJcbnRlc3QoICdnZXQgbWFnbmV0IGVkZ2Ugbm90aWZpY2F0aW9uJywgYXNzZXJ0ID0+IHtcclxuICBtb2RlbC5yZXNldCgpO1xyXG5cclxuICBjb25zdCByZWdpb25UZXN0ZXIgPSBuZXcgTWFnbmV0UmVnaW9uTWFuYWdlciggbW9kZWwgKTtcclxuXHJcbiAgY29uc3QgaGFsZk1hZ25ldFdpZHRoID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIEZhcmFkYXlzTGF3Q29uc3RhbnRzLk1BR05FVF9XSURUSCAvIDIgKTtcclxuICBjb25zdCBoYWxmTWFnbmV0SGVpZ2h0ID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIEZhcmFkYXlzTGF3Q29uc3RhbnRzLk1BR05FVF9IRUlHSFQgLyAyICk7XHJcblxyXG4gIC8vIHNldCBwb3NpdGlvbiB0byBtaWRkbGUgb2YgdmVydGljYWwgYm91bmRzIGFuZCBsZWZ0IGVkZ2VcclxuICB2LnNldFhZKCBGYXJhZGF5c0xhd0NvbnN0YW50cy5MQVlPVVRfQk9VTkRTLm1pblggKyBoYWxmTWFnbmV0V2lkdGgsIEZhcmFkYXlzTGF3Q29uc3RhbnRzLkxBWU9VVF9CT1VORFMuY2VudGVyLnkgKTtcclxuICBhc3NlcnQuZXF1YWwoIHJlZ2lvblRlc3Rlci5pc1ZlY3RvckF0RWRnZSggdiApLCB0cnVlLCBgJHt2fSBpcyBvbiB0aGUgZWRnZWAgKTtcclxuXHJcbiAgdi5hZGRYWSggNSwgMCApOyAvLyBlZGdlIHRvbGVyYW5jZSBpcyA1LCBzaG91bGQgcmV0dXJuIGZhbHNlXHJcbiAgYXNzZXJ0LmVxdWFsKCByZWdpb25UZXN0ZXIuaXNWZWN0b3JBdEVkZ2UoIHYgKSwgdHJ1ZSwgYCR7dn0gb24gZWRnZWAgKTtcclxuXHJcbiAgdi5hZGRYWSggMSwgMCApOyAvLyBlZGdlIHRvbGVyYW5jZSBpcyA1LCBzaG91bGQgcmV0dXJuIGZhbHNlXHJcbiAgYXNzZXJ0LmVxdWFsKCByZWdpb25UZXN0ZXIuaXNWZWN0b3JBdEVkZ2UoIHYgKSwgZmFsc2UsIGAke3Z9IG5vdCBvbiBlZGdlYCApO1xyXG5cclxuICAvLyBzZXQgcG9zaXRpb24gdG8gbWlkZGxlIG9mIHZlcnRpY2FsIGJvdW5kcyBhbmQgbGVmdCBlZGdlXHJcbiAgdi5zZXRYWSggRmFyYWRheXNMYXdDb25zdGFudHMuTEFZT1VUX0JPVU5EUy5tYXhYIC0gaGFsZk1hZ25ldFdpZHRoLCBGYXJhZGF5c0xhd0NvbnN0YW50cy5MQVlPVVRfQk9VTkRTLmNlbnRlci55ICk7XHJcbiAgYXNzZXJ0LmVxdWFsKCByZWdpb25UZXN0ZXIuaXNWZWN0b3JBdEVkZ2UoIHYgKSwgdHJ1ZSwgYCR7dn0gaXMgb24gdGhlIGVkZ2VgICk7XHJcblxyXG4gIHYuYWRkWFkoIC01LCAwICk7IC8vIGVkZ2UgdG9sZXJhbmNlIGlzIDUsIHNob3VsZCByZXR1cm4gZmFsc2VcclxuICBhc3NlcnQuZXF1YWwoIHJlZ2lvblRlc3Rlci5pc1ZlY3RvckF0RWRnZSggdiApLCB0cnVlLCBgJHt2fSBvbiBlZGdlYCApO1xyXG5cclxuICB2LmFkZFhZKCAtMSwgMCApOyAvLyBlZGdlIHRvbGVyYW5jZSBpcyA1LCBzaG91bGQgcmV0dXJuIGZhbHNlXHJcbiAgYXNzZXJ0LmVxdWFsKCByZWdpb25UZXN0ZXIuaXNWZWN0b3JBdEVkZ2UoIHYgKSwgZmFsc2UsIGAke3Z9IG5vdCBvbiBlZGdlYCApO1xyXG5cclxuICB2LnNldFhZKCBGYXJhZGF5c0xhd0NvbnN0YW50cy5MQVlPVVRfQk9VTkRTLmNlbnRlci54LCBGYXJhZGF5c0xhd0NvbnN0YW50cy5MQVlPVVRfQk9VTkRTLm1pblkgKyBoYWxmTWFnbmV0SGVpZ2h0ICk7XHJcbiAgYXNzZXJ0LmVxdWFsKCByZWdpb25UZXN0ZXIuaXNWZWN0b3JBdEVkZ2UoIHYgKSwgdHJ1ZSwgYCR7dn0gaXMgb24gdGhlIGVkZ2VgICk7XHJcblxyXG4gIHYuYWRkWFkoIDAsIDUgKTsgLy8gZWRnZSB0b2xlcmFuY2UgaXMgNSwgc2hvdWxkIHJldHVybiBmYWxzZVxyXG4gIGFzc2VydC5lcXVhbCggcmVnaW9uVGVzdGVyLmlzVmVjdG9yQXRFZGdlKCB2ICksIHRydWUsIGAke3Z9IG9uIGVkZ2VgICk7XHJcblxyXG4gIHYuYWRkWFkoIDAsIDEgKTsgLy8gZWRnZSB0b2xlcmFuY2UgaXMgNSwgc2hvdWxkIHJldHVybiBmYWxzZVxyXG4gIGFzc2VydC5lcXVhbCggcmVnaW9uVGVzdGVyLmlzVmVjdG9yQXRFZGdlKCB2ICksIGZhbHNlLCBgJHt2fSBub3Qgb24gZWRnZWAgKTtcclxuXHJcbiAgdi5zZXRYWSggRmFyYWRheXNMYXdDb25zdGFudHMuTEFZT1VUX0JPVU5EUy5jZW50ZXIueCwgRmFyYWRheXNMYXdDb25zdGFudHMuTEFZT1VUX0JPVU5EUy5tYXhZIC0gaGFsZk1hZ25ldEhlaWdodCApO1xyXG4gIGFzc2VydC5lcXVhbCggcmVnaW9uVGVzdGVyLmlzVmVjdG9yQXRFZGdlKCB2ICksIHRydWUsIGAke3Z9IGlzIG9uIHRoZSBlZGdlYCApO1xyXG5cclxuICB2LmFkZFhZKCAwLCAtNSApOyAvLyBlZGdlIHRvbGVyYW5jZSBpcyA1LCBzaG91bGQgcmV0dXJuIGZhbHNlXHJcbiAgYXNzZXJ0LmVxdWFsKCByZWdpb25UZXN0ZXIuaXNWZWN0b3JBdEVkZ2UoIHYgKSwgdHJ1ZSwgYCR7dn0gb24gZWRnZWAgKTtcclxuXHJcbiAgdi5hZGRYWSggMCwgLTEgKTsgLy8gZWRnZSB0b2xlcmFuY2UgaXMgNSwgc2hvdWxkIHJldHVybiBmYWxzZVxyXG4gIGFzc2VydC5lcXVhbCggcmVnaW9uVGVzdGVyLmlzVmVjdG9yQXRFZGdlKCB2ICksIGZhbHNlLCBgJHt2fSBub3Qgb24gZWRnZWAgKTtcclxufSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxPQUFPQSxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsTUFBTSxNQUFNLGlDQUFpQztBQUNwRCxPQUFPQyxvQkFBb0IsTUFBTSw0QkFBNEI7QUFDN0QsT0FBT0MsZ0JBQWdCLE1BQU0sOEJBQThCO0FBQzNELE9BQU9DLG1CQUFtQixNQUFNLDBCQUEwQjs7QUFFMUQ7O0FBR0EsTUFBTTtFQUFFQztBQUFLLENBQUMsR0FBR0MsS0FBSztBQUV0QixNQUFNQyxLQUFLLEdBQUcsSUFBSUosZ0JBQWdCLENBQUVELG9CQUFvQixDQUFDTSxhQUFhLEVBQUVQLE1BQU0sQ0FBQ1EsU0FBUyxDQUFDQyxZQUFZLENBQUUsT0FBUSxDQUFFLENBQUM7QUFFbEhKLEtBQUssQ0FBQ0ssTUFBTSxDQUFFLHFCQUFzQixDQUFDO0FBRXJDLE1BQU1DLFdBQVcsR0FBR2IsS0FBSyxDQUFDYyxjQUFjLENBQUVYLG9CQUFvQixDQUFDTSxhQUFhLENBQUNNLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBRSxDQUFDO0FBQzdGLE1BQU1DLFNBQVMsR0FBR2hCLEtBQUssQ0FBQ2MsY0FBYyxDQUFFWCxvQkFBb0IsQ0FBQ00sYUFBYSxDQUFDUSxTQUFTLENBQUMsQ0FBQyxHQUFHLENBQUUsQ0FBQztBQUU1RixJQUFJQyxDQUFDLEdBQUdMLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUN6QixJQUFJTSxDQUFDLEdBQUdILFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUN2QixNQUFNSSxDQUFDLEdBQUcsSUFBSW5CLE9BQU8sQ0FBRWlCLENBQUMsRUFBRUMsQ0FBRSxDQUFDO0FBRTdCYixJQUFJLENBQUUsb0JBQW9CLEVBQUVlLE1BQU0sSUFBSTtFQUNwQ0EsTUFBTSxDQUFDQyxLQUFLLENBQUVqQixtQkFBbUIsQ0FBQ2tCLFNBQVMsQ0FBRUwsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFHLEdBQUVBLENBQUUsaUJBQWlCLENBQUM7RUFFNUVBLENBQUMsSUFBSUwsV0FBVztFQUNoQlEsTUFBTSxDQUFDQyxLQUFLLENBQUVqQixtQkFBbUIsQ0FBQ2tCLFNBQVMsQ0FBRUwsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFHLEdBQUVBLENBQUUsaUJBQWlCLENBQUM7RUFFNUVBLENBQUMsSUFBSUwsV0FBVztFQUNoQlEsTUFBTSxDQUFDQyxLQUFLLENBQUVqQixtQkFBbUIsQ0FBQ2tCLFNBQVMsQ0FBRUwsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFHLEdBQUVBLENBQUUsaUJBQWlCLENBQUM7RUFFNUVBLENBQUMsSUFBSUwsV0FBVztFQUNoQlEsTUFBTSxDQUFDQyxLQUFLLENBQUVqQixtQkFBbUIsQ0FBQ2tCLFNBQVMsQ0FBRUwsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFHLEdBQUVBLENBQUUsaUJBQWlCLENBQUM7RUFFNUVBLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQ1JHLE1BQU0sQ0FBQ0MsS0FBSyxDQUFFakIsbUJBQW1CLENBQUNrQixTQUFTLENBQUVMLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRyxHQUFFQSxDQUFFLGlCQUFpQixDQUFDO0FBQzlFLENBQUUsQ0FBQztBQUVIWixJQUFJLENBQUUsaUJBQWlCLEVBQUVlLE1BQU0sSUFBSTtFQUVqQ0EsTUFBTSxDQUFDQyxLQUFLLENBQUVqQixtQkFBbUIsQ0FBQ21CLE1BQU0sQ0FBRUwsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFHLEdBQUVBLENBQUUsV0FBVyxDQUFDO0VBRW5FQSxDQUFDLElBQUlILFNBQVM7RUFDZEssTUFBTSxDQUFDSSxRQUFRLENBQUVwQixtQkFBbUIsQ0FBQ21CLE1BQU0sQ0FBRUwsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFHLEdBQUVBLENBQUUsZUFBZSxDQUFDO0VBQzFFRSxNQUFNLENBQUNDLEtBQUssQ0FBRWpCLG1CQUFtQixDQUFDbUIsTUFBTSxDQUFFTCxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUcsR0FBRUEsQ0FBRSxXQUFXLENBQUM7RUFFbkVBLENBQUMsSUFBSUgsU0FBUztFQUNkSyxNQUFNLENBQUNDLEtBQUssQ0FBRWpCLG1CQUFtQixDQUFDbUIsTUFBTSxDQUFFTCxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUcsR0FBRUEsQ0FBRSxXQUFXLENBQUM7RUFFbkVBLENBQUMsSUFBSUgsU0FBUztFQUNkSyxNQUFNLENBQUNDLEtBQUssQ0FBRWpCLG1CQUFtQixDQUFDbUIsTUFBTSxDQUFFTCxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUcsR0FBRUEsQ0FBRSxXQUFXLENBQUM7RUFFbkVBLENBQUMsR0FBRyxJQUFJO0VBQ1JFLE1BQU0sQ0FBQ0MsS0FBSyxDQUFFakIsbUJBQW1CLENBQUNtQixNQUFNLENBQUVMLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRyxHQUFFQSxDQUFFLFdBQVcsQ0FBQztBQUNyRSxDQUFFLENBQUM7QUFFSGIsSUFBSSxDQUFFLG9CQUFvQixFQUFFZSxNQUFNLElBQUk7RUFFcENILENBQUMsR0FBR0wsV0FBVyxHQUFHLENBQUM7RUFDbkJNLENBQUMsR0FBR0gsU0FBUyxHQUFHLENBQUM7RUFFakJSLEtBQUssQ0FBQ2tCLEtBQUssQ0FBQyxDQUFDO0VBQ2IsTUFBTUMsWUFBWSxHQUFHLElBQUl0QixtQkFBbUIsQ0FBRUcsS0FBTSxDQUFDO0VBRXJEYSxNQUFNLENBQUNDLEtBQUssQ0FBRUssWUFBWSxDQUFDQyxpQkFBaUIsQ0FBRVIsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFHLFNBQVFGLENBQUUsS0FBSUMsQ0FBRSxjQUFjLENBQUM7RUFFdEZDLENBQUMsQ0FBQ1MsS0FBSyxDQUFFaEIsV0FBVyxFQUFFLENBQUUsQ0FBQztFQUN6QlEsTUFBTSxDQUFDQyxLQUFLLENBQUVLLFlBQVksQ0FBQ0MsaUJBQWlCLENBQUVSLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRyxTQUFRQSxDQUFDLENBQUNGLENBQUUsS0FBSUUsQ0FBQyxDQUFDRCxDQUFFLGNBQWMsQ0FBQztFQUUxRkMsQ0FBQyxDQUFDUyxLQUFLLENBQUVoQixXQUFXLEVBQUUsQ0FBRSxDQUFDO0VBQ3pCUSxNQUFNLENBQUNDLEtBQUssQ0FBRUssWUFBWSxDQUFDQyxpQkFBaUIsQ0FBRVIsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFHLFNBQVFBLENBQUMsQ0FBQ0YsQ0FBRSxLQUFJRSxDQUFDLENBQUNELENBQUUsY0FBYyxDQUFDO0VBRTFGQyxDQUFDLENBQUNVLEtBQUssQ0FBRVosQ0FBQyxFQUFFRSxDQUFDLENBQUNELENBQUMsR0FBR0gsU0FBVSxDQUFDO0VBQzdCSyxNQUFNLENBQUNDLEtBQUssQ0FBRUssWUFBWSxDQUFDQyxpQkFBaUIsQ0FBRVIsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFHLFNBQVFBLENBQUMsQ0FBQ0YsQ0FBRSxLQUFJRSxDQUFDLENBQUNELENBQUUsY0FBYyxDQUFDO0VBRTFGQyxDQUFDLENBQUNTLEtBQUssQ0FBRWhCLFdBQVcsRUFBRSxDQUFFLENBQUM7RUFDekJRLE1BQU0sQ0FBQ0MsS0FBSyxDQUFFSyxZQUFZLENBQUNDLGlCQUFpQixDQUFFUixDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUcsU0FBUUEsQ0FBQyxDQUFDRixDQUFFLEtBQUlFLENBQUMsQ0FBQ0QsQ0FBRSxjQUFjLENBQUM7RUFFMUZDLENBQUMsQ0FBQ1MsS0FBSyxDQUFFaEIsV0FBVyxFQUFFLENBQUUsQ0FBQztFQUN6QlEsTUFBTSxDQUFDQyxLQUFLLENBQUVLLFlBQVksQ0FBQ0MsaUJBQWlCLENBQUVSLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRyxTQUFRQSxDQUFDLENBQUNGLENBQUUsS0FBSUUsQ0FBQyxDQUFDRCxDQUFFLGNBQWMsQ0FBQztFQUUxRkMsQ0FBQyxDQUFDVSxLQUFLLENBQUVaLENBQUMsRUFBRUUsQ0FBQyxDQUFDRCxDQUFDLEdBQUdILFNBQVUsQ0FBQztFQUM3QkssTUFBTSxDQUFDQyxLQUFLLENBQUVLLFlBQVksQ0FBQ0MsaUJBQWlCLENBQUVSLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRyxTQUFRQSxDQUFDLENBQUNGLENBQUUsS0FBSUUsQ0FBQyxDQUFDRCxDQUFFLGNBQWMsQ0FBQztFQUUxRkMsQ0FBQyxDQUFDUyxLQUFLLENBQUVoQixXQUFXLEVBQUUsQ0FBRSxDQUFDO0VBQ3pCUSxNQUFNLENBQUNDLEtBQUssQ0FBRUssWUFBWSxDQUFDQyxpQkFBaUIsQ0FBRVIsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFHLFNBQVFBLENBQUMsQ0FBQ0YsQ0FBRSxLQUFJRSxDQUFDLENBQUNELENBQUUsY0FBYyxDQUFDO0VBRTFGQyxDQUFDLENBQUNTLEtBQUssQ0FBRWhCLFdBQVcsRUFBRSxDQUFFLENBQUM7RUFDekJRLE1BQU0sQ0FBQ0MsS0FBSyxDQUFFSyxZQUFZLENBQUNDLGlCQUFpQixDQUFFUixDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUcsU0FBUUEsQ0FBQyxDQUFDRixDQUFFLEtBQUlFLENBQUMsQ0FBQ0QsQ0FBRSxjQUFjLENBQUM7QUFDNUYsQ0FBRSxDQUFDO0FBRUhiLElBQUksQ0FBRSw4QkFBOEIsRUFBRWUsTUFBTSxJQUFJO0VBQzlDYixLQUFLLENBQUNrQixLQUFLLENBQUMsQ0FBQztFQUViLE1BQU1DLFlBQVksR0FBRyxJQUFJdEIsbUJBQW1CLENBQUVHLEtBQU0sQ0FBQztFQUVyRCxNQUFNdUIsZUFBZSxHQUFHL0IsS0FBSyxDQUFDYyxjQUFjLENBQUVYLG9CQUFvQixDQUFDNkIsWUFBWSxHQUFHLENBQUUsQ0FBQztFQUNyRixNQUFNQyxnQkFBZ0IsR0FBR2pDLEtBQUssQ0FBQ2MsY0FBYyxDQUFFWCxvQkFBb0IsQ0FBQytCLGFBQWEsR0FBRyxDQUFFLENBQUM7O0VBRXZGO0VBQ0FkLENBQUMsQ0FBQ1UsS0FBSyxDQUFFM0Isb0JBQW9CLENBQUNNLGFBQWEsQ0FBQzBCLElBQUksR0FBR0osZUFBZSxFQUFFNUIsb0JBQW9CLENBQUNNLGFBQWEsQ0FBQzJCLE1BQU0sQ0FBQ2pCLENBQUUsQ0FBQztFQUNqSEUsTUFBTSxDQUFDQyxLQUFLLENBQUVLLFlBQVksQ0FBQ1UsY0FBYyxDQUFFakIsQ0FBRSxDQUFDLEVBQUUsSUFBSSxFQUFHLEdBQUVBLENBQUUsaUJBQWlCLENBQUM7RUFFN0VBLENBQUMsQ0FBQ1MsS0FBSyxDQUFFLENBQUMsRUFBRSxDQUFFLENBQUMsQ0FBQyxDQUFDO0VBQ2pCUixNQUFNLENBQUNDLEtBQUssQ0FBRUssWUFBWSxDQUFDVSxjQUFjLENBQUVqQixDQUFFLENBQUMsRUFBRSxJQUFJLEVBQUcsR0FBRUEsQ0FBRSxVQUFVLENBQUM7RUFFdEVBLENBQUMsQ0FBQ1MsS0FBSyxDQUFFLENBQUMsRUFBRSxDQUFFLENBQUMsQ0FBQyxDQUFDO0VBQ2pCUixNQUFNLENBQUNDLEtBQUssQ0FBRUssWUFBWSxDQUFDVSxjQUFjLENBQUVqQixDQUFFLENBQUMsRUFBRSxLQUFLLEVBQUcsR0FBRUEsQ0FBRSxjQUFjLENBQUM7O0VBRTNFO0VBQ0FBLENBQUMsQ0FBQ1UsS0FBSyxDQUFFM0Isb0JBQW9CLENBQUNNLGFBQWEsQ0FBQzZCLElBQUksR0FBR1AsZUFBZSxFQUFFNUIsb0JBQW9CLENBQUNNLGFBQWEsQ0FBQzJCLE1BQU0sQ0FBQ2pCLENBQUUsQ0FBQztFQUNqSEUsTUFBTSxDQUFDQyxLQUFLLENBQUVLLFlBQVksQ0FBQ1UsY0FBYyxDQUFFakIsQ0FBRSxDQUFDLEVBQUUsSUFBSSxFQUFHLEdBQUVBLENBQUUsaUJBQWlCLENBQUM7RUFFN0VBLENBQUMsQ0FBQ1MsS0FBSyxDQUFFLENBQUMsQ0FBQyxFQUFFLENBQUUsQ0FBQyxDQUFDLENBQUM7RUFDbEJSLE1BQU0sQ0FBQ0MsS0FBSyxDQUFFSyxZQUFZLENBQUNVLGNBQWMsQ0FBRWpCLENBQUUsQ0FBQyxFQUFFLElBQUksRUFBRyxHQUFFQSxDQUFFLFVBQVUsQ0FBQztFQUV0RUEsQ0FBQyxDQUFDUyxLQUFLLENBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBRSxDQUFDLENBQUMsQ0FBQztFQUNsQlIsTUFBTSxDQUFDQyxLQUFLLENBQUVLLFlBQVksQ0FBQ1UsY0FBYyxDQUFFakIsQ0FBRSxDQUFDLEVBQUUsS0FBSyxFQUFHLEdBQUVBLENBQUUsY0FBYyxDQUFDO0VBRTNFQSxDQUFDLENBQUNVLEtBQUssQ0FBRTNCLG9CQUFvQixDQUFDTSxhQUFhLENBQUMyQixNQUFNLENBQUNsQixDQUFDLEVBQUVmLG9CQUFvQixDQUFDTSxhQUFhLENBQUM4QixJQUFJLEdBQUdOLGdCQUFpQixDQUFDO0VBQ2xIWixNQUFNLENBQUNDLEtBQUssQ0FBRUssWUFBWSxDQUFDVSxjQUFjLENBQUVqQixDQUFFLENBQUMsRUFBRSxJQUFJLEVBQUcsR0FBRUEsQ0FBRSxpQkFBaUIsQ0FBQztFQUU3RUEsQ0FBQyxDQUFDUyxLQUFLLENBQUUsQ0FBQyxFQUFFLENBQUUsQ0FBQyxDQUFDLENBQUM7RUFDakJSLE1BQU0sQ0FBQ0MsS0FBSyxDQUFFSyxZQUFZLENBQUNVLGNBQWMsQ0FBRWpCLENBQUUsQ0FBQyxFQUFFLElBQUksRUFBRyxHQUFFQSxDQUFFLFVBQVUsQ0FBQztFQUV0RUEsQ0FBQyxDQUFDUyxLQUFLLENBQUUsQ0FBQyxFQUFFLENBQUUsQ0FBQyxDQUFDLENBQUM7RUFDakJSLE1BQU0sQ0FBQ0MsS0FBSyxDQUFFSyxZQUFZLENBQUNVLGNBQWMsQ0FBRWpCLENBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRyxHQUFFQSxDQUFFLGNBQWMsQ0FBQztFQUUzRUEsQ0FBQyxDQUFDVSxLQUFLLENBQUUzQixvQkFBb0IsQ0FBQ00sYUFBYSxDQUFDMkIsTUFBTSxDQUFDbEIsQ0FBQyxFQUFFZixvQkFBb0IsQ0FBQ00sYUFBYSxDQUFDK0IsSUFBSSxHQUFHUCxnQkFBaUIsQ0FBQztFQUNsSFosTUFBTSxDQUFDQyxLQUFLLENBQUVLLFlBQVksQ0FBQ1UsY0FBYyxDQUFFakIsQ0FBRSxDQUFDLEVBQUUsSUFBSSxFQUFHLEdBQUVBLENBQUUsaUJBQWlCLENBQUM7RUFFN0VBLENBQUMsQ0FBQ1MsS0FBSyxDQUFFLENBQUMsRUFBRSxDQUFDLENBQUUsQ0FBQyxDQUFDLENBQUM7RUFDbEJSLE1BQU0sQ0FBQ0MsS0FBSyxDQUFFSyxZQUFZLENBQUNVLGNBQWMsQ0FBRWpCLENBQUUsQ0FBQyxFQUFFLElBQUksRUFBRyxHQUFFQSxDQUFFLFVBQVUsQ0FBQztFQUV0RUEsQ0FBQyxDQUFDUyxLQUFLLENBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBRSxDQUFDLENBQUMsQ0FBQztFQUNsQlIsTUFBTSxDQUFDQyxLQUFLLENBQUVLLFlBQVksQ0FBQ1UsY0FBYyxDQUFFakIsQ0FBRSxDQUFDLEVBQUUsS0FBSyxFQUFHLEdBQUVBLENBQUUsY0FBYyxDQUFDO0FBQzdFLENBQUUsQ0FBQyJ9