// Copyright 2020-2022, University of Colorado Boulder

/**
 * Subclass of Rectangle that represents the amplitude of a normal mode in Two Dimensions.
 * It can be clicked to change the amplitude according to the following (the original sim behaviour):
 *  - If the current amplitude is not 'near' the maximum amplitude value, set it to the maximum value;
 *  - If it is 'near', set it to 0.
 * In our case, 'near' is arbitrarily defined.
 * The maximum amplitude values are calculated in TwoDimensionConstants in the same way the original sim does.
 *
 * @author Franco Barpp Gomes (UTFPR)
 * @author Thiago de Mendon√ßa Mildemberger (UTFPR)
 */

import merge from '../../../../phet-core/js/merge.js';
import { FireListener, Rectangle } from '../../../../scenery/js/imports.js';
import AmplitudeDirection from '../../common/model/AmplitudeDirection.js';
import NormalModesColors from '../../common/NormalModesColors.js';
import NormalModesConstants from '../../common/NormalModesConstants.js';
import normalModes from '../../normalModes.js';
class AmplitudeSelectorRectangle extends Rectangle {
  /**
   * @param {TwoDimensionsModel} model
   * @param {number} row
   * @param {number} col
   * @param {DerivedProperty.<Property.<number>[][]>} axisAmplitudesProperty
   * @param {DerivedProperty.<number>} maxAmplitudeProperty
   * @param {DerivedProperty.<number>} gridToRealSizeRatioProperty
   * @param {Object} [options]
   */
  constructor(model, row, col, axisAmplitudesProperty, maxAmplitudeProperty, gridToRealSizeRatioProperty, options) {
    options = merge({
      boundsMethod: 'none',
      left: 0,
      top: 0,
      cursor: 'pointer',
      rectWidth: 1,
      /* just a default value */
      rectHeight: 1,
      /* just a default value */
      cornerRadius: 2,
      lineWidth: 1,
      stroke: NormalModesColors.BUTTON_COLORS.stroke,
      fill: NormalModesColors.SELECTOR_HORIZONTAL_FILL,
      fillX: NormalModesColors.SELECTOR_HORIZONTAL_FILL,
      fillY: NormalModesColors.SELECTOR_VERTICAL_FILL,
      backgroundRect: {
        preventFit: true,
        boundsMethod: 'none',
        left: 0,
        top: 0,
        fill: NormalModesColors.BACKGROUND_RECTANGLE_DEFAULT_FILL,
        rectWidth: 1,
        /* just a default value */
        rectHeight: 0,
        cornerRadius: 2
      },
      rectGridSize: 5,
      paddingGridSize: 1
    }, options);
    super(options);
    const backgroundRect = new Rectangle(options.backgroundRect);
    this.addChild(backgroundRect);
    const amplitudeChanged = (amplitude, axis) => {
      if (model.amplitudeDirectionProperty.get() === axis) {
        const maxAmplitude = maxAmplitudeProperty.get();
        const heightFactor = Math.min(1, amplitude / maxAmplitude);
        backgroundRect.rectHeight = this.rectHeight * (1 - heightFactor);
      }
    };
    const numberOfMassesChanged = numberOfMasses => {
      if (row < numberOfMasses && col < numberOfMasses) {
        this.visible = true;
        this.rectWidth = this.rectHeight = options.rectGridSize * gridToRealSizeRatioProperty.get();
        backgroundRect.rectWidth = this.rectWidth;
        amplitudeChanged(axisAmplitudesProperty.get()[row][col].get(), model.amplitudeDirectionProperty.get());
        const gridLeft = col * (options.paddingGridSize + options.rectGridSize);
        const gridTop = row * (options.paddingGridSize + options.rectGridSize);
        this.left = gridToRealSizeRatioProperty.get() * gridLeft;
        this.top = gridToRealSizeRatioProperty.get() * gridTop;
      } else {
        this.visible = false;
      }
    };
    const amplitudeDirectionChanged = amplitudeDirection => {
      this.fill = amplitudeDirection === AmplitudeDirection.VERTICAL ? options.fillY : options.fillX;
      amplitudeChanged(axisAmplitudesProperty.get()[row][col].get(), amplitudeDirection);
    };

    // unlink is unnecessary, exists for the lifetime of the sim
    model.modeXAmplitudeProperties[row][col].link(amplitude => {
      amplitudeChanged(amplitude, AmplitudeDirection.HORIZONTAL);
    });
    // unlink is unnecessary, exists for the lifetime of the sim
    model.modeYAmplitudeProperties[row][col].link(amplitude => {
      amplitudeChanged(amplitude, AmplitudeDirection.VERTICAL);
    });

    // unlink is unnecessary, exists for the lifetime of the sim
    model.numberOfMassesProperty.link(numberOfMassesChanged);

    // unlink is unnecessary, exists for the lifetime of the sim
    model.amplitudeDirectionProperty.link(amplitudeDirectionChanged);
    const isNear = (n1, n2) => {
      const EPS = 10e-5;
      return n1 >= n2 - EPS && n1 <= n2 + EPS;
    };
    this.addInputListener(new FireListener({
      fire: () => {
        const amplitude = axisAmplitudesProperty.get()[row][col];
        if (isNear(amplitude.get(), maxAmplitudeProperty.get())) {
          amplitude.set(NormalModesConstants.MIN_AMPLITUDE);
        } else {
          amplitude.set(maxAmplitudeProperty.get());
        }
      }
    }));
  }
}
normalModes.register('AmplitudeSelectorRectangle', AmplitudeSelectorRectangle);
export default AmplitudeSelectorRectangle;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtZXJnZSIsIkZpcmVMaXN0ZW5lciIsIlJlY3RhbmdsZSIsIkFtcGxpdHVkZURpcmVjdGlvbiIsIk5vcm1hbE1vZGVzQ29sb3JzIiwiTm9ybWFsTW9kZXNDb25zdGFudHMiLCJub3JtYWxNb2RlcyIsIkFtcGxpdHVkZVNlbGVjdG9yUmVjdGFuZ2xlIiwiY29uc3RydWN0b3IiLCJtb2RlbCIsInJvdyIsImNvbCIsImF4aXNBbXBsaXR1ZGVzUHJvcGVydHkiLCJtYXhBbXBsaXR1ZGVQcm9wZXJ0eSIsImdyaWRUb1JlYWxTaXplUmF0aW9Qcm9wZXJ0eSIsIm9wdGlvbnMiLCJib3VuZHNNZXRob2QiLCJsZWZ0IiwidG9wIiwiY3Vyc29yIiwicmVjdFdpZHRoIiwicmVjdEhlaWdodCIsImNvcm5lclJhZGl1cyIsImxpbmVXaWR0aCIsInN0cm9rZSIsIkJVVFRPTl9DT0xPUlMiLCJmaWxsIiwiU0VMRUNUT1JfSE9SSVpPTlRBTF9GSUxMIiwiZmlsbFgiLCJmaWxsWSIsIlNFTEVDVE9SX1ZFUlRJQ0FMX0ZJTEwiLCJiYWNrZ3JvdW5kUmVjdCIsInByZXZlbnRGaXQiLCJCQUNLR1JPVU5EX1JFQ1RBTkdMRV9ERUZBVUxUX0ZJTEwiLCJyZWN0R3JpZFNpemUiLCJwYWRkaW5nR3JpZFNpemUiLCJhZGRDaGlsZCIsImFtcGxpdHVkZUNoYW5nZWQiLCJhbXBsaXR1ZGUiLCJheGlzIiwiYW1wbGl0dWRlRGlyZWN0aW9uUHJvcGVydHkiLCJnZXQiLCJtYXhBbXBsaXR1ZGUiLCJoZWlnaHRGYWN0b3IiLCJNYXRoIiwibWluIiwibnVtYmVyT2ZNYXNzZXNDaGFuZ2VkIiwibnVtYmVyT2ZNYXNzZXMiLCJ2aXNpYmxlIiwiZ3JpZExlZnQiLCJncmlkVG9wIiwiYW1wbGl0dWRlRGlyZWN0aW9uQ2hhbmdlZCIsImFtcGxpdHVkZURpcmVjdGlvbiIsIlZFUlRJQ0FMIiwibW9kZVhBbXBsaXR1ZGVQcm9wZXJ0aWVzIiwibGluayIsIkhPUklaT05UQUwiLCJtb2RlWUFtcGxpdHVkZVByb3BlcnRpZXMiLCJudW1iZXJPZk1hc3Nlc1Byb3BlcnR5IiwiaXNOZWFyIiwibjEiLCJuMiIsIkVQUyIsImFkZElucHV0TGlzdGVuZXIiLCJmaXJlIiwic2V0IiwiTUlOX0FNUExJVFVERSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQW1wbGl0dWRlU2VsZWN0b3JSZWN0YW5nbGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjAtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU3ViY2xhc3Mgb2YgUmVjdGFuZ2xlIHRoYXQgcmVwcmVzZW50cyB0aGUgYW1wbGl0dWRlIG9mIGEgbm9ybWFsIG1vZGUgaW4gVHdvIERpbWVuc2lvbnMuXHJcbiAqIEl0IGNhbiBiZSBjbGlja2VkIHRvIGNoYW5nZSB0aGUgYW1wbGl0dWRlIGFjY29yZGluZyB0byB0aGUgZm9sbG93aW5nICh0aGUgb3JpZ2luYWwgc2ltIGJlaGF2aW91cik6XHJcbiAqICAtIElmIHRoZSBjdXJyZW50IGFtcGxpdHVkZSBpcyBub3QgJ25lYXInIHRoZSBtYXhpbXVtIGFtcGxpdHVkZSB2YWx1ZSwgc2V0IGl0IHRvIHRoZSBtYXhpbXVtIHZhbHVlO1xyXG4gKiAgLSBJZiBpdCBpcyAnbmVhcicsIHNldCBpdCB0byAwLlxyXG4gKiBJbiBvdXIgY2FzZSwgJ25lYXInIGlzIGFyYml0cmFyaWx5IGRlZmluZWQuXHJcbiAqIFRoZSBtYXhpbXVtIGFtcGxpdHVkZSB2YWx1ZXMgYXJlIGNhbGN1bGF0ZWQgaW4gVHdvRGltZW5zaW9uQ29uc3RhbnRzIGluIHRoZSBzYW1lIHdheSB0aGUgb3JpZ2luYWwgc2ltIGRvZXMuXHJcbiAqXHJcbiAqIEBhdXRob3IgRnJhbmNvIEJhcnBwIEdvbWVzIChVVEZQUilcclxuICogQGF1dGhvciBUaGlhZ28gZGUgTWVuZG9uw6dhIE1pbGRlbWJlcmdlciAoVVRGUFIpXHJcbiAqL1xyXG5cclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCB7IEZpcmVMaXN0ZW5lciwgUmVjdGFuZ2xlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEFtcGxpdHVkZURpcmVjdGlvbiBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvQW1wbGl0dWRlRGlyZWN0aW9uLmpzJztcclxuaW1wb3J0IE5vcm1hbE1vZGVzQ29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi9Ob3JtYWxNb2Rlc0NvbG9ycy5qcyc7XHJcbmltcG9ydCBOb3JtYWxNb2Rlc0NvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vTm9ybWFsTW9kZXNDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgbm9ybWFsTW9kZXMgZnJvbSAnLi4vLi4vbm9ybWFsTW9kZXMuanMnO1xyXG5cclxuY2xhc3MgQW1wbGl0dWRlU2VsZWN0b3JSZWN0YW5nbGUgZXh0ZW5kcyBSZWN0YW5nbGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1R3b0RpbWVuc2lvbnNNb2RlbH0gbW9kZWxcclxuICAgKiBAcGFyYW0ge251bWJlcn0gcm93XHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGNvbFxyXG4gICAqIEBwYXJhbSB7RGVyaXZlZFByb3BlcnR5LjxQcm9wZXJ0eS48bnVtYmVyPltdW10+fSBheGlzQW1wbGl0dWRlc1Byb3BlcnR5XHJcbiAgICogQHBhcmFtIHtEZXJpdmVkUHJvcGVydHkuPG51bWJlcj59IG1heEFtcGxpdHVkZVByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtEZXJpdmVkUHJvcGVydHkuPG51bWJlcj59IGdyaWRUb1JlYWxTaXplUmF0aW9Qcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbW9kZWwsIHJvdywgY29sLCBheGlzQW1wbGl0dWRlc1Byb3BlcnR5LCBtYXhBbXBsaXR1ZGVQcm9wZXJ0eSwgZ3JpZFRvUmVhbFNpemVSYXRpb1Byb3BlcnR5LCBvcHRpb25zICkge1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG4gICAgICBib3VuZHNNZXRob2Q6ICdub25lJyxcclxuICAgICAgbGVmdDogMCxcclxuICAgICAgdG9wOiAwLFxyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcclxuICAgICAgcmVjdFdpZHRoOiAxLCAvKiBqdXN0IGEgZGVmYXVsdCB2YWx1ZSAqL1xyXG4gICAgICByZWN0SGVpZ2h0OiAxLCAvKiBqdXN0IGEgZGVmYXVsdCB2YWx1ZSAqL1xyXG4gICAgICBjb3JuZXJSYWRpdXM6IDIsXHJcbiAgICAgIGxpbmVXaWR0aDogMSxcclxuICAgICAgc3Ryb2tlOiBOb3JtYWxNb2Rlc0NvbG9ycy5CVVRUT05fQ09MT1JTLnN0cm9rZSxcclxuICAgICAgZmlsbDogTm9ybWFsTW9kZXNDb2xvcnMuU0VMRUNUT1JfSE9SSVpPTlRBTF9GSUxMLFxyXG4gICAgICBmaWxsWDogTm9ybWFsTW9kZXNDb2xvcnMuU0VMRUNUT1JfSE9SSVpPTlRBTF9GSUxMLFxyXG4gICAgICBmaWxsWTogTm9ybWFsTW9kZXNDb2xvcnMuU0VMRUNUT1JfVkVSVElDQUxfRklMTCxcclxuICAgICAgYmFja2dyb3VuZFJlY3Q6IHtcclxuICAgICAgICBwcmV2ZW50Rml0OiB0cnVlLFxyXG4gICAgICAgIGJvdW5kc01ldGhvZDogJ25vbmUnLFxyXG4gICAgICAgIGxlZnQ6IDAsXHJcbiAgICAgICAgdG9wOiAwLFxyXG4gICAgICAgIGZpbGw6IE5vcm1hbE1vZGVzQ29sb3JzLkJBQ0tHUk9VTkRfUkVDVEFOR0xFX0RFRkFVTFRfRklMTCxcclxuICAgICAgICByZWN0V2lkdGg6IDEsIC8qIGp1c3QgYSBkZWZhdWx0IHZhbHVlICovXHJcbiAgICAgICAgcmVjdEhlaWdodDogMCxcclxuICAgICAgICBjb3JuZXJSYWRpdXM6IDJcclxuICAgICAgfSxcclxuICAgICAgcmVjdEdyaWRTaXplOiA1LFxyXG4gICAgICBwYWRkaW5nR3JpZFNpemU6IDFcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IGJhY2tncm91bmRSZWN0ID0gbmV3IFJlY3RhbmdsZSggb3B0aW9ucy5iYWNrZ3JvdW5kUmVjdCApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggYmFja2dyb3VuZFJlY3QgKTtcclxuXHJcbiAgICBjb25zdCBhbXBsaXR1ZGVDaGFuZ2VkID0gKCBhbXBsaXR1ZGUsIGF4aXMgKSA9PiB7XHJcbiAgICAgIGlmICggbW9kZWwuYW1wbGl0dWRlRGlyZWN0aW9uUHJvcGVydHkuZ2V0KCkgPT09IGF4aXMgKSB7XHJcbiAgICAgICAgY29uc3QgbWF4QW1wbGl0dWRlID0gbWF4QW1wbGl0dWRlUHJvcGVydHkuZ2V0KCk7XHJcbiAgICAgICAgY29uc3QgaGVpZ2h0RmFjdG9yID0gTWF0aC5taW4oIDEsIGFtcGxpdHVkZSAvIG1heEFtcGxpdHVkZSApO1xyXG4gICAgICAgIGJhY2tncm91bmRSZWN0LnJlY3RIZWlnaHQgPSB0aGlzLnJlY3RIZWlnaHQgKiAoIDEgLSBoZWlnaHRGYWN0b3IgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBudW1iZXJPZk1hc3Nlc0NoYW5nZWQgPSBudW1iZXJPZk1hc3NlcyA9PiB7XHJcbiAgICAgIGlmICggcm93IDwgbnVtYmVyT2ZNYXNzZXMgJiYgY29sIDwgbnVtYmVyT2ZNYXNzZXMgKSB7XHJcbiAgICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnJlY3RXaWR0aCA9IHRoaXMucmVjdEhlaWdodCA9IG9wdGlvbnMucmVjdEdyaWRTaXplICogZ3JpZFRvUmVhbFNpemVSYXRpb1Byb3BlcnR5LmdldCgpO1xyXG5cclxuICAgICAgICBiYWNrZ3JvdW5kUmVjdC5yZWN0V2lkdGggPSB0aGlzLnJlY3RXaWR0aDtcclxuICAgICAgICBhbXBsaXR1ZGVDaGFuZ2VkKCBheGlzQW1wbGl0dWRlc1Byb3BlcnR5LmdldCgpWyByb3cgXVsgY29sIF0uZ2V0KCksIG1vZGVsLmFtcGxpdHVkZURpcmVjdGlvblByb3BlcnR5LmdldCgpICk7XHJcblxyXG4gICAgICAgIGNvbnN0IGdyaWRMZWZ0ID0gY29sICogKCBvcHRpb25zLnBhZGRpbmdHcmlkU2l6ZSArIG9wdGlvbnMucmVjdEdyaWRTaXplICk7XHJcbiAgICAgICAgY29uc3QgZ3JpZFRvcCA9IHJvdyAqICggb3B0aW9ucy5wYWRkaW5nR3JpZFNpemUgKyBvcHRpb25zLnJlY3RHcmlkU2l6ZSApO1xyXG5cclxuICAgICAgICB0aGlzLmxlZnQgPSBncmlkVG9SZWFsU2l6ZVJhdGlvUHJvcGVydHkuZ2V0KCkgKiBncmlkTGVmdDtcclxuICAgICAgICB0aGlzLnRvcCA9IGdyaWRUb1JlYWxTaXplUmF0aW9Qcm9wZXJ0eS5nZXQoKSAqIGdyaWRUb3A7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdGhpcy52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgYW1wbGl0dWRlRGlyZWN0aW9uQ2hhbmdlZCA9IGFtcGxpdHVkZURpcmVjdGlvbiA9PiB7XHJcbiAgICAgIHRoaXMuZmlsbCA9ICggYW1wbGl0dWRlRGlyZWN0aW9uID09PSBBbXBsaXR1ZGVEaXJlY3Rpb24uVkVSVElDQUwgKSA/IG9wdGlvbnMuZmlsbFkgOiBvcHRpb25zLmZpbGxYO1xyXG4gICAgICBhbXBsaXR1ZGVDaGFuZ2VkKCBheGlzQW1wbGl0dWRlc1Byb3BlcnR5LmdldCgpWyByb3cgXVsgY29sIF0uZ2V0KCksIGFtcGxpdHVkZURpcmVjdGlvbiApO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyB1bmxpbmsgaXMgdW5uZWNlc3NhcnksIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW1cclxuICAgIG1vZGVsLm1vZGVYQW1wbGl0dWRlUHJvcGVydGllc1sgcm93IF1bIGNvbCBdLmxpbmsoIGFtcGxpdHVkZSA9PiB7XHJcbiAgICAgIGFtcGxpdHVkZUNoYW5nZWQoIGFtcGxpdHVkZSwgQW1wbGl0dWRlRGlyZWN0aW9uLkhPUklaT05UQUwgKTtcclxuICAgIH0gKTtcclxuICAgIC8vIHVubGluayBpcyB1bm5lY2Vzc2FyeSwgZXhpc3RzIGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIHNpbVxyXG4gICAgbW9kZWwubW9kZVlBbXBsaXR1ZGVQcm9wZXJ0aWVzWyByb3cgXVsgY29sIF0ubGluayggYW1wbGl0dWRlID0+IHtcclxuICAgICAgYW1wbGl0dWRlQ2hhbmdlZCggYW1wbGl0dWRlLCBBbXBsaXR1ZGVEaXJlY3Rpb24uVkVSVElDQUwgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB1bmxpbmsgaXMgdW5uZWNlc3NhcnksIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW1cclxuICAgIG1vZGVsLm51bWJlck9mTWFzc2VzUHJvcGVydHkubGluayggbnVtYmVyT2ZNYXNzZXNDaGFuZ2VkICk7XHJcblxyXG4gICAgLy8gdW5saW5rIGlzIHVubmVjZXNzYXJ5LCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltXHJcbiAgICBtb2RlbC5hbXBsaXR1ZGVEaXJlY3Rpb25Qcm9wZXJ0eS5saW5rKCBhbXBsaXR1ZGVEaXJlY3Rpb25DaGFuZ2VkICk7XHJcblxyXG4gICAgY29uc3QgaXNOZWFyID0gKCBuMSwgbjIgKSA9PiB7XHJcbiAgICAgIGNvbnN0IEVQUyA9IDEwZS01O1xyXG4gICAgICByZXR1cm4gbjEgPj0gKCBuMiAtIEVQUyApICYmIG4xIDw9ICggbjIgKyBFUFMgKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5hZGRJbnB1dExpc3RlbmVyKCBuZXcgRmlyZUxpc3RlbmVyKCB7XHJcbiAgICAgIGZpcmU6ICgpID0+IHtcclxuICAgICAgICBjb25zdCBhbXBsaXR1ZGUgPSBheGlzQW1wbGl0dWRlc1Byb3BlcnR5LmdldCgpWyByb3cgXVsgY29sIF07XHJcblxyXG4gICAgICAgIGlmICggaXNOZWFyKCBhbXBsaXR1ZGUuZ2V0KCksIG1heEFtcGxpdHVkZVByb3BlcnR5LmdldCgpICkgKSB7XHJcbiAgICAgICAgICBhbXBsaXR1ZGUuc2V0KCBOb3JtYWxNb2Rlc0NvbnN0YW50cy5NSU5fQU1QTElUVURFICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgYW1wbGl0dWRlLnNldCggbWF4QW1wbGl0dWRlUHJvcGVydHkuZ2V0KCkgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICB9XHJcbiAgICB9ICkgKTtcclxuICB9XHJcbn1cclxuXHJcbm5vcm1hbE1vZGVzLnJlZ2lzdGVyKCAnQW1wbGl0dWRlU2VsZWN0b3JSZWN0YW5nbGUnLCBBbXBsaXR1ZGVTZWxlY3RvclJlY3RhbmdsZSApO1xyXG5leHBvcnQgZGVmYXVsdCBBbXBsaXR1ZGVTZWxlY3RvclJlY3RhbmdsZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxTQUFTQyxZQUFZLEVBQUVDLFNBQVMsUUFBUSxtQ0FBbUM7QUFDM0UsT0FBT0Msa0JBQWtCLE1BQU0sMENBQTBDO0FBQ3pFLE9BQU9DLGlCQUFpQixNQUFNLG1DQUFtQztBQUNqRSxPQUFPQyxvQkFBb0IsTUFBTSxzQ0FBc0M7QUFDdkUsT0FBT0MsV0FBVyxNQUFNLHNCQUFzQjtBQUU5QyxNQUFNQywwQkFBMEIsU0FBU0wsU0FBUyxDQUFDO0VBRWpEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFTSxXQUFXQSxDQUFFQyxLQUFLLEVBQUVDLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxzQkFBc0IsRUFBRUMsb0JBQW9CLEVBQUVDLDJCQUEyQixFQUFFQyxPQUFPLEVBQUc7SUFFakhBLE9BQU8sR0FBR2YsS0FBSyxDQUFFO01BQ2ZnQixZQUFZLEVBQUUsTUFBTTtNQUNw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