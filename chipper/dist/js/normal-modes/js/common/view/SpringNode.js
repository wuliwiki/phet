// Copyright 2020-2022, University of Colorado Boulder

/**
 * SpringNode draws a line between the two masses that its Spring connects.
 *
 * @author Thiago de Mendon√ßa Mildemberger (UTFPR)
 */

import Multilink from '../../../../axon/js/Multilink.js';
import { Shape } from '../../../../kite/js/imports.js';
import { Node, Path } from '../../../../scenery/js/imports.js';
import normalModes from '../../normalModes.js';
import NormalModesColors from '../NormalModesColors.js';
class SpringNode extends Node {
  /**
   * @param {Spring} spring
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Property.<boolean>} springsVisibleProperty
   * @param {Tandem} tandem
   */
  constructor(spring, modelViewTransform, springsVisibleProperty, tandem) {
    super({
      preventFit: true,
      boundsMethod: 'none',
      pickable: false,
      inputEnabled: false,
      excludeInvisible: true
    });

    // shape of the spring path
    const springShape = new Shape().moveTo(0, 0).lineTo(1, 0);

    // line path that represents a string
    const line = new Path(springShape, {
      preventFit: true,
      boundsMethod: 'none',
      pickable: false,
      inputEnabled: false,
      stroke: NormalModesColors.SPRING_STROKE,
      lineWidth: 5
    });
    this.addChild(line);
    let currentXScaling = 1;

    // Determines the visibility of the SpringNode. This is done with a Multilink instead of a DerivedProperty
    // so that we don't shadow visibleProperty that is inherited from NodeIO (the IO Type associated with
    // superclass Node).  See https://github.com/phetsims/normal-modes/issues/46.
    // Dispose is unnecessary because the SpringNode and the dependencies exist for the lifetime of the sim.
    Multilink.multilink([spring.visibleProperty, springsVisibleProperty], (springVisible, springsVisible) => {
      this.visible = springVisible && springsVisible;
    });

    // dispose is unnecessary because the SpringNode and the dependencies exist for the lifetime of the sim
    Multilink.multilink([spring.leftMass.equilibriumPositionProperty, spring.leftMass.displacementProperty, spring.rightMass.equilibriumPositionProperty, spring.rightMass.displacementProperty], (leftEquilibriumPosition, leftDisplacement, rightEquilibriumPosition, rightDisplacement) => {
      if (this.visible) {
        const p1 = modelViewTransform.modelToViewPosition(leftEquilibriumPosition.plus(leftDisplacement));
        const p2 = modelViewTransform.modelToViewPosition(rightEquilibriumPosition.plus(rightDisplacement));
        if (p1.distance(p2) === 0) {
          return;
        }
        this.scale(1 / currentXScaling, 1);
        currentXScaling = p1.distance(p2);
        this.translation = p1;
        this.rotation = p2.minus(p1).angle;
        this.scale(currentXScaling, 1);
      }
    });
  }
}
normalModes.register('SpringNode', SpringNode);
export default SpringNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJTaGFwZSIsIk5vZGUiLCJQYXRoIiwibm9ybWFsTW9kZXMiLCJOb3JtYWxNb2Rlc0NvbG9ycyIsIlNwcmluZ05vZGUiLCJjb25zdHJ1Y3RvciIsInNwcmluZyIsIm1vZGVsVmlld1RyYW5zZm9ybSIsInNwcmluZ3NWaXNpYmxlUHJvcGVydHkiLCJ0YW5kZW0iLCJwcmV2ZW50Rml0IiwiYm91bmRzTWV0aG9kIiwicGlja2FibGUiLCJpbnB1dEVuYWJsZWQiLCJleGNsdWRlSW52aXNpYmxlIiwic3ByaW5nU2hhcGUiLCJtb3ZlVG8iLCJsaW5lVG8iLCJsaW5lIiwic3Ryb2tlIiwiU1BSSU5HX1NUUk9LRSIsImxpbmVXaWR0aCIsImFkZENoaWxkIiwiY3VycmVudFhTY2FsaW5nIiwibXVsdGlsaW5rIiwidmlzaWJsZVByb3BlcnR5Iiwic3ByaW5nVmlzaWJsZSIsInNwcmluZ3NWaXNpYmxlIiwidmlzaWJsZSIsImxlZnRNYXNzIiwiZXF1aWxpYnJpdW1Qb3NpdGlvblByb3BlcnR5IiwiZGlzcGxhY2VtZW50UHJvcGVydHkiLCJyaWdodE1hc3MiLCJsZWZ0RXF1aWxpYnJpdW1Qb3NpdGlvbiIsImxlZnREaXNwbGFjZW1lbnQiLCJyaWdodEVxdWlsaWJyaXVtUG9zaXRpb24iLCJyaWdodERpc3BsYWNlbWVudCIsInAxIiwibW9kZWxUb1ZpZXdQb3NpdGlvbiIsInBsdXMiLCJwMiIsImRpc3RhbmNlIiwic2NhbGUiLCJ0cmFuc2xhdGlvbiIsInJvdGF0aW9uIiwibWludXMiLCJhbmdsZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiU3ByaW5nTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTcHJpbmdOb2RlIGRyYXdzIGEgbGluZSBiZXR3ZWVuIHRoZSB0d28gbWFzc2VzIHRoYXQgaXRzIFNwcmluZyBjb25uZWN0cy5cclxuICpcclxuICogQGF1dGhvciBUaGlhZ28gZGUgTWVuZG9uw6dhIE1pbGRlbWJlcmdlciAoVVRGUFIpXHJcbiAqL1xyXG5cclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHsgTm9kZSwgUGF0aCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBub3JtYWxNb2RlcyBmcm9tICcuLi8uLi9ub3JtYWxNb2Rlcy5qcyc7XHJcbmltcG9ydCBOb3JtYWxNb2Rlc0NvbG9ycyBmcm9tICcuLi9Ob3JtYWxNb2Rlc0NvbG9ycy5qcyc7XHJcblxyXG5jbGFzcyBTcHJpbmdOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7U3ByaW5nfSBzcHJpbmdcclxuICAgKiBAcGFyYW0ge01vZGVsVmlld1RyYW5zZm9ybTJ9IG1vZGVsVmlld1RyYW5zZm9ybVxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPGJvb2xlYW4+fSBzcHJpbmdzVmlzaWJsZVByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBzcHJpbmcsIG1vZGVsVmlld1RyYW5zZm9ybSwgc3ByaW5nc1Zpc2libGVQcm9wZXJ0eSwgdGFuZGVtICkge1xyXG4gICAgc3VwZXIoIHtcclxuICAgICAgcHJldmVudEZpdDogdHJ1ZSxcclxuICAgICAgYm91bmRzTWV0aG9kOiAnbm9uZScsXHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZSxcclxuICAgICAgaW5wdXRFbmFibGVkOiBmYWxzZSxcclxuICAgICAgZXhjbHVkZUludmlzaWJsZTogdHJ1ZVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHNoYXBlIG9mIHRoZSBzcHJpbmcgcGF0aFxyXG4gICAgY29uc3Qgc3ByaW5nU2hhcGUgPSBuZXcgU2hhcGUoKS5tb3ZlVG8oIDAsIDAgKS5saW5lVG8oIDEsIDAgKTtcclxuXHJcbiAgICAvLyBsaW5lIHBhdGggdGhhdCByZXByZXNlbnRzIGEgc3RyaW5nXHJcbiAgICBjb25zdCBsaW5lID0gbmV3IFBhdGgoIHNwcmluZ1NoYXBlLCB7XHJcbiAgICAgIHByZXZlbnRGaXQ6IHRydWUsXHJcbiAgICAgIGJvdW5kc01ldGhvZDogJ25vbmUnLFxyXG4gICAgICBwaWNrYWJsZTogZmFsc2UsXHJcbiAgICAgIGlucHV0RW5hYmxlZDogZmFsc2UsXHJcbiAgICAgIHN0cm9rZTogTm9ybWFsTW9kZXNDb2xvcnMuU1BSSU5HX1NUUk9LRSxcclxuICAgICAgbGluZVdpZHRoOiA1XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBsaW5lICk7XHJcblxyXG4gICAgbGV0IGN1cnJlbnRYU2NhbGluZyA9IDE7XHJcblxyXG4gICAgLy8gRGV0ZXJtaW5lcyB0aGUgdmlzaWJpbGl0eSBvZiB0aGUgU3ByaW5nTm9kZS4gVGhpcyBpcyBkb25lIHdpdGggYSBNdWx0aWxpbmsgaW5zdGVhZCBvZiBhIERlcml2ZWRQcm9wZXJ0eVxyXG4gICAgLy8gc28gdGhhdCB3ZSBkb24ndCBzaGFkb3cgdmlzaWJsZVByb3BlcnR5IHRoYXQgaXMgaW5oZXJpdGVkIGZyb20gTm9kZUlPICh0aGUgSU8gVHlwZSBhc3NvY2lhdGVkIHdpdGhcclxuICAgIC8vIHN1cGVyY2xhc3MgTm9kZSkuICBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL25vcm1hbC1tb2Rlcy9pc3N1ZXMvNDYuXHJcbiAgICAvLyBEaXNwb3NlIGlzIHVubmVjZXNzYXJ5IGJlY2F1c2UgdGhlIFNwcmluZ05vZGUgYW5kIHRoZSBkZXBlbmRlbmNpZXMgZXhpc3QgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltLlxyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayggWyBzcHJpbmcudmlzaWJsZVByb3BlcnR5LCBzcHJpbmdzVmlzaWJsZVByb3BlcnR5IF0sXHJcbiAgICAgICggc3ByaW5nVmlzaWJsZSwgc3ByaW5nc1Zpc2libGUgKSA9PiB7XHJcbiAgICAgICAgdGhpcy52aXNpYmxlID0gKCBzcHJpbmdWaXNpYmxlICYmIHNwcmluZ3NWaXNpYmxlICk7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBkaXNwb3NlIGlzIHVubmVjZXNzYXJ5IGJlY2F1c2UgdGhlIFNwcmluZ05vZGUgYW5kIHRoZSBkZXBlbmRlbmNpZXMgZXhpc3QgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltXHJcbiAgICBNdWx0aWxpbmsubXVsdGlsaW5rKFxyXG4gICAgICBbIHNwcmluZy5sZWZ0TWFzcy5lcXVpbGlicml1bVBvc2l0aW9uUHJvcGVydHksXHJcbiAgICAgICAgc3ByaW5nLmxlZnRNYXNzLmRpc3BsYWNlbWVudFByb3BlcnR5LFxyXG4gICAgICAgIHNwcmluZy5yaWdodE1hc3MuZXF1aWxpYnJpdW1Qb3NpdGlvblByb3BlcnR5LFxyXG4gICAgICAgIHNwcmluZy5yaWdodE1hc3MuZGlzcGxhY2VtZW50UHJvcGVydHlcclxuICAgICAgXSwgKCBsZWZ0RXF1aWxpYnJpdW1Qb3NpdGlvbiwgbGVmdERpc3BsYWNlbWVudCwgcmlnaHRFcXVpbGlicml1bVBvc2l0aW9uLCByaWdodERpc3BsYWNlbWVudCApID0+IHtcclxuICAgICAgICBpZiAoIHRoaXMudmlzaWJsZSApIHtcclxuXHJcbiAgICAgICAgICBjb25zdCBwMSA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBsZWZ0RXF1aWxpYnJpdW1Qb3NpdGlvbi5wbHVzKCBsZWZ0RGlzcGxhY2VtZW50ICkgKTtcclxuICAgICAgICAgIGNvbnN0IHAyID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIHJpZ2h0RXF1aWxpYnJpdW1Qb3NpdGlvbi5wbHVzKCByaWdodERpc3BsYWNlbWVudCApICk7XHJcbiAgICAgICAgICBpZiAoIHAxLmRpc3RhbmNlKCBwMiApID09PSAwICkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgdGhpcy5zY2FsZSggMSAvIGN1cnJlbnRYU2NhbGluZywgMSApO1xyXG5cclxuICAgICAgICAgIGN1cnJlbnRYU2NhbGluZyA9IHAxLmRpc3RhbmNlKCBwMiApO1xyXG5cclxuICAgICAgICAgIHRoaXMudHJhbnNsYXRpb24gPSBwMTtcclxuICAgICAgICAgIHRoaXMucm90YXRpb24gPSBwMi5taW51cyggcDEgKS5hbmdsZTtcclxuICAgICAgICAgIHRoaXMuc2NhbGUoIGN1cnJlbnRYU2NhbGluZywgMSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxubm9ybWFsTW9kZXMucmVnaXN0ZXIoICdTcHJpbmdOb2RlJywgU3ByaW5nTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBTcHJpbmdOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxTQUFTLE1BQU0sa0NBQWtDO0FBQ3hELFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDdEQsU0FBU0MsSUFBSSxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQzlELE9BQU9DLFdBQVcsTUFBTSxzQkFBc0I7QUFDOUMsT0FBT0MsaUJBQWlCLE1BQU0seUJBQXlCO0FBRXZELE1BQU1DLFVBQVUsU0FBU0osSUFBSSxDQUFDO0VBRTVCO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFSyxXQUFXQSxDQUFFQyxNQUFNLEVBQUVDLGtCQUFrQixFQUFFQyxzQkFBc0IsRUFBRUMsTUFBTSxFQUFHO0lBQ3hFLEtBQUssQ0FBRTtNQUNMQyxVQUFVLEVBQUUsSUFBSTtNQUNoQkMsWUFBWSxFQUFFLE1BQU07TUFDcEJDLFFBQVEsRUFBRSxLQUFLO01BQ2ZDLFlBQVksRUFBRSxLQUFLO01BQ25CQyxnQkFBZ0Is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