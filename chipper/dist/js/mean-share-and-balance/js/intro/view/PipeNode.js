// Copyright 2022, University of Colorado Boulder

/**
 * Representation for the 2D pipe and valve between each water cup.
 *
 * @author Marla Schulz (PhET Interactive Simulations)
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import { combineOptions } from '../../../../phet-core/js/optionize.js';
import { FireListener, InteractiveHighlighting, Line, Node, Pattern, Rectangle } from '../../../../scenery/js/imports.js';
import meanShareAndBalance from '../../meanShareAndBalance.js';
import MeanShareAndBalanceConstants from '../../common/MeanShareAndBalanceConstants.js';
import { Shape } from '../../../../kite/js/imports.js';
import ValveNode from './ValveNode.js';
import graphiteTexture_png from '../../../images/graphiteTexture_png.js';
import Matrix3 from '../../../../dot/js/Matrix3.js';
const LINE_WIDTH = 1;
export default class PipeNode extends InteractiveHighlighting(Node) {
  // Public for traversal order

  constructor(pipe, arePipesOpenProperty, modelViewTransform, providedOptions) {
    const options = providedOptions;

    // Pipe & valve dimensions
    const pipeCenter = new Vector2(MeanShareAndBalanceConstants.PIPE_LENGTH / 2, MeanShareAndBalanceConstants.PIPE_WIDTH / 2);
    const pipeRectangle = new Rectangle(0, 0, MeanShareAndBalanceConstants.PIPE_LENGTH, MeanShareAndBalanceConstants.PIPE_WIDTH, {
      fill: MeanShareAndBalanceConstants.PIPE_GRADIENT
    });
    const horizontalStrokePattern = new Pattern(graphiteTexture_png).setTransformMatrix(Matrix3.affine(0.15, 0, 0, 0, 0.15, 0.9));
    const leftStrokePattern = new Pattern(graphiteTexture_png).setTransformMatrix(Matrix3.affine(0.15 * Math.cos(Math.PI / 2), -0.15 * Math.sin(Math.PI / 2), 0.975, 0.15 * Math.sin(Math.PI / 2), 0.15 * Math.cos(Math.PI / 2), 0));
    const rightStrokePattern = new Pattern(graphiteTexture_png).setTransformMatrix(Matrix3.affine(0.15 * Math.cos(Math.PI / 2), -0.15 * Math.sin(Math.PI / 2), 0, 0.15 * Math.sin(Math.PI / 2), 0.15 * Math.cos(Math.PI / 2), 0));
    const pipeStrokeLeft = new Line(0, 0, 0, MeanShareAndBalanceConstants.PIPE_WIDTH, {
      lineWidth: 1.95,
      stroke: leftStrokePattern
    });
    const pipeStrokeRight = new Line(MeanShareAndBalanceConstants.PIPE_LENGTH, 0, MeanShareAndBalanceConstants.PIPE_LENGTH, MeanShareAndBalanceConstants.PIPE_WIDTH, {
      lineWidth: 1.95,
      stroke: rightStrokePattern
    });
    const pipeStrokeTop = new Line(0, 0, MeanShareAndBalanceConstants.PIPE_LENGTH, 0, {
      lineWidth: 1.95,
      stroke: horizontalStrokePattern
    });
    const pipeStrokeBottom = new Line(0, MeanShareAndBalanceConstants.PIPE_WIDTH, MeanShareAndBalanceConstants.PIPE_LENGTH, MeanShareAndBalanceConstants.PIPE_WIDTH, {
      lineWidth: 1.95,
      stroke: horizontalStrokePattern
    });

    // Function to create pipe clip area when valve is closed
    const createPipeClipArea = (bounds, radius) => {
      const clipAreaRectangle = Shape.bounds(bounds);
      const clipAreaCircle = Shape.circle(new Vector2(bounds.centerX, bounds.centerY), radius);
      return clipAreaRectangle.shapeDifference(clipAreaCircle);
    };
    pipeRectangle.clipArea = createPipeClipArea(pipeRectangle.localBounds, MeanShareAndBalanceConstants.VALVE_RADIUS);
    const valveNode = new ValveNode(pipeCenter, pipe.rotationProperty, options.tandem);

    // Set pointer areas for valveNode
    valveNode.mouseArea = valveNode.localBounds.dilated(MeanShareAndBalanceConstants.MOUSE_AREA_DILATION);
    valveNode.touchArea = valveNode.localBounds.dilated(MeanShareAndBalanceConstants.TOUCH_AREA_DILATION);
    const handleFire = () => {
      arePipesOpenProperty.set(!pipe.arePipesOpenProperty.value);
      pipe.isCurrentlyClickedProperty.set(true);
      pipe.isCurrentlyClickedProperty.set(false);
    };

    // Valve rotation event listener
    const valveRotationFireListener = new FireListener({
      fire: () => {
        handleFire();
      },
      // phet-io
      tandem: options.tandem.createTandem('valveRotationFireListener')
    });
    valveNode.addInputListener(valveRotationFireListener);
    const combinedOptions = combineOptions({
      visibleProperty: pipe.isActiveProperty,
      children: [pipeRectangle, pipeStrokeLeft, pipeStrokeBottom, pipeStrokeTop, pipeStrokeRight, valveNode]
    }, options);
    super(combinedOptions);
    this.valveNode = valveNode;
    // Set position related to associated cup
    this.x = pipe.position.x + MeanShareAndBalanceConstants.CUP_WIDTH + LINE_WIDTH;
    this.y = modelViewTransform.modelToViewY(0) - MeanShareAndBalanceConstants.PIPE_WIDTH;

    // pdom - add to traversal order and add a listener so that it responds to clicks from assistive technology.
    this.tagName = 'button';
    this.addInputListener({
      click: () => handleFire()
    });

    // interactive highlighting - set a custom highlight because the pipe nodes have a unique combined highlight
    // collectively in the ScreenView
    this.interactiveHighlight = Shape.bounds(this.localBounds);
  }
}
meanShareAndBalance.register('PipeNode', PipeNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiY29tYmluZU9wdGlvbnMiLCJGaXJlTGlzdGVuZXIiLCJJbnRlcmFjdGl2ZUhpZ2hsaWdodGluZyIsIkxpbmUiLCJOb2RlIiwiUGF0dGVybiIsIlJlY3RhbmdsZSIsIm1lYW5TaGFyZUFuZEJhbGFuY2UiLCJNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzIiwiU2hhcGUiLCJWYWx2ZU5vZGUiLCJncmFwaGl0ZVRleHR1cmVfcG5nIiwiTWF0cml4MyIsIkxJTkVfV0lEVEgiLCJQaXBlTm9kZSIsImNvbnN0cnVjdG9yIiwicGlwZSIsImFyZVBpcGVzT3BlblByb3BlcnR5IiwibW9kZWxWaWV3VHJhbnNmb3JtIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsInBpcGVDZW50ZXIiLCJQSVBFX0xFTkdUSCIsIlBJUEVfV0lEVEgiLCJwaXBlUmVjdGFuZ2xlIiwiZmlsbCIsIlBJUEVfR1JBRElFTlQiLCJob3Jpem9udGFsU3Ryb2tlUGF0dGVybiIsInNldFRyYW5zZm9ybU1hdHJpeCIsImFmZmluZSIsImxlZnRTdHJva2VQYXR0ZXJuIiwiTWF0aCIsImNvcyIsIlBJIiwic2luIiwicmlnaHRTdHJva2VQYXR0ZXJuIiwicGlwZVN0cm9rZUxlZnQiLCJsaW5lV2lkdGgiLCJzdHJva2UiLCJwaXBlU3Ryb2tlUmlnaHQiLCJwaXBlU3Ryb2tlVG9wIiwicGlwZVN0cm9rZUJvdHRvbSIsImNyZWF0ZVBpcGVDbGlwQXJlYSIsImJvdW5kcyIsInJhZGl1cyIsImNsaXBBcmVhUmVjdGFuZ2xlIiwiY2xpcEFyZWFDaXJjbGUiLCJjaXJjbGUiLCJjZW50ZXJYIiwiY2VudGVyWSIsInNoYXBlRGlmZmVyZW5jZSIsImNsaXBBcmVhIiwibG9jYWxCb3VuZHMiLCJWQUxWRV9SQURJVVMiLCJ2YWx2ZU5vZGUiLCJyb3RhdGlvblByb3BlcnR5IiwidGFuZGVtIiwibW91c2VBcmVhIiwiZGlsYXRlZCIsIk1PVVNFX0FSRUFfRElMQVRJT04iLCJ0b3VjaEFyZWEiLCJUT1VDSF9BUkVBX0RJTEFUSU9OIiwiaGFuZGxlRmlyZSIsInNldCIsInZhbHVlIiwiaXNDdXJyZW50bHlDbGlja2VkUHJvcGVydHkiLCJ2YWx2ZVJvdGF0aW9uRmlyZUxpc3RlbmVyIiwiZmlyZSIsImNyZWF0ZVRhbmRlbSIsImFkZElucHV0TGlzdGVuZXIiLCJjb21iaW5lZE9wdGlvbnMiLCJ2aXNpYmxlUHJvcGVydHkiLCJpc0FjdGl2ZVByb3BlcnR5IiwiY2hpbGRyZW4iLCJ4IiwicG9zaXRpb24iLCJDVVBfV0lEVEgiLCJ5IiwibW9kZWxUb1ZpZXdZIiwidGFnTmFtZSIsImNsaWNrIiwiaW50ZXJhY3RpdmVIaWdobGlnaHQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlBpcGVOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBSZXByZXNlbnRhdGlvbiBmb3IgdGhlIDJEIHBpcGUgYW5kIHZhbHZlIGJldHdlZW4gZWFjaCB3YXRlciBjdXAuXHJcbiAqXHJcbiAqIEBhdXRob3IgTWFybGEgU2NodWx6IChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgeyBjb21iaW5lT3B0aW9ucywgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgeyBGaXJlTGlzdGVuZXIsIEludGVyYWN0aXZlSGlnaGxpZ2h0aW5nLCBMaW5lLCBOb2RlLCBOb2RlT3B0aW9ucywgUGF0dGVybiwgUmVjdGFuZ2xlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG1lYW5TaGFyZUFuZEJhbGFuY2UgZnJvbSAnLi4vLi4vbWVhblNoYXJlQW5kQmFsYW5jZS5qcyc7XHJcbmltcG9ydCBQaXBlIGZyb20gJy4uL21vZGVsL1BpcGUuanMnO1xyXG5pbXBvcnQgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBWYWx2ZU5vZGUgZnJvbSAnLi9WYWx2ZU5vZGUuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQaWNrUmVxdWlyZWQgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1BpY2tSZXF1aXJlZC5qcyc7XHJcbmltcG9ydCBncmFwaGl0ZVRleHR1cmVfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9ncmFwaGl0ZVRleHR1cmVfcG5nLmpzJztcclxuaW1wb3J0IE1hdHJpeDMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL01hdHJpeDMuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IEVtcHR5U2VsZk9wdGlvbnM7XHJcbnR5cGUgUGlwZU5vZGVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PE5vZGVPcHRpb25zLCAncGhldGlvRHluYW1pY0VsZW1lbnQnIHwgJ2NoaWxkcmVuJyB8ICd2aXNpYmxlUHJvcGVydHknPiAmIFBpY2tSZXF1aXJlZDxOb2RlT3B0aW9ucywgJ3RhbmRlbSc+O1xyXG5cclxuY29uc3QgTElORV9XSURUSCA9IDE7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQaXBlTm9kZSBleHRlbmRzIEludGVyYWN0aXZlSGlnaGxpZ2h0aW5nKCBOb2RlICkge1xyXG5cclxuICAvLyBQdWJsaWMgZm9yIHRyYXZlcnNhbCBvcmRlclxyXG4gIHB1YmxpYyByZWFkb25seSB2YWx2ZU5vZGU6IFZhbHZlTm9kZTtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwaXBlOiBQaXBlLCBhcmVQaXBlc09wZW5Qcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj4sIG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMiwgcHJvdmlkZWRPcHRpb25zOiBQaXBlTm9kZU9wdGlvbnMgKSB7XHJcbiAgICBjb25zdCBvcHRpb25zID0gcHJvdmlkZWRPcHRpb25zO1xyXG5cclxuICAgIC8vIFBpcGUgJiB2YWx2ZSBkaW1lbnNpb25zXHJcbiAgICBjb25zdCBwaXBlQ2VudGVyID0gbmV3IFZlY3RvcjIoIE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuUElQRV9MRU5HVEggLyAyLCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLlBJUEVfV0lEVEggLyAyICk7XHJcbiAgICBjb25zdCBwaXBlUmVjdGFuZ2xlID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5QSVBFX0xFTkdUSCwgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5QSVBFX1dJRFRILFxyXG4gICAgICB7IGZpbGw6IE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuUElQRV9HUkFESUVOVCB9ICk7XHJcblxyXG4gICAgY29uc3QgaG9yaXpvbnRhbFN0cm9rZVBhdHRlcm4gPSBuZXcgUGF0dGVybiggZ3JhcGhpdGVUZXh0dXJlX3BuZyApLnNldFRyYW5zZm9ybU1hdHJpeCggTWF0cml4My5hZmZpbmUoIDAuMTUsIDAsIDAsIDAsIDAuMTUsIDAuOSApICk7XHJcbiAgICBjb25zdCBsZWZ0U3Ryb2tlUGF0dGVybiA9IG5ldyBQYXR0ZXJuKCBncmFwaGl0ZVRleHR1cmVfcG5nICkuc2V0VHJhbnNmb3JtTWF0cml4KCBNYXRyaXgzLmFmZmluZSggMC4xNSAqIE1hdGguY29zKCBNYXRoLlBJIC8gMiApLCAtMC4xNSAqIE1hdGguc2luKCBNYXRoLlBJIC8gMiApLCAwLjk3NSxcclxuICAgICAgMC4xNSAqIE1hdGguc2luKCBNYXRoLlBJIC8gMiApLCAwLjE1ICogTWF0aC5jb3MoIE1hdGguUEkgLyAyICksIDAgKSApO1xyXG4gICAgY29uc3QgcmlnaHRTdHJva2VQYXR0ZXJuID0gbmV3IFBhdHRlcm4oIGdyYXBoaXRlVGV4dHVyZV9wbmcgKS5zZXRUcmFuc2Zvcm1NYXRyaXgoIE1hdHJpeDMuYWZmaW5lKCAwLjE1ICogTWF0aC5jb3MoIE1hdGguUEkgLyAyICksIC0wLjE1ICogTWF0aC5zaW4oIE1hdGguUEkgLyAyICksIDAsXHJcbiAgICAgIDAuMTUgKiBNYXRoLnNpbiggTWF0aC5QSSAvIDIgKSwgMC4xNSAqIE1hdGguY29zKCBNYXRoLlBJIC8gMiApLCAwICkgKTtcclxuXHJcbiAgICBjb25zdCBwaXBlU3Ryb2tlTGVmdCA9IG5ldyBMaW5lKCAwLCAwLCAwLCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLlBJUEVfV0lEVEgsIHsgbGluZVdpZHRoOiAxLjk1LCBzdHJva2U6IGxlZnRTdHJva2VQYXR0ZXJuIH0gKTtcclxuICAgIGNvbnN0IHBpcGVTdHJva2VSaWdodCA9IG5ldyBMaW5lKCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLlBJUEVfTEVOR1RILCAwLCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLlBJUEVfTEVOR1RILCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLlBJUEVfV0lEVEgsIHtcclxuICAgICAgbGluZVdpZHRoOiAxLjk1LFxyXG4gICAgICBzdHJva2U6IHJpZ2h0U3Ryb2tlUGF0dGVyblxyXG4gICAgfSApO1xyXG4gICAgY29uc3QgcGlwZVN0cm9rZVRvcCA9IG5ldyBMaW5lKCAwLCAwLCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLlBJUEVfTEVOR1RILCAwLCB7XHJcbiAgICAgIGxpbmVXaWR0aDogMS45NSxcclxuICAgICAgc3Ryb2tlOiBob3Jpem9udGFsU3Ryb2tlUGF0dGVyblxyXG4gICAgfSApO1xyXG4gICAgY29uc3QgcGlwZVN0cm9rZUJvdHRvbSA9IG5ldyBMaW5lKCAwLCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLlBJUEVfV0lEVEgsIE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuUElQRV9MRU5HVEgsIE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuUElQRV9XSURUSCwge1xyXG4gICAgICBsaW5lV2lkdGg6IDEuOTUsXHJcbiAgICAgIHN0cm9rZTogaG9yaXpvbnRhbFN0cm9rZVBhdHRlcm5cclxuICAgIH0gKTtcclxuXHJcblxyXG4gICAgLy8gRnVuY3Rpb24gdG8gY3JlYXRlIHBpcGUgY2xpcCBhcmVhIHdoZW4gdmFsdmUgaXMgY2xvc2VkXHJcbiAgICBjb25zdCBjcmVhdGVQaXBlQ2xpcEFyZWEgPSAoIGJvdW5kczogQm91bmRzMiwgcmFkaXVzOiBudW1iZXIgKTogU2hhcGUgPT4ge1xyXG4gICAgICBjb25zdCBjbGlwQXJlYVJlY3RhbmdsZSA9IFNoYXBlLmJvdW5kcyggYm91bmRzICk7XHJcbiAgICAgIGNvbnN0IGNsaXBBcmVhQ2lyY2xlID0gU2hhcGUuY2lyY2xlKCBuZXcgVmVjdG9yMiggYm91bmRzLmNlbnRlclgsIGJvdW5kcy5jZW50ZXJZICksIHJhZGl1cyApO1xyXG4gICAgICByZXR1cm4gY2xpcEFyZWFSZWN0YW5nbGUuc2hhcGVEaWZmZXJlbmNlKCBjbGlwQXJlYUNpcmNsZSApO1xyXG4gICAgfTtcclxuXHJcbiAgICBwaXBlUmVjdGFuZ2xlLmNsaXBBcmVhID0gY3JlYXRlUGlwZUNsaXBBcmVhKCBwaXBlUmVjdGFuZ2xlLmxvY2FsQm91bmRzLCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLlZBTFZFX1JBRElVUyApO1xyXG5cclxuICAgIGNvbnN0IHZhbHZlTm9kZSA9IG5ldyBWYWx2ZU5vZGUoIHBpcGVDZW50ZXIsIHBpcGUucm90YXRpb25Qcm9wZXJ0eSwgb3B0aW9ucy50YW5kZW0gKTtcclxuXHJcbiAgICAvLyBTZXQgcG9pbnRlciBhcmVhcyBmb3IgdmFsdmVOb2RlXHJcbiAgICB2YWx2ZU5vZGUubW91c2VBcmVhID0gdmFsdmVOb2RlLmxvY2FsQm91bmRzLmRpbGF0ZWQoIE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuTU9VU0VfQVJFQV9ESUxBVElPTiApO1xyXG4gICAgdmFsdmVOb2RlLnRvdWNoQXJlYSA9IHZhbHZlTm9kZS5sb2NhbEJvdW5kcy5kaWxhdGVkKCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLlRPVUNIX0FSRUFfRElMQVRJT04gKTtcclxuXHJcbiAgICBjb25zdCBoYW5kbGVGaXJlID0gKCkgPT4ge1xyXG4gICAgICBhcmVQaXBlc09wZW5Qcm9wZXJ0eS5zZXQoICFwaXBlLmFyZVBpcGVzT3BlblByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gICAgICBwaXBlLmlzQ3VycmVudGx5Q2xpY2tlZFByb3BlcnR5LnNldCggdHJ1ZSApO1xyXG4gICAgICBwaXBlLmlzQ3VycmVudGx5Q2xpY2tlZFByb3BlcnR5LnNldCggZmFsc2UgKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gVmFsdmUgcm90YXRpb24gZXZlbnQgbGlzdGVuZXJcclxuICAgIGNvbnN0IHZhbHZlUm90YXRpb25GaXJlTGlzdGVuZXIgPSBuZXcgRmlyZUxpc3RlbmVyKCB7XHJcbiAgICAgIGZpcmU6ICgpID0+IHtcclxuICAgICAgICBoYW5kbGVGaXJlKCk7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndmFsdmVSb3RhdGlvbkZpcmVMaXN0ZW5lcicgKVxyXG4gICAgfSApO1xyXG4gICAgdmFsdmVOb2RlLmFkZElucHV0TGlzdGVuZXIoIHZhbHZlUm90YXRpb25GaXJlTGlzdGVuZXIgKTtcclxuXHJcbiAgICBjb25zdCBjb21iaW5lZE9wdGlvbnMgPSBjb21iaW5lT3B0aW9uczxOb2RlT3B0aW9ucz4oIHtcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiBwaXBlLmlzQWN0aXZlUHJvcGVydHksXHJcbiAgICAgIGNoaWxkcmVuOiBbIHBpcGVSZWN0YW5nbGUsIHBpcGVTdHJva2VMZWZ0LCBwaXBlU3Ryb2tlQm90dG9tLCBwaXBlU3Ryb2tlVG9wLCBwaXBlU3Ryb2tlUmlnaHQsIHZhbHZlTm9kZSBdXHJcbiAgICB9LCBvcHRpb25zICk7XHJcbiAgICBzdXBlciggY29tYmluZWRPcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy52YWx2ZU5vZGUgPSB2YWx2ZU5vZGU7XHJcbiAgICAvLyBTZXQgcG9zaXRpb24gcmVsYXRlZCB0byBhc3NvY2lhdGVkIGN1cFxyXG4gICAgdGhpcy54ID0gcGlwZS5wb3NpdGlvbi54ICsgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DVVBfV0lEVEggKyBMSU5FX1dJRFRIO1xyXG4gICAgdGhpcy55ID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggMCApIC0gTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5QSVBFX1dJRFRIO1xyXG5cclxuICAgIC8vIHBkb20gLSBhZGQgdG8gdHJhdmVyc2FsIG9yZGVyIGFuZCBhZGQgYSBsaXN0ZW5lciBzbyB0aGF0IGl0IHJlc3BvbmRzIHRvIGNsaWNrcyBmcm9tIGFzc2lzdGl2ZSB0ZWNobm9sb2d5LlxyXG4gICAgdGhpcy50YWdOYW1lID0gJ2J1dHRvbic7XHJcbiAgICB0aGlzLmFkZElucHV0TGlzdGVuZXIoIHtcclxuICAgICAgY2xpY2s6ICgpID0+IGhhbmRsZUZpcmUoKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGludGVyYWN0aXZlIGhpZ2hsaWdodGluZyAtIHNldCBhIGN1c3RvbSBoaWdobGlnaHQgYmVjYXVzZSB0aGUgcGlwZSBub2RlcyBoYXZlIGEgdW5pcXVlIGNvbWJpbmVkIGhpZ2hsaWdodFxyXG4gICAgLy8gY29sbGVjdGl2ZWx5IGluIHRoZSBTY3JlZW5WaWV3XHJcbiAgICB0aGlzLmludGVyYWN0aXZlSGlnaGxpZ2h0ID0gU2hhcGUuYm91bmRzKCB0aGlzLmxvY2FsQm91bmRzICk7XHJcbiAgfVxyXG59XHJcblxyXG5tZWFuU2hhcmVBbmRCYWxhbmNlLnJlZ2lzdGVyKCAnUGlwZU5vZGUnLCBQaXBlTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE9BQU8sTUFBTSwrQkFBK0I7QUFFbkQsU0FBU0MsY0FBYyxRQUEwQix1Q0FBdUM7QUFDeEYsU0FBU0MsWUFBWSxFQUFFQyx1QkFBdUIsRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQWVDLE9BQU8sRUFBRUMsU0FBUyxRQUFRLG1DQUFtQztBQUN0SSxPQUFPQyxtQkFBbUIsTUFBTSw4QkFBOEI7QUFFOUQsT0FBT0MsNEJBQTRCLE1BQU0sOENBQThDO0FBRXZGLFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFFdEQsT0FBT0MsU0FBUyxNQUFNLGdCQUFnQjtBQUd0QyxPQUFPQyxtQkFBbUIsTUFBTSx3Q0FBd0M7QUFDeEUsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUtuRCxNQUFNQyxVQUFVLEdBQUcsQ0FBQztBQUVwQixlQUFlLE1BQU1DLFFBQVEsU0FBU1osdUJBQXVCLENBQUVFLElBQUssQ0FBQyxDQUFDO0VBRXBFOztFQUdPVyxXQUFXQSxDQUFFQyxJQUFVLEVBQUVDLG9CQUF1QyxFQUFFQyxrQkFBdUMsRUFBRUMsZUFBZ0Ms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