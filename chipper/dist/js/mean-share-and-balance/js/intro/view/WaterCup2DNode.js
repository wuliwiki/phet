// Copyright 2022, University of Colorado Boulder

/**
 * Representation for the 2D water cup including dynamic water level.
 *
 * @author Marla Schulz (PhET Interactive Simulations)
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Utils from '../../../../dot/js/Utils.js';
import optionize, { combineOptions } from '../../../../phet-core/js/optionize.js';
import { Line, Node, Pattern, Rectangle } from '../../../../scenery/js/imports.js';
import meanShareAndBalance from '../../meanShareAndBalance.js';
import WaterCup2DTickMarksNode from './WaterCup2DTickMarksNode.js';
import MeanShareAndBalanceConstants from '../../common/MeanShareAndBalanceConstants.js';
import MeanShareAndBalanceColors from '../../common/MeanShareAndBalanceColors.js';
import graphiteTexture_png from '../../../images/graphiteTexture_png.js';
import Matrix3 from '../../../../dot/js/Matrix3.js';
export default class WaterCup2DNode extends Node {
  constructor(waterCup, waterCup3D, modelViewTransform, meanProperty, isShowingTickMarksProperty, isShowingMeanProperty, isShowingCupWaterLevelProperty, providedOptions) {
    const options = optionize()({
      y: modelViewTransform.modelToViewY(0) - MeanShareAndBalanceConstants.CUP_HEIGHT,
      left: waterCup.position.x,
      visibleProperty: waterCup.isActiveProperty
    }, providedOptions);
    const tickMarks = new WaterCup2DTickMarksNode(MeanShareAndBalanceConstants.CUP_HEIGHT, {
      visibleProperty: isShowingTickMarksProperty,
      // phet-io
      tandem: options.tandem.createTandem('tickMarks')
    });

    // 0 is empty, 1 is full
    const y = Utils.linear(0, 1, MeanShareAndBalanceConstants.CUP_HEIGHT, 0, waterCup.waterLevelProperty.value);
    const topStrokePattern = new Pattern(graphiteTexture_png).setTransformMatrix(Matrix3.affine(0.15, 0, 0, 0, 0.15, 0.9));
    const bottomStrokePattern = new Pattern(graphiteTexture_png).setTransformMatrix(Matrix3.affine(0.15, 0, 0, 0, 0.15, 0));
    const verticalStrokePattern = new Pattern(graphiteTexture_png).setTransformMatrix(Matrix3.affine(0.15 * Math.cos(Math.PI / 2), -0.15 * Math.sin(Math.PI / 2), 0.975, 0.15 * Math.sin(Math.PI / 2), 0.15 * Math.cos(Math.PI / 2), 0));
    const cupStrokeLeft = new Line(0, 0, 0, MeanShareAndBalanceConstants.CUP_HEIGHT, {
      lineWidth: 1.95,
      stroke: verticalStrokePattern
    });
    const cupStrokeRight = new Line(MeanShareAndBalanceConstants.CUP_WIDTH, 0, MeanShareAndBalanceConstants.CUP_WIDTH, MeanShareAndBalanceConstants.CUP_HEIGHT, {
      lineWidth: 1.95,
      stroke: verticalStrokePattern
    });
    const cupStrokeTop = new Line(0, 0, MeanShareAndBalanceConstants.CUP_WIDTH, 0, {
      lineWidth: 1.95,
      stroke: topStrokePattern
    });
    const cupStrokeBottom = new Line(0, MeanShareAndBalanceConstants.CUP_HEIGHT, MeanShareAndBalanceConstants.CUP_WIDTH, MeanShareAndBalanceConstants.CUP_HEIGHT, {
      lineWidth: 1.95,
      stroke: bottomStrokePattern
    });
    const waterCupBackgroundRectangle = new Rectangle(0, 0, MeanShareAndBalanceConstants.CUP_WIDTH, MeanShareAndBalanceConstants.CUP_HEIGHT, {
      fill: 'white'
    });
    const waterLevelRectangle = new Rectangle(0, y, MeanShareAndBalanceConstants.CUP_WIDTH, MeanShareAndBalanceConstants.CUP_HEIGHT * waterCup.waterLevelProperty.value, {
      fill: MeanShareAndBalanceColors.waterFillColorProperty
    });
    const waterLevelListener = waterLevel => {
      waterLevelRectangle.setRectHeightFromBottom(MeanShareAndBalanceConstants.CUP_HEIGHT * waterLevel);
    };
    waterCup.waterLevelProperty.link(waterLevelListener);

    // Model view transform inverts Y mapping, therefore the mean inverse is needed to place
    // show mean line accurately in relation to water levels.
    let meanInverse = 1 - meanProperty.value;
    const meanLine = new Line(0, MeanShareAndBalanceConstants.CUP_HEIGHT * meanInverse, MeanShareAndBalanceConstants.CUP_WIDTH, MeanShareAndBalanceConstants.CUP_HEIGHT * meanInverse, {
      stroke: MeanShareAndBalanceColors.showMeanLineStrokeColorProperty,
      lineWidth: 2,
      visibleProperty: isShowingMeanProperty
    });
    const originalWaterLevelLine = new Line(0, MeanShareAndBalanceConstants.CUP_HEIGHT * meanInverse, MeanShareAndBalanceConstants.CUP_WIDTH, MeanShareAndBalanceConstants.CUP_HEIGHT * meanInverse, {
      stroke: MeanShareAndBalanceColors.cupWaterLevelLineColorProperty,
      lineWidth: 1,
      visibleProperty: isShowingCupWaterLevelProperty
    });
    waterCup3D.waterLevelProperty.link(wlp => {
      meanInverse = 1 - wlp;
      originalWaterLevelLine.setY1(MeanShareAndBalanceConstants.CUP_HEIGHT * meanInverse);
      originalWaterLevelLine.setY2(MeanShareAndBalanceConstants.CUP_HEIGHT * meanInverse);
    });
    const meanListener = mean => {
      meanInverse = 1 - mean;
      meanLine.setY1(MeanShareAndBalanceConstants.CUP_HEIGHT * meanInverse);
      meanLine.setY2(MeanShareAndBalanceConstants.CUP_HEIGHT * meanInverse);
    };
    meanProperty.link(meanListener);
    const combinedOptions = combineOptions({
      children: [waterCupBackgroundRectangle, waterLevelRectangle, cupStrokeLeft, cupStrokeRight, cupStrokeTop, cupStrokeBottom, meanLine, originalWaterLevelLine, tickMarks]
    }, options);
    super(combinedOptions);
  }
}
meanShareAndBalance.register('WaterCup2DNode', WaterCup2DNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIm9wdGlvbml6ZSIsImNvbWJpbmVPcHRpb25zIiwiTGluZSIsIk5vZGUiLCJQYXR0ZXJuIiwiUmVjdGFuZ2xlIiwibWVhblNoYXJlQW5kQmFsYW5jZSIsIldhdGVyQ3VwMkRUaWNrTWFya3NOb2RlIiwiTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cyIsIk1lYW5TaGFyZUFuZEJhbGFuY2VDb2xvcnMiLCJncmFwaGl0ZVRleHR1cmVfcG5nIiwiTWF0cml4MyIsIldhdGVyQ3VwMkROb2RlIiwiY29uc3RydWN0b3IiLCJ3YXRlckN1cCIsIndhdGVyQ3VwM0QiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJtZWFuUHJvcGVydHkiLCJpc1Nob3dpbmdUaWNrTWFya3NQcm9wZXJ0eSIsImlzU2hvd2luZ01lYW5Qcm9wZXJ0eSIsImlzU2hvd2luZ0N1cFdhdGVyTGV2ZWxQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ5IiwibW9kZWxUb1ZpZXdZIiwiQ1VQX0hFSUdIVCIsImxlZnQiLCJwb3NpdGlvbiIsIngiLCJ2aXNpYmxlUHJvcGVydHkiLCJpc0FjdGl2ZVByb3BlcnR5IiwidGlja01hcmtzIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwibGluZWFyIiwid2F0ZXJMZXZlbFByb3BlcnR5IiwidmFsdWUiLCJ0b3BTdHJva2VQYXR0ZXJuIiwic2V0VHJhbnNmb3JtTWF0cml4IiwiYWZmaW5lIiwiYm90dG9tU3Ryb2tlUGF0dGVybiIsInZlcnRpY2FsU3Ryb2tlUGF0dGVybiIsIk1hdGgiLCJjb3MiLCJQSSIsInNpbiIsImN1cFN0cm9rZUxlZnQiLCJsaW5lV2lkdGgiLCJzdHJva2UiLCJjdXBTdHJva2VSaWdodCIsIkNVUF9XSURUSCIsImN1cFN0cm9rZVRvcCIsImN1cFN0cm9rZUJvdHRvbSIsIndhdGVyQ3VwQmFja2dyb3VuZFJlY3RhbmdsZSIsImZpbGwiLCJ3YXRlckxldmVsUmVjdGFuZ2xlIiwid2F0ZXJGaWxsQ29sb3JQcm9wZXJ0eSIsIndhdGVyTGV2ZWxMaXN0ZW5lciIsIndhdGVyTGV2ZWwiLCJzZXRSZWN0SGVpZ2h0RnJvbUJvdHRvbSIsImxpbmsiLCJtZWFuSW52ZXJzZSIsIm1lYW5MaW5lIiwic2hvd01lYW5MaW5lU3Ryb2tlQ29sb3JQcm9wZXJ0eSIsIm9yaWdpbmFsV2F0ZXJMZXZlbExpbmUiLCJjdXBXYXRlckxldmVsTGluZUNvbG9yUHJvcGVydHkiLCJ3bHAiLCJzZXRZMSIsInNldFkyIiwibWVhbkxpc3RlbmVyIiwibWVhbiIsImNvbWJpbmVkT3B0aW9ucyIsImNoaWxkcmVuIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJXYXRlckN1cDJETm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogUmVwcmVzZW50YXRpb24gZm9yIHRoZSAyRCB3YXRlciBjdXAgaW5jbHVkaW5nIGR5bmFtaWMgd2F0ZXIgbGV2ZWwuXHJcbiAqXHJcbiAqIEBhdXRob3IgTWFybGEgU2NodWx6IChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zLCBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCB7IExpbmUsIE5vZGUsIE5vZGVPcHRpb25zLCBOb2RlVHJhbnNmb3JtT3B0aW9ucywgUGF0dGVybiwgUmVjdGFuZ2xlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFdhdGVyQ3VwIGZyb20gJy4uL21vZGVsL1dhdGVyQ3VwLmpzJztcclxuaW1wb3J0IG1lYW5TaGFyZUFuZEJhbGFuY2UgZnJvbSAnLi4vLi4vbWVhblNoYXJlQW5kQmFsYW5jZS5qcyc7XHJcbmltcG9ydCBXYXRlckN1cDJEVGlja01hcmtzTm9kZSBmcm9tICcuL1dhdGVyQ3VwMkRUaWNrTWFya3NOb2RlLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi9NZWFuU2hhcmVBbmRCYWxhbmNlQ29sb3JzLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IGdyYXBoaXRlVGV4dHVyZV9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2dyYXBoaXRlVGV4dHVyZV9wbmcuanMnO1xyXG5pbXBvcnQgTWF0cml4MyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvTWF0cml4My5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0gRW1wdHlTZWxmT3B0aW9ucztcclxuXHJcbnR5cGUgY3VwMkRNb2RlbDJETm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFN0cmljdE9taXQ8Tm9kZU9wdGlvbnMsIGtleW9mIE5vZGVUcmFuc2Zvcm1PcHRpb25zIHwgJ2NoaWxkcmVuJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXYXRlckN1cDJETm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHdhdGVyQ3VwOiBXYXRlckN1cCwgd2F0ZXJDdXAzRDogV2F0ZXJDdXAsIG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMiwgbWVhblByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXI+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgaXNTaG93aW5nVGlja01hcmtzUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+LCBpc1Nob3dpbmdNZWFuUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgaXNTaG93aW5nQ3VwV2F0ZXJMZXZlbFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPiwgcHJvdmlkZWRPcHRpb25zPzogY3VwMkRNb2RlbDJETm9kZU9wdGlvbnMgKSB7XHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPGN1cDJETW9kZWwyRE5vZGVPcHRpb25zLCBTZWxmT3B0aW9ucywgTm9kZU9wdGlvbnM+KCkoIHtcclxuICAgICAgeTogbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggMCApIC0gTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DVVBfSEVJR0hULFxyXG4gICAgICBsZWZ0OiB3YXRlckN1cC5wb3NpdGlvbi54LFxyXG4gICAgICB2aXNpYmxlUHJvcGVydHk6IHdhdGVyQ3VwLmlzQWN0aXZlUHJvcGVydHlcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IHRpY2tNYXJrcyA9IG5ldyBXYXRlckN1cDJEVGlja01hcmtzTm9kZShcclxuICAgICAgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DVVBfSEVJR0hULFxyXG4gICAgICB7XHJcbiAgICAgICAgdmlzaWJsZVByb3BlcnR5OiBpc1Nob3dpbmdUaWNrTWFya3NQcm9wZXJ0eSxcclxuXHJcbiAgICAgICAgLy8gcGhldC1pb1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndGlja01hcmtzJyApXHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgLy8gMCBpcyBlbXB0eSwgMSBpcyBmdWxsXHJcbiAgICBjb25zdCB5ID0gVXRpbHMubGluZWFyKCAwLCAxLCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLkNVUF9IRUlHSFQsIDAsIHdhdGVyQ3VwLndhdGVyTGV2ZWxQcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICAgIGNvbnN0IHRvcFN0cm9rZVBhdHRlcm4gPSBuZXcgUGF0dGVybiggZ3JhcGhpdGVUZXh0dXJlX3BuZyApLnNldFRyYW5zZm9ybU1hdHJpeCggTWF0cml4My5hZmZpbmUoIDAuMTUsIDAsIDAsIDAsIDAuMTUsIDAuOSApICk7XHJcbiAgICBjb25zdCBib3R0b21TdHJva2VQYXR0ZXJuID0gbmV3IFBhdHRlcm4oIGdyYXBoaXRlVGV4dHVyZV9wbmcgKS5zZXRUcmFuc2Zvcm1NYXRyaXgoIE1hdHJpeDMuYWZmaW5lKCAwLjE1LCAwLCAwLCAwLCAwLjE1LCAwICkgKTtcclxuICAgIGNvbnN0IHZlcnRpY2FsU3Ryb2tlUGF0dGVybiA9IG5ldyBQYXR0ZXJuKCBncmFwaGl0ZVRleHR1cmVfcG5nICkuc2V0VHJhbnNmb3JtTWF0cml4KCBNYXRyaXgzLmFmZmluZSggMC4xNSAqIE1hdGguY29zKCBNYXRoLlBJIC8gMiApLCAtMC4xNSAqIE1hdGguc2luKCBNYXRoLlBJIC8gMiApLCAwLjk3NSxcclxuICAgICAgMC4xNSAqIE1hdGguc2luKCBNYXRoLlBJIC8gMiApLCAwLjE1ICogTWF0aC5jb3MoIE1hdGguUEkgLyAyICksIDAgKSApO1xyXG5cclxuICAgIGNvbnN0IGN1cFN0cm9rZUxlZnQgPSBuZXcgTGluZSggMCwgMCwgMCwgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DVVBfSEVJR0hULCB7IGxpbmVXaWR0aDogMS45NSwgc3Ryb2tlOiB2ZXJ0aWNhbFN0cm9rZVBhdHRlcm4gfSApO1xyXG4gICAgY29uc3QgY3VwU3Ryb2tlUmlnaHQgPSBuZXcgTGluZSggTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DVVBfV0lEVEgsIDAsIE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuQ1VQX1dJRFRILCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLkNVUF9IRUlHSFQsIHtcclxuICAgICAgbGluZVdpZHRoOiAxLjk1LFxyXG4gICAgICBzdHJva2U6IHZlcnRpY2FsU3Ryb2tlUGF0dGVyblxyXG4gICAgfSApO1xyXG4gICAgY29uc3QgY3VwU3Ryb2tlVG9wID0gbmV3IExpbmUoIDAsIDAsIE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuQ1VQX1dJRFRILCAwLCB7XHJcbiAgICAgIGxpbmVXaWR0aDogMS45NSxcclxuICAgICAgc3Ryb2tlOiB0b3BTdHJva2VQYXR0ZXJuXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBjdXBTdHJva2VCb3R0b20gPSBuZXcgTGluZSggMCwgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DVVBfSEVJR0hULCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLkNVUF9XSURUSCwgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DVVBfSEVJR0hULCB7XHJcbiAgICAgIGxpbmVXaWR0aDogMS45NSxcclxuICAgICAgc3Ryb2tlOiBib3R0b21TdHJva2VQYXR0ZXJuXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3Qgd2F0ZXJDdXBCYWNrZ3JvdW5kUmVjdGFuZ2xlID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DVVBfV0lEVEgsIE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuQ1VQX0hFSUdIVCwgeyBmaWxsOiAnd2hpdGUnIH0gKTtcclxuICAgIGNvbnN0IHdhdGVyTGV2ZWxSZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKCAwLCB5LCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLkNVUF9XSURUSCxcclxuICAgICAgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DVVBfSEVJR0hUICogd2F0ZXJDdXAud2F0ZXJMZXZlbFByb3BlcnR5LnZhbHVlLFxyXG4gICAgICB7IGZpbGw6IE1lYW5TaGFyZUFuZEJhbGFuY2VDb2xvcnMud2F0ZXJGaWxsQ29sb3JQcm9wZXJ0eSB9XHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHdhdGVyTGV2ZWxMaXN0ZW5lciA9ICggd2F0ZXJMZXZlbDogbnVtYmVyICkgPT4ge1xyXG4gICAgICB3YXRlckxldmVsUmVjdGFuZ2xlLnNldFJlY3RIZWlnaHRGcm9tQm90dG9tKCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLkNVUF9IRUlHSFQgKiB3YXRlckxldmVsICk7XHJcbiAgICB9O1xyXG4gICAgd2F0ZXJDdXAud2F0ZXJMZXZlbFByb3BlcnR5LmxpbmsoIHdhdGVyTGV2ZWxMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIE1vZGVsIHZpZXcgdHJhbnNmb3JtIGludmVydHMgWSBtYXBwaW5nLCB0aGVyZWZvcmUgdGhlIG1lYW4gaW52ZXJzZSBpcyBuZWVkZWQgdG8gcGxhY2VcclxuICAgIC8vIHNob3cgbWVhbiBsaW5lIGFjY3VyYXRlbHkgaW4gcmVsYXRpb24gdG8gd2F0ZXIgbGV2ZWxzLlxyXG4gICAgbGV0IG1lYW5JbnZlcnNlID0gMSAtIG1lYW5Qcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICBjb25zdCBtZWFuTGluZSA9IG5ldyBMaW5lKFxyXG4gICAgICAwLFxyXG4gICAgICBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLkNVUF9IRUlHSFQgKiBtZWFuSW52ZXJzZSxcclxuICAgICAgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DVVBfV0lEVEgsXHJcbiAgICAgIE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuQ1VQX0hFSUdIVCAqIG1lYW5JbnZlcnNlLFxyXG4gICAgICB7XHJcbiAgICAgICAgc3Ryb2tlOiBNZWFuU2hhcmVBbmRCYWxhbmNlQ29sb3JzLnNob3dNZWFuTGluZVN0cm9rZUNvbG9yUHJvcGVydHksXHJcbiAgICAgICAgbGluZVdpZHRoOiAyLFxyXG4gICAgICAgIHZpc2libGVQcm9wZXJ0eTogaXNTaG93aW5nTWVhblByb3BlcnR5XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBvcmlnaW5hbFdhdGVyTGV2ZWxMaW5lID0gbmV3IExpbmUoXHJcbiAgICAgIDAsXHJcbiAgICAgIE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuQ1VQX0hFSUdIVCAqIG1lYW5JbnZlcnNlLFxyXG4gICAgICBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLkNVUF9XSURUSCxcclxuICAgICAgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DVVBfSEVJR0hUICogbWVhbkludmVyc2UsXHJcbiAgICAgIHtcclxuICAgICAgICBzdHJva2U6IE1lYW5TaGFyZUFuZEJhbGFuY2VDb2xvcnMuY3VwV2F0ZXJMZXZlbExpbmVDb2xvclByb3BlcnR5LFxyXG4gICAgICAgIGxpbmVXaWR0aDogMSxcclxuICAgICAgICB2aXNpYmxlUHJvcGVydHk6IGlzU2hvd2luZ0N1cFdhdGVyTGV2ZWxQcm9wZXJ0eVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgd2F0ZXJDdXAzRC53YXRlckxldmVsUHJvcGVydHkubGluayggd2xwID0+IHtcclxuICAgICAgbWVhbkludmVyc2UgPSAxIC0gd2xwO1xyXG4gICAgICBvcmlnaW5hbFdhdGVyTGV2ZWxMaW5lLnNldFkxKCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLkNVUF9IRUlHSFQgKiBtZWFuSW52ZXJzZSApO1xyXG4gICAgICBvcmlnaW5hbFdhdGVyTGV2ZWxMaW5lLnNldFkyKCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzLkNVUF9IRUlHSFQgKiBtZWFuSW52ZXJzZSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IG1lYW5MaXN0ZW5lciA9ICggbWVhbjogbnVtYmVyICkgPT4ge1xyXG4gICAgICBtZWFuSW52ZXJzZSA9IDEgLSBtZWFuO1xyXG4gICAgICBtZWFuTGluZS5zZXRZMSggTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DVVBfSEVJR0hUICogbWVhbkludmVyc2UgKTtcclxuICAgICAgbWVhbkxpbmUuc2V0WTIoIE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuQ1VQX0hFSUdIVCAqIG1lYW5JbnZlcnNlICk7XHJcbiAgICB9O1xyXG5cclxuICAgIG1lYW5Qcm9wZXJ0eS5saW5rKCBtZWFuTGlzdGVuZXIgKTtcclxuXHJcbiAgICBjb25zdCBjb21iaW5lZE9wdGlvbnMgPSBjb21iaW5lT3B0aW9uczxOb2RlT3B0aW9ucz4oIHtcclxuICAgICAgY2hpbGRyZW46IFsgd2F0ZXJDdXBCYWNrZ3JvdW5kUmVjdGFuZ2xlLCB3YXRlckxldmVsUmVjdGFuZ2xlLFxyXG4gICAgICAgIGN1cFN0cm9rZUxlZnQsIGN1cFN0cm9rZVJpZ2h0LCBjdXBTdHJva2VUb3AsIGN1cFN0cm9rZUJvdHRvbSwgbWVhbkxpbmUsIG9yaWdpbmFsV2F0ZXJMZXZlbExpbmUsIHRpY2tNYXJrcyBdXHJcbiAgICB9LCBvcHRpb25zICk7XHJcbiAgICBzdXBlciggY29tYmluZWRPcHRpb25zICk7XHJcbiAgfVxyXG59XHJcblxyXG5tZWFuU2hhcmVBbmRCYWxhbmNlLnJlZ2lzdGVyKCAnV2F0ZXJDdXAyRE5vZGUnLCBXYXRlckN1cDJETm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsU0FBUyxJQUFJQyxjQUFjLFFBQTBCLHVDQUF1QztBQUNuRyxTQUFTQyxJQUFJLEVBQUVDLElB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