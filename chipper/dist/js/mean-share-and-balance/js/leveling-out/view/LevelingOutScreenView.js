// Copyright 2022, University of Colorado Boulder

/**
 * Representation for the Leveling Out Screen. Contains people and their chocolates on a plate, as well as a sketch representation
 * of chocolates that can be dragged and 'leveled out'.
 *
 * @author Marla Schulz (PhET Interactive Simulations)
 * @author Sam Reid (PhET Interactive Simulations)
 */

import MeanShareAndBalanceScreenView from '../../common/view/MeanShareAndBalanceScreenView.js';
import meanShareAndBalance from '../../meanShareAndBalance.js';
import { AlignBox, Node } from '../../../../scenery/js/imports.js';
import MeanShareAndBalanceConstants from '../../common/MeanShareAndBalanceConstants.js';
import MeanShareAndBalanceColors from '../../common/MeanShareAndBalanceColors.js';
import MeanShareAndBalanceStrings from '../../MeanShareAndBalanceStrings.js';
import PaperPlateNode from './PaperPlateNode.js';
import LevelingOutControlPanel from './LevelingOutControlPanel.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import TablePlateNode from './TablePlateNode.js';
import TableNode from '../../common/view/TableNode.js';
import NoteBookPaperNode from '../../common/view/NoteBookPaperNode.js';
import DraggableChocolate from './DraggableChocolate.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import PersonImage from './PersonImage.js';
import person1_png from '../../../images/person1_png.js';
import person2_png from '../../../images/person2_png.js';
import person3_png from '../../../images/person3_png.js';
import person4_png from '../../../images/person4_png.js';
import person5_png from '../../../images/person5_png.js';
import person6_png from '../../../images/person6_png.js';
import person7_png from '../../../images/person7_png.js';
import Property from '../../../../axon/js/Property.js';
import MeanCalculationDialog from './MeanCalculationDialog.js';
import optionize from '../../../../phet-core/js/optionize.js';
// constants
const PEOPLE_IMAGES = [person1_png, person2_png, person3_png, person4_png, person5_png, person6_png, person7_png];
export default class LevelingOutScreenView extends MeanShareAndBalanceScreenView {
  constructor(model, providedOptions) {
    const options = providedOptions;
    const controlPanel = new LevelingOutControlPanel(model, model.meanCalculationDialogVisibleProperty, {
      minContentWidth: MeanShareAndBalanceConstants.MAX_CONTROLS_TEXT_WIDTH + 25,
      spacing: 20,
      tandem: options.tandem.createTandem('controlPanel')
    });
    const tableNode = new TableNode();

    // REVIEW: lowercase b
    const notebookPaper = new NoteBookPaperNode();

    // To constrain the dragging of chocolate nodes in the upper area, we need to track the bounds of the paper
    // But since the chocolateLayerNode changes its horizontal position to keep things centered for varying
    // numbers of people, we must coordinate the drag bounds when that changes.
    // This is in the coordinate frame of the chocolateLayerNode.
    // This initial value is not in the correct coordinate frame but it is specified correctly before the end of the
    // constructor
    const notebookPaperBoundsProperty = new Property(notebookPaper.bounds);

    // function for what chocolate bars should do at the end of their drag
    const chocolateBarDropped = chocolateBar => {
      const platesWithSpace = model.getPlatesWithSpace(model.getActivePlates());

      // find the plate closest to where the chocolate bar was dropped.
      const closestPlate = _.minBy(platesWithSpace, plate => Math.abs(platesWithSpace[0].position.x - chocolateBar.chocolateBar.positionProperty.value.x));
      assert && assert(closestPlate !== undefined, 'There should always be a plate with space when a bar is dropped');

      // set dropped chocolate bar's position
      const numberOfChocolatesOnPlate = model.getActivePlateStateChocolates(closestPlate).length;
      const oldY = chocolateBar.chocolateBar.positionProperty.value.y;
      const y = closestPlate.position.y - (MeanShareAndBalanceConstants.CHOCOLATE_HEIGHT + 2) * (numberOfChocolatesOnPlate + 1);
      chocolateBar.chocolateBar.positionProperty.set(new Vector2(closestPlate.position.x, y));

      // swap chocolates if parentPlate changes, so that each person always has the same number of inactive + active chocolates
      // so that when their spinner is incremented, they can promote their own inactive chocolate to active.
      const currentParent = chocolateBar.chocolateBar.parentPlateProperty.value;
      if (currentParent !== closestPlate) {
        const inactiveChocolateForSwap = model.getBottomInactiveChocolateOnPlate(closestPlate);
        inactiveChocolateForSwap.positionProperty.set(new Vector2(currentParent.position.x, oldY));
        inactiveChocolateForSwap.parentPlateProperty.set(currentParent);
      }
      chocolateBar.chocolateBar.parentPlateProperty.set(closestPlate);
    };

    // Creating the bottom representation of chocolates on the table
    const tablePlatesNodes = model.peopleArray.map(person => new TablePlateNode(person, {
      tandem: options.tandem.createTandem(`person${person.linePlacement + 1}`)
    }));
    const people = tablePlatesNodes.map((plate, i) => {
      const selectedImage = PEOPLE_IMAGES[i];
      assert && assert(selectedImage, `No corresponding image for index: ${i}`);
      return new PersonImage(selectedImage, plate, {
        visibleProperty: plate.visibleProperty,
        tandem: options.tandem.createTandem(`person${i + 1}`)
      });
    });
    const peopleLayerNode = new Node({
      children: people,
      // The entire node containing people is centered.  If the invisible people contribute to the bounds, then when
      // only one person is showing, they will be way off to the left.
      excludeInvisibleChildrenFromBounds: true
    });

    // Creating the top representation of chocolates on the paper
    const paperPlatesNodes = model.platesArray.map(plate => new PaperPlateNode(plate, chocolateBarDropped, {
      tandem: options.tandem.createTandem(`plate${plate.linePlacement + 1}`)
    }));
    const chocolateBarsParentTandem = options.tandem.createTandem('chocolateBars');
    const draggableChocolateBars = model.chocolatesArray.map((chocolate, i) => new DraggableChocolate(model, chocolate, notebookPaperBoundsProperty, chocolateBarDropped, {
      tandem: chocolateBarsParentTandem.createTandem(`chocolateBar${i + 1}`),
      visibleProperty: chocolate.isActiveProperty
    }));

    // This contains all the chocolates from the top (paper) representation and the bottom (table) representation.
    const chocolateLayerNode = new Node({
      // See peopleLayerNode.excludeInvisibleChildrenFromBounds comment
      excludeInvisibleChildrenFromBounds: true,
      children: [...tablePlatesNodes, ...paperPlatesNodes, ...draggableChocolateBars]
    });
    const meanCalculationDialog = new MeanCalculationDialog(model.peopleArray, model.meanCalculationDialogVisibleProperty, notebookPaper.bounds);
    const superOptions = optionize()({
      children: [notebookPaper, peopleLayerNode, tableNode, chocolateLayerNode]
    }, options);
    super(model, MeanShareAndBalanceStrings.levelingOutQuestionStringProperty, MeanShareAndBalanceColors.levelingOutQuestionBarColorProperty, superOptions);
    const checkboxGroupWidthOffset = (MeanShareAndBalanceConstants.MAX_CONTROLS_TEXT_WIDTH + MeanShareAndBalanceConstants.CONTROLS_HORIZONTAL_MARGIN) / 2;
    const playAreaCenterX = this.layoutBounds.centerX - checkboxGroupWidthOffset;
    const centerPlayAreaNodes = () => {
      // The chocolateLayerNode and peopleLayerNode bounds change when the number of people change, due to excludeInvisibleChildrenFromBounds
      chocolateLayerNode.centerX = playAreaCenterX;
      peopleLayerNode.centerX = playAreaCenterX - 45;
      tableNode.centerX = chocolateLayerNode.centerX - 10;
      tableNode.y = chocolateLayerNode.bottom - 120;
      notebookPaper.centerX = chocolateLayerNode.centerX;
      meanCalculationDialog.centerX = chocolateLayerNode.centerX;

      // Transform to the bounds of the chocolate, since they are in an intermediate layer
      notebookPaperBoundsProperty.value = chocolateLayerNode.globalToLocalBounds(notebookPaper.globalBounds);
    };
    model.numberOfPeopleProperty.link(() => {
      centerPlayAreaNodes();
      this.interruptSubtreeInput();
    });

    // Don't include the questionBar in the usable bounds
    const playAreaBounds = new Bounds2(this.layoutBounds.minX, this.layoutBounds.minY + this.questionBar.height, this.layoutBounds.maxX, this.layoutBounds.maxY);
    const controlsAlignBox = new AlignBox(controlPanel, {
      alignBounds: playAreaBounds,
      xAlign: 'right',
      yAlign: 'top',
      rightMargin: MeanShareAndBalanceConstants.CONTROLS_HORIZONTAL_MARGIN,
      topMargin: MeanShareAndBalanceConstants.CONTROLS_VERTICAL_MARGIN
    });
    this.addChild(controlsAlignBox);
    this.addChild(meanCalculationDialog);
    this.meanCalculationDialogVisibleProperty = model.meanCalculationDialogVisibleProperty;
  }
}
meanShareAndBalance.register('LevelingOutScreenView', LevelingOutScreenView);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNZWFuU2hhcmVBbmRCYWxhbmNlU2NyZWVuVmlldyIsIm1lYW5TaGFyZUFuZEJhbGFuY2UiLCJBbGlnbkJveCIsIk5vZGUiLCJNZWFuU2hhcmVBbmRCYWxhbmNlQ29uc3RhbnRzIiwiTWVhblNoYXJlQW5kQmFsYW5jZUNvbG9ycyIsIk1lYW5TaGFyZUFuZEJhbGFuY2VTdHJpbmdzIiwiUGFwZXJQbGF0ZU5vZGUiLCJMZXZlbGluZ091dENvbnRyb2xQYW5lbCIsIkJvdW5kczIiLCJUYWJsZVBsYXRlTm9kZSIsIlRhYmxlTm9kZSIsIk5vdGVCb29rUGFwZXJOb2RlIiwiRHJhZ2dhYmxlQ2hvY29sYXRlIiwiVmVjdG9yMiIsIlBlcnNvbkltYWdlIiwicGVyc29uMV9wbmciLCJwZXJzb24yX3BuZyIsInBlcnNvbjNfcG5nIiwicGVyc29uNF9wbmciLCJwZXJzb241X3BuZyIsInBlcnNvbjZfcG5nIiwicGVyc29uN19wbmciLCJQcm9wZXJ0eSIsIk1lYW5DYWxjdWxhdGlvbkRpYWxvZyIsIm9wdGlvbml6ZSIsIlBFT1BMRV9JTUFHRVMiLCJMZXZlbGluZ091dFNjcmVlblZpZXciLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImNvbnRyb2xQYW5lbCIsIm1lYW5DYWxjdWxhdGlvbkRpYWxvZ1Zpc2libGVQcm9wZXJ0eSIsIm1pbkNvbnRlbnRXaWR0aCIsIk1BWF9DT05UUk9MU19URVhUX1dJRFRIIiwic3BhY2luZyIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsInRhYmxlTm9kZSIsIm5vdGVib29rUGFwZXIiLCJub3RlYm9va1BhcGVyQm91bmRzUHJvcGVydHkiLCJib3VuZHMiLCJjaG9jb2xhdGVCYXJEcm9wcGVkIiwiY2hvY29sYXRlQmFyIiwicGxhdGVzV2l0aFNwYWNlIiwiZ2V0UGxhdGVzV2l0aFNwYWNlIiwiZ2V0QWN0aXZlUGxhdGVzIiwiY2xvc2VzdFBsYXRlIiwiXyIsIm1pbkJ5IiwicGxhdGUiLCJNYXRoIiwiYWJzIiwicG9zaXRpb24iLCJ4IiwicG9zaXRpb25Qcm9wZXJ0eSIsInZhbHVlIiwiYXNzZXJ0IiwidW5kZWZpbmVkIiwibnVtYmVyT2ZDaG9jb2xhdGVzT25QbGF0ZSIsImdldEFjdGl2ZVBsYXRlU3RhdGVDaG9jb2xhdGVzIiwibGVuZ3RoIiwib2xkWSIsInkiLCJDSE9DT0xBVEVfSEVJR0hUIiwic2V0IiwiY3VycmVudFBhcmVudCIsInBhcmVudFBsYXRlUHJvcGVydHkiLCJpbmFjdGl2ZUNob2NvbGF0ZUZvclN3YXAiLCJnZXRCb3R0b21JbmFjdGl2ZUNob2NvbGF0ZU9uUGxhdGUiLCJ0YWJsZVBsYXRlc05vZGVzIiwicGVvcGxlQXJyYXkiLCJtYXAiLCJwZXJzb24iLCJsaW5lUGxhY2VtZW50IiwicGVvcGxlIiwiaSIsInNlbGVjdGVkSW1hZ2UiLCJ2aXNpYmxlUHJvcGVydHkiLCJwZW9wbGVMYXllck5vZGUiLCJjaGlsZHJlbiIsImV4Y2x1ZGVJbnZpc2libGVDaGlsZHJlbkZyb21Cb3VuZHMiLCJwYXBlclBsYXRlc05vZGVzIiwicGxhdGVzQXJyYXkiLCJjaG9jb2xhdGVCYXJzUGFyZW50VGFuZGVtIiwiZHJhZ2dhYmxlQ2hvY29sYXRlQmFycyIsImNob2NvbGF0ZXNBcnJheSIsImNob2NvbGF0ZSIsImlzQWN0aXZlUHJvcGVydHkiLCJjaG9jb2xhdGVMYXllck5vZGUiLCJtZWFuQ2FsY3VsYXRpb25EaWFsb2ciLCJzdXBlck9wdGlvbnMiLCJsZXZlbGluZ091dFF1ZXN0aW9uU3RyaW5nUHJvcGVydHkiLCJsZXZlbGluZ091dFF1ZXN0aW9uQmFyQ29sb3JQcm9wZXJ0eSIsImNoZWNrYm94R3JvdXBXaWR0aE9mZnNldCIsIkNPTlRST0xTX0hPUklaT05UQUxfTUFSR0lOIiwicGxheUFyZWFDZW50ZXJYIiwibGF5b3V0Qm91bmRzIiwiY2VudGVyWCIsImNlbnRlclBsYXlBcmVhTm9kZXMiLCJib3R0b20iLCJnbG9iYWxUb0xvY2FsQm91bmRzIiwiZ2xvYmFsQm91bmRzIiwibnVtYmVyT2ZQZW9wbGVQcm9wZXJ0eSIsImxpbmsiLCJpbnRlcnJ1cHRTdWJ0cmVlSW5wdXQiLCJwbGF5QXJlYUJvdW5kcyIsIm1pblgiLCJtaW5ZIiwicXVlc3Rpb25CYXIiLCJoZWlnaHQiLCJtYXhYIiwibWF4WSIsImNvbnRyb2xzQWxpZ25Cb3giLCJhbGlnbkJvdW5kcyIsInhBbGlnbiIsInlBbGlnbiIsInJpZ2h0TWFyZ2luIiwidG9wTWFyZ2luIiwiQ09OVFJPTFNfVkVSVElDQUxfTUFSR0lOIiwiYWRkQ2hpbGQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkxldmVsaW5nT3V0U2NyZWVuVmlldy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogUmVwcmVzZW50YXRpb24gZm9yIHRoZSBMZXZlbGluZyBPdXQgU2NyZWVuLiBDb250YWlucyBwZW9wbGUgYW5kIHRoZWlyIGNob2NvbGF0ZXMgb24gYSBwbGF0ZSwgYXMgd2VsbCBhcyBhIHNrZXRjaCByZXByZXNlbnRhdGlvblxyXG4gKiBvZiBjaG9jb2xhdGVzIHRoYXQgY2FuIGJlIGRyYWdnZWQgYW5kICdsZXZlbGVkIG91dCcuXHJcbiAqXHJcbiAqIEBhdXRob3IgTWFybGEgU2NodWx6IChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBNZWFuU2hhcmVBbmRCYWxhbmNlU2NyZWVuVmlldywgeyBNZWFuU2hhcmVBbmRCYWxhbmNlU2NyZWVuVmlld09wdGlvbnMgfSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9NZWFuU2hhcmVBbmRCYWxhbmNlU2NyZWVuVmlldy5qcyc7XHJcbmltcG9ydCBtZWFuU2hhcmVBbmRCYWxhbmNlIGZyb20gJy4uLy4uL21lYW5TaGFyZUFuZEJhbGFuY2UuanMnO1xyXG5pbXBvcnQgTGV2ZWxpbmdPdXRNb2RlbCBmcm9tICcuLi9tb2RlbC9MZXZlbGluZ091dE1vZGVsLmpzJztcclxuaW1wb3J0IHsgQWxpZ25Cb3gsIE5vZGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBNZWFuU2hhcmVBbmRCYWxhbmNlQ29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi9NZWFuU2hhcmVBbmRCYWxhbmNlQ29sb3JzLmpzJztcclxuaW1wb3J0IE1lYW5TaGFyZUFuZEJhbGFuY2VTdHJpbmdzIGZyb20gJy4uLy4uL01lYW5TaGFyZUFuZEJhbGFuY2VTdHJpbmdzLmpzJztcclxuaW1wb3J0IFBhcGVyUGxhdGVOb2RlIGZyb20gJy4vUGFwZXJQbGF0ZU5vZGUuanMnO1xyXG5pbXBvcnQgTGV2ZWxpbmdPdXRDb250cm9sUGFuZWwgZnJvbSAnLi9MZXZlbGluZ091dENvbnRyb2xQYW5lbC5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IHsgU2NyZWVuVmlld09wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9qb2lzdC9qcy9TY3JlZW5WaWV3LmpzJztcclxuaW1wb3J0IFRhYmxlUGxhdGVOb2RlIGZyb20gJy4vVGFibGVQbGF0ZU5vZGUuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBUYWJsZU5vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvVGFibGVOb2RlLmpzJztcclxuaW1wb3J0IE5vdGVCb29rUGFwZXJOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L05vdGVCb29rUGFwZXJOb2RlLmpzJztcclxuaW1wb3J0IERyYWdnYWJsZUNob2NvbGF0ZSBmcm9tICcuL0RyYWdnYWJsZUNob2NvbGF0ZS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IFBlcnNvbkltYWdlIGZyb20gJy4vUGVyc29uSW1hZ2UuanMnO1xyXG5pbXBvcnQgcGVyc29uMV9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL3BlcnNvbjFfcG5nLmpzJztcclxuaW1wb3J0IHBlcnNvbjJfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9wZXJzb24yX3BuZy5qcyc7XHJcbmltcG9ydCBwZXJzb24zX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvcGVyc29uM19wbmcuanMnO1xyXG5pbXBvcnQgcGVyc29uNF9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL3BlcnNvbjRfcG5nLmpzJztcclxuaW1wb3J0IHBlcnNvbjVfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9wZXJzb241X3BuZy5qcyc7XHJcbmltcG9ydCBwZXJzb242X3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvcGVyc29uNl9wbmcuanMnO1xyXG5pbXBvcnQgcGVyc29uN19wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL3BlcnNvbjdfcG5nLmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTWVhbkNhbGN1bGF0aW9uRGlhbG9nIGZyb20gJy4vTWVhbkNhbGN1bGF0aW9uRGlhbG9nLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0gRW1wdHlTZWxmT3B0aW9ucztcclxudHlwZSBMZXZlbGluZ091dFNjcmVlblZpZXdPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PE1lYW5TaGFyZUFuZEJhbGFuY2VTY3JlZW5WaWV3T3B0aW9ucywgJ2NoaWxkcmVuJz47XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgUEVPUExFX0lNQUdFUyA9IFsgcGVyc29uMV9wbmcsIHBlcnNvbjJfcG5nLCBwZXJzb24zX3BuZywgcGVyc29uNF9wbmcsIHBlcnNvbjVfcG5nLCBwZXJzb242X3BuZywgcGVyc29uN19wbmcgXTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExldmVsaW5nT3V0U2NyZWVuVmlldyBleHRlbmRzIE1lYW5TaGFyZUFuZEJhbGFuY2VTY3JlZW5WaWV3IHtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IG1lYW5DYWxjdWxhdGlvbkRpYWxvZ1Zpc2libGVQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbW9kZWw6IExldmVsaW5nT3V0TW9kZWwsIHByb3ZpZGVkT3B0aW9uczogTGV2ZWxpbmdPdXRTY3JlZW5WaWV3T3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gcHJvdmlkZWRPcHRpb25zO1xyXG5cclxuICAgIGNvbnN0IGNvbnRyb2xQYW5lbCA9IG5ldyBMZXZlbGluZ091dENvbnRyb2xQYW5lbCggbW9kZWwsIG1vZGVsLm1lYW5DYWxjdWxhdGlvbkRpYWxvZ1Zpc2libGVQcm9wZXJ0eSwge1xyXG4gICAgICBtaW5Db250ZW50V2lkdGg6IE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuTUFYX0NPTlRST0xTX1RFWFRfV0lEVEggKyAyNSxcclxuICAgICAgc3BhY2luZzogMjAsXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnY29udHJvbFBhbmVsJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgdGFibGVOb2RlID0gbmV3IFRhYmxlTm9kZSgpO1xyXG5cclxuICAgIC8vIFJFVklFVzogbG93ZXJjYXNlIGJcclxuICAgIGNvbnN0IG5vdGVib29rUGFwZXIgPSBuZXcgTm90ZUJvb2tQYXBlck5vZGUoKTtcclxuXHJcbiAgICAvLyBUbyBjb25zdHJhaW4gdGhlIGRyYWdnaW5nIG9mIGNob2NvbGF0ZSBub2RlcyBpbiB0aGUgdXBwZXIgYXJlYSwgd2UgbmVlZCB0byB0cmFjayB0aGUgYm91bmRzIG9mIHRoZSBwYXBlclxyXG4gICAgLy8gQnV0IHNpbmNlIHRoZSBjaG9jb2xhdGVMYXllck5vZGUgY2hhbmdlcyBpdHMgaG9yaXpvbnRhbCBwb3NpdGlvbiB0byBrZWVwIHRoaW5ncyBjZW50ZXJlZCBmb3IgdmFyeWluZ1xyXG4gICAgLy8gbnVtYmVycyBvZiBwZW9wbGUsIHdlIG11c3QgY29vcmRpbmF0ZSB0aGUgZHJhZyBib3VuZHMgd2hlbiB0aGF0IGNoYW5nZXMuXHJcbiAgICAvLyBUaGlzIGlzIGluIHRoZSBjb29yZGluYXRlIGZyYW1lIG9mIHRoZSBjaG9jb2xhdGVMYXllck5vZGUuXHJcbiAgICAvLyBUaGlzIGluaXRpYWwgdmFsdWUgaXMgbm90IGluIHRoZSBjb3JyZWN0IGNvb3JkaW5hdGUgZnJhbWUgYnV0IGl0IGlzIHNwZWNpZmllZCBjb3JyZWN0bHkgYmVmb3JlIHRoZSBlbmQgb2YgdGhlXHJcbiAgICAvLyBjb25zdHJ1Y3RvclxyXG4gICAgY29uc3Qgbm90ZWJvb2tQYXBlckJvdW5kc1Byb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBub3RlYm9va1BhcGVyLmJvdW5kcyApO1xyXG5cclxuICAgIC8vIGZ1bmN0aW9uIGZvciB3aGF0IGNob2NvbGF0ZSBiYXJzIHNob3VsZCBkbyBhdCB0aGUgZW5kIG9mIHRoZWlyIGRyYWdcclxuICAgIGNvbnN0IGNob2NvbGF0ZUJhckRyb3BwZWQgPSAoIGNob2NvbGF0ZUJhcjogRHJhZ2dhYmxlQ2hvY29sYXRlICkgPT4ge1xyXG4gICAgICBjb25zdCBwbGF0ZXNXaXRoU3BhY2UgPSBtb2RlbC5nZXRQbGF0ZXNXaXRoU3BhY2UoIG1vZGVsLmdldEFjdGl2ZVBsYXRlcygpICk7XHJcblxyXG4gICAgICAvLyBmaW5kIHRoZSBwbGF0ZSBjbG9zZXN0IHRvIHdoZXJlIHRoZSBjaG9jb2xhdGUgYmFyIHdhcyBkcm9wcGVkLlxyXG4gICAgICBjb25zdCBjbG9zZXN0UGxhdGUgPSBfLm1pbkJ5KCBwbGF0ZXNXaXRoU3BhY2UsIHBsYXRlID0+IE1hdGguYWJzKCBwbGF0ZXNXaXRoU3BhY2VbIDAgXS5wb3NpdGlvbi54IC0gY2hvY29sYXRlQmFyLmNob2NvbGF0ZUJhci5wb3NpdGlvblByb3BlcnR5LnZhbHVlLnggKSApO1xyXG5cclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggY2xvc2VzdFBsYXRlICE9PSB1bmRlZmluZWQsICdUaGVyZSBzaG91bGQgYWx3YXlzIGJlIGEgcGxhdGUgd2l0aCBzcGFjZSB3aGVuIGEgYmFyIGlzIGRyb3BwZWQnICk7XHJcblxyXG4gICAgICAvLyBzZXQgZHJvcHBlZCBjaG9jb2xhdGUgYmFyJ3MgcG9zaXRpb25cclxuICAgICAgY29uc3QgbnVtYmVyT2ZDaG9jb2xhdGVzT25QbGF0ZSA9IG1vZGVsLmdldEFjdGl2ZVBsYXRlU3RhdGVDaG9jb2xhdGVzKCBjbG9zZXN0UGxhdGUhICkubGVuZ3RoO1xyXG4gICAgICBjb25zdCBvbGRZID0gY2hvY29sYXRlQmFyLmNob2NvbGF0ZUJhci5wb3NpdGlvblByb3BlcnR5LnZhbHVlLnk7XHJcbiAgICAgIGNvbnN0IHkgPSBjbG9zZXN0UGxhdGUhLnBvc2l0aW9uLnkgLSAoICggTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DSE9DT0xBVEVfSEVJR0hUICsgMiApICogKCBudW1iZXJPZkNob2NvbGF0ZXNPblBsYXRlICsgMSApICk7XHJcbiAgICAgIGNob2NvbGF0ZUJhci5jaG9jb2xhdGVCYXIucG9zaXRpb25Qcm9wZXJ0eS5zZXQoIG5ldyBWZWN0b3IyKCBjbG9zZXN0UGxhdGUhLnBvc2l0aW9uLngsIHkgKSApO1xyXG5cclxuICAgICAgLy8gc3dhcCBjaG9jb2xhdGVzIGlmIHBhcmVudFBsYXRlIGNoYW5nZXMsIHNvIHRoYXQgZWFjaCBwZXJzb24gYWx3YXlzIGhhcyB0aGUgc2FtZSBudW1iZXIgb2YgaW5hY3RpdmUgKyBhY3RpdmUgY2hvY29sYXRlc1xyXG4gICAgICAvLyBzbyB0aGF0IHdoZW4gdGhlaXIgc3Bpbm5lciBpcyBpbmNyZW1lbnRlZCwgdGhleSBjYW4gcHJvbW90ZSB0aGVpciBvd24gaW5hY3RpdmUgY2hvY29sYXRlIHRvIGFjdGl2ZS5cclxuICAgICAgY29uc3QgY3VycmVudFBhcmVudCA9IGNob2NvbGF0ZUJhci5jaG9jb2xhdGVCYXIucGFyZW50UGxhdGVQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgaWYgKCBjdXJyZW50UGFyZW50ICE9PSBjbG9zZXN0UGxhdGUgKSB7XHJcbiAgICAgICAgY29uc3QgaW5hY3RpdmVDaG9jb2xhdGVGb3JTd2FwID0gbW9kZWwuZ2V0Qm90dG9tSW5hY3RpdmVDaG9jb2xhdGVPblBsYXRlKCBjbG9zZXN0UGxhdGUhICk7XHJcbiAgICAgICAgaW5hY3RpdmVDaG9jb2xhdGVGb3JTd2FwLnBvc2l0aW9uUHJvcGVydHkuc2V0KCBuZXcgVmVjdG9yMiggY3VycmVudFBhcmVudC5wb3NpdGlvbi54LCBvbGRZICkgKTtcclxuICAgICAgICBpbmFjdGl2ZUNob2NvbGF0ZUZvclN3YXAucGFyZW50UGxhdGVQcm9wZXJ0eS5zZXQoIGN1cnJlbnRQYXJlbnQgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY2hvY29sYXRlQmFyLmNob2NvbGF0ZUJhci5wYXJlbnRQbGF0ZVByb3BlcnR5LnNldCggY2xvc2VzdFBsYXRlISApO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgLy8gQ3JlYXRpbmcgdGhlIGJvdHRvbSByZXByZXNlbnRhdGlvbiBvZiBjaG9jb2xhdGVzIG9uIHRoZSB0YWJsZVxyXG4gICAgY29uc3QgdGFibGVQbGF0ZXNOb2RlcyA9IG1vZGVsLnBlb3BsZUFycmF5Lm1hcCggcGVyc29uID0+IG5ldyBUYWJsZVBsYXRlTm9kZSggcGVyc29uLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCBgcGVyc29uJHtwZXJzb24ubGluZVBsYWNlbWVudCArIDF9YCApXHJcbiAgICB9ICkgKTtcclxuXHJcbiAgICBjb25zdCBwZW9wbGUgPSB0YWJsZVBsYXRlc05vZGVzLm1hcCggKCBwbGF0ZSwgaSApID0+IHtcclxuICAgICAgY29uc3Qgc2VsZWN0ZWRJbWFnZSA9IFBFT1BMRV9JTUFHRVNbIGkgXTtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggc2VsZWN0ZWRJbWFnZSwgYE5vIGNvcnJlc3BvbmRpbmcgaW1hZ2UgZm9yIGluZGV4OiAke2l9YCApO1xyXG4gICAgICByZXR1cm4gbmV3IFBlcnNvbkltYWdlKCBzZWxlY3RlZEltYWdlLCBwbGF0ZSwge1xyXG4gICAgICAgIHZpc2libGVQcm9wZXJ0eTogcGxhdGUudmlzaWJsZVByb3BlcnR5LCB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggYHBlcnNvbiR7aSArIDF9YCApXHJcbiAgICAgIH0gKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBwZW9wbGVMYXllck5vZGUgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogcGVvcGxlLFxyXG5cclxuICAgICAgLy8gVGhlIGVudGlyZSBub2RlIGNvbnRhaW5pbmcgcGVvcGxlIGlzIGNlbnRlcmVkLiAgSWYgdGhlIGludmlzaWJsZSBwZW9wbGUgY29udHJpYnV0ZSB0byB0aGUgYm91bmRzLCB0aGVuIHdoZW5cclxuICAgICAgLy8gb25seSBvbmUgcGVyc29uIGlzIHNob3dpbmcsIHRoZXkgd2lsbCBiZSB3YXkgb2ZmIHRvIHRoZSBsZWZ0LlxyXG4gICAgICBleGNsdWRlSW52aXNpYmxlQ2hpbGRyZW5Gcm9tQm91bmRzOiB0cnVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQ3JlYXRpbmcgdGhlIHRvcCByZXByZXNlbnRhdGlvbiBvZiBjaG9jb2xhdGVzIG9uIHRoZSBwYXBlclxyXG4gICAgY29uc3QgcGFwZXJQbGF0ZXNOb2RlcyA9IG1vZGVsLnBsYXRlc0FycmF5Lm1hcCggcGxhdGUgPT4gbmV3IFBhcGVyUGxhdGVOb2RlKCBwbGF0ZSwgY2hvY29sYXRlQmFyRHJvcHBlZCwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggYHBsYXRlJHtwbGF0ZS5saW5lUGxhY2VtZW50ICsgMX1gIClcclxuICAgIH0gKSApO1xyXG5cclxuICAgIGNvbnN0IGNob2NvbGF0ZUJhcnNQYXJlbnRUYW5kZW0gPSBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdjaG9jb2xhdGVCYXJzJyApO1xyXG4gICAgY29uc3QgZHJhZ2dhYmxlQ2hvY29sYXRlQmFycyA9IG1vZGVsLmNob2NvbGF0ZXNBcnJheS5tYXAoICggY2hvY29sYXRlLCBpICkgPT5cclxuICAgICAgbmV3IERyYWdnYWJsZUNob2NvbGF0ZSggbW9kZWwsIGNob2NvbGF0ZSwgbm90ZWJvb2tQYXBlckJvdW5kc1Byb3BlcnR5LCBjaG9jb2xhdGVCYXJEcm9wcGVkLCB7XHJcbiAgICAgICAgdGFuZGVtOiBjaG9jb2xhdGVCYXJzUGFyZW50VGFuZGVtLmNyZWF0ZVRhbmRlbSggYGNob2NvbGF0ZUJhciR7aSArIDF9YCApLFxyXG4gICAgICAgIHZpc2libGVQcm9wZXJ0eTogY2hvY29sYXRlLmlzQWN0aXZlUHJvcGVydHlcclxuICAgICAgfSApICk7XHJcblxyXG4gICAgLy8gVGhpcyBjb250YWlucyBhbGwgdGhlIGNob2NvbGF0ZXMgZnJvbSB0aGUgdG9wIChwYXBlcikgcmVwcmVzZW50YXRpb24gYW5kIHRoZSBib3R0b20gKHRhYmxlKSByZXByZXNlbnRhdGlvbi5cclxuICAgIGNvbnN0IGNob2NvbGF0ZUxheWVyTm9kZSA9IG5ldyBOb2RlKCB7XHJcblxyXG4gICAgICAvLyBTZWUgcGVvcGxlTGF5ZXJOb2RlLmV4Y2x1ZGVJbnZpc2libGVDaGlsZHJlbkZyb21Cb3VuZHMgY29tbWVudFxyXG4gICAgICBleGNsdWRlSW52aXNpYmxlQ2hpbGRyZW5Gcm9tQm91bmRzOiB0cnVlLFxyXG4gICAgICBjaGlsZHJlbjogWyAuLi50YWJsZVBsYXRlc05vZGVzLCAuLi5wYXBlclBsYXRlc05vZGVzLCAuLi5kcmFnZ2FibGVDaG9jb2xhdGVCYXJzIF1cclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBtZWFuQ2FsY3VsYXRpb25EaWFsb2cgPSBuZXcgTWVhbkNhbGN1bGF0aW9uRGlhbG9nKFxyXG4gICAgICBtb2RlbC5wZW9wbGVBcnJheSxcclxuICAgICAgbW9kZWwubWVhbkNhbGN1bGF0aW9uRGlhbG9nVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICBub3RlYm9va1BhcGVyLmJvdW5kc1xyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBzdXBlck9wdGlvbnMgPSBvcHRpb25pemU8TGV2ZWxpbmdPdXRTY3JlZW5WaWV3T3B0aW9ucywgU2VsZk9wdGlvbnMsIFNjcmVlblZpZXdPcHRpb25zPigpKCB7IGNoaWxkcmVuOiBbIG5vdGVib29rUGFwZXIsIHBlb3BsZUxheWVyTm9kZSwgdGFibGVOb2RlLCBjaG9jb2xhdGVMYXllck5vZGUgXSB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG1vZGVsLCBNZWFuU2hhcmVBbmRCYWxhbmNlU3RyaW5ncy5sZXZlbGluZ091dFF1ZXN0aW9uU3RyaW5nUHJvcGVydHksIE1lYW5TaGFyZUFuZEJhbGFuY2VDb2xvcnMubGV2ZWxpbmdPdXRRdWVzdGlvbkJhckNvbG9yUHJvcGVydHksIHN1cGVyT3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IGNoZWNrYm94R3JvdXBXaWR0aE9mZnNldCA9ICggTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5NQVhfQ09OVFJPTFNfVEVYVF9XSURUSCArIE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuQ09OVFJPTFNfSE9SSVpPTlRBTF9NQVJHSU4gKSAvIDI7XHJcbiAgICBjb25zdCBwbGF5QXJlYUNlbnRlclggPSB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJYIC0gY2hlY2tib3hHcm91cFdpZHRoT2Zmc2V0O1xyXG5cclxuICAgIGNvbnN0IGNlbnRlclBsYXlBcmVhTm9kZXMgPSAoKSA9PiB7XHJcblxyXG4gICAgICAvLyBUaGUgY2hvY29sYXRlTGF5ZXJOb2RlIGFuZCBwZW9wbGVMYXllck5vZGUgYm91bmRzIGNoYW5nZSB3aGVuIHRoZSBudW1iZXIgb2YgcGVvcGxlIGNoYW5nZSwgZHVlIHRvIGV4Y2x1ZGVJbnZpc2libGVDaGlsZHJlbkZyb21Cb3VuZHNcclxuICAgICAgY2hvY29sYXRlTGF5ZXJOb2RlLmNlbnRlclggPSBwbGF5QXJlYUNlbnRlclg7XHJcbiAgICAgIHBlb3BsZUxheWVyTm9kZS5jZW50ZXJYID0gcGxheUFyZWFDZW50ZXJYIC0gNDU7XHJcblxyXG4gICAgICB0YWJsZU5vZGUuY2VudGVyWCA9IGNob2NvbGF0ZUxheWVyTm9kZS5jZW50ZXJYIC0gMTA7XHJcbiAgICAgIHRhYmxlTm9kZS55ID0gY2hvY29sYXRlTGF5ZXJOb2RlLmJvdHRvbSAtIDEyMDtcclxuICAgICAgbm90ZWJvb2tQYXBlci5jZW50ZXJYID0gY2hvY29sYXRlTGF5ZXJOb2RlLmNlbnRlclg7XHJcbiAgICAgIG1lYW5DYWxjdWxhdGlvbkRpYWxvZy5jZW50ZXJYID0gY2hvY29sYXRlTGF5ZXJOb2RlLmNlbnRlclg7XHJcblxyXG4gICAgICAvLyBUcmFuc2Zvcm0gdG8gdGhlIGJvdW5kcyBvZiB0aGUgY2hvY29sYXRlLCBzaW5jZSB0aGV5IGFyZSBpbiBhbiBpbnRlcm1lZGlhdGUgbGF5ZXJcclxuICAgICAgbm90ZWJvb2tQYXBlckJvdW5kc1Byb3BlcnR5LnZhbHVlID0gY2hvY29sYXRlTGF5ZXJOb2RlLmdsb2JhbFRvTG9jYWxCb3VuZHMoIG5vdGVib29rUGFwZXIuZ2xvYmFsQm91bmRzICk7XHJcbiAgICB9O1xyXG5cclxuICAgIG1vZGVsLm51bWJlck9mUGVvcGxlUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICBjZW50ZXJQbGF5QXJlYU5vZGVzKCk7XHJcbiAgICAgIHRoaXMuaW50ZXJydXB0U3VidHJlZUlucHV0KCk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gRG9uJ3QgaW5jbHVkZSB0aGUgcXVlc3Rpb25CYXIgaW4gdGhlIHVzYWJsZSBib3VuZHNcclxuICAgIGNvbnN0IHBsYXlBcmVhQm91bmRzID0gbmV3IEJvdW5kczIoIHRoaXMubGF5b3V0Qm91bmRzLm1pblgsIHRoaXMubGF5b3V0Qm91bmRzLm1pblkgKyB0aGlzLnF1ZXN0aW9uQmFyLmhlaWdodCxcclxuICAgICAgdGhpcy5sYXlvdXRCb3VuZHMubWF4WCwgdGhpcy5sYXlvdXRCb3VuZHMubWF4WSApO1xyXG5cclxuICAgIGNvbnN0IGNvbnRyb2xzQWxpZ25Cb3ggPSBuZXcgQWxpZ25Cb3goIGNvbnRyb2xQYW5lbCwge1xyXG4gICAgICBhbGlnbkJvdW5kczogcGxheUFyZWFCb3VuZHMsXHJcbiAgICAgIHhBbGlnbjogJ3JpZ2h0JyxcclxuICAgICAgeUFsaWduOiAndG9wJyxcclxuICAgICAgcmlnaHRNYXJnaW46IE1lYW5TaGFyZUFuZEJhbGFuY2VDb25zdGFudHMuQ09OVFJPTFNfSE9SSVpPTlRBTF9NQVJHSU4sXHJcbiAgICAgIHRvcE1hcmdpbjogTWVhblNoYXJlQW5kQmFsYW5jZUNvbnN0YW50cy5DT05UUk9MU19WRVJUSUNBTF9NQVJHSU5cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBjb250cm9sc0FsaWduQm94ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBtZWFuQ2FsY3VsYXRpb25EaWFsb2cgKTtcclxuXHJcbiAgICB0aGlzLm1lYW5DYWxjdWxhdGlvbkRpYWxvZ1Zpc2libGVQcm9wZXJ0eSA9IG1vZGVsLm1lYW5DYWxjdWxhdGlvbkRpYWxvZ1Zpc2libGVQcm9wZXJ0eTtcclxuICB9XHJcbn1cclxuXHJcbm1lYW5TaGFyZUFuZEJhbGFuY2UucmVnaXN0ZXIoICdMZXZlbGluZ091dFNjcmVlblZpZXcnLCBMZXZlbGluZ091dFNj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