// Copyright 2017-2022, University of Colorado Boulder
// eslint-disable-next-line bad-typescript-text
// @ts-nocheck
/**
 * Runs a snapshot for a specific sim (url) with a given seed. It will send a number of events, and will record
 * visual frames the desired number of times (with SHAs) and can send post-messages to communicate the events.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

const options = QueryStringMachine.getAll({
  id: {
    type: 'number',
    defaultValue: 0
  },
  url: {
    type: 'string',
    defaultValue: '../../molecule-shapes/molecule-shapes_en.html'
  },
  simSeed: {
    type: 'number',
    defaultValue: 4 // Ideal constant taken from https://xkcd.com/221/, DO NOT CHANGE, it's random!
  },

  simWidth: {
    type: 'number',
    defaultValue: 1024 / 4
  },
  simHeight: {
    type: 'number',
    defaultValue: 768 / 4
  },
  // Note: always assumed to be something?
  simQueryParameters: {
    type: 'string',
    defaultValue: 'brand=phet&ea'
  }
});
const iframe = document.createElement('iframe');
iframe.setAttribute('frameborder', '0');
iframe.setAttribute('seamless', '1');
iframe.setAttribute('width', options.simWidth);
iframe.setAttribute('height', options.simHeight);
document.body.appendChild(iframe);
const queryParameters = `preserveDrawingBuffer&audio=disabled&preventFullScreen&randomSeed=${options.simSeed}&playbackMode=true&postMessageOnLoad&postMessageOnError&postMessageOnReady`;
iframe.src = `${options.url}?${options.simQueryParameters}&${queryParameters}`;
let isMouseDown = false;
let mouseLastMoved = false;
let mouseX = 0;
let mouseY = 0;
let random = null; // ugly ugly ugly

function sendStep(dt) {
  iframe.contentWindow.phet.joist.sim.stepSimulation(dt);
}
function sendMouseToggleEvent() {
  const input = iframe.contentWindow.phet.joist.display._input;
  const domEvent = iframe.contentWindow.document.createEvent('MouseEvent');

  // technically deprecated, but DOM4 event constructors not out yet. people on #whatwg said to use it
  domEvent.initMouseEvent(isMouseDown ? 'mouseup' : 'mousedown', true, true, iframe.contentWindow, 1,
  // click count
  mouseX, mouseY, mouseX, mouseY, false, false, false, false, 0,
  // button
  null);
  input.validatePointers();
  if (isMouseDown) {
    console.log('mouseUp');
    input.mouseUp(new iframe.contentWindow.phet.dot.Vector2(mouseX, mouseY), domEvent);
    isMouseDown = false;
  } else {
    console.log('mouseDown');
    input.mouseDown(null, new iframe.contentWindow.phet.dot.Vector2(mouseX, mouseY), domEvent);
    isMouseDown = true;
  }
  mouseLastMoved = false;
}
function sendMouseMoveEvent() {
  const input = iframe.contentWindow.phet.joist.display._input;
  mouseX = Math.floor(random.nextDouble() * iframe.contentWindow.phet.joist.display.width);
  mouseY = Math.floor(random.nextDouble() * iframe.contentWindow.phet.joist.display.height);

  // our move event
  const domEvent = iframe.contentWindow.document.createEvent('MouseEvent'); // not 'MouseEvents' according to DOM Level 3 spec

  // technically deprecated, but DOM4 event constructors not out yet. people on #whatwg said to use it
  domEvent.initMouseEvent('mousemove', true, true, iframe.contentWindow, 0,
  // click count
  mouseX, mouseY, mouseX, mouseY, false, false, false, false, 0,
  // button
  null);
  input.validatePointers();
  console.log('mouseMove');
  input.mouseMove(new iframe.contentWindow.phet.dot.Vector2(mouseX, mouseY), domEvent);
  mouseLastMoved = true;
}
function getScreenshot(callback) {
  iframe.contentWindow.phet.joist.display.foreignObjectRasterization(url => {
    callback(url);
  });
}
function hash(str) {
  return new Hashes.MD5().hex(str);
}
let count = 0;
let loaded = false;
let received = true;
function handleFrame() {
  if (loaded && received) {
    count++;
    received = false;
    if (random.nextDouble() < (mouseLastMoved ? 0.7 : 0.4)) {
      sendMouseToggleEvent();
    } else {
      sendMouseMoveEvent();
    }
    sendStep(random.nextDouble() * 0.5 + 0.016);
    getScreenshot(screenshotURL => {
      const hashedScreenshotURL = hash(screenshotURL);
      console.log(count, hashedScreenshotURL);
      const pdomData = {
        html: null,
        hash: null
      };
      const descriptionAlertData = {
        utterances: null,
        hash: null
      };
      const voicingResponseData = {
        utterances: null,
        hash: null
      };
      if (options.compareDescription && iframe.contentWindow.phet.joist.display.isAccessible()) {
        const pdomRoot = iframe.contentWindow.phet.joist.display.pdomRootElement;
        const pdomHTML = pdomRoot.outerHTML;
        pdomData.html = pdomHTML;
        const hashedPDOMHTML = hash(pdomHTML);
        pdomData.hash = hashedPDOMHTML;
        const descriptionUtteranceQueue = iframe.contentWindow.phet.joist.display.descriptionUtteranceQueue.queue;
        const utteranceTexts = descriptionUtteranceQueue.map(utteranceWrapper => utteranceWrapper.utterance.toString());
        descriptionAlertData.utterances = utteranceTexts;
        const utterancesHash = hash(utteranceTexts + '');
        descriptionAlertData.hash = utterancesHash;
        if (iframe.contentWindow.phet.scenery.voicingUtteranceQueue) {
          const voicingUtteranceQueue = iframe.contentWindow.phet.scenery.voicingUtteranceQueue.queue;
          const voicingUtteranceTexts = voicingUtteranceQueue.map(voicingUtteranceWrapper => voicingUtteranceWrapper.utterance.toString());
          voicingResponseData.utterances = voicingUtteranceTexts;
          const voicingUtterancesHash = hash(voicingUtteranceTexts + '');
          voicingResponseData.hash = voicingUtterancesHash;
        }
      }
      window.parent !== window && window.parent.postMessage(JSON.stringify({
        id: options.id,
        type: 'frameEmitted',
        number: count - 1,
        screenshot: {
          url: screenshotURL,
          hash: hashedScreenshotURL
        },
        pdom: pdomData,
        descriptionAlert: descriptionAlertData,
        voicing: voicingResponseData
      }), '*');
      received = true;
    });
  }
}

// Because of course direct calls to this go through this window object instead.
window.addEventListener('error', a => {
  console.log('local error');
  let message = '';
  let stack = '';
  if (a && a.message) {
    message = a.message;
  }
  if (a && a.error && a.error.stack) {
    stack = a.error.stack;
  }
  window.parent !== window && window.parent.postMessage(JSON.stringify({
    id: options.id,
    type: 'error',
    message: message,
    stack: stack
  }), '*');
});

// handling messages from sims
window.addEventListener('message', evt => {
  if (typeof evt.data !== 'string') {
    return;
  }
  const data = JSON.parse(evt.data);

  // Sent by Joist due to the postMessage* query parameters
  if (data.type === 'ready') {
    console.log('ready');

    // Don't allow popups
    iframe.contentWindow.open = function () {
      return {
        focus: _.noop,
        blur: _.noop
      };
    };
    // FileSaver don't allow popup
    iframe.contentWindow.saveAs = _.noop;

    // We need to create an object with the iframe's Object.prototype as its prototype to pass our assertion checks
    const contentOptions = iframe.contentWindow.Object.create(iframe.contentWindow.Object.prototype, {
      seed: {
        value: 2.3,
        enumerable: true
      }
    });
    console.log(contentOptions);
    random = new iframe.contentWindow.phet.dot.Random(contentOptions);
    iframe.contentWindow.phet.joist.launchSimulation();
    iframe.contentWindow.phet.joist.display.interactive = false;
    data.id = options.id;
    window.parent && window.parent !== window && window.parent.postMessage(JSON.stringify(data), '*');
  } else if (data.type === 'load') {
    console.log('loaded');
    sendStep(0.016);
    loaded = true;
    data.id = options.id;
    window.parent && window.parent !== window && window.parent.postMessage(JSON.stringify(data), '*');
  } else if (data.type === 'error') {
    console.log('error');
    data.id = options.id;
    window.parent && window.parent !== window && window.parent.postMessage(JSON.stringify(data), '*');
  } else if (data.type === 'frame') {
    console.log('next frame');
    handleFrame();
  }
});
export {};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJvcHRpb25zIiwiUXVlcnlTdHJpbmdNYWNoaW5lIiwiZ2V0QWxsIiwiaWQiLCJ0eXBlIiwiZGVmYXVsdFZhbHVlIiwidXJsIiwic2ltU2VlZCIsInNpbVdpZHRoIiwic2ltSGVpZ2h0Iiwic2ltUXVlcnlQYXJhbWV0ZXJzIiwiaWZyYW1lIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiYm9keSIsImFwcGVuZENoaWxkIiwicXVlcnlQYXJhbWV0ZXJzIiwic3JjIiwiaXNNb3VzZURvd24iLCJtb3VzZUxhc3RNb3ZlZCIsIm1vdXNlWCIsIm1vdXNlWSIsInJhbmRvbSIsInNlbmRTdGVwIiwiZHQiLCJjb250ZW50V2luZG93IiwicGhldCIsImpvaXN0Iiwic2ltIiwic3RlcFNpbXVsYXRpb24iLCJzZW5kTW91c2VUb2dnbGVFdmVudCIsImlucHV0IiwiZGlzcGxheSIsIl9pbnB1dCIsImRvbUV2ZW50IiwiY3JlYXRlRXZlbnQiLCJpbml0TW91c2VFdmVudCIsInZhbGlkYXRlUG9pbnRlcnMiLCJjb25zb2xlIiwibG9nIiwibW91c2VVcCIsImRvdCIsIlZlY3RvcjIiLCJtb3VzZURvd24iLCJzZW5kTW91c2VNb3ZlRXZlbnQiLCJNYXRoIiwiZmxvb3IiLCJuZXh0RG91YmxlIiwid2lkdGgiLCJoZWlnaHQiLCJtb3VzZU1vdmUiLCJnZXRTY3JlZW5zaG90IiwiY2FsbGJhY2siLCJmb3JlaWduT2JqZWN0UmFzdGVyaXphdGlvbiIsImhhc2giLCJzdHIiLCJIYXNoZXMiLCJNRDUiLCJoZXgiLCJjb3VudCIsImxvYWRlZCIsInJlY2VpdmVkIiwiaGFuZGxlRnJhbWUiLCJzY3JlZW5zaG90VVJMIiwiaGFzaGVkU2NyZWVuc2hvdFVSTCIsInBkb21EYXRhIiwiaHRtbCIsImRlc2NyaXB0aW9uQWxlcnREYXRhIiwidXR0ZXJhbmNlcyIsInZvaWNpbmdSZXNwb25zZURhdGEiLCJjb21wYXJlRGVzY3JpcHRpb24iLCJpc0FjY2Vzc2libGUiLCJwZG9tUm9vdCIsInBkb21Sb290RWxlbWVudCIsInBkb21IVE1MIiwib3V0ZXJIVE1MIiwiaGFzaGVkUERPTUhUTUwiLCJkZXNjcmlwdGlvblV0dGVyYW5jZVF1ZXVlIiwicXVldWUiLCJ1dHRlcmFuY2VUZXh0cyIsIm1hcCIsInV0dGVyYW5jZVdyYXBwZXIiLCJ1dHRlcmFuY2UiLCJ0b1N0cmluZyIsInV0dGVyYW5jZXNIYXNoIiwic2NlbmVyeSIsInZvaWNpbmdVdHRlcmFuY2VRdWV1ZSIsInZvaWNpbmdVdHRlcmFuY2VUZXh0cyIsInZvaWNpbmdVdHRlcmFuY2VXcmFwcGVyIiwidm9pY2luZ1V0dGVyYW5jZXNIYXNoIiwid2luZG93IiwicGFyZW50IiwicG9zdE1lc3NhZ2UiLCJKU09OIiwic3RyaW5naWZ5IiwibnVtYmVyIiwic2NyZWVuc2hvdCIsInBkb20iLCJkZXNjcmlwdGlvbkFsZXJ0Iiwidm9pY2luZyIsImFkZEV2ZW50TGlzdGVuZXIiLCJhIiwibWVzc2FnZSIsInN0YWNrIiwiZXJyb3IiLCJldnQiLCJkYXRhIiwicGFyc2UiLCJvcGVuIiwiZm9jdXMiLCJfIiwibm9vcCIsImJsdXIiLCJzYXZlQXMiLCJjb250ZW50T3B0aW9ucyIsIk9iamVjdCIsImNyZWF0ZSIsInByb3RvdHlwZSIsInNlZWQiLCJ2YWx1ZSIsImVudW1lcmFibGUiLCJSYW5kb20iLCJsYXVuY2hTaW11bGF0aW9uIiwiaW50ZXJhY3RpdmUiXSwic291cmNlcyI6WyJwYXRpZW50LXNuYXBzaG90dGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgYmFkLXR5cGVzY3JpcHQtdGV4dFxyXG4vLyBAdHMtbm9jaGVja1xyXG4vKipcclxuICogUnVucyBhIHNuYXBzaG90IGZvciBhIHNwZWNpZmljIHNpbSAodXJsKSB3aXRoIGEgZ2l2ZW4gc2VlZC4gSXQgd2lsbCBzZW5kIGEgbnVtYmVyIG9mIGV2ZW50cywgYW5kIHdpbGwgcmVjb3JkXHJcbiAqIHZpc3VhbCBmcmFtZXMgdGhlIGRlc2lyZWQgbnVtYmVyIG9mIHRpbWVzICh3aXRoIFNIQXMpIGFuZCBjYW4gc2VuZCBwb3N0LW1lc3NhZ2VzIHRvIGNvbW11bmljYXRlIHRoZSBldmVudHMuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgUmFuZG9tIGZyb20gJy4uLy4uL2RvdC9qcy9SYW5kb20uanMnO1xyXG5cclxuY29uc3Qgb3B0aW9ucyA9IFF1ZXJ5U3RyaW5nTWFjaGluZS5nZXRBbGwoIHtcclxuICBpZDoge1xyXG4gICAgdHlwZTogJ251bWJlcicsXHJcbiAgICBkZWZhdWx0VmFsdWU6IDBcclxuICB9LFxyXG4gIHVybDoge1xyXG4gICAgdHlwZTogJ3N0cmluZycsXHJcbiAgICBkZWZhdWx0VmFsdWU6ICcuLi8uLi9tb2xlY3VsZS1zaGFwZXMvbW9sZWN1bGUtc2hhcGVzX2VuLmh0bWwnXHJcbiAgfSxcclxuICBzaW1TZWVkOiB7XHJcbiAgICB0eXBlOiAnbnVtYmVyJyxcclxuICAgIGRlZmF1bHRWYWx1ZTogNCAvLyBJZGVhbCBjb25zdGFudCB0YWtlbiBmcm9tIGh0dHBzOi8veGtjZC5jb20vMjIxLywgRE8gTk9UIENIQU5HRSwgaXQncyByYW5kb20hXHJcbiAgfSxcclxuICBzaW1XaWR0aDoge1xyXG4gICAgdHlwZTogJ251bWJlcicsXHJcbiAgICBkZWZhdWx0VmFsdWU6IDEwMjQgLyA0XHJcbiAgfSxcclxuICBzaW1IZWlnaHQ6IHtcclxuICAgIHR5cGU6ICdudW1iZXInLFxyXG4gICAgZGVmYXVsdFZhbHVlOiA3NjggLyA0XHJcbiAgfSxcclxuICAvLyBOb3RlOiBhbHdheXMgYXNzdW1lZCB0byBiZSBzb21ldGhpbmc/XHJcbiAgc2ltUXVlcnlQYXJhbWV0ZXJzOiB7XHJcbiAgICB0eXBlOiAnc3RyaW5nJyxcclxuICAgIGRlZmF1bHRWYWx1ZTogJ2JyYW5kPXBoZXQmZWEnXHJcbiAgfVxyXG59ICk7XHJcblxyXG5jb25zdCBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnaWZyYW1lJyApO1xyXG5pZnJhbWUuc2V0QXR0cmlidXRlKCAnZnJhbWVib3JkZXInLCAnMCcgKTtcclxuaWZyYW1lLnNldEF0dHJpYnV0ZSggJ3NlYW1sZXNzJywgJzEnICk7XHJcbmlmcmFtZS5zZXRBdHRyaWJ1dGUoICd3aWR0aCcsIG9wdGlvbnMuc2ltV2lkdGggKTtcclxuaWZyYW1lLnNldEF0dHJpYnV0ZSggJ2hlaWdodCcsIG9wdGlvbnMuc2ltSGVpZ2h0ICk7XHJcbmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoIGlmcmFtZSApO1xyXG5cclxuY29uc3QgcXVlcnlQYXJhbWV0ZXJzID0gYHByZXNlcnZlRHJhd2luZ0J1ZmZlciZhdWRpbz1kaXNhYmxlZCZwcmV2ZW50RnVsbFNjcmVlbiZyYW5kb21TZWVkPSR7b3B0aW9ucy5zaW1TZWVkfSZwbGF5YmFja01vZGU9dHJ1ZSZwb3N0TWVzc2FnZU9uTG9hZCZwb3N0TWVzc2FnZU9uRXJyb3ImcG9zdE1lc3NhZ2VPblJlYWR5YDtcclxuaWZyYW1lLnNyYyA9IGAke29wdGlvbnMudXJsfT8ke29wdGlvbnMuc2ltUXVlcnlQYXJhbWV0ZXJzfSYke3F1ZXJ5UGFyYW1ldGVyc31gO1xyXG5cclxubGV0IGlzTW91c2VEb3duID0gZmFsc2U7XHJcbmxldCBtb3VzZUxhc3RNb3ZlZCA9IGZhbHNlO1xyXG5sZXQgbW91c2VYID0gMDtcclxubGV0IG1vdXNlWSA9IDA7XHJcbmxldCByYW5kb206IFJhbmRvbSA9IG51bGwgYXMgdW5rbm93biBhcyBSYW5kb207IC8vIHVnbHkgdWdseSB1Z2x5XHJcblxyXG5mdW5jdGlvbiBzZW5kU3RlcCggZHQgKTogdm9pZCB7XHJcbiAgaWZyYW1lLmNvbnRlbnRXaW5kb3cucGhldC5qb2lzdC5zaW0uc3RlcFNpbXVsYXRpb24oIGR0ICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNlbmRNb3VzZVRvZ2dsZUV2ZW50KCk6IHZvaWQge1xyXG4gIGNvbnN0IGlucHV0ID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cucGhldC5qb2lzdC5kaXNwbGF5Ll9pbnB1dDtcclxuICBjb25zdCBkb21FdmVudCA9IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50LmNyZWF0ZUV2ZW50KCAnTW91c2VFdmVudCcgKTtcclxuXHJcbiAgLy8gdGVjaG5pY2FsbHkgZGVwcmVjYXRlZCwgYnV0IERPTTQgZXZlbnQgY29uc3RydWN0b3JzIG5vdCBvdXQgeWV0LiBwZW9wbGUgb24gI3doYXR3ZyBzYWlkIHRvIHVzZSBpdFxyXG4gIGRvbUV2ZW50LmluaXRNb3VzZUV2ZW50KCBpc01vdXNlRG93biA/ICdtb3VzZXVwJyA6ICdtb3VzZWRvd24nLCB0cnVlLCB0cnVlLCBpZnJhbWUuY29udGVudFdpbmRvdywgMSwgLy8gY2xpY2sgY291bnRcclxuICAgIG1vdXNlWCwgbW91c2VZLCBtb3VzZVgsIG1vdXNlWSxcclxuICAgIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLFxyXG4gICAgMCwgLy8gYnV0dG9uXHJcbiAgICBudWxsICk7XHJcblxyXG4gIGlucHV0LnZhbGlkYXRlUG9pbnRlcnMoKTtcclxuXHJcbiAgaWYgKCBpc01vdXNlRG93biApIHtcclxuICAgIGNvbnNvbGUubG9nKCAnbW91c2VVcCcgKTtcclxuICAgIGlucHV0Lm1vdXNlVXAoIG5ldyBpZnJhbWUuY29udGVudFdpbmRvdy5waGV0LmRvdC5WZWN0b3IyKCBtb3VzZVgsIG1vdXNlWSApLCBkb21FdmVudCApO1xyXG4gICAgaXNNb3VzZURvd24gPSBmYWxzZTtcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICBjb25zb2xlLmxvZyggJ21vdXNlRG93bicgKTtcclxuICAgIGlucHV0Lm1vdXNlRG93biggbnVsbCwgbmV3IGlmcmFtZS5jb250ZW50V2luZG93LnBoZXQuZG90LlZlY3RvcjIoIG1vdXNlWCwgbW91c2VZICksIGRvbUV2ZW50ICk7XHJcbiAgICBpc01vdXNlRG93biA9IHRydWU7XHJcbiAgfVxyXG5cclxuICBtb3VzZUxhc3RNb3ZlZCA9IGZhbHNlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZW5kTW91c2VNb3ZlRXZlbnQoKTogdm9pZCB7XHJcbiAgY29uc3QgaW5wdXQgPSBpZnJhbWUuY29udGVudFdpbmRvdy5waGV0LmpvaXN0LmRpc3BsYXkuX2lucHV0O1xyXG4gIG1vdXNlWCA9IE1hdGguZmxvb3IoIHJhbmRvbS5uZXh0RG91YmxlKCkgKiBpZnJhbWUuY29udGVudFdpbmRvdy5waGV0LmpvaXN0LmRpc3BsYXkud2lkdGggKTtcclxuICBtb3VzZVkgPSBNYXRoLmZsb29yKCByYW5kb20ubmV4dERvdWJsZSgpICogaWZyYW1lLmNvbnRlbnRXaW5kb3cucGhldC5qb2lzdC5kaXNwbGF5LmhlaWdodCApO1xyXG5cclxuICAvLyBvdXIgbW92ZSBldmVudFxyXG4gIGNvbnN0IGRvbUV2ZW50ID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQuY3JlYXRlRXZlbnQoICdNb3VzZUV2ZW50JyApOyAvLyBub3QgJ01vdXNlRXZlbnRzJyBhY2NvcmRpbmcgdG8gRE9NIExldmVsIDMgc3BlY1xyXG5cclxuICAvLyB0ZWNobmljYWxseSBkZXByZWNhdGVkLCBidXQgRE9NNCBldmVudCBjb25zdHJ1Y3RvcnMgbm90IG91dCB5ZXQuIHBlb3BsZSBvbiAjd2hhdHdnIHNhaWQgdG8gdXNlIGl0XHJcbiAgZG9tRXZlbnQuaW5pdE1vdXNlRXZlbnQoICdtb3VzZW1vdmUnLCB0cnVlLCB0cnVlLCBpZnJhbWUuY29udGVudFdpbmRvdywgMCwgLy8gY2xpY2sgY291bnRcclxuICAgIG1vdXNlWCwgbW91c2VZLCBtb3VzZVgsIG1vdXNlWSxcclxuICAgIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLFxyXG4gICAgMCwgLy8gYnV0dG9uXHJcbiAgICBudWxsICk7XHJcblxyXG4gIGlucHV0LnZhbGlkYXRlUG9pbnRlcnMoKTtcclxuICBjb25zb2xlLmxvZyggJ21vdXNlTW92ZScgKTtcclxuICBpbnB1dC5tb3VzZU1vdmUoIG5ldyBpZnJhbWUuY29udGVudFdpbmRvdy5waGV0LmRvdC5WZWN0b3IyKCBtb3VzZVgsIG1vdXNlWSApLCBkb21FdmVudCApO1xyXG5cclxuICBtb3VzZUxhc3RNb3ZlZCA9IHRydWU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFNjcmVlbnNob3QoIGNhbGxiYWNrICk6IHZvaWQge1xyXG4gIGlmcmFtZS5jb250ZW50V2luZG93LnBoZXQuam9pc3QuZGlzcGxheS5mb3JlaWduT2JqZWN0UmFzdGVyaXphdGlvbiggdXJsID0+IHtcclxuICAgIGNhbGxiYWNrKCB1cmwgKTtcclxuICB9ICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhc2goIHN0ciApOiBzdHJpbmcge1xyXG4gIHJldHVybiBuZXcgSGFzaGVzLk1ENSgpLmhleCggc3RyICk7XHJcbn1cclxuXHJcbmxldCBjb3VudCA9IDA7XHJcbmxldCBsb2FkZWQgPSBmYWxzZTtcclxubGV0IHJlY2VpdmVkID0gdHJ1ZTtcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUZyYW1lKCk6IHZvaWQge1xyXG4gIGlmICggbG9hZGVkICYmIHJlY2VpdmVkICkge1xyXG4gICAgY291bnQrKztcclxuICAgIHJlY2VpdmVkID0gZmFsc2U7XHJcblxyXG4gICAgaWYgKCByYW5kb20ubmV4dERvdWJsZSgpIDwgKCBtb3VzZUxhc3RNb3ZlZCA/IDAuNyA6IDAuNCApICkge1xyXG4gICAgICBzZW5kTW91c2VUb2dnbGVFdmVudCgpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHNlbmRNb3VzZU1vdmVFdmVudCgpO1xyXG4gICAgfVxyXG4gICAgc2VuZFN0ZXAoIHJhbmRvbS5uZXh0RG91YmxlKCkgKiAwLjUgKyAwLjAxNiApO1xyXG5cclxuICAgIGdldFNjcmVlbnNob3QoIHNjcmVlbnNob3RVUkwgPT4ge1xyXG4gICAgICBjb25zdCBoYXNoZWRTY3JlZW5zaG90VVJMID0gaGFzaCggc2NyZWVuc2hvdFVSTCApO1xyXG4gICAgICBjb25zb2xlLmxvZyggY291bnQsIGhhc2hlZFNjcmVlbnNob3RVUkwgKTtcclxuXHJcbiAgICAgIGNvbnN0IHBkb21EYXRhID0ge1xyXG4gICAgICAgIGh0bWw6IG51bGwsXHJcbiAgICAgICAgaGFzaDogbnVsbFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCBkZXNjcmlwdGlvbkFsZXJ0RGF0YSA9IHtcclxuICAgICAgICB1dHRlcmFuY2VzOiBudWxsLFxyXG4gICAgICAgIGhhc2g6IG51bGxcclxuICAgICAgfTtcclxuICAgICAgY29uc3Qgdm9pY2luZ1Jlc3BvbnNlRGF0YSA9IHtcclxuICAgICAgICB1dHRlcmFuY2VzOiBudWxsLFxyXG4gICAgICAgIGhhc2g6IG51bGxcclxuICAgICAgfTtcclxuICAgICAgaWYgKCBvcHRpb25zLmNvbXBhcmVEZXNjcmlwdGlvbiAmJiBpZnJhbWUuY29udGVudFdpbmRvdy5waGV0LmpvaXN0LmRpc3BsYXkuaXNBY2Nlc3NpYmxlKCkgKSB7XHJcblxyXG4gICAgICAgIGNvbnN0IHBkb21Sb290ID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cucGhldC5qb2lzdC5kaXNwbGF5LnBkb21Sb290RWxlbWVudDtcclxuICAgICAgICBjb25zdCBwZG9tSFRNTCA9IHBkb21Sb290Lm91dGVySFRNTDtcclxuICAgICAgICBwZG9tRGF0YS5odG1sID0gcGRvbUhUTUw7XHJcbiAgICAgICAgY29uc3QgaGFzaGVkUERPTUhUTUwgPSBoYXNoKCBwZG9tSFRNTCApO1xyXG4gICAgICAgIHBkb21EYXRhLmhhc2ggPSBoYXNoZWRQRE9NSFRNTDtcclxuXHJcbiAgICAgICAgY29uc3QgZGVzY3JpcHRpb25VdHRlcmFuY2VRdWV1ZSA9IGlmcmFtZS5jb250ZW50V2luZG93LnBoZXQuam9pc3QuZGlzcGxheS5kZXNjcmlwdGlvblV0dGVyYW5jZVF1ZXVlLnF1ZXVlO1xyXG4gICAgICAgIGNvbnN0IHV0dGVyYW5jZVRleHRzID0gZGVzY3JpcHRpb25VdHRlcmFuY2VRdWV1ZS5tYXAoIHV0dGVyYW5jZVdyYXBwZXIgPT4gdXR0ZXJhbmNlV3JhcHBlci51dHRlcmFuY2UudG9TdHJpbmcoKSApO1xyXG4gICAgICAgIGRlc2NyaXB0aW9uQWxlcnREYXRhLnV0dGVyYW5jZXMgPSB1dHRlcmFuY2VUZXh0cztcclxuICAgICAgICBjb25zdCB1dHRlcmFuY2VzSGFzaCA9IGhhc2goIHV0dGVyYW5jZVRleHRzICsgJycgKTtcclxuICAgICAgICBkZXNjcmlwdGlvbkFsZXJ0RGF0YS5oYXNoID0gdXR0ZXJhbmNlc0hhc2g7XHJcblxyXG4gICAgICAgIGlmICggaWZyYW1lLmNvbnRlbnRXaW5kb3cucGhldC5zY2VuZXJ5LnZvaWNpbmdVdHRlcmFuY2VRdWV1ZSApIHtcclxuICAgICAgICAgIGNvbnN0IHZvaWNpbmdVdHRlcmFuY2VRdWV1ZSA9IGlmcmFtZS5jb250ZW50V2luZG93LnBoZXQuc2NlbmVyeS52b2ljaW5nVXR0ZXJhbmNlUXVldWUucXVldWU7XHJcbiAgICAgICAgICBjb25zdCB2b2ljaW5nVXR0ZXJhbmNlVGV4dHMgPSB2b2ljaW5nVXR0ZXJhbmNlUXVldWUubWFwKCB2b2ljaW5nVXR0ZXJhbmNlV3JhcHBlciA9PiB2b2ljaW5nVXR0ZXJhbmNlV3JhcHBlci51dHRlcmFuY2UudG9TdHJpbmcoKSApO1xyXG4gICAgICAgICAgdm9pY2luZ1Jlc3BvbnNlRGF0YS51dHRlcmFuY2VzID0gdm9pY2luZ1V0dGVyYW5jZVRleHRzO1xyXG4gICAgICAgICAgY29uc3Qgdm9pY2luZ1V0dGVyYW5jZXNIYXNoID0gaGFzaCggdm9pY2luZ1V0dGVyYW5jZVRleHRzICsgJycgKTtcclxuICAgICAgICAgIHZvaWNpbmdSZXNwb25zZURhdGEuaGFzaCA9IHZvaWNpbmdVdHRlcmFuY2VzSGFzaDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcblxyXG4gICAgICAoIHdpbmRvdy5wYXJlbnQgIT09IHdpbmRvdyApICYmIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoIEpTT04uc3RyaW5naWZ5KCB7XHJcbiAgICAgICAgaWQ6IG9wdGlvbnMuaWQsXHJcbiAgICAgICAgdHlwZTogJ2ZyYW1lRW1pdHRlZCcsXHJcbiAgICAgICAgbnVtYmVyOiBjb3VudCAtIDEsXHJcbiAgICAgICAgc2NyZWVuc2hvdDoge1xyXG4gICAgICAgICAgdXJsOiBzY3JlZW5zaG90VVJMLFxyXG4gICAgICAgICAgaGFzaDogaGFzaGVkU2NyZWVuc2hvdFVSTFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcGRvbTogcGRvbURhdGEsXHJcbiAgICAgICAgZGVzY3JpcHRpb25BbGVydDogZGVzY3JpcHRpb25BbGVydERhdGEsXHJcbiAgICAgICAgdm9pY2luZzogdm9pY2luZ1Jlc3BvbnNlRGF0YVxyXG4gICAgICB9ICksICcqJyApO1xyXG5cclxuICAgICAgcmVjZWl2ZWQgPSB0cnVlO1xyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxuLy8gQmVjYXVzZSBvZiBjb3Vyc2UgZGlyZWN0IGNhbGxzIHRvIHRoaXMgZ28gdGhyb3VnaCB0aGlzIHdpbmRvdyBvYmplY3QgaW5zdGVhZC5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICdlcnJvcicsIGEgPT4ge1xyXG4gIGNvbnNvbGUubG9nKCAnbG9jYWwgZXJyb3InICk7XHJcbiAgbGV0IG1lc3NhZ2UgPSAnJztcclxuICBsZXQgc3RhY2sgPSAnJztcclxuICBpZiAoIGEgJiYgYS5tZXNzYWdlICkge1xyXG4gICAgbWVzc2FnZSA9IGEubWVzc2FnZTtcclxuICB9XHJcbiAgaWYgKCBhICYmIGEuZXJyb3IgJiYgYS5lcnJvci5zdGFjayApIHtcclxuICAgIHN0YWNrID0gYS5lcnJvci5zdGFjaztcclxuICB9XHJcbiAgKCB3aW5kb3cucGFyZW50ICE9PSB3aW5kb3cgKSAmJiB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKCBKU09OLnN0cmluZ2lmeSgge1xyXG4gICAgaWQ6IG9wdGlvbnMuaWQsXHJcbiAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgbWVzc2FnZTogbWVzc2FnZSxcclxuICAgIHN0YWNrOiBzdGFja1xyXG4gIH0gKSwgJyonICk7XHJcbn0gKTtcclxuXHJcbi8vIGhhbmRsaW5nIG1lc3NhZ2VzIGZyb20gc2ltc1xyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggJ21lc3NhZ2UnLCBldnQgPT4ge1xyXG4gIGlmICggdHlwZW9mIGV2dC5kYXRhICE9PSAnc3RyaW5nJyApIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKCBldnQuZGF0YSApO1xyXG5cclxuICAvLyBTZW50IGJ5IEpvaXN0IGR1ZSB0byB0aGUgcG9zdE1lc3NhZ2UqIHF1ZXJ5IHBhcmFtZXRlcnNcclxuICBpZiAoIGRhdGEudHlwZSA9PT0gJ3JlYWR5JyApIHtcclxuICAgIGNvbnNvbGUubG9nKCAncmVhZHknICk7XHJcblxyXG4gICAgLy8gRG9uJ3QgYWxsb3cgcG9wdXBzXHJcbiAgICBpZnJhbWUuY29udGVudFdpbmRvdy5vcGVuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgZm9jdXM6IF8ubm9vcCxcclxuICAgICAgICBibHVyOiBfLm5vb3BcclxuICAgICAgfTtcclxuICAgIH07XHJcbiAgICAvLyBGaWxlU2F2ZXIgZG9uJ3QgYWxsb3cgcG9wdXBcclxuICAgIGlmcmFtZS5jb250ZW50V2luZG93LnNhdmVBcyA9IF8ubm9vcDtcclxuXHJcbiAgICAvLyBXZSBuZWVkIHRvIGNyZWF0ZSBhbiBvYmplY3Qgd2l0aCB0aGUgaWZyYW1lJ3MgT2JqZWN0LnByb3RvdHlwZSBhcyBpdHMgcHJvdG90eXBlIHRvIHBhc3Mgb3VyIGFzc2VydGlvbiBjaGVja3NcclxuICAgIGNvbnN0IGNvbnRlbnRPcHRpb25zID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuT2JqZWN0LmNyZWF0ZSggaWZyYW1lLmNvbnRlbnRXaW5kb3cuT2JqZWN0LnByb3RvdHlwZSwge1xyXG4gICAgICBzZWVkOiB7XHJcbiAgICAgICAgdmFsdWU6IDIuMyxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIGNvbnNvbGUubG9nKCBjb250ZW50T3B0aW9ucyApO1xyXG4gICAgcmFuZG9tID0gbmV3IGlmcmFtZS5jb250ZW50V2luZG93LnBoZXQuZG90LlJhbmRvbSggY29udGVudE9wdGlvbnMgKTtcclxuXHJcbiAgICBpZnJhbWUuY29udGVudFdpbmRvdy5waGV0LmpvaXN0LmxhdW5jaFNpbXVsYXRpb24oKTtcclxuICAgIGlmcmFtZS5jb250ZW50V2luZG93LnBoZXQuam9pc3QuZGlzcGxheS5pbnRlcmFjdGl2ZSA9IGZhbHNlO1xyXG5cclxuICAgIGRhdGEuaWQgPSBvcHRpb25zLmlkO1xyXG4gICAgd2luZG93LnBhcmVudCAmJiB3aW5kb3cucGFyZW50ICE9PSB3aW5kb3cgJiYgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSggSlNPTi5zdHJpbmdpZnkoIGRhdGEgKSwgJyonICk7XHJcbiAgfVxyXG4gIGVsc2UgaWYgKCBkYXRhLnR5cGUgPT09ICdsb2FkJyApIHtcclxuICAgIGNvbnNvbGUubG9nKCAnbG9hZGVkJyApO1xyXG4gICAgc2VuZFN0ZXAoIDAuMDE2ICk7XHJcbiAgICBsb2FkZWQgPSB0cnVlO1xyXG4gICAgZGF0YS5pZCA9IG9wdGlvbnMuaWQ7XHJcbiAgICB3aW5kb3cucGFyZW50ICYmIHdpbmRvdy5wYXJlbnQgIT09IHdpbmRvdyAmJiB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKCBKU09OLnN0cmluZ2lmeSggZGF0YSApLCAnKicgKTtcclxuICB9XHJcbiAgZWxzZSBpZiAoIGRhdGEudHlwZSA9PT0gJ2Vycm9yJyApIHtcclxuICAgIGNvbnNvbGUubG9nKCAnZXJyb3InICk7XHJcbiAgICBkYXRhLmlkID0gb3B0aW9ucy5pZDtcclxuICAgIHdpbmRvdy5wYXJlbnQgJiYgd2luZG93LnBhcmVudCAhPT0gd2luZG93ICYmIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoIEpTT04uc3RyaW5naWZ5KCBkYXRhICksICcqJyApO1xyXG4gIH1cclxuICBlbHNlIGlmICggZGF0YS50eXBlID09PSAnZnJhbWUnICkge1xyXG4gICAgY29uc29sZS5sb2coICduZXh0IGZyYW1lJyApO1xyXG4gICAgaGFuZGxlRnJhbWUoKTtcclxuICB9XHJcbn0gKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBSUEsTUFBTUEsT0FBTyxHQUFHQyxrQkFBa0IsQ0FBQ0MsTUFBTSxDQUFFO0VBQ3pDQyxFQUFFLEVBQUU7SUFDRkMsSUFBSSxFQUFFLFFBQVE7SUFDZEMsWUFBWSxFQUFFO0VBQ2hCLENBQUM7RUFDREMsR0FBRyxFQUFFO0lBQ0hGLElBQUksRUFBRSxRQUFRO0lBQ2RDLFlBQVksRUFBRTtFQUNoQixDQUFDO0VBQ0RFLE9BQU8sRUFBRTtJQUNQSCxJQUFJLEVBQUUsUUFBUTtJQUNkQyxZQUFZLEVBQUUsQ0FBQyxDQUFDO0VBQ2xCLENBQUM7O0VBQ0RHLFFBQVEsRUFBRTtJQUNSSixJQUFJLEVBQUUsUUFBUTtJQUNkQyxZQUFZLEVBQUUsSUFBSSxHQUFHO0VBQ3ZCLENBQUM7RUFDREksU0FBUyxFQUFFO0lBQ1RMLElBQUksRUFBRSxRQUFRO0lBQ2RDLFlBQVksRUFBRSxHQUFHLEdBQUc7RUFDdEIsQ0FBQztFQUNEO0VBQ0FLLGtCQUFrQixFQUFFO0lBQ2xCTixJQUFJLEVBQUUsUUFBUTtJQUNkQyxZQUFZLEVBQUU7RUFDaEI7QUFDRixDQUFFLENBQUM7QUFFSCxNQUFNTSxNQUFNLEdBQUdDLFFBQVEsQ0FBQ0MsYUFBYSxDQUFFLFFBQVMsQ0FBQztBQUNqREYsTUFBTSxDQUFDRyxZQUFZLENBQUUsYUFBYSxFQUFFLEdBQUksQ0FBQztBQUN6Q0gsTUFBTSxDQUFDRyxZQUFZLENBQUUsVUFBVSxFQUFFLEdBQUksQ0FBQztBQUN0Q0gsTUFBTSxDQUFDRyxZQUFZLENB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