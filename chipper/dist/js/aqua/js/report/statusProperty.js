// Copyright 2022, University of Colorado Boulder

/**
 * Properties based on status (auto-updating from /aquaserver/status)
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import NumberProperty from '../../../axon/js/NumberProperty.js';
import Property from '../../../axon/js/Property.js';
import request from './request.js';
import sleep from './sleep.js';

// {Property.<string>}
const statusProperty = new Property('loading...');
const lastErrorProperty = new Property('');

// {Property.<number>}
const startupTimestampProperty = new NumberProperty(0);

// Snapshot status loop
(async () => {
  while (true) {
    // eslint-disable-line no-constant-condition
    const result = await request('/aquaserver/status');
    if (result) {
      statusProperty.value = result.status;
      lastErrorProperty.value = result.lastErrorString;
      startupTimestampProperty.value = result.startupTimestamp;
    }
    await sleep(1000);
  }
})();
export default statusProperty;
export { lastErrorProperty, startupTimestampProperty };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOdW1iZXJQcm9wZXJ0eSIsIlByb3BlcnR5IiwicmVxdWVzdCIsInNsZWVwIiwic3RhdHVzUHJvcGVydHkiLCJsYXN0RXJyb3JQcm9wZXJ0eSIsInN0YXJ0dXBUaW1lc3RhbXBQcm9wZXJ0eSIsInJlc3VsdCIsInZhbHVlIiwic3RhdHVzIiwibGFzdEVycm9yU3RyaW5nIiwic3RhcnR1cFRpbWVzdGFtcCJdLCJzb3VyY2VzIjpbInN0YXR1c1Byb3BlcnR5LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBQcm9wZXJ0aWVzIGJhc2VkIG9uIHN0YXR1cyAoYXV0by11cGRhdGluZyBmcm9tIC9hcXVhc2VydmVyL3N0YXR1cylcclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgcmVxdWVzdCBmcm9tICcuL3JlcXVlc3QuanMnO1xyXG5pbXBvcnQgc2xlZXAgZnJvbSAnLi9zbGVlcC5qcyc7XHJcblxyXG4vLyB7UHJvcGVydHkuPHN0cmluZz59XHJcbmNvbnN0IHN0YXR1c1Byb3BlcnR5ID0gbmV3IFByb3BlcnR5KCAnbG9hZGluZy4uLicgKTtcclxuY29uc3QgbGFzdEVycm9yUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoICcnICk7XHJcblxyXG4vLyB7UHJvcGVydHkuPG51bWJlcj59XHJcbmNvbnN0IHN0YXJ0dXBUaW1lc3RhbXBQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggMCApO1xyXG5cclxuLy8gU25hcHNob3Qgc3RhdHVzIGxvb3BcclxuKCBhc3luYyAoKSA9PiB7XHJcbiAgd2hpbGUgKCB0cnVlICkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnN0YW50LWNvbmRpdGlvblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVxdWVzdCggJy9hcXVhc2VydmVyL3N0YXR1cycgKTtcclxuICAgIGlmICggcmVzdWx0ICkge1xyXG4gICAgICBzdGF0dXNQcm9wZXJ0eS52YWx1ZSA9IHJlc3VsdC5zdGF0dXM7XHJcbiAgICAgIGxhc3RFcnJvclByb3BlcnR5LnZhbHVlID0gcmVzdWx0Lmxhc3RFcnJvclN0cmluZztcclxuICAgICAgc3RhcnR1cFRpbWVzdGFtcFByb3BlcnR5LnZhbHVlID0gcmVzdWx0LnN0YXJ0dXBUaW1lc3RhbXA7XHJcbiAgICB9XHJcbiAgICBhd2FpdCBzbGVlcCggMTAwMCApO1xyXG4gIH1cclxufSApKCk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBzdGF0dXNQcm9wZXJ0eTtcclxuZXhwb3J0IHsgbGFzdEVycm9yUHJvcGVydHksIHN0YXJ0dXBUaW1lc3RhbXBQcm9wZXJ0eSB9O1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsY0FBYyxNQUFNLG9DQUFvQztBQUMvRCxPQUFPQyxRQUFRLE1BQU0sOEJBQThCO0FBQ25ELE9BQU9DLE9BQU8sTUFBTSxjQUFjO0FBQ2xDLE9BQU9DLEtBQUssTUFBTSxZQUFZOztBQUU5QjtBQUNBLE1BQU1DLGNBQWMsR0FBRyxJQUFJSCxRQUFRLENBQUUsWUFBYSxDQUFDO0FBQ25ELE1BQU1JLGlCQUFpQixHQUFHLElBQUlKLFFBQVEsQ0FBRSxFQUFHLENBQUM7O0FBRTVDO0FBQ0EsTUFBTUssd0JBQXdCLEdBQUcsSUFBSU4sY0FBYyxDQUFFLENBQUUsQ0FBQzs7QUFFeEQ7QUFDQSxDQUFFLFlBQVk7RUFDWixPQUFRLElBQUksRUFBRztJQUFFO0lBQ2YsTUFBTU8sTUFBTSxHQUFHLE1BQU1MLE9BQU8sQ0FBRSxvQkFBcUIsQ0FBQztJQUNwRCxJQUFLSyxNQUFNLEVBQUc7TUFDWkgsY0FBYyxDQUFDSSxLQUFLLEdBQUdELE1BQU0sQ0FBQ0UsTUFBTTtNQUNwQ0osaUJBQWlCLENBQUNHLEtBQUssR0FBR0QsTUFBTSxDQUFDRyxlQUFlO01BQ2hESix3QkFBd0IsQ0FBQ0UsS0FBSyxHQUFHRCxNQUFNLENBQUNJLGdCQUFnQjtJQUMxRDtJQUNBLE1BQU1SLEtBQUssQ0FBRSxJQUFLLENBQUM7RUFDckI7QUFDRixDQUFDLEVBQUcsQ0FBQztBQUVMLGVBQWVDLGNBQWM7QUFDN0IsU0FBU0MsaUJBQWlCLEVBQUVDLHdCQUF3QiJ9