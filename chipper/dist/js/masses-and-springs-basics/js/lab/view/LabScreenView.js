// Copyright 2018-2022, University of Colorado Boulder

/**
 * View for Lab screen.
 *
 * @author Denzell Barnett (PhET Interactive Simulations)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import MassesAndSpringsConstants from '../../../../masses-and-springs/js/common/MassesAndSpringsConstants.js';
import MassesAndSpringsColors from '../../../../masses-and-springs/js/common/view/MassesAndSpringsColors.js';
import MassValueControlPanel from '../../../../masses-and-springs/js/common/view/MassValueControlPanel.js';
import OneSpringScreenView from '../../../../masses-and-springs/js/common/view/OneSpringScreenView.js';
import ReferenceLineNode from '../../../../masses-and-springs/js/common/view/ReferenceLineNode.js';
import ShelfNode from '../../../../masses-and-springs/js/common/view/ShelfNode.js';
import PeriodTraceNode from '../../../../masses-and-springs/js/lab/view/PeriodTraceNode.js';
import VectorVisibilityControlNode from '../../../../masses-and-springs/js/vectors/view/VectorVisibilityControlNode.js';
import { Text, VBox } from '../../../../scenery/js/imports.js';
import LineOptionsNode from '../../common/view/LineOptionsNode.js';
import massesAndSpringsBasics from '../../massesAndSpringsBasics.js';
import MassesAndSpringsBasicsStrings from '../../MassesAndSpringsBasicsStrings.js';
import GravityAccordionBox from './GravityAccordionBox.js';
const centerOfOscillationString = MassesAndSpringsBasicsStrings.centerOfOscillation;
class LabScreenView extends OneSpringScreenView {
  /**
   * @param {LabModel} model
   * @param {Tandem} tandem
   *
   */
  constructor(model, tandem) {
    // Calls common spring view
    super(model, tandem);
    const vectorVisibilityControlNode = new VectorVisibilityControlNode(model, tandem.createTandem('vectorVisibilityControlNode'), {
      maxWidth: MassesAndSpringsConstants.PANEL_MAX_WIDTH + 30,
      showForces: false
    });

    // VBox that contains all of the panel's content
    const optionsVBox = new VBox({
      spacing: 10,
      children: [new LineOptionsNode(model, tandem), MassesAndSpringsConstants.LINE_SEPARATOR(165), vectorVisibilityControlNode]
    });

    // Panel that will display all the toggleable options.
    const optionsPanel = this.createOptionsPanel(optionsVBox, this.rightPanelAlignGroup, tandem);
    const gravityAccordionBox = new GravityAccordionBox(model.gravityProperty, model.bodyProperty, this, this.rightPanelAlignGroup, tandem.createTandem('gravityAccordionBox'), {
      expandedProperty: model.gravityAccordionBoxExpandedProperty
    });

    // Contains all of the options for the reference lines, gravity, damping, and toolbox
    const rightPanelsVBox = new VBox({
      children: [optionsPanel, gravityAccordionBox, this.toolboxPanel],
      spacing: this.spacing * 0.9
    });

    // Shelf used for masses
    const shelf = new ShelfNode(tandem, {
      rectHeight: 7,
      rectWidth: 200,
      left: this.visibleBoundsProperty.value.left + this.spacing,
      rectY: this.modelViewTransform.modelToViewY(MassesAndSpringsConstants.FLOOR_Y) - this.shelf.rectHeight
    });

    // Initializes equilibrium line for an attached mass
    const equilibriumLineNode = new ReferenceLineNode(this.modelViewTransform, model.firstSpring, model.firstSpring.equilibriumYPositionProperty, this.equilibriumVisibilityProperty, {
      stroke: MassesAndSpringsColors.restingPositionProperty
    });
    this.addChild(equilibriumLineNode);
    const oscillationVisibilityProperty = new DerivedProperty([model.firstSpring.periodTraceVisibilityProperty, model.accelerationVectorVisibilityProperty, model.velocityVectorVisibilityProperty, model.firstSpring.massAttachedProperty], (periodTraceVisible, accelerationVectorVisible, velocityVectorVisible, massAttached) => {
      if (massAttached) {
        return periodTraceVisible || accelerationVectorVisible || velocityVectorVisible;
      } else {
        return false;
      }
    });

    // Initializes center of oscillation line for an attached mass
    const centerOfOscillationLineNode = new ReferenceLineNode(this.modelViewTransform, model.firstSpring, model.firstSpring.massEquilibriumYPositionProperty, oscillationVisibilityProperty, {
      stroke: 'black',
      label: new Text(centerOfOscillationString, {
        font: MassesAndSpringsConstants.TITLE_FONT,
        fill: 'black',
        maxWidth: 125
      })
    });
    this.addChild(centerOfOscillationLineNode);

    // Accessed in Basics version to adjust to a larger width.
    const massValueControlPanel = new MassValueControlPanel(model.masses[0], this.massNodeIcon, tandem.createTandem('massValueControlPanel'), {
      maxWidth: MassesAndSpringsConstants.PANEL_MAX_WIDTH + MassesAndSpringsConstants.PANEL_MAX_WIDTH * 0.05,
      basicsVersion: model.basicsVersion
    });
    this.springSystemControlsNode.setChildren([massValueControlPanel, this.springHangerNode, this.springStopperButtonNode]);
    this.springSystemControlsNode.spacing = this.spacing * 1.2;

    // @private {PeriodTraceNode}
    this.periodTraceNode = new PeriodTraceNode(model.firstSpring.periodTrace, this.modelViewTransform, model.basicsVersion, {
      center: this.massEquilibriumLineNode.center
    });

    // Move layers with interactive elements and layers to the front
    this.movableLineNode.moveToFront();
    this.massLayer.moveToFront();
    this.toolsLayer.moveToFront();
    this.resetAllButton.addListener(() => {
      this.movableLineNode.reset();
    });

    // Back layer used to handle z order of view elements.
    this.backLayer.children = [this.backgroundDragPlane, rightPanelsVBox, shelf, this.periodTraceNode];
    this.visibleBoundsProperty.link(() => {
      rightPanelsVBox.rightTop = new Vector2(this.panelRightSpacing, this.spacing);
      this.springSystemControlsNode.centerX = this.springCenter * 0.835; // centering springHangerNode over spring
      this.springConstantControlPanel.left = this.springSystemControlsNode.right + this.spacing;
    });
  }

  /**
   * @public
   *
   * @param {number} dt
   */
  step(dt) {
    this.periodTraceNode.step(dt, this.model.playingProperty);
  }
}
massesAndSpringsBasics.register('LabScreenView', LabScreenView);
export default LabScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJWZWN0b3IyIiwiTWFzc2VzQW5kU3ByaW5nc0NvbnN0YW50cyIsIk1hc3Nlc0FuZFNwcmluZ3NDb2xvcnMiLCJNYXNzVmFsdWVDb250cm9sUGFuZWwiLCJPbmVTcHJpbmdTY3JlZW5WaWV3IiwiUmVmZXJlbmNlTGluZU5vZGUiLCJTaGVsZk5vZGUiLCJQZXJpb2RUcmFjZU5vZGUiLCJWZWN0b3JWaXNpYmlsaXR5Q29udHJvbE5vZGUiLCJUZXh0IiwiVkJveCIsIkxpbmVPcHRpb25zTm9kZSIsIm1hc3Nlc0FuZFNwcmluZ3NCYXNpY3MiLCJNYXNzZXNBbmRTcHJpbmdzQmFzaWNzU3RyaW5ncyIsIkdyYXZpdHlBY2NvcmRpb25Cb3giLCJjZW50ZXJPZk9zY2lsbGF0aW9uU3RyaW5nIiwiY2VudGVyT2ZPc2NpbGxhdGlvbiIsIkxhYlNjcmVlblZpZXciLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwidGFuZGVtIiwidmVjdG9yVmlzaWJpbGl0eUNvbnRyb2xOb2RlIiwiY3JlYXRlVGFuZGVtIiwibWF4V2lkdGgiLCJQQU5FTF9NQVhfV0lEVEgiLCJzaG93Rm9yY2VzIiwib3B0aW9uc1ZCb3giLCJzcGFjaW5nIiwiY2hpbGRyZW4iLCJMSU5FX1NFUEFSQVRPUiIsIm9wdGlvbnNQYW5lbCIsImNyZWF0ZU9wdGlvbnNQYW5lbCIsInJpZ2h0UGFuZWxBbGlnbkdyb3VwIiwiZ3Jhdml0eUFjY29yZGlvbkJveCIsImdyYXZpdHlQcm9wZXJ0eSIsImJvZHlQcm9wZXJ0eSIsImV4cGFuZGVkUHJvcGVydHkiLCJncmF2aXR5QWNjb3JkaW9uQm94RXhwYW5kZWRQcm9wZXJ0eSIsInJpZ2h0UGFuZWxzVkJveCIsInRvb2xib3hQYW5lbCIsInNoZWxmIiwicmVjdEhlaWdodCIsInJlY3RXaWR0aCIsImxlZnQiLCJ2aXNpYmxlQm91bmRzUHJvcGVydHkiLCJ2YWx1ZSIsInJlY3RZIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwibW9kZWxUb1ZpZXdZIiwiRkxPT1JfWSIsImVxdWlsaWJyaXVtTGluZU5vZGUiLCJmaXJzdFNwcmluZyIsImVxdWlsaWJyaXVtWVBvc2l0aW9uUHJvcGVydHkiLCJlcXVpbGlicml1bVZpc2liaWxpdHlQcm9wZXJ0eSIsInN0cm9rZSIsInJlc3RpbmdQb3NpdGlvblByb3BlcnR5IiwiYWRkQ2hpbGQiLCJvc2NpbGxhdGlvblZpc2liaWxpdHlQcm9wZXJ0eSIsInBlcmlvZFRyYWNlVmlzaWJpbGl0eVByb3BlcnR5IiwiYWNjZWxlcmF0aW9uVmVjdG9yVmlzaWJpbGl0eVByb3BlcnR5IiwidmVsb2NpdHlWZWN0b3JWaXNpYmlsaXR5UHJvcGVydHkiLCJtYXNzQXR0YWNoZWRQcm9wZXJ0eSIsInBlcmlvZFRyYWNlVmlzaWJsZSIsImFjY2VsZXJhdGlvblZlY3RvclZpc2libGUiLCJ2ZWxvY2l0eVZlY3RvclZpc2libGUiLCJtYXNzQXR0YWNoZWQiLCJjZW50ZXJPZk9zY2lsbGF0aW9uTGluZU5vZGUiLCJtYXNzRXF1aWxpYnJpdW1ZUG9zaXRpb25Qcm9wZXJ0eSIsImxhYmVsIiwiZm9udCIsIlRJVExFX0ZPTlQiLCJmaWxsIiwibWFzc1ZhbHVlQ29udHJvbFBhbmVsIiwibWFzc2VzIiwibWFzc05vZGVJY29uIiwiYmFzaWNzVmVyc2lvbiIsInNwcmluZ1N5c3RlbUNvbnRyb2xzTm9kZSIsInNldENoaWxkcmVuIiwic3ByaW5nSGFuZ2VyTm9kZSIsInNwcmluZ1N0b3BwZXJCdXR0b25Ob2RlIiwicGVyaW9kVHJhY2VOb2RlIiwicGVyaW9kVHJhY2UiLCJjZW50ZXIiLCJtYXNzRXF1aWxpYnJpdW1MaW5lTm9kZSIsIm1vdmFibGVMaW5lTm9kZSIsIm1vdmVUb0Zyb250IiwibWFzc0xheWVyIiwidG9vbHNMYXllciIsInJlc2V0QWxsQnV0dG9uIiwiYWRkTGlzdGVuZXIiLCJyZXNldCIsImJhY2tMYXllciIsImJhY2tncm91bmREcmFnUGxhbmUiLCJsaW5rIiwicmlnaHRUb3AiLCJwYW5lbFJpZ2h0U3BhY2luZyIsImNlbnRlclgiLCJzcHJpbmdDZW50ZXIiLCJzcHJpbmdDb25zdGFudENvbnRyb2xQYW5lbCIsInJpZ2h0Iiwic3RlcCIsImR0IiwicGxheWluZ1Byb3BlcnR5IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJMYWJTY3JlZW5WaWV3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE4LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFZpZXcgZm9yIExhYiBzY3JlZW4uXHJcbiAqXHJcbiAqIEBhdXRob3IgRGVuemVsbCBCYXJuZXR0IChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBNYXNzZXNBbmRTcHJpbmdzQ29uc3RhbnRzIGZyb20gJy4uLy4uLy4uLy4uL21hc3Nlcy1hbmQtc3ByaW5ncy9qcy9jb21tb24vTWFzc2VzQW5kU3ByaW5nc0NvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBNYXNzZXNBbmRTcHJpbmdzQ29sb3JzIGZyb20gJy4uLy4uLy4uLy4uL21hc3Nlcy1hbmQtc3ByaW5ncy9qcy9jb21tb24vdmlldy9NYXNzZXNBbmRTcHJpbmdzQ29sb3JzLmpzJztcclxuaW1wb3J0IE1hc3NWYWx1ZUNvbnRyb2xQYW5lbCBmcm9tICcuLi8uLi8uLi8uLi9tYXNzZXMtYW5kLXNwcmluZ3MvanMvY29tbW9uL3ZpZXcvTWFzc1ZhbHVlQ29udHJvbFBhbmVsLmpzJztcclxuaW1wb3J0IE9uZVNwcmluZ1NjcmVlblZpZXcgZnJvbSAnLi4vLi4vLi4vLi4vbWFzc2VzLWFuZC1zcHJpbmdzL2pzL2NvbW1vbi92aWV3L09uZVNwcmluZ1NjcmVlblZpZXcuanMnO1xyXG5pbXBvcnQgUmVmZXJlbmNlTGluZU5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vbWFzc2VzLWFuZC1zcHJpbmdzL2pzL2NvbW1vbi92aWV3L1JlZmVyZW5jZUxpbmVOb2RlLmpzJztcclxuaW1wb3J0IFNoZWxmTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9tYXNzZXMtYW5kLXNwcmluZ3MvanMvY29tbW9uL3ZpZXcvU2hlbGZOb2RlLmpzJztcclxuaW1wb3J0IFBlcmlvZFRyYWNlTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9tYXNzZXMtYW5kLXNwcmluZ3MvanMvbGFiL3ZpZXcvUGVyaW9kVHJhY2VOb2RlLmpzJztcclxuaW1wb3J0IFZlY3RvclZpc2liaWxpdHlDb250cm9sTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9tYXNzZXMtYW5kLXNwcmluZ3MvanMvdmVjdG9ycy92aWV3L1ZlY3RvclZpc2liaWxpdHlDb250cm9sTm9kZS5qcyc7XHJcbmltcG9ydCB7IFRleHQsIFZCb3ggfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgTGluZU9wdGlvbnNOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0xpbmVPcHRpb25zTm9kZS5qcyc7XHJcbmltcG9ydCBtYXNzZXNBbmRTcHJpbmdzQmFzaWNzIGZyb20gJy4uLy4uL21hc3Nlc0FuZFNwcmluZ3NCYXNpY3MuanMnO1xyXG5pbXBvcnQgTWFzc2VzQW5kU3ByaW5nc0Jhc2ljc1N0cmluZ3MgZnJvbSAnLi4vLi4vTWFzc2VzQW5kU3ByaW5nc0Jhc2ljc1N0cmluZ3MuanMnO1xyXG5pbXBvcnQgR3Jhdml0eUFjY29yZGlvbkJveCBmcm9tICcuL0dyYXZpdHlBY2NvcmRpb25Cb3guanMnO1xyXG5cclxuY29uc3QgY2VudGVyT2ZPc2NpbGxhdGlvblN0cmluZyA9IE1hc3Nlc0FuZFNwcmluZ3NCYXNpY3NTdHJpbmdzLmNlbnRlck9mT3NjaWxsYXRpb247XHJcblxyXG5jbGFzcyBMYWJTY3JlZW5WaWV3IGV4dGVuZHMgT25lU3ByaW5nU2NyZWVuVmlldyB7XHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtMYWJNb2RlbH0gbW9kZWxcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICpcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbW9kZWwsIHRhbmRlbSApIHtcclxuXHJcbiAgICAvLyBDYWxscyBjb21tb24gc3ByaW5nIHZpZXdcclxuICAgIHN1cGVyKCBtb2RlbCwgdGFuZGVtICk7XHJcbiAgICBjb25zdCB2ZWN0b3JWaXNpYmlsaXR5Q29udHJvbE5vZGUgPSBuZXcgVmVjdG9yVmlzaWJpbGl0eUNvbnRyb2xOb2RlKFxyXG4gICAgICBtb2RlbCxcclxuICAgICAgdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3ZlY3RvclZpc2liaWxpdHlDb250cm9sTm9kZScgKSxcclxuICAgICAge1xyXG4gICAgICAgIG1heFdpZHRoOiBNYXNzZXNBbmRTcHJpbmdzQ29uc3RhbnRzLlBBTkVMX01BWF9XSURUSCArIDMwLFxyXG4gICAgICAgIHNob3dGb3JjZXM6IGZhbHNlXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBWQm94IHRoYXQgY29udGFpbnMgYWxsIG9mIHRoZSBwYW5lbCdzIGNvbnRlbnRcclxuICAgIGNvbnN0IG9wdGlvbnNWQm94ID0gbmV3IFZCb3goIHtcclxuICAgICAgc3BhY2luZzogMTAsXHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgbmV3IExpbmVPcHRpb25zTm9kZSggbW9kZWwsIHRhbmRlbSApLFxyXG4gICAgICAgIE1hc3Nlc0FuZFNwcmluZ3NDb25zdGFudHMuTElORV9TRVBBUkFUT1IoIDE2NSApLFxyXG4gICAgICAgIHZlY3RvclZpc2liaWxpdHlDb250cm9sTm9kZVxyXG4gICAgICBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gUGFuZWwgdGhhdCB3aWxsIGRpc3BsYXkgYWxsIHRoZSB0b2dnbGVhYmxlIG9wdGlvbnMuXHJcbiAgICBjb25zdCBvcHRpb25zUGFuZWwgPSB0aGlzLmNyZWF0ZU9wdGlvbnNQYW5lbCggb3B0aW9uc1ZCb3gsIHRoaXMucmlnaHRQYW5lbEFsaWduR3JvdXAsIHRhbmRlbSApO1xyXG5cclxuICAgIGNvbnN0IGdyYXZpdHlBY2NvcmRpb25Cb3ggPSBuZXcgR3Jhdml0eUFjY29yZGlvbkJveChcclxuICAgICAgbW9kZWwuZ3Jhdml0eVByb3BlcnR5LFxyXG4gICAgICBtb2RlbC5ib2R5UHJvcGVydHksXHJcbiAgICAgIHRoaXMsXHJcbiAgICAgIHRoaXMucmlnaHRQYW5lbEFsaWduR3JvdXAsXHJcbiAgICAgIHRhbmRlbS5jcmVhdGVUYW5kZW0oICdncmF2aXR5QWNjb3JkaW9uQm94JyApLCB7XHJcbiAgICAgICAgZXhwYW5kZWRQcm9wZXJ0eTogbW9kZWwuZ3Jhdml0eUFjY29yZGlvbkJveEV4cGFuZGVkUHJvcGVydHlcclxuICAgICAgfSApO1xyXG5cclxuICAgIC8vIENvbnRhaW5zIGFsbCBvZiB0aGUgb3B0aW9ucyBmb3IgdGhlIHJlZmVyZW5jZSBsaW5lcywgZ3Jhdml0eSwgZGFtcGluZywgYW5kIHRvb2xib3hcclxuICAgIGNvbnN0IHJpZ2h0UGFuZWxzVkJveCA9IG5ldyBWQm94KCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbIG9wdGlvbnNQYW5lbCwgZ3Jhdml0eUFjY29yZGlvbkJveCwgdGhpcy50b29sYm94UGFuZWwgXSxcclxuICAgICAgc3BhY2luZzogdGhpcy5zcGFjaW5nICogMC45XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gU2hlbGYgdXNlZCBmb3IgbWFzc2VzXHJcbiAgICBjb25zdCBzaGVsZiA9IG5ldyBTaGVsZk5vZGUoIHRhbmRlbSwge1xyXG4gICAgICByZWN0SGVpZ2h0OiA3LFxyXG4gICAgICByZWN0V2lkdGg6IDIwMCxcclxuICAgICAgbGVmdDogdGhpcy52aXNpYmxlQm91bmRzUHJvcGVydHkudmFsdWUubGVmdCArIHRoaXMuc3BhY2luZyxcclxuICAgICAgcmVjdFk6IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggTWFzc2VzQW5kU3ByaW5nc0NvbnN0YW50cy5GTE9PUl9ZICkgLSB0aGlzLnNoZWxmLnJlY3RIZWlnaHRcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBJbml0aWFsaXplcyBlcXVpbGlicml1bSBsaW5lIGZvciBhbiBhdHRhY2hlZCBtYXNzXHJcbiAgICBjb25zdCBlcXVpbGlicml1bUxpbmVOb2RlID0gbmV3IFJlZmVyZW5jZUxpbmVOb2RlKFxyXG4gICAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgbW9kZWwuZmlyc3RTcHJpbmcsXHJcbiAgICAgIG1vZGVsLmZpcnN0U3ByaW5nLmVxdWlsaWJyaXVtWVBvc2l0aW9uUHJvcGVydHksXHJcbiAgICAgIHRoaXMuZXF1aWxpYnJpdW1WaXNpYmlsaXR5UHJvcGVydHksIHtcclxuICAgICAgICBzdHJva2U6IE1hc3Nlc0FuZFNwcmluZ3NDb2xvcnMucmVzdGluZ1Bvc2l0aW9uUHJvcGVydHlcclxuICAgICAgfVxyXG4gICAgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGVxdWlsaWJyaXVtTGluZU5vZGUgKTtcclxuXHJcbiAgICBjb25zdCBvc2NpbGxhdGlvblZpc2liaWxpdHlQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFtcclxuICAgICAgICBtb2RlbC5maXJzdFNwcmluZy5wZXJpb2RUcmFjZVZpc2liaWxpdHlQcm9wZXJ0eSxcclxuICAgICAgICBtb2RlbC5hY2NlbGVyYXRpb25WZWN0b3JWaXNpYmlsaXR5UHJvcGVydHksXHJcbiAgICAgICAgbW9kZWwudmVsb2NpdHlWZWN0b3JWaXNpYmlsaXR5UHJvcGVydHksXHJcbiAgICAgICAgbW9kZWwuZmlyc3RTcHJpbmcubWFzc0F0dGFjaGVkUHJvcGVydHlcclxuICAgICAgXSxcclxuICAgICAgKCBwZXJpb2RUcmFjZVZpc2libGUsIGFjY2VsZXJhdGlvblZlY3RvclZpc2libGUsIHZlbG9jaXR5VmVjdG9yVmlzaWJsZSwgbWFzc0F0dGFjaGVkICkgPT4ge1xyXG4gICAgICAgIGlmICggbWFzc0F0dGFjaGVkICkge1xyXG4gICAgICAgICAgcmV0dXJuIHBlcmlvZFRyYWNlVmlzaWJsZSB8fCBhY2NlbGVyYXRpb25WZWN0b3JWaXNpYmxlIHx8IHZlbG9jaXR5VmVjdG9yVmlzaWJsZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZXMgY2VudGVyIG9mIG9zY2lsbGF0aW9uIGxpbmUgZm9yIGFuIGF0dGFjaGVkIG1hc3NcclxuICAgIGNvbnN0IGNlbnRlck9mT3NjaWxsYXRpb25MaW5lTm9kZSA9IG5ldyBSZWZlcmVuY2VMaW5lTm9kZShcclxuICAgICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0sXHJcbiAgICAgIG1vZGVsLmZpcnN0U3ByaW5nLFxyXG4gICAgICBtb2RlbC5maXJzdFNwcmluZy5tYXNzRXF1aWxpYnJpdW1ZUG9zaXRpb25Qcm9wZXJ0eSxcclxuICAgICAgb3NjaWxsYXRpb25WaXNpYmlsaXR5UHJvcGVydHksIHtcclxuICAgICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgICAgbGFiZWw6IG5ldyBUZXh0KCBjZW50ZXJPZk9zY2lsbGF0aW9uU3RyaW5nLCB7XHJcbiAgICAgICAgICBmb250OiBNYXNzZXNBbmRTcHJpbmdzQ29uc3RhbnRzLlRJVExFX0ZPTlQsXHJcbiAgICAgICAgICBmaWxsOiAnYmxhY2snLFxyXG4gICAgICAgICAgbWF4V2lkdGg6IDEyNVxyXG4gICAgICAgIH0gKVxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggY2VudGVyT2ZPc2NpbGxhdGlvbkxpbmVOb2RlICk7XHJcblxyXG4gICAgLy8gQWNjZXNzZWQgaW4gQmFzaWNzIHZlcnNpb24gdG8gYWRqdXN0IHRvIGEgbGFyZ2VyIHdpZHRoLlxyXG4gICAgY29uc3QgbWFzc1ZhbHVlQ29udHJvbFBhbmVsID0gbmV3IE1hc3NWYWx1ZUNvbnRyb2xQYW5lbChcclxuICAgICAgbW9kZWwubWFzc2VzWyAwIF0sXHJcbiAgICAgIHRoaXMubWFzc05vZGVJY29uLFxyXG4gICAgICB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnbWFzc1ZhbHVlQ29udHJvbFBhbmVsJyApLCB7XHJcbiAgICAgICAgbWF4V2lkdGg6IE1hc3Nlc0FuZFNwcmluZ3NDb25zdGFudHMuUEFORUxfTUFYX1dJRFRIICsgTWFzc2VzQW5kU3ByaW5nc0NvbnN0YW50cy5QQU5FTF9NQVhfV0lEVEggKiAwLjA1LFxyXG4gICAgICAgIGJhc2ljc1ZlcnNpb246IG1vZGVsLmJhc2ljc1ZlcnNpb25cclxuICAgICAgfVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLnNwcmluZ1N5c3RlbUNvbnRyb2xzTm9kZS5zZXRDaGlsZHJlbiggW1xyXG4gICAgICBtYXNzVmFsdWVDb250cm9sUGFuZWwsIHRoaXMuc3ByaW5nSGFuZ2VyTm9kZSwgdGhpcy5zcHJpbmdTdG9wcGVyQnV0dG9uTm9kZVxyXG4gICAgXSApO1xyXG4gICAgdGhpcy5zcHJpbmdTeXN0ZW1Db250cm9sc05vZGUuc3BhY2luZyA9IHRoaXMuc3BhY2luZyAqIDEuMjtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7UGVyaW9kVHJhY2VOb2RlfVxyXG4gICAgdGhpcy5wZXJpb2RUcmFjZU5vZGUgPSBuZXcgUGVyaW9kVHJhY2VOb2RlKCBtb2RlbC5maXJzdFNwcmluZy5wZXJpb2RUcmFjZSwgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0sIG1vZGVsLmJhc2ljc1ZlcnNpb24sIHtcclxuICAgICAgY2VudGVyOiB0aGlzLm1hc3NFcXVpbGlicml1bUxpbmVOb2RlLmNlbnRlclxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIE1vdmUgbGF5ZXJzIHdpdGggaW50ZXJhY3RpdmUgZWxlbWVudHMgYW5kIGxheWVycyB0byB0aGUgZnJvbnRcclxuICAgIHRoaXMubW92YWJsZUxpbmVOb2RlLm1vdmVUb0Zyb250KCk7XHJcbiAgICB0aGlzLm1hc3NMYXllci5tb3ZlVG9Gcm9udCgpO1xyXG4gICAgdGhpcy50b29sc0xheWVyLm1vdmVUb0Zyb250KCk7XHJcblxyXG4gICAgdGhpcy5yZXNldEFsbEJ1dHRvbi5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICB0aGlzLm1vdmFibGVMaW5lTm9kZS5yZXNldCgpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEJhY2sgbGF5ZXIgdXNlZCB0byBoYW5kbGUgeiBvcmRlciBvZiB2aWV3IGVsZW1lbnRzLlxyXG4gICAgdGhpcy5iYWNrTGF5ZXIuY2hpbGRyZW4gPSBbIHRoaXMuYmFja2dyb3VuZERyYWdQbGFuZSwgcmlnaHRQYW5lbHNWQm94LCBzaGVsZiwgdGhpcy5wZXJpb2RUcmFjZU5vZGUgXTtcclxuXHJcbiAgICB0aGlzLnZpc2libGVCb3VuZHNQcm9wZXJ0eS5saW5rKCAoKSA9PiB7XHJcbiAgICAgIHJpZ2h0UGFuZWxzVkJveC5yaWdodFRvcCA9IG5ldyBWZWN0b3IyKCB0aGlzLnBhbmVsUmlnaHRTcGFjaW5nLCB0aGlzLnNwYWNpbmcgKTtcclxuICAgICAgdGhpcy5zcHJpbmdTeXN0ZW1Db250cm9sc05vZGUuY2VudGVyWCA9IHRoaXMuc3ByaW5nQ2VudGVyICogMC44MzU7IC8vIGNlbnRlcmluZyBzcHJpbmdIYW5nZXJOb2RlIG92ZXIgc3ByaW5nXHJcbiAgICAgIHRoaXMuc3ByaW5nQ29uc3RhbnRDb250cm9sUGFuZWwubGVmdCA9IHRoaXMuc3ByaW5nU3lzdGVtQ29udHJvbHNOb2RlLnJpZ2h0ICsgdGhpcy5zcGFjaW5nO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGR0XHJcbiAgICovXHJcbiAgc3RlcCggZHQgKSB7XHJcbiAgICB0aGlzLnBlcmlvZFRyYWNlTm9kZS5zdGVwKCBkdCwgdGhpcy5tb2RlbC5wbGF5aW5nUHJvcGVydHkgKTtcclxuICB9XHJcbn1cclxuXHJcbm1hc3Nlc0FuZFNwcmluZ3NCYXNpY3MucmVnaXN0ZXIoICdMYWJTY3JlZW5WaWV3JywgTGFiU2NyZWVuVmlldyApO1xyXG5leHBvcnQgZGVmYXVsdCBMYWJTY3JlZW5WaWV3OyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MseUJBQXlCLE1BQU0sdUVBQXVFO0FBQzdHLE9BQU9DLHNCQUFzQixNQUFNLHlFQUF5RTtBQUM1RyxPQUFPQyxxQkFBcUIsTUFBTSx3RUFBd0U7QUFDMUcsT0FBT0MsbUJBQW1CLE1BQU0sc0VBQXNFO0FBQ3RHLE9BQU9DLGlCQUFpQixNQUFNLG9FQUFvRTtBQUNsRyxPQUFPQyxTQUFTLE1BQU0sNERBQTREO0FBQ2xGLE9BQU9DLGVBQWUsTUFBTSwrREFBK0Q7QUFDM0YsT0FBT0MsMkJBQTJCLE1BQU0sK0VBQStFO0FBQ3ZILFNBQVNDLElBQUksRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUM5RCxPQUFPQyxlQUFlLE1BQU0sc0NBQXNDO0FBQ2xFLE9BQU9DLHNCQUFzQixNQUFNLGlDQUFpQztBQUNwRSxPQUFPQyw2QkFBNkIsTUFBTSx3Q0FBd0M7QUFDbEYsT0FBT0MsbUJBQW1CLE1BQU0sMEJBQTBCO0FBRTFELE1BQU1DLHlCQUF5QixHQUFHRiw2QkFBNkIsQ0FBQ0csbUJBQW1CO0FBRW5GLE1BQU1DLGFBQWEsU0FBU2IsbUJBQW1CLENBQUM7RUFDOUM7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNFYyxXQUFXQSxDQUFFQyxLQUFLLEVBQUVDLE1BQU0sRUFBRztJQUUzQjtJQUNBLEtBQUssQ0FBRUQsS0FBSyxFQUFFQyxNQUFPLENBQUM7SUFDdEIsTUFBTUMsMkJBQTJCLEdBQUcsSUFBSWIsMkJBQTJCLENBQ2pFVyxLQUFLLEVBQ0xDLE1BQU0sQ0FBQ0UsWUFBWSxDQUFFLDZCQUE4QixDQUFDLEVBQ3BEO01B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