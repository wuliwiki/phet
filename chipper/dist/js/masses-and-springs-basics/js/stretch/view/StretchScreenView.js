// Copyright 2018-2021, University of Colorado Boulder

/**
 * View for Stretch screen.
 *
 * @author Denzell Barnett (PhET Interactive Simulations)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Property from '../../../../axon/js/Property.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import MassesAndSpringsConstants from '../../../../masses-and-springs/js/common/MassesAndSpringsConstants.js';
import DraggableRulerNode from '../../../../masses-and-springs/js/common/view/DraggableRulerNode.js';
import MassesAndSpringsColors from '../../../../masses-and-springs/js/common/view/MassesAndSpringsColors.js';
import ReferenceLineNode from '../../../../masses-and-springs/js/common/view/ReferenceLineNode.js';
import ShelfNode from '../../../../masses-and-springs/js/common/view/ShelfNode.js';
import TwoSpringScreenView from '../../../../masses-and-springs/js/common/view/TwoSpringScreenView.js';
import { PaintColorProperty } from '../../../../scenery/js/imports.js';
import LineOptionsNode from '../../common/view/LineOptionsNode.js';
import massesAndSpringsBasics from '../../massesAndSpringsBasics.js';
class StretchScreenView extends TwoSpringScreenView {
  /**
   * @param {VectorsModel} model
   * @param {Tandem} tandem
   */
  constructor(model, tandem) {
    // Calls common two spring view
    super(model, tandem);

    // Equilibrium of mass is dependent on the mass being attached and the visibility of the equilibrium line.
    const firstMassEquilibriumVisibilityProperty = new DerivedProperty([model.equilibriumPositionVisibleProperty, model.firstSpring.massAttachedProperty], (equilibriumPositionVisible, massAttached) => {
      return !!massAttached && equilibriumPositionVisible;
    });
    const secondMassEquilibriumVisibilityProperty = new DerivedProperty([model.equilibriumPositionVisibleProperty, model.secondSpring.massAttachedProperty], (equilibriumPositionVisible, massAttached) => {
      return !!massAttached && equilibriumPositionVisible;
    });

    // Initializes equilibrium line for first spring
    const firstMassEquilibriumLineNode = new ReferenceLineNode(this.modelViewTransform, model.firstSpring, model.firstSpring.equilibriumYPositionProperty, firstMassEquilibriumVisibilityProperty, {
      stroke: MassesAndSpringsColors.restingPositionProperty
    });

    // Initializes equilibrium line for second spring
    const secondMassEquilibriumLineNode = new ReferenceLineNode(this.modelViewTransform, model.secondSpring, model.secondSpring.equilibriumYPositionProperty, secondMassEquilibriumVisibilityProperty, {
      stroke: MassesAndSpringsColors.restingPositionProperty
    });

    // Setting specific colors for this screen's springs.
    this.springFrontColorProperty.set(new PaintColorProperty('rgb( 162, 106, 172 )').value);
    this.springMiddleColorProperty.set(new PaintColorProperty('rgb( 100, 6, 117 )').value);
    this.springBackColorProperty.set(new PaintColorProperty('rgb( 50, 3, 58 )').value);

    // Adding system controls to scene graph
    this.addChild(this.springSystemControlsNode);

    // Reference lines from indicator visibility box
    this.addChild(this.firstNaturalLengthLineNode);
    this.addChild(this.secondNaturalLengthLineNode);
    this.addChild(firstMassEquilibriumLineNode);
    this.addChild(secondMassEquilibriumLineNode);

    // The movable line will always be visible on this screen.
    this.addChild(this.movableLineNode);

    // Adding layers for interactive elements
    this.addChild(this.massLayer);
    this.addChild(this.toolsLayer);

    // Contains visibility options for the reference lines and displacement arrow
    const lineOptionsPanel = new LineOptionsNode(model, tandem);

    // Panel that will display all the toggleable options.
    const optionsPanel = this.createOptionsPanel(lineOptionsPanel, this.rightPanelAlignGroup, tandem);

    // Shelves used for masses
    const labeledMassesShelf = new ShelfNode(tandem, {
      rectHeight: 7,
      rectWidth: 185,
      left: this.layoutBounds.left + this.spacing,
      rectY: this.modelViewTransform.modelToViewY(MassesAndSpringsConstants.FLOOR_Y) - this.shelf.rectHeight
    });
    const mysteryMassesShelf = new ShelfNode(tandem, {
      rectHeight: 7,
      rectWidth: 120,
      left: labeledMassesShelf.right + this.spacing * 2,
      rectY: this.modelViewTransform.modelToViewY(MassesAndSpringsConstants.FLOOR_Y) - this.shelf.rectHeight
    });

    // @public {DraggableRulerNode}
    this.rulerNode = new DraggableRulerNode(this.modelViewTransform, this.visibleBoundsProperty.get(), new Vector2(this.visibleBoundsProperty.value.right - this.spacing, optionsPanel.bottom + this.spacing), new Property(true), () => {}, tandem.createTandem('rulerNode'));
    this.addChild(this.rulerNode);

    // Back layer used to handle z order of view elements.
    this.backLayer.children = [this.backgroundDragPlane, optionsPanel, labeledMassesShelf, mysteryMassesShelf];
    this.visibleBoundsProperty.link(() => {
      optionsPanel.rightTop = new Vector2(this.panelRightSpacing, this.springSystemControlsNode.top);
      if (!this.rulerNode.draggedProperty.value) {
        this.rulerNode.positionProperty.set(optionsPanel.rightBottom.plusXY(0, this.spacing));
      }
    });

    // Reset call here sets the ruler to its default position rather than resetting the positionProperty
    this.resetAllButton.addListener(() => {
      this.rulerNode.positionProperty.set(optionsPanel.rightBottom.plusXY(0, this.spacing));
      this.rulerNode.draggedProperty.reset();
      model.dampingProperty.set(0.7);
    });
  }
}
massesAndSpringsBasics.register('StretchScreenView', StretchScreenView);
export default StretchScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJQcm9wZXJ0eSIsIlZlY3RvcjIiLCJNYXNzZXNBbmRTcHJpbmdzQ29uc3RhbnRzIiwiRHJhZ2dhYmxlUnVsZXJOb2RlIiwiTWFzc2VzQW5kU3ByaW5nc0NvbG9ycyIsIlJlZmVyZW5jZUxpbmVOb2RlIiwiU2hlbGZOb2RlIiwiVHdvU3ByaW5nU2NyZWVuVmlldyIsIlBhaW50Q29sb3JQcm9wZXJ0eSIsIkxpbmVPcHRpb25zTm9kZSIsIm1hc3Nlc0FuZFNwcmluZ3NCYXNpY3MiLCJTdHJldGNoU2NyZWVuVmlldyIsImNvbnN0cnVjdG9yIiwibW9kZWwiLCJ0YW5kZW0iLCJmaXJzdE1hc3NFcXVpbGlicml1bVZpc2liaWxpdHlQcm9wZXJ0eSIsImVxdWlsaWJyaXVtUG9zaXRpb25WaXNpYmxlUHJvcGVydHkiLCJmaXJzdFNwcmluZyIsIm1hc3NBdHRhY2hlZFByb3BlcnR5IiwiZXF1aWxpYnJpdW1Qb3NpdGlvblZpc2libGUiLCJtYXNzQXR0YWNoZWQiLCJzZWNvbmRNYXNzRXF1aWxpYnJpdW1WaXNpYmlsaXR5UHJvcGVydHkiLCJzZWNvbmRTcHJpbmciLCJmaXJzdE1hc3NFcXVpbGlicml1bUxpbmVOb2RlIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwiZXF1aWxpYnJpdW1ZUG9zaXRpb25Qcm9wZXJ0eSIsInN0cm9rZSIsInJlc3RpbmdQb3NpdGlvblByb3BlcnR5Iiwic2Vjb25kTWFzc0VxdWlsaWJyaXVtTGluZU5vZGUiLCJzcHJpbmdGcm9udENvbG9yUHJvcGVydHkiLCJzZXQiLCJ2YWx1ZSIsInNwcmluZ01pZGRsZUNvbG9yUHJvcGVydHkiLCJzcHJpbmdCYWNrQ29sb3JQcm9wZXJ0eSIsImFkZENoaWxkIiwic3ByaW5nU3lzdGVtQ29udHJvbHNOb2RlIiwiZmlyc3ROYXR1cmFsTGVuZ3RoTGluZU5vZGUiLCJzZWNvbmROYXR1cmFsTGVuZ3RoTGluZU5vZGUiLCJtb3ZhYmxlTGluZU5vZGUiLCJtYXNzTGF5ZXIiLCJ0b29sc0xheWVyIiwibGluZU9wdGlvbnNQYW5lbCIsIm9wdGlvbnNQYW5lbCIsImNyZWF0ZU9wdGlvbnNQYW5lbCIsInJpZ2h0UGFuZWxBbGlnbkdyb3VwIiwibGFiZWxlZE1hc3Nlc1NoZWxmIiwicmVjdEhlaWdodCIsInJlY3RXaWR0aCIsImxlZnQiLCJsYXlvdXRCb3VuZHMiLCJzcGFjaW5nIiwicmVjdFkiLCJtb2RlbFRvVmlld1kiLCJGTE9PUl9ZIiwic2hlbGYiLCJteXN0ZXJ5TWFzc2VzU2hlbGYiLCJyaWdodCIsInJ1bGVyTm9kZSIsInZpc2libGVCb3VuZHNQcm9wZXJ0eSIsImdldCIsImJvdHRvbSIsImNyZWF0ZVRhbmRlbSIsImJhY2tMYXllciIsImNoaWxkcmVuIiwiYmFja2dyb3VuZERyYWdQbGFuZSIsImxpbmsiLCJyaWdodFRvcCIsInBhbmVsUmlnaHRTcGFjaW5nIiwidG9wIiwiZHJhZ2dlZFByb3BlcnR5IiwicG9zaXRpb25Qcm9wZXJ0eSIsInJpZ2h0Qm90dG9tIiwicGx1c1hZIiwicmVzZXRBbGxCdXR0b24iLCJhZGRMaXN0ZW5lciIsInJlc2V0IiwiZGFtcGluZ1Byb3BlcnR5IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJTdHJldGNoU2NyZWVuVmlldy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDIxLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBWaWV3IGZvciBTdHJldGNoIHNjcmVlbi5cclxuICpcclxuICogQGF1dGhvciBEZW56ZWxsIEJhcm5ldHQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgTWFzc2VzQW5kU3ByaW5nc0NvbnN0YW50cyBmcm9tICcuLi8uLi8uLi8uLi9tYXNzZXMtYW5kLXNwcmluZ3MvanMvY29tbW9uL01hc3Nlc0FuZFNwcmluZ3NDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgRHJhZ2dhYmxlUnVsZXJOb2RlIGZyb20gJy4uLy4uLy4uLy4uL21hc3Nlcy1hbmQtc3ByaW5ncy9qcy9jb21tb24vdmlldy9EcmFnZ2FibGVSdWxlck5vZGUuanMnO1xyXG5pbXBvcnQgTWFzc2VzQW5kU3ByaW5nc0NvbG9ycyBmcm9tICcuLi8uLi8uLi8uLi9tYXNzZXMtYW5kLXNwcmluZ3MvanMvY29tbW9uL3ZpZXcvTWFzc2VzQW5kU3ByaW5nc0NvbG9ycy5qcyc7XHJcbmltcG9ydCBSZWZlcmVuY2VMaW5lTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9tYXNzZXMtYW5kLXNwcmluZ3MvanMvY29tbW9uL3ZpZXcvUmVmZXJlbmNlTGluZU5vZGUuanMnO1xyXG5pbXBvcnQgU2hlbGZOb2RlIGZyb20gJy4uLy4uLy4uLy4uL21hc3Nlcy1hbmQtc3ByaW5ncy9qcy9jb21tb24vdmlldy9TaGVsZk5vZGUuanMnO1xyXG5pbXBvcnQgVHdvU3ByaW5nU2NyZWVuVmlldyBmcm9tICcuLi8uLi8uLi8uLi9tYXNzZXMtYW5kLXNwcmluZ3MvanMvY29tbW9uL3ZpZXcvVHdvU3ByaW5nU2NyZWVuVmlldy5qcyc7XHJcbmltcG9ydCB7IFBhaW50Q29sb3JQcm9wZXJ0eSB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBMaW5lT3B0aW9uc05vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvTGluZU9wdGlvbnNOb2RlLmpzJztcclxuaW1wb3J0IG1hc3Nlc0FuZFNwcmluZ3NCYXNpY3MgZnJvbSAnLi4vLi4vbWFzc2VzQW5kU3ByaW5nc0Jhc2ljcy5qcyc7XHJcblxyXG5jbGFzcyBTdHJldGNoU2NyZWVuVmlldyBleHRlbmRzIFR3b1NwcmluZ1NjcmVlblZpZXcge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7VmVjdG9yc01vZGVsfSBtb2RlbFxyXG4gICAqIEBwYXJhbSB7VGFuZGVtfSB0YW5kZW1cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbW9kZWwsIHRhbmRlbSApIHtcclxuXHJcbiAgICAvLyBDYWxscyBjb21tb24gdHdvIHNwcmluZyB2aWV3XHJcbiAgICBzdXBlciggbW9kZWwsIHRhbmRlbSApO1xyXG5cclxuICAgIC8vIEVxdWlsaWJyaXVtIG9mIG1hc3MgaXMgZGVwZW5kZW50IG9uIHRoZSBtYXNzIGJlaW5nIGF0dGFjaGVkIGFuZCB0aGUgdmlzaWJpbGl0eSBvZiB0aGUgZXF1aWxpYnJpdW0gbGluZS5cclxuICAgIGNvbnN0IGZpcnN0TWFzc0VxdWlsaWJyaXVtVmlzaWJpbGl0eVByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBtb2RlbC5lcXVpbGlicml1bVBvc2l0aW9uVmlzaWJsZVByb3BlcnR5LCBtb2RlbC5maXJzdFNwcmluZy5tYXNzQXR0YWNoZWRQcm9wZXJ0eSBdLFxyXG4gICAgICAoIGVxdWlsaWJyaXVtUG9zaXRpb25WaXNpYmxlLCBtYXNzQXR0YWNoZWQgKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuICEhbWFzc0F0dGFjaGVkICYmIGVxdWlsaWJyaXVtUG9zaXRpb25WaXNpYmxlO1xyXG4gICAgICB9ICk7XHJcbiAgICBjb25zdCBzZWNvbmRNYXNzRXF1aWxpYnJpdW1WaXNpYmlsaXR5UHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIG1vZGVsLmVxdWlsaWJyaXVtUG9zaXRpb25WaXNpYmxlUHJvcGVydHksIG1vZGVsLnNlY29uZFNwcmluZy5tYXNzQXR0YWNoZWRQcm9wZXJ0eSBdLFxyXG4gICAgICAoIGVxdWlsaWJyaXVtUG9zaXRpb25WaXNpYmxlLCBtYXNzQXR0YWNoZWQgKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuICEhbWFzc0F0dGFjaGVkICYmIGVxdWlsaWJyaXVtUG9zaXRpb25WaXNpYmxlO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZXMgZXF1aWxpYnJpdW0gbGluZSBmb3IgZmlyc3Qgc3ByaW5nXHJcbiAgICBjb25zdCBmaXJzdE1hc3NFcXVpbGlicml1bUxpbmVOb2RlID0gbmV3IFJlZmVyZW5jZUxpbmVOb2RlKFxyXG4gICAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgbW9kZWwuZmlyc3RTcHJpbmcsXHJcbiAgICAgIG1vZGVsLmZpcnN0U3ByaW5nLmVxdWlsaWJyaXVtWVBvc2l0aW9uUHJvcGVydHksXHJcbiAgICAgIGZpcnN0TWFzc0VxdWlsaWJyaXVtVmlzaWJpbGl0eVByb3BlcnR5LCB7XHJcbiAgICAgICAgc3Ryb2tlOiBNYXNzZXNBbmRTcHJpbmdzQ29sb3JzLnJlc3RpbmdQb3NpdGlvblByb3BlcnR5XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZXMgZXF1aWxpYnJpdW0gbGluZSBmb3Igc2Vjb25kIHNwcmluZ1xyXG4gICAgY29uc3Qgc2Vjb25kTWFzc0VxdWlsaWJyaXVtTGluZU5vZGUgPSBuZXcgUmVmZXJlbmNlTGluZU5vZGUoXHJcbiAgICAgIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLFxyXG4gICAgICBtb2RlbC5zZWNvbmRTcHJpbmcsXHJcbiAgICAgIG1vZGVsLnNlY29uZFNwcmluZy5lcXVpbGlicml1bVlQb3NpdGlvblByb3BlcnR5LFxyXG4gICAgICBzZWNvbmRNYXNzRXF1aWxpYnJpdW1WaXNpYmlsaXR5UHJvcGVydHksIHtcclxuICAgICAgICBzdHJva2U6IE1hc3Nlc0FuZFNwcmluZ3NDb2xvcnMucmVzdGluZ1Bvc2l0aW9uUHJvcGVydHlcclxuICAgICAgfVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBTZXR0aW5nIHNwZWNpZmljIGNvbG9ycyBmb3IgdGhpcyBzY3JlZW4ncyBzcHJpbmdzLlxyXG4gICAgdGhpcy5zcHJpbmdGcm9udENvbG9yUHJvcGVydHkuc2V0KCBuZXcgUGFpbnRDb2xvclByb3BlcnR5KCAncmdiKCAxNjIsIDEwNiwgMTcyICknICkudmFsdWUgKTtcclxuICAgIHRoaXMuc3ByaW5nTWlkZGxlQ29sb3JQcm9wZXJ0eS5zZXQoIG5ldyBQYWludENvbG9yUHJvcGVydHkoICdyZ2IoIDEwMCwgNiwgMTE3ICknICkudmFsdWUgKTtcclxuICAgIHRoaXMuc3ByaW5nQmFja0NvbG9yUHJvcGVydHkuc2V0KCBuZXcgUGFpbnRDb2xvclByb3BlcnR5KCAncmdiKCA1MCwgMywgNTggKScgKS52YWx1ZSApO1xyXG5cclxuICAgIC8vIEFkZGluZyBzeXN0ZW0gY29udHJvbHMgdG8gc2NlbmUgZ3JhcGhcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuc3ByaW5nU3lzdGVtQ29udHJvbHNOb2RlICk7XHJcblxyXG4gICAgLy8gUmVmZXJlbmNlIGxpbmVzIGZyb20gaW5kaWNhdG9yIHZpc2liaWxpdHkgYm94XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLmZpcnN0TmF0dXJhbExlbmd0aExpbmVOb2RlICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLnNlY29uZE5hdHVyYWxMZW5ndGhMaW5lTm9kZSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggZmlyc3RNYXNzRXF1aWxpYnJpdW1MaW5lTm9kZSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggc2Vjb25kTWFzc0VxdWlsaWJyaXVtTGluZU5vZGUgKTtcclxuXHJcbiAgICAvLyBUaGUgbW92YWJsZSBsaW5lIHdpbGwgYWx3YXlzIGJlIHZpc2libGUgb24gdGhpcyBzY3JlZW4uXHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLm1vdmFibGVMaW5lTm9kZSApO1xyXG5cclxuICAgIC8vIEFkZGluZyBsYXllcnMgZm9yIGludGVyYWN0aXZlIGVsZW1lbnRzXHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLm1hc3NMYXllciApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy50b29sc0xheWVyICk7XHJcblxyXG4gICAgLy8gQ29udGFpbnMgdmlzaWJpbGl0eSBvcHRpb25zIGZvciB0aGUgcmVmZXJlbmNlIGxpbmVzIGFuZCBkaXNwbGFjZW1lbnQgYXJyb3dcclxuICAgIGNvbnN0IGxpbmVPcHRpb25zUGFuZWwgPSBuZXcgTGluZU9wdGlvbnNOb2RlKCBtb2RlbCwgdGFuZGVtICk7XHJcblxyXG4gICAgLy8gUGFuZWwgdGhhdCB3aWxsIGRpc3BsYXkgYWxsIHRoZSB0b2dnbGVhYmxlIG9wdGlvbnMuXHJcbiAgICBjb25zdCBvcHRpb25zUGFuZWwgPSB0aGlzLmNyZWF0ZU9wdGlvbnNQYW5lbCggbGluZU9wdGlvbnNQYW5lbCwgdGhpcy5yaWdodFBhbmVsQWxpZ25Hcm91cCwgdGFuZGVtICk7XHJcblxyXG4gICAgLy8gU2hlbHZlcyB1c2VkIGZvciBtYXNzZXNcclxuICAgIGNvbnN0IGxhYmVsZWRNYXNzZXNTaGVsZiA9IG5ldyBTaGVsZk5vZGUoIHRhbmRlbSwge1xyXG4gICAgICByZWN0SGVpZ2h0OiA3LFxyXG4gICAgICByZWN0V2lkdGg6IDE4NSxcclxuICAgICAgbGVmdDogdGhpcy5sYXlvdXRCb3VuZHMubGVmdCArIHRoaXMuc3BhY2luZyxcclxuICAgICAgcmVjdFk6IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggTWFzc2VzQW5kU3ByaW5nc0NvbnN0YW50cy5GTE9PUl9ZICkgLSB0aGlzLnNoZWxmLnJlY3RIZWlnaHRcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBteXN0ZXJ5TWFzc2VzU2hlbGYgPSBuZXcgU2hlbGZOb2RlKCB0YW5kZW0sIHtcclxuICAgICAgcmVjdEhlaWdodDogNyxcclxuICAgICAgcmVjdFdpZHRoOiAxMjAsXHJcbiAgICAgIGxlZnQ6IGxhYmVsZWRNYXNzZXNTaGVsZi5yaWdodCArIHRoaXMuc3BhY2luZyAqIDIsXHJcbiAgICAgIHJlY3RZOiB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1koIE1hc3Nlc0FuZFNwcmluZ3NDb25zdGFudHMuRkxPT1JfWSApIC0gdGhpcy5zaGVsZi5yZWN0SGVpZ2h0XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7RHJhZ2dhYmxlUnVsZXJOb2RlfVxyXG4gICAgdGhpcy5ydWxlck5vZGUgPSBuZXcgRHJhZ2dhYmxlUnVsZXJOb2RlKFxyXG4gICAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgdGhpcy52aXNpYmxlQm91bmRzUHJvcGVydHkuZ2V0KCksXHJcbiAgICAgIG5ldyBWZWN0b3IyKCB0aGlzLnZpc2libGVCb3VuZHNQcm9wZXJ0eS52YWx1ZS5yaWdodCAtIHRoaXMuc3BhY2luZywgb3B0aW9uc1BhbmVsLmJvdHRvbSArIHRoaXMuc3BhY2luZyApLFxyXG4gICAgICBuZXcgUHJvcGVydHkoIHRydWUgKSxcclxuICAgICAgKCkgPT4ge30sXHJcbiAgICAgIHRhbmRlbS5jcmVhdGVUYW5kZW0oICdydWxlck5vZGUnIClcclxuICAgICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLnJ1bGVyTm9kZSApO1xyXG5cclxuICAgIC8vIEJhY2sgbGF5ZXIgdXNlZCB0byBoYW5kbGUgeiBvcmRlciBvZiB2aWV3IGVsZW1lbnRzLlxyXG4gICAgdGhpcy5iYWNrTGF5ZXIuY2hpbGRyZW4gPSBbIHRoaXMuYmFja2dyb3VuZERyYWdQbGFuZSwgb3B0aW9uc1BhbmVsLCBsYWJlbGVkTWFzc2VzU2hlbGYsIG15c3RlcnlNYXNzZXNTaGVsZiBdO1xyXG5cclxuICAgIHRoaXMudmlzaWJsZUJvdW5kc1Byb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgICAgb3B0aW9uc1BhbmVsLnJpZ2h0VG9wID0gbmV3IFZlY3RvcjIoIHRoaXMucGFuZWxSaWdodFNwYWNpbmcsIHRoaXMuc3ByaW5nU3lzdGVtQ29udHJvbHNOb2RlLnRvcCApO1xyXG4gICAgICBpZiAoICF0aGlzLnJ1bGVyTm9kZS5kcmFnZ2VkUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgdGhpcy5ydWxlck5vZGUucG9zaXRpb25Qcm9wZXJ0eS5zZXQoIG9wdGlvbnNQYW5lbC5yaWdodEJvdHRvbS5wbHVzWFkoIDAsIHRoaXMuc3BhY2luZyApICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBSZXNldCBjYWxsIGhlcmUgc2V0cyB0aGUgcnVsZXIgdG8gaXRzIGRlZmF1bHQgcG9zaXRpb24gcmF0aGVyIHRoYW4gcmVzZXR0aW5nIHRoZSBwb3NpdGlvblByb3BlcnR5XHJcbiAgICB0aGlzLnJlc2V0QWxsQnV0dG9uLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgIHRoaXMucnVsZXJOb2RlLnBvc2l0aW9uUHJvcGVydHkuc2V0KCBvcHRpb25zUGFuZWwucmlnaHRCb3R0b20ucGx1c1hZKCAwLCB0aGlzLnNwYWNpbmcgKSApO1xyXG4gICAgICB0aGlzLnJ1bGVyTm9kZS5kcmFnZ2VkUHJvcGVydHkucmVzZXQoKTtcclxuICAgICAgbW9kZWwuZGFtcGluZ1Byb3BlcnR5LnNldCggMC43ICk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5tYXNzZXNBbmRTcHJpbmdzQmFzaWNzLnJlZ2lzdGVyKCAnU3RyZXRjaFNjcmVlblZpZXcnLCBTdHJldGNoU2NyZWVuVmlldyApO1xyXG5leHBvcnQgZGVmYXVsdCBTdHJldGNoU2NyZWVuVmlldzsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxRQUFRLE1BQU0saUNBQWlDO0FBQ3RELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MseUJBQXlCLE1BQU0sdUVBQXVFO0FBQzdHLE9BQU9DLGtCQUFrQixNQUFNLHFFQUFxRTtBQUNwRyxPQUFPQyxzQkFBc0IsTUFBTSx5RUFBeUU7QUFDNUcsT0FBT0MsaUJBQWlCLE1BQU0sb0VBQW9FO0FBQ2xHLE9BQU9DLFNBQVMs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