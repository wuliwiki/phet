// Copyright 2020-2023, University of Colorado Boulder

/**
 * An AccordionBox with two NumberPickers in it that determines the targetRatioProperty in the model ("My Challenge" value).
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Property from '../../../../axon/js/Property.js';
import Range from '../../../../dot/js/Range.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Fraction from '../../../../phetcommon/js/model/Fraction.js';
import NumberPicker from '../../../../sun/js/NumberPicker.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { HBox, Node, ReadingBlock, RichText, VBox, Voicing } from '../../../../scenery/js/imports.js';
import ActivationUtterance from '../../../../utterance-queue/js/ActivationUtterance.js';
import Utterance from '../../../../utterance-queue/js/Utterance.js';
import RatioHandNode from '../../common/view/RatioHandNode.js';
import ratioAndProportion from '../../ratioAndProportion.js';
import RatioAndProportionStrings from '../../RatioAndProportionStrings.js';
import AccordionBox from '../../../../sun/js/AccordionBox.js';
import optionize from '../../../../phet-core/js/optionize.js';
import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import ResponsePatternCollection from '../../../../utterance-queue/js/ResponsePatternCollection.js';
import ResponsePacket from '../../../../utterance-queue/js/ResponsePacket.js';
import Multilink from '../../../../axon/js/Multilink.js';
const PICKER_SCALE = 1.5;
const ICON_SCALE = 0.9;
const DEFAULT_EXPANDED = false;
class MyChallengeAccordionBox extends AccordionBox {
  constructor(targetRatioProperty, ratioLockedProperty, handColorProperty, tickMarkViewProperty, ratioDescriber, providedOptions) {
    // Allow us to get the reduced fraction as the initial value of the custom "My Challenge"
    const initialRatioFraction = Fraction.fromDecimal(targetRatioProperty.value);
    const rangeProperty = new Property(new Range(1, 10));
    assert && assert(rangeProperty.value.contains(initialRatioFraction.numerator), 'unsupported numerator');
    assert && assert(rangeProperty.value.contains(initialRatioFraction.denominator), 'unsupported denominator');
    const targetAntecedentProperty = new NumberProperty(initialRatioFraction.numerator, {
      tandem: providedOptions.tandem.createTandem('targetAntecedentProperty')
    });
    const targetConsequentProperty = new NumberProperty(initialRatioFraction.denominator, {
      tandem: providedOptions.tandem.createTandem('targetConsequentProperty')
    });
    const expandedProperty = new BooleanProperty(DEFAULT_EXPANDED, {
      tandem: providedOptions.tandem.createTandem('expandedProperty')
    });
    const createAccordionBoxContextResponse = () => {
      return expandedProperty.value ? ratioDescriber.getCurrentChallengeSentence(targetAntecedentProperty.value, targetConsequentProperty.value) : RatioAndProportionStrings.a11y.ratio.currentChallengeHiddenStringProperty.value;
    };
    const options = optionize()({
      titleNode: new RichText(RatioAndProportionStrings.myChallengeStringProperty, {
        font: new PhetFont(20),
        maxWidth: 200 // empirically determined
      }),

      accessibleName: RatioAndProportionStrings.myChallengeStringProperty,
      titleAlignX: 'left',
      contentXMargin: 26,
      contentYMargin: 15,
      contentYSpacing: 15,
      maxWidth: 220,
      // Copied from NLCConstants.js, see https://github.com/phetsims/ratio-and-proportion/issues/58#issuecomment-646377333
      cornerRadius: 5,
      buttonXMargin: 10,
      buttonYMargin: 10,
      expandCollapseButtonOptions: {
        touchAreaXDilation: 15,
        touchAreaYDilation: 15,
        mouseAreaXDilation: 5,
        mouseAreaYDilation: 5
      },
      expandedProperty: expandedProperty,
      // voicing
      voicingNameResponse: RatioAndProportionStrings.myChallengeStringProperty,
      voicingContextResponse: createAccordionBoxContextResponse,
      // Only deliver the hint if not expanded; since in a closure, use the current value of the Property.
      voicingHintResponse: () => expandedProperty.value ? null : RatioAndProportionStrings.a11y.create.myChallengeHintTextStringProperty.value
    }, providedOptions);
    const ratioUnlockedFromMyChallenge = new Utterance({
      alert: new ResponsePacket({
        contextResponse: RatioAndProportionStrings.a11y.ratioNoLongerLockedStringProperty
      }),
      priority: Utterance.MEDIUM_PRIORITY
    });
    const createNumberPickerContextResponse = () => ratioDescriber.getTargetRatioChangeAlert(targetAntecedentProperty.value, targetConsequentProperty.value);
    const antecedentNumberPicker = new NumberPicker(targetAntecedentProperty, rangeProperty, {
      scale: PICKER_SCALE,
      color: handColorProperty.value,
      center: Vector2.ZERO,
      accessibleName: RatioAndProportionStrings.a11y.leftValueStringProperty,
      a11yDependencies: [targetConsequentProperty],
      a11yCreateAriaValueText: ratioDescriber.getWordFromNumber,
      a11yCreateContextResponseAlert: createNumberPickerContextResponse,
      // voicing
      voicingNameResponse: RatioAndProportionStrings.a11y.leftValueStringProperty,
      voicingObjectResponse: () => ratioDescriber.getWordFromNumber(targetAntecedentProperty.value),
      voicingContextResponse: createNumberPickerContextResponse,
      // phet-io
      tandem: options.tandem.createTandem('antecedentNumberPicker')
    });
    const leftRatioSelector = new VBox({
      align: 'origin',
      spacing: 10,
      children: [RatioHandNode.createIcon(false, tickMarkViewProperty, {
        handColor: handColorProperty.value,
        handNodeOptions: {
          scale: ICON_SCALE
        }
      }), new Node({
        children: [antecedentNumberPicker]
      })]
    });
    Voicing.registerUtteranceToVoicingNode(ratioUnlockedFromMyChallenge, antecedentNumberPicker);
    const consequentNumberPicker = new NumberPicker(targetConsequentProperty, rangeProperty, {
      scale: PICKER_SCALE,
      color: handColorProperty.value,
      center: Vector2.ZERO,
      accessibleName: RatioAndProportionStrings.a11y.rightValueStringProperty,
      a11yDependencies: [targetAntecedentProperty],
      a11yCreateAriaValueText: ratioDescriber.getWordFromNumber,
      a11yCreateContextResponseAlert: createNumberPickerContextResponse,
      // voicing
      voicingNameResponse: RatioAndProportionStrings.a11y.rightValueStringProperty,
      voicingObjectResponse: () => ratioDescriber.getWordFromNumber(targetConsequentProperty.value),
      voicingContextResponse: createNumberPickerContextResponse,
      // phet-io
      tandem: options.tandem.createTandem('consequentNumberPicker')
    });
    const rightRatioSelector = new VBox({
      align: 'origin',
      spacing: 10,
      children: [RatioHandNode.createIcon(true, tickMarkViewProperty, {
        handColor: handColorProperty.value,
        handNodeOptions: {
          scale: ICON_SCALE
        }
      }), new Node({
        children: [consequentNumberPicker]
      })]
    });
    const myChallengeContent = new HBox({
      spacing: 40,
      tagName: 'div',
      descriptionContent: RatioAndProportionStrings.a11y.create.myChallengeHelpTextStringProperty,
      // help text for the content
      children: [leftRatioSelector, rightRatioSelector]
    });

    // At this time, mixed in Nodes can't take mixin options passed via object literal, it assumes that the Object
    // type is NodeOptions.
    const readingBlockOptions = {
      children: [myChallengeContent],
      readingBlockHintResponse: RatioAndProportionStrings.a11y.create.myChallengeReadingBlockHintTextStringProperty,
      readingBlockNameResponse: createAccordionBoxContextResponse,
      readingBlockResponsePatternCollection: new ResponsePatternCollection({
        nameHint: '{{NAME}} {{HINT}}'
      })
    };
    const readingBlockNode = new ReadingBlockNode(readingBlockOptions);

    // We need an extra node here in order to set PDOMOrder because AccordiongBox set's PDOM order for it's content
    super(new Node({
      children: [readingBlockNode],
      pdomOrder: [myChallengeContent, readingBlockNode]
    }), options);
    this.targetAntecedentProperty = targetAntecedentProperty;
    this.targetConsequentProperty = targetConsequentProperty;
    const accordionBoxUtterance = new ActivationUtterance();
    this.expandedProperty.lazyLink(() => {
      accordionBoxUtterance.alert = createAccordionBoxContextResponse();
      this.alertDescriptionUtterance(accordionBoxUtterance);
    });
    Multilink.multilink([targetAntecedentProperty, targetConsequentProperty], (targetAntecedent, targetConsequent) => {
      const wasLocked = ratioLockedProperty.value;
      targetRatioProperty.value = targetAntecedent / targetConsequent;

      // if currently locked, then it is about to be unlocked
      if (wasLocked && !ratioLockedProperty.value) {
        this.alertDescriptionUtterance(ratioUnlockedFromMyChallenge);
        Voicing.alertUtterance(ratioUnlockedFromMyChallenge);
      }
    });
    this.resetMyChallengeAccordionBox = () => {
      this.expandedProperty.value = DEFAULT_EXPANDED;
      this.targetAntecedentProperty.reset();
      this.targetConsequentProperty.reset();
      ratioUnlockedFromMyChallenge.reset();
    };
  }
  reset() {
    super.reset();
    this.resetMyChallengeAccordionBox();
  }
}
class ReadingBlockNode extends ReadingBlock(Node) {}
ratioAndProportion.register('MyChallengeAccordionBox', MyChallengeAccordionBox);
export default MyChallengeAccordionBox;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOdW1iZXJQcm9wZXJ0eSIsIlByb3BlcnR5IiwiUmFuZ2UiLCJWZWN0b3IyIiwiRnJhY3Rpb24iLCJOdW1iZXJQaWNrZXIiLCJQaGV0Rm9udCIsIkhCb3giLCJOb2RlIiwiUmVhZGluZ0Jsb2NrIiwiUmljaFRleHQiLCJWQm94IiwiVm9pY2luZyIsIkFjdGl2YXRpb25VdHRlcmFuY2UiLCJVdHRlcmFuY2UiLCJSYXRpb0hhbmROb2RlIiwicmF0aW9BbmRQcm9wb3J0aW9uIiwiUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncyIsIkFjY29yZGlvbkJveCIsIm9wdGlvbml6ZSIsIkJvb2xlYW5Qcm9wZXJ0eSIsIlJlc3BvbnNlUGF0dGVybkNvbGxlY3Rpb24iLCJSZXNwb25zZVBhY2tldCIsIk11bHRpbGluayIsIlBJQ0tFUl9TQ0FMRSIsIklDT05fU0NBTEUiLCJERUZBVUxUX0VYUEFOREVEIiwiTXlDaGFsbGVuZ2VBY2NvcmRpb25Cb3giLCJjb25zdHJ1Y3RvciIsInRhcmdldFJhdGlvUHJvcGVydHkiLCJyYXRpb0xvY2tlZFByb3BlcnR5IiwiaGFuZENvbG9yUHJvcGVydHkiLCJ0aWNrTWFya1ZpZXdQcm9wZXJ0eSIsInJhdGlvRGVzY3JpYmVyIiwicHJvdmlkZWRPcHRpb25zIiwiaW5pdGlhbFJhdGlvRnJhY3Rpb24iLCJmcm9tRGVjaW1hbCIsInZhbHVlIiwicmFuZ2VQcm9wZXJ0eSIsImFzc2VydCIsImNvbnRhaW5zIiwibnVtZXJhdG9yIiwiZGVub21pbmF0b3IiLCJ0YXJnZXRBbnRlY2VkZW50UHJvcGVydHkiLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJ0YXJnZXRDb25zZXF1ZW50UHJvcGVydHkiLCJleHBhbmRlZFByb3BlcnR5IiwiY3JlYXRlQWNjb3JkaW9uQm94Q29udGV4dFJlc3BvbnNlIiwiZ2V0Q3VycmVudENoYWxsZW5nZVNlbnRlbmNlIiwiYTExeSIsInJhdGlvIiwiY3VycmVudENoYWxsZW5nZUhpZGRlblN0cmluZ1Byb3BlcnR5Iiwib3B0aW9ucyIsInRpdGxlTm9kZSIsIm15Q2hhbGxlbmdlU3RyaW5nUHJvcGVydHkiLCJmb250IiwibWF4V2lkdGgiLCJhY2Nlc3NpYmxlTmFtZSIsInRpdGxlQWxpZ25YIiwiY29udGVudFhNYXJnaW4iLCJjb250ZW50WU1hcmdpbiIsImNvbnRlbnRZU3BhY2luZyIsImNvcm5lclJhZGl1cyIsImJ1dHRvblhNYXJnaW4iLCJidXR0b25ZTWFyZ2luIiwiZXhwYW5kQ29sbGFwc2VCdXR0b25PcHRpb25zIiwidG91Y2hBcmVhWERpbGF0aW9uIiwidG91Y2hBcmVhWURpbGF0aW9uIiwibW91c2VBcmVhWERpbGF0aW9uIiwibW91c2VBcmVhWURpbGF0aW9uIiwidm9pY2luZ05hbWVSZXNwb25zZSIsInZvaWNpbmdDb250ZXh0UmVzcG9uc2UiLCJ2b2ljaW5nSGludFJlc3BvbnNlIiwiY3JlYXRlIiwibXlDaGFsbGVuZ2VIaW50VGV4dFN0cmluZ1Byb3BlcnR5IiwicmF0aW9VbmxvY2tlZEZyb21NeUNoYWxsZW5nZSIsImFsZXJ0IiwiY29udGV4dFJlc3BvbnNlIiwicmF0aW9Ob0xvbmdlckxvY2tlZFN0cmluZ1Byb3BlcnR5IiwicHJpb3JpdHkiLCJNRURJVU1fUFJJT1JJVFkiLCJjcmVhdGVOdW1iZXJQaWNrZXJDb250ZXh0UmVzcG9uc2UiLCJnZXRUYXJnZXRSYXRpb0NoYW5nZUFsZXJ0IiwiYW50ZWNlZGVudE51bWJlclBpY2tlciIsInNjYWxlIiwiY29sb3IiLCJjZW50ZXIiLCJaRVJPIiwibGVmdFZhbHVlU3RyaW5nUHJvcGVydHkiLCJhMTF5RGVwZW5kZW5jaWVzIiwiYTExeUNyZWF0ZUFyaWFWYWx1ZVRleHQiLCJnZXRXb3JkRnJvbU51bWJlciIsImExMXlDcmVhdGVDb250ZXh0UmVzcG9uc2VBbGVydCIsInZvaWNpbmdPYmplY3RSZXNwb25zZSIsImxlZnRSYXRpb1NlbGVjdG9yIiwiYWxpZ24iLCJzcGFjaW5nIiwiY2hpbGRyZW4iLCJjcmVhdGVJY29uIiwiaGFuZENvbG9yIiwiaGFuZE5vZGVPcHRpb25zIiwicmVnaXN0ZXJVdHRlcmFuY2VUb1ZvaWNpbmdOb2RlIiwiY29uc2VxdWVudE51bWJlclBpY2tlciIsInJpZ2h0VmFsdWVTdHJpbmdQcm9wZXJ0eSIsInJpZ2h0UmF0aW9TZWxlY3RvciIsIm15Q2hhbGxlbmdlQ29udGVudCIsInRhZ05hbWUiLCJkZXNjcmlwdGlvbkNvbnRlbnQiLCJteUNoYWxsZW5nZUhlbHBUZXh0U3RyaW5nUHJvcGVydHkiLCJyZWFkaW5nQmxvY2tPcHRpb25zIiwicmVhZGluZ0Jsb2NrSGludFJlc3BvbnNlIiwibXlDaGFsbGVuZ2VSZWFkaW5nQmxvY2tIaW50VGV4dFN0cmluZ1Byb3BlcnR5IiwicmVhZGluZ0Jsb2NrTmFtZVJlc3BvbnNlIiwicmVhZGluZ0Jsb2NrUmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvbiIsIm5hbWVIaW50IiwicmVhZGluZ0Jsb2NrTm9kZSIsIlJlYWRpbmdCbG9ja05vZGUiLCJwZG9tT3JkZXIiLCJhY2NvcmRpb25Cb3hVdHRlcmFuY2UiLCJsYXp5TGluayIsImFsZXJ0RGVzY3JpcHRpb25VdHRlcmFuY2UiLCJtdWx0aWxpbmsiLCJ0YXJnZXRBbnRlY2VkZW50IiwidGFyZ2V0Q29uc2VxdWVudCIsIndhc0xvY2tlZCIsImFsZXJ0VXR0ZXJhbmNlIiwicmVzZXRNeUNoYWxsZW5nZUFjY29yZGlvbkJveCIsInJlc2V0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJNeUNoYWxsZW5nZUFjY29yZGlvbkJveC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMC0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBbiBBY2NvcmRpb25Cb3ggd2l0aCB0d28gTnVtYmVyUGlja2VycyBpbiBpdCB0aGF0IGRldGVybWluZXMgdGhlIHRhcmdldFJhdGlvUHJvcGVydHkgaW4gdGhlIG1vZGVsIChcIk15IENoYWxsZW5nZVwiIHZhbHVlKS5cclxuICpcclxuICogQGF1dGhvciBNaWNoYWVsIEthdXptYW5uIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IFN0cmljdE9taXQgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1N0cmljdE9taXQuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBGcmFjdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL21vZGVsL0ZyYWN0aW9uLmpzJztcclxuaW1wb3J0IE51bWJlclBpY2tlciBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvTnVtYmVyUGlja2VyLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBIQm94LCBOb2RlLCBOb2RlT3B0aW9ucywgUmVhZGluZ0Jsb2NrLCBSZWFkaW5nQmxvY2tPcHRpb25zLCBSaWNoVGV4dCwgVkJveCwgVm9pY2luZyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBBY3RpdmF0aW9uVXR0ZXJhbmNlIGZyb20gJy4uLy4uLy4uLy4uL3V0dGVyYW5jZS1xdWV1ZS9qcy9BY3RpdmF0aW9uVXR0ZXJhbmNlLmpzJztcclxuaW1wb3J0IFV0dGVyYW5jZSBmcm9tICcuLi8uLi8uLi8uLi91dHRlcmFuY2UtcXVldWUvanMvVXR0ZXJhbmNlLmpzJztcclxuaW1wb3J0IFJhdGlvSGFuZE5vZGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvUmF0aW9IYW5kTm9kZS5qcyc7XHJcbmltcG9ydCByYXRpb0FuZFByb3BvcnRpb24gZnJvbSAnLi4vLi4vcmF0aW9BbmRQcm9wb3J0aW9uLmpzJztcclxuaW1wb3J0IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MgZnJvbSAnLi4vLi4vUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBSYXRpb0Rlc2NyaWJlciBmcm9tICcuLi8uLi9jb21tb24vdmlldy9kZXNjcmliZXJzL1JhdGlvRGVzY3JpYmVyLmpzJztcclxuaW1wb3J0IFRpY2tNYXJrVmlldyBmcm9tICcuLi8uLi9jb21tb24vdmlldy9UaWNrTWFya1ZpZXcuanMnO1xyXG5pbXBvcnQgRW51bWVyYXRpb25Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0VudW1lcmF0aW9uUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQWNjb3JkaW9uQm94LCB7IEFjY29yZGlvbkJveE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvQWNjb3JkaW9uQm94LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgUmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvbiBmcm9tICcuLi8uLi8uLi8uLi91dHRlcmFuY2UtcXVldWUvanMvUmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvbi5qcyc7XHJcbmltcG9ydCBSZXNwb25zZVBhY2tldCBmcm9tICcuLi8uLi8uLi8uLi91dHRlcmFuY2UtcXVldWUvanMvUmVzcG9uc2VQYWNrZXQuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuXHJcbmNvbnN0IFBJQ0tFUl9TQ0FMRSA9IDEuNTtcclxuY29uc3QgSUNPTl9TQ0FMRSA9IDAuOTtcclxuY29uc3QgREVGQVVMVF9FWFBBTkRFRCA9IGZhbHNlO1xyXG5cclxudHlwZSBNeUNoYWxsZW5nZUFjY29yZGlvbkJveE9wdGlvbnMgPSBTdHJpY3RPbWl0PEFjY29yZGlvbkJveE9wdGlvbnMsICdwZG9tT3JkZXInPiAmIFBpY2tSZXF1aXJlZDxBY2NvcmRpb25Cb3hPcHRpb25zLCAndGFuZGVtJz47XHJcblxyXG5jbGFzcyBNeUNoYWxsZW5nZUFjY29yZGlvbkJveCBleHRlbmRzIEFjY29yZGlvbkJveCB7XHJcblxyXG4gIHB1YmxpYyB0YXJnZXRBbnRlY2VkZW50UHJvcGVydHk6IFByb3BlcnR5PG51bWJlcj47XHJcbiAgcHVibGljIHRhcmdldENvbnNlcXVlbnRQcm9wZXJ0eTogUHJvcGVydHk8bnVtYmVyPjtcclxuICBwcml2YXRlIHJlc2V0TXlDaGFsbGVuZ2VBY2NvcmRpb25Cb3g6ICgpID0+IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggdGFyZ2V0UmF0aW9Qcm9wZXJ0eTogUHJvcGVydHk8bnVtYmVyPiwgcmF0aW9Mb2NrZWRQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBoYW5kQ29sb3JQcm9wZXJ0eTogUHJvcGVydHk8Q29sb3I+LCB0aWNrTWFya1ZpZXdQcm9wZXJ0eTogRW51bWVyYXRpb25Qcm9wZXJ0eTxUaWNrTWFya1ZpZXc+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgcmF0aW9EZXNjcmliZXI6IFJhdGlvRGVzY3JpYmVyLCBwcm92aWRlZE9wdGlvbnM6IE15Q2hhbGxlbmdlQWNjb3JkaW9uQm94T3B0aW9ucyApIHtcclxuXHJcblxyXG4gICAgLy8gQWxsb3cgdXMgdG8gZ2V0IHRoZSByZWR1Y2VkIGZyYWN0aW9uIGFzIHRoZSBpbml0aWFsIHZhbHVlIG9mIHRoZSBjdXN0b20gXCJNeSBDaGFsbGVuZ2VcIlxyXG4gICAgY29uc3QgaW5pdGlhbFJhdGlvRnJhY3Rpb24gPSBGcmFjdGlvbi5mcm9tRGVjaW1hbCggdGFyZ2V0UmF0aW9Qcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgY29uc3QgcmFuZ2VQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggbmV3IFJhbmdlKCAxLCAxMCApICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCByYW5nZVByb3BlcnR5LnZhbHVlLmNvbnRhaW5zKCBpbml0aWFsUmF0aW9GcmFjdGlvbi5udW1lcmF0b3IgKSwgJ3Vuc3VwcG9ydGVkIG51bWVyYXRvcicgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHJhbmdlUHJvcGVydHkudmFsdWUuY29udGFpbnMoIGluaXRpYWxSYXRpb0ZyYWN0aW9uLmRlbm9taW5hdG9yICksICd1bnN1cHBvcnRlZCBkZW5vbWluYXRvcicgKTtcclxuXHJcbiAgICBjb25zdCB0YXJnZXRBbnRlY2VkZW50UHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIGluaXRpYWxSYXRpb0ZyYWN0aW9uLm51bWVyYXRvciwge1xyXG4gICAgICB0YW5kZW06IHByb3ZpZGVkT3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndGFyZ2V0QW50ZWNlZGVudFByb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCB0YXJnZXRDb25zZXF1ZW50UHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIGluaXRpYWxSYXRpb0ZyYWN0aW9uLmRlbm9taW5hdG9yLCB7XHJcbiAgICAgIHRhbmRlbTogcHJvdmlkZWRPcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICd0YXJnZXRDb25zZXF1ZW50UHJvcGVydHknIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBleHBhbmRlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggREVGQVVMVF9FWFBBTkRFRCwge1xyXG4gICAgICB0YW5kZW06IHByb3ZpZGVkT3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZXhwYW5kZWRQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGNyZWF0ZUFjY29yZGlvbkJveENvbnRleHRSZXNwb25zZSA9ICgpID0+IHtcclxuICAgICAgcmV0dXJuIGV4cGFuZGVkUHJvcGVydHkudmFsdWUgP1xyXG4gICAgICAgICAgICAgcmF0aW9EZXNjcmliZXIuZ2V0Q3VycmVudENoYWxsZW5nZVNlbnRlbmNlKCB0YXJnZXRBbnRlY2VkZW50UHJvcGVydHkudmFsdWUsIHRhcmdldENvbnNlcXVlbnRQcm9wZXJ0eS52YWx1ZSApIDpcclxuICAgICAgICAgICAgIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS5yYXRpby5jdXJyZW50Q2hhbGxlbmdlSGlkZGVuU3RyaW5nUHJvcGVydHkudmFsdWU7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8TXlDaGFsbGVuZ2VBY2NvcmRpb25Cb3hPcHRpb25zLCBFbXB0eVNlbGZPcHRpb25zLCBBY2NvcmRpb25Cb3hPcHRpb25zPigpKCB7XHJcbiAgICAgIHRpdGxlTm9kZTogbmV3IFJpY2hUZXh0KCBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLm15Q2hhbGxlbmdlU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgICBmb250OiBuZXcgUGhldEZvbnQoIDIwICksXHJcbiAgICAgICAgbWF4V2lkdGg6IDIwMCAvLyBlbXBpcmljYWxseSBkZXRlcm1pbmVkXHJcbiAgICAgIH0gKSxcclxuICAgICAgYWNjZXNzaWJsZU5hbWU6IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MubXlDaGFsbGVuZ2VTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgdGl0bGVBbGlnblg6ICdsZWZ0JyxcclxuICAgICAgY29udGVudFhNYXJnaW46IDI2LFxyXG4gICAgICBjb250ZW50WU1hcmdpbjogMTUsXHJcbiAgICAgIGNvbnRlbnRZU3BhY2luZzogMTUsXHJcblxyXG4gICAgICBtYXhXaWR0aDogMjIwLFxyXG5cclxuICAgICAgLy8gQ29waWVkIGZyb20gTkxDQ29uc3RhbnRzLmpzLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3JhdGlvLWFuZC1wcm9wb3J0aW9uL2lzc3Vlcy81OCNpc3N1ZWNvbW1lbnQtNjQ2Mzc3MzMzXHJcbiAgICAgIGNvcm5lclJhZGl1czogNSxcclxuICAgICAgYnV0dG9uWE1hcmdpbjogMTAsXHJcbiAgICAgIGJ1dHRvbllNYXJnaW46IDEwLFxyXG4gICAgICBleHBhbmRDb2xsYXBzZUJ1dHRvbk9wdGlvbnM6IHtcclxuICAgICAgICB0b3VjaEFyZWFYRGlsYXRpb246IDE1LFxyXG4gICAgICAgIHRvdWNoQXJlYVlEaWxhdGlvbjogMTUsXHJcbiAgICAgICAgbW91c2VBcmVhWERpbGF0aW9uOiA1LFxyXG4gICAgICAgIG1vdXNlQXJlYVlEaWxhdGlvbjogNVxyXG4gICAgICB9LFxyXG4gICAgICBleHBhbmRlZFByb3BlcnR5OiBleHBhbmRlZFByb3BlcnR5LFxyXG5cclxuICAgICAgLy8gdm9pY2luZ1xyXG4gICAgICB2b2ljaW5nTmFtZVJlc3BvbnNlOiBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLm15Q2hhbGxlbmdlU3RyaW5nUHJvcGVydHksXHJcbiAgICAgIHZvaWNpbmdDb250ZXh0UmVzcG9uc2U6IGNyZWF0ZUFjY29yZGlvbkJveENvbnRleHRSZXNwb25zZSxcclxuXHJcbiAgICAgIC8vIE9ubHkgZGVsaXZlciB0aGUgaGludCBpZiBub3QgZXhwYW5kZWQ7IHNpbmNlIGluIGEgY2xvc3VyZSwgdXNlIHRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSBQcm9wZXJ0eS5cclxuICAgICAgdm9pY2luZ0hpbnRSZXNwb25zZTogKCkgPT4gZXhwYW5kZWRQcm9wZXJ0eS52YWx1ZSA/IG51bGwgOiBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkuY3JlYXRlLm15Q2hhbGxlbmdlSGludFRleHRTdHJpbmdQcm9wZXJ0eS52YWx1ZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgcmF0aW9VbmxvY2tlZEZyb21NeUNoYWxsZW5nZSA9IG5ldyBVdHRlcmFuY2UoIHtcclxuICAgICAgYWxlcnQ6IG5ldyBSZXNwb25zZVBhY2tldCgge1xyXG4gICAgICAgIGNvbnRleHRSZXNwb25zZTogUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnJhdGlvTm9Mb25nZXJMb2NrZWRTdHJpbmdQcm9wZXJ0eVxyXG4gICAgICB9ICksXHJcbiAgICAgIHByaW9yaXR5OiBVdHRlcmFuY2UuTUVESVVNX1BSSU9SSVRZXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgY3JlYXRlTnVtYmVyUGlja2VyQ29udGV4dFJlc3BvbnNlID0gKCkgPT4gcmF0aW9EZXNjcmliZXIuZ2V0VGFyZ2V0UmF0aW9DaGFuZ2VBbGVydCggdGFyZ2V0QW50ZWNlZGVudFByb3BlcnR5LnZhbHVlLCB0YXJnZXRDb25zZXF1ZW50UHJvcGVydHkudmFsdWUgKTtcclxuXHJcbiAgICBjb25zdCBhbnRlY2VkZW50TnVtYmVyUGlja2VyID0gbmV3IE51bWJlclBpY2tlciggdGFyZ2V0QW50ZWNlZGVudFByb3BlcnR5LCByYW5nZVByb3BlcnR5LCB7XHJcbiAgICAgIHNjYWxlOiBQSUNLRVJfU0NBTEUsXHJcbiAgICAgIGNvbG9yOiBoYW5kQ29sb3JQcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgY2VudGVyOiBWZWN0b3IyLlpFUk8sXHJcbiAgICAgIGFjY2Vzc2libGVOYW1lOiBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkubGVmdFZhbHVlU3RyaW5nUHJvcGVydHksXHJcbiAgICAgIGExMXlEZXBlbmRlbmNpZXM6IFsgdGFyZ2V0Q29uc2VxdWVudFByb3BlcnR5IF0sXHJcbiAgICAgIGExMXlDcmVhdGVBcmlhVmFsdWVUZXh0OiByYXRpb0Rlc2NyaWJlci5nZXRXb3JkRnJvbU51bWJlcixcclxuICAgICAgYTExeUNyZWF0ZUNvbnRleHRSZXNwb25zZUFsZXJ0OiBjcmVhdGVOdW1iZXJQaWNrZXJDb250ZXh0UmVzcG9uc2UsXHJcblxyXG4gICAgICAvLyB2b2ljaW5nXHJcbiAgICAgIHZvaWNpbmdOYW1lUmVzcG9uc2U6IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS5sZWZ0VmFsdWVTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgdm9pY2luZ09iamVjdFJlc3BvbnNlOiAoKSA9PiByYXRpb0Rlc2NyaWJlci5nZXRXb3JkRnJvbU51bWJlciggdGFyZ2V0QW50ZWNlZGVudFByb3BlcnR5LnZhbHVlICksXHJcbiAgICAgIHZvaWNpbmdDb250ZXh0UmVzcG9uc2U6IGNyZWF0ZU51bWJlclBpY2tlckNvbnRleHRSZXNwb25zZSxcclxuXHJcbiAgICAgIC8vIHBoZXQtaW9cclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdhbnRlY2VkZW50TnVtYmVyUGlja2VyJyApXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBsZWZ0UmF0aW9TZWxlY3RvciA9IG5ldyBWQm94KCB7XHJcbiAgICAgIGFsaWduOiAnb3JpZ2luJyxcclxuICAgICAgc3BhY2luZzogMTAsXHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgUmF0aW9IYW5kTm9kZS5jcmVhdGVJY29uKCBmYWxzZSwgdGlja01hcmtWaWV3UHJvcGVydHksIHtcclxuICAgICAgICAgIGhhbmRDb2xvcjogaGFuZENvbG9yUHJvcGVydHkudmFsdWUsIGhhbmROb2RlT3B0aW9uczogeyBzY2FsZTogSUNPTl9TQ0FMRSB9XHJcbiAgICAgICAgfSApLFxyXG4gICAgICAgIG5ldyBOb2RlKCB7IGNoaWxkcmVuOiBbIGFudGVjZWRlbnROdW1iZXJQaWNrZXIgXSB9ICkgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIFZvaWNpbmcucmVnaXN0ZXJVdHRlcmFuY2VUb1ZvaWNpbmdOb2RlKCByYXRpb1VubG9ja2VkRnJvbU15Q2hhbGxlbmdlLCBhbnRlY2VkZW50TnVtYmVyUGlja2VyICk7XHJcblxyXG4gICAgY29uc3QgY29uc2VxdWVudE51bWJlclBpY2tlciA9IG5ldyBOdW1iZXJQaWNrZXIoIHRhcmdldENvbnNlcXVlbnRQcm9wZXJ0eSwgcmFuZ2VQcm9wZXJ0eSwge1xyXG4gICAgICBzY2FsZTogUElDS0VSX1NDQUxFLFxyXG4gICAgICBjb2xvcjogaGFuZENvbG9yUHJvcGVydHkudmFsdWUsXHJcbiAgICAgIGNlbnRlcjogVmVjdG9yMi5aRVJPLFxyXG4gICAgICBhY2Nlc3NpYmxlTmFtZTogUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnJpZ2h0VmFsdWVTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgYTExeURlcGVuZGVuY2llczogWyB0YXJnZXRBbnRlY2VkZW50UHJvcGVydHkgXSxcclxuICAgICAgYTExeUNyZWF0ZUFyaWFWYWx1ZVRleHQ6IHJhdGlvRGVzY3JpYmVyLmdldFdvcmRGcm9tTnVtYmVyLFxyXG4gICAgICBhMTF5Q3JlYXRlQ29udGV4dFJlc3BvbnNlQWxlcnQ6IGNyZWF0ZU51bWJlclBpY2tlckNvbnRleHRSZXNwb25zZSxcclxuXHJcbiAgICAgIC8vIHZvaWNpbmdcclxuICAgICAgdm9pY2luZ05hbWVSZXNwb25zZTogUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnJpZ2h0VmFsdWVTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgdm9pY2luZ09iamVjdFJlc3BvbnNlOiAoKSA9PiByYXRpb0Rlc2NyaWJlci5nZXRXb3JkRnJvbU51bWJlciggdGFyZ2V0Q29uc2VxdWVudFByb3BlcnR5LnZhbHVlICksXHJcbiAgICAgIHZvaWNpbmdDb250ZXh0UmVzcG9uc2U6IGNyZWF0ZU51bWJlclBpY2tlckNvbnRleHRSZXNwb25zZSxcclxuXHJcbiAgICAgIC8vIHBoZXQtaW9cclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdjb25zZXF1ZW50TnVtYmVyUGlja2VyJyApXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCByaWdodFJhdGlvU2VsZWN0b3IgPSBuZXcgVkJveCgge1xyXG4gICAgICBhbGlnbjogJ29yaWdpbicsXHJcbiAgICAgIHNwYWNpbmc6IDEwLFxyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIFJhdGlvSGFuZE5vZGUuY3JlYXRlSWNvbiggdHJ1ZSwgdGlja01hcmtWaWV3UHJvcGVydHksIHtcclxuICAgICAgICAgIGhhbmRDb2xvcjogaGFuZENvbG9yUHJvcGVydHkudmFsdWUsIGhhbmROb2RlT3B0aW9uczogeyBzY2FsZTogSUNPTl9TQ0FMRSB9XHJcbiAgICAgICAgfSApLFxyXG4gICAgICAgIG5ldyBOb2RlKCB7IGNoaWxkcmVuOiBbIGNvbnNlcXVlbnROdW1iZXJQaWNrZXIgXSB9ICkgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IG15Q2hhbGxlbmdlQ29udGVudCA9IG5ldyBIQm94KCB7XHJcbiAgICAgIHNwYWNpbmc6IDQwLFxyXG4gICAgICB0YWdOYW1lOiAnZGl2JyxcclxuICAgICAgZGVzY3JpcHRpb25Db250ZW50OiBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkuY3JlYXRlLm15Q2hhbGxlbmdlSGVscFRleHRTdHJpbmdQcm9wZXJ0eSwgLy8gaGVscCB0ZXh0IGZvciB0aGUgY29udGVudFxyXG4gICAgICBjaGlsZHJlbjogWyBsZWZ0UmF0aW9TZWxlY3RvciwgcmlnaHRSYXRpb1NlbGVjdG9yIF1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBBdCB0aGlzIHRpbWUsIG1peGVkIGluIE5vZGVzIGNhbid0IHRha2UgbWl4aW4gb3B0aW9ucyBwYXNzZWQgdmlhIG9iamVjdCBsaXRlcmFsLCBpdCBhc3N1bWVzIHRoYXQgdGhlIE9iamVjdFxyXG4gICAgLy8gdHlwZSBpcyBOb2RlT3B0aW9ucy5cclxuICAgIGNvbnN0IHJlYWRpbmdCbG9ja09wdGlvbnM6IFJlYWRpbmdCbG9ja09wdGlvbnMgJiBOb2RlT3B0aW9ucyA9IHtcclxuICAgICAgY2hpbGRyZW46IFsgbXlDaGFsbGVuZ2VDb250ZW50IF0sXHJcbiAgICAgIHJlYWRpbmdCbG9ja0hpbnRSZXNwb25zZTogUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LmNyZWF0ZS5teUNoYWxsZW5nZVJlYWRpbmdCbG9ja0hpbnRUZXh0U3RyaW5nUHJvcGVydHksXHJcbiAgICAgIHJlYWRpbmdCbG9ja05hbWVSZXNwb25zZTogY3JlYXRlQWNjb3JkaW9uQm94Q29udGV4dFJlc3BvbnNlLFxyXG4gICAgICByZWFkaW5nQmxvY2tSZXNwb25zZVBhdHRlcm5Db2xsZWN0aW9uOiBuZXcgUmVzcG9uc2VQYXR0ZXJuQ29sbGVjdGlvbigge1xyXG4gICAgICAgIG5hbWVIaW50OiAne3tOQU1FfX0ge3tISU5UfX0nXHJcbiAgICAgIH0gKVxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByZWFkaW5nQmxvY2tOb2RlID0gbmV3IFJlYWRpbmdCbG9ja05vZGUoIHJlYWRpbmdCbG9ja09wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBXZSBuZWVkIGFuIGV4dHJhIG5vZGUgaGVyZSBpbiBvcmRlciB0byBzZXQgUERPTU9yZGVyIGJlY2F1c2UgQWNjb3JkaW9uZ0JveCBzZXQncyBQRE9NIG9yZGVyIGZvciBpdCdzIGNvbnRlbnRcclxuICAgIHN1cGVyKCBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogWyByZWFkaW5nQmxvY2tOb2RlIF0sXHJcbiAgICAgIHBkb21PcmRlcjogWyBteUNoYWxsZW5nZUNvbnRlbnQsIHJlYWRpbmdCbG9ja05vZGUgXVxyXG4gICAgfSApLCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy50YXJnZXRBbnRlY2VkZW50UHJvcGVydHkgPSB0YXJnZXRBbnRlY2VkZW50UHJvcGVydHk7XHJcbiAgICB0aGlzLnRhcmdldENvbnNlcXVlbnRQcm9wZXJ0eSA9IHRhcmdldENvbnNlcXVlbnRQcm9wZXJ0eTtcclxuXHJcbiAgICBjb25zdCBhY2NvcmRpb25Cb3hVdHRlcmFuY2UgPSBuZXcgQWN0aXZhdGlvblV0dGVyYW5jZSgpO1xyXG4gICAgdGhpcy5leHBhbmRlZFByb3BlcnR5LmxhenlMaW5rKCAoKSA9PiB7XHJcbiAgICAgIGFjY29yZGlvbkJveFV0dGVyYW5jZS5hbGVydCA9IGNyZWF0ZUFjY29yZGlvbkJveENvbnRleHRSZXNwb25zZSgpO1xyXG4gICAgICB0aGlzLmFsZXJ0RGVzY3JpcHRpb25VdHRlcmFuY2UoIGFjY29yZGlvbkJveFV0dGVyYW5jZSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFsgdGFyZ2V0QW50ZWNlZGVudFByb3BlcnR5LCB0YXJnZXRDb25zZXF1ZW50UHJvcGVydHkgXSxcclxuICAgICAgKCB0YXJnZXRBbnRlY2VkZW50LCB0YXJnZXRDb25zZXF1ZW50ICkgPT4ge1xyXG5cclxuICAgICAgICBjb25zdCB3YXNMb2NrZWQgPSByYXRpb0xvY2tlZFByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgICAgICB0YXJnZXRSYXRpb1Byb3BlcnR5LnZhbHVlID0gdGFyZ2V0QW50ZWNlZGVudCAvIHRhcmdldENvbnNlcXVlbnQ7XHJcblxyXG4gICAgICAgIC8vIGlmIGN1cnJlbnRseSBsb2NrZWQsIHRoZW4gaXQgaXMgYWJvdXQgdG8gYmUgdW5sb2NrZWRcclxuICAgICAgICBpZiAoIHdhc0xvY2tlZCAmJiAhcmF0aW9Mb2NrZWRQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICAgIHRoaXMuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggcmF0aW9VbmxvY2tlZEZyb21NeUNoYWxsZW5nZSApO1xyXG4gICAgICAgICAgVm9pY2luZy5hbGVydFV0dGVyYW5jZSggcmF0aW9VbmxvY2tlZEZyb21NeUNoYWxsZW5nZSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG5cclxuICAgIHRoaXMucmVzZXRNeUNoYWxsZW5nZUFjY29yZGlvbkJveCA9ICgpID0+IHtcclxuICAgICAgdGhpcy5leHBhbmRlZFByb3BlcnR5LnZhbHVlID0gREVGQVVMVF9FWFBBTkRFRDtcclxuXHJcbiAgICAgIHRoaXMudGFyZ2V0QW50ZWNlZGVudFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICAgIHRoaXMudGFyZ2V0Q29uc2VxdWVudFByb3BlcnR5LnJlc2V0KCk7XHJcblxyXG4gICAgICByYXRpb1VubG9ja2VkRnJvbU15Q2hhbGxlbmdlLnJlc2V0KCk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgc3VwZXIucmVzZXQoKTtcclxuICAgIHRoaXMucmVzZXRNeUNoYWxsZW5nZUFjY29yZGlvbkJveCgpO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgUmVhZGluZ0Jsb2NrTm9kZSBleHRlbmRzIFJlYWRpbmdCbG9jayggTm9kZSApIHt9XHJcblxyXG5yYXRpb0FuZFByb3BvcnRpb24ucmVnaXN0ZXIoICdNeUNoYWxsZW5nZUFjY29yZGlvbkJveCcsIE15Q2hhbGxlbmdlQWNjb3JkaW9uQm94ICk7XHJcbmV4cG9ydCBkZWZhdWx0IE15Q2hhbGxlbmdlQWNjb3JkaW9uQm94OyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxjQUFjLE1BQU0sdUNBQXVDO0FBRWxFLE9BQU9DLFFBQVEsTUFBTSxpQ0FBaUM7QUFDdEQsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLFFBQVEsTUFBTSw2Q0FBNkM7QUFDbEUsT0FBT0MsWUFBWSxNQUFNLG9DQUFvQztBQUM3RCxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQWdCQyxJQUFJLEVBQUVDLElBQUksRUFBZUMsWUFBWSxFQUF1QkMsUUFBUSxFQUFFQyxJQUFJLEVBQUVDLE9BQU8sUUFBUSxtQ0FBbUM7QUFDOUksT0FBT0MsbUJBQW1CLE1BQU0sdURBQXVEO0FBQ3ZGLE9BQU9DLFNBQVMsTUFBTSw2Q0FBNkM7QUFDbkUsT0FBT0MsYUFBYSxNQUFNLG9DQUFvQztBQUM5RCxPQUFPQyxrQkFBa0IsTUFBTSw2QkFBNkI7QUFDNUQsT0FBT0MseUJBQXlCLE1BQU0sb0NBQW9DO0FBSTFFLE9BQU9DLFlBQVksTUFBK0Isb0NBQW9DO0FBQ3RGLE9BQU9DLFNBQVMsTUFBNEIsdUNBQXVDO0FBQ25GLE9BQU9DLGVBQWUsTUFBTSx3Q0FBd0M7QUFFcEUsT0FBT0MseUJBQXlCLE1BQU0sNkRBQTZEO0FBQ25HLE9BQU9DLGNBQWMsTUFBTSxrREFBa0Q7QUFDN0UsT0FBT0MsU0FBUyxNQUFNLGtDQUFrQztBQUV4RCxNQUFNQyxZQUFZLEdBQUcsR0FBRztBQUN4QixNQUFNQyxVQUFVLEdBQUcsR0FBRztBQUN0QixNQUFNQyxnQkFBZ0IsR0FBRyxLQUFLO0FBSTlCLE1BQU1DLHVCQUF1QixTQUFTVCxZQUFZLENBQUM7RUFNMUNVLFdBQVdBLENBQUVDLG1CQUFxQyxFQUFFQyxtQkFBc0MsRUFDN0VDLGlCQUFrQyxFQUFFQyxvQkFBdUQsRUFDM0ZDLGNBQThCLEVBQUVDLGVBQStDLEVBQUc7SUFHcEc7SUFDQSxNQUFNQyxvQkFBb0IsR0FBRy9CLFFBQVEsQ0FBQ2dDLFdBQVcsQ0FBRVAsbUJBQW1CLENBQUNRLEtBQU0sQ0FBQztJQUM5RSxNQUFNQyxhQUFhLEdBQUcsSUFBSXJDLFFBQVEsQ0FBRSxJQUFJQyxLQUFLLENBQUUsQ0FBQyxFQUFFLEVBQUcsQ0FBRSxDQUFDO0lBQ3hEcUMsTUFBTSxJQUFJQSxNQUFNLENBQUVELGFBQWEsQ0FBQ0QsS0FBSyxDQUFDRyxRQUFRLENBQUVMLG9CQUFvQixDQUFDTSxTQUFVLENBQUMsRUFBRSx1QkFBd0IsQ0FBQztJQUMzR0YsTUFBTSxJQUFJQSxNQUFNLENBQUVELGFBQWEsQ0FBQ0QsS0FBSyxDQUFDRyxRQUFRLENBQUVMLG9CQUFvQixDQUFDTyxXQUFZLENBQUMsRUFBRSx5QkFBMEIsQ0FBQztJQUUvRyxNQUFNQyx3QkFBd0IsR0FBRyxJQUFJM0MsY0FBYyxDQUFFbUMsb0JBQW9CLENBQUNNLFNBQVMsRUFBRTtNQUNuRkcsTUFBTSxFQUFFVixlQUFlLENBQUNVLE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLDBCQUEyQjtJQUMxRSxDQUFFLENBQUM7SUFDSCxNQUFNQyx3QkFBd0IsR0FBRyxJQUFJOUMsY0FBYyxDQUFFbUMsb0JBQW9CLENBQUNPLFdBQVcsRUFBRTtNQUNyRkUsTUFBTSxFQUFFVixlQUFlLENBQUNVLE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLDBCQUEyQjtJQUMxRSxDQUFFLENBQUM7SUFFSCxNQUFNRSxnQkFBZ0IsR0FBRyxJQUFJM0IsZUFBZSxDQUFFTSxnQkFBZ0IsRUFBRTtNQUM5RGtCLE1BQU0sRUFBRVYsZUFBZSxDQUFDVSxNQUFNLENBQUNDLFlBQVksQ0FBRSxrQkFBbUI7SUFDbEUsQ0FBRSxDQUFDO0lBRUgsTUFBTUcsaUNBQWlDLEdBQUdBLENBQUEsS0FBTTtNQUM5QyxPQUFPRCxnQkFBZ0IsQ0FBQ1YsS0FBSyxHQUN0QkosY0FBYyxDQUFDZ0IsMkJBQTJCLENBQUVOLHdCQUF3QixDQUFDTixLQUFLLEVBQUVTLHdCQUF3QixDQUFDVCxLQUFNLENBQUMsR0FDNUdwQix5QkFBeUIsQ0FBQ2lDLElBQUksQ0FBQ0MsS0FBSyxDQUFDQyxvQ0FBb0MsQ0FBQ2YsS0FBSztJQUN4RixDQUFDO0lBRUQsTUFBTWdCLE9BQU8sR0FBR2xDLFNBQVMsQ0FBd0UsQ0FBQyxDQUFFO01BQ2xHbUMsU0FBUyxFQUFFLElBQUk1QyxRQUFRLENBQUVPLHlCQUF5QixDQUFDc0MseUJBQXlCLEVBQUU7UUFDNUVDLElBQUksRUFBRSxJQUFJbEQsUUFBUSxDQUFFLEVBQUcsQ0FBQztRQUN4Qm1ELFFBQVEsRUFBRSxHQUFHLENBQUM7TUFDaEIsQ0FBRSxDQUFDOztNQUNIQyxjQUFjLEVBQUV6Qyx5QkFBeUIsQ0FBQ3NDLHlCQUF5QjtNQUNuRUksV0FBVyxFQUFFLE1BQU07TUFDbkJDLGNBQWMsRUFBRSxFQUFFO01BQ2xCQyxjQUFjLEVBQUUsRUFBRTtNQUNsQkMsZUFBZSxFQUFFLEVBQUU7TUFFbkJMLFFBQVEsRUFBRSxHQUFHO01BRWI7TUFDQU0sWUFBWSxFQUFFLENBQUM7TUFDZkMsYUFBYSxFQUFFLEVBQUU7TUFDakJDLGFBQWEsRUFBRSxFQUFFO01BQ2pCQywyQkFBMkIsRUFBRTtRQUMzQkMsa0JBQWtCLEVBQUUsRUFBRTtRQUN0QkMsa0JBQWtCLEVBQUUsRUFBRTtRQUN0QkMsa0JBQWtCLEVBQUUsQ0FBQztRQUNyQkMsa0JBQWtCLEVBQUU7TUFDdEIsQ0FBQztNQUNEdkIsZ0JBQWdCLEVBQUVBLGdCQUFnQjtNQUVsQztNQUNBd0IsbUJBQW1CLEVBQUV0RCx5QkFBeUIsQ0FBQ3NDLHlCQUF5QjtNQUN4RWlCLHNCQUFzQixFQUFFeEIsaUNBQWlDO01BRXpEO01BQ0F5QixtQkFBbUIsRUFBRUEsQ0FBQSxLQUFNMUIsZ0JBQWdCLENBQUNWLEtBQUssR0FBRyxJQUFJLEdBQUdwQix5QkFBeUIsQ0FBQ2lDLElBQUksQ0FBQ3dCLE1BQU0sQ0FBQ0MsaUNBQWlDLENBQUN0QztJQUNySSxDQUFDLEVBQUVILGVBQWdCLENBQUM7SUFFcEIsTUFBTTBDLDRCQUE0QixHQUFHLElBQUk5RCxTQUFTLENBQUU7TUFDbEQrRCxLQUFLLEVBQUUsSUFBSXZELGNBQWMsQ0FBRTtRQUN6QndELGVBQWUsRUFBRTdELHlCQUF5QixDQUFDaUMsSUFBSSxDQUFDNkI7TUFDbEQsQ0FBRSxDQUFDO01BQ0hDLFFBQVEsRUFBRWxFLFNBQVMsQ0FBQ21FO0lBQ3RCLENBQUUsQ0FBQztJQUVILE1BQU1DLGlDQUFpQyxHQUFHQSxDQUFBLEtBQU1qRCxjQUFjLENBQUNrRCx5QkFBeUIsQ0FBRXhDLHdCQUF3QixDQUFDTixLQUFLLEVBQUVTLHdCQUF3QixDQUFDVCxLQUFNLENBQUM7SUFFMUosTUFBTStDLHNCQUFzQixHQUFHLElBQUkvRSxZQUFZLENBQUVzQyx3QkFBd0IsRUFBRUwsYUFBYSxFQUFFO01BQ3hGK0MsS0FBSyxFQUFFN0QsWUFBWTtNQUNuQjhELEtBQUssRUFBRXZELGlCQUFpQixDQUFDTSxLQUFLO01BQzlCa0QsTUFBTSxFQUFFcEYsT0FBTyxDQUFDcUYsSUFBSTtNQUNwQjlCLGNBQWMsRUFBRXpDLHlCQUF5QixDQUFDaUMsSUFBSSxDQUFDdUMsdUJBQXVCO01BQ3RFQyxnQkFBZ0IsRUFBRSxDQUFFNUMsd0JBQXdCLENBQUU7TUFDOUM2Qyx1QkFBdUIsRUFBRTFELGNBQWMsQ0FBQzJELGlCQUFpQjtNQUN6REMsOEJBQThCLEVBQUVYLGlDQUFpQztNQUVqRTtNQUNBWCxtQkFBbUIsRUFBRXRELHlCQUF5QixDQUFDaUMsSUFBSSxDQUFDdUMsdUJBQXVCO01BQzNFSyxxQkFBcUIsRUFBRUEsQ0FBQSxLQUFNN0QsY0FBYyxDQUFDMkQsaUJBQWlCLENBQUVqRCx3QkFBd0IsQ0FBQ04sS0FBTSxDQUFDO01BQy9GbUMsc0JBQXNCLEVBQUVVLGlDQUFpQztNQUV6RDtNQUNBdEMsTUFBTSxFQUFFUyxPQUFPLENBQUNULE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLHdCQUF5QjtJQUNoRSxDQUFFLENBQUM7SUFDSCxNQUFNa0QsaUJBQWlCLEdBQUcsSUFBSXBGLElBQUksQ0FBRTtNQUNsQ3FGLEtBQUssRUFBRSxRQUFRO01BQ2ZDLE9BQU8sRUFBRSxFQUFFO01BQ1hDLFFBQVEsRUFBRSxDQUNSbkYsYUFBYSxDQUFDb0YsVUFBVSxDQUFFLEtBQUssRUFBRW5FLG9CQUFvQixFQUFFO1FBQ3JEb0UsU0FBUyxFQUFFckUsaUJBQWlCLENBQUNNLEtBQUs7UUFBRWdFLGVBQWUsRUFBRTtVQUFFaEIsS0FBSyxFQUFFNUQ7UUFBVztNQUMzRSxDQUFFLENBQUMsRUFDSCxJQUFJakIsSUFBSSxDQUFFO1FBQUUwRixRQUFRLEVBQUUsQ0FBRWQsc0JBQXNCO01BQUcsQ0FBRSxDQUFDO0lBQ3hELENBQUUsQ0FBQztJQUVIeEUsT0FBTyxDQUFDMEYsOEJBQThCLENBQUUxQiw0QkFBNEIsRUFBRVEsc0JBQXVCLENBQUM7SUFFOUYsTUFBTW1CLHNCQUFzQixHQUFHLElBQUlsRyxZQUFZLENBQUV5Qyx3QkFBd0IsRUFBRVIsYUFBYSxFQUFFO01BQ3hGK0MsS0FBSyxFQUFFN0QsWUFBWTtNQUNuQjhELEtBQUssRUFBRXZELGlCQUFpQixDQUFDTSxLQUFLO01BQzlCa0QsTUFBTSxFQUFFcEYsT0FBTyxDQUFDcUYsSUFBSTtNQUNwQjlCLGNBQWMsRUFBRXpDLHlCQUF5QixDQUFDaUMsSUFBSSxDQUFDc0Qsd0JBQXdCO01BQ3ZFZCxnQkFBZ0IsRUFBRSxDQUFFL0Msd0JBQXdCLENBQUU7TUFDOUNnRCx1QkFBdUIsRUFBRTFELGNBQWMsQ0FBQzJELGlCQUFpQjtNQUN6REMsOEJBQThCLEVBQUVYLGlDQUFpQztNQUVqRTtNQUNBWCxtQkFBbUIsRUFBRXRELHlCQUF5QixDQUFDaUMsSUFBSSxDQUFDc0Qsd0JBQXdCO01BQzVFVixxQkFBcUIsRUFBRUEsQ0FBQSxLQUFNN0QsY0FBYyxDQUFDMkQsaUJBQWlCLENBQUU5Qyx3QkFBd0IsQ0FBQ1QsS0FBTSxDQUFDO01BQy9GbUMsc0JBQXNCLEVBQUVVLGlDQUFpQztNQUV6RDtNQUNBdEMsTUFBTSxFQUFFUyxPQUFPLENBQUNULE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLHdCQUF5QjtJQUNoRSxDQUFFLENBQUM7SUFDSCxNQUFNNEQsa0JBQWtCLEdBQUcsSUFBSTlGLElBQUksQ0FBRTtNQUNuQ3FGLEtBQUssRUFBRSxRQUFRO01BQ2ZDLE9BQU8sRUFBRSxFQUFFO01BQ1hDLFFBQVEsRUFBRSxDQUNSbkYsYUFBYSxDQUFDb0YsVUFBVSxDQUFFLElBQUksRUFBRW5FLG9CQUFvQixFQUFFO1FBQ3BEb0UsU0FBUyxFQUFFckUsaUJBQWlCLENBQUNNLEtBQUs7UUFBRWdFLGVBQWUsRUFBRTtVQUFFaEIsS0FBSyxFQUFFNUQ7UUFBVztNQUMzRSxDQUFFLENBQUMsRUFDSCxJQUFJakIsSUFBSSxDQUFFO1FBQUUwRixRQUFRLEVBQUUsQ0FBRUssc0JBQXNCO01BQUcsQ0FBRSxDQUFDO0lBQ3hELENBQUUsQ0FBQztJQUVILE1BQU1HLGtCQUFrQixHQUFHLElBQUluRyxJQUFJLENBQUU7TUFDbkMwRixPQUFPLEVBQUUsRUFBRTtNQUNYVSxPQUFPLEVBQUUsS0FBSztNQUNkQyxrQkFBa0IsRUFBRTNGLHlCQUF5QixDQUFDaUMsSUFBSSxDQUFDd0IsTUFBTSxDQUFDbUMsaUNBQWlDO01BQUU7TUFDN0ZYLFFBQVEsRUFBRSxDQUFFSCxpQkFBaUIsRUFBRVUsa0JBQWtCO0lBQ25ELENBQUUsQ0FBQzs7SUFFSDtJQUNBO0lBQ0EsTUFBTUssbUJBQXNELEdBQUc7TUFDN0RaLFFBQVEsRUFBRSxDQUFFUSxrQkFBa0IsQ0FBRTtNQUNoQ0ssd0JBQXdCLEVBQUU5Rix5QkFBeUIsQ0FBQ2lDLElBQUksQ0FBQ3dCLE1BQU0sQ0FBQ3NDLDZDQUE2QztNQUM3R0Msd0JBQXdCLEVBQUVqRSxpQ0FBaUM7TUFDM0RrRSxxQ0FBcUMsRUFBRSxJQUFJN0YseUJBQXlCLENBQUU7UUFDcEU4RixRQUFRLEVBQUU7TUFDWixDQUFFO0lBQ0osQ0FBQztJQUVELE1BQU1DLGdCQUFnQixHQUFHLElBQUlDLGdCQUFnQixDQUFFUCxtQkFBb0IsQ0FBQzs7SUFFcEU7SUFDQSxLQUFLLENBQUUsSUFBSXRHLElBQUksQ0FBRTtNQUNmMEYsUUFBUSxFQUFFLENBQUVrQixnQkFBZ0IsQ0FBRTtNQUM5QkUsU0FBUyxFQUFFLENBQUVaLGtCQUFrQixFQUFFVSxnQkFBZ0I7SUFDbkQsQ0FBRSxDQUFDLEVBQUUvRCxPQUFRLENBQUM7SUFFZCxJQUFJLENBQUNWLHdCQUF3QixHQUFHQSx3QkFBd0I7SUFDeEQsSUFBSSxDQUFDRyx3QkFBd0IsR0FBR0Esd0JBQXdCO0lBRXhELE1BQU15RSxxQkFBcUIsR0FBRyxJQUFJMUcsbUJBQW1CLENBQUMsQ0FBQztJQUN2RCxJQUFJLENBQUNrQyxnQkFBZ0IsQ0FBQ3lFLFFBQVEsQ0FBRSxNQUFNO01BQ3BDRCxxQkFBcUIsQ0FBQzFDLEtBQUssR0FBRzdCLGlDQUFpQyxDQUFDLENBQUM7TUFDakUsSUFBSSxDQUFDeUUseUJBQXlCLENBQUVGLHFCQUFzQixDQUFDO0lBQ3pELENBQUUsQ0FBQztJQUVIaEcsU0FBUyxDQUFDbUcsU0FBUyxDQUFFLENBQUUvRSx3QkFBd0IsRUFBRUcsd0JBQXdCLENBQUUsRUFDekUsQ0FBRTZFLGdCQUFnQixFQUFFQyxnQkFBZ0IsS0FBTTtNQUV4QyxNQUFNQyxTQUFTLEdBQUcvRixtQkFBbUIsQ0FBQ08sS0FBSztNQUUzQ1IsbUJBQW1CLENBQUNRLEtBQUssR0FBR3NGLGdCQUFnQixHQUFHQyxnQkFBZ0I7O01BRS9EO01BQ0EsSUFBS0MsU0FBUyxJQUFJLENBQUMvRixtQkFBbUIsQ0FBQ08sS0FBSyxFQUFHO1FBQzdDLElBQUksQ0FBQ29GLHlCQUF5QixDQUFFN0MsNEJBQTZCLENBQUM7UUFDOURoRSxPQUFPLENBQUNrSCxjQUFjLENBQUVsRCw0QkFBNkIsQ0FBQztNQUN4RDtJQUNGLENBQUUsQ0FBQztJQUVMLElBQUksQ0FBQ21ELDRCQUE0QixHQUFHLE1BQU07TUFDeEMsSUFBSSxDQUFDaEYsZ0JBQWdCLENBQUNWLEtBQUssR0FBR1gsZ0JBQWdCO01BRTlDLElBQUksQ0FBQ2lCLHdCQUF3QixDQUFDcUYsS0FBSyxDQUFDLENBQUM7TUFDckMsSUFBSSxDQUFDbEYsd0JBQXdCLENBQUNrRixLQUFLLENBQUMsQ0FBQztNQUVyQ3BELDRCQUE0QixDQUFDb0QsS0FBSyxDQUFDLENBQUM7SUFDdEMsQ0FBQztFQUNIO0VBRWdCQSxLQUFLQSxDQUFBLEVBQVM7SUFDNUIsS0FBSyxDQUFDQSxLQUFLLENBQUMsQ0FBQztJQUNiLElBQUksQ0FBQ0QsNEJBQTRCLENBQUMsQ0FBQztFQUNyQztBQUNGO0FBRUEsTUFBTVYsZ0JBQWdCLFNBQVM1RyxZQUFZLENBQUVELElBQUssQ0FBQyxDQUFDO0FBRXBEUSxrQkFBa0IsQ0FBQ2lILFFBQVEsQ0FBRSx5QkFBeUIsRUFBRXRHLHVCQUF3QixDQUFDO0FBQ2pGLGVBQWVBLHVCQUF1QiJ9