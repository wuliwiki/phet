// Copyright 2020-2022, University of Colorado Boulder

/**
 * Node that holds the PDOM content for the screen summary in the Create screen. It also creates content for the voicing
 * overview buttons as appropriate.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import { Node } from '../../../../scenery/js/imports.js';
import ratioAndProportion from '../../ratioAndProportion.js';
import RatioAndProportionStrings from '../../RatioAndProportionStrings.js';
import BackgroundColorHandler from '../../common/view/BackgroundColorHandler.js';
import Multilink from '../../../../axon/js/Multilink.js';
class CreateScreenSummaryNode extends Node {
  constructor(ratioFitnessProperty, ratioTupleProperty, tickMarkViewProperty, ratioDescriber, inProportionProperty, handPositionsDescriber, tickMarkRangeProperty, myChallengeAccordionBox) {
    const stateOfSimNode = new Node({
      tagName: 'p'
    });
    const leftHandBullet = new Node({
      tagName: 'li'
    });
    const rightHandBullet = new Node({
      tagName: 'li'
    });
    const currentChallengeBullet = new Node({
      tagName: 'li'
    });
    const descriptionBullets = new Node({
      tagName: 'ul',
      children: [leftHandBullet, rightHandBullet]
    });
    super({
      children: [new Node({
        tagName: 'p',
        innerContent: RatioAndProportionStrings.a11y.create.screenSummary.paragraph1StringProperty
      }), new Node({
        tagName: 'p',
        innerContent: RatioAndProportionStrings.a11y.create.screenSummary.paragraph2StringProperty
      }), new Node({
        tagName: 'p',
        innerContent: RatioAndProportionStrings.a11y.screenSummaryControlAreaParagraphStringProperty
      }), stateOfSimNode, descriptionBullets, new Node({
        tagName: 'p',
        innerContent: RatioAndProportionStrings.a11y.create.screenSummary.interactionHintStringProperty
      })]
    });
    this.handPositionsDescriber = handPositionsDescriber;
    this.ratioDescriber = ratioDescriber;
    this.tickMarkViewProperty = tickMarkViewProperty;
    this.ratioTupleProperty = ratioTupleProperty;
    this.ratioFitnessProperty = ratioFitnessProperty;
    this.inProportionProperty = inProportionProperty;
    this.myChallengeAccordionBox = myChallengeAccordionBox;
    myChallengeAccordionBox.expandedProperty.link(expanded => {
      if (expanded) {
        descriptionBullets.addChild(currentChallengeBullet);
      } else if (descriptionBullets.hasChild(currentChallengeBullet)) {
        descriptionBullets.removeChild(currentChallengeBullet);
      }
    });
    Multilink.multilink([tickMarkViewProperty, myChallengeAccordionBox.targetAntecedentProperty, myChallengeAccordionBox.targetConsequentProperty, ratioTupleProperty, ratioFitnessProperty, inProportionProperty, tickMarkRangeProperty], () => {
      stateOfSimNode.innerContent = this.getStateOfSim();
      leftHandBullet.innerContent = this.getLeftHandState();
      rightHandBullet.innerContent = this.getRightHandState();
      currentChallengeBullet.innerContent = this.getCurrentChallengeState();
    });
  }
  getStateOfSim(currentChallenge = RatioAndProportionStrings.a11y.create.challengeStringProperty) {
    // TODO: PatternStringProperty when time, https://github.com/phetsims/ratio-and-proportion/issues/499
    return StringUtils.fillIn(RatioAndProportionStrings.a11y.screenSummaryQualitativeStateOfSimStringProperty, {
      color: BackgroundColorHandler.getCurrentColorRegion(this.ratioFitnessProperty.value, this.inProportionProperty.value),
      ratioFitness: this.ratioDescriber.getRatioFitness(false),
      currentChallenge: currentChallenge,
      distance: this.handPositionsDescriber.getDistanceRegion(true)
    });
  }
  getLeftHandState() {
    // TODO: PatternStringProperty when time, https://github.com/phetsims/ratio-and-proportion/issues/499
    return StringUtils.fillIn(RatioAndProportionStrings.a11y.leftHandBulletStringProperty, {
      position: this.handPositionsDescriber.getHandPositionDescription(this.ratioTupleProperty.value.antecedent, this.tickMarkViewProperty.value)
    });
  }
  getRightHandState() {
    // TODO: PatternStringProperty when time, https://github.com/phetsims/ratio-and-proportion/issues/499
    return StringUtils.fillIn(RatioAndProportionStrings.a11y.rightHandBulletStringProperty, {
      position: this.handPositionsDescriber.getHandPositionDescription(this.ratioTupleProperty.value.consequent, this.tickMarkViewProperty.value)
    });
  }
  getCurrentChallengeState() {
    return this.ratioDescriber.getCurrentChallengeSentence(this.myChallengeAccordionBox.targetAntecedentProperty.value, this.myChallengeAccordionBox.targetConsequentProperty.value);
  }
  getDetailsButtonState() {
    const patternStringProperty = this.myChallengeAccordionBox.expandedProperty.value ? RatioAndProportionStrings.a11y.detailsButtonWithCurrentChallengePatternStringProperty : RatioAndProportionStrings.a11y.detailsButtonPatternStringProperty;
    // TODO: PatternStringProperty when time, https://github.com/phetsims/ratio-and-proportion/issues/499
    return StringUtils.fillIn(patternStringProperty, {
      stateOfSim: this.getStateOfSim(),
      leftHand: this.getLeftHandState(),
      rightHand: this.getRightHandState(),
      currentChallenge: this.getCurrentChallengeState()
    });
  }
}
ratioAndProportion.register('CreateScreenSummaryNode', CreateScreenSummaryNode);
export default CreateScreenSummaryNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTdHJpbmdVdGlscyIsIk5vZGUiLCJyYXRpb0FuZFByb3BvcnRpb24iLCJSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzIiwiQmFja2dyb3VuZENvbG9ySGFuZGxlciIsIk11bHRpbGluayIsIkNyZWF0ZVNjcmVlblN1bW1hcnlOb2RlIiwiY29uc3RydWN0b3IiLCJyYXRpb0ZpdG5lc3NQcm9wZXJ0eSIsInJhdGlvVHVwbGVQcm9wZXJ0eSIsInRpY2tNYXJrVmlld1Byb3BlcnR5IiwicmF0aW9EZXNjcmliZXIiLCJpblByb3BvcnRpb25Qcm9wZXJ0eSIsImhhbmRQb3NpdGlvbnNEZXNjcmliZXIiLCJ0aWNrTWFya1JhbmdlUHJvcGVydHkiLCJteUNoYWxsZW5nZUFjY29yZGlvbkJveCIsInN0YXRlT2ZTaW1Ob2RlIiwidGFnTmFtZSIsImxlZnRIYW5kQnVsbGV0IiwicmlnaHRIYW5kQnVsbGV0IiwiY3VycmVudENoYWxsZW5nZUJ1bGxldCIsImRlc2NyaXB0aW9uQnVsbGV0cyIsImNoaWxkcmVuIiwiaW5uZXJDb250ZW50IiwiYTExeSIsImNyZWF0ZSIsInNjcmVlblN1bW1hcnkiLCJwYXJhZ3JhcGgxU3RyaW5nUHJvcGVydHkiLCJwYXJhZ3JhcGgyU3RyaW5nUHJvcGVydHkiLCJzY3JlZW5TdW1tYXJ5Q29udHJvbEFyZWFQYXJhZ3JhcGhTdHJpbmdQcm9wZXJ0eSIsImludGVyYWN0aW9uSGludFN0cmluZ1Byb3BlcnR5IiwiZXhwYW5kZWRQcm9wZXJ0eSIsImxpbmsiLCJleHBhbmRlZCIsImFkZENoaWxkIiwiaGFzQ2hpbGQiLCJyZW1vdmVDaGlsZCIsIm11bHRpbGluayIsInRhcmdldEFudGVjZWRlbnRQcm9wZXJ0eSIsInRhcmdldENvbnNlcXVlbnRQcm9wZXJ0eSIsImdldFN0YXRlT2ZTaW0iLCJnZXRMZWZ0SGFuZFN0YXRlIiwiZ2V0UmlnaHRIYW5kU3RhdGUiLCJnZXRDdXJyZW50Q2hhbGxlbmdlU3RhdGUiLCJjdXJyZW50Q2hhbGxlbmdlIiwiY2hhbGxlbmdlU3RyaW5nUHJvcGVydHkiLCJmaWxsSW4iLCJzY3JlZW5TdW1tYXJ5UXVhbGl0YXRpdmVTdGF0ZU9mU2ltU3RyaW5nUHJvcGVydHkiLCJjb2xvciIsImdldEN1cnJlbnRDb2xvclJlZ2lvbiIsInZhbHVlIiwicmF0aW9GaXRuZXNzIiwiZ2V0UmF0aW9GaXRuZXNzIiwiZGlzdGFuY2UiLCJnZXREaXN0YW5jZVJlZ2lvbiIsImxlZnRIYW5kQnVsbGV0U3RyaW5nUHJvcGVydHkiLCJwb3NpdGlvbiIsImdldEhhbmRQb3NpdGlvbkRlc2NyaXB0aW9uIiwiYW50ZWNlZGVudCIsInJpZ2h0SGFuZEJ1bGxldFN0cmluZ1Byb3BlcnR5IiwiY29uc2VxdWVudCIsImdldEN1cnJlbnRDaGFsbGVuZ2VTZW50ZW5jZSIsImdldERldGFpbHNCdXR0b25TdGF0ZSIsInBhdHRlcm5TdHJpbmdQcm9wZXJ0eSIsImRldGFpbHNCdXR0b25XaXRoQ3VycmVudENoYWxsZW5nZVBhdHRlcm5TdHJpbmdQcm9wZXJ0eSIsImRldGFpbHNCdXR0b25QYXR0ZXJuU3RyaW5nUHJvcGVydHkiLCJzdGF0ZU9mU2ltIiwibGVmdEhhbmQiLCJyaWdodEhhbmQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNyZWF0ZVNjcmVlblN1bW1hcnlOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIwLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIE5vZGUgdGhhdCBob2xkcyB0aGUgUERPTSBjb250ZW50IGZvciB0aGUgc2NyZWVuIHN1bW1hcnkgaW4gdGhlIENyZWF0ZSBzY3JlZW4uIEl0IGFsc28gY3JlYXRlcyBjb250ZW50IGZvciB0aGUgdm9pY2luZ1xyXG4gKiBvdmVydmlldyBidXR0b25zIGFzIGFwcHJvcHJpYXRlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IHsgTm9kZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCByYXRpb0FuZFByb3BvcnRpb24gZnJvbSAnLi4vLi4vcmF0aW9BbmRQcm9wb3J0aW9uLmpzJztcclxuaW1wb3J0IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MgZnJvbSAnLi4vLi4vUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBSQVBSYXRpb1R1cGxlIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9SQVBSYXRpb1R1cGxlLmpzJztcclxuaW1wb3J0IFJhdGlvRGVzY3JpYmVyIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L2Rlc2NyaWJlcnMvUmF0aW9EZXNjcmliZXIuanMnO1xyXG5pbXBvcnQgSGFuZFBvc2l0aW9uc0Rlc2NyaWJlciBmcm9tICcuLi8uLi9jb21tb24vdmlldy9kZXNjcmliZXJzL0hhbmRQb3NpdGlvbnNEZXNjcmliZXIuanMnO1xyXG5pbXBvcnQgTXlDaGFsbGVuZ2VBY2NvcmRpb25Cb3ggZnJvbSAnLi9NeUNoYWxsZW5nZUFjY29yZGlvbkJveC5qcyc7XHJcbmltcG9ydCBCYWNrZ3JvdW5kQ29sb3JIYW5kbGVyIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0JhY2tncm91bmRDb2xvckhhbmRsZXIuanMnO1xyXG5pbXBvcnQgVGlja01hcmtWaWV3IGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L1RpY2tNYXJrVmlldy5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IEVudW1lcmF0aW9uUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbnVtZXJhdGlvblByb3BlcnR5LmpzJztcclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcblxyXG5jbGFzcyBDcmVhdGVTY3JlZW5TdW1tYXJ5Tm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwcml2YXRlIHJhdGlvRGVzY3JpYmVyOiBSYXRpb0Rlc2NyaWJlcjtcclxuICBwcml2YXRlIGhhbmRQb3NpdGlvbnNEZXNjcmliZXI6IEhhbmRQb3NpdGlvbnNEZXNjcmliZXI7XHJcbiAgcHJpdmF0ZSByYXRpb0ZpdG5lc3NQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPjtcclxuICBwcml2YXRlIHJhdGlvVHVwbGVQcm9wZXJ0eTogUHJvcGVydHk8UkFQUmF0aW9UdXBsZT47XHJcbiAgcHJpdmF0ZSB0aWNrTWFya1ZpZXdQcm9wZXJ0eTogRW51bWVyYXRpb25Qcm9wZXJ0eTxUaWNrTWFya1ZpZXc+O1xyXG4gIHByaXZhdGUgaW5Qcm9wb3J0aW9uUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+O1xyXG4gIHByaXZhdGUgbXlDaGFsbGVuZ2VBY2NvcmRpb25Cb3g6IE15Q2hhbGxlbmdlQWNjb3JkaW9uQm94O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHJhdGlvRml0bmVzc1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXI+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgcmF0aW9UdXBsZVByb3BlcnR5OiBQcm9wZXJ0eTxSQVBSYXRpb1R1cGxlPixcclxuICAgICAgICAgICAgICAgICAgICAgIHRpY2tNYXJrVmlld1Byb3BlcnR5OiBFbnVtZXJhdGlvblByb3BlcnR5PFRpY2tNYXJrVmlldz4sXHJcbiAgICAgICAgICAgICAgICAgICAgICByYXRpb0Rlc2NyaWJlcjogUmF0aW9EZXNjcmliZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICBpblByb3BvcnRpb25Qcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBoYW5kUG9zaXRpb25zRGVzY3JpYmVyOiBIYW5kUG9zaXRpb25zRGVzY3JpYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgdGlja01hcmtSYW5nZVByb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgbXlDaGFsbGVuZ2VBY2NvcmRpb25Cb3g6IE15Q2hhbGxlbmdlQWNjb3JkaW9uQm94ICkge1xyXG5cclxuICAgIGNvbnN0IHN0YXRlT2ZTaW1Ob2RlID0gbmV3IE5vZGUoIHsgdGFnTmFtZTogJ3AnIH0gKTtcclxuICAgIGNvbnN0IGxlZnRIYW5kQnVsbGV0ID0gbmV3IE5vZGUoIHsgdGFnTmFtZTogJ2xpJyB9ICk7XHJcbiAgICBjb25zdCByaWdodEhhbmRCdWxsZXQgPSBuZXcgTm9kZSggeyB0YWdOYW1lOiAnbGknIH0gKTtcclxuICAgIGNvbnN0IGN1cnJlbnRDaGFsbGVuZ2VCdWxsZXQgPSBuZXcgTm9kZSggeyB0YWdOYW1lOiAnbGknIH0gKTtcclxuICAgIGNvbnN0IGRlc2NyaXB0aW9uQnVsbGV0cyA9IG5ldyBOb2RlKCB7XHJcbiAgICAgIHRhZ05hbWU6ICd1bCcsXHJcbiAgICAgIGNoaWxkcmVuOiBbIGxlZnRIYW5kQnVsbGV0LCByaWdodEhhbmRCdWxsZXQgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgbmV3IE5vZGUoIHtcclxuICAgICAgICAgIHRhZ05hbWU6ICdwJyxcclxuICAgICAgICAgIGlubmVyQ29udGVudDogUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LmNyZWF0ZS5zY3JlZW5TdW1tYXJ5LnBhcmFncmFwaDFTdHJpbmdQcm9wZXJ0eVxyXG4gICAgICAgIH0gKSxcclxuICAgICAgICBuZXcgTm9kZSgge1xyXG4gICAgICAgICAgdGFnTmFtZTogJ3AnLFxyXG4gICAgICAgICAgaW5uZXJDb250ZW50OiBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkuY3JlYXRlLnNjcmVlblN1bW1hcnkucGFyYWdyYXBoMlN0cmluZ1Byb3BlcnR5XHJcbiAgICAgICAgfSApLFxyXG4gICAgICAgIG5ldyBOb2RlKCB7XHJcbiAgICAgICAgICB0YWdOYW1lOiAncCcsXHJcbiAgICAgICAgICBpbm5lckNvbnRlbnQ6IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS5zY3JlZW5TdW1tYXJ5Q29udHJvbEFyZWFQYXJhZ3JhcGhTdHJpbmdQcm9wZXJ0eVxyXG4gICAgICAgIH0gKSxcclxuICAgICAgICBzdGF0ZU9mU2ltTm9kZSxcclxuICAgICAgICBkZXNjcmlwdGlvbkJ1bGxldHMsXHJcbiAgICAgICAgbmV3IE5vZGUoIHtcclxuICAgICAgICAgIHRhZ05hbWU6ICdwJyxcclxuICAgICAgICAgIGlubmVyQ29udGVudDogUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LmNyZWF0ZS5zY3JlZW5TdW1tYXJ5LmludGVyYWN0aW9uSGludFN0cmluZ1Byb3BlcnR5XHJcbiAgICAgICAgfSApXHJcbiAgICAgIF1cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmhhbmRQb3NpdGlvbnNEZXNjcmliZXIgPSBoYW5kUG9zaXRpb25zRGVzY3JpYmVyO1xyXG4gICAgdGhpcy5yYXRpb0Rlc2NyaWJlciA9IHJhdGlvRGVzY3JpYmVyO1xyXG4gICAgdGhpcy50aWNrTWFya1ZpZXdQcm9wZXJ0eSA9IHRpY2tNYXJrVmlld1Byb3BlcnR5O1xyXG4gICAgdGhpcy5yYXRpb1R1cGxlUHJvcGVydHkgPSByYXRpb1R1cGxlUHJvcGVydHk7XHJcbiAgICB0aGlzLnJhdGlvRml0bmVzc1Byb3BlcnR5ID0gcmF0aW9GaXRuZXNzUHJvcGVydHk7XHJcbiAgICB0aGlzLmluUHJvcG9ydGlvblByb3BlcnR5ID0gaW5Qcm9wb3J0aW9uUHJvcGVydHk7XHJcbiAgICB0aGlzLm15Q2hhbGxlbmdlQWNjb3JkaW9uQm94ID0gbXlDaGFsbGVuZ2VBY2NvcmRpb25Cb3g7XHJcblxyXG4gICAgbXlDaGFsbGVuZ2VBY2NvcmRpb25Cb3guZXhwYW5kZWRQcm9wZXJ0eS5saW5rKCAoIGV4cGFuZGVkOiBib29sZWFuICkgPT4ge1xyXG4gICAgICBpZiAoIGV4cGFuZGVkICkge1xyXG4gICAgICAgIGRlc2NyaXB0aW9uQnVsbGV0cy5hZGRDaGlsZCggY3VycmVudENoYWxsZW5nZUJ1bGxldCApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBkZXNjcmlwdGlvbkJ1bGxldHMuaGFzQ2hpbGQoIGN1cnJlbnRDaGFsbGVuZ2VCdWxsZXQgKSApIHtcclxuICAgICAgICBkZXNjcmlwdGlvbkJ1bGxldHMucmVtb3ZlQ2hpbGQoIGN1cnJlbnRDaGFsbGVuZ2VCdWxsZXQgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFtcclxuICAgICAgdGlja01hcmtWaWV3UHJvcGVydHksXHJcbiAgICAgIG15Q2hhbGxlbmdlQWNjb3JkaW9uQm94LnRhcmdldEFudGVjZWRlbnRQcm9wZXJ0eSxcclxuICAgICAgbXlDaGFsbGVuZ2VBY2NvcmRpb25Cb3gudGFyZ2V0Q29uc2VxdWVudFByb3BlcnR5LFxyXG4gICAgICByYXRpb1R1cGxlUHJvcGVydHksXHJcbiAgICAgIHJhdGlvRml0bmVzc1Byb3BlcnR5LFxyXG4gICAgICBpblByb3BvcnRpb25Qcm9wZXJ0eSxcclxuICAgICAgdGlja01hcmtSYW5nZVByb3BlcnR5XHJcbiAgICBdLCAoKSA9PiB7XHJcbiAgICAgIHN0YXRlT2ZTaW1Ob2RlLmlubmVyQ29udGVudCA9IHRoaXMuZ2V0U3RhdGVPZlNpbSgpO1xyXG4gICAgICBsZWZ0SGFuZEJ1bGxldC5pbm5lckNvbnRlbnQgPSB0aGlzLmdldExlZnRIYW5kU3RhdGUoKTtcclxuICAgICAgcmlnaHRIYW5kQnVsbGV0LmlubmVyQ29udGVudCA9IHRoaXMuZ2V0UmlnaHRIYW5kU3RhdGUoKTtcclxuICAgICAgY3VycmVudENoYWxsZW5nZUJ1bGxldC5pbm5lckNvbnRlbnQgPSB0aGlzLmdldEN1cnJlbnRDaGFsbGVuZ2VTdGF0ZSgpO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRTdGF0ZU9mU2ltKCBjdXJyZW50Q2hhbGxlbmdlOiBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+ID0gUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LmNyZWF0ZS5jaGFsbGVuZ2VTdHJpbmdQcm9wZXJ0eSApOiBzdHJpbmcge1xyXG4gICAgLy8gVE9ETzogUGF0dGVyblN0cmluZ1Byb3BlcnR5IHdoZW4gdGltZSwgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3JhdGlvLWFuZC1wcm9wb3J0aW9uL2lzc3Vlcy80OTlcclxuICAgIHJldHVybiBTdHJpbmdVdGlscy5maWxsSW4oIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS5zY3JlZW5TdW1tYXJ5UXVhbGl0YXRpdmVTdGF0ZU9mU2ltU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgY29sb3I6IEJhY2tncm91bmRDb2xvckhhbmRsZXIuZ2V0Q3VycmVudENvbG9yUmVnaW9uKCB0aGlzLnJhdGlvRml0bmVzc1Byb3BlcnR5LnZhbHVlLCB0aGlzLmluUHJvcG9ydGlvblByb3BlcnR5LnZhbHVlICksXHJcbiAgICAgIHJhdGlvRml0bmVzczogdGhpcy5yYXRpb0Rlc2NyaWJlci5nZXRSYXRpb0ZpdG5lc3MoIGZhbHNlICksXHJcbiAgICAgIGN1cnJlbnRDaGFsbGVuZ2U6IGN1cnJlbnRDaGFsbGVuZ2UsXHJcbiAgICAgIGRpc3RhbmNlOiB0aGlzLmhhbmRQb3NpdGlvbnNEZXNjcmliZXIuZ2V0RGlzdGFuY2VSZWdpb24oIHRydWUgKVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRMZWZ0SGFuZFN0YXRlKCk6IHN0cmluZyB7XHJcbiAgICAvLyBUT0RPOiBQYXR0ZXJuU3RyaW5nUHJvcGVydHkgd2hlbiB0aW1lLCBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcmF0aW8tYW5kLXByb3BvcnRpb24vaXNzdWVzLzQ5OVxyXG4gICAgcmV0dXJuIFN0cmluZ1V0aWxzLmZpbGxJbiggUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LmxlZnRIYW5kQnVsbGV0U3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgcG9zaXRpb246IHRoaXMuaGFuZFBvc2l0aW9uc0Rlc2NyaWJlci5nZXRIYW5kUG9zaXRpb25EZXNjcmlwdGlvbiggdGhpcy5yYXRpb1R1cGxlUHJvcGVydHkudmFsdWUuYW50ZWNlZGVudCwgdGhpcy50aWNrTWFya1ZpZXdQcm9wZXJ0eS52YWx1ZSApXHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFJpZ2h0SGFuZFN0YXRlKCk6IHN0cmluZyB7XHJcbiAgICAvLyBUT0RPOiBQYXR0ZXJuU3RyaW5nUHJvcGVydHkgd2hlbiB0aW1lLCBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcmF0aW8tYW5kLXByb3BvcnRpb24vaXNzdWVzLzQ5OVxyXG4gICAgcmV0dXJuIFN0cmluZ1V0aWxzLmZpbGxJbiggUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnJpZ2h0SGFuZEJ1bGxldFN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgIHBvc2l0aW9uOiB0aGlzLmhhbmRQb3NpdGlvbnNEZXNjcmliZXIuZ2V0SGFuZFBvc2l0aW9uRGVzY3JpcHRpb24oIHRoaXMucmF0aW9UdXBsZVByb3BlcnR5LnZhbHVlLmNvbnNlcXVlbnQsIHRoaXMudGlja01hcmtWaWV3UHJvcGVydHkudmFsdWUgKVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRDdXJyZW50Q2hhbGxlbmdlU3RhdGUoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLnJhdGlvRGVzY3JpYmVyLmdldEN1cnJlbnRDaGFsbGVuZ2VTZW50ZW5jZSggdGhpcy5teUNoYWxsZW5nZUFjY29yZGlvbkJveC50YXJnZXRBbnRlY2VkZW50UHJvcGVydHkudmFsdWUsXHJcbiAgICAgIHRoaXMubXlDaGFsbGVuZ2VBY2NvcmRpb25Cb3gudGFyZ2V0Q29uc2VxdWVudFByb3BlcnR5LnZhbHVlXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldERldGFpbHNCdXR0b25TdGF0ZSgpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgcGF0dGVyblN0cmluZ1Byb3BlcnR5ID0gdGhpcy5teUNoYWxsZW5nZUFjY29yZGlvbkJveC5leHBhbmRlZFByb3BlcnR5LnZhbHVlID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS5kZXRhaWxzQnV0dG9uV2l0aEN1cnJlbnRDaGFsbGVuZ2VQYXR0ZXJuU3RyaW5nUHJvcGVydHkgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LmRldGFpbHNCdXR0b25QYXR0ZXJuU3RyaW5nUHJvcGVydHk7XHJcbiAgICAvLyBUT0RPOiBQYXR0ZXJuU3RyaW5nUHJvcGVydHkgd2hlbiB0aW1lLCBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcmF0aW8tYW5kLXByb3BvcnRpb24vaXNzdWVzLzQ5OVxyXG4gICAgcmV0dXJuIFN0cmluZ1V0aWxzLmZpbGxJbiggcGF0dGVyblN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgIHN0YXRlT2ZTaW06IHRoaXMuZ2V0U3RhdGVPZlNpbSgpLFxyXG4gICAgICBsZWZ0SGFuZDogdGhpcy5nZXRMZWZ0SGFuZFN0YXRlKCksXHJcbiAgICAgIHJpZ2h0SGFuZDogdGhpcy5nZXRSaWdodEhhbmRTdGF0ZSgpLFxyXG4gICAgICBjdXJyZW50Q2hhbGxlbmdlOiB0aGlzLmdldEN1cnJlbnRDaGFsbGVuZ2VTdGF0ZSgpXHJcbiAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5yYXRpb0FuZFByb3BvcnRpb24ucmVnaXN0ZXIoICdDcmVhdGVTY3JlZW5TdW1tYXJ5Tm9kZScsIENyZWF0ZVNjcmVlblN1bW1hcnlOb2RlICk7XHJcbmV4cG9ydCBkZWZhdWx0IENyZWF0ZVNjcmVlblN1bW1hcnlOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLE9BQU9BLFdBQVcsTUFBTSwrQ0FBK0M7QUFDdkUsU0FBU0MsSUFBSSxRQUFRLG1DQUFtQztBQUN4RCxPQUFPQyxrQkFBa0IsTUFBTSw2QkFBNkI7QUFDNUQsT0FBT0MseUJBQXlCLE1BQU0sb0NBQW9DO0FBSzFFLE9BQU9DLHNCQUFzQixNQUFNLDZDQUE2QztBQUloRixPQUFPQyxTQUFTLE1BQU0sa0NBQWtDO0FBRXhELE1BQU1DLHVCQUF1QixTQUFTTCxJQUFJLENBQUM7RUFVbENNLFdBQVdBLENBQUVDLG9CQUErQyxFQUMvQ0Msa0JBQTJDLEVBQzNDQyxvQkFBdUQsRUFDdkRDLGNBQThCLEVBQzlCQyxvQkFBZ0QsRUFDaERDLHNCQUE4QyxFQUM5Q0MscUJBQXVDLEVBQ3ZDQyx1QkFBZ0QsRUFBRztJQUVyRSxNQUFNQyxjQUFjLEdBQUcsSUFBSWYsSUFBSSxDQUFFO01BQUVnQixPQUFPLEVBQUU7SUFBSSxDQUFFLENBQUM7SUFDbkQsTUFBTUMsY0FBYyxHQUFHLElBQUlqQixJQUFJLENBQUU7TUFBRWdCLE9BQU8sRUFBRTtJQUFLLENBQUUsQ0FBQztJQUNwRCxNQUFNRSxlQUFlLEdBQUcsSUFBSWxCLElBQUksQ0FBRTtNQUFFZ0IsT0FBTyxFQUFFO0lBQUssQ0FBRSxDQUFDO0lBQ3JELE1BQU1HLHNCQUFzQixHQUFHLElBQUluQixJQUFJLENBQUU7TUFBRWdCLE9BQU8sRUFBRTtJQUFLLENBQUUsQ0FBQztJQUM1RCxNQUFNSSxrQkFBa0IsR0FBRyxJQUFJcEIsSUFBSSxDQUFFO01BQ25DZ0IsT0FBTyxFQUFFLElB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