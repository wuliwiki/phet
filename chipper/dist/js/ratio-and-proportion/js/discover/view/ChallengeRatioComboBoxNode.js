// Copyright 2020-2023, University of Colorado Boulder

/**
 * This composes a ComboBox to provide a separate PDOM Node as a heading
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import ComboBox from '../../../../sun/js/ComboBox.js';
import SoundClip from '../../../../tambo/js/sound-generators/SoundClip.js';
import soundManager from '../../../../tambo/js/soundManager.js';
import selectionArpeggio001_mp3 from '../../../../tambo/sounds/selectionArpeggio001_mp3.js';
import selectionArpeggio004_mp3 from '../../../../tambo/sounds/selectionArpeggio004_mp3.js';
import selectionArpeggio006_mp3 from '../../../../tambo/sounds/selectionArpeggio006_mp3.js';
import Utterance from '../../../../utterance-queue/js/Utterance.js';
import RAPColors from '../../common/view/RAPColors.js';
import ratioAndProportion from '../../ratioAndProportion.js';
import RatioAndProportionStrings from '../../RatioAndProportionStrings.js';
import { HBox, Node, Rectangle, RichText } from '../../../../scenery/js/imports.js';
const SOUND_CLIP_OPTIONS = {
  initialOutputLevel: 0.4
};

// Challenge info needed by ChallengeRatioComboBoxNode

class ChallengeRatioComboBoxNode extends Node {
  // Used to get the names of challenges based on the target ratio, NOTE: lowercase strings are only available in the PDOM (not yet i18n)

  /**
   * @param targetRatioProperty
   * @param ratioDescriber
   * @param colorProperty
   * @param comboBoxListParent
   * @param comboBoxTandem - Passed directly to comboBox; keep out of options to prevent instrumenting this intermediate Node.
   * @param [options]
   */
  constructor(targetRatioProperty, ratioDescriber, colorProperty, comboBoxListParent, comboBoxTandem, options) {
    super(options);
    this.ratioToChallengeInfoMap = new Map();
    this.ratioToChallengeInfoMap.set(1 / 2, {
      capitalizedStringProperty: RatioAndProportionStrings.challenge1StringProperty,
      lowercaseStringProperty: RatioAndProportionStrings.a11y.discover.challenge1LowercaseStringProperty,
      color: RAPColors.discoverChallenge1Property.value,
      soundClip: new SoundClip(selectionArpeggio001_mp3, SOUND_CLIP_OPTIONS),
      a11yNameStringProperty: RatioAndProportionStrings.challenge1StringProperty,
      tandemName: `challenge1${ComboBox.ITEM_TANDEM_NAME_SUFFIX}`
    });
    this.ratioToChallengeInfoMap.set(1 / 3, {
      capitalizedStringProperty: RatioAndProportionStrings.challenge2StringProperty,
      lowercaseStringProperty: RatioAndProportionStrings.a11y.discover.challenge2LowercaseStringProperty,
      color: RAPColors.discoverChallenge2Property.value,
      soundClip: new SoundClip(selectionArpeggio004_mp3, SOUND_CLIP_OPTIONS),
      a11yNameStringProperty: RatioAndProportionStrings.challenge2StringProperty,
      tandemName: `challenge2${ComboBox.ITEM_TANDEM_NAME_SUFFIX}`
    });
    this.ratioToChallengeInfoMap.set(3 / 4, {
      capitalizedStringProperty: RatioAndProportionStrings.challenge3StringProperty,
      lowercaseStringProperty: RatioAndProportionStrings.a11y.discover.challenge3LowercaseStringProperty,
      color: RAPColors.discoverChallenge3Property.value,
      soundClip: new SoundClip(selectionArpeggio006_mp3, SOUND_CLIP_OPTIONS),
      a11yNameStringProperty: RatioAndProportionStrings.challenge3StringProperty,
      tandemName: `challenge3${ComboBox.ITEM_TANDEM_NAME_SUFFIX}`
    });

    // Add each soundClip to the soundManager.
    for (const value of this.ratioToChallengeInfoMap.values()) {
      soundManager.addSoundGenerator(value.soundClip);
    }

    // Set colorProperty to match targetRatioProperty.
    targetRatioProperty.link(targetRatio => {
      const entry = this.ratioToChallengeInfoMap.get(targetRatio);
      assert && assert(entry, `no map entry for targetRatio=${targetRatio}`);
      colorProperty.value = entry.color;
    });
    const comboBoxHeading = new Node({
      innerContent: RatioAndProportionStrings.challengeRatioStringProperty,
      tagName: 'h3'
    });
    const comboBoxItems = [];
    for (const [key, value] of this.ratioToChallengeInfoMap.entries()) {
      comboBoxItems.push(createComboBoxItem(key, value));
    }
    this.comboBox = new ComboBox(targetRatioProperty, comboBoxItems, comboBoxListParent, {
      helpText: RatioAndProportionStrings.a11y.discover.challengesHelpTextStringProperty,
      comboBoxVoicingHintResponse: RatioAndProportionStrings.a11y.discover.challengesHelpTextStringProperty,
      comboBoxVoicingContextResponse: () => ratioDescriber.getProximityToNewChallengeRatioSentence(),
      maxWidth: 250,
      // empirically determined

      // phet-io
      tandem: comboBoxTandem
    });
    const proximityToRatioUtterance = new Utterance();
    targetRatioProperty.lazyLink(() => {
      proximityToRatioUtterance.alert = ratioDescriber.getProximityToNewChallengeRatioSentence();
      this.alertDescriptionUtterance(proximityToRatioUtterance);
    });
    this.children = [comboBoxHeading, this.comboBox];
    this.pdomOrder = [comboBoxHeading, this.comboBox];
  }
  hideListBox() {
    this.comboBox.hideListBox();
  }
}
function createComboBoxItem(targetRatio, challengeInfo) {
  const node = new HBox({
    spacing: 8,
    children: [new Rectangle(0, 0, 15, 15, {
      fill: challengeInfo.color
    }), new RichText(challengeInfo.capitalizedStringProperty)]
  });
  return {
    value: targetRatio,
    createNode: tandem => node,
    soundPlayer: challengeInfo.soundClip,
    a11yName: challengeInfo.a11yNameStringProperty,
    tandemName: challengeInfo.tandemName
  };
}
ratioAndProportion.register('ChallengeRatioComboBoxNode', ChallengeRatioComboBoxNode);
export default ChallengeRatioComboBoxNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDb21ib0JveCIsIlNvdW5kQ2xpcCIsInNvdW5kTWFuYWdlciIsInNlbGVjdGlvbkFycGVnZ2lvMDAxX21wMyIsInNlbGVjdGlvbkFycGVnZ2lvMDA0X21wMyIsInNlbGVjdGlvbkFycGVnZ2lvMDA2X21wMyIsIlV0dGVyYW5jZSIsIlJBUENvbG9ycyIsInJhdGlvQW5kUHJvcG9ydGlvbiIsIlJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MiLCJIQm94IiwiTm9kZSIsIlJlY3RhbmdsZSIsIlJpY2hUZXh0IiwiU09VTkRfQ0xJUF9PUFRJT05TIiwiaW5pdGlhbE91dHB1dExldmVsIiwiQ2hhbGxlbmdlUmF0aW9Db21ib0JveE5vZGUiLCJjb25zdHJ1Y3RvciIsInRhcmdldFJhdGlvUHJvcGVydHkiLCJyYXRpb0Rlc2NyaWJlciIsImNvbG9yUHJvcGVydHkiLCJjb21ib0JveExpc3RQYXJlbnQiLCJjb21ib0JveFRhbmRlbSIsIm9wdGlvbnMiLCJyYXRpb1RvQ2hhbGxlbmdlSW5mb01hcCIsIk1hcCIsInNldCIsImNhcGl0YWxpemVkU3RyaW5nUHJvcGVydHkiLCJjaGFsbGVuZ2UxU3RyaW5nUHJvcGVydHkiLCJsb3dlcmNhc2VTdHJpbmdQcm9wZXJ0eSIsImExMXkiLCJkaXNjb3ZlciIsImNoYWxsZW5nZTFMb3dlcmNhc2VTdHJpbmdQcm9wZXJ0eSIsImNvbG9yIiwiZGlzY292ZXJDaGFsbGVuZ2UxUHJvcGVydHkiLCJ2YWx1ZSIsInNvdW5kQ2xpcCIsImExMXlOYW1lU3RyaW5nUHJvcGVydHkiLCJ0YW5kZW1OYW1lIiwiSVRFTV9UQU5ERU1fTkFNRV9TVUZGSVgiLCJjaGFsbGVuZ2UyU3RyaW5nUHJvcGVydHkiLCJjaGFsbGVuZ2UyTG93ZXJjYXNlU3RyaW5nUHJvcGVydHkiLCJkaXNjb3ZlckNoYWxsZW5nZTJQcm9wZXJ0eSIsImNoYWxsZW5nZTNTdHJpbmdQcm9wZXJ0eSIsImNoYWxsZW5nZTNMb3dlcmNhc2VTdHJpbmdQcm9wZXJ0eSIsImRpc2NvdmVyQ2hhbGxlbmdlM1Byb3BlcnR5IiwidmFsdWVzIiwiYWRkU291bmRHZW5lcmF0b3IiLCJsaW5rIiwidGFyZ2V0UmF0aW8iLCJlbnRyeSIsImdldCIsImFzc2VydCIsImNvbWJvQm94SGVhZGluZyIsImlubmVyQ29udGVudCIsImNoYWxsZW5nZVJhdGlvU3RyaW5nUHJvcGVydHkiLCJ0YWdOYW1lIiwiY29tYm9Cb3hJdGVtcyIsImtleSIsImVudHJpZXMiLCJwdXNoIiwiY3JlYXRlQ29tYm9Cb3hJdGVtIiwiY29tYm9Cb3giLCJoZWxwVGV4dCIsImNoYWxsZW5nZXNIZWxwVGV4dFN0cmluZ1Byb3BlcnR5IiwiY29tYm9Cb3hWb2ljaW5nSGludFJlc3BvbnNlIiwiY29tYm9Cb3hWb2ljaW5nQ29udGV4dFJlc3BvbnNlIiwiZ2V0UHJveGltaXR5VG9OZXdDaGFsbGVuZ2VSYXRpb1NlbnRlbmNlIiwibWF4V2lkdGgiLCJ0YW5kZW0iLCJwcm94aW1pdHlUb1JhdGlvVXR0ZXJhbmNlIiwibGF6eUxpbmsiLCJhbGVydCIsImFsZXJ0RGVzY3JpcHRpb25VdHRlcmFuY2UiLCJjaGlsZHJlbiIsInBkb21PcmRlciIsImhpZGVMaXN0Qm94IiwiY2hhbGxlbmdlSW5mbyIsIm5vZGUiLCJzcGFjaW5nIiwiZmlsbCIsImNyZWF0ZU5vZGUiLCJzb3VuZFBsYXllciIsImExMXlOYW1lIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJDaGFsbGVuZ2VSYXRpb0NvbWJvQm94Tm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMC0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBUaGlzIGNvbXBvc2VzIGEgQ29tYm9Cb3ggdG8gcHJvdmlkZSBhIHNlcGFyYXRlIFBET00gTm9kZSBhcyBhIGhlYWRpbmdcclxuICogQGF1dGhvciBNaWNoYWVsIEthdXptYW5uIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBDb21ib0JveCwgeyBDb21ib0JveEl0ZW0gfSBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvQ29tYm9Cb3guanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBTb3VuZENsaXAgZnJvbSAnLi4vLi4vLi4vLi4vdGFtYm8vanMvc291bmQtZ2VuZXJhdG9ycy9Tb3VuZENsaXAuanMnO1xyXG5pbXBvcnQgc291bmRNYW5hZ2VyIGZyb20gJy4uLy4uLy4uLy4uL3RhbWJvL2pzL3NvdW5kTWFuYWdlci5qcyc7XHJcbmltcG9ydCBzZWxlY3Rpb25BcnBlZ2dpbzAwMV9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vdGFtYm8vc291bmRzL3NlbGVjdGlvbkFycGVnZ2lvMDAxX21wMy5qcyc7XHJcbmltcG9ydCBzZWxlY3Rpb25BcnBlZ2dpbzAwNF9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vdGFtYm8vc291bmRzL3NlbGVjdGlvbkFycGVnZ2lvMDA0X21wMy5qcyc7XHJcbmltcG9ydCBzZWxlY3Rpb25BcnBlZ2dpbzAwNl9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vdGFtYm8vc291bmRzL3NlbGVjdGlvbkFycGVnZ2lvMDA2X21wMy5qcyc7XHJcbmltcG9ydCBVdHRlcmFuY2UgZnJvbSAnLi4vLi4vLi4vLi4vdXR0ZXJhbmNlLXF1ZXVlL2pzL1V0dGVyYW5jZS5qcyc7XHJcbmltcG9ydCBSQVBDb2xvcnMgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvUkFQQ29sb3JzLmpzJztcclxuaW1wb3J0IHJhdGlvQW5kUHJvcG9ydGlvbiBmcm9tICcuLi8uLi9yYXRpb0FuZFByb3BvcnRpb24uanMnO1xyXG5pbXBvcnQgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncyBmcm9tICcuLi8uLi9SYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmpzJztcclxuaW1wb3J0IE51bWJlclByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTnVtYmVyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUmF0aW9EZXNjcmliZXIgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvZGVzY3JpYmVycy9SYXRpb0Rlc2NyaWJlci5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgQ29sb3IsIEhCb3gsIE5vZGUsIE5vZGVPcHRpb25zLCBSZWN0YW5nbGUsIFJpY2hUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5cclxuY29uc3QgU09VTkRfQ0xJUF9PUFRJT05TID0ge1xyXG4gIGluaXRpYWxPdXRwdXRMZXZlbDogMC40XHJcbn07XHJcblxyXG4vLyBDaGFsbGVuZ2UgaW5mbyBuZWVkZWQgYnkgQ2hhbGxlbmdlUmF0aW9Db21ib0JveE5vZGVcclxudHlwZSBDaGFsbGVuZ2VJbmZvID0ge1xyXG4gIGNhcGl0YWxpemVkU3RyaW5nUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz47XHJcbiAgbG93ZXJjYXNlU3RyaW5nUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz47XHJcbiAgY29sb3I6IENvbG9yO1xyXG4gIHNvdW5kQ2xpcDogU291bmRDbGlwO1xyXG4gIGExMXlOYW1lU3RyaW5nUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz47XHJcbiAgdGFuZGVtTmFtZTogc3RyaW5nO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgUmF0aW9Ub0NoYWxsZW5nZUluZm9NYXAgPSBNYXA8bnVtYmVyLCBDaGFsbGVuZ2VJbmZvPjtcclxuXHJcbmNsYXNzIENoYWxsZW5nZVJhdGlvQ29tYm9Cb3hOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8vIFVzZWQgdG8gZ2V0IHRoZSBuYW1lcyBvZiBjaGFsbGVuZ2VzIGJhc2VkIG9uIHRoZSB0YXJnZXQgcmF0aW8sIE5PVEU6IGxvd2VyY2FzZSBzdHJpbmdzIGFyZSBvbmx5IGF2YWlsYWJsZSBpbiB0aGUgUERPTSAobm90IHlldCBpMThuKVxyXG4gIHB1YmxpYyByZWFkb25seSByYXRpb1RvQ2hhbGxlbmdlSW5mb01hcDogUmF0aW9Ub0NoYWxsZW5nZUluZm9NYXA7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBjb21ib0JveDogQ29tYm9Cb3g8bnVtYmVyPjtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHRhcmdldFJhdGlvUHJvcGVydHlcclxuICAgKiBAcGFyYW0gcmF0aW9EZXNjcmliZXJcclxuICAgKiBAcGFyYW0gY29sb3JQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSBjb21ib0JveExpc3RQYXJlbnRcclxuICAgKiBAcGFyYW0gY29tYm9Cb3hUYW5kZW0gLSBQYXNzZWQgZGlyZWN0bHkgdG8gY29tYm9Cb3g7IGtlZXAgb3V0IG9mIG9wdGlvbnMgdG8gcHJldmVudCBpbnN0cnVtZW50aW5nIHRoaXMgaW50ZXJtZWRpYXRlIE5vZGUuXHJcbiAgICogQHBhcmFtIFtvcHRpb25zXVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggdGFyZ2V0UmF0aW9Qcm9wZXJ0eTogTnVtYmVyUHJvcGVydHksXHJcbiAgICAgICAgICAgICAgICAgICAgICByYXRpb0Rlc2NyaWJlcjogUmF0aW9EZXNjcmliZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICBjb2xvclByb3BlcnR5OiBQcm9wZXJ0eTxDb2xvcj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBjb21ib0JveExpc3RQYXJlbnQ6IE5vZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICBjb21ib0JveFRhbmRlbTogVGFuZGVtLFxyXG4gICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucz86IFN0cmljdE9taXQ8Tm9kZU9wdGlvbnMsICdjaGlsZHJlbic+ICkge1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5yYXRpb1RvQ2hhbGxlbmdlSW5mb01hcCA9IG5ldyBNYXA8bnVtYmVyLCBDaGFsbGVuZ2VJbmZvPigpO1xyXG4gICAgdGhpcy5yYXRpb1RvQ2hhbGxlbmdlSW5mb01hcC5zZXQoIDEgLyAyLCB7XHJcbiAgICAgIGNhcGl0YWxpemVkU3RyaW5nUHJvcGVydHk6IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuY2hhbGxlbmdlMVN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBsb3dlcmNhc2VTdHJpbmdQcm9wZXJ0eTogUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LmRpc2NvdmVyLmNoYWxsZW5nZTFMb3dlcmNhc2VTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgY29sb3I6IFJBUENvbG9ycy5kaXNjb3ZlckNoYWxsZW5nZTFQcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgc291bmRDbGlwOiBuZXcgU291bmRDbGlwKCBzZWxlY3Rpb25BcnBlZ2dpbzAwMV9tcDMsIFNPVU5EX0NMSVBfT1BUSU9OUyApLFxyXG4gICAgICBhMTF5TmFtZVN0cmluZ1Byb3BlcnR5OiBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmNoYWxsZW5nZTFTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgdGFuZGVtTmFtZTogYGNoYWxsZW5nZTEke0NvbWJvQm94LklURU1fVEFOREVNX05BTUVfU1VGRklYfWBcclxuICAgIH0gKTtcclxuICAgIHRoaXMucmF0aW9Ub0NoYWxsZW5nZUluZm9NYXAuc2V0KCAxIC8gMywge1xyXG4gICAgICBjYXBpdGFsaXplZFN0cmluZ1Byb3BlcnR5OiBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmNoYWxsZW5nZTJTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgbG93ZXJjYXNlU3RyaW5nUHJvcGVydHk6IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS5kaXNjb3Zlci5jaGFsbGVuZ2UyTG93ZXJjYXNlU3RyaW5nUHJvcGVydHksXHJcbiAgICAgIGNvbG9yOiBSQVBDb2xvcnMuZGlzY292ZXJDaGFsbGVuZ2UyUHJvcGVydHkudmFsdWUsXHJcbiAgICAgIHNvdW5kQ2xpcDogbmV3IFNvdW5kQ2xpcCggc2VsZWN0aW9uQXJwZWdnaW8wMDRfbXAzLCBTT1VORF9DTElQX09QVElPTlMgKSxcclxuICAgICAgYTExeU5hbWVTdHJpbmdQcm9wZXJ0eTogUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5jaGFsbGVuZ2UyU3RyaW5nUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbU5hbWU6IGBjaGFsbGVuZ2UyJHtDb21ib0JveC5JVEVNX1RBTkRFTV9OQU1FX1NVRkZJWH1gXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLnJhdGlvVG9DaGFsbGVuZ2VJbmZvTWFwLnNldCggMyAvIDQsIHtcclxuICAgICAgY2FwaXRhbGl6ZWRTdHJpbmdQcm9wZXJ0eTogUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5jaGFsbGVuZ2UzU3RyaW5nUHJvcGVydHksXHJcbiAgICAgIGxvd2VyY2FzZVN0cmluZ1Byb3BlcnR5OiBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkuZGlzY292ZXIuY2hhbGxlbmdlM0xvd2VyY2FzZVN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBjb2xvcjogUkFQQ29sb3JzLmRpc2NvdmVyQ2hhbGxlbmdlM1Byb3BlcnR5LnZhbHVlLFxyXG4gICAgICBzb3VuZENsaXA6IG5ldyBTb3VuZENsaXAoIHNlbGVjdGlvbkFycGVnZ2lvMDA2X21wMywgU09VTkRfQ0xJUF9PUFRJT05TICksXHJcbiAgICAgIGExMXlOYW1lU3RyaW5nUHJvcGVydHk6IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuY2hhbGxlbmdlM1N0cmluZ1Byb3BlcnR5LFxyXG4gICAgICB0YW5kZW1OYW1lOiBgY2hhbGxlbmdlMyR7Q29tYm9Cb3guSVRFTV9UQU5ERU1fTkFNRV9TVUZGSVh9YFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEFkZCBlYWNoIHNvdW5kQ2xpcCB0byB0aGUgc291bmRNYW5hZ2VyLlxyXG4gICAgZm9yICggY29uc3QgdmFsdWUgb2YgdGhpcy5yYXRpb1RvQ2hhbGxlbmdlSW5mb01hcC52YWx1ZXMoKSApIHtcclxuICAgICAgc291bmRNYW5hZ2VyLmFkZFNvdW5kR2VuZXJhdG9yKCB2YWx1ZS5zb3VuZENsaXAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTZXQgY29sb3JQcm9wZXJ0eSB0byBtYXRjaCB0YXJnZXRSYXRpb1Byb3BlcnR5LlxyXG4gICAgdGFyZ2V0UmF0aW9Qcm9wZXJ0eS5saW5rKCB0YXJnZXRSYXRpbyA9PiB7XHJcbiAgICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5yYXRpb1RvQ2hhbGxlbmdlSW5mb01hcC5nZXQoIHRhcmdldFJhdGlvICk7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIGVudHJ5LCBgbm8gbWFwIGVudHJ5IGZvciB0YXJnZXRSYXRpbz0ke3RhcmdldFJhdGlvfWAgKTtcclxuICAgICAgY29sb3JQcm9wZXJ0eS52YWx1ZSA9IGVudHJ5IS5jb2xvcjtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBjb21ib0JveEhlYWRpbmcgPSBuZXcgTm9kZSgge1xyXG4gICAgICBpbm5lckNvbnRlbnQ6IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuY2hhbGxlbmdlUmF0aW9TdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgdGFnTmFtZTogJ2gzJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGNvbWJvQm94SXRlbXM6IENvbWJvQm94SXRlbTxudW1iZXI+W10gPSBbXTtcclxuICAgIGZvciAoIGNvbnN0IFsga2V5LCB2YWx1ZSBdIG9mIHRoaXMucmF0aW9Ub0NoYWxsZW5nZUluZm9NYXAuZW50cmllcygpICkge1xyXG4gICAgICBjb21ib0JveEl0ZW1zLnB1c2goIGNyZWF0ZUNvbWJvQm94SXRlbSgga2V5LCB2YWx1ZSApICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jb21ib0JveCA9IG5ldyBDb21ib0JveCggdGFyZ2V0UmF0aW9Qcm9wZXJ0eSwgY29tYm9Cb3hJdGVtcywgY29tYm9Cb3hMaXN0UGFyZW50LCB7XHJcbiAgICAgIGhlbHBUZXh0OiBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkuZGlzY292ZXIuY2hhbGxlbmdlc0hlbHBUZXh0U3RyaW5nUHJvcGVydHksXHJcbiAgICAgIGNvbWJvQm94Vm9pY2luZ0hpbnRSZXNwb25zZTogUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LmRpc2NvdmVyLmNoYWxsZW5nZXNIZWxwVGV4dFN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBjb21ib0JveFZvaWNpbmdDb250ZXh0UmVzcG9uc2U6ICgpID0+IHJhdGlvRGVzY3JpYmVyLmdldFByb3hpbWl0eVRvTmV3Q2hhbGxlbmdlUmF0aW9TZW50ZW5jZSgpLFxyXG4gICAgICBtYXhXaWR0aDogMjUwLCAvLyBlbXBpcmljYWxseSBkZXRlcm1pbmVkXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogY29tYm9Cb3hUYW5kZW1cclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBwcm94aW1pdHlUb1JhdGlvVXR0ZXJhbmNlID0gbmV3IFV0dGVyYW5jZSgpO1xyXG4gICAgdGFyZ2V0UmF0aW9Qcm9wZXJ0eS5sYXp5TGluayggKCkgPT4ge1xyXG4gICAgICBwcm94aW1pdHlUb1JhdGlvVXR0ZXJhbmNlLmFsZXJ0ID0gcmF0aW9EZXNjcmliZXIuZ2V0UHJveGltaXR5VG9OZXdDaGFsbGVuZ2VSYXRpb1NlbnRlbmNlKCk7XHJcbiAgICAgIHRoaXMuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggcHJveGltaXR5VG9SYXRpb1V0dGVyYW5jZSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuY2hpbGRyZW4gPSBbXHJcbiAgICAgIGNvbWJvQm94SGVhZGluZyxcclxuICAgICAgdGhpcy5jb21ib0JveFxyXG4gICAgXTtcclxuXHJcbiAgICB0aGlzLnBkb21PcmRlciA9IFsgY29tYm9Cb3hIZWFkaW5nLCB0aGlzLmNvbWJvQm94IF07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaGlkZUxpc3RCb3goKTogdm9pZCB7XHJcbiAgICB0aGlzLmNvbWJvQm94LmhpZGVMaXN0Qm94KCk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVDb21ib0JveEl0ZW0oIHRhcmdldFJhdGlvOiBudW1iZXIsIGNoYWxsZW5nZUluZm86IENoYWxsZW5nZUluZm8gKTogQ29tYm9Cb3hJdGVtPG51bWJlcj4ge1xyXG5cclxuICBjb25zdCBub2RlID0gbmV3IEhCb3goIHtcclxuICAgIHNwYWNpbmc6IDgsXHJcbiAgICBjaGlsZHJlbjogW1xyXG4gICAgICBuZXcgUmVjdGFuZ2xlKCAwLCAwLCAxNSwgMTUsIHsgZmlsbDogY2hhbGxlbmdlSW5mby5jb2xvciB9ICksXHJcbiAgICAgIG5ldyBSaWNoVGV4dCggY2hhbGxlbmdlSW5mby5jYXBpdGFsaXplZFN0cmluZ1Byb3BlcnR5ICkgXVxyXG4gIH0gKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHZhbHVlOiB0YXJnZXRSYXRpbyxcclxuICAgIGNyZWF0ZU5vZGU6IHRhbmRlbSA9PiBub2RlLFxyXG4gICAgc291bmRQbGF5ZXI6IGNoYWxsZW5nZUluZm8uc291bmRDbGlwLFxyXG4gICAgYTExeU5hbWU6IGNoYWxsZW5nZUluZm8uYTExeU5hbWVTdHJpbmdQcm9wZXJ0eSxcclxuICAgIHRhbmRlbU5hbWU6IGNoYWxsZW5nZUluZm8udGFuZGVtTmFtZVxyXG4gIH07XHJcbn1cclxuXHJcbnJhdGlvQW5kUHJvcG9ydGlvbi5yZWdpc3RlciggJ0NoYWxsZW5nZVJhdGlvQ29tYm9Cb3hOb2RlJywgQ2hhbGxlbmdlUmF0aW9Db21ib0JveE5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgQ2hhbGxlbmdlUmF0aW9Db21ib0JveE5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxRQUFRLE1BQXdCLGdDQUFnQztBQUV2RSxPQUFPQyxTQUFTLE1BQU0sb0RBQW9EO0FBQzFFLE9BQU9DLFlBQVksTUFBTSxzQ0FBc0M7QUFDL0QsT0FBT0Msd0JBQXdCLE1BQU0sc0RBQXNEO0FBQzNGLE9BQU9DLHdCQUF3QixNQUFNLHNEQUFzRDtBQUMzRixPQUFPQyx3QkFBd0IsTUFBTSxzREFBc0Q7QUFDM0YsT0FBT0MsU0FBUyxNQUFNLDZDQUE2QztBQUNuRSxPQUFPQyxTQUFTLE1BQU0sZ0NBQWdDO0FBQ3RELE9BQU9DLGtCQUFrQixNQUFNLDZCQUE2QjtBQUM1RCxPQUFPQyx5QkFBeUIsTUFBTSxvQ0FBb0M7QUFJMUUsU0FBZ0JDLElBQUksRUFBRUMsSUFBSSxFQUFlQyxTQUFTLEVBQUVDLFFBQVEsUUFBUSxtQ0FBbUM7QUFJdkcsTUFBTUMsa0JBQWtCLEdBQUc7RUFDekJDLGtCQUFrQixFQUFFO0FBQ3RCLENBQUM7O0FBRUQ7O0FBWUEsTUFBTUMsMEJBQTBCLFNBQVNMLElBQUksQ0FBQztFQUU1Qzs7RUFJQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ1NNLFdBQVdBLENBQUVDLG1CQUFtQyxFQUNuQ0MsY0FBOEIsRUFDOUJDLGFBQThCLEVBQzlCQyxrQkFBd0IsRUFDeEJDLGNBQXNCLEVBQ3RCQyxPQUE2QyxFQUFHO0lBRWxFLEtBQUssQ0FBRUEsT0FBUSxDQUFDO0lBRWhCLElBQUksQ0FBQ0MsdUJBQXVCLEdBQUcsSUFBSUMsR0FBRyxDQUF3QixDQUFDO0lBQy9ELElBQUksQ0FBQ0QsdUJBQXVCLENBQUNFLEdBQUcsQ0FBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFO01BQ3ZDQyx5QkFBeUIsRUFBRWxCLHlCQUF5QixDQUFDbUIsd0JBQXdCO01BQzdFQyx1QkFBdUIsRUFBRXBCLHlCQUF5QixDQUFDcUIsSUFBSSxDQUFDQyxRQUFRLENBQUNDLGlDQUFpQztNQUNsR0MsS0FBSyxFQUFFMUIsU0FBUyxDQUFDMkIsMEJBQTBCLENBQUNDLEtBQUs7TUFDakRDLFNBQVMsRUFBRSxJQUFJbkMsU0FBUyxDQUFFRSx3QkFBd0IsRUFBRVcsa0JBQW1CLENBQUM7TUFDeEV1QixzQkFBc0IsRUFBRTVCLHlCQUF5QixDQUFDbUIsd0JBQXdCO01BQzFFVSxVQUFVLEVBQUcsYUFBWXRDLFFBQVEsQ0FBQ3VDLHVCQUF3QjtJQUM1RCxDQUFFLENBQUM7SUFDSCxJQUFJLENBQUNmLHVCQUF1QixDQUFDRSxHQUFHLENBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRTtNQUN2Q0MseUJBQXlCLEVBQUVsQix5QkFBeUIsQ0FBQytCLHdCQUF3QjtNQUM3RVgsdUJBQXVCLEVBQUVwQix5QkFBeUIsQ0FBQ3FCLElBQUksQ0FBQ0MsUUFBUSxDQUFDVSxpQ0FBaUM7TUFDbEdSLEtBQUssRUFBRTFCLFNBQVMsQ0FBQ21DLDBCQUEwQixDQUFDUCxLQUFLO01BQ2pEQyxTQUFTLEVBQUUsSUFBSW5DLFNBQVMsQ0FBRUcsd0JBQXdCLEVBQUVVLGtCQUFtQixDQUFDO01BQ3hFdUIsc0JBQXNCLEVBQUU1Qix5QkFBeUIsQ0FBQytCLHdCQUF3QjtNQUMxRUYsVUFBVSxFQUFHLGFBQVl0QyxRQUFRLENBQUN1Qyx1QkFBd0I7SUFDNUQsQ0FBRSxDQUFDO0lBQ0gsSUFBSSxDQUFDZix1QkFBdUIsQ0FBQ0UsR0FBRyxDQUFFLENBQUMsR0FBRyxDQUFDLEVBQUU7TUFDdkNDLHlCQUF5QixFQUFFbEIseUJBQXlCLENBQUNrQyx3QkFBd0I7TUFDN0VkLHVCQUF1QixFQUFFcEIseUJBQXlCLENBQUNxQixJQUFJLENBQUNDLFFBQVEsQ0FBQ2EsaUNBQWlDO01BQ2xHWCxLQUFLLEVBQUUxQixTQUFTLENBQUNzQywwQkFBMEIsQ0FBQ1YsS0FBSztNQUNqREMsU0FBUyxFQUFFLElBQUluQyxTQUFTLENBQUVJLHdCQUF3QixFQUFFUyxrQkFBbUIsQ0FBQztNQUN4RXVCLHNCQUFzQixFQUFFNUIseUJBQXlCLENBQUNrQyx3QkFBd0I7TUFDMUVMLFVBQVUsRUFBRyxhQUFZdEMsUUFBUSxDQUFDdUMsdUJBQXdCO0lBQzVELENBQUUsQ0FBQzs7SUFFSDtJQUNBLEtBQU0sTUFBTUosS0FBSyxJQUFJLElBQUksQ0FBQ1gsdUJBQXVCLENBQUNzQixNQUFNLENBQUMsQ0FBQyxFQUFHO01BQzNENUMsWUFBWSxDQUFDNkMsaUJBQWlCLENBQUVaLEtBQUssQ0FBQ0MsU0FBVSxDQUFDO0lBQ25EOztJQUVBO0lBQ0FsQixtQkFBbUIsQ0FBQzhCLElBQUksQ0FBRUMsV0FBVyxJQUFJO01BQ3ZDLE1BQU1DLEtBQUssR0FBRyxJQUFJLENBQUMxQix1QkFBdUIsQ0FBQzJCLEdBQUcsQ0FBRUYsV0FBWSxDQUFDO01BQzdERyxNQUFNLElBQUlBLE1BQU0sQ0FBRUYsS0FBSyxFQUFHLGdDQUErQkQsV0FBWSxFQUFFLENBQUM7TUFDeEU3QixhQUFhLENBQUNlLEtBQUssR0FBR2UsS0FBSyxDQUFFakIsS0FBSztJQUNwQyxDQUFFLENBQUM7SUFFSCxNQUFNb0IsZUFBZSxHQUFHLElBQUkxQyxJQUFJLENBQUU7TUFDaEMyQyxZQUFZLEVBQUU3Qyx5QkFBeUIsQ0FBQzhDLDRCQUE0QjtNQUNwRUMsT0FBTyxFQUFFO0lBQ1gsQ0FBRSxDQUFDO0lBRUgsTUFBTUMsYUFBcUMsR0FBRyxFQUFFO0lBQ2hELEtBQU0sTUFBTSxDQUFFQyxHQUFHLEVBQUV2QixLQUFLLENBQUUsSUFBSSxJQUFJLENBQUNYLHVCQUF1QixDQUFDbUMsT0FBTyxDQUFDLENBQUMsRUFBRztNQUNyRUYsYUFBYSxDQUFDRyxJQUFJLENBQUVDLGtCQUFrQixDQUFFSCxHQUFHLEVBQUV2QixLQUFNLENBQUUsQ0FBQztJQUN4RDtJQUVBLElBQUksQ0FBQzJCLFFBQVEsR0FBRyxJQUFJOUQsUUFBUSxDQUFFa0IsbUJBQW1CLEVBQUV1QyxhQUFhLEVBQUVwQyxrQkFBa0IsRUFBRTtNQUNwRjBDLFFBQVEsRUFBRXRELHlCQUF5QixDQUFDcUIsSUFBSSxDQUFDQyxRQUFRLENBQUNpQyxnQ0FBZ0M7TUFDbEZDLDJCQUEyQixFQUFFeEQseUJBQXlCLENBQUNxQixJQUFJLENBQUNDLFFBQVEsQ0FBQ2lDLGdDQUFnQztNQUNyR0UsOEJBQThCLEVBQUVBLENBQUEsS0FBTS9DLGNBQWMsQ0FBQ2dELHVDQUF1QyxDQUFDLENBQUM7TUFDOUZDLFFBQVEsRUFBRSxHQUFHO01BQUU7O01BRWY7TUFDQUMsTUFBTSxFQUFFL0M7SUFDVixDQUFFLENBQUM7SUFFSCxNQUFNZ0QseUJBQXlCLEdBQUcsSUFBSWhFLFNBQVMsQ0FBQyxDQUFDO0lBQ2pEWSxtQkFBbUIsQ0FBQ3FELFFBQVEsQ0FBRSxNQUFNO01BQ2xDRCx5QkFBeUIsQ0FBQ0UsS0FBSyxHQUFHckQsY0FBYyxDQUFDZ0QsdUNBQXVDLENBQUMsQ0FBQztNQUMxRixJQUFJLENBQUNNLHlCQUF5QixDQUFFSCx5QkFBMEIsQ0FBQztJQUM3RCxDQUFFLENBQUM7SUFFSCxJQUFJLENBQUNJLFFBQVEsR0FBRyxDQUNkckIsZUFBZSxFQUNmLElBQUksQ0FBQ1MsUUFBUSxDQUNkO0lBRUQsSUFBSSxDQUFDYSxTQUFTLEdBQUcsQ0FBRXRCLGVBQWUsRUFBRSxJQUFJLENBQUNTLFFBQVEsQ0FBRTtFQUNyRDtFQUVPYyxXQUFXQSxDQUFBLEVBQVM7SUFDekIsSUFBSSxDQUFDZCxRQUFRLENBQUNjLFdBQVcsQ0FBQyxDQUFDO0VBQzdCO0FBQ0Y7QUFFQSxTQUFTZixrQkFBa0JBLENBQUVaLFdBQW1CLEVBQUU0QixhQUE0QixFQUF5QjtFQUVyRyxNQUFNQyxJQUFJLEdBQUcsSUFBSXBFLElBQUksQ0FBRTtJQUNyQnFFLE9BQU8sRUFBRSxDQUFDO0lBQ1ZMLFFBQVEsRUFBRSxDQUNSLElBQUk5RCxTQUFTLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFO01BQUVvRSxJQUFJLEVBQUVILGFBQWEsQ0FBQzVDO0lBQU0sQ0FBRSxDQUFDLEVBQzVELElBQUlwQixRQUFRLENBQUVnRSxhQUFhLENBQUNsRCx5QkFBMEIsQ0FBQztFQUMzRCxDQUFFLENBQUM7RUFFSCxPQUFPO0lBQ0xRLEtBQUssRUFBRWMsV0FBVztJQUNsQmdDLFVBQVUsRUFBRVosTUFBTSxJQUFJUyxJQUFJO0lBQzFCSSxXQUFXLEVBQUVMLGFBQWEsQ0FBQ3pDLFNBQVM7SUFDcEMrQyxRQUFRLEVBQUVOLGFBQWEsQ0FBQ3hDLHNCQUFzQjtJQUM5Q0MsVUFBVSxFQUFFdUMsYUFBYSxDQUFDdkM7RUFDNUIsQ0FBQztBQUNIO0FBRUE5QixrQkFBa0IsQ0FBQzRFLFFBQVEsQ0FBRSw0QkFBNEIsRUFBRXBFLDBCQUEyQixDQUFDO0FBQ3ZGLGVBQWVBLDBCQUEwQiJ9