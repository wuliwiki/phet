// Copyright 2020-2022, University of Colorado Boulder

/**
 * Class responsible for formulating quantitative description strings about position, based on the value of the ratio
 * relative to the tick marks in the screen.
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import Utils from '../../../../../dot/js/Utils.js';
import ratioAndProportion from '../../../ratioAndProportion.js';
import RatioAndProportionStrings from '../../../RatioAndProportionStrings.js';
import rapConstants from '../../rapConstants.js';
import TickMarkView from '../TickMarkView.js';
const ORDINAL_TICK_MARKS = [null, RatioAndProportionStrings.a11y.tickMark.ordinal.firstStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.secondStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.thirdStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.fourthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.fifthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.sixthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.seventhStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.eighthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.ninthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.tenthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.eleventhStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.twelfthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.thirteenthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.fourteenthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.fifteenthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.sixteenthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.seventeenthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.eighteenthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.nineteenthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.twentiethStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.twentyFirstStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.twentySecondStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.twentyThirdStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.twentyFourthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.twentyFifthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.twentySixthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.twentySeventhStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.twentyEighthStringProperty.value, RatioAndProportionStrings.a11y.tickMark.ordinal.twentyNinthStringProperty.value];
const zeroString = RatioAndProportionStrings.a11y.tickMark.relative.zeroStringProperty.value;
// The value in which up to and including this value, the relative description will apply to the value of the tick mark
// rounded down, instead of up, from this remainder.
const ROUND_DOWN_THRESHOLD = 0.7;
const TOTAL_RANGE = rapConstants.TOTAL_RATIO_TERM_VALUE_RANGE;
class TickMarkDescriber {
  constructor(tickMarkRangeProperty, tickMarkViewProperty) {
    this.tickMarkRangeProperty = tickMarkRangeProperty;
    this.tickMarkViewProperty = tickMarkViewProperty;
  }

  /**
   * Implemented like https://github.com/phetsims/ratio-and-proportion/issues/198#issuecomment-710029471 and https://github.com/phetsims/ratio-and-proportion/issues/198#issuecomment-728344102
   * This is a complicated function for a complicated design specification. Logic can split depending on tick mark view
   * with certain edge cases (like for "zero" case).
   */
  getRelativePositionAndTickMarkNumberForPosition(handPosition) {
    assert && assert(TOTAL_RANGE.contains(handPosition));

    // account for javascript rounding error, don't use rapConstants because we only want to handle rounding trouble.
    const normalized = Utils.toFixedNumber(TOTAL_RANGE.getNormalizedValue(handPosition), 9);
    const numberOfTickMarks = this.tickMarkRangeProperty.value;

    // account for javascript rounding error, less decimal places that above so that remander can be created correctly.
    const expandedValue = Utils.toFixedNumber(normalized * numberOfTickMarks, 7);
    let remainder = expandedValue % 1;
    if (Utils.toFixedNumber(remainder, 2) === rapConstants.toFixed(remainder)) {
      // eslint-disable-line bad-sim-text
      remainder = rapConstants.toFixed(remainder); // eslint-disable-line bad-sim-text
    }

    assert && assert(remainder < 1 && remainder >= 0, 'remainder not in range');
    const roundedUp = Math.ceil(expandedValue);
    const roundedDown = Math.floor(expandedValue);
    const tickMarkNumber = remainder > ROUND_DOWN_THRESHOLD ? roundedUp : roundedDown;
    let tickMarkDisplayedNumber = tickMarkNumber; // could be `tickMarkNumber + .5` depending on the tick mark view
    let relativePosition = null;
    const inZeroCase = tickMarkNumber === 0;
    let ordinalPosition = tickMarkNumber === numberOfTickMarks ? null : inZeroCase ? ORDINAL_TICK_MARKS[1] : ORDINAL_TICK_MARKS[tickMarkNumber];
    const useExactTickMarkValues = this.tickMarkViewProperty.value === TickMarkView.VISIBLE_WITH_UNITS;
    if (remainder === TOTAL_RANGE.min) {
      if (inZeroCase) {
        relativePosition = RatioAndProportionStrings.a11y.tickMark.relative.atStringProperty.value;
        tickMarkDisplayedNumber = zeroString;
        ordinalPosition = null;
      } else {
        relativePosition = RatioAndProportionStrings.a11y.tickMark.relative.onStringProperty.value;
      }
    } else if (remainder <= 0.2) {
      if (inZeroCase) {
        relativePosition = RatioAndProportionStrings.a11y.tickMark.relative.nearStringProperty.value;
        tickMarkDisplayedNumber = zeroString;
        ordinalPosition = null;
      } else {
        relativePosition = RatioAndProportionStrings.a11y.tickMark.relative.aroundStringProperty.value;
      }
    } else if (remainder <= ROUND_DOWN_THRESHOLD) {
      // handle these middle cases differently depending on current tickMarkView

      tickMarkDisplayedNumber += 0.5; // For these middle values, add .5

      if (remainder < 0.5) {
        relativePosition = useExactTickMarkValues ? RatioAndProportionStrings.a11y.tickMark.relative.almostOnStringProperty.value : inZeroCase ? RatioAndProportionStrings.a11y.tickMark.relative.almostHalfwayToStringProperty.value : RatioAndProportionStrings.a11y.tickMark.relative.almostHalfwayPastStringProperty.value;
      } else if (remainder === 0.5) {
        // If showing numbers, then the description looks like "on 2.5" instead of "half-way past second"
        relativePosition = useExactTickMarkValues ? RatioAndProportionStrings.a11y.tickMark.relative.onStringProperty.value : inZeroCase ? RatioAndProportionStrings.a11y.tickMark.relative.halfwayToStringProperty.value : RatioAndProportionStrings.a11y.tickMark.relative.halfwayPastStringProperty.value;
      } else if (remainder <= ROUND_DOWN_THRESHOLD) {
        relativePosition = useExactTickMarkValues ? RatioAndProportionStrings.a11y.tickMark.relative.aroundStringProperty.value : inZeroCase ? RatioAndProportionStrings.a11y.tickMark.relative.aroundHalfwayToStringProperty.value : RatioAndProportionStrings.a11y.tickMark.relative.aroundHalfwayPastStringProperty.value;
      } else {
        assert && assert(false, 'all cases should be covered');
      }
    } else if (remainder < 1) {
      relativePosition = RatioAndProportionStrings.a11y.tickMark.relative.almostOnStringProperty.value;
    } else {
      assert && assert(false, `unexpected remainder value: ${remainder}`);
    }
    assert && assert(ordinalPosition !== undefined, 'ordinal number not found');
    assert && assert(relativePosition);
    return {
      tickMarkPosition: tickMarkDisplayedNumber,
      relativePosition: relativePosition,
      ordinalPosition: ordinalPosition
    };
  }
}
ratioAndProportion.register('TickMarkDescriber', TickMarkDescriber);
export default TickMarkDescriber;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsInJhdGlvQW5kUHJvcG9ydGlvbiIsIlJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MiLCJyYXBDb25zdGFudHMiLCJUaWNrTWFya1ZpZXciLCJPUkRJTkFMX1RJQ0tfTUFSS1MiLCJhMTF5IiwidGlja01hcmsiLCJvcmRpbmFsIiwiZmlyc3RTdHJpbmdQcm9wZXJ0eSIsInZhbHVlIiwic2Vjb25kU3RyaW5nUHJvcGVydHkiLCJ0aGlyZFN0cmluZ1Byb3BlcnR5IiwiZm91cnRoU3RyaW5nUHJvcGVydHkiLCJmaWZ0aFN0cmluZ1Byb3BlcnR5Iiwic2l4dGhTdHJpbmdQcm9wZXJ0eSIsInNldmVudGhTdHJpbmdQcm9wZXJ0eSIsImVpZ2h0aFN0cmluZ1Byb3BlcnR5IiwibmludGhTdHJpbmdQcm9wZXJ0eSIsInRlbnRoU3RyaW5nUHJvcGVydHkiLCJlbGV2ZW50aFN0cmluZ1Byb3BlcnR5IiwidHdlbGZ0aFN0cmluZ1Byb3BlcnR5IiwidGhpcnRlZW50aFN0cmluZ1Byb3BlcnR5IiwiZm91cnRlZW50aFN0cmluZ1Byb3BlcnR5IiwiZmlmdGVlbnRoU3RyaW5nUHJvcGVydHkiLCJzaXh0ZWVudGhTdHJpbmdQcm9wZXJ0eSIsInNldmVudGVlbnRoU3RyaW5nUHJvcGVydHkiLCJlaWdodGVlbnRoU3RyaW5nUHJvcGVydHkiLCJuaW5ldGVlbnRoU3RyaW5nUHJvcGVydHkiLCJ0d2VudGlldGhTdHJpbmdQcm9wZXJ0eSIsInR3ZW50eUZpcnN0U3RyaW5nUHJvcGVydHkiLCJ0d2VudHlTZWNvbmRTdHJpbmdQcm9wZXJ0eSIsInR3ZW50eVRoaXJkU3RyaW5nUHJvcGVydHkiLCJ0d2VudHlGb3VydGhTdHJpbmdQcm9wZXJ0eSIsInR3ZW50eUZpZnRoU3RyaW5nUHJvcGVydHkiLCJ0d2VudHlTaXh0aFN0cmluZ1Byb3BlcnR5IiwidHdlbnR5U2V2ZW50aFN0cmluZ1Byb3BlcnR5IiwidHdlbnR5RWlnaHRoU3RyaW5nUHJvcGVydHkiLCJ0d2VudHlOaW50aFN0cmluZ1Byb3BlcnR5IiwiemVyb1N0cmluZyIsInJlbGF0aXZlIiwiemVyb1N0cmluZ1Byb3BlcnR5IiwiUk9VTkRfRE9XTl9USFJFU0hPTEQiLCJUT1RBTF9SQU5HRSIsIlRPVEFMX1JBVElPX1RFUk1fVkFMVUVfUkFOR0UiLCJUaWNrTWFya0Rlc2NyaWJlciIsImNvbnN0cnVjdG9yIiwidGlja01hcmtSYW5nZVByb3BlcnR5IiwidGlja01hcmtWaWV3UHJvcGVydHkiLCJnZXRSZWxhdGl2ZVBvc2l0aW9uQW5kVGlja01hcmtOdW1iZXJGb3JQb3NpdGlvbiIsImhhbmRQb3NpdGlvbiIsImFzc2VydCIsImNvbnRhaW5zIiwibm9ybWFsaXplZCIsInRvRml4ZWROdW1iZXIiLCJnZXROb3JtYWxpemVkVmFsdWUiLCJudW1iZXJPZlRpY2tNYXJrcyIsImV4cGFuZGVkVmFsdWUiLCJyZW1haW5kZXIiLCJ0b0ZpeGVkIiwicm91bmRlZFVwIiwiTWF0aCIsImNlaWwiLCJyb3VuZGVkRG93biIsImZsb29yIiwidGlja01hcmtOdW1iZXIiLCJ0aWNrTWFya0Rpc3BsYXllZE51bWJlciIsInJlbGF0aXZlUG9zaXRpb24iLCJpblplcm9DYXNlIiwib3JkaW5hbFBvc2l0aW9uIiwidXNlRXhhY3RUaWNrTWFya1ZhbHVlcyIsIlZJU0lCTEVfV0lUSF9VTklUUyIsIm1pbiIsImF0U3RyaW5nUHJvcGVydHkiLCJvblN0cmluZ1Byb3BlcnR5IiwibmVhclN0cmluZ1Byb3BlcnR5IiwiYXJvdW5kU3RyaW5nUHJvcGVydHkiLCJhbG1vc3RPblN0cmluZ1Byb3BlcnR5IiwiYWxtb3N0SGFsZndheVRvU3RyaW5nUHJvcGVydHkiLCJhbG1vc3RIYWxmd2F5UGFzdFN0cmluZ1Byb3BlcnR5IiwiaGFsZndheVRvU3RyaW5nUHJvcGVydHkiLCJoYWxmd2F5UGFzdFN0cmluZ1Byb3BlcnR5IiwiYXJvdW5kSGFsZndheVRvU3RyaW5nUHJvcGVydHkiLCJhcm91bmRIYWxmd2F5UGFzdFN0cmluZ1Byb3BlcnR5IiwidW5kZWZpbmVkIiwidGlja01hcmtQb3NpdGlvbiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiVGlja01hcmtEZXNjcmliZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjAtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQ2xhc3MgcmVzcG9uc2libGUgZm9yIGZvcm11bGF0aW5nIHF1YW50aXRhdGl2ZSBkZXNjcmlwdGlvbiBzdHJpbmdzIGFib3V0IHBvc2l0aW9uLCBiYXNlZCBvbiB0aGUgdmFsdWUgb2YgdGhlIHJhdGlvXHJcbiAqIHJlbGF0aXZlIHRvIHRoZSB0aWNrIG1hcmtzIGluIHRoZSBzY3JlZW4uXHJcbiAqIEBhdXRob3IgTWljaGFlbCBLYXV6bWFubiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IHJhdGlvQW5kUHJvcG9ydGlvbiBmcm9tICcuLi8uLi8uLi9yYXRpb0FuZFByb3BvcnRpb24uanMnO1xyXG5pbXBvcnQgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncyBmcm9tICcuLi8uLi8uLi9SYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmpzJztcclxuaW1wb3J0IHJhcENvbnN0YW50cyBmcm9tICcuLi8uLi9yYXBDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgVGlja01hcmtWaWV3IGZyb20gJy4uL1RpY2tNYXJrVmlldy5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IEVudW1lcmF0aW9uUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vLi4vYXhvbi9qcy9FbnVtZXJhdGlvblByb3BlcnR5LmpzJztcclxuXHJcbmNvbnN0IE9SRElOQUxfVElDS19NQVJLUyA9IFtcclxuICBudWxsLFxyXG4gIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5vcmRpbmFsLmZpcnN0U3RyaW5nUHJvcGVydHkudmFsdWUsXHJcbiAgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLm9yZGluYWwuc2Vjb25kU3RyaW5nUHJvcGVydHkudmFsdWUsXHJcbiAgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLm9yZGluYWwudGhpcmRTdHJpbmdQcm9wZXJ0eS52YWx1ZSxcclxuICBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsub3JkaW5hbC5mb3VydGhTdHJpbmdQcm9wZXJ0eS52YWx1ZSxcclxuICBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsub3JkaW5hbC5maWZ0aFN0cmluZ1Byb3BlcnR5LnZhbHVlLFxyXG4gIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5vcmRpbmFsLnNpeHRoU3RyaW5nUHJvcGVydHkudmFsdWUsXHJcbiAgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLm9yZGluYWwuc2V2ZW50aFN0cmluZ1Byb3BlcnR5LnZhbHVlLFxyXG4gIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5vcmRpbmFsLmVpZ2h0aFN0cmluZ1Byb3BlcnR5LnZhbHVlLFxyXG4gIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5vcmRpbmFsLm5pbnRoU3RyaW5nUHJvcGVydHkudmFsdWUsXHJcbiAgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLm9yZGluYWwudGVudGhTdHJpbmdQcm9wZXJ0eS52YWx1ZSxcclxuICBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsub3JkaW5hbC5lbGV2ZW50aFN0cmluZ1Byb3BlcnR5LnZhbHVlLFxyXG4gIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5vcmRpbmFsLnR3ZWxmdGhTdHJpbmdQcm9wZXJ0eS52YWx1ZSxcclxuICBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsub3JkaW5hbC50aGlydGVlbnRoU3RyaW5nUHJvcGVydHkudmFsdWUsXHJcbiAgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLm9yZGluYWwuZm91cnRlZW50aFN0cmluZ1Byb3BlcnR5LnZhbHVlLFxyXG4gIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5vcmRpbmFsLmZpZnRlZW50aFN0cmluZ1Byb3BlcnR5LnZhbHVlLFxyXG4gIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5vcmRpbmFsLnNpeHRlZW50aFN0cmluZ1Byb3BlcnR5LnZhbHVlLFxyXG4gIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5vcmRpbmFsLnNldmVudGVlbnRoU3RyaW5nUHJvcGVydHkudmFsdWUsXHJcbiAgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLm9yZGluYWwuZWlnaHRlZW50aFN0cmluZ1Byb3BlcnR5LnZhbHVlLFxyXG4gIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5vcmRpbmFsLm5pbmV0ZWVudGhTdHJpbmdQcm9wZXJ0eS52YWx1ZSxcclxuICBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsub3JkaW5hbC50d2VudGlldGhTdHJpbmdQcm9wZXJ0eS52YWx1ZSxcclxuICBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsub3JkaW5hbC50d2VudHlGaXJzdFN0cmluZ1Byb3BlcnR5LnZhbHVlLFxyXG4gIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5vcmRpbmFsLnR3ZW50eVNlY29uZFN0cmluZ1Byb3BlcnR5LnZhbHVlLFxyXG4gIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5vcmRpbmFsLnR3ZW50eVRoaXJkU3RyaW5nUHJvcGVydHkudmFsdWUsXHJcbiAgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLm9yZGluYWwudHdlbnR5Rm91cnRoU3RyaW5nUHJvcGVydHkudmFsdWUsXHJcbiAgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLm9yZGluYWwudHdlbnR5RmlmdGhTdHJpbmdQcm9wZXJ0eS52YWx1ZSxcclxuICBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsub3JkaW5hbC50d2VudHlTaXh0aFN0cmluZ1Byb3BlcnR5LnZhbHVlLFxyXG4gIFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5vcmRpbmFsLnR3ZW50eVNldmVudGhTdHJpbmdQcm9wZXJ0eS52YWx1ZSxcclxuICBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsub3JkaW5hbC50d2VudHlFaWdodGhTdHJpbmdQcm9wZXJ0eS52YWx1ZSxcclxuICBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsub3JkaW5hbC50d2VudHlOaW50aFN0cmluZ1Byb3BlcnR5LnZhbHVlXHJcbl07XHJcblxyXG5jb25zdCB6ZXJvU3RyaW5nID0gUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLnJlbGF0aXZlLnplcm9TdHJpbmdQcm9wZXJ0eS52YWx1ZSBhcyAnemVybyc7XHJcblxyXG50eXBlIFRpY2tNYXJrRGVzY3JpcHRpb25EYXRhID0ge1xyXG4gIHRpY2tNYXJrUG9zaXRpb246IG51bWJlciB8ICd6ZXJvJztcclxuICByZWxhdGl2ZVBvc2l0aW9uOiBzdHJpbmc7XHJcbiAgb3JkaW5hbFBvc2l0aW9uOiBzdHJpbmcgfCBudWxsO1xyXG59O1xyXG5cclxuXHJcbi8vIFRoZSB2YWx1ZSBpbiB3aGljaCB1cCB0byBhbmQgaW5jbHVkaW5nIHRoaXMgdmFsdWUsIHRoZSByZWxhdGl2ZSBkZXNjcmlwdGlvbiB3aWxsIGFwcGx5IHRvIHRoZSB2YWx1ZSBvZiB0aGUgdGljayBtYXJrXHJcbi8vIHJvdW5kZWQgZG93biwgaW5zdGVhZCBvZiB1cCwgZnJvbSB0aGlzIHJlbWFpbmRlci5cclxuY29uc3QgUk9VTkRfRE9XTl9USFJFU0hPTEQgPSAwLjc7XHJcbmNvbnN0IFRPVEFMX1JBTkdFID0gcmFwQ29uc3RhbnRzLlRPVEFMX1JBVElPX1RFUk1fVkFMVUVfUkFOR0U7XHJcblxyXG5jbGFzcyBUaWNrTWFya0Rlc2NyaWJlciB7XHJcblxyXG4gIHByaXZhdGUgdGlja01hcmtSYW5nZVByb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+O1xyXG4gIHByaXZhdGUgdGlja01hcmtWaWV3UHJvcGVydHk6IEVudW1lcmF0aW9uUHJvcGVydHk8VGlja01hcmtWaWV3PjtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCB0aWNrTWFya1JhbmdlUHJvcGVydHk6IFByb3BlcnR5PG51bWJlcj4sIHRpY2tNYXJrVmlld1Byb3BlcnR5OiBFbnVtZXJhdGlvblByb3BlcnR5PFRpY2tNYXJrVmlldz4gKSB7XHJcbiAgICB0aGlzLnRpY2tNYXJrUmFuZ2VQcm9wZXJ0eSA9IHRpY2tNYXJrUmFuZ2VQcm9wZXJ0eTtcclxuICAgIHRoaXMudGlja01hcmtWaWV3UHJvcGVydHkgPSB0aWNrTWFya1ZpZXdQcm9wZXJ0eTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEltcGxlbWVudGVkIGxpa2UgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3JhdGlvLWFuZC1wcm9wb3J0aW9uL2lzc3Vlcy8xOTgjaXNzdWVjb21tZW50LTcxMDAyOTQ3MSBhbmQgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3JhdGlvLWFuZC1wcm9wb3J0aW9uL2lzc3Vlcy8xOTgjaXNzdWVjb21tZW50LTcyODM0NDEwMlxyXG4gICAqIFRoaXMgaXMgYSBjb21wbGljYXRlZCBmdW5jdGlvbiBmb3IgYSBjb21wbGljYXRlZCBkZXNpZ24gc3BlY2lmaWNhdGlvbi4gTG9naWMgY2FuIHNwbGl0IGRlcGVuZGluZyBvbiB0aWNrIG1hcmsgdmlld1xyXG4gICAqIHdpdGggY2VydGFpbiBlZGdlIGNhc2VzIChsaWtlIGZvciBcInplcm9cIiBjYXNlKS5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0UmVsYXRpdmVQb3NpdGlvbkFuZFRpY2tNYXJrTnVtYmVyRm9yUG9zaXRpb24oIGhhbmRQb3NpdGlvbjogbnVtYmVyICk6IFRpY2tNYXJrRGVzY3JpcHRpb25EYXRhIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIFRPVEFMX1JBTkdFLmNvbnRhaW5zKCBoYW5kUG9zaXRpb24gKSApO1xyXG5cclxuICAgIC8vIGFjY291bnQgZm9yIGphdmFzY3JpcHQgcm91bmRpbmcgZXJyb3IsIGRvbid0IHVzZSByYXBDb25zdGFudHMgYmVjYXVzZSB3ZSBvbmx5IHdhbnQgdG8gaGFuZGxlIHJvdW5kaW5nIHRyb3VibGUuXHJcbiAgICBjb25zdCBub3JtYWxpemVkID0gVXRpbHMudG9GaXhlZE51bWJlciggVE9UQUxfUkFOR0UuZ2V0Tm9ybWFsaXplZFZhbHVlKCBoYW5kUG9zaXRpb24gKSwgOSApO1xyXG4gICAgY29uc3QgbnVtYmVyT2ZUaWNrTWFya3MgPSB0aGlzLnRpY2tNYXJrUmFuZ2VQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICAvLyBhY2NvdW50IGZvciBqYXZhc2NyaXB0IHJvdW5kaW5nIGVycm9yLCBsZXNzIGRlY2ltYWwgcGxhY2VzIHRoYXQgYWJvdmUgc28gdGhhdCByZW1hbmRlciBjYW4gYmUgY3JlYXRlZCBjb3JyZWN0bHkuXHJcbiAgICBjb25zdCBleHBhbmRlZFZhbHVlID0gVXRpbHMudG9GaXhlZE51bWJlciggbm9ybWFsaXplZCAqIG51bWJlck9mVGlja01hcmtzLCA3ICk7XHJcblxyXG4gICAgbGV0IHJlbWFpbmRlciA9IGV4cGFuZGVkVmFsdWUgJSAxO1xyXG5cclxuICAgIGlmICggVXRpbHMudG9GaXhlZE51bWJlciggcmVtYWluZGVyLCAyICkgPT09IHJhcENvbnN0YW50cy50b0ZpeGVkKCByZW1haW5kZXIgKSApIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBiYWQtc2ltLXRleHRcclxuICAgICAgcmVtYWluZGVyID0gcmFwQ29uc3RhbnRzLnRvRml4ZWQoIHJlbWFpbmRlciApOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGJhZC1zaW0tdGV4dFxyXG4gICAgfVxyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHJlbWFpbmRlciA8IDEgJiYgcmVtYWluZGVyID49IDAsICdyZW1haW5kZXIgbm90IGluIHJhbmdlJyApO1xyXG5cclxuICAgIGNvbnN0IHJvdW5kZWRVcCA9IE1hdGguY2VpbCggZXhwYW5kZWRWYWx1ZSApO1xyXG4gICAgY29uc3Qgcm91bmRlZERvd24gPSBNYXRoLmZsb29yKCBleHBhbmRlZFZhbHVlICk7XHJcbiAgICBjb25zdCB0aWNrTWFya051bWJlciA9IHJlbWFpbmRlciA+IFJPVU5EX0RPV05fVEhSRVNIT0xEID8gcm91bmRlZFVwIDogcm91bmRlZERvd247XHJcbiAgICBsZXQgdGlja01hcmtEaXNwbGF5ZWROdW1iZXI6IG51bWJlciB8ICd6ZXJvJyA9IHRpY2tNYXJrTnVtYmVyOyAvLyBjb3VsZCBiZSBgdGlja01hcmtOdW1iZXIgKyAuNWAgZGVwZW5kaW5nIG9uIHRoZSB0aWNrIG1hcmsgdmlld1xyXG4gICAgbGV0IHJlbGF0aXZlUG9zaXRpb24gPSBudWxsO1xyXG5cclxuICAgIGNvbnN0IGluWmVyb0Nhc2UgPSB0aWNrTWFya051bWJlciA9PT0gMDtcclxuICAgIGxldCBvcmRpbmFsUG9zaXRpb24gPSB0aWNrTWFya051bWJlciA9PT0gbnVtYmVyT2ZUaWNrTWFya3MgPyBudWxsIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBpblplcm9DYXNlID8gT1JESU5BTF9USUNLX01BUktTWyAxIF0gOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIE9SRElOQUxfVElDS19NQVJLU1sgdGlja01hcmtOdW1iZXIgXTtcclxuXHJcbiAgICBjb25zdCB1c2VFeGFjdFRpY2tNYXJrVmFsdWVzID0gdGhpcy50aWNrTWFya1ZpZXdQcm9wZXJ0eS52YWx1ZSA9PT0gVGlja01hcmtWaWV3LlZJU0lCTEVfV0lUSF9VTklUUztcclxuXHJcbiAgICBpZiAoIHJlbWFpbmRlciA9PT0gVE9UQUxfUkFOR0UubWluICkge1xyXG4gICAgICBpZiAoIGluWmVyb0Nhc2UgKSB7XHJcbiAgICAgICAgcmVsYXRpdmVQb3NpdGlvbiA9IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5yZWxhdGl2ZS5hdFN0cmluZ1Byb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgICAgICB0aWNrTWFya0Rpc3BsYXllZE51bWJlciA9IHplcm9TdHJpbmc7XHJcbiAgICAgICAgb3JkaW5hbFBvc2l0aW9uID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZWxhdGl2ZVBvc2l0aW9uID0gUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLnJlbGF0aXZlLm9uU3RyaW5nUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCByZW1haW5kZXIgPD0gMC4yICkge1xyXG4gICAgICBpZiAoIGluWmVyb0Nhc2UgKSB7XHJcbiAgICAgICAgcmVsYXRpdmVQb3NpdGlvbiA9IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5yZWxhdGl2ZS5uZWFyU3RyaW5nUHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgICAgIHRpY2tNYXJrRGlzcGxheWVkTnVtYmVyID0gemVyb1N0cmluZztcclxuICAgICAgICBvcmRpbmFsUG9zaXRpb24gPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJlbGF0aXZlUG9zaXRpb24gPSBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsucmVsYXRpdmUuYXJvdW5kU3RyaW5nUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCByZW1haW5kZXIgPD0gUk9VTkRfRE9XTl9USFJFU0hPTEQgKSB7XHJcbiAgICAgIC8vIGhhbmRsZSB0aGVzZSBtaWRkbGUgY2FzZXMgZGlmZmVyZW50bHkgZGVwZW5kaW5nIG9uIGN1cnJlbnQgdGlja01hcmtWaWV3XHJcblxyXG4gICAgICB0aWNrTWFya0Rpc3BsYXllZE51bWJlciArPSAwLjU7IC8vIEZvciB0aGVzZSBtaWRkbGUgdmFsdWVzLCBhZGQgLjVcclxuXHJcbiAgICAgIGlmICggcmVtYWluZGVyIDwgMC41ICkge1xyXG4gICAgICAgIHJlbGF0aXZlUG9zaXRpb24gPSB1c2VFeGFjdFRpY2tNYXJrVmFsdWVzID8gUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLnJlbGF0aXZlLmFsbW9zdE9uU3RyaW5nUHJvcGVydHkudmFsdWUgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBpblplcm9DYXNlID8gUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLnJlbGF0aXZlLmFsbW9zdEhhbGZ3YXlUb1N0cmluZ1Byb3BlcnR5LnZhbHVlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLnJlbGF0aXZlLmFsbW9zdEhhbGZ3YXlQYXN0U3RyaW5nUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHJlbWFpbmRlciA9PT0gMC41ICkge1xyXG5cclxuICAgICAgICAvLyBJZiBzaG93aW5nIG51bWJlcnMsIHRoZW4gdGhlIGRlc2NyaXB0aW9uIGxvb2tzIGxpa2UgXCJvbiAyLjVcIiBpbnN0ZWFkIG9mIFwiaGFsZi13YXkgcGFzdCBzZWNvbmRcIlxyXG4gICAgICAgIHJlbGF0aXZlUG9zaXRpb24gPSB1c2VFeGFjdFRpY2tNYXJrVmFsdWVzID8gUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLnJlbGF0aXZlLm9uU3RyaW5nUHJvcGVydHkudmFsdWUgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBpblplcm9DYXNlID8gUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLnJlbGF0aXZlLmhhbGZ3YXlUb1N0cmluZ1Byb3BlcnR5LnZhbHVlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LnRpY2tNYXJrLnJlbGF0aXZlLmhhbGZ3YXlQYXN0U3RyaW5nUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHJlbWFpbmRlciA8PSBST1VORF9ET1dOX1RIUkVTSE9MRCApIHtcclxuICAgICAgICByZWxhdGl2ZVBvc2l0aW9uID0gdXNlRXhhY3RUaWNrTWFya1ZhbHVlcyA/IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS50aWNrTWFyay5yZWxhdGl2ZS5hcm91bmRTdHJpbmdQcm9wZXJ0eS52YWx1ZSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGluWmVyb0Nhc2UgPyBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsucmVsYXRpdmUuYXJvdW5kSGFsZndheVRvU3RyaW5nUHJvcGVydHkudmFsdWUgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsucmVsYXRpdmUuYXJvdW5kSGFsZndheVBhc3RTdHJpbmdQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmYWxzZSwgJ2FsbCBjYXNlcyBzaG91bGQgYmUgY292ZXJlZCcgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIHJlbWFpbmRlciA8IDEgKSB7XHJcbiAgICAgIHJlbGF0aXZlUG9zaXRpb24gPSBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzLmExMXkudGlja01hcmsucmVsYXRpdmUuYWxtb3N0T25TdHJpbmdQcm9wZXJ0eS52YWx1ZTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmYWxzZSwgYHVuZXhwZWN0ZWQgcmVtYWluZGVyIHZhbHVlOiAke3JlbWFpbmRlcn1gICk7XHJcbiAgICB9XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3JkaW5hbFBvc2l0aW9uICE9PSB1bmRlZmluZWQsICdvcmRpbmFsIG51bWJlciBub3QgZm91bmQnICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggcmVsYXRpdmVQb3NpdGlvbiApO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdGlja01hcmtQb3NpdGlvbjogdGlja01hcmtEaXNwbGF5ZWROdW1iZXIsXHJcblxyXG4gICAgICByZWxhdGl2ZVBvc2l0aW9uOiByZWxhdGl2ZVBvc2l0aW9uISxcclxuICAgICAgb3JkaW5hbFBvc2l0aW9uOiBvcmRpbmFsUG9zaXRpb25cclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5yYXRpb0FuZFByb3BvcnRpb24ucmVnaXN0ZXIoICdUaWNrTWFya0Rlc2NyaWJlcicsIFRpY2tNYXJrRGVzY3JpYmVyICk7XHJcbmV4cG9ydCBkZWZhdWx0IFRpY2tNYXJrRGVzY3JpYmVyOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxLQUFLLE1BQU0sZ0NBQWdDO0FBQ2xELE9BQU9DLGtCQUFrQixNQUFNLGdDQUFnQztBQUMvRCxPQUFPQyx5QkFBeUIsTUFBTSx1Q0FBdUM7QUFDN0UsT0FBT0MsWUFB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