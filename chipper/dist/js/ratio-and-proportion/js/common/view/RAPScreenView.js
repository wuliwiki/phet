// Copyright 2020-2022, University of Colorado Boulder

/**
 * Base class ScreenView which creates view components that all screens use. This includes the central ratio "scene" which
 * has two RatioHalf instances and supports showing tick marks and their labels. There is a RadioButtonGroup to control
 * the tick mark view too. Subtypes are responsible for creating a control for changing the model's targetRatioProperty.
 *
 * This type creates its own layout function, because the ratio interaction is inherently quite vertical. This type
 * maximizes the vertical space of a layout and extends the ratio to a vertical aspect ratio when possible. It also
 * supports scaling up UI controls (on the right) to match the aspect ratio. See this.topScalingUILayerNode and
 * this.bottomScalingUILayerNode for more details.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Property from '../../../../axon/js/Property.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import LinearFunction from '../../../../dot/js/LinearFunction.js';
import Utils from '../../../../dot/js/Utils.js';
import ScreenView from '../../../../joist/js/ScreenView.js';
import merge from '../../../../phet-core/js/merge.js';
import optionize from '../../../../phet-core/js/optionize.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import { Color, ParallelDOM, VBox, Voicing, voicingUtteranceQueue } from '../../../../scenery/js/imports.js';
import soundManager from '../../../../tambo/js/soundManager.js';
import ratioAndProportion from '../../ratioAndProportion.js';
import RatioAndProportionStrings from '../../RatioAndProportionStrings.js';
import RatioTerm from '../model/RatioTerm.js';
import rapConstants from '../rapConstants.js';
import RAPQueryParameters from '../RAPQueryParameters.js';
import BothHandsPDOMNode from './BothHandsPDOMNode.js';
import CueArrowsState from './CueArrowsState.js';
import BothHandsDescriber from './describers/BothHandsDescriber.js';
import RatioDescriber from './describers/RatioDescriber.js';
import TickMarkDescriber from './describers/TickMarkDescriber.js';
import RAPColors from './RAPColors.js';
import RAPTickMarkLabelsNode from './RAPTickMarkLabelsNode.js';
import RatioHalf from './RatioHalf.js';
import InProportionSoundGenerator from './sound/InProportionSoundGenerator.js';
import MovingInProportionSoundGenerator from './sound/MovingInProportionSoundGenerator.js';
import StaccatoFrequencySoundGenerator from './sound/StaccatoFrequencySoundGenerator.js';
import TickMarkView from './TickMarkView.js';
import TickMarkViewRadioButtonGroup from './TickMarkViewRadioButtonGroup.js';
import CueDisplay from './CueDisplay.js';
import RAPPositionRegionsLayer from './RAPPositionRegionsLayer.js';
import BackgroundColorHandler from './BackgroundColorHandler.js';
import EnumerationProperty from '../../../../axon/js/EnumerationProperty.js';
import RAPMediaPipe from './RAPMediaPipe.js';
import Utterance from '../../../../utterance-queue/js/Utterance.js';
import ResponsePacket from '../../../../utterance-queue/js/ResponsePacket.js';
import RatioInputModality from './describers/RatioInputModality.js';
import RatioAndProportionBluetoothButton from './RatioAndProportionBluetoothButton.js';
import DistanceResponseType from './describers/DistanceResponseType.js';
import Emitter from '../../../../axon/js/Emitter.js';
import Multilink from '../../../../axon/js/Multilink.js';
import MediaPipeQueryParameters from '../../../../tangible/js/mediaPipe/MediaPipeQueryParameters.js';

// constants
const LAYOUT_BOUNDS = ScreenView.DEFAULT_LAYOUT_BOUNDS;
const MAX_RATIO_HEIGHT = LAYOUT_BOUNDS.width * 2; // relatively arbitrary, but good to set a max, so it can't get too skinny
const ONE_QUARTER_LAYOUT_WIDTH = LAYOUT_BOUNDS.width * 0.25;
const RATIO_HALF_WIDTH = ONE_QUARTER_LAYOUT_WIDTH;
const RATIO_HALF_SPACING = 10;

// Percentage of the layout bounds width that is taken up by the ratio (including margins) rather than the control
// area on the right.
const RATIO_SECTION_WIDTH = 2 / 3;
const uiScaleFunction = new LinearFunction(LAYOUT_BOUNDS.height, MAX_RATIO_HEIGHT, 1, 1.5, true);
const uiPositionFunction = new LinearFunction(1, 1.5, LAYOUT_BOUNDS.height * 0.15, -LAYOUT_BOUNDS.height * 0.2, true);
class RAPScreenView extends ScreenView {
  // What is the unit value of the tick marks. Value reads as "1/x of the view height."

  // SoundGenerators that sonify different aspects of the model

  // Keep a separate layer for "control-panel-esque"  UI on the right. This allows them to be scaled
  // to maximize their size within the horizontal space in vertical aspect ratios, see https://github.com/phetsims/ratio-and-proportion/issues/79
  // These are two separate containers so that scaling them can take away space in between them while keeping each
  // positioned based on the corners of the layout.
  topScalingUILayerNode = new VBox({
    align: 'right',
    spacing: 20
  });
  bottomScalingUILayerNode = new VBox({
    align: 'right',
    spacing: 20
  });
  stepEmitter = new Emitter({
    parameters: [{
      valueType: 'number'
    }]
  });
  constructor(model, backgroundColorProperty, providedOptions) {
    const options = optionize()({
      layoutBounds: LAYOUT_BOUNDS,
      // Properties that control the color of each hand
      leftHandColorProperty: new Property(Color.BLACK),
      rightHandColorProperty: new Property(Color.BLACK),
      // Passed through to BothHandsPDOMNode
      bothHandsPDOMNodeOptions: {}
    }, providedOptions);
    super(options);

    // for ease at usage sites
    const ratio = model.ratio;
    this.tickMarkViewProperty = new EnumerationProperty(TickMarkView.NONE, {
      tandem: options.tandem.createTandem('tickMarkViewProperty')
    });
    this.tickMarkRangeProperty = new NumberProperty(10, {
      tandem: options.tandem.createTandem('tickMarkRangeProperty')
    });
    this.backgroundColorHandler = new BackgroundColorHandler(model, backgroundColorProperty);
    this.ratioDescriber = new RatioDescriber(model);

    // A collection of properties that keep track of which cues should be displayed for both the antecedent and consequent hands.
    const cueArrowsState = new CueArrowsState();
    const tickMarksAndLabelsColorProperty = new DerivedProperty([model.ratioFitnessProperty], fitness => Color.interpolateRGBA(RAPColors.tickMarksAndLabelsOutOfFitnessProperty.value, RAPColors.tickMarksAndLabelsInFitnessProperty.value, fitness));

    // Tick mark sounds get played when ratio isn't locked, and when staccato sounds aren't playing
    const playTickMarkBumpSoundProperty = new DerivedProperty([model.ratioFitnessProperty], fitness => !model.ratio.lockedProperty.value && fitness === rapConstants.RATIO_FITNESS_RANGE.min);

    // by default, the keyboard step size should be half of one default tick mark width. See https://github.com/phetsims/ratio-and-proportion/issues/85
    // NOTE: do not change this without changing the copied constant in getKeyboardInputSnappingMapperTests.js
    const keyboardStep = 1 / 2 / this.tickMarkRangeProperty.value;
    const defaultRatioHalfBounds = Bounds2.rect(0, 0, RATIO_HALF_WIDTH, LAYOUT_BOUNDS.height);

    // description on each ratioHalf should be updated whenever these change
    const a11yDependencies = [model.unclampedFitnessProperty, this.tickMarkViewProperty, this.tickMarkRangeProperty, model.targetRatioProperty];
    this.antecedentRatioHalf = new RatioHalf({
      ratio: ratio,
      ratioTerm: RatioTerm.ANTECEDENT,
      displayBothHandsCueProperty: cueArrowsState.bothHands.antecedentCueDisplayedProperty,
      cueArrowsState: cueArrowsState,
      bounds: defaultRatioHalfBounds,
      tickMarkViewProperty: this.tickMarkViewProperty,
      tickMarkRangeProperty: this.tickMarkRangeProperty,
      ratioDescriber: this.ratioDescriber,
      colorProperty: tickMarksAndLabelsColorProperty,
      keyboardStep: keyboardStep,
      horizontalMovementAllowedProperty: model.ratio.lockedProperty,
      playTickMarkBumpSoundProperty: playTickMarkBumpSoundProperty,
      // Make this a closure so support creation order
      setJumpingOverProportionShouldTriggerSound: isJumping => this.inProportionSoundGenerator.setJumpingOverProportionShouldTriggerSound(isJumping),
      getIdealValue: () => model.getIdealValueForTerm(RatioTerm.ANTECEDENT),
      inProportionProperty: model.inProportionProperty,
      handColorProperty: options.leftHandColorProperty,
      accessibleName: RatioAndProportionStrings.a11y.leftHandStringProperty,
      a11yDependencies: a11yDependencies,
      bothHandsCueDisplay: CueDisplay.W_S,
      isRight: false,
      // this way we get a left hand

      // Added to the antecedent for ease, but it applies to both RatioHalfs in the PDOM
      helpText: RatioAndProportionStrings.a11y.individualHandsHelpTextStringProperty,
      helpTextBehavior: ParallelDOM.HELP_TEXT_BEFORE_CONTENT,
      // phet-io
      tandem: options.tandem.createTandem('antecedentRatioHalf')
    });
    this.consequentRatioHalf = new RatioHalf({
      ratio: ratio,
      ratioTerm: RatioTerm.CONSEQUENT,
      displayBothHandsCueProperty: cueArrowsState.bothHands.consequentCueDisplayedProperty,
      cueArrowsState: cueArrowsState,
      bounds: defaultRatioHalfBounds,
      tickMarkViewProperty: this.tickMarkViewProperty,
      tickMarkRangeProperty: this.tickMarkRangeProperty,
      ratioDescriber: this.ratioDescriber,
      colorProperty: tickMarksAndLabelsColorProperty,
      keyboardStep: keyboardStep,
      horizontalMovementAllowedProperty: model.ratio.lockedProperty,
      playTickMarkBumpSoundProperty: playTickMarkBumpSoundProperty,
      // Make this a closure so support creation order
      setJumpingOverProportionShouldTriggerSound: isJumping => this.inProportionSoundGenerator.setJumpingOverProportionShouldTriggerSound(isJumping),
      getIdealValue: () => model.getIdealValueForTerm(RatioTerm.CONSEQUENT),
      inProportionProperty: model.inProportionProperty,
      handColorProperty: options.rightHandColorProperty,
      accessibleName: RatioAndProportionStrings.a11y.rightHandStringProperty,
      a11yDependencies: a11yDependencies,
      // phet-io
      tandem: options.tandem.createTandem('consequentRatioHalf')
    });

    // TODO: how to handle this merge? It seems like PHET_CORE/merge is the best case for this, we are &ing the two arguments into BothHandsPDOMNode, https://github.com/phetsims/chipper/issues/1128
    const bothHandsPDOMNode = new BothHandsPDOMNode(merge({
      ratioTupleProperty: ratio.tupleProperty,
      enabledRatioTermsRangeProperty: ratio.enabledRatioTermsRangeProperty,
      cueArrowsState: cueArrowsState,
      keyboardStep: keyboardStep,
      tickMarkViewProperty: this.tickMarkViewProperty,
      tickMarkRangeProperty: this.tickMarkRangeProperty,
      unclampedFitnessProperty: model.unclampedFitnessProperty,
      ratioDescriber: this.ratioDescriber,
      playTickMarkBumpSoundProperty: playTickMarkBumpSoundProperty,
      ratioLockedProperty: model.ratio.lockedProperty,
      targetRatioProperty: model.targetRatioProperty,
      getIdealTerm: model.getIdealValueForTerm.bind(model),
      inProportionProperty: model.inProportionProperty,
      interactiveNodeOptions: {
        children: [this.antecedentRatioHalf, this.consequentRatioHalf]
      }
    }, options.bothHandsPDOMNodeOptions));
    this.mediaPipe = null;
    if (MediaPipeQueryParameters.cameraInput === 'hands') {
      const mediaPipeBothHandsDescriber = new BothHandsDescriber(ratio.tupleProperty, ratio.enabledRatioTermsRangeProperty, ratio.lockedProperty, this.tickMarkViewProperty, model.inProportionProperty, this.ratioDescriber, new TickMarkDescriber(this.tickMarkRangeProperty, this.tickMarkViewProperty));
      const mediaPipeVoicingEndDragUtterance = new Utterance({
        alert: new ResponsePacket({
          objectResponse: () => mediaPipeBothHandsDescriber.getBothHandsObjectResponse(),
          contextResponse: () => mediaPipeBothHandsDescriber.getBothHandsContextResponse(RatioInputModality.BOTH_HANDS, {
            distanceResponseType: DistanceResponseType.DISTANCE_REGION
          })
        }),
        priority: Utterance.MEDIUM_PRIORITY // Should interrupt the dragging Utterance
      });

      const mediaPipeVoicingDragUtterance = new Utterance({
        alert: new ResponsePacket({
          objectResponse: () => mediaPipeBothHandsDescriber.getBothHandsObjectResponse(),
          contextResponse: () => {
            return mediaPipeBothHandsDescriber.getBothHandsContextResponse(RatioInputModality.BOTH_HANDS, {
              distanceResponseType: DistanceResponseType.DISTANCE_PROGRESS
            });
          }
        })
      });

      // So that this Utterance does not announce unless the ScreenView is visible and voicingVisible.
      Voicing.registerUtteranceToNode(mediaPipeVoicingEndDragUtterance, this);
      Voicing.registerUtteranceToNode(mediaPipeVoicingDragUtterance, this);
      this.mediaPipe = new RAPMediaPipe(model.ratio.tupleProperty, model.ratio.lockedProperty, this.antecedentRatioHalf.viewSounds, this.consequentRatioHalf.viewSounds, {
        isBeingInteractedWithProperty: model.mediaPipeInteractedWithProperty,
        tandem: options.tandem.createTandem('mediaPipe')
      });
      this.mediaPipe.isBeingInteractedWithProperty.lazyLink(interactedWithMarkers => {
        if (interactedWithMarkers) {
          cueArrowsState.interactedWithMouseProperty.value = true;
        }
      });
      this.mediaPipe.oHandGestureProperty.lazyLink(oHandGestureDetected => {
        if (oHandGestureDetected) {
          Voicing.alertUtterance(mediaPipeVoicingEndDragUtterance);
        } else {
          voicingUtteranceQueue.cancelUtterance(mediaPipeVoicingEndDragUtterance);
        }
      });
      this.stepEmitter.addListener(() => {
        this.mediaPipe.step();
      });
      this.mediaPipe.handsStationaryProperty.lazyLink(isStationary => {
        if (isStationary) {
          Voicing.alertUtterance(mediaPipeVoicingDragUtterance);
        } else {
          voicingUtteranceQueue.cancelUtterance(mediaPipeVoicingDragUtterance);
        }
      });
    }
    const bluetoothInteractedWithProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('bluetoothInteractedWithProperty')
    });
    const soundGeneratorEnabledProperty = DerivedProperty.or([this.antecedentRatioHalf.isBeingInteractedWithProperty, this.consequentRatioHalf.isBeingInteractedWithProperty, bothHandsPDOMNode.isBeingInteractedWithProperty, this.mediaPipe ? this.mediaPipe.isBeingInteractedWithProperty : new BooleanProperty(false), bluetoothInteractedWithProperty]);
    this.inProportionSoundGenerator = new InProportionSoundGenerator(model, soundGeneratorEnabledProperty);
    this.movingInProportionSoundGenerator = new MovingInProportionSoundGenerator(model, {
      enableControlProperties: [soundGeneratorEnabledProperty]
    });
    this.staccatoFrequencySoundGenerator = new StaccatoFrequencySoundGenerator(model.ratioFitnessProperty, rapConstants.RATIO_FITNESS_RANGE, model.inProportionProperty, {
      enableControlProperties: [soundGeneratorEnabledProperty]
    });
    soundManager.addSoundGenerator(this.staccatoFrequencySoundGenerator);
    soundManager.addSoundGenerator(this.inProportionSoundGenerator);
    soundManager.addSoundGenerator(this.movingInProportionSoundGenerator);

    // these dimensions are just temporary, and will be recomputed below in the layout function
    this.labelsNode = new RAPTickMarkLabelsNode(this.tickMarkViewProperty, this.tickMarkRangeProperty, 1000, tickMarksAndLabelsColorProperty);
    const resetAllButton = new ResetAllButton({
      listener: () => {
        this.interruptSubtreeInput(); // cancel interactions that may be in progress
        model.reset();
        cueArrowsState.reset();
        bothHandsPDOMNode.reset();
        this.mediaPipe && this.mediaPipe.reset();
        this.reset();
      },
      tandem: options.tandem.createTandem('resetAllButton')
    });
    if (RAPQueryParameters.bluetooth) {
      const antecedentConnectionButton = new RatioAndProportionBluetoothButton(model.ratio.tupleProperty, RatioTerm.ANTECEDENT, {
        tandem: options.tandem.createTandem('antecedentConnectionButton')
      });
      const consequentConnectionButton = new RatioAndProportionBluetoothButton(model.ratio.tupleProperty, RatioTerm.CONSEQUENT, {
        tandem: options.tandem.createTandem('consequentConnectionButton')
      });
      this.stepEmitter.addListener(() => {
        antecedentConnectionButton.step();
        consequentConnectionButton.step();
      });
      Multilink.multilink([antecedentConnectionButton.isBeingInteractedWithProperty, consequentConnectionButton.isBeingInteractedWithProperty], (antecedentInteractedWith, consequentInteractedWith) => {
        bluetoothInteractedWithProperty.value = antecedentInteractedWith && consequentInteractedWith;
      });
      bluetoothInteractedWithProperty.lazyLink(interactedWithMarkers => {
        if (interactedWithMarkers) {
          cueArrowsState.interactedWithMouseProperty.value = true;
        }
      });

      // bluetooth is stationary if both inputs are stationary
      const bluetoothStationaryProperty = DerivedProperty.and([antecedentConnectionButton.isStationaryProperty, consequentConnectionButton.isStationaryProperty]);
      const bluetoothBothHandsDescriber = new BothHandsDescriber(ratio.tupleProperty, ratio.enabledRatioTermsRangeProperty, ratio.lockedProperty, this.tickMarkViewProperty, model.inProportionProperty, this.ratioDescriber, new TickMarkDescriber(this.tickMarkRangeProperty, this.tickMarkViewProperty));
      const bluetoothVoicingDragUtterance = new Utterance({
        alert: new ResponsePacket({
          objectResponse: () => bluetoothBothHandsDescriber.getBothHandsObjectResponse(),
          contextResponse: () => {
            return bluetoothBothHandsDescriber.getBothHandsContextResponse(RatioInputModality.BOTH_HANDS, {
              distanceResponseType: DistanceResponseType.DISTANCE_PROGRESS
            });
          }
        })
      });
      bluetoothStationaryProperty.lazyLink(isStationary => {
        if (isStationary) {
          Voicing.alertUtterance(bluetoothVoicingDragUtterance);
        } else {
          voicingUtteranceQueue.cancelUtterance(bluetoothVoicingDragUtterance);
        }
      });
      const bluetoothButtonBox = new VBox({
        children: [antecedentConnectionButton, consequentConnectionButton],
        spacing: 5,
        align: 'right'
      });
      this.bottomScalingUILayerNode.addChild(bluetoothButtonBox);
    }
    const tickMarkViewRadioButtonGroup = new TickMarkViewRadioButtonGroup(this.tickMarkViewProperty, {
      tandem: options.tandem.createTandem('tickMarkViewRadioButtonGroup')
    });

    // add this Node to the layer that is scaled up to support vertical aspect ratios
    this.topScalingUILayerNode.addChild(tickMarkViewRadioButtonGroup);
    this.bottomScalingUILayerNode.addChild(resetAllButton);
    let positionRegionsNode = null;
    if (RAPQueryParameters.showPositionRegions) {
      positionRegionsNode = new RAPPositionRegionsLayer();
    }
    this.children = [this.labelsNode,
    // UI
    this.topScalingUILayerNode, this.bottomScalingUILayerNode,
    // Main ratio on top
    bothHandsPDOMNode];
    positionRegionsNode && this.addChild(positionRegionsNode);

    // accessible order (ratio first in nav order)
    this.pdomPlayAreaNode.pdomOrder = [bothHandsPDOMNode, tickMarkViewRadioButtonGroup];

    // accessible order
    this.pdomControlAreaNode.pdomOrder = [resetAllButton];

    // Dynamic layout if any controls change (like for dynamic locale switching)
    this.topScalingUILayerNode.boundsProperty.link(() => {
      this.topScalingUILayerNode.right = this.layoutBounds.maxX - rapConstants.SCREEN_VIEW_X_MARGIN;
      this.scaleControls(this.antecedentRatioHalf.rectHeight, this.getRatioWidth());
    });
    this.bottomScalingUILayerNode.boundsProperty.link(() => {
      this.bottomScalingUILayerNode.right = this.layoutBounds.maxX - rapConstants.SCREEN_VIEW_X_MARGIN;
      this.bottomScalingUILayerNode.bottom = this.layoutBounds.height - rapConstants.SCREEN_VIEW_Y_MARGIN;
      this.scaleControls(this.antecedentRatioHalf.rectHeight, this.getRatioWidth());
    });
    this.layoutRAPScreeView = newRatioHalfBounds => {
      // between 0 and 1, 0 is the min height, 1 is the max height
      const heightScalar = Utils.clamp((newRatioHalfBounds.height - LAYOUT_BOUNDS.height) / (MAX_RATIO_HEIGHT - LAYOUT_BOUNDS.height), 0, 1);
      this.antecedentRatioHalf.layout(newRatioHalfBounds, heightScalar);
      this.consequentRatioHalf.layout(newRatioHalfBounds, heightScalar);
      const ratioHalfDraggableArea = newRatioHalfBounds.height - 2 * this.antecedentRatioHalf.framingRectangleHeight;

      // subtract the top and bottom rectangles from the tick marks height
      this.labelsNode.layout(ratioHalfDraggableArea);
      const ratioWidth = this.getRatioWidth();
      this.scaleControls(newRatioHalfBounds.height, this.getRatioWidth());
      this.antecedentRatioHalf.left = (Math.max(RATIO_SECTION_WIDTH * this.layoutBounds.width, ratioWidth) - ratioWidth) / 2;
      this.labelsNode.left = this.antecedentRatioHalf.right + RATIO_HALF_SPACING;
      this.consequentRatioHalf.left = this.labelsNode.right + RATIO_HALF_SPACING;
      this.antecedentRatioHalf.setBottomOfRatioHalf(this.layoutBounds.bottom);
      this.consequentRatioHalf.setBottomOfRatioHalf(this.layoutBounds.bottom);

      // offset the bottom so that the center of the text is right on the tick mark
      this.labelsNode.bottom = this.layoutBounds.bottom - this.antecedentRatioHalf.framingRectangleHeight + this.labelsNode.labelHeight / 2;
      if (positionRegionsNode) {
        const ratioHalvesWidth = this.antecedentRatioHalf.width + this.consequentRatioHalf.width + 2 * RATIO_HALF_SPACING + this.labelsNode.width;
        positionRegionsNode.layout(ratioHalvesWidth, ratioHalfDraggableArea);
        positionRegionsNode.left = this.antecedentRatioHalf.left;
        positionRegionsNode.bottom = this.layoutBounds.bottom - this.antecedentRatioHalf.framingRectangleHeight + positionRegionsNode.labelsHeight / 2;
      }
      assert && assert(Math.min(this.topScalingUILayerNode.left, this.bottomScalingUILayerNode.left) > this.consequentRatioHalf.right, 'controls are too wide for ratio width to fit.');
      assert && assert(this.antecedentRatioHalf.width + this.consequentRatioHalf.width + Math.max(this.topScalingUILayerNode.width, this.bottomScalingUILayerNode.width) < LAYOUT_BOUNDS.width, 'everything should fit inside layout bounds');
    };
    this.layoutRAPScreeView(defaultRatioHalfBounds);
  }
  getRatioWidth() {
    const inBetweenRatioWidth = 2 * RATIO_HALF_SPACING + this.labelsNode.width;
    return this.antecedentRatioHalf.width + this.consequentRatioHalf.width + inBetweenRatioWidth;
  }

  // Scale the UI controls on the right side of the ScreenView
  scaleControls(height, ratioWidth) {
    // Ideal scale
    const desiredScaleFromHeight = uiScaleFunction.evaluate(height);
    const unscaledWidth = Math.max(this.topScalingUILayerNode.localBoundsProperty.value.width, this.bottomScalingUILayerNode.localBoundsProperty.value.width);
    const availableWidth = this.layoutBounds.width - ratioWidth - 2 * rapConstants.SCREEN_VIEW_X_MARGIN;
    assert && assert(unscaledWidth < availableWidth, 'availableWidth should always be greater than width of component');

    // If the controls are too big, scale less than desired as to not overlap with ratio
    const actualScale = Math.min(desiredScaleFromHeight, availableWidth / unscaledWidth);
    this.topScalingUILayerNode.setScaleMagnitude(actualScale);
    this.bottomScalingUILayerNode.setScaleMagnitude(actualScale);
    this.topScalingUILayerNode.top = uiPositionFunction.evaluate(actualScale);
  }

  /**
   * Layout Nodes part of ethe screen viw. To accomplish, much of this was copied from ScreenView.layout, with
   * minor tweaks for this specific case. Also note Projectile Motion uses almost the exact same algorithm.
   */
  layout(viewBounds) {
    this.matrix = ScreenView.getLayoutMatrix(this.layoutBounds, viewBounds, {
      verticalAlign: 'bottom'
    });
    this.visibleBoundsProperty.value = this.parentToLocalBounds(viewBounds);
    const ratioHeight = Math.min(this.visibleBoundsProperty.value.height, MAX_RATIO_HEIGHT);
    this.layoutRAPScreeView(new Bounds2(0, 0, ONE_QUARTER_LAYOUT_WIDTH, ratioHeight));
  }
  reset() {
    this.tickMarkRangeProperty.reset();
    this.tickMarkViewProperty.reset();
    this.antecedentRatioHalf.reset();
    this.consequentRatioHalf.reset();
    this.staccatoFrequencySoundGenerator.reset();
    this.inProportionSoundGenerator.reset();
    this.movingInProportionSoundGenerator.reset();
  }
  step(dt) {
    this.stepEmitter.emit(dt);
    this.inProportionSoundGenerator.step(dt);
    this.staccatoFrequencySoundGenerator.step(dt);
  }
}
ratioAndProportion.register('RAPScreenView', RAPScreenView);
export default RAPScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIlByb3BlcnR5IiwiQm91bmRzMiIsIkxpbmVhckZ1bmN0aW9uIiwiVXRpbHMiLCJTY3JlZW5WaWV3IiwibWVyZ2UiLCJvcHRpb25pemUiLCJSZXNldEFsbEJ1dHRvbiIsIkNvbG9yIiwiUGFyYWxsZWxET00iLCJWQm94IiwiVm9pY2luZyIsInZvaWNpbmdVdHRlcmFuY2VRdWV1ZSIsInNvdW5kTWFuYWdlciIsInJhdGlvQW5kUHJvcG9ydGlvbiIsIlJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MiLCJSYXRpb1Rlcm0iLCJyYXBDb25zdGFudHMiLCJSQVBRdWVyeVBhcmFtZXRlcnMiLCJCb3RoSGFuZHNQRE9NTm9kZSIsIkN1ZUFycm93c1N0YXRlIiwiQm90aEhhbmRzRGVzY3JpYmVyIiwiUmF0aW9EZXNjcmliZXIiLCJUaWNrTWFya0Rlc2NyaWJlciIsIlJBUENvbG9ycyIsIlJBUFRpY2tNYXJrTGFiZWxzTm9kZSIsIlJhdGlvSGFsZiIsIkluUHJvcG9ydGlvblNvdW5kR2VuZXJhdG9yIiwiTW92aW5nSW5Qcm9wb3J0aW9uU291bmRHZW5lcmF0b3IiLCJTdGFjY2F0b0ZyZXF1ZW5jeVNvdW5kR2VuZXJhdG9yIiwiVGlja01hcmtWaWV3IiwiVGlja01hcmtWaWV3UmFkaW9CdXR0b25Hcm91cCIsIkN1ZURpc3BsYXkiLCJSQVBQb3NpdGlvblJlZ2lvbnNMYXllciIsIkJhY2tncm91bmRDb2xvckhhbmRsZXIiLCJFbnVtZXJhdGlvblByb3BlcnR5IiwiUkFQTWVkaWFQaXBlIiwiVXR0ZXJhbmNlIiwiUmVzcG9uc2VQYWNrZXQiLCJSYXRpb0lucHV0TW9kYWxpdHkiLCJSYXRpb0FuZFByb3BvcnRpb25CbHVldG9vdGhCdXR0b24iLCJEaXN0YW5jZVJlc3BvbnNlVHlwZSIsIkVtaXR0ZXIiLCJNdWx0aWxpbmsiLCJNZWRpYVBpcGVRdWVyeVBhcmFtZXRlcnMiLCJMQVlPVVRfQk9VTkRTIiwiREVGQVVMVF9MQVlPVVRfQk9VTkRTIiwiTUFYX1JBVElPX0hFSUdIVCIsIndpZHRoIiwiT05FX1FVQVJURVJfTEFZT1VUX1dJRFRIIiwiUkFUSU9fSEFMRl9XSURUSCIsIlJBVElPX0hBTEZfU1BBQ0lORyIsIlJBVElPX1NFQ1RJT05fV0lEVEgiLCJ1aVNjYWxlRnVuY3Rpb24iLCJoZWlnaHQiLCJ1aVBvc2l0aW9uRnVuY3Rpb24iLCJSQVBTY3JlZW5WaWV3IiwidG9wU2NhbGluZ1VJTGF5ZXJOb2RlIiwiYWxpZ24iLCJzcGFjaW5nIiwiYm90dG9tU2NhbGluZ1VJTGF5ZXJOb2RlIiwic3RlcEVtaXR0ZXIiLCJwYXJhbWV0ZXJzIiwidmFsdWVUeXBlIiwiY29uc3RydWN0b3IiLCJtb2RlbCIsImJhY2tncm91bmRDb2xvclByb3BlcnR5IiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImxheW91dEJvdW5kcyIsImxlZnRIYW5kQ29sb3JQcm9wZXJ0eSIsIkJMQUNLIiwicmlnaHRIYW5kQ29sb3JQcm9wZXJ0eSIsImJvdGhIYW5kc1BET01Ob2RlT3B0aW9ucyIsInJhdGlvIiwidGlja01hcmtWaWV3UHJvcGVydHkiLCJOT05FIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwidGlja01hcmtSYW5nZVByb3BlcnR5IiwiYmFja2dyb3VuZENvbG9ySGFuZGxlciIsInJhdGlvRGVzY3JpYmVyIiwiY3VlQXJyb3dzU3RhdGUiLCJ0aWNrTWFya3NBbmRMYWJlbHNDb2xvclByb3BlcnR5IiwicmF0aW9GaXRuZXNzUHJvcGVydHkiLCJmaXRuZXNzIiwiaW50ZXJwb2xhdGVSR0JBIiwidGlja01hcmtzQW5kTGFiZWxzT3V0T2ZGaXRuZXNzUHJvcGVydHkiLCJ2YWx1ZSIsInRpY2tNYXJrc0FuZExhYmVsc0luRml0bmVzc1Byb3BlcnR5IiwicGxheVRpY2tNYXJrQnVtcFNvdW5kUHJvcGVydHkiLCJsb2NrZWRQcm9wZXJ0eSIsIlJBVElPX0ZJVE5FU1NfUkFOR0UiLCJtaW4iLCJrZXlib2FyZFN0ZXAiLCJkZWZhdWx0UmF0aW9IYWxmQm91bmRzIiwicmVjdCIsImExMXlEZXBlbmRlbmNpZXMiLCJ1bmNsYW1wZWRGaXRuZXNzUHJvcGVydHkiLCJ0YXJnZXRSYXRpb1Byb3BlcnR5IiwiYW50ZWNlZGVudFJhdGlvSGFsZiIsInJhdGlvVGVybSIsIkFOVEVDRURFTlQiLCJkaXNwbGF5Qm90aEhhbmRzQ3VlUHJvcGVydHkiLCJib3RoSGFuZHMiLCJhbnRlY2VkZW50Q3VlRGlzcGxheWVkUHJvcGVydHkiLCJib3VuZHMiLCJjb2xvclByb3BlcnR5IiwiaG9yaXpvbnRhbE1vdmVtZW50QWxsb3dlZFByb3BlcnR5Iiwic2V0SnVtcGluZ092ZXJQcm9wb3J0aW9uU2hvdWxkVHJpZ2dlclNvdW5kIiwiaXNKdW1waW5nIiwiaW5Qcm9wb3J0aW9uU291bmRHZW5lcmF0b3IiLCJnZXRJZGVhbFZhbHVlIiwiZ2V0SWRlYWxWYWx1ZUZvclRlcm0iLCJpblByb3BvcnRpb25Qcm9wZXJ0eSIsImhhbmRDb2xvclByb3BlcnR5IiwiYWNjZXNzaWJsZU5hbWUiLCJhMTF5IiwibGVmdEhhbmRTdHJpbmdQcm9wZXJ0eSIsImJvdGhIYW5kc0N1ZURpc3BsYXkiLCJXX1MiLCJpc1JpZ2h0IiwiaGVscFRleHQiLCJpbmRpdmlkdWFsSGFuZHNIZWxwVGV4dFN0cmluZ1Byb3BlcnR5IiwiaGVscFRleHRCZWhhdmlvciIsIkhFTFBfVEVYVF9CRUZPUkVfQ09OVEVOVCIsImNvbnNlcXVlbnRSYXRpb0hhbGYiLCJDT05TRVFVRU5UIiwiY29uc2VxdWVudEN1ZURpc3BsYXllZFByb3BlcnR5IiwicmlnaHRIYW5kU3RyaW5nUHJvcGVydHkiLCJib3RoSGFuZHNQRE9NTm9kZSIsInJhdGlvVHVwbGVQcm9wZXJ0eSIsInR1cGxlUHJvcGVydHkiLCJlbmFibGVkUmF0aW9UZXJtc1JhbmdlUHJvcGVydHkiLCJyYXRpb0xvY2tlZFByb3BlcnR5IiwiZ2V0SWRlYWxUZXJtIiwiYmluZCIsImludGVyYWN0aXZlTm9kZU9wdGlvbnMiLCJjaGlsZHJlbiIsIm1lZGlhUGlwZSIsImNhbWVyYUlucHV0IiwibWVkaWFQaXBlQm90aEhhbmRzRGVzY3JpYmVyIiwibWVkaWFQaXBlVm9pY2luZ0VuZERyYWdVdHRlcmFuY2UiLCJhbGVydCIsIm9iamVjdFJlc3BvbnNlIiwiZ2V0Qm90aEhhbmRzT2JqZWN0UmVzcG9uc2UiLCJjb250ZXh0UmVzcG9uc2UiLCJnZXRCb3RoSGFuZHNDb250ZXh0UmVzcG9uc2UiLCJCT1RIX0hBTkRTIiwiZGlzdGFuY2VSZXNwb25zZVR5cGUiLCJESVNUQU5DRV9SRUdJT04iLCJwcmlvcml0eSIsIk1FRElVTV9QUklPUklUWSIsIm1lZGlhUGlwZVZvaWNpbmdEcmFnVXR0ZXJhbmNlIiwiRElTVEFOQ0VfUFJPR1JFU1MiLCJyZWdpc3RlclV0dGVyYW5jZVRvTm9kZSIsInZpZXdTb3VuZHMiLCJpc0JlaW5nSW50ZXJhY3RlZFdpdGhQcm9wZXJ0eSIsIm1lZGlhUGlwZUludGVyYWN0ZWRXaXRoUHJvcGVydHkiLCJsYXp5TGluayIsImludGVyYWN0ZWRXaXRoTWFya2VycyIsImludGVyYWN0ZWRXaXRoTW91c2VQcm9wZXJ0eSIsIm9IYW5kR2VzdHVyZVByb3BlcnR5Iiwib0hhbmRHZXN0dXJlRGV0ZWN0ZWQiLCJhbGVydFV0dGVyYW5jZSIsImNhbmNlbFV0dGVyYW5jZSIsImFkZExpc3RlbmVyIiwic3RlcCIsImhhbmRzU3RhdGlvbmFyeVByb3BlcnR5IiwiaXNTdGF0aW9uYXJ5IiwiYmx1ZXRvb3RoSW50ZXJhY3RlZFdpdGhQcm9wZXJ0eSIsInNvdW5kR2VuZXJhdG9yRW5hYmxlZFByb3BlcnR5Iiwib3IiLCJtb3ZpbmdJblByb3BvcnRpb25Tb3VuZEdlbmVyYXRvciIsImVuYWJsZUNvbnRyb2xQcm9wZXJ0aWVzIiwic3RhY2NhdG9GcmVxdWVuY3lTb3VuZEdlbmVyYXRvciIsImFkZFNvdW5kR2VuZXJhdG9yIiwibGFiZWxzTm9kZSIsInJlc2V0QWxsQnV0dG9uIiwibGlzdGVuZXIiLCJpbnRlcnJ1cHRTdWJ0cmVlSW5wdXQiLCJyZXNldCIsImJsdWV0b290aCIsImFudGVjZWRlbnRDb25uZWN0aW9uQnV0dG9uIiwiY29uc2VxdWVudENvbm5lY3Rpb25CdXR0b24iLCJtdWx0aWxpbmsiLCJhbnRlY2VkZW50SW50ZXJhY3RlZFdpdGgiLCJjb25zZXF1ZW50SW50ZXJhY3RlZFdpdGgiLCJibHVldG9vdGhTdGF0aW9uYXJ5UHJvcGVydHkiLCJhbmQiLCJpc1N0YXRpb25hcnlQcm9wZXJ0eSIsImJsdWV0b290aEJvdGhIYW5kc0Rlc2NyaWJlciIsImJsdWV0b290aFZvaWNpbmdEcmFnVXR0ZXJhbmNlIiwiYmx1ZXRvb3RoQnV0dG9uQm94IiwiYWRkQ2hpbGQiLCJ0aWNrTWFya1ZpZXdSYWRpb0J1dHRvbkdyb3VwIiwicG9zaXRpb25SZWdpb25zTm9kZSIsInNob3dQb3NpdGlvblJlZ2lvbnMiLCJwZG9tUGxheUFyZWFOb2RlIiwicGRvbU9yZGVyIiwicGRvbUNvbnRyb2xBcmVhTm9kZSIsImJvdW5kc1Byb3BlcnR5IiwibGluayIsInJpZ2h0IiwibWF4WCIsIlNDUkVFTl9WSUVXX1hfTUFSR0lOIiwic2NhbGVDb250cm9scyIsInJlY3RIZWlnaHQiLCJnZXRSYXRpb1dpZHRoIiwiYm90dG9tIiwiU0NSRUVOX1ZJRVdfWV9NQVJHSU4iLCJsYXlvdXRSQVBTY3JlZVZpZXciLCJuZXdSYXRpb0hhbGZCb3VuZHMiLCJoZWlnaHRTY2FsYXIiLCJjbGFtcCIsImxheW91dCIsInJhdGlvSGFsZkRyYWdnYWJsZUFyZWEiLCJmcmFtaW5nUmVjdGFuZ2xlSGVpZ2h0IiwicmF0aW9XaWR0aCIsImxlZnQiLCJNYXRoIiwibWF4Iiwic2V0Qm90dG9tT2ZSYXRpb0hhbGYiLCJsYWJlbEhlaWdodCIsInJhdGlvSGFsdmVzV2lkdGgiLCJsYWJlbHNIZWlnaHQiLCJhc3NlcnQiLCJpbkJldHdlZW5SYXRpb1dpZHRoIiwiZGVzaXJlZFNjYWxlRnJvbUhlaWdodCIsImV2YWx1YXRlIiwidW5zY2FsZWRXaWR0aCIsImxvY2FsQm91bmRzUHJvcGVydHkiLCJhdmFpbGFibGVXaWR0aCIsImFjdHVhbFNjYWxlIiwic2V0U2NhbGVNYWduaXR1ZGUiLCJ0b3AiLCJ2aWV3Qm91bmRzIiwibWF0cml4IiwiZ2V0TGF5b3V0TWF0cml4IiwidmVydGljYWxBbGlnbiIsInZpc2libGVCb3VuZHNQcm9wZXJ0eSIsInBhcmVudFRvTG9jYWxCb3VuZHMiLCJyYXRpb0hlaWdodCIsImR0IiwiZW1pdCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUkFQU2NyZWVuVmlldy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBCYXNlIGNsYXNzIFNjcmVlblZpZXcgd2hpY2ggY3JlYXRlcyB2aWV3IGNvbXBvbmVudHMgdGhhdCBhbGwgc2NyZWVucyB1c2UuIFRoaXMgaW5jbHVkZXMgdGhlIGNlbnRyYWwgcmF0aW8gXCJzY2VuZVwiIHdoaWNoXHJcbiAqIGhhcyB0d28gUmF0aW9IYWxmIGluc3RhbmNlcyBhbmQgc3VwcG9ydHMgc2hvd2luZyB0aWNrIG1hcmtzIGFuZCB0aGVpciBsYWJlbHMuIFRoZXJlIGlzIGEgUmFkaW9CdXR0b25Hcm91cCB0byBjb250cm9sXHJcbiAqIHRoZSB0aWNrIG1hcmsgdmlldyB0b28uIFN1YnR5cGVzIGFyZSByZXNwb25zaWJsZSBmb3IgY3JlYXRpbmcgYSBjb250cm9sIGZvciBjaGFuZ2luZyB0aGUgbW9kZWwncyB0YXJnZXRSYXRpb1Byb3BlcnR5LlxyXG4gKlxyXG4gKiBUaGlzIHR5cGUgY3JlYXRlcyBpdHMgb3duIGxheW91dCBmdW5jdGlvbiwgYmVjYXVzZSB0aGUgcmF0aW8gaW50ZXJhY3Rpb24gaXMgaW5oZXJlbnRseSBxdWl0ZSB2ZXJ0aWNhbC4gVGhpcyB0eXBlXHJcbiAqIG1heGltaXplcyB0aGUgdmVydGljYWwgc3BhY2Ugb2YgYSBsYXlvdXQgYW5kIGV4dGVuZHMgdGhlIHJhdGlvIHRvIGEgdmVydGljYWwgYXNwZWN0IHJhdGlvIHdoZW4gcG9zc2libGUuIEl0IGFsc29cclxuICogc3VwcG9ydHMgc2NhbGluZyB1cCBVSSBjb250cm9scyAob24gdGhlIHJpZ2h0KSB0byBtYXRjaCB0aGUgYXNwZWN0IHJhdGlvLiBTZWUgdGhpcy50b3BTY2FsaW5nVUlMYXllck5vZGUgYW5kXHJcbiAqIHRoaXMuYm90dG9tU2NhbGluZ1VJTGF5ZXJOb2RlIGZvciBtb3JlIGRldGFpbHMuXHJcbiAqXHJcbiAqIEBhdXRob3IgTWljaGFlbCBLYXV6bWFubiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCBMaW5lYXJGdW5jdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvTGluZWFyRnVuY3Rpb24uanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IFNjcmVlblZpZXcsIHsgU2NyZWVuVmlld09wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9qb2lzdC9qcy9TY3JlZW5WaWV3LmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBSZXNldEFsbEJ1dHRvbiBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvYnV0dG9ucy9SZXNldEFsbEJ1dHRvbi5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBQYXJhbGxlbERPTSwgVkJveCwgVm9pY2luZywgdm9pY2luZ1V0dGVyYW5jZVF1ZXVlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHNvdW5kTWFuYWdlciBmcm9tICcuLi8uLi8uLi8uLi90YW1iby9qcy9zb3VuZE1hbmFnZXIuanMnO1xyXG5pbXBvcnQgcmF0aW9BbmRQcm9wb3J0aW9uIGZyb20gJy4uLy4uL3JhdGlvQW5kUHJvcG9ydGlvbi5qcyc7XHJcbmltcG9ydCBSYXRpb0FuZFByb3BvcnRpb25TdHJpbmdzIGZyb20gJy4uLy4uL1JhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuanMnO1xyXG5pbXBvcnQgUmF0aW9UZXJtIGZyb20gJy4uL21vZGVsL1JhdGlvVGVybS5qcyc7XHJcbmltcG9ydCByYXBDb25zdGFudHMgZnJvbSAnLi4vcmFwQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IFJBUFF1ZXJ5UGFyYW1ldGVycyBmcm9tICcuLi9SQVBRdWVyeVBhcmFtZXRlcnMuanMnO1xyXG5pbXBvcnQgQm90aEhhbmRzUERPTU5vZGUsIHsgQm90aEhhbmRzUERPTU5vZGVPcHRpb25zIH0gZnJvbSAnLi9Cb3RoSGFuZHNQRE9NTm9kZS5qcyc7XHJcbmltcG9ydCBDdWVBcnJvd3NTdGF0ZSBmcm9tICcuL0N1ZUFycm93c1N0YXRlLmpzJztcclxuaW1wb3J0IEJvdGhIYW5kc0Rlc2NyaWJlciBmcm9tICcuL2Rlc2NyaWJlcnMvQm90aEhhbmRzRGVzY3JpYmVyLmpzJztcclxuaW1wb3J0IFJhdGlvRGVzY3JpYmVyIGZyb20gJy4vZGVzY3JpYmVycy9SYXRpb0Rlc2NyaWJlci5qcyc7XHJcbmltcG9ydCBUaWNrTWFya0Rlc2NyaWJlciBmcm9tICcuL2Rlc2NyaWJlcnMvVGlja01hcmtEZXNjcmliZXIuanMnO1xyXG5pbXBvcnQgUkFQQ29sb3JzIGZyb20gJy4vUkFQQ29sb3JzLmpzJztcclxuaW1wb3J0IFJBUFRpY2tNYXJrTGFiZWxzTm9kZSBmcm9tICcuL1JBUFRpY2tNYXJrTGFiZWxzTm9kZS5qcyc7XHJcbmltcG9ydCBSYXRpb0hhbGYgZnJvbSAnLi9SYXRpb0hhbGYuanMnO1xyXG5pbXBvcnQgSW5Qcm9wb3J0aW9uU291bmRHZW5lcmF0b3IgZnJvbSAnLi9zb3VuZC9JblByb3BvcnRpb25Tb3VuZEdlbmVyYXRvci5qcyc7XHJcbmltcG9ydCBNb3ZpbmdJblByb3BvcnRpb25Tb3VuZEdlbmVyYXRvciBmcm9tICcuL3NvdW5kL01vdmluZ0luUHJvcG9ydGlvblNvdW5kR2VuZXJhdG9yLmpzJztcclxuaW1wb3J0IFN0YWNjYXRvRnJlcXVlbmN5U291bmRHZW5lcmF0b3IgZnJvbSAnLi9zb3VuZC9TdGFjY2F0b0ZyZXF1ZW5jeVNvdW5kR2VuZXJhdG9yLmpzJztcclxuaW1wb3J0IFRpY2tNYXJrVmlldyBmcm9tICcuL1RpY2tNYXJrVmlldy5qcyc7XHJcbmltcG9ydCBUaWNrTWFya1ZpZXdSYWRpb0J1dHRvbkdyb3VwIGZyb20gJy4vVGlja01hcmtWaWV3UmFkaW9CdXR0b25Hcm91cC5qcyc7XHJcbmltcG9ydCBSQVBNb2RlbCBmcm9tICcuLi9tb2RlbC9SQVBNb2RlbC5qcyc7XHJcbmltcG9ydCBDdWVEaXNwbGF5IGZyb20gJy4vQ3VlRGlzcGxheS5qcyc7XHJcbmltcG9ydCBSQVBQb3NpdGlvblJlZ2lvbnNMYXllciBmcm9tICcuL1JBUFBvc2l0aW9uUmVnaW9uc0xheWVyLmpzJztcclxuaW1wb3J0IEJhY2tncm91bmRDb2xvckhhbmRsZXIgZnJvbSAnLi9CYWNrZ3JvdW5kQ29sb3JIYW5kbGVyLmpzJztcclxuaW1wb3J0IEVudW1lcmF0aW9uUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbnVtZXJhdGlvblByb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUkFQTWVkaWFQaXBlIGZyb20gJy4vUkFQTWVkaWFQaXBlLmpzJztcclxuaW1wb3J0IFV0dGVyYW5jZSBmcm9tICcuLi8uLi8uLi8uLi91dHRlcmFuY2UtcXVldWUvanMvVXR0ZXJhbmNlLmpzJztcclxuaW1wb3J0IFJlc3BvbnNlUGFja2V0IGZyb20gJy4uLy4uLy4uLy4uL3V0dGVyYW5jZS1xdWV1ZS9qcy9SZXNwb25zZVBhY2tldC5qcyc7XHJcbmltcG9ydCBSYXRpb0lucHV0TW9kYWxpdHkgZnJvbSAnLi9kZXNjcmliZXJzL1JhdGlvSW5wdXRNb2RhbGl0eS5qcyc7XHJcbmltcG9ydCBSYXRpb0FuZFByb3BvcnRpb25CbHVldG9vdGhCdXR0b24gZnJvbSAnLi9SYXRpb0FuZFByb3BvcnRpb25CbHVldG9vdGhCdXR0b24uanMnO1xyXG5pbXBvcnQgRGlzdGFuY2VSZXNwb25zZVR5cGUgZnJvbSAnLi9kZXNjcmliZXJzL0Rpc3RhbmNlUmVzcG9uc2VUeXBlLmpzJztcclxuaW1wb3J0IEVtaXR0ZXIgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbWl0dGVyLmpzJztcclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCBNZWRpYVBpcGVRdWVyeVBhcmFtZXRlcnMgZnJvbSAnLi4vLi4vLi4vLi4vdGFuZ2libGUvanMvbWVkaWFQaXBlL01lZGlhUGlwZVF1ZXJ5UGFyYW1ldGVycy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgTEFZT1VUX0JPVU5EUyA9IFNjcmVlblZpZXcuREVGQVVMVF9MQVlPVVRfQk9VTkRTO1xyXG5jb25zdCBNQVhfUkFUSU9fSEVJR0hUID0gTEFZT1VUX0JPVU5EUy53aWR0aCAqIDI7IC8vIHJlbGF0aXZlbHkgYXJiaXRyYXJ5LCBidXQgZ29vZCB0byBzZXQgYSBtYXgsIHNvIGl0IGNhbid0IGdldCB0b28gc2tpbm55XHJcbmNvbnN0IE9ORV9RVUFSVEVSX0xBWU9VVF9XSURUSCA9IExBWU9VVF9CT1VORFMud2lkdGggKiAwLjI1O1xyXG5jb25zdCBSQVRJT19IQUxGX1dJRFRIID0gT05FX1FVQVJURVJfTEFZT1VUX1dJRFRIO1xyXG5jb25zdCBSQVRJT19IQUxGX1NQQUNJTkcgPSAxMDtcclxuXHJcbi8vIFBlcmNlbnRhZ2Ugb2YgdGhlIGxheW91dCBib3VuZHMgd2lkdGggdGhhdCBpcyB0YWtlbiB1cCBieSB0aGUgcmF0aW8gKGluY2x1ZGluZyBtYXJnaW5zKSByYXRoZXIgdGhhbiB0aGUgY29udHJvbFxyXG4vLyBhcmVhIG9uIHRoZSByaWdodC5cclxuY29uc3QgUkFUSU9fU0VDVElPTl9XSURUSCA9IDIgLyAzO1xyXG5cclxuY29uc3QgdWlTY2FsZUZ1bmN0aW9uID0gbmV3IExpbmVhckZ1bmN0aW9uKCBMQVlPVVRfQk9VTkRTLmhlaWdodCwgTUFYX1JBVElPX0hFSUdIVCwgMSwgMS41LCB0cnVlICk7XHJcbmNvbnN0IHVpUG9zaXRpb25GdW5jdGlvbiA9IG5ldyBMaW5lYXJGdW5jdGlvbiggMSwgMS41LCBMQVlPVVRfQk9VTkRTLmhlaWdodCAqIDAuMTUsIC1MQVlPVVRfQk9VTkRTLmhlaWdodCAqIDAuMiwgdHJ1ZSApO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICBsZWZ0SGFuZENvbG9yUHJvcGVydHk/OiBUUmVhZE9ubHlQcm9wZXJ0eTxDb2xvcj47XHJcbiAgcmlnaHRIYW5kQ29sb3JQcm9wZXJ0eT86IFRSZWFkT25seVByb3BlcnR5PENvbG9yPjtcclxuICBib3RoSGFuZHNQRE9NTm9kZU9wdGlvbnM/OiBQYXJ0aWFsPEJvdGhIYW5kc1BET01Ob2RlT3B0aW9ucz47IC8vIEJlY2F1c2UgYWxsIHRoZSByZXF1aXJlZCBwaWVjZXMgYXJlIGFkZGVkIGJ5IHRoaXMgdHlwZVxyXG59O1xyXG5cclxudHlwZSBSQVBTY3JlZW5WaWV3T3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU2NyZWVuVmlld09wdGlvbnM7XHJcblxyXG5jbGFzcyBSQVBTY3JlZW5WaWV3IGV4dGVuZHMgU2NyZWVuVmlldyB7XHJcblxyXG4gIHByb3RlY3RlZCB0aWNrTWFya1ZpZXdQcm9wZXJ0eTogRW51bWVyYXRpb25Qcm9wZXJ0eTxUaWNrTWFya1ZpZXc+O1xyXG5cclxuICAvLyBXaGF0IGlzIHRoZSB1bml0IHZhbHVlIG9mIHRoZSB0aWNrIG1hcmtzLiBWYWx1ZSByZWFkcyBhcyBcIjEveCBvZiB0aGUgdmlldyBoZWlnaHQuXCJcclxuICBwcm90ZWN0ZWQgdGlja01hcmtSYW5nZVByb3BlcnR5OiBOdW1iZXJQcm9wZXJ0eTtcclxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgcmF0aW9EZXNjcmliZXI6IFJhdGlvRGVzY3JpYmVyO1xyXG4gIHByaXZhdGUgYmFja2dyb3VuZENvbG9ySGFuZGxlcjogQmFja2dyb3VuZENvbG9ySGFuZGxlcjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGFudGVjZWRlbnRSYXRpb0hhbGY6IFJhdGlvSGFsZjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNvbnNlcXVlbnRSYXRpb0hhbGY6IFJhdGlvSGFsZjtcclxuXHJcbiAgLy8gU291bmRHZW5lcmF0b3JzIHRoYXQgc29uaWZ5IGRpZmZlcmVudCBhc3BlY3RzIG9mIHRoZSBtb2RlbFxyXG4gIHByaXZhdGUgcmVhZG9ubHkgaW5Qcm9wb3J0aW9uU291bmRHZW5lcmF0b3I6IEluUHJvcG9ydGlvblNvdW5kR2VuZXJhdG9yO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbW92aW5nSW5Qcm9wb3J0aW9uU291bmRHZW5lcmF0b3I6IE1vdmluZ0luUHJvcG9ydGlvblNvdW5kR2VuZXJhdG9yO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgc3RhY2NhdG9GcmVxdWVuY3lTb3VuZEdlbmVyYXRvcjogU3RhY2NhdG9GcmVxdWVuY3lTb3VuZEdlbmVyYXRvcjtcclxuXHJcbiAgLy8gS2VlcCBhIHNlcGFyYXRlIGxheWVyIGZvciBcImNvbnRyb2wtcGFuZWwtZXNxdWVcIiAgVUkgb24gdGhlIHJpZ2h0LiBUaGlzIGFsbG93cyB0aGVtIHRvIGJlIHNjYWxlZFxyXG4gIC8vIHRvIG1heGltaXplIHRoZWlyIHNpemUgd2l0aGluIHRoZSBob3Jpem9udGFsIHNwYWNlIGluIHZlcnRpY2FsIGFzcGVjdCByYXRpb3MsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcmF0aW8tYW5kLXByb3BvcnRpb24vaXNzdWVzLzc5XHJcbiAgLy8gVGhlc2UgYXJlIHR3byBzZXBhcmF0ZSBjb250YWluZXJzIHNvIHRoYXQgc2NhbGluZyB0aGVtIGNhbiB0YWtlIGF3YXkgc3BhY2UgaW4gYmV0d2VlbiB0aGVtIHdoaWxlIGtlZXBpbmcgZWFjaFxyXG4gIC8vIHBvc2l0aW9uZWQgYmFzZWQgb24gdGhlIGNvcm5lcnMgb2YgdGhlIGxheW91dC5cclxuICBwcm90ZWN0ZWQgdG9wU2NhbGluZ1VJTGF5ZXJOb2RlID0gbmV3IFZCb3goIHsgYWxpZ246ICdyaWdodCcsIHNwYWNpbmc6IDIwIH0gKTtcclxuICBwcm90ZWN0ZWQgYm90dG9tU2NhbGluZ1VJTGF5ZXJOb2RlID0gbmV3IFZCb3goIHsgYWxpZ246ICdyaWdodCcsIHNwYWNpbmc6IDIwIH0gKTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBsYXlvdXRSQVBTY3JlZVZpZXc6ICggY3VycmVudFNjcmVlblZpZXdDb29yZGluYXRlczogQm91bmRzMiApID0+IHZvaWQ7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBtZWRpYVBpcGU6IFJBUE1lZGlhUGlwZSB8IG51bGw7XHJcblxyXG4gIHByaXZhdGUgc3RlcEVtaXR0ZXIgPSBuZXcgRW1pdHRlcjxbIG51bWJlciBdPiggeyBwYXJhbWV0ZXJzOiBbIHsgdmFsdWVUeXBlOiAnbnVtYmVyJyB9IF0gfSApO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbGFiZWxzTm9kZTogUkFQVGlja01hcmtMYWJlbHNOb2RlO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG1vZGVsOiBSQVBNb2RlbCwgYmFja2dyb3VuZENvbG9yUHJvcGVydHk6IFByb3BlcnR5PENvbG9yPiwgcHJvdmlkZWRPcHRpb25zPzogUkFQU2NyZWVuVmlld09wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxSQVBTY3JlZW5WaWV3T3B0aW9ucywgU2VsZk9wdGlvbnMsIFNjcmVlblZpZXdPcHRpb25zPigpKCB7XHJcbiAgICAgIGxheW91dEJvdW5kczogTEFZT1VUX0JPVU5EUyxcclxuXHJcbiAgICAgIC8vIFByb3BlcnRpZXMgdGhhdCBjb250cm9sIHRoZSBjb2xvciBvZiBlYWNoIGhhbmRcclxuICAgICAgbGVmdEhhbmRDb2xvclByb3BlcnR5OiBuZXcgUHJvcGVydHkoIENvbG9yLkJMQUNLICksXHJcbiAgICAgIHJpZ2h0SGFuZENvbG9yUHJvcGVydHk6IG5ldyBQcm9wZXJ0eSggQ29sb3IuQkxBQ0sgKSxcclxuXHJcbiAgICAgIC8vIFBhc3NlZCB0aHJvdWdoIHRvIEJvdGhIYW5kc1BET01Ob2RlXHJcbiAgICAgIGJvdGhIYW5kc1BET01Ob2RlT3B0aW9uczoge31cclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gZm9yIGVhc2UgYXQgdXNhZ2Ugc2l0ZXNcclxuICAgIGNvbnN0IHJhdGlvID0gbW9kZWwucmF0aW87XHJcblxyXG4gICAgdGhpcy50aWNrTWFya1ZpZXdQcm9wZXJ0eSA9IG5ldyBFbnVtZXJhdGlvblByb3BlcnR5KCBUaWNrTWFya1ZpZXcuTk9ORSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3RpY2tNYXJrVmlld1Byb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy50aWNrTWFya1JhbmdlUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIDEwLCB7IHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndGlja01hcmtSYW5nZVByb3BlcnR5JyApIH0gKTtcclxuXHJcbiAgICB0aGlzLmJhY2tncm91bmRDb2xvckhhbmRsZXIgPSBuZXcgQmFja2dyb3VuZENvbG9ySGFuZGxlciggbW9kZWwsIGJhY2tncm91bmRDb2xvclByb3BlcnR5ICk7XHJcblxyXG4gICAgdGhpcy5yYXRpb0Rlc2NyaWJlciA9IG5ldyBSYXRpb0Rlc2NyaWJlciggbW9kZWwgKTtcclxuXHJcbiAgICAvLyBBIGNvbGxlY3Rpb24gb2YgcHJvcGVydGllcyB0aGF0IGtlZXAgdHJhY2sgb2Ygd2hpY2ggY3VlcyBzaG91bGQgYmUgZGlzcGxheWVkIGZvciBib3RoIHRoZSBhbnRlY2VkZW50IGFuZCBjb25zZXF1ZW50IGhhbmRzLlxyXG4gICAgY29uc3QgY3VlQXJyb3dzU3RhdGUgPSBuZXcgQ3VlQXJyb3dzU3RhdGUoKTtcclxuXHJcbiAgICBjb25zdCB0aWNrTWFya3NBbmRMYWJlbHNDb2xvclByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBtb2RlbC5yYXRpb0ZpdG5lc3NQcm9wZXJ0eSBdLFxyXG4gICAgICBmaXRuZXNzID0+IENvbG9yLmludGVycG9sYXRlUkdCQShcclxuICAgICAgICBSQVBDb2xvcnMudGlja01hcmtzQW5kTGFiZWxzT3V0T2ZGaXRuZXNzUHJvcGVydHkudmFsdWUsXHJcbiAgICAgICAgUkFQQ29sb3JzLnRpY2tNYXJrc0FuZExhYmVsc0luRml0bmVzc1Byb3BlcnR5LnZhbHVlLCBmaXRuZXNzXHJcbiAgICAgICkgKTtcclxuXHJcbiAgICAvLyBUaWNrIG1hcmsgc291bmRzIGdldCBwbGF5ZWQgd2hlbiByYXRpbyBpc24ndCBsb2NrZWQsIGFuZCB3aGVuIHN0YWNjYXRvIHNvdW5kcyBhcmVuJ3QgcGxheWluZ1xyXG4gICAgY29uc3QgcGxheVRpY2tNYXJrQnVtcFNvdW5kUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBtb2RlbC5yYXRpb0ZpdG5lc3NQcm9wZXJ0eSBdLFxyXG4gICAgICBmaXRuZXNzID0+ICFtb2RlbC5yYXRpby5sb2NrZWRQcm9wZXJ0eS52YWx1ZSAmJiBmaXRuZXNzID09PSByYXBDb25zdGFudHMuUkFUSU9fRklUTkVTU19SQU5HRS5taW4gKTtcclxuXHJcbiAgICAvLyBieSBkZWZhdWx0LCB0aGUga2V5Ym9hcmQgc3RlcCBzaXplIHNob3VsZCBiZSBoYWxmIG9mIG9uZSBkZWZhdWx0IHRpY2sgbWFyayB3aWR0aC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9yYXRpby1hbmQtcHJvcG9ydGlvbi9pc3N1ZXMvODVcclxuICAgIC8vIE5PVEU6IGRvIG5vdCBjaGFuZ2UgdGhpcyB3aXRob3V0IGNoYW5naW5nIHRoZSBjb3BpZWQgY29uc3RhbnQgaW4gZ2V0S2V5Ym9hcmRJbnB1dFNuYXBwaW5nTWFwcGVyVGVzdHMuanNcclxuICAgIGNvbnN0IGtleWJvYXJkU3RlcCA9IDEgLyAyIC8gdGhpcy50aWNrTWFya1JhbmdlUHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgY29uc3QgZGVmYXVsdFJhdGlvSGFsZkJvdW5kcyA9IEJvdW5kczIucmVjdCggMCwgMCwgUkFUSU9fSEFMRl9XSURUSCwgTEFZT1VUX0JPVU5EUy5oZWlnaHQgKTtcclxuXHJcbiAgICAvLyBkZXNjcmlwdGlvbiBvbiBlYWNoIHJhdGlvSGFsZiBzaG91bGQgYmUgdXBkYXRlZCB3aGVuZXZlciB0aGVzZSBjaGFuZ2VcclxuICAgIGNvbnN0IGExMXlEZXBlbmRlbmNpZXMgPSBbIG1vZGVsLnVuY2xhbXBlZEZpdG5lc3NQcm9wZXJ0eSwgdGhpcy50aWNrTWFya1ZpZXdQcm9wZXJ0eSwgdGhpcy50aWNrTWFya1JhbmdlUHJvcGVydHksIG1vZGVsLnRhcmdldFJhdGlvUHJvcGVydHkgXTtcclxuXHJcbiAgICB0aGlzLmFudGVjZWRlbnRSYXRpb0hhbGYgPSBuZXcgUmF0aW9IYWxmKCB7XHJcblxyXG4gICAgICByYXRpbzogcmF0aW8sXHJcbiAgICAgIHJhdGlvVGVybTogUmF0aW9UZXJtLkFOVEVDRURFTlQsXHJcbiAgICAgIGRpc3BsYXlCb3RoSGFuZHNDdWVQcm9wZXJ0eTogY3VlQXJyb3dzU3RhdGUuYm90aEhhbmRzLmFudGVjZWRlbnRDdWVEaXNwbGF5ZWRQcm9wZXJ0eSxcclxuICAgICAgY3VlQXJyb3dzU3RhdGU6IGN1ZUFycm93c1N0YXRlLFxyXG4gICAgICBib3VuZHM6IGRlZmF1bHRSYXRpb0hhbGZCb3VuZHMsXHJcbiAgICAgIHRpY2tNYXJrVmlld1Byb3BlcnR5OiB0aGlzLnRpY2tNYXJrVmlld1Byb3BlcnR5LFxyXG4gICAgICB0aWNrTWFya1JhbmdlUHJvcGVydHk6IHRoaXMudGlja01hcmtSYW5nZVByb3BlcnR5LFxyXG4gICAgICByYXRpb0Rlc2NyaWJlcjogdGhpcy5yYXRpb0Rlc2NyaWJlcixcclxuICAgICAgY29sb3JQcm9wZXJ0eTogdGlja01hcmtzQW5kTGFiZWxzQ29sb3JQcm9wZXJ0eSxcclxuICAgICAga2V5Ym9hcmRTdGVwOiBrZXlib2FyZFN0ZXAsXHJcbiAgICAgIGhvcml6b250YWxNb3ZlbWVudEFsbG93ZWRQcm9wZXJ0eTogbW9kZWwucmF0aW8ubG9ja2VkUHJvcGVydHksXHJcbiAgICAgIHBsYXlUaWNrTWFya0J1bXBTb3VuZFByb3BlcnR5OiBwbGF5VGlja01hcmtCdW1wU291bmRQcm9wZXJ0eSxcclxuXHJcbiAgICAgIC8vIE1ha2UgdGhpcyBhIGNsb3N1cmUgc28gc3VwcG9ydCBjcmVhdGlvbiBvcmRlclxyXG4gICAgICBzZXRKdW1waW5nT3ZlclByb3BvcnRpb25TaG91bGRUcmlnZ2VyU291bmQ6ICggaXNKdW1waW5nOiBib29sZWFuICkgPT4gdGhpcy5pblByb3BvcnRpb25Tb3VuZEdlbmVyYXRvci5zZXRKdW1waW5nT3ZlclByb3BvcnRpb25TaG91bGRUcmlnZ2VyU291bmQoIGlzSnVtcGluZyApLFxyXG5cclxuICAgICAgZ2V0SWRlYWxWYWx1ZTogKCkgPT4gbW9kZWwuZ2V0SWRlYWxWYWx1ZUZvclRlcm0oIFJhdGlvVGVybS5BTlRFQ0VERU5UICksXHJcbiAgICAgIGluUHJvcG9ydGlvblByb3BlcnR5OiBtb2RlbC5pblByb3BvcnRpb25Qcm9wZXJ0eSxcclxuXHJcbiAgICAgIGhhbmRDb2xvclByb3BlcnR5OiBvcHRpb25zLmxlZnRIYW5kQ29sb3JQcm9wZXJ0eSxcclxuICAgICAgYWNjZXNzaWJsZU5hbWU6IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS5sZWZ0SGFuZFN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBhMTF5RGVwZW5kZW5jaWVzOiBhMTF5RGVwZW5kZW5jaWVzLFxyXG4gICAgICBib3RoSGFuZHNDdWVEaXNwbGF5OiBDdWVEaXNwbGF5LldfUyxcclxuICAgICAgaXNSaWdodDogZmFsc2UsIC8vIHRoaXMgd2F5IHdlIGdldCBhIGxlZnQgaGFuZFxyXG5cclxuICAgICAgLy8gQWRkZWQgdG8gdGhlIGFudGVjZWRlbnQgZm9yIGVhc2UsIGJ1dCBpdCBhcHBsaWVzIHRvIGJvdGggUmF0aW9IYWxmcyBpbiB0aGUgUERPTVxyXG4gICAgICBoZWxwVGV4dDogUmF0aW9BbmRQcm9wb3J0aW9uU3RyaW5ncy5hMTF5LmluZGl2aWR1YWxIYW5kc0hlbHBUZXh0U3RyaW5nUHJvcGVydHksXHJcblxyXG4gICAgICBoZWxwVGV4dEJlaGF2aW9yOiBQYXJhbGxlbERPTS5IRUxQX1RFWFRfQkVGT1JFX0NPTlRFTlQsXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnYW50ZWNlZGVudFJhdGlvSGFsZicgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuY29uc2VxdWVudFJhdGlvSGFsZiA9IG5ldyBSYXRpb0hhbGYoIHtcclxuXHJcbiAgICAgIHJhdGlvOiByYXRpbyxcclxuICAgICAgcmF0aW9UZXJtOiBSYXRpb1Rlcm0uQ09OU0VRVUVOVCxcclxuICAgICAgZGlzcGxheUJvdGhIYW5kc0N1ZVByb3BlcnR5OiBjdWVBcnJvd3NTdGF0ZS5ib3RoSGFuZHMuY29uc2VxdWVudEN1ZURpc3BsYXllZFByb3BlcnR5LFxyXG4gICAgICBjdWVBcnJvd3NTdGF0ZTogY3VlQXJyb3dzU3RhdGUsXHJcbiAgICAgIGJvdW5kczogZGVmYXVsdFJhdGlvSGFsZkJvdW5kcyxcclxuICAgICAgdGlja01hcmtWaWV3UHJvcGVydHk6IHRoaXMudGlja01hcmtWaWV3UHJvcGVydHksXHJcbiAgICAgIHRpY2tNYXJrUmFuZ2VQcm9wZXJ0eTogdGhpcy50aWNrTWFya1JhbmdlUHJvcGVydHksXHJcbiAgICAgIHJhdGlvRGVzY3JpYmVyOiB0aGlzLnJhdGlvRGVzY3JpYmVyLFxyXG4gICAgICBjb2xvclByb3BlcnR5OiB0aWNrTWFya3NBbmRMYWJlbHNDb2xvclByb3BlcnR5LFxyXG4gICAgICBrZXlib2FyZFN0ZXA6IGtleWJvYXJkU3RlcCxcclxuICAgICAgaG9yaXpvbnRhbE1vdmVtZW50QWxsb3dlZFByb3BlcnR5OiBtb2RlbC5yYXRpby5sb2NrZWRQcm9wZXJ0eSxcclxuICAgICAgcGxheVRpY2tNYXJrQnVtcFNvdW5kUHJvcGVydHk6IHBsYXlUaWNrTWFya0J1bXBTb3VuZFByb3BlcnR5LFxyXG5cclxuICAgICAgLy8gTWFrZSB0aGlzIGEgY2xvc3VyZSBzbyBzdXBwb3J0IGNyZWF0aW9uIG9yZGVyXHJcbiAgICAgIHNldEp1bXBpbmdPdmVyUHJvcG9ydGlvblNob3VsZFRyaWdnZXJTb3VuZDogKCBpc0p1bXBpbmc6IGJvb2xlYW4gKSA9PiB0aGlzLmluUHJvcG9ydGlvblNvdW5kR2VuZXJhdG9yLnNldEp1bXBpbmdPdmVyUHJvcG9ydGlvblNob3VsZFRyaWdnZXJTb3VuZCggaXNKdW1waW5nICksXHJcblxyXG4gICAgICBnZXRJZGVhbFZhbHVlOiAoKSA9PiBtb2RlbC5nZXRJZGVhbFZhbHVlRm9yVGVybSggUmF0aW9UZXJtLkNPTlNFUVVFTlQgKSxcclxuICAgICAgaW5Qcm9wb3J0aW9uUHJvcGVydHk6IG1vZGVsLmluUHJvcG9ydGlvblByb3BlcnR5LFxyXG5cclxuICAgICAgaGFuZENvbG9yUHJvcGVydHk6IG9wdGlvbnMucmlnaHRIYW5kQ29sb3JQcm9wZXJ0eSxcclxuICAgICAgYWNjZXNzaWJsZU5hbWU6IFJhdGlvQW5kUHJvcG9ydGlvblN0cmluZ3MuYTExeS5yaWdodEhhbmRTdHJpbmdQcm9wZXJ0eSxcclxuICAgICAgYTExeURlcGVuZGVuY2llczogYTExeURlcGVuZGVuY2llcyxcclxuXHJcbiAgICAgIC8vIHBoZXQtaW9cclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdjb25zZXF1ZW50UmF0aW9IYWxmJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gVE9ETzogaG93IHRvIGhhbmRsZSB0aGlzIG1lcmdlPyBJdCBzZWVtcyBsaWtlIFBIRVRfQ09SRS9tZXJnZSBpcyB0aGUgYmVzdCBjYXNlIGZvciB0aGlzLCB3ZSBhcmUgJmluZyB0aGUgdHdvIGFyZ3VtZW50cyBpbnRvIEJvdGhIYW5kc1BET01Ob2RlLCBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2hpcHBlci9pc3N1ZXMvMTEyOFxyXG4gICAgY29uc3QgYm90aEhhbmRzUERPTU5vZGUgPSBuZXcgQm90aEhhbmRzUERPTU5vZGUoIG1lcmdlKCB7XHJcbiAgICAgICAgcmF0aW9UdXBsZVByb3BlcnR5OiByYXRpby50dXBsZVByb3BlcnR5LFxyXG4gICAgICAgIGVuYWJsZWRSYXRpb1Rlcm1zUmFuZ2VQcm9wZXJ0eTogcmF0aW8uZW5hYmxlZFJhdGlvVGVybXNSYW5nZVByb3BlcnR5LFxyXG4gICAgICAgIGN1ZUFycm93c1N0YXRlOiBjdWVBcnJvd3NTdGF0ZSxcclxuICAgICAgICBrZXlib2FyZFN0ZXA6IGtleWJvYXJkU3RlcCxcclxuICAgICAgICB0aWNrTWFya1ZpZXdQcm9wZXJ0eTogdGhpcy50aWNrTWFya1ZpZXdQcm9wZXJ0eSxcclxuICAgICAgICB0aWNrTWFya1JhbmdlUHJvcGVydHk6IHRoaXMudGlja01hcmtSYW5nZVByb3BlcnR5LFxyXG4gICAgICAgIHVuY2xhbXBlZEZpdG5lc3NQcm9wZXJ0eTogbW9kZWwudW5jbGFtcGVkRml0bmVzc1Byb3BlcnR5LFxyXG4gICAgICAgIHJhdGlvRGVzY3JpYmVyOiB0aGlzLnJhdGlvRGVzY3JpYmVyLFxyXG4gICAgICAgIHBsYXlUaWNrTWFya0J1bXBTb3VuZFByb3BlcnR5OiBwbGF5VGlja01hcmtCdW1wU291bmRQcm9wZXJ0eSxcclxuICAgICAgICByYXRpb0xvY2tlZFByb3BlcnR5OiBtb2RlbC5yYXRpby5sb2NrZWRQcm9wZXJ0eSxcclxuICAgICAgICB0YXJnZXRSYXRpb1Byb3BlcnR5OiBtb2RlbC50YXJnZXRSYXRpb1Byb3BlcnR5LFxyXG4gICAgICAgIGdldElkZWFsVGVybTogbW9kZWwuZ2V0SWRlYWxWYWx1ZUZvclRlcm0uYmluZCggbW9kZWwgKSxcclxuICAgICAgICBpblByb3BvcnRpb25Qcm9wZXJ0eTogbW9kZWwuaW5Qcm9wb3J0aW9uUHJvcGVydHksXHJcblxyXG4gICAgICAgIGludGVyYWN0aXZlTm9kZU9wdGlvbnM6IHtcclxuICAgICAgICAgIGNoaWxkcmVuOiBbIHRoaXMuYW50ZWNlZGVudFJhdGlvSGFsZiwgdGhpcy5jb25zZXF1ZW50UmF0aW9IYWxmIF1cclxuICAgICAgICB9XHJcbiAgICAgIH0sIG9wdGlvbnMuYm90aEhhbmRzUERPTU5vZGVPcHRpb25zIClcclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5tZWRpYVBpcGUgPSBudWxsO1xyXG4gICAgaWYgKCBNZWRpYVBpcGVRdWVyeVBhcmFtZXRlcnMuY2FtZXJhSW5wdXQgPT09ICdoYW5kcycgKSB7XHJcbiAgICAgIGNvbnN0IG1lZGlhUGlwZUJvdGhIYW5kc0Rlc2NyaWJlciA9IG5ldyBCb3RoSGFuZHNEZXNjcmliZXIoXHJcbiAgICAgICAgcmF0aW8udHVwbGVQcm9wZXJ0eSxcclxuICAgICAgICByYXRpby5lbmFibGVkUmF0aW9UZXJtc1JhbmdlUHJvcGVydHksXHJcbiAgICAgICAgcmF0aW8ubG9ja2VkUHJvcGVydHksXHJcbiAgICAgICAgdGhpcy50aWNrTWFya1ZpZXdQcm9wZXJ0eSxcclxuICAgICAgICBtb2RlbC5pblByb3BvcnRpb25Qcm9wZXJ0eSxcclxuICAgICAgICB0aGlzLnJhdGlvRGVzY3JpYmVyLFxyXG4gICAgICAgIG5ldyBUaWNrTWFya0Rlc2NyaWJlciggdGhpcy50aWNrTWFya1JhbmdlUHJvcGVydHksIHRoaXMudGlja01hcmtWaWV3UHJvcGVydHkgKVxyXG4gICAgICApO1xyXG5cclxuICAgICAgY29uc3QgbWVkaWFQaXBlVm9pY2luZ0VuZERyYWdVdHRlcmFuY2UgPSBuZXcgVXR0ZXJhbmNlKCB7XHJcbiAgICAgICAgYWxlcnQ6IG5ldyBSZXNwb25zZVBhY2tldCgge1xyXG4gICAgICAgICAgb2JqZWN0UmVzcG9uc2U6ICgpID0+IG1lZGlhUGlwZUJvdGhIYW5kc0Rlc2NyaWJlci5nZXRCb3RoSGFuZHNPYmplY3RSZXNwb25zZSgpLFxyXG4gICAgICAgICAgY29udGV4dFJlc3BvbnNlOiAoKSA9PiBtZWRpYVBpcGVCb3RoSGFuZHNEZXNjcmliZXIuZ2V0Qm90aEhhbmRzQ29udGV4dFJlc3BvbnNlKCBSYXRpb0lucHV0TW9kYWxpdHkuQk9USF9IQU5EUywge1xyXG4gICAgICAgICAgICBkaXN0YW5jZVJlc3BvbnNlVHlwZTogRGlzdGFuY2VSZXNwb25zZVR5cGUuRElTVEFOQ0VfUkVHSU9OXHJcbiAgICAgICAgICB9IClcclxuICAgICAgICB9ICksXHJcbiAgICAgICAgcHJpb3JpdHk6IFV0dGVyYW5jZS5NRURJVU1fUFJJT1JJVFkgLy8gU2hvdWxkIGludGVycnVwdCB0aGUgZHJhZ2dpbmcgVXR0ZXJhbmNlXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIGNvbnN0IG1lZGlhUGlwZVZvaWNpbmdEcmFnVXR0ZXJhbmNlID0gbmV3IFV0dGVyYW5jZSgge1xyXG4gICAgICAgIGFsZXJ0OiBuZXcgUmVzcG9uc2VQYWNrZXQoIHtcclxuICAgICAgICAgIG9iamVjdFJlc3BvbnNlOiAoKSA9PiBtZWRpYVBpcGVCb3RoSGFuZHNEZXNjcmliZXIuZ2V0Qm90aEhhbmRzT2JqZWN0UmVzcG9uc2UoKSxcclxuICAgICAgICAgIGNvbnRleHRSZXNwb25zZTogKCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gbWVkaWFQaXBlQm90aEhhbmRzRGVzY3JpYmVyLmdldEJvdGhIYW5kc0NvbnRleHRSZXNwb25zZSggUmF0aW9JbnB1dE1vZGFsaXR5LkJPVEhfSEFORFMsIHtcclxuICAgICAgICAgICAgICBkaXN0YW5jZVJlc3BvbnNlVHlwZTogRGlzdGFuY2VSZXNwb25zZVR5cGUuRElTVEFOQ0VfUFJPR1JFU1NcclxuICAgICAgICAgICAgfSApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gKVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBTbyB0aGF0IHRoaXMgVXR0ZXJhbmNlIGRvZXMgbm90IGFubm91bmNlIHVubGVzcyB0aGUgU2NyZWVuVmlldyBpcyB2aXNpYmxlIGFuZCB2b2ljaW5nVmlzaWJsZS5cclxuICAgICAgVm9pY2luZy5yZWdpc3RlclV0dGVyYW5jZVRvTm9kZSggbWVkaWFQaXBlVm9pY2luZ0VuZERyYWdVdHRlcmFuY2UsIHRoaXMgKTtcclxuICAgICAgVm9pY2luZy5yZWdpc3RlclV0dGVyYW5jZVRvTm9kZSggbWVkaWFQaXBlVm9pY2luZ0RyYWdVdHRlcmFuY2UsIHRoaXMgKTtcclxuXHJcbiAgICAgIHRoaXMubWVkaWFQaXBlID0gbmV3IFJBUE1lZGlhUGlwZSggbW9kZWwucmF0aW8udHVwbGVQcm9wZXJ0eSxcclxuICAgICAgICBtb2RlbC5yYXRpby5sb2NrZWRQcm9wZXJ0eSxcclxuICAgICAgICB0aGlzLmFudGVjZWRlbnRSYXRpb0hhbGYudmlld1NvdW5kcyxcclxuICAgICAgICB0aGlzLmNvbnNlcXVlbnRSYXRpb0hhbGYudmlld1NvdW5kcywge1xyXG4gICAgICAgICAgaXNCZWluZ0ludGVyYWN0ZWRXaXRoUHJvcGVydHk6IG1vZGVsLm1lZGlhUGlwZUludGVyYWN0ZWRXaXRoUHJvcGVydHksXHJcbiAgICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ21lZGlhUGlwZScgKVxyXG4gICAgICAgIH0gKTtcclxuXHJcbiAgICAgIHRoaXMubWVkaWFQaXBlLmlzQmVpbmdJbnRlcmFjdGVkV2l0aFByb3BlcnR5LmxhenlMaW5rKCAoIGludGVyYWN0ZWRXaXRoTWFya2VyczogYm9vbGVhbiApID0+IHtcclxuICAgICAgICBpZiAoIGludGVyYWN0ZWRXaXRoTWFya2VycyApIHtcclxuICAgICAgICAgIGN1ZUFycm93c1N0YXRlLmludGVyYWN0ZWRXaXRoTW91c2VQcm9wZXJ0eS52YWx1ZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICB0aGlzLm1lZGlhUGlwZS5vSGFuZEdlc3R1cmVQcm9wZXJ0eS5sYXp5TGluayggb0hhbmRHZXN0dXJlRGV0ZWN0ZWQgPT4ge1xyXG5cclxuICAgICAgICBpZiAoIG9IYW5kR2VzdHVyZURldGVjdGVkICkge1xyXG4gICAgICAgICAgVm9pY2luZy5hbGVydFV0dGVyYW5jZSggbWVkaWFQaXBlVm9pY2luZ0VuZERyYWdVdHRlcmFuY2UgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICB2b2ljaW5nVXR0ZXJhbmNlUXVldWUuY2FuY2VsVXR0ZXJhbmNlKCBtZWRpYVBpcGVWb2ljaW5nRW5kRHJhZ1V0dGVyYW5jZSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG5cclxuICAgICAgdGhpcy5zdGVwRW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICAgIHRoaXMubWVkaWFQaXBlIS5zdGVwKCk7XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIHRoaXMubWVkaWFQaXBlLmhhbmRzU3RhdGlvbmFyeVByb3BlcnR5LmxhenlMaW5rKCBpc1N0YXRpb25hcnkgPT4ge1xyXG5cclxuICAgICAgICBpZiAoIGlzU3RhdGlvbmFyeSApIHtcclxuICAgICAgICAgIFZvaWNpbmcuYWxlcnRVdHRlcmFuY2UoIG1lZGlhUGlwZVZvaWNpbmdEcmFnVXR0ZXJhbmNlICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgdm9pY2luZ1V0dGVyYW5jZVF1ZXVlLmNhbmNlbFV0dGVyYW5jZSggbWVkaWFQaXBlVm9pY2luZ0RyYWdVdHRlcmFuY2UgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBibHVldG9vdGhJbnRlcmFjdGVkV2l0aFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdibHVldG9vdGhJbnRlcmFjdGVkV2l0aFByb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3Qgc291bmRHZW5lcmF0b3JFbmFibGVkUHJvcGVydHkgPSBEZXJpdmVkUHJvcGVydHkub3IoIFtcclxuICAgICAgdGhpcy5hbnRlY2VkZW50UmF0aW9IYWxmLmlzQmVpbmdJbnRlcmFjdGVkV2l0aFByb3BlcnR5LFxyXG4gICAgICB0aGlzLmNvbnNlcXVlbnRSYXRpb0hhbGYuaXNCZWluZ0ludGVyYWN0ZWRXaXRoUHJvcGVydHksXHJcbiAgICAgIGJvdGhIYW5kc1BET01Ob2RlLmlzQmVpbmdJbnRlcmFjdGVkV2l0aFByb3BlcnR5LFxyXG4gICAgICB0aGlzLm1lZGlhUGlwZSA/IHRoaXMubWVkaWFQaXBlLmlzQmVpbmdJbnRlcmFjdGVkV2l0aFByb3BlcnR5IDogbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKSxcclxuICAgICAgYmx1ZXRvb3RoSW50ZXJhY3RlZFdpdGhQcm9wZXJ0eVxyXG4gICAgXSApO1xyXG5cclxuICAgIHRoaXMuaW5Qcm9wb3J0aW9uU291bmRHZW5lcmF0b3IgPSBuZXcgSW5Qcm9wb3J0aW9uU291bmRHZW5lcmF0b3IoIG1vZGVsLCBzb3VuZEdlbmVyYXRvckVuYWJsZWRQcm9wZXJ0eSApO1xyXG4gICAgdGhpcy5tb3ZpbmdJblByb3BvcnRpb25Tb3VuZEdlbmVyYXRvciA9IG5ldyBNb3ZpbmdJblByb3BvcnRpb25Tb3VuZEdlbmVyYXRvciggbW9kZWwsIHtcclxuICAgICAgZW5hYmxlQ29udHJvbFByb3BlcnRpZXM6IFsgc291bmRHZW5lcmF0b3JFbmFibGVkUHJvcGVydHkgXVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5zdGFjY2F0b0ZyZXF1ZW5jeVNvdW5kR2VuZXJhdG9yID0gbmV3IFN0YWNjYXRvRnJlcXVlbmN5U291bmRHZW5lcmF0b3IoIG1vZGVsLnJhdGlvRml0bmVzc1Byb3BlcnR5LCByYXBDb25zdGFudHMuUkFUSU9fRklUTkVTU19SQU5HRSxcclxuICAgICAgbW9kZWwuaW5Qcm9wb3J0aW9uUHJvcGVydHksIHtcclxuICAgICAgICBlbmFibGVDb250cm9sUHJvcGVydGllczogWyBzb3VuZEdlbmVyYXRvckVuYWJsZWRQcm9wZXJ0eSBdXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICBzb3VuZE1hbmFnZXIuYWRkU291bmRHZW5lcmF0b3IoIHRoaXMuc3RhY2NhdG9GcmVxdWVuY3lTb3VuZEdlbmVyYXRvciApO1xyXG4gICAgc291bmRNYW5hZ2VyLmFkZFNvdW5kR2VuZXJhdG9yKCB0aGlzLmluUHJvcG9ydGlvblNvdW5kR2VuZXJhdG9yICk7XHJcbiAgICBzb3VuZE1hbmFnZXIuYWRkU291bmRHZW5lcmF0b3IoIHRoaXMubW92aW5nSW5Qcm9wb3J0aW9uU291bmRHZW5lcmF0b3IgKTtcclxuXHJcbiAgICAvLyB0aGVzZSBkaW1lbnNpb25zIGFyZSBqdXN0IHRlbXBvcmFyeSwgYW5kIHdpbGwgYmUgcmVjb21wdXRlZCBiZWxvdyBpbiB0aGUgbGF5b3V0IGZ1bmN0aW9uXHJcbiAgICB0aGlzLmxhYmVsc05vZGUgPSBuZXcgUkFQVGlja01hcmtMYWJlbHNOb2RlKCB0aGlzLnRpY2tNYXJrVmlld1Byb3BlcnR5LCB0aGlzLnRpY2tNYXJrUmFuZ2VQcm9wZXJ0eSwgMTAwMCwgdGlja01hcmtzQW5kTGFiZWxzQ29sb3JQcm9wZXJ0eSApO1xyXG5cclxuICAgIGNvbnN0IHJlc2V0QWxsQnV0dG9uID0gbmV3IFJlc2V0QWxsQnV0dG9uKCB7XHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5pbnRlcnJ1cHRTdWJ0cmVlSW5wdXQoKTsgLy8gY2FuY2VsIGludGVyYWN0aW9ucyB0aGF0IG1heSBiZSBpbiBwcm9ncmVzc1xyXG4gICAgICAgIG1vZGVsLnJlc2V0KCk7XHJcbiAgICAgICAgY3VlQXJyb3dzU3RhdGUucmVzZXQoKTtcclxuICAgICAgICBib3RoSGFuZHNQRE9NTm9kZS5yZXNldCgpO1xyXG4gICAgICAgIHRoaXMubWVkaWFQaXBlICYmIHRoaXMubWVkaWFQaXBlLnJlc2V0KCk7XHJcbiAgICAgICAgdGhpcy5yZXNldCgpO1xyXG4gICAgICB9LFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Jlc2V0QWxsQnV0dG9uJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgaWYgKCBSQVBRdWVyeVBhcmFtZXRlcnMuYmx1ZXRvb3RoICkge1xyXG4gICAgICBjb25zdCBhbnRlY2VkZW50Q29ubmVjdGlvbkJ1dHRvbiA9IG5ldyBSYXRpb0FuZFByb3BvcnRpb25CbHVldG9vdGhCdXR0b24oIG1vZGVsLnJhdGlvLnR1cGxlUHJvcGVydHksIFJhdGlvVGVybS5BTlRFQ0VERU5ULCB7XHJcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdhbnRlY2VkZW50Q29ubmVjdGlvbkJ1dHRvbicgKVxyXG4gICAgICB9ICk7XHJcbiAgICAgIGNvbnN0IGNvbnNlcXVlbnRDb25uZWN0aW9uQnV0dG9uID0gbmV3IFJhdGlvQW5kUHJvcG9ydGlvbkJsdWV0b290aEJ1dHRvbiggbW9kZWwucmF0aW8udHVwbGVQcm9wZXJ0eSwgUmF0aW9UZXJtLkNPTlNFUVVFTlQsIHtcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NvbnNlcXVlbnRDb25uZWN0aW9uQnV0dG9uJyApXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIHRoaXMuc3RlcEVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgICAgICBhbnRlY2VkZW50Q29ubmVjdGlvbkJ1dHRvbi5zdGVwKCk7XHJcbiAgICAgICAgY29uc2VxdWVudENvbm5lY3Rpb25CdXR0b24uc3RlcCgpO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIGFudGVjZWRlbnRDb25uZWN0aW9uQnV0dG9uLmlzQmVpbmdJbnRlcmFjdGVkV2l0aFByb3BlcnR5LFxyXG4gICAgICAgICAgY29uc2VxdWVudENvbm5lY3Rpb25CdXR0b24uaXNCZWluZ0ludGVyYWN0ZWRXaXRoUHJvcGVydHkgXSxcclxuICAgICAgICAoIGFudGVjZWRlbnRJbnRlcmFjdGVkV2l0aCwgY29uc2VxdWVudEludGVyYWN0ZWRXaXRoICkgPT4ge1xyXG4gICAgICAgICAgYmx1ZXRvb3RoSW50ZXJhY3RlZFdpdGhQcm9wZXJ0eS52YWx1ZSA9IGFudGVjZWRlbnRJbnRlcmFjdGVkV2l0aCAmJiBjb25zZXF1ZW50SW50ZXJhY3RlZFdpdGg7XHJcbiAgICAgICAgfSApO1xyXG5cclxuICAgICAgYmx1ZXRvb3RoSW50ZXJhY3RlZFdpdGhQcm9wZXJ0eS5sYXp5TGluayggKCBpbnRlcmFjdGVkV2l0aE1hcmtlcnM6IGJvb2xlYW4gKSA9PiB7XHJcbiAgICAgICAgaWYgKCBpbnRlcmFjdGVkV2l0aE1hcmtlcnMgKSB7XHJcbiAgICAgICAgICBjdWVBcnJvd3NTdGF0ZS5pbnRlcmFjdGVkV2l0aE1vdXNlUHJvcGVydHkudmFsdWUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG5cclxuICAgICAgLy8gYmx1ZXRvb3RoIGlzIHN0YXRpb25hcnkgaWYgYm90aCBpbnB1dHMgYXJlIHN0YXRpb25hcnlcclxuICAgICAgY29uc3QgYmx1ZXRvb3RoU3RhdGlvbmFyeVByb3BlcnR5ID0gRGVyaXZlZFByb3BlcnR5LmFuZCggWyBhbnRlY2VkZW50Q29ubmVjdGlvbkJ1dHRvbi5pc1N0YXRpb25hcnlQcm9wZXJ0eSxcclxuICAgICAgICBjb25zZXF1ZW50Q29ubmVjdGlvbkJ1dHRvbi5pc1N0YXRpb25hcnlQcm9wZXJ0eSBdICk7XHJcblxyXG4gICAgICBjb25zdCBibHVldG9vdGhCb3RoSGFuZHNEZXNjcmliZXIgPSBuZXcgQm90aEhhbmRzRGVzY3JpYmVyKFxyXG4gICAgICAgIHJhdGlvLnR1cGxlUHJvcGVydHksXHJcbiAgICAgICAgcmF0aW8uZW5hYmxlZFJhdGlvVGVybXNSYW5nZVByb3BlcnR5LFxyXG4gICAgICAgIHJhdGlvLmxvY2tlZFByb3BlcnR5LFxyXG4gICAgICAgIHRoaXMudGlja01hcmtWaWV3UHJvcGVydHksXHJcbiAgICAgICAgbW9kZWwuaW5Qcm9wb3J0aW9uUHJvcGVydHksXHJcbiAgICAgICAgdGhpcy5yYXRpb0Rlc2NyaWJlcixcclxuICAgICAgICBuZXcgVGlja01hcmtEZXNjcmliZXIoIHRoaXMudGlja01hcmtSYW5nZVByb3BlcnR5LCB0aGlzLnRpY2tNYXJrVmlld1Byb3BlcnR5IClcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGNvbnN0IGJsdWV0b290aFZvaWNpbmdEcmFnVXR0ZXJhbmNlID0gbmV3IFV0dGVyYW5jZSgge1xyXG4gICAgICAgIGFsZXJ0OiBuZXcgUmVzcG9uc2VQYWNrZXQoIHtcclxuICAgICAgICAgIG9iamVjdFJlc3BvbnNlOiAoKSA9PiBibHVldG9vdGhCb3RoSGFuZHNEZXNjcmliZXIuZ2V0Qm90aEhhbmRzT2JqZWN0UmVzcG9uc2UoKSxcclxuICAgICAgICAgIGNvbnRleHRSZXNwb25zZTogKCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gYmx1ZXRvb3RoQm90aEhhbmRzRGVzY3JpYmVyLmdldEJvdGhIYW5kc0NvbnRleHRSZXNwb25zZSggUmF0aW9JbnB1dE1vZGFsaXR5LkJPVEhfSEFORFMsIHtcclxuICAgICAgICAgICAgICBkaXN0YW5jZVJlc3BvbnNlVHlwZTogRGlzdGFuY2VSZXNwb25zZVR5cGUuRElTVEFOQ0VfUFJPR1JFU1NcclxuICAgICAgICAgICAgfSApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gKVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICBibHVldG9vdGhTdGF0aW9uYXJ5UHJvcGVydHkubGF6eUxpbmsoIGlzU3RhdGlvbmFyeSA9PiB7XHJcbiAgICAgICAgaWYgKCBpc1N0YXRpb25hcnkgKSB7XHJcbiAgICAgICAgICBWb2ljaW5nLmFsZXJ0VXR0ZXJhbmNlKCBibHVldG9vdGhWb2ljaW5nRHJhZ1V0dGVyYW5jZSApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHZvaWNpbmdVdHRlcmFuY2VRdWV1ZS5jYW5jZWxVdHRlcmFuY2UoIGJsdWV0b290aFZvaWNpbmdEcmFnVXR0ZXJhbmNlICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICBjb25zdCBibHVldG9vdGhCdXR0b25Cb3ggPSBuZXcgVkJveCgge1xyXG4gICAgICAgIGNoaWxkcmVuOiBbIGFudGVjZWRlbnRDb25uZWN0aW9uQnV0dG9uLCBjb25zZXF1ZW50Q29ubmVjdGlvbkJ1dHRvbiBdLFxyXG4gICAgICAgIHNwYWNpbmc6IDUsXHJcbiAgICAgICAgYWxpZ246ICdyaWdodCdcclxuICAgICAgfSApO1xyXG4gICAgICB0aGlzLmJvdHRvbVNjYWxpbmdVSUxheWVyTm9kZS5hZGRDaGlsZCggYmx1ZXRvb3RoQnV0dG9uQm94ICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdGlja01hcmtWaWV3UmFkaW9CdXR0b25Hcm91cCA9IG5ldyBUaWNrTWFya1ZpZXdSYWRpb0J1dHRvbkdyb3VwKCB0aGlzLnRpY2tNYXJrVmlld1Byb3BlcnR5LCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndGlja01hcmtWaWV3UmFkaW9CdXR0b25Hcm91cCcgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGFkZCB0aGlzIE5vZGUgdG8gdGhlIGxheWVyIHRoYXQgaXMgc2NhbGVkIHVwIHRvIHN1cHBvcnQgdmVydGljYWwgYXNwZWN0IHJhdGlvc1xyXG4gICAgdGhpcy50b3BTY2FsaW5nVUlMYXllck5vZGUuYWRkQ2hpbGQoIHRpY2tNYXJrVmlld1JhZGlvQnV0dG9uR3JvdXAgKTtcclxuICAgIHRoaXMuYm90dG9tU2NhbGluZ1VJTGF5ZXJOb2RlLmFkZENoaWxkKCByZXNldEFsbEJ1dHRvbiApO1xyXG5cclxuICAgIGxldCBwb3NpdGlvblJlZ2lvbnNOb2RlOiBSQVBQb3NpdGlvblJlZ2lvbnNMYXllciB8IG51bGwgPSBudWxsO1xyXG4gICAgaWYgKCBSQVBRdWVyeVBhcmFtZXRlcnMuc2hvd1Bvc2l0aW9uUmVnaW9ucyApIHtcclxuICAgICAgcG9zaXRpb25SZWdpb25zTm9kZSA9IG5ldyBSQVBQb3NpdGlvblJlZ2lvbnNMYXllcigpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2hpbGRyZW4gPSBbXHJcbiAgICAgIHRoaXMubGFiZWxzTm9kZSxcclxuXHJcbiAgICAgIC8vIFVJXHJcbiAgICAgIHRoaXMudG9wU2NhbGluZ1VJTGF5ZXJOb2RlLFxyXG4gICAgICB0aGlzLmJvdHRvbVNjYWxpbmdVSUxheWVyTm9kZSxcclxuXHJcbiAgICAgIC8vIE1haW4gcmF0aW8gb24gdG9wXHJcbiAgICAgIGJvdGhIYW5kc1BET01Ob2RlXHJcbiAgICBdO1xyXG4gICAgcG9zaXRpb25SZWdpb25zTm9kZSAmJiB0aGlzLmFkZENoaWxkKCBwb3NpdGlvblJlZ2lvbnNOb2RlICk7XHJcblxyXG4gICAgLy8gYWNjZXNzaWJsZSBvcmRlciAocmF0aW8gZmlyc3QgaW4gbmF2IG9yZGVyKVxyXG4gICAgdGhpcy5wZG9tUGxheUFyZWFOb2RlLnBkb21PcmRlciA9IFtcclxuICAgICAgYm90aEhhbmRzUERPTU5vZGUsXHJcbiAgICAgIHRpY2tNYXJrVmlld1JhZGlvQnV0dG9uR3JvdXBcclxuICAgIF07XHJcblxyXG4gICAgLy8gYWNjZXNzaWJsZSBvcmRlclxyXG4gICAgdGhpcy5wZG9tQ29udHJvbEFyZWFOb2RlLnBkb21PcmRlciA9IFtcclxuICAgICAgcmVzZXRBbGxCdXR0b25cclxuICAgIF07XHJcblxyXG4gICAgLy8gRHluYW1pYyBsYXlvdXQgaWYgYW55IGNvbnRyb2xzIGNoYW5nZSAobGlrZSBmb3IgZHluYW1pYyBsb2NhbGUgc3dpdGNoaW5nKVxyXG4gICAgdGhpcy50b3BTY2FsaW5nVUlMYXllck5vZGUuYm91bmRzUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICB0aGlzLnRvcFNjYWxpbmdVSUxheWVyTm9kZS5yaWdodCA9IHRoaXMubGF5b3V0Qm91bmRzLm1heFggLSByYXBDb25zdGFudHMuU0NSRUVOX1ZJRVdfWF9NQVJHSU47XHJcbiAgICAgIHRoaXMuc2NhbGVDb250cm9scyggdGhpcy5hbnRlY2VkZW50UmF0aW9IYWxmLnJlY3RIZWlnaHQsIHRoaXMuZ2V0UmF0aW9XaWR0aCgpICk7XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmJvdHRvbVNjYWxpbmdVSUxheWVyTm9kZS5ib3VuZHNQcm9wZXJ0eS5saW5rKCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuYm90dG9tU2NhbGluZ1VJTGF5ZXJOb2RlLnJpZ2h0ID0gdGhpcy5sYXlvdXRCb3VuZHMubWF4WCAtIHJhcENvbnN0YW50cy5TQ1JFRU5fVklFV19YX01BUkdJTjtcclxuICAgICAgdGhpcy5ib3R0b21TY2FsaW5nVUlMYXllck5vZGUuYm90dG9tID0gdGhpcy5sYXlvdXRCb3VuZHMuaGVpZ2h0IC0gcmFwQ29uc3RhbnRzLlNDUkVFTl9WSUVXX1lfTUFSR0lOO1xyXG4gICAgICB0aGlzLnNjYWxlQ29udHJvbHMoIHRoaXMuYW50ZWNlZGVudFJhdGlvSGFsZi5yZWN0SGVpZ2h0LCB0aGlzLmdldFJhdGlvV2lkdGgoKSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMubGF5b3V0UkFQU2NyZWVWaWV3ID0gbmV3UmF0aW9IYWxmQm91bmRzID0+IHtcclxuXHJcbiAgICAgIC8vIGJldHdlZW4gMCBhbmQgMSwgMCBpcyB0aGUgbWluIGhlaWdodCwgMSBpcyB0aGUgbWF4IGhlaWdodFxyXG4gICAgICBjb25zdCBoZWlnaHRTY2FsYXIgPSBVdGlscy5jbGFtcCggKCBuZXdSYXRpb0hhbGZCb3VuZHMuaGVpZ2h0IC0gTEFZT1VUX0JPVU5EUy5oZWlnaHQgKSAvICggTUFYX1JBVElPX0hFSUdIVCAtIExBWU9VVF9CT1VORFMuaGVpZ2h0ICksIDAsIDEgKTtcclxuXHJcbiAgICAgIHRoaXMuYW50ZWNlZGVudFJhdGlvSGFsZi5sYXlvdXQoIG5ld1JhdGlvSGFsZkJvdW5kcywgaGVpZ2h0U2NhbGFyICk7XHJcbiAgICAgIHRoaXMuY29uc2VxdWVudFJhdGlvSGFsZi5sYXlvdXQoIG5ld1JhdGlvSGFsZkJvdW5kcywgaGVpZ2h0U2NhbGFyICk7XHJcblxyXG4gICAgICBjb25zdCByYXRpb0hhbGZEcmFnZ2FibGVBcmVhID0gbmV3UmF0aW9IYWxmQm91bmRzLmhlaWdodCAtICggMiAqIHRoaXMuYW50ZWNlZGVudFJhdGlvSGFsZi5mcmFtaW5nUmVjdGFuZ2xlSGVpZ2h0ICk7XHJcblxyXG4gICAgICAvLyBzdWJ0cmFjdCB0aGUgdG9wIGFuZCBib3R0b20gcmVjdGFuZ2xlcyBmcm9tIHRoZSB0aWNrIG1hcmtzIGhlaWdodFxyXG4gICAgICB0aGlzLmxhYmVsc05vZGUubGF5b3V0KCByYXRpb0hhbGZEcmFnZ2FibGVBcmVhICk7XHJcblxyXG4gICAgICBjb25zdCByYXRpb1dpZHRoID0gdGhpcy5nZXRSYXRpb1dpZHRoKCk7XHJcblxyXG4gICAgICB0aGlzLnNjYWxlQ29udHJvbHMoIG5ld1JhdGlvSGFsZkJvdW5kcy5oZWlnaHQsIHRoaXMuZ2V0UmF0aW9XaWR0aCgpICk7XHJcblxyXG4gICAgICB0aGlzLmFudGVjZWRlbnRSYXRpb0hhbGYubGVmdCA9ICggTWF0aC5tYXgoIFJBVElPX1NFQ1RJT05fV0lEVEggKiB0aGlzLmxheW91dEJvdW5kcy53aWR0aCwgcmF0aW9XaWR0aCApIC0gcmF0aW9XaWR0aCApIC8gMjtcclxuXHJcbiAgICAgIHRoaXMubGFiZWxzTm9kZS5sZWZ0ID0gdGhpcy5hbnRlY2VkZW50UmF0aW9IYWxmLnJpZ2h0ICsgUkFUSU9fSEFMRl9TUEFDSU5HO1xyXG4gICAgICB0aGlzLmNvbnNlcXVlbnRSYXRpb0hhbGYubGVmdCA9IHRoaXMubGFiZWxzTm9kZS5yaWdodCArIFJBVElPX0hBTEZfU1BBQ0lORztcclxuXHJcbiAgICAgIHRoaXMuYW50ZWNlZGVudFJhdGlvSGFsZi5zZXRCb3R0b21PZlJhdGlvSGFsZiggdGhpcy5sYXlvdXRCb3VuZHMuYm90dG9tICk7XHJcbiAgICAgIHRoaXMuY29uc2VxdWVudFJhdGlvSGFsZi5zZXRCb3R0b21PZlJhdGlvSGFsZiggdGhpcy5sYXlvdXRCb3VuZHMuYm90dG9tICk7XHJcblxyXG4gICAgICAvLyBvZmZzZXQgdGhlIGJvdHRvbSBzbyB0aGF0IHRoZSBjZW50ZXIgb2YgdGhlIHRleHQgaXMgcmlnaHQgb24gdGhlIHRpY2sgbWFya1xyXG4gICAgICB0aGlzLmxhYmVsc05vZGUuYm90dG9tID0gdGhpcy5sYXlvdXRCb3VuZHMuYm90dG9tIC0gdGhpcy5hbnRlY2VkZW50UmF0aW9IYWxmLmZyYW1pbmdSZWN0YW5nbGVIZWlnaHQgKyB0aGlzLmxhYmVsc05vZGUubGFiZWxIZWlnaHQgLyAyO1xyXG5cclxuICAgICAgaWYgKCBwb3NpdGlvblJlZ2lvbnNOb2RlICkge1xyXG4gICAgICAgIGNvbnN0IHJhdGlvSGFsdmVzV2lkdGggPSB0aGlzLmFudGVjZWRlbnRSYXRpb0hhbGYud2lkdGggKyB0aGlzLmNvbnNlcXVlbnRSYXRpb0hhbGYud2lkdGggKyAoIDIgKiBSQVRJT19IQUxGX1NQQUNJTkcgKSArIHRoaXMubGFiZWxzTm9kZS53aWR0aDtcclxuICAgICAgICBwb3NpdGlvblJlZ2lvbnNOb2RlLmxheW91dCggcmF0aW9IYWx2ZXNXaWR0aCwgcmF0aW9IYWxmRHJhZ2dhYmxlQXJlYSApO1xyXG4gICAgICAgIHBvc2l0aW9uUmVnaW9uc05vZGUubGVmdCA9IHRoaXMuYW50ZWNlZGVudFJhdGlvSGFsZi5sZWZ0O1xyXG4gICAgICAgIHBvc2l0aW9uUmVnaW9uc05vZGUuYm90dG9tID0gdGhpcy5sYXlvdXRCb3VuZHMuYm90dG9tIC0gdGhpcy5hbnRlY2VkZW50UmF0aW9IYWxmLmZyYW1pbmdSZWN0YW5nbGVIZWlnaHQgKyAoIHBvc2l0aW9uUmVnaW9uc05vZGUubGFiZWxzSGVpZ2h0IC8gMiApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBNYXRoLm1pbiggdGhpcy50b3BTY2FsaW5nVUlMYXllck5vZGUubGVmdCwgdGhpcy5ib3R0b21TY2FsaW5nVUlMYXllck5vZGUubGVmdCApID5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25zZXF1ZW50UmF0aW9IYWxmLnJpZ2h0LFxyXG4gICAgICAgICdjb250cm9scyBhcmUgdG9vIHdpZGUgZm9yIHJhdGlvIHdpZHRoIHRvIGZpdC4nICk7XHJcblxyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLmFudGVjZWRlbnRSYXRpb0hhbGYud2lkdGggKyB0aGlzLmNvbnNlcXVlbnRSYXRpb0hhbGYud2lkdGggK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBNYXRoLm1heCggdGhpcy50b3BTY2FsaW5nVUlMYXllck5vZGUud2lkdGgsIHRoaXMuYm90dG9tU2NhbGluZ1VJTGF5ZXJOb2RlLndpZHRoICkgPCBMQVlPVVRfQk9VTkRTLndpZHRoLFxyXG4gICAgICAgICdldmVyeXRoaW5nIHNob3VsZCBmaXQgaW5zaWRlIGxheW91dCBib3VuZHMnICk7XHJcbiAgICB9O1xyXG4gICAgdGhpcy5sYXlvdXRSQVBTY3JlZVZpZXcoIGRlZmF1bHRSYXRpb0hhbGZCb3VuZHMgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0UmF0aW9XaWR0aCgpOiBudW1iZXIge1xyXG4gICAgY29uc3QgaW5CZXR3ZWVuUmF0aW9XaWR0aCA9ICggMiAqIFJBVElPX0hBTEZfU1BBQ0lORyApICsgdGhpcy5sYWJlbHNOb2RlLndpZHRoO1xyXG4gICAgcmV0dXJuIHRoaXMuYW50ZWNlZGVudFJhdGlvSGFsZi53aWR0aCArIHRoaXMuY29uc2VxdWVudFJhdGlvSGFsZi53aWR0aCArIGluQmV0d2VlblJhdGlvV2lkdGg7XHJcbiAgfVxyXG5cclxuICAvLyBTY2FsZSB0aGUgVUkgY29udHJvbHMgb24gdGhlIHJpZ2h0IHNpZGUgb2YgdGhlIFNjcmVlblZpZXdcclxuICBwcml2YXRlIHNjYWxlQ29udHJvbHMoIGhlaWdodDogbnVtYmVyLCByYXRpb1dpZHRoOiBudW1iZXIgKTogdm9pZCB7XHJcblxyXG4gICAgLy8gSWRlYWwgc2NhbGVcclxuICAgIGNvbnN0IGRlc2lyZWRTY2FsZUZyb21IZWlnaHQgPSB1aVNjYWxlRnVuY3Rpb24uZXZhbHVhdGUoIGhlaWdodCApO1xyXG5cclxuICAgIGNvbnN0IHVuc2NhbGVkV2lkdGggPSBNYXRoLm1heCggdGhpcy50b3BTY2FsaW5nVUlMYXllck5vZGUubG9jYWxCb3VuZHNQcm9wZXJ0eS52YWx1ZS53aWR0aCxcclxuICAgICAgdGhpcy5ib3R0b21TY2FsaW5nVUlMYXllck5vZGUubG9jYWxCb3VuZHNQcm9wZXJ0eS52YWx1ZS53aWR0aCApO1xyXG4gICAgY29uc3QgYXZhaWxhYmxlV2lkdGggPSB0aGlzLmxheW91dEJvdW5kcy53aWR0aCAtIHJhdGlvV2lkdGggLSAyICogcmFwQ29uc3RhbnRzLlNDUkVFTl9WSUVXX1hfTUFSR0lOO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdW5zY2FsZWRXaWR0aCA8IGF2YWlsYWJsZVdpZHRoLCAnYXZhaWxhYmxlV2lkdGggc2hvdWxkIGFsd2F5cyBiZSBncmVhdGVyIHRoYW4gd2lkdGggb2YgY29tcG9uZW50JyApO1xyXG5cclxuICAgIC8vIElmIHRoZSBjb250cm9scyBhcmUgdG9vIGJpZywgc2NhbGUgbGVzcyB0aGFuIGRlc2lyZWQgYXMgdG8gbm90IG92ZXJsYXAgd2l0aCByYXRpb1xyXG4gICAgY29uc3QgYWN0dWFsU2NhbGUgPSBNYXRoLm1pbiggZGVzaXJlZFNjYWxlRnJvbUhlaWdodCwgYXZhaWxhYmxlV2lkdGggLyB1bnNjYWxlZFdpZHRoICk7XHJcblxyXG4gICAgdGhpcy50b3BTY2FsaW5nVUlMYXllck5vZGUuc2V0U2NhbGVNYWduaXR1ZGUoIGFjdHVhbFNjYWxlICk7XHJcbiAgICB0aGlzLmJvdHRvbVNjYWxpbmdVSUxheWVyTm9kZS5zZXRTY2FsZU1hZ25pdHVkZSggYWN0dWFsU2NhbGUgKTtcclxuICAgIHRoaXMudG9wU2NhbGluZ1VJTGF5ZXJOb2RlLnRvcCA9IHVpUG9zaXRpb25GdW5jdGlvbi5ldmFsdWF0ZSggYWN0dWFsU2NhbGUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExheW91dCBOb2RlcyBwYXJ0IG9mIGV0aGUgc2NyZWVuIHZpdy4gVG8gYWNjb21wbGlzaCwgbXVjaCBvZiB0aGlzIHdhcyBjb3BpZWQgZnJvbSBTY3JlZW5WaWV3LmxheW91dCwgd2l0aFxyXG4gICAqIG1pbm9yIHR3ZWFrcyBmb3IgdGhpcyBzcGVjaWZpYyBjYXNlLiBBbHNvIG5vdGUgUHJvamVjdGlsZSBNb3Rpb24gdXNlcyBhbG1vc3QgdGhlIGV4YWN0IHNhbWUgYWxnb3JpdGhtLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBsYXlvdXQoIHZpZXdCb3VuZHM6IEJvdW5kczIgKTogdm9pZCB7XHJcblxyXG4gICAgdGhpcy5tYXRyaXggPSBTY3JlZW5WaWV3LmdldExheW91dE1hdHJpeCggdGhpcy5sYXlvdXRCb3VuZHMsIHZpZXdCb3VuZHMsIHsgdmVydGljYWxBbGlnbjogJ2JvdHRvbScgfSApO1xyXG4gICAgdGhpcy52aXNpYmxlQm91bmRzUHJvcGVydHkudmFsdWUgPSB0aGlzLnBhcmVudFRvTG9jYWxCb3VuZHMoIHZpZXdCb3VuZHMgKTtcclxuXHJcbiAgICBjb25zdCByYXRpb0hlaWdodCA9IE1hdGgubWluKCB0aGlzLnZpc2libGVCb3VuZHNQcm9wZXJ0eS52YWx1ZS5oZWlnaHQsIE1BWF9SQVRJT19IRUlHSFQgKTtcclxuICAgIHRoaXMubGF5b3V0UkFQU2NyZWVWaWV3KCBuZXcgQm91bmRzMiggMCwgMCwgT05FX1FVQVJURVJfTEFZT1VUX1dJRFRILCByYXRpb0hlaWdodCApICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLnRpY2tNYXJrUmFuZ2VQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy50aWNrTWFya1ZpZXdQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5hbnRlY2VkZW50UmF0aW9IYWxmLnJlc2V0KCk7XHJcbiAgICB0aGlzLmNvbnNlcXVlbnRSYXRpb0hhbGYucmVzZXQoKTtcclxuICAgIHRoaXMuc3RhY2NhdG9GcmVxdWVuY3lTb3VuZEdlbmVyYXRvci5yZXNldCgpO1xyXG4gICAgdGhpcy5pblByb3BvcnRpb25Tb3VuZEdlbmVyYXRvci5yZXNldCgpO1xyXG4gICAgdGhpcy5tb3ZpbmdJblByb3BvcnRpb25Tb3VuZEdlbmVyYXRvci5yZXNldCgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIHN0ZXAoIGR0OiBudW1iZXIgKTogdm9pZCB7XHJcblxyXG4gICAgdGhpcy5zdGVwRW1pdHRlci5lbWl0KCBkdCApO1xyXG4gICAgdGhpcy5pblByb3BvcnRpb25Tb3VuZEdlbmVyYXRvci5zdGVwKCBkdCApO1xyXG4gICAgdGhpcy5zdGFjY2F0b0ZyZXF1ZW5jeVNvdW5kR2VuZXJhdG9yLnN0ZXAoIGR0ICk7XHJcbiAgfVxyXG59XHJcblxyXG5yYXRpb0FuZFByb3BvcnRpb24ucmVnaXN0ZXIoICdSQVBTY3JlZW5WaWV3JywgUkFQU2NyZWVuVmlldyApO1xyXG5leHBvcnQgZGVmYXVsdCBSQVBTY3JlZW5WaWV3OyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxjQUFjLE1BQU0sdUNBQXVDO0FBQ2xFLE9BQU9DLFFBQVEsTUFBTSxpQ0FBaUM7QUFDdEQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxjQUFjLE1BQU0sc0NBQXNDO0FBQ2pFLE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsVUFBVSxNQUE2QixvQ0FBb0M7QUFDbEYsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxPQUFPQyxTQUFTLE1BQU0sdUNBQXVDO0FBQzdELE9BQU9DLGNBQWMsTUFBTSx1REFBdUQ7QUFDbEYsU0FBU0MsS0FBSyxFQUFFQyxXQUFXLEVBQUVDLElBQUksRUFBRUMsT0FBTyxFQUFFQyxxQkFBcUIsUUFBUSxtQ0FBbUM7QUFDNUcsT0FBT0MsWUFBWSxNQUFNLHNDQUFzQztBQUMvRCxPQUFPQyxrQkFBa0IsTUFBTSw2QkFBNkI7QUFDNUQsT0FBT0MseUJBQXlCLE1BQU0sb0NBQW9DO0FBQzFFLE9BQU9DLFNBQVMsTUFBTSx1QkFBdUI7QUFDN0MsT0FBT0MsWUFBWSxNQUFNLG9CQUFvQjtBQUM3QyxPQUFPQyxrQkFBa0IsTUFBTSwwQkFBMEI7QUFDekQsT0FBT0MsaUJBQWlCLE1BQW9DLHdCQUF3QjtBQUNwRixPQUFPQyxjQUFjLE1BQU0scUJBQXFCO0FBQ2hELE9BQU9DLGtCQUFrQixNQUFNLG9DQUFvQztBQUNuRSxPQUFPQyxjQUFjLE1BQU0sZ0NBQWdDO0FB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