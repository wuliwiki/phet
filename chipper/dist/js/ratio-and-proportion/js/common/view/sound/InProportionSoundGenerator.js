// Copyright 2020-2022, University of Colorado Boulder

/**
 * A short but sustained note that plays when the ratio becomes "in proportion". This type has built-in functionality to allow the
 * note to sustain if in-proportion, but will quickly quiet when no longer "in proportion".
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../../axon/js/DerivedProperty.js';
import NumberProperty from '../../../../../axon/js/NumberProperty.js';
import SoundClip from '../../../../../tambo/js/sound-generators/SoundClip.js';
import inProportion_mp3 from '../../../../sounds/in-proportion/inProportion_mp3.js';
import ratioAndProportion from '../../../ratioAndProportion.js';
import optionize from '../../../../../phet-core/js/optionize.js';
const SUCCESS_OUTPUT_LEVEL = 0.8;
const SILENT_LEVEL = 0;

// The distance that you must move away from being in Proportion until you can then come back in proportion and get a
// success sound to play. See InProportionSoundGenerator. In "fitness" units, so the default value is a space of 10%
// of the fitness range.
const HYSTERESIS_THRESHOLD = 0.1;

// The minimum time, in seconds, that this SoundClip will play, even if outside control Properties try to turn it off.
// NOTE: This is a hardcoded time within the `in-proportion_mp3.js` sound, do not change the sound without changing this.
const MANDATORY_PLAY_TIME = 0.4;
class InProportionSoundGenerator extends SoundClip {
  // keep track of if the success sound has already played. This will be set back to false when the fitness
  // goes back out of range for the success sound.
  // keep track of how long the sound has already played for. This is used to make sure that the beginning
  // of this sound is always played, even when the outside enabledControlProperty is set to false.
  // True when, in the previous step, the current ratio (calculated from currentRatio) is larger than the target ratio.
  // true when, in the previous step, either term of the ratio was too small to indicate success.
  // in certain cases ratio hand positions can move so quickly "through" the in-proportion range that an
  // actual "in proportion" value is never set. When this boolean is true, then this SoundGenerator will note when
  // this "jump over in proportion" occurs, and still play the sound. This is useful for mouse interaction, but not
  // so much for keyboard interaction. See https://github.com/phetsims/ratio-and-proportion/issues/162
  /**
   * @param model
   * @param enabledControlProperty - not supposed to be settable, just listened to. NOTE: this is not simply
   *                                            an on/off Property for the SoundGenerator, see below.
   * @param providedOptions
   */
  constructor(model, enabledControlProperty, providedOptions) {
    const options = optionize()({
      initialOutputLevel: 0.5
    }, providedOptions);
    assert && assert(!options.enableControlProperties, 'use the parameter instead, and note doc for difference in implementation');
    super(inProportion_mp3, options);
    this.model = model;
    this.targetRatioProperty = model.targetRatioProperty;
    this.fitnessProperty = model.ratioFitnessProperty;
    this.playedSuccessYetProperty = new BooleanProperty(model.inProportionProperty.value);
    this.timePlayedSoFarProperty = new NumberProperty(MANDATORY_PLAY_TIME);
    const playedMandatoryPortionYetProperty = new DerivedProperty([this.timePlayedSoFarProperty, this.playedSuccessYetProperty], (timePlayed, playedSuccessYet) => playedSuccessYet && timePlayed <= MANDATORY_PLAY_TIME);

    // In addition to any supplemental enabledControlProperty that the client wants to pass in, make sure to set up
    // an override to ensure that there is always a minimum, "mandatory" time that this sound occurs, even if it doesn't
    // stay in proportion for as long as that ding sound occurs.
    this.addEnableControlProperty(DerivedProperty.or([playedMandatoryPortionYetProperty, enabledControlProperty]));

    // Whenever the inProportionProperty changes, we want to run step eagerly. This is in-part hacky, as perhaps this
    // whole sound generator should run on inProportionProperty, but there are enough time-based parts of this sound
    // generator that it makes sense to just call the step function here instead.
    model.inProportionProperty.lazyLink(inProportion => {
      inProportion && this.step(0);
    });
    this.previousRatioWasLargerThanTarget = this.calculateCurrentRatioLargerThanTarget();
    this.previousRatioWasTooSmallForSuccess = this.model.valuesTooSmallForInProportion();
    this.jumpingOverShouldSound = false;
  }
  calculateCurrentRatioLargerThanTarget() {
    return this.model.ratio.currentRatio > this.model.targetRatioProperty.value;
  }

  /**
   * When true, the InProportionSoundGenerator will play when the ratio "jumps" over in proportion in two consecutive
   * values of the current ratio.
   */
  setJumpingOverProportionShouldTriggerSound(jumpingOverShouldSound) {
    this.jumpingOverShouldSound = jumpingOverShouldSound;
  }

  /**
   * True when the ratio jumped over being in proportion, but it should still sound that it was in proportion. This can
   * only occur when current and previous ratio terms were not in the "too small for success" region.
   */
  jumpedOverInProportionAndShouldSound() {
    return this.jumpingOverShouldSound && !this.model.valuesTooSmallForInProportion() && !this.previousRatioWasTooSmallForSuccess && this.calculateCurrentRatioLargerThanTarget() !== this.previousRatioWasLargerThanTarget;
  }

  /**
   * Step this sound generator, used for fading out the sound in the absence change.
   */
  step(dt) {
    const newFitness = this.fitnessProperty.value;
    const isInRatio = this.model.inProportion();

    // Only use hysteresis when both hands are moving.
    const hysteresisThreshold = this.model.ratio.movingInDirectionProperty.value ? HYSTERESIS_THRESHOLD : 0;

    // Increment only when Playing, since fullEnabledProperty sets things to stop() playing.
    if (this.isPlaying) {
      this.timePlayedSoFarProperty.value += dt;
    }
    if (!this.playedSuccessYetProperty.value && (isInRatio || this.jumpedOverInProportionAndShouldSound()) && !this.model.ratioEvenButNotAtTarget() // don't allow this sound if target isn't 1 but both values are 1
    ) {
      this.setOutputLevel(SUCCESS_OUTPUT_LEVEL, 0);
      this.play();
      this.playedSuccessYetProperty.value = true;
      this.timePlayedSoFarProperty.value = 0;
    } else if (this.playedSuccessYetProperty.value && newFitness < 1 - this.model.getInProportionThreshold() - hysteresisThreshold) {
      // The fitness has gone away from being in proportion enough that you can now get the sound again
      this.playedSuccessYetProperty.value = false;
    }

    // if we were in ratio, but now we are not, then fade out the clip, but only fade out if the full mandatory portion
    // of the clip has played.
    if (this.timePlayedSoFarProperty.value > MANDATORY_PLAY_TIME && !isInRatio && this.outputLevel !== SILENT_LEVEL) {
      this.setOutputLevel(SILENT_LEVEL, 0.1);
    }

    // for testing during next step()
    this.previousRatioWasLargerThanTarget = this.calculateCurrentRatioLargerThanTarget();
    this.previousRatioWasTooSmallForSuccess = this.model.valuesTooSmallForInProportion();
  }

  /**
   * stop any in-progress sound generation
   */
  reset() {
    this.stop(0);
    this.playedSuccessYetProperty.reset();
    this.timePlayedSoFarProperty.reset();
    this.previousRatioWasLargerThanTarget = this.calculateCurrentRatioLargerThanTarget();
    this.previousRatioWasTooSmallForSuccess = this.model.valuesTooSmallForInProportion();
    this.jumpingOverShouldSound = false;
  }
}
ratioAndProportion.register('InProportionSoundGenerator', InProportionSoundGenerator);
export default InProportionSoundGenerator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIlNvdW5kQ2xpcCIsImluUHJvcG9ydGlvbl9tcDMiLCJyYXRpb0FuZFByb3BvcnRpb24iLCJvcHRpb25pemUiLCJTVUNDRVNTX09VVFBVVF9MRVZFTCIsIlNJTEVOVF9MRVZFTCIsIkhZU1RFUkVTSVNfVEhSRVNIT0xEIiwiTUFOREFUT1JZX1BMQVlfVElNRSIsIkluUHJvcG9ydGlvblNvdW5kR2VuZXJhdG9yIiwiY29uc3RydWN0b3IiLCJtb2RlbCIsImVuYWJsZWRDb250cm9sUHJvcGVydHkiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiaW5pdGlhbE91dHB1dExldmVsIiwiYXNzZXJ0IiwiZW5hYmxlQ29udHJvbFByb3BlcnRpZXMiLCJ0YXJnZXRSYXRpb1Byb3BlcnR5IiwiZml0bmVzc1Byb3BlcnR5IiwicmF0aW9GaXRuZXNzUHJvcGVydHkiLCJwbGF5ZWRTdWNjZXNzWWV0UHJvcGVydHkiLCJpblByb3BvcnRpb25Qcm9wZXJ0eSIsInZhbHVlIiwidGltZVBsYXllZFNvRmFyUHJvcGVydHkiLCJwbGF5ZWRNYW5kYXRvcnlQb3J0aW9uWWV0UHJvcGVydHkiLCJ0aW1lUGxheWVkIiwicGxheWVkU3VjY2Vzc1lldCIsImFkZEVuYWJsZUNvbnRyb2xQcm9wZXJ0eSIsIm9yIiwibGF6eUxpbmsiLCJpblByb3BvcnRpb24iLCJzdGVwIiwicHJldmlvdXNSYXRpb1dhc0xhcmdlclRoYW5UYXJnZXQiLCJjYWxjdWxhdGVDdXJyZW50UmF0aW9MYXJnZXJUaGFuVGFyZ2V0IiwicHJldmlvdXNSYXRpb1dhc1Rvb1NtYWxsRm9yU3VjY2VzcyIsInZhbHVlc1Rvb1NtYWxsRm9ySW5Qcm9wb3J0aW9uIiwianVtcGluZ092ZXJTaG91bGRTb3VuZCIsInJhdGlvIiwiY3VycmVudFJhdGlvIiwic2V0SnVtcGluZ092ZXJQcm9wb3J0aW9uU2hvdWxkVHJpZ2dlclNvdW5kIiwianVtcGVkT3ZlckluUHJvcG9ydGlvbkFuZFNob3VsZFNvdW5kIiwiZHQiLCJuZXdGaXRuZXNzIiwiaXNJblJhdGlvIiwiaHlzdGVyZXNpc1RocmVzaG9sZCIsIm1vdmluZ0luRGlyZWN0aW9uUHJvcGVydHkiLCJpc1BsYXlpbmciLCJyYXRpb0V2ZW5CdXROb3RBdFRhcmdldCIsInNldE91dHB1dExldmVsIiwicGxheSIsImdldEluUHJvcG9ydGlvblRocmVzaG9sZCIsIm91dHB1dExldmVsIiwicmVzZXQiLCJzdG9wIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJJblByb3BvcnRpb25Tb3VuZEdlbmVyYXRvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBIHNob3J0IGJ1dCBzdXN0YWluZWQgbm90ZSB0aGF0IHBsYXlzIHdoZW4gdGhlIHJhdGlvIGJlY29tZXMgXCJpbiBwcm9wb3J0aW9uXCIuIFRoaXMgdHlwZSBoYXMgYnVpbHQtaW4gZnVuY3Rpb25hbGl0eSB0byBhbGxvdyB0aGVcclxuICogbm90ZSB0byBzdXN0YWluIGlmIGluLXByb3BvcnRpb24sIGJ1dCB3aWxsIHF1aWNrbHkgcXVpZXQgd2hlbiBubyBsb25nZXIgXCJpbiBwcm9wb3J0aW9uXCIuXHJcbiAqXHJcbiAqIEBhdXRob3IgTWljaGFlbCBLYXV6bWFubiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IFNvdW5kQ2xpcCwgeyBTb3VuZENsaXBPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vdGFtYm8vanMvc291bmQtZ2VuZXJhdG9ycy9Tb3VuZENsaXAuanMnO1xyXG5pbXBvcnQgaW5Qcm9wb3J0aW9uX21wMyBmcm9tICcuLi8uLi8uLi8uLi9zb3VuZHMvaW4tcHJvcG9ydGlvbi9pblByb3BvcnRpb25fbXAzLmpzJztcclxuaW1wb3J0IHJhdGlvQW5kUHJvcG9ydGlvbiBmcm9tICcuLi8uLi8uLi9yYXRpb0FuZFByb3BvcnRpb24uanMnO1xyXG5pbXBvcnQgUkFQTW9kZWwgZnJvbSAnLi4vLi4vbW9kZWwvUkFQTW9kZWwuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcblxyXG5jb25zdCBTVUNDRVNTX09VVFBVVF9MRVZFTCA9IDAuODtcclxuY29uc3QgU0lMRU5UX0xFVkVMID0gMDtcclxuXHJcbi8vIFRoZSBkaXN0YW5jZSB0aGF0IHlvdSBtdXN0IG1vdmUgYXdheSBmcm9tIGJlaW5nIGluIFByb3BvcnRpb24gdW50aWwgeW91IGNhbiB0aGVuIGNvbWUgYmFjayBpbiBwcm9wb3J0aW9uIGFuZCBnZXQgYVxyXG4vLyBzdWNjZXNzIHNvdW5kIHRvIHBsYXkuIFNlZSBJblByb3BvcnRpb25Tb3VuZEdlbmVyYXRvci4gSW4gXCJmaXRuZXNzXCIgdW5pdHMsIHNvIHRoZSBkZWZhdWx0IHZhbHVlIGlzIGEgc3BhY2Ugb2YgMTAlXHJcbi8vIG9mIHRoZSBmaXRuZXNzIHJhbmdlLlxyXG5jb25zdCBIWVNURVJFU0lTX1RIUkVTSE9MRCA9IDAuMTtcclxuXHJcbi8vIFRoZSBtaW5pbXVtIHRpbWUsIGluIHNlY29uZHMsIHRoYXQgdGhpcyBTb3VuZENsaXAgd2lsbCBwbGF5LCBldmVuIGlmIG91dHNpZGUgY29udHJvbCBQcm9wZXJ0aWVzIHRyeSB0byB0dXJuIGl0IG9mZi5cclxuLy8gTk9URTogVGhpcyBpcyBhIGhhcmRjb2RlZCB0aW1lIHdpdGhpbiB0aGUgYGluLXByb3BvcnRpb25fbXAzLmpzYCBzb3VuZCwgZG8gbm90IGNoYW5nZSB0aGUgc291bmQgd2l0aG91dCBjaGFuZ2luZyB0aGlzLlxyXG5jb25zdCBNQU5EQVRPUllfUExBWV9USU1FID0gMC40O1xyXG5cclxuY2xhc3MgSW5Qcm9wb3J0aW9uU291bmRHZW5lcmF0b3IgZXh0ZW5kcyBTb3VuZENsaXAge1xyXG5cclxuICBwcml2YXRlIG1vZGVsOiBSQVBNb2RlbDtcclxuICBwcml2YXRlIHRhcmdldFJhdGlvUHJvcGVydHk6IFByb3BlcnR5PG51bWJlcj47XHJcbiAgcHJpdmF0ZSBmaXRuZXNzUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PG51bWJlcj47XHJcblxyXG4gIC8vIGtlZXAgdHJhY2sgb2YgaWYgdGhlIHN1Y2Nlc3Mgc291bmQgaGFzIGFscmVhZHkgcGxheWVkLiBUaGlzIHdpbGwgYmUgc2V0IGJhY2sgdG8gZmFsc2Ugd2hlbiB0aGUgZml0bmVzc1xyXG4gIC8vIGdvZXMgYmFjayBvdXQgb2YgcmFuZ2UgZm9yIHRoZSBzdWNjZXNzIHNvdW5kLlxyXG4gIHByaXZhdGUgcGxheWVkU3VjY2Vzc1lldFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8ga2VlcCB0cmFjayBvZiBob3cgbG9uZyB0aGUgc291bmQgaGFzIGFscmVhZHkgcGxheWVkIGZvci4gVGhpcyBpcyB1c2VkIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBiZWdpbm5pbmdcclxuICAvLyBvZiB0aGlzIHNvdW5kIGlzIGFsd2F5cyBwbGF5ZWQsIGV2ZW4gd2hlbiB0aGUgb3V0c2lkZSBlbmFibGVkQ29udHJvbFByb3BlcnR5IGlzIHNldCB0byBmYWxzZS5cclxuICBwcml2YXRlIHRpbWVQbGF5ZWRTb0ZhclByb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+O1xyXG5cclxuICAvLyBUcnVlIHdoZW4sIGluIHRoZSBwcmV2aW91cyBzdGVwLCB0aGUgY3VycmVudCByYXRpbyAoY2FsY3VsYXRlZCBmcm9tIGN1cnJlbnRSYXRpbykgaXMgbGFyZ2VyIHRoYW4gdGhlIHRhcmdldCByYXRpby5cclxuICBwcml2YXRlIHByZXZpb3VzUmF0aW9XYXNMYXJnZXJUaGFuVGFyZ2V0OiBib29sZWFuO1xyXG5cclxuICAvLyB0cnVlIHdoZW4sIGluIHRoZSBwcmV2aW91cyBzdGVwLCBlaXRoZXIgdGVybSBvZiB0aGUgcmF0aW8gd2FzIHRvbyBzbWFsbCB0byBpbmRpY2F0ZSBzdWNjZXNzLlxyXG4gIHByaXZhdGUgcHJldmlvdXNSYXRpb1dhc1Rvb1NtYWxsRm9yU3VjY2VzczogYm9vbGVhbjtcclxuXHJcbiAgLy8gaW4gY2VydGFpbiBjYXNlcyByYXRpbyBoYW5kIHBvc2l0aW9ucyBjYW4gbW92ZSBzbyBxdWlja2x5IFwidGhyb3VnaFwiIHRoZSBpbi1wcm9wb3J0aW9uIHJhbmdlIHRoYXQgYW5cclxuICAvLyBhY3R1YWwgXCJpbiBwcm9wb3J0aW9uXCIgdmFsdWUgaXMgbmV2ZXIgc2V0LiBXaGVuIHRoaXMgYm9vbGVhbiBpcyB0cnVlLCB0aGVuIHRoaXMgU291bmRHZW5lcmF0b3Igd2lsbCBub3RlIHdoZW5cclxuICAvLyB0aGlzIFwianVtcCBvdmVyIGluIHByb3BvcnRpb25cIiBvY2N1cnMsIGFuZCBzdGlsbCBwbGF5IHRoZSBzb3VuZC4gVGhpcyBpcyB1c2VmdWwgZm9yIG1vdXNlIGludGVyYWN0aW9uLCBidXQgbm90XHJcbiAgLy8gc28gbXVjaCBmb3Iga2V5Ym9hcmQgaW50ZXJhY3Rpb24uIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcmF0aW8tYW5kLXByb3BvcnRpb24vaXNzdWVzLzE2MlxyXG4gIHByaXZhdGUganVtcGluZ092ZXJTaG91bGRTb3VuZDogYm9vbGVhbjtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIG1vZGVsXHJcbiAgICogQHBhcmFtIGVuYWJsZWRDb250cm9sUHJvcGVydHkgLSBub3Qgc3VwcG9zZWQgdG8gYmUgc2V0dGFibGUsIGp1c3QgbGlzdGVuZWQgdG8uIE5PVEU6IHRoaXMgaXMgbm90IHNpbXBseVxyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbiBvbi9vZmYgUHJvcGVydHkgZm9yIHRoZSBTb3VuZEdlbmVyYXRvciwgc2VlIGJlbG93LlxyXG4gICAqIEBwYXJhbSBwcm92aWRlZE9wdGlvbnNcclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG1vZGVsOiBSQVBNb2RlbCwgZW5hYmxlZENvbnRyb2xQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4sIHByb3ZpZGVkT3B0aW9ucz86IFNvdW5kQ2xpcE9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxTb3VuZENsaXBPcHRpb25zLCBFbXB0eVNlbGZPcHRpb25zPigpKCB7XHJcbiAgICAgIGluaXRpYWxPdXRwdXRMZXZlbDogMC41XHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhb3B0aW9ucy5lbmFibGVDb250cm9sUHJvcGVydGllcywgJ3VzZSB0aGUgcGFyYW1ldGVyIGluc3RlYWQsIGFuZCBub3RlIGRvYyBmb3IgZGlmZmVyZW5jZSBpbiBpbXBsZW1lbnRhdGlvbicgKTtcclxuXHJcbiAgICBzdXBlciggaW5Qcm9wb3J0aW9uX21wMywgb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcclxuICAgIHRoaXMudGFyZ2V0UmF0aW9Qcm9wZXJ0eSA9IG1vZGVsLnRhcmdldFJhdGlvUHJvcGVydHk7XHJcbiAgICB0aGlzLmZpdG5lc3NQcm9wZXJ0eSA9IG1vZGVsLnJhdGlvRml0bmVzc1Byb3BlcnR5O1xyXG5cclxuICAgIHRoaXMucGxheWVkU3VjY2Vzc1lldFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggbW9kZWwuaW5Qcm9wb3J0aW9uUHJvcGVydHkudmFsdWUgKTtcclxuICAgIHRoaXMudGltZVBsYXllZFNvRmFyUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIE1BTkRBVE9SWV9QTEFZX1RJTUUgKTtcclxuXHJcbiAgICBjb25zdCBwbGF5ZWRNYW5kYXRvcnlQb3J0aW9uWWV0UHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyB0aGlzLnRpbWVQbGF5ZWRTb0ZhclByb3BlcnR5LCB0aGlzLnBsYXllZFN1Y2Nlc3NZZXRQcm9wZXJ0eSBdLFxyXG4gICAgICAoIHRpbWVQbGF5ZWQsIHBsYXllZFN1Y2Nlc3NZZXQgKSA9PiBwbGF5ZWRTdWNjZXNzWWV0ICYmIHRpbWVQbGF5ZWQgPD0gTUFOREFUT1JZX1BMQVlfVElNRSApO1xyXG5cclxuICAgIC8vIEluIGFkZGl0aW9uIHRvIGFueSBzdXBwbGVtZW50YWwgZW5hYmxlZENvbnRyb2xQcm9wZXJ0eSB0aGF0IHRoZSBjbGllbnQgd2FudHMgdG8gcGFzcyBpbiwgbWFrZSBzdXJlIHRvIHNldCB1cFxyXG4gICAgLy8gYW4gb3ZlcnJpZGUgdG8gZW5zdXJlIHRoYXQgdGhlcmUgaXMgYWx3YXlzIGEgbWluaW11bSwgXCJtYW5kYXRvcnlcIiB0aW1lIHRoYXQgdGhpcyBzb3VuZCBvY2N1cnMsIGV2ZW4gaWYgaXQgZG9lc24ndFxyXG4gICAgLy8gc3RheSBpbiBwcm9wb3J0aW9uIGZvciBhcyBsb25nIGFzIHRoYXQgZGluZyBzb3VuZCBvY2N1cnMuXHJcbiAgICB0aGlzLmFkZEVuYWJsZUNvbnRyb2xQcm9wZXJ0eSggRGVyaXZlZFByb3BlcnR5Lm9yKCBbIHBsYXllZE1hbmRhdG9yeVBvcnRpb25ZZXRQcm9wZXJ0eSwgZW5hYmxlZENvbnRyb2xQcm9wZXJ0eSBdICkgKTtcclxuXHJcbiAgICAvLyBXaGVuZXZlciB0aGUgaW5Qcm9wb3J0aW9uUHJvcGVydHkgY2hhbmdlcywgd2Ugd2FudCB0byBydW4gc3RlcCBlYWdlcmx5LiBUaGlzIGlzIGluLXBhcnQgaGFja3ksIGFzIHBlcmhhcHMgdGhpc1xyXG4gICAgLy8gd2hvbGUgc291bmQgZ2VuZXJhdG9yIHNob3VsZCBydW4gb24gaW5Qcm9wb3J0aW9uUHJvcGVydHksIGJ1dCB0aGVyZSBhcmUgZW5vdWdoIHRpbWUtYmFzZWQgcGFydHMgb2YgdGhpcyBzb3VuZFxyXG4gICAgLy8gZ2VuZXJhdG9yIHRoYXQgaXQgbWFrZXMgc2Vuc2UgdG8ganVzdCBjYWxsIHRoZSBzdGVwIGZ1bmN0aW9uIGhlcmUgaW5zdGVhZC5cclxuICAgIG1vZGVsLmluUHJvcG9ydGlvblByb3BlcnR5LmxhenlMaW5rKCAoIGluUHJvcG9ydGlvbjogYm9vbGVhbiApID0+IHtcclxuICAgICAgaW5Qcm9wb3J0aW9uICYmIHRoaXMuc3RlcCggMCApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMucHJldmlvdXNSYXRpb1dhc0xhcmdlclRoYW5UYXJnZXQgPSB0aGlzLmNhbGN1bGF0ZUN1cnJlbnRSYXRpb0xhcmdlclRoYW5UYXJnZXQoKTtcclxuICAgIHRoaXMucHJldmlvdXNSYXRpb1dhc1Rvb1NtYWxsRm9yU3VjY2VzcyA9IHRoaXMubW9kZWwudmFsdWVzVG9vU21hbGxGb3JJblByb3BvcnRpb24oKTtcclxuICAgIHRoaXMuanVtcGluZ092ZXJTaG91bGRTb3VuZCA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVDdXJyZW50UmF0aW9MYXJnZXJUaGFuVGFyZ2V0KCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMubW9kZWwucmF0aW8uY3VycmVudFJhdGlvID4gdGhpcy5tb2RlbC50YXJnZXRSYXRpb1Byb3BlcnR5LnZhbHVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogV2hlbiB0cnVlLCB0aGUgSW5Qcm9wb3J0aW9uU291bmRHZW5lcmF0b3Igd2lsbCBwbGF5IHdoZW4gdGhlIHJhdGlvIFwianVtcHNcIiBvdmVyIGluIHByb3BvcnRpb24gaW4gdHdvIGNvbnNlY3V0aXZlXHJcbiAgICogdmFsdWVzIG9mIHRoZSBjdXJyZW50IHJhdGlvLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRKdW1waW5nT3ZlclByb3BvcnRpb25TaG91bGRUcmlnZ2VyU291bmQoIGp1bXBpbmdPdmVyU2hvdWxkU291bmQ6IGJvb2xlYW4gKTogdm9pZCB7XHJcbiAgICB0aGlzLmp1bXBpbmdPdmVyU2hvdWxkU291bmQgPSBqdW1waW5nT3ZlclNob3VsZFNvdW5kO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVHJ1ZSB3aGVuIHRoZSByYXRpbyBqdW1wZWQgb3ZlciBiZWluZyBpbiBwcm9wb3J0aW9uLCBidXQgaXQgc2hvdWxkIHN0aWxsIHNvdW5kIHRoYXQgaXQgd2FzIGluIHByb3BvcnRpb24uIFRoaXMgY2FuXHJcbiAgICogb25seSBvY2N1ciB3aGVuIGN1cnJlbnQgYW5kIHByZXZpb3VzIHJhdGlvIHRlcm1zIHdlcmUgbm90IGluIHRoZSBcInRvbyBzbWFsbCBmb3Igc3VjY2Vzc1wiIHJlZ2lvbi5cclxuICAgKi9cclxuICBwcml2YXRlIGp1bXBlZE92ZXJJblByb3BvcnRpb25BbmRTaG91bGRTb3VuZCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmp1bXBpbmdPdmVyU2hvdWxkU291bmQgJiZcclxuICAgICAgICAgICAhdGhpcy5tb2RlbC52YWx1ZXNUb29TbWFsbEZvckluUHJvcG9ydGlvbigpICYmICF0aGlzLnByZXZpb3VzUmF0aW9XYXNUb29TbWFsbEZvclN1Y2Nlc3MgJiZcclxuICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZUN1cnJlbnRSYXRpb0xhcmdlclRoYW5UYXJnZXQoKSAhPT0gdGhpcy5wcmV2aW91c1JhdGlvV2FzTGFyZ2VyVGhhblRhcmdldDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0ZXAgdGhpcyBzb3VuZCBnZW5lcmF0b3IsIHVzZWQgZm9yIGZhZGluZyBvdXQgdGhlIHNvdW5kIGluIHRoZSBhYnNlbmNlIGNoYW5nZS5cclxuICAgKi9cclxuICBwdWJsaWMgc3RlcCggZHQ6IG51bWJlciApOiB2b2lkIHtcclxuICAgIGNvbnN0IG5ld0ZpdG5lc3MgPSB0aGlzLmZpdG5lc3NQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICBjb25zdCBpc0luUmF0aW8gPSB0aGlzLm1vZGVsLmluUHJvcG9ydGlvbigpO1xyXG5cclxuICAgIC8vIE9ubHkgdXNlIGh5c3RlcmVzaXMgd2hlbiBib3RoIGhhbmRzIGFyZSBtb3ZpbmcuXHJcbiAgICBjb25zdCBoeXN0ZXJlc2lzVGhyZXNob2xkID0gdGhpcy5tb2RlbC5yYXRpby5tb3ZpbmdJbkRpcmVjdGlvblByb3BlcnR5LnZhbHVlID8gSFlTVEVSRVNJU19USFJFU0hPTEQgOiAwO1xyXG5cclxuICAgIC8vIEluY3JlbWVudCBvbmx5IHdoZW4gUGxheWluZywgc2luY2UgZnVsbEVuYWJsZWRQcm9wZXJ0eSBzZXRzIHRoaW5ncyB0byBzdG9wKCkgcGxheWluZy5cclxuICAgIGlmICggdGhpcy5pc1BsYXlpbmcgKSB7XHJcbiAgICAgIHRoaXMudGltZVBsYXllZFNvRmFyUHJvcGVydHkudmFsdWUgKz0gZHQ7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCAhdGhpcy5wbGF5ZWRTdWNjZXNzWWV0UHJvcGVydHkudmFsdWUgJiZcclxuICAgICAgICAgKCBpc0luUmF0aW8gfHwgdGhpcy5qdW1wZWRPdmVySW5Qcm9wb3J0aW9uQW5kU2hvdWxkU291bmQoKSApICYmXHJcbiAgICAgICAgICF0aGlzLm1vZGVsLnJhdGlvRXZlbkJ1dE5vdEF0VGFyZ2V0KCkgIC8vIGRvbid0IGFsbG93IHRoaXMgc291bmQgaWYgdGFyZ2V0IGlzbid0IDEgYnV0IGJvdGggdmFsdWVzIGFyZSAxXHJcbiAgICApIHtcclxuICAgICAgdGhpcy5zZXRPdXRwdXRMZXZlbCggU1VDQ0VTU19PVVRQVVRfTEVWRUwsIDAgKTtcclxuICAgICAgdGhpcy5wbGF5KCk7XHJcbiAgICAgIHRoaXMucGxheWVkU3VjY2Vzc1lldFByb3BlcnR5LnZhbHVlID0gdHJ1ZTtcclxuICAgICAgdGhpcy50aW1lUGxheWVkU29GYXJQcm9wZXJ0eS52YWx1ZSA9IDA7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggdGhpcy5wbGF5ZWRTdWNjZXNzWWV0UHJvcGVydHkudmFsdWUgJiYgbmV3Rml0bmVzcyA8IDEgLSB0aGlzLm1vZGVsLmdldEluUHJvcG9ydGlvblRocmVzaG9sZCgpIC0gaHlzdGVyZXNpc1RocmVzaG9sZCApIHtcclxuXHJcbiAgICAgIC8vIFRoZSBmaXRuZXNzIGhhcyBnb25lIGF3YXkgZnJvbSBiZWluZyBpbiBwcm9wb3J0aW9uIGVub3VnaCB0aGF0IHlvdSBjYW4gbm93IGdldCB0aGUgc291bmQgYWdhaW5cclxuICAgICAgdGhpcy5wbGF5ZWRTdWNjZXNzWWV0UHJvcGVydHkudmFsdWUgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBpZiB3ZSB3ZXJlIGluIHJhdGlvLCBidXQgbm93IHdlIGFyZSBub3QsIHRoZW4gZmFkZSBvdXQgdGhlIGNsaXAsIGJ1dCBvbmx5IGZhZGUgb3V0IGlmIHRoZSBmdWxsIG1hbmRhdG9yeSBwb3J0aW9uXHJcbiAgICAvLyBvZiB0aGUgY2xpcCBoYXMgcGxheWVkLlxyXG4gICAgaWYgKCB0aGlzLnRpbWVQbGF5ZWRTb0ZhclByb3BlcnR5LnZhbHVlID4gTUFOREFUT1JZX1BMQVlfVElNRSAmJlxyXG4gICAgICAgICAhaXNJblJhdGlvICYmIHRoaXMub3V0cHV0TGV2ZWwgIT09IFNJTEVOVF9MRVZFTCApIHtcclxuICAgICAgdGhpcy5zZXRPdXRwdXRMZXZlbCggU0lMRU5UX0xFVkVMLCAwLjEgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBmb3IgdGVzdGluZyBkdXJpbmcgbmV4dCBzdGVwKClcclxuICAgIHRoaXMucHJldmlvdXNSYXRpb1dhc0xhcmdlclRoYW5UYXJnZXQgPSB0aGlzLmNhbGN1bGF0ZUN1cnJlbnRSYXRpb0xhcmdlclRoYW5UYXJnZXQoKTtcclxuICAgIHRoaXMucHJldmlvdXNSYXRpb1dhc1Rvb1NtYWxsRm9yU3VjY2VzcyA9IHRoaXMubW9kZWwudmFsdWVzVG9vU21hbGxGb3JJblByb3BvcnRpb24oKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHN0b3AgYW55IGluLXByb2dyZXNzIHNvdW5kIGdlbmVyYXRpb25cclxuICAgKi9cclxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLnN0b3AoIDAgKTtcclxuICAgIHRoaXMucGxheWVkU3VjY2Vzc1lldFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnRpbWVQbGF5ZWRTb0ZhclByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnByZXZpb3VzUmF0aW9XYXNMYXJnZXJUaGFuVGFyZ2V0ID0gdGhpcy5jYWxjdWxhdGVDdXJyZW50UmF0aW9MYXJnZXJUaGFuVGFyZ2V0KCk7XHJcbiAgICB0aGlzLnByZXZpb3VzUmF0aW9XYXNUb29TbWFsbEZvclN1Y2Nlc3MgPSB0aGlzLm1vZGVsLnZhbHVlc1Rvb1NtYWxsRm9ySW5Qcm9wb3J0aW9uKCk7XHJcbiAgICB0aGlzLmp1bXBpbmdPdmVyU2hvdWxkU291bmQgPSBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbnJhdGlvQW5kUHJvcG9ydGlvbi5yZWdpc3RlciggJ0luUHJvcG9ydGlvblNvdW5kR2VuZXJhdG9yJywgSW5Qcm9wb3J0aW9uU291bmRHZW5lcmF0b3IgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IEluUHJvcG9ydGlvblNvdW5kR2VuZXJhdG9yOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUs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