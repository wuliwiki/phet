// Copyright 2020-2022, University of Colorado Boulder

/**
 * "Marimba bonk" sounds that change frequency based on the fitness of the Proportion. There are three different types
 * of sounds that randomly cycle through to give variety to sounds played that are the same note.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import dotRandom from '../../../../../dot/js/dotRandom.js';
import LinearFunction from '../../../../../dot/js/LinearFunction.js';
import SoundClip from '../../../../../tambo/js/sound-generators/SoundClip.js';
import SoundGenerator from '../../../../../tambo/js/sound-generators/SoundGenerator.js';
import staccatoC_mp3 from '../../../../sounds/staccato/staccatoC_mp3.js';
import staccatoC001_mp3 from '../../../../sounds/staccato/staccatoC001_mp3.js';
import staccatoC002_mp3 from '../../../../sounds/staccato/staccatoC002_mp3.js';
import staccatoCSharp001_mp3 from '../../../../sounds/staccato/staccatoCSharp001_mp3.js';
import staccatoCSharp002_mp3 from '../../../../sounds/staccato/staccatoCSharp002_mp3.js';
import staccatoCSharp_mp3 from '../../../../sounds/staccato/staccatoCSharp_mp3.js';
import staccatoD_mp3 from '../../../../sounds/staccato/staccatoD_mp3.js';
import staccatoD001_mp3 from '../../../../sounds/staccato/staccatoD001_mp3.js';
import staccatoD002_mp3 from '../../../../sounds/staccato/staccatoD002_mp3.js';
import staccatoDSharp001_mp3 from '../../../../sounds/staccato/staccatoDSharp001_mp3.js';
import staccatoDSharp002_mp3 from '../../../../sounds/staccato/staccatoDSharp002_mp3.js';
import staccatoDSharp_mp3 from '../../../../sounds/staccato/staccatoDSharp_mp3.js';
import staccatoE_mp3 from '../../../../sounds/staccato/staccatoE_mp3.js';
import staccatoE001_mp3 from '../../../../sounds/staccato/staccatoE001_mp3.js';
import staccatoE002_mp3 from '../../../../sounds/staccato/staccatoE002_mp3.js';
import staccatoF_mp3 from '../../../../sounds/staccato/staccatoF_mp3.js';
import staccatoF001_mp3 from '../../../../sounds/staccato/staccatoF001_mp3.js';
import staccatoF002_mp3 from '../../../../sounds/staccato/staccatoF002_mp3.js';
import staccatoFSharp001_mp3 from '../../../../sounds/staccato/staccatoFSharp001_mp3.js';
import staccatoFSharp002_mp3 from '../../../../sounds/staccato/staccatoFSharp002_mp3.js';
import staccatoFSharp_mp3 from '../../../../sounds/staccato/staccatoFSharp_mp3.js';
import staccatoG_mp3 from '../../../../sounds/staccato/staccatoG_mp3.js';
import staccatoG001_mp3 from '../../../../sounds/staccato/staccatoG001_mp3.js';
import staccatoG002_mp3 from '../../../../sounds/staccato/staccatoG002_mp3.js';
import ratioAndProportion from '../../../ratioAndProportion.js';
import optionize from '../../../../../phet-core/js/optionize.js';

// organize the sounds by variation and note
const staccatoSounds = [[staccatoC_mp3, staccatoC001_mp3, staccatoC002_mp3], [staccatoCSharp001_mp3, staccatoCSharp002_mp3, staccatoCSharp_mp3], [staccatoD_mp3, staccatoD001_mp3, staccatoD002_mp3], [staccatoDSharp001_mp3, staccatoDSharp002_mp3, staccatoDSharp_mp3], [staccatoE_mp3, staccatoE001_mp3, staccatoE002_mp3], [staccatoF_mp3, staccatoF001_mp3, staccatoF002_mp3], [staccatoFSharp001_mp3, staccatoFSharp002_mp3, staccatoFSharp_mp3], [staccatoG_mp3, staccatoG001_mp3, staccatoG002_mp3]];
class StaccatoFrequencySoundGenerator extends SoundGenerator {
  // the minimum amount of gap between two sounds, which increases based on the fitness

  // in ms, keep track of the amount of time that has passed since the last staccato sound played

  constructor(fitnessProperty, fitnessRange, inProportionProperty, providedOptions) {
    const options = optionize()({
      initialOutputLevel: 0.25
    }, providedOptions);
    super(options);
    this.inProportionProperty = inProportionProperty;
    this.fitnessProperty = fitnessProperty;
    this.staccatoSoundClips = [];

    // create a SoundClip for each sound
    for (let i = 0; i < staccatoSounds.length; i++) {
      const variationSounds = staccatoSounds[i];
      const soundClipsForVariation = [];
      for (let j = 0; j < variationSounds.length; j++) {
        const variationSound = variationSounds[j];
        const soundClip = new SoundClip(variationSound);
        soundClip.connect(this.soundSourceDestination);
        soundClipsForVariation.push(soundClip);
      }
      this.staccatoSoundClips.push(soundClipsForVariation);
    }
    this.timeLinearFunction = new LinearFunction(fitnessRange.min, fitnessRange.max, 500, 120, true);
    this.timeSinceLastPlay = 0;
  }

  /**
   * Step this sound generator, used for fading out the sound in the absence change.
   */
  step(dt) {
    const newFitness = this.fitnessProperty.value;

    // If fitness is less than zero, make sure enough time has past that it will play a sound immediately.
    this.timeSinceLastPlay = newFitness > 0 ? this.timeSinceLastPlay + dt * 1000 : 1000000;
    const isInRatio = this.inProportionProperty.value;
    if (this.timeSinceLastPlay > this.timeLinearFunction.evaluate(newFitness) && !isInRatio && newFitness > 0) {
      const sounds = this.staccatoSoundClips[Math.floor(newFitness * this.staccatoSoundClips.length)];
      sounds[Math.floor(dotRandom.nextDouble() * sounds.length)].play();
      this.timeSinceLastPlay = 0;
    }
  }

  /**
   * stop any in-progress sound generation
   */
  reset() {
    this.timeSinceLastPlay = 0;
  }
}
ratioAndProportion.register('StaccatoFrequencySoundGenerator', StaccatoFrequencySoundGenerator);
export default StaccatoFrequencySoundGenerator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJMaW5lYXJGdW5jdGlvbiIsIlNvdW5kQ2xpcCIsIlNvdW5kR2VuZXJhdG9yIiwic3RhY2NhdG9DX21wMyIsInN0YWNjYXRvQzAwMV9tcDMiLCJzdGFjY2F0b0MwMDJfbXAzIiwic3RhY2NhdG9DU2hhcnAwMDFfbXAzIiwic3RhY2NhdG9DU2hhcnAwMDJfbXAzIiwic3RhY2NhdG9DU2hhcnBfbXAzIiwic3RhY2NhdG9EX21wMyIsInN0YWNjYXRvRDAwMV9tcDMiLCJzdGFjY2F0b0QwMDJfbXAzIiwic3RhY2NhdG9EU2hhcnAwMDFfbXAzIiwic3RhY2NhdG9EU2hhcnAwMDJfbXAzIiwic3RhY2NhdG9EU2hhcnBfbXAzIiwic3RhY2NhdG9FX21wMyIsInN0YWNjYXRvRTAwMV9tcDMiLCJzdGFjY2F0b0UwMDJfbXAzIiwic3RhY2NhdG9GX21wMyIsInN0YWNjYXRvRjAwMV9tcDMiLCJzdGFjY2F0b0YwMDJfbXAzIiwic3RhY2NhdG9GU2hhcnAwMDFfbXAzIiwic3RhY2NhdG9GU2hhcnAwMDJfbXAzIiwic3RhY2NhdG9GU2hhcnBfbXAzIiwic3RhY2NhdG9HX21wMyIsInN0YWNjYXRvRzAwMV9tcDMiLCJzdGFjY2F0b0cwMDJfbXAzIiwicmF0aW9BbmRQcm9wb3J0aW9uIiwib3B0aW9uaXplIiwic3RhY2NhdG9Tb3VuZHMiLCJTdGFjY2F0b0ZyZXF1ZW5jeVNvdW5kR2VuZXJhdG9yIiwiY29uc3RydWN0b3IiLCJmaXRuZXNzUHJvcGVydHkiLCJmaXRuZXNzUmFuZ2UiLCJpblByb3BvcnRpb25Qcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJpbml0aWFsT3V0cHV0TGV2ZWwiLCJzdGFjY2F0b1NvdW5kQ2xpcHMiLCJpIiwibGVuZ3RoIiwidmFyaWF0aW9uU291bmRzIiwic291bmRDbGlwc0ZvclZhcmlhdGlvbiIsImoiLCJ2YXJpYXRpb25Tb3VuZCIsInNvdW5kQ2xpcCIsImNvbm5lY3QiLCJzb3VuZFNvdXJjZURlc3RpbmF0aW9uIiwicHVzaCIsInRpbWVMaW5lYXJGdW5jdGlvbiIsIm1pbiIsIm1heCIsInRpbWVTaW5jZUxhc3RQbGF5Iiwic3RlcCIsImR0IiwibmV3Rml0bmVzcyIsInZhbHVlIiwiaXNJblJhdGlvIiwiZXZhbHVhdGUiLCJzb3VuZHMiLCJNYXRoIiwiZmxvb3IiLCJuZXh0RG91YmxlIiwicGxheSIsInJlc2V0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJTdGFjY2F0b0ZyZXF1ZW5jeVNvdW5kR2VuZXJhdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIwLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFwiTWFyaW1iYSBib25rXCIgc291bmRzIHRoYXQgY2hhbmdlIGZyZXF1ZW5jeSBiYXNlZCBvbiB0aGUgZml0bmVzcyBvZiB0aGUgUHJvcG9ydGlvbi4gVGhlcmUgYXJlIHRocmVlIGRpZmZlcmVudCB0eXBlc1xyXG4gKiBvZiBzb3VuZHMgdGhhdCByYW5kb21seSBjeWNsZSB0aHJvdWdoIHRvIGdpdmUgdmFyaWV0eSB0byBzb3VuZHMgcGxheWVkIHRoYXQgYXJlIHRoZSBzYW1lIG5vdGUuXHJcbiAqXHJcbiAqIEBhdXRob3IgTWljaGFlbCBLYXV6bWFubiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgZG90UmFuZG9tIGZyb20gJy4uLy4uLy4uLy4uLy4uL2RvdC9qcy9kb3RSYW5kb20uanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IExpbmVhckZ1bmN0aW9uIGZyb20gJy4uLy4uLy4uLy4uLy4uL2RvdC9qcy9MaW5lYXJGdW5jdGlvbi5qcyc7XHJcbmltcG9ydCBTb3VuZENsaXAgZnJvbSAnLi4vLi4vLi4vLi4vLi4vdGFtYm8vanMvc291bmQtZ2VuZXJhdG9ycy9Tb3VuZENsaXAuanMnO1xyXG5pbXBvcnQgU291bmRHZW5lcmF0b3IsIHsgU291bmRHZW5lcmF0b3JPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vdGFtYm8vanMvc291bmQtZ2VuZXJhdG9ycy9Tb3VuZEdlbmVyYXRvci5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0NfbXAzIGZyb20gJy4uLy4uLy4uLy4uL3NvdW5kcy9zdGFjY2F0by9zdGFjY2F0b0NfbXAzLmpzJztcclxuaW1wb3J0IHN0YWNjYXRvQzAwMV9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvQzAwMV9tcDMuanMnO1xyXG5pbXBvcnQgc3RhY2NhdG9DMDAyX21wMyBmcm9tICcuLi8uLi8uLi8uLi9zb3VuZHMvc3RhY2NhdG8vc3RhY2NhdG9DMDAyX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0NTaGFycDAwMV9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvQ1NoYXJwMDAxX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0NTaGFycDAwMl9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvQ1NoYXJwMDAyX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0NTaGFycF9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvQ1NoYXJwX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0RfbXAzIGZyb20gJy4uLy4uLy4uLy4uL3NvdW5kcy9zdGFjY2F0by9zdGFjY2F0b0RfbXAzLmpzJztcclxuaW1wb3J0IHN0YWNjYXRvRDAwMV9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvRDAwMV9tcDMuanMnO1xyXG5pbXBvcnQgc3RhY2NhdG9EMDAyX21wMyBmcm9tICcuLi8uLi8uLi8uLi9zb3VuZHMvc3RhY2NhdG8vc3RhY2NhdG9EMDAyX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0RTaGFycDAwMV9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvRFNoYXJwMDAxX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0RTaGFycDAwMl9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvRFNoYXJwMDAyX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0RTaGFycF9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvRFNoYXJwX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0VfbXAzIGZyb20gJy4uLy4uLy4uLy4uL3NvdW5kcy9zdGFjY2F0by9zdGFjY2F0b0VfbXAzLmpzJztcclxuaW1wb3J0IHN0YWNjYXRvRTAwMV9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvRTAwMV9tcDMuanMnO1xyXG5pbXBvcnQgc3RhY2NhdG9FMDAyX21wMyBmcm9tICcuLi8uLi8uLi8uLi9zb3VuZHMvc3RhY2NhdG8vc3RhY2NhdG9FMDAyX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0ZfbXAzIGZyb20gJy4uLy4uLy4uLy4uL3NvdW5kcy9zdGFjY2F0by9zdGFjY2F0b0ZfbXAzLmpzJztcclxuaW1wb3J0IHN0YWNjYXRvRjAwMV9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvRjAwMV9tcDMuanMnO1xyXG5pbXBvcnQgc3RhY2NhdG9GMDAyX21wMyBmcm9tICcuLi8uLi8uLi8uLi9zb3VuZHMvc3RhY2NhdG8vc3RhY2NhdG9GMDAyX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0ZTaGFycDAwMV9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvRlNoYXJwMDAxX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0ZTaGFycDAwMl9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvRlNoYXJwMDAyX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0ZTaGFycF9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvRlNoYXJwX21wMy5qcyc7XHJcbmltcG9ydCBzdGFjY2F0b0dfbXAzIGZyb20gJy4uLy4uLy4uLy4uL3NvdW5kcy9zdGFjY2F0by9zdGFjY2F0b0dfbXAzLmpzJztcclxuaW1wb3J0IHN0YWNjYXRvRzAwMV9tcDMgZnJvbSAnLi4vLi4vLi4vLi4vc291bmRzL3N0YWNjYXRvL3N0YWNjYXRvRzAwMV9tcDMuanMnO1xyXG5pbXBvcnQgc3RhY2NhdG9HMDAyX21wMyBmcm9tICcuLi8uLi8uLi8uLi9zb3VuZHMvc3RhY2NhdG8vc3RhY2NhdG9HMDAyX21wMy5qcyc7XHJcbmltcG9ydCByYXRpb0FuZFByb3BvcnRpb24gZnJvbSAnLi4vLi4vLi4vcmF0aW9BbmRQcm9wb3J0aW9uLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IEVtcHR5U2VsZk9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuXHJcbi8vIG9yZ2FuaXplIHRoZSBzb3VuZHMgYnkgdmFyaWF0aW9uIGFuZCBub3RlXHJcbmNvbnN0IHN0YWNjYXRvU291bmRzID0gW1xyXG4gIFsgc3RhY2NhdG9DX21wMywgc3RhY2NhdG9DMDAxX21wMywgc3RhY2NhdG9DMDAyX21wMyBdLFxyXG4gIFsgc3RhY2NhdG9DU2hhcnAwMDFfbXAzLCBzdGFjY2F0b0NTaGFycDAwMl9tcDMsIHN0YWNjYXRvQ1NoYXJwX21wMyBdLFxyXG4gIFsgc3RhY2NhdG9EX21wMywgc3RhY2NhdG9EMDAxX21wMywgc3RhY2NhdG9EMDAyX21wMyBdLFxyXG4gIFsgc3RhY2NhdG9EU2hhcnAwMDFfbXAzLCBzdGFjY2F0b0RTaGFycDAwMl9tcDMsIHN0YWNjYXRvRFNoYXJwX21wMyBdLFxyXG4gIFsgc3RhY2NhdG9FX21wMywgc3RhY2NhdG9FMDAxX21wMywgc3RhY2NhdG9FMDAyX21wMyBdLFxyXG4gIFsgc3RhY2NhdG9GX21wMywgc3RhY2NhdG9GMDAxX21wMywgc3RhY2NhdG9GMDAyX21wMyBdLFxyXG4gIFsgc3RhY2NhdG9GU2hhcnAwMDFfbXAzLCBzdGFjY2F0b0ZTaGFycDAwMl9tcDMsIHN0YWNjYXRvRlNoYXJwX21wMyBdLFxyXG4gIFsgc3RhY2NhdG9HX21wMywgc3RhY2NhdG9HMDAxX21wMywgc3RhY2NhdG9HMDAyX21wMyBdXHJcbl07XHJcblxyXG5jbGFzcyBTdGFjY2F0b0ZyZXF1ZW5jeVNvdW5kR2VuZXJhdG9yIGV4dGVuZHMgU291bmRHZW5lcmF0b3Ige1xyXG5cclxuXHJcbiAgcHJpdmF0ZSBpblByb3BvcnRpb25Qcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgcHJpdmF0ZSBmaXRuZXNzUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PG51bWJlcj47XHJcbiAgcHJpdmF0ZSBzdGFjY2F0b1NvdW5kQ2xpcHM6IFNvdW5kQ2xpcFtdW107XHJcblxyXG4gIC8vIHRoZSBtaW5pbXVtIGFtb3VudCBvZiBnYXAgYmV0d2VlbiB0d28gc291bmRzLCB3aGljaCBpbmNyZWFzZXMgYmFzZWQgb24gdGhlIGZpdG5lc3NcclxuICBwcml2YXRlIHRpbWVMaW5lYXJGdW5jdGlvbjogTGluZWFyRnVuY3Rpb247XHJcblxyXG4gIC8vIGluIG1zLCBrZWVwIHRyYWNrIG9mIHRoZSBhbW91bnQgb2YgdGltZSB0aGF0IGhhcyBwYXNzZWQgc2luY2UgdGhlIGxhc3Qgc3RhY2NhdG8gc291bmQgcGxheWVkXHJcbiAgcHJpdmF0ZSB0aW1lU2luY2VMYXN0UGxheTogbnVtYmVyO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGZpdG5lc3NQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPiwgZml0bmVzc1JhbmdlOiBSYW5nZSwgaW5Qcm9wb3J0aW9uUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+LCBwcm92aWRlZE9wdGlvbnM6IFNvdW5kR2VuZXJhdG9yT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFNvdW5kR2VuZXJhdG9yT3B0aW9ucywgRW1wdHlTZWxmT3B0aW9ucz4oKSgge1xyXG4gICAgICBpbml0aWFsT3V0cHV0TGV2ZWw6IDAuMjVcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5pblByb3BvcnRpb25Qcm9wZXJ0eSA9IGluUHJvcG9ydGlvblByb3BlcnR5O1xyXG4gICAgdGhpcy5maXRuZXNzUHJvcGVydHkgPSBmaXRuZXNzUHJvcGVydHk7XHJcbiAgICB0aGlzLnN0YWNjYXRvU291bmRDbGlwcyA9IFtdO1xyXG5cclxuICAgIC8vIGNyZWF0ZSBhIFNvdW5kQ2xpcCBmb3IgZWFjaCBzb3VuZFxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgc3RhY2NhdG9Tb3VuZHMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IHZhcmlhdGlvblNvdW5kcyA9IHN0YWNjYXRvU291bmRzWyBpIF07XHJcbiAgICAgIGNvbnN0IHNvdW5kQ2xpcHNGb3JWYXJpYXRpb24gPSBbXTtcclxuICAgICAgZm9yICggbGV0IGogPSAwOyBqIDwgdmFyaWF0aW9uU291bmRzLmxlbmd0aDsgaisrICkge1xyXG4gICAgICAgIGNvbnN0IHZhcmlhdGlvblNvdW5kID0gdmFyaWF0aW9uU291bmRzWyBqIF07XHJcbiAgICAgICAgY29uc3Qgc291bmRDbGlwID0gbmV3IFNvdW5kQ2xpcCggdmFyaWF0aW9uU291bmQgKTtcclxuICAgICAgICBzb3VuZENsaXAuY29ubmVjdCggdGhpcy5zb3VuZFNvdXJjZURlc3RpbmF0aW9uICk7XHJcbiAgICAgICAgc291bmRDbGlwc0ZvclZhcmlhdGlvbi5wdXNoKCBzb3VuZENsaXAgKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnN0YWNjYXRvU291bmRDbGlwcy5wdXNoKCBzb3VuZENsaXBzRm9yVmFyaWF0aW9uICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy50aW1lTGluZWFyRnVuY3Rpb24gPSBuZXcgTGluZWFyRnVuY3Rpb24oXHJcbiAgICAgIGZpdG5lc3NSYW5nZS5taW4sXHJcbiAgICAgIGZpdG5lc3NSYW5nZS5tYXgsXHJcbiAgICAgIDUwMCxcclxuICAgICAgMTIwLFxyXG4gICAgICB0cnVlICk7XHJcblxyXG4gICAgdGhpcy50aW1lU2luY2VMYXN0UGxheSA9IDA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdGVwIHRoaXMgc291bmQgZ2VuZXJhdG9yLCB1c2VkIGZvciBmYWRpbmcgb3V0IHRoZSBzb3VuZCBpbiB0aGUgYWJzZW5jZSBjaGFuZ2UuXHJcbiAgICovXHJcbiAgcHVibGljIHN0ZXAoIGR0OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICBjb25zdCBuZXdGaXRuZXNzID0gdGhpcy5maXRuZXNzUHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgLy8gSWYgZml0bmVzcyBpcyBsZXNzIHRoYW4gemVybywgbWFrZSBzdXJlIGVub3VnaCB0aW1lIGhhcyBwYXN0IHRoYXQgaXQgd2lsbCBwbGF5IGEgc291bmQgaW1tZWRpYXRlbHkuXHJcbiAgICB0aGlzLnRpbWVTaW5jZUxhc3RQbGF5ID0gbmV3Rml0bmVzcyA+IDAgPyB0aGlzLnRpbWVTaW5jZUxhc3RQbGF5ICsgZHQgKiAxMDAwIDogMTAwMDAwMDtcclxuXHJcbiAgICBjb25zdCBpc0luUmF0aW8gPSB0aGlzLmluUHJvcG9ydGlvblByb3BlcnR5LnZhbHVlO1xyXG4gICAgaWYgKCB0aGlzLnRpbWVTaW5jZUxhc3RQbGF5ID4gdGhpcy50aW1lTGluZWFyRnVuY3Rpb24uZXZhbHVhdGUoIG5ld0ZpdG5lc3MgKSAmJiAhaXNJblJhdGlvICYmIG5ld0ZpdG5lc3MgPiAwICkge1xyXG4gICAgICBjb25zdCBzb3VuZHMgPSB0aGlzLnN0YWNjYXRvU291bmRDbGlwc1sgTWF0aC5mbG9vciggbmV3Rml0bmVzcyAqIHRoaXMuc3RhY2NhdG9Tb3VuZENsaXBzLmxlbmd0aCApIF07XHJcbiAgICAgIHNvdW5kc1sgTWF0aC5mbG9vciggZG90UmFuZG9tLm5leHREb3VibGUoKSAqIHNvdW5kcy5sZW5ndGggKSBdLnBsYXkoKTtcclxuICAgICAgdGhpcy50aW1lU2luY2VMYXN0UGxheSA9IDA7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBzdG9wIGFueSBpbi1wcm9ncmVzcyBzb3VuZCBnZW5lcmF0aW9uXHJcbiAgICovXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy50aW1lU2luY2VMYXN0UGxheSA9IDA7XHJcbiAgfVxyXG59XHJcblxyXG5yYXRpb0FuZFByb3BvcnRpb24ucmVnaXN0ZXIoICdTdGFjY2F0b0ZyZXF1ZW5jeVNvdW5kR2VuZXJhdG9yJywgU3RhY2NhdG9GcmVxdWVuY3lTb3VuZEdlbmVyYXRvciApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgU3RhY2NhdG9GcmVxdWVuY3lTb3VuZEdlbmVyYXRvcjsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxTQUFTLE1BQU0sb0NBQW9DO0FBRTFELE9BQU9DLGNBQWMsTUFBTSx5Q0FBeUM7QUFDcEUsT0FBT0MsU0FBUyxNQUFNLHVEQUF1RDtBQUM3RSxPQUFPQyxjQUFjLE1BQWlDLDREQUE0RDtBQUNsSCxPQUFPQyxhQUFhLE1BQU0sOENBQThDO0FBQ3hFLE9BQU9DLGdCQUFnQixNQUFNLGlEQUFpRDtBQUM5RSxPQUFPQyxnQkFBZ0IsTUFBTSxpREFBaUQ7QUFDOUUsT0FBT0MscUJBQXFCLE1BQU0sc0RBQXNEO0FBQ3hGLE9BQU9DLHFCQUFxQixNQUFNLHNEQUFzRDtBQUN4RixPQUFPQyxrQkFBa0IsTUFBTSxtREFBbUQ7QUFDbEYsT0FBT0MsYUFBYSxNQUFNLDhDQUE4QztBQUN4RSxPQUFPQyxnQkFBZ0IsTUFBTSxpREFBaUQ7QUFDOUUsT0FBT0MsZ0JBQWdCLE1BQU0saURBQWlEO0FBQzlFLE9BQU9DLHFCQUFxQixNQUFNLHNEQUFzRDtBQUN4RixPQUFPQyxxQkFBcUIsTUFBTSxzREFBc0Q7QUFDeEYsT0FBT0Msa0JBQWtCLE1BQU0sbURBQW1EO0FBQ2xGLE9BQU9DLGFBQWEsTUFBTSw4Q0FBOEM7QUFDeEUsT0FBT0MsZ0JBQWdCLE1BQU0saURBQWlEO0FBQzlFLE9BQU9DLGdCQUFnQixNQUFNLGlEQUFpRDtBQUM5RSxPQUFPQyxhQUFhLE1BQU0sOENBQThDO0FBQ3hFLE9BQU9DLGdCQUFnQixNQUFNLGlEQUFpRDtBQUM5RSxPQUFPQyxnQkFBZ0IsTUFBTSxpREFBaUQ7QUFDOUUsT0FBT0MscUJBQXFCLE1BQU0sc0RBQXNEO0FBQ3hGLE9BQU9DLHFCQUFxQixNQUFNLHNEQUFzRDtBQUN4RixPQUFPQyxrQkFBa0IsTUFBTSxtREFBbUQ7QUFDbEYsT0FBT0MsYUFBYSxNQUFNLDhDQUE4QztBQUN4RSxPQUFPQyxnQkFBZ0IsTUFBTSxpREFBaUQ7QUFDOUUsT0FBT0MsZ0JBQWdCLE1BQU0saURBQWlEO0FBQzlFLE9BQU9DLGtCQUFrQixNQUFNLGdDQUFnQztBQUUvRCxPQUFPQyxTQUFTLE1BQTRCLDBDQUEwQzs7QUFFdEY7QUFDQSxNQUFNQyxjQUFjLEdBQUcsQ0FDckIsQ0FBRTFCLGFBQWEsRUFBRUMsZ0JBQWdCLEVBQUVDLGdCQUFnQixDQUFFLEVBQ3JELENBQUVDLHFCQUFxQixFQUFFQyxxQkFBcUIsRUFBRUMsa0JBQWtCLENBQUUsRUFDcEUsQ0FBRUMsYUFBYSxFQUFFQyxnQkFBZ0IsRUFBRUMsZ0JBQWdCLENBQUUsRUFDckQsQ0FBRUMscUJBQXFCLEVBQUVDLHFCQUFxQixFQUFFQyxrQkFBa0IsQ0FBRSxFQUNwRSxDQUFFQyxhQUFhLEVBQUVDLGdCQUFnQixFQUFFQyxnQkFBZ0IsQ0FBRSxFQUNyRCxDQUFFQyxhQUFhLEVBQUVDLGdCQUFnQixFQUFFQyxnQkFBZ0IsQ0FBRSxFQUNyRCxDQUFFQyxxQkFBcUIsRUFBRUMscUJBQXFCLEVBQUVDLGtCQUFrQixDQUFFLEVBQ3BFLENBQUVDLGFBQWEsRUFBRUMsZ0JBQWdCLEVBQUVDLGdCQUFnQixDQUFFLENBQ3REO0FBRUQsTUFBTUksK0JBQStCLFNBQVM1QixjQUFjLENBQUM7RUFPM0Q7O0VBR0E7O0VBR082QixXQUFXQSxDQUFFQyxlQUEwQyxFQUFFQyxZQUFtQixFQUFFQyxvQkFBZ0QsRUFBRUMsZUFBc0MsRUFBRztJQUU5SyxNQUFNQyxPQUFPLEdBQUdSLFNBQVMsQ0FBMEMsQ0FBQyxDQUFFO01BQ3BFUyxrQkFBa0IsRUFBRTtJQUN0QixDQUFDLEVBQUVGLGVBQWdCLENBQUM7SUFFcEIsS0FBSyxDQUFFQyxPQUFRLENBQUM7SUFFaEIsSUFBSSxDQUFDRixvQkFBb0IsR0FBR0Esb0JBQW9CO0lBQ2hELElBQUksQ0FBQ0YsZUFBZSxHQUFHQSxlQUFlO0lBQ3RDLElBQUksQ0FBQ00sa0JBQWtCLEdBQUcsRUFBRTs7SUFFNUI7SUFDQSxLQUFNLElBQUlDLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR1YsY0FBYyxDQUFDVyxNQUFNLEVBQUVELENBQUMsRUFBRSxFQUFHO01BQ2hELE1BQU1FLGVBQWUsR0FBR1osY0FBYyxDQUFFVSxDQUFDLENBQUU7TUFDM0MsTUFBTUcsc0JBQXNCLEdBQUcsRUFBRTtNQUNqQyxLQUFNLElBQUlDLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR0YsZUFBZSxDQUFDRCxNQUFNLEVBQUVHLENBQUMsRUFBRSxFQUFHO1FBQ2pELE1BQU1DLGNBQWMsR0FBR0gsZUFBZSxDQUFFRSxDQUFDLENBQUU7UUFDM0MsTUFBTUUsU0FBUyxHQUFHLElBQUk1QyxTQUFTLENBQUUyQyxjQUFlLENBQUM7UUFDakRDLFNBQVMsQ0FBQ0MsT0FBTyxDQUFFLElBQUksQ0FBQ0Msc0JBQXVCLENBQUM7UUFDaERMLHNCQUFzQixDQUFDTSxJQUFJLENBQUVILFNBQVUsQ0FBQztNQUMxQztNQUNBLElBQUksQ0FBQ1Asa0JBQWtCLENBQUNVLElBQUksQ0FBRU4sc0JBQXVCLENBQUM7SUFDeEQ7SUFFQSxJQUFJLENBQUNPLGtCQUFrQixHQUFHLElBQUlqRCxjQUFjLENBQzFDaUMsWUFBWSxDQUFDaUIsR0FBRyxFQUNoQmpCLFlBQVksQ0FBQ2tCLEdBQUcsRUFDaEIsR0FBRyxFQUNILEdBQUcsRUFDSCxJQUFLLENBQUM7SUFFUixJQUFJLENBQUNDLGlCQUFpQixHQUFHLENBQUM7RUFDNUI7O0VBRUE7QUFDRjtBQUNBO0VBQ1NDLElBQUlBLENBQUVDLEVBQVUsRUFBUztJQUM5QixNQUFNQyxVQUFVLEdBQUcsSUFBSSxDQUFDdkIsZUFBZSxDQUFDd0IsS0FBSzs7SUFFN0M7SUFDQSxJQUFJLENBQUNKLGlCQUFpQixHQUFHRyxVQUFVLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQ0gsaUJBQWlCLEdBQUdFLEVBQUUsR0FBRyxJQUFJLEdBQUcsT0FBTztJQUV0RixNQUFNRyxTQUFTLEdBQUcsSUFBSSxDQUFDdkIsb0JBQW9CLENBQUNzQixLQUFLO0lBQ2pELElBQUssSUFBSSxDQUFDSixpQkFBaUIsR0FBRyxJQUFJLENBQUNILGtCQUFrQixDQUFDUyxRQUFRLENBQUVILFVBQVcsQ0FBQyxJQUFJLENBQUNFLFNBQVMsSUFBSUYsVUFBVSxHQUFHLENBQUMsRUFBRztNQUM3RyxNQUFNSSxNQUFNLEdBQUcsSUFBSSxDQUFDckIsa0JBQWtCLENBQUVzQixJQUFJLENBQUNDLEtBQUssQ0FBRU4sVUFBVSxHQUFHLElBQUksQ0FBQ2pCLGtCQUFrQixDQUFDRSxNQUFPLENBQUMsQ0FBRTtNQUNuR21CLE1BQU0sQ0FBRUMsSUFBSSxDQUFDQyxLQUFLLENBQUU5RCxTQUFTLENBQUMrRCxVQUFVLENBQUMsQ0FBQyxHQUFHSCxNQUFNLENBQUNuQixNQUFPLENBQUMsQ0FBRSxDQUFDdUIsSUFBSSxDQUFDLENBQUM7TUFDckUsSUFBSSxDQUFDWCxpQkFBaUIsR0FBRyxDQUFDO0lBQzVCO0VBQ0Y7O0VBRUE7QUFDRjtBQUNBO0VBQ1NZLEtBQUtBLENBQUEsRUFBUztJQUNuQixJQUFJLENBQUNaLGlCQUFpQixHQUFHLENBQUM7RUFDNUI7QUFDRjtBQUVBekIsa0JBQWtCLENBQUNzQyxRQUFRLENBQUUsaUNBQWlDLEVBQUVuQywrQkFBZ0MsQ0FBQztBQUVqRyxlQUFlQSwrQkFBK0IifQ==