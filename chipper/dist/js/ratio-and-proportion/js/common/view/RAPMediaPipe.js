// Copyright 2022, University of Colorado Boulder

/**
 * This file adds media pipe "hands" input to RAP, see MediaPipe
 *
 * In general there are a couple of actions here:
 *
 * Hand Position changes:
 * Each hand position in the sim is controlled by a few marker points from MediaPipe right around the knuckles of the hand.
 * These points are averaged to get the position of that hand. Note that axis can be flipped in options to change which
 * real-world hand corresponds to which hand in the sim.
 *
 * Voicing enabled:
 * A gestured called the "O_HAND_GESTURE", in which thumb and pointer touch in to make a circle, leaving the other fingers
 * straight, is used to turn off voicing. Turning off voicing actually allows a single voicing response to be spoken
 * fully, so in a sense, though the code thinks that the "O_HAND_GESTURE" turns off voicing, it actually allows a single
 * voicing response to be heard.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import MediaPipe from '../../../../tangible/js/mediaPipe/MediaPipe.js';
import ratioAndProportion from '../../ratioAndProportion.js';
import RAPRatioTuple from '../model/RAPRatioTuple.js';
import Vector3 from '../../../../dot/js/Vector3.js';
import rapConstants from '../rapConstants.js';
import optionize from '../../../../phet-core/js/optionize.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import handleSmoothValue from './handleSmoothValue.js';
import StationaryValueTracker from './StationaryValueTracker.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import BooleanIO from '../../../../tandem/js/types/BooleanIO.js';
import MediaPipeQueryParameters from '../../../../tangible/js/mediaPipe/MediaPipeQueryParameters.js';
if (MediaPipeQueryParameters.cameraInput === 'hands') {
  MediaPipe.initialize();
}

// Number of positions to keep to average out to smooth the hand positions
const POSITION_HISTORY_LENGTH = 10;

// Number of previous O_HAND_GESTURE enabled states to keep to average out to determine if voicing is enabled. All must store
// false for the gesture to no longer be enabled.
const O_HAND_GESTURE_DETECTED_HISTORY_LENGTH = 15;

// Number of previous states to keep to average out to determine if two (and only two) hands are detected by mediaPipe.
const TWO_HANDS_DETECTED_HISTORY_LENGTH = 10;

// The max value of each hand position vector component that we get from MediaPipe. (x,y,z)
const HAND_POSITION_MAX_VALUE = 1;

// Hand-tracking points that we use to calculate the position of the ratio in the sim,  See https://google.github.io/mediapipe/solutions/hands.html#hand-landmark-model
const HAND_POINTS = [5, 9, 13];
const THUMB_TIP = 4;
const INDEX_TIP = 8;
const MARKERS_TOUCHING_THRESHOLD = 0.04;

// Scratch vectors to avoid taking too much memory
const firstMarkerTouchingVector = new Vector2(0, 0);
const secondMarkerTouchingVector = new Vector2(0, 0);
class RAPMediaPipe extends MediaPipe {
  twoHandsDetectedHistory = [];
  antecedentHandPositions = [];
  consequentHandPositions = [];
  oHandGestureDetectedHistory = [];
  antecedentStationaryTracker = new StationaryValueTracker();
  consequentStationaryTracker = new StationaryValueTracker();

  // Use a gesture to determine if voicing for the hands should be enabled

  constructor(ratioTupleProperty, ratioLockedProperty, antecedentViewSounds, consequentViewSounds, providedOptions) {
    const options = optionize()({
      isBeingInteractedWithProperty: new BooleanProperty(false),
      onInput: _.noop
    }, providedOptions);
    super();
    this.isBeingInteractedWithProperty = options.isBeingInteractedWithProperty;
    this.ratioTupleProperty = ratioTupleProperty;
    this.ratioLockedProperty = ratioLockedProperty;
    this.onInput = options.onInput;
    this.antecedentViewSounds = antecedentViewSounds;
    this.consequentViewSounds = consequentViewSounds;
    this.oHandGestureProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('oHandGestureProperty'),
      phetioReadOnly: true
    });
    this.handsStationaryProperty = new DerivedProperty([this.antecedentStationaryTracker.isStationaryProperty, this.consequentStationaryTracker.isStationaryProperty, this.oHandGestureProperty], (antecedentStationary, consequentStationary, oHandGesturePresent) => {
      return antecedentStationary && consequentStationary && !oHandGesturePresent;
    }, {
      tandem: options.tandem.createTandem('handsStationaryProperty'),
      phetioValueType: BooleanIO
    });
    this.isBeingInteractedWithProperty.lazyLink(interactedWith => {
      if (interactedWith) {
        this.antecedentViewSounds.boundarySoundClip.onStartInteraction();
        this.consequentViewSounds.boundarySoundClip.onStartInteraction();

        // It is arbitrary here whether to use sounds from antecedent or consequent.
        this.antecedentViewSounds.grabSoundClip.play();
      } else {
        this.antecedentViewSounds.boundarySoundClip.onEndInteraction(this.ratioTupleProperty.value.antecedent);
        this.consequentViewSounds.boundarySoundClip.onEndInteraction(this.ratioTupleProperty.value.consequent);
        this.antecedentViewSounds.releaseSoundClip.play();
      }
    });
  }
  step() {
    const results = MediaPipe.resultsProperty.value;

    // Be more tolerant about if we are interacting with MediaPipe.
    this.isBeingInteractedWithProperty.value = results ? this.getSmoothedTwoHandsDetected(results.multiHandLandmarks) : false;

    // Though isBeingInteractedWithProperty is tolerant, we actually need two hands to calculate sim changes.
    if (results && results.multiHandLandmarks && (results.multiHandLandmarks.length === 2 || results.multiHandLandmarks.length === 1) &&
    // ensure that multiHandLandmarks look as expected, or ignore that frame, see https://github.com/phetsims/ratio-and-proportion/issues/501
    _.every(results.multiHandLandmarks, landmarkList => landmarkList.length === 21)) {
      // Voicing is disabled with the gesture of an "O" hand gesture from both hands. Must be set before this.onInteract() is called
      this.oHandGestureProperty.value = this.oHandGesturePresent(results.multiHandLandmarks);
      const handPositions = this.getPositionsOfHands(results.multiHandLandmarks);
      if (results.multiHandLandmarks.length === 2) {
        this.antecedentStationaryTracker.update(handPositions[0].y);
        this.consequentStationaryTracker.update(handPositions[1].y);
      } else {
        const position = handPositions[0];

        // if just one hand is detected, defer to the absolute position of the hand, arbitrarily splitting half way
        // through the screen.
        const stationaryTracker = position.x >= HAND_POSITION_MAX_VALUE / 2 ? this.consequentStationaryTracker : this.antecedentStationaryTracker;
        stationaryTracker.update(position.y);
      }
      const newTuple = this.tupleFromSmoothing(handPositions);

      // If locked, then only change one of the value, the other will update accordingly.
      if (this.ratioLockedProperty.value) {
        if (MediaPipe.yAxisFlippedProperty.value) {
          newTuple.antecedent = this.ratioTupleProperty.value.antecedent;
        } else {
          newTuple.consequent = this.ratioTupleProperty.value.consequent;
        }
      }
      if (!this.oHandGestureProperty.value) {
        this.ratioTupleProperty.value = newTuple;
      }
      this.onInteract(newTuple);
    }
  }
  tupleFromSmoothing(handPositions) {
    assert && assert(handPositions.length === 2 || handPositions.length === 1, 'must have 1 or 2 hands');
    let leftHandPosition;
    let rightHandPosition;
    if (handPositions.length === 2) {
      leftHandPosition = handPositions[0];
      rightHandPosition = handPositions[1];
    } else {
      // Each half of the screen the hand was detected on will correspond to which side of the ratio the single hand
      // applies to.
      if (handPositions[0].x >= HAND_POSITION_MAX_VALUE / 2) {
        leftHandPosition = this.antecedentHandPositions.length > 0 ? this.antecedentHandPositions[this.antecedentHandPositions.length - 1] : Vector3.pool.create(0, this.ratioTupleProperty.value.antecedent, 0);
        rightHandPosition = handPositions[0];
      } else {
        leftHandPosition = handPositions[0];
        rightHandPosition = this.consequentHandPositions.length > 0 ? this.consequentHandPositions[this.consequentHandPositions.length - 1] : Vector3.pool.create(0, this.ratioTupleProperty.value.consequent, 0);
      }
    }
    return new RAPRatioTuple(this.getSmoothedPosition(leftHandPosition, this.antecedentHandPositions).y, this.getSmoothedPosition(rightHandPosition, this.consequentHandPositions).y).constrainFields(rapConstants.TOTAL_RATIO_TERM_VALUE_RANGE);
  }
  getSmoothedTwoHandsDetected(multiHandLandmarks) {
    const handsDetected = multiHandLandmarks.length === 2 || multiHandLandmarks.length === 1;
    return handleSmoothValue(handsDetected, this.twoHandsDetectedHistory, TWO_HANDS_DETECTED_HISTORY_LENGTH,
    // To reduce false positives and false negatives, 50% of the history must have two hands detected.
    () => this.twoHandsDetectedHistory.filter(_.identity).length > TWO_HANDS_DETECTED_HISTORY_LENGTH / 2);
  }

  /**
   * Average the historical positions together to get the current value
   */
  getSmoothedPosition(position, historicalPositions) {
    return handleSmoothValue(position, historicalPositions, POSITION_HISTORY_LENGTH, Vector3.average);
  }
  getPositionsOfHands(multiHandLandmarks) {
    assert && assert(multiHandLandmarks.length === 2 || multiHandLandmarks.length === 1, 'must have 1 or 2 hands');
    const handPositions = multiHandLandmarks.map(handMarkerPositions => {
      const finalPosition = new Vector3(0, 0, 0);

      // These are along the center of a hand, about where we have calibrated the hand icon in RAP, see https://google.github.io/mediapipe/solutions/hands.html#hand-landmark-model
      HAND_POINTS.forEach(index => {
        const point = handMarkerPositions[index];
        if (!point.x || !point.y || !point.z) {
          console.log('broken hand landmark input: ', multiHandLandmarks);
        }
        assert && assert(typeof point.x === 'number');
        assert && assert(typeof point.y === 'number');
        assert && assert(typeof point.z === 'number');
        const yPosition = MediaPipe.xAxisFlippedProperty.value ? point.y : HAND_POSITION_MAX_VALUE - point.y;
        const xPosition = MediaPipe.yAxisFlippedProperty.value ? point.x : HAND_POSITION_MAX_VALUE - point.x;
        const position = new Vector3(xPosition, yPosition, HAND_POSITION_MAX_VALUE - point.z);
        finalPosition.add(position);
      });
      return finalPosition.divideScalar(HAND_POINTS.length);
    });
    return RAPMediaPipe.sortHandPositions(handPositions);
  }
  static sortHandPositions(handPositions) {
    if (handPositions.length === 2) {
      return handPositions[0].x <= handPositions[1].x ? handPositions : handPositions.reverse();
    }
    return handPositions;
  }
  static positionValid(position) {
    return position && position.hasOwnProperty('x') && position.hasOwnProperty('y') && typeof position.x === 'number' && typeof position.y === 'number';
  }
  static markersTouching(point1, point2, handMarkerPositions) {
    assert && assert(handMarkerPositions.length === 21, '21 hand positions expected', handMarkerPositions);
    const position1 = handMarkerPositions[point1];
    const position2 = handMarkerPositions[point2];
    if (!(RAPMediaPipe.positionValid(position1) && RAPMediaPipe.positionValid(position2))) {
      return false;
    }
    firstMarkerTouchingVector.setXY(position1.x, position1.y);
    secondMarkerTouchingVector.setXY(position2.x, position2.y);
    return firstMarkerTouchingVector.distance(secondMarkerTouchingVector) < MARKERS_TOUCHING_THRESHOLD;
  }
  onInteract(newValue) {
    this.onInput();
    this.antecedentViewSounds.boundarySoundClip.onInteract(newValue.antecedent);
    this.consequentViewSounds.boundarySoundClip.onInteract(newValue.consequent);
    this.antecedentViewSounds.tickMarkBumpSoundClip.onInteract(newValue.antecedent);
    this.consequentViewSounds.tickMarkBumpSoundClip.onInteract(newValue.consequent);
  }
  static hasOHandGesture(multiHandLandmarks) {
    // Cannot have O_HAND_GESTURE without two and only two hands.
    if (multiHandLandmarks.length !== 2) {
      return false;
    }
    return RAPMediaPipe.markersTouching(THUMB_TIP, INDEX_TIP, multiHandLandmarks[0]) && RAPMediaPipe.markersTouching(THUMB_TIP, INDEX_TIP, multiHandLandmarks[1]);
  }

  /**
   * Voicing is eagerly disabled upon first "O-Hand Gesture" detection, but to turn it on, keep track of history to ensure
   * that the user is actually intending to stop the "O-Hand Gesture"
   */
  oHandGesturePresent(multiHandLandmarks) {
    if (multiHandLandmarks.length !== 2) {
      return false;
    }
    const newOHandGestureDetected = RAPMediaPipe.hasOHandGesture(multiHandLandmarks);
    if (!newOHandGestureDetected) {
      this.oHandGestureDetectedHistory.push(newOHandGestureDetected);
      return false;
    }
    return handleSmoothValue(newOHandGestureDetected, this.oHandGestureDetectedHistory, O_HAND_GESTURE_DETECTED_HISTORY_LENGTH,
    // If there is a single O_HAND_GESTURE present, then there is still intent to gesture.
    () => this.oHandGestureDetectedHistory.filter(_.identity).length !== 0);
  }
  reset() {
    this.isBeingInteractedWithProperty.reset();
  }
}
ratioAndProportion.register('RAPMediaPipe', RAPMediaPipe);
export default RAPMediaPipe;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJNZWRpYVBpcGUiLCJyYXRpb0FuZFByb3BvcnRpb24iLCJSQVBSYXRpb1R1cGxlIiwiVmVjdG9yMyIsInJhcENvbnN0YW50cyIsIm9wdGlvbml6ZSIsIlZlY3RvcjIiLCJoYW5kbGVTbW9vdGhWYWx1ZSIsIlN0YXRpb25hcnlWYWx1ZVRyYWNrZXIiLCJEZXJpdmVkUHJvcGVydHkiLCJCb29sZWFuSU8iLCJNZWRpYVBpcGVRdWVyeVBhcmFtZXRlcnMiLCJjYW1lcmFJbnB1dCIsImluaXRpYWxpemUiLCJQT1NJVElPTl9ISVNUT1JZX0xFTkdUSCIsIk9fSEFORF9HRVNUVVJFX0RFVEVDVEVEX0hJU1RPUllfTEVOR1RIIiwiVFdPX0hBTkRTX0RFVEVDVEVEX0hJU1RPUllfTEVOR1RIIiwiSEFORF9QT1NJVElPTl9NQVhfVkFMVUUiLCJIQU5EX1BPSU5UUyIsIlRIVU1CX1RJUCIsIklOREVYX1RJUCIsIk1BUktFUlNfVE9VQ0hJTkdfVEhSRVNIT0xEIiwiZmlyc3RNYXJrZXJUb3VjaGluZ1ZlY3RvciIsInNlY29uZE1hcmtlclRvdWNoaW5nVmVjdG9yIiwiUkFQTWVkaWFQaXBlIiwidHdvSGFuZHNEZXRlY3RlZEhpc3RvcnkiLCJhbnRlY2VkZW50SGFuZFBvc2l0aW9ucyIsImNvbnNlcXVlbnRIYW5kUG9zaXRpb25zIiwib0hhbmRHZXN0dXJlRGV0ZWN0ZWRIaXN0b3J5IiwiYW50ZWNlZGVudFN0YXRpb25hcnlUcmFja2VyIiwiY29uc2VxdWVudFN0YXRpb25hcnlUcmFja2VyIiwiY29uc3RydWN0b3IiLCJyYXRpb1R1cGxlUHJvcGVydHkiLCJyYXRpb0xvY2tlZFByb3BlcnR5IiwiYW50ZWNlZGVudFZpZXdTb3VuZHMiLCJjb25zZXF1ZW50Vmlld1NvdW5kcyIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJpc0JlaW5nSW50ZXJhY3RlZFdpdGhQcm9wZXJ0eSIsIm9uSW5wdXQiLCJfIiwibm9vcCIsIm9IYW5kR2VzdHVyZVByb3BlcnR5IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwicGhldGlvUmVhZE9ubHkiLCJoYW5kc1N0YXRpb25hcnlQcm9wZXJ0eSIsImlzU3RhdGlvbmFyeVByb3BlcnR5IiwiYW50ZWNlZGVudFN0YXRpb25hcnkiLCJjb25zZXF1ZW50U3RhdGlvbmFyeSIsIm9IYW5kR2VzdHVyZVByZXNlbnQiLCJwaGV0aW9WYWx1ZVR5cGUiLCJsYXp5TGluayIsImludGVyYWN0ZWRXaXRoIiwiYm91bmRhcnlTb3VuZENsaXAiLCJvblN0YXJ0SW50ZXJhY3Rpb24iLCJncmFiU291bmRDbGlwIiwicGxheSIsIm9uRW5kSW50ZXJhY3Rpb24iLCJ2YWx1ZSIsImFudGVjZWRlbnQiLCJjb25zZXF1ZW50IiwicmVsZWFzZVNvdW5kQ2xpcCIsInN0ZXAiLCJyZXN1bHRzIiwicmVzdWx0c1Byb3BlcnR5IiwiZ2V0U21vb3RoZWRUd29IYW5kc0RldGVjdGVkIiwibXVsdGlIYW5kTGFuZG1hcmtzIiwibGVuZ3RoIiwiZXZlcnkiLCJsYW5kbWFya0xpc3QiLCJoYW5kUG9zaXRpb25zIiwiZ2V0UG9zaXRpb25zT2ZIYW5kcyIsInVwZGF0ZSIsInkiLCJwb3NpdGlvbiIsInN0YXRpb25hcnlUcmFja2VyIiwieCIsIm5ld1R1cGxlIiwidHVwbGVGcm9tU21vb3RoaW5nIiwieUF4aXNGbGlwcGVkUHJvcGVydHkiLCJvbkludGVyYWN0IiwiYXNzZXJ0IiwibGVmdEhhbmRQb3NpdGlvbiIsInJpZ2h0SGFuZFBvc2l0aW9uIiwicG9vbCIsImNyZWF0ZSIsImdldFNtb290aGVkUG9zaXRpb24iLCJjb25zdHJhaW5GaWVsZHMiLCJUT1RBTF9SQVRJT19URVJNX1ZBTFVFX1JBTkdFIiwiaGFuZHNEZXRlY3RlZCIsImZpbHRlciIsImlkZW50aXR5IiwiaGlzdG9yaWNhbFBvc2l0aW9ucyIsImF2ZXJhZ2UiLCJtYXAiLCJoYW5kTWFya2VyUG9zaXRpb25zIiwiZmluYWxQb3NpdGlvbiIsImZvckVhY2giLCJpbmRleCIsInBvaW50IiwieiIsImNvbnNvbGUiLCJsb2ciLCJ5UG9zaXRpb24iLCJ4QXhpc0ZsaXBwZWRQcm9wZXJ0eSIsInhQb3NpdGlvbiIsImFkZCIsImRpdmlkZVNjYWxhciIsInNvcnRIYW5kUG9zaXRpb25zIiwicmV2ZXJzZSIsInBvc2l0aW9uVmFsaWQiLCJoYXNPd25Qcm9wZXJ0eSIsIm1hcmtlcnNUb3VjaGluZyIsInBvaW50MSIsInBvaW50MiIsInBvc2l0aW9uMSIsInBvc2l0aW9uMiIsInNldFhZIiwiZGlzdGFuY2UiLCJuZXdWYWx1ZSIsInRpY2tNYXJrQnVtcFNvdW5kQ2xpcCIsImhhc09IYW5kR2VzdHVyZSIsIm5ld09IYW5kR2VzdHVyZURldGVjdGVkIiwicHVzaCIsInJlc2V0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJSQVBNZWRpYVBpcGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFRoaXMgZmlsZSBhZGRzIG1lZGlhIHBpcGUgXCJoYW5kc1wiIGlucHV0IHRvIFJBUCwgc2VlIE1lZGlhUGlwZVxyXG4gKlxyXG4gKiBJbiBnZW5lcmFsIHRoZXJlIGFyZSBhIGNvdXBsZSBvZiBhY3Rpb25zIGhlcmU6XHJcbiAqXHJcbiAqIEhhbmQgUG9zaXRpb24gY2hhbmdlczpcclxuICogRWFjaCBoYW5kIHBvc2l0aW9uIGluIHRoZSBzaW0gaXMgY29udHJvbGxlZCBieSBhIGZldyBtYXJrZXIgcG9pbnRzIGZyb20gTWVkaWFQaXBlIHJpZ2h0IGFyb3VuZCB0aGUga251Y2tsZXMgb2YgdGhlIGhhbmQuXHJcbiAqIFRoZXNlIHBvaW50cyBhcmUgYXZlcmFnZWQgdG8gZ2V0IHRoZSBwb3NpdGlvbiBvZiB0aGF0IGhhbmQuIE5vdGUgdGhhdCBheGlzIGNhbiBiZSBmbGlwcGVkIGluIG9wdGlvbnMgdG8gY2hhbmdlIHdoaWNoXHJcbiAqIHJlYWwtd29ybGQgaGFuZCBjb3JyZXNwb25kcyB0byB3aGljaCBoYW5kIGluIHRoZSBzaW0uXHJcbiAqXHJcbiAqIFZvaWNpbmcgZW5hYmxlZDpcclxuICogQSBnZXN0dXJlZCBjYWxsZWQgdGhlIFwiT19IQU5EX0dFU1RVUkVcIiwgaW4gd2hpY2ggdGh1bWIgYW5kIHBvaW50ZXIgdG91Y2ggaW4gdG8gbWFrZSBhIGNpcmNsZSwgbGVhdmluZyB0aGUgb3RoZXIgZmluZ2Vyc1xyXG4gKiBzdHJhaWdodCwgaXMgdXNlZCB0byB0dXJuIG9mZiB2b2ljaW5nLiBUdXJuaW5nIG9mZiB2b2ljaW5nIGFjdHVhbGx5IGFsbG93cyBhIHNpbmdsZSB2b2ljaW5nIHJlc3BvbnNlIHRvIGJlIHNwb2tlblxyXG4gKiBmdWxseSwgc28gaW4gYSBzZW5zZSwgdGhvdWdoIHRoZSBjb2RlIHRoaW5rcyB0aGF0IHRoZSBcIk9fSEFORF9HRVNUVVJFXCIgdHVybnMgb2ZmIHZvaWNpbmcsIGl0IGFjdHVhbGx5IGFsbG93cyBhIHNpbmdsZVxyXG4gKiB2b2ljaW5nIHJlc3BvbnNlIHRvIGJlIGhlYXJkLlxyXG4gKlxyXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBNZWRpYVBpcGUsIHsgSGFuZExhbmRtYXJrcywgSGFuZFBvaW50IH0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZ2libGUvanMvbWVkaWFQaXBlL01lZGlhUGlwZS5qcyc7XHJcbmltcG9ydCByYXRpb0FuZFByb3BvcnRpb24gZnJvbSAnLi4vLi4vcmF0aW9BbmRQcm9wb3J0aW9uLmpzJztcclxuaW1wb3J0IFJBUFJhdGlvVHVwbGUgZnJvbSAnLi4vbW9kZWwvUkFQUmF0aW9UdXBsZS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFZlY3RvcjMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjMuanMnO1xyXG5pbXBvcnQgcmFwQ29uc3RhbnRzIGZyb20gJy4uL3JhcENvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBWaWV3U291bmRzIGZyb20gJy4vc291bmQvVmlld1NvdW5kcy5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgUGhldGlvT2JqZWN0T3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9QaGV0aW9PYmplY3QuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgaGFuZGxlU21vb3RoVmFsdWUgZnJvbSAnLi9oYW5kbGVTbW9vdGhWYWx1ZS5qcyc7XHJcbmltcG9ydCBTdGF0aW9uYXJ5VmFsdWVUcmFja2VyIGZyb20gJy4vU3RhdGlvbmFyeVZhbHVlVHJhY2tlci5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb29sZWFuSU8gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0Jvb2xlYW5JTy5qcyc7XHJcbmltcG9ydCBNZWRpYVBpcGVRdWVyeVBhcmFtZXRlcnMgZnJvbSAnLi4vLi4vLi4vLi4vdGFuZ2libGUvanMvbWVkaWFQaXBlL01lZGlhUGlwZVF1ZXJ5UGFyYW1ldGVycy5qcyc7XHJcblxyXG5pZiAoIE1lZGlhUGlwZVF1ZXJ5UGFyYW1ldGVycy5jYW1lcmFJbnB1dCA9PT0gJ2hhbmRzJyApIHtcclxuICBNZWRpYVBpcGUuaW5pdGlhbGl6ZSgpO1xyXG59XHJcblxyXG4vLyBOdW1iZXIgb2YgcG9zaXRpb25zIHRvIGtlZXAgdG8gYXZlcmFnZSBvdXQgdG8gc21vb3RoIHRoZSBoYW5kIHBvc2l0aW9uc1xyXG5jb25zdCBQT1NJVElPTl9ISVNUT1JZX0xFTkdUSCA9IDEwO1xyXG5cclxuLy8gTnVtYmVyIG9mIHByZXZpb3VzIE9fSEFORF9HRVNUVVJFIGVuYWJsZWQgc3RhdGVzIHRvIGtlZXAgdG8gYXZlcmFnZSBvdXQgdG8gZGV0ZXJtaW5lIGlmIHZvaWNpbmcgaXMgZW5hYmxlZC4gQWxsIG11c3Qgc3RvcmVcclxuLy8gZmFsc2UgZm9yIHRoZSBnZXN0dXJlIHRvIG5vIGxvbmdlciBiZSBlbmFibGVkLlxyXG5jb25zdCBPX0hBTkRfR0VTVFVSRV9ERVRFQ1RFRF9ISVNUT1JZX0xFTkdUSCA9IDE1O1xyXG5cclxuLy8gTnVtYmVyIG9mIHByZXZpb3VzIHN0YXRlcyB0byBrZWVwIHRvIGF2ZXJhZ2Ugb3V0IHRvIGRldGVybWluZSBpZiB0d28gKGFuZCBvbmx5IHR3bykgaGFuZHMgYXJlIGRldGVjdGVkIGJ5IG1lZGlhUGlwZS5cclxuY29uc3QgVFdPX0hBTkRTX0RFVEVDVEVEX0hJU1RPUllfTEVOR1RIID0gMTA7XHJcblxyXG4vLyBUaGUgbWF4IHZhbHVlIG9mIGVhY2ggaGFuZCBwb3NpdGlvbiB2ZWN0b3IgY29tcG9uZW50IHRoYXQgd2UgZ2V0IGZyb20gTWVkaWFQaXBlLiAoeCx5LHopXHJcbmNvbnN0IEhBTkRfUE9TSVRJT05fTUFYX1ZBTFVFID0gMTtcclxuXHJcbi8vIEhhbmQtdHJhY2tpbmcgcG9pbnRzIHRoYXQgd2UgdXNlIHRvIGNhbGN1bGF0ZSB0aGUgcG9zaXRpb24gb2YgdGhlIHJhdGlvIGluIHRoZSBzaW0sICBTZWUgaHR0cHM6Ly9nb29nbGUuZ2l0aHViLmlvL21lZGlhcGlwZS9zb2x1dGlvbnMvaGFuZHMuaHRtbCNoYW5kLWxhbmRtYXJrLW1vZGVsXHJcbmNvbnN0IEhBTkRfUE9JTlRTID0gWyA1LCA5LCAxMyBdO1xyXG5cclxuY29uc3QgVEhVTUJfVElQID0gNDtcclxuY29uc3QgSU5ERVhfVElQID0gODtcclxuXHJcbmNvbnN0IE1BUktFUlNfVE9VQ0hJTkdfVEhSRVNIT0xEID0gMC4wNDtcclxuXHJcbi8vIFNjcmF0Y2ggdmVjdG9ycyB0byBhdm9pZCB0YWtpbmcgdG9vIG11Y2ggbWVtb3J5XHJcbmNvbnN0IGZpcnN0TWFya2VyVG91Y2hpbmdWZWN0b3IgPSBuZXcgVmVjdG9yMiggMCwgMCApO1xyXG5jb25zdCBzZWNvbmRNYXJrZXJUb3VjaGluZ1ZlY3RvciA9IG5ldyBWZWN0b3IyKCAwLCAwICk7XHJcblxyXG50eXBlIFJBUE1lZGlhUGlwZU9wdGlvbnMgPSB7XHJcbiAgb25JbnB1dD86ICgpID0+IHZvaWQ7XHJcbiAgaXNCZWluZ0ludGVyYWN0ZWRXaXRoUHJvcGVydHk/OiBQcm9wZXJ0eTxib29sZWFuPjtcclxufSAmIFBpY2tSZXF1aXJlZDxQaGV0aW9PYmplY3RPcHRpb25zLCAndGFuZGVtJz47XHJcblxyXG5jbGFzcyBSQVBNZWRpYVBpcGUgZXh0ZW5kcyBNZWRpYVBpcGUge1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgaXNCZWluZ0ludGVyYWN0ZWRXaXRoUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG4gIHByaXZhdGUgcmF0aW9UdXBsZVByb3BlcnR5OiBQcm9wZXJ0eTxSQVBSYXRpb1R1cGxlPjtcclxuICBwcml2YXRlIHJhdGlvTG9ja2VkUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG4gIHByaXZhdGUgYW50ZWNlZGVudFZpZXdTb3VuZHM6IFZpZXdTb3VuZHM7XHJcbiAgcHJpdmF0ZSBjb25zZXF1ZW50Vmlld1NvdW5kczogVmlld1NvdW5kcztcclxuXHJcbiAgcHJpdmF0ZSB0d29IYW5kc0RldGVjdGVkSGlzdG9yeTogYm9vbGVhbltdID0gW107XHJcbiAgcHJpdmF0ZSBhbnRlY2VkZW50SGFuZFBvc2l0aW9uczogVmVjdG9yM1tdID0gW107XHJcbiAgcHJpdmF0ZSBjb25zZXF1ZW50SGFuZFBvc2l0aW9uczogVmVjdG9yM1tdID0gW107XHJcbiAgcHJpdmF0ZSBvSGFuZEdlc3R1cmVEZXRlY3RlZEhpc3Rvcnk6IGJvb2xlYW5bXSA9IFtdO1xyXG4gIHB1YmxpYyBvSGFuZEdlc3R1cmVQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgcHVibGljIGFudGVjZWRlbnRTdGF0aW9uYXJ5VHJhY2tlciA9IG5ldyBTdGF0aW9uYXJ5VmFsdWVUcmFja2VyKCk7XHJcbiAgcHVibGljIGNvbnNlcXVlbnRTdGF0aW9uYXJ5VHJhY2tlciA9IG5ldyBTdGF0aW9uYXJ5VmFsdWVUcmFja2VyKCk7XHJcbiAgcHVibGljIGhhbmRzU3RhdGlvbmFyeVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gVXNlIGEgZ2VzdHVyZSB0byBkZXRlcm1pbmUgaWYgdm9pY2luZyBmb3IgdGhlIGhhbmRzIHNob3VsZCBiZSBlbmFibGVkXHJcblxyXG4gIHByaXZhdGUgb25JbnB1dDogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCByYXRpb1R1cGxlUHJvcGVydHk6IFByb3BlcnR5PFJBUFJhdGlvVHVwbGU+LCByYXRpb0xvY2tlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPixcclxuICAgICAgICAgICAgICAgICAgICAgIGFudGVjZWRlbnRWaWV3U291bmRzOiBWaWV3U291bmRzLCBjb25zZXF1ZW50Vmlld1NvdW5kczogVmlld1NvdW5kcywgcHJvdmlkZWRPcHRpb25zOiBSQVBNZWRpYVBpcGVPcHRpb25zICkge1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxSQVBNZWRpYVBpcGVPcHRpb25zPigpKCB7XHJcbiAgICAgIGlzQmVpbmdJbnRlcmFjdGVkV2l0aFByb3BlcnR5OiBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApLFxyXG4gICAgICBvbklucHV0OiBfLm5vb3BcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICB0aGlzLmlzQmVpbmdJbnRlcmFjdGVkV2l0aFByb3BlcnR5ID0gb3B0aW9ucy5pc0JlaW5nSW50ZXJhY3RlZFdpdGhQcm9wZXJ0eTtcclxuICAgIHRoaXMucmF0aW9UdXBsZVByb3BlcnR5ID0gcmF0aW9UdXBsZVByb3BlcnR5O1xyXG4gICAgdGhpcy5yYXRpb0xvY2tlZFByb3BlcnR5ID0gcmF0aW9Mb2NrZWRQcm9wZXJ0eTtcclxuICAgIHRoaXMub25JbnB1dCA9IG9wdGlvbnMub25JbnB1dDtcclxuICAgIHRoaXMuYW50ZWNlZGVudFZpZXdTb3VuZHMgPSBhbnRlY2VkZW50Vmlld1NvdW5kcztcclxuICAgIHRoaXMuY29uc2VxdWVudFZpZXdTb3VuZHMgPSBjb25zZXF1ZW50Vmlld1NvdW5kcztcclxuICAgIHRoaXMub0hhbmRHZXN0dXJlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ29IYW5kR2VzdHVyZVByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuaGFuZHNTdGF0aW9uYXJ5UHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbXHJcbiAgICAgIHRoaXMuYW50ZWNlZGVudFN0YXRpb25hcnlUcmFja2VyLmlzU3RhdGlvbmFyeVByb3BlcnR5LFxyXG4gICAgICB0aGlzLmNvbnNlcXVlbnRTdGF0aW9uYXJ5VHJhY2tlci5pc1N0YXRpb25hcnlQcm9wZXJ0eSxcclxuICAgICAgdGhpcy5vSGFuZEdlc3R1cmVQcm9wZXJ0eVxyXG4gICAgXSwgKCBhbnRlY2VkZW50U3RhdGlvbmFyeSwgY29uc2VxdWVudFN0YXRpb25hcnksIG9IYW5kR2VzdHVyZVByZXNlbnQgKSA9PiB7XHJcbiAgICAgIHJldHVybiBhbnRlY2VkZW50U3RhdGlvbmFyeSAmJiBjb25zZXF1ZW50U3RhdGlvbmFyeSAmJiAhb0hhbmRHZXN0dXJlUHJlc2VudDtcclxuICAgIH0sIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdoYW5kc1N0YXRpb25hcnlQcm9wZXJ0eScgKSxcclxuICAgICAgcGhldGlvVmFsdWVUeXBlOiBCb29sZWFuSU9cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmlzQmVpbmdJbnRlcmFjdGVkV2l0aFByb3BlcnR5LmxhenlMaW5rKCBpbnRlcmFjdGVkV2l0aCA9PiB7XHJcbiAgICAgIGlmICggaW50ZXJhY3RlZFdpdGggKSB7XHJcbiAgICAgICAgdGhpcy5hbnRlY2VkZW50Vmlld1NvdW5kcy5ib3VuZGFyeVNvdW5kQ2xpcC5vblN0YXJ0SW50ZXJhY3Rpb24oKTtcclxuICAgICAgICB0aGlzLmNvbnNlcXVlbnRWaWV3U291bmRzLmJvdW5kYXJ5U291bmRDbGlwLm9uU3RhcnRJbnRlcmFjdGlvbigpO1xyXG5cclxuICAgICAgICAvLyBJdCBpcyBhcmJpdHJhcnkgaGVyZSB3aGV0aGVyIHRvIHVzZSBzb3VuZHMgZnJvbSBhbnRlY2VkZW50IG9yIGNvbnNlcXVlbnQuXHJcbiAgICAgICAgdGhpcy5hbnRlY2VkZW50Vmlld1NvdW5kcy5ncmFiU291bmRDbGlwLnBsYXkoKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB0aGlzLmFudGVjZWRlbnRWaWV3U291bmRzLmJvdW5kYXJ5U291bmRDbGlwLm9uRW5kSW50ZXJhY3Rpb24oIHRoaXMucmF0aW9UdXBsZVByb3BlcnR5LnZhbHVlLmFudGVjZWRlbnQgKTtcclxuICAgICAgICB0aGlzLmNvbnNlcXVlbnRWaWV3U291bmRzLmJvdW5kYXJ5U291bmRDbGlwLm9uRW5kSW50ZXJhY3Rpb24oIHRoaXMucmF0aW9UdXBsZVByb3BlcnR5LnZhbHVlLmNvbnNlcXVlbnQgKTtcclxuXHJcbiAgICAgICAgdGhpcy5hbnRlY2VkZW50Vmlld1NvdW5kcy5yZWxlYXNlU291bmRDbGlwLnBsYXkoKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0ZXAoKTogdm9pZCB7XHJcblxyXG4gICAgY29uc3QgcmVzdWx0cyA9IE1lZGlhUGlwZS5yZXN1bHRzUHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgLy8gQmUgbW9yZSB0b2xlcmFudCBhYm91dCBpZiB3ZSBhcmUgaW50ZXJhY3Rpbmcgd2l0aCBNZWRpYVBpcGUuXHJcbiAgICB0aGlzLmlzQmVpbmdJbnRlcmFjdGVkV2l0aFByb3BlcnR5LnZhbHVlID0gcmVzdWx0cyA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRTbW9vdGhlZFR3b0hhbmRzRGV0ZWN0ZWQoIHJlc3VsdHMubXVsdGlIYW5kTGFuZG1hcmtzICkgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlO1xyXG5cclxuICAgIC8vIFRob3VnaCBpc0JlaW5nSW50ZXJhY3RlZFdpdGhQcm9wZXJ0eSBpcyB0b2xlcmFudCwgd2UgYWN0dWFsbHkgbmVlZCB0d28gaGFuZHMgdG8gY2FsY3VsYXRlIHNpbSBjaGFuZ2VzLlxyXG4gICAgaWYgKCByZXN1bHRzICYmIHJlc3VsdHMubXVsdGlIYW5kTGFuZG1hcmtzICYmICggcmVzdWx0cy5tdWx0aUhhbmRMYW5kbWFya3MubGVuZ3RoID09PSAyIHx8IHJlc3VsdHMubXVsdGlIYW5kTGFuZG1hcmtzLmxlbmd0aCA9PT0gMSApICYmXHJcblxyXG4gICAgICAgICAvLyBlbnN1cmUgdGhhdCBtdWx0aUhhbmRMYW5kbWFya3MgbG9vayBhcyBleHBlY3RlZCwgb3IgaWdub3JlIHRoYXQgZnJhbWUsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcmF0aW8tYW5kLXByb3BvcnRpb24vaXNzdWVzLzUwMVxyXG4gICAgICAgICBfLmV2ZXJ5KCByZXN1bHRzLm11bHRpSGFuZExhbmRtYXJrcywgbGFuZG1hcmtMaXN0ID0+IGxhbmRtYXJrTGlzdC5sZW5ndGggPT09IDIxICkgKSB7XHJcblxyXG4gICAgICAvLyBWb2ljaW5nIGlzIGRpc2FibGVkIHdpdGggdGhlIGdlc3R1cmUgb2YgYW4gXCJPXCIgaGFuZCBnZXN0dXJlIGZyb20gYm90aCBoYW5kcy4gTXVzdCBiZSBzZXQgYmVmb3JlIHRoaXMub25JbnRlcmFjdCgpIGlzIGNhbGxlZFxyXG4gICAgICB0aGlzLm9IYW5kR2VzdHVyZVByb3BlcnR5LnZhbHVlID0gdGhpcy5vSGFuZEdlc3R1cmVQcmVzZW50KCByZXN1bHRzLm11bHRpSGFuZExhbmRtYXJrcyApO1xyXG5cclxuICAgICAgY29uc3QgaGFuZFBvc2l0aW9ucyA9IHRoaXMuZ2V0UG9zaXRpb25zT2ZIYW5kcyggcmVzdWx0cy5tdWx0aUhhbmRMYW5kbWFya3MgKTtcclxuXHJcbiAgICAgIGlmICggcmVzdWx0cy5tdWx0aUhhbmRMYW5kbWFya3MubGVuZ3RoID09PSAyICkge1xyXG5cclxuICAgICAgICB0aGlzLmFudGVjZWRlbnRTdGF0aW9uYXJ5VHJhY2tlci51cGRhdGUoIGhhbmRQb3NpdGlvbnNbIDAgXS55ICk7XHJcbiAgICAgICAgdGhpcy5jb25zZXF1ZW50U3RhdGlvbmFyeVRyYWNrZXIudXBkYXRlKCBoYW5kUG9zaXRpb25zWyAxIF0ueSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IGhhbmRQb3NpdGlvbnNbIDAgXTtcclxuXHJcbiAgICAgICAgLy8gaWYganVzdCBvbmUgaGFuZCBpcyBkZXRlY3RlZCwgZGVmZXIgdG8gdGhlIGFic29sdXRlIHBvc2l0aW9uIG9mIHRoZSBoYW5kLCBhcmJpdHJhcmlseSBzcGxpdHRpbmcgaGFsZiB3YXlcclxuICAgICAgICAvLyB0aHJvdWdoIHRoZSBzY3JlZW4uXHJcbiAgICAgICAgY29uc3Qgc3RhdGlvbmFyeVRyYWNrZXIgPSBwb3NpdGlvbi54ID49IEhBTkRfUE9TSVRJT05fTUFYX1ZBTFVFIC8gMiA/IHRoaXMuY29uc2VxdWVudFN0YXRpb25hcnlUcmFja2VyIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYW50ZWNlZGVudFN0YXRpb25hcnlUcmFja2VyO1xyXG4gICAgICAgIHN0YXRpb25hcnlUcmFja2VyLnVwZGF0ZSggcG9zaXRpb24ueSApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBuZXdUdXBsZSA9IHRoaXMudHVwbGVGcm9tU21vb3RoaW5nKCBoYW5kUG9zaXRpb25zICk7XHJcblxyXG4gICAgICAvLyBJZiBsb2NrZWQsIHRoZW4gb25seSBjaGFuZ2Ugb25lIG9mIHRoZSB2YWx1ZSwgdGhlIG90aGVyIHdpbGwgdXBkYXRlIGFjY29yZGluZ2x5LlxyXG4gICAgICBpZiAoIHRoaXMucmF0aW9Mb2NrZWRQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICBpZiAoIE1lZGlhUGlwZS55QXhpc0ZsaXBwZWRQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICAgIG5ld1R1cGxlLmFudGVjZWRlbnQgPSB0aGlzLnJhdGlvVHVwbGVQcm9wZXJ0eS52YWx1ZS5hbnRlY2VkZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIG5ld1R1cGxlLmNvbnNlcXVlbnQgPSB0aGlzLnJhdGlvVHVwbGVQcm9wZXJ0eS52YWx1ZS5jb25zZXF1ZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCAhdGhpcy5vSGFuZEdlc3R1cmVQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICB0aGlzLnJhdGlvVHVwbGVQcm9wZXJ0eS52YWx1ZSA9IG5ld1R1cGxlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLm9uSW50ZXJhY3QoIG5ld1R1cGxlICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHR1cGxlRnJvbVNtb290aGluZyggaGFuZFBvc2l0aW9uczogVmVjdG9yM1tdICk6IFJBUFJhdGlvVHVwbGUge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggaGFuZFBvc2l0aW9ucy5sZW5ndGggPT09IDIgfHwgaGFuZFBvc2l0aW9ucy5sZW5ndGggPT09IDEsICdtdXN0IGhhdmUgMSBvciAyIGhhbmRzJyApO1xyXG5cclxuICAgIGxldCBsZWZ0SGFuZFBvc2l0aW9uOiBWZWN0b3IzO1xyXG4gICAgbGV0IHJpZ2h0SGFuZFBvc2l0aW9uOiBWZWN0b3IzO1xyXG5cclxuICAgIGlmICggaGFuZFBvc2l0aW9ucy5sZW5ndGggPT09IDIgKSB7XHJcbiAgICAgIGxlZnRIYW5kUG9zaXRpb24gPSBoYW5kUG9zaXRpb25zWyAwIF07XHJcbiAgICAgIHJpZ2h0SGFuZFBvc2l0aW9uID0gaGFuZFBvc2l0aW9uc1sgMSBdO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcblxyXG4gICAgICAvLyBFYWNoIGhhbGYgb2YgdGhlIHNjcmVlbiB0aGUgaGFuZCB3YXMgZGV0ZWN0ZWQgb24gd2lsbCBjb3JyZXNwb25kIHRvIHdoaWNoIHNpZGUgb2YgdGhlIHJhdGlvIHRoZSBzaW5nbGUgaGFuZFxyXG4gICAgICAvLyBhcHBsaWVzIHRvLlxyXG4gICAgICBpZiAoIGhhbmRQb3NpdGlvbnNbIDAgXS54ID49IEhBTkRfUE9TSVRJT05fTUFYX1ZBTFVFIC8gMiApIHtcclxuICAgICAgICBsZWZ0SGFuZFBvc2l0aW9uID0gdGhpcy5hbnRlY2VkZW50SGFuZFBvc2l0aW9ucy5sZW5ndGggPiAwID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbnRlY2VkZW50SGFuZFBvc2l0aW9uc1sgdGhpcy5hbnRlY2VkZW50SGFuZFBvc2l0aW9ucy5sZW5ndGggLSAxIF0gOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3IzLnBvb2wuY3JlYXRlKCAwLCB0aGlzLnJhdGlvVHVwbGVQcm9wZXJ0eS52YWx1ZS5hbnRlY2VkZW50LCAwICk7XHJcbiAgICAgICAgcmlnaHRIYW5kUG9zaXRpb24gPSBoYW5kUG9zaXRpb25zWyAwIF07XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgbGVmdEhhbmRQb3NpdGlvbiA9IGhhbmRQb3NpdGlvbnNbIDAgXTtcclxuICAgICAgICByaWdodEhhbmRQb3NpdGlvbiA9IHRoaXMuY29uc2VxdWVudEhhbmRQb3NpdGlvbnMubGVuZ3RoID4gMCA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnNlcXVlbnRIYW5kUG9zaXRpb25zWyB0aGlzLmNvbnNlcXVlbnRIYW5kUG9zaXRpb25zLmxlbmd0aCAtIDEgXSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3IzLnBvb2wuY3JlYXRlKCAwLCB0aGlzLnJhdGlvVHVwbGVQcm9wZXJ0eS52YWx1ZS5jb25zZXF1ZW50LCAwICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgUkFQUmF0aW9UdXBsZShcclxuICAgICAgdGhpcy5nZXRTbW9vdGhlZFBvc2l0aW9uKCBsZWZ0SGFuZFBvc2l0aW9uLCB0aGlzLmFudGVjZWRlbnRIYW5kUG9zaXRpb25zICkueSxcclxuICAgICAgdGhpcy5nZXRTbW9vdGhlZFBvc2l0aW9uKCByaWdodEhhbmRQb3NpdGlvbiwgdGhpcy5jb25zZXF1ZW50SGFuZFBvc2l0aW9ucyApLnlcclxuICAgICkuY29uc3RyYWluRmllbGRzKCByYXBDb25zdGFudHMuVE9UQUxfUkFUSU9fVEVSTV9WQUxVRV9SQU5HRSApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRTbW9vdGhlZFR3b0hhbmRzRGV0ZWN0ZWQoIG11bHRpSGFuZExhbmRtYXJrczogSGFuZExhbmRtYXJrc1tdICk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgaGFuZHNEZXRlY3RlZCA9IG11bHRpSGFuZExhbmRtYXJrcy5sZW5ndGggPT09IDIgfHwgbXVsdGlIYW5kTGFuZG1hcmtzLmxlbmd0aCA9PT0gMTtcclxuICAgIHJldHVybiBoYW5kbGVTbW9vdGhWYWx1ZSggaGFuZHNEZXRlY3RlZCwgdGhpcy50d29IYW5kc0RldGVjdGVkSGlzdG9yeSwgVFdPX0hBTkRTX0RFVEVDVEVEX0hJU1RPUllfTEVOR1RILFxyXG5cclxuICAgICAgLy8gVG8gcmVkdWNlIGZhbHNlIHBvc2l0aXZlcyBhbmQgZmFsc2UgbmVnYXRpdmVzLCA1MCUgb2YgdGhlIGhpc3RvcnkgbXVzdCBoYXZlIHR3byBoYW5kcyBkZXRlY3RlZC5cclxuICAgICAgKCkgPT4gdGhpcy50d29IYW5kc0RldGVjdGVkSGlzdG9yeS5maWx0ZXIoIF8uaWRlbnRpdHkgKS5sZW5ndGggPiBUV09fSEFORFNfREVURUNURURfSElTVE9SWV9MRU5HVEggLyAyXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQXZlcmFnZSB0aGUgaGlzdG9yaWNhbCBwb3NpdGlvbnMgdG9nZXRoZXIgdG8gZ2V0IHRoZSBjdXJyZW50IHZhbHVlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRTbW9vdGhlZFBvc2l0aW9uKCBwb3NpdGlvbjogVmVjdG9yMywgaGlzdG9yaWNhbFBvc2l0aW9uczogVmVjdG9yM1tdICk6IFZlY3RvcjMge1xyXG4gICAgcmV0dXJuIGhhbmRsZVNtb290aFZhbHVlKCBwb3NpdGlvbiwgaGlzdG9yaWNhbFBvc2l0aW9ucywgUE9TSVRJT05fSElTVE9SWV9MRU5HVEgsIFZlY3RvcjMuYXZlcmFnZSApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRQb3NpdGlvbnNPZkhhbmRzKCBtdWx0aUhhbmRMYW5kbWFya3M6IEhhbmRMYW5kbWFya3NbXSApOiBWZWN0b3IzW10ge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggbXVsdGlIYW5kTGFuZG1hcmtzLmxlbmd0aCA9PT0gMiB8fCBtdWx0aUhhbmRMYW5kbWFya3MubGVuZ3RoID09PSAxLCAnbXVzdCBoYXZlIDEgb3IgMiBoYW5kcycgKTtcclxuXHJcbiAgICBjb25zdCBoYW5kUG9zaXRpb25zID0gbXVsdGlIYW5kTGFuZG1hcmtzLm1hcCggKCBoYW5kTWFya2VyUG9zaXRpb25zOiBIYW5kUG9pbnRbXSApID0+IHtcclxuICAgICAgY29uc3QgZmluYWxQb3NpdGlvbiA9IG5ldyBWZWN0b3IzKCAwLCAwLCAwICk7XHJcblxyXG4gICAgICAvLyBUaGVzZSBhcmUgYWxvbmcgdGhlIGNlbnRlciBvZiBhIGhhbmQsIGFib3V0IHdoZXJlIHdlIGhhdmUgY2FsaWJyYXRlZCB0aGUgaGFuZCBpY29uIGluIFJBUCwgc2VlIGh0dHBzOi8vZ29vZ2xlLmdpdGh1Yi5pby9tZWRpYXBpcGUvc29sdXRpb25zL2hhbmRzLmh0bWwjaGFuZC1sYW5kbWFyay1tb2RlbFxyXG4gICAgICBIQU5EX1BPSU5UUy5mb3JFYWNoKCBpbmRleCA9PiB7XHJcbiAgICAgICAgY29uc3QgcG9pbnQgPSBoYW5kTWFya2VyUG9zaXRpb25zWyBpbmRleCBdO1xyXG4gICAgICAgIGlmICggIXBvaW50LnggfHwgIXBvaW50LnkgfHwgIXBvaW50LnogKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyggJ2Jyb2tlbiBoYW5kIGxhbmRtYXJrIGlucHV0OiAnLCBtdWx0aUhhbmRMYW5kbWFya3MgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggdHlwZW9mIHBvaW50LnggPT09ICdudW1iZXInICk7XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggdHlwZW9mIHBvaW50LnkgPT09ICdudW1iZXInICk7XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggdHlwZW9mIHBvaW50LnogPT09ICdudW1iZXInICk7XHJcbiAgICAgICAgY29uc3QgeVBvc2l0aW9uID0gTWVkaWFQaXBlLnhBeGlzRmxpcHBlZFByb3BlcnR5LnZhbHVlID8gcG9pbnQueSA6IEhBTkRfUE9TSVRJT05fTUFYX1ZBTFVFIC0gcG9pbnQueTtcclxuICAgICAgICBjb25zdCB4UG9zaXRpb24gPSBNZWRpYVBpcGUueUF4aXNGbGlwcGVkUHJvcGVydHkudmFsdWUgPyBwb2ludC54IDogSEFORF9QT1NJVElPTl9NQVhfVkFMVUUgLSBwb2ludC54O1xyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbmV3IFZlY3RvcjMoIHhQb3NpdGlvbiwgeVBvc2l0aW9uLCBIQU5EX1BPU0lUSU9OX01BWF9WQUxVRSAtIHBvaW50LnogKTtcclxuICAgICAgICBmaW5hbFBvc2l0aW9uLmFkZCggcG9zaXRpb24gKTtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgcmV0dXJuIGZpbmFsUG9zaXRpb24uZGl2aWRlU2NhbGFyKCBIQU5EX1BPSU5UUy5sZW5ndGggKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICByZXR1cm4gUkFQTWVkaWFQaXBlLnNvcnRIYW5kUG9zaXRpb25zKCBoYW5kUG9zaXRpb25zICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyBzb3J0SGFuZFBvc2l0aW9ucyggaGFuZFBvc2l0aW9uczogVmVjdG9yM1tdICk6IFZlY3RvcjNbXSB7XHJcbiAgICBpZiAoIGhhbmRQb3NpdGlvbnMubGVuZ3RoID09PSAyICkge1xyXG4gICAgICByZXR1cm4gaGFuZFBvc2l0aW9uc1sgMCBdLnggPD0gaGFuZFBvc2l0aW9uc1sgMSBdLnggPyBoYW5kUG9zaXRpb25zIDogaGFuZFBvc2l0aW9ucy5yZXZlcnNlKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaGFuZFBvc2l0aW9ucztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIHBvc2l0aW9uVmFsaWQoIHBvc2l0aW9uOiBIYW5kUG9pbnQgKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gcG9zaXRpb24gJiYgcG9zaXRpb24uaGFzT3duUHJvcGVydHkoICd4JyApICYmIHBvc2l0aW9uLmhhc093blByb3BlcnR5KCAneScgKSAmJlxyXG4gICAgICAgICAgIHR5cGVvZiBwb3NpdGlvbi54ID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgcG9zaXRpb24ueSA9PT0gJ251bWJlcic7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyBtYXJrZXJzVG91Y2hpbmcoIHBvaW50MTogbnVtYmVyLCBwb2ludDI6IG51bWJlciwgaGFuZE1hcmtlclBvc2l0aW9uczogSGFuZFBvaW50W10gKTogYm9vbGVhbiB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBoYW5kTWFya2VyUG9zaXRpb25zLmxlbmd0aCA9PT0gMjEsICcyMSBoYW5kIHBvc2l0aW9ucyBleHBlY3RlZCcsIGhhbmRNYXJrZXJQb3NpdGlvbnMgKTtcclxuICAgIGNvbnN0IHBvc2l0aW9uMSA9IGhhbmRNYXJrZXJQb3NpdGlvbnNbIHBvaW50MSBdO1xyXG4gICAgY29uc3QgcG9zaXRpb24yID0gaGFuZE1hcmtlclBvc2l0aW9uc1sgcG9pbnQyIF07XHJcblxyXG4gICAgaWYgKCAhKCBSQVBNZWRpYVBpcGUucG9zaXRpb25WYWxpZCggcG9zaXRpb24xICkgJiYgUkFQTWVkaWFQaXBlLnBvc2l0aW9uVmFsaWQoIHBvc2l0aW9uMiApICkgKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBmaXJzdE1hcmtlclRvdWNoaW5nVmVjdG9yLnNldFhZKCBwb3NpdGlvbjEueCwgcG9zaXRpb24xLnkgKTtcclxuICAgIHNlY29uZE1hcmtlclRvdWNoaW5nVmVjdG9yLnNldFhZKCBwb3NpdGlvbjIueCwgcG9zaXRpb24yLnkgKTtcclxuXHJcbiAgICByZXR1cm4gZmlyc3RNYXJrZXJUb3VjaGluZ1ZlY3Rvci5kaXN0YW5jZSggc2Vjb25kTWFya2VyVG91Y2hpbmdWZWN0b3IgKSA8IE1BUktFUlNfVE9VQ0hJTkdfVEhSRVNIT0xEO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvbkludGVyYWN0KCBuZXdWYWx1ZTogUkFQUmF0aW9UdXBsZSApOiB2b2lkIHtcclxuICAgIHRoaXMub25JbnB1dCgpO1xyXG4gICAgdGhpcy5hbnRlY2VkZW50Vmlld1NvdW5kcy5ib3VuZGFyeVNvdW5kQ2xpcC5vbkludGVyYWN0KCBuZXdWYWx1ZS5hbnRlY2VkZW50ICk7XHJcbiAgICB0aGlzLmNvbnNlcXVlbnRWaWV3U291bmRzLmJvdW5kYXJ5U291bmRDbGlwLm9uSW50ZXJhY3QoIG5ld1ZhbHVlLmNvbnNlcXVlbnQgKTtcclxuICAgIHRoaXMuYW50ZWNlZGVudFZpZXdTb3VuZHMudGlja01hcmtCdW1wU291bmRDbGlwLm9uSW50ZXJhY3QoIG5ld1ZhbHVlLmFudGVjZWRlbnQgKTtcclxuICAgIHRoaXMuY29uc2VxdWVudFZpZXdTb3VuZHMudGlja01hcmtCdW1wU291bmRDbGlwLm9uSW50ZXJhY3QoIG5ld1ZhbHVlLmNvbnNlcXVlbnQgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIGhhc09IYW5kR2VzdHVyZSggbXVsdGlIYW5kTGFuZG1hcmtzOiBIYW5kTGFuZG1hcmtzW10gKTogYm9vbGVhbiB7XHJcblxyXG4gICAgLy8gQ2Fubm90IGhhdmUgT19IQU5EX0dFU1RVUkUgd2l0aG91dCB0d28gYW5kIG9ubHkgdHdvIGhhbmRzLlxyXG4gICAgaWYgKCBtdWx0aUhhbmRMYW5kbWFya3MubGVuZ3RoICE9PSAyICkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gUkFQTWVkaWFQaXBlLm1hcmtlcnNUb3VjaGluZyggVEhVTUJfVElQLCBJTkRFWF9USVAsIG11bHRpSGFuZExhbmRtYXJrc1sgMCBdICkgJiZcclxuICAgICAgICAgICBSQVBNZWRpYVBpcGUubWFya2Vyc1RvdWNoaW5nKCBUSFVNQl9USVAsIElOREVYX1RJUCwgbXVsdGlIYW5kTGFuZG1hcmtzWyAxIF0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFZvaWNpbmcgaXMgZWFnZXJseSBkaXNhYmxlZCB1cG9uIGZpcnN0IFwiTy1IYW5kIEdlc3R1cmVcIiBkZXRlY3Rpb24sIGJ1dCB0byB0dXJuIGl0IG9uLCBrZWVwIHRyYWNrIG9mIGhpc3RvcnkgdG8gZW5zdXJlXHJcbiAgICogdGhhdCB0aGUgdXNlciBpcyBhY3R1YWxseSBpbnRlbmRpbmcgdG8gc3RvcCB0aGUgXCJPLUhhbmQgR2VzdHVyZVwiXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBvSGFuZEdlc3R1cmVQcmVzZW50KCBtdWx0aUhhbmRMYW5kbWFya3M6IEhhbmRMYW5kbWFya3NbXSApOiBib29sZWFuIHtcclxuXHJcbiAgICBpZiAoIG11bHRpSGFuZExhbmRtYXJrcy5sZW5ndGggIT09IDIgKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGNvbnN0IG5ld09IYW5kR2VzdHVyZURldGVjdGVkID0gUkFQTWVkaWFQaXBlLmhhc09IYW5kR2VzdHVyZSggbXVsdGlIYW5kTGFuZG1hcmtzICk7XHJcblxyXG4gICAgaWYgKCAhbmV3T0hhbmRHZXN0dXJlRGV0ZWN0ZWQgKSB7XHJcbiAgICAgIHRoaXMub0hhbmRHZXN0dXJlRGV0ZWN0ZWRIaXN0b3J5LnB1c2goIG5ld09IYW5kR2VzdHVyZURldGVjdGVkICk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaGFuZGxlU21vb3RoVmFsdWUoIG5ld09IYW5kR2VzdHVyZURldGVjdGVkLCB0aGlzLm9IYW5kR2VzdHVyZURldGVjdGVkSGlzdG9yeSwgT19IQU5EX0dFU1RVUkVfREVURUNURURfSElTVE9SWV9MRU5HVEgsXHJcblxyXG4gICAgICAvLyBJZiB0aGVyZSBpcyBhIHNpbmdsZSBPX0hBTkRfR0VTVFVSRSBwcmVzZW50LCB0aGVuIHRoZXJlIGlzIHN0aWxsIGludGVudCB0byBnZXN0dXJlLlxyXG4gICAgICAoKSA9PiB0aGlzLm9IYW5kR2VzdHVyZURldGVjdGVkSGlzdG9yeS5maWx0ZXIoIF8uaWRlbnRpdHkgKS5sZW5ndGggIT09IDBcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLmlzQmVpbmdJbnRlcmFjdGVkV2l0aFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgfVxyXG59XHJcblxyXG5yYXRpb0FuZFByb3BvcnRpb24ucmVnaXN0ZXIoICdSQVBNZWRpYVBpcGUnLCBSQVBNZWRpYVBpcGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgUkFQTWVkaWFQaXBlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsU0FBUyxNQUFvQyxnREFBZ0Q7QUFDcEcsT0FBT0Msa0JBQWtCLE1BQU0sNkJBQTZCO0FBQzVELE9BQU9DLGFBQWEsTUFBTSwyQkFBMkI7QUFFckQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxZQUFZLE1BQU0sb0JBQW9CO0FBRTdDLE9BQU9DLFNBQVMsTUFBTSx1Q0FBdUM7QUFDN0QsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUduRCxPQUFPQyxpQkFBaUIsTUFBTSx3QkFBd0I7QUFDdEQsT0FBT0Msc0JBQXNCLE1BQU0sNkJBQTZCO0FBRWhFLE9BQU9DLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsU0FBUyxNQUFNLDBDQUEwQztBQUNoRSxPQUFPQyx3QkFBd0IsTUFBTSwrREFBK0Q7QUFFcEcsSUFBS0Esd0JBQXdCLENBQUNDLFdBQVcsS0FBSyxPQUFPLEVBQUc7RUFDdERaLFNBQVMsQ0FBQ2EsVUFBVSxDQUFDLENBQUM7QUFDeEI7O0FBRUE7QUFDQSxNQUFNQyx1QkFBdUIsR0FBRyxFQUFFOztBQUVsQztBQUNBO0FBQ0EsTUFBTUMsc0NBQXNDLEdBQUcsRUFBRTs7QUFFakQ7QUFDQSxNQUFNQyxpQ0FBaUMsR0FBRyxFQUFFOztBQUU1QztBQUNBLE1BQU1DLHVCQUF1QixHQUFHLENBQUM7O0FBRWpDO0FBQ0EsTUFB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