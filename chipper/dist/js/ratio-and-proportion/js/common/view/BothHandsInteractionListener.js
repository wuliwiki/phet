// Copyright 2020-2022, University of Colorado Boulder

/**
 * Keyboard interaction listener for moving both ratio halves at the same time. This includes step-wise movement on
 * each ratio term independently (at the same time), as well as jumping both terms to the same value.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import Emitter from '../../../../axon/js/Emitter.js';
import { globalKeyStateTracker, KeyboardUtils } from '../../../../scenery/js/imports.js';
import ratioAndProportion from '../../ratioAndProportion.js';
import RAPRatioTuple from '../model/RAPRatioTuple.js';
import RatioTerm from '../model/RatioTerm.js';
import rapConstants from '../rapConstants.js';
import getKeyboardInputSnappingMapper from './getKeyboardInputSnappingMapper.js';
import optionize from '../../../../phet-core/js/optionize.js';
import RatioInputModality from './describers/RatioInputModality.js';
const TOTAL_RANGE = rapConstants.TOTAL_RATIO_TERM_VALUE_RANGE;
const onInputDefault = _.noop;
class BothHandsInteractionListener {
  // true whenever the user is interacting with this listener

  // called when this input occurs when the ratio is locked with a target of N:N. Jumping to zero is not allowed for
  // this case, see, https://github.com/phetsims/ratio-and-proportion/issues/227#issuecomment-758036456
  // The custom jumping logic uses special logic to determine if jumping caused a boundary to be hit. That occurs in
  // keydown, but we want the sound only to play once on keyup. Use this as a marker to signify that the boundary
  // sound should be played.
  constructor(providedOptions) {
    const options = optionize()({
      onInput: onInputDefault
    }, providedOptions);
    this.targetNode = options.targetNode;
    this.ratioTupleProperty = options.ratioTupleProperty;
    this.antecedentInteractedWithProperty = options.antecedentInteractedWithProperty;
    this.consequentInteractedWithProperty = options.consequentInteractedWithProperty;
    this.enabledRatioTermsRangeProperty = options.enabledRatioTermsRangeProperty;
    this.tickMarkRangeProperty = options.tickMarkRangeProperty;
    this.keyboardStep = options.keyboardStep;
    this.shiftKeyboardStep = this.keyboardStep * rapConstants.SHIFT_KEY_MULTIPLIER;
    this.boundarySoundClip = options.boundarySoundClip;
    this.tickMarkBumpSoundClip = options.tickMarkBumpSoundClip;
    this.ratioLockedProperty = options.ratioLockedProperty;
    this.targetRatioProperty = options.targetRatioProperty;
    this.inProportionProperty = options.inProportionProperty;
    this.onInput = options.onInput;
    this.antecedentMapKeyboardInput = getKeyboardInputSnappingMapper(() => options.getIdealTerm(RatioTerm.ANTECEDENT), options.keyboardStep, this.shiftKeyboardStep);
    this.consequentMapKeyboardInput = getKeyboardInputSnappingMapper(() => options.getIdealTerm(RatioTerm.CONSEQUENT), options.keyboardStep, this.shiftKeyboardStep);
    this.isBeingInteractedWithProperty = new BooleanProperty(false);
    this.jumpToZeroWhileLockedEmitter = new Emitter();
    this.playBoundarySoundOnKeyup = false;
  }
  reset() {
    this.antecedentMapKeyboardInput.reset();
    this.consequentMapKeyboardInput.reset();
  }

  /**
   * Consistently handle changing the ratio from increment/decrement
   * @param ratioTerm - what field of the RAPRatioTuple are we changing
   * @param inputMapper - see getKeyboardInputSnappingMapper
   * @param increment - if the value is being incremented, as opposed to decremented.
   */
  onValueIncrementDecrement(ratioTerm, inputMapper, increment) {
    this.isBeingInteractedWithProperty.value = true;
    const currentValueFromTuple = this.ratioTupleProperty.value.getForTerm(ratioTerm);
    const changeAmount = globalKeyStateTracker.shiftKeyDown ? this.shiftKeyboardStep : this.keyboardStep;
    const valueDelta = changeAmount * (increment ? 1 : -1);

    // Because this interaction uses the keyboard, snap to the keyboard step to handle the case where the hands were
    // previously moved via mouse/touch. See https://github.com/phetsims/ratio-and-proportion/issues/156
    const newValue = inputMapper(currentValueFromTuple + valueDelta, currentValueFromTuple, globalKeyStateTracker.shiftKeyDown, this.inProportionProperty.value);
    const newRatioTuple = this.ratioTupleProperty.value.withValueForTerm(newValue, ratioTerm);
    this.ratioTupleProperty.value = newRatioTuple.constrainFields(this.enabledRatioTermsRangeProperty.value);
    this.tickMarkBumpSoundClip.onInteract(this.ratioTupleProperty.value.getForTerm(ratioTerm));
    this.onInput(ratioTerm);
  }
  blur() {
    this.isBeingInteractedWithProperty.value = false;
  }
  keydown(sceneryEvent) {
    if (sceneryEvent.target === this.targetNode) {
      // signify that this listener is reserved for keyboard movement so that other listeners can change
      // their behavior during scenery event dispatch
      sceneryEvent.pointer.reserveForKeyboardDrag();
      assert && assert(sceneryEvent.domEvent, 'dom event expected');
      const domEvent = sceneryEvent.domEvent;
      const key = KeyboardUtils.getEventCode(domEvent);
      if (key === KeyboardUtils.KEY_DOWN_ARROW) {
        this.consequentInteractedWithProperty.value = true;
        this.onValueIncrementDecrement(RatioTerm.CONSEQUENT, this.consequentMapKeyboardInput, false);
      } else if (key === KeyboardUtils.KEY_UP_ARROW) {
        this.onValueIncrementDecrement(RatioTerm.CONSEQUENT, this.consequentMapKeyboardInput, true);
        this.consequentInteractedWithProperty.value = true;
      } else if (key === KeyboardUtils.KEY_W) {
        this.antecedentInteractedWithProperty.value = true;
        this.onValueIncrementDecrement(RatioTerm.ANTECEDENT, this.antecedentMapKeyboardInput, true);
      } else if (key === KeyboardUtils.KEY_S) {
        this.antecedentInteractedWithProperty.value = true;
        this.onValueIncrementDecrement(RatioTerm.ANTECEDENT, this.antecedentMapKeyboardInput, false);
      } else {
        // for number keys 0-9, jump both values to that tick mark number. This value changes based on the tickMarkRangeProperty
        for (let i = 0; i <= 9; i++) {
          if (KeyboardUtils.getNumberFromCode(domEvent) === i && !domEvent.getModifierState('Control') && !domEvent.getModifierState('Shift') && !domEvent.getModifierState('Alt')) {
            this.isBeingInteractedWithProperty.value = true;

            // If the ratio is locked, and the target is 1, this case means that going to 0:0 would be a buggy case.
            // Here we will just disable this feature.
            if (this.ratioLockedProperty.value && this.targetRatioProperty.value === 1 && i === 0) {
              this.jumpToZeroWhileLockedEmitter.emit();
              return;
            }
            const wasLocked = this.ratioLockedProperty.value;

            // unlock the ratio because we are snapping out of locked ratio, if target is 1, then we are maintaining
            // that ratio with this input and we can keep the ratio locked.
            if (wasLocked && this.targetRatioProperty.value !== 1) {
              this.ratioLockedProperty.value = false;
            }

            // capture now before altering the ratio lockedProperty changes it
            const rangeForConstraining = this.enabledRatioTermsRangeProperty.value;
            const newValue = 1 / this.tickMarkRangeProperty.value * i;
            const constrained = rangeForConstraining.constrainValue(newValue);
            this.ratioTupleProperty.value = new RAPRatioTuple(constrained, constrained);

            // If this brought to min or max, play the boundary sound
            if (constrained === TOTAL_RANGE.min || constrained === TOTAL_RANGE.max) {
              this.playBoundarySoundOnKeyup = true;
            }

            // If the target was 1, or perhaps another way, then setting both values should maintain the locked state
            // if it was previously locked.
            assert && wasLocked && this.targetRatioProperty.value === 1 && assert(this.ratioLockedProperty.value, 'should be locked still after setting both values');

            // Count number key interaction as cue-removing interaction.
            this.antecedentInteractedWithProperty.value = true;
            this.consequentInteractedWithProperty.value = true;

            // Extra arg here because this input can "knock" the ratio out of locked mode, see https://github.com/phetsims/ratio-and-proportion/issues/227
            this.onInput(RatioInputModality.BOTH_HANDS, wasLocked && !this.ratioLockedProperty.value);
            break;
          }
        }
      }
    }
  }
  keyup(sceneryEvent) {
    if (sceneryEvent.target === this.targetNode) {
      assert && assert(sceneryEvent.domEvent, 'domEvent expected');
      const domEvent = sceneryEvent.domEvent;
      if (KeyboardUtils.isAnyKeyEvent(domEvent, [KeyboardUtils.KEY_DOWN_ARROW, KeyboardUtils.KEY_UP_ARROW])) {
        this.handleBoundarySoundOnInput(this.ratioTupleProperty.value.consequent);
      } else if (KeyboardUtils.isAnyKeyEvent(domEvent, [KeyboardUtils.KEY_W, KeyboardUtils.KEY_S])) {
        this.handleBoundarySoundOnInput(this.ratioTupleProperty.value.antecedent);
      }
      if (this.playBoundarySoundOnKeyup) {
        this.boundarySoundClip.play();
        this.playBoundarySoundOnKeyup = false;
      }
    }
  }

  /**
   * Handle boundary sound output based on an input for this interaction
   */
  handleBoundarySoundOnInput(newValue) {
    this.boundarySoundClip.onStartInteraction();
    this.boundarySoundClip.onInteract(newValue);
    this.boundarySoundClip.onEndInteraction(newValue);
  }
}
ratioAndProportion.register('BothHandsInteractionListener', BothHandsInteractionListener);
export default BothHandsInteractionListener;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJFbWl0dGVyIiwiZ2xvYmFsS2V5U3RhdGVUcmFja2VyIiwiS2V5Ym9hcmRVdGlscyIsInJhdGlvQW5kUHJvcG9ydGlvbiIsIlJBUFJhdGlvVHVwbGUiLCJSYXRpb1Rlcm0iLCJyYXBDb25zdGFudHMiLCJnZXRLZXlib2FyZElucHV0U25hcHBpbmdNYXBwZXIiLCJvcHRpb25pemUiLCJSYXRpb0lucHV0TW9kYWxpdHkiLCJUT1RBTF9SQU5HRSIsIlRPVEFMX1JBVElPX1RFUk1fVkFMVUVfUkFOR0UiLCJvbklucHV0RGVmYXVsdCIsIl8iLCJub29wIiwiQm90aEhhbmRzSW50ZXJhY3Rpb25MaXN0ZW5lciIsImNvbnN0cnVjdG9yIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsIm9uSW5wdXQiLCJ0YXJnZXROb2RlIiwicmF0aW9UdXBsZVByb3BlcnR5IiwiYW50ZWNlZGVudEludGVyYWN0ZWRXaXRoUHJvcGVydHkiLCJjb25zZXF1ZW50SW50ZXJhY3RlZFdpdGhQcm9wZXJ0eSIsImVuYWJsZWRSYXRpb1Rlcm1zUmFuZ2VQcm9wZXJ0eSIsInRpY2tNYXJrUmFuZ2VQcm9wZXJ0eSIsImtleWJvYXJkU3RlcCIsInNoaWZ0S2V5Ym9hcmRTdGVwIiwiU0hJRlRfS0VZX01VTFRJUExJRVIiLCJib3VuZGFyeVNvdW5kQ2xpcCIsInRpY2tNYXJrQnVtcFNvdW5kQ2xpcCIsInJhdGlvTG9ja2VkUHJvcGVydHkiLCJ0YXJnZXRSYXRpb1Byb3BlcnR5IiwiaW5Qcm9wb3J0aW9uUHJvcGVydHkiLCJhbnRlY2VkZW50TWFwS2V5Ym9hcmRJbnB1dCIsImdldElkZWFsVGVybSIsIkFOVEVDRURFTlQiLCJjb25zZXF1ZW50TWFwS2V5Ym9hcmRJbnB1dCIsIkNPTlNFUVVFTlQiLCJpc0JlaW5nSW50ZXJhY3RlZFdpdGhQcm9wZXJ0eSIsImp1bXBUb1plcm9XaGlsZUxvY2tlZEVtaXR0ZXIiLCJwbGF5Qm91bmRhcnlTb3VuZE9uS2V5dXAiLCJyZXNldCIsIm9uVmFsdWVJbmNyZW1lbnREZWNyZW1lbnQiLCJyYXRpb1Rlcm0iLCJpbnB1dE1hcHBlciIsImluY3JlbWVudCIsInZhbHVlIiwiY3VycmVudFZhbHVlRnJvbVR1cGxlIiwiZ2V0Rm9yVGVybSIsImNoYW5nZUFtb3VudCIsInNoaWZ0S2V5RG93biIsInZhbHVlRGVsdGEiLCJuZXdWYWx1ZSIsIm5ld1JhdGlvVHVwbGUiLCJ3aXRoVmFsdWVGb3JUZXJtIiwiY29uc3RyYWluRmllbGRzIiwib25JbnRlcmFjdCIsImJsdXIiLCJrZXlkb3duIiwic2NlbmVyeUV2ZW50IiwidGFyZ2V0IiwicG9pbnRlciIsInJlc2VydmVGb3JLZXlib2FyZERyYWciLCJhc3NlcnQiLCJkb21FdmVudCIsImtleSIsImdldEV2ZW50Q29kZSIsIktFWV9ET1dOX0FSUk9XIiwiS0VZX1VQX0FSUk9XIiwiS0VZX1ciLCJLRVlfUyIsImkiLCJnZXROdW1iZXJGcm9tQ29kZSIsImdldE1vZGlmaWVyU3RhdGUiLCJlbWl0Iiwid2FzTG9ja2VkIiwicmFuZ2VGb3JDb25zdHJhaW5pbmciLCJjb25zdHJhaW5lZCIsImNvbnN0cmFpblZhbHVlIiwibWluIiwibWF4IiwiQk9USF9IQU5EUyIsImtleXVwIiwiaXNBbnlLZXlFdmVudCIsImhhbmRsZUJvdW5kYXJ5U291bmRPbklucHV0IiwiY29uc2VxdWVudCIsImFudGVjZWRlbnQiLCJwbGF5Iiwib25TdGFydEludGVyYWN0aW9uIiwib25FbmRJbnRlcmFjdGlvbiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQm90aEhhbmRzSW50ZXJhY3Rpb25MaXN0ZW5lci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBLZXlib2FyZCBpbnRlcmFjdGlvbiBsaXN0ZW5lciBmb3IgbW92aW5nIGJvdGggcmF0aW8gaGFsdmVzIGF0IHRoZSBzYW1lIHRpbWUuIFRoaXMgaW5jbHVkZXMgc3RlcC13aXNlIG1vdmVtZW50IG9uXHJcbiAqIGVhY2ggcmF0aW8gdGVybSBpbmRlcGVuZGVudGx5IChhdCB0aGUgc2FtZSB0aW1lKSwgYXMgd2VsbCBhcyBqdW1waW5nIGJvdGggdGVybXMgdG8gdGhlIHNhbWUgdmFsdWUuXHJcbiAqXHJcbiAqIEBhdXRob3IgTWljaGFlbCBLYXV6bWFubiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IEVtaXR0ZXIgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbWl0dGVyLmpzJztcclxuaW1wb3J0IHsgZ2xvYmFsS2V5U3RhdGVUcmFja2VyLCBLZXlib2FyZFV0aWxzLCBOb2RlLCBTY2VuZXJ5RXZlbnQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgcmF0aW9BbmRQcm9wb3J0aW9uIGZyb20gJy4uLy4uL3JhdGlvQW5kUHJvcG9ydGlvbi5qcyc7XHJcbmltcG9ydCBSQVBSYXRpb1R1cGxlIGZyb20gJy4uL21vZGVsL1JBUFJhdGlvVHVwbGUuanMnO1xyXG5pbXBvcnQgUmF0aW9UZXJtIGZyb20gJy4uL21vZGVsL1JhdGlvVGVybS5qcyc7XHJcbmltcG9ydCByYXBDb25zdGFudHMgZnJvbSAnLi4vcmFwQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IGdldEtleWJvYXJkSW5wdXRTbmFwcGluZ01hcHBlciwgeyBLZXlib2FyZElucHV0TWFwcGVyIH0gZnJvbSAnLi9nZXRLZXlib2FyZElucHV0U25hcHBpbmdNYXBwZXIuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgQm91bmRhcnlTb3VuZENsaXAgZnJvbSAnLi9zb3VuZC9Cb3VuZGFyeVNvdW5kQ2xpcC5qcyc7XHJcbmltcG9ydCBUaWNrTWFya0J1bXBTb3VuZENsaXAgZnJvbSAnLi9zb3VuZC9UaWNrTWFya0J1bXBTb3VuZENsaXAuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUmF0aW9JbnB1dE1vZGFsaXR5IGZyb20gJy4vZGVzY3JpYmVycy9SYXRpb0lucHV0TW9kYWxpdHkuanMnO1xyXG5pbXBvcnQgVEVtaXR0ZXIgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9URW1pdHRlci5qcyc7XHJcblxyXG5jb25zdCBUT1RBTF9SQU5HRSA9IHJhcENvbnN0YW50cy5UT1RBTF9SQVRJT19URVJNX1ZBTFVFX1JBTkdFO1xyXG5cclxudHlwZSBPbklucHV0VHlwZSA9ICggcmF0aW9JbnB1dE1vZGFsaXR5OiBSYXRpb0lucHV0TW9kYWxpdHksIGtub2NrT3V0T2ZMb2NrPzogYm9vbGVhbiApID0+IHZvaWQ7XHJcbmNvbnN0IG9uSW5wdXREZWZhdWx0ID0gXy5ub29wO1xyXG5cclxudHlwZSBnZXRJZGVhbFRlcm1UeXBlID0gKCByYXRpb1Rlcm06IFJhdGlvVGVybSApID0+IG51bWJlcjtcclxuXHJcbnR5cGUgQm90aEhhbmRzSW50ZXJhY3Rpb25MaXN0ZW5lck9wdGlvbnMgPSB7XHJcblxyXG4gIC8vIE5vZGUgdG8gYWRkIGxpc3RlbmVycyB0b1xyXG4gIHRhcmdldE5vZGU6IE5vZGU7XHJcbiAgcmF0aW9UdXBsZVByb3BlcnR5OiBQcm9wZXJ0eTxSQVBSYXRpb1R1cGxlPjtcclxuICBhbnRlY2VkZW50SW50ZXJhY3RlZFdpdGhQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgY29uc2VxdWVudEludGVyYWN0ZWRXaXRoUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG4gIGVuYWJsZWRSYXRpb1Rlcm1zUmFuZ2VQcm9wZXJ0eTogUHJvcGVydHk8UmFuZ2U+O1xyXG4gIHRpY2tNYXJrUmFuZ2VQcm9wZXJ0eTogUHJvcGVydHk8bnVtYmVyPjtcclxuICBrZXlib2FyZFN0ZXA6IG51bWJlcjtcclxuICBib3VuZGFyeVNvdW5kQ2xpcDogQm91bmRhcnlTb3VuZENsaXA7XHJcbiAgdGlja01hcmtCdW1wU291bmRDbGlwOiBUaWNrTWFya0J1bXBTb3VuZENsaXA7XHJcbiAgcmF0aW9Mb2NrZWRQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgdGFyZ2V0UmF0aW9Qcm9wZXJ0eTogUHJvcGVydHk8bnVtYmVyPjtcclxuICBpblByb3BvcnRpb25Qcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgZ2V0SWRlYWxUZXJtOiBnZXRJZGVhbFRlcm1UeXBlO1xyXG5cclxuICAvLyBDYWxsZWQgd2hlbmV2ZXIgYW4gaW50ZXJhY3Rpb24gb2NjdXJzIHRoYXQgdGhpcyBsaXN0ZW5lciByZXNwb25kcyB0bywgZXZlbiBpZiBub3QgY2hhbmdlIG9jY3VycyB0byB0aGUgcmF0aW8uXHJcbiAgb25JbnB1dD86IE9uSW5wdXRUeXBlO1xyXG59O1xyXG5cclxuY2xhc3MgQm90aEhhbmRzSW50ZXJhY3Rpb25MaXN0ZW5lciB7XHJcblxyXG4gIHByaXZhdGUgdGFyZ2V0Tm9kZTogTm9kZTtcclxuICBwcml2YXRlIGFudGVjZWRlbnRJbnRlcmFjdGVkV2l0aFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICBwcml2YXRlIGNvbnNlcXVlbnRJbnRlcmFjdGVkV2l0aFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICBwcml2YXRlIGVuYWJsZWRSYXRpb1Rlcm1zUmFuZ2VQcm9wZXJ0eTogUHJvcGVydHk8UmFuZ2U+O1xyXG4gIHByaXZhdGUgdGlja01hcmtSYW5nZVByb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+O1xyXG4gIHByaXZhdGUgcmF0aW9UdXBsZVByb3BlcnR5OiBQcm9wZXJ0eTxSQVBSYXRpb1R1cGxlPjtcclxuICBwcml2YXRlIGtleWJvYXJkU3RlcDogbnVtYmVyO1xyXG4gIHByaXZhdGUgc2hpZnRLZXlib2FyZFN0ZXA6IG51bWJlcjtcclxuICBwcml2YXRlIGJvdW5kYXJ5U291bmRDbGlwOiBCb3VuZGFyeVNvdW5kQ2xpcDtcclxuICBwcml2YXRlIHRpY2tNYXJrQnVtcFNvdW5kQ2xpcDogVGlja01hcmtCdW1wU291bmRDbGlwO1xyXG4gIHByaXZhdGUgcmF0aW9Mb2NrZWRQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgcHJpdmF0ZSB0YXJnZXRSYXRpb1Byb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+O1xyXG4gIHByaXZhdGUgaW5Qcm9wb3J0aW9uUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG4gIHByaXZhdGUgb25JbnB1dDogT25JbnB1dFR5cGU7XHJcbiAgcHJpdmF0ZSBhbnRlY2VkZW50TWFwS2V5Ym9hcmRJbnB1dDogS2V5Ym9hcmRJbnB1dE1hcHBlcjtcclxuICBwcml2YXRlIGNvbnNlcXVlbnRNYXBLZXlib2FyZElucHV0OiBLZXlib2FyZElucHV0TWFwcGVyO1xyXG5cclxuICAvLyB0cnVlIHdoZW5ldmVyIHRoZSB1c2VyIGlzIGludGVyYWN0aW5nIHdpdGggdGhpcyBsaXN0ZW5lclxyXG4gIHB1YmxpYyBpc0JlaW5nSW50ZXJhY3RlZFdpdGhQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIGNhbGxlZCB3aGVuIHRoaXMgaW5wdXQgb2NjdXJzIHdoZW4gdGhlIHJhdGlvIGlzIGxvY2tlZCB3aXRoIGEgdGFyZ2V0IG9mIE46Ti4gSnVtcGluZyB0byB6ZXJvIGlzIG5vdCBhbGxvd2VkIGZvclxyXG4gIC8vIHRoaXMgY2FzZSwgc2VlLCBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcmF0aW8tYW5kLXByb3BvcnRpb24vaXNzdWVzLzIyNyNpc3N1ZWNvbW1lbnQtNzU4MDM2NDU2XHJcbiAgcHVibGljIGp1bXBUb1plcm9XaGlsZUxvY2tlZEVtaXR0ZXI6IFRFbWl0dGVyO1xyXG5cclxuICAvLyBUaGUgY3VzdG9tIGp1bXBpbmcgbG9naWMgdXNlcyBzcGVjaWFsIGxvZ2ljIHRvIGRldGVybWluZSBpZiBqdW1waW5nIGNhdXNlZCBhIGJvdW5kYXJ5IHRvIGJlIGhpdC4gVGhhdCBvY2N1cnMgaW5cclxuICAvLyBrZXlkb3duLCBidXQgd2Ugd2FudCB0aGUgc291bmQgb25seSB0byBwbGF5IG9uY2Ugb24ga2V5dXAuIFVzZSB0aGlzIGFzIGEgbWFya2VyIHRvIHNpZ25pZnkgdGhhdCB0aGUgYm91bmRhcnlcclxuICAvLyBzb3VuZCBzaG91bGQgYmUgcGxheWVkLlxyXG4gIHByaXZhdGUgcGxheUJvdW5kYXJ5U291bmRPbktleXVwOiBib29sZWFuO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3ZpZGVkT3B0aW9uczogQm90aEhhbmRzSW50ZXJhY3Rpb25MaXN0ZW5lck9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxCb3RoSGFuZHNJbnRlcmFjdGlvbkxpc3RlbmVyT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgb25JbnB1dDogb25JbnB1dERlZmF1bHRcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApIGFzIFJlcXVpcmVkPEJvdGhIYW5kc0ludGVyYWN0aW9uTGlzdGVuZXJPcHRpb25zPjtcclxuXHJcbiAgICB0aGlzLnRhcmdldE5vZGUgPSBvcHRpb25zLnRhcmdldE5vZGU7XHJcbiAgICB0aGlzLnJhdGlvVHVwbGVQcm9wZXJ0eSA9IG9wdGlvbnMucmF0aW9UdXBsZVByb3BlcnR5O1xyXG4gICAgdGhpcy5hbnRlY2VkZW50SW50ZXJhY3RlZFdpdGhQcm9wZXJ0eSA9IG9wdGlvbnMuYW50ZWNlZGVudEludGVyYWN0ZWRXaXRoUHJvcGVydHk7XHJcbiAgICB0aGlzLmNvbnNlcXVlbnRJbnRlcmFjdGVkV2l0aFByb3BlcnR5ID0gb3B0aW9ucy5jb25zZXF1ZW50SW50ZXJhY3RlZFdpdGhQcm9wZXJ0eTtcclxuICAgIHRoaXMuZW5hYmxlZFJhdGlvVGVybXNSYW5nZVByb3BlcnR5ID0gb3B0aW9ucy5lbmFibGVkUmF0aW9UZXJtc1JhbmdlUHJvcGVydHk7XHJcbiAgICB0aGlzLnRpY2tNYXJrUmFuZ2VQcm9wZXJ0eSA9IG9wdGlvbnMudGlja01hcmtSYW5nZVByb3BlcnR5O1xyXG4gICAgdGhpcy5rZXlib2FyZFN0ZXAgPSBvcHRpb25zLmtleWJvYXJkU3RlcDtcclxuICAgIHRoaXMuc2hpZnRLZXlib2FyZFN0ZXAgPSB0aGlzLmtleWJvYXJkU3RlcCAqIHJhcENvbnN0YW50cy5TSElGVF9LRVlfTVVMVElQTElFUjtcclxuICAgIHRoaXMuYm91bmRhcnlTb3VuZENsaXAgPSBvcHRpb25zLmJvdW5kYXJ5U291bmRDbGlwO1xyXG4gICAgdGhpcy50aWNrTWFya0J1bXBTb3VuZENsaXAgPSBvcHRpb25zLnRpY2tNYXJrQnVtcFNvdW5kQ2xpcDtcclxuICAgIHRoaXMucmF0aW9Mb2NrZWRQcm9wZXJ0eSA9IG9wdGlvbnMucmF0aW9Mb2NrZWRQcm9wZXJ0eTtcclxuICAgIHRoaXMudGFyZ2V0UmF0aW9Qcm9wZXJ0eSA9IG9wdGlvbnMudGFyZ2V0UmF0aW9Qcm9wZXJ0eTtcclxuICAgIHRoaXMuaW5Qcm9wb3J0aW9uUHJvcGVydHkgPSBvcHRpb25zLmluUHJvcG9ydGlvblByb3BlcnR5O1xyXG4gICAgdGhpcy5vbklucHV0ID0gb3B0aW9ucy5vbklucHV0O1xyXG5cclxuICAgIHRoaXMuYW50ZWNlZGVudE1hcEtleWJvYXJkSW5wdXQgPSBnZXRLZXlib2FyZElucHV0U25hcHBpbmdNYXBwZXIoXHJcbiAgICAgICgpID0+IG9wdGlvbnMuZ2V0SWRlYWxUZXJtKCBSYXRpb1Rlcm0uQU5URUNFREVOVCApLCBvcHRpb25zLmtleWJvYXJkU3RlcCwgdGhpcy5zaGlmdEtleWJvYXJkU3RlcCApO1xyXG4gICAgdGhpcy5jb25zZXF1ZW50TWFwS2V5Ym9hcmRJbnB1dCA9IGdldEtleWJvYXJkSW5wdXRTbmFwcGluZ01hcHBlcihcclxuICAgICAgKCkgPT4gb3B0aW9ucy5nZXRJZGVhbFRlcm0oIFJhdGlvVGVybS5DT05TRVFVRU5UICksIG9wdGlvbnMua2V5Ym9hcmRTdGVwLCB0aGlzLnNoaWZ0S2V5Ym9hcmRTdGVwICk7XHJcblxyXG4gICAgdGhpcy5pc0JlaW5nSW50ZXJhY3RlZFdpdGhQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlICk7XHJcbiAgICB0aGlzLmp1bXBUb1plcm9XaGlsZUxvY2tlZEVtaXR0ZXIgPSBuZXcgRW1pdHRlcigpO1xyXG4gICAgdGhpcy5wbGF5Qm91bmRhcnlTb3VuZE9uS2V5dXAgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMuYW50ZWNlZGVudE1hcEtleWJvYXJkSW5wdXQucmVzZXQoKTtcclxuICAgIHRoaXMuY29uc2VxdWVudE1hcEtleWJvYXJkSW5wdXQucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnNpc3RlbnRseSBoYW5kbGUgY2hhbmdpbmcgdGhlIHJhdGlvIGZyb20gaW5jcmVtZW50L2RlY3JlbWVudFxyXG4gICAqIEBwYXJhbSByYXRpb1Rlcm0gLSB3aGF0IGZpZWxkIG9mIHRoZSBSQVBSYXRpb1R1cGxlIGFyZSB3ZSBjaGFuZ2luZ1xyXG4gICAqIEBwYXJhbSBpbnB1dE1hcHBlciAtIHNlZSBnZXRLZXlib2FyZElucHV0U25hcHBpbmdNYXBwZXJcclxuICAgKiBAcGFyYW0gaW5jcmVtZW50IC0gaWYgdGhlIHZhbHVlIGlzIGJlaW5nIGluY3JlbWVudGVkLCBhcyBvcHBvc2VkIHRvIGRlY3JlbWVudGVkLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgb25WYWx1ZUluY3JlbWVudERlY3JlbWVudCggcmF0aW9UZXJtOiBSYXRpb1Rlcm0sIGlucHV0TWFwcGVyOiBLZXlib2FyZElucHV0TWFwcGVyLCBpbmNyZW1lbnQ6IGJvb2xlYW4gKTogdm9pZCB7XHJcbiAgICB0aGlzLmlzQmVpbmdJbnRlcmFjdGVkV2l0aFByb3BlcnR5LnZhbHVlID0gdHJ1ZTtcclxuICAgIGNvbnN0IGN1cnJlbnRWYWx1ZUZyb21UdXBsZSA9IHRoaXMucmF0aW9UdXBsZVByb3BlcnR5LnZhbHVlLmdldEZvclRlcm0oIHJhdGlvVGVybSApO1xyXG5cclxuICAgIGNvbnN0IGNoYW5nZUFtb3VudCA9IGdsb2JhbEtleVN0YXRlVHJhY2tlci5zaGlmdEtleURvd24gPyB0aGlzLnNoaWZ0S2V5Ym9hcmRTdGVwIDogdGhpcy5rZXlib2FyZFN0ZXA7XHJcbiAgICBjb25zdCB2YWx1ZURlbHRhID0gY2hhbmdlQW1vdW50ICogKCBpbmNyZW1lbnQgPyAxIDogLTEgKTtcclxuXHJcbiAgICAvLyBCZWNhdXNlIHRoaXMgaW50ZXJhY3Rpb24gdXNlcyB0aGUga2V5Ym9hcmQsIHNuYXAgdG8gdGhlIGtleWJvYXJkIHN0ZXAgdG8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSBoYW5kcyB3ZXJlXHJcbiAgICAvLyBwcmV2aW91c2x5IG1vdmVkIHZpYSBtb3VzZS90b3VjaC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9yYXRpby1hbmQtcHJvcG9ydGlvbi9pc3N1ZXMvMTU2XHJcbiAgICBjb25zdCBuZXdWYWx1ZSA9IGlucHV0TWFwcGVyKCBjdXJyZW50VmFsdWVGcm9tVHVwbGUgKyB2YWx1ZURlbHRhLCBjdXJyZW50VmFsdWVGcm9tVHVwbGUsIGdsb2JhbEtleVN0YXRlVHJhY2tlci5zaGlmdEtleURvd24sIHRoaXMuaW5Qcm9wb3J0aW9uUHJvcGVydHkudmFsdWUgKTtcclxuICAgIGNvbnN0IG5ld1JhdGlvVHVwbGUgPSB0aGlzLnJhdGlvVHVwbGVQcm9wZXJ0eS52YWx1ZS53aXRoVmFsdWVGb3JUZXJtKCBuZXdWYWx1ZSwgcmF0aW9UZXJtICk7XHJcblxyXG4gICAgdGhpcy5yYXRpb1R1cGxlUHJvcGVydHkudmFsdWUgPSBuZXdSYXRpb1R1cGxlLmNvbnN0cmFpbkZpZWxkcyggdGhpcy5lbmFibGVkUmF0aW9UZXJtc1JhbmdlUHJvcGVydHkudmFsdWUgKTtcclxuXHJcbiAgICB0aGlzLnRpY2tNYXJrQnVtcFNvdW5kQ2xpcC5vbkludGVyYWN0KCB0aGlzLnJhdGlvVHVwbGVQcm9wZXJ0eS52YWx1ZS5nZXRGb3JUZXJtKCByYXRpb1Rlcm0gKSApO1xyXG5cclxuICAgIHRoaXMub25JbnB1dCggcmF0aW9UZXJtICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYmx1cigpOiB2b2lkIHtcclxuICAgIHRoaXMuaXNCZWluZ0ludGVyYWN0ZWRXaXRoUHJvcGVydHkudmFsdWUgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBrZXlkb3duKCBzY2VuZXJ5RXZlbnQ6IFNjZW5lcnlFdmVudCApOiB2b2lkIHtcclxuXHJcbiAgICBpZiAoIHNjZW5lcnlFdmVudC50YXJnZXQgPT09IHRoaXMudGFyZ2V0Tm9kZSApIHtcclxuXHJcbiAgICAgIC8vIHNpZ25pZnkgdGhhdCB0aGlzIGxpc3RlbmVyIGlzIHJlc2VydmVkIGZvciBrZXlib2FyZCBtb3ZlbWVudCBzbyB0aGF0IG90aGVyIGxpc3RlbmVycyBjYW4gY2hhbmdlXHJcbiAgICAgIC8vIHRoZWlyIGJlaGF2aW9yIGR1cmluZyBzY2VuZXJ5IGV2ZW50IGRpc3BhdGNoXHJcbiAgICAgIHNjZW5lcnlFdmVudC5wb2ludGVyLnJlc2VydmVGb3JLZXlib2FyZERyYWcoKTtcclxuXHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHNjZW5lcnlFdmVudC5kb21FdmVudCwgJ2RvbSBldmVudCBleHBlY3RlZCcgKTtcclxuICAgICAgY29uc3QgZG9tRXZlbnQgPSBzY2VuZXJ5RXZlbnQuZG9tRXZlbnQgYXMgS2V5Ym9hcmRFdmVudDtcclxuICAgICAgY29uc3Qga2V5ID0gS2V5Ym9hcmRVdGlscy5nZXRFdmVudENvZGUoIGRvbUV2ZW50ICk7XHJcblxyXG4gICAgICBpZiAoIGtleSA9PT0gS2V5Ym9hcmRVdGlscy5LRVlfRE9XTl9BUlJPVyApIHtcclxuICAgICAgICB0aGlzLmNvbnNlcXVlbnRJbnRlcmFjdGVkV2l0aFByb3BlcnR5LnZhbHVlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLm9uVmFsdWVJbmNyZW1lbnREZWNyZW1lbnQoIFJhdGlvVGVybS5DT05TRVFVRU5ULCB0aGlzLmNvbnNlcXVlbnRNYXBLZXlib2FyZElucHV0LCBmYWxzZSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBrZXkgPT09IEtleWJvYXJkVXRpbHMuS0VZX1VQX0FSUk9XICkge1xyXG4gICAgICAgIHRoaXMub25WYWx1ZUluY3JlbWVudERlY3JlbWVudCggUmF0aW9UZXJtLkNPTlNFUVVFTlQsIHRoaXMuY29uc2VxdWVudE1hcEtleWJvYXJkSW5wdXQsIHRydWUgKTtcclxuICAgICAgICB0aGlzLmNvbnNlcXVlbnRJbnRlcmFjdGVkV2l0aFByb3BlcnR5LnZhbHVlID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICgga2V5ID09PSBLZXlib2FyZFV0aWxzLktFWV9XICkge1xyXG4gICAgICAgIHRoaXMuYW50ZWNlZGVudEludGVyYWN0ZWRXaXRoUHJvcGVydHkudmFsdWUgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMub25WYWx1ZUluY3JlbWVudERlY3JlbWVudCggUmF0aW9UZXJtLkFOVEVDRURFTlQsIHRoaXMuYW50ZWNlZGVudE1hcEtleWJvYXJkSW5wdXQsIHRydWUgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICgga2V5ID09PSBLZXlib2FyZFV0aWxzLktFWV9TICkge1xyXG4gICAgICAgIHRoaXMuYW50ZWNlZGVudEludGVyYWN0ZWRXaXRoUHJvcGVydHkudmFsdWUgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMub25WYWx1ZUluY3JlbWVudERlY3JlbWVudCggUmF0aW9UZXJtLkFOVEVDRURFTlQsIHRoaXMuYW50ZWNlZGVudE1hcEtleWJvYXJkSW5wdXQsIGZhbHNlICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgIC8vIGZvciBudW1iZXIga2V5cyAwLTksIGp1bXAgYm90aCB2YWx1ZXMgdG8gdGhhdCB0aWNrIG1hcmsgbnVtYmVyLiBUaGlzIHZhbHVlIGNoYW5nZXMgYmFzZWQgb24gdGhlIHRpY2tNYXJrUmFuZ2VQcm9wZXJ0eVxyXG4gICAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8PSA5OyBpKysgKSB7XHJcbiAgICAgICAgICBpZiAoIEtleWJvYXJkVXRpbHMuZ2V0TnVtYmVyRnJvbUNvZGUoIGRvbUV2ZW50ICkgPT09IGkgJiZcclxuICAgICAgICAgICAgICAgIWRvbUV2ZW50LmdldE1vZGlmaWVyU3RhdGUoICdDb250cm9sJyApICYmXHJcbiAgICAgICAgICAgICAgICFkb21FdmVudC5nZXRNb2RpZmllclN0YXRlKCAnU2hpZnQnICkgJiZcclxuICAgICAgICAgICAgICAgIWRvbUV2ZW50LmdldE1vZGlmaWVyU3RhdGUoICdBbHQnICkgKSB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmlzQmVpbmdJbnRlcmFjdGVkV2l0aFByb3BlcnR5LnZhbHVlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIC8vIElmIHRoZSByYXRpbyBpcyBsb2NrZWQsIGFuZCB0aGUgdGFyZ2V0IGlzIDEsIHRoaXMgY2FzZSBtZWFucyB0aGF0IGdvaW5nIHRvIDA6MCB3b3VsZCBiZSBhIGJ1Z2d5IGNhc2UuXHJcbiAgICAgICAgICAgIC8vIEhlcmUgd2Ugd2lsbCBqdXN0IGRpc2FibGUgdGhpcyBmZWF0dXJlLlxyXG4gICAgICAgICAgICBpZiAoIHRoaXMucmF0aW9Mb2NrZWRQcm9wZXJ0eS52YWx1ZSAmJiB0aGlzLnRhcmdldFJhdGlvUHJvcGVydHkudmFsdWUgPT09IDEgJiYgaSA9PT0gMCApIHtcclxuICAgICAgICAgICAgICB0aGlzLmp1bXBUb1plcm9XaGlsZUxvY2tlZEVtaXR0ZXIuZW1pdCgpO1xyXG4gICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3Qgd2FzTG9ja2VkID0gdGhpcy5yYXRpb0xvY2tlZFByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgLy8gdW5sb2NrIHRoZSByYXRpbyBiZWNhdXNlIHdlIGFyZSBzbmFwcGluZyBvdXQgb2YgbG9ja2VkIHJhdGlvLCBpZiB0YXJnZXQgaXMgMSwgdGhlbiB3ZSBhcmUgbWFpbnRhaW5pbmdcclxuICAgICAgICAgICAgLy8gdGhhdCByYXRpbyB3aXRoIHRoaXMgaW5wdXQgYW5kIHdlIGNhbiBrZWVwIHRoZSByYXRpbyBsb2NrZWQuXHJcbiAgICAgICAgICAgIGlmICggd2FzTG9ja2VkICYmIHRoaXMudGFyZ2V0UmF0aW9Qcm9wZXJ0eS52YWx1ZSAhPT0gMSApIHtcclxuICAgICAgICAgICAgICB0aGlzLnJhdGlvTG9ja2VkUHJvcGVydHkudmFsdWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gY2FwdHVyZSBub3cgYmVmb3JlIGFsdGVyaW5nIHRoZSByYXRpbyBsb2NrZWRQcm9wZXJ0eSBjaGFuZ2VzIGl0XHJcbiAgICAgICAgICAgIGNvbnN0IHJhbmdlRm9yQ29uc3RyYWluaW5nID0gdGhpcy5lbmFibGVkUmF0aW9UZXJtc1JhbmdlUHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IDEgLyB0aGlzLnRpY2tNYXJrUmFuZ2VQcm9wZXJ0eS52YWx1ZSAqIGk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnN0cmFpbmVkID0gcmFuZ2VGb3JDb25zdHJhaW5pbmcuY29uc3RyYWluVmFsdWUoIG5ld1ZhbHVlICk7XHJcbiAgICAgICAgICAgIHRoaXMucmF0aW9UdXBsZVByb3BlcnR5LnZhbHVlID0gbmV3IFJBUFJhdGlvVHVwbGUoIGNvbnN0cmFpbmVkLCBjb25zdHJhaW5lZCApO1xyXG5cclxuICAgICAgICAgICAgLy8gSWYgdGhpcyBicm91Z2h0IHRvIG1pbiBvciBtYXgsIHBsYXkgdGhlIGJvdW5kYXJ5IHNvdW5kXHJcbiAgICAgICAgICAgIGlmICggY29uc3RyYWluZWQgPT09IFRPVEFMX1JBTkdFLm1pbiB8fCBjb25zdHJhaW5lZCA9PT0gVE9UQUxfUkFOR0UubWF4ICkge1xyXG4gICAgICAgICAgICAgIHRoaXMucGxheUJvdW5kYXJ5U291bmRPbktleXVwID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSWYgdGhlIHRhcmdldCB3YXMgMSwgb3IgcGVyaGFwcyBhbm90aGVyIHdheSwgdGhlbiBzZXR0aW5nIGJvdGggdmFsdWVzIHNob3VsZCBtYWludGFpbiB0aGUgbG9ja2VkIHN0YXRlXHJcbiAgICAgICAgICAgIC8vIGlmIGl0IHdhcyBwcmV2aW91c2x5IGxvY2tlZC5cclxuICAgICAgICAgICAgYXNzZXJ0ICYmIHdhc0xvY2tlZCAmJiB0aGlzLnRhcmdldFJhdGlvUHJvcGVydHkudmFsdWUgPT09IDEgJiZcclxuICAgICAgICAgICAgYXNzZXJ0KCB0aGlzLnJhdGlvTG9ja2VkUHJvcGVydHkudmFsdWUsICdzaG91bGQgYmUgbG9ja2VkIHN0aWxsIGFmdGVyIHNldHRpbmcgYm90aCB2YWx1ZXMnICk7XHJcblxyXG5cclxuICAgICAgICAgICAgLy8gQ291bnQgbnVtYmVyIGtleSBpbnRlcmFjdGlvbiBhcyBjdWUtcmVtb3ZpbmcgaW50ZXJhY3Rpb24uXHJcbiAgICAgICAgICAgIHRoaXMuYW50ZWNlZGVudEludGVyYWN0ZWRXaXRoUHJvcGVydHkudmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnNlcXVlbnRJbnRlcmFjdGVkV2l0aFByb3BlcnR5LnZhbHVlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIC8vIEV4dHJhIGFyZyBoZXJlIGJlY2F1c2UgdGhpcyBpbnB1dCBjYW4gXCJrbm9ja1wiIHRoZSByYXRpbyBvdXQgb2YgbG9ja2VkIG1vZGUsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcmF0aW8tYW5kLXByb3BvcnRpb24vaXNzdWVzLzIyN1xyXG4gICAgICAgICAgICB0aGlzLm9uSW5wdXQoIFJhdGlvSW5wdXRNb2RhbGl0eS5CT1RIX0hBTkRTLCB3YXNMb2NrZWQgJiYgIXRoaXMucmF0aW9Mb2NrZWRQcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMga2V5dXAoIHNjZW5lcnlFdmVudDogU2NlbmVyeUV2ZW50ICk6IHZvaWQge1xyXG5cclxuICAgIGlmICggc2NlbmVyeUV2ZW50LnRhcmdldCA9PT0gdGhpcy50YXJnZXROb2RlICkge1xyXG5cclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggc2NlbmVyeUV2ZW50LmRvbUV2ZW50LCAnZG9tRXZlbnQgZXhwZWN0ZWQnICk7XHJcbiAgICAgIGNvbnN0IGRvbUV2ZW50ID0gc2NlbmVyeUV2ZW50LmRvbUV2ZW50ITtcclxuXHJcbiAgICAgIGlmICggS2V5Ym9hcmRVdGlscy5pc0FueUtleUV2ZW50KCBkb21FdmVudCwgWyBLZXlib2FyZFV0aWxzLktFWV9ET1dOX0FSUk9XLCBLZXlib2FyZFV0aWxzLktFWV9VUF9BUlJPVyBdICkgKSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVCb3VuZGFyeVNvdW5kT25JbnB1dCggdGhpcy5yYXRpb1R1cGxlUHJvcGVydHkudmFsdWUuY29uc2VxdWVudCApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBLZXlib2FyZFV0aWxzLmlzQW55S2V5RXZlbnQoIGRvbUV2ZW50LCBbIEtleWJvYXJkVXRpbHMuS0VZX1csIEtleWJvYXJkVXRpbHMuS0VZX1MgXSApICkge1xyXG4gICAgICAgIHRoaXMuaGFuZGxlQm91bmRhcnlTb3VuZE9uSW5wdXQoIHRoaXMucmF0aW9UdXBsZVByb3BlcnR5LnZhbHVlLmFudGVjZWRlbnQgKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIHRoaXMucGxheUJvdW5kYXJ5U291bmRPbktleXVwICkge1xyXG4gICAgICAgIHRoaXMuYm91bmRhcnlTb3VuZENsaXAucGxheSgpO1xyXG4gICAgICAgIHRoaXMucGxheUJvdW5kYXJ5U291bmRPbktleXVwID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhhbmRsZSBib3VuZGFyeSBzb3VuZCBvdXRwdXQgYmFzZWQgb24gYW4gaW5wdXQgZm9yIHRoaXMgaW50ZXJhY3Rpb25cclxuICAgKi9cclxuICBwdWJsaWMgaGFuZGxlQm91bmRhcnlTb3VuZE9uSW5wdXQoIG5ld1ZhbHVlOiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICB0aGlzLmJvdW5kYXJ5U291bmRDbGlwLm9uU3RhcnRJbnRlcmFjdGlvbigpO1xyXG4gICAgdGhpcy5ib3VuZGFyeVNvdW5kQ2xpcC5vbkludGVyYWN0KCBuZXdWYWx1ZSApO1xyXG4gICAgdGhpcy5ib3VuZGFyeVNvdW5kQ2xpcC5vbkVuZEludGVyYWN0aW9uKCBuZXdWYWx1ZSApO1xyXG4gIH1cclxufVxyXG5cclxucmF0aW9BbmRQcm9wb3J0aW9uLnJlZ2lzdGVyKCAnQm90aEhhbmRzSW50ZXJhY3Rpb25MaXN0ZW5lcicsIEJvdGhIYW5kc0ludGVyYWN0aW9uTGlzdGVuZXIgKTtcclxuZXhwb3J0IHR5cGUgeyBnZXRJZGVhbFRlcm1UeXBlIH07XHJcbmV4cG9ydCBkZWZhdWx0IEJvdGhIYW5kc0ludGVyYWN0aW9uTGlzdGVuZXI7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxPQUFPLE1BQU0sZ0NBQWdDO0FBQ3BELFNBQVNDLHFCQUFxQixFQUFFQyxhQUFhLFFBQTRCLG1DQUFtQztBQUM1RyxPQUFPQyxrQkFBa0IsTUFBTSw2QkFBNkI7QUFDNUQsT0FBT0MsYUFBYSxNQUFNLDJCQUEyQjtB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