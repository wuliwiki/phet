// Copyright 2014-2023, University of Colorado Boulder

/**
 * RectangularRadioButton is a single rectangular radio button. It typically appears as part of a
 * RectangularRadioButtonGroup, but can be used in other context.
 *
 * @author Aaron Davis (PhET Interactive Simulations)
 */

import Emitter from '../../../axon/js/Emitter.js';
import optionize from '../../../phet-core/js/optionize.js';
import { Color, PaintColorProperty } from '../../../scenery/js/imports.js';
import pushButtonSoundPlayer from '../../../tambo/js/shared-sound-players/pushButtonSoundPlayer.js';
import EventType from '../../../tandem/js/EventType.js';
import PhetioObject from '../../../tandem/js/PhetioObject.js';
import Tandem from '../../../tandem/js/Tandem.js';
import ColorConstants from '../ColorConstants.js';
import sun from '../sun.js';
import ButtonModel from './ButtonModel.js';
import RadioButtonInteractionState from './RadioButtonInteractionState.js';
import RadioButtonInteractionStateProperty from './RadioButtonInteractionStateProperty.js';
import RectangularButton from './RectangularButton.js';
export default class RectangularRadioButton extends RectangularButton {
  // the Property this button changes

  // the value that is set to the Property when this button is pressed

  static TANDEM_NAME_SUFFIX = 'RadioButton';

  /**
   * @param property - axon Property that can take on a set of values, one for each radio button in the group
   * @param value - value when this radio button is selected
   * @param providedOptions
   */
  constructor(property, value, providedOptions) {
    const options = optionize()({
      // SelfOptions
      soundPlayer: null,
      // RectangularButtonOptions
      baseColor: ColorConstants.LIGHT_BLUE,
      buttonAppearanceStrategy: RectangularRadioButton.FlatAppearanceStrategy,
      buttonAppearanceStrategyOptions: {
        overButtonOpacity: 0.8,
        overStroke: null,
        selectedStroke: Color.BLACK,
        selectedLineWidth: 1.5,
        selectedButtonOpacity: 1,
        deselectedStroke: new Color(50, 50, 50),
        deselectedLineWidth: 1,
        deselectedButtonOpacity: 0.6
      },
      contentAppearanceStrategy: RectangularRadioButton.ContentAppearanceStrategy,
      contentAppearanceStrategyOptions: {
        overContentOpacity: 0.8,
        selectedContentOpacity: 1,
        deselectedContentOpacity: 0.6
      },
      // pdom
      tagName: 'input',
      inputType: 'radio',
      labelTagName: 'label',
      containerTagName: 'li',
      appendDescription: true,
      appendLabel: true,
      // phet-io
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'Button',
      phetioReadOnly: PhetioObject.DEFAULT_OPTIONS.phetioReadOnly // to support properly passing this to children, see https://github.com/phetsims/tandem/issues/60
    }, providedOptions);
    assert && assert(!options.tandem.supplied || options.tandem.name.endsWith(RectangularRadioButton.TANDEM_NAME_SUFFIX), `RectangularRadioButton tandem.name must end with ${RectangularRadioButton.TANDEM_NAME_SUFFIX}: ${options.tandem.phetioID}`);

    // Note it shares a tandem with this, so the emitter will be instrumented as a child of the button
    const buttonModel = new ButtonModel({
      tandem: options.tandem
    });
    const interactionStateProperty = new RadioButtonInteractionStateProperty(buttonModel, property, value);
    super(buttonModel, interactionStateProperty, options);

    // for use in RectangularRadioButtonGroup for managing the labels
    this.interactionStateProperty = interactionStateProperty;

    // pdom - Specify the default value for assistive technology, this attribute is needed in addition to
    // the 'checked' Property to mark this element as the default selection since 'checked' may be set before
    // we are finished adding RectangularRadioButtons to the RectangularRadioButtonGroup.
    if (property.value === value) {
      this.setPDOMAttribute('checked', 'checked');
    }

    // pdom - when the Property changes, make sure the correct radio button is marked as 'checked' so that this button
    // receives focus on 'tab'
    const pdomCheckedListener = newValue => {
      this.pdomChecked = newValue === value;
    };
    property.link(pdomCheckedListener);
    this.property = property;
    this.value = value;
    this.firedEmitter = new Emitter({
      tandem: options.tandem.createTandem('firedEmitter'),
      phetioDocumentation: 'Emits when the radio button is pressed',
      phetioReadOnly: options.phetioReadOnly,
      phetioEventType: EventType.USER
    });
    this.firedEmitter.addListener(() => property.set(value));

    // When the button model triggers an event, fire from the radio button
    buttonModel.downProperty.link(down => {
      if (!down && (buttonModel.overProperty.get() || buttonModel.focusedProperty.get()) && !buttonModel.interrupted) {
        this.fire();
        this.voicingSpeakFullResponse({
          hintResponse: null
        });
      }
    });

    // sound generation
    const soundPlayer = options.soundPlayer || pushButtonSoundPlayer;
    const playSound = () => {
      soundPlayer.play();
    };
    buttonModel.produceSoundEmitter.addListener(playSound);
    this.disposeRectangularRadioButton = () => {
      property.unlink(pdomCheckedListener);
      this.firedEmitter.dispose();
      buttonModel.produceSoundEmitter.removeListener(playSound);
      buttonModel.dispose();
      this.interactionStateProperty.dispose();
    };
  }
  dispose() {
    this.disposeRectangularRadioButton();
    super.dispose();
  }

  /**
   * fire on up if the button is enabled, public for use in the accessibility tree
   */
  fire() {
    if (this.buttonModel.enabledProperty.get()) {
      this.firedEmitter.emit();
      this.buttonModel.produceSoundEmitter.emit();
    }
  }

  /**
   * FlatAppearanceStrategy is a value for RectangularRadioButton options.buttonAppearanceStrategy. It makes radio buttons
   * that look flat, i.e. no shading or highlighting, but that change color on mouseover, press, selected, etc.
   */
  static FlatAppearanceStrategy = class FlatAppearanceStrategy {
    /**
     * buttonBackground is the Node for the button's background, sans content
     */
    constructor(buttonBackground, interactionStateProperty, baseColorProperty, providedOptions) {
      const options = optionize()({
        stroke: baseColorProperty,
        lineWidth: 1,
        deselectedButtonOpacity: 1,
        deselectedLineWidth: 1,
        deselectedStroke: 'gray',
        overButtonOpacity: 0.8,
        overFill: null,
        overLineWidth: 0,
        overStroke: null,
        selectedButtonOpacity: 1,
        selectedLineWidth: 1,
        selectedStroke: 'black'
      }, providedOptions);

      // Dynamic fills and strokes
      const pressedFillProperty = new PaintColorProperty(baseColorProperty, {
        luminanceFactor: -0.4
      });
      const overFillProperty = new PaintColorProperty(options.overFill || baseColorProperty, {
        luminanceFactor: providedOptions && providedOptions.overFill ? 0 : 0.4
      });

      // Editorial Note: The code below, where the deselected stroke is used as the value for the over stroke if no over
      // stroke is provided, seems a bit odd.  However, I (jbphet) tried removing it when refactoring this to support
      // TypeScript, and a number of sims broke.  The code was reviewed and discussed with some other devs, and we
      // decided to leave it as is, despite it being a bit unintuitive.  See https://github.com/phetsims/sun/issues/772.
      const overStrokeProperty = new PaintColorProperty(options.overStroke || options.deselectedStroke, {
        luminanceFactor: providedOptions && providedOptions.overStroke ? 0 : -0.4
      });
      this.maxLineWidth = Math.max(options.selectedLineWidth, options.deselectedLineWidth, options.overLineWidth);

      // Cache colors
      buttonBackground.cachedPaints = [baseColorProperty, overFillProperty, pressedFillProperty, overStrokeProperty, options.selectedStroke, options.deselectedStroke];

      // Change colors and opacity to match interactionState
      function interactionStateListener(interactionState) {
        switch (interactionState) {
          case RadioButtonInteractionState.SELECTED:
            buttonBackground.fill = baseColorProperty;
            buttonBackground.stroke = options.selectedStroke;
            buttonBackground.lineWidth = options.selectedLineWidth;
            buttonBackground.opacity = options.selectedButtonOpacity;
            break;
          case RadioButtonInteractionState.DESELECTED:
            buttonBackground.fill = baseColorProperty;
            buttonBackground.stroke = options.deselectedStroke;
            buttonBackground.lineWidth = options.deselectedLineWidth;
            buttonBackground.opacity = options.deselectedButtonOpacity;
            break;
          case RadioButtonInteractionState.OVER:
            buttonBackground.fill = overFillProperty;
            buttonBackground.stroke = overStrokeProperty;
            buttonBackground.lineWidth = Math.max(options.overLineWidth, options.deselectedLineWidth);
            buttonBackground.opacity = options.overButtonOpacity;
            break;
          case RadioButtonInteractionState.PRESSED:
            buttonBackground.fill = pressedFillProperty;
            buttonBackground.stroke = options.deselectedStroke;
            buttonBackground.lineWidth = options.deselectedLineWidth;
            buttonBackground.opacity = options.selectedButtonOpacity;
            break;
          default:
            throw new Error(`unsupported interactionState: ${interactionState}`);
        }
      }
      interactionStateProperty.link(interactionStateListener);
      this.disposeFlatAppearanceStrategy = () => {
        if (interactionStateProperty.hasListener(interactionStateListener)) {
          interactionStateProperty.unlink(interactionStateListener);
        }
        overStrokeProperty.dispose();
        overFillProperty.dispose();
        pressedFillProperty.dispose();
      };
    }
    dispose() {
      this.disposeFlatAppearanceStrategy();
    }
  };

  /**
   * ContentAppearanceStrategy is a value for RectangularRadioButton options.contentAppearanceStrategy. It changes
   * their look based on the value of interactionStateProperty.
   */
  static ContentAppearanceStrategy = class ContentAppearanceStrategy {
    constructor(content, interactionStateProperty, providedOptions) {
      const options = optionize()({
        deselectedContentOpacity: 1,
        overContentOpacity: 1,
        selectedContentOpacity: 1
      }, providedOptions);

      // The button is not the parent of the content, therefore it is necessary to set the opacity on the content separately
      function handleInteractionStateChanged(state) {
        if (content !== null) {
          switch (state) {
            case RadioButtonInteractionState.DESELECTED:
              content.opacity = options.deselectedContentOpacity;
              break;

            // mouseover for deselected buttons
            case RadioButtonInteractionState.OVER:
              content.opacity = options.overContentOpacity;
              break;
            case RadioButtonInteractionState.SELECTED:
              content.opacity = options.selectedContentOpacity;
              break;
            case RadioButtonInteractionState.PRESSED:
              content.opacity = options.deselectedContentOpacity;
              break;
            default:
              throw new Error(`unsupported state: ${state}`);
          }
        }
      }
      interactionStateProperty.link(handleInteractionStateChanged);
      this.disposeContentAppearanceStrategy = () => {
        if (interactionStateProperty.hasListener(handleInteractionStateChanged)) {
          interactionStateProperty.unlink(handleInteractionStateChanged);
        }
      };
    }
    dispose() {
      this.disposeContentAppearanceStrategy();
    }
  };
}
sun.register('RectangularRadioButton', RectangularRadioButton);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFbWl0dGVyIiwib3B0aW9uaXplIiwiQ29sb3IiLCJQYWludENvbG9yUHJvcGVydHkiLCJwdXNoQnV0dG9uU291bmRQbGF5ZXIiLCJFdmVudFR5cGUiLCJQaGV0aW9PYmplY3QiLCJUYW5kZW0iLCJDb2xvckNvbnN0YW50cyIsInN1biIsIkJ1dHRvbk1vZGVsIiwiUmFkaW9CdXR0b25JbnRlcmFjdGlvblN0YXRlIiwiUmFkaW9CdXR0b25JbnRlcmFjdGlvblN0YXRlUHJvcGVydHkiLCJSZWN0YW5ndWxhckJ1dHRvbiIsIlJlY3Rhbmd1bGFyUmFkaW9CdXR0b24iLCJUQU5ERU1fTkFNRV9TVUZGSVgiLCJjb25zdHJ1Y3RvciIsInByb3BlcnR5IiwidmFsdWUiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwic291bmRQbGF5ZXIiLCJiYXNlQ29sb3IiLCJMSUdIVF9CTFVFIiwiYnV0dG9uQXBwZWFyYW5jZVN0cmF0ZWd5IiwiRmxhdEFwcGVhcmFuY2VTdHJhdGVneSIsImJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneU9wdGlvbnMiLCJvdmVyQnV0dG9uT3BhY2l0eSIsIm92ZXJTdHJva2UiLCJzZWxlY3RlZFN0cm9rZSIsIkJMQUNLIiwic2VsZWN0ZWRMaW5lV2lkdGgiLCJzZWxlY3RlZEJ1dHRvbk9wYWNpdHkiLCJkZXNlbGVjdGVkU3Ryb2tlIiwiZGVzZWxlY3RlZExpbmVXaWR0aCIsImRlc2VsZWN0ZWRCdXR0b25PcGFjaXR5IiwiY29udGVudEFwcGVhcmFuY2VTdHJhdGVneSIsIkNvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3kiLCJjb250ZW50QXBwZWFyYW5jZVN0cmF0ZWd5T3B0aW9ucyIsIm92ZXJDb250ZW50T3BhY2l0eSIsInNlbGVjdGVkQ29udGVudE9wYWNpdHkiLCJkZXNlbGVjdGVkQ29udGVudE9wYWNpdHkiLCJ0YWdOYW1lIiwiaW5wdXRUeXBlIiwibGFiZWxUYWdOYW1lIiwiY29udGFpbmVyVGFnTmFtZSIsImFwcGVuZERlc2NyaXB0aW9uIiwiYXBwZW5kTGFiZWwiLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInRhbmRlbU5hbWVTdWZmaXgiLCJwaGV0aW9SZWFkT25seSIsIkRFRkFVTFRfT1BUSU9OUyIsImFzc2VydCIsInN1cHBsaWVkIiwibmFtZSIsImVuZHNXaXRoIiwicGhldGlvSUQiLCJidXR0b25Nb2RlbCIsImludGVyYWN0aW9uU3RhdGVQcm9wZXJ0eSIsInNldFBET01BdHRyaWJ1dGUiLCJwZG9tQ2hlY2tlZExpc3RlbmVyIiwibmV3VmFsdWUiLCJwZG9tQ2hlY2tlZCIsImxpbmsiLCJmaXJlZEVtaXR0ZXIiLCJjcmVhdGVUYW5kZW0iLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwicGhldGlvRXZlbnRUeXBlIiwiVVNFUiIsImFkZExpc3RlbmVyIiwic2V0IiwiZG93blByb3BlcnR5IiwiZG93biIsIm92ZXJQcm9wZXJ0eSIsImdldCIsImZvY3VzZWRQcm9wZXJ0eSIsImludGVycnVwdGVkIiwiZmlyZSIsInZvaWNpbmdTcGVha0Z1bGxSZXNwb25zZSIsImhpbnRSZXNwb25zZSIsInBsYXlTb3VuZCIsInBsYXkiLCJwcm9kdWNlU291bmRFbWl0dGVyIiwiZGlzcG9zZVJlY3Rhbmd1bGFyUmFkaW9CdXR0b24iLCJ1bmxpbmsiLCJkaXNwb3NlIiwicmVtb3ZlTGlzdGVuZXIiLCJlbmFibGVkUHJvcGVydHkiLCJlbWl0IiwiYnV0dG9uQmFja2dyb3VuZCIsImJhc2VDb2xvclByb3BlcnR5Iiwic3Ryb2tlIiwibGluZVdpZHRoIiwib3ZlckZpbGwiLCJvdmVyTGluZVdpZHRoIiwicHJlc3NlZEZpbGxQcm9wZXJ0eSIsImx1bWluYW5jZUZhY3RvciIsIm92ZXJGaWxsUHJvcGVydHkiLCJvdmVyU3Ryb2tlUHJvcGVydHkiLCJtYXhMaW5lV2lkdGgiLCJNYXRoIiwibWF4IiwiY2FjaGVkUGFpbnRzIiwiaW50ZXJhY3Rpb25TdGF0ZUxpc3RlbmVyIiwiaW50ZXJhY3Rpb25TdGF0ZSIsIlNFTEVDVEVEIiwiZmlsbCIsIm9wYWNpdHkiLCJERVNFTEVDVEVEIiwiT1ZFUiIsIlBSRVNTRUQiLCJFcnJvciIsImRpc3Bvc2VGbGF0QXBwZWFyYW5jZVN0cmF0ZWd5IiwiaGFzTGlzdGVuZXIiLCJjb250ZW50IiwiaGFuZGxlSW50ZXJhY3Rpb25TdGF0ZUNoYW5nZWQiLCJzdGF0ZSIsImRpc3Bvc2VDb250ZW50QXBwZWFyYW5jZVN0cmF0ZWd5IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJSZWN0YW5ndWxhclJhZGlvQnV0dG9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b24gaXMgYSBzaW5nbGUgcmVjdGFuZ3VsYXIgcmFkaW8gYnV0dG9uLiBJdCB0eXBpY2FsbHkgYXBwZWFycyBhcyBwYXJ0IG9mIGFcclxuICogUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwLCBidXQgY2FuIGJlIHVzZWQgaW4gb3RoZXIgY29udGV4dC5cclxuICpcclxuICogQGF1dGhvciBBYXJvbiBEYXZpcyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgRW1pdHRlciBmcm9tICcuLi8uLi8uLi9heG9uL2pzL0VtaXR0ZXIuanMnO1xyXG5pbXBvcnQgVEVtaXR0ZXIgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9URW1pdHRlci5qcyc7XHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBOb2RlLCBQYWludGFibGVOb2RlLCBQYWludENvbG9yUHJvcGVydHkgfSBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgVFNvdW5kUGxheWVyIGZyb20gJy4uLy4uLy4uL3RhbWJvL2pzL1RTb3VuZFBsYXllci5qcyc7XHJcbmltcG9ydCBwdXNoQnV0dG9uU291bmRQbGF5ZXIgZnJvbSAnLi4vLi4vLi4vdGFtYm8vanMvc2hhcmVkLXNvdW5kLXBsYXllcnMvcHVzaEJ1dHRvblNvdW5kUGxheWVyLmpzJztcclxuaW1wb3J0IEV2ZW50VHlwZSBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvRXZlbnRUeXBlLmpzJztcclxuaW1wb3J0IFBoZXRpb09iamVjdCBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvUGhldGlvT2JqZWN0LmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IENvbG9yQ29uc3RhbnRzIGZyb20gJy4uL0NvbG9yQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IHN1biBmcm9tICcuLi9zdW4uanMnO1xyXG5pbXBvcnQgQnV0dG9uTW9kZWwgZnJvbSAnLi9CdXR0b25Nb2RlbC5qcyc7XHJcbmltcG9ydCBSYWRpb0J1dHRvbkludGVyYWN0aW9uU3RhdGUgZnJvbSAnLi9SYWRpb0J1dHRvbkludGVyYWN0aW9uU3RhdGUuanMnO1xyXG5pbXBvcnQgUmFkaW9CdXR0b25JbnRlcmFjdGlvblN0YXRlUHJvcGVydHkgZnJvbSAnLi9SYWRpb0J1dHRvbkludGVyYWN0aW9uU3RhdGVQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSZWN0YW5ndWxhckJ1dHRvbiwgeyBSZWN0YW5ndWxhckJ1dHRvbk9wdGlvbnMgfSBmcm9tICcuL1JlY3Rhbmd1bGFyQnV0dG9uLmpzJztcclxuaW1wb3J0IFRCdXR0b25BcHBlYXJhbmNlU3RyYXRlZ3ksIHsgVEJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneU9wdGlvbnMgfSBmcm9tICcuL1RCdXR0b25BcHBlYXJhbmNlU3RyYXRlZ3kuanMnO1xyXG5pbXBvcnQgVENvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3ksIHsgVENvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3lPcHRpb25zIH0gZnJvbSAnLi9UQ29udGVudEFwcGVhcmFuY2VTdHJhdGVneS5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyBTb3VuZCBnZW5lcmF0aW9uIC0gSWYgc2V0IHRvIG51bGwgYSBkZWZhdWx0IHdpbGwgYmUgdXNlZCB0aGF0IGlzIGJhc2VkIG9uIHRoaXMgYnV0dG9uJ3MgcG9zaXRpb24gd2l0aGluIHRoZSByYWRpb1xyXG4gIC8vIGJ1dHRvbiBncm91cC4gIENhbiBiZSBzZXQgdG8gbnVsbFNvdW5kUGxheWVyIHRvIHR1cm4gb2ZmIGFsbCBzb3VuZCBnZW5lcmF0aW9uLlxyXG4gIHNvdW5kUGxheWVyPzogVFNvdW5kUGxheWVyIHwgbnVsbDtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25PcHRpb25zID0gU2VsZk9wdGlvbnMgJiBSZWN0YW5ndWxhckJ1dHRvbk9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSZWN0YW5ndWxhclJhZGlvQnV0dG9uPFQ+IGV4dGVuZHMgUmVjdGFuZ3VsYXJCdXR0b24ge1xyXG5cclxuICAvLyB0aGUgUHJvcGVydHkgdGhpcyBidXR0b24gY2hhbmdlc1xyXG4gIHB1YmxpYyByZWFkb25seSBwcm9wZXJ0eTogVFByb3BlcnR5PFQ+O1xyXG5cclxuICAvLyB0aGUgdmFsdWUgdGhhdCBpcyBzZXQgdG8gdGhlIFByb3BlcnR5IHdoZW4gdGhpcyBidXR0b24gaXMgcHJlc3NlZFxyXG4gIHB1YmxpYyByZWFkb25seSB2YWx1ZTogVDtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IGludGVyYWN0aW9uU3RhdGVQcm9wZXJ0eTogUmFkaW9CdXR0b25JbnRlcmFjdGlvblN0YXRlUHJvcGVydHk8VD47XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZmlyZWRFbWl0dGVyOiBURW1pdHRlcjtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbjogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBUQU5ERU1fTkFNRV9TVUZGSVggPSAnUmFkaW9CdXR0b24nO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gcHJvcGVydHkgLSBheG9uIFByb3BlcnR5IHRoYXQgY2FuIHRha2Ugb24gYSBzZXQgb2YgdmFsdWVzLCBvbmUgZm9yIGVhY2ggcmFkaW8gYnV0dG9uIGluIHRoZSBncm91cFxyXG4gICAqIEBwYXJhbSB2YWx1ZSAtIHZhbHVlIHdoZW4gdGhpcyByYWRpbyBidXR0b24gaXMgc2VsZWN0ZWRcclxuICAgKiBAcGFyYW0gcHJvdmlkZWRPcHRpb25zXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm9wZXJ0eTogVFByb3BlcnR5PFQ+LCB2YWx1ZTogVCwgcHJvdmlkZWRPcHRpb25zPzogUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbk9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxSZWN0YW5ndWxhclJhZGlvQnV0dG9uT3B0aW9ucywgU2VsZk9wdGlvbnMsIFJlY3Rhbmd1bGFyQnV0dG9uT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgc291bmRQbGF5ZXI6IG51bGwsXHJcblxyXG4gICAgICAvLyBSZWN0YW5ndWxhckJ1dHRvbk9wdGlvbnNcclxuICAgICAgYmFzZUNvbG9yOiBDb2xvckNvbnN0YW50cy5MSUdIVF9CTFVFLFxyXG4gICAgICBidXR0b25BcHBlYXJhbmNlU3RyYXRlZ3k6IFJlY3Rhbmd1bGFyUmFkaW9CdXR0b24uRmxhdEFwcGVhcmFuY2VTdHJhdGVneSxcclxuICAgICAgYnV0dG9uQXBwZWFyYW5jZVN0cmF0ZWd5T3B0aW9uczoge1xyXG4gICAgICAgIG92ZXJCdXR0b25PcGFjaXR5OiAwLjgsXHJcbiAgICAgICAgb3ZlclN0cm9rZTogbnVsbCxcclxuICAgICAgICBzZWxlY3RlZFN0cm9rZTogQ29sb3IuQkxBQ0ssXHJcbiAgICAgICAgc2VsZWN0ZWRMaW5lV2lkdGg6IDEuNSxcclxuICAgICAgICBzZWxlY3RlZEJ1dHRvbk9wYWNpdHk6IDEsXHJcbiAgICAgICAgZGVzZWxlY3RlZFN0cm9rZTogbmV3IENvbG9yKCA1MCwgNTAsIDUwICksXHJcbiAgICAgICAgZGVzZWxlY3RlZExpbmVXaWR0aDogMSxcclxuICAgICAgICBkZXNlbGVjdGVkQnV0dG9uT3BhY2l0eTogMC42XHJcbiAgICAgIH0sXHJcbiAgICAgIGNvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3k6IFJlY3Rhbmd1bGFyUmFkaW9CdXR0b24uQ29udGVudEFwcGVhcmFuY2VTdHJhdGVneSxcclxuICAgICAgY29udGVudEFwcGVhcmFuY2VTdHJhdGVneU9wdGlvbnM6IHtcclxuICAgICAgICBvdmVyQ29udGVudE9wYWNpdHk6IDAuOCxcclxuICAgICAgICBzZWxlY3RlZENvbnRlbnRPcGFjaXR5OiAxLFxyXG4gICAgICAgIGRlc2VsZWN0ZWRDb250ZW50T3BhY2l0eTogMC42XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICAvLyBwZG9tXHJcbiAgICAgIHRhZ05hbWU6ICdpbnB1dCcsXHJcbiAgICAgIGlucHV0VHlwZTogJ3JhZGlvJyxcclxuICAgICAgbGFiZWxUYWdOYW1lOiAnbGFiZWwnLFxyXG4gICAgICBjb250YWluZXJUYWdOYW1lOiAnbGknLFxyXG4gICAgICBhcHBlbmREZXNjcmlwdGlvbjogdHJ1ZSxcclxuICAgICAgYXBwZW5kTGFiZWw6IHRydWUsXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVELFxyXG4gICAgICB0YW5kZW1OYW1lU3VmZml4OiAnQnV0dG9uJyxcclxuICAgICAgcGhldGlvUmVhZE9ubHk6IFBoZXRpb09iamVjdC5ERUZBVUxUX09QVElPTlMucGhldGlvUmVhZE9ubHkgLy8gdG8gc3VwcG9ydCBwcm9wZXJseSBwYXNzaW5nIHRoaXMgdG8gY2hpbGRyZW4sIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvdGFuZGVtL2lzc3Vlcy82MFxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggIW9wdGlvbnMudGFuZGVtLnN1cHBsaWVkIHx8IG9wdGlvbnMudGFuZGVtLm5hbWUuZW5kc1dpdGgoIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b24uVEFOREVNX05BTUVfU1VGRklYICksXHJcbiAgICAgIGBSZWN0YW5ndWxhclJhZGlvQnV0dG9uIHRhbmRlbS5uYW1lIG11c3QgZW5kIHdpdGggJHtSZWN0YW5ndWxhclJhZGlvQnV0dG9uLlRBTkRFTV9OQU1FX1NVRkZJWH06ICR7b3B0aW9ucy50YW5kZW0ucGhldGlvSUR9YCApO1xyXG5cclxuICAgIC8vIE5vdGUgaXQgc2hhcmVzIGEgdGFuZGVtIHdpdGggdGhpcywgc28gdGhlIGVtaXR0ZXIgd2lsbCBiZSBpbnN0cnVtZW50ZWQgYXMgYSBjaGlsZCBvZiB0aGUgYnV0dG9uXHJcbiAgICBjb25zdCBidXR0b25Nb2RlbCA9IG5ldyBCdXR0b25Nb2RlbCgge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgaW50ZXJhY3Rpb25TdGF0ZVByb3BlcnR5ID0gbmV3IFJhZGlvQnV0dG9uSW50ZXJhY3Rpb25TdGF0ZVByb3BlcnR5KCBidXR0b25Nb2RlbCwgcHJvcGVydHksIHZhbHVlICk7XHJcblxyXG4gICAgc3VwZXIoIGJ1dHRvbk1vZGVsLCBpbnRlcmFjdGlvblN0YXRlUHJvcGVydHksIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBmb3IgdXNlIGluIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cCBmb3IgbWFuYWdpbmcgdGhlIGxhYmVsc1xyXG4gICAgdGhpcy5pbnRlcmFjdGlvblN0YXRlUHJvcGVydHkgPSBpbnRlcmFjdGlvblN0YXRlUHJvcGVydHk7XHJcblxyXG4gICAgLy8gcGRvbSAtIFNwZWNpZnkgdGhlIGRlZmF1bHQgdmFsdWUgZm9yIGFzc2lzdGl2ZSB0ZWNobm9sb2d5LCB0aGlzIGF0dHJpYnV0ZSBpcyBuZWVkZWQgaW4gYWRkaXRpb24gdG9cclxuICAgIC8vIHRoZSAnY2hlY2tlZCcgUHJvcGVydHkgdG8gbWFyayB0aGlzIGVsZW1lbnQgYXMgdGhlIGRlZmF1bHQgc2VsZWN0aW9uIHNpbmNlICdjaGVja2VkJyBtYXkgYmUgc2V0IGJlZm9yZVxyXG4gICAgLy8gd2UgYXJlIGZpbmlzaGVkIGFkZGluZyBSZWN0YW5ndWxhclJhZGlvQnV0dG9ucyB0byB0aGUgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwLlxyXG4gICAgaWYgKCBwcm9wZXJ0eS52YWx1ZSA9PT0gdmFsdWUgKSB7XHJcbiAgICAgIHRoaXMuc2V0UERPTUF0dHJpYnV0ZSggJ2NoZWNrZWQnLCAnY2hlY2tlZCcgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBwZG9tIC0gd2hlbiB0aGUgUHJvcGVydHkgY2hhbmdlcywgbWFrZSBzdXJlIHRoZSBjb3JyZWN0IHJhZGlvIGJ1dHRvbiBpcyBtYXJrZWQgYXMgJ2NoZWNrZWQnIHNvIHRoYXQgdGhpcyBidXR0b25cclxuICAgIC8vIHJlY2VpdmVzIGZvY3VzIG9uICd0YWInXHJcbiAgICBjb25zdCBwZG9tQ2hlY2tlZExpc3RlbmVyID0gKCBuZXdWYWx1ZTogVCApID0+IHtcclxuICAgICAgdGhpcy5wZG9tQ2hlY2tlZCA9ICggbmV3VmFsdWUgPT09IHZhbHVlICk7XHJcbiAgICB9O1xyXG4gICAgcHJvcGVydHkubGluayggcGRvbUNoZWNrZWRMaXN0ZW5lciApO1xyXG5cclxuICAgIHRoaXMucHJvcGVydHkgPSBwcm9wZXJ0eTtcclxuICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcclxuICAgIHRoaXMuZmlyZWRFbWl0dGVyID0gbmV3IEVtaXR0ZXIoIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdmaXJlZEVtaXR0ZXInICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdFbWl0cyB3aGVuIHRoZSByYWRpbyBidXR0b24gaXMgcHJlc3NlZCcsXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiBvcHRpb25zLnBoZXRpb1JlYWRPbmx5LFxyXG4gICAgICBwaGV0aW9FdmVudFR5cGU6IEV2ZW50VHlwZS5VU0VSXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5maXJlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHByb3BlcnR5LnNldCggdmFsdWUgKSApO1xyXG5cclxuICAgIC8vIFdoZW4gdGhlIGJ1dHRvbiBtb2RlbCB0cmlnZ2VycyBhbiBldmVudCwgZmlyZSBmcm9tIHRoZSByYWRpbyBidXR0b25cclxuICAgIGJ1dHRvbk1vZGVsLmRvd25Qcm9wZXJ0eS5saW5rKCBkb3duID0+IHtcclxuICAgICAgaWYgKCAhZG93biAmJiAoIGJ1dHRvbk1vZGVsLm92ZXJQcm9wZXJ0eS5nZXQoKSB8fCBidXR0b25Nb2RlbC5mb2N1c2VkUHJvcGVydHkuZ2V0KCkgKSAmJiAhYnV0dG9uTW9kZWwuaW50ZXJydXB0ZWQgKSB7XHJcbiAgICAgICAgdGhpcy5maXJlKCk7XHJcbiAgICAgICAgdGhpcy52b2ljaW5nU3BlYWtGdWxsUmVzcG9uc2UoIHtcclxuICAgICAgICAgIGhpbnRSZXNwb25zZTogbnVsbFxyXG4gICAgICAgIH0gKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHNvdW5kIGdlbmVyYXRpb25cclxuICAgIGNvbnN0IHNvdW5kUGxheWVyID0gb3B0aW9ucy5zb3VuZFBsYXllciB8fCBwdXNoQnV0dG9uU291bmRQbGF5ZXI7XHJcbiAgICBjb25zdCBwbGF5U291bmQgPSAoKSA9PiB7IHNvdW5kUGxheWVyLnBsYXkoKTsgfTtcclxuICAgIGJ1dHRvbk1vZGVsLnByb2R1Y2VTb3VuZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIHBsYXlTb3VuZCApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZVJlY3Rhbmd1bGFyUmFkaW9CdXR0b24gPSAoKSA9PiB7XHJcbiAgICAgIHByb3BlcnR5LnVubGluayggcGRvbUNoZWNrZWRMaXN0ZW5lciApO1xyXG4gICAgICB0aGlzLmZpcmVkRW1pdHRlci5kaXNwb3NlKCk7XHJcbiAgICAgIGJ1dHRvbk1vZGVsLnByb2R1Y2VTb3VuZEVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoIHBsYXlTb3VuZCApO1xyXG4gICAgICBidXR0b25Nb2RlbC5kaXNwb3NlKCk7XHJcbiAgICAgIHRoaXMuaW50ZXJhY3Rpb25TdGF0ZVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZVJlY3Rhbmd1bGFyUmFkaW9CdXR0b24oKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGZpcmUgb24gdXAgaWYgdGhlIGJ1dHRvbiBpcyBlbmFibGVkLCBwdWJsaWMgZm9yIHVzZSBpbiB0aGUgYWNjZXNzaWJpbGl0eSB0cmVlXHJcbiAgICovXHJcbiAgcHVibGljIGZpcmUoKTogdm9pZCB7XHJcbiAgICBpZiAoIHRoaXMuYnV0dG9uTW9kZWwuZW5hYmxlZFByb3BlcnR5LmdldCgpICkge1xyXG4gICAgICB0aGlzLmZpcmVkRW1pdHRlci5lbWl0KCk7XHJcbiAgICAgIHRoaXMuYnV0dG9uTW9kZWwucHJvZHVjZVNvdW5kRW1pdHRlci5lbWl0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGbGF0QXBwZWFyYW5jZVN0cmF0ZWd5IGlzIGEgdmFsdWUgZm9yIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b24gb3B0aW9ucy5idXR0b25BcHBlYXJhbmNlU3RyYXRlZ3kuIEl0IG1ha2VzIHJhZGlvIGJ1dHRvbnNcclxuICAgKiB0aGF0IGxvb2sgZmxhdCwgaS5lLiBubyBzaGFkaW5nIG9yIGhpZ2hsaWdodGluZywgYnV0IHRoYXQgY2hhbmdlIGNvbG9yIG9uIG1vdXNlb3ZlciwgcHJlc3MsIHNlbGVjdGVkLCBldGMuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBvdmVycmlkZSByZWFkb25seSBGbGF0QXBwZWFyYW5jZVN0cmF0ZWd5OiBUQnV0dG9uQXBwZWFyYW5jZVN0cmF0ZWd5ID0gY2xhc3MgRmxhdEFwcGVhcmFuY2VTdHJhdGVneSB7XHJcblxyXG4gICAgcHVibGljIHJlYWRvbmx5IG1heExpbmVXaWR0aDogbnVtYmVyO1xyXG5cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZUZsYXRBcHBlYXJhbmNlU3RyYXRlZ3k6ICgpID0+IHZvaWQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBidXR0b25CYWNrZ3JvdW5kIGlzIHRoZSBOb2RlIGZvciB0aGUgYnV0dG9uJ3MgYmFja2dyb3VuZCwgc2FucyBjb250ZW50XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvciggYnV0dG9uQmFja2dyb3VuZDogUGFpbnRhYmxlTm9kZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJhY3Rpb25TdGF0ZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxSYWRpb0J1dHRvbkludGVyYWN0aW9uU3RhdGU+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXNlQ29sb3JQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Q29sb3I+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnM/OiBUQnV0dG9uQXBwZWFyYW5jZVN0cmF0ZWd5T3B0aW9ucyApIHtcclxuXHJcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8VEJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneU9wdGlvbnM+KCkoIHtcclxuICAgICAgICBzdHJva2U6IGJhc2VDb2xvclByb3BlcnR5LFxyXG4gICAgICAgIGxpbmVXaWR0aDogMSxcclxuICAgICAgICBkZXNlbGVjdGVkQnV0dG9uT3BhY2l0eTogMSxcclxuICAgICAgICBkZXNlbGVjdGVkTGluZVdpZHRoOiAxLFxyXG4gICAgICAgIGRlc2VsZWN0ZWRTdHJva2U6ICdncmF5JyxcclxuICAgICAgICBvdmVyQnV0dG9uT3BhY2l0eTogMC44LFxyXG4gICAgICAgIG92ZXJGaWxsOiBudWxsLFxyXG4gICAgICAgIG92ZXJMaW5lV2lkdGg6IDAsXHJcbiAgICAgICAgb3ZlclN0cm9rZTogbnVsbCxcclxuICAgICAgICBzZWxlY3RlZEJ1dHRvbk9wYWNpdHk6IDEsXHJcbiAgICAgICAgc2VsZWN0ZWRMaW5lV2lkdGg6IDEsXHJcbiAgICAgICAgc2VsZWN0ZWRTdHJva2U6ICdibGFjaydcclxuICAgICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgICAvLyBEeW5hbWljIGZpbGxzIGFuZCBzdHJva2VzXHJcbiAgICAgIGNvbnN0IHByZXNzZWRGaWxsUHJvcGVydHkgPSBuZXcgUGFpbnRDb2xvclByb3BlcnR5KCBiYXNlQ29sb3JQcm9wZXJ0eSwge1xyXG4gICAgICAgIGx1bWluYW5jZUZhY3RvcjogLTAuNFxyXG4gICAgICB9ICk7XHJcbiAgICAgIGNvbnN0IG92ZXJGaWxsUHJvcGVydHkgPSBuZXcgUGFpbnRDb2xvclByb3BlcnR5KCBvcHRpb25zLm92ZXJGaWxsIHx8IGJhc2VDb2xvclByb3BlcnR5LCB7XHJcbiAgICAgICAgbHVtaW5hbmNlRmFjdG9yOiBwcm92aWRlZE9wdGlvbnMgJiYgcHJvdmlkZWRPcHRpb25zLm92ZXJGaWxsID8gMCA6IDAuNFxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBFZGl0b3JpYWwgTm90ZTogVGhlIGNvZGUgYmVsb3csIHdoZXJlIHRoZSBkZXNlbGVjdGVkIHN0cm9rZSBpcyB1c2VkIGFzIHRoZSB2YWx1ZSBmb3IgdGhlIG92ZXIgc3Ryb2tlIGlmIG5vIG92ZXJcclxuICAgICAgLy8gc3Ryb2tlIGlzIHByb3ZpZGVkLCBzZWVtcyBhIGJpdCBvZGQuICBIb3dldmVyLCBJIChqYnBoZXQpIHRyaWVkIHJlbW92aW5nIGl0IHdoZW4gcmVmYWN0b3JpbmcgdGhpcyB0byBzdXBwb3J0XHJcbiAgICAgIC8vIFR5cGVTY3JpcHQsIGFuZCBhIG51bWJlciBvZiBzaW1zIGJyb2tlLiAgVGhlIGNvZGUgd2FzIHJldmlld2VkIGFuZCBkaXNjdXNzZWQgd2l0aCBzb21lIG90aGVyIGRldnMsIGFuZCB3ZVxyXG4gICAgICAvLyBkZWNpZGVkIHRvIGxlYXZlIGl0IGFzIGlzLCBkZXNwaXRlIGl0IGJlaW5nIGEgYml0IHVuaW50dWl0aXZlLiAgU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzc3Mi5cclxuICAgICAgY29uc3Qgb3ZlclN0cm9rZVByb3BlcnR5ID0gbmV3IFBhaW50Q29sb3JQcm9wZXJ0eSggb3B0aW9ucy5vdmVyU3Ryb2tlIHx8IG9wdGlvbnMuZGVzZWxlY3RlZFN0cm9rZSwge1xyXG4gICAgICAgIGx1bWluYW5jZUZhY3RvcjogcHJvdmlkZWRPcHRpb25zICYmIHByb3ZpZGVkT3B0aW9ucy5vdmVyU3Ryb2tlID8gMCA6IC0wLjRcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgdGhpcy5tYXhMaW5lV2lkdGggPSBNYXRoLm1heCggb3B0aW9ucy5zZWxlY3RlZExpbmVXaWR0aCwgb3B0aW9ucy5kZXNlbGVjdGVkTGluZVdpZHRoLCBvcHRpb25zLm92ZXJMaW5lV2lkdGggKTtcclxuXHJcbiAgICAgIC8vIENhY2hlIGNvbG9yc1xyXG4gICAgICBidXR0b25CYWNrZ3JvdW5kLmNhY2hlZFBhaW50cyA9IFtcclxuICAgICAgICBiYXNlQ29sb3JQcm9wZXJ0eSwgb3ZlckZpbGxQcm9wZXJ0eSwgcHJlc3NlZEZpbGxQcm9wZXJ0eSwgb3ZlclN0cm9rZVByb3BlcnR5LCBvcHRpb25zLnNlbGVjdGVkU3Ryb2tlLCBvcHRpb25zLmRlc2VsZWN0ZWRTdHJva2VcclxuICAgICAgXTtcclxuXHJcbiAgICAgIC8vIENoYW5nZSBjb2xvcnMgYW5kIG9wYWNpdHkgdG8gbWF0Y2ggaW50ZXJhY3Rpb25TdGF0ZVxyXG4gICAgICBmdW5jdGlvbiBpbnRlcmFjdGlvblN0YXRlTGlzdGVuZXIoIGludGVyYWN0aW9uU3RhdGU6IFJhZGlvQnV0dG9uSW50ZXJhY3Rpb25TdGF0ZSApOiB2b2lkIHtcclxuICAgICAgICBzd2l0Y2goIGludGVyYWN0aW9uU3RhdGUgKSB7XHJcblxyXG4gICAgICAgICAgY2FzZSBSYWRpb0J1dHRvbkludGVyYWN0aW9uU3RhdGUuU0VMRUNURUQ6XHJcbiAgICAgICAgICAgIGJ1dHRvbkJhY2tncm91bmQuZmlsbCA9IGJhc2VDb2xvclByb3BlcnR5O1xyXG4gICAgICAgICAgICBidXR0b25CYWNrZ3JvdW5kLnN0cm9rZSA9IG9wdGlvbnMuc2VsZWN0ZWRTdHJva2U7XHJcbiAgICAgICAgICAgIGJ1dHRvbkJhY2tncm91bmQubGluZVdpZHRoID0gb3B0aW9ucy5zZWxlY3RlZExpbmVXaWR0aDtcclxuICAgICAgICAgICAgYnV0dG9uQmFja2dyb3VuZC5vcGFjaXR5ID0gb3B0aW9ucy5zZWxlY3RlZEJ1dHRvbk9wYWNpdHk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgIGNhc2UgUmFkaW9CdXR0b25JbnRlcmFjdGlvblN0YXRlLkRFU0VMRUNURUQ6XHJcbiAgICAgICAgICAgIGJ1dHRvbkJhY2tncm91bmQuZmlsbCA9IGJhc2VDb2xvclByb3BlcnR5O1xyXG4gICAgICAgICAgICBidXR0b25CYWNrZ3JvdW5kLnN0cm9rZSA9IG9wdGlvbnMuZGVzZWxlY3RlZFN0cm9rZTtcclxuICAgICAgICAgICAgYnV0dG9uQmFja2dyb3VuZC5saW5lV2lkdGggPSBvcHRpb25zLmRlc2VsZWN0ZWRMaW5lV2lkdGg7XHJcbiAgICAgICAgICAgIGJ1dHRvbkJhY2tncm91bmQub3BhY2l0eSA9IG9wdGlvbnMuZGVzZWxlY3RlZEJ1dHRvbk9wYWNpdHk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgIGNhc2UgUmFkaW9CdXR0b25JbnRlcmFjdGlvblN0YXRlLk9WRVI6XHJcbiAgICAgICAgICAgIGJ1dHRvbkJhY2tncm91bmQuZmlsbCA9IG92ZXJGaWxsUHJvcGVydHk7XHJcbiAgICAgICAgICAgIGJ1dHRvbkJhY2tncm91bmQuc3Ryb2tlID0gb3ZlclN0cm9rZVByb3BlcnR5O1xyXG4gICAgICAgICAgICBidXR0b25CYWNrZ3JvdW5kLmxpbmVXaWR0aCA9IE1hdGgubWF4KCBvcHRpb25zLm92ZXJMaW5lV2lkdGgsIG9wdGlvbnMuZGVzZWxlY3RlZExpbmVXaWR0aCApO1xyXG4gICAgICAgICAgICBidXR0b25CYWNrZ3JvdW5kLm9wYWNpdHkgPSBvcHRpb25zLm92ZXJCdXR0b25PcGFjaXR5O1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICBjYXNlIFJhZGlvQnV0dG9uSW50ZXJhY3Rpb25TdGF0ZS5QUkVTU0VEOlxyXG4gICAgICAgICAgICBidXR0b25CYWNrZ3JvdW5kLmZpbGwgPSBwcmVzc2VkRmlsbFByb3BlcnR5O1xyXG4gICAgICAgICAgICBidXR0b25CYWNrZ3JvdW5kLnN0cm9rZSA9IG9wdGlvbnMuZGVzZWxlY3RlZFN0cm9rZTtcclxuICAgICAgICAgICAgYnV0dG9uQmFja2dyb3VuZC5saW5lV2lkdGggPSBvcHRpb25zLmRlc2VsZWN0ZWRMaW5lV2lkdGg7XHJcbiAgICAgICAgICAgIGJ1dHRvbkJhY2tncm91bmQub3BhY2l0eSA9IG9wdGlvbnMuc2VsZWN0ZWRCdXR0b25PcGFjaXR5O1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIGB1bnN1cHBvcnRlZCBpbnRlcmFjdGlvblN0YXRlOiAke2ludGVyYWN0aW9uU3RhdGV9YCApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaW50ZXJhY3Rpb25TdGF0ZVByb3BlcnR5LmxpbmsoIGludGVyYWN0aW9uU3RhdGVMaXN0ZW5lciApO1xyXG5cclxuICAgICAgdGhpcy5kaXNwb3NlRmxhdEFwcGVhcmFuY2VTdHJhdGVneSA9ICgpID0+IHtcclxuICAgICAgICBpZiAoIGludGVyYWN0aW9uU3RhdGVQcm9wZXJ0eS5oYXNMaXN0ZW5lciggaW50ZXJhY3Rpb25TdGF0ZUxpc3RlbmVyICkgKSB7XHJcbiAgICAgICAgICBpbnRlcmFjdGlvblN0YXRlUHJvcGVydHkudW5saW5rKCBpbnRlcmFjdGlvblN0YXRlTGlzdGVuZXIgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb3ZlclN0cm9rZVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgICBvdmVyRmlsbFByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgICBwcmVzc2VkRmlsbFByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgICAgdGhpcy5kaXNwb3NlRmxhdEFwcGVhcmFuY2VTdHJhdGVneSgpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3kgaXMgYSB2YWx1ZSBmb3IgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbiBvcHRpb25zLmNvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3kuIEl0IGNoYW5nZXNcclxuICAgKiB0aGVpciBsb29rIGJhc2VkIG9uIHRoZSB2YWx1ZSBvZiBpbnRlcmFjdGlvblN0YXRlUHJvcGVydHkuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBDb250ZW50QXBwZWFyYW5jZVN0cmF0ZWd5OiBUQ29udGVudEFwcGVhcmFuY2VTdHJhdGVneSA9IGNsYXNzIENvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3kge1xyXG5cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZUNvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3k6ICgpID0+IHZvaWQ7XHJcblxyXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKCBjb250ZW50OiBOb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmFjdGlvblN0YXRlUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PFJhZGlvQnV0dG9uSW50ZXJhY3Rpb25TdGF0ZT4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVkT3B0aW9ucz86IFRDb250ZW50QXBwZWFyYW5jZVN0cmF0ZWd5T3B0aW9ucyApIHtcclxuXHJcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8VENvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3lPcHRpb25zPigpKCB7XHJcbiAgICAgICAgZGVzZWxlY3RlZENvbnRlbnRPcGFjaXR5OiAxLFxyXG4gICAgICAgIG92ZXJDb250ZW50T3BhY2l0eTogMSxcclxuICAgICAgICBzZWxlY3RlZENvbnRlbnRPcGFjaXR5OiAxXHJcbiAgICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgICAgLy8gVGhlIGJ1dHRvbiBpcyBub3QgdGhlIHBhcmVudCBvZiB0aGUgY29udGVudCwgdGhlcmVmb3JlIGl0IGlzIG5lY2Vzc2FyeSB0byBzZXQgdGhlIG9wYWNpdHkgb24gdGhlIGNvbnRlbnQgc2VwYXJhdGVseVxyXG4gICAgICBmdW5jdGlvbiBoYW5kbGVJbnRlcmFjdGlvblN0YXRlQ2hhbmdlZCggc3RhdGU6IFJhZGlvQnV0dG9uSW50ZXJhY3Rpb25TdGF0ZSApOiB2b2lkIHtcclxuICAgICAgICBpZiAoIGNvbnRlbnQgIT09IG51bGwgKSB7XHJcbiAgICAgICAgICBzd2l0Y2goIHN0YXRlICkge1xyXG5cclxuICAgICAgICAgICAgY2FzZSBSYWRpb0J1dHRvbkludGVyYWN0aW9uU3RhdGUuREVTRUxFQ1RFRDpcclxuICAgICAgICAgICAgICBjb250ZW50Lm9wYWNpdHkgPSBvcHRpb25zLmRlc2VsZWN0ZWRDb250ZW50T3BhY2l0eTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIC8vIG1vdXNlb3ZlciBmb3IgZGVzZWxlY3RlZCBidXR0b25zXHJcbiAgICAgICAgICAgIGNhc2UgUmFkaW9CdXR0b25JbnRlcmFjdGlvblN0YXRlLk9WRVI6XHJcbiAgICAgICAgICAgICAgY29udGVudC5vcGFjaXR5ID0gb3B0aW9ucy5vdmVyQ29udGVudE9wYWNpdHk7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIFJhZGlvQnV0dG9uSW50ZXJhY3Rpb25TdGF0ZS5TRUxFQ1RFRDpcclxuICAgICAgICAgICAgICBjb250ZW50Lm9wYWNpdHkgPSBvcHRpb25zLnNlbGVjdGVkQ29udGVudE9wYWNpdHk7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIFJhZGlvQnV0dG9uSW50ZXJhY3Rpb25TdGF0ZS5QUkVTU0VEOlxyXG4gICAgICAgICAgICAgIGNvbnRlbnQub3BhY2l0eSA9IG9wdGlvbnMuZGVzZWxlY3RlZENvbnRlbnRPcGFjaXR5O1xyXG4gICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIGB1bnN1cHBvcnRlZCBzdGF0ZTogJHtzdGF0ZX1gICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpbnRlcmFjdGlvblN0YXRlUHJvcGVydHkubGluayggaGFuZGxlSW50ZXJhY3Rpb25TdGF0ZUNoYW5nZWQgKTtcclxuXHJcbiAgICAgIHRoaXMuZGlzcG9zZUNvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3kgPSAoKSA9PiB7XHJcbiAgICAgICAgaWYgKCBpbnRlcmFjdGlvblN0YXRlUHJvcGVydHkuaGFzTGlzdGVuZXIoIGhhbmRsZUludGVyYWN0aW9uU3RhdGVDaGFuZ2VkICkgKSB7XHJcbiAgICAgICAgICBpbnRlcmFjdGlvblN0YXRlUHJvcGVydHkudW5saW5rKCBoYW5kbGVJbnRlcmFjdGlvblN0YXRlQ2hhbmdlZCApO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgICAgdGhpcy5kaXNwb3NlQ29udGVudEFwcGVhcmFuY2VTdHJhdGVneSgpO1xyXG4gICAgfVxyXG4gIH07XHJcbn1cclxuXHJcbnN1bi5yZWdpc3RlciggJ1JlY3Rhbmd1bGFyUmFkaW9CdXR0b24nLCBSZWN0YW5ndWxhclJhZGlvQnV0dG9uICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE9BQU8sTUFBTSw2QkFBNkI7QUFJakQsT0FBT0MsU0FBUyxNQUFNLG9DQUFvQztBQUMxRCxTQUFTQyxLQUFLLEVBQXVCQyxrQkFBa0IsUUFBUSxnQ0FBZ0M7QUFFL0YsT0FBT0MscUJBQXFCLE1BQU0saUVBQWlFO0FBQ25HLE9BQU9DLFNBQVMsTUFBTSxpQ0FBaUM7QUFDdkQsT0FBT0MsWUFBWSxNQUFNLG9DQUFvQztBQUM3RCxPQUFPQyxNQUFNLE1BQU0sOEJBQThCO0FBQ2pELE9BQU9DLGNBQWMsTUFBTSxzQkFBc0I7QUFDakQsT0FBT0MsR0FBRyxNQUFNLFdBQVc7QUFDM0IsT0FBT0MsV0FBVyxNQUFNLGtCQUFrQjtBQUMxQyxPQUFPQywyQkFBMkIsTUFBTSxrQ0FBa0M7QUFDMUUsT0FBT0MsbUNBQW1DLE1BQU0sMENBQTBDO0FBQzFGLE9BQU9DLGlCQUFpQixNQUFvQyx3QkFBd0I7QUFhcEYsZUFBZSxNQUFNQyxzQkFBc0IsU0FBWUQsaUJBQWlCLENBQUM7RUFFdkU7O0VBR0E7O0VBU0EsT0FBdUJFLGtCQUFrQixHQUFHLGFBQWE7O0VBRXpEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDU0MsV0FBV0EsQ0FBRUMsUUFBc0IsRUFBRUMsS0FBUSxFQUFFQyxlQUErQyxFQUFHO0lB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