// Copyright 2014-2022, University of Colorado Boulder

/**
 * RectangularPushButton is a rectangular push button, used to initiate some action.
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import InstanceRegistry from '../../../phet-core/js/documentation/InstanceRegistry.js';
import optionize from '../../../phet-core/js/optionize.js';
import pushButtonSoundPlayer from '../../../tambo/js/shared-sound-players/pushButtonSoundPlayer.js';
import Tandem from '../../../tandem/js/Tandem.js';
import sun from '../sun.js';
import PushButtonInteractionStateProperty from './PushButtonInteractionStateProperty.js';
import PushButtonModel from './PushButtonModel.js';
import RectangularButton from './RectangularButton.js';

//TODO https://github.com/phetsims/sun/issues/749 Let's not create PushButtonModel with these options?

export default class RectangularPushButton extends RectangularButton {
  // RectangularButton has this.buttonModel, but we also need this.pushButtonModel, because it has additional methods

  constructor(providedOptions) {
    const options = optionize()({
      soundPlayer: pushButtonSoundPlayer,
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'Button'
    }, providedOptions);

    // Save the listener and add it after creating the button model.  This is done so that
    // the same code path is always used for adding listener, thus guaranteeing a consistent code path if addListener is
    // overridden, see https://github.com/phetsims/sun/issues/284.
    const listener = options.listener;
    const superOptions = _.omit(options, ['listener']);

    // Note it shares a tandem with this, so the emitter will be instrumented as a child of the button
    //TODO https://github.com/phetsims/sun/issues/749 its surprising that we can pass superOptions with irrelevant fields to PushButtonModel without TS errors
    const pushButtonModel = new PushButtonModel(superOptions);
    super(pushButtonModel, new PushButtonInteractionStateProperty(pushButtonModel), superOptions);
    this.pushButtonModel = pushButtonModel;

    // add the listener that was potentially saved above
    listener && this.addListener(listener);

    // sound generation
    const playSound = () => {
      options.soundPlayer.play();
    };
    pushButtonModel.produceSoundEmitter.addListener(playSound);
    this.disposeRectangularPushButton = function () {
      pushButtonModel.produceSoundEmitter.removeListener(playSound);
      pushButtonModel.dispose(); //TODO this fails when assertions are enabled, see sun#212
    };

    // support for binder documentation, stripped out in builds and only runs when ?binder is specified
    assert && phet.chipper.queryParameters.binder && InstanceRegistry.registerDataURL('sun', 'RectangularPushButton', this);
  }
  dispose() {
    // The order of operations here is important - the view needs to be disposed first so that it is unhooked from
    // the model before the model is disposed.  If the model is disposed first, the view ends up trying to change some
    // of its Property values when it is disposed.  See https://github.com/phetsims/axon/issues/242.
    super.dispose();
    this.disposeRectangularPushButton();
  }

  /**
   * Adds a listener that will be notified when the button fires.
   */
  addListener(listener) {
    this.pushButtonModel.addListener(listener);
  }

  /**
   * Removes a listener.
   */
  removeListener(listener) {
    this.pushButtonModel.removeListener(listener);
  }
}
sun.register('RectangularPushButton', RectangularPushButton);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJJbnN0YW5jZVJlZ2lzdHJ5Iiwib3B0aW9uaXplIiwicHVzaEJ1dHRvblNvdW5kUGxheWVyIiwiVGFuZGVtIiwic3VuIiwiUHVzaEJ1dHRvbkludGVyYWN0aW9uU3RhdGVQcm9wZXJ0eSIsIlB1c2hCdXR0b25Nb2RlbCIsIlJlY3Rhbmd1bGFyQnV0dG9uIiwiUmVjdGFuZ3VsYXJQdXNoQnV0dG9uIiwiY29uc3RydWN0b3IiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwic291bmRQbGF5ZXIiLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInRhbmRlbU5hbWVTdWZmaXgiLCJsaXN0ZW5lciIsInN1cGVyT3B0aW9ucyIsIl8iLCJvbWl0IiwicHVzaEJ1dHRvbk1vZGVsIiwiYWRkTGlzdGVuZXIiLCJwbGF5U291bmQiLCJwbGF5IiwicHJvZHVjZVNvdW5kRW1pdHRlciIsImRpc3Bvc2VSZWN0YW5ndWxhclB1c2hCdXR0b24iLCJyZW1vdmVMaXN0ZW5lciIsImRpc3Bvc2UiLCJhc3NlcnQiLCJwaGV0IiwiY2hpcHBlciIsInF1ZXJ5UGFyYW1ldGVycyIsImJpbmRlciIsInJlZ2lzdGVyRGF0YVVSTCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUmVjdGFuZ3VsYXJQdXNoQnV0dG9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFJlY3Rhbmd1bGFyUHVzaEJ1dHRvbiBpcyBhIHJlY3Rhbmd1bGFyIHB1c2ggYnV0dG9uLCB1c2VkIHRvIGluaXRpYXRlIHNvbWUgYWN0aW9uLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBJbnN0YW5jZVJlZ2lzdHJ5IGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy9kb2N1bWVudGF0aW9uL0luc3RhbmNlUmVnaXN0cnkuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgcHVzaEJ1dHRvblNvdW5kUGxheWVyIGZyb20gJy4uLy4uLy4uL3RhbWJvL2pzL3NoYXJlZC1zb3VuZC1wbGF5ZXJzL3B1c2hCdXR0b25Tb3VuZFBsYXllci5qcyc7XHJcbmltcG9ydCBUU291bmRQbGF5ZXIgZnJvbSAnLi4vLi4vLi4vdGFtYm8vanMvVFNvdW5kUGxheWVyLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IHN1biBmcm9tICcuLi9zdW4uanMnO1xyXG5pbXBvcnQgUHVzaEJ1dHRvbkludGVyYWN0aW9uU3RhdGVQcm9wZXJ0eSBmcm9tICcuL1B1c2hCdXR0b25JbnRlcmFjdGlvblN0YXRlUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUHVzaEJ1dHRvbk1vZGVsLCB7IFB1c2hCdXR0b25MaXN0ZW5lciwgUHVzaEJ1dHRvbk1vZGVsT3B0aW9ucyB9IGZyb20gJy4vUHVzaEJ1dHRvbk1vZGVsLmpzJztcclxuaW1wb3J0IFJlY3Rhbmd1bGFyQnV0dG9uLCB7IFJlY3Rhbmd1bGFyQnV0dG9uT3B0aW9ucyB9IGZyb20gJy4vUmVjdGFuZ3VsYXJCdXR0b24uanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICBzb3VuZFBsYXllcj86IFRTb3VuZFBsYXllcjtcclxufTtcclxuXHJcbi8vVE9ETyBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc3VuL2lzc3Vlcy83NDkgTGV0J3Mgbm90IGNyZWF0ZSBQdXNoQnV0dG9uTW9kZWwgd2l0aCB0aGVzZSBvcHRpb25zP1xyXG50eXBlIFN1cGVyT3B0aW9ucyA9IFJlY3Rhbmd1bGFyQnV0dG9uT3B0aW9ucyAmIFB1c2hCdXR0b25Nb2RlbE9wdGlvbnM7XHJcblxyXG5leHBvcnQgdHlwZSBSZWN0YW5ndWxhclB1c2hCdXR0b25PcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdXBlck9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSZWN0YW5ndWxhclB1c2hCdXR0b24gZXh0ZW5kcyBSZWN0YW5ndWxhckJ1dHRvbiB7XHJcblxyXG4gIC8vIFJlY3Rhbmd1bGFyQnV0dG9uIGhhcyB0aGlzLmJ1dHRvbk1vZGVsLCBidXQgd2UgYWxzbyBuZWVkIHRoaXMucHVzaEJ1dHRvbk1vZGVsLCBiZWNhdXNlIGl0IGhhcyBhZGRpdGlvbmFsIG1ldGhvZHNcclxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgcHVzaEJ1dHRvbk1vZGVsOiBQdXNoQnV0dG9uTW9kZWw7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZVJlY3Rhbmd1bGFyUHVzaEJ1dHRvbjogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM/OiBSZWN0YW5ndWxhclB1c2hCdXR0b25PcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8UmVjdGFuZ3VsYXJQdXNoQnV0dG9uT3B0aW9ucywgU2VsZk9wdGlvbnMsIFN1cGVyT3B0aW9ucz4oKSgge1xyXG4gICAgICBzb3VuZFBsYXllcjogcHVzaEJ1dHRvblNvdW5kUGxheWVyLFxyXG4gICAgICB0YW5kZW06IFRhbmRlbS5SRVFVSVJFRCxcclxuICAgICAgdGFuZGVtTmFtZVN1ZmZpeDogJ0J1dHRvbidcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIC8vIFNhdmUgdGhlIGxpc3RlbmVyIGFuZCBhZGQgaXQgYWZ0ZXIgY3JlYXRpbmcgdGhlIGJ1dHRvbiBtb2RlbC4gIFRoaXMgaXMgZG9uZSBzbyB0aGF0XHJcbiAgICAvLyB0aGUgc2FtZSBjb2RlIHBhdGggaXMgYWx3YXlzIHVzZWQgZm9yIGFkZGluZyBsaXN0ZW5lciwgdGh1cyBndWFyYW50ZWVpbmcgYSBjb25zaXN0ZW50IGNvZGUgcGF0aCBpZiBhZGRMaXN0ZW5lciBpc1xyXG4gICAgLy8gb3ZlcnJpZGRlbiwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzI4NC5cclxuICAgIGNvbnN0IGxpc3RlbmVyID0gb3B0aW9ucy5saXN0ZW5lcjtcclxuICAgIGNvbnN0IHN1cGVyT3B0aW9ucyA9IF8ub21pdCggb3B0aW9ucywgWyAnbGlzdGVuZXInIF0gKTtcclxuXHJcbiAgICAvLyBOb3RlIGl0IHNoYXJlcyBhIHRhbmRlbSB3aXRoIHRoaXMsIHNvIHRoZSBlbWl0dGVyIHdpbGwgYmUgaW5zdHJ1bWVudGVkIGFzIGEgY2hpbGQgb2YgdGhlIGJ1dHRvblxyXG4gICAgLy9UT0RPIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzc0OSBpdHMgc3VycHJpc2luZyB0aGF0IHdlIGNhbiBwYXNzIHN1cGVyT3B0aW9ucyB3aXRoIGlycmVsZXZhbnQgZmllbGRzIHRvIFB1c2hCdXR0b25Nb2RlbCB3aXRob3V0IFRTIGVycm9yc1xyXG4gICAgY29uc3QgcHVzaEJ1dHRvbk1vZGVsID0gbmV3IFB1c2hCdXR0b25Nb2RlbCggc3VwZXJPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIHB1c2hCdXR0b25Nb2RlbCwgbmV3IFB1c2hCdXR0b25JbnRlcmFjdGlvblN0YXRlUHJvcGVydHkoIHB1c2hCdXR0b25Nb2RlbCApLCBzdXBlck9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLnB1c2hCdXR0b25Nb2RlbCA9IHB1c2hCdXR0b25Nb2RlbDtcclxuXHJcbiAgICAvLyBhZGQgdGhlIGxpc3RlbmVyIHRoYXQgd2FzIHBvdGVudGlhbGx5IHNhdmVkIGFib3ZlXHJcbiAgICBsaXN0ZW5lciAmJiB0aGlzLmFkZExpc3RlbmVyKCBsaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIHNvdW5kIGdlbmVyYXRpb25cclxuICAgIGNvbnN0IHBsYXlTb3VuZCA9ICgpID0+IHsgb3B0aW9ucy5zb3VuZFBsYXllci5wbGF5KCk7IH07XHJcbiAgICBwdXNoQnV0dG9uTW9kZWwucHJvZHVjZVNvdW5kRW1pdHRlci5hZGRMaXN0ZW5lciggcGxheVNvdW5kICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlUmVjdGFuZ3VsYXJQdXNoQnV0dG9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIHB1c2hCdXR0b25Nb2RlbC5wcm9kdWNlU291bmRFbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCBwbGF5U291bmQgKTtcclxuICAgICAgcHVzaEJ1dHRvbk1vZGVsLmRpc3Bvc2UoKTsgLy9UT0RPIHRoaXMgZmFpbHMgd2hlbiBhc3NlcnRpb25zIGFyZSBlbmFibGVkLCBzZWUgc3VuIzIxMlxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBzdXBwb3J0IGZvciBiaW5kZXIgZG9jdW1lbnRhdGlvbiwgc3RyaXBwZWQgb3V0IGluIGJ1aWxkcyBhbmQgb25seSBydW5zIHdoZW4gP2JpbmRlciBpcyBzcGVjaWZpZWRcclxuICAgIGFzc2VydCAmJiBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmJpbmRlciAmJiBJbnN0YW5jZVJlZ2lzdHJ5LnJlZ2lzdGVyRGF0YVVSTCggJ3N1bicsICdSZWN0YW5ndWxhclB1c2hCdXR0b24nLCB0aGlzICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuXHJcbiAgICAvLyBUaGUgb3JkZXIgb2Ygb3BlcmF0aW9ucyBoZXJlIGlzIGltcG9ydGFudCAtIHRoZSB2aWV3IG5lZWRzIHRvIGJlIGRpc3Bvc2VkIGZpcnN0IHNvIHRoYXQgaXQgaXMgdW5ob29rZWQgZnJvbVxyXG4gICAgLy8gdGhlIG1vZGVsIGJlZm9yZSB0aGUgbW9kZWwgaXMgZGlzcG9zZWQuICBJZiB0aGUgbW9kZWwgaXMgZGlzcG9zZWQgZmlyc3QsIHRoZSB2aWV3IGVuZHMgdXAgdHJ5aW5nIHRvIGNoYW5nZSBzb21lXHJcbiAgICAvLyBvZiBpdHMgUHJvcGVydHkgdmFsdWVzIHdoZW4gaXQgaXMgZGlzcG9zZWQuICBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2F4b24vaXNzdWVzLzI0Mi5cclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICAgIHRoaXMuZGlzcG9zZVJlY3Rhbmd1bGFyUHVzaEJ1dHRvbigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWRkcyBhIGxpc3RlbmVyIHRoYXQgd2lsbCBiZSBub3RpZmllZCB3aGVuIHRoZSBidXR0b24gZmlyZXMuXHJcbiAgICovXHJcbiAgcHVibGljIGFkZExpc3RlbmVyKCBsaXN0ZW5lcjogUHVzaEJ1dHRvbkxpc3RlbmVyICk6IHZvaWQge1xyXG4gICAgdGhpcy5wdXNoQnV0dG9uTW9kZWwuYWRkTGlzdGVuZXIoIGxpc3RlbmVyICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmVzIGEgbGlzdGVuZXIuXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUxpc3RlbmVyKCBsaXN0ZW5lcjogUHVzaEJ1dHRvbkxpc3RlbmVyICk6IHZvaWQge1xyXG4gICAgdGhpcy5wdXNoQnV0dG9uTW9kZWwucmVtb3ZlTGlzdGVuZXIoIGxpc3RlbmVyICk7XHJcbiAgfVxyXG59XHJcblxyXG5zdW4ucmVnaXN0ZXIoICdSZWN0YW5ndWxhclB1c2hCdXR0b24nLCBSZWN0YW5ndWxhclB1c2hCdXR0b24gKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGdCQUFnQixNQUFNLHlEQUF5RDtBQUN0RixPQUFPQyxTQUFTLE1BQU0sb0NBQW9DO0FBQzFELE9BQU9DLHFCQUFxQixNQUFNLGlFQUFpRTtBQUVuRyxPQUFPQyxNQUFNLE1BQU0sOEJBQThCO0FBQ2pELE9BQU9DLEdBQUcsTUFBTSxXQUFXO0FBQzNCLE9BQU9DLGtDQUFrQyxNQUFNLHlDQUF5QztBQUN4RixPQUFPQyxlQUFlLE1BQXNELHNCQUFzQjtBQUNsRyxPQUFPQyxpQkFBaUIsTUFBb0Msd0JBQXdCOztBQU1wRjs7QUFLQSxlQUFlLE1BQU1DLHFCQUFxQixTQUFTRCxpQkFBaUIsQ0FBQztFQUVuRTs7RUFLT0UsV0FBV0EsQ0FBRUMsZUFBOEMsRUFBRztJQUVuRSxNQUFNQyxPQUFPLEdBQUdWLFNBQVMsQ0FBMEQsQ0FBQyxDQUFFO01BQ3BGVyxXQUFXLEVBQUVWLHFCQUFxQjtNQUNsQ1csTUFBTSxFQUFFVixNQUFNLENBQUNXLFFBQVE7TUFDdkJDLGdCQUFnQixFQUFFO0lBQ3BCLENBQUMsRUFBRUwsZUFBZ0IsQ0FBQzs7SUFFcEI7SUFDQTtJQUNBO0lBQ0EsTUFBTU0sUUFBUSxHQUFHTCxPQUFPLENBQUNLLFFBQVE7SUFDakMsTUFBTUMsWUFBWSxHQUFHQyxDQUFDLENBQUNDLElBQUksQ0FBRVIsT0FBTyxFQUFFLENBQUUsVUFBVSxDQUFHLENBQUM7O0lBRXREO0lBQ0E7SUFDQSxNQUFNUyxlQUFlLEdBQUcsSUFBSWQsZUFBZSxDQUFFVyxZQUFhLENBQUM7SUFFM0QsS0FBSyxDQUFFRyxlQUFlLEVBQUUsSUFBSWYsa0NBQWtDLENBQUVlLGVBQWdCLENBQUMsRUFBRUgsWUFBYSxDQUFDO0lBRWpHLElBQUksQ0FBQ0csZUFBZSxHQUFHQSxlQUFlOztJQUV0QztJQUNBSixRQUFRLElBQUksSUFBSSxDQUFDSyxXQUFXLENBQUVMLFFBQVMsQ0FBQzs7SUFFeEM7SUFDQSxNQUFNTSxTQUFTLEdBQUdBLENBQUEsS0FBTTtNQUFFWCxPQUFPLENBQUNDLFdBQVcsQ0FBQ1csSUFBSSxDQUFDLENBQUM7SUFBRSxDQUFDO0lBQ3ZESCxlQUFlLENBQUNJLG1CQUFtQixDQUFDSCxXQUFXLENBQUVDLFNBQVUsQ0FBQztJQUU1RCxJQUFJLENBQUNHLDRCQUE0QixHQUFHLFlBQVc7TUFDN0NMLGVBQWUsQ0FBQ0ksbUJBQW1CLENBQUNFLGNBQWMsQ0FBRUosU0FBVSxDQUFDO01BQy9ERixlQUFlLENBQUNPLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM3QixDQUFDOztJQUVEO0lBQ0FDLE1BQU0sSUFBSUMsSUFBSSxDQUFDQyxPQUFPLENBQUNDLGVBQWUsQ0FBQ0MsTUFBTSxJQUFJaEMsZ0JBQWdCLENBQUNpQyxlQUFlLENBQUUsS0FBSyxFQUFFLHVCQUF1QixFQUFFLElBQUssQ0FBQztFQUMzSDtFQUVnQk4sT0FBT0EsQ0FBQSxFQUFTO0lBRTlCO0lBQ0E7SUFDQTtJQUNBLEtBQUssQ0FBQ0EsT0FBTyxDQUFDLENBQUM7SUFDZixJQUFJLENBQUNGLDRCQUE0QixDQUFDLENBQUM7RUFDckM7O0VBRUE7QUFDRjtBQUNBO0VBQ1NKLFdBQVdBLENBQUVMLFFBQTRCLEVBQVM7SUFDdkQsSUFBSSxDQUFDSSxlQUFlLENBQUNDLFdBQVcsQ0FBRUwsUUFBUyxDQUFDO0VBQzlDOztFQUVBO0FBQ0Y7QUFDQTtFQUNTVSxjQUFjQSxDQUFFVixRQUE0QixFQUFTO0lBQzFELElBQUksQ0FBQ0ksZUFBZSxDQUFDTSxjQUFjLENBQUVWLFFBQVMsQ0FBQztFQUNqRDtBQUNGO0FBRUFaLEdBQUcsQ0FBQzhCLFFBQVEsQ0FBRSx1QkFBdUIsRUFBRTFCLHFCQUFzQixDQUFDIn0=