// Copyright 2014-2022, University of Colorado Boulder

/**
 * RectangularButton is the base class for rectangular buttons.
 *
 * @author John Blanco (PhET Interactive Simulations)
 * @author Sam Reid (PhET Interactive Simulations)
 */

import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import Multilink from '../../../axon/js/Multilink.js';
import { Shape } from '../../../kite/js/imports.js';
import optionize from '../../../phet-core/js/optionize.js';
import { Color, LinearGradient, Node, PaintColorProperty, Path } from '../../../scenery/js/imports.js';
import sun from '../sun.js';
import ButtonInteractionState from './ButtonInteractionState.js';
import ButtonNode from './ButtonNode.js';
// constants
const VERTICAL_HIGHLIGHT_GRADIENT_LENGTH = 7; // In screen coords, which are roughly pixels.
const HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH = 7; // In screen coords, which are roughly pixels.
const SHADE_GRADIENT_LENGTH = 3; // In screen coords, which are roughly pixels.

export default class RectangularButton extends ButtonNode {
  /**
   * @param buttonModel - Model that defines the button's behavior.
   * @param interactionStateProperty - a Property that is used to drive the visual appearance of the button
   * @param providedOptions
   */
  constructor(buttonModel, interactionStateProperty, providedOptions) {
    const options = optionize()({
      size: null,
      minWidth: HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH + SHADE_GRADIENT_LENGTH,
      minHeight: VERTICAL_HIGHLIGHT_GRADIENT_LENGTH + SHADE_GRADIENT_LENGTH,
      xMargin: 8,
      // should be visibly greater than yMargin, see issue #109
      yMargin: 5,
      touchAreaXDilation: 0,
      touchAreaYDilation: 0,
      mouseAreaXDilation: 0,
      mouseAreaYDilation: 0,
      touchAreaXShift: 0,
      touchAreaYShift: 0,
      mouseAreaXShift: 0,
      mouseAreaYShift: 0,
      stroke: null,
      // null by default, which will cause a stroke to be derived from the base color
      lineWidth: 0.5,
      cornerRadius: 4,
      leftTopCornerRadius: null,
      rightTopCornerRadius: null,
      leftBottomCornerRadius: null,
      rightBottomCornerRadius: null,
      // Class that determines the button's appearance for the values of interactionStateProperty.
      // See RectangularButton.ThreeDAppearanceStrategy for an example of the interface required.
      buttonAppearanceStrategy: RectangularButton.ThreeDAppearanceStrategy
    }, providedOptions);
    if (!options.content) {
      assert && assert(options.size !== undefined, 'button dimensions needed if no content is supplied.');
    }
    if (options.size) {
      assert && assert(options.xMargin < options.size.width, 'xMargin cannot be larger than width');
      assert && assert(options.yMargin < options.size.height, 'yMargin cannot be larger than height');
      options.minUnstrokedWidth = options.size.width;
      options.minUnstrokedHeight = options.size.height;
    } else {
      if (options.minWidth !== undefined) {
        options.minUnstrokedWidth = options.minWidth;
      }
      if (options.minHeight !== undefined) {
        options.minUnstrokedHeight = options.minHeight;
      }
    }

    // If no options were explicitly passed in for the button appearance strategy, pass through the general appearance
    // options.
    if (!options.buttonAppearanceStrategyOptions) {
      options.buttonAppearanceStrategyOptions = {
        stroke: options.stroke,
        lineWidth: options.lineWidth
      };
    }

    // Compute the size of the button.
    let buttonWidth;
    let buttonHeight;
    if (options.size) {
      buttonWidth = options.size.width;
      buttonHeight = options.size.height;
    } else {
      buttonWidth = Math.max(options.content ? options.content.width + options.xMargin * 2 : 0, options.minWidth);
      buttonHeight = Math.max(options.content ? options.content.height + options.yMargin * 2 : 0, options.minHeight);
    }

    // Create the rectangular part of the button.
    const buttonBackground = new Path(createButtonShape(buttonWidth, buttonHeight, options));
    if (options.size && options.content) {
      const previousContent = options.content;
      const minScale = Math.min((options.size.width - options.xMargin * 2) / previousContent.width, (options.size.height - options.yMargin * 2) / previousContent.height);
      options.content = new Node({
        children: [previousContent],
        scale: minScale
      });
    }
    super(buttonModel, buttonBackground, interactionStateProperty, options);
    let isFirstlayout = true;
    Multilink.multilink([this.isWidthResizableProperty, this.isHeightResizableProperty, this.layoutSizeProperty], (isWidthSizable, isHeightSizable, layoutSize) => {
      if (isWidthSizable || isHeightSizable) {
        buttonBackground.shape = createButtonShape(isWidthSizable ? layoutSize.width - this.maxLineWidth : buttonWidth, isHeightSizable ? layoutSize.height - this.maxLineWidth : buttonHeight, options);
        assert && assert(!isWidthSizable || buttonBackground.width <= layoutSize.width + 1e-7, 'button width cannot exceed layout width');
        assert && assert(!isHeightSizable || buttonBackground.height <= layoutSize.height + 1e-7, 'button width cannot exceed layout height');
      }
      if (isFirstlayout || isWidthSizable || isHeightSizable) {
        // Set pointer areas.
        this.touchArea = buttonBackground.localBounds.dilatedXY(options.touchAreaXDilation, options.touchAreaYDilation).shiftedXY(options.touchAreaXShift, options.touchAreaYShift);
        this.mouseArea = buttonBackground.localBounds.dilatedXY(options.mouseAreaXDilation, options.mouseAreaYDilation).shiftedXY(options.mouseAreaXShift, options.mouseAreaYShift);
      }
      isFirstlayout = false;
    });
  }
}

/**
 * Convenience function for creating the shape of the button, done to avoid code duplication
 * @param width
 * @param height
 * @param config - RectangularButton config, containing values related to radii of button corners
 */
function createButtonShape(width, height, config) {
  // Don't allow a corner radius that is larger than half the width or height, see
  // https://github.com/phetsims/under-pressure/issues/151
  const maxCorner = Math.min(width / 2, height / 2);
  return Shape.roundedRectangleWithRadii(0, 0, width, height, {
    topLeft: Math.min(maxCorner, config.leftTopCornerRadius !== null ? config.leftTopCornerRadius : config.cornerRadius),
    topRight: Math.min(maxCorner, config.rightTopCornerRadius !== null ? config.rightTopCornerRadius : config.cornerRadius),
    bottomLeft: Math.min(maxCorner, config.leftBottomCornerRadius !== null ? config.leftBottomCornerRadius : config.cornerRadius),
    bottomRight: Math.min(maxCorner, config.rightBottomCornerRadius !== null ? config.rightBottomCornerRadius : config.cornerRadius)
  });
}

/**
 * ThreeDAppearanceStrategy is a value for RectangularButton options.buttonAppearanceStrategy. It makes a rectangular
 * button look 3D-ish by using gradients that create the appearance of highlighted and shaded edges. The gradients are
 * set up to make the light source appear to be in the upper left.
 */
class ThreeDAppearanceStrategy {
  /**
   * @param buttonBackground - the Node for the button's background, sans content
   * @param interactionStateProperty
   * @param baseColorProperty
   * @param [providedOptions]
   */
  constructor(buttonBackground, interactionStateProperty, baseColorProperty, providedOptions) {
    // If stroke and lineWidth exist in the provided options, they become the default for all strokes and line widths.
    // If not, defaults are created.
    const defaultStroke = providedOptions && providedOptions.stroke ? providedOptions.stroke : new PaintColorProperty(baseColorProperty, {
      luminanceFactor: -0.4
    });
    const defaultLineWidth = providedOptions && providedOptions.lineWidth !== undefined ? providedOptions.lineWidth : 0.5;
    const options = optionize()({
      stroke: defaultStroke,
      lineWidth: defaultLineWidth,
      overStroke: defaultStroke,
      overLineWidth: defaultLineWidth,
      overFill: baseColorProperty,
      overButtonOpacity: 1,
      selectedStroke: defaultStroke,
      selectedLineWidth: defaultLineWidth,
      selectedButtonOpacity: 1,
      deselectedStroke: defaultStroke,
      deselectedLineWidth: defaultLineWidth,
      deselectedButtonOpacity: 1
    }, providedOptions);

    // Create the colors that will be used to produce the gradients and shading needed for the 3D appearance.
    const baseBrighter7Property = new PaintColorProperty(baseColorProperty, {
      luminanceFactor: 0.7
    });
    const baseBrighter5Property = new PaintColorProperty(baseColorProperty, {
      luminanceFactor: 0.5
    });
    const baseBrighter2Property = new PaintColorProperty(baseColorProperty, {
      luminanceFactor: 0.2
    });
    const baseDarker3Property = new PaintColorProperty(baseColorProperty, {
      luminanceFactor: -0.3
    });
    const baseDarker4Property = new PaintColorProperty(baseColorProperty, {
      luminanceFactor: -0.4
    });
    const baseDarker5Property = new PaintColorProperty(baseColorProperty, {
      luminanceFactor: -0.5
    });
    const baseTransparentProperty = new DerivedProperty([baseColorProperty], color => color.withAlpha(0));
    const transparentWhite = new Color(255, 255, 255, 0.7);

    // Adds shading to left and right edges of the button.
    const horizontalShadingPath = new Path(null, {
      stroke: options.stroke,
      lineWidth: options.lineWidth,
      pickable: false
    });
    buttonBackground.addChild(horizontalShadingPath);
    this.maxLineWidth = typeof options.lineWidth === 'number' ? options.lineWidth : 0;
    let interactionStateListener;

    // We'll need to listen to the shape changes in order to update our appearance.
    const listener = () => {
      // Handle our gradients based on the path's actual shape, NOT including the stroked part
      const buttonWidth = buttonBackground.shape.bounds.width;
      const buttonHeight = buttonBackground.shape.bounds.height;
      horizontalShadingPath.shape = buttonBackground.shape;

      // compute color stops for gradient, see issue #148
      assert && assert(buttonWidth >= HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH + SHADE_GRADIENT_LENGTH);
      assert && assert(buttonHeight >= VERTICAL_HIGHLIGHT_GRADIENT_LENGTH + SHADE_GRADIENT_LENGTH);
      const verticalHighlightStop = Math.min(VERTICAL_HIGHLIGHT_GRADIENT_LENGTH / buttonHeight, 1);
      const verticalShadowStop = Math.max(1 - SHADE_GRADIENT_LENGTH / buttonHeight, 0);
      const horizontalHighlightStop = Math.min(HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH / buttonWidth, 1);
      const horizontalShadowStop = Math.max(1 - SHADE_GRADIENT_LENGTH / buttonWidth, 0);

      // Gradient fills for button states
      const upFillVertical = new LinearGradient(0, 0, 0, buttonHeight).addColorStop(0, baseBrighter7Property).addColorStop(verticalHighlightStop, baseColorProperty).addColorStop(verticalShadowStop, baseColorProperty).addColorStop(1, baseDarker5Property);
      const upFillHorizontal = new LinearGradient(0, 0, buttonWidth, 0).addColorStop(0, transparentWhite).addColorStop(horizontalHighlightStop, baseTransparentProperty).addColorStop(horizontalShadowStop, baseTransparentProperty).addColorStop(1, baseDarker5Property);
      const overFillVertical = new LinearGradient(0, 0, 0, buttonHeight).addColorStop(0, baseBrighter7Property).addColorStop(verticalHighlightStop, baseBrighter5Property).addColorStop(verticalShadowStop, baseBrighter5Property).addColorStop(1, baseDarker5Property);
      const overFillHorizontal = new LinearGradient(0, 0, buttonWidth, 0).addColorStop(0, transparentWhite).addColorStop(horizontalHighlightStop / 2, new Color(255, 255, 255, 0)).addColorStop(horizontalShadowStop, baseTransparentProperty).addColorStop(1, baseDarker3Property);
      const downFillVertical = new LinearGradient(0, 0, 0, buttonHeight).addColorStop(0, baseBrighter7Property).addColorStop(verticalHighlightStop * 0.67, baseDarker3Property).addColorStop(verticalShadowStop, baseBrighter2Property).addColorStop(1, baseDarker5Property);

      // Cache gradients
      buttonBackground.cachedPaints = [upFillVertical, overFillVertical, downFillVertical];
      horizontalShadingPath.cachedPaints = [upFillHorizontal, overFillHorizontal];
      interactionStateListener && interactionStateProperty.unlink(interactionStateListener);

      // Change colors to match interactionState
      interactionStateListener = interactionState => {
        switch (interactionState) {
          case ButtonInteractionState.IDLE:
            buttonBackground.fill = upFillVertical;
            buttonBackground.stroke = options.deselectedStroke;
            buttonBackground.lineWidth = options.deselectedLineWidth;
            buttonBackground.opacity = options.deselectedButtonOpacity;
            horizontalShadingPath.fill = upFillHorizontal;
            horizontalShadingPath.opacity = options.deselectedButtonOpacity;
            break;
          case ButtonInteractionState.OVER:
            buttonBackground.fill = overFillVertical;
            buttonBackground.stroke = options.overStroke;
            buttonBackground.lineWidth = options.overLineWidth;
            buttonBackground.opacity = options.overButtonOpacity;
            horizontalShadingPath.fill = overFillHorizontal;
            horizontalShadingPath.opacity = options.overButtonOpacity;
            break;
          case ButtonInteractionState.PRESSED:
            buttonBackground.fill = downFillVertical;
            buttonBackground.stroke = options.selectedStroke;
            buttonBackground.lineWidth = options.selectedLineWidth;
            buttonBackground.opacity = options.selectedButtonOpacity;
            horizontalShadingPath.fill = overFillHorizontal;
            horizontalShadingPath.opacity = options.selectedButtonOpacity;
            break;
          default:
            throw new Error(`unsupported interactionState: ${interactionState}`);
        }
      };
      interactionStateProperty.link(interactionStateListener);
    };
    buttonBackground.selfBoundsProperty.link(listener);
    this.disposeThreeDAppearanceStrategy = () => {
      buttonBackground.selfBoundsProperty.unlink(listener);
      if (interactionStateProperty.hasListener(interactionStateListener)) {
        interactionStateProperty.unlink(interactionStateListener);
      }
      baseBrighter7Property.dispose();
      baseBrighter5Property.dispose();
      baseBrighter2Property.dispose();
      baseDarker3Property.dispose();
      baseDarker4Property.dispose();
      baseDarker5Property.dispose();
      baseTransparentProperty.dispose();
    };
  }
  dispose() {
    this.disposeThreeDAppearanceStrategy();
  }
}
RectangularButton.ThreeDAppearanceStrategy = ThreeDAppearanceStrategy;
sun.register('RectangularButton', RectangularButton);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJNdWx0aWxpbmsiLCJTaGFwZSIsIm9wdGlvbml6ZSIsIkNvbG9yIiwiTGluZWFyR3JhZGllbnQiLCJOb2RlIiwiUGFpbnRDb2xvclByb3BlcnR5IiwiUGF0aCIsInN1biIsIkJ1dHRvbkludGVyYWN0aW9uU3RhdGUiLCJCdXR0b25Ob2RlIiwiVkVSVElDQUxfSElHSExJR0hUX0dSQURJRU5UX0xFTkdUSCIsIkhPUklaT05UQUxfSElHSExJR0hUX0dSQURJRU5UX0xFTkdUSCIsIlNIQURFX0dSQURJRU5UX0xFTkdUSCIsIlJlY3Rhbmd1bGFyQnV0dG9uIiwiY29uc3RydWN0b3IiLCJidXR0b25Nb2RlbCIsImludGVyYWN0aW9uU3RhdGVQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJzaXplIiwibWluV2lkdGgiLCJtaW5IZWlnaHQiLCJ4TWFyZ2luIiwieU1hcmdpbiIsInRvdWNoQXJlYVhEaWxhdGlvbiIsInRvdWNoQXJlYVlEaWxhdGlvbiIsIm1vdXNlQXJlYVhEaWxhdGlvbiIsIm1vdXNlQXJlYVlEaWxhdGlvbiIsInRvdWNoQXJlYVhTaGlmdCIsInRvdWNoQXJlYVlTaGlmdCIsIm1vdXNlQXJlYVhTaGlmdCIsIm1vdXNlQXJlYVlTaGlmdCIsInN0cm9rZSIsImxpbmVXaWR0aCIsImNvcm5lclJhZGl1cyIsImxlZnRUb3BDb3JuZXJSYWRpdXMiLCJyaWdodFRvcENvcm5lclJhZGl1cyIsImxlZnRCb3R0b21Db3JuZXJSYWRpdXMiLCJyaWdodEJvdHRvbUNvcm5lclJhZGl1cyIsImJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneSIsIlRocmVlREFwcGVhcmFuY2VTdHJhdGVneSIsImNvbnRlbnQiLCJhc3NlcnQiLCJ1bmRlZmluZWQiLCJ3aWR0aCIsImhlaWdodCIsIm1pblVuc3Ryb2tlZFdpZHRoIiwibWluVW5zdHJva2VkSGVpZ2h0IiwiYnV0dG9uQXBwZWFyYW5jZVN0cmF0ZWd5T3B0aW9ucyIsImJ1dHRvbldpZHRoIiwiYnV0dG9uSGVpZ2h0IiwiTWF0aCIsIm1heCIsImJ1dHRvbkJhY2tncm91bmQiLCJjcmVhdGVCdXR0b25TaGFwZSIsInByZXZpb3VzQ29udGVudCIsIm1pblNjYWxlIiwibWluIiwiY2hpbGRyZW4iLCJzY2FsZSIsImlzRmlyc3RsYXlvdXQiLCJtdWx0aWxpbmsiLCJpc1dpZHRoUmVzaXphYmxlUHJvcGVydHkiLCJpc0hlaWdodFJlc2l6YWJsZVByb3BlcnR5IiwibGF5b3V0U2l6ZVByb3BlcnR5IiwiaXNXaWR0aFNpemFibGUiLCJpc0hlaWdodFNpemFibGUiLCJsYXlvdXRTaXplIiwic2hhcGUiLCJtYXhMaW5lV2lkdGgiLCJ0b3VjaEFyZWEiLCJsb2NhbEJvdW5kcyIsImRpbGF0ZWRYWSIsInNoaWZ0ZWRYWSIsIm1vdXNlQXJlYSIsImNvbmZpZyIsIm1heENvcm5lciIsInJvdW5kZWRSZWN0YW5nbGVXaXRoUmFkaWkiLCJ0b3BMZWZ0IiwidG9wUmlnaHQiLCJib3R0b21MZWZ0IiwiYm90dG9tUmlnaHQiLCJiYXNlQ29sb3JQcm9wZXJ0eSIsImRlZmF1bHRTdHJva2UiLCJsdW1pbmFuY2VGYWN0b3IiLCJkZWZhdWx0TGluZVdpZHRoIiwib3ZlclN0cm9rZSIsIm92ZXJMaW5lV2lkdGgiLCJvdmVyRmlsbCIsIm92ZXJCdXR0b25PcGFjaXR5Iiwic2VsZWN0ZWRTdHJva2UiLCJzZWxlY3RlZExpbmVXaWR0aCIsInNlbGVjdGVkQnV0dG9uT3BhY2l0eSIsImRlc2VsZWN0ZWRTdHJva2UiLCJkZXNlbGVjdGVkTGluZVdpZHRoIiwiZGVzZWxlY3RlZEJ1dHRvbk9wYWNpdHkiLCJiYXNlQnJpZ2h0ZXI3UHJvcGVydHkiLCJiYXNlQnJpZ2h0ZXI1UHJvcGVydHkiLCJiYXNlQnJpZ2h0ZXIyUHJvcGVydHkiLCJiYXNlRGFya2VyM1Byb3BlcnR5IiwiYmFzZURhcmtlcjRQcm9wZXJ0eSIsImJhc2VEYXJrZXI1UHJvcGVydHkiLCJiYXNlVHJhbnNwYXJlbnRQcm9wZXJ0eSIsImNvbG9yIiwid2l0aEFscGhhIiwidHJhbnNwYXJlbnRXaGl0ZSIsImhvcml6b250YWxTaGFkaW5nUGF0aCIsInBpY2thYmxlIiwiYWRkQ2hpbGQiLCJpbnRlcmFjdGlvblN0YXRlTGlzdGVuZXIiLCJsaXN0ZW5lciIsImJvdW5kcyIsInZlcnRpY2FsSGlnaGxpZ2h0U3RvcCIsInZlcnRpY2FsU2hhZG93U3RvcCIsImhvcml6b250YWxIaWdobGlnaHRTdG9wIiwiaG9yaXpvbnRhbFNoYWRvd1N0b3AiLCJ1cEZpbGxWZXJ0aWNhbCIsImFkZENvbG9yU3RvcCIsInVwRmlsbEhvcml6b250YWwiLCJvdmVyRmlsbFZlcnRpY2FsIiwib3ZlckZpbGxIb3Jpem9udGFsIiwiZG93bkZpbGxWZXJ0aWNhbCIsImNhY2hlZFBhaW50cyIsInVubGluayIsImludGVyYWN0aW9uU3RhdGUiLCJJRExFIiwiZmlsbCIsIm9wYWNpdHkiLCJPVkVSIiwiUFJFU1NFRCIsIkVycm9yIiwibGluayIsInNlbGZCb3VuZHNQcm9wZXJ0eSIsImRpc3Bvc2VUaHJlZURBcHBlYXJhbmNlU3RyYXRlZ3kiLCJoYXNMaXN0ZW5lciIsImRpc3Bvc2UiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlJlY3Rhbmd1bGFyQnV0dG9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFJlY3Rhbmd1bGFyQnV0dG9uIGlzIHRoZSBiYXNlIGNsYXNzIGZvciByZWN0YW5ndWxhciBidXR0b25zLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvaG4gQmxhbmNvIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuaW1wb3J0IHsgQ29sb3IsIFRQYWludCwgTGluZWFyR3JhZGllbnQsIE5vZGUsIFBhaW50Q29sb3JQcm9wZXJ0eSwgUGF0aCB9IGZyb20gJy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBzdW4gZnJvbSAnLi4vc3VuLmpzJztcclxuaW1wb3J0IEJ1dHRvbkludGVyYWN0aW9uU3RhdGUgZnJvbSAnLi9CdXR0b25JbnRlcmFjdGlvblN0YXRlLmpzJztcclxuaW1wb3J0IEJ1dHRvbk1vZGVsIGZyb20gJy4vQnV0dG9uTW9kZWwuanMnO1xyXG5pbXBvcnQgQnV0dG9uTm9kZSwgeyBCdXR0b25Ob2RlT3B0aW9ucywgRXh0ZXJuYWxCdXR0b25Ob2RlT3B0aW9ucyB9IGZyb20gJy4vQnV0dG9uTm9kZS5qcyc7XHJcbmltcG9ydCBSYWRpb0J1dHRvbkludGVyYWN0aW9uU3RhdGUgZnJvbSAnLi9SYWRpb0J1dHRvbkludGVyYWN0aW9uU3RhdGUuanMnO1xyXG5pbXBvcnQgVEJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneSwgeyBUQnV0dG9uQXBwZWFyYW5jZVN0cmF0ZWd5T3B0aW9ucyB9IGZyb20gJy4vVEJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgVkVSVElDQUxfSElHSExJR0hUX0dSQURJRU5UX0xFTkdUSCA9IDc7IC8vIEluIHNjcmVlbiBjb29yZHMsIHdoaWNoIGFyZSByb3VnaGx5IHBpeGVscy5cclxuY29uc3QgSE9SSVpPTlRBTF9ISUdITElHSFRfR1JBRElFTlRfTEVOR1RIID0gNzsgLy8gSW4gc2NyZWVuIGNvb3Jkcywgd2hpY2ggYXJlIHJvdWdobHkgcGl4ZWxzLlxyXG5jb25zdCBTSEFERV9HUkFESUVOVF9MRU5HVEggPSAzOyAvLyBJbiBzY3JlZW4gY29vcmRzLCB3aGljaCBhcmUgcm91Z2hseSBwaXhlbHMuXHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyBJZiBzcGVjaWZpZWQsIHRoaXMgd2lsbCBiZSB0aGUgc2l6ZSBvZiB0aGUgYnV0dG9uLiBtaW5XaWR0aCBhbmQgbWluSGVpZ2h0IHdpbGwgYmUgaWdub3JlZCwgYW5kXHJcbiAgLy8gY29udGVudCB3aWxsIGJlIHNjYWxlZCBkb3duIHRvIGZpdCBpbnNpZGUsIGFjY291bnRpbmcgZm9yIG1hcmdpbnMuXHJcbiAgLy8gTk9URTogVGhpcyB3aWxsIE5PVCBiZSB0aGUgc2l6ZSBvZiB0aGUgYnV0dG9uLiBJdCBkb2VzIE5PVCBhY2NvdW50IGZvciB0aGUgc3Ryb2tlL2xpbmVXaWR0aCwgc28gdGhlIGJ1dHRvbiB3aWxsXHJcbiAgLy8gQUxXQVlTIGJlIGxhcmdlciB0aGFuIHRoaXMuXHJcbiAgLy8gQURESVRJT05BTExZOiBUaGUgYnV0dG9uIGNhbiBiZSBsYXJnZXIsIGlmIHRoZSBjb250ZW50IGRvZXNuJ3QgZml0LlxyXG4gIHNpemU/OiBEaW1lbnNpb24yIHwgbnVsbDtcclxuXHJcbiAgLy8gSWYgeW91IHdhbnQgY29tcGxldGUgY29udHJvbCBvZiBhIGJ1dHRvbidzIGRpbWVuc2lvbnMsIHVzZSBvcHRpb25zLnNpemUuIElmIHlvdSB3YW50IHRvIHNwZWNpZnlcclxuICAvLyBvbmUgZGltZW5zaW9ucyB3aGlsZSBoYXZpbmcgdGhlIG90aGVyIGRpbWVuc2lvbiBkZXRlcm1pbmVkIGJ5IGNvbnRlbnQgYW5kIG1hcmdpbiwgdGhlbiB1c2Ugb25lIG9mIHRoZXNlXHJcbiAgLy8gb3B0aW9ucy5cclxuICAvLyBOT1RFOiBUaGlzIG1pbldpZHRoL21pbkhlaWdodCBkb2VzIE5PVCBpbmNsdWRlIHRoZSBzdHJva2VcclxuICBtaW5XaWR0aD86IG51bWJlcjtcclxuICBtaW5IZWlnaHQ/OiBudW1iZXI7XHJcblxyXG4gIC8vIHBvaW50ZXIgYXJlYSBkaWxhdGlvblxyXG4gIHRvdWNoQXJlYVhEaWxhdGlvbj86IG51bWJlcjtcclxuICB0b3VjaEFyZWFZRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgbW91c2VBcmVhWERpbGF0aW9uPzogbnVtYmVyO1xyXG4gIG1vdXNlQXJlYVlEaWxhdGlvbj86IG51bWJlcjtcclxuXHJcbiAgLy8gcG9pbnRlciBhcmVhIHNoaWZ0LCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3N1bi9pc3N1ZXMvNTAwXHJcbiAgdG91Y2hBcmVhWFNoaWZ0PzogbnVtYmVyO1xyXG4gIHRvdWNoQXJlYVlTaGlmdD86IG51bWJlcjtcclxuICBtb3VzZUFyZWFYU2hpZnQ/OiBudW1iZXI7XHJcbiAgbW91c2VBcmVhWVNoaWZ0PzogbnVtYmVyO1xyXG5cclxuICBzdHJva2U/OiBUUGFpbnQgfCBudWxsOyAvLyB3aGVuIG51bGwsIGEgc3Ryb2tlIHdpbGwgYmUgZGVyaXZlZCBmcm9tIHRoZSBiYXNlIGNvbG9yXHJcbiAgbGluZVdpZHRoPzogbnVtYmVyOyAvLyBPbmx5IG1lYW5pbmdmdWwgaWYgc3Ryb2tlIGlzIG5vbi1udWxsXHJcblxyXG4gIC8vIHJhZGl1cyBhcHBsaWVkIHRvIGFsbCBjb3JuZXJzIHVubGVzcyBhIGNvcm5lci1zcGVjaWZpYyB2YWx1ZSBpcyBwcm92aWRlZFxyXG4gIGNvcm5lclJhZGl1cz86IG51bWJlcjtcclxuXHJcbiAgLy8ge251bWJlcnxudWxsfSBjb3JuZXItc3BlY2lmaWMgcmFkaWlcclxuICAvLyBJZiBudWxsLCB0aGUgb3B0aW9uIGlzIGlnbm9yZWQuXHJcbiAgLy8gSWYgbm9uLW51bGwsIGl0IG92ZXJyaWRlcyBjb3JuZXJSYWRpdXMgZm9yIHRoZSBhc3NvY2lhdGVkIGNvcm5lciBvZiB0aGUgYnV0dG9uLlxyXG4gIGxlZnRUb3BDb3JuZXJSYWRpdXM/OiBudW1iZXIgfCBudWxsO1xyXG4gIHJpZ2h0VG9wQ29ybmVyUmFkaXVzPzogbnVtYmVyIHwgbnVsbDtcclxuICBsZWZ0Qm90dG9tQ29ybmVyUmFkaXVzPzogbnVtYmVyIHwgbnVsbDtcclxuICByaWdodEJvdHRvbUNvcm5lclJhZGl1cz86IG51bWJlciB8IG51bGw7XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBSZWN0YW5ndWxhckJ1dHRvbk9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIEV4dGVybmFsQnV0dG9uTm9kZU9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSZWN0YW5ndWxhckJ1dHRvbiBleHRlbmRzIEJ1dHRvbk5vZGUge1xyXG5cclxuICBwdWJsaWMgc3RhdGljIFRocmVlREFwcGVhcmFuY2VTdHJhdGVneTogVEJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneTtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIGJ1dHRvbk1vZGVsIC0gTW9kZWwgdGhhdCBkZWZpbmVzIHRoZSBidXR0b24ncyBiZWhhdmlvci5cclxuICAgKiBAcGFyYW0gaW50ZXJhY3Rpb25TdGF0ZVByb3BlcnR5IC0gYSBQcm9wZXJ0eSB0aGF0IGlzIHVzZWQgdG8gZHJpdmUgdGhlIHZpc3VhbCBhcHBlYXJhbmNlIG9mIHRoZSBidXR0b25cclxuICAgKiBAcGFyYW0gcHJvdmlkZWRPcHRpb25zXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKCBidXR0b25Nb2RlbDogQnV0dG9uTW9kZWwsIGludGVyYWN0aW9uU3RhdGVQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8QnV0dG9uSW50ZXJhY3Rpb25TdGF0ZT4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnM/OiBSZWN0YW5ndWxhckJ1dHRvbk9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxSZWN0YW5ndWxhckJ1dHRvbk9wdGlvbnMsIFNlbGZPcHRpb25zLCBCdXR0b25Ob2RlT3B0aW9ucz4oKSgge1xyXG4gICAgICBzaXplOiBudWxsLFxyXG5cclxuICAgICAgbWluV2lkdGg6IEhPUklaT05UQUxfSElHSExJR0hUX0dSQURJRU5UX0xFTkdUSCArIFNIQURFX0dSQURJRU5UX0xFTkdUSCxcclxuICAgICAgbWluSGVpZ2h0OiBWRVJUSUNBTF9ISUdITElHSFRfR1JBRElFTlRfTEVOR1RIICsgU0hBREVfR1JBRElFTlRfTEVOR1RILFxyXG5cclxuICAgICAgeE1hcmdpbjogOCwgLy8gc2hvdWxkIGJlIHZpc2libHkgZ3JlYXRlciB0aGFuIHlNYXJnaW4sIHNlZSBpc3N1ZSAjMTA5XHJcbiAgICAgIHlNYXJnaW46IDUsXHJcblxyXG4gICAgICB0b3VjaEFyZWFYRGlsYXRpb246IDAsXHJcbiAgICAgIHRvdWNoQXJlYVlEaWxhdGlvbjogMCxcclxuICAgICAgbW91c2VBcmVhWERpbGF0aW9uOiAwLFxyXG4gICAgICBtb3VzZUFyZWFZRGlsYXRpb246IDAsXHJcblxyXG4gICAgICB0b3VjaEFyZWFYU2hpZnQ6IDAsXHJcbiAgICAgIHRvdWNoQXJlYVlTaGlmdDogMCxcclxuICAgICAgbW91c2VBcmVhWFNoaWZ0OiAwLFxyXG4gICAgICBtb3VzZUFyZWFZU2hpZnQ6IDAsXHJcblxyXG4gICAgICBzdHJva2U6IG51bGwsIC8vIG51bGwgYnkgZGVmYXVsdCwgd2hpY2ggd2lsbCBjYXVzZSBhIHN0cm9rZSB0byBiZSBkZXJpdmVkIGZyb20gdGhlIGJhc2UgY29sb3JcclxuICAgICAgbGluZVdpZHRoOiAwLjUsXHJcbiAgICAgIGNvcm5lclJhZGl1czogNCxcclxuXHJcbiAgICAgIGxlZnRUb3BDb3JuZXJSYWRpdXM6IG51bGwsXHJcbiAgICAgIHJpZ2h0VG9wQ29ybmVyUmFkaXVzOiBudWxsLFxyXG4gICAgICBsZWZ0Qm90dG9tQ29ybmVyUmFkaXVzOiBudWxsLFxyXG4gICAgICByaWdodEJvdHRvbUNvcm5lclJhZGl1czogbnVsbCxcclxuXHJcbiAgICAgIC8vIENsYXNzIHRoYXQgZGV0ZXJtaW5lcyB0aGUgYnV0dG9uJ3MgYXBwZWFyYW5jZSBmb3IgdGhlIHZhbHVlcyBvZiBpbnRlcmFjdGlvblN0YXRlUHJvcGVydHkuXHJcbiAgICAgIC8vIFNlZSBSZWN0YW5ndWxhckJ1dHRvbi5UaHJlZURBcHBlYXJhbmNlU3RyYXRlZ3kgZm9yIGFuIGV4YW1wbGUgb2YgdGhlIGludGVyZmFjZSByZXF1aXJlZC5cclxuICAgICAgYnV0dG9uQXBwZWFyYW5jZVN0cmF0ZWd5OiBSZWN0YW5ndWxhckJ1dHRvbi5UaHJlZURBcHBlYXJhbmNlU3RyYXRlZ3lcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGlmICggIW9wdGlvbnMuY29udGVudCApIHtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5zaXplICE9PSB1bmRlZmluZWQsICdidXR0b24gZGltZW5zaW9ucyBuZWVkZWQgaWYgbm8gY29udGVudCBpcyBzdXBwbGllZC4nICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCBvcHRpb25zLnNpemUgKSB7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMueE1hcmdpbiA8IG9wdGlvbnMuc2l6ZS53aWR0aCwgJ3hNYXJnaW4gY2Fubm90IGJlIGxhcmdlciB0aGFuIHdpZHRoJyApO1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zLnlNYXJnaW4gPCBvcHRpb25zLnNpemUuaGVpZ2h0LCAneU1hcmdpbiBjYW5ub3QgYmUgbGFyZ2VyIHRoYW4gaGVpZ2h0JyApO1xyXG5cclxuICAgICAgb3B0aW9ucy5taW5VbnN0cm9rZWRXaWR0aCA9IG9wdGlvbnMuc2l6ZS53aWR0aDtcclxuICAgICAgb3B0aW9ucy5taW5VbnN0cm9rZWRIZWlnaHQgPSBvcHRpb25zLnNpemUuaGVpZ2h0O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGlmICggb3B0aW9ucy5taW5XaWR0aCAhPT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgIG9wdGlvbnMubWluVW5zdHJva2VkV2lkdGggPSBvcHRpb25zLm1pbldpZHRoO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICggb3B0aW9ucy5taW5IZWlnaHQgIT09IHVuZGVmaW5lZCApIHtcclxuICAgICAgICBvcHRpb25zLm1pblVuc3Ryb2tlZEhlaWdodCA9IG9wdGlvbnMubWluSGVpZ2h0O1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgbm8gb3B0aW9ucyB3ZXJlIGV4cGxpY2l0bHkgcGFzc2VkIGluIGZvciB0aGUgYnV0dG9uIGFwcGVhcmFuY2Ugc3RyYXRlZ3ksIHBhc3MgdGhyb3VnaCB0aGUgZ2VuZXJhbCBhcHBlYXJhbmNlXHJcbiAgICAvLyBvcHRpb25zLlxyXG4gICAgaWYgKCAhb3B0aW9ucy5idXR0b25BcHBlYXJhbmNlU3RyYXRlZ3lPcHRpb25zICkge1xyXG4gICAgICBvcHRpb25zLmJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneU9wdGlvbnMgPSB7XHJcbiAgICAgICAgc3Ryb2tlOiBvcHRpb25zLnN0cm9rZSxcclxuICAgICAgICBsaW5lV2lkdGg6IG9wdGlvbnMubGluZVdpZHRoXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ29tcHV0ZSB0aGUgc2l6ZSBvZiB0aGUgYnV0dG9uLlxyXG4gICAgbGV0IGJ1dHRvbldpZHRoOiBudW1iZXI7XHJcbiAgICBsZXQgYnV0dG9uSGVpZ2h0OiBudW1iZXI7XHJcblxyXG4gICAgaWYgKCBvcHRpb25zLnNpemUgKSB7XHJcbiAgICAgIGJ1dHRvbldpZHRoID0gb3B0aW9ucy5zaXplLndpZHRoO1xyXG4gICAgICBidXR0b25IZWlnaHQgPSBvcHRpb25zLnNpemUuaGVpZ2h0O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGJ1dHRvbldpZHRoID0gTWF0aC5tYXgoIG9wdGlvbnMuY29udGVudCA/IG9wdGlvbnMuY29udGVudC53aWR0aCArIG9wdGlvbnMueE1hcmdpbiAqIDIgOiAwLCBvcHRpb25zLm1pbldpZHRoICk7XHJcbiAgICAgIGJ1dHRvbkhlaWdodCA9IE1hdGgubWF4KCBvcHRpb25zLmNvbnRlbnQgPyBvcHRpb25zLmNvbnRlbnQuaGVpZ2h0ICsgb3B0aW9ucy55TWFyZ2luICogMiA6IDAsIG9wdGlvbnMubWluSGVpZ2h0ICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSByZWN0YW5ndWxhciBwYXJ0IG9mIHRoZSBidXR0b24uXHJcbiAgICBjb25zdCBidXR0b25CYWNrZ3JvdW5kID0gbmV3IFBhdGgoIGNyZWF0ZUJ1dHRvblNoYXBlKCBidXR0b25XaWR0aCwgYnV0dG9uSGVpZ2h0LCBvcHRpb25zICkgKTtcclxuXHJcbiAgICBpZiAoIG9wdGlvbnMuc2l6ZSAmJiBvcHRpb25zLmNvbnRlbnQgKSB7XHJcbiAgICAgIGNvbnN0IHByZXZpb3VzQ29udGVudCA9IG9wdGlvbnMuY29udGVudDtcclxuICAgICAgY29uc3QgbWluU2NhbGUgPSBNYXRoLm1pbihcclxuICAgICAgICAoIG9wdGlvbnMuc2l6ZS53aWR0aCAtIG9wdGlvbnMueE1hcmdpbiAqIDIgKSAvIHByZXZpb3VzQ29udGVudC53aWR0aCxcclxuICAgICAgICAoIG9wdGlvbnMuc2l6ZS5oZWlnaHQgLSBvcHRpb25zLnlNYXJnaW4gKiAyICkgLyBwcmV2aW91c0NvbnRlbnQuaGVpZ2h0ICk7XHJcblxyXG4gICAgICBvcHRpb25zLmNvbnRlbnQgPSBuZXcgTm9kZSgge1xyXG4gICAgICAgIGNoaWxkcmVuOiBbIHByZXZpb3VzQ29udGVudCBdLFxyXG4gICAgICAgIHNjYWxlOiBtaW5TY2FsZVxyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgc3VwZXIoIGJ1dHRvbk1vZGVsLCBidXR0b25CYWNrZ3JvdW5kLCBpbnRlcmFjdGlvblN0YXRlUHJvcGVydHksIG9wdGlvbnMgKTtcclxuXHJcbiAgICBsZXQgaXNGaXJzdGxheW91dCA9IHRydWU7XHJcbiAgICBNdWx0aWxpbmsubXVsdGlsaW5rKCBbXHJcbiAgICAgIHRoaXMuaXNXaWR0aFJlc2l6YWJsZVByb3BlcnR5LFxyXG4gICAgICB0aGlzLmlzSGVpZ2h0UmVzaXphYmxlUHJvcGVydHksXHJcbiAgICAgIHRoaXMubGF5b3V0U2l6ZVByb3BlcnR5XHJcbiAgICBdLCAoIGlzV2lkdGhTaXphYmxlLCBpc0hlaWdodFNpemFibGUsIGxheW91dFNpemUgKSA9PiB7XHJcbiAgICAgIGlmICggaXNXaWR0aFNpemFibGUgfHwgaXNIZWlnaHRTaXphYmxlICkge1xyXG4gICAgICAgIGJ1dHRvbkJhY2tncm91bmQuc2hhcGUgPSBjcmVhdGVCdXR0b25TaGFwZShcclxuICAgICAgICAgIGlzV2lkdGhTaXphYmxlID8gbGF5b3V0U2l6ZS53aWR0aCAtIHRoaXMubWF4TGluZVdpZHRoIDogYnV0dG9uV2lkdGgsXHJcbiAgICAgICAgICBpc0hlaWdodFNpemFibGUgPyBsYXlvdXRTaXplLmhlaWdodCAtIHRoaXMubWF4TGluZVdpZHRoIDogYnV0dG9uSGVpZ2h0LFxyXG4gICAgICAgICAgb3B0aW9ucyApO1xyXG4gICAgICAgIGFzc2VydCAmJiBhc3NlcnQoICFpc1dpZHRoU2l6YWJsZSB8fCBidXR0b25CYWNrZ3JvdW5kLndpZHRoIDw9IGxheW91dFNpemUud2lkdGggKyAxZS03LCAnYnV0dG9uIHdpZHRoIGNhbm5vdCBleGNlZWQgbGF5b3V0IHdpZHRoJyApO1xyXG4gICAgICAgIGFzc2VydCAmJiBhc3NlcnQoICFpc0hlaWdodFNpemFibGUgfHwgYnV0dG9uQmFja2dyb3VuZC5oZWlnaHQgPD0gbGF5b3V0U2l6ZS5oZWlnaHQgKyAxZS03LCAnYnV0dG9uIHdpZHRoIGNhbm5vdCBleGNlZWQgbGF5b3V0IGhlaWdodCcgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCBpc0ZpcnN0bGF5b3V0IHx8IGlzV2lkdGhTaXphYmxlIHx8IGlzSGVpZ2h0U2l6YWJsZSApIHtcclxuICAgICAgICAvLyBTZXQgcG9pbnRlciBhcmVhcy5cclxuICAgICAgICB0aGlzLnRvdWNoQXJlYSA9IGJ1dHRvbkJhY2tncm91bmQubG9jYWxCb3VuZHNcclxuICAgICAgICAgIC5kaWxhdGVkWFkoIG9wdGlvbnMudG91Y2hBcmVhWERpbGF0aW9uLCBvcHRpb25zLnRvdWNoQXJlYVlEaWxhdGlvbiApXHJcbiAgICAgICAgICAuc2hpZnRlZFhZKCBvcHRpb25zLnRvdWNoQXJlYVhTaGlmdCwgb3B0aW9ucy50b3VjaEFyZWFZU2hpZnQgKTtcclxuICAgICAgICB0aGlzLm1vdXNlQXJlYSA9IGJ1dHRvbkJhY2tncm91bmQubG9jYWxCb3VuZHNcclxuICAgICAgICAgIC5kaWxhdGVkWFkoIG9wdGlvbnMubW91c2VBcmVhWERpbGF0aW9uLCBvcHRpb25zLm1vdXNlQXJlYVlEaWxhdGlvbiApXHJcbiAgICAgICAgICAuc2hpZnRlZFhZKCBvcHRpb25zLm1vdXNlQXJlYVhTaGlmdCwgb3B0aW9ucy5tb3VzZUFyZWFZU2hpZnQgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaXNGaXJzdGxheW91dCA9IGZhbHNlO1xyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENvbnZlbmllbmNlIGZ1bmN0aW9uIGZvciBjcmVhdGluZyB0aGUgc2hhcGUgb2YgdGhlIGJ1dHRvbiwgZG9uZSB0byBhdm9pZCBjb2RlIGR1cGxpY2F0aW9uXHJcbiAqIEBwYXJhbSB3aWR0aFxyXG4gKiBAcGFyYW0gaGVpZ2h0XHJcbiAqIEBwYXJhbSBjb25maWcgLSBSZWN0YW5ndWxhckJ1dHRvbiBjb25maWcsIGNvbnRhaW5pbmcgdmFsdWVzIHJlbGF0ZWQgdG8gcmFkaWkgb2YgYnV0dG9uIGNvcm5lcnNcclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZUJ1dHRvblNoYXBlKCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZzogUGlja1JlcXVpcmVkPFJlY3Rhbmd1bGFyQnV0dG9uT3B0aW9ucywgJ2Nvcm5lclJhZGl1cycgfCAnbGVmdFRvcENvcm5lclJhZGl1cycgfCAncmlnaHRUb3BDb3JuZXJSYWRpdXMnIHwgJ2xlZnRCb3R0b21Db3JuZXJSYWRpdXMnIHwgJ3JpZ2h0Qm90dG9tQ29ybmVyUmFkaXVzJz4gKTogU2hhcGUge1xyXG5cclxuICAvLyBEb24ndCBhbGxvdyBhIGNvcm5lciByYWRpdXMgdGhhdCBpcyBsYXJnZXIgdGhhbiBoYWxmIHRoZSB3aWR0aCBvciBoZWlnaHQsIHNlZVxyXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy91bmRlci1wcmVzc3VyZS9pc3N1ZXMvMTUxXHJcbiAgY29uc3QgbWF4Q29ybmVyID0gTWF0aC5taW4oIHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiApO1xyXG5cclxuICByZXR1cm4gU2hhcGUucm91bmRlZFJlY3RhbmdsZVdpdGhSYWRpaSggMCwgMCwgd2lkdGgsIGhlaWdodCwge1xyXG4gICAgdG9wTGVmdDogTWF0aC5taW4oIG1heENvcm5lciwgY29uZmlnLmxlZnRUb3BDb3JuZXJSYWRpdXMgIT09IG51bGwgPyBjb25maWcubGVmdFRvcENvcm5lclJhZGl1cyA6IGNvbmZpZy5jb3JuZXJSYWRpdXMgKSxcclxuICAgIHRvcFJpZ2h0OiBNYXRoLm1pbiggbWF4Q29ybmVyLCBjb25maWcucmlnaHRUb3BDb3JuZXJSYWRpdXMgIT09IG51bGwgPyBjb25maWcucmlnaHRUb3BDb3JuZXJSYWRpdXMgOiBjb25maWcuY29ybmVyUmFkaXVzICksXHJcbiAgICBib3R0b21MZWZ0OiBNYXRoLm1pbiggbWF4Q29ybmVyLCBjb25maWcubGVmdEJvdHRvbUNvcm5lclJhZGl1cyAhPT0gbnVsbCA/IGNvbmZpZy5sZWZ0Qm90dG9tQ29ybmVyUmFkaXVzIDogY29uZmlnLmNvcm5lclJhZGl1cyApLFxyXG4gICAgYm90dG9tUmlnaHQ6IE1hdGgubWluKCBtYXhDb3JuZXIsIGNvbmZpZy5yaWdodEJvdHRvbUNvcm5lclJhZGl1cyAhPT0gbnVsbCA/IGNvbmZpZy5yaWdodEJvdHRvbUNvcm5lclJhZGl1cyA6IGNvbmZpZy5jb3JuZXJSYWRpdXMgKVxyXG4gIH0gKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFRocmVlREFwcGVhcmFuY2VTdHJhdGVneSBpcyBhIHZhbHVlIGZvciBSZWN0YW5ndWxhckJ1dHRvbiBvcHRpb25zLmJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneS4gSXQgbWFrZXMgYSByZWN0YW5ndWxhclxyXG4gKiBidXR0b24gbG9vayAzRC1pc2ggYnkgdXNpbmcgZ3JhZGllbnRzIHRoYXQgY3JlYXRlIHRoZSBhcHBlYXJhbmNlIG9mIGhpZ2hsaWdodGVkIGFuZCBzaGFkZWQgZWRnZXMuIFRoZSBncmFkaWVudHMgYXJlXHJcbiAqIHNldCB1cCB0byBtYWtlIHRoZSBsaWdodCBzb3VyY2UgYXBwZWFyIHRvIGJlIGluIHRoZSB1cHBlciBsZWZ0LlxyXG4gKi9cclxuY2xhc3MgVGhyZWVEQXBwZWFyYW5jZVN0cmF0ZWd5IHtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IG1heExpbmVXaWR0aDogbnVtYmVyO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VUaHJlZURBcHBlYXJhbmNlU3RyYXRlZ3k6ICgpID0+IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBidXR0b25CYWNrZ3JvdW5kIC0gdGhlIE5vZGUgZm9yIHRoZSBidXR0b24ncyBiYWNrZ3JvdW5kLCBzYW5zIGNvbnRlbnRcclxuICAgKiBAcGFyYW0gaW50ZXJhY3Rpb25TdGF0ZVByb3BlcnR5XHJcbiAgICogQHBhcmFtIGJhc2VDb2xvclByb3BlcnR5XHJcbiAgICogQHBhcmFtIFtwcm92aWRlZE9wdGlvbnNdXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBidXR0b25CYWNrZ3JvdW5kOiBQYXRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgaW50ZXJhY3Rpb25TdGF0ZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxCdXR0b25JbnRlcmFjdGlvblN0YXRlIHwgUmFkaW9CdXR0b25JbnRlcmFjdGlvblN0YXRlPixcclxuICAgICAgICAgICAgICAgICAgICAgIGJhc2VDb2xvclByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxDb2xvcj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnM/OiBUQnV0dG9uQXBwZWFyYW5jZVN0cmF0ZWd5T3B0aW9ucyApIHtcclxuXHJcbiAgICAvLyBJZiBzdHJva2UgYW5kIGxpbmVXaWR0aCBleGlzdCBpbiB0aGUgcHJvdmlkZWQgb3B0aW9ucywgdGhleSBiZWNvbWUgdGhlIGRlZmF1bHQgZm9yIGFsbCBzdHJva2VzIGFuZCBsaW5lIHdpZHRocy5cclxuICAgIC8vIElmIG5vdCwgZGVmYXVsdHMgYXJlIGNyZWF0ZWQuXHJcbiAgICBjb25zdCBkZWZhdWx0U3Ryb2tlID0gKCBwcm92aWRlZE9wdGlvbnMgJiYgcHJvdmlkZWRPcHRpb25zLnN0cm9rZSApID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnMuc3Ryb2tlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUGFpbnRDb2xvclByb3BlcnR5KCBiYXNlQ29sb3JQcm9wZXJ0eSwgeyBsdW1pbmFuY2VGYWN0b3I6IC0wLjQgfSApO1xyXG4gICAgY29uc3QgZGVmYXVsdExpbmVXaWR0aCA9ICggcHJvdmlkZWRPcHRpb25zICYmIHByb3ZpZGVkT3B0aW9ucy5saW5lV2lkdGggIT09IHVuZGVmaW5lZCApID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnMubGluZVdpZHRoIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLjU7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxUQnV0dG9uQXBwZWFyYW5jZVN0cmF0ZWd5T3B0aW9ucz4oKSgge1xyXG4gICAgICBzdHJva2U6IGRlZmF1bHRTdHJva2UsXHJcbiAgICAgIGxpbmVXaWR0aDogZGVmYXVsdExpbmVXaWR0aCxcclxuICAgICAgb3ZlclN0cm9rZTogZGVmYXVsdFN0cm9rZSxcclxuICAgICAgb3ZlckxpbmVXaWR0aDogZGVmYXVsdExpbmVXaWR0aCxcclxuICAgICAgb3ZlckZpbGw6IGJhc2VDb2xvclByb3BlcnR5LFxyXG4gICAgICBvdmVyQnV0dG9uT3BhY2l0eTogMSxcclxuICAgICAgc2VsZWN0ZWRTdHJva2U6IGRlZmF1bHRTdHJva2UsXHJcbiAgICAgIHNlbGVjdGVkTGluZVdpZHRoOiBkZWZhdWx0TGluZVdpZHRoLFxyXG4gICAgICBzZWxlY3RlZEJ1dHRvbk9wYWNpdHk6IDEsXHJcbiAgICAgIGRlc2VsZWN0ZWRTdHJva2U6IGRlZmF1bHRTdHJva2UsXHJcbiAgICAgIGRlc2VsZWN0ZWRMaW5lV2lkdGg6IGRlZmF1bHRMaW5lV2lkdGgsXHJcbiAgICAgIGRlc2VsZWN0ZWRCdXR0b25PcGFjaXR5OiAxXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIGNvbG9ycyB0aGF0IHdpbGwgYmUgdXNlZCB0byBwcm9kdWNlIHRoZSBncmFkaWVudHMgYW5kIHNoYWRpbmcgbmVlZGVkIGZvciB0aGUgM0QgYXBwZWFyYW5jZS5cclxuICAgIGNvbnN0IGJhc2VCcmlnaHRlcjdQcm9wZXJ0eSA9IG5ldyBQYWludENvbG9yUHJvcGVydHkoIGJhc2VDb2xvclByb3BlcnR5LCB7IGx1bWluYW5jZUZhY3RvcjogMC43IH0gKTtcclxuICAgIGNvbnN0IGJhc2VCcmlnaHRlcjVQcm9wZXJ0eSA9IG5ldyBQYWludENvbG9yUHJvcGVydHkoIGJhc2VDb2xvclByb3BlcnR5LCB7IGx1bWluYW5jZUZhY3RvcjogMC41IH0gKTtcclxuICAgIGNvbnN0IGJhc2VCcmlnaHRlcjJQcm9wZXJ0eSA9IG5ldyBQYWludENvbG9yUHJvcGVydHkoIGJhc2VDb2xvclByb3BlcnR5LCB7IGx1bWluYW5jZUZhY3RvcjogMC4yIH0gKTtcclxuICAgIGNvbnN0IGJhc2VEYXJrZXIzUHJvcGVydHkgPSBuZXcgUGFpbnRDb2xvclByb3BlcnR5KCBiYXNlQ29sb3JQcm9wZXJ0eSwgeyBsdW1pbmFuY2VGYWN0b3I6IC0wLjMgfSApO1xyXG4gICAgY29uc3QgYmFzZURhcmtlcjRQcm9wZXJ0eSA9IG5ldyBQYWludENvbG9yUHJvcGVydHkoIGJhc2VDb2xvclByb3BlcnR5LCB7IGx1bWluYW5jZUZhY3RvcjogLTAuNCB9ICk7XHJcbiAgICBjb25zdCBiYXNlRGFya2VyNVByb3BlcnR5ID0gbmV3IFBhaW50Q29sb3JQcm9wZXJ0eSggYmFzZUNvbG9yUHJvcGVydHksIHsgbHVtaW5hbmNlRmFjdG9yOiAtMC41IH0gKTtcclxuICAgIGNvbnN0IGJhc2VUcmFuc3BhcmVudFByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBiYXNlQ29sb3JQcm9wZXJ0eSBdLCBjb2xvciA9PiBjb2xvci53aXRoQWxwaGEoIDAgKSApO1xyXG4gICAgY29uc3QgdHJhbnNwYXJlbnRXaGl0ZSA9IG5ldyBDb2xvciggMjU1LCAyNTUsIDI1NSwgMC43ICk7XHJcblxyXG4gICAgLy8gQWRkcyBzaGFkaW5nIHRvIGxlZnQgYW5kIHJpZ2h0IGVkZ2VzIG9mIHRoZSBidXR0b24uXHJcbiAgICBjb25zdCBob3Jpem9udGFsU2hhZGluZ1BhdGggPSBuZXcgUGF0aCggbnVsbCwge1xyXG4gICAgICBzdHJva2U6IG9wdGlvbnMuc3Ryb2tlLFxyXG4gICAgICBsaW5lV2lkdGg6IG9wdGlvbnMubGluZVdpZHRoLFxyXG4gICAgICBwaWNrYWJsZTogZmFsc2VcclxuICAgIH0gKTtcclxuICAgIGJ1dHRvbkJhY2tncm91bmQuYWRkQ2hpbGQoIGhvcml6b250YWxTaGFkaW5nUGF0aCApO1xyXG5cclxuICAgIHRoaXMubWF4TGluZVdpZHRoID0gdHlwZW9mIG9wdGlvbnMubGluZVdpZHRoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMubGluZVdpZHRoIDogMDtcclxuXHJcbiAgICBsZXQgaW50ZXJhY3Rpb25TdGF0ZUxpc3RlbmVyOiAoIGludGVyYWN0aW9uU3RhdGU6IEJ1dHRvbkludGVyYWN0aW9uU3RhdGUgKSA9PiB2b2lkO1xyXG5cclxuICAgIC8vIFdlJ2xsIG5lZWQgdG8gbGlzdGVuIHRvIHRoZSBzaGFwZSBjaGFuZ2VzIGluIG9yZGVyIHRvIHVwZGF0ZSBvdXIgYXBwZWFyYW5jZS5cclxuICAgIGNvbnN0IGxpc3RlbmVyID0gKCkgPT4ge1xyXG5cclxuICAgICAgLy8gSGFuZGxlIG91ciBncmFkaWVudHMgYmFzZWQgb24gdGhlIHBhdGgncyBhY3R1YWwgc2hhcGUsIE5PVCBpbmNsdWRpbmcgdGhlIHN0cm9rZWQgcGFydFxyXG4gICAgICBjb25zdCBidXR0b25XaWR0aCA9IGJ1dHRvbkJhY2tncm91bmQuc2hhcGUhLmJvdW5kcy53aWR0aDtcclxuICAgICAgY29uc3QgYnV0dG9uSGVpZ2h0ID0gYnV0dG9uQmFja2dyb3VuZC5zaGFwZSEuYm91bmRzLmhlaWdodDtcclxuXHJcbiAgICAgIGhvcml6b250YWxTaGFkaW5nUGF0aC5zaGFwZSA9IGJ1dHRvbkJhY2tncm91bmQuc2hhcGU7XHJcblxyXG4gICAgICAvLyBjb21wdXRlIGNvbG9yIHN0b3BzIGZvciBncmFkaWVudCwgc2VlIGlzc3VlICMxNDhcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggYnV0dG9uV2lkdGggPj0gSE9SSVpPTlRBTF9ISUdITElHSFRfR1JBRElFTlRfTEVOR1RIICsgU0hBREVfR1JBRElFTlRfTEVOR1RIICk7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIGJ1dHRvbkhlaWdodCA+PSBWRVJUSUNBTF9ISUdITElHSFRfR1JBRElFTlRfTEVOR1RIICsgU0hBREVfR1JBRElFTlRfTEVOR1RIICk7XHJcbiAgICAgIGNvbnN0IHZlcnRpY2FsSGlnaGxpZ2h0U3RvcCA9IE1hdGgubWluKCBWRVJUSUNBTF9ISUdITElHSFRfR1JBRElFTlRfTEVOR1RIIC8gYnV0dG9uSGVpZ2h0LCAxICk7XHJcbiAgICAgIGNvbnN0IHZlcnRpY2FsU2hhZG93U3RvcCA9IE1hdGgubWF4KCAxIC0gU0hBREVfR1JBRElFTlRfTEVOR1RIIC8gYnV0dG9uSGVpZ2h0LCAwICk7XHJcbiAgICAgIGNvbnN0IGhvcml6b250YWxIaWdobGlnaHRTdG9wID0gTWF0aC5taW4oIEhPUklaT05UQUxfSElHSExJR0hUX0dSQURJRU5UX0xFTkdUSCAvIGJ1dHRvbldpZHRoLCAxICk7XHJcbiAgICAgIGNvbnN0IGhvcml6b250YWxTaGFkb3dTdG9wID0gTWF0aC5tYXgoIDEgLSBTSEFERV9HUkFESUVOVF9MRU5HVEggLyBidXR0b25XaWR0aCwgMCApO1xyXG5cclxuICAgICAgLy8gR3JhZGllbnQgZmlsbHMgZm9yIGJ1dHRvbiBzdGF0ZXNcclxuICAgICAgY29uc3QgdXBGaWxsVmVydGljYWwgPSBuZXcgTGluZWFyR3JhZGllbnQoIDAsIDAsIDAsIGJ1dHRvbkhlaWdodCApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggMCwgYmFzZUJyaWdodGVyN1Byb3BlcnR5IClcclxuICAgICAgICAuYWRkQ29sb3JTdG9wKCB2ZXJ0aWNhbEhpZ2hsaWdodFN0b3AsIGJhc2VDb2xvclByb3BlcnR5IClcclxuICAgICAgICAuYWRkQ29sb3JTdG9wKCB2ZXJ0aWNhbFNoYWRvd1N0b3AsIGJhc2VDb2xvclByb3BlcnR5IClcclxuICAgICAgICAuYWRkQ29sb3JTdG9wKCAxLCBiYXNlRGFya2VyNVByb3BlcnR5ICk7XHJcblxyXG4gICAgICBjb25zdCB1cEZpbGxIb3Jpem9udGFsID0gbmV3IExpbmVhckdyYWRpZW50KCAwLCAwLCBidXR0b25XaWR0aCwgMCApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggMCwgdHJhbnNwYXJlbnRXaGl0ZSApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggaG9yaXpvbnRhbEhpZ2hsaWdodFN0b3AsIGJhc2VUcmFuc3BhcmVudFByb3BlcnR5IClcclxuICAgICAgICAuYWRkQ29sb3JTdG9wKCBob3Jpem9udGFsU2hhZG93U3RvcCwgYmFzZVRyYW5zcGFyZW50UHJvcGVydHkgKVxyXG4gICAgICAgIC5hZGRDb2xvclN0b3AoIDEsIGJhc2VEYXJrZXI1UHJvcGVydHkgKTtcclxuXHJcbiAgICAgIGNvbnN0IG92ZXJGaWxsVmVydGljYWwgPSBuZXcgTGluZWFyR3JhZGllbnQoIDAsIDAsIDAsIGJ1dHRvbkhlaWdodCApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggMCwgYmFzZUJyaWdodGVyN1Byb3BlcnR5IClcclxuICAgICAgICAuYWRkQ29sb3JTdG9wKCB2ZXJ0aWNhbEhpZ2hsaWdodFN0b3AsIGJhc2VCcmlnaHRlcjVQcm9wZXJ0eSApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggdmVydGljYWxTaGFkb3dTdG9wLCBiYXNlQnJpZ2h0ZXI1UHJvcGVydHkgKVxyXG4gICAgICAgIC5hZGRDb2xvclN0b3AoIDEsIGJhc2VEYXJrZXI1UHJvcGVydHkgKTtcclxuXHJcbiAgICAgIGNvbnN0IG92ZXJGaWxsSG9yaXpvbnRhbCA9IG5ldyBMaW5lYXJHcmFkaWVudCggMCwgMCwgYnV0dG9uV2lkdGgsIDAgKVxyXG4gICAgICAgIC5hZGRDb2xvclN0b3AoIDAsIHRyYW5zcGFyZW50V2hpdGUgKVxyXG4gICAgICAgIC5hZGRDb2xvclN0b3AoIGhvcml6b250YWxIaWdobGlnaHRTdG9wIC8gMiwgbmV3IENvbG9yKCAyNTUsIDI1NSwgMjU1LCAwICkgKVxyXG4gICAgICAgIC5hZGRDb2xvclN0b3AoIGhvcml6b250YWxTaGFkb3dTdG9wLCBiYXNlVHJhbnNwYXJlbnRQcm9wZXJ0eSApXHJcbiAgICAgICAgLmFkZENvbG9yU3RvcCggMSwgYmFzZURhcmtlcjNQcm9wZXJ0eSApO1xyXG5cclxuICAgICAgY29uc3QgZG93bkZpbGxWZXJ0aWNhbCA9IG5ldyBMaW5lYXJHcmFkaWVudCggMCwgMCwgMCwgYnV0dG9uSGVpZ2h0IClcclxuICAgICAgICAuYWRkQ29sb3JTdG9wKCAwLCBiYXNlQnJpZ2h0ZXI3UHJvcGVydHkgKVxyXG4gICAgICAgIC5hZGRDb2xvclN0b3AoIHZlcnRpY2FsSGlnaGxpZ2h0U3RvcCAqIDAuNjcsIGJhc2VEYXJrZXIzUHJvcGVydHkgKVxyXG4gICAgICAgIC5hZGRDb2xvclN0b3AoIHZlcnRpY2FsU2hhZG93U3RvcCwgYmFzZUJyaWdodGVyMlByb3BlcnR5IClcclxuICAgICAgICAuYWRkQ29sb3JTdG9wKCAxLCBiYXNlRGFya2VyNVByb3BlcnR5ICk7XHJcblxyXG4gICAgICAvLyBDYWNoZSBncmFkaWVudHNcclxuICAgICAgYnV0dG9uQmFja2dyb3VuZC5jYWNoZWRQYWludHMgPSBbIHVwRmlsbFZlcnRpY2FsLCBvdmVyRmlsbFZlcnRpY2FsLCBkb3duRmlsbFZlcnRpY2FsIF07XHJcbiAgICAgIGhvcml6b250YWxTaGFkaW5nUGF0aC5jYWNoZWRQYWludHMgPSBbIHVwRmlsbEhvcml6b250YWwsIG92ZXJGaWxsSG9yaXpvbnRhbCBdO1xyXG5cclxuICAgICAgaW50ZXJhY3Rpb25TdGF0ZUxpc3RlbmVyICYmIGludGVyYWN0aW9uU3RhdGVQcm9wZXJ0eS51bmxpbmsoIGludGVyYWN0aW9uU3RhdGVMaXN0ZW5lciApO1xyXG5cclxuICAgICAgLy8gQ2hhbmdlIGNvbG9ycyB0byBtYXRjaCBpbnRlcmFjdGlvblN0YXRlXHJcbiAgICAgIGludGVyYWN0aW9uU3RhdGVMaXN0ZW5lciA9ICggaW50ZXJhY3Rpb25TdGF0ZTogQnV0dG9uSW50ZXJhY3Rpb25TdGF0ZSApID0+IHtcclxuXHJcbiAgICAgICAgc3dpdGNoKCBpbnRlcmFjdGlvblN0YXRlICkge1xyXG5cclxuICAgICAgICAgIGNhc2UgQnV0dG9uSW50ZXJhY3Rpb25TdGF0ZS5JRExFOlxyXG4gICAgICAgICAgICBidXR0b25CYWNrZ3JvdW5kLmZpbGwgPSB1cEZpbGxWZXJ0aWNhbDtcclxuICAgICAgICAgICAgYnV0dG9uQmFja2dyb3VuZC5zdHJva2UgPSBvcHRpb25zLmRlc2VsZWN0ZWRTdHJva2U7XHJcbiAgICAgICAgICAgIGJ1dHRvbkJhY2tncm91bmQubGluZVdpZHRoID0gb3B0aW9ucy5kZXNlbGVjdGVkTGluZVdpZHRoO1xyXG4gICAgICAgICAgICBidXR0b25CYWNrZ3JvdW5kLm9wYWNpdHkgPSBvcHRpb25zLmRlc2VsZWN0ZWRCdXR0b25PcGFjaXR5O1xyXG4gICAgICAgICAgICBob3Jpem9udGFsU2hhZGluZ1BhdGguZmlsbCA9IHVwRmlsbEhvcml6b250YWw7XHJcbiAgICAgICAgICAgIGhvcml6b250YWxTaGFkaW5nUGF0aC5vcGFjaXR5ID0gb3B0aW9ucy5kZXNlbGVjdGVkQnV0dG9uT3BhY2l0eTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgY2FzZSBCdXR0b25JbnRlcmFjdGlvblN0YXRlLk9WRVI6XHJcbiAgICAgICAgICAgIGJ1dHRvbkJhY2tncm91bmQuZmlsbCA9IG92ZXJGaWxsVmVydGljYWw7XHJcbiAgICAgICAgICAgIGJ1dHRvbkJhY2tncm91bmQuc3Ryb2tlID0gb3B0aW9ucy5vdmVyU3Ryb2tlO1xyXG4gICAgICAgICAgICBidXR0b25CYWNrZ3JvdW5kLmxpbmVXaWR0aCA9IG9wdGlvbnMub3ZlckxpbmVXaWR0aDtcclxuICAgICAgICAgICAgYnV0dG9uQmFja2dyb3VuZC5vcGFjaXR5ID0gb3B0aW9ucy5vdmVyQnV0dG9uT3BhY2l0eTtcclxuICAgICAgICAgICAgaG9yaXpvbnRhbFNoYWRpbmdQYXRoLmZpbGwgPSBvdmVyRmlsbEhvcml6b250YWw7XHJcbiAgICAgICAgICAgIGhvcml6b250YWxTaGFkaW5nUGF0aC5vcGFjaXR5ID0gb3B0aW9ucy5vdmVyQnV0dG9uT3BhY2l0eTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgY2FzZSBCdXR0b25JbnRlcmFjdGlvblN0YXRlLlBSRVNTRUQ6XHJcbiAgICAgICAgICAgIGJ1dHRvbkJhY2tncm91bmQuZmlsbCA9IGRvd25GaWxsVmVydGljYWw7XHJcbiAgICAgICAgICAgIGJ1dHRvbkJhY2tncm91bmQuc3Ryb2tlID0gb3B0aW9ucy5zZWxlY3RlZFN0cm9rZTtcclxuICAgICAgICAgICAgYnV0dG9uQmFja2dyb3VuZC5saW5lV2lkdGggPSBvcHRpb25zLnNlbGVjdGVkTGluZVdpZHRoO1xyXG4gICAgICAgICAgICBidXR0b25CYWNrZ3JvdW5kLm9wYWNpdHkgPSBvcHRpb25zLnNlbGVjdGVkQnV0dG9uT3BhY2l0eTtcclxuICAgICAgICAgICAgaG9yaXpvbnRhbFNoYWRpbmdQYXRoLmZpbGwgPSBvdmVyRmlsbEhvcml6b250YWw7XHJcbiAgICAgICAgICAgIGhvcml6b250YWxTaGFkaW5nUGF0aC5vcGFjaXR5ID0gb3B0aW9ucy5zZWxlY3RlZEJ1dHRvbk9wYWNpdHk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggYHVuc3VwcG9ydGVkIGludGVyYWN0aW9uU3RhdGU6ICR7aW50ZXJhY3Rpb25TdGF0ZX1gICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBpbnRlcmFjdGlvblN0YXRlUHJvcGVydHkubGluayggaW50ZXJhY3Rpb25TdGF0ZUxpc3RlbmVyICk7XHJcblxyXG4gICAgfTtcclxuICAgIGJ1dHRvbkJhY2tncm91bmQuc2VsZkJvdW5kc1Byb3BlcnR5LmxpbmsoIGxpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlVGhyZWVEQXBwZWFyYW5jZVN0cmF0ZWd5ID0gKCkgPT4ge1xyXG4gICAgICBidXR0b25CYWNrZ3JvdW5kLnNlbGZCb3VuZHNQcm9wZXJ0eS51bmxpbmsoIGxpc3RlbmVyICk7XHJcbiAgICAgIGlmICggaW50ZXJhY3Rpb25TdGF0ZVByb3BlcnR5Lmhhc0xpc3RlbmVyKCBpbnRlcmFjdGlvblN0YXRlTGlzdGVuZXIgKSApIHtcclxuICAgICAgICBpbnRlcmFjdGlvblN0YXRlUHJvcGVydHkudW5saW5rKCBpbnRlcmFjdGlvblN0YXRlTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYmFzZUJyaWdodGVyN1Byb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgYmFzZUJyaWdodGVyNVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgYmFzZUJyaWdodGVyMlByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgYmFzZURhcmtlcjNQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICAgIGJhc2VEYXJrZXI0UHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgICBiYXNlRGFya2VyNVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgYmFzZVRyYW5zcGFyZW50UHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNwb3NlVGhyZWVEQXBwZWFyYW5jZVN0cmF0ZWd5KCk7XHJcbiAgfVxyXG59XHJcblxyXG5SZWN0YW5ndWxhckJ1dHRvbi5UaHJlZURBcHBlYXJhbmNlU3RyYXRlZ3kgPSBUaHJlZURBcHBlYXJhbmNlU3RyYXRlZ3k7XHJcblxyXG5zdW4ucmVnaXN0ZXIoICdSZWN0YW5ndWxhckJ1dHRvbicsIFJlY3Rhbmd1bGFyQnV0dG9uICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSxxQ0FBcUM7QUFFakUsT0FBT0MsU0FBUyxNQUFNLCtCQUErQjtBQUVyRCxTQUFTQyxLQUFLLFFBQVEsNkJBQTZCO0FBQ25ELE9BQU9DLFNBQVMsTUFBTSxvQ0FBb0M7QUFFMUQsU0FBU0MsS0FBSyxFQUFVQyxjQUFjLEVB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