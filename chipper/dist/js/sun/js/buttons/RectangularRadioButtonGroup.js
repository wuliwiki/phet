// Copyright 2014-2023, University of Colorado Boulder

/**
 * RectangularRadioButtonGroup is a group of rectangular radio buttons, in either horizontal or vertical orientation.
 * See sun.ButtonsScreenView for example usage.
 *
 * @author Aaron Davis (PhET Interactive Simulations)
 * @author Chris Malley (PixelZoom, Inc.)
 */

import { Shape } from '../../../kite/js/imports.js';
import InstanceRegistry from '../../../phet-core/js/documentation/InstanceRegistry.js';
import { Color, FlowBox, FocusHighlightPath, PDOMPeer, Rectangle, SceneryConstants } from '../../../scenery/js/imports.js';
import multiSelectionSoundPlayerFactory from '../../../tambo/js/multiSelectionSoundPlayerFactory.js';
import Tandem from '../../../tandem/js/Tandem.js';
import ColorConstants from '../ColorConstants.js';
import sun from '../sun.js';
import RectangularRadioButton from './RectangularRadioButton.js';
import optionize, { combineOptions } from '../../../phet-core/js/optionize.js';
import { getGroupItemNodes } from '../GroupItemOptions.js';

// pdom - Unique ID for each instance of RectangularRadioButtonGroup. Used to create the 'name' option that is passed
// to each RectangularRadioButton in the group. All buttons in the group must have the same 'name', and that name
// must be unique to the group. Otherwise, the browser will treat all inputs of type 'radio' in the document as being
// in a single group.
let instanceCount = 0;

// Prefix for instanceCount, because PhET sims have different types of "groups"
const CLASS_NAME = 'RectangularRadioButtonGroup';

// Describes one radio button

/**
 * Identifies a radio button and its layout manager. Pointer areas and focus highlight need to be set on
 * the button, but need to surround the layout manager containing both the button and its optional label.
 * This was formerly a class, converted to a type when PhET moved to TypeScript.
 * See https://github.com/phetsims/sun/issues/708
 */

// Where the optional label appears, relative to the radio button

export default class RectangularRadioButtonGroup extends FlowBox {
  constructor(property, items, providedOptions) {
    assert && assert(_.uniqBy(items, item => item.value).length === items.length, 'items must have unique values');
    assert && assert(_.find(items, item => item.value === property.value), 'one radio button must be associated with property.value');
    const options = optionize()({
      // SelfOptions
      soundPlayers: null,
      labelAlign: 'bottom',
      labelSpacing: 0,
      a11yHighlightXDilation: 0,
      a11yHighlightYDilation: 0,
      touchAreaXDilation: 0,
      touchAreaYDilation: 0,
      mouseAreaXDilation: 0,
      mouseAreaYDilation: 0,
      radioButtonOptions: {
        baseColor: ColorConstants.LIGHT_BLUE,
        cornerRadius: 4,
        xMargin: 5,
        yMargin: 5,
        xAlign: 'center',
        yAlign: 'center',
        buttonAppearanceStrategyOptions: {
          selectedStroke: 'black',
          selectedLineWidth: 1.5,
          selectedButtonOpacity: 1,
          deselectedStroke: new Color(50, 50, 50),
          deselectedLineWidth: 1,
          deselectedButtonOpacity: 0.6,
          overButtonOpacity: 0.8
        },
        contentAppearanceStrategy: RectangularRadioButton.ContentAppearanceStrategy,
        contentAppearanceStrategyOptions: {
          overContentOpacity: 0.8,
          selectedContentOpacity: 1,
          deselectedContentOpacity: 0.6
        }
      },
      // FlowBoxOptions
      spacing: 10,
      orientation: 'vertical',
      disabledOpacity: SceneryConstants.DISABLED_OPACITY,
      // phet-io
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'ButtonGroup',
      visiblePropertyOptions: {
        phetioFeatured: true
      },
      phetioEnabledPropertyInstrumented: true,
      // opt into default PhET-iO instrumented enabledProperty

      // pdom
      tagName: 'ul',
      labelTagName: 'h3',
      ariaRole: 'radiogroup',
      groupFocusHighlight: true
    }, providedOptions);
    assert && assert(options.soundPlayers === null || options.soundPlayers.length === items.length, 'If soundPlayers is provided, there must be one per radio button.');
    instanceCount++;
    const radioButtonMap = new Map();

    // Maximum width of the line that strokes the button.
    const maxLineWidth = Math.max(options.radioButtonOptions.buttonAppearanceStrategyOptions.selectedLineWidth, options.radioButtonOptions.buttonAppearanceStrategyOptions.deselectedLineWidth);
    const nodes = getGroupItemNodes(items, options.tandem);
    assert && assert(_.every(nodes, node => !node.hasPDOMContent), 'Accessibility is provided by RectangularRadioButton and RectangularRadioButtonGroupItem.labelContent. ' + 'Additional PDOM content in the provided Node could break accessibility.');

    // Calculate the maximum width and height of the content, so we can make all radio buttons the same size.
    const widestContentWidth = _.maxBy(nodes, node => node.width).width;
    const tallestContentHeight = _.maxBy(nodes, node => node.height).height;

    // Populated for each radio button in for loop
    const buttons = [];
    const buttonsWithLayoutNodes = [];
    const labelAppearanceStrategies = [];
    const xMargin = options.radioButtonOptions.xMargin;
    const yMargin = options.radioButtonOptions.yMargin;
    for (let i = 0; i < items.length; i++) {
      const item = items[i];
      const node = nodes[i];
      const radioButtonOptions = combineOptions({
        content: node,
        minWidth: widestContentWidth + 2 * xMargin,
        minHeight: tallestContentHeight + 2 * yMargin,
        soundPlayer: options.soundPlayers ? options.soundPlayers[i] : multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(i),
        tandem: item.tandemName ? options.tandem.createTandem(item.tandemName) : options.tandem === Tandem.OPT_OUT ? Tandem.OPT_OUT : Tandem.REQUIRED,
        phetioDocumentation: item.phetioDocumentation || ''
      }, options.radioButtonOptions, item.options);

      // Create the label and voicing response for the radio button.
      if (item.labelContent) {
        radioButtonOptions.labelContent = item.labelContent;
        radioButtonOptions.voicingNameResponse = item.labelContent;
      }

      // pdom create description for radio button
      // use if block to prevent empty 'p' tag being added when no option is present
      if (item.descriptionContent) {
        radioButtonOptions.descriptionContent = item.descriptionContent;
      }
      if (item.voicingContextResponse) {
        radioButtonOptions.voicingContextResponse = item.voicingContextResponse;
      }
      const radioButton = new RectangularRadioButton(property, item.value, radioButtonOptions);
      radioButtonMap.set(item.value, radioButton);

      // pdom - so the browser recognizes these buttons are in the same group. See instanceCount for more info.
      radioButton.setPDOMAttribute('name', CLASS_NAME + instanceCount);

      // Ensure the buttons don't resize when selected vs unselected, by adding a rectangle with the max size.
      const maxButtonWidth = maxLineWidth + widestContentWidth + 2 * xMargin;
      const maxButtonHeight = maxLineWidth + tallestContentHeight + 2 * yMargin;
      const boundingRect = new Rectangle(0, 0, maxButtonWidth, maxButtonHeight, {
        fill: 'rgba(0,0,0,0)',
        center: radioButton.center
      });
      radioButton.addChild(boundingRect);
      let button;
      if (item.label) {
        // If a label is provided, the button becomes a FlowBox that manages layout of the button and label.
        const label = item.label;
        const labelOrientation = options.labelAlign === 'bottom' || options.labelAlign === 'top' ? 'vertical' : 'horizontal';
        const labelChildren = options.labelAlign === 'left' || options.labelAlign === 'top' ? [label, radioButton] : [radioButton, label];
        button = new FlowBox({
          children: labelChildren,
          spacing: options.labelSpacing,
          orientation: labelOrientation
        });

        // Make sure the label pointer areas don't block the expanded button pointer areas.
        label.pickable = false;

        // Use the same content appearance strategy for the labels that is used for the button content.
        // By default, this reduces opacity of the labels for the deselected radio buttons.
        if (options.radioButtonOptions.contentAppearanceStrategy) {
          labelAppearanceStrategies.push(new options.radioButtonOptions.contentAppearanceStrategy(label, radioButton.interactionStateProperty, options.radioButtonOptions.contentAppearanceStrategyOptions));
        }
      } else {
        // The button has no label.
        button = radioButton;
      }
      buttons.push(button);
      buttonsWithLayoutNodes.push({
        radioButton: radioButton,
        layoutNode: button
      });
    }
    options.children = buttons;

    // Pointer areas and focus highlight, sized to fit the largest button. See https://github.com/phetsims/sun/issues/708.
    const maxButtonWidth = _.maxBy(buttonsWithLayoutNodes, buttonWithLayoutParent => buttonWithLayoutParent.layoutNode.width).layoutNode.width;
    const maxButtonHeight = _.maxBy(buttonsWithLayoutNodes, buttonWithLayoutParent => buttonWithLayoutParent.layoutNode.height).layoutNode.height;
    buttonsWithLayoutNodes.forEach(buttonWithLayoutParent => {
      buttonWithLayoutParent.radioButton.touchArea = Shape.rectangle(-options.touchAreaXDilation - maxLineWidth / 2, -options.touchAreaYDilation - maxLineWidth / 2, maxButtonWidth + 2 * options.touchAreaXDilation, maxButtonHeight + 2 * options.touchAreaYDilation);
      buttonWithLayoutParent.radioButton.mouseArea = Shape.rectangle(-options.mouseAreaXDilation - maxLineWidth / 2, -options.mouseAreaYDilation - maxLineWidth / 2, maxButtonWidth + 2 * options.mouseAreaXDilation, maxButtonHeight + 2 * options.mouseAreaYDilation);
      const defaultDilationCoefficient = FocusHighlightPath.getDilationCoefficient(buttonWithLayoutParent.layoutNode);
      buttonWithLayoutParent.radioButton.focusHighlight = Shape.rectangle(-options.a11yHighlightXDilation - maxLineWidth / 2 - defaultDilationCoefficient, -options.a11yHighlightYDilation - maxLineWidth / 2 - defaultDilationCoefficient, maxButtonWidth + 2 * (options.a11yHighlightXDilation + defaultDilationCoefficient), maxButtonHeight + 2 * (options.a11yHighlightYDilation + defaultDilationCoefficient));
    });
    super(options);
    this.radioButtonMap = radioButtonMap;

    // pdom - This node's primary sibling is aria-labelledby its own label, so the label content is read whenever
    // a member of the group receives focus.
    this.addAriaLabelledbyAssociation({
      thisElementName: PDOMPeer.PRIMARY_SIBLING,
      otherNode: this,
      otherElementName: PDOMPeer.LABEL_SIBLING
    });

    // pan and zoom - Signify that key input is reserved, and we should not pan when user presses arrow keys.
    const intentListener = {
      keydown: event => event.pointer.reserveForKeyboardDrag()
    };
    this.addInputListener(intentListener);

    // must be done after this instance is instrumented
    this.addLinkedElement(property, {
      tandem: options.tandem.createTandem('property')
    });
    this.disposeRadioButtonGroup = () => {
      this.removeInputListener(intentListener);
      buttons.forEach(button => button.dispose());
      labelAppearanceStrategies.forEach(strategy => strategy.dispose && strategy.dispose());
      nodes.forEach(node => node.dispose());
    };

    // pdom - register component for binder docs
    assert && phet.chipper.queryParameters.binder && InstanceRegistry.registerDataURL('sun', 'RectangularRadioButtonGroup', this);
  }

  /**
   * Find the RectangularRadioButton corresponding to a value. Note that in the scene graph, the button may be nested
   * under other layers, so use caution for coordinate transformations.
   * @param value
   * @returns the corresponding button
   */
  getButtonForValue(value) {
    const result = this.radioButtonMap.get(value);
    assert && assert(result, 'No button found for value: ' + value);
    return result;
  }
  dispose() {
    this.radioButtonMap.clear();
    this.disposeRadioButtonGroup();
    super.dispose();
  }
}
sun.register('RectangularRadioButtonGroup', RectangularRadioButtonGroup);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaGFwZSIsIkluc3RhbmNlUmVnaXN0cnkiLCJDb2xvciIsIkZsb3dCb3giLCJGb2N1c0hpZ2hsaWdodFBhdGgiLCJQRE9NUGVlciIsIlJlY3RhbmdsZSIsIlNjZW5lcnlDb25zdGFudHMiLCJtdWx0aVNlbGVjdGlvblNvdW5kUGxheWVyRmFjdG9yeSIsIlRhbmRlbSIsIkNvbG9yQ29uc3RhbnRzIiwic3VuIiwiUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbiIsIm9wdGlvbml6ZSIsImNvbWJpbmVPcHRpb25zIiwiZ2V0R3JvdXBJdGVtTm9kZXMiLCJpbnN0YW5jZUNvdW50IiwiQ0xBU1NfTkFNRSIsIlJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cCIsImNvbnN0cnVjdG9yIiwicHJvcGVydHkiLCJpdGVtcyIsInByb3ZpZGVkT3B0aW9ucyIsImFzc2VydCIsIl8iLCJ1bmlxQnkiLCJpdGVtIiwidmFsdWUiLCJsZW5ndGgiLCJmaW5kIiwib3B0aW9ucyIsInNvdW5kUGxheWVycyIsImxhYmVsQWxpZ24iLCJsYWJlbFNwYWNpbmciLCJhMTF5SGlnaGxpZ2h0WERpbGF0aW9uIiwiYTExeUhpZ2hsaWdodFlEaWxhdGlvbiIsInRvdWNoQXJlYVhEaWxhdGlvbiIsInRvdWNoQXJlYVlEaWxhdGlvbiIsIm1vdXNlQXJlYVhEaWxhdGlvbiIsIm1vdXNlQXJlYVlEaWxhdGlvbiIsInJhZGlvQnV0dG9uT3B0aW9ucyIsImJhc2VDb2xvciIsIkxJR0hUX0JMVUUiLCJjb3JuZXJSYWRpdXMiLCJ4TWFyZ2luIiwieU1hcmdpbiIsInhBbGlnbiIsInlBbGlnbiIsImJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneU9wdGlvbnMiLCJzZWxlY3RlZFN0cm9rZSIsInNlbGVjdGVkTGluZVdpZHRoIiwic2VsZWN0ZWRCdXR0b25PcGFjaXR5IiwiZGVzZWxlY3RlZFN0cm9rZSIsImRlc2VsZWN0ZWRMaW5lV2lkdGgiLCJkZXNlbGVjdGVkQnV0dG9uT3BhY2l0eSIsIm92ZXJCdXR0b25PcGFjaXR5IiwiY29udGVudEFwcGVhcmFuY2VTdHJhdGVneSIsIkNvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3kiLCJjb250ZW50QXBwZWFyYW5jZVN0cmF0ZWd5T3B0aW9ucyIsIm92ZXJDb250ZW50T3BhY2l0eSIsInNlbGVjdGVkQ29udGVudE9wYWNpdHkiLCJkZXNlbGVjdGVkQ29udGVudE9wYWNpdHkiLCJzcGFjaW5nIiwib3JpZW50YXRpb24iLCJkaXNhYmxlZE9wYWNpdHkiLCJESVNBQkxFRF9PUEFDSVRZIiwidGFuZGVtIiwiUkVRVUlSRUQiLCJ0YW5kZW1OYW1lU3VmZml4IiwidmlzaWJsZVByb3BlcnR5T3B0aW9ucyIsInBoZXRpb0ZlYXR1cmVkIiwicGhldGlvRW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkIiwidGFnTmFtZSIsImxhYmVsVGFnTmFtZSIsImFyaWFSb2xlIiwiZ3JvdXBGb2N1c0hpZ2hsaWdodCIsInJhZGlvQnV0dG9uTWFwIiwiTWFwIiwibWF4TGluZVdpZHRoIiwiTWF0aCIsIm1heCIsIm5vZGVzIiwiZXZlcnkiLCJub2RlIiwiaGFzUERPTUNvbnRlbnQiLCJ3aWRlc3RDb250ZW50V2lkdGgiLCJtYXhCeSIsIndpZHRoIiwidGFsbGVzdENvbnRlbnRIZWlnaHQiLCJoZWlnaHQiLCJidXR0b25zIiwiYnV0dG9uc1dpdGhMYXlvdXROb2RlcyIsImxhYmVsQXBwZWFyYW5jZVN0cmF0ZWdpZXMiLCJpIiwiY29udGVudCIsIm1pbldpZHRoIiwibWluSGVpZ2h0Iiwic291bmRQbGF5ZXIiLCJnZXRTZWxlY3Rpb25Tb3VuZFBsYXllciIsInRhbmRlbU5hbWUiLCJjcmVhdGVUYW5kZW0iLCJPUFRfT1VUIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsImxhYmVsQ29udGVudCIsInZvaWNpbmdOYW1lUmVzcG9uc2UiLCJkZXNjcmlwdGlvbkNvbnRlbnQiLCJ2b2ljaW5nQ29udGV4dFJlc3BvbnNlIiwicmFkaW9CdXR0b24iLCJzZXQiLCJzZXRQRE9NQXR0cmlidXRlIiwibWF4QnV0dG9uV2lkdGgiLCJtYXhCdXR0b25IZWlnaHQiLCJib3VuZGluZ1JlY3QiLCJmaWxsIiwiY2VudGVyIiwiYWRkQ2hpbGQiLCJidXR0b24iLCJsYWJlbCIsImxhYmVsT3JpZW50YXRpb24iLCJsYWJlbENoaWxkcmVuIiwiY2hpbGRyZW4iLCJwaWNrYWJsZSIsInB1c2giLCJpbnRlcmFjdGlvblN0YXRlUHJvcGVydHkiLCJsYXlvdXROb2RlIiwiYnV0dG9uV2l0aExheW91dFBhcmVudCIsImZvckVhY2giLCJ0b3VjaEFyZWEiLCJyZWN0YW5nbGUiLCJtb3VzZUFyZWEiLCJkZWZhdWx0RGlsYXRpb25Db2VmZmljaWVudCIsImdldERpbGF0aW9uQ29lZmZpY2llbnQiLCJmb2N1c0hpZ2hsaWdodCIsImFkZEFyaWFMYWJlbGxlZGJ5QXNzb2NpYXRpb24iLCJ0aGlzRWxlbWVudE5hbWUiLCJQUklNQVJZX1NJQkxJTkciLCJvdGhlck5vZGUiLCJvdGhlckVsZW1lbnROYW1lIiwiTEFCRUxfU0lCTElORyIsImludGVudExpc3RlbmVyIiwia2V5ZG93biIsImV2ZW50IiwicG9pbnRlciIsInJlc2VydmVGb3JLZXlib2FyZERyYWciLCJhZGRJbnB1dExpc3RlbmVyIiwiYWRkTGlua2VkRWxlbWVudCIsImRpc3Bvc2VSYWRpb0J1dHRvbkdyb3VwIiwicmVtb3ZlSW5wdXRMaXN0ZW5lciIsImRpc3Bvc2UiLCJzdHJhdGVneSIsInBoZXQiLCJjaGlwcGVyIiwicXVlcnlQYXJhbWV0ZXJzIiwiYmluZGVyIiwicmVnaXN0ZXJEYXRhVVJMIiwiZ2V0QnV0dG9uRm9yVmFsdWUiLCJyZXN1bHQiLCJnZXQiLCJjbGVhciIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE0LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cCBpcyBhIGdyb3VwIG9mIHJlY3Rhbmd1bGFyIHJhZGlvIGJ1dHRvbnMsIGluIGVpdGhlciBob3Jpem9udGFsIG9yIHZlcnRpY2FsIG9yaWVudGF0aW9uLlxyXG4gKiBTZWUgc3VuLkJ1dHRvbnNTY3JlZW5WaWV3IGZvciBleGFtcGxlIHVzYWdlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEFhcm9uIERhdmlzIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEluc3RhbmNlUmVnaXN0cnkgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL2RvY3VtZW50YXRpb24vSW5zdGFuY2VSZWdpc3RyeS5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBGbG93Qm94LCBGbG93Qm94T3B0aW9ucywgRm9jdXNIaWdobGlnaHRQYXRoLCBOb2RlLCBQRE9NUGVlciwgUERPTVZhbHVlVHlwZSwgUmVjdGFuZ2xlLCBTY2VuZXJ5Q29uc3RhbnRzLCBUSW5wdXRMaXN0ZW5lciB9IGZyb20gJy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBtdWx0aVNlbGVjdGlvblNvdW5kUGxheWVyRmFjdG9yeSBmcm9tICcuLi8uLi8uLi90YW1iby9qcy9tdWx0aVNlbGVjdGlvblNvdW5kUGxheWVyRmFjdG9yeS5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBDb2xvckNvbnN0YW50cyBmcm9tICcuLi9Db2xvckNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBzdW4gZnJvbSAnLi4vc3VuLmpzJztcclxuaW1wb3J0IFJlY3Rhbmd1bGFyUmFkaW9CdXR0b24sIHsgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbk9wdGlvbnMgfSBmcm9tICcuL1JlY3Rhbmd1bGFyUmFkaW9CdXR0b24uanMnO1xyXG5pbXBvcnQgeyBWb2ljaW5nUmVzcG9uc2UgfSBmcm9tICcuLi8uLi8uLi91dHRlcmFuY2UtcXVldWUvanMvUmVzcG9uc2VQYWNrZXQuanMnO1xyXG5pbXBvcnQgVFNvdW5kUGxheWVyIGZyb20gJy4uLy4uLy4uL3RhbWJvL2pzL1RTb3VuZFBsYXllci5qcyc7XHJcbmltcG9ydCBUQ29udGVudEFwcGVhcmFuY2VTdHJhdGVneSBmcm9tICcuL1RDb250ZW50QXBwZWFyYW5jZVN0cmF0ZWd5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IEdyb3VwSXRlbU9wdGlvbnMsIHsgZ2V0R3JvdXBJdGVtTm9kZXMgfSBmcm9tICcuLi9Hcm91cEl0ZW1PcHRpb25zLmpzJztcclxuXHJcbi8vIHBkb20gLSBVbmlxdWUgSUQgZm9yIGVhY2ggaW5zdGFuY2Ugb2YgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwLiBVc2VkIHRvIGNyZWF0ZSB0aGUgJ25hbWUnIG9wdGlvbiB0aGF0IGlzIHBhc3NlZFxyXG4vLyB0byBlYWNoIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b24gaW4gdGhlIGdyb3VwLiBBbGwgYnV0dG9ucyBpbiB0aGUgZ3JvdXAgbXVzdCBoYXZlIHRoZSBzYW1lICduYW1lJywgYW5kIHRoYXQgbmFtZVxyXG4vLyBtdXN0IGJlIHVuaXF1ZSB0byB0aGUgZ3JvdXAuIE90aGVyd2lzZSwgdGhlIGJyb3dzZXIgd2lsbCB0cmVhdCBhbGwgaW5wdXRzIG9mIHR5cGUgJ3JhZGlvJyBpbiB0aGUgZG9jdW1lbnQgYXMgYmVpbmdcclxuLy8gaW4gYSBzaW5nbGUgZ3JvdXAuXHJcbmxldCBpbnN0YW5jZUNvdW50ID0gMDtcclxuXHJcbi8vIFByZWZpeCBmb3IgaW5zdGFuY2VDb3VudCwgYmVjYXVzZSBQaEVUIHNpbXMgaGF2ZSBkaWZmZXJlbnQgdHlwZXMgb2YgXCJncm91cHNcIlxyXG5jb25zdCBDTEFTU19OQU1FID0gJ1JlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cCc7XHJcblxyXG4vLyBEZXNjcmliZXMgb25lIHJhZGlvIGJ1dHRvblxyXG5leHBvcnQgdHlwZSBSZWN0YW5ndWxhclJhZGlvQnV0dG9uR3JvdXBJdGVtPFQ+ID0ge1xyXG4gIHZhbHVlOiBUOyAvLyB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggdGhlIGJ1dHRvblxyXG4gIGxhYmVsPzogTm9kZTsgLy8gb3B0aW9uYWwgbGFiZWwgdGhhdCBhcHBlYXJzIG91dHNpZGUgdGhlIGJ1dHRvblxyXG4gIHBoZXRpb0RvY3VtZW50YXRpb24/OiBzdHJpbmc7IC8vIG9wdGlvbmFsIGRvY3VtZW50YXRpb24gZm9yIFBoRVQtaU9cclxuICBsYWJlbENvbnRlbnQ/OiBQRE9NVmFsdWVUeXBlOyAvLyBvcHRpb25hbCBsYWJlbCBmb3IgYTExeSAoZGVzY3JpcHRpb24gYW5kIHZvaWNpbmcpXHJcbiAgdm9pY2luZ0NvbnRleHRSZXNwb25zZT86IFZvaWNpbmdSZXNwb25zZTtcclxuICBkZXNjcmlwdGlvbkNvbnRlbnQ/OiBQRE9NVmFsdWVUeXBlOyAvLyBvcHRpb25hbCBsYWJlbCBmb3IgYTExeVxyXG4gIG9wdGlvbnM/OiBTdHJpY3RPbWl0PFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25PcHRpb25zLCAndGFuZGVtJz47IC8vIG9wdGlvbnMgcGFzc2VkIHRvIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b24gY29uc3RydWN0b3JcclxufSAmIEdyb3VwSXRlbU9wdGlvbnM7XHJcblxyXG4vKipcclxuICogSWRlbnRpZmllcyBhIHJhZGlvIGJ1dHRvbiBhbmQgaXRzIGxheW91dCBtYW5hZ2VyLiBQb2ludGVyIGFyZWFzIGFuZCBmb2N1cyBoaWdobGlnaHQgbmVlZCB0byBiZSBzZXQgb25cclxuICogdGhlIGJ1dHRvbiwgYnV0IG5lZWQgdG8gc3Vycm91bmQgdGhlIGxheW91dCBtYW5hZ2VyIGNvbnRhaW5pbmcgYm90aCB0aGUgYnV0dG9uIGFuZCBpdHMgb3B0aW9uYWwgbGFiZWwuXHJcbiAqIFRoaXMgd2FzIGZvcm1lcmx5IGEgY2xhc3MsIGNvbnZlcnRlZCB0byBhIHR5cGUgd2hlbiBQaEVUIG1vdmVkIHRvIFR5cGVTY3JpcHQuXHJcbiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc3VuL2lzc3Vlcy83MDhcclxuICovXHJcbnR5cGUgQnV0dG9uV2l0aExheW91dE5vZGU8VD4gPSB7XHJcbiAgcmFkaW9CdXR0b246IFJlY3Rhbmd1bGFyUmFkaW9CdXR0b248VD47XHJcbiAgcmVhZG9ubHkgbGF5b3V0Tm9kZTogTm9kZTtcclxufTtcclxuXHJcbi8vIFdoZXJlIHRoZSBvcHRpb25hbCBsYWJlbCBhcHBlYXJzLCByZWxhdGl2ZSB0byB0aGUgcmFkaW8gYnV0dG9uXHJcbmV4cG9ydCB0eXBlIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25MYWJlbEFsaWduID0gJ3RvcCcgfCAnYm90dG9tJyB8ICdsZWZ0JyB8ICdyaWdodCc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyBTb3VuZCBnZW5lcmF0aW9uIGZvciB0aGUgcmFkaW8gYnV0dG9ucy5cclxuICAvLyBudWxsIG1lYW5zIHRvIHVzZSB0aGUgZGVmYXVsdHMuIE90aGVyd2lzZSwgdGhlcmUgbXVzdCBiZSBvbmUgZm9yIGVhY2ggYnV0dG9uLlxyXG4gIHNvdW5kUGxheWVycz86IFRTb3VuZFBsYXllcltdIHwgbnVsbDtcclxuXHJcbiAgLy8gRGV0ZXJtaW5lcyB3aGVyZSB0aGUgb3B0aW9uYWwgbGFiZWwgYXBwZWFycywgcmVsYXRpdmUgdG8gdGhlIGJ1dHRvblxyXG4gIGxhYmVsQWxpZ24/OiBSZWN0YW5ndWxhclJhZGlvQnV0dG9uTGFiZWxBbGlnbjtcclxuXHJcbiAgLy8gU3BhY2luZyBiZXR3ZWVuIHRoZSBvcHRpb25hbCBsYWJlbCBhbmQgdGhlIGJ1dHRvblxyXG4gIGxhYmVsU3BhY2luZz86IG51bWJlcjtcclxuXHJcbiAgLy8gcGRvbSAtIGZvY3VzIGhpZ2hsaWdodCBleHBhbnNpb25cclxuICBhMTF5SGlnaGxpZ2h0WERpbGF0aW9uPzogbnVtYmVyO1xyXG4gIGExMXlIaWdobGlnaHRZRGlsYXRpb24/OiBudW1iZXI7XHJcblxyXG4gIC8vIEFwcGxpZWQgdG8gZWFjaCBidXR0b24sIG9yIGVhY2ggYnV0dG9uICsgb3B0aW9uYWwgbGFiZWwuXHJcbiAgLy8gVGhpcyBpcyBub3QgaGFuZGxlZCB2aWEgcmFkaW9CdXR0b25PcHRpb25zIGJlY2F1c2Ugd2UgbWF5IGhhdmUgYW4gb3B0aW9uYWwgbGFiZWwgaW4gYWRkaXRpb24gdG8gdGhlIGJ1dHRvbi5cclxuICB0b3VjaEFyZWFYRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgdG91Y2hBcmVhWURpbGF0aW9uPzogbnVtYmVyO1xyXG4gIG1vdXNlQXJlYVhEaWxhdGlvbj86IG51bWJlcjtcclxuICBtb3VzZUFyZWFZRGlsYXRpb24/OiBudW1iZXI7XHJcblxyXG4gIHJhZGlvQnV0dG9uT3B0aW9ucz86IFN0cmljdE9taXQ8UmVjdGFuZ3VsYXJSYWRpb0J1dHRvbk9wdGlvbnMsXHJcbiAgICAnc291bmRQbGF5ZXInIHwgICAgICAgIC8vIHVzZSBTZWxmT3B0aW9ucy5zb3VuZFBsYXllcnNcclxuICAgICd0b3VjaEFyZWFYRGlsYXRpb24nIHwgLy8gdXNlIFNlbGZPcHRpb25zLnRvdWNoQXJlYVhEaWxhdGlvblxyXG4gICAgJ3RvdWNoQXJlYVlEaWxhdGlvbicgfCAvLyB1c2UgU2VsZk9wdGlvbnMudG91Y2hBcmVhWURpbGF0aW9uXHJcbiAgICAnbW91c2VBcmVhWERpbGF0aW9uJyB8IC8vIHVzZSBTZWxmT3B0aW9ucy5tb3VzZUFyZWFYRGlsYXRpb25cclxuICAgICdtb3VzZUFyZWFZRGlsYXRpb24nICAgLy8gdXNlIFNlbGZPcHRpb25zLm1vdXNlQXJlYVlEaWxhdGlvblxyXG4gICAgPjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cE9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFN0cmljdE9taXQ8Rmxvd0JveE9wdGlvbnMsXHJcbiAgJ2NoaWxkcmVuJyB8ICd0YWdOYW1lJyB8ICdhcmlhUm9sZScgfCAnZ3JvdXBGb2N1c0hpZ2hsaWdodCc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwPFQ+IGV4dGVuZHMgRmxvd0JveCB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZVJhZGlvQnV0dG9uR3JvdXA6ICgpID0+IHZvaWQ7XHJcbiAgcHJpdmF0ZSByZWFkb25seSByYWRpb0J1dHRvbk1hcDogTWFwPFQsIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b248VD4+O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3BlcnR5OiBQcm9wZXJ0eTxUPiwgaXRlbXM6IFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cEl0ZW08VD5bXSwgcHJvdmlkZWRPcHRpb25zPzogUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwT3B0aW9ucyApIHtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBfLnVuaXFCeSggaXRlbXMsIGl0ZW0gPT4gaXRlbS52YWx1ZSApLmxlbmd0aCA9PT0gaXRlbXMubGVuZ3RoLFxyXG4gICAgICAnaXRlbXMgbXVzdCBoYXZlIHVuaXF1ZSB2YWx1ZXMnICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBfLmZpbmQoIGl0ZW1zLCBpdGVtID0+ICggaXRlbS52YWx1ZSA9PT0gcHJvcGVydHkudmFsdWUgKSApLFxyXG4gICAgICAnb25lIHJhZGlvIGJ1dHRvbiBtdXN0IGJlIGFzc29jaWF0ZWQgd2l0aCBwcm9wZXJ0eS52YWx1ZScgKTtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cE9wdGlvbnMsIFNlbGZPcHRpb25zLCBGbG93Qm94T3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgc291bmRQbGF5ZXJzOiBudWxsLFxyXG4gICAgICBsYWJlbEFsaWduOiAnYm90dG9tJyxcclxuICAgICAgbGFiZWxTcGFjaW5nOiAwLFxyXG4gICAgICBhMTF5SGlnaGxpZ2h0WERpbGF0aW9uOiAwLFxyXG4gICAgICBhMTF5SGlnaGxpZ2h0WURpbGF0aW9uOiAwLFxyXG4gICAgICB0b3VjaEFyZWFYRGlsYXRpb246IDAsXHJcbiAgICAgIHRvdWNoQXJlYVlEaWxhdGlvbjogMCxcclxuICAgICAgbW91c2VBcmVhWERpbGF0aW9uOiAwLFxyXG4gICAgICBtb3VzZUFyZWFZRGlsYXRpb246IDAsXHJcbiAgICAgIHJhZGlvQnV0dG9uT3B0aW9uczoge1xyXG4gICAgICAgIGJhc2VDb2xvcjogQ29sb3JDb25zdGFudHMuTElHSFRfQkxVRSxcclxuICAgICAgICBjb3JuZXJSYWRpdXM6IDQsXHJcbiAgICAgICAgeE1hcmdpbjogNSxcclxuICAgICAgICB5TWFyZ2luOiA1LFxyXG4gICAgICAgIHhBbGlnbjogJ2NlbnRlcicsXHJcbiAgICAgICAgeUFsaWduOiAnY2VudGVyJyxcclxuICAgICAgICBidXR0b25BcHBlYXJhbmNlU3RyYXRlZ3lPcHRpb25zOiB7XHJcbiAgICAgICAgICBzZWxlY3RlZFN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgICAgIHNlbGVjdGVkTGluZVdpZHRoOiAxLjUsXHJcbiAgICAgICAgICBzZWxlY3RlZEJ1dHRvbk9wYWNpdHk6IDEsXHJcbiAgICAgICAgICBkZXNlbGVjdGVkU3Ryb2tlOiBuZXcgQ29sb3IoIDUwLCA1MCwgNTAgKSxcclxuICAgICAgICAgIGRlc2VsZWN0ZWRMaW5lV2lkdGg6IDEsXHJcbiAgICAgICAgICBkZXNlbGVjdGVkQnV0dG9uT3BhY2l0eTogMC42LFxyXG4gICAgICAgICAgb3ZlckJ1dHRvbk9wYWNpdHk6IDAuOFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29udGVudEFwcGVhcmFuY2VTdHJhdGVneTogUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbi5Db250ZW50QXBwZWFyYW5jZVN0cmF0ZWd5LFxyXG4gICAgICAgIGNvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3lPcHRpb25zOiB7XHJcbiAgICAgICAgICBvdmVyQ29udGVudE9wYWNpdHk6IDAuOCxcclxuICAgICAgICAgIHNlbGVjdGVkQ29udGVudE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICBkZXNlbGVjdGVkQ29udGVudE9wYWNpdHk6IDAuNlxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIEZsb3dCb3hPcHRpb25zXHJcbiAgICAgIHNwYWNpbmc6IDEwLFxyXG4gICAgICBvcmllbnRhdGlvbjogJ3ZlcnRpY2FsJyxcclxuICAgICAgZGlzYWJsZWRPcGFjaXR5OiBTY2VuZXJ5Q29uc3RhbnRzLkRJU0FCTEVEX09QQUNJVFksXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVELFxyXG4gICAgICB0YW5kZW1OYW1lU3VmZml4OiAnQnV0dG9uR3JvdXAnLFxyXG4gICAgICB2aXNpYmxlUHJvcGVydHlPcHRpb25zOiB7IHBoZXRpb0ZlYXR1cmVkOiB0cnVlIH0sXHJcbiAgICAgIHBoZXRpb0VuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZDogdHJ1ZSwgLy8gb3B0IGludG8gZGVmYXVsdCBQaEVULWlPIGluc3RydW1lbnRlZCBlbmFibGVkUHJvcGVydHlcclxuXHJcbiAgICAgIC8vIHBkb21cclxuICAgICAgdGFnTmFtZTogJ3VsJyxcclxuICAgICAgbGFiZWxUYWdOYW1lOiAnaDMnLFxyXG4gICAgICBhcmlhUm9sZTogJ3JhZGlvZ3JvdXAnLFxyXG4gICAgICBncm91cEZvY3VzSGlnaGxpZ2h0OiB0cnVlXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zLnNvdW5kUGxheWVycyA9PT0gbnVsbCB8fCBvcHRpb25zLnNvdW5kUGxheWVycy5sZW5ndGggPT09IGl0ZW1zLmxlbmd0aCxcclxuICAgICAgJ0lmIHNvdW5kUGxheWVycyBpcyBwcm92aWRlZCwgdGhlcmUgbXVzdCBiZSBvbmUgcGVyIHJhZGlvIGJ1dHRvbi4nICk7XHJcblxyXG4gICAgaW5zdGFuY2VDb3VudCsrO1xyXG5cclxuICAgIGNvbnN0IHJhZGlvQnV0dG9uTWFwID0gbmV3IE1hcDxULCBSZWN0YW5ndWxhclJhZGlvQnV0dG9uPFQ+PigpO1xyXG5cclxuICAgIC8vIE1heGltdW0gd2lkdGggb2YgdGhlIGxpbmUgdGhhdCBzdHJva2VzIHRoZSBidXR0b24uXHJcbiAgICBjb25zdCBtYXhMaW5lV2lkdGggPSBNYXRoLm1heChcclxuICAgICAgb3B0aW9ucy5yYWRpb0J1dHRvbk9wdGlvbnMuYnV0dG9uQXBwZWFyYW5jZVN0cmF0ZWd5T3B0aW9ucyEuc2VsZWN0ZWRMaW5lV2lkdGghLFxyXG4gICAgICBvcHRpb25zLnJhZGlvQnV0dG9uT3B0aW9ucy5idXR0b25BcHBlYXJhbmNlU3RyYXRlZ3lPcHRpb25zIS5kZXNlbGVjdGVkTGluZVdpZHRoIVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBub2RlcyA9IGdldEdyb3VwSXRlbU5vZGVzKCBpdGVtcywgb3B0aW9ucy50YW5kZW0gKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIF8uZXZlcnkoIG5vZGVzLCBub2RlID0+ICFub2RlLmhhc1BET01Db250ZW50ICksXHJcbiAgICAgICdBY2Nlc3NpYmlsaXR5IGlzIHByb3ZpZGVkIGJ5IFJlY3Rhbmd1bGFyUmFkaW9CdXR0b24gYW5kIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cEl0ZW0ubGFiZWxDb250ZW50LiAnICtcclxuICAgICAgJ0FkZGl0aW9uYWwgUERPTSBjb250ZW50IGluIHRoZSBwcm92aWRlZCBOb2RlIGNvdWxkIGJyZWFrIGFjY2Vzc2liaWxpdHkuJyApO1xyXG5cclxuICAgIC8vIENhbGN1bGF0ZSB0aGUgbWF4aW11bSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSBjb250ZW50LCBzbyB3ZSBjYW4gbWFrZSBhbGwgcmFkaW8gYnV0dG9ucyB0aGUgc2FtZSBzaXplLlxyXG4gICAgY29uc3Qgd2lkZXN0Q29udGVudFdpZHRoID0gXy5tYXhCeSggbm9kZXMsIG5vZGUgPT4gbm9kZS53aWR0aCApIS53aWR0aDtcclxuICAgIGNvbnN0IHRhbGxlc3RDb250ZW50SGVpZ2h0ID0gXy5tYXhCeSggbm9kZXMsIG5vZGUgPT4gbm9kZS5oZWlnaHQgKSEuaGVpZ2h0O1xyXG5cclxuICAgIC8vIFBvcHVsYXRlZCBmb3IgZWFjaCByYWRpbyBidXR0b24gaW4gZm9yIGxvb3BcclxuICAgIGNvbnN0IGJ1dHRvbnM6IEFycmF5PFJlY3Rhbmd1bGFyUmFkaW9CdXR0b248VD4gfCBGbG93Qm94PiA9IFtdO1xyXG4gICAgY29uc3QgYnV0dG9uc1dpdGhMYXlvdXROb2RlczogQnV0dG9uV2l0aExheW91dE5vZGU8VD5bXSA9IFtdO1xyXG4gICAgY29uc3QgbGFiZWxBcHBlYXJhbmNlU3RyYXRlZ2llczogSW5zdGFuY2VUeXBlPFRDb250ZW50QXBwZWFyYW5jZVN0cmF0ZWd5PltdID0gW107XHJcblxyXG4gICAgY29uc3QgeE1hcmdpbjogbnVtYmVyID0gb3B0aW9ucy5yYWRpb0J1dHRvbk9wdGlvbnMueE1hcmdpbiE7XHJcbiAgICBjb25zdCB5TWFyZ2luOiBudW1iZXIgPSBvcHRpb25zLnJhZGlvQnV0dG9uT3B0aW9ucy55TWFyZ2luITtcclxuXHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgaXRlbSA9IGl0ZW1zWyBpIF07XHJcbiAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1sgaSBdO1xyXG5cclxuICAgICAgY29uc3QgcmFkaW9CdXR0b25PcHRpb25zID0gY29tYmluZU9wdGlvbnM8UmVjdGFuZ3VsYXJSYWRpb0J1dHRvbk9wdGlvbnM+KCB7XHJcbiAgICAgICAgY29udGVudDogbm9kZSxcclxuICAgICAgICBtaW5XaWR0aDogd2lkZXN0Q29udGVudFdpZHRoICsgMiAqIHhNYXJnaW4sXHJcbiAgICAgICAgbWluSGVpZ2h0OiB0YWxsZXN0Q29udGVudEhlaWdodCArIDIgKiB5TWFyZ2luLFxyXG4gICAgICAgIHNvdW5kUGxheWVyOiBvcHRpb25zLnNvdW5kUGxheWVycyA/IG9wdGlvbnMuc291bmRQbGF5ZXJzWyBpIF0gOlxyXG4gICAgICAgICAgICAgICAgICAgICBtdWx0aVNlbGVjdGlvblNvdW5kUGxheWVyRmFjdG9yeS5nZXRTZWxlY3Rpb25Tb3VuZFBsYXllciggaSApLFxyXG4gICAgICAgIHRhbmRlbTogaXRlbS50YW5kZW1OYW1lID8gb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCBpdGVtLnRhbmRlbU5hbWUgKSA6XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLnRhbmRlbSA9PT0gVGFuZGVtLk9QVF9PVVQgPyBUYW5kZW0uT1BUX09VVCA6XHJcbiAgICAgICAgICAgICAgICBUYW5kZW0uUkVRVUlSRUQsXHJcbiAgICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogaXRlbS5waGV0aW9Eb2N1bWVudGF0aW9uIHx8ICcnXHJcbiAgICAgIH0sIG9wdGlvbnMucmFkaW9CdXR0b25PcHRpb25zLCBpdGVtLm9wdGlvbnMgKTtcclxuXHJcbiAgICAgIC8vIENyZWF0ZSB0aGUgbGFiZWwgYW5kIHZvaWNpbmcgcmVzcG9uc2UgZm9yIHRoZSByYWRpbyBidXR0b24uXHJcbiAgICAgIGlmICggaXRlbS5sYWJlbENvbnRlbnQgKSB7XHJcbiAgICAgICAgcmFkaW9CdXR0b25PcHRpb25zLmxhYmVsQ29udGVudCA9IGl0ZW0ubGFiZWxDb250ZW50O1xyXG4gICAgICAgIHJhZGlvQnV0dG9uT3B0aW9ucy52b2ljaW5nTmFtZVJlc3BvbnNlID0gaXRlbS5sYWJlbENvbnRlbnQ7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIHBkb20gY3JlYXRlIGRlc2NyaXB0aW9uIGZvciByYWRpbyBidXR0b25cclxuICAgICAgLy8gdXNlIGlmIGJsb2NrIHRvIHByZXZlbnQgZW1wdHkgJ3AnIHRhZyBiZWluZyBhZGRlZCB3aGVuIG5vIG9wdGlvbiBpcyBwcmVzZW50XHJcbiAgICAgIGlmICggaXRlbS5kZXNjcmlwdGlvbkNvbnRlbnQgKSB7XHJcbiAgICAgICAgcmFkaW9CdXR0b25PcHRpb25zLmRlc2NyaXB0aW9uQ29udGVudCA9IGl0ZW0uZGVzY3JpcHRpb25Db250ZW50O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIGl0ZW0udm9pY2luZ0NvbnRleHRSZXNwb25zZSApIHtcclxuICAgICAgICByYWRpb0J1dHRvbk9wdGlvbnMudm9pY2luZ0NvbnRleHRSZXNwb25zZSA9IGl0ZW0udm9pY2luZ0NvbnRleHRSZXNwb25zZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgcmFkaW9CdXR0b24gPSBuZXcgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbiggcHJvcGVydHksIGl0ZW0udmFsdWUsIHJhZGlvQnV0dG9uT3B0aW9ucyApO1xyXG5cclxuICAgICAgcmFkaW9CdXR0b25NYXAuc2V0KCBpdGVtLnZhbHVlLCByYWRpb0J1dHRvbiApO1xyXG5cclxuICAgICAgLy8gcGRvbSAtIHNvIHRoZSBicm93c2VyIHJlY29nbml6ZXMgdGhlc2UgYnV0dG9ucyBhcmUgaW4gdGhlIHNhbWUgZ3JvdXAuIFNlZSBpbnN0YW5jZUNvdW50IGZvciBtb3JlIGluZm8uXHJcbiAgICAgIHJhZGlvQnV0dG9uLnNldFBET01BdHRyaWJ1dGUoICduYW1lJywgQ0xBU1NfTkFNRSArIGluc3RhbmNlQ291bnQgKTtcclxuXHJcbiAgICAgIC8vIEVuc3VyZSB0aGUgYnV0dG9ucyBkb24ndCByZXNpemUgd2hlbiBzZWxlY3RlZCB2cyB1bnNlbGVjdGVkLCBieSBhZGRpbmcgYSByZWN0YW5nbGUgd2l0aCB0aGUgbWF4IHNpemUuXHJcbiAgICAgIGNvbnN0IG1heEJ1dHRvbldpZHRoID0gbWF4TGluZVdpZHRoICsgd2lkZXN0Q29udGVudFdpZHRoICsgMiAqIHhNYXJnaW47XHJcbiAgICAgIGNvbnN0IG1heEJ1dHRvbkhlaWdodCA9IG1heExpbmVXaWR0aCArIHRhbGxlc3RDb250ZW50SGVpZ2h0ICsgMiAqIHlNYXJnaW47XHJcbiAgICAgIGNvbnN0IGJvdW5kaW5nUmVjdCA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIG1heEJ1dHRvbldpZHRoLCBtYXhCdXR0b25IZWlnaHQsIHtcclxuICAgICAgICBmaWxsOiAncmdiYSgwLDAsMCwwKScsXHJcbiAgICAgICAgY2VudGVyOiByYWRpb0J1dHRvbi5jZW50ZXJcclxuICAgICAgfSApO1xyXG4gICAgICByYWRpb0J1dHRvbi5hZGRDaGlsZCggYm91bmRpbmdSZWN0ICk7XHJcblxyXG4gICAgICBsZXQgYnV0dG9uO1xyXG4gICAgICBpZiAoIGl0ZW0ubGFiZWwgKSB7XHJcblxyXG4gICAgICAgIC8vIElmIGEgbGFiZWwgaXMgcHJvdmlkZWQsIHRoZSBidXR0b24gYmVjb21lcyBhIEZsb3dCb3ggdGhhdCBtYW5hZ2VzIGxheW91dCBvZiB0aGUgYnV0dG9uIGFuZCBsYWJlbC5cclxuICAgICAgICBjb25zdCBsYWJlbCA9IGl0ZW0ubGFiZWw7XHJcbiAgICAgICAgY29uc3QgbGFiZWxPcmllbnRhdGlvbiA9ICggb3B0aW9ucy5sYWJlbEFsaWduID09PSAnYm90dG9tJyB8fCBvcHRpb25zLmxhYmVsQWxpZ24gPT09ICd0b3AnICkgPyAndmVydGljYWwnIDogJ2hvcml6b250YWwnO1xyXG4gICAgICAgIGNvbnN0IGxhYmVsQ2hpbGRyZW4gPSAoIG9wdGlvbnMubGFiZWxBbGlnbiA9PT0gJ2xlZnQnIHx8IG9wdGlvbnMubGFiZWxBbGlnbiA9PT0gJ3RvcCcgKSA/IFsgbGFiZWwsIHJhZGlvQnV0dG9uIF0gOiBbIHJhZGlvQnV0dG9uLCBsYWJlbCBdO1xyXG4gICAgICAgIGJ1dHRvbiA9IG5ldyBGbG93Qm94KCB7XHJcbiAgICAgICAgICBjaGlsZHJlbjogbGFiZWxDaGlsZHJlbixcclxuICAgICAgICAgIHNwYWNpbmc6IG9wdGlvbnMubGFiZWxTcGFjaW5nLFxyXG4gICAgICAgICAgb3JpZW50YXRpb246IGxhYmVsT3JpZW50YXRpb25cclxuICAgICAgICB9ICk7XHJcblxyXG4gICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgbGFiZWwgcG9pbnRlciBhcmVhcyBkb24ndCBibG9jayB0aGUgZXhwYW5kZWQgYnV0dG9uIHBvaW50ZXIgYXJlYXMuXHJcbiAgICAgICAgbGFiZWwucGlja2FibGUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgLy8gVXNlIHRoZSBzYW1lIGNvbnRlbnQgYXBwZWFyYW5jZSBzdHJhdGVneSBmb3IgdGhlIGxhYmVscyB0aGF0IGlzIHVzZWQgZm9yIHRoZSBidXR0b24gY29udGVudC5cclxuICAgICAgICAvLyBCeSBkZWZhdWx0LCB0aGlzIHJlZHVjZXMgb3BhY2l0eSBvZiB0aGUgbGFiZWxzIGZvciB0aGUgZGVzZWxlY3RlZCByYWRpbyBidXR0b25zLlxyXG4gICAgICAgIGlmICggb3B0aW9ucy5yYWRpb0J1dHRvbk9wdGlvbnMuY29udGVudEFwcGVhcmFuY2VTdHJhdGVneSApIHtcclxuICAgICAgICAgIGxhYmVsQXBwZWFyYW5jZVN0cmF0ZWdpZXMucHVzaCggbmV3IG9wdGlvbnMucmFkaW9CdXR0b25PcHRpb25zLmNvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3koXHJcbiAgICAgICAgICAgIGxhYmVsLFxyXG4gICAgICAgICAgICByYWRpb0J1dHRvbi5pbnRlcmFjdGlvblN0YXRlUHJvcGVydHksXHJcbiAgICAgICAgICAgIG9wdGlvbnMucmFkaW9CdXR0b25PcHRpb25zLmNvbnRlbnRBcHBlYXJhbmNlU3RyYXRlZ3lPcHRpb25zXHJcbiAgICAgICAgICApICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAvLyBUaGUgYnV0dG9uIGhhcyBubyBsYWJlbC5cclxuICAgICAgICBidXR0b24gPSByYWRpb0J1dHRvbjtcclxuICAgICAgfVxyXG4gICAgICBidXR0b25zLnB1c2goIGJ1dHRvbiApO1xyXG4gICAgICBidXR0b25zV2l0aExheW91dE5vZGVzLnB1c2goIHsgcmFkaW9CdXR0b246IHJhZGlvQnV0dG9uLCBsYXlvdXROb2RlOiBidXR0b24gfSApO1xyXG4gICAgfVxyXG5cclxuICAgIG9wdGlvbnMuY2hpbGRyZW4gPSBidXR0b25zO1xyXG5cclxuICAgIC8vIFBvaW50ZXIgYXJlYXMgYW5kIGZvY3VzIGhpZ2hsaWdodCwgc2l6ZWQgdG8gZml0IHRoZSBsYXJnZXN0IGJ1dHRvbi4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzcwOC5cclxuICAgIGNvbnN0IG1heEJ1dHRvbldpZHRoID0gXy5tYXhCeSggYnV0dG9uc1dpdGhMYXlvdXROb2RlcywgKCBidXR0b25XaXRoTGF5b3V0UGFyZW50OiBCdXR0b25XaXRoTGF5b3V0Tm9kZTxUPiApID0+IGJ1dHRvbldpdGhMYXlvdXRQYXJlbnQubGF5b3V0Tm9kZS53aWR0aCApIS5sYXlvdXROb2RlLndpZHRoO1xyXG4gICAgY29uc3QgbWF4QnV0dG9uSGVpZ2h0ID0gXy5tYXhCeSggYnV0dG9uc1dpdGhMYXlvdXROb2RlcywgKCBidXR0b25XaXRoTGF5b3V0UGFyZW50OiBCdXR0b25XaXRoTGF5b3V0Tm9kZTxUPiApID0+IGJ1dHRvbldpdGhMYXlvdXRQYXJlbnQubGF5b3V0Tm9kZS5oZWlnaHQgKSEubGF5b3V0Tm9kZS5oZWlnaHQ7XHJcbiAgICBidXR0b25zV2l0aExheW91dE5vZGVzLmZvckVhY2goICggYnV0dG9uV2l0aExheW91dFBhcmVudDogQnV0dG9uV2l0aExheW91dE5vZGU8VD4gKSA9PiB7XHJcblxyXG4gICAgICBidXR0b25XaXRoTGF5b3V0UGFyZW50LnJhZGlvQnV0dG9uLnRvdWNoQXJlYSA9IFNoYXBlLnJlY3RhbmdsZShcclxuICAgICAgICAtb3B0aW9ucy50b3VjaEFyZWFYRGlsYXRpb24gLSBtYXhMaW5lV2lkdGggLyAyLFxyXG4gICAgICAgIC1vcHRpb25zLnRvdWNoQXJlYVlEaWxhdGlvbiAtIG1heExpbmVXaWR0aCAvIDIsXHJcbiAgICAgICAgbWF4QnV0dG9uV2lkdGggKyAyICogb3B0aW9ucy50b3VjaEFyZWFYRGlsYXRpb24sXHJcbiAgICAgICAgbWF4QnV0dG9uSGVpZ2h0ICsgMiAqIG9wdGlvbnMudG91Y2hBcmVhWURpbGF0aW9uXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBidXR0b25XaXRoTGF5b3V0UGFyZW50LnJhZGlvQnV0dG9uLm1vdXNlQXJlYSA9IFNoYXBlLnJlY3RhbmdsZShcclxuICAgICAgICAtb3B0aW9ucy5tb3VzZUFyZWFYRGlsYXRpb24gLSBtYXhMaW5lV2lkdGggLyAyLFxyXG4gICAgICAgIC1vcHRpb25zLm1vdXNlQXJlYVlEaWxhdGlvbiAtIG1heExpbmVXaWR0aCAvIDIsXHJcbiAgICAgICAgbWF4QnV0dG9uV2lkdGggKyAyICogb3B0aW9ucy5tb3VzZUFyZWFYRGlsYXRpb24sXHJcbiAgICAgICAgbWF4QnV0dG9uSGVpZ2h0ICsgMiAqIG9wdGlvbnMubW91c2VBcmVhWURpbGF0aW9uXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBjb25zdCBkZWZhdWx0RGlsYXRpb25Db2VmZmljaWVudCA9IEZvY3VzSGlnaGxpZ2h0UGF0aC5nZXREaWxhdGlvbkNvZWZmaWNpZW50KCBidXR0b25XaXRoTGF5b3V0UGFyZW50LmxheW91dE5vZGUgKTtcclxuICAgICAgYnV0dG9uV2l0aExheW91dFBhcmVudC5yYWRpb0J1dHRvbi5mb2N1c0hpZ2hsaWdodCA9IFNoYXBlLnJlY3RhbmdsZShcclxuICAgICAgICAtb3B0aW9ucy5hMTF5SGlnaGxpZ2h0WERpbGF0aW9uIC0gbWF4TGluZVdpZHRoIC8gMiAtIGRlZmF1bHREaWxhdGlvbkNvZWZmaWNpZW50LFxyXG4gICAgICAgIC1vcHRpb25zLmExMXlIaWdobGlnaHRZRGlsYXRpb24gLSBtYXhMaW5lV2lkdGggLyAyIC0gZGVmYXVsdERpbGF0aW9uQ29lZmZpY2llbnQsXHJcbiAgICAgICAgbWF4QnV0dG9uV2lkdGggKyAyICogKCBvcHRpb25zLmExMXlIaWdobGlnaHRYRGlsYXRpb24gKyBkZWZhdWx0RGlsYXRpb25Db2VmZmljaWVudCApLFxyXG4gICAgICAgIG1heEJ1dHRvbkhlaWdodCArIDIgKiAoIG9wdGlvbnMuYTExeUhpZ2hsaWdodFlEaWxhdGlvbiArIGRlZmF1bHREaWxhdGlvbkNvZWZmaWNpZW50IClcclxuICAgICAgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMucmFkaW9CdXR0b25NYXAgPSByYWRpb0J1dHRvbk1hcDtcclxuXHJcbiAgICAvLyBwZG9tIC0gVGhpcyBub2RlJ3MgcHJpbWFyeSBzaWJsaW5nIGlzIGFyaWEtbGFiZWxsZWRieSBpdHMgb3duIGxhYmVsLCBzbyB0aGUgbGFiZWwgY29udGVudCBpcyByZWFkIHdoZW5ldmVyXHJcbiAgICAvLyBhIG1lbWJlciBvZiB0aGUgZ3JvdXAgcmVjZWl2ZXMgZm9jdXMuXHJcbiAgICB0aGlzLmFkZEFyaWFMYWJlbGxlZGJ5QXNzb2NpYXRpb24oIHtcclxuICAgICAgdGhpc0VsZW1lbnROYW1lOiBQRE9NUGVlci5QUklNQVJZX1NJQkxJTkcsXHJcbiAgICAgIG90aGVyTm9kZTogdGhpcyxcclxuICAgICAgb3RoZXJFbGVtZW50TmFtZTogUERPTVBlZXIuTEFCRUxfU0lCTElOR1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHBhbiBhbmQgem9vbSAtIFNpZ25pZnkgdGhhdCBrZXkgaW5wdXQgaXMgcmVzZXJ2ZWQsIGFuZCB3ZSBzaG91bGQgbm90IHBhbiB3aGVuIHVzZXIgcHJlc3NlcyBhcnJvdyBrZXlzLlxyXG4gICAgY29uc3QgaW50ZW50TGlzdGVuZXI6IFRJbnB1dExpc3RlbmVyID0geyBrZXlkb3duOiBldmVudCA9PiBldmVudC5wb2ludGVyLnJlc2VydmVGb3JLZXlib2FyZERyYWcoKSB9O1xyXG4gICAgdGhpcy5hZGRJbnB1dExpc3RlbmVyKCBpbnRlbnRMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIG11c3QgYmUgZG9uZSBhZnRlciB0aGlzIGluc3RhbmNlIGlzIGluc3RydW1lbnRlZFxyXG4gICAgdGhpcy5hZGRMaW5rZWRFbGVtZW50KCBwcm9wZXJ0eSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Byb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlUmFkaW9CdXR0b25Hcm91cCA9ICgpID0+IHtcclxuICAgICAgdGhpcy5yZW1vdmVJbnB1dExpc3RlbmVyKCBpbnRlbnRMaXN0ZW5lciApO1xyXG4gICAgICBidXR0b25zLmZvckVhY2goIGJ1dHRvbiA9PiBidXR0b24uZGlzcG9zZSgpICk7XHJcbiAgICAgIGxhYmVsQXBwZWFyYW5jZVN0cmF0ZWdpZXMuZm9yRWFjaCggc3RyYXRlZ3kgPT4gKCBzdHJhdGVneS5kaXNwb3NlICYmIHN0cmF0ZWd5LmRpc3Bvc2UoKSApICk7XHJcbiAgICAgIG5vZGVzLmZvckVhY2goIG5vZGUgPT4gbm9kZS5kaXNwb3NlKCkgKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gcGRvbSAtIHJlZ2lzdGVyIGNvbXBvbmVudCBmb3IgYmluZGVyIGRvY3NcclxuICAgIGFzc2VydCAmJiBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmJpbmRlciAmJiBJbnN0YW5jZVJlZ2lzdHJ5LnJlZ2lzdGVyRGF0YVVSTCggJ3N1bicsICdSZWN0YW5ndWxhclJhZGlvQnV0dG9uR3JvdXAnLCB0aGlzICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGaW5kIHRoZSBSZWN0YW5ndWxhclJhZGlvQnV0dG9uIGNvcnJlc3BvbmRpbmcgdG8gYSB2YWx1ZS4gTm90ZSB0aGF0IGluIHRoZSBzY2VuZSBncmFwaCwgdGhlIGJ1dHRvbiBtYXkgYmUgbmVzdGVkXHJcbiAgICogdW5kZXIgb3RoZXIgbGF5ZXJzLCBzbyB1c2UgY2F1dGlvbiBmb3IgY29vcmRpbmF0ZSB0cmFuc2Zvcm1hdGlvbnMuXHJcbiAgICogQHBhcmFtIHZhbHVlXHJcbiAgICogQHJldHVybnMgdGhlIGNvcnJlc3BvbmRpbmcgYnV0dG9uXHJcbiAgICovXHJcbiAgcHVibGljIGdldEJ1dHRvbkZvclZhbHVlKCB2YWx1ZTogVCApOiBSZWN0YW5ndWxhclJhZGlvQnV0dG9uPFQ+IHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmFkaW9CdXR0b25NYXAuZ2V0KCB2YWx1ZSApITtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHJlc3VsdCwgJ05vIGJ1dHRvbiBmb3VuZCBmb3IgdmFsdWU6ICcgKyB2YWx1ZSApO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5yYWRpb0J1dHRvbk1hcC5jbGVhcigpO1xyXG4gICAgdGhpcy5kaXNwb3NlUmFkaW9CdXR0b25Hcm91cCgpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuc3VuLnJlZ2lzdGVyKCAnUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwJywgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBU0EsS0FBSyxRQUFRLDZCQUE2QjtBQUNuRCxPQUFPQyxnQkFBZ0IsTUFBTSx5REFBeUQ7QUFDdEYsU0FBU0MsS0FBSyxFQUFFQyxPQUFPLEVBQWtCQyxrQkFBa0IsRUFBUUMsUUFBUSxFQUFpQkMsU0FBUyxFQUFFQyxnQkFBZ0IsUUFBd0IsZ0NBQWdDO0FBQy9LLE9BQU9DLGdDQUFnQyxNQUFNLHVEQUF1RDtBQUNwRyxPQUFPQyxNQUFNLE1BQU0sOEJBQThCO0FBQ2pELE9BQU9DLGNBQWMsTUFBTSxzQkFBc0I7QUFDakQsT0FBT0MsR0FBRyxNQUFNLFdBQVc7QUFDM0IsT0FBT0Msc0JBQXNCLE1BQXlDLDZCQUE2QjtBQUtuRyxPQUFPQyxTQUFTLElBQUlDLGNBQWMsUUFBUSxvQ0FBb0M7QUFFOUUsU0FBMkJDLGlCQUFpQixRQUFRLHdCQUF3Qjs7QUFFNUU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJQyxhQUFhLEdBQUcsQ0FBQzs7QUFFckI7QUFDQSxNQUFNQyxVQUFVLEdBQUcsNkJBQTZCOztBQUVoRDs7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBTUE7O0FBc0NBLGVBQWUsTUFBTUMsMkJBQTJCLFNBQVlmLE9BQU8sQ0FBQztFQUszRGdCLFdBQVdBLENBQUVDLFFBQXFCLEVBQUVDLEtBQTJDLEVBQUVDLGVBQW9ELEVBQUc7SUFFN0lDLE1BQU0sSUFBSUEsTUFBTSxDQUFFQyxDQUFDLENBQUNDLE1BQU0sQ0FBRUosS0FBSyxFQUFFSyxJQUFJLElBQUlBLElBQUksQ0FBQ0MsS0FBTSxDQUFDLENBQUNDLE1BQU0sS0FBS1AsS0FBSyxDQUFDTyxNQUFNLEVBQzdFLCtCQUFnQyxDQUFDO0lBQ25DTCxNQUFNLElBQUlBLE1BQU0sQ0FBRUMsQ0FBQyxDQUFDSyxJQUFJLENBQUVSLEtBQUssRUFBRUssSUFBSSxJQUFNQSxJQUFJLENBQUNDLEtBQUssS0FBS1AsUUFBUSxDQUFDTyxLQUFRLENBQUMsRUFDMUUseURBQTBELENBQUM7SUFFN0QsTUFBTUcsT0FBTyxHQUFHakIsU0FBUyxDQUFrRSxDQUFDLENBQUU7TUFFNUY7TUFDQWtCLFlBQVksRUFBRSxJQUFJO01BQ2xCQyxVQUFVLEVBQUUsUUFBUTtNQUNwQkMsWUFBWSxFQUFFLENBQUM7TUFDZkMsc0JBQXNCLEVBQUUsQ0FBQztNQUN6QkMsc0JBQXNCLEVBQUUsQ0FBQztNQUN6QkMsa0JBQWtCLEVBQUUsQ0FBQztNQUNyQkMsa0JBQWtCLEVBQUUsQ0FBQztNQUNyQkMsa0JBQWtCLEVBQUUsQ0FBQztNQUNyQkMsa0JBQWtCLEVBQUUsQ0FBQztNQUNyQkMsa0JBQWtCLEVBQUU7UUFDbEJDLFNBQVMsRUFBRS9CLGNBQWMsQ0FBQ2dDLFVBQVU7UUFDcENDLFlBQVksRUFBRSxDQUFDO1FBQ2ZDLE9BQU8sRUFBRSxDQUFDO1FBQ1ZDLE9BQU8sRUFBRSxDQUFDO1FBQ1ZDLE1BQU0sRUFBRSxRQUFRO1FBQ2hCQyxNQUFNLEVBQUUsUUFBUTtRQUNoQkMsK0JBQStCLEVBQUU7VUFDL0JDLGNBQWMsRUFBRSxPQUFPO1VBQ3ZCQyxpQkFBaUIsRUFBRSxHQUFHO1VBQ3RCQyxxQkFBcUIsRUFBRSxDQUFDO1VBQ3hCQyxnQkFBZ0IsRUFBRSxJQUFJbEQsS0FBSyxDQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRyxDQUFDO1VBQ3pDbUQsbUJBQW1CLEVBQUUsQ0FBQztVQUN0QkMsdUJBQXVCLEVBQUUsR0FBRztVQUM1QkMsaUJBQWlCLEVBQUU7UUFDckIsQ0FBQztRQUNEQyx5QkFBeUIsRUFBRTVDLHNCQUFzQixDQUFDNkMseUJBQXlCO1FBQzNFQyxnQ0FBZ0MsRUFBRTtVQUNoQ0Msa0JBQWtCLEVBQUUsR0FBRztVQUN2QkMsc0JBQXNCLEVBQUUsQ0FBQztVQUN6QkMsd0JBQXdCLEVBQUU7UUFDNUI7TUFDRixDQUFDO01BRUQ7TUFDQUMsT0FBTyxFQUFFLEVBQUU7TUFDWEMsV0FBVyxFQUFFLFVBQVU7TUFDdkJDLGVBQWUsRUFBRXpELGdCQUFnQixDQUFDMEQsZ0JBQWdCO01BRWxEO01BQ0FDLE1BQU0sRUFBRXpELE1BQU0sQ0FBQzBELFFBQVE7TUFDdkJDLGdCQUFnQixFQUFFLGFBQWE7TUFDL0JDLHNCQUFzQixFQUFFO1FBQUVDLGNBQWMsRUFBRTtNQUFLLENBQUM7TUFDaERDLGlDQUFpQyxFQUFFLElBQUk7TUFBRTs7TUFFekM7TUFDQUMsT0FBTyxFQUFFLElBQUk7TUFDYkMsWUFBWSxFQUFFLElBQUk7TUFDbEJDLFFBQVEsRUFBRSxZQUFZO01BQ3RCQyxtQkFBbUIsRUFBRTtJQUN2QixDQUFDLEVBQUVyRCxlQUFnQixDQUFDO0lBRXBCQyxNQUFNLElBQUlBLE1BQU0sQ0FBRU8sT0FBTyxDQUFDQyxZQUFZLEtBQUssSUFBSSxJQUFJRCxPQUFPLENBQUNDLFlBQVksQ0FBQ0gsTUFBTSxLQUFLUCxLQUFLLENBQUNPLE1BQU0sRUFDN0Ysa0VBQW1FLENBQUM7SUFFdEVaLGFBQWEsRUFBRTtJQUVmLE1BQU00RCxjQUFjLEdBQUcsSUFBSUMsR0FBRyxDQUErQixDQUFDOztJQUU5RDtJQUNBLE1BQU1DLFlBQVksR0FBR0MsSUFBSSxDQUFDQyxHQUFHLENBQzNCbEQsT0FBTyxDQUFDVSxrQkFBa0IsQ0FBQ1EsK0JBQStCLENBQUVFLGlCQUFpQixFQUM3RXBCLE9BQU8sQ0FBQ1Usa0JBQWtCLENBQUNRLCtCQUErQixDQUFFSyxtQkFDOUQsQ0FBQztJQUVELE1BQU00QixLQUFLLEdBQUdsRSxpQkFBaUIsQ0FBRU0sS0FBSyxFQUFFUyxPQUFPLENBQUNvQyxNQUFPLENBQUM7SUFDeEQzQyxNQUFNLElBQUlBLE1BQU0sQ0FBRUMsQ0FBQyxDQUFDMEQsS0FBSyxDQUFFRCxLQUFLLEVBQUVFLElBQUksSUFBSSxDQUFDQSxJQUFJLENBQUNDLGNBQWUsQ0FBQyxFQUM5RCx3R0FBd0csR0FDeEcseUVBQTBFLENBQUM7O0lBRTdFO0lBQ0EsTUFBTUMsa0JBQWtCLEdBQUc3RCxDQUFDLENBQUM4RCxLQUFLLENBQUVMLEtBQUssRUFBRUUsSUFBSSxJQUFJQSxJQUFJLENBQUNJLEtBQU0sQ0FBQyxDQUFFQSxLQUFLO0lBQ3RFLE1BQU1DLG9CQUFvQixHQUFHaEUsQ0FBQyxDQUFDOEQsS0FBSyxDQUFFTCxLQUFLLEVBQUVFLElBQUksSUFBSUEsSUFBSSxDQUFDTSxNQUFPLENBQUMsQ0FBRUEsTUFBTTs7SUFFMUU7SUFDQSxNQUFNQyxPQUFtRCxHQUFHLEVBQUU7SUFDOUQsTUFBTUMsc0JBQWlELEdBQUcsRUFBRTtJQUM1RCxNQUFNQyx5QkFBcUUsR0FBRyxFQUFFO0lBRWhGLE1BQU1oRCxPQUFlLEdBQUdkLE9BQU8sQ0FBQ1Usa0JBQWtCLENBQUNJLE9BQVE7SUFDM0QsTUFBTUMsT0FBZSxHQUFHZixPQUFPLENBQUNVLGtCQUFrQixDQUFDSyxPQUFRO0lBRTNELEtBQU0sSUFBSWdELENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR3hFLEtBQUssQ0FBQ08sTUFBTSxFQUFFaUUsQ0FBQyxFQUFFLEVBQUc7TUFDdkMsTUFBTW5FLElBQUksR0FBR0wsS0FBSyxDQUFFd0UsQ0FBQyxDQUFFO01BQ3ZCLE1BQU1WLElBQUksR0FBR0YsS0FBSyxDQUFFWSxDQUFDLENBQUU7TUFFdkIsTUFBTXJELGtCQUFrQixHQUFHMUIsY0FBYyxDQUFpQztRQUN4RWdGLE9BQU8sRUFBRVgsSUFBSTtRQUNiWSxRQUFRLEVBQUVWLGtCQUFrQixHQUFHLENBQUMsR0FBR3pDLE9BQU87UUFDMUNvRCxTQUFTLEVBQUVSLG9CQUFvQixHQUFHLENBQUMsR0FBRzNDLE9BQU87UUFDN0NvRCxXQUFXLEVBQUVuRSxPQUFPLENBQUNDLFlBQVksR0FBR0QsT0FBTyxDQUFDQyxZQUFZLENBQUU4RCxDQUFDLENBQUUsR0FDaERyRixnQ0FBZ0MsQ0FBQzBGLHVCQUF1QixDQUFFTCxDQUFFLENBQUM7UUFDMUUzQixNQUFNLEVBQUV4QyxJQUFJLENBQUN5RSxVQUFVLEdBQUdyRSxPQUFPLENBQUNvQyxNQUFNLENBQUNrQyxZQUFZLENBQUUxRSxJQUFJLENBQUN5RSxVQUFXLENBQUMsR0FDaEVyRSxPQUFPLENBQUNvQyxNQUFNLEtBQUt6RCxNQUFNLENBQUM0RixPQUFPLEdBQUc1RixNQUFNLENBQUM0RixPQUFPLEdBQ2xENUYsTUFBTSxDQUFDMEQsUUFBUTtRQUN2Qm1DLG1CQUFtQixFQUFFNUUsSUFBSSxDQUFDNEUsbUJBQW1CLElBQUk7TUFDbkQsQ0FBQyxFQUFFeEUsT0FBTyxDQUFDVSxrQkFBa0IsRUFBRWQsSUFBSSxDQUFDSSxPQUFRLENBQUM7O01BRTdDO01BQ0EsSUFBS0osSUFBSSxDQUFDNkUsWUFBWSxFQUFHO1FBQ3ZCL0Qsa0JBQWtCLENBQUMrRCxZQUFZLEdBQUc3RSxJQUFJLENBQUM2RSxZQUFZO1FBQ25EL0Qsa0JBQWtCLENBQUNnRSxtQkFBbUIsR0FBRzlFLElBQUksQ0FBQzZFLFlBQVk7TUFDNUQ7O01BRUE7TUFDQTtNQUNBLElBQUs3RSxJQUFJLENBQUMrRSxrQkFBa0IsRUFBRztRQUM3QmpFLGtCQUFrQixDQUFDaUUsa0JBQWtCLEdBQUcvRSxJQUFJLENBQUMrRSxrQkFBa0I7TUFDakU7TUFFQSxJQUFLL0UsSUFBSSxDQUFDZ0Ysc0JBQXNCLEVBQUc7UUFDakNsRSxrQkFBa0IsQ0FBQ2tFLHNCQUFzQixHQUFHaEYsSUFBSSxDQUFDZ0Ysc0JBQXNCO01BQ3pFO01BRUEsTUFBTUMsV0FBVyxHQUFHLElBQUkvRixzQkFBc0IsQ0FBRVEsUUFBUSxFQUFFTSxJQUFJLENBQUNDLEtBQUssRUFBRWEsa0JBQW1CLENBQUM7TUFFMUZvQyxjQUFjLENBQUNnQyxHQUFHLENBQUVsRixJQUFJLENBQUNDLEtBQUssRUFBRWdGLFdBQVksQ0FBQzs7TUFFN0M7TUFDQUEsV0FBVyxDQUFDRSxnQkFBZ0IsQ0FBRSxNQUFNLEVBQUU1RixVQUFVLEdBQUdELGFBQWMsQ0FBQzs7TUFFbEU7TUFDQSxNQUFNOEYsY0FBYyxHQUFHaEMsWUFBWSxHQUFHTyxrQkFBa0IsR0FBRyxDQUFDLEdBQUd6QyxPQUFPO01BQ3RFLE1BQU1tRSxlQUFlLEdBQUdqQyxZQUFZLEdBQUdVLG9CQUFvQixHQUFHLENBQUMsR0FBRzNDLE9BQU87TUFDekUsTUFBTW1FLFlBQVksR0FBRyxJQUFJMUcsU0FBUyxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUV3RyxjQUFjLEVBQUVDLGVBQWUsRUFBRTtRQUN6RUUsSUFBSSxFQUFFLGVBQWU7UUFDckJDLE1BQU0sRUFBRVAsV0FBVyxDQUFDTztNQUN0QixDQUFFLENBQUM7TUFDSFAsV0FBVyxDQUFDUSxRQUFRLENBQUVILFlBQWEsQ0FBQztNQUVwQyxJQUFJSSxNQUFNO01BQ1YsSUFBSzFGLElBQUksQ0FBQzJGLEtBQUssRUFBRztRQUVoQjtRQUNBLE1BQU1BLEtBQUssR0FBRzNGLElBQUksQ0FBQzJGLEtBQUs7UUFDeEIsTUFBTUMsZ0JBQWdCLEdBQUt4RixPQUFPLENBQUNFLFVBQVUsS0FBSyxRQUFRLElBQUlGLE9BQU8sQ0FBQ0UsVUFBVSxLQUFLLEtBQUssR0FBSyxVQUFVLEdBQUcsWUFBWTtRQUN4SCxNQUFNdUYsYUFBYSxHQUFLekYsT0FBTyxDQUFDRSxVQUFVLEtBQUssTUFBTSxJQUFJRixPQUFPLENBQUNFLFVBQVUsS0FBSyxLQUFLLEdBQUssQ0FBRXFGLEtBQUssRUFBRVYsV0FBVyxDQUFFLEdBQUcsQ0FBRUEsV0FBVyxFQUFFVSxLQUFLLENBQUU7UUFDeklELE1BQU0sR0FBRyxJQUFJakgsT0FBTyxDQUFFO1VBQ3BCcUgsUUFBUSxFQUFFRCxhQUFhO1VBQ3ZCekQsT0FBTyxFQUFFaEMsT0FBTyxDQUFDRyxZQUFZO1VBQzdCOEIsV0FBVyxFQUFFdUQ7UUFDZixDQUFFLENBQUM7O1FBRUg7UUFDQUQsS0FBSyxDQUFDSSxRQUFRLEdBQUcsS0FBSzs7UUFFdEI7UUFDQTtRQUNBLElBQUszRixPQUFPLENBQUNVLGtCQUFrQixDQUFDZ0IseUJBQXlCLEVBQUc7VUFDMURvQyx5QkFBeUIsQ0FBQzhCLElBQUksQ0FBRSxJQUFJNUYsT0FBTyxDQUFDVSxrQkFBa0IsQ0FBQ2dCLHlCQUF5QixDQUN0RjZELEtBQUssRUFDTFYsV0FBVyxDQUFDZ0Isd0JBQXdCLEVBQ3BDN0YsT0FBTyxDQUFDVSxrQkFBa0IsQ0FBQ2tCLGdDQUM3QixDQUFFLENBQUM7UUFDTDtNQUNGLENBQUMsTUFDSTtRQUVIO1FBQ0EwRCxNQUFNLEdBQUdULFdBQVc7TUFDdEI7TUFDQWpCLE9BQU8sQ0FBQ2dDLElBQUksQ0FBRU4sTUFBTyxDQUFDO01BQ3RCekIsc0JBQXNCLENBQUMrQixJQUFJLENBQUU7UUFBRWYsV0FBVyxFQUFFQSxXQUFXO1FBQUVpQixVQUFVLEVBQUVSO01BQU8sQ0FBRSxDQUFDO0lBQ2pGO0lBRUF0RixPQUFPLENBQUMwRixRQUFRLEdBQUc5QixPQUFPOztJQUUxQjtJQUNBLE1BQU1vQixjQUFjLEdBQUd0RixDQUFDLENBQUM4RCxLQUFLLENBQUVLLHNCQUFzQixFQUFJa0Msc0JBQStDLElBQU1BLHNCQUFzQixDQUFDRCxVQUFVLENBQUNyQyxLQUFNLENBQUMsQ0FBRXFDLFVBQVUsQ0FBQ3JDLEtBQUs7SUFDMUssTUFBTXdCLGVBQWUsR0FBR3ZGLENBQUMsQ0FBQzhELEtBQUssQ0FBRUssc0JBQXNCLEVBQUlrQyxzQkFBK0MsSUFBTUEsc0JBQXNCLENBQUNELFVBQVUsQ0FBQ25DLE1BQU8sQ0FBQyxDQUFFbUMsVUFBVSxDQUFDbkMsTUFBTTtJQUM3S0Usc0JBQXNCLENBQUNtQyxPQUFPLENBQUlELHNCQUErQyxJQUFNO01BRXJGQSxzQkFBc0IsQ0FBQ2xCLFdBQVcsQ0FBQ29CLFNBQVMsR0FBRy9ILEtBQUssQ0FBQ2dJLFNBQVMsQ0FDNUQsQ0FBQ2xHLE9BQU8sQ0FBQ00sa0JBQWtCLEdBQUcwQyxZQUFZLEdBQUcsQ0FBQyxFQUM5QyxDQUFDaEQsT0FBTyxDQUFDTyxrQkFBa0IsR0FBR3lDLFlBQVksR0FBRyxDQUFDLEVBQzlDZ0MsY0FBYyxHQUFHLENBQUMsR0FBR2hGLE9BQU8sQ0FBQ00sa0JBQWtCLEVBQy9DMkUsZUFBZSxHQUFHLENBQUMsR0FBR2pGLE9BQU8sQ0FBQ08sa0JBQ2hDLENBQUM7TUFFRHdGLHNCQUFzQixDQUFDbEIsV0FBVyxDQUFDc0IsU0FBUyxHQUFHakksS0FBSyxDQUFDZ0ksU0FBUyxDQUM1RCxDQUFDbEcsT0FBTyxDQUFDUSxrQkFBa0IsR0FBR3dDLFlBQVksR0FBRyxDQUFDLEVBQzlDLENBQUNoRCxPQUFPLENBQUNTLGtCQUFrQixHQUFHdUMsWUFBWSxHQUFHLENBQUMsRUFDOUNnQyxjQUFjLEdBQUcsQ0FBQyxHQUFHaEYsT0FBTyxDQUFDUSxrQkFBa0IsRUFDL0N5RSxlQUFlLEdBQUcsQ0FBQyxHQUFHakYsT0FBTyxDQUFDUyxrQkFDaEMsQ0FBQztNQUVELE1BQU0yRiwwQkFBMEIsR0FBRzlILGtCQUFrQixDQUFDK0gsc0JBQXNCLENBQUVOLHNCQUFzQixDQUFDRCxVQUFXLENBQUM7TUFDakhDLHNCQUFzQixDQUFDbEIsV0FBVyxDQUFDeUIsY0FBYyxHQUFHcEksS0FBSyxDQUFDZ0ksU0FBUyxDQUNqRSxDQUFDbEcsT0FBTyxDQUFDSSxzQkFBc0IsR0FBRzRDLFlBQVksR0FBRyxDQUFDLEdBQUdvRCwwQkFBMEIsRUFDL0UsQ0FBQ3BHLE9BQU8sQ0FBQ0ssc0JBQXNCLEdBQUcyQyxZQUFZLEdBQUcsQ0FBQyxHQUFHb0QsMEJBQTBCLEVBQy9FcEIsY0FBYyxHQUFHLENBQUMsSUFBS2hGLE9BQU8sQ0FBQ0ksc0JBQXNCLEdBQUdnRywwQkFBMEIsQ0FBRSxFQUNwRm5CLGVBQWUsR0FBRyxDQUFDLElBQUtqRixPQUFPLENBQUNLLHNCQUFzQixHQUFHK0YsMEJBQTBCLENBQ3JGLENBQUM7SUFDSCxDQUFFLENBQUM7SUFFSCxLQUFLLENBQUVwRyxPQUFRLENBQUM7SUFFaEIsSUFBSSxDQUFDOEMsY0FBYyxHQUFHQSxjQUFjOztJQUVwQztJQUNBO0lBQ0EsSUFBSSxDQUFDeUQsNEJBQTRCLENBQUU7TUFDakNDLGVBQWUsRUFBRWpJLFFBQVEsQ0FBQ2tJLGVBQWU7TUFDekNDLFNBQVMsRUFBRSxJQUFJO01BQ2ZDLGdCQUFnQixFQUFFcEksUUFBUSxDQUFDcUk7SUFDN0IsQ0FBRSxDQUFDOztJQUVIO0lBQ0EsTUFBTUMsY0FBOEIsR0FBRztNQUFFQyxPQUFPLEVBQUVDLEtBQUssSUFBSUEsS0FBSyxDQUFDQyxPQUFPLENBQUNDLHNCQUFzQixDQUFDO0lBQUUsQ0FBQztJQUNuRyxJQUFJLENBQUNDLGdCQUFnQixDQUFFTCxjQUFlLENBQUM7O0lBRXZDO0lBQ0EsSUFBSSxDQUFDTSxnQkFBZ0IsQ0FBRTdILFFBQVEsRUFBRTtNQUMvQjhDLE1BQU0sRUFBRXBDLE9BQU8sQ0FBQ29DLE1BQU0sQ0FBQ2tDLFlBQVksQ0FBRSxVQUFXO0lBQ2xELENBQUUsQ0FBQztJQUVILElBQUksQ0FBQzhDLHVCQUF1QixHQUFHLE1BQU07TUFDbkMsSUFBSSxDQUFDQyxtQkFBbUIsQ0FBRVIsY0FBZSxDQUFDO01BQzFDakQsT0FBTyxDQUFDb0MsT0FBTyxDQUFFVixNQUFNLElBQUlBLE1BQU0sQ0FBQ2dDLE9BQU8sQ0FBQyxDQUFFLENBQUM7TUFDN0N4RCx5QkFBeUIsQ0FBQ2tDLE9BQU8sQ0FBRXVCLFFBQVEsSUFBTUEsUUFBUSxDQUFDRCxPQUFPLElBQUlDLFFBQVEsQ0FBQ0QsT0FBTyxDQUFDLENBQUksQ0FBQztNQUMzRm5FLEtBQUssQ0FBQzZDLE9BQU8sQ0FBRTNDLElBQUksSUFBSUEsSUFBSSxDQUFDaUUsT0FBTyxDQUFDLENBQUUsQ0FBQztJQUN6QyxDQUFDOztJQUVEO0lBQ0E3SCxNQUFNLElBQUkrSCxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsZUFBZSxDQUFDQyxNQUFNLElBQUl4SixnQkFBZ0IsQ0FBQ3lKLGVBQWUsQ0FBRSxLQUFLLEVBQUUsNkJBQTZCLEVBQUUsSUFBSyxDQUFDO0VBQ2pJOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNTQyxpQkFBaUJBLENBQUVoSSxLQUFRLEVBQThCO0lBQzlELE1BQU1pSSxNQUFNLEdBQUcsSUFBSSxDQUFDaEYsY0FBYyxDQUFDaUYsR0FBRyxDQUFFbEksS0FBTSxDQUFFO0lBQ2hESixNQUFNLElBQUlBLE1BQU0sQ0FBRXFJLE1BQU0sRUFBRSw2QkFBNkIsR0FBR2pJLEtBQU0sQ0FBQztJQUNqRSxPQUFPaUksTUFBTTtFQUNmO0VBRWdCUixPQUFPQSxDQUFBLEVBQVM7SUFDOUIsSUFBSSxDQUFDeEUsY0FBYyxDQUFDa0YsS0FBSyxDQUFDLENBQUM7SUFDM0IsSUFBSSxDQUFDWix1QkFBdUIsQ0FBQyxDQUFDO0lBQzlCLEtBQUssQ0FBQ0UsT0FBTyxDQUFDLENBQUM7RUFDakI7QUFDRjtBQUVBekksR0FBRyxDQUFDb0osUUFBUSxDQUFFLDZCQUE2QixFQUFFN0ksMkJBQTRCLENBQUMifQ==