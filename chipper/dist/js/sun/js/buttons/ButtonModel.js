// Copyright 2014-2022, University of Colorado Boulder

/**
 * Base class for button models, which describe the behavior of buttons when users interact with them.  Property values
 * are set by an associated listener, see PressListener for details.
 */

import BooleanProperty from '../../../axon/js/BooleanProperty.js';
import Emitter from '../../../axon/js/Emitter.js';
import optionize, { combineOptions } from '../../../phet-core/js/optionize.js';
import { PressListener } from '../../../scenery/js/imports.js';
import PhetioObject from '../../../tandem/js/PhetioObject.js';
import Tandem from '../../../tandem/js/Tandem.js';
import EnabledComponent from '../../../axon/js/EnabledComponent.js';
import sun from '../sun.js';
import Multilink from '../../../axon/js/Multilink.js';
export default class ButtonModel extends EnabledComponent {
  // Is the pointer over the button? Value is read-only.

  // Is the pointer down?

  // Is the button focused from the PDOM?

  // This Property was added for a11y. It tracks whether or not the button should "look" down. This
  // will be true if downProperty is true or if an a11y click is in progress. For an a11y click, the listeners
  // are fired right away but the button will look down for as long as PressListener.a11yLooksPressedInterval.
  // See PressListener.click for more details.
  // This Property was added for a11y. It tracks whether or not the button should "look" over. This
  // will be true if and PressListeners' looksOverProperty is true, see PressListener for that definition.
  // (read-only by users, read-write in subclasses) - emitter that is fired when sound should be produced
  // indicates that interaction was interrupted during a press. Valid until next press.
  // keep track of and store all listeners this model creates
  // Links all of the looksPressedProperties from the listeners that were created
  // by this ButtonModel, and updates the looksPressedProperty accordingly. First Multilink is added when the
  // first listener is created. See this.createPressListener.
  // Links all of the looksOverProperties from the listeners that were created
  // by this ButtonModel, and updates the looksOverProperty accordingly. First Multilink is added when the
  // first listener is created. See this.createPressListener.
  constructor(providedOptions) {
    const options = optionize()({
      startCallback: _.noop,
      endCallback: _.noop,
      // phet-io
      tandem: Tandem.REQUIRED,
      phetioState: PhetioObject.DEFAULT_OPTIONS.phetioState,
      phetioReadOnly: PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,
      phetioFeatured: PhetioObject.DEFAULT_OPTIONS.phetioFeatured
    }, providedOptions);

    // Set up enabledPropertyOptions for the enabledProperty that the mixin might create
    options.enabledPropertyOptions = combineOptions({
      // phet-io
      phetioState: options.phetioState,
      phetioReadOnly: options.phetioReadOnly,
      phetioDocumentation: 'When disabled, the button is grayed out and cannot be pressed',
      phetioFeatured: true
    }, options.enabledPropertyOptions);
    super(options);

    // model Properties
    this.overProperty = new BooleanProperty(false);
    this.downProperty = new BooleanProperty(false, {
      reentrant: true
    });
    this.focusedProperty = new BooleanProperty(false);
    this.looksPressedProperty = new BooleanProperty(false);
    this.looksOverProperty = new BooleanProperty(false);
    this.produceSoundEmitter = new Emitter();
    this.interrupted = false;
    this.listeners = [];

    // Links all of the looksPressedProperties from the listeners that were created
    // by this ButtonModel, and updates the looksPressedProperty accordingly. First Multilink is added when the
    // first listener is created. See this.createPressListener.
    this.looksPressedMultilink = null;

    // Links all of the looksOverProperties from the listeners that were created
    // by this ButtonModel, and updates the looksOverProperty accordingly. First Multilink is added when the
    // first listener is created. See this.createPressListener.
    this.looksOverMultilink = null;

    // Call startCallback on pointer down, endCallback on pointer up. Use lazyLink so they aren't called immediately.
    // No unlink needed since this button model owns the Property.
    this.downProperty.lazyLink(down => {
      if (down) {
        options.startCallback();
      } else {
        options.endCallback(this.looksOverProperty.get());
      }
    });

    // Interrupt input listeners when enabled is set to false. This is the equivalent of Node.interruptSubtreeInput,
    // but ButtonModel is not a Node, so we have to interrupt each listener. See https://github.com/phetsims/sun/issues/642.
    this.enabledProperty.link(enabled => {
      if (!enabled) {
        for (let i = 0; i < this.listeners.length; i++) {
          const listener = this.listeners[i];
          listener.interrupt && listener.interrupt();
        }
      }
    });
    this.disposeButtonModel = () => {
      // This will unlink all listeners, causing potential issues if listeners try to unlink Properties afterwards
      this.overProperty.dispose();
      this.downProperty.dispose();
      this.produceSoundEmitter.dispose();
      this.looksPressedMultilink && this.looksPressedMultilink.dispose();
      this.looksOverMultilink && this.looksOverMultilink.dispose();
      this.listeners = [];
    };
  }
  dispose() {
    this.disposeButtonModel();
    super.dispose();
  }

  /**
   * Creates a PressListener that will handle changes to ButtonModel when the associated button Node is pressed.
   * The client is responsible for adding this PressListener to the associated button Node.
   */
  createPressListener(options) {
    options = combineOptions({
      canStartPress: () => this.enabledProperty.value
    }, options);
    const pressListener = new PressListener(options);
    this.listeners.push(pressListener);

    // Link lazily in case client externally sets downProperty - don't update until the next press.  No unlink needed
    // because the pressListener is local.
    pressListener.isPressedProperty.lazyLink(isPressed => {
      // determine interrupted first so listeners on downProperty have access
      this.interrupted = pressListener.interrupted;
      this.downProperty.set(isPressed);
    });
    pressListener.isOverProperty.lazyLink(this.overProperty.set.bind(this.overProperty));
    pressListener.isFocusedProperty.lazyLink(this.focusedProperty.set.bind(this.focusedProperty));

    // dispose the previous multilink in case we already created a PressListener with this model
    this.looksPressedMultilink && this.looksPressedMultilink.dispose();
    this.looksOverMultilink && this.looksOverMultilink.dispose();

    // the downProperty is included because it can be set externally, looksPressedProperty should update in this case
    const looksPressedProperties = this.listeners.map(listener => listener.looksPressedProperty);
    looksPressedProperties.push(this.downProperty);

    // assign a new Multilink (for disposal), and make sure that the button looks pressed when any of the
    // PressListeners created by this ButtonModel look pressed.
    this.looksPressedMultilink = Multilink.multilinkAny(looksPressedProperties, (...args) => {
      this.looksPressedProperty.value = _.reduce(args, (sum, newValue) => sum || newValue, false);
    });
    const looksOverProperties = this.listeners.map(listener => listener.looksOverProperty);

    // assign a new Multilink (for disposal), and make sure that the button looks over when any of the
    // PressListeners created by this ButtonModel look over. Note that this cannot be an arrow function
    // because its implementation relies on arguments.
    this.looksOverMultilink = Multilink.multilinkAny(looksOverProperties, (...args) => {
      this.looksOverProperty.value = _.reduce(args, (sum, newValue) => sum || newValue, false);
    });
    return pressListener;
  }
}
sun.register('ButtonModel', ButtonModel);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJFbWl0dGVyIiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJQcmVzc0xpc3RlbmVyIiwiUGhldGlvT2JqZWN0IiwiVGFuZGVtIiwiRW5hYmxlZENvbXBvbmVudCIsInN1biIsIk11bHRpbGluayIsIkJ1dHRvbk1vZGVsIiwiY29uc3RydWN0b3IiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwic3RhcnRDYWxsYmFjayIsIl8iLCJub29wIiwiZW5kQ2FsbGJhY2siLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInBoZXRpb1N0YXRlIiwiREVGQVVMVF9PUFRJT05TIiwicGhldGlvUmVhZE9ubHkiLCJwaGV0aW9GZWF0dXJlZCIsImVuYWJsZWRQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwib3ZlclByb3BlcnR5IiwiZG93blByb3BlcnR5IiwicmVlbnRyYW50IiwiZm9jdXNlZFByb3BlcnR5IiwibG9va3NQcmVzc2VkUHJvcGVydHkiLCJsb29rc092ZXJQcm9wZXJ0eSIsInByb2R1Y2VTb3VuZEVtaXR0ZXIiLCJpbnRlcnJ1cHRlZCIsImxpc3RlbmVycyIsImxvb2tzUHJlc3NlZE11bHRpbGluayIsImxvb2tzT3Zlck11bHRpbGluayIsImxhenlMaW5rIiwiZG93biIsImdldCIsImVuYWJsZWRQcm9wZXJ0eSIsImxpbmsiLCJlbmFibGVkIiwiaSIsImxlbmd0aCIsImxpc3RlbmVyIiwiaW50ZXJydXB0IiwiZGlzcG9zZUJ1dHRvbk1vZGVsIiwiZGlzcG9zZSIsImNyZWF0ZVByZXNzTGlzdGVuZXIiLCJjYW5TdGFydFByZXNzIiwidmFsdWUiLCJwcmVzc0xpc3RlbmVyIiwicHVzaCIsImlzUHJlc3NlZFByb3BlcnR5IiwiaXNQcmVzc2VkIiwic2V0IiwiaXNPdmVyUHJvcGVydHkiLCJiaW5kIiwiaXNGb2N1c2VkUHJvcGVydHkiLCJsb29rc1ByZXNzZWRQcm9wZXJ0aWVzIiwibWFwIiwibXVsdGlsaW5rQW55IiwiYXJncyIsInJlZHVjZSIsInN1bSIsIm5ld1ZhbHVlIiwibG9va3NPdmVyUHJvcGVydGllcyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQnV0dG9uTW9kZWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQmFzZSBjbGFzcyBmb3IgYnV0dG9uIG1vZGVscywgd2hpY2ggZGVzY3JpYmUgdGhlIGJlaGF2aW9yIG9mIGJ1dHRvbnMgd2hlbiB1c2VycyBpbnRlcmFjdCB3aXRoIHRoZW0uICBQcm9wZXJ0eSB2YWx1ZXNcclxuICogYXJlIHNldCBieSBhbiBhc3NvY2lhdGVkIGxpc3RlbmVyLCBzZWUgUHJlc3NMaXN0ZW5lciBmb3IgZGV0YWlscy5cclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IEVtaXR0ZXIgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9FbWl0dGVyLmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCB7IFByZXNzTGlzdGVuZXIsIFByZXNzTGlzdGVuZXJPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFBoZXRpb09iamVjdCBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvUGhldGlvT2JqZWN0LmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IEVuYWJsZWRDb21wb25lbnQsIHsgRW5hYmxlZENvbXBvbmVudE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL0VuYWJsZWRDb21wb25lbnQuanMnO1xyXG5pbXBvcnQgc3VuIGZyb20gJy4uL3N1bi5qcyc7XHJcbmltcG9ydCBNdWx0aWxpbmssIHsgVW5rbm93bk11bHRpbGluayB9IGZyb20gJy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IHsgRW5hYmxlZFByb3BlcnR5T3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL2F4b24vanMvRW5hYmxlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFRFbWl0dGVyIGZyb20gJy4uLy4uLy4uL2F4b24vanMvVEVtaXR0ZXIuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gY2FsbGVkIG9uIHBvaW50ZXIgZG93blxyXG4gIHN0YXJ0Q2FsbGJhY2s/OiAoKSA9PiB2b2lkO1xyXG5cclxuICAvLyBjYWxsZWQgb24gcG9pbnRlciB1cCwgaW5kaWNhdGVzIHdoZXRoZXIgdGhlIHBvaW50ZXIgd2FzIHJlbGVhc2VkIG92ZXIgdGhlIGJ1dHRvblxyXG4gIGVuZENhbGxiYWNrPzogKCBvdmVyOiBib29sZWFuICkgPT4gdm9pZDtcclxuXHJcbiAgLy8gdG8gc3VwcG9ydCBwcm9wZXJseSBwYXNzaW5nIHRoaXMgdG8gY2hpbGRyZW4sIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvdGFuZGVtL2lzc3Vlcy82MFxyXG4gIHBoZXRpb1N0YXRlPzogYm9vbGVhbjtcclxuXHJcbiAgLy8gdG8gc3VwcG9ydCBwcm9wZXJseSBwYXNzaW5nIHRoaXMgdG8gY2hpbGRyZW4sIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvdGFuZGVtL2lzc3Vlcy82MFxyXG4gIHBoZXRpb1JlYWRPbmx5PzogYm9vbGVhbjtcclxuXHJcbiAgLy8gdG8gc3VwcG9ydCBwcm9wZXJseSBwYXNzaW5nIHRoaXMgdG8gY2hpbGRyZW4sIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvdGFuZGVtL2lzc3Vlcy82MFxyXG4gIHBoZXRpb0ZlYXR1cmVkPzogYm9vbGVhbjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEJ1dHRvbk1vZGVsT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgRW5hYmxlZENvbXBvbmVudE9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCdXR0b25Nb2RlbCBleHRlbmRzIEVuYWJsZWRDb21wb25lbnQge1xyXG5cclxuICAvLyBJcyB0aGUgcG9pbnRlciBvdmVyIHRoZSBidXR0b24/IFZhbHVlIGlzIHJlYWQtb25seS5cclxuICBwdWJsaWMgcmVhZG9ubHkgb3ZlclByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gSXMgdGhlIHBvaW50ZXIgZG93bj9cclxuICBwdWJsaWMgcmVhZG9ubHkgZG93blByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gSXMgdGhlIGJ1dHRvbiBmb2N1c2VkIGZyb20gdGhlIFBET00/XHJcbiAgcHVibGljIHJlYWRvbmx5IGZvY3VzZWRQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIFRoaXMgUHJvcGVydHkgd2FzIGFkZGVkIGZvciBhMTF5LiBJdCB0cmFja3Mgd2hldGhlciBvciBub3QgdGhlIGJ1dHRvbiBzaG91bGQgXCJsb29rXCIgZG93bi4gVGhpc1xyXG4gIC8vIHdpbGwgYmUgdHJ1ZSBpZiBkb3duUHJvcGVydHkgaXMgdHJ1ZSBvciBpZiBhbiBhMTF5IGNsaWNrIGlzIGluIHByb2dyZXNzLiBGb3IgYW4gYTExeSBjbGljaywgdGhlIGxpc3RlbmVyc1xyXG4gIC8vIGFyZSBmaXJlZCByaWdodCBhd2F5IGJ1dCB0aGUgYnV0dG9uIHdpbGwgbG9vayBkb3duIGZvciBhcyBsb25nIGFzIFByZXNzTGlzdGVuZXIuYTExeUxvb2tzUHJlc3NlZEludGVydmFsLlxyXG4gIC8vIFNlZSBQcmVzc0xpc3RlbmVyLmNsaWNrIGZvciBtb3JlIGRldGFpbHMuXHJcbiAgcHVibGljIHJlYWRvbmx5IGxvb2tzUHJlc3NlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gVGhpcyBQcm9wZXJ0eSB3YXMgYWRkZWQgZm9yIGExMXkuIEl0IHRyYWNrcyB3aGV0aGVyIG9yIG5vdCB0aGUgYnV0dG9uIHNob3VsZCBcImxvb2tcIiBvdmVyLiBUaGlzXHJcbiAgLy8gd2lsbCBiZSB0cnVlIGlmIGFuZCBQcmVzc0xpc3RlbmVycycgbG9va3NPdmVyUHJvcGVydHkgaXMgdHJ1ZSwgc2VlIFByZXNzTGlzdGVuZXIgZm9yIHRoYXQgZGVmaW5pdGlvbi5cclxuICBwdWJsaWMgcmVhZG9ubHkgbG9va3NPdmVyUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyAocmVhZC1vbmx5IGJ5IHVzZXJzLCByZWFkLXdyaXRlIGluIHN1YmNsYXNzZXMpIC0gZW1pdHRlciB0aGF0IGlzIGZpcmVkIHdoZW4gc291bmQgc2hvdWxkIGJlIHByb2R1Y2VkXHJcbiAgcHVibGljIHJlYWRvbmx5IHByb2R1Y2VTb3VuZEVtaXR0ZXI6IFRFbWl0dGVyO1xyXG5cclxuICAvLyBpbmRpY2F0ZXMgdGhhdCBpbnRlcmFjdGlvbiB3YXMgaW50ZXJydXB0ZWQgZHVyaW5nIGEgcHJlc3MuIFZhbGlkIHVudGlsIG5leHQgcHJlc3MuXHJcbiAgcHVibGljIGludGVycnVwdGVkOiBib29sZWFuO1xyXG5cclxuICAvLyBrZWVwIHRyYWNrIG9mIGFuZCBzdG9yZSBhbGwgbGlzdGVuZXJzIHRoaXMgbW9kZWwgY3JlYXRlc1xyXG4gIHByaXZhdGUgbGlzdGVuZXJzOiBQcmVzc0xpc3RlbmVyW107XHJcblxyXG4gIC8vIExpbmtzIGFsbCBvZiB0aGUgbG9va3NQcmVzc2VkUHJvcGVydGllcyBmcm9tIHRoZSBsaXN0ZW5lcnMgdGhhdCB3ZXJlIGNyZWF0ZWRcclxuICAvLyBieSB0aGlzIEJ1dHRvbk1vZGVsLCBhbmQgdXBkYXRlcyB0aGUgbG9va3NQcmVzc2VkUHJvcGVydHkgYWNjb3JkaW5nbHkuIEZpcnN0IE11bHRpbGluayBpcyBhZGRlZCB3aGVuIHRoZVxyXG4gIC8vIGZpcnN0IGxpc3RlbmVyIGlzIGNyZWF0ZWQuIFNlZSB0aGlzLmNyZWF0ZVByZXNzTGlzdGVuZXIuXHJcbiAgcHJpdmF0ZSBsb29rc1ByZXNzZWRNdWx0aWxpbms6IFVua25vd25NdWx0aWxpbmsgfCBudWxsO1xyXG5cclxuICAvLyBMaW5rcyBhbGwgb2YgdGhlIGxvb2tzT3ZlclByb3BlcnRpZXMgZnJvbSB0aGUgbGlzdGVuZXJzIHRoYXQgd2VyZSBjcmVhdGVkXHJcbiAgLy8gYnkgdGhpcyBCdXR0b25Nb2RlbCwgYW5kIHVwZGF0ZXMgdGhlIGxvb2tzT3ZlclByb3BlcnR5IGFjY29yZGluZ2x5LiBGaXJzdCBNdWx0aWxpbmsgaXMgYWRkZWQgd2hlbiB0aGVcclxuICAvLyBmaXJzdCBsaXN0ZW5lciBpcyBjcmVhdGVkLiBTZWUgdGhpcy5jcmVhdGVQcmVzc0xpc3RlbmVyLlxyXG4gIHByaXZhdGUgbG9va3NPdmVyTXVsdGlsaW5rOiBVbmtub3duTXVsdGlsaW5rIHwgbnVsbDtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlQnV0dG9uTW9kZWw6ICgpID0+IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcHJvdmlkZWRPcHRpb25zPzogQnV0dG9uTW9kZWxPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8QnV0dG9uTW9kZWxPcHRpb25zLCBTZWxmT3B0aW9ucywgRW5hYmxlZENvbXBvbmVudE9wdGlvbnM+KCkoIHtcclxuICAgICAgc3RhcnRDYWxsYmFjazogXy5ub29wLFxyXG4gICAgICBlbmRDYWxsYmFjazogXy5ub29wLFxyXG5cclxuICAgICAgLy8gcGhldC1pb1xyXG4gICAgICB0YW5kZW06IFRhbmRlbS5SRVFVSVJFRCxcclxuICAgICAgcGhldGlvU3RhdGU6IFBoZXRpb09iamVjdC5ERUZBVUxUX09QVElPTlMucGhldGlvU3RhdGUsXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiBQaGV0aW9PYmplY3QuREVGQVVMVF9PUFRJT05TLnBoZXRpb1JlYWRPbmx5LFxyXG4gICAgICBwaGV0aW9GZWF0dXJlZDogUGhldGlvT2JqZWN0LkRFRkFVTFRfT1BUSU9OUy5waGV0aW9GZWF0dXJlZFxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gU2V0IHVwIGVuYWJsZWRQcm9wZXJ0eU9wdGlvbnMgZm9yIHRoZSBlbmFibGVkUHJvcGVydHkgdGhhdCB0aGUgbWl4aW4gbWlnaHQgY3JlYXRlXHJcbiAgICBvcHRpb25zLmVuYWJsZWRQcm9wZXJ0eU9wdGlvbnMgPSBjb21iaW5lT3B0aW9uczxFbmFibGVkUHJvcGVydHlPcHRpb25zPigge1xyXG5cclxuICAgICAgLy8gcGhldC1pb1xyXG4gICAgICBwaGV0aW9TdGF0ZTogb3B0aW9ucy5waGV0aW9TdGF0ZSxcclxuICAgICAgcGhldGlvUmVhZE9ubHk6IG9wdGlvbnMucGhldGlvUmVhZE9ubHksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdXaGVuIGRpc2FibGVkLCB0aGUgYnV0dG9uIGlzIGdyYXllZCBvdXQgYW5kIGNhbm5vdCBiZSBwcmVzc2VkJyxcclxuICAgICAgcGhldGlvRmVhdHVyZWQ6IHRydWVcclxuICAgIH0sIG9wdGlvbnMuZW5hYmxlZFByb3BlcnR5T3B0aW9ucyEgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIG1vZGVsIFByb3BlcnRpZXNcclxuICAgIHRoaXMub3ZlclByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuICAgIHRoaXMuZG93blByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UsIHsgcmVlbnRyYW50OiB0cnVlIH0gKTtcclxuICAgIHRoaXMuZm9jdXNlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuICAgIHRoaXMubG9va3NQcmVzc2VkUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG4gICAgdGhpcy5sb29rc092ZXJQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlICk7XHJcblxyXG4gICAgdGhpcy5wcm9kdWNlU291bmRFbWl0dGVyID0gbmV3IEVtaXR0ZXIoKTtcclxuICAgIHRoaXMuaW50ZXJydXB0ZWQgPSBmYWxzZTtcclxuICAgIHRoaXMubGlzdGVuZXJzID0gW107XHJcblxyXG4gICAgLy8gTGlua3MgYWxsIG9mIHRoZSBsb29rc1ByZXNzZWRQcm9wZXJ0aWVzIGZyb20gdGhlIGxpc3RlbmVycyB0aGF0IHdlcmUgY3JlYXRlZFxyXG4gICAgLy8gYnkgdGhpcyBCdXR0b25Nb2RlbCwgYW5kIHVwZGF0ZXMgdGhlIGxvb2tzUHJlc3NlZFByb3BlcnR5IGFjY29yZGluZ2x5LiBGaXJzdCBNdWx0aWxpbmsgaXMgYWRkZWQgd2hlbiB0aGVcclxuICAgIC8vIGZpcnN0IGxpc3RlbmVyIGlzIGNyZWF0ZWQuIFNlZSB0aGlzLmNyZWF0ZVByZXNzTGlzdGVuZXIuXHJcbiAgICB0aGlzLmxvb2tzUHJlc3NlZE11bHRpbGluayA9IG51bGw7XHJcblxyXG4gICAgLy8gTGlua3MgYWxsIG9mIHRoZSBsb29rc092ZXJQcm9wZXJ0aWVzIGZyb20gdGhlIGxpc3RlbmVycyB0aGF0IHdlcmUgY3JlYXRlZFxyXG4gICAgLy8gYnkgdGhpcyBCdXR0b25Nb2RlbCwgYW5kIHVwZGF0ZXMgdGhlIGxvb2tzT3ZlclByb3BlcnR5IGFjY29yZGluZ2x5LiBGaXJzdCBNdWx0aWxpbmsgaXMgYWRkZWQgd2hlbiB0aGVcclxuICAgIC8vIGZpcnN0IGxpc3RlbmVyIGlzIGNyZWF0ZWQuIFNlZSB0aGlzLmNyZWF0ZVByZXNzTGlzdGVuZXIuXHJcbiAgICB0aGlzLmxvb2tzT3Zlck11bHRpbGluayA9IG51bGw7XHJcblxyXG4gICAgLy8gQ2FsbCBzdGFydENhbGxiYWNrIG9uIHBvaW50ZXIgZG93biwgZW5kQ2FsbGJhY2sgb24gcG9pbnRlciB1cC4gVXNlIGxhenlMaW5rIHNvIHRoZXkgYXJlbid0IGNhbGxlZCBpbW1lZGlhdGVseS5cclxuICAgIC8vIE5vIHVubGluayBuZWVkZWQgc2luY2UgdGhpcyBidXR0b24gbW9kZWwgb3ducyB0aGUgUHJvcGVydHkuXHJcbiAgICB0aGlzLmRvd25Qcm9wZXJ0eS5sYXp5TGluayggZG93biA9PiB7XHJcbiAgICAgIGlmICggZG93biApIHtcclxuICAgICAgICBvcHRpb25zLnN0YXJ0Q2FsbGJhY2soKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBvcHRpb25zLmVuZENhbGxiYWNrKCB0aGlzLmxvb2tzT3ZlclByb3BlcnR5LmdldCgpICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBJbnRlcnJ1cHQgaW5wdXQgbGlzdGVuZXJzIHdoZW4gZW5hYmxlZCBpcyBzZXQgdG8gZmFsc2UuIFRoaXMgaXMgdGhlIGVxdWl2YWxlbnQgb2YgTm9kZS5pbnRlcnJ1cHRTdWJ0cmVlSW5wdXQsXHJcbiAgICAvLyBidXQgQnV0dG9uTW9kZWwgaXMgbm90IGEgTm9kZSwgc28gd2UgaGF2ZSB0byBpbnRlcnJ1cHQgZWFjaCBsaXN0ZW5lci4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzY0Mi5cclxuICAgIHRoaXMuZW5hYmxlZFByb3BlcnR5LmxpbmsoIGVuYWJsZWQgPT4ge1xyXG4gICAgICBpZiAoICFlbmFibGVkICkge1xyXG4gICAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMubGlzdGVuZXJzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgICAgY29uc3QgbGlzdGVuZXIgPSB0aGlzLmxpc3RlbmVyc1sgaSBdO1xyXG4gICAgICAgICAgbGlzdGVuZXIuaW50ZXJydXB0ICYmIGxpc3RlbmVyLmludGVycnVwdCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZUJ1dHRvbk1vZGVsID0gKCkgPT4ge1xyXG5cclxuICAgICAgLy8gVGhpcyB3aWxsIHVubGluayBhbGwgbGlzdGVuZXJzLCBjYXVzaW5nIHBvdGVudGlhbCBpc3N1ZXMgaWYgbGlzdGVuZXJzIHRyeSB0byB1bmxpbmsgUHJvcGVydGllcyBhZnRlcndhcmRzXHJcbiAgICAgIHRoaXMub3ZlclByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgICAgdGhpcy5kb3duUHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgICB0aGlzLnByb2R1Y2VTb3VuZEVtaXR0ZXIuZGlzcG9zZSgpO1xyXG5cclxuICAgICAgdGhpcy5sb29rc1ByZXNzZWRNdWx0aWxpbmsgJiYgdGhpcy5sb29rc1ByZXNzZWRNdWx0aWxpbmsuZGlzcG9zZSgpO1xyXG4gICAgICB0aGlzLmxvb2tzT3Zlck11bHRpbGluayAmJiB0aGlzLmxvb2tzT3Zlck11bHRpbGluay5kaXNwb3NlKCk7XHJcblxyXG4gICAgICB0aGlzLmxpc3RlbmVycyA9IFtdO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNwb3NlQnV0dG9uTW9kZWwoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBQcmVzc0xpc3RlbmVyIHRoYXQgd2lsbCBoYW5kbGUgY2hhbmdlcyB0byBCdXR0b25Nb2RlbCB3aGVuIHRoZSBhc3NvY2lhdGVkIGJ1dHRvbiBOb2RlIGlzIHByZXNzZWQuXHJcbiAgICogVGhlIGNsaWVudCBpcyByZXNwb25zaWJsZSBmb3IgYWRkaW5nIHRoaXMgUHJlc3NMaXN0ZW5lciB0byB0aGUgYXNzb2NpYXRlZCBidXR0b24gTm9kZS5cclxuICAgKi9cclxuICBwdWJsaWMgY3JlYXRlUHJlc3NMaXN0ZW5lciggb3B0aW9ucz86IFByZXNzTGlzdGVuZXJPcHRpb25zICk6IFByZXNzTGlzdGVuZXIge1xyXG5cclxuICAgIG9wdGlvbnMgPSBjb21iaW5lT3B0aW9uczxQcmVzc0xpc3RlbmVyT3B0aW9ucz4oIHtcclxuICAgICAgY2FuU3RhcnRQcmVzczogKCkgPT4gdGhpcy5lbmFibGVkUHJvcGVydHkudmFsdWVcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCBwcmVzc0xpc3RlbmVyID0gbmV3IFByZXNzTGlzdGVuZXIoIG9wdGlvbnMgKTtcclxuICAgIHRoaXMubGlzdGVuZXJzLnB1c2goIHByZXNzTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBMaW5rIGxhemlseSBpbiBjYXNlIGNsaWVudCBleHRlcm5hbGx5IHNldHMgZG93blByb3BlcnR5IC0gZG9uJ3QgdXBkYXRlIHVudGlsIHRoZSBuZXh0IHByZXNzLiAgTm8gdW5saW5rIG5lZWRlZFxyXG4gICAgLy8gYmVjYXVzZSB0aGUgcHJlc3NMaXN0ZW5lciBpcyBsb2NhbC5cclxuICAgIHByZXNzTGlzdGVuZXIuaXNQcmVzc2VkUHJvcGVydHkubGF6eUxpbmsoIGlzUHJlc3NlZCA9PiB7XHJcblxyXG4gICAgICAvLyBkZXRlcm1pbmUgaW50ZXJydXB0ZWQgZmlyc3Qgc28gbGlzdGVuZXJzIG9uIGRvd25Qcm9wZXJ0eSBoYXZlIGFjY2Vzc1xyXG4gICAgICB0aGlzLmludGVycnVwdGVkID0gcHJlc3NMaXN0ZW5lci5pbnRlcnJ1cHRlZDtcclxuICAgICAgdGhpcy5kb3duUHJvcGVydHkuc2V0KCBpc1ByZXNzZWQgKTtcclxuICAgIH0gKTtcclxuICAgIHByZXNzTGlzdGVuZXIuaXNPdmVyUHJvcGVydHkubGF6eUxpbmsoIHRoaXMub3ZlclByb3BlcnR5LnNldC5iaW5kKCB0aGlzLm92ZXJQcm9wZXJ0eSApICk7XHJcbiAgICBwcmVzc0xpc3RlbmVyLmlzRm9jdXNlZFByb3BlcnR5LmxhenlMaW5rKCB0aGlzLmZvY3VzZWRQcm9wZXJ0eS5zZXQuYmluZCggdGhpcy5mb2N1c2VkUHJvcGVydHkgKSApO1xyXG5cclxuICAgIC8vIGRpc3Bvc2UgdGhlIHByZXZpb3VzIG11bHRpbGluayBpbiBjYXNlIHdlIGFscmVhZHkgY3JlYXRlZCBhIFByZXNzTGlzdGVuZXIgd2l0aCB0aGlzIG1vZGVsXHJcbiAgICB0aGlzLmxvb2tzUHJlc3NlZE11bHRpbGluayAmJiB0aGlzLmxvb2tzUHJlc3NlZE11bHRpbGluay5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLmxvb2tzT3Zlck11bHRpbGluayAmJiB0aGlzLmxvb2tzT3Zlck11bHRpbGluay5kaXNwb3NlKCk7XHJcblxyXG4gICAgLy8gdGhlIGRvd25Qcm9wZXJ0eSBpcyBpbmNsdWRlZCBiZWNhdXNlIGl0IGNhbiBiZSBzZXQgZXh0ZXJuYWxseSwgbG9va3NQcmVzc2VkUHJvcGVydHkgc2hvdWxkIHVwZGF0ZSBpbiB0aGlzIGNhc2VcclxuICAgIGNvbnN0IGxvb2tzUHJlc3NlZFByb3BlcnRpZXMgPSB0aGlzLmxpc3RlbmVycy5tYXAoIGxpc3RlbmVyID0+IGxpc3RlbmVyLmxvb2tzUHJlc3NlZFByb3BlcnR5ICk7XHJcbiAgICBsb29rc1ByZXNzZWRQcm9wZXJ0aWVzLnB1c2goIHRoaXMuZG93blByb3BlcnR5ICk7XHJcblxyXG4gICAgLy8gYXNzaWduIGEgbmV3IE11bHRpbGluayAoZm9yIGRpc3Bvc2FsKSwgYW5kIG1ha2Ugc3VyZSB0aGF0IHRoZSBidXR0b24gbG9va3MgcHJlc3NlZCB3aGVuIGFueSBvZiB0aGVcclxuICAgIC8vIFByZXNzTGlzdGVuZXJzIGNyZWF0ZWQgYnkgdGhpcyBCdXR0b25Nb2RlbCBsb29rIHByZXNzZWQuXHJcbiAgICB0aGlzLmxvb2tzUHJlc3NlZE11bHRpbGluayA9IE11bHRpbGluay5tdWx0aWxpbmtBbnkoIGxvb2tzUHJlc3NlZFByb3BlcnRpZXMsICggLi4uYXJnczogYm9vbGVhbltdICkgPT4ge1xyXG4gICAgICB0aGlzLmxvb2tzUHJlc3NlZFByb3BlcnR5LnZhbHVlID0gXy5yZWR1Y2UoIGFyZ3MsICggc3VtOiBib29sZWFuLCBuZXdWYWx1ZTogYm9vbGVhbiApID0+IHN1bSB8fCBuZXdWYWx1ZSwgZmFsc2UgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBsb29rc092ZXJQcm9wZXJ0aWVzID0gdGhpcy5saXN0ZW5lcnMubWFwKCBsaXN0ZW5lciA9PiBsaXN0ZW5lci5sb29rc092ZXJQcm9wZXJ0eSApO1xyXG5cclxuICAgIC8vIGFzc2lnbiBhIG5ldyBNdWx0aWxpbmsgKGZvciBkaXNwb3NhbCksIGFuZCBtYWtlIHN1cmUgdGhhdCB0aGUgYnV0dG9uIGxvb2tzIG92ZXIgd2hlbiBhbnkgb2YgdGhlXHJcbiAgICAvLyBQcmVzc0xpc3RlbmVycyBjcmVhdGVkIGJ5IHRoaXMgQnV0dG9uTW9kZWwgbG9vayBvdmVyLiBOb3RlIHRoYXQgdGhpcyBjYW5ub3QgYmUgYW4gYXJyb3cgZnVuY3Rpb25cclxuICAgIC8vIGJlY2F1c2UgaXRzIGltcGxlbWVudGF0aW9uIHJlbGllcyBvbiBhcmd1bWVudHMuXHJcbiAgICB0aGlzLmxvb2tzT3Zlck11bHRpbGluayA9IE11bHRpbGluay5tdWx0aWxpbmtBbnkoIGxvb2tzT3ZlclByb3BlcnRpZXMsICggLi4uYXJnczogYm9vbGVhbltdICkgPT4ge1xyXG4gICAgICB0aGlzLmxvb2tzT3ZlclByb3BlcnR5LnZhbHVlID0gXy5yZWR1Y2UoIGFyZ3MsICggc3VtOiBib29sZWFuLCBuZXdWYWx1ZTogYm9vbGVhbiApID0+IHN1bSB8fCBuZXdWYWx1ZSwgZmFsc2UgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICByZXR1cm4gcHJlc3NMaXN0ZW5lcjtcclxuICB9XHJcbn1cclxuXHJcbnN1bi5yZWdpc3RlciggJ0J1dHRvbk1vZGVsJywgQnV0dG9uTW9kZWwgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0scUNBQXFDO0FBQ2pFLE9BQU9DLE9BQU8sTUFBTSw2QkFBNkI7QUFFakQsT0FBT0MsU0FBUyxJQUFJ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