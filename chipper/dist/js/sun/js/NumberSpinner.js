// Copyright 2016-2023, University of Colorado Boulder

/**
 * Spinner for numbers.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Andrea Lin (PhET Interactive Simulations)
 */

import InstanceRegistry from '../../phet-core/js/documentation/InstanceRegistry.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import NumberDisplay from '../../scenery-phet/js/NumberDisplay.js';
import { Node, SceneryConstants } from '../../scenery/js/imports.js';
import Tandem from '../../tandem/js/Tandem.js';
import AccessibleNumberSpinner from './accessibility/AccessibleNumberSpinner.js';
import ArrowButton from './buttons/ArrowButton.js';
import sun from './sun.js';
import pushButtonSoundPlayer from '../../tambo/js/shared-sound-players/pushButtonSoundPlayer.js';

// both arrow buttons below the value

export default class NumberSpinner extends AccessibleNumberSpinner(Node, 0) {
  /**
   * @param numberProperty - value, must be an integer
   * @param rangeProperty - dynamic range of values, min and max must be integers
   * @param [providedOptions]
   */
  constructor(numberProperty, rangeProperty, providedOptions) {
    assert && assert(rangeProperty.value.contains(numberProperty.get()), `value ${numberProperty.get()} is out of range ${rangeProperty.value.toString()}`);
    const options = optionize()({
      // SelfOptions
      arrowsSoundPlayer: pushButtonSoundPlayer,
      arrowsPosition: 'bothRight',
      arrowsScale: null,
      arrowButtonFill: 'white',
      arrowButtonStroke: 'black',
      arrowButtonLineWidth: 1,
      deltaValue: 1,
      xSpacing: 5,
      ySpacing: 3,
      numberDisplayOptions: {
        cornerRadius: 5,
        backgroundStroke: 'black'
      },
      touchAreaXDilation: 0,
      touchAreaYDilation: 0,
      mouseAreaXDilation: 0,
      mouseAreaYDilation: 0,
      // AccessibleNumberSpinnerOptions
      valueProperty: numberProperty,
      enabledRangeProperty: rangeProperty,
      disabledOpacity: SceneryConstants.DISABLED_OPACITY,
      // The focus highlight surrounds the entire component, but the spinner display is not interactive with
      // mouse and touch events so this highlight is hidden. Instead, default highlights surround the arrow buttons.
      interactiveHighlight: 'invisible',
      // PhET-iO
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'Spinner',
      phetioEnabledPropertyInstrumented: true // opt into default PhET-iO instrumented enabledProperty
    }, providedOptions);

    // Defaults for incrementFunction and decrementFunction
    const incrementFunction = options.incrementFunction || (value => value + options.deltaValue);
    const decrementFunction = options.decrementFunction || (value => value - options.deltaValue);
    const numberDisplay = new NumberDisplay(numberProperty, rangeProperty.value, combineOptions({
      tandem: options.tandem.createTandem('numberDisplay')
    }, options.numberDisplayOptions));

    // buttons
    const arrowButtonOptions = {
      baseColor: options.arrowButtonFill,
      stroke: options.arrowButtonStroke,
      lineWidth: options.arrowButtonLineWidth,
      focusable: false,
      soundPlayer: options.arrowsSoundPlayer,
      // as requested in https://github.com/phetsims/sun/issues/575
      enabledPropertyOptions: {
        phetioReadOnly: true,
        phetioFeatured: false
      }
    };

    // increment button
    const incrementButton = new ArrowButton(options.arrowsPosition === 'topBottom' || options.arrowsPosition === 'bothRight' ? 'up' : 'right', () => numberProperty.set(incrementFunction(numberProperty.get())), combineOptions({
      tandem: options.tandem.createTandem('incrementButton')
    }, arrowButtonOptions));

    // decrement button
    const decrementButton = new ArrowButton(options.arrowsPosition === 'topBottom' || options.arrowsPosition === 'bothRight' ? 'down' : 'left', () => numberProperty.set(decrementFunction(numberProperty.get())), combineOptions({
      tandem: options.tandem.createTandem('decrementButton')
    }, arrowButtonOptions));

    // arrow button scaling
    let arrowsScale;
    if (!arrowsScale) {
      if (options.arrowsPosition === 'leftRight') {
        arrowsScale = numberDisplay.height / incrementButton.height;
      } else if (options.arrowsPosition === 'topBottom') {
        arrowsScale = numberDisplay.width / incrementButton.width;
      } else if (options.arrowsPosition === 'bothRight') {
        arrowsScale = (numberDisplay.height / 2 - options.ySpacing / 2) / incrementButton.height;
      } else {
        // 'bothBottom'
        arrowsScale = (numberDisplay.width / 2 - options.xSpacing / 2) / incrementButton.width;
      }
    }
    if (options.arrowsScale) {
      arrowsScale = arrowsScale * options.arrowsScale;
    }
    incrementButton.setScaleMagnitude(arrowsScale);
    decrementButton.setScaleMagnitude(arrowsScale);

    // Because range may change via rangeProperty, the size of numberDisplay may change, in which case layout will need
    // to be revised. See https://github.com/phetsims/sun/issues/709
    const updateLayout = () => {
      if (options.arrowsPosition === 'leftRight') {
        incrementButton.left = numberDisplay.right + options.xSpacing;
        decrementButton.right = numberDisplay.left - options.xSpacing;
        incrementButton.centerY = decrementButton.centerY = numberDisplay.centerY;
      } else if (options.arrowsPosition === 'topBottom') {
        incrementButton.centerX = decrementButton.centerX = numberDisplay.centerX;
        incrementButton.bottom = numberDisplay.top - options.ySpacing;
        decrementButton.top = numberDisplay.bottom + options.ySpacing;
      } else if (options.arrowsPosition === 'bothRight') {
        incrementButton.left = decrementButton.left = numberDisplay.right + options.xSpacing;
        incrementButton.bottom = numberDisplay.centerY - options.ySpacing / 2;
        decrementButton.top = numberDisplay.centerY + options.ySpacing / 2;
      } else {
        // 'bothBottom'
        incrementButton.left = numberDisplay.centerX + options.xSpacing / 2;
        decrementButton.right = numberDisplay.centerX - options.xSpacing / 2;
        incrementButton.top = decrementButton.top = numberDisplay.bottom + options.ySpacing;
      }
    };
    numberDisplay.boundsProperty.link(() => updateLayout());

    // touch areas
    if (options.touchAreaXDilation || options.touchAreaYDilation) {
      incrementButton.touchArea = incrementButton.localBounds.dilatedXY(options.touchAreaXDilation, options.touchAreaYDilation);
      decrementButton.touchArea = decrementButton.localBounds.dilatedXY(options.touchAreaXDilation, options.touchAreaYDilation);

      // shift touch areas for these options, to prevent overlap
      if (options.arrowsPosition === 'bothRight') {
        incrementButton.touchArea = incrementButton.touchArea.shiftedY(-options.touchAreaYDilation);
        decrementButton.touchArea = decrementButton.touchArea.shiftedY(options.touchAreaYDilation);
      } else if (options.arrowsPosition === 'bothBottom') {
        incrementButton.touchArea = incrementButton.touchArea.shiftedX(options.touchAreaXDilation);
        decrementButton.touchArea = decrementButton.touchArea.shiftedX(-options.touchAreaXDilation);
      }
    }

    // mouse areas
    if (options.mouseAreaXDilation || options.mouseAreaYDilation) {
      incrementButton.mouseArea = incrementButton.localBounds.dilatedXY(options.mouseAreaXDilation, options.mouseAreaYDilation);
      decrementButton.mouseArea = decrementButton.localBounds.dilatedXY(options.mouseAreaXDilation, options.mouseAreaYDilation);

      // shift touch areas for these options, to prevent overlap
      if (options.arrowsPosition === 'bothRight') {
        incrementButton.mouseArea = incrementButton.mouseArea.shiftedY(-options.mouseAreaYDilation);
        decrementButton.mouseArea = decrementButton.mouseArea.shiftedY(options.mouseAreaYDilation);
      } else if (options.arrowsPosition === 'bothBottom') {
        incrementButton.mouseArea = incrementButton.mouseArea.shiftedX(options.mouseAreaXDilation);
        decrementButton.mouseArea = decrementButton.mouseArea.shiftedX(-options.mouseAreaXDilation);
      }
    }
    options.children = [numberDisplay, incrementButton, decrementButton];

    // pdom - NumberSpinner uses AccessibleValueHandler for accessibility, but it was decided that keyboardStep
    // and shiftKeyboardStep should have the same behavior as the NumberSpinner ArrowButtons AND the ArrowButtons
    // should look depressed when interacting with those keys. To accomplish this we actually press the ArrowButtons
    // in response to input with those keys. keyboardStep and shiftKeyboardStep are set to zero so the value isn't
    // modified again by AccessibleValueHandler.
    assert && assert(options.keyboardStep === undefined, 'NumberSpinner sets keyboardStep, it will be the same as deltaValue');
    assert && assert(options.shiftKeyboardStep === undefined, 'NumberSpinner sets shiftKeyboardStep, it will be the same as deltaValue');
    assert && assert(options.pageKeyboardStep === undefined, 'NumberSpinner sets pageKeyboardStep, it should not be used with NumberSpinner');
    options.keyboardStep = 0;
    options.shiftKeyboardStep = 0;
    options.pageKeyboardStep = 0;

    // Call super without the options that require valid bounds. Call mutate later with those options.
    const boundsRequiredOptionKeys = _.pick(options, Node.REQUIRES_BOUNDS_OPTION_KEYS);
    super(_.omit(options, Node.REQUIRES_BOUNDS_OPTION_KEYS));

    // enable/disable arrow buttons
    const updateEnabled = () => {
      incrementButton.enabled = incrementFunction(numberProperty.value) <= rangeProperty.value.max;
      decrementButton.enabled = decrementFunction(numberProperty.value) >= rangeProperty.value.min;
    };

    // synchronize with number value
    const numberPropertyObserver = value => {
      assert && assert(rangeProperty.value.contains(value), `value out of range: ${value}`);
      updateEnabled();
    };
    numberProperty.link(numberPropertyObserver); // must be unlinked in dispose

    // Dynamic range changes, see https://github.com/phetsims/scenery-phet/issues/305
    const rangeObserver = range => {
      // If our value is outside our new range, adjust it to be within the range.
      numberProperty.value = range.constrainValue(numberProperty.value);

      // Range changes may change whether the buttons are enabled
      updateEnabled();
    };
    rangeProperty.link(rangeObserver);

    // pdom - click arrow buttons on press of arrow keys so that the Property value changes by deltaValue
    // and the buttons look depressed
    const increasedListener = isDown => isDown && incrementButton.pdomClick();
    const decreasedListener = isDown => isDown && decrementButton.pdomClick();
    this.incrementDownEmitter.addListener(increasedListener);
    this.decrementDownEmitter.addListener(decreasedListener);
    this.disposeNumberSpinner = () => {
      // dispose of subcomponents
      numberDisplay.dispose();
      incrementButton.dispose();
      decrementButton.dispose();

      // dispose a11y features
      this.incrementDownEmitter.removeListener(increasedListener);
      this.decrementDownEmitter.removeListener(decreasedListener);
      numberProperty.unlink(numberPropertyObserver);
      rangeProperty.unlink(rangeObserver);
    };
    this.mutate(boundsRequiredOptionKeys);
    this.numberDisplay = numberDisplay;

    // Create a link to associated Property, so it's easier to find in Studio. Must be after instrumentation
    this.addLinkedElement(numberProperty, {
      tandem: options.tandem.createTandem('property')
    });

    // support for binder documentation, stripped out in builds and only runs when ?binder is specified
    assert && phet.chipper.queryParameters.binder && InstanceRegistry.registerDataURL('sun', 'NumberSpinner', this);
  }
  dispose() {
    this.disposeNumberSpinner();
    super.dispose();
  }

  /**
   * Sets the numberFormatter for the NumberDisplay.
   */
  setNumberFormatter(numberFormatter) {
    this.numberDisplay.setNumberFormatter(numberFormatter);
  }
}
sun.register('NumberSpinner', NumberSpinner);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJJbnN0YW5jZVJlZ2lzdHJ5Iiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJOdW1iZXJEaXNwbGF5IiwiTm9kZSIsIlNjZW5lcnlDb25zdGFudHMiLCJUYW5kZW0iLCJBY2Nlc3NpYmxlTnVtYmVyU3Bpbm5lciIsIkFycm93QnV0dG9uIiwic3VuIiwicHVzaEJ1dHRvblNvdW5kUGxheWVyIiwiTnVtYmVyU3Bpbm5lciIsImNvbnN0cnVjdG9yIiwibnVtYmVyUHJvcGVydHkiLCJyYW5nZVByb3BlcnR5IiwicHJvdmlkZWRPcHRpb25zIiwiYXNzZXJ0IiwidmFsdWUiLCJjb250YWlucyIsImdldCIsInRvU3RyaW5nIiwib3B0aW9ucyIsImFycm93c1NvdW5kUGxheWVyIiwiYXJyb3dzUG9zaXRpb24iLCJhcnJvd3NTY2FsZSIsImFycm93QnV0dG9uRmlsbCIsImFycm93QnV0dG9uU3Ryb2tlIiwiYXJyb3dCdXR0b25MaW5lV2lkdGgiLCJkZWx0YVZhbHVlIiwieFNwYWNpbmciLCJ5U3BhY2luZyIsIm51bWJlckRpc3BsYXlPcHRpb25zIiwiY29ybmVyUmFkaXVzIiwiYmFja2dyb3VuZFN0cm9rZSIsInRvdWNoQXJlYVhEaWxhdGlvbiIsInRvdWNoQXJlYVlEaWxhdGlvbiIsIm1vdXNlQXJlYVhEaWxhdGlvbiIsIm1vdXNlQXJlYVlEaWxhdGlvbiIsInZhbHVlUHJvcGVydHkiLCJlbmFibGVkUmFuZ2VQcm9wZXJ0eSIsImRpc2FibGVkT3BhY2l0eSIsIkRJU0FCTEVEX09QQUNJVFkiLCJpbnRlcmFjdGl2ZUhpZ2hsaWdodCIsInRhbmRlbSIsIlJFUVVJUkVEIiwidGFuZGVtTmFtZVN1ZmZpeCIsInBoZXRpb0VuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZCIsImluY3JlbWVudEZ1bmN0aW9uIiwiZGVjcmVtZW50RnVuY3Rpb24iLCJudW1iZXJEaXNwbGF5IiwiY3JlYXRlVGFuZGVtIiwiYXJyb3dCdXR0b25PcHRpb25zIiwiYmFzZUNvbG9yIiwic3Ryb2tlIiwibGluZVdpZHRoIiwiZm9jdXNhYmxlIiwic291bmRQbGF5ZXIiLCJlbmFibGVkUHJvcGVydHlPcHRpb25zIiwicGhldGlvUmVhZE9ubHkiLCJwaGV0aW9GZWF0dXJlZCIsImluY3JlbWVudEJ1dHRvbiIsInNldCIsImRlY3JlbWVudEJ1dHRvbiIsImhlaWdodCIsIndpZHRoIiwic2V0U2NhbGVNYWduaXR1ZGUiLCJ1cGRhdGVMYXlvdXQiLCJsZWZ0IiwicmlnaHQiLCJjZW50ZXJZIiwiY2VudGVyWCIsImJvdHRvbSIsInRvcCIsImJvdW5kc1Byb3BlcnR5IiwibGluayIsInRvdWNoQXJlYSIsImxvY2FsQm91bmRzIiwiZGlsYXRlZFhZIiwic2hpZnRlZFkiLCJzaGlmdGVkWCIsIm1vdXNlQXJlYSIsImNoaWxkcmVuIiwia2V5Ym9hcmRTdGVwIiwidW5kZWZpbmVkIiwic2hpZnRLZXlib2FyZFN0ZXAiLCJwYWdlS2V5Ym9hcmRTdGVwIiwiYm91bmRzUmVxdWlyZWRPcHRpb25LZXlzIiwiXyIsInBpY2siLCJSRVFVSVJFU19CT1VORFNfT1BUSU9OX0tFWVMiLCJvbWl0IiwidXBkYXRlRW5hYmxlZCIsImVuYWJsZWQiLCJtYXgiLCJtaW4iLCJudW1iZXJQcm9wZXJ0eU9ic2VydmVyIiwicmFuZ2VPYnNlcnZlciIsInJhbmdlIiwiY29uc3RyYWluVmFsdWUiLCJpbmNyZWFzZWRMaXN0ZW5lciIsImlzRG93biIsInBkb21DbGljayIsImRlY3JlYXNlZExpc3RlbmVyIiwiaW5jcmVtZW50RG93bkVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImRlY3JlbWVudERvd25FbWl0dGVyIiwiZGlzcG9zZU51bWJlclNwaW5uZXIiLCJkaXNwb3NlIiwicmVtb3ZlTGlzdGVuZXIiLCJ1bmxpbmsiLCJtdXRhdGUiLCJhZGRMaW5rZWRFbGVtZW50IiwicGhldCIsImNoaXBwZXIiLCJxdWVyeVBhcmFtZXRlcnMiLCJiaW5kZXIiLCJyZWdpc3RlckRhdGFVUkwiLCJzZXROdW1iZXJGb3JtYXR0ZXIiLCJudW1iZXJGb3JtYXR0ZXIiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIk51bWJlclNwaW5uZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU3Bpbm5lciBmb3IgbnVtYmVycy5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICogQGF1dGhvciBBbmRyZWEgTGluIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IFJhbmdlIGZyb20gJy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBJbnN0YW5jZVJlZ2lzdHJ5IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9kb2N1bWVudGF0aW9uL0luc3RhbmNlUmVnaXN0cnkuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBOdW1iZXJEaXNwbGF5LCB7IE51bWJlckRpc3BsYXlPcHRpb25zIH0gZnJvbSAnLi4vLi4vc2NlbmVyeS1waGV0L2pzL051bWJlckRpc3BsYXkuanMnO1xyXG5pbXBvcnQgeyBOb2RlLCBOb2RlT3B0aW9ucywgU2NlbmVyeUNvbnN0YW50cywgVENvbG9yIH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IEFjY2Vzc2libGVOdW1iZXJTcGlubmVyLCB7IEFjY2Vzc2libGVOdW1iZXJTcGlubmVyT3B0aW9ucyB9IGZyb20gJy4vYWNjZXNzaWJpbGl0eS9BY2Nlc3NpYmxlTnVtYmVyU3Bpbm5lci5qcyc7XHJcbmltcG9ydCBBcnJvd0J1dHRvbiwgeyBBcnJvd0J1dHRvbk9wdGlvbnMgfSBmcm9tICcuL2J1dHRvbnMvQXJyb3dCdXR0b24uanMnO1xyXG5cclxuaW1wb3J0IHN1biBmcm9tICcuL3N1bi5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgcHVzaEJ1dHRvblNvdW5kUGxheWVyIGZyb20gJy4uLy4uL3RhbWJvL2pzL3NoYXJlZC1zb3VuZC1wbGF5ZXJzL3B1c2hCdXR0b25Tb3VuZFBsYXllci5qcyc7XHJcbmltcG9ydCBUU291bmRQbGF5ZXIgZnJvbSAnLi4vLi4vdGFtYm8vanMvVFNvdW5kUGxheWVyLmpzJztcclxuXHJcbnR5cGUgTnVtYmVyU3Bpbm5lckFycm93c1Bvc2l0aW9uID1cclxuICAnbGVmdFJpZ2h0JyB8IC8vIGFycm93IGJ1dHRvbnMgb24gbGVmdCBhbmQgcmlnaHQgb2YgdmFsdWVcclxuICAndG9wQm90dG9tJyB8IC8vIGFycm93IGJ1dHRvbnMgb24gdG9wIGFuZCBib3R0b20gb2YgdmFsdWVcclxuICAnYm90aFJpZ2h0JyB8IC8vIGJvdGggYXJyb3cgYnV0dG9ucyB0byB0aGUgcmlnaHQgb2YgdGhlIHZhbHVlXHJcbiAgJ2JvdGhCb3R0b20nOyAvLyBib3RoIGFycm93IGJ1dHRvbnMgYmVsb3cgdGhlIHZhbHVlXHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyB3aGVyZSB0byBwbGFjZSB0aGUgYXJyb3cgYnV0dG9uc1xyXG4gIGFycm93c1Bvc2l0aW9uPzogTnVtYmVyU3Bpbm5lckFycm93c1Bvc2l0aW9uO1xyXG5cclxuICAvLyBCeSBkZWZhdWx0LCBhcnJvd3MgYXJlIHNjYWxlZCB0byBmaXQgZGltZW5zaW9ucyBvZiB2YWx1ZSBiYWNrZ3JvdW5kLiBUaGlzIGlzIGFuIGFkZGl0aW9uYWwgc2NhbGUgZmFjdG9yLlxyXG4gIGFycm93c1NjYWxlPzogbnVtYmVyIHwgbnVsbDtcclxuICBhcnJvd0J1dHRvbkZpbGw/OiBUQ29sb3I7XHJcbiAgYXJyb3dCdXR0b25TdHJva2U/OiBUQ29sb3I7XHJcbiAgYXJyb3dCdXR0b25MaW5lV2lkdGg/OiBudW1iZXI7XHJcblxyXG4gIGFycm93c1NvdW5kUGxheWVyPzogVFNvdW5kUGxheWVyO1xyXG5cclxuICAvLyBGdW5jdGlvbiBjYWxsZWQgd2hlbiB0aGUgaW5jcmVtZW50IGJ1dHRvbiBpcyBwcmVzc2VkLiBEZWZhdWx0cyB0byBhZGRpbmcgb3B0aW9ucy5kZWx0YVZhbHVlLlxyXG4gIGluY3JlbWVudEZ1bmN0aW9uPzogKCAoIHZhbHVlOiBudW1iZXIgKSA9PiBudW1iZXIgKTtcclxuXHJcbiAgLy8gRnVuY3Rpb24gY2FsbGVkIHdoZW4gdGhlIGRlY3JlbWVudCBidXR0b24gaXMgcHJlc3NlZC4gRGVmYXVsdHMgdG8gc3VidHJhY3Rpbmcgb3B0aW9ucy5kZWx0YVZhbHVlLlxyXG4gIGRlY3JlbWVudEZ1bmN0aW9uPzogKCAoIHZhbHVlOiBudW1iZXIgKSA9PiBudW1iZXIgKTtcclxuXHJcbiAgLy8gbWF5IGJlIGlnbm9yZWQgaWYgaW5jcmVtZW50RnVuY3Rpb24gYW5kIGRlY3JlbWVudEZ1bmN0aW9uIGFyZSBwcm92aWRlZFxyXG4gIGRlbHRhVmFsdWU/OiBudW1iZXI7XHJcblxyXG4gIHhTcGFjaW5nPzogbnVtYmVyO1xyXG4gIHlTcGFjaW5nPzogbnVtYmVyO1xyXG5cclxuICAvLyBOdW1iZXJEaXNwbGF5IG9wdGlvbnNcclxuICBudW1iZXJEaXNwbGF5T3B0aW9ucz86IFN0cmljdE9taXQ8TnVtYmVyRGlzcGxheU9wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbiAgLy8gYXJyb3cgYnV0dG9uIHBvaW50ZXIgYXJlYXNcclxuICB0b3VjaEFyZWFYRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgdG91Y2hBcmVhWURpbGF0aW9uPzogbnVtYmVyO1xyXG4gIG1vdXNlQXJlYVhEaWxhdGlvbj86IG51bWJlcjtcclxuICBtb3VzZUFyZWFZRGlsYXRpb24/OiBudW1iZXI7XHJcbn07XHJcbnR5cGUgUGFyZW50T3B0aW9ucyA9IEFjY2Vzc2libGVOdW1iZXJTcGlubmVyT3B0aW9ucyAmIE5vZGVPcHRpb25zO1xyXG5leHBvcnQgdHlwZSBOdW1iZXJTcGlubmVyT3B0aW9ucyA9IFNlbGZPcHRpb25zICZcclxuICBTdHJpY3RPbWl0PFBhcmVudE9wdGlvbnMsICdjaGlsZHJlbicgfCAndmFsdWVQcm9wZXJ0eScgfCAnZW5hYmxlZFJhbmdlUHJvcGVydHknPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE51bWJlclNwaW5uZXIgZXh0ZW5kcyBBY2Nlc3NpYmxlTnVtYmVyU3Bpbm5lciggTm9kZSwgMCApIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBudW1iZXJEaXNwbGF5OiBOdW1iZXJEaXNwbGF5O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZU51bWJlclNwaW5uZXI6ICgpID0+IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBudW1iZXJQcm9wZXJ0eSAtIHZhbHVlLCBtdXN0IGJlIGFuIGludGVnZXJcclxuICAgKiBAcGFyYW0gcmFuZ2VQcm9wZXJ0eSAtIGR5bmFtaWMgcmFuZ2Ugb2YgdmFsdWVzLCBtaW4gYW5kIG1heCBtdXN0IGJlIGludGVnZXJzXHJcbiAgICogQHBhcmFtIFtwcm92aWRlZE9wdGlvbnNdXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBudW1iZXJQcm9wZXJ0eTogUHJvcGVydHk8bnVtYmVyPiwgcmFuZ2VQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8UmFuZ2U+LCBwcm92aWRlZE9wdGlvbnM/OiBOdW1iZXJTcGlubmVyT3B0aW9ucyApIHtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCByYW5nZVByb3BlcnR5LnZhbHVlLmNvbnRhaW5zKCBudW1iZXJQcm9wZXJ0eS5nZXQoKSApLFxyXG4gICAgICBgdmFsdWUgJHtudW1iZXJQcm9wZXJ0eS5nZXQoKX0gaXMgb3V0IG9mIHJhbmdlICR7cmFuZ2VQcm9wZXJ0eS52YWx1ZS50b1N0cmluZygpfWAgKTtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPE51bWJlclNwaW5uZXJPcHRpb25zLFxyXG4gICAgICBTdHJpY3RPbWl0PFNlbGZPcHRpb25zLCAnaW5jcmVtZW50RnVuY3Rpb24nIHwgJ2RlY3JlbWVudEZ1bmN0aW9uJz4sXHJcbiAgICAgIFBhcmVudE9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNlbGZPcHRpb25zXHJcbiAgICAgIGFycm93c1NvdW5kUGxheWVyOiBwdXNoQnV0dG9uU291bmRQbGF5ZXIsXHJcbiAgICAgIGFycm93c1Bvc2l0aW9uOiAnYm90aFJpZ2h0JyxcclxuICAgICAgYXJyb3dzU2NhbGU6IG51bGwsXHJcbiAgICAgIGFycm93QnV0dG9uRmlsbDogJ3doaXRlJyxcclxuICAgICAgYXJyb3dCdXR0b25TdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGFycm93QnV0dG9uTGluZVdpZHRoOiAxLFxyXG4gICAgICBkZWx0YVZhbHVlOiAxLFxyXG4gICAgICB4U3BhY2luZzogNSxcclxuICAgICAgeVNwYWNpbmc6IDMsXHJcbiAgICAgIG51bWJlckRpc3BsYXlPcHRpb25zOiB7XHJcbiAgICAgICAgY29ybmVyUmFkaXVzOiA1LFxyXG4gICAgICAgIGJhY2tncm91bmRTdHJva2U6ICdibGFjaydcclxuICAgICAgfSxcclxuICAgICAgdG91Y2hBcmVhWERpbGF0aW9uOiAwLFxyXG4gICAgICB0b3VjaEFyZWFZRGlsYXRpb246IDAsXHJcbiAgICAgIG1vdXNlQXJlYVhEaWxhdGlvbjogMCxcclxuICAgICAgbW91c2VBcmVhWURpbGF0aW9uOiAwLFxyXG5cclxuICAgICAgLy8gQWNjZXNzaWJsZU51bWJlclNwaW5uZXJPcHRpb25zXHJcbiAgICAgIHZhbHVlUHJvcGVydHk6IG51bWJlclByb3BlcnR5LFxyXG4gICAgICBlbmFibGVkUmFuZ2VQcm9wZXJ0eTogcmFuZ2VQcm9wZXJ0eSxcclxuICAgICAgZGlzYWJsZWRPcGFjaXR5OiBTY2VuZXJ5Q29uc3RhbnRzLkRJU0FCTEVEX09QQUNJVFksXHJcblxyXG4gICAgICAvLyBUaGUgZm9jdXMgaGlnaGxpZ2h0IHN1cnJvdW5kcyB0aGUgZW50aXJlIGNvbXBvbmVudCwgYnV0IHRoZSBzcGlubmVyIGRpc3BsYXkgaXMgbm90IGludGVyYWN0aXZlIHdpdGhcclxuICAgICAgLy8gbW91c2UgYW5kIHRvdWNoIGV2ZW50cyBzbyB0aGlzIGhpZ2hsaWdodCBpcyBoaWRkZW4uIEluc3RlYWQsIGRlZmF1bHQgaGlnaGxpZ2h0cyBzdXJyb3VuZCB0aGUgYXJyb3cgYnV0dG9ucy5cclxuICAgICAgaW50ZXJhY3RpdmVIaWdobGlnaHQ6ICdpbnZpc2libGUnLFxyXG5cclxuICAgICAgLy8gUGhFVC1pT1xyXG4gICAgICB0YW5kZW06IFRhbmRlbS5SRVFVSVJFRCxcclxuICAgICAgdGFuZGVtTmFtZVN1ZmZpeDogJ1NwaW5uZXInLFxyXG4gICAgICBwaGV0aW9FbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQ6IHRydWUgLy8gb3B0IGludG8gZGVmYXVsdCBQaEVULWlPIGluc3RydW1lbnRlZCBlbmFibGVkUHJvcGVydHlcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIC8vIERlZmF1bHRzIGZvciBpbmNyZW1lbnRGdW5jdGlvbiBhbmQgZGVjcmVtZW50RnVuY3Rpb25cclxuICAgIGNvbnN0IGluY3JlbWVudEZ1bmN0aW9uID0gb3B0aW9ucy5pbmNyZW1lbnRGdW5jdGlvbiB8fCAoICggdmFsdWU6IG51bWJlciApID0+IHZhbHVlICsgb3B0aW9ucy5kZWx0YVZhbHVlICk7XHJcbiAgICBjb25zdCBkZWNyZW1lbnRGdW5jdGlvbiA9IG9wdGlvbnMuZGVjcmVtZW50RnVuY3Rpb24gfHwgKCAoIHZhbHVlOiBudW1iZXIgKSA9PiB2YWx1ZSAtIG9wdGlvbnMuZGVsdGFWYWx1ZSApO1xyXG5cclxuICAgIGNvbnN0IG51bWJlckRpc3BsYXkgPSBuZXcgTnVtYmVyRGlzcGxheSggbnVtYmVyUHJvcGVydHksIHJhbmdlUHJvcGVydHkudmFsdWUsXHJcbiAgICAgIGNvbWJpbmVPcHRpb25zPE51bWJlckRpc3BsYXlPcHRpb25zPigge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnbnVtYmVyRGlzcGxheScgKVxyXG4gICAgICB9LCBvcHRpb25zLm51bWJlckRpc3BsYXlPcHRpb25zICkgKTtcclxuXHJcbiAgICAvLyBidXR0b25zXHJcbiAgICBjb25zdCBhcnJvd0J1dHRvbk9wdGlvbnM6IEFycm93QnV0dG9uT3B0aW9ucyA9IHtcclxuICAgICAgYmFzZUNvbG9yOiBvcHRpb25zLmFycm93QnV0dG9uRmlsbCxcclxuICAgICAgc3Ryb2tlOiBvcHRpb25zLmFycm93QnV0dG9uU3Ryb2tlLFxyXG4gICAgICBsaW5lV2lkdGg6IG9wdGlvbnMuYXJyb3dCdXR0b25MaW5lV2lkdGgsXHJcbiAgICAgIGZvY3VzYWJsZTogZmFsc2UsXHJcbiAgICAgIHNvdW5kUGxheWVyOiBvcHRpb25zLmFycm93c1NvdW5kUGxheWVyLFxyXG5cclxuICAgICAgLy8gYXMgcmVxdWVzdGVkIGluIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzU3NVxyXG4gICAgICBlbmFibGVkUHJvcGVydHlPcHRpb25zOiB7XHJcbiAgICAgICAgcGhldGlvUmVhZE9ubHk6IHRydWUsXHJcbiAgICAgICAgcGhldGlvRmVhdHVyZWQ6IGZhbHNlXHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gaW5jcmVtZW50IGJ1dHRvblxyXG4gICAgY29uc3QgaW5jcmVtZW50QnV0dG9uID0gbmV3IEFycm93QnV0dG9uKFxyXG4gICAgICAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICd0b3BCb3R0b20nIHx8IG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdib3RoUmlnaHQnICkgPyAndXAnIDogJ3JpZ2h0JyxcclxuICAgICAgKCkgPT4gbnVtYmVyUHJvcGVydHkuc2V0KCBpbmNyZW1lbnRGdW5jdGlvbiggbnVtYmVyUHJvcGVydHkuZ2V0KCkgKSApLFxyXG4gICAgICBjb21iaW5lT3B0aW9uczxBcnJvd0J1dHRvbk9wdGlvbnM+KCB7XHJcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdpbmNyZW1lbnRCdXR0b24nIClcclxuICAgICAgfSwgYXJyb3dCdXR0b25PcHRpb25zIClcclxuICAgICk7XHJcblxyXG4gICAgLy8gZGVjcmVtZW50IGJ1dHRvblxyXG4gICAgY29uc3QgZGVjcmVtZW50QnV0dG9uID0gbmV3IEFycm93QnV0dG9uKFxyXG4gICAgICAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICd0b3BCb3R0b20nIHx8IG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdib3RoUmlnaHQnICkgPyAnZG93bicgOiAnbGVmdCcsXHJcbiAgICAgICgpID0+IG51bWJlclByb3BlcnR5LnNldCggZGVjcmVtZW50RnVuY3Rpb24oIG51bWJlclByb3BlcnR5LmdldCgpICkgKSxcclxuICAgICAgY29tYmluZU9wdGlvbnM8QXJyb3dCdXR0b25PcHRpb25zPigge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZGVjcmVtZW50QnV0dG9uJyApXHJcbiAgICAgIH0sIGFycm93QnV0dG9uT3B0aW9ucyApXHJcbiAgICApO1xyXG5cclxuICAgIC8vIGFycm93IGJ1dHRvbiBzY2FsaW5nXHJcbiAgICBsZXQgYXJyb3dzU2NhbGU7XHJcbiAgICBpZiAoICFhcnJvd3NTY2FsZSApIHtcclxuICAgICAgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAnbGVmdFJpZ2h0JyApIHtcclxuICAgICAgICBhcnJvd3NTY2FsZSA9IG51bWJlckRpc3BsYXkuaGVpZ2h0IC8gaW5jcmVtZW50QnV0dG9uLmhlaWdodDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggb3B0aW9ucy5hcnJvd3NQb3NpdGlvbiA9PT0gJ3RvcEJvdHRvbScgKSB7XHJcbiAgICAgICAgYXJyb3dzU2NhbGUgPSBudW1iZXJEaXNwbGF5LndpZHRoIC8gaW5jcmVtZW50QnV0dG9uLndpZHRoO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAnYm90aFJpZ2h0JyApIHtcclxuICAgICAgICBhcnJvd3NTY2FsZSA9ICggKCBudW1iZXJEaXNwbGF5LmhlaWdodCAvIDIgKSAtICggb3B0aW9ucy55U3BhY2luZyAvIDIgKSApIC8gaW5jcmVtZW50QnV0dG9uLmhlaWdodDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHsgLy8gJ2JvdGhCb3R0b20nXHJcbiAgICAgICAgYXJyb3dzU2NhbGUgPSAoICggbnVtYmVyRGlzcGxheS53aWR0aCAvIDIgKSAtICggb3B0aW9ucy54U3BhY2luZyAvIDIgKSApIC8gaW5jcmVtZW50QnV0dG9uLndpZHRoO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoIG9wdGlvbnMuYXJyb3dzU2NhbGUgKSB7XHJcbiAgICAgIGFycm93c1NjYWxlID0gYXJyb3dzU2NhbGUgKiBvcHRpb25zLmFycm93c1NjYWxlO1xyXG4gICAgfVxyXG4gICAgaW5jcmVtZW50QnV0dG9uLnNldFNjYWxlTWFnbml0dWRlKCBhcnJvd3NTY2FsZSApO1xyXG4gICAgZGVjcmVtZW50QnV0dG9uLnNldFNjYWxlTWFnbml0dWRlKCBhcnJvd3NTY2FsZSApO1xyXG5cclxuICAgIC8vIEJlY2F1c2UgcmFuZ2UgbWF5IGNoYW5nZSB2aWEgcmFuZ2VQcm9wZXJ0eSwgdGhlIHNpemUgb2YgbnVtYmVyRGlzcGxheSBtYXkgY2hhbmdlLCBpbiB3aGljaCBjYXNlIGxheW91dCB3aWxsIG5lZWRcclxuICAgIC8vIHRvIGJlIHJldmlzZWQuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc3VuL2lzc3Vlcy83MDlcclxuICAgIGNvbnN0IHVwZGF0ZUxheW91dCA9ICgpID0+IHtcclxuICAgICAgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAnbGVmdFJpZ2h0JyApIHtcclxuICAgICAgICBpbmNyZW1lbnRCdXR0b24ubGVmdCA9IG51bWJlckRpc3BsYXkucmlnaHQgKyBvcHRpb25zLnhTcGFjaW5nO1xyXG4gICAgICAgIGRlY3JlbWVudEJ1dHRvbi5yaWdodCA9IG51bWJlckRpc3BsYXkubGVmdCAtIG9wdGlvbnMueFNwYWNpbmc7XHJcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLmNlbnRlclkgPSBkZWNyZW1lbnRCdXR0b24uY2VudGVyWSA9IG51bWJlckRpc3BsYXkuY2VudGVyWTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggb3B0aW9ucy5hcnJvd3NQb3NpdGlvbiA9PT0gJ3RvcEJvdHRvbScgKSB7XHJcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLmNlbnRlclggPSBkZWNyZW1lbnRCdXR0b24uY2VudGVyWCA9IG51bWJlckRpc3BsYXkuY2VudGVyWDtcclxuICAgICAgICBpbmNyZW1lbnRCdXR0b24uYm90dG9tID0gbnVtYmVyRGlzcGxheS50b3AgLSBvcHRpb25zLnlTcGFjaW5nO1xyXG4gICAgICAgIGRlY3JlbWVudEJ1dHRvbi50b3AgPSBudW1iZXJEaXNwbGF5LmJvdHRvbSArIG9wdGlvbnMueVNwYWNpbmc7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdib3RoUmlnaHQnICkge1xyXG4gICAgICAgIGluY3JlbWVudEJ1dHRvbi5sZWZ0ID0gZGVjcmVtZW50QnV0dG9uLmxlZnQgPSBudW1iZXJEaXNwbGF5LnJpZ2h0ICsgb3B0aW9ucy54U3BhY2luZztcclxuICAgICAgICBpbmNyZW1lbnRCdXR0b24uYm90dG9tID0gbnVtYmVyRGlzcGxheS5jZW50ZXJZIC0gKCBvcHRpb25zLnlTcGFjaW5nIC8gMiApO1xyXG4gICAgICAgIGRlY3JlbWVudEJ1dHRvbi50b3AgPSBudW1iZXJEaXNwbGF5LmNlbnRlclkgKyAoIG9wdGlvbnMueVNwYWNpbmcgLyAyICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7IC8vICdib3RoQm90dG9tJ1xyXG4gICAgICAgIGluY3JlbWVudEJ1dHRvbi5sZWZ0ID0gbnVtYmVyRGlzcGxheS5jZW50ZXJYICsgKCBvcHRpb25zLnhTcGFjaW5nIC8gMiApO1xyXG4gICAgICAgIGRlY3JlbWVudEJ1dHRvbi5yaWdodCA9IG51bWJlckRpc3BsYXkuY2VudGVyWCAtICggb3B0aW9ucy54U3BhY2luZyAvIDIgKTtcclxuICAgICAgICBpbmNyZW1lbnRCdXR0b24udG9wID0gZGVjcmVtZW50QnV0dG9uLnRvcCA9IG51bWJlckRpc3BsYXkuYm90dG9tICsgb3B0aW9ucy55U3BhY2luZztcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIG51bWJlckRpc3BsYXkuYm91bmRzUHJvcGVydHkubGluayggKCkgPT4gdXBkYXRlTGF5b3V0KCkgKTtcclxuXHJcbiAgICAvLyB0b3VjaCBhcmVhc1xyXG4gICAgaWYgKCBvcHRpb25zLnRvdWNoQXJlYVhEaWxhdGlvbiB8fCBvcHRpb25zLnRvdWNoQXJlYVlEaWxhdGlvbiApIHtcclxuXHJcbiAgICAgIGluY3JlbWVudEJ1dHRvbi50b3VjaEFyZWEgPSBpbmNyZW1lbnRCdXR0b24ubG9jYWxCb3VuZHMuZGlsYXRlZFhZKCBvcHRpb25zLnRvdWNoQXJlYVhEaWxhdGlvbiwgb3B0aW9ucy50b3VjaEFyZWFZRGlsYXRpb24gKTtcclxuICAgICAgZGVjcmVtZW50QnV0dG9uLnRvdWNoQXJlYSA9IGRlY3JlbWVudEJ1dHRvbi5sb2NhbEJvdW5kcy5kaWxhdGVkWFkoIG9wdGlvbnMudG91Y2hBcmVhWERpbGF0aW9uLCBvcHRpb25zLnRvdWNoQXJlYVlEaWxhdGlvbiApO1xyXG5cclxuICAgICAgLy8gc2hpZnQgdG91Y2ggYXJlYXMgZm9yIHRoZXNlIG9wdGlvbnMsIHRvIHByZXZlbnQgb3ZlcmxhcFxyXG4gICAgICBpZiAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdib3RoUmlnaHQnICkge1xyXG4gICAgICAgIGluY3JlbWVudEJ1dHRvbi50b3VjaEFyZWEgPSBpbmNyZW1lbnRCdXR0b24udG91Y2hBcmVhLnNoaWZ0ZWRZKCAtb3B0aW9ucy50b3VjaEFyZWFZRGlsYXRpb24gKTtcclxuICAgICAgICBkZWNyZW1lbnRCdXR0b24udG91Y2hBcmVhID0gZGVjcmVtZW50QnV0dG9uLnRvdWNoQXJlYS5zaGlmdGVkWSggb3B0aW9ucy50b3VjaEFyZWFZRGlsYXRpb24gKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggb3B0aW9ucy5hcnJvd3NQb3NpdGlvbiA9PT0gJ2JvdGhCb3R0b20nICkge1xyXG4gICAgICAgIGluY3JlbWVudEJ1dHRvbi50b3VjaEFyZWEgPSBpbmNyZW1lbnRCdXR0b24udG91Y2hBcmVhLnNoaWZ0ZWRYKCBvcHRpb25zLnRvdWNoQXJlYVhEaWxhdGlvbiApO1xyXG4gICAgICAgIGRlY3JlbWVudEJ1dHRvbi50b3VjaEFyZWEgPSBkZWNyZW1lbnRCdXR0b24udG91Y2hBcmVhLnNoaWZ0ZWRYKCAtb3B0aW9ucy50b3VjaEFyZWFYRGlsYXRpb24gKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIG1vdXNlIGFyZWFzXHJcbiAgICBpZiAoIG9wdGlvbnMubW91c2VBcmVhWERpbGF0aW9uIHx8IG9wdGlvbnMubW91c2VBcmVhWURpbGF0aW9uICkge1xyXG5cclxuICAgICAgaW5jcmVtZW50QnV0dG9uLm1vdXNlQXJlYSA9IGluY3JlbWVudEJ1dHRvbi5sb2NhbEJvdW5kcy5kaWxhdGVkWFkoIG9wdGlvbnMubW91c2VBcmVhWERpbGF0aW9uLCBvcHRpb25zLm1vdXNlQXJlYVlEaWxhdGlvbiApO1xyXG4gICAgICBkZWNyZW1lbnRCdXR0b24ubW91c2VBcmVhID0gZGVjcmVtZW50QnV0dG9uLmxvY2FsQm91bmRzLmRpbGF0ZWRYWSggb3B0aW9ucy5tb3VzZUFyZWFYRGlsYXRpb24sIG9wdGlvbnMubW91c2VBcmVhWURpbGF0aW9uICk7XHJcblxyXG4gICAgICAvLyBzaGlmdCB0b3VjaCBhcmVhcyBmb3IgdGhlc2Ugb3B0aW9ucywgdG8gcHJldmVudCBvdmVybGFwXHJcbiAgICAgIGlmICggb3B0aW9ucy5hcnJvd3NQb3NpdGlvbiA9PT0gJ2JvdGhSaWdodCcgKSB7XHJcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLm1vdXNlQXJlYSA9IGluY3JlbWVudEJ1dHRvbi5tb3VzZUFyZWEuc2hpZnRlZFkoIC1vcHRpb25zLm1vdXNlQXJlYVlEaWxhdGlvbiApO1xyXG4gICAgICAgIGRlY3JlbWVudEJ1dHRvbi5tb3VzZUFyZWEgPSBkZWNyZW1lbnRCdXR0b24ubW91c2VBcmVhLnNoaWZ0ZWRZKCBvcHRpb25zLm1vdXNlQXJlYVlEaWxhdGlvbiApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAnYm90aEJvdHRvbScgKSB7XHJcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLm1vdXNlQXJlYSA9IGluY3JlbWVudEJ1dHRvbi5tb3VzZUFyZWEuc2hpZnRlZFgoIG9wdGlvbnMubW91c2VBcmVhWERpbGF0aW9uICk7XHJcbiAgICAgICAgZGVjcmVtZW50QnV0dG9uLm1vdXNlQXJlYSA9IGRlY3JlbWVudEJ1dHRvbi5tb3VzZUFyZWEuc2hpZnRlZFgoIC1vcHRpb25zLm1vdXNlQXJlYVhEaWxhdGlvbiApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFsgbnVtYmVyRGlzcGxheSwgaW5jcmVtZW50QnV0dG9uLCBkZWNyZW1lbnRCdXR0b24gXTtcclxuXHJcbiAgICAvLyBwZG9tIC0gTnVtYmVyU3Bpbm5lciB1c2VzIEFjY2Vzc2libGVWYWx1ZUhhbmRsZXIgZm9yIGFjY2Vzc2liaWxpdHksIGJ1dCBpdCB3YXMgZGVjaWRlZCB0aGF0IGtleWJvYXJkU3RlcFxyXG4gICAgLy8gYW5kIHNoaWZ0S2V5Ym9hcmRTdGVwIHNob3VsZCBoYXZlIHRoZSBzYW1lIGJlaGF2aW9yIGFzIHRoZSBOdW1iZXJTcGlubmVyIEFycm93QnV0dG9ucyBBTkQgdGhlIEFycm93QnV0dG9uc1xyXG4gICAgLy8gc2hvdWxkIGxvb2sgZGVwcmVzc2VkIHdoZW4gaW50ZXJhY3Rpbmcgd2l0aCB0aG9zZSBrZXlzLiBUbyBhY2NvbXBsaXNoIHRoaXMgd2UgYWN0dWFsbHkgcHJlc3MgdGhlIEFycm93QnV0dG9uc1xyXG4gICAgLy8gaW4gcmVzcG9uc2UgdG8gaW5wdXQgd2l0aCB0aG9zZSBrZXlzLiBrZXlib2FyZFN0ZXAgYW5kIHNoaWZ0S2V5Ym9hcmRTdGVwIGFyZSBzZXQgdG8gemVybyBzbyB0aGUgdmFsdWUgaXNuJ3RcclxuICAgIC8vIG1vZGlmaWVkIGFnYWluIGJ5IEFjY2Vzc2libGVWYWx1ZUhhbmRsZXIuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zLmtleWJvYXJkU3RlcCA9PT0gdW5kZWZpbmVkLCAnTnVtYmVyU3Bpbm5lciBzZXRzIGtleWJvYXJkU3RlcCwgaXQgd2lsbCBiZSB0aGUgc2FtZSBhcyBkZWx0YVZhbHVlJyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5zaGlmdEtleWJvYXJkU3RlcCA9PT0gdW5kZWZpbmVkLCAnTnVtYmVyU3Bpbm5lciBzZXRzIHNoaWZ0S2V5Ym9hcmRTdGVwLCBpdCB3aWxsIGJlIHRoZSBzYW1lIGFzIGRlbHRhVmFsdWUnICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zLnBhZ2VLZXlib2FyZFN0ZXAgPT09IHVuZGVmaW5lZCwgJ051bWJlclNwaW5uZXIgc2V0cyBwYWdlS2V5Ym9hcmRTdGVwLCBpdCBzaG91bGQgbm90IGJlIHVzZWQgd2l0aCBOdW1iZXJTcGlubmVyJyApO1xyXG4gICAgb3B0aW9ucy5rZXlib2FyZFN0ZXAgPSAwO1xyXG4gICAgb3B0aW9ucy5zaGlmdEtleWJvYXJkU3RlcCA9IDA7XHJcbiAgICBvcHRpb25zLnBhZ2VLZXlib2FyZFN0ZXAgPSAwO1xyXG5cclxuICAgIC8vIENhbGwgc3VwZXIgd2l0aG91dCB0aGUgb3B0aW9ucyB0aGF0IHJlcXVpcmUgdmFsaWQgYm91bmRzLiBDYWxsIG11dGF0ZSBsYXRlciB3aXRoIHRob3NlIG9wdGlvbnMuXHJcbiAgICBjb25zdCBib3VuZHNSZXF1aXJlZE9wdGlvbktleXMgPSBfLnBpY2soIG9wdGlvbnMsIE5vZGUuUkVRVUlSRVNfQk9VTkRTX09QVElPTl9LRVlTICk7XHJcbiAgICBzdXBlciggXy5vbWl0KCBvcHRpb25zLCBOb2RlLlJFUVVJUkVTX0JPVU5EU19PUFRJT05fS0VZUyApICk7XHJcblxyXG4gICAgLy8gZW5hYmxlL2Rpc2FibGUgYXJyb3cgYnV0dG9uc1xyXG4gICAgY29uc3QgdXBkYXRlRW5hYmxlZCA9ICgpID0+IHtcclxuICAgICAgaW5jcmVtZW50QnV0dG9uLmVuYWJsZWQgPSAoIGluY3JlbWVudEZ1bmN0aW9uKCBudW1iZXJQcm9wZXJ0eS52YWx1ZSApIDw9IHJhbmdlUHJvcGVydHkudmFsdWUubWF4ICk7XHJcbiAgICAgIGRlY3JlbWVudEJ1dHRvbi5lbmFibGVkID0gKCBkZWNyZW1lbnRGdW5jdGlvbiggbnVtYmVyUHJvcGVydHkudmFsdWUgKSA+PSByYW5nZVByb3BlcnR5LnZhbHVlLm1pbiApO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBzeW5jaHJvbml6ZSB3aXRoIG51bWJlciB2YWx1ZVxyXG4gICAgY29uc3QgbnVtYmVyUHJvcGVydHlPYnNlcnZlciA9ICggdmFsdWU6IG51bWJlciApID0+IHtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggcmFuZ2VQcm9wZXJ0eS52YWx1ZS5jb250YWlucyggdmFsdWUgKSwgYHZhbHVlIG91dCBvZiByYW5nZTogJHt2YWx1ZX1gICk7XHJcbiAgICAgIHVwZGF0ZUVuYWJsZWQoKTtcclxuICAgIH07XHJcbiAgICBudW1iZXJQcm9wZXJ0eS5saW5rKCBudW1iZXJQcm9wZXJ0eU9ic2VydmVyICk7IC8vIG11c3QgYmUgdW5saW5rZWQgaW4gZGlzcG9zZVxyXG5cclxuICAgIC8vIER5bmFtaWMgcmFuZ2UgY2hhbmdlcywgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zY2VuZXJ5LXBoZXQvaXNzdWVzLzMwNVxyXG4gICAgY29uc3QgcmFuZ2VPYnNlcnZlciA9ICggcmFuZ2U6IFJhbmdlICkgPT4ge1xyXG5cclxuICAgICAgLy8gSWYgb3VyIHZhbHVlIGlzIG91dHNpZGUgb3VyIG5ldyByYW5nZSwgYWRqdXN0IGl0IHRvIGJlIHdpdGhpbiB0aGUgcmFuZ2UuXHJcbiAgICAgIG51bWJlclByb3BlcnR5LnZhbHVlID0gcmFuZ2UuY29uc3RyYWluVmFsdWUoIG51bWJlclByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gICAgICAvLyBSYW5nZSBjaGFuZ2VzIG1heSBjaGFuZ2Ugd2hldGhlciB0aGUgYnV0dG9ucyBhcmUgZW5hYmxlZFxyXG4gICAgICB1cGRhdGVFbmFibGVkKCk7XHJcbiAgICB9O1xyXG4gICAgcmFuZ2VQcm9wZXJ0eS5saW5rKCByYW5nZU9ic2VydmVyICk7XHJcblxyXG4gICAgLy8gcGRvbSAtIGNsaWNrIGFycm93IGJ1dHRvbnMgb24gcHJlc3Mgb2YgYXJyb3cga2V5cyBzbyB0aGF0IHRoZSBQcm9wZXJ0eSB2YWx1ZSBjaGFuZ2VzIGJ5IGRlbHRhVmFsdWVcclxuICAgIC8vIGFuZCB0aGUgYnV0dG9ucyBsb29rIGRlcHJlc3NlZFxyXG4gICAgY29uc3QgaW5jcmVhc2VkTGlzdGVuZXIgPSAoIGlzRG93bjogYm9vbGVhbiApID0+ICggaXNEb3duICYmIGluY3JlbWVudEJ1dHRvbi5wZG9tQ2xpY2soKSApO1xyXG4gICAgY29uc3QgZGVjcmVhc2VkTGlzdGVuZXIgPSAoIGlzRG93bjogYm9vbGVhbiApID0+ICggaXNEb3duICYmIGRlY3JlbWVudEJ1dHRvbi5wZG9tQ2xpY2soKSApO1xyXG4gICAgdGhpcy5pbmNyZW1lbnREb3duRW1pdHRlci5hZGRMaXN0ZW5lciggaW5jcmVhc2VkTGlzdGVuZXIgKTtcclxuICAgIHRoaXMuZGVjcmVtZW50RG93bkVtaXR0ZXIuYWRkTGlzdGVuZXIoIGRlY3JlYXNlZExpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlTnVtYmVyU3Bpbm5lciA9ICgpID0+IHtcclxuXHJcbiAgICAgIC8vIGRpc3Bvc2Ugb2Ygc3ViY29tcG9uZW50c1xyXG4gICAgICBudW1iZXJEaXNwbGF5LmRpc3Bvc2UoKTtcclxuICAgICAgaW5jcmVtZW50QnV0dG9uLmRpc3Bvc2UoKTtcclxuICAgICAgZGVjcmVtZW50QnV0dG9uLmRpc3Bvc2UoKTtcclxuXHJcbiAgICAgIC8vIGRpc3Bvc2UgYTExeSBmZWF0dXJlc1xyXG4gICAgICB0aGlzLmluY3JlbWVudERvd25FbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCBpbmNyZWFzZWRMaXN0ZW5lciApO1xyXG4gICAgICB0aGlzLmRlY3JlbWVudERvd25FbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCBkZWNyZWFzZWRMaXN0ZW5lciApO1xyXG5cclxuICAgICAgbnVtYmVyUHJvcGVydHkudW5saW5rKCBudW1iZXJQcm9wZXJ0eU9ic2VydmVyICk7XHJcbiAgICAgIHJhbmdlUHJvcGVydHkudW5saW5rKCByYW5nZU9ic2VydmVyICk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMubXV0YXRlKCBib3VuZHNSZXF1aXJlZE9wdGlvbktleXMgKTtcclxuXHJcbiAgICB0aGlzLm51bWJlckRpc3BsYXkgPSBudW1iZXJEaXNwbGF5O1xyXG5cclxuICAgIC8vIENyZWF0ZSBhIGxpbmsgdG8gYXNzb2NpYXRlZCBQcm9wZXJ0eSwgc28gaXQncyBlYXNpZXIgdG8gZmluZCBpbiBTdHVkaW8uIE11c3QgYmUgYWZ0ZXIgaW5zdHJ1bWVudGF0aW9uXHJcbiAgICB0aGlzLmFkZExpbmtlZEVsZW1lbnQoIG51bWJlclByb3BlcnR5LCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncHJvcGVydHknIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBzdXBwb3J0IGZvciBiaW5kZXIgZG9jdW1lbnRhdGlvbiwgc3RyaXBwZWQgb3V0IGluIGJ1aWxkcyBhbmQgb25seSBydW5zIHdoZW4gP2JpbmRlciBpcyBzcGVjaWZpZWRcclxuICAgIGFzc2VydCAmJiBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmJpbmRlciAmJiBJbnN0YW5jZVJlZ2lzdHJ5LnJlZ2lzdGVyRGF0YVVSTCggJ3N1bicsICdOdW1iZXJTcGlubmVyJywgdGhpcyApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VOdW1iZXJTcGlubmVyKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSBudW1iZXJGb3JtYXR0ZXIgZm9yIHRoZSBOdW1iZXJEaXNwbGF5LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXROdW1iZXJGb3JtYXR0ZXIoIG51bWJlckZvcm1hdHRlcjogKCBuOiBudW1iZXIgKSA9PiBzdHJpbmcgKTogdm9pZCB7XHJcbiAgICB0aGlzLm51bWJlckRpc3BsYXkuc2V0TnVtYmVyRm9ybWF0dGVyKCBudW1iZXJGb3JtYXR0ZXIgKTtcclxuICB9XHJcblxyXG59XHJcblxyXG5zdW4ucmVnaXN0ZXIoICdOdW1iZXJTcGlubmVyJywgTnVtYmVyU3Bpbm5lciApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUlBLE9BQU9BLGdCQUFnQixNQUFNLHNEQUFzRDtBQUNuRixPQUFPQyxTQUFTLElBQUlDLGNBQWMsUUFBUSxpQ0FBaUM7QUFDM0UsT0FBT0Ms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