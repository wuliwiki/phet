// Copyright 2013-2023, University of Colorado Boulder

/**
 * Checkbox is a typical checkbox UI component.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import PhetioAction from '../../tandem/js/PhetioAction.js';
import validate from '../../axon/js/validate.js';
import { m3 } from '../../dot/js/Matrix3.js';
import InstanceRegistry from '../../phet-core/js/documentation/InstanceRegistry.js';
import { FireListener, isWidthSizable, LayoutConstraint, Node, Path, Rectangle, SceneryConstants, Voicing, WidthSizable } from '../../scenery/js/imports.js';
import checkEmptySolidShape from '../../sherpa/js/fontawesome-4/checkEmptySolidShape.js';
import checkSquareOSolidShape from '../../sherpa/js/fontawesome-4/checkSquareOSolidShape.js';
import checkboxCheckedSoundPlayer from '../../tambo/js/shared-sound-players/checkboxCheckedSoundPlayer.js';
import checkboxUncheckedSoundPlayer from '../../tambo/js/shared-sound-players/checkboxUncheckedSoundPlayer.js';
import EventType from '../../tandem/js/EventType.js';
import PhetioObject from '../../tandem/js/PhetioObject.js';
import Tandem from '../../tandem/js/Tandem.js';
import optionize from '../../phet-core/js/optionize.js';
import sun from './sun.js';
import Utterance from '../../utterance-queue/js/Utterance.js';
// constants
const BOOLEAN_VALIDATOR = {
  valueType: 'boolean'
};
const SHAPE_MATRIX = m3(0.025, 0, 0, 0, -0.025, 0, 0, 0, 1); // to create a unity-scale icon
const uncheckedShape = checkEmptySolidShape.transformed(SHAPE_MATRIX);
const checkedShape = checkSquareOSolidShape.transformed(SHAPE_MATRIX);
export default class Checkbox extends WidthSizable(Voicing(Node)) {
  // We need to record if the mouse/touch areas are customized, so that we can avoid overwriting them.
  // public for use by CheckboxConstraint only!
  _isMouseAreaCustomized = false;
  _isTouchAreaCustomized = false;
  _isSettingAreas = false;

  // Handles layout of the content, rectangles and mouse/touch areas

  constructor(property, content, providedOptions) {
    const options = optionize()({
      // CheckboxOptions
      spacing: 5,
      boxWidth: 21,
      checkboxColor: 'black',
      checkboxColorBackground: 'white',
      touchAreaXDilation: 0,
      touchAreaYDilation: 0,
      mouseAreaXDilation: 0,
      mouseAreaYDilation: 0,
      checkedSoundPlayer: checkboxCheckedSoundPlayer,
      uncheckedSoundPlayer: checkboxUncheckedSoundPlayer,
      phetioLinkProperty: true,
      // NodeOptions
      cursor: 'pointer',
      disabledOpacity: SceneryConstants.DISABLED_OPACITY,
      // phet-io
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'Checkbox',
      phetioEventType: EventType.USER,
      visiblePropertyOptions: {
        phetioFeatured: true
      },
      phetioEnabledPropertyInstrumented: true,
      // opt into default PhET-iO instrumented enabledProperty

      // to support properly passing this to children, see https://github.com/phetsims/tandem/issues/60
      phetioReadOnly: PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,
      // pdom
      tagName: 'input',
      inputType: 'checkbox',
      appendDescription: true,
      // voicing
      voicingCheckedObjectResponse: null,
      voicingUncheckedObjectResponse: null,
      // Utterances to be spoken with a screen reader after the checkbox is pressed. Also used for
      // the voicingContextResponse
      checkedContextResponse: null,
      uncheckedContextResponse: null,
      voiceNameResponseOnSelection: true
    }, providedOptions);
    super();

    // sends out notifications when the checkbox is toggled.
    const toggleAction = new PhetioAction(() => {
      property.value = !property.value;
      validate(property.value, BOOLEAN_VALIDATOR);
      if (property.value) {
        options.checkedSoundPlayer.play();
        options.checkedContextResponse && this.alertDescriptionUtterance(options.checkedContextResponse);
        this.voicingSpeakResponse({
          nameResponse: options.voiceNameResponseOnSelection ? this.voicingNameResponse : null,
          objectResponse: Utterance.alertableToText(options.voicingCheckedObjectResponse),
          contextResponse: Utterance.alertableToText(options.checkedContextResponse)
        });
      } else {
        options.uncheckedSoundPlayer.play();
        options.uncheckedContextResponse && this.alertDescriptionUtterance(options.uncheckedContextResponse);
        this.voicingSpeakResponse({
          nameResponse: options.voiceNameResponseOnSelection ? this.voicingNameResponse : null,
          objectResponse: Utterance.alertableToText(options.voicingUncheckedObjectResponse),
          contextResponse: Utterance.alertableToText(options.uncheckedContextResponse)
        });
      }
    }, {
      parameters: [],
      tandem: options.tandem.createTandem('toggleAction'),
      phetioDocumentation: 'Emits when user input causes the checkbox to toggle, emitting a single arg: ' + 'the new boolean value of the checkbox state.',
      phetioReadOnly: true,
      // interoperability should be done through the Property, this is just for the data stream event.
      phetioEventType: EventType.USER
    });

    // Create the background.
    // Until we are creating our own shapes, just put a rectangle behind the font awesome checkbox icons.
    this.backgroundNode = new Rectangle(0, -options.boxWidth, options.boxWidth * 0.95, options.boxWidth * 0.95, options.boxWidth * 0.2, options.boxWidth * 0.2, {
      fill: options.checkboxColorBackground
    });
    this.uncheckedNode = new Path(uncheckedShape, {
      fill: options.checkboxColor
    });
    const iconScale = options.boxWidth / this.uncheckedNode.width;
    this.uncheckedNode.scale(iconScale);
    this.checkedNode = new Path(checkedShape, {
      scale: iconScale,
      fill: options.checkboxColor
    });
    const checkboxNode = new Node({
      children: [this.backgroundNode, this.checkedNode, this.uncheckedNode]
    });

    // put a rectangle on top of everything to prevent dead zones when clicking
    const rectangle = new Rectangle({});
    this.children = [checkboxNode, content, rectangle];
    this.constraint = new CheckboxConstraint(this, checkboxNode, this.checkedNode, content, rectangle, options);
    this.constraint.updateLayout();
    content.pickable = false; // since there's a pickable rectangle on top of content

    // In case the content is an instance of a focusable Node. Checkbox icon should not be in the traversal order.
    content.pdomVisible = false;

    // interactivity
    const fireListener = new FireListener({
      fire: () => toggleAction.execute(),
      tandem: options.tandem.createTandem('fireListener')
    });
    this.addInputListener(fireListener);

    // sync with property
    const checkboxCheckedListener = checked => {
      this.checkedNode.visible = checked;
      this.uncheckedNode.visible = !checked;
      this.pdomChecked = checked;
    };
    property.link(checkboxCheckedListener);

    // Apply additional options
    this.mutate(options);

    // pdom - to prevent a bug with NVDA and Firefox where the label sibling receives two click events, see
    // https://github.com/phetsims/gravity-force-lab/issues/257
    this.setExcludeLabelSiblingFromInput();

    // must be after the Checkbox is instrumented
    options.phetioLinkProperty && this.addLinkedElement(property, {
      tandem: options.tandem.createTandem('property')
    });

    // support for binder documentation, stripped out in builds and only runs when ?binder is specified
    assert && phet.chipper.queryParameters.binder && InstanceRegistry.registerDataURL('sun', 'Checkbox', this);
    this.disposeCheckbox = () => {
      rectangle.dispose();
      this.backgroundNode.dispose();
      this.uncheckedNode.dispose();
      this.checkedNode.dispose();
      checkboxNode.dispose();
      fireListener.dispose();
      if (property.hasListener(checkboxCheckedListener)) {
        property.unlink(checkboxCheckedListener);
      }

      // Private to Checkbox, but we need to clean up tandem.
      toggleAction.dispose();
    };
  }
  dispose() {
    this.constraint.dispose();
    this.disposeCheckbox();
    super.dispose();
  }

  /**
   * Sets the background color of the checkbox.
   */
  setCheckboxColorBackground(value) {
    this.backgroundNode.fill = value;
  }
  set checkboxColorBackground(value) {
    this.setCheckboxColorBackground(value);
  }
  get checkboxColorBackground() {
    return this.getCheckboxColorBackground();
  }

  /**
   * Gets the background color of the checkbox.
   */
  getCheckboxColorBackground() {
    return this.backgroundNode.fill;
  }

  /**
   * Sets the color of the checkbox.
   */
  setCheckboxColor(value) {
    this.checkedNode.fill = this.uncheckedNode.fill = value;
  }
  set checkboxColor(value) {
    this.setCheckboxColor(value);
  }
  get checkboxColor() {
    return this.getCheckboxColor();
  }

  /**
   * Gets the color of the checkbox.
   */
  getCheckboxColor() {
    return this.checkedNode.fill;
  }
  setMouseArea(area) {
    if (!this._isSettingAreas) {
      this._isMouseAreaCustomized = true;
    }
    return super.setMouseArea(area);
  }
  setTouchArea(area) {
    if (!this._isSettingAreas) {
      this._isTouchAreaCustomized = true;
    }
    return super.setTouchArea(area);
  }
}
class CheckboxConstraint extends LayoutConstraint {
  constructor(checkbox, checkboxNode, checkedNode, content, rectangle, options) {
    super(checkbox);
    this.checkbox = checkbox;
    this.checkboxNode = checkboxNode;
    this.checkedNode = checkedNode;
    this.content = content;
    this.rectangle = rectangle;
    this.options = options;
    this.checkbox.localPreferredWidthProperty.lazyLink(this._updateLayoutListener);
    this.addNode(content);
  }
  layout() {
    super.layout();

    // LayoutProxy helps with some layout operations, and will support a non-child content.
    const contentProxy = this.createLayoutProxy(this.content);
    const contentWidth = contentProxy.minimumWidth;

    // Our bounds are based on checkboxNode, but our layout is relative to checkedNode
    const checkboxWithoutSpacingWidth = this.checkedNode.right - this.checkboxNode.left;
    const minimumWidth = checkboxWithoutSpacingWidth + this.options.spacing + contentWidth;
    const preferredWidth = this.checkbox.localPreferredWidth === null ? minimumWidth : this.checkbox.localPreferredWidth;

    // Attempt to set a preferredWidth
    if (isWidthSizable(this.content)) {
      contentProxy.preferredWidth = preferredWidth - checkboxWithoutSpacingWidth - this.options.spacing;
    }

    // For now just position content. Future updates could include widthResizable content?
    contentProxy.left = this.checkedNode.right + this.options.spacing;
    contentProxy.centerY = this.checkedNode.centerY;

    // Our rectangle bounds will cover the checkboxNode and content, and if necessary expand to include the full
    // preferredWidth
    this.rectangle.rectBounds = this.checkboxNode.bounds.union(contentProxy.bounds).withMaxX(Math.max(this.checkboxNode.left + preferredWidth, contentProxy.right));

    // Update pointer areas (if the client hasn't customized them)
    this.checkbox._isSettingAreas = true;
    if (!this.checkbox._isTouchAreaCustomized) {
      this.checkbox.touchArea = this.checkbox.localBounds.dilatedXY(this.options.touchAreaXDilation, this.options.touchAreaYDilation);
    }
    if (!this.checkbox._isMouseAreaCustomized) {
      this.checkbox.mouseArea = this.checkbox.localBounds.dilatedXY(this.options.mouseAreaXDilation, this.options.mouseAreaYDilation);
    }
    this.checkbox._isSettingAreas = false;
    contentProxy.dispose();

    // Set the minimumWidth last, since this may trigger a relayout
    this.checkbox.localMinimumWidth = minimumWidth;
  }
  dispose() {
    this.checkbox.localPreferredWidthProperty.unlink(this._updateLayoutListener);
    super.dispose();
  }
}
sun.register('Checkbox', Checkbox);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQaGV0aW9BY3Rpb24iLCJ2YWxpZGF0ZSIsIm0zIiwiSW5zdGFuY2VSZWdpc3RyeSIsIkZpcmVMaXN0ZW5lciIsImlzV2lkdGhTaXphYmxlIiwiTGF5b3V0Q29uc3RyYWludCIsIk5vZGUiLCJQYXRoIiwiUmVjdGFuZ2xlIiwiU2NlbmVyeUNvbnN0YW50cyIsIlZvaWNpbmciLCJXaWR0aFNpemFibGUiLCJjaGVja0VtcHR5U29saWRTaGFwZSIsImNoZWNrU3F1YXJlT1NvbGlkU2hhcGUiLCJjaGVja2JveENoZWNrZWRTb3VuZFBsYXllciIsImNoZWNrYm94VW5jaGVja2VkU291bmRQbGF5ZXIiLCJFdmVudFR5cGUiLCJQaGV0aW9PYmplY3QiLCJUYW5kZW0iLCJvcHRpb25pemUiLCJzdW4iLCJVdHRlcmFuY2UiLCJCT09MRUFOX1ZBTElEQVRPUiIsInZhbHVlVHlwZSIsIlNIQVBFX01BVFJJWCIsInVuY2hlY2tlZFNoYXBlIiwidHJhbnNmb3JtZWQiLCJjaGVja2VkU2hhcGUiLCJDaGVja2JveCIsIl9pc01vdXNlQXJlYUN1c3RvbWl6ZWQiLCJfaXNUb3VjaEFyZWFDdXN0b21pemVkIiwiX2lzU2V0dGluZ0FyZWFzIiwiY29uc3RydWN0b3IiLCJwcm9wZXJ0eSIsImNvbnRlbnQiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwic3BhY2luZyIsImJveFdpZHRoIiwiY2hlY2tib3hDb2xvciIsImNoZWNrYm94Q29sb3JCYWNrZ3JvdW5kIiwidG91Y2hBcmVhWERpbGF0aW9uIiwidG91Y2hBcmVhWURpbGF0aW9uIiwibW91c2VBcmVhWERpbGF0aW9uIiwibW91c2VBcmVhWURpbGF0aW9uIiwiY2hlY2tlZFNvdW5kUGxheWVyIiwidW5jaGVja2VkU291bmRQbGF5ZXIiLCJwaGV0aW9MaW5rUHJvcGVydHkiLCJjdXJzb3IiLCJkaXNhYmxlZE9wYWNpdHkiLCJESVNBQkxFRF9PUEFDSVRZIiwidGFuZGVtIiwiUkVRVUlSRUQiLCJ0YW5kZW1OYW1lU3VmZml4IiwicGhldGlvRXZlbnRUeXBlIiwiVVNFUiIsInZpc2libGVQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9GZWF0dXJlZCIsInBoZXRpb0VuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZCIsInBoZXRpb1JlYWRPbmx5IiwiREVGQVVMVF9PUFRJT05TIiwidGFnTmFtZSIsImlucHV0VHlwZSIsImFwcGVuZERlc2NyaXB0aW9uIiwidm9pY2luZ0NoZWNrZWRPYmplY3RSZXNwb25zZSIsInZvaWNpbmdVbmNoZWNrZWRPYmplY3RSZXNwb25zZSIsImNoZWNrZWRDb250ZXh0UmVzcG9uc2UiLCJ1bmNoZWNrZWRDb250ZXh0UmVzcG9uc2UiLCJ2b2ljZU5hbWVSZXNwb25zZU9uU2VsZWN0aW9uIiwidG9nZ2xlQWN0aW9uIiwidmFsdWUiLCJwbGF5IiwiYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSIsInZvaWNpbmdTcGVha1Jlc3BvbnNlIiwibmFtZVJlc3BvbnNlIiwidm9pY2luZ05hbWVSZXNwb25zZSIsIm9iamVjdFJlc3BvbnNlIiwiYWxlcnRhYmxlVG9UZXh0IiwiY29udGV4dFJlc3BvbnNlIiwicGFyYW1ldGVycyIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJiYWNrZ3JvdW5kTm9kZSIsImZpbGwiLCJ1bmNoZWNrZWROb2RlIiwiaWNvblNjYWxlIiwid2lkdGgiLCJzY2FsZSIsImNoZWNrZWROb2RlIiwiY2hlY2tib3hOb2RlIiwiY2hpbGRyZW4iLCJyZWN0YW5nbGUiLCJjb25zdHJhaW50IiwiQ2hlY2tib3hDb25zdHJhaW50IiwidXBkYXRlTGF5b3V0IiwicGlja2FibGUiLCJwZG9tVmlzaWJsZSIsImZpcmVMaXN0ZW5lciIsImZpcmUiLCJleGVjdXRlIiwiYWRkSW5wdXRMaXN0ZW5lciIsImNoZWNrYm94Q2hlY2tlZExpc3RlbmVyIiwiY2hlY2tlZCIsInZpc2libGUiLCJwZG9tQ2hlY2tlZCIsImxpbmsiLCJtdXRhdGUiLCJzZXRFeGNsdWRlTGFiZWxTaWJsaW5nRnJvbUlucHV0IiwiYWRkTGlua2VkRWxlbWVudCIsImFzc2VydCIsInBoZXQiLCJjaGlwcGVyIiwicXVlcnlQYXJhbWV0ZXJzIiwiYmluZGVyIiwicmVnaXN0ZXJEYXRhVVJMIiwiZGlzcG9zZUNoZWNrYm94IiwiZGlzcG9zZSIsImhhc0xpc3RlbmVyIiwidW5saW5rIiwic2V0Q2hlY2tib3hDb2xvckJhY2tncm91bmQiLCJnZXRDaGVja2JveENvbG9yQmFja2dyb3VuZCIsInNldENoZWNrYm94Q29sb3IiLCJnZXRDaGVja2JveENvbG9yIiwic2V0TW91c2VBcmVhIiwiYXJlYSIsInNldFRvdWNoQXJlYSIsImNoZWNrYm94IiwibG9jYWxQcmVmZXJyZWRXaWR0aFByb3BlcnR5IiwibGF6eUxpbmsiLCJfdXBkYXRlTGF5b3V0TGlzdGVuZXIiLCJhZGROb2RlIiwibGF5b3V0IiwiY29udGVudFByb3h5IiwiY3JlYXRlTGF5b3V0UHJveHkiLCJjb250ZW50V2lkdGgiLCJtaW5pbXVtV2lkdGgiLCJjaGVja2JveFdpdGhvdXRTcGFjaW5nV2lkdGgiLCJyaWdodCIsImxlZnQiLCJwcmVmZXJyZWRXaWR0aCIsImxvY2FsUHJlZmVycmVkV2lkdGgiLCJjZW50ZXJZIiwicmVjdEJvdW5kcyIsImJvdW5kcyIsInVuaW9uIiwid2l0aE1heFgiLCJNYXRoIiwibWF4IiwidG91Y2hBcmVhIiwibG9jYWxCb3VuZHMiLCJkaWxhdGVkWFkiLCJtb3VzZUFyZWEiLCJsb2NhbE1pbmltdW1XaWR0aCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQ2hlY2tib3gudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQ2hlY2tib3ggaXMgYSB0eXBpY2FsIGNoZWNrYm94IFVJIGNvbXBvbmVudC5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgUGhldGlvQWN0aW9uIGZyb20gJy4uLy4uL3RhbmRlbS9qcy9QaGV0aW9BY3Rpb24uanMnO1xyXG5pbXBvcnQgdmFsaWRhdGUgZnJvbSAnLi4vLi4vYXhvbi9qcy92YWxpZGF0ZS5qcyc7XHJcbmltcG9ydCB7IG0zIH0gZnJvbSAnLi4vLi4vZG90L2pzL01hdHJpeDMuanMnO1xyXG5pbXBvcnQgSW5zdGFuY2VSZWdpc3RyeSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvZG9jdW1lbnRhdGlvbi9JbnN0YW5jZVJlZ2lzdHJ5LmpzJztcclxuaW1wb3J0IHsgRmlyZUxpc3RlbmVyLCBpc1dpZHRoU2l6YWJsZSwgTGF5b3V0Q29uc3RyYWludCwgTm9kZSwgTm9kZU9wdGlvbnMsIFBhdGgsIFJlY3RhbmdsZSwgU2NlbmVyeUNvbnN0YW50cywgVFBhaW50LCBWb2ljaW5nLCBWb2ljaW5nT3B0aW9ucywgV2lkdGhTaXphYmxlLCBXaWR0aFNpemFibGVPcHRpb25zIH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGNoZWNrRW1wdHlTb2xpZFNoYXBlIGZyb20gJy4uLy4uL3NoZXJwYS9qcy9mb250YXdlc29tZS00L2NoZWNrRW1wdHlTb2xpZFNoYXBlLmpzJztcclxuaW1wb3J0IGNoZWNrU3F1YXJlT1NvbGlkU2hhcGUgZnJvbSAnLi4vLi4vc2hlcnBhL2pzL2ZvbnRhd2Vzb21lLTQvY2hlY2tTcXVhcmVPU29saWRTaGFwZS5qcyc7XHJcbmltcG9ydCBjaGVja2JveENoZWNrZWRTb3VuZFBsYXllciBmcm9tICcuLi8uLi90YW1iby9qcy9zaGFyZWQtc291bmQtcGxheWVycy9jaGVja2JveENoZWNrZWRTb3VuZFBsYXllci5qcyc7XHJcbmltcG9ydCBjaGVja2JveFVuY2hlY2tlZFNvdW5kUGxheWVyIGZyb20gJy4uLy4uL3RhbWJvL2pzL3NoYXJlZC1zb3VuZC1wbGF5ZXJzL2NoZWNrYm94VW5jaGVja2VkU291bmRQbGF5ZXIuanMnO1xyXG5pbXBvcnQgRXZlbnRUeXBlIGZyb20gJy4uLy4uL3RhbmRlbS9qcy9FdmVudFR5cGUuanMnO1xyXG5pbXBvcnQgUGhldGlvT2JqZWN0IGZyb20gJy4uLy4uL3RhbmRlbS9qcy9QaGV0aW9PYmplY3QuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgc3VuIGZyb20gJy4vc3VuLmpzJztcclxuaW1wb3J0IFRTb3VuZFBsYXllciBmcm9tICcuLi8uLi90YW1iby9qcy9UU291bmRQbGF5ZXIuanMnO1xyXG5pbXBvcnQgVXR0ZXJhbmNlLCB7IFRBbGVydGFibGUgfSBmcm9tICcuLi8uLi91dHRlcmFuY2UtcXVldWUvanMvVXR0ZXJhbmNlLmpzJztcclxuaW1wb3J0IEJvdW5kczIgZnJvbSAnLi4vLi4vZG90L2pzL0JvdW5kczIuanMnO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IExpbmthYmxlUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9MaW5rYWJsZVByb3BlcnR5LmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBCT09MRUFOX1ZBTElEQVRPUiA9IHsgdmFsdWVUeXBlOiAnYm9vbGVhbicgfTtcclxuY29uc3QgU0hBUEVfTUFUUklYID0gbTMoIDAuMDI1LCAwLCAwLCAwLCAtMC4wMjUsIDAsIDAsIDAsIDEgKTsgLy8gdG8gY3JlYXRlIGEgdW5pdHktc2NhbGUgaWNvblxyXG5jb25zdCB1bmNoZWNrZWRTaGFwZSA9IGNoZWNrRW1wdHlTb2xpZFNoYXBlLnRyYW5zZm9ybWVkKCBTSEFQRV9NQVRSSVggKTtcclxuY29uc3QgY2hlY2tlZFNoYXBlID0gY2hlY2tTcXVhcmVPU29saWRTaGFwZS50cmFuc2Zvcm1lZCggU0hBUEVfTUFUUklYICk7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIHNwYWNpbmc/OiBudW1iZXI7ICAvLyBzcGFjaW5nIGJldHdlZW4gYm94IGFuZCBjb250ZW50XHJcbiAgYm94V2lkdGg/OiBudW1iZXI7IC8vIHdpZHRoIChhbmQgaGVpZ2h0KSBvZiB0aGUgYm94XHJcbiAgY2hlY2tib3hDb2xvcj86IFRQYWludDtcclxuICBjaGVja2JveENvbG9yQmFja2dyb3VuZD86IFRQYWludDtcclxuXHJcbiAgLy8gcG9pbnRlciBhcmVhc1xyXG4gIHRvdWNoQXJlYVhEaWxhdGlvbj86IG51bWJlcjtcclxuICB0b3VjaEFyZWFZRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgbW91c2VBcmVhWERpbGF0aW9uPzogbnVtYmVyO1xyXG4gIG1vdXNlQXJlYVlEaWxhdGlvbj86IG51bWJlcjtcclxuXHJcbiAgLy8gc291bmRzXHJcbiAgY2hlY2tlZFNvdW5kUGxheWVyPzogVFNvdW5kUGxheWVyO1xyXG4gIHVuY2hlY2tlZFNvdW5kUGxheWVyPzogVFNvdW5kUGxheWVyO1xyXG5cclxuICAvLyBVdHRlcmFuY2VzIHRvIGJlIHNwb2tlbiB3aXRoIGEgc2NyZWVuIHJlYWRlciBhZnRlciB0aGUgY2hlY2tib3ggaXMgcHJlc3NlZC4gQWxzbyB1c2VkIGZvciB0aGUgdm9pY2luZ0NvbnRleHRSZXNwb25zZS5cclxuICBjaGVja2VkQ29udGV4dFJlc3BvbnNlPzogVEFsZXJ0YWJsZTtcclxuICB1bmNoZWNrZWRDb250ZXh0UmVzcG9uc2U/OiBUQWxlcnRhYmxlO1xyXG5cclxuICAvLyBCeSBkZWZhdWx0IHZvaWNlIHRoZSBuYW1lIHJlc3BvbnNlIG9uIGNoZWNrYm94IGNoYW5nZSAod2l0aCB0aGUgY29udGV4dCByZXNwb25zZSksIGJ1dCBvcHRpb25hbGx5IHR1cm4gaXQgb2ZmIGhlcmUuXHJcbiAgdm9pY2VOYW1lUmVzcG9uc2VPblNlbGVjdGlvbj86IGJvb2xlYW47XHJcblxyXG4gIC8vIE91dHB1dCBkZXNjcmliaW5nIHRoZSBzdGF0ZSBvZiB0aGUgQ2hlY2tib3ggYWZ0ZXIgaXQgaXMgcHJlc3NlZCB1c2luZyB0aGUgVm9pY2luZyBmZWF0dXJlLiBMaWtlIFwiQ2hlY2tlZFwiIG9yXHJcbiAgLy8gXCJMb2NrZWRcIi4gTm90IHVzdWFsbHkgbmVlZGVkLCBkZWZhdWx0IGlzIG51bGwuXHJcbiAgdm9pY2luZ0NoZWNrZWRPYmplY3RSZXNwb25zZT86IFRBbGVydGFibGU7XHJcbiAgdm9pY2luZ1VuY2hlY2tlZE9iamVjdFJlc3BvbnNlPzogVEFsZXJ0YWJsZTtcclxuXHJcbiAgLy8gd2hldGhlciBhIFBoRVQtaU8gbGluayB0byB0aGUgY2hlY2tib3gncyBQcm9wZXJ0eSBpcyBjcmVhdGVkXHJcbiAgcGhldGlvTGlua1Byb3BlcnR5PzogYm9vbGVhbjtcclxufTtcclxuXHJcbnR5cGUgUGFyZW50T3B0aW9ucyA9IFdpZHRoU2l6YWJsZU9wdGlvbnMgJiBWb2ljaW5nT3B0aW9ucyAmIE5vZGVPcHRpb25zO1xyXG5cclxuZXhwb3J0IHR5cGUgQ2hlY2tib3hPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PFBhcmVudE9wdGlvbnMsICdjaGlsZHJlbicgfCAnbW91c2VBcmVhJyB8ICd0b3VjaEFyZWEnPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENoZWNrYm94IGV4dGVuZHMgV2lkdGhTaXphYmxlKCBWb2ljaW5nKCBOb2RlICkgKSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgYmFja2dyb3VuZE5vZGU6IFJlY3RhbmdsZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNoZWNrZWROb2RlOiBQYXRoO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdW5jaGVja2VkTm9kZTogUGF0aDtcclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VDaGVja2JveDogKCkgPT4gdm9pZDtcclxuXHJcbiAgLy8gV2UgbmVlZCB0byByZWNvcmQgaWYgdGhlIG1vdXNlL3RvdWNoIGFyZWFzIGFyZSBjdXN0b21pemVkLCBzbyB0aGF0IHdlIGNhbiBhdm9pZCBvdmVyd3JpdGluZyB0aGVtLlxyXG4gIC8vIHB1YmxpYyBmb3IgdXNlIGJ5IENoZWNrYm94Q29uc3RyYWludCBvbmx5IVxyXG4gIHB1YmxpYyBfaXNNb3VzZUFyZWFDdXN0b21pemVkID0gZmFsc2U7XHJcbiAgcHVibGljIF9pc1RvdWNoQXJlYUN1c3RvbWl6ZWQgPSBmYWxzZTtcclxuICBwdWJsaWMgX2lzU2V0dGluZ0FyZWFzID0gZmFsc2U7XHJcblxyXG4gIC8vIEhhbmRsZXMgbGF5b3V0IG9mIHRoZSBjb250ZW50LCByZWN0YW5nbGVzIGFuZCBtb3VzZS90b3VjaCBhcmVhc1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY29uc3RyYWludDogQ2hlY2tib3hDb25zdHJhaW50O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3BlcnR5OiBMaW5rYWJsZVByb3BlcnR5PGJvb2xlYW4+LCBjb250ZW50OiBOb2RlLCBwcm92aWRlZE9wdGlvbnM/OiBDaGVja2JveE9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxDaGVja2JveE9wdGlvbnMsIFNlbGZPcHRpb25zLCBQYXJlbnRPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBDaGVja2JveE9wdGlvbnNcclxuICAgICAgc3BhY2luZzogNSxcclxuICAgICAgYm94V2lkdGg6IDIxLFxyXG4gICAgICBjaGVja2JveENvbG9yOiAnYmxhY2snLFxyXG4gICAgICBjaGVja2JveENvbG9yQmFja2dyb3VuZDogJ3doaXRlJyxcclxuICAgICAgdG91Y2hBcmVhWERpbGF0aW9uOiAwLFxyXG4gICAgICB0b3VjaEFyZWFZRGlsYXRpb246IDAsXHJcbiAgICAgIG1vdXNlQXJlYVhEaWxhdGlvbjogMCxcclxuICAgICAgbW91c2VBcmVhWURpbGF0aW9uOiAwLFxyXG4gICAgICBjaGVja2VkU291bmRQbGF5ZXI6IGNoZWNrYm94Q2hlY2tlZFNvdW5kUGxheWVyLFxyXG4gICAgICB1bmNoZWNrZWRTb3VuZFBsYXllcjogY2hlY2tib3hVbmNoZWNrZWRTb3VuZFBsYXllcixcclxuICAgICAgcGhldGlvTGlua1Byb3BlcnR5OiB0cnVlLFxyXG5cclxuICAgICAgLy8gTm9kZU9wdGlvbnNcclxuICAgICAgY3Vyc29yOiAncG9pbnRlcicsXHJcbiAgICAgIGRpc2FibGVkT3BhY2l0eTogU2NlbmVyeUNvbnN0YW50cy5ESVNBQkxFRF9PUEFDSVRZLFxyXG5cclxuICAgICAgLy8gcGhldC1pb1xyXG4gICAgICB0YW5kZW06IFRhbmRlbS5SRVFVSVJFRCxcclxuICAgICAgdGFuZGVtTmFtZVN1ZmZpeDogJ0NoZWNrYm94JyxcclxuICAgICAgcGhldGlvRXZlbnRUeXBlOiBFdmVudFR5cGUuVVNFUixcclxuICAgICAgdmlzaWJsZVByb3BlcnR5T3B0aW9uczogeyBwaGV0aW9GZWF0dXJlZDogdHJ1ZSB9LFxyXG4gICAgICBwaGV0aW9FbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQ6IHRydWUsIC8vIG9wdCBpbnRvIGRlZmF1bHQgUGhFVC1pTyBpbnN0cnVtZW50ZWQgZW5hYmxlZFByb3BlcnR5XHJcblxyXG4gICAgICAvLyB0byBzdXBwb3J0IHByb3Blcmx5IHBhc3NpbmcgdGhpcyB0byBjaGlsZHJlbiwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy90YW5kZW0vaXNzdWVzLzYwXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiBQaGV0aW9PYmplY3QuREVGQVVMVF9PUFRJT05TLnBoZXRpb1JlYWRPbmx5LFxyXG5cclxuICAgICAgLy8gcGRvbVxyXG4gICAgICB0YWdOYW1lOiAnaW5wdXQnLFxyXG4gICAgICBpbnB1dFR5cGU6ICdjaGVja2JveCcsXHJcbiAgICAgIGFwcGVuZERlc2NyaXB0aW9uOiB0cnVlLFxyXG5cclxuICAgICAgLy8gdm9pY2luZ1xyXG4gICAgICB2b2ljaW5nQ2hlY2tlZE9iamVjdFJlc3BvbnNlOiBudWxsLFxyXG4gICAgICB2b2ljaW5nVW5jaGVja2VkT2JqZWN0UmVzcG9uc2U6IG51bGwsXHJcblxyXG4gICAgICAvLyBVdHRlcmFuY2VzIHRvIGJlIHNwb2tlbiB3aXRoIGEgc2NyZWVuIHJlYWRlciBhZnRlciB0aGUgY2hlY2tib3ggaXMgcHJlc3NlZC4gQWxzbyB1c2VkIGZvclxyXG4gICAgICAvLyB0aGUgdm9pY2luZ0NvbnRleHRSZXNwb25zZVxyXG4gICAgICBjaGVja2VkQ29udGV4dFJlc3BvbnNlOiBudWxsLFxyXG4gICAgICB1bmNoZWNrZWRDb250ZXh0UmVzcG9uc2U6IG51bGwsXHJcbiAgICAgIHZvaWNlTmFtZVJlc3BvbnNlT25TZWxlY3Rpb246IHRydWVcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgLy8gc2VuZHMgb3V0IG5vdGlmaWNhdGlvbnMgd2hlbiB0aGUgY2hlY2tib3ggaXMgdG9nZ2xlZC5cclxuICAgIGNvbnN0IHRvZ2dsZUFjdGlvbiA9IG5ldyBQaGV0aW9BY3Rpb24oICgpID0+IHtcclxuICAgICAgcHJvcGVydHkudmFsdWUgPSAhcHJvcGVydHkudmFsdWU7XHJcbiAgICAgIHZhbGlkYXRlKCBwcm9wZXJ0eS52YWx1ZSwgQk9PTEVBTl9WQUxJREFUT1IgKTtcclxuICAgICAgaWYgKCBwcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICBvcHRpb25zLmNoZWNrZWRTb3VuZFBsYXllci5wbGF5KCk7XHJcbiAgICAgICAgb3B0aW9ucy5jaGVja2VkQ29udGV4dFJlc3BvbnNlICYmIHRoaXMuYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSggb3B0aW9ucy5jaGVja2VkQ29udGV4dFJlc3BvbnNlICk7XHJcbiAgICAgICAgdGhpcy52b2ljaW5nU3BlYWtSZXNwb25zZSgge1xyXG4gICAgICAgICAgbmFtZVJlc3BvbnNlOiBvcHRpb25zLnZvaWNlTmFtZVJlc3BvbnNlT25TZWxlY3Rpb24gPyB0aGlzLnZvaWNpbmdOYW1lUmVzcG9uc2UgOiBudWxsLFxyXG4gICAgICAgICAgb2JqZWN0UmVzcG9uc2U6IFV0dGVyYW5jZS5hbGVydGFibGVUb1RleHQoIG9wdGlvbnMudm9pY2luZ0NoZWNrZWRPYmplY3RSZXNwb25zZSApLFxyXG4gICAgICAgICAgY29udGV4dFJlc3BvbnNlOiBVdHRlcmFuY2UuYWxlcnRhYmxlVG9UZXh0KCBvcHRpb25zLmNoZWNrZWRDb250ZXh0UmVzcG9uc2UgKVxyXG4gICAgICAgIH0gKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBvcHRpb25zLnVuY2hlY2tlZFNvdW5kUGxheWVyLnBsYXkoKTtcclxuICAgICAgICBvcHRpb25zLnVuY2hlY2tlZENvbnRleHRSZXNwb25zZSAmJiB0aGlzLmFsZXJ0RGVzY3JpcHRpb25VdHRlcmFuY2UoIG9wdGlvbnMudW5jaGVja2VkQ29udGV4dFJlc3BvbnNlICk7XHJcbiAgICAgICAgdGhpcy52b2ljaW5nU3BlYWtSZXNwb25zZSgge1xyXG4gICAgICAgICAgbmFtZVJlc3BvbnNlOiBvcHRpb25zLnZvaWNlTmFtZVJlc3BvbnNlT25TZWxlY3Rpb24gPyB0aGlzLnZvaWNpbmdOYW1lUmVzcG9uc2UgOiBudWxsLFxyXG4gICAgICAgICAgb2JqZWN0UmVzcG9uc2U6IFV0dGVyYW5jZS5hbGVydGFibGVUb1RleHQoIG9wdGlvbnMudm9pY2luZ1VuY2hlY2tlZE9iamVjdFJlc3BvbnNlICksXHJcbiAgICAgICAgICBjb250ZXh0UmVzcG9uc2U6IFV0dGVyYW5jZS5hbGVydGFibGVUb1RleHQoIG9wdGlvbnMudW5jaGVja2VkQ29udGV4dFJlc3BvbnNlIClcclxuICAgICAgICB9ICk7XHJcbiAgICAgIH1cclxuICAgIH0sIHtcclxuICAgICAgcGFyYW1ldGVyczogW10sXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndG9nZ2xlQWN0aW9uJyApLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnRW1pdHMgd2hlbiB1c2VyIGlucHV0IGNhdXNlcyB0aGUgY2hlY2tib3ggdG8gdG9nZ2xlLCBlbWl0dGluZyBhIHNpbmdsZSBhcmc6ICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAndGhlIG5ldyBib29sZWFuIHZhbHVlIG9mIHRoZSBjaGVja2JveCBzdGF0ZS4nLFxyXG4gICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZSwgLy8gaW50ZXJvcGVyYWJpbGl0eSBzaG91bGQgYmUgZG9uZSB0aHJvdWdoIHRoZSBQcm9wZXJ0eSwgdGhpcyBpcyBqdXN0IGZvciB0aGUgZGF0YSBzdHJlYW0gZXZlbnQuXHJcbiAgICAgIHBoZXRpb0V2ZW50VHlwZTogRXZlbnRUeXBlLlVTRVJcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIGJhY2tncm91bmQuXHJcbiAgICAvLyBVbnRpbCB3ZSBhcmUgY3JlYXRpbmcgb3VyIG93biBzaGFwZXMsIGp1c3QgcHV0IGEgcmVjdGFuZ2xlIGJlaGluZCB0aGUgZm9udCBhd2Vzb21lIGNoZWNrYm94IGljb25zLlxyXG4gICAgdGhpcy5iYWNrZ3JvdW5kTm9kZSA9IG5ldyBSZWN0YW5nbGUoIDAsIC1vcHRpb25zLmJveFdpZHRoLCBvcHRpb25zLmJveFdpZHRoICogMC45NSwgb3B0aW9ucy5ib3hXaWR0aCAqIDAuOTUsXHJcbiAgICAgIG9wdGlvbnMuYm94V2lkdGggKiAwLjIsIG9wdGlvbnMuYm94V2lkdGggKiAwLjIsIHtcclxuICAgICAgICBmaWxsOiBvcHRpb25zLmNoZWNrYm94Q29sb3JCYWNrZ3JvdW5kXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnVuY2hlY2tlZE5vZGUgPSBuZXcgUGF0aCggdW5jaGVja2VkU2hhcGUsIHtcclxuICAgICAgZmlsbDogb3B0aW9ucy5jaGVja2JveENvbG9yXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBpY29uU2NhbGUgPSBvcHRpb25zLmJveFdpZHRoIC8gdGhpcy51bmNoZWNrZWROb2RlLndpZHRoO1xyXG4gICAgdGhpcy51bmNoZWNrZWROb2RlLnNjYWxlKCBpY29uU2NhbGUgKTtcclxuXHJcbiAgICB0aGlzLmNoZWNrZWROb2RlID0gbmV3IFBhdGgoIGNoZWNrZWRTaGFwZSwge1xyXG4gICAgICBzY2FsZTogaWNvblNjYWxlLFxyXG4gICAgICBmaWxsOiBvcHRpb25zLmNoZWNrYm94Q29sb3JcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBjaGVja2JveE5vZGUgPSBuZXcgTm9kZSggeyBjaGlsZHJlbjogWyB0aGlzLmJhY2tncm91bmROb2RlLCB0aGlzLmNoZWNrZWROb2RlLCB0aGlzLnVuY2hlY2tlZE5vZGUgXSB9ICk7XHJcblxyXG4gICAgLy8gcHV0IGEgcmVjdGFuZ2xlIG9uIHRvcCBvZiBldmVyeXRoaW5nIHRvIHByZXZlbnQgZGVhZCB6b25lcyB3aGVuIGNsaWNraW5nXHJcbiAgICBjb25zdCByZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKCB7fSApO1xyXG5cclxuICAgIHRoaXMuY2hpbGRyZW4gPSBbXHJcbiAgICAgIGNoZWNrYm94Tm9kZSxcclxuICAgICAgY29udGVudCxcclxuICAgICAgcmVjdGFuZ2xlXHJcbiAgICBdO1xyXG5cclxuICAgIHRoaXMuY29uc3RyYWludCA9IG5ldyBDaGVja2JveENvbnN0cmFpbnQoIHRoaXMsIGNoZWNrYm94Tm9kZSwgdGhpcy5jaGVja2VkTm9kZSwgY29udGVudCwgcmVjdGFuZ2xlLCBvcHRpb25zICk7XHJcbiAgICB0aGlzLmNvbnN0cmFpbnQudXBkYXRlTGF5b3V0KCk7XHJcblxyXG4gICAgY29udGVudC5waWNrYWJsZSA9IGZhbHNlOyAvLyBzaW5jZSB0aGVyZSdzIGEgcGlja2FibGUgcmVjdGFuZ2xlIG9uIHRvcCBvZiBjb250ZW50XHJcblxyXG4gICAgLy8gSW4gY2FzZSB0aGUgY29udGVudCBpcyBhbiBpbnN0YW5jZSBvZiBhIGZvY3VzYWJsZSBOb2RlLiBDaGVja2JveCBpY29uIHNob3VsZCBub3QgYmUgaW4gdGhlIHRyYXZlcnNhbCBvcmRlci5cclxuICAgIGNvbnRlbnQucGRvbVZpc2libGUgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBpbnRlcmFjdGl2aXR5XHJcbiAgICBjb25zdCBmaXJlTGlzdGVuZXIgPSBuZXcgRmlyZUxpc3RlbmVyKCB7XHJcbiAgICAgIGZpcmU6ICgpID0+IHRvZ2dsZUFjdGlvbi5leGVjdXRlKCksXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZmlyZUxpc3RlbmVyJyApXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZElucHV0TGlzdGVuZXIoIGZpcmVMaXN0ZW5lciApO1xyXG5cclxuICAgIC8vIHN5bmMgd2l0aCBwcm9wZXJ0eVxyXG4gICAgY29uc3QgY2hlY2tib3hDaGVja2VkTGlzdGVuZXIgPSAoIGNoZWNrZWQ6IGJvb2xlYW4gKSA9PiB7XHJcbiAgICAgIHRoaXMuY2hlY2tlZE5vZGUudmlzaWJsZSA9IGNoZWNrZWQ7XHJcbiAgICAgIHRoaXMudW5jaGVja2VkTm9kZS52aXNpYmxlID0gIWNoZWNrZWQ7XHJcbiAgICAgIHRoaXMucGRvbUNoZWNrZWQgPSBjaGVja2VkO1xyXG4gICAgfTtcclxuICAgIHByb3BlcnR5LmxpbmsoIGNoZWNrYm94Q2hlY2tlZExpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gQXBwbHkgYWRkaXRpb25hbCBvcHRpb25zXHJcbiAgICB0aGlzLm11dGF0ZSggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIHBkb20gLSB0byBwcmV2ZW50IGEgYnVnIHdpdGggTlZEQSBhbmQgRmlyZWZveCB3aGVyZSB0aGUgbGFiZWwgc2libGluZyByZWNlaXZlcyB0d28gY2xpY2sgZXZlbnRzLCBzZWVcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmF2aXR5LWZvcmNlLWxhYi9pc3N1ZXMvMjU3XHJcbiAgICB0aGlzLnNldEV4Y2x1ZGVMYWJlbFNpYmxpbmdGcm9tSW5wdXQoKTtcclxuXHJcbiAgICAvLyBtdXN0IGJlIGFmdGVyIHRoZSBDaGVja2JveCBpcyBpbnN0cnVtZW50ZWRcclxuICAgIG9wdGlvbnMucGhldGlvTGlua1Byb3BlcnR5ICYmIHRoaXMuYWRkTGlua2VkRWxlbWVudCggcHJvcGVydHksIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdwcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHN1cHBvcnQgZm9yIGJpbmRlciBkb2N1bWVudGF0aW9uLCBzdHJpcHBlZCBvdXQgaW4gYnVpbGRzIGFuZCBvbmx5IHJ1bnMgd2hlbiA/YmluZGVyIGlzIHNwZWNpZmllZFxyXG4gICAgYXNzZXJ0ICYmIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuYmluZGVyICYmIEluc3RhbmNlUmVnaXN0cnkucmVnaXN0ZXJEYXRhVVJMKCAnc3VuJywgJ0NoZWNrYm94JywgdGhpcyApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZUNoZWNrYm94ID0gKCkgPT4ge1xyXG4gICAgICByZWN0YW5nbGUuZGlzcG9zZSgpO1xyXG4gICAgICB0aGlzLmJhY2tncm91bmROb2RlLmRpc3Bvc2UoKTtcclxuICAgICAgdGhpcy51bmNoZWNrZWROb2RlLmRpc3Bvc2UoKTtcclxuICAgICAgdGhpcy5jaGVja2VkTm9kZS5kaXNwb3NlKCk7XHJcbiAgICAgIGNoZWNrYm94Tm9kZS5kaXNwb3NlKCk7XHJcbiAgICAgIGZpcmVMaXN0ZW5lci5kaXNwb3NlKCk7XHJcblxyXG4gICAgICBpZiAoIHByb3BlcnR5Lmhhc0xpc3RlbmVyKCBjaGVja2JveENoZWNrZWRMaXN0ZW5lciApICkge1xyXG4gICAgICAgIHByb3BlcnR5LnVubGluayggY2hlY2tib3hDaGVja2VkTGlzdGVuZXIgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gUHJpdmF0ZSB0byBDaGVja2JveCwgYnV0IHdlIG5lZWQgdG8gY2xlYW4gdXAgdGFuZGVtLlxyXG4gICAgICB0b2dnbGVBY3Rpb24uZGlzcG9zZSgpO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jb25zdHJhaW50LmRpc3Bvc2UoKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VDaGVja2JveCgpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgYmFja2dyb3VuZCBjb2xvciBvZiB0aGUgY2hlY2tib3guXHJcbiAgICovXHJcbiAgcHVibGljIHNldENoZWNrYm94Q29sb3JCYWNrZ3JvdW5kKCB2YWx1ZTogVFBhaW50ICk6IHZvaWQgeyB0aGlzLmJhY2tncm91bmROb2RlLmZpbGwgPSB2YWx1ZTsgfVxyXG5cclxuICBwdWJsaWMgc2V0IGNoZWNrYm94Q29sb3JCYWNrZ3JvdW5kKCB2YWx1ZTogVFBhaW50ICkgeyB0aGlzLnNldENoZWNrYm94Q29sb3JCYWNrZ3JvdW5kKCB2YWx1ZSApOyB9XHJcblxyXG4gIHB1YmxpYyBnZXQgY2hlY2tib3hDb2xvckJhY2tncm91bmQoKTogVFBhaW50IHsgcmV0dXJuIHRoaXMuZ2V0Q2hlY2tib3hDb2xvckJhY2tncm91bmQoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBiYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBjaGVja2JveC5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0Q2hlY2tib3hDb2xvckJhY2tncm91bmQoKTogVFBhaW50IHsgcmV0dXJuIHRoaXMuYmFja2dyb3VuZE5vZGUuZmlsbDsgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSBjb2xvciBvZiB0aGUgY2hlY2tib3guXHJcbiAgICovXHJcbiAgcHVibGljIHNldENoZWNrYm94Q29sb3IoIHZhbHVlOiBUUGFpbnQgKTogdm9pZCB7IHRoaXMuY2hlY2tlZE5vZGUuZmlsbCA9IHRoaXMudW5jaGVja2VkTm9kZS5maWxsID0gdmFsdWU7IH1cclxuXHJcbiAgcHVibGljIHNldCBjaGVja2JveENvbG9yKCB2YWx1ZTogVFBhaW50ICkgeyB0aGlzLnNldENoZWNrYm94Q29sb3IoIHZhbHVlICk7IH1cclxuXHJcbiAgcHVibGljIGdldCBjaGVja2JveENvbG9yKCk6IFRQYWludCB7IHJldHVybiB0aGlzLmdldENoZWNrYm94Q29sb3IoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBjb2xvciBvZiB0aGUgY2hlY2tib3guXHJcbiAgICovXHJcbiAgcHVibGljIGdldENoZWNrYm94Q29sb3IoKTogVFBhaW50IHsgcmV0dXJuIHRoaXMuY2hlY2tlZE5vZGUuZmlsbDsgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgc2V0TW91c2VBcmVhKCBhcmVhOiBTaGFwZSB8IEJvdW5kczIgfCBudWxsICk6IHRoaXMge1xyXG4gICAgaWYgKCAhdGhpcy5faXNTZXR0aW5nQXJlYXMgKSB7XHJcbiAgICAgIHRoaXMuX2lzTW91c2VBcmVhQ3VzdG9taXplZCA9IHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3VwZXIuc2V0TW91c2VBcmVhKCBhcmVhICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgc2V0VG91Y2hBcmVhKCBhcmVhOiBTaGFwZSB8IEJvdW5kczIgfCBudWxsICk6IHRoaXMge1xyXG4gICAgaWYgKCAhdGhpcy5faXNTZXR0aW5nQXJlYXMgKSB7XHJcbiAgICAgIHRoaXMuX2lzVG91Y2hBcmVhQ3VzdG9taXplZCA9IHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3VwZXIuc2V0VG91Y2hBcmVhKCBhcmVhICk7XHJcbiAgfVxyXG59XHJcblxyXG5jbGFzcyBDaGVja2JveENvbnN0cmFpbnQgZXh0ZW5kcyBMYXlvdXRDb25zdHJhaW50IHtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNoZWNrYm94OiBDaGVja2JveDtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNoZWNrYm94Tm9kZTogTm9kZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNoZWNrZWROb2RlOiBOb2RlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY29udGVudDogTm9kZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IHJlY3RhbmdsZTogUmVjdGFuZ2xlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgb3B0aW9uczogUmVxdWlyZWQ8U2VsZk9wdGlvbnM+O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGNoZWNrYm94OiBDaGVja2JveCwgY2hlY2tib3hOb2RlOiBOb2RlLCBjaGVja2VkTm9kZTogTm9kZSwgY29udGVudDogTm9kZSwgcmVjdGFuZ2xlOiBSZWN0YW5nbGUsIG9wdGlvbnM6IFJlcXVpcmVkPFNlbGZPcHRpb25zPiApIHtcclxuICAgIHN1cGVyKCBjaGVja2JveCApO1xyXG5cclxuICAgIHRoaXMuY2hlY2tib3ggPSBjaGVja2JveDtcclxuICAgIHRoaXMuY2hlY2tib3hOb2RlID0gY2hlY2tib3hOb2RlO1xyXG4gICAgdGhpcy5jaGVja2VkTm9kZSA9IGNoZWNrZWROb2RlO1xyXG4gICAgdGhpcy5jb250ZW50ID0gY29udGVudDtcclxuICAgIHRoaXMucmVjdGFuZ2xlID0gcmVjdGFuZ2xlO1xyXG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcclxuXHJcbiAgICB0aGlzLmNoZWNrYm94LmxvY2FsUHJlZmVycmVkV2lkdGhQcm9wZXJ0eS5sYXp5TGluayggdGhpcy5fdXBkYXRlTGF5b3V0TGlzdGVuZXIgKTtcclxuXHJcbiAgICB0aGlzLmFkZE5vZGUoIGNvbnRlbnQgKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBvdmVycmlkZSBsYXlvdXQoKTogdm9pZCB7XHJcbiAgICBzdXBlci5sYXlvdXQoKTtcclxuXHJcbiAgICAvLyBMYXlvdXRQcm94eSBoZWxwcyB3aXRoIHNvbWUgbGF5b3V0IG9wZXJhdGlvbnMsIGFuZCB3aWxsIHN1cHBvcnQgYSBub24tY2hpbGQgY29udGVudC5cclxuICAgIGNvbnN0IGNvbnRlbnRQcm94eSA9IHRoaXMuY3JlYXRlTGF5b3V0UHJveHkoIHRoaXMuY29udGVudCApITtcclxuXHJcbiAgICBjb25zdCBjb250ZW50V2lkdGggPSBjb250ZW50UHJveHkubWluaW11bVdpZHRoO1xyXG5cclxuICAgIC8vIE91ciBib3VuZHMgYXJlIGJhc2VkIG9uIGNoZWNrYm94Tm9kZSwgYnV0IG91ciBsYXlvdXQgaXMgcmVsYXRpdmUgdG8gY2hlY2tlZE5vZGVcclxuICAgIGNvbnN0IGNoZWNrYm94V2l0aG91dFNwYWNpbmdXaWR0aCA9ICggdGhpcy5jaGVja2VkTm9kZS5yaWdodCAtIHRoaXMuY2hlY2tib3hOb2RlLmxlZnQgKTtcclxuICAgIGNvbnN0IG1pbmltdW1XaWR0aCA9IGNoZWNrYm94V2l0aG91dFNwYWNpbmdXaWR0aCArIHRoaXMub3B0aW9ucy5zcGFjaW5nICsgY29udGVudFdpZHRoO1xyXG5cclxuICAgIGNvbnN0IHByZWZlcnJlZFdpZHRoID0gdGhpcy5jaGVja2JveC5sb2NhbFByZWZlcnJlZFdpZHRoID09PSBudWxsID8gbWluaW11bVdpZHRoIDogdGhpcy5jaGVja2JveC5sb2NhbFByZWZlcnJlZFdpZHRoO1xyXG5cclxuICAgIC8vIEF0dGVtcHQgdG8gc2V0IGEgcHJlZmVycmVkV2lkdGhcclxuICAgIGlmICggaXNXaWR0aFNpemFibGUoIHRoaXMuY29udGVudCApICkge1xyXG4gICAgICBjb250ZW50UHJveHkucHJlZmVycmVkV2lkdGggPSBwcmVmZXJyZWRXaWR0aCAtIGNoZWNrYm94V2l0aG91dFNwYWNpbmdXaWR0aCAtIHRoaXMub3B0aW9ucy5zcGFjaW5nO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZvciBub3cganVzdCBwb3NpdGlvbiBjb250ZW50LiBGdXR1cmUgdXBkYXRlcyBjb3VsZCBpbmNsdWRlIHdpZHRoUmVzaXphYmxlIGNvbnRlbnQ/XHJcbiAgICBjb250ZW50UHJveHkubGVmdCA9IHRoaXMuY2hlY2tlZE5vZGUucmlnaHQgKyB0aGlzLm9wdGlvbnMuc3BhY2luZztcclxuICAgIGNvbnRlbnRQcm94eS5jZW50ZXJZID0gdGhpcy5jaGVja2VkTm9kZS5jZW50ZXJZO1xyXG5cclxuICAgIC8vIE91ciByZWN0YW5nbGUgYm91bmRzIHdpbGwgY292ZXIgdGhlIGNoZWNrYm94Tm9kZSBhbmQgY29udGVudCwgYW5kIGlmIG5lY2Vzc2FyeSBleHBhbmQgdG8gaW5jbHVkZSB0aGUgZnVsbFxyXG4gICAgLy8gcHJlZmVycmVkV2lkdGhcclxuICAgIHRoaXMucmVjdGFuZ2xlLnJlY3RCb3VuZHMgPSB0aGlzLmNoZWNrYm94Tm9kZS5ib3VuZHMudW5pb24oIGNvbnRlbnRQcm94eS5ib3VuZHMgKS53aXRoTWF4WChcclxuICAgICAgTWF0aC5tYXgoIHRoaXMuY2hlY2tib3hOb2RlLmxlZnQgKyBwcmVmZXJyZWRXaWR0aCwgY29udGVudFByb3h5LnJpZ2h0IClcclxuICAgICk7XHJcblxyXG4gICAgLy8gVXBkYXRlIHBvaW50ZXIgYXJlYXMgKGlmIHRoZSBjbGllbnQgaGFzbid0IGN1c3RvbWl6ZWQgdGhlbSlcclxuICAgIHRoaXMuY2hlY2tib3guX2lzU2V0dGluZ0FyZWFzID0gdHJ1ZTtcclxuICAgIGlmICggIXRoaXMuY2hlY2tib3guX2lzVG91Y2hBcmVhQ3VzdG9taXplZCApIHtcclxuICAgICAgdGhpcy5jaGVja2JveC50b3VjaEFyZWEgPSB0aGlzLmNoZWNrYm94LmxvY2FsQm91bmRzLmRpbGF0ZWRYWSggdGhpcy5vcHRpb25zLnRvdWNoQXJlYVhEaWxhdGlvbiwgdGhpcy5vcHRpb25zLnRvdWNoQXJlYVlEaWxhdGlvbiApO1xyXG4gICAgfVxyXG4gICAgaWYgKCAhdGhpcy5jaGVja2JveC5faXNNb3VzZUFyZWFDdXN0b21pemVkICkge1xyXG4gICAgICB0aGlzLmNoZWNrYm94Lm1vdXNlQXJlYSA9IHRoaXMuY2hlY2tib3gubG9jYWxCb3VuZHMuZGlsYXRlZFhZKCB0aGlzLm9wdGlvbnMubW91c2VBcmVhWERpbGF0aW9uLCB0aGlzLm9wdGlvbnMubW91c2VBcmVhWURpbGF0aW9uICk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNoZWNrYm94Ll9pc1NldHRpbmdBcmVhcyA9IGZhbHNlO1xyXG5cclxuICAgIGNvbnRlbnRQcm94eS5kaXNwb3NlKCk7XHJcblxyXG4gICAgLy8gU2V0IHRoZSBtaW5pbXVtV2lkdGggbGFzdCwgc2luY2UgdGhpcyBtYXkgdHJpZ2dlciBhIHJlbGF5b3V0XHJcbiAgICB0aGlzLmNoZWNrYm94LmxvY2FsTWluaW11bVdpZHRoID0gbWluaW11bVdpZHRoO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmNoZWNrYm94LmxvY2FsUHJlZmVycmVkV2lkdGhQcm9wZXJ0eS51bmxpbmsoIHRoaXMuX3VwZGF0ZUxheW91dExpc3RlbmVyICk7XHJcblxyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuc3VuLnJlZ2lzdGVyKCAnQ2hlY2tib3gnLCBDaGVja2JveCApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsWUFBWSxNQUFNLGlDQUFpQztBQUMxRCxPQUFPQyxRQUFRLE1BQU0sMkJBQTJCO0FBQ2hELFNBQVNDLEVBQUUsUUFBUSx5QkFBeUI7QUFDNUMsT0FBT0MsZ0JBQWdCLE1BQU0sc0RBQXNEO0FBQ25GLFNBQVNDLFlBQVksRUFBRUMsY0FBYyxFQUFFQyxnQkFBZ0IsRUFBRUMsSUFBSSxFQUFlQyxJQUFJLEVBQUVDLFNBQVMsRUFBRUMsZ0JBQWdCLEVBQVVDLE9BQU8sRUFBa0JDLFlBQVksUUFBNkIsNkJBQTZCO0FBQ3ROLE9BQU9DLG9CQUFvQixNQUFNLHVEQUF1RDtBQUN4RixPQUFPQyxzQkFBc0IsTUFBTSx5REFBeUQ7QUFDNUYsT0FBT0MsMEJBQTBCLE1BQU0sbUVBQW1FO0FBQzFHLE9BQU9DLDRCQUE0QixNQUFNLHFFQUFxRTtBQUM5RyxPQUFPQyxTQUFTLE1BQU0sOEJBQThCO0FBQ3BELE9BQU9DLFlBQVksTUFBTSxpQ0FBaUM7QUFDMUQsT0FBT0MsTUFB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