// Copyright 2014-2023, University of Colorado Boulder

/**
 * ABSwitch is a control for switching between 2 choices, referred to as 'A' & 'B'.
 * Choice 'A' is to the left of the switch, choice 'B' is to the right.
 * This decorates ToggleSwitch with labels.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Emitter from '../../axon/js/Emitter.js';
import InstanceRegistry from '../../phet-core/js/documentation/InstanceRegistry.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import { AlignBox, AlignGroup, HBox, PressListener, SceneryConstants } from '../../scenery/js/imports.js';
import Tandem from '../../tandem/js/Tandem.js';
import sun from './sun.js';
import ToggleSwitch from './ToggleSwitch.js';
// constants
// Uses opacity as the default method of indicating whether a {Node} label is {boolean} enabled.
const DEFAULT_SET_ENABLED = (label, enabled) => {
  label.opacity = enabled ? 1.0 : SceneryConstants.DISABLED_OPACITY;
};
export default class ABSwitch extends HBox {
  // Emits on input that results in a change to the Property value, after the Property has changed.
  onInputEmitter = new Emitter();

  /**
   * @param property - value of the current choice
   * @param valueA - value for choice 'A'
   * @param labelA - label for choice 'A'
   * @param valueB - value for choice 'B'
   * @param labelB - label for choice 'B'
   * @param providedOptions
   */
  constructor(property, valueA, labelA, valueB, labelB, providedOptions) {
    // PhET-iO requirements
    assert && assert(labelA.tandem, 'labelA must have a tandem');
    assert && assert(labelB.tandem, 'labelB must have a tandem');

    // default option values
    const options = optionize()({
      // SelfOptions
      toggleSwitchOptions: {
        enabledPropertyOptions: {
          phetioFeatured: false // ABSwitch has an enabledProperty that is preferred to the sub-component's
        }
      },

      setEnabled: DEFAULT_SET_ENABLED,
      centerOnSwitch: false,
      // HBoxOptions
      cursor: 'pointer',
      disabledOpacity: SceneryConstants.DISABLED_OPACITY,
      spacing: 8,
      // phet-io
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'Switch',
      visiblePropertyOptions: {
        phetioFeatured: true
      },
      phetioEnabledPropertyInstrumented: true // opt into default PhET-iO instrumented enabledProperty
    }, providedOptions);
    const toggleSwitch = new ToggleSwitch(property, valueA, valueB, combineOptions({
      tandem: options.tandem.createTandem('toggleSwitch')
    }, options.toggleSwitchOptions));
    let nodeA = labelA;
    let nodeB = labelB;
    if (options.centerOnSwitch) {
      // Make both labels have the same effective size, so that this.center is at the center of toggleSwitch.
      const alignGroup = new AlignGroup();
      nodeA = new AlignBox(labelA, {
        group: alignGroup,
        xAlign: 'right'
      });
      nodeB = new AlignBox(labelB, {
        group: alignGroup,
        xAlign: 'left'
      });
    }
    options.children = [nodeA, toggleSwitch, nodeB];
    super(options);
    const propertyListener = value => {
      if (options.setEnabled) {
        options.setEnabled(labelA, value === valueA);
        options.setEnabled(labelB, value === valueB);
      }
    };
    property.link(propertyListener); // unlink on dispose

    // click on labels to select
    const pressListenerA = new PressListener({
      release: () => {
        const oldValue = property.value;
        property.value = valueA;
        if (oldValue !== valueA) {
          this.onInputEmitter.emit();
        }
      },
      tandem: labelA.tandem.createTandem('pressListener')
    });
    labelA.addInputListener(pressListenerA); // removeInputListener on dispose

    const pressListenerB = new PressListener({
      release: () => {
        const oldValue = property.value;
        property.value = valueB;
        if (oldValue !== valueB) {
          this.onInputEmitter.emit();
        }
      },
      tandem: labelB.tandem.createTandem('pressListener')
    });
    labelB.addInputListener(pressListenerB); // removeInputListener on dispose

    // The toggleSwitch input triggers ABSwitch input.
    toggleSwitch.onInputEmitter.addListener(() => this.onInputEmitter.emit());

    // Wire up sound on input
    this.onInputEmitter.addListener(() => {
      if (property.value === valueB) {
        toggleSwitch.switchToRightSoundPlayer.play();
      }
      if (property.value === valueA) {
        toggleSwitch.switchToLeftSoundPlayer.play();
      }
    });
    this.disposeABSwitch = () => {
      property.unlink(propertyListener);
      toggleSwitch.dispose();
      this.onInputEmitter.dispose();
      labelA.removeInputListener(pressListenerA);
      labelB.removeInputListener(pressListenerB);
      pressListenerA.dispose();
      pressListenerB.dispose();
    };

    // support for binder documentation, stripped out in builds and only runs when ?binder is specified
    assert && phet.chipper.queryParameters.binder && InstanceRegistry.registerDataURL('sun', 'ABSwitch', this);
  }
  dispose() {
    this.disposeABSwitch();
    super.dispose();
  }
}
sun.register('ABSwitch', ABSwitch);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFbWl0dGVyIiwiSW5zdGFuY2VSZWdpc3RyeSIsIm9wdGlvbml6ZSIsImNvbWJpbmVPcHRpb25zIiwiQWxpZ25Cb3giLCJBbGlnbkdyb3VwIiwiSEJveCIsIlByZXNzTGlzdGVuZXIiLCJTY2VuZXJ5Q29uc3RhbnRzIiwiVGFuZGVtIiwic3VuIiwiVG9nZ2xlU3dpdGNoIiwiREVGQVVMVF9TRVRfRU5BQkxFRCIsImxhYmVsIiwiZW5hYmxlZCIsIm9wYWNpdHkiLCJESVNBQkxFRF9PUEFDSVRZIiwiQUJTd2l0Y2giLCJvbklucHV0RW1pdHRlciIsImNvbnN0cnVjdG9yIiwicHJvcGVydHkiLCJ2YWx1ZUEiLCJsYWJlbEEiLCJ2YWx1ZUIiLCJsYWJlbEIiLCJwcm92aWRlZE9wdGlvbnMiLCJhc3NlcnQiLCJ0YW5kZW0iLCJvcHRpb25zIiwidG9nZ2xlU3dpdGNoT3B0aW9ucyIsImVuYWJsZWRQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9GZWF0dXJlZCIsInNldEVuYWJsZWQiLCJjZW50ZXJPblN3aXRjaCIsImN1cnNvciIsImRpc2FibGVkT3BhY2l0eSIsInNwYWNpbmciLCJSRVFVSVJFRCIsInRhbmRlbU5hbWVTdWZmaXgiLCJ2aXNpYmxlUHJvcGVydHlPcHRpb25zIiwicGhldGlvRW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkIiwidG9nZ2xlU3dpdGNoIiwiY3JlYXRlVGFuZGVtIiwibm9kZUEiLCJub2RlQiIsImFsaWduR3JvdXAiLCJncm91cCIsInhBbGlnbiIsImNoaWxkcmVuIiwicHJvcGVydHlMaXN0ZW5lciIsInZhbHVlIiwibGluayIsInByZXNzTGlzdGVuZXJBIiwicmVsZWFzZSIsIm9sZFZhbHVlIiwiZW1pdCIsImFkZElucHV0TGlzdGVuZXIiLCJwcmVzc0xpc3RlbmVyQiIsImFkZExpc3RlbmVyIiwic3dpdGNoVG9SaWdodFNvdW5kUGxheWVyIiwicGxheSIsInN3aXRjaFRvTGVmdFNvdW5kUGxheWVyIiwiZGlzcG9zZUFCU3dpdGNoIiwidW5saW5rIiwiZGlzcG9zZSIsInJlbW92ZUlucHV0TGlzdGVuZXIiLCJwaGV0IiwiY2hpcHBlciIsInF1ZXJ5UGFyYW1ldGVycyIsImJpbmRlciIsInJlZ2lzdGVyRGF0YVVSTCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQUJTd2l0Y2gudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQUJTd2l0Y2ggaXMgYSBjb250cm9sIGZvciBzd2l0Y2hpbmcgYmV0d2VlbiAyIGNob2ljZXMsIHJlZmVycmVkIHRvIGFzICdBJyAmICdCJy5cclxuICogQ2hvaWNlICdBJyBpcyB0byB0aGUgbGVmdCBvZiB0aGUgc3dpdGNoLCBjaG9pY2UgJ0InIGlzIHRvIHRoZSByaWdodC5cclxuICogVGhpcyBkZWNvcmF0ZXMgVG9nZ2xlU3dpdGNoIHdpdGggbGFiZWxzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IEVtaXR0ZXIgZnJvbSAnLi4vLi4vYXhvbi9qcy9FbWl0dGVyLmpzJztcclxuaW1wb3J0IEluc3RhbmNlUmVnaXN0cnkgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL2RvY3VtZW50YXRpb24vSW5zdGFuY2VSZWdpc3RyeS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgY29tYmluZU9wdGlvbnMgfSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IHsgQWxpZ25Cb3gsIEFsaWduR3JvdXAsIEhCb3gsIEhCb3hPcHRpb25zLCBOb2RlLCBQcmVzc0xpc3RlbmVyLCBTY2VuZXJ5Q29uc3RhbnRzIH0gZnJvbSAnLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IHN1biBmcm9tICcuL3N1bi5qcyc7XHJcbmltcG9ydCBUb2dnbGVTd2l0Y2gsIHsgVG9nZ2xlU3dpdGNoT3B0aW9ucyB9IGZyb20gJy4vVG9nZ2xlU3dpdGNoLmpzJztcclxuaW1wb3J0IFRFbWl0dGVyIGZyb20gJy4uLy4uL2F4b24vanMvVEVtaXR0ZXIuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcblxyXG4vLyBVc2VzIG9wYWNpdHkgYXMgdGhlIGRlZmF1bHQgbWV0aG9kIG9mIGluZGljYXRpbmcgd2hldGhlciBhIHtOb2RlfSBsYWJlbCBpcyB7Ym9vbGVhbn0gZW5hYmxlZC5cclxuY29uc3QgREVGQVVMVF9TRVRfRU5BQkxFRCA9ICggbGFiZWw6IE5vZGUsIGVuYWJsZWQ6IGJvb2xlYW4gKSA9PiB7XHJcbiAgbGFiZWwub3BhY2l0eSA9IGVuYWJsZWQgPyAxLjAgOiBTY2VuZXJ5Q29uc3RhbnRzLkRJU0FCTEVEX09QQUNJVFk7XHJcbn07XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyBvcHRpb25zIHBhc3NlZCB0byBUb2dnbGVTd2l0Y2hcclxuICB0b2dnbGVTd2l0Y2hPcHRpb25zPzogVG9nZ2xlU3dpdGNoT3B0aW9ucztcclxuXHJcbiAgLy8gbWV0aG9kIG9mIG1ha2luZyB0aGUgbGFiZWxzIGxvb2sgZGlzYWJsZWRcclxuICBzZXRFbmFibGVkPzogKCBsYWJlbE5vZGU6IE5vZGUsIGVuYWJsZWQ6IGJvb2xlYW4gKSA9PiB2b2lkO1xyXG5cclxuICAvLyBpZiB0cnVlLCB0aGlzLmNlbnRlciB3aWxsIGJlIGF0IHRoZSBjZW50ZXIgb2YgdGhlIFRvZ2dsZVN3aXRjaFxyXG4gIGNlbnRlck9uU3dpdGNoPzogYm9vbGVhbjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEFCU3dpdGNoT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgSEJveE9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBQlN3aXRjaDxUPiBleHRlbmRzIEhCb3gge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VBQlN3aXRjaDogKCkgPT4gdm9pZDtcclxuXHJcbiAgLy8gRW1pdHMgb24gaW5wdXQgdGhhdCByZXN1bHRzIGluIGEgY2hhbmdlIHRvIHRoZSBQcm9wZXJ0eSB2YWx1ZSwgYWZ0ZXIgdGhlIFByb3BlcnR5IGhhcyBjaGFuZ2VkLlxyXG4gIHB1YmxpYyByZWFkb25seSBvbklucHV0RW1pdHRlcjogVEVtaXR0ZXIgPSBuZXcgRW1pdHRlcigpO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gcHJvcGVydHkgLSB2YWx1ZSBvZiB0aGUgY3VycmVudCBjaG9pY2VcclxuICAgKiBAcGFyYW0gdmFsdWVBIC0gdmFsdWUgZm9yIGNob2ljZSAnQSdcclxuICAgKiBAcGFyYW0gbGFiZWxBIC0gbGFiZWwgZm9yIGNob2ljZSAnQSdcclxuICAgKiBAcGFyYW0gdmFsdWVCIC0gdmFsdWUgZm9yIGNob2ljZSAnQidcclxuICAgKiBAcGFyYW0gbGFiZWxCIC0gbGFiZWwgZm9yIGNob2ljZSAnQidcclxuICAgKiBAcGFyYW0gcHJvdmlkZWRPcHRpb25zXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm9wZXJ0eTogUHJvcGVydHk8VD4sIHZhbHVlQTogVCwgbGFiZWxBOiBOb2RlLCB2YWx1ZUI6IFQsIGxhYmVsQjogTm9kZSwgcHJvdmlkZWRPcHRpb25zPzogQUJTd2l0Y2hPcHRpb25zICkge1xyXG5cclxuICAgIC8vIFBoRVQtaU8gcmVxdWlyZW1lbnRzXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBsYWJlbEEudGFuZGVtLCAnbGFiZWxBIG11c3QgaGF2ZSBhIHRhbmRlbScgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGxhYmVsQi50YW5kZW0sICdsYWJlbEIgbXVzdCBoYXZlIGEgdGFuZGVtJyApO1xyXG5cclxuICAgIC8vIGRlZmF1bHQgb3B0aW9uIHZhbHVlc1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxBQlN3aXRjaE9wdGlvbnMsIFNlbGZPcHRpb25zLCBIQm94T3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgdG9nZ2xlU3dpdGNoT3B0aW9uczoge1xyXG4gICAgICAgIGVuYWJsZWRQcm9wZXJ0eU9wdGlvbnM6IHtcclxuICAgICAgICAgIHBoZXRpb0ZlYXR1cmVkOiBmYWxzZSAvLyBBQlN3aXRjaCBoYXMgYW4gZW5hYmxlZFByb3BlcnR5IHRoYXQgaXMgcHJlZmVycmVkIHRvIHRoZSBzdWItY29tcG9uZW50J3NcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHNldEVuYWJsZWQ6IERFRkFVTFRfU0VUX0VOQUJMRUQsXHJcbiAgICAgIGNlbnRlck9uU3dpdGNoOiBmYWxzZSxcclxuXHJcbiAgICAgIC8vIEhCb3hPcHRpb25zXHJcbiAgICAgIGN1cnNvcjogJ3BvaW50ZXInLFxyXG4gICAgICBkaXNhYmxlZE9wYWNpdHk6IFNjZW5lcnlDb25zdGFudHMuRElTQUJMRURfT1BBQ0lUWSxcclxuICAgICAgc3BhY2luZzogOCxcclxuXHJcbiAgICAgIC8vIHBoZXQtaW9cclxuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRUQsXHJcbiAgICAgIHRhbmRlbU5hbWVTdWZmaXg6ICdTd2l0Y2gnLFxyXG4gICAgICB2aXNpYmxlUHJvcGVydHlPcHRpb25zOiB7IHBoZXRpb0ZlYXR1cmVkOiB0cnVlIH0sXHJcbiAgICAgIHBoZXRpb0VuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZDogdHJ1ZSAvLyBvcHQgaW50byBkZWZhdWx0IFBoRVQtaU8gaW5zdHJ1bWVudGVkIGVuYWJsZWRQcm9wZXJ0eVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgdG9nZ2xlU3dpdGNoID0gbmV3IFRvZ2dsZVN3aXRjaDxUPiggcHJvcGVydHksIHZhbHVlQSwgdmFsdWVCLFxyXG4gICAgICBjb21iaW5lT3B0aW9uczxUb2dnbGVTd2l0Y2hPcHRpb25zPigge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndG9nZ2xlU3dpdGNoJyApXHJcbiAgICAgIH0sIG9wdGlvbnMudG9nZ2xlU3dpdGNoT3B0aW9ucyApICk7XHJcblxyXG4gICAgbGV0IG5vZGVBID0gbGFiZWxBO1xyXG4gICAgbGV0IG5vZGVCID0gbGFiZWxCO1xyXG4gICAgaWYgKCBvcHRpb25zLmNlbnRlck9uU3dpdGNoICkge1xyXG5cclxuICAgICAgLy8gTWFrZSBib3RoIGxhYmVscyBoYXZlIHRoZSBzYW1lIGVmZmVjdGl2ZSBzaXplLCBzbyB0aGF0IHRoaXMuY2VudGVyIGlzIGF0IHRoZSBjZW50ZXIgb2YgdG9nZ2xlU3dpdGNoLlxyXG4gICAgICBjb25zdCBhbGlnbkdyb3VwID0gbmV3IEFsaWduR3JvdXAoKTtcclxuICAgICAgbm9kZUEgPSBuZXcgQWxpZ25Cb3goIGxhYmVsQSwge1xyXG4gICAgICAgIGdyb3VwOiBhbGlnbkdyb3VwLFxyXG4gICAgICAgIHhBbGlnbjogJ3JpZ2h0J1xyXG4gICAgICB9ICk7XHJcbiAgICAgIG5vZGVCID0gbmV3IEFsaWduQm94KCBsYWJlbEIsIHtcclxuICAgICAgICBncm91cDogYWxpZ25Hcm91cCxcclxuICAgICAgICB4QWxpZ246ICdsZWZ0J1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFsgbm9kZUEsIHRvZ2dsZVN3aXRjaCwgbm9kZUIgXTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IHByb3BlcnR5TGlzdGVuZXIgPSAoIHZhbHVlOiBUICkgPT4ge1xyXG4gICAgICBpZiAoIG9wdGlvbnMuc2V0RW5hYmxlZCApIHtcclxuICAgICAgICBvcHRpb25zLnNldEVuYWJsZWQoIGxhYmVsQSwgdmFsdWUgPT09IHZhbHVlQSApO1xyXG4gICAgICAgIG9wdGlvbnMuc2V0RW5hYmxlZCggbGFiZWxCLCB2YWx1ZSA9PT0gdmFsdWVCICk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBwcm9wZXJ0eS5saW5rKCBwcm9wZXJ0eUxpc3RlbmVyICk7IC8vIHVubGluayBvbiBkaXNwb3NlXHJcblxyXG4gICAgLy8gY2xpY2sgb24gbGFiZWxzIHRvIHNlbGVjdFxyXG4gICAgY29uc3QgcHJlc3NMaXN0ZW5lckEgPSBuZXcgUHJlc3NMaXN0ZW5lcigge1xyXG4gICAgICByZWxlYXNlOiAoKSA9PiB7XHJcbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBwcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgICBwcm9wZXJ0eS52YWx1ZSA9IHZhbHVlQTtcclxuICAgICAgICBpZiAoIG9sZFZhbHVlICE9PSB2YWx1ZUEgKSB7XHJcbiAgICAgICAgICB0aGlzLm9uSW5wdXRFbWl0dGVyLmVtaXQoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHRhbmRlbTogbGFiZWxBLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdwcmVzc0xpc3RlbmVyJyApXHJcbiAgICB9ICk7XHJcbiAgICBsYWJlbEEuYWRkSW5wdXRMaXN0ZW5lciggcHJlc3NMaXN0ZW5lckEgKTsgLy8gcmVtb3ZlSW5wdXRMaXN0ZW5lciBvbiBkaXNwb3NlXHJcblxyXG4gICAgY29uc3QgcHJlc3NMaXN0ZW5lckIgPSBuZXcgUHJlc3NMaXN0ZW5lcigge1xyXG4gICAgICByZWxlYXNlOiAoKSA9PiB7XHJcbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBwcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgICBwcm9wZXJ0eS52YWx1ZSA9IHZhbHVlQjtcclxuICAgICAgICBpZiAoIG9sZFZhbHVlICE9PSB2YWx1ZUIgKSB7XHJcbiAgICAgICAgICB0aGlzLm9uSW5wdXRFbWl0dGVyLmVtaXQoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHRhbmRlbTogbGFiZWxCLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdwcmVzc0xpc3RlbmVyJyApXHJcbiAgICB9ICk7XHJcbiAgICBsYWJlbEIuYWRkSW5wdXRMaXN0ZW5lciggcHJlc3NMaXN0ZW5lckIgKTsgLy8gcmVtb3ZlSW5wdXRMaXN0ZW5lciBvbiBkaXNwb3NlXHJcblxyXG4gICAgLy8gVGhlIHRvZ2dsZVN3aXRjaCBpbnB1dCB0cmlnZ2VycyBBQlN3aXRjaCBpbnB1dC5cclxuICAgIHRvZ2dsZVN3aXRjaC5vbklucHV0RW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4gdGhpcy5vbklucHV0RW1pdHRlci5lbWl0KCkgKTtcclxuXHJcbiAgICAvLyBXaXJlIHVwIHNvdW5kIG9uIGlucHV0XHJcbiAgICB0aGlzLm9uSW5wdXRFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgIGlmICggcHJvcGVydHkudmFsdWUgPT09IHZhbHVlQiApIHtcclxuICAgICAgICB0b2dnbGVTd2l0Y2guc3dpdGNoVG9SaWdodFNvdW5kUGxheWVyLnBsYXkoKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIHByb3BlcnR5LnZhbHVlID09PSB2YWx1ZUEgKSB7XHJcbiAgICAgICAgdG9nZ2xlU3dpdGNoLnN3aXRjaFRvTGVmdFNvdW5kUGxheWVyLnBsYXkoKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZUFCU3dpdGNoID0gKCkgPT4ge1xyXG4gICAgICBwcm9wZXJ0eS51bmxpbmsoIHByb3BlcnR5TGlzdGVuZXIgKTtcclxuICAgICAgdG9nZ2xlU3dpdGNoLmRpc3Bvc2UoKTtcclxuICAgICAgdGhpcy5vbklucHV0RW1pdHRlci5kaXNwb3NlKCk7XHJcbiAgICAgIGxhYmVsQS5yZW1vdmVJbnB1dExpc3RlbmVyKCBwcmVzc0xpc3RlbmVyQSApO1xyXG4gICAgICBsYWJlbEIucmVtb3ZlSW5wdXRMaXN0ZW5lciggcHJlc3NMaXN0ZW5lckIgKTtcclxuICAgICAgcHJlc3NMaXN0ZW5lckEuZGlzcG9zZSgpO1xyXG4gICAgICBwcmVzc0xpc3RlbmVyQi5kaXNwb3NlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIHN1cHBvcnQgZm9yIGJpbmRlciBkb2N1bWVudGF0aW9uLCBzdHJpcHBlZCBvdXQgaW4gYnVpbGRzIGFuZCBvbmx5IHJ1bnMgd2hlbiA/YmluZGVyIGlzIHNwZWNpZmllZFxyXG4gICAgYXNzZXJ0ICYmIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuYmluZGVyICYmIEluc3RhbmNlUmVnaXN0cnkucmVnaXN0ZXJEYXRhVVJMKCAnc3VuJywgJ0FCU3dpdGNoJywgdGhpcyApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VBQlN3aXRjaCgpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuc3VuLnJlZ2lzdGVyKCAnQUJTd2l0Y2gnLCBBQlN3aXRjaCApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0EsT0FBT0EsT0FBTyxNQUFNLDBCQUEwQjtBQUM5QyxPQUFPQyxnQkFBZ0IsTUFBTSxzREFBc0Q7QUFDbkYsT0FBT0MsU0FBUyxJQUFJQyxjQUFjLFFBQVEsaUNBQWlDO0FBQzNFLFNBQVNDLFFBQVEsRUFBRUMsVUFBVSxFQUFFQyxJQUFJLEVBQXFCQyxhQUFhLEVBQUVDLGdCQUFnQixRQUFRLDZCQUE2QjtBQUM1SCxPQUFPQyxNQUFNLE1BQU0sMkJBQTJCO0FBQzlDLE9BQU9DLEdBQUcsTUFBTSxVQUFVO0FBQzFCLE9BQU9DLFlBQVksTUFBK0IsbUJBQW1CO0FBR3JFO0FBRUE7QUFDQSxNQUFNQyxtQkFBbUIsR0FBR0EsQ0FBRUMsS0FBVyxFQUFFQyxPQUFnQixLQUFNO0VBQy9ERCxLQUFLLENBQUNFLE9BQU8sR0FBR0QsT0FBTyxHQUFHLEdBQUcsR0FBR04sZ0JBQWdCLENBQUNRLGdCQUFnQjtBQUNuRSxDQUFDO0FBZ0JELGVBQWUs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