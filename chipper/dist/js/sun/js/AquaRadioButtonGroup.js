// Copyright 2013-2023, University of Colorado Boulder

/**
 * AquaRadioButtonGroup creates a group of AquaRadioButtons and manages their layout.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Chris Malley (PixelZoom, Inc.)
 */

import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import { FlowBox, PDOMPeer, SceneryConstants } from '../../scenery/js/imports.js';
import multiSelectionSoundPlayerFactory from '../../tambo/js/multiSelectionSoundPlayerFactory.js';
import Tandem from '../../tandem/js/Tandem.js';
import AquaRadioButton from './AquaRadioButton.js';
import sun from './sun.js';
import Emitter from '../../axon/js/Emitter.js';
import { getGroupItemNodes } from './GroupItemOptions.js';

// pdom - An id for each instance of AquaRadioButtonGroup, passed to individual buttons in the group.
// Each button in a radio button group must have the same "name" attribute to be considered in a group, otherwise
// arrow keys will navigate all radio type inputs in the document.
let instanceCount = 0;

// to prefix instanceCount in case there are different kinds of "groups"
const CLASS_NAME = 'AquaRadioButtonGroup';
// additional options that are common to 'group items'

export default class AquaRadioButtonGroup extends FlowBox {
  onInputEmitter = new Emitter();
  constructor(property, items, providedOptions) {
    instanceCount++;
    const options = optionize()({
      // AquaRadioButtonGroupOptions
      touchAreaXDilation: 0,
      touchAreaYDilation: 0,
      mouseAreaXDilation: 0,
      mouseAreaYDilation: 0,
      // FlowBoxOptions
      orientation: 'vertical',
      // Aqua radio buttons are typically vertical, rarely horizontal
      spacing: 3,
      // space between each button, perpendicular to options.orientation
      stretch: true,
      disabledOpacity: SceneryConstants.DISABLED_OPACITY,
      // phet-io
      tandem: Tandem.REQUIRED,
      tandemNameSuffix: 'RadioButtonGroup',
      visiblePropertyOptions: {
        phetioFeatured: true
      },
      phetioEnabledPropertyInstrumented: true,
      // opt into default PhET-iO instrumented enabledProperty

      // pdom
      tagName: 'ul',
      labelTagName: 'h3',
      ariaRole: 'radiogroup',
      groupFocusHighlight: true
    }, providedOptions);
    const nodes = getGroupItemNodes(items, options.tandem);

    // Default to a left alignment for vertical layout
    if (options.orientation === 'vertical') {
      options.align = options.align || 'left';
    }

    // Create a radio button for each item
    const radioButtons = items.map((item, index) => {
      // @ts-expect-error - runtime check to prevent prior pattern, see https://github.com/phetsims/sun/issues/794
      assert && assert(!item.tandem, 'Cannot specify tandem any more');
      const node = nodes[index];
      assert && assert(!node.hasPDOMContent, 'Accessibility is provided by AquaRadioButton and AquaRadioButtonGroupItem.labelContent. ' + 'Additional PDOM content in the provided Node could break accessibility.');
      return new AquaRadioButton(property, item.value, node, combineOptions({
        a11yNameAttribute: CLASS_NAME + instanceCount,
        labelContent: item.labelContent || null,
        soundPlayer: multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(index),
        tandem: item.tandemName ? options.tandem.createTandem(item.tandemName) : options.tandem === Tandem.OPT_OUT ? Tandem.OPT_OUT : Tandem.REQUIRED,
        touchAreaXDilation: options.touchAreaXDilation,
        touchAreaYDilation: options.orientation === 'vertical' ? options.spacing / 2 : options.touchAreaYDilation,
        mouseAreaXDilation: options.mouseAreaXDilation,
        mouseAreaYDilation: options.orientation === 'vertical' ? options.spacing / 2 : options.mouseAreaYDilation
      }, options.radioButtonOptions, item.options));
    });
    options.children = radioButtons;
    super(options);

    // pdom - this node's primary sibling is aria-labelledby its own label so the label content is read whenever
    // a member of the group receives focus
    this.addAriaLabelledbyAssociation({
      thisElementName: PDOMPeer.PRIMARY_SIBLING,
      otherNode: this,
      otherElementName: PDOMPeer.LABEL_SIBLING
    });

    // zoom - signify that key input is reserved and we should not pan when user presses arrow keys
    // See https://github.com/phetsims/scenery/issues/974
    const intentListener = {
      keydown: event => event.pointer.reserveForKeyboardDrag()
    };
    this.addInputListener(intentListener);
    const boundOnRadioButtonInput = this.onRadioButtonInput.bind(this);
    for (let i = 0; i < radioButtons.length; i++) {
      const radioButton = radioButtons[i];
      radioButton.onInputEmitter.addListener(boundOnRadioButtonInput);
    }

    // Add linked element after the radio button is instrumented
    this.addLinkedElement(property, {
      tandem: options.tandem.createTandem('property')
    });
    this.disposeAquaRadioButtonGroup = () => {
      this.removeInputListener(intentListener);
      radioButtons.forEach(radioButton => radioButton.dispose());
      this.onInputEmitter.dispose();
      nodes.forEach(node => node.dispose());
    };
    this.radioButtons = radioButtons;
  }
  onRadioButtonInput() {
    this.onInputEmitter.emit();
  }
  dispose() {
    this.disposeAquaRadioButtonGroup();
    super.dispose();
  }

  /**
   * Gets the radio button that corresponds to the specified value.
   */
  getButton(value) {
    const button = _.find(this.radioButtons, radioButton => radioButton.value === value);
    assert && assert(button, `no radio button found for value ${value}`);
    return button;
  }
}
sun.register('AquaRadioButtonGroup', AquaRadioButtonGroup);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJvcHRpb25pemUiLCJjb21iaW5lT3B0aW9ucyIsIkZsb3dCb3giLCJQRE9NUGVlciIsIlNjZW5lcnlDb25zdGFudHMiLCJtdWx0aVNlbGVjdGlvblNvdW5kUGxheWVyRmFjdG9yeSIsIlRhbmRlbSIsIkFxdWFSYWRpb0J1dHRvbiIsInN1biIsIkVtaXR0ZXIiLCJnZXRHcm91cEl0ZW1Ob2RlcyIsImluc3RhbmNlQ291bnQiLCJDTEFTU19OQU1FIiwiQXF1YVJhZGlvQnV0dG9uR3JvdXAiLCJvbklucHV0RW1pdHRlciIsImNvbnN0cnVjdG9yIiwicHJvcGVydHkiLCJpdGVtcyIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ0b3VjaEFyZWFYRGlsYXRpb24iLCJ0b3VjaEFyZWFZRGlsYXRpb24iLCJtb3VzZUFyZWFYRGlsYXRpb24iLCJtb3VzZUFyZWFZRGlsYXRpb24iLCJvcmllbnRhdGlvbiIsInNwYWNpbmciLCJzdHJldGNoIiwiZGlzYWJsZWRPcGFjaXR5IiwiRElTQUJMRURfT1BBQ0lUWSIsInRhbmRlbSIsIlJFUVVJUkVEIiwidGFuZGVtTmFtZVN1ZmZpeCIsInZpc2libGVQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9GZWF0dXJlZCIsInBoZXRpb0VuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZCIsInRhZ05hbWUiLCJsYWJlbFRhZ05hbWUiLCJhcmlhUm9sZSIsImdyb3VwRm9jdXNIaWdobGlnaHQiLCJub2RlcyIsImFsaWduIiwicmFkaW9CdXR0b25zIiwibWFwIiwiaXRlbSIsImluZGV4IiwiYXNzZXJ0Iiwibm9kZSIsImhhc1BET01Db250ZW50IiwidmFsdWUiLCJhMTF5TmFtZUF0dHJpYnV0ZSIsImxhYmVsQ29udGVudCIsInNvdW5kUGxheWVyIiwiZ2V0U2VsZWN0aW9uU291bmRQbGF5ZXIiLCJ0YW5kZW1OYW1lIiwiY3JlYXRlVGFuZGVtIiwiT1BUX09VVCIsInJhZGlvQnV0dG9uT3B0aW9ucyIsImNoaWxkcmVuIiwiYWRkQXJpYUxhYmVsbGVkYnlBc3NvY2lhdGlvbiIsInRoaXNFbGVtZW50TmFtZSIsIlBSSU1BUllfU0lCTElORyIsIm90aGVyTm9kZSIsIm90aGVyRWxlbWVudE5hbWUiLCJMQUJFTF9TSUJMSU5HIiwiaW50ZW50TGlzdGVuZXIiLCJrZXlkb3duIiwiZXZlbnQiLCJwb2ludGVyIiwicmVzZXJ2ZUZvcktleWJvYXJkRHJhZyIsImFkZElucHV0TGlzdGVuZXIiLCJib3VuZE9uUmFkaW9CdXR0b25JbnB1dCIsIm9uUmFkaW9CdXR0b25JbnB1dCIsImJpbmQiLCJpIiwibGVuZ3RoIiwicmFkaW9CdXR0b24iLCJhZGRMaXN0ZW5lciIsImFkZExpbmtlZEVsZW1lbnQiLCJkaXNwb3NlQXF1YVJhZGlvQnV0dG9uR3JvdXAiLCJyZW1vdmVJbnB1dExpc3RlbmVyIiwiZm9yRWFjaCIsImRpc3Bvc2UiLCJlbWl0IiwiZ2V0QnV0dG9uIiwiYnV0dG9uIiwiXyIsImZpbmQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkFxdWFSYWRpb0J1dHRvbkdyb3VwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDEzLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEFxdWFSYWRpb0J1dHRvbkdyb3VwIGNyZWF0ZXMgYSBncm91cCBvZiBBcXVhUmFkaW9CdXR0b25zIGFuZCBtYW5hZ2VzIHRoZWlyIGxheW91dC5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgY29tYmluZU9wdGlvbnMgfSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IHsgRmxvd0JveCwgRmxvd0JveE9wdGlvbnMsIFBET01QZWVyLCBTY2VuZXJ5Q29uc3RhbnRzLCBTY2VuZXJ5RXZlbnQgfSBmcm9tICcuLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbXVsdGlTZWxlY3Rpb25Tb3VuZFBsYXllckZhY3RvcnkgZnJvbSAnLi4vLi4vdGFtYm8vanMvbXVsdGlTZWxlY3Rpb25Tb3VuZFBsYXllckZhY3RvcnkuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgQXF1YVJhZGlvQnV0dG9uLCB7IEFxdWFSYWRpb0J1dHRvbk9wdGlvbnMgfSBmcm9tICcuL0FxdWFSYWRpb0J1dHRvbi5qcyc7XHJcbmltcG9ydCBzdW4gZnJvbSAnLi9zdW4uanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBFbWl0dGVyIGZyb20gJy4uLy4uL2F4b24vanMvRW1pdHRlci5qcyc7XHJcbmltcG9ydCBURW1pdHRlciBmcm9tICcuLi8uLi9heG9uL2pzL1RFbWl0dGVyLmpzJztcclxuaW1wb3J0IEdyb3VwSXRlbU9wdGlvbnMsIHsgZ2V0R3JvdXBJdGVtTm9kZXMgfSBmcm9tICcuL0dyb3VwSXRlbU9wdGlvbnMuanMnO1xyXG5cclxuLy8gcGRvbSAtIEFuIGlkIGZvciBlYWNoIGluc3RhbmNlIG9mIEFxdWFSYWRpb0J1dHRvbkdyb3VwLCBwYXNzZWQgdG8gaW5kaXZpZHVhbCBidXR0b25zIGluIHRoZSBncm91cC5cclxuLy8gRWFjaCBidXR0b24gaW4gYSByYWRpbyBidXR0b24gZ3JvdXAgbXVzdCBoYXZlIHRoZSBzYW1lIFwibmFtZVwiIGF0dHJpYnV0ZSB0byBiZSBjb25zaWRlcmVkIGluIGEgZ3JvdXAsIG90aGVyd2lzZVxyXG4vLyBhcnJvdyBrZXlzIHdpbGwgbmF2aWdhdGUgYWxsIHJhZGlvIHR5cGUgaW5wdXRzIGluIHRoZSBkb2N1bWVudC5cclxubGV0IGluc3RhbmNlQ291bnQgPSAwO1xyXG5cclxuLy8gdG8gcHJlZml4IGluc3RhbmNlQ291bnQgaW4gY2FzZSB0aGVyZSBhcmUgZGlmZmVyZW50IGtpbmRzIG9mIFwiZ3JvdXBzXCJcclxuY29uc3QgQ0xBU1NfTkFNRSA9ICdBcXVhUmFkaW9CdXR0b25Hcm91cCc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyBvcHRpb25zIHByb3BhZ2F0ZWQgdG8gQXF1YVJhZGlvQnV0dG9uIGluc3RhbmNlc1xyXG4gIHJhZGlvQnV0dG9uT3B0aW9ucz86IFN0cmljdE9taXQ8QXF1YVJhZGlvQnV0dG9uT3B0aW9ucywgJ2ExMXlOYW1lQXR0cmlidXRlJyB8ICdsYWJlbENvbnRlbnQnIHwgJ3NvdW5kUGxheWVyJyB8ICd0YW5kZW0nPjtcclxuXHJcbiAgLy8gRGlsYXRpb24gb2YgcG9pbnRlciBhcmVhcyBmb3IgZWFjaCByYWRpbyBidXR0b24uXHJcbiAgLy8gWCBkaWxhdGlvbiBpcyBpZ25vcmVkIGZvciBvcmllbnRhdGlvbiA9PT0gJ2hvcml6b250YWwnLlxyXG4gIC8vIFkgZGlsYXRpb24gaXMgaWdub3JlZCBmb3Igb3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcuXHJcbiAgdG91Y2hBcmVhWERpbGF0aW9uPzogbnVtYmVyO1xyXG4gIHRvdWNoQXJlYVlEaWxhdGlvbj86IG51bWJlcjtcclxuICBtb3VzZUFyZWFYRGlsYXRpb24/OiBudW1iZXI7XHJcbiAgbW91c2VBcmVhWURpbGF0aW9uPzogbnVtYmVyO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgQXF1YVJhZGlvQnV0dG9uR3JvdXBPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PEZsb3dCb3hPcHRpb25zLCAnY2hpbGRyZW4nPjtcclxuXHJcbmV4cG9ydCB0eXBlIEFxdWFSYWRpb0J1dHRvbkdyb3VwSXRlbTxUPiA9IHtcclxuICB2YWx1ZTogVDsgLy8gdmFsdWUgYXNzb2NpYXRlZCB3aXRoIHRoZSBidXR0b25cclxuICBsYWJlbENvbnRlbnQ/OiBzdHJpbmc7IC8vIGxhYmVsIGZvciBhMTF5XHJcbiAgb3B0aW9ucz86IFN0cmljdE9taXQ8QXF1YVJhZGlvQnV0dG9uT3B0aW9ucywgJ3RhbmRlbSc+OyAvLyBvcHRpb25zIHBhc3NlZCB0byBBcXVhUmFkaW9CdXR0b24gY29uc3RydWN0b3JcclxufSAmIEdyb3VwSXRlbU9wdGlvbnM7IC8vIGFkZGl0aW9uYWwgb3B0aW9ucyB0aGF0IGFyZSBjb21tb24gdG8gJ2dyb3VwIGl0ZW1zJ1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXF1YVJhZGlvQnV0dG9uR3JvdXA8VD4gZXh0ZW5kcyBGbG93Qm94IHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSByYWRpb0J1dHRvbnM6IEFxdWFSYWRpb0J1dHRvbjxUPltdO1xyXG4gIHB1YmxpYyByZWFkb25seSBvbklucHV0RW1pdHRlcjogVEVtaXR0ZXIgPSBuZXcgRW1pdHRlcigpO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZUFxdWFSYWRpb0J1dHRvbkdyb3VwOiAoKSA9PiB2b2lkO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3BlcnR5OiBQcm9wZXJ0eTxUPiwgaXRlbXM6IEFxdWFSYWRpb0J1dHRvbkdyb3VwSXRlbTxUPltdLCBwcm92aWRlZE9wdGlvbnM/OiBBcXVhUmFkaW9CdXR0b25Hcm91cE9wdGlvbnMgKSB7XHJcblxyXG4gICAgaW5zdGFuY2VDb3VudCsrO1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8QXF1YVJhZGlvQnV0dG9uR3JvdXBPcHRpb25zLCBTdHJpY3RPbWl0PFNlbGZPcHRpb25zLCAncmFkaW9CdXR0b25PcHRpb25zJz4sIEZsb3dCb3hPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBBcXVhUmFkaW9CdXR0b25Hcm91cE9wdGlvbnNcclxuICAgICAgdG91Y2hBcmVhWERpbGF0aW9uOiAwLFxyXG4gICAgICB0b3VjaEFyZWFZRGlsYXRpb246IDAsXHJcbiAgICAgIG1vdXNlQXJlYVhEaWxhdGlvbjogMCxcclxuICAgICAgbW91c2VBcmVhWURpbGF0aW9uOiAwLFxyXG5cclxuICAgICAgLy8gRmxvd0JveE9wdGlvbnNcclxuICAgICAgb3JpZW50YXRpb246ICd2ZXJ0aWNhbCcsIC8vIEFxdWEgcmFkaW8gYnV0dG9ucyBhcmUgdHlwaWNhbGx5IHZlcnRpY2FsLCByYXJlbHkgaG9yaXpvbnRhbFxyXG4gICAgICBzcGFjaW5nOiAzLCAvLyBzcGFjZSBiZXR3ZWVuIGVhY2ggYnV0dG9uLCBwZXJwZW5kaWN1bGFyIHRvIG9wdGlvbnMub3JpZW50YXRpb25cclxuICAgICAgc3RyZXRjaDogdHJ1ZSxcclxuICAgICAgZGlzYWJsZWRPcGFjaXR5OiBTY2VuZXJ5Q29uc3RhbnRzLkRJU0FCTEVEX09QQUNJVFksXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVELFxyXG4gICAgICB0YW5kZW1OYW1lU3VmZml4OiAnUmFkaW9CdXR0b25Hcm91cCcsXHJcbiAgICAgIHZpc2libGVQcm9wZXJ0eU9wdGlvbnM6IHsgcGhldGlvRmVhdHVyZWQ6IHRydWUgfSxcclxuICAgICAgcGhldGlvRW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkOiB0cnVlLCAvLyBvcHQgaW50byBkZWZhdWx0IFBoRVQtaU8gaW5zdHJ1bWVudGVkIGVuYWJsZWRQcm9wZXJ0eVxyXG5cclxuICAgICAgLy8gcGRvbVxyXG4gICAgICB0YWdOYW1lOiAndWwnLFxyXG4gICAgICBsYWJlbFRhZ05hbWU6ICdoMycsXHJcbiAgICAgIGFyaWFSb2xlOiAncmFkaW9ncm91cCcsXHJcbiAgICAgIGdyb3VwRm9jdXNIaWdobGlnaHQ6IHRydWVcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IG5vZGVzID0gZ2V0R3JvdXBJdGVtTm9kZXMoIGl0ZW1zLCBvcHRpb25zLnRhbmRlbSApO1xyXG5cclxuICAgIC8vIERlZmF1bHQgdG8gYSBsZWZ0IGFsaWdubWVudCBmb3IgdmVydGljYWwgbGF5b3V0XHJcbiAgICBpZiAoIG9wdGlvbnMub3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcgKSB7XHJcbiAgICAgIG9wdGlvbnMuYWxpZ24gPSBvcHRpb25zLmFsaWduIHx8ICdsZWZ0JztcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgYSByYWRpbyBidXR0b24gZm9yIGVhY2ggaXRlbVxyXG4gICAgY29uc3QgcmFkaW9CdXR0b25zID0gaXRlbXMubWFwKCAoIGl0ZW0sIGluZGV4ICkgPT4ge1xyXG5cclxuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIHJ1bnRpbWUgY2hlY2sgdG8gcHJldmVudCBwcmlvciBwYXR0ZXJuLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3N1bi9pc3N1ZXMvNzk0XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoICFpdGVtLnRhbmRlbSwgJ0Nhbm5vdCBzcGVjaWZ5IHRhbmRlbSBhbnkgbW9yZScgKTtcclxuXHJcbiAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1sgaW5kZXggXTtcclxuXHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoICFub2RlLmhhc1BET01Db250ZW50LFxyXG4gICAgICAgICdBY2Nlc3NpYmlsaXR5IGlzIHByb3ZpZGVkIGJ5IEFxdWFSYWRpb0J1dHRvbiBhbmQgQXF1YVJhZGlvQnV0dG9uR3JvdXBJdGVtLmxhYmVsQ29udGVudC4gJyArXHJcbiAgICAgICAgJ0FkZGl0aW9uYWwgUERPTSBjb250ZW50IGluIHRoZSBwcm92aWRlZCBOb2RlIGNvdWxkIGJyZWFrIGFjY2Vzc2liaWxpdHkuJyApO1xyXG5cclxuICAgICAgcmV0dXJuIG5ldyBBcXVhUmFkaW9CdXR0b24oIHByb3BlcnR5LCBpdGVtLnZhbHVlLCBub2RlLFxyXG4gICAgICAgIGNvbWJpbmVPcHRpb25zPEFxdWFSYWRpb0J1dHRvbk9wdGlvbnM+KCB7XHJcbiAgICAgICAgICBhMTF5TmFtZUF0dHJpYnV0ZTogQ0xBU1NfTkFNRSArIGluc3RhbmNlQ291bnQsXHJcbiAgICAgICAgICBsYWJlbENvbnRlbnQ6IGl0ZW0ubGFiZWxDb250ZW50IHx8IG51bGwsXHJcbiAgICAgICAgICBzb3VuZFBsYXllcjogbXVsdGlTZWxlY3Rpb25Tb3VuZFBsYXllckZhY3RvcnkuZ2V0U2VsZWN0aW9uU291bmRQbGF5ZXIoIGluZGV4ICksXHJcbiAgICAgICAgICB0YW5kZW06IGl0ZW0udGFuZGVtTmFtZSA/IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggaXRlbS50YW5kZW1OYW1lICkgOlxyXG4gICAgICAgICAgICAgICAgICBvcHRpb25zLnRhbmRlbSA9PT0gVGFuZGVtLk9QVF9PVVQgPyBUYW5kZW0uT1BUX09VVCA6XHJcbiAgICAgICAgICAgICAgICAgIFRhbmRlbS5SRVFVSVJFRCxcclxuICAgICAgICAgIHRvdWNoQXJlYVhEaWxhdGlvbjogb3B0aW9ucy50b3VjaEFyZWFYRGlsYXRpb24sXHJcbiAgICAgICAgICB0b3VjaEFyZWFZRGlsYXRpb246IG9wdGlvbnMub3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcgPyBvcHRpb25zLnNwYWNpbmcgLyAyIDogb3B0aW9ucy50b3VjaEFyZWFZRGlsYXRpb24sXHJcbiAgICAgICAgICBtb3VzZUFyZWFYRGlsYXRpb246IG9wdGlvbnMubW91c2VBcmVhWERpbGF0aW9uLFxyXG4gICAgICAgICAgbW91c2VBcmVhWURpbGF0aW9uOiBvcHRpb25zLm9yaWVudGF0aW9uID09PSAndmVydGljYWwnID8gb3B0aW9ucy5zcGFjaW5nIC8gMiA6IG9wdGlvbnMubW91c2VBcmVhWURpbGF0aW9uXHJcbiAgICAgICAgfSwgb3B0aW9ucy5yYWRpb0J1dHRvbk9wdGlvbnMsIGl0ZW0ub3B0aW9ucyApICk7XHJcbiAgICB9ICk7XHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gcmFkaW9CdXR0b25zO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gcGRvbSAtIHRoaXMgbm9kZSdzIHByaW1hcnkgc2libGluZyBpcyBhcmlhLWxhYmVsbGVkYnkgaXRzIG93biBsYWJlbCBzbyB0aGUgbGFiZWwgY29udGVudCBpcyByZWFkIHdoZW5ldmVyXHJcbiAgICAvLyBhIG1lbWJlciBvZiB0aGUgZ3JvdXAgcmVjZWl2ZXMgZm9jdXNcclxuICAgIHRoaXMuYWRkQXJpYUxhYmVsbGVkYnlBc3NvY2lhdGlvbigge1xyXG4gICAgICB0aGlzRWxlbWVudE5hbWU6IFBET01QZWVyLlBSSU1BUllfU0lCTElORyxcclxuICAgICAgb3RoZXJOb2RlOiB0aGlzLFxyXG4gICAgICBvdGhlckVsZW1lbnROYW1lOiBQRE9NUGVlci5MQUJFTF9TSUJMSU5HXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gem9vbSAtIHNpZ25pZnkgdGhhdCBrZXkgaW5wdXQgaXMgcmVzZXJ2ZWQgYW5kIHdlIHNob3VsZCBub3QgcGFuIHdoZW4gdXNlciBwcmVzc2VzIGFycm93IGtleXNcclxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS9pc3N1ZXMvOTc0XHJcbiAgICBjb25zdCBpbnRlbnRMaXN0ZW5lciA9IHsga2V5ZG93bjogKCBldmVudDogU2NlbmVyeUV2ZW50PEtleWJvYXJkRXZlbnQ+ICkgPT4gZXZlbnQucG9pbnRlci5yZXNlcnZlRm9yS2V5Ym9hcmREcmFnKCkgfTtcclxuICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggaW50ZW50TGlzdGVuZXIgKTtcclxuXHJcbiAgICBjb25zdCBib3VuZE9uUmFkaW9CdXR0b25JbnB1dCA9IHRoaXMub25SYWRpb0J1dHRvbklucHV0LmJpbmQoIHRoaXMgKTtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHJhZGlvQnV0dG9ucy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgY29uc3QgcmFkaW9CdXR0b24gPSByYWRpb0J1dHRvbnNbIGkgXTtcclxuICAgICAgcmFkaW9CdXR0b24ub25JbnB1dEVtaXR0ZXIuYWRkTGlzdGVuZXIoIGJvdW5kT25SYWRpb0J1dHRvbklucHV0ICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQWRkIGxpbmtlZCBlbGVtZW50IGFmdGVyIHRoZSByYWRpbyBidXR0b24gaXMgaW5zdHJ1bWVudGVkXHJcbiAgICB0aGlzLmFkZExpbmtlZEVsZW1lbnQoIHByb3BlcnR5LCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncHJvcGVydHknIClcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VBcXVhUmFkaW9CdXR0b25Hcm91cCA9ICgpID0+IHtcclxuICAgICAgdGhpcy5yZW1vdmVJbnB1dExpc3RlbmVyKCBpbnRlbnRMaXN0ZW5lciApO1xyXG4gICAgICByYWRpb0J1dHRvbnMuZm9yRWFjaCggcmFkaW9CdXR0b24gPT4gcmFkaW9CdXR0b24uZGlzcG9zZSgpICk7XHJcbiAgICAgIHRoaXMub25JbnB1dEVtaXR0ZXIuZGlzcG9zZSgpO1xyXG4gICAgICBub2Rlcy5mb3JFYWNoKCBub2RlID0+IG5vZGUuZGlzcG9zZSgpICk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucmFkaW9CdXR0b25zID0gcmFkaW9CdXR0b25zO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvblJhZGlvQnV0dG9uSW5wdXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLm9uSW5wdXRFbWl0dGVyLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNwb3NlQXF1YVJhZGlvQnV0dG9uR3JvdXAoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIHJhZGlvIGJ1dHRvbiB0aGF0IGNvcnJlc3BvbmRzIHRvIHRoZSBzcGVjaWZpZWQgdmFsdWUuXHJcbiAgICovXHJcbiAgcHVibGljIGdldEJ1dHRvbiggdmFsdWU6IFQgKTogQXF1YVJhZGlvQnV0dG9uPFQ+IHtcclxuICAgIGNvbnN0IGJ1dHRvbiA9IF8uZmluZCggdGhpcy5yYWRpb0J1dHRvbnMsICggcmFkaW9CdXR0b246IEFxdWFSYWRpb0J1dHRvbjxUPiApID0+IHJhZGlvQnV0dG9uLnZhbHVlID09PSB2YWx1ZSApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggYnV0dG9uLCBgbm8gcmFkaW8gYnV0dG9uIGZvdW5kIGZvciB2YWx1ZSAke3ZhbHVlfWAgKTtcclxuICAgIHJldHVybiBidXR0b24hO1xyXG4gIH1cclxufVxyXG5cclxuc3VuLnJlZ2lzdGVyKCAnQXF1YVJhZGlvQnV0dG9uR3JvdXAnLCBBcXVhUmFkaW9CdXR0b25Hcm91cCApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFHQSxPQUFPQSxTQUFTLElBQUlDLGNBQWMsUUFBUSxpQ0FBaUM7QUFDM0UsU0FBU0MsT0FBTyxFQUFrQkMsUUFBUSxFQUFFQyxnQkFBZ0IsUUFBc0IsNkJBQTZCO0FBQy9HLE9BQU9DLGdDQUFnQyxNQUFNLG9EQUFvRDtBQUNqRyxPQUFPQyxNQUFNLE1BQU0sMkJBQTJCO0FBQzlDLE9BQU9DLGVBQWUsTUFBa0Msc0JBQXNCO0FBQzlFLE9BQU9DLEdBQUcsTUFBTSxVQUFVO0FBRTFCLE9BQU9DLE9BQU8sTUFBTSwwQkFBMEI7QUFFOUMsU0FBMkJDLGlCQUFpQixRQUFRLHVCQUF1Qjs7QUFFM0U7QUFDQTtBQUNBO0FBQ0EsSUFBSUMsYUFBYSxHQUFHLENBQUM7O0FBRXJCO0FBQ0EsTUFBTUMsVUFBVSxHQUFHLHNCQUFzQjtBQXNCbkI7O0FBRXRCLGVBQWUsTUFBTUMsb0JBQW9CLFNBQVlYLE9BQU8sQ0FBQztFQUczQ1ksY0FBYyxHQUFhLElBQUlMLE9BQU8sQ0FBQyxDQUFDO0VBR2pETSxXQUFXQSxDQUFFQyxRQUFxQixFQUFFQyxLQUFvQyxFQUFFQyxlQUE2QyxFQUFHO0lBRS9IUCxhQUFhLEVBQUU7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