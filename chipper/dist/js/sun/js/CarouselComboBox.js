// Copyright 2021-2023, University of Colorado Boulder

/**
 * CarouselComboBox behaves like a combo box, but its listbox is a carousel. This allows you to scroll through a
 * long list of items, a feature that ComboBoxListBox does not support. ComboBoxItem, ComboBoxButton, and
 * Carousel are reused.
 *
 * THINK TWICE BEFORE USING THIS IN A SIM!
 * CarouselComboBox was created as a quick way to address situations where ComboBox's listbox gets too long,
 * for example https://github.com/phetsims/sun/issues/673. This tends to happen in internal 'demo' applications
 * (sun, scenery-phet,... ) that have long lists of demos. And as a design best-practice, PhET tends to avoid
 * longs lists of things in sims. So if you find yourself reaching for CarouselComboBox, consider whether a
 * different UI component might provide a better UX.
 *
 * Possible future work:
 * - Modify ComboBox so that it can use different types of popups (ComboBoxListBox, Carousel,...), or
 * - Make CarouselComboBox pop up the Carousel in front of everything else
 * - a11y support in CarouselComboBox
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Multilink from '../../axon/js/Multilink.js';
import Dimension2 from '../../dot/js/Dimension2.js';
import dotRandom from '../../dot/js/dotRandom.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import { AlignBox, AlignGroup, Color, HBox, Node, PressListener, Rectangle, VBox, WidthSizable } from '../../scenery/js/imports.js';
import Tandem from '../../tandem/js/Tandem.js';
import Carousel from './Carousel.js';
import ComboBoxButton from './ComboBoxButton.js';
import PageControl from './PageControl.js';
import sun from './sun.js';
import { getGroupItemNodes } from './GroupItemOptions.js';
export default class CarouselComboBox extends WidthSizable(Node) {
  /**
   * @param property - the Property that is set when an item is selected
   * @param comboBoxItems - the items that appear in the carousel
   * @param providedOptions
   */
  constructor(property, comboBoxItems, providedOptions) {
    const options = optionize()({
      itemNodeOptions: {
        align: 'left',
        // {string} alignment of item nodes on backgrounds, 'left'|'center'|'right'
        overColor: Color.grayColor(245),
        // {ColorDef} background color of the item that the pointer is over
        selectedColor: 'yellow',
        // {ColorDef} background color of the selected item
        xMargin: 6,
        // {number} x margin for backgrounds on the items in the carousel
        yMargin: 2 // {number} y margin for backgrounds on the items in the carousel
      },

      carouselOptions: {
        buttonOptions: {
          arrowSize: new Dimension2(20, 4)
        },
        // Like ComboBox, 'vertical' is the only orientation supported (verified below).
        orientation: 'vertical',
        // Spacing and margins will be built into the backgrounds that are add to the item Nodes,
        // so set them to zero for the carousel.
        spacing: 0,
        margin: 0,
        // {number} If there are fewer items than this in the carousel, the actual number of items will be used.
        itemsPerPage: 15
      },
      pageControlOptions: {
        interactive: true
      },
      buttonOptions: {
        arrowDirection: 'down',
        // 'up' is not currently supported (verified below)
        baseColor: 'rgb( 218, 236, 255 )',
        xMargin: 6,
        // You'll typically want this to be the same as itemNodeOptions.xMargin, but we're not going to force you :)
        yMargin: 4
      },
      // phet-io
      tandem: Tandem.OPTIONAL
    }, providedOptions);

    // Validate options
    assert && assert(options.carouselOptions.orientation === 'vertical', 'orientation must be vertical');
    assert && assert(options.buttonOptions.arrowDirection === 'down', 'arrowDirection must be down');

    // Don't create pages that are longer than the number of items
    options.carouselOptions.itemsPerPage = Math.min(options.carouselOptions.itemsPerPage, comboBoxItems.length);

    // Create tandems for subcomponents, if they were not provided
    options.carouselOptions.tandem = options.carouselOptions.tandem || options.tandem.createTandem('carousel');
    options.buttonOptions.tandem = options.buttonOptions.tandem || options.tandem.createTandem('button');
    super();

    // Make items in the carousel have the same width and height.
    const alignGroup = new AlignGroup();
    const contentNodes = getGroupItemNodes(comboBoxItems, options.tandem.createTandem('items'));

    // Create items for the carousel, whose API for 'items' is different than ComboBox.
    const carouselItemNodes = _.map(comboBoxItems, (comboBoxItem, i) => {
      return {
        createNode: () => new CarouselItemNode(property, comboBoxItem, contentNodes[i], alignGroup, options.itemNodeOptions)
      };
    });
    assert && assert(carouselItemNodes.length === comboBoxItems.length, 'expected a carouselItem for each comboBoxItem');
    const hBoxChildren = [];

    // Create the carousel.
    const carousel = new Carousel(carouselItemNodes, options.carouselOptions);
    hBoxChildren.push(carousel);

    // page control
    let pageControl = null;
    if (carousel.numberOfPagesProperty.value > 1) {
      pageControl = new PageControl(carousel.pageNumberProperty, carousel.numberOfPagesProperty, combineOptions({
        orientation: options.carouselOptions.orientation
      }, options.pageControlOptions));
      hBoxChildren.push(pageControl);
    }

    // pageControl to the left of carousel
    const carouselAndPageControl = new HBox({
      spacing: 4,
      children: hBoxChildren
    });

    // Pressing this button pops the carousel up and down
    const button = new ComboBoxButton(property, comboBoxItems, contentNodes, combineOptions({
      listener: () => {
        carouselAndPageControl.visible = !carouselAndPageControl.visible;
      },
      widthSizable: options.widthSizable,
      localPreferredWidthProperty: this.localPreferredWidthProperty,
      localMinimumWidthProperty: this.localMinimumWidthProperty
    }, options.buttonOptions));

    // Put the button above the carousel, left aligned.
    const vBox = new VBox({
      spacing: 0,
      align: 'left',
      children: [button, carouselAndPageControl]
    });

    // Wrap everything with Node, to hide VBox's API.
    options.children = [vBox];
    this.mutate(options);

    // If the Property changes, hide the carousel. unlink is needed on disposed.
    const propertyListener = () => {
      carouselAndPageControl.visible = false;
    };
    property.link(propertyListener);

    // Clicking outside this UI component will hide the carousel and page control.
    // NOTE: adapted from ComboBox.
    const clickToDismissListener = {
      down: event => {
        assert && assert(carousel.visible, 'this listener should be registered only when carousel is visible');

        // If fuzzing is enabled, exercise this listener some percentage of the time, so that this listener is tested.
        // The rest of the time, ignore this listener, so that the carousel remains popped up, and we test making
        // choices from the carousel. See https://github.com/phetsims/sun/issues/677
        if (!phet.chipper.isFuzzEnabled() || dotRandom.nextDouble() < 0.25) {
          const trail = event.trail;
          if (!trail.containsNode(button) && !trail.containsNode(carousel) && (!pageControl || !trail.containsNode(pageControl))) {
            carouselAndPageControl.visible = false;
          }
        }
      }
    };

    // Add clickToDismissListener only when the carousel & page control are visible. unlink is not needed.
    // NOTE: adapted from ComboBox.
    let display = null;
    carouselAndPageControl.visibleProperty.link(visible => {
      if (visible) {
        assert && assert(!display, 'unexpected display');
        display = this.getUniqueTrail().rootNode().getRootedDisplays()[0];
        display.addInputListener(clickToDismissListener);
      } else {
        if (display && display.hasInputListener(clickToDismissListener)) {
          display.removeInputListener(clickToDismissListener);
          display = null;
        }
      }
    });
    this.disposeCarouselComboBox = () => {
      // Deregister observers
      property.unlink(propertyListener);

      // Dispose of subcomponents
      button.dispose();
      pageControl && pageControl.dispose();
      carousel.dispose();
      contentNodes.forEach(node => node.dispose());
    };
  }
  dispose() {
    this.disposeCarouselComboBox();
    super.dispose();
  }
}
/**
 * CarouselItemNode is an item this UI component's carousel. Carousel and ComboBox have different APIs for 'items'.
 * This class adapts a ComboBoxItem by making the Node have uniform dimensions, and putting a background behind the
 * Node. The background changes color when the item is selected or the pointer is over the item.
 */
class CarouselItemNode extends Node {
  constructor(property, comboBoxItem, node, alignGroup, providedOptions) {
    const options = optionize()({
      // CarouselItemNodeSelfOptions
      align: 'left',
      xMargin: 6,
      yMargin: 2,
      overColor: Color.grayColor(245),
      selectedColor: 'yellow',
      // NodeOptions
      tandem: Tandem.OPTIONAL
    }, providedOptions);
    const uniformNode = new AlignBox(node, {
      xAlign: options.align,
      group: alignGroup
    });
    const backgroundNode = new Rectangle(0, 0, 1, 1);

    // Size backgroundNode to fit uniformNode. Note that uniformNode's bounds may change when additional Nodes are
    // added to alignGroup.
    uniformNode.boundsProperty.link(bounds => {
      backgroundNode.setRectBounds(bounds.dilatedXY(options.xMargin, options.yMargin));
    });
    options.children = [backgroundNode, uniformNode];
    super(options);

    // Press on an item to select its associated value.
    const pressListener = new PressListener({
      press: () => {
        property.value = comboBoxItem.value;
      },
      tandem: options.tandem.createTandem('pressListener')
    });
    this.addInputListener(pressListener);

    // Selecting an item sets its background to the selected color.
    // Pointer over an item sets its background to the highlighted color.
    // Must be disposed because we do not own property.
    const multilink = new Multilink([property, pressListener.isOverProperty], (propertyValue, isOver) => {
      if (propertyValue === comboBoxItem.value) {
        backgroundNode.fill = options.selectedColor;
      } else if (isOver) {
        backgroundNode.fill = options.overColor;
      } else {
        backgroundNode.fill = 'transparent';
      }
    });
    this.disposeCarouselItemNode = () => {
      multilink.dispose();
    };
  }
  dispose() {
    this.disposeCarouselItemNode();
    super.dispose();
  }
}
sun.register('CarouselComboBox', CarouselComboBox);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJEaW1lbnNpb24yIiwiZG90UmFuZG9tIiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJBbGlnbkJveCIsIkFsaWduR3JvdXAiLCJDb2xvciIsIkhCb3giLCJOb2RlIiwiUHJlc3NMaXN0ZW5lciIsIlJlY3RhbmdsZSIsIlZCb3giLCJXaWR0aFNpemFibGUiLCJUYW5kZW0iLCJDYXJvdXNlbCIsIkNvbWJvQm94QnV0dG9uIiwiUGFnZUNvbnRyb2wiLCJzdW4iLCJnZXRHcm91cEl0ZW1Ob2RlcyIsIkNhcm91c2VsQ29tYm9Cb3giLCJjb25zdHJ1Y3RvciIsInByb3BlcnR5IiwiY29tYm9Cb3hJdGVtcyIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJpdGVtTm9kZU9wdGlvbnMiLCJhbGlnbiIsIm92ZXJDb2xvciIsImdyYXlDb2xvciIsInNlbGVjdGVkQ29sb3IiLCJ4TWFyZ2luIiwieU1hcmdpbiIsImNhcm91c2VsT3B0aW9ucyIsImJ1dHRvbk9wdGlvbnMiLCJhcnJvd1NpemUiLCJvcmllbnRhdGlvbiIsInNwYWNpbmciLCJtYXJnaW4iLCJpdGVtc1BlclBhZ2UiLCJwYWdlQ29udHJvbE9wdGlvbnMiLCJpbnRlcmFjdGl2ZSIsImFycm93RGlyZWN0aW9uIiwiYmFzZUNvbG9yIiwidGFuZGVtIiwiT1BUSU9OQUwiLCJhc3NlcnQiLCJNYXRoIiwibWluIiwibGVuZ3RoIiwiY3JlYXRlVGFuZGVtIiwiYWxpZ25Hcm91cCIsImNvbnRlbnROb2RlcyIsImNhcm91c2VsSXRlbU5vZGVzIiwiXyIsIm1hcCIsImNvbWJvQm94SXRlbSIsImkiLCJjcmVhdGVOb2RlIiwiQ2Fyb3VzZWxJdGVtTm9kZSIsImhCb3hDaGlsZHJlbiIsImNhcm91c2VsIiwicHVzaCIsInBhZ2VDb250cm9sIiwibnVtYmVyT2ZQYWdlc1Byb3BlcnR5IiwidmFsdWUiLCJwYWdlTnVtYmVyUHJvcGVydHkiLCJjYXJvdXNlbEFuZFBhZ2VDb250cm9sIiwiY2hpbGRyZW4iLCJidXR0b24iLCJsaXN0ZW5lciIsInZpc2libGUiLCJ3aWR0aFNpemFibGUiLCJsb2NhbFByZWZlcnJlZFdpZHRoUHJvcGVydHkiLCJsb2NhbE1pbmltdW1XaWR0aFByb3BlcnR5IiwidkJveCIsIm11dGF0ZSIsInByb3BlcnR5TGlzdGVuZXIiLCJsaW5rIiwiY2xpY2tUb0Rpc21pc3NMaXN0ZW5lciIsImRvd24iLCJldmVudCIsInBoZXQiLCJjaGlwcGVyIiwiaXNGdXp6RW5hYmxlZCIsIm5leHREb3VibGUiLCJ0cmFpbCIsImNvbnRhaW5zTm9kZSIsImRpc3BsYXkiLCJ2aXNpYmxlUHJvcGVydHkiLCJnZXRVbmlxdWVUcmFpbCIsInJvb3ROb2RlIiwiZ2V0Um9vdGVkRGlzcGxheXMiLCJhZGRJbnB1dExpc3RlbmVyIiwiaGFzSW5wdXRMaXN0ZW5lciIsInJlbW92ZUlucHV0TGlzdGVuZXIiLCJkaXNwb3NlQ2Fyb3VzZWxDb21ib0JveCIsInVubGluayIsImRpc3Bvc2UiLCJmb3JFYWNoIiwibm9kZSIsInVuaWZvcm1Ob2RlIiwieEFsaWduIiwiZ3JvdXAiLCJiYWNrZ3JvdW5kTm9kZSIsImJvdW5kc1Byb3BlcnR5IiwiYm91bmRzIiwic2V0UmVjdEJvdW5kcyIsImRpbGF0ZWRYWSIsInByZXNzTGlzdGVuZXIiLCJwcmVzcyIsIm11bHRpbGluayIsImlzT3ZlclByb3BlcnR5IiwicHJvcGVydHlWYWx1ZSIsImlzT3ZlciIsImZpbGwiLCJkaXNwb3NlQ2Fyb3VzZWxJdGVtTm9kZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQ2Fyb3VzZWxDb21ib0JveC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBDYXJvdXNlbENvbWJvQm94IGJlaGF2ZXMgbGlrZSBhIGNvbWJvIGJveCwgYnV0IGl0cyBsaXN0Ym94IGlzIGEgY2Fyb3VzZWwuIFRoaXMgYWxsb3dzIHlvdSB0byBzY3JvbGwgdGhyb3VnaCBhXHJcbiAqIGxvbmcgbGlzdCBvZiBpdGVtcywgYSBmZWF0dXJlIHRoYXQgQ29tYm9Cb3hMaXN0Qm94IGRvZXMgbm90IHN1cHBvcnQuIENvbWJvQm94SXRlbSwgQ29tYm9Cb3hCdXR0b24sIGFuZFxyXG4gKiBDYXJvdXNlbCBhcmUgcmV1c2VkLlxyXG4gKlxyXG4gKiBUSElOSyBUV0lDRSBCRUZPUkUgVVNJTkcgVEhJUyBJTiBBIFNJTSFcclxuICogQ2Fyb3VzZWxDb21ib0JveCB3YXMgY3JlYXRlZCBhcyBhIHF1aWNrIHdheSB0byBhZGRyZXNzIHNpdHVhdGlvbnMgd2hlcmUgQ29tYm9Cb3gncyBsaXN0Ym94IGdldHMgdG9vIGxvbmcsXHJcbiAqIGZvciBleGFtcGxlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzY3My4gVGhpcyB0ZW5kcyB0byBoYXBwZW4gaW4gaW50ZXJuYWwgJ2RlbW8nIGFwcGxpY2F0aW9uc1xyXG4gKiAoc3VuLCBzY2VuZXJ5LXBoZXQsLi4uICkgdGhhdCBoYXZlIGxvbmcgbGlzdHMgb2YgZGVtb3MuIEFuZCBhcyBhIGRlc2lnbiBiZXN0LXByYWN0aWNlLCBQaEVUIHRlbmRzIHRvIGF2b2lkXHJcbiAqIGxvbmdzIGxpc3RzIG9mIHRoaW5ncyBpbiBzaW1zLiBTbyBpZiB5b3UgZmluZCB5b3Vyc2VsZiByZWFjaGluZyBmb3IgQ2Fyb3VzZWxDb21ib0JveCwgY29uc2lkZXIgd2hldGhlciBhXHJcbiAqIGRpZmZlcmVudCBVSSBjb21wb25lbnQgbWlnaHQgcHJvdmlkZSBhIGJldHRlciBVWC5cclxuICpcclxuICogUG9zc2libGUgZnV0dXJlIHdvcms6XHJcbiAqIC0gTW9kaWZ5IENvbWJvQm94IHNvIHRoYXQgaXQgY2FuIHVzZSBkaWZmZXJlbnQgdHlwZXMgb2YgcG9wdXBzIChDb21ib0JveExpc3RCb3gsIENhcm91c2VsLC4uLiksIG9yXHJcbiAqIC0gTWFrZSBDYXJvdXNlbENvbWJvQm94IHBvcCB1cCB0aGUgQ2Fyb3VzZWwgaW4gZnJvbnQgb2YgZXZlcnl0aGluZyBlbHNlXHJcbiAqIC0gYTExeSBzdXBwb3J0IGluIENhcm91c2VsQ29tYm9Cb3hcclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgVFByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvVFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFN0cmljdE9taXQgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1N0cmljdE9taXQuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IERpbWVuc2lvbjIgZnJvbSAnLi4vLi4vZG90L2pzL0RpbWVuc2lvbjIuanMnO1xyXG5pbXBvcnQgZG90UmFuZG9tIGZyb20gJy4uLy4uL2RvdC9qcy9kb3RSYW5kb20uanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCB7IEFsaWduQm94LCBBbGlnbkdyb3VwLCBDb2xvciwgRGlzcGxheSwgSEJveCwgTm9kZSwgTm9kZU9wdGlvbnMsIFByZXNzTGlzdGVuZXIsIFJlY3RhbmdsZSwgU2NlbmVyeUV2ZW50LCBUQ29sb3IsIFZCb3gsIFdpZHRoU2l6YWJsZSwgV2lkdGhTaXphYmxlT3B0aW9ucyB9IGZyb20gJy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBDYXJvdXNlbCwgeyBDYXJvdXNlbE9wdGlvbnMgfSBmcm9tICcuL0Nhcm91c2VsLmpzJztcclxuaW1wb3J0IENvbWJvQm94QnV0dG9uLCB7IENvbWJvQm94QnV0dG9uT3B0aW9ucyB9IGZyb20gJy4vQ29tYm9Cb3hCdXR0b24uanMnO1xyXG5pbXBvcnQgUGFnZUNvbnRyb2wsIHsgUGFnZUNvbnRyb2xPcHRpb25zIH0gZnJvbSAnLi9QYWdlQ29udHJvbC5qcyc7XHJcbmltcG9ydCBzdW4gZnJvbSAnLi9zdW4uanMnO1xyXG5pbXBvcnQgeyBDb21ib0JveEl0ZW0gfSBmcm9tICcuL0NvbWJvQm94LmpzJztcclxuaW1wb3J0IHsgZ2V0R3JvdXBJdGVtTm9kZXMgfSBmcm9tICcuL0dyb3VwSXRlbU9wdGlvbnMuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gTmVzdGVkIG9wdGlvbnMgcGFzc2VkIHRvIHN1YmNvbXBvbmVudHNcclxuICBpdGVtTm9kZU9wdGlvbnM/OiBDYXJvdXNlbEl0ZW1Ob2RlT3B0aW9ucztcclxuICBjYXJvdXNlbE9wdGlvbnM/OiBDYXJvdXNlbE9wdGlvbnM7XHJcbiAgcGFnZUNvbnRyb2xPcHRpb25zPzogU3RyaWN0T21pdDxQYWdlQ29udHJvbE9wdGlvbnMsICdvcmllbnRhdGlvbic+O1xyXG4gIGJ1dHRvbk9wdGlvbnM/OiBTdHJpY3RPbWl0PENvbWJvQm94QnV0dG9uT3B0aW9ucywgJ2NvbnRlbnQnIHwgJ2xpc3RlbmVyJz47XHJcbn07XHJcblxyXG50eXBlIFBhcmVudE9wdGlvbnMgPSBOb2RlT3B0aW9ucyAmIFdpZHRoU2l6YWJsZU9wdGlvbnM7XHJcbmV4cG9ydCB0eXBlIENhcm91c2VsQ29tYm9Cb3hPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PFBhcmVudE9wdGlvbnMsICdjaGlsZHJlbic+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2Fyb3VzZWxDb21ib0JveDxUPiBleHRlbmRzIFdpZHRoU2l6YWJsZSggTm9kZSApIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlQ2Fyb3VzZWxDb21ib0JveDogKCkgPT4gdm9pZDtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHByb3BlcnR5IC0gdGhlIFByb3BlcnR5IHRoYXQgaXMgc2V0IHdoZW4gYW4gaXRlbSBpcyBzZWxlY3RlZFxyXG4gICAqIEBwYXJhbSBjb21ib0JveEl0ZW1zIC0gdGhlIGl0ZW1zIHRoYXQgYXBwZWFyIGluIHRoZSBjYXJvdXNlbFxyXG4gICAqIEBwYXJhbSBwcm92aWRlZE9wdGlvbnNcclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3BlcnR5OiBUUHJvcGVydHk8VD4sIGNvbWJvQm94SXRlbXM6IENvbWJvQm94SXRlbTxUPltdLCBwcm92aWRlZE9wdGlvbnM/OiBDYXJvdXNlbENvbWJvQm94T3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPENhcm91c2VsQ29tYm9Cb3hPcHRpb25zLCBTZWxmT3B0aW9ucywgUGFyZW50T3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgaXRlbU5vZGVPcHRpb25zOiB7XHJcbiAgICAgICAgYWxpZ246ICdsZWZ0JywgLy8ge3N0cmluZ30gYWxpZ25tZW50IG9mIGl0ZW0gbm9kZXMgb24gYmFja2dyb3VuZHMsICdsZWZ0J3wnY2VudGVyJ3wncmlnaHQnXHJcbiAgICAgICAgb3ZlckNvbG9yOiBDb2xvci5ncmF5Q29sb3IoIDI0NSApLCAvLyB7Q29sb3JEZWZ9IGJhY2tncm91bmQgY29sb3Igb2YgdGhlIGl0ZW0gdGhhdCB0aGUgcG9pbnRlciBpcyBvdmVyXHJcbiAgICAgICAgc2VsZWN0ZWRDb2xvcjogJ3llbGxvdycsIC8vIHtDb2xvckRlZn0gYmFja2dyb3VuZCBjb2xvciBvZiB0aGUgc2VsZWN0ZWQgaXRlbVxyXG4gICAgICAgIHhNYXJnaW46IDYsIC8vIHtudW1iZXJ9IHggbWFyZ2luIGZvciBiYWNrZ3JvdW5kcyBvbiB0aGUgaXRlbXMgaW4gdGhlIGNhcm91c2VsXHJcbiAgICAgICAgeU1hcmdpbjogMiAvLyB7bnVtYmVyfSB5IG1hcmdpbiBmb3IgYmFja2dyb3VuZHMgb24gdGhlIGl0ZW1zIGluIHRoZSBjYXJvdXNlbFxyXG4gICAgICB9LFxyXG5cclxuICAgICAgY2Fyb3VzZWxPcHRpb25zOiB7XHJcbiAgICAgICAgYnV0dG9uT3B0aW9uczoge1xyXG4gICAgICAgICAgYXJyb3dTaXplOiBuZXcgRGltZW5zaW9uMiggMjAsIDQgKVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8vIExpa2UgQ29tYm9Cb3gsICd2ZXJ0aWNhbCcgaXMgdGhlIG9ubHkgb3JpZW50YXRpb24gc3VwcG9ydGVkICh2ZXJpZmllZCBiZWxvdykuXHJcbiAgICAgICAgb3JpZW50YXRpb246ICd2ZXJ0aWNhbCcsXHJcblxyXG4gICAgICAgIC8vIFNwYWNpbmcgYW5kIG1hcmdpbnMgd2lsbCBiZSBidWlsdCBpbnRvIHRoZSBiYWNrZ3JvdW5kcyB0aGF0IGFyZSBhZGQgdG8gdGhlIGl0ZW0gTm9kZXMsXHJcbiAgICAgICAgLy8gc28gc2V0IHRoZW0gdG8gemVybyBmb3IgdGhlIGNhcm91c2VsLlxyXG4gICAgICAgIHNwYWNpbmc6IDAsXHJcbiAgICAgICAgbWFyZ2luOiAwLFxyXG5cclxuICAgICAgICAvLyB7bnVtYmVyfSBJZiB0aGVyZSBhcmUgZmV3ZXIgaXRlbXMgdGhhbiB0aGlzIGluIHRoZSBjYXJvdXNlbCwgdGhlIGFjdHVhbCBudW1iZXIgb2YgaXRlbXMgd2lsbCBiZSB1c2VkLlxyXG4gICAgICAgIGl0ZW1zUGVyUGFnZTogMTVcclxuICAgICAgfSxcclxuXHJcbiAgICAgIHBhZ2VDb250cm9sT3B0aW9uczoge1xyXG4gICAgICAgIGludGVyYWN0aXZlOiB0cnVlXHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBidXR0b25PcHRpb25zOiB7XHJcbiAgICAgICAgYXJyb3dEaXJlY3Rpb246ICdkb3duJywgLy8gJ3VwJyBpcyBub3QgY3VycmVudGx5IHN1cHBvcnRlZCAodmVyaWZpZWQgYmVsb3cpXHJcbiAgICAgICAgYmFzZUNvbG9yOiAncmdiKCAyMTgsIDIzNiwgMjU1ICknLFxyXG4gICAgICAgIHhNYXJnaW46IDYsIC8vIFlvdSdsbCB0eXBpY2FsbHkgd2FudCB0aGlzIHRvIGJlIHRoZSBzYW1lIGFzIGl0ZW1Ob2RlT3B0aW9ucy54TWFyZ2luLCBidXQgd2UncmUgbm90IGdvaW5nIHRvIGZvcmNlIHlvdSA6KVxyXG4gICAgICAgIHlNYXJnaW46IDRcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIHBoZXQtaW9cclxuICAgICAgdGFuZGVtOiBUYW5kZW0uT1BUSU9OQUxcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIC8vIFZhbGlkYXRlIG9wdGlvbnNcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMuY2Fyb3VzZWxPcHRpb25zLm9yaWVudGF0aW9uID09PSAndmVydGljYWwnLCAnb3JpZW50YXRpb24gbXVzdCBiZSB2ZXJ0aWNhbCcgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMuYnV0dG9uT3B0aW9ucy5hcnJvd0RpcmVjdGlvbiA9PT0gJ2Rvd24nLCAnYXJyb3dEaXJlY3Rpb24gbXVzdCBiZSBkb3duJyApO1xyXG5cclxuICAgIC8vIERvbid0IGNyZWF0ZSBwYWdlcyB0aGF0IGFyZSBsb25nZXIgdGhhbiB0aGUgbnVtYmVyIG9mIGl0ZW1zXHJcbiAgICBvcHRpb25zLmNhcm91c2VsT3B0aW9ucy5pdGVtc1BlclBhZ2UgPSBNYXRoLm1pbiggb3B0aW9ucy5jYXJvdXNlbE9wdGlvbnMuaXRlbXNQZXJQYWdlISwgY29tYm9Cb3hJdGVtcy5sZW5ndGggKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGFuZGVtcyBmb3Igc3ViY29tcG9uZW50cywgaWYgdGhleSB3ZXJlIG5vdCBwcm92aWRlZFxyXG4gICAgb3B0aW9ucy5jYXJvdXNlbE9wdGlvbnMudGFuZGVtID0gb3B0aW9ucy5jYXJvdXNlbE9wdGlvbnMudGFuZGVtIHx8IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2Nhcm91c2VsJyApO1xyXG4gICAgb3B0aW9ucy5idXR0b25PcHRpb25zLnRhbmRlbSA9IG9wdGlvbnMuYnV0dG9uT3B0aW9ucy50YW5kZW0gfHwgb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnYnV0dG9uJyApO1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgLy8gTWFrZSBpdGVtcyBpbiB0aGUgY2Fyb3VzZWwgaGF2ZSB0aGUgc2FtZSB3aWR0aCBhbmQgaGVpZ2h0LlxyXG4gICAgY29uc3QgYWxpZ25Hcm91cCA9IG5ldyBBbGlnbkdyb3VwKCk7XHJcblxyXG4gICAgY29uc3QgY29udGVudE5vZGVzID0gZ2V0R3JvdXBJdGVtTm9kZXMoIGNvbWJvQm94SXRlbXMsIG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2l0ZW1zJyApICk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGl0ZW1zIGZvciB0aGUgY2Fyb3VzZWwsIHdob3NlIEFQSSBmb3IgJ2l0ZW1zJyBpcyBkaWZmZXJlbnQgdGhhbiBDb21ib0JveC5cclxuICAgIGNvbnN0IGNhcm91c2VsSXRlbU5vZGVzID0gXy5tYXAoIGNvbWJvQm94SXRlbXMsXHJcbiAgICAgICggY29tYm9Cb3hJdGVtLCBpICkgPT4ge1xyXG4gICAgICAgIHJldHVybiB7IGNyZWF0ZU5vZGU6ICgpID0+IG5ldyBDYXJvdXNlbEl0ZW1Ob2RlKCBwcm9wZXJ0eSwgY29tYm9Cb3hJdGVtLCBjb250ZW50Tm9kZXNbIGkgXSwgYWxpZ25Hcm91cCwgb3B0aW9ucy5pdGVtTm9kZU9wdGlvbnMgKSB9O1xyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY2Fyb3VzZWxJdGVtTm9kZXMubGVuZ3RoID09PSBjb21ib0JveEl0ZW1zLmxlbmd0aCwgJ2V4cGVjdGVkIGEgY2Fyb3VzZWxJdGVtIGZvciBlYWNoIGNvbWJvQm94SXRlbScgKTtcclxuXHJcbiAgICBjb25zdCBoQm94Q2hpbGRyZW4gPSBbXTtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGhlIGNhcm91c2VsLlxyXG4gICAgY29uc3QgY2Fyb3VzZWwgPSBuZXcgQ2Fyb3VzZWwoIGNhcm91c2VsSXRlbU5vZGVzLCBvcHRpb25zLmNhcm91c2VsT3B0aW9ucyApO1xyXG4gICAgaEJveENoaWxkcmVuLnB1c2goIGNhcm91c2VsICk7XHJcblxyXG4gICAgLy8gcGFnZSBjb250cm9sXHJcbiAgICBsZXQgcGFnZUNvbnRyb2w6IFBhZ2VDb250cm9sIHwgbnVsbCA9IG51bGw7XHJcbiAgICBpZiAoIGNhcm91c2VsLm51bWJlck9mUGFnZXNQcm9wZXJ0eS52YWx1ZSA+IDEgKSB7XHJcbiAgICAgIHBhZ2VDb250cm9sID0gbmV3IFBhZ2VDb250cm9sKCBjYXJvdXNlbC5wYWdlTnVtYmVyUHJvcGVydHksIGNhcm91c2VsLm51bWJlck9mUGFnZXNQcm9wZXJ0eSwgY29tYmluZU9wdGlvbnM8UGFnZUNvbnRyb2xPcHRpb25zPigge1xyXG4gICAgICAgIG9yaWVudGF0aW9uOiBvcHRpb25zLmNhcm91c2VsT3B0aW9ucy5vcmllbnRhdGlvblxyXG4gICAgICB9LCBvcHRpb25zLnBhZ2VDb250cm9sT3B0aW9ucyApICk7XHJcbiAgICAgIGhCb3hDaGlsZHJlbi5wdXNoKCBwYWdlQ29udHJvbCApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHBhZ2VDb250cm9sIHRvIHRoZSBsZWZ0IG9mIGNhcm91c2VsXHJcbiAgICBjb25zdCBjYXJvdXNlbEFuZFBhZ2VDb250cm9sID0gbmV3IEhCb3goIHtcclxuICAgICAgc3BhY2luZzogNCxcclxuICAgICAgY2hpbGRyZW46IGhCb3hDaGlsZHJlblxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFByZXNzaW5nIHRoaXMgYnV0dG9uIHBvcHMgdGhlIGNhcm91c2VsIHVwIGFuZCBkb3duXHJcbiAgICBjb25zdCBidXR0b24gPSBuZXcgQ29tYm9Cb3hCdXR0b24oIHByb3BlcnR5LCBjb21ib0JveEl0ZW1zLCBjb250ZW50Tm9kZXMsIGNvbWJpbmVPcHRpb25zPENvbWJvQm94QnV0dG9uT3B0aW9ucz4oIHtcclxuICAgICAgbGlzdGVuZXI6ICgpID0+IHtcclxuICAgICAgICBjYXJvdXNlbEFuZFBhZ2VDb250cm9sLnZpc2libGUgPSAhY2Fyb3VzZWxBbmRQYWdlQ29udHJvbC52aXNpYmxlO1xyXG4gICAgICB9LFxyXG4gICAgICB3aWR0aFNpemFibGU6IG9wdGlvbnMud2lkdGhTaXphYmxlLFxyXG4gICAgICBsb2NhbFByZWZlcnJlZFdpZHRoUHJvcGVydHk6IHRoaXMubG9jYWxQcmVmZXJyZWRXaWR0aFByb3BlcnR5LFxyXG4gICAgICBsb2NhbE1pbmltdW1XaWR0aFByb3BlcnR5OiB0aGlzLmxvY2FsTWluaW11bVdpZHRoUHJvcGVydHlcclxuICAgIH0sIG9wdGlvbnMuYnV0dG9uT3B0aW9ucyApICk7XHJcblxyXG4gICAgLy8gUHV0IHRoZSBidXR0b24gYWJvdmUgdGhlIGNhcm91c2VsLCBsZWZ0IGFsaWduZWQuXHJcbiAgICBjb25zdCB2Qm94ID0gbmV3IFZCb3goIHtcclxuICAgICAgc3BhY2luZzogMCxcclxuICAgICAgYWxpZ246ICdsZWZ0JyxcclxuICAgICAgY2hpbGRyZW46IFsgYnV0dG9uLCBjYXJvdXNlbEFuZFBhZ2VDb250cm9sIF1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBXcmFwIGV2ZXJ5dGhpbmcgd2l0aCBOb2RlLCB0byBoaWRlIFZCb3gncyBBUEkuXHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gWyB2Qm94IF07XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBJZiB0aGUgUHJvcGVydHkgY2hhbmdlcywgaGlkZSB0aGUgY2Fyb3VzZWwuIHVubGluayBpcyBuZWVkZWQgb24gZGlzcG9zZWQuXHJcbiAgICBjb25zdCBwcm9wZXJ0eUxpc3RlbmVyID0gKCkgPT4geyBjYXJvdXNlbEFuZFBhZ2VDb250cm9sLnZpc2libGUgPSBmYWxzZTsgfTtcclxuICAgIHByb3BlcnR5LmxpbmsoIHByb3BlcnR5TGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBDbGlja2luZyBvdXRzaWRlIHRoaXMgVUkgY29tcG9uZW50IHdpbGwgaGlkZSB0aGUgY2Fyb3VzZWwgYW5kIHBhZ2UgY29udHJvbC5cclxuICAgIC8vIE5PVEU6IGFkYXB0ZWQgZnJvbSBDb21ib0JveC5cclxuICAgIGNvbnN0IGNsaWNrVG9EaXNtaXNzTGlzdGVuZXIgPSB7XHJcbiAgICAgIGRvd246ICggZXZlbnQ6IFNjZW5lcnlFdmVudCApID0+IHtcclxuICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjYXJvdXNlbC52aXNpYmxlLCAndGhpcyBsaXN0ZW5lciBzaG91bGQgYmUgcmVnaXN0ZXJlZCBvbmx5IHdoZW4gY2Fyb3VzZWwgaXMgdmlzaWJsZScgKTtcclxuXHJcbiAgICAgICAgLy8gSWYgZnV6emluZyBpcyBlbmFibGVkLCBleGVyY2lzZSB0aGlzIGxpc3RlbmVyIHNvbWUgcGVyY2VudGFnZSBvZiB0aGUgdGltZSwgc28gdGhhdCB0aGlzIGxpc3RlbmVyIGlzIHRlc3RlZC5cclxuICAgICAgICAvLyBUaGUgcmVzdCBvZiB0aGUgdGltZSwgaWdub3JlIHRoaXMgbGlzdGVuZXIsIHNvIHRoYXQgdGhlIGNhcm91c2VsIHJlbWFpbnMgcG9wcGVkIHVwLCBhbmQgd2UgdGVzdCBtYWtpbmdcclxuICAgICAgICAvLyBjaG9pY2VzIGZyb20gdGhlIGNhcm91c2VsLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3N1bi9pc3N1ZXMvNjc3XHJcbiAgICAgICAgaWYgKCAhcGhldC5jaGlwcGVyLmlzRnV6ekVuYWJsZWQoKSB8fCBkb3RSYW5kb20ubmV4dERvdWJsZSgpIDwgMC4yNSApIHtcclxuICAgICAgICAgIGNvbnN0IHRyYWlsID0gZXZlbnQudHJhaWw7XHJcbiAgICAgICAgICBpZiAoICF0cmFpbC5jb250YWluc05vZGUoIGJ1dHRvbiApICYmICF0cmFpbC5jb250YWluc05vZGUoIGNhcm91c2VsICkgJiYgKCAhcGFnZUNvbnRyb2wgfHwgIXRyYWlsLmNvbnRhaW5zTm9kZSggcGFnZUNvbnRyb2wgKSApICkge1xyXG4gICAgICAgICAgICBjYXJvdXNlbEFuZFBhZ2VDb250cm9sLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gQWRkIGNsaWNrVG9EaXNtaXNzTGlzdGVuZXIgb25seSB3aGVuIHRoZSBjYXJvdXNlbCAmIHBhZ2UgY29udHJvbCBhcmUgdmlzaWJsZS4gdW5saW5rIGlzIG5vdCBuZWVkZWQuXHJcbiAgICAvLyBOT1RFOiBhZGFwdGVkIGZyb20gQ29tYm9Cb3guXHJcbiAgICBsZXQgZGlzcGxheTogRGlzcGxheSB8IG51bGwgPSBudWxsO1xyXG4gICAgY2Fyb3VzZWxBbmRQYWdlQ29udHJvbC52aXNpYmxlUHJvcGVydHkubGluayggdmlzaWJsZSA9PiB7XHJcbiAgICAgIGlmICggdmlzaWJsZSApIHtcclxuICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhZGlzcGxheSwgJ3VuZXhwZWN0ZWQgZGlzcGxheScgKTtcclxuICAgICAgICBkaXNwbGF5ID0gdGhpcy5nZXRVbmlxdWVUcmFpbCgpLnJvb3ROb2RlKCkuZ2V0Um9vdGVkRGlzcGxheXMoKVsgMCBdO1xyXG4gICAgICAgIGRpc3BsYXkuYWRkSW5wdXRMaXN0ZW5lciggY2xpY2tUb0Rpc21pc3NMaXN0ZW5lciApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGlmICggZGlzcGxheSAmJiBkaXNwbGF5Lmhhc0lucHV0TGlzdGVuZXIoIGNsaWNrVG9EaXNtaXNzTGlzdGVuZXIgKSApIHtcclxuICAgICAgICAgIGRpc3BsYXkucmVtb3ZlSW5wdXRMaXN0ZW5lciggY2xpY2tUb0Rpc21pc3NMaXN0ZW5lciApO1xyXG4gICAgICAgICAgZGlzcGxheSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlQ2Fyb3VzZWxDb21ib0JveCA9ICgpID0+IHtcclxuXHJcbiAgICAgIC8vIERlcmVnaXN0ZXIgb2JzZXJ2ZXJzXHJcbiAgICAgIHByb3BlcnR5LnVubGluayggcHJvcGVydHlMaXN0ZW5lciApO1xyXG5cclxuICAgICAgLy8gRGlzcG9zZSBvZiBzdWJjb21wb25lbnRzXHJcbiAgICAgIGJ1dHRvbi5kaXNwb3NlKCk7XHJcbiAgICAgIHBhZ2VDb250cm9sICYmIHBhZ2VDb250cm9sLmRpc3Bvc2UoKTtcclxuICAgICAgY2Fyb3VzZWwuZGlzcG9zZSgpO1xyXG4gICAgICBjb250ZW50Tm9kZXMuZm9yRWFjaCggbm9kZSA9PiBub2RlLmRpc3Bvc2UoKSApO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNwb3NlQ2Fyb3VzZWxDb21ib0JveCgpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxudHlwZSBDYXJvdXNlbEl0ZW1Ob2RlU2VsZk9wdGlvbnMgPSB7XHJcbiAgYWxpZ24/OiAnbGVmdCcgfCAncmlnaHQnIHwgJ2NlbnRlcic7IC8vIGFsaWdubWVudCBvZiBub2RlIG9uIGJhY2tncm91bmRcclxuICB4TWFyZ2luPzogbnVtYmVyOyAvLyB4IG1hcmdpbiBmb3IgYmFja2dyb3VuZHMgb24gdGhlIGl0ZW1zIGluIHRoZSBjYXJvdXNlbFxyXG4gIHlNYXJnaW4/OiBudW1iZXI7IC8vIHkgbWFyZ2luIGZvciBiYWNrZ3JvdW5kcyBvbiB0aGUgaXRlbXMgaW4gdGhlIGNhcm91c2VsXHJcbiAgb3ZlckNvbG9yPzogVENvbG9yOyAvLyBiYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBpdGVtIHRoYXQgdGhlIHBvaW50ZXIgaXMgb3ZlclxyXG4gIHNlbGVjdGVkQ29sb3I/OiBUQ29sb3I7IC8vIGJhY2tncm91bmQgY29sb3Igb2YgdGhlIHNlbGVjdGVkIGl0ZW1cclxufTtcclxuXHJcbnR5cGUgQ2Fyb3VzZWxJdGVtTm9kZU9wdGlvbnMgPSBDYXJvdXNlbEl0ZW1Ob2RlU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PE5vZGVPcHRpb25zLCAnY2hpbGRyZW4nPjtcclxuXHJcbi8qKlxyXG4gKiBDYXJvdXNlbEl0ZW1Ob2RlIGlzIGFuIGl0ZW0gdGhpcyBVSSBjb21wb25lbnQncyBjYXJvdXNlbC4gQ2Fyb3VzZWwgYW5kIENvbWJvQm94IGhhdmUgZGlmZmVyZW50IEFQSXMgZm9yICdpdGVtcycuXHJcbiAqIFRoaXMgY2xhc3MgYWRhcHRzIGEgQ29tYm9Cb3hJdGVtIGJ5IG1ha2luZyB0aGUgTm9kZSBoYXZlIHVuaWZvcm0gZGltZW5zaW9ucywgYW5kIHB1dHRpbmcgYSBiYWNrZ3JvdW5kIGJlaGluZCB0aGVcclxuICogTm9kZS4gVGhlIGJhY2tncm91bmQgY2hhbmdlcyBjb2xvciB3aGVuIHRoZSBpdGVtIGlzIHNlbGVjdGVkIG9yIHRoZSBwb2ludGVyIGlzIG92ZXIgdGhlIGl0ZW0uXHJcbiAqL1xyXG5jbGFzcyBDYXJvdXNlbEl0ZW1Ob2RlPFQ+IGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZUNhcm91c2VsSXRlbU5vZGU6ICgpID0+IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcHJvcGVydHk6IFRQcm9wZXJ0eTxUPiwgY29tYm9Cb3hJdGVtOiBDb21ib0JveEl0ZW08VD4sIG5vZGU6IE5vZGUsIGFsaWduR3JvdXA6IEFsaWduR3JvdXAsIHByb3ZpZGVkT3B0aW9ucz86IENhcm91c2VsSXRlbU5vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8Q2Fyb3VzZWxJdGVtTm9kZU9wdGlvbnMsIENhcm91c2VsSXRlbU5vZGVTZWxmT3B0aW9ucywgTm9kZU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIENhcm91c2VsSXRlbU5vZGVTZWxmT3B0aW9uc1xyXG4gICAgICBhbGlnbjogJ2xlZnQnLFxyXG4gICAgICB4TWFyZ2luOiA2LFxyXG4gICAgICB5TWFyZ2luOiAyLFxyXG4gICAgICBvdmVyQ29sb3I6IENvbG9yLmdyYXlDb2xvciggMjQ1ICksXHJcbiAgICAgIHNlbGVjdGVkQ29sb3I6ICd5ZWxsb3cnLFxyXG5cclxuICAgICAgLy8gTm9kZU9wdGlvbnNcclxuICAgICAgdGFuZGVtOiBUYW5kZW0uT1BUSU9OQUxcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IHVuaWZvcm1Ob2RlID0gbmV3IEFsaWduQm94KCBub2RlLCB7XHJcbiAgICAgIHhBbGlnbjogb3B0aW9ucy5hbGlnbixcclxuICAgICAgZ3JvdXA6IGFsaWduR3JvdXBcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBiYWNrZ3JvdW5kTm9kZSA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIDEsIDEgKTtcclxuXHJcbiAgICAvLyBTaXplIGJhY2tncm91bmROb2RlIHRvIGZpdCB1bmlmb3JtTm9kZS4gTm90ZSB0aGF0IHVuaWZvcm1Ob2RlJ3MgYm91bmRzIG1heSBjaGFuZ2Ugd2hlbiBhZGRpdGlvbmFsIE5vZGVzIGFyZVxyXG4gICAgLy8gYWRkZWQgdG8gYWxpZ25Hcm91cC5cclxuICAgIHVuaWZvcm1Ob2RlLmJvdW5kc1Byb3BlcnR5LmxpbmsoIGJvdW5kcyA9PiB7XHJcbiAgICAgIGJhY2tncm91bmROb2RlLnNldFJlY3RCb3VuZHMoIGJvdW5kcy5kaWxhdGVkWFkoIG9wdGlvbnMueE1hcmdpbiwgb3B0aW9ucy55TWFyZ2luICkgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gWyBiYWNrZ3JvdW5kTm9kZSwgdW5pZm9ybU5vZGUgXTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIFByZXNzIG9uIGFuIGl0ZW0gdG8gc2VsZWN0IGl0cyBhc3NvY2lhdGVkIHZhbHVlLlxyXG4gICAgY29uc3QgcHJlc3NMaXN0ZW5lciA9IG5ldyBQcmVzc0xpc3RlbmVyKCB7XHJcbiAgICAgIHByZXNzOiAoKSA9PiB7XHJcbiAgICAgICAgcHJvcGVydHkudmFsdWUgPSBjb21ib0JveEl0ZW0udmFsdWU7XHJcbiAgICAgIH0sXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncHJlc3NMaXN0ZW5lcicgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRJbnB1dExpc3RlbmVyKCBwcmVzc0xpc3RlbmVyICk7XHJcblxyXG4gICAgLy8gU2VsZWN0aW5nIGFuIGl0ZW0gc2V0cyBpdHMgYmFja2dyb3VuZCB0byB0aGUgc2VsZWN0ZWQgY29sb3IuXHJcbiAgICAvLyBQb2ludGVyIG92ZXIgYW4gaXRlbSBzZXRzIGl0cyBiYWNrZ3JvdW5kIHRvIHRoZSBoaWdobGlnaHRlZCBjb2xvci5cclxuICAgIC8vIE11c3QgYmUgZGlzcG9zZWQgYmVjYXVzZSB3ZSBkbyBub3Qgb3duIHByb3BlcnR5LlxyXG4gICAgY29uc3QgbXVsdGlsaW5rID0gbmV3IE11bHRpbGluayhcclxuICAgICAgWyBwcm9wZXJ0eSwgcHJlc3NMaXN0ZW5lci5pc092ZXJQcm9wZXJ0eSBdLFxyXG4gICAgICAoIHByb3BlcnR5VmFsdWUsIGlzT3ZlciApID0+IHtcclxuICAgICAgICBpZiAoIHByb3BlcnR5VmFsdWUgPT09IGNvbWJvQm94SXRlbS52YWx1ZSApIHtcclxuICAgICAgICAgIGJhY2tncm91bmROb2RlLmZpbGwgPSBvcHRpb25zLnNlbGVjdGVkQ29sb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCBpc092ZXIgKSB7XHJcbiAgICAgICAgICBiYWNrZ3JvdW5kTm9kZS5maWxsID0gb3B0aW9ucy5vdmVyQ29sb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgYmFja2dyb3VuZE5vZGUuZmlsbCA9ICd0cmFuc3BhcmVudCc7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlQ2Fyb3VzZWxJdGVtTm9kZSA9ICgpID0+IHtcclxuICAgICAgbXVsdGlsaW5rLmRpc3Bvc2UoKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZUNhcm91c2VsSXRlbU5vZGUoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbnN1bi5yZWdpc3RlciggJ0Nhcm91c2VsQ29tYm9Cb3gnLCBDYXJvdXNlbENvbWJvQm94ICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFJQSxPQUFPQSxTQUFTLE1BQU0sNEJBQTRCO0FBQ2xELE9BQU9DLFVBQVUsTUFBTSw0QkFBNEI7QUFDbkQsT0FBT0MsU0FBUyxNQUFNLDJCQUEyQjtBQUNqRCxPQUFPQyxTQUFTLElBQUlDLGNBQWMsUUFBUSxpQ0FBaUM7QUFDM0UsU0FBU0MsUUFBUSxFQUFFQyxVQUFVLEVBQUVDLEtBQUssRUFBV0MsSUFBSSxFQUFFQyxJQUFJLEVBQWVDLGFBQWEsRUFBRUMsU0FBUyxFQUF3QkMsSUFBSSxFQUFFQyxZQUFZLFFBQTZCLDZCQUE2QjtBQUNwTSxPQUFPQyxNQUFNLE1BQU0sMkJBQTJCO0FBQzlDLE9BQU9DLFFBQVEsTUFBMkIsZUFBZTtBQUN6RCxPQUFPQyxjQUFjLE1BQWlDLHFCQUFxQjtBQUMzRSxPQUFPQyxXQUFXLE1BQThCLGtCQUFrQjtBQUNsRSxPQUFPQyxHQUFHLE1BQU0sVUFBVTtBQUUxQixTQUFTQyxpQkFBaUIsUUFBUSx1QkFBdUI7QUFjekQsZUFBZSxNQUFNQyxnQkFBZ0IsU0FBWVAsWUFBWSxDQUFFSixJQUFLLENBQUMsQ0FBQztFQUlwRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ1NZLFdBQVdBLENBQUVDLFFBQXNCLEVBQUVDLGFBQWdDLEVBQUVDLGVBQXlDLEVBQUc7SUFFeEgsTUFBTUMsT0FBTyxHQUFHdEIsU0FBUyxDQUFzRCxDQUFDLENBQUU7TUFFaEZ1QixlQUFlLEVBQUU7UUFD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