// Copyright 2013-2022, University of Colorado Boulder

/**
 * Model for a single atom
 *
 * @author Andrey Zelenkov (Mlearner)
 * @author John Blanco (PhET Interactive Simulations)
 * @author Sam Reid (PhET Interactive Simulations)
 */

import dotRandom from '../../../../dot/js/dotRandom.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Vector2Property from '../../../../dot/js/Vector2Property.js';
import merge from '../../../../phet-core/js/merge.js';
import required from '../../../../phet-core/js/required.js';
import PhetioObject from '../../../../tandem/js/PhetioObject.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import BooleanIO from '../../../../tandem/js/types/BooleanIO.js';
import IOType from '../../../../tandem/js/types/IOType.js';
import friction from '../../friction.js';

// constants
const SHEAR_OFF_SPEED = 400; // speed that particles travel during shearing, in model units per second

let uniqueID = 0;
class Atom extends PhetioObject {
  /**
   * @param {Vector2} initialPosition
   * @param {FrictionModel} model
   * @param {boolean} isTopAtom
   * @param {Object} config
   */
  constructor(initialPosition, model, isTopAtom, config) {
    required(config);
    assert && assert(!config.tandem, 'Atom sets its own tandem');
    config = merge({
      parentTandem: required(config.parentTandem),
      tandem: Tandem.REQUIRED,
      phetioType: Atom.AtomIO
    }, config);
    config.tandem = config.parentTandem.createTandem(`atom${uniqueID}`);
    uniqueID++;
    super(config);

    // @private {Vector2} - initial position, used during resets
    this.initialPosition = initialPosition;

    // @private {FrictionModel}
    this.model = model;

    // @public (read-only) {boolean} - flag that indicates whether this atom is part of the top book
    this.isTopAtom = isTopAtom;

    // @private - marked as true when the atom is sheared off
    this.isShearedOff = false;

    // @public - the position of the atom
    this.positionProperty = new Vector2Property(initialPosition, {
      tandem: config.tandem.createTandem('positionProperty'),
      phetioHighFrequency: true,
      phetioReadOnly: true
    });

    // @private {Vector2} - the center position, around which oscillations occur
    this.centerPosition = new Vector2(initialPosition.x, initialPosition.y);

    // @private {Vector2} - velocity vector for shearing
    this.shearingVelocity = new Vector2(0, 0);
    if (this.isTopAtom) {
      // move the atom's center position as the top book moves
      model.topBookPositionProperty.lazyLink((newPosition, oldPosition) => {
        if (!this.isShearedOff && !phet.joist.sim.isSettingPhetioStateProperty.value) {
          const deltaX = newPosition.x - oldPosition.x;
          const deltaY = newPosition.y - oldPosition.y;
          this.centerPosition.setXY(this.centerPosition.x + deltaX, this.centerPosition.y + deltaY);
        }
      });
    }
  }

  /**
   * when the oscillation has exceeded the threshold, the atom breaks off, animates to one side of the screen, and
   * disappears.
   * @public
   */
  shearOff() {
    assert && assert(!this.isShearedOff, 'Atom already sheared off');
    this.isShearedOff = true;
    const shearingDestinationX = this.model.width * (dotRandom.nextBoolean() ? 1 : -1);
    const shearingDestinationY = this.positionProperty.get().y - this.model.distanceBetweenBooksProperty.get() * dotRandom.nextDouble();
    this.shearingVelocity.setXY(shearingDestinationX - this.positionProperty.get().x, shearingDestinationY - this.positionProperty.get().y).setMagnitude(SHEAR_OFF_SPEED);
  }

  /**
   * restore the initial conditions
   * @public
   */
  reset() {
    this.centerPosition.set(this.initialPosition);
    this.isShearedOff = false;
  }

  /**
   * step the atom forward in time
   * @param dt - delta time, in seconds
   * @public
   */
  step(dt) {
    // update the atom's position based on vibration and center position
    const newPosition = new Vector2(this.centerPosition.x + this.model.vibrationAmplitudeProperty.get() * (dotRandom.nextDouble() - 0.5), this.centerPosition.y + this.model.vibrationAmplitudeProperty.get() * (dotRandom.nextDouble() - 0.5));
    this.positionProperty.set(newPosition);

    // if sheared off, move away (but don't bother continuing once the atom is out of view)
    if (this.isShearedOff && Math.abs(this.centerPosition.x) < 4 * this.model.width) {
      this.centerPosition.setXY(this.centerPosition.x + this.shearingVelocity.x * dt, this.centerPosition.y + this.shearingVelocity.y * dt);
    }
  }
}
Atom.AtomIO = new IOType('AtomIO', {
  valueType: Atom,
  documentation: 'An atom on the book',
  stateSchema: {
    initialPosition: Vector2.Vector2IO,
    isTopAtom: BooleanIO,
    isShearedOff: BooleanIO,
    centerPosition: Vector2.Vector2IO,
    shearingVelocity: Vector2.Vector2IO
  }
});
friction.register('Atom', Atom);
export default Atom;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJWZWN0b3IyIiwiVmVjdG9yMlByb3BlcnR5IiwibWVyZ2UiLCJyZXF1aXJlZCIsIlBoZXRpb09iamVjdCIsIlRhbmRlbSIsIkJvb2xlYW5JTyIsIklPVHlwZSIsImZyaWN0aW9uIiwiU0hFQVJfT0ZGX1NQRUVEIiwidW5pcXVlSUQiLCJBdG9tIiwiY29uc3RydWN0b3IiLCJpbml0aWFsUG9zaXRpb24iLCJtb2RlbCIsImlzVG9wQXRvbSIsImNvbmZpZyIsImFzc2VydCIsInRhbmRlbSIsInBhcmVudFRhbmRlbSIsIlJFUVVJUkVEIiwicGhldGlvVHlwZSIsIkF0b21JTyIsImNyZWF0ZVRhbmRlbSIsImlzU2hlYXJlZE9mZiIsInBvc2l0aW9uUHJvcGVydHkiLCJwaGV0aW9IaWdoRnJlcXVlbmN5IiwicGhldGlvUmVhZE9ubHkiLCJjZW50ZXJQb3NpdGlvbiIsIngiLCJ5Iiwic2hlYXJpbmdWZWxvY2l0eSIsInRvcEJvb2tQb3NpdGlvblByb3BlcnR5IiwibGF6eUxpbmsiLCJuZXdQb3NpdGlvbiIsIm9sZFBvc2l0aW9uIiwicGhldCIsImpvaXN0Iiwic2ltIiwiaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eSIsInZhbHVlIiwiZGVsdGFYIiwiZGVsdGFZIiwic2V0WFkiLCJzaGVhck9mZiIsInNoZWFyaW5nRGVzdGluYXRpb25YIiwid2lkdGgiLCJuZXh0Qm9vbGVhbiIsInNoZWFyaW5nRGVzdGluYXRpb25ZIiwiZ2V0IiwiZGlzdGFuY2VCZXR3ZWVuQm9va3NQcm9wZXJ0eSIsIm5leHREb3VibGUiLCJzZXRNYWduaXR1ZGUiLCJyZXNldCIsInNldCIsInN0ZXAiLCJkdCIsInZpYnJhdGlvbkFtcGxpdHVkZVByb3BlcnR5IiwiTWF0aCIsImFicyIsInZhbHVlVHlwZSIsImRvY3VtZW50YXRpb24iLCJzdGF0ZVNjaGVtYSIsIlZlY3RvcjJJTyIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQXRvbS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxMy0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBNb2RlbCBmb3IgYSBzaW5nbGUgYXRvbVxyXG4gKlxyXG4gKiBAYXV0aG9yIEFuZHJleSBaZWxlbmtvdiAoTWxlYXJuZXIpXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IGRvdFJhbmRvbSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvZG90UmFuZG9tLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMlByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IHJlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9yZXF1aXJlZC5qcyc7XHJcbmltcG9ydCBQaGV0aW9PYmplY3QgZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1BoZXRpb09iamVjdC5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBCb29sZWFuSU8gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0Jvb2xlYW5JTy5qcyc7XHJcbmltcG9ydCBJT1R5cGUgZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0lPVHlwZS5qcyc7XHJcbmltcG9ydCBmcmljdGlvbiBmcm9tICcuLi8uLi9mcmljdGlvbi5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgU0hFQVJfT0ZGX1NQRUVEID0gNDAwOyAvLyBzcGVlZCB0aGF0IHBhcnRpY2xlcyB0cmF2ZWwgZHVyaW5nIHNoZWFyaW5nLCBpbiBtb2RlbCB1bml0cyBwZXIgc2Vjb25kXHJcblxyXG5sZXQgdW5pcXVlSUQgPSAwO1xyXG5cclxuY2xhc3MgQXRvbSBleHRlbmRzIFBoZXRpb09iamVjdCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7VmVjdG9yMn0gaW5pdGlhbFBvc2l0aW9uXHJcbiAgICogQHBhcmFtIHtGcmljdGlvbk1vZGVsfSBtb2RlbFxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNUb3BBdG9tXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZ1xyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBpbml0aWFsUG9zaXRpb24sIG1vZGVsLCBpc1RvcEF0b20sIGNvbmZpZyApIHtcclxuXHJcbiAgICByZXF1aXJlZCggY29uZmlnICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhY29uZmlnLnRhbmRlbSwgJ0F0b20gc2V0cyBpdHMgb3duIHRhbmRlbScgKTtcclxuXHJcbiAgICBjb25maWcgPSBtZXJnZSgge1xyXG4gICAgICBwYXJlbnRUYW5kZW06IHJlcXVpcmVkKCBjb25maWcucGFyZW50VGFuZGVtICksXHJcbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVELFxyXG4gICAgICBwaGV0aW9UeXBlOiBBdG9tLkF0b21JT1xyXG4gICAgfSwgY29uZmlnICk7XHJcblxyXG4gICAgY29uZmlnLnRhbmRlbSA9IGNvbmZpZy5wYXJlbnRUYW5kZW0uY3JlYXRlVGFuZGVtKCBgYXRvbSR7dW5pcXVlSUR9YCApO1xyXG4gICAgdW5pcXVlSUQrKztcclxuXHJcbiAgICBzdXBlciggY29uZmlnICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge1ZlY3RvcjJ9IC0gaW5pdGlhbCBwb3NpdGlvbiwgdXNlZCBkdXJpbmcgcmVzZXRzXHJcbiAgICB0aGlzLmluaXRpYWxQb3NpdGlvbiA9IGluaXRpYWxQb3NpdGlvbjtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7RnJpY3Rpb25Nb2RlbH1cclxuICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIHtib29sZWFufSAtIGZsYWcgdGhhdCBpbmRpY2F0ZXMgd2hldGhlciB0aGlzIGF0b20gaXMgcGFydCBvZiB0aGUgdG9wIGJvb2tcclxuICAgIHRoaXMuaXNUb3BBdG9tID0gaXNUb3BBdG9tO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIC0gbWFya2VkIGFzIHRydWUgd2hlbiB0aGUgYXRvbSBpcyBzaGVhcmVkIG9mZlxyXG4gICAgdGhpcy5pc1NoZWFyZWRPZmYgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBAcHVibGljIC0gdGhlIHBvc2l0aW9uIG9mIHRoZSBhdG9tXHJcbiAgICB0aGlzLnBvc2l0aW9uUHJvcGVydHkgPSBuZXcgVmVjdG9yMlByb3BlcnR5KCBpbml0aWFsUG9zaXRpb24sIHtcclxuICAgICAgdGFuZGVtOiBjb25maWcudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Bvc2l0aW9uUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0hpZ2hGcmVxdWVuY3k6IHRydWUsXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge1ZlY3RvcjJ9IC0gdGhlIGNlbnRlciBwb3NpdGlvbiwgYXJvdW5kIHdoaWNoIG9zY2lsbGF0aW9ucyBvY2N1clxyXG4gICAgdGhpcy5jZW50ZXJQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCBpbml0aWFsUG9zaXRpb24ueCwgaW5pdGlhbFBvc2l0aW9uLnkgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSB7VmVjdG9yMn0gLSB2ZWxvY2l0eSB2ZWN0b3IgZm9yIHNoZWFyaW5nXHJcbiAgICB0aGlzLnNoZWFyaW5nVmVsb2NpdHkgPSBuZXcgVmVjdG9yMiggMCwgMCApO1xyXG5cclxuICAgIGlmICggdGhpcy5pc1RvcEF0b20gKSB7XHJcblxyXG4gICAgICAvLyBtb3ZlIHRoZSBhdG9tJ3MgY2VudGVyIHBvc2l0aW9uIGFzIHRoZSB0b3AgYm9vayBtb3Zlc1xyXG4gICAgICBtb2RlbC50b3BCb29rUG9zaXRpb25Qcm9wZXJ0eS5sYXp5TGluayggKCBuZXdQb3NpdGlvbiwgb2xkUG9zaXRpb24gKSA9PiB7XHJcbiAgICAgICAgaWYgKCAhdGhpcy5pc1NoZWFyZWRPZmYgJiYgIXBoZXQuam9pc3Quc2ltLmlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgICBjb25zdCBkZWx0YVggPSBuZXdQb3NpdGlvbi54IC0gb2xkUG9zaXRpb24ueDtcclxuICAgICAgICAgIGNvbnN0IGRlbHRhWSA9IG5ld1Bvc2l0aW9uLnkgLSBvbGRQb3NpdGlvbi55O1xyXG4gICAgICAgICAgdGhpcy5jZW50ZXJQb3NpdGlvbi5zZXRYWSggdGhpcy5jZW50ZXJQb3NpdGlvbi54ICsgZGVsdGFYLCB0aGlzLmNlbnRlclBvc2l0aW9uLnkgKyBkZWx0YVkgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHdoZW4gdGhlIG9zY2lsbGF0aW9uIGhhcyBleGNlZWRlZCB0aGUgdGhyZXNob2xkLCB0aGUgYXRvbSBicmVha3Mgb2ZmLCBhbmltYXRlcyB0byBvbmUgc2lkZSBvZiB0aGUgc2NyZWVuLCBhbmRcclxuICAgKiBkaXNhcHBlYXJzLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBzaGVhck9mZigpIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICF0aGlzLmlzU2hlYXJlZE9mZiwgJ0F0b20gYWxyZWFkeSBzaGVhcmVkIG9mZicgKTtcclxuXHJcbiAgICB0aGlzLmlzU2hlYXJlZE9mZiA9IHRydWU7XHJcbiAgICBjb25zdCBzaGVhcmluZ0Rlc3RpbmF0aW9uWCA9IHRoaXMubW9kZWwud2lkdGggKiAoIGRvdFJhbmRvbS5uZXh0Qm9vbGVhbigpID8gMSA6IC0xICk7XHJcbiAgICBjb25zdCBzaGVhcmluZ0Rlc3RpbmF0aW9uWSA9IHRoaXMucG9zaXRpb25Qcm9wZXJ0eS5nZXQoKS55IC1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5kaXN0YW5jZUJldHdlZW5Cb29rc1Byb3BlcnR5LmdldCgpICogZG90UmFuZG9tLm5leHREb3VibGUoKTtcclxuXHJcbiAgICB0aGlzLnNoZWFyaW5nVmVsb2NpdHkuc2V0WFkoXHJcbiAgICAgIHNoZWFyaW5nRGVzdGluYXRpb25YIC0gdGhpcy5wb3NpdGlvblByb3BlcnR5LmdldCgpLngsXHJcbiAgICAgIHNoZWFyaW5nRGVzdGluYXRpb25ZIC0gdGhpcy5wb3NpdGlvblByb3BlcnR5LmdldCgpLnlcclxuICAgICkuc2V0TWFnbml0dWRlKCBTSEVBUl9PRkZfU1BFRUQgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHJlc3RvcmUgdGhlIGluaXRpYWwgY29uZGl0aW9uc1xyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICByZXNldCgpIHtcclxuICAgIHRoaXMuY2VudGVyUG9zaXRpb24uc2V0KCB0aGlzLmluaXRpYWxQb3NpdGlvbiApO1xyXG4gICAgdGhpcy5pc1NoZWFyZWRPZmYgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHN0ZXAgdGhlIGF0b20gZm9yd2FyZCBpbiB0aW1lXHJcbiAgICogQHBhcmFtIGR0IC0gZGVsdGEgdGltZSwgaW4gc2Vjb25kc1xyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBzdGVwKCBkdCApIHtcclxuXHJcbiAgICAvLyB1cGRhdGUgdGhlIGF0b20ncyBwb3NpdGlvbiBiYXNlZCBvbiB2aWJyYXRpb24gYW5kIGNlbnRlciBwb3NpdGlvblxyXG4gICAgY29uc3QgbmV3UG9zaXRpb24gPSBuZXcgVmVjdG9yMihcclxuICAgICAgdGhpcy5jZW50ZXJQb3NpdGlvbi54ICsgdGhpcy5tb2RlbC52aWJyYXRpb25BbXBsaXR1ZGVQcm9wZXJ0eS5nZXQoKSAqICggZG90UmFuZG9tLm5leHREb3VibGUoKSAtIDAuNSApLFxyXG4gICAgICB0aGlzLmNlbnRlclBvc2l0aW9uLnkgKyB0aGlzLm1vZGVsLnZpYnJhdGlvbkFtcGxpdHVkZVByb3BlcnR5LmdldCgpICogKCBkb3RSYW5kb20ubmV4dERvdWJsZSgpIC0gMC41IClcclxuICAgICk7XHJcbiAgICB0aGlzLnBvc2l0aW9uUHJvcGVydHkuc2V0KCBuZXdQb3NpdGlvbiApO1xyXG5cclxuICAgIC8vIGlmIHNoZWFyZWQgb2ZmLCBtb3ZlIGF3YXkgKGJ1dCBkb24ndCBib3RoZXIgY29udGludWluZyBvbmNlIHRoZSBhdG9tIGlzIG91dCBvZiB2aWV3KVxyXG4gICAgaWYgKCB0aGlzLmlzU2hlYXJlZE9mZiAmJiBNYXRoLmFicyggdGhpcy5jZW50ZXJQb3NpdGlvbi54ICkgPCA0ICogdGhpcy5tb2RlbC53aWR0aCApIHtcclxuICAgICAgdGhpcy5jZW50ZXJQb3NpdGlvbi5zZXRYWShcclxuICAgICAgICB0aGlzLmNlbnRlclBvc2l0aW9uLnggKyB0aGlzLnNoZWFyaW5nVmVsb2NpdHkueCAqIGR0LFxyXG4gICAgICAgIHRoaXMuY2VudGVyUG9zaXRpb24ueSArIHRoaXMuc2hlYXJpbmdWZWxvY2l0eS55ICogZHRcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcblxyXG5BdG9tLkF0b21JTyA9IG5ldyBJT1R5cGUoICdBdG9tSU8nLCB7XHJcbiAgdmFsdWVUeXBlOiBBdG9tLFxyXG4gIGRvY3VtZW50YXRpb246ICdBbiBhdG9tIG9uIHRoZSBib29rJyxcclxuICBzdGF0ZVNjaGVtYToge1xyXG4gICAgaW5pdGlhbFBvc2l0aW9uOiBWZWN0b3IyLlZlY3RvcjJJTyxcclxuICAgIGlzVG9wQXRvbTogQm9vbGVhbklPLFxyXG4gICAgaXNTaGVhcmVkT2ZmOiBCb29sZWFuSU8sXHJcbiAgICBjZW50ZXJQb3NpdGlvbjogVmVjdG9yMi5WZWN0b3IySU8sXHJcbiAgICBzaGVhcmluZ1ZlbG9jaXR5OiBWZWN0b3IyLlZlY3RvcjJJT1xyXG4gIH1cclxufSApO1xyXG5cclxuZnJpY3Rpb24ucmVnaXN0ZXIoICdBdG9tJywgQXRvbSApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgQXRvbTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFNBQVMsTUFBTSxpQ0FBaUM7QUFDdkQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxlQUFlLE1BQU0sdUNBQXVDO0FBQ25FLE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsUUFBUSxNQUFNLHNDQUFzQztBQUMzRCxPQUFPQyxZQUFZLE1BQU0sdUNBQXVDO0FBQ2hFLE9BQU9DLE1BQU0sTUFBTSxpQ0FBaUM7QUFDcEQsT0FBT0MsU0FBUyxNQUFNLDBDQUEwQztBQUNoRSxPQUFPQyxNQUFNLE1BQU0sdUNBQXVDO0FBQzFELE9BQU9DLFFBQVEsTUFBTSxtQkFBbUI7O0FBRXhDO0FBQ0EsTUFBTUMsZUFBZSxHQUFHLEdBQUcsQ0FBQyxDQUFDOztBQUU3QixJQUFJQyxRQUFRLEdBQUcsQ0FBQztBQUVoQixNQUFNQyxJQUFJLFNBQVNQLFlBQVksQ0FBQztFQUU5QjtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRVEsV0FBV0EsQ0FBRUMsZUFBZSxFQUFFQyxLQUFLLEVBQUVDLFNBQVMsRUFBRUMsTUFBTSxFQUFHO0lBRXZEYixRQUFRLENBQUVhLE1BQU8sQ0FBQztJQUNsQkMsTUFBTSxJQUFJQSxNQUFNLENBQUUsQ0FBQ0QsTUFBTSxDQUFDRSxNQUFNLEVBQUUsMEJBQTJCLENBQUM7SUFFOURGLE1BQU0sR0FBR2QsS0FBSyxDQUFFO01BQ2RpQixZQUFZLEVBQUVoQixRQUFRLENBQUVhLE1BQU0sQ0FBQ0csWUFBYSxDQUFDO01BQzdDRCxNQUFNLEVBQUViLE1BQU0sQ0FBQ2UsUUFBUTtNQUN2QkMsVUFBVSxFQUFFVixJQUFJLENBQUNXO0lBQ25CLENBQUMsRUFBRU4sTUFBTyxDQUFDO0lBRVhBLE1BQU0sQ0FBQ0UsTUFBTSxHQUFHRixNQUFNLENBQUNHLFlBQVksQ0FBQ0ksWUFBWSxDQUFHLE9BQU1iLFFBQVMsRUFBRSxDQUFDO0lBQ3JFQSxRQUFRLEVBQUU7SUFFVixLQUFLLENBQUVNLE1BQU8sQ0FBQzs7SUFFZjtJQUNBLElBQUksQ0FBQ0gsZUFBZSxHQUFHQSxlQUFlOztJQUV0QztJQUNBLElBQUksQ0FBQ0MsS0FBSyxHQUFHQSxLQUFLOztJQUVsQjtJQUNBLElBQUksQ0FBQ0MsU0FBUyxHQUFHQSxTQUFTOztJQUUxQjtJQUNBLElBQUksQ0FBQ1MsWUFBWSxHQUFHLEtBQUs7O0lBRXpCO0lBQ0EsSUFBSSxDQUFDQyxnQkFBZ0IsR0FBRyxJQUFJeEIsZUFBZSxDQUFFWSxlQUFlLEVBQUU7TUFDNURLLE1BQU0sRUFBRUYsTUFBTSxDQUFDRSxNQUFNLENBQUNLLFlBQVksQ0FBRSxrQkFBbUIsQ0FBQztNQUN4REcsbUJBQW1CLEVBQUUsSUFBSTtNQUN6QkMsY0FBYyxFQUFFO0lBQ2xCLENBQUUsQ0FBQzs7SUFFSDtJQUNBLElBQUksQ0FBQ0MsY0FBYyxHQUFHLElBQUk1QixPQUFPLENBQUVhLGVBQWUsQ0FBQ2dCLENBQUMsRUFBRWhCLGVBQWUsQ0FBQ2lCLENBQUUsQ0FBQzs7SUFFekU7SUFDQSxJQUFJLENBQUNDLGdCQUFnQixHQUFHLElBQUkvQixPQUFPLENBQUUsQ0FBQyxFQUFFLENBQUUsQ0FBQztJQUUzQyxJQUFLLElBQUksQ0FBQ2UsU0FBUyxFQUFHO01BRXBCO01BQ0FELEtBQUssQ0FBQ2tCLHVCQUF1QixDQUFDQyxRQUFRLENBQUUsQ0FBRUMsV0FBVyxFQUFFQyxXQUFXLEtBQU07UUFDdEUsSUFBSyxDQUFDLElBQUksQ0FBQ1gsWUFBWSxJQUFJLENBQUNZLElBQUksQ0FBQ0MsS0FBSyxDQUFDQyxHQUFHLENBQUNDLDRCQUE0QixDQUFDQyxLQUFLLEVBQUc7VUFDOUUsTUFBTUMsTUFBTSxHQUFHUCxXQUFXLENBQUNMLENBQUMsR0FBR00sV0FBVyxDQUFDTixDQUFDO1VBQzVDLE1BQU1hLE1BQU0sR0FBR1IsV0FBVyxDQUFDSixDQUFDLEdBQUdLLFdBQVcsQ0FBQ0wsQ0FBQztVQUM1QyxJQUFJLENBQUNGLGNBQWMsQ0FBQ2UsS0FBSyxDQUFFLElBQUksQ0FBQ2YsY0FBYyxDQUFDQyxDQUFDLEdBQUdZLE1BQU0sRUFBRSxJQUFJLENBQUNiLGNBQWMsQ0FBQ0UsQ0FBQyxHQUFHWSxNQUFPLENBQUM7UUFDN0Y7TUFDRixDQUFFLENBQUM7SUFDTDtFQUNGOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDRUUsUUFBUUEsQ0FBQSxFQUFHO0lBQ1QzQixNQUFNLElBQUlBLE1BQU0sQ0FBRSxDQUFDLElBQUksQ0FBQ08sWUFBWSxFQUFFLDBCQUEyQixDQUFDO0lBRWxFLElBQUksQ0FBQ0EsWUFBWSxHQUFHLElBQUk7SUFDeEIsTUFBTXFCLG9CQUFvQixHQUFHLElBQUksQ0FBQy9CLEtBQUssQ0FBQ2dDLEtBQUssSUFBSy9DLFNBQVMsQ0FBQ2dELFdBQVcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFFO0lBQ3BGLE1BQU1DLG9CQUFvQixHQUFHLElBQUksQ0FBQ3ZCLGdCQUFnQixDQUFDd0IsR0FBRyxDQUFDLENBQUMsQ0FBQ25CLENBQUMsR0FDN0IsSUFBSSxDQUFDaEIsS0FBSyxDQUFDb0MsNEJBQTRCLENBQUNELEdBQUcsQ0FBQyxDQUFDLEdBQUdsRCxTQUFTLENBQUNvRCxVQUFVLENBQUMsQ0FBQztJQUVuRyxJQUFJLENBQUNwQixnQkFBZ0IsQ0FBQ1ksS0FBSyxDQUN6QkUsb0JBQW9CLEdBQUcsSUFBSSxDQUFDcEIsZ0JBQWdCLENBQUN3QixHQUFHLENBQUMsQ0FBQyxDQUFDcEIsQ0FBQyxFQUNwRG1CLG9CQUFvQixHQUFHLElBQUksQ0FBQ3ZCLGdCQUFnQixDQUFDd0IsR0FBRyxDQUFDLENBQUMsQ0FBQ25CLENBQ3JELENBQUMsQ0FBQ3NCLFlBQVksQ0FBRTNDLGVBQWdCLENBQUM7RUFDbkM7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7RUFDRTRDLEtBQUtBLENBQUEsRUFBRztJQUNOLElBQUksQ0FBQ3pCLGNBQWMsQ0FBQzBCLEdBQUcsQ0FBRSxJQUFJLENBQUN6QyxlQUFnQixDQUFDO0lBQy9DLElBQUksQ0FBQ1csWUFBWSxHQUFHLEtBQUs7RUFDM0I7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNFK0IsSUFBSUEsQ0FBRUMsRUFBRSxFQUFHO0lBRVQ7SUFDQSxNQUFNdEIsV0FBVyxHQUFHLElBQUlsQyxPQUFPLENBQzdCLElBQUksQ0FBQzRCLGNBQWMsQ0FBQ0MsQ0FBQyxHQUFHLElBQUksQ0FBQ2YsS0FBSyxDQUFDMkMsMEJBQTBCLENBQUNSLEdBQUcsQ0FBQyxDQUFDLElBQUtsRCxTQUFTLENBQUNvRCxVQUFVLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBRSxFQUN0RyxJQUFJLENBQUN2QixjQUFjLENBQUNFLENBQUMsR0FBRyxJQUFJLENBQUNoQixLQUFLLENBQUMyQywwQkFBMEIsQ0FBQ1IsR0FBRyxDQUFDLENBQUMsSUFBS2xELFNBQVMsQ0FBQ29ELFVBQVUsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUN0RyxDQUFDO0lBQ0QsSUFBSSxDQUFDMUIsZ0JBQWdCLENBQUM2QixHQUFHLENBQUVwQixXQUFZLENBQUM7O0lBRXhDO0lBQ0EsSUFBSyxJQUFJLENBQUNWLFlBQVksSUFBSWtDLElBQUksQ0FBQ0MsR0FBRyxDQUFFLElBQUksQ0FBQy9CLGNBQWMsQ0FBQ0MsQ0FBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQ2YsS0FBSyxDQUFDZ0MsS0FBSyxFQUFHO01BQ25GLElBQUksQ0FBQ2xCLGNBQWMsQ0FBQ2UsS0FBSyxDQUN2QixJQUFJLENBQUNmLGNBQWMsQ0FBQ0MsQ0FBQyxHQUFHLElBQUksQ0FBQ0UsZ0JBQWdCLENBQUNGLENBQUMsR0FBRzJCLEVBQUUsRUFDcEQsSUFBSSxDQUFDNUIsY0FBYyxDQUFDRSxDQUFDLEdBQUcsSUFBSSxDQUFDQyxnQkFBZ0IsQ0FBQ0QsQ0FBQyxHQUFHMEIsRUFDcEQsQ0FBQztJQUNIO0VBQ0Y7QUFDRjtBQUdBN0MsSUFBSSxDQUFDVyxNQUFNLEdBQUcsSUFBSWYsTUFBTSxDQUFFLFFBQVEsRUFBRTtFQUNsQ3FELFNBQVMsRUFBRWpELElBQUk7RUFDZmtELGFBQWEsRUFBRSxxQkFBcUI7RUFDcENDLFdBQVcsRUFBRTtJQUNYakQsZUFBZSxFQUFFYixPQUFPLENBQUMrRCxTQUFTO0lBQ2xDaEQsU0FBUyxFQUFFVCxTQUFTO0lBQ3BCa0IsWUFBWSxFQUFFbEIsU0FBUztJQUN2QnNCLGNBQWMsRUFBRTVCLE9BQU8sQ0FBQytELFNBQVM7SUFDakNoQyxnQkFBZ0IsRUFBRS9CLE9BQU8sQ0FBQytEO0VBQzVCO0FBQ0YsQ0FBRSxDQUFDO0FBRUh2RCxRQUFRLENBQUN3RCxRQUFRLENBQUUsTUFBTSxFQUFFckQsSUFBSyxDQUFDO0FBRWpDLGVBQWVBLElBQUkifQ==