// Copyright 2018-2022, University of Colorado Boulder

/**
 * SoundGenerator is an abstract base class for Web-Audio-based sound-producing elements that work in conjunction with
 * the soundManager to produces sounds.
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import createObservableArray from '../../../axon/js/createObservableArray.js';
import optionize from '../../../phet-core/js/optionize.js';
import Tandem from '../../../tandem/js/Tandem.js';
import phetAudioContext from '../phetAudioContext.js';
import soundConstants from '../soundConstants.js';
import tambo from '../tambo.js';
// constants
const DEFAULT_TIME_CONSTANT = soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT;
let notSettingPhetioStateProperty;
class SoundGenerator {
  // a list of all audio nodes to which this sound generator is connected

  // A set of boolean Properties that collectively control whether the sound generator is enabled.  All of these must be
  // true in order for the sound generator to be "fully enabled", meaning that it will produce sound.
  // A Property that tracks whether this sound generator is fully enabled, meaning that all the enable control
  // Properties are in a state indicating that sound can be produced.  This should only be updated in the listener
  // function defined below, nowhere else.
  // A Property that tracks whether this sound generator is "locally enabled", which means that it is internally set to
  // produce sound.  Setting this to true does not guarantee that sound will be produced, since other Properties can all
  // affect this, see fullyEnabledProperty.
  // master gain control that will be used to control the volume of the sound
  // The audio node to which the sound sources will connect, analogous to AudioContext.destination.  If no additional
  // audio nodes were provided upon construction, this will be the master gain node.
  // internally used disposal function
  constructor(providedOptions) {
    const options = optionize()({
      initialOutputLevel: 1,
      audioContext: phetAudioContext,
      connectImmediately: false,
      enableControlProperties: [],
      additionalAudioNodes: [],
      enabledDuringPhetioStateSetting: false
    }, providedOptions);
    this.audioContext = options.audioContext;
    this._outputLevel = options.initialOutputLevel;
    this.connectionList = [];
    this.enableControlProperties = createObservableArray();
    this.fullyEnabledProperty = new BooleanProperty(true);

    // listener that updates the state of fullyEnabledProperty
    const updateFullyEnabledState = () => {
      this.fullyEnabledProperty.value = _.every(this.enableControlProperties, enableControlProperty => enableControlProperty.value);
    };

    // Listen for new enable control Properties and hook them up as they arrive.
    this.enableControlProperties.addItemAddedListener(addedItem => {
      addedItem.link(updateFullyEnabledState);
      const checkAndRemove = removedItem => {
        if (removedItem === addedItem) {
          removedItem.unlink(updateFullyEnabledState);
          this.enableControlProperties.removeItemRemovedListener(checkAndRemove);
        }
      };
      this.enableControlProperties.addItemRemovedListener(checkAndRemove);
    });

    // Add any enable control Properties that were provided in the options object.
    options.enableControlProperties.forEach(enableControlProperty => {
      this.addEnableControlProperty(enableControlProperty);
    });
    this.locallyEnabledProperty = new BooleanProperty(true);

    // Add the local Property to the list of enable controls.
    this.addEnableControlProperty(this.locallyEnabledProperty);
    this.masterGainNode = this.audioContext.createGain();
    this.masterGainNode.gain.setValueAtTime(this._outputLevel, this.audioContext.currentTime);

    // If the option specifies immediate connection, connect the master gain node to the audio context destination.
    if (options.connectImmediately) {
      this.masterGainNode.connect(this.audioContext.destination);
    }

    // Turn down the gain to zero when not fully enabled and up to the current output level when becoming fully enabled.
    this.fullyEnabledProperty.link(fullyEnabled => {
      const previousGainSetting = fullyEnabled ? 0 : this._outputLevel;
      const newGainSetting = fullyEnabled ? this._outputLevel : 0;
      const now = this.audioContext.currentTime;

      // For the linear ramp to work consistently on all browsers, the gain must be explicitly set to what it is
      // supposed to be before making any changes.  Otherwise, it may extrapolate from the most recent previous event.
      this.masterGainNode.gain.setValueAtTime(previousGainSetting, now);

      // Ramp the gain to the new level.
      this.masterGainNode.gain.linearRampToValueAtTime(newGainSetting, this.audioContext.currentTime + soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME);
    });
    this.soundSourceDestination = this.masterGainNode;

    // Insert any additional audio nodes into the signal chain by iterating backwards through the provided list.
    for (let i = options.additionalAudioNodes.length - 1; i >= 0; i--) {
      const audioNode = options.additionalAudioNodes[i];
      audioNode.connect(this.soundSourceDestination);
      this.soundSourceDestination = audioNode;
    }
    if (Tandem.PHET_IO_ENABLED && !options.enabledDuringPhetioStateSetting) {
      if (Tandem.launched) {
        assert && assert(notSettingPhetioStateProperty, 'Should exist after launch');

        // If this SoundGenerator is being constructed after PhET-iO has been started, add an enable-control Property to
        // prevent sound during the setting of PhET-iO state.
        this.addEnableControlProperty(notSettingPhetioStateProperty);
      } else {
        // If this SoundGenerator is being constructed before PhET-iO is fully set up, add a listener, called once
        // PhET-iO is ready, to then add an enable-control Property that will prevent sound during the setting of
        // PhET-iO state.
        Tandem.addLaunchListener(() => {
          if (!notSettingPhetioStateProperty) {
            // Store this for later instantiations of SoundGenerator
            notSettingPhetioStateProperty = DerivedProperty.not(phet.phetio.phetioEngine.phetioStateEngine.isSettingStateProperty);
          }
          this.addEnableControlProperty(notSettingPhetioStateProperty);
        });
      }
    }
    this.disposeSoundGenerator = () => {
      // Clearing this observable array should cause the Properties within it to be unlinked.
      this.enableControlProperties.clear();
    };
  }

  /**
   * Connect the sound generator to an audio parameter.
   */
  connect(audioParam) {
    this.masterGainNode.connect(audioParam);

    // Track this sound generator's connections.  This is necessary because Web Audio doesn't support checking which
    // nodes are connected to which, and we need this information when disconnecting.
    this.connectionList.push(audioParam);
  }

  /**
   * Disconnect the sound generator from an audio parameter.
   */
  disconnect(audioParam) {
    this.masterGainNode.disconnect(audioParam);
    this.connectionList = _.without(this.connectionList, audioParam);
  }

  /**
   * Test if this sound generator is connected to the provided audio param.
   */
  isConnectedTo(audioParam) {
    return this.connectionList.includes(audioParam);
  }

  /**
   * Set the output level of the sound generator.
   * @param outputLevel - generally between 0 and 1, but can be larger than 1 if necessary to amplify a small
   *                      signal, and can be negative to invert the phase
   * @param [timeConstant] - time constant for change, longer values mean slower transitions, in seconds
   */
  setOutputLevel(outputLevel, timeConstant = DEFAULT_TIME_CONSTANT) {
    // Ignore attempts to set the output level to the same value.
    if (outputLevel !== this._outputLevel) {
      const now = this.audioContext.currentTime;

      // The output level should take effect immediately if this sound generator is fully enabled.  Otherwise, the value
      // is saved and restored the next time the sound generator transitions to fully enabled.
      if (this.fullyEnabledProperty.value) {
        // Cancel any gain transitions that are currently in progress.
        this.masterGainNode.gain.cancelScheduledValues(now);

        // Set the output level on the gain node.  A different method is used for instant changes.
        if (timeConstant === 0) {
          this.masterGainNode.gain.setValueAtTime(outputLevel, now);
        } else {
          // The setTargetAtTime method doesn't seem to work if the audio context isn't running, and the event doesn't
          // seem to be scheduled - it's just ignored.  So, if the audio context isn't running, use an alternative
          // approach.  See https://github.com/phetsims/tambo/issues/74.
          if (this.audioContext.state === 'running') {
            this.masterGainNode.gain.setTargetAtTime(outputLevel, now, timeConstant);
          } else {
            this.masterGainNode.gain.linearRampToValueAtTime(outputLevel, now + soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME);
          }
        }
      }

      // Set local copy of output level.
      this._outputLevel = outputLevel;
    }
  }
  set outputLevel(outputLevel) {
    this.setOutputLevel(outputLevel);
  }
  get outputLevel() {
    return this.getOutputLevel();
  }

  /**
   * Get the current output level setting.  Note that if the sound generator is disabled, this could return a non-zero
   * value but the sound generator won't produce audible sound.
   */
  getOutputLevel() {
    return this._outputLevel;
  }

  /**
   * Add a Property to the list of those used to control the enabled state of this sound generator.
   */
  addEnableControlProperty(enableControlProperty) {
    this.enableControlProperties.push(enableControlProperty);
  }

  /**
   * Remove a Property from the list of those used to control the enabled state of this sound generator.
   */
  removeEnableControlProperty(enableControlProperty) {
    this.enableControlProperties.remove(enableControlProperty);
  }
  get locallyEnabled() {
    return this.locallyEnabledProperty.value;
  }
  set locallyEnabled(locallyEnabled) {
    this.locallyEnabledProperty.value = locallyEnabled;
  }
  get fullyEnabled() {
    return this.fullyEnabledProperty.value;
  }
  dispose() {
    this.disposeSoundGenerator();
  }
}
tambo.register('SoundGenerator', SoundGenerator);
export default SoundGenerator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJjcmVhdGVPYnNlcnZhYmxlQXJyYXkiLCJvcHRpb25pemUiLCJUYW5kZW0iLCJwaGV0QXVkaW9Db250ZXh0Iiwic291bmRDb25zdGFudHMiLCJ0YW1ibyIsIkRFRkFVTFRfVElNRV9DT05TVEFOVCIsIkRFRkFVTFRfUEFSQU1fQ0hBTkdFX1RJTUVfQ09OU1RBTlQiLCJub3RTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eSIsIlNvdW5kR2VuZXJhdG9yIiwiY29uc3RydWN0b3IiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiaW5pdGlhbE91dHB1dExldmVsIiwiYXVkaW9Db250ZXh0IiwiY29ubmVjdEltbWVkaWF0ZWx5IiwiZW5hYmxlQ29udHJvbFByb3BlcnRpZXMiLCJhZGRpdGlvbmFsQXVkaW9Ob2RlcyIsImVuYWJsZWREdXJpbmdQaGV0aW9TdGF0ZVNldHRpbmciLCJfb3V0cHV0TGV2ZWwiLCJjb25uZWN0aW9uTGlzdCIsImZ1bGx5RW5hYmxlZFByb3BlcnR5IiwidXBkYXRlRnVsbHlFbmFibGVkU3RhdGUiLCJ2YWx1ZSIsIl8iLCJldmVyeSIsImVuYWJsZUNvbnRyb2xQcm9wZXJ0eSIsImFkZEl0ZW1BZGRlZExpc3RlbmVyIiwiYWRkZWRJdGVtIiwibGluayIsImNoZWNrQW5kUmVtb3ZlIiwicmVtb3ZlZEl0ZW0iLCJ1bmxpbmsiLCJyZW1vdmVJdGVtUmVtb3ZlZExpc3RlbmVyIiwiYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciIsImZvckVhY2giLCJhZGRFbmFibGVDb250cm9sUHJvcGVydHkiLCJsb2NhbGx5RW5hYmxlZFByb3BlcnR5IiwibWFzdGVyR2Fpbk5vZGUiLCJjcmVhdGVHYWluIiwiZ2FpbiIsInNldFZhbHVlQXRUaW1lIiwiY3VycmVudFRpbWUiLCJjb25uZWN0IiwiZGVzdGluYXRpb24iLCJmdWxseUVuYWJsZWQiLCJwcmV2aW91c0dhaW5TZXR0aW5nIiwibmV3R2FpblNldHRpbmciLCJub3ciLCJsaW5lYXJSYW1wVG9WYWx1ZUF0VGltZSIsIkRFRkFVTFRfTElORUFSX0dBSU5fQ0hBTkdFX1RJTUUiLCJzb3VuZFNvdXJjZURlc3RpbmF0aW9uIiwiaSIsImxlbmd0aCIsImF1ZGlvTm9kZSIsIlBIRVRfSU9fRU5BQkxFRCIsImxhdW5jaGVkIiwiYXNzZXJ0IiwiYWRkTGF1bmNoTGlzdGVuZXIiLCJub3QiLCJwaGV0IiwicGhldGlvIiwicGhldGlvRW5naW5lIiwicGhldGlvU3RhdGVFbmdpbmUiLCJpc1NldHRpbmdTdGF0ZVByb3BlcnR5IiwiZGlzcG9zZVNvdW5kR2VuZXJhdG9yIiwiY2xlYXIiLCJhdWRpb1BhcmFtIiwicHVzaCIsImRpc2Nvbm5lY3QiLCJ3aXRob3V0IiwiaXNDb25uZWN0ZWRUbyIsImluY2x1ZGVzIiwic2V0T3V0cHV0TGV2ZWwiLCJvdXRwdXRMZXZlbCIsInRpbWVDb25zdGFudCIsImNhbmNlbFNjaGVkdWxlZFZhbHVlcyIsInN0YXRlIiwic2V0VGFyZ2V0QXRUaW1lIiwiZ2V0T3V0cHV0TGV2ZWwiLCJyZW1vdmVFbmFibGVDb250cm9sUHJvcGVydHkiLCJyZW1vdmUiLCJsb2NhbGx5RW5hYmxlZCIsImRpc3Bvc2UiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlNvdW5kR2VuZXJhdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE4LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFNvdW5kR2VuZXJhdG9yIGlzIGFuIGFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIFdlYi1BdWRpby1iYXNlZCBzb3VuZC1wcm9kdWNpbmcgZWxlbWVudHMgdGhhdCB3b3JrIGluIGNvbmp1bmN0aW9uIHdpdGhcclxuICogdGhlIHNvdW5kTWFuYWdlciB0byBwcm9kdWNlcyBzb3VuZHMuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgY3JlYXRlT2JzZXJ2YWJsZUFycmF5LCB7IE9ic2VydmFibGVBcnJheSB9IGZyb20gJy4uLy4uLy4uL2F4b24vanMvY3JlYXRlT2JzZXJ2YWJsZUFycmF5LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IHBoZXRBdWRpb0NvbnRleHQgZnJvbSAnLi4vcGhldEF1ZGlvQ29udGV4dC5qcyc7XHJcbmltcG9ydCBzb3VuZENvbnN0YW50cyBmcm9tICcuLi9zb3VuZENvbnN0YW50cy5qcyc7XHJcbmltcG9ydCB0YW1ibyBmcm9tICcuLi90YW1iby5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1RQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBERUZBVUxUX1RJTUVfQ09OU1RBTlQgPSBzb3VuZENvbnN0YW50cy5ERUZBVUxUX1BBUkFNX0NIQU5HRV9USU1FX0NPTlNUQU5UO1xyXG5cclxubGV0IG5vdFNldHRpbmdQaGV0aW9TdGF0ZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbmV4cG9ydCB0eXBlIFNvdW5kR2VuZXJhdG9yT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gSW5pdGlhbCB2YWx1ZSBmb3IgdGhlIG91dHB1dCBsZXZlbC4gIEdlbmVyYWxseSwgdGhpcyBzaG91bGQgYWx3YXlzIGJlIGJldHdlZW4gMCBhbmQgMSwgYnV0IHZhbHVlcyBncmVhdGVyIHRoYW4gMVxyXG4gIC8vIG1heSBiZSBuZWVkZWQgaW4gc29tZSByYXJlIGNhc2VzIGluIG9yZGVyIHRvIGNyZWF0ZSBlbm91Z2ggb3V0cHV0IHRvIGJlIGF1ZGlibGUuXHJcbiAgaW5pdGlhbE91dHB1dExldmVsPzogbnVtYmVyO1xyXG5cclxuICAvLyBCeSBkZWZhdWx0LCB0aGUgc2hhcmVkIGF1ZGlvIGNvbnRleHQgaXMgdXNlZCBzbyB0aGF0IHRoaXMgc291bmQgY2FuIGJlIHJlZ2lzdGVyZWQgd2l0aCB0aGUgc29uaWZpY2F0aW9uIG1hbmFnZXIsXHJcbiAgLy8gYnV0IHRoaXMgY2FuIGJlIG92ZXJyaWRkZW4gaWYgZGVzaXJlZC4gIEluIGdlbmVyYWwsIG92ZXJyaWRpbmcgd2lsbCBvbmx5IGJlIGRvbmUgZm9yIHRlc3RpbmcuXHJcbiAgYXVkaW9Db250ZXh0PzogQXVkaW9Db250ZXh0O1xyXG5cclxuICAvLyBUaGlzIGZsYWcgY29udHJvbHMgd2hldGhlciB0aGUgb3V0cHV0IG9mIHRoaXMgc291bmQgZ2VuZXJhdG9yIGlzIGltbWVkaWF0ZWx5IGNvbm5lY3RlZCB0byB0aGUgYXVkaW8gY29udGV4dFxyXG4gIC8vIGRlc3RpbmF0aW9uLiAgVGhpcyBpcyB1c2VmdWwgZm9yIHRlc3RpbmcsIGJ1dCBzaG91bGQgbm90IGJlIHNldCB0byB0cnVlIGlmIHRoaXMgc291bmQgZ2VuZXJhdG9yIGlzIGJlaW5nIHVzZWRcclxuICAvLyBpbiBjb25qdW5jdGlvbiB3aXRoIHRoZSBzb3VuZCBtYW5hZ2VyLlxyXG4gIGNvbm5lY3RJbW1lZGlhdGVseT86IGJvb2xlYW47XHJcblxyXG4gIC8vIEFuIGluaXRpYWwgc2V0IG9mIFByb3BlcnRpZXMgdGhhdCB3aWxsIGJlIGhvb2tlZCB0byB0aGlzIHNvdW5kIGdlbmVyYXRvcidzIGVuYWJsZWQgc3RhdGUsIGFsbCBvZiB3aGljaCBtdXN0IGJlIHRydWVcclxuICAvLyBmb3Igc291bmQgdG8gYmUgcHJvZHVjZWQuICBNb3JlIG9mIHRoZXNlIHByb3BlcnRpZXMgY2FuIGJlIGFkZGVkIGFmdGVyIGNvbnN0cnVjdGlvbiB2aWEgbWV0aG9kcyBpZiBuZWVkZWQuXHJcbiAgZW5hYmxlQ29udHJvbFByb3BlcnRpZXM/OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPltdO1xyXG5cclxuICAvLyBBdWRpbyBub2RlcyB0aGF0IHdpbGwgYmUgY29ubmVjdGVkIGluIHRoZSBzcGVjaWZpZWQgb3JkZXIgYmV0d2VlbiB0aGUgYnVmZmVyU291cmNlIGFuZCBsb2NhbEdhaW5Ob2RlLCB1c2VkIHRvXHJcbiAgLy8gaW5zZXJ0IHRoaW5ncyBsaWtlIGZpbHRlcnMsIGNvbXByZXNzb3JzLCBldGMuXHJcbiAgYWRkaXRpb25hbEF1ZGlvTm9kZXM/OiBBdWRpb05vZGVbXTtcclxuXHJcbiAgLy8gV2hlbiBmYWxzZSwgYW4gZW5hYmxlLWNvbnRyb2wgUHJvcGVydHkgd2lsbCBiZSBhZGRlZCB0aGF0IG11dGVzIHRoZSBzb3VuZCB3aGVuIHNldHRpbmcgUGhFVC1pTyBzdGF0ZS4gQWxtb3N0IGFsbFxyXG4gIC8vIHNvdW5kcyB3YW50IHRoaXMgbXV0aW5nIHRvIG9jY3VyLCBwbGVhc2UgdGVzdCB0aG9yb3VnaGx5IGJlZm9yZSB0dXJuaW5nIHRoaXMgb3B0aW9uIG9uLlxyXG4gIGVuYWJsZWREdXJpbmdQaGV0aW9TdGF0ZVNldHRpbmc/OiBib29sZWFuO1xyXG59O1xyXG5cclxuYWJzdHJhY3QgY2xhc3MgU291bmRHZW5lcmF0b3Ige1xyXG5cclxuICBwcm90ZWN0ZWQgYXVkaW9Db250ZXh0OiBBdWRpb0NvbnRleHQ7XHJcbiAgcHJpdmF0ZSBfb3V0cHV0TGV2ZWw6IG51bWJlcjtcclxuXHJcbiAgLy8gYSBsaXN0IG9mIGFsbCBhdWRpbyBub2RlcyB0byB3aGljaCB0aGlzIHNvdW5kIGdlbmVyYXRvciBpcyBjb25uZWN0ZWRcclxuICBwcml2YXRlIGNvbm5lY3Rpb25MaXN0OiAoIEF1ZGlvUGFyYW0gfCBBdWRpb05vZGUgKVtdO1xyXG5cclxuICAvLyBBIHNldCBvZiBib29sZWFuIFByb3BlcnRpZXMgdGhhdCBjb2xsZWN0aXZlbHkgY29udHJvbCB3aGV0aGVyIHRoZSBzb3VuZCBnZW5lcmF0b3IgaXMgZW5hYmxlZC4gIEFsbCBvZiB0aGVzZSBtdXN0IGJlXHJcbiAgLy8gdHJ1ZSBpbiBvcmRlciBmb3IgdGhlIHNvdW5kIGdlbmVyYXRvciB0byBiZSBcImZ1bGx5IGVuYWJsZWRcIiwgbWVhbmluZyB0aGF0IGl0IHdpbGwgcHJvZHVjZSBzb3VuZC5cclxuICBwcm90ZWN0ZWQgZW5hYmxlQ29udHJvbFByb3BlcnRpZXM6IE9ic2VydmFibGVBcnJheTxUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPj47XHJcblxyXG4gIC8vIEEgUHJvcGVydHkgdGhhdCB0cmFja3Mgd2hldGhlciB0aGlzIHNvdW5kIGdlbmVyYXRvciBpcyBmdWxseSBlbmFibGVkLCBtZWFuaW5nIHRoYXQgYWxsIHRoZSBlbmFibGUgY29udHJvbFxyXG4gIC8vIFByb3BlcnRpZXMgYXJlIGluIGEgc3RhdGUgaW5kaWNhdGluZyB0aGF0IHNvdW5kIGNhbiBiZSBwcm9kdWNlZC4gIFRoaXMgc2hvdWxkIG9ubHkgYmUgdXBkYXRlZCBpbiB0aGUgbGlzdGVuZXJcclxuICAvLyBmdW5jdGlvbiBkZWZpbmVkIGJlbG93LCBub3doZXJlIGVsc2UuXHJcbiAgcHVibGljIHJlYWRvbmx5IGZ1bGx5RW5hYmxlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gQSBQcm9wZXJ0eSB0aGF0IHRyYWNrcyB3aGV0aGVyIHRoaXMgc291bmQgZ2VuZXJhdG9yIGlzIFwibG9jYWxseSBlbmFibGVkXCIsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgaW50ZXJuYWxseSBzZXQgdG9cclxuICAvLyBwcm9kdWNlIHNvdW5kLiAgU2V0dGluZyB0aGlzIHRvIHRydWUgZG9lcyBub3QgZ3VhcmFudGVlIHRoYXQgc291bmQgd2lsbCBiZSBwcm9kdWNlZCwgc2luY2Ugb3RoZXIgUHJvcGVydGllcyBjYW4gYWxsXHJcbiAgLy8gYWZmZWN0IHRoaXMsIHNlZSBmdWxseUVuYWJsZWRQcm9wZXJ0eS5cclxuICBwdWJsaWMgcmVhZG9ubHkgbG9jYWxseUVuYWJsZWRQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIG1hc3RlciBnYWluIGNvbnRyb2wgdGhhdCB3aWxsIGJlIHVzZWQgdG8gY29udHJvbCB0aGUgdm9sdW1lIG9mIHRoZSBzb3VuZFxyXG4gIHByb3RlY3RlZCBtYXN0ZXJHYWluTm9kZTogR2Fpbk5vZGU7XHJcblxyXG4gIC8vIFRoZSBhdWRpbyBub2RlIHRvIHdoaWNoIHRoZSBzb3VuZCBzb3VyY2VzIHdpbGwgY29ubmVjdCwgYW5hbG9nb3VzIHRvIEF1ZGlvQ29udGV4dC5kZXN0aW5hdGlvbi4gIElmIG5vIGFkZGl0aW9uYWxcclxuICAvLyBhdWRpbyBub2RlcyB3ZXJlIHByb3ZpZGVkIHVwb24gY29uc3RydWN0aW9uLCB0aGlzIHdpbGwgYmUgdGhlIG1hc3RlciBnYWluIG5vZGUuXHJcbiAgcHJvdGVjdGVkIHNvdW5kU291cmNlRGVzdGluYXRpb246IEF1ZGlvTm9kZTtcclxuXHJcbiAgLy8gaW50ZXJuYWxseSB1c2VkIGRpc3Bvc2FsIGZ1bmN0aW9uXHJcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlU291bmRHZW5lcmF0b3I6ICgpID0+IHZvaWQ7XHJcblxyXG4gIHByb3RlY3RlZCBjb25zdHJ1Y3RvciggcHJvdmlkZWRPcHRpb25zPzogU291bmRHZW5lcmF0b3JPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8U291bmRHZW5lcmF0b3JPcHRpb25zLCBTb3VuZEdlbmVyYXRvck9wdGlvbnM+KCkoIHtcclxuICAgICAgaW5pdGlhbE91dHB1dExldmVsOiAxLFxyXG4gICAgICBhdWRpb0NvbnRleHQ6IHBoZXRBdWRpb0NvbnRleHQsXHJcbiAgICAgIGNvbm5lY3RJbW1lZGlhdGVseTogZmFsc2UsXHJcbiAgICAgIGVuYWJsZUNvbnRyb2xQcm9wZXJ0aWVzOiBbXSxcclxuICAgICAgYWRkaXRpb25hbEF1ZGlvTm9kZXM6IFtdLFxyXG4gICAgICBlbmFibGVkRHVyaW5nUGhldGlvU3RhdGVTZXR0aW5nOiBmYWxzZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5hdWRpb0NvbnRleHQgPSBvcHRpb25zLmF1ZGlvQ29udGV4dDtcclxuICAgIHRoaXMuX291dHB1dExldmVsID0gb3B0aW9ucy5pbml0aWFsT3V0cHV0TGV2ZWw7XHJcbiAgICB0aGlzLmNvbm5lY3Rpb25MaXN0ID0gW107XHJcbiAgICB0aGlzLmVuYWJsZUNvbnRyb2xQcm9wZXJ0aWVzID0gY3JlYXRlT2JzZXJ2YWJsZUFycmF5KCk7XHJcbiAgICB0aGlzLmZ1bGx5RW5hYmxlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggdHJ1ZSApO1xyXG5cclxuICAgIC8vIGxpc3RlbmVyIHRoYXQgdXBkYXRlcyB0aGUgc3RhdGUgb2YgZnVsbHlFbmFibGVkUHJvcGVydHlcclxuICAgIGNvbnN0IHVwZGF0ZUZ1bGx5RW5hYmxlZFN0YXRlID0gKCkgPT4ge1xyXG4gICAgICB0aGlzLmZ1bGx5RW5hYmxlZFByb3BlcnR5LnZhbHVlID0gXy5ldmVyeShcclxuICAgICAgICB0aGlzLmVuYWJsZUNvbnRyb2xQcm9wZXJ0aWVzLFxyXG4gICAgICAgICggZW5hYmxlQ29udHJvbFByb3BlcnR5OiBUUHJvcGVydHk8Ym9vbGVhbj4gKSA9PiBlbmFibGVDb250cm9sUHJvcGVydHkudmFsdWVcclxuICAgICAgKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gTGlzdGVuIGZvciBuZXcgZW5hYmxlIGNvbnRyb2wgUHJvcGVydGllcyBhbmQgaG9vayB0aGVtIHVwIGFzIHRoZXkgYXJyaXZlLlxyXG4gICAgdGhpcy5lbmFibGVDb250cm9sUHJvcGVydGllcy5hZGRJdGVtQWRkZWRMaXN0ZW5lciggYWRkZWRJdGVtID0+IHtcclxuICAgICAgYWRkZWRJdGVtLmxpbmsoIHVwZGF0ZUZ1bGx5RW5hYmxlZFN0YXRlICk7XHJcbiAgICAgIGNvbnN0IGNoZWNrQW5kUmVtb3ZlID0gKCByZW1vdmVkSXRlbTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4gKSA9PiB7XHJcbiAgICAgICAgaWYgKCByZW1vdmVkSXRlbSA9PT0gYWRkZWRJdGVtICkge1xyXG4gICAgICAgICAgcmVtb3ZlZEl0ZW0udW5saW5rKCB1cGRhdGVGdWxseUVuYWJsZWRTdGF0ZSApO1xyXG4gICAgICAgICAgdGhpcy5lbmFibGVDb250cm9sUHJvcGVydGllcy5yZW1vdmVJdGVtUmVtb3ZlZExpc3RlbmVyKCBjaGVja0FuZFJlbW92ZSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgdGhpcy5lbmFibGVDb250cm9sUHJvcGVydGllcy5hZGRJdGVtUmVtb3ZlZExpc3RlbmVyKCBjaGVja0FuZFJlbW92ZSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEFkZCBhbnkgZW5hYmxlIGNvbnRyb2wgUHJvcGVydGllcyB0aGF0IHdlcmUgcHJvdmlkZWQgaW4gdGhlIG9wdGlvbnMgb2JqZWN0LlxyXG4gICAgb3B0aW9ucy5lbmFibGVDb250cm9sUHJvcGVydGllcy5mb3JFYWNoKCBlbmFibGVDb250cm9sUHJvcGVydHkgPT4ge1xyXG4gICAgICB0aGlzLmFkZEVuYWJsZUNvbnRyb2xQcm9wZXJ0eSggZW5hYmxlQ29udHJvbFByb3BlcnR5ICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5sb2NhbGx5RW5hYmxlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggdHJ1ZSApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgbG9jYWwgUHJvcGVydHkgdG8gdGhlIGxpc3Qgb2YgZW5hYmxlIGNvbnRyb2xzLlxyXG4gICAgdGhpcy5hZGRFbmFibGVDb250cm9sUHJvcGVydHkoIHRoaXMubG9jYWxseUVuYWJsZWRQcm9wZXJ0eSApO1xyXG5cclxuICAgIHRoaXMubWFzdGVyR2Fpbk5vZGUgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7XHJcbiAgICB0aGlzLm1hc3RlckdhaW5Ob2RlLmdhaW4uc2V0VmFsdWVBdFRpbWUoXHJcbiAgICAgIHRoaXMuX291dHB1dExldmVsLFxyXG4gICAgICB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBJZiB0aGUgb3B0aW9uIHNwZWNpZmllcyBpbW1lZGlhdGUgY29ubmVjdGlvbiwgY29ubmVjdCB0aGUgbWFzdGVyIGdhaW4gbm9kZSB0byB0aGUgYXVkaW8gY29udGV4dCBkZXN0aW5hdGlvbi5cclxuICAgIGlmICggb3B0aW9ucy5jb25uZWN0SW1tZWRpYXRlbHkgKSB7XHJcbiAgICAgIHRoaXMubWFzdGVyR2Fpbk5vZGUuY29ubmVjdCggdGhpcy5hdWRpb0NvbnRleHQuZGVzdGluYXRpb24gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUdXJuIGRvd24gdGhlIGdhaW4gdG8gemVybyB3aGVuIG5vdCBmdWxseSBlbmFibGVkIGFuZCB1cCB0byB0aGUgY3VycmVudCBvdXRwdXQgbGV2ZWwgd2hlbiBiZWNvbWluZyBmdWxseSBlbmFibGVkLlxyXG4gICAgdGhpcy5mdWxseUVuYWJsZWRQcm9wZXJ0eS5saW5rKCBmdWxseUVuYWJsZWQgPT4ge1xyXG5cclxuICAgICAgY29uc3QgcHJldmlvdXNHYWluU2V0dGluZyA9IGZ1bGx5RW5hYmxlZCA/IDAgOiB0aGlzLl9vdXRwdXRMZXZlbDtcclxuICAgICAgY29uc3QgbmV3R2FpblNldHRpbmcgPSBmdWxseUVuYWJsZWQgPyB0aGlzLl9vdXRwdXRMZXZlbCA6IDA7XHJcbiAgICAgIGNvbnN0IG5vdyA9IHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lO1xyXG5cclxuICAgICAgLy8gRm9yIHRoZSBsaW5lYXIgcmFtcCB0byB3b3JrIGNvbnNpc3RlbnRseSBvbiBhbGwgYnJvd3NlcnMsIHRoZSBnYWluIG11c3QgYmUgZXhwbGljaXRseSBzZXQgdG8gd2hhdCBpdCBpc1xyXG4gICAgICAvLyBzdXBwb3NlZCB0byBiZSBiZWZvcmUgbWFraW5nIGFueSBjaGFuZ2VzLiAgT3RoZXJ3aXNlLCBpdCBtYXkgZXh0cmFwb2xhdGUgZnJvbSB0aGUgbW9zdCByZWNlbnQgcHJldmlvdXMgZXZlbnQuXHJcbiAgICAgIHRoaXMubWFzdGVyR2Fpbk5vZGUuZ2Fpbi5zZXRWYWx1ZUF0VGltZSggcHJldmlvdXNHYWluU2V0dGluZywgbm93ICk7XHJcblxyXG4gICAgICAvLyBSYW1wIHRoZSBnYWluIHRvIHRoZSBuZXcgbGV2ZWwuXHJcbiAgICAgIHRoaXMubWFzdGVyR2Fpbk5vZGUuZ2Fpbi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZShcclxuICAgICAgICBuZXdHYWluU2V0dGluZyxcclxuICAgICAgICB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSArIHNvdW5kQ29uc3RhbnRzLkRFRkFVTFRfTElORUFSX0dBSU5fQ0hBTkdFX1RJTUVcclxuICAgICAgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnNvdW5kU291cmNlRGVzdGluYXRpb24gPSB0aGlzLm1hc3RlckdhaW5Ob2RlO1xyXG5cclxuICAgIC8vIEluc2VydCBhbnkgYWRkaXRpb25hbCBhdWRpbyBub2RlcyBpbnRvIHRoZSBzaWduYWwgY2hhaW4gYnkgaXRlcmF0aW5nIGJhY2t3YXJkcyB0aHJvdWdoIHRoZSBwcm92aWRlZCBsaXN0LlxyXG4gICAgZm9yICggbGV0IGkgPSBvcHRpb25zLmFkZGl0aW9uYWxBdWRpb05vZGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tICkge1xyXG4gICAgICBjb25zdCBhdWRpb05vZGUgPSBvcHRpb25zLmFkZGl0aW9uYWxBdWRpb05vZGVzWyBpIF07XHJcbiAgICAgIGF1ZGlvTm9kZS5jb25uZWN0KCB0aGlzLnNvdW5kU291cmNlRGVzdGluYXRpb24gKTtcclxuICAgICAgdGhpcy5zb3VuZFNvdXJjZURlc3RpbmF0aW9uID0gYXVkaW9Ob2RlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICggVGFuZGVtLlBIRVRfSU9fRU5BQkxFRCAmJiAhb3B0aW9ucy5lbmFibGVkRHVyaW5nUGhldGlvU3RhdGVTZXR0aW5nICkge1xyXG4gICAgICBpZiAoIFRhbmRlbS5sYXVuY2hlZCApIHtcclxuICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBub3RTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eSwgJ1Nob3VsZCBleGlzdCBhZnRlciBsYXVuY2gnICk7XHJcblxyXG4gICAgICAgIC8vIElmIHRoaXMgU291bmRHZW5lcmF0b3IgaXMgYmVpbmcgY29uc3RydWN0ZWQgYWZ0ZXIgUGhFVC1pTyBoYXMgYmVlbiBzdGFydGVkLCBhZGQgYW4gZW5hYmxlLWNvbnRyb2wgUHJvcGVydHkgdG9cclxuICAgICAgICAvLyBwcmV2ZW50IHNvdW5kIGR1cmluZyB0aGUgc2V0dGluZyBvZiBQaEVULWlPIHN0YXRlLlxyXG4gICAgICAgIHRoaXMuYWRkRW5hYmxlQ29udHJvbFByb3BlcnR5KCBub3RTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAvLyBJZiB0aGlzIFNvdW5kR2VuZXJhdG9yIGlzIGJlaW5nIGNvbnN0cnVjdGVkIGJlZm9yZSBQaEVULWlPIGlzIGZ1bGx5IHNldCB1cCwgYWRkIGEgbGlzdGVuZXIsIGNhbGxlZCBvbmNlXHJcbiAgICAgICAgLy8gUGhFVC1pTyBpcyByZWFkeSwgdG8gdGhlbiBhZGQgYW4gZW5hYmxlLWNvbnRyb2wgUHJvcGVydHkgdGhhdCB3aWxsIHByZXZlbnQgc291bmQgZHVyaW5nIHRoZSBzZXR0aW5nIG9mXHJcbiAgICAgICAgLy8gUGhFVC1pTyBzdGF0ZS5cclxuICAgICAgICBUYW5kZW0uYWRkTGF1bmNoTGlzdGVuZXIoICgpID0+IHtcclxuICAgICAgICAgIGlmICggIW5vdFNldHRpbmdQaGV0aW9TdGF0ZVByb3BlcnR5ICkge1xyXG5cclxuICAgICAgICAgICAgLy8gU3RvcmUgdGhpcyBmb3IgbGF0ZXIgaW5zdGFudGlhdGlvbnMgb2YgU291bmRHZW5lcmF0b3JcclxuICAgICAgICAgICAgbm90U2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkgPSBEZXJpdmVkUHJvcGVydHkubm90KCBwaGV0LnBoZXRpby5waGV0aW9FbmdpbmUucGhldGlvU3RhdGVFbmdpbmUuaXNTZXR0aW5nU3RhdGVQcm9wZXJ0eSApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGhpcy5hZGRFbmFibGVDb250cm9sUHJvcGVydHkoIG5vdFNldHRpbmdQaGV0aW9TdGF0ZVByb3BlcnR5ICk7XHJcbiAgICAgICAgfSApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlU291bmRHZW5lcmF0b3IgPSAoKSA9PiB7XHJcblxyXG4gICAgICAvLyBDbGVhcmluZyB0aGlzIG9ic2VydmFibGUgYXJyYXkgc2hvdWxkIGNhdXNlIHRoZSBQcm9wZXJ0aWVzIHdpdGhpbiBpdCB0byBiZSB1bmxpbmtlZC5cclxuICAgICAgdGhpcy5lbmFibGVDb250cm9sUHJvcGVydGllcy5jbGVhcigpO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbm5lY3QgdGhlIHNvdW5kIGdlbmVyYXRvciB0byBhbiBhdWRpbyBwYXJhbWV0ZXIuXHJcbiAgICovXHJcbiAgcHVibGljIGNvbm5lY3QoIGF1ZGlvUGFyYW06IEF1ZGlvUGFyYW0gfCBBdWRpb05vZGUgKTogdm9pZCB7XHJcbiAgICB0aGlzLm1hc3RlckdhaW5Ob2RlLmNvbm5lY3QoIGF1ZGlvUGFyYW0gYXMgQXVkaW9QYXJhbSApO1xyXG5cclxuICAgIC8vIFRyYWNrIHRoaXMgc291bmQgZ2VuZXJhdG9yJ3MgY29ubmVjdGlvbnMuICBUaGlzIGlzIG5lY2Vzc2FyeSBiZWNhdXNlIFdlYiBBdWRpbyBkb2Vzbid0IHN1cHBvcnQgY2hlY2tpbmcgd2hpY2hcclxuICAgIC8vIG5vZGVzIGFyZSBjb25uZWN0ZWQgdG8gd2hpY2gsIGFuZCB3ZSBuZWVkIHRoaXMgaW5mb3JtYXRpb24gd2hlbiBkaXNjb25uZWN0aW5nLlxyXG4gICAgdGhpcy5jb25uZWN0aW9uTGlzdC5wdXNoKCBhdWRpb1BhcmFtIGFzIEF1ZGlvUGFyYW0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERpc2Nvbm5lY3QgdGhlIHNvdW5kIGdlbmVyYXRvciBmcm9tIGFuIGF1ZGlvIHBhcmFtZXRlci5cclxuICAgKi9cclxuICBwdWJsaWMgZGlzY29ubmVjdCggYXVkaW9QYXJhbTogQXVkaW9QYXJhbSB8IEF1ZGlvTm9kZSApOiB2b2lkIHtcclxuICAgIHRoaXMubWFzdGVyR2Fpbk5vZGUuZGlzY29ubmVjdCggYXVkaW9QYXJhbSBhcyBBdWRpb05vZGUgKTtcclxuICAgIHRoaXMuY29ubmVjdGlvbkxpc3QgPSBfLndpdGhvdXQoIHRoaXMuY29ubmVjdGlvbkxpc3QsIGF1ZGlvUGFyYW0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRlc3QgaWYgdGhpcyBzb3VuZCBnZW5lcmF0b3IgaXMgY29ubmVjdGVkIHRvIHRoZSBwcm92aWRlZCBhdWRpbyBwYXJhbS5cclxuICAgKi9cclxuICBwdWJsaWMgaXNDb25uZWN0ZWRUbyggYXVkaW9QYXJhbTogQXVkaW9QYXJhbSB8IEF1ZGlvTm9kZSApOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb25MaXN0LmluY2x1ZGVzKCBhdWRpb1BhcmFtICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIG91dHB1dCBsZXZlbCBvZiB0aGUgc291bmQgZ2VuZXJhdG9yLlxyXG4gICAqIEBwYXJhbSBvdXRwdXRMZXZlbCAtIGdlbmVyYWxseSBiZXR3ZWVuIDAgYW5kIDEsIGJ1dCBjYW4gYmUgbGFyZ2VyIHRoYW4gMSBpZiBuZWNlc3NhcnkgdG8gYW1wbGlmeSBhIHNtYWxsXHJcbiAgICogICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLCBhbmQgY2FuIGJlIG5lZ2F0aXZlIHRvIGludmVydCB0aGUgcGhhc2VcclxuICAgKiBAcGFyYW0gW3RpbWVDb25zdGFudF0gLSB0aW1lIGNvbnN0YW50IGZvciBjaGFuZ2UsIGxvbmdlciB2YWx1ZXMgbWVhbiBzbG93ZXIgdHJhbnNpdGlvbnMsIGluIHNlY29uZHNcclxuICAgKi9cclxuICBwdWJsaWMgc2V0T3V0cHV0TGV2ZWwoIG91dHB1dExldmVsOiBudW1iZXIsIHRpbWVDb25zdGFudDogbnVtYmVyID0gREVGQVVMVF9USU1FX0NPTlNUQU5UICk6IHZvaWQge1xyXG5cclxuICAgIC8vIElnbm9yZSBhdHRlbXB0cyB0byBzZXQgdGhlIG91dHB1dCBsZXZlbCB0byB0aGUgc2FtZSB2YWx1ZS5cclxuICAgIGlmICggb3V0cHV0TGV2ZWwgIT09IHRoaXMuX291dHB1dExldmVsICkge1xyXG4gICAgICBjb25zdCBub3cgPSB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZTtcclxuXHJcbiAgICAgIC8vIFRoZSBvdXRwdXQgbGV2ZWwgc2hvdWxkIHRha2UgZWZmZWN0IGltbWVkaWF0ZWx5IGlmIHRoaXMgc291bmQgZ2VuZXJhdG9yIGlzIGZ1bGx5IGVuYWJsZWQuICBPdGhlcndpc2UsIHRoZSB2YWx1ZVxyXG4gICAgICAvLyBpcyBzYXZlZCBhbmQgcmVzdG9yZWQgdGhlIG5leHQgdGltZSB0aGUgc291bmQgZ2VuZXJhdG9yIHRyYW5zaXRpb25zIHRvIGZ1bGx5IGVuYWJsZWQuXHJcbiAgICAgIGlmICggdGhpcy5mdWxseUVuYWJsZWRQcm9wZXJ0eS52YWx1ZSApIHtcclxuXHJcbiAgICAgICAgLy8gQ2FuY2VsIGFueSBnYWluIHRyYW5zaXRpb25zIHRoYXQgYXJlIGN1cnJlbnRseSBpbiBwcm9ncmVzcy5cclxuICAgICAgICB0aGlzLm1hc3RlckdhaW5Ob2RlLmdhaW4uY2FuY2VsU2NoZWR1bGVkVmFsdWVzKCBub3cgKTtcclxuXHJcbiAgICAgICAgLy8gU2V0IHRoZSBvdXRwdXQgbGV2ZWwgb24gdGhlIGdhaW4gbm9kZS4gIEEgZGlmZmVyZW50IG1ldGhvZCBpcyB1c2VkIGZvciBpbnN0YW50IGNoYW5nZXMuXHJcbiAgICAgICAgaWYgKCB0aW1lQ29uc3RhbnQgPT09IDAgKSB7XHJcbiAgICAgICAgICB0aGlzLm1hc3RlckdhaW5Ob2RlLmdhaW4uc2V0VmFsdWVBdFRpbWUoIG91dHB1dExldmVsLCBub3cgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgICAgLy8gVGhlIHNldFRhcmdldEF0VGltZSBtZXRob2QgZG9lc24ndCBzZWVtIHRvIHdvcmsgaWYgdGhlIGF1ZGlvIGNvbnRleHQgaXNuJ3QgcnVubmluZywgYW5kIHRoZSBldmVudCBkb2Vzbid0XHJcbiAgICAgICAgICAvLyBzZWVtIHRvIGJlIHNjaGVkdWxlZCAtIGl0J3MganVzdCBpZ25vcmVkLiAgU28sIGlmIHRoZSBhdWRpbyBjb250ZXh0IGlzbid0IHJ1bm5pbmcsIHVzZSBhbiBhbHRlcm5hdGl2ZVxyXG4gICAgICAgICAgLy8gYXBwcm9hY2guICBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3RhbWJvL2lzc3Vlcy83NC5cclxuICAgICAgICAgIGlmICggdGhpcy5hdWRpb0NvbnRleHQuc3RhdGUgPT09ICdydW5uaW5nJyApIHtcclxuICAgICAgICAgICAgdGhpcy5tYXN0ZXJHYWluTm9kZS5nYWluLnNldFRhcmdldEF0VGltZSggb3V0cHV0TGV2ZWwsIG5vdywgdGltZUNvbnN0YW50ICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5tYXN0ZXJHYWluTm9kZS5nYWluLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKFxyXG4gICAgICAgICAgICAgIG91dHB1dExldmVsLFxyXG4gICAgICAgICAgICAgIG5vdyArIHNvdW5kQ29uc3RhbnRzLkRFRkFVTFRfTElORUFSX0dBSU5fQ0hBTkdFX1RJTUVcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFNldCBsb2NhbCBjb3B5IG9mIG91dHB1dCBsZXZlbC5cclxuICAgICAgdGhpcy5fb3V0cHV0TGV2ZWwgPSBvdXRwdXRMZXZlbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgb3V0cHV0TGV2ZWwoIG91dHB1dExldmVsOiBudW1iZXIgKSB7XHJcbiAgICB0aGlzLnNldE91dHB1dExldmVsKCBvdXRwdXRMZXZlbCApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBvdXRwdXRMZXZlbCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0T3V0cHV0TGV2ZWwoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgY3VycmVudCBvdXRwdXQgbGV2ZWwgc2V0dGluZy4gIE5vdGUgdGhhdCBpZiB0aGUgc291bmQgZ2VuZXJhdG9yIGlzIGRpc2FibGVkLCB0aGlzIGNvdWxkIHJldHVybiBhIG5vbi16ZXJvXHJcbiAgICogdmFsdWUgYnV0IHRoZSBzb3VuZCBnZW5lcmF0b3Igd29uJ3QgcHJvZHVjZSBhdWRpYmxlIHNvdW5kLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRPdXRwdXRMZXZlbCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX291dHB1dExldmVsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWRkIGEgUHJvcGVydHkgdG8gdGhlIGxpc3Qgb2YgdGhvc2UgdXNlZCB0byBjb250cm9sIHRoZSBlbmFibGVkIHN0YXRlIG9mIHRoaXMgc291bmQgZ2VuZXJhdG9yLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRFbmFibGVDb250cm9sUHJvcGVydHkoIGVuYWJsZUNvbnRyb2xQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4gKTogdm9pZCB7XHJcbiAgICB0aGlzLmVuYWJsZUNvbnRyb2xQcm9wZXJ0aWVzLnB1c2goIGVuYWJsZUNvbnRyb2xQcm9wZXJ0eSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVtb3ZlIGEgUHJvcGVydHkgZnJvbSB0aGUgbGlzdCBvZiB0aG9zZSB1c2VkIHRvIGNvbnRyb2wgdGhlIGVuYWJsZWQgc3RhdGUgb2YgdGhpcyBzb3VuZCBnZW5lcmF0b3IuXHJcbiAgICovXHJcbiAgcHVibGljIHJlbW92ZUVuYWJsZUNvbnRyb2xQcm9wZXJ0eSggZW5hYmxlQ29udHJvbFByb3BlcnR5OiBUUHJvcGVydHk8Ym9vbGVhbj4gKTogdm9pZCB7XHJcbiAgICB0aGlzLmVuYWJsZUNvbnRyb2xQcm9wZXJ0aWVzLnJlbW92ZSggZW5hYmxlQ29udHJvbFByb3BlcnR5ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGxvY2FsbHlFbmFibGVkKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMubG9jYWxseUVuYWJsZWRQcm9wZXJ0eS52YWx1ZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgbG9jYWxseUVuYWJsZWQoIGxvY2FsbHlFbmFibGVkOiBib29sZWFuICkge1xyXG4gICAgdGhpcy5sb2NhbGx5RW5hYmxlZFByb3BlcnR5LnZhbHVlID0gbG9jYWxseUVuYWJsZWQ7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGZ1bGx5RW5hYmxlZCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmZ1bGx5RW5hYmxlZFByb3BlcnR5LnZhbHVlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc3Bvc2VTb3VuZEdlbmVyYXRvcigpO1xyXG4gIH1cclxufVxyXG5cclxudGFtYm8ucmVnaXN0ZXIoICdTb3VuZEdlbmVyYXRvcicsIFNvdW5kR2VuZXJhdG9y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