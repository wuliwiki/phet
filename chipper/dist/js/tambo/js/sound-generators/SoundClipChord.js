// Copyright 2020-2022, University of Colorado Boulder

/**
 * SoundClipChord plays a chord built from the given sound.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import merge from '../../../phet-core/js/merge.js';
import optionize from '../../../phet-core/js/optionize.js';
import SoundClip from '../../../tambo/js/sound-generators/SoundClip.js';
import SoundGenerator from '../../../tambo/js/sound-generators/SoundGenerator.js';
import tambo from '../tambo.js';
class SoundClipChord extends SoundGenerator {
  // whether to play the chord as an arpeggio

  // total time to play arpeggio, if enabled

  // sound clips to play in the chord

  // flag indicating whether this is currently playing

  constructor(sound, providedOptions) {
    const options = optionize()({
      initialOutputLevel: 0.7,
      soundClipOptions: null,
      arpeggiate: false,
      arpeggiateTime: 0.10,
      // in seconds, the total time that it will take the chord to arpeggiate
      chordPlaybackRates: [Math.pow(2, 1 / 12), Math.pow(2, 4 / 12), Math.pow(2, 7 / 12)] // default to major chord
    }, providedOptions);
    if (options.soundClipOptions) {
      assert && assert(options.soundClipOptions.initialPlaybackRate === undefined, 'SoundClipChord sets the initialPlaybackRate for its SoundClips');
    }
    super(options);
    this.arpeggiate = options.arpeggiate;
    this.arpeggiateTime = options.arpeggiateTime;
    this.playbackSoundClips = options.chordPlaybackRates.map(playbackRate => {
      const soundClip = new SoundClip(sound, merge({
        initialPlaybackRate: playbackRate
      }, options.soundClipOptions));
      soundClip.connect(this.soundSourceDestination);
      return soundClip;
    });
    this.isPlayingProperty = DerivedProperty.or(this.playbackSoundClips.map(soundClip => soundClip.isPlayingProperty));
  }

  /**
   * Play the chord.
   */
  play() {
    this.playbackSoundClips.forEach((soundClip, index) => {
      const delay = this.arpeggiate ? index * this.arpeggiateTime / this.playbackSoundClips.length : 0;
      soundClip.play(delay);
    });
  }

  /**
   * Stop the chord if it's playing.  This is mostly here to complete the TSoundPlayer interface.
   */
  stop() {
    this.playbackSoundClips.forEach(soundClip => {
      soundClip.stop();
    });
  }

  /**
   * Release any memory references in order to avoid memory leaks.
   */
  dispose() {
    this.playbackSoundClips.forEach(soundClip => soundClip.dispose());
    this.playbackSoundClips.length = 0;
    super.dispose();
  }
}
tambo.register('SoundClipChord', SoundClipChord);
export default SoundClipChord;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJtZXJnZSIsIm9wdGlvbml6ZSIsIlNvdW5kQ2xpcCIsIlNvdW5kR2VuZXJhdG9yIiwidGFtYm8iLCJTb3VuZENsaXBDaG9yZCIsImNvbnN0cnVjdG9yIiwic291bmQiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiaW5pdGlhbE91dHB1dExldmVsIiwic291bmRDbGlwT3B0aW9ucyIsImFycGVnZ2lhdGUiLCJhcnBlZ2dpYXRlVGltZSIsImNob3JkUGxheWJhY2tSYXRlcyIsIk1hdGgiLCJwb3ciLCJhc3NlcnQiLCJpbml0aWFsUGxheWJhY2tSYXRlIiwidW5kZWZpbmVkIiwicGxheWJhY2tTb3VuZENsaXBzIiwibWFwIiwicGxheWJhY2tSYXRlIiwic291bmRDbGlwIiwiY29ubmVjdCIsInNvdW5kU291cmNlRGVzdGluYXRpb24iLCJpc1BsYXlpbmdQcm9wZXJ0eSIsIm9yIiwicGxheSIsImZvckVhY2giLCJpbmRleCIsImRlbGF5IiwibGVuZ3RoIiwic3RvcCIsImRpc3Bvc2UiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlNvdW5kQ2xpcENob3JkLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIwLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFNvdW5kQ2xpcENob3JkIHBsYXlzIGEgY2hvcmQgYnVpbHQgZnJvbSB0aGUgZ2l2ZW4gc291bmQuXHJcbiAqXHJcbiAqIEBhdXRob3IgTWljaGFlbCBLYXV6bWFubiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBTb3VuZENsaXAsIHsgU291bmRDbGlwT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL3RhbWJvL2pzL3NvdW5kLWdlbmVyYXRvcnMvU291bmRDbGlwLmpzJztcclxuaW1wb3J0IFNvdW5kR2VuZXJhdG9yLCB7IFNvdW5kR2VuZXJhdG9yT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL3RhbWJvL2pzL3NvdW5kLWdlbmVyYXRvcnMvU291bmRHZW5lcmF0b3IuanMnO1xyXG5pbXBvcnQgdGFtYm8gZnJvbSAnLi4vdGFtYm8uanMnO1xyXG5pbXBvcnQgV3JhcHBlZEF1ZGlvQnVmZmVyIGZyb20gJy4uL1dyYXBwZWRBdWRpb0J1ZmZlci5qcyc7XHJcbmltcG9ydCBUU291bmRQbGF5ZXIgZnJvbSAnLi4vVFNvdW5kUGxheWVyLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gb3B0aW9ucyBwYXNzZWQgYWxvbmcgdG8gZWFjaCBTb3VuZENsaXAgdXNlZCBpbiB0aGUgY2hvcmRcclxuICBzb3VuZENsaXBPcHRpb25zPzogU291bmRDbGlwT3B0aW9ucyB8IG51bGw7XHJcblxyXG4gIC8vIFdoZW4gdHJ1ZSwgdGhlIGNob3JkIHdpbGwgcGxheSB3aXRoIGEgZGVsYXkgYmV0d2VlbiBlYWNoIG5vdGUsIHN0YXJ0aW5nIHdpdGggdGhlIGZpcnN0IG5vdGUgaW4gY2hvcmRQbGF5YmFja1JhdGVzXHJcbiAgLy8gYW5kIGVuZGluZyB3aXRoIHRoZSBsYXN0LlxyXG4gIGFycGVnZ2lhdGU/OiBib29sZWFuO1xyXG5cclxuICAvLyBpbiBzZWNvbmRzLCB0aGUgdG90YWwgdGltZSB0aGF0IGl0IHdpbGwgdGFrZSB0aGUgY2hvcmQgdG8gYXJwZWdnaWF0ZVxyXG4gIGFycGVnZ2lhdGVUaW1lPzogbnVtYmVyO1xyXG5cclxuICAvLyBwbGF5YmFjayByYXRlcyBmb3IgdGhlIG5vdGVzIGluIHRoZSBjaG9yZFxyXG4gIGNob3JkUGxheWJhY2tSYXRlcz86IG51bWJlcltdO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgU291bmRDbGlwQ2hvcmRPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTb3VuZEdlbmVyYXRvck9wdGlvbnM7XHJcblxyXG5jbGFzcyBTb3VuZENsaXBDaG9yZCBleHRlbmRzIFNvdW5kR2VuZXJhdG9yIGltcGxlbWVudHMgVFNvdW5kUGxheWVyIHtcclxuXHJcbiAgLy8gd2hldGhlciB0byBwbGF5IHRoZSBjaG9yZCBhcyBhbiBhcnBlZ2dpb1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgYXJwZWdnaWF0ZTogYm9vbGVhbjtcclxuXHJcbiAgLy8gdG90YWwgdGltZSB0byBwbGF5IGFycGVnZ2lvLCBpZiBlbmFibGVkXHJcbiAgcHJpdmF0ZSByZWFkb25seSBhcnBlZ2dpYXRlVGltZTogbnVtYmVyO1xyXG5cclxuICAvLyBzb3VuZCBjbGlwcyB0byBwbGF5IGluIHRoZSBjaG9yZFxyXG4gIHByaXZhdGUgcmVhZG9ubHkgcGxheWJhY2tTb3VuZENsaXBzOiBTb3VuZENsaXBbXTtcclxuXHJcbiAgLy8gZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgdGhpcyBpcyBjdXJyZW50bHkgcGxheWluZ1xyXG4gIHB1YmxpYyByZWFkb25seSBpc1BsYXlpbmdQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvciggc291bmQ6IFdyYXBwZWRBdWRpb0J1ZmZlciwgcHJvdmlkZWRPcHRpb25zPzogU291bmRDbGlwQ2hvcmRPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8U291bmRDbGlwQ2hvcmRPcHRpb25zLCBTZWxmT3B0aW9ucywgU291bmRHZW5lcmF0b3JPcHRpb25zPigpKCB7XHJcbiAgICAgIGluaXRpYWxPdXRwdXRMZXZlbDogMC43LFxyXG4gICAgICBzb3VuZENsaXBPcHRpb25zOiBudWxsLFxyXG4gICAgICBhcnBlZ2dpYXRlOiBmYWxzZSxcclxuICAgICAgYXJwZWdnaWF0ZVRpbWU6IDAuMTAsIC8vIGluIHNlY29uZHMsIHRoZSB0b3RhbCB0aW1lIHRoYXQgaXQgd2lsbCB0YWtlIHRoZSBjaG9yZCB0byBhcnBlZ2dpYXRlXHJcbiAgICAgIGNob3JkUGxheWJhY2tSYXRlczogWyBNYXRoLnBvdyggMiwgMSAvIDEyICksIE1hdGgucG93KCAyLCA0IC8gMTIgKSwgTWF0aC5wb3coIDIsIDcgLyAxMiApIF0gLy8gZGVmYXVsdCB0byBtYWpvciBjaG9yZFxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgaWYgKCBvcHRpb25zLnNvdW5kQ2xpcE9wdGlvbnMgKSB7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoXHJcbiAgICAgICAgb3B0aW9ucy5zb3VuZENsaXBPcHRpb25zLmluaXRpYWxQbGF5YmFja1JhdGUgPT09IHVuZGVmaW5lZCxcclxuICAgICAgICAnU291bmRDbGlwQ2hvcmQgc2V0cyB0aGUgaW5pdGlhbFBsYXliYWNrUmF0ZSBmb3IgaXRzIFNvdW5kQ2xpcHMnXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLmFycGVnZ2lhdGUgPSBvcHRpb25zLmFycGVnZ2lhdGU7XHJcbiAgICB0aGlzLmFycGVnZ2lhdGVUaW1lID0gb3B0aW9ucy5hcnBlZ2dpYXRlVGltZTtcclxuICAgIHRoaXMucGxheWJhY2tTb3VuZENsaXBzID0gb3B0aW9ucy5jaG9yZFBsYXliYWNrUmF0ZXMubWFwKCBwbGF5YmFja1JhdGUgPT4ge1xyXG4gICAgICBjb25zdCBzb3VuZENsaXAgPSBuZXcgU291bmRDbGlwKCBzb3VuZCwgbWVyZ2UoIHtcclxuICAgICAgICBpbml0aWFsUGxheWJhY2tSYXRlOiBwbGF5YmFja1JhdGVcclxuICAgICAgfSwgb3B0aW9ucy5zb3VuZENsaXBPcHRpb25zICkgKTtcclxuICAgICAgc291bmRDbGlwLmNvbm5lY3QoIHRoaXMuc291bmRTb3VyY2VEZXN0aW5hdGlvbiApO1xyXG4gICAgICByZXR1cm4gc291bmRDbGlwO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuaXNQbGF5aW5nUHJvcGVydHkgPSBEZXJpdmVkUHJvcGVydHkub3IoIHRoaXMucGxheWJhY2tTb3VuZENsaXBzLm1hcCggc291bmRDbGlwID0+IHNvdW5kQ2xpcC5pc1BsYXlpbmdQcm9wZXJ0eSApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQbGF5IHRoZSBjaG9yZC5cclxuICAgKi9cclxuICBwdWJsaWMgcGxheSgpOiB2b2lkIHtcclxuICAgIHRoaXMucGxheWJhY2tTb3VuZENsaXBzLmZvckVhY2goICggc291bmRDbGlwLCBpbmRleCApID0+IHtcclxuICAgICAgY29uc3QgZGVsYXkgPSB0aGlzLmFycGVnZ2lhdGUgPyBpbmRleCAqIHRoaXMuYXJwZWdnaWF0ZVRpbWUgLyB0aGlzLnBsYXliYWNrU291bmRDbGlwcy5sZW5ndGggOiAwO1xyXG4gICAgICBzb3VuZENsaXAucGxheSggZGVsYXkgKTtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0b3AgdGhlIGNob3JkIGlmIGl0J3MgcGxheWluZy4gIFRoaXMgaXMgbW9zdGx5IGhlcmUgdG8gY29tcGxldGUgdGhlIFRTb3VuZFBsYXllciBpbnRlcmZhY2UuXHJcbiAgICovXHJcbiAgcHVibGljIHN0b3AoKTogdm9pZCB7XHJcbiAgICB0aGlzLnBsYXliYWNrU291bmRDbGlwcy5mb3JFYWNoKCBzb3VuZENsaXAgPT4ge1xyXG4gICAgICBzb3VuZENsaXAuc3RvcCgpO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVsZWFzZSBhbnkgbWVtb3J5IHJlZmVyZW5jZXMgaW4gb3JkZXIgdG8gYXZvaWQgbWVtb3J5IGxlYWtzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5wbGF5YmFja1NvdW5kQ2xpcHMuZm9yRWFjaCggc291bmRDbGlwID0+IHNvdW5kQ2xpcC5kaXNwb3NlKCkgKTtcclxuICAgIHRoaXMucGxheWJhY2tTb3VuZENsaXBzLmxlbmd0aCA9IDA7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG50YW1iby5yZWdpc3RlciggJ1NvdW5kQ2xpcENob3JkJywgU291bmRDbGlwQ2hvcmQgKTtcclxuZXhwb3J0IGRlZmF1bHQgU291bmRDbGlwQ2hvcmQ7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSxxQ0FBcUM7QUFDakUsT0FBT0MsS0FBSyxNQUFNLGdDQUFnQztBQUNsRCxPQUFPQyxTQUFTLE1BQU0sb0NBQW9DO0FBQzFELE9BQU9DLFNBQVMsTUFBNEIsaURBQWlEO0FBQzdGLE9BQU9DLGNBQWMsTUFBaUMsc0RBQXNEO0FBQzVHLE9BQU9DLEtBQUssTUFBTSxhQUFhO0FBdUIvQixNQUFNQyxjQUFjLFNBQVNGLGNBQWMsQ0FBeUI7RUFFbEU7O0VBR0E7O0VBR0E7O0VBR0E7O0VBR09HLFdBQVdBLENBQUVDLEtBQXlCLEVBQUVDLGVBQXVDLEVBQUc7SUFFdkYsTUFBTUMsT0FBTyxHQUFHUixTQUFTLENBQTRELENBQUMsQ0FBRTtNQUN0RlMsa0JBQWtCLEVBQUUsR0FBRztNQUN2QkMsZ0JBQWdCLEVBQUUsSUFBSTtNQUN0QkMsVUFBVSxFQUFFLEtBQUs7TUFDakJDLGNBQWMsRUFBRSxJQUFJO01BQUU7TUFDdEJDLGtCQUFrQixFQUFFLENBQUVDLElBQUksQ0FBQ0MsR0FBRyxDQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRyxDQUFDLEVBQUVELElBQUksQ0FBQ0MsR0FBRyxDQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRyxDQUFDLEVBQUVELElBQUksQ0FBQ0MsR0FBRyxDQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRyxDQUFDLENBQUUsQ0FBQztJQUM5RixDQUFDLEVBQUVSLGVBQWdCLENBQUM7SUFFcEIsSUFBS0MsT0FBTyxDQUFDRSxnQkFBZ0IsRUFBRztNQUM5Qk0sTUFBTSxJQUFJQSxNQUFNLENBQ2RSLE9BQU8sQ0FBQ0UsZ0JBQWdCLENBQUNPLG1CQUFtQixLQUFLQyxTQUFTLEVBQzFELGdFQUNGLENBQUM7SUFDSDtJQUVBLEtBQUssQ0FBRVYsT0FBUSxDQUFDO0lBRWhCLElBQUksQ0FBQ0csVUFBVSxHQUFHSCxPQUFPLENBQUNHLFVBQVU7SUFDcEMsSUFBSSxDQUFDQyxjQUFjLEdBQUdKLE9BQU8sQ0FBQ0ksY0FBYztJQUM1QyxJQUFJLENBQUNPLGtCQUFrQixHQUFHWCxPQUFPLENBQUNLLGtCQUFrQixDQUFDTyxHQUFHLENBQUVDLFlBQVksSUFBSTtNQUN4RSxNQUFNQyxTQUFTLEdBQUcsSUFBSXJCLFNBQVMsQ0FBRUssS0FBSyxFQUFFUCxLQUFLLENBQUU7UUFDN0NrQixtQkFBbUIsRUFBRUk7TUFDdkIsQ0FBQyxFQUFFYixPQUFPLENBQUNFLGdCQUFpQixDQUFFLENBQUM7TUFDL0JZLFNBQVMsQ0FBQ0MsT0FBTyxDQUFFLElBQUksQ0FBQ0Msc0JBQXVCLENBQUM7TUFDaEQsT0FBT0YsU0FBUztJQUNsQixDQUFFLENBQUM7SUFFSCxJQUFJLENBQUNHLGlCQUFpQixHQUFHM0IsZUFBZSxDQUFDNEIsRUFBRSxDQUFFLElBQUksQ0FBQ1Asa0JBQWtCLENBQUNDLEdBQUcsQ0FBRUUsU0FBUyxJQUFJQSxTQUFTLENBQUNHLGlCQUFrQixDQUFFLENBQUM7RUFDeEg7O0VBRUE7QUFDRjtBQUNBO0VBQ1NFLElBQUlBLENBQUEsRUFBUztJQUNsQixJQUFJLENBQUNSLGtCQUFrQixDQUFDUyxPQUFPLENBQUUsQ0FBRU4sU0FBUyxFQUFFTyxLQUFLLEtBQU07TUFDdkQsTUFBTUMsS0FBSyxHQUFHLElBQUksQ0FBQ25CLFVBQVUsR0FBR2tCLEtBQUssR0FBRyxJQUFJLENBQUNqQixjQUFjLEdBQUcsSUFBSSxDQUFDTyxrQkFBa0IsQ0FBQ1ksTUFBTSxHQUFHLENBQUM7TUFDaEdULFNBQVMsQ0FBQ0ssSUFBSSxDQUFFRyxLQUFNLENBQUM7SUFDekIsQ0FBRSxDQUFDO0VBQ0w7O0VBRUE7QUFDRjtBQUNBO0VBQ1NFLElBQUlBLENBQUEsRUFBUztJQUNsQixJQUFJLENBQUNiLGtCQUFrQixDQUFDUyxPQUFPLENBQUVOLFNBQVMsSUFBSTtNQUM1Q0EsU0FBUyxDQUFDVSxJQUFJLENBQUMsQ0FBQztJQUNsQixDQUFFLENBQUM7RUFDTDs7RUFFQTtBQUNGO0FBQ0E7RUFDa0JDLE9BQU9BLENBQUEsRUFBUztJQUM5QixJQUFJLENBQUNkLGtCQUFrQixDQUFDUyxPQUFPLENBQUVOLFNBQVMsSUFBSUEsU0FBUyxDQUFDVyxPQUFPLENBQUMsQ0FBRSxDQUFDO0lBQ25FLElBQUksQ0FBQ2Qsa0JBQWtCLENBQUNZLE1BQU0sR0FBRyxDQUFDO0lBQ2xDLEtBQUssQ0FBQ0UsT0FBTyxDQUFDLENBQUM7RUFDakI7QUFDRjtBQUVBOUIsS0FBSyxDQUFDK0IsUUFBUSxDQUFFLGdCQUFnQixFQUFFOUIsY0FBZSxDQUFDO0FBQ2xELGVBQWVBLGNBQWMifQ==