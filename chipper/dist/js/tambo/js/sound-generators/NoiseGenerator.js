// Copyright 2018-2022, University of Colorado Boulder

/**
 * white noise generator with optional low- and high-pass filters
 *
 * @author John Blanco
 */

import dotRandom from '../../../dot/js/dotRandom.js';
import optionize from '../../../phet-core/js/optionize.js';
import audioContextStateChangeMonitor from '../audioContextStateChangeMonitor.js';
import soundConstants from '../soundConstants.js';
import tambo from '../tambo.js';
import SoundGenerator from './SoundGenerator.js';
// constants
const NOISE_BUFFER_SECONDS = 2;
const PARAMETER_CHANGE_TIME_CONSTANT = soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT;
const LFO_DEPTH_CHANGE_TIME_CONSTANT = 0.05;
class NoiseGenerator extends SoundGenerator {
  // filter that is potentially used on the noise signal

  // buffer that holds the noise samples

  // the source node from which the noise is played, set when play is called

  // the low frequency oscillator that can be used to do amplitude modulation on the noise signal

  // gain node that is used to implement amplitude modulation

  // gain node that controls the amount of low-frequency amplitude modulation

  // point where the noise source connects

  // flag that indicates whether the noise is playing

  // time at which a play request occurred that couldn't be performed and was subsequently deferred

  // function that handles changes to the audio context

  constructor(providedOptions) {
    const options = optionize()({
      noiseType: 'pink',
      lowPassCutoffFrequency: null,
      highPassCutoffFrequency: null,
      centerFrequency: null,
      qFactor: 1,
      lfoInitiallyEnabled: false,
      lfoInitialFrequency: 2,
      lfoInitialDepth: 1,
      lfoType: 'sine'
    }, providedOptions);
    assert && assert(['white', 'pink', 'brown'].includes(options.noiseType), `invalid noise type: ${options.noiseType}`);
    assert && assert(options.lfoInitialDepth >= 0 && options.lfoInitialDepth <= 1, `invalid value for lfoInitialDepth: ${options.lfoInitialDepth}`);
    super(options);
    const now = this.audioContext.currentTime;

    // if specified, create the low-pass filter
    let lowPassFilter;
    if (options.lowPassCutoffFrequency) {
      lowPassFilter = this.audioContext.createBiquadFilter();
      lowPassFilter.type = 'lowpass';
      lowPassFilter.frequency.setValueAtTime(options.lowPassCutoffFrequency, now);
    }

    // if specified, create the high-pass filter
    let highPassFilter;
    if (options.highPassCutoffFrequency) {
      highPassFilter = this.audioContext.createBiquadFilter();
      highPassFilter.type = 'highpass';
      highPassFilter.frequency.setValueAtTime(options.highPassCutoffFrequency, now);
    }

    // if specified, create the band-pass filter
    if (options.qFactor && options.centerFrequency) {
      this.bandPassFilter = this.audioContext.createBiquadFilter();
      this.bandPassFilter.type = 'bandpass';
      this.bandPassFilter.frequency.setValueAtTime(options.centerFrequency, now);
      this.bandPassFilter.Q.setValueAtTime(options.qFactor, now);
    } else {
      this.bandPassFilter = null;
    }

    // define the noise data
    const noiseBufferSize = NOISE_BUFFER_SECONDS * this.audioContext.sampleRate;
    this.noiseBuffer = this.audioContext.createBuffer(1, noiseBufferSize, this.audioContext.sampleRate);
    const data = this.noiseBuffer.getChannelData(0);

    // fill in the sample buffer based on the noise type
    let white;
    if (options.noiseType === 'white') {
      for (let i = 0; i < noiseBufferSize; i++) {
        data[i] = dotRandom.nextDouble() * 2 - 1;
      }
    } else if (options.noiseType === 'pink') {
      let b0 = 0;
      let b1 = 0;
      let b2 = 0;
      let b3 = 0;
      let b4 = 0;
      let b5 = 0;
      let b6 = 0;
      for (let i = 0; i < noiseBufferSize; i++) {
        white = dotRandom.nextDouble() * 2 - 1;
        b0 = 0.99886 * b0 + white * 0.0555179;
        b1 = 0.99332 * b1 + white * 0.0750759;
        b2 = 0.96900 * b2 + white * 0.1538520;
        b3 = 0.86650 * b3 + white * 0.3104856;
        b4 = 0.55000 * b4 + white * 0.5329522;
        b5 = -0.7616 * b5 - white * 0.0168980;
        data[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;
        data[i] *= 0.11; // adjust to 0dB, empirically determined, will be approximate due to randomness of data
        b6 = white * 0.115926;
      }
    } else if (options.noiseType === 'brown') {
      let lastOut = 0;
      for (let i = 0; i < noiseBufferSize; i++) {
        white = dotRandom.nextDouble() * 2 - 1;
        data[i] = (lastOut + 0.02 * white) / 1.02;
        lastOut = data[i];
        data[i] *= 3.5; // adjust to 0dB, empirically determined, will be approximate due to randomness of data
      }
    } else {
      throw new Error(`unexpected value for noiseType: ${options.noiseType}`);
    }

    // the source node from which the noise is played, set when play is called
    this.noiseSource = null;

    // set up the low frequency oscillator (LFO) for amplitude modulation
    this.lfo = this.audioContext.createOscillator();
    this.lfo.type = options.lfoType;

    // initialize LFO frequency, updated through methods defined below
    this.lfo.frequency.setValueAtTime(options.lfoInitialFrequency, now);
    this.lfo.start();

    // set up the gain stage that will attenuate the LFO output so that it will range from -0.5 to +0.5
    this.lfoAttenuatorGainNode = this.audioContext.createGain();
    this.lfoAttenuatorGainNode.gain.value = options.lfoInitialDepth / 2;
    this.lfo.connect(this.lfoAttenuatorGainNode);

    // set up the gain stage for the LFO - the main sound path will run through here
    this.lfoControlledGainNode = this.audioContext.createGain();
    this.lfoControlledGainNode.gain.value = 0.5; // this value is added to the attenuated LFO output value

    // set the initial enabled state of the LFO
    if (options.lfoInitiallyEnabled) {
      this.lfoAttenuatorGainNode.gain.setTargetAtTime(0.5, this.audioContext.currentTime, PARAMETER_CHANGE_TIME_CONSTANT);
      this.lfoAttenuatorGainNode.connect(this.lfoControlledGainNode.gain);
    } else {
      this.lfoAttenuatorGainNode.gain.setTargetAtTime(1, this.audioContext.currentTime, PARAMETER_CHANGE_TIME_CONSTANT);
    }

    // wire up the audio path, working our way from the output back to the sound source(s)
    this.lfoControlledGainNode.connect(this.soundSourceDestination);
    let nextOutputToConnect = this.lfoControlledGainNode;
    if (highPassFilter) {
      highPassFilter.connect(nextOutputToConnect);
      nextOutputToConnect = highPassFilter;
    }
    if (lowPassFilter) {
      lowPassFilter.connect(nextOutputToConnect);
      nextOutputToConnect = lowPassFilter;
    }
    if (this.bandPassFilter) {
      this.bandPassFilter.connect(nextOutputToConnect);
      nextOutputToConnect = this.bandPassFilter;
    }
    this.noiseSourceConnectionPoint = nextOutputToConnect;
    this.isPlaying = false;
    this.timeOfDeferredStartRequest = Number.NEGATIVE_INFINITY;

    // define the listener for audio context state transitions
    this.audioContextStateChangeListener = state => {
      if (state === 'running' && this.isPlaying) {
        this.start();

        // automatically remove after firing
        audioContextStateChangeMonitor.removeStateChangeListener(this.audioContext, this.audioContextStateChangeListener);
      }
    };
  }

  /**
   * Start the noise source.
   * @param [delay] - optional delay for when to start the noise source, in seconds
   */
  start(delay = 0) {
    if (this.audioContext.state === 'running') {
      const now = this.audioContext.currentTime;

      // only do something if not already playing, otherwise ignore this request
      if (!this.isPlaying) {
        this.noiseSource = this.audioContext.createBufferSource();
        this.noiseSource.buffer = this.noiseBuffer;
        this.noiseSource.loop = true;
        this.noiseSource.connect(this.noiseSourceConnectionPoint);
        this.noiseSource.start(now + delay);
      }
    } else {
      // This method was called when the audio context was not yet running, so add a listener to start if and when the
      // audio context state changes.
      this.timeOfDeferredStartRequest = Date.now();
      if (!audioContextStateChangeMonitor.hasListener(this.audioContext, this.audioContextStateChangeListener)) {
        audioContextStateChangeMonitor.addStateChangeListener(this.audioContext, this.audioContextStateChangeListener);
      }
    }

    // set the flag even if the start is deferred, since it is used to decide whether to do a deferred start
    this.isPlaying = true;
  }

  /**
   * Stop the noise source.
   * @param [time] - optional audio context time at which this should be stopped
   */
  stop(time = 0) {
    // only stop if playing, otherwise ignore
    if (this.isPlaying && this.noiseSource) {
      this.noiseSource.stop(time);
      this.noiseSource = null;
    }
    this.isPlaying = false;
  }

  /**
   * Set the frequency of the low frequency amplitude modulator (LFO).
   */
  setLfoFrequency(frequency) {
    this.lfo.frequency.setTargetAtTime(frequency, this.audioContext.currentTime, PARAMETER_CHANGE_TIME_CONSTANT);
  }

  /**
   * Set the depth of the LFO modulator.
   * @param depth - depth value from 0 (no modulation) to 1 (max modulation)
   */
  setLfoDepth(depth) {
    this.lfoAttenuatorGainNode.gain.setTargetAtTime(depth / 2, this.audioContext.currentTime, LFO_DEPTH_CHANGE_TIME_CONSTANT);
  }

  /**
   * Turn the low frequency amplitude modulation on/off.
   */
  setLfoEnabled(enabled) {
    if (enabled) {
      this.lfoAttenuatorGainNode.gain.setTargetAtTime(0.5, this.audioContext.currentTime, PARAMETER_CHANGE_TIME_CONSTANT);
      this.lfoAttenuatorGainNode.connect(this.lfoControlledGainNode.gain);
    } else {
      this.lfoAttenuatorGainNode.disconnect(this.lfoControlledGainNode.gain);
      this.lfoAttenuatorGainNode.gain.setTargetAtTime(1, this.audioContext.currentTime, PARAMETER_CHANGE_TIME_CONSTANT);
    }
  }

  /**
   * set the Q value for the band pass filter, assumes that noise generator was created with this filter enabled
   */
  setBandpassFilterCenterFrequency(frequency, timeConstant) {
    timeConstant = timeConstant || PARAMETER_CHANGE_TIME_CONSTANT;
    if (this.bandPassFilter !== null) {
      this.bandPassFilter.frequency.setTargetAtTime(frequency, this.audioContext.currentTime, timeConstant);
    }
  }
}
tambo.register('NoiseGenerator', NoiseGenerator);
export default NoiseGenerator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RSYW5kb20iLCJvcHRpb25pemUiLCJhdWRpb0NvbnRleHRTdGF0ZUNoYW5nZU1vbml0b3IiLCJzb3VuZENvbnN0YW50cyIsInRhbWJvIiwiU291bmRHZW5lcmF0b3IiLCJOT0lTRV9CVUZGRVJfU0VDT05EUyIsIlBBUkFNRVRFUl9DSEFOR0VfVElNRV9DT05TVEFOVCIsIkRFRkFVTFRfUEFSQU1fQ0hBTkdFX1RJTUVfQ09OU1RBTlQiLCJMRk9fREVQVEhfQ0hBTkdFX1RJTUVfQ09OU1RBTlQiLCJOb2lzZUdlbmVyYXRvciIsImNvbnN0cnVjdG9yIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsIm5vaXNlVHlwZSIsImxvd1Bhc3NDdXRvZmZGcmVxdWVuY3kiLCJoaWdoUGFzc0N1dG9mZkZyZXF1ZW5jeSIsImNlbnRlckZyZXF1ZW5jeSIsInFGYWN0b3IiLCJsZm9Jbml0aWFsbHlFbmFibGVkIiwibGZvSW5pdGlhbEZyZXF1ZW5jeSIsImxmb0luaXRpYWxEZXB0aCIsImxmb1R5cGUiLCJhc3NlcnQiLCJpbmNsdWRlcyIsIm5vdyIsImF1ZGlvQ29udGV4dCIsImN1cnJlbnRUaW1lIiwibG93UGFzc0ZpbHRlciIsImNyZWF0ZUJpcXVhZEZpbHRlciIsInR5cGUiLCJmcmVxdWVuY3kiLCJzZXRWYWx1ZUF0VGltZSIsImhpZ2hQYXNzRmlsdGVyIiwiYmFuZFBhc3NGaWx0ZXIiLCJRIiwibm9pc2VCdWZmZXJTaXplIiwic2FtcGxlUmF0ZSIsIm5vaXNlQnVmZmVyIiwiY3JlYXRlQnVmZmVyIiwiZGF0YSIsImdldENoYW5uZWxEYXRhIiwid2hpdGUiLCJpIiwibmV4dERvdWJsZSIsImIwIiwiYjEiLCJiMiIsImIzIiwiYjQiLCJiNSIsImI2IiwibGFzdE91dCIsIkVycm9yIiwibm9pc2VTb3VyY2UiLCJsZm8iLCJjcmVhdGVPc2NpbGxhdG9yIiwic3RhcnQiLCJsZm9BdHRlbnVhdG9yR2Fpbk5vZGUiLCJjcmVhdGVHYWluIiwiZ2FpbiIsInZhbHVlIiwiY29ubmVjdCIsImxmb0NvbnRyb2xsZWRHYWluTm9kZSIsInNldFRhcmdldEF0VGltZSIsInNvdW5kU291cmNlRGVzdGluYXRpb24iLCJuZXh0T3V0cHV0VG9Db25uZWN0Iiwibm9pc2VTb3VyY2VDb25uZWN0aW9uUG9pbnQiLCJpc1BsYXlpbmciLCJ0aW1lT2ZEZWZlcnJlZFN0YXJ0UmVxdWVzdCIsIk51bWJlciIsIk5FR0FUSVZFX0lORklOSVRZIiwiYXVkaW9Db250ZXh0U3RhdGVDaGFuZ2VMaXN0ZW5lciIsInN0YXRlIiwicmVtb3ZlU3RhdGVDaGFuZ2VMaXN0ZW5lciIsImRlbGF5IiwiY3JlYXRlQnVmZmVyU291cmNlIiwiYnVmZmVyIiwibG9vcCIsIkRhdGUiLCJoYXNMaXN0ZW5lciIsImFkZFN0YXRlQ2hhbmdlTGlzdGVuZXIiLCJzdG9wIiwidGltZSIsInNldExmb0ZyZXF1ZW5jeSIsInNldExmb0RlcHRoIiwiZGVwdGgiLCJzZXRMZm9FbmFibGVkIiwiZW5hYmxlZCIsImRpc2Nvbm5lY3QiLCJzZXRCYW5kcGFzc0ZpbHRlckNlbnRlckZyZXF1ZW5jeSIsInRpbWVDb25zdGFudCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTm9pc2VHZW5lcmF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogd2hpdGUgbm9pc2UgZ2VuZXJhdG9yIHdpdGggb3B0aW9uYWwgbG93LSBhbmQgaGlnaC1wYXNzIGZpbHRlcnNcclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jb1xyXG4gKi9cclxuXHJcbmltcG9ydCBkb3RSYW5kb20gZnJvbSAnLi4vLi4vLi4vZG90L2pzL2RvdFJhbmRvbS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBhdWRpb0NvbnRleHRTdGF0ZUNoYW5nZU1vbml0b3IgZnJvbSAnLi4vYXVkaW9Db250ZXh0U3RhdGVDaGFuZ2VNb25pdG9yLmpzJztcclxuaW1wb3J0IHNvdW5kQ29uc3RhbnRzIGZyb20gJy4uL3NvdW5kQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IHRhbWJvIGZyb20gJy4uL3RhbWJvLmpzJztcclxuaW1wb3J0IFNvdW5kR2VuZXJhdG9yLCB7IFNvdW5kR2VuZXJhdG9yT3B0aW9ucyB9IGZyb20gJy4vU291bmRHZW5lcmF0b3IuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICBub2lzZVR5cGU/OiAncGluaycgfCAnd2hpdGUnIHwgJ2Jyb3duJztcclxuXHJcbiAgLy8gbG93IHBhc3MgdmFsdWUgaW4gSHosIG51bGwgKG9yIGFueSBmYWxzZXkgdmFsdWUgaW5jbHVkaW5nIHplcm8pIG1lYW5zIG5vIGxvdyBwYXNzIGZpbHRlciBpcyBhZGRlZFxyXG4gIGxvd1Bhc3NDdXRvZmZGcmVxdWVuY3k/OiBudW1iZXIgfCBudWxsO1xyXG5cclxuICAvLyBoaWdoIHBhc3MgdmFsdWUgaW4gSHosIG51bGwgKG9yIGFueSBmYWxzZXkgdmFsdWUgaW5jbHVkaW5nIHplcm8pIG1lYW5zIG5vIGhpZ2ggcGFzcyBmaWx0ZXIgaXMgYWRkZWRcclxuICBoaWdoUGFzc0N1dG9mZkZyZXF1ZW5jeT86IG51bWJlciB8IG51bGw7XHJcblxyXG4gIC8vIGNlbnRlciBmcmVxdWVuY3kgZm9yIGJhbmQgcGFzcyBmaWx0ZXIgdmFsdWUgaW4gSHosIG51bGwgKG9yIGFueSBmYWxzZXkgdmFsdWUgaW5jbHVkaW5nIHplcm8pIG1lYW5zIG5vIGJhbmQgcGFzc1xyXG4gIC8vIGZpbHRlciBpcyBhZGRlZFxyXG4gIGNlbnRlckZyZXF1ZW5jeT86IG51bWJlciB8IG51bGw7XHJcblxyXG4gIC8vIFEgZmFjdG9yLCBha2EgcXVhbGl0eSBmYWN0b3IsIGZvciBiYW5kcGFzcyBmaWx0ZXIgaWYgcHJlc2VudCwgc2VlIFdlYiBBdWRpbyBCaXF1YWRGaWx0ZXJOb2RlIGZvciBtb3JlIGluZm9ybWF0aW9uXHJcbiAgcUZhY3Rvcj86IG51bWJlcjtcclxuXHJcbiAgLy8gcGFyYW1ldGVycyB0aGF0IGNvbnRyb2wgdGhlIGJlaGF2aW9yIG9mIHRoZSBsb3cgZnJlcXVlbmN5IG9zY2lsbGF0b3IgKExGTyksIHdoaWNoIGRvZXMgYW1wbGl0dWRlIG1vZHVsYXRpb24gb25cclxuICAvLyB0aGUgbm9pc2VcclxuICBsZm9Jbml0aWFsbHlFbmFibGVkPzogYm9vbGVhbjtcclxuICBsZm9Jbml0aWFsRnJlcXVlbmN5PzogbnVtYmVyOyAvLyBpbiBIelxyXG4gIGxmb0luaXRpYWxEZXB0aD86IG51bWJlcjsgLy8gdmFsaWQgdmFsdWVzIGFyZSBmcm9tIDAgdG8gMVxyXG4gIGxmb1R5cGU/OiBPc2NpbGxhdG9yVHlwZTtcclxufTtcclxuZXhwb3J0IHR5cGUgTm9pc2VHZW5lcmF0b3JPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTb3VuZEdlbmVyYXRvck9wdGlvbnM7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgTk9JU0VfQlVGRkVSX1NFQ09ORFMgPSAyO1xyXG5jb25zdCBQQVJBTUVURVJfQ0hBTkdFX1RJTUVfQ09OU1RBTlQgPSBzb3VuZENvbnN0YW50cy5ERUZBVUxUX1BBUkFNX0NIQU5HRV9USU1FX0NPTlNUQU5UO1xyXG5jb25zdCBMRk9fREVQVEhfQ0hBTkdFX1RJTUVfQ09OU1RBTlQgPSAwLjA1O1xyXG5cclxuY2xhc3MgTm9pc2VHZW5lcmF0b3IgZXh0ZW5kcyBTb3VuZEdlbmVyYXRvciB7XHJcblxyXG4gIC8vIGZpbHRlciB0aGF0IGlzIHBvdGVudGlhbGx5IHVzZWQgb24gdGhlIG5vaXNlIHNpZ25hbFxyXG4gIHByaXZhdGUgcmVhZG9ubHkgYmFuZFBhc3NGaWx0ZXI6IEJpcXVhZEZpbHRlck5vZGUgfCBudWxsO1xyXG5cclxuICAvLyBidWZmZXIgdGhhdCBob2xkcyB0aGUgbm9pc2Ugc2FtcGxlc1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbm9pc2VCdWZmZXI6IEF1ZGlvQnVmZmVyO1xyXG5cclxuICAvLyB0aGUgc291cmNlIG5vZGUgZnJvbSB3aGljaCB0aGUgbm9pc2UgaXMgcGxheWVkLCBzZXQgd2hlbiBwbGF5IGlzIGNhbGxlZFxyXG4gIHByaXZhdGUgbm9pc2VTb3VyY2U6IEF1ZGlvQnVmZmVyU291cmNlTm9kZSB8IG51bGw7XHJcblxyXG4gIC8vIHRoZSBsb3cgZnJlcXVlbmN5IG9zY2lsbGF0b3IgdGhhdCBjYW4gYmUgdXNlZCB0byBkbyBhbXBsaXR1ZGUgbW9kdWxhdGlvbiBvbiB0aGUgbm9pc2Ugc2lnbmFsXHJcbiAgcHJpdmF0ZSByZWFkb25seSBsZm86IE9zY2lsbGF0b3JOb2RlO1xyXG5cclxuICAvLyBnYWluIG5vZGUgdGhhdCBpcyB1c2VkIHRvIGltcGxlbWVudCBhbXBsaXR1ZGUgbW9kdWxhdGlvblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgbGZvQXR0ZW51YXRvckdhaW5Ob2RlOiBHYWluTm9kZTtcclxuXHJcbiAgLy8gZ2FpbiBub2RlIHRoYXQgY29udHJvbHMgdGhlIGFtb3VudCBvZiBsb3ctZnJlcXVlbmN5IGFtcGxpdHVkZSBtb2R1bGF0aW9uXHJcbiAgcHJpdmF0ZSByZWFkb25seSBsZm9Db250cm9sbGVkR2Fpbk5vZGU6IEdhaW5Ob2RlO1xyXG5cclxuICAvLyBwb2ludCB3aGVyZSB0aGUgbm9pc2Ugc291cmNlIGNvbm5lY3RzXHJcbiAgcHJpdmF0ZSByZWFkb25seSBub2lzZVNvdXJjZUNvbm5lY3Rpb25Qb2ludDogQXVkaW9Ob2RlO1xyXG5cclxuICAvLyBmbGFnIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgdGhlIG5vaXNlIGlzIHBsYXlpbmdcclxuICBwcml2YXRlIGlzUGxheWluZzogYm9vbGVhbjtcclxuXHJcbiAgLy8gdGltZSBhdCB3aGljaCBhIHBsYXkgcmVxdWVzdCBvY2N1cnJlZCB0aGF0IGNvdWxkbid0IGJlIHBlcmZvcm1lZCBhbmQgd2FzIHN1YnNlcXVlbnRseSBkZWZlcnJlZFxyXG4gIHByaXZhdGUgdGltZU9mRGVmZXJyZWRTdGFydFJlcXVlc3Q6IG51bWJlcjtcclxuXHJcbiAgLy8gZnVuY3Rpb24gdGhhdCBoYW5kbGVzIGNoYW5nZXMgdG8gdGhlIGF1ZGlvIGNvbnRleHRcclxuICBwcml2YXRlIHJlYWRvbmx5IGF1ZGlvQ29udGV4dFN0YXRlQ2hhbmdlTGlzdGVuZXI6ICggc3RhdGU6IHN0cmluZyApID0+IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcHJvdmlkZWRPcHRpb25zPzogTm9pc2VHZW5lcmF0b3JPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8Tm9pc2VHZW5lcmF0b3JPcHRpb25zLCBTZWxmT3B0aW9ucywgU291bmRHZW5lcmF0b3JPcHRpb25zPigpKCB7XHJcbiAgICAgIG5vaXNlVHlwZTogJ3BpbmsnLFxyXG4gICAgICBsb3dQYXNzQ3V0b2ZmRnJlcXVlbmN5OiBudWxsLFxyXG4gICAgICBoaWdoUGFzc0N1dG9mZkZyZXF1ZW5jeTogbnVsbCxcclxuICAgICAgY2VudGVyRnJlcXVlbmN5OiBudWxsLFxyXG4gICAgICBxRmFjdG9yOiAxLFxyXG4gICAgICBsZm9Jbml0aWFsbHlFbmFibGVkOiBmYWxzZSxcclxuICAgICAgbGZvSW5pdGlhbEZyZXF1ZW5jeTogMixcclxuICAgICAgbGZvSW5pdGlhbERlcHRoOiAxLFxyXG4gICAgICBsZm9UeXBlOiAnc2luZSdcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoXHJcbiAgICAgIFsgJ3doaXRlJywgJ3BpbmsnLCAnYnJvd24nIF0uaW5jbHVkZXMoIG9wdGlvbnMubm9pc2VUeXBlICksXHJcbiAgICAgIGBpbnZhbGlkIG5vaXNlIHR5cGU6ICR7b3B0aW9ucy5ub2lzZVR5cGV9YFxyXG4gICAgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KFxyXG4gICAgb3B0aW9ucy5sZm9Jbml0aWFsRGVwdGggPj0gMCAmJiBvcHRpb25zLmxmb0luaXRpYWxEZXB0aCA8PSAxLFxyXG4gICAgICBgaW52YWxpZCB2YWx1ZSBmb3IgbGZvSW5pdGlhbERlcHRoOiAke29wdGlvbnMubGZvSW5pdGlhbERlcHRofWBcclxuICAgICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCBub3cgPSB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZTtcclxuXHJcbiAgICAvLyBpZiBzcGVjaWZpZWQsIGNyZWF0ZSB0aGUgbG93LXBhc3MgZmlsdGVyXHJcbiAgICBsZXQgbG93UGFzc0ZpbHRlcjtcclxuICAgIGlmICggb3B0aW9ucy5sb3dQYXNzQ3V0b2ZmRnJlcXVlbmN5ICkge1xyXG4gICAgICBsb3dQYXNzRmlsdGVyID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlQmlxdWFkRmlsdGVyKCk7XHJcbiAgICAgIGxvd1Bhc3NGaWx0ZXIudHlwZSA9ICdsb3dwYXNzJztcclxuICAgICAgbG93UGFzc0ZpbHRlci5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoIG9wdGlvbnMubG93UGFzc0N1dG9mZkZyZXF1ZW5jeSwgbm93ICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaWYgc3BlY2lmaWVkLCBjcmVhdGUgdGhlIGhpZ2gtcGFzcyBmaWx0ZXJcclxuICAgIGxldCBoaWdoUGFzc0ZpbHRlcjtcclxuICAgIGlmICggb3B0aW9ucy5oaWdoUGFzc0N1dG9mZkZyZXF1ZW5jeSApIHtcclxuICAgICAgaGlnaFBhc3NGaWx0ZXIgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVCaXF1YWRGaWx0ZXIoKTtcclxuICAgICAgaGlnaFBhc3NGaWx0ZXIudHlwZSA9ICdoaWdocGFzcyc7XHJcbiAgICAgIGhpZ2hQYXNzRmlsdGVyLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZSggb3B0aW9ucy5oaWdoUGFzc0N1dG9mZkZyZXF1ZW5jeSwgbm93ICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaWYgc3BlY2lmaWVkLCBjcmVhdGUgdGhlIGJhbmQtcGFzcyBmaWx0ZXJcclxuICAgIGlmICggb3B0aW9ucy5xRmFjdG9yICYmIG9wdGlvbnMuY2VudGVyRnJlcXVlbmN5ICkge1xyXG4gICAgICB0aGlzLmJhbmRQYXNzRmlsdGVyID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlQmlxdWFkRmlsdGVyKCk7XHJcbiAgICAgIHRoaXMuYmFuZFBhc3NGaWx0ZXIudHlwZSA9ICdiYW5kcGFzcyc7XHJcbiAgICAgIHRoaXMuYmFuZFBhc3NGaWx0ZXIuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKCBvcHRpb25zLmNlbnRlckZyZXF1ZW5jeSwgbm93ICk7XHJcbiAgICAgIHRoaXMuYmFuZFBhc3NGaWx0ZXIuUS5zZXRWYWx1ZUF0VGltZSggb3B0aW9ucy5xRmFjdG9yLCBub3cgKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLmJhbmRQYXNzRmlsdGVyID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBkZWZpbmUgdGhlIG5vaXNlIGRhdGFcclxuICAgIGNvbnN0IG5vaXNlQnVmZmVyU2l6ZSA9IE5PSVNFX0JVRkZFUl9TRUNPTkRTICogdGhpcy5hdWRpb0NvbnRleHQuc2FtcGxlUmF0ZTtcclxuICAgIHRoaXMubm9pc2VCdWZmZXIgPSB0aGlzLmF1ZGlvQ29udGV4dC5jcmVhdGVCdWZmZXIoIDEsIG5vaXNlQnVmZmVyU2l6ZSwgdGhpcy5hdWRpb0NvbnRleHQuc2FtcGxlUmF0ZSApO1xyXG4gICAgY29uc3QgZGF0YSA9IHRoaXMubm9pc2VCdWZmZXIuZ2V0Q2hhbm5lbERhdGEoIDAgKTtcclxuXHJcbiAgICAvLyBmaWxsIGluIHRoZSBzYW1wbGUgYnVmZmVyIGJhc2VkIG9uIHRoZSBub2lzZSB0eXBlXHJcbiAgICBsZXQgd2hpdGU7XHJcbiAgICBpZiAoIG9wdGlvbnMubm9pc2VUeXBlID09PSAnd2hpdGUnICkge1xyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBub2lzZUJ1ZmZlclNpemU7IGkrKyApIHtcclxuICAgICAgICBkYXRhWyBpIF0gPSBkb3RSYW5kb20ubmV4dERvdWJsZSgpICogMiAtIDE7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBvcHRpb25zLm5vaXNlVHlwZSA9PT0gJ3BpbmsnICkge1xyXG4gICAgICBsZXQgYjAgPSAwO1xyXG4gICAgICBsZXQgYjEgPSAwO1xyXG4gICAgICBsZXQgYjIgPSAwO1xyXG4gICAgICBsZXQgYjMgPSAwO1xyXG4gICAgICBsZXQgYjQgPSAwO1xyXG4gICAgICBsZXQgYjUgPSAwO1xyXG4gICAgICBsZXQgYjYgPSAwO1xyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBub2lzZUJ1ZmZlclNpemU7IGkrKyApIHtcclxuICAgICAgICB3aGl0ZSA9IGRvdFJhbmRvbS5uZXh0RG91YmxlKCkgKiAyIC0gMTtcclxuICAgICAgICBiMCA9IDAuOTk4ODYgKiBiMCArIHdoaXRlICogMC4wNTU1MTc5O1xyXG4gICAgICAgIGIxID0gMC45OTMzMiAqIGIxICsgd2hpdGUgKiAwLjA3NTA3NTk7XHJcbiAgICAgICAgYjIgPSAwLjk2OTAwICogYjIgKyB3aGl0ZSAqIDAuMTUzODUyMDtcclxuICAgICAgICBiMyA9IDAuODY2NTAgKiBiMyArIHdoaXRlICogMC4zMTA0ODU2O1xyXG4gICAgICAgIGI0ID0gMC41NTAwMCAqIGI0ICsgd2hpdGUgKiAwLjUzMjk1MjI7XHJcbiAgICAgICAgYjUgPSAtMC43NjE2ICogYjUgLSB3aGl0ZSAqIDAuMDE2ODk4MDtcclxuICAgICAgICBkYXRhWyBpIF0gPSBiMCArIGIxICsgYjIgKyBiMyArIGI0ICsgYjUgKyBiNiArIHdoaXRlICogMC41MzYyO1xyXG4gICAgICAgIGRhdGFbIGkgXSAqPSAwLjExOyAvLyBhZGp1c3QgdG8gMGRCLCBlbXBpcmljYWxseSBkZXRlcm1pbmVkLCB3aWxsIGJlIGFwcHJveGltYXRlIGR1ZSB0byByYW5kb21uZXNzIG9mIGRhdGFcclxuICAgICAgICBiNiA9IHdoaXRlICogMC4xMTU5MjY7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBvcHRpb25zLm5vaXNlVHlwZSA9PT0gJ2Jyb3duJyApIHtcclxuICAgICAgbGV0IGxhc3RPdXQgPSAwO1xyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBub2lzZUJ1ZmZlclNpemU7IGkrKyApIHtcclxuICAgICAgICB3aGl0ZSA9IGRvdFJhbmRvbS5uZXh0RG91YmxlKCkgKiAyIC0gMTtcclxuICAgICAgICBkYXRhWyBpIF0gPSAoIGxhc3RPdXQgKyAoIDAuMDIgKiB3aGl0ZSApICkgLyAxLjAyO1xyXG4gICAgICAgIGxhc3RPdXQgPSBkYXRhWyBpIF07XHJcbiAgICAgICAgZGF0YVsgaSBdICo9IDMuNTsgLy8gYWRqdXN0IHRvIDBkQiwgZW1waXJpY2FsbHkgZGV0ZXJtaW5lZCwgd2lsbCBiZSBhcHByb3hpbWF0ZSBkdWUgdG8gcmFuZG9tbmVzcyBvZiBkYXRhXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoIGB1bmV4cGVjdGVkIHZhbHVlIGZvciBub2lzZVR5cGU6ICR7b3B0aW9ucy5ub2lzZVR5cGV9YCApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHRoZSBzb3VyY2Ugbm9kZSBmcm9tIHdoaWNoIHRoZSBub2lzZSBpcyBwbGF5ZWQsIHNldCB3aGVuIHBsYXkgaXMgY2FsbGVkXHJcbiAgICB0aGlzLm5vaXNlU291cmNlID0gbnVsbDtcclxuXHJcbiAgICAvLyBzZXQgdXAgdGhlIGxvdyBmcmVxdWVuY3kgb3NjaWxsYXRvciAoTEZPKSBmb3IgYW1wbGl0dWRlIG1vZHVsYXRpb25cclxuICAgIHRoaXMubGZvID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlT3NjaWxsYXRvcigpO1xyXG4gICAgdGhpcy5sZm8udHlwZSA9IG9wdGlvbnMubGZvVHlwZTtcclxuXHJcbiAgICAvLyBpbml0aWFsaXplIExGTyBmcmVxdWVuY3ksIHVwZGF0ZWQgdGhyb3VnaCBtZXRob2RzIGRlZmluZWQgYmVsb3dcclxuICAgIHRoaXMubGZvLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZSggb3B0aW9ucy5sZm9Jbml0aWFsRnJlcXVlbmN5LCBub3cgKTtcclxuICAgIHRoaXMubGZvLnN0YXJ0KCk7XHJcblxyXG4gICAgLy8gc2V0IHVwIHRoZSBnYWluIHN0YWdlIHRoYXQgd2lsbCBhdHRlbnVhdGUgdGhlIExGTyBvdXRwdXQgc28gdGhhdCBpdCB3aWxsIHJhbmdlIGZyb20gLTAuNSB0byArMC41XHJcbiAgICB0aGlzLmxmb0F0dGVudWF0b3JHYWluTm9kZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUdhaW4oKTtcclxuICAgIHRoaXMubGZvQXR0ZW51YXRvckdhaW5Ob2RlLmdhaW4udmFsdWUgPSBvcHRpb25zLmxmb0luaXRpYWxEZXB0aCAvIDI7XHJcbiAgICB0aGlzLmxmby5jb25uZWN0KCB0aGlzLmxmb0F0dGVudWF0b3JHYWluTm9kZSApO1xyXG5cclxuICAgIC8vIHNldCB1cCB0aGUgZ2FpbiBzdGFnZSBmb3IgdGhlIExGTyAtIHRoZSBtYWluIHNvdW5kIHBhdGggd2lsbCBydW4gdGhyb3VnaCBoZXJlXHJcbiAgICB0aGlzLmxmb0NvbnRyb2xsZWRHYWluTm9kZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUdhaW4oKTtcclxuICAgIHRoaXMubGZvQ29udHJvbGxlZEdhaW5Ob2RlLmdhaW4udmFsdWUgPSAwLjU7IC8vIHRoaXMgdmFsdWUgaXMgYWRkZWQgdG8gdGhlIGF0dGVudWF0ZWQgTEZPIG91dHB1dCB2YWx1ZVxyXG5cclxuICAgIC8vIHNldCB0aGUgaW5pdGlhbCBlbmFibGVkIHN0YXRlIG9mIHRoZSBMRk9cclxuICAgIGlmICggb3B0aW9ucy5sZm9Jbml0aWFsbHlFbmFibGVkICkge1xyXG4gICAgICB0aGlzLmxmb0F0dGVudWF0b3JHYWluTm9kZS5nYWluLnNldFRhcmdldEF0VGltZSggMC41LCB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSwgUEFSQU1FVEVSX0NIQU5HRV9USU1FX0NPTlNUQU5UICk7XHJcbiAgICAgIHRoaXMubGZvQXR0ZW51YXRvckdhaW5Ob2RlLmNvbm5lY3QoIHRoaXMubGZvQ29udHJvbGxlZEdhaW5Ob2RlLmdhaW4gKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLmxmb0F0dGVudWF0b3JHYWluTm9kZS5nYWluLnNldFRhcmdldEF0VGltZSggMSwgdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUsIFBBUkFNRVRFUl9DSEFOR0VfVElNRV9DT05TVEFOVCApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHdpcmUgdXAgdGhlIGF1ZGlvIHBhdGgsIHdvcmtpbmcgb3VyIHdheSBmcm9tIHRoZSBvdXRwdXQgYmFjayB0byB0aGUgc291bmQgc291cmNlKHMpXHJcbiAgICB0aGlzLmxmb0NvbnRyb2xsZWRHYWluTm9kZS5jb25uZWN0KCB0aGlzLnNvdW5kU291cmNlRGVzdGluYXRpb24gKTtcclxuICAgIGxldCBuZXh0T3V0cHV0VG9Db25uZWN0ID0gdGhpcy5sZm9Db250cm9sbGVkR2Fpbk5vZGU7XHJcbiAgICBpZiAoIGhpZ2hQYXNzRmlsdGVyICkge1xyXG4gICAgICBoaWdoUGFzc0ZpbHRlci5jb25uZWN0KCBuZXh0T3V0cHV0VG9Db25uZWN0ICk7XHJcbiAgICAgIG5leHRPdXRwdXRUb0Nvbm5lY3QgPSBoaWdoUGFzc0ZpbHRlcjtcclxuICAgIH1cclxuICAgIGlmICggbG93UGFzc0ZpbHRlciApIHtcclxuICAgICAgbG93UGFzc0ZpbHRlci5jb25uZWN0KCBuZXh0T3V0cHV0VG9Db25uZWN0ICk7XHJcbiAgICAgIG5leHRPdXRwdXRUb0Nvbm5lY3QgPSBsb3dQYXNzRmlsdGVyO1xyXG4gICAgfVxyXG4gICAgaWYgKCB0aGlzLmJhbmRQYXNzRmlsdGVyICkge1xyXG4gICAgICB0aGlzLmJhbmRQYXNzRmlsdGVyLmNvbm5lY3QoIG5leHRPdXRwdXRUb0Nvbm5lY3QgKTtcclxuICAgICAgbmV4dE91dHB1dFRvQ29ubmVjdCA9IHRoaXMuYmFuZFBhc3NGaWx0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5ub2lzZVNvdXJjZUNvbm5lY3Rpb25Qb2ludCA9IG5leHRPdXRwdXRUb0Nvbm5lY3Q7XHJcbiAgICB0aGlzLmlzUGxheWluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy50aW1lT2ZEZWZlcnJlZFN0YXJ0UmVxdWVzdCA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWTtcclxuXHJcbiAgICAvLyBkZWZpbmUgdGhlIGxpc3RlbmVyIGZvciBhdWRpbyBjb250ZXh0IHN0YXRlIHRyYW5zaXRpb25zXHJcbiAgICB0aGlzLmF1ZGlvQ29udGV4dFN0YXRlQ2hhbmdlTGlzdGVuZXIgPSBzdGF0ZSA9PiB7XHJcblxyXG4gICAgICBpZiAoIHN0YXRlID09PSAncnVubmluZycgJiYgdGhpcy5pc1BsYXlpbmcgKSB7XHJcblxyXG4gICAgICAgIHRoaXMuc3RhcnQoKTtcclxuXHJcbiAgICAgICAgLy8gYXV0b21hdGljYWxseSByZW1vdmUgYWZ0ZXIgZmlyaW5nXHJcbiAgICAgICAgYXVkaW9Db250ZXh0U3RhdGVDaGFuZ2VNb25pdG9yLnJlbW92ZVN0YXRlQ2hhbmdlTGlzdGVuZXIoXHJcbiAgICAgICAgICB0aGlzLmF1ZGlvQ29udGV4dCxcclxuICAgICAgICAgIHRoaXMuYXVkaW9Db250ZXh0U3RhdGVDaGFuZ2VMaXN0ZW5lclxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdGFydCB0aGUgbm9pc2Ugc291cmNlLlxyXG4gICAqIEBwYXJhbSBbZGVsYXldIC0gb3B0aW9uYWwgZGVsYXkgZm9yIHdoZW4gdG8gc3RhcnQgdGhlIG5vaXNlIHNvdXJjZSwgaW4gc2Vjb25kc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGFydCggZGVsYXkgPSAwICk6IHZvaWQge1xyXG5cclxuICAgIGlmICggdGhpcy5hdWRpb0NvbnRleHQuc3RhdGUgPT09ICdydW5uaW5nJyApIHtcclxuXHJcbiAgICAgIGNvbnN0IG5vdyA9IHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lO1xyXG5cclxuICAgICAgLy8gb25seSBkbyBzb21ldGhpbmcgaWYgbm90IGFscmVhZHkgcGxheWluZywgb3RoZXJ3aXNlIGlnbm9yZSB0aGlzIHJlcXVlc3RcclxuICAgICAgaWYgKCAhdGhpcy5pc1BsYXlpbmcgKSB7XHJcbiAgICAgICAgdGhpcy5ub2lzZVNvdXJjZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xyXG4gICAgICAgIHRoaXMubm9pc2VTb3VyY2UuYnVmZmVyID0gdGhpcy5ub2lzZUJ1ZmZlcjtcclxuICAgICAgICB0aGlzLm5vaXNlU291cmNlLmxvb3AgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMubm9pc2VTb3VyY2UuY29ubmVjdCggdGhpcy5ub2lzZVNvdXJjZUNvbm5lY3Rpb25Qb2ludCApO1xyXG4gICAgICAgIHRoaXMubm9pc2VTb3VyY2Uuc3RhcnQoIG5vdyArIGRlbGF5ICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG5cclxuICAgICAgLy8gVGhpcyBtZXRob2Qgd2FzIGNhbGxlZCB3aGVuIHRoZSBhdWRpbyBjb250ZXh0IHdhcyBub3QgeWV0IHJ1bm5pbmcsIHNvIGFkZCBhIGxpc3RlbmVyIHRvIHN0YXJ0IGlmIGFuZCB3aGVuIHRoZVxyXG4gICAgICAvLyBhdWRpbyBjb250ZXh0IHN0YXRlIGNoYW5nZXMuXHJcbiAgICAgIHRoaXMudGltZU9mRGVmZXJyZWRTdGFydFJlcXVlc3QgPSBEYXRlLm5vdygpO1xyXG4gICAgICBpZiAoICFhdWRpb0NvbnRleHRTdGF0ZUNoYW5nZU1vbml0b3IuaGFzTGlzdGVuZXIoIHRoaXMuYXVkaW9Db250ZXh0LCB0aGlzLmF1ZGlvQ29udGV4dFN0YXRlQ2hhbmdlTGlzdGVuZXIgKSApIHtcclxuICAgICAgICBhdWRpb0NvbnRleHRTdGF0ZUNoYW5nZU1vbml0b3IuYWRkU3RhdGVDaGFuZ2VMaXN0ZW5lcihcclxuICAgICAgICAgIHRoaXMuYXVkaW9Db250ZXh0LFxyXG4gICAgICAgICAgdGhpcy5hdWRpb0NvbnRleHRTdGF0ZUNoYW5nZUxpc3RlbmVyXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIHNldCB0aGUgZmxhZyBldmVuIGlmIHRoZSBzdGFydCBpcyBkZWZlcnJlZCwgc2luY2UgaXQgaXMgdXNlZCB0byBkZWNpZGUgd2hldGhlciB0byBkbyBhIGRlZmVycmVkIHN0YXJ0XHJcbiAgICB0aGlzLmlzUGxheWluZyA9IHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdG9wIHRoZSBub2lzZSBzb3VyY2UuXHJcbiAgICogQHBhcmFtIFt0aW1lXSAtIG9wdGlvbmFsIGF1ZGlvIGNvbnRleHQgdGltZSBhdCB3aGljaCB0aGlzIHNob3VsZCBiZSBzdG9wcGVkXHJcbiAgICovXHJcbiAgcHVibGljIHN0b3AoIHRpbWUgPSAwICk6IHZvaWQge1xyXG5cclxuICAgIC8vIG9ubHkgc3RvcCBpZiBwbGF5aW5nLCBvdGhlcndpc2UgaWdub3JlXHJcbiAgICBpZiAoIHRoaXMuaXNQbGF5aW5nICYmIHRoaXMubm9pc2VTb3VyY2UgKSB7XHJcbiAgICAgIHRoaXMubm9pc2VTb3VyY2Uuc3RvcCggdGltZSApO1xyXG4gICAgICB0aGlzLm5vaXNlU291cmNlID0gbnVsbDtcclxuICAgIH1cclxuICAgIHRoaXMuaXNQbGF5aW5nID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIGZyZXF1ZW5jeSBvZiB0aGUgbG93IGZyZXF1ZW5jeSBhbXBsaXR1ZGUgbW9kdWxhdG9yIChMRk8pLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRMZm9GcmVxdWVuY3koIGZyZXF1ZW5jeTogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgdGhpcy5sZm8uZnJlcXVlbmN5LnNldFRhcmdldEF0VGltZSggZnJlcXVlbmN5LCB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSwgUEFSQU1FVEVSX0NIQU5HRV9USU1FX0NPTlNUQU5UICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIGRlcHRoIG9mIHRoZSBMRk8gbW9kdWxhdG9yLlxyXG4gICAqIEBwYXJhbSBkZXB0aCAtIGRlcHRoIHZhbHVlIGZyb20gMCAobm8gbW9kdWxhdGlvbikgdG8gMSAobWF4IG1vZHVsYXRpb24pXHJcbiAgICovXHJcbiAgcHVibGljIHNldExmb0RlcHRoKCBkZXB0aDogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgdGhpcy5sZm9BdHRlbnVhdG9yR2Fpbk5vZGUuZ2Fpbi5zZXRUYXJnZXRBdFRpbWUoIGRlcHRoIC8gMiwgdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUsIExGT19ERVBUSF9DSEFOR0VfVElNRV9DT05TVEFOVCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVHVybiB0aGUgbG93IGZyZXF1ZW5jeSBhbXBsaXR1ZGUgbW9kdWxhdGlvbiBvbi9vZmYuXHJcbiAgICovXHJcbiAgcHVibGljIHNldExmb0VuYWJsZWQoIGVuYWJsZWQ6IGJvb2xlYW4gKTogdm9pZCB7XHJcbiAgICBpZiAoIGVuYWJsZWQgKSB7XHJcbiAgICAgIHRoaXMubGZvQXR0ZW51YXRvckdhaW5Ob2RlLmdhaW4uc2V0VGFyZ2V0QXRUaW1lKCAwLjUsIHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lLCBQQVJBTUVURVJfQ0hBTkdFX1RJTUVfQ09OU1RBTlQgKTtcclxuICAgICAgdGhpcy5sZm9BdHRlbnVhdG9yR2Fpbk5vZGUuY29ubmVjdCggdGhpcy5sZm9Db250cm9sbGVkR2Fpbk5vZGUuZ2FpbiApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMubGZvQXR0ZW51YXRvckdhaW5Ob2RlLmRpc2Nvbm5lY3QoIHRoaXMubGZvQ29udHJvbGxlZEdhaW5Ob2RlLmdhaW4gKTtcclxuICAgICAgdGhpcy5sZm9BdHRlbnVhdG9yR2Fpbk5vZGUuZ2Fpbi5zZXRUYXJnZXRBdFRpbWUoIDEsIHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lLCBQQVJBTUVURVJfQ0hBTkdFX1RJTUVfQ09OU1RBTlQgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHNldCB0aGUgUSB2YWx1ZSBmb3IgdGhlIGJhbmQgcGFzcyBmaWx0ZXIsIGFzc3VtZXMgdGhhdCBub2lzZSBnZW5lcmF0b3Igd2FzIGNyZWF0ZWQgd2l0aCB0aGlzIGZpbHRlciBlbmFibGVkXHJcbiAgICovXHJcbiAgcHVibGljIHNldEJhbmRwYXNzRmlsdGVyQ2VudGVyRnJlcXVlbmN5KCBmcmVxdWVuY3k6IG51bWJlciwgdGltZUNvbnN0YW50OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICB0aW1lQ29uc3RhbnQgPSB0aW1lQ29uc3RhbnQgfHwgUEFSQU1FVEVSX0NIQU5HRV9USU1FX0NPTlNUQU5UO1xyXG4gICAgaWYgKCB0aGlzLmJhbmRQYXNzRmlsdGVyICE9PSBudWxsICkge1xyXG4gICAgICB0aGlzLmJhbmRQYXNzRmlsdGVyLmZyZXF1ZW5jeS5zZXRUYXJnZXRBdFRpbWUoIGZyZXF1ZW5jeSwgdGhpcy5hdWRpb0NvbnRleHQuY3VycmVudFRpbWUsIHRpbWVDb25zdGFudCApO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxudGFtYm8ucmVnaXN0ZXIoICdOb2lzZUdlbmVyYXRvcicsIE5vaXNlR2VuZXJhdG9yICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBOb2lzZUdlbmVyYXRvcjsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsU0FBUyxNQUFNLDhCQUE4QjtBQUNwRCxPQUFPQyxTQUFTLE1BQU0sb0NBQW9DO0FBQzFELE9BQU9DLDhCQUE4QixNQUFNLHNDQUFzQztBQUNqRixPQUFPQyxjQUFjLE1BQU0sc0JBQXNCO0FBQ2pELE9BQU9DLEtBQUssTUFBTSxhQUFhO0FBQy9CLE9BQU9DLGNBQWMsTUFBaUMscUJBQXFCO0FBMkIzRTtBQUNBLE1B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