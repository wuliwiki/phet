// Copyright 2022-2023, University of Colorado Boulder

/**
 * Model class which the 'Decay' and 'Nuclide Chart' screen will extend.
 *
 * @author Luisa Vargas
 */

import buildANucleus from '../../buildANucleus.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import AtomIdentifier from '../../../../shred/js/AtomIdentifier.js';
import createObservableArray from '../../../../axon/js/createObservableArray.js';
import Range from '../../../../dot/js/Range.js';
import ParticleType from '../view/ParticleType.js';
import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
class BANModel {
  // the stability of the nuclide

  // if a nuclide exists

  // arrays of all Particle's that exist in all places

  // the atom that the user will build, modify, and generally play with.

  // the range of the number of protons allowed

  // the range of the number of neutrons allowed

  // array of particles sent to the nucleus but not there yet

  // keep track of when the double arrow buttons are clicked or when the single arrow buttons are clicked

  // keep track of any particle related animations that may need to be cancelled at some point

  // array of all emitted particles

  constructor(maximumProtonNumber, maximumNeutronNumber, particleAtom) {
    // Create the atom
    this.particleAtom = particleAtom;
    this.particles = createObservableArray();
    this.incomingProtons = createObservableArray();
    this.incomingNeutrons = createObservableArray();
    this.userControlledProtons = createObservableArray();
    this.userControlledNeutrons = createObservableArray();
    this.outgoingParticles = createObservableArray();
    this.particleAnimations = createObservableArray();
    this.particleAnimations.addItemRemovedListener(animation => {
      animation && animation.stop();
      animation = null;
    });
    this.doubleArrowButtonClickedBooleanProperty = new BooleanProperty(false);
    this.protonCountRange = new Range(0, maximumProtonNumber);
    this.neutronCountRange = new Range(0, maximumNeutronNumber);

    // the stability of the nuclide is determined by the given number of protons and neutrons
    this.isStableBooleanProperty = new DerivedProperty([this.particleAtom.protonCountProperty, this.particleAtom.neutronCountProperty], (protonCount, neutronCount) => AtomIdentifier.isStable(protonCount, neutronCount));

    // if a nuclide with a given number of protons and neutrons exists
    this.doesNuclideExistBooleanProperty = new DerivedProperty([this.particleAtom.protonCountProperty, this.particleAtom.neutronCountProperty], (protonCount, neutronCount) => AtomIdentifier.doesExist(protonCount, neutronCount));

    // TODO: this might be causing bugs since it's being called twice
    // reconfigure the nucleus when the massNumber changes
    this.particleAtom.massNumberProperty.link(() => this.particleAtom.reconfigureNucleus());
  }

  /**
   * Select the particle closest to its creator node.
   */
  getParticleToReturn(particleType, creatorNodePosition) {
    const sortedParticles = _.sortBy(this.getParticlesByType(particleType), particle => {
      return particle.positionProperty.value.distance(creatorNodePosition);
    });

    // We know that sortedParticles is not empty, and does not contain null.
    return sortedParticles.shift();
  }

  /**
   * Return array of all the particles that are of particleType and part of the particleAtom
   */
  getParticlesByType(particleType) {
    const filteredParticles = _.filter(this.particles, particle => {
      return this.particleAtom.containsParticle(particle) && particle.type === particleType.name.toLowerCase();
    });
    assert && assert(filteredParticles.length !== 0, 'No particles of particleType ' + particleType.name + ' are in the particleAtom.');
    return filteredParticles;
  }

  /**
   * Return the destination of a particle when it's added to the particle atom
   */
  getParticleDestination(particleType, particle) {
    return this.particleAtom.positionProperty.value;
  }

  /**
   * Add a Particle to the model
   */
  addParticle(particle) {
    assert && assert(_.some(ParticleType.enumeration.values, particleType => {
      return particle.type === particleType.name.toLowerCase();
    }), 'Particles must be one of the types in ParticleType ' + particle.type);
    this.particles.push(particle);
  }

  /**
   * Remove a Particle from the model
   */
  removeParticle(particle) {
    this.particles.remove(particle);
  }
  reset() {
    this.particleAtom.clear();
    this.particles.clear();
    this.incomingProtons.clear();
    this.incomingNeutrons.clear();
    this.outgoingParticles.clear();
    this.userControlledProtons.clear();
    this.userControlledNeutrons.clear();
    this.particleAnimations.clear();
  }

  /**
   * @param dt - time step, in seconds
   */
  step(dt) {
    // Update particle positions
    this.particles.forEach(particle => {
      particle.step(dt);
    });
  }
}
buildANucleus.register('BANModel', BANModel);
export default BANModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJidWlsZEFOdWNsZXVzIiwiRGVyaXZlZFByb3BlcnR5IiwiQXRvbUlkZW50aWZpZXIiLCJjcmVhdGVPYnNlcnZhYmxlQXJyYXkiLCJSYW5nZSIsIlBhcnRpY2xlVHlwZSIsIkJvb2xlYW5Qcm9wZXJ0eSIsIkJBTk1vZGVsIiwiY29uc3RydWN0b3IiLCJtYXhpbXVtUHJvdG9uTnVtYmVyIiwibWF4aW11bU5ldXRyb25OdW1iZXIiLCJwYXJ0aWNsZUF0b20iLCJwYXJ0aWNsZXMiLCJpbmNvbWluZ1Byb3RvbnMiLCJpbmNvbWluZ05ldXRyb25zIiwidXNlckNvbnRyb2xsZWRQcm90b25zIiwidXNlckNvbnRyb2xsZWROZXV0cm9ucyIsIm91dGdvaW5nUGFydGljbGVzIiwicGFydGljbGVBbmltYXRpb25zIiwiYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciIsImFuaW1hdGlvbiIsInN0b3AiLCJkb3VibGVBcnJvd0J1dHRvbkNsaWNrZWRCb29sZWFuUHJvcGVydHkiLCJwcm90b25Db3VudFJhbmdlIiwibmV1dHJvbkNvdW50UmFuZ2UiLCJpc1N0YWJsZUJvb2xlYW5Qcm9wZXJ0eSIsInByb3RvbkNvdW50UHJvcGVydHkiLCJuZXV0cm9uQ291bnRQcm9wZXJ0eSIsInByb3RvbkNvdW50IiwibmV1dHJvbkNvdW50IiwiaXNTdGFibGUiLCJkb2VzTnVjbGlkZUV4aXN0Qm9vbGVhblByb3BlcnR5IiwiZG9lc0V4aXN0IiwibWFzc051bWJlclByb3BlcnR5IiwibGluayIsInJlY29uZmlndXJlTnVjbGV1cyIsImdldFBhcnRpY2xlVG9SZXR1cm4iLCJwYXJ0aWNsZVR5cGUiLCJjcmVhdG9yTm9kZVBvc2l0aW9uIiwic29ydGVkUGFydGljbGVzIiwiXyIsInNvcnRCeSIsImdldFBhcnRpY2xlc0J5VHlwZSIsInBhcnRpY2xlIiwicG9zaXRpb25Qcm9wZXJ0eSIsInZhbHVlIiwiZGlzdGFuY2UiLCJzaGlmdCIsImZpbHRlcmVkUGFydGljbGVzIiwiZmlsdGVyIiwiY29udGFpbnNQYXJ0aWNsZSIsInR5cGUiLCJuYW1lIiwidG9Mb3dlckNhc2UiLCJhc3NlcnQiLCJsZW5ndGgiLCJnZXRQYXJ0aWNsZURlc3RpbmF0aW9uIiwiYWRkUGFydGljbGUiLCJzb21lIiwiZW51bWVyYXRpb24iLCJ2YWx1ZXMiLCJwdXNoIiwicmVtb3ZlUGFydGljbGUiLCJyZW1vdmUiLCJyZXNldCIsImNsZWFyIiwic3RlcCIsImR0IiwiZm9yRWFjaCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQkFOTW9kZWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjItMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogTW9kZWwgY2xhc3Mgd2hpY2ggdGhlICdEZWNheScgYW5kICdOdWNsaWRlIENoYXJ0JyBzY3JlZW4gd2lsbCBleHRlbmQuXHJcbiAqXHJcbiAqIEBhdXRob3IgTHVpc2EgVmFyZ2FzXHJcbiAqL1xyXG5cclxuaW1wb3J0IGJ1aWxkQU51Y2xldXMgZnJvbSAnLi4vLi4vYnVpbGRBTnVjbGV1cy5qcyc7XHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQXRvbUlkZW50aWZpZXIgZnJvbSAnLi4vLi4vLi4vLi4vc2hyZWQvanMvQXRvbUlkZW50aWZpZXIuanMnO1xyXG5pbXBvcnQgUGFydGljbGUgZnJvbSAnLi4vLi4vLi4vLi4vc2hyZWQvanMvbW9kZWwvUGFydGljbGUuanMnO1xyXG5pbXBvcnQgUGFydGljbGVBdG9tIGZyb20gJy4uLy4uLy4uLy4uL3NocmVkL2pzL21vZGVsL1BhcnRpY2xlQXRvbS5qcyc7XHJcbmltcG9ydCBjcmVhdGVPYnNlcnZhYmxlQXJyYXksIHsgT2JzZXJ2YWJsZUFycmF5IH0gZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9jcmVhdGVPYnNlcnZhYmxlQXJyYXkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IFBhcnRpY2xlVHlwZSBmcm9tICcuLi92aWV3L1BhcnRpY2xlVHlwZS5qcyc7XHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQW5pbWF0aW9uIGZyb20gJy4uLy4uLy4uLy4uL3R3aXh0L2pzL0FuaW1hdGlvbi5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuXHJcbmNsYXNzIEJBTk1vZGVsPFQgZXh0ZW5kcyBQYXJ0aWNsZUF0b20+IHtcclxuXHJcbiAgLy8gdGhlIHN0YWJpbGl0eSBvZiB0aGUgbnVjbGlkZVxyXG4gIHB1YmxpYyByZWFkb25seSBpc1N0YWJsZUJvb2xlYW5Qcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIGlmIGEgbnVjbGlkZSBleGlzdHNcclxuICBwdWJsaWMgcmVhZG9ubHkgZG9lc051Y2xpZGVFeGlzdEJvb2xlYW5Qcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIGFycmF5cyBvZiBhbGwgUGFydGljbGUncyB0aGF0IGV4aXN0IGluIGFsbCBwbGFjZXNcclxuICBwdWJsaWMgcmVhZG9ubHkgcGFydGljbGVzOiBPYnNlcnZhYmxlQXJyYXk8UGFydGljbGU+O1xyXG5cclxuICAvLyB0aGUgYXRvbSB0aGF0IHRoZSB1c2VyIHdpbGwgYnVpbGQsIG1vZGlmeSwgYW5kIGdlbmVyYWxseSBwbGF5IHdpdGguXHJcbiAgcHVibGljIHJlYWRvbmx5IHBhcnRpY2xlQXRvbTogVDtcclxuXHJcbiAgLy8gdGhlIHJhbmdlIG9mIHRoZSBudW1iZXIgb2YgcHJvdG9ucyBhbGxvd2VkXHJcbiAgcHVibGljIHJlYWRvbmx5IHByb3RvbkNvdW50UmFuZ2U6IFJhbmdlO1xyXG5cclxuICAvLyB0aGUgcmFuZ2Ugb2YgdGhlIG51bWJlciBvZiBuZXV0cm9ucyBhbGxvd2VkXHJcbiAgcHVibGljIHJlYWRvbmx5IG5ldXRyb25Db3VudFJhbmdlOiBSYW5nZTtcclxuXHJcbiAgLy8gYXJyYXkgb2YgcGFydGljbGVzIHNlbnQgdG8gdGhlIG51Y2xldXMgYnV0IG5vdCB0aGVyZSB5ZXRcclxuICBwdWJsaWMgcmVhZG9ubHkgaW5jb21pbmdQcm90b25zOiBPYnNlcnZhYmxlQXJyYXk8UGFydGljbGU+O1xyXG4gIHB1YmxpYyByZWFkb25seSBpbmNvbWluZ05ldXRyb25zOiBPYnNlcnZhYmxlQXJyYXk8UGFydGljbGU+O1xyXG5cclxuICAvLyBrZWVwIHRyYWNrIG9mIHdoZW4gdGhlIGRvdWJsZSBhcnJvdyBidXR0b25zIGFyZSBjbGlja2VkIG9yIHdoZW4gdGhlIHNpbmdsZSBhcnJvdyBidXR0b25zIGFyZSBjbGlja2VkXHJcbiAgcHVibGljIHJlYWRvbmx5IGRvdWJsZUFycm93QnV0dG9uQ2xpY2tlZEJvb2xlYW5Qcm9wZXJ0eTogVFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyBrZWVwIHRyYWNrIG9mIGFueSBwYXJ0aWNsZSByZWxhdGVkIGFuaW1hdGlvbnMgdGhhdCBtYXkgbmVlZCB0byBiZSBjYW5jZWxsZWQgYXQgc29tZSBwb2ludFxyXG4gIHB1YmxpYyByZWFkb25seSBwYXJ0aWNsZUFuaW1hdGlvbnM6IE9ic2VydmFibGVBcnJheTxBbmltYXRpb24gfCBudWxsPjtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IHVzZXJDb250cm9sbGVkUHJvdG9uczogT2JzZXJ2YWJsZUFycmF5PFBhcnRpY2xlPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgdXNlckNvbnRyb2xsZWROZXV0cm9uczogT2JzZXJ2YWJsZUFycmF5PFBhcnRpY2xlPjtcclxuXHJcbiAgLy8gYXJyYXkgb2YgYWxsIGVtaXR0ZWQgcGFydGljbGVzXHJcbiAgcHVibGljIHJlYWRvbmx5IG91dGdvaW5nUGFydGljbGVzOiBPYnNlcnZhYmxlQXJyYXk8UGFydGljbGU+O1xyXG5cclxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoIG1heGltdW1Qcm90b25OdW1iZXI6IG51bWJlciwgbWF4aW11bU5ldXRyb25OdW1iZXI6IG51bWJlciwgcGFydGljbGVBdG9tOiBUICkge1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgYXRvbVxyXG4gICAgdGhpcy5wYXJ0aWNsZUF0b20gPSBwYXJ0aWNsZUF0b207XHJcblxyXG4gICAgdGhpcy5wYXJ0aWNsZXMgPSBjcmVhdGVPYnNlcnZhYmxlQXJyYXkoKTtcclxuXHJcbiAgICB0aGlzLmluY29taW5nUHJvdG9ucyA9IGNyZWF0ZU9ic2VydmFibGVBcnJheSgpO1xyXG4gICAgdGhpcy5pbmNvbWluZ05ldXRyb25zID0gY3JlYXRlT2JzZXJ2YWJsZUFycmF5KCk7XHJcblxyXG4gICAgdGhpcy51c2VyQ29udHJvbGxlZFByb3RvbnMgPSBjcmVhdGVPYnNlcnZhYmxlQXJyYXkoKTtcclxuICAgIHRoaXMudXNlckNvbnRyb2xsZWROZXV0cm9ucyA9IGNyZWF0ZU9ic2VydmFibGVBcnJheSgpO1xyXG5cclxuICAgIHRoaXMub3V0Z29pbmdQYXJ0aWNsZXMgPSBjcmVhdGVPYnNlcnZhYmxlQXJyYXkoKTtcclxuXHJcbiAgICB0aGlzLnBhcnRpY2xlQW5pbWF0aW9ucyA9IGNyZWF0ZU9ic2VydmFibGVBcnJheSgpO1xyXG4gICAgdGhpcy5wYXJ0aWNsZUFuaW1hdGlvbnMuYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciggYW5pbWF0aW9uID0+IHtcclxuICAgICAgYW5pbWF0aW9uICYmIGFuaW1hdGlvbi5zdG9wKCk7XHJcbiAgICAgIGFuaW1hdGlvbiA9IG51bGw7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5kb3VibGVBcnJvd0J1dHRvbkNsaWNrZWRCb29sZWFuUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG5cclxuICAgIHRoaXMucHJvdG9uQ291bnRSYW5nZSA9IG5ldyBSYW5nZSggMCwgbWF4aW11bVByb3Rvbk51bWJlciApO1xyXG4gICAgdGhpcy5uZXV0cm9uQ291bnRSYW5nZSA9IG5ldyBSYW5nZSggMCwgbWF4aW11bU5ldXRyb25OdW1iZXIgKTtcclxuXHJcbiAgICAvLyB0aGUgc3RhYmlsaXR5IG9mIHRoZSBudWNsaWRlIGlzIGRldGVybWluZWQgYnkgdGhlIGdpdmVuIG51bWJlciBvZiBwcm90b25zIGFuZCBuZXV0cm9uc1xyXG4gICAgdGhpcy5pc1N0YWJsZUJvb2xlYW5Qcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgdGhpcy5wYXJ0aWNsZUF0b20ucHJvdG9uQ291bnRQcm9wZXJ0eSwgdGhpcy5wYXJ0aWNsZUF0b20ubmV1dHJvbkNvdW50UHJvcGVydHkgXSxcclxuICAgICAgKCBwcm90b25Db3VudDogbnVtYmVyLCBuZXV0cm9uQ291bnQ6IG51bWJlciApID0+IEF0b21JZGVudGlmaWVyLmlzU3RhYmxlKCBwcm90b25Db3VudCwgbmV1dHJvbkNvdW50IClcclxuICAgICk7XHJcblxyXG4gICAgLy8gaWYgYSBudWNsaWRlIHdpdGggYSBnaXZlbiBudW1iZXIgb2YgcHJvdG9ucyBhbmQgbmV1dHJvbnMgZXhpc3RzXHJcbiAgICB0aGlzLmRvZXNOdWNsaWRlRXhpc3RCb29sZWFuUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIHRoaXMucGFydGljbGVBdG9tLnByb3RvbkNvdW50UHJvcGVydHksIHRoaXMucGFydGljbGVBdG9tLm5ldXRyb25Db3VudFByb3BlcnR5IF0sXHJcbiAgICAgICggcHJvdG9uQ291bnQ6IG51bWJlciwgbmV1dHJvbkNvdW50OiBudW1iZXIgKSA9PiBBdG9tSWRlbnRpZmllci5kb2VzRXhpc3QoIHByb3RvbkNvdW50LCBuZXV0cm9uQ291bnQgKVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBUT0RPOiB0aGlzIG1pZ2h0IGJlIGNhdXNpbmcgYnVncyBzaW5jZSBpdCdzIGJlaW5nIGNhbGxlZCB0d2ljZVxyXG4gICAgLy8gcmVjb25maWd1cmUgdGhlIG51Y2xldXMgd2hlbiB0aGUgbWFzc051bWJlciBjaGFuZ2VzXHJcbiAgICB0aGlzLnBhcnRpY2xlQXRvbS5tYXNzTnVtYmVyUHJvcGVydHkubGluayggKCkgPT4gdGhpcy5wYXJ0aWNsZUF0b20ucmVjb25maWd1cmVOdWNsZXVzKCkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlbGVjdCB0aGUgcGFydGljbGUgY2xvc2VzdCB0byBpdHMgY3JlYXRvciBub2RlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRQYXJ0aWNsZVRvUmV0dXJuKCBwYXJ0aWNsZVR5cGU6IFBhcnRpY2xlVHlwZSwgY3JlYXRvck5vZGVQb3NpdGlvbjogVmVjdG9yMiApOiBQYXJ0aWNsZSB7XHJcbiAgICBjb25zdCBzb3J0ZWRQYXJ0aWNsZXMgPSBfLnNvcnRCeSggdGhpcy5nZXRQYXJ0aWNsZXNCeVR5cGUoIHBhcnRpY2xlVHlwZSApLCBwYXJ0aWNsZSA9PiB7XHJcbiAgICAgIHJldHVybiBwYXJ0aWNsZS5wb3NpdGlvblByb3BlcnR5LnZhbHVlLmRpc3RhbmNlKCBjcmVhdG9yTm9kZVBvc2l0aW9uICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gV2Uga25vdyB0aGF0IHNvcnRlZFBhcnRpY2xlcyBpcyBub3QgZW1wdHksIGFuZCBkb2VzIG5vdCBjb250YWluIG51bGwuXHJcbiAgICByZXR1cm4gc29ydGVkUGFydGljbGVzLnNoaWZ0KCkhO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJuIGFycmF5IG9mIGFsbCB0aGUgcGFydGljbGVzIHRoYXQgYXJlIG9mIHBhcnRpY2xlVHlwZSBhbmQgcGFydCBvZiB0aGUgcGFydGljbGVBdG9tXHJcbiAgICovXHJcbiAgcHVibGljIGdldFBhcnRpY2xlc0J5VHlwZSggcGFydGljbGVUeXBlOiBQYXJ0aWNsZVR5cGUgKTogUGFydGljbGVbXSB7XHJcbiAgICBjb25zdCBmaWx0ZXJlZFBhcnRpY2xlcyA9IF8uZmlsdGVyKCB0aGlzLnBhcnRpY2xlcywgcGFydGljbGUgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUF0b20uY29udGFpbnNQYXJ0aWNsZSggcGFydGljbGUgKSAmJiBwYXJ0aWNsZS50eXBlID09PSBwYXJ0aWNsZVR5cGUubmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZpbHRlcmVkUGFydGljbGVzLmxlbmd0aCAhPT0gMCwgJ05vIHBhcnRpY2xlcyBvZiBwYXJ0aWNsZVR5cGUgJyArIHBhcnRpY2xlVHlwZS5uYW1lICsgJyBhcmUgaW4gdGhlIHBhcnRpY2xlQXRvbS4nICk7XHJcblxyXG4gICAgcmV0dXJuIGZpbHRlcmVkUGFydGljbGVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJuIHRoZSBkZXN0aW5hdGlvbiBvZiBhIHBhcnRpY2xlIHdoZW4gaXQncyBhZGRlZCB0byB0aGUgcGFydGljbGUgYXRvbVxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRQYXJ0aWNsZURlc3RpbmF0aW9uKCBwYXJ0aWNsZVR5cGU6IFBhcnRpY2xlVHlwZSwgcGFydGljbGU6IFBhcnRpY2xlICk6IFZlY3RvcjIge1xyXG4gICAgcmV0dXJuIHRoaXMucGFydGljbGVBdG9tLnBvc2l0aW9uUHJvcGVydHkudmFsdWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGQgYSBQYXJ0aWNsZSB0byB0aGUgbW9kZWxcclxuICAgKi9cclxuICBwdWJsaWMgYWRkUGFydGljbGUoIHBhcnRpY2xlOiBQYXJ0aWNsZSApOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIF8uc29tZSggUGFydGljbGVUeXBlLmVudW1lcmF0aW9uLnZhbHVlcywgcGFydGljbGVUeXBlID0+IHtcclxuICAgICAgICByZXR1cm4gcGFydGljbGUudHlwZSA9PT0gcGFydGljbGVUeXBlLm5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgfSApLFxyXG4gICAgICAnUGFydGljbGVzIG11c3QgYmUgb25lIG9mIHRoZSB0eXBlcyBpbiBQYXJ0aWNsZVR5cGUgJyArIHBhcnRpY2xlLnR5cGUgKTtcclxuICAgIHRoaXMucGFydGljbGVzLnB1c2goIHBhcnRpY2xlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmUgYSBQYXJ0aWNsZSBmcm9tIHRoZSBtb2RlbFxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVQYXJ0aWNsZSggcGFydGljbGU6IFBhcnRpY2xlICk6IHZvaWQge1xyXG4gICAgdGhpcy5wYXJ0aWNsZXMucmVtb3ZlKCBwYXJ0aWNsZSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5wYXJ0aWNsZUF0b20uY2xlYXIoKTtcclxuICAgIHRoaXMucGFydGljbGVzLmNsZWFyKCk7XHJcbiAgICB0aGlzLmluY29taW5nUHJvdG9ucy5jbGVhcigpO1xyXG4gICAgdGhpcy5pbmNvbWluZ05ldXRyb25zLmNsZWFyKCk7XHJcbiAgICB0aGlzLm91dGdvaW5nUGFydGljbGVzLmNsZWFyKCk7XHJcbiAgICB0aGlzLnVzZXJDb250cm9sbGVkUHJvdG9ucy5jbGVhcigpO1xyXG4gICAgdGhpcy51c2VyQ29udHJvbGxlZE5ldXRyb25zLmNsZWFyKCk7XHJcbiAgICB0aGlzLnBhcnRpY2xlQW5pbWF0aW9ucy5jbGVhcigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIGR0IC0gdGltZSBzdGVwLCBpbiBzZWNvbmRzXHJcbiAgICovXHJcbiAgcHVibGljIHN0ZXAoIGR0OiBudW1iZXIgKTogdm9pZCB7XHJcblxyXG4gICAgLy8gVXBkYXRlIHBhcnRpY2xlIHBvc2l0aW9uc1xyXG4gICAgdGhpcy5wYXJ0aWNsZXMuZm9yRWFjaCggcGFydGljbGUgPT4ge1xyXG4gICAgICBwYXJ0aWNsZS5zdGVwKCBkdCApO1xyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxuYnVpbGRBTnVjbGV1cy5yZWdpc3RlciggJ0JBTk1vZGVsJywgQkFOTW9kZWwgKTtcclxuZXhwb3J0IGRlZmF1bHQgQkFOTW9kZWw7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGFBQWEsTUFBTSx3QkFBd0I7QUFDbEQsT0FBT0MsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxjQUFjLE1BQU0sd0NBQXdDO0FBR25FLE9BQU9DLHFCQUFxQixNQUEyQiw4Q0FBOEM7QUFHckcsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxZQUFZLE1BQU0seUJBQXlCO0FBQ2xELE9BQU9DLGVBQWUsTUFBTSx3Q0FBd0M7QUFJcEUsTUFBTUMsUUFBUSxDQUF5QjtFQUVyQzs7RUFHQTs7RUFHQTs7RUFHQTs7RUFHQTs7RUFHQTs7RUFHQTs7RUFJQTs7RUFHQTs7RUFNQTs7RUFHVUMsV0FBV0EsQ0FBRUMsbUJBQTJCLEVBQUVDLG9CQUE0QixFQUFFQyxZQUFlLEVBQUc7SUFFbEc7SUFDQSxJQUFJLENBQUNBLFlBQVksR0FBR0EsWUFBWTtJQUVoQyxJQUFJLENBQUNDLFNBQVMsR0FBR1QscUJBQXFCLENBQUMsQ0FBQztJQUV4QyxJQUFJLENBQUNVLGVBQWUsR0FBR1YscUJBQXFCLENBQUMsQ0FBQztJQUM5QyxJQUFJLENBQUNXLGdCQUFnQixHQUFHWCxxQkFBcUIsQ0FBQyxDQUFDO0lBRS9DLElBQUksQ0FBQ1kscUJBQXFCLEdBQUdaLHFCQUFxQixDQUFDLENBQUM7SUFDcEQsSUFBSSxDQUFDYSxzQkFBc0IsR0FBR2IscUJBQXFCLENBQUMsQ0FBQztJQUVyRCxJQUFJLENBQUNjLGlCQUFpQixHQUFHZCxxQkFBcUIs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