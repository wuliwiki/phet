// Copyright 2023, University of Colorado Boulder

/**
 * Node that represents the initial part of the Nuclide chart, up to 10 protons and 12 neutrons.
 *
 * @author Luisa Vargas
 */

import { Color, Node } from '../../../../scenery/js/imports.js';
import AtomIdentifier from '../../../../shred/js/AtomIdentifier.js';
import buildANucleus from '../../buildANucleus.js';
import NuclideChartCell from './NuclideChartCell.js';
import BANColors from '../../common/BANColors.js';
import DecayType from '../../common/view/DecayType.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Multilink from '../../../../axon/js/Multilink.js';
import Orientation from '../../../../phet-core/js/Orientation.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import optionize from '../../../../phet-core/js/optionize.js';
// 2D array that defines the table structure.
// The rows are the proton number, for example the first row is protonNumber = 0. The numbers in the rows are the neutron number.
const POPULATED_CELLS = [[1, 4, 6], [0, 1, 2, 3, 4, 5, 6], [1, 2, 3, 4, 5, 6, 7, 8], [1, 2, 3, 4, 5, 6, 7, 8, 9], [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], [3, 4, 5, 6, 7, 8, 9, 10, 11, 12], [3, 4, 5, 6, 7, 8, 9, 10, 11, 12], [4, 5, 6, 7, 8, 9, 10, 11, 12], [5, 6, 7, 8, 9, 10, 11, 12]];
class NuclideChartNode extends Node {
  constructor(protonCountProperty, neutronCountProperty, chartTransform, providedOptions) {
    const options = optionize()({}, providedOptions);
    super(options);

    // keep track of the cells of the chart
    this.cells = [];
    const cellLength = chartTransform.modelToViewDeltaX(1);

    // create and add the chart cells to the chart. row is proton number and column is neutron number.
    chartTransform.forEachSpacing(Orientation.VERTICAL, 1, 0, 'strict', (row, viewPosition) => {
      const populatedCellsInRow = POPULATED_CELLS[row];
      const rowCells = [];
      populatedCellsInRow.forEach(column => {
        // get first decay in available decays to color the cell according to that decay type
        const decayType = AtomIdentifier.getAvailableDecays(row, column)[0];
        const color = AtomIdentifier.isStable(row, column) ? BANColors.stableColorProperty.value : decayType === undefined ? BANColors.unknownColorProperty.value :
        // no available decays, unknown decay type
        DecayType.enumeration.getValue(decayType.toString()).colorProperty.value;
        const elementSymbol = AtomIdentifier.getSymbol(row);

        // create and add the NuclideChartCell
        const cell = new NuclideChartCell(cellLength, elementSymbol, row, column, decayType, {
          fill: color,
          cellTextFontSize: options.cellTextFontSize
        });
        cell.translation = new Vector2(chartTransform.modelToViewX(column), viewPosition);
        this.addChild(cell);
        rowCells.push(cell);
      });
      this.cells.push(rowCells);
    });
    const arrowNode = new ArrowNode(0, 0, 100, 100, {
      headWidth: 5,
      headHeight: 5,
      tailWidth: 2.5,
      fill: Color.WHITE,
      stroke: null,
      visible: false
    });
    if (options.arrowSymbol) {
      this.addChild(arrowNode);
    }

    // highlight the cell that corresponds to the nuclide and make opaque any surrounding cells too far away from the nuclide
    let highlightedCell = null;
    Multilink.multilink([protonCountProperty, neutronCountProperty], (protonCount, neutronCount) => {
      if (highlightedCell !== null) {
        highlightedCell.setHighlighted(false);
      }

      // highlight the cell if it exists
      if (AtomIdentifier.doesExist(protonCount, neutronCount) && (protonCount !== 0 || neutronCount !== 0)) {
        const protonRowIndex = protonCount;
        const neutronRowIndex = POPULATED_CELLS[protonRowIndex].indexOf(neutronCount);
        highlightedCell = this.cells[protonRowIndex][neutronRowIndex];
        highlightedCell.setHighlighted(true);
        const decayType = highlightedCell.decayType;
        if (!AtomIdentifier.isStable(protonCount, neutronCount) && decayType !== undefined) {
          const direction = decayType === DecayType.NEUTRON_EMISSION.name ? new Vector2(-0.7, 0) : decayType === DecayType.PROTON_EMISSION.name ? new Vector2(0, -0.7) : decayType === DecayType.BETA_PLUS_DECAY.name ? new Vector2(1, -1).normalized() : decayType === DecayType.BETA_MINUS_DECAY.name ? new Vector2(-1, 1).normalized() : new Vector2(-2, -2);
          const viewDirection = chartTransform.modelToViewDeltaXY(direction.x, direction.y);
          arrowNode.setTip(viewDirection.x, viewDirection.y);
          arrowNode.center = highlightedCell.center.plusXY(viewDirection.withMagnitude(cellLength / 2).x, viewDirection.normalized().y);
          arrowNode.visible = true;
        } else {
          arrowNode.visible = false;
        }
      } else {
        arrowNode.visible = false;
      }
    });
  }
}
buildANucleus.register('NuclideChartNode', NuclideChartNode);
export default NuclideChartNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDb2xvciIsIk5vZGUiLCJBdG9tSWRlbnRpZmllciIsImJ1aWxkQU51Y2xldXMiLCJOdWNsaWRlQ2hhcnRDZWxsIiwiQkFOQ29sb3JzIiwiRGVjYXlUeXBlIiwiVmVjdG9yMiIsIk11bHRpbGluayIsIk9yaWVudGF0aW9uIiwiQXJyb3dOb2RlIiwib3B0aW9uaXplIiwiUE9QVUxBVEVEX0NFTExTIiwiTnVjbGlkZUNoYXJ0Tm9kZSIsImNvbnN0cnVjdG9yIiwicHJvdG9uQ291bnRQcm9wZXJ0eSIsIm5ldXRyb25Db3VudFByb3BlcnR5IiwiY2hhcnRUcmFuc2Zvcm0iLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiY2VsbHMiLCJjZWxsTGVuZ3RoIiwibW9kZWxUb1ZpZXdEZWx0YVgiLCJmb3JFYWNoU3BhY2luZyIsIlZFUlRJQ0FMIiwicm93Iiwidmlld1Bvc2l0aW9uIiwicG9wdWxhdGVkQ2VsbHNJblJvdyIsInJvd0NlbGxzIiwiZm9yRWFjaCIsImNvbHVtbiIsImRlY2F5VHlwZSIsImdldEF2YWlsYWJsZURlY2F5cyIsImNvbG9yIiwiaXNTdGFibGUiLCJzdGFibGVDb2xvclByb3BlcnR5IiwidmFsdWUiLCJ1bmRlZmluZWQiLCJ1bmtub3duQ29sb3JQcm9wZXJ0eSIsImVudW1lcmF0aW9uIiwiZ2V0VmFsdWUiLCJ0b1N0cmluZyIsImNvbG9yUHJvcGVydHkiLCJlbGVtZW50U3ltYm9sIiwiZ2V0U3ltYm9sIiwiY2VsbCIsImZpbGwiLCJjZWxsVGV4dEZvbnRTaXplIiwidHJhbnNsYXRpb24iLCJtb2RlbFRvVmlld1giLCJhZGRDaGlsZCIsInB1c2giLCJhcnJvd05vZGUiLCJoZWFkV2lkdGgiLCJoZWFkSGVpZ2h0IiwidGFpbFdpZHRoIiwiV0hJVEUiLCJzdHJva2UiLCJ2aXNpYmxlIiwiYXJyb3dTeW1ib2wiLCJoaWdobGlnaHRlZENlbGwiLCJtdWx0aWxpbmsiLCJwcm90b25Db3VudCIsIm5ldXRyb25Db3VudCIsInNldEhpZ2hsaWdodGVkIiwiZG9lc0V4aXN0IiwicHJvdG9uUm93SW5kZXgiLCJuZXV0cm9uUm93SW5kZXgiLCJpbmRleE9mIiwiZGlyZWN0aW9uIiwiTkVVVFJPTl9FTUlTU0lPTiIsIm5hbWUiLCJQUk9UT05fRU1JU1NJT04iLCJCRVRBX1BMVVNfREVDQVkiLCJub3JtYWxpemVkIiwiQkVUQV9NSU5VU19ERUNBWSIsInZpZXdEaXJlY3Rpb24iLCJtb2RlbFRvVmlld0RlbHRhWFkiLCJ4IiwieSIsInNldFRpcCIsImNlbnRlciIsInBsdXNYWSIsIndpdGhNYWduaXR1ZGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIk51Y2xpZGVDaGFydE5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIE5vZGUgdGhhdCByZXByZXNlbnRzIHRoZSBpbml0aWFsIHBhcnQgb2YgdGhlIE51Y2xpZGUgY2hhcnQsIHVwIHRvIDEwIHByb3RvbnMgYW5kIDEyIG5ldXRyb25zLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEx1aXNhIFZhcmdhc1xyXG4gKi9cclxuXHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgQ29sb3IsIE5vZGUsIE5vZGVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEF0b21JZGVudGlmaWVyIGZyb20gJy4uLy4uLy4uLy4uL3NocmVkL2pzL0F0b21JZGVudGlmaWVyLmpzJztcclxuaW1wb3J0IGJ1aWxkQU51Y2xldXMgZnJvbSAnLi4vLi4vYnVpbGRBTnVjbGV1cy5qcyc7XHJcbmltcG9ydCBOdWNsaWRlQ2hhcnRDZWxsIGZyb20gJy4vTnVjbGlkZUNoYXJ0Q2VsbC5qcyc7XHJcbmltcG9ydCBCQU5Db2xvcnMgZnJvbSAnLi4vLi4vY29tbW9uL0JBTkNvbG9ycy5qcyc7XHJcbmltcG9ydCBEZWNheVR5cGUgZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvRGVjYXlUeXBlLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IENoYXJ0VHJhbnNmb3JtIGZyb20gJy4uLy4uLy4uLy4uL2JhbWJvby9qcy9DaGFydFRyYW5zZm9ybS5qcyc7XHJcbmltcG9ydCBPcmllbnRhdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvT3JpZW50YXRpb24uanMnO1xyXG5pbXBvcnQgQXJyb3dOb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9BcnJvd05vZGUuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICBjZWxsVGV4dEZvbnRTaXplOiBudW1iZXI7XHJcbiAgYXJyb3dTeW1ib2w6IGJvb2xlYW47XHJcbn07XHJcblxyXG50eXBlIE51Y2xpZGVDaGFydE5vZGVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBOb2RlT3B0aW9ucztcclxuXHJcbi8vIDJEIGFycmF5IHRoYXQgZGVmaW5lcyB0aGUgdGFibGUgc3RydWN0dXJlLlxyXG4vLyBUaGUgcm93cyBhcmUgdGhlIHByb3RvbiBudW1iZXIsIGZvciBleGFtcGxlIHRoZSBmaXJzdCByb3cgaXMgcHJvdG9uTnVtYmVyID0gMC4gVGhlIG51bWJlcnMgaW4gdGhlIHJvd3MgYXJlIHRoZSBuZXV0cm9uIG51bWJlci5cclxuY29uc3QgUE9QVUxBVEVEX0NFTExTID0gW1xyXG4gIFsgMSwgNCwgNiBdLFxyXG4gIFsgMCwgMSwgMiwgMywgNCwgNSwgNiBdLFxyXG4gIFsgMSwgMiwgMywgNCwgNSwgNiwgNywgOCBdLFxyXG4gIFsgMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSBdLFxyXG4gIFsgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgMTAsIDExLCAxMiBdLFxyXG4gIFsgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgMTAsIDExLCAxMiBdLFxyXG4gIFsgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgMTAsIDExLCAxMiBdLFxyXG4gIFsgMywgNCwgNSwgNiwgNywgOCwgOSwgMTAsIDExLCAxMiBdLFxyXG4gIFsgMywgNCwgNSwgNiwgNywgOCwgOSwgMTAsIDExLCAxMiBdLFxyXG4gIFsgNCwgNSwgNiwgNywgOCwgOSwgMTAsIDExLCAxMiBdLFxyXG4gIFsgNSwgNiwgNywgOCwgOSwgMTAsIDExLCAxMiBdXHJcbl07XHJcblxyXG5jbGFzcyBOdWNsaWRlQ2hhcnROb2RlIGV4dGVuZHMgTm9kZSB7XHJcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGNlbGxzOiAoIE51Y2xpZGVDaGFydENlbGwgfCBudWxsIClbXVtdO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3RvbkNvdW50UHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PG51bWJlcj4sIG5ldXRyb25Db3VudFByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXI+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgY2hhcnRUcmFuc2Zvcm06IENoYXJ0VHJhbnNmb3JtLCBwcm92aWRlZE9wdGlvbnM6IE51Y2xpZGVDaGFydE5vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8TnVjbGlkZUNoYXJ0Tm9kZU9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge30sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBrZWVwIHRyYWNrIG9mIHRoZSBjZWxscyBvZiB0aGUgY2hhcnRcclxuICAgIHRoaXMuY2VsbHMgPSBbXTtcclxuICAgIGNvbnN0IGNlbGxMZW5ndGggPSBjaGFydFRyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggMSApO1xyXG5cclxuICAgIC8vIGNyZWF0ZSBhbmQgYWRkIHRoZSBjaGFydCBjZWxscyB0byB0aGUgY2hhcnQuIHJvdyBpcyBwcm90b24gbnVtYmVyIGFuZCBjb2x1bW4gaXMgbmV1dHJvbiBudW1iZXIuXHJcbiAgICBjaGFydFRyYW5zZm9ybS5mb3JFYWNoU3BhY2luZyggT3JpZW50YXRpb24uVkVSVElDQUwsIDEsIDAsICdzdHJpY3QnLCAoIHJvdywgdmlld1Bvc2l0aW9uICkgPT4ge1xyXG4gICAgICBjb25zdCBwb3B1bGF0ZWRDZWxsc0luUm93ID0gUE9QVUxBVEVEX0NFTExTWyByb3cgXTtcclxuICAgICAgY29uc3Qgcm93Q2VsbHM6ICggTnVjbGlkZUNoYXJ0Q2VsbCB8IG51bGwgKVtdID0gW107XHJcbiAgICAgIHBvcHVsYXRlZENlbGxzSW5Sb3cuZm9yRWFjaCggY29sdW1uID0+IHtcclxuXHJcbiAgICAgICAgLy8gZ2V0IGZpcnN0IGRlY2F5IGluIGF2YWlsYWJsZSBkZWNheXMgdG8gY29sb3IgdGhlIGNlbGwgYWNjb3JkaW5nIHRvIHRoYXQgZGVjYXkgdHlwZVxyXG4gICAgICAgIGNvbnN0IGRlY2F5VHlwZSA9IEF0b21JZGVudGlmaWVyLmdldEF2YWlsYWJsZURlY2F5cyggcm93LCBjb2x1bW4gKVsgMCBdO1xyXG5cclxuICAgICAgICBjb25zdCBjb2xvciA9IEF0b21JZGVudGlmaWVyLmlzU3RhYmxlKCByb3csIGNvbHVtbiApID8gQkFOQ29sb3JzLnN0YWJsZUNvbG9yUHJvcGVydHkudmFsdWUgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgZGVjYXlUeXBlID09PSB1bmRlZmluZWQgPyBCQU5Db2xvcnMudW5rbm93bkNvbG9yUHJvcGVydHkudmFsdWUgOiAvLyBubyBhdmFpbGFibGUgZGVjYXlzLCB1bmtub3duIGRlY2F5IHR5cGVcclxuICAgICAgICAgICAgICAgICAgICAgIERlY2F5VHlwZS5lbnVtZXJhdGlvbi5nZXRWYWx1ZSggZGVjYXlUeXBlLnRvU3RyaW5nKCkgKS5jb2xvclByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgICAgICBjb25zdCBlbGVtZW50U3ltYm9sID0gQXRvbUlkZW50aWZpZXIuZ2V0U3ltYm9sKCByb3cgKTtcclxuXHJcbiAgICAgICAgLy8gY3JlYXRlIGFuZCBhZGQgdGhlIE51Y2xpZGVDaGFydENlbGxcclxuICAgICAgICBjb25zdCBjZWxsID0gbmV3IE51Y2xpZGVDaGFydENlbGwoIGNlbGxMZW5ndGgsIGVsZW1lbnRTeW1ib2wsIHJvdywgY29sdW1uLCBkZWNheVR5cGUsIHtcclxuICAgICAgICAgIGZpbGw6IGNvbG9yLFxyXG4gICAgICAgICAgY2VsbFRleHRGb250U2l6ZTogb3B0aW9ucy5jZWxsVGV4dEZvbnRTaXplXHJcbiAgICAgICAgfSApO1xyXG4gICAgICAgIGNlbGwudHJhbnNsYXRpb24gPSBuZXcgVmVjdG9yMiggY2hhcnRUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCBjb2x1bW4gKSwgdmlld1Bvc2l0aW9uICk7XHJcbiAgICAgICAgdGhpcy5hZGRDaGlsZCggY2VsbCApO1xyXG4gICAgICAgIHJvd0NlbGxzLnB1c2goIGNlbGwgKTtcclxuICAgICAgfSApO1xyXG4gICAgICB0aGlzLmNlbGxzLnB1c2goIHJvd0NlbGxzICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgYXJyb3dOb2RlID0gbmV3IEFycm93Tm9kZSggMCwgMCwgMTAwLCAxMDAsIHtcclxuICAgICAgaGVhZFdpZHRoOiA1LFxyXG4gICAgICBoZWFkSGVpZ2h0OiA1LFxyXG4gICAgICB0YWlsV2lkdGg6IDIuNSxcclxuICAgICAgZmlsbDogQ29sb3IuV0hJVEUsXHJcbiAgICAgIHN0cm9rZTogbnVsbCxcclxuICAgICAgdmlzaWJsZTogZmFsc2VcclxuICAgIH0gKTtcclxuICAgIGlmICggb3B0aW9ucy5hcnJvd1N5bWJvbCApIHtcclxuICAgICAgdGhpcy5hZGRDaGlsZCggYXJyb3dOb2RlICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaGlnaGxpZ2h0IHRoZSBjZWxsIHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIG51Y2xpZGUgYW5kIG1ha2Ugb3BhcXVlIGFueSBzdXJyb3VuZGluZyBjZWxscyB0b28gZmFyIGF3YXkgZnJvbSB0aGUgbnVjbGlkZVxyXG4gICAgbGV0IGhpZ2hsaWdodGVkQ2VsbDogTnVjbGlkZUNoYXJ0Q2VsbCB8IG51bGwgPSBudWxsO1xyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayggWyBwcm90b25Db3VudFByb3BlcnR5LCBuZXV0cm9uQ291bnRQcm9wZXJ0eSBdLFxyXG4gICAgICAoIHByb3RvbkNvdW50OiBudW1iZXIsIG5ldXRyb25Db3VudDogbnVtYmVyICkgPT4ge1xyXG4gICAgICAgIGlmICggaGlnaGxpZ2h0ZWRDZWxsICE9PSBudWxsICkge1xyXG4gICAgICAgICAgaGlnaGxpZ2h0ZWRDZWxsLnNldEhpZ2hsaWdodGVkKCBmYWxzZSApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gaGlnaGxpZ2h0IHRoZSBjZWxsIGlmIGl0IGV4aXN0c1xyXG4gICAgICAgIGlmICggQXRvbUlkZW50aWZpZXIuZG9lc0V4aXN0KCBwcm90b25Db3VudCwgbmV1dHJvbkNvdW50ICkgJiYgKCBwcm90b25Db3VudCAhPT0gMCB8fCBuZXV0cm9uQ291bnQgIT09IDAgKSApIHtcclxuICAgICAgICAgIGNvbnN0IHByb3RvblJvd0luZGV4ID0gcHJvdG9uQ291bnQ7XHJcbiAgICAgICAgICBjb25zdCBuZXV0cm9uUm93SW5kZXggPSBQT1BVTEFURURfQ0VMTFNbIHByb3RvblJvd0luZGV4IF0uaW5kZXhPZiggbmV1dHJvbkNvdW50ICk7XHJcbiAgICAgICAgICBoaWdobGlnaHRlZENlbGwgPSB0aGlzLmNlbGxzWyBwcm90b25Sb3dJbmRleCBdWyBuZXV0cm9uUm93SW5kZXggXTtcclxuICAgICAgICAgIGhpZ2hsaWdodGVkQ2VsbCEuc2V0SGlnaGxpZ2h0ZWQoIHRydWUgKTtcclxuXHJcbiAgICAgICAgICBjb25zdCBkZWNheVR5cGUgPSBoaWdobGlnaHRlZENlbGwhLmRlY2F5VHlwZTtcclxuICAgICAgICAgIGlmICggIUF0b21JZGVudGlmaWVyLmlzU3RhYmxlKCBwcm90b25Db3VudCwgbmV1dHJvbkNvdW50ICkgJiYgZGVjYXlUeXBlICE9PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IGRlY2F5VHlwZSA9PT0gRGVjYXlUeXBlLk5FVVRST05fRU1JU1NJT04ubmFtZSA/IG5ldyBWZWN0b3IyKCAtMC43LCAwICkgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNheVR5cGUgPT09IERlY2F5VHlwZS5QUk9UT05fRU1JU1NJT04ubmFtZSA/IG5ldyBWZWN0b3IyKCAwLCAtMC43ICkgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNheVR5cGUgPT09IERlY2F5VHlwZS5CRVRBX1BMVVNfREVDQVkubmFtZSA/IG5ldyBWZWN0b3IyKCAxLCAtMSApLm5vcm1hbGl6ZWQoKSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY2F5VHlwZSA9PT0gRGVjYXlUeXBlLkJFVEFfTUlOVVNfREVDQVkubmFtZSA/IG5ldyBWZWN0b3IyKCAtMSwgMSApLm5vcm1hbGl6ZWQoKSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBWZWN0b3IyKCAtMiwgLTIgKTtcclxuICAgICAgICAgICAgY29uc3Qgdmlld0RpcmVjdGlvbiA9IGNoYXJ0VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFYWSggZGlyZWN0aW9uLngsIGRpcmVjdGlvbi55ICk7XHJcbiAgICAgICAgICAgIGFycm93Tm9kZS5zZXRUaXAoIHZpZXdEaXJlY3Rpb24ueCwgdmlld0RpcmVjdGlvbi55ICk7XHJcbiAgICAgICAgICAgIGFycm93Tm9kZS5jZW50ZXIgPSBoaWdobGlnaHRlZENlbGwhLmNlbnRlci5wbHVzWFkoIHZpZXdEaXJlY3Rpb24ud2l0aE1hZ25pdHVkZSggY2VsbExlbmd0aCAvIDIgKS54LCB2aWV3RGlyZWN0aW9uLm5vcm1hbGl6ZWQoKS55ICk7XHJcbiAgICAgICAgICAgIGFycm93Tm9kZS52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBhcnJvd05vZGUudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGFycm93Tm9kZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5idWlsZEFOdWNsZXVzLnJlZ2lzdGVyKCAnTnVjbGlkZUNoYXJ0Tm9kZScsIE51Y2xpZGVDaGFydE5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgTnVjbGlkZUNoYXJ0Tm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0EsU0FBU0EsS0FBSyxFQUFFQyxJQUFJLFFBQXFCLG1DQUFtQztBQUM1RSxPQUFPQyxjQUFjLE1BQU0sd0NBQXdDO0FBQ25FLE9BQU9DLGFBQWEsTUFBTSx3QkFBd0I7QUFDbEQsT0FBT0MsZ0JBQWdCLE1BQU0sdUJBQXVCO0FBQ3BELE9BQU9DLFNBQVMsTUFBTSwyQkFBMkI7QUFDakQsT0FBT0MsU0FBUyxNQUFNLGdDQUFnQztBQUN0RCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLFNBQVMsTUFBTSxrQ0FBa0M7QUFFeEQsT0FBT0MsV0FBVyxNQUFNLHlDQUF5QztBQUNqRSxPQUFPQyxTQUFTLE1BQU0sMENBQTBDO0FBQ2hFLE9BQU9DLFNBQVMsTUFBTSx1Q0FBdUM7QUFTN0Q7QUFDQTtBQUNBLE1BQU1DLGVBQWUsR0FBRyxDQUN0QixDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFFLEVBQ1gsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUUsRUFDdkIsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFFLEVBQzFCLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUUsRUFDN0IsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFFLEVBQ3RDLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBRSxFQUN0QyxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUUsRUFDdEMsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUUsRUFDbkMsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUUsRUFDbkMsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFF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