// Copyright 2022-2023, University of Colorado Boulder

import EnumerationProperty from '../../../../axon/js/EnumerationProperty.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import ParticleAtom from '../../../../shred/js/model/ParticleAtom.js';
import buildANucleus from '../../buildANucleus.js';
import BANConstants from '../../common/BANConstants.js';
import ParticleType from '../../common/view/ParticleType.js';
import EnergyLevelType from './EnergyLevelType.js';

/**
 * A model element that represents a nucleus that is made up of protons and neutrons. This model element
 * manages the positions and motion of all particles that are a part of the nucleus.
 *
 * @author Marla Schulz (PhET Interactive Simulations)
 * @author Luisa Vargas
 */

// constants
// row is yPosition, number is xPosition
const ALLOWED_PARTICLE_POSITIONS = [[2, 3], [0, 1, 2, 3, 4, 5], [0, 1, 2, 3, 4, 5]];
class ParticleNucleus extends ParticleAtom {
  // allowed proton positions

  // allowed neutron positions

  constructor() {
    super();
    this.modelViewTransform = BANConstants.NUCLEON_ENERGY_LEVEL_ARRAY_MVT;

    // Initialize the positions where a nucleon can be placed.
    this.protonShellPositions = [[], [], []];
    this.neutronShellPositions = [[], [], []];
    for (let i = 0; i < ALLOWED_PARTICLE_POSITIONS.length; i++) {
      for (let j = 0; j < ALLOWED_PARTICLE_POSITIONS[i].length; j++) {
        const shellPosition = {
          particle: undefined,
          xPosition: ALLOWED_PARTICLE_POSITIONS[i][j]
        };
        const protonShellPosition = {
          ...shellPosition,
          type: ParticleType.PROTON
        };
        const neutronShellPosition = {
          ...shellPosition,
          type: ParticleType.NEUTRON
        };
        this.protonShellPositions[i][ALLOWED_PARTICLE_POSITIONS[i][j]] = protonShellPosition;
        this.neutronShellPositions[i][ALLOWED_PARTICLE_POSITIONS[i][j]] = neutronShellPosition;
      }
    }

    // keep track of bound levels
    this.protonsLevelProperty = new EnumerationProperty(EnergyLevelType.NONE);
    this.neutronsLevelProperty = new EnumerationProperty(EnergyLevelType.NONE);

    // update bound levels based on nucleon counts
    this.protonCountProperty.link(protonCount => {
      if (protonCount >= 9) {
        this.protonsLevelProperty.value = EnergyLevelType.SECOND;
      } else if (protonCount >= 3) {
        this.protonsLevelProperty.value = EnergyLevelType.FIRST;
      } else {
        this.protonsLevelProperty.value = EnergyLevelType.NONE;
      }
    });
    this.neutronCountProperty.link(neutronCount => {
      if (neutronCount >= 9) {
        this.neutronsLevelProperty.value = EnergyLevelType.SECOND;
      } else if (neutronCount >= 3) {
        this.neutronsLevelProperty.value = EnergyLevelType.FIRST;
      } else {
        this.neutronsLevelProperty.value = EnergyLevelType.NONE;
      }
    });

    // update nucleon positions when the level state changes
    this.protonsLevelProperty.link(() => this.updateNucleonPositions(this.protons, this.protonShellPositions, this.protonsLevelProperty, 0));
    this.neutronsLevelProperty.link(() => this.updateNucleonPositions(this.neutrons, this.neutronShellPositions, this.neutronsLevelProperty, BANConstants.X_DISTANCE_BETWEEN_ENERGY_LEVELS));
  }
  getLastParticleInShell(particleType) {
    const nucleonShellPositions = particleType === ParticleType.NEUTRON ? this.neutronShellPositions : this.protonShellPositions;
    for (let i = nucleonShellPositions.length - 1; i >= 0; i--) {
      const nucleonShellRow = nucleonShellPositions[i];
      for (let j = nucleonShellRow.length - 1; j >= 0; j--) {
        if (nucleonShellRow[j].particle !== undefined) {
          return nucleonShellRow[j].particle;
        }
      }
    }
    return undefined;
  }

  /**
   * Return the view destination of the next open position for the given particleType shell positions.
   */
  getParticleDestination(particleType, particle) {
    const nucleonShellPositions = particleType === ParticleType.NEUTRON ? this.neutronShellPositions : this.protonShellPositions;
    let yPosition = 0;
    const openNucleonShellPositions = nucleonShellPositions.map(particleShellRow => {
      // remove any empty particleShellPosition's from particleShellRow
      const noEmptyPositions = particleShellRow.filter(particleShellPosition => particleShellPosition !== undefined);

      // get the first open shell position in this particleShellRow
      return noEmptyPositions.find(particleShellPosition => particleShellPosition.particle === undefined);
    });

    // get the first open shell position available from all rows
    const openParticleShellPosition = openNucleonShellPositions.find((particleShellPosition, index) => {
      yPosition = index;
      return particleShellPosition !== undefined;
    });
    assert && assert(openParticleShellPosition !== undefined, 'To add a particle there must be an empty particleShellPosition.');
    openParticleShellPosition.particle = particle;
    // @ts-expect-error openParticleShellPosition should never be undefined
    const viewDestination = this.modelViewTransform.modelToViewXY(openParticleShellPosition.xPosition, yPosition);

    // add x offset for neutron particle to be aligned with its energy level position
    viewDestination.addXY(particleType === ParticleType.NEUTRON ? BANConstants.X_DISTANCE_BETWEEN_ENERGY_LEVELS : 0, 0);
    return viewDestination;
  }
  reconfigureNucleus() {
    this.updateNucleonPositions(this.protons, this.protonShellPositions, this.protonsLevelProperty, 0);
    this.updateNucleonPositions(this.neutrons, this.neutronShellPositions, this.neutronsLevelProperty, BANConstants.X_DISTANCE_BETWEEN_ENERGY_LEVELS);
  }
  removeParticle(particle) {
    const nucleonShellPositions = particle.type === ParticleType.PROTON.name.toLowerCase() ? this.protonShellPositions : this.neutronShellPositions;
    nucleonShellPositions.forEach(nucleonShellRow => {
      nucleonShellRow.forEach(nucleonShellPosition => {
        if (nucleonShellPosition.particle === particle) {
          nucleonShellPosition.particle = undefined;
        }
      });
    });
    super.removeParticle(particle);
  }

  /**
   * Fill all nucleons in open positions from bottom to top, left to right
   */
  updateNucleonPositions(particleArray, particleShellPositions, levelFillProperty, xOffset) {
    const levelWidth = this.modelViewTransform.modelToViewX(ALLOWED_PARTICLE_POSITIONS[1][5]) - this.modelViewTransform.modelToViewX(ALLOWED_PARTICLE_POSITIONS[1][0]);
    particleArray.forEach((particle, index) => {
      const yPosition = index < 2 ? 0 : index < 8 ? 1 : 2;
      const xPosition = yPosition === 0 ? index + 2 : yPosition === 1 ? index - 2 : index - 8;

      // last level (yPosition === 2) never bound so don't need levelIndex condition for it
      const levelIndex = yPosition === 0 ? index : index - 2;
      const nucleonShellPosition = particleShellPositions[yPosition][xPosition];
      const unBoundXPosition = this.modelViewTransform.modelToViewX(nucleonShellPosition.xPosition) + xOffset;
      nucleonShellPosition.particle = particle;
      let viewDestination;
      let inputEnabled;

      // if the yPosition of the levelFillProperty is higher than the current yPosition level, 'bind' the particles in
      // this level by removing the spaces between them
      if (yPosition < levelFillProperty.value.yPosition) {
        // each particle on the level has one 'particle radius' space except for one.
        // there are 2 particles on the y = 0 level and 6 particles on the y = 1 level.
        const numberOfRadiusSpaces = yPosition === 0 ? 2 - 1 : 6 - 1;

        // amount each particle moves so the space between it and the particle on its left is removed
        const boundOffset = levelWidth * (levelIndex / (3 * 5)); // 3 radius spaces / particle * 5 particle spaces

        // amount each particle has to move for all particles to be centered in middle of energy level
        const centerOffset = BANConstants.PARTICLE_RADIUS * numberOfRadiusSpaces / 2;
        const destinationX = unBoundXPosition - boundOffset + centerOffset;
        viewDestination = new Vector2(destinationX, this.modelViewTransform.modelToViewY(yPosition));
        inputEnabled = false;
      } else {
        viewDestination = this.modelViewTransform.modelToViewXY(nucleonShellPosition.xPosition, yPosition);
        viewDestination.addXY(xOffset, 0);
        inputEnabled = true;
      }

      // add x offset so neutron particles are aligned with their energy levels
      particle.destinationProperty.set(viewDestination);
      particle.inputEnabledProperty.value = inputEnabled;
    });
  }
}
buildANucleus.register('ParticleNucleus', ParticleNucleus);
export default ParticleNucleus;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFbnVtZXJhdGlvblByb3BlcnR5IiwiVmVjdG9yMiIsIlBhcnRpY2xlQXRvbSIsImJ1aWxkQU51Y2xldXMiLCJCQU5Db25zdGFudHMiLCJQYXJ0aWNsZVR5cGUiLCJFbmVyZ3lMZXZlbFR5cGUiLCJBTExPV0VEX1BBUlRJQ0xFX1BPU0lUSU9OUyIsIlBhcnRpY2xlTnVjbGV1cyIsImNvbnN0cnVjdG9yIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwiTlVDTEVPTl9FTkVSR1lfTEVWRUxfQVJSQVlfTVZUIiwicHJvdG9uU2hlbGxQb3NpdGlvbnMiLCJuZXV0cm9uU2hlbGxQb3NpdGlvbnMiLCJpIiwibGVuZ3RoIiwiaiIsInNoZWxsUG9zaXRpb24iLCJwYXJ0aWNsZSIsInVuZGVmaW5lZCIsInhQb3NpdGlvbiIsInByb3RvblNoZWxsUG9zaXRpb24iLCJ0eXBlIiwiUFJPVE9OIiwibmV1dHJvblNoZWxsUG9zaXRpb24iLCJORVVUUk9OIiwicHJvdG9uc0xldmVsUHJvcGVydHkiLCJOT05FIiwibmV1dHJvbnNMZXZlbFByb3BlcnR5IiwicHJvdG9uQ291bnRQcm9wZXJ0eSIsImxpbmsiLCJwcm90b25Db3VudCIsInZhbHVlIiwiU0VDT05EIiwiRklSU1QiLCJuZXV0cm9uQ291bnRQcm9wZXJ0eSIsIm5ldXRyb25Db3VudCIsInVwZGF0ZU51Y2xlb25Qb3NpdGlvbnMiLCJwcm90b25zIiwibmV1dHJvbnMiLCJYX0RJU1RBTkNFX0JFVFdFRU5fRU5FUkdZX0xFVkVMUyIsImdldExhc3RQYXJ0aWNsZUluU2hlbGwiLCJwYXJ0aWNsZVR5cGUiLCJudWNsZW9uU2hlbGxQb3NpdGlvbnMiLCJudWNsZW9uU2hlbGxSb3ciLCJnZXRQYXJ0aWNsZURlc3RpbmF0aW9uIiwieVBvc2l0aW9uIiwib3Blbk51Y2xlb25TaGVsbFBvc2l0aW9ucyIsIm1hcCIsInBhcnRpY2xlU2hlbGxSb3ciLCJub0VtcHR5UG9zaXRpb25zIiwiZmlsdGVyIiwicGFydGljbGVTaGVsbFBvc2l0aW9uIiwiZmluZCIsIm9wZW5QYXJ0aWNsZVNoZWxsUG9zaXRpb24iLCJpbmRleCIsImFzc2VydCIsInZpZXdEZXN0aW5hdGlvbiIsIm1vZGVsVG9WaWV3WFkiLCJhZGRYWSIsInJlY29uZmlndXJlTnVjbGV1cyIsInJlbW92ZVBhcnRpY2xlIiwibmFtZSIsInRvTG93ZXJDYXNlIiwiZm9yRWFjaCIsIm51Y2xlb25TaGVsbFBvc2l0aW9uIiwicGFydGljbGVBcnJheSIsInBhcnRpY2xlU2hlbGxQb3NpdGlvbnMiLCJsZXZlbEZpbGxQcm9wZXJ0eSIsInhPZmZzZXQiLCJsZXZlbFdpZHRoIiwibW9kZWxUb1ZpZXdYIiwibGV2ZWxJbmRleCIsInVuQm91bmRYUG9zaXRpb24iLCJpbnB1dEVuYWJsZWQiLCJudW1iZXJPZlJhZGl1c1NwYWNlcyIsImJvdW5kT2Zmc2V0IiwiY2VudGVyT2Zmc2V0IiwiUEFSVElDTEVfUkFESVVTIiwiZGVzdGluYXRpb25YIiwibW9kZWxUb1ZpZXdZIiwiZGVzdGluYXRpb25Qcm9wZXJ0eSIsInNldCIsImlucHV0RW5hYmxlZFByb3BlcnR5IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQYXJ0aWNsZU51Y2xldXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjItMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG5pbXBvcnQgeyBPYnNlcnZhYmxlQXJyYXkgfSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL2NyZWF0ZU9ic2VydmFibGVBcnJheS5qcyc7XHJcbmltcG9ydCBFbnVtZXJhdGlvblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRW51bWVyYXRpb25Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgUGFydGljbGUgZnJvbSAnLi4vLi4vLi4vLi4vc2hyZWQvanMvbW9kZWwvUGFydGljbGUuanMnO1xyXG5pbXBvcnQgUGFydGljbGVBdG9tIGZyb20gJy4uLy4uLy4uLy4uL3NocmVkL2pzL21vZGVsL1BhcnRpY2xlQXRvbS5qcyc7XHJcbmltcG9ydCBidWlsZEFOdWNsZXVzIGZyb20gJy4uLy4uL2J1aWxkQU51Y2xldXMuanMnO1xyXG5pbXBvcnQgQkFOQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9CQU5Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgUGFydGljbGVUeXBlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L1BhcnRpY2xlVHlwZS5qcyc7XHJcbmltcG9ydCBFbmVyZ3lMZXZlbFR5cGUgZnJvbSAnLi9FbmVyZ3lMZXZlbFR5cGUuanMnO1xyXG5cclxuLyoqXHJcbiAqIEEgbW9kZWwgZWxlbWVudCB0aGF0IHJlcHJlc2VudHMgYSBudWNsZXVzIHRoYXQgaXMgbWFkZSB1cCBvZiBwcm90b25zIGFuZCBuZXV0cm9ucy4gVGhpcyBtb2RlbCBlbGVtZW50XHJcbiAqIG1hbmFnZXMgdGhlIHBvc2l0aW9ucyBhbmQgbW90aW9uIG9mIGFsbCBwYXJ0aWNsZXMgdGhhdCBhcmUgYSBwYXJ0IG9mIHRoZSBudWNsZXVzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIE1hcmxhIFNjaHVseiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBMdWlzYSBWYXJnYXNcclxuICovXHJcblxyXG50eXBlIFBhcnRpY2xlU2hlbGxQb3NpdGlvbiA9IHtcclxuICBwYXJ0aWNsZTogUGFydGljbGUgfCB1bmRlZmluZWQ7XHJcbiAgeFBvc2l0aW9uOiBudW1iZXI7IC8vIDAgLSA1XHJcbiAgdHlwZTogUGFydGljbGVUeXBlO1xyXG59O1xyXG5cclxuLy8gY29uc3RhbnRzXHJcblxyXG4vLyByb3cgaXMgeVBvc2l0aW9uLCBudW1iZXIgaXMgeFBvc2l0aW9uXHJcbmNvbnN0IEFMTE9XRURfUEFSVElDTEVfUE9TSVRJT05TID0gW1xyXG4gIFsgMiwgMyBdLFxyXG4gIFsgMCwgMSwgMiwgMywgNCwgNSBdLFxyXG4gIFsgMCwgMSwgMiwgMywgNCwgNSBdXHJcbl07XHJcblxyXG5jbGFzcyBQYXJ0aWNsZU51Y2xldXMgZXh0ZW5kcyBQYXJ0aWNsZUF0b20ge1xyXG5cclxuICAvLyBhbGxvd2VkIHByb3RvbiBwb3NpdGlvbnNcclxuICBwdWJsaWMgcmVhZG9ubHkgcHJvdG9uU2hlbGxQb3NpdGlvbnM6IFBhcnRpY2xlU2hlbGxQb3NpdGlvbltdW107XHJcblxyXG4gIC8vIGFsbG93ZWQgbmV1dHJvbiBwb3NpdGlvbnNcclxuICBwdWJsaWMgcmVhZG9ubHkgbmV1dHJvblNoZWxsUG9zaXRpb25zOiBQYXJ0aWNsZVNoZWxsUG9zaXRpb25bXVtdO1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgbW9kZWxWaWV3VHJhbnNmb3JtOiBNb2RlbFZpZXdUcmFuc2Zvcm0yO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcHJvdG9uc0xldmVsUHJvcGVydHk6IEVudW1lcmF0aW9uUHJvcGVydHk8RW5lcmd5TGV2ZWxUeXBlPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IG5ldXRyb25zTGV2ZWxQcm9wZXJ0eTogRW51bWVyYXRpb25Qcm9wZXJ0eTxFbmVyZ3lMZXZlbFR5cGU+O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtID0gQkFOQ29uc3RhbnRzLk5VQ0xFT05fRU5FUkdZX0xFVkVMX0FSUkFZX01WVDtcclxuXHJcbiAgICAvLyBJbml0aWFsaXplIHRoZSBwb3NpdGlvbnMgd2hlcmUgYSBudWNsZW9uIGNhbiBiZSBwbGFjZWQuXHJcbiAgICB0aGlzLnByb3RvblNoZWxsUG9zaXRpb25zID0gW1xyXG4gICAgICBbXSwgW10sIFtdXHJcbiAgICBdO1xyXG4gICAgdGhpcy5uZXV0cm9uU2hlbGxQb3NpdGlvbnMgPSBbXHJcbiAgICAgIFtdLCBbXSwgW11cclxuICAgIF07XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBBTExPV0VEX1BBUlRJQ0xFX1BPU0lUSU9OUy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgZm9yICggbGV0IGogPSAwOyBqIDwgQUxMT1dFRF9QQVJUSUNMRV9QT1NJVElPTlNbIGkgXS5sZW5ndGg7IGorKyApIHtcclxuICAgICAgICBjb25zdCBzaGVsbFBvc2l0aW9uID0geyBwYXJ0aWNsZTogdW5kZWZpbmVkLCB4UG9zaXRpb246IEFMTE9XRURfUEFSVElDTEVfUE9TSVRJT05TWyBpIF1bIGogXSB9O1xyXG4gICAgICAgIGNvbnN0IHByb3RvblNoZWxsUG9zaXRpb24gPSB7IC4uLnNoZWxsUG9zaXRpb24sIHR5cGU6IFBhcnRpY2xlVHlwZS5QUk9UT04gfTtcclxuICAgICAgICBjb25zdCBuZXV0cm9uU2hlbGxQb3NpdGlvbiA9IHsgLi4uc2hlbGxQb3NpdGlvbiwgdHlwZTogUGFydGljbGVUeXBlLk5FVVRST04gfTtcclxuICAgICAgICB0aGlzLnByb3RvblNoZWxsUG9zaXRpb25zWyBpIF1bIEFMTE9XRURfUEFSVElDTEVfUE9TSVRJT05TWyBpIF1bIGogXSBdID0gcHJvdG9uU2hlbGxQb3NpdGlvbjtcclxuICAgICAgICB0aGlzLm5ldXRyb25TaGVsbFBvc2l0aW9uc1sgaSBdWyBBTExPV0VEX1BBUlRJQ0xFX1BPU0lUSU9OU1sgaSBdWyBqIF0gXSA9IG5ldXRyb25TaGVsbFBvc2l0aW9uO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8ga2VlcCB0cmFjayBvZiBib3VuZCBsZXZlbHNcclxuICAgIHRoaXMucHJvdG9uc0xldmVsUHJvcGVydHkgPSBuZXcgRW51bWVyYXRpb25Qcm9wZXJ0eSggRW5lcmd5TGV2ZWxUeXBlLk5PTkUgKTtcclxuICAgIHRoaXMubmV1dHJvbnNMZXZlbFByb3BlcnR5ID0gbmV3IEVudW1lcmF0aW9uUHJvcGVydHkoIEVuZXJneUxldmVsVHlwZS5OT05FICk7XHJcblxyXG4gICAgLy8gdXBkYXRlIGJvdW5kIGxldmVscyBiYXNlZCBvbiBudWNsZW9uIGNvdW50c1xyXG4gICAgdGhpcy5wcm90b25Db3VudFByb3BlcnR5LmxpbmsoIHByb3RvbkNvdW50ID0+IHtcclxuICAgICAgaWYgKCBwcm90b25Db3VudCA+PSA5ICkge1xyXG4gICAgICAgIHRoaXMucHJvdG9uc0xldmVsUHJvcGVydHkudmFsdWUgPSBFbmVyZ3lMZXZlbFR5cGUuU0VDT05EO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBwcm90b25Db3VudCA+PSAzICkge1xyXG4gICAgICAgIHRoaXMucHJvdG9uc0xldmVsUHJvcGVydHkudmFsdWUgPSBFbmVyZ3lMZXZlbFR5cGUuRklSU1Q7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdGhpcy5wcm90b25zTGV2ZWxQcm9wZXJ0eS52YWx1ZSA9IEVuZXJneUxldmVsVHlwZS5OT05FO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLm5ldXRyb25Db3VudFByb3BlcnR5LmxpbmsoIG5ldXRyb25Db3VudCA9PiB7XHJcbiAgICAgIGlmICggbmV1dHJvbkNvdW50ID49IDkgKSB7XHJcbiAgICAgICAgdGhpcy5uZXV0cm9uc0xldmVsUHJvcGVydHkudmFsdWUgPSBFbmVyZ3lMZXZlbFR5cGUuU0VDT05EO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBuZXV0cm9uQ291bnQgPj0gMyApIHtcclxuICAgICAgICB0aGlzLm5ldXRyb25zTGV2ZWxQcm9wZXJ0eS52YWx1ZSA9IEVuZXJneUxldmVsVHlwZS5GSVJTVDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB0aGlzLm5ldXRyb25zTGV2ZWxQcm9wZXJ0eS52YWx1ZSA9IEVuZXJneUxldmVsVHlwZS5OT05FO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gdXBkYXRlIG51Y2xlb24gcG9zaXRpb25zIHdoZW4gdGhlIGxldmVsIHN0YXRlIGNoYW5nZXNcclxuICAgIHRoaXMucHJvdG9uc0xldmVsUHJvcGVydHkubGluayggKCkgPT5cclxuICAgICAgdGhpcy51cGRhdGVOdWNsZW9uUG9zaXRpb25zKCB0aGlzLnByb3RvbnMsIHRoaXMucHJvdG9uU2hlbGxQb3NpdGlvbnMsIHRoaXMucHJvdG9uc0xldmVsUHJvcGVydHksIDAgKSApO1xyXG4gICAgdGhpcy5uZXV0cm9uc0xldmVsUHJvcGVydHkubGluayggKCkgPT5cclxuICAgICAgdGhpcy51cGRhdGVOdWNsZW9uUG9zaXRpb25zKCB0aGlzLm5ldXRyb25zLCB0aGlzLm5ldXRyb25TaGVsbFBvc2l0aW9ucywgdGhpcy5uZXV0cm9uc0xldmVsUHJvcGVydHksXHJcbiAgICAgICAgQkFOQ29uc3RhbnRzLlhfRElTVEFOQ0VfQkVUV0VFTl9FTkVSR1lfTEVWRUxTICkgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRMYXN0UGFydGljbGVJblNoZWxsKCBwYXJ0aWNsZVR5cGU6IFBhcnRpY2xlVHlwZSApOiBQYXJ0aWNsZSB8IHVuZGVmaW5lZCB7XHJcbiAgICBjb25zdCBudWNsZW9uU2hlbGxQb3NpdGlvbnMgPSBwYXJ0aWNsZVR5cGUgPT09IFBhcnRpY2xlVHlwZS5ORVVUUk9OID8gdGhpcy5uZXV0cm9uU2hlbGxQb3NpdGlvbnMgOiB0aGlzLnByb3RvblNoZWxsUG9zaXRpb25zO1xyXG4gICAgZm9yICggbGV0IGkgPSBudWNsZW9uU2hlbGxQb3NpdGlvbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0gKSB7XHJcbiAgICAgIGNvbnN0IG51Y2xlb25TaGVsbFJvdyA9IG51Y2xlb25TaGVsbFBvc2l0aW9uc1sgaSBdO1xyXG4gICAgICBmb3IgKCBsZXQgaiA9IG51Y2xlb25TaGVsbFJvdy5sZW5ndGggLSAxOyBqID49IDA7IGotLSApIHtcclxuICAgICAgICBpZiAoIG51Y2xlb25TaGVsbFJvd1sgaiBdLnBhcnRpY2xlICE9PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICByZXR1cm4gbnVjbGVvblNoZWxsUm93WyBqIF0ucGFydGljbGUhO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybiB0aGUgdmlldyBkZXN0aW5hdGlvbiBvZiB0aGUgbmV4dCBvcGVuIHBvc2l0aW9uIGZvciB0aGUgZ2l2ZW4gcGFydGljbGVUeXBlIHNoZWxsIHBvc2l0aW9ucy5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0UGFydGljbGVEZXN0aW5hdGlvbiggcGFydGljbGVUeXBlOiBQYXJ0aWNsZVR5cGUsIHBhcnRpY2xlOiBQYXJ0aWNsZSApOiBWZWN0b3IyIHtcclxuICAgIGNvbnN0IG51Y2xlb25TaGVsbFBvc2l0aW9ucyA9IHBhcnRpY2xlVHlwZSA9PT0gUGFydGljbGVUeXBlLk5FVVRST04gPyB0aGlzLm5ldXRyb25TaGVsbFBvc2l0aW9ucyA6IHRoaXMucHJvdG9uU2hlbGxQb3NpdGlvbnM7XHJcbiAgICBsZXQgeVBvc2l0aW9uID0gMDtcclxuXHJcbiAgICBjb25zdCBvcGVuTnVjbGVvblNoZWxsUG9zaXRpb25zID0gbnVjbGVvblNoZWxsUG9zaXRpb25zLm1hcCggcGFydGljbGVTaGVsbFJvdyA9PiB7XHJcblxyXG4gICAgICAvLyByZW1vdmUgYW55IGVtcHR5IHBhcnRpY2xlU2hlbGxQb3NpdGlvbidzIGZyb20gcGFydGljbGVTaGVsbFJvd1xyXG4gICAgICBjb25zdCBub0VtcHR5UG9zaXRpb25zID0gcGFydGljbGVTaGVsbFJvdy5maWx0ZXIoIHBhcnRpY2xlU2hlbGxQb3NpdGlvbiA9PiBwYXJ0aWNsZVNoZWxsUG9zaXRpb24gIT09IHVuZGVmaW5lZCApO1xyXG5cclxuICAgICAgLy8gZ2V0IHRoZSBmaXJzdCBvcGVuIHNoZWxsIHBvc2l0aW9uIGluIHRoaXMgcGFydGljbGVTaGVsbFJvd1xyXG4gICAgICByZXR1cm4gbm9FbXB0eVBvc2l0aW9ucy5maW5kKCBwYXJ0aWNsZVNoZWxsUG9zaXRpb24gPT4gcGFydGljbGVTaGVsbFBvc2l0aW9uLnBhcnRpY2xlID09PSB1bmRlZmluZWQgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBnZXQgdGhlIGZpcnN0IG9wZW4gc2hlbGwgcG9zaXRpb24gYXZhaWxhYmxlIGZyb20gYWxsIHJvd3NcclxuICAgIGNvbnN0IG9wZW5QYXJ0aWNsZVNoZWxsUG9zaXRpb24gPSBvcGVuTnVjbGVvblNoZWxsUG9zaXRpb25zLmZpbmQoICggcGFydGljbGVTaGVsbFBvc2l0aW9uLCBpbmRleCApID0+IHtcclxuICAgICAgeVBvc2l0aW9uID0gaW5kZXg7XHJcbiAgICAgIHJldHVybiBwYXJ0aWNsZVNoZWxsUG9zaXRpb24gIT09IHVuZGVmaW5lZDtcclxuICAgIH0gKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcGVuUGFydGljbGVTaGVsbFBvc2l0aW9uICE9PSB1bmRlZmluZWQsICdUbyBhZGQgYSBwYXJ0aWNsZSB0aGVyZSBtdXN0IGJlIGFuIGVtcHR5IHBhcnRpY2xlU2hlbGxQb3NpdGlvbi4nICk7XHJcblxyXG4gICAgb3BlblBhcnRpY2xlU2hlbGxQb3NpdGlvbiEucGFydGljbGUgPSBwYXJ0aWNsZTtcclxuICAgIC8vIEB0cy1leHBlY3QtZXJyb3Igb3BlblBhcnRpY2xlU2hlbGxQb3NpdGlvbiBzaG91bGQgbmV2ZXIgYmUgdW5kZWZpbmVkXHJcbiAgICBjb25zdCB2aWV3RGVzdGluYXRpb24gPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1hZKCBvcGVuUGFydGljbGVTaGVsbFBvc2l0aW9uLnhQb3NpdGlvbiwgeVBvc2l0aW9uICk7XHJcblxyXG4gICAgLy8gYWRkIHggb2Zmc2V0IGZvciBuZXV0cm9uIHBhcnRpY2xlIHRvIGJlIGFsaWduZWQgd2l0aCBpdHMgZW5lcmd5IGxldmVsIHBvc2l0aW9uXHJcbiAgICB2aWV3RGVzdGluYXRpb24uYWRkWFkoIHBhcnRpY2xlVHlwZSA9PT0gUGFydGljbGVUeXBlLk5FVVRST04gPyBCQU5Db25zdGFudHMuWF9ESVNUQU5DRV9CRVRXRUVOX0VORVJHWV9MRVZFTFMgOiAwLCAwICk7XHJcbiAgICByZXR1cm4gdmlld0Rlc3RpbmF0aW9uO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIHJlY29uZmlndXJlTnVjbGV1cygpOiB2b2lkIHtcclxuICAgIHRoaXMudXBkYXRlTnVjbGVvblBvc2l0aW9ucyggdGhpcy5wcm90b25zLCB0aGlzLnByb3RvblNoZWxsUG9zaXRpb25zLCB0aGlzLnByb3RvbnNMZXZlbFByb3BlcnR5LCAwICk7XHJcbiAgICB0aGlzLnVwZGF0ZU51Y2xlb25Qb3NpdGlvbnMoIHRoaXMubmV1dHJvbnMsIHRoaXMubmV1dHJvblNoZWxsUG9zaXRpb25zLCB0aGlzLm5ldXRyb25zTGV2ZWxQcm9wZXJ0eSxcclxuICAgICAgQkFOQ29uc3RhbnRzLlhfRElTVEFOQ0VfQkVUV0VFTl9FTkVSR1lfTEVWRUxTICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgcmVtb3ZlUGFydGljbGUoIHBhcnRpY2xlOiBQYXJ0aWNsZSApOiB2b2lkIHtcclxuICAgIGNvbnN0IG51Y2xlb25TaGVsbFBvc2l0aW9ucyA9IHBhcnRpY2xlLnR5cGUgPT09IFBhcnRpY2xlVHlwZS5QUk9UT04ubmFtZS50b0xvd2VyQ2FzZSgpID8gdGhpcy5wcm90b25TaGVsbFBvc2l0aW9ucyA6IHRoaXMubmV1dHJvblNoZWxsUG9zaXRpb25zO1xyXG4gICAgbnVjbGVvblNoZWxsUG9zaXRpb25zLmZvckVhY2goIG51Y2xlb25TaGVsbFJvdyA9PiB7XHJcbiAgICAgIG51Y2xlb25TaGVsbFJvdy5mb3JFYWNoKCBudWNsZW9uU2hlbGxQb3NpdGlvbiA9PiB7XHJcbiAgICAgICAgaWYgKCBudWNsZW9uU2hlbGxQb3NpdGlvbi5wYXJ0aWNsZSA9PT0gcGFydGljbGUgKSB7XHJcbiAgICAgICAgICBudWNsZW9uU2hlbGxQb3NpdGlvbi5wYXJ0aWNsZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICBzdXBlci5yZW1vdmVQYXJ0aWNsZSggcGFydGljbGUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZpbGwgYWxsIG51Y2xlb25zIGluIG9wZW4gcG9zaXRpb25zIGZyb20gYm90dG9tIHRvIHRvcCwgbGVmdCB0byByaWdodFxyXG4gICAqL1xyXG4gIHByaXZhdGUgdXBkYXRlTnVjbGVvblBvc2l0aW9ucyggcGFydGljbGVBcnJheTogT2JzZXJ2YWJsZUFycmF5PFBhcnRpY2xlPiwgcGFydGljbGVTaGVsbFBvc2l0aW9uczogUGFydGljbGVTaGVsbFBvc2l0aW9uW11bXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXZlbEZpbGxQcm9wZXJ0eTogRW51bWVyYXRpb25Qcm9wZXJ0eTxFbmVyZ3lMZXZlbFR5cGU+LCB4T2Zmc2V0OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICBjb25zdCBsZXZlbFdpZHRoID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCBBTExPV0VEX1BBUlRJQ0xFX1BPU0lUSU9OU1sgMSBdWyA1IF0gKSAtXHJcbiAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCBBTExPV0VEX1BBUlRJQ0xFX1BPU0lUSU9OU1sgMSBdWyAwIF0gKTtcclxuICAgIHBhcnRpY2xlQXJyYXkuZm9yRWFjaCggKCBwYXJ0aWNsZSwgaW5kZXggKSA9PiB7XHJcbiAgICAgIGNvbnN0IHlQb3NpdGlvbiA9IGluZGV4IDwgMiA/IDAgOiBpbmRleCA8IDggPyAxIDogMjtcclxuICAgICAgY29uc3QgeFBvc2l0aW9uID0geVBvc2l0aW9uID09PSAwID8gaW5kZXggKyAyIDogeVBvc2l0aW9uID09PSAxID8gaW5kZXggLSAyIDogaW5kZXggLSA4O1xyXG5cclxuICAgICAgLy8gbGFzdCBsZXZlbCAoeVBvc2l0aW9uID09PSAyKSBuZXZlciBib3VuZCBzbyBkb24ndCBuZWVkIGxldmVsSW5kZXggY29uZGl0aW9uIGZvciBpdFxyXG4gICAgICBjb25zdCBsZXZlbEluZGV4ID0geVBvc2l0aW9uID09PSAwID8gaW5kZXggOiBpbmRleCAtIDI7XHJcbiAgICAgIGNvbnN0IG51Y2xlb25TaGVsbFBvc2l0aW9uID0gcGFydGljbGVTaGVsbFBvc2l0aW9uc1sgeVBvc2l0aW9uIF1bIHhQb3NpdGlvbiBdO1xyXG4gICAgICBjb25zdCB1bkJvdW5kWFBvc2l0aW9uID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCBudWNsZW9uU2hlbGxQb3NpdGlvbi54UG9zaXRpb24gKSArIHhPZmZzZXQ7XHJcblxyXG4gICAgICBudWNsZW9uU2hlbGxQb3NpdGlvbi5wYXJ0aWNsZSA9IHBhcnRpY2xlO1xyXG5cclxuICAgICAgbGV0IHZpZXdEZXN0aW5hdGlvbjtcclxuICAgICAgbGV0IGlucHV0RW5hYmxlZDtcclxuXHJcbiAgICAgIC8vIGlmIHRoZSB5UG9zaXRpb24gb2YgdGhlIGxldmVsRmlsbFByb3BlcnR5IGlzIGhpZ2hlciB0aGFuIHRoZSBjdXJyZW50IHlQb3NpdGlvbiBsZXZlbCwgJ2JpbmQnIHRoZSBwYXJ0aWNsZXMgaW5cclxuICAgICAgLy8gdGhpcyBsZXZlbCBieSByZW1vdmluZyB0aGUgc3BhY2VzIGJldHdlZW4gdGhlbVxyXG4gICAgICBpZiAoIHlQb3NpdGlvbiA8IGxldmVsRmlsbFByb3BlcnR5LnZhbHVlLnlQb3NpdGlvbiApIHtcclxuXHJcbiAgICAgICAgLy8gZWFjaCBwYXJ0aWNsZSBvbiB0aGUgbGV2ZWwgaGFzIG9uZSAncGFydGljbGUgcmFkaXVzJyBzcGFjZSBleGNlcHQgZm9yIG9uZS5cclxuICAgICAgICAvLyB0aGVyZSBhcmUgMiBwYXJ0aWNsZXMgb24gdGhlIHkgPSAwIGxldmVsIGFuZCA2IHBhcnRpY2xlcyBvbiB0aGUgeSA9IDEgbGV2ZWwuXHJcbiAgICAgICAgY29uc3QgbnVtYmVyT2ZSYWRpdXNTcGFjZXMgPSB5UG9zaXRpb24gPT09IDAgPyAyIC0gMSA6IDYgLSAxO1xyXG5cclxuICAgICAgICAvLyBhbW91bnQgZWFjaCBwYXJ0aWNsZSBtb3ZlcyBzbyB0aGUgc3BhY2UgYmV0d2VlbiBpdCBhbmQgdGhlIHBhcnRpY2xlIG9uIGl0cyBsZWZ0IGlzIHJlbW92ZWRcclxuICAgICAgICBjb25zdCBib3VuZE9mZnNldCA9IGxldmVsV2lkdGggKiAoIGxldmVsSW5kZXggLyAoIDMgKiA1ICkgKTsgLy8gMyByYWRpdXMgc3BhY2VzIC8gcGFydGljbGUgKiA1IHBhcnRpY2xlIHNwYWNlc1xyXG5cclxuICAgICAgICAvLyBhbW91bnQgZWFjaCBwYXJ0aWNsZSBoYXMgdG8gbW92ZSBmb3IgYWxsIHBhcnRpY2xlcyB0byBiZSBjZW50ZXJlZCBpbiBtaWRkbGUgb2YgZW5lcmd5IGxldmVsXHJcbiAgICAgICAgY29uc3QgY2VudGVyT2Zmc2V0ID0gQkFOQ29uc3RhbnRzLlBBUlRJQ0xFX1JBRElVUyAqIG51bWJlck9mUmFkaXVzU3BhY2VzIC8gMjtcclxuXHJcbiAgICAgICAgY29uc3QgZGVzdGluYXRpb25YID0gdW5Cb3VuZFhQb3NpdGlvbiAtIGJvdW5kT2Zmc2V0ICsgY2VudGVyT2Zmc2V0O1xyXG5cclxuICAgICAgICB2aWV3RGVzdGluYXRpb24gPSBuZXcgVmVjdG9yMiggZGVzdGluYXRpb25YLCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1koIHlQb3NpdGlvbiApICk7XHJcbiAgICAgICAgaW5wdXRFbmFibGVkID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdmlld0Rlc3RpbmF0aW9uID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYWSggbnVjbGVvblNoZWxsUG9zaXRpb24ueFBvc2l0aW9uLCB5UG9zaXRpb24gKTtcclxuICAgICAgICB2aWV3RGVzdGluYXRpb24uYWRkWFkoIHhPZmZzZXQsIDAgKTtcclxuICAgICAgICBpbnB1dEVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBhZGQgeCBvZmZzZXQgc28gbmV1dHJvbiBwYXJ0aWNsZXMgYXJlIGFsaWduZWQgd2l0aCB0aGVpciBlbmVyZ3kgbGV2ZWxzXHJcbiAgICAgIHBhcnRpY2xlLmRlc3RpbmF0aW9uUHJvcGVydHkuc2V0KCB2aWV3RGVzdGluYXRpb24gKTtcclxuICAgICAgcGFydGljbGUuaW5wdXRFbmFibGVkUHJvcGVydHkudmFsdWUgPSBpbnB1dEVuYWJsZWQ7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5idWlsZEFOdWNsZXVzLnJlZ2lzdGVyKCAnUGFydGljbGVOdWNsZXVzJywgUGFydGljbGVOdWNsZXVzICk7XHJcbmV4cG9ydCBkZWZhdWx0IFBhcnRpY2xlTnVjbGV1cztcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFHQSxPQUFPQSxtQkFBbUIsTUFBTSw0Q0FBNEM7QUFDNUUsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUduRCxPQUFPQyxZQUFZLE1BQU0sNENBQTRDO0FBQ3JFLE9BQU9DLGFBQWEsTUFBTSx3QkFBd0I7QUFDbEQsT0FBT0MsWUFBWSxNQUFNLDhCQUE4QjtBQUN2RCxPQUFPQyxZQUFZLE1BQU0sbUNBQW1DO0FBQzVELE9BQU9DLGVBQWUsTUFBTSxzQkFBc0I7O0FBRWxEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQVFBO0FBRUE7QUFDQSxNQUFNQywwQkFBMEIsR0FBRyxDQUNqQyxDQUFFLENBQUMsRUFBRSxDQUFDLENBQUUsRUFDUixDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFFLEVBQ3BCLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUUsQ0FD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