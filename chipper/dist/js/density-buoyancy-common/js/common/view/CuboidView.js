// Copyright 2019-2022, University of Colorado Boulder

/**
 * The 3D view for a Cuboid.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Vector3 from '../../../../dot/js/Vector3.js';
import TriangleArrayWriter from '../../../../mobius/js/TriangleArrayWriter.js';
import densityBuoyancyCommon from '../../densityBuoyancyCommon.js';
import MassView, { TAG_OFFSET } from './MassView.js';
// constants
const numElements = 18 * 3;
export default class CuboidView extends MassView {
  constructor(cuboid) {
    const size = cuboid.sizeProperty.value;
    const positionArray = new Float32Array(numElements * 3);
    const normalArray = new Float32Array(numElements * 3);
    const uvArray = new Float32Array(numElements * 2);
    CuboidView.updateArrays(positionArray, normalArray, uvArray, size);
    const cuboidGeometry = new THREE.BufferGeometry();
    cuboidGeometry.addAttribute('position', new THREE.BufferAttribute(positionArray, 3));
    cuboidGeometry.addAttribute('normal', new THREE.BufferAttribute(normalArray, 3));
    cuboidGeometry.addAttribute('uv', new THREE.BufferAttribute(uvArray, 2));
    super(cuboid, cuboidGeometry);
    this.cuboid = cuboid;
    this.cuboidGeometry = cuboidGeometry;
    const positionTag = () => {
      const size = cuboid.sizeProperty.value;
      this.tagOffsetProperty.value = new Vector3(size.minX + TAG_OFFSET, size.maxY - this.tagHeight - TAG_OFFSET, size.maxZ);
    };
    positionTag();
    this.updateListener = size => {
      positionTag();
      CuboidView.updateArrays(cuboidGeometry.attributes.position.array, null, cuboidGeometry.attributes.uv.array, size);
      cuboidGeometry.attributes.position.needsUpdate = true;
      cuboidGeometry.attributes.uv.needsUpdate = true;
      cuboidGeometry.computeBoundingSphere();
    };
    this.cuboid.sizeProperty.lazyLink(this.updateListener);
  }

  /**
   * Releases references.
   */
  dispose() {
    this.cuboid.sizeProperty.unlink(this.updateListener);
    this.cuboidGeometry.dispose();
    super.dispose();
  }

  /**
   * Updates provided geometry arrays given the specific size.
   *
   * @param positionArray
   * @param normalArray
   * @param uvArray
   * @param size
   * @param offset - How many vertices have been specified so far?
   * @param offsetPosition - How to transform all of the points
   * @returns - The offset after the specified vertices have been written
   */
  static updateArrays(positionArray, normalArray, uvArray, size, offset = 0, offsetPosition = Vector3.ZERO) {
    const writer = new TriangleArrayWriter(positionArray, normalArray, uvArray, offset, offsetPosition);
    function quad(p0x, p0y, p0z, p1x, p1y, p1z, p2x, p2y, p2z, p3x, p3y, p3z) {
      writer.position(p0x, p0y, p0z);
      writer.position(p1x, p1y, p1z);
      writer.position(p2x, p2y, p2z);
      writer.position(p0x, p0y, p0z);
      writer.position(p2x, p2y, p2z);
      writer.position(p3x, p3y, p3z);
      const du = 2.5 * (Math.abs(p1x - p0x) + Math.abs(p1y - p0y) + Math.abs(p1z - p0z));
      const dv = 2.5 * (Math.abs(p1x - p2x) + Math.abs(p1y - p2y) + Math.abs(p1z - p2z));
      const uMin = 0.5 - du;
      const uMax = 0.5 + du;
      const vMin = 0.5 - dv;
      const vMax = 0.5 + dv;
      writer.uv(uMax, vMin);
      writer.uv(uMin, vMin);
      writer.uv(uMin, vMax);
      writer.uv(uMax, vMin);
      writer.uv(uMin, vMax);
      writer.uv(uMax, vMax);
    }

    // Bottom
    quad(size.minX, size.minY, size.minZ, size.maxX, size.minY, size.minZ, size.maxX, size.minY, size.maxZ, size.minX, size.minY, size.maxZ);
    for (let i = 0; i < 6; i++) {
      writer.normal(0, -1, 0);
    }

    // Top
    quad(size.minX, size.maxY, size.minZ, size.minX, size.maxY, size.maxZ, size.maxX, size.maxY, size.maxZ, size.maxX, size.maxY, size.minZ);
    for (let i = 0; i < 6; i++) {
      writer.normal(0, 1, 0);
    }

    // Left
    quad(size.minX, size.minY, size.minZ, size.minX, size.minY, size.maxZ, size.minX, size.maxY, size.maxZ, size.minX, size.maxY, size.minZ);
    for (let i = 0; i < 6; i++) {
      writer.normal(-1, 0, 0);
    }

    // Right
    quad(size.maxX, size.minY, size.minZ, size.maxX, size.maxY, size.minZ, size.maxX, size.maxY, size.maxZ, size.maxX, size.minY, size.maxZ);
    for (let i = 0; i < 6; i++) {
      writer.normal(1, 0, 0);
    }

    // Back
    quad(size.minX, size.minY, size.minZ, size.minX, size.maxY, size.minZ, size.maxX, size.maxY, size.minZ, size.maxX, size.minY, size.minZ);
    for (let i = 0; i < 6; i++) {
      writer.normal(0, 0, -1);
    }

    // Front
    quad(size.minX, size.minY, size.maxZ, size.maxX, size.minY, size.maxZ, size.maxX, size.maxY, size.maxZ, size.minX, size.maxY, size.maxZ);
    for (let i = 0; i < 6; i++) {
      writer.normal(0, 0, 1);
    }
    return writer.getOffset();
  }
}
densityBuoyancyCommon.register('CuboidView', CuboidView);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IzIiwiVHJpYW5nbGVBcnJheVdyaXRlciIsImRlbnNpdHlCdW95YW5jeUNvbW1vbiIsIk1hc3NWaWV3IiwiVEFHX09GRlNFVCIsIm51bUVsZW1lbnRzIiwiQ3Vib2lkVmlldyIsImNvbnN0cnVjdG9yIiwiY3Vib2lkIiwic2l6ZSIsInNpemVQcm9wZXJ0eSIsInZhbHVlIiwicG9zaXRpb25BcnJheSIsIkZsb2F0MzJBcnJheSIsIm5vcm1hbEFycmF5IiwidXZBcnJheSIsInVwZGF0ZUFycmF5cyIsImN1Ym9pZEdlb21ldHJ5IiwiVEhSRUUiLCJCdWZmZXJHZW9tZXRyeSIsImFkZEF0dHJpYnV0ZSIsIkJ1ZmZlckF0dHJpYnV0ZSIsInBvc2l0aW9uVGFnIiwidGFnT2Zmc2V0UHJvcGVydHkiLCJtaW5YIiwibWF4WSIsInRhZ0hlaWdodCIsIm1heFoiLCJ1cGRhdGVMaXN0ZW5lciIsImF0dHJpYnV0ZXMiLCJwb3NpdGlvbiIsImFycmF5IiwidXYiLCJuZWVkc1VwZGF0ZSIsImNvbXB1dGVCb3VuZGluZ1NwaGVyZSIsImxhenlMaW5rIiwiZGlzcG9zZSIsInVubGluayIsIm9mZnNldCIsIm9mZnNldFBvc2l0aW9uIiwiWkVSTyIsIndyaXRlciIsInF1YWQiLCJwMHgiLCJwMHkiLCJwMHoiLCJwMXgiLCJwMXkiLCJwMXoiLCJwMngiLCJwMnkiLCJwMnoiLCJwM3giLCJwM3kiLCJwM3oiLCJkdSIsIk1hdGgiLCJhYnMiLCJkdiIsInVNaW4iLCJ1TWF4Iiwidk1pbiIsInZNYXgiLCJtaW5ZIiwibWluWiIsIm1heFgiLCJpIiwibm9ybWFsIiwiZ2V0T2Zmc2V0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJDdWJvaWRWaWV3LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFRoZSAzRCB2aWV3IGZvciBhIEN1Ym9pZC5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBWZWN0b3IzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IzLmpzJztcclxuaW1wb3J0IFRyaWFuZ2xlQXJyYXlXcml0ZXIgZnJvbSAnLi4vLi4vLi4vLi4vbW9iaXVzL2pzL1RyaWFuZ2xlQXJyYXlXcml0ZXIuanMnO1xyXG5pbXBvcnQgZGVuc2l0eUJ1b3lhbmN5Q29tbW9uIGZyb20gJy4uLy4uL2RlbnNpdHlCdW95YW5jeUNvbW1vbi5qcyc7XHJcbmltcG9ydCBNYXNzVmlldywgeyBUQUdfT0ZGU0VUIH0gZnJvbSAnLi9NYXNzVmlldy5qcyc7XHJcbmltcG9ydCBDdWJvaWQgZnJvbSAnLi4vbW9kZWwvQ3Vib2lkLmpzJztcclxuaW1wb3J0IEJvdW5kczMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0JvdW5kczMuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IG51bUVsZW1lbnRzID0gMTggKiAzO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ3Vib2lkVmlldyBleHRlbmRzIE1hc3NWaWV3IHtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IGN1Ym9pZDogQ3Vib2lkO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY3Vib2lkR2VvbWV0cnk6IFRIUkVFLkJ1ZmZlckdlb21ldHJ5O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdXBkYXRlTGlzdGVuZXI6ICggc2l6ZTogQm91bmRzMyApID0+IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggY3Vib2lkOiBDdWJvaWQgKSB7XHJcbiAgICBjb25zdCBzaXplID0gY3Vib2lkLnNpemVQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICBjb25zdCBwb3NpdGlvbkFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggbnVtRWxlbWVudHMgKiAzICk7XHJcbiAgICBjb25zdCBub3JtYWxBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIG51bUVsZW1lbnRzICogMyApO1xyXG4gICAgY29uc3QgdXZBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIG51bUVsZW1lbnRzICogMiApO1xyXG5cclxuICAgIEN1Ym9pZFZpZXcudXBkYXRlQXJyYXlzKCBwb3NpdGlvbkFycmF5LCBub3JtYWxBcnJheSwgdXZBcnJheSwgc2l6ZSApO1xyXG5cclxuICAgIGNvbnN0IGN1Ym9pZEdlb21ldHJ5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCk7XHJcbiAgICBjdWJvaWRHZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXJyYXksIDMgKSApO1xyXG4gICAgY3Vib2lkR2VvbWV0cnkuYWRkQXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFsQXJyYXksIDMgKSApO1xyXG4gICAgY3Vib2lkR2VvbWV0cnkuYWRkQXR0cmlidXRlKCAndXYnLCBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKCB1dkFycmF5LCAyICkgKTtcclxuXHJcbiAgICBzdXBlciggY3Vib2lkLCBjdWJvaWRHZW9tZXRyeSApO1xyXG5cclxuICAgIHRoaXMuY3Vib2lkID0gY3Vib2lkO1xyXG4gICAgdGhpcy5jdWJvaWRHZW9tZXRyeSA9IGN1Ym9pZEdlb21ldHJ5O1xyXG5cclxuICAgIGNvbnN0IHBvc2l0aW9uVGFnID0gKCkgPT4ge1xyXG4gICAgICBjb25zdCBzaXplID0gY3Vib2lkLnNpemVQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgdGhpcy50YWdPZmZzZXRQcm9wZXJ0eS52YWx1ZSA9IG5ldyBWZWN0b3IzKCBzaXplLm1pblggKyBUQUdfT0ZGU0VULCBzaXplLm1heFkgLSB0aGlzLnRhZ0hlaWdodCEgLSBUQUdfT0ZGU0VULCBzaXplLm1heFogKTtcclxuICAgIH07XHJcbiAgICBwb3NpdGlvblRhZygpO1xyXG5cclxuICAgIHRoaXMudXBkYXRlTGlzdGVuZXIgPSAoIHNpemU6IEJvdW5kczMgKSA9PiB7XHJcbiAgICAgIHBvc2l0aW9uVGFnKCk7XHJcbiAgICAgIEN1Ym9pZFZpZXcudXBkYXRlQXJyYXlzKCBjdWJvaWRHZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmFycmF5IGFzIEZsb2F0MzJBcnJheSwgbnVsbCwgY3Vib2lkR2VvbWV0cnkuYXR0cmlidXRlcy51di5hcnJheSBhcyBGbG9hdDMyQXJyYXksIHNpemUgKTtcclxuICAgICAgY3Vib2lkR2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbi5uZWVkc1VwZGF0ZSA9IHRydWU7XHJcbiAgICAgIGN1Ym9pZEdlb21ldHJ5LmF0dHJpYnV0ZXMudXYubmVlZHNVcGRhdGUgPSB0cnVlO1xyXG4gICAgICBjdWJvaWRHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTtcclxuICAgIH07XHJcbiAgICB0aGlzLmN1Ym9pZC5zaXplUHJvcGVydHkubGF6eUxpbmsoIHRoaXMudXBkYXRlTGlzdGVuZXIgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbGVhc2VzIHJlZmVyZW5jZXMuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLmN1Ym9pZC5zaXplUHJvcGVydHkudW5saW5rKCB0aGlzLnVwZGF0ZUxpc3RlbmVyICk7XHJcblxyXG4gICAgdGhpcy5jdWJvaWRHZW9tZXRyeS5kaXNwb3NlKCk7XHJcblxyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlcyBwcm92aWRlZCBnZW9tZXRyeSBhcnJheXMgZ2l2ZW4gdGhlIHNwZWNpZmljIHNpemUuXHJcbiAgICpcclxuICAgKiBAcGFyYW0gcG9zaXRpb25BcnJheVxyXG4gICAqIEBwYXJhbSBub3JtYWxBcnJheVxyXG4gICAqIEBwYXJhbSB1dkFycmF5XHJcbiAgICogQHBhcmFtIHNpemVcclxuICAgKiBAcGFyYW0gb2Zmc2V0IC0gSG93IG1hbnkgdmVydGljZXMgaGF2ZSBiZWVuIHNwZWNpZmllZCBzbyBmYXI/XHJcbiAgICogQHBhcmFtIG9mZnNldFBvc2l0aW9uIC0gSG93IHRvIHRyYW5zZm9ybSBhbGwgb2YgdGhlIHBvaW50c1xyXG4gICAqIEByZXR1cm5zIC0gVGhlIG9mZnNldCBhZnRlciB0aGUgc3BlY2lmaWVkIHZlcnRpY2VzIGhhdmUgYmVlbiB3cml0dGVuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyB1cGRhdGVBcnJheXMoIHBvc2l0aW9uQXJyYXk6IEZsb2F0MzJBcnJheSB8IG51bGwsIG5vcm1hbEFycmF5OiBGbG9hdDMyQXJyYXkgfCBudWxsLCB1dkFycmF5OiBGbG9hdDMyQXJyYXkgfCBudWxsLCBzaXplOiBCb3VuZHMzLCBvZmZzZXQgPSAwLCBvZmZzZXRQb3NpdGlvbjogVmVjdG9yMyA9IFZlY3RvcjMuWkVSTyApOiBudW1iZXIge1xyXG4gICAgY29uc3Qgd3JpdGVyID0gbmV3IFRyaWFuZ2xlQXJyYXlXcml0ZXIoIHBvc2l0aW9uQXJyYXksIG5vcm1hbEFycmF5LCB1dkFycmF5LCBvZmZzZXQsIG9mZnNldFBvc2l0aW9uICk7XHJcblxyXG4gICAgZnVuY3Rpb24gcXVhZCggcDB4OiBudW1iZXIsIHAweTogbnVtYmVyLCBwMHo6IG51bWJlciwgcDF4OiBudW1iZXIsIHAxeTogbnVtYmVyLCBwMXo6IG51bWJlciwgcDJ4OiBudW1iZXIsIHAyeTogbnVtYmVyLCBwMno6IG51bWJlciwgcDN4OiBudW1iZXIsIHAzeTogbnVtYmVyLCBwM3o6IG51bWJlciApOiB2b2lkIHtcclxuICAgICAgd3JpdGVyLnBvc2l0aW9uKCBwMHgsIHAweSwgcDB6ICk7XHJcbiAgICAgIHdyaXRlci5wb3NpdGlvbiggcDF4LCBwMXksIHAxeiApO1xyXG4gICAgICB3cml0ZXIucG9zaXRpb24oIHAyeCwgcDJ5LCBwMnogKTtcclxuXHJcbiAgICAgIHdyaXRlci5wb3NpdGlvbiggcDB4LCBwMHksIHAweiApO1xyXG4gICAgICB3cml0ZXIucG9zaXRpb24oIHAyeCwgcDJ5LCBwMnogKTtcclxuICAgICAgd3JpdGVyLnBvc2l0aW9uKCBwM3gsIHAzeSwgcDN6ICk7XHJcblxyXG4gICAgICBjb25zdCBkdSA9IDIuNSAqICggTWF0aC5hYnMoIHAxeCAtIHAweCApICsgTWF0aC5hYnMoIHAxeSAtIHAweSApICsgTWF0aC5hYnMoIHAxeiAtIHAweiApICk7XHJcbiAgICAgIGNvbnN0IGR2ID0gMi41ICogKCBNYXRoLmFicyggcDF4IC0gcDJ4ICkgKyBNYXRoLmFicyggcDF5IC0gcDJ5ICkgKyBNYXRoLmFicyggcDF6IC0gcDJ6ICkgKTtcclxuICAgICAgY29uc3QgdU1pbiA9IDAuNSAtIGR1O1xyXG4gICAgICBjb25zdCB1TWF4ID0gMC41ICsgZHU7XHJcbiAgICAgIGNvbnN0IHZNaW4gPSAwLjUgLSBkdjtcclxuICAgICAgY29uc3Qgdk1heCA9IDAuNSArIGR2O1xyXG5cclxuICAgICAgd3JpdGVyLnV2KCB1TWF4LCB2TWluICk7XHJcbiAgICAgIHdyaXRlci51diggdU1pbiwgdk1pbiApO1xyXG4gICAgICB3cml0ZXIudXYoIHVNaW4sIHZNYXggKTtcclxuXHJcbiAgICAgIHdyaXRlci51diggdU1heCwgdk1pbiApO1xyXG4gICAgICB3cml0ZXIudXYoIHVNaW4sIHZNYXggKTtcclxuICAgICAgd3JpdGVyLnV2KCB1TWF4LCB2TWF4ICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQm90dG9tXHJcbiAgICBxdWFkKFxyXG4gICAgICBzaXplLm1pblgsIHNpemUubWluWSwgc2l6ZS5taW5aLFxyXG4gICAgICBzaXplLm1heFgsIHNpemUubWluWSwgc2l6ZS5taW5aLFxyXG4gICAgICBzaXplLm1heFgsIHNpemUubWluWSwgc2l6ZS5tYXhaLFxyXG4gICAgICBzaXplLm1pblgsIHNpemUubWluWSwgc2l6ZS5tYXhaXHJcbiAgICApO1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSsrICkgeyB3cml0ZXIubm9ybWFsKCAwLCAtMSwgMCApOyB9XHJcblxyXG4gICAgLy8gVG9wXHJcbiAgICBxdWFkKFxyXG4gICAgICBzaXplLm1pblgsIHNpemUubWF4WSwgc2l6ZS5taW5aLFxyXG4gICAgICBzaXplLm1pblgsIHNpemUubWF4WSwgc2l6ZS5tYXhaLFxyXG4gICAgICBzaXplLm1heFgsIHNpemUubWF4WSwgc2l6ZS5tYXhaLFxyXG4gICAgICBzaXplLm1heFgsIHNpemUubWF4WSwgc2l6ZS5taW5aXHJcbiAgICApO1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSsrICkgeyB3cml0ZXIubm9ybWFsKCAwLCAxLCAwICk7IH1cclxuXHJcbiAgICAvLyBMZWZ0XHJcbiAgICBxdWFkKFxyXG4gICAgICBzaXplLm1pblgsIHNpemUubWluWSwgc2l6ZS5taW5aLFxyXG4gICAgICBzaXplLm1pblgsIHNpemUubWluWSwgc2l6ZS5tYXhaLFxyXG4gICAgICBzaXplLm1pblgsIHNpemUubWF4WSwgc2l6ZS5tYXhaLFxyXG4gICAgICBzaXplLm1pblgsIHNpemUubWF4WSwgc2l6ZS5taW5aXHJcbiAgICApO1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSsrICkgeyB3cml0ZXIubm9ybWFsKCAtMSwgMCwgMCApOyB9XHJcblxyXG4gICAgLy8gUmlnaHRcclxuICAgIHF1YWQoXHJcbiAgICAgIHNpemUubWF4WCwgc2l6ZS5taW5ZLCBzaXplLm1pblosXHJcbiAgICAgIHNpemUubWF4WCwgc2l6ZS5tYXhZLCBzaXplLm1pblosXHJcbiAgICAgIHNpemUubWF4WCwgc2l6ZS5tYXhZLCBzaXplLm1heFosXHJcbiAgICAgIHNpemUubWF4WCwgc2l6ZS5taW5ZLCBzaXplLm1heFpcclxuICAgICk7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpKysgKSB7IHdyaXRlci5ub3JtYWwoIDEsIDAsIDAgKTsgfVxyXG5cclxuICAgIC8vIEJhY2tcclxuICAgIHF1YWQoXHJcbiAgICAgIHNpemUubWluWCwgc2l6ZS5taW5ZLCBzaXplLm1pblosXHJcbiAgICAgIHNpemUubWluWCwgc2l6ZS5tYXhZLCBzaXplLm1pblosXHJcbiAgICAgIHNpemUubWF4WCwgc2l6ZS5tYXhZLCBzaXplLm1pblosXHJcbiAgICAgIHNpemUubWF4WCwgc2l6ZS5taW5ZLCBzaXplLm1pblpcclxuICAgICk7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpKysgKSB7IHdyaXRlci5ub3JtYWwoIDAsIDAsIC0xICk7IH1cclxuXHJcbiAgICAvLyBGcm9udFxyXG4gICAgcXVhZChcclxuICAgICAgc2l6ZS5taW5YLCBzaXplLm1pblksIHNpemUubWF4WixcclxuICAgICAgc2l6ZS5tYXhYLCBzaXplLm1pblksIHNpemUubWF4WixcclxuICAgICAgc2l6ZS5tYXhYLCBzaXplLm1heFksIHNpemUubWF4WixcclxuICAgICAgc2l6ZS5taW5YLCBzaXplLm1heFksIHNpemUubWF4WlxyXG4gICAgKTtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkrKyApIHsgd3JpdGVyLm5vcm1hbCggMCwgMCwgMSApOyB9XHJcblxyXG4gICAgcmV0dXJuIHdyaXRlci5nZXRPZmZzZXQoKTtcclxuICB9XHJcbn1cclxuXHJcbmRlbnNpdHlCdW95YW5jeUNvbW1vbi5yZWdpc3RlciggJ0N1Ym9pZFZpZXcnLCBDdWJvaWRWaWV3ICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLG1CQUFtQixNQUFNLDhDQUE4QztBQUM5RSxPQUFPQyxxQkFBcUIsTUFBTSxnQ0FBZ0M7QUFDbEUsT0FBT0MsUUFBUSxJQUFJQyxVQUFVLFFBQVEsZUFBZTtBQUlwRDtBQUNBLE1BQU1DLFdBQVcsR0FBRyxFQUFFLEdBQUcsQ0FBQztBQUUxQixlQUFlLE1BQU1DLFVBQVUsU0FBU0gsUUFBUSxDQUFDO0VBTXhDSSxXQUFXQSxD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