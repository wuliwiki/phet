// Copyright 2019-2022, University of Colorado Boulder

/**
 * Provides factory methods for creating MaterialViews for various Materials.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Utils from '../../../../dot/js/Utils.js';
import Vector3 from '../../../../dot/js/Vector3.js';
import ThreeUtils from '../../../../mobius/js/ThreeUtils.js';
import Bricks25_AO_jpg from '../../../images/Bricks25_AO_jpg.js';
import Bricks25_col_jpg from '../../../images/Bricks25_col_jpg.js';
import Bricks25_nrm_jpg from '../../../images/Bricks25_nrm_jpg.js';
import DiamondPlate01_col_jpg from '../../../images/DiamondPlate01_col_jpg.js';
import DiamondPlate01_met_jpg from '../../../images/DiamondPlate01_met_jpg.js';
import DiamondPlate01_nrm_jpg from '../../../images/DiamondPlate01_nrm_jpg.js';
import DiamondPlate01_rgh_jpg from '../../../images/DiamondPlate01_rgh_jpg.js';
import Ice01_alpha_jpg from '../../../images/Ice01_alpha_jpg.js';
import Ice01_col_jpg from '../../../images/Ice01_col_jpg.js';
import Ice01_nrm_jpg from '../../../images/Ice01_nrm_jpg.js';
import Metal08_col_jpg from '../../../images/Metal08_col_jpg.js';
import Metal08_met_jpg from '../../../images/Metal08_met_jpg.js';
import Metal08_nrm_jpg from '../../../images/Metal08_nrm_jpg.js';
import Metal08_rgh_jpg from '../../../images/Metal08_rgh_jpg.js';
import Metal10_col_brightened_jpg from '../../../images/Metal10_col_brightened_jpg.js';
import Metal10_col_jpg from '../../../images/Metal10_col_jpg.js';
import Metal10_met_jpg from '../../../images/Metal10_met_jpg.js';
import Metal10_nrm_jpg from '../../../images/Metal10_nrm_jpg.js';
import Metal10_rgh_jpg from '../../../images/Metal10_rgh_jpg.js';
import Styrofoam_001_AO_jpg from '../../../images/Styrofoam_001_AO_jpg.js';
import Styrofoam_001_col_jpg from '../../../images/Styrofoam_001_col_jpg.js';
import Styrofoam_001_nrm_jpg from '../../../images/Styrofoam_001_nrm_jpg.js';
import Styrofoam_001_rgh_jpg from '../../../images/Styrofoam_001_rgh_jpg.js';
import Wood26_col_jpg from '../../../images/Wood26_col_jpg.js';
import Wood26_nrm_jpg from '../../../images/Wood26_nrm_jpg.js';
import Wood26_rgh_jpg from '../../../images/Wood26_rgh_jpg.js';
import densityBuoyancyCommon from '../../densityBuoyancyCommon.js';
import Material from '../model/Material.js';
import MaterialView from './MaterialView.js';

// constants

function toWrappedTexture(image) {
  const texture = ThreeUtils.imageToTexture(image, true);
  texture.wrapS = THREE.RepeatWrapping;
  texture.wrapT = THREE.RepeatWrapping;
  return texture;
}

// Simplified environment map to give a nice reflective appearance. We compute it per-pixel
let envMapTexture = null;
function getEnvironmentTexture() {
  const size = 32;
  if (!envMapTexture) {
    const canvas = document.createElement('canvas');
    canvas.width = size;
    canvas.height = size;
    const context = canvas.getContext('2d');
    const imageData = context.getImageData(0, 0, size, size);

    // For each pixel
    for (let i = 0; i < 32 * 32; i++) {
      const index = i * 4;

      // Determine spherical coordinates for the equirectangular mapping
      const theta = i % size / size * Math.PI * 2;
      const phi = Math.PI * (0.5 - Math.floor(i / size) / (size - 1));

      // Get a euclidean vector
      const v = new Vector3(-Math.cos(phi) * Math.cos(theta), Math.sin(phi), Math.cos(phi) * Math.sin(theta));

      // Our light direction
      const light = new Vector3(-1 / 2, 1.5, 0.8 / 2);

      // Front/top lighting + light
      const value = v.y > 0 || v.z < 0 ? 1 : v.dot(light) / 2;
      imageData.data[index + 0] = Utils.clamp(Math.floor(value * 255 + 127), 0, 255);
      imageData.data[index + 1] = Utils.clamp(Math.floor(value * 255 + 127), 0, 255);
      imageData.data[index + 2] = Utils.clamp(Math.floor(value * 255 + 127), 0, 255);
      imageData.data[index + 3] = 255;
    }
    context.putImageData(imageData, 0, 0);
    envMapTexture = new THREE.CanvasTexture(canvas, THREE.EquirectangularReflectionMapping, THREE.RepeatWrapping, THREE.RepeatWrapping);
  }
  return envMapTexture;
}

// textures
const aluminumColorTexture = toWrappedTexture(Metal10_col_jpg);
const aluminumMetalnessTexture = toWrappedTexture(Metal10_met_jpg);
const aluminumNormalTexture = toWrappedTexture(Metal10_nrm_jpg);
const aluminumRoughnessTexture = toWrappedTexture(Metal10_rgh_jpg);
const brickAmbientOcclusionTexture = toWrappedTexture(Bricks25_AO_jpg);
const brickColorTexture = toWrappedTexture(Bricks25_col_jpg);
const brickNormalTexture = toWrappedTexture(Bricks25_nrm_jpg);
const copperColorTexture = toWrappedTexture(Metal08_col_jpg);
const copperMetalnessTexture = toWrappedTexture(Metal08_met_jpg);
const copperNormalTexture = toWrappedTexture(Metal08_nrm_jpg);
const copperRoughnessTexture = toWrappedTexture(Metal08_rgh_jpg);
const iceAlphaTexture = toWrappedTexture(Ice01_alpha_jpg);
const iceColorTexture = toWrappedTexture(Ice01_col_jpg);
const iceNormalTexture = toWrappedTexture(Ice01_nrm_jpg);
const platinumColorTexture = toWrappedTexture(Metal10_col_brightened_jpg);
const steelColorTexture = toWrappedTexture(DiamondPlate01_col_jpg);
const steelMetalnessTexture = toWrappedTexture(DiamondPlate01_met_jpg);
const steelNormalTexture = toWrappedTexture(DiamondPlate01_nrm_jpg);
const steelRoughnessTexture = toWrappedTexture(DiamondPlate01_rgh_jpg);
const styrofoamAmbientOcclusionTexture = toWrappedTexture(Styrofoam_001_AO_jpg);
const styrofoamColorTexture = toWrappedTexture(Styrofoam_001_col_jpg);
const styrofoamNormalTexture = toWrappedTexture(Styrofoam_001_nrm_jpg);
const styrofoamRoughnessTexture = toWrappedTexture(Styrofoam_001_rgh_jpg);
const woodColorTexture = toWrappedTexture(Wood26_col_jpg);
const woodNormalTexture = toWrappedTexture(Wood26_nrm_jpg);
const woodRoughnessTexture = toWrappedTexture(Wood26_rgh_jpg);
class AluminumMaterialView extends MaterialView {
  constructor() {
    super(new THREE.MeshStandardMaterial({
      map: aluminumColorTexture,
      normalMap: aluminumNormalTexture,
      normalScale: new THREE.Vector2(1, -1),
      roughnessMap: aluminumRoughnessTexture,
      metalnessMap: aluminumMetalnessTexture,
      envMap: getEnvironmentTexture()
    }));
  }
}
class BrickMaterialView extends MaterialView {
  constructor() {
    super(new THREE.MeshStandardMaterial({
      map: brickColorTexture,
      aoMap: brickAmbientOcclusionTexture,
      normalMap: brickNormalTexture,
      normalScale: new THREE.Vector2(0.5, -0.5),
      roughness: 1,
      metalness: 0,
      envMap: getEnvironmentTexture()
    }));
  }
}
class CopperMaterialView extends MaterialView {
  constructor() {
    super(new THREE.MeshStandardMaterial({
      map: copperColorTexture,
      normalMap: copperNormalTexture,
      normalScale: new THREE.Vector2(1, -1),
      roughnessMap: copperRoughnessTexture,
      metalnessMap: copperMetalnessTexture,
      envMap: getEnvironmentTexture()
    }));
  }
}
class IceMaterialView extends MaterialView {
  constructor() {
    super(new THREE.MeshPhysicalMaterial({
      map: iceColorTexture,
      alphaMap: iceAlphaTexture,
      normalMap: iceNormalTexture,
      normalScale: new THREE.Vector2(1, -1),
      roughness: 0.7,
      refractionRatio: 1 / 1.309,
      metalness: 0.4,
      // @ts-expect-error they capitalized this
      clearCoat: 1,
      reflectivity: 1,
      envMapIntensity: 2,
      // is this too much cheating?

      transparent: true,
      side: THREE.DoubleSide,
      envMap: getEnvironmentTexture()
    }));
  }
}

// We just use aluminum
class PlatinumMaterialView extends MaterialView {
  constructor() {
    super(new THREE.MeshStandardMaterial({
      map: platinumColorTexture,
      normalMap: aluminumNormalTexture,
      normalScale: new THREE.Vector2(1, -1),
      roughnessMap: aluminumRoughnessTexture,
      roughness: 4,
      metalnessMap: aluminumMetalnessTexture,
      envMapIntensity: 0.5,
      emissive: 0xffffff,
      emissiveIntensity: 0.5,
      envMap: getEnvironmentTexture()
    }));
  }
}
class SteelMaterialView extends MaterialView {
  constructor() {
    super(new THREE.MeshStandardMaterial({
      map: steelColorTexture,
      normalMap: steelNormalTexture,
      normalScale: new THREE.Vector2(1, -1),
      roughnessMap: steelRoughnessTexture,
      metalnessMap: steelMetalnessTexture,
      envMap: getEnvironmentTexture()
    }));
  }
}
class StyrofoamMaterialView extends MaterialView {
  constructor() {
    super(new THREE.MeshStandardMaterial({
      map: styrofoamColorTexture,
      aoMap: styrofoamAmbientOcclusionTexture,
      normalMap: styrofoamNormalTexture,
      normalScale: new THREE.Vector2(1, 1),
      roughness: 1.5,
      roughnessMap: styrofoamRoughnessTexture,
      metalness: 0,
      envMap: getEnvironmentTexture()
    }));
  }
}
class WoodMaterialView extends MaterialView {
  constructor() {
    super(new THREE.MeshStandardMaterial({
      map: woodColorTexture,
      normalMap: woodNormalTexture,
      normalScale: new THREE.Vector2(1, -1),
      roughness: 0.8,
      roughnessMap: woodRoughnessTexture,
      metalness: 0,
      envMap: getEnvironmentTexture()
    }));
  }
}
class CustomMaterialView extends MaterialView {
  constructor(density) {
    const lightness = Material.getCustomLightness(density);
    const color = lightness + lightness * 0x100 + lightness * 0x10000;
    super(new THREE.MeshLambertMaterial({
      color: color
    }));
  }
}
class CustomColoredMaterialView extends MaterialView {
  constructor(colorProperty) {
    super(new THREE.MeshLambertMaterial());
    this.colorProperty = colorProperty;
    this.listener = color => {
      this.material.color = ThreeUtils.colorToThree(color);
    };
    this.colorProperty.link(this.listener);
  }

  /**
   * Releases references
   */
  dispose() {
    this.colorProperty.unlink(this.listener);
    super.dispose();
  }
}
class DebugMaterialView extends MaterialView {
  constructor() {
    super(new THREE.MeshLambertMaterial({
      color: 0xffaa44
    }));
  }
}
export default class DensityMaterials {
  /**
   * Returns a view for the given Material.
   */
  static getMaterialView(material) {
    if (material === Material.ALUMINUM) {
      return new AluminumMaterialView();
    } else if (material === Material.BRICK) {
      return new BrickMaterialView();
    } else if (material === Material.COPPER) {
      return new CopperMaterialView();
    } else if (material === Material.ICE) {
      return new IceMaterialView();
    } else if (material === Material.PLATINUM) {
      return new PlatinumMaterialView();
    } else if (material === Material.STEEL) {
      return new SteelMaterialView();
    } else if (material === Material.STYROFOAM) {
      return new StyrofoamMaterialView();
    } else if (material === Material.WOOD) {
      return new WoodMaterialView();
    } else if (material.custom) {
      if (material.customColor === null) {
        return new CustomMaterialView(material.density);
      } else {
        return new CustomColoredMaterialView(material.customColor);
      }
    } else {
      return new DebugMaterialView();
    }
  }
  static woodColorTexture = woodColorTexture;
  static woodNormalTexture = woodNormalTexture;
  static woodRoughnessTexture = woodRoughnessTexture;
}
densityBuoyancyCommon.register('DensityMaterials', DensityMaterials);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlZlY3RvcjMiLCJUaHJlZVV0aWxzIiwiQnJpY2tzMjVfQU9fanBnIiwiQnJpY2tzMjVfY29sX2pwZyIsIkJyaWNrczI1X25ybV9qcGciLCJEaWFtb25kUGxhdGUwMV9jb2xfanBnIiwiRGlhbW9uZFBsYXRlMDFfbWV0X2pwZyIsIkRpYW1vbmRQbGF0ZTAxX25ybV9qcGciLCJEaWFtb25kUGxhdGUwMV9yZ2hfanBnIiwiSWNlMDFfYWxwaGFfanBnIiwiSWNlMDFfY29sX2pwZyIsIkljZTAxX25ybV9qcGciLCJNZXRhbDA4X2NvbF9qcGciLCJNZXRhbDA4X21ldF9qcGciLCJNZXRhbDA4X25ybV9qcGciLCJNZXRhbDA4X3JnaF9qcGciLCJNZXRhbDEwX2NvbF9icmlnaHRlbmVkX2pwZyIsIk1ldGFsMTBfY29sX2pwZyIsIk1ldGFsMTBfbWV0X2pwZyIsIk1ldGFsMTBfbnJtX2pwZyIsIk1ldGFsMTBfcmdoX2pwZyIsIlN0eXJvZm9hbV8wMDFfQU9fanBnIiwiU3R5cm9mb2FtXzAwMV9jb2xfanBnIiwiU3R5cm9mb2FtXzAwMV9ucm1fanBnIiwiU3R5cm9mb2FtXzAwMV9yZ2hfanBnIiwiV29vZDI2X2NvbF9qcGciLCJXb29kMjZfbnJtX2pwZyIsIldvb2QyNl9yZ2hfanBnIiwiZGVuc2l0eUJ1b3lhbmN5Q29tbW9uIiwiTWF0ZXJpYWwiLCJNYXRlcmlhbFZpZXciLCJ0b1dyYXBwZWRUZXh0dXJlIiwiaW1hZ2UiLCJ0ZXh0dXJlIiwiaW1hZ2VUb1RleHR1cmUiLCJ3cmFwUyIsIlRIUkVFIiwiUmVwZWF0V3JhcHBpbmciLCJ3cmFwVCIsImVudk1hcFRleHR1cmUiLCJnZXRFbnZpcm9ubWVudFRleHR1cmUiLCJzaXplIiwiY2FudmFzIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwid2lkdGgiLCJoZWlnaHQiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsImltYWdlRGF0YSIsImdldEltYWdlRGF0YSIsImkiLCJpbmRleCIsInRoZXRhIiwiTWF0aCIsIlBJIiwicGhpIiwiZmxvb3IiLCJ2IiwiY29zIiwic2luIiwibGlnaHQiLCJ2YWx1ZSIsInkiLCJ6IiwiZG90IiwiZGF0YSIsImNsYW1wIiwicHV0SW1hZ2VEYXRhIiwiQ2FudmFzVGV4dHVyZSIsIkVxdWlyZWN0YW5ndWxhclJlZmxlY3Rpb25NYXBwaW5nIiwiYWx1bWludW1Db2xvclRleHR1cmUiLCJhbHVtaW51bU1ldGFsbmVzc1RleHR1cmUiLCJhbHVtaW51bU5vcm1hbFRleHR1cmUiLCJhbHVtaW51bVJvdWdobmVzc1RleHR1cmUiLCJicmlja0FtYmllbnRPY2NsdXNpb25UZXh0dXJlIiwiYnJpY2tDb2xvclRleHR1cmUiLCJicmlja05vcm1hbFRleHR1cmUiLCJjb3BwZXJDb2xvclRleHR1cmUiLCJjb3BwZXJNZXRhbG5lc3NUZXh0dXJlIiwiY29wcGVyTm9ybWFsVGV4dHVyZSIsImNvcHBlclJvdWdobmVzc1RleHR1cmUiLCJpY2VBbHBoYVRleHR1cmUiLCJpY2VDb2xvclRleHR1cmUiLCJpY2VOb3JtYWxUZXh0dXJlIiwicGxhdGludW1Db2xvclRleHR1cmUiLCJzdGVlbENvbG9yVGV4dHVyZSIsInN0ZWVsTWV0YWxuZXNzVGV4dHVyZSIsInN0ZWVsTm9ybWFsVGV4dHVyZSIsInN0ZWVsUm91Z2huZXNzVGV4dHVyZSIsInN0eXJvZm9hbUFtYmllbnRPY2NsdXNpb25UZXh0dXJlIiwic3R5cm9mb2FtQ29sb3JUZXh0dXJlIiwic3R5cm9mb2FtTm9ybWFsVGV4dHVyZSIsInN0eXJvZm9hbVJvdWdobmVzc1RleHR1cmUiLCJ3b29kQ29sb3JUZXh0dXJlIiwid29vZE5vcm1hbFRleHR1cmUiLCJ3b29kUm91Z2huZXNzVGV4dHVyZSIsIkFsdW1pbnVtTWF0ZXJpYWxWaWV3IiwiY29uc3RydWN0b3IiLCJNZXNoU3RhbmRhcmRNYXRlcmlhbCIsIm1hcCIsIm5vcm1hbE1hcCIsIm5vcm1hbFNjYWxlIiwiVmVjdG9yMiIsInJvdWdobmVzc01hcCIsIm1ldGFsbmVzc01hcCIsImVudk1hcCIsIkJyaWNrTWF0ZXJpYWxWaWV3IiwiYW9NYXAiLCJyb3VnaG5lc3MiLCJtZXRhbG5lc3MiLCJDb3BwZXJNYXRlcmlhbFZpZXciLCJJY2VNYXRlcmlhbFZpZXciLCJNZXNoUGh5c2ljYWxNYXRlcmlhbCIsImFscGhhTWFwIiwicmVmcmFjdGlvblJhdGlvIiwiY2xlYXJDb2F0IiwicmVmbGVjdGl2aXR5IiwiZW52TWFwSW50ZW5zaXR5IiwidHJhbnNwYXJlbnQiLCJzaWRlIiwiRG91YmxlU2lkZSIsIlBsYXRpbnVtTWF0ZXJpYWxWaWV3IiwiZW1pc3NpdmUiLCJlbWlzc2l2ZUludGVuc2l0eSIsIlN0ZWVsTWF0ZXJpYWxWaWV3IiwiU3R5cm9mb2FtTWF0ZXJpYWxWaWV3IiwiV29vZE1hdGVyaWFsVmlldyIsIkN1c3RvbU1hdGVyaWFsVmlldyIsImRlbnNpdHkiLCJsaWdodG5lc3MiLCJnZXRDdXN0b21MaWdodG5lc3MiLCJjb2xvciIsIk1lc2hMYW1iZXJ0TWF0ZXJpYWwiLCJDdXN0b21Db2xvcmVkTWF0ZXJpYWxWaWV3IiwiY29sb3JQcm9wZXJ0eSIsImxpc3RlbmVyIiwibWF0ZXJpYWwiLCJjb2xvclRvVGhyZWUiLCJsaW5rIiwiZGlzcG9zZSIsInVubGluayIsIkRlYnVnTWF0ZXJpYWxWaWV3IiwiRGVuc2l0eU1hdGVyaWFscyIsImdldE1hdGVyaWFsVmlldyIsIkFMVU1JTlVNIiwiQlJJQ0siLCJDT1BQRVIiLCJJQ0UiLCJQTEFUSU5VTSIsIlNURUVMIiwiU1RZUk9GT0FNIiwiV09PRCIsImN1c3RvbSIsImN1c3RvbUNvbG9yIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJEZW5zaXR5TWF0ZXJpYWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFByb3ZpZGVzIGZhY3RvcnkgbWV0aG9kcyBmb3IgY3JlYXRpbmcgTWF0ZXJpYWxWaWV3cyBmb3IgdmFyaW91cyBNYXRlcmlhbHMuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMy5qcyc7XHJcbmltcG9ydCBUaHJlZVV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL21vYml1cy9qcy9UaHJlZVV0aWxzLmpzJztcclxuaW1wb3J0IHsgQ29sb3IgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgQnJpY2tzMjVfQU9fanBnIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9Ccmlja3MyNV9BT19qcGcuanMnO1xyXG5pbXBvcnQgQnJpY2tzMjVfY29sX2pwZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvQnJpY2tzMjVfY29sX2pwZy5qcyc7XHJcbmltcG9ydCBCcmlja3MyNV9ucm1fanBnIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9Ccmlja3MyNV9ucm1fanBnLmpzJztcclxuaW1wb3J0IERpYW1vbmRQbGF0ZTAxX2NvbF9qcGcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL0RpYW1vbmRQbGF0ZTAxX2NvbF9qcGcuanMnO1xyXG5pbXBvcnQgRGlhbW9uZFBsYXRlMDFfbWV0X2pwZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvRGlhbW9uZFBsYXRlMDFfbWV0X2pwZy5qcyc7XHJcbmltcG9ydCBEaWFtb25kUGxhdGUwMV9ucm1fanBnIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9EaWFtb25kUGxhdGUwMV9ucm1fanBnLmpzJztcclxuaW1wb3J0IERpYW1vbmRQbGF0ZTAxX3JnaF9qcGcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL0RpYW1vbmRQbGF0ZTAxX3JnaF9qcGcuanMnO1xyXG5pbXBvcnQgSWNlMDFfYWxwaGFfanBnIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9JY2UwMV9hbHBoYV9qcGcuanMnO1xyXG5pbXBvcnQgSWNlMDFfY29sX2pwZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvSWNlMDFfY29sX2pwZy5qcyc7XHJcbmltcG9ydCBJY2UwMV9ucm1fanBnIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9JY2UwMV9ucm1fanBnLmpzJztcclxuaW1wb3J0IE1ldGFsMDhfY29sX2pwZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvTWV0YWwwOF9jb2xfanBnLmpzJztcclxuaW1wb3J0IE1ldGFsMDhfbWV0X2pwZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvTWV0YWwwOF9tZXRfanBnLmpzJztcclxuaW1wb3J0IE1ldGFsMDhfbnJtX2pwZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvTWV0YWwwOF9ucm1fanBnLmpzJztcclxuaW1wb3J0IE1ldGFsMDhfcmdoX2pwZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvTWV0YWwwOF9yZ2hfanBnLmpzJztcclxuaW1wb3J0IE1ldGFsMTBfY29sX2JyaWdodGVuZWRfanBnIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9NZXRhbDEwX2NvbF9icmlnaHRlbmVkX2pwZy5qcyc7XHJcbmltcG9ydCBNZXRhbDEwX2NvbF9qcGcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL01ldGFsMTBfY29sX2pwZy5qcyc7XHJcbmltcG9ydCBNZXRhbDEwX21ldF9qcGcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL01ldGFsMTBfbWV0X2pwZy5qcyc7XHJcbmltcG9ydCBNZXRhbDEwX25ybV9qcGcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL01ldGFsMTBfbnJtX2pwZy5qcyc7XHJcbmltcG9ydCBNZXRhbDEwX3JnaF9qcGcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL01ldGFsMTBfcmdoX2pwZy5qcyc7XHJcbmltcG9ydCBTdHlyb2ZvYW1fMDAxX0FPX2pwZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvU3R5cm9mb2FtXzAwMV9BT19qcGcuanMnO1xyXG5pbXBvcnQgU3R5cm9mb2FtXzAwMV9jb2xfanBnIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9TdHlyb2ZvYW1fMDAxX2NvbF9qcGcuanMnO1xyXG5pbXBvcnQgU3R5cm9mb2FtXzAwMV9ucm1fanBnIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9TdHlyb2ZvYW1fMDAxX25ybV9qcGcuanMnO1xyXG5pbXBvcnQgU3R5cm9mb2FtXzAwMV9yZ2hfanBnIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9TdHlyb2ZvYW1fMDAxX3JnaF9qcGcuanMnO1xyXG5pbXBvcnQgV29vZDI2X2NvbF9qcGcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL1dvb2QyNl9jb2xfanBnLmpzJztcclxuaW1wb3J0IFdvb2QyNl9ucm1fanBnIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9Xb29kMjZfbnJtX2pwZy5qcyc7XHJcbmltcG9ydCBXb29kMjZfcmdoX2pwZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvV29vZDI2X3JnaF9qcGcuanMnO1xyXG5pbXBvcnQgZGVuc2l0eUJ1b3lhbmN5Q29tbW9uIGZyb20gJy4uLy4uL2RlbnNpdHlCdW95YW5jeUNvbW1vbi5qcyc7XHJcbmltcG9ydCBNYXRlcmlhbCBmcm9tICcuLi9tb2RlbC9NYXRlcmlhbC5qcyc7XHJcbmltcG9ydCBNYXRlcmlhbFZpZXcgZnJvbSAnLi9NYXRlcmlhbFZpZXcuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcblxyXG5mdW5jdGlvbiB0b1dyYXBwZWRUZXh0dXJlKCBpbWFnZTogSFRNTEltYWdlRWxlbWVudCApOiBUSFJFRS5UZXh0dXJlIHtcclxuICBjb25zdCB0ZXh0dXJlID0gVGhyZWVVdGlscy5pbWFnZVRvVGV4dHVyZSggaW1hZ2UsIHRydWUgKTtcclxuICB0ZXh0dXJlLndyYXBTID0gVEhSRUUuUmVwZWF0V3JhcHBpbmc7XHJcbiAgdGV4dHVyZS53cmFwVCA9IFRIUkVFLlJlcGVhdFdyYXBwaW5nO1xyXG4gIHJldHVybiB0ZXh0dXJlO1xyXG59XHJcblxyXG4vLyBTaW1wbGlmaWVkIGVudmlyb25tZW50IG1hcCB0byBnaXZlIGEgbmljZSByZWZsZWN0aXZlIGFwcGVhcmFuY2UuIFdlIGNvbXB1dGUgaXQgcGVyLXBpeGVsXHJcbmxldCBlbnZNYXBUZXh0dXJlOiBUSFJFRS5DYW52YXNUZXh0dXJlIHwgbnVsbCA9IG51bGw7XHJcblxyXG5mdW5jdGlvbiBnZXRFbnZpcm9ubWVudFRleHR1cmUoKTogVEhSRUUuQ2FudmFzVGV4dHVyZSB7XHJcbiAgY29uc3Qgc2l6ZSA9IDMyO1xyXG4gIGlmICggIWVudk1hcFRleHR1cmUgKSB7XHJcbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnY2FudmFzJyApO1xyXG4gICAgY2FudmFzLndpZHRoID0gc2l6ZTtcclxuICAgIGNhbnZhcy5oZWlnaHQgPSBzaXplO1xyXG4gICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCAnMmQnICkhO1xyXG5cclxuICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKCAwLCAwLCBzaXplLCBzaXplICk7XHJcblxyXG4gICAgLy8gRm9yIGVhY2ggcGl4ZWxcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IDMyICogMzI7IGkrKyApIHtcclxuICAgICAgY29uc3QgaW5kZXggPSBpICogNDtcclxuXHJcbiAgICAgIC8vIERldGVybWluZSBzcGhlcmljYWwgY29vcmRpbmF0ZXMgZm9yIHRoZSBlcXVpcmVjdGFuZ3VsYXIgbWFwcGluZ1xyXG4gICAgICBjb25zdCB0aGV0YSA9ICggaSAlIHNpemUgKSAvIHNpemUgKiBNYXRoLlBJICogMjtcclxuICAgICAgY29uc3QgcGhpID0gTWF0aC5QSSAqICggMC41IC0gTWF0aC5mbG9vciggaSAvIHNpemUgKSAvICggc2l6ZSAtIDEgKSApO1xyXG5cclxuICAgICAgLy8gR2V0IGEgZXVjbGlkZWFuIHZlY3RvclxyXG4gICAgICBjb25zdCB2ID0gbmV3IFZlY3RvcjMoXHJcbiAgICAgICAgLU1hdGguY29zKCBwaGkgKSAqIE1hdGguY29zKCB0aGV0YSApLFxyXG4gICAgICAgIE1hdGguc2luKCBwaGkgKSxcclxuICAgICAgICBNYXRoLmNvcyggcGhpICkgKiBNYXRoLnNpbiggdGhldGEgKVxyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gT3VyIGxpZ2h0IGRpcmVjdGlvblxyXG4gICAgICBjb25zdCBsaWdodCA9IG5ldyBWZWN0b3IzKCAtMSAvIDIsIDEuNSwgMC44IC8gMiApO1xyXG5cclxuICAgICAgLy8gRnJvbnQvdG9wIGxpZ2h0aW5nICsgbGlnaHRcclxuICAgICAgY29uc3QgdmFsdWUgPSB2LnkgPiAwIHx8IHYueiA8IDAgPyAxIDogdi5kb3QoIGxpZ2h0ICkgLyAyO1xyXG5cclxuICAgICAgaW1hZ2VEYXRhLmRhdGFbIGluZGV4ICsgMCBdID0gVXRpbHMuY2xhbXAoIE1hdGguZmxvb3IoIHZhbHVlICogMjU1ICsgMTI3ICksIDAsIDI1NSApO1xyXG4gICAgICBpbWFnZURhdGEuZGF0YVsgaW5kZXggKyAxIF0gPSBVdGlscy5jbGFtcCggTWF0aC5mbG9vciggdmFsdWUgKiAyNTUgKyAxMjcgKSwgMCwgMjU1ICk7XHJcbiAgICAgIGltYWdlRGF0YS5kYXRhWyBpbmRleCArIDIgXSA9IFV0aWxzLmNsYW1wKCBNYXRoLmZsb29yKCB2YWx1ZSAqIDI1NSArIDEyNyApLCAwLCAyNTUgKTtcclxuICAgICAgaW1hZ2VEYXRhLmRhdGFbIGluZGV4ICsgMyBdID0gMjU1O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnRleHQucHV0SW1hZ2VEYXRhKCBpbWFnZURhdGEsIDAsIDAgKTtcclxuXHJcbiAgICBlbnZNYXBUZXh0dXJlID0gbmV3IFRIUkVFLkNhbnZhc1RleHR1cmUoIGNhbnZhcywgVEhSRUUuRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcsIFRIUkVFLlJlcGVhdFdyYXBwaW5nLCBUSFJFRS5SZXBlYXRXcmFwcGluZyApO1xyXG4gIH1cclxuICByZXR1cm4gZW52TWFwVGV4dHVyZTtcclxufVxyXG5cclxuLy8gdGV4dHVyZXNcclxuY29uc3QgYWx1bWludW1Db2xvclRleHR1cmUgPSB0b1dyYXBwZWRUZXh0dXJlKCBNZXRhbDEwX2NvbF9qcGcgKTtcclxuY29uc3QgYWx1bWludW1NZXRhbG5lc3NUZXh0dXJlID0gdG9XcmFwcGVkVGV4dHVyZSggTWV0YWwxMF9tZXRfanBnICk7XHJcbmNvbnN0IGFsdW1pbnVtTm9ybWFsVGV4dHVyZSA9IHRvV3JhcHBlZFRleHR1cmUoIE1ldGFsMTBfbnJtX2pwZyApO1xyXG5jb25zdCBhbHVtaW51bVJvdWdobmVzc1RleHR1cmUgPSB0b1dyYXBwZWRUZXh0dXJlKCBNZXRhbDEwX3JnaF9qcGcgKTtcclxuY29uc3QgYnJpY2tBbWJpZW50T2NjbHVzaW9uVGV4dHVyZSA9IHRvV3JhcHBlZFRleHR1cmUoIEJyaWNrczI1X0FPX2pwZyApO1xyXG5jb25zdCBicmlja0NvbG9yVGV4dHVyZSA9IHRvV3JhcHBlZFRleHR1cmUoIEJyaWNrczI1X2NvbF9qcGcgKTtcclxuY29uc3QgYnJpY2tOb3JtYWxUZXh0dXJlID0gdG9XcmFwcGVkVGV4dHVyZSggQnJpY2tzMjVfbnJtX2pwZyApO1xyXG5jb25zdCBjb3BwZXJDb2xvclRleHR1cmUgPSB0b1dyYXBwZWRUZXh0dXJlKCBNZXRhbDA4X2NvbF9qcGcgKTtcclxuY29uc3QgY29wcGVyTWV0YWxuZXNzVGV4dHVyZSA9IHRvV3JhcHBlZFRleHR1cmUoIE1ldGFsMDhfbWV0X2pwZyApO1xyXG5jb25zdCBjb3BwZXJOb3JtYWxUZXh0dXJlID0gdG9XcmFwcGVkVGV4dHVyZSggTWV0YWwwOF9ucm1fanBnICk7XHJcbmNvbnN0IGNvcHBlclJvdWdobmVzc1RleHR1cmUgPSB0b1dyYXBwZWRUZXh0dXJlKCBNZXRhbDA4X3JnaF9qcGcgKTtcclxuY29uc3QgaWNlQWxwaGFUZXh0dXJlID0gdG9XcmFwcGVkVGV4dHVyZSggSWNlMDFfYWxwaGFfanBnICk7XHJcbmNvbnN0IGljZUNvbG9yVGV4dHVyZSA9IHRvV3JhcHBlZFRleHR1cmUoIEljZTAxX2NvbF9qcGcgKTtcclxuY29uc3QgaWNlTm9ybWFsVGV4dHVyZSA9IHRvV3JhcHBlZFRleHR1cmUoIEljZTAxX25ybV9qcGcgKTtcclxuY29uc3QgcGxhdGludW1Db2xvclRleHR1cmUgPSB0b1dyYXBwZWRUZXh0dXJlKCBNZXRhbDEwX2NvbF9icmlnaHRlbmVkX2pwZyApO1xyXG5jb25zdCBzdGVlbENvbG9yVGV4dHVyZSA9IHRvV3JhcHBlZFRleHR1cmUoIERpYW1vbmRQbGF0ZTAxX2NvbF9qcGcgKTtcclxuY29uc3Qgc3RlZWxNZXRhbG5lc3NUZXh0dXJlID0gdG9XcmFwcGVkVGV4dHVyZSggRGlhbW9uZFBsYXRlMDFfbWV0X2pwZyApO1xyXG5jb25zdCBzdGVlbE5vcm1hbFRleHR1cmUgPSB0b1dyYXBwZWRUZXh0dXJlKCBEaWFtb25kUGxhdGUwMV9ucm1fanBnICk7XHJcbmNvbnN0IHN0ZWVsUm91Z2huZXNzVGV4dHVyZSA9IHRvV3JhcHBlZFRleHR1cmUoIERpYW1vbmRQbGF0ZTAxX3JnaF9qcGcgKTtcclxuY29uc3Qgc3R5cm9mb2FtQW1iaWVudE9jY2x1c2lvblRleHR1cmUgPSB0b1dyYXBwZWRUZXh0dXJlKCBTdHlyb2ZvYW1fMDAxX0FPX2pwZyApO1xyXG5jb25zdCBzdHlyb2ZvYW1Db2xvclRleHR1cmUgPSB0b1dyYXBwZWRUZXh0dXJlKCBTdHlyb2ZvYW1fMDAxX2NvbF9qcGcgKTtcclxuY29uc3Qgc3R5cm9mb2FtTm9ybWFsVGV4dHVyZSA9IHRvV3JhcHBlZFRleHR1cmUoIFN0eXJvZm9hbV8wMDFfbnJtX2pwZyApO1xyXG5jb25zdCBzdHlyb2ZvYW1Sb3VnaG5lc3NUZXh0dXJlID0gdG9XcmFwcGVkVGV4dHVyZSggU3R5cm9mb2FtXzAwMV9yZ2hfanBnICk7XHJcbmNvbnN0IHdvb2RDb2xvclRleHR1cmUgPSB0b1dyYXBwZWRUZXh0dXJlKCBXb29kMjZfY29sX2pwZyApO1xyXG5jb25zdCB3b29kTm9ybWFsVGV4dHVyZSA9IHRvV3JhcHBlZFRleHR1cmUoIFdvb2QyNl9ucm1fanBnICk7XHJcbmNvbnN0IHdvb2RSb3VnaG5lc3NUZXh0dXJlID0gdG9XcmFwcGVkVGV4dHVyZSggV29vZDI2X3JnaF9qcGcgKTtcclxuXHJcbmNsYXNzIEFsdW1pbnVtTWF0ZXJpYWxWaWV3IGV4dGVuZHMgTWF0ZXJpYWxWaWV3IHtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlciggbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKCB7XHJcbiAgICAgIG1hcDogYWx1bWludW1Db2xvclRleHR1cmUsXHJcbiAgICAgIG5vcm1hbE1hcDogYWx1bWludW1Ob3JtYWxUZXh0dXJlLFxyXG4gICAgICBub3JtYWxTY2FsZTogbmV3IFRIUkVFLlZlY3RvcjIoIDEsIC0xICksXHJcbiAgICAgIHJvdWdobmVzc01hcDogYWx1bWludW1Sb3VnaG5lc3NUZXh0dXJlLFxyXG4gICAgICBtZXRhbG5lc3NNYXA6IGFsdW1pbnVtTWV0YWxuZXNzVGV4dHVyZSxcclxuICAgICAgZW52TWFwOiBnZXRFbnZpcm9ubWVudFRleHR1cmUoKVxyXG4gICAgfSApICk7XHJcbiAgfVxyXG59XHJcblxyXG5jbGFzcyBCcmlja01hdGVyaWFsVmlldyBleHRlbmRzIE1hdGVyaWFsVmlldyB7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoIG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCgge1xyXG4gICAgICBtYXA6IGJyaWNrQ29sb3JUZXh0dXJlLFxyXG4gICAgICBhb01hcDogYnJpY2tBbWJpZW50T2NjbHVzaW9uVGV4dHVyZSxcclxuICAgICAgbm9ybWFsTWFwOiBicmlja05vcm1hbFRleHR1cmUsXHJcbiAgICAgIG5vcm1hbFNjYWxlOiBuZXcgVEhSRUUuVmVjdG9yMiggMC41LCAtMC41ICksXHJcbiAgICAgIHJvdWdobmVzczogMSxcclxuICAgICAgbWV0YWxuZXNzOiAwLFxyXG4gICAgICBlbnZNYXA6IGdldEVudmlyb25tZW50VGV4dHVyZSgpXHJcbiAgICB9ICkgKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIENvcHBlck1hdGVyaWFsVmlldyBleHRlbmRzIE1hdGVyaWFsVmlldyB7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoIG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCgge1xyXG4gICAgICBtYXA6IGNvcHBlckNvbG9yVGV4dHVyZSxcclxuICAgICAgbm9ybWFsTWFwOiBjb3BwZXJOb3JtYWxUZXh0dXJlLFxyXG4gICAgICBub3JtYWxTY2FsZTogbmV3IFRIUkVFLlZlY3RvcjIoIDEsIC0xICksXHJcbiAgICAgIHJvdWdobmVzc01hcDogY29wcGVyUm91Z2huZXNzVGV4dHVyZSxcclxuICAgICAgbWV0YWxuZXNzTWFwOiBjb3BwZXJNZXRhbG5lc3NUZXh0dXJlLFxyXG4gICAgICBlbnZNYXA6IGdldEVudmlyb25tZW50VGV4dHVyZSgpXHJcbiAgICB9ICkgKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIEljZU1hdGVyaWFsVmlldyBleHRlbmRzIE1hdGVyaWFsVmlldyB7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoIG5ldyBUSFJFRS5NZXNoUGh5c2ljYWxNYXRlcmlhbCgge1xyXG4gICAgICBtYXA6IGljZUNvbG9yVGV4dHVyZSxcclxuICAgICAgYWxwaGFNYXA6IGljZUFscGhhVGV4dHVyZSxcclxuICAgICAgbm9ybWFsTWFwOiBpY2VOb3JtYWxUZXh0dXJlLFxyXG4gICAgICBub3JtYWxTY2FsZTogbmV3IFRIUkVFLlZlY3RvcjIoIDEsIC0xICksXHJcbiAgICAgIHJvdWdobmVzczogMC43LFxyXG4gICAgICByZWZyYWN0aW9uUmF0aW86IDEgLyAxLjMwOSxcclxuICAgICAgbWV0YWxuZXNzOiAwLjQsXHJcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgdGhleSBjYXBpdGFsaXplZCB0aGlzXHJcbiAgICAgIGNsZWFyQ29hdDogMSxcclxuICAgICAgcmVmbGVjdGl2aXR5OiAxLFxyXG4gICAgICBlbnZNYXBJbnRlbnNpdHk6IDIsIC8vIGlzIHRoaXMgdG9vIG11Y2ggY2hlYXRpbmc/XHJcblxyXG4gICAgICB0cmFuc3BhcmVudDogdHJ1ZSxcclxuICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSxcclxuXHJcbiAgICAgIGVudk1hcDogZ2V0RW52aXJvbm1lbnRUZXh0dXJlKClcclxuICAgIH0gKSApO1xyXG4gIH1cclxufVxyXG5cclxuLy8gV2UganVzdCB1c2UgYWx1bWludW1cclxuY2xhc3MgUGxhdGludW1NYXRlcmlhbFZpZXcgZXh0ZW5kcyBNYXRlcmlhbFZpZXcge1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKCBuZXcgVEhSRUUuTWVzaFN0YW5kYXJkTWF0ZXJpYWwoIHtcclxuICAgICAgbWFwOiBwbGF0aW51bUNvbG9yVGV4dHVyZSxcclxuICAgICAgbm9ybWFsTWFwOiBhbHVtaW51bU5vcm1hbFRleHR1cmUsXHJcbiAgICAgIG5vcm1hbFNjYWxlOiBuZXcgVEhSRUUuVmVjdG9yMiggMSwgLTEgKSxcclxuICAgICAgcm91Z2huZXNzTWFwOiBhbHVtaW51bVJvdWdobmVzc1RleHR1cmUsXHJcbiAgICAgIHJvdWdobmVzczogNCxcclxuICAgICAgbWV0YWxuZXNzTWFwOiBhbHVtaW51bU1ldGFsbmVzc1RleHR1cmUsXHJcbiAgICAgIGVudk1hcEludGVuc2l0eTogMC41LFxyXG4gICAgICBlbWlzc2l2ZTogMHhmZmZmZmYsXHJcbiAgICAgIGVtaXNzaXZlSW50ZW5zaXR5OiAwLjUsXHJcbiAgICAgIGVudk1hcDogZ2V0RW52aXJvbm1lbnRUZXh0dXJlKClcclxuICAgIH0gKSApO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgU3RlZWxNYXRlcmlhbFZpZXcgZXh0ZW5kcyBNYXRlcmlhbFZpZXcge1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKCBuZXcgVEhSRUUuTWVzaFN0YW5kYXJkTWF0ZXJpYWwoIHtcclxuICAgICAgbWFwOiBzdGVlbENvbG9yVGV4dHVyZSxcclxuICAgICAgbm9ybWFsTWFwOiBzdGVlbE5vcm1hbFRleHR1cmUsXHJcbiAgICAgIG5vcm1hbFNjYWxlOiBuZXcgVEhSRUUuVmVjdG9yMiggMSwgLTEgKSxcclxuICAgICAgcm91Z2huZXNzTWFwOiBzdGVlbFJvdWdobmVzc1RleHR1cmUsXHJcbiAgICAgIG1ldGFsbmVzc01hcDogc3RlZWxNZXRhbG5lc3NUZXh0dXJlLFxyXG4gICAgICBlbnZNYXA6IGdldEVudmlyb25tZW50VGV4dHVyZSgpXHJcbiAgICB9ICkgKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIFN0eXJvZm9hbU1hdGVyaWFsVmlldyBleHRlbmRzIE1hdGVyaWFsVmlldyB7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoIG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCgge1xyXG4gICAgICBtYXA6IHN0eXJvZm9hbUNvbG9yVGV4dHVyZSxcclxuICAgICAgYW9NYXA6IHN0eXJvZm9hbUFtYmllbnRPY2NsdXNpb25UZXh0dXJlLFxyXG4gICAgICBub3JtYWxNYXA6IHN0eXJvZm9hbU5vcm1hbFRleHR1cmUsXHJcbiAgICAgIG5vcm1hbFNjYWxlOiBuZXcgVEhSRUUuVmVjdG9yMiggMSwgMSApLFxyXG4gICAgICByb3VnaG5lc3M6IDEuNSxcclxuICAgICAgcm91Z2huZXNzTWFwOiBzdHlyb2ZvYW1Sb3VnaG5lc3NUZXh0dXJlLFxyXG4gICAgICBtZXRhbG5lc3M6IDAsXHJcbiAgICAgIGVudk1hcDogZ2V0RW52aXJvbm1lbnRUZXh0dXJlKClcclxuICAgIH0gKSApO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgV29vZE1hdGVyaWFsVmlldyBleHRlbmRzIE1hdGVyaWFsVmlldyB7XHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoIG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCgge1xyXG4gICAgICBtYXA6IHdvb2RDb2xvclRleHR1cmUsXHJcbiAgICAgIG5vcm1hbE1hcDogd29vZE5vcm1hbFRleHR1cmUsXHJcbiAgICAgIG5vcm1hbFNjYWxlOiBuZXcgVEhSRUUuVmVjdG9yMiggMSwgLTEgKSxcclxuICAgICAgcm91Z2huZXNzOiAwLjgsXHJcbiAgICAgIHJvdWdobmVzc01hcDogd29vZFJvdWdobmVzc1RleHR1cmUsXHJcbiAgICAgIG1ldGFsbmVzczogMCxcclxuICAgICAgZW52TWFwOiBnZXRFbnZpcm9ubWVudFRleHR1cmUoKVxyXG4gICAgfSApICk7XHJcbiAgfVxyXG59XHJcblxyXG5jbGFzcyBDdXN0b21NYXRlcmlhbFZpZXcgZXh0ZW5kcyBNYXRlcmlhbFZpZXcge1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggZGVuc2l0eTogbnVtYmVyICkge1xyXG4gICAgY29uc3QgbGlnaHRuZXNzID0gTWF0ZXJpYWwuZ2V0Q3VzdG9tTGlnaHRuZXNzKCBkZW5zaXR5ICk7XHJcbiAgICBjb25zdCBjb2xvciA9IGxpZ2h0bmVzcyArIGxpZ2h0bmVzcyAqIDB4MTAwICsgbGlnaHRuZXNzICogMHgxMDAwMDtcclxuXHJcbiAgICBzdXBlciggbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoIHtcclxuICAgICAgY29sb3I6IGNvbG9yXHJcbiAgICB9ICkgKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIEN1c3RvbUNvbG9yZWRNYXRlcmlhbFZpZXcgZXh0ZW5kcyBNYXRlcmlhbFZpZXc8VEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbD4ge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGNvbG9yUHJvcGVydHk6IFByb3BlcnR5PENvbG9yPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGxpc3RlbmVyOiAoIGNvbG9yOiBDb2xvciApID0+IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggY29sb3JQcm9wZXJ0eTogUHJvcGVydHk8Q29sb3I+ICkge1xyXG4gICAgc3VwZXIoIG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCkgKTtcclxuXHJcbiAgICB0aGlzLmNvbG9yUHJvcGVydHkgPSBjb2xvclByb3BlcnR5O1xyXG5cclxuICAgIHRoaXMubGlzdGVuZXIgPSBjb2xvciA9PiB7XHJcbiAgICAgIHRoaXMubWF0ZXJpYWwuY29sb3IgPSBUaHJlZVV0aWxzLmNvbG9yVG9UaHJlZSggY29sb3IgKTtcclxuICAgIH07XHJcbiAgICB0aGlzLmNvbG9yUHJvcGVydHkubGluayggdGhpcy5saXN0ZW5lciApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVsZWFzZXMgcmVmZXJlbmNlc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jb2xvclByb3BlcnR5LnVubGluayggdGhpcy5saXN0ZW5lciApO1xyXG5cclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIERlYnVnTWF0ZXJpYWxWaWV3IGV4dGVuZHMgTWF0ZXJpYWxWaWV3IHtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlciggbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoIHtcclxuICAgICAgY29sb3I6IDB4ZmZhYTQ0XHJcbiAgICB9ICkgKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERlbnNpdHlNYXRlcmlhbHMge1xyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgYSB2aWV3IGZvciB0aGUgZ2l2ZW4gTWF0ZXJpYWwuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBnZXRNYXRlcmlhbFZpZXcoIG1hdGVyaWFsOiBNYXRlcmlhbCApOiBNYXRlcmlhbFZpZXcge1xyXG4gICAgaWYgKCBtYXRlcmlhbCA9PT0gTWF0ZXJpYWwuQUxVTUlOVU0gKSB7XHJcbiAgICAgIHJldHVybiBuZXcgQWx1bWludW1NYXRlcmlhbFZpZXcoKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBtYXRlcmlhbCA9PT0gTWF0ZXJpYWwuQlJJQ0sgKSB7XHJcbiAgICAgIHJldHVybiBuZXcgQnJpY2tNYXRlcmlhbFZpZXcoKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBtYXRlcmlhbCA9PT0gTWF0ZXJpYWwuQ09QUEVSICkge1xyXG4gICAgICByZXR1cm4gbmV3IENvcHBlck1hdGVyaWFsVmlldygpO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIG1hdGVyaWFsID09PSBNYXRlcmlhbC5JQ0UgKSB7XHJcbiAgICAgIHJldHVybiBuZXcgSWNlTWF0ZXJpYWxWaWV3KCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggbWF0ZXJpYWwgPT09IE1hdGVyaWFsLlBMQVRJTlVNICkge1xyXG4gICAgICByZXR1cm4gbmV3IFBsYXRpbnVtTWF0ZXJpYWxWaWV3KCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggbWF0ZXJpYWwgPT09IE1hdGVyaWFsLlNURUVMICkge1xyXG4gICAgICByZXR1cm4gbmV3IFN0ZWVsTWF0ZXJpYWxWaWV3KCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggbWF0ZXJpYWwgPT09IE1hdGVyaWFsLlNUWVJPRk9BTSApIHtcclxuICAgICAgcmV0dXJuIG5ldyBTdHlyb2ZvYW1NYXRlcmlhbFZpZXcoKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBtYXRlcmlhbCA9PT0gTWF0ZXJpYWwuV09PRCApIHtcclxuICAgICAgcmV0dXJuIG5ldyBXb29kTWF0ZXJpYWxWaWV3KCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggbWF0ZXJpYWwuY3VzdG9tICkge1xyXG4gICAgICBpZiAoIG1hdGVyaWFsLmN1c3RvbUNvbG9yID09PSBudWxsICkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ3VzdG9tTWF0ZXJpYWxWaWV3KCBtYXRlcmlhbC5kZW5zaXR5ICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDdXN0b21Db2xvcmVkTWF0ZXJpYWxWaWV3KCBtYXRlcmlhbC5jdXN0b21Db2xvciApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgcmV0dXJuIG5ldyBEZWJ1Z01hdGVyaWFsVmlldygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSB3b29kQ29sb3JUZXh0dXJlID0gd29vZENvbG9yVGV4dHVyZTtcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IHdvb2ROb3JtYWxUZXh0dXJlID0gd29vZE5vcm1hbFRleHR1cmU7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSB3b29kUm91Z2huZXNzVGV4dHVyZSA9IHdvb2RSb3VnaG5lc3NUZXh0dXJlO1xyXG59XHJcblxyXG5cclxuZGVuc2l0eUJ1b3lhbmN5Q29tbW9uLnJlZ2lzdGVyKCAnRGVuc2l0eU1hdGVyaWFscycsIERlbnNpdHlNYXRlcmlhbHMgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLE9BQU9BLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxVQUFVLE1BQU0scUNBQXFDO0FBRTVELE9BQU9DLGVBQWUsTUFBTSxvQ0FBb0M7QUFDaEUsT0FBT0MsZ0JBQWdCLE1BQU0scUNBQXFDO0FBQ2xFLE9BQU9DLGdCQUFnQixNQUFNLHFDQUFxQztBQUNsRSxPQUFPQyxzQkFBc0IsTUFBTSwyQ0FBMkM7QUFDOUUsT0FBT0Msc0JBQXNCLE1BQU0sMkNBQTJDO0FBQzlFLE9BQU9DLHNCQUFzQixNQUFNLDJDQUEyQztBQUM5RSxPQUFPQyxzQkFBc0IsTUFBTSwyQ0FBMkM7QUFDOUUsT0FBT0MsZUFBZSxNQUFNLG9DQUFvQztBQUNoRSxPQUFPQyxhQUFhLE1BQU0sa0NBQWtDO0FBQzVELE9BQU9DLGFBQWEsTUFBTSxr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