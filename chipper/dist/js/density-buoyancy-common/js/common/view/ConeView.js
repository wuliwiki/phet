// Copyright 2019-2022, University of Colorado Boulder

/**
 * The 3D view for a Cone.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Vector3 from '../../../../dot/js/Vector3.js';
import TriangleArrayWriter from '../../../../mobius/js/TriangleArrayWriter.js';
import densityBuoyancyCommon from '../../densityBuoyancyCommon.js';
import MassView, { TAG_OFFSET } from './MassView.js';

// constants
const segments = 64;
const numElements = 6 * segments;
export default class ConeView extends MassView {
  constructor(cone) {
    const positionArray = new Float32Array(numElements * 3);
    const normalArray = new Float32Array(numElements * 3);
    const uvArray = new Float32Array(numElements * 2);
    ConeView.updateArrays(positionArray, normalArray, uvArray, cone.radiusProperty.value, cone.heightProperty.value, cone.isVertexUp);
    const coneGeometry = new THREE.BufferGeometry();
    coneGeometry.addAttribute('position', new THREE.BufferAttribute(positionArray, 3));
    coneGeometry.addAttribute('normal', new THREE.BufferAttribute(normalArray, 3));
    coneGeometry.addAttribute('uv', new THREE.BufferAttribute(uvArray, 2));
    super(cone, coneGeometry);
    this.cone = cone;
    this.coneGeometry = coneGeometry;
    const positionTag = () => {
      const radius = cone.radiusProperty.value;
      const height = cone.heightProperty.value;
      const vertexSign = cone.isVertexUp ? 1 : -1;
      const vertexY = vertexSign * 0.75 * height;
      const baseY = -vertexSign * 0.25 * height;
      const topY = Math.max(vertexY, baseY);
      this.tagOffsetProperty.value = new Vector3(-radius + TAG_OFFSET, topY - this.tagHeight - TAG_OFFSET, radius);
    };
    positionTag();
    this.updateListener = () => {
      positionTag();
      ConeView.updateArrays(coneGeometry.attributes.position.array, coneGeometry.attributes.normal.array, null, cone.radiusProperty.value, cone.heightProperty.value, cone.isVertexUp);
      coneGeometry.attributes.position.needsUpdate = true;
      coneGeometry.attributes.normal.needsUpdate = true;
      coneGeometry.computeBoundingSphere();
    };
    this.cone.radiusProperty.lazyLink(this.updateListener);
    this.cone.heightProperty.lazyLink(this.updateListener);
  }

  /**
   * Releases references.
   */
  dispose() {
    this.cone.radiusProperty.unlink(this.updateListener);
    this.cone.heightProperty.unlink(this.updateListener);
    this.coneGeometry.dispose();
    super.dispose();
  }

  /**
   * Updates provided geometry arrays given the specific size.
   *
   * @param positionArray
   * @param normalArray
   * @param uvArray
   * @param radius
   * @param height
   * @param isVertexUp
   * @param offset - How many vertices have been specified so far?
   * @param offsetPosition - How to transform all of the points
   * @returns - The offset after the specified vertices have been written
   */
  static updateArrays(positionArray, normalArray, uvArray, radius, height, isVertexUp, offset = 0, offsetPosition = Vector3.ZERO) {
    const writer = new TriangleArrayWriter(positionArray, normalArray, uvArray, offset, offsetPosition);
    const vertexSign = isVertexUp ? 1 : -1;
    const vertexY = vertexSign * 0.75 * height;
    const baseY = -vertexSign * 0.25 * height;
    const TWO_PI = 2 * Math.PI;
    const HALF_PI = 0.5 * Math.PI;
    for (let i = 0; i < segments; i++) {
      const ratio0 = i / segments;
      const ratio1 = (i + 1) / segments;
      const theta0 = TWO_PI * ratio0 - HALF_PI;
      const theta1 = TWO_PI * ratio1 - HALF_PI;
      const vertices = [new Vector3(0, vertexY, 0), new Vector3(radius * Math.cos(isVertexUp ? theta1 : theta0), baseY, radius * Math.sin(isVertexUp ? theta1 : theta0)), new Vector3(radius * Math.cos(isVertexUp ? theta0 : theta1), baseY, radius * Math.sin(isVertexUp ? theta0 : theta1))];
      const normalVector = vertices[2].minus(vertices[0]).cross(vertices[1].minus(vertices[0])).normalized().negated();

      // Side
      for (let j = 0; j < vertices.length; j++) {
        writer.position(vertices[j].x, vertices[j].y, vertices[j].z);
        writer.normal(normalVector.x, normalVector.y, normalVector.z);
      }
      writer.uv(0.5, 0);
      writer.uv((isVertexUp ? theta1 : theta0) / TWO_PI, 1);
      writer.uv((isVertexUp ? theta0 : theta1) / TWO_PI, 1);

      // Top/Bottom
      writer.position(0, baseY, 0);
      writer.position(vertices[2].x, vertices[2].y, vertices[2].z);
      writer.position(vertices[1].x, vertices[1].y, vertices[1].z);
      writer.normal(0, 0, -vertexSign);
      writer.normal(0, 0, -vertexSign);
      writer.normal(0, 0, -vertexSign);
      writer.uv(0.5, 0);
      writer.uv((isVertexUp ? theta0 : theta1) / TWO_PI, 1);
      writer.uv((isVertexUp ? theta1 : theta0) / TWO_PI, 1);
    }
    return writer.getOffset();
  }
}
densityBuoyancyCommon.register('ConeView', ConeView);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IzIiwiVHJpYW5nbGVBcnJheVdyaXRlciIsImRlbnNpdHlCdW95YW5jeUNvbW1vbiIsIk1hc3NWaWV3IiwiVEFHX09GRlNFVCIsInNlZ21lbnRzIiwibnVtRWxlbWVudHMiLCJDb25lVmlldyIsImNvbnN0cnVjdG9yIiwiY29uZSIsInBvc2l0aW9uQXJyYXkiLCJGbG9hdDMyQXJyYXkiLCJub3JtYWxBcnJheSIsInV2QXJyYXkiLCJ1cGRhdGVBcnJheXMiLCJyYWRpdXNQcm9wZXJ0eSIsInZhbHVlIiwiaGVpZ2h0UHJvcGVydHkiLCJpc1ZlcnRleFVwIiwiY29uZUdlb21ldHJ5IiwiVEhSRUUiLCJCdWZmZXJHZW9tZXRyeSIsImFkZEF0dHJpYnV0ZSIsIkJ1ZmZlckF0dHJpYnV0ZSIsInBvc2l0aW9uVGFnIiwicmFkaXVzIiwiaGVpZ2h0IiwidmVydGV4U2lnbiIsInZlcnRleFkiLCJiYXNlWSIsInRvcFkiLCJNYXRoIiwibWF4IiwidGFnT2Zmc2V0UHJvcGVydHkiLCJ0YWdIZWlnaHQiLCJ1cGRhdGVMaXN0ZW5lciIsImF0dHJpYnV0ZXMiLCJwb3NpdGlvbiIsImFycmF5Iiwibm9ybWFsIiwibmVlZHNVcGRhdGUiLCJjb21wdXRlQm91bmRpbmdTcGhlcmUiLCJsYXp5TGluayIsImRpc3Bvc2UiLCJ1bmxpbmsiLCJvZmZzZXQiLCJvZmZzZXRQb3NpdGlvbiIsIlpFUk8iLCJ3cml0ZXIiLCJUV09fUEkiLCJQSSIsIkhBTEZfUEkiLCJpIiwicmF0aW8wIiwicmF0aW8xIiwidGhldGEwIiwidGhldGExIiwidmVydGljZXMiLCJjb3MiLCJzaW4iLCJub3JtYWxWZWN0b3IiLCJtaW51cyIsImNyb3NzIiwibm9ybWFsaXplZCIsIm5lZ2F0ZWQiLCJqIiwibGVuZ3RoIiwieCIsInkiLCJ6IiwidXYiLCJnZXRPZmZzZXQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNvbmVWaWV3LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFRoZSAzRCB2aWV3IGZvciBhIENvbmUuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgVmVjdG9yMyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMy5qcyc7XHJcbmltcG9ydCBUcmlhbmdsZUFycmF5V3JpdGVyIGZyb20gJy4uLy4uLy4uLy4uL21vYml1cy9qcy9UcmlhbmdsZUFycmF5V3JpdGVyLmpzJztcclxuaW1wb3J0IGRlbnNpdHlCdW95YW5jeUNvbW1vbiBmcm9tICcuLi8uLi9kZW5zaXR5QnVveWFuY3lDb21tb24uanMnO1xyXG5pbXBvcnQgQ29uZSBmcm9tICcuLi9tb2RlbC9Db25lLmpzJztcclxuaW1wb3J0IE1hc3NWaWV3LCB7IFRBR19PRkZTRVQgfSBmcm9tICcuL01hc3NWaWV3LmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBzZWdtZW50cyA9IDY0O1xyXG5jb25zdCBudW1FbGVtZW50cyA9IDYgKiBzZWdtZW50cztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbmVWaWV3IGV4dGVuZHMgTWFzc1ZpZXcge1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgY29uZTogQ29uZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNvbmVHZW9tZXRyeTogVEhSRUUuQnVmZmVyR2VvbWV0cnk7XHJcbiAgcHJpdmF0ZSByZWFkb25seSB1cGRhdGVMaXN0ZW5lcjogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBjb25lOiBDb25lICkge1xyXG5cclxuICAgIGNvbnN0IHBvc2l0aW9uQXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCBudW1FbGVtZW50cyAqIDMgKTtcclxuICAgIGNvbnN0IG5vcm1hbEFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggbnVtRWxlbWVudHMgKiAzICk7XHJcbiAgICBjb25zdCB1dkFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggbnVtRWxlbWVudHMgKiAyICk7XHJcblxyXG4gICAgQ29uZVZpZXcudXBkYXRlQXJyYXlzKCBwb3NpdGlvbkFycmF5LCBub3JtYWxBcnJheSwgdXZBcnJheSwgY29uZS5yYWRpdXNQcm9wZXJ0eS52YWx1ZSwgY29uZS5oZWlnaHRQcm9wZXJ0eS52YWx1ZSwgY29uZS5pc1ZlcnRleFVwICk7XHJcblxyXG4gICAgY29uc3QgY29uZUdlb21ldHJ5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCk7XHJcbiAgICBjb25lR2VvbWV0cnkuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkFycmF5LCAzICkgKTtcclxuICAgIGNvbmVHZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKCBub3JtYWxBcnJheSwgMyApICk7XHJcbiAgICBjb25lR2VvbWV0cnkuYWRkQXR0cmlidXRlKCAndXYnLCBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKCB1dkFycmF5LCAyICkgKTtcclxuXHJcbiAgICBzdXBlciggY29uZSwgY29uZUdlb21ldHJ5ICk7XHJcblxyXG4gICAgdGhpcy5jb25lID0gY29uZTtcclxuICAgIHRoaXMuY29uZUdlb21ldHJ5ID0gY29uZUdlb21ldHJ5O1xyXG5cclxuICAgIGNvbnN0IHBvc2l0aW9uVGFnID0gKCkgPT4ge1xyXG4gICAgICBjb25zdCByYWRpdXMgPSBjb25lLnJhZGl1c1Byb3BlcnR5LnZhbHVlO1xyXG4gICAgICBjb25zdCBoZWlnaHQgPSBjb25lLmhlaWdodFByb3BlcnR5LnZhbHVlO1xyXG4gICAgICBjb25zdCB2ZXJ0ZXhTaWduID0gY29uZS5pc1ZlcnRleFVwID8gMSA6IC0xO1xyXG4gICAgICBjb25zdCB2ZXJ0ZXhZID0gdmVydGV4U2lnbiAqIDAuNzUgKiBoZWlnaHQ7XHJcbiAgICAgIGNvbnN0IGJhc2VZID0gLXZlcnRleFNpZ24gKiAwLjI1ICogaGVpZ2h0O1xyXG4gICAgICBjb25zdCB0b3BZID0gTWF0aC5tYXgoIHZlcnRleFksIGJhc2VZICk7XHJcblxyXG4gICAgICB0aGlzLnRhZ09mZnNldFByb3BlcnR5LnZhbHVlID0gbmV3IFZlY3RvcjMoIC1yYWRpdXMgKyBUQUdfT0ZGU0VULCB0b3BZIC0gdGhpcy50YWdIZWlnaHQhIC0gVEFHX09GRlNFVCwgcmFkaXVzICk7XHJcbiAgICB9O1xyXG4gICAgcG9zaXRpb25UYWcoKTtcclxuXHJcbiAgICB0aGlzLnVwZGF0ZUxpc3RlbmVyID0gKCkgPT4ge1xyXG4gICAgICBwb3NpdGlvblRhZygpO1xyXG4gICAgICBDb25lVmlldy51cGRhdGVBcnJheXMoIGNvbmVHZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmFycmF5IGFzIEZsb2F0MzJBcnJheSwgY29uZUdlb21ldHJ5LmF0dHJpYnV0ZXMubm9ybWFsLmFycmF5IGFzIEZsb2F0MzJBcnJheSwgbnVsbCwgY29uZS5yYWRpdXNQcm9wZXJ0eS52YWx1ZSwgY29uZS5oZWlnaHRQcm9wZXJ0eS52YWx1ZSwgY29uZS5pc1ZlcnRleFVwICk7XHJcbiAgICAgIGNvbmVHZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLm5lZWRzVXBkYXRlID0gdHJ1ZTtcclxuICAgICAgY29uZUdlb21ldHJ5LmF0dHJpYnV0ZXMubm9ybWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTtcclxuICAgICAgY29uZUdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpO1xyXG4gICAgfTtcclxuICAgIHRoaXMuY29uZS5yYWRpdXNQcm9wZXJ0eS5sYXp5TGluayggdGhpcy51cGRhdGVMaXN0ZW5lciApO1xyXG4gICAgdGhpcy5jb25lLmhlaWdodFByb3BlcnR5LmxhenlMaW5rKCB0aGlzLnVwZGF0ZUxpc3RlbmVyICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZWxlYXNlcyByZWZlcmVuY2VzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jb25lLnJhZGl1c1Byb3BlcnR5LnVubGluayggdGhpcy51cGRhdGVMaXN0ZW5lciApO1xyXG4gICAgdGhpcy5jb25lLmhlaWdodFByb3BlcnR5LnVubGluayggdGhpcy51cGRhdGVMaXN0ZW5lciApO1xyXG4gICAgdGhpcy5jb25lR2VvbWV0cnkuZGlzcG9zZSgpO1xyXG5cclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZXMgcHJvdmlkZWQgZ2VvbWV0cnkgYXJyYXlzIGdpdmVuIHRoZSBzcGVjaWZpYyBzaXplLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHBvc2l0aW9uQXJyYXlcclxuICAgKiBAcGFyYW0gbm9ybWFsQXJyYXlcclxuICAgKiBAcGFyYW0gdXZBcnJheVxyXG4gICAqIEBwYXJhbSByYWRpdXNcclxuICAgKiBAcGFyYW0gaGVpZ2h0XHJcbiAgICogQHBhcmFtIGlzVmVydGV4VXBcclxuICAgKiBAcGFyYW0gb2Zmc2V0IC0gSG93IG1hbnkgdmVydGljZXMgaGF2ZSBiZWVuIHNwZWNpZmllZCBzbyBmYXI/XHJcbiAgICogQHBhcmFtIG9mZnNldFBvc2l0aW9uIC0gSG93IHRvIHRyYW5zZm9ybSBhbGwgb2YgdGhlIHBvaW50c1xyXG4gICAqIEByZXR1cm5zIC0gVGhlIG9mZnNldCBhZnRlciB0aGUgc3BlY2lmaWVkIHZlcnRpY2VzIGhhdmUgYmVlbiB3cml0dGVuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyB1cGRhdGVBcnJheXMoIHBvc2l0aW9uQXJyYXk6IEZsb2F0MzJBcnJheSB8IG51bGwsIG5vcm1hbEFycmF5OiBGbG9hdDMyQXJyYXkgfCBudWxsLCB1dkFycmF5OiBGbG9hdDMyQXJyYXkgfCBudWxsLCByYWRpdXM6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIGlzVmVydGV4VXA6IGJvb2xlYW4sIG9mZnNldCA9IDAsIG9mZnNldFBvc2l0aW9uOiBWZWN0b3IzID0gVmVjdG9yMy5aRVJPICk6IG51bWJlciB7XHJcbiAgICBjb25zdCB3cml0ZXIgPSBuZXcgVHJpYW5nbGVBcnJheVdyaXRlciggcG9zaXRpb25BcnJheSwgbm9ybWFsQXJyYXksIHV2QXJyYXksIG9mZnNldCwgb2Zmc2V0UG9zaXRpb24gKTtcclxuXHJcbiAgICBjb25zdCB2ZXJ0ZXhTaWduID0gaXNWZXJ0ZXhVcCA/IDEgOiAtMTtcclxuICAgIGNvbnN0IHZlcnRleFkgPSB2ZXJ0ZXhTaWduICogMC43NSAqIGhlaWdodDtcclxuICAgIGNvbnN0IGJhc2VZID0gLXZlcnRleFNpZ24gKiAwLjI1ICogaGVpZ2h0O1xyXG5cclxuICAgIGNvbnN0IFRXT19QSSA9IDIgKiBNYXRoLlBJO1xyXG4gICAgY29uc3QgSEFMRl9QSSA9IDAuNSAqIE1hdGguUEk7XHJcblxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgc2VnbWVudHM7IGkrKyApIHtcclxuICAgICAgY29uc3QgcmF0aW8wID0gaSAvIHNlZ21lbnRzO1xyXG4gICAgICBjb25zdCByYXRpbzEgPSAoIGkgKyAxICkgLyBzZWdtZW50cztcclxuICAgICAgY29uc3QgdGhldGEwID0gVFdPX1BJICogcmF0aW8wIC0gSEFMRl9QSTtcclxuICAgICAgY29uc3QgdGhldGExID0gVFdPX1BJICogcmF0aW8xIC0gSEFMRl9QSTtcclxuXHJcbiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW1xyXG4gICAgICAgIG5ldyBWZWN0b3IzKCAwLCB2ZXJ0ZXhZLCAwICksXHJcbiAgICAgICAgbmV3IFZlY3RvcjMoXHJcbiAgICAgICAgICByYWRpdXMgKiBNYXRoLmNvcyggaXNWZXJ0ZXhVcCA/IHRoZXRhMSA6IHRoZXRhMCApLFxyXG4gICAgICAgICAgYmFzZVksXHJcbiAgICAgICAgICByYWRpdXMgKiBNYXRoLnNpbiggaXNWZXJ0ZXhVcCA/IHRoZXRhMSA6IHRoZXRhMCApXHJcbiAgICAgICAgKSxcclxuICAgICAgICBuZXcgVmVjdG9yMyhcclxuICAgICAgICAgIHJhZGl1cyAqIE1hdGguY29zKCBpc1ZlcnRleFVwID8gdGhldGEwIDogdGhldGExICksXHJcbiAgICAgICAgICBiYXNlWSxcclxuICAgICAgICAgIHJhZGl1cyAqIE1hdGguc2luKCBpc1ZlcnRleFVwID8gdGhldGEwIDogdGhldGExIClcclxuICAgICAgICApXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBjb25zdCBub3JtYWxWZWN0b3IgPSB2ZXJ0aWNlc1sgMiBdLm1pbnVzKCB2ZXJ0aWNlc1sgMCBdICkuY3Jvc3MoIHZlcnRpY2VzWyAxIF0ubWludXMoIHZlcnRpY2VzWyAwIF0gKSApLm5vcm1hbGl6ZWQoKS5uZWdhdGVkKCk7XHJcblxyXG4gICAgICAvLyBTaWRlXHJcbiAgICAgIGZvciAoIGxldCBqID0gMDsgaiA8IHZlcnRpY2VzLmxlbmd0aDsgaisrICkge1xyXG4gICAgICAgIHdyaXRlci5wb3NpdGlvbiggdmVydGljZXNbIGogXS54LCB2ZXJ0aWNlc1sgaiBdLnksIHZlcnRpY2VzWyBqIF0ueiApO1xyXG4gICAgICAgIHdyaXRlci5ub3JtYWwoIG5vcm1hbFZlY3Rvci54LCBub3JtYWxWZWN0b3IueSwgbm9ybWFsVmVjdG9yLnogKTtcclxuICAgICAgfVxyXG4gICAgICB3cml0ZXIudXYoIDAuNSwgMCApO1xyXG4gICAgICB3cml0ZXIudXYoICggaXNWZXJ0ZXhVcCA/IHRoZXRhMSA6IHRoZXRhMCApIC8gVFdPX1BJLCAxICk7XHJcbiAgICAgIHdyaXRlci51diggKCBpc1ZlcnRleFVwID8gdGhldGEwIDogdGhldGExICkgLyBUV09fUEksIDEgKTtcclxuXHJcbiAgICAgIC8vIFRvcC9Cb3R0b21cclxuICAgICAgd3JpdGVyLnBvc2l0aW9uKCAwLCBiYXNlWSwgMCApO1xyXG4gICAgICB3cml0ZXIucG9zaXRpb24oIHZlcnRpY2VzWyAyIF0ueCwgdmVydGljZXNbIDIgXS55LCB2ZXJ0aWNlc1sgMiBdLnogKTtcclxuICAgICAgd3JpdGVyLnBvc2l0aW9uKCB2ZXJ0aWNlc1sgMSBdLngsIHZlcnRpY2VzWyAxIF0ueSwgdmVydGljZXNbIDEgXS56ICk7XHJcbiAgICAgIHdyaXRlci5ub3JtYWwoIDAsIDAsIC12ZXJ0ZXhTaWduICk7XHJcbiAgICAgIHdyaXRlci5ub3JtYWwoIDAsIDAsIC12ZXJ0ZXhTaWduICk7XHJcbiAgICAgIHdyaXRlci5ub3JtYWwoIDAsIDAsIC12ZXJ0ZXhTaWduICk7XHJcbiAgICAgIHdyaXRlci51diggMC41LCAwICk7XHJcbiAgICAgIHdyaXRlci51diggKCBpc1ZlcnRleFVwID8gdGhldGEwIDogdGhldGExICkgLyBUV09fUEksIDEgKTtcclxuICAgICAgd3JpdGVyLnV2KCAoIGlzVmVydGV4VXAgPyB0aGV0YTEgOiB0aGV0YTAgKSAvIFRXT19QSSwgMSApO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB3cml0ZXIuZ2V0T2Zmc2V0KCk7XHJcbiAgfVxyXG59XHJcblxyXG5kZW5zaXR5QnVveWFuY3lDb21tb24ucmVnaXN0ZXIoICdDb25lVmlldycsIENvbmVWaWV3ICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLG1CQUFtQixNQUFNLDhDQUE4QztBQUM5RSxPQUFPQyxxQkFBcUIsTUFBTSxnQ0FBZ0M7QUFFbEUsT0FBT0MsUUFBUSxJQUFJQyxVQUFVLFFBQVEsZUFBZTs7QUFFcEQ7QUFDQSxNQUFNQyxRQUFRLEdBQUcsRUFBRTtBQUNuQixNQUFNQyxXQUFXLEdBQUcsQ0FBQyxHQUFHRCxRQUFRO0FBRWhDLGVBQWUsTUFBTUUsUUFBUSxTQUFTSixRQUFRLENBQUM7RUFNdENLLFdBQVdBLENBQUVDLElBQVUsRUFBRztJQUUvQixNQUFNQyxhQUFhLEdBQUcsSUFBSUMsWUFBWSxDQUFFTCxXQUFXLEdBQUcsQ0FBRSxDQUFDO0lBQ3pELE1BQU1NLFdBQVcsR0FBRyxJQUFJRCxZ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