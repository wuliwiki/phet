// Copyright 2020-2022, University of Colorado Boulder

/**
 * Shows a 2d version of the model, with assorted debugging information
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Bounds2 from '../../../../dot/js/Bounds2.js';
import Matrix3 from '../../../../dot/js/Matrix3.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import ModelViewTransform2 from '../../../../phetcommon/js/view/ModelViewTransform2.js';
import { DragListener, Node, Path, Rectangle } from '../../../../scenery/js/imports.js';
import Boat from '../../buoyancy/model/Boat.js';
import densityBuoyancyCommon from '../../densityBuoyancyCommon.js';
// constants
const scratchMatrix = new Matrix3();
export default class DebugView extends Node {
  // proportional to the area at that level that is displaced in the pool

  // proportional to the volume up to that level that is displaced in the pool

  // proportional to the area at that level that is displaced in the boat

  // proportional to the volume up to that level that is displaced in the boat

  constructor(model, layoutBounds) {
    super();
    this.model = model;
    this.layoutBounds = layoutBounds;
    this.modelViewTransform = ModelViewTransform2.createSinglePointScaleInvertedYMapping(Vector2.ZERO, this.layoutBounds.center, 600);
    this.addChild(Rectangle.bounds(layoutBounds, {
      fill: 'rgba(255,255,255,0.5)'
    }));
    this.poolPath = new Path(null, {
      fill: 'rgba(0,128,255,0.5)',
      stroke: 'black'
    });
    this.addChild(this.poolPath);
    const modelPoolShape = Shape.polygon(model.groundPoints);
    const viewPoolShape = this.modelViewTransform.modelToViewShape(modelPoolShape);
    this.addChild(new Path(viewPoolShape, {
      fill: 'rgba(161,101,47,0.5)',
      stroke: 'black'
    }));
    this.massNodes = [];
    const onMassAdded = mass => {
      const massNode = new DebugMassNode(model, mass, this.modelViewTransform);
      this.addChild(massNode);
      this.massNodes.push(massNode);
    };
    model.masses.addItemAddedListener(onMassAdded);
    model.masses.forEach(onMassAdded);
    model.masses.addItemRemovedListener(mass => {
      const massNode = _.find(this.massNodes, massNode => massNode.mass === mass);
      this.removeChild(massNode);
      massNode.dispose();
    });
    this.poolAreaPath = new Path(null, {
      stroke: 'red'
    });
    this.addChild(this.poolAreaPath);
    this.poolVolumePath = new Path(null, {
      stroke: 'green'
    });
    this.addChild(this.poolVolumePath);
    this.boatAreaPath = new Path(null, {
      stroke: 'red'
    });
    this.addChild(this.boatAreaPath);
    this.boatVolumePath = new Path(null, {
      stroke: 'green'
    });
    this.addChild(this.boatVolumePath);
  }

  /**
   * Steps forward in time.
   */
  step(dt) {
    if (!this.visible) {
      return;
    }
    let poolShape = Shape.bounds(new Bounds2(this.model.poolBounds.minX, this.model.poolBounds.minY, this.model.poolBounds.maxX, this.model.pool.liquidYInterpolatedProperty.value));
    this.model.masses.forEach(mass => {
      try {
        poolShape = poolShape.shapeDifference(mass.shapeProperty.value.transformed(mass.matrix));
        if (mass instanceof Boat) {
          const multiplier = Math.pow(mass.displacementVolumeProperty.value / 0.001, 1 / 3);
          poolShape = poolShape.shapeDifference(mass.basin.oneLiterShape.transformed(Matrix3.scaling(multiplier)).transformed(mass.matrix));
        }
      } catch (e) {
        console.log(e);
      }
    });
    poolShape = this.modelViewTransform.modelToViewShape(poolShape);
    this.poolPath.shape = poolShape;
    const poolYValues = _.range(this.model.pool.stepBottom, this.model.pool.stepTop, 0.002);
    const poolAreaShape = new Shape();
    poolYValues.map(y => new Vector2(this.model.pool.getDisplacedArea(y), y)).forEach(point => {
      poolAreaShape.lineTo(this.modelViewTransform.modelToViewX(this.model.pool.bounds.maxX) + point.x * 2000, this.modelViewTransform.modelToViewY(point.y));
    });
    this.poolAreaPath.shape = poolAreaShape;
    const poolVolumeShape = new Shape();
    poolYValues.map(y => new Vector2(this.model.pool.getDisplacedVolume(y), y)).forEach(point => {
      poolVolumeShape.lineTo(this.modelViewTransform.modelToViewX(this.model.pool.bounds.maxX) + point.x * 10000, this.modelViewTransform.modelToViewY(point.y));
    });
    this.poolVolumePath.shape = poolVolumeShape;
    const boat = this.model.masses.find(mass => mass.isBoat());
    if (boat instanceof Boat) {
      const boatYValues = _.range(boat.stepBottom, boat.stepTop, 0.002);
      const boatNode = _.find(this.massNodes, massNode => massNode.mass === boat);
      const boatAreaShape = new Shape();
      boatYValues.map(y => new Vector2(boat.basin.getDisplacedArea(y), y)).forEach(point => {
        boatAreaShape.lineTo(boatNode.right + point.x * 2000, this.modelViewTransform.modelToViewY(point.y));
      });
      this.boatAreaPath.shape = boatAreaShape;
      const boatVolumeShape = new Shape();
      boatYValues.map(y => new Vector2(boat.basin.getDisplacedVolume(y), y)).forEach(point => {
        boatVolumeShape.lineTo(boatNode.right + point.x * 10000, this.modelViewTransform.modelToViewY(point.y));
      });
      this.boatVolumePath.shape = boatVolumeShape;
    } else {
      this.boatAreaPath.shape = null;
      this.boatVolumePath.shape = null;
    }
  }
}
class DebugMassNode extends Node {
  constructor(model, mass, modelViewTransform) {
    super({
      cursor: 'pointer'
    });
    const path = new Path(null, {
      fill: 'rgba(160,255,100,0.5)',
      stroke: 'black'
    });
    this.addChild(path);
    const intersectionPath = new Path(null, {
      stroke: 'black'
    });
    this.addChild(intersectionPath);
    this.mass = mass;
    const shapeListener = shape => {
      const matrix = scratchMatrix.set(modelViewTransform.getMatrix());

      // Zero out the translation
      matrix.set02(0);
      matrix.set12(0);
      if (mass instanceof Boat) {
        const multiplier = Math.pow(mass.displacementVolumeProperty.value / 0.001, 1 / 3);
        const basinShape = mass.basin.oneLiterShape.transformed(Matrix3.scaling(multiplier));
        path.shape = shape.shapeDifference(basinShape).transformed(matrix);
        intersectionPath.shape = shape.transformed(matrix);
      } else {
        path.shape = shape.transformed(matrix);
      }
    };
    mass.shapeProperty.link(shapeListener);
    this.disposeEmitter.addListener(() => {
      mass.shapeProperty.unlink(shapeListener);
    });
    const transformListener = () => {
      const viewMatrix = scratchMatrix.set(modelViewTransform.getMatrix()).multiplyMatrix(mass.matrix);
      this.translation = viewMatrix.translation;
      this.rotation = viewMatrix.rotation;
    };
    mass.transformedEmitter.addListener(transformListener);
    this.disposeEmitter.addListener(() => {
      mass.transformedEmitter.removeListener(transformListener);
    });
    transformListener();
    if (mass instanceof Boat) {
      const waterPath = new Path(null, {
        fill: 'rgba(0,128,255,0.5)',
        stroke: 'black'
      });
      this.addChild(waterPath);
      const hitPath = new Path(null, {
        stroke: 'red',
        pickable: false
      });
      this.addChild(hitPath);
      const displacementListener = volume => {
        const matrix = scratchMatrix.set(modelViewTransform.getMatrix());

        // Zero out the translation
        matrix.set02(0);
        matrix.set12(0);
        const multiplier = Math.pow(volume / 0.001, 1 / 3);
        const basinShape = mass.basin.oneLiterShape.transformed(Matrix3.scaling(multiplier));
        hitPath.shape = basinShape.transformed(matrix);
      };
      mass.displacementVolumeProperty.link(displacementListener);
      this.disposeEmitter.addListener(() => {
        mass.displacementVolumeProperty.unlink(displacementListener);
      });

      // @ts-expect-error
      const block = model.block;
      const liquidListener = () => {
        const y = mass.basin.liquidYInterpolatedProperty.value;
        if (mass.basin.liquidVolumeProperty.value > 0) {
          const matrix = scratchMatrix.set(modelViewTransform.getMatrix());

          // Zero out the translation
          matrix.set02(0);
          matrix.set12(0);
          const invertedMatrix = mass.matrix.inverted();
          const multiplier = Math.pow(mass.displacementVolumeProperty.value / 0.001, 1 / 3);
          const basinShape = mass.basin.oneLiterShape.transformed(Matrix3.scaling(multiplier));
          const rectangleShape = Shape.bounds(new Bounds2(-10, -10, 10, y)).transformed(invertedMatrix);
          let waterShape = rectangleShape.shapeIntersection(basinShape);

          // assume BuoyancyApplicationsModel
          try {
            const blockShape = block.shapeProperty.value.transformed(block.matrix).transformed(invertedMatrix);
            waterShape = waterShape.shapeDifference(blockShape);
          } catch (e) {
            console.log(e);
          }
          waterPath.shape = waterShape.transformed(matrix);
        } else {
          waterPath.shape = null;
        }
      };
      mass.basin.liquidYInterpolatedProperty.link(liquidListener);
      block.shapeProperty.lazyLink(liquidListener);
      block.transformedEmitter.addListener(liquidListener);
      this.disposeEmitter.addListener(() => {
        mass.basin.liquidYInterpolatedProperty.unlink(liquidListener);
        block.shapeProperty.unlink(liquidListener);
        block.transformedEmitter.removeListener(liquidListener);
      });
    }
    this.dragListener = new DragListener({
      transform: modelViewTransform,
      applyOffset: false,
      start: (event, listener) => {
        mass.startDrag(listener.modelPoint);
      },
      drag: (event, listener) => {
        mass.updateDrag(listener.modelPoint);
      },
      end: () => {
        mass.endDrag();
      }
    });
    this.addInputListener(this.dragListener);
  }
}
densityBuoyancyCommon.register('DebugView', DebugView);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb3VuZHMyIiwiTWF0cml4MyIsIlZlY3RvcjIiLCJTaGFwZSIsIk1vZGVsVmlld1RyYW5zZm9ybTIiLCJEcmFnTGlzdGVuZXIiLCJOb2RlIiwiUGF0aCIsIlJlY3RhbmdsZSIsIkJvYXQiLCJkZW5zaXR5QnVveWFuY3lDb21tb24iLCJzY3JhdGNoTWF0cml4IiwiRGVidWdWaWV3IiwiY29uc3RydWN0b3IiLCJtb2RlbCIsImxheW91dEJvdW5kcyIsIm1vZGVsVmlld1RyYW5zZm9ybSIsImNyZWF0ZVNpbmdsZVBvaW50U2NhbGVJbnZlcnRlZFlNYXBwaW5nIiwiWkVSTyIsImNlbnRlciIsImFkZENoaWxkIiwiYm91bmRzIiwiZmlsbCIsInBvb2xQYXRoIiwic3Ryb2tlIiwibW9kZWxQb29sU2hhcGUiLCJwb2x5Z29uIiwiZ3JvdW5kUG9pbnRzIiwidmlld1Bvb2xTaGFwZSIsIm1vZGVsVG9WaWV3U2hhcGUiLCJtYXNzTm9kZXMiLCJvbk1hc3NBZGRlZCIsIm1hc3MiLCJtYXNzTm9kZSIsIkRlYnVnTWFzc05vZGUiLCJwdXNoIiwibWFzc2VzIiwiYWRkSXRlbUFkZGVkTGlzdGVuZXIiLCJmb3JFYWNoIiwiYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciIsIl8iLCJmaW5kIiwicmVtb3ZlQ2hpbGQiLCJkaXNwb3NlIiwicG9vbEFyZWFQYXRoIiwicG9vbFZvbHVtZVBhdGgiLCJib2F0QXJlYVBhdGgiLCJib2F0Vm9sdW1lUGF0aCIsInN0ZXAiLCJkdCIsInZpc2libGUiLCJwb29sU2hhcGUiLCJwb29sQm91bmRzIiwibWluWCIsIm1pblkiLCJtYXhYIiwicG9vbCIsImxpcXVpZFlJbnRlcnBvbGF0ZWRQcm9wZXJ0eSIsInZhbHVlIiwic2hhcGVEaWZmZXJlbmNlIiwic2hhcGVQcm9wZXJ0eSIsInRyYW5zZm9ybWVkIiwibWF0cml4IiwibXVsdGlwbGllciIsIk1hdGgiLCJwb3ciLCJkaXNwbGFjZW1lbnRWb2x1bWVQcm9wZXJ0eSIsImJhc2luIiwib25lTGl0ZXJTaGFwZSIsInNjYWxpbmciLCJlIiwiY29uc29sZSIsImxvZyIsInNoYXBlIiwicG9vbFlWYWx1ZXMiLCJyYW5nZSIsInN0ZXBCb3R0b20iLCJzdGVwVG9wIiwicG9vbEFyZWFTaGFwZSIsIm1hcCIsInkiLCJnZXREaXNwbGFjZWRBcmVhIiwicG9pbnQiLCJsaW5lVG8iLCJtb2RlbFRvVmlld1giLCJ4IiwibW9kZWxUb1ZpZXdZIiwicG9vbFZvbHVtZVNoYXBlIiwiZ2V0RGlzcGxhY2VkVm9sdW1lIiwiYm9hdCIsImlzQm9hdCIsImJvYXRZVmFsdWVzIiwiYm9hdE5vZGUiLCJib2F0QXJlYVNoYXBlIiwicmlnaHQiLCJib2F0Vm9sdW1lU2hhcGUiLCJjdXJzb3IiLCJwYXRoIiwiaW50ZXJzZWN0aW9uUGF0aCIsInNoYXBlTGlzdGVuZXIiLCJzZXQiLCJnZXRNYXRyaXgiLCJzZXQwMiIsInNldDEyIiwiYmFzaW5TaGFwZSIsImxpbmsiLCJkaXNwb3NlRW1pdHRlciIsImFkZExpc3RlbmVyIiwidW5saW5rIiwidHJhbnNmb3JtTGlzdGVuZXIiLCJ2aWV3TWF0cml4IiwibXVsdGlwbHlNYXRyaXgiLCJ0cmFuc2xhdGlvbiIsInJvdGF0aW9uIiwidHJhbnNmb3JtZWRFbWl0dGVyIiwicmVtb3ZlTGlzdGVuZXIiLCJ3YXRlclBhdGgiLCJoaXRQYXRoIiwicGlja2FibGUiLCJkaXNwbGFjZW1lbnRMaXN0ZW5lciIsInZvbHVtZSIsImJsb2NrIiwibGlxdWlkTGlzdGVuZXIiLCJsaXF1aWRWb2x1bWVQcm9wZXJ0eSIsImludmVydGVkTWF0cml4IiwiaW52ZXJ0ZWQiLCJyZWN0YW5nbGVTaGFwZSIsIndhdGVyU2hhcGUiLCJzaGFwZUludGVyc2VjdGlvbiIsImJsb2NrU2hhcGUiLCJsYXp5TGluayIsImRyYWdMaXN0ZW5lciIsInRyYW5zZm9ybSIsImFwcGx5T2Zmc2V0Iiwic3RhcnQiLCJldmVudCIsImxpc3RlbmVyIiwic3RhcnREcmFnIiwibW9kZWxQb2ludCIsImRyYWciLCJ1cGRhdGVEcmFnIiwiZW5kIiwiZW5kRHJhZyIsImFkZElucHV0TGlzdGVuZXIiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkRlYnVnVmlldy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTaG93cyBhIDJkIHZlcnNpb24gb2YgdGhlIG1vZGVsLCB3aXRoIGFzc29ydGVkIGRlYnVnZ2luZyBpbmZvcm1hdGlvblxyXG4gKlxyXG4gKiBAYXV0aG9yIEpvbmF0aGFuIE9sc29uIDxqb25hdGhhbi5vbHNvbkBjb2xvcmFkby5lZHU+XHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvdW5kczIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0JvdW5kczIuanMnO1xyXG5pbXBvcnQgTWF0cml4MyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvTWF0cml4My5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgTW9kZWxWaWV3VHJhbnNmb3JtMiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qcyc7XHJcbmltcG9ydCB7IERyYWdMaXN0ZW5lciwgTm9kZSwgUGF0aCwgUmVjdGFuZ2xlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEJvYXQgZnJvbSAnLi4vLi4vYnVveWFuY3kvbW9kZWwvQm9hdC5qcyc7XHJcbmltcG9ydCBkZW5zaXR5QnVveWFuY3lDb21tb24gZnJvbSAnLi4vLi4vZGVuc2l0eUJ1b3lhbmN5Q29tbW9uLmpzJztcclxuaW1wb3J0IERlbnNpdHlCdW95YW5jeU1vZGVsIGZyb20gJy4uL21vZGVsL0RlbnNpdHlCdW95YW5jeU1vZGVsLmpzJztcclxuaW1wb3J0IE1hc3MgZnJvbSAnLi4vbW9kZWwvTWFzcy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3Qgc2NyYXRjaE1hdHJpeCA9IG5ldyBNYXRyaXgzKCk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEZWJ1Z1ZpZXcgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHJpdmF0ZSBtb2RlbDogRGVuc2l0eUJ1b3lhbmN5TW9kZWw7XHJcbiAgcHJpdmF0ZSBsYXlvdXRCb3VuZHM6IEJvdW5kczI7XHJcbiAgcHJpdmF0ZSBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTI7XHJcbiAgcHJpdmF0ZSBwb29sUGF0aDogUGF0aDtcclxuICBwcml2YXRlIG1hc3NOb2RlczogRGVidWdNYXNzTm9kZVtdO1xyXG5cclxuICAvLyBwcm9wb3J0aW9uYWwgdG8gdGhlIGFyZWEgYXQgdGhhdCBsZXZlbCB0aGF0IGlzIGRpc3BsYWNlZCBpbiB0aGUgcG9vbFxyXG4gIHByaXZhdGUgcG9vbEFyZWFQYXRoOiBQYXRoO1xyXG5cclxuICAvLyBwcm9wb3J0aW9uYWwgdG8gdGhlIHZvbHVtZSB1cCB0byB0aGF0IGxldmVsIHRoYXQgaXMgZGlzcGxhY2VkIGluIHRoZSBwb29sXHJcbiAgcHJpdmF0ZSBwb29sVm9sdW1lUGF0aDogUGF0aDtcclxuXHJcbiAgLy8gcHJvcG9ydGlvbmFsIHRvIHRoZSBhcmVhIGF0IHRoYXQgbGV2ZWwgdGhhdCBpcyBkaXNwbGFjZWQgaW4gdGhlIGJvYXRcclxuICBwcml2YXRlIGJvYXRBcmVhUGF0aDogUGF0aDtcclxuXHJcbiAgLy8gcHJvcG9ydGlvbmFsIHRvIHRoZSB2b2x1bWUgdXAgdG8gdGhhdCBsZXZlbCB0aGF0IGlzIGRpc3BsYWNlZCBpbiB0aGUgYm9hdFxyXG4gIHByaXZhdGUgYm9hdFZvbHVtZVBhdGg6IFBhdGg7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbW9kZWw6IERlbnNpdHlCdW95YW5jeU1vZGVsLCBsYXlvdXRCb3VuZHM6IEJvdW5kczIgKSB7XHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcclxuICAgIHRoaXMubGF5b3V0Qm91bmRzID0gbGF5b3V0Qm91bmRzO1xyXG4gICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0gPSBNb2RlbFZpZXdUcmFuc2Zvcm0yLmNyZWF0ZVNpbmdsZVBvaW50U2NhbGVJbnZlcnRlZFlNYXBwaW5nKCBWZWN0b3IyLlpFUk8sIHRoaXMubGF5b3V0Qm91bmRzLmNlbnRlciwgNjAwICk7XHJcblxyXG4gICAgdGhpcy5hZGRDaGlsZCggUmVjdGFuZ2xlLmJvdW5kcyggbGF5b3V0Qm91bmRzLCB7XHJcbiAgICAgIGZpbGw6ICdyZ2JhKDI1NSwyNTUsMjU1LDAuNSknXHJcbiAgICB9ICkgKTtcclxuICAgIHRoaXMucG9vbFBhdGggPSBuZXcgUGF0aCggbnVsbCwge1xyXG4gICAgICBmaWxsOiAncmdiYSgwLDEyOCwyNTUsMC41KScsXHJcbiAgICAgIHN0cm9rZTogJ2JsYWNrJ1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5wb29sUGF0aCApO1xyXG5cclxuICAgIGNvbnN0IG1vZGVsUG9vbFNoYXBlID0gU2hhcGUucG9seWdvbiggbW9kZWwuZ3JvdW5kUG9pbnRzICk7XHJcbiAgICBjb25zdCB2aWV3UG9vbFNoYXBlID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdTaGFwZSggbW9kZWxQb29sU2hhcGUgKTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBuZXcgUGF0aCggdmlld1Bvb2xTaGFwZSwge1xyXG4gICAgICBmaWxsOiAncmdiYSgxNjEsMTAxLDQ3LDAuNSknLFxyXG4gICAgICBzdHJva2U6ICdibGFjaydcclxuICAgIH0gKSApO1xyXG5cclxuICAgIHRoaXMubWFzc05vZGVzID0gW107XHJcblxyXG4gICAgY29uc3Qgb25NYXNzQWRkZWQgPSAoIG1hc3M6IE1hc3MgKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1hc3NOb2RlID0gbmV3IERlYnVnTWFzc05vZGUoIG1vZGVsLCBtYXNzLCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCBtYXNzTm9kZSApO1xyXG4gICAgICB0aGlzLm1hc3NOb2Rlcy5wdXNoKCBtYXNzTm9kZSApO1xyXG4gICAgfTtcclxuICAgIG1vZGVsLm1hc3Nlcy5hZGRJdGVtQWRkZWRMaXN0ZW5lciggb25NYXNzQWRkZWQgKTtcclxuICAgIG1vZGVsLm1hc3Nlcy5mb3JFYWNoKCBvbk1hc3NBZGRlZCApO1xyXG5cclxuICAgIG1vZGVsLm1hc3Nlcy5hZGRJdGVtUmVtb3ZlZExpc3RlbmVyKCBtYXNzID0+IHtcclxuICAgICAgY29uc3QgbWFzc05vZGUgPSBfLmZpbmQoIHRoaXMubWFzc05vZGVzLCBtYXNzTm9kZSA9PiBtYXNzTm9kZS5tYXNzID09PSBtYXNzICkhO1xyXG4gICAgICB0aGlzLnJlbW92ZUNoaWxkKCBtYXNzTm9kZSApO1xyXG4gICAgICBtYXNzTm9kZS5kaXNwb3NlKCk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5wb29sQXJlYVBhdGggPSBuZXcgUGF0aCggbnVsbCwge1xyXG4gICAgICBzdHJva2U6ICdyZWQnXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0aGlzLnBvb2xBcmVhUGF0aCApO1xyXG5cclxuICAgIHRoaXMucG9vbFZvbHVtZVBhdGggPSBuZXcgUGF0aCggbnVsbCwge1xyXG4gICAgICBzdHJva2U6ICdncmVlbidcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMucG9vbFZvbHVtZVBhdGggKTtcclxuXHJcbiAgICB0aGlzLmJvYXRBcmVhUGF0aCA9IG5ldyBQYXRoKCBudWxsLCB7XHJcbiAgICAgIHN0cm9rZTogJ3JlZCdcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuYm9hdEFyZWFQYXRoICk7XHJcblxyXG4gICAgdGhpcy5ib2F0Vm9sdW1lUGF0aCA9IG5ldyBQYXRoKCBudWxsLCB7XHJcbiAgICAgIHN0cm9rZTogJ2dyZWVuJ1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5ib2F0Vm9sdW1lUGF0aCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RlcHMgZm9yd2FyZCBpbiB0aW1lLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGVwKCBkdDogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgaWYgKCAhdGhpcy52aXNpYmxlICkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHBvb2xTaGFwZSA9IFNoYXBlLmJvdW5kcyggbmV3IEJvdW5kczIoXHJcbiAgICAgIHRoaXMubW9kZWwucG9vbEJvdW5kcy5taW5YLCB0aGlzLm1vZGVsLnBvb2xCb3VuZHMubWluWSxcclxuICAgICAgdGhpcy5tb2RlbC5wb29sQm91bmRzLm1heFgsIHRoaXMubW9kZWwucG9vbC5saXF1aWRZSW50ZXJwb2xhdGVkUHJvcGVydHkudmFsdWVcclxuICAgICkgKTtcclxuICAgIHRoaXMubW9kZWwubWFzc2VzLmZvckVhY2goIG1hc3MgPT4ge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHBvb2xTaGFwZSA9IHBvb2xTaGFwZS5zaGFwZURpZmZlcmVuY2UoIG1hc3Muc2hhcGVQcm9wZXJ0eS52YWx1ZS50cmFuc2Zvcm1lZCggbWFzcy5tYXRyaXggKSApO1xyXG4gICAgICAgIGlmICggbWFzcyBpbnN0YW5jZW9mIEJvYXQgKSB7XHJcbiAgICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gTWF0aC5wb3coIG1hc3MuZGlzcGxhY2VtZW50Vm9sdW1lUHJvcGVydHkudmFsdWUgLyAwLjAwMSwgMSAvIDMgKTtcclxuICAgICAgICAgIHBvb2xTaGFwZSA9IHBvb2xTaGFwZS5zaGFwZURpZmZlcmVuY2UoIG1hc3MuYmFzaW4ub25lTGl0ZXJTaGFwZS50cmFuc2Zvcm1lZCggTWF0cml4My5zY2FsaW5nKCBtdWx0aXBsaWVyICkgKS50cmFuc2Zvcm1lZCggbWFzcy5tYXRyaXggKSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBjYXRjaCggZSApIHtcclxuICAgICAgICBjb25zb2xlLmxvZyggZSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICBwb29sU2hhcGUgPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1NoYXBlKCBwb29sU2hhcGUgKTtcclxuICAgIHRoaXMucG9vbFBhdGguc2hhcGUgPSBwb29sU2hhcGU7XHJcblxyXG4gICAgY29uc3QgcG9vbFlWYWx1ZXMgPSBfLnJhbmdlKCB0aGlzLm1vZGVsLnBvb2wuc3RlcEJvdHRvbSwgdGhpcy5tb2RlbC5wb29sLnN0ZXBUb3AsIDAuMDAyICk7XHJcblxyXG4gICAgY29uc3QgcG9vbEFyZWFTaGFwZSA9IG5ldyBTaGFwZSgpO1xyXG4gICAgcG9vbFlWYWx1ZXMubWFwKCB5ID0+IG5ldyBWZWN0b3IyKCB0aGlzLm1vZGVsLnBvb2wuZ2V0RGlzcGxhY2VkQXJlYSggeSApLCB5ICkgKS5mb3JFYWNoKCBwb2ludCA9PiB7XHJcbiAgICAgIHBvb2xBcmVhU2hhcGUubGluZVRvKCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIHRoaXMubW9kZWwucG9vbC5ib3VuZHMubWF4WCApICsgcG9pbnQueCAqIDIwMDAsIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggcG9pbnQueSApICk7XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLnBvb2xBcmVhUGF0aC5zaGFwZSA9IHBvb2xBcmVhU2hhcGU7XHJcblxyXG4gICAgY29uc3QgcG9vbFZvbHVtZVNoYXBlID0gbmV3IFNoYXBlKCk7XHJcbiAgICBwb29sWVZhbHVlcy5tYXAoIHkgPT4gbmV3IFZlY3RvcjIoIHRoaXMubW9kZWwucG9vbC5nZXREaXNwbGFjZWRWb2x1bWUoIHkgKSwgeSApICkuZm9yRWFjaCggcG9pbnQgPT4ge1xyXG4gICAgICBwb29sVm9sdW1lU2hhcGUubGluZVRvKCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1goIHRoaXMubW9kZWwucG9vbC5ib3VuZHMubWF4WCApICsgcG9pbnQueCAqIDEwMDAwLCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1koIHBvaW50LnkgKSApO1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5wb29sVm9sdW1lUGF0aC5zaGFwZSA9IHBvb2xWb2x1bWVTaGFwZTtcclxuXHJcbiAgICBjb25zdCBib2F0ID0gdGhpcy5tb2RlbC5tYXNzZXMuZmluZCggbWFzcyA9PiBtYXNzLmlzQm9hdCgpICk7XHJcbiAgICBpZiAoIGJvYXQgaW5zdGFuY2VvZiBCb2F0ICkge1xyXG4gICAgICBjb25zdCBib2F0WVZhbHVlcyA9IF8ucmFuZ2UoIGJvYXQuc3RlcEJvdHRvbSwgYm9hdC5zdGVwVG9wLCAwLjAwMiApO1xyXG5cclxuICAgICAgY29uc3QgYm9hdE5vZGUgPSBfLmZpbmQoIHRoaXMubWFzc05vZGVzLCBtYXNzTm9kZSA9PiBtYXNzTm9kZS5tYXNzID09PSBib2F0ICkhO1xyXG5cclxuICAgICAgY29uc3QgYm9hdEFyZWFTaGFwZSA9IG5ldyBTaGFwZSgpO1xyXG4gICAgICBib2F0WVZhbHVlcy5tYXAoIHkgPT4gbmV3IFZlY3RvcjIoIGJvYXQuYmFzaW4uZ2V0RGlzcGxhY2VkQXJlYSggeSApLCB5ICkgKS5mb3JFYWNoKCBwb2ludCA9PiB7XHJcbiAgICAgICAgYm9hdEFyZWFTaGFwZS5saW5lVG8oIGJvYXROb2RlLnJpZ2h0ICsgcG9pbnQueCAqIDIwMDAsIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggcG9pbnQueSApICk7XHJcbiAgICAgIH0gKTtcclxuICAgICAgdGhpcy5ib2F0QXJlYVBhdGguc2hhcGUgPSBib2F0QXJlYVNoYXBlO1xyXG5cclxuICAgICAgY29uc3QgYm9hdFZvbHVtZVNoYXBlID0gbmV3IFNoYXBlKCk7XHJcbiAgICAgIGJvYXRZVmFsdWVzLm1hcCggeSA9PiBuZXcgVmVjdG9yMiggYm9hdC5iYXNpbi5nZXREaXNwbGFjZWRWb2x1bWUoIHkgKSwgeSApICkuZm9yRWFjaCggcG9pbnQgPT4ge1xyXG4gICAgICAgIGJvYXRWb2x1bWVTaGFwZS5saW5lVG8oIGJvYXROb2RlLnJpZ2h0ICsgcG9pbnQueCAqIDEwMDAwLCB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1koIHBvaW50LnkgKSApO1xyXG4gICAgICB9ICk7XHJcbiAgICAgIHRoaXMuYm9hdFZvbHVtZVBhdGguc2hhcGUgPSBib2F0Vm9sdW1lU2hhcGU7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5ib2F0QXJlYVBhdGguc2hhcGUgPSBudWxsO1xyXG4gICAgICB0aGlzLmJvYXRWb2x1bWVQYXRoLnNoYXBlID0gbnVsbDtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIERlYnVnTWFzc05vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IG1hc3M6IE1hc3M7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBkcmFnTGlzdGVuZXI6IERyYWdMaXN0ZW5lcjtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBtb2RlbDogRGVuc2l0eUJ1b3lhbmN5TW9kZWwsIG1hc3M6IE1hc3MsIG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMiApIHtcclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIGN1cnNvcjogJ3BvaW50ZXInXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgcGF0aCA9IG5ldyBQYXRoKCBudWxsLCB7XHJcbiAgICAgIGZpbGw6ICdyZ2JhKDE2MCwyNTUsMTAwLDAuNSknLFxyXG4gICAgICBzdHJva2U6ICdibGFjaydcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHBhdGggKTtcclxuXHJcbiAgICBjb25zdCBpbnRlcnNlY3Rpb25QYXRoID0gbmV3IFBhdGgoIG51bGwsIHtcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBpbnRlcnNlY3Rpb25QYXRoICk7XHJcblxyXG4gICAgdGhpcy5tYXNzID0gbWFzcztcclxuXHJcbiAgICBjb25zdCBzaGFwZUxpc3RlbmVyID0gKCBzaGFwZTogU2hhcGUgKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1hdHJpeCA9IHNjcmF0Y2hNYXRyaXguc2V0KCBtb2RlbFZpZXdUcmFuc2Zvcm0uZ2V0TWF0cml4KCkgKTtcclxuXHJcbiAgICAgIC8vIFplcm8gb3V0IHRoZSB0cmFuc2xhdGlvblxyXG4gICAgICBtYXRyaXguc2V0MDIoIDAgKTtcclxuICAgICAgbWF0cml4LnNldDEyKCAwICk7XHJcblxyXG4gICAgICBpZiAoIG1hc3MgaW5zdGFuY2VvZiBCb2F0ICkge1xyXG4gICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBNYXRoLnBvdyggbWFzcy5kaXNwbGFjZW1lbnRWb2x1bWVQcm9wZXJ0eS52YWx1ZSAvIDAuMDAxLCAxIC8gMyApO1xyXG4gICAgICAgIGNvbnN0IGJhc2luU2hhcGUgPSBtYXNzLmJhc2luLm9uZUxpdGVyU2hhcGUudHJhbnNmb3JtZWQoIE1hdHJpeDMuc2NhbGluZyggbXVsdGlwbGllciApICk7XHJcbiAgICAgICAgcGF0aC5zaGFwZSA9IHNoYXBlLnNoYXBlRGlmZmVyZW5jZSggYmFzaW5TaGFwZSApLnRyYW5zZm9ybWVkKCBtYXRyaXggKTtcclxuICAgICAgICBpbnRlcnNlY3Rpb25QYXRoLnNoYXBlID0gc2hhcGUudHJhbnNmb3JtZWQoIG1hdHJpeCApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHBhdGguc2hhcGUgPSBzaGFwZS50cmFuc2Zvcm1lZCggbWF0cml4ICk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBtYXNzLnNoYXBlUHJvcGVydHkubGluayggc2hhcGVMaXN0ZW5lciApO1xyXG4gICAgdGhpcy5kaXNwb3NlRW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICBtYXNzLnNoYXBlUHJvcGVydHkudW5saW5rKCBzaGFwZUxpc3RlbmVyICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgdHJhbnNmb3JtTGlzdGVuZXIgPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHZpZXdNYXRyaXggPSBzY3JhdGNoTWF0cml4LnNldCggbW9kZWxWaWV3VHJhbnNmb3JtLmdldE1hdHJpeCgpICkubXVsdGlwbHlNYXRyaXgoIG1hc3MubWF0cml4ICk7XHJcbiAgICAgIHRoaXMudHJhbnNsYXRpb24gPSB2aWV3TWF0cml4LnRyYW5zbGF0aW9uO1xyXG4gICAgICB0aGlzLnJvdGF0aW9uID0gdmlld01hdHJpeC5yb3RhdGlvbjtcclxuICAgIH07XHJcbiAgICBtYXNzLnRyYW5zZm9ybWVkRW1pdHRlci5hZGRMaXN0ZW5lciggdHJhbnNmb3JtTGlzdGVuZXIgKTtcclxuICAgIHRoaXMuZGlzcG9zZUVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgICAgbWFzcy50cmFuc2Zvcm1lZEVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoIHRyYW5zZm9ybUxpc3RlbmVyICk7XHJcbiAgICB9ICk7XHJcbiAgICB0cmFuc2Zvcm1MaXN0ZW5lcigpO1xyXG5cclxuICAgIGlmICggbWFzcyBpbnN0YW5jZW9mIEJvYXQgKSB7XHJcbiAgICAgIGNvbnN0IHdhdGVyUGF0aCA9IG5ldyBQYXRoKCBudWxsLCB7XHJcbiAgICAgICAgZmlsbDogJ3JnYmEoMCwxMjgsMjU1LDAuNSknLFxyXG4gICAgICAgIHN0cm9rZTogJ2JsYWNrJ1xyXG4gICAgICB9ICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIHdhdGVyUGF0aCApO1xyXG5cclxuICAgICAgY29uc3QgaGl0UGF0aCA9IG5ldyBQYXRoKCBudWxsLCB7XHJcbiAgICAgICAgc3Ryb2tlOiAncmVkJyxcclxuICAgICAgICBwaWNrYWJsZTogZmFsc2VcclxuICAgICAgfSApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCBoaXRQYXRoICk7XHJcblxyXG4gICAgICBjb25zdCBkaXNwbGFjZW1lbnRMaXN0ZW5lciA9ICggdm9sdW1lOiBudW1iZXIgKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbWF0cml4ID0gc2NyYXRjaE1hdHJpeC5zZXQoIG1vZGVsVmlld1RyYW5zZm9ybS5nZXRNYXRyaXgoKSApO1xyXG5cclxuICAgICAgICAvLyBaZXJvIG91dCB0aGUgdHJhbnNsYXRpb25cclxuICAgICAgICBtYXRyaXguc2V0MDIoIDAgKTtcclxuICAgICAgICBtYXRyaXguc2V0MTIoIDAgKTtcclxuXHJcbiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGgucG93KCB2b2x1bWUgLyAwLjAwMSwgMSAvIDMgKTtcclxuICAgICAgICBjb25zdCBiYXNpblNoYXBlID0gbWFzcy5iYXNpbi5vbmVMaXRlclNoYXBlLnRyYW5zZm9ybWVkKCBNYXRyaXgzLnNjYWxpbmcoIG11bHRpcGxpZXIgKSApO1xyXG5cclxuICAgICAgICBoaXRQYXRoLnNoYXBlID0gYmFzaW5TaGFwZS50cmFuc2Zvcm1lZCggbWF0cml4ICk7XHJcbiAgICAgIH07XHJcbiAgICAgIG1hc3MuZGlzcGxhY2VtZW50Vm9sdW1lUHJvcGVydHkubGluayggZGlzcGxhY2VtZW50TGlzdGVuZXIgKTtcclxuICAgICAgdGhpcy5kaXNwb3NlRW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICAgIG1hc3MuZGlzcGxhY2VtZW50Vm9sdW1lUHJvcGVydHkudW5saW5rKCBkaXNwbGFjZW1lbnRMaXN0ZW5lciApO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXHJcbiAgICAgIGNvbnN0IGJsb2NrID0gbW9kZWwuYmxvY2s7XHJcbiAgICAgIGNvbnN0IGxpcXVpZExpc3RlbmVyID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHkgPSBtYXNzLmJhc2luLmxpcXVpZFlJbnRlcnBvbGF0ZWRQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICAgICAgaWYgKCBtYXNzLmJhc2luLmxpcXVpZFZvbHVtZVByb3BlcnR5LnZhbHVlID4gMCApIHtcclxuICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IHNjcmF0Y2hNYXRyaXguc2V0KCBtb2RlbFZpZXdUcmFuc2Zvcm0uZ2V0TWF0cml4KCkgKTtcclxuXHJcbiAgICAgICAgICAvLyBaZXJvIG91dCB0aGUgdHJhbnNsYXRpb25cclxuICAgICAgICAgIG1hdHJpeC5zZXQwMiggMCApO1xyXG4gICAgICAgICAgbWF0cml4LnNldDEyKCAwICk7XHJcblxyXG4gICAgICAgICAgY29uc3QgaW52ZXJ0ZWRNYXRyaXggPSBtYXNzLm1hdHJpeC5pbnZlcnRlZCgpO1xyXG5cclxuICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBNYXRoLnBvdyggbWFzcy5kaXNwbGFjZW1lbnRWb2x1bWVQcm9wZXJ0eS52YWx1ZSAvIDAuMDAxLCAxIC8gMyApO1xyXG4gICAgICAgICAgY29uc3QgYmFzaW5TaGFwZSA9IG1hc3MuYmFzaW4ub25lTGl0ZXJTaGFwZS50cmFuc2Zvcm1lZCggTWF0cml4My5zY2FsaW5nKCBtdWx0aXBsaWVyICkgKTtcclxuICAgICAgICAgIGNvbnN0IHJlY3RhbmdsZVNoYXBlID0gU2hhcGUuYm91bmRzKCBuZXcgQm91bmRzMiggLTEwLCAtMTAsIDEwLCB5ICkgKS50cmFuc2Zvcm1lZCggaW52ZXJ0ZWRNYXRyaXggKTtcclxuXHJcbiAgICAgICAgICBsZXQgd2F0ZXJTaGFwZSA9IHJlY3RhbmdsZVNoYXBlLnNoYXBlSW50ZXJzZWN0aW9uKCBiYXNpblNoYXBlICk7XHJcblxyXG4gICAgICAgICAgLy8gYXNzdW1lIEJ1b3lhbmN5QXBwbGljYXRpb25zTW9kZWxcclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJsb2NrU2hhcGUgPSBibG9jay5zaGFwZVByb3BlcnR5LnZhbHVlLnRyYW5zZm9ybWVkKCBibG9jay5tYXRyaXggKS50cmFuc2Zvcm1lZCggaW52ZXJ0ZWRNYXRyaXggKTtcclxuICAgICAgICAgICAgd2F0ZXJTaGFwZSA9IHdhdGVyU2hhcGUuc2hhcGVEaWZmZXJlbmNlKCBibG9ja1NoYXBlICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjYXRjaCggZSApIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coIGUgKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB3YXRlclBhdGguc2hhcGUgPSB3YXRlclNoYXBlLnRyYW5zZm9ybWVkKCBtYXRyaXggKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICB3YXRlclBhdGguc2hhcGUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgbWFzcy5iYXNpbi5saXF1aWRZSW50ZXJwb2xhdGVkUHJvcGVydHkubGluayggbGlxdWlkTGlzdGVuZXIgKTtcclxuICAgICAgYmxvY2suc2hhcGVQcm9wZXJ0eS5sYXp5TGluayggbGlxdWlkTGlzdGVuZXIgKTtcclxuICAgICAgYmxvY2sudHJhbnNmb3JtZWRFbWl0dGVyLmFkZExpc3RlbmVyKCBsaXF1aWRMaXN0ZW5lciApO1xyXG4gICAgICB0aGlzLmRpc3Bvc2VFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgICAgbWFzcy5iYXNpbi5saXF1aWRZSW50ZXJwb2xhdGVkUHJvcGVydHkudW5saW5rKCBsaXF1aWRMaXN0ZW5lciApO1xyXG4gICAgICAgIGJsb2NrLnNoYXBlUHJvcGVydHkudW5saW5rKCBsaXF1aWRMaXN0ZW5lciApO1xyXG4gICAgICAgIGJsb2NrLnRyYW5zZm9ybWVkRW1pdHRlci5yZW1vdmVMaXN0ZW5lciggbGlxdWlkTGlzdGVuZXIgKTtcclxuICAgICAgfSApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZHJhZ0xpc3RlbmVyID0gbmV3IERyYWdMaXN0ZW5lcigge1xyXG4gICAgICB0cmFuc2Zvcm06IG1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgYXBwbHlPZmZzZXQ6IGZhbHNlLFxyXG4gICAgICBzdGFydDogKCBldmVudCwgbGlzdGVuZXIgKSA9PiB7XHJcbiAgICAgICAgbWFzcy5zdGFydERyYWcoIGxpc3RlbmVyLm1vZGVsUG9pbnQgKTtcclxuICAgICAgfSxcclxuICAgICAgZHJhZzogKCBldmVudCwgbGlzdGVuZXIgKSA9PiB7XHJcbiAgICAgICAgbWFzcy51cGRhdGVEcmFnKCBsaXN0ZW5lci5tb2RlbFBvaW50ICk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGVuZDogKCkgPT4ge1xyXG4gICAgICAgIG1hc3MuZW5kRHJhZygpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZElucHV0TGlzdGVuZXIoIHRoaXMuZHJhZ0xpc3RlbmVyICk7XHJcbiAgfVxyXG59XHJcblxyXG5kZW5zaXR5QnVveWFuY3lDb21tb24ucmVnaXN0ZXIoICdEZWJ1Z1ZpZXcnLCBEZWJ1Z1ZpZXcgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDdEQsT0FBT0MsbUJBQW1CLE1BQU0sdURBQXVEO0FBQ3ZGLFNBQVNDLFlBQVksRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLFNBQVMsUUFBUSxtQ0FBbUM7QUFDdkYsT0FBT0MsSUFBSSxNQUFNLDhCQUE4QjtBQUMvQyxPQUFPQyxxQkFBcUIsTUFBTSxnQ0FBZ0M7QUFJbEU7QUFDQSxNQUFNQyxhQUFhLEdBQUcsSUFBSVYsT0FBTyxDQUFDLENBQUM7QUFFbkMsZUFBZSxNQUFNVyxTQUFTLFNBQVNOLElBQUksQ0FBQztFQVExQzs7RUFHQTs7RUFHQTs7RUFHQTs7RUFHT08sV0FBV0EsQ0FBRUMsS0FB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