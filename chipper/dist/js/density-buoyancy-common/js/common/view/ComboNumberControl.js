// Copyright 2019-2022, University of Colorado Boulder

/**
 * Handles controlling a quantity with a NumberControl, but combined with a ComboBox for specific non-custom values.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Property from '../../../../axon/js/Property.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import Range from '../../../../dot/js/Range.js';
import optionize, { combineOptions } from '../../../../phet-core/js/optionize.js';
import PatternStringProperty from '../../../../axon/js/PatternStringProperty.js';
import NumberControl from '../../../../scenery-phet/js/NumberControl.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Node, Text, VBox } from '../../../../scenery/js/imports.js';
import ComboBox from '../../../../sun/js/ComboBox.js';
import SunConstants from '../../../../sun/js/SunConstants.js';
import densityBuoyancyCommon from '../../densityBuoyancyCommon.js';
import DensityBuoyancyCommonConstants from '../DensityBuoyancyCommonConstants.js';
export default class ComboNumberControl extends VBox {
  constructor(providedConfig) {
    const disposalCallbacks = [];
    const numberDisplayVisibleProperty = new BooleanProperty(true);
    const config = optionize()({
      getFallbackNode: () => null,
      // {Object} Options for the number control
      numberControlOptions: {
        layoutFunction: NumberControl.createLayoutFunction4({
          createBottomContent: bottomBox => {
            const fallbackContainer = new Node();

            // Supports Pendulum Lab's questionText where a question is substituted for the slider
            const bottomContent = new Node({
              children: [bottomBox, fallbackContainer]
            });
            const listener = value => {
              const fallbackNode = getFallbackNode(value);
              const hasFallback = fallbackNode !== null;
              bottomBox.visible = !hasFallback;
              numberDisplayVisibleProperty.value = !hasFallback;
              fallbackContainer.removeAllChildren();
              if (fallbackNode !== null) {
                fallbackContainer.addChild(fallbackNode);
                fallbackNode.maxWidth = bottomBox.width;
                fallbackNode.center = bottomBox.center;
              }
            };

            // This instance lives for the lifetime of the simulation, so we don't need to remove this listener
            this.property.link(listener);
            disposalCallbacks.push(() => this.property.unlink(listener));
            return bottomContent;
          },
          sliderPadding: 5
        }),
        titleNodeOptions: {
          font: DensityBuoyancyCommonConstants.TITLE_FONT,
          maxWidth: 120
        },
        numberDisplayOptions: {
          textOptions: {
            font: DensityBuoyancyCommonConstants.READOUT_FONT
          },
          valuePattern: new PatternStringProperty(providedConfig.valuePatternProperty, {
            value: SunConstants.VALUE_NAMED_PLACEHOLDER
          }),
          maxWidth: 100,
          decimalPlaces: 2,
          useRichText: true,
          useFullHeight: true,
          visibleProperty: numberDisplayVisibleProperty
        },
        arrowButtonOptions: {
          scale: 0.56
        },
        sliderOptions: {
          majorTickLength: 5,
          thumbSize: DensityBuoyancyCommonConstants.THUMB_SIZE,
          thumbTouchAreaXDilation: 5,
          thumbTouchAreaYDilation: 4,
          majorTicks: [{
            value: providedConfig.range.min,
            label: new Text(providedConfig.range.min, {
              font: new PhetFont(12),
              maxWidth: 50
            })
          }, {
            value: providedConfig.range.max,
            label: new Text(providedConfig.range.max, {
              font: new PhetFont(12),
              maxWidth: 50
            })
          }],
          trackSize: new Dimension2(120, 0.5)
        }
      },
      // {Object} Options for the combo box
      comboBoxOptions: {
        cornerRadius: 3,
        xMargin: 13,
        yMargin: 5
      },
      // VBox options
      spacing: 10,
      align: 'center'
    }, providedConfig);
    assert && assert(!config.children, 'Children should not be specified for ComboNumberControl');
    assert && assert(config.property instanceof Property);
    assert && assert(config.range instanceof Range);
    assert && assert(typeof config.toNumericValue === 'function');
    assert && assert(typeof config.createCustomValue === 'function');
    assert && assert(typeof config.isCustomValue === 'function');
    assert && assert(config.listParent instanceof Node);
    assert && assert(Array.isArray(config.comboItems));
    assert && assert(config.customValue);
    const getFallbackNode = config.getFallbackNode;
    super();
    const getNumericValue = value => config.toNumericValue(value);
    const getComboValue = value => config.isCustomValue(value) ? config.customValue : value;
    this.property = config.property;
    this.numberProperty = new NumberProperty(getNumericValue(this.property.value));
    this.comboProperty = new Property(getComboValue(this.property.value));
    this.disposalCallbacks = disposalCallbacks;

    // This instance lives for the lifetime of the simulation, so we don't need to remove this listener
    // Track the last non-hidden value, so that if we go to CUSTOM, we'll use this (and not just show the hidden value,
    // see https://github.com/phetsims/buoyancy/issues/54
    let lastNonHiddenValue = this.property.value;
    this.property.link(value => {
      if (!config.isHiddenValue(value)) {
        lastNonHiddenValue = value;
      }
    });
    let locked = false;

    // This instance lives for the lifetime of the simulation, so we don't need to remove this listener
    this.property.lazyLink(value => {
      if (!locked) {
        locked = true;
        this.numberProperty.value = getNumericValue(value);
        this.comboProperty.value = getComboValue(value);
        locked = false;
      }
    });
    // This instance lives for the lifetime of the simulation, so we don't need to remove this listener
    this.numberProperty.lazyLink(value => {
      if (!locked) {
        locked = true;
        this.property.value = config.createCustomValue(value);
        this.comboProperty.value = config.customValue;
        locked = false;
      }
    });
    // This instance lives for the lifetime of the simulation, so we don't need to remove this listener
    this.comboProperty.lazyLink(value => {
      if (!locked) {
        locked = true;
        if (config.isCustomValue(value)) {
          // We'll swap to the last non-hidden value (and make it custom). This is so that we don't immediately show a
          // "hidden" previous value (e.g. DENSITY_A) and the students have to guess it.
          // See https://github.com/phetsims/buoyancy/issues/54
          const newValue = getNumericValue(lastNonHiddenValue);
          this.property.value = config.createCustomValue(newValue);
          this.numberProperty.value = newValue;
        } else {
          this.property.value = value;
          this.numberProperty.value = getNumericValue(value);
        }
        locked = false;
      }
    });
    const numberControlTandem = config.tandem.createTandem('numberControl');
    this.numberControl = new NumberControl(config.titleProperty, this.numberProperty, config.range, combineOptions({
      tandem: numberControlTandem
    }, config.numberControlOptions));
    this.numberControl.addLinkedElement(this.property, {
      tandem: numberControlTandem.createTandem('valueProperty')
    });
    this.comboBox = new ComboBox(this.comboProperty, config.comboItems, config.listParent, config.comboBoxOptions);
    config.children = [this.numberControl, this.comboBox];
    this.mutate(config);
  }

  /**
   * Releases references.
   */
  dispose() {
    this.numberControl.dispose();
    this.comboBox.dispose();
    this.numberProperty.dispose();
    this.comboProperty.dispose();
    this.disposalCallbacks.forEach(callback => callback());
    super.dispose();
  }
}
densityBuoyancyCommon.register('ComboNumberControl', ComboNumberControl);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIlByb3BlcnR5IiwiRGltZW5zaW9uMiIsIlJhbmdlIiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJQYXR0ZXJuU3RyaW5nUHJvcGVydHkiLCJOdW1iZXJDb250cm9sIiwiUGhldEZvbnQiLCJOb2RlIiwiVGV4dCIsIlZCb3giLCJDb21ib0JveCIsIlN1bkNvbnN0YW50cyIsImRlbnNpdHlCdW95YW5jeUNvbW1vbiIsIkRlbnNpdHlCdW95YW5jeUNvbW1vbkNvbnN0YW50cyIsIkNvbWJvTnVtYmVyQ29udHJvbCIsImNvbnN0cnVjdG9yIiwicHJvdmlkZWRDb25maWciLCJkaXNwb3NhbENhbGxiYWNrcyIsIm51bWJlckRpc3BsYXlWaXNpYmxlUHJvcGVydHkiLCJjb25maWciLCJnZXRGYWxsYmFja05vZGUiLCJudW1iZXJDb250cm9sT3B0aW9ucyIsImxheW91dEZ1bmN0aW9uIiwiY3JlYXRlTGF5b3V0RnVuY3Rpb240IiwiY3JlYXRlQm90dG9tQ29udGVudCIsImJvdHRvbUJveCIsImZhbGxiYWNrQ29udGFpbmVyIiwiYm90dG9tQ29udGVudCIsImNoaWxkcmVuIiwibGlzdGVuZXIiLCJ2YWx1ZSIsImZhbGxiYWNrTm9kZSIsImhhc0ZhbGxiYWNrIiwidmlzaWJsZSIsInJlbW92ZUFsbENoaWxkcmVuIiwiYWRkQ2hpbGQiLCJtYXhXaWR0aCIsIndpZHRoIiwiY2VudGVyIiwicHJvcGVydHkiLCJsaW5rIiwicHVzaCIsInVubGluayIsInNsaWRlclBhZGRpbmciLCJ0aXRsZU5vZGVPcHRpb25zIiwiZm9udCIsIlRJVExFX0ZPTlQiLCJudW1iZXJEaXNwbGF5T3B0aW9ucyIsInRleHRPcHRpb25zIiwiUkVBRE9VVF9GT05UIiwidmFsdWVQYXR0ZXJuIiwidmFsdWVQYXR0ZXJuUHJvcGVydHkiLCJWQUxVRV9OQU1FRF9QTEFDRUhPTERFUiIsImRlY2ltYWxQbGFjZXMiLCJ1c2VSaWNoVGV4dCIsInVzZUZ1bGxIZWlnaHQiLCJ2aXNpYmxlUHJvcGVydHkiLCJhcnJvd0J1dHRvbk9wdGlvbnMiLCJzY2FsZSIsInNsaWRlck9wdGlvbnMiLCJtYWpvclRpY2tMZW5ndGgiLCJ0aHVtYlNpemUiLCJUSFVNQl9TSVpFIiwidGh1bWJUb3VjaEFyZWFYRGlsYXRpb24iLCJ0aHVtYlRvdWNoQXJlYVlEaWxhdGlvbiIsIm1ham9yVGlja3MiLCJyYW5nZSIsIm1pbiIsImxhYmVsIiwibWF4IiwidHJhY2tTaXplIiwiY29tYm9Cb3hPcHRpb25zIiwiY29ybmVyUmFkaXVzIiwieE1hcmdpbiIsInlNYXJnaW4iLCJzcGFjaW5nIiwiYWxpZ24iLCJhc3NlcnQiLCJ0b051bWVyaWNWYWx1ZSIsImNyZWF0ZUN1c3RvbVZhbHVlIiwiaXNDdXN0b21WYWx1ZSIsImxpc3RQYXJlbnQiLCJBcnJheSIsImlzQXJyYXkiLCJjb21ib0l0ZW1zIiwiY3VzdG9tVmFsdWUiLCJnZXROdW1lcmljVmFsdWUiLCJnZXRDb21ib1ZhbHVlIiwibnVtYmVyUHJvcGVydHkiLCJjb21ib1Byb3BlcnR5IiwibGFzdE5vbkhpZGRlblZhbHVlIiwiaXNIaWRkZW5WYWx1ZSIsImxvY2tlZCIsImxhenlMaW5rIiwibmV3VmFsdWUiLCJudW1iZXJDb250cm9sVGFuZGVtIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwibnVtYmVyQ29udHJvbCIsInRpdGxlUHJvcGVydHkiLCJhZGRMaW5rZWRFbGVtZW50IiwiY29tYm9Cb3giLCJtdXRhdGUiLCJkaXNwb3NlIiwiZm9yRWFjaCIsImNhbGxiYWNrIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJDb21ib051bWJlckNvbnRyb2wudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogSGFuZGxlcyBjb250cm9sbGluZyBhIHF1YW50aXR5IHdpdGggYSBOdW1iZXJDb250cm9sLCBidXQgY29tYmluZWQgd2l0aCBhIENvbWJvQm94IGZvciBzcGVjaWZpYyBub24tY3VzdG9tIHZhbHVlcy5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBQYXR0ZXJuU3RyaW5nUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9QYXR0ZXJuU3RyaW5nUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTnVtYmVyQ29udHJvbCwgeyBOdW1iZXJDb250cm9sT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9OdW1iZXJDb250cm9sLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIFRleHQsIFZCb3gsIFZCb3hPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IENvbWJvQm94LCB7IENvbWJvQm94SXRlbSwgQ29tYm9Cb3hPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL0NvbWJvQm94LmpzJztcclxuaW1wb3J0IFN1bkNvbnN0YW50cyBmcm9tICcuLi8uLi8uLi8uLi9zdW4vanMvU3VuQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IGRlbnNpdHlCdW95YW5jeUNvbW1vbiBmcm9tICcuLi8uLi9kZW5zaXR5QnVveWFuY3lDb21tb24uanMnO1xyXG5pbXBvcnQgRGVuc2l0eUJ1b3lhbmN5Q29tbW9uQ29uc3RhbnRzIGZyb20gJy4uL0RlbnNpdHlCdW95YW5jeUNvbW1vbkNvbnN0YW50cy5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zPFQ+ID0ge1xyXG4gIHRpdGxlUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz47XHJcbiAgdmFsdWVQYXR0ZXJuUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz47IC8vIHdpdGgge3t2YWx1ZX19IHBsYWNlaG9sZGVyXHJcbiAgcHJvcGVydHk6IFByb3BlcnR5PFQ+O1xyXG4gIHJhbmdlOiBSYW5nZTtcclxuXHJcbiAgLy8gQ29udmVydHMgdGhlIFByb3BlcnR5IHZhbHVlcyBpbnRvIG51bWVyaWMgdmFsdWVzXHJcbiAgdG9OdW1lcmljVmFsdWU6ICggdDogVCApID0+IG51bWJlcjtcclxuXHJcbiAgLy8gR2l2ZW4gYSBudW1lcmljIHZhbHVlLCBjcmVhdGVzIHRoZSBjb3JyZXNwb25kaW5nIHJpY2ggb2JqZWN0XHJcbiAgY3JlYXRlQ3VzdG9tVmFsdWU6ICggbjogbnVtYmVyICkgPT4gVDtcclxuXHJcbiAgLy8gR2l2ZW4gYSBtYWluIHZhbHVlLCByZXR1cm5zIHdoZXRoZXIgaXQgaXMgYSBjdXN0b20gdmFsdWUgb3Igbm90XHJcbiAgaXNDdXN0b21WYWx1ZTogKCB0OiBUICkgPT4gYm9vbGVhbjtcclxuXHJcbiAgLy8gR2l2ZW4gYSBtYWluIHZhbHVlLCByZXR1cm5zIHdoZXRoZXIgaXQgaXMgYSBoaWRkZW4gdmFsdWUgb3Igbm90XHJcbiAgaXNIaWRkZW5WYWx1ZTogKCB0OiBUICkgPT4gYm9vbGVhbjtcclxuXHJcbiAgbGlzdFBhcmVudDogTm9kZTtcclxuXHJcbiAgY29tYm9JdGVtczogQ29tYm9Cb3hJdGVtPFQ+W107XHJcblxyXG4gIC8vIFRoZSB0b2tlbiB2YWx1ZSBpbiBpdGVtcyB0aGF0IGlzIHRoZSBkZXNpZ25hdGVkIGN1c3RvbSB2YWx1ZVxyXG4gIGN1c3RvbVZhbHVlOiBUO1xyXG5cclxuICBnZXRGYWxsYmFja05vZGU/OiAoIHQ6IFQgKSA9PiBOb2RlIHwgbnVsbDtcclxuXHJcbiAgbnVtYmVyQ29udHJvbE9wdGlvbnM/OiBOdW1iZXJDb250cm9sT3B0aW9ucztcclxuICBjb21ib0JveE9wdGlvbnM/OiBDb21ib0JveE9wdGlvbnM7XHJcblxyXG4gIHRhbmRlbTogVGFuZGVtO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgQ29tYm9OdW1iZXJDb250cm9sT3B0aW9uczxUPiA9IFNlbGZPcHRpb25zPFQ+ICYgVkJveE9wdGlvbnM7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb21ib051bWJlckNvbnRyb2w8VD4gZXh0ZW5kcyBWQm94IHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBwcm9wZXJ0eTogUHJvcGVydHk8VD47XHJcbiAgcHJpdmF0ZSByZWFkb25seSBudW1iZXJQcm9wZXJ0eTogUHJvcGVydHk8bnVtYmVyPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNvbWJvUHJvcGVydHk6IFByb3BlcnR5PFQ+O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zYWxDYWxsYmFja3M6ICggKCkgPT4gdm9pZCApW107XHJcbiAgcHJpdmF0ZSByZWFkb25seSBudW1iZXJDb250cm9sOiBOdW1iZXJDb250cm9sO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY29tYm9Cb3g6IENvbWJvQm94PFQ+O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb3ZpZGVkQ29uZmlnOiBTZWxmT3B0aW9uczxUPiApIHtcclxuXHJcbiAgICBjb25zdCBkaXNwb3NhbENhbGxiYWNrczogKCAoKSA9PiB2b2lkIClbXSA9IFtdO1xyXG4gICAgY29uc3QgbnVtYmVyRGlzcGxheVZpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUgKTtcclxuXHJcbiAgICBjb25zdCBjb25maWcgPSBvcHRpb25pemU8Q29tYm9OdW1iZXJDb250cm9sT3B0aW9uczxUPiwgU2VsZk9wdGlvbnM8VD4sIFZCb3hPcHRpb25zPigpKCB7XHJcbiAgICAgIGdldEZhbGxiYWNrTm9kZTogKCkgPT4gbnVsbCxcclxuXHJcbiAgICAgIC8vIHtPYmplY3R9IE9wdGlvbnMgZm9yIHRoZSBudW1iZXIgY29udHJvbFxyXG4gICAgICBudW1iZXJDb250cm9sT3B0aW9uczoge1xyXG4gICAgICAgIGxheW91dEZ1bmN0aW9uOiBOdW1iZXJDb250cm9sLmNyZWF0ZUxheW91dEZ1bmN0aW9uNCgge1xyXG4gICAgICAgICAgY3JlYXRlQm90dG9tQ29udGVudDogYm90dG9tQm94ID0+IHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGZhbGxiYWNrQ29udGFpbmVyID0gbmV3IE5vZGUoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFN1cHBvcnRzIFBlbmR1bHVtIExhYidzIHF1ZXN0aW9uVGV4dCB3aGVyZSBhIHF1ZXN0aW9uIGlzIHN1YnN0aXR1dGVkIGZvciB0aGUgc2xpZGVyXHJcbiAgICAgICAgICAgIGNvbnN0IGJvdHRvbUNvbnRlbnQgPSBuZXcgTm9kZSgge1xyXG4gICAgICAgICAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgICAgICAgICBib3R0b21Cb3gsXHJcbiAgICAgICAgICAgICAgICBmYWxsYmFja0NvbnRhaW5lclxyXG4gICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfSApO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbGlzdGVuZXIgPSAoIHZhbHVlOiBUICkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGZhbGxiYWNrTm9kZSA9IGdldEZhbGxiYWNrTm9kZSggdmFsdWUgKTtcclxuICAgICAgICAgICAgICBjb25zdCBoYXNGYWxsYmFjayA9IGZhbGxiYWNrTm9kZSAhPT0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgYm90dG9tQm94LnZpc2libGUgPSAhaGFzRmFsbGJhY2s7XHJcbiAgICAgICAgICAgICAgbnVtYmVyRGlzcGxheVZpc2libGVQcm9wZXJ0eS52YWx1ZSA9ICFoYXNGYWxsYmFjaztcclxuICAgICAgICAgICAgICBmYWxsYmFja0NvbnRhaW5lci5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG5cclxuICAgICAgICAgICAgICBpZiAoIGZhbGxiYWNrTm9kZSAhPT0gbnVsbCApIHtcclxuICAgICAgICAgICAgICAgIGZhbGxiYWNrQ29udGFpbmVyLmFkZENoaWxkKCBmYWxsYmFja05vZGUgKTtcclxuICAgICAgICAgICAgICAgIGZhbGxiYWNrTm9kZS5tYXhXaWR0aCA9IGJvdHRvbUJveC53aWR0aDtcclxuICAgICAgICAgICAgICAgIGZhbGxiYWNrTm9kZS5jZW50ZXIgPSBib3R0b21Cb3guY2VudGVyO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIC8vIFRoaXMgaW5zdGFuY2UgbGl2ZXMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltdWxhdGlvbiwgc28gd2UgZG9uJ3QgbmVlZCB0byByZW1vdmUgdGhpcyBsaXN0ZW5lclxyXG4gICAgICAgICAgICB0aGlzLnByb3BlcnR5LmxpbmsoIGxpc3RlbmVyICk7XHJcbiAgICAgICAgICAgIGRpc3Bvc2FsQ2FsbGJhY2tzLnB1c2goICgpID0+IHRoaXMucHJvcGVydHkudW5saW5rKCBsaXN0ZW5lciApICk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYm90dG9tQ29udGVudDtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBzbGlkZXJQYWRkaW5nOiA1XHJcbiAgICAgICAgfSApLFxyXG4gICAgICAgIHRpdGxlTm9kZU9wdGlvbnM6IHtcclxuICAgICAgICAgIGZvbnQ6IERlbnNpdHlCdW95YW5jeUNvbW1vbkNvbnN0YW50cy5USVRMRV9GT05ULFxyXG4gICAgICAgICAgbWF4V2lkdGg6IDEyMFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbnVtYmVyRGlzcGxheU9wdGlvbnM6IHtcclxuICAgICAgICAgIHRleHRPcHRpb25zOiB7XHJcbiAgICAgICAgICAgIGZvbnQ6IERlbnNpdHlCdW95YW5jeUNvbW1vbkNvbnN0YW50cy5SRUFET1VUX0ZPTlRcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB2YWx1ZVBhdHRlcm46IG5ldyBQYXR0ZXJuU3RyaW5nUHJvcGVydHkoIHByb3ZpZGVkQ29uZmlnLnZhbHVlUGF0dGVyblByb3BlcnR5LCB7XHJcbiAgICAgICAgICAgIHZhbHVlOiBTdW5Db25zdGFudHMuVkFMVUVfTkFNRURfUExBQ0VIT0xERVJcclxuICAgICAgICAgIH0gKSxcclxuICAgICAgICAgIG1heFdpZHRoOiAxMDAsXHJcbiAgICAgICAgICBkZWNpbWFsUGxhY2VzOiAyLFxyXG4gICAgICAgICAgdXNlUmljaFRleHQ6IHRydWUsXHJcbiAgICAgICAgICB1c2VGdWxsSGVpZ2h0OiB0cnVlLFxyXG4gICAgICAgICAgdmlzaWJsZVByb3BlcnR5OiBudW1iZXJEaXNwbGF5VmlzaWJsZVByb3BlcnR5XHJcbiAgICAgICAgfSxcclxuICAgICAgICBhcnJvd0J1dHRvbk9wdGlvbnM6IHsgc2NhbGU6IDAuNTYgfSxcclxuXHJcbiAgICAgICAgc2xpZGVyT3B0aW9uczoge1xyXG4gICAgICAgICAgbWFqb3JUaWNrTGVuZ3RoOiA1LFxyXG4gICAgICAgICAgdGh1bWJTaXplOiBEZW5zaXR5QnVveWFuY3lDb21tb25Db25zdGFudHMuVEhVTUJfU0laRSxcclxuICAgICAgICAgIHRodW1iVG91Y2hBcmVhWERpbGF0aW9uOiA1LFxyXG4gICAgICAgICAgdGh1bWJUb3VjaEFyZWFZRGlsYXRpb246IDQsXHJcbiAgICAgICAgICBtYWpvclRpY2tzOiBbIHtcclxuICAgICAgICAgICAgdmFsdWU6IHByb3ZpZGVkQ29uZmlnLnJhbmdlLm1pbixcclxuICAgICAgICAgICAgbGFiZWw6IG5ldyBUZXh0KCBwcm92aWRlZENvbmZpZy5yYW5nZS5taW4sIHsgZm9udDogbmV3IFBoZXRGb250KCAxMiApLCBtYXhXaWR0aDogNTAgfSApXHJcbiAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgIHZhbHVlOiBwcm92aWRlZENvbmZpZy5yYW5nZS5tYXgsXHJcbiAgICAgICAgICAgIGxhYmVsOiBuZXcgVGV4dCggcHJvdmlkZWRDb25maWcucmFuZ2UubWF4LCB7IGZvbnQ6IG5ldyBQaGV0Rm9udCggMTIgKSwgbWF4V2lkdGg6IDUwIH0gKVxyXG4gICAgICAgICAgfSBdLFxyXG4gICAgICAgICAgdHJhY2tTaXplOiBuZXcgRGltZW5zaW9uMiggMTIwLCAwLjUgKVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIHtPYmplY3R9IE9wdGlvbnMgZm9yIHRoZSBjb21ibyBib3hcclxuICAgICAgY29tYm9Cb3hPcHRpb25zOiB7XHJcbiAgICAgICAgY29ybmVyUmFkaXVzOiAzLFxyXG4gICAgICAgIHhNYXJnaW46IDEzLFxyXG4gICAgICAgIHlNYXJnaW46IDVcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIFZCb3ggb3B0aW9uc1xyXG4gICAgICBzcGFjaW5nOiAxMCxcclxuICAgICAgYWxpZ246ICdjZW50ZXInXHJcbiAgICB9LCBwcm92aWRlZENvbmZpZyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICFjb25maWcuY2hpbGRyZW4sICdDaGlsZHJlbiBzaG91bGQgbm90IGJlIHNwZWNpZmllZCBmb3IgQ29tYm9OdW1iZXJDb250cm9sJyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY29uZmlnLnByb3BlcnR5IGluc3RhbmNlb2YgUHJvcGVydHkgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbmZpZy5yYW5nZSBpbnN0YW5jZW9mIFJhbmdlICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0eXBlb2YgY29uZmlnLnRvTnVtZXJpY1ZhbHVlID09PSAnZnVuY3Rpb24nICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0eXBlb2YgY29uZmlnLmNyZWF0ZUN1c3RvbVZhbHVlID09PSAnZnVuY3Rpb24nICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0eXBlb2YgY29uZmlnLmlzQ3VzdG9tVmFsdWUgPT09ICdmdW5jdGlvbicgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGNvbmZpZy5saXN0UGFyZW50IGluc3RhbmNlb2YgTm9kZSApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggQXJyYXkuaXNBcnJheSggY29uZmlnLmNvbWJvSXRlbXMgKSApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY29uZmlnLmN1c3RvbVZhbHVlICk7XHJcblxyXG4gICAgY29uc3QgZ2V0RmFsbGJhY2tOb2RlID0gY29uZmlnLmdldEZhbGxiYWNrTm9kZTtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIGNvbnN0IGdldE51bWVyaWNWYWx1ZSA9ICggdmFsdWU6IFQgKSA9PiBjb25maWcudG9OdW1lcmljVmFsdWUoIHZhbHVlICk7XHJcbiAgICBjb25zdCBnZXRDb21ib1ZhbHVlID0gKCB2YWx1ZTogVCApID0+IGNvbmZpZy5pc0N1c3RvbVZhbHVlKCB2YWx1ZSApID8gY29uZmlnLmN1c3RvbVZhbHVlIDogdmFsdWU7XHJcblxyXG4gICAgdGhpcy5wcm9wZXJ0eSA9IGNvbmZpZy5wcm9wZXJ0eTtcclxuICAgIHRoaXMubnVtYmVyUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIGdldE51bWVyaWNWYWx1ZSggdGhpcy5wcm9wZXJ0eS52YWx1ZSApICk7XHJcbiAgICB0aGlzLmNvbWJvUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIGdldENvbWJvVmFsdWUoIHRoaXMucHJvcGVydHkudmFsdWUgKSApO1xyXG4gICAgdGhpcy5kaXNwb3NhbENhbGxiYWNrcyA9IGRpc3Bvc2FsQ2FsbGJhY2tzO1xyXG5cclxuICAgIC8vIFRoaXMgaW5zdGFuY2UgbGl2ZXMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltdWxhdGlvbiwgc28gd2UgZG9uJ3QgbmVlZCB0byByZW1vdmUgdGhpcyBsaXN0ZW5lclxyXG4gICAgLy8gVHJhY2sgdGhlIGxhc3Qgbm9uLWhpZGRlbiB2YWx1ZSwgc28gdGhhdCBpZiB3ZSBnbyB0byBDVVNUT00sIHdlJ2xsIHVzZSB0aGlzIChhbmQgbm90IGp1c3Qgc2hvdyB0aGUgaGlkZGVuIHZhbHVlLFxyXG4gICAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9idW95YW5jeS9pc3N1ZXMvNTRcclxuICAgIGxldCBsYXN0Tm9uSGlkZGVuVmFsdWUgPSB0aGlzLnByb3BlcnR5LnZhbHVlO1xyXG4gICAgdGhpcy5wcm9wZXJ0eS5saW5rKCB2YWx1ZSA9PiB7XHJcbiAgICAgIGlmICggIWNvbmZpZy5pc0hpZGRlblZhbHVlKCB2YWx1ZSApICkge1xyXG4gICAgICAgIGxhc3ROb25IaWRkZW5WYWx1ZSA9IHZhbHVlO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgbGV0IGxvY2tlZCA9IGZhbHNlO1xyXG5cclxuICAgIC8vIFRoaXMgaW5zdGFuY2UgbGl2ZXMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltdWxhdGlvbiwgc28gd2UgZG9uJ3QgbmVlZCB0byByZW1vdmUgdGhpcyBsaXN0ZW5lclxyXG4gICAgdGhpcy5wcm9wZXJ0eS5sYXp5TGluayggdmFsdWUgPT4ge1xyXG4gICAgICBpZiAoICFsb2NrZWQgKSB7XHJcbiAgICAgICAgbG9ja2VkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgdGhpcy5udW1iZXJQcm9wZXJ0eS52YWx1ZSA9IGdldE51bWVyaWNWYWx1ZSggdmFsdWUgKTtcclxuICAgICAgICB0aGlzLmNvbWJvUHJvcGVydHkudmFsdWUgPSBnZXRDb21ib1ZhbHVlKCB2YWx1ZSApO1xyXG5cclxuICAgICAgICBsb2NrZWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gICAgLy8gVGhpcyBpbnN0YW5jZSBsaXZlcyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW11bGF0aW9uLCBzbyB3ZSBkb24ndCBuZWVkIHRvIHJlbW92ZSB0aGlzIGxpc3RlbmVyXHJcbiAgICB0aGlzLm51bWJlclByb3BlcnR5LmxhenlMaW5rKCB2YWx1ZSA9PiB7XHJcbiAgICAgIGlmICggIWxvY2tlZCApIHtcclxuICAgICAgICBsb2NrZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICB0aGlzLnByb3BlcnR5LnZhbHVlID0gY29uZmlnLmNyZWF0ZUN1c3RvbVZhbHVlKCB2YWx1ZSApO1xyXG4gICAgICAgIHRoaXMuY29tYm9Qcm9wZXJ0eS52YWx1ZSA9IGNvbmZpZy5jdXN0b21WYWx1ZTtcclxuXHJcbiAgICAgICAgbG9ja2VkID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIC8vIFRoaXMgaW5zdGFuY2UgbGl2ZXMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltdWxhdGlvbiwgc28gd2UgZG9uJ3QgbmVlZCB0byByZW1vdmUgdGhpcyBsaXN0ZW5lclxyXG4gICAgdGhpcy5jb21ib1Byb3BlcnR5LmxhenlMaW5rKCB2YWx1ZSA9PiB7XHJcbiAgICAgIGlmICggIWxvY2tlZCApIHtcclxuICAgICAgICBsb2NrZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICBpZiAoIGNvbmZpZy5pc0N1c3RvbVZhbHVlKCB2YWx1ZSApICkge1xyXG4gICAgICAgICAgLy8gV2UnbGwgc3dhcCB0byB0aGUgbGFzdCBub24taGlkZGVuIHZhbHVlIChhbmQgbWFrZSBpdCBjdXN0b20pLiBUaGlzIGlzIHNvIHRoYXQgd2UgZG9uJ3QgaW1tZWRpYXRlbHkgc2hvdyBhXHJcbiAgICAgICAgICAvLyBcImhpZGRlblwiIHByZXZpb3VzIHZhbHVlIChlLmcuIERFTlNJVFlfQSkgYW5kIHRoZSBzdHVkZW50cyBoYXZlIHRvIGd1ZXNzIGl0LlxyXG4gICAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9idW95YW5jeS9pc3N1ZXMvNTRcclxuICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gZ2V0TnVtZXJpY1ZhbHVlKCBsYXN0Tm9uSGlkZGVuVmFsdWUgKTtcclxuICAgICAgICAgIHRoaXMucHJvcGVydHkudmFsdWUgPSBjb25maWcuY3JlYXRlQ3VzdG9tVmFsdWUoIG5ld1ZhbHVlICk7XHJcbiAgICAgICAgICB0aGlzLm51bWJlclByb3BlcnR5LnZhbHVlID0gbmV3VmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5wcm9wZXJ0eS52YWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgdGhpcy5udW1iZXJQcm9wZXJ0eS52YWx1ZSA9IGdldE51bWVyaWNWYWx1ZSggdmFsdWUgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxvY2tlZCA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgbnVtYmVyQ29udHJvbFRhbmRlbSA9IGNvbmZpZy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnbnVtYmVyQ29udHJvbCcgKTtcclxuICAgIHRoaXMubnVtYmVyQ29udHJvbCA9IG5ldyBOdW1iZXJDb250cm9sKCBjb25maWcudGl0bGVQcm9wZXJ0eSwgdGhpcy5udW1iZXJQcm9wZXJ0eSwgY29uZmlnLnJhbmdlLCBjb21iaW5lT3B0aW9uczxOdW1iZXJDb250cm9sT3B0aW9ucz4oIHtcclxuICAgICAgdGFuZGVtOiBudW1iZXJDb250cm9sVGFuZGVtXHJcbiAgICB9LCBjb25maWcubnVtYmVyQ29udHJvbE9wdGlvbnMgKSApO1xyXG4gICAgdGhpcy5udW1iZXJDb250cm9sLmFkZExpbmtlZEVsZW1lbnQoIHRoaXMucHJvcGVydHksIHtcclxuICAgICAgdGFuZGVtOiBudW1iZXJDb250cm9sVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3ZhbHVlUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmNvbWJvQm94ID0gbmV3IENvbWJvQm94KCB0aGlzLmNvbWJvUHJvcGVydHksIGNvbmZpZy5jb21ib0l0ZW1zLCBjb25maWcubGlzdFBhcmVudCwgY29uZmlnLmNvbWJvQm94T3B0aW9ucyApO1xyXG5cclxuICAgIGNvbmZpZy5jaGlsZHJlbiA9IFtcclxuICAgICAgdGhpcy5udW1iZXJDb250cm9sLFxyXG4gICAgICB0aGlzLmNvbWJvQm94XHJcbiAgICBdO1xyXG5cclxuICAgIHRoaXMubXV0YXRlKCBjb25maWcgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbGVhc2VzIHJlZmVyZW5jZXMuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLm51bWJlckNvbnRyb2wuZGlzcG9zZSgpO1xyXG4gICAgdGhpcy5jb21ib0JveC5kaXNwb3NlKCk7XHJcblxyXG4gICAgdGhpcy5udW1iZXJQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLmNvbWJvUHJvcGVydHkuZGlzcG9zZSgpO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zYWxDYWxsYmFja3MuZm9yRWFjaCggY2FsbGJhY2sgPT4gY2FsbGJhY2soKSApO1xyXG5cclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbmRlbnNpdHlCdW95YW5jeUNvbW1vbi5yZWdpc3RlciggJ0NvbWJvTnVtYmVyQ29udHJvbCcsIENvbWJvTnVtYmVyQ29udHJvbCApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxjQUFjLE1BQU0sdUNBQXVDO0FBQ2xFLE9BQU9DLFFBQVEsTUFBTSxpQ0FBaUM7QUFFdEQsT0FBT0MsVUFBVSxNQUFNLGtDQUFrQztBQUN6RCxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLFNBQVMsSUFBSUMsY0FBYyxRQUFRLHVDQUF1QztBQUNqRixPQUFPQyxxQkFBcUIsTUFBTSw4Q0FBOEM7QUFDaEYsT0FBT0MsYUFBYSxNQUFnQyw4Q0FBOEM7QUFDbEcsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxTQUFTQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsSUFBSSxRQUFxQixtQ0FBbUM7QUFDakYsT0FBT0MsUUFBUSxNQUF5QyxnQ0FBZ0M7QUFDeEYsT0FBT0MsWUFBWSxNQUFNLG9DQUFvQztBQUU3RCxPQUFPQyxxQkFBcUIsTUFBTSxnQ0FBZ0M7QUFDbEUsT0FBT0MsOEJBQThCLE1BQU0sc0NBQXNDO0FBcUNqRixlQUFlLE1BQU1DLGtCQUFrQixTQUFZTCxJQUFJLENBQUM7RUFTL0NNLFdBQVdBLENBQUVDLGNBQThCLEVBQUc7SUFFbkQsTUFBTUMsaUJBQW1DLEdBQUcsRUFBRTtJQUM5QyxNQUFNQyw0QkFBNEIsR0FBRyxJQUFJckIsZUFBZSxDQUFFLElBQUssQ0FBQztJQUVoRSxNQUFNc0IsTUFBTSxHQUFHakIsU0FBUyxDQUE0RCxDQUFDLENBQUU7TUFDckZrQixlQUFlLEVBQUVBLENBQUEsS0FBTSxJQUFJO01BRTNCO01BQ0FDLG9CQUFvQixFQUFFO1FBQ3BCQyxjQUFjLEVBQUVqQixhQUFhLENBQUNrQixxQkFBcUIsQ0FBRTtVQUNuREMsbUJBQW1CLEVBQUVDLFNBQVMsSUFBSTtZQUVoQyxNQUFNQyxpQkFBaUIsR0FBRyxJQUFJbkIsSUFBSSxDQUFDLENBQUM7O1lBRXBDO1lBQ0EsTUFBTW9CLGFBQWEsR0FBRyxJQUFJcEIsSUFBSSxDQUFFO2NBQzlCcUIsUUFBUSxFQUFFLENBQ1JILFNBQVMsRUFDVEMsaUJBQWlCO1lBRXJCLENBQUUsQ0FBQztZQUVILE1BQU1HLFFBQVEsR0FBS0MsS0FBUSxJQUFNO2NBQy9CLE1BQU1DLFlBQVksR0FBR1gsZUFBZSxDQUFFVSxLQUFNLENBQUM7Y0FDN0MsTUFBTUUsV0FBVyxHQUFHRCxZQUFZLEtBQUssSUFBSTtjQUV6Q04sU0FBUyxDQUFDUSxPQUFPLEdBQUcsQ0FBQ0QsV0FBVztjQUNoQ2QsNEJBQTRCLENBQUNZLEtBQUssR0FBRyxDQUFDRSxXQUFXO2NBQ2pETixpQkFBaUIsQ0FBQ1EsaUJBQWlCLENBQUMsQ0FBQztjQUVyQyxJQUFLSCxZQUFZLEtBQUssSUFBSSxFQUFHO2dCQUMzQkwsaUJBQWlCLENBQUNTLFFBQVEsQ0FBRUosWUFBYSxDQUFDO2dCQUMxQ0EsWUFBWSxDQUFDSyxRQUFRLEdBQUdYLFNBQVMsQ0FBQ1ksS0FBSztnQkFDdkNOLFlBQVksQ0FBQ08sTUFBTSxHQUFHYixTQUFTLENBQUNhLE1BQU07Y0FDeEM7WUFDRixDQUFDOztZQUVEO1lBQ0EsSUFBSSxDQUFDQyxRQUFRLENBQUNDLElBQUksQ0FBRVgsUUFBUyxDQUFDO1lBQzlCWixpQkFBaUIsQ0FBQ3dCLElBQUksQ0FBRSxNQUFNLElBQUksQ0FBQ0YsUUFBUSxDQUFDRyxNQUFNLENBQUViLFFBQVMsQ0FBRSxDQUFDO1lBRWhFLE9BQU9GLGFBQWE7VUFDdEIsQ0FBQztVQUNEZ0IsYUFBYSxFQUFFO1FBQ2pCLENBQUUsQ0FBQztRQUNIQyxnQkFBZ0IsRUFBRTtVQUNoQkMsSUFBSSxFQUFFaEMsOEJBQThCLENBQUNpQyxVQUFVO1VBQy9DVixRQUFRLEVBQUU7UUFDWixDQUFDO1FBQ0RXLG9CQUFvQixFQUFFO1VBQ3BCQyxXQUFXLEVBQUU7WUFDWEgsSUFBSSxFQUFFaEMsOEJBQThCLENBQUNvQztVQUN2QyxDQUFDO1VBQ0RDLFlBQVksRUFBRSxJQUFJOUMscUJBQXFCLENBQUVZLGNBQWMsQ0FBQ21DLG9CQUFvQixFQUFFO1lBQzVFckIsS0FBSyxFQUFFbkIsWUFBWSxDQUFDeUM7VUFDdEIsQ0FBRSxDQUFDO1VBQ0hoQixRQUFRLEVBQUUsR0FBRztVQUNiaUIsYUFBYSxFQUFFLENBQUM7VUFDaEJDLFdBQVcsRUFBRSxJQUFJO1VBQ2pCQyxhQUFhLEVBQUUsSUFBSTtVQUNuQkMsZUFBZSxFQUFFdEM7UUFDbkIsQ0FBQztRQUNEdUMsa0JBQWtCLEVBQUU7VUFBRUMsS0FBSyxFQUFFO1FBQUssQ0FBQztRQUVuQ0MsYUFBYSxFQUFFO1VBQ2JDLGVBQWUsRUFBRSxDQUFDO1VBQ2xCQyxTQUFTLEVBQUVoRCw4QkFBOEIsQ0FBQ2lELFVBQVU7VUFDcERDLHVCQUF1QixFQUFFLENBQUM7VUFDMUJDLHVCQUF1QixFQUFFLENBQUM7VUFDMUJDLFVBQVUsRUFBRSxDQUFFO1lBQ1puQyxLQUFLLEVBQUVkLGNBQWMsQ0FBQ2tELEtBQUssQ0FBQ0MsR0FBRztZQUMvQkMsS0FBSyxFQUFFLElBQUk1RCxJQUFJLENBQUVRLGNBQWMsQ0FBQ2tELEtBQUssQ0FBQ0MsR0FBRyxFQUFFO2NBQUV0QixJQUFJLEVBQUUsSUFBSXZDLFFBQVEsQ0FBRSxFQUFHLENBQUM7Y0FBRThCLFFBQVEsRUFBRTtZQUFHLENBQUU7VUFDeEYsQ0FBQyxFQUFFO1lBQ0ROLEtBQUssRUFBRWQsY0FBYyxDQUFDa0QsS0FBSyxDQUFDRyxHQUFHO1lBQy9CRCxLQUFLLEVBQUUsSUFBSTVELElBQUksQ0FBRVEsY0FBYyxDQUFDa0QsS0FBSyxDQUFDRyxHQUFHLEVBQUU7Y0FBRXhCLElBQUksRUFBRSxJQUFJdkMsUUFBUSxDQUFFLEVBQUcsQ0FBQztjQUFFOEIsUUFBUSxFQUFFO1lBQUcsQ0FBRTtVQUN4RixDQUFDLENBQUU7VUFDSGtDLFNBQVMsRUFBRSxJQUFJdEUsVUFBVSxDQUFFLEdBQUcsRUFBRSxHQUFJO1FBQ3RDO01BQ0YsQ0FBQztNQUVEO01BQ0F1RSxlQUFlLEVBQUU7UUFDZkMsWUFBWSxFQUFFLENBQUM7UUFDZkMsT0FBTyxFQUFFLEVBQUU7UUFDWEMsT0FBTyxFQUFFO01BQ1gsQ0FBQztNQUVEO01BQ0FDLE9BQU8sRUFBRSxFQUFFO01BQ1hDLEtBQUssRUFBRTtJQUNULENBQUMsRUFBRTVELGNBQWUsQ0FBQztJQUVuQjZELE1BQU0sSUFBSUEsTUFBTSxDQUFFLENBQUMxRCxNQUFNLENBQUNTLFFBQVEsRUFBRSx5REFBMEQsQ0FBQztJQUMvRmlELE1BQU0sSUFBSUEsTUFBTSxDQUFFMUQsTUFBTSxDQUFDb0IsUUFBUSxZQUFZeEMsUUFBUyxDQUFDO0lBQ3ZEOEUsTUFBTSxJQUFJQSxNQUFNLENBQUUxRCxNQUFNLENBQUMrQyxLQUFLLFlBQVlqRSxLQUFNLENBQUM7SUFDakQ0RSxNQUFNLElBQUlBLE1BQU0sQ0FBRSxPQUFPMUQsTUFBTSxDQUFDMkQsY0FBYyxLQUFLLFVBQVcsQ0FBQztJQUMvREQsTUFBTSxJQUFJQSxNQUFNLENBQUUsT0FBTzFELE1BQU0sQ0FBQzRELGlCQUFpQixLQUFLLFVBQVcsQ0FBQztJQUNsRUYsTUFBTSxJQUFJQSxNQUFNLENBQUUsT0FBTzFELE1BQU0sQ0FBQzZELGFBQWEsS0FBSyxVQUFXLENBQUM7SUFDOURILE1BQU0sSUFBSUEsTUFBTSxDQUFFMUQsTUFBTSxDQUFDOEQsVUFBVSxZQUFZMUUsSUFBSyxDQUFDO0lBQ3JEc0UsTUFBTSxJQUFJQSxNQUFNLENBQUVLLEtBQUssQ0FBQ0MsT0FBTyxDQUFFaEUsTUFBTSxDQUFDaUUsVUFBVyxDQUFFLENBQUM7SUFDdERQLE1BQU0sSUFBSUEsTUFBTSxDQUFFMUQsTUFBTSxDQUFDa0UsV0FBWSxDQUFDO0lBRXRDLE1BQU1qRSxlQUFlLEdBQUdELE1BQU0sQ0FBQ0MsZUFBZTtJQUU5QyxLQUFLLENBQUMsQ0FBQztJQUVQLE1BQU1rRSxlQUFlLEdBQUt4RCxLQUFRLElBQU1YLE1BQU0sQ0FBQzJELGNBQWMsQ0FBRWhELEtBQU0sQ0FBQztJQUN0RSxNQUFNeUQsYUFBYSxHQUFLekQsS0FBUSxJQUFNWCxNQUFNLENBQUM2RCxhQUFhLENBQUVsRCxLQUFNLENBQUMsR0FBR1gsTUFBTSxDQUFDa0UsV0FBVyxHQUFHdkQsS0FBSztJQUVoRyxJQUFJLENBQUNTLFFBQVEsR0FBR3BCLE1BQU0sQ0FBQ29CLFFBQVE7SUFDL0IsSUFBSSxDQUFDaUQsY0FBYyxHQUFHLElBQUkxRixjQUFjLENBQUV3RixlQUFlLENBQUUsSUFBSSxDQUFDL0MsUUFBUSxDQUFDVCxLQUFNLENBQUUsQ0FBQztJQUNsRixJQUFJLENBQUMyRCxhQUFhLEdBQUcsSUFBSTFGLFFBQVEsQ0FBRXdGLGFBQWEsQ0FBRSxJQUFJLENBQUNoRCxRQUFRLENBQUNULEtBQU0sQ0FBRSxDQUFDO0lBQ3pFLElBQUksQ0FBQ2IsaUJBQWlCLEdBQUdBLGlCQUFpQjs7SUFFMUM7SUFDQTtJQUNBO0lBQ0EsSUFBSXlFLGtCQUFrQixHQUFHLElBQUksQ0FBQ25ELFFBQVEsQ0FBQ1QsS0FBSztJQUM1QyxJQUFJLENBQUNTLFFBQVEsQ0FBQ0MsSUFBSSxDQUFFVixLQUFLLElBQUk7TUFDM0IsSUFBSyxDQUFDWCxNQUFNLENBQUN3RSxhQUFhLENBQUU3RCxLQUFNLENBQUMsRUFBRztRQUNwQzRELGtCQUFrQixHQUFHNUQsS0FBSztNQUM1QjtJQUNGLENBQUUsQ0FBQztJQUVILElBQUk4RCxNQUFNLEdBQUcsS0FBSzs7SUFFbEI7SUFDQSxJQUFJLENBQUNyRCxRQUFRLENBQUNzRCxRQUFRLENBQUUvRCxLQUFLLElBQUk7TUFDL0IsSUFBSyxDQUFDOEQsTUFBTSxFQUFHO1FBQ2JBLE1BQU0sR0FBRyxJQUFJO1FBRWIsSUFBSSxDQUFDSixjQUFjLENBQUMxRCxLQUFLLEdBQUd3RCxlQUFlLENBQUV4RCxLQUFNLENBQUM7UUFDcEQsSUFBSSxDQUFDMkQsYUFBYSxDQUFDM0QsS0FBSyxHQUFHeUQsYUFBYSxDQUFFekQsS0FBTSxDQUFDO1FBRWpEOEQsTUFBTSxHQUFHLEtBQUs7TUFDaEI7SUFDRixDQUFFLENBQUM7SUFDSDtJQUNBLElBQUksQ0FBQ0osY0FBYyxDQUFDSyxRQUFRLENBQUUvRCxLQUFLLElBQUk7TUFDckMsSUFBSyxDQUFDOEQsTUFBTSxFQUFHO1FBQ2JBLE1BQU0sR0FBRyxJQUFJO1FBRWIsSUFBSSxDQUFDckQsUUFBUSxDQUFDVCxLQUFLLEdBQUdYLE1BQU0sQ0FBQzRELGlCQUFpQixDQUFFakQsS0FBTSxDQUFDO1FBQ3ZELElBQUksQ0FBQzJELGFBQWEsQ0FBQzNELEtBQUssR0FBR1gsTUFBTSxDQUFDa0UsV0FBVztRQUU3Q08sTUFBTSxHQUFHLEtBQUs7TUFDaEI7SUFDRixDQUFFLENBQUM7SUFDSDtJQUNBLElBQUksQ0FBQ0gsYUFBYSxDQUFDSSxRQUFRLENBQUUvRCxLQUFLLElBQUk7TUFDcEMsSUFBSyxDQUFDOEQsTUFBTSxFQUFHO1FBQ2JBLE1BQU0sR0FBRyxJQUFJO1FBRWIsSUFBS3pFLE1BQU0sQ0FBQzZELGFBQWEsQ0FBRWxELEtBQU0sQ0FBQyxFQUFHO1VBQ25DO1VBQ0E7VUFDQTtVQUNBLE1BQU1nRSxRQUFRLEdBQUdSLGVBQWUsQ0FBRUksa0JBQW1CLENBQUM7VUFDdEQsSUFBSSxDQUFDbkQsUUFBUSxDQUFDVCxLQUFLLEdBQUdYLE1BQU0sQ0FBQzRELGlCQUFpQixDQUFFZSxRQUFTLENBQUM7VUFDMUQsSUFBSSxDQUFDTixjQUFjLENBQUMxRCxLQUFLLEdBQUdnRSxRQUFRO1FBQ3RDLENBQUMsTUFDSTtVQUNILElBQUksQ0FBQ3ZELFFBQVEsQ0FBQ1QsS0FBSyxHQUFHQSxLQUFLO1VBQzNCLElBQUksQ0FBQzBELGNBQWMsQ0FBQzFELEtBQUssR0FBR3dELGVBQWUsQ0FBRXhELEtBQU0sQ0FBQztRQUN0RDtRQUVBOEQsTUFBTSxHQUFHLEtBQUs7TUFDaEI7SUFDRixDQUFFLENBQUM7SUFFSCxNQUFNRyxtQkFBbUIsR0FBRzVFLE1BQU0sQ0FBQzZFLE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLGVBQWdCLENBQUM7SUFDekUsSUFBSSxDQUFDQyxhQUFhLEdBQUcsSUFBSTdGLGFBQWEsQ0FBRWMsTUFBTSxDQUFDZ0YsYUFBYSxFQUFFLElBQUksQ0FBQ1gsY0FBYyxFQUFFckUsTUFBTSxDQUFDK0MsS0FBSyxFQUFFL0QsY0FBYyxDQUF3QjtNQUNySTZGLE1BQU0sRUFBRUQ7SUFDVixDQUFDLEVBQUU1RSxNQUFNLENBQUNFLG9CQUFxQixDQUFFLENBQUM7SUFDbEMsSUFBSSxDQUFDNkUsYUFBYSxDQUFDRSxnQkFBZ0IsQ0FBRSxJQUFJLENBQUM3RCxRQUFRLEVBQUU7TUFDbER5RCxNQUFNLEVBQUVELG1CQUFtQixDQUFDRSxZQUFZLENBQUUsZUFBZ0I7SUFDNUQsQ0FBRSxDQUFDO0lBRUgsSUFBSSxDQUFDSSxRQUFRLEdBQUcsSUFBSTNGLFFBQVEsQ0FBRSxJQUFJLENBQUMrRSxhQUFhLEVBQUV0RSxNQUFNLENBQUNpRSxVQUFVLEVBQUVqRSxNQUFNLENBQUM4RCxVQUFVLEVBQUU5RCxNQUFNLENBQUNvRCxlQUFnQixDQUFDO0lBRWhIcEQsTUFBTSxDQUFDUyxRQUFRLEdBQUcsQ0FDaEIsSUFBSSxDQUFDc0UsYUFBYSxFQUNsQixJQUFJLENBQUNHLFFBQVEsQ0FDZDtJQUVELElBQUksQ0FBQ0MsTUFBTSxDQUFFbkYsTUFBTyxDQUFDO0VBQ3ZCOztFQUVBO0FBQ0Y7QUFDQTtFQUNrQm9GLE9BQU9BLENBQUEsRUFBUztJQUM5QixJQUFJLENBQUNMLGFBQWEsQ0FBQ0ssT0FBTyxDQUFDLENBQUM7SUFDNUIsSUFBSSxDQUFDRixRQUFRLENBQUNFLE9BQU8sQ0FBQyxDQUFDO0lBRXZCLElBQUksQ0FBQ2YsY0FBYyxDQUFDZSxPQUFPLENBQUMsQ0FBQztJQUM3QixJQUFJLENBQUNkLGFBQWEsQ0FBQ2MsT0FBTyxDQUFDLENBQUM7SUFFNUIsSUFBSSxDQUFDdEYsaUJBQWlCLENBQUN1RixPQUFPLENBQUVDLFFBQVEsSUFBSUEsUUFBUSxDQUFDLENBQUUsQ0FBQztJQUV4RCxLQUFLLENBQUNGLE9BQU8sQ0FBQyxDQUFDO0VBQ2pCO0FBQ0Y7QUFFQTNGLHFCQUFxQixDQUFDOEYsUUFBUSxDQUFFLG9CQUFvQixFQUFFNUYsa0JBQW1CLENBQUMifQ==