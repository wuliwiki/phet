// Copyright 2019-2022, University of Colorado Boulder

/**
 * The 3D view for a HorizontalCylinder.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Vector3 from '../../../../dot/js/Vector3.js';
import TriangleArrayWriter from '../../../../mobius/js/TriangleArrayWriter.js';
import densityBuoyancyCommon from '../../densityBuoyancyCommon.js';
import MassView, { TAG_OFFSET } from './MassView.js';
// constants
const segments = 64;
const numElements = 12 * segments;
export default class HorizontalCylinderView extends MassView {
  constructor(horizontalCylinder) {
    const positionArray = new Float32Array(numElements * 3);
    const normalArray = new Float32Array(numElements * 3);
    const uvArray = new Float32Array(numElements * 2);
    HorizontalCylinderView.updateArrays(positionArray, normalArray, uvArray, horizontalCylinder.radiusProperty.value, horizontalCylinder.lengthProperty.value);
    const horizontalCylinderGeometry = new THREE.BufferGeometry();
    horizontalCylinderGeometry.addAttribute('position', new THREE.BufferAttribute(positionArray, 3));
    horizontalCylinderGeometry.addAttribute('normal', new THREE.BufferAttribute(normalArray, 3));
    horizontalCylinderGeometry.addAttribute('uv', new THREE.BufferAttribute(uvArray, 2));
    super(horizontalCylinder, horizontalCylinderGeometry);
    const positionTag = () => {
      const radius = horizontalCylinder.radiusProperty.value;
      const length = horizontalCylinder.lengthProperty.value;
      this.tagOffsetProperty.value = new Vector3(-length / 2 + TAG_OFFSET, radius - this.tagHeight - TAG_OFFSET, radius);
    };
    positionTag();
    this.horizontalCylinder = horizontalCylinder;
    this.horizontalCylinderGeometry = horizontalCylinderGeometry;
    this.updateListener = () => {
      positionTag();
      HorizontalCylinderView.updateArrays(horizontalCylinderGeometry.attributes.position.array, null, null, horizontalCylinder.radiusProperty.value, horizontalCylinder.lengthProperty.value);
      horizontalCylinderGeometry.attributes.position.needsUpdate = true;
      horizontalCylinderGeometry.computeBoundingSphere();
    };
    this.horizontalCylinder.radiusProperty.lazyLink(this.updateListener);
    this.horizontalCylinder.lengthProperty.lazyLink(this.updateListener);
  }

  /**
   * Releases references.
   */
  dispose() {
    this.horizontalCylinder.radiusProperty.unlink(this.updateListener);
    this.horizontalCylinder.lengthProperty.unlink(this.updateListener);
    this.horizontalCylinderGeometry.dispose();
    super.dispose();
  }

  /**
   * Updates provided geometry arrays given the specific size.
   *
   * @param positionArray
   * @param normalArray
   * @param uvArray
   * @param radius
   * @param length
   * @param offset - How many vertices have been specified so far?
   * @param offsetPosition - How to transform all of the points
   * @returns - The offset after the specified vertices have been written
   */
  static updateArrays(positionArray, normalArray, uvArray, radius, length, offset = 0, offsetPosition = Vector3.ZERO) {
    const writer = new TriangleArrayWriter(positionArray, normalArray, uvArray, offset, offsetPosition);
    const leftX = -length / 2;
    const rightX = length / 2;
    const du = 2.5 * length;
    const dv = 5 * 2 * Math.PI * radius;
    const duCap = 2.5 * radius;
    const uMin = 0.5 - du;
    const uMax = 0.5 + du;
    const uCapMin = 0.5 - duCap;
    const uCapMax = 0.5 + duCap;
    const TWO_PI = 2 * Math.PI;
    const HALF_PI = 0.5 * Math.PI;
    for (let i = 0; i < segments; i++) {
      const ratio0 = i / segments;
      const ratio1 = (i + 1) / segments;
      const theta0 = TWO_PI * ratio0 - HALF_PI;
      const theta1 = TWO_PI * ratio1 - HALF_PI;

      // Normals
      const ny0 = Math.cos(theta0);
      const ny1 = Math.cos(theta1);
      const nz0 = Math.sin(theta0);
      const nz1 = Math.sin(theta1);

      // Positions
      const y0 = radius * ny0;
      const y1 = radius * ny1;
      const z0 = radius * nz0;
      const z1 = radius * nz1;

      // Left cap
      writer.position(leftX, 0, 0);
      writer.position(leftX, y1, z1);
      writer.position(leftX, y0, z0);
      writer.normal(-1, 0, 0);
      writer.normal(-1, 0, 0);
      writer.normal(-1, 0, 0);
      writer.uv(uCapMax, 0.5);
      writer.uv(uCapMin, dv * (ratio1 - 0.5));
      writer.uv(uCapMin, dv * (ratio0 - 0.5));

      // Side
      writer.position(leftX, y0, z0);
      writer.position(leftX, y1, z1);
      writer.position(rightX, y0, z0);
      writer.position(rightX, y0, z0);
      writer.position(leftX, y1, z1);
      writer.position(rightX, y1, z1);
      writer.normal(0, ny0, nz0);
      writer.normal(0, ny0, nz0);
      writer.normal(0, ny1, nz1);
      writer.normal(0, ny0, nz0);
      writer.normal(0, ny1, nz1);
      writer.normal(0, ny1, nz1);
      writer.uv(uMax, dv * (ratio0 - 0.5));
      writer.uv(uMin, dv * (ratio0 - 0.5));
      writer.uv(uMin, dv * (ratio1 - 0.5));
      writer.uv(uMax, dv * (ratio0 - 0.5));
      writer.uv(uMin, dv * (ratio1 - 0.5));
      writer.uv(uMax, dv * (ratio1 - 0.5));

      // Right cap
      writer.position(rightX, 0, 0);
      writer.position(rightX, y0, z0);
      writer.position(rightX, y1, z1);
      writer.normal(1, 0, 0);
      writer.normal(1, 0, 0);
      writer.normal(1, 0, 0);
      writer.uv(uCapMax, 0.5);
      writer.uv(uCapMin, dv * (ratio0 - 0.5));
      writer.uv(uCapMin, dv * (ratio1 - 0.5));
    }
    return writer.getOffset();
  }
}
densityBuoyancyCommon.register('HorizontalCylinderView', HorizontalCylinderView);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IzIiwiVHJpYW5nbGVBcnJheVdyaXRlciIsImRlbnNpdHlCdW95YW5jeUNvbW1vbiIsIk1hc3NWaWV3IiwiVEFHX09GRlNFVCIsInNlZ21lbnRzIiwibnVtRWxlbWVudHMiLCJIb3Jpem9udGFsQ3lsaW5kZXJWaWV3IiwiY29uc3RydWN0b3IiLCJob3Jpem9udGFsQ3lsaW5kZXIiLCJwb3NpdGlvbkFycmF5IiwiRmxvYXQzMkFycmF5Iiwibm9ybWFsQXJyYXkiLCJ1dkFycmF5IiwidXBkYXRlQXJyYXlzIiwicmFkaXVzUHJvcGVydHkiLCJ2YWx1ZSIsImxlbmd0aFByb3BlcnR5IiwiaG9yaXpvbnRhbEN5bGluZGVyR2VvbWV0cnkiLCJUSFJFRSIsIkJ1ZmZlckdlb21ldHJ5IiwiYWRkQXR0cmlidXRlIiwiQnVmZmVyQXR0cmlidXRlIiwicG9zaXRpb25UYWciLCJyYWRpdXMiLCJsZW5ndGgiLCJ0YWdPZmZzZXRQcm9wZXJ0eSIsInRhZ0hlaWdodCIsInVwZGF0ZUxpc3RlbmVyIiwiYXR0cmlidXRlcyIsInBvc2l0aW9uIiwiYXJyYXkiLCJuZWVkc1VwZGF0ZSIsImNvbXB1dGVCb3VuZGluZ1NwaGVyZSIsImxhenlMaW5rIiwiZGlzcG9zZSIsInVubGluayIsIm9mZnNldCIsIm9mZnNldFBvc2l0aW9uIiwiWkVSTyIsIndyaXRlciIsImxlZnRYIiwicmlnaHRYIiwiZHUiLCJkdiIsIk1hdGgiLCJQSSIsImR1Q2FwIiwidU1pbiIsInVNYXgiLCJ1Q2FwTWluIiwidUNhcE1heCIsIlRXT19QSSIsIkhBTEZfUEkiLCJpIiwicmF0aW8wIiwicmF0aW8xIiwidGhldGEwIiwidGhldGExIiwibnkwIiwiY29zIiwibnkxIiwibnowIiwic2luIiwibnoxIiwieTAiLCJ5MSIsInowIiwiejEiLCJub3JtYWwiLCJ1diIsImdldE9mZnNldCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiSG9yaXpvbnRhbEN5bGluZGVyVmlldy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBUaGUgM0QgdmlldyBmb3IgYSBIb3Jpem9udGFsQ3lsaW5kZXIuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgVmVjdG9yMyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMy5qcyc7XHJcbmltcG9ydCBUcmlhbmdsZUFycmF5V3JpdGVyIGZyb20gJy4uLy4uLy4uLy4uL21vYml1cy9qcy9UcmlhbmdsZUFycmF5V3JpdGVyLmpzJztcclxuaW1wb3J0IGRlbnNpdHlCdW95YW5jeUNvbW1vbiBmcm9tICcuLi8uLi9kZW5zaXR5QnVveWFuY3lDb21tb24uanMnO1xyXG5pbXBvcnQgTWFzc1ZpZXcsIHsgVEFHX09GRlNFVCB9IGZyb20gJy4vTWFzc1ZpZXcuanMnO1xyXG5pbXBvcnQgSG9yaXpvbnRhbEN5bGluZGVyIGZyb20gJy4uL21vZGVsL0hvcml6b250YWxDeWxpbmRlci5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3Qgc2VnbWVudHMgPSA2NDtcclxuY29uc3QgbnVtRWxlbWVudHMgPSAxMiAqIHNlZ21lbnRzO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSG9yaXpvbnRhbEN5bGluZGVyVmlldyBleHRlbmRzIE1hc3NWaWV3IHtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IGhvcml6b250YWxDeWxpbmRlcjogSG9yaXpvbnRhbEN5bGluZGVyO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgaG9yaXpvbnRhbEN5bGluZGVyR2VvbWV0cnk6IFRIUkVFLkJ1ZmZlckdlb21ldHJ5O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdXBkYXRlTGlzdGVuZXI6ICgpID0+IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggaG9yaXpvbnRhbEN5bGluZGVyOiBIb3Jpem9udGFsQ3lsaW5kZXIgKSB7XHJcblxyXG4gICAgY29uc3QgcG9zaXRpb25BcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIG51bUVsZW1lbnRzICogMyApO1xyXG4gICAgY29uc3Qgbm9ybWFsQXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCBudW1FbGVtZW50cyAqIDMgKTtcclxuICAgIGNvbnN0IHV2QXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCBudW1FbGVtZW50cyAqIDIgKTtcclxuXHJcbiAgICBIb3Jpem9udGFsQ3lsaW5kZXJWaWV3LnVwZGF0ZUFycmF5cyggcG9zaXRpb25BcnJheSwgbm9ybWFsQXJyYXksIHV2QXJyYXksIGhvcml6b250YWxDeWxpbmRlci5yYWRpdXNQcm9wZXJ0eS52YWx1ZSwgaG9yaXpvbnRhbEN5bGluZGVyLmxlbmd0aFByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gICAgY29uc3QgaG9yaXpvbnRhbEN5bGluZGVyR2VvbWV0cnkgPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKTtcclxuICAgIGhvcml6b250YWxDeWxpbmRlckdlb21ldHJ5LmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BcnJheSwgMyApICk7XHJcbiAgICBob3Jpem9udGFsQ3lsaW5kZXJHZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKCBub3JtYWxBcnJheSwgMyApICk7XHJcbiAgICBob3Jpem9udGFsQ3lsaW5kZXJHZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICd1dicsIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUoIHV2QXJyYXksIDIgKSApO1xyXG5cclxuICAgIHN1cGVyKCBob3Jpem9udGFsQ3lsaW5kZXIsIGhvcml6b250YWxDeWxpbmRlckdlb21ldHJ5ICk7XHJcblxyXG4gICAgY29uc3QgcG9zaXRpb25UYWcgPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJhZGl1cyA9IGhvcml6b250YWxDeWxpbmRlci5yYWRpdXNQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgY29uc3QgbGVuZ3RoID0gaG9yaXpvbnRhbEN5bGluZGVyLmxlbmd0aFByb3BlcnR5LnZhbHVlO1xyXG4gICAgICB0aGlzLnRhZ09mZnNldFByb3BlcnR5LnZhbHVlID0gbmV3IFZlY3RvcjMoIC1sZW5ndGggLyAyICsgVEFHX09GRlNFVCwgcmFkaXVzIC0gdGhpcy50YWdIZWlnaHQhIC0gVEFHX09GRlNFVCwgcmFkaXVzICk7XHJcbiAgICB9O1xyXG4gICAgcG9zaXRpb25UYWcoKTtcclxuXHJcbiAgICB0aGlzLmhvcml6b250YWxDeWxpbmRlciA9IGhvcml6b250YWxDeWxpbmRlcjtcclxuICAgIHRoaXMuaG9yaXpvbnRhbEN5bGluZGVyR2VvbWV0cnkgPSBob3Jpem9udGFsQ3lsaW5kZXJHZW9tZXRyeTtcclxuICAgIHRoaXMudXBkYXRlTGlzdGVuZXIgPSAoKSA9PiB7XHJcbiAgICAgIHBvc2l0aW9uVGFnKCk7XHJcbiAgICAgIEhvcml6b250YWxDeWxpbmRlclZpZXcudXBkYXRlQXJyYXlzKCBob3Jpem9udGFsQ3lsaW5kZXJHZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmFycmF5IGFzIEZsb2F0MzJBcnJheSwgbnVsbCwgbnVsbCwgaG9yaXpvbnRhbEN5bGluZGVyLnJhZGl1c1Byb3BlcnR5LnZhbHVlLCBob3Jpem9udGFsQ3lsaW5kZXIubGVuZ3RoUHJvcGVydHkudmFsdWUgKTtcclxuICAgICAgaG9yaXpvbnRhbEN5bGluZGVyR2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbi5uZWVkc1VwZGF0ZSA9IHRydWU7XHJcbiAgICAgIGhvcml6b250YWxDeWxpbmRlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpO1xyXG4gICAgfTtcclxuICAgIHRoaXMuaG9yaXpvbnRhbEN5bGluZGVyLnJhZGl1c1Byb3BlcnR5LmxhenlMaW5rKCB0aGlzLnVwZGF0ZUxpc3RlbmVyICk7XHJcbiAgICB0aGlzLmhvcml6b250YWxDeWxpbmRlci5sZW5ndGhQcm9wZXJ0eS5sYXp5TGluayggdGhpcy51cGRhdGVMaXN0ZW5lciApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVsZWFzZXMgcmVmZXJlbmNlcy5cclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuaG9yaXpvbnRhbEN5bGluZGVyLnJhZGl1c1Byb3BlcnR5LnVubGluayggdGhpcy51cGRhdGVMaXN0ZW5lciApO1xyXG4gICAgdGhpcy5ob3Jpem9udGFsQ3lsaW5kZXIubGVuZ3RoUHJvcGVydHkudW5saW5rKCB0aGlzLnVwZGF0ZUxpc3RlbmVyICk7XHJcbiAgICB0aGlzLmhvcml6b250YWxDeWxpbmRlckdlb21ldHJ5LmRpc3Bvc2UoKTtcclxuXHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHByb3ZpZGVkIGdlb21ldHJ5IGFycmF5cyBnaXZlbiB0aGUgc3BlY2lmaWMgc2l6ZS5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBwb3NpdGlvbkFycmF5XHJcbiAgICogQHBhcmFtIG5vcm1hbEFycmF5XHJcbiAgICogQHBhcmFtIHV2QXJyYXlcclxuICAgKiBAcGFyYW0gcmFkaXVzXHJcbiAgICogQHBhcmFtIGxlbmd0aFxyXG4gICAqIEBwYXJhbSBvZmZzZXQgLSBIb3cgbWFueSB2ZXJ0aWNlcyBoYXZlIGJlZW4gc3BlY2lmaWVkIHNvIGZhcj9cclxuICAgKiBAcGFyYW0gb2Zmc2V0UG9zaXRpb24gLSBIb3cgdG8gdHJhbnNmb3JtIGFsbCBvZiB0aGUgcG9pbnRzXHJcbiAgICogQHJldHVybnMgLSBUaGUgb2Zmc2V0IGFmdGVyIHRoZSBzcGVjaWZpZWQgdmVydGljZXMgaGF2ZSBiZWVuIHdyaXR0ZW5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIHVwZGF0ZUFycmF5cyggcG9zaXRpb25BcnJheTogRmxvYXQzMkFycmF5IHwgbnVsbCwgbm9ybWFsQXJyYXk6IEZsb2F0MzJBcnJheSB8IG51bGwsIHV2QXJyYXk6IEZsb2F0MzJBcnJheSB8IG51bGwsIHJhZGl1czogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgb2Zmc2V0ID0gMCwgb2Zmc2V0UG9zaXRpb246IFZlY3RvcjMgPSBWZWN0b3IzLlpFUk8gKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IHdyaXRlciA9IG5ldyBUcmlhbmdsZUFycmF5V3JpdGVyKCBwb3NpdGlvbkFycmF5LCBub3JtYWxBcnJheSwgdXZBcnJheSwgb2Zmc2V0LCBvZmZzZXRQb3NpdGlvbiApO1xyXG5cclxuICAgIGNvbnN0IGxlZnRYID0gLWxlbmd0aCAvIDI7XHJcbiAgICBjb25zdCByaWdodFggPSBsZW5ndGggLyAyO1xyXG5cclxuICAgIGNvbnN0IGR1ID0gMi41ICogbGVuZ3RoO1xyXG4gICAgY29uc3QgZHYgPSA1ICogMiAqIE1hdGguUEkgKiByYWRpdXM7XHJcbiAgICBjb25zdCBkdUNhcCA9IDIuNSAqIHJhZGl1cztcclxuICAgIGNvbnN0IHVNaW4gPSAwLjUgLSBkdTtcclxuICAgIGNvbnN0IHVNYXggPSAwLjUgKyBkdTtcclxuICAgIGNvbnN0IHVDYXBNaW4gPSAwLjUgLSBkdUNhcDtcclxuICAgIGNvbnN0IHVDYXBNYXggPSAwLjUgKyBkdUNhcDtcclxuXHJcbiAgICBjb25zdCBUV09fUEkgPSAyICogTWF0aC5QSTtcclxuICAgIGNvbnN0IEhBTEZfUEkgPSAwLjUgKiBNYXRoLlBJO1xyXG5cclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHNlZ21lbnRzOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IHJhdGlvMCA9IGkgLyBzZWdtZW50cztcclxuICAgICAgY29uc3QgcmF0aW8xID0gKCBpICsgMSApIC8gc2VnbWVudHM7XHJcbiAgICAgIGNvbnN0IHRoZXRhMCA9IFRXT19QSSAqIHJhdGlvMCAtIEhBTEZfUEk7XHJcbiAgICAgIGNvbnN0IHRoZXRhMSA9IFRXT19QSSAqIHJhdGlvMSAtIEhBTEZfUEk7XHJcblxyXG4gICAgICAvLyBOb3JtYWxzXHJcbiAgICAgIGNvbnN0IG55MCA9IE1hdGguY29zKCB0aGV0YTAgKTtcclxuICAgICAgY29uc3QgbnkxID0gTWF0aC5jb3MoIHRoZXRhMSApO1xyXG4gICAgICBjb25zdCBuejAgPSBNYXRoLnNpbiggdGhldGEwICk7XHJcbiAgICAgIGNvbnN0IG56MSA9IE1hdGguc2luKCB0aGV0YTEgKTtcclxuXHJcbiAgICAgIC8vIFBvc2l0aW9uc1xyXG4gICAgICBjb25zdCB5MCA9IHJhZGl1cyAqIG55MDtcclxuICAgICAgY29uc3QgeTEgPSByYWRpdXMgKiBueTE7XHJcbiAgICAgIGNvbnN0IHowID0gcmFkaXVzICogbnowO1xyXG4gICAgICBjb25zdCB6MSA9IHJhZGl1cyAqIG56MTtcclxuXHJcbiAgICAgIC8vIExlZnQgY2FwXHJcbiAgICAgIHdyaXRlci5wb3NpdGlvbiggbGVmdFgsIDAsIDAgKTtcclxuICAgICAgd3JpdGVyLnBvc2l0aW9uKCBsZWZ0WCwgeTEsIHoxICk7XHJcbiAgICAgIHdyaXRlci5wb3NpdGlvbiggbGVmdFgsIHkwLCB6MCApO1xyXG4gICAgICB3cml0ZXIubm9ybWFsKCAtMSwgMCwgMCApO1xyXG4gICAgICB3cml0ZXIubm9ybWFsKCAtMSwgMCwgMCApO1xyXG4gICAgICB3cml0ZXIubm9ybWFsKCAtMSwgMCwgMCApO1xyXG4gICAgICB3cml0ZXIudXYoIHVDYXBNYXgsIDAuNSApO1xyXG4gICAgICB3cml0ZXIudXYoIHVDYXBNaW4sIGR2ICogKCByYXRpbzEgLSAwLjUgKSApO1xyXG4gICAgICB3cml0ZXIudXYoIHVDYXBNaW4sIGR2ICogKCByYXRpbzAgLSAwLjUgKSApO1xyXG5cclxuICAgICAgLy8gU2lkZVxyXG4gICAgICB3cml0ZXIucG9zaXRpb24oIGxlZnRYLCB5MCwgejAgKTtcclxuICAgICAgd3JpdGVyLnBvc2l0aW9uKCBsZWZ0WCwgeTEsIHoxICk7XHJcbiAgICAgIHdyaXRlci5wb3NpdGlvbiggcmlnaHRYLCB5MCwgejAgKTtcclxuICAgICAgd3JpdGVyLnBvc2l0aW9uKCByaWdodFgsIHkwLCB6MCApO1xyXG4gICAgICB3cml0ZXIucG9zaXRpb24oIGxlZnRYLCB5MSwgejEgKTtcclxuICAgICAgd3JpdGVyLnBvc2l0aW9uKCByaWdodFgsIHkxLCB6MSApO1xyXG4gICAgICB3cml0ZXIubm9ybWFsKCAwLCBueTAsIG56MCApO1xyXG4gICAgICB3cml0ZXIubm9ybWFsKCAwLCBueTAsIG56MCApO1xyXG4gICAgICB3cml0ZXIubm9ybWFsKCAwLCBueTEsIG56MSApO1xyXG4gICAgICB3cml0ZXIubm9ybWFsKCAwLCBueTAsIG56MCApO1xyXG4gICAgICB3cml0ZXIubm9ybWFsKCAwLCBueTEsIG56MSApO1xyXG4gICAgICB3cml0ZXIubm9ybWFsKCAwLCBueTEsIG56MSApO1xyXG4gICAgICB3cml0ZXIudXYoIHVNYXgsIGR2ICogKCByYXRpbzAgLSAwLjUgKSApO1xyXG4gICAgICB3cml0ZXIudXYoIHVNaW4sIGR2ICogKCByYXRpbzAgLSAwLjUgKSApO1xyXG4gICAgICB3cml0ZXIudXYoIHVNaW4sIGR2ICogKCByYXRpbzEgLSAwLjUgKSApO1xyXG4gICAgICB3cml0ZXIudXYoIHVNYXgsIGR2ICogKCByYXRpbzAgLSAwLjUgKSApO1xyXG4gICAgICB3cml0ZXIudXYoIHVNaW4sIGR2ICogKCByYXRpbzEgLSAwLjUgKSApO1xyXG4gICAgICB3cml0ZXIudXYoIHVNYXgsIGR2ICogKCByYXRpbzEgLSAwLjUgKSApO1xyXG5cclxuICAgICAgLy8gUmlnaHQgY2FwXHJcbiAgICAgIHdyaXRlci5wb3NpdGlvbiggcmlnaHRYLCAwLCAwICk7XHJcbiAgICAgIHdyaXRlci5wb3NpdGlvbiggcmlnaHRYLCB5MCwgejAgKTtcclxuICAgICAgd3JpdGVyLnBvc2l0aW9uKCByaWdodFgsIHkxLCB6MSApO1xyXG4gICAgICB3cml0ZXIubm9ybWFsKCAxLCAwLCAwICk7XHJcbiAgICAgIHdyaXRlci5ub3JtYWwoIDEsIDAsIDAgKTtcclxuICAgICAgd3JpdGVyLm5vcm1hbCggMSwgMCwgMCApO1xyXG4gICAgICB3cml0ZXIudXYoIHVDYXBNYXgsIDAuNSApO1xyXG4gICAgICB3cml0ZXIudXYoIHVDYXBNaW4sIGR2ICogKCByYXRpbzAgLSAwLjUgKSApO1xyXG4gICAgICB3cml0ZXIudXYoIHVDYXBNaW4sIGR2ICogKCByYXRpbzEgLSAwLjUgKSApO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB3cml0ZXIuZ2V0T2Zmc2V0KCk7XHJcbiAgfVxyXG59XHJcblxyXG5kZW5zaXR5QnVveWFuY3lDb21tb24ucmVnaXN0ZXIoICdIb3Jpem9udGFsQ3lsaW5kZXJWaWV3JywgSG9yaXpvbnRhbEN5bGluZGVyVmlldyApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxtQkFBbUIsTUFBTSw4Q0FBOEM7QUFDOUUsT0FBT0MscUJBQXFCLE1BQU0sZ0NBQWdDO0FBQ2xFLE9BQU9DLFFBQVEsSUFBSUMsVUFBVSxRQUFRLGVBQWU7QUFHcEQ7QUFDQSxNQUFNQyxRQUFRLEdBQUcsRUFBRTtBQUNuQixNQUFNQyxXQUFXLEdBQUcsRUFBRSxHQUFHRCxRQUFRO0FBRWpDLGVBQWUsTUFBTUUsc0JBQXNCLFNBQVNKLFFBQVEsQ0FBQztFQU1wREssV0FBV0EsQ0FBRUMsa0JBQXNDLEVBQUc7SUFFM0QsTUFBTUMsYUFBYSxHQUFHLElBQUlDLFlBQVksQ0FBRUwsV0FBVyxHQUFHLENBQUUsQ0FBQztJQUN6RCxNQUFNTSxXQUFXLEdBQUcsSUFBSUQsWUFBWSxDQUFFTCxXQUFXLEdBQUcsQ0FBRSxDQUFDO0lBQ3ZELE1BQU1PLE9BQU8sR0FBRyxJQUFJRixZQUFZLENBQUVMLFdBQVcsR0FBRyxDQUFFLENBQUM7SUFFbkRDLHNCQUFzQixDQUFDTyxZQUFZLENBQUVKLGFBQWEsRUFBRUUsV0FBVyxFQUFFQyxPQUFPLEVBQUVKLGtCQUFrQixDQUFDTSxjQUFjLENBQUNDLEtBQUssRUFBRVAsa0JBQWtCLENBQUNRLGNBQWMsQ0FBQ0QsS0FBTSxDQUFDO0lBRTVKLE1BQU1FLDBCQUEwQixHQUFHLElBQUlDLEtBQUssQ0FBQ0MsY0FBYyxDQUFDLENBQUM7SUFDN0RGLDBCQUEwQixDQUFDRyxZQUFZLENBQUUsVUFBVSxFQUFFLElBQUlGLEtBQUssQ0FBQ0csZUFBZSxDQUFFWixhQUFhLEVBQUUsQ0FBRSxDQUFFLENBQUM7SUFDcEdRLDBCQUEwQixDQUFDRyxZQUFZLENBQUUsUUFBUSxFQUFFLElBQUlGLEtBQUssQ0FBQ0csZUFBZSxDQUFFVixXQUFXLEVBQUUsQ0FBRSxDQUFFLENBQUM7SUFDaEdNLDBCQUEwQixDQUFDRyxZQUFZLENBQUUsSUFBSSxFQUFFLElBQUlGLEtBQUssQ0FBQ0csZUFBZSxDQUFFVCxPQUFPLEVBQUUsQ0FBRSxDQUFFLENBQUM7SUFFeEYsS0FBSyxDQUFFSixrQkFBa0IsRUFBRVMsMEJBQTJCLENBQUM7SUFFdkQsTUFBTUssV0FBVyxHQUFHQSxDQUFBLEtBQU07TUFDeEIsTUFBTUMsTUFBTSxHQUFHZixrQkFBa0IsQ0FBQ00sY0FBYyxDQUFDQyxLQUFLO01BQ3RELE1BQU1TLE1BQU0sR0FBR2hCLGtCQUFrQixDQUFDUSxjQUFjLENBQUNELEtBQUs7TUFDdEQsSUFBSSxDQUFDVSxpQkFBaUIsQ0FBQ1YsS0FBSyxHQUFHLElBQUloQixPQUFPLENBQUUsQ0FBQ3lCLE1BQU0sR0FBRyxDQUFDLEdBQUdyQixVQUFVLEVBQUVvQixNQUFNLEdBQUcsSUFBSSxDQUFDRyxTQUFVLEdBQUd2QixVQUFVLEVBQUVvQixNQUFPLENBQUM7SUFDdkgsQ0FBQztJQUNERCxXQUFXLENBQUMsQ0FBQztJQUViLElBQUksQ0FBQ2Qsa0JBQWtCLEdBQUdBLGtCQUFrQjtJQUM1QyxJQUFJLENBQUNTLDBCQUEwQixHQUFHQSwwQkFBMEI7SUFDNUQsSUFBSSxDQUFDVSxjQUFjLEdBQUcsTUFBTTtNQUMxQkwsV0FBVyxDQUFDLENBQUM7TUFDYmhCLHNCQUFzQixDQUFDTyxZQUFZLENBQUVJLDBCQUEwQixDQUFDVyxVQUFVLENBQUNDLFFBQVEsQ0FBQ0MsS0FBSyxFQUFrQixJQUFJLEVBQUUsSUFBSSxFQUFFdEIsa0JBQWtCLENBQUNNLGNBQWMsQ0FBQ0MsS0FBSyxFQUFFUCxrQkFBa0IsQ0FBQ1EsY0FBYyxDQUFDRCxLQUFNLENBQUM7TUFDek1FLDBCQUEwQixDQUFDVyxVQUFVLENBQUNDLFFBQVEsQ0FBQ0UsV0FBVyxHQUFHLElBQUk7TUFDakVkLDBCQUEwQixDQUFDZSxxQkFBcUIsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFDRCxJQUFJLENBQUN4QixrQkFBa0IsQ0FBQ00sY0FBYyxDQUFDbUIsUUFBUSxDQUFFLElBQUksQ0FBQ04sY0FBZSxDQUFDO0lBQ3RFLElBQUksQ0FBQ25CLGtCQUFrQixDQUFDUSxjQUFjLENBQUNpQixRQUFRLENBQUUsSUFBSSxDQUFDTixjQUFlLENBQUM7RUFDeEU7O0VBRUE7QUFDRjtBQUNBO0VBQ2tCTyxPQUFPQSxDQUFBLEVBQVM7SUFDOUIsSUFBSSxDQUFDMUIsa0JBQWtCLENBQUNNLGNBQWMsQ0FBQ3FCLE1BQU0sQ0FBRSxJQUFJLENBQUNSLGNBQWUsQ0FBQztJQUNwRSxJQUFJLENBQUNuQixrQkFBa0IsQ0FBQ1EsY0FBYyxDQUFDbUIsTUFBTSxDQUFFLElBQUksQ0FBQ1IsY0FBZSxDQUFDO0lBQ3BFLElBQUksQ0FBQ1YsMEJBQTBCLENBQUNpQixPQUFPLENBQUMsQ0FBQztJQUV6QyxLQUFLLENBQUNBLE9BQU8sQ0FBQyxDQUFDO0VBQ2pCOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFLE9BQWNyQixZQUFZQSxDQUFFSixhQUFrQyxFQUFFRSxXQUFnQyxFQUFFQyxPQUE0QixFQUFFVyxNQUFjLEVBQUVDLE1BQWMsRUFBRVksTUFBTSxHQUFHLENBQUMsRUFBRUMsY0FBdUIsR0FBR3RDLE9BQU8sQ0FBQ3VDLElBQUksRUFBVztJQUMzTixNQUFNQyxNQUFNLEdBQUcsSUFBSXZDLG1CQUFtQixDQUFFUyxhQUFhLEVBQUVFLFdBQVcsRUFBRUMsT0FBTyxFQUFFd0IsTUFBTSxFQUFFQyxjQUFlLENBQUM7SUFFckcsTUFBTUcsS0FBSyxHQUFHLENBQUNoQixNQUFNLEdBQUcsQ0FBQztJQUN6QixNQUFNaUIsTUFBTSxHQUFHakIsTUFBTSxHQUFHLENBQUM7SUFFekIsTUFBTWtCLEVBQUUsR0FBRyxHQUFHLEdBQUdsQixNQUFNO0lBQ3ZCLE1BQU1tQixFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBR0MsSUFBSSxDQUFDQyxFQUFFLEdBQUd0QixNQUFNO0lBQ25DLE1BQU11QixLQUFLLEdBQUcsR0FBRyxHQUFHdkIsTUFBTTtJQUMxQixNQUFNd0IsSUFBSSxHQUFHLEdBQUcsR0FBR0wsRUFBRTtJQUNyQixNQUFNTSxJQUFJLEdBQUcsR0FBRyxHQUFHTixFQUFFO0lBQ3JCLE1BQU1PLE9BQU8sR0FBRyxHQUFHLEdBQUdILEtBQUs7SUFDM0IsTUFBTUksT0FBTyxHQUFHLEdBQUcsR0FBR0osS0FBSztJQUUzQixNQUFNSyxNQUFNLEdBQUcsQ0FBQyxHQUFHUCxJQUFJLENBQUNDLEVBQUU7SUFDMUIsTUFBTU8sT0FBTyxHQUFHLEdBQUcsR0FBR1IsSUFBSSxDQUFDQyxFQUFFO0lBRTdCLEtBQU0sSUFBSVEsQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHakQsUUFBUSxFQUFFaUQsQ0FBQyxFQUFFLEVBQUc7TUFDbkMsTUFBTUMsTUFBTSxHQUFHRCxDQUFDLEdBQUdqRCxRQUFRO01BQzNCLE1BQU1tRCxNQUFNLEdBQUcsQ0FBRUYsQ0FBQyxHQUFHLENBQUMsSUFBS2pELFFBQVE7TUFDbkMsTUFBTW9ELE1BQU0sR0FBR0wsTUFBTSxHQUFHRyxNQUFNLEdBQUdGLE9BQU87TUFDeEMsTUFBTUssTUFBTSxHQUFHTixNQUFNLEdBQUdJLE1BQU0sR0FBR0gsT0FBTzs7TUFFeEM7TUFDQSxNQUFNTSxHQUFHLEdBQUdkLElBQUksQ0FBQ2UsR0FBRyxDQUFFSCxNQUFPLENBQUM7TUFDOUIsTUFBTUksR0FBRyxHQUFHaEIsSUFBSSxDQUFDZSxHQUFHLENBQUVGLE1BQU8sQ0FBQztNQUM5QixNQUFNSSxHQUFHLEdBQUdqQixJQUFJLENBQUNrQixHQUFHLENBQUVOLE1BQU8sQ0FBQztNQUM5QixNQUFNTyxHQUFHLEdBQUduQixJQUFJLENBQUNrQixHQUFHLENBQUVMLE1BQU8sQ0FBQzs7TUFFOUI7TUFDQSxNQUFNTyxFQUFFLEdBQUd6QyxNQUFNLEdBQUdtQyxHQUFHO01BQ3ZCLE1BQU1PLEVBQUUsR0FBRzFDLE1BQU0sR0FBR3FDLEdBQUc7TUFDdkIsTUFBTU0sRUFBRSxHQUFHM0MsTUFBTSxHQUFHc0MsR0FBRztNQUN2QixNQUFNTSxFQUFFLEdBQUc1QyxNQUFNLEdBQUd3QyxHQUFHOztNQUV2QjtNQUNBeEIsTUFBTSxDQUFDVixRQUFRLENBQUVXLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDO01BQzlCRCxNQUFNLENBQUNWLFFBQVEsQ0FBRVcsS0FBSyxFQUFFeUIsRUFBRSxFQUFFRSxFQUFHLENBQUM7TUFDaEM1QixNQUFNLENBQUNWLFFBQVEsQ0FBRVcsS0FBSyxFQUFFd0IsRUFBRSxFQUFFRSxFQUFHLENBQUM7TUFDaEMzQixNQUFNLENBQUM2QixNQUFNLENBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUUsQ0FBQztNQUN6QjdCLE1BQU0sQ0FBQzZCLE1BQU0sQ0FBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDO01BQ3pCN0IsTUFBTSxDQUFDNkIsTUFBTSxDQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFFLENBQUM7TUFDekI3QixNQUFNLENBQUM4QixFQUFFLENBQUVuQixPQUFPLEVBQUUsR0FBSSxDQUFDO01BQ3pCWCxNQUFNLENBQUM4QixFQUFFLENBQUVwQixPQUFPLEVBQUVOLEVBQUUsSUFBS1ksTUFBTSxHQUFHLEdBQUcsQ0FBRyxDQUFDO01BQzNDaEIsTUFBTSxDQUFDOEIsRUFBRSxDQUFFcEIsT0FBTyxFQUFFTixFQUFFLElBQUtXLE1BQU0sR0FBRyxHQUFHLENBQUcsQ0FBQzs7TUFFM0M7TUFDQWYsTUFBTSxDQUFDVixRQUFRLENBQUVXLEtBQUssRUFBRXdCLEVBQUUsRUFBRUUsRUFBRyxDQUFDO01BQ2hDM0IsTUFBTSxDQUFDVixRQUFRLENBQUVXLEtBQUssRUFBRXlCLEVBQUUsRUFBRUUsRUFBRyxDQUFDO01BQ2hDNUIsTUFBTSxDQUFDVixRQUFRLENBQUVZLE1BQU0sRUFBRXVCLEVBQUUsRUFBRUUsRUFBRyxDQUFDO01BQ2pDM0IsTUFBTSxDQUFDVixRQUFRLENBQUVZLE1BQU0sRUFBRXVCLEVBQUUsRUFBRUUsRUFBRyxDQUFDO01BQ2pDM0IsTUFBTSxDQUFDVixRQUFRLENBQUVXLEtBQUssRUFBRXlCLEVBQUUsRUFBRUUsRUFBRyxDQUFDO01BQ2hDNUIsTUFBTSxDQUFDVixRQUFRLENBQUVZLE1BQU0sRUFBRXdCLEVBQUUsRUFBRUUsRUFBRyxDQUFDO01BQ2pDNUIsTUFBTSxDQUFDNkIsTUFBTSxDQUFFLENBQUMsRUFBRVYsR0FBRyxFQUFFRyxHQUFJLENBQUM7TUFDNUJ0QixNQUFNLENBQUM2QixNQUFNLENBQUUsQ0FBQyxFQUFFVixHQUFHLEVBQUVHLEdBQUksQ0FBQztNQUM1QnRCLE1BQU0sQ0FBQzZCLE1BQU0sQ0FBRSxDQUFDLEVBQUVSLEdBQUcsRUFBRUcsR0FBSSxDQUFDO01BQzVCeEIsTUFBTSxDQUFDNkIsTUFBTSxDQUFFLENBQUMsRUFBRVYsR0FBRyxFQUFFRyxHQUFJLENBQUM7TUFDNUJ0QixNQUFNLENBQUM2QixNQUFNLENBQUUsQ0FBQyxFQUFFUixHQUFHLEVBQUVHLEdBQUksQ0FBQztNQUM1QnhCLE1BQU0sQ0FBQzZCLE1BQU0sQ0FBRSxDQUFDLEVBQUVSLEdBQUcsRUFBRUcsR0FBSSxDQUFDO01BQzVCeEIsTUFBTSxDQUFDOEIsRUFBRSxDQUFFckIsSUFBSSxFQUFFTCxFQUFFLElBQUtXLE1BQU0sR0FBRyxHQUFHLENBQUcsQ0FBQztNQUN4Q2YsTUFBTSxDQUFDOEIsRUFBRSxDQUFFdEIsSUFBSSxFQUFFSixFQUFFLElBQUtXLE1BQU0sR0FBRyxHQUFHLENBQUcsQ0FBQztNQUN4Q2YsTUFBTSxDQUFDOEIsRUFBRSxDQUFFdEIsSUFBSSxFQUFFSixFQUFFLElBQUtZLE1BQU0sR0FBRyxHQUFHLENBQUcsQ0FBQztNQUN4Q2hCLE1BQU0sQ0FBQzhCLEVBQUUsQ0FBRXJCLElBQUksRUFBRUwsRUFBRSxJQUFLVyxNQUFNLEdBQUcsR0FBRyxDQUFHLENBQUM7TUFDeENmLE1BQU0sQ0FBQzhCLEVBQUUsQ0FBRXRCLElBQUksRUFBRUosRUFBRSxJQUFLWSxNQUFNLEdBQUcsR0FBRyxDQUFHLENBQUM7TUFDeENoQixNQUFNLENBQUM4QixFQUFFLENBQUVyQixJQUFJLEVBQUVMLEVBQUUsSUFBS1ksTUFBTSxHQUFHLEdBQUcsQ0FBRyxDQUFDOztNQUV4QztNQUNBaEIsTUFBTSxDQUFDVixRQUFRLENBQUVZLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDO01BQy9CRixNQUFNLENBQUNWLFFBQVEsQ0FBRVksTUFBTSxFQUFFdUIsRUFBRSxFQUFFRSxFQUFHLENBQUM7TUFDakMzQixNQUFNLENBQUNWLFFBQVEsQ0FBRVksTUFBTSxFQUFFd0IsRUFBRSxFQUFFRSxFQUFHLENBQUM7TUFDakM1QixNQUFNLENBQUM2QixNQUFNLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFFLENBQUM7TUFDeEI3QixNQUFNLENBQUM2QixNQUFNLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFFLENBQUM7TUFDeEI3QixNQUFNLENBQUM2QixNQUFNLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFFLENBQUM7TUFDeEI3QixNQUFNLENBQUM4QixFQUFFLENBQUVuQixPQUFPLEVBQUUsR0FBSSxDQUFDO01BQ3pCWCxNQUFNLENBQUM4QixFQUFFLENBQUVwQixPQUFPLEVBQUVOLEVBQUUsSUFBS1csTUFBTSxHQUFHLEdBQUcsQ0FBRyxDQUFDO01BQzNDZixNQUFNLENBQUM4QixFQUFFLENBQUVwQixPQUFPLEVBQUVOLEVBQUUsSUFBS1ksTUFBTSxHQUFHLEdBQUcsQ0FBRyxDQUFDO0lBQzdDO0lBRUEsT0FBT2hCLE1BQU0sQ0FBQytCLFNBQVMsQ0FBQyxDQUFDO0VBQzNCO0FBQ0Y7QUFFQXJFLHFCQUFxQixDQUFDc0UsUUFBUSxDQUFFLHdCQUF3QixFQUFFakUsc0JBQXVCLENBQUMifQ==