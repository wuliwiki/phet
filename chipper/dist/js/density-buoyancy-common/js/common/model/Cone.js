// Copyright 2019-2022, University of Colorado Boulder

/**
 * An up/down cone
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Range from '../../../../dot/js/Range.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Vector3 from '../../../../dot/js/Vector3.js';
import { Shape } from '../../../../kite/js/imports.js';
import optionize from '../../../../phet-core/js/optionize.js';
import IOType from '../../../../tandem/js/types/IOType.js';
import densityBuoyancyCommon from '../../densityBuoyancyCommon.js';
import Mass, { MASS_MAX_SHAPES_DIMENSION, MASS_MIN_SHAPES_DIMENSION } from './Mass.js';
import { MassShape } from './MassShape.js';
const BOTTOM_FROM_CENTER_RATIO = 0.25; // center of mass to the bottom is 1/4 of the height of the cone
const TOP_FROM_CENTER_RATIO = 0.75; // center of mass to the tip is 3/4 of the height of the cone

export default class Cone extends Mass {
  // Step information

  constructor(engine, radius, height, isVertexUp, providedConfig) {
    const initialVertices = Cone.getConeVertices(radius, height, isVertexUp);
    const config = optionize()({
      body: engine.createFromVertices(initialVertices, false),
      shape: Shape.polygon(initialVertices),
      volume: Cone.getVolume(radius, height),
      massShape: isVertexUp ? MassShape.CONE : MassShape.INVERTED_CONE,
      phetioType: Cone.ConeIO
    }, providedConfig);
    assert && assert(!config.canRotate);
    super(engine, config);
    this.radiusProperty = new NumberProperty(radius, {
      tandem: config.tandem.createTandem('radiusProperty'),
      range: new Range(0, Number.POSITIVE_INFINITY)
    });
    this.heightProperty = new NumberProperty(height, {
      tandem: config.tandem.createTandem('heightProperty'),
      range: new Range(0, Number.POSITIVE_INFINITY)
    });
    this.isVertexUp = isVertexUp;
    this.vertexSign = isVertexUp ? 1 : -1;
    this.stepRadius = 0;
    this.stepHeight = 0;
    this.stepArea = 0;
    this.stepMaximumVolume = 0;
    this.updateSize(radius, height);
  }

  /**
   * Updates the size of the cone.
   */
  updateSize(radius, height) {
    const vertices = Cone.getConeVertices(radius, height, this.isVertexUp);
    this.engine.updateFromVertices(this.body, vertices, false);
    this.radiusProperty.value = radius;
    this.heightProperty.value = height;
    this.shapeProperty.value = Shape.polygon(vertices);
    this.volumeLock = true;
    this.volumeProperty.value = Cone.getVolume(radius, height);
    this.volumeLock = false;
    this.forceOffsetProperty.value = new Vector3(0, 0, 0);
    this.massOffsetProperty.value = new Vector3(0, -this.heightProperty.value * (this.isVertexUp ? 0.1 : 0.6), radius * 0.7);
  }

  /**
   * Returns the radius from a general size scale
   */
  static getRadiusFromRatio(widthRatio) {
    // Left independent from getHeightFromRatio since these should be not tied together
    return (MASS_MIN_SHAPES_DIMENSION + widthRatio * (MASS_MAX_SHAPES_DIMENSION - MASS_MIN_SHAPES_DIMENSION)) / 2;
  }

  /**
   * Returns the height from a general size scale
   */
  static getHeightFromRatio(heightRatio) {
    // Left independent from getRadiusFromRatio since these should be not tied together
    return MASS_MIN_SHAPES_DIMENSION + heightRatio * (MASS_MAX_SHAPES_DIMENSION - MASS_MIN_SHAPES_DIMENSION);
  }

  /**
   * Sets the general size of the mass based on a general size scale.
   */
  setRatios(widthRatio, heightRatio) {
    this.updateSize(Cone.getRadiusFromRatio(widthRatio), Cone.getHeightFromRatio(heightRatio));
  }

  /**
   * Called after a engine-physics-model step once before doing other operations (like computing buoyant forces,
   * displacement, etc.) so that it can set high-performance flags used for this purpose.
   *
   * Type-specific values are likely to be set, but this should set at least stepX/stepBottom/stepTop
   */
  updateStepInformation() {
    super.updateStepInformation();
    const xOffset = this.stepMatrix.m02();
    const yOffset = this.stepMatrix.m12();
    this.stepX = xOffset;
    this.stepBottom = yOffset - this.heightProperty.value * (this.isVertexUp ? BOTTOM_FROM_CENTER_RATIO : TOP_FROM_CENTER_RATIO);
    this.stepTop = yOffset + this.heightProperty.value * (this.isVertexUp ? TOP_FROM_CENTER_RATIO : BOTTOM_FROM_CENTER_RATIO);
    this.stepRadius = this.radiusProperty.value;
    this.stepHeight = this.heightProperty.value;
    this.stepArea = Math.PI * this.stepRadius * this.stepRadius;
    this.stepMaximumVolume = this.stepArea * this.heightProperty.value / 3;
  }

  /**
   * If there is an intersection with the ray and this mass, the t-value (distance the ray would need to travel to
   * reach the intersection, e.g. ray.position + ray.distance * t === intersectionPoint) will be returned. Otherwise
   * if there is no intersection, null will be returned.
   */
  intersect(ray, isTouch) {
    const translation = this.matrix.getTranslation().toVector3();
    const height = this.heightProperty.value;
    const radius = this.radiusProperty.value;
    const tipY = translation.y + this.vertexSign * height * TOP_FROM_CENTER_RATIO;
    const baseY = translation.y - this.vertexSign * height * BOTTOM_FROM_CENTER_RATIO;
    const cos = radius / height;
    const cosSquared = cos * cos;
    const cosSquaredInverse = 1 / cosSquared;
    const relativePosition = ray.position.minusXYZ(translation.x, tipY, translation.z);
    const a = cosSquaredInverse * (ray.direction.x * ray.direction.x + ray.direction.z * ray.direction.z) - ray.direction.y * ray.direction.y;
    const b = cosSquaredInverse * 2 * (relativePosition.x * ray.direction.x + relativePosition.z * ray.direction.z) - 2 * relativePosition.y * ray.direction.y;
    const c = cosSquaredInverse * (relativePosition.x * relativePosition.x + relativePosition.z * relativePosition.z) - relativePosition.y * relativePosition.y;
    const tValues = Utils.solveQuadraticRootsReal(a, b, c).filter(t => {
      if (t <= 0) {
        return false;
      }
      const y = ray.pointAtDistance(t).y;
      if (this.isVertexUp) {
        return y < tipY && y > baseY;
      } else {
        return y > tipY && y < baseY;
      }
    });
    if (tValues.length) {
      return tValues[0];
    } else {
      return null;
    }
  }

  /**
   * Returns the cumulative displaced volume of this object up to a given y level.
   *
   * Assumes step information was updated.
   */
  getDisplacedArea(liquidLevel) {
    if (liquidLevel < this.stepBottom || liquidLevel > this.stepTop) {
      return 0;
    } else {
      let ratio = (liquidLevel - this.stepBottom) / (this.stepTop - this.stepBottom);
      if (this.isVertexUp) {
        ratio = 1 - ratio;
      }
      const radius = this.stepRadius * ratio;
      return Math.PI * radius * radius;
    }
  }

  /**
   * Returns the displaced volume of this object up to a given y level, assuming a y value for the given liquid level.
   *
   * Assumes step information was updated.
   */
  getDisplacedVolume(liquidLevel) {
    if (liquidLevel <= this.stepBottom) {
      return 0;
    } else if (liquidLevel >= this.stepTop) {
      return this.stepMaximumVolume;
    } else {
      const ratio = (liquidLevel - this.stepBottom) / (this.stepTop - this.stepBottom);
      if (this.isVertexUp) {
        // a = pi * ( r * ( 1 - t ) )^2 = pi * r^2 * ( 1 - t )^2 = ( pi * r^2 ) - ( pi * r^2 * t^2 )
        // v = pi * r^2 * t - 1/3 pi * r^2 * t^3 = pi * r^2 * ( t - 1/3 t^3 )
        return this.stepArea * this.heightProperty.value * (ratio * (3 + ratio * (ratio - 3))) / 3;
      } else {
        // a = pi * (r*t)^2 = pi * r^2 * t^2
        // v = 1/3 pi * r^2 * t^3
        return this.stepArea * this.heightProperty.value * ratio * ratio * ratio / 3;
      }
    }
  }

  /**
   * Resets things to their original values.
   */
  reset() {
    this.radiusProperty.reset();
    this.heightProperty.reset();
    this.updateSize(this.radiusProperty.value, this.heightProperty.value);
    super.reset();
  }

  /**
   * Releases references
   */
  dispose() {
    this.radiusProperty.dispose();
    this.heightProperty.dispose();
    super.dispose();
  }

  /**
   * Returns an array of vertices for the 2d physics model
   */
  static getConeVertices(radius, height, isVertexUp) {
    const vertexSign = isVertexUp ? 1 : -1;
    return [new Vector2(0, TOP_FROM_CENTER_RATIO * vertexSign * height), new Vector2(-vertexSign * radius, -BOTTOM_FROM_CENTER_RATIO * vertexSign * height), new Vector2(vertexSign * radius, -BOTTOM_FROM_CENTER_RATIO * vertexSign * height)];
  }

  /**
   * Returns the volume of a cone with the given radius and height.
   */
  static getVolume(radius, height) {
    return Math.PI * radius * radius * height / 3;
  }
  static ConeIO = new IOType('ConeIO', {
    valueType: Cone,
    supertype: Mass.MassIO,
    documentation: 'Represents an up/down cone'
  });
}
densityBuoyancyCommon.register('Cone', Cone);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOdW1iZXJQcm9wZXJ0eSIsIlJhbmdlIiwiVXRpbHMiLCJWZWN0b3IyIiwiVmVjdG9yMyIsIlNoYXBlIiwib3B0aW9uaXplIiwiSU9UeXBlIiwiZGVuc2l0eUJ1b3lhbmN5Q29tbW9uIiwiTWFzcyIsIk1BU1NfTUFYX1NIQVBFU19ESU1FTlNJT04iLCJNQVNTX01JTl9TSEFQRVNfRElNRU5TSU9OIiwiTWFzc1NoYXBlIiwiQk9UVE9NX0ZST01fQ0VOVEVSX1JBVElPIiwiVE9QX0ZST01fQ0VOVEVSX1JBVElPIiwiQ29uZSIsImNvbnN0cnVjdG9yIiwiZW5naW5lIiwicmFkaXVzIiwiaGVpZ2h0IiwiaXNWZXJ0ZXhVcCIsInByb3ZpZGVkQ29uZmlnIiwiaW5pdGlhbFZlcnRpY2VzIiwiZ2V0Q29uZVZlcnRpY2VzIiwiY29uZmlnIiwiYm9keSIsImNyZWF0ZUZyb21WZXJ0aWNlcyIsInNoYXBlIiwicG9seWdvbiIsInZvbHVtZSIsImdldFZvbHVtZSIsIm1hc3NTaGFwZSIsIkNPTkUiLCJJTlZFUlRFRF9DT05FIiwicGhldGlvVHlwZSIsIkNvbmVJTyIsImFzc2VydCIsImNhblJvdGF0ZSIsInJhZGl1c1Byb3BlcnR5IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwicmFuZ2UiLCJOdW1iZXIiLCJQT1NJVElWRV9JTkZJTklUWSIsImhlaWdodFByb3BlcnR5IiwidmVydGV4U2lnbiIsInN0ZXBSYWRpdXMiLCJzdGVwSGVpZ2h0Iiwic3RlcEFyZWEiLCJzdGVwTWF4aW11bVZvbHVtZSIsInVwZGF0ZVNpemUiLCJ2ZXJ0aWNlcyIsInVwZGF0ZUZyb21WZXJ0aWNlcyIsInZhbHVlIiwic2hhcGVQcm9wZXJ0eSIsInZvbHVtZUxvY2siLCJ2b2x1bWVQcm9wZXJ0eSIsImZvcmNlT2Zmc2V0UHJvcGVydHkiLCJtYXNzT2Zmc2V0UHJvcGVydHkiLCJnZXRSYWRpdXNGcm9tUmF0aW8iLCJ3aWR0aFJhdGlvIiwiZ2V0SGVpZ2h0RnJvbVJhdGlvIiwiaGVpZ2h0UmF0aW8iLCJzZXRSYXRpb3MiLCJ1cGRhdGVTdGVwSW5mb3JtYXRpb24iLCJ4T2Zmc2V0Iiwic3RlcE1hdHJpeCIsIm0wMiIsInlPZmZzZXQiLCJtMTIiLCJzdGVwWCIsInN0ZXBCb3R0b20iLCJzdGVwVG9wIiwiTWF0aCIsIlBJIiwiaW50ZXJzZWN0IiwicmF5IiwiaXNUb3VjaCIsInRyYW5zbGF0aW9uIiwibWF0cml4IiwiZ2V0VHJhbnNsYXRpb24iLCJ0b1ZlY3RvcjMiLCJ0aXBZIiwieSIsImJhc2VZIiwiY29zIiwiY29zU3F1YXJlZCIsImNvc1NxdWFyZWRJbnZlcnNlIiwicmVsYXRpdmVQb3NpdGlvbiIsInBvc2l0aW9uIiwibWludXNYWVoiLCJ4IiwieiIsImEiLCJkaXJlY3Rpb24iLCJiIiwiYyIsInRWYWx1ZXMiLCJzb2x2ZVF1YWRyYXRpY1Jvb3RzUmVhbCIsImZpbHRlciIsInQiLCJwb2ludEF0RGlzdGFuY2UiLCJsZW5ndGgiLCJnZXREaXNwbGFjZWRBcmVhIiwibGlxdWlkTGV2ZWwiLCJyYXRpbyIsImdldERpc3BsYWNlZFZvbHVtZSIsInJlc2V0IiwiZGlzcG9zZSIsInZhbHVlVHlwZSIsInN1cGVydHlwZSIsIk1hc3NJTyIsImRvY3VtZW50YXRpb24iLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNvbmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQW4gdXAvZG93biBjb25lXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IFJheTMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JheTMuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMy5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBJT1R5cGUgZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0lPVHlwZS5qcyc7XHJcbmltcG9ydCBkZW5zaXR5QnVveWFuY3lDb21tb24gZnJvbSAnLi4vLi4vZGVuc2l0eUJ1b3lhbmN5Q29tbW9uLmpzJztcclxuaW1wb3J0IE1hc3MsIHsgSW5zdHJ1bWVudGVkTWFzc09wdGlvbnMsIE1BU1NfTUFYX1NIQVBFU19ESU1FTlNJT04sIE1BU1NfTUlOX1NIQVBFU19ESU1FTlNJT04sIE1hc3NPcHRpb25zIH0gZnJvbSAnLi9NYXNzLmpzJztcclxuaW1wb3J0IFBoeXNpY3NFbmdpbmUgZnJvbSAnLi9QaHlzaWNzRW5naW5lLmpzJztcclxuaW1wb3J0IHsgTWFzc1NoYXBlIH0gZnJvbSAnLi9NYXNzU2hhcGUuanMnO1xyXG5cclxuY29uc3QgQk9UVE9NX0ZST01fQ0VOVEVSX1JBVElPID0gMC4yNTsgLy8gY2VudGVyIG9mIG1hc3MgdG8gdGhlIGJvdHRvbSBpcyAxLzQgb2YgdGhlIGhlaWdodCBvZiB0aGUgY29uZVxyXG5jb25zdCBUT1BfRlJPTV9DRU5URVJfUkFUSU8gPSAwLjc1OyAvLyBjZW50ZXIgb2YgbWFzcyB0byB0aGUgdGlwIGlzIDMvNCBvZiB0aGUgaGVpZ2h0IG9mIHRoZSBjb25lXHJcblxyXG5leHBvcnQgdHlwZSBDb25lT3B0aW9ucyA9IFN0cmljdE9taXQ8SW5zdHJ1bWVudGVkTWFzc09wdGlvbnMsICdib2R5JyB8ICdzaGFwZScgfCAndm9sdW1lJyB8ICdtYXNzU2hhcGUnPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbmUgZXh0ZW5kcyBNYXNzIHtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IHJhZGl1c1Byb3BlcnR5OiBQcm9wZXJ0eTxudW1iZXI+O1xyXG4gIHB1YmxpYyByZWFkb25seSBoZWlnaHRQcm9wZXJ0eTogUHJvcGVydHk8bnVtYmVyPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgaXNWZXJ0ZXhVcDogYm9vbGVhbjtcclxuICBwdWJsaWMgcmVhZG9ubHkgdmVydGV4U2lnbjogbnVtYmVyO1xyXG5cclxuICAvLyBTdGVwIGluZm9ybWF0aW9uXHJcbiAgcHVibGljIHN0ZXBSYWRpdXM6IG51bWJlcjtcclxuICBwdWJsaWMgc3RlcEhlaWdodDogbnVtYmVyO1xyXG4gIHB1YmxpYyBzdGVwQXJlYTogbnVtYmVyO1xyXG4gIHB1YmxpYyBzdGVwTWF4aW11bVZvbHVtZTogbnVtYmVyO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGVuZ2luZTogUGh5c2ljc0VuZ2luZSwgcmFkaXVzOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBpc1ZlcnRleFVwOiBib29sZWFuLCBwcm92aWRlZENvbmZpZzogQ29uZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3QgaW5pdGlhbFZlcnRpY2VzID0gQ29uZS5nZXRDb25lVmVydGljZXMoIHJhZGl1cywgaGVpZ2h0LCBpc1ZlcnRleFVwICk7XHJcblxyXG4gICAgY29uc3QgY29uZmlnID0gb3B0aW9uaXplPENvbmVPcHRpb25zLCBFbXB0eVNlbGZPcHRpb25zLCBNYXNzT3B0aW9ucz4oKSgge1xyXG4gICAgICBib2R5OiBlbmdpbmUuY3JlYXRlRnJvbVZlcnRpY2VzKCBpbml0aWFsVmVydGljZXMsIGZhbHNlICksXHJcbiAgICAgIHNoYXBlOiBTaGFwZS5wb2x5Z29uKCBpbml0aWFsVmVydGljZXMgKSxcclxuICAgICAgdm9sdW1lOiBDb25lLmdldFZvbHVtZSggcmFkaXVzLCBoZWlnaHQgKSxcclxuICAgICAgbWFzc1NoYXBlOiBpc1ZlcnRleFVwID8gTWFzc1NoYXBlLkNPTkUgOiBNYXNzU2hhcGUuSU5WRVJURURfQ09ORSxcclxuXHJcbiAgICAgIHBoZXRpb1R5cGU6IENvbmUuQ29uZUlPXHJcbiAgICB9LCBwcm92aWRlZENvbmZpZyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICFjb25maWcuY2FuUm90YXRlICk7XHJcblxyXG4gICAgc3VwZXIoIGVuZ2luZSwgY29uZmlnIGFzIEluc3RydW1lbnRlZE1hc3NPcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5yYWRpdXNQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggcmFkaXVzLCB7XHJcbiAgICAgIHRhbmRlbTogY29uZmlnLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdyYWRpdXNQcm9wZXJ0eScgKSxcclxuICAgICAgcmFuZ2U6IG5ldyBSYW5nZSggMCwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuaGVpZ2h0UHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIGhlaWdodCwge1xyXG4gICAgICB0YW5kZW06IGNvbmZpZy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnaGVpZ2h0UHJvcGVydHknICksXHJcbiAgICAgIHJhbmdlOiBuZXcgUmFuZ2UoIDAsIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5pc1ZlcnRleFVwID0gaXNWZXJ0ZXhVcDtcclxuICAgIHRoaXMudmVydGV4U2lnbiA9IGlzVmVydGV4VXAgPyAxIDogLTE7XHJcbiAgICB0aGlzLnN0ZXBSYWRpdXMgPSAwO1xyXG4gICAgdGhpcy5zdGVwSGVpZ2h0ID0gMDtcclxuICAgIHRoaXMuc3RlcEFyZWEgPSAwO1xyXG4gICAgdGhpcy5zdGVwTWF4aW11bVZvbHVtZSA9IDA7XHJcblxyXG4gICAgdGhpcy51cGRhdGVTaXplKCByYWRpdXMsIGhlaWdodCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlcyB0aGUgc2l6ZSBvZiB0aGUgY29uZS5cclxuICAgKi9cclxuICBwdWJsaWMgdXBkYXRlU2l6ZSggcmFkaXVzOiBudW1iZXIsIGhlaWdodDogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgY29uc3QgdmVydGljZXMgPSBDb25lLmdldENvbmVWZXJ0aWNlcyggcmFkaXVzLCBoZWlnaHQsIHRoaXMuaXNWZXJ0ZXhVcCApO1xyXG5cclxuICAgIHRoaXMuZW5naW5lLnVwZGF0ZUZyb21WZXJ0aWNlcyggdGhpcy5ib2R5LCB2ZXJ0aWNlcywgZmFsc2UgKTtcclxuXHJcbiAgICB0aGlzLnJhZGl1c1Byb3BlcnR5LnZhbHVlID0gcmFkaXVzO1xyXG4gICAgdGhpcy5oZWlnaHRQcm9wZXJ0eS52YWx1ZSA9IGhlaWdodDtcclxuXHJcbiAgICB0aGlzLnNoYXBlUHJvcGVydHkudmFsdWUgPSBTaGFwZS5wb2x5Z29uKCB2ZXJ0aWNlcyApO1xyXG5cclxuICAgIHRoaXMudm9sdW1lTG9jayA9IHRydWU7XHJcbiAgICB0aGlzLnZvbHVtZVByb3BlcnR5LnZhbHVlID0gQ29uZS5nZXRWb2x1bWUoIHJhZGl1cywgaGVpZ2h0ICk7XHJcbiAgICB0aGlzLnZvbHVtZUxvY2sgPSBmYWxzZTtcclxuXHJcbiAgICB0aGlzLmZvcmNlT2Zmc2V0UHJvcGVydHkudmFsdWUgPSBuZXcgVmVjdG9yMyggMCwgMCwgMCApO1xyXG4gICAgdGhpcy5tYXNzT2Zmc2V0UHJvcGVydHkudmFsdWUgPSBuZXcgVmVjdG9yMyggMCwgLXRoaXMuaGVpZ2h0UHJvcGVydHkudmFsdWUgKiAoIHRoaXMuaXNWZXJ0ZXhVcCA/IDAuMSA6IDAuNiApLCByYWRpdXMgKiAwLjcgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIHJhZGl1cyBmcm9tIGEgZ2VuZXJhbCBzaXplIHNjYWxlXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBnZXRSYWRpdXNGcm9tUmF0aW8oIHdpZHRoUmF0aW86IG51bWJlciApOiBudW1iZXIge1xyXG4gICAgLy8gTGVmdCBpbmRlcGVuZGVudCBmcm9tIGdldEhlaWdodEZyb21SYXRpbyBzaW5jZSB0aGVzZSBzaG91bGQgYmUgbm90IHRpZWQgdG9nZXRoZXJcclxuICAgIHJldHVybiAoIE1BU1NfTUlOX1NIQVBFU19ESU1FTlNJT04gKyB3aWR0aFJhdGlvICogKCBNQVNTX01BWF9TSEFQRVNfRElNRU5TSU9OIC0gTUFTU19NSU5fU0hBUEVTX0RJTUVOU0lPTiApICkgLyAyO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgaGVpZ2h0IGZyb20gYSBnZW5lcmFsIHNpemUgc2NhbGVcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGdldEhlaWdodEZyb21SYXRpbyggaGVpZ2h0UmF0aW86IG51bWJlciApOiBudW1iZXIge1xyXG4gICAgLy8gTGVmdCBpbmRlcGVuZGVudCBmcm9tIGdldFJhZGl1c0Zyb21SYXRpbyBzaW5jZSB0aGVzZSBzaG91bGQgYmUgbm90IHRpZWQgdG9nZXRoZXJcclxuICAgIHJldHVybiAoIE1BU1NfTUlOX1NIQVBFU19ESU1FTlNJT04gKyBoZWlnaHRSYXRpbyAqICggTUFTU19NQVhfU0hBUEVTX0RJTUVOU0lPTiAtIE1BU1NfTUlOX1NIQVBFU19ESU1FTlNJT04gKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgZ2VuZXJhbCBzaXplIG9mIHRoZSBtYXNzIGJhc2VkIG9uIGEgZ2VuZXJhbCBzaXplIHNjYWxlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRSYXRpb3MoIHdpZHRoUmF0aW86IG51bWJlciwgaGVpZ2h0UmF0aW86IG51bWJlciApOiB2b2lkIHtcclxuICAgIHRoaXMudXBkYXRlU2l6ZShcclxuICAgICAgQ29uZS5nZXRSYWRpdXNGcm9tUmF0aW8oIHdpZHRoUmF0aW8gKSxcclxuICAgICAgQ29uZS5nZXRIZWlnaHRGcm9tUmF0aW8oIGhlaWdodFJhdGlvIClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxsZWQgYWZ0ZXIgYSBlbmdpbmUtcGh5c2ljcy1tb2RlbCBzdGVwIG9uY2UgYmVmb3JlIGRvaW5nIG90aGVyIG9wZXJhdGlvbnMgKGxpa2UgY29tcHV0aW5nIGJ1b3lhbnQgZm9yY2VzLFxyXG4gICAqIGRpc3BsYWNlbWVudCwgZXRjLikgc28gdGhhdCBpdCBjYW4gc2V0IGhpZ2gtcGVyZm9ybWFuY2UgZmxhZ3MgdXNlZCBmb3IgdGhpcyBwdXJwb3NlLlxyXG4gICAqXHJcbiAgICogVHlwZS1zcGVjaWZpYyB2YWx1ZXMgYXJlIGxpa2VseSB0byBiZSBzZXQsIGJ1dCB0aGlzIHNob3VsZCBzZXQgYXQgbGVhc3Qgc3RlcFgvc3RlcEJvdHRvbS9zdGVwVG9wXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIHVwZGF0ZVN0ZXBJbmZvcm1hdGlvbigpOiB2b2lkIHtcclxuICAgIHN1cGVyLnVwZGF0ZVN0ZXBJbmZvcm1hdGlvbigpO1xyXG5cclxuICAgIGNvbnN0IHhPZmZzZXQgPSB0aGlzLnN0ZXBNYXRyaXgubTAyKCk7XHJcbiAgICBjb25zdCB5T2Zmc2V0ID0gdGhpcy5zdGVwTWF0cml4Lm0xMigpO1xyXG5cclxuICAgIHRoaXMuc3RlcFggPSB4T2Zmc2V0O1xyXG4gICAgdGhpcy5zdGVwQm90dG9tID0geU9mZnNldCAtIHRoaXMuaGVpZ2h0UHJvcGVydHkudmFsdWUgKiAoIHRoaXMuaXNWZXJ0ZXhVcCA/IEJPVFRPTV9GUk9NX0NFTlRFUl9SQVRJTyA6IFRPUF9GUk9NX0NFTlRFUl9SQVRJTyApO1xyXG4gICAgdGhpcy5zdGVwVG9wID0geU9mZnNldCArIHRoaXMuaGVpZ2h0UHJvcGVydHkudmFsdWUgKiAoIHRoaXMuaXNWZXJ0ZXhVcCA/IFRPUF9GUk9NX0NFTlRFUl9SQVRJTyA6IEJPVFRPTV9GUk9NX0NFTlRFUl9SQVRJTyApO1xyXG5cclxuICAgIHRoaXMuc3RlcFJhZGl1cyA9IHRoaXMucmFkaXVzUHJvcGVydHkudmFsdWU7XHJcbiAgICB0aGlzLnN0ZXBIZWlnaHQgPSB0aGlzLmhlaWdodFByb3BlcnR5LnZhbHVlO1xyXG4gICAgdGhpcy5zdGVwQXJlYSA9IE1hdGguUEkgKiB0aGlzLnN0ZXBSYWRpdXMgKiB0aGlzLnN0ZXBSYWRpdXM7XHJcbiAgICB0aGlzLnN0ZXBNYXhpbXVtVm9sdW1lID0gdGhpcy5zdGVwQXJlYSAqIHRoaXMuaGVpZ2h0UHJvcGVydHkudmFsdWUgLyAzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSWYgdGhlcmUgaXMgYW4gaW50ZXJzZWN0aW9uIHdpdGggdGhlIHJheSBhbmQgdGhpcyBtYXNzLCB0aGUgdC12YWx1ZSAoZGlzdGFuY2UgdGhlIHJheSB3b3VsZCBuZWVkIHRvIHRyYXZlbCB0b1xyXG4gICAqIHJlYWNoIHRoZSBpbnRlcnNlY3Rpb24sIGUuZy4gcmF5LnBvc2l0aW9uICsgcmF5LmRpc3RhbmNlICogdCA9PT0gaW50ZXJzZWN0aW9uUG9pbnQpIHdpbGwgYmUgcmV0dXJuZWQuIE90aGVyd2lzZVxyXG4gICAqIGlmIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbiwgbnVsbCB3aWxsIGJlIHJldHVybmVkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBpbnRlcnNlY3QoIHJheTogUmF5MywgaXNUb3VjaDogYm9vbGVhbiApOiBudW1iZXIgfCBudWxsIHtcclxuICAgIGNvbnN0IHRyYW5zbGF0aW9uID0gdGhpcy5tYXRyaXguZ2V0VHJhbnNsYXRpb24oKS50b1ZlY3RvcjMoKTtcclxuICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuaGVpZ2h0UHJvcGVydHkudmFsdWU7XHJcbiAgICBjb25zdCByYWRpdXMgPSB0aGlzLnJhZGl1c1Byb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgIGNvbnN0IHRpcFkgPSB0cmFuc2xhdGlvbi55ICsgdGhpcy52ZXJ0ZXhTaWduICogaGVpZ2h0ICogVE9QX0ZST01fQ0VOVEVSX1JBVElPO1xyXG4gICAgY29uc3QgYmFzZVkgPSB0cmFuc2xhdGlvbi55IC0gdGhpcy52ZXJ0ZXhTaWduICogaGVpZ2h0ICogQk9UVE9NX0ZST01fQ0VOVEVSX1JBVElPO1xyXG4gICAgY29uc3QgY29zID0gcmFkaXVzIC8gaGVpZ2h0O1xyXG4gICAgY29uc3QgY29zU3F1YXJlZCA9IGNvcyAqIGNvcztcclxuICAgIGNvbnN0IGNvc1NxdWFyZWRJbnZlcnNlID0gMSAvIGNvc1NxdWFyZWQ7XHJcblxyXG4gICAgY29uc3QgcmVsYXRpdmVQb3NpdGlvbiA9IHJheS5wb3NpdGlvbi5taW51c1hZWiggdHJhbnNsYXRpb24ueCwgdGlwWSwgdHJhbnNsYXRpb24ueiApO1xyXG5cclxuICAgIGNvbnN0IGEgPSBjb3NTcXVhcmVkSW52ZXJzZSAqICggcmF5LmRpcmVjdGlvbi54ICogcmF5LmRpcmVjdGlvbi54ICsgcmF5LmRpcmVjdGlvbi56ICogcmF5LmRpcmVjdGlvbi56ICkgLSByYXkuZGlyZWN0aW9uLnkgKiByYXkuZGlyZWN0aW9uLnk7XHJcbiAgICBjb25zdCBiID0gY29zU3F1YXJlZEludmVyc2UgKiAyICogKCByZWxhdGl2ZVBvc2l0aW9uLnggKiByYXkuZGlyZWN0aW9uLnggKyByZWxhdGl2ZVBvc2l0aW9uLnogKiByYXkuZGlyZWN0aW9uLnogKSAtIDIgKiByZWxhdGl2ZVBvc2l0aW9uLnkgKiByYXkuZGlyZWN0aW9uLnk7XHJcbiAgICBjb25zdCBjID0gY29zU3F1YXJlZEludmVyc2UgKiAoIHJlbGF0aXZlUG9zaXRpb24ueCAqIHJlbGF0aXZlUG9zaXRpb24ueCArIHJlbGF0aXZlUG9zaXRpb24ueiAqIHJlbGF0aXZlUG9zaXRpb24ueiApIC0gcmVsYXRpdmVQb3NpdGlvbi55ICogcmVsYXRpdmVQb3NpdGlvbi55O1xyXG5cclxuICAgIGNvbnN0IHRWYWx1ZXMgPSBVdGlscy5zb2x2ZVF1YWRyYXRpY1Jvb3RzUmVhbCggYSwgYiwgYyApIS5maWx0ZXIoIHQgPT4ge1xyXG4gICAgICBpZiAoIHQgPD0gMCApIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgeSA9IHJheS5wb2ludEF0RGlzdGFuY2UoIHQgKS55O1xyXG4gICAgICBpZiAoIHRoaXMuaXNWZXJ0ZXhVcCApIHtcclxuICAgICAgICByZXR1cm4geSA8IHRpcFkgJiYgeSA+IGJhc2VZO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB5ID4gdGlwWSAmJiB5IDwgYmFzZVk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICBpZiAoIHRWYWx1ZXMubGVuZ3RoICkge1xyXG4gICAgICByZXR1cm4gdFZhbHVlc1sgMCBdO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgY3VtdWxhdGl2ZSBkaXNwbGFjZWQgdm9sdW1lIG9mIHRoaXMgb2JqZWN0IHVwIHRvIGEgZ2l2ZW4geSBsZXZlbC5cclxuICAgKlxyXG4gICAqIEFzc3VtZXMgc3RlcCBpbmZvcm1hdGlvbiB3YXMgdXBkYXRlZC5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RGlzcGxhY2VkQXJlYSggbGlxdWlkTGV2ZWw6IG51bWJlciApOiBudW1iZXIge1xyXG4gICAgaWYgKCBsaXF1aWRMZXZlbCA8IHRoaXMuc3RlcEJvdHRvbSB8fCBsaXF1aWRMZXZlbCA+IHRoaXMuc3RlcFRvcCApIHtcclxuICAgICAgcmV0dXJuIDA7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgbGV0IHJhdGlvID0gKCBsaXF1aWRMZXZlbCAtIHRoaXMuc3RlcEJvdHRvbSApIC8gKCB0aGlzLnN0ZXBUb3AgLSB0aGlzLnN0ZXBCb3R0b20gKTtcclxuICAgICAgaWYgKCB0aGlzLmlzVmVydGV4VXAgKSB7XHJcbiAgICAgICAgcmF0aW8gPSAxIC0gcmF0aW87XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgcmFkaXVzID0gdGhpcy5zdGVwUmFkaXVzICogcmF0aW87XHJcbiAgICAgIHJldHVybiBNYXRoLlBJICogcmFkaXVzICogcmFkaXVzO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgZGlzcGxhY2VkIHZvbHVtZSBvZiB0aGlzIG9iamVjdCB1cCB0byBhIGdpdmVuIHkgbGV2ZWwsIGFzc3VtaW5nIGEgeSB2YWx1ZSBmb3IgdGhlIGdpdmVuIGxpcXVpZCBsZXZlbC5cclxuICAgKlxyXG4gICAqIEFzc3VtZXMgc3RlcCBpbmZvcm1hdGlvbiB3YXMgdXBkYXRlZC5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RGlzcGxhY2VkVm9sdW1lKCBsaXF1aWRMZXZlbDogbnVtYmVyICk6IG51bWJlciB7XHJcbiAgICBpZiAoIGxpcXVpZExldmVsIDw9IHRoaXMuc3RlcEJvdHRvbSApIHtcclxuICAgICAgcmV0dXJuIDA7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggbGlxdWlkTGV2ZWwgPj0gdGhpcy5zdGVwVG9wICkge1xyXG4gICAgICByZXR1cm4gdGhpcy5zdGVwTWF4aW11bVZvbHVtZTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjb25zdCByYXRpbyA9ICggbGlxdWlkTGV2ZWwgLSB0aGlzLnN0ZXBCb3R0b20gKSAvICggdGhpcy5zdGVwVG9wIC0gdGhpcy5zdGVwQm90dG9tICk7XHJcblxyXG4gICAgICBpZiAoIHRoaXMuaXNWZXJ0ZXhVcCApIHtcclxuICAgICAgICAvLyBhID0gcGkgKiAoIHIgKiAoIDEgLSB0ICkgKV4yID0gcGkgKiByXjIgKiAoIDEgLSB0ICleMiA9ICggcGkgKiByXjIgKSAtICggcGkgKiByXjIgKiB0XjIgKVxyXG4gICAgICAgIC8vIHYgPSBwaSAqIHJeMiAqIHQgLSAxLzMgcGkgKiByXjIgKiB0XjMgPSBwaSAqIHJeMiAqICggdCAtIDEvMyB0XjMgKVxyXG4gICAgICAgIHJldHVybiB0aGlzLnN0ZXBBcmVhICogdGhpcy5oZWlnaHRQcm9wZXJ0eS52YWx1ZSAqICggcmF0aW8gKiAoIDMgKyByYXRpbyAqICggcmF0aW8gLSAzICkgKSApIC8gMztcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICAvLyBhID0gcGkgKiAocip0KV4yID0gcGkgKiByXjIgKiB0XjJcclxuICAgICAgICAvLyB2ID0gMS8zIHBpICogcl4yICogdF4zXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RlcEFyZWEgKiB0aGlzLmhlaWdodFByb3BlcnR5LnZhbHVlICogcmF0aW8gKiByYXRpbyAqIHJhdGlvIC8gMztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXRzIHRoaW5ncyB0byB0aGVpciBvcmlnaW5hbCB2YWx1ZXMuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5yYWRpdXNQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5oZWlnaHRQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy51cGRhdGVTaXplKCB0aGlzLnJhZGl1c1Byb3BlcnR5LnZhbHVlLCB0aGlzLmhlaWdodFByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gICAgc3VwZXIucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbGVhc2VzIHJlZmVyZW5jZXNcclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMucmFkaXVzUHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgdGhpcy5oZWlnaHRQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcblxyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyBhbiBhcnJheSBvZiB2ZXJ0aWNlcyBmb3IgdGhlIDJkIHBoeXNpY3MgbW9kZWxcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGdldENvbmVWZXJ0aWNlcyggcmFkaXVzOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBpc1ZlcnRleFVwOiBib29sZWFuICk6IFZlY3RvcjJbXSB7XHJcbiAgICBjb25zdCB2ZXJ0ZXhTaWduID0gaXNWZXJ0ZXhVcCA/IDEgOiAtMTtcclxuXHJcbiAgICByZXR1cm4gW1xyXG4gICAgICBuZXcgVmVjdG9yMiggMCwgVE9QX0ZST01fQ0VOVEVSX1JBVElPICogdmVydGV4U2lnbiAqIGhlaWdodCApLFxyXG4gICAgICBuZXcgVmVjdG9yMiggLXZlcnRleFNpZ24gKiByYWRpdXMsIC1CT1RUT01fRlJPTV9DRU5URVJfUkFUSU8gKiB2ZXJ0ZXhTaWduICogaGVpZ2h0ICksXHJcbiAgICAgIG5ldyBWZWN0b3IyKCB2ZXJ0ZXhTaWduICogcmFkaXVzLCAtQk9UVE9NX0ZST01fQ0VOVEVSX1JBVElPICogdmVydGV4U2lnbiAqIGhlaWdodCApXHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgdm9sdW1lIG9mIGEgY29uZSB3aXRoIHRoZSBnaXZlbiByYWRpdXMgYW5kIGhlaWdodC5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGdldFZvbHVtZSggcmFkaXVzOiBudW1iZXIsIGhlaWdodDogbnVtYmVyICk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gTWF0aC5QSSAqIHJhZGl1cyAqIHJhZGl1cyAqIGhlaWdodCAvIDM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IENvbmVJTyA9IG5ldyBJT1R5cGUoICdDb25lSU8nLCB7XHJcbiAgICB2YWx1ZVR5cGU6IENvbmUsXHJcbiAgICBzdXBlcnR5cGU6IE1hc3MuTWFzc0lPLFxyXG4gICAgZG9jdW1lbnRhdGlvbjogJ1JlcHJlc2VudHMgYW4gdXAvZG93biBjb25lJ1xyXG4gIH0gKTtcclxufVxyXG5cclxuZGVuc2l0eUJ1b3lhbmN5Q29tbW9uLnJlZ2lzdGVyKCAnQ29uZScsIENvbmUgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGNBQWMsTUFBTSx1Q0FBdUM7QUFHbEUsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUUvQyxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxTQUFTQyxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELE9BQU9DLFNBQVMsTUFBNEIsdUNBQXVDO0FBQ25GLE9BQU9DLE1BQU0sTUFBTSx1Q0FBdUM7QUFDMUQsT0FBT0MscUJBQXFCLE1BQU0sZ0NBQWdDO0FBQ2xFLE9BQU9DLElBQUksSUFBNkJDLHlCQUF5QixFQUFFQyx5QkFBeUIsUUFBcUIsV0FBVztBQUU1SCxTQUFTQyxTQUFTLFFBQVEsZ0JBQWdCO0FBRTFDLE1BQU1DLHdCQUF3QixHQUFHLElBQUksQ0FBQyxDQUFDO0FBQ3ZDLE1BQU1DLHFCQUFxQixHQUFHLElBQUksQ0FBQyxDQUFDOztBQUlwQyxlQUFlLE1BQU1DLElBQUksU0FBU04sSUFBSSxDQUFDO0VBT3JDOztFQU1PTyxXQUFXQSxDQUFFQyxNQUFxQixFQUFFQyxNQUFjLEVBQUVDLE1BQWMsRUFBRUMsVUFBbUIsRUFBRUMsY0FBMkIsRUFBRztJQUU1SCxNQUFNQyxlQUFlLEdBQUdQLElBQUksQ0FBQ1EsZUFBZSxDQUFFTCxNQUFNLEVBQUVDLE1BQU0sRUFBRUMsVUFBVyxDQUFDO0lBRTFFLE1BQU1JLE1BQU0sR0FBR2xCLFNBQVMsQ0FBNkMs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