// Copyright 2019-2023, University of Colorado Boulder

/**
 * An axis-aligned cuboid.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Property from '../../../../axon/js/Property.js';
import Bounds3 from '../../../../dot/js/Bounds3.js';
import Matrix3 from '../../../../dot/js/Matrix3.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Vector3 from '../../../../dot/js/Vector3.js';
import { Shape } from '../../../../kite/js/imports.js';
import optionize from '../../../../phet-core/js/optionize.js';
import IOType from '../../../../tandem/js/types/IOType.js';
import densityBuoyancyCommon from '../../densityBuoyancyCommon.js';
import Mass, { MASS_MAX_SHAPES_DIMENSION, MASS_MIN_SHAPES_DIMENSION } from './Mass.js';
import { MassShape } from './MassShape.js';
export default class Cuboid extends Mass {
  // Step information

  constructor(engine, size, providedConfig) {
    const config = optionize()({
      body: engine.createBox(size.width, size.height),
      shape: Shape.rect(size.minX, size.minY, size.width, size.height),
      volume: size.width * size.height * size.depth,
      massShape: MassShape.BLOCK,
      phetioType: Cuboid.CuboidIO
    }, providedConfig);
    assert && assert(!config.canRotate);

    // TODO: Ask MK about why the parent options seem to be made optional, this cast shouldn't be needed
    super(engine, config);
    this.sizeProperty = new Property(size, {
      valueType: Bounds3,
      valueComparisonStrategy: 'equalsFunction',
      tandem: config.tandem.createTandem('sizeProperty'),
      phetioValueType: Bounds3.Bounds3IO,
      phetioReadOnly: true
    });
    this.stepArea = 0;
    this.stepMaximumVolume = 0;
    this.massOffsetOrientationProperty.value = new Vector2(1, -1);
    this.updateSize(size);
  }

  /**
   * Updates the size of the cuboid.
   */
  updateSize(size) {
    // Don't update our model if it's no-volume, we'll have ourselves removed anyway
    if (size.width && size.height) {
      // Shift it vertically to keep the same bottom, see https://github.com/phetsims/density/issues/24
      const oldSize = this.sizeProperty.value;
      this.matrix.multiplyMatrix(Matrix3.translation(0, (size.height - oldSize.height) / 2));
      this.writeData();
      this.engine.updateBox(this.body, size.width, size.height);
      this.sizeProperty.value = size;
      this.shapeProperty.value = Shape.rect(size.minX, size.minY, size.width, size.height);
      this.volumeLock = true;
      this.volumeProperty.value = size.width * size.height * size.depth;
      this.volumeLock = false;
      this.forceOffsetProperty.value = new Vector3(0, 0, size.maxZ);
      this.massOffsetProperty.value = new Vector3(size.minX, size.minY, size.maxZ);
      this.transformedEmitter.emit();
    }
  }

  /**
   * Returns the general size of the mass based on a general size scale.
   */
  static getSizeFromRatios(widthRatio, heightRatio) {
    const x = (MASS_MIN_SHAPES_DIMENSION + widthRatio * (MASS_MAX_SHAPES_DIMENSION - MASS_MIN_SHAPES_DIMENSION)) / 2;
    const y = (MASS_MIN_SHAPES_DIMENSION + heightRatio * (MASS_MAX_SHAPES_DIMENSION - MASS_MIN_SHAPES_DIMENSION)) / 2;
    return new Bounds3(-x, -y, -x, x, y, x);
  }

  /**
   * Sets the general size of the mass based on a general size scale.
   */
  setRatios(widthRatio, heightRatio) {
    this.updateSize(Cuboid.getSizeFromRatios(widthRatio, heightRatio));
  }

  /**
   * Called after an engine-physics-model step once before doing other operations (like computing buoyant forces,
   * displacement, etc.) so that it can set high-performance flags used for this purpose.
   *
   * Type-specific values are likely to be set, but this should set at least stepX/stepBottom/stepTop
   */
  updateStepInformation() {
    super.updateStepInformation();
    const xOffset = this.stepMatrix.m02();
    const yOffset = this.stepMatrix.m12();
    this.stepX = xOffset;
    this.stepBottom = yOffset + this.sizeProperty.value.minY;
    this.stepTop = yOffset + this.sizeProperty.value.maxY;
    this.stepArea = this.sizeProperty.value.width * this.sizeProperty.value.depth;
    this.stepMaximumVolume = this.stepArea * this.sizeProperty.value.height;
  }

  /**
   * If there is an intersection with the ray and this mass, the t-value (distance the ray would need to travel to
   * reach the intersection, e.g. ray.position + ray.distance * t === intersectionPoint) will be returned. Otherwise
   * if there is no intersection, null will be returned.
   */
  intersect(ray, isTouch) {
    const size = this.sizeProperty.value;
    const translation = this.matrix.getTranslation().toVector3();
    return Cuboid.intersect(size, translation, ray);
  }

  /**
   * Returns the cumulative displaced volume of this object up to a given y level.
   *
   * Assumes step information was updated.
   */
  getDisplacedArea(liquidLevel) {
    if (liquidLevel < this.stepBottom || liquidLevel > this.stepTop) {
      return 0;
    } else {
      return this.stepArea;
    }
  }

  /**
   * Returns the displaced volume of this object up to a given y level, assuming a y value for the given liquid level.
   *
   * Assumes step information was updated.
   */
  getDisplacedVolume(liquidLevel) {
    const bottom = this.stepBottom;
    const top = this.stepTop;
    if (liquidLevel <= bottom) {
      return 0;
    } else if (liquidLevel >= top) {
      return this.stepMaximumVolume;
    } else {
      // This is identical to VerticalCylinder's getDisplacedVolume formula, see there if this needs to change.
      return this.stepMaximumVolume * (liquidLevel - bottom) / (top - bottom);
    }
  }

  /**
   * Resets things to their original values.
   */
  reset() {
    this.sizeProperty.reset();
    this.updateSize(this.sizeProperty.value);
    super.reset();
  }

  /**
   * Releases references
   */
  dispose() {
    this.sizeProperty.dispose();
    super.dispose();
  }

  /**
   * Returns a (quick) closest ray intersection with a cuboid (defined by the given Bounds3 and translation).
   */
  static intersect(bounds, translation, ray) {
    let tNear = Number.NEGATIVE_INFINITY;
    let tFar = Number.POSITIVE_INFINITY;
    if (ray.direction.x > 0) {
      tNear = Math.max(tNear, (bounds.minX + translation.x - ray.position.x) / ray.direction.x);
      tFar = Math.min(tFar, (bounds.maxX + translation.x - ray.position.x) / ray.direction.x);
    } else if (ray.direction.x < 0) {
      tNear = Math.max(tNear, (bounds.maxX + translation.x - ray.position.x) / ray.direction.x);
      tFar = Math.min(tFar, (bounds.minX + translation.x - ray.position.x) / ray.direction.x);
    }
    if (ray.direction.y > 0) {
      tNear = Math.max(tNear, (bounds.minY + translation.y - ray.position.y) / ray.direction.y);
      tFar = Math.min(tFar, (bounds.maxY + translation.y - ray.position.y) / ray.direction.y);
    } else if (ray.direction.y < 0) {
      tNear = Math.max(tNear, (bounds.maxY + translation.y - ray.position.y) / ray.direction.y);
      tFar = Math.min(tFar, (bounds.minY + translation.y - ray.position.y) / ray.direction.y);
    }
    if (ray.direction.z > 0) {
      tNear = Math.max(tNear, (bounds.minZ + translation.z - ray.position.z) / ray.direction.z);
      tFar = Math.min(tFar, (bounds.maxZ + translation.z - ray.position.z) / ray.direction.z);
    } else if (ray.direction.z < 0) {
      tNear = Math.max(tNear, (bounds.maxZ + translation.z - ray.position.z) / ray.direction.z);
      tFar = Math.min(tFar, (bounds.minZ + translation.z - ray.position.z) / ray.direction.z);
    }
    return tNear >= tFar ? null : tNear >= 0 ? tNear : isFinite(tFar) && tFar >= 0 ? tFar : null;
  }
  static CuboidIO = new IOType('CuboidIO', {
    valueType: Cuboid,
    supertype: Mass.MassIO,
    documentation: 'Represents an axis-aligned cuboid mass',
    stateSchema: {
      size: Bounds3.Bounds3IO
    },
    toStateObject: cuboid => {
      const parentStateObject = Mass.MassIO.toStateObject(cuboid);
      return {
        ...parentStateObject,
        size: Bounds3.Bounds3IO.toStateObject(cuboid.sizeProperty.value)
      };
    },
    applyState: (cuboid, stateObject) => {
      // Apply size update first, and with the very specific update method
      cuboid.updateSize(Bounds3.Bounds3IO.fromStateObject(stateObject.size));
      Mass.MassIO.applyState(cuboid, stateObject);
    }
  });
}
densityBuoyancyCommon.register('Cuboid', Cuboid);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIkJvdW5kczMiLCJNYXRyaXgzIiwiVmVjdG9yMiIsIlZlY3RvcjMiLCJTaGFwZSIsIm9wdGlvbml6ZSIsIklPVHlwZSIsImRlbnNpdHlCdW95YW5jeUNvbW1vbiIsIk1hc3MiLCJNQVNTX01BWF9TSEFQRVNfRElNRU5TSU9OIiwiTUFTU19NSU5fU0hBUEVTX0RJTUVOU0lPTiIsIk1hc3NTaGFwZSIsIkN1Ym9pZCIsImNvbnN0cnVjdG9yIiwiZW5naW5lIiwic2l6ZSIsInByb3ZpZGVkQ29uZmlnIiwiY29uZmlnIiwiYm9keSIsImNyZWF0ZUJveCIsIndpZHRoIiwiaGVpZ2h0Iiwic2hhcGUiLCJyZWN0IiwibWluWCIsIm1pblkiLCJ2b2x1bWUiLCJkZXB0aCIsIm1hc3NTaGFwZSIsIkJMT0NLIiwicGhldGlvVHlwZSIsIkN1Ym9pZElPIiwiYXNzZXJ0IiwiY2FuUm90YXRlIiwic2l6ZVByb3BlcnR5IiwidmFsdWVUeXBlIiwidmFsdWVDb21wYXJpc29uU3RyYXRlZ3kiLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJwaGV0aW9WYWx1ZVR5cGUiLCJCb3VuZHMzSU8iLCJwaGV0aW9SZWFkT25seSIsInN0ZXBBcmVhIiwic3RlcE1heGltdW1Wb2x1bWUiLCJtYXNzT2Zmc2V0T3JpZW50YXRpb25Qcm9wZXJ0eSIsInZhbHVlIiwidXBkYXRlU2l6ZSIsIm9sZFNpemUiLCJtYXRyaXgiLCJtdWx0aXBseU1hdHJpeCIsInRyYW5zbGF0aW9uIiwid3JpdGVEYXRhIiwidXBkYXRlQm94Iiwic2hhcGVQcm9wZXJ0eSIsInZvbHVtZUxvY2siLCJ2b2x1bWVQcm9wZXJ0eSIsImZvcmNlT2Zmc2V0UHJvcGVydHkiLCJtYXhaIiwibWFzc09mZnNldFByb3BlcnR5IiwidHJhbnNmb3JtZWRFbWl0dGVyIiwiZW1pdCIsImdldFNpemVGcm9tUmF0aW9zIiwid2lkdGhSYXRpbyIsImhlaWdodFJhdGlvIiwieCIsInkiLCJzZXRSYXRpb3MiLCJ1cGRhdGVTdGVwSW5mb3JtYXRpb24iLCJ4T2Zmc2V0Iiwic3RlcE1hdHJpeCIsIm0wMiIsInlPZmZzZXQiLCJtMTIiLCJzdGVwWCIsInN0ZXBCb3R0b20iLCJzdGVwVG9wIiwibWF4WSIsImludGVyc2VjdCIsInJheSIsImlzVG91Y2giLCJnZXRUcmFuc2xhdGlvbiIsInRvVmVjdG9yMyIsImdldERpc3BsYWNlZEFyZWEiLCJsaXF1aWRMZXZlbCIsImdldERpc3BsYWNlZFZvbHVtZSIsImJvdHRvbSIsInRvcCIsInJlc2V0IiwiZGlzcG9zZSIsImJvdW5kcyIsInROZWFyIiwiTnVtYmVyIiwiTkVHQVRJVkVfSU5GSU5JVFkiLCJ0RmFyIiwiUE9TSVRJVkVfSU5GSU5JVFkiLCJkaXJlY3Rpb24iLCJNYXRoIiwibWF4IiwicG9zaXRpb24iLCJtaW4iLCJtYXhYIiwieiIsIm1pbloiLCJpc0Zpbml0ZSIsInN1cGVydHlwZSIsIk1hc3NJTyIsImRvY3VtZW50YXRpb24iLCJzdGF0ZVNjaGVtYSIsInRvU3RhdGVPYmplY3QiLCJjdWJvaWQiLCJwYXJlbnRTdGF0ZU9iamVjdCIsImFwcGx5U3RhdGUiLCJzdGF0ZU9iamVjdCIsImZyb21TdGF0ZU9iamVjdCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQ3Vib2lkLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEFuIGF4aXMtYWxpZ25lZCBjdWJvaWQuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBTdHJpY3RPbWl0IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9TdHJpY3RPbWl0LmpzJztcclxuaW1wb3J0IEJvdW5kczMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0JvdW5kczMuanMnO1xyXG5pbXBvcnQgTWF0cml4MyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvTWF0cml4My5qcyc7XHJcbmltcG9ydCBSYXkzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9SYXkzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMy5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBJT1R5cGUgZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0lPVHlwZS5qcyc7XHJcbmltcG9ydCBkZW5zaXR5QnVveWFuY3lDb21tb24gZnJvbSAnLi4vLi4vZGVuc2l0eUJ1b3lhbmN5Q29tbW9uLmpzJztcclxuaW1wb3J0IE1hc3MsIHsgSW5zdHJ1bWVudGVkTWFzc09wdGlvbnMsIE1BU1NfTUFYX1NIQVBFU19ESU1FTlNJT04sIE1BU1NfTUlOX1NIQVBFU19ESU1FTlNJT04sIE1hc3NJT1N0YXRlT2JqZWN0IH0gZnJvbSAnLi9NYXNzLmpzJztcclxuaW1wb3J0IFBoeXNpY3NFbmdpbmUgZnJvbSAnLi9QaHlzaWNzRW5naW5lLmpzJztcclxuaW1wb3J0IHsgTWFzc1NoYXBlIH0gZnJvbSAnLi9NYXNzU2hhcGUuanMnO1xyXG5cclxuZXhwb3J0IHR5cGUgQ3Vib2lkT3B0aW9ucyA9IFN0cmljdE9taXQ8SW5zdHJ1bWVudGVkTWFzc09wdGlvbnMsICdib2R5JyB8ICdzaGFwZScgfCAndm9sdW1lJyB8ICdtYXNzU2hhcGUnPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEN1Ym9pZCBleHRlbmRzIE1hc3Mge1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgc2l6ZVByb3BlcnR5OiBQcm9wZXJ0eTxCb3VuZHMzPjtcclxuXHJcbiAgLy8gU3RlcCBpbmZvcm1hdGlvblxyXG4gIHB1YmxpYyBzdGVwQXJlYTogbnVtYmVyO1xyXG4gIHB1YmxpYyBzdGVwTWF4aW11bVZvbHVtZTogbnVtYmVyO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGVuZ2luZTogUGh5c2ljc0VuZ2luZSwgc2l6ZTogQm91bmRzMywgcHJvdmlkZWRDb25maWc6IEN1Ym9pZE9wdGlvbnMgKSB7XHJcbiAgICBjb25zdCBjb25maWcgPSBvcHRpb25pemU8Q3Vib2lkT3B0aW9ucywgRW1wdHlTZWxmT3B0aW9ucywgSW5zdHJ1bWVudGVkTWFzc09wdGlvbnM+KCkoIHtcclxuICAgICAgYm9keTogZW5naW5lLmNyZWF0ZUJveCggc2l6ZS53aWR0aCwgc2l6ZS5oZWlnaHQgKSxcclxuICAgICAgc2hhcGU6IFNoYXBlLnJlY3QoIHNpemUubWluWCwgc2l6ZS5taW5ZLCBzaXplLndpZHRoLCBzaXplLmhlaWdodCApLFxyXG4gICAgICB2b2x1bWU6IHNpemUud2lkdGggKiBzaXplLmhlaWdodCAqIHNpemUuZGVwdGgsXHJcbiAgICAgIG1hc3NTaGFwZTogTWFzc1NoYXBlLkJMT0NLLFxyXG4gICAgICBwaGV0aW9UeXBlOiBDdWJvaWQuQ3Vib2lkSU9cclxuICAgIH0sIHByb3ZpZGVkQ29uZmlnICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggIWNvbmZpZy5jYW5Sb3RhdGUgKTtcclxuXHJcbiAgICAvLyBUT0RPOiBBc2sgTUsgYWJvdXQgd2h5IHRoZSBwYXJlbnQgb3B0aW9ucyBzZWVtIHRvIGJlIG1hZGUgb3B0aW9uYWwsIHRoaXMgY2FzdCBzaG91bGRuJ3QgYmUgbmVlZGVkXHJcbiAgICBzdXBlciggZW5naW5lLCBjb25maWcgYXMgSW5zdHJ1bWVudGVkTWFzc09wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLnNpemVQcm9wZXJ0eSA9IG5ldyBQcm9wZXJ0eSggc2l6ZSwge1xyXG4gICAgICB2YWx1ZVR5cGU6IEJvdW5kczMsXHJcbiAgICAgIHZhbHVlQ29tcGFyaXNvblN0cmF0ZWd5OiAnZXF1YWxzRnVuY3Rpb24nLFxyXG4gICAgICB0YW5kZW06IGNvbmZpZy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnc2l6ZVByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9WYWx1ZVR5cGU6IEJvdW5kczMuQm91bmRzM0lPLFxyXG4gICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuc3RlcEFyZWEgPSAwO1xyXG4gICAgdGhpcy5zdGVwTWF4aW11bVZvbHVtZSA9IDA7XHJcbiAgICB0aGlzLm1hc3NPZmZzZXRPcmllbnRhdGlvblByb3BlcnR5LnZhbHVlID0gbmV3IFZlY3RvcjIoIDEsIC0xICk7XHJcblxyXG4gICAgdGhpcy51cGRhdGVTaXplKCBzaXplICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHRoZSBzaXplIG9mIHRoZSBjdWJvaWQuXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZVNpemUoIHNpemU6IEJvdW5kczMgKTogdm9pZCB7XHJcbiAgICAvLyBEb24ndCB1cGRhdGUgb3VyIG1vZGVsIGlmIGl0J3Mgbm8tdm9sdW1lLCB3ZSdsbCBoYXZlIG91cnNlbHZlcyByZW1vdmVkIGFueXdheVxyXG4gICAgaWYgKCBzaXplLndpZHRoICYmIHNpemUuaGVpZ2h0ICkge1xyXG5cclxuICAgICAgLy8gU2hpZnQgaXQgdmVydGljYWxseSB0byBrZWVwIHRoZSBzYW1lIGJvdHRvbSwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9kZW5zaXR5L2lzc3Vlcy8yNFxyXG4gICAgICBjb25zdCBvbGRTaXplID0gdGhpcy5zaXplUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIHRoaXMubWF0cml4Lm11bHRpcGx5TWF0cml4KCBNYXRyaXgzLnRyYW5zbGF0aW9uKCAwLCAoIHNpemUuaGVpZ2h0IC0gb2xkU2l6ZS5oZWlnaHQgKSAvIDIgKSApO1xyXG4gICAgICB0aGlzLndyaXRlRGF0YSgpO1xyXG5cclxuICAgICAgdGhpcy5lbmdpbmUudXBkYXRlQm94KCB0aGlzLmJvZHksIHNpemUud2lkdGgsIHNpemUuaGVpZ2h0ICk7XHJcbiAgICAgIHRoaXMuc2l6ZVByb3BlcnR5LnZhbHVlID0gc2l6ZTtcclxuICAgICAgdGhpcy5zaGFwZVByb3BlcnR5LnZhbHVlID0gU2hhcGUucmVjdCggc2l6ZS5taW5YLCBzaXplLm1pblksIHNpemUud2lkdGgsIHNpemUuaGVpZ2h0ICk7XHJcblxyXG4gICAgICB0aGlzLnZvbHVtZUxvY2sgPSB0cnVlO1xyXG4gICAgICB0aGlzLnZvbHVtZVByb3BlcnR5LnZhbHVlID0gc2l6ZS53aWR0aCAqIHNpemUuaGVpZ2h0ICogc2l6ZS5kZXB0aDtcclxuICAgICAgdGhpcy52b2x1bWVMb2NrID0gZmFsc2U7XHJcblxyXG4gICAgICB0aGlzLmZvcmNlT2Zmc2V0UHJvcGVydHkudmFsdWUgPSBuZXcgVmVjdG9yMyggMCwgMCwgc2l6ZS5tYXhaICk7XHJcbiAgICAgIHRoaXMubWFzc09mZnNldFByb3BlcnR5LnZhbHVlID0gbmV3IFZlY3RvcjMoIHNpemUubWluWCwgc2l6ZS5taW5ZLCBzaXplLm1heFogKTtcclxuXHJcbiAgICAgIHRoaXMudHJhbnNmb3JtZWRFbWl0dGVyLmVtaXQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIGdlbmVyYWwgc2l6ZSBvZiB0aGUgbWFzcyBiYXNlZCBvbiBhIGdlbmVyYWwgc2l6ZSBzY2FsZS5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGdldFNpemVGcm9tUmF0aW9zKCB3aWR0aFJhdGlvOiBudW1iZXIsIGhlaWdodFJhdGlvOiBudW1iZXIgKTogQm91bmRzMyB7XHJcbiAgICBjb25zdCB4ID0gKCBNQVNTX01JTl9TSEFQRVNfRElNRU5TSU9OICsgd2lkdGhSYXRpbyAqICggTUFTU19NQVhfU0hBUEVTX0RJTUVOU0lPTiAtIE1BU1NfTUlOX1NIQVBFU19ESU1FTlNJT04gKSApIC8gMjtcclxuICAgIGNvbnN0IHkgPSAoIE1BU1NfTUlOX1NIQVBFU19ESU1FTlNJT04gKyBoZWlnaHRSYXRpbyAqICggTUFTU19NQVhfU0hBUEVTX0RJTUVOU0lPTiAtIE1BU1NfTUlOX1NIQVBFU19ESU1FTlNJT04gKSApIC8gMjtcclxuICAgIHJldHVybiBuZXcgQm91bmRzMyggLXgsIC15LCAteCwgeCwgeSwgeCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgZ2VuZXJhbCBzaXplIG9mIHRoZSBtYXNzIGJhc2VkIG9uIGEgZ2VuZXJhbCBzaXplIHNjYWxlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRSYXRpb3MoIHdpZHRoUmF0aW86IG51bWJlciwgaGVpZ2h0UmF0aW86IG51bWJlciApOiB2b2lkIHtcclxuICAgIHRoaXMudXBkYXRlU2l6ZSggQ3Vib2lkLmdldFNpemVGcm9tUmF0aW9zKCB3aWR0aFJhdGlvLCBoZWlnaHRSYXRpbyApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxsZWQgYWZ0ZXIgYW4gZW5naW5lLXBoeXNpY3MtbW9kZWwgc3RlcCBvbmNlIGJlZm9yZSBkb2luZyBvdGhlciBvcGVyYXRpb25zIChsaWtlIGNvbXB1dGluZyBidW95YW50IGZvcmNlcyxcclxuICAgKiBkaXNwbGFjZW1lbnQsIGV0Yy4pIHNvIHRoYXQgaXQgY2FuIHNldCBoaWdoLXBlcmZvcm1hbmNlIGZsYWdzIHVzZWQgZm9yIHRoaXMgcHVycG9zZS5cclxuICAgKlxyXG4gICAqIFR5cGUtc3BlY2lmaWMgdmFsdWVzIGFyZSBsaWtlbHkgdG8gYmUgc2V0LCBidXQgdGhpcyBzaG91bGQgc2V0IGF0IGxlYXN0IHN0ZXBYL3N0ZXBCb3R0b20vc3RlcFRvcFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSB1cGRhdGVTdGVwSW5mb3JtYXRpb24oKTogdm9pZCB7XHJcbiAgICBzdXBlci51cGRhdGVTdGVwSW5mb3JtYXRpb24oKTtcclxuXHJcbiAgICBjb25zdCB4T2Zmc2V0ID0gdGhpcy5zdGVwTWF0cml4Lm0wMigpO1xyXG4gICAgY29uc3QgeU9mZnNldCA9IHRoaXMuc3RlcE1hdHJpeC5tMTIoKTtcclxuXHJcbiAgICB0aGlzLnN0ZXBYID0geE9mZnNldDtcclxuICAgIHRoaXMuc3RlcEJvdHRvbSA9IHlPZmZzZXQgKyB0aGlzLnNpemVQcm9wZXJ0eS52YWx1ZS5taW5ZO1xyXG4gICAgdGhpcy5zdGVwVG9wID0geU9mZnNldCArIHRoaXMuc2l6ZVByb3BlcnR5LnZhbHVlLm1heFk7XHJcblxyXG4gICAgdGhpcy5zdGVwQXJlYSA9IHRoaXMuc2l6ZVByb3BlcnR5LnZhbHVlLndpZHRoICogdGhpcy5zaXplUHJvcGVydHkudmFsdWUuZGVwdGg7XHJcbiAgICB0aGlzLnN0ZXBNYXhpbXVtVm9sdW1lID0gdGhpcy5zdGVwQXJlYSAqIHRoaXMuc2l6ZVByb3BlcnR5LnZhbHVlLmhlaWdodDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIElmIHRoZXJlIGlzIGFuIGludGVyc2VjdGlvbiB3aXRoIHRoZSByYXkgYW5kIHRoaXMgbWFzcywgdGhlIHQtdmFsdWUgKGRpc3RhbmNlIHRoZSByYXkgd291bGQgbmVlZCB0byB0cmF2ZWwgdG9cclxuICAgKiByZWFjaCB0aGUgaW50ZXJzZWN0aW9uLCBlLmcuIHJheS5wb3NpdGlvbiArIHJheS5kaXN0YW5jZSAqIHQgPT09IGludGVyc2VjdGlvblBvaW50KSB3aWxsIGJlIHJldHVybmVkLiBPdGhlcndpc2VcclxuICAgKiBpZiB0aGVyZSBpcyBubyBpbnRlcnNlY3Rpb24sIG51bGwgd2lsbCBiZSByZXR1cm5lZC5cclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgaW50ZXJzZWN0KCByYXk6IFJheTMsIGlzVG91Y2g6IGJvb2xlYW4gKTogbnVtYmVyIHwgbnVsbCB7XHJcbiAgICBjb25zdCBzaXplID0gdGhpcy5zaXplUHJvcGVydHkudmFsdWU7XHJcbiAgICBjb25zdCB0cmFuc2xhdGlvbiA9IHRoaXMubWF0cml4LmdldFRyYW5zbGF0aW9uKCkudG9WZWN0b3IzKCk7XHJcblxyXG4gICAgcmV0dXJuIEN1Ym9pZC5pbnRlcnNlY3QoIHNpemUsIHRyYW5zbGF0aW9uLCByYXkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIGN1bXVsYXRpdmUgZGlzcGxhY2VkIHZvbHVtZSBvZiB0aGlzIG9iamVjdCB1cCB0byBhIGdpdmVuIHkgbGV2ZWwuXHJcbiAgICpcclxuICAgKiBBc3N1bWVzIHN0ZXAgaW5mb3JtYXRpb24gd2FzIHVwZGF0ZWQuXHJcbiAgICovXHJcbiAgcHVibGljIGdldERpc3BsYWNlZEFyZWEoIGxpcXVpZExldmVsOiBudW1iZXIgKTogbnVtYmVyIHtcclxuICAgIGlmICggbGlxdWlkTGV2ZWwgPCB0aGlzLnN0ZXBCb3R0b20gfHwgbGlxdWlkTGV2ZWwgPiB0aGlzLnN0ZXBUb3AgKSB7XHJcbiAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnN0ZXBBcmVhO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgZGlzcGxhY2VkIHZvbHVtZSBvZiB0aGlzIG9iamVjdCB1cCB0byBhIGdpdmVuIHkgbGV2ZWwsIGFzc3VtaW5nIGEgeSB2YWx1ZSBmb3IgdGhlIGdpdmVuIGxpcXVpZCBsZXZlbC5cclxuICAgKlxyXG4gICAqIEFzc3VtZXMgc3RlcCBpbmZvcm1hdGlvbiB3YXMgdXBkYXRlZC5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RGlzcGxhY2VkVm9sdW1lKCBsaXF1aWRMZXZlbDogbnVtYmVyICk6IG51bWJlciB7XHJcbiAgICBjb25zdCBib3R0b20gPSB0aGlzLnN0ZXBCb3R0b207XHJcbiAgICBjb25zdCB0b3AgPSB0aGlzLnN0ZXBUb3A7XHJcblxyXG4gICAgaWYgKCBsaXF1aWRMZXZlbCA8PSBib3R0b20gKSB7XHJcbiAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIGxpcXVpZExldmVsID49IHRvcCApIHtcclxuICAgICAgcmV0dXJuIHRoaXMuc3RlcE1heGltdW1Wb2x1bWU7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgLy8gVGhpcyBpcyBpZGVudGljYWwgdG8gVmVydGljYWxDeWxpbmRlcidzIGdldERpc3BsYWNlZFZvbHVtZSBmb3JtdWxhLCBzZWUgdGhlcmUgaWYgdGhpcyBuZWVkcyB0byBjaGFuZ2UuXHJcbiAgICAgIHJldHVybiB0aGlzLnN0ZXBNYXhpbXVtVm9sdW1lICogKCBsaXF1aWRMZXZlbCAtIGJvdHRvbSApIC8gKCB0b3AgLSBib3R0b20gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc2V0cyB0aGluZ3MgdG8gdGhlaXIgb3JpZ2luYWwgdmFsdWVzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMuc2l6ZVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnVwZGF0ZVNpemUoIHRoaXMuc2l6ZVByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gICAgc3VwZXIucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbGVhc2VzIHJlZmVyZW5jZXNcclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuc2l6ZVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuXHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIGEgKHF1aWNrKSBjbG9zZXN0IHJheSBpbnRlcnNlY3Rpb24gd2l0aCBhIGN1Ym9pZCAoZGVmaW5lZCBieSB0aGUgZ2l2ZW4gQm91bmRzMyBhbmQgdHJhbnNsYXRpb24pLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgaW50ZXJzZWN0KCBib3VuZHM6IEJvdW5kczMsIHRyYW5zbGF0aW9uOiBWZWN0b3IzLCByYXk6IFJheTMgKTogbnVtYmVyIHwgbnVsbCB7XHJcbiAgICBsZXQgdE5lYXIgPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFk7XHJcbiAgICBsZXQgdEZhciA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTtcclxuXHJcbiAgICBpZiAoIHJheS5kaXJlY3Rpb24ueCA+IDAgKSB7XHJcbiAgICAgIHROZWFyID0gTWF0aC5tYXgoIHROZWFyLCAoIGJvdW5kcy5taW5YICsgdHJhbnNsYXRpb24ueCAtIHJheS5wb3NpdGlvbi54ICkgLyByYXkuZGlyZWN0aW9uLnggKTtcclxuICAgICAgdEZhciA9IE1hdGgubWluKCB0RmFyLCAoIGJvdW5kcy5tYXhYICsgdHJhbnNsYXRpb24ueCAtIHJheS5wb3NpdGlvbi54ICkgLyByYXkuZGlyZWN0aW9uLnggKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCByYXkuZGlyZWN0aW9uLnggPCAwICkge1xyXG4gICAgICB0TmVhciA9IE1hdGgubWF4KCB0TmVhciwgKCBib3VuZHMubWF4WCArIHRyYW5zbGF0aW9uLnggLSByYXkucG9zaXRpb24ueCApIC8gcmF5LmRpcmVjdGlvbi54ICk7XHJcbiAgICAgIHRGYXIgPSBNYXRoLm1pbiggdEZhciwgKCBib3VuZHMubWluWCArIHRyYW5zbGF0aW9uLnggLSByYXkucG9zaXRpb24ueCApIC8gcmF5LmRpcmVjdGlvbi54ICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCByYXkuZGlyZWN0aW9uLnkgPiAwICkge1xyXG4gICAgICB0TmVhciA9IE1hdGgubWF4KCB0TmVhciwgKCBib3VuZHMubWluWSArIHRyYW5zbGF0aW9uLnkgLSByYXkucG9zaXRpb24ueSApIC8gcmF5LmRpcmVjdGlvbi55ICk7XHJcbiAgICAgIHRGYXIgPSBNYXRoLm1pbiggdEZhciwgKCBib3VuZHMubWF4WSArIHRyYW5zbGF0aW9uLnkgLSByYXkucG9zaXRpb24ueSApIC8gcmF5LmRpcmVjdGlvbi55ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggcmF5LmRpcmVjdGlvbi55IDwgMCApIHtcclxuICAgICAgdE5lYXIgPSBNYXRoLm1heCggdE5lYXIsICggYm91bmRzLm1heFkgKyB0cmFuc2xhdGlvbi55IC0gcmF5LnBvc2l0aW9uLnkgKSAvIHJheS5kaXJlY3Rpb24ueSApO1xyXG4gICAgICB0RmFyID0gTWF0aC5taW4oIHRGYXIsICggYm91bmRzLm1pblkgKyB0cmFuc2xhdGlvbi55IC0gcmF5LnBvc2l0aW9uLnkgKSAvIHJheS5kaXJlY3Rpb24ueSApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICggcmF5LmRpcmVjdGlvbi56ID4gMCApIHtcclxuICAgICAgdE5lYXIgPSBNYXRoLm1heCggdE5lYXIsICggYm91bmRzLm1pblogKyB0cmFuc2xhdGlvbi56IC0gcmF5LnBvc2l0aW9uLnogKSAvIHJheS5kaXJlY3Rpb24ueiApO1xyXG4gICAgICB0RmFyID0gTWF0aC5taW4oIHRGYXIsICggYm91bmRzLm1heFogKyB0cmFuc2xhdGlvbi56IC0gcmF5LnBvc2l0aW9uLnogKSAvIHJheS5kaXJlY3Rpb24ueiApO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIHJheS5kaXJlY3Rpb24ueiA8IDAgKSB7XHJcbiAgICAgIHROZWFyID0gTWF0aC5tYXgoIHROZWFyLCAoIGJvdW5kcy5tYXhaICsgdHJhbnNsYXRpb24ueiAtIHJheS5wb3NpdGlvbi56ICkgLyByYXkuZGlyZWN0aW9uLnogKTtcclxuICAgICAgdEZhciA9IE1hdGgubWluKCB0RmFyLCAoIGJvdW5kcy5taW5aICsgdHJhbnNsYXRpb24ueiAtIHJheS5wb3NpdGlvbi56ICkgLyByYXkuZGlyZWN0aW9uLnogKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gKCB0TmVhciA+PSB0RmFyICkgPyBudWxsIDogKCB0TmVhciA+PSAwID8gdE5lYXIgOiAoIGlzRmluaXRlKCB0RmFyICkgJiYgdEZhciA+PSAwID8gdEZhciA6IG51bGwgKSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBDdWJvaWRJTyA9IG5ldyBJT1R5cGU8Q3Vib2lkLCBDdWJvaWRJT1N0YXRlT2JqZWN0PiggJ0N1Ym9pZElPJywge1xyXG4gICAgdmFsdWVUeXBlOiBDdWJvaWQsXHJcbiAgICBzdXBlcnR5cGU6IE1hc3MuTWFzc0lPLFxyXG4gICAgZG9jdW1lbnRhdGlvbjogJ1JlcHJlc2VudHMgYW4gYXhpcy1hbGlnbmVkIGN1Ym9pZCBtYXNzJyxcclxuICAgIHN0YXRlU2NoZW1hOiB7XHJcbiAgICAgIHNpemU6IEJvdW5kczMuQm91bmRzM0lPXHJcbiAgICB9LFxyXG5cclxuICAgIHRvU3RhdGVPYmplY3Q6ICggY3Vib2lkOiBDdWJvaWQgKTogQ3Vib2lkSU9TdGF0ZU9iamVjdCA9PiB7XHJcbiAgICAgIGNvbnN0IHBhcmVudFN0YXRlT2JqZWN0ID0gTWFzcy5NYXNzSU8udG9TdGF0ZU9iamVjdCggY3Vib2lkICk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4ucGFyZW50U3RhdGVPYmplY3QsXHJcbiAgICAgICAgc2l6ZTogQm91bmRzMy5Cb3VuZHMzSU8udG9TdGF0ZU9iamVjdCggY3Vib2lkLnNpemVQcm9wZXJ0eS52YWx1ZSApXHJcbiAgICAgIH07XHJcbiAgICB9LFxyXG4gICAgYXBwbHlTdGF0ZTogKCBjdWJvaWQ6IEN1Ym9pZCwgc3RhdGVPYmplY3Q6IEN1Ym9pZElPU3RhdGVPYmplY3QgKSA9PiB7XHJcblxyXG4gICAgICAvLyBBcHBseSBzaXplIHVwZGF0ZSBmaXJzdCwgYW5kIHdpdGggdGhlIHZlcnkgc3BlY2lmaWMgdXBkYXRlIG1ldGhvZFxyXG4gICAgICBjdWJvaWQudXBkYXRlU2l6ZSggQm91bmRzMy5Cb3VuZHMzSU8uZnJvbVN0YXRlT2JqZWN0KCBzdGF0ZU9iamVjdC5zaXplICkgKTtcclxuICAgICAgTWFzcy5NYXNzSU8uYXBwbHlTdGF0ZSggY3Vib2lkLCBzdGF0ZU9iamVjdCApO1xyXG4gICAgfVxyXG4gIH0gKTtcclxufVxyXG5cclxuZXhwb3J0IHR5cGUgQ3Vib2lkSU9TdGF0ZU9iamVjdCA9IE1hc3NJT1N0YXRlT2JqZWN0ICYge1xyXG4gIHNpemU6IHtcclxuICAgIG1pblg6IG51bWJlcjtcclxuICAgIG1pblk6IG51bWJlcjtcclxuICAgIG1pblo6IG51bWJlcjtcclxuICAgIG1heFg6IG51bWJlcjtcclxuICAgIG1heFk6IG51bWJlcjtcclxuICAgIG1heFo6IG51bWJlcjtcclxuICB9O1xyXG59O1xyXG5cclxuZGVuc2l0eUJ1b3lhbmN5Q29tbW9uLnJlZ2lzdGVyKCAnQ3Vib2lkJywgQ3Vib2lkICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxRQUFRLE1BQU0saUNBQWlDO0FBRXRELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUVuRCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsU0FBU0MsS0FBSyxRQUFRLGdDQUFnQztBQUN0RCxPQUFPQyxTQUFTLE1BQTRCLHVDQUF1QztBQUNuRixPQUFPQyxNQUFNLE1BQU0sdUNBQXVDO0FBQzFELE9BQU9DLHFCQUFxQixNQUFNLGdDQUFnQztBQUNsRSxPQUFPQyxJQUFJLElBQTZCQyx5QkFBeUIsRUFBRUMseUJBQXlCLFFBQTJCLFdBQVc7QUFFbEksU0FBU0MsU0FBUyxRQUFRLGdCQUFnQjtBQUkxQyxlQUFlLE1BQU1DLE1BQU0sU0FBU0osSUFBSSxDQUFDO0VBSXZDOztFQUlPSyxXQUFXQSxDQUFFQyxNQUFxQixFQUFFQyxJQUFhLEVBQUVDLGNBQTZCLEVBQUc7SUFDeEYsTUFBTUMsTUFBTSxHQUFHWixTQUFTLENBQTJELENBQUMsQ0FBRTtNQUNwRmEsSUFBSSxFQUFFSixNQUFNLENBQUNL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