// Copyright 2019-2022, University of Colorado Boulder

/**
 * The main model for the Applications screen of the Buoyancy simulation.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import EnumerationProperty from '../../../../axon/js/EnumerationProperty.js';
import Matrix3 from '../../../../dot/js/Matrix3.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Enumeration from '../../../../phet-core/js/Enumeration.js';
import EnumerationValue from '../../../../phet-core/js/EnumerationValue.js';
import Cube from '../../common/model/Cube.js';
import DensityBuoyancyModel from '../../common/model/DensityBuoyancyModel.js';
import Material from '../../common/model/Material.js';
import Scale, { DisplayType } from '../../common/model/Scale.js';
import densityBuoyancyCommon from '../../densityBuoyancyCommon.js';
import Boat from './Boat.js';
import Bottle from './Bottle.js';

// constants
export class Scene extends EnumerationValue {
  static BOTTLE = new Scene();
  static BOAT = new Scene();
  static enumeration = new Enumeration(Scene, {
    phetioDocumentation: 'Bottle or boat scene'
  });
}
export default class BuoyancyApplicationsModel extends DensityBuoyancyModel {
  constructor(options) {
    const tandem = options.tandem;
    super(options);
    this.sceneProperty = new EnumerationProperty(Scene.BOTTLE);
    this.densityExpandedProperty = new BooleanProperty(false);
    this.bottle = new Bottle(this.engine, {
      matrix: Matrix3.translation(0, 0),
      tandem: tandem.createTandem('bottle'),
      visible: true
    });
    this.availableMasses.push(this.bottle);
    this.block = Cube.createWithVolume(this.engine, Material.BRICK, new Vector2(0.5, 0.5), 0.001, {
      visible: false,
      tandem: tandem.createTandem('block')
    });
    this.availableMasses.push(this.block);

    // DerivedProperty doesn't need disposal, since everything here lives for the lifetime of the simulation
    this.boat = new Boat(this.engine, new DerivedProperty([this.block.sizeProperty], size => size.depth), this.liquidMaterialProperty, {
      matrix: Matrix3.translation(0, -0.1),
      tandem: tandem.createTandem('boat'),
      visible: false
    });
    this.availableMasses.push(this.boat);
    this.rightScale = new Scale(this.engine, this.gravityProperty, {
      matrix: Matrix3.translation(0.77, -Scale.SCALE_BASE_BOUNDS.minY),
      displayType: DisplayType.NEWTONS,
      canMove: false,
      tandem: tandem.createTandem('rightScale')
    });
    this.availableMasses.push(this.rightScale);
    this.poolScale = new Scale(this.engine, this.gravityProperty, {
      matrix: Matrix3.translation(0.3, -Scale.SCALE_BASE_BOUNDS.minY + this.poolBounds.minY),
      displayType: DisplayType.NEWTONS,
      canMove: false,
      tandem: tandem.createTandem('poolScale')
    });
    this.availableMasses.push(this.poolScale);

    // Adjust pool volume so that it's at the desired value WITH the pool scale inside.
    this.pool.liquidVolumeProperty.value -= this.poolScale.volumeProperty.value;
    this.pool.liquidVolumeProperty.setInitialValue(this.pool.liquidVolumeProperty.value);

    // This instance lives for the lifetime of the simulation, so we don't need to remove this listener
    this.sceneProperty.link(scene => {
      this.bottle.internalVisibleProperty.value = scene === Scene.BOTTLE;
      this.boat.internalVisibleProperty.value = scene === Scene.BOAT;
      this.block.internalVisibleProperty.value = scene === Scene.BOAT;
      assert && assert(!this.boat.visibleProperty.value || !this.bottle.visibleProperty.value, 'Boat and bottle should not be visible at the same time');
    });
  }
  step(dt) {
    assert && assert(!this.boat.visibleProperty.value || !this.bottle.visibleProperty.value, 'Boat and bottle should not be visible at the same time');
    super.step(dt);
  }

  /**
   * Moves the boat and block to their initial locations (see https://github.com/phetsims/buoyancy/issues/25)
   */
  resetBoatScene() {
    // Reset the basin levels (clear the liquid out of the boat)
    this.boat.basin.reset();
    this.pool.reset();

    // Move things to the initial position
    this.boat.resetPosition();
    this.block.resetPosition();
  }

  /**
   * Resets things to their original values.
   */
  reset() {
    this.densityExpandedProperty.reset();
    this.bottle.reset();
    this.block.reset();
    this.boat.reset();
    super.reset();
    this.sceneProperty.reset();
    assert && assert(!this.boat.visibleProperty.value || !this.bottle.visibleProperty.value, 'Boat and bottle should not be visible at the same time');
  }
}
densityBuoyancyCommon.register('BuoyancyApplicationsModel', BuoyancyApplicationsModel);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJFbnVtZXJhdGlvblByb3BlcnR5IiwiTWF0cml4MyIsIlZlY3RvcjIiLCJFbnVtZXJhdGlvbiIsIkVudW1lcmF0aW9uVmFsdWUiLCJDdWJlIiwiRGVuc2l0eUJ1b3lhbmN5TW9kZWwiLCJNYXRlcmlhbCIsIlNjYWxlIiwiRGlzcGxheVR5cGUiLCJkZW5zaXR5QnVveWFuY3lDb21tb24iLCJCb2F0IiwiQm90dGxlIiwiU2NlbmUiLCJCT1RUTEUiLCJCT0FUIiwiZW51bWVyYXRpb24iLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwiQnVveWFuY3lBcHBsaWNhdGlvbnNNb2RlbCIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsInRhbmRlbSIsInNjZW5lUHJvcGVydHkiLCJkZW5zaXR5RXhwYW5kZWRQcm9wZXJ0eSIsImJvdHRsZSIsImVuZ2luZSIsIm1hdHJpeCIsInRyYW5zbGF0aW9uIiwiY3JlYXRlVGFuZGVtIiwidmlzaWJsZSIsImF2YWlsYWJsZU1hc3NlcyIsInB1c2giLCJibG9jayIsImNyZWF0ZVdpdGhWb2x1bWUiLCJCUklDSyIsImJvYXQiLCJzaXplUHJvcGVydHkiLCJzaXplIiwiZGVwdGgiLCJsaXF1aWRNYXRlcmlhbFByb3BlcnR5IiwicmlnaHRTY2FsZSIsImdyYXZpdHlQcm9wZXJ0eSIsIlNDQUxFX0JBU0VfQk9VTkRTIiwibWluWSIsImRpc3BsYXlUeXBlIiwiTkVXVE9OUyIsImNhbk1vdmUiLCJwb29sU2NhbGUiLCJwb29sQm91bmRzIiwicG9vbCIsImxpcXVpZFZvbHVtZVByb3BlcnR5IiwidmFsdWUiLCJ2b2x1bWVQcm9wZXJ0eSIsInNldEluaXRpYWxWYWx1ZSIsImxpbmsiLCJzY2VuZSIsImludGVybmFsVmlzaWJsZVByb3BlcnR5IiwiYXNzZXJ0IiwidmlzaWJsZVByb3BlcnR5Iiwic3RlcCIsImR0IiwicmVzZXRCb2F0U2NlbmUiLCJiYXNpbiIsInJlc2V0IiwicmVzZXRQb3NpdGlvbiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQnVveWFuY3lBcHBsaWNhdGlvbnNNb2RlbC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBUaGUgbWFpbiBtb2RlbCBmb3IgdGhlIEFwcGxpY2F0aW9ucyBzY3JlZW4gb2YgdGhlIEJ1b3lhbmN5IHNpbXVsYXRpb24uXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBFbnVtZXJhdGlvblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRW51bWVyYXRpb25Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IE1hdHJpeDMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL01hdHJpeDMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBFbnVtZXJhdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvRW51bWVyYXRpb24uanMnO1xyXG5pbXBvcnQgRW51bWVyYXRpb25WYWx1ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvRW51bWVyYXRpb25WYWx1ZS5qcyc7XHJcbmltcG9ydCBDdWJlIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9DdWJlLmpzJztcclxuaW1wb3J0IERlbnNpdHlCdW95YW5jeU1vZGVsLCB7IERlbnNpdHlCdW95YW5jeU1vZGVsT3B0aW9ucyB9IGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9EZW5zaXR5QnVveWFuY3lNb2RlbC5qcyc7XHJcbmltcG9ydCBNYXRlcmlhbCBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvTWF0ZXJpYWwuanMnO1xyXG5pbXBvcnQgU2NhbGUsIHsgRGlzcGxheVR5cGUgfSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvU2NhbGUuanMnO1xyXG5pbXBvcnQgZGVuc2l0eUJ1b3lhbmN5Q29tbW9uIGZyb20gJy4uLy4uL2RlbnNpdHlCdW95YW5jeUNvbW1vbi5qcyc7XHJcbmltcG9ydCBCb2F0IGZyb20gJy4vQm9hdC5qcyc7XHJcbmltcG9ydCBCb3R0bGUgZnJvbSAnLi9Cb3R0bGUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmV4cG9ydCBjbGFzcyBTY2VuZSBleHRlbmRzIEVudW1lcmF0aW9uVmFsdWUge1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgQk9UVExFID0gbmV3IFNjZW5lKCk7XHJcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBCT0FUID0gbmV3IFNjZW5lKCk7XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgZW51bWVyYXRpb24gPSBuZXcgRW51bWVyYXRpb24oIFNjZW5lLCB7XHJcbiAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnQm90dGxlIG9yIGJvYXQgc2NlbmUnXHJcbiAgfSApO1xyXG59XHJcblxyXG5leHBvcnQgdHlwZSBCdW95YW5jeUFwcGxpY2F0aW9uc01vZGVsT3B0aW9ucyA9IERlbnNpdHlCdW95YW5jeU1vZGVsT3B0aW9ucztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJ1b3lhbmN5QXBwbGljYXRpb25zTW9kZWwgZXh0ZW5kcyBEZW5zaXR5QnVveWFuY3lNb2RlbCB7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSBzY2VuZVByb3BlcnR5OiBQcm9wZXJ0eTxTY2VuZT47XHJcbiAgcHVibGljIHJlYWRvbmx5IGRlbnNpdHlFeHBhbmRlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IGJvdHRsZTogQm90dGxlO1xyXG4gIHB1YmxpYyByZWFkb25seSBibG9jazogQ3ViZTtcclxuICBwdWJsaWMgb3ZlcnJpZGUgYm9hdDogQm9hdDtcclxuICBwdWJsaWMgcmVhZG9ubHkgcmlnaHRTY2FsZTogU2NhbGU7XHJcbiAgcHVibGljIHJlYWRvbmx5IHBvb2xTY2FsZTogU2NhbGU7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvciggb3B0aW9uczogQnVveWFuY3lBcHBsaWNhdGlvbnNNb2RlbE9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3QgdGFuZGVtID0gb3B0aW9ucy50YW5kZW07XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLnNjZW5lUHJvcGVydHkgPSBuZXcgRW51bWVyYXRpb25Qcm9wZXJ0eSggU2NlbmUuQk9UVExFICk7XHJcbiAgICB0aGlzLmRlbnNpdHlFeHBhbmRlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuXHJcbiAgICB0aGlzLmJvdHRsZSA9IG5ldyBCb3R0bGUoIHRoaXMuZW5naW5lLCB7XHJcbiAgICAgIG1hdHJpeDogTWF0cml4My50cmFuc2xhdGlvbiggMCwgMCApLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdib3R0bGUnICksXHJcbiAgICAgIHZpc2libGU6IHRydWVcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYXZhaWxhYmxlTWFzc2VzLnB1c2goIHRoaXMuYm90dGxlICk7XHJcblxyXG4gICAgdGhpcy5ibG9jayA9IEN1YmUuY3JlYXRlV2l0aFZvbHVtZSggdGhpcy5lbmdpbmUsIE1hdGVyaWFsLkJSSUNLLCBuZXcgVmVjdG9yMiggMC41LCAwLjUgKSwgMC4wMDEsIHtcclxuICAgICAgdmlzaWJsZTogZmFsc2UsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2Jsb2NrJyApXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmF2YWlsYWJsZU1hc3Nlcy5wdXNoKCB0aGlzLmJsb2NrICk7XHJcblxyXG4gICAgLy8gRGVyaXZlZFByb3BlcnR5IGRvZXNuJ3QgbmVlZCBkaXNwb3NhbCwgc2luY2UgZXZlcnl0aGluZyBoZXJlIGxpdmVzIGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIHNpbXVsYXRpb25cclxuICAgIHRoaXMuYm9hdCA9IG5ldyBCb2F0KCB0aGlzLmVuZ2luZSwgbmV3IERlcml2ZWRQcm9wZXJ0eSggWyB0aGlzLmJsb2NrLnNpemVQcm9wZXJ0eSBdLCBzaXplID0+IHNpemUuZGVwdGggKSwgdGhpcy5saXF1aWRNYXRlcmlhbFByb3BlcnR5LCB7XHJcbiAgICAgIG1hdHJpeDogTWF0cml4My50cmFuc2xhdGlvbiggMCwgLTAuMSApLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdib2F0JyApLFxyXG4gICAgICB2aXNpYmxlOiBmYWxzZVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hdmFpbGFibGVNYXNzZXMucHVzaCggdGhpcy5ib2F0ICk7XHJcblxyXG4gICAgdGhpcy5yaWdodFNjYWxlID0gbmV3IFNjYWxlKCB0aGlzLmVuZ2luZSwgdGhpcy5ncmF2aXR5UHJvcGVydHksIHtcclxuICAgICAgbWF0cml4OiBNYXRyaXgzLnRyYW5zbGF0aW9uKCAwLjc3LCAtU2NhbGUuU0NBTEVfQkFTRV9CT1VORFMubWluWSApLFxyXG4gICAgICBkaXNwbGF5VHlwZTogRGlzcGxheVR5cGUuTkVXVE9OUyxcclxuICAgICAgY2FuTW92ZTogZmFsc2UsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3JpZ2h0U2NhbGUnIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYXZhaWxhYmxlTWFzc2VzLnB1c2goIHRoaXMucmlnaHRTY2FsZSApO1xyXG5cclxuICAgIHRoaXMucG9vbFNjYWxlID0gbmV3IFNjYWxlKCB0aGlzLmVuZ2luZSwgdGhpcy5ncmF2aXR5UHJvcGVydHksIHtcclxuICAgICAgbWF0cml4OiBNYXRyaXgzLnRyYW5zbGF0aW9uKCAwLjMsIC1TY2FsZS5TQ0FMRV9CQVNFX0JPVU5EUy5taW5ZICsgdGhpcy5wb29sQm91bmRzLm1pblkgKSxcclxuICAgICAgZGlzcGxheVR5cGU6IERpc3BsYXlUeXBlLk5FV1RPTlMsXHJcbiAgICAgIGNhbk1vdmU6IGZhbHNlLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdwb29sU2NhbGUnIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYXZhaWxhYmxlTWFzc2VzLnB1c2goIHRoaXMucG9vbFNjYWxlICk7XHJcblxyXG4gICAgLy8gQWRqdXN0IHBvb2wgdm9sdW1lIHNvIHRoYXQgaXQncyBhdCB0aGUgZGVzaXJlZCB2YWx1ZSBXSVRIIHRoZSBwb29sIHNjYWxlIGluc2lkZS5cclxuICAgIHRoaXMucG9vbC5saXF1aWRWb2x1bWVQcm9wZXJ0eS52YWx1ZSAtPSB0aGlzLnBvb2xTY2FsZS52b2x1bWVQcm9wZXJ0eS52YWx1ZTtcclxuICAgIHRoaXMucG9vbC5saXF1aWRWb2x1bWVQcm9wZXJ0eS5zZXRJbml0aWFsVmFsdWUoIHRoaXMucG9vbC5saXF1aWRWb2x1bWVQcm9wZXJ0eS52YWx1ZSApO1xyXG5cclxuICAgIC8vIFRoaXMgaW5zdGFuY2UgbGl2ZXMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltdWxhdGlvbiwgc28gd2UgZG9uJ3QgbmVlZCB0byByZW1vdmUgdGhpcyBsaXN0ZW5lclxyXG4gICAgdGhpcy5zY2VuZVByb3BlcnR5LmxpbmsoIHNjZW5lID0+IHtcclxuICAgICAgdGhpcy5ib3R0bGUuaW50ZXJuYWxWaXNpYmxlUHJvcGVydHkudmFsdWUgPSBzY2VuZSA9PT0gU2NlbmUuQk9UVExFO1xyXG4gICAgICB0aGlzLmJvYXQuaW50ZXJuYWxWaXNpYmxlUHJvcGVydHkudmFsdWUgPSBzY2VuZSA9PT0gU2NlbmUuQk9BVDtcclxuICAgICAgdGhpcy5ibG9jay5pbnRlcm5hbFZpc2libGVQcm9wZXJ0eS52YWx1ZSA9IHNjZW5lID09PSBTY2VuZS5CT0FUO1xyXG5cclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggIXRoaXMuYm9hdC52aXNpYmxlUHJvcGVydHkudmFsdWUgfHwgIXRoaXMuYm90dGxlLnZpc2libGVQcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgICAnQm9hdCBhbmQgYm90dGxlIHNob3VsZCBub3QgYmUgdmlzaWJsZSBhdCB0aGUgc2FtZSB0aW1lJyApO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIHN0ZXAoIGR0OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhdGhpcy5ib2F0LnZpc2libGVQcm9wZXJ0eS52YWx1ZSB8fCAhdGhpcy5ib3R0bGUudmlzaWJsZVByb3BlcnR5LnZhbHVlLFxyXG4gICAgICAnQm9hdCBhbmQgYm90dGxlIHNob3VsZCBub3QgYmUgdmlzaWJsZSBhdCB0aGUgc2FtZSB0aW1lJyApO1xyXG5cclxuICAgIHN1cGVyLnN0ZXAoIGR0ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNb3ZlcyB0aGUgYm9hdCBhbmQgYmxvY2sgdG8gdGhlaXIgaW5pdGlhbCBsb2NhdGlvbnMgKHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvYnVveWFuY3kvaXNzdWVzLzI1KVxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldEJvYXRTY2VuZSgpOiB2b2lkIHtcclxuICAgIC8vIFJlc2V0IHRoZSBiYXNpbiBsZXZlbHMgKGNsZWFyIHRoZSBsaXF1aWQgb3V0IG9mIHRoZSBib2F0KVxyXG4gICAgdGhpcy5ib2F0LmJhc2luLnJlc2V0KCk7XHJcbiAgICB0aGlzLnBvb2wucmVzZXQoKTtcclxuXHJcbiAgICAvLyBNb3ZlIHRoaW5ncyB0byB0aGUgaW5pdGlhbCBwb3NpdGlvblxyXG4gICAgdGhpcy5ib2F0LnJlc2V0UG9zaXRpb24oKTtcclxuICAgIHRoaXMuYmxvY2sucmVzZXRQb3NpdGlvbigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXRzIHRoaW5ncyB0byB0aGVpciBvcmlnaW5hbCB2YWx1ZXMuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5kZW5zaXR5RXhwYW5kZWRQcm9wZXJ0eS5yZXNldCgpO1xyXG5cclxuICAgIHRoaXMuYm90dGxlLnJlc2V0KCk7XHJcbiAgICB0aGlzLmJsb2NrLnJlc2V0KCk7XHJcbiAgICB0aGlzLmJvYXQucmVzZXQoKTtcclxuXHJcbiAgICBzdXBlci5yZXNldCgpO1xyXG5cclxuICAgIHRoaXMuc2NlbmVQcm9wZXJ0eS5yZXNldCgpO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICF0aGlzLmJvYXQudmlzaWJsZVByb3BlcnR5LnZhbHVlIHx8ICF0aGlzLmJvdHRsZS52aXNpYmxlUHJvcGVydHkudmFsdWUsXHJcbiAgICAgICdCb2F0IGFuZCBib3R0bGUgc2hvdWxkIG5vdCBiZSB2aXNpYmxlIGF0IHRoZSBzYW1lIHRpbWUnICk7XHJcbiAgfVxyXG59XHJcblxyXG5kZW5zaXR5QnVveWFuY3lDb21tb24ucmVnaXN0ZXIoICdCdW95YW5jeUFwcGxpY2F0aW9uc01vZGVsJywgQnVveWFuY3lBcHBsaWNhdGlvbnNNb2RlbCApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLG1CQUFtQixNQUFNLDRDQUE0QztBQUU1RSxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsV0FBVyxNQUFNLHlDQUF5QztBQUNqRSxPQUFPQyxnQkFBZ0IsTUFBTSw4Q0FBOEM7QUFDM0UsT0FBT0MsSUFBSSxNQUFNLDRCQUE0QjtBQUM3QyxPQUFPQyxvQkFBb0IsTUFBdUMsNENBQTRDO0FBQzlHLE9BQU9DLFFBQVEsTUFBTSxnQ0FBZ0M7QUFDckQsT0FBT0MsS0FBSyxJQUFJQyxXQUFXLFFBQVEsNkJBQTZCO0FBQ2hFLE9BQU9DLHFCQUFxQixNQUFNLGdDQUFnQztBQUNsRSxPQUFPQyxJQUFJLE1BQU0sV0FBVztBQUM1QixPQUFPQyxNQUFNLE1BQU0sYUFBYTs7QUFFaEM7QUFDQSxPQUFPLE1BQU1DLEtBQUssU0FBU1QsZ0JBQWdCLENBQUM7RUFDMUMsT0FBdUJVLE1BQU0sR0FBRyxJQUFJRCxLQUFLLENBQUMsQ0FBQztFQUMzQyxPQUF1QkUsSUFBSSxHQUFHLElBQUlGLEtBQUssQ0FBQyxDQUFDO0VBRXpDLE9BQXVCRyxXQUFXLEdBQUcsSUFBSWIsV0FBVyxDQUFFVSxLQUFLLEVBQUU7SUFDM0RJLG1CQUFtQixFQUFFO0VBQ3ZCLENBQUUsQ0FBQztBQUNMO0FBSUEsZUFBZSxNQUFNQyx5QkFBeUIsU0FBU1osb0JBQW9CLENBQUM7RUFXbkVhLFdBQVdBLENBQUVDLE9BQXlDLEVBQUc7SUFFOUQsTUFBTUMsTUFBTSxHQUFHRCxPQUFPLENBQUNDLE1BQU07SUFFN0IsS0FBSyxDQUFFRCxPQUFRLENBQUM7SUFFaEIsSUFBSSxDQUFDRSxhQUFhLEdBQUcsSUFBSXRCLG1CQUFtQixDQUFFYSxLQUFLLENBQUNDLE1BQU8sQ0FBQztJQUM1RCxJQUFJLENBQUNTLHVCQUF1QixHQUFHLElBQUl6QixlQUFlLENBQUUsS0FBTSxDQUFDO0lBRTNELElBQUksQ0FBQzBCLE1BQU0sR0FBRyxJQUFJWixNQUFNLENBQUUsSUFBSSxDQUFDYSxNQUFNLEVBQUU7TUFDckNDLE1BQU0sRUFBRXpCLE9BQU8sQ0FBQzBCLFdBQVcsQ0FBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDO01BQ25DTixNQUFNLEVBQUVBLE1BQU0sQ0FBQ08sWUFBWSxDQUFFLFFBQVMsQ0FBQztNQUN2Q0MsT0FBTyxFQUFFO0lBQ1gsQ0FBRSxDQUFDO0lBQ0gsSUFBSSxDQUFDQyxlQUFlLENBQUNDLElBQUksQ0FBRSxJQUFJLENBQUNQLE1BQU8sQ0FBQztJQUV4QyxJQUFJLENBQUNRLEtBQUssR0FBRzNCLElBQUksQ0FBQzRCLGdCQUFnQixDQUFFLElBQUksQ0FBQ1IsTUFBTSxFQUFFbEIsUUFBUSxDQUFDMkIsS0FBSyxFQUFFLElBQUloQyxPQUFPLENBQUUsR0FBRyxFQUFFLEdBQUksQ0FBQyxFQUFFLEtBQUssRUFBRTtNQUMvRjJCLE9BQU8sRUFBRSxLQUFLO01BQ2RSLE1BQU0sRUFBRUEsTUFBTSxDQUFDTyxZQUFZLENBQUUsT0FBUTtJQUN2QyxDQUFFLENBQUM7SUFDSCxJQUFJLENBQUNFLGVBQWUsQ0FBQ0MsSUFBSSxDQUFFLElBQUksQ0FBQ0MsS0FBTSxDQUFDOztJQUV2QztJQUNBLElBQUksQ0FBQ0csSUFBSSxHQUFHLElBQUl4QixJQUFJLENBQUUsSUFBSSxDQUFDYyxNQUFNLEVBQUUsSUFBSTFCLGVBQWUsQ0FBRSxDQUFFLElBQUksQ0FBQ2lDLEtBQUssQ0FBQ0ksWUFBWSxDQUFFLEVBQUVDLElBQUksSUFBSUEsSUFBSSxDQUFDQyxLQUFNLENBQUMsRUFBRSxJQUFJLENBQUNDLHNCQUFzQixFQUFFO01BQ3RJYixNQUFNLEVBQUV6QixPQUFPLENBQUMwQixXQUFXLENBQUUsQ0FBQyxFQUFFLENBQUMsR0FBSSxDQUFDO01BQ3RDTixNQUFNLEVBQUVBLE1BQU0sQ0FBQ08sWUFBWSxDQUFFLE1BQU8sQ0FBQztNQUNyQ0MsT0FBTyxFQUFFO0lBQ1gsQ0FBRSxDQUFDO0lBQ0gsSUFBSSxDQUFDQyxlQUFlLENBQUNDLElBQUksQ0FBRSxJQUFJLENBQUNJLElBQUssQ0FBQztJQUV0QyxJQUFJLENBQUNLLFVBQVUsR0FBRyxJQUFJaEMsS0FBSyxDQUFFLElBQUksQ0FBQ2lCLE1BQU0sRUFBRSxJQUFJLENBQUNnQixlQUFlLEVBQUU7TUFDOURmLE1BQU0sRUFBRXpCLE9BQU8sQ0FBQzBCLFdBQVcsQ0FBRSxJQUFJLEVBQUUsQ0FBQ25CLEtBQUssQ0FBQ2tDLGlCQUFpQixDQUFDQyxJQUFLLENBQUM7TUFDbEVDLFdBQVcsRUFBRW5DLFdBQVcsQ0FBQ29DLE9BQU87TUFDaENDLE9BQU8sRUFBRSxLQUFLO01BQ2R6QixNQUFNLEVBQUVBLE1BQU0sQ0FBQ08sWUFBWSxDQUFFLFlBQWE7SUFDNUMsQ0FBRSxDQUFDO0lBQ0gsSUFBSSxDQUFDRSxlQUFlLENBQUNDLElBQUksQ0FBRSxJQUFJLENBQUNTLFVBQVcsQ0FBQztJQUU1QyxJQUFJLENBQUNPLFNBQVMsR0FBRyxJQUFJdkMsS0FBSyxDQUFFLElBQUksQ0FBQ2lCLE1BQU0sRUFBRSxJQUFJLENBQUNnQixlQUFlLEVBQUU7TUFDN0RmLE1BQU0sRUFBRXpCLE9BQU8sQ0FBQzBCLFdBQVcsQ0FBRSxHQUFHLEVBQUUsQ0FBQ25CLEtBQUssQ0FBQ2tDLGlCQUFpQixDQUFDQyxJQUFJLEdBQUcsSUFBSSxDQUFDSyxVQUFVLENBQUNMLElBQUssQ0FBQztNQUN4RkMsV0FBVyxFQUFFbkMsV0FBVyxDQUFDb0MsT0FBTztNQUNoQ0MsT0FBTyxFQUFFLEtBQUs7TUFDZHpCLE1BQU0sRUFBRUEsTUFBTSxDQUFDTyxZQUFZLENBQUUsV0FBWTtJQUMzQyxDQUFFLENBQUM7SUFDSCxJQUFJLENBQUNFLGVBQWUsQ0FBQ0MsSUFBSSxDQUFFLElBQUksQ0FBQ2dCLFNBQVUsQ0FBQzs7SUFFM0M7SUFDQSxJQUFJLENBQUNFLElBQUksQ0FBQ0Msb0JBQW9CLENBQUNDLEtBQUssSUFBSSxJQUFJLENBQUNKLFNBQVMsQ0FBQ0ssY0FBYyxDQUFDRCxLQUFLO0lBQzNFLElBQUksQ0FBQ0YsSUFBSSxDQUFDQyxvQkFBb0IsQ0FBQ0csZUFBZSxDQUFFLElBQUksQ0FBQ0osSUFBSSxDQUFDQyxvQkFBb0IsQ0FBQ0MsS0FBTSxDQUFDOztJQUV0RjtJQUNBLElBQUksQ0FBQzdCLGFBQWEsQ0FBQ2dDLElBQUksQ0FBRUMsS0FBSyxJQUFJO01BQ2hDLElBQUksQ0FBQy9CLE1BQU0sQ0FBQ2dDLHVCQUF1QixDQUFDTCxLQUFLLEdBQUdJLEtBQUssS0FBSzFDLEtBQUssQ0FBQ0MsTUFBTTtNQUNsRSxJQUFJLENBQUNxQixJQUFJLENBQUNxQix1QkFBdUIsQ0FBQ0wsS0FBSyxHQUFHSSxLQUFLLEtBQUsxQyxLQUFLLENBQUNFLElBQUk7TUFDOUQsSUFBSSxDQUFDaUIsS0FBSyxDQUFDd0IsdUJBQXVCLENBQUNMLEtBQUssR0FBR0ksS0FBSyxLQUFLMUMsS0FBSyxDQUFDRSxJQUFJO01BRS9EMEMsTUFBTSxJQUFJQSxNQUFNLENBQUUsQ0FBQyxJQUFJLENBQUN0QixJQUFJLENBQUN1QixlQUFlLENBQUNQLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQzNCLE1BQU0sQ0FBQ2tDLGVBQWUsQ0FBQ1AsS0FBSyxFQUN0Rix3REFBeUQsQ0FBQztJQUM5RCxDQUFFLENBQUM7RUFDTDtFQUVnQlEsSUFBSUEsQ0FBRUMsRUFBVSxFQUFTO0lBQ3ZDSCxNQUFNLElBQUlBLE1BQU0sQ0FBRSxDQUFDLElBQUksQ0FBQ3RCLElBQUksQ0FBQ3VCLGVBQWUsQ0FBQ1AsS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDM0IsTUFBTSxDQUFDa0MsZUFBZSxDQUFDUCxLQUFLLEVBQ3RGLHdEQUF5RCxDQUFDO0lBRTVELEtBQUssQ0FBQ1EsSUFBSSxDQUFFQyxFQUFHLENBQUM7RUFDbEI7O0VBRUE7QUFDRjtBQUNBO0VBQ1NDLGNBQWNBLENBQUEsRUFBUztJQUM1QjtJQUNBLElBQUksQ0FBQzFCLElBQUksQ0FBQzJCLEtBQUssQ0FBQ0MsS0FBSyxDQUFDLENBQUM7SUFDdkIsSUFBSSxDQUFDZCxJQUFJLENBQUNjLEtBQUssQ0FBQyxDQUFDOztJQUVqQjtJQUNBLElBQUksQ0FBQzVCLElBQUksQ0FBQzZCLGFBQWEsQ0FBQyxDQUFDO0lBQ3pCLElBQUksQ0FBQ2hDLEtBQUssQ0FBQ2dDLGFBQWEsQ0FBQyxDQUFDO0VBQzVCOztFQUVBO0FBQ0Y7QUFDQTtFQUNrQkQsS0FBS0EsQ0FBQSxFQUFTO0lBQzVCLElBQUksQ0FBQ3hDLHVCQUF1QixDQUFDd0MsS0FBSyxDQUFDLENBQUM7SUFFcEMsSUFBSSxDQUFDdkMsTUFBTSxDQUFDdUMsS0FBSyxDQUFDLENBQUM7SUFDbkIsSUFBSSxDQUFDL0IsS0FBSyxDQUFDK0IsS0FBSyxDQUFDLENBQUM7SUFDbEIsSUFBSSxDQUFDNUIsSUFBSSxDQUFDNEIsS0FBSyxDQUFDLENBQUM7SUFFakIsS0FBSyxDQUFDQSxLQUFLLENBQUMsQ0FBQztJQUViLElBQUksQ0FBQ3pDLGFBQWEsQ0FBQ3lDLEtBQUssQ0FBQyxDQUFDO0lBRTFCTixNQUFNLElBQUlBLE1BQU0sQ0FBRSxDQUFDLElBQUksQ0FBQ3RCLElBQUksQ0FBQ3VCLGVBQWUsQ0FBQ1AsS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDM0IsTUFBTSxDQUFDa0MsZUFBZSxDQUFDUCxLQUFLLEVBQ3RGLHdEQUF5RCxDQUFDO0VBQzlEO0FBQ0Y7QUFFQXpDLHFCQUFxQixDQUFDdUQsUUFBUSxDQUFFLDJCQUEyQixFQUFFL0MseUJBQTBCLENBQUMifQ==