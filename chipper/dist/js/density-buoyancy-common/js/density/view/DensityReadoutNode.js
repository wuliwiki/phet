// Copyright 2019-2023, University of Colorado Boulder

/**
 * Displays a bar-scale with interactive density labels above/below and named reference values.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */

import Multilink from '../../../../axon/js/Multilink.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import { combineOptions } from '../../../../phet-core/js/optionize.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Line, ManualConstraint, Node, Rectangle, RichText, Text } from '../../../../scenery/js/imports.js';
import DensityBuoyancyCommonConstants from '../../common/DensityBuoyancyCommonConstants.js';
import Material from '../../common/model/Material.js';
import DensityBuoyancyCommonColors from '../../common/view/DensityBuoyancyCommonColors.js';
import densityBuoyancyCommon from '../../densityBuoyancyCommon.js';
import PatternStringProperty from '../../../../axon/js/PatternStringProperty.js';

// constants
const materials = [Material.HUMAN, Material.GLASS, Material.TITANIUM, Material.STEEL, Material.COPPER];
// We need different maxWidths for each, since some are closer to others
const materialsMaxWidths = [70, 70, 70, 45, 45];
const WIDTH = 400;
const HEIGHT = 22;
const MAX_DENSITY = 10000;
const LINE_PADDING = 2;
const mvt = density => WIDTH * Math.min(density, MAX_DENSITY) / MAX_DENSITY;
const MAX_LABEL_WIDTH = 80;
export default class DensityReadoutNode extends Node {
  constructor(densityAProperty, densityBProperty, secondaryMassVisibleProperty, options) {
    super();
    const background = new Rectangle(0, 0, WIDTH, HEIGHT, {
      fill: 'white',
      stroke: 'black'
    });
    this.addChild(background);

    // Include the width necessary for the labels
    background.localBounds = new Bounds2(0, 0, WIDTH, HEIGHT).dilatedX(MAX_LABEL_WIDTH / 2);
    const lineOptions = {
      stroke: 'black'
    };
    materials.forEach((material, index) => {
      const x = mvt(material.density);
      const label = new Text(material.nameProperty, {
        font: new PhetFont(12),
        maxWidth: materialsMaxWidths[index]
      });
      ManualConstraint.create(this, [label], labelProxy => {
        labelProxy.centerX = x;
        labelProxy.centerY = HEIGHT / 2;
      });
      this.addChild(label);
      this.addChild(new Line(x, 0, x, label.top - LINE_PADDING, lineOptions));
      this.addChild(new Line(x, HEIGHT, x, label.bottom + LINE_PADDING, lineOptions));
    });
    this.addChild(new Text('0', {
      right: -10,
      centerY: background.centerY,
      font: DensityBuoyancyCommonConstants.ITEM_FONT
    }));
    this.addChild(new Text('10', {
      left: WIDTH + 10,
      centerY: background.centerY,
      font: DensityBuoyancyCommonConstants.ITEM_FONT
    }));
    const arrowOptions = {
      headHeight: 4,
      headWidth: 5,
      tailWidth: 1,
      stroke: null
    };
    const labelOptions = {
      font: new PhetFont({
        size: 16,
        weight: 'bold'
      }),
      maxWidth: MAX_LABEL_WIDTH
    };
    const primaryArrow = new ArrowNode(0, -7, 0, 0, combineOptions({
      fill: DensityBuoyancyCommonColors.labelAProperty
    }, arrowOptions));
    const createDensityStringProperty = densityProperty => new PatternStringProperty(DensityBuoyancyCommonConstants.KILOGRAMS_PER_VOLUME_PATTERN_STRING_PROPERTY, {
      value: densityProperty
    }, {
      maps: {
        value: density => density / 1000
      },
      decimalPlaces: 2
    });
    const primaryLabel = new RichText(createDensityStringProperty(densityAProperty), combineOptions({
      fill: DensityBuoyancyCommonColors.labelAProperty
    }, labelOptions));
    const primaryMarker = new Node({
      children: [primaryArrow, primaryLabel]
    });
    this.addChild(primaryMarker);
    const secondaryArrow = new ArrowNode(0, 7, 0, 0, combineOptions({
      fill: DensityBuoyancyCommonColors.labelBProperty
    }, arrowOptions));
    const secondaryLabel = new RichText(createDensityStringProperty(densityBProperty), combineOptions({
      fill: DensityBuoyancyCommonColors.labelBProperty
    }, labelOptions));
    const secondaryMarker = new Node({
      children: [secondaryArrow, secondaryLabel],
      y: HEIGHT
    });
    this.addChild(secondaryMarker);

    // Density links
    // This instance lives for the lifetime of the simulation, so we don't need to remove this listener
    densityAProperty.link(density => {
      primaryMarker.x = mvt(density);
    });
    ManualConstraint.create(this, [primaryLabel, primaryArrow], (primaryLabelProxy, primaryArrowProxy) => {
      primaryLabelProxy.centerBottom = primaryArrowProxy.centerTop;
    });

    // This instance lives for the lifetime of the simulation, so we don't need to remove this listener
    densityBProperty.link(density => {
      secondaryMarker.x = mvt(density);
    });
    ManualConstraint.create(this, [secondaryLabel, secondaryArrow], (secondaryLabelProxy, secondaryArrowProxy) => {
      secondaryLabelProxy.centerTop = secondaryArrowProxy.centerBottom;
    });

    // This instance lives for the lifetime of the simulation, so we don't need to remove this listener
    densityAProperty.link(density => {
      primaryMarker.visible = density < MAX_DENSITY + 1e-5; // Allow rounding error
    });

    Multilink.multilink([secondaryMassVisibleProperty, densityBProperty], (visible, density) => {
      secondaryMarker.visible = visible && density < MAX_DENSITY + 1e-5; // Allow rounding error
    });

    this.mutate(options);
  }
}
densityBuoyancyCommon.register('DensityReadoutNode', DensityReadoutNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJCb3VuZHMyIiwiY29tYmluZU9wdGlvbnMiLCJBcnJvd05vZGUiLCJQaGV0Rm9udCIsIkxpbmUiLCJNYW51YWxDb25zdHJhaW50IiwiTm9kZSIsIlJlY3RhbmdsZSIsIlJpY2hUZXh0IiwiVGV4dCIsIkRlbnNpdHlCdW95YW5jeUNvbW1vbkNvbnN0YW50cyIsIk1hdGVyaWFsIiwiRGVuc2l0eUJ1b3lhbmN5Q29tbW9uQ29sb3JzIiwiZGVuc2l0eUJ1b3lhbmN5Q29tbW9uIiwiUGF0dGVyblN0cmluZ1Byb3BlcnR5IiwibWF0ZXJpYWxzIiwiSFVNQU4iLCJHTEFTUyIsIlRJVEFOSVVNIiwiU1RFRUwiLCJDT1BQRVIiLCJtYXRlcmlhbHNNYXhXaWR0aHMiLCJXSURUSCIsIkhFSUdIVCIsIk1BWF9ERU5TSVRZIiwiTElORV9QQURESU5HIiwibXZ0IiwiZGVuc2l0eSIsIk1hdGgiLCJtaW4iLCJNQVhfTEFCRUxfV0lEVEgiLCJEZW5zaXR5UmVhZG91dE5vZGUiLCJjb25zdHJ1Y3RvciIsImRlbnNpdHlBUHJvcGVydHkiLCJkZW5zaXR5QlByb3BlcnR5Iiwic2Vjb25kYXJ5TWFzc1Zpc2libGVQcm9wZXJ0eSIsIm9wdGlvbnMiLCJiYWNrZ3JvdW5kIiwiZmlsbCIsInN0cm9rZSIsImFkZENoaWxkIiwibG9jYWxCb3VuZHMiLCJkaWxhdGVkWCIsImxpbmVPcHRpb25zIiwiZm9yRWFjaCIsIm1hdGVyaWFsIiwiaW5kZXgiLCJ4IiwibGFiZWwiLCJuYW1lUHJvcGVydHkiLCJmb250IiwibWF4V2lkdGgiLCJjcmVhdGUiLCJsYWJlbFByb3h5IiwiY2VudGVyWCIsImNlbnRlclkiLCJ0b3AiLCJib3R0b20iLCJyaWdodCIsIklURU1fRk9OVCIsImxlZnQiLCJhcnJvd09wdGlvbnMiLCJoZWFkSGVpZ2h0IiwiaGVhZFdpZHRoIiwidGFpbFdpZHRoIiwibGFiZWxPcHRpb25zIiwic2l6ZSIsIndlaWdodCIsInByaW1hcnlBcnJvdyIsImxhYmVsQVByb3BlcnR5IiwiY3JlYXRlRGVuc2l0eVN0cmluZ1Byb3BlcnR5IiwiZGVuc2l0eVByb3BlcnR5IiwiS0lMT0dSQU1TX1BFUl9WT0xVTUVfUEFUVEVSTl9TVFJJTkdfUFJPUEVSVFkiLCJ2YWx1ZSIsIm1hcHMiLCJkZWNpbWFsUGxhY2VzIiwicHJpbWFyeUxhYmVsIiwicHJpbWFyeU1hcmtlciIsImNoaWxkcmVuIiwic2Vjb25kYXJ5QXJyb3ciLCJsYWJlbEJQcm9wZXJ0eSIsInNlY29uZGFyeUxhYmVsIiwic2Vjb25kYXJ5TWFya2VyIiwieSIsImxpbmsiLCJwcmltYXJ5TGFiZWxQcm94eSIsInByaW1hcnlBcnJvd1Byb3h5IiwiY2VudGVyQm90dG9tIiwiY2VudGVyVG9wIiwic2Vjb25kYXJ5TGFiZWxQcm94eSIsInNlY29uZGFyeUFycm93UHJveHkiLCJ2aXNpYmxlIiwibXVsdGlsaW5rIiwibXV0YXRlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJEZW5zaXR5UmVhZG91dE5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogRGlzcGxheXMgYSBiYXItc2NhbGUgd2l0aCBpbnRlcmFjdGl2ZSBkZW5zaXR5IGxhYmVscyBhYm92ZS9iZWxvdyBhbmQgbmFtZWQgcmVmZXJlbmNlIHZhbHVlcy5cclxuICpcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxyXG4gKi9cclxuXHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IHsgY29tYmluZU9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IEFycm93Tm9kZSwgeyBBcnJvd05vZGVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL0Fycm93Tm9kZS5qcyc7XHJcbmltcG9ydCBQaGV0Rm9udCBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvUGhldEZvbnQuanMnO1xyXG5pbXBvcnQgeyBMaW5lLCBNYW51YWxDb25zdHJhaW50LCBOb2RlLCBOb2RlT3B0aW9ucywgUmVjdGFuZ2xlLCBSaWNoVGV4dCwgVGV4dCwgVGV4dE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgRGVuc2l0eUJ1b3lhbmN5Q29tbW9uQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9EZW5zaXR5QnVveWFuY3lDb21tb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgTWF0ZXJpYWwgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL01hdGVyaWFsLmpzJztcclxuaW1wb3J0IERlbnNpdHlCdW95YW5jeUNvbW1vbkNvbG9ycyBmcm9tICcuLi8uLi9jb21tb24vdmlldy9EZW5zaXR5QnVveWFuY3lDb21tb25Db2xvcnMuanMnO1xyXG5pbXBvcnQgZGVuc2l0eUJ1b3lhbmN5Q29tbW9uIGZyb20gJy4uLy4uL2RlbnNpdHlCdW95YW5jeUNvbW1vbi5qcyc7XHJcbmltcG9ydCBQYXR0ZXJuU3RyaW5nUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9QYXR0ZXJuU3RyaW5nUHJvcGVydHkuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IG1hdGVyaWFscyA9IFtcclxuICBNYXRlcmlhbC5IVU1BTixcclxuICBNYXRlcmlhbC5HTEFTUyxcclxuICBNYXRlcmlhbC5USVRBTklVTSxcclxuICBNYXRlcmlhbC5TVEVFTCxcclxuICBNYXRlcmlhbC5DT1BQRVJcclxuXTtcclxuLy8gV2UgbmVlZCBkaWZmZXJlbnQgbWF4V2lkdGhzIGZvciBlYWNoLCBzaW5jZSBzb21lIGFyZSBjbG9zZXIgdG8gb3RoZXJzXHJcbmNvbnN0IG1hdGVyaWFsc01heFdpZHRocyA9IFtcclxuICA3MCwgNzAsIDcwLCA0NSwgNDVcclxuXTtcclxuY29uc3QgV0lEVEggPSA0MDA7XHJcbmNvbnN0IEhFSUdIVCA9IDIyO1xyXG5jb25zdCBNQVhfREVOU0lUWSA9IDEwMDAwO1xyXG5jb25zdCBMSU5FX1BBRERJTkcgPSAyO1xyXG5jb25zdCBtdnQgPSAoIGRlbnNpdHk6IG51bWJlciApID0+IFdJRFRIICogTWF0aC5taW4oIGRlbnNpdHksIE1BWF9ERU5TSVRZICkgLyBNQVhfREVOU0lUWTtcclxuY29uc3QgTUFYX0xBQkVMX1dJRFRIID0gODA7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEZW5zaXR5UmVhZG91dE5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBkZW5zaXR5QVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXI+LCBkZW5zaXR5QlByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXI+LCBzZWNvbmRhcnlNYXNzVmlzaWJsZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPiwgb3B0aW9ucz86IE5vZGVPcHRpb25zICkge1xyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICBjb25zdCBiYWNrZ3JvdW5kID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgV0lEVEgsIEhFSUdIVCwge1xyXG4gICAgICBmaWxsOiAnd2hpdGUnLFxyXG4gICAgICBzdHJva2U6ICdibGFjaydcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGJhY2tncm91bmQgKTtcclxuXHJcbiAgICAvLyBJbmNsdWRlIHRoZSB3aWR0aCBuZWNlc3NhcnkgZm9yIHRoZSBsYWJlbHNcclxuICAgIGJhY2tncm91bmQubG9jYWxCb3VuZHMgPSBuZXcgQm91bmRzMiggMCwgMCwgV0lEVEgsIEhFSUdIVCApLmRpbGF0ZWRYKCBNQVhfTEFCRUxfV0lEVEggLyAyICk7XHJcblxyXG4gICAgY29uc3QgbGluZU9wdGlvbnMgPSB7IHN0cm9rZTogJ2JsYWNrJyB9O1xyXG4gICAgbWF0ZXJpYWxzLmZvckVhY2goICggbWF0ZXJpYWwsIGluZGV4ICkgPT4ge1xyXG4gICAgICBjb25zdCB4ID0gbXZ0KCBtYXRlcmlhbC5kZW5zaXR5ICk7XHJcbiAgICAgIGNvbnN0IGxhYmVsID0gbmV3IFRleHQoIG1hdGVyaWFsLm5hbWVQcm9wZXJ0eSwge1xyXG4gICAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTIgKSxcclxuICAgICAgICBtYXhXaWR0aDogbWF0ZXJpYWxzTWF4V2lkdGhzWyBpbmRleCBdXHJcbiAgICAgIH0gKTtcclxuICAgICAgTWFudWFsQ29uc3RyYWludC5jcmVhdGUoIHRoaXMsIFsgbGFiZWwgXSwgbGFiZWxQcm94eSA9PiB7XHJcbiAgICAgICAgbGFiZWxQcm94eS5jZW50ZXJYID0geDtcclxuICAgICAgICBsYWJlbFByb3h5LmNlbnRlclkgPSBIRUlHSFQgLyAyO1xyXG4gICAgICB9ICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIGxhYmVsICk7XHJcbiAgICAgIHRoaXMuYWRkQ2hpbGQoIG5ldyBMaW5lKCB4LCAwLCB4LCBsYWJlbC50b3AgLSBMSU5FX1BBRERJTkcsIGxpbmVPcHRpb25zICkgKTtcclxuICAgICAgdGhpcy5hZGRDaGlsZCggbmV3IExpbmUoIHgsIEhFSUdIVCwgeCwgbGFiZWwuYm90dG9tICsgTElORV9QQURESU5HLCBsaW5lT3B0aW9ucyApICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5hZGRDaGlsZCggbmV3IFRleHQoICcwJywge1xyXG4gICAgICByaWdodDogLTEwLFxyXG4gICAgICBjZW50ZXJZOiBiYWNrZ3JvdW5kLmNlbnRlclksXHJcbiAgICAgIGZvbnQ6IERlbnNpdHlCdW95YW5jeUNvbW1vbkNvbnN0YW50cy5JVEVNX0ZPTlRcclxuICAgIH0gKSApO1xyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIG5ldyBUZXh0KCAnMTAnLCB7XHJcbiAgICAgIGxlZnQ6IFdJRFRIICsgMTAsXHJcbiAgICAgIGNlbnRlclk6IGJhY2tncm91bmQuY2VudGVyWSxcclxuICAgICAgZm9udDogRGVuc2l0eUJ1b3lhbmN5Q29tbW9uQ29uc3RhbnRzLklURU1fRk9OVFxyXG4gICAgfSApICk7XHJcblxyXG4gICAgY29uc3QgYXJyb3dPcHRpb25zID0ge1xyXG4gICAgICBoZWFkSGVpZ2h0OiA0LFxyXG4gICAgICBoZWFkV2lkdGg6IDUsXHJcbiAgICAgIHRhaWxXaWR0aDogMSxcclxuICAgICAgc3Ryb2tlOiBudWxsXHJcbiAgICB9O1xyXG4gICAgY29uc3QgbGFiZWxPcHRpb25zID0ge1xyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIHsgc2l6ZTogMTYsIHdlaWdodDogJ2JvbGQnIH0gKSxcclxuICAgICAgbWF4V2lkdGg6IE1BWF9MQUJFTF9XSURUSFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBwcmltYXJ5QXJyb3cgPSBuZXcgQXJyb3dOb2RlKCAwLCAtNywgMCwgMCwgY29tYmluZU9wdGlvbnM8QXJyb3dOb2RlT3B0aW9ucz4oIHtcclxuICAgICAgZmlsbDogRGVuc2l0eUJ1b3lhbmN5Q29tbW9uQ29sb3JzLmxhYmVsQVByb3BlcnR5XHJcbiAgICB9LCBhcnJvd09wdGlvbnMgKSApO1xyXG5cclxuICAgIGNvbnN0IGNyZWF0ZURlbnNpdHlTdHJpbmdQcm9wZXJ0eSA9ICggZGVuc2l0eVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXI+ICkgPT4gbmV3IFBhdHRlcm5TdHJpbmdQcm9wZXJ0eSggRGVuc2l0eUJ1b3lhbmN5Q29tbW9uQ29uc3RhbnRzLktJTE9HUkFNU19QRVJfVk9MVU1FX1BBVFRFUk5fU1RSSU5HX1BST1BFUlRZLCB7XHJcbiAgICAgIHZhbHVlOiBkZW5zaXR5UHJvcGVydHlcclxuICAgIH0sIHtcclxuICAgICAgbWFwczoge1xyXG4gICAgICAgIHZhbHVlOiAoIGRlbnNpdHk6IG51bWJlciApID0+IGRlbnNpdHkgLyAxMDAwXHJcbiAgICAgIH0sXHJcbiAgICAgIGRlY2ltYWxQbGFjZXM6IDJcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBwcmltYXJ5TGFiZWwgPSBuZXcgUmljaFRleHQoIGNyZWF0ZURlbnNpdHlTdHJpbmdQcm9wZXJ0eSggZGVuc2l0eUFQcm9wZXJ0eSApLCBjb21iaW5lT3B0aW9uczxUZXh0T3B0aW9ucz4oIHtcclxuICAgICAgZmlsbDogRGVuc2l0eUJ1b3lhbmN5Q29tbW9uQ29sb3JzLmxhYmVsQVByb3BlcnR5XHJcbiAgICB9LCBsYWJlbE9wdGlvbnMgKSApO1xyXG4gICAgY29uc3QgcHJpbWFyeU1hcmtlciA9IG5ldyBOb2RlKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbXHJcbiAgICAgICAgcHJpbWFyeUFycm93LFxyXG4gICAgICAgIHByaW1hcnlMYWJlbFxyXG4gICAgICBdXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBwcmltYXJ5TWFya2VyICk7XHJcblxyXG4gICAgY29uc3Qgc2Vjb25kYXJ5QXJyb3cgPSBuZXcgQXJyb3dOb2RlKCAwLCA3LCAwLCAwLCBjb21iaW5lT3B0aW9uczxBcnJvd05vZGVPcHRpb25zPigge1xyXG4gICAgICBmaWxsOiBEZW5zaXR5QnVveWFuY3lDb21tb25Db2xvcnMubGFiZWxCUHJvcGVydHlcclxuICAgIH0sIGFycm93T3B0aW9ucyApICk7XHJcbiAgICBjb25zdCBzZWNvbmRhcnlMYWJlbCA9IG5ldyBSaWNoVGV4dCggY3JlYXRlRGVuc2l0eVN0cmluZ1Byb3BlcnR5KCBkZW5zaXR5QlByb3BlcnR5ICksIGNvbWJpbmVPcHRpb25zPFRleHRPcHRpb25zPigge1xyXG4gICAgICBmaWxsOiBEZW5zaXR5QnVveWFuY3lDb21tb25Db2xvcnMubGFiZWxCUHJvcGVydHlcclxuICAgIH0sIGxhYmVsT3B0aW9ucyApICk7XHJcbiAgICBjb25zdCBzZWNvbmRhcnlNYXJrZXIgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIHNlY29uZGFyeUFycm93LFxyXG4gICAgICAgIHNlY29uZGFyeUxhYmVsXHJcbiAgICAgIF0sXHJcbiAgICAgIHk6IEhFSUdIVFxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggc2Vjb25kYXJ5TWFya2VyICk7XHJcblxyXG4gICAgLy8gRGVuc2l0eSBsaW5rc1xyXG4gICAgLy8gVGhpcyBpbnN0YW5jZSBsaXZlcyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW11bGF0aW9uLCBzbyB3ZSBkb24ndCBuZWVkIHRvIHJlbW92ZSB0aGlzIGxpc3RlbmVyXHJcbiAgICBkZW5zaXR5QVByb3BlcnR5LmxpbmsoIGRlbnNpdHkgPT4ge1xyXG4gICAgICBwcmltYXJ5TWFya2VyLnggPSBtdnQoIGRlbnNpdHkgKTtcclxuICAgIH0gKTtcclxuICAgIE1hbnVhbENvbnN0cmFpbnQuY3JlYXRlKCB0aGlzLCBbIHByaW1hcnlMYWJlbCwgcHJpbWFyeUFycm93IF0sICggcHJpbWFyeUxhYmVsUHJveHksIHByaW1hcnlBcnJvd1Byb3h5ICkgPT4ge1xyXG4gICAgICBwcmltYXJ5TGFiZWxQcm94eS5jZW50ZXJCb3R0b20gPSBwcmltYXJ5QXJyb3dQcm94eS5jZW50ZXJUb3A7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gVGhpcyBpbnN0YW5jZSBsaXZlcyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW11bGF0aW9uLCBzbyB3ZSBkb24ndCBuZWVkIHRvIHJlbW92ZSB0aGlzIGxpc3RlbmVyXHJcbiAgICBkZW5zaXR5QlByb3BlcnR5LmxpbmsoIGRlbnNpdHkgPT4ge1xyXG4gICAgICBzZWNvbmRhcnlNYXJrZXIueCA9IG12dCggZGVuc2l0eSApO1xyXG4gICAgfSApO1xyXG4gICAgTWFudWFsQ29uc3RyYWludC5jcmVhdGUoIHRoaXMsIFsgc2Vjb25kYXJ5TGFiZWwsIHNlY29uZGFyeUFycm93IF0sICggc2Vjb25kYXJ5TGFiZWxQcm94eSwgc2Vjb25kYXJ5QXJyb3dQcm94eSApID0+IHtcclxuICAgICAgc2Vjb25kYXJ5TGFiZWxQcm94eS5jZW50ZXJUb3AgPSBzZWNvbmRhcnlBcnJvd1Byb3h5LmNlbnRlckJvdHRvbTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBUaGlzIGluc3RhbmNlIGxpdmVzIGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIHNpbXVsYXRpb24sIHNvIHdlIGRvbid0IG5lZWQgdG8gcmVtb3ZlIHRoaXMgbGlzdGVuZXJcclxuICAgIGRlbnNpdHlBUHJvcGVydHkubGluayggZGVuc2l0eSA9PiB7XHJcbiAgICAgIHByaW1hcnlNYXJrZXIudmlzaWJsZSA9IGRlbnNpdHkgPCBNQVhfREVOU0lUWSArIDFlLTU7IC8vIEFsbG93IHJvdW5kaW5nIGVycm9yXHJcbiAgICB9ICk7XHJcbiAgICBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIHNlY29uZGFyeU1hc3NWaXNpYmxlUHJvcGVydHksIGRlbnNpdHlCUHJvcGVydHkgXSwgKCB2aXNpYmxlLCBkZW5zaXR5ICkgPT4ge1xyXG4gICAgICBzZWNvbmRhcnlNYXJrZXIudmlzaWJsZSA9IHZpc2libGUgJiYgZGVuc2l0eSA8IE1BWF9ERU5TSVRZICsgMWUtNTsgLy8gQWxsb3cgcm91bmRpbmcgZXJyb3JcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLm11dGF0ZSggb3B0aW9ucyApO1xyXG4gIH1cclxufVxyXG5cclxuZGVuc2l0eUJ1b3lhbmN5Q29tbW9uLnJlZ2lzdGVyKCAnRGVuc2l0eVJlYWRvdXROb2RlJywgRGVuc2l0eVJlYWRvdXROb2RlICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFHQSxPQUFPQSxTQUFTLE1BQU0sa0NBQWtDO0FBQ3hELE9BQU9DLE9BQU8sTUFBTSwrQkFB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