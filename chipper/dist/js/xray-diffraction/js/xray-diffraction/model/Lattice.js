// Copyright 2020, University of Colorado Boulder

/**
 * Model for a crystall lattice.
 * responsible for:
 *   - storing the lattice constants.
 *   - Keeping track of the angle (orientation) of the crystal.
 *
 * @author Todd Holden (https://tholden79.wixsite.com/mysite2)
 */

// modules
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Vector3 from '../../../../dot/js/Vector3.js';
import xrayDiffraction from '../../xrayDiffraction.js';

//----------------------------------------------------------------------------------------
// constants
const CRYSTAL_SIZE = 20; // size of the crystal in Angstrom. Width and Height from the center

class Lattice {
  /**
   * Create a new sample crystal model. The mutable lattice constants (Assumed orthorhombic for now) and orientation.
   *
   * @param {Vector3} latticeConstants - the lattice constants of the sample in angstrom
   * @param {number} orientation - Theta, // phi, (and third as a ToDo) in radians
   * @constructor
   */
  constructor(latticeConstants, orientation) {
    assert && assert(latticeConstants.x > 0, `Lattice constants should be positive: ${latticeConstants.x}`);
    assert && assert(latticeConstants.y > 0, `Lattice constants should be positive: ${latticeConstants.y}`);
    assert && assert(latticeConstants.z > 0, `Lattice constants should be positive: ${latticeConstants.z}`);
    assert && assert(orientation > -7 && orientation < 7, `Orientation (radians) normally < 2Ï€: ${orientation}`);

    // @public {Vector3} the Lattice Constants of the sample (a, b, c) - if these change, updateSites should be called.
    // These are needed for the entire life of the simulation, and thus are never disposed.
    this.aConstantProperty = new NumberProperty(latticeConstants.x);
    this.bConstantProperty = new NumberProperty(latticeConstants.y);
    this.cConstantProperty = new NumberProperty(latticeConstants.z);
    this.latticeConstantsProperty = new DerivedProperty([this.aConstantProperty, this.bConstantProperty, this.cConstantProperty], (a, b, c) => new Vector3(a, b, c));

    // @public {number} the orientation in radians relative to the incoming light
    this.orientationProperty = new NumberProperty(orientation);

    // @public (read-only) {Array.<Vector>} the points on the lattice. Should only be changed with the updateSites call.
    this.sites = [];
    this.updateSites();
  }

  /**
   * Resets the graph. Called when the reset all button is clicked.
   * @public
   */
  reset() {
    this.orientationProperty.reset();
    this.aConstantProperty.reset();
    this.bConstantProperty.reset();
    this.cConstantProperty.reset();
    this.updateSites();
  }

  /**
   * Recreates this.sites (lattice points) based on current parameters.
   * Called when lattice constant changes or crystal rotates.
   * @public
   */
  updateSites() {
    // should set above or in initialization file. Perhaps better to confine it to a shape.
    const aLattice = this.latticeConstantsProperty.get().x;
    const cLattice = this.latticeConstantsProperty.get().z;
    const crystalXMax = CRYSTAL_SIZE / aLattice; // Must be at least 1 to have a three row lattice
    const crystalYMax = CRYSTAL_SIZE / cLattice;
    const cosTheta = Math.cos(this.orientationProperty.get());
    const sinTheta = Math.sin(this.orientationProperty.get());
    let topRowSpacingHalf;
    if (Math.abs(cosTheta) > 0.7071068) {
      // sqrt(2) for a rectangular lattice to see which face is on top
      topRowSpacingHalf = aLattice * Math.abs(cosTheta) / 2;
    } else {
      topRowSpacingHalf = cLattice * Math.abs(sinTheta) / 2;
    }
    const aSin = aLattice * sinTheta;
    const aCos = aLattice * cosTheta;
    const cSin = cLattice * sinTheta;
    const cCos = cLattice * cosTheta;
    this.sites.length = 0;
    for (let x = 0; x <= crystalXMax; x++) {
      for (let y = 0; y <= crystalYMax; y++) {
        const xSin = x * aSin;
        const xCos = x * aCos;
        const ySin = y * cSin;
        const yCos = y * cCos;
        this.sites.push(new Vector2(xCos - ySin, xSin + yCos));
        this.sites.push(new Vector2(-xCos - ySin, -xSin + yCos));
        this.sites.push(new Vector2(-xCos + ySin, -xSin - yCos));
        this.sites.push(new Vector2(ySin + xCos, xSin - yCos));

        // Find top, center atom and place it in sites[0]. sites[1,2,3] are all still the atom at the center (origin).
        // We only need to do this for max x and max y if we need to optimize. Could be separated out
        if (Math.abs(xCos - ySin) <= topRowSpacingHalf && Math.abs(yCos - xSin) > this.sites[0].y) {
          if (yCos - xSin > 0) {
            this.sites[0] = new Vector2(xCos - ySin, yCos - xSin);
          } else {
            this.sites[0] = new Vector2(ySin - xCos, xSin - yCos);
          }
        } else if (Math.abs(xCos + ySin) <= topRowSpacingHalf && Math.abs(yCos + xSin) > this.sites[0].y) {
          if (xCos + ySin > 0) {
            this.sites[0] = new Vector2(xCos + ySin, -xSin - yCos);
          } else {
            this.sites[0] = new Vector2(-xCos - ySin, xSin + yCos);
          }
        }
      }
    }
  }
}
xrayDiffraction.register('Lattice', Lattice);
export default Lattice;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIlZlY3RvcjIiLCJWZWN0b3IzIiwieHJheURpZmZyYWN0aW9uIiwiQ1JZU1RBTF9TSVpFIiwiTGF0dGljZSIsImNvbnN0cnVjdG9yIiwibGF0dGljZUNvbnN0YW50cyIsIm9yaWVudGF0aW9uIiwiYXNzZXJ0IiwieCIsInkiLCJ6IiwiYUNvbnN0YW50UHJvcGVydHkiLCJiQ29uc3RhbnRQcm9wZXJ0eSIsImNDb25zdGFudFByb3BlcnR5IiwibGF0dGljZUNvbnN0YW50c1Byb3BlcnR5IiwiYSIsImIiLCJjIiwib3JpZW50YXRpb25Qcm9wZXJ0eSIsInNpdGVzIiwidXBkYXRlU2l0ZXMiLCJyZXNldCIsImFMYXR0aWNlIiwiZ2V0IiwiY0xhdHRpY2UiLCJjcnlzdGFsWE1heCIsImNyeXN0YWxZTWF4IiwiY29zVGhldGEiLCJNYXRoIiwiY29zIiwic2luVGhldGEiLCJzaW4iLCJ0b3BSb3dTcGFjaW5nSGFsZiIsImFicyIsImFTaW4iLCJhQ29zIiwiY1NpbiIsImNDb3MiLCJsZW5ndGgiLCJ4U2luIiwieENvcyIsInlTaW4iLCJ5Q29zIiwicHVzaCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiTGF0dGljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogTW9kZWwgZm9yIGEgY3J5c3RhbGwgbGF0dGljZS5cclxuICogcmVzcG9uc2libGUgZm9yOlxyXG4gKiAgIC0gc3RvcmluZyB0aGUgbGF0dGljZSBjb25zdGFudHMuXHJcbiAqICAgLSBLZWVwaW5nIHRyYWNrIG9mIHRoZSBhbmdsZSAob3JpZW50YXRpb24pIG9mIHRoZSBjcnlzdGFsLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFRvZGQgSG9sZGVuIChodHRwczovL3Rob2xkZW43OS53aXhzaXRlLmNvbS9teXNpdGUyKVxyXG4gKi9cclxuXHJcbi8vIG1vZHVsZXNcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMy5qcyc7XHJcbmltcG9ydCB4cmF5RGlmZnJhY3Rpb24gZnJvbSAnLi4vLi4veHJheURpZmZyYWN0aW9uLmpzJztcclxuXHJcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgQ1JZU1RBTF9TSVpFID0gMjA7IC8vIHNpemUgb2YgdGhlIGNyeXN0YWwgaW4gQW5nc3Ryb20uIFdpZHRoIGFuZCBIZWlnaHQgZnJvbSB0aGUgY2VudGVyXHJcblxyXG5jbGFzcyBMYXR0aWNlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGEgbmV3IHNhbXBsZSBjcnlzdGFsIG1vZGVsLiBUaGUgbXV0YWJsZSBsYXR0aWNlIGNvbnN0YW50cyAoQXNzdW1lZCBvcnRob3Job21iaWMgZm9yIG5vdykgYW5kIG9yaWVudGF0aW9uLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtWZWN0b3IzfSBsYXR0aWNlQ29uc3RhbnRzIC0gdGhlIGxhdHRpY2UgY29uc3RhbnRzIG9mIHRoZSBzYW1wbGUgaW4gYW5nc3Ryb21cclxuICAgKiBAcGFyYW0ge251bWJlcn0gb3JpZW50YXRpb24gLSBUaGV0YSwgLy8gcGhpLCAoYW5kIHRoaXJkIGFzIGEgVG9EbykgaW4gcmFkaWFuc1xyXG4gICAqIEBjb25zdHJ1Y3RvclxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBsYXR0aWNlQ29uc3RhbnRzLCBvcmllbnRhdGlvbiApIHtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBsYXR0aWNlQ29uc3RhbnRzLnggPiAwLCBgTGF0dGljZSBjb25zdGFudHMgc2hvdWxkIGJlIHBvc2l0aXZlOiAke2xhdHRpY2VDb25zdGFudHMueH1gICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBsYXR0aWNlQ29uc3RhbnRzLnkgPiAwLCBgTGF0dGljZSBjb25zdGFudHMgc2hvdWxkIGJlIHBvc2l0aXZlOiAke2xhdHRpY2VDb25zdGFudHMueX1gICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBsYXR0aWNlQ29uc3RhbnRzLnogPiAwLCBgTGF0dGljZSBjb25zdGFudHMgc2hvdWxkIGJlIHBvc2l0aXZlOiAke2xhdHRpY2VDb25zdGFudHMuen1gICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcmllbnRhdGlvbiA+IC03ICYmIG9yaWVudGF0aW9uIDwgNywgYE9yaWVudGF0aW9uIChyYWRpYW5zKSBub3JtYWxseSA8IDLPgDogJHtvcmllbnRhdGlvbn1gICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7VmVjdG9yM30gdGhlIExhdHRpY2UgQ29uc3RhbnRzIG9mIHRoZSBzYW1wbGUgKGEsIGIsIGMpIC0gaWYgdGhlc2UgY2hhbmdlLCB1cGRhdGVTaXRlcyBzaG91bGQgYmUgY2FsbGVkLlxyXG4gICAgLy8gVGhlc2UgYXJlIG5lZWRlZCBmb3IgdGhlIGVudGlyZSBsaWZlIG9mIHRoZSBzaW11bGF0aW9uLCBhbmQgdGh1cyBhcmUgbmV2ZXIgZGlzcG9zZWQuXHJcbiAgICB0aGlzLmFDb25zdGFudFByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCBsYXR0aWNlQ29uc3RhbnRzLnggKTtcclxuICAgIHRoaXMuYkNvbnN0YW50UHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIGxhdHRpY2VDb25zdGFudHMueSApO1xyXG4gICAgdGhpcy5jQ29uc3RhbnRQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggbGF0dGljZUNvbnN0YW50cy56ICk7XHJcbiAgICB0aGlzLmxhdHRpY2VDb25zdGFudHNQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgdGhpcy5hQ29uc3RhbnRQcm9wZXJ0eSwgdGhpcy5iQ29uc3RhbnRQcm9wZXJ0eSwgdGhpcy5jQ29uc3RhbnRQcm9wZXJ0eSBdLFxyXG4gICAgICAoIGEsIGIsIGMgKSA9PiBuZXcgVmVjdG9yMyggYSwgYiwgYyApICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7bnVtYmVyfSB0aGUgb3JpZW50YXRpb24gaW4gcmFkaWFucyByZWxhdGl2ZSB0byB0aGUgaW5jb21pbmcgbGlnaHRcclxuICAgIHRoaXMub3JpZW50YXRpb25Qcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggb3JpZW50YXRpb24gKTtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIHtBcnJheS48VmVjdG9yPn0gdGhlIHBvaW50cyBvbiB0aGUgbGF0dGljZS4gU2hvdWxkIG9ubHkgYmUgY2hhbmdlZCB3aXRoIHRoZSB1cGRhdGVTaXRlcyBjYWxsLlxyXG4gICAgdGhpcy5zaXRlcyA9IFtdO1xyXG4gICAgdGhpcy51cGRhdGVTaXRlcygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXRzIHRoZSBncmFwaC4gQ2FsbGVkIHdoZW4gdGhlIHJlc2V0IGFsbCBidXR0b24gaXMgY2xpY2tlZC5cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLm9yaWVudGF0aW9uUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuYUNvbnN0YW50UHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuYkNvbnN0YW50UHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuY0NvbnN0YW50UHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMudXBkYXRlU2l0ZXMoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlY3JlYXRlcyB0aGlzLnNpdGVzIChsYXR0aWNlIHBvaW50cykgYmFzZWQgb24gY3VycmVudCBwYXJhbWV0ZXJzLlxyXG4gICAqIENhbGxlZCB3aGVuIGxhdHRpY2UgY29uc3RhbnQgY2hhbmdlcyBvciBjcnlzdGFsIHJvdGF0ZXMuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHVwZGF0ZVNpdGVzKCkge1xyXG5cclxuICAgIC8vIHNob3VsZCBzZXQgYWJvdmUgb3IgaW4gaW5pdGlhbGl6YXRpb24gZmlsZS4gUGVyaGFwcyBiZXR0ZXIgdG8gY29uZmluZSBpdCB0byBhIHNoYXBlLlxyXG4gICAgY29uc3QgYUxhdHRpY2UgPSB0aGlzLmxhdHRpY2VDb25zdGFudHNQcm9wZXJ0eS5nZXQoKS54O1xyXG4gICAgY29uc3QgY0xhdHRpY2UgPSB0aGlzLmxhdHRpY2VDb25zdGFudHNQcm9wZXJ0eS5nZXQoKS56O1xyXG4gICAgY29uc3QgY3J5c3RhbFhNYXggPSBDUllTVEFMX1NJWkUgLyBhTGF0dGljZTsgLy8gTXVzdCBiZSBhdCBsZWFzdCAxIHRvIGhhdmUgYSB0aHJlZSByb3cgbGF0dGljZVxyXG4gICAgY29uc3QgY3J5c3RhbFlNYXggPSBDUllTVEFMX1NJWkUgLyBjTGF0dGljZTtcclxuXHJcbiAgICBjb25zdCBjb3NUaGV0YSA9IE1hdGguY29zKCB0aGlzLm9yaWVudGF0aW9uUHJvcGVydHkuZ2V0KCkgKTtcclxuICAgIGNvbnN0IHNpblRoZXRhID0gTWF0aC5zaW4oIHRoaXMub3JpZW50YXRpb25Qcm9wZXJ0eS5nZXQoKSApO1xyXG5cclxuICAgIGxldCB0b3BSb3dTcGFjaW5nSGFsZjtcclxuICAgIGlmICggTWF0aC5hYnMoIGNvc1RoZXRhICkgPiAwLjcwNzEwNjggKSB7IC8vIHNxcnQoMikgZm9yIGEgcmVjdGFuZ3VsYXIgbGF0dGljZSB0byBzZWUgd2hpY2ggZmFjZSBpcyBvbiB0b3BcclxuICAgICAgdG9wUm93U3BhY2luZ0hhbGYgPSBhTGF0dGljZSAqIE1hdGguYWJzKCBjb3NUaGV0YSApIC8gMjtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0b3BSb3dTcGFjaW5nSGFsZiA9IGNMYXR0aWNlICogTWF0aC5hYnMoIHNpblRoZXRhICkgLyAyO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYVNpbiA9IGFMYXR0aWNlICogc2luVGhldGE7XHJcbiAgICBjb25zdCBhQ29zID0gYUxhdHRpY2UgKiBjb3NUaGV0YTtcclxuICAgIGNvbnN0IGNTaW4gPSBjTGF0dGljZSAqIHNpblRoZXRhO1xyXG4gICAgY29uc3QgY0NvcyA9IGNMYXR0aWNlICogY29zVGhldGE7XHJcblxyXG4gICAgdGhpcy5zaXRlcy5sZW5ndGggPSAwO1xyXG4gICAgZm9yICggbGV0IHggPSAwOyB4IDw9IGNyeXN0YWxYTWF4OyB4KysgKSB7XHJcbiAgICAgIGZvciAoIGxldCB5ID0gMDsgeSA8PSBjcnlzdGFsWU1heDsgeSsrICkge1xyXG4gICAgICAgIGNvbnN0IHhTaW4gPSB4ICogYVNpbjtcclxuICAgICAgICBjb25zdCB4Q29zID0geCAqIGFDb3M7XHJcbiAgICAgICAgY29uc3QgeVNpbiA9IHkgKiBjU2luO1xyXG4gICAgICAgIGNvbnN0IHlDb3MgPSB5ICogY0NvcztcclxuICAgICAgICB0aGlzLnNpdGVzLnB1c2goIG5ldyBWZWN0b3IyKCB4Q29zIC0geVNpbiwgeFNpbiArIHlDb3MgKSApO1xyXG4gICAgICAgIHRoaXMuc2l0ZXMucHVzaCggbmV3IFZlY3RvcjIoIC14Q29zIC0geVNpbiwgLXhTaW4gKyB5Q29zICkgKTtcclxuICAgICAgICB0aGlzLnNpdGVzLnB1c2goIG5ldyBWZWN0b3IyKCAteENvcyArIHlTaW4sIC14U2luIC0geUNvcyApICk7XHJcbiAgICAgICAgdGhpcy5zaXRlcy5wdXNoKCBuZXcgVmVjdG9yMiggeVNpbiArIHhDb3MsIHhTaW4gLSB5Q29zICkgKTtcclxuXHJcbiAgICAgICAgLy8gRmluZCB0b3AsIGNlbnRlciBhdG9tIGFuZCBwbGFjZSBpdCBpbiBzaXRlc1swXS4gc2l0ZXNbMSwyLDNdIGFyZSBhbGwgc3RpbGwgdGhlIGF0b20gYXQgdGhlIGNlbnRlciAob3JpZ2luKS5cclxuICAgICAgICAvLyBXZSBvbmx5IG5lZWQgdG8gZG8gdGhpcyBmb3IgbWF4IHggYW5kIG1heCB5IGlmIHdlIG5lZWQgdG8gb3B0aW1pemUuIENvdWxkIGJlIHNlcGFyYXRlZCBvdXRcclxuICAgICAgICBpZiAoICggTWF0aC5hYnMoIHhDb3MgLSB5U2luICkgPD0gdG9wUm93U3BhY2luZ0hhbGYgKSAmJiAoICggTWF0aC5hYnMoIHlDb3MgLSB4U2luICkgPiB0aGlzLnNpdGVzWyAwIF0ueSApICkgKSB7XHJcbiAgICAgICAgICBpZiAoICggeUNvcyAtIHhTaW4gKSA+IDAgKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2l0ZXNbIDAgXSA9IG5ldyBWZWN0b3IyKCB4Q29zIC0geVNpbiwgeUNvcyAtIHhTaW4gKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnNpdGVzWyAwIF0gPSBuZXcgVmVjdG9yMiggeVNpbiAtIHhDb3MsIHhTaW4gLSB5Q29zICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCAoIE1hdGguYWJzKCB4Q29zICsgeVNpbiApIDw9IHRvcFJvd1NwYWNpbmdIYWxmICkgJiYgKCAoIE1hdGguYWJzKCB5Q29zICsgeFNpbiApID4gdGhpcy5zaXRlc1sgMCBdLnkgKSApICkge1xyXG4gICAgICAgICAgaWYgKCAoIHhDb3MgKyB5U2luICkgPiAwICkge1xyXG4gICAgICAgICAgICB0aGlzLnNpdGVzWyAwIF0gPSBuZXcgVmVjdG9yMiggeENvcyArIHlTaW4sIC14U2luIC0geUNvcyApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2l0ZXNbIDAgXSA9IG5ldyBWZWN0b3IyKCAteENvcyAtIHlTaW4sIHhTaW4gKyB5Q29zICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG54cmF5RGlmZnJhY3Rpb24ucmVnaXN0ZXIoICdMYXR0aWNlJywgTGF0dGljZSApO1xyXG5leHBvcnQgZGVmYXVsdCBMYXR0aWNlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsY0FBYyxNQUFNLHVDQUF1QztBQUNsRSxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsZUFBZSxNQUFNLDBCQUEwQjs7QUFFdEQ7QUFDQTtBQUNBLE1BQU1DLFlBQVksR0FBRyxFQUFFLENBQUMsQ0FBQzs7QUFFekIsTUFBTUMsT0FBTyxDQUFDO0VBRVo7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRUMsV0FBV0EsQ0FBRUMsZ0JBQWdCLEVBQUVDLFdBQVcsRUFBRztJQUUzQ0MsTUFBTSxJQUFJQSxNQUFNLENBQUVGLGdCQUFnQixDQUFDRyxDQUFDLEdBQUcsQ0FBQyxFQUFHLHlDQUF3Q0gsZ0JBQWdCLENBQUNHLENBQUUsRUFBRSxDQUFDO0lBQ3pHRCxNQUFNLElBQUlBLE1BQU0sQ0FBRUYsZ0JBQWdCLENBQUNJLENBQUMsR0FBRyxDQUFDLEVBQUcseUNBQXdDSixnQkFBZ0IsQ0FBQ0ksQ0FBRSxFQUFFLENBQUM7SUFDekdGLE1BQU0sSUFBSUEsTUFBTSxDQUFFRixnQkFBZ0IsQ0FBQ0ssQ0FBQyxHQUFHLENBQUMsRUFBRyx5Q0FBd0NMLGdCQUFnQixDQUFDSyxDQUFFLEVBQUUsQ0FBQztJQUN6R0gsTUFBTSxJQUFJQSxNQUFNLENBQUVELFdBQVcsR0FBRyxDQUFDLENBQUMsSUFBSUEsV0FBVyxHQUFHLENB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