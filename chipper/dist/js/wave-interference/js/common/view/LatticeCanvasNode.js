// Copyright 2017-2022, University of Colorado Boulder
// @ts-nocheck
/**
 * Renders the main area of the lattice (doesn't include the damping regions) using 2d canvas.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import merge from '../../../../phet-core/js/merge.js';
import { CanvasNode, Color } from '../../../../scenery/js/imports.js';
import waveInterference from '../../waveInterference.js';
import WaveInterferenceConstants from '../WaveInterferenceConstants.js';
import WaveInterferenceUtils from '../WaveInterferenceUtils.js';
import ImageDataRenderer from '../../../../scenery-phet/js/ImageDataRenderer.js';

// constants
const CUTOFF = 0.4;
class LatticeCanvasNode extends CanvasNode {
  /**
   * @param lattice
   * @param [options]
   */
  constructor(lattice, options) {
    options = merge({
      // only use the visible part for the bounds (not the damping regions)
      canvasBounds: WaveInterferenceUtils.getCanvasBounds(lattice),
      layerSplit: true,
      // ensure we're on our own layer
      baseColor: Color.blue
    }, options);
    super(options);

    // @private
    this.lattice = lattice;

    // @private
    this.baseColor = options.baseColor;

    // @public {Color|null} - settable, if defined shows unvisited lattice cells as specified color, used for light
    this.vacuumColor = null;

    // @private - For performance, render into a sub-canvas which will be drawn into the rendering context at the right
    // scale.
    this.imageDataRenderer = new ImageDataRenderer(lattice.visibleBounds.width, lattice.visibleBounds.height);

    // Invalidate paint when model indicates changes
    lattice.changedEmitter.addListener(this.invalidatePaint.bind(this));
  }

  /**
   * Convert the given point in the local coordinate frame to the corresponding i,j (integral) lattice coordinates.
   * @param point - point in the local coordinate frame
   */
  static localPointToLatticePoint(point) {
    return new Vector2(Utils.roundSymmetric(point.x / WaveInterferenceConstants.CELL_WIDTH), Utils.roundSymmetric(point.y / WaveInterferenceConstants.CELL_WIDTH));
  }

  /**
   * Sets the color of the peaks of the wave.
   */
  setBaseColor(color) {
    this.baseColor = color;
    this.invalidatePaint();
  }

  /**
   * Draws into the canvas.
   */
  paintCanvas(context) {
    let m = 0;
    const data = this.imageDataRenderer.data;
    const dampX = this.lattice.dampX;
    const dampY = this.lattice.dampY;
    const width = this.lattice.width;
    const height = this.lattice.height;
    let intensity;
    for (let i = dampX; i < width - dampX; i++) {
      for (let k = dampY; k < height - dampY; k++) {
        // Note this is transposed because of the ordering of putImageData
        const waveValue = this.lattice.getInterpolatedValue(k, i);
        if (waveValue > 0) {
          intensity = Utils.linear(0, 2, CUTOFF, 1, waveValue);
          intensity = Utils.clamp(intensity, CUTOFF, 1);
        } else {
          const MIN_SHADE = 0.03; // Stop before 0 because 0 is too jarring
          intensity = Utils.linear(-1.5, 0, MIN_SHADE, CUTOFF, waveValue);
          intensity = Utils.clamp(intensity, MIN_SHADE, CUTOFF);
        }

        // Note this interpolation doesn't include the gamma factor that Color.blend does
        let r = this.baseColor.red * intensity;
        let g = this.baseColor.green * intensity;
        let b = this.baseColor.blue * intensity;

        // Note this is transposed because of the ordering of putImageData
        if (this.vacuumColor && !this.lattice.hasCellBeenVisited(k, i)) {
          r = this.vacuumColor.r;
          g = this.vacuumColor.g;
          b = this.vacuumColor.b;
        }

        // ImageData.data is Uint8ClampedArray.  Performance is critical and all numbers are non-negative.
        const offset = 4 * m;
        data[offset] = Math.round(r); // eslint-disable-line bad-sim-text
        data[offset + 1] = Math.round(g); // eslint-disable-line bad-sim-text
        data[offset + 2] = Math.round(b); // eslint-disable-line bad-sim-text
        data[offset + 3] = 255; // Fully opaque
        m++;
      }
    }
    this.imageDataRenderer.putImageData();

    // draw the sub-canvas to the rendering context at the appropriate scale
    context.save();
    context.transform(WaveInterferenceConstants.CELL_WIDTH, 0, 0, WaveInterferenceConstants.CELL_WIDTH, 0, 0);
    context.drawImage(this.imageDataRenderer.canvas, 0, 0);
    context.restore();
  }
}
waveInterference.register('LatticeCanvasNode', LatticeCanvasNode);
export default LatticeCanvasNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlZlY3RvcjIiLCJtZXJnZSIsIkNhbnZhc05vZGUiLCJDb2xvciIsIndhdmVJbnRlcmZlcmVuY2UiLCJXYXZlSW50ZXJmZXJlbmNlQ29uc3RhbnRzIiwiV2F2ZUludGVyZmVyZW5jZVV0aWxzIiwiSW1hZ2VEYXRhUmVuZGVyZXIiLCJDVVRPRkYiLCJMYXR0aWNlQ2FudmFzTm9kZSIsImNvbnN0cnVjdG9yIiwibGF0dGljZSIsIm9wdGlvbnMiLCJjYW52YXNCb3VuZHMiLCJnZXRDYW52YXNCb3VuZHMiLCJsYXllclNwbGl0IiwiYmFzZUNvbG9yIiwiYmx1ZSIsInZhY3V1bUNvbG9yIiwiaW1hZ2VEYXRhUmVuZGVyZXIiLCJ2aXNpYmxlQm91bmRzIiwid2lkdGgiLCJoZWlnaHQiLCJjaGFuZ2VkRW1pdHRlciIsImFkZExpc3RlbmVyIiwiaW52YWxpZGF0ZVBhaW50IiwiYmluZCIsImxvY2FsUG9pbnRUb0xhdHRpY2VQb2ludCIsInBvaW50Iiwicm91bmRTeW1tZXRyaWMiLCJ4IiwiQ0VMTF9XSURUSCIsInkiLCJzZXRCYXNlQ29sb3IiLCJjb2xvciIsInBhaW50Q2FudmFzIiwiY29udGV4dCIsIm0iLCJkYXRhIiwiZGFtcFgiLCJkYW1wWSIsImludGVuc2l0eSIsImkiLCJrIiwid2F2ZVZhbHVlIiwiZ2V0SW50ZXJwb2xhdGVkVmFsdWUiLCJsaW5lYXIiLCJjbGFtcCIsIk1JTl9TSEFERSIsInIiLCJyZWQiLCJnIiwiZ3JlZW4iLCJiIiwiaGFzQ2VsbEJlZW5WaXNpdGVkIiwib2Zmc2V0IiwiTWF0aCIsInJvdW5kIiwicHV0SW1hZ2VEYXRhIiwic2F2ZSIsInRyYW5zZm9ybSIsImRyYXdJbWFnZSIsImNhbnZhcyIsInJlc3RvcmUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkxhdHRpY2VDYW52YXNOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG4vLyBAdHMtbm9jaGVja1xyXG4vKipcclxuICogUmVuZGVycyB0aGUgbWFpbiBhcmVhIG9mIHRoZSBsYXR0aWNlIChkb2Vzbid0IGluY2x1ZGUgdGhlIGRhbXBpbmcgcmVnaW9ucykgdXNpbmcgMmQgY2FudmFzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgeyBDYW52YXNOb2RlLCBDYW52YXNOb2RlT3B0aW9ucywgQ29sb3IgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgd2F2ZUludGVyZmVyZW5jZSBmcm9tICcuLi8uLi93YXZlSW50ZXJmZXJlbmNlLmpzJztcclxuaW1wb3J0IExhdHRpY2UgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL0xhdHRpY2UuanMnO1xyXG5pbXBvcnQgV2F2ZUludGVyZmVyZW5jZUNvbnN0YW50cyBmcm9tICcuLi9XYXZlSW50ZXJmZXJlbmNlQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IFdhdmVJbnRlcmZlcmVuY2VVdGlscyBmcm9tICcuLi9XYXZlSW50ZXJmZXJlbmNlVXRpbHMuanMnO1xyXG5pbXBvcnQgSW1hZ2VEYXRhUmVuZGVyZXIgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL0ltYWdlRGF0YVJlbmRlcmVyLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBDVVRPRkYgPSAwLjQ7XHJcblxyXG5jbGFzcyBMYXR0aWNlQ2FudmFzTm9kZSBleHRlbmRzIENhbnZhc05vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gbGF0dGljZVxyXG4gICAqIEBwYXJhbSBbb3B0aW9uc11cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGxhdHRpY2U6IExhdHRpY2UsIG9wdGlvbnM6IENhbnZhc05vZGVPcHRpb25zICkge1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG5cclxuICAgICAgLy8gb25seSB1c2UgdGhlIHZpc2libGUgcGFydCBmb3IgdGhlIGJvdW5kcyAobm90IHRoZSBkYW1waW5nIHJlZ2lvbnMpXHJcbiAgICAgIGNhbnZhc0JvdW5kczogV2F2ZUludGVyZmVyZW5jZVV0aWxzLmdldENhbnZhc0JvdW5kcyggbGF0dGljZSApLFxyXG4gICAgICBsYXllclNwbGl0OiB0cnVlLCAvLyBlbnN1cmUgd2UncmUgb24gb3VyIG93biBsYXllclxyXG4gICAgICBiYXNlQ29sb3I6IENvbG9yLmJsdWVcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlXHJcbiAgICB0aGlzLmxhdHRpY2UgPSBsYXR0aWNlO1xyXG5cclxuICAgIC8vIEBwcml2YXRlXHJcbiAgICB0aGlzLmJhc2VDb2xvciA9IG9wdGlvbnMuYmFzZUNvbG9yO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge0NvbG9yfG51bGx9IC0gc2V0dGFibGUsIGlmIGRlZmluZWQgc2hvd3MgdW52aXNpdGVkIGxhdHRpY2UgY2VsbHMgYXMgc3BlY2lmaWVkIGNvbG9yLCB1c2VkIGZvciBsaWdodFxyXG4gICAgdGhpcy52YWN1dW1Db2xvciA9IG51bGw7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgLSBGb3IgcGVyZm9ybWFuY2UsIHJlbmRlciBpbnRvIGEgc3ViLWNhbnZhcyB3aGljaCB3aWxsIGJlIGRyYXduIGludG8gdGhlIHJlbmRlcmluZyBjb250ZXh0IGF0IHRoZSByaWdodFxyXG4gICAgLy8gc2NhbGUuXHJcbiAgICB0aGlzLmltYWdlRGF0YVJlbmRlcmVyID0gbmV3IEltYWdlRGF0YVJlbmRlcmVyKCBsYXR0aWNlLnZpc2libGVCb3VuZHMud2lkdGgsIGxhdHRpY2UudmlzaWJsZUJvdW5kcy5oZWlnaHQgKTtcclxuXHJcbiAgICAvLyBJbnZhbGlkYXRlIHBhaW50IHdoZW4gbW9kZWwgaW5kaWNhdGVzIGNoYW5nZXNcclxuICAgIGxhdHRpY2UuY2hhbmdlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIHRoaXMuaW52YWxpZGF0ZVBhaW50LmJpbmQoIHRoaXMgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29udmVydCB0aGUgZ2l2ZW4gcG9pbnQgaW4gdGhlIGxvY2FsIGNvb3JkaW5hdGUgZnJhbWUgdG8gdGhlIGNvcnJlc3BvbmRpbmcgaSxqIChpbnRlZ3JhbCkgbGF0dGljZSBjb29yZGluYXRlcy5cclxuICAgKiBAcGFyYW0gcG9pbnQgLSBwb2ludCBpbiB0aGUgbG9jYWwgY29vcmRpbmF0ZSBmcmFtZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgbG9jYWxQb2ludFRvTGF0dGljZVBvaW50KCBwb2ludDogVmVjdG9yMiApOiBWZWN0b3IyIHtcclxuICAgIHJldHVybiBuZXcgVmVjdG9yMihcclxuICAgICAgVXRpbHMucm91bmRTeW1tZXRyaWMoIHBvaW50LnggLyBXYXZlSW50ZXJmZXJlbmNlQ29uc3RhbnRzLkNFTExfV0lEVEggKSxcclxuICAgICAgVXRpbHMucm91bmRTeW1tZXRyaWMoIHBvaW50LnkgLyBXYXZlSW50ZXJmZXJlbmNlQ29uc3RhbnRzLkNFTExfV0lEVEggKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIGNvbG9yIG9mIHRoZSBwZWFrcyBvZiB0aGUgd2F2ZS5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0QmFzZUNvbG9yKCBjb2xvcjogQ29sb3IgKTogdm9pZCB7XHJcbiAgICB0aGlzLmJhc2VDb2xvciA9IGNvbG9yO1xyXG4gICAgdGhpcy5pbnZhbGlkYXRlUGFpbnQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERyYXdzIGludG8gdGhlIGNhbnZhcy5cclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgcGFpbnRDYW52YXMoIGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCApOiB2b2lkIHtcclxuXHJcbiAgICBsZXQgbSA9IDA7XHJcbiAgICBjb25zdCBkYXRhID0gdGhpcy5pbWFnZURhdGFSZW5kZXJlci5kYXRhO1xyXG4gICAgY29uc3QgZGFtcFggPSB0aGlzLmxhdHRpY2UuZGFtcFg7XHJcbiAgICBjb25zdCBkYW1wWSA9IHRoaXMubGF0dGljZS5kYW1wWTtcclxuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5sYXR0aWNlLndpZHRoO1xyXG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5sYXR0aWNlLmhlaWdodDtcclxuICAgIGxldCBpbnRlbnNpdHk7XHJcbiAgICBmb3IgKCBsZXQgaSA9IGRhbXBYOyBpIDwgd2lkdGggLSBkYW1wWDsgaSsrICkge1xyXG4gICAgICBmb3IgKCBsZXQgayA9IGRhbXBZOyBrIDwgaGVpZ2h0IC0gZGFtcFk7IGsrKyApIHtcclxuXHJcbiAgICAgICAgLy8gTm90ZSB0aGlzIGlzIHRyYW5zcG9zZWQgYmVjYXVzZSBvZiB0aGUgb3JkZXJpbmcgb2YgcHV0SW1hZ2VEYXRhXHJcbiAgICAgICAgY29uc3Qgd2F2ZVZhbHVlID0gdGhpcy5sYXR0aWNlLmdldEludGVycG9sYXRlZFZhbHVlKCBrLCBpICk7XHJcblxyXG4gICAgICAgIGlmICggd2F2ZVZhbHVlID4gMCApIHtcclxuICAgICAgICAgIGludGVuc2l0eSA9IFV0aWxzLmxpbmVhciggMCwgMiwgQ1VUT0ZGLCAxLCB3YXZlVmFsdWUgKTtcclxuICAgICAgICAgIGludGVuc2l0eSA9IFV0aWxzLmNsYW1wKCBpbnRlbnNpdHksIENVVE9GRiwgMSApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGNvbnN0IE1JTl9TSEFERSA9IDAuMDM7IC8vIFN0b3AgYmVmb3JlIDAgYmVjYXVzZSAwIGlzIHRvbyBqYXJyaW5nXHJcbiAgICAgICAgICBpbnRlbnNpdHkgPSBVdGlscy5saW5lYXIoIC0xLjUsIDAsIE1JTl9TSEFERSwgQ1VUT0ZGLCB3YXZlVmFsdWUgKTtcclxuICAgICAgICAgIGludGVuc2l0eSA9IFV0aWxzLmNsYW1wKCBpbnRlbnNpdHksIE1JTl9TSEFERSwgQ1VUT0ZGICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBOb3RlIHRoaXMgaW50ZXJwb2xhdGlvbiBkb2Vzbid0IGluY2x1ZGUgdGhlIGdhbW1hIGZhY3RvciB0aGF0IENvbG9yLmJsZW5kIGRvZXNcclxuICAgICAgICBsZXQgciA9IHRoaXMuYmFzZUNvbG9yLnJlZCAqIGludGVuc2l0eTtcclxuICAgICAgICBsZXQgZyA9IHRoaXMuYmFzZUNvbG9yLmdyZWVuICogaW50ZW5zaXR5O1xyXG4gICAgICAgIGxldCBiID0gdGhpcy5iYXNlQ29sb3IuYmx1ZSAqIGludGVuc2l0eTtcclxuXHJcbiAgICAgICAgLy8gTm90ZSB0aGlzIGlzIHRyYW5zcG9zZWQgYmVjYXVzZSBvZiB0aGUgb3JkZXJpbmcgb2YgcHV0SW1hZ2VEYXRhXHJcbiAgICAgICAgaWYgKCB0aGlzLnZhY3V1bUNvbG9yICYmICF0aGlzLmxhdHRpY2UuaGFzQ2VsbEJlZW5WaXNpdGVkKCBrLCBpICkgKSB7XHJcbiAgICAgICAgICByID0gdGhpcy52YWN1dW1Db2xvci5yO1xyXG4gICAgICAgICAgZyA9IHRoaXMudmFjdXVtQ29sb3IuZztcclxuICAgICAgICAgIGIgPSB0aGlzLnZhY3V1bUNvbG9yLmI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJbWFnZURhdGEuZGF0YSBpcyBVaW50OENsYW1wZWRBcnJheS4gIFBlcmZvcm1hbmNlIGlzIGNyaXRpY2FsIGFuZCBhbGwgbnVtYmVycyBhcmUgbm9uLW5lZ2F0aXZlLlxyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IDQgKiBtO1xyXG4gICAgICAgIGRhdGFbIG9mZnNldCBdID0gTWF0aC5yb3VuZCggciApOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGJhZC1zaW0tdGV4dFxyXG4gICAgICAgIGRhdGFbIG9mZnNldCArIDEgXSA9IE1hdGgucm91bmQoIGcgKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBiYWQtc2ltLXRleHRcclxuICAgICAgICBkYXRhWyBvZmZzZXQgKyAyIF0gPSBNYXRoLnJvdW5kKCBiICk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgYmFkLXNpbS10ZXh0XHJcbiAgICAgICAgZGF0YVsgb2Zmc2V0ICsgMyBdID0gMjU1OyAvLyBGdWxseSBvcGFxdWVcclxuICAgICAgICBtKys7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuaW1hZ2VEYXRhUmVuZGVyZXIucHV0SW1hZ2VEYXRhKCk7XHJcblxyXG4gICAgLy8gZHJhdyB0aGUgc3ViLWNhbnZhcyB0byB0aGUgcmVuZGVyaW5nIGNvbnRleHQgYXQgdGhlIGFwcHJvcHJpYXRlIHNjYWxlXHJcbiAgICBjb250ZXh0LnNhdmUoKTtcclxuICAgIGNvbnRleHQudHJhbnNmb3JtKCBXYXZlSW50ZXJmZXJlbmNlQ29uc3RhbnRzLkNFTExfV0lEVEgsIDAsIDAsIFdhdmVJbnRlcmZlcmVuY2VDb25zdGFudHMuQ0VMTF9XSURUSCwgMCwgMCApO1xyXG4gICAgY29udGV4dC5kcmF3SW1hZ2UoIHRoaXMuaW1hZ2VEYXRhUmVuZGVyZXIuY2FudmFzLCAwLCAwICk7XHJcbiAgICBjb250ZXh0LnJlc3RvcmUoKTtcclxuICB9XHJcbn1cclxuXHJcbndhdmVJbnRlcmZlcmVuY2UucmVnaXN0ZXIoICdMYXR0aWNlQ2FudmFzTm9kZScsIExhdHRpY2VDYW52YXNOb2RlICk7XHJcbmV4cG9ydCBkZWZhdWx0IExhdHRpY2VDYW52YXNOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsS0FBSyxN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