// Copyright 2018-2022, University of Colorado Boulder
// @ts-nocheck
/**
 * When selected, shows discrete and moving particles for the sound view.
 * Note: Clipping is not enabled on mobileSafari, see https://github.com/phetsims/wave-interference/issues/322
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import merge from '../../../../phet-core/js/merge.js';
import { Image, Node } from '../../../../scenery/js/imports.js';
import waveInterference from '../../waveInterference.js';
import WaveInterferenceConstants from '../WaveInterferenceConstants.js';
import SoundParticleNode from './SoundParticleNode.js';
class SoundParticleImageLayer extends Node {
  constructor(model, waveAreaNodeBounds, options) {
    options = merge({
      layerSplit: true,
      // ensure we're on our own layer
      renderer: 'webgl'
    }, options);
    super(options);

    // @private
    this.model = model;
    SoundParticleNode.createForCanvas(WaveInterferenceConstants.SOUND_PARTICLE_GRAY_COLOR, canvas => {
      // @private {HTMLCanvasElement} - assigned synchronously and is guaranteed to exist after createSphereImage
      this.whiteSphereImage = canvas;
    });
    SoundParticleNode.createForCanvas(WaveInterferenceConstants.SOUND_PARTICLE_RED_COLOR, canvas => {
      // @private {HTMLCanvasElement} - assigned synchronously and is guaranteed to exist after createSphereImage
      this.redSphereImage = canvas;
    });
    const images = [];

    // At the end of each model step, update all of the particles as a batch.
    const update = () => {
      if (model.sceneProperty.value === model.soundScene) {
        for (let i = 0; i < images.length; i++) {
          images[i].update();
        }
      }
    };
    model.stepEmitter.addListener(update);
    model.sceneProperty.link(update);
    for (let i = 0; i < this.model.soundScene.soundParticles.length; i++) {
      const soundParticle = this.model.soundScene.soundParticles[i];

      // Red particles are shown on a grid
      const isRed = soundParticle.i % 4 === 2 && soundParticle.j % 4 === 2;
      const sphereImage = isRed ? this.redSphereImage : this.whiteSphereImage;
      const soundParticleImage = new SoundParticleImage(soundParticle, sphereImage, this.model.soundScene.modelViewTransform);
      images.push(soundParticleImage);
      this.addChild(soundParticleImage);
    }
    update();
  }
}
class SoundParticleImage extends Image {
  constructor(soundParticle, image, modelViewTransform) {
    super(image, {
      scale: 0.5
    });
    this.soundParticle = soundParticle;
    this.image = image;
    this.modelViewTransform = modelViewTransform;
  }
  update() {
    const x = this.modelViewTransform.modelToViewX(this.soundParticle.x) - this.width / 2;
    const y = this.modelViewTransform.modelToViewY(this.soundParticle.y) - this.height / 2;
    this.setTranslation(x, y);
  }
}
waveInterference.register('SoundParticleImageLayer', SoundParticleImageLayer);
export default SoundParticleImageLayer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtZXJnZSIsIkltYWdlIiwiTm9kZSIsIndhdmVJbnRlcmZlcmVuY2UiLCJXYXZlSW50ZXJmZXJlbmNlQ29uc3RhbnRzIiwiU291bmRQYXJ0aWNsZU5vZGUiLCJTb3VuZFBhcnRpY2xlSW1hZ2VMYXllciIsImNvbnN0cnVjdG9yIiwibW9kZWwiLCJ3YXZlQXJlYU5vZGVCb3VuZHMiLCJvcHRpb25zIiwibGF5ZXJTcGxpdCIsInJlbmRlcmVyIiwiY3JlYXRlRm9yQ2FudmFzIiwiU09VTkRfUEFSVElDTEVfR1JBWV9DT0xPUiIsImNhbnZhcyIsIndoaXRlU3BoZXJlSW1hZ2UiLCJTT1VORF9QQVJUSUNMRV9SRURfQ09MT1IiLCJyZWRTcGhlcmVJbWFnZSIsImltYWdlcyIsInVwZGF0ZSIsInNjZW5lUHJvcGVydHkiLCJ2YWx1ZSIsInNvdW5kU2NlbmUiLCJpIiwibGVuZ3RoIiwic3RlcEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImxpbmsiLCJzb3VuZFBhcnRpY2xlcyIsInNvdW5kUGFydGljbGUiLCJpc1JlZCIsImoiLCJzcGhlcmVJbWFnZSIsInNvdW5kUGFydGljbGVJbWFnZSIsIlNvdW5kUGFydGljbGVJbWFnZSIsIm1vZGVsVmlld1RyYW5zZm9ybSIsInB1c2giLCJhZGRDaGlsZCIsImltYWdlIiwic2NhbGUiLCJ4IiwibW9kZWxUb1ZpZXdYIiwid2lkdGgiLCJ5IiwibW9kZWxUb1ZpZXdZIiwiaGVpZ2h0Iiwic2V0VHJhbnNsYXRpb24iLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlNvdW5kUGFydGljbGVJbWFnZUxheWVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE4LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG4vLyBAdHMtbm9jaGVja1xyXG4vKipcclxuICogV2hlbiBzZWxlY3RlZCwgc2hvd3MgZGlzY3JldGUgYW5kIG1vdmluZyBwYXJ0aWNsZXMgZm9yIHRoZSBzb3VuZCB2aWV3LlxyXG4gKiBOb3RlOiBDbGlwcGluZyBpcyBub3QgZW5hYmxlZCBvbiBtb2JpbGVTYWZhcmksIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvd2F2ZS1pbnRlcmZlcmVuY2UvaXNzdWVzLzMyMlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgeyBJbWFnZSwgTm9kZSwgTm9kZU9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgeyBCb3VuZHMyIH0gZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgd2F2ZUludGVyZmVyZW5jZSBmcm9tICcuLi8uLi93YXZlSW50ZXJmZXJlbmNlLmpzJztcclxuaW1wb3J0IFdhdmVJbnRlcmZlcmVuY2VDb25zdGFudHMgZnJvbSAnLi4vV2F2ZUludGVyZmVyZW5jZUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBTb3VuZFBhcnRpY2xlTm9kZSBmcm9tICcuL1NvdW5kUGFydGljbGVOb2RlLmpzJztcclxuaW1wb3J0IFdhdmVzTW9kZWwgZnJvbSAnLi4vLi4vd2F2ZXMvbW9kZWwvV2F2ZXNNb2RlbC5qcyc7XHJcblxyXG5jbGFzcyBTb3VuZFBhcnRpY2xlSW1hZ2VMYXllciBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG1vZGVsOiBXYXZlc01vZGVsLCB3YXZlQXJlYU5vZGVCb3VuZHM6IEJvdW5kczIsIG9wdGlvbnM/OiBOb2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuXHJcbiAgICAgIGxheWVyU3BsaXQ6IHRydWUsIC8vIGVuc3VyZSB3ZSdyZSBvbiBvdXIgb3duIGxheWVyXHJcbiAgICAgIHJlbmRlcmVyOiAnd2ViZ2wnXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZVxyXG4gICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xyXG5cclxuICAgIFNvdW5kUGFydGljbGVOb2RlLmNyZWF0ZUZvckNhbnZhcyggV2F2ZUludGVyZmVyZW5jZUNvbnN0YW50cy5TT1VORF9QQVJUSUNMRV9HUkFZX0NPTE9SLCBjYW52YXMgPT4ge1xyXG5cclxuICAgICAgLy8gQHByaXZhdGUge0hUTUxDYW52YXNFbGVtZW50fSAtIGFzc2lnbmVkIHN5bmNocm9ub3VzbHkgYW5kIGlzIGd1YXJhbnRlZWQgdG8gZXhpc3QgYWZ0ZXIgY3JlYXRlU3BoZXJlSW1hZ2VcclxuICAgICAgdGhpcy53aGl0ZVNwaGVyZUltYWdlID0gY2FudmFzO1xyXG4gICAgfSApO1xyXG5cclxuICAgIFNvdW5kUGFydGljbGVOb2RlLmNyZWF0ZUZvckNhbnZhcyggV2F2ZUludGVyZmVyZW5jZUNvbnN0YW50cy5TT1VORF9QQVJUSUNMRV9SRURfQ09MT1IsIGNhbnZhcyA9PiB7XHJcblxyXG4gICAgICAvLyBAcHJpdmF0ZSB7SFRNTENhbnZhc0VsZW1lbnR9IC0gYXNzaWduZWQgc3luY2hyb25vdXNseSBhbmQgaXMgZ3VhcmFudGVlZCB0byBleGlzdCBhZnRlciBjcmVhdGVTcGhlcmVJbWFnZVxyXG4gICAgICB0aGlzLnJlZFNwaGVyZUltYWdlID0gY2FudmFzO1xyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGltYWdlcyA9IFtdO1xyXG5cclxuICAgIC8vIEF0IHRoZSBlbmQgb2YgZWFjaCBtb2RlbCBzdGVwLCB1cGRhdGUgYWxsIG9mIHRoZSBwYXJ0aWNsZXMgYXMgYSBiYXRjaC5cclxuICAgIGNvbnN0IHVwZGF0ZSA9ICgpID0+IHtcclxuICAgICAgaWYgKCBtb2RlbC5zY2VuZVByb3BlcnR5LnZhbHVlID09PSBtb2RlbC5zb3VuZFNjZW5lICkge1xyXG4gICAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGltYWdlcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICAgIGltYWdlc1sgaSBdLnVwZGF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIG1vZGVsLnN0ZXBFbWl0dGVyLmFkZExpc3RlbmVyKCB1cGRhdGUgKTtcclxuICAgIG1vZGVsLnNjZW5lUHJvcGVydHkubGluayggdXBkYXRlICk7XHJcblxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5tb2RlbC5zb3VuZFNjZW5lLnNvdW5kUGFydGljbGVzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBjb25zdCBzb3VuZFBhcnRpY2xlID0gdGhpcy5tb2RlbC5zb3VuZFNjZW5lLnNvdW5kUGFydGljbGVzWyBpIF07XHJcblxyXG4gICAgICAvLyBSZWQgcGFydGljbGVzIGFyZSBzaG93biBvbiBhIGdyaWRcclxuICAgICAgY29uc3QgaXNSZWQgPSAoIHNvdW5kUGFydGljbGUuaSAlIDQgPT09IDIgJiYgc291bmRQYXJ0aWNsZS5qICUgNCA9PT0gMiApO1xyXG4gICAgICBjb25zdCBzcGhlcmVJbWFnZSA9IGlzUmVkID8gdGhpcy5yZWRTcGhlcmVJbWFnZSA6IHRoaXMud2hpdGVTcGhlcmVJbWFnZTtcclxuXHJcbiAgICAgIGNvbnN0IHNvdW5kUGFydGljbGVJbWFnZSA9IG5ldyBTb3VuZFBhcnRpY2xlSW1hZ2UoIHNvdW5kUGFydGljbGUsIHNwaGVyZUltYWdlLCB0aGlzLm1vZGVsLnNvdW5kU2NlbmUubW9kZWxWaWV3VHJhbnNmb3JtICk7XHJcbiAgICAgIGltYWdlcy5wdXNoKCBzb3VuZFBhcnRpY2xlSW1hZ2UgKTtcclxuICAgICAgdGhpcy5hZGRDaGlsZCggc291bmRQYXJ0aWNsZUltYWdlICk7XHJcbiAgICB9XHJcbiAgICB1cGRhdGUoKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIFNvdW5kUGFydGljbGVJbWFnZSBleHRlbmRzIEltYWdlIHtcclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHNvdW5kUGFydGljbGUsIGltYWdlLCBtb2RlbFZpZXdUcmFuc2Zvcm0gKSB7XHJcbiAgICBzdXBlciggaW1hZ2UsIHsgc2NhbGU6IDAuNSB9ICk7XHJcbiAgICB0aGlzLnNvdW5kUGFydGljbGUgPSBzb3VuZFBhcnRpY2xlO1xyXG4gICAgdGhpcy5pbWFnZSA9IGltYWdlO1xyXG4gICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0gPSBtb2RlbFZpZXdUcmFuc2Zvcm07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdXBkYXRlKCk6IHZvaWQge1xyXG4gICAgY29uc3QgeCA9ICggdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKCB0aGlzLnNvdW5kUGFydGljbGUueCApICkgLSB0aGlzLndpZHRoIC8gMjtcclxuICAgIGNvbnN0IHkgPSAoIHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggdGhpcy5zb3VuZFBhcnRpY2xlLnkgKSApIC0gdGhpcy5oZWlnaHQgLyAyO1xyXG4gICAgdGhpcy5zZXRUcmFuc2xhdGlvbiggeCwgeSApO1xyXG4gIH1cclxufVxyXG5cclxud2F2ZUludGVyZmVyZW5jZS5yZWdpc3RlciggJ1NvdW5kUGFydGljbGVJbWFnZUxheWVyJywgU291bmRQYXJ0aWNsZUltYWdlTGF5ZXIgKTtcclxuZXhwb3J0IGRlZmF1bHQgU291bmRQYXJ0aWNsZUltYWdlTGF5ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsU0FBU0MsS0FBSyxFQUFFQyxJQUFJLFFBQXFCLG1DQUFtQztBQUU1RSxPQUFPQyxnQkFBZ0IsTUFBTSwyQkFBMkI7QUFDeEQsT0FBT0MseUJBQXlCLE1BQU0saUNBQWlDO0FBQ3ZFLE9BQU9DLGlCQUFpQixNQUFNLHdCQUF3QjtBQUd0RCxNQUFNQyx1QkFBdUIsU0FBU0osSUFBSSxDQUFDO0VBRWxDSyxX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