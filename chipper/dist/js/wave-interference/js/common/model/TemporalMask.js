// Copyright 2019-2022, University of Colorado Boulder

/**
 * Records on and off times of a single source, so that we can determine whether it could have contributed to the value
 * on the lattice at a later time.  This is used to prevent artifacts when the wave is turned off, and to restore
 * the lattice to black (for light), see https://github.com/phetsims/wave-interference/issues/258
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import waveInterference from '../../waveInterference.js';
import WaveInterferenceConstants from '../WaveInterferenceConstants.js';
import Lattice from '../../../../scenery-phet/js/Lattice.js';
class TemporalMask {
  // record of changes in wave disturbance sources.
  deltas = [];

  /**
   * Set the current state of the model.  If this differs from the prior state type (in position or whether it is on)
   * a delta is generated.
   * @param isSourceOn - true if the source is on, false if the source is off
   * @param numberOfSteps - integer number of times the wave has been stepped on the lattice
   * @param verticalLatticeCoordinate - vertical lattice coordinate
   */
  set(isSourceOn, numberOfSteps, verticalLatticeCoordinate) {
    const lastDelta = this.deltas.length > 0 ? this.deltas[this.deltas.length - 1] : null;
    if (this.deltas.length === 0 || lastDelta.isSourceOn !== isSourceOn || lastDelta.verticalLatticeCoordinate !== verticalLatticeCoordinate) {
      // record a delta
      this.deltas.push({
        isSourceOn: isSourceOn,
        numberOfSteps: numberOfSteps,
        verticalLatticeCoordinate: verticalLatticeCoordinate
      });
    }
  }

  /**
   * Determines if the wave source was turned on at a time that contributed to the cell value
   * @param horizontalLatticeCoordinate - horizontal coordinate on the lattice (i)
   * @param verticalLatticeCoordinate - vertical coordinate on the lattice (j)
   * @param numberOfSteps - integer number of times the wave has been stepped on the lattice
   */
  matches(horizontalLatticeCoordinate, verticalLatticeCoordinate, numberOfSteps) {
    // search to see if the source contributed to the value at the specified coordinate at the current numberOfSteps
    for (let k = 0; k < this.deltas.length; k++) {
      const delta = this.deltas[k];
      if (delta.isSourceOn) {
        const horizontalDelta = WaveInterferenceConstants.POINT_SOURCE_HORIZONTAL_COORDINATE - horizontalLatticeCoordinate;
        const verticalDelta = delta.verticalLatticeCoordinate - verticalLatticeCoordinate;
        const distance = Math.sqrt(horizontalDelta * horizontalDelta + verticalDelta * verticalDelta);

        // Find out when this delta is in effect
        const startTime = delta.numberOfSteps;
        const endTime = this.deltas[k + 1] ? this.deltas[k + 1].numberOfSteps : numberOfSteps;
        const theoreticalTime = numberOfSteps - distance / Lattice.WAVE_SPEED;

        // if theoreticalDistance matches any time in this range, the cell's value was caused by the oscillators, and
        // not by a reflection or numerical artifact.  The tolerance is necessary because the actual group velocity
        // of the tip exceeds the theoretical speed, and the group velocity at the tail is lower than the theoretical
        // speed.  If the tolerance is too tight, this appears as an unnatural "clipping" of the wave area graph.
        const headTolerance = 2;
        const tailTolerance = 4;
        if (theoreticalTime >= startTime - headTolerance && theoreticalTime <= endTime + tailTolerance) {
          // Return as early as possible to improve performance
          return true;
        }
      }
    }
    return false;
  }

  /**
   * Remove delta values that are so old they can no longer impact the model, to avoid memory leaks and too much CPU
   * @param maxDistance - the furthest a point can be from a source
   * @param numberOfSteps - integer number of times the wave has been stepped on the lattice
   */
  prune(maxDistance, numberOfSteps) {
    // Save enough deltas so that even if the user toggles the source on and off rapidly, the effect will be further
    // from the source.  But don't save so many deltas that performance is degraded.
    // See https://github.com/phetsims/wave-interference/issues/319
    while (this.deltas.length > 10) {
      this.deltas.shift(); // remove oldest deltas first
    }
  }

  /**
   * Clear the state.
   */
  clear() {
    this.deltas.length = 0;
  }
}
waveInterference.register('TemporalMask', TemporalMask);
export default TemporalMask;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ3YXZlSW50ZXJmZXJlbmNlIiwiV2F2ZUludGVyZmVyZW5jZUNvbnN0YW50cyIsIkxhdHRpY2UiLCJUZW1wb3JhbE1hc2siLCJkZWx0YXMiLCJzZXQiLCJpc1NvdXJjZU9uIiwibnVtYmVyT2ZTdGVwcyIsInZlcnRpY2FsTGF0dGljZUNvb3JkaW5hdGUiLCJsYXN0RGVsdGEiLCJsZW5ndGgiLCJwdXNoIiwibWF0Y2hlcyIsImhvcml6b250YWxMYXR0aWNlQ29vcmRpbmF0ZSIsImsiLCJkZWx0YSIsImhvcml6b250YWxEZWx0YSIsIlBPSU5UX1NPVVJDRV9IT1JJWk9OVEFMX0NPT1JESU5BVEUiLCJ2ZXJ0aWNhbERlbHRhIiwiZGlzdGFuY2UiLCJNYXRoIiwic3FydCIsInN0YXJ0VGltZSIsImVuZFRpbWUiLCJ0aGVvcmV0aWNhbFRpbWUiLCJXQVZFX1NQRUVEIiwiaGVhZFRvbGVyYW5jZSIsInRhaWxUb2xlcmFuY2UiLCJwcnVuZSIsIm1heERpc3RhbmNlIiwic2hpZnQiLCJjbGVhciIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiVGVtcG9yYWxNYXNrLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFJlY29yZHMgb24gYW5kIG9mZiB0aW1lcyBvZiBhIHNpbmdsZSBzb3VyY2UsIHNvIHRoYXQgd2UgY2FuIGRldGVybWluZSB3aGV0aGVyIGl0IGNvdWxkIGhhdmUgY29udHJpYnV0ZWQgdG8gdGhlIHZhbHVlXHJcbiAqIG9uIHRoZSBsYXR0aWNlIGF0IGEgbGF0ZXIgdGltZS4gIFRoaXMgaXMgdXNlZCB0byBwcmV2ZW50IGFydGlmYWN0cyB3aGVuIHRoZSB3YXZlIGlzIHR1cm5lZCBvZmYsIGFuZCB0byByZXN0b3JlXHJcbiAqIHRoZSBsYXR0aWNlIHRvIGJsYWNrIChmb3IgbGlnaHQpLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3dhdmUtaW50ZXJmZXJlbmNlL2lzc3Vlcy8yNThcclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgd2F2ZUludGVyZmVyZW5jZSBmcm9tICcuLi8uLi93YXZlSW50ZXJmZXJlbmNlLmpzJztcclxuaW1wb3J0IFdhdmVJbnRlcmZlcmVuY2VDb25zdGFudHMgZnJvbSAnLi4vV2F2ZUludGVyZmVyZW5jZUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBMYXR0aWNlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9MYXR0aWNlLmpzJztcclxuXHJcbmNsYXNzIFRlbXBvcmFsTWFzayB7XHJcblxyXG4gIC8vIHJlY29yZCBvZiBjaGFuZ2VzIGluIHdhdmUgZGlzdHVyYmFuY2Ugc291cmNlcy5cclxuICBwcml2YXRlIGRlbHRhczogKCB7IGlzU291cmNlT246IGJvb2xlYW47IG51bWJlck9mU3RlcHM6IG51bWJlcjsgdmVydGljYWxMYXR0aWNlQ29vcmRpbmF0ZTogbnVtYmVyIH0gKVtdID0gW107XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgbW9kZWwuICBJZiB0aGlzIGRpZmZlcnMgZnJvbSB0aGUgcHJpb3Igc3RhdGUgdHlwZSAoaW4gcG9zaXRpb24gb3Igd2hldGhlciBpdCBpcyBvbilcclxuICAgKiBhIGRlbHRhIGlzIGdlbmVyYXRlZC5cclxuICAgKiBAcGFyYW0gaXNTb3VyY2VPbiAtIHRydWUgaWYgdGhlIHNvdXJjZSBpcyBvbiwgZmFsc2UgaWYgdGhlIHNvdXJjZSBpcyBvZmZcclxuICAgKiBAcGFyYW0gbnVtYmVyT2ZTdGVwcyAtIGludGVnZXIgbnVtYmVyIG9mIHRpbWVzIHRoZSB3YXZlIGhhcyBiZWVuIHN0ZXBwZWQgb24gdGhlIGxhdHRpY2VcclxuICAgKiBAcGFyYW0gdmVydGljYWxMYXR0aWNlQ29vcmRpbmF0ZSAtIHZlcnRpY2FsIGxhdHRpY2UgY29vcmRpbmF0ZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXQoIGlzU291cmNlT246IGJvb2xlYW4sIG51bWJlck9mU3RlcHM6IG51bWJlciwgdmVydGljYWxMYXR0aWNlQ29vcmRpbmF0ZTogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgY29uc3QgbGFzdERlbHRhID0gdGhpcy5kZWx0YXMubGVuZ3RoID4gMCA/IHRoaXMuZGVsdGFzWyB0aGlzLmRlbHRhcy5sZW5ndGggLSAxIF0gOiBudWxsO1xyXG4gICAgaWYgKCB0aGlzLmRlbHRhcy5sZW5ndGggPT09IDAgfHwgbGFzdERlbHRhIS5pc1NvdXJjZU9uICE9PSBpc1NvdXJjZU9uIHx8IGxhc3REZWx0YSEudmVydGljYWxMYXR0aWNlQ29vcmRpbmF0ZSAhPT0gdmVydGljYWxMYXR0aWNlQ29vcmRpbmF0ZSApIHtcclxuXHJcbiAgICAgIC8vIHJlY29yZCBhIGRlbHRhXHJcbiAgICAgIHRoaXMuZGVsdGFzLnB1c2goIHtcclxuICAgICAgICBpc1NvdXJjZU9uOiBpc1NvdXJjZU9uLFxyXG4gICAgICAgIG51bWJlck9mU3RlcHM6IG51bWJlck9mU3RlcHMsXHJcbiAgICAgICAgdmVydGljYWxMYXR0aWNlQ29vcmRpbmF0ZTogdmVydGljYWxMYXR0aWNlQ29vcmRpbmF0ZVxyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZXRlcm1pbmVzIGlmIHRoZSB3YXZlIHNvdXJjZSB3YXMgdHVybmVkIG9uIGF0IGEgdGltZSB0aGF0IGNvbnRyaWJ1dGVkIHRvIHRoZSBjZWxsIHZhbHVlXHJcbiAgICogQHBhcmFtIGhvcml6b250YWxMYXR0aWNlQ29vcmRpbmF0ZSAtIGhvcml6b250YWwgY29vcmRpbmF0ZSBvbiB0aGUgbGF0dGljZSAoaSlcclxuICAgKiBAcGFyYW0gdmVydGljYWxMYXR0aWNlQ29vcmRpbmF0ZSAtIHZlcnRpY2FsIGNvb3JkaW5hdGUgb24gdGhlIGxhdHRpY2UgKGopXHJcbiAgICogQHBhcmFtIG51bWJlck9mU3RlcHMgLSBpbnRlZ2VyIG51bWJlciBvZiB0aW1lcyB0aGUgd2F2ZSBoYXMgYmVlbiBzdGVwcGVkIG9uIHRoZSBsYXR0aWNlXHJcbiAgICovXHJcbiAgcHVibGljIG1hdGNoZXMoIGhvcml6b250YWxMYXR0aWNlQ29vcmRpbmF0ZTogbnVtYmVyLCB2ZXJ0aWNhbExhdHRpY2VDb29yZGluYXRlOiBudW1iZXIsIG51bWJlck9mU3RlcHM6IG51bWJlciApOiBib29sZWFuIHtcclxuXHJcbiAgICAvLyBzZWFyY2ggdG8gc2VlIGlmIHRoZSBzb3VyY2UgY29udHJpYnV0ZWQgdG8gdGhlIHZhbHVlIGF0IHRoZSBzcGVjaWZpZWQgY29vcmRpbmF0ZSBhdCB0aGUgY3VycmVudCBudW1iZXJPZlN0ZXBzXHJcbiAgICBmb3IgKCBsZXQgayA9IDA7IGsgPCB0aGlzLmRlbHRhcy5sZW5ndGg7IGsrKyApIHtcclxuICAgICAgY29uc3QgZGVsdGEgPSB0aGlzLmRlbHRhc1sgayBdO1xyXG4gICAgICBpZiAoIGRlbHRhLmlzU291cmNlT24gKSB7XHJcblxyXG4gICAgICAgIGNvbnN0IGhvcml6b250YWxEZWx0YSA9IFdhdmVJbnRlcmZlcmVuY2VDb25zdGFudHMuUE9JTlRfU09VUkNFX0hPUklaT05UQUxfQ09PUkRJTkFURSAtIGhvcml6b250YWxMYXR0aWNlQ29vcmRpbmF0ZTtcclxuICAgICAgICBjb25zdCB2ZXJ0aWNhbERlbHRhID0gZGVsdGEudmVydGljYWxMYXR0aWNlQ29vcmRpbmF0ZSAtIHZlcnRpY2FsTGF0dGljZUNvb3JkaW5hdGU7XHJcbiAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBNYXRoLnNxcnQoIGhvcml6b250YWxEZWx0YSAqIGhvcml6b250YWxEZWx0YSArIHZlcnRpY2FsRGVsdGEgKiB2ZXJ0aWNhbERlbHRhICk7XHJcblxyXG4gICAgICAgIC8vIEZpbmQgb3V0IHdoZW4gdGhpcyBkZWx0YSBpcyBpbiBlZmZlY3RcclxuICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBkZWx0YS5udW1iZXJPZlN0ZXBzO1xyXG4gICAgICAgIGNvbnN0IGVuZFRpbWUgPSB0aGlzLmRlbHRhc1sgayArIDEgXSA/IHRoaXMuZGVsdGFzWyBrICsgMSBdLm51bWJlck9mU3RlcHMgOiBudW1iZXJPZlN0ZXBzO1xyXG5cclxuICAgICAgICBjb25zdCB0aGVvcmV0aWNhbFRpbWUgPSBudW1iZXJPZlN0ZXBzIC0gZGlzdGFuY2UgLyBMYXR0aWNlLldBVkVfU1BFRUQ7XHJcblxyXG4gICAgICAgIC8vIGlmIHRoZW9yZXRpY2FsRGlzdGFuY2UgbWF0Y2hlcyBhbnkgdGltZSBpbiB0aGlzIHJhbmdlLCB0aGUgY2VsbCdzIHZhbHVlIHdhcyBjYXVzZWQgYnkgdGhlIG9zY2lsbGF0b3JzLCBhbmRcclxuICAgICAgICAvLyBub3QgYnkgYSByZWZsZWN0aW9uIG9yIG51bWVyaWNhbCBhcnRpZmFjdC4gIFRoZSB0b2xlcmFuY2UgaXMgbmVjZXNzYXJ5IGJlY2F1c2UgdGhlIGFjdHVhbCBncm91cCB2ZWxvY2l0eVxyXG4gICAgICAgIC8vIG9mIHRoZSB0aXAgZXhjZWVkcyB0aGUgdGhlb3JldGljYWwgc3BlZWQsIGFuZCB0aGUgZ3JvdXAgdmVsb2NpdHkgYXQgdGhlIHRhaWwgaXMgbG93ZXIgdGhhbiB0aGUgdGhlb3JldGljYWxcclxuICAgICAgICAvLyBzcGVlZC4gIElmIHRoZSB0b2xlcmFuY2UgaXMgdG9vIHRpZ2h0LCB0aGlzIGFwcGVhcnMgYXMgYW4gdW5uYXR1cmFsIFwiY2xpcHBpbmdcIiBvZiB0aGUgd2F2ZSBhcmVhIGdyYXBoLlxyXG4gICAgICAgIGNvbnN0IGhlYWRUb2xlcmFuY2UgPSAyO1xyXG4gICAgICAgIGNvbnN0IHRhaWxUb2xlcmFuY2UgPSA0O1xyXG4gICAgICAgIGlmICggdGhlb3JldGljYWxUaW1lID49IHN0YXJ0VGltZSAtIGhlYWRUb2xlcmFuY2UgJiYgdGhlb3JldGljYWxUaW1lIDw9IGVuZFRpbWUgKyB0YWlsVG9sZXJhbmNlICkge1xyXG5cclxuICAgICAgICAgIC8vIFJldHVybiBhcyBlYXJseSBhcyBwb3NzaWJsZSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlXHJcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmUgZGVsdGEgdmFsdWVzIHRoYXQgYXJlIHNvIG9sZCB0aGV5IGNhbiBubyBsb25nZXIgaW1wYWN0IHRoZSBtb2RlbCwgdG8gYXZvaWQgbWVtb3J5IGxlYWtzIGFuZCB0b28gbXVjaCBDUFVcclxuICAgKiBAcGFyYW0gbWF4RGlzdGFuY2UgLSB0aGUgZnVydGhlc3QgYSBwb2ludCBjYW4gYmUgZnJvbSBhIHNvdXJjZVxyXG4gICAqIEBwYXJhbSBudW1iZXJPZlN0ZXBzIC0gaW50ZWdlciBudW1iZXIgb2YgdGltZXMgdGhlIHdhdmUgaGFzIGJlZW4gc3RlcHBlZCBvbiB0aGUgbGF0dGljZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBwcnVuZSggbWF4RGlzdGFuY2U6IG51bWJlciwgbnVtYmVyT2ZTdGVwczogbnVtYmVyICk6IHZvaWQge1xyXG5cclxuICAgIC8vIFNhdmUgZW5vdWdoIGRlbHRhcyBzbyB0aGF0IGV2ZW4gaWYgdGhlIHVzZXIgdG9nZ2xlcyB0aGUgc291cmNlIG9uIGFuZCBvZmYgcmFwaWRseSwgdGhlIGVmZmVjdCB3aWxsIGJlIGZ1cnRoZXJcclxuICAgIC8vIGZyb20gdGhlIHNvdXJjZS4gIEJ1dCBkb24ndCBzYXZlIHNvIG1hbnkgZGVsdGFzIHRoYXQgcGVyZm9ybWFuY2UgaXMgZGVncmFkZWQuXHJcbiAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3dhdmUtaW50ZXJmZXJlbmNlL2lzc3Vlcy8zMTlcclxuICAgIHdoaWxlICggdGhpcy5kZWx0YXMubGVuZ3RoID4gMTAgKSB7XHJcbiAgICAgIHRoaXMuZGVsdGFzLnNoaWZ0KCk7IC8vIHJlbW92ZSBvbGRlc3QgZGVsdGFzIGZpcnN0XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDbGVhciB0aGUgc3RhdGUuXHJcbiAgICovXHJcbiAgcHVibGljIGNsZWFyKCk6IHZvaWQge1xyXG4gICAgdGhpcy5kZWx0YXMubGVuZ3RoID0gMDtcclxuICB9XHJcbn1cclxuXHJcbndhdmVJbnRlcmZlcmVuY2UucmVnaXN0ZXIoICdUZW1wb3JhbE1hc2snLCBUZW1wb3JhbE1hc2sgKTtcclxuZXhwb3J0IGRlZmF1bHQgVGVtcG9yYWxNYXNrOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBQ3hELE9BQU9DLHlCQUF5QixNQUFNLGlDQUFpQztBQUN2RSxPQUFPQyxPQUFPLE1BQU0sd0NBQXdDO0FBRTVELE1BQU1DLFlBQVksQ0FBQztFQUVqQjtFQUNRQyxNQUFNLEdBQTRGLEVBQUU7O0VBRTVHO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ1NDLEdBQUdBLENBQUVDLFVBQW1CLEVBQUVDLGFBQXFCLEVBQUVDLHlCQUFpQyxFQUFTO0lBQ2hHLE1BQU1DLFNBQVMsR0FBRyxJQUFJLENBQUNMLE1BQU0sQ0FBQ00sTUFBTSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUNOLE1BQU0sQ0FBRSxJQUFJLENBQUNBLE1BQU0sQ0FBQ00sTUFBTSxHQUFHLENBQUMsQ0FBRSxHQUFHLElBQUk7SUFDdkYsSUFBSyxJQUFJLENBQUNOLE1BQU0sQ0FBQ00sTUFBTSxLQUFLLENBQUMsSUFBSUQsU0FBUyxDQUFFSCxVQUFVLEtBQUtBLFVBQVUsSUFBSUcsU0FBUyxDQUFFRCx5QkFBeUIsS0FBS0EseUJBQXlCLEVBQUc7TUFFNUk7TUFDQSxJQUFJLENBQUNKLE1BQU0sQ0FBQ08sSUFBSSxDQUFFO1FBQ2hCTCxVQUFVLEVBQUVBLFVBQVU7UUFDdEJDLGFBQWEsRUFBRUEsYUFBYTtRQUM1QkMseUJBQXlCLEVBQUVBO01BQzdCLENBQUUsQ0FBQztJQUNMO0VBQ0Y7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ1NJLE9BQU9BLENBQUVDLDJCQUFtQyxFQUFFTCx5QkFBaUMsRUFBRUQsYUFBcUIsRUFBWTtJQUV2SDtJQUNBLEtBQU0sSUFBSU8sQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHLElBQUksQ0FBQ1YsTUFBTSxDQUFDTSxNQUFNLEVBQUVJLENBQUMsRUFBRSxFQUFHO01BQzdDLE1BQU1DLEtBQUssR0FBRyxJQUFJLENBQUNYLE1BQU0sQ0FBRVUsQ0FBQyxDQUFFO01BQzlCLElBQUtDLEtBQUssQ0FBQ1QsVUFBVSxFQUFHO1FBRXRCLE1BQU1VLGVBQWUsR0FBR2YseUJBQXlCLENBQUNnQixrQ0FBa0MsR0FBR0osMkJBQTJCO1FBQ2xILE1BQU1LLGFBQWEsR0FBR0gsS0FBSyxDQUFDUCx5QkFBeUIsR0FBR0EseUJBQXlCO1FBQ2pGLE1BQU1XLFFBQVEsR0FBR0MsSUFBSSxDQUFDQyxJQUFJLENBQUVMLGVBQWUsR0FBR0EsZUFBZSxHQUFHRSxhQUFhLEdBQUdBLGFBQWMsQ0FBQzs7UUFFL0Y7UUFDQSxNQUFNSSxTQUFTLEdBQUdQLEtBQUssQ0FBQ1IsYUFBYTtRQUNyQyxNQUFNZ0IsT0FBTyxHQUFHLElBQUksQ0FBQ25CLE1BQU0sQ0FBRVUsQ0FBQyxHQUFHLENBQUMsQ0FBRSxHQUFHLElBQUksQ0FBQ1YsTUFBTSxDQUFFVSxDQUFDLEdBQUcsQ0FBQyxDQUFFLENBQUNQLGFBQWEsR0FBR0EsYUFBYTtRQUV6RixNQUFNaUIsZUFBZSxHQUFHakIsYUFBYSxHQUFHWSxRQUFRLEdBQUdqQixPQUFPLENBQUN1QixVQUFVOztRQUVyRTtRQUNBO1FBQ0E7UUFDQTtRQUNBLE1BQU1DLGFBQWEsR0FBRyxDQUFDO1FBQ3ZCLE1BQU1DLGFBQWEsR0FBRyxDQUFDO1FBQ3ZCLElBQUtILGVBQWUsSUFBSUYsU0FBUyxHQUFHSSxhQUFhLElBQUlGLGVBQWUsSUFBSUQsT0FBTyxHQUFHSSxhQUFhLEVBQUc7VUFFaEc7VUFDQSxPQUFPLElBQUk7UUFDYjtNQUNGO0lBQ0Y7SUFFQSxPQUFPLEtBQUs7RUFDZDs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ1NDLEtBQUtBLENBQUVDLFdBQW1CLEVBQUV0QixhQUFxQixFQUFTO0lBRS9EO0lBQ0E7SUFDQTtJQUNBLE9BQVEsSUFBSSxDQUFDSCxNQUFNLENBQUNNLE1BQU0sR0FBRyxFQUFFLEVBQUc7TUFDaEMsSUFBSSxDQUFDTixNQUFNLENBQUMwQixLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdkI7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7RUFDU0MsS0FBS0EsQ0FBQSxFQUFTO0lBQ25CLElBQUksQ0FBQzNCLE1BQU0sQ0FBQ00sTUFBTSxHQUFHLENBQUM7RUFDeEI7QUFDRjtBQUVBVixnQkFBZ0IsQ0FBQ2dDLFFBQVEsQ0FBRSxjQUFjLEVBQUU3QixZQUFhLENBQUM7QUFDekQsZUFBZUEsWUFBWSJ9