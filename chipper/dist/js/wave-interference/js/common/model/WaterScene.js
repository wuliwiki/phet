// Copyright 2018-2022, University of Colorado Boulder
// @ts-nocheck
/**
 * The model for the Water scene, which adds WaterDrop instances.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Emitter from '../../../../axon/js/Emitter.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import arrayRemove from '../../../../phet-core/js/arrayRemove.js';
import waveInterference from '../../waveInterference.js';
import WaveInterferenceConstants from '../WaveInterferenceConstants.js';
import Scene from './Scene.js';
import WaterDrop from './WaterDrop.js';
class WaterScene extends Scene {
  // the amplitude the user has selected

  /**
   * @param config - see Scene for required properties
   */
  constructor(config) {
    super(config);

    // @public - Emits when a water drop hits the y=0 plane
    this.waterDropAbsorbedEmitter = new Emitter({
      parameters: [{
        valueType: WaterDrop
      }]
    });

    // @public - In the water Scene, the user specifies the desired frequency and amplitude, and that
    // gets propagated to the lattice via the water drops
    this.desiredFrequencyProperty = new NumberProperty(this.frequencyProperty.initialValue, {
      range: this.frequencyProperty.range
    });

    // @public - In the water Scene, the user specifies the desired source separation.  This is the position of
    // the faucets.  The sourceSeparationProperty indicates the sources of oscillation once the water has struck.
    this.desiredSourceSeparationProperty = new NumberProperty(this.sourceSeparationProperty.value, {
      range: config.sourceSeparationRange
    });
    this.desiredAmplitudeProperty = new NumberProperty(config.initialAmplitude, {
      range: this.amplitudeProperty.range
    });

    // @public (read-only) {WaterDrop[]} drops of water that are falling from the hose to the lattice.
    this.waterDrops = [];

    // @private {number|null} - record the time (in seconds) that the previous water drop was emitted, so the next
    // drop (or drops, in the case of two wave generators) can be emitted at the appropriate time.  Null means no
    // drops have fallen.
    this.lastDropTime = null;

    // prep to fire a new drop in the next frame, but only if the other source wasn't already setting the phase
    this.button1PressedProperty.link(pressed => {
      if (pressed && !this.button2PressedProperty.value) {
        this.lastDropTime = null; // prep to fire a new drop in the next frame
      }
    });

    // prep to fire a new drop in the next frame, but only if the other source wasn't already setting the phase
    this.button2PressedProperty.link(pressed => {
      if (pressed && !this.button1PressedProperty.value) {
        this.lastDropTime = null;
      }
    });

    // For the water scene, remove water drops so one mode doesn't create waves in the other mode
    this.disturbanceTypeProperty.link(() => this.removeAllDrops());
  }

  /**
   * Fire another water drop if one is warranted for the specified faucet.  We already determined that the timing
   * is right (for the period), now we need to know if a drop should fire.
   * @param buttonProperty - indicates whether the corresponding button is pressed
   * @param oscillatingProperty - indicates whether the wave source is oscillating
   * @param sign - -1 for top faucet, +1 for bottom faucet
   */
  launchWaterDrop(buttonProperty, oscillatingProperty, sign) {
    const time = this.timeProperty.value;

    // Send a water drop if the button is pressed but not if the button is still pressed from the last pulse.
    // model.button1PressedProperty.value not consulted because we send a shutoff water drop. so that the previous
    // drop gets a full cycle
    const isPulseMode = this.disturbanceTypeProperty.value === Scene.DisturbanceType.PULSE;
    const firePulseDrop = isPulseMode && !this.pulseFiringProperty.value && this.button1PressedProperty.value;
    if (!isPulseMode || firePulseDrop) {
      // capture closure vars for when the water drop is absorbed.
      const buttonPressed = buttonProperty.value;
      const frequency = this.desiredFrequencyProperty.value;
      const amplitude = this.desiredAmplitudeProperty.value;
      const isPulse = this.disturbanceTypeProperty.value === Scene.DisturbanceType.PULSE;

      // Distance between the sources, or 0 if there is only 1 source
      const sourceSeparation = this.numberOfSources === 2 ? this.desiredSourceSeparationProperty.value : 0;
      this.waterDrops.push(new WaterDrop(amplitude, buttonPressed, sourceSeparation, sign, () => {
        if (isPulse && this.pulseFiringProperty.value) {
          return;
        }
        this.amplitudeProperty.set(amplitude);
        this.frequencyProperty.set(frequency);

        // Separate the sources (if there are two of them)
        if (this.numberOfSources === 2) {
          this.sourceSeparationProperty.value = sourceSeparation;
        }
        this.resetPhase();
        if (isPulse) {
          this.startPulse();
        } else {
          oscillatingProperty.value = buttonPressed;
        }
      }));
      this.updateIsAboutToFire();
      this.lastDropTime = time;
    }
  }

  /**
   * Override to clear water drops when muted.
   */
  setMuted(muted) {
    super.setMuted(muted);
    muted && this.removeAllDrops();
    this.continuousWave1OscillatingProperty.value = false;
    this.continuousWave2OscillatingProperty.value = false;
  }

  /**
   * Move forward in time by the specified amount, updating velocity and position of the SoundParticle instances
   * @param dt - amount of time to move forward, in the units of the scene
   */
  step(dt) {
    super.step(dt);
    const time = this.timeProperty.value;

    // Use the lattice frequency (rather than the desired frequency) to determine the time of the next drop
    // so the next drop will not take too long, see https://github.com/phetsims/wave-interference/issues/154
    const period = 1 / this.frequencyProperty.value;
    const timeSinceLastDrop = time - this.lastDropTime;

    // Emit water drops if the phase matches up, but not for the plane waves screen
    if (this.waveSpatialType === Scene.WaveSpatialType.POINT && (this.lastDropTime === null || timeSinceLastDrop > period) && !this.muted) {
      this.launchWaterDrop(this.button1PressedProperty, this.continuousWave1OscillatingProperty, +1);
      this.launchWaterDrop(this.button2PressedProperty, this.continuousWave2OscillatingProperty, -1);
    }
    const toRemove = [];
    for (let i = 0; i < this.waterDrops.length; i++) {
      const waterDrop = this.waterDrops[i];

      // Tuned so that the wave goes underwater when the drop hits
      waterDrop.step(dt);

      // Remove any water drops that went below y=0
      if (waterDrop.y < 0) {
        toRemove.push(waterDrop);
        if (waterDrop.amplitude > 0 && waterDrop.startsOscillation) {
          this.waterDropAbsorbedEmitter.emit(waterDrop);
        }
      }
    }
    for (let i = 0; i < toRemove.length; i++) {
      arrayRemove(this.waterDrops, toRemove[i]);
    }
    this.updateIsAboutToFire();
  }

  /**
   * When any water drop with a nonzero amplitude that is a trigger to start oscillation exists,
   * we mark the isAboutToFireProperty as true.
   */
  updateIsAboutToFire() {
    let isAboutToFire = false;

    // Called every frame, do not allocate closures.
    for (let i = 0; i < this.waterDrops.length; i++) {
      const waterDrop = this.waterDrops[i];
      if (waterDrop.amplitude > 0 && waterDrop.startsOscillation) {
        // Called every frame, break when any match is found for performance
        isAboutToFire = true;
        break;
      }
    }
    this.isAboutToFireProperty.value = isAboutToFire;
  }

  /**
   * Gets the wavelength specified by the user in the control panel.
   * @returns in cm/sec
   */
  getDesiredWavelength() {
    return this.waveSpeed / this.desiredFrequencyProperty.get();
  }
  handleButton1Toggled(isPressed) {
    // Override as a no-op, since water controls the source via WaterDrops hitting the surface
  }
  handleButton2Toggled(isPressed) {
    // Override as a no-op, since water controls the source via WaterDrops hitting the surface
  }

  /**
   * Gets the horizontal coordinate where water drops come out--aligned with the oscillation cell.
   */
  getWaterDropX() {
    // Note this is nudged over 1/2 a cell so it will appear in the center of the cell rather than
    // at the left edge of the cell.  See also WaveInterferenceUtils.getWaterSideShape.
    return this.latticeToViewTransform.modelToViewX(WaveInterferenceConstants.POINT_SOURCE_HORIZONTAL_COORDINATE + 0.5);
  }

  /**
   * Clear all of the water drops.
   */
  removeAllDrops() {
    while (this.waterDrops.length > 0) {
      arrayRemove(this.waterDrops, this.waterDrops[0]);
    }
  }

  /**
   * Reset additional features.
   */
  reset() {
    super.reset();
    this.desiredFrequencyProperty.reset();
    this.desiredSourceSeparationProperty.reset();
    this.desiredAmplitudeProperty.reset();
    while (this.waterDrops.length > 0) {
      arrayRemove(this.waterDrops, this.waterDrops[0]);
    }
  }
}
waveInterference.register('WaterScene', WaterScene);
export default WaterScene;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFbWl0dGVyIiwiTnVtYmVyUHJvcGVydHkiLCJhcnJheVJlbW92ZSIsIndhdmVJbnRlcmZlcmVuY2UiLCJXYXZlSW50ZXJmZXJlbmNlQ29uc3RhbnRzIiwiU2NlbmUiLCJXYXRlckRyb3AiLCJXYXRlclNjZW5lIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJ3YXRlckRyb3BBYnNvcmJlZEVtaXR0ZXIiLCJwYXJhbWV0ZXJzIiwidmFsdWVUeXBlIiwiZGVzaXJlZEZyZXF1ZW5jeVByb3BlcnR5IiwiZnJlcXVlbmN5UHJvcGVydHkiLCJpbml0aWFsVmFsdWUiLCJyYW5nZSIsImRlc2lyZWRTb3VyY2VTZXBhcmF0aW9uUHJvcGVydHkiLCJzb3VyY2VTZXBhcmF0aW9uUHJvcGVydHkiLCJ2YWx1ZSIsInNvdXJjZVNlcGFyYXRpb25SYW5nZSIsImRlc2lyZWRBbXBsaXR1ZGVQcm9wZXJ0eSIsImluaXRpYWxBbXBsaXR1ZGUiLCJhbXBsaXR1ZGVQcm9wZXJ0eSIsIndhdGVyRHJvcHMiLCJsYXN0RHJvcFRpbWUiLCJidXR0b24xUHJlc3NlZFByb3BlcnR5IiwibGluayIsInByZXNzZWQiLCJidXR0b24yUHJlc3NlZFByb3BlcnR5IiwiZGlzdHVyYmFuY2VUeXBlUHJvcGVydHkiLCJyZW1vdmVBbGxEcm9wcyIsImxhdW5jaFdhdGVyRHJvcCIsImJ1dHRvblByb3BlcnR5Iiwib3NjaWxsYXRpbmdQcm9wZXJ0eSIsInNpZ24iLCJ0aW1lIiwidGltZVByb3BlcnR5IiwiaXNQdWxzZU1vZGUiLCJEaXN0dXJiYW5jZVR5cGUiLCJQVUxTRSIsImZpcmVQdWxzZURyb3AiLCJwdWxzZUZpcmluZ1Byb3BlcnR5IiwiYnV0dG9uUHJlc3NlZCIsImZyZXF1ZW5jeSIsImFtcGxpdHVkZSIsImlzUHVsc2UiLCJzb3VyY2VTZXBhcmF0aW9uIiwibnVtYmVyT2ZTb3VyY2VzIiwicHVzaCIsInNldCIsInJlc2V0UGhhc2UiLCJzdGFydFB1bHNlIiwidXBkYXRlSXNBYm91dFRvRmlyZSIsInNldE11dGVkIiwibXV0ZWQiLCJjb250aW51b3VzV2F2ZTFPc2NpbGxhdGluZ1Byb3BlcnR5IiwiY29udGludW91c1dhdmUyT3NjaWxsYXRpbmdQcm9wZXJ0eSIsInN0ZXAiLCJkdCIsInBlcmlvZCIsInRpbWVTaW5jZUxhc3REcm9wIiwid2F2ZVNwYXRpYWxUeXBlIiwiV2F2ZVNwYXRpYWxUeXBlIiwiUE9JTlQiLCJ0b1JlbW92ZSIsImkiLCJsZW5ndGgiLCJ3YXRlckRyb3AiLCJ5Iiwic3RhcnRzT3NjaWxsYXRpb24iLCJlbWl0IiwiaXNBYm91dFRvRmlyZSIsImlzQWJvdXRUb0ZpcmVQcm9wZXJ0eSIsImdldERlc2lyZWRXYXZlbGVuZ3RoIiwid2F2ZVNwZWVkIiwiZ2V0IiwiaGFuZGxlQnV0dG9uMVRvZ2dsZWQiLCJpc1ByZXNzZWQiLCJoYW5kbGVCdXR0b24yVG9nZ2xlZCIsImdldFdhdGVyRHJvcFgiLCJsYXR0aWNlVG9WaWV3VHJhbnNmb3JtIiwibW9kZWxUb1ZpZXdYIiwiUE9JTlRfU09VUkNFX0hPUklaT05UQUxfQ09PUkRJTkFURSIsInJlc2V0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJXYXRlclNjZW5lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE4LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG4vLyBAdHMtbm9jaGVja1xyXG4vKipcclxuICogVGhlIG1vZGVsIGZvciB0aGUgV2F0ZXIgc2NlbmUsIHdoaWNoIGFkZHMgV2F0ZXJEcm9wIGluc3RhbmNlcy5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgRW1pdHRlciBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0VtaXR0ZXIuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBhcnJheVJlbW92ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvYXJyYXlSZW1vdmUuanMnO1xyXG5pbXBvcnQgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCB3YXZlSW50ZXJmZXJlbmNlIGZyb20gJy4uLy4uL3dhdmVJbnRlcmZlcmVuY2UuanMnO1xyXG5pbXBvcnQgV2F2ZUludGVyZmVyZW5jZUNvbnN0YW50cyBmcm9tICcuLi9XYXZlSW50ZXJmZXJlbmNlQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IFNjZW5lLCB7IFNjZW5lT3B0aW9ucyB9IGZyb20gJy4vU2NlbmUuanMnO1xyXG5pbXBvcnQgV2F0ZXJEcm9wIGZyb20gJy4vV2F0ZXJEcm9wLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSBFbXB0eVNlbGZPcHRpb25zO1xyXG50eXBlIFdhdGVyU2NlbmVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTY2VuZU9wdGlvbnM7XHJcblxyXG5jbGFzcyBXYXRlclNjZW5lIGV4dGVuZHMgU2NlbmUge1xyXG5cclxuICAvLyB0aGUgYW1wbGl0dWRlIHRoZSB1c2VyIGhhcyBzZWxlY3RlZFxyXG4gIHB1YmxpYyByZWFkb25seSBkZXNpcmVkQW1wbGl0dWRlUHJvcGVydHk6IE51bWJlclByb3BlcnR5O1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gY29uZmlnIC0gc2VlIFNjZW5lIGZvciByZXF1aXJlZCBwcm9wZXJ0aWVzXHJcbiAgICovXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBjb25maWc6IFdhdGVyU2NlbmVPcHRpb25zICkge1xyXG4gICAgc3VwZXIoIGNvbmZpZyApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMgLSBFbWl0cyB3aGVuIGEgd2F0ZXIgZHJvcCBoaXRzIHRoZSB5PTAgcGxhbmVcclxuICAgIHRoaXMud2F0ZXJEcm9wQWJzb3JiZWRFbWl0dGVyID0gbmV3IEVtaXR0ZXIoIHsgcGFyYW1ldGVyczogWyB7IHZhbHVlVHlwZTogV2F0ZXJEcm9wIH0gXSB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAtIEluIHRoZSB3YXRlciBTY2VuZSwgdGhlIHVzZXIgc3BlY2lmaWVzIHRoZSBkZXNpcmVkIGZyZXF1ZW5jeSBhbmQgYW1wbGl0dWRlLCBhbmQgdGhhdFxyXG4gICAgLy8gZ2V0cyBwcm9wYWdhdGVkIHRvIHRoZSBsYXR0aWNlIHZpYSB0aGUgd2F0ZXIgZHJvcHNcclxuICAgIHRoaXMuZGVzaXJlZEZyZXF1ZW5jeVByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCB0aGlzLmZyZXF1ZW5jeVByb3BlcnR5LmluaXRpYWxWYWx1ZSwge1xyXG4gICAgICByYW5nZTogdGhpcy5mcmVxdWVuY3lQcm9wZXJ0eS5yYW5nZVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMgLSBJbiB0aGUgd2F0ZXIgU2NlbmUsIHRoZSB1c2VyIHNwZWNpZmllcyB0aGUgZGVzaXJlZCBzb3VyY2Ugc2VwYXJhdGlvbi4gIFRoaXMgaXMgdGhlIHBvc2l0aW9uIG9mXHJcbiAgICAvLyB0aGUgZmF1Y2V0cy4gIFRoZSBzb3VyY2VTZXBhcmF0aW9uUHJvcGVydHkgaW5kaWNhdGVzIHRoZSBzb3VyY2VzIG9mIG9zY2lsbGF0aW9uIG9uY2UgdGhlIHdhdGVyIGhhcyBzdHJ1Y2suXHJcbiAgICB0aGlzLmRlc2lyZWRTb3VyY2VTZXBhcmF0aW9uUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIHRoaXMuc291cmNlU2VwYXJhdGlvblByb3BlcnR5LnZhbHVlLCB7XHJcbiAgICAgIHJhbmdlOiBjb25maWcuc291cmNlU2VwYXJhdGlvblJhbmdlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5kZXNpcmVkQW1wbGl0dWRlUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIGNvbmZpZy5pbml0aWFsQW1wbGl0dWRlLCB7XHJcbiAgICAgIHJhbmdlOiB0aGlzLmFtcGxpdHVkZVByb3BlcnR5LnJhbmdlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAocmVhZC1vbmx5KSB7V2F0ZXJEcm9wW119IGRyb3BzIG9mIHdhdGVyIHRoYXQgYXJlIGZhbGxpbmcgZnJvbSB0aGUgaG9zZSB0byB0aGUgbGF0dGljZS5cclxuICAgIHRoaXMud2F0ZXJEcm9wcyA9IFtdO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtudW1iZXJ8bnVsbH0gLSByZWNvcmQgdGhlIHRpbWUgKGluIHNlY29uZHMpIHRoYXQgdGhlIHByZXZpb3VzIHdhdGVyIGRyb3Agd2FzIGVtaXR0ZWQsIHNvIHRoZSBuZXh0XHJcbiAgICAvLyBkcm9wIChvciBkcm9wcywgaW4gdGhlIGNhc2Ugb2YgdHdvIHdhdmUgZ2VuZXJhdG9ycykgY2FuIGJlIGVtaXR0ZWQgYXQgdGhlIGFwcHJvcHJpYXRlIHRpbWUuICBOdWxsIG1lYW5zIG5vXHJcbiAgICAvLyBkcm9wcyBoYXZlIGZhbGxlbi5cclxuICAgIHRoaXMubGFzdERyb3BUaW1lID0gbnVsbDtcclxuXHJcbiAgICAvLyBwcmVwIHRvIGZpcmUgYSBuZXcgZHJvcCBpbiB0aGUgbmV4dCBmcmFtZSwgYnV0IG9ubHkgaWYgdGhlIG90aGVyIHNvdXJjZSB3YXNuJ3QgYWxyZWFkeSBzZXR0aW5nIHRoZSBwaGFzZVxyXG4gICAgdGhpcy5idXR0b24xUHJlc3NlZFByb3BlcnR5LmxpbmsoIHByZXNzZWQgPT4ge1xyXG4gICAgICBpZiAoIHByZXNzZWQgJiYgIXRoaXMuYnV0dG9uMlByZXNzZWRQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICB0aGlzLmxhc3REcm9wVGltZSA9IG51bGw7IC8vIHByZXAgdG8gZmlyZSBhIG5ldyBkcm9wIGluIHRoZSBuZXh0IGZyYW1lXHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBwcmVwIHRvIGZpcmUgYSBuZXcgZHJvcCBpbiB0aGUgbmV4dCBmcmFtZSwgYnV0IG9ubHkgaWYgdGhlIG90aGVyIHNvdXJjZSB3YXNuJ3QgYWxyZWFkeSBzZXR0aW5nIHRoZSBwaGFzZVxyXG4gICAgdGhpcy5idXR0b24yUHJlc3NlZFByb3BlcnR5LmxpbmsoIHByZXNzZWQgPT4ge1xyXG4gICAgICBpZiAoIHByZXNzZWQgJiYgIXRoaXMuYnV0dG9uMVByZXNzZWRQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICB0aGlzLmxhc3REcm9wVGltZSA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBGb3IgdGhlIHdhdGVyIHNjZW5lLCByZW1vdmUgd2F0ZXIgZHJvcHMgc28gb25lIG1vZGUgZG9lc24ndCBjcmVhdGUgd2F2ZXMgaW4gdGhlIG90aGVyIG1vZGVcclxuICAgIHRoaXMuZGlzdHVyYmFuY2VUeXBlUHJvcGVydHkubGluayggKCkgPT4gdGhpcy5yZW1vdmVBbGxEcm9wcygpICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGaXJlIGFub3RoZXIgd2F0ZXIgZHJvcCBpZiBvbmUgaXMgd2FycmFudGVkIGZvciB0aGUgc3BlY2lmaWVkIGZhdWNldC4gIFdlIGFscmVhZHkgZGV0ZXJtaW5lZCB0aGF0IHRoZSB0aW1pbmdcclxuICAgKiBpcyByaWdodCAoZm9yIHRoZSBwZXJpb2QpLCBub3cgd2UgbmVlZCB0byBrbm93IGlmIGEgZHJvcCBzaG91bGQgZmlyZS5cclxuICAgKiBAcGFyYW0gYnV0dG9uUHJvcGVydHkgLSBpbmRpY2F0ZXMgd2hldGhlciB0aGUgY29ycmVzcG9uZGluZyBidXR0b24gaXMgcHJlc3NlZFxyXG4gICAqIEBwYXJhbSBvc2NpbGxhdGluZ1Byb3BlcnR5IC0gaW5kaWNhdGVzIHdoZXRoZXIgdGhlIHdhdmUgc291cmNlIGlzIG9zY2lsbGF0aW5nXHJcbiAgICogQHBhcmFtIHNpZ24gLSAtMSBmb3IgdG9wIGZhdWNldCwgKzEgZm9yIGJvdHRvbSBmYXVjZXRcclxuICAgKi9cclxuICBwcml2YXRlIGxhdW5jaFdhdGVyRHJvcCggYnV0dG9uUHJvcGVydHksIG9zY2lsbGF0aW5nUHJvcGVydHksIHNpZ24gKTogdm9pZCB7XHJcblxyXG4gICAgY29uc3QgdGltZSA9IHRoaXMudGltZVByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgIC8vIFNlbmQgYSB3YXRlciBkcm9wIGlmIHRoZSBidXR0b24gaXMgcHJlc3NlZCBidXQgbm90IGlmIHRoZSBidXR0b24gaXMgc3RpbGwgcHJlc3NlZCBmcm9tIHRoZSBsYXN0IHB1bHNlLlxyXG4gICAgLy8gbW9kZWwuYnV0dG9uMVByZXNzZWRQcm9wZXJ0eS52YWx1ZSBub3QgY29uc3VsdGVkIGJlY2F1c2Ugd2Ugc2VuZCBhIHNodXRvZmYgd2F0ZXIgZHJvcC4gc28gdGhhdCB0aGUgcHJldmlvdXNcclxuICAgIC8vIGRyb3AgZ2V0cyBhIGZ1bGwgY3ljbGVcclxuICAgIGNvbnN0IGlzUHVsc2VNb2RlID0gdGhpcy5kaXN0dXJiYW5jZVR5cGVQcm9wZXJ0eS52YWx1ZSA9PT0gU2NlbmUuRGlzdHVyYmFuY2VUeXBlLlBVTFNFO1xyXG4gICAgY29uc3QgZmlyZVB1bHNlRHJvcCA9IGlzUHVsc2VNb2RlICYmICF0aGlzLnB1bHNlRmlyaW5nUHJvcGVydHkudmFsdWUgJiYgdGhpcy5idXR0b24xUHJlc3NlZFByb3BlcnR5LnZhbHVlO1xyXG4gICAgaWYgKCAhaXNQdWxzZU1vZGUgfHwgZmlyZVB1bHNlRHJvcCApIHtcclxuXHJcbiAgICAgIC8vIGNhcHR1cmUgY2xvc3VyZSB2YXJzIGZvciB3aGVuIHRoZSB3YXRlciBkcm9wIGlzIGFic29yYmVkLlxyXG4gICAgICBjb25zdCBidXR0b25QcmVzc2VkID0gYnV0dG9uUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIGNvbnN0IGZyZXF1ZW5jeSA9IHRoaXMuZGVzaXJlZEZyZXF1ZW5jeVByb3BlcnR5LnZhbHVlO1xyXG4gICAgICBjb25zdCBhbXBsaXR1ZGUgPSB0aGlzLmRlc2lyZWRBbXBsaXR1ZGVQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgY29uc3QgaXNQdWxzZSA9IHRoaXMuZGlzdHVyYmFuY2VUeXBlUHJvcGVydHkudmFsdWUgPT09IFNjZW5lLkRpc3R1cmJhbmNlVHlwZS5QVUxTRTtcclxuXHJcbiAgICAgIC8vIERpc3RhbmNlIGJldHdlZW4gdGhlIHNvdXJjZXMsIG9yIDAgaWYgdGhlcmUgaXMgb25seSAxIHNvdXJjZVxyXG4gICAgICBjb25zdCBzb3VyY2VTZXBhcmF0aW9uID0gdGhpcy5udW1iZXJPZlNvdXJjZXMgPT09IDIgPyB0aGlzLmRlc2lyZWRTb3VyY2VTZXBhcmF0aW9uUHJvcGVydHkudmFsdWUgOiAwO1xyXG4gICAgICB0aGlzLndhdGVyRHJvcHMucHVzaCggbmV3IFdhdGVyRHJvcChcclxuICAgICAgICBhbXBsaXR1ZGUsXHJcbiAgICAgICAgYnV0dG9uUHJlc3NlZCxcclxuICAgICAgICBzb3VyY2VTZXBhcmF0aW9uLFxyXG4gICAgICAgIHNpZ24sXHJcbiAgICAgICAgKCkgPT4ge1xyXG5cclxuICAgICAgICAgIGlmICggaXNQdWxzZSAmJiB0aGlzLnB1bHNlRmlyaW5nUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuYW1wbGl0dWRlUHJvcGVydHkuc2V0KCBhbXBsaXR1ZGUgKTtcclxuICAgICAgICAgIHRoaXMuZnJlcXVlbmN5UHJvcGVydHkuc2V0KCBmcmVxdWVuY3kgKTtcclxuXHJcbiAgICAgICAgICAvLyBTZXBhcmF0ZSB0aGUgc291cmNlcyAoaWYgdGhlcmUgYXJlIHR3byBvZiB0aGVtKVxyXG4gICAgICAgICAgaWYgKCB0aGlzLm51bWJlck9mU291cmNlcyA9PT0gMiApIHtcclxuICAgICAgICAgICAgdGhpcy5zb3VyY2VTZXBhcmF0aW9uUHJvcGVydHkudmFsdWUgPSBzb3VyY2VTZXBhcmF0aW9uO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHRoaXMucmVzZXRQaGFzZSgpO1xyXG4gICAgICAgICAgaWYgKCBpc1B1bHNlICkge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXJ0UHVsc2UoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBvc2NpbGxhdGluZ1Byb3BlcnR5LnZhbHVlID0gYnV0dG9uUHJlc3NlZDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICkgKTtcclxuICAgICAgdGhpcy51cGRhdGVJc0Fib3V0VG9GaXJlKCk7XHJcbiAgICAgIHRoaXMubGFzdERyb3BUaW1lID0gdGltZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE92ZXJyaWRlIHRvIGNsZWFyIHdhdGVyIGRyb3BzIHdoZW4gbXV0ZWQuXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIHNldE11dGVkKCBtdXRlZDogYm9vbGVhbiApOiB2b2lkIHtcclxuICAgIHN1cGVyLnNldE11dGVkKCBtdXRlZCApO1xyXG4gICAgbXV0ZWQgJiYgdGhpcy5yZW1vdmVBbGxEcm9wcygpO1xyXG4gICAgdGhpcy5jb250aW51b3VzV2F2ZTFPc2NpbGxhdGluZ1Byb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcbiAgICB0aGlzLmNvbnRpbnVvdXNXYXZlMk9zY2lsbGF0aW5nUHJvcGVydHkudmFsdWUgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1vdmUgZm9yd2FyZCBpbiB0aW1lIGJ5IHRoZSBzcGVjaWZpZWQgYW1vdW50LCB1cGRhdGluZyB2ZWxvY2l0eSBhbmQgcG9zaXRpb24gb2YgdGhlIFNvdW5kUGFydGljbGUgaW5zdGFuY2VzXHJcbiAgICogQHBhcmFtIGR0IC0gYW1vdW50IG9mIHRpbWUgdG8gbW92ZSBmb3J3YXJkLCBpbiB0aGUgdW5pdHMgb2YgdGhlIHNjZW5lXHJcbiAgICovXHJcbiAgcHVibGljIG92ZXJyaWRlIHN0ZXAoIGR0OiBudW1iZXIgKTogdm9pZCB7XHJcblxyXG4gICAgc3VwZXIuc3RlcCggZHQgKTtcclxuXHJcbiAgICBjb25zdCB0aW1lID0gdGhpcy50aW1lUHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgLy8gVXNlIHRoZSBsYXR0aWNlIGZyZXF1ZW5jeSAocmF0aGVyIHRoYW4gdGhlIGRlc2lyZWQgZnJlcXVlbmN5KSB0byBkZXRlcm1pbmUgdGhlIHRpbWUgb2YgdGhlIG5leHQgZHJvcFxyXG4gICAgLy8gc28gdGhlIG5leHQgZHJvcCB3aWxsIG5vdCB0YWtlIHRvbyBsb25nLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3dhdmUtaW50ZXJmZXJlbmNlL2lzc3Vlcy8xNTRcclxuICAgIGNvbnN0IHBlcmlvZCA9IDEgLyB0aGlzLmZyZXF1ZW5jeVByb3BlcnR5LnZhbHVlO1xyXG5cclxuICAgIGNvbnN0IHRpbWVTaW5jZUxhc3REcm9wID0gdGltZSAtIHRoaXMubGFzdERyb3BUaW1lO1xyXG5cclxuICAgIC8vIEVtaXQgd2F0ZXIgZHJvcHMgaWYgdGhlIHBoYXNlIG1hdGNoZXMgdXAsIGJ1dCBub3QgZm9yIHRoZSBwbGFuZSB3YXZlcyBzY3JlZW5cclxuICAgIGlmICggdGhpcy53YXZlU3BhdGlhbFR5cGUgPT09IFNjZW5lLldhdmVTcGF0aWFsVHlwZS5QT0lOVCAmJlxyXG4gICAgICAgICAoIHRoaXMubGFzdERyb3BUaW1lID09PSBudWxsIHx8IHRpbWVTaW5jZUxhc3REcm9wID4gcGVyaW9kICkgJiZcclxuICAgICAgICAgIXRoaXMubXV0ZWQgKSB7XHJcblxyXG4gICAgICB0aGlzLmxhdW5jaFdhdGVyRHJvcCggdGhpcy5idXR0b24xUHJlc3NlZFByb3BlcnR5LCB0aGlzLmNvbnRpbnVvdXNXYXZlMU9zY2lsbGF0aW5nUHJvcGVydHksICsxICk7XHJcbiAgICAgIHRoaXMubGF1bmNoV2F0ZXJEcm9wKCB0aGlzLmJ1dHRvbjJQcmVzc2VkUHJvcGVydHksIHRoaXMuY29udGludW91c1dhdmUyT3NjaWxsYXRpbmdQcm9wZXJ0eSwgLTEgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0b1JlbW92ZSA9IFtdO1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy53YXRlckRyb3BzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBjb25zdCB3YXRlckRyb3AgPSB0aGlzLndhdGVyRHJvcHNbIGkgXTtcclxuXHJcbiAgICAgIC8vIFR1bmVkIHNvIHRoYXQgdGhlIHdhdmUgZ29lcyB1bmRlcndhdGVyIHdoZW4gdGhlIGRyb3AgaGl0c1xyXG4gICAgICB3YXRlckRyb3Auc3RlcCggZHQgKTtcclxuXHJcbiAgICAgIC8vIFJlbW92ZSBhbnkgd2F0ZXIgZHJvcHMgdGhhdCB3ZW50IGJlbG93IHk9MFxyXG4gICAgICBpZiAoIHdhdGVyRHJvcC55IDwgMCApIHtcclxuICAgICAgICB0b1JlbW92ZS5wdXNoKCB3YXRlckRyb3AgKTtcclxuICAgICAgICBpZiAoIHdhdGVyRHJvcC5hbXBsaXR1ZGUgPiAwICYmIHdhdGVyRHJvcC5zdGFydHNPc2NpbGxhdGlvbiApIHtcclxuICAgICAgICAgIHRoaXMud2F0ZXJEcm9wQWJzb3JiZWRFbWl0dGVyLmVtaXQoIHdhdGVyRHJvcCApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdG9SZW1vdmUubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGFycmF5UmVtb3ZlKCB0aGlzLndhdGVyRHJvcHMsIHRvUmVtb3ZlWyBpIF0gKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnVwZGF0ZUlzQWJvdXRUb0ZpcmUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFdoZW4gYW55IHdhdGVyIGRyb3Agd2l0aCBhIG5vbnplcm8gYW1wbGl0dWRlIHRoYXQgaXMgYSB0cmlnZ2VyIHRvIHN0YXJ0IG9zY2lsbGF0aW9uIGV4aXN0cyxcclxuICAgKiB3ZSBtYXJrIHRoZSBpc0Fib3V0VG9GaXJlUHJvcGVydHkgYXMgdHJ1ZS5cclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZUlzQWJvdXRUb0ZpcmUoKTogdm9pZCB7XHJcbiAgICBsZXQgaXNBYm91dFRvRmlyZSA9IGZhbHNlO1xyXG5cclxuICAgIC8vIENhbGxlZCBldmVyeSBmcmFtZSwgZG8gbm90IGFsbG9jYXRlIGNsb3N1cmVzLlxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy53YXRlckRyb3BzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBjb25zdCB3YXRlckRyb3AgPSB0aGlzLndhdGVyRHJvcHNbIGkgXTtcclxuICAgICAgaWYgKCB3YXRlckRyb3AuYW1wbGl0dWRlID4gMCAmJiB3YXRlckRyb3Auc3RhcnRzT3NjaWxsYXRpb24gKSB7XHJcblxyXG4gICAgICAgIC8vIENhbGxlZCBldmVyeSBmcmFtZSwgYnJlYWsgd2hlbiBhbnkgbWF0Y2ggaXMgZm91bmQgZm9yIHBlcmZvcm1hbmNlXHJcbiAgICAgICAgaXNBYm91dFRvRmlyZSA9IHRydWU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuaXNBYm91dFRvRmlyZVByb3BlcnR5LnZhbHVlID0gaXNBYm91dFRvRmlyZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIHdhdmVsZW5ndGggc3BlY2lmaWVkIGJ5IHRoZSB1c2VyIGluIHRoZSBjb250cm9sIHBhbmVsLlxyXG4gICAqIEByZXR1cm5zIGluIGNtL3NlY1xyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXREZXNpcmVkV2F2ZWxlbmd0aCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMud2F2ZVNwZWVkIC8gdGhpcy5kZXNpcmVkRnJlcXVlbmN5UHJvcGVydHkuZ2V0KCk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgb3ZlcnJpZGUgaGFuZGxlQnV0dG9uMVRvZ2dsZWQoIGlzUHJlc3NlZDogYm9vbGVhbiApOiB2b2lkIHtcclxuICAgIC8vIE92ZXJyaWRlIGFzIGEgbm8tb3AsIHNpbmNlIHdhdGVyIGNvbnRyb2xzIHRoZSBzb3VyY2UgdmlhIFdhdGVyRHJvcHMgaGl0dGluZyB0aGUgc3VyZmFjZVxyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIG92ZXJyaWRlIGhhbmRsZUJ1dHRvbjJUb2dnbGVkKCBpc1ByZXNzZWQ6IGJvb2xlYW4gKTogdm9pZCB7XHJcbiAgICAvLyBPdmVycmlkZSBhcyBhIG5vLW9wLCBzaW5jZSB3YXRlciBjb250cm9scyB0aGUgc291cmNlIHZpYSBXYXRlckRyb3BzIGhpdHRpbmcgdGhlIHN1cmZhY2VcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIGhvcml6b250YWwgY29vcmRpbmF0ZSB3aGVyZSB3YXRlciBkcm9wcyBjb21lIG91dC0tYWxpZ25lZCB3aXRoIHRoZSBvc2NpbGxhdGlvbiBjZWxsLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRXYXRlckRyb3BYKCk6IG51bWJlciB7XHJcblxyXG4gICAgLy8gTm90ZSB0aGlzIGlzIG51ZGdlZCBvdmVyIDEvMiBhIGNlbGwgc28gaXQgd2lsbCBhcHBlYXIgaW4gdGhlIGNlbnRlciBvZiB0aGUgY2VsbCByYXRoZXIgdGhhblxyXG4gICAgLy8gYXQgdGhlIGxlZnQgZWRnZSBvZiB0aGUgY2VsbC4gIFNlZSBhbHNvIFdhdmVJbnRlcmZlcmVuY2VVdGlscy5nZXRXYXRlclNpZGVTaGFwZS5cclxuICAgIHJldHVybiB0aGlzLmxhdHRpY2VUb1ZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdYKFxyXG4gICAgICBXYXZlSW50ZXJmZXJlbmNlQ29uc3RhbnRzLlBPSU5UX1NPVVJDRV9IT1JJWk9OVEFMX0NPT1JESU5BVEUgKyAwLjVcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDbGVhciBhbGwgb2YgdGhlIHdhdGVyIGRyb3BzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZW1vdmVBbGxEcm9wcygpOiB2b2lkIHtcclxuICAgIHdoaWxlICggdGhpcy53YXRlckRyb3BzLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgIGFycmF5UmVtb3ZlKCB0aGlzLndhdGVyRHJvcHMsIHRoaXMud2F0ZXJEcm9wc1sgMCBdICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNldCBhZGRpdGlvbmFsIGZlYXR1cmVzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSByZXNldCgpOiB2b2lkIHtcclxuICAgIHN1cGVyLnJlc2V0KCk7XHJcbiAgICB0aGlzLmRlc2lyZWRGcmVxdWVuY3lQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5kZXNpcmVkU291cmNlU2VwYXJhdGlvblByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmRlc2lyZWRBbXBsaXR1ZGVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgd2hpbGUgKCB0aGlzLndhdGVyRHJvcHMubGVuZ3RoID4gMCApIHtcclxuICAgICAgYXJyYXlSZW1vdmUoIHRoaXMud2F0ZXJEcm9wcywgdGhpcy53YXRlckRyb3BzWyAwIF0gKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbndhdmVJbnRlcmZlcmVuY2UucmVnaXN0ZXIoICdXYXRlclNjZW5lJywgV2F0ZXJTY2VuZSApO1xyXG5leHBvcnQgZGVmYXVsdCBXYXRlclNjZW5lOyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsT0FBTyxNQUFNLGdDQUFnQztBQUNwRCxPQUFPQyxjQUFjLE1BQU0sdUNBQXVDO0FBQ2xFLE9BQU9DLFdBQVcsTUFBTSx5Q0FBeUM7QUFFakUsT0FBT0MsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBQ3hELE9BQU9DLHlCQUF5QixNQUFNLGlDQUFpQztBQUN2RSxPQUFPQyxLQUFLLE1BQXdCLFlBQVk7QUFDaEQsT0FBT0MsU0FBUyxNQUFNLGdCQUFnQjtBQUt0QyxNQUFNQyxVQUFVLFNBQVNGLEtBQUssQ0FBQztFQUU3Qjs7RUFHQTtBQUNGO0FBQ0E7RUFDU0csV0FBV0EsQ0FBRUMsTUFBeUIsRUFBRztJQUM5QyxLQUFLLENBQUVBLE1BQU8sQ0FBQzs7SUFFZjtJQUNBLElBQUksQ0FBQ0Msd0JBQXdCLEdBQUcsSUFBSVYsT0FBTyxDQUFFO01BQUVXLFVBQVUs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