// Copyright 2019-2022, University of Colorado Boulder

/**
 * ProportionsModel is the sub-model of the Proportions graph.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import createObservableArray from '../../../../axon/js/createObservableArray.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Multilink from '../../../../axon/js/Multilink.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Property from '../../../../axon/js/Property.js';
import Range from '../../../../dot/js/Range.js';
import optionize from '../../../../phet-core/js/optionize.js';
import PhetioObject from '../../../../tandem/js/PhetioObject.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import NullableIO from '../../../../tandem/js/types/NullableIO.js';
import naturalSelection from '../../naturalSelection.js';
import NaturalSelectionUtils from '../NaturalSelectionUtils.js';
import BunnyCounts from './BunnyCounts.js';
import ProportionsCounts from './ProportionsCounts.js';
export default class ProportionsModel extends PhetioObject {
  // Named proportionsGenerationProperty to distinguish it from the other 'generation' Properties in this sim.
  // See https://github.com/phetsims/natural-selection/issues/187
  // whether the Proportions graph is displaying the current generation. dispose is not necessary.
  // counts for 'Start of Generation'
  // counts for 'End of Generation'
  // Whether the model has data to display
  // visibility of the column for each gene in the graph
  /**
   * @param liveBunnyCountsProperty - counts of live bunnies, used for dynamic 'Currently' data
   * @param clockGenerationProperty - the generation number of the generation clock
   * @param isPlayingProperty
   * @param providedOptions
   */
  constructor(liveBunnyCountsProperty, clockGenerationProperty, isPlayingProperty, providedOptions) {
    const options = optionize()({
      // PhetioObjectOptions
      phetioState: false,
      // to prevent serialization, because we don't have an IO Type
      phetioDocumentation: 'model elements that are specific to the Proportions feature'
    }, providedOptions);
    super(options);
    this.clockGenerationProperty = clockGenerationProperty;
    this.valuesVisibleProperty = new BooleanProperty(true, {
      tandem: options.tandem.createTandem('valuesVisibleProperty'),
      phetioDocumentation: 'determines whether values are visible on the bars in the Proportions graph'
    });
    this.proportionsGenerationProperty = new NumberProperty(0, {
      numberType: 'Integer',
      range: new Range(0, 0),
      // dynamically adjusted by calling setValueAndRange
      tandem: options.tandem.createTandem('proportionsGenerationProperty'),
      phetioDocumentation: 'the generation whose data is displayed by the Proportions graph (integer)',
      phetioReadOnly: true // range is dynamic
    });

    this.isDisplayingCurrentGenerationProperty = new DerivedProperty([this.proportionsGenerationProperty, clockGenerationProperty], (proportionsGeneration, clockGeneration) => proportionsGeneration === clockGeneration, {
      tandem: Tandem.OPT_OUT
    });
    this.startCountsProperty = new Property(BunnyCounts.withZero(), {
      valueType: BunnyCounts,
      tandem: Tandem.OPT_OUT
    });
    this.endCountsProperty = new Property(BunnyCounts.withZero(), {
      valueType: BunnyCounts,
      tandem: Tandem.OPT_OUT
    });

    // 'Start' counts for the current generation. This is null until the sim enters SimulationMode.ACTIVE.
    // While in SimulationMode.ACTIVE it will always have a value.
    const currentStartCountsProperty = new Property(null, {
      tandem: options.tandem.createTandem('currentStartCountsProperty'),
      phetioValueType: NullableIO(BunnyCounts.BunnyCountsIO),
      phetioDocumentation: 'Counts at the start of the current generation'
    });
    const previousCounts = createObservableArray({
      tandem: options.tandem.createTandem('previousCounts'),
      phetioType: createObservableArray.ObservableArrayIO(ProportionsCounts.ProportionsCountsIO),
      phetioDocumentation: 'Start and End counts for previous generations, indexed by generation number'
    });
    this.hasDataProperty = new DerivedProperty([currentStartCountsProperty], currentStartCounts => !!currentStartCounts, {
      tandem: Tandem.OPT_OUT
    });

    // Pause the sim when a generation other than the current generation is being viewed. unlink is not necessary.
    this.proportionsGenerationProperty.link(proportionsGeneration => {
      if (proportionsGeneration !== clockGenerationProperty.value) {
        isPlayingProperty.value = false;
      }
    });

    // visibility of the column for each gene in the graph
    this.furVisibleProperty = new BooleanProperty(true, {
      tandem: options.tandem.createTandem('furVisibleProperty')
    });
    this.earsVisibleProperty = new BooleanProperty(true, {
      tandem: options.tandem.createTandem('earsVisibleProperty')
    });
    this.teethVisibleProperty = new BooleanProperty(true, {
      tandem: options.tandem.createTandem('teethVisibleProperty')
    });

    // When the sim starts playing or the current generation changes, show the current generation immediately.
    // unmultilink is not necessary.
    Multilink.multilink([isPlayingProperty, clockGenerationProperty], (isPlaying, clockGeneration) => {
      if (isPlaying) {
        this.proportionsGenerationProperty.setValueAndRange(clockGeneration, new Range(0, clockGeneration));
      }
    });
    const updateEndCounts = () => {
      this.endCountsProperty.value = liveBunnyCountsProperty.value;
    };

    // Determine what data to display. unmultilink is not necessary.
    Multilink.multilink([this.proportionsGenerationProperty, currentStartCountsProperty], (proportionsGeneration, currentStartCounts) => {
      if (liveBunnyCountsProperty.hasListener(updateEndCounts)) {
        liveBunnyCountsProperty.unlink(updateEndCounts);
      }
      if (currentStartCounts) {
        // We have data. Decide whether to display data for the current generation or a previous generation.
        if (proportionsGeneration === clockGenerationProperty.value) {
          // Show static counts for the start of the current generation.
          this.startCountsProperty.value = currentStartCounts;

          // Show dynamic counts for the 'Currently' state of the current generation. unlink is handled above.
          liveBunnyCountsProperty.link(updateEndCounts);
        } else {
          // Show static counts for a previous generation.
          const counts = previousCounts[proportionsGeneration];
          assert && assert(counts.generation === proportionsGeneration, 'unexpected generation');
          this.startCountsProperty.value = counts.startCounts;
          this.endCountsProperty.value = counts.endCounts;
        }
      } else {
        // There is no data, so reset the counts
        this.startCountsProperty.reset();
        this.endCountsProperty.reset();
      }
    });

    // Create a Studio link
    this.addLinkedElement(liveBunnyCountsProperty, {
      tandem: options.tandem.createTandem('currentCountsProperty')
    });
    this.currentStartCountsProperty = currentStartCountsProperty;
    this.previousCounts = previousCounts;
  }
  reset() {
    this.valuesVisibleProperty.reset();
    this.proportionsGenerationProperty.resetValueAndRange(); // because we're using setValueAndRange
    this.startCountsProperty.reset();
    this.endCountsProperty.reset();
    this.currentStartCountsProperty.reset();
    this.previousCounts.length = 0; // use this approach because it's an ObservableArrayDef
    this.furVisibleProperty.reset();
    this.earsVisibleProperty.reset();
    this.teethVisibleProperty.reset();
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }

  /**
   * Records start counts for the current generation.
   */
  recordStartCounts(clockGeneration, startCounts) {
    assert && assert(NaturalSelectionUtils.isNonNegativeInteger(clockGeneration), 'invalid clockGeneration');
    assert && assert(clockGeneration === this.clockGenerationProperty.value, `${clockGeneration} is not the current generation`);
    this.currentStartCountsProperty.value = startCounts;
  }

  /**
   * Records end counts for the previous generation, using what was formerly the current generation start data.
   */
  recordEndCounts(generation, endCounts) {
    assert && assert(NaturalSelectionUtils.isNonNegativeInteger(generation), 'invalid generation');
    assert && assert(generation === this.clockGenerationProperty.value - 1, `${generation} is not the previous generation`);
    assert && assert(this.previousCounts.length === generation, `unexpected generation=${generation}, expected ${this.previousCounts.length}`);
    const startCounts = this.currentStartCountsProperty.value;
    assert && assert(startCounts !== null);
    this.previousCounts.push(new ProportionsCounts(generation, startCounts, endCounts));
  }
}
naturalSelection.register('ProportionsModel', ProportionsModel);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJjcmVhdGVPYnNlcnZhYmxlQXJyYXkiLCJEZXJpdmVkUHJvcGVydHkiLCJNdWx0aWxpbmsiLCJOdW1iZXJQcm9wZXJ0eSIsIlByb3BlcnR5IiwiUmFuZ2UiLCJvcHRpb25pemUiLCJQaGV0aW9PYmplY3QiLCJUYW5kZW0iLCJOdWxsYWJsZUlPIiwibmF0dXJhbFNlbGVjdGlvbiIsIk5hdHVyYWxTZWxlY3Rpb25VdGlscyIsIkJ1bm55Q291bnRzIiwiUHJvcG9ydGlvbnNDb3VudHMiLCJQcm9wb3J0aW9uc01vZGVsIiwiY29uc3RydWN0b3IiLCJsaXZlQnVubnlDb3VudHNQcm9wZXJ0eSIsImNsb2NrR2VuZXJhdGlvblByb3BlcnR5IiwiaXNQbGF5aW5nUHJvcGVydHkiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwicGhldGlvU3RhdGUiLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwidmFsdWVzVmlzaWJsZVByb3BlcnR5IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwicHJvcG9ydGlvbnNHZW5lcmF0aW9uUHJvcGVydHkiLCJudW1iZXJUeXBlIiwicmFuZ2UiLCJwaGV0aW9SZWFkT25seSIsImlzRGlzcGxheWluZ0N1cnJlbnRHZW5lcmF0aW9uUHJvcGVydHkiLCJwcm9wb3J0aW9uc0dlbmVyYXRpb24iLCJjbG9ja0dlbmVyYXRpb24iLCJPUFRfT1VUIiwic3RhcnRDb3VudHNQcm9wZXJ0eSIsIndpdGhaZXJvIiwidmFsdWVUeXBlIiwiZW5kQ291bnRzUHJvcGVydHkiLCJjdXJyZW50U3RhcnRDb3VudHNQcm9wZXJ0eSIsInBoZXRpb1ZhbHVlVHlwZSIsIkJ1bm55Q291bnRzSU8iLCJwcmV2aW91c0NvdW50cyIsInBoZXRpb1R5cGUiLCJPYnNlcnZhYmxlQXJyYXlJTyIsIlByb3BvcnRpb25zQ291bnRzSU8iLCJoYXNEYXRhUHJvcGVydHkiLCJjdXJyZW50U3RhcnRDb3VudHMiLCJsaW5rIiwidmFsdWUiLCJmdXJWaXNpYmxlUHJvcGVydHkiLCJlYXJzVmlzaWJsZVByb3BlcnR5IiwidGVldGhWaXNpYmxlUHJvcGVydHkiLCJtdWx0aWxpbmsiLCJpc1BsYXlpbmciLCJzZXRWYWx1ZUFuZFJhbmdlIiwidXBkYXRlRW5kQ291bnRzIiwiaGFzTGlzdGVuZXIiLCJ1bmxpbmsiLCJjb3VudHMiLCJhc3NlcnQiLCJnZW5lcmF0aW9uIiwic3RhcnRDb3VudHMiLCJlbmRDb3VudHMiLCJyZXNldCIsImFkZExpbmtlZEVsZW1lbnQiLCJyZXNldFZhbHVlQW5kUmFuZ2UiLCJsZW5ndGgiLCJkaXNwb3NlIiwicmVjb3JkU3RhcnRDb3VudHMiLCJpc05vbk5lZ2F0aXZlSW50ZWdlciIsInJlY29yZEVuZENvdW50cyIsInB1c2giLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlByb3BvcnRpb25zTW9kZWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogUHJvcG9ydGlvbnNNb2RlbCBpcyB0aGUgc3ViLW1vZGVsIG9mIHRoZSBQcm9wb3J0aW9ucyBncmFwaC5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IGNyZWF0ZU9ic2VydmFibGVBcnJheSwgeyBPYnNlcnZhYmxlQXJyYXkgfSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL2NyZWF0ZU9ic2VydmFibGVBcnJheS5qcyc7XHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IE51bWJlclByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTnVtYmVyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IFJhbmdlIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgUGhldGlvT2JqZWN0LCB7IFBoZXRpb09iamVjdE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvUGhldGlvT2JqZWN0LmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IE51bGxhYmxlSU8gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL051bGxhYmxlSU8uanMnO1xyXG5pbXBvcnQgbmF0dXJhbFNlbGVjdGlvbiBmcm9tICcuLi8uLi9uYXR1cmFsU2VsZWN0aW9uLmpzJztcclxuaW1wb3J0IE5hdHVyYWxTZWxlY3Rpb25VdGlscyBmcm9tICcuLi9OYXR1cmFsU2VsZWN0aW9uVXRpbHMuanMnO1xyXG5pbXBvcnQgQnVubnlDb3VudHMgZnJvbSAnLi9CdW5ueUNvdW50cy5qcyc7XHJcbmltcG9ydCBQcm9wb3J0aW9uc0NvdW50cyBmcm9tICcuL1Byb3BvcnRpb25zQ291bnRzLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSBFbXB0eVNlbGZPcHRpb25zO1xyXG5cclxudHlwZSBQcm9wb3J0aW9uc01vZGVsT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgUGlja1JlcXVpcmVkPFBoZXRpb09iamVjdE9wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb3BvcnRpb25zTW9kZWwgZXh0ZW5kcyBQaGV0aW9PYmplY3Qge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGNsb2NrR2VuZXJhdGlvblByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXI+O1xyXG4gIHB1YmxpYyByZWFkb25seSB2YWx1ZXNWaXNpYmxlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyBOYW1lZCBwcm9wb3J0aW9uc0dlbmVyYXRpb25Qcm9wZXJ0eSB0byBkaXN0aW5ndWlzaCBpdCBmcm9tIHRoZSBvdGhlciAnZ2VuZXJhdGlvbicgUHJvcGVydGllcyBpbiB0aGlzIHNpbS5cclxuICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL25hdHVyYWwtc2VsZWN0aW9uL2lzc3Vlcy8xODdcclxuICBwdWJsaWMgcmVhZG9ubHkgcHJvcG9ydGlvbnNHZW5lcmF0aW9uUHJvcGVydHk6IE51bWJlclByb3BlcnR5O1xyXG5cclxuICAvLyB3aGV0aGVyIHRoZSBQcm9wb3J0aW9ucyBncmFwaCBpcyBkaXNwbGF5aW5nIHRoZSBjdXJyZW50IGdlbmVyYXRpb24uIGRpc3Bvc2UgaXMgbm90IG5lY2Vzc2FyeS5cclxuICBwdWJsaWMgcmVhZG9ubHkgaXNEaXNwbGF5aW5nQ3VycmVudEdlbmVyYXRpb25Qcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIGNvdW50cyBmb3IgJ1N0YXJ0IG9mIEdlbmVyYXRpb24nXHJcbiAgcHVibGljIHJlYWRvbmx5IHN0YXJ0Q291bnRzUHJvcGVydHk6IFByb3BlcnR5PEJ1bm55Q291bnRzPjtcclxuXHJcbiAgLy8gY291bnRzIGZvciAnRW5kIG9mIEdlbmVyYXRpb24nXHJcbiAgcHVibGljIHJlYWRvbmx5IGVuZENvdW50c1Byb3BlcnR5OiBQcm9wZXJ0eTxCdW5ueUNvdW50cz47XHJcblxyXG4gIC8vIFdoZXRoZXIgdGhlIG1vZGVsIGhhcyBkYXRhIHRvIGRpc3BsYXlcclxuICBwdWJsaWMgcmVhZG9ubHkgaGFzRGF0YVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gdmlzaWJpbGl0eSBvZiB0aGUgY29sdW1uIGZvciBlYWNoIGdlbmUgaW4gdGhlIGdyYXBoXHJcbiAgcHVibGljIHJlYWRvbmx5IGZ1clZpc2libGVQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgcHVibGljIHJlYWRvbmx5IGVhcnNWaXNpYmxlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG4gIHB1YmxpYyByZWFkb25seSB0ZWV0aFZpc2libGVQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgY3VycmVudFN0YXJ0Q291bnRzUHJvcGVydHk6IFByb3BlcnR5PEJ1bm55Q291bnRzIHwgbnVsbD47XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgcHJldmlvdXNDb3VudHM6IE9ic2VydmFibGVBcnJheTxQcm9wb3J0aW9uc0NvdW50cz47XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBsaXZlQnVubnlDb3VudHNQcm9wZXJ0eSAtIGNvdW50cyBvZiBsaXZlIGJ1bm5pZXMsIHVzZWQgZm9yIGR5bmFtaWMgJ0N1cnJlbnRseScgZGF0YVxyXG4gICAqIEBwYXJhbSBjbG9ja0dlbmVyYXRpb25Qcm9wZXJ0eSAtIHRoZSBnZW5lcmF0aW9uIG51bWJlciBvZiB0aGUgZ2VuZXJhdGlvbiBjbG9ja1xyXG4gICAqIEBwYXJhbSBpc1BsYXlpbmdQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSBwcm92aWRlZE9wdGlvbnNcclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGxpdmVCdW5ueUNvdW50c1Byb3BlcnR5OiBQcm9wZXJ0eTxCdW5ueUNvdW50cz4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBjbG9ja0dlbmVyYXRpb25Qcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPixcclxuICAgICAgICAgICAgICAgICAgICAgIGlzUGxheWluZ1Byb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPixcclxuICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVkT3B0aW9uczogUHJvcG9ydGlvbnNNb2RlbE9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxQcm9wb3J0aW9uc01vZGVsT3B0aW9ucywgU2VsZk9wdGlvbnMsIFBoZXRpb09iamVjdE9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFBoZXRpb09iamVjdE9wdGlvbnNcclxuICAgICAgcGhldGlvU3RhdGU6IGZhbHNlLCAvLyB0byBwcmV2ZW50IHNlcmlhbGl6YXRpb24sIGJlY2F1c2Ugd2UgZG9uJ3QgaGF2ZSBhbiBJTyBUeXBlXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdtb2RlbCBlbGVtZW50cyB0aGF0IGFyZSBzcGVjaWZpYyB0byB0aGUgUHJvcG9ydGlvbnMgZmVhdHVyZSdcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5jbG9ja0dlbmVyYXRpb25Qcm9wZXJ0eSA9IGNsb2NrR2VuZXJhdGlvblByb3BlcnR5O1xyXG5cclxuICAgIHRoaXMudmFsdWVzVmlzaWJsZVByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggdHJ1ZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3ZhbHVlc1Zpc2libGVQcm9wZXJ0eScgKSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ2RldGVybWluZXMgd2hldGhlciB2YWx1ZXMgYXJlIHZpc2libGUgb24gdGhlIGJhcnMgaW4gdGhlIFByb3BvcnRpb25zIGdyYXBoJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMucHJvcG9ydGlvbnNHZW5lcmF0aW9uUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIDAsIHtcclxuICAgICAgbnVtYmVyVHlwZTogJ0ludGVnZXInLFxyXG4gICAgICByYW5nZTogbmV3IFJhbmdlKCAwLCAwICksIC8vIGR5bmFtaWNhbGx5IGFkanVzdGVkIGJ5IGNhbGxpbmcgc2V0VmFsdWVBbmRSYW5nZVxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Byb3BvcnRpb25zR2VuZXJhdGlvblByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAndGhlIGdlbmVyYXRpb24gd2hvc2UgZGF0YSBpcyBkaXNwbGF5ZWQgYnkgdGhlIFByb3BvcnRpb25zIGdyYXBoIChpbnRlZ2VyKScsXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlIC8vIHJhbmdlIGlzIGR5bmFtaWNcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmlzRGlzcGxheWluZ0N1cnJlbnRHZW5lcmF0aW9uUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgICBbIHRoaXMucHJvcG9ydGlvbnNHZW5lcmF0aW9uUHJvcGVydHksIGNsb2NrR2VuZXJhdGlvblByb3BlcnR5IF0sXHJcbiAgICAgICggcHJvcG9ydGlvbnNHZW5lcmF0aW9uLCBjbG9ja0dlbmVyYXRpb24gKSA9PiAoIHByb3BvcnRpb25zR2VuZXJhdGlvbiA9PT0gY2xvY2tHZW5lcmF0aW9uICksIHtcclxuICAgICAgICB0YW5kZW06IFRhbmRlbS5PUFRfT1VUXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnN0YXJ0Q291bnRzUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIEJ1bm55Q291bnRzLndpdGhaZXJvKCksIHtcclxuICAgICAgdmFsdWVUeXBlOiBCdW5ueUNvdW50cyxcclxuICAgICAgdGFuZGVtOiBUYW5kZW0uT1BUX09VVFxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZW5kQ291bnRzUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIEJ1bm55Q291bnRzLndpdGhaZXJvKCksIHtcclxuICAgICAgdmFsdWVUeXBlOiBCdW5ueUNvdW50cyxcclxuICAgICAgdGFuZGVtOiBUYW5kZW0uT1BUX09VVFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vICdTdGFydCcgY291bnRzIGZvciB0aGUgY3VycmVudCBnZW5lcmF0aW9uLiBUaGlzIGlzIG51bGwgdW50aWwgdGhlIHNpbSBlbnRlcnMgU2ltdWxhdGlvbk1vZGUuQUNUSVZFLlxyXG4gICAgLy8gV2hpbGUgaW4gU2ltdWxhdGlvbk1vZGUuQUNUSVZFIGl0IHdpbGwgYWx3YXlzIGhhdmUgYSB2YWx1ZS5cclxuICAgIGNvbnN0IGN1cnJlbnRTdGFydENvdW50c1Byb3BlcnR5ID0gbmV3IFByb3BlcnR5PEJ1bm55Q291bnRzIHwgbnVsbD4oIG51bGwsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdjdXJyZW50U3RhcnRDb3VudHNQcm9wZXJ0eScgKSxcclxuICAgICAgcGhldGlvVmFsdWVUeXBlOiBOdWxsYWJsZUlPKCBCdW5ueUNvdW50cy5CdW5ueUNvdW50c0lPICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdDb3VudHMgYXQgdGhlIHN0YXJ0IG9mIHRoZSBjdXJyZW50IGdlbmVyYXRpb24nXHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgcHJldmlvdXNDb3VudHMgPSBjcmVhdGVPYnNlcnZhYmxlQXJyYXk8UHJvcG9ydGlvbnNDb3VudHM+KCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncHJldmlvdXNDb3VudHMnICksXHJcbiAgICAgIHBoZXRpb1R5cGU6IGNyZWF0ZU9ic2VydmFibGVBcnJheS5PYnNlcnZhYmxlQXJyYXlJTyggUHJvcG9ydGlvbnNDb3VudHMuUHJvcG9ydGlvbnNDb3VudHNJTyApLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnU3RhcnQgYW5kIEVuZCBjb3VudHMgZm9yIHByZXZpb3VzIGdlbmVyYXRpb25zLCBpbmRleGVkIGJ5IGdlbmVyYXRpb24gbnVtYmVyJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuaGFzRGF0YVByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eShcclxuICAgICAgWyBjdXJyZW50U3RhcnRDb3VudHNQcm9wZXJ0eSBdLCBjdXJyZW50U3RhcnRDb3VudHMgPT4gISFjdXJyZW50U3RhcnRDb3VudHMsIHtcclxuICAgICAgICB0YW5kZW06IFRhbmRlbS5PUFRfT1VUXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBQYXVzZSB0aGUgc2ltIHdoZW4gYSBnZW5lcmF0aW9uIG90aGVyIHRoYW4gdGhlIGN1cnJlbnQgZ2VuZXJhdGlvbiBpcyBiZWluZyB2aWV3ZWQuIHVubGluayBpcyBub3QgbmVjZXNzYXJ5LlxyXG4gICAgdGhpcy5wcm9wb3J0aW9uc0dlbmVyYXRpb25Qcm9wZXJ0eS5saW5rKCBwcm9wb3J0aW9uc0dlbmVyYXRpb24gPT4ge1xyXG4gICAgICBpZiAoIHByb3BvcnRpb25zR2VuZXJhdGlvbiAhPT0gY2xvY2tHZW5lcmF0aW9uUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgaXNQbGF5aW5nUHJvcGVydHkudmFsdWUgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHZpc2liaWxpdHkgb2YgdGhlIGNvbHVtbiBmb3IgZWFjaCBnZW5lIGluIHRoZSBncmFwaFxyXG4gICAgdGhpcy5mdXJWaXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZnVyVmlzaWJsZVByb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmVhcnNWaXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZWFyc1Zpc2libGVQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy50ZWV0aFZpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICd0ZWV0aFZpc2libGVQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFdoZW4gdGhlIHNpbSBzdGFydHMgcGxheWluZyBvciB0aGUgY3VycmVudCBnZW5lcmF0aW9uIGNoYW5nZXMsIHNob3cgdGhlIGN1cnJlbnQgZ2VuZXJhdGlvbiBpbW1lZGlhdGVseS5cclxuICAgIC8vIHVubXVsdGlsaW5rIGlzIG5vdCBuZWNlc3NhcnkuXHJcbiAgICBNdWx0aWxpbmsubXVsdGlsaW5rKFxyXG4gICAgICBbIGlzUGxheWluZ1Byb3BlcnR5LCBjbG9ja0dlbmVyYXRpb25Qcm9wZXJ0eSBdLFxyXG4gICAgICAoIGlzUGxheWluZywgY2xvY2tHZW5lcmF0aW9uICkgPT4ge1xyXG4gICAgICAgIGlmICggaXNQbGF5aW5nICkge1xyXG4gICAgICAgICAgdGhpcy5wcm9wb3J0aW9uc0dlbmVyYXRpb25Qcm9wZXJ0eS5zZXRWYWx1ZUFuZFJhbmdlKCBjbG9ja0dlbmVyYXRpb24sIG5ldyBSYW5nZSggMCwgY2xvY2tHZW5lcmF0aW9uICkgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCB1cGRhdGVFbmRDb3VudHMgPSAoKSA9PiB7XHJcbiAgICAgIHRoaXMuZW5kQ291bnRzUHJvcGVydHkudmFsdWUgPSBsaXZlQnVubnlDb3VudHNQcm9wZXJ0eS52YWx1ZTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gRGV0ZXJtaW5lIHdoYXQgZGF0YSB0byBkaXNwbGF5LiB1bm11bHRpbGluayBpcyBub3QgbmVjZXNzYXJ5LlxyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayhcclxuICAgICAgWyB0aGlzLnByb3BvcnRpb25zR2VuZXJhdGlvblByb3BlcnR5LCBjdXJyZW50U3RhcnRDb3VudHNQcm9wZXJ0eSBdLFxyXG4gICAgICAoIHByb3BvcnRpb25zR2VuZXJhdGlvbiwgY3VycmVudFN0YXJ0Q291bnRzICkgPT4ge1xyXG5cclxuICAgICAgICBpZiAoIGxpdmVCdW5ueUNvdW50c1Byb3BlcnR5Lmhhc0xpc3RlbmVyKCB1cGRhdGVFbmRDb3VudHMgKSApIHtcclxuICAgICAgICAgIGxpdmVCdW5ueUNvdW50c1Byb3BlcnR5LnVubGluayggdXBkYXRlRW5kQ291bnRzICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIGN1cnJlbnRTdGFydENvdW50cyApIHtcclxuXHJcbiAgICAgICAgICAvLyBXZSBoYXZlIGRhdGEuIERlY2lkZSB3aGV0aGVyIHRvIGRpc3BsYXkgZGF0YSBmb3IgdGhlIGN1cnJlbnQgZ2VuZXJhdGlvbiBvciBhIHByZXZpb3VzIGdlbmVyYXRpb24uXHJcbiAgICAgICAgICBpZiAoIHByb3BvcnRpb25zR2VuZXJhdGlvbiA9PT0gY2xvY2tHZW5lcmF0aW9uUHJvcGVydHkudmFsdWUgKSB7XHJcblxyXG4gICAgICAgICAgICAvLyBTaG93IHN0YXRpYyBjb3VudHMgZm9yIHRoZSBzdGFydCBvZiB0aGUgY3VycmVudCBnZW5lcmF0aW9uLlxyXG4gICAgICAgICAgICB0aGlzLnN0YXJ0Q291bnRzUHJvcGVydHkudmFsdWUgPSBjdXJyZW50U3RhcnRDb3VudHM7XHJcblxyXG4gICAgICAgICAgICAvLyBTaG93IGR5bmFtaWMgY291bnRzIGZvciB0aGUgJ0N1cnJlbnRseScgc3RhdGUgb2YgdGhlIGN1cnJlbnQgZ2VuZXJhdGlvbi4gdW5saW5rIGlzIGhhbmRsZWQgYWJvdmUuXHJcbiAgICAgICAgICAgIGxpdmVCdW5ueUNvdW50c1Byb3BlcnR5LmxpbmsoIHVwZGF0ZUVuZENvdW50cyApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAvLyBTaG93IHN0YXRpYyBjb3VudHMgZm9yIGEgcHJldmlvdXMgZ2VuZXJhdGlvbi5cclxuICAgICAgICAgICAgY29uc3QgY291bnRzID0gcHJldmlvdXNDb3VudHNbIHByb3BvcnRpb25zR2VuZXJhdGlvbiBdO1xyXG4gICAgICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBjb3VudHMuZ2VuZXJhdGlvbiA9PT0gcHJvcG9ydGlvbnNHZW5lcmF0aW9uLCAndW5leHBlY3RlZCBnZW5lcmF0aW9uJyApO1xyXG4gICAgICAgICAgICB0aGlzLnN0YXJ0Q291bnRzUHJvcGVydHkudmFsdWUgPSBjb3VudHMuc3RhcnRDb3VudHM7XHJcbiAgICAgICAgICAgIHRoaXMuZW5kQ291bnRzUHJvcGVydHkudmFsdWUgPSBjb3VudHMuZW5kQ291bnRzO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgICAvLyBUaGVyZSBpcyBubyBkYXRhLCBzbyByZXNldCB0aGUgY291bnRzXHJcbiAgICAgICAgICB0aGlzLnN0YXJ0Q291bnRzUHJvcGVydHkucmVzZXQoKTtcclxuICAgICAgICAgIHRoaXMuZW5kQ291bnRzUHJvcGVydHkucmVzZXQoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSBTdHVkaW8gbGlua1xyXG4gICAgdGhpcy5hZGRMaW5rZWRFbGVtZW50KCBsaXZlQnVubnlDb3VudHNQcm9wZXJ0eSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2N1cnJlbnRDb3VudHNQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuY3VycmVudFN0YXJ0Q291bnRzUHJvcGVydHkgPSBjdXJyZW50U3RhcnRDb3VudHNQcm9wZXJ0eTtcclxuICAgIHRoaXMucHJldmlvdXNDb3VudHMgPSBwcmV2aW91c0NvdW50cztcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMudmFsdWVzVmlzaWJsZVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnByb3BvcnRpb25zR2VuZXJhdGlvblByb3BlcnR5LnJlc2V0VmFsdWVBbmRSYW5nZSgpOyAvLyBiZWNhdXNlIHdlJ3JlIHVzaW5nIHNldFZhbHVlQW5kUmFuZ2VcclxuICAgIHRoaXMuc3RhcnRDb3VudHNQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5lbmRDb3VudHNQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5jdXJyZW50U3RhcnRDb3VudHNQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5wcmV2aW91c0NvdW50cy5sZW5ndGggPSAwOyAvLyB1c2UgdGhpcyBhcHByb2FjaCBiZWNhdXNlIGl0J3MgYW4gT2JzZXJ2YWJsZUFycmF5RGVmXHJcbiAgICB0aGlzLmZ1clZpc2libGVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5lYXJzVmlzaWJsZVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnRlZXRoVmlzaWJsZVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVjb3JkcyBzdGFydCBjb3VudHMgZm9yIHRoZSBjdXJyZW50IGdlbmVyYXRpb24uXHJcbiAgICovXHJcbiAgcHVibGljIHJlY29yZFN0YXJ0Q291bnRzKCBjbG9ja0dlbmVyYXRpb246IG51bWJlciwgc3RhcnRDb3VudHM6IEJ1bm55Q291bnRzICk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggTmF0dXJhbFNlbGVjdGlvblV0aWxzLmlzTm9uTmVnYXRpdmVJbnRlZ2VyKCBjbG9ja0dlbmVyYXRpb24gKSwgJ2ludmFsaWQgY2xvY2tHZW5lcmF0aW9uJyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggY2xvY2tHZW5lcmF0aW9uID09PSB0aGlzLmNsb2NrR2VuZXJhdGlvblByb3BlcnR5LnZhbHVlLCBgJHtjbG9ja0dlbmVyYXRpb259IGlzIG5vdCB0aGUgY3VycmVudCBnZW5lcmF0aW9uYCApO1xyXG5cclxuICAgIHRoaXMuY3VycmVudFN0YXJ0Q291bnRzUHJvcGVydHkudmFsdWUgPSBzdGFydENvdW50cztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlY29yZHMgZW5kIGNvdW50cyBmb3IgdGhlIHByZXZpb3VzIGdlbmVyYXRpb24sIHVzaW5nIHdoYXQgd2FzIGZvcm1lcmx5IHRoZSBjdXJyZW50IGdlbmVyYXRpb24gc3RhcnQgZGF0YS5cclxuICAgKi9cclxuICBwdWJsaWMgcmVjb3JkRW5kQ291bnRzKCBnZW5lcmF0aW9uOiBudW1iZXIsIGVuZENvdW50czogQnVubnlDb3VudHMgKTogdm9pZCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBOYXR1cmFsU2VsZWN0aW9uVXRpbHMuaXNOb25OZWdhdGl2ZUludGVnZXIoIGdlbmVyYXRpb24gKSwgJ2ludmFsaWQgZ2VuZXJhdGlvbicgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGdlbmVyYXRpb24gPT09IHRoaXMuY2xvY2tHZW5lcmF0aW9uUHJvcGVydHkudmFsdWUgLSAxLCBgJHtnZW5lcmF0aW9ufSBpcyBub3QgdGhlIHByZXZpb3VzIGdlbmVyYXRpb25gICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLnByZXZpb3VzQ291bnRzLmxlbmd0aCA9PT0gZ2VuZXJhdGlvbixcclxuICAgICAgYHVuZXhwZWN0ZWQgZ2VuZXJhdGlvbj0ke2dlbmVyYXRpb259LCBleHBlY3RlZCAke3RoaXMucHJldmlvdXNDb3VudHMubGVuZ3RofWAgKTtcclxuXHJcbiAgICBjb25zdCBzdGFydENvdW50cyA9IHRoaXMuY3VycmVudFN0YXJ0Q291bnRzUHJvcGVydHkudmFsdWUhO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggc3RhcnRDb3VudHMgIT09IG51bGwgKTtcclxuICAgIHRoaXMucHJldmlvdXNDb3VudHMucHVzaCggbmV3IFByb3BvcnRpb25zQ291bnRzKCBnZW5lcmF0aW9uLCBzdGFydENvdW50cywgZW5kQ291bnRzICkgKTtcclxuICB9XHJcbn1cclxuXHJcbm5hdHVyYWxTZWxlY3Rpb24ucmVnaXN0ZXIoICdQcm9wb3J0aW9uc01vZGVsJywgUHJvcG9ydGlvbnNNb2RlbCApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLHFCQUFxQixNQUEyQiw4Q0FBOEM7QUFDckcsT0FBT0MsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxTQUFTLE1BQU0sa0NBQWtDO0FBQ3hELE9BQU9DLGNBQWMsTUFBTSx1Q0FBdUM7QUFDbEUsT0FBT0MsUUFBUSxNQUFNLGlDQUFpQztBQUV0RCxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLFNBQVMsTUFBNEIsdUNBQXVDO0FBRW5GLE9BQU9DLFlBQVksTUFBK0IsdUNBQXVDO0FBQ3pGLE9BQU9DLE1BQU0sTUFBTSxpQ0FBaUM7QUFDcEQsT0FBT0MsVUFBVSxNQUFNLDJDQUEyQztBQUNsRSxPQUFPQyxnQkFBZ0IsTUFBTSwyQkFBMkI7QUFDeEQsT0FBT0MscUJBQXFCLE1BQU0sNkJBQTZCO0FBQy9ELE9BQU9DLFdBQVcsTUFBTSxrQkFB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