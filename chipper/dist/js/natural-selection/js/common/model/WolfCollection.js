// Copyright 2019-2022, University of Colorado Boulder

/**
 * WolfCollection is the collection of Wolf instances, with methods for managing that collection.
 * It encapsulates WolfGroup (the PhetioGroup), hiding it from the rest of the sim.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Emitter from '../../../../axon/js/Emitter.js';
import dotRandom from '../../../../dot/js/dotRandom.js';
import Utils from '../../../../dot/js/Utils.js';
import BooleanIO from '../../../../tandem/js/types/BooleanIO.js';
import naturalSelection from '../../naturalSelection.js';
import NaturalSelectionConstants from '../NaturalSelectionConstants.js';
import NaturalSelectionQueryParameters from '../NaturalSelectionQueryParameters.js';
import NaturalSelectionUtils from '../NaturalSelectionUtils.js';
import Environment from './Environment.js';
import Wolf from './Wolf.js';
import WolfGroup from './WolfGroup.js';
// constants

// Wolves are applied at the midpoint of their clock slice.
// See https://github.com/phetsims/natural-selection/issues/110
const CLOCK_WOLVES_MIDPOINT = NaturalSelectionConstants.CLOCK_WOLVES_RANGE.getCenter();

// The minimum number of bunnies whose fur color matches their environment that must exist in order to eat them,
// unless there are no other bunnies to eat.
// See https://github.com/phetsims/natural-selection/issues/98#issuecomment-646275437
// and https://github.com/phetsims/natural-selection/issues/152
const MIN_BUNNIES = 6;

// The minimum number of wolves
const MIN_WOLVES = 5;

// The number of bunnies per wolf. Wolves are created based on the size of the bunny population.
const BUNNIES_PER_WOLF = 10;
export default class WolfCollection {
  // Wolves hunt during the 'wolves' clock slice.
  // PhetioGroup that manages Wolf instances as dynamic PhET-iO elements
  // emits when a Wolf has been created
  // emits when bunnies have been eaten, param is the generation number

  constructor(generationClock, environmentProperty, bunnyCollection, modelViewTransform, tandem) {
    this.environmentProperty = environmentProperty;
    this.bunnyCollection = bunnyCollection;
    this.enabledProperty = new BooleanProperty(false, {
      tandem: tandem.createTandem('enabledProperty')
    });
    this.isHuntingProperty = new DerivedProperty([this.enabledProperty, generationClock.timeInPercentProperty], (enabled, timeInPercent) => enabled && NaturalSelectionConstants.CLOCK_WOLVES_RANGE.contains(timeInPercent), {
      tandem: tandem.createTandem('isHuntingProperty'),
      phetioValueType: BooleanIO,
      phetioDocumentation: 'for internal PhET use only'
    });
    this.wolfGroup = new WolfGroup(modelViewTransform, {
      tandem: tandem.createTandem('wolfGroup')
    });
    this.wolfCreatedEmitter = new Emitter({
      parameters: [{
        valueType: Wolf
      }]
    });

    // When the group creates a Wolf, notify listeners. removeListener is not necessary.
    this.wolfGroup.elementCreatedEmitter.addListener(wolf => {
      this.wolfCreatedEmitter.emit(wolf);
    });
    this.bunniesEatenEmitter = new Emitter({
      parameters: [{
        valueType: 'number'
      }] // generation number
    });

    // The wolf population exists only while it's hunting. unlink is not necessary.
    this.isHuntingProperty.link(isHunting => {
      // When the isHuntingProperty changes during normal simulation use, it creates or disposes Wolf instances.
      // However, when setting PhET-iO state, isHuntingProperty and Wolf instances are restored, so executing
      // this code would result in duplicate wolves. See https://github.com/phetsims/natural-selection/issues/117
      if (!phet.joist.sim.isSettingPhetioStateProperty.value) {
        if (isHunting) {
          // Number of wolves is a function of the number of live bunnies
          const numberOfWolves = Math.max(MIN_WOLVES, Utils.roundSymmetric(this.bunnyCollection.getNumberOfLiveBunnies() / BUNNIES_PER_WOLF));
          for (let i = 0; i < numberOfWolves; i++) {
            this.wolfGroup.createNextElement();
          }
          phet.log && phet.log(`${this.wolfGroup.count} wolves were created`);
        } else {
          // Dispose of all wolves
          phet.log && phet.log(`${this.wolfGroup.count} wolves were disposed`);
          this.wolfGroup.clear();
        }
      }
    });

    // unlink is not necessary.
    generationClock.timeInPercentProperty.lazyLink((currentTimeInPercent, previousTimeInPercent) => {
      // Execute this code only when the sim is running normally, not when setting PhET-iO state.
      if (!phet.joist.sim.isSettingPhetioStateProperty.value) {
        // Eat bunnies at the midpoint of their clock slice.
        // See https://github.com/phetsims/natural-selection/issues/110
        if (this.enabledProperty.value && previousTimeInPercent < CLOCK_WOLVES_MIDPOINT && currentTimeInPercent >= CLOCK_WOLVES_MIDPOINT) {
          // Ensure that 'eat' event is always recorded at the same time in the clock cycle, regardless of what
          // the actual time is. See https://github.com/phetsims/natural-selection/issues/170.
          const timeInGenerations = generationClock.clockGenerationProperty.value + CLOCK_WOLVES_MIDPOINT;
          this.eatBunnies(timeInGenerations);
        }
      }
    });
  }
  reset() {
    this.wolfGroup.clear(); // calls dispose for all Wolf instances
    this.enabledProperty.reset();
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
  }

  /**
   * Gets the number of wolves.
   */
  get count() {
    return this.wolfGroup.countProperty.value;
  }

  /**
   * Moves all wolves.
   * @param dt - time step, in seconds
   */
  moveWolves(dt) {
    this.wolfGroup.forEach(wolf => wolf.move(dt));
  }

  /**
   * Eats some portion of the bunny population. See the 'Wolves' section of model.md at
   * https://github.com/phetsims/natural-selection/blob/master/doc/model.md#wolves
   * @param timeInGenerations - the time (in generations) at which this event should be recorded
   */
  eatBunnies(timeInGenerations) {
    assert && assert(this.enabledProperty.value, 'Wolves are not enabled');
    assert && assert(timeInGenerations >= 0, `invalid timeInGenerations: ${timeInGenerations}`);

    // Get the bunnies that are candidates for selection by environmental factors, in random order.
    const bunnies = this.bunnyCollection.getSelectionCandidates();
    const totalBunnies = bunnies.length;
    if (totalBunnies > 0) {
      // {Bunny[]} array for each phenotype
      const whiteBunnies = _.filter(bunnies, bunny => bunny.phenotype.hasWhiteFur());
      const whiteCount = whiteBunnies.length;
      const brownBunnies = _.filter(bunnies, bunny => bunny.phenotype.hasBrownFur());
      const brownCount = brownBunnies.length;
      phet.log && phet.log(`Applying wolves: ${whiteCount} white, ${brownCount} brown, environment=${this.environmentProperty.value}`);

      // Eat some of each phenotype, but eat more of the bunnies whose fur color does not match the environment.
      const percentToEat = dotRandom.nextDoubleInRange(NaturalSelectionQueryParameters.wolvesPercentToEatRange);
      phet.log && phet.log(`randomly selected ${percentToEat} from wolvesPercentToEatRange`);
      const percentToEatMatch = percentToEat;
      const percentToEatNoMatch = percentToEat * NaturalSelectionQueryParameters.wolvesEnvironmentMultiplier;

      // Eat white bunnies.
      const numberEatenWhite = eatSomeBunnies(whiteBunnies, totalBunnies, this.environmentProperty.value, Environment.ARCTIC, percentToEatMatch, percentToEatNoMatch);
      phet.log && phet.log(`${numberEatenWhite} of ${whiteCount} white bunnies were eaten by wolves`);

      // Eat brown bunnies.
      const numberEatenBrown = eatSomeBunnies(brownBunnies, totalBunnies, this.environmentProperty.value, Environment.EQUATOR, percentToEatMatch, percentToEatNoMatch);
      phet.log && phet.log(`${numberEatenBrown} of ${brownCount} brown bunnies were eaten by wolves`);

      // Notify if bunnies have been eaten.
      if (numberEatenWhite + numberEatenBrown > 0) {
        this.bunniesEatenEmitter.emit(timeInGenerations);
      }
    }
  }
}

/**
 * Eats a percentage of some set of bunnies, depending on whether their fur color matches the environment.
 * @param bunnies - a set of bunnies, all with the same phenotype
 * @param totalBunnies - the total number of live bunnies
 * @param environment - the current environment that is selected
 * @param environmentMatch - the environment that matches the set of bunnies' fur color
 * @param percentToEatMatch - the percentage of bunnies to eat if fur color matches the environment
 * @param percentToEatNoMatch - the percentage of bunnies to eat if fur color does NOT match the environment
 * @returns the number of bunnies that were eaten
 */
function eatSomeBunnies(bunnies, totalBunnies, environment, environmentMatch, percentToEatMatch, percentToEatNoMatch) {
  assert && assert(Array.isArray(bunnies), 'invalid bunnies');
  assert && assert(NaturalSelectionUtils.isNonNegativeInteger(totalBunnies), `invalid totalBunnies: ${totalBunnies}`);
  assert && assert(Environment.enumeration.includes(environment), 'invalid environment');
  assert && assert(Environment.enumeration.includes(environmentMatch), 'invalid environmentMatch');
  assert && assert(NaturalSelectionUtils.isPercent(percentToEatMatch), `invalid percentToEatMatch: ${percentToEatMatch}`);
  assert && assert(NaturalSelectionUtils.isPercent(percentToEatNoMatch), `invalid percentToEatNoMatch: ${percentToEatNoMatch}`);
  const percentToEat = environment === environmentMatch ? percentToEatMatch : percentToEatNoMatch;
  let numberToEat = 0;
  if (bunnies.length > 0 && percentToEat > 0) {
    if (environmentMatch === environment && bunnies.length < MIN_BUNNIES && totalBunnies > bunnies.length) {
      // Do nothing. The population whose fur color matches their environment is too small, and there are other bunnies to eat.

      // Get fur color names for log messages. Assumes that all bunnies have the same fur phenotype.
      const bunny0 = bunnies[0];
      const thisFurColor = bunny0.phenotype.hasBrownFur() ? 'brown' : 'white';
      const otherFurColor = bunny0.phenotype.hasBrownFur() ? 'white' : 'brown';
      phet.log && phet.log(`Wolves ignored ${thisFurColor} bunnies because their count is < ${MIN_BUNNIES} ` + `and there are ${otherFurColor} bunnies to eat`);
    } else {
      // Eat at least 1 bunny, if we've gotten this far.
      numberToEat = Math.max(1, Utils.roundSymmetric(percentToEat * bunnies.length));
      assert && assert(numberToEat <= bunnies.length, 'invalid numberToEat');
      for (let i = 0; i < numberToEat; i++) {
        bunnies[i].die();
      }
    }
  }
  return numberToEat;
}
naturalSelection.register('WolfCollection', WolfCollection);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJFbWl0dGVyIiwiZG90UmFuZG9tIiwiVXRpbHMiLCJCb29sZWFuSU8iLCJuYXR1cmFsU2VsZWN0aW9uIiwiTmF0dXJhbFNlbGVjdGlvbkNvbnN0YW50cyIsIk5hdHVyYWxTZWxlY3Rpb25RdWVyeVBhcmFtZXRlcnMiLCJOYXR1cmFsU2VsZWN0aW9uVXRpbHMiLCJFbnZpcm9ubWVudCIsIldvbGYiLCJXb2xmR3JvdXAiLCJDTE9DS19XT0xWRVNfTUlEUE9JTlQiLCJDTE9DS19XT0xWRVNfUkFOR0UiLCJnZXRDZW50ZXIiLCJNSU5fQlVOTklFUyIsIk1JTl9XT0xWRVMiLCJCVU5OSUVTX1BFUl9XT0xGIiwiV29sZkNvbGxlY3Rpb24iLCJjb25zdHJ1Y3RvciIsImdlbmVyYXRpb25DbG9jayIsImVudmlyb25tZW50UHJvcGVydHkiLCJidW5ueUNvbGxlY3Rpb24iLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJ0YW5kZW0iLCJlbmFibGVkUHJvcGVydHkiLCJjcmVhdGVUYW5kZW0iLCJpc0h1bnRpbmdQcm9wZXJ0eSIsInRpbWVJblBlcmNlbnRQcm9wZXJ0eSIsImVuYWJsZWQiLCJ0aW1lSW5QZXJjZW50IiwiY29udGFpbnMiLCJwaGV0aW9WYWx1ZVR5cGUiLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwid29sZkdyb3VwIiwid29sZkNyZWF0ZWRFbWl0dGVyIiwicGFyYW1ldGVycyIsInZhbHVlVHlwZSIsImVsZW1lbnRDcmVhdGVkRW1pdHRlciIsImFkZExpc3RlbmVyIiwid29sZiIsImVtaXQiLCJidW5uaWVzRWF0ZW5FbWl0dGVyIiwibGluayIsImlzSHVudGluZyIsInBoZXQiLCJqb2lzdCIsInNpbSIsImlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkiLCJ2YWx1ZSIsIm51bWJlck9mV29sdmVzIiwiTWF0aCIsIm1heCIsInJvdW5kU3ltbWV0cmljIiwiZ2V0TnVtYmVyT2ZMaXZlQnVubmllcyIsImkiLCJjcmVhdGVOZXh0RWxlbWVudCIsImxvZyIsImNvdW50IiwiY2xlYXIiLCJsYXp5TGluayIsImN1cnJlbnRUaW1lSW5QZXJjZW50IiwicHJldmlvdXNUaW1lSW5QZXJjZW50IiwidGltZUluR2VuZXJhdGlvbnMiLCJjbG9ja0dlbmVyYXRpb25Qcm9wZXJ0eSIsImVhdEJ1bm5pZXMiLCJyZXNldCIsImRpc3Bvc2UiLCJhc3NlcnQiLCJjb3VudFByb3BlcnR5IiwibW92ZVdvbHZlcyIsImR0IiwiZm9yRWFjaCIsIm1vdmUiLCJidW5uaWVzIiwiZ2V0U2VsZWN0aW9uQ2FuZGlkYXRlcyIsInRvdGFsQnVubmllcyIsImxlbmd0aCIsIndoaXRlQnVubmllcyIsIl8iLCJmaWx0ZXIiLCJidW5ueSIsInBoZW5vdHlwZSIsImhhc1doaXRlRnVyIiwid2hpdGVDb3VudCIsImJyb3duQnVubmllcyIsImhhc0Jyb3duRnVyIiwiYnJvd25Db3VudCIsInBlcmNlbnRUb0VhdCIsIm5leHREb3VibGVJblJhbmdlIiwid29sdmVzUGVyY2VudFRvRWF0UmFuZ2UiLCJwZXJjZW50VG9FYXRNYXRjaCIsInBlcmNlbnRUb0VhdE5vTWF0Y2giLCJ3b2x2ZXNFbnZpcm9ubWVudE11bHRpcGxpZXIiLCJudW1iZXJFYXRlbldoaXRlIiwiZWF0U29tZUJ1bm5pZXMiLCJBUkNUSUMiLCJudW1iZXJFYXRlbkJyb3duIiwiRVFVQVRPUiIsImVudmlyb25tZW50IiwiZW52aXJvbm1lbnRNYXRjaCIsIkFycmF5IiwiaXNBcnJheSIsImlzTm9uTmVnYXRpdmVJbnRlZ2VyIiwiZW51bWVyYXRpb24iLCJpbmNsdWRlcyIsImlzUGVyY2VudCIsIm51bWJlclRvRWF0IiwiYnVubnkwIiwidGhpc0Z1ckNvbG9yIiwib3RoZXJGdXJDb2xvciIsImRpZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiV29sZkNvbGxlY3Rpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogV29sZkNvbGxlY3Rpb24gaXMgdGhlIGNvbGxlY3Rpb24gb2YgV29sZiBpbnN0YW5jZXMsIHdpdGggbWV0aG9kcyBmb3IgbWFuYWdpbmcgdGhhdCBjb2xsZWN0aW9uLlxyXG4gKiBJdCBlbmNhcHN1bGF0ZXMgV29sZkdyb3VwICh0aGUgUGhldGlvR3JvdXApLCBoaWRpbmcgaXQgZnJvbSB0aGUgcmVzdCBvZiB0aGUgc2ltLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IEVtaXR0ZXIgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbWl0dGVyLmpzJztcclxuaW1wb3J0IEVudW1lcmF0aW9uUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbnVtZXJhdGlvblByb3BlcnR5LmpzJztcclxuaW1wb3J0IGRvdFJhbmRvbSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvZG90UmFuZG9tLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBCb29sZWFuSU8gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0Jvb2xlYW5JTy5qcyc7XHJcbmltcG9ydCBuYXR1cmFsU2VsZWN0aW9uIGZyb20gJy4uLy4uL25hdHVyYWxTZWxlY3Rpb24uanMnO1xyXG5pbXBvcnQgTmF0dXJhbFNlbGVjdGlvbkNvbnN0YW50cyBmcm9tICcuLi9OYXR1cmFsU2VsZWN0aW9uQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IE5hdHVyYWxTZWxlY3Rpb25RdWVyeVBhcmFtZXRlcnMgZnJvbSAnLi4vTmF0dXJhbFNlbGVjdGlvblF1ZXJ5UGFyYW1ldGVycy5qcyc7XHJcbmltcG9ydCBOYXR1cmFsU2VsZWN0aW9uVXRpbHMgZnJvbSAnLi4vTmF0dXJhbFNlbGVjdGlvblV0aWxzLmpzJztcclxuaW1wb3J0IEJ1bm55Q29sbGVjdGlvbiBmcm9tICcuL0J1bm55Q29sbGVjdGlvbi5qcyc7XHJcbmltcG9ydCBFbnZpcm9ubWVudCBmcm9tICcuL0Vudmlyb25tZW50LmpzJztcclxuaW1wb3J0IEVudmlyb25tZW50TW9kZWxWaWV3VHJhbnNmb3JtIGZyb20gJy4vRW52aXJvbm1lbnRNb2RlbFZpZXdUcmFuc2Zvcm0uanMnO1xyXG5pbXBvcnQgR2VuZXJhdGlvbkNsb2NrIGZyb20gJy4vR2VuZXJhdGlvbkNsb2NrLmpzJztcclxuaW1wb3J0IFdvbGYgZnJvbSAnLi9Xb2xmLmpzJztcclxuaW1wb3J0IFdvbGZHcm91cCBmcm9tICcuL1dvbGZHcm91cC5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQnVubnkgZnJvbSAnLi9CdW5ueS5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuXHJcbi8vIFdvbHZlcyBhcmUgYXBwbGllZCBhdCB0aGUgbWlkcG9pbnQgb2YgdGhlaXIgY2xvY2sgc2xpY2UuXHJcbi8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbmF0dXJhbC1zZWxlY3Rpb24vaXNzdWVzLzExMFxyXG5jb25zdCBDTE9DS19XT0xWRVNfTUlEUE9JTlQgPSBOYXR1cmFsU2VsZWN0aW9uQ29uc3RhbnRzLkNMT0NLX1dPTFZFU19SQU5HRS5nZXRDZW50ZXIoKTtcclxuXHJcbi8vIFRoZSBtaW5pbXVtIG51bWJlciBvZiBidW5uaWVzIHdob3NlIGZ1ciBjb2xvciBtYXRjaGVzIHRoZWlyIGVudmlyb25tZW50IHRoYXQgbXVzdCBleGlzdCBpbiBvcmRlciB0byBlYXQgdGhlbSxcclxuLy8gdW5sZXNzIHRoZXJlIGFyZSBubyBvdGhlciBidW5uaWVzIHRvIGVhdC5cclxuLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9uYXR1cmFsLXNlbGVjdGlvbi9pc3N1ZXMvOTgjaXNzdWVjb21tZW50LTY0NjI3NTQzN1xyXG4vLyBhbmQgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL25hdHVyYWwtc2VsZWN0aW9uL2lzc3Vlcy8xNTJcclxuY29uc3QgTUlOX0JVTk5JRVMgPSA2O1xyXG5cclxuLy8gVGhlIG1pbmltdW0gbnVtYmVyIG9mIHdvbHZlc1xyXG5jb25zdCBNSU5fV09MVkVTID0gNTtcclxuXHJcbi8vIFRoZSBudW1iZXIgb2YgYnVubmllcyBwZXIgd29sZi4gV29sdmVzIGFyZSBjcmVhdGVkIGJhc2VkIG9uIHRoZSBzaXplIG9mIHRoZSBidW5ueSBwb3B1bGF0aW9uLlxyXG5jb25zdCBCVU5OSUVTX1BFUl9XT0xGID0gMTA7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXb2xmQ29sbGVjdGlvbiB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgZW52aXJvbm1lbnRQcm9wZXJ0eTogRW51bWVyYXRpb25Qcm9wZXJ0eTxFbnZpcm9ubWVudD47XHJcbiAgcHJpdmF0ZSByZWFkb25seSBidW5ueUNvbGxlY3Rpb246IEJ1bm55Q29sbGVjdGlvbjtcclxuICBwdWJsaWMgcmVhZG9ubHkgZW5hYmxlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IGlzSHVudGluZ1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPjsgLy8gV29sdmVzIGh1bnQgZHVyaW5nIHRoZSAnd29sdmVzJyBjbG9jayBzbGljZS5cclxuICBwcml2YXRlIHJlYWRvbmx5IHdvbGZHcm91cDogV29sZkdyb3VwOyAvLyBQaGV0aW9Hcm91cCB0aGF0IG1hbmFnZXMgV29sZiBpbnN0YW5jZXMgYXMgZHluYW1pYyBQaEVULWlPIGVsZW1lbnRzXHJcbiAgcHVibGljIHJlYWRvbmx5IHdvbGZDcmVhdGVkRW1pdHRlcjogRW1pdHRlcjxbV29sZl0+OyAvLyBlbWl0cyB3aGVuIGEgV29sZiBoYXMgYmVlbiBjcmVhdGVkXHJcbiAgcHVibGljIHJlYWRvbmx5IGJ1bm5pZXNFYXRlbkVtaXR0ZXI6IEVtaXR0ZXI8W251bWJlcl0+OyAvLyBlbWl0cyB3aGVuIGJ1bm5pZXMgaGF2ZSBiZWVuIGVhdGVuLCBwYXJhbSBpcyB0aGUgZ2VuZXJhdGlvbiBudW1iZXJcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBnZW5lcmF0aW9uQ2xvY2s6IEdlbmVyYXRpb25DbG9jaywgZW52aXJvbm1lbnRQcm9wZXJ0eTogRW51bWVyYXRpb25Qcm9wZXJ0eTxFbnZpcm9ubWVudD4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBidW5ueUNvbGxlY3Rpb246IEJ1bm55Q29sbGVjdGlvbiwgbW9kZWxWaWV3VHJhbnNmb3JtOiBFbnZpcm9ubWVudE1vZGVsVmlld1RyYW5zZm9ybSxcclxuICAgICAgICAgICAgICAgICAgICAgIHRhbmRlbTogVGFuZGVtICkge1xyXG5cclxuICAgIHRoaXMuZW52aXJvbm1lbnRQcm9wZXJ0eSA9IGVudmlyb25tZW50UHJvcGVydHk7XHJcbiAgICB0aGlzLmJ1bm55Q29sbGVjdGlvbiA9IGJ1bm55Q29sbGVjdGlvbjtcclxuXHJcbiAgICB0aGlzLmVuYWJsZWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2VuYWJsZWRQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuaXNIdW50aW5nUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgICBbIHRoaXMuZW5hYmxlZFByb3BlcnR5LCBnZW5lcmF0aW9uQ2xvY2sudGltZUluUGVyY2VudFByb3BlcnR5IF0sXHJcbiAgICAgICggZW5hYmxlZCwgdGltZUluUGVyY2VudCApID0+ICggZW5hYmxlZCAmJiBOYXR1cmFsU2VsZWN0aW9uQ29uc3RhbnRzLkNMT0NLX1dPTFZFU19SQU5HRS5jb250YWlucyggdGltZUluUGVyY2VudCApICksIHtcclxuICAgICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdpc0h1bnRpbmdQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9WYWx1ZVR5cGU6IEJvb2xlYW5JTyxcclxuICAgICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnZm9yIGludGVybmFsIFBoRVQgdXNlIG9ubHknXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLndvbGZHcm91cCA9IG5ldyBXb2xmR3JvdXAoIG1vZGVsVmlld1RyYW5zZm9ybSwge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd3b2xmR3JvdXAnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLndvbGZDcmVhdGVkRW1pdHRlciA9IG5ldyBFbWl0dGVyKCB7XHJcbiAgICAgIHBhcmFtZXRlcnM6IFsgeyB2YWx1ZVR5cGU6IFdvbGYgfSBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gV2hlbiB0aGUgZ3JvdXAgY3JlYXRlcyBhIFdvbGYsIG5vdGlmeSBsaXN0ZW5lcnMuIHJlbW92ZUxpc3RlbmVyIGlzIG5vdCBuZWNlc3NhcnkuXHJcbiAgICB0aGlzLndvbGZHcm91cC5lbGVtZW50Q3JlYXRlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIHdvbGYgPT4ge1xyXG4gICAgICB0aGlzLndvbGZDcmVhdGVkRW1pdHRlci5lbWl0KCB3b2xmICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5idW5uaWVzRWF0ZW5FbWl0dGVyID0gbmV3IEVtaXR0ZXIoIHtcclxuICAgICAgcGFyYW1ldGVyczogWyB7IHZhbHVlVHlwZTogJ251bWJlcicgfSBdIC8vIGdlbmVyYXRpb24gbnVtYmVyXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gVGhlIHdvbGYgcG9wdWxhdGlvbiBleGlzdHMgb25seSB3aGlsZSBpdCdzIGh1bnRpbmcuIHVubGluayBpcyBub3QgbmVjZXNzYXJ5LlxyXG4gICAgdGhpcy5pc0h1bnRpbmdQcm9wZXJ0eS5saW5rKCBpc0h1bnRpbmcgPT4ge1xyXG5cclxuICAgICAgLy8gV2hlbiB0aGUgaXNIdW50aW5nUHJvcGVydHkgY2hhbmdlcyBkdXJpbmcgbm9ybWFsIHNpbXVsYXRpb24gdXNlLCBpdCBjcmVhdGVzIG9yIGRpc3Bvc2VzIFdvbGYgaW5zdGFuY2VzLlxyXG4gICAgICAvLyBIb3dldmVyLCB3aGVuIHNldHRpbmcgUGhFVC1pTyBzdGF0ZSwgaXNIdW50aW5nUHJvcGVydHkgYW5kIFdvbGYgaW5zdGFuY2VzIGFyZSByZXN0b3JlZCwgc28gZXhlY3V0aW5nXHJcbiAgICAgIC8vIHRoaXMgY29kZSB3b3VsZCByZXN1bHQgaW4gZHVwbGljYXRlIHdvbHZlcy4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9uYXR1cmFsLXNlbGVjdGlvbi9pc3N1ZXMvMTE3XHJcbiAgICAgIGlmICggIXBoZXQuam9pc3Quc2ltLmlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkudmFsdWUgKSB7XHJcblxyXG4gICAgICAgIGlmICggaXNIdW50aW5nICkge1xyXG5cclxuICAgICAgICAgIC8vIE51bWJlciBvZiB3b2x2ZXMgaXMgYSBmdW5jdGlvbiBvZiB0aGUgbnVtYmVyIG9mIGxpdmUgYnVubmllc1xyXG4gICAgICAgICAgY29uc3QgbnVtYmVyT2ZXb2x2ZXMgPSBNYXRoLm1heCggTUlOX1dPTFZFUyxcclxuICAgICAgICAgICAgVXRpbHMucm91bmRTeW1tZXRyaWMoIHRoaXMuYnVubnlDb2xsZWN0aW9uLmdldE51bWJlck9mTGl2ZUJ1bm5pZXMoKSAvIEJVTk5JRVNfUEVSX1dPTEYgKSApO1xyXG4gICAgICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZXb2x2ZXM7IGkrKyApIHtcclxuICAgICAgICAgICAgdGhpcy53b2xmR3JvdXAuY3JlYXRlTmV4dEVsZW1lbnQoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHBoZXQubG9nICYmIHBoZXQubG9nKCBgJHt0aGlzLndvbGZHcm91cC5jb3VudH0gd29sdmVzIHdlcmUgY3JlYXRlZGAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgICAgLy8gRGlzcG9zZSBvZiBhbGwgd29sdmVzXHJcbiAgICAgICAgICBwaGV0LmxvZyAmJiBwaGV0LmxvZyggYCR7dGhpcy53b2xmR3JvdXAuY291bnR9IHdvbHZlcyB3ZXJlIGRpc3Bvc2VkYCApO1xyXG4gICAgICAgICAgdGhpcy53b2xmR3JvdXAuY2xlYXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB1bmxpbmsgaXMgbm90IG5lY2Vzc2FyeS5cclxuICAgIGdlbmVyYXRpb25DbG9jay50aW1lSW5QZXJjZW50UHJvcGVydHkubGF6eUxpbmsoICggY3VycmVudFRpbWVJblBlcmNlbnQsIHByZXZpb3VzVGltZUluUGVyY2VudCApID0+IHtcclxuXHJcbiAgICAgIC8vIEV4ZWN1dGUgdGhpcyBjb2RlIG9ubHkgd2hlbiB0aGUgc2ltIGlzIHJ1bm5pbmcgbm9ybWFsbHksIG5vdCB3aGVuIHNldHRpbmcgUGhFVC1pTyBzdGF0ZS5cclxuICAgICAgaWYgKCAhcGhldC5qb2lzdC5zaW0uaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eS52YWx1ZSApIHtcclxuXHJcbiAgICAgICAgLy8gRWF0IGJ1bm5pZXMgYXQgdGhlIG1pZHBvaW50IG9mIHRoZWlyIGNsb2NrIHNsaWNlLlxyXG4gICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbmF0dXJhbC1zZWxlY3Rpb24vaXNzdWVzLzExMFxyXG4gICAgICAgIGlmICggdGhpcy5lbmFibGVkUHJvcGVydHkudmFsdWUgJiZcclxuICAgICAgICAgICAgIHByZXZpb3VzVGltZUluUGVyY2VudCA8IENMT0NLX1dPTFZFU19NSURQT0lOVCAmJiBjdXJyZW50VGltZUluUGVyY2VudCA+PSBDTE9DS19XT0xWRVNfTUlEUE9JTlQgKSB7XHJcblxyXG4gICAgICAgICAgLy8gRW5zdXJlIHRoYXQgJ2VhdCcgZXZlbnQgaXMgYWx3YXlzIHJlY29yZGVkIGF0IHRoZSBzYW1lIHRpbWUgaW4gdGhlIGNsb2NrIGN5Y2xlLCByZWdhcmRsZXNzIG9mIHdoYXRcclxuICAgICAgICAgIC8vIHRoZSBhY3R1YWwgdGltZSBpcy4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9uYXR1cmFsLXNlbGVjdGlvbi9pc3N1ZXMvMTcwLlxyXG4gICAgICAgICAgY29uc3QgdGltZUluR2VuZXJhdGlvbnMgPSBnZW5lcmF0aW9uQ2xvY2suY2xvY2tHZW5lcmF0aW9uUHJvcGVydHkudmFsdWUgKyBDTE9DS19XT0xWRVNfTUlEUE9JTlQ7XHJcbiAgICAgICAgICB0aGlzLmVhdEJ1bm5pZXMoIHRpbWVJbkdlbmVyYXRpb25zICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLndvbGZHcm91cC5jbGVhcigpOyAvLyBjYWxscyBkaXNwb3NlIGZvciBhbGwgV29sZiBpbnN0YW5jZXNcclxuICAgIHRoaXMuZW5hYmxlZFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyB0aGUgbnVtYmVyIG9mIHdvbHZlcy5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGNvdW50KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy53b2xmR3JvdXAuY291bnRQcm9wZXJ0eS52YWx1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1vdmVzIGFsbCB3b2x2ZXMuXHJcbiAgICogQHBhcmFtIGR0IC0gdGltZSBzdGVwLCBpbiBzZWNvbmRzXHJcbiAgICovXHJcbiAgcHVibGljIG1vdmVXb2x2ZXMoIGR0OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICB0aGlzLndvbGZHcm91cC5mb3JFYWNoKCB3b2xmID0+IHdvbGYubW92ZSggZHQgKSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRWF0cyBzb21lIHBvcnRpb24gb2YgdGhlIGJ1bm55IHBvcHVsYXRpb24uIFNlZSB0aGUgJ1dvbHZlcycgc2VjdGlvbiBvZiBtb2RlbC5tZCBhdFxyXG4gICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9uYXR1cmFsLXNlbGVjdGlvbi9ibG9iL21hc3Rlci9kb2MvbW9kZWwubWQjd29sdmVzXHJcbiAgICogQHBhcmFtIHRpbWVJbkdlbmVyYXRpb25zIC0gdGhlIHRpbWUgKGluIGdlbmVyYXRpb25zKSBhdCB3aGljaCB0aGlzIGV2ZW50IHNob3VsZCBiZSByZWNvcmRlZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgZWF0QnVubmllcyggdGltZUluR2VuZXJhdGlvbnM6IG51bWJlciApOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuZW5hYmxlZFByb3BlcnR5LnZhbHVlLCAnV29sdmVzIGFyZSBub3QgZW5hYmxlZCcgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRpbWVJbkdlbmVyYXRpb25zID49IDAsIGBpbnZhbGlkIHRpbWVJbkdlbmVyYXRpb25zOiAke3RpbWVJbkdlbmVyYXRpb25zfWAgKTtcclxuXHJcbiAgICAvLyBHZXQgdGhlIGJ1bm5pZXMgdGhhdCBhcmUgY2FuZGlkYXRlcyBmb3Igc2VsZWN0aW9uIGJ5IGVudmlyb25tZW50YWwgZmFjdG9ycywgaW4gcmFuZG9tIG9yZGVyLlxyXG4gICAgY29uc3QgYnVubmllcyA9IHRoaXMuYnVubnlDb2xsZWN0aW9uLmdldFNlbGVjdGlvbkNhbmRpZGF0ZXMoKTtcclxuICAgIGNvbnN0IHRvdGFsQnVubmllcyA9IGJ1bm5pZXMubGVuZ3RoO1xyXG5cclxuICAgIGlmICggdG90YWxCdW5uaWVzID4gMCApIHtcclxuXHJcbiAgICAgIC8vIHtCdW5ueVtdfSBhcnJheSBmb3IgZWFjaCBwaGVub3R5cGVcclxuICAgICAgY29uc3Qgd2hpdGVCdW5uaWVzID0gXy5maWx0ZXIoIGJ1bm5pZXMsIGJ1bm55ID0+IGJ1bm55LnBoZW5vdHlwZS5oYXNXaGl0ZUZ1cigpICk7XHJcbiAgICAgIGNvbnN0IHdoaXRlQ291bnQgPSB3aGl0ZUJ1bm5pZXMubGVuZ3RoO1xyXG4gICAgICBjb25zdCBicm93bkJ1bm5pZXMgPSBfLmZpbHRlciggYnVubmllcywgYnVubnkgPT4gYnVubnkucGhlbm90eXBlLmhhc0Jyb3duRnVyKCkgKTtcclxuICAgICAgY29uc3QgYnJvd25Db3VudCA9IGJyb3duQnVubmllcy5sZW5ndGg7XHJcbiAgICAgIHBoZXQubG9nICYmIHBoZXQubG9nKCBgQXBwbHlpbmcgd29sdmVzOiAke3doaXRlQ291bnR9IHdoaXRlLCAke2Jyb3duQ291bnR9IGJyb3duLCBlbnZpcm9ubWVudD0ke3RoaXMuZW52aXJvbm1lbnRQcm9wZXJ0eS52YWx1ZX1gICk7XHJcblxyXG4gICAgICAvLyBFYXQgc29tZSBvZiBlYWNoIHBoZW5vdHlwZSwgYnV0IGVhdCBtb3JlIG9mIHRoZSBidW5uaWVzIHdob3NlIGZ1ciBjb2xvciBkb2VzIG5vdCBtYXRjaCB0aGUgZW52aXJvbm1lbnQuXHJcbiAgICAgIGNvbnN0IHBlcmNlbnRUb0VhdCA9IGRvdFJhbmRvbS5uZXh0RG91YmxlSW5SYW5nZSggTmF0dXJhbFNlbGVjdGlvblF1ZXJ5UGFyYW1ldGVycy53b2x2ZXNQZXJjZW50VG9FYXRSYW5nZSApO1xyXG4gICAgICBwaGV0LmxvZyAmJiBwaGV0LmxvZyggYHJhbmRvbWx5IHNlbGVjdGVkICR7cGVyY2VudFRvRWF0fSBmcm9tIHdvbHZlc1BlcmNlbnRUb0VhdFJhbmdlYCApO1xyXG4gICAgICBjb25zdCBwZXJjZW50VG9FYXRNYXRjaCA9IHBlcmNlbnRUb0VhdDtcclxuICAgICAgY29uc3QgcGVyY2VudFRvRWF0Tm9NYXRjaCA9IHBlcmNlbnRUb0VhdCAqIE5hdHVyYWxTZWxlY3Rpb25RdWVyeVBhcmFtZXRlcnMud29sdmVzRW52aXJvbm1lbnRNdWx0aXBsaWVyO1xyXG5cclxuICAgICAgLy8gRWF0IHdoaXRlIGJ1bm5pZXMuXHJcbiAgICAgIGNvbnN0IG51bWJlckVhdGVuV2hpdGUgPSBlYXRTb21lQnVubmllcyggd2hpdGVCdW5uaWVzLCB0b3RhbEJ1bm5pZXMsXHJcbiAgICAgICAgdGhpcy5lbnZpcm9ubWVudFByb3BlcnR5LnZhbHVlLCBFbnZpcm9ubWVudC5BUkNUSUMsIHBlcmNlbnRUb0VhdE1hdGNoLCBwZXJjZW50VG9FYXROb01hdGNoICk7XHJcbiAgICAgIHBoZXQubG9nICYmIHBoZXQubG9nKCBgJHtudW1iZXJFYXRlbldoaXRlfSBvZiAke3doaXRlQ291bnR9IHdoaXRlIGJ1bm5pZXMgd2VyZSBlYXRlbiBieSB3b2x2ZXNgICk7XHJcblxyXG4gICAgICAvLyBFYXQgYnJvd24gYnVubmllcy5cclxuICAgICAgY29uc3QgbnVtYmVyRWF0ZW5Ccm93biA9IGVhdFNvbWVCdW5uaWVzKCBicm93bkJ1bm5pZXMsIHRvdGFsQnVubmllcyxcclxuICAgICAgICB0aGlzLmVudmlyb25tZW50UHJvcGVydHkudmFsdWUsIEVudmlyb25tZW50LkVRVUFUT1IsIHBlcmNlbnRUb0VhdE1hdGNoLCBwZXJjZW50VG9FYXROb01hdGNoICk7XHJcbiAgICAgIHBoZXQubG9nICYmIHBoZXQubG9nKCBgJHtudW1iZXJFYXRlbkJyb3dufSBvZiAke2Jyb3duQ291bnR9IGJyb3duIGJ1bm5pZXMgd2VyZSBlYXRlbiBieSB3b2x2ZXNgICk7XHJcblxyXG4gICAgICAvLyBOb3RpZnkgaWYgYnVubmllcyBoYXZlIGJlZW4gZWF0ZW4uXHJcbiAgICAgIGlmICggbnVtYmVyRWF0ZW5XaGl0ZSArIG51bWJlckVhdGVuQnJvd24gPiAwICkge1xyXG4gICAgICAgIHRoaXMuYnVubmllc0VhdGVuRW1pdHRlci5lbWl0KCB0aW1lSW5HZW5lcmF0aW9ucyApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogRWF0cyBhIHBlcmNlbnRhZ2Ugb2Ygc29tZSBzZXQgb2YgYnVubmllcywgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlaXIgZnVyIGNvbG9yIG1hdGNoZXMgdGhlIGVudmlyb25tZW50LlxyXG4gKiBAcGFyYW0gYnVubmllcyAtIGEgc2V0IG9mIGJ1bm5pZXMsIGFsbCB3aXRoIHRoZSBzYW1lIHBoZW5vdHlwZVxyXG4gKiBAcGFyYW0gdG90YWxCdW5uaWVzIC0gdGhlIHRvdGFsIG51bWJlciBvZiBsaXZlIGJ1bm5pZXNcclxuICogQHBhcmFtIGVudmlyb25tZW50IC0gdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQgdGhhdCBpcyBzZWxlY3RlZFxyXG4gKiBAcGFyYW0gZW52aXJvbm1lbnRNYXRjaCAtIHRoZSBlbnZpcm9ubWVudCB0aGF0IG1hdGNoZXMgdGhlIHNldCBvZiBidW5uaWVzJyBmdXIgY29sb3JcclxuICogQHBhcmFtIHBlcmNlbnRUb0VhdE1hdGNoIC0gdGhlIHBlcmNlbnRhZ2Ugb2YgYnVubmllcyB0byBlYXQgaWYgZnVyIGNvbG9yIG1hdGNoZXMgdGhlIGVudmlyb25tZW50XHJcbiAqIEBwYXJhbSBwZXJjZW50VG9FYXROb01hdGNoIC0gdGhlIHBlcmNlbnRhZ2Ugb2YgYnVubmllcyB0byBlYXQgaWYgZnVyIGNvbG9yIGRvZXMgTk9UIG1hdGNoIHRoZSBlbnZpcm9ubWVudFxyXG4gKiBAcmV0dXJucyB0aGUgbnVtYmVyIG9mIGJ1bm5pZXMgdGhhdCB3ZXJlIGVhdGVuXHJcbiAqL1xyXG5mdW5jdGlvbiBlYXRTb21lQnVubmllcyggYnVubmllczogQnVubnlbXSwgdG90YWxCdW5uaWVzOiBudW1iZXIsIGVudmlyb25tZW50OiBFbnZpcm9ubWVudCwgZW52aXJvbm1lbnRNYXRjaDogRW52aXJvbm1lbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50VG9FYXRNYXRjaDogbnVtYmVyLCBwZXJjZW50VG9FYXROb01hdGNoOiBudW1iZXIgKTogbnVtYmVyIHtcclxuXHJcbiAgYXNzZXJ0ICYmIGFzc2VydCggQXJyYXkuaXNBcnJheSggYnVubmllcyApLCAnaW52YWxpZCBidW5uaWVzJyApO1xyXG4gIGFzc2VydCAmJiBhc3NlcnQoIE5hdHVyYWxTZWxlY3Rpb25VdGlscy5pc05vbk5lZ2F0aXZlSW50ZWdlciggdG90YWxCdW5uaWVzICksIGBpbnZhbGlkIHRvdGFsQnVubmllczogJHt0b3RhbEJ1bm5pZXN9YCApO1xyXG4gIGFzc2VydCAmJiBhc3NlcnQoIEVudmlyb25tZW50LmVudW1lcmF0aW9uLmluY2x1ZGVzKCBlbnZpcm9ubWVudCApLCAnaW52YWxpZCBlbnZpcm9ubWVudCcgKTtcclxuICBhc3NlcnQgJiYgYXNzZXJ0KCBFbnZpcm9ubWVudC5lbnVtZXJhdGlvbi5pbmNsdWRlcyggZW52aXJvbm1lbnRNYXRjaCApLCAnaW52YWxpZCBlbnZpcm9ubWVudE1hdGNoJyApO1xyXG4gIGFzc2VydCAmJiBhc3NlcnQoIE5hdHVyYWxTZWxlY3Rpb25VdGlscy5pc1BlcmNlbnQoIHBlcmNlbnRUb0VhdE1hdGNoICksIGBpbnZhbGlkIHBlcmNlbnRUb0VhdE1hdGNoOiAke3BlcmNlbnRUb0VhdE1hdGNofWAgKTtcclxuICBhc3NlcnQgJiYgYXNzZXJ0KCBOYXR1cmFsU2VsZWN0aW9uVXRpbHMuaXNQZXJjZW50KCBwZXJjZW50VG9FYXROb01hdGNoICksIGBpbnZhbGlkIHBlcmNlbnRUb0VhdE5vTWF0Y2g6ICR7cGVyY2VudFRvRWF0Tm9NYXRjaH1gICk7XHJcblxyXG4gIGNvbnN0IHBlcmNlbnRUb0VhdCA9ICggZW52aXJvbm1lbnQgPT09IGVudmlyb25tZW50TWF0Y2ggKSA/IHBlcmNlbnRUb0VhdE1hdGNoIDogcGVyY2VudFRvRWF0Tm9NYXRjaDtcclxuICBsZXQgbnVtYmVyVG9FYXQgPSAwO1xyXG5cclxuICBpZiAoIGJ1bm5pZXMubGVuZ3RoID4gMCAmJiBwZXJjZW50VG9FYXQgPiAwICkge1xyXG5cclxuICAgIGlmICggKCBlbnZpcm9ubWVudE1hdGNoID09PSBlbnZpcm9ubWVudCApICYmICggYnVubmllcy5sZW5ndGggPCBNSU5fQlVOTklFUyApICYmICggdG90YWxCdW5uaWVzID4gYnVubmllcy5sZW5ndGggKSApIHtcclxuXHJcbiAgICAgIC8vIERvIG5vdGhpbmcuIFRoZSBwb3B1bGF0aW9uIHdob3NlIGZ1ciBjb2xvciBtYXRjaGVzIHRoZWlyIGVudmlyb25tZW50IGlzIHRvbyBzbWFsbCwgYW5kIHRoZXJlIGFyZSBvdGhlciBidW5uaWVzIHRvIGVhdC5cclxuXHJcbiAgICAgIC8vIEdldCBmdXIgY29sb3IgbmFtZXMgZm9yIGxvZyBtZXNzYWdlcy4gQXNzdW1lcyB0aGF0IGFsbCBidW5uaWVzIGhhdmUgdGhlIHNhbWUgZnVyIHBoZW5vdHlwZS5cclxuICAgICAgY29uc3QgYnVubnkwID0gYnVubmllc1sgMCBdO1xyXG4gICAgICBjb25zdCB0aGlzRnVyQ29sb3IgPSBidW5ueTAucGhlbm90eXBlLmhhc0Jyb3duRnVyKCkgPyAnYnJvd24nIDogJ3doaXRlJztcclxuICAgICAgY29uc3Qgb3RoZXJGdXJDb2xvciA9IGJ1bm55MC5waGVub3R5cGUuaGFzQnJvd25GdXIoKSA/ICd3aGl0ZScgOiAnYnJvd24nO1xyXG4gICAgICBwaGV0LmxvZyAmJiBwaGV0LmxvZyggYFdvbHZlcyBpZ25vcmVkICR7dGhpc0Z1ckNvbG9yfSBidW5uaWVzIGJlY2F1c2UgdGhlaXIgY291bnQgaXMgPCAke01JTl9CVU5OSUVTfSBgICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBhbmQgdGhlcmUgYXJlICR7b3RoZXJGdXJDb2xvcn0gYnVubmllcyB0byBlYXRgICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuXHJcbiAgICAgIC8vIEVhdCBhdCBsZWFzdCAxIGJ1bm55LCBpZiB3ZSd2ZSBnb3R0ZW4gdGhpcyBmYXIuXHJcbiAgICAgIG51bWJlclRvRWF0ID0gTWF0aC5tYXgoIDEsIFV0aWxzLnJvdW5kU3ltbWV0cmljKCBwZXJjZW50VG9FYXQgKiBidW5uaWVzLmxlbmd0aCApICk7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIG51bWJlclRvRWF0IDw9IGJ1bm5pZXMubGVuZ3RoLCAnaW52YWxpZCBudW1iZXJUb0VhdCcgKTtcclxuICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgbnVtYmVyVG9FYXQ7IGkrKyApIHtcclxuICAgICAgICBidW5uaWVzWyBpIF0uZGllKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBudW1iZXJUb0VhdDtcclxufVxyXG5cclxubmF0dXJhbFNlbGVjdGlvbi5yZWdpc3RlciggJ1dvbGZDb2xsZWN0aW9uJywgV29sZkNvbGxlY3Rpb24gKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsT0FBTyxNQUFNLGdDQUFnQztBQUVwRCxPQUFPQyxTQUFTLE1BQU0saUNBQWlDO0FBQ3ZELE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsU0FBUyxNQUFNLDBDQUEwQztBQUNoRSxPQUFPQyxnQkFBZ0IsTUFBTSwyQkFBMkI7QUFDeEQsT0FBT0MseUJBQXlCLE1BQU0saUNBQWlD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