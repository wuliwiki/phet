// Copyright 2019-2022, University of Colorado Boulder

/**
 * DataProbe is the model for the data probe on the Population graph. It shows population (y-axis) values at a specific
 * generation (x-axis) value on the graph.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import Vector2Property from '../../../../dot/js/Vector2Property.js';
import optionize from '../../../../phet-core/js/optionize.js';
import PhetioObject from '../../../../tandem/js/PhetioObject.js';
import NullableIO from '../../../../tandem/js/types/NullableIO.js';
import NumberIO from '../../../../tandem/js/types/NumberIO.js';
import naturalSelection from '../../naturalSelection.js';
import BunnyCounts from './BunnyCounts.js';
export default class DataProbe extends PhetioObject {
  // the initial offset, as requested in https://github.com/phetsims/natural-selection/issues/173
  // While we only need x (generations) offset, DragListener requires a {Property.<Vector2>}, and y offset will
  // be constrained to 0.
  // Named dataProbeGenerationProperty to distinguish it from the other 'generation' Properties in this sim.
  // See https://github.com/phetsims/natural-selection/issues/187
  // BunnyCounts at the position of the data probe
  // visibility of the data probe
  constructor(populationModel, providedOptions) {
    const options = optionize()({
      // PhetioObjectOptions
      phetioState: false // to prevent serialization, because we don't have an IO Type
    }, providedOptions);
    super(options);
    this.populationModel = populationModel;
    this.offsetProperty = new Vector2Property(new Vector2(1.5, 0), {
      tandem: options.tandem.createTandem('offsetProperty'),
      phetioDocumentation: 'offset of the data probe from the left edge of the graph'
    });
    this.dataProbeGenerationProperty = new DerivedProperty([populationModel.xRangeProperty, this.offsetProperty], (xRange, offset) => xRange.min + offset.x, {
      tandem: options.tandem.createTandem('dataProbeGenerationProperty'),
      phetioValueType: NumberIO,
      phetioDocumentation: 'the generation (x-axis) value where the data probe is positioned (decimal)'
    });
    this.countsProperty = new DerivedProperty([this.dataProbeGenerationProperty, populationModel.timeInGenerationsProperty], (dataProbeGeneration, timeInGenerations) => this.getCounts(dataProbeGeneration, timeInGenerations), {
      tandem: options.tandem.createTandem('countsProperty'),
      phetioValueType: NullableIO(BunnyCounts.BunnyCountsIO),
      phetioDocumentation: 'counts displayed by the data probe'
    });
    this.visibleProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('visibleProperty')
    });
  }
  reset() {
    this.offsetProperty.reset();
    this.visibleProperty.reset();
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }

  /**
   * Gets the bunny counts for a specific generation value.
   * @param dataProbeGeneration - current position of the data probe on the x-axis
   * @param timeInGenerations - current time on the generation clock, in generations
   * @returns null if there are no counts at the probe's position
   */
  getCounts(dataProbeGeneration, timeInGenerations) {
    let counts = null;
    if (dataProbeGeneration <= timeInGenerations && timeInGenerations > 0) {
      counts = new BunnyCounts({
        totalCount: this.getCount(dataProbeGeneration, this.populationModel.totalPoints),
        whiteFurCount: this.getCount(dataProbeGeneration, this.populationModel.whiteFurPoints),
        brownFurCount: this.getCount(dataProbeGeneration, this.populationModel.brownFurPoints),
        straightEarsCount: this.getCount(dataProbeGeneration, this.populationModel.straightEarsPoints),
        floppyEarsCount: this.getCount(dataProbeGeneration, this.populationModel.floppyEarsPoints),
        shortTeethCount: this.getCount(dataProbeGeneration, this.populationModel.shortTeethPoints),
        longTeethCount: this.getCount(dataProbeGeneration, this.populationModel.longTeethPoints)
      });
    }
    return counts;
  }

  /**
   * Gets the population count (y value) for a specific generation (x value).
   * @param dataProbeGeneration - current position of the data probe on the x-axis
   * @param points - data points, x (generation) and y (population)
   */
  getCount(dataProbeGeneration, points) {
    let count = 0;

    // Optimize for scrolling graph. Start with most recent points and work backwards in time.
    for (let i = points.length - 1; i >= 0; i--) {
      const point = points[i];
      if (dataProbeGeneration >= point.x) {
        count = point.y;
        break;
      }
    }
    return count;
  }
}
naturalSelection.register('DataProbe', DataProbe);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJWZWN0b3IyIiwiVmVjdG9yMlByb3BlcnR5Iiwib3B0aW9uaXplIiwiUGhldGlvT2JqZWN0IiwiTnVsbGFibGVJTyIsIk51bWJlcklPIiwibmF0dXJhbFNlbGVjdGlvbiIsIkJ1bm55Q291bnRzIiwiRGF0YVByb2JlIiwiY29uc3RydWN0b3IiLCJwb3B1bGF0aW9uTW9kZWwiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwicGhldGlvU3RhdGUiLCJvZmZzZXRQcm9wZXJ0eSIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJkYXRhUHJvYmVHZW5lcmF0aW9uUHJvcGVydHkiLCJ4UmFuZ2VQcm9wZXJ0eSIsInhSYW5nZSIsIm9mZnNldCIsIm1pbiIsIngiLCJwaGV0aW9WYWx1ZVR5cGUiLCJjb3VudHNQcm9wZXJ0eSIsInRpbWVJbkdlbmVyYXRpb25zUHJvcGVydHkiLCJkYXRhUHJvYmVHZW5lcmF0aW9uIiwidGltZUluR2VuZXJhdGlvbnMiLCJnZXRDb3VudHMiLCJCdW5ueUNvdW50c0lPIiwidmlzaWJsZVByb3BlcnR5IiwicmVzZXQiLCJkaXNwb3NlIiwiYXNzZXJ0IiwiY291bnRzIiwidG90YWxDb3VudCIsImdldENvdW50IiwidG90YWxQb2ludHMiLCJ3aGl0ZUZ1ckNvdW50Iiwid2hpdGVGdXJQb2ludHMiLCJicm93bkZ1ckNvdW50IiwiYnJvd25GdXJQb2ludHMiLCJzdHJhaWdodEVhcnNDb3VudCIsInN0cmFpZ2h0RWFyc1BvaW50cyIsImZsb3BweUVhcnNDb3VudCIsImZsb3BweUVhcnNQb2ludHMiLCJzaG9ydFRlZXRoQ291bnQiLCJzaG9ydFRlZXRoUG9pbnRzIiwibG9uZ1RlZXRoQ291bnQiLCJsb25nVGVldGhQb2ludHMiLCJwb2ludHMiLCJjb3VudCIsImkiLCJsZW5ndGgiLCJwb2ludCIsInkiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkRhdGFQcm9iZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBEYXRhUHJvYmUgaXMgdGhlIG1vZGVsIGZvciB0aGUgZGF0YSBwcm9iZSBvbiB0aGUgUG9wdWxhdGlvbiBncmFwaC4gSXQgc2hvd3MgcG9wdWxhdGlvbiAoeS1heGlzKSB2YWx1ZXMgYXQgYSBzcGVjaWZpY1xyXG4gKiBnZW5lcmF0aW9uICh4LWF4aXMpIHZhbHVlIG9uIHRoZSBncmFwaC5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBWZWN0b3IyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgUGhldGlvT2JqZWN0LCB7IFBoZXRpb09iamVjdE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvUGhldGlvT2JqZWN0LmpzJztcclxuaW1wb3J0IE51bGxhYmxlSU8gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL051bGxhYmxlSU8uanMnO1xyXG5pbXBvcnQgTnVtYmVySU8gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL051bWJlcklPLmpzJztcclxuaW1wb3J0IG5hdHVyYWxTZWxlY3Rpb24gZnJvbSAnLi4vLi4vbmF0dXJhbFNlbGVjdGlvbi5qcyc7XHJcbmltcG9ydCBCdW5ueUNvdW50cyBmcm9tICcuL0J1bm55Q291bnRzLmpzJztcclxuaW1wb3J0IFBvcHVsYXRpb25Nb2RlbCBmcm9tICcuL1BvcHVsYXRpb25Nb2RlbC5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0gRW1wdHlTZWxmT3B0aW9ucztcclxuXHJcbnR5cGUgRGF0YVByb2JlT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgUGlja1JlcXVpcmVkPFBoZXRpb09iamVjdE9wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERhdGFQcm9iZSBleHRlbmRzIFBoZXRpb09iamVjdCB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgcG9wdWxhdGlvbk1vZGVsOiBQb3B1bGF0aW9uTW9kZWw7XHJcblxyXG4gIC8vIHRoZSBpbml0aWFsIG9mZnNldCwgYXMgcmVxdWVzdGVkIGluIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9uYXR1cmFsLXNlbGVjdGlvbi9pc3N1ZXMvMTczXHJcbiAgLy8gV2hpbGUgd2Ugb25seSBuZWVkIHggKGdlbmVyYXRpb25zKSBvZmZzZXQsIERyYWdMaXN0ZW5lciByZXF1aXJlcyBhIHtQcm9wZXJ0eS48VmVjdG9yMj59LCBhbmQgeSBvZmZzZXQgd2lsbFxyXG4gIC8vIGJlIGNvbnN0cmFpbmVkIHRvIDAuXHJcbiAgcHVibGljIHJlYWRvbmx5IG9mZnNldFByb3BlcnR5OiBQcm9wZXJ0eTxWZWN0b3IyPjtcclxuXHJcbiAgLy8gTmFtZWQgZGF0YVByb2JlR2VuZXJhdGlvblByb3BlcnR5IHRvIGRpc3Rpbmd1aXNoIGl0IGZyb20gdGhlIG90aGVyICdnZW5lcmF0aW9uJyBQcm9wZXJ0aWVzIGluIHRoaXMgc2ltLlxyXG4gIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbmF0dXJhbC1zZWxlY3Rpb24vaXNzdWVzLzE4N1xyXG4gIHB1YmxpYyByZWFkb25seSBkYXRhUHJvYmVHZW5lcmF0aW9uUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PG51bWJlcj47XHJcblxyXG4gIC8vIEJ1bm55Q291bnRzIGF0IHRoZSBwb3NpdGlvbiBvZiB0aGUgZGF0YSBwcm9iZVxyXG4gIHB1YmxpYyByZWFkb25seSBjb3VudHNQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8QnVubnlDb3VudHMgfCBudWxsPjtcclxuXHJcbiAgLy8gdmlzaWJpbGl0eSBvZiB0aGUgZGF0YSBwcm9iZVxyXG4gIHB1YmxpYyByZWFkb25seSB2aXNpYmxlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHBvcHVsYXRpb25Nb2RlbDogUG9wdWxhdGlvbk1vZGVsLCBwcm92aWRlZE9wdGlvbnM6IERhdGFQcm9iZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxEYXRhUHJvYmVPcHRpb25zLCBTZWxmT3B0aW9ucywgUGhldGlvT2JqZWN0T3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gUGhldGlvT2JqZWN0T3B0aW9uc1xyXG4gICAgICBwaGV0aW9TdGF0ZTogZmFsc2UgLy8gdG8gcHJldmVudCBzZXJpYWxpemF0aW9uLCBiZWNhdXNlIHdlIGRvbid0IGhhdmUgYW4gSU8gVHlwZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLnBvcHVsYXRpb25Nb2RlbCA9IHBvcHVsYXRpb25Nb2RlbDtcclxuXHJcbiAgICB0aGlzLm9mZnNldFByb3BlcnR5ID0gbmV3IFZlY3RvcjJQcm9wZXJ0eSggbmV3IFZlY3RvcjIoIDEuNSwgMCApLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnb2Zmc2V0UHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdvZmZzZXQgb2YgdGhlIGRhdGEgcHJvYmUgZnJvbSB0aGUgbGVmdCBlZGdlIG9mIHRoZSBncmFwaCdcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmRhdGFQcm9iZUdlbmVyYXRpb25Qcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgcG9wdWxhdGlvbk1vZGVsLnhSYW5nZVByb3BlcnR5LCB0aGlzLm9mZnNldFByb3BlcnR5IF0sXHJcbiAgICAgICggeFJhbmdlLCBvZmZzZXQgKSA9PiB4UmFuZ2UubWluICsgb2Zmc2V0LngsIHtcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RhdGFQcm9iZUdlbmVyYXRpb25Qcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9WYWx1ZVR5cGU6IE51bWJlcklPLFxyXG4gICAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICd0aGUgZ2VuZXJhdGlvbiAoeC1heGlzKSB2YWx1ZSB3aGVyZSB0aGUgZGF0YSBwcm9iZSBpcyBwb3NpdGlvbmVkIChkZWNpbWFsKSdcclxuICAgICAgfSApO1xyXG5cclxuICAgIHRoaXMuY291bnRzUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIHRoaXMuZGF0YVByb2JlR2VuZXJhdGlvblByb3BlcnR5LCBwb3B1bGF0aW9uTW9kZWwudGltZUluR2VuZXJhdGlvbnNQcm9wZXJ0eSBdLFxyXG4gICAgICAoIGRhdGFQcm9iZUdlbmVyYXRpb24sIHRpbWVJbkdlbmVyYXRpb25zICkgPT4gdGhpcy5nZXRDb3VudHMoIGRhdGFQcm9iZUdlbmVyYXRpb24sIHRpbWVJbkdlbmVyYXRpb25zICksIHtcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NvdW50c1Byb3BlcnR5JyApLFxyXG4gICAgICAgIHBoZXRpb1ZhbHVlVHlwZTogTnVsbGFibGVJTyggQnVubnlDb3VudHMuQnVubnlDb3VudHNJTyApLFxyXG4gICAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdjb3VudHMgZGlzcGxheWVkIGJ5IHRoZSBkYXRhIHByb2JlJ1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgdGhpcy52aXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Zpc2libGVQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5vZmZzZXRQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy52aXNpYmxlUHJvcGVydHkucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBidW5ueSBjb3VudHMgZm9yIGEgc3BlY2lmaWMgZ2VuZXJhdGlvbiB2YWx1ZS5cclxuICAgKiBAcGFyYW0gZGF0YVByb2JlR2VuZXJhdGlvbiAtIGN1cnJlbnQgcG9zaXRpb24gb2YgdGhlIGRhdGEgcHJvYmUgb24gdGhlIHgtYXhpc1xyXG4gICAqIEBwYXJhbSB0aW1lSW5HZW5lcmF0aW9ucyAtIGN1cnJlbnQgdGltZSBvbiB0aGUgZ2VuZXJhdGlvbiBjbG9jaywgaW4gZ2VuZXJhdGlvbnNcclxuICAgKiBAcmV0dXJucyBudWxsIGlmIHRoZXJlIGFyZSBubyBjb3VudHMgYXQgdGhlIHByb2JlJ3MgcG9zaXRpb25cclxuICAgKi9cclxuICBwcml2YXRlIGdldENvdW50cyggZGF0YVByb2JlR2VuZXJhdGlvbjogbnVtYmVyLCB0aW1lSW5HZW5lcmF0aW9uczogbnVtYmVyICk6IEJ1bm55Q291bnRzIHwgbnVsbCB7XHJcbiAgICBsZXQgY291bnRzID0gbnVsbDtcclxuICAgIGlmICggZGF0YVByb2JlR2VuZXJhdGlvbiA8PSB0aW1lSW5HZW5lcmF0aW9ucyAmJiB0aW1lSW5HZW5lcmF0aW9ucyA+IDAgKSB7XHJcbiAgICAgIGNvdW50cyA9IG5ldyBCdW5ueUNvdW50cygge1xyXG4gICAgICAgIHRvdGFsQ291bnQ6IHRoaXMuZ2V0Q291bnQoIGRhdGFQcm9iZUdlbmVyYXRpb24sIHRoaXMucG9wdWxhdGlvbk1vZGVsLnRvdGFsUG9pbnRzICksXHJcbiAgICAgICAgd2hpdGVGdXJDb3VudDogdGhpcy5nZXRDb3VudCggZGF0YVByb2JlR2VuZXJhdGlvbiwgdGhpcy5wb3B1bGF0aW9uTW9kZWwud2hpdGVGdXJQb2ludHMgKSxcclxuICAgICAgICBicm93bkZ1ckNvdW50OiB0aGlzLmdldENvdW50KCBkYXRhUHJvYmVHZW5lcmF0aW9uLCB0aGlzLnBvcHVsYXRpb25Nb2RlbC5icm93bkZ1clBvaW50cyApLFxyXG4gICAgICAgIHN0cmFpZ2h0RWFyc0NvdW50OiB0aGlzLmdldENvdW50KCBkYXRhUHJvYmVHZW5lcmF0aW9uLCB0aGlzLnBvcHVsYXRpb25Nb2RlbC5zdHJhaWdodEVhcnNQb2ludHMgKSxcclxuICAgICAgICBmbG9wcHlFYXJzQ291bnQ6IHRoaXMuZ2V0Q291bnQoIGRhdGFQcm9iZUdlbmVyYXRpb24sIHRoaXMucG9wdWxhdGlvbk1vZGVsLmZsb3BweUVhcnNQb2ludHMgKSxcclxuICAgICAgICBzaG9ydFRlZXRoQ291bnQ6IHRoaXMuZ2V0Q291bnQoIGRhdGFQcm9iZUdlbmVyYXRpb24sIHRoaXMucG9wdWxhdGlvbk1vZGVsLnNob3J0VGVldGhQb2ludHMgKSxcclxuICAgICAgICBsb25nVGVldGhDb3VudDogdGhpcy5nZXRDb3VudCggZGF0YVByb2JlR2VuZXJhdGlvbiwgdGhpcy5wb3B1bGF0aW9uTW9kZWwubG9uZ1RlZXRoUG9pbnRzIClcclxuICAgICAgfSApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvdW50cztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIHBvcHVsYXRpb24gY291bnQgKHkgdmFsdWUpIGZvciBhIHNwZWNpZmljIGdlbmVyYXRpb24gKHggdmFsdWUpLlxyXG4gICAqIEBwYXJhbSBkYXRhUHJvYmVHZW5lcmF0aW9uIC0gY3VycmVudCBwb3NpdGlvbiBvZiB0aGUgZGF0YSBwcm9iZSBvbiB0aGUgeC1heGlzXHJcbiAgICogQHBhcmFtIHBvaW50cyAtIGRhdGEgcG9pbnRzLCB4IChnZW5lcmF0aW9uKSBhbmQgeSAocG9wdWxhdGlvbilcclxuICAgKi9cclxuICBwcml2YXRlIGdldENvdW50KCBkYXRhUHJvYmVHZW5lcmF0aW9uOiBudW1iZXIsIHBvaW50czogVmVjdG9yMltdICk6IG51bWJlciB7XHJcbiAgICBsZXQgY291bnQgPSAwO1xyXG5cclxuICAgIC8vIE9wdGltaXplIGZvciBzY3JvbGxpbmcgZ3JhcGguIFN0YXJ0IHdpdGggbW9zdCByZWNlbnQgcG9pbnRzIGFuZCB3b3JrIGJhY2t3YXJkcyBpbiB0aW1lLlxyXG4gICAgZm9yICggbGV0IGkgPSBwb2ludHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0gKSB7XHJcbiAgICAgIGNvbnN0IHBvaW50ID0gcG9pbnRzWyBpIF07XHJcbiAgICAgIGlmICggZGF0YVByb2JlR2VuZXJhdGlvbiA+PSBwb2ludC54ICkge1xyXG4gICAgICAgIGNvdW50ID0gcG9pbnQueTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvdW50O1xyXG4gIH1cclxufVxyXG5cclxubmF0dXJhbFNlbGVjdGlvbi5yZWdpc3RlciggJ0RhdGFQcm9iZScsIERhdGFQcm9iZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsZUFBZSxNQUFNLHdDQUF3QztBQUdwRSxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLGVBQWUsTUFBTSx1Q0FBdUM7QUFDbkUsT0FBT0MsU0FBUyxNQUE0Qix1Q0FBdUM7QUFFbkYsT0FBT0MsWUFBWSxNQUErQix1Q0FBdUM7QUFDekYsT0FBT0MsVUFBVSxNQUFNLDJDQUEyQztBQUNsRSxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxPQUFPQyxXQUFXLE1BQU0sa0JBQWtCO0FBTzFDLGVBQWUsTUFBTUMsU0FBUyxTQUFTTCxZQUFZLENBQUM7RUFJbEQ7RUFDQTtFQUNBO0VBR0E7RUFDQTtFQUdBO0VBR0E7RUFHT00sV0FBV0EsQ0FBRUMsZUFBZ0MsRUFBRUMsZUFBaUMsRUFBRztJQUV4RixNQUFNQyxPQUFPLEdBQUdWLFNBQVMsQ0FBcUQsQ0FBQyxDQUFFO01BRS9FO01BQ0FXLFdBQVcsRUFBRSxLQUFLLENBQUM7SUFDckIsQ0FBQyxFQUFFRixlQUFnQixDQUFDO0lBRXBCLEtBQUssQ0FBRUMsT0FBUSxDQUFDO0lBRWhCLElBQUksQ0FBQ0YsZUFBZSxHQUFHQSxlQUFlO0lBRXRDLElBQUksQ0FBQ0ksY0FBYyxHQUFHLElBQUliLGVBQWUsQ0FBRSxJQUFJRCxPQUFPLENBQUUsR0FBRyxFQUFFLENBQUUsQ0FBQyxFQUFFO01BQ2hFZSxNQUFNLEVB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