// Copyright 2019-2022, University of Colorado Boulder

/**
 * PopulationModel is the sub-model for the Population graph.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import createObservableArray from '../../../../axon/js/createObservableArray.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import Property from '../../../../axon/js/Property.js';
import Range from '../../../../dot/js/Range.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import optionize from '../../../../phet-core/js/optionize.js';
import PhetioObject from '../../../../tandem/js/PhetioObject.js';
import naturalSelection from '../../naturalSelection.js';
import NaturalSelectionUtils from '../NaturalSelectionUtils.js';
import DataProbe from './DataProbe.js';
// The default index into Y_MAXIMUMS, determines the initial y-axis range.
const Y_MAXIMUMS_INDEX_DEFAULT = 11;

// Minimum value for the y-axis range.
const Y_MINIMUM = 0;

// Maximum population values for the y-axis range.
const Y_MAXIMUMS = [2500, 2000, 1400, 1000, 700, 500, 350, 240, 200, 140, 100, 70, 50, 30, 14, 5];
assert && assert(_.every(Y_MAXIMUMS, value => NaturalSelectionUtils.isPositiveInteger(value)), 'Y_MAXIMUMS must contain positive integer values');
assert && assert(NaturalSelectionUtils.isSortedDescending(Y_MAXIMUMS), 'Y_MAXIMUMS must be sorted in descending order');

// Spacing of tick marks for each value of Y_MAXIMUMS.
const Y_TICK_SPACINGS = [500, 200, 200, 100, 100, 100, 50, 40, 40, 20, 20, 10, 10, 5, 2, 1];
assert && assert(Y_TICK_SPACINGS.length === Y_MAXIMUMS.length, 'incorrect number of Y_TICK_SPACINGS');
assert && assert(_.every(Y_TICK_SPACINGS, value => NaturalSelectionUtils.isPositiveInteger(value)), 'Y_TICK_SPACINGS must contain positive integer values');
assert && assert(NaturalSelectionUtils.isSortedDescending(Y_TICK_SPACINGS), 'Y_TICK_SPACINGS must be sorted in descending order');
export default class PopulationModel extends PhetioObject {
  // length of the x-axis, in generations
  // spacing between x-axis tick marks, in generations

  // data points, for total population and the population of each allele.
  // Vector2.x = generation, Vector2.y = population
  // visibility of each data set, on the graph and data probe
  // range of the x-axis, as time in generations
  // index into Y_MAXIMUMS, determines the y-axis range
  // range of the y-axis, in population. dispose is not necessary.
  constructor(genePool, timeInGenerationsProperty, isPlayingProperty, providedOptions) {
    const options = optionize()({
      // SelfOptions
      xAxisLength: 5,
      // PhetioObjectOptions
      phetioState: false,
      // to prevent serialization, because we don't have an IO Type
      phetioDocumentation: 'model elements that are specific to the Population feature'
    }, providedOptions);
    super(options);
    this.genePool = genePool;
    this.timeInGenerationsProperty = timeInGenerationsProperty;
    this.isPlayingProperty = isPlayingProperty;
    this.xAxisLength = options.xAxisLength;
    this.xAxisTickSpacing = 1;

    // For organizing all data points in Studio
    const dataPointsTandem = options.tandem.createTandem('dataPoints');

    // data points, for total population and the population of each allele.
    this.totalPoints = createObservableArray({
      tandem: dataPointsTandem.createTandem('totalPoints'),
      phetioType: createObservableArray.ObservableArrayIO(Vector2.Vector2IO),
      phetioDocumentation: 'Population data points for all bunnies'
    });
    this.whiteFurPoints = createObservableArray({
      tandem: dataPointsTandem.createTandem('whiteFurPoints'),
      phetioType: createObservableArray.ObservableArrayIO(Vector2.Vector2IO),
      phetioDocumentation: 'Population data points for bunnies with white fur'
    });
    this.brownFurPoints = createObservableArray({
      tandem: dataPointsTandem.createTandem('brownFurPoints'),
      phetioType: createObservableArray.ObservableArrayIO(Vector2.Vector2IO),
      phetioDocumentation: 'Population data points for bunnies with brown fur'
    });
    this.straightEarsPoints = createObservableArray({
      tandem: dataPointsTandem.createTandem('straightEarsPoints'),
      phetioType: createObservableArray.ObservableArrayIO(Vector2.Vector2IO),
      phetioDocumentation: 'Population data points for bunnies with straight ears'
    });
    this.floppyEarsPoints = createObservableArray({
      tandem: dataPointsTandem.createTandem('floppyEarsPoints'),
      phetioType: createObservableArray.ObservableArrayIO(Vector2.Vector2IO),
      phetioDocumentation: 'Population data points for bunnies with floppy ears'
    });
    this.shortTeethPoints = createObservableArray({
      tandem: dataPointsTandem.createTandem('shortTeethPoints'),
      phetioType: createObservableArray.ObservableArrayIO(Vector2.Vector2IO),
      phetioDocumentation: 'Population data points for bunnies with short teeth'
    });
    this.longTeethPoints = createObservableArray({
      tandem: dataPointsTandem.createTandem('longTeethPoints'),
      phetioType: createObservableArray.ObservableArrayIO(Vector2.Vector2IO),
      phetioDocumentation: 'Population data points for bunnies with long teeth'
    });

    // visibility of each data set, on the graph and data probe
    this.totalVisibleProperty = new BooleanProperty(true, {
      tandem: options.tandem.createTandem('totalVisibleProperty')
    });
    this.whiteFurVisibleProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('whiteFurVisibleProperty')
    });
    this.brownFurVisibleProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('brownFurVisibleProperty')
    });
    this.straightEarsVisibleProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('straightEarsVisibleProperty')
    });
    this.floppyEarsVisibleProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('floppyEarsVisibleProperty')
    });
    this.shortTeethVisibleProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('shortTeethVisibleProperty')
    });
    this.longTeethVisibleProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('longTeethVisibleProperty')
    });
    this.xRangeProperty = new Property(new Range(0, options.xAxisLength), {
      isValidValue: xRange => xRange.min >= 0,
      tandem: options.tandem.createTandem('xRangeProperty'),
      phetioValueType: Range.RangeIO,
      phetioReadOnly: true,
      // range is dynamic, and changes on every clock tick
      phetioHighFrequency: true,
      phetioDocumentation: 'range of the x (Generation) axis'
    });
    this.yZoomLevelProperty = new NumberProperty(Y_MAXIMUMS_INDEX_DEFAULT, {
      numberType: 'Integer',
      range: new Range(0, Y_MAXIMUMS.length - 1),
      tandem: options.tandem.createTandem('yZoomLevelProperty'),
      phetioDocumentation: 'Zooms in and out by selecting a pre-set y-axis range. The smaller the value, the larger the y-axis range.'
    });
    this.yRangeProperty = new DerivedProperty([this.yZoomLevelProperty], yZoomLevel => new Range(Y_MINIMUM, Y_MAXIMUMS[yZoomLevel]), {
      isValidValue: yRange => yRange.min >= 0,
      tandem: options.tandem.createTandem('yRangeProperty'),
      phetioValueType: Range.RangeIO,
      phetioDocumentation: 'range of the y (Population) axis'
    });
    this.dataProbe = new DataProbe(this, {
      tandem: options.tandem.createTandem('dataProbe')
    });

    // Scrolls the x-axis so that 'now' is always the max x value. unlink is not necessary.
    timeInGenerationsProperty.link(timeInGeneration => {
      // Skip when restoring PhET-iO state, see https://github.com/phetsims/natural-selection/issues/315
      if (!phet.joist.sim.isSettingPhetioStateProperty.value) {
        const max = Math.max(options.xAxisLength, timeInGeneration);
        if (this.xRangeProperty.value.max !== max) {
          const min = max - options.xAxisLength;
          this.xRangeProperty.value = new Range(min, max);
        }
      }
    });

    // When a mutation has been applied, show the plots associated with that gene.
    // unlinks are not necessary.
    // Do not do this when restoring PhET-iO state, see https://github.com/phetsims/natural-selection/issues/314.
    this.genePool.furGene.dominantAlleleProperty.link(dominantAllele => {
      if (!phet.joist.sim.isSettingPhetioStateProperty.value) {
        this.whiteFurVisibleProperty.value = !!dominantAllele;
        this.brownFurVisibleProperty.value = !!dominantAllele;
      }
    });
    this.genePool.earsGene.dominantAlleleProperty.link(dominantAllele => {
      if (!phet.joist.sim.isSettingPhetioStateProperty.value) {
        this.straightEarsVisibleProperty.value = !!dominantAllele;
        this.floppyEarsVisibleProperty.value = !!dominantAllele;
      }
    });
    this.genePool.teethGene.dominantAlleleProperty.link(dominantAllele => {
      if (!phet.joist.sim.isSettingPhetioStateProperty.value) {
        this.shortTeethVisibleProperty.value = !!dominantAllele;
        this.longTeethVisibleProperty.value = !!dominantAllele;
      }
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
  reset() {
    // Clear data points. Use this approach because these are instances of ObservableArrayDef.
    this.totalPoints.length = 0;
    this.whiteFurPoints.length = 0;
    this.brownFurPoints.length = 0;
    this.straightEarsPoints.length = 0;
    this.floppyEarsPoints.length = 0;
    this.shortTeethPoints.length = 0;
    this.longTeethPoints.length = 0;

    // reset visibility of plots
    this.totalVisibleProperty.reset();
    this.whiteFurVisibleProperty.reset();
    this.brownFurVisibleProperty.reset();
    this.straightEarsVisibleProperty.reset();
    this.floppyEarsVisibleProperty.reset();
    this.shortTeethVisibleProperty.reset();
    this.longTeethVisibleProperty.reset();
    this.xRangeProperty.reset();
    this.yZoomLevelProperty.reset();
    this.dataProbe.reset();
  }

  /**
   * Gets the y-axis tick mark spacing for the current y-axis scale.
   */
  getYTickSpacing() {
    return Y_TICK_SPACINGS[this.yZoomLevelProperty.value];
  }

  /**
   * Converts population counts to Vector2 points on the graph.
   */
  recordCounts(timeInGenerations, counts) {
    assert && assert(timeInGenerations >= 0, `invalid timeInGenerations: ${timeInGenerations}`);
    recordCount(this.totalPoints, timeInGenerations, counts.totalCount);
    recordCount(this.whiteFurPoints, timeInGenerations, counts.whiteFurCount);
    recordCount(this.brownFurPoints, timeInGenerations, counts.brownFurCount);
    recordCount(this.straightEarsPoints, timeInGenerations, counts.straightEarsCount);
    recordCount(this.floppyEarsPoints, timeInGenerations, counts.floppyEarsCount);
    recordCount(this.shortTeethPoints, timeInGenerations, counts.shortTeethCount);
    recordCount(this.longTeethPoints, timeInGenerations, counts.longTeethCount);
  }
}

/**
 * Records a count if it differs from the previous data point.
 */
function recordCount(array, timeInGenerations, count) {
  assert && assert(timeInGenerations >= 0, 'invalid generation');
  assert && assert(NaturalSelectionUtils.isNonNegativeInteger(count), 'invalid count');
  if (array.length === 0 || array[array.length - 1].y !== count) {
    array.push(new Vector2(timeInGenerations, count));
  }
}
naturalSelection.register('PopulationModel', PopulationModel);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJjcmVhdGVPYnNlcnZhYmxlQXJyYXkiLCJEZXJpdmVkUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIlByb3BlcnR5IiwiUmFuZ2UiLCJWZWN0b3IyIiwib3B0aW9uaXplIiwiUGhldGlvT2JqZWN0IiwibmF0dXJhbFNlbGVjdGlvbiIsIk5hdHVyYWxTZWxlY3Rpb25VdGlscyIsIkRhdGFQcm9iZSIsIllfTUFYSU1VTVNfSU5ERVhfREVGQVVMVCIsIllfTUlOSU1VTSIsIllfTUFYSU1VTVMiLCJhc3NlcnQiLCJfIiwiZXZlcnkiLCJ2YWx1ZSIsImlzUG9zaXRpdmVJbnRlZ2VyIiwiaXNTb3J0ZWREZXNjZW5kaW5nIiwiWV9USUNLX1NQQUNJTkdTIiwibGVuZ3RoIiwiUG9wdWxhdGlvbk1vZGVsIiwiY29uc3RydWN0b3IiLCJnZW5lUG9vbCIsInRpbWVJbkdlbmVyYXRpb25zUHJvcGVydHkiLCJpc1BsYXlpbmdQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ4QXhpc0xlbmd0aCIsInBoZXRpb1N0YXRlIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsInhBeGlzVGlja1NwYWNpbmciLCJkYXRhUG9pbnRzVGFuZGVtIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwidG90YWxQb2ludHMiLCJwaGV0aW9UeXBlIiwiT2JzZXJ2YWJsZUFycmF5SU8iLCJWZWN0b3IySU8iLCJ3aGl0ZUZ1clBvaW50cyIsImJyb3duRnVyUG9pbnRzIiwic3RyYWlnaHRFYXJzUG9pbnRzIiwiZmxvcHB5RWFyc1BvaW50cyIsInNob3J0VGVldGhQb2ludHMiLCJsb25nVGVldGhQb2ludHMiLCJ0b3RhbFZpc2libGVQcm9wZXJ0eSIsIndoaXRlRnVyVmlzaWJsZVByb3BlcnR5IiwiYnJvd25GdXJWaXNpYmxlUHJvcGVydHkiLCJzdHJhaWdodEVhcnNWaXNpYmxlUHJvcGVydHkiLCJmbG9wcHlFYXJzVmlzaWJsZVByb3BlcnR5Iiwic2hvcnRUZWV0aFZpc2libGVQcm9wZXJ0eSIsImxvbmdUZWV0aFZpc2libGVQcm9wZXJ0eSIsInhSYW5nZVByb3BlcnR5IiwiaXNWYWxpZFZhbHVlIiwieFJhbmdlIiwibWluIiwicGhldGlvVmFsdWVUeXBlIiwiUmFuZ2VJTyIsInBoZXRpb1JlYWRPbmx5IiwicGhldGlvSGlnaEZyZXF1ZW5jeSIsInlab29tTGV2ZWxQcm9wZXJ0eSIsIm51bWJlclR5cGUiLCJyYW5nZSIsInlSYW5nZVByb3BlcnR5IiwieVpvb21MZXZlbCIsInlSYW5nZSIsImRhdGFQcm9iZSIsImxpbmsiLCJ0aW1lSW5HZW5lcmF0aW9uIiwicGhldCIsImpvaXN0Iiwic2ltIiwiaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eSIsIm1heCIsIk1hdGgiLCJmdXJHZW5lIiwiZG9taW5hbnRBbGxlbGVQcm9wZXJ0eSIsImRvbWluYW50QWxsZWxlIiwiZWFyc0dlbmUiLCJ0ZWV0aEdlbmUiLCJkaXNwb3NlIiwicmVzZXQiLCJnZXRZVGlja1NwYWNpbmciLCJyZWNvcmRDb3VudHMiLCJ0aW1lSW5HZW5lcmF0aW9ucyIsImNvdW50cyIsInJlY29yZENvdW50IiwidG90YWxDb3VudCIsIndoaXRlRnVyQ291bnQiLCJicm93bkZ1ckNvdW50Iiwic3RyYWlnaHRFYXJzQ291bnQiLCJmbG9wcHlFYXJzQ291bnQiLCJzaG9ydFRlZXRoQ291bnQiLCJsb25nVGVldGhDb3VudCIsImFycmF5IiwiY291bnQiLCJpc05vbk5lZ2F0aXZlSW50ZWdlciIsInkiLCJwdXNoIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQb3B1bGF0aW9uTW9kZWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogUG9wdWxhdGlvbk1vZGVsIGlzIHRoZSBzdWItbW9kZWwgZm9yIHRoZSBQb3B1bGF0aW9uIGdyYXBoLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgY3JlYXRlT2JzZXJ2YWJsZUFycmF5LCB7IE9ic2VydmFibGVBcnJheSB9IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvY3JlYXRlT2JzZXJ2YWJsZUFycmF5LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBQaWNrUmVxdWlyZWQgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1BpY2tSZXF1aXJlZC5qcyc7XHJcbmltcG9ydCBQaGV0aW9PYmplY3QsIHsgUGhldGlvT2JqZWN0T3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9QaGV0aW9PYmplY3QuanMnO1xyXG5pbXBvcnQgbmF0dXJhbFNlbGVjdGlvbiBmcm9tICcuLi8uLi9uYXR1cmFsU2VsZWN0aW9uLmpzJztcclxuaW1wb3J0IE5hdHVyYWxTZWxlY3Rpb25VdGlscyBmcm9tICcuLi9OYXR1cmFsU2VsZWN0aW9uVXRpbHMuanMnO1xyXG5pbXBvcnQgQnVubnlDb3VudHMgZnJvbSAnLi9CdW5ueUNvdW50cy5qcyc7XHJcbmltcG9ydCBEYXRhUHJvYmUgZnJvbSAnLi9EYXRhUHJvYmUuanMnO1xyXG5pbXBvcnQgR2VuZVBvb2wgZnJvbSAnLi9HZW5lUG9vbC5qcyc7XHJcblxyXG4vLyBUaGUgZGVmYXVsdCBpbmRleCBpbnRvIFlfTUFYSU1VTVMsIGRldGVybWluZXMgdGhlIGluaXRpYWwgeS1heGlzIHJhbmdlLlxyXG5jb25zdCBZX01BWElNVU1TX0lOREVYX0RFRkFVTFQgPSAxMTtcclxuXHJcbi8vIE1pbmltdW0gdmFsdWUgZm9yIHRoZSB5LWF4aXMgcmFuZ2UuXHJcbmNvbnN0IFlfTUlOSU1VTSA9IDA7XHJcblxyXG4vLyBNYXhpbXVtIHBvcHVsYXRpb24gdmFsdWVzIGZvciB0aGUgeS1heGlzIHJhbmdlLlxyXG5jb25zdCBZX01BWElNVU1TID0gWyAyNTAwLCAyMDAwLCAxNDAwLCAxMDAwLCA3MDAsIDUwMCwgMzUwLCAyNDAsIDIwMCwgMTQwLCAxMDAsIDcwLCA1MCwgMzAsIDE0LCA1IF07XHJcbmFzc2VydCAmJiBhc3NlcnQoIF8uZXZlcnkoIFlfTUFYSU1VTVMsIHZhbHVlID0+IE5hdHVyYWxTZWxlY3Rpb25VdGlscy5pc1Bvc2l0aXZlSW50ZWdlciggdmFsdWUgKSApLFxyXG4gICdZX01BWElNVU1TIG11c3QgY29udGFpbiBwb3NpdGl2ZSBpbnRlZ2VyIHZhbHVlcycgKTtcclxuYXNzZXJ0ICYmIGFzc2VydCggTmF0dXJhbFNlbGVjdGlvblV0aWxzLmlzU29ydGVkRGVzY2VuZGluZyggWV9NQVhJTVVNUyApLFxyXG4gICdZX01BWElNVU1TIG11c3QgYmUgc29ydGVkIGluIGRlc2NlbmRpbmcgb3JkZXInICk7XHJcblxyXG4vLyBTcGFjaW5nIG9mIHRpY2sgbWFya3MgZm9yIGVhY2ggdmFsdWUgb2YgWV9NQVhJTVVNUy5cclxuY29uc3QgWV9USUNLX1NQQUNJTkdTID0gWyA1MDAsIDIwMCwgMjAwLCAxMDAsIDEwMCwgMTAwLCA1MCwgNDAsIDQwLCAyMCwgMjAsIDEwLCAxMCwgNSwgMiwgMSBdO1xyXG5hc3NlcnQgJiYgYXNzZXJ0KCBZX1RJQ0tfU1BBQ0lOR1MubGVuZ3RoID09PSBZX01BWElNVU1TLmxlbmd0aCwgJ2luY29ycmVjdCBudW1iZXIgb2YgWV9USUNLX1NQQUNJTkdTJyApO1xyXG5hc3NlcnQgJiYgYXNzZXJ0KCBfLmV2ZXJ5KCBZX1RJQ0tfU1BBQ0lOR1MsIHZhbHVlID0+IE5hdHVyYWxTZWxlY3Rpb25VdGlscy5pc1Bvc2l0aXZlSW50ZWdlciggdmFsdWUgKSApLFxyXG4gICdZX1RJQ0tfU1BBQ0lOR1MgbXVzdCBjb250YWluIHBvc2l0aXZlIGludGVnZXIgdmFsdWVzJyApO1xyXG5hc3NlcnQgJiYgYXNzZXJ0KCBOYXR1cmFsU2VsZWN0aW9uVXRpbHMuaXNTb3J0ZWREZXNjZW5kaW5nKCBZX1RJQ0tfU1BBQ0lOR1MgKSxcclxuICAnWV9USUNLX1NQQUNJTkdTIG11c3QgYmUgc29ydGVkIGluIGRlc2NlbmRpbmcgb3JkZXInICk7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIHhBeGlzTGVuZ3RoPzogbnVtYmVyOyAvLyBsZW5ndGggb2YgdGhlIHgtYXhpcywgaW4gZ2VuZXJhdGlvbnNcclxufTtcclxuXHJcbnR5cGUgUG9wdWxhdGlvbk1vZGVsT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgUGlja1JlcXVpcmVkPFBoZXRpb09iamVjdE9wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVsYXRpb25Nb2RlbCBleHRlbmRzIFBoZXRpb09iamVjdCB7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSBnZW5lUG9vbDogR2VuZVBvb2w7XHJcbiAgcHVibGljIHJlYWRvbmx5IHRpbWVJbkdlbmVyYXRpb25zUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PG51bWJlcj47XHJcbiAgcHVibGljIHJlYWRvbmx5IGlzUGxheWluZ1Byb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgeEF4aXNMZW5ndGg6IG51bWJlcjsgLy8gbGVuZ3RoIG9mIHRoZSB4LWF4aXMsIGluIGdlbmVyYXRpb25zXHJcbiAgcHVibGljIHJlYWRvbmx5IHhBeGlzVGlja1NwYWNpbmc6IG51bWJlcjsgLy8gc3BhY2luZyBiZXR3ZWVuIHgtYXhpcyB0aWNrIG1hcmtzLCBpbiBnZW5lcmF0aW9uc1xyXG5cclxuICAvLyBkYXRhIHBvaW50cywgZm9yIHRvdGFsIHBvcHVsYXRpb24gYW5kIHRoZSBwb3B1bGF0aW9uIG9mIGVhY2ggYWxsZWxlLlxyXG4gIC8vIFZlY3RvcjIueCA9IGdlbmVyYXRpb24sIFZlY3RvcjIueSA9IHBvcHVsYXRpb25cclxuICBwdWJsaWMgcmVhZG9ubHkgdG90YWxQb2ludHM6IE9ic2VydmFibGVBcnJheTxWZWN0b3IyPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgd2hpdGVGdXJQb2ludHM6IE9ic2VydmFibGVBcnJheTxWZWN0b3IyPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgYnJvd25GdXJQb2ludHM6IE9ic2VydmFibGVBcnJheTxWZWN0b3IyPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgc3RyYWlnaHRFYXJzUG9pbnRzOiBPYnNlcnZhYmxlQXJyYXk8VmVjdG9yMj47XHJcbiAgcHVibGljIHJlYWRvbmx5IGZsb3BweUVhcnNQb2ludHM6IE9ic2VydmFibGVBcnJheTxWZWN0b3IyPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgc2hvcnRUZWV0aFBvaW50czogT2JzZXJ2YWJsZUFycmF5PFZlY3RvcjI+O1xyXG4gIHB1YmxpYyByZWFkb25seSBsb25nVGVldGhQb2ludHM6IE9ic2VydmFibGVBcnJheTxWZWN0b3IyPjtcclxuXHJcbiAgLy8gdmlzaWJpbGl0eSBvZiBlYWNoIGRhdGEgc2V0LCBvbiB0aGUgZ3JhcGggYW5kIGRhdGEgcHJvYmVcclxuICBwdWJsaWMgcmVhZG9ubHkgdG90YWxWaXNpYmxlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG4gIHB1YmxpYyByZWFkb25seSB3aGl0ZUZ1clZpc2libGVQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgcHVibGljIHJlYWRvbmx5IGJyb3duRnVyVmlzaWJsZVByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgc3RyYWlnaHRFYXJzVmlzaWJsZVByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgZmxvcHB5RWFyc1Zpc2libGVQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgcHVibGljIHJlYWRvbmx5IHNob3J0VGVldGhWaXNpYmxlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG4gIHB1YmxpYyByZWFkb25seSBsb25nVGVldGhWaXNpYmxlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyByYW5nZSBvZiB0aGUgeC1heGlzLCBhcyB0aW1lIGluIGdlbmVyYXRpb25zXHJcbiAgcHVibGljIHJlYWRvbmx5IHhSYW5nZVByb3BlcnR5OiBQcm9wZXJ0eTxSYW5nZT47XHJcblxyXG4gIC8vIGluZGV4IGludG8gWV9NQVhJTVVNUywgZGV0ZXJtaW5lcyB0aGUgeS1heGlzIHJhbmdlXHJcbiAgcHVibGljIHJlYWRvbmx5IHlab29tTGV2ZWxQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHk7XHJcblxyXG4gIC8vIHJhbmdlIG9mIHRoZSB5LWF4aXMsIGluIHBvcHVsYXRpb24uIGRpc3Bvc2UgaXMgbm90IG5lY2Vzc2FyeS5cclxuICBwdWJsaWMgcmVhZG9ubHkgeVJhbmdlUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PFJhbmdlPjtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IGRhdGFQcm9iZTogRGF0YVByb2JlO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGdlbmVQb29sOiBHZW5lUG9vbCwgdGltZUluR2VuZXJhdGlvbnNQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPixcclxuICAgICAgICAgICAgICAgICAgICAgIGlzUGxheWluZ1Byb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPiwgcHJvdmlkZWRPcHRpb25zOiBQb3B1bGF0aW9uTW9kZWxPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8UG9wdWxhdGlvbk1vZGVsT3B0aW9ucywgU2VsZk9wdGlvbnMsIFBoZXRpb09iamVjdE9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNlbGZPcHRpb25zXHJcbiAgICAgIHhBeGlzTGVuZ3RoOiA1LFxyXG5cclxuICAgICAgLy8gUGhldGlvT2JqZWN0T3B0aW9uc1xyXG4gICAgICBwaGV0aW9TdGF0ZTogZmFsc2UsIC8vIHRvIHByZXZlbnQgc2VyaWFsaXphdGlvbiwgYmVjYXVzZSB3ZSBkb24ndCBoYXZlIGFuIElPIFR5cGVcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ21vZGVsIGVsZW1lbnRzIHRoYXQgYXJlIHNwZWNpZmljIHRvIHRoZSBQb3B1bGF0aW9uIGZlYXR1cmUnXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuZ2VuZVBvb2wgPSBnZW5lUG9vbDtcclxuICAgIHRoaXMudGltZUluR2VuZXJhdGlvbnNQcm9wZXJ0eSA9IHRpbWVJbkdlbmVyYXRpb25zUHJvcGVydHk7XHJcbiAgICB0aGlzLmlzUGxheWluZ1Byb3BlcnR5ID0gaXNQbGF5aW5nUHJvcGVydHk7XHJcbiAgICB0aGlzLnhBeGlzTGVuZ3RoID0gb3B0aW9ucy54QXhpc0xlbmd0aDtcclxuICAgIHRoaXMueEF4aXNUaWNrU3BhY2luZyA9IDE7XHJcblxyXG4gICAgLy8gRm9yIG9yZ2FuaXppbmcgYWxsIGRhdGEgcG9pbnRzIGluIFN0dWRpb1xyXG4gICAgY29uc3QgZGF0YVBvaW50c1RhbmRlbSA9IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RhdGFQb2ludHMnICk7XHJcblxyXG4gICAgLy8gZGF0YSBwb2ludHMsIGZvciB0b3RhbCBwb3B1bGF0aW9uIGFuZCB0aGUgcG9wdWxhdGlvbiBvZiBlYWNoIGFsbGVsZS5cclxuICAgIHRoaXMudG90YWxQb2ludHMgPSBjcmVhdGVPYnNlcnZhYmxlQXJyYXkoIHtcclxuICAgICAgdGFuZGVtOiBkYXRhUG9pbnRzVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3RvdGFsUG9pbnRzJyApLFxyXG4gICAgICBwaGV0aW9UeXBlOiBjcmVhdGVPYnNlcnZhYmxlQXJyYXkuT2JzZXJ2YWJsZUFycmF5SU8oIFZlY3RvcjIuVmVjdG9yMklPICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdQb3B1bGF0aW9uIGRhdGEgcG9pbnRzIGZvciBhbGwgYnVubmllcydcclxuICAgIH0gKTtcclxuICAgIHRoaXMud2hpdGVGdXJQb2ludHMgPSBjcmVhdGVPYnNlcnZhYmxlQXJyYXkoIHtcclxuICAgICAgdGFuZGVtOiBkYXRhUG9pbnRzVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3doaXRlRnVyUG9pbnRzJyApLFxyXG4gICAgICBwaGV0aW9UeXBlOiBjcmVhdGVPYnNlcnZhYmxlQXJyYXkuT2JzZXJ2YWJsZUFycmF5SU8oIFZlY3RvcjIuVmVjdG9yMklPICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdQb3B1bGF0aW9uIGRhdGEgcG9pbnRzIGZvciBidW5uaWVzIHdpdGggd2hpdGUgZnVyJ1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5icm93bkZ1clBvaW50cyA9IGNyZWF0ZU9ic2VydmFibGVBcnJheSgge1xyXG4gICAgICB0YW5kZW06IGRhdGFQb2ludHNUYW5kZW0uY3JlYXRlVGFuZGVtKCAnYnJvd25GdXJQb2ludHMnICksXHJcbiAgICAgIHBoZXRpb1R5cGU6IGNyZWF0ZU9ic2VydmFibGVBcnJheS5PYnNlcnZhYmxlQXJyYXlJTyggVmVjdG9yMi5WZWN0b3IySU8gKSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ1BvcHVsYXRpb24gZGF0YSBwb2ludHMgZm9yIGJ1bm5pZXMgd2l0aCBicm93biBmdXInXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLnN0cmFpZ2h0RWFyc1BvaW50cyA9IGNyZWF0ZU9ic2VydmFibGVBcnJheSgge1xyXG4gICAgICB0YW5kZW06IGRhdGFQb2ludHNUYW5kZW0uY3JlYXRlVGFuZGVtKCAnc3RyYWlnaHRFYXJzUG9pbnRzJyApLFxyXG4gICAgICBwaGV0aW9UeXBlOiBjcmVhdGVPYnNlcnZhYmxlQXJyYXkuT2JzZXJ2YWJsZUFycmF5SU8oIFZlY3RvcjIuVmVjdG9yMklPICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdQb3B1bGF0aW9uIGRhdGEgcG9pbnRzIGZvciBidW5uaWVzIHdpdGggc3RyYWlnaHQgZWFycydcclxuICAgIH0gKTtcclxuICAgIHRoaXMuZmxvcHB5RWFyc1BvaW50cyA9IGNyZWF0ZU9ic2VydmFibGVBcnJheSgge1xyXG4gICAgICB0YW5kZW06IGRhdGFQb2ludHNUYW5kZW0uY3JlYXRlVGFuZGVtKCAnZmxvcHB5RWFyc1BvaW50cycgKSxcclxuICAgICAgcGhldGlvVHlwZTogY3JlYXRlT2JzZXJ2YWJsZUFycmF5Lk9ic2VydmFibGVBcnJheUlPKCBWZWN0b3IyLlZlY3RvcjJJTyApLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnUG9wdWxhdGlvbiBkYXRhIHBvaW50cyBmb3IgYnVubmllcyB3aXRoIGZsb3BweSBlYXJzJ1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5zaG9ydFRlZXRoUG9pbnRzID0gY3JlYXRlT2JzZXJ2YWJsZUFycmF5KCB7XHJcbiAgICAgIHRhbmRlbTogZGF0YVBvaW50c1RhbmRlbS5jcmVhdGVUYW5kZW0oICdzaG9ydFRlZXRoUG9pbnRzJyApLFxyXG4gICAgICBwaGV0aW9UeXBlOiBjcmVhdGVPYnNlcnZhYmxlQXJyYXkuT2JzZXJ2YWJsZUFycmF5SU8oIFZlY3RvcjIuVmVjdG9yMklPICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdQb3B1bGF0aW9uIGRhdGEgcG9pbnRzIGZvciBidW5uaWVzIHdpdGggc2hvcnQgdGVldGgnXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmxvbmdUZWV0aFBvaW50cyA9IGNyZWF0ZU9ic2VydmFibGVBcnJheSgge1xyXG4gICAgICB0YW5kZW06IGRhdGFQb2ludHNUYW5kZW0uY3JlYXRlVGFuZGVtKCAnbG9uZ1RlZXRoUG9pbnRzJyApLFxyXG4gICAgICBwaGV0aW9UeXBlOiBjcmVhdGVPYnNlcnZhYmxlQXJyYXkuT2JzZXJ2YWJsZUFycmF5SU8oIFZlY3RvcjIuVmVjdG9yMklPICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdQb3B1bGF0aW9uIGRhdGEgcG9pbnRzIGZvciBidW5uaWVzIHdpdGggbG9uZyB0ZWV0aCdcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB2aXNpYmlsaXR5IG9mIGVhY2ggZGF0YSBzZXQsIG9uIHRoZSBncmFwaCBhbmQgZGF0YSBwcm9iZVxyXG4gICAgdGhpcy50b3RhbFZpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICd0b3RhbFZpc2libGVQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy53aGl0ZUZ1clZpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnd2hpdGVGdXJWaXNpYmxlUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYnJvd25GdXJWaXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2Jyb3duRnVyVmlzaWJsZVByb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLnN0cmFpZ2h0RWFyc1Zpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnc3RyYWlnaHRFYXJzVmlzaWJsZVByb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmZsb3BweUVhcnNWaXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2Zsb3BweUVhcnNWaXNpYmxlUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuc2hvcnRUZWV0aFZpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnc2hvcnRUZWV0aFZpc2libGVQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5sb25nVGVldGhWaXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xvbmdUZWV0aFZpc2libGVQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMueFJhbmdlUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIG5ldyBSYW5nZSggMCwgb3B0aW9ucy54QXhpc0xlbmd0aCApLCB7XHJcbiAgICAgIGlzVmFsaWRWYWx1ZTogeFJhbmdlID0+ICggeFJhbmdlLm1pbiA+PSAwICksXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAneFJhbmdlUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb1ZhbHVlVHlwZTogUmFuZ2UuUmFuZ2VJTyxcclxuICAgICAgcGhldGlvUmVhZE9ubHk6IHRydWUsIC8vIHJhbmdlIGlzIGR5bmFtaWMsIGFuZCBjaGFuZ2VzIG9uIGV2ZXJ5IGNsb2NrIHRpY2tcclxuICAgICAgcGhldGlvSGlnaEZyZXF1ZW5jeTogdHJ1ZSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ3JhbmdlIG9mIHRoZSB4IChHZW5lcmF0aW9uKSBheGlzJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMueVpvb21MZXZlbFByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCBZX01BWElNVU1TX0lOREVYX0RFRkFVTFQsIHtcclxuICAgICAgbnVtYmVyVHlwZTogJ0ludGVnZXInLFxyXG4gICAgICByYW5nZTogbmV3IFJhbmdlKCAwLCBZX01BWElNVU1TLmxlbmd0aCAtIDEgKSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICd5Wm9vbUxldmVsUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdab29tcyBpbiBhbmQgb3V0IGJ5IHNlbGVjdGluZyBhIHByZS1zZXQgeS1heGlzIHJhbmdlLiBUaGUgc21hbGxlciB0aGUgdmFsdWUsIHRoZSBsYXJnZXIgdGhlIHktYXhpcyByYW5nZS4nXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy55UmFuZ2VQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgdGhpcy55Wm9vbUxldmVsUHJvcGVydHkgXSxcclxuICAgICAgeVpvb21MZXZlbCA9PiBuZXcgUmFuZ2UoIFlfTUlOSU1VTSwgWV9NQVhJTVVNU1sgeVpvb21MZXZlbCBdICksIHtcclxuICAgICAgICBpc1ZhbGlkVmFsdWU6IHlSYW5nZSA9PiAoIHlSYW5nZS5taW4gPj0gMCApLFxyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAneVJhbmdlUHJvcGVydHknICksXHJcbiAgICAgICAgcGhldGlvVmFsdWVUeXBlOiBSYW5nZS5SYW5nZUlPLFxyXG4gICAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdyYW5nZSBvZiB0aGUgeSAoUG9wdWxhdGlvbikgYXhpcydcclxuICAgICAgfSApO1xyXG5cclxuICAgIHRoaXMuZGF0YVByb2JlID0gbmV3IERhdGFQcm9iZSggdGhpcywge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RhdGFQcm9iZScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFNjcm9sbHMgdGhlIHgtYXhpcyBzbyB0aGF0ICdub3cnIGlzIGFsd2F5cyB0aGUgbWF4IHggdmFsdWUuIHVubGluayBpcyBub3QgbmVjZXNzYXJ5LlxyXG4gICAgdGltZUluR2VuZXJhdGlvbnNQcm9wZXJ0eS5saW5rKCB0aW1lSW5HZW5lcmF0aW9uID0+IHtcclxuXHJcbiAgICAgIC8vIFNraXAgd2hlbiByZXN0b3JpbmcgUGhFVC1pTyBzdGF0ZSwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9uYXR1cmFsLXNlbGVjdGlvbi9pc3N1ZXMvMzE1XHJcbiAgICAgIGlmICggIXBoZXQuam9pc3Quc2ltLmlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgY29uc3QgbWF4ID0gTWF0aC5tYXgoIG9wdGlvbnMueEF4aXNMZW5ndGgsIHRpbWVJbkdlbmVyYXRpb24gKTtcclxuICAgICAgICBpZiAoIHRoaXMueFJhbmdlUHJvcGVydHkudmFsdWUubWF4ICE9PSBtYXggKSB7XHJcbiAgICAgICAgICBjb25zdCBtaW4gPSBtYXggLSBvcHRpb25zLnhBeGlzTGVuZ3RoO1xyXG4gICAgICAgICAgdGhpcy54UmFuZ2VQcm9wZXJ0eS52YWx1ZSA9IG5ldyBSYW5nZSggbWluLCBtYXggKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBXaGVuIGEgbXV0YXRpb24gaGFzIGJlZW4gYXBwbGllZCwgc2hvdyB0aGUgcGxvdHMgYXNzb2NpYXRlZCB3aXRoIHRoYXQgZ2VuZS5cclxuICAgIC8vIHVubGlua3MgYXJlIG5vdCBuZWNlc3NhcnkuXHJcbiAgICAvLyBEbyBub3QgZG8gdGhpcyB3aGVuIHJlc3RvcmluZyBQaEVULWlPIHN0YXRlLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL25hdHVyYWwtc2VsZWN0aW9uL2lzc3Vlcy8zMTQuXHJcbiAgICB0aGlzLmdlbmVQb29sLmZ1ckdlbmUuZG9taW5hbnRBbGxlbGVQcm9wZXJ0eS5saW5rKCBkb21pbmFudEFsbGVsZSA9PiB7XHJcbiAgICAgIGlmICggIXBoZXQuam9pc3Quc2ltLmlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgdGhpcy53aGl0ZUZ1clZpc2libGVQcm9wZXJ0eS52YWx1ZSA9ICEhZG9taW5hbnRBbGxlbGU7XHJcbiAgICAgICAgdGhpcy5icm93bkZ1clZpc2libGVQcm9wZXJ0eS52YWx1ZSA9ICEhZG9taW5hbnRBbGxlbGU7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIHRoaXMuZ2VuZVBvb2wuZWFyc0dlbmUuZG9taW5hbnRBbGxlbGVQcm9wZXJ0eS5saW5rKCBkb21pbmFudEFsbGVsZSA9PiB7XHJcbiAgICAgIGlmICggIXBoZXQuam9pc3Quc2ltLmlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgdGhpcy5zdHJhaWdodEVhcnNWaXNpYmxlUHJvcGVydHkudmFsdWUgPSAhIWRvbWluYW50QWxsZWxlO1xyXG4gICAgICAgIHRoaXMuZmxvcHB5RWFyc1Zpc2libGVQcm9wZXJ0eS52YWx1ZSA9ICEhZG9taW5hbnRBbGxlbGU7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIHRoaXMuZ2VuZVBvb2wudGVldGhHZW5lLmRvbWluYW50QWxsZWxlUHJvcGVydHkubGluayggZG9taW5hbnRBbGxlbGUgPT4ge1xyXG4gICAgICBpZiAoICFwaGV0LmpvaXN0LnNpbS5pc1NldHRpbmdQaGV0aW9TdGF0ZVByb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICAgIHRoaXMuc2hvcnRUZWV0aFZpc2libGVQcm9wZXJ0eS52YWx1ZSA9ICEhZG9taW5hbnRBbGxlbGU7XHJcbiAgICAgICAgdGhpcy5sb25nVGVldGhWaXNpYmxlUHJvcGVydHkudmFsdWUgPSAhIWRvbWluYW50QWxsZWxlO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG5cclxuICAgIC8vIENsZWFyIGRhdGEgcG9pbnRzLiBVc2UgdGhpcyBhcHByb2FjaCBiZWNhdXNlIHRoZXNlIGFyZSBpbnN0YW5jZXMgb2YgT2JzZXJ2YWJsZUFycmF5RGVmLlxyXG4gICAgdGhpcy50b3RhbFBvaW50cy5sZW5ndGggPSAwO1xyXG4gICAgdGhpcy53aGl0ZUZ1clBvaW50cy5sZW5ndGggPSAwO1xyXG4gICAgdGhpcy5icm93bkZ1clBvaW50cy5sZW5ndGggPSAwO1xyXG4gICAgdGhpcy5zdHJhaWdodEVhcnNQb2ludHMubGVuZ3RoID0gMDtcclxuICAgIHRoaXMuZmxvcHB5RWFyc1BvaW50cy5sZW5ndGggPSAwO1xyXG4gICAgdGhpcy5zaG9ydFRlZXRoUG9pbnRzLmxlbmd0aCA9IDA7XHJcbiAgICB0aGlzLmxvbmdUZWV0aFBvaW50cy5sZW5ndGggPSAwO1xyXG5cclxuICAgIC8vIHJlc2V0IHZpc2liaWxpdHkgb2YgcGxvdHNcclxuICAgIHRoaXMudG90YWxWaXNpYmxlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMud2hpdGVGdXJWaXNpYmxlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuYnJvd25GdXJWaXNpYmxlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuc3RyYWlnaHRFYXJzVmlzaWJsZVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmZsb3BweUVhcnNWaXNpYmxlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuc2hvcnRUZWV0aFZpc2libGVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5sb25nVGVldGhWaXNpYmxlUHJvcGVydHkucmVzZXQoKTtcclxuXHJcbiAgICB0aGlzLnhSYW5nZVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnlab29tTGV2ZWxQcm9wZXJ0eS5yZXNldCgpO1xyXG5cclxuICAgIHRoaXMuZGF0YVByb2JlLnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSB5LWF4aXMgdGljayBtYXJrIHNwYWNpbmcgZm9yIHRoZSBjdXJyZW50IHktYXhpcyBzY2FsZS5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0WVRpY2tTcGFjaW5nKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gWV9USUNLX1NQQUNJTkdTWyB0aGlzLnlab29tTGV2ZWxQcm9wZXJ0eS52YWx1ZSBdO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29udmVydHMgcG9wdWxhdGlvbiBjb3VudHMgdG8gVmVjdG9yMiBwb2ludHMgb24gdGhlIGdyYXBoLlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZWNvcmRDb3VudHMoIHRpbWVJbkdlbmVyYXRpb25zOiBudW1iZXIsIGNvdW50czogQnVubnlDb3VudHMgKTogdm9pZCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aW1lSW5HZW5lcmF0aW9ucyA+PSAwLCBgaW52YWxpZCB0aW1lSW5HZW5lcmF0aW9uczogJHt0aW1lSW5HZW5lcmF0aW9uc31gICk7XHJcblxyXG4gICAgcmVjb3JkQ291bnQoIHRoaXMudG90YWxQb2ludHMsIHRpbWVJbkdlbmVyYXRpb25zLCBjb3VudHMudG90YWxDb3VudCApO1xyXG4gICAgcmVjb3JkQ291bnQoIHRoaXMud2hpdGVGdXJQb2ludHMsIHRpbWVJbkdlbmVyYXRpb25zLCBjb3VudHMud2hpdGVGdXJDb3VudCApO1xyXG4gICAgcmVjb3JkQ291bnQoIHRoaXMuYnJvd25GdXJQb2ludHMsIHRpbWVJbkdlbmVyYXRpb25zLCBjb3VudHMuYnJvd25GdXJDb3VudCApO1xyXG4gICAgcmVjb3JkQ291bnQoIHRoaXMuc3RyYWlnaHRFYXJzUG9pbnRzLCB0aW1lSW5HZW5lcmF0aW9ucywgY291bnRzLnN0cmFpZ2h0RWFyc0NvdW50ICk7XHJcbiAgICByZWNvcmRDb3VudCggdGhpcy5mbG9wcHlFYXJzUG9pbnRzLCB0aW1lSW5HZW5lcmF0aW9ucywgY291bnRzLmZsb3BweUVhcnNDb3VudCApO1xyXG4gICAgcmVjb3JkQ291bnQoIHRoaXMuc2hvcnRUZWV0aFBvaW50cywgdGltZUluR2VuZXJhdGlvbnMsIGNvdW50cy5zaG9ydFRlZXRoQ291bnQgKTtcclxuICAgIHJlY29yZENvdW50KCB0aGlzLmxvbmdUZWV0aFBvaW50cywgdGltZUluR2VuZXJhdGlvbnMsIGNvdW50cy5sb25nVGVldGhDb3VudCApO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFJlY29yZHMgYSBjb3VudCBpZiBpdCBkaWZmZXJzIGZyb20gdGhlIHByZXZpb3VzIGRhdGEgcG9pbnQuXHJcbiAqL1xyXG5mdW5jdGlvbiByZWNvcmRDb3VudCggYXJyYXk6IFZlY3RvcjJbXSwgdGltZUluR2VuZXJhdGlvbnM6IG51bWJlciwgY291bnQ6IG51bWJlciApOiB2b2lkIHtcclxuICBhc3NlcnQgJiYgYXNzZXJ0KCB0aW1lSW5HZW5lcmF0aW9ucyA+PSAwLCAnaW52YWxpZCBnZW5lcmF0aW9uJyApO1xyXG4gIGFzc2VydCAmJiBhc3NlcnQoIE5hdHVyYWxTZWxlY3Rpb25VdGlscy5pc05vbk5lZ2F0aXZlSW50ZWdlciggY291bnQgKSwgJ2ludmFsaWQgY291bnQnICk7XHJcblxyXG4gIGlmICggYXJyYXkubGVuZ3RoID09PSAwIHx8IGFycmF5WyBhcnJheS5sZW5ndGggLSAxIF0ueSAhPT0gY291bnQgKSB7XHJcbiAgICBhcnJheS5wdXNoKCBuZXcgVmVjdG9yMiggdGltZUluR2VuZXJhdGlvbnMsIGNvdW50ICkgKTtcclxuICB9XHJcbn1cclxuXHJcbm5hdHVyYWxTZWxlY3Rpb24ucmVnaXN0ZXIoICdQb3B1bGF0aW9uTW9kZWwnLCBQb3B1bGF0aW9uTW9kZWwgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxxQkFBcUIsTUFBMkIsOENBQThDO0FBQ3JHLE9BQU9DLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsY0FBYyxNQUFNLHVDQUF1QztBQUNsRSxPQUFPQyxRQUFRLE1BQU0saUNBQWlDO0FBRXRELE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxTQUFTLE1BQU0sdUNBQXVDO0FBRTdELE9BQU9DLFlBQVksTUFBK0IsdUNBQXVDO0FBQ3pGLE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxPQUFPQyxxQkFBcUIsTUFBTSw2QkFBNkI7QUFFL0QsT0FBT0MsU0FBUyxNQUFNLGdCQUFnQjtBQUd0QztBQUNBLE1BQU1DLHdCQUF3QixHQUFHLEVBQUU7O0FBRW5DO0FBQ0EsTUFBTUMsU0FBUyxHQUFHLENBQUM7O0FBRW5CO0FBQ0EsTUFBTUMsVUFBVSxHQUFHLENBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUs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