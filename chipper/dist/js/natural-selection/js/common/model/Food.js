// Copyright 2020-2022, University of Colorado Boulder

/**
 * Food is the model of the food supply, a collection of Shrubs.
 * It controls the type (tender or tough) and quantity of food that is available.
 * See also the 'Food' section of model.md at https://github.com/phetsims/natural-selection/blob/master/doc/model.md#food
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Emitter from '../../../../axon/js/Emitter.js';
import dotRandom from '../../../../dot/js/dotRandom.js';
import Random from '../../../../dot/js/Random.js';
import Range from '../../../../dot/js/Range.js';
import Utils from '../../../../dot/js/Utils.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import naturalSelection from '../../naturalSelection.js';
import NaturalSelectionConstants from '../NaturalSelectionConstants.js';
import NaturalSelectionQueryParameters from '../NaturalSelectionQueryParameters.js';
import NaturalSelectionUtils from '../NaturalSelectionUtils.js';
import Shrub from './Shrub.js';

// Food is applied at the midpoint of its clock slice.
// See https://github.com/phetsims/natural-selection/issues/110
const CLOCK_FOOD_MIDPOINT = NaturalSelectionConstants.CLOCK_FOOD_RANGE.getCenter();

// The minimum number of bunnies with long teeth required for tough food to be a factor for bunnies with long teeth,
// see https://github.com/phetsims/natural-selection/issues/98
const TOUGH_FOOD_MIN_LONG_TEETH = 5;

// Margins for placing the shrubs from the edges of the model-view transform, in model coordinates
const SHRUBS_X_MARGIN = 20;
const SHRUBS_Z_MARGIN = 5;
export default class Food {
  // whether either factor related to food is enabled

  // emits when bunnies have died of starvation, param is the time in generations

  // the collection of Shrubs

  /**
   * @param generationClock
   * @param bunnyCollection
   * @param modelViewTransform
   * @param shrubsSeed - seed for random number generator used to position shrubs
   * @param providedOptions
   */
  constructor(generationClock, bunnyCollection, modelViewTransform, shrubsSeed, providedOptions) {
    const options = providedOptions;
    this.bunnyCollection = bunnyCollection;
    this.isToughProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('isToughProperty'),
      phetioDocumentation: 'whether the food supply is tough (true) or tender (false)'
    });
    this.isLimitedProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('isLimitedProperty'),
      phetioDocumentation: 'whether the food supply is limited'
    });
    this.enabledProperty = new DerivedProperty([this.isToughProperty, this.isLimitedProperty], (isTough, isLimited) => isTough || isLimited, {
      tandem: Tandem.OPT_OUT
    });
    this.bunniesStarvedEmitter = new Emitter({
      parameters: [{
        valueType: 'number'
      }] // timeInGenerations at which the event should be recorded
    });

    // Use our own instance of Random to produce positions for shrubs.
    // See https://github.com/phetsims/natural-selection/issues/176
    const random = new Random({
      seed: shrubsSeed
    });

    // Shrubs are placed randomly in the environment.
    // Sprites are assigned to shrubs via ShrubSpritesMap.getNextTenderSprite and getNextToughSprite.
    this.shrubs = [];
    const zRange = new Range(modelViewTransform.getMinimumZ() + SHRUBS_Z_MARGIN, modelViewTransform.getMaximumZ() - SHRUBS_Z_MARGIN);
    const numberOfShrubs = NaturalSelectionQueryParameters.shrubsRange.max;
    for (let i = 0; i < numberOfShrubs; i++) {
      const z = random.nextDoubleInRange(zRange);
      const xRange = new Range(modelViewTransform.getMinimumX(z) + SHRUBS_X_MARGIN, modelViewTransform.getMaximumX(z) - SHRUBS_X_MARGIN);
      const x = random.nextDoubleInRange(xRange);
      this.shrubs.push(new Shrub(modelViewTransform, {
        position: modelViewTransform.getGroundPosition(x, z)
      }));
    }
    phet.log && phet.log(`${numberOfShrubs} shrubs randomly placed using seed ${random.getSeed()}`);

    // unlink is not necessary.
    generationClock.timeInPercentProperty.lazyLink((currentTimeInPercent, previousTimeInPercent) => {
      // Execute this code only when the sim is running normally, not when setting PhET-iO state.
      if (!phet.joist.sim.isSettingPhetioStateProperty.value) {
        // Starve some bunnies at the midpoint of their clock slice.
        // See https://github.com/phetsims/natural-selection/issues/110
        if (this.enabledProperty.value && previousTimeInPercent < CLOCK_FOOD_MIDPOINT && currentTimeInPercent >= CLOCK_FOOD_MIDPOINT) {
          // Ensure that 'starve' event is always recorded at the same time in the clock cycle, regardless of what
          // the actual time is. See https://github.com/phetsims/natural-selection/issues/170.
          const timeInGenerations = generationClock.clockGenerationProperty.value + CLOCK_FOOD_MIDPOINT;
          this.starveBunnies(timeInGenerations);
        }
      }
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
  }
  reset() {
    this.isToughProperty.reset();
    this.isLimitedProperty.reset();
  }

  /**
   * Starves some portion of the bunny population.
   * @param timeInGenerations - the time (in generations) at which this event should be recorded
   */
  starveBunnies(timeInGenerations) {
    assert && assert(this.enabledProperty.value, 'Food is not enabled');
    assert && assert(timeInGenerations >= 0, `invalid timeInGenerations: ${timeInGenerations}`);
    let totalStarved = 0;
    if (this.isToughProperty.value) {
      totalStarved += this.applyToughFood();
    }
    if (this.isLimitedProperty.value) {
      totalStarved += this.applyLimitedFood();
    }

    // Notify if bunnies have been starved.
    if (totalStarved > 0) {
      this.bunniesStarvedEmitter.emit(timeInGenerations);
    }
  }

  /**
   * Applies tough food as a selection factor. Tough food is more difficult to eat, so some of each phenotype will
   * starve. Bunnies with short teeth are less adapted to eating tough food, so a larger percentage of bunnies
   * with short teeth will starve. Tough food has no affect on bunnies with long teeth when their population
   * is below a threshold. See https://github.com/phetsims/natural-selection/issues/98#issuecomment-646275437
   * See also the 'Tough Food' section of model.md at https://github.com/phetsims/natural-selection/blob/master/doc/model.md#tough-food
   * @returns the number of bunnies that died
   */
  applyToughFood() {
    assert && assert(this.isToughProperty.value, 'tough food is not enabled');
    let totalStarved = 0;

    // Get the bunnies that are candidates for selection by environmental factors, in random order.
    const bunnies = this.bunnyCollection.getSelectionCandidates();
    if (bunnies.length > 0) {
      // {Bunny[]} array for each phenotype
      const bunniesShortTeeth = _.filter(bunnies, bunny => bunny.phenotype.hasShortTeeth());
      const numberShortTeeth = bunniesShortTeeth.length;
      const bunniesLongTeeth = _.filter(bunnies, bunny => bunny.phenotype.hasLongTeeth());
      const numberLongTeeth = bunniesLongTeeth.length;
      phet.log && phet.log(`Applying tough food: ${numberShortTeeth} short teeth, ${numberLongTeeth} long teeth`);

      // {number} percentage [0,1] of bunnies to starve for each phenotype, computed below
      let percentToStarveLongTeeth = 0;
      let percentToStarveShortTeeth = 0;
      const percentToStarve = dotRandom.nextDoubleInRange(NaturalSelectionQueryParameters.toughFoodPercentToStarveRange);
      phet.log && phet.log(`randomly selected ${percentToStarve} from toughFoodPercentToStarveRange`);
      percentToStarveShortTeeth = Math.min(1, percentToStarve * NaturalSelectionQueryParameters.shortTeethMultiplier);
      percentToStarveLongTeeth = percentToStarve;
      if (numberLongTeeth < TOUGH_FOOD_MIN_LONG_TEETH) {
        phet.log && phet.log(`Ignoring tough food for long teeth because their count ${numberLongTeeth} is < ${TOUGH_FOOD_MIN_LONG_TEETH}.`);
        percentToStarveLongTeeth = 0;
      }

      // Starve bunnies with short teeth.
      const numberStarvedShortTeeth = starvePercentage(bunniesShortTeeth, percentToStarveShortTeeth);
      phet.log && phet.log(`${numberStarvedShortTeeth} of ${numberShortTeeth} short teeth died from tough food`);
      totalStarved += numberStarvedShortTeeth;

      // Starve bunnies with long teeth.
      const numberStarvedLongTeeth = starvePercentage(bunniesLongTeeth, percentToStarveLongTeeth);
      phet.log && phet.log(`${numberStarvedLongTeeth} of ${numberLongTeeth} long teeth died from tough food`);
      totalStarved += numberStarvedLongTeeth;
    }
    return totalStarved;
  }

  /**
   * Applies limited food as a selection factor. Limited food can support the population up to a specific carrying
   * capacity. If the population exceeds the carrying capacity, then bunnies will die off to reduce the population
   * to the carrying capacity. See https://github.com/phetsims/natural-selection/issues/183
   * See also the 'Limited Food' section of model.md at https://github.com/phetsims/natural-selection/blob/master/doc/model.md#limited-food
   * @returns the number of bunnies that died
   */
  applyLimitedFood() {
    assert && assert(this.isLimitedProperty.value, 'limited food is not enabled');
    let totalStarved = 0;

    // Get the bunnies that are candidates for selection by environmental factors, in random order.
    const bunnies = this.bunnyCollection.getSelectionCandidates();
    const totalBunnies = bunnies.length;

    // Randomly choose the number of bunnies that can be supported by limited food.
    const carryingCapacity = Utils.roundSymmetric(dotRandom.nextDoubleInRange(NaturalSelectionQueryParameters.limitedFoodPopulationRange));
    if (totalBunnies > 0) {
      phet.log && phet.log(`Applying limited food: population is ${totalBunnies}, carrying capacity is ${carryingCapacity}`);
      if (totalBunnies > carryingCapacity) {
        const numberToStarve = totalBunnies - carryingCapacity;
        for (let i = 0; i < numberToStarve; i++) {
          bunnies[i].die();
        }
        totalStarved = numberToStarve;
        phet.log && phet.log(`Carrying capacity exceeded, ${totalStarved} bunnies died from limited food`);
      } else {
        phet.log && phet.log('Carrying capacity not exceeded, no bunnies died from limited food.');
      }
    }
    return totalStarved;
  }
}

/**
 * Starves a percentage of some set of bunnies.
 * @param bunnies - a set of bunnies, all with the same phenotype
 * @param percentToStarve - the percentage of bunnies to starve
 * @returns the number of bunnies that died
 */
function starvePercentage(bunnies, percentToStarve) {
  assert && assert(Array.isArray(bunnies), 'invalid bunnies');
  assert && assert(NaturalSelectionUtils.isPercent(percentToStarve), `invalid percentToStarve: ${percentToStarve}`);
  let numberToStarve = 0;
  if (bunnies.length > 0 && percentToStarve > 0) {
    // Starve at least 1 bunny, if we've gotten this far.
    numberToStarve = Math.max(1, Utils.roundSymmetric(percentToStarve * bunnies.length));
    for (let i = 0; i < numberToStarve; i++) {
      bunnies[i].die();
    }
  }
  return numberToStarve;
}
naturalSelection.register('Food', Food);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJFbWl0dGVyIiwiZG90UmFuZG9tIiwiUmFuZG9tIiwiUmFuZ2UiLCJVdGlscyIsIlRhbmRlbSIsIm5hdHVyYWxTZWxlY3Rpb24iLCJOYXR1cmFsU2VsZWN0aW9uQ29uc3RhbnRzIiwiTmF0dXJhbFNlbGVjdGlvblF1ZXJ5UGFyYW1ldGVycyIsIk5hdHVyYWxTZWxlY3Rpb25VdGlscyIsIlNocnViIiwiQ0xPQ0tfRk9PRF9NSURQT0lOVCIsIkNMT0NLX0ZPT0RfUkFOR0UiLCJnZXRDZW50ZXIiLCJUT1VHSF9GT09EX01JTl9MT05HX1RFRVRIIiwiU0hSVUJTX1hfTUFSR0lOIiwiU0hSVUJTX1pfTUFSR0lOIiwiRm9vZCIsImNvbnN0cnVjdG9yIiwiZ2VuZXJhdGlvbkNsb2NrIiwiYnVubnlDb2xsZWN0aW9uIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwic2hydWJzU2VlZCIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJpc1RvdWdoUHJvcGVydHkiLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJwaGV0aW9Eb2N1bWVudGF0aW9uIiwiaXNMaW1pdGVkUHJvcGVydHkiLCJlbmFibGVkUHJvcGVydHkiLCJpc1RvdWdoIiwiaXNMaW1pdGVkIiwiT1BUX09VVCIsImJ1bm5pZXNTdGFydmVkRW1pdHRlciIsInBhcmFtZXRlcnMiLCJ2YWx1ZVR5cGUiLCJyYW5kb20iLCJzZWVkIiwic2hydWJzIiwielJhbmdlIiwiZ2V0TWluaW11bVoiLCJnZXRNYXhpbXVtWiIsIm51bWJlck9mU2hydWJzIiwic2hydWJzUmFuZ2UiLCJtYXgiLCJpIiwieiIsIm5leHREb3VibGVJblJhbmdlIiwieFJhbmdlIiwiZ2V0TWluaW11bVgiLCJnZXRNYXhpbXVtWCIsIngiLCJwdXNoIiwicG9zaXRpb24iLCJnZXRHcm91bmRQb3NpdGlvbiIsInBoZXQiLCJsb2ciLCJnZXRTZWVkIiwidGltZUluUGVyY2VudFByb3BlcnR5IiwibGF6eUxpbmsiLCJjdXJyZW50VGltZUluUGVyY2VudCIsInByZXZpb3VzVGltZUluUGVyY2VudCIsImpvaXN0Iiwic2ltIiwiaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eSIsInZhbHVlIiwidGltZUluR2VuZXJhdGlvbnMiLCJjbG9ja0dlbmVyYXRpb25Qcm9wZXJ0eSIsInN0YXJ2ZUJ1bm5pZXMiLCJkaXNwb3NlIiwiYXNzZXJ0IiwicmVzZXQiLCJ0b3RhbFN0YXJ2ZWQiLCJhcHBseVRvdWdoRm9vZCIsImFwcGx5TGltaXRlZEZvb2QiLCJlbWl0IiwiYnVubmllcyIsImdldFNlbGVjdGlvbkNhbmRpZGF0ZXMiLCJsZW5ndGgiLCJidW5uaWVzU2hvcnRUZWV0aCIsIl8iLCJmaWx0ZXIiLCJidW5ueSIsInBoZW5vdHlwZSIsImhhc1Nob3J0VGVldGgiLCJudW1iZXJTaG9ydFRlZXRoIiwiYnVubmllc0xvbmdUZWV0aCIsImhhc0xvbmdUZWV0aCIsIm51bWJlckxvbmdUZWV0aCIsInBlcmNlbnRUb1N0YXJ2ZUxvbmdUZWV0aCIsInBlcmNlbnRUb1N0YXJ2ZVNob3J0VGVldGgiLCJwZXJjZW50VG9TdGFydmUiLCJ0b3VnaEZvb2RQZXJjZW50VG9TdGFydmVSYW5nZSIsIk1hdGgiLCJtaW4iLCJzaG9ydFRlZXRoTXVsdGlwbGllciIsIm51bWJlclN0YXJ2ZWRTaG9ydFRlZXRoIiwic3RhcnZlUGVyY2VudGFnZSIsIm51bWJlclN0YXJ2ZWRMb25nVGVldGgiLCJ0b3RhbEJ1bm5pZXMiLCJjYXJyeWluZ0NhcGFjaXR5Iiwicm91bmRTeW1tZXRyaWMiLCJsaW1pdGVkRm9vZFBvcHVsYXRpb25SYW5nZSIsIm51bWJlclRvU3RhcnZlIiwiZGllIiwiQXJyYXkiLCJpc0FycmF5IiwiaXNQZXJjZW50IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJGb29kLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIwLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEZvb2QgaXMgdGhlIG1vZGVsIG9mIHRoZSBmb29kIHN1cHBseSwgYSBjb2xsZWN0aW9uIG9mIFNocnVicy5cclxuICogSXQgY29udHJvbHMgdGhlIHR5cGUgKHRlbmRlciBvciB0b3VnaCkgYW5kIHF1YW50aXR5IG9mIGZvb2QgdGhhdCBpcyBhdmFpbGFibGUuXHJcbiAqIFNlZSBhbHNvIHRoZSAnRm9vZCcgc2VjdGlvbiBvZiBtb2RlbC5tZCBhdCBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbmF0dXJhbC1zZWxlY3Rpb24vYmxvYi9tYXN0ZXIvZG9jL21vZGVsLm1kI2Zvb2RcclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBFbWl0dGVyIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRW1pdHRlci5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgZG90UmFuZG9tIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9kb3RSYW5kb20uanMnO1xyXG5pbXBvcnQgUmFuZG9tIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9SYW5kb20uanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCB7IEVtcHR5U2VsZk9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuaW1wb3J0IHsgUGhldGlvT2JqZWN0T3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9QaGV0aW9PYmplY3QuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgbmF0dXJhbFNlbGVjdGlvbiBmcm9tICcuLi8uLi9uYXR1cmFsU2VsZWN0aW9uLmpzJztcclxuaW1wb3J0IE5hdHVyYWxTZWxlY3Rpb25Db25zdGFudHMgZnJvbSAnLi4vTmF0dXJhbFNlbGVjdGlvbkNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBOYXR1cmFsU2VsZWN0aW9uUXVlcnlQYXJhbWV0ZXJzIGZyb20gJy4uL05hdHVyYWxTZWxlY3Rpb25RdWVyeVBhcmFtZXRlcnMuanMnO1xyXG5pbXBvcnQgTmF0dXJhbFNlbGVjdGlvblV0aWxzIGZyb20gJy4uL05hdHVyYWxTZWxlY3Rpb25VdGlscy5qcyc7XHJcbmltcG9ydCBCdW5ueSBmcm9tICcuL0J1bm55LmpzJztcclxuaW1wb3J0IEJ1bm55Q29sbGVjdGlvbiBmcm9tICcuL0J1bm55Q29sbGVjdGlvbi5qcyc7XHJcbmltcG9ydCBFbnZpcm9ubWVudE1vZGVsVmlld1RyYW5zZm9ybSBmcm9tICcuL0Vudmlyb25tZW50TW9kZWxWaWV3VHJhbnNmb3JtLmpzJztcclxuaW1wb3J0IEdlbmVyYXRpb25DbG9jayBmcm9tICcuL0dlbmVyYXRpb25DbG9jay5qcyc7XHJcbmltcG9ydCBTaHJ1YiBmcm9tICcuL1NocnViLmpzJztcclxuXHJcbi8vIEZvb2QgaXMgYXBwbGllZCBhdCB0aGUgbWlkcG9pbnQgb2YgaXRzIGNsb2NrIHNsaWNlLlxyXG4vLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL25hdHVyYWwtc2VsZWN0aW9uL2lzc3Vlcy8xMTBcclxuY29uc3QgQ0xPQ0tfRk9PRF9NSURQT0lOVCA9IE5hdHVyYWxTZWxlY3Rpb25Db25zdGFudHMuQ0xPQ0tfRk9PRF9SQU5HRS5nZXRDZW50ZXIoKTtcclxuXHJcbi8vIFRoZSBtaW5pbXVtIG51bWJlciBvZiBidW5uaWVzIHdpdGggbG9uZyB0ZWV0aCByZXF1aXJlZCBmb3IgdG91Z2ggZm9vZCB0byBiZSBhIGZhY3RvciBmb3IgYnVubmllcyB3aXRoIGxvbmcgdGVldGgsXHJcbi8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbmF0dXJhbC1zZWxlY3Rpb24vaXNzdWVzLzk4XHJcbmNvbnN0IFRPVUdIX0ZPT0RfTUlOX0xPTkdfVEVFVEggPSA1O1xyXG5cclxuLy8gTWFyZ2lucyBmb3IgcGxhY2luZyB0aGUgc2hydWJzIGZyb20gdGhlIGVkZ2VzIG9mIHRoZSBtb2RlbC12aWV3IHRyYW5zZm9ybSwgaW4gbW9kZWwgY29vcmRpbmF0ZXNcclxuY29uc3QgU0hSVUJTX1hfTUFSR0lOID0gMjA7XHJcbmNvbnN0IFNIUlVCU19aX01BUkdJTiA9IDU7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0gRW1wdHlTZWxmT3B0aW9ucztcclxuXHJcbnR5cGUgRm9vZE9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxQaGV0aW9PYmplY3RPcHRpb25zLCAndGFuZGVtJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGb29kIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBidW5ueUNvbGxlY3Rpb246IEJ1bm55Q29sbGVjdGlvbjtcclxuICBwdWJsaWMgcmVhZG9ubHkgaXNUb3VnaFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgaXNMaW1pdGVkUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyB3aGV0aGVyIGVpdGhlciBmYWN0b3IgcmVsYXRlZCB0byBmb29kIGlzIGVuYWJsZWRcclxuICBwdWJsaWMgcmVhZG9ubHkgZW5hYmxlZFByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gZW1pdHMgd2hlbiBidW5uaWVzIGhhdmUgZGllZCBvZiBzdGFydmF0aW9uLCBwYXJhbSBpcyB0aGUgdGltZSBpbiBnZW5lcmF0aW9uc1xyXG4gIHB1YmxpYyByZWFkb25seSBidW5uaWVzU3RhcnZlZEVtaXR0ZXI6IEVtaXR0ZXI8W251bWJlcl0+O1xyXG5cclxuICAvLyB0aGUgY29sbGVjdGlvbiBvZiBTaHJ1YnNcclxuICBwdWJsaWMgcmVhZG9ubHkgc2hydWJzOiBTaHJ1YltdO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gZ2VuZXJhdGlvbkNsb2NrXHJcbiAgICogQHBhcmFtIGJ1bm55Q29sbGVjdGlvblxyXG4gICAqIEBwYXJhbSBtb2RlbFZpZXdUcmFuc2Zvcm1cclxuICAgKiBAcGFyYW0gc2hydWJzU2VlZCAtIHNlZWQgZm9yIHJhbmRvbSBudW1iZXIgZ2VuZXJhdG9yIHVzZWQgdG8gcG9zaXRpb24gc2hydWJzXHJcbiAgICogQHBhcmFtIHByb3ZpZGVkT3B0aW9uc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggZ2VuZXJhdGlvbkNsb2NrOiBHZW5lcmF0aW9uQ2xvY2ssIGJ1bm55Q29sbGVjdGlvbjogQnVubnlDb2xsZWN0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtOiBFbnZpcm9ubWVudE1vZGVsVmlld1RyYW5zZm9ybSwgc2hydWJzU2VlZDogbnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWRPcHRpb25zOiBGb29kT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gcHJvdmlkZWRPcHRpb25zO1xyXG5cclxuICAgIHRoaXMuYnVubnlDb2xsZWN0aW9uID0gYnVubnlDb2xsZWN0aW9uO1xyXG5cclxuICAgIHRoaXMuaXNUb3VnaFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdpc1RvdWdoUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICd3aGV0aGVyIHRoZSBmb29kIHN1cHBseSBpcyB0b3VnaCAodHJ1ZSkgb3IgdGVuZGVyIChmYWxzZSknXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5pc0xpbWl0ZWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnaXNMaW1pdGVkUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICd3aGV0aGVyIHRoZSBmb29kIHN1cHBseSBpcyBsaW1pdGVkJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZW5hYmxlZFByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eShcclxuICAgICAgWyB0aGlzLmlzVG91Z2hQcm9wZXJ0eSwgdGhpcy5pc0xpbWl0ZWRQcm9wZXJ0eSBdLFxyXG4gICAgICAoIGlzVG91Z2gsIGlzTGltaXRlZCApID0+ICggaXNUb3VnaCB8fCBpc0xpbWl0ZWQgKSwge1xyXG4gICAgICAgIHRhbmRlbTogVGFuZGVtLk9QVF9PVVRcclxuICAgICAgfSApO1xyXG5cclxuICAgIHRoaXMuYnVubmllc1N0YXJ2ZWRFbWl0dGVyID0gbmV3IEVtaXR0ZXIoIHtcclxuICAgICAgcGFyYW1ldGVyczogWyB7IHZhbHVlVHlwZTogJ251bWJlcicgfSBdIC8vIHRpbWVJbkdlbmVyYXRpb25zIGF0IHdoaWNoIHRoZSBldmVudCBzaG91bGQgYmUgcmVjb3JkZWRcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBVc2Ugb3VyIG93biBpbnN0YW5jZSBvZiBSYW5kb20gdG8gcHJvZHVjZSBwb3NpdGlvbnMgZm9yIHNocnVicy5cclxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbmF0dXJhbC1zZWxlY3Rpb24vaXNzdWVzLzE3NlxyXG4gICAgY29uc3QgcmFuZG9tID0gbmV3IFJhbmRvbSggeyBzZWVkOiBzaHJ1YnNTZWVkIH0gKTtcclxuXHJcbiAgICAvLyBTaHJ1YnMgYXJlIHBsYWNlZCByYW5kb21seSBpbiB0aGUgZW52aXJvbm1lbnQuXHJcbiAgICAvLyBTcHJpdGVzIGFyZSBhc3NpZ25lZCB0byBzaHJ1YnMgdmlhIFNocnViU3ByaXRlc01hcC5nZXROZXh0VGVuZGVyU3ByaXRlIGFuZCBnZXROZXh0VG91Z2hTcHJpdGUuXHJcbiAgICB0aGlzLnNocnVicyA9IFtdO1xyXG4gICAgY29uc3QgelJhbmdlID0gbmV3IFJhbmdlKCBtb2RlbFZpZXdUcmFuc2Zvcm0uZ2V0TWluaW11bVooKSArIFNIUlVCU19aX01BUkdJTiwgbW9kZWxWaWV3VHJhbnNmb3JtLmdldE1heGltdW1aKCkgLSBTSFJVQlNfWl9NQVJHSU4gKTtcclxuICAgIGNvbnN0IG51bWJlck9mU2hydWJzID0gTmF0dXJhbFNlbGVjdGlvblF1ZXJ5UGFyYW1ldGVycy5zaHJ1YnNSYW5nZS5tYXg7XHJcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBudW1iZXJPZlNocnViczsgaSsrICkge1xyXG4gICAgICBjb25zdCB6ID0gcmFuZG9tLm5leHREb3VibGVJblJhbmdlKCB6UmFuZ2UgKTtcclxuICAgICAgY29uc3QgeFJhbmdlID0gbmV3IFJhbmdlKCBtb2RlbFZpZXdUcmFuc2Zvcm0uZ2V0TWluaW11bVgoIHogKSArIFNIUlVCU19YX01BUkdJTiwgbW9kZWxWaWV3VHJhbnNmb3JtLmdldE1heGltdW1YKCB6ICkgLSBTSFJVQlNfWF9NQVJHSU4gKTtcclxuICAgICAgY29uc3QgeCA9IHJhbmRvbS5uZXh0RG91YmxlSW5SYW5nZSggeFJhbmdlICk7XHJcbiAgICAgIHRoaXMuc2hydWJzLnB1c2goIG5ldyBTaHJ1YiggbW9kZWxWaWV3VHJhbnNmb3JtLCB7XHJcbiAgICAgICAgcG9zaXRpb246IG1vZGVsVmlld1RyYW5zZm9ybS5nZXRHcm91bmRQb3NpdGlvbiggeCwgeiApXHJcbiAgICAgIH0gKSApO1xyXG4gICAgfVxyXG4gICAgcGhldC5sb2cgJiYgcGhldC5sb2coIGAke251bWJlck9mU2hydWJzfSBzaHJ1YnMgcmFuZG9tbHkgcGxhY2VkIHVzaW5nIHNlZWQgJHtyYW5kb20uZ2V0U2VlZCgpfWAgKTtcclxuXHJcbiAgICAvLyB1bmxpbmsgaXMgbm90IG5lY2Vzc2FyeS5cclxuICAgIGdlbmVyYXRpb25DbG9jay50aW1lSW5QZXJjZW50UHJvcGVydHkubGF6eUxpbmsoICggY3VycmVudFRpbWVJblBlcmNlbnQsIHByZXZpb3VzVGltZUluUGVyY2VudCApID0+IHtcclxuXHJcbiAgICAgIC8vIEV4ZWN1dGUgdGhpcyBjb2RlIG9ubHkgd2hlbiB0aGUgc2ltIGlzIHJ1bm5pbmcgbm9ybWFsbHksIG5vdCB3aGVuIHNldHRpbmcgUGhFVC1pTyBzdGF0ZS5cclxuICAgICAgaWYgKCAhcGhldC5qb2lzdC5zaW0uaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eS52YWx1ZSApIHtcclxuXHJcbiAgICAgICAgLy8gU3RhcnZlIHNvbWUgYnVubmllcyBhdCB0aGUgbWlkcG9pbnQgb2YgdGhlaXIgY2xvY2sgc2xpY2UuXHJcbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9uYXR1cmFsLXNlbGVjdGlvbi9pc3N1ZXMvMTEwXHJcbiAgICAgICAgaWYgKCB0aGlzLmVuYWJsZWRQcm9wZXJ0eS52YWx1ZSAmJlxyXG4gICAgICAgICAgICAgcHJldmlvdXNUaW1lSW5QZXJjZW50IDwgQ0xPQ0tfRk9PRF9NSURQT0lOVCAmJiBjdXJyZW50VGltZUluUGVyY2VudCA+PSBDTE9DS19GT09EX01JRFBPSU5UICkge1xyXG5cclxuICAgICAgICAgIC8vIEVuc3VyZSB0aGF0ICdzdGFydmUnIGV2ZW50IGlzIGFsd2F5cyByZWNvcmRlZCBhdCB0aGUgc2FtZSB0aW1lIGluIHRoZSBjbG9jayBjeWNsZSwgcmVnYXJkbGVzcyBvZiB3aGF0XHJcbiAgICAgICAgICAvLyB0aGUgYWN0dWFsIHRpbWUgaXMuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbmF0dXJhbC1zZWxlY3Rpb24vaXNzdWVzLzE3MC5cclxuICAgICAgICAgIGNvbnN0IHRpbWVJbkdlbmVyYXRpb25zID0gZ2VuZXJhdGlvbkNsb2NrLmNsb2NrR2VuZXJhdGlvblByb3BlcnR5LnZhbHVlICsgQ0xPQ0tfRk9PRF9NSURQT0lOVDtcclxuICAgICAgICAgIHRoaXMuc3RhcnZlQnVubmllcyggdGltZUluR2VuZXJhdGlvbnMgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLmlzVG91Z2hQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5pc0xpbWl0ZWRQcm9wZXJ0eS5yZXNldCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnZlcyBzb21lIHBvcnRpb24gb2YgdGhlIGJ1bm55IHBvcHVsYXRpb24uXHJcbiAgICogQHBhcmFtIHRpbWVJbkdlbmVyYXRpb25zIC0gdGhlIHRpbWUgKGluIGdlbmVyYXRpb25zKSBhdCB3aGljaCB0aGlzIGV2ZW50IHNob3VsZCBiZSByZWNvcmRlZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhcnZlQnVubmllcyggdGltZUluR2VuZXJhdGlvbnM6IG51bWJlciApOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuZW5hYmxlZFByb3BlcnR5LnZhbHVlLCAnRm9vZCBpcyBub3QgZW5hYmxlZCcgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRpbWVJbkdlbmVyYXRpb25zID49IDAsIGBpbnZhbGlkIHRpbWVJbkdlbmVyYXRpb25zOiAke3RpbWVJbkdlbmVyYXRpb25zfWAgKTtcclxuXHJcbiAgICBsZXQgdG90YWxTdGFydmVkID0gMDtcclxuICAgIGlmICggdGhpcy5pc1RvdWdoUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgIHRvdGFsU3RhcnZlZCArPSB0aGlzLmFwcGx5VG91Z2hGb29kKCk7XHJcbiAgICB9XHJcbiAgICBpZiAoIHRoaXMuaXNMaW1pdGVkUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgIHRvdGFsU3RhcnZlZCArPSB0aGlzLmFwcGx5TGltaXRlZEZvb2QoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBOb3RpZnkgaWYgYnVubmllcyBoYXZlIGJlZW4gc3RhcnZlZC5cclxuICAgIGlmICggdG90YWxTdGFydmVkID4gMCApIHtcclxuICAgICAgdGhpcy5idW5uaWVzU3RhcnZlZEVtaXR0ZXIuZW1pdCggdGltZUluR2VuZXJhdGlvbnMgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFwcGxpZXMgdG91Z2ggZm9vZCBhcyBhIHNlbGVjdGlvbiBmYWN0b3IuIFRvdWdoIGZvb2QgaXMgbW9yZSBkaWZmaWN1bHQgdG8gZWF0LCBzbyBzb21lIG9mIGVhY2ggcGhlbm90eXBlIHdpbGxcclxuICAgKiBzdGFydmUuIEJ1bm5pZXMgd2l0aCBzaG9ydCB0ZWV0aCBhcmUgbGVzcyBhZGFwdGVkIHRvIGVhdGluZyB0b3VnaCBmb29kLCBzbyBhIGxhcmdlciBwZXJjZW50YWdlIG9mIGJ1bm5pZXNcclxuICAgKiB3aXRoIHNob3J0IHRlZXRoIHdpbGwgc3RhcnZlLiBUb3VnaCBmb29kIGhhcyBubyBhZmZlY3Qgb24gYnVubmllcyB3aXRoIGxvbmcgdGVldGggd2hlbiB0aGVpciBwb3B1bGF0aW9uXHJcbiAgICogaXMgYmVsb3cgYSB0aHJlc2hvbGQuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbmF0dXJhbC1zZWxlY3Rpb24vaXNzdWVzLzk4I2lzc3VlY29tbWVudC02NDYyNzU0MzdcclxuICAgKiBTZWUgYWxzbyB0aGUgJ1RvdWdoIEZvb2QnIHNlY3Rpb24gb2YgbW9kZWwubWQgYXQgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL25hdHVyYWwtc2VsZWN0aW9uL2Jsb2IvbWFzdGVyL2RvYy9tb2RlbC5tZCN0b3VnaC1mb29kXHJcbiAgICogQHJldHVybnMgdGhlIG51bWJlciBvZiBidW5uaWVzIHRoYXQgZGllZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXBwbHlUb3VnaEZvb2QoKTogbnVtYmVyIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuaXNUb3VnaFByb3BlcnR5LnZhbHVlLCAndG91Z2ggZm9vZCBpcyBub3QgZW5hYmxlZCcgKTtcclxuXHJcbiAgICBsZXQgdG90YWxTdGFydmVkID0gMDtcclxuXHJcbiAgICAvLyBHZXQgdGhlIGJ1bm5pZXMgdGhhdCBhcmUgY2FuZGlkYXRlcyBmb3Igc2VsZWN0aW9uIGJ5IGVudmlyb25tZW50YWwgZmFjdG9ycywgaW4gcmFuZG9tIG9yZGVyLlxyXG4gICAgY29uc3QgYnVubmllcyA9IHRoaXMuYnVubnlDb2xsZWN0aW9uLmdldFNlbGVjdGlvbkNhbmRpZGF0ZXMoKTtcclxuXHJcbiAgICBpZiAoIGJ1bm5pZXMubGVuZ3RoID4gMCApIHtcclxuXHJcbiAgICAgIC8vIHtCdW5ueVtdfSBhcnJheSBmb3IgZWFjaCBwaGVub3R5cGVcclxuICAgICAgY29uc3QgYnVubmllc1Nob3J0VGVldGggPSBfLmZpbHRlciggYnVubmllcywgYnVubnkgPT4gYnVubnkucGhlbm90eXBlLmhhc1Nob3J0VGVldGgoKSApO1xyXG4gICAgICBjb25zdCBudW1iZXJTaG9ydFRlZXRoID0gYnVubmllc1Nob3J0VGVldGgubGVuZ3RoO1xyXG4gICAgICBjb25zdCBidW5uaWVzTG9uZ1RlZXRoID0gXy5maWx0ZXIoIGJ1bm5pZXMsIGJ1bm55ID0+IGJ1bm55LnBoZW5vdHlwZS5oYXNMb25nVGVldGgoKSApO1xyXG4gICAgICBjb25zdCBudW1iZXJMb25nVGVldGggPSBidW5uaWVzTG9uZ1RlZXRoLmxlbmd0aDtcclxuICAgICAgcGhldC5sb2cgJiYgcGhldC5sb2coIGBBcHBseWluZyB0b3VnaCBmb29kOiAke251bWJlclNob3J0VGVldGh9IHNob3J0IHRlZXRoLCAke251bWJlckxvbmdUZWV0aH0gbG9uZyB0ZWV0aGAgKTtcclxuXHJcbiAgICAgIC8vIHtudW1iZXJ9IHBlcmNlbnRhZ2UgWzAsMV0gb2YgYnVubmllcyB0byBzdGFydmUgZm9yIGVhY2ggcGhlbm90eXBlLCBjb21wdXRlZCBiZWxvd1xyXG4gICAgICBsZXQgcGVyY2VudFRvU3RhcnZlTG9uZ1RlZXRoID0gMDtcclxuICAgICAgbGV0IHBlcmNlbnRUb1N0YXJ2ZVNob3J0VGVldGggPSAwO1xyXG5cclxuICAgICAgY29uc3QgcGVyY2VudFRvU3RhcnZlID0gZG90UmFuZG9tLm5leHREb3VibGVJblJhbmdlKCBOYXR1cmFsU2VsZWN0aW9uUXVlcnlQYXJhbWV0ZXJzLnRvdWdoRm9vZFBlcmNlbnRUb1N0YXJ2ZVJhbmdlICk7XHJcbiAgICAgIHBoZXQubG9nICYmIHBoZXQubG9nKCBgcmFuZG9tbHkgc2VsZWN0ZWQgJHtwZXJjZW50VG9TdGFydmV9IGZyb20gdG91Z2hGb29kUGVyY2VudFRvU3RhcnZlUmFuZ2VgICk7XHJcbiAgICAgIHBlcmNlbnRUb1N0YXJ2ZVNob3J0VGVldGggPSBNYXRoLm1pbiggMSwgcGVyY2VudFRvU3RhcnZlICogTmF0dXJhbFNlbGVjdGlvblF1ZXJ5UGFyYW1ldGVycy5zaG9ydFRlZXRoTXVsdGlwbGllciApO1xyXG4gICAgICBwZXJjZW50VG9TdGFydmVMb25nVGVldGggPSBwZXJjZW50VG9TdGFydmU7XHJcbiAgICAgIGlmICggbnVtYmVyTG9uZ1RlZXRoIDwgVE9VR0hfRk9PRF9NSU5fTE9OR19URUVUSCApIHtcclxuICAgICAgICBwaGV0LmxvZyAmJiBwaGV0LmxvZyggYElnbm9yaW5nIHRvdWdoIGZvb2QgZm9yIGxvbmcgdGVldGggYmVjYXVzZSB0aGVpciBjb3VudCAke251bWJlckxvbmdUZWV0aH0gaXMgPCAke1RPVUdIX0ZPT0RfTUlOX0xPTkdfVEVFVEh9LmAgKTtcclxuICAgICAgICBwZXJjZW50VG9TdGFydmVMb25nVGVldGggPSAwO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBTdGFydmUgYnVubmllcyB3aXRoIHNob3J0IHRlZXRoLlxyXG4gICAgICBjb25zdCBudW1iZXJTdGFydmVkU2hvcnRUZWV0aCA9IHN0YXJ2ZVBlcmNlbnRhZ2UoIGJ1bm5pZXNTaG9ydFRlZXRoLCBwZXJjZW50VG9TdGFydmVTaG9ydFRlZXRoICk7XHJcbiAgICAgIHBoZXQubG9nICYmIHBoZXQubG9nKCBgJHtudW1iZXJTdGFydmVkU2hvcnRUZWV0aH0gb2YgJHtudW1iZXJTaG9ydFRlZXRofSBzaG9ydCB0ZWV0aCBkaWVkIGZyb20gdG91Z2ggZm9vZGAgKTtcclxuICAgICAgdG90YWxTdGFydmVkICs9IG51bWJlclN0YXJ2ZWRTaG9ydFRlZXRoO1xyXG5cclxuICAgICAgLy8gU3RhcnZlIGJ1bm5pZXMgd2l0aCBsb25nIHRlZXRoLlxyXG4gICAgICBjb25zdCBudW1iZXJTdGFydmVkTG9uZ1RlZXRoID0gc3RhcnZlUGVyY2VudGFnZSggYnVubmllc0xvbmdUZWV0aCwgcGVyY2VudFRvU3RhcnZlTG9uZ1RlZXRoICk7XHJcbiAgICAgIHBoZXQubG9nICYmIHBoZXQubG9nKCBgJHtudW1iZXJTdGFydmVkTG9uZ1RlZXRofSBvZiAke251bWJlckxvbmdUZWV0aH0gbG9uZyB0ZWV0aCBkaWVkIGZyb20gdG91Z2ggZm9vZGAgKTtcclxuICAgICAgdG90YWxTdGFydmVkICs9IG51bWJlclN0YXJ2ZWRMb25nVGVldGg7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRvdGFsU3RhcnZlZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFwcGxpZXMgbGltaXRlZCBmb29kIGFzIGEgc2VsZWN0aW9uIGZhY3Rvci4gTGltaXRlZCBmb29kIGNhbiBzdXBwb3J0IHRoZSBwb3B1bGF0aW9uIHVwIHRvIGEgc3BlY2lmaWMgY2FycnlpbmdcclxuICAgKiBjYXBhY2l0eS4gSWYgdGhlIHBvcHVsYXRpb24gZXhjZWVkcyB0aGUgY2FycnlpbmcgY2FwYWNpdHksIHRoZW4gYnVubmllcyB3aWxsIGRpZSBvZmYgdG8gcmVkdWNlIHRoZSBwb3B1bGF0aW9uXHJcbiAgICogdG8gdGhlIGNhcnJ5aW5nIGNhcGFjaXR5LiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL25hdHVyYWwtc2VsZWN0aW9uL2lzc3Vlcy8xODNcclxuICAgKiBTZWUgYWxzbyB0aGUgJ0xpbWl0ZWQgRm9vZCcgc2VjdGlvbiBvZiBtb2RlbC5tZCBhdCBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbmF0dXJhbC1zZWxlY3Rpb24vYmxvYi9tYXN0ZXIvZG9jL21vZGVsLm1kI2xpbWl0ZWQtZm9vZFxyXG4gICAqIEByZXR1cm5zIHRoZSBudW1iZXIgb2YgYnVubmllcyB0aGF0IGRpZWRcclxuICAgKi9cclxuICBwcml2YXRlIGFwcGx5TGltaXRlZEZvb2QoKTogbnVtYmVyIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMuaXNMaW1pdGVkUHJvcGVydHkudmFsdWUsICdsaW1pdGVkIGZvb2QgaXMgbm90IGVuYWJsZWQnICk7XHJcblxyXG4gICAgbGV0IHRvdGFsU3RhcnZlZCA9IDA7XHJcblxyXG4gICAgLy8gR2V0IHRoZSBidW5uaWVzIHRoYXQgYXJlIGNhbmRpZGF0ZXMgZm9yIHNlbGVjdGlvbiBieSBlbnZpcm9ubWVudGFsIGZhY3RvcnMsIGluIHJhbmRvbSBvcmRlci5cclxuICAgIGNvbnN0IGJ1bm5pZXMgPSB0aGlzLmJ1bm55Q29sbGVjdGlvbi5nZXRTZWxlY3Rpb25DYW5kaWRhdGVzKCk7XHJcbiAgICBjb25zdCB0b3RhbEJ1bm5pZXMgPSBidW5uaWVzLmxlbmd0aDtcclxuXHJcbiAgICAvLyBSYW5kb21seSBjaG9vc2UgdGhlIG51bWJlciBvZiBidW5uaWVzIHRoYXQgY2FuIGJlIHN1cHBvcnRlZCBieSBsaW1pdGVkIGZvb2QuXHJcbiAgICBjb25zdCBjYXJyeWluZ0NhcGFjaXR5ID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIGRvdFJhbmRvbS5uZXh0RG91YmxlSW5SYW5nZSggTmF0dXJhbFNlbGVjdGlvblF1ZXJ5UGFyYW1ldGVycy5saW1pdGVkRm9vZFBvcHVsYXRpb25SYW5nZSApICk7XHJcblxyXG4gICAgaWYgKCB0b3RhbEJ1bm5pZXMgPiAwICkge1xyXG4gICAgICBwaGV0LmxvZyAmJiBwaGV0LmxvZyggYEFwcGx5aW5nIGxpbWl0ZWQgZm9vZDogcG9wdWxhdGlvbiBpcyAke3RvdGFsQnVubmllc30sIGNhcnJ5aW5nIGNhcGFjaXR5IGlzICR7Y2FycnlpbmdDYXBhY2l0eX1gICk7XHJcblxyXG4gICAgICBpZiAoIHRvdGFsQnVubmllcyA+IGNhcnJ5aW5nQ2FwYWNpdHkgKSB7XHJcbiAgICAgICAgY29uc3QgbnVtYmVyVG9TdGFydmUgPSB0b3RhbEJ1bm5pZXMgLSBjYXJyeWluZ0NhcGFjaXR5O1xyXG4gICAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IG51bWJlclRvU3RhcnZlOyBpKysgKSB7XHJcbiAgICAgICAgICBidW5uaWVzWyBpIF0uZGllKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRvdGFsU3RhcnZlZCA9IG51bWJlclRvU3RhcnZlO1xyXG4gICAgICAgIHBoZXQubG9nICYmIHBoZXQubG9nKCBgQ2FycnlpbmcgY2FwYWNpdHkgZXhjZWVkZWQsICR7dG90YWxTdGFydmVkfSBidW5uaWVzIGRpZWQgZnJvbSBsaW1pdGVkIGZvb2RgICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcGhldC5sb2cgJiYgcGhldC5sb2coICdDYXJyeWluZyBjYXBhY2l0eSBub3QgZXhjZWVkZWQsIG5vIGJ1bm5pZXMgZGllZCBmcm9tIGxpbWl0ZWQgZm9vZC4nICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdG90YWxTdGFydmVkO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFN0YXJ2ZXMgYSBwZXJjZW50YWdlIG9mIHNvbWUgc2V0IG9mIGJ1bm5pZXMuXHJcbiAqIEBwYXJhbSBidW5uaWVzIC0gYSBzZXQgb2YgYnVubmllcywgYWxsIHdpdGggdGhlIHNhbWUgcGhlbm90eXBlXHJcbiAqIEBwYXJhbSBwZXJjZW50VG9TdGFydmUgLSB0aGUgcGVyY2VudGFnZSBvZiBidW5uaWVzIHRvIHN0YXJ2ZVxyXG4gKiBAcmV0dXJucyB0aGUgbnVtYmVyIG9mIGJ1bm5pZXMgdGhhdCBkaWVkXHJcbiAqL1xyXG5mdW5jdGlvbiBzdGFydmVQZXJjZW50YWdlKCBidW5uaWVzOiBCdW5ueVtdLCBwZXJjZW50VG9TdGFydmU6IG51bWJlciApOiBudW1iZXIge1xyXG5cclxuICBhc3NlcnQgJiYgYXNzZXJ0KCBBcnJheS5pc0FycmF5KCBidW5uaWVzICksICdpbnZhbGlkIGJ1bm5pZXMnICk7XHJcbiAgYXNzZXJ0ICYmIGFzc2VydCggTmF0dXJhbFNlbGVjdGlvblV0aWxzLmlzUGVyY2VudCggcGVyY2VudFRvU3RhcnZlICksIGBpbnZhbGlkIHBlcmNlbnRUb1N0YXJ2ZTogJHtwZXJjZW50VG9TdGFydmV9YCApO1xyXG5cclxuICBsZXQgbnVtYmVyVG9TdGFydmUgPSAwO1xyXG5cclxuICBpZiAoIGJ1bm5pZXMubGVuZ3RoID4gMCAmJiBwZXJjZW50VG9TdGFydmUgPiAwICkge1xyXG5cclxuICAgIC8vIFN0YXJ2ZSBhdCBsZWFzdCAxIGJ1bm55LCBpZiB3ZSd2ZSBnb3R0ZW4gdGhpcyBmYXIuXHJcbiAgICBudW1iZXJUb1N0YXJ2ZSA9IE1hdGgubWF4KCAxLCBVdGlscy5yb3VuZFN5bW1ldHJpYyggcGVyY2VudFRvU3RhcnZlICogYnVubmllcy5sZW5ndGggKSApO1xyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgbnVtYmVyVG9TdGFydmU7IGkrKyApIHtcclxuICAgICAgYnVubmllc1sgaSBdLmRpZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG51bWJlclRvU3RhcnZlO1xyXG59XHJcblxyXG5uYXR1cmFsU2VsZWN0aW9uLnJlZ2lzdGVyKCAnRm9vZCcsIEZvb2QgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxPQUFPLE1BQU0sZ0NBQWdDO0FBR3BELE9BQU9DLFNBQVMsTUFBTSxpQ0FBaUM7QUFDdkQsT0FBT0MsTUFBTSxNQUFNLDhCQUE4QjtBQUNqRCxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFJL0MsT0FBT0MsTUFBTSxNQUFNLGlDQUFpQztBQUNwRCxPQUFPQyxnQkFBZ0IsTUFBTSwyQkFBMkI7QUFDeEQsT0FBT0MseUJBQXlCLE1BQU0saUNBQWlDO0FBQ3ZFLE9BQU9DLCtCQUErQixNQUFNLHVDQUF1QztBQUNuRixPQUFPQyxxQkFBcUIsTUFBTSw2QkFBNkI7QUFLL0QsT0FBT0MsS0FBSyxNQUFNLFlBQVk7O0FBRTlCO0FBQ0E7QUFDQSxNQUFNQyxtQkFBbUIsR0FBR0oseUJBQXlCLENBQUNLLGdCQUFnQixDQUFDQyxTQUFTLENBQUMsQ0FBQzs7QUFFbEY7QUFDQTtBQUNBLE1BQU1DLHlCQUF5QixHQUFHLENBQUM7O0FBRW5DO0FBQ0EsTUFBTUMsZUFBZSxHQUFHLEVBQUU7QUFDMUIsTUFBTUMsZUFBZSxHQUFHLENBQUM7QUFNekIsZUFBZSxNQUFNQyxJQUFJLENBQUM7RUFNeEI7O0VBR0E7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