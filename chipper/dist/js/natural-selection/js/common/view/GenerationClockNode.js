// Copyright 2019-2022, University of Colorado Boulder

/**
 * GenerationClockNode is the clock that does one complete revolution per generation.
 * It displays a clock slice for each environmental factor, to denote when they will be active.
 * We commonly refer to times, like 12:00, as if this were a standard wall clock.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import { Shape } from '../../../../kite/js/imports.js';
import PatternStringProperty from '../../../../axon/js/PatternStringProperty.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Circle, Node, Path, Text } from '../../../../scenery/js/imports.js';
import StringIO from '../../../../tandem/js/types/StringIO.js';
import naturalSelection from '../../naturalSelection.js';
import NaturalSelectionStrings from '../../NaturalSelectionStrings.js';
import NaturalSelectionColors from '../NaturalSelectionColors.js';
import NaturalSelectionConstants from '../NaturalSelectionConstants.js';
import optionize from '../../../../phet-core/js/optionize.js';

// constants
const START_ANGLE = -Math.PI / 2; // 12:00
const RADIUS = 18;
const LINE_WIDTH = 1;
const GENERATION_FONT = new PhetFont(14);
export default class GenerationClockNode extends Node {
  constructor(generationClock, foodEnabledProperty, wolvesEnabledProperty, providedOptions) {
    const options = optionize()({
      // empty optionize because we will be setting options.children below
    }, providedOptions);

    // The full center of the clock.
    const circle = new Circle(RADIUS, {
      fill: NaturalSelectionColors.CLOCK_FILL
    });

    // Rim around the outside edge
    const rimNode = new Circle(RADIUS, {
      stroke: NaturalSelectionColors.CLOCK_STROKE,
      lineWidth: LINE_WIDTH
    });

    // The clock slice that denotes when food is active
    const foodSliceNode = createSliceNode(NaturalSelectionConstants.CLOCK_FOOD_RANGE, NaturalSelectionColors.CLOCK_FOOD_SLICE_COLOR, RADIUS);

    // The clock slice that denotes when the wolves are active
    const wolvesSliceNode = createSliceNode(NaturalSelectionConstants.CLOCK_WOLVES_RANGE, NaturalSelectionColors.CLOCK_WOLVES_SLICE_COLOR, RADIUS);

    // Overlay on the clock, sweeps out an arc to reveal what's under it.
    // The portion revealed corresponds to the percentage of a revolution that has elapsed.
    const revealArc = new Path(new Shape(), {
      fill: NaturalSelectionColors.CLOCK_REVEAL_COLOR,
      stroke: NaturalSelectionColors.CLOCK_STROKE,
      lineWidth: LINE_WIDTH
    });

    // The current generation number, displayed below the circle.
    const generationNumberTextTandem = options.tandem.createTandem('generationNumberText');
    const generationDerivedStringProperty = new PatternStringProperty(NaturalSelectionStrings.generationValueStringProperty, {
      value: generationClock.clockGenerationProperty
    }, {
      tandem: generationNumberTextTandem.createTandem(Text.STRING_PROPERTY_TANDEM_NAME),
      phetioValueType: StringIO
    });
    const generationNumberText = new Text(generationDerivedStringProperty, {
      font: GENERATION_FONT,
      fill: 'black',
      top: circle.bottom + 3,
      maxWidth: 100,
      // determined empirically
      tandem: generationNumberTextTandem
    });

    // Keep the generation number centered below the circular part of the clock.
    generationNumberText.boundsProperty.link(() => {
      generationNumberText.centerX = circle.centerX;
    });

    // Layering order is important here!
    options.children = [circle, foodSliceNode, wolvesSliceNode, revealArc, rimNode, generationNumberText];
    super(options);

    // Reveal part of the clock. unlink is not necessary.
    generationClock.timeInPercentProperty.link(timeInPercent => {
      revealArc.shape = new Shape().moveTo(0, 0).arc(0, 0, RADIUS, START_ANGLE + timeInPercent * 2 * Math.PI, START_ANGLE + 2 * Math.PI).close();
    });

    // Makes the wolves clock slice visible. unlink is not necessary.
    wolvesEnabledProperty.link(enabled => {
      wolvesSliceNode.visible = enabled;
    });

    // Makes the food clock slice visible. unlink is not necessary.
    foodEnabledProperty.link(enabled => {
      foodSliceNode.visible = enabled;
    });

    // Create a Studio link to the model
    this.addLinkedElement(generationClock, {
      tandem: options.tandem.createTandem('generationClock')
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }

  /**
   * Creates an icon with one slice of the clock filled in.
   */
  static createSliceIcon(sliceRange, sliceColor, radius = 10) {
    const sliceNode = createSliceNode(sliceRange, sliceColor, radius);
    const rimNode = new Circle(radius, {
      stroke: NaturalSelectionColors.CLOCK_STROKE
    });
    return new Node({
      children: [sliceNode, rimNode]
    });
  }
}

/**
 * Creates a slice of the pie that is the generation clock.
 * @param radius
 * @param range - range between 0 and 1, starting at 12:00 and going clockwise
 * @param color
 */
function createSliceNode(range, color, radius) {
  assert && assert(range.min >= 0 && range.max <= 1, 'invalid range');
  assert && assert(radius > 0);
  const startAngle = START_ANGLE + range.min * 2 * Math.PI;
  const endAngle = START_ANGLE + range.max * 2 * Math.PI;
  const shape = new Shape().moveTo(0, 0).arc(0, 0, radius, startAngle, endAngle).close();
  return new Path(shape, {
    fill: color
  });
}
naturalSelection.register('GenerationClockNode', GenerationClockNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTaGFwZSIsIlBhdHRlcm5TdHJpbmdQcm9wZXJ0eSIsIlBoZXRGb250IiwiQ2lyY2xlIiwiTm9kZSIsIlBhdGgiLCJUZXh0IiwiU3RyaW5nSU8iLCJuYXR1cmFsU2VsZWN0aW9uIiwiTmF0dXJhbFNlbGVjdGlvblN0cmluZ3MiLCJOYXR1cmFsU2VsZWN0aW9uQ29sb3JzIiwiTmF0dXJhbFNlbGVjdGlvbkNvbnN0YW50cyIsIm9wdGlvbml6ZSIsIlNUQVJUX0FOR0xFIiwiTWF0aCIsIlBJIiwiUkFESVVTIiwiTElORV9XSURUSCIsIkdFTkVSQVRJT05fRk9OVCIsIkdlbmVyYXRpb25DbG9ja05vZGUiLCJjb25zdHJ1Y3RvciIsImdlbmVyYXRpb25DbG9jayIsImZvb2RFbmFibGVkUHJvcGVydHkiLCJ3b2x2ZXNFbmFibGVkUHJvcGVydHkiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiY2lyY2xlIiwiZmlsbCIsIkNMT0NLX0ZJTEwiLCJyaW1Ob2RlIiwic3Ryb2tlIiwiQ0xPQ0tfU1RST0tFIiwibGluZVdpZHRoIiwiZm9vZFNsaWNlTm9kZSIsImNyZWF0ZVNsaWNlTm9kZSIsIkNMT0NLX0ZPT0RfUkFOR0UiLCJDTE9DS19GT09EX1NMSUNFX0NPTE9SIiwid29sdmVzU2xpY2VOb2RlIiwiQ0xPQ0tfV09MVkVTX1JBTkdFIiwiQ0xPQ0tfV09MVkVTX1NMSUNFX0NPTE9SIiwicmV2ZWFsQXJjIiwiQ0xPQ0tfUkVWRUFMX0NPTE9SIiwiZ2VuZXJhdGlvbk51bWJlclRleHRUYW5kZW0iLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJnZW5lcmF0aW9uRGVyaXZlZFN0cmluZ1Byb3BlcnR5IiwiZ2VuZXJhdGlvblZhbHVlU3RyaW5nUHJvcGVydHkiLCJ2YWx1ZSIsImNsb2NrR2VuZXJhdGlvblByb3BlcnR5IiwiU1RSSU5HX1BST1BFUlRZX1RBTkRFTV9OQU1FIiwicGhldGlvVmFsdWVUeXBlIiwiZ2VuZXJhdGlvbk51bWJlclRleHQiLCJmb250IiwidG9wIiwiYm90dG9tIiwibWF4V2lkdGgiLCJib3VuZHNQcm9wZXJ0eSIsImxpbmsiLCJjZW50ZXJYIiwiY2hpbGRyZW4iLCJ0aW1lSW5QZXJjZW50UHJvcGVydHkiLCJ0aW1lSW5QZXJjZW50Iiwic2hhcGUiLCJtb3ZlVG8iLCJhcmMiLCJjbG9zZSIsImVuYWJsZWQiLCJ2aXNpYmxlIiwiYWRkTGlua2VkRWxlbWVudCIsImRpc3Bvc2UiLCJhc3NlcnQiLCJjcmVhdGVTbGljZUljb24iLCJzbGljZVJhbmdlIiwic2xpY2VDb2xvciIsInJhZGl1cyIsInNsaWNlTm9kZSIsInJhbmdlIiwiY29sb3IiLCJtaW4iLCJtYXgiLCJzdGFydEFuZ2xlIiwiZW5kQW5nbGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkdlbmVyYXRpb25DbG9ja05vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogR2VuZXJhdGlvbkNsb2NrTm9kZSBpcyB0aGUgY2xvY2sgdGhhdCBkb2VzIG9uZSBjb21wbGV0ZSByZXZvbHV0aW9uIHBlciBnZW5lcmF0aW9uLlxyXG4gKiBJdCBkaXNwbGF5cyBhIGNsb2NrIHNsaWNlIGZvciBlYWNoIGVudmlyb25tZW50YWwgZmFjdG9yLCB0byBkZW5vdGUgd2hlbiB0aGV5IHdpbGwgYmUgYWN0aXZlLlxyXG4gKiBXZSBjb21tb25seSByZWZlciB0byB0aW1lcywgbGlrZSAxMjowMCwgYXMgaWYgdGhpcyB3ZXJlIGEgc3RhbmRhcmQgd2FsbCBjbG9jay5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUGF0dGVyblN0cmluZ1Byb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUGF0dGVyblN0cmluZ1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IENpcmNsZSwgTm9kZSwgTm9kZU9wdGlvbnMsIE5vZGVUcmFuc2xhdGlvbk9wdGlvbnMsIFBhdGgsIFRDb2xvciwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBTdHJpbmdJTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvU3RyaW5nSU8uanMnO1xyXG5pbXBvcnQgbmF0dXJhbFNlbGVjdGlvbiBmcm9tICcuLi8uLi9uYXR1cmFsU2VsZWN0aW9uLmpzJztcclxuaW1wb3J0IE5hdHVyYWxTZWxlY3Rpb25TdHJpbmdzIGZyb20gJy4uLy4uL05hdHVyYWxTZWxlY3Rpb25TdHJpbmdzLmpzJztcclxuaW1wb3J0IEdlbmVyYXRpb25DbG9jayBmcm9tICcuLi9tb2RlbC9HZW5lcmF0aW9uQ2xvY2suanMnO1xyXG5pbXBvcnQgTmF0dXJhbFNlbGVjdGlvbkNvbG9ycyBmcm9tICcuLi9OYXR1cmFsU2VsZWN0aW9uQ29sb3JzLmpzJztcclxuaW1wb3J0IE5hdHVyYWxTZWxlY3Rpb25Db25zdGFudHMgZnJvbSAnLi4vTmF0dXJhbFNlbGVjdGlvbkNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgU1RBUlRfQU5HTEUgPSAtTWF0aC5QSSAvIDI7IC8vIDEyOjAwXHJcbmNvbnN0IFJBRElVUyA9IDE4O1xyXG5jb25zdCBMSU5FX1dJRFRIID0gMTtcclxuY29uc3QgR0VORVJBVElPTl9GT05UID0gbmV3IFBoZXRGb250KCAxNCApO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IEVtcHR5U2VsZk9wdGlvbnM7XHJcblxyXG50eXBlIEdlbmVyYXRpb25DbG9ja05vZGVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBOb2RlVHJhbnNsYXRpb25PcHRpb25zICYgUGlja1JlcXVpcmVkPE5vZGVPcHRpb25zLCAndGFuZGVtJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHZW5lcmF0aW9uQ2xvY2tOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggZ2VuZXJhdGlvbkNsb2NrOiBHZW5lcmF0aW9uQ2xvY2ssXHJcbiAgICAgICAgICAgICAgICAgICAgICBmb29kRW5hYmxlZFByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPixcclxuICAgICAgICAgICAgICAgICAgICAgIHdvbHZlc0VuYWJsZWRQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnM6IEdlbmVyYXRpb25DbG9ja05vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8R2VuZXJhdGlvbkNsb2NrTm9kZU9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG4gICAgICAvLyBlbXB0eSBvcHRpb25pemUgYmVjYXVzZSB3ZSB3aWxsIGJlIHNldHRpbmcgb3B0aW9ucy5jaGlsZHJlbiBiZWxvd1xyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gVGhlIGZ1bGwgY2VudGVyIG9mIHRoZSBjbG9jay5cclxuICAgIGNvbnN0IGNpcmNsZSA9IG5ldyBDaXJjbGUoIFJBRElVUywge1xyXG4gICAgICBmaWxsOiBOYXR1cmFsU2VsZWN0aW9uQ29sb3JzLkNMT0NLX0ZJTExcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBSaW0gYXJvdW5kIHRoZSBvdXRzaWRlIGVkZ2VcclxuICAgIGNvbnN0IHJpbU5vZGUgPSBuZXcgQ2lyY2xlKCBSQURJVVMsIHtcclxuICAgICAgc3Ryb2tlOiBOYXR1cmFsU2VsZWN0aW9uQ29sb3JzLkNMT0NLX1NUUk9LRSxcclxuICAgICAgbGluZVdpZHRoOiBMSU5FX1dJRFRIXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gVGhlIGNsb2NrIHNsaWNlIHRoYXQgZGVub3RlcyB3aGVuIGZvb2QgaXMgYWN0aXZlXHJcbiAgICBjb25zdCBmb29kU2xpY2VOb2RlID0gY3JlYXRlU2xpY2VOb2RlKCBOYXR1cmFsU2VsZWN0aW9uQ29uc3RhbnRzLkNMT0NLX0ZPT0RfUkFOR0UsIE5hdHVyYWxTZWxlY3Rpb25Db2xvcnMuQ0xPQ0tfRk9PRF9TTElDRV9DT0xPUiwgUkFESVVTICk7XHJcblxyXG4gICAgLy8gVGhlIGNsb2NrIHNsaWNlIHRoYXQgZGVub3RlcyB3aGVuIHRoZSB3b2x2ZXMgYXJlIGFjdGl2ZVxyXG4gICAgY29uc3Qgd29sdmVzU2xpY2VOb2RlID0gY3JlYXRlU2xpY2VOb2RlKCBOYXR1cmFsU2VsZWN0aW9uQ29uc3RhbnRzLkNMT0NLX1dPTFZFU19SQU5HRSwgTmF0dXJhbFNlbGVjdGlvbkNvbG9ycy5DTE9DS19XT0xWRVNfU0xJQ0VfQ09MT1IsIFJBRElVUyApO1xyXG5cclxuICAgIC8vIE92ZXJsYXkgb24gdGhlIGNsb2NrLCBzd2VlcHMgb3V0IGFuIGFyYyB0byByZXZlYWwgd2hhdCdzIHVuZGVyIGl0LlxyXG4gICAgLy8gVGhlIHBvcnRpb24gcmV2ZWFsZWQgY29ycmVzcG9uZHMgdG8gdGhlIHBlcmNlbnRhZ2Ugb2YgYSByZXZvbHV0aW9uIHRoYXQgaGFzIGVsYXBzZWQuXHJcbiAgICBjb25zdCByZXZlYWxBcmMgPSBuZXcgUGF0aCggbmV3IFNoYXBlKCksIHtcclxuICAgICAgZmlsbDogTmF0dXJhbFNlbGVjdGlvbkNvbG9ycy5DTE9DS19SRVZFQUxfQ09MT1IsXHJcbiAgICAgIHN0cm9rZTogTmF0dXJhbFNlbGVjdGlvbkNvbG9ycy5DTE9DS19TVFJPS0UsXHJcbiAgICAgIGxpbmVXaWR0aDogTElORV9XSURUSFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFRoZSBjdXJyZW50IGdlbmVyYXRpb24gbnVtYmVyLCBkaXNwbGF5ZWQgYmVsb3cgdGhlIGNpcmNsZS5cclxuICAgIGNvbnN0IGdlbmVyYXRpb25OdW1iZXJUZXh0VGFuZGVtID0gb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZ2VuZXJhdGlvbk51bWJlclRleHQnICk7XHJcbiAgICBjb25zdCBnZW5lcmF0aW9uRGVyaXZlZFN0cmluZ1Byb3BlcnR5ID0gbmV3IFBhdHRlcm5TdHJpbmdQcm9wZXJ0eSggTmF0dXJhbFNlbGVjdGlvblN0cmluZ3MuZ2VuZXJhdGlvblZhbHVlU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgdmFsdWU6IGdlbmVyYXRpb25DbG9jay5jbG9ja0dlbmVyYXRpb25Qcm9wZXJ0eVxyXG4gICAgfSwge1xyXG4gICAgICB0YW5kZW06IGdlbmVyYXRpb25OdW1iZXJUZXh0VGFuZGVtLmNyZWF0ZVRhbmRlbSggVGV4dC5TVFJJTkdfUFJPUEVSVFlfVEFOREVNX05BTUUgKSxcclxuICAgICAgcGhldGlvVmFsdWVUeXBlOiBTdHJpbmdJT1xyXG4gICAgfSApO1xyXG4gICAgY29uc3QgZ2VuZXJhdGlvbk51bWJlclRleHQgPSBuZXcgVGV4dCggZ2VuZXJhdGlvbkRlcml2ZWRTdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICBmb250OiBHRU5FUkFUSU9OX0ZPTlQsXHJcbiAgICAgIGZpbGw6ICdibGFjaycsXHJcbiAgICAgIHRvcDogY2lyY2xlLmJvdHRvbSArIDMsXHJcbiAgICAgIG1heFdpZHRoOiAxMDAsIC8vIGRldGVybWluZWQgZW1waXJpY2FsbHlcclxuICAgICAgdGFuZGVtOiBnZW5lcmF0aW9uTnVtYmVyVGV4dFRhbmRlbVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEtlZXAgdGhlIGdlbmVyYXRpb24gbnVtYmVyIGNlbnRlcmVkIGJlbG93IHRoZSBjaXJjdWxhciBwYXJ0IG9mIHRoZSBjbG9jay5cclxuICAgIGdlbmVyYXRpb25OdW1iZXJUZXh0LmJvdW5kc1Byb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgICAgZ2VuZXJhdGlvbk51bWJlclRleHQuY2VudGVyWCA9IGNpcmNsZS5jZW50ZXJYO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIExheWVyaW5nIG9yZGVyIGlzIGltcG9ydGFudCBoZXJlIVxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFsgY2lyY2xlLCBmb29kU2xpY2VOb2RlLCB3b2x2ZXNTbGljZU5vZGUsIHJldmVhbEFyYywgcmltTm9kZSwgZ2VuZXJhdGlvbk51bWJlclRleHQgXTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIFJldmVhbCBwYXJ0IG9mIHRoZSBjbG9jay4gdW5saW5rIGlzIG5vdCBuZWNlc3NhcnkuXHJcbiAgICBnZW5lcmF0aW9uQ2xvY2sudGltZUluUGVyY2VudFByb3BlcnR5LmxpbmsoIHRpbWVJblBlcmNlbnQgPT4ge1xyXG4gICAgICByZXZlYWxBcmMuc2hhcGUgPSBuZXcgU2hhcGUoKVxyXG4gICAgICAgIC5tb3ZlVG8oIDAsIDAgKVxyXG4gICAgICAgIC5hcmMoIDAsIDAsIFJBRElVUywgU1RBUlRfQU5HTEUgKyAoIHRpbWVJblBlcmNlbnQgKiAyICogTWF0aC5QSSApLCBTVEFSVF9BTkdMRSArIDIgKiBNYXRoLlBJIClcclxuICAgICAgICAuY2xvc2UoKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBNYWtlcyB0aGUgd29sdmVzIGNsb2NrIHNsaWNlIHZpc2libGUuIHVubGluayBpcyBub3QgbmVjZXNzYXJ5LlxyXG4gICAgd29sdmVzRW5hYmxlZFByb3BlcnR5LmxpbmsoIGVuYWJsZWQgPT4ge1xyXG4gICAgICB3b2x2ZXNTbGljZU5vZGUudmlzaWJsZSA9IGVuYWJsZWQ7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gTWFrZXMgdGhlIGZvb2QgY2xvY2sgc2xpY2UgdmlzaWJsZS4gdW5saW5rIGlzIG5vdCBuZWNlc3NhcnkuXHJcbiAgICBmb29kRW5hYmxlZFByb3BlcnR5LmxpbmsoIGVuYWJsZWQgPT4ge1xyXG4gICAgICBmb29kU2xpY2VOb2RlLnZpc2libGUgPSBlbmFibGVkO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSBhIFN0dWRpbyBsaW5rIHRvIHRoZSBtb2RlbFxyXG4gICAgdGhpcy5hZGRMaW5rZWRFbGVtZW50KCBnZW5lcmF0aW9uQ2xvY2ssIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdnZW5lcmF0aW9uQ2xvY2snIClcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGFuIGljb24gd2l0aCBvbmUgc2xpY2Ugb2YgdGhlIGNsb2NrIGZpbGxlZCBpbi5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIGNyZWF0ZVNsaWNlSWNvbiggc2xpY2VSYW5nZTogUmFuZ2UsIHNsaWNlQ29sb3I6IFRDb2xvciwgcmFkaXVzID0gMTAgKTogTm9kZSB7XHJcblxyXG4gICAgY29uc3Qgc2xpY2VOb2RlID0gY3JlYXRlU2xpY2VOb2RlKCBzbGljZVJhbmdlLCBzbGljZUNvbG9yLCByYWRpdXMgKTtcclxuXHJcbiAgICBjb25zdCByaW1Ob2RlID0gbmV3IENpcmNsZSggcmFkaXVzLCB7XHJcbiAgICAgIHN0cm9rZTogTmF0dXJhbFNlbGVjdGlvbkNvbG9ycy5DTE9DS19TVFJPS0VcclxuICAgIH0gKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IE5vZGUoIHtcclxuICAgICAgY2hpbGRyZW46IFsgc2xpY2VOb2RlLCByaW1Ob2RlIF1cclxuICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIGEgc2xpY2Ugb2YgdGhlIHBpZSB0aGF0IGlzIHRoZSBnZW5lcmF0aW9uIGNsb2NrLlxyXG4gKiBAcGFyYW0gcmFkaXVzXHJcbiAqIEBwYXJhbSByYW5nZSAtIHJhbmdlIGJldHdlZW4gMCBhbmQgMSwgc3RhcnRpbmcgYXQgMTI6MDAgYW5kIGdvaW5nIGNsb2Nrd2lzZVxyXG4gKiBAcGFyYW0gY29sb3JcclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZVNsaWNlTm9kZSggcmFuZ2U6IFJhbmdlLCBjb2xvcjogVENvbG9yLCByYWRpdXM6IG51bWJlciApOiBOb2RlIHtcclxuXHJcbiAgYXNzZXJ0ICYmIGFzc2VydCggcmFuZ2UubWluID49IDAgJiYgcmFuZ2UubWF4IDw9IDEsICdpbnZhbGlkIHJhbmdlJyApO1xyXG4gIGFzc2VydCAmJiBhc3NlcnQoIHJhZGl1cyA+IDAgKTtcclxuXHJcbiAgY29uc3Qgc3RhcnRBbmdsZSA9IFNUQVJUX0FOR0xFICsgcmFuZ2UubWluICogMiAqIE1hdGguUEk7XHJcbiAgY29uc3QgZW5kQW5nbGUgPSBTVEFSVF9BTkdMRSArIHJhbmdlLm1heCAqIDIgKiBNYXRoLlBJO1xyXG4gIGNvbnN0IHNoYXBlID0gbmV3IFNoYXBlKClcclxuICAgIC5tb3ZlVG8oIDAsIDAgKVxyXG4gICAgLmFyYyggMCwgMCwgcmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSApXHJcbiAgICAuY2xvc2UoKTtcclxuICByZXR1cm4gbmV3IFBhdGgoIHNoYXBlLCB7XHJcbiAgICBmaWxsOiBjb2xvclxyXG4gIH0gKTtcclxufVxyXG5cclxubmF0dXJhbFNlbGVjdGlvbi5yZWdpc3RlciggJ0dlbmVyYXRpb25DbG9ja05vZGUnLCBHZW5lcmF0aW9uQ2xvY2tOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFHQSxTQUFTQSxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELE9BQU9DLHFCQUFxQixNQUFNLDhDQUE4QztBQUNoRixPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLE1BQU0sRUFBRUMsSUFBSSxFQUF1Q0MsSUFBSSxFQUFVQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ3pILE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsT0FBT0MsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBQ3hELE9BQU9DLHVCQUF1QixNQUFNLGtDQUFrQztBQUV0RSxPQUFPQyxzQkFBc0IsTUFBTSw4QkFBOEI7QUFDakUsT0FBT0MseUJBQXlCLE1BQU0saUNBQWlDO0FBR3ZFLE9BQU9DLFNBQVMsTUFBNEIsdUNBQXVDOztBQUVuRjtBQUNBLE1BQU1DLFdBQVcsR0FBRyxDQUFDQyxJQUFJLENBQUNDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUcsRUFBRTtBQUNqQixNQUFNQyxVQUFVLEdBQUcsQ0FBQztBQUNwQixNQUFNQyxlQUFlLEdBQUcsSUFBSWhCLFFBQVEsQ0FBRSxFQUFHLENBQUM7QUFNMUMsZUFBZSxNQUFNaUIsbUJBQW1CLFNBQVNmLElBQUksQ0FBQztFQUU3Q2dCLFdBQVdBLENBQUVDLGVBQWdDLEVBQ2hDQyxtQkFBK0MsRUFDL0NDLHFCQUFpRCxFQUNqREMsZUFBMkMsRUFBRztJQUVoRSxNQUFNQyxPQUFPLEdBQUdiLFNBQVMsQ0FBdUQsQ0FBQyxDQUFFO01BQ2pGO0lBQUEsQ0FDRCxFQUFFWSxlQUFnQixDQUFD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