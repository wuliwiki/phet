// Copyright 2019-2023, University of Colorado Boulder

/**
 * ProportionsBarNode is a bar in the Proportions graph, showing the percentage of mutant vs non-mutant alleles for
 * a gene in the population.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Multilink from '../../../../../axon/js/Multilink.js';
import Utils from '../../../../../dot/js/Utils.js';
import optionize, { combineOptions } from '../../../../../phet-core/js/optionize.js';
import StringUtils from '../../../../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../../../../scenery-phet/js/PhetFont.js';
import { Node, Rectangle, Text } from '../../../../../scenery/js/imports.js';
import naturalSelection from '../../../naturalSelection.js';
import NaturalSelectionStrings from '../../../NaturalSelectionStrings.js';
import NaturalSelectionUtils from '../../NaturalSelectionUtils.js';
import HatchingRectangle from '../HatchingRectangle.js';

// constants
const PERCENTAGE_FONT = new PhetFont(12);
export default class ProportionsBarNode extends Node {
  constructor(color, normalCount, mutantCount, valuesVisibleProperty, providedOptions) {
    const options = optionize()({
      // SelfOptions
      barWidth: 120,
      barHeight: 30,
      // NodeOptions
      phetioReadOnly: true
    }, providedOptions);

    // Portions of the bar for normal and mutant counts. normalRectangle remains a fixed size. mutantRectangle
    // will be resized and is on top of normalRectangle.
    const normalRectangle = new Rectangle(0, 0, options.barWidth, options.barHeight, {
      fill: color,
      stroke: color
    });
    const mutantRectangle = new HatchingRectangle(0, 0, options.barWidth, options.barHeight, {
      fill: color,
      stroke: color
    });

    // Percentages for non-mutant and mutant counts.
    // These Text nodes do not take a string Property argument. They are updated via Multilink below.
    const percentageOptions = {
      font: PERCENTAGE_FONT,
      bottom: -4,
      maxWidth: 40 // determined empirically
    };

    const normalPercentageText = new Text('', combineOptions({}, percentageOptions, {
      tandem: options.tandem.createTandem('normalPercentageText')
    }));
    const mutantPercentageText = new Text('', combineOptions({}, percentageOptions, {
      tandem: options.tandem.createTandem('mutantPercentageText')
    }));
    options.children = [normalRectangle, mutantRectangle, normalPercentageText, mutantPercentageText];
    super(options);
    this.valuesVisibleProperty = valuesVisibleProperty;
    this.normalRectangle = normalRectangle;
    this.mutantRectangle = mutantRectangle;
    this.normalPercentageText = normalPercentageText;
    this.mutantPercentageText = mutantPercentageText;
    this.barWidth = options.barWidth;
    this.normalCount = normalCount;
    this.mutantCount = mutantCount;

    // When valuesVisibleProperty changes, or any of the related strings change, update the display.
    // unlink is not necessary.
    Multilink.multilink([this.valuesVisibleProperty, NaturalSelectionStrings.greaterThanValuePercentStringProperty, NaturalSelectionStrings.lessThanValuePercentStringProperty, NaturalSelectionStrings.valuePercentStringProperty], () => this.updateProportionsBarNode());
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }

  /**
   * Sets the counts and triggers an update of the display.
   */
  setCounts(normalCount, mutantCount) {
    assert && assert(NaturalSelectionUtils.isNonNegativeInteger(normalCount), 'invalid normalCount');
    assert && assert(NaturalSelectionUtils.isNonNegativeInteger(mutantCount), 'invalid mutantCount');
    this.normalCount = normalCount;
    this.mutantCount = mutantCount;
    this.updateProportionsBarNode();
  }

  /**
   * Resizes the bars and displays the counts as percentages.
   */
  updateProportionsBarNode() {
    const total = this.normalCount + this.mutantCount;
    const normalPercentage = 100 * this.normalCount / total;
    const mutantPercentage = 100 * this.mutantCount / total;

    // hide zero-length bar
    this.normalRectangle.visible = normalPercentage > 0;
    this.mutantRectangle.visible = mutantPercentage > 0;

    // hide N% values, when values are not visible, or when values are zero
    this.normalPercentageText.visible = this.valuesVisibleProperty.value && normalPercentage > 0;
    this.mutantPercentageText.visible = this.valuesVisibleProperty.value && mutantPercentage > 0;

    // update the mutant portion of the bar and the N% values
    if (mutantPercentage > 0 && mutantPercentage < 1) {
      // 1% mutant
      this.mutantRectangle.rectWidth = 0.01 * this.barWidth;

      // > 99% non-mutant, < 1% mutant
      this.normalPercentageText.string = StringUtils.fillIn(NaturalSelectionStrings.greaterThanValuePercentStringProperty.value, {
        value: 99
      });
      this.mutantPercentageText.string = StringUtils.fillIn(NaturalSelectionStrings.lessThanValuePercentStringProperty.value, {
        value: 1
      });
    } else if (normalPercentage > 0 && normalPercentage < 1) {
      // 99% mutant
      this.mutantRectangle.rectWidth = 0.99 * this.barWidth;

      // < 1% non-mutant, > 99% mutant
      this.normalPercentageText.string = StringUtils.fillIn(NaturalSelectionStrings.lessThanValuePercentStringProperty.value, {
        value: 1
      });
      this.mutantPercentageText.string = StringUtils.fillIn(NaturalSelectionStrings.greaterThanValuePercentStringProperty.value, {
        value: 99
      });
    } else {
      if (this.mutantRectangle.visible) {
        this.mutantRectangle.rectWidth = Utils.roundSymmetric(mutantPercentage) / 100 * this.barWidth;
      } else {
        this.mutantRectangle.rectWidth = 1; // small non-zero, for layout
      }

      // round both percentages to the nearest integer
      this.normalPercentageText.string = StringUtils.fillIn(NaturalSelectionStrings.valuePercentStringProperty.value, {
        value: Utils.roundSymmetric(normalPercentage)
      });
      this.mutantPercentageText.string = StringUtils.fillIn(NaturalSelectionStrings.valuePercentStringProperty.value, {
        value: Utils.roundSymmetric(mutantPercentage)
      });
    }
    this.mutantRectangle.right = this.normalRectangle.right;

    // center N% above its portion of the bar
    if (normalPercentage > 0) {
      this.normalPercentageText.centerX = normalPercentage / 100 * (this.barWidth / 2);
    }
    if (mutantPercentage > 0) {
      this.mutantPercentageText.centerX = this.barWidth - mutantPercentage / 100 * (this.barWidth / 2);
    }

    // horizontally constrain N% to left and right edges of bars
    if (this.normalPercentageText.left < this.normalRectangle.left) {
      this.normalPercentageText.left = this.normalRectangle.left;
    } else if (this.normalPercentageText.right > this.normalRectangle.right) {
      this.normalPercentageText.right = this.normalRectangle.right;
    }
    if (this.mutantPercentageText.left < this.normalRectangle.left) {
      this.mutantPercentageText.left = this.normalRectangle.left;
    } else if (this.mutantPercentageText.right > this.normalRectangle.right) {
      this.mutantPercentageText.right = this.normalRectangle.right;
    }
  }
}
naturalSelection.register('ProportionsBarNode', ProportionsBarNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJVdGlscyIsIm9wdGlvbml6ZSIsImNvbWJpbmVPcHRpb25zIiwiU3RyaW5nVXRpbHMiLCJQaGV0Rm9udCIsIk5vZGUiLCJSZWN0YW5nbGUiLCJUZXh0IiwibmF0dXJhbFNlbGVjdGlvbiIsIk5hdHVyYWxTZWxlY3Rpb25TdHJpbmdzIiwiTmF0dXJhbFNlbGVjdGlvblV0aWxzIiwiSGF0Y2hpbmdSZWN0YW5nbGUiLCJQRVJDRU5UQUdFX0ZPTlQiLCJQcm9wb3J0aW9uc0Jhck5vZGUiLCJjb25zdHJ1Y3RvciIsImNvbG9yIiwibm9ybWFsQ291bnQiLCJtdXRhbnRDb3VudCIsInZhbHVlc1Zpc2libGVQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJiYXJXaWR0aCIsImJhckhlaWdodCIsInBoZXRpb1JlYWRPbmx5Iiwibm9ybWFsUmVjdGFuZ2xlIiwiZmlsbCIsInN0cm9rZSIsIm11dGFudFJlY3RhbmdsZSIsInBlcmNlbnRhZ2VPcHRpb25zIiwiZm9udCIsImJvdHRvbSIsIm1heFdpZHRoIiwibm9ybWFsUGVyY2VudGFnZVRleHQiLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJtdXRhbnRQZXJjZW50YWdlVGV4dCIsImNoaWxkcmVuIiwibXVsdGlsaW5rIiwiZ3JlYXRlclRoYW5WYWx1ZVBlcmNlbnRTdHJpbmdQcm9wZXJ0eSIsImxlc3NUaGFuVmFsdWVQZXJjZW50U3RyaW5nUHJvcGVydHkiLCJ2YWx1ZVBlcmNlbnRTdHJpbmdQcm9wZXJ0eSIsInVwZGF0ZVByb3BvcnRpb25zQmFyTm9kZSIsImRpc3Bvc2UiLCJhc3NlcnQiLCJzZXRDb3VudHMiLCJpc05vbk5lZ2F0aXZlSW50ZWdlciIsInRvdGFsIiwibm9ybWFsUGVyY2VudGFnZSIsIm11dGFudFBlcmNlbnRhZ2UiLCJ2aXNpYmxlIiwidmFsdWUiLCJyZWN0V2lkdGgiLCJzdHJpbmciLCJmaWxsSW4iLCJyb3VuZFN5bW1ldHJpYyIsInJpZ2h0IiwiY2VudGVyWCIsImxlZnQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlByb3BvcnRpb25zQmFyTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBQcm9wb3J0aW9uc0Jhck5vZGUgaXMgYSBiYXIgaW4gdGhlIFByb3BvcnRpb25zIGdyYXBoLCBzaG93aW5nIHRoZSBwZXJjZW50YWdlIG9mIG11dGFudCB2cyBub24tbXV0YW50IGFsbGVsZXMgZm9yXHJcbiAqIGEgZ2VuZSBpbiB0aGUgcG9wdWxhdGlvbi5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBjb21iaW5lT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIE5vZGVPcHRpb25zLCBSZWN0YW5nbGUsIFRDb2xvciwgVGV4dCwgVGV4dE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbmF0dXJhbFNlbGVjdGlvbiBmcm9tICcuLi8uLi8uLi9uYXR1cmFsU2VsZWN0aW9uLmpzJztcclxuaW1wb3J0IE5hdHVyYWxTZWxlY3Rpb25TdHJpbmdzIGZyb20gJy4uLy4uLy4uL05hdHVyYWxTZWxlY3Rpb25TdHJpbmdzLmpzJztcclxuaW1wb3J0IE5hdHVyYWxTZWxlY3Rpb25VdGlscyBmcm9tICcuLi8uLi9OYXR1cmFsU2VsZWN0aW9uVXRpbHMuanMnO1xyXG5pbXBvcnQgSGF0Y2hpbmdSZWN0YW5nbGUgZnJvbSAnLi4vSGF0Y2hpbmdSZWN0YW5nbGUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IFBFUkNFTlRBR0VfRk9OVCA9IG5ldyBQaGV0Rm9udCggMTIgKTtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgYmFyV2lkdGg/OiBudW1iZXI7XHJcbiAgYmFySGVpZ2h0PzogbnVtYmVyO1xyXG59O1xyXG5cclxudHlwZSBQcm9wb3J0aW9uc0Jhck5vZGVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBQaWNrUmVxdWlyZWQ8Tm9kZU9wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb3BvcnRpb25zQmFyTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IHZhbHVlc1Zpc2libGVQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgcHJpdmF0ZSByZWFkb25seSBub3JtYWxSZWN0YW5nbGU6IFJlY3RhbmdsZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IG11dGFudFJlY3RhbmdsZTogUmVjdGFuZ2xlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbm9ybWFsUGVyY2VudGFnZVRleHQ6IFRleHQ7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBtdXRhbnRQZXJjZW50YWdlVGV4dDogVGV4dDtcclxuICBwcml2YXRlIHJlYWRvbmx5IGJhcldpZHRoOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBub3JtYWxDb3VudDogbnVtYmVyO1xyXG4gIHByaXZhdGUgbXV0YW50Q291bnQ6IG51bWJlcjtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBjb2xvcjogVENvbG9yLCBub3JtYWxDb3VudDogbnVtYmVyLCBtdXRhbnRDb3VudDogbnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWVzVmlzaWJsZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPixcclxuICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVkT3B0aW9uczogUHJvcG9ydGlvbnNCYXJOb2RlT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFByb3BvcnRpb25zQmFyTm9kZU9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgYmFyV2lkdGg6IDEyMCxcclxuICAgICAgYmFySGVpZ2h0OiAzMCxcclxuXHJcbiAgICAgIC8vIE5vZGVPcHRpb25zXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBQb3J0aW9ucyBvZiB0aGUgYmFyIGZvciBub3JtYWwgYW5kIG11dGFudCBjb3VudHMuIG5vcm1hbFJlY3RhbmdsZSByZW1haW5zIGEgZml4ZWQgc2l6ZS4gbXV0YW50UmVjdGFuZ2xlXHJcbiAgICAvLyB3aWxsIGJlIHJlc2l6ZWQgYW5kIGlzIG9uIHRvcCBvZiBub3JtYWxSZWN0YW5nbGUuXHJcbiAgICBjb25zdCBub3JtYWxSZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBvcHRpb25zLmJhcldpZHRoLCBvcHRpb25zLmJhckhlaWdodCwge1xyXG4gICAgICBmaWxsOiBjb2xvcixcclxuICAgICAgc3Ryb2tlOiBjb2xvclxyXG4gICAgfSApO1xyXG4gICAgY29uc3QgbXV0YW50UmVjdGFuZ2xlID0gbmV3IEhhdGNoaW5nUmVjdGFuZ2xlKCAwLCAwLCBvcHRpb25zLmJhcldpZHRoLCBvcHRpb25zLmJhckhlaWdodCwge1xyXG4gICAgICBmaWxsOiBjb2xvcixcclxuICAgICAgc3Ryb2tlOiBjb2xvclxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFBlcmNlbnRhZ2VzIGZvciBub24tbXV0YW50IGFuZCBtdXRhbnQgY291bnRzLlxyXG4gICAgLy8gVGhlc2UgVGV4dCBub2RlcyBkbyBub3QgdGFrZSBhIHN0cmluZyBQcm9wZXJ0eSBhcmd1bWVudC4gVGhleSBhcmUgdXBkYXRlZCB2aWEgTXVsdGlsaW5rIGJlbG93LlxyXG4gICAgY29uc3QgcGVyY2VudGFnZU9wdGlvbnMgPSB7XHJcbiAgICAgIGZvbnQ6IFBFUkNFTlRBR0VfRk9OVCxcclxuICAgICAgYm90dG9tOiAtNCxcclxuICAgICAgbWF4V2lkdGg6IDQwIC8vIGRldGVybWluZWQgZW1waXJpY2FsbHlcclxuICAgIH07XHJcbiAgICBjb25zdCBub3JtYWxQZXJjZW50YWdlVGV4dCA9IG5ldyBUZXh0KCAnJywgY29tYmluZU9wdGlvbnM8VGV4dE9wdGlvbnM+KCB7fSwgcGVyY2VudGFnZU9wdGlvbnMsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdub3JtYWxQZXJjZW50YWdlVGV4dCcgKVxyXG4gICAgfSApICk7XHJcbiAgICBjb25zdCBtdXRhbnRQZXJjZW50YWdlVGV4dCA9IG5ldyBUZXh0KCAnJywgY29tYmluZU9wdGlvbnM8VGV4dE9wdGlvbnM+KCB7fSwgcGVyY2VudGFnZU9wdGlvbnMsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdtdXRhbnRQZXJjZW50YWdlVGV4dCcgKVxyXG4gICAgfSApICk7XHJcblxyXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFsgbm9ybWFsUmVjdGFuZ2xlLCBtdXRhbnRSZWN0YW5nbGUsIG5vcm1hbFBlcmNlbnRhZ2VUZXh0LCBtdXRhbnRQZXJjZW50YWdlVGV4dCBdO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy52YWx1ZXNWaXNpYmxlUHJvcGVydHkgPSB2YWx1ZXNWaXNpYmxlUHJvcGVydHk7XHJcbiAgICB0aGlzLm5vcm1hbFJlY3RhbmdsZSA9IG5vcm1hbFJlY3RhbmdsZTtcclxuICAgIHRoaXMubXV0YW50UmVjdGFuZ2xlID0gbXV0YW50UmVjdGFuZ2xlO1xyXG4gICAgdGhpcy5ub3JtYWxQZXJjZW50YWdlVGV4dCA9IG5vcm1hbFBlcmNlbnRhZ2VUZXh0O1xyXG4gICAgdGhpcy5tdXRhbnRQZXJjZW50YWdlVGV4dCA9IG11dGFudFBlcmNlbnRhZ2VUZXh0O1xyXG4gICAgdGhpcy5iYXJXaWR0aCA9IG9wdGlvbnMuYmFyV2lkdGg7XHJcbiAgICB0aGlzLm5vcm1hbENvdW50ID0gbm9ybWFsQ291bnQ7XHJcbiAgICB0aGlzLm11dGFudENvdW50ID0gbXV0YW50Q291bnQ7XHJcblxyXG4gICAgLy8gV2hlbiB2YWx1ZXNWaXNpYmxlUHJvcGVydHkgY2hhbmdlcywgb3IgYW55IG9mIHRoZSByZWxhdGVkIHN0cmluZ3MgY2hhbmdlLCB1cGRhdGUgdGhlIGRpc3BsYXkuXHJcbiAgICAvLyB1bmxpbmsgaXMgbm90IG5lY2Vzc2FyeS5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFtcclxuICAgICAgICB0aGlzLnZhbHVlc1Zpc2libGVQcm9wZXJ0eSxcclxuICAgICAgICBOYXR1cmFsU2VsZWN0aW9uU3RyaW5ncy5ncmVhdGVyVGhhblZhbHVlUGVyY2VudFN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICAgIE5hdHVyYWxTZWxlY3Rpb25TdHJpbmdzLmxlc3NUaGFuVmFsdWVQZXJjZW50U3RyaW5nUHJvcGVydHksXHJcbiAgICAgICAgTmF0dXJhbFNlbGVjdGlvblN0cmluZ3MudmFsdWVQZXJjZW50U3RyaW5nUHJvcGVydHlcclxuICAgICAgXSxcclxuICAgICAgKCkgPT4gdGhpcy51cGRhdGVQcm9wb3J0aW9uc0Jhck5vZGUoKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSBjb3VudHMgYW5kIHRyaWdnZXJzIGFuIHVwZGF0ZSBvZiB0aGUgZGlzcGxheS5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0Q291bnRzKCBub3JtYWxDb3VudDogbnVtYmVyLCBtdXRhbnRDb3VudDogbnVtYmVyICk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggTmF0dXJhbFNlbGVjdGlvblV0aWxzLmlzTm9uTmVnYXRpdmVJbnRlZ2VyKCBub3JtYWxDb3VudCApLCAnaW52YWxpZCBub3JtYWxDb3VudCcgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIE5hdHVyYWxTZWxlY3Rpb25VdGlscy5pc05vbk5lZ2F0aXZlSW50ZWdlciggbXV0YW50Q291bnQgKSwgJ2ludmFsaWQgbXV0YW50Q291bnQnICk7XHJcblxyXG4gICAgdGhpcy5ub3JtYWxDb3VudCA9IG5vcm1hbENvdW50O1xyXG4gICAgdGhpcy5tdXRhbnRDb3VudCA9IG11dGFudENvdW50O1xyXG4gICAgdGhpcy51cGRhdGVQcm9wb3J0aW9uc0Jhck5vZGUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc2l6ZXMgdGhlIGJhcnMgYW5kIGRpc3BsYXlzIHRoZSBjb3VudHMgYXMgcGVyY2VudGFnZXMuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVQcm9wb3J0aW9uc0Jhck5vZGUoKTogdm9pZCB7XHJcblxyXG4gICAgY29uc3QgdG90YWwgPSB0aGlzLm5vcm1hbENvdW50ICsgdGhpcy5tdXRhbnRDb3VudDtcclxuXHJcbiAgICBjb25zdCBub3JtYWxQZXJjZW50YWdlID0gMTAwICogdGhpcy5ub3JtYWxDb3VudCAvIHRvdGFsO1xyXG4gICAgY29uc3QgbXV0YW50UGVyY2VudGFnZSA9IDEwMCAqIHRoaXMubXV0YW50Q291bnQgLyB0b3RhbDtcclxuXHJcbiAgICAvLyBoaWRlIHplcm8tbGVuZ3RoIGJhclxyXG4gICAgdGhpcy5ub3JtYWxSZWN0YW5nbGUudmlzaWJsZSA9ICggbm9ybWFsUGVyY2VudGFnZSA+IDAgKTtcclxuICAgIHRoaXMubXV0YW50UmVjdGFuZ2xlLnZpc2libGUgPSAoIG11dGFudFBlcmNlbnRhZ2UgPiAwICk7XHJcblxyXG4gICAgLy8gaGlkZSBOJSB2YWx1ZXMsIHdoZW4gdmFsdWVzIGFyZSBub3QgdmlzaWJsZSwgb3Igd2hlbiB2YWx1ZXMgYXJlIHplcm9cclxuICAgIHRoaXMubm9ybWFsUGVyY2VudGFnZVRleHQudmlzaWJsZSA9ICggdGhpcy52YWx1ZXNWaXNpYmxlUHJvcGVydHkudmFsdWUgJiYgbm9ybWFsUGVyY2VudGFnZSA+IDAgKTtcclxuICAgIHRoaXMubXV0YW50UGVyY2VudGFnZVRleHQudmlzaWJsZSA9ICggdGhpcy52YWx1ZXNWaXNpYmxlUHJvcGVydHkudmFsdWUgJiYgbXV0YW50UGVyY2VudGFnZSA+IDAgKTtcclxuXHJcbiAgICAvLyB1cGRhdGUgdGhlIG11dGFudCBwb3J0aW9uIG9mIHRoZSBiYXIgYW5kIHRoZSBOJSB2YWx1ZXNcclxuICAgIGlmICggbXV0YW50UGVyY2VudGFnZSA+IDAgJiYgbXV0YW50UGVyY2VudGFnZSA8IDEgKSB7XHJcblxyXG4gICAgICAvLyAxJSBtdXRhbnRcclxuICAgICAgdGhpcy5tdXRhbnRSZWN0YW5nbGUucmVjdFdpZHRoID0gMC4wMSAqIHRoaXMuYmFyV2lkdGg7XHJcblxyXG4gICAgICAvLyA+IDk5JSBub24tbXV0YW50LCA8IDElIG11dGFudFxyXG4gICAgICB0aGlzLm5vcm1hbFBlcmNlbnRhZ2VUZXh0LnN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggTmF0dXJhbFNlbGVjdGlvblN0cmluZ3MuZ3JlYXRlclRoYW5WYWx1ZVBlcmNlbnRTdHJpbmdQcm9wZXJ0eS52YWx1ZSwgeyB2YWx1ZTogOTkgfSApO1xyXG4gICAgICB0aGlzLm11dGFudFBlcmNlbnRhZ2VUZXh0LnN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggTmF0dXJhbFNlbGVjdGlvblN0cmluZ3MubGVzc1RoYW5WYWx1ZVBlcmNlbnRTdHJpbmdQcm9wZXJ0eS52YWx1ZSwgeyB2YWx1ZTogMSB9ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggbm9ybWFsUGVyY2VudGFnZSA+IDAgJiYgbm9ybWFsUGVyY2VudGFnZSA8IDEgKSB7XHJcblxyXG4gICAgICAvLyA5OSUgbXV0YW50XHJcbiAgICAgIHRoaXMubXV0YW50UmVjdGFuZ2xlLnJlY3RXaWR0aCA9IDAuOTkgKiB0aGlzLmJhcldpZHRoO1xyXG5cclxuICAgICAgLy8gPCAxJSBub24tbXV0YW50LCA+IDk5JSBtdXRhbnRcclxuICAgICAgdGhpcy5ub3JtYWxQZXJjZW50YWdlVGV4dC5zdHJpbmcgPSBTdHJpbmdVdGlscy5maWxsSW4oIE5hdHVyYWxTZWxlY3Rpb25TdHJpbmdzLmxlc3NUaGFuVmFsdWVQZXJjZW50U3RyaW5nUHJvcGVydHkudmFsdWUsIHsgdmFsdWU6IDEgfSApO1xyXG4gICAgICB0aGlzLm11dGFudFBlcmNlbnRhZ2VUZXh0LnN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggTmF0dXJhbFNlbGVjdGlvblN0cmluZ3MuZ3JlYXRlclRoYW5WYWx1ZVBlcmNlbnRTdHJpbmdQcm9wZXJ0eS52YWx1ZSwgeyB2YWx1ZTogOTkgfSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcblxyXG4gICAgICBpZiAoIHRoaXMubXV0YW50UmVjdGFuZ2xlLnZpc2libGUgKSB7XHJcbiAgICAgICAgdGhpcy5tdXRhbnRSZWN0YW5nbGUucmVjdFdpZHRoID0gKCBVdGlscy5yb3VuZFN5bW1ldHJpYyggbXV0YW50UGVyY2VudGFnZSApIC8gMTAwICkgKiB0aGlzLmJhcldpZHRoO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMubXV0YW50UmVjdGFuZ2xlLnJlY3RXaWR0aCA9IDE7IC8vIHNtYWxsIG5vbi16ZXJvLCBmb3IgbGF5b3V0XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIHJvdW5kIGJvdGggcGVyY2VudGFnZXMgdG8gdGhlIG5lYXJlc3QgaW50ZWdlclxyXG4gICAgICB0aGlzLm5vcm1hbFBlcmNlbnRhZ2VUZXh0LnN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggTmF0dXJhbFNlbGVjdGlvblN0cmluZ3MudmFsdWVQZXJjZW50U3RyaW5nUHJvcGVydHkudmFsdWUsIHtcclxuICAgICAgICB2YWx1ZTogVXRpbHMucm91bmRTeW1tZXRyaWMoIG5vcm1hbFBlcmNlbnRhZ2UgKVxyXG4gICAgICB9ICk7XHJcbiAgICAgIHRoaXMubXV0YW50UGVyY2VudGFnZVRleHQuc3RyaW5nID0gU3RyaW5nVXRpbHMuZmlsbEluKCBOYXR1cmFsU2VsZWN0aW9uU3RyaW5ncy52YWx1ZVBlcmNlbnRTdHJpbmdQcm9wZXJ0eS52YWx1ZSwge1xyXG4gICAgICAgIHZhbHVlOiBVdGlscy5yb3VuZFN5bW1ldHJpYyggbXV0YW50UGVyY2VudGFnZSApXHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuICAgIHRoaXMubXV0YW50UmVjdGFuZ2xlLnJpZ2h0ID0gdGhpcy5ub3JtYWxSZWN0YW5nbGUucmlnaHQ7XHJcblxyXG4gICAgLy8gY2VudGVyIE4lIGFib3ZlIGl0cyBwb3J0aW9uIG9mIHRoZSBiYXJcclxuICAgIGlmICggbm9ybWFsUGVyY2VudGFnZSA+IDAgKSB7XHJcbiAgICAgIHRoaXMubm9ybWFsUGVyY2VudGFnZVRleHQuY2VudGVyWCA9ICggbm9ybWFsUGVyY2VudGFnZSAvIDEwMCApICogKCB0aGlzLmJhcldpZHRoIC8gMiApO1xyXG4gICAgfVxyXG4gICAgaWYgKCBtdXRhbnRQZXJjZW50YWdlID4gMCApIHtcclxuICAgICAgdGhpcy5tdXRhbnRQZXJjZW50YWdlVGV4dC5jZW50ZXJYID0gdGhpcy5iYXJXaWR0aCAtICggKCBtdXRhbnRQZXJjZW50YWdlIC8gMTAwICkgKiAoIHRoaXMuYmFyV2lkdGggLyAyICkgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBob3Jpem9udGFsbHkgY29uc3RyYWluIE4lIHRvIGxlZnQgYW5kIHJpZ2h0IGVkZ2VzIG9mIGJhcnNcclxuICAgIGlmICggdGhpcy5ub3JtYWxQZXJjZW50YWdlVGV4dC5sZWZ0IDwgdGhpcy5ub3JtYWxSZWN0YW5nbGUubGVmdCApIHtcclxuICAgICAgdGhpcy5ub3JtYWxQZXJjZW50YWdlVGV4dC5sZWZ0ID0gdGhpcy5ub3JtYWxSZWN0YW5nbGUubGVmdDtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCB0aGlzLm5vcm1hbFBlcmNlbnRhZ2VUZXh0LnJpZ2h0ID4gdGhpcy5ub3JtYWxSZWN0YW5nbGUucmlnaHQgKSB7XHJcbiAgICAgIHRoaXMubm9ybWFsUGVyY2VudGFnZVRleHQucmlnaHQgPSB0aGlzLm5vcm1hbFJlY3RhbmdsZS5yaWdodDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIHRoaXMubXV0YW50UGVyY2VudGFnZVRleHQubGVmdCA8IHRoaXMubm9ybWFsUmVjdGFuZ2xlLmxlZnQgKSB7XHJcbiAgICAgIHRoaXMubXV0YW50UGVyY2VudGFnZVRleHQubGVmdCA9IHRoaXMubm9ybWFsUmVjdGFuZ2xlLmxlZnQ7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggdGhpcy5tdXRhbnRQZXJjZW50YWdlVGV4dC5yaWdodCA+IHRoaXMubm9ybWFsUmVjdGFuZ2xlLnJpZ2h0ICkge1xyXG4gICAgICB0aGlzLm11dGFudFBlcmNlbnRhZ2VUZXh0LnJpZ2h0ID0gdGhpcy5ub3JtYWxSZWN0YW5nbGUucmlnaHQ7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5uYXR1cmFsU2VsZWN0aW9uLnJlZ2lzdGVyKCAnUHJvcG9ydGlvbnNCYXJOb2RlJywgUHJvcG9ydGlvbnNCYXJOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsU0FBUyxNQUFNLHFDQUFxQztBQUUzRCxPQUFPQyxLQUFLLE1BQU0sZ0NBQWdDO0FBQ2xELE9BQU9DLFNBQVMsSUFBSUMsY0FBYyxRQUFRLDBDQUEwQztBQUVwRixPQUFPQyxXQUFXLE1BQU0sa0RBQWtEO0FBQzFFLE9BQU9DLFFBQVEsTUFBTSw0Q0FBNEM7QUFDakUsU0FBU0MsSUFBSSxFQUFlQyxTQUFTLEVBQVVDLElBQUksUUFBcUIsc0NBQXNDO0FBQzlHLE9BQU9DLGdCQUFnQixNQUFNLDhCQUE4QjtBQUMzRCxPQUFPQyx1QkFBdUIsTUFBTSxxQ0FBcUM7QUFDekUsT0FBT0MscUJBQXFCLE1BQU0sZ0NBQWdDO0FBQ2xFLE9BQU9DLGlCQUFpQixNQUFNLHlCQUF5Qjs7QUFFdkQ7QUFDQSxNQUFNQyxlQUFlLEdBQUcsSUFBSVIsUUFBUSxDQUFFLEVBQUcsQ0FBQztBQVMxQyxlQUFlLE1BQU1TLGtCQUFrQixTQUFTUixJQUFJLENBQUM7RUFXNUNTLFdBQVdBLENBQUVDLEtBQWEsRUFBRUMsV0FBbUIsRUFBRUMsV0FBbUIsRUFDdkRDLHFCQUFpRCxFQUNqREMsZUFBMEMsRUFBRztJQUUvRCxNQUFNQyxPQUFPLEdBQUduQixTQUFTLENBQXNELENBQUMsQ0FBRTtNQUVoRjtNQUNBb0IsUUFBUSxFQUFFLEdBQUc7TUFDYkMsU0FBUyxFQUFFLEVBQUU7TUFFYjtNQUNBQyxjQUFjLEVBQUU7SUFDbEIsQ0FBQyxFQUFFSixlQUFnQixDQUFDOztJQUVwQjtJQUNBO0lBQ0EsTUFBTUssZUFBZSxHQUFHLElBQUlsQixTQUFTLENB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