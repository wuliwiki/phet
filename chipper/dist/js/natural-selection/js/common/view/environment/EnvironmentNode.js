// Copyright 2019-2022, University of Colorado Boulder

/**
 * EnvironmentNode displays everything in the environment -- bunnies, wolves, food, terrain, sky, etc.
 * This is the part of the UI where bunnies hop around, wolves hunt, and shrubs sit around waiting to be eaten.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Bounds2 from '../../../../../dot/js/Bounds2.js';
import optionize from '../../../../../phet-core/js/optionize.js';
import { Node, Rectangle } from '../../../../../scenery/js/imports.js';
import naturalSelection from '../../../naturalSelection.js';
import NaturalSelectionColors from '../../NaturalSelectionColors.js';
import EnvironmentBackgroundNode from './EnvironmentBackgroundNode.js';
import OrganismSprites from './OrganismSprites.js';
export default class EnvironmentNode extends Node {
  constructor(model, bunnyImageMap, providedOptions) {
    const options = optionize()({
      // SelfOptions
      size: model.modelViewTransform.viewSize,
      yHorizon: model.modelViewTransform.yHorizonView,
      // NodeOptions
      phetioDocumentation: 'the area of the screen that displays what is happening in the environment',
      phetioVisiblePropertyInstrumented: false
    }, providedOptions);
    const bounds = new Bounds2(0, 0, options.size.width, options.size.height);

    // The background, which changes to match the environment
    const backgroundNode = new EnvironmentBackgroundNode(model.environmentProperty, options.size, options.yHorizon);

    // Frame around the background, to provide a nice crisp border.
    const frameNode = new Rectangle(bounds, {
      stroke: NaturalSelectionColors.PANEL_STROKE
    });

    // High-performance sprites, for rendering bunnies, wolves, and food.
    const sprites = new OrganismSprites(model.bunnyCollection, bunnyImageMap, model.wolfCollection, model.food, model.isPlayingProperty, bounds, {
      tandem: options.tandem.createTandem('sprites')
    });

    // layering
    options.children = [backgroundNode, sprites, frameNode];
    super(options);

    // Pressing on anything other than a bunny clears the selection. removeInputListener is not necessary.
    backgroundNode.addInputListener({
      down: () => {
        model.bunnyCollection.selectedBunnyProperty.value = null;
      }
    });
    this.sprites = sprites;
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }

  /**
   * Updates all sprites.
   */
  updateSprites() {
    this.sprites.update();
  }
}
naturalSelection.register('EnvironmentNode', EnvironmentNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb3VuZHMyIiwib3B0aW9uaXplIiwiTm9kZSIsIlJlY3RhbmdsZSIsIm5hdHVyYWxTZWxlY3Rpb24iLCJOYXR1cmFsU2VsZWN0aW9uQ29sb3JzIiwiRW52aXJvbm1lbnRCYWNrZ3JvdW5kTm9kZSIsIk9yZ2FuaXNtU3ByaXRlcyIsIkVudmlyb25tZW50Tm9kZSIsImNvbnN0cnVjdG9yIiwibW9kZWwiLCJidW5ueUltYWdlTWFwIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsInNpemUiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJ2aWV3U2l6ZSIsInlIb3Jpem9uIiwieUhvcml6b25WaWV3IiwicGhldGlvRG9jdW1lbnRhdGlvbiIsInBoZXRpb1Zpc2libGVQcm9wZXJ0eUluc3RydW1lbnRlZCIsImJvdW5kcyIsIndpZHRoIiwiaGVpZ2h0IiwiYmFja2dyb3VuZE5vZGUiLCJlbnZpcm9ubWVudFByb3BlcnR5IiwiZnJhbWVOb2RlIiwic3Ryb2tlIiwiUEFORUxfU1RST0tFIiwic3ByaXRlcyIsImJ1bm55Q29sbGVjdGlvbiIsIndvbGZDb2xsZWN0aW9uIiwiZm9vZCIsImlzUGxheWluZ1Byb3BlcnR5IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwiY2hpbGRyZW4iLCJhZGRJbnB1dExpc3RlbmVyIiwiZG93biIsInNlbGVjdGVkQnVubnlQcm9wZXJ0eSIsInZhbHVlIiwiZGlzcG9zZSIsImFzc2VydCIsInVwZGF0ZVNwcml0ZXMiLCJ1cGRhdGUiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkVudmlyb25tZW50Tm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBFbnZpcm9ubWVudE5vZGUgZGlzcGxheXMgZXZlcnl0aGluZyBpbiB0aGUgZW52aXJvbm1lbnQgLS0gYnVubmllcywgd29sdmVzLCBmb29kLCB0ZXJyYWluLCBza3ksIGV0Yy5cclxuICogVGhpcyBpcyB0aGUgcGFydCBvZiB0aGUgVUkgd2hlcmUgYnVubmllcyBob3AgYXJvdW5kLCB3b2x2ZXMgaHVudCwgYW5kIHNocnVicyBzaXQgYXJvdW5kIHdhaXRpbmcgdG8gYmUgZWF0ZW4uXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvdW5kczIgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL0JvdW5kczIuanMnO1xyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi8uLi8uLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBQaWNrUmVxdWlyZWQgZnJvbSAnLi4vLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1BpY2tSZXF1aXJlZC5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIE5vZGVPcHRpb25zLCBSZWN0YW5nbGUgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbmF0dXJhbFNlbGVjdGlvbiBmcm9tICcuLi8uLi8uLi9uYXR1cmFsU2VsZWN0aW9uLmpzJztcclxuaW1wb3J0IE5hdHVyYWxTZWxlY3Rpb25Nb2RlbCBmcm9tICcuLi8uLi9tb2RlbC9OYXR1cmFsU2VsZWN0aW9uTW9kZWwuanMnO1xyXG5pbXBvcnQgTmF0dXJhbFNlbGVjdGlvbkNvbG9ycyBmcm9tICcuLi8uLi9OYXR1cmFsU2VsZWN0aW9uQ29sb3JzLmpzJztcclxuaW1wb3J0IEJ1bm55SW1hZ2VNYXAgZnJvbSAnLi4vQnVubnlJbWFnZU1hcC5qcyc7XHJcbmltcG9ydCBFbnZpcm9ubWVudEJhY2tncm91bmROb2RlIGZyb20gJy4vRW52aXJvbm1lbnRCYWNrZ3JvdW5kTm9kZS5qcyc7XHJcbmltcG9ydCBPcmdhbmlzbVNwcml0ZXMgZnJvbSAnLi9PcmdhbmlzbVNwcml0ZXMuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICBzaXplPzogRGltZW5zaW9uMjtcclxuICB5SG9yaXpvbj86IG51bWJlcjtcclxufTtcclxuXHJcbnR5cGUgRW52aXJvbm1lbnROb2RlT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgUGlja1JlcXVpcmVkPE5vZGVPcHRpb25zLCAndGFuZGVtJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFbnZpcm9ubWVudE5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBzcHJpdGVzOiBPcmdhbmlzbVNwcml0ZXM7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbW9kZWw6IE5hdHVyYWxTZWxlY3Rpb25Nb2RlbCwgYnVubnlJbWFnZU1hcDogQnVubnlJbWFnZU1hcCwgcHJvdmlkZWRPcHRpb25zOiBFbnZpcm9ubWVudE5vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8RW52aXJvbm1lbnROb2RlT3B0aW9ucywgU2VsZk9wdGlvbnMsIE5vZGVPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBTZWxmT3B0aW9uc1xyXG4gICAgICBzaXplOiBtb2RlbC5tb2RlbFZpZXdUcmFuc2Zvcm0udmlld1NpemUsXHJcbiAgICAgIHlIb3Jpem9uOiBtb2RlbC5tb2RlbFZpZXdUcmFuc2Zvcm0ueUhvcml6b25WaWV3LFxyXG5cclxuICAgICAgLy8gTm9kZU9wdGlvbnNcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ3RoZSBhcmVhIG9mIHRoZSBzY3JlZW4gdGhhdCBkaXNwbGF5cyB3aGF0IGlzIGhhcHBlbmluZyBpbiB0aGUgZW52aXJvbm1lbnQnLFxyXG4gICAgICBwaGV0aW9WaXNpYmxlUHJvcGVydHlJbnN0cnVtZW50ZWQ6IGZhbHNlXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCBib3VuZHMgPSBuZXcgQm91bmRzMiggMCwgMCwgb3B0aW9ucy5zaXplLndpZHRoLCBvcHRpb25zLnNpemUuaGVpZ2h0ICk7XHJcblxyXG4gICAgLy8gVGhlIGJhY2tncm91bmQsIHdoaWNoIGNoYW5nZXMgdG8gbWF0Y2ggdGhlIGVudmlyb25tZW50XHJcbiAgICBjb25zdCBiYWNrZ3JvdW5kTm9kZSA9IG5ldyBFbnZpcm9ubWVudEJhY2tncm91bmROb2RlKCBtb2RlbC5lbnZpcm9ubWVudFByb3BlcnR5LCBvcHRpb25zLnNpemUsXHJcbiAgICAgIG9wdGlvbnMueUhvcml6b24gKTtcclxuXHJcbiAgICAvLyBGcmFtZSBhcm91bmQgdGhlIGJhY2tncm91bmQsIHRvIHByb3ZpZGUgYSBuaWNlIGNyaXNwIGJvcmRlci5cclxuICAgIGNvbnN0IGZyYW1lTm9kZSA9IG5ldyBSZWN0YW5nbGUoIGJvdW5kcywge1xyXG4gICAgICBzdHJva2U6IE5hdHVyYWxTZWxlY3Rpb25Db2xvcnMuUEFORUxfU1RST0tFXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gSGlnaC1wZXJmb3JtYW5jZSBzcHJpdGVzLCBmb3IgcmVuZGVyaW5nIGJ1bm5pZXMsIHdvbHZlcywgYW5kIGZvb2QuXHJcbiAgICBjb25zdCBzcHJpdGVzID0gbmV3IE9yZ2FuaXNtU3ByaXRlcyggbW9kZWwuYnVubnlDb2xsZWN0aW9uLCBidW5ueUltYWdlTWFwLCBtb2RlbC53b2xmQ29sbGVjdGlvbiwgbW9kZWwuZm9vZCxcclxuICAgICAgbW9kZWwuaXNQbGF5aW5nUHJvcGVydHksIGJvdW5kcywge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnc3ByaXRlcycgKVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgLy8gbGF5ZXJpbmdcclxuICAgIG9wdGlvbnMuY2hpbGRyZW4gPSBbIGJhY2tncm91bmROb2RlLCBzcHJpdGVzLCBmcmFtZU5vZGUgXTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIFByZXNzaW5nIG9uIGFueXRoaW5nIG90aGVyIHRoYW4gYSBidW5ueSBjbGVhcnMgdGhlIHNlbGVjdGlvbi4gcmVtb3ZlSW5wdXRMaXN0ZW5lciBpcyBub3QgbmVjZXNzYXJ5LlxyXG4gICAgYmFja2dyb3VuZE5vZGUuYWRkSW5wdXRMaXN0ZW5lcigge1xyXG4gICAgICBkb3duOiAoKSA9PiB7XHJcbiAgICAgICAgbW9kZWwuYnVubnlDb2xsZWN0aW9uLnNlbGVjdGVkQnVubnlQcm9wZXJ0eS52YWx1ZSA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnNwcml0ZXMgPSBzcHJpdGVzO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmYWxzZSwgJ2Rpc3Bvc2UgaXMgbm90IHN1cHBvcnRlZCwgZXhpc3RzIGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIHNpbScgKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZXMgYWxsIHNwcml0ZXMuXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZVNwcml0ZXMoKTogdm9pZCB7XHJcbiAgICB0aGlzLnNwcml0ZXMudXBkYXRlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5uYXR1cmFsU2VsZWN0aW9uLnJlZ2lzdGVyKCAnRW52aXJvbm1lbnROb2RlJywgRW52aXJvbm1lbnROb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsT0FBTyxNQUFNLGtDQUFrQztBQUV0RCxPQUFPQyxTQUFTLE1BQU0sMENBQTBDO0FBRWhFLFNBQVNDLElBQUksRUFBZUMsU0FBUyxRQUFRLHNDQUFzQztBQUNuRixPQUFPQyxnQkFBZ0IsTUFBTSw4QkFBOEI7QUFFM0QsT0FBT0Msc0JBQXNCLE1BQU0saUNB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