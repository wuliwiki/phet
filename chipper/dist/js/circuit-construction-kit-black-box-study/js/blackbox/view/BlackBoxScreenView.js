// Copyright 2016-2022, University of Colorado Boulder

/**
 * This screen view creates and delegates to the scene views, it does not show anything that is not in a scene.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import ScreenView from '../../../../joist/js/ScreenView.js';
import circuitConstructionKitBlackBoxStudy from '../../circuitConstructionKitBlackBoxStudy.js';
import BlackBoxSceneModel from '../model/BlackBoxSceneModel.js';
import ChallengeSet from '../model/ChallengeSet.js';
import BlackBoxSceneView from './BlackBoxSceneView.js';
import WarmUpSceneView from './WarmUpSceneView.js';
class BlackBoxScreenView extends ScreenView {
  /**
   * @param {BlackBoxModel} blackBoxScreenModel
   * @param {Tandem} tandem
   */
  constructor(blackBoxScreenModel, tandem) {
    super();

    // @private - the model
    this.blackBoxScreenModel = blackBoxScreenModel;

    // @private - the scene views which will be populated when selected
    this.sceneViews = {};
    blackBoxScreenModel.sceneProperty.link(scene => {
      // Create the scene if it did not already exist
      if (!this.sceneViews[scene]) {
        // Use the same dimensions for every black box so the size doesn't indicate what could be inside, in view
        // coordinates
        const blackBoxWidth = 250;
        const blackBoxHeight = 250;
        if (scene === 'warmup') {
          this.sceneViews[scene] = new WarmUpSceneView(blackBoxWidth, blackBoxHeight, new BlackBoxSceneModel(ChallengeSet.warmupCircuitStateObject, tandem.createTandem(`${scene}Model`)), blackBoxScreenModel.sceneProperty, tandem.createTandem(`${scene}Scene`).createTandem('view'));
        } else if (scene.indexOf('scene') === 0) {
          const index = Number(scene.substring('scene'.length));
          this.sceneViews[scene] = new BlackBoxSceneView(blackBoxWidth, blackBoxHeight, new BlackBoxSceneModel(ChallengeSet.challengeArray[index], tandem.createTandem(`${scene}Model`)), blackBoxScreenModel.sceneProperty, tandem.createTandem(`${scene}SceneView`).createTandem('view'));
        } else {
          assert && assert(false, 'no model found');
        }
      }

      // Update layout when the scene changes
      this.updateAllSceneLayouts && this.updateAllSceneLayouts();

      // Show the selected scene
      const sceneView = this.sceneViews[scene];
      this.children = [sceneView];

      // Fix the vertex layering.
      sceneView.model.circuit.vertexGroup.forEach(vertex => vertex.relayerEmitter.emit());
    });
    this.visibleBoundsProperty.link(visibleBounds => {
      // TODO: it seems odd to change this function each time the bounds change.  Perhaps factor out into a single function.
      this.updateAllSceneLayouts = () => {
        _.keys(this.sceneViews).forEach(key => this.sceneViews[key].visibleBoundsProperty.set(visibleBounds.copy()));
      };
      this.updateAllSceneLayouts();
    });
  }

  /**
   * When the model clock ticks in Joist, send the clock tick to the selected scene.
   * @param {number} dt - in seconds
   * @public
   */
  step(dt) {
    this.sceneViews[this.blackBoxScreenModel.sceneProperty.value].model.step(dt);
  }
}
circuitConstructionKitBlackBoxStudy.register('BlackBoxScreenView', BlackBoxScreenView);
export default BlackBoxScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTY3JlZW5WaWV3IiwiY2lyY3VpdENvbnN0cnVjdGlvbktpdEJsYWNrQm94U3R1ZHkiLCJCbGFja0JveFNjZW5lTW9kZWwiLCJDaGFsbGVuZ2VTZXQiLCJCbGFja0JveFNjZW5lVmlldyIsIldhcm1VcFNjZW5lVmlldyIsIkJsYWNrQm94U2NyZWVuVmlldyIsImNvbnN0cnVjdG9yIiwiYmxhY2tCb3hTY3JlZW5Nb2RlbCIsInRhbmRlbSIsInNjZW5lVmlld3MiLCJzY2VuZVByb3BlcnR5IiwibGluayIsInNjZW5lIiwiYmxhY2tCb3hXaWR0aCIsImJsYWNrQm94SGVpZ2h0Iiwid2FybXVwQ2lyY3VpdFN0YXRlT2JqZWN0IiwiY3JlYXRlVGFuZGVtIiwiaW5kZXhPZiIsImluZGV4IiwiTnVtYmVyIiwic3Vic3RyaW5nIiwibGVuZ3RoIiwiY2hhbGxlbmdlQXJyYXkiLCJhc3NlcnQiLCJ1cGRhdGVBbGxTY2VuZUxheW91dHMiLCJzY2VuZVZpZXciLCJjaGlsZHJlbiIsIm1vZGVsIiwiY2lyY3VpdCIsInZlcnRleEdyb3VwIiwiZm9yRWFjaCIsInZlcnRleCIsInJlbGF5ZXJFbWl0dGVyIiwiZW1pdCIsInZpc2libGVCb3VuZHNQcm9wZXJ0eSIsInZpc2libGVCb3VuZHMiLCJfIiwia2V5cyIsImtleSIsInNldCIsImNvcHkiLCJzdGVwIiwiZHQiLCJ2YWx1ZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQmxhY2tCb3hTY3JlZW5WaWV3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFRoaXMgc2NyZWVuIHZpZXcgY3JlYXRlcyBhbmQgZGVsZWdhdGVzIHRvIHRoZSBzY2VuZSB2aWV3cywgaXQgZG9lcyBub3Qgc2hvdyBhbnl0aGluZyB0aGF0IGlzIG5vdCBpbiBhIHNjZW5lLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBTY3JlZW5WaWV3IGZyb20gJy4uLy4uLy4uLy4uL2pvaXN0L2pzL1NjcmVlblZpZXcuanMnO1xyXG5pbXBvcnQgY2lyY3VpdENvbnN0cnVjdGlvbktpdEJsYWNrQm94U3R1ZHkgZnJvbSAnLi4vLi4vY2lyY3VpdENvbnN0cnVjdGlvbktpdEJsYWNrQm94U3R1ZHkuanMnO1xyXG5pbXBvcnQgQmxhY2tCb3hTY2VuZU1vZGVsIGZyb20gJy4uL21vZGVsL0JsYWNrQm94U2NlbmVNb2RlbC5qcyc7XHJcbmltcG9ydCBDaGFsbGVuZ2VTZXQgZnJvbSAnLi4vbW9kZWwvQ2hhbGxlbmdlU2V0LmpzJztcclxuaW1wb3J0IEJsYWNrQm94U2NlbmVWaWV3IGZyb20gJy4vQmxhY2tCb3hTY2VuZVZpZXcuanMnO1xyXG5pbXBvcnQgV2FybVVwU2NlbmVWaWV3IGZyb20gJy4vV2FybVVwU2NlbmVWaWV3LmpzJztcclxuXHJcbmNsYXNzIEJsYWNrQm94U2NyZWVuVmlldyBleHRlbmRzIFNjcmVlblZpZXcge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0JsYWNrQm94TW9kZWx9IGJsYWNrQm94U2NyZWVuTW9kZWxcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGJsYWNrQm94U2NyZWVuTW9kZWwsIHRhbmRlbSApIHtcclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgLSB0aGUgbW9kZWxcclxuICAgIHRoaXMuYmxhY2tCb3hTY3JlZW5Nb2RlbCA9IGJsYWNrQm94U2NyZWVuTW9kZWw7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgLSB0aGUgc2NlbmUgdmlld3Mgd2hpY2ggd2lsbCBiZSBwb3B1bGF0ZWQgd2hlbiBzZWxlY3RlZFxyXG4gICAgdGhpcy5zY2VuZVZpZXdzID0ge307XHJcblxyXG4gICAgYmxhY2tCb3hTY3JlZW5Nb2RlbC5zY2VuZVByb3BlcnR5LmxpbmsoIHNjZW5lID0+IHtcclxuXHJcbiAgICAgIC8vIENyZWF0ZSB0aGUgc2NlbmUgaWYgaXQgZGlkIG5vdCBhbHJlYWR5IGV4aXN0XHJcbiAgICAgIGlmICggIXRoaXMuc2NlbmVWaWV3c1sgc2NlbmUgXSApIHtcclxuXHJcbiAgICAgICAgLy8gVXNlIHRoZSBzYW1lIGRpbWVuc2lvbnMgZm9yIGV2ZXJ5IGJsYWNrIGJveCBzbyB0aGUgc2l6ZSBkb2Vzbid0IGluZGljYXRlIHdoYXQgY291bGQgYmUgaW5zaWRlLCBpbiB2aWV3XHJcbiAgICAgICAgLy8gY29vcmRpbmF0ZXNcclxuICAgICAgICBjb25zdCBibGFja0JveFdpZHRoID0gMjUwO1xyXG4gICAgICAgIGNvbnN0IGJsYWNrQm94SGVpZ2h0ID0gMjUwO1xyXG5cclxuICAgICAgICBpZiAoIHNjZW5lID09PSAnd2FybXVwJyApIHtcclxuICAgICAgICAgIHRoaXMuc2NlbmVWaWV3c1sgc2NlbmUgXSA9IG5ldyBXYXJtVXBTY2VuZVZpZXcoXHJcbiAgICAgICAgICAgIGJsYWNrQm94V2lkdGgsXHJcbiAgICAgICAgICAgIGJsYWNrQm94SGVpZ2h0LFxyXG4gICAgICAgICAgICBuZXcgQmxhY2tCb3hTY2VuZU1vZGVsKCBDaGFsbGVuZ2VTZXQud2FybXVwQ2lyY3VpdFN0YXRlT2JqZWN0LCB0YW5kZW0uY3JlYXRlVGFuZGVtKCBgJHtzY2VuZX1Nb2RlbGAgKSApLFxyXG4gICAgICAgICAgICBibGFja0JveFNjcmVlbk1vZGVsLnNjZW5lUHJvcGVydHksXHJcbiAgICAgICAgICAgIHRhbmRlbS5jcmVhdGVUYW5kZW0oIGAke3NjZW5lfVNjZW5lYCApLmNyZWF0ZVRhbmRlbSggJ3ZpZXcnIClcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCBzY2VuZS5pbmRleE9mKCAnc2NlbmUnICkgPT09IDAgKSB7XHJcbiAgICAgICAgICBjb25zdCBpbmRleCA9IE51bWJlciggc2NlbmUuc3Vic3RyaW5nKCAnc2NlbmUnLmxlbmd0aCApICk7XHJcbiAgICAgICAgICB0aGlzLnNjZW5lVmlld3NbIHNjZW5lIF0gPSBuZXcgQmxhY2tCb3hTY2VuZVZpZXcoXHJcbiAgICAgICAgICAgIGJsYWNrQm94V2lkdGgsXHJcbiAgICAgICAgICAgIGJsYWNrQm94SGVpZ2h0LFxyXG4gICAgICAgICAgICBuZXcgQmxhY2tCb3hTY2VuZU1vZGVsKCBDaGFsbGVuZ2VTZXQuY2hhbGxlbmdlQXJyYXlbIGluZGV4IF0sIHRhbmRlbS5jcmVhdGVUYW5kZW0oIGAke3NjZW5lfU1vZGVsYCApICksXHJcbiAgICAgICAgICAgIGJsYWNrQm94U2NyZWVuTW9kZWwuc2NlbmVQcm9wZXJ0eSxcclxuICAgICAgICAgICAgdGFuZGVtLmNyZWF0ZVRhbmRlbSggYCR7c2NlbmV9U2NlbmVWaWV3YCApLmNyZWF0ZVRhbmRlbSggJ3ZpZXcnIClcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdubyBtb2RlbCBmb3VuZCcgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBsYXlvdXQgd2hlbiB0aGUgc2NlbmUgY2hhbmdlc1xyXG4gICAgICB0aGlzLnVwZGF0ZUFsbFNjZW5lTGF5b3V0cyAmJiB0aGlzLnVwZGF0ZUFsbFNjZW5lTGF5b3V0cygpO1xyXG5cclxuICAgICAgLy8gU2hvdyB0aGUgc2VsZWN0ZWQgc2NlbmVcclxuICAgICAgY29uc3Qgc2NlbmVWaWV3ID0gdGhpcy5zY2VuZVZpZXdzWyBzY2VuZSBdO1xyXG4gICAgICB0aGlzLmNoaWxkcmVuID0gWyBzY2VuZVZpZXcgXTtcclxuXHJcbiAgICAgIC8vIEZpeCB0aGUgdmVydGV4IGxheWVyaW5nLlxyXG4gICAgICBzY2VuZVZpZXcubW9kZWwuY2lyY3VpdC52ZXJ0ZXhHcm91cC5mb3JFYWNoKCB2ZXJ0ZXggPT4gdmVydGV4LnJlbGF5ZXJFbWl0dGVyLmVtaXQoKSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMudmlzaWJsZUJvdW5kc1Byb3BlcnR5LmxpbmsoIHZpc2libGVCb3VuZHMgPT4ge1xyXG5cclxuICAgICAgLy8gVE9ETzogaXQgc2VlbXMgb2RkIHRvIGNoYW5nZSB0aGlzIGZ1bmN0aW9uIGVhY2ggdGltZSB0aGUgYm91bmRzIGNoYW5nZS4gIFBlcmhhcHMgZmFjdG9yIG91dCBpbnRvIGEgc2luZ2xlIGZ1bmN0aW9uLlxyXG4gICAgICB0aGlzLnVwZGF0ZUFsbFNjZW5lTGF5b3V0cyA9ICgpID0+IHtcclxuICAgICAgICBfLmtleXMoIHRoaXMuc2NlbmVWaWV3cyApLmZvckVhY2goXHJcbiAgICAgICAgICBrZXkgPT4gdGhpcy5zY2VuZVZpZXdzWyBrZXkgXS52aXNpYmxlQm91bmRzUHJvcGVydHkuc2V0KCB2aXNpYmxlQm91bmRzLmNvcHkoKSApXHJcbiAgICAgICAgKTtcclxuICAgICAgfTtcclxuICAgICAgdGhpcy51cGRhdGVBbGxTY2VuZUxheW91dHMoKTtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFdoZW4gdGhlIG1vZGVsIGNsb2NrIHRpY2tzIGluIEpvaXN0LCBzZW5kIHRoZSBjbG9jayB0aWNrIHRvIHRoZSBzZWxlY3RlZCBzY2VuZS5cclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHQgLSBpbiBzZWNvbmRzXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHN0ZXAoIGR0ICkge1xyXG4gICAgdGhpcy5zY2VuZVZpZXdzWyB0aGlzLmJsYWNrQm94U2NyZWVuTW9kZWwuc2NlbmVQcm9wZXJ0eS52YWx1ZSBdLm1vZGVsLnN0ZXAoIGR0ICk7XHJcbiAgfVxyXG59XHJcblxyXG5jaXJjdWl0Q29uc3RydWN0aW9uS2l0QmxhY2tCb3hTdHVkeS5yZWdpc3RlciggJ0JsYWNrQm94U2NyZWVuVmlldycsIEJsYWNrQm94U2NyZWVuVmlldyApO1xyXG5leHBvcnQgZGVmYXVsdCBCbGFja0JveFNj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