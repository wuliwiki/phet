// Copyright 2013-2023, University of Colorado Boulder

/**
 * Scenery node for the pie chart, which moves with the skater and shows a pie chart representation of the energies by
 * type. The size of the pie chart is proportional to the total energy.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Bounds2 from '../../../../dot/js/Bounds2.js';
import Utils from '../../../../dot/js/Utils.js';
import { Shape } from '../../../../kite/js/imports.js';
import merge from '../../../../phet-core/js/merge.js';
import platform from '../../../../phet-core/js/platform.js';
import { Circle, Node, Path } from '../../../../scenery/js/imports.js';
import energySkatePark from '../../energySkatePark.js';
import EnergySkateParkColorScheme from './EnergySkateParkColorScheme.js';
class PieChartNode extends Node {
  /**
   * @param {Skater} skater the skater model
   * @param {Property.<Boolean>} pieChartVisibleProperty axon Property indicating whether the pie chart is shown
   * @param {ModelViewTransform2} modelViewTransform
   * @param {Tandem} tandem
   * @param {Object} [options]
   */
  constructor(skater, pieChartVisibleProperty, modelViewTransform, tandem, options) {
    options = merge({
      // {boolean} - Whether to represent negative energy. When true, when one of the energies is negative
      // the pie chart will only show total energy, a solid circle with the color for total energy
      showNegativeEnergy: true
    }, options);
    const sliceOptions = {
      stroke: 'black',
      lineWidth: 1,
      // removes graphical artifacts around sharp corners of the energy slice, see #156
      lineJoin: 'round'
    };
    const kineticEnergySlice = new Path(null, merge({
      fill: EnergySkateParkColorScheme.kineticEnergy
    }, sliceOptions));
    const potentialEnergySlice = new Path(null, merge({
      fill: EnergySkateParkColorScheme.potentialEnergy
    }, sliceOptions));

    // Skip bounds computation to improve performance, see #245
    kineticEnergySlice.computeShapeBounds = () => new Bounds2(0, 0, 0, 0);
    potentialEnergySlice.computeShapeBounds = () => new Bounds2(0, 0, 0, 0);

    // total energy representation is a full circle, so it can use the optimized version.
    const totalEnergyCircle = new Circle(1, {
      fill: EnergySkateParkColorScheme.totalEnergy,
      stroke: 'black',
      lineWidth: 1,
      lineDash: [2, 2],
      opacity: 0.5
    });

    // Back layer is always a circle, so use the optimized version.
    const thermalEnergySlice = new Circle(1, {
      fill: EnergySkateParkColorScheme.thermalEnergy,
      stroke: 'black',
      lineWidth: 1
    });
    super({
      tandem: tandem,
      children: [thermalEnergySlice, potentialEnergySlice, kineticEnergySlice, totalEnergyCircle],
      pickable: false,
      // render with canvas on iOS Safari to improve performance when rendering this Node, see
      // https://github.com/phetsims/energy-skate-park/issues/125
      renderer: platform.mobileSafari ? 'canvas' : null
    });

    // @private {boolean} - whether or not negative potential energy will be represented by the pie chart or it should
    // be invisible in this case
    this.showNegativeEnergy = options.showNegativeEnergy;
    const updatePieChartPosition = () => {
      const view = modelViewTransform.modelToViewPosition(skater.headPositionProperty.value);

      // Center pie chart over skater's head not his feet so it doesn't look awkward when skating in a parabola
      this.setTranslation(view.x, view.y - 50);
    };
    skater.headPositionProperty.link(() => {
      if (this.visible) {
        updatePieChartPosition();
      }
    });
    const updatePaths = () => {
      // Guard against expensive changes while the pie chart is invisible
      if (!this.visible) {
        return;
      }
      const totalEnergy = skater.totalEnergyProperty.value;

      // Make the radius proportional to the square root of the energy so that the area will grow linearly with energy,
      // handling negative energy in case skater is below potential energy reference line
      const radius = 0.5 * Math.sqrt(Math.abs(totalEnergy));

      // If any value is too low, then don't show it, see #136
      const THRESHOLD = 1E-4;

      // if only one component of pie chart, then show as a circle so there are no seams
      const numberComponents = (skater.potentialEnergyProperty.value > THRESHOLD ? 1 : 0) + (skater.kineticEnergyProperty.value > THRESHOLD ? 1 : 0) + (skater.thermalEnergyProperty.value > THRESHOLD ? 1 : 0);

      // Don't show the pie chart if energies are zero, or if potential energy is negative (underground skater), see #189
      const energyNegative = skater.potentialEnergyProperty.value < 0;
      if (energyNegative && this.showNegativeEnergy) {
        // energy is negative and we want to represent it with a full yellow circle
        potentialEnergySlice.visible = false;
        kineticEnergySlice.visible = false;
        thermalEnergySlice.visible = false;
        totalEnergyCircle.visible = true;

        // round to nearest int so that graphics update only happens every pixel change or more
        totalEnergyCircle.radius = Utils.roundSymmetric(radius);
      } else if (numberComponents === 0 || energyNegative) {
        potentialEnergySlice.visible = false;
        kineticEnergySlice.visible = false;
        thermalEnergySlice.visible = false;
        totalEnergyCircle.visible = false;
      } else if (numberComponents === 1) {
        const selectedSlice = skater.potentialEnergyProperty.value > THRESHOLD ? potentialEnergySlice : skater.kineticEnergyProperty.value > THRESHOLD ? kineticEnergySlice : thermalEnergySlice;
        potentialEnergySlice.visible = false;
        thermalEnergySlice.visible = false;
        kineticEnergySlice.visible = false;
        totalEnergyCircle.visible = false;
        selectedSlice.visible = true;

        // Performance optimization for background circle
        if (selectedSlice instanceof Circle) {
          // Round the radius so it will only update the graphics when it changed by a px or more
          selectedSlice.radius = Utils.roundSymmetric(radius);
        } else {
          selectedSlice.shape = Shape.circle(0, 0, radius);
        }
      } else {
        potentialEnergySlice.visible = true;
        kineticEnergySlice.visible = true;
        thermalEnergySlice.visible = true;
        totalEnergyCircle.visible = false;
        const fractionPotential = skater.potentialEnergyProperty.value / skater.totalEnergyProperty.value;
        const fractionKinetic = skater.kineticEnergyProperty.value / skater.totalEnergyProperty.value;

        // Show one of them in the background instead of pieces for each one for performance
        // Round the radius so it will only update the graphics when it changed by a px or more
        thermalEnergySlice.radius = Utils.roundSymmetric(radius);

        // Start thermal at the right and wind counter clockwise, see #133
        // Order is thermal (in the background), kinetic, potential
        const potentialStartAngle = 0;
        const kineticStartAngle = Math.PI * 2 * fractionPotential;

        // If there is no potential energy (i.e. the skater is on the ground) then don't show the potential energy slice,
        // see #165
        if (fractionPotential === 0) {
          potentialEnergySlice.shape = null;
        } else {
          potentialEnergySlice.shape = new Shape().moveTo(0, 0).arc(0, 0, radius, potentialStartAngle, kineticStartAngle, false).lineTo(0, 0).close();
        }
        kineticEnergySlice.shape = new Shape().moveTo(0, 0).arc(0, 0, radius, kineticStartAngle, kineticStartAngle + fractionKinetic * Math.PI * 2, false).lineTo(0, 0).close();
      }
    };

    // instead of changing the entire pie chart whenever one energy changes, use trigger to update the whole pie
    skater.energyChangedEmitter.addListener(updatePaths);

    // Synchronize visibility with the model, and also update when visibility changes because it is guarded against in updatePaths
    pieChartVisibleProperty.link(visible => {
      this.visible = visible;
      updatePaths();
      if (visible) {
        updatePieChartPosition();
      }
    });
  }
}
energySkatePark.register('PieChartNode', PieChartNode);
export default PieChartNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb3VuZHMyIiwiVXRpbHMiLCJTaGFwZSIsIm1lcmdlIiwicGxhdGZvcm0iLCJDaXJjbGUiLCJOb2RlIiwiUGF0aCIsImVuZXJneVNrYXRlUGFyayIsIkVuZXJneVNrYXRlUGFya0NvbG9yU2NoZW1lIiwiUGllQ2hhcnROb2RlIiwiY29uc3RydWN0b3IiLCJza2F0ZXIiLCJwaWVDaGFydFZpc2libGVQcm9wZXJ0eSIsIm1vZGVsVmlld1RyYW5zZm9ybSIsInRhbmRlbSIsIm9wdGlvbnMiLCJzaG93TmVnYXRpdmVFbmVyZ3kiLCJzbGljZU9wdGlvbnMiLCJzdHJva2UiLCJsaW5lV2lkdGgiLCJsaW5lSm9pbiIsImtpbmV0aWNFbmVyZ3lTbGljZSIsImZpbGwiLCJraW5ldGljRW5lcmd5IiwicG90ZW50aWFsRW5lcmd5U2xpY2UiLCJwb3RlbnRpYWxFbmVyZ3kiLCJjb21wdXRlU2hhcGVCb3VuZHMiLCJ0b3RhbEVuZXJneUNpcmNsZSIsInRvdGFsRW5lcmd5IiwibGluZURhc2giLCJvcGFjaXR5IiwidGhlcm1hbEVuZXJneVNsaWNlIiwidGhlcm1hbEVuZXJneSIsImNoaWxkcmVuIiwicGlja2FibGUiLCJyZW5kZXJlciIsIm1vYmlsZVNhZmFyaSIsInVwZGF0ZVBpZUNoYXJ0UG9zaXRpb24iLCJ2aWV3IiwibW9kZWxUb1ZpZXdQb3NpdGlvbiIsImhlYWRQb3NpdGlvblByb3BlcnR5IiwidmFsdWUiLCJzZXRUcmFuc2xhdGlvbiIsIngiLCJ5IiwibGluayIsInZpc2libGUiLCJ1cGRhdGVQYXRocyIsInRvdGFsRW5lcmd5UHJvcGVydHkiLCJyYWRpdXMiLCJNYXRoIiwic3FydCIsImFicyIsIlRIUkVTSE9MRCIsIm51bWJlckNvbXBvbmVudHMiLCJwb3RlbnRpYWxFbmVyZ3lQcm9wZXJ0eSIsImtpbmV0aWNFbmVyZ3lQcm9wZXJ0eSIsInRoZXJtYWxFbmVyZ3lQcm9wZXJ0eSIsImVuZXJneU5lZ2F0aXZlIiwicm91bmRTeW1tZXRyaWMiLCJzZWxlY3RlZFNsaWNlIiwic2hhcGUiLCJjaXJjbGUiLCJmcmFjdGlvblBvdGVudGlhbCIsImZyYWN0aW9uS2luZXRpYyIsInBvdGVudGlhbFN0YXJ0QW5nbGUiLCJraW5ldGljU3RhcnRBbmdsZSIsIlBJIiwibW92ZVRvIiwiYXJjIiwibGluZVRvIiwiY2xvc2UiLCJlbmVyZ3lDaGFuZ2VkRW1pdHRlciIsImFkZExpc3RlbmVyIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQaWVDaGFydE5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2NlbmVyeSBub2RlIGZvciB0aGUgcGllIGNoYXJ0LCB3aGljaCBtb3ZlcyB3aXRoIHRoZSBza2F0ZXIgYW5kIHNob3dzIGEgcGllIGNoYXJ0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBlbmVyZ2llcyBieVxyXG4gKiB0eXBlLiBUaGUgc2l6ZSBvZiB0aGUgcGllIGNoYXJ0IGlzIHByb3BvcnRpb25hbCB0byB0aGUgdG90YWwgZW5lcmd5LlxyXG4gKlxyXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBwbGF0Zm9ybSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvcGxhdGZvcm0uanMnO1xyXG5pbXBvcnQgeyBDaXJjbGUsIE5vZGUsIFBhdGggfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZW5lcmd5U2thdGVQYXJrIGZyb20gJy4uLy4uL2VuZXJneVNrYXRlUGFyay5qcyc7XHJcbmltcG9ydCBFbmVyZ3lTa2F0ZVBhcmtDb2xvclNjaGVtZSBmcm9tICcuL0VuZXJneVNrYXRlUGFya0NvbG9yU2NoZW1lLmpzJztcclxuXHJcbmNsYXNzIFBpZUNoYXJ0Tm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1NrYXRlcn0gc2thdGVyIHRoZSBza2F0ZXIgbW9kZWxcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5LjxCb29sZWFuPn0gcGllQ2hhcnRWaXNpYmxlUHJvcGVydHkgYXhvbiBQcm9wZXJ0eSBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIHBpZSBjaGFydCBpcyBzaG93blxyXG4gICAqIEBwYXJhbSB7TW9kZWxWaWV3VHJhbnNmb3JtMn0gbW9kZWxWaWV3VHJhbnNmb3JtXHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvciggc2thdGVyLCBwaWVDaGFydFZpc2libGVQcm9wZXJ0eSwgbW9kZWxWaWV3VHJhbnNmb3JtLCB0YW5kZW0sIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcblxyXG4gICAgICAvLyB7Ym9vbGVhbn0gLSBXaGV0aGVyIHRvIHJlcHJlc2VudCBuZWdhdGl2ZSBlbmVyZ3kuIFdoZW4gdHJ1ZSwgd2hlbiBvbmUgb2YgdGhlIGVuZXJnaWVzIGlzIG5lZ2F0aXZlXHJcbiAgICAgIC8vIHRoZSBwaWUgY2hhcnQgd2lsbCBvbmx5IHNob3cgdG90YWwgZW5lcmd5LCBhIHNvbGlkIGNpcmNsZSB3aXRoIHRoZSBjb2xvciBmb3IgdG90YWwgZW5lcmd5XHJcbiAgICAgIHNob3dOZWdhdGl2ZUVuZXJneTogdHJ1ZVxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IHNsaWNlT3B0aW9ucyA9IHtcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBsaW5lV2lkdGg6IDEsXHJcblxyXG4gICAgICAvLyByZW1vdmVzIGdyYXBoaWNhbCBhcnRpZmFjdHMgYXJvdW5kIHNoYXJwIGNvcm5lcnMgb2YgdGhlIGVuZXJneSBzbGljZSwgc2VlICMxNTZcclxuICAgICAgbGluZUpvaW46ICdyb3VuZCdcclxuICAgIH07XHJcblxyXG4gICAgY29uc3Qga2luZXRpY0VuZXJneVNsaWNlID0gbmV3IFBhdGgoIG51bGwsIG1lcmdlKCB7XHJcbiAgICAgIGZpbGw6IEVuZXJneVNrYXRlUGFya0NvbG9yU2NoZW1lLmtpbmV0aWNFbmVyZ3lcclxuICAgIH0sIHNsaWNlT3B0aW9ucyApICk7XHJcbiAgICBjb25zdCBwb3RlbnRpYWxFbmVyZ3lTbGljZSA9IG5ldyBQYXRoKCBudWxsLCBtZXJnZSgge1xyXG4gICAgICBmaWxsOiBFbmVyZ3lTa2F0ZVBhcmtDb2xvclNjaGVtZS5wb3RlbnRpYWxFbmVyZ3lcclxuICAgIH0sIHNsaWNlT3B0aW9ucyApICk7XHJcblxyXG4gICAgLy8gU2tpcCBib3VuZHMgY29tcHV0YXRpb24gdG8gaW1wcm92ZSBwZXJmb3JtYW5jZSwgc2VlICMyNDVcclxuICAgIGtpbmV0aWNFbmVyZ3lTbGljZS5jb21wdXRlU2hhcGVCb3VuZHMgPSAoKSA9PiBuZXcgQm91bmRzMiggMCwgMCwgMCwgMCApO1xyXG4gICAgcG90ZW50aWFsRW5lcmd5U2xpY2UuY29tcHV0ZVNoYXBlQm91bmRzID0gKCkgPT4gbmV3IEJvdW5kczIoIDAsIDAsIDAsIDAgKTtcclxuXHJcbiAgICAvLyB0b3RhbCBlbmVyZ3kgcmVwcmVzZW50YXRpb24gaXMgYSBmdWxsIGNpcmNsZSwgc28gaXQgY2FuIHVzZSB0aGUgb3B0aW1pemVkIHZlcnNpb24uXHJcbiAgICBjb25zdCB0b3RhbEVuZXJneUNpcmNsZSA9IG5ldyBDaXJjbGUoIDEsIHtcclxuICAgICAgZmlsbDogRW5lcmd5U2thdGVQYXJrQ29sb3JTY2hlbWUudG90YWxFbmVyZ3ksXHJcbiAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgbGluZVdpZHRoOiAxLFxyXG4gICAgICBsaW5lRGFzaDogWyAyLCAyIF0sXHJcbiAgICAgIG9wYWNpdHk6IDAuNVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEJhY2sgbGF5ZXIgaXMgYWx3YXlzIGEgY2lyY2xlLCBzbyB1c2UgdGhlIG9wdGltaXplZCB2ZXJzaW9uLlxyXG4gICAgY29uc3QgdGhlcm1hbEVuZXJneVNsaWNlID0gbmV3IENpcmNsZSggMSwge1xyXG4gICAgICBmaWxsOiBFbmVyZ3lTa2F0ZVBhcmtDb2xvclNjaGVtZS50aGVybWFsRW5lcmd5LFxyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGxpbmVXaWR0aDogMVxyXG4gICAgfSApO1xyXG5cclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLFxyXG4gICAgICBjaGlsZHJlbjogWyB0aGVybWFsRW5lcmd5U2xpY2UsIHBvdGVudGlhbEVuZXJneVNsaWNlLCBraW5ldGljRW5lcmd5U2xpY2UsIHRvdGFsRW5lcmd5Q2lyY2xlIF0sXHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZSxcclxuXHJcbiAgICAgIC8vIHJlbmRlciB3aXRoIGNhbnZhcyBvbiBpT1MgU2FmYXJpIHRvIGltcHJvdmUgcGVyZm9ybWFuY2Ugd2hlbiByZW5kZXJpbmcgdGhpcyBOb2RlLCBzZWVcclxuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2VuZXJneS1za2F0ZS1wYXJrL2lzc3Vlcy8xMjVcclxuICAgICAgcmVuZGVyZXI6IHBsYXRmb3JtLm1vYmlsZVNhZmFyaSA/ICdjYW52YXMnIDogbnVsbFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlIHtib29sZWFufSAtIHdoZXRoZXIgb3Igbm90IG5lZ2F0aXZlIHBvdGVudGlhbCBlbmVyZ3kgd2lsbCBiZSByZXByZXNlbnRlZCBieSB0aGUgcGllIGNoYXJ0IG9yIGl0IHNob3VsZFxyXG4gICAgLy8gYmUgaW52aXNpYmxlIGluIHRoaXMgY2FzZVxyXG4gICAgdGhpcy5zaG93TmVnYXRpdmVFbmVyZ3kgPSBvcHRpb25zLnNob3dOZWdhdGl2ZUVuZXJneTtcclxuXHJcbiAgICBjb25zdCB1cGRhdGVQaWVDaGFydFBvc2l0aW9uID0gKCkgPT4ge1xyXG5cclxuICAgICAgY29uc3QgdmlldyA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBza2F0ZXIuaGVhZFBvc2l0aW9uUHJvcGVydHkudmFsdWUgKTtcclxuXHJcbiAgICAgIC8vIENlbnRlciBwaWUgY2hhcnQgb3ZlciBza2F0ZXIncyBoZWFkIG5vdCBoaXMgZmVldCBzbyBpdCBkb2Vzbid0IGxvb2sgYXdrd2FyZCB3aGVuIHNrYXRpbmcgaW4gYSBwYXJhYm9sYVxyXG4gICAgICB0aGlzLnNldFRyYW5zbGF0aW9uKCB2aWV3LngsIHZpZXcueSAtIDUwICk7XHJcbiAgICB9O1xyXG4gICAgc2thdGVyLmhlYWRQb3NpdGlvblByb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgICAgaWYgKCB0aGlzLnZpc2libGUgKSB7XHJcbiAgICAgICAgdXBkYXRlUGllQ2hhcnRQb3NpdGlvbigpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgdXBkYXRlUGF0aHMgPSAoKSA9PiB7XHJcblxyXG4gICAgICAvLyBHdWFyZCBhZ2FpbnN0IGV4cGVuc2l2ZSBjaGFuZ2VzIHdoaWxlIHRoZSBwaWUgY2hhcnQgaXMgaW52aXNpYmxlXHJcbiAgICAgIGlmICggIXRoaXMudmlzaWJsZSApIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgdG90YWxFbmVyZ3kgPSBza2F0ZXIudG90YWxFbmVyZ3lQcm9wZXJ0eS52YWx1ZTtcclxuXHJcbiAgICAgIC8vIE1ha2UgdGhlIHJhZGl1cyBwcm9wb3J0aW9uYWwgdG8gdGhlIHNxdWFyZSByb290IG9mIHRoZSBlbmVyZ3kgc28gdGhhdCB0aGUgYXJlYSB3aWxsIGdyb3cgbGluZWFybHkgd2l0aCBlbmVyZ3ksXHJcbiAgICAgIC8vIGhhbmRsaW5nIG5lZ2F0aXZlIGVuZXJneSBpbiBjYXNlIHNrYXRlciBpcyBiZWxvdyBwb3RlbnRpYWwgZW5lcmd5IHJlZmVyZW5jZSBsaW5lXHJcbiAgICAgIGNvbnN0IHJhZGl1cyA9IDAuNSAqIE1hdGguc3FydCggTWF0aC5hYnMoIHRvdGFsRW5lcmd5ICkgKTtcclxuXHJcbiAgICAgIC8vIElmIGFueSB2YWx1ZSBpcyB0b28gbG93LCB0aGVuIGRvbid0IHNob3cgaXQsIHNlZSAjMTM2XHJcbiAgICAgIGNvbnN0IFRIUkVTSE9MRCA9IDFFLTQ7XHJcblxyXG4gICAgICAvLyBpZiBvbmx5IG9uZSBjb21wb25lbnQgb2YgcGllIGNoYXJ0LCB0aGVuIHNob3cgYXMgYSBjaXJjbGUgc28gdGhlcmUgYXJlIG5vIHNlYW1zXHJcbiAgICAgIGNvbnN0IG51bWJlckNvbXBvbmVudHMgPSAoIHNrYXRlci5wb3RlbnRpYWxFbmVyZ3lQcm9wZXJ0eS52YWx1ZSA+IFRIUkVTSE9MRCA/IDEgOiAwICkgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCBza2F0ZXIua2luZXRpY0VuZXJneVByb3BlcnR5LnZhbHVlID4gVEhSRVNIT0xEID8gMSA6IDAgKSArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIHNrYXRlci50aGVybWFsRW5lcmd5UHJvcGVydHkudmFsdWUgPiBUSFJFU0hPTEQgPyAxIDogMCApO1xyXG5cclxuICAgICAgLy8gRG9uJ3Qgc2hvdyB0aGUgcGllIGNoYXJ0IGlmIGVuZXJnaWVzIGFyZSB6ZXJvLCBvciBpZiBwb3RlbnRpYWwgZW5lcmd5IGlzIG5lZ2F0aXZlICh1bmRlcmdyb3VuZCBza2F0ZXIpLCBzZWUgIzE4OVxyXG4gICAgICBjb25zdCBlbmVyZ3lOZWdhdGl2ZSA9IHNrYXRlci5wb3RlbnRpYWxFbmVyZ3lQcm9wZXJ0eS52YWx1ZSA8IDA7XHJcbiAgICAgIGlmICggZW5lcmd5TmVnYXRpdmUgJiYgdGhpcy5zaG93TmVnYXRpdmVFbmVyZ3kgKSB7XHJcblxyXG4gICAgICAgIC8vIGVuZXJneSBpcyBuZWdhdGl2ZSBhbmQgd2Ugd2FudCB0byByZXByZXNlbnQgaXQgd2l0aCBhIGZ1bGwgeWVsbG93IGNpcmNsZVxyXG4gICAgICAgIHBvdGVudGlhbEVuZXJneVNsaWNlLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICBraW5ldGljRW5lcmd5U2xpY2UudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoZXJtYWxFbmVyZ3lTbGljZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgdG90YWxFbmVyZ3lDaXJjbGUudmlzaWJsZSA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIHJvdW5kIHRvIG5lYXJlc3QgaW50IHNvIHRoYXQgZ3JhcGhpY3MgdXBkYXRlIG9ubHkgaGFwcGVucyBldmVyeSBwaXhlbCBjaGFuZ2Ugb3IgbW9yZVxyXG4gICAgICAgIHRvdGFsRW5lcmd5Q2lyY2xlLnJhZGl1cyA9IFV0aWxzLnJvdW5kU3ltbWV0cmljKCByYWRpdXMgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggbnVtYmVyQ29tcG9uZW50cyA9PT0gMCB8fCBlbmVyZ3lOZWdhdGl2ZSApIHtcclxuICAgICAgICBwb3RlbnRpYWxFbmVyZ3lTbGljZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAga2luZXRpY0VuZXJneVNsaWNlLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICB0aGVybWFsRW5lcmd5U2xpY2UudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHRvdGFsRW5lcmd5Q2lyY2xlLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggbnVtYmVyQ29tcG9uZW50cyA9PT0gMSApIHtcclxuICAgICAgICBjb25zdCBzZWxlY3RlZFNsaWNlID0gc2thdGVyLnBvdGVudGlhbEVuZXJneVByb3BlcnR5LnZhbHVlID4gVEhSRVNIT0xEID8gcG90ZW50aWFsRW5lcmd5U2xpY2UgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2F0ZXIua2luZXRpY0VuZXJneVByb3BlcnR5LnZhbHVlID4gVEhSRVNIT0xEID8ga2luZXRpY0VuZXJneVNsaWNlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlcm1hbEVuZXJneVNsaWNlO1xyXG4gICAgICAgIHBvdGVudGlhbEVuZXJneVNsaWNlLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICB0aGVybWFsRW5lcmd5U2xpY2UudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIGtpbmV0aWNFbmVyZ3lTbGljZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgdG90YWxFbmVyZ3lDaXJjbGUudmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHNlbGVjdGVkU2xpY2UudmlzaWJsZSA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIFBlcmZvcm1hbmNlIG9wdGltaXphdGlvbiBmb3IgYmFja2dyb3VuZCBjaXJjbGVcclxuICAgICAgICBpZiAoIHNlbGVjdGVkU2xpY2UgaW5zdGFuY2VvZiBDaXJjbGUgKSB7XHJcblxyXG4gICAgICAgICAgLy8gUm91bmQgdGhlIHJhZGl1cyBzbyBpdCB3aWxsIG9ubHkgdXBkYXRlIHRoZSBncmFwaGljcyB3aGVuIGl0IGNoYW5nZWQgYnkgYSBweCBvciBtb3JlXHJcbiAgICAgICAgICBzZWxlY3RlZFNsaWNlLnJhZGl1cyA9IFV0aWxzLnJvdW5kU3ltbWV0cmljKCByYWRpdXMgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBzZWxlY3RlZFNsaWNlLnNoYXBlID0gU2hhcGUuY2lyY2xlKCAwLCAwLCByYWRpdXMgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcG90ZW50aWFsRW5lcmd5U2xpY2UudmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAga2luZXRpY0VuZXJneVNsaWNlLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIHRoZXJtYWxFbmVyZ3lTbGljZS52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB0b3RhbEVuZXJneUNpcmNsZS52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgY29uc3QgZnJhY3Rpb25Qb3RlbnRpYWwgPSBza2F0ZXIucG90ZW50aWFsRW5lcmd5UHJvcGVydHkudmFsdWUgLyBza2F0ZXIudG90YWxFbmVyZ3lQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgICBjb25zdCBmcmFjdGlvbktpbmV0aWMgPSBza2F0ZXIua2luZXRpY0VuZXJneVByb3BlcnR5LnZhbHVlIC8gc2thdGVyLnRvdGFsRW5lcmd5UHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgICAgIC8vIFNob3cgb25lIG9mIHRoZW0gaW4gdGhlIGJhY2tncm91bmQgaW5zdGVhZCBvZiBwaWVjZXMgZm9yIGVhY2ggb25lIGZvciBwZXJmb3JtYW5jZVxyXG4gICAgICAgIC8vIFJvdW5kIHRoZSByYWRpdXMgc28gaXQgd2lsbCBvbmx5IHVwZGF0ZSB0aGUgZ3JhcGhpY3Mgd2hlbiBpdCBjaGFuZ2VkIGJ5IGEgcHggb3IgbW9yZVxyXG4gICAgICAgIHRoZXJtYWxFbmVyZ3lTbGljZS5yYWRpdXMgPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggcmFkaXVzICk7XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IHRoZXJtYWwgYXQgdGhlIHJpZ2h0IGFuZCB3aW5kIGNvdW50ZXIgY2xvY2t3aXNlLCBzZWUgIzEzM1xyXG4gICAgICAgIC8vIE9yZGVyIGlzIHRoZXJtYWwgKGluIHRoZSBiYWNrZ3JvdW5kKSwga2luZXRpYywgcG90ZW50aWFsXHJcbiAgICAgICAgY29uc3QgcG90ZW50aWFsU3RhcnRBbmdsZSA9IDA7XHJcbiAgICAgICAgY29uc3Qga2luZXRpY1N0YXJ0QW5nbGUgPSBNYXRoLlBJICogMiAqIGZyYWN0aW9uUG90ZW50aWFsO1xyXG5cclxuICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBwb3RlbnRpYWwgZW5lcmd5IChpLmUuIHRoZSBza2F0ZXIgaXMgb24gdGhlIGdyb3VuZCkgdGhlbiBkb24ndCBzaG93IHRoZSBwb3RlbnRpYWwgZW5lcmd5IHNsaWNlLFxyXG4gICAgICAgIC8vIHNlZSAjMTY1XHJcbiAgICAgICAgaWYgKCBmcmFjdGlvblBvdGVudGlhbCA9PT0gMCApIHtcclxuICAgICAgICAgIHBvdGVudGlhbEVuZXJneVNsaWNlLnNoYXBlID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBwb3RlbnRpYWxFbmVyZ3lTbGljZS5zaGFwZSA9IG5ldyBTaGFwZSgpLm1vdmVUbyggMCwgMCApLmFyYyggMCwgMCwgcmFkaXVzLCBwb3RlbnRpYWxTdGFydEFuZ2xlLCBraW5ldGljU3RhcnRBbmdsZSwgZmFsc2UgKS5saW5lVG8oIDAsIDAgKS5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBraW5ldGljRW5lcmd5U2xpY2Uuc2hhcGUgPSBuZXcgU2hhcGUoKS5tb3ZlVG8oIDAsIDAgKS5hcmMoIDAsIDAsIHJhZGl1cywga2luZXRpY1N0YXJ0QW5nbGUsIGtpbmV0aWNTdGFydEFuZ2xlICsgZnJhY3Rpb25LaW5ldGljICogTWF0aC5QSSAqIDIsIGZhbHNlICkubGluZVRvKCAwLCAwICkuY2xvc2UoKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBpbnN0ZWFkIG9mIGNoYW5naW5nIHRoZSBlbnRpcmUgcGllIGNoYXJ0IHdoZW5ldmVyIG9uZSBlbmVyZ3kgY2hhbmdlcywgdXNlIHRyaWdnZXIgdG8gdXBkYXRlIHRoZSB3aG9sZSBwaWVcclxuICAgIHNrYXRlci5lbmVyZ3lDaGFuZ2VkRW1pdHRlci5hZGRMaXN0ZW5lciggdXBkYXRlUGF0aHMgKTtcclxuXHJcbiAgICAvLyBTeW5jaHJvbml6ZSB2aXNpYmlsaXR5IHdpdGggdGhlIG1vZGVsLCBhbmQgYWxzbyB1cGRhdGUgd2hlbiB2aXNpYmlsaXR5IGNoYW5nZXMgYmVjYXVzZSBpdCBpcyBndWFyZGVkIGFnYWluc3QgaW4gdXBkYXRlUGF0aHNcclxuICAgIHBpZUNoYXJ0VmlzaWJsZVByb3BlcnR5LmxpbmsoIHZpc2libGUgPT4ge1xyXG4gICAgICB0aGlzLnZpc2libGUgPSB2aXNpYmxlO1xyXG4gICAgICB1cGRhdGVQYXRocygpO1xyXG4gICAgICBpZiAoIHZpc2libGUgKSB7XHJcbiAgICAgICAgdXBkYXRlUGllQ2hhcnRQb3NpdGlvbigpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5lbmVyZ3lTa2F0ZVBhcmsucmVnaXN0ZXIoICdQaWVDaGFydE5vZGUnLCBQaWVDaGFydE5vZGUgKTtcclxuZXhwb3J0IGRlZmF1bHQgUGllQ2hhcnROb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxTQUFTQyxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsUUFBUSxNQUFNLHNDQUFzQztBQUMzRCxTQUFTQyxNQUFNLEVBQUVDLElBQUksRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUN0RSxPQUFPQyxlQUFlLE1BQU0sMEJBQTBCO0FBQ3RELE9BQU9DLDBCQUEwQixNQUFNLGlDQUFpQztBQUV4RSxNQUFNQyxZQUFZLFNBQVNKLElBQUksQ0FBQztFQUU5QjtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFSyxXQUFXQSxDQUFFQyxNQUFNLEVBQUVDLHVCQUF1QixFQUFFQyxrQkFBa0IsRUFBRUMsTUFBTSxFQUFFQyxPQUFPLEVBQUc7SUFFbEZBLE9BQU8sR0FBR2IsS0FBSyxDQUFFO01BRWY7TUFDQTtNQUNBYyxrQkFBa0IsRUFBRTtJQUN0QixDQUFDLEVBQUVELE9BQVEsQ0FBQztJQUVaLE1BQU1FLFlBQVksR0FBRztNQUNuQkMsTUFBTSxFQUFFLE9BQU87TUFDZkMsU0FBUyxFQUFFLENBQUM7TUFFWjtNQUNBQyxRQUFRLEVBQUU7SUFDWixDQUFDO0lBRUQsTUFBTUMsa0JBQWtCLEdBQUcsSUFBSWYsSUFBSSxDQUFFLElBQUksRUFBRUosS0FBSyxDQUFFO01BQ2hEb0IsSUFBSSxFQUFFZCwwQkFBMEIsQ0FBQ2U7SUFDbkMsQ0FBQyxFQUFFTixZQUFhLENBQUUsQ0FBQztJQUNuQixNQUFNTyxvQkFBb0IsR0FBRyxJQUFJbEIsSUFBSSxDQUFFLElBQUksRUFBRUosS0FBSyxDQUFFO01BQ2xEb0IsSUFBSSxFQUFFZCwwQkFBMEIsQ0FBQ2lCO0lBQ25DLENBQUMsRUFBRVIsWUFBYSxDQUFFLENBQUM7O0lBRW5CO0lBQ0FJLGtCQUFrQixDQUFDSyxrQkFBa0IsR0FBRyxNQUFNLElBQUkzQixPQUFPLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDO0lBQ3ZFeUIsb0JBQW9CLENBQUNFLGtCQUFrQixHQUFHLE1BQU0sSUFBSTNCLE9BQU8sQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFFLENBQUM7O0lBRXpFO0lBQ0EsTUFBTTRCLGlCQUFpQixHQUFHLElBQUl2QixNQUFNLENBQUUsQ0FBQyxFQUFFO01BQ3ZDa0IsSUFBSSxFQUFFZCwwQkFBMEIsQ0FBQ29CLFdBQVc7TUFDNUNWLE1BQU0sRUFBRSxPQUFPO01BQ2ZDLFNBQVMsRUFBRSxDQUFDO01BQ1pVLFFBQVEsRUFBRSxDQUFFLENBQUMsRUFBRSxDQUFDLENBQUU7TUFDbEJDLE9BQU8sRUFBRTtJQUNYLENBQUUsQ0FBQzs7SUFFSDtJQUNBLE1BQU1DLGtCQUFrQixHQUFHLElBQUkzQixNQUFNLENBQUUsQ0FBQyxFQUFFO01BQ3hDa0IsSUFBSSxFQUFFZCwwQkFBMEIsQ0FBQ3dCLGFBQWE7TUFDOUNkLE1BQU0sRUFBRSxPQUFPO01BQ2ZDLFNBQVMsRUFBRTtJQUNiLENBQUUsQ0FBQztJQUVILEtBQUssQ0FBRTtNQUNMTCxNQUFNLEVBQUVBLE1BQU07TUFDZG1CLFFBQVEsRUFBRSxDQUFFRixrQkFBa0IsRUFBRVAsb0JBQW9CLEVBQUVILGtCQUFrQixFQUFFTSxpQkFBaUIsQ0FBRTtNQUM3Rk8sUUFBUSxFQUFFLEtBQUs7TUFFZjtNQUNBO01BQ0FDLFFBQVEsRUFBRWhDLFFBQVEsQ0FBQ2lDLFlBQVksR0FBRyxRQUFRLEdBQUc7SUFDL0MsQ0FBRSxDQUFDOztJQUVIO0lBQ0E7SUFDQSxJQUFJLENBQUNwQixrQkFBa0IsR0FBR0QsT0FBTyxDQUFDQyxrQkFBa0I7SUFFcEQsTUFBTXFCLHNCQUFzQixHQUFHQSxDQUFBLEtBQU07TUFFbkMsTUFBTUMsSUFBSSxHQUFHekIsa0JBQWtCLENBQUMwQixtQkFBbUIsQ0FBRTVCLE1BQU0sQ0FBQzZCLG9CQUFvQixDQUFDQyxLQUFNLENBQUM7O01BRXhGO01BQ0EsSUFBSSxDQUFDQyxjQUFjLENBQUVKLElBQUksQ0FBQ0ssQ0FBQyxFQUFFTCxJQUFJLENBQUNNLENBQUMsR0FBRyxFQUFHLENBQUM7SUFDNUMsQ0FBQztJQUNEakMsTUFBTSxDQUFDNkIsb0JBQW9CLENBQUNLLElBQUksQ0FBRSxNQUFNO01BQ3RDLElBQUssSUFBSSxDQUFDQyxPQUFPLEVBQUc7UUFDbEJULHNCQUFzQixDQUFDLENBQUM7TUFDMUI7SUFDRixDQUFFLENBQUM7SUFFSCxNQUFNVSxXQUFXLEdBQUdBLENBQUEsS0FBTTtNQUV4QjtNQUNBLElBQUssQ0FBQyxJQUFJLENBQUNELE9BQU8sRUFBRztRQUNuQjtNQUNGO01BQ0EsTUFBTWxCLFdBQVcsR0FBR2pCLE1BQU0sQ0FBQ3FDLG1CQUFtQixDQUFDUCxLQUFLOztNQUVwRDtNQUNBO01BQ0EsTUFBTVEsTUFBTSxHQUFHLEdBQUcsR0FBR0MsSUFBSSxDQUFDQyxJQUFJLENBQUVELElBQUksQ0FBQ0UsR0FBRyxDQUFFeEIsV0FBWSxDQUFFLENBQUM7O01BRXpEO01BQ0EsTUFBTXlCLFNBQVMsR0FBRyxJQUFJOztNQUV0QjtNQUNBLE1BQU1DLGdCQUFnQixHQUFHLENBQUUzQyxNQUFNLENBQUM0Qyx1QkFBdUIsQ0FBQ2QsS0FBSyxHQUFHWSxTQUFTLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FDeEQxQyxNQUFNLENBQUM2QyxxQkFBcUIsQ0FBQ2YsS0FBSyxHQUFHWSxTQUFTLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBRSxJQUN4RDFDLE1BQU0sQ0FBQzhDLHFCQUFxQixDQUFDaEIsS0FBSyxHQUFHWSxTQUFTLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBRTs7TUFFbkY7TUFDQSxNQUFNSyxjQUFjLEdBQUcvQyxNQUFNLENBQUM0Qyx1QkFBdUIsQ0FBQ2QsS0FBSyxHQUFHLENBQUM7TUFDL0QsSUFBS2lCLGNBQWMsSUFBSSxJQUFJLENBQUMxQyxrQkFBa0IsRUFBRztRQUUvQztRQUNBUSxvQkFBb0IsQ0FBQ3NCLE9BQU8sR0FBRyxLQUFLO1FBQ3BDekIsa0JBQWtCLENBQUN5QixPQUFPLEdBQUcsS0FBSztRQUNsQ2Ysa0JBQWtCLENBQUNlLE9BQU8sR0FBRyxLQUFLO1FBQ2xDbkIsaUJBQWlCLENBQUNtQixPQUFPLEdBQUcsSUFBSTs7UUFFaEM7UUFDQW5CLGlCQUFpQixDQUFDc0IsTUFBTSxHQUFHakQsS0FBSyxDQUFDMkQsY0FBYyxDQUFFVixNQUFPLENBQUM7TUFDM0QsQ0FBQyxNQUNJLElBQUtLLGdCQUFnQixLQUFLLENBQUMsSUFBSUksY0FBYyxFQUFHO1FBQ25EbEMsb0JBQW9CLENBQUNzQixPQUFPLEdBQUcsS0FBSztRQUNwQ3pCLGtCQUFrQixDQUFDeUIsT0FBTyxHQUFHLEtBQUs7UUFDbENmLGtCQUFrQixDQUFDZSxPQUFPLEdBQUcsS0FBSztRQUNsQ25CLGlCQUFpQixDQUFDbUIsT0FBTyxHQUFHLEtBQUs7TUFDbkMsQ0FBQyxNQUNJLElBQUtRLGdCQUFnQixLQUFLLENBQUMsRUFBRztRQUNqQyxNQUFNTSxhQUFhLEdBQUdqRCxNQUFNLENBQUM0Qyx1QkFBdUIsQ0FBQ2QsS0FBSyxHQUFHWSxTQUFTLEdBQUc3QixvQkFBb0IsR0FDdkViLE1BQU0sQ0FBQzZDLHFCQUFxQixDQUFDZixLQUFLLEdBQUdZLFNBQVMsR0FBR2hDLGtCQUFrQixHQUNuRVUsa0JBQWtCO1FBQ3hDUCxvQkFBb0IsQ0FBQ3NCLE9BQU8sR0FBRyxLQUFLO1FBQ3BDZixrQkFBa0IsQ0FBQ2UsT0FBTyxHQUFHLEtBQUs7UUFDbEN6QixrQkFBa0IsQ0FBQ3lCLE9BQU8sR0FBRyxLQUFLO1FBQ2xDbkIsaUJBQWlCLENBQUNtQixPQUFPLEdBQUcsS0FBSztRQUNqQ2MsYUFBYSxDQUFDZCxPQUFPLEdBQUcsSUFBSTs7UUFFNUI7UUFDQSxJQUFLYyxhQUFhLFlBQVl4RCxNQUFNLEVBQUc7VUFFckM7VUFDQXdELGFBQWEsQ0FBQ1gsTUFBTSxHQUFHakQsS0FBSyxDQUFDMkQsY0FBYyxDQUFFVixNQUFPLENBQUM7UUFDdkQsQ0FBQyxNQUNJO1VBQ0hXLGFBQWEsQ0FBQ0MsS0FBSyxHQUFHNUQsS0FBSyxDQUFDNkQsTUFBTSxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUViLE1BQU8sQ0FBQztRQUNwRDtNQUNGLENBQUMsTUFDSTtRQUNIekIsb0JBQW9CLENBQUNzQixPQUFPLEdBQUcsSUFBSTtRQUNuQ3pCLGtCQUFrQixDQUFDeUIsT0FBTyxHQUFHLElBQUk7UUFDakNmLGtCQUFrQixDQUFDZSxPQUFPLEdBQUcsSUFBSTtRQUNqQ25CLGlCQUFpQixDQUFDbUIsT0FBTyxHQUFHLEtBQUs7UUFDakMsTUFBTWlCLGlCQUFpQixHQUFHcEQsTUFBTSxDQUFDNEMsdUJBQXVCLENBQUNkLEtBQUssR0FBRzlCLE1BQU0sQ0FBQ3FDLG1CQUFtQixDQUFDUCxLQUFLO1FBQ2pHLE1BQU11QixlQUFlLEdBQUdyRCxNQUFNLENBQUM2QyxxQkFBcUIsQ0FBQ2YsS0FBSyxHQUFHOUIsTUFBTSxDQUFDcUMsbUJBQW1CLENBQUNQLEtBQUs7O1FBRTdGO1FBQ0E7UUFDQVYsa0JBQWtCLENBQUNrQixNQUFNLEdBQUdqRCxLQUFLLENBQUMyRCxjQUFjLENBQUVWLE1BQU8sQ0FBQzs7UUFFMUQ7UUFDQTtRQUNBLE1BQU1nQixtQkFBbUIsR0FBRyxDQUFDO1FBQzdCLE1BQU1DLGlCQUFpQixHQUFHaEIsSUFBSSxDQUFDaUIsRUFBRSxHQUFHLENBQUMsR0FBR0osaUJBQWlCOztRQUV6RDtRQUNBO1FBQ0EsSUFBS0EsaUJBQWlCLEtBQUssQ0FBQyxFQUFHO1VBQzdCdkMsb0JBQW9CLENBQUNxQyxLQUFLLEdBQUcsSUFBSTtRQUNuQyxDQUFDLE1BQ0k7VUFDSHJDLG9CQUFvQixDQUFDcUMsS0FBSyxHQUFHLElBQUk1RCxLQUFLLENBQUMsQ0FBQyxDQUFDbUUsTUFBTSxDQUFFLENBQUMsRUFBRSxDQUFFLENBQUMsQ0FBQ0MsR0FBRyxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUVwQixNQUFNLEVBQUVnQixtQkFBbUIsRUFBRUMsaUJBQWlCLEVBQUUsS0FBTSxDQUFDLENBQUNJLE1BQU0sQ0FBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDLENBQUNDLEtBQUssQ0FBQyxDQUFDO1FBQ25KO1FBQ0FsRCxrQkFBa0IsQ0FBQ3dDLEtBQUssR0FBRyxJQUFJNUQsS0FBSyxDQUFDLENBQUMsQ0FBQ21FLE1BQU0sQ0FBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDLENBQUNDLEdBQUcsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFcEIsTUFBTSxFQUFFaUIsaUJBQWlCLEVBQUVBLGlCQUFpQixHQUFHRixlQUFlLEdBQUdkLElBQUksQ0FBQ2lCLEVBQUUsR0FBRyxDQUFDLEVBQUUsS0FBTSxDQUFDLENBQUNHLE1BQU0sQ0FBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDLENBQUNDLEtBQUssQ0FBQyxDQUFDO01BQy9LO0lBQ0YsQ0FBQzs7SUFFRDtJQUNBNUQsTUFBTSxDQUFDNkQsb0JBQW9CLENBQUNDLFdBQVcsQ0FBRTFCLFdBQVksQ0FBQzs7SUFFdEQ7SUFDQW5DLHVCQUF1QixDQUFDaUMsSUFBSSxDQUFFQyxPQUFPLElBQUk7TUFDdkMsSUFBSSxDQUFDQSxPQUFPLEdBQUdBLE9BQU87TUFDdEJDLFdBQVcsQ0FBQyxDQUFDO01BQ2IsSUFBS0QsT0FBTyxFQUFHO1FBQ2JULHNCQUFzQixDQUFDLENBQUM7TUFDMUI7SUFDRixDQUFFLENBQUM7RUFDTDtBQUNGO0FBRUE5QixlQUFlLENBQUNtRSxRQUFRLENBQUUsY0FBYyxFQUFFakUsWUFBYSxDQUFDO0FBQ3hELGVBQWVBLFlBQVkifQ==