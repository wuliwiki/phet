// Copyright 2013-2022, University of Colorado Boulder

/**
 * Scenery node that shows the legend for the pie chart, and a reset button for thermal energy.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 */

import merge from '../../../../phet-core/js/merge.js';
import MoveToTrashLegendButton from '../../../../scenery-phet/js/buttons/MoveToTrashLegendButton.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { HBox, HStrut, Rectangle, Text, VBox, VStrut } from '../../../../scenery/js/imports.js';
import Panel from '../../../../sun/js/Panel.js';
import energySkatePark from '../../energySkatePark.js';
import EnergySkateParkStrings from '../../EnergySkateParkStrings.js';
import EnergySkateParkConstants from '../EnergySkateParkConstants.js';
import EnergySkateParkColorScheme from './EnergySkateParkColorScheme.js';
const energyEnergyString = EnergySkateParkStrings.energies.energyStringProperty;
const energyKineticString = EnergySkateParkStrings.energies.kineticStringProperty;
const energyPotentialString = EnergySkateParkStrings.energies.potentialStringProperty;
const energyThermalString = EnergySkateParkStrings.energies.thermalStringProperty;
const energyTotalString = EnergySkateParkStrings.energies.totalStringProperty;
class PieChartLegend extends Panel {
  /**
   * @param {Skater} skater the model for the skater
   * @param {Function} clearThermal function to be called when the user presses the clear thermal button
   * @param {Property.<boolean>} pieChartVisibleProperty axon Property indicating whether the pie chart is visible
   * @param {Tandem} tandem
   * @param {Object} [options]
   */
  constructor(skater, clearThermal, pieChartVisibleProperty, tandem, options) {
    options = merge({
      // {boolean} - whether or not to include total energy in the legend, will the pie chart show total energy?
      includeTotal: true
    }, options);

    // The x-coordinate of a bar chart bar
    const createLabel = (index, title, tandemName) => {
      return new Text(title, {
        tandem: tandem.createTandem(tandemName),
        font: EnergySkateParkConstants.CONTROL_LABEL_FONT,
        pickable: false,
        maxWidth: 97 // selected by choosing the length of widest English string in ?stringTest=double
      });
    };

    const createBar = (index, color) => {
      return new Rectangle(0, 0, 20.26, 20.26, {
        fill: color,
        stroke: 'black',
        lineWidth: 1
      });
    };
    const kineticBar = createBar(0, EnergySkateParkColorScheme.kineticEnergy);
    const potentialBar = createBar(1, EnergySkateParkColorScheme.potentialEnergy);
    const thermalBar = createBar(2, EnergySkateParkColorScheme.thermalEnergy);
    const totalBar = createBar(3, EnergySkateParkColorScheme.totalEnergy);
    const kineticLabel = createLabel(0, energyKineticString, 'kineticEnergyLabelText');
    const potentialLabel = createLabel(1, energyPotentialString, 'potentialEnergyLabelText');
    const thermalLabel = createLabel(2, energyThermalString, 'thermalEnergyLabelText');
    const totalLabel = createLabel(3, energyTotalString, 'totalEnergyLabelText');
    const clearThermalButton = new MoveToTrashLegendButton({
      arrowColor: EnergySkateParkColorScheme.thermalEnergy,
      tandem: tandem.createTandem('clearThermalButton'),
      listener: clearThermal,
      centerX: thermalLabel.centerX,
      y: thermalLabel.bottom + 15,
      scale: 0.8
    });
    skater.allowClearingThermalEnergyProperty.link(allowClearingThermalEnergy => {
      clearThermalButton.enabled = allowClearingThermalEnergy;
    });

    // Don't let the MoveToTrashLegendButton participate in the layout since it is too big vertically.  Just use a strut to
    // get the width right, then add the undo button later
    const clearThermalButtonStrut = new Rectangle(0, 0, clearThermalButton.width, 1, {});
    const spacing = 5;
    const children = [new HBox({
      spacing: spacing,
      children: [kineticBar, kineticLabel]
    }), new HBox({
      spacing: spacing,
      children: [potentialBar, potentialLabel]
    }), new HBox({
      spacing: spacing,
      children: [thermalBar, thermalLabel, new HStrut(1), clearThermalButtonStrut, new HStrut(3)]
    })];
    if (options.includeTotal) {
      children.push(new HBox({
        spacing: 4,
        children: [totalBar, totalLabel]
      }));
    }
    children.push(new VStrut(1.2));
    const contentNode = new VBox({
      spacing: 6,
      align: 'left',
      children: children
    });
    const titleText = new Text(energyEnergyString, {
      tandem: tandem.createTandem('titleText'),
      fill: 'black',
      font: new PhetFont(17),
      pickable: false,
      maxWidth: 93 // selected by choosing the length of widest English string in ?stringTest=double
    });

    const contentWithTitle = new VBox({
      spacing: 6.14,
      align: 'center',
      children: [titleText, contentNode]
    });
    super(contentWithTitle, merge({
      x: 4,
      y: 4,
      xMargin: 7,
      yMargin: 6,
      resize: false,
      tandem: tandem
    }, EnergySkateParkConstants.GRAPH_PANEL_OPTONS));
    this.addChild(clearThermalButton);
    const strutGlobal = clearThermalButtonStrut.parentToGlobalPoint(clearThermalButtonStrut.center);
    const buttonLocal = clearThermalButton.globalToParentPoint(strutGlobal);
    clearThermalButton.center = buttonLocal;
    pieChartVisibleProperty.linkAttribute(this, 'visible');

    // this button is small and usability is improved by larger touch areas
    clearThermalButton.touchArea = clearThermalButton.localBounds.dilated(10);
  }
}
energySkatePark.register('PieChartLegend', PieChartLegend);
export default PieChartLegend;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtZXJnZSIsIk1vdmVUb1RyYXNoTGVnZW5kQnV0dG9uIiwiUGhldEZvbnQiLCJIQm94IiwiSFN0cnV0IiwiUmVjdGFuZ2xlIiwiVGV4dCIsIlZCb3giLCJWU3RydXQiLCJQYW5lbCIsImVuZXJneVNrYXRlUGFyayIsIkVuZXJneVNrYXRlUGFya1N0cmluZ3MiLCJFbmVyZ3lTa2F0ZVBhcmtDb25zdGFudHMiLCJFbmVyZ3lTa2F0ZVBhcmtDb2xvclNjaGVtZSIsImVuZXJneUVuZXJneVN0cmluZyIsImVuZXJnaWVzIiwiZW5lcmd5U3RyaW5nUHJvcGVydHkiLCJlbmVyZ3lLaW5ldGljU3RyaW5nIiwia2luZXRpY1N0cmluZ1Byb3BlcnR5IiwiZW5lcmd5UG90ZW50aWFsU3RyaW5nIiwicG90ZW50aWFsU3RyaW5nUHJvcGVydHkiLCJlbmVyZ3lUaGVybWFsU3RyaW5nIiwidGhlcm1hbFN0cmluZ1Byb3BlcnR5IiwiZW5lcmd5VG90YWxTdHJpbmciLCJ0b3RhbFN0cmluZ1Byb3BlcnR5IiwiUGllQ2hhcnRMZWdlbmQiLCJjb25zdHJ1Y3RvciIsInNrYXRlciIsImNsZWFyVGhlcm1hbCIsInBpZUNoYXJ0VmlzaWJsZVByb3BlcnR5IiwidGFuZGVtIiwib3B0aW9ucyIsImluY2x1ZGVUb3RhbCIsImNyZWF0ZUxhYmVsIiwiaW5kZXgiLCJ0aXRsZSIsInRhbmRlbU5hbWUiLCJjcmVhdGVUYW5kZW0iLCJmb250IiwiQ09OVFJPTF9MQUJFTF9GT05UIiwicGlja2FibGUiLCJtYXhXaWR0aCIsImNyZWF0ZUJhciIsImNvbG9yIiwiZmlsbCIsInN0cm9rZSIsImxpbmVXaWR0aCIsImtpbmV0aWNCYXIiLCJraW5ldGljRW5lcmd5IiwicG90ZW50aWFsQmFyIiwicG90ZW50aWFsRW5lcmd5IiwidGhlcm1hbEJhciIsInRoZXJtYWxFbmVyZ3kiLCJ0b3RhbEJhciIsInRvdGFsRW5lcmd5Iiwia2luZXRpY0xhYmVsIiwicG90ZW50aWFsTGFiZWwiLCJ0aGVybWFsTGFiZWwiLCJ0b3RhbExhYmVsIiwiY2xlYXJUaGVybWFsQnV0dG9uIiwiYXJyb3dDb2xvciIsImxpc3RlbmVyIiwiY2VudGVyWCIsInkiLCJib3R0b20iLCJzY2FsZSIsImFsbG93Q2xlYXJpbmdUaGVybWFsRW5lcmd5UHJvcGVydHkiLCJsaW5rIiwiYWxsb3dDbGVhcmluZ1RoZXJtYWxFbmVyZ3kiLCJlbmFibGVkIiwiY2xlYXJUaGVybWFsQnV0dG9uU3RydXQiLCJ3aWR0aCIsInNwYWNpbmciLCJjaGlsZHJlbiIsInB1c2giLCJjb250ZW50Tm9kZSIsImFsaWduIiwidGl0bGVUZXh0IiwiY29udGVudFdpdGhUaXRsZSIsIngiLCJ4TWFyZ2luIiwieU1hcmdpbiIsInJlc2l6ZSIsIkdSQVBIX1BBTkVMX09QVE9OUyIsImFkZENoaWxkIiwic3RydXRHbG9iYWwiLCJwYXJlbnRUb0dsb2JhbFBvaW50IiwiY2VudGVyIiwiYnV0dG9uTG9jYWwiLCJnbG9iYWxUb1BhcmVudFBvaW50IiwibGlua0F0dHJpYnV0ZSIsInRvdWNoQXJlYSIsImxvY2FsQm91bmRzIiwiZGlsYXRlZCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUGllQ2hhcnRMZWdlbmQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2NlbmVyeSBub2RlIHRoYXQgc2hvd3MgdGhlIGxlZ2VuZCBmb3IgdGhlIHBpZSBjaGFydCwgYW5kIGEgcmVzZXQgYnV0dG9uIGZvciB0aGVybWFsIGVuZXJneS5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IE1vdmVUb1RyYXNoTGVnZW5kQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL01vdmVUb1RyYXNoTGVnZW5kQnV0dG9uLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IEhCb3gsIEhTdHJ1dCwgUmVjdGFuZ2xlLCBUZXh0LCBWQm94LCBWU3RydXQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgUGFuZWwgZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL1BhbmVsLmpzJztcclxuaW1wb3J0IGVuZXJneVNrYXRlUGFyayBmcm9tICcuLi8uLi9lbmVyZ3lTa2F0ZVBhcmsuanMnO1xyXG5pbXBvcnQgRW5lcmd5U2thdGVQYXJrU3RyaW5ncyBmcm9tICcuLi8uLi9FbmVyZ3lTa2F0ZVBhcmtTdHJpbmdzLmpzJztcclxuaW1wb3J0IEVuZXJneVNrYXRlUGFya0NvbnN0YW50cyBmcm9tICcuLi9FbmVyZ3lTa2F0ZVBhcmtDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgRW5lcmd5U2thdGVQYXJrQ29sb3JTY2hlbWUgZnJvbSAnLi9FbmVyZ3lTa2F0ZVBhcmtDb2xvclNjaGVtZS5qcyc7XHJcblxyXG5jb25zdCBlbmVyZ3lFbmVyZ3lTdHJpbmcgPSBFbmVyZ3lTa2F0ZVBhcmtTdHJpbmdzLmVuZXJnaWVzLmVuZXJneVN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBlbmVyZ3lLaW5ldGljU3RyaW5nID0gRW5lcmd5U2thdGVQYXJrU3RyaW5ncy5lbmVyZ2llcy5raW5ldGljU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGVuZXJneVBvdGVudGlhbFN0cmluZyA9IEVuZXJneVNrYXRlUGFya1N0cmluZ3MuZW5lcmdpZXMucG90ZW50aWFsU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGVuZXJneVRoZXJtYWxTdHJpbmcgPSBFbmVyZ3lTa2F0ZVBhcmtTdHJpbmdzLmVuZXJnaWVzLnRoZXJtYWxTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgZW5lcmd5VG90YWxTdHJpbmcgPSBFbmVyZ3lTa2F0ZVBhcmtTdHJpbmdzLmVuZXJnaWVzLnRvdGFsU3RyaW5nUHJvcGVydHk7XHJcblxyXG5jbGFzcyBQaWVDaGFydExlZ2VuZCBleHRlbmRzIFBhbmVsIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtTa2F0ZXJ9IHNrYXRlciB0aGUgbW9kZWwgZm9yIHRoZSBza2F0ZXJcclxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjbGVhclRoZXJtYWwgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIHdoZW4gdGhlIHVzZXIgcHJlc3NlcyB0aGUgY2xlYXIgdGhlcm1hbCBidXR0b25cclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5Ljxib29sZWFuPn0gcGllQ2hhcnRWaXNpYmxlUHJvcGVydHkgYXhvbiBQcm9wZXJ0eSBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIHBpZSBjaGFydCBpcyB2aXNpYmxlXHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvciggc2thdGVyLCBjbGVhclRoZXJtYWwsIHBpZUNoYXJ0VmlzaWJsZVByb3BlcnR5LCB0YW5kZW0sIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcblxyXG4gICAgICAvLyB7Ym9vbGVhbn0gLSB3aGV0aGVyIG9yIG5vdCB0byBpbmNsdWRlIHRvdGFsIGVuZXJneSBpbiB0aGUgbGVnZW5kLCB3aWxsIHRoZSBwaWUgY2hhcnQgc2hvdyB0b3RhbCBlbmVyZ3k/XHJcbiAgICAgIGluY2x1ZGVUb3RhbDogdHJ1ZVxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIFRoZSB4LWNvb3JkaW5hdGUgb2YgYSBiYXIgY2hhcnQgYmFyXHJcbiAgICBjb25zdCBjcmVhdGVMYWJlbCA9ICggaW5kZXgsIHRpdGxlLCB0YW5kZW1OYW1lICkgPT4ge1xyXG4gICAgICByZXR1cm4gbmV3IFRleHQoIHRpdGxlLCB7XHJcbiAgICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCB0YW5kZW1OYW1lICksXHJcbiAgICAgICAgZm9udDogRW5lcmd5U2thdGVQYXJrQ29uc3RhbnRzLkNPTlRST0xfTEFCRUxfRk9OVCxcclxuICAgICAgICBwaWNrYWJsZTogZmFsc2UsXHJcbiAgICAgICAgbWF4V2lkdGg6IDk3IC8vIHNlbGVjdGVkIGJ5IGNob29zaW5nIHRoZSBsZW5ndGggb2Ygd2lkZXN0IEVuZ2xpc2ggc3RyaW5nIGluID9zdHJpbmdUZXN0PWRvdWJsZVxyXG4gICAgICB9ICk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGNyZWF0ZUJhciA9ICggaW5kZXgsIGNvbG9yICkgPT4ge1xyXG4gICAgICByZXR1cm4gbmV3IFJlY3RhbmdsZSggMCwgMCwgMjAuMjYsIDIwLjI2LCB7XHJcbiAgICAgICAgZmlsbDogY29sb3IsXHJcbiAgICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICAgIGxpbmVXaWR0aDogMVxyXG4gICAgICB9ICk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGtpbmV0aWNCYXIgPSBjcmVhdGVCYXIoIDAsIEVuZXJneVNrYXRlUGFya0NvbG9yU2NoZW1lLmtpbmV0aWNFbmVyZ3kgKTtcclxuICAgIGNvbnN0IHBvdGVudGlhbEJhciA9IGNyZWF0ZUJhciggMSwgRW5lcmd5U2thdGVQYXJrQ29sb3JTY2hlbWUucG90ZW50aWFsRW5lcmd5ICk7XHJcbiAgICBjb25zdCB0aGVybWFsQmFyID0gY3JlYXRlQmFyKCAyLCBFbmVyZ3lTa2F0ZVBhcmtDb2xvclNjaGVtZS50aGVybWFsRW5lcmd5ICk7XHJcbiAgICBjb25zdCB0b3RhbEJhciA9IGNyZWF0ZUJhciggMywgRW5lcmd5U2thdGVQYXJrQ29sb3JTY2hlbWUudG90YWxFbmVyZ3kgKTtcclxuXHJcbiAgICBjb25zdCBraW5ldGljTGFiZWwgPSBjcmVhdGVMYWJlbCggMCwgZW5lcmd5S2luZXRpY1N0cmluZywgJ2tpbmV0aWNFbmVyZ3lMYWJlbFRleHQnICk7XHJcbiAgICBjb25zdCBwb3RlbnRpYWxMYWJlbCA9IGNyZWF0ZUxhYmVsKCAxLCBlbmVyZ3lQb3RlbnRpYWxTdHJpbmcsICdwb3RlbnRpYWxFbmVyZ3lMYWJlbFRleHQnICk7XHJcbiAgICBjb25zdCB0aGVybWFsTGFiZWwgPSBjcmVhdGVMYWJlbCggMiwgZW5lcmd5VGhlcm1hbFN0cmluZywgJ3RoZXJtYWxFbmVyZ3lMYWJlbFRleHQnICk7XHJcbiAgICBjb25zdCB0b3RhbExhYmVsID0gY3JlYXRlTGFiZWwoIDMsIGVuZXJneVRvdGFsU3RyaW5nLCAndG90YWxFbmVyZ3lMYWJlbFRleHQnICk7XHJcblxyXG4gICAgY29uc3QgY2xlYXJUaGVybWFsQnV0dG9uID0gbmV3IE1vdmVUb1RyYXNoTGVnZW5kQnV0dG9uKCB7XHJcbiAgICAgIGFycm93Q29sb3I6IEVuZXJneVNrYXRlUGFya0NvbG9yU2NoZW1lLnRoZXJtYWxFbmVyZ3ksXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NsZWFyVGhlcm1hbEJ1dHRvbicgKSxcclxuICAgICAgbGlzdGVuZXI6IGNsZWFyVGhlcm1hbCxcclxuICAgICAgY2VudGVyWDogdGhlcm1hbExhYmVsLmNlbnRlclgsXHJcbiAgICAgIHk6IHRoZXJtYWxMYWJlbC5ib3R0b20gKyAxNSxcclxuICAgICAgc2NhbGU6IDAuOFxyXG4gICAgfSApO1xyXG4gICAgc2thdGVyLmFsbG93Q2xlYXJpbmdUaGVybWFsRW5lcmd5UHJvcGVydHkubGluayggYWxsb3dDbGVhcmluZ1RoZXJtYWxFbmVyZ3kgPT4ge1xyXG4gICAgICBjbGVhclRoZXJtYWxCdXR0b24uZW5hYmxlZCA9IGFsbG93Q2xlYXJpbmdUaGVybWFsRW5lcmd5O1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIERvbid0IGxldCB0aGUgTW92ZVRvVHJhc2hMZWdlbmRCdXR0b24gcGFydGljaXBhdGUgaW4gdGhlIGxheW91dCBzaW5jZSBpdCBpcyB0b28gYmlnIHZlcnRpY2FsbHkuICBKdXN0IHVzZSBhIHN0cnV0IHRvXHJcbiAgICAvLyBnZXQgdGhlIHdpZHRoIHJpZ2h0LCB0aGVuIGFkZCB0aGUgdW5kbyBidXR0b24gbGF0ZXJcclxuICAgIGNvbnN0IGNsZWFyVGhlcm1hbEJ1dHRvblN0cnV0ID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgY2xlYXJUaGVybWFsQnV0dG9uLndpZHRoLCAxLCB7fSApO1xyXG5cclxuICAgIGNvbnN0IHNwYWNpbmcgPSA1O1xyXG4gICAgY29uc3QgY2hpbGRyZW4gPSBbXHJcbiAgICAgIG5ldyBIQm94KCB7IHNwYWNpbmc6IHNwYWNpbmcsIGNoaWxkcmVuOiBbIGtpbmV0aWNCYXIsIGtpbmV0aWNMYWJlbCBdIH0gKSxcclxuICAgICAgbmV3IEhCb3goIHsgc3BhY2luZzogc3BhY2luZywgY2hpbGRyZW46IFsgcG90ZW50aWFsQmFyLCBwb3RlbnRpYWxMYWJlbCBdIH0gKSxcclxuICAgICAgbmV3IEhCb3goIHtcclxuICAgICAgICBzcGFjaW5nOiBzcGFjaW5nLFxyXG4gICAgICAgIGNoaWxkcmVuOiBbIHRoZXJtYWxCYXIsIHRoZXJtYWxMYWJlbCwgbmV3IEhTdHJ1dCggMSApLCBjbGVhclRoZXJtYWxCdXR0b25TdHJ1dCwgbmV3IEhTdHJ1dCggMyApIF1cclxuICAgICAgfSApXHJcbiAgICBdO1xyXG5cclxuICAgIGlmICggb3B0aW9ucy5pbmNsdWRlVG90YWwgKSB7XHJcbiAgICAgIGNoaWxkcmVuLnB1c2goIG5ldyBIQm94KCB7IHNwYWNpbmc6IDQsIGNoaWxkcmVuOiBbIHRvdGFsQmFyLCB0b3RhbExhYmVsIF0gfSApICk7XHJcbiAgICB9XHJcblxyXG4gICAgY2hpbGRyZW4ucHVzaCggbmV3IFZTdHJ1dCggMS4yICkgKTtcclxuXHJcbiAgICBjb25zdCBjb250ZW50Tm9kZSA9IG5ldyBWQm94KCB7IHNwYWNpbmc6IDYsIGFsaWduOiAnbGVmdCcsIGNoaWxkcmVuOiBjaGlsZHJlbiB9ICk7XHJcblxyXG4gICAgY29uc3QgdGl0bGVUZXh0ID0gbmV3IFRleHQoIGVuZXJneUVuZXJneVN0cmluZywge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd0aXRsZVRleHQnICksXHJcbiAgICAgIGZpbGw6ICdibGFjaycsXHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTcgKSxcclxuICAgICAgcGlja2FibGU6IGZhbHNlLFxyXG4gICAgICBtYXhXaWR0aDogOTMgLy8gc2VsZWN0ZWQgYnkgY2hvb3NpbmcgdGhlIGxlbmd0aCBvZiB3aWRlc3QgRW5nbGlzaCBzdHJpbmcgaW4gP3N0cmluZ1Rlc3Q9ZG91YmxlXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBjb250ZW50V2l0aFRpdGxlID0gbmV3IFZCb3goIHtcclxuICAgICAgc3BhY2luZzogNi4xNCwgYWxpZ246ICdjZW50ZXInLCBjaGlsZHJlbjogW1xyXG4gICAgICAgIHRpdGxlVGV4dCxcclxuICAgICAgICBjb250ZW50Tm9kZVxyXG4gICAgICBdXHJcbiAgICB9ICk7XHJcblxyXG4gICAgc3VwZXIoIGNvbnRlbnRXaXRoVGl0bGUsIG1lcmdlKCB7XHJcbiAgICAgIHg6IDQsXHJcbiAgICAgIHk6IDQsXHJcbiAgICAgIHhNYXJnaW46IDcsXHJcbiAgICAgIHlNYXJnaW46IDYsXHJcbiAgICAgIHJlc2l6ZTogZmFsc2UsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtXHJcbiAgICB9LCBFbmVyZ3lTa2F0ZVBhcmtDb25zdGFudHMuR1JBUEhfUEFORUxfT1BUT05TICkgKTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBjbGVhclRoZXJtYWxCdXR0b24gKTtcclxuICAgIGNvbnN0IHN0cnV0R2xvYmFsID0gY2xlYXJUaGVybWFsQnV0dG9uU3RydXQucGFyZW50VG9HbG9iYWxQb2ludCggY2xlYXJUaGVybWFsQnV0dG9uU3RydXQuY2VudGVyICk7XHJcbiAgICBjb25zdCBidXR0b25Mb2NhbCA9IGNsZWFyVGhlcm1hbEJ1dHRvbi5nbG9iYWxUb1BhcmVudFBvaW50KCBzdHJ1dEdsb2JhbCApO1xyXG4gICAgY2xlYXJUaGVybWFsQnV0dG9uLmNlbnRlciA9IGJ1dHRvbkxvY2FsO1xyXG5cclxuICAgIHBpZUNoYXJ0VmlzaWJsZVByb3BlcnR5LmxpbmtBdHRyaWJ1dGUoIHRoaXMsICd2aXNpYmxlJyApO1xyXG5cclxuICAgIC8vIHRoaXMgYnV0dG9uIGlzIHNtYWxsIGFuZCB1c2FiaWxpdHkgaXMgaW1wcm92ZWQgYnkgbGFyZ2VyIHRvdWNoIGFyZWFzXHJcbiAgICBjbGVhclRoZXJtYWxCdXR0b24udG91Y2hBcmVhID0gY2xlYXJUaGVybWFsQnV0dG9uLmxvY2FsQm91bmRzLmRpbGF0ZWQoIDEwICk7XHJcbiAgfVxyXG59XHJcblxyXG5lbmVyZ3lTa2F0ZVBhcmsucmVnaXN0ZXIoICdQaWVDaGFydExlZ2VuZCcsIFBpZUNoYXJ0TGVnZW5kICk7XHJcbmV4cG9ydCBkZWZhdWx0IFBpZUNoYXJ0TGVnZW5kOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxLQUFLLE1BQU0sbUNBQW1DO0FBQ3JELE9BQU9DLHVCQUF1QixNQUFNLGdFQUFnRTtBQUNwRyxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLElBQUksRUFBRUMsTUFBTSxFQUFFQyxTQUFTLEVBQUVDLElBQUksRUFBRUMsSUFBSSxFQUFFQyxNQUFNLFFBQVEsbUNBQW1DO0FBQy9GLE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsZUFBZSxNQUFNLDBCQUEwQjtBQUN0RCxPQUFPQyxzQkFBc0IsTUFBTSxpQ0FBaUM7QUFDcEUsT0FBT0Msd0JBQXdCLE1BQU0sZ0NBQWdDO0FBQ3JFLE9BQU9DLDBCQUEwQixNQUFNLGlDQUFpQztBQUV4RSxNQUFNQyxrQkFBa0IsR0FBR0gsc0JBQXNCLENBQUNJLFFBQVEsQ0FBQ0Msb0JBQW9CO0FBQy9FLE1BQU1DLG1CQUFtQixHQUFHTixzQkFBc0IsQ0FBQ0ksUUFB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