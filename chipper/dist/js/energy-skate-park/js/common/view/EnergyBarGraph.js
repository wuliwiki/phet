// Copyright 2019-2022, University of Colorado Boulder

/**
 * Bar graph that displays the distribution of energy for this simulation.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Property from '../../../../axon/js/Property.js';
import Range from '../../../../dot/js/Range.js';
import BarChartNode from '../../../../griddle/js/BarChartNode.js';
import merge from '../../../../phet-core/js/merge.js';
import MoveToTrashLegendButton from '../../../../scenery-phet/js/buttons/MoveToTrashLegendButton.js';
import ZoomButton from '../../../../scenery-phet/js/buttons/ZoomButton.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { HBox, Node, Rectangle, Text, VBox } from '../../../../scenery/js/imports.js';
import ColorConstants from '../../../../sun/js/ColorConstants.js';
import energySkatePark from '../../energySkatePark.js';
import EnergySkateParkStrings from '../../EnergySkateParkStrings.js';
import EnergySkateParkConstants from '../EnergySkateParkConstants.js';
import EnergySkateParkColorScheme from './EnergySkateParkColorScheme.js';
const energyEnergyString = EnergySkateParkStrings.energies.energyStringProperty;
const energyKineticString = EnergySkateParkStrings.energies.kineticStringProperty;
const energyPotentialString = EnergySkateParkStrings.energies.potentialStringProperty;
const energyThermalString = EnergySkateParkStrings.energies.thermalStringProperty;
const energyTotalString = EnergySkateParkStrings.energies.totalStringProperty;

// constants
const ZOOM_BUTTON_TOUCH_DILATION = 5;
class EnergyBarGraph extends Node {
  /**
   * @param {Skater} skater
   * @param {NumberProperty} barGraphScaleProperty
   * @param {BooleanProperty} barGraphsVisibleProperty
   * @param {Tandem} tandem
   * @param {Object} [options]
   */
  constructor(skater, barGraphScaleProperty, barGraphVisibleProperty, tandem, options) {
    options = merge({
      // include buttons that increase/decrease the scale of the graph?
      showBarGraphZoomButtons: true,
      // @param {Range} - The range for the visible portion of the graph, in joules - note this is somewhat arbitrary
      // because the bars will have difference scales, but size should be about 1.5 times larger than the energy would
      // extend bars at default scale. A negative min value will allow some space to represent negative energies.
      graphRange: new Range(-122.8, 325)
    }, options);
    super(options);

    // the range for the visible portion of the graph, in joules - note this is somewhat arbitrary because
    // the bars will have difference scales, but size should be about 1.5 times larger than the energy would
    // extend bars at default scale
    const graphRangeProperty = new Property(options.graphRange, {
      valueType: Range
    });

    // button to remove thermal energy will be below the "thermal" energy label
    const clearThermalButton = new MoveToTrashLegendButton({
      arrowColor: EnergySkateParkColorScheme.thermalEnergy,
      tandem: tandem.createTandem('clearThermalButton'),
      listener: skater.clearThermal.bind(skater),
      scale: 0.86
    });

    // For kinetic and potential, they must go to zero at the endpoints to reach learning goals like
    //   "The kinetic energy is zero at the top of the trajectory (turning point)
    const createHideSmallValuesProperty = energyProperty => {
      return new DerivedProperty([energyProperty], energy => {
        // determine whether or not to hide the bar if below threshold in view coordinates so it works
        // with the scaleProperty
        const height = energy * barGraphScaleProperty.get();
        const absHeight = Math.abs(height);

        // small enough so that energy is invisible at end points of track motion, but still visible
        // in other cases at slow movement, see https://github.com/phetsims/energy-skate-park/issues/160
        if (absHeight < 0.1) {
          return 0;
        }
        return energy;
      });
    };

    // For thermal and total energy, make sure they are big enough to be visible, see #307
    const createShowSmallValuesProperty = energyProperty => {
      return new DerivedProperty([energyProperty], energy => {
        let resultantEnergy = energy;
        const scale = barGraphScaleProperty.get();

        // determine whether or not to increase bar size if within threshold in view coordinates so it works
        // with the scaleProperty
        const height = energy * scale;
        const absHeight = Math.abs(height);
        if (absHeight < 1 && absHeight > 1E-6) {
          const valueSign = energy < 0 ? -1 : 1;
          resultantEnergy = valueSign / scale; // the energy required to produce a bar with height of 1 view coordinate
        }

        return resultantEnergy;
      });
    };
    const kineticEntry = {
      property: createHideSmallValuesProperty(skater.kineticEnergyProperty),
      color: EnergySkateParkColorScheme.kineticEnergy
    };
    const potentialEntry = {
      property: createHideSmallValuesProperty(skater.potentialEnergyProperty),
      color: EnergySkateParkColorScheme.potentialEnergy
    };
    const thermalEntry = {
      property: createShowSmallValuesProperty(skater.thermalEnergyProperty),
      color: EnergySkateParkColorScheme.thermalEnergy
    };
    const totalEntry = {
      property: createShowSmallValuesProperty(skater.totalEnergyProperty),
      color: EnergySkateParkColorScheme.totalEnergy
    };
    this.barChartNode = new BarChartNode([{
      entries: [kineticEntry],
      labelString: energyKineticString
    }, {
      entries: [potentialEntry],
      labelString: energyPotentialString
    }, {
      entries: [thermalEntry],
      labelString: energyThermalString,
      labelNode: clearThermalButton
    }, {
      entries: [totalEntry],
      labelString: energyTotalString
    }], graphRangeProperty, {
      barLabelOptions: {
        maxWidth: 61.4,
        // i18n, by inspection
        font: new PhetFont(14.5)
      },
      barOptions: {
        scaleProperty: barGraphScaleProperty,
        barWidth: 18.5
      },
      barSpacing: 15,
      labelBackgroundColor: EnergySkateParkColorScheme.transparentPanelFill
    });

    // main content for the containing panel, assembly depends on whether zoom buttons are required
    let content = null;
    if (options.showBarGraphZoomButtons) {
      const zoomButtonOptions = {
        baseColor: ColorConstants.LIGHT_BLUE,
        magnifyingGlassOptions: {
          glassRadius: 6
        },
        xMargin: 7,
        yMargin: 5,
        // these buttons are quite small
        touchAreaXDilation: ZOOM_BUTTON_TOUCH_DILATION,
        touchAreaYDilation: ZOOM_BUTTON_TOUCH_DILATION
      };
      const zoomOutButton = new ZoomButton(merge({
        in: false,
        listener: () => {
          barGraphScaleProperty.set(Math.max(barGraphScaleProperty.get() - EnergySkateParkConstants.ZOOM_FACTOR_DELTA, EnergySkateParkConstants.MIN_ZOOM_FACTOR));
        },
        touchAreaXShift: -ZOOM_BUTTON_TOUCH_DILATION,
        tandem: tandem.createTandem('zoomOutButton')
      }, zoomButtonOptions));
      const zoomInButton = new ZoomButton(merge({
        in: true,
        listener: () => {
          barGraphScaleProperty.set(Math.min(barGraphScaleProperty.get() + EnergySkateParkConstants.ZOOM_FACTOR_DELTA, EnergySkateParkConstants.MAX_ZOOM_FACTOR));
        },
        touchAreaXShift: ZOOM_BUTTON_TOUCH_DILATION,
        tandem: tandem.createTandem('zoomInButton')
      }, zoomButtonOptions));
      const zoomButtons = new HBox({
        children: [zoomOutButton, zoomInButton],
        spacing: 5
      });
      content = new VBox({
        children: [this.barChartNode, zoomButtons],
        spacing: 5,
        align: 'left'
      });
      barGraphScaleProperty.link(scale => {
        zoomInButton.enabled = scale < EnergySkateParkConstants.MAX_ZOOM_FACTOR;
        zoomOutButton.enabled = scale > EnergySkateParkConstants.MIN_ZOOM_FACTOR;
      });
      barGraphScaleProperty.link(() => {
        this.updateWhenVisible(barGraphVisibleProperty.value);
      });
    } else {
      content = this.barChartNode;
    }
    this.addChild(content);

    // attach listeners - bar chart exists for life of sim, no need to dispose
    skater.energyChangedEmitter.addListener(() => {
      this.updateWhenVisible(barGraphVisibleProperty.value);
    });
    barGraphVisibleProperty.link(this.updateWhenVisible.bind(this));
    skater.allowClearingThermalEnergyProperty.link(allowClearingThermalEnergy => {
      clearThermalButton.enabled = allowClearingThermalEnergy;
    });

    // this button is small and usability is improved by larger touch areas
    clearThermalButton.touchArea = clearThermalButton.localBounds.dilated(10);
  }

  /**
   * If model indicates that graph is visible, redraw the graph.
   *
   * @private
   * @param {boolean} visible
   */
  updateWhenVisible(visible) {
    if (visible) {
      this.barChartNode.update();
    }
  }

  /**
   * Create the label for the bar graph, which can be added in various places depending on layout of the graph.
   * @public
   *
   * @returns {Text}
   */
  static createLabel() {
    return new Text(energyEnergyString, {
      font: new PhetFont({
        size: 17,
        weight: 'bold'
      }),
      maxWidth: 75 // i18n, by inspection
    });
  }

  /**
   * Create an icon of the bar graph, to be used in visibility or other controls.
   * @public
   *
   * @param {Tandem} tandem
   * @param {Object} [options]
   * @returns {Node}
   */
  static createBarGraphIcon(tandem, options) {
    options = merge({
      scale: 1
    }, options);
    return new Node({
      tandem: tandem,
      children: [new Rectangle(0, 0, 20, 20, {
        fill: 'white',
        stroke: 'black',
        lineWidth: 0.5
      }), new Rectangle(3, 14, 5, 6, {
        fill: EnergySkateParkColorScheme.kineticEnergy,
        stroke: 'black',
        lineWidth: 0.5
      }), new Rectangle(11, 8, 5, 12, {
        fill: EnergySkateParkColorScheme.potentialEnergy,
        stroke: 'black',
        lineWidth: 0.5
      })],
      scale: options.scale
    });
  }
}
energySkatePark.register('EnergyBarGraph', EnergyBarGraph);
export default EnergyBarGraph;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJQcm9wZXJ0eSIsIlJhbmdlIiwiQmFyQ2hhcnROb2RlIiwibWVyZ2UiLCJNb3ZlVG9UcmFzaExlZ2VuZEJ1dHRvbiIsIlpvb21CdXR0b24iLCJQaGV0Rm9udCIsIkhCb3giLCJOb2RlIiwiUmVjdGFuZ2xlIiwiVGV4dCIsIlZCb3giLCJDb2xvckNvbnN0YW50cyIsImVuZXJneVNrYXRlUGFyayIsIkVuZXJneVNrYXRlUGFya1N0cmluZ3MiLCJFbmVyZ3lTa2F0ZVBhcmtDb25zdGFudHMiLCJFbmVyZ3lTa2F0ZVBhcmtDb2xvclNjaGVtZSIsImVuZXJneUVuZXJneVN0cmluZyIsImVuZXJnaWVzIiwiZW5lcmd5U3RyaW5nUHJvcGVydHkiLCJlbmVyZ3lLaW5ldGljU3RyaW5nIiwia2luZXRpY1N0cmluZ1Byb3BlcnR5IiwiZW5lcmd5UG90ZW50aWFsU3RyaW5nIiwicG90ZW50aWFsU3RyaW5nUHJvcGVydHkiLCJlbmVyZ3lUaGVybWFsU3RyaW5nIiwidGhlcm1hbFN0cmluZ1Byb3BlcnR5IiwiZW5lcmd5VG90YWxTdHJpbmciLCJ0b3RhbFN0cmluZ1Byb3BlcnR5IiwiWk9PTV9CVVRUT05fVE9VQ0hfRElMQVRJT04iLCJFbmVyZ3lCYXJHcmFwaCIsImNvbnN0cnVjdG9yIiwic2thdGVyIiwiYmFyR3JhcGhTY2FsZVByb3BlcnR5IiwiYmFyR3JhcGhWaXNpYmxlUHJvcGVydHkiLCJ0YW5kZW0iLCJvcHRpb25zIiwic2hvd0JhckdyYXBoWm9vbUJ1dHRvbnMiLCJncmFwaFJhbmdlIiwiZ3JhcGhSYW5nZVByb3BlcnR5IiwidmFsdWVUeXBlIiwiY2xlYXJUaGVybWFsQnV0dG9uIiwiYXJyb3dDb2xvciIsInRoZXJtYWxFbmVyZ3kiLCJjcmVhdGVUYW5kZW0iLCJsaXN0ZW5lciIsImNsZWFyVGhlcm1hbCIsImJpbmQiLCJzY2FsZSIsImNyZWF0ZUhpZGVTbWFsbFZhbHVlc1Byb3BlcnR5IiwiZW5lcmd5UHJvcGVydHkiLCJlbmVyZ3kiLCJoZWlnaHQiLCJnZXQiLCJhYnNIZWlnaHQiLCJNYXRoIiwiYWJzIiwiY3JlYXRlU2hvd1NtYWxsVmFsdWVzUHJvcGVydHkiLCJyZXN1bHRhbnRFbmVyZ3kiLCJ2YWx1ZVNpZ24iLCJraW5ldGljRW50cnkiLCJwcm9wZXJ0eSIsImtpbmV0aWNFbmVyZ3lQcm9wZXJ0eSIsImNvbG9yIiwia2luZXRpY0VuZXJneSIsInBvdGVudGlhbEVudHJ5IiwicG90ZW50aWFsRW5lcmd5UHJvcGVydHkiLCJwb3RlbnRpYWxFbmVyZ3kiLCJ0aGVybWFsRW50cnkiLCJ0aGVybWFsRW5lcmd5UHJvcGVydHkiLCJ0b3RhbEVudHJ5IiwidG90YWxFbmVyZ3lQcm9wZXJ0eSIsInRvdGFsRW5lcmd5IiwiYmFyQ2hhcnROb2RlIiwiZW50cmllcyIsImxhYmVsU3RyaW5nIiwibGFiZWxOb2RlIiwiYmFyTGFiZWxPcHRpb25zIiwibWF4V2lkdGgiLCJmb250IiwiYmFyT3B0aW9ucyIsInNjYWxlUHJvcGVydHkiLCJiYXJXaWR0aCIsImJhclNwYWNpbmciLCJsYWJlbEJhY2tncm91bmRDb2xvciIsInRyYW5zcGFyZW50UGFuZWxGaWxsIiwiY29udGVudCIsInpvb21CdXR0b25PcHRpb25zIiwiYmFzZUNvbG9yIiwiTElHSFRfQkxVRSIsIm1hZ25pZnlpbmdHbGFzc09wdGlvbnMiLCJnbGFzc1JhZGl1cyIsInhNYXJnaW4iLCJ5TWFyZ2luIiwidG91Y2hBcmVhWERpbGF0aW9uIiwidG91Y2hBcmVhWURpbGF0aW9uIiwiem9vbU91dEJ1dHRvbiIsImluIiwic2V0IiwibWF4IiwiWk9PTV9GQUNUT1JfREVMVEEiLCJNSU5fWk9PTV9GQUNUT1IiLCJ0b3VjaEFyZWFYU2hpZnQiLCJ6b29tSW5CdXR0b24iLCJtaW4iLCJNQVhfWk9PTV9GQUNUT1IiLCJ6b29tQnV0dG9ucyIsImNoaWxkcmVuIiwic3BhY2luZyIsImFsaWduIiwibGluayIsImVuYWJsZWQiLCJ1cGRhdGVXaGVuVmlzaWJsZSIsInZhbHVlIiwiYWRkQ2hpbGQiLCJlbmVyZ3lDaGFuZ2VkRW1pdHRlciIsImFkZExpc3RlbmVyIiwiYWxsb3dDbGVhcmluZ1RoZXJtYWxFbmVyZ3lQcm9wZXJ0eSIsImFsbG93Q2xlYXJpbmdUaGVybWFsRW5lcmd5IiwidG91Y2hBcmVhIiwibG9jYWxCb3VuZHMiLCJkaWxhdGVkIiwidmlzaWJsZSIsInVwZGF0ZSIsImNyZWF0ZUxhYmVsIiwic2l6ZSIsIndlaWdodCIsImNyZWF0ZUJhckdyYXBoSWNvbiIsImZpbGwiLCJzdHJva2UiLCJsaW5lV2lkdGgiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkVuZXJneUJhckdyYXBoLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEJhciBncmFwaCB0aGF0IGRpc3BsYXlzIHRoZSBkaXN0cmlidXRpb24gb2YgZW5lcmd5IGZvciB0aGlzIHNpbXVsYXRpb24uXHJcbiAqXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxyXG4gKi9cclxuXHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgQmFyQ2hhcnROb2RlIGZyb20gJy4uLy4uLy4uLy4uL2dyaWRkbGUvanMvQmFyQ2hhcnROb2RlLmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBNb3ZlVG9UcmFzaExlZ2VuZEJ1dHRvbiBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvYnV0dG9ucy9Nb3ZlVG9UcmFzaExlZ2VuZEJ1dHRvbi5qcyc7XHJcbmltcG9ydCBab29tQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL1pvb21CdXR0b24uanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgSEJveCwgTm9kZSwgUmVjdGFuZ2xlLCBUZXh0LCBWQm94IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IENvbG9yQ29uc3RhbnRzIGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9Db2xvckNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBlbmVyZ3lTa2F0ZVBhcmsgZnJvbSAnLi4vLi4vZW5lcmd5U2thdGVQYXJrLmpzJztcclxuaW1wb3J0IEVuZXJneVNrYXRlUGFya1N0cmluZ3MgZnJvbSAnLi4vLi4vRW5lcmd5U2thdGVQYXJrU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBFbmVyZ3lTa2F0ZVBhcmtDb25zdGFudHMgZnJvbSAnLi4vRW5lcmd5U2thdGVQYXJrQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEVuZXJneVNrYXRlUGFya0NvbG9yU2NoZW1lIGZyb20gJy4vRW5lcmd5U2thdGVQYXJrQ29sb3JTY2hlbWUuanMnO1xyXG5cclxuY29uc3QgZW5lcmd5RW5lcmd5U3RyaW5nID0gRW5lcmd5U2thdGVQYXJrU3RyaW5ncy5lbmVyZ2llcy5lbmVyZ3lTdHJpbmdQcm9wZXJ0eTtcclxuY29uc3QgZW5lcmd5S2luZXRpY1N0cmluZyA9IEVuZXJneVNrYXRlUGFya1N0cmluZ3MuZW5lcmdpZXMua2luZXRpY1N0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBlbmVyZ3lQb3RlbnRpYWxTdHJpbmcgPSBFbmVyZ3lTa2F0ZVBhcmtTdHJpbmdzLmVuZXJnaWVzLnBvdGVudGlhbFN0cmluZ1Byb3BlcnR5O1xyXG5jb25zdCBlbmVyZ3lUaGVybWFsU3RyaW5nID0gRW5lcmd5U2thdGVQYXJrU3RyaW5ncy5lbmVyZ2llcy50aGVybWFsU3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGVuZXJneVRvdGFsU3RyaW5nID0gRW5lcmd5U2thdGVQYXJrU3RyaW5ncy5lbmVyZ2llcy50b3RhbFN0cmluZ1Byb3BlcnR5O1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IFpPT01fQlVUVE9OX1RPVUNIX0RJTEFUSU9OID0gNTtcclxuXHJcbmNsYXNzIEVuZXJneUJhckdyYXBoIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7U2thdGVyfSBza2F0ZXJcclxuICAgKiBAcGFyYW0ge051bWJlclByb3BlcnR5fSBiYXJHcmFwaFNjYWxlUHJvcGVydHlcclxuICAgKiBAcGFyYW0ge0Jvb2xlYW5Qcm9wZXJ0eX0gYmFyR3JhcGhzVmlzaWJsZVByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvciggc2thdGVyLCBiYXJHcmFwaFNjYWxlUHJvcGVydHksIGJhckdyYXBoVmlzaWJsZVByb3BlcnR5LCB0YW5kZW0sIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcblxyXG4gICAgICAvLyBpbmNsdWRlIGJ1dHRvbnMgdGhhdCBpbmNyZWFzZS9kZWNyZWFzZSB0aGUgc2NhbGUgb2YgdGhlIGdyYXBoP1xyXG4gICAgICBzaG93QmFyR3JhcGhab29tQnV0dG9uczogdHJ1ZSxcclxuXHJcbiAgICAgIC8vIEBwYXJhbSB7UmFuZ2V9IC0gVGhlIHJhbmdlIGZvciB0aGUgdmlzaWJsZSBwb3J0aW9uIG9mIHRoZSBncmFwaCwgaW4gam91bGVzIC0gbm90ZSB0aGlzIGlzIHNvbWV3aGF0IGFyYml0cmFyeVxyXG4gICAgICAvLyBiZWNhdXNlIHRoZSBiYXJzIHdpbGwgaGF2ZSBkaWZmZXJlbmNlIHNjYWxlcywgYnV0IHNpemUgc2hvdWxkIGJlIGFib3V0IDEuNSB0aW1lcyBsYXJnZXIgdGhhbiB0aGUgZW5lcmd5IHdvdWxkXHJcbiAgICAgIC8vIGV4dGVuZCBiYXJzIGF0IGRlZmF1bHQgc2NhbGUuIEEgbmVnYXRpdmUgbWluIHZhbHVlIHdpbGwgYWxsb3cgc29tZSBzcGFjZSB0byByZXByZXNlbnQgbmVnYXRpdmUgZW5lcmdpZXMuXHJcbiAgICAgIGdyYXBoUmFuZ2U6IG5ldyBSYW5nZSggLTEyMi44LCAzMjUgKVxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gdGhlIHJhbmdlIGZvciB0aGUgdmlzaWJsZSBwb3J0aW9uIG9mIHRoZSBncmFwaCwgaW4gam91bGVzIC0gbm90ZSB0aGlzIGlzIHNvbWV3aGF0IGFyYml0cmFyeSBiZWNhdXNlXHJcbiAgICAvLyB0aGUgYmFycyB3aWxsIGhhdmUgZGlmZmVyZW5jZSBzY2FsZXMsIGJ1dCBzaXplIHNob3VsZCBiZSBhYm91dCAxLjUgdGltZXMgbGFyZ2VyIHRoYW4gdGhlIGVuZXJneSB3b3VsZFxyXG4gICAgLy8gZXh0ZW5kIGJhcnMgYXQgZGVmYXVsdCBzY2FsZVxyXG4gICAgY29uc3QgZ3JhcGhSYW5nZVByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBvcHRpb25zLmdyYXBoUmFuZ2UsIHtcclxuICAgICAgdmFsdWVUeXBlOiBSYW5nZVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGJ1dHRvbiB0byByZW1vdmUgdGhlcm1hbCBlbmVyZ3kgd2lsbCBiZSBiZWxvdyB0aGUgXCJ0aGVybWFsXCIgZW5lcmd5IGxhYmVsXHJcbiAgICBjb25zdCBjbGVhclRoZXJtYWxCdXR0b24gPSBuZXcgTW92ZVRvVHJhc2hMZWdlbmRCdXR0b24oIHtcclxuICAgICAgYXJyb3dDb2xvcjogRW5lcmd5U2thdGVQYXJrQ29sb3JTY2hlbWUudGhlcm1hbEVuZXJneSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnY2xlYXJUaGVybWFsQnV0dG9uJyApLFxyXG4gICAgICBsaXN0ZW5lcjogc2thdGVyLmNsZWFyVGhlcm1hbC5iaW5kKCBza2F0ZXIgKSxcclxuICAgICAgc2NhbGU6IDAuODZcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBGb3Iga2luZXRpYyBhbmQgcG90ZW50aWFsLCB0aGV5IG11c3QgZ28gdG8gemVybyBhdCB0aGUgZW5kcG9pbnRzIHRvIHJlYWNoIGxlYXJuaW5nIGdvYWxzIGxpa2VcclxuICAgIC8vICAgXCJUaGUga2luZXRpYyBlbmVyZ3kgaXMgemVybyBhdCB0aGUgdG9wIG9mIHRoZSB0cmFqZWN0b3J5ICh0dXJuaW5nIHBvaW50KVxyXG4gICAgY29uc3QgY3JlYXRlSGlkZVNtYWxsVmFsdWVzUHJvcGVydHkgPSBlbmVyZ3lQcm9wZXJ0eSA9PiB7XHJcbiAgICAgIHJldHVybiBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIGVuZXJneVByb3BlcnR5IF0sIGVuZXJneSA9PiB7XHJcblxyXG4gICAgICAgIC8vIGRldGVybWluZSB3aGV0aGVyIG9yIG5vdCB0byBoaWRlIHRoZSBiYXIgaWYgYmVsb3cgdGhyZXNob2xkIGluIHZpZXcgY29vcmRpbmF0ZXMgc28gaXQgd29ya3NcclxuICAgICAgICAvLyB3aXRoIHRoZSBzY2FsZVByb3BlcnR5XHJcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gZW5lcmd5ICogYmFyR3JhcGhTY2FsZVByb3BlcnR5LmdldCgpO1xyXG4gICAgICAgIGNvbnN0IGFic0hlaWdodCA9IE1hdGguYWJzKCBoZWlnaHQgKTtcclxuXHJcbiAgICAgICAgLy8gc21hbGwgZW5vdWdoIHNvIHRoYXQgZW5lcmd5IGlzIGludmlzaWJsZSBhdCBlbmQgcG9pbnRzIG9mIHRyYWNrIG1vdGlvbiwgYnV0IHN0aWxsIHZpc2libGVcclxuICAgICAgICAvLyBpbiBvdGhlciBjYXNlcyBhdCBzbG93IG1vdmVtZW50LCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2VuZXJneS1za2F0ZS1wYXJrL2lzc3Vlcy8xNjBcclxuICAgICAgICBpZiAoIGFic0hlaWdodCA8IDAuMSApIHtcclxuICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZW5lcmd5O1xyXG4gICAgICB9ICk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEZvciB0aGVybWFsIGFuZCB0b3RhbCBlbmVyZ3ksIG1ha2Ugc3VyZSB0aGV5IGFyZSBiaWcgZW5vdWdoIHRvIGJlIHZpc2libGUsIHNlZSAjMzA3XHJcbiAgICBjb25zdCBjcmVhdGVTaG93U21hbGxWYWx1ZXNQcm9wZXJ0eSA9IGVuZXJneVByb3BlcnR5ID0+IHtcclxuICAgICAgcmV0dXJuIG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgZW5lcmd5UHJvcGVydHkgXSwgZW5lcmd5ID0+IHtcclxuICAgICAgICBsZXQgcmVzdWx0YW50RW5lcmd5ID0gZW5lcmd5O1xyXG4gICAgICAgIGNvbnN0IHNjYWxlID0gYmFyR3JhcGhTY2FsZVByb3BlcnR5LmdldCgpO1xyXG5cclxuICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciBvciBub3QgdG8gaW5jcmVhc2UgYmFyIHNpemUgaWYgd2l0aGluIHRocmVzaG9sZCBpbiB2aWV3IGNvb3JkaW5hdGVzIHNvIGl0IHdvcmtzXHJcbiAgICAgICAgLy8gd2l0aCB0aGUgc2NhbGVQcm9wZXJ0eVxyXG4gICAgICAgIGNvbnN0IGhlaWdodCA9IGVuZXJneSAqIHNjYWxlO1xyXG4gICAgICAgIGNvbnN0IGFic0hlaWdodCA9IE1hdGguYWJzKCBoZWlnaHQgKTtcclxuICAgICAgICBpZiAoIGFic0hlaWdodCA8IDEgJiYgYWJzSGVpZ2h0ID4gMUUtNiApIHtcclxuICAgICAgICAgIGNvbnN0IHZhbHVlU2lnbiA9IGVuZXJneSA8IDAgPyAtMSA6IDE7XHJcbiAgICAgICAgICByZXN1bHRhbnRFbmVyZ3kgPSB2YWx1ZVNpZ24gLyBzY2FsZTsgLy8gdGhlIGVuZXJneSByZXF1aXJlZCB0byBwcm9kdWNlIGEgYmFyIHdpdGggaGVpZ2h0IG9mIDEgdmlldyBjb29yZGluYXRlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHRhbnRFbmVyZ3k7XHJcbiAgICAgIH0gKTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3Qga2luZXRpY0VudHJ5ID0ge1xyXG4gICAgICBwcm9wZXJ0eTogY3JlYXRlSGlkZVNtYWxsVmFsdWVzUHJvcGVydHkoIHNrYXRlci5raW5ldGljRW5lcmd5UHJvcGVydHkgKSxcclxuICAgICAgY29sb3I6IEVuZXJneVNrYXRlUGFya0NvbG9yU2NoZW1lLmtpbmV0aWNFbmVyZ3lcclxuICAgIH07XHJcbiAgICBjb25zdCBwb3RlbnRpYWxFbnRyeSA9IHtcclxuICAgICAgcHJvcGVydHk6IGNyZWF0ZUhpZGVTbWFsbFZhbHVlc1Byb3BlcnR5KCBza2F0ZXIucG90ZW50aWFsRW5lcmd5UHJvcGVydHkgKSxcclxuICAgICAgY29sb3I6IEVuZXJneVNrYXRlUGFya0NvbG9yU2NoZW1lLnBvdGVudGlhbEVuZXJneVxyXG4gICAgfTtcclxuICAgIGNvbnN0IHRoZXJtYWxFbnRyeSA9IHtcclxuICAgICAgcHJvcGVydHk6IGNyZWF0ZVNob3dTbWFsbFZhbHVlc1Byb3BlcnR5KCBza2F0ZXIudGhlcm1hbEVuZXJneVByb3BlcnR5ICksXHJcbiAgICAgIGNvbG9yOiBFbmVyZ3lTa2F0ZVBhcmtDb2xvclNjaGVtZS50aGVybWFsRW5lcmd5XHJcbiAgICB9O1xyXG4gICAgY29uc3QgdG90YWxFbnRyeSA9IHtcclxuICAgICAgcHJvcGVydHk6IGNyZWF0ZVNob3dTbWFsbFZhbHVlc1Byb3BlcnR5KCBza2F0ZXIudG90YWxFbmVyZ3lQcm9wZXJ0eSApLFxyXG4gICAgICBjb2xvcjogRW5lcmd5U2thdGVQYXJrQ29sb3JTY2hlbWUudG90YWxFbmVyZ3lcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5iYXJDaGFydE5vZGUgPSBuZXcgQmFyQ2hhcnROb2RlKCBbXHJcbiAgICAgIHsgZW50cmllczogWyBraW5ldGljRW50cnkgXSwgbGFiZWxTdHJpbmc6IGVuZXJneUtpbmV0aWNTdHJpbmcgfSxcclxuICAgICAgeyBlbnRyaWVzOiBbIHBvdGVudGlhbEVudHJ5IF0sIGxhYmVsU3RyaW5nOiBlbmVyZ3lQb3RlbnRpYWxTdHJpbmcgfSxcclxuICAgICAgeyBlbnRyaWVzOiBbIHRoZXJtYWxFbnRyeSBdLCBsYWJlbFN0cmluZzogZW5lcmd5VGhlcm1hbFN0cmluZywgbGFiZWxOb2RlOiBjbGVhclRoZXJtYWxCdXR0b24gfSxcclxuICAgICAgeyBlbnRyaWVzOiBbIHRvdGFsRW50cnkgXSwgbGFiZWxTdHJpbmc6IGVuZXJneVRvdGFsU3RyaW5nIH1cclxuICAgIF0sIGdyYXBoUmFuZ2VQcm9wZXJ0eSwge1xyXG4gICAgICBiYXJMYWJlbE9wdGlvbnM6IHtcclxuICAgICAgICBtYXhXaWR0aDogNjEuNCwgLy8gaTE4biwgYnkgaW5zcGVjdGlvblxyXG4gICAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTQuNSApXHJcbiAgICAgIH0sXHJcbiAgICAgIGJhck9wdGlvbnM6IHtcclxuICAgICAgICBzY2FsZVByb3BlcnR5OiBiYXJHcmFwaFNjYWxlUHJvcGVydHksXHJcbiAgICAgICAgYmFyV2lkdGg6IDE4LjVcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGJhclNwYWNpbmc6IDE1LFxyXG5cclxuICAgICAgbGFiZWxCYWNrZ3JvdW5kQ29sb3I6IEVuZXJneVNrYXRlUGFya0NvbG9yU2NoZW1lLnRyYW5zcGFyZW50UGFuZWxGaWxsXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gbWFpbiBjb250ZW50IGZvciB0aGUgY29udGFpbmluZyBwYW5lbCwgYXNzZW1ibHkgZGVwZW5kcyBvbiB3aGV0aGVyIHpvb20gYnV0dG9ucyBhcmUgcmVxdWlyZWRcclxuICAgIGxldCBjb250ZW50ID0gbnVsbDtcclxuICAgIGlmICggb3B0aW9ucy5zaG93QmFyR3JhcGhab29tQnV0dG9ucyApIHtcclxuXHJcbiAgICAgIGNvbnN0IHpvb21CdXR0b25PcHRpb25zID0ge1xyXG4gICAgICAgIGJhc2VDb2xvcjogQ29sb3JDb25zdGFudHMuTElHSFRfQkxVRSxcclxuICAgICAgICBtYWduaWZ5aW5nR2xhc3NPcHRpb25zOiB7XHJcbiAgICAgICAgICBnbGFzc1JhZGl1czogNlxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHhNYXJnaW46IDcsXHJcbiAgICAgICAgeU1hcmdpbjogNSxcclxuXHJcbiAgICAgICAgLy8gdGhlc2UgYnV0dG9ucyBhcmUgcXVpdGUgc21hbGxcclxuICAgICAgICB0b3VjaEFyZWFYRGlsYXRpb246IFpPT01fQlVUVE9OX1RPVUNIX0RJTEFUSU9OLFxyXG4gICAgICAgIHRvdWNoQXJlYVlEaWxhdGlvbjogWk9PTV9CVVRUT05fVE9VQ0hfRElMQVRJT05cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IHpvb21PdXRCdXR0b24gPSBuZXcgWm9vbUJ1dHRvbiggbWVyZ2UoIHtcclxuICAgICAgICBpbjogZmFsc2UsXHJcbiAgICAgICAgbGlzdGVuZXI6ICgpID0+IHtcclxuICAgICAgICAgIGJhckdyYXBoU2NhbGVQcm9wZXJ0eS5zZXQoIE1hdGgubWF4KCBiYXJHcmFwaFNjYWxlUHJvcGVydHkuZ2V0KCkgLSBFbmVyZ3lTa2F0ZVBhcmtDb25zdGFudHMuWk9PTV9GQUNUT1JfREVMVEEsIEVuZXJneVNrYXRlUGFya0NvbnN0YW50cy5NSU5fWk9PTV9GQUNUT1IgKSApO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdG91Y2hBcmVhWFNoaWZ0OiAtWk9PTV9CVVRUT05fVE9VQ0hfRElMQVRJT04sXHJcbiAgICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnem9vbU91dEJ1dHRvbicgKVxyXG4gICAgICB9LCB6b29tQnV0dG9uT3B0aW9ucyApICk7XHJcbiAgICAgIGNvbnN0IHpvb21JbkJ1dHRvbiA9IG5ldyBab29tQnV0dG9uKCBtZXJnZSgge1xyXG4gICAgICAgIGluOiB0cnVlLFxyXG4gICAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgICBiYXJHcmFwaFNjYWxlUHJvcGVydHkuc2V0KCBNYXRoLm1pbiggYmFyR3JhcGhTY2FsZVByb3BlcnR5LmdldCgpICsgRW5lcmd5U2thdGVQYXJrQ29uc3RhbnRzLlpPT01fRkFDVE9SX0RFTFRBLCBFbmVyZ3lTa2F0ZVBhcmtDb25zdGFudHMuTUFYX1pPT01fRkFDVE9SICkgKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRvdWNoQXJlYVhTaGlmdDogWk9PTV9CVVRUT05fVE9VQ0hfRElMQVRJT04sXHJcbiAgICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnem9vbUluQnV0dG9uJyApXHJcbiAgICAgIH0sIHpvb21CdXR0b25PcHRpb25zICkgKTtcclxuXHJcbiAgICAgIGNvbnN0IHpvb21CdXR0b25zID0gbmV3IEhCb3goIHtcclxuICAgICAgICBjaGlsZHJlbjogWyB6b29tT3V0QnV0dG9uLCB6b29tSW5CdXR0b24gXSxcclxuICAgICAgICBzcGFjaW5nOiA1XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIGNvbnRlbnQgPSBuZXcgVkJveCgge1xyXG4gICAgICAgIGNoaWxkcmVuOiBbIHRoaXMuYmFyQ2hhcnROb2RlLCB6b29tQnV0dG9ucyBdLFxyXG4gICAgICAgIHNwYWNpbmc6IDUsXHJcbiAgICAgICAgYWxpZ246ICdsZWZ0J1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICBiYXJHcmFwaFNjYWxlUHJvcGVydHkubGluayggc2NhbGUgPT4ge1xyXG4gICAgICAgIHpvb21JbkJ1dHRvbi5lbmFibGVkID0gc2NhbGUgPCBFbmVyZ3lTa2F0ZVBhcmtDb25zdGFudHMuTUFYX1pPT01fRkFDVE9SO1xyXG4gICAgICAgIHpvb21PdXRCdXR0b24uZW5hYmxlZCA9IHNjYWxlID4gRW5lcmd5U2thdGVQYXJrQ29uc3RhbnRzLk1JTl9aT09NX0ZBQ1RPUjtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgYmFyR3JhcGhTY2FsZVByb3BlcnR5LmxpbmsoICgpID0+IHsgdGhpcy51cGRhdGVXaGVuVmlzaWJsZSggYmFyR3JhcGhWaXNpYmxlUHJvcGVydHkudmFsdWUgKTsgfSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNvbnRlbnQgPSB0aGlzLmJhckNoYXJ0Tm9kZTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBjb250ZW50ICk7XHJcblxyXG4gICAgLy8gYXR0YWNoIGxpc3RlbmVycyAtIGJhciBjaGFydCBleGlzdHMgZm9yIGxpZmUgb2Ygc2ltLCBubyBuZWVkIHRvIGRpc3Bvc2VcclxuICAgIHNrYXRlci5lbmVyZ3lDaGFuZ2VkRW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4geyB0aGlzLnVwZGF0ZVdoZW5WaXNpYmxlKCBiYXJHcmFwaFZpc2libGVQcm9wZXJ0eS52YWx1ZSApOyB9ICk7XHJcbiAgICBiYXJHcmFwaFZpc2libGVQcm9wZXJ0eS5saW5rKCB0aGlzLnVwZGF0ZVdoZW5WaXNpYmxlLmJpbmQoIHRoaXMgKSApO1xyXG5cclxuICAgIHNrYXRlci5hbGxvd0NsZWFyaW5nVGhlcm1hbEVuZXJneVByb3BlcnR5LmxpbmsoIGFsbG93Q2xlYXJpbmdUaGVybWFsRW5lcmd5ID0+IHtcclxuICAgICAgY2xlYXJUaGVybWFsQnV0dG9uLmVuYWJsZWQgPSBhbGxvd0NsZWFyaW5nVGhlcm1hbEVuZXJneTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB0aGlzIGJ1dHRvbiBpcyBzbWFsbCBhbmQgdXNhYmlsaXR5IGlzIGltcHJvdmVkIGJ5IGxhcmdlciB0b3VjaCBhcmVhc1xyXG4gICAgY2xlYXJUaGVybWFsQnV0dG9uLnRvdWNoQXJlYSA9IGNsZWFyVGhlcm1hbEJ1dHRvbi5sb2NhbEJvdW5kcy5kaWxhdGVkKCAxMCApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSWYgbW9kZWwgaW5kaWNhdGVzIHRoYXQgZ3JhcGggaXMgdmlzaWJsZSwgcmVkcmF3IHRoZSBncmFwaC5cclxuICAgKlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHBhcmFtIHtib29sZWFufSB2aXNpYmxlXHJcbiAgICovXHJcbiAgdXBkYXRlV2hlblZpc2libGUoIHZpc2libGUgKSB7XHJcbiAgICBpZiAoIHZpc2libGUgKSB7XHJcbiAgICAgIHRoaXMuYmFyQ2hhcnROb2RlLnVwZGF0ZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIHRoZSBsYWJlbCBmb3IgdGhlIGJhciBncmFwaCwgd2hpY2ggY2FuIGJlIGFkZGVkIGluIHZhcmlvdXMgcGxhY2VzIGRlcGVuZGluZyBvbiBsYXlvdXQgb2YgdGhlIGdyYXBoLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEByZXR1cm5zIHtUZXh0fVxyXG4gICAqL1xyXG4gIHN0YXRpYyBjcmVhdGVMYWJlbCgpIHtcclxuICAgIHJldHVybiBuZXcgVGV4dCggZW5lcmd5RW5lcmd5U3RyaW5nLCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggeyBzaXplOiAxNywgd2VpZ2h0OiAnYm9sZCcgfSApLFxyXG4gICAgICBtYXhXaWR0aDogNzUgLy8gaTE4biwgYnkgaW5zcGVjdGlvblxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGFuIGljb24gb2YgdGhlIGJhciBncmFwaCwgdG8gYmUgdXNlZCBpbiB2aXNpYmlsaXR5IG9yIG90aGVyIGNvbnRyb2xzLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7VGFuZGVtfSB0YW5kZW1cclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICogQHJldHVybnMge05vZGV9XHJcbiAgICovXHJcbiAgc3RhdGljIGNyZWF0ZUJhckdyYXBoSWNvbiggdGFuZGVtLCBvcHRpb25zICkge1xyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcbiAgICAgIHNjYWxlOiAxXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBOb2RlKCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLFxyXG4gICAgICBjaGlsZHJlbjogW1xyXG4gICAgICAgIG5ldyBSZWN0YW5nbGUoIDAsIDAsIDIwLCAyMCwgeyBmaWxsOiAnd2hpdGUnLCBzdHJva2U6ICdibGFjaycsIGxpbmVXaWR0aDogMC41IH0gKSxcclxuICAgICAgICBuZXcgUmVjdGFuZ2xlKCAzLCAxNCwgNSwgNiwge1xyXG4gICAgICAgICAgZmlsbDogRW5lcmd5U2thdGVQYXJrQ29sb3JTY2hlbWUua2luZXRpY0VuZXJneSxcclxuICAgICAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgICAgIGxpbmVXaWR0aDogMC41XHJcbiAgICAgICAgfSApLFxyXG4gICAgICAgIG5ldyBSZWN0YW5nbGUoIDExLCA4LCA1LCAxMiwge1xyXG4gICAgICAgICAgZmlsbDogRW5lcmd5U2thdGVQYXJrQ29sb3JTY2hlbWUucG90ZW50aWFsRW5lcmd5LFxyXG4gICAgICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICAgICAgbGluZVdpZHRoOiAwLjVcclxuICAgICAgICB9IClcclxuICAgICAgXSxcclxuXHJcbiAgICAgIHNjYWxlOiBvcHRpb25zLnNjYWxlXHJcbiAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5lbmVyZ3lTa2F0ZVBhcmsucmVnaXN0ZXIoICdFbmVyZ3lCYXJHcmFwaCcsIEVuZXJneUJhckdyYXBoICk7XHJcbmV4cG9ydCBkZWZhdWx0IEVuZXJneUJhckdyYXBoOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLFFBQVEsTUFBTSxpQ0FBaUM7QUFDdEQsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxZQUFZLE1BQU0sd0NBQXdDO0FBQ2pFLE9BQU9DLEtB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