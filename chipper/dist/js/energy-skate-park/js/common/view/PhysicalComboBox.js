// Copyright 2019-2023, University of Colorado Boulder

/**
 * A combo box that controls one of the physical Properties of Energy Skate Park. In addition to the options provided
 * by this combo box, the value can optionally be something else or controlled in other ways. When this happens,
 * the combo box displays 'Custom'.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import Property from '../../../../axon/js/Property.js';
import merge from '../../../../phet-core/js/merge.js';
import { Text } from '../../../../scenery/js/imports.js';
import ComboBox from '../../../../sun/js/ComboBox.js';
import NullableIO from '../../../../tandem/js/types/NullableIO.js';
import NumberIO from '../../../../tandem/js/types/NumberIO.js';
import energySkatePark from '../../energySkatePark.js';
import EnergySkateParkStrings from '../../EnergySkateParkStrings.js';
import EnergySkateParkConstants from '../EnergySkateParkConstants.js';

// constants
const controlsGravityCustomString = EnergySkateParkStrings.physicalControls.customStringProperty;
class PhysicalComboBox extends ComboBox {
  /**
   * @param {Property} physicalProperty
   * @param {BooleanProperty} userControlledProperty
   * @param {Array.<Object>} labelValueList - entries like {label:{string}, value:{number}}
   * @param {Emitter} resetEmitter
   * @param {Node} listParent - parent for the ComboBoxListBox
   * @param {Tandem} tandem
   * @param {Object} [options]
   */
  constructor(physicalProperty, userControlledProperty, labelValueList, resetEmitter, listParent, tandem, options) {
    assert && assert(_.find(labelValueList, entry => entry.value === null) === undefined, 'PhysicalComboBox adds "Custom" item');
    options = merge({
      // {boolean} whether or not the physicalProperty can be set to something other than the entries defined
      // in labelValueList
      supportCustom: true,
      tandem: tandem
    }, EnergySkateParkConstants.COMBO_BOX_OPTIONS, options);

    // {[].ComboBoxItem}
    const itemList = [];
    labelValueList.forEach((entry, i) => {
      itemList.push({
        value: entry.value,
        createNode: () => new Text(entry.label, EnergySkateParkConstants.COMBO_BOX_ITEM_OPTIONS),
        tandemName: entry.tandemName
      });
    });

    // Redundant "scrap" nodes to check on i18n dimensions, this was needed when converting to the "createNode" pattern
    // of ComboBox items, see https://github.com/phetsims/sun/issues/797
    const tempNodes = labelValueList.map(entry => new Text(entry.label, EnergySkateParkConstants.COMBO_BOX_ITEM_OPTIONS));

    // i18n - if the text gets scaled way down, make sure that the button corner radii aren't larger than content height
    const maxItemHeight = _.maxBy(tempNodes, node => node.height).height;
    options.cornerRadius = Math.min(options.cornerRadius, maxItemHeight / 2);
    tempNodes.forEach(node => node.dispose());
    if (options.supportCustom) {
      itemList.push({
        value: null,
        createNode: () => new Text(controlsGravityCustomString, EnergySkateParkConstants.COMBO_BOX_ITEM_OPTIONS),
        tandemName: 'customItem'
      });
    }

    // adapter Property for the ComboBox because the physicalProperty can be set to values other than those defined
    // in labelValueList - value is null which means 'Custom'
    const adapterProperty = new Property(physicalProperty.value, {
      reentrant: true,
      phetioValueType: NullableIO(NumberIO),
      tandem: tandem.createTandem('adapterProperty')
    });

    // {boolean} - if true, we will prevent the userControlProperty from being set when the adapterProperty changes.
    // The adapterProperty may change from direct control of the ComboBox OR if the physicalProperty changes
    // from somewhere else in the simulation (such as playback of EnergySkateParkDataSamples, or ResetAll). If
    // changed internally, we do NOT want to indicate that user is in control of the physicalProperty.
    let preventUserControl = false;

    // if an entry in the combo box is selected to any entry other than "custom", update the actual Property
    adapterProperty.lazyLink(value => {
      !preventUserControl && userControlledProperty.set(true);
      if (value) {
        physicalProperty.set(value);
      }
      !preventUserControl && userControlledProperty.set(false);
    });

    // if the physical Property changes as a result of anything other than the adapter Property, set to null
    if (options.supportCustom) {
      physicalProperty.link(physicalValue => {
        // physicalProperty is getting set from within simulatuion, do not set userControlledProperty
        preventUserControl = true;

        // if the new value is one of the ComboBox values, update so that selected value is read on ComboBox display
        let adapterValue = null;
        labelValueList.forEach(entry => {
          if (entry.value === physicalValue) {
            adapterValue = entry.value;
          }
        });
        adapterProperty.set(adapterValue);
        preventUserControl = false;
      });
    }

    // the only case where an external physicalProperty change should update
    resetEmitter.addListener(() => {
      adapterProperty.reset();
    });
    super(adapterProperty, itemList, listParent, options);
  }
}
energySkatePark.register('PhysicalComboBox', PhysicalComboBox);
export default PhysicalComboBox;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIm1lcmdlIiwiVGV4dCIsIkNvbWJvQm94IiwiTnVsbGFibGVJTyIsIk51bWJlcklPIiwiZW5lcmd5U2thdGVQYXJrIiwiRW5lcmd5U2thdGVQYXJrU3RyaW5ncyIsIkVuZXJneVNrYXRlUGFya0NvbnN0YW50cyIsImNvbnRyb2xzR3Jhdml0eUN1c3RvbVN0cmluZyIsInBoeXNpY2FsQ29udHJvbHMiLCJjdXN0b21TdHJpbmdQcm9wZXJ0eSIsIlBoeXNpY2FsQ29tYm9Cb3giLCJjb25zdHJ1Y3RvciIsInBoeXNpY2FsUHJvcGVydHkiLCJ1c2VyQ29udHJvbGxlZFByb3BlcnR5IiwibGFiZWxWYWx1ZUxpc3QiLCJyZXNldEVtaXR0ZXIiLCJsaXN0UGFyZW50IiwidGFuZGVtIiwib3B0aW9ucyIsImFzc2VydCIsIl8iLCJmaW5kIiwiZW50cnkiLCJ2YWx1ZSIsInVuZGVmaW5lZCIsInN1cHBvcnRDdXN0b20iLCJDT01CT19CT1hfT1BUSU9OUyIsIml0ZW1MaXN0IiwiZm9yRWFjaCIsImkiLCJwdXNoIiwiY3JlYXRlTm9kZSIsImxhYmVsIiwiQ09NQk9fQk9YX0lURU1fT1BUSU9OUyIsInRhbmRlbU5hbWUiLCJ0ZW1wTm9kZXMiLCJtYXAiLCJtYXhJdGVtSGVpZ2h0IiwibWF4QnkiLCJub2RlIiwiaGVpZ2h0IiwiY29ybmVyUmFkaXVzIiwiTWF0aCIsIm1pbiIsImRpc3Bvc2UiLCJhZGFwdGVyUHJvcGVydHkiLCJyZWVudHJhbnQiLCJwaGV0aW9WYWx1ZVR5cGUiLCJjcmVhdGVUYW5kZW0iLCJwcmV2ZW50VXNlckNvbnRyb2wiLCJsYXp5TGluayIsInNldCIsImxpbmsiLCJwaHlzaWNhbFZhbHVlIiwiYWRhcHRlclZhbHVlIiwiYWRkTGlzdGVuZXIiLCJyZXNldCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUGh5c2ljYWxDb21ib0JveC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBIGNvbWJvIGJveCB0aGF0IGNvbnRyb2xzIG9uZSBvZiB0aGUgcGh5c2ljYWwgUHJvcGVydGllcyBvZiBFbmVyZ3kgU2thdGUgUGFyay4gSW4gYWRkaXRpb24gdG8gdGhlIG9wdGlvbnMgcHJvdmlkZWRcclxuICogYnkgdGhpcyBjb21ibyBib3gsIHRoZSB2YWx1ZSBjYW4gb3B0aW9uYWxseSBiZSBzb21ldGhpbmcgZWxzZSBvciBjb250cm9sbGVkIGluIG90aGVyIHdheXMuIFdoZW4gdGhpcyBoYXBwZW5zLFxyXG4gKiB0aGUgY29tYm8gYm94IGRpc3BsYXlzICdDdXN0b20nLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgeyBUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IENvbWJvQm94IGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9Db21ib0JveC5qcyc7XHJcbmltcG9ydCBOdWxsYWJsZUlPIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdWxsYWJsZUlPLmpzJztcclxuaW1wb3J0IE51bWJlcklPIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdW1iZXJJTy5qcyc7XHJcbmltcG9ydCBlbmVyZ3lTa2F0ZVBhcmsgZnJvbSAnLi4vLi4vZW5lcmd5U2thdGVQYXJrLmpzJztcclxuaW1wb3J0IEVuZXJneVNrYXRlUGFya1N0cmluZ3MgZnJvbSAnLi4vLi4vRW5lcmd5U2thdGVQYXJrU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBFbmVyZ3lTa2F0ZVBhcmtDb25zdGFudHMgZnJvbSAnLi4vRW5lcmd5U2thdGVQYXJrQ29uc3RhbnRzLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBjb250cm9sc0dyYXZpdHlDdXN0b21TdHJpbmcgPSBFbmVyZ3lTa2F0ZVBhcmtTdHJpbmdzLnBoeXNpY2FsQ29udHJvbHMuY3VzdG9tU3RyaW5nUHJvcGVydHk7XHJcblxyXG5jbGFzcyBQaHlzaWNhbENvbWJvQm94IGV4dGVuZHMgQ29tYm9Cb3gge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1Byb3BlcnR5fSBwaHlzaWNhbFByb3BlcnR5XHJcbiAgICogQHBhcmFtIHtCb29sZWFuUHJvcGVydHl9IHVzZXJDb250cm9sbGVkUHJvcGVydHlcclxuICAgKiBAcGFyYW0ge0FycmF5LjxPYmplY3Q+fSBsYWJlbFZhbHVlTGlzdCAtIGVudHJpZXMgbGlrZSB7bGFiZWw6e3N0cmluZ30sIHZhbHVlOntudW1iZXJ9fVxyXG4gICAqIEBwYXJhbSB7RW1pdHRlcn0gcmVzZXRFbWl0dGVyXHJcbiAgICogQHBhcmFtIHtOb2RlfSBsaXN0UGFyZW50IC0gcGFyZW50IGZvciB0aGUgQ29tYm9Cb3hMaXN0Qm94XHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggcGh5c2ljYWxQcm9wZXJ0eSwgdXNlckNvbnRyb2xsZWRQcm9wZXJ0eSwgbGFiZWxWYWx1ZUxpc3QsIHJlc2V0RW1pdHRlciwgbGlzdFBhcmVudCwgdGFuZGVtLCBvcHRpb25zICkge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggXy5maW5kKCBsYWJlbFZhbHVlTGlzdCwgZW50cnkgPT4gZW50cnkudmFsdWUgPT09IG51bGwgKSA9PT0gdW5kZWZpbmVkLCAnUGh5c2ljYWxDb21ib0JveCBhZGRzIFwiQ3VzdG9tXCIgaXRlbScgKTtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuXHJcbiAgICAgIC8vIHtib29sZWFufSB3aGV0aGVyIG9yIG5vdCB0aGUgcGh5c2ljYWxQcm9wZXJ0eSBjYW4gYmUgc2V0IHRvIHNvbWV0aGluZyBvdGhlciB0aGFuIHRoZSBlbnRyaWVzIGRlZmluZWRcclxuICAgICAgLy8gaW4gbGFiZWxWYWx1ZUxpc3RcclxuICAgICAgc3VwcG9ydEN1c3RvbTogdHJ1ZSxcclxuXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtXHJcbiAgICB9LCBFbmVyZ3lTa2F0ZVBhcmtDb25zdGFudHMuQ09NQk9fQk9YX09QVElPTlMsIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyB7W10uQ29tYm9Cb3hJdGVtfVxyXG4gICAgY29uc3QgaXRlbUxpc3QgPSBbXTtcclxuICAgIGxhYmVsVmFsdWVMaXN0LmZvckVhY2goICggZW50cnksIGkgKSA9PiB7XHJcbiAgICAgIGl0ZW1MaXN0LnB1c2goIHtcclxuICAgICAgICB2YWx1ZTogZW50cnkudmFsdWUsXHJcbiAgICAgICAgY3JlYXRlTm9kZTogKCkgPT4gbmV3IFRleHQoIGVudHJ5LmxhYmVsLCBFbmVyZ3lTa2F0ZVBhcmtDb25zdGFudHMuQ09NQk9fQk9YX0lURU1fT1BUSU9OUyApLFxyXG4gICAgICAgIHRhbmRlbU5hbWU6IGVudHJ5LnRhbmRlbU5hbWVcclxuICAgICAgfSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFJlZHVuZGFudCBcInNjcmFwXCIgbm9kZXMgdG8gY2hlY2sgb24gaTE4biBkaW1lbnNpb25zLCB0aGlzIHdhcyBuZWVkZWQgd2hlbiBjb252ZXJ0aW5nIHRvIHRoZSBcImNyZWF0ZU5vZGVcIiBwYXR0ZXJuXHJcbiAgICAvLyBvZiBDb21ib0JveCBpdGVtcywgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzc5N1xyXG4gICAgY29uc3QgdGVtcE5vZGVzID0gbGFiZWxWYWx1ZUxpc3QubWFwKCBlbnRyeSA9PiBuZXcgVGV4dCggZW50cnkubGFiZWwsIEVuZXJneVNrYXRlUGFya0NvbnN0YW50cy5DT01CT19CT1hfSVRFTV9PUFRJT05TICkgKTtcclxuXHJcbiAgICAvLyBpMThuIC0gaWYgdGhlIHRleHQgZ2V0cyBzY2FsZWQgd2F5IGRvd24sIG1ha2Ugc3VyZSB0aGF0IHRoZSBidXR0b24gY29ybmVyIHJhZGlpIGFyZW4ndCBsYXJnZXIgdGhhbiBjb250ZW50IGhlaWdodFxyXG4gICAgY29uc3QgbWF4SXRlbUhlaWdodCA9IF8ubWF4QnkoIHRlbXBOb2Rlcywgbm9kZSA9PiBub2RlLmhlaWdodCApLmhlaWdodDtcclxuICAgIG9wdGlvbnMuY29ybmVyUmFkaXVzID0gTWF0aC5taW4oIG9wdGlvbnMuY29ybmVyUmFkaXVzLCBtYXhJdGVtSGVpZ2h0IC8gMiApO1xyXG4gICAgdGVtcE5vZGVzLmZvckVhY2goIG5vZGUgPT4gbm9kZS5kaXNwb3NlKCkgKTtcclxuXHJcbiAgICBpZiAoIG9wdGlvbnMuc3VwcG9ydEN1c3RvbSApIHtcclxuICAgICAgaXRlbUxpc3QucHVzaCgge1xyXG4gICAgICAgIHZhbHVlOiBudWxsLFxyXG4gICAgICAgIGNyZWF0ZU5vZGU6ICgpID0+IG5ldyBUZXh0KCBjb250cm9sc0dyYXZpdHlDdXN0b21TdHJpbmcsIEVuZXJneVNrYXRlUGFya0NvbnN0YW50cy5DT01CT19CT1hfSVRFTV9PUFRJT05TICksXHJcbiAgICAgICAgdGFuZGVtTmFtZTogJ2N1c3RvbUl0ZW0nXHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBhZGFwdGVyIFByb3BlcnR5IGZvciB0aGUgQ29tYm9Cb3ggYmVjYXVzZSB0aGUgcGh5c2ljYWxQcm9wZXJ0eSBjYW4gYmUgc2V0IHRvIHZhbHVlcyBvdGhlciB0aGFuIHRob3NlIGRlZmluZWRcclxuICAgIC8vIGluIGxhYmVsVmFsdWVMaXN0IC0gdmFsdWUgaXMgbnVsbCB3aGljaCBtZWFucyAnQ3VzdG9tJ1xyXG4gICAgY29uc3QgYWRhcHRlclByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBwaHlzaWNhbFByb3BlcnR5LnZhbHVlLCB7XHJcbiAgICAgIHJlZW50cmFudDogdHJ1ZSxcclxuICAgICAgcGhldGlvVmFsdWVUeXBlOiBOdWxsYWJsZUlPKCBOdW1iZXJJTyApLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdhZGFwdGVyUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB7Ym9vbGVhbn0gLSBpZiB0cnVlLCB3ZSB3aWxsIHByZXZlbnQgdGhlIHVzZXJDb250cm9sUHJvcGVydHkgZnJvbSBiZWluZyBzZXQgd2hlbiB0aGUgYWRhcHRlclByb3BlcnR5IGNoYW5nZXMuXHJcbiAgICAvLyBUaGUgYWRhcHRlclByb3BlcnR5IG1heSBjaGFuZ2UgZnJvbSBkaXJlY3QgY29udHJvbCBvZiB0aGUgQ29tYm9Cb3ggT1IgaWYgdGhlIHBoeXNpY2FsUHJvcGVydHkgY2hhbmdlc1xyXG4gICAgLy8gZnJvbSBzb21ld2hlcmUgZWxzZSBpbiB0aGUgc2ltdWxhdGlvbiAoc3VjaCBhcyBwbGF5YmFjayBvZiBFbmVyZ3lTa2F0ZVBhcmtEYXRhU2FtcGxlcywgb3IgUmVzZXRBbGwpLiBJZlxyXG4gICAgLy8gY2hhbmdlZCBpbnRlcm5hbGx5LCB3ZSBkbyBOT1Qgd2FudCB0byBpbmRpY2F0ZSB0aGF0IHVzZXIgaXMgaW4gY29udHJvbCBvZiB0aGUgcGh5c2ljYWxQcm9wZXJ0eS5cclxuICAgIGxldCBwcmV2ZW50VXNlckNvbnRyb2wgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBpZiBhbiBlbnRyeSBpbiB0aGUgY29tYm8gYm94IGlzIHNlbGVjdGVkIHRvIGFueSBlbnRyeSBvdGhlciB0aGFuIFwiY3VzdG9tXCIsIHVwZGF0ZSB0aGUgYWN0dWFsIFByb3BlcnR5XHJcbiAgICBhZGFwdGVyUHJvcGVydHkubGF6eUxpbmsoIHZhbHVlID0+IHtcclxuICAgICAgIXByZXZlbnRVc2VyQ29udHJvbCAmJiB1c2VyQ29udHJvbGxlZFByb3BlcnR5LnNldCggdHJ1ZSApO1xyXG4gICAgICBpZiAoIHZhbHVlICkgeyBwaHlzaWNhbFByb3BlcnR5LnNldCggdmFsdWUgKTsgfVxyXG4gICAgICAhcHJldmVudFVzZXJDb250cm9sICYmIHVzZXJDb250cm9sbGVkUHJvcGVydHkuc2V0KCBmYWxzZSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGlmIHRoZSBwaHlzaWNhbCBQcm9wZXJ0eSBjaGFuZ2VzIGFzIGEgcmVzdWx0IG9mIGFueXRoaW5nIG90aGVyIHRoYW4gdGhlIGFkYXB0ZXIgUHJvcGVydHksIHNldCB0byBudWxsXHJcbiAgICBpZiAoIG9wdGlvbnMuc3VwcG9ydEN1c3RvbSApIHtcclxuICAgICAgcGh5c2ljYWxQcm9wZXJ0eS5saW5rKCBwaHlzaWNhbFZhbHVlID0+IHtcclxuXHJcbiAgICAgICAgLy8gcGh5c2ljYWxQcm9wZXJ0eSBpcyBnZXR0aW5nIHNldCBmcm9tIHdpdGhpbiBzaW11bGF0dWlvbiwgZG8gbm90IHNldCB1c2VyQ29udHJvbGxlZFByb3BlcnR5XHJcbiAgICAgICAgcHJldmVudFVzZXJDb250cm9sID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gaWYgdGhlIG5ldyB2YWx1ZSBpcyBvbmUgb2YgdGhlIENvbWJvQm94IHZhbHVlcywgdXBkYXRlIHNvIHRoYXQgc2VsZWN0ZWQgdmFsdWUgaXMgcmVhZCBvbiBDb21ib0JveCBkaXNwbGF5XHJcbiAgICAgICAgbGV0IGFkYXB0ZXJWYWx1ZSA9IG51bGw7XHJcbiAgICAgICAgbGFiZWxWYWx1ZUxpc3QuZm9yRWFjaCggZW50cnkgPT4ge1xyXG4gICAgICAgICAgaWYgKCBlbnRyeS52YWx1ZSA9PT0gcGh5c2ljYWxWYWx1ZSApIHtcclxuICAgICAgICAgICAgYWRhcHRlclZhbHVlID0gZW50cnkudmFsdWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSApO1xyXG4gICAgICAgIGFkYXB0ZXJQcm9wZXJ0eS5zZXQoIGFkYXB0ZXJWYWx1ZSApO1xyXG5cclxuICAgICAgICBwcmV2ZW50VXNlckNvbnRyb2wgPSBmYWxzZTtcclxuICAgICAgfSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHRoZSBvbmx5IGNhc2Ugd2hlcmUgYW4gZXh0ZXJuYWwgcGh5c2ljYWxQcm9wZXJ0eSBjaGFuZ2Ugc2hvdWxkIHVwZGF0ZVxyXG4gICAgcmVzZXRFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgIGFkYXB0ZXJQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHN1cGVyKCBhZGFwdGVyUHJvcGVydHksIGl0ZW1MaXN0LCBsaXN0UGFyZW50LCBvcHRpb25zICk7XHJcbiAgfVxyXG59XHJcblxyXG5lbmVyZ3lTa2F0ZVBhcmsucmVnaXN0ZXIoICdQaHlzaWNhbENvbWJvQm94JywgUGh5c2ljYWxDb21ib0JveCApO1xyXG5leHBvcnQgZGVmYXVsdCBQaHlzaWNhbENvbWJvQm94OyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxLQUFLLE1BQU0sbUNBQW1DO0FBQ3JELFNBQVNDLElBQUksUUFBUSxtQ0FBbUM7QUFDeEQsT0FBT0MsUUFBUSxNQUFNLGdDQUFnQztBQUNyRCxPQUFPQyxVQUFVLE1BQU0sMkNBQTJDO0FBQ2xFLE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsT0FBT0MsZUFBZSxNQUFNLDBCQUEwQjtBQUN0RCxPQUFPQyxzQkFBc0IsTUFBTSxpQ0FBaUM7QUFDcEUsT0FBT0Msd0JBQXdCLE1BQU0sZ0NBQWdDOztBQUVyRTtBQUNBLE1BQU1DLDJCQUEyQixHQUFHRixzQkFBc0IsQ0FBQ0csZ0JBQWdCLENBQUNDLG9CQUFvQjtBQUVoRyxNQUFNQyxnQkFBZ0IsU0FBU1QsUUFBUSxDQUFDO0VBRXRDO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFVSxXQUFXQSxDQUFFQyxnQkFBZ0IsRUFBRUMsc0JBQXNCLEVBQUVDLGNB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