// Copyright 2019-2022, University of Colorado Boulder

/**
 * This class renders DynamicSeries data in a XYChartNode and is tightly coupled with XYChartNode.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Jesse Greenberg
 */

import deprecationWarning from '../../phet-core/js/deprecationWarning.js';
import EnumerationDeprecated from '../../phet-core/js/EnumerationDeprecated.js';
import merge from '../../phet-core/js/merge.js';
import { CanvasNode, Color } from '../../scenery/js/imports.js';
import griddle from './griddle.js';

// constants
const PlotStyle = EnumerationDeprecated.byKeys(['SCATTER', 'LINE']);

/**
 * @deprecated - please use bamboo
 */
class DynamicSeriesNode extends CanvasNode {
  /**
   * @param {DynamicSeries} dynamicSeries - the series of data to render
   * @param {number} chartWidth - the horizontal size of the chart, up to the center of the pen
   * @param {Bounds2} bounds - bounds for rendering, includes area to the right of the pens
   * @param {Property.<ModelViewTransform2>} modelViewTransformProperty
   * @param {Object} [options]
   */
  constructor(dynamicSeries, chartWidth, bounds, modelViewTransformProperty, options) {
    assert && deprecationWarning('Please use bamboo');
    options = merge({
      // {PlotStyle} - changes how the dynamicSeries is drawn
      plotStyle: PlotStyle.LINE
    }, options);
    assert && assert(PlotStyle.includes(options.plotStyle));
    assert && assert(options.canvasBounds === undefined, 'DynamicSeriesNode sets bounds through constructor param');
    super({
      canvasBounds: bounds
    });

    // @private
    this.modelViewTransformProperty = modelViewTransformProperty;
    this.plotStyle = options.plotStyle;
    this.dynamicSeries = dynamicSeries;

    // set visible with Property, handle saved for disposal
    const visibilityListener = visible => {
      this.visible = visible;
    };
    dynamicSeries.visibleProperty.link(visibilityListener);

    // redraw data
    const dynamicSeriesListener = () => {
      this.invalidatePaint();
    };
    dynamicSeries.addDynamicSeriesListener(dynamicSeriesListener);
    modelViewTransformProperty.link(dynamicSeriesListener);
    dynamicSeries.visibleProperty.link(dynamicSeriesListener);
    this.disposeDynamicSeriesNode = () => {
      dynamicSeries.removeDynamicSeriesListener(dynamicSeriesListener);
      dynamicSeries.visibleProperty.unlink(visibilityListener);
      dynamicSeries.visibleProperty.unlink(dynamicSeriesListener);
      modelViewTransformProperty.unlink(dynamicSeriesListener);
    };
  }

  /**
   * Used to redraw the CanvasNode. Use CanvasNode.invalidatePaint to signify that
   * it is time to redraw the canvas.
   * @protected
   * @override
   *
   * @param {CanvasRenderingContext2D} context
   */
  paintCanvas(context) {
    if (this.dynamicSeries.visibleProperty.get()) {
      if (this.plotStyle === PlotStyle.LINE) {
        this.drawDataLine(context);
      } else {
        this.drawDataScatter(context);
      }
    }
  }

  /**
   * Draw the DynamicSeries data as a scatter plot, each circular dot looks the same.
   * @private
   *
   * @param {CanvasRenderingContext2D} context
   */
  drawDataScatter(context) {
    const contextColor = this.dynamicSeries.color instanceof Color ? this.dynamicSeries.color.toCSS() : this.dynamicSeries.color;
    context.fillStyle = contextColor;

    // draw a circle at each data point
    for (let i = 0; i < this.dynamicSeries.getLength(); i++) {
      context.beginPath();
      const viewPosition = this.modelViewTransformProperty.get().modelToViewPosition(this.dynamicSeries.getDataPoint(i));
      context.arc(viewPosition.x, viewPosition.y, this.dynamicSeries.radius, 0, 2 * Math.PI);
      context.fill();
    }
  }

  /**
   * Draw the DynamicSeries data as a continuous line.
   * @param {CanvasRenderingContext2D} context
   *
   * @private
   */
  drawDataLine(context) {
    context.beginPath();
    const contextColor = this.dynamicSeries.color instanceof Color ? this.dynamicSeries.color.toCSS() : this.dynamicSeries.color;
    context.strokeStyle = contextColor;
    context.lineWidth = this.dynamicSeries.lineWidth;
    context.lineJoin = this.dynamicSeries.lineJoin;
    let moveToNextPoint = true;
    const modelViewTransform = this.modelViewTransformProperty.get();
    for (let i = 0; i < this.dynamicSeries.getLength(); i++) {
      const dataPoint = this.dynamicSeries.getDataPoint(i);
      if (isNaN(dataPoint.y)) {
        moveToNextPoint = true;
      } else {
        const point = modelViewTransform.modelToViewPosition(dataPoint);
        if (moveToNextPoint) {
          context.moveTo(point.x, point.y);
        } else {
          context.lineTo(point.x, point.y);
        }
        moveToNextPoint = false;
      }
    }
    context.stroke();
  }

  /**
   * Set the plot style for the DynamicSeriesNode.
   * @public
   * @param {PlotStyle} plotStyle - value from of PlotStyle
   */
  setPlotStyle(plotStyle) {
    assert && assert(PlotStyle.includes(plotStyle));

    // only update/redraw if there is a change in style
    if (plotStyle !== this.plotStyle) {
      this.plotStyle = plotStyle;
      this.invalidatePaint();
    }
  }

  /**
   * @public
   */
  dispose() {
    this.disposeDynamicSeriesNode();
    super.dispose();
  }
}

// @public (read-only)
DynamicSeriesNode.PlotStyle = PlotStyle;
griddle.register('DynamicSeriesNode', DynamicSeriesNode);
export default DynamicSeriesNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZXByZWNhdGlvbldhcm5pbmciLCJFbnVtZXJhdGlvbkRlcHJlY2F0ZWQiLCJtZXJnZSIsIkNhbnZhc05vZGUiLCJDb2xvciIsImdyaWRkbGUiLCJQbG90U3R5bGUiLCJieUtleXMiLCJEeW5hbWljU2VyaWVzTm9kZSIsImNvbnN0cnVjdG9yIiwiZHluYW1pY1NlcmllcyIsImNoYXJ0V2lkdGgiLCJib3VuZHMiLCJtb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eSIsIm9wdGlvbnMiLCJhc3NlcnQiLCJwbG90U3R5bGUiLCJMSU5FIiwiaW5jbHVkZXMiLCJjYW52YXNCb3VuZHMiLCJ1bmRlZmluZWQiLCJ2aXNpYmlsaXR5TGlzdGVuZXIiLCJ2aXNpYmxlIiwidmlzaWJsZVByb3BlcnR5IiwibGluayIsImR5bmFtaWNTZXJpZXNMaXN0ZW5lciIsImludmFsaWRhdGVQYWludCIsImFkZER5bmFtaWNTZXJpZXNMaXN0ZW5lciIsImRpc3Bvc2VEeW5hbWljU2VyaWVzTm9kZSIsInJlbW92ZUR5bmFtaWNTZXJpZXNMaXN0ZW5lciIsInVubGluayIsInBhaW50Q2FudmFzIiwiY29udGV4dCIsImdldCIsImRyYXdEYXRhTGluZSIsImRyYXdEYXRhU2NhdHRlciIsImNvbnRleHRDb2xvciIsImNvbG9yIiwidG9DU1MiLCJmaWxsU3R5bGUiLCJpIiwiZ2V0TGVuZ3RoIiwiYmVnaW5QYXRoIiwidmlld1Bvc2l0aW9uIiwibW9kZWxUb1ZpZXdQb3NpdGlvbiIsImdldERhdGFQb2ludCIsImFyYyIsIngiLCJ5IiwicmFkaXVzIiwiTWF0aCIsIlBJIiwiZmlsbCIsInN0cm9rZVN0eWxlIiwibGluZVdpZHRoIiwibGluZUpvaW4iLCJtb3ZlVG9OZXh0UG9pbnQiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJkYXRhUG9pbnQiLCJpc05hTiIsInBvaW50IiwibW92ZVRvIiwibGluZVRvIiwic3Ryb2tlIiwic2V0UGxvdFN0eWxlIiwiZGlzcG9zZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRHluYW1pY1Nlcmllc05vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhpcyBjbGFzcyByZW5kZXJzIER5bmFtaWNTZXJpZXMgZGF0YSBpbiBhIFhZQ2hhcnROb2RlIGFuZCBpcyB0aWdodGx5IGNvdXBsZWQgd2l0aCBYWUNoYXJ0Tm9kZS5cclxuICpcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmdcclxuICovXHJcblxyXG5pbXBvcnQgZGVwcmVjYXRpb25XYXJuaW5nIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9kZXByZWNhdGlvbldhcm5pbmcuanMnO1xyXG5pbXBvcnQgRW51bWVyYXRpb25EZXByZWNhdGVkIGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9FbnVtZXJhdGlvbkRlcHJlY2F0ZWQuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IHsgQ2FudmFzTm9kZSwgQ29sb3IgfSBmcm9tICcuLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZ3JpZGRsZSBmcm9tICcuL2dyaWRkbGUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IFBsb3RTdHlsZSA9IEVudW1lcmF0aW9uRGVwcmVjYXRlZC5ieUtleXMoIFsgJ1NDQVRURVInLCAnTElORScgXSApO1xyXG5cclxuLyoqXHJcbiAqIEBkZXByZWNhdGVkIC0gcGxlYXNlIHVzZSBiYW1ib29cclxuICovXHJcbmNsYXNzIER5bmFtaWNTZXJpZXNOb2RlIGV4dGVuZHMgQ2FudmFzTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7RHluYW1pY1Nlcmllc30gZHluYW1pY1NlcmllcyAtIHRoZSBzZXJpZXMgb2YgZGF0YSB0byByZW5kZXJcclxuICAgKiBAcGFyYW0ge251bWJlcn0gY2hhcnRXaWR0aCAtIHRoZSBob3Jpem9udGFsIHNpemUgb2YgdGhlIGNoYXJ0LCB1cCB0byB0aGUgY2VudGVyIG9mIHRoZSBwZW5cclxuICAgKiBAcGFyYW0ge0JvdW5kczJ9IGJvdW5kcyAtIGJvdW5kcyBmb3IgcmVuZGVyaW5nLCBpbmNsdWRlcyBhcmVhIHRvIHRoZSByaWdodCBvZiB0aGUgcGVuc1xyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPE1vZGVsVmlld1RyYW5zZm9ybTI+fSBtb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggZHluYW1pY1NlcmllcywgY2hhcnRXaWR0aCwgYm91bmRzLCBtb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eSwgb3B0aW9ucyApIHtcclxuICAgIGFzc2VydCAmJiBkZXByZWNhdGlvbldhcm5pbmcoICdQbGVhc2UgdXNlIGJhbWJvbycgKTtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuXHJcbiAgICAgIC8vIHtQbG90U3R5bGV9IC0gY2hhbmdlcyBob3cgdGhlIGR5bmFtaWNTZXJpZXMgaXMgZHJhd25cclxuICAgICAgcGxvdFN0eWxlOiBQbG90U3R5bGUuTElORVxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggUGxvdFN0eWxlLmluY2x1ZGVzKCBvcHRpb25zLnBsb3RTdHlsZSApICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zLmNhbnZhc0JvdW5kcyA9PT0gdW5kZWZpbmVkLCAnRHluYW1pY1Nlcmllc05vZGUgc2V0cyBib3VuZHMgdGhyb3VnaCBjb25zdHJ1Y3RvciBwYXJhbScgKTtcclxuXHJcbiAgICBzdXBlcigge1xyXG4gICAgICBjYW52YXNCb3VuZHM6IGJvdW5kc1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlXHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybVByb3BlcnR5ID0gbW9kZWxWaWV3VHJhbnNmb3JtUHJvcGVydHk7XHJcbiAgICB0aGlzLnBsb3RTdHlsZSA9IG9wdGlvbnMucGxvdFN0eWxlO1xyXG4gICAgdGhpcy5keW5hbWljU2VyaWVzID0gZHluYW1pY1NlcmllcztcclxuXHJcbiAgICAvLyBzZXQgdmlzaWJsZSB3aXRoIFByb3BlcnR5LCBoYW5kbGUgc2F2ZWQgZm9yIGRpc3Bvc2FsXHJcbiAgICBjb25zdCB2aXNpYmlsaXR5TGlzdGVuZXIgPSB2aXNpYmxlID0+IHt0aGlzLnZpc2libGUgPSB2aXNpYmxlO307XHJcbiAgICBkeW5hbWljU2VyaWVzLnZpc2libGVQcm9wZXJ0eS5saW5rKCB2aXNpYmlsaXR5TGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyByZWRyYXcgZGF0YVxyXG4gICAgY29uc3QgZHluYW1pY1Nlcmllc0xpc3RlbmVyID0gKCkgPT4ge1xyXG4gICAgICB0aGlzLmludmFsaWRhdGVQYWludCgpO1xyXG4gICAgfTtcclxuICAgIGR5bmFtaWNTZXJpZXMuYWRkRHluYW1pY1Nlcmllc0xpc3RlbmVyKCBkeW5hbWljU2VyaWVzTGlzdGVuZXIgKTtcclxuICAgIG1vZGVsVmlld1RyYW5zZm9ybVByb3BlcnR5LmxpbmsoIGR5bmFtaWNTZXJpZXNMaXN0ZW5lciApO1xyXG4gICAgZHluYW1pY1Nlcmllcy52aXNpYmxlUHJvcGVydHkubGluayggZHluYW1pY1Nlcmllc0xpc3RlbmVyICk7XHJcbiAgICB0aGlzLmRpc3Bvc2VEeW5hbWljU2VyaWVzTm9kZSA9ICgpID0+IHtcclxuICAgICAgZHluYW1pY1Nlcmllcy5yZW1vdmVEeW5hbWljU2VyaWVzTGlzdGVuZXIoIGR5bmFtaWNTZXJpZXNMaXN0ZW5lciApO1xyXG4gICAgICBkeW5hbWljU2VyaWVzLnZpc2libGVQcm9wZXJ0eS51bmxpbmsoIHZpc2liaWxpdHlMaXN0ZW5lciApO1xyXG4gICAgICBkeW5hbWljU2VyaWVzLnZpc2libGVQcm9wZXJ0eS51bmxpbmsoIGR5bmFtaWNTZXJpZXNMaXN0ZW5lciApO1xyXG4gICAgICBtb2RlbFZpZXdUcmFuc2Zvcm1Qcm9wZXJ0eS51bmxpbmsoIGR5bmFtaWNTZXJpZXNMaXN0ZW5lciApO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVzZWQgdG8gcmVkcmF3IHRoZSBDYW52YXNOb2RlLiBVc2UgQ2FudmFzTm9kZS5pbnZhbGlkYXRlUGFpbnQgdG8gc2lnbmlmeSB0aGF0XHJcbiAgICogaXQgaXMgdGltZSB0byByZWRyYXcgdGhlIGNhbnZhcy5cclxuICAgKiBAcHJvdGVjdGVkXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dFxyXG4gICAqL1xyXG4gIHBhaW50Q2FudmFzKCBjb250ZXh0ICkge1xyXG4gICAgaWYgKCB0aGlzLmR5bmFtaWNTZXJpZXMudmlzaWJsZVByb3BlcnR5LmdldCgpICkge1xyXG4gICAgICBpZiAoIHRoaXMucGxvdFN0eWxlID09PSBQbG90U3R5bGUuTElORSApIHtcclxuICAgICAgICB0aGlzLmRyYXdEYXRhTGluZSggY29udGV4dCApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMuZHJhd0RhdGFTY2F0dGVyKCBjb250ZXh0ICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERyYXcgdGhlIER5bmFtaWNTZXJpZXMgZGF0YSBhcyBhIHNjYXR0ZXIgcGxvdCwgZWFjaCBjaXJjdWxhciBkb3QgbG9va3MgdGhlIHNhbWUuXHJcbiAgICogQHByaXZhdGVcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjb250ZXh0XHJcbiAgICovXHJcbiAgZHJhd0RhdGFTY2F0dGVyKCBjb250ZXh0ICkge1xyXG5cclxuICAgIGNvbnN0IGNvbnRleHRDb2xvciA9IHRoaXMuZHluYW1pY1Nlcmllcy5jb2xvciBpbnN0YW5jZW9mIENvbG9yID8gdGhpcy5keW5hbWljU2VyaWVzLmNvbG9yLnRvQ1NTKCkgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5keW5hbWljU2VyaWVzLmNvbG9yO1xyXG4gICAgY29udGV4dC5maWxsU3R5bGUgPSBjb250ZXh0Q29sb3I7XHJcblxyXG4gICAgLy8gZHJhdyBhIGNpcmNsZSBhdCBlYWNoIGRhdGEgcG9pbnRcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuZHluYW1pY1Nlcmllcy5nZXRMZW5ndGgoKTsgaSsrICkge1xyXG4gICAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xyXG4gICAgICBjb25zdCB2aWV3UG9zaXRpb24gPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybVByb3BlcnR5LmdldCgpLm1vZGVsVG9WaWV3UG9zaXRpb24oIHRoaXMuZHluYW1pY1Nlcmllcy5nZXREYXRhUG9pbnQoIGkgKSApO1xyXG4gICAgICBjb250ZXh0LmFyYyggdmlld1Bvc2l0aW9uLngsIHZpZXdQb3NpdGlvbi55LCB0aGlzLmR5bmFtaWNTZXJpZXMucmFkaXVzLCAwLCAyICogTWF0aC5QSSApO1xyXG4gICAgICBjb250ZXh0LmZpbGwoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERyYXcgdGhlIER5bmFtaWNTZXJpZXMgZGF0YSBhcyBhIGNvbnRpbnVvdXMgbGluZS5cclxuICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dFxyXG4gICAqXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBkcmF3RGF0YUxpbmUoIGNvbnRleHQgKSB7XHJcbiAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xyXG5cclxuICAgIGNvbnN0IGNvbnRleHRDb2xvciA9IHRoaXMuZHluYW1pY1Nlcmllcy5jb2xvciBpbnN0YW5jZW9mIENvbG9yID8gdGhpcy5keW5hbWljU2VyaWVzLmNvbG9yLnRvQ1NTKCkgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5keW5hbWljU2VyaWVzLmNvbG9yO1xyXG4gICAgY29udGV4dC5zdHJva2VTdHlsZSA9IGNvbnRleHRDb2xvcjtcclxuICAgIGNvbnRleHQubGluZVdpZHRoID0gdGhpcy5keW5hbWljU2VyaWVzLmxpbmVXaWR0aDtcclxuICAgIGNvbnRleHQubGluZUpvaW4gPSB0aGlzLmR5bmFtaWNTZXJpZXMubGluZUpvaW47XHJcblxyXG4gICAgbGV0IG1vdmVUb05leHRQb2ludCA9IHRydWU7XHJcbiAgICBjb25zdCBtb2RlbFZpZXdUcmFuc2Zvcm0gPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybVByb3BlcnR5LmdldCgpO1xyXG5cclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuZHluYW1pY1Nlcmllcy5nZXRMZW5ndGgoKTsgaSsrICkge1xyXG4gICAgICBjb25zdCBkYXRhUG9pbnQgPSB0aGlzLmR5bmFtaWNTZXJpZXMuZ2V0RGF0YVBvaW50KCBpICk7XHJcblxyXG4gICAgICBpZiAoIGlzTmFOKCBkYXRhUG9pbnQueSApICkge1xyXG4gICAgICAgIG1vdmVUb05leHRQb2ludCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcG9pbnQgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdQb3NpdGlvbiggZGF0YVBvaW50ICk7XHJcbiAgICAgICAgaWYgKCBtb3ZlVG9OZXh0UG9pbnQgKSB7XHJcbiAgICAgICAgICBjb250ZXh0Lm1vdmVUbyggcG9pbnQueCwgcG9pbnQueSApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGNvbnRleHQubGluZVRvKCBwb2ludC54LCBwb2ludC55ICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBtb3ZlVG9OZXh0UG9pbnQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnRleHQuc3Ryb2tlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIHBsb3Qgc3R5bGUgZm9yIHRoZSBEeW5hbWljU2VyaWVzTm9kZS5cclxuICAgKiBAcHVibGljXHJcbiAgICogQHBhcmFtIHtQbG90U3R5bGV9IHBsb3RTdHlsZSAtIHZhbHVlIGZyb20gb2YgUGxvdFN0eWxlXHJcbiAgICovXHJcbiAgc2V0UGxvdFN0eWxlKCBwbG90U3R5bGUgKSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBQbG90U3R5bGUuaW5jbHVkZXMoIHBsb3RTdHlsZSApICk7XHJcblxyXG4gICAgLy8gb25seSB1cGRhdGUvcmVkcmF3IGlmIHRoZXJlIGlzIGEgY2hhbmdlIGluIHN0eWxlXHJcbiAgICBpZiAoIHBsb3RTdHlsZSAhPT0gdGhpcy5wbG90U3R5bGUgKSB7XHJcbiAgICAgIHRoaXMucGxvdFN0eWxlID0gcGxvdFN0eWxlO1xyXG4gICAgICB0aGlzLmludmFsaWRhdGVQYWludCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGRpc3Bvc2UoKSB7XHJcbiAgICB0aGlzLmRpc3Bvc2VEeW5hbWljU2VyaWVzTm9kZSgpO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuLy8gQHB1YmxpYyAocmVhZC1vbmx5KVxyXG5EeW5hbWljU2VyaWVzTm9kZS5QbG90U3R5bGUgPSBQbG90U3R5bGU7XHJcblxyXG5ncmlkZGxlLnJlZ2lzdGVyKCAnRHluYW1pY1Nlcmllc05vZGUnLCBEeW5hbWljU2VyaWVzTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBEeW5hbWljU2VyaWVzTm9kZTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxrQkFBa0IsTUFBTSwwQ0FBMEM7QUFDekUsT0FBT0MscUJBQXFC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