// Copyright 2017-2023, University of Colorado Boulder

/**
 * View of a scene in the 'Basics' screen.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Dimension2 from '../../../../dot/js/Dimension2.js';
import optionize from '../../../../phet-core/js/optionize.js';
import { Node, Rectangle } from '../../../../scenery/js/imports.js';
import EqualityExplorerConstants from '../../common/EqualityExplorerConstants.js';
import EqualityExplorerQueryParameters from '../../common/EqualityExplorerQueryParameters.js';
import BalanceScaleNode from '../../common/view/BalanceScaleNode.js';
import EqualityExplorerLockNode from '../../common/view/EqualityExplorerLockNode.js';
import EqualityExplorerSceneNode from '../../common/view/EqualityExplorerSceneNode.js';
import EquationAccordionBox from '../../common/view/EquationAccordionBox.js';
import SnapshotsAccordionBox from '../../common/view/SnapshotsAccordionBox.js';
import TermsToolboxNode from '../../common/view/TermsToolboxNode.js';
import equalityExplorer from '../../equalityExplorer.js';
export default class BasicsSceneNode extends EqualityExplorerSceneNode {
  // For layout

  constructor(scene, equationAccordionBoxExpandedProperty, snapshotsAccordionBoxExpandedProperty, layoutBounds, providedOptions) {
    const options = optionize()({
      // SelfOptions
      termsToolboxContentSize: new Dimension2(250, 50),
      termsToolboxSpacing: 50,
      organizeButtonVisible: true,
      variableValuesVisibleProperty: null
    }, providedOptions);

    // locals vars to improve readability
    const scale = scene.scale;
    const leftTermCreators = scene.leftTermCreators;
    const rightTermCreators = scene.rightTermCreators;

    // terms live in this layer
    const termsLayer = new Node();
    const balanceScaleNode = new BalanceScaleNode(scale, {
      organizeButtonVisible: options.organizeButtonVisible,
      disposeTermsNotOnScale: scene.disposeTermsNotOnScale.bind(scene),
      tandem: options.tandem.createTandem('balanceScaleNode')
    });
    const toolboxNodesTandem = options.tandem.createTandem('toolboxNodes');
    const leftToolboxNode = new TermsToolboxNode(leftTermCreators, scale.leftPlate, termsLayer, {
      hasNegativeTermsInToolbox: scene.hasNegativeTermsInToolbox,
      contentSize: options.termsToolboxContentSize,
      spacing: options.termsToolboxSpacing,
      centerX: scale.leftPlate.positionProperty.value.x,
      bottom: layoutBounds.bottom - EqualityExplorerConstants.SCREEN_VIEW_Y_MARGIN,
      tandem: toolboxNodesTandem.createTandem('leftToolboxNode')
    });
    const rightToolboxNode = new TermsToolboxNode(rightTermCreators, scale.rightPlate, termsLayer, {
      hasNegativeTermsInToolbox: scene.hasNegativeTermsInToolbox,
      contentSize: options.termsToolboxContentSize,
      spacing: options.termsToolboxSpacing,
      centerX: scale.rightPlate.positionProperty.value.x,
      bottom: leftToolboxNode.bottom,
      tandem: toolboxNodesTandem.createTandem('rightToolboxNode')
    });
    const equationAccordionBox = new EquationAccordionBox(leftTermCreators, rightTermCreators, {
      fixedWidth: Math.floor(rightToolboxNode.right - leftToolboxNode.left),
      expandedProperty: equationAccordionBoxExpandedProperty,
      // Slightly off center, so that the equation's relational operator is horizontally centered
      // above the scale's arrow. The offset was determined empirically.
      centerX: scale.position.x - 15,
      top: layoutBounds.top + EqualityExplorerConstants.SCREEN_VIEW_Y_MARGIN,
      tandem: options.tandem.createTandem('equationAccordionBox')
    });
    const snapshotsAccordionBox = new SnapshotsAccordionBox(scene, {
      snapshotControlOptions: options.snapshotControlOptions,
      variableValuesVisibleProperty: options.variableValuesVisibleProperty,
      fixedWidth: Math.floor(layoutBounds.right - balanceScaleNode.right - EqualityExplorerConstants.SCREEN_VIEW_X_MARGIN - 15),
      expandedProperty: snapshotsAccordionBoxExpandedProperty,
      right: layoutBounds.right - EqualityExplorerConstants.SCREEN_VIEW_X_MARGIN,
      top: layoutBounds.top + EqualityExplorerConstants.SCREEN_VIEW_Y_MARGIN,
      tandem: options.tandem.createTandem('snapshotsAccordionBox')
    });
    const children = [balanceScaleNode, leftToolboxNode, rightToolboxNode, equationAccordionBox, snapshotsAccordionBox, termsLayer // on top, so that terms are in front of everything else
    ];

    // Some scenes support locking the left and right sides of the equation,
    // such that an action on one side results in an equivalent action on the opposite side.
    if (scene.lockedProperty && EqualityExplorerQueryParameters.lockVisible) {
      const lockNode = new EqualityExplorerLockNode(scene.lockedProperty, {
        // offsets determined empirically, so that the body of the lock appears to be centered between the toolboxes
        centerX: leftToolboxNode.right + (rightToolboxNode.left - leftToolboxNode.right) / 2,
        centerY: leftToolboxNode.centerY - 5,
        tandem: options.tandem.createTandem('lockNode')
      });
      children.unshift(lockNode); // add to beginning
    }

    // Render the drag bounds for the left and right plates
    if (phet.chipper.queryParameters.dev) {
      const dragBoundsOption = {
        stroke: 'red',
        lineWidth: 0.25
      };
      children.push(new Rectangle(scene.leftDragBounds, dragBoundsOption));
      children.push(new Rectangle(scene.rightDragBounds, dragBoundsOption));
    }
    options.children = children;
    super(scene, snapshotsAccordionBox, termsLayer, options);
    this.equationAccordionBox = equationAccordionBox;
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
}
equalityExplorer.register('BasicsSceneNode', BasicsSceneNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEaW1lbnNpb24yIiwib3B0aW9uaXplIiwiTm9kZSIsIlJlY3RhbmdsZSIsIkVxdWFsaXR5RXhwbG9yZXJDb25zdGFudHMiLCJFcXVhbGl0eUV4cGxvcmVyUXVlcnlQYXJhbWV0ZXJzIiwiQmFsYW5jZVNjYWxlTm9kZSIsIkVxdWFsaXR5RXhwbG9yZXJMb2NrTm9kZSIsIkVxdWFsaXR5RXhwbG9yZXJTY2VuZU5vZGUiLCJFcXVhdGlvbkFjY29yZGlvbkJveCIsIlNuYXBzaG90c0FjY29yZGlvbkJveCIsIlRlcm1zVG9vbGJveE5vZGUiLCJlcXVhbGl0eUV4cGxvcmVyIiwiQmFzaWNzU2NlbmVOb2RlIiwiY29uc3RydWN0b3IiLCJzY2VuZSIsImVxdWF0aW9uQWNjb3JkaW9uQm94RXhwYW5kZWRQcm9wZXJ0eSIsInNuYXBzaG90c0FjY29yZGlvbkJveEV4cGFuZGVkUHJvcGVydHkiLCJsYXlvdXRCb3VuZHMiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwidGVybXNUb29sYm94Q29udGVudFNpemUiLCJ0ZXJtc1Rvb2xib3hTcGFjaW5nIiwib3JnYW5pemVCdXR0b25WaXNpYmxlIiwidmFyaWFibGVWYWx1ZXNWaXNpYmxlUHJvcGVydHkiLCJzY2FsZSIsImxlZnRUZXJtQ3JlYXRvcnMiLCJyaWdodFRlcm1DcmVhdG9ycyIsInRlcm1zTGF5ZXIiLCJiYWxhbmNlU2NhbGVOb2RlIiwiZGlzcG9zZVRlcm1zTm90T25TY2FsZSIsImJpbmQiLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJ0b29sYm94Tm9kZXNUYW5kZW0iLCJsZWZ0VG9vbGJveE5vZGUiLCJsZWZ0UGxhdGUiLCJoYXNOZWdhdGl2ZVRlcm1zSW5Ub29sYm94IiwiY29udGVudFNpemUiLCJzcGFjaW5nIiwiY2VudGVyWCIsInBvc2l0aW9uUHJvcGVydHkiLCJ2YWx1ZSIsIngiLCJib3R0b20iLCJTQ1JFRU5fVklFV19ZX01BUkdJTiIsInJpZ2h0VG9vbGJveE5vZGUiLCJyaWdodFBsYXRlIiwiZXF1YXRpb25BY2NvcmRpb25Cb3giLCJmaXhlZFdpZHRoIiwiTWF0aCIsImZsb29yIiwicmlnaHQiLCJsZWZ0IiwiZXhwYW5kZWRQcm9wZXJ0eSIsInBvc2l0aW9uIiwidG9wIiwic25hcHNob3RzQWNjb3JkaW9uQm94Iiwic25hcHNob3RDb250cm9sT3B0aW9ucyIsIlNDUkVFTl9WSUVXX1hfTUFSR0lOIiwiY2hpbGRyZW4iLCJsb2NrZWRQcm9wZXJ0eSIsImxvY2tWaXNpYmxlIiwibG9ja05vZGUiLCJjZW50ZXJZIiwidW5zaGlmdCIsInBoZXQiLCJjaGlwcGVyIiwicXVlcnlQYXJhbWV0ZXJzIiwiZGV2IiwiZHJhZ0JvdW5kc09wdGlvbiIsInN0cm9rZSIsImxpbmVXaWR0aCIsInB1c2giLCJsZWZ0RHJhZ0JvdW5kcyIsInJpZ2h0RHJhZ0JvdW5kcyIsImRpc3Bvc2UiLCJhc3NlcnQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkJhc2ljc1NjZW5lTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNy0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBWaWV3IG9mIGEgc2NlbmUgaW4gdGhlICdCYXNpY3MnIHNjcmVlbi5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IERpbWVuc2lvbjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0RpbWVuc2lvbjIuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIFJlY3RhbmdsZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBFcXVhbGl0eUV4cGxvcmVyQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbW1vbi9FcXVhbGl0eUV4cGxvcmVyQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEVxdWFsaXR5RXhwbG9yZXJRdWVyeVBhcmFtZXRlcnMgZnJvbSAnLi4vLi4vY29tbW9uL0VxdWFsaXR5RXhwbG9yZXJRdWVyeVBhcmFtZXRlcnMuanMnO1xyXG5pbXBvcnQgQmFsYW5jZVNjYWxlTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9CYWxhbmNlU2NhbGVOb2RlLmpzJztcclxuaW1wb3J0IEVxdWFsaXR5RXhwbG9yZXJMb2NrTm9kZSBmcm9tICcuLi8uLi9jb21tb24vdmlldy9FcXVhbGl0eUV4cGxvcmVyTG9ja05vZGUuanMnO1xyXG5pbXBvcnQgRXF1YWxpdHlFeHBsb3JlclNjZW5lTm9kZSwgeyBFcXVhbGl0eUV4cGxvcmVyU2NlbmVOb2RlT3B0aW9ucyB9IGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L0VxdWFsaXR5RXhwbG9yZXJTY2VuZU5vZGUuanMnO1xyXG5pbXBvcnQgRXF1YXRpb25BY2NvcmRpb25Cb3ggZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvRXF1YXRpb25BY2NvcmRpb25Cb3guanMnO1xyXG5pbXBvcnQgU25hcHNob3RzQWNjb3JkaW9uQm94IGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L1NuYXBzaG90c0FjY29yZGlvbkJveC5qcyc7XHJcbmltcG9ydCBUZXJtc1Rvb2xib3hOb2RlIGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L1Rlcm1zVG9vbGJveE5vZGUuanMnO1xyXG5pbXBvcnQgZXF1YWxpdHlFeHBsb3JlciBmcm9tICcuLi8uLi9lcXVhbGl0eUV4cGxvcmVyLmpzJztcclxuaW1wb3J0IEJhc2ljc1NjZW5lIGZyb20gJy4uL21vZGVsL0Jhc2ljc1NjZW5lLmpzJztcclxuaW1wb3J0IHsgU25hcHNob3RDb250cm9sT3B0aW9ucyB9IGZyb20gJy4uLy4uL2NvbW1vbi92aWV3L1NuYXBzaG90Q29udHJvbC5qcyc7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIHRlcm1zVG9vbGJveENvbnRlbnRTaXplPzogRGltZW5zaW9uMjtcclxuICB0ZXJtc1Rvb2xib3hTcGFjaW5nPzogbnVtYmVyOyAvLyBzcGFjaW5nIG9mIHRlcm1zIGluIHRoZSB0b29sYm94ZXMgdGhhdCBhcHBlYXIgYmVsb3cgdGhlIHNjYWxlXHJcbiAgb3JnYW5pemVCdXR0b25WaXNpYmxlPzogYm9vbGVhbjsgLy8gaXMgdGhlIG9yZ2FuaXplIGJ1dHRvbiB2aXNpYmxlIG9uIHRoZSBzY2FsZT9cclxuXHJcbiAgLy8gd2hldGhlciB2YXJpYWJsZSB2YWx1ZXMgYXJlIHZpc2libGUgaW4gc25hcHNob3RzLCBudWxsIGlmIHRoZSBmZWF0dXJlIGlzIG5vdCBzdXBwb3J0ZWRcclxuICB2YXJpYWJsZVZhbHVlc1Zpc2libGVQcm9wZXJ0eT86IFByb3BlcnR5PGJvb2xlYW4+IHwgbnVsbDtcclxuXHJcbiAgLy8gU25hcHNob3RDb250cm9sT3B0aW9uc1xyXG4gIHNuYXBzaG90Q29udHJvbE9wdGlvbnM/OiBTdHJpY3RPbWl0PFNuYXBzaG90Q29udHJvbE9wdGlvbnMsICd0YW5kZW0nPjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEJhc2ljc1NjZW5lTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIEVxdWFsaXR5RXhwbG9yZXJTY2VuZU5vZGVPcHRpb25zO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQmFzaWNzU2NlbmVOb2RlIGV4dGVuZHMgRXF1YWxpdHlFeHBsb3JlclNjZW5lTm9kZSB7XHJcblxyXG4gIC8vIEZvciBsYXlvdXRcclxuICBwdWJsaWMgcmVhZG9ubHkgZXF1YXRpb25BY2NvcmRpb25Cb3g6IE5vZGU7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvciggc2NlbmU6IEJhc2ljc1NjZW5lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgZXF1YXRpb25BY2NvcmRpb25Cb3hFeHBhbmRlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPixcclxuICAgICAgICAgICAgICAgICAgICAgIHNuYXBzaG90c0FjY29yZGlvbkJveEV4cGFuZGVkUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgbGF5b3V0Qm91bmRzOiBCb3VuZHMyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWRPcHRpb25zOiBCYXNpY3NTY2VuZU5vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8QmFzaWNzU2NlbmVOb2RlT3B0aW9ucywgU3RyaWN0T21pdDxTZWxmT3B0aW9ucywgJ3NuYXBzaG90Q29udHJvbE9wdGlvbnMnPiwgRXF1YWxpdHlFeHBsb3JlclNjZW5lTm9kZU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNlbGZPcHRpb25zXHJcbiAgICAgIHRlcm1zVG9vbGJveENvbnRlbnRTaXplOiBuZXcgRGltZW5zaW9uMiggMjUwLCA1MCApLFxyXG4gICAgICB0ZXJtc1Rvb2xib3hTcGFjaW5nOiA1MCxcclxuICAgICAgb3JnYW5pemVCdXR0b25WaXNpYmxlOiB0cnVlLFxyXG4gICAgICB2YXJpYWJsZVZhbHVlc1Zpc2libGVQcm9wZXJ0eTogbnVsbFxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gbG9jYWxzIHZhcnMgdG8gaW1wcm92ZSByZWFkYWJpbGl0eVxyXG4gICAgY29uc3Qgc2NhbGUgPSBzY2VuZS5zY2FsZTtcclxuICAgIGNvbnN0IGxlZnRUZXJtQ3JlYXRvcnMgPSBzY2VuZS5sZWZ0VGVybUNyZWF0b3JzO1xyXG4gICAgY29uc3QgcmlnaHRUZXJtQ3JlYXRvcnMgPSBzY2VuZS5yaWdodFRlcm1DcmVhdG9ycztcclxuXHJcbiAgICAvLyB0ZXJtcyBsaXZlIGluIHRoaXMgbGF5ZXJcclxuICAgIGNvbnN0IHRlcm1zTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG5cclxuICAgIGNvbnN0IGJhbGFuY2VTY2FsZU5vZGUgPSBuZXcgQmFsYW5jZVNjYWxlTm9kZSggc2NhbGUsIHtcclxuICAgICAgb3JnYW5pemVCdXR0b25WaXNpYmxlOiBvcHRpb25zLm9yZ2FuaXplQnV0dG9uVmlzaWJsZSxcclxuICAgICAgZGlzcG9zZVRlcm1zTm90T25TY2FsZTogc2NlbmUuZGlzcG9zZVRlcm1zTm90T25TY2FsZS5iaW5kKCBzY2VuZSApLFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2JhbGFuY2VTY2FsZU5vZGUnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCB0b29sYm94Tm9kZXNUYW5kZW0gPSBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICd0b29sYm94Tm9kZXMnICk7XHJcblxyXG4gICAgY29uc3QgbGVmdFRvb2xib3hOb2RlID0gbmV3IFRlcm1zVG9vbGJveE5vZGUoIGxlZnRUZXJtQ3JlYXRvcnMsIHNjYWxlLmxlZnRQbGF0ZSwgdGVybXNMYXllciwge1xyXG4gICAgICBoYXNOZWdhdGl2ZVRlcm1zSW5Ub29sYm94OiBzY2VuZS5oYXNOZWdhdGl2ZVRlcm1zSW5Ub29sYm94LFxyXG4gICAgICBjb250ZW50U2l6ZTogb3B0aW9ucy50ZXJtc1Rvb2xib3hDb250ZW50U2l6ZSxcclxuICAgICAgc3BhY2luZzogb3B0aW9ucy50ZXJtc1Rvb2xib3hTcGFjaW5nLFxyXG4gICAgICBjZW50ZXJYOiBzY2FsZS5sZWZ0UGxhdGUucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS54LFxyXG4gICAgICBib3R0b206IGxheW91dEJvdW5kcy5ib3R0b20gLSBFcXVhbGl0eUV4cGxvcmVyQ29uc3RhbnRzLlNDUkVFTl9WSUVXX1lfTUFSR0lOLFxyXG4gICAgICB0YW5kZW06IHRvb2xib3hOb2Rlc1RhbmRlbS5jcmVhdGVUYW5kZW0oICdsZWZ0VG9vbGJveE5vZGUnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCByaWdodFRvb2xib3hOb2RlID0gbmV3IFRlcm1zVG9vbGJveE5vZGUoIHJpZ2h0VGVybUNyZWF0b3JzLCBzY2FsZS5yaWdodFBsYXRlLCB0ZXJtc0xheWVyLCB7XHJcbiAgICAgIGhhc05lZ2F0aXZlVGVybXNJblRvb2xib3g6IHNjZW5lLmhhc05lZ2F0aXZlVGVybXNJblRvb2xib3gsXHJcbiAgICAgIGNvbnRlbnRTaXplOiBvcHRpb25zLnRlcm1zVG9vbGJveENvbnRlbnRTaXplLFxyXG4gICAgICBzcGFjaW5nOiBvcHRpb25zLnRlcm1zVG9vbGJveFNwYWNpbmcsXHJcbiAgICAgIGNlbnRlclg6IHNjYWxlLnJpZ2h0UGxhdGUucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS54LFxyXG4gICAgICBib3R0b206IGxlZnRUb29sYm94Tm9kZS5ib3R0b20sXHJcbiAgICAgIHRhbmRlbTogdG9vbGJveE5vZGVzVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3JpZ2h0VG9vbGJveE5vZGUnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBlcXVhdGlvbkFjY29yZGlvbkJveCA9IG5ldyBFcXVhdGlvbkFjY29yZGlvbkJveCggbGVmdFRlcm1DcmVhdG9ycywgcmlnaHRUZXJtQ3JlYXRvcnMsIHtcclxuICAgICAgZml4ZWRXaWR0aDogTWF0aC5mbG9vciggcmlnaHRUb29sYm94Tm9kZS5yaWdodCAtIGxlZnRUb29sYm94Tm9kZS5sZWZ0ICksXHJcbiAgICAgIGV4cGFuZGVkUHJvcGVydHk6IGVxdWF0aW9uQWNjb3JkaW9uQm94RXhwYW5kZWRQcm9wZXJ0eSxcclxuXHJcbiAgICAgIC8vIFNsaWdodGx5IG9mZiBjZW50ZXIsIHNvIHRoYXQgdGhlIGVxdWF0aW9uJ3MgcmVsYXRpb25hbCBvcGVyYXRvciBpcyBob3Jpem9udGFsbHkgY2VudGVyZWRcclxuICAgICAgLy8gYWJvdmUgdGhlIHNjYWxlJ3MgYXJyb3cuIFRoZSBvZmZzZXQgd2FzIGRldGVybWluZWQgZW1waXJpY2FsbHkuXHJcbiAgICAgIGNlbnRlclg6IHNjYWxlLnBvc2l0aW9uLnggLSAxNSxcclxuICAgICAgdG9wOiBsYXlvdXRCb3VuZHMudG9wICsgRXF1YWxpdHlFeHBsb3JlckNvbnN0YW50cy5TQ1JFRU5fVklFV19ZX01BUkdJTixcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdlcXVhdGlvbkFjY29yZGlvbkJveCcgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IHNuYXBzaG90c0FjY29yZGlvbkJveCA9IG5ldyBTbmFwc2hvdHNBY2NvcmRpb25Cb3goIHNjZW5lLCB7XHJcbiAgICAgIHNuYXBzaG90Q29udHJvbE9wdGlvbnM6IG9wdGlvbnMuc25hcHNob3RDb250cm9sT3B0aW9ucyxcclxuICAgICAgdmFyaWFibGVWYWx1ZXNWaXNpYmxlUHJvcGVydHk6IG9wdGlvbnMudmFyaWFibGVWYWx1ZXNWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgIGZpeGVkV2lkdGg6IE1hdGguZmxvb3IoICggbGF5b3V0Qm91bmRzLnJpZ2h0IC0gYmFsYW5jZVNjYWxlTm9kZS5yaWdodCApIC1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXF1YWxpdHlFeHBsb3JlckNvbnN0YW50cy5TQ1JFRU5fVklFV19YX01BUkdJTiAtIDE1ICksXHJcbiAgICAgIGV4cGFuZGVkUHJvcGVydHk6IHNuYXBzaG90c0FjY29yZGlvbkJveEV4cGFuZGVkUHJvcGVydHksXHJcbiAgICAgIHJpZ2h0OiBsYXlvdXRCb3VuZHMucmlnaHQgLSBFcXVhbGl0eUV4cGxvcmVyQ29uc3RhbnRzLlNDUkVFTl9WSUVXX1hfTUFSR0lOLFxyXG4gICAgICB0b3A6IGxheW91dEJvdW5kcy50b3AgKyBFcXVhbGl0eUV4cGxvcmVyQ29uc3RhbnRzLlNDUkVFTl9WSUVXX1lfTUFSR0lOLFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3NuYXBzaG90c0FjY29yZGlvbkJveCcgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IGNoaWxkcmVuID0gW1xyXG4gICAgICBiYWxhbmNlU2NhbGVOb2RlLFxyXG4gICAgICBsZWZ0VG9vbGJveE5vZGUsXHJcbiAgICAgIHJpZ2h0VG9vbGJveE5vZGUsXHJcbiAgICAgIGVxdWF0aW9uQWNjb3JkaW9uQm94LFxyXG4gICAgICBzbmFwc2hvdHNBY2NvcmRpb25Cb3gsXHJcbiAgICAgIHRlcm1zTGF5ZXIgLy8gb24gdG9wLCBzbyB0aGF0IHRlcm1zIGFyZSBpbiBmcm9udCBvZiBldmVyeXRoaW5nIGVsc2VcclxuICAgIF07XHJcblxyXG4gICAgLy8gU29tZSBzY2VuZXMgc3VwcG9ydCBsb2NraW5nIHRoZSBsZWZ0IGFuZCByaWdodCBzaWRlcyBvZiB0aGUgZXF1YXRpb24sXHJcbiAgICAvLyBzdWNoIHRoYXQgYW4gYWN0aW9uIG9uIG9uZSBzaWRlIHJlc3VsdHMgaW4gYW4gZXF1aXZhbGVudCBhY3Rpb24gb24gdGhlIG9wcG9zaXRlIHNpZGUuXHJcbiAgICBpZiAoIHNjZW5lLmxvY2tlZFByb3BlcnR5ICYmIEVxdWFsaXR5RXhwbG9yZXJRdWVyeVBhcmFtZXRlcnMubG9ja1Zpc2libGUgKSB7XHJcbiAgICAgIGNvbnN0IGxvY2tOb2RlID0gbmV3IEVxdWFsaXR5RXhwbG9yZXJMb2NrTm9kZSggc2NlbmUubG9ja2VkUHJvcGVydHksIHtcclxuXHJcbiAgICAgICAgLy8gb2Zmc2V0cyBkZXRlcm1pbmVkIGVtcGlyaWNhbGx5LCBzbyB0aGF0IHRoZSBib2R5IG9mIHRoZSBsb2NrIGFwcGVhcnMgdG8gYmUgY2VudGVyZWQgYmV0d2VlbiB0aGUgdG9vbGJveGVzXHJcbiAgICAgICAgY2VudGVyWDogbGVmdFRvb2xib3hOb2RlLnJpZ2h0ICsgKCByaWdodFRvb2xib3hOb2RlLmxlZnQgLSBsZWZ0VG9vbGJveE5vZGUucmlnaHQgKSAvIDIsXHJcbiAgICAgICAgY2VudGVyWTogbGVmdFRvb2xib3hOb2RlLmNlbnRlclkgLSA1LFxyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnbG9ja05vZGUnIClcclxuICAgICAgfSApO1xyXG4gICAgICBjaGlsZHJlbi51bnNoaWZ0KCBsb2NrTm9kZSApOyAvLyBhZGQgdG8gYmVnaW5uaW5nXHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmVuZGVyIHRoZSBkcmFnIGJvdW5kcyBmb3IgdGhlIGxlZnQgYW5kIHJpZ2h0IHBsYXRlc1xyXG4gICAgaWYgKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLmRldiApIHtcclxuICAgICAgY29uc3QgZHJhZ0JvdW5kc09wdGlvbiA9IHsgc3Ryb2tlOiAncmVkJywgbGluZVdpZHRoOiAwLjI1IH07XHJcbiAgICAgIGNoaWxkcmVuLnB1c2goIG5ldyBSZWN0YW5nbGUoIHNjZW5lLmxlZnREcmFnQm91bmRzLCBkcmFnQm91bmRzT3B0aW9uICkgKTtcclxuICAgICAgY2hpbGRyZW4ucHVzaCggbmV3IFJlY3RhbmdsZSggc2NlbmUucmlnaHREcmFnQm91bmRzLCBkcmFnQm91bmRzT3B0aW9uICkgKTtcclxuICAgIH1cclxuXHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gY2hpbGRyZW47XHJcblxyXG4gICAgc3VwZXIoIHNjZW5lLCBzbmFwc2hvdHNBY2NvcmRpb25Cb3gsIHRlcm1zTGF5ZXIsIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLmVxdWF0aW9uQWNjb3JkaW9uQm94ID0gZXF1YXRpb25BY2NvcmRpb25Cb3g7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuZXF1YWxpdHlFeHBsb3Jlci5yZWdpc3RlciggJ0Jhc2ljc1NjZW5lTm9kZScsIEJhc2ljc1NjZW5lTm9kZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFJQSxPQUFPQSxVQUFVLE1BQU0sa0NBQWtDO0FBQ3pELE9BQU9DLFNBQVMsTUFBTSx1Q0FBdUM7QUFFN0QsU0FBU0MsSUFBSSxFQUFFQyxTQUFTLFFBQVEsbUNBQW1DO0FBQ25FLE9BQU9DLHlCQUF5QixNQUFNLDJDQUEyQztBQUNqRixPQUFPQywrQkFBK0IsTUFBTSxpREFBaUQ7QUFDN0YsT0FBT0MsZ0JBQWdCLE1BQU0sdUNBQXVDO0FBQ3BFLE9BQU9DLHdCQUF3QixNQUFNLCtDQUErQztBQUNwRixPQUFPQyx5QkFBeUIsTUFBNEMsZ0RBQWdEO0FBQzVILE9BQU9DLG9CQUFvQixNQUFNLDJDQUEyQztBQUM1RSxPQUFPQyxxQkFBcUIsTUFBTSw0Q0FBNEM7QUFDOUUsT0FBT0MsZ0JBQWdCLE1BQU0sdUNBQXVDO0FBQ3BFLE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQWtCeEQsZUFBZSxNQUFNQyxlQUFlLFNBQVNMLHlCQUF5QixDQUFDO0VBRXJFOztFQUdPTSxXQUFXQSxDQUFFQyxLQUFrQixFQUNsQkMsb0NBQXVELEVBQ3ZEQyxxQ0FBd0QsRUFDeERDLFlBQXFCLEVBQ3JCQyxlQUF1QyxFQUFHO0lBRTVELE1BQU1DLE9BQU8sR0FBR25CLFNBQVMsQ0FBOEcsQ0FBQyxDQUFFO01BRXhJO01BQ0FvQix1QkFBdUIsRUFBRSxJQUFJckIsVUFBVSxDQUFFLEdBQUcsRUFBRSxFQUFHLENBQUM7TUFDbERzQixtQkFBbUIsRUFBRSxFQUFFO01BQ3ZCQyxxQkFBcUIsRUFBRSxJQUFJO01BQzNCQyw2QkFBNkIsRUFBRTtJQUNqQyxDQUFDLEVBQUVMLGVBQWdCLENBQUM7O0lBRXBCO0lBQ0EsTUFBTU0sS0FBSyxHQUFHVixLQUFLLENBQUNVLEtBQUs7SUFDekIsTUFB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