// Copyright 2017-2022, University of Colorado Boulder

/**
 * Term is the abstract base type for all terms.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import Emitter from '../../../../axon/js/Emitter.js';
import optionize, { combineOptions } from '../../../../phet-core/js/optionize.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import equalityExplorer from '../../equalityExplorer.js';
import EqualityExplorerConstants from '../EqualityExplorerConstants.js';
import EqualityExplorerQueryParameters from '../EqualityExplorerQueryParameters.js';
import EqualityExplorerMovable from './EqualityExplorerMovable.js';
export default class Term extends EqualityExplorerMovable {
  // The value that is significant for the purposes of determining sign and maxInteger limits.
  // The value that is significant is specific to the Term subclass.

  // Sign of the term's significant number, ala Math.sign (which TypeScript types as number).
  // Note that sign is not related to the term's weight. For example, for variable terms, the 'significant number'
  // is the coefficient. Consider term '-5x', where x=-2. While the weight is 10 (-5 * -2), the sign is based on
  // the coefficient -5, and is therefore -1.
  // diameter of the term in the view, convenient to store in the model
  // position of this term's corresponding TermCreatorNode in the toolbox
  // whether the term is pickable (interactive)
  // whether the term is on a plate
  // whether the term's shadow is visible
  // whether the term's halo is visible
  // emits when dispose has completed
  /**
   * @param significantValue - significant for the purposes of determining sign and maxInteger limits
   * @param [providedOptions]
   */
  constructor(significantValue, providedOptions) {
    assert && assert(significantValue.isReduced(), `significantValue must be reduced: ${significantValue}`);
    const options = optionize()({
      // SelfOptions
      diameter: EqualityExplorerConstants.SMALL_TERM_DIAMETER,
      pickable: true,
      toolboxPosition: null,
      // EqualityExplorerMovableOptions
      tandem: Tandem.OPTIONAL //TODO https://github.com/phetsims/equality-explorer/issues/200 delete when tandem is required by EqualityExplorerMovableOptions
    }, providedOptions);
    super(options);
    this.significantValue = significantValue;
    this.sign = Math.sign(significantValue.getValue());
    this.diameter = options.diameter;
    this.toolboxPosition = options.toolboxPosition;
    this.pickableProperty = new BooleanProperty(options.pickable, {
      tandem: options.tandem.createTandem('pickableProperty')
    });
    this.onPlateProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('onPlateProperty')
    });
    this.shadowVisibleProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('shadowVisibleProperty')
    });
    this.haloVisibleProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('haloVisibleProperty')
    });
    this.disposedEmitter = new Emitter({
      parameters: [{
        valueType: Term
      }]
    });
  }
  dispose() {
    this.pickableProperty.dispose();
    this.onPlateProperty.dispose();
    this.shadowVisibleProperty.dispose();
    this.haloVisibleProperty.dispose();
    super.dispose();

    // Do this last, after fully disposed. Order is important!
    this.disposedEmitter.emit(this);
    this.disposedEmitter.dispose();
  }

  /**
   * Creates the options that would be needed to instantiate a copy of this object.
   * This is used by subclasses that implement copy.
   */
  copyOptions() {
    return combineOptions({}, super.copyOptions(), {
      diameter: this.diameter,
      pickable: this.pickableProperty.value,
      toolboxPosition: this.toolboxPosition
    });
  }

  /**
   * Is this term the inverse of a specified term?
   * Inverse terms are like terms whose significant value has opposite signs. E.g. x and -x, 1 and -1.
   */
  isInverseTerm(term) {
    return this.isLikeTerm(term) && this.significantValue.plus(term.significantValue).getValue() === 0;
  }

  /**
   * Is this term equivalent to a specified term?
   * Equivalent terms are like terms with the same significant value.
   */
  isEquivalentTerm(term) {
    return this.isLikeTerm(term) && this.significantValue.reduced().equals(term.significantValue.reduced());
  }

  /**
   * Does this term have a numerator or denominator who absolute value exceeds the maxInteger limit?
   * See EqualityExplorerQueryParameters.maxInteger and https://github.com/phetsims/equality-explorer/issues/48
   */
  maxIntegerExceeded() {
    return Math.abs(this.significantValue.numerator) > EqualityExplorerQueryParameters.maxInteger || Math.abs(this.significantValue.denominator) > EqualityExplorerQueryParameters.maxInteger;
  }

  /**
   * Gets the Variable associated with this term. Term subclasses that do not have an associated variable
   * should return null. This method makes it more convenient to use the same drag listeners for all term types.
   */

  /**
   * Creates a copy of this term, with modifications through options.
   */

  /**
   * Gets the weight of this term.
   */

  /**
   * Are this term and the specified term 'like terms'?
   * If you're not familiar with 'like terms', see https://en.wikipedia.org/wiki/Like_terms.
   */

  /**
   * Applies an operation to this term, resulting in a new term.
   * Returns null if the operation is not applicable to this term.
   */

  /**
   * Adds a term to this term to create a new term.
   */

  /**
   * Subtracts a term from this term to create a new term.
   */

  /**
   * Subclasses must implement this method to provide 'useful information', to appease
   * TS ESLint rule @typescript-eslint/no-base-to-string. See https://github.com/phetsims/chipper/issues/1338
   */
}

equalityExplorer.register('Term', Term);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJFbWl0dGVyIiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJUYW5kZW0iLCJlcXVhbGl0eUV4cGxvcmVyIiwiRXF1YWxpdHlFeHBsb3JlckNvbnN0YW50cyIsIkVxdWFsaXR5RXhwbG9yZXJRdWVyeVBhcmFtZXRlcnMiLCJFcXVhbGl0eUV4cGxvcmVyTW92YWJsZSIsIlRlcm0iLCJjb25zdHJ1Y3RvciIsInNpZ25pZmljYW50VmFsdWUiLCJwcm92aWRlZE9wdGlvbnMiLCJhc3NlcnQiLCJpc1JlZHVjZWQiLCJvcHRpb25zIiwiZGlhbWV0ZXIiLCJTTUFMTF9URVJNX0RJQU1FVEVSIiwicGlja2FibGUiLCJ0b29sYm94UG9zaXRpb24iLCJ0YW5kZW0iLCJPUFRJT05BTCIsInNpZ24iLCJNYXRoIiwiZ2V0VmFsdWUiLCJwaWNrYWJsZVByb3BlcnR5IiwiY3JlYXRlVGFuZGVtIiwib25QbGF0ZVByb3BlcnR5Iiwic2hhZG93VmlzaWJsZVByb3BlcnR5IiwiaGFsb1Zpc2libGVQcm9wZXJ0eSIsImRpc3Bvc2VkRW1pdHRlciIsInBhcmFtZXRlcnMiLCJ2YWx1ZVR5cGUiLCJkaXNwb3NlIiwiZW1pdCIsImNvcHlPcHRpb25zIiwidmFsdWUiLCJpc0ludmVyc2VUZXJtIiwidGVybSIsImlzTGlrZVRlcm0iLCJwbHVzIiwiaXNFcXVpdmFsZW50VGVybSIsInJlZHVjZWQiLCJlcXVhbHMiLCJtYXhJbnRlZ2VyRXhjZWVkZWQiLCJhYnMiLCJudW1lcmF0b3IiLCJtYXhJbnRlZ2VyIiwiZGVub21pbmF0b3IiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlRlcm0udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTctMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGVybSBpcyB0aGUgYWJzdHJhY3QgYmFzZSB0eXBlIGZvciBhbGwgdGVybXMuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBFbWl0dGVyIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRW1pdHRlci5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBGcmFjdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL21vZGVsL0ZyYWN0aW9uLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IGVxdWFsaXR5RXhwbG9yZXIgZnJvbSAnLi4vLi4vZXF1YWxpdHlFeHBsb3Jlci5qcyc7XHJcbmltcG9ydCBFcXVhbGl0eUV4cGxvcmVyQ29uc3RhbnRzIGZyb20gJy4uL0VxdWFsaXR5RXhwbG9yZXJDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgRXF1YWxpdHlFeHBsb3JlclF1ZXJ5UGFyYW1ldGVycyBmcm9tICcuLi9FcXVhbGl0eUV4cGxvcmVyUXVlcnlQYXJhbWV0ZXJzLmpzJztcclxuaW1wb3J0IEVxdWFsaXR5RXhwbG9yZXJNb3ZhYmxlLCB7IEVxdWFsaXR5RXhwbG9yZXJNb3ZhYmxlT3B0aW9ucyB9IGZyb20gJy4vRXF1YWxpdHlFeHBsb3Jlck1vdmFibGUuanMnO1xyXG5pbXBvcnQgVW5pdmVyc2FsT3BlcmF0aW9uIGZyb20gJy4vVW5pdmVyc2FsT3BlcmF0aW9uLmpzJztcclxuaW1wb3J0IFZhcmlhYmxlIGZyb20gJy4vVmFyaWFibGUuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gVGVybXMgYXJlIGFzc3VtZWQgdG8gaGF2ZSBhIDE6MSBhc3BlY3QgcmF0aW8sIHNvIHRoYXQgdGhlIHN0YWNrIG5pY2VseSBvbiB0aGUgcGxhdGVzLlxyXG4gIC8vIERpYW1ldGVyIGlzIHVzZWQgdG8gc2l6ZSB0aGUgYXNzb2NpYXRlZCBUZXJtTm9kZS5cclxuICBkaWFtZXRlcj86IG51bWJlcjtcclxuICBcclxuICAvLyBXaGV0aGVyIHRoZSB0ZXJtIGlzIHBpY2thYmxlIChpbnRlcmFjdGl2ZSkuXHJcbiAgcGlja2FibGU/OiBib29sZWFuO1xyXG5cclxuICAvLyBQb3NpdGlvbiBvZiB0aGUgYXNzb2NpYXRlZCBUZXJtQ3JlYXRvck5vZGUgaW4gdGhlIHRvb2xib3gsIHNvIHRoYXQgd2UgY2FuIGFuaW1hdGUgYmFjayB0byB0aGUgdG9vbGJveFxyXG4gIHRvb2xib3hQb3NpdGlvbj86IFZlY3RvcjIgfCBudWxsO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgVGVybU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIEVxdWFsaXR5RXhwbG9yZXJNb3ZhYmxlT3B0aW9ucztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFic3RyYWN0IGNsYXNzIFRlcm0gZXh0ZW5kcyBFcXVhbGl0eUV4cGxvcmVyTW92YWJsZSB7XHJcblxyXG4gIC8vIFRoZSB2YWx1ZSB0aGF0IGlzIHNpZ25pZmljYW50IGZvciB0aGUgcHVycG9zZXMgb2YgZGV0ZXJtaW5pbmcgc2lnbiBhbmQgbWF4SW50ZWdlciBsaW1pdHMuXHJcbiAgLy8gVGhlIHZhbHVlIHRoYXQgaXMgc2lnbmlmaWNhbnQgaXMgc3BlY2lmaWMgdG8gdGhlIFRlcm0gc3ViY2xhc3MuXHJcbiAgcHVibGljIHJlYWRvbmx5IHNpZ25pZmljYW50VmFsdWU6IEZyYWN0aW9uO1xyXG5cclxuICAvLyBTaWduIG9mIHRoZSB0ZXJtJ3Mgc2lnbmlmaWNhbnQgbnVtYmVyLCBhbGEgTWF0aC5zaWduICh3aGljaCBUeXBlU2NyaXB0IHR5cGVzIGFzIG51bWJlcikuXHJcbiAgLy8gTm90ZSB0aGF0IHNpZ24gaXMgbm90IHJlbGF0ZWQgdG8gdGhlIHRlcm0ncyB3ZWlnaHQuIEZvciBleGFtcGxlLCBmb3IgdmFyaWFibGUgdGVybXMsIHRoZSAnc2lnbmlmaWNhbnQgbnVtYmVyJ1xyXG4gIC8vIGlzIHRoZSBjb2VmZmljaWVudC4gQ29uc2lkZXIgdGVybSAnLTV4Jywgd2hlcmUgeD0tMi4gV2hpbGUgdGhlIHdlaWdodCBpcyAxMCAoLTUgKiAtMiksIHRoZSBzaWduIGlzIGJhc2VkIG9uXHJcbiAgLy8gdGhlIGNvZWZmaWNpZW50IC01LCBhbmQgaXMgdGhlcmVmb3JlIC0xLlxyXG4gIHB1YmxpYyByZWFkb25seSBzaWduOiBudW1iZXI7XHJcblxyXG4gIC8vIGRpYW1ldGVyIG9mIHRoZSB0ZXJtIGluIHRoZSB2aWV3LCBjb252ZW5pZW50IHRvIHN0b3JlIGluIHRoZSBtb2RlbFxyXG4gIHB1YmxpYyByZWFkb25seSBkaWFtZXRlcjogbnVtYmVyO1xyXG5cclxuICAvLyBwb3NpdGlvbiBvZiB0aGlzIHRlcm0ncyBjb3JyZXNwb25kaW5nIFRlcm1DcmVhdG9yTm9kZSBpbiB0aGUgdG9vbGJveFxyXG4gIHB1YmxpYyB0b29sYm94UG9zaXRpb246IFZlY3RvcjIgfCBudWxsO1xyXG5cclxuICAvLyB3aGV0aGVyIHRoZSB0ZXJtIGlzIHBpY2thYmxlIChpbnRlcmFjdGl2ZSlcclxuICBwdWJsaWMgcmVhZG9ubHkgcGlja2FibGVQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIHdoZXRoZXIgdGhlIHRlcm0gaXMgb24gYSBwbGF0ZVxyXG4gIHB1YmxpYyByZWFkb25seSBvblBsYXRlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyB3aGV0aGVyIHRoZSB0ZXJtJ3Mgc2hhZG93IGlzIHZpc2libGVcclxuICBwdWJsaWMgcmVhZG9ubHkgc2hhZG93VmlzaWJsZVByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gd2hldGhlciB0aGUgdGVybSdzIGhhbG8gaXMgdmlzaWJsZVxyXG4gIHB1YmxpYyByZWFkb25seSBoYWxvVmlzaWJsZVByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuXHJcbiAgLy8gZW1pdHMgd2hlbiBkaXNwb3NlIGhhcyBjb21wbGV0ZWRcclxuICBwdWJsaWMgcmVhZG9ubHkgZGlzcG9zZWRFbWl0dGVyOiBFbWl0dGVyPFsgVGVybSBdPjtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHNpZ25pZmljYW50VmFsdWUgLSBzaWduaWZpY2FudCBmb3IgdGhlIHB1cnBvc2VzIG9mIGRldGVybWluaW5nIHNpZ24gYW5kIG1heEludGVnZXIgbGltaXRzXHJcbiAgICogQHBhcmFtIFtwcm92aWRlZE9wdGlvbnNdXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKCBzaWduaWZpY2FudFZhbHVlOiBGcmFjdGlvbiwgcHJvdmlkZWRPcHRpb25zPzogVGVybU9wdGlvbnMgKSB7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggc2lnbmlmaWNhbnRWYWx1ZS5pc1JlZHVjZWQoKSwgYHNpZ25pZmljYW50VmFsdWUgbXVzdCBiZSByZWR1Y2VkOiAke3NpZ25pZmljYW50VmFsdWV9YCApO1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8VGVybU9wdGlvbnMsIFNlbGZPcHRpb25zLCBFcXVhbGl0eUV4cGxvcmVyTW92YWJsZU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNlbGZPcHRpb25zXHJcbiAgICAgIGRpYW1ldGVyOiBFcXVhbGl0eUV4cGxvcmVyQ29uc3RhbnRzLlNNQUxMX1RFUk1fRElBTUVURVIsXHJcbiAgICAgIHBpY2thYmxlOiB0cnVlLFxyXG4gICAgICB0b29sYm94UG9zaXRpb246IG51bGwsXHJcblxyXG4gICAgICAvLyBFcXVhbGl0eUV4cGxvcmVyTW92YWJsZU9wdGlvbnNcclxuICAgICAgdGFuZGVtOiBUYW5kZW0uT1BUSU9OQUwgLy9UT0RPIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9lcXVhbGl0eS1leHBsb3Jlci9pc3N1ZXMvMjAwIGRlbGV0ZSB3aGVuIHRhbmRlbSBpcyByZXF1aXJlZCBieSBFcXVhbGl0eUV4cGxvcmVyTW92YWJsZU9wdGlvbnNcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5zaWduaWZpY2FudFZhbHVlID0gc2lnbmlmaWNhbnRWYWx1ZTtcclxuICAgIHRoaXMuc2lnbiA9IE1hdGguc2lnbiggc2lnbmlmaWNhbnRWYWx1ZS5nZXRWYWx1ZSgpICk7XHJcbiAgICB0aGlzLmRpYW1ldGVyID0gb3B0aW9ucy5kaWFtZXRlcjtcclxuICAgIHRoaXMudG9vbGJveFBvc2l0aW9uID0gb3B0aW9ucy50b29sYm94UG9zaXRpb247XHJcbiAgICBcclxuICAgIHRoaXMucGlja2FibGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIG9wdGlvbnMucGlja2FibGUsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdwaWNrYWJsZVByb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcbiAgICBcclxuICAgIHRoaXMub25QbGF0ZVByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdvblBsYXRlUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuICAgIFxyXG4gICAgdGhpcy5zaGFkb3dWaXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3NoYWRvd1Zpc2libGVQcm9wZXJ0eScgKVxyXG4gICAgfSApO1xyXG4gICAgXHJcbiAgICB0aGlzLmhhbG9WaXNpYmxlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2hhbG9WaXNpYmxlUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VkRW1pdHRlciA9IG5ldyBFbWl0dGVyKCB7XHJcbiAgICAgIHBhcmFtZXRlcnM6IFsgeyB2YWx1ZVR5cGU6IFRlcm0gfSBdXHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuXHJcbiAgICB0aGlzLnBpY2thYmxlUHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgdGhpcy5vblBsYXRlUHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgdGhpcy5zaGFkb3dWaXNpYmxlUHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgdGhpcy5oYWxvVmlzaWJsZVByb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuXHJcbiAgICAvLyBEbyB0aGlzIGxhc3QsIGFmdGVyIGZ1bGx5IGRpc3Bvc2VkLiBPcmRlciBpcyBpbXBvcnRhbnQhXHJcbiAgICB0aGlzLmRpc3Bvc2VkRW1pdHRlci5lbWl0KCB0aGlzICk7XHJcbiAgICB0aGlzLmRpc3Bvc2VkRW1pdHRlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIHRoZSBvcHRpb25zIHRoYXQgd291bGQgYmUgbmVlZGVkIHRvIGluc3RhbnRpYXRlIGEgY29weSBvZiB0aGlzIG9iamVjdC5cclxuICAgKiBUaGlzIGlzIHVzZWQgYnkgc3ViY2xhc3NlcyB0aGF0IGltcGxlbWVudCBjb3B5LlxyXG4gICAqL1xyXG4gIHB1YmxpYyBvdmVycmlkZSBjb3B5T3B0aW9ucygpOiBUZXJtT3B0aW9ucyB7XHJcbiAgICByZXR1cm4gY29tYmluZU9wdGlvbnM8VGVybU9wdGlvbnM+KCB7fSwgc3VwZXIuY29weU9wdGlvbnMoKSwge1xyXG4gICAgICBkaWFtZXRlcjogdGhpcy5kaWFtZXRlcixcclxuICAgICAgcGlja2FibGU6IHRoaXMucGlja2FibGVQcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgdG9vbGJveFBvc2l0aW9uOiB0aGlzLnRvb2xib3hQb3NpdGlvblxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSXMgdGhpcyB0ZXJtIHRoZSBpbnZlcnNlIG9mIGEgc3BlY2lmaWVkIHRlcm0/XHJcbiAgICogSW52ZXJzZSB0ZXJtcyBhcmUgbGlrZSB0ZXJtcyB3aG9zZSBzaWduaWZpY2FudCB2YWx1ZSBoYXMgb3Bwb3NpdGUgc2lnbnMuIEUuZy4geCBhbmQgLXgsIDEgYW5kIC0xLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBpc0ludmVyc2VUZXJtKCB0ZXJtOiBUZXJtICk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuICggdGhpcy5pc0xpa2VUZXJtKCB0ZXJtICkgJiYgKCB0aGlzLnNpZ25pZmljYW50VmFsdWUucGx1cyggdGVybS5zaWduaWZpY2FudFZhbHVlICkuZ2V0VmFsdWUoKSA9PT0gMCApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJcyB0aGlzIHRlcm0gZXF1aXZhbGVudCB0byBhIHNwZWNpZmllZCB0ZXJtP1xyXG4gICAqIEVxdWl2YWxlbnQgdGVybXMgYXJlIGxpa2UgdGVybXMgd2l0aCB0aGUgc2FtZSBzaWduaWZpY2FudCB2YWx1ZS5cclxuICAgKi9cclxuICBwdWJsaWMgaXNFcXVpdmFsZW50VGVybSggdGVybTogVGVybSApOiBib29sZWFuIHtcclxuICAgIHJldHVybiAoIHRoaXMuaXNMaWtlVGVybSggdGVybSApICYmIHRoaXMuc2lnbmlmaWNhbnRWYWx1ZS5yZWR1Y2VkKCkuZXF1YWxzKCB0ZXJtLnNpZ25pZmljYW50VmFsdWUucmVkdWNlZCgpICkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERvZXMgdGhpcyB0ZXJtIGhhdmUgYSBudW1lcmF0b3Igb3IgZGVub21pbmF0b3Igd2hvIGFic29sdXRlIHZhbHVlIGV4Y2VlZHMgdGhlIG1heEludGVnZXIgbGltaXQ/XHJcbiAgICogU2VlIEVxdWFsaXR5RXhwbG9yZXJRdWVyeVBhcmFtZXRlcnMubWF4SW50ZWdlciBhbmQgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2VxdWFsaXR5LWV4cGxvcmVyL2lzc3Vlcy80OFxyXG4gICAqL1xyXG4gIHB1YmxpYyBtYXhJbnRlZ2VyRXhjZWVkZWQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKCBNYXRoLmFicyggdGhpcy5zaWduaWZpY2FudFZhbHVlLm51bWVyYXRvciApID4gRXF1YWxpdHlFeHBsb3JlclF1ZXJ5UGFyYW1ldGVycy5tYXhJbnRlZ2VyIHx8XHJcbiAgICAgICAgICAgICBNYXRoLmFicyggdGhpcy5zaWduaWZpY2FudFZhbHVlLmRlbm9taW5hdG9yICkgPiBFcXVhbGl0eUV4cGxvcmVyUXVlcnlQYXJhbWV0ZXJzLm1heEludGVnZXIgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIFZhcmlhYmxlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHRlcm0uIFRlcm0gc3ViY2xhc3NlcyB0aGF0IGRvIG5vdCBoYXZlIGFuIGFzc29jaWF0ZWQgdmFyaWFibGVcclxuICAgKiBzaG91bGQgcmV0dXJuIG51bGwuIFRoaXMgbWV0aG9kIG1ha2VzIGl0IG1vcmUgY29udmVuaWVudCB0byB1c2UgdGhlIHNhbWUgZHJhZyBsaXN0ZW5lcnMgZm9yIGFsbCB0ZXJtIHR5cGVzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBhYnN0cmFjdCBnZXRWYXJpYWJsZSgpOiBWYXJpYWJsZSB8IG51bGw7XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBjb3B5IG9mIHRoaXMgdGVybSwgd2l0aCBtb2RpZmljYXRpb25zIHRocm91Z2ggb3B0aW9ucy5cclxuICAgKi9cclxuICBwdWJsaWMgYWJzdHJhY3QgY29weSggcHJvdmlkZWRPcHRpb25zPzogVGVybU9wdGlvbnMgKTogVGVybTtcclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyB0aGUgd2VpZ2h0IG9mIHRoaXMgdGVybS5cclxuICAgKi9cclxuICBwdWJsaWMgYWJzdHJhY3QgZ2V0IHdlaWdodCgpOiBGcmFjdGlvbjtcclxuXHJcbiAgLyoqXHJcbiAgICogQXJlIHRoaXMgdGVybSBhbmQgdGhlIHNwZWNpZmllZCB0ZXJtICdsaWtlIHRlcm1zJz9cclxuICAgKiBJZiB5b3UncmUgbm90IGZhbWlsaWFyIHdpdGggJ2xpa2UgdGVybXMnLCBzZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlrZV90ZXJtcy5cclxuICAgKi9cclxuICBwdWJsaWMgYWJzdHJhY3QgaXNMaWtlVGVybSggdGVybTogVGVybSApOiBib29sZWFuO1xyXG5cclxuICAvKipcclxuICAgKiBBcHBsaWVzIGFuIG9wZXJhdGlvbiB0byB0aGlzIHRlcm0sIHJlc3VsdGluZyBpbiBhIG5ldyB0ZXJtLlxyXG4gICAqIFJldHVybnMgbnVsbCBpZiB0aGUgb3BlcmF0aW9uIGlzIG5vdCBhcHBsaWNhYmxlIHRvIHRoaXMgdGVybS5cclxuICAgKi9cclxuICBwdWJsaWMgYWJzdHJhY3QgYXBwbHlPcGVyYXRpb24oIG9wZXJhdGlvbjogVW5pdmVyc2FsT3BlcmF0aW9uICk6IFRlcm0gfCBudWxsO1xyXG5cclxuICAvKipcclxuICAgKiBBZGRzIGEgdGVybSB0byB0aGlzIHRlcm0gdG8gY3JlYXRlIGEgbmV3IHRlcm0uXHJcbiAgICovXHJcbiAgcHVibGljIGFic3RyYWN0IHBsdXMoIHRlcm06IFRlcm0gKTogVGVybTtcclxuXHJcbiAgLyoqXHJcbiAgICogU3VidHJhY3RzIGEgdGVybSBmcm9tIHRoaXMgdGVybSB0byBjcmVhdGUgYSBuZXcgdGVybS5cclxuICAgKi9cclxuICBwdWJsaWMgYWJzdHJhY3QgbWludXMoIHRlcm06IFRlcm0gKTogVGVybTtcclxuXHJcbiAgLyoqXHJcbiAgICogU3ViY2xhc3NlcyBtdXN0IGltcGxlbWVudCB0aGlzIG1ldGhvZCB0byBwcm92aWRlICd1c2VmdWwgaW5mb3JtYXRpb24nLCB0byBhcHBlYXNlXHJcbiAgICogVFMgRVNMaW50IHJ1bGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWJhc2UtdG8tc3RyaW5nLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NoaXBwZXIvaXNzdWVzLzEzMzhcclxuICAgKi9cclxuICBwdWJsaWMgYWJzdHJhY3Qgb3ZlcnJpZGUgdG9TdHJpbmcoKTogc3RyaW5nO1xyXG59XHJcblxyXG5lcXVhbGl0eUV4cGxvcmVyLnJlZ2lzdGVyKCAnVGVybScsIFRlcm0gKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxPQUFPLE1BQU0sZ0NBQWdDO0FBR3BELE9BQU9DLFNBQVMsSUFBSUMsY0FBYyxRQUFRLHVDQUF1QztBQUVqRixPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBQ3BELE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQUN4RCxPQUFPQyx5QkFBeUIsTUFBTSxpQ0FBaUM7QUFDdkUsT0FBT0MsK0JBQStCLE1BQU0sdUNBQXVDO0FBQ25GLE9BQU9DLHVCQUF1QixNQUEwQyw4QkFBOEI7QUFtQnRHLGVBQWUsTUFBZUMsSUFBSSxTQUFTRCx1QkFBdUIsQ0FBQztFQUVqRTtFQUNBOztFQUdBO0VBQ0E7RUFDQTtFQUNBO0VBR0E7RUFHQTtFQUdBO0VBR0E7RUFHQTtFQUdBO0VBR0E7RUFHQTtBQUNGO0FBQ0E7QUFDQTtFQUNZRSxXQUFXQSxDQUFFQyxnQkFBMEIsRUFBRUMsZUFBNkIsRUFBRztJQUVqRkMsTUFBTSxJQUFJQSxNQUFNLENBQUVGLGdCQUFnQixDQUFDRyxTQUFTLENBQUMsQ0FBQyxFQUFHLHFDQUFvQ0gsZ0JBQWlCLEVBQUUs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