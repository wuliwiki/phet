// Copyright 2017-2022, University of Colorado Boulder

/**
 * EqualityExplorerSceneNode is the base class for displaying scenes in Equality Explorer.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import { Node } from '../../../../scenery/js/imports.js';
import equalityExplorer from '../../equalityExplorer.js';
import OopsDialog from '../../../../scenery-phet/js/OopsDialog.js';
import EqualityExplorerStrings from '../../EqualityExplorerStrings.js';
import Tandem from '../../../../tandem/js/Tandem.js';
const dialogsTandem = Tandem.GLOBAL_VIEW.createTandem('dialogs');
export default class EqualityExplorerSceneNode extends Node {
  // for layout
  // terms live in this layer

  // This dialog displays a message when an operation or interaction would result in EqualityExplorer.maxInteger
  // being exceeded. Instantiation of this dialog must be deferred because phet.joist.sim must exist before any dialog
  // can be created. We are re-using a single instance of this dialog because it is modal, and to avoid using PhetioCapsule.
  // See https://github.com/phetsims/equality-explorer/issues/196.
  // To test this dialog:
  // 1. Run the sim with ?maxInteger=1
  // 2. Go to the Operations screen
  // 3. Press the yellow 'go' (arrow) button twice
  // 4. The dialog is displayed.
  // These dialogs display a message when an inverse term cannot be created because the opposite plate is full.
  // The dialog must be instantiated on demand because phet.joist.sim must exist before any dialog can be created.
  // We are re-using a single instance of this dialog because it is modal, and to avoid using PhetioCapsule.
  // See https://github.com/phetsims/equality-explorer/issues/196
  // To test these dialogs:
  // 1. Run the sim with ?rows=1&columns=1&showGrid
  // 1. Go to the Numbers or Variables screen
  // 2. Put a '1' on a plate.
  // 3. Put a '-1' on the opposite plate.
  // 4. Turn the lock on.
  // 5. Attempt to drag the '1' off the plate.
  // 6. The drag is cancelled, and a dialog is displayed indicating "Left side of the balance is full" or
  //    "Right side of the balance is full", depending on which plate is full.
  constructor(scene, snapshotsAccordionBox, termsLayer, providedOptions) {
    super(providedOptions);
    this.scene = scene;
    this.snapshotsAccordionBox = snapshotsAccordionBox;
    this.termsLayer = termsLayer;
    if (!EqualityExplorerSceneNode.numberTooBigDialog) {
      EqualityExplorerSceneNode.numberTooBigDialog = new OopsDialog(EqualityExplorerStrings.numberTooBigStringProperty, {
        focusOnHideNode: null,
        tandem: dialogsTandem.createTandem('numberTooBigDialog'),
        phetioDocumentation: 'Displayed when an interaction or operation would result in a number that is too big for the sim'
      });
    }
    if (!EqualityExplorerSceneNode.leftSideFullDialog) {
      EqualityExplorerSceneNode.leftSideFullDialog = new OopsDialog(EqualityExplorerStrings.leftSideFullStringProperty, {
        focusOnHideNode: null,
        tandem: dialogsTandem.createTandem('leftSideFullDialog'),
        phetioDocumentation: 'Displayed when an inverse term cannot be created because the left side of the balance scale is full'
      });
    }
    if (!EqualityExplorerSceneNode.rightSideFullDialog) {
      EqualityExplorerSceneNode.rightSideFullDialog = new OopsDialog(EqualityExplorerStrings.rightSideFullStringProperty, {
        focusOnHideNode: null,
        tandem: dialogsTandem.createTandem('rightSideFullDialog'),
        phetioDocumentation: 'Displayed when an inverse term cannot be created because the right side of the balance scale is full'
      });
    }

    /**
     * When a term is created in the model, create the corresponding view.
     * Event is non-null when the term was created via a user interaction.
     */
    const termCreatedListener = (termCreator, term, event) => {
      // create a TermNode
      const termNode = termCreator.createTermNode(term); //TODO https://github.com/phetsims/equality-explorer/issues/200 dynamic
      termsLayer.addChild(termNode);

      // Clean up when the term is disposed. Term.dispose handles removal of this listener.
      term.disposedEmitter.addListener(term => termNode.dispose());

      // start a drag cycle by forwarding the event to termNode.
      if (event) {
        termNode.startDrag(event);
      }
    };

    // When the maxInteger limit is exceeded, dispose of all terms that are not on the scale, and display a dialog.
    // To test this, see doc for EqualityExplorerSceneNode.numberTooBigDialog.
    const maxIntegerExceededListener = () => {
      phet.log && phet.log('maxInteger exceeded');
      scene.disposeTermsNotOnScale();
      EqualityExplorerSceneNode.numberTooBigDialog.show();
    };
    scene.allTermCreators.forEach(termCreator => {
      termCreator.termCreatedEmitter.addListener(termCreatedListener);
      termCreator.maxIntegerExceededEmitter.addListener(maxIntegerExceededListener);
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
  step(dt) {
    // the default behavior is to do nothing
  }
  reset() {
    // the default behavior is to do nothing
  }
}
equalityExplorer.register('EqualityExplorerSceneNode', EqualityExplorerSceneNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOb2RlIiwiZXF1YWxpdHlFeHBsb3JlciIsIk9vcHNEaWFsb2ciLCJFcXVhbGl0eUV4cGxvcmVyU3RyaW5ncyIsIlRhbmRlbSIsImRpYWxvZ3NUYW5kZW0iLCJHTE9CQUxfVklFVyIsImNyZWF0ZVRhbmRlbSIsIkVxdWFsaXR5RXhwbG9yZXJTY2VuZU5vZGUiLCJjb25zdHJ1Y3RvciIsInNjZW5lIiwic25hcHNob3RzQWNjb3JkaW9uQm94IiwidGVybXNMYXllciIsInByb3ZpZGVkT3B0aW9ucyIsIm51bWJlclRvb0JpZ0RpYWxvZyIsIm51bWJlclRvb0JpZ1N0cmluZ1Byb3BlcnR5IiwiZm9jdXNPbkhpZGVOb2RlIiwidGFuZGVtIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsImxlZnRTaWRlRnVsbERpYWxvZyIsImxlZnRTaWRlRnVsbFN0cmluZ1Byb3BlcnR5IiwicmlnaHRTaWRlRnVsbERpYWxvZyIsInJpZ2h0U2lkZUZ1bGxTdHJpbmdQcm9wZXJ0eSIsInRlcm1DcmVhdGVkTGlzdGVuZXIiLCJ0ZXJtQ3JlYXRvciIsInRlcm0iLCJldmVudCIsInRlcm1Ob2RlIiwiY3JlYXRlVGVybU5vZGUiLCJhZGRDaGlsZCIsImRpc3Bvc2VkRW1pdHRlciIsImFkZExpc3RlbmVyIiwiZGlzcG9zZSIsInN0YXJ0RHJhZyIsIm1heEludGVnZXJFeGNlZWRlZExpc3RlbmVyIiwicGhldCIsImxvZyIsImRpc3Bvc2VUZXJtc05vdE9uU2NhbGUiLCJzaG93IiwiYWxsVGVybUNyZWF0b3JzIiwiZm9yRWFjaCIsInRlcm1DcmVhdGVkRW1pdHRlciIsIm1heEludGVnZXJFeGNlZWRlZEVtaXR0ZXIiLCJhc3NlcnQiLCJzdGVwIiwiZHQiLCJyZXNldCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRXF1YWxpdHlFeHBsb3JlclNjZW5lTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNy0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBFcXVhbGl0eUV4cGxvcmVyU2NlbmVOb2RlIGlzIHRoZSBiYXNlIGNsYXNzIGZvciBkaXNwbGF5aW5nIHNjZW5lcyBpbiBFcXVhbGl0eSBFeHBsb3Jlci5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIE5vZGVPcHRpb25zLCBQcmVzc0xpc3RlbmVyRXZlbnQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZXF1YWxpdHlFeHBsb3JlciBmcm9tICcuLi8uLi9lcXVhbGl0eUV4cGxvcmVyLmpzJztcclxuaW1wb3J0IEVxdWFsaXR5RXhwbG9yZXJTY2VuZSBmcm9tICcuLi9tb2RlbC9FcXVhbGl0eUV4cGxvcmVyU2NlbmUuanMnO1xyXG5pbXBvcnQgVGVybUNyZWF0b3IgZnJvbSAnLi4vbW9kZWwvVGVybUNyZWF0b3IuanMnO1xyXG5pbXBvcnQgVGVybSBmcm9tICcuLi9tb2RlbC9UZXJtLmpzJztcclxuaW1wb3J0IFBpY2tPcHRpb25hbCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja09wdGlvbmFsLmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuaW1wb3J0IE9vcHNEaWFsb2cgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL09vcHNEaWFsb2cuanMnO1xyXG5pbXBvcnQgRXF1YWxpdHlFeHBsb3JlclN0cmluZ3MgZnJvbSAnLi4vLi4vRXF1YWxpdHlFeHBsb3JlclN0cmluZ3MuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5cclxuY29uc3QgZGlhbG9nc1RhbmRlbSA9IFRhbmRlbS5HTE9CQUxfVklFVy5jcmVhdGVUYW5kZW0oICdkaWFsb2dzJyApO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IEVtcHR5U2VsZk9wdGlvbnM7XHJcblxyXG5leHBvcnQgdHlwZSBFcXVhbGl0eUV4cGxvcmVyU2NlbmVOb2RlT3B0aW9ucyA9IFNlbGZPcHRpb25zICZcclxuICBQaWNrT3B0aW9uYWw8Tm9kZU9wdGlvbnMsICdjaGlsZHJlbicgfCAndmlzaWJsZVByb3BlcnR5JyB8ICdwaGV0aW9WaXNpYmxlUHJvcGVydHlJbnN0cnVtZW50ZWQnPiAmXHJcbiAgUGlja1JlcXVpcmVkPE5vZGVPcHRpb25zLCAndGFuZGVtJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFcXVhbGl0eUV4cGxvcmVyU2NlbmVOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSBzY2VuZTogRXF1YWxpdHlFeHBsb3JlclNjZW5lO1xyXG4gIHB1YmxpYyByZWFkb25seSBzbmFwc2hvdHNBY2NvcmRpb25Cb3g6IE5vZGU7IC8vIGZvciBsYXlvdXRcclxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgdGVybXNMYXllcjogTm9kZTsgLy8gdGVybXMgbGl2ZSBpbiB0aGlzIGxheWVyXHJcblxyXG4gIC8vIFRoaXMgZGlhbG9nIGRpc3BsYXlzIGEgbWVzc2FnZSB3aGVuIGFuIG9wZXJhdGlvbiBvciBpbnRlcmFjdGlvbiB3b3VsZCByZXN1bHQgaW4gRXF1YWxpdHlFeHBsb3Jlci5tYXhJbnRlZ2VyXHJcbiAgLy8gYmVpbmcgZXhjZWVkZWQuIEluc3RhbnRpYXRpb24gb2YgdGhpcyBkaWFsb2cgbXVzdCBiZSBkZWZlcnJlZCBiZWNhdXNlIHBoZXQuam9pc3Quc2ltIG11c3QgZXhpc3QgYmVmb3JlIGFueSBkaWFsb2dcclxuICAvLyBjYW4gYmUgY3JlYXRlZC4gV2UgYXJlIHJlLXVzaW5nIGEgc2luZ2xlIGluc3RhbmNlIG9mIHRoaXMgZGlhbG9nIGJlY2F1c2UgaXQgaXMgbW9kYWwsIGFuZCB0byBhdm9pZCB1c2luZyBQaGV0aW9DYXBzdWxlLlxyXG4gIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZXF1YWxpdHktZXhwbG9yZXIvaXNzdWVzLzE5Ni5cclxuICAvLyBUbyB0ZXN0IHRoaXMgZGlhbG9nOlxyXG4gIC8vIDEuIFJ1biB0aGUgc2ltIHdpdGggP21heEludGVnZXI9MVxyXG4gIC8vIDIuIEdvIHRvIHRoZSBPcGVyYXRpb25zIHNjcmVlblxyXG4gIC8vIDMuIFByZXNzIHRoZSB5ZWxsb3cgJ2dvJyAoYXJyb3cpIGJ1dHRvbiB0d2ljZVxyXG4gIC8vIDQuIFRoZSBkaWFsb2cgaXMgZGlzcGxheWVkLlxyXG4gIHByaXZhdGUgc3RhdGljIG51bWJlclRvb0JpZ0RpYWxvZzogT29wc0RpYWxvZztcclxuXHJcbiAgLy8gVGhlc2UgZGlhbG9ncyBkaXNwbGF5IGEgbWVzc2FnZSB3aGVuIGFuIGludmVyc2UgdGVybSBjYW5ub3QgYmUgY3JlYXRlZCBiZWNhdXNlIHRoZSBvcHBvc2l0ZSBwbGF0ZSBpcyBmdWxsLlxyXG4gIC8vIFRoZSBkaWFsb2cgbXVzdCBiZSBpbnN0YW50aWF0ZWQgb24gZGVtYW5kIGJlY2F1c2UgcGhldC5qb2lzdC5zaW0gbXVzdCBleGlzdCBiZWZvcmUgYW55IGRpYWxvZyBjYW4gYmUgY3JlYXRlZC5cclxuICAvLyBXZSBhcmUgcmUtdXNpbmcgYSBzaW5nbGUgaW5zdGFuY2Ugb2YgdGhpcyBkaWFsb2cgYmVjYXVzZSBpdCBpcyBtb2RhbCwgYW5kIHRvIGF2b2lkIHVzaW5nIFBoZXRpb0NhcHN1bGUuXHJcbiAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9lcXVhbGl0eS1leHBsb3Jlci9pc3N1ZXMvMTk2XHJcbiAgLy8gVG8gdGVzdCB0aGVzZSBkaWFsb2dzOlxyXG4gIC8vIDEuIFJ1biB0aGUgc2ltIHdpdGggP3Jvd3M9MSZjb2x1bW5zPTEmc2hvd0dyaWRcclxuICAvLyAxLiBHbyB0byB0aGUgTnVtYmVycyBvciBWYXJpYWJsZXMgc2NyZWVuXHJcbiAgLy8gMi4gUHV0IGEgJzEnIG9uIGEgcGxhdGUuXHJcbiAgLy8gMy4gUHV0IGEgJy0xJyBvbiB0aGUgb3Bwb3NpdGUgcGxhdGUuXHJcbiAgLy8gNC4gVHVybiB0aGUgbG9jayBvbi5cclxuICAvLyA1LiBBdHRlbXB0IHRvIGRyYWcgdGhlICcxJyBvZmYgdGhlIHBsYXRlLlxyXG4gIC8vIDYuIFRoZSBkcmFnIGlzIGNhbmNlbGxlZCwgYW5kIGEgZGlhbG9nIGlzIGRpc3BsYXllZCBpbmRpY2F0aW5nIFwiTGVmdCBzaWRlIG9mIHRoZSBiYWxhbmNlIGlzIGZ1bGxcIiBvclxyXG4gIC8vICAgIFwiUmlnaHQgc2lkZSBvZiB0aGUgYmFsYW5jZSBpcyBmdWxsXCIsIGRlcGVuZGluZyBvbiB3aGljaCBwbGF0ZSBpcyBmdWxsLlxyXG4gIHB1YmxpYyBzdGF0aWMgbGVmdFNpZGVGdWxsRGlhbG9nOiBPb3BzRGlhbG9nO1xyXG4gIHB1YmxpYyBzdGF0aWMgcmlnaHRTaWRlRnVsbERpYWxvZzogT29wc0RpYWxvZztcclxuXHJcbiAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKCBzY2VuZTogRXF1YWxpdHlFeHBsb3JlclNjZW5lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgc25hcHNob3RzQWNjb3JkaW9uQm94OiBOb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgdGVybXNMYXllcjogTm9kZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVkT3B0aW9uczogRXF1YWxpdHlFeHBsb3JlclNjZW5lTm9kZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgc3VwZXIoIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuc2NlbmUgPSBzY2VuZTtcclxuICAgIHRoaXMuc25hcHNob3RzQWNjb3JkaW9uQm94ID0gc25hcHNob3RzQWNjb3JkaW9uQm94O1xyXG4gICAgdGhpcy50ZXJtc0xheWVyID0gdGVybXNMYXllcjtcclxuXHJcbiAgICBpZiAoICFFcXVhbGl0eUV4cGxvcmVyU2NlbmVOb2RlLm51bWJlclRvb0JpZ0RpYWxvZyApIHtcclxuICAgICAgRXF1YWxpdHlFeHBsb3JlclNjZW5lTm9kZS5udW1iZXJUb29CaWdEaWFsb2cgPSBuZXcgT29wc0RpYWxvZyggRXF1YWxpdHlFeHBsb3JlclN0cmluZ3MubnVtYmVyVG9vQmlnU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgICBmb2N1c09uSGlkZU5vZGU6IG51bGwsXHJcbiAgICAgICAgdGFuZGVtOiBkaWFsb2dzVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ251bWJlclRvb0JpZ0RpYWxvZycgKSxcclxuICAgICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnRGlzcGxheWVkIHdoZW4gYW4gaW50ZXJhY3Rpb24gb3Igb3BlcmF0aW9uIHdvdWxkIHJlc3VsdCBpbiBhIG51bWJlciB0aGF0IGlzIHRvbyBiaWcgZm9yIHRoZSBzaW0nXHJcbiAgICAgIH0gKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoICFFcXVhbGl0eUV4cGxvcmVyU2NlbmVOb2RlLmxlZnRTaWRlRnVsbERpYWxvZyApIHtcclxuICAgICAgRXF1YWxpdHlFeHBsb3JlclNjZW5lTm9kZS5sZWZ0U2lkZUZ1bGxEaWFsb2cgPSBuZXcgT29wc0RpYWxvZyggRXF1YWxpdHlFeHBsb3JlclN0cmluZ3MubGVmdFNpZGVGdWxsU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgICBmb2N1c09uSGlkZU5vZGU6IG51bGwsXHJcbiAgICAgICAgdGFuZGVtOiBkaWFsb2dzVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xlZnRTaWRlRnVsbERpYWxvZycgKSxcclxuICAgICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnRGlzcGxheWVkIHdoZW4gYW4gaW52ZXJzZSB0ZXJtIGNhbm5vdCBiZSBjcmVhdGVkIGJlY2F1c2UgdGhlIGxlZnQgc2lkZSBvZiB0aGUgYmFsYW5jZSBzY2FsZSBpcyBmdWxsJ1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCAhRXF1YWxpdHlFeHBsb3JlclNjZW5lTm9kZS5yaWdodFNpZGVGdWxsRGlhbG9nICkge1xyXG4gICAgICBFcXVhbGl0eUV4cGxvcmVyU2NlbmVOb2RlLnJpZ2h0U2lkZUZ1bGxEaWFsb2cgPSBuZXcgT29wc0RpYWxvZyggRXF1YWxpdHlFeHBsb3JlclN0cmluZ3MucmlnaHRTaWRlRnVsbFN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgICAgZm9jdXNPbkhpZGVOb2RlOiBudWxsLFxyXG4gICAgICAgIHRhbmRlbTogZGlhbG9nc1RhbmRlbS5jcmVhdGVUYW5kZW0oICdyaWdodFNpZGVGdWxsRGlhbG9nJyApLFxyXG4gICAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdEaXNwbGF5ZWQgd2hlbiBhbiBpbnZlcnNlIHRlcm0gY2Fubm90IGJlIGNyZWF0ZWQgYmVjYXVzZSB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgYmFsYW5jZSBzY2FsZSBpcyBmdWxsJ1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBXaGVuIGEgdGVybSBpcyBjcmVhdGVkIGluIHRoZSBtb2RlbCwgY3JlYXRlIHRoZSBjb3JyZXNwb25kaW5nIHZpZXcuXHJcbiAgICAgKiBFdmVudCBpcyBub24tbnVsbCB3aGVuIHRoZSB0ZXJtIHdhcyBjcmVhdGVkIHZpYSBhIHVzZXIgaW50ZXJhY3Rpb24uXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IHRlcm1DcmVhdGVkTGlzdGVuZXIgPSAoIHRlcm1DcmVhdG9yOiBUZXJtQ3JlYXRvciwgdGVybTogVGVybSwgZXZlbnQ6IFByZXNzTGlzdGVuZXJFdmVudCB8IG51bGwgKSA9PiB7XHJcblxyXG4gICAgICAvLyBjcmVhdGUgYSBUZXJtTm9kZVxyXG4gICAgICBjb25zdCB0ZXJtTm9kZSA9IHRlcm1DcmVhdG9yLmNyZWF0ZVRlcm1Ob2RlKCB0ZXJtICk7IC8vVE9ETyBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZXF1YWxpdHktZXhwbG9yZXIvaXNzdWVzLzIwMCBkeW5hbWljXHJcbiAgICAgIHRlcm1zTGF5ZXIuYWRkQ2hpbGQoIHRlcm1Ob2RlICk7XHJcblxyXG4gICAgICAvLyBDbGVhbiB1cCB3aGVuIHRoZSB0ZXJtIGlzIGRpc3Bvc2VkLiBUZXJtLmRpc3Bvc2UgaGFuZGxlcyByZW1vdmFsIG9mIHRoaXMgbGlzdGVuZXIuXHJcbiAgICAgIHRlcm0uZGlzcG9zZWRFbWl0dGVyLmFkZExpc3RlbmVyKCB0ZXJtID0+IHRlcm1Ob2RlLmRpc3Bvc2UoKSApO1xyXG5cclxuICAgICAgLy8gc3RhcnQgYSBkcmFnIGN5Y2xlIGJ5IGZvcndhcmRpbmcgdGhlIGV2ZW50IHRvIHRlcm1Ob2RlLlxyXG4gICAgICBpZiAoIGV2ZW50ICkge1xyXG4gICAgICAgIHRlcm1Ob2RlLnN0YXJ0RHJhZyggZXZlbnQgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBXaGVuIHRoZSBtYXhJbnRlZ2VyIGxpbWl0IGlzIGV4Y2VlZGVkLCBkaXNwb3NlIG9mIGFsbCB0ZXJtcyB0aGF0IGFyZSBub3Qgb24gdGhlIHNjYWxlLCBhbmQgZGlzcGxheSBhIGRpYWxvZy5cclxuICAgIC8vIFRvIHRlc3QgdGhpcywgc2VlIGRvYyBmb3IgRXF1YWxpdHlFeHBsb3JlclNjZW5lTm9kZS5udW1iZXJUb29CaWdEaWFsb2cuXHJcbiAgICBjb25zdCBtYXhJbnRlZ2VyRXhjZWVkZWRMaXN0ZW5lciA9ICgpID0+IHtcclxuICAgICAgcGhldC5sb2cgJiYgcGhldC5sb2coICdtYXhJbnRlZ2VyIGV4Y2VlZGVkJyApO1xyXG4gICAgICBzY2VuZS5kaXNwb3NlVGVybXNOb3RPblNjYWxlKCk7XHJcbiAgICAgIEVxdWFsaXR5RXhwbG9yZXJTY2VuZU5vZGUubnVtYmVyVG9vQmlnRGlhbG9nLnNob3coKTtcclxuICAgIH07XHJcblxyXG4gICAgc2NlbmUuYWxsVGVybUNyZWF0b3JzLmZvckVhY2goIHRlcm1DcmVhdG9yID0+IHtcclxuICAgICAgdGVybUNyZWF0b3IudGVybUNyZWF0ZWRFbWl0dGVyLmFkZExpc3RlbmVyKCB0ZXJtQ3JlYXRlZExpc3RlbmVyICk7XHJcbiAgICAgIHRlcm1DcmVhdG9yLm1heEludGVnZXJFeGNlZWRlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIG1heEludGVnZXJFeGNlZWRlZExpc3RlbmVyICk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0ZXAoIGR0OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICAvLyB0aGUgZGVmYXVsdCBiZWhhdmlvciBpcyB0byBkbyBub3RoaW5nXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICAvLyB0aGUgZGVmYXVsdCBiZWhhdmlvciBpcyB0byBkbyBub3RoaW5nXHJcbiAgfVxyXG59XHJcblxyXG5cclxuZXF1YWxpdHlFeHBsb3Jlci5yZWdpc3RlciggJ0VxdWFsaXR5RXhwbG9yZXJTY2VuZU5vZGUnLCBFcXVhbGl0eUV4cGxvcmVyU2NlbmVOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLFNBQVNBLElBQUksUUFBeUMsbUNBQW1DO0FBQ3pGLE9BQU9DLGdCQUFnQixNQUFNLDJCQUEyQjtBQU14RCxPQUFPQyxVQUFVLE1BQU0sMkNBQTJDO0FBQ2xFLE9BQU9DLHVCQUF1QixNQUFNLGtDQUFrQztBQUN0RSxPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBRXBELE1BQU1DLGFBQWEsR0FBR0QsTUFBTSxDQUFDRSxXQUFXLENBQUNDLFlBQVksQ0FB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