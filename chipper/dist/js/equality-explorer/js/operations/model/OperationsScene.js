// Copyright 2017-2023, University of Colorado Boulder

/**
 * The sole scene in the 'Operations' screen.
 * This scene has variable and constant terms on both sides of the equation.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Emitter from '../../../../axon/js/Emitter.js';
import Property from '../../../../axon/js/Property.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import optionize from '../../../../phet-core/js/optionize.js';
import Fraction from '../../../../phetcommon/js/model/Fraction.js';
import EqualityExplorerConstants from '../../common/EqualityExplorerConstants.js';
import ConstantTerm from '../../common/model/ConstantTerm.js';
import ConstantTermCreator from '../../common/model/ConstantTermCreator.js';
import EqualityExplorerScene from '../../common/model/EqualityExplorerScene.js';
import Snapshot from '../../common/model/Snapshot.js';
import TermCreator from '../../common/model/TermCreator.js';
import UniversalOperation from '../../common/model/UniversalOperation.js';
import Variable from '../../common/model/Variable.js';
import VariableTerm from '../../common/model/VariableTerm.js';
import VariableTermCreator from '../../common/model/VariableTermCreator.js';
import equalityExplorer from '../../equalityExplorer.js';
import EqualityExplorerStrings from '../../EqualityExplorerStrings.js';
import UniversalOperator from '../../common/model/UniversalOperator.js';
import EnumerationProperty from '../../../../axon/js/EnumerationProperty.js';

// constants
const OPERAND_RANGE = EqualityExplorerConstants.OPERAND_RANGE;
const ICON_SIZE = new Dimension2(EqualityExplorerConstants.BIG_TERM_DIAMETER + 10, EqualityExplorerConstants.BIG_TERM_DIAMETER);
export default class OperationsScene extends EqualityExplorerScene {
  // emits when one or more terms become zero as the result of a universal operation

  // emits is called when a universal operation has completed.

  // operands that appear in the operand picker. These are the only Terms that are not created and managed by a TermCreator.

  constructor(providedOptions) {
    const options = optionize()({
      // SelfOptions
      variableRange: EqualityExplorerConstants.VARIABLE_RANGE,
      // EqualityExplorerSceneOptions
      gridRows: 1,
      gridColumns: 2,
      iconSize: ICON_SIZE // {Dimension2} size of terms icons on the scale
    }, providedOptions);
    const variablesTandem = options.tandem.createTandem('variables');
    const x = new Variable(EqualityExplorerStrings.xStringProperty, {
      range: options.variableRange,
      tandem: variablesTandem.createTandem('x')
    });
    options.variables = [x];
    const createLeftTermCreators = (lockedProperty, tandem) => createTermCreators(x, lockedProperty, tandem);
    const createRightTermCreators = (lockedProperty, tandem) => createTermCreators(x, lockedProperty, tandem);
    super(createLeftTermCreators, createRightTermCreators, options);
    this.x = x;
    this.sumToZeroEmitter = new Emitter({
      parameters: [{
        // {TermCreator[]}
        isValidValue: array => Array.isArray(array) && _.every(array, value => value instanceof TermCreator)
      }]
    });
    this.operators = UniversalOperator.enumeration.values;
    this.operatorProperty = new EnumerationProperty(this.operators[0], {
      validValues: this.operators,
      hasListenerOrderDependencies: true // TODO: https://github.com/phetsims/equality-explorer/issues/205
    });

    this.operands = [];
    for (let i = OPERAND_RANGE.min; i <= OPERAND_RANGE.max; i++) {
      const constantTermOperand = new ConstantTerm({
        constantValue: Fraction.fromInteger(i)
      });
      if (i === 0) {
        // skip variable term with zero coefficient
        this.operands.push(constantTermOperand);
      } else {
        const variableTermOperand = new VariableTerm(this.x, {
          coefficient: Fraction.fromInteger(i)
        });
        if (i < 0) {
          // for negative numbers, put the variable term before the constant term
          // e.g. ... -2x, -2, -x, -1
          this.operands.push(variableTermOperand);
          this.operands.push(constantTermOperand);
        } else {
          // for positive numbers, put the variable term before the constant term
          // e.g. 1, x, 2, 2x, ...
          this.operands.push(constantTermOperand);
          this.operands.push(variableTermOperand);
        }
      }
    }

    // Start with operand 1
    const defaultOperand = _.find(this.operands, operand => operand instanceof ConstantTerm && operand.constantValue.getValue() === 1);
    assert && assert(defaultOperand, 'oops, the default was not found');
    this.operandProperty = new Property(defaultOperand, {
      validValues: this.operands
    });
    this.operationCompletedEmitter = new Emitter({
      parameters: [{
        valueType: UniversalOperation
      }]
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
  reset() {
    this.x.reset();
    this.operatorProperty.reset();
    this.operandProperty.reset();
    super.reset();
  }

  /**
   * Applies a universal operation.
   */
  applyOperation(operation) {
    // Take a snapshot of terms on the scale, so we can undo the operation if necessary.
    const snapshot = new Snapshot(this); //TODO https://github.com/phetsims/equality-explorer/issues/200 dynamic

    // TermCreators whose terms summed to zero as the result of applying this operation.
    const termCreatorsZero = [];

    // Apply the operation to each TermCreator
    this.allTermCreators.forEach(termCreator => {
      const summedToZero = termCreator.applyOperation(operation);
      if (summedToZero) {
        termCreatorsZero.push(termCreator);
      }
    });

    // If any term exceeds maxInteger as the result of applying the operation ...
    const termCreator = this.findMaxIntegerExceeded();
    if (termCreator) {
      // Notify listeners and undo the operation by restoring the snapshot.
      termCreator.maxIntegerExceededEmitter.emit();
      snapshot.restore();
    } else {
      // Tell the view which terms summed to zero.
      // Do this after the operation has been fully applied, so that sum-to-zero animations
      // appear in the cells at the scale's final position, not at the position before the
      // operation was applied, or at some intermediate position as the operation is being applied.
      if (termCreatorsZero.length > 0) {
        this.sumToZeroEmitter.emit(termCreatorsZero);
      }

      // notify listeners that the operation successfully completed
      this.operationCompletedEmitter.emit(operation);
    }
  }

  /**
   * Finds the first TermCreator that has a Term that exceeds the maxInteger limit.
   */
  findMaxIntegerExceeded() {
    const termCreator = _.find(this.allTermCreators, termCreator => {
      // Get the term on the plate
      const term = termCreator.getLikeTermOnPlate();

      // Does the term exceed the limit?
      return term !== null && term.maxIntegerExceeded();
    });
    return termCreator || null;
  }
}

/**
 * Creates the term creators for this scene.
 */
function createTermCreators(x, lockedProperty, parentTandem) {
  // Variable and constant terms will be combined in specific cells in the plate's grid.
  // This is the cell in the grid that all like terms will occupy.
  let likeTermsCell = 0;
  return [
  // x & -x
  new VariableTermCreator(x, {
    likeTermsCell: likeTermsCell++,
    lockedProperty: lockedProperty,
    tandem: parentTandem.createTandem('xTermCreator')
  }),
  // 1 & -1
  new ConstantTermCreator({
    likeTermsCell: likeTermsCell++,
    lockedProperty: lockedProperty,
    tandem: parentTandem.createTandem('constantTermCreator')
  })];
}
equalityExplorer.register('OperationsScene', OperationsScene);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFbWl0dGVyIiwiUHJvcGVydHkiLCJEaW1lbnNpb24yIiwib3B0aW9uaXplIiwiRnJhY3Rpb24iLCJFcXVhbGl0eUV4cGxvcmVyQ29uc3RhbnRzIiwiQ29uc3RhbnRUZXJtIiwiQ29uc3RhbnRUZXJtQ3JlYXRvciIsIkVxdWFsaXR5RXhwbG9yZXJTY2VuZSIsIlNuYXBzaG90IiwiVGVybUNyZWF0b3IiLCJVbml2ZXJzYWxPcGVyYXRpb24iLCJWYXJpYWJsZSIsIlZhcmlhYmxlVGVybSIsIlZhcmlhYmxlVGVybUNyZWF0b3IiLCJlcXVhbGl0eUV4cGxvcmVyIiwiRXF1YWxpdHlFeHBsb3JlclN0cmluZ3MiLCJVbml2ZXJzYWxPcGVyYXRvciIsIkVudW1lcmF0aW9uUHJvcGVydHkiLCJPUEVSQU5EX1JBTkdFIiwiSUNPTl9TSVpFIiwiQklHX1RFUk1fRElBTUVURVIiLCJPcGVyYXRpb25zU2NlbmUiLCJjb25zdHJ1Y3RvciIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ2YXJpYWJsZVJhbmdlIiwiVkFSSUFCTEVfUkFOR0UiLCJncmlkUm93cyIsImdyaWRDb2x1bW5zIiwiaWNvblNpemUiLCJ2YXJpYWJsZXNUYW5kZW0iLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJ4IiwieFN0cmluZ1Byb3BlcnR5IiwicmFuZ2UiLCJ2YXJpYWJsZXMiLCJjcmVhdGVMZWZ0VGVybUNyZWF0b3JzIiwibG9ja2VkUHJvcGVydHkiLCJjcmVhdGVUZXJtQ3JlYXRvcnMiLCJjcmVhdGVSaWdodFRlcm1DcmVhdG9ycyIsInN1bVRvWmVyb0VtaXR0ZXIiLCJwYXJhbWV0ZXJzIiwiaXNWYWxpZFZhbHVlIiwiYXJyYXkiLCJBcnJheSIsImlzQXJyYXkiLCJfIiwiZXZlcnkiLCJ2YWx1ZSIsIm9wZXJhdG9ycyIsImVudW1lcmF0aW9uIiwidmFsdWVzIiwib3BlcmF0b3JQcm9wZXJ0eSIsInZhbGlkVmFsdWVzIiwiaGFzTGlzdGVuZXJPcmRlckRlcGVuZGVuY2llcyIsIm9wZXJhbmRzIiwiaSIsIm1pbiIsIm1heCIsImNvbnN0YW50VGVybU9wZXJhbmQiLCJjb25zdGFudFZhbHVlIiwiZnJvbUludGVnZXIiLCJwdXNoIiwidmFyaWFibGVUZXJtT3BlcmFuZCIsImNvZWZmaWNpZW50IiwiZGVmYXVsdE9wZXJhbmQiLCJmaW5kIiwib3BlcmFuZCIsImdldFZhbHVlIiwiYXNzZXJ0Iiwib3BlcmFuZFByb3BlcnR5Iiwib3BlcmF0aW9uQ29tcGxldGVkRW1pdHRlciIsInZhbHVlVHlwZSIsImRpc3Bvc2UiLCJyZXNldCIsImFwcGx5T3BlcmF0aW9uIiwib3BlcmF0aW9uIiwic25hcHNob3QiLCJ0ZXJtQ3JlYXRvcnNaZXJvIiwiYWxsVGVybUNyZWF0b3JzIiwiZm9yRWFjaCIsInRlcm1DcmVhdG9yIiwic3VtbWVkVG9aZXJvIiwiZmluZE1heEludGVnZXJFeGNlZWRlZCIsIm1heEludGVnZXJFeGNlZWRlZEVtaXR0ZXIiLCJlbWl0IiwicmVzdG9yZSIsImxlbmd0aCIsInRlcm0iLCJnZXRMaWtlVGVybU9uUGxhdGUiLCJtYXhJbnRlZ2VyRXhjZWVkZWQiLCJwYXJlbnRUYW5kZW0iLCJsaWtlVGVybXNDZWxsIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJPcGVyYXRpb25zU2NlbmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTctMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogVGhlIHNvbGUgc2NlbmUgaW4gdGhlICdPcGVyYXRpb25zJyBzY3JlZW4uXHJcbiAqIFRoaXMgc2NlbmUgaGFzIHZhcmlhYmxlIGFuZCBjb25zdGFudCB0ZXJtcyBvbiBib3RoIHNpZGVzIG9mIHRoZSBlcXVhdGlvbi5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgRW1pdHRlciBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0VtaXR0ZXIuanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBGcmFjdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL21vZGVsL0ZyYWN0aW9uLmpzJztcclxuaW1wb3J0IEVxdWFsaXR5RXhwbG9yZXJDb25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL0VxdWFsaXR5RXhwbG9yZXJDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgQ29uc3RhbnRUZXJtIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9Db25zdGFudFRlcm0uanMnO1xyXG5pbXBvcnQgQ29uc3RhbnRUZXJtQ3JlYXRvciBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvQ29uc3RhbnRUZXJtQ3JlYXRvci5qcyc7XHJcbmltcG9ydCBFcXVhbGl0eUV4cGxvcmVyU2NlbmUsIHsgRXF1YWxpdHlFeHBsb3JlclNjZW5lT3B0aW9ucyB9IGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9FcXVhbGl0eUV4cGxvcmVyU2NlbmUuanMnO1xyXG5pbXBvcnQgU25hcHNob3QgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL1NuYXBzaG90LmpzJztcclxuaW1wb3J0IFRlcm1DcmVhdG9yIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9UZXJtQ3JlYXRvci5qcyc7XHJcbmltcG9ydCBVbml2ZXJzYWxPcGVyYXRpb24sIHsgVW5pdmVyc2FsT3BlcmFuZCB9IGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9Vbml2ZXJzYWxPcGVyYXRpb24uanMnO1xyXG5pbXBvcnQgVmFyaWFibGUgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL1ZhcmlhYmxlLmpzJztcclxuaW1wb3J0IFZhcmlhYmxlVGVybSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvVmFyaWFibGVUZXJtLmpzJztcclxuaW1wb3J0IFZhcmlhYmxlVGVybUNyZWF0b3IgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL1ZhcmlhYmxlVGVybUNyZWF0b3IuanMnO1xyXG5pbXBvcnQgZXF1YWxpdHlFeHBsb3JlciBmcm9tICcuLi8uLi9lcXVhbGl0eUV4cGxvcmVyLmpzJztcclxuaW1wb3J0IEVxdWFsaXR5RXhwbG9yZXJTdHJpbmdzIGZyb20gJy4uLy4uL0VxdWFsaXR5RXhwbG9yZXJTdHJpbmdzLmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuaW1wb3J0IFBpY2tPcHRpb25hbCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja09wdGlvbmFsLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IFVuaXZlcnNhbE9wZXJhdG9yIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9Vbml2ZXJzYWxPcGVyYXRvci5qcyc7XHJcbmltcG9ydCBFbnVtZXJhdGlvblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRW51bWVyYXRpb25Qcm9wZXJ0eS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgT1BFUkFORF9SQU5HRSA9IEVxdWFsaXR5RXhwbG9yZXJDb25zdGFudHMuT1BFUkFORF9SQU5HRTtcclxuY29uc3QgSUNPTl9TSVpFID0gbmV3IERpbWVuc2lvbjIoXHJcbiAgRXF1YWxpdHlFeHBsb3JlckNvbnN0YW50cy5CSUdfVEVSTV9ESUFNRVRFUiArIDEwLFxyXG4gIEVxdWFsaXR5RXhwbG9yZXJDb25zdGFudHMuQklHX1RFUk1fRElBTUVURVIgKTtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgdmFyaWFibGVSYW5nZT86IFJhbmdlOyAvLyByYW5nZSBvZiB0aGUgdmFyaWFibGVzXHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBPcGVyYXRpb25zU2NlbmVPcHRpb25zID0gU2VsZk9wdGlvbnMgJlxyXG4gIFBpY2tPcHRpb25hbDxFcXVhbGl0eUV4cGxvcmVyU2NlbmVPcHRpb25zLCAnc2NhbGVQb3NpdGlvbicgfCAnbG9ja2FibGUnPiAmXHJcbiAgUGlja1JlcXVpcmVkPEVxdWFsaXR5RXhwbG9yZXJTY2VuZU9wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE9wZXJhdGlvbnNTY2VuZSBleHRlbmRzIEVxdWFsaXR5RXhwbG9yZXJTY2VuZSB7XHJcblxyXG4gIHByb3RlY3RlZCByZWFkb25seSB4OiBWYXJpYWJsZTtcclxuXHJcbiAgLy8gZW1pdHMgd2hlbiBvbmUgb3IgbW9yZSB0ZXJtcyBiZWNvbWUgemVybyBhcyB0aGUgcmVzdWx0IG9mIGEgdW5pdmVyc2FsIG9wZXJhdGlvblxyXG4gIHB1YmxpYyByZWFkb25seSBzdW1Ub1plcm9FbWl0dGVyOiBFbWl0dGVyPFsgVGVybUNyZWF0b3JbXSBdPjtcclxuXHJcbiAgLy8gZW1pdHMgaXMgY2FsbGVkIHdoZW4gYSB1bml2ZXJzYWwgb3BlcmF0aW9uIGhhcyBjb21wbGV0ZWQuXHJcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IG9wZXJhdGlvbkNvbXBsZXRlZEVtaXR0ZXI6IEVtaXR0ZXI8WyBVbml2ZXJzYWxPcGVyYXRpb24gXT47XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSBvcGVyYXRvcnM6IHJlYWRvbmx5IFVuaXZlcnNhbE9wZXJhdG9yW107XHJcbiAgcHVibGljIHJlYWRvbmx5IG9wZXJhdG9yUHJvcGVydHk6IFByb3BlcnR5PFVuaXZlcnNhbE9wZXJhdG9yPjtcclxuXHJcbiAgLy8gb3BlcmFuZHMgdGhhdCBhcHBlYXIgaW4gdGhlIG9wZXJhbmQgcGlja2VyLiBUaGVzZSBhcmUgdGhlIG9ubHkgVGVybXMgdGhhdCBhcmUgbm90IGNyZWF0ZWQgYW5kIG1hbmFnZWQgYnkgYSBUZXJtQ3JlYXRvci5cclxuICBwdWJsaWMgcmVhZG9ubHkgb3BlcmFuZHM6IFVuaXZlcnNhbE9wZXJhbmRbXTtcclxuICBwdWJsaWMgcmVhZG9ubHkgb3BlcmFuZFByb3BlcnR5OiBQcm9wZXJ0eTxVbml2ZXJzYWxPcGVyYW5kPjtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM6IE9wZXJhdGlvbnNTY2VuZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxPcGVyYXRpb25zU2NlbmVPcHRpb25zLCBTZWxmT3B0aW9ucywgRXF1YWxpdHlFeHBsb3JlclNjZW5lT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgdmFyaWFibGVSYW5nZTogRXF1YWxpdHlFeHBsb3JlckNvbnN0YW50cy5WQVJJQUJMRV9SQU5HRSxcclxuXHJcbiAgICAgIC8vIEVxdWFsaXR5RXhwbG9yZXJTY2VuZU9wdGlvbnNcclxuICAgICAgZ3JpZFJvd3M6IDEsXHJcbiAgICAgIGdyaWRDb2x1bW5zOiAyLFxyXG4gICAgICBpY29uU2l6ZTogSUNPTl9TSVpFIC8vIHtEaW1lbnNpb24yfSBzaXplIG9mIHRlcm1zIGljb25zIG9uIHRoZSBzY2FsZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgdmFyaWFibGVzVGFuZGVtID0gb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndmFyaWFibGVzJyApO1xyXG5cclxuICAgIGNvbnN0IHggPSBuZXcgVmFyaWFibGUoIEVxdWFsaXR5RXhwbG9yZXJTdHJpbmdzLnhTdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgICByYW5nZTogb3B0aW9ucy52YXJpYWJsZVJhbmdlLFxyXG4gICAgICB0YW5kZW06IHZhcmlhYmxlc1RhbmRlbS5jcmVhdGVUYW5kZW0oICd4JyApXHJcbiAgICB9ICk7XHJcbiAgICBvcHRpb25zLnZhcmlhYmxlcyA9IFsgeCBdO1xyXG5cclxuICAgIGNvbnN0IGNyZWF0ZUxlZnRUZXJtQ3JlYXRvcnMgPSAoIGxvY2tlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPiB8IG51bGwsIHRhbmRlbTogVGFuZGVtICkgPT5cclxuICAgICAgY3JlYXRlVGVybUNyZWF0b3JzKCB4LCBsb2NrZWRQcm9wZXJ0eSwgdGFuZGVtICk7XHJcblxyXG4gICAgY29uc3QgY3JlYXRlUmlnaHRUZXJtQ3JlYXRvcnMgPSAoIGxvY2tlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPiB8IG51bGwsIHRhbmRlbTogVGFuZGVtICkgPT5cclxuICAgICAgY3JlYXRlVGVybUNyZWF0b3JzKCB4LCBsb2NrZWRQcm9wZXJ0eSwgdGFuZGVtICk7XHJcblxyXG4gICAgc3VwZXIoIGNyZWF0ZUxlZnRUZXJtQ3JlYXRvcnMsIGNyZWF0ZVJpZ2h0VGVybUNyZWF0b3JzLCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy54ID0geDtcclxuXHJcbiAgICB0aGlzLnN1bVRvWmVyb0VtaXR0ZXIgPSBuZXcgRW1pdHRlcigge1xyXG4gICAgICBwYXJhbWV0ZXJzOiBbIHtcclxuXHJcbiAgICAgICAgLy8ge1Rlcm1DcmVhdG9yW119XHJcbiAgICAgICAgaXNWYWxpZFZhbHVlOiBhcnJheSA9PiAoIEFycmF5LmlzQXJyYXkoIGFycmF5ICkgJiYgXy5ldmVyeSggYXJyYXksIHZhbHVlID0+IHZhbHVlIGluc3RhbmNlb2YgVGVybUNyZWF0b3IgKSApXHJcbiAgICAgIH0gXVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMub3BlcmF0b3JzID0gVW5pdmVyc2FsT3BlcmF0b3IuZW51bWVyYXRpb24udmFsdWVzO1xyXG5cclxuICAgIHRoaXMub3BlcmF0b3JQcm9wZXJ0eSA9IG5ldyBFbnVtZXJhdGlvblByb3BlcnR5KCB0aGlzLm9wZXJhdG9yc1sgMCBdLCB7XHJcbiAgICAgIHZhbGlkVmFsdWVzOiB0aGlzLm9wZXJhdG9ycyxcclxuICAgICAgaGFzTGlzdGVuZXJPcmRlckRlcGVuZGVuY2llczogdHJ1ZSAvLyBUT0RPOiBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZXF1YWxpdHktZXhwbG9yZXIvaXNzdWVzLzIwNVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMub3BlcmFuZHMgPSBbXTtcclxuICAgIGZvciAoIGxldCBpID0gT1BFUkFORF9SQU5HRS5taW47IGkgPD0gT1BFUkFORF9SQU5HRS5tYXg7IGkrKyApIHtcclxuXHJcbiAgICAgIGNvbnN0IGNvbnN0YW50VGVybU9wZXJhbmQgPSBuZXcgQ29uc3RhbnRUZXJtKCB7XHJcbiAgICAgICAgY29uc3RhbnRWYWx1ZTogRnJhY3Rpb24uZnJvbUludGVnZXIoIGkgKVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICBpZiAoIGkgPT09IDAgKSB7XHJcblxyXG4gICAgICAgIC8vIHNraXAgdmFyaWFibGUgdGVybSB3aXRoIHplcm8gY29lZmZpY2llbnRcclxuICAgICAgICB0aGlzLm9wZXJhbmRzLnB1c2goIGNvbnN0YW50VGVybU9wZXJhbmQgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgY29uc3QgdmFyaWFibGVUZXJtT3BlcmFuZCA9IG5ldyBWYXJpYWJsZVRlcm0oIHRoaXMueCwge1xyXG4gICAgICAgICAgY29lZmZpY2llbnQ6IEZyYWN0aW9uLmZyb21JbnRlZ2VyKCBpIClcclxuICAgICAgICB9ICk7XHJcblxyXG4gICAgICAgIGlmICggaSA8IDAgKSB7XHJcblxyXG4gICAgICAgICAgLy8gZm9yIG5lZ2F0aXZlIG51bWJlcnMsIHB1dCB0aGUgdmFyaWFibGUgdGVybSBiZWZvcmUgdGhlIGNvbnN0YW50IHRlcm1cclxuICAgICAgICAgIC8vIGUuZy4gLi4uIC0yeCwgLTIsIC14LCAtMVxyXG4gICAgICAgICAgdGhpcy5vcGVyYW5kcy5wdXNoKCB2YXJpYWJsZVRlcm1PcGVyYW5kICk7XHJcbiAgICAgICAgICB0aGlzLm9wZXJhbmRzLnB1c2goIGNvbnN0YW50VGVybU9wZXJhbmQgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgICAgLy8gZm9yIHBvc2l0aXZlIG51bWJlcnMsIHB1dCB0aGUgdmFyaWFibGUgdGVybSBiZWZvcmUgdGhlIGNvbnN0YW50IHRlcm1cclxuICAgICAgICAgIC8vIGUuZy4gMSwgeCwgMiwgMngsIC4uLlxyXG4gICAgICAgICAgdGhpcy5vcGVyYW5kcy5wdXNoKCBjb25zdGFudFRlcm1PcGVyYW5kICk7XHJcbiAgICAgICAgICB0aGlzLm9wZXJhbmRzLnB1c2goIHZhcmlhYmxlVGVybU9wZXJhbmQgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBTdGFydCB3aXRoIG9wZXJhbmQgMVxyXG4gICAgY29uc3QgZGVmYXVsdE9wZXJhbmQgPSBfLmZpbmQoIHRoaXMub3BlcmFuZHMsXHJcbiAgICAgIG9wZXJhbmQgPT4gKCBvcGVyYW5kIGluc3RhbmNlb2YgQ29uc3RhbnRUZXJtICkgJiYgKCBvcGVyYW5kLmNvbnN0YW50VmFsdWUuZ2V0VmFsdWUoKSA9PT0gMSApICkhO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZGVmYXVsdE9wZXJhbmQsICdvb3BzLCB0aGUgZGVmYXVsdCB3YXMgbm90IGZvdW5kJyApO1xyXG5cclxuICAgIHRoaXMub3BlcmFuZFByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBkZWZhdWx0T3BlcmFuZCwge1xyXG4gICAgICB2YWxpZFZhbHVlczogdGhpcy5vcGVyYW5kc1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMub3BlcmF0aW9uQ29tcGxldGVkRW1pdHRlciA9IG5ldyBFbWl0dGVyKCB7XHJcbiAgICAgIHBhcmFtZXRlcnM6IFsgeyB2YWx1ZVR5cGU6IFVuaXZlcnNhbE9wZXJhdGlvbiB9IF1cclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLngucmVzZXQoKTtcclxuICAgIHRoaXMub3BlcmF0b3JQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy5vcGVyYW5kUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHN1cGVyLnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBcHBsaWVzIGEgdW5pdmVyc2FsIG9wZXJhdGlvbi5cclxuICAgKi9cclxuICBwdWJsaWMgYXBwbHlPcGVyYXRpb24oIG9wZXJhdGlvbjogVW5pdmVyc2FsT3BlcmF0aW9uICk6IHZvaWQge1xyXG5cclxuICAgIC8vIFRha2UgYSBzbmFwc2hvdCBvZiB0ZXJtcyBvbiB0aGUgc2NhbGUsIHNvIHdlIGNhbiB1bmRvIHRoZSBvcGVyYXRpb24gaWYgbmVjZXNzYXJ5LlxyXG4gICAgY29uc3Qgc25hcHNob3QgPSBuZXcgU25hcHNob3QoIHRoaXMgKTsgLy9UT0RPIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9lcXVhbGl0eS1leHBsb3Jlci9pc3N1ZXMvMjAwIGR5bmFtaWNcclxuXHJcbiAgICAvLyBUZXJtQ3JlYXRvcnMgd2hvc2UgdGVybXMgc3VtbWVkIHRvIHplcm8gYXMgdGhlIHJlc3VsdCBvZiBhcHBseWluZyB0aGlzIG9wZXJhdGlvbi5cclxuICAgIGNvbnN0IHRlcm1DcmVhdG9yc1plcm86IFRlcm1DcmVhdG9yW10gPSBbXTtcclxuXHJcbiAgICAvLyBBcHBseSB0aGUgb3BlcmF0aW9uIHRvIGVhY2ggVGVybUNyZWF0b3JcclxuICAgIHRoaXMuYWxsVGVybUNyZWF0b3JzLmZvckVhY2goIHRlcm1DcmVhdG9yID0+IHtcclxuICAgICAgY29uc3Qgc3VtbWVkVG9aZXJvID0gdGVybUNyZWF0b3IuYXBwbHlPcGVyYXRpb24oIG9wZXJhdGlvbiApO1xyXG4gICAgICBpZiAoIHN1bW1lZFRvWmVybyApIHtcclxuICAgICAgICB0ZXJtQ3JlYXRvcnNaZXJvLnB1c2goIHRlcm1DcmVhdG9yICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBJZiBhbnkgdGVybSBleGNlZWRzIG1heEludGVnZXIgYXMgdGhlIHJlc3VsdCBvZiBhcHBseWluZyB0aGUgb3BlcmF0aW9uIC4uLlxyXG4gICAgY29uc3QgdGVybUNyZWF0b3IgPSB0aGlzLmZpbmRNYXhJbnRlZ2VyRXhjZWVkZWQoKTtcclxuICAgIGlmICggdGVybUNyZWF0b3IgKSB7XHJcblxyXG4gICAgICAvLyBOb3RpZnkgbGlzdGVuZXJzIGFuZCB1bmRvIHRoZSBvcGVyYXRpb24gYnkgcmVzdG9yaW5nIHRoZSBzbmFwc2hvdC5cclxuICAgICAgdGVybUNyZWF0b3IubWF4SW50ZWdlckV4Y2VlZGVkRW1pdHRlci5lbWl0KCk7XHJcbiAgICAgIHNuYXBzaG90LnJlc3RvcmUoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG5cclxuICAgICAgLy8gVGVsbCB0aGUgdmlldyB3aGljaCB0ZXJtcyBzdW1tZWQgdG8gemVyby5cclxuICAgICAgLy8gRG8gdGhpcyBhZnRlciB0aGUgb3BlcmF0aW9uIGhhcyBiZWVuIGZ1bGx5IGFwcGxpZWQsIHNvIHRoYXQgc3VtLXRvLXplcm8gYW5pbWF0aW9uc1xyXG4gICAgICAvLyBhcHBlYXIgaW4gdGhlIGNlbGxzIGF0IHRoZSBzY2FsZSdzIGZpbmFsIHBvc2l0aW9uLCBub3QgYXQgdGhlIHBvc2l0aW9uIGJlZm9yZSB0aGVcclxuICAgICAgLy8gb3BlcmF0aW9uIHdhcyBhcHBsaWVkLCBvciBhdCBzb21lIGludGVybWVkaWF0ZSBwb3NpdGlvbiBhcyB0aGUgb3BlcmF0aW9uIGlzIGJlaW5nIGFwcGxpZWQuXHJcbiAgICAgIGlmICggdGVybUNyZWF0b3JzWmVyby5sZW5ndGggPiAwICkge1xyXG4gICAgICAgIHRoaXMuc3VtVG9aZXJvRW1pdHRlci5lbWl0KCB0ZXJtQ3JlYXRvcnNaZXJvICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIG5vdGlmeSBsaXN0ZW5lcnMgdGhhdCB0aGUgb3BlcmF0aW9uIHN1Y2Nlc3NmdWxseSBjb21wbGV0ZWRcclxuICAgICAgdGhpcy5vcGVyYXRpb25Db21wbGV0ZWRFbWl0dGVyLmVtaXQoIG9wZXJhdGlvbiApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmluZHMgdGhlIGZpcnN0IFRlcm1DcmVhdG9yIHRoYXQgaGFzIGEgVGVybSB0aGF0IGV4Y2VlZHMgdGhlIG1heEludGVnZXIgbGltaXQuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBmaW5kTWF4SW50ZWdlckV4Y2VlZGVkKCk6IFRlcm1DcmVhdG9yIHwgbnVsbCB7XHJcbiAgICBjb25zdCB0ZXJtQ3JlYXRvciA9IF8uZmluZCggdGhpcy5hbGxUZXJtQ3JlYXRvcnMsIHRlcm1DcmVhdG9yID0+IHtcclxuXHJcbiAgICAgIC8vIEdldCB0aGUgdGVybSBvbiB0aGUgcGxhdGVcclxuICAgICAgY29uc3QgdGVybSA9IHRlcm1DcmVhdG9yLmdldExpa2VUZXJtT25QbGF0ZSgpO1xyXG5cclxuICAgICAgLy8gRG9lcyB0aGUgdGVybSBleGNlZWQgdGhlIGxpbWl0P1xyXG4gICAgICByZXR1cm4gKCB0ZXJtICE9PSBudWxsICkgJiYgdGVybS5tYXhJbnRlZ2VyRXhjZWVkZWQoKTtcclxuICAgIH0gKTtcclxuICAgIHJldHVybiB0ZXJtQ3JlYXRvciB8fCBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZXMgdGhlIHRlcm0gY3JlYXRvcnMgZm9yIHRoaXMgc2NlbmUuXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVUZXJtQ3JlYXRvcnMoIHg6IFZhcmlhYmxlLCBsb2NrZWRQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj4gfCBudWxsLCBwYXJlbnRUYW5kZW06IFRhbmRlbSApOiBUZXJtQ3JlYXRvcltdIHtcclxuXHJcbiAgLy8gVmFyaWFibGUgYW5kIGNvbnN0YW50IHRlcm1zIHdpbGwgYmUgY29tYmluZWQgaW4gc3BlY2lmaWMgY2VsbHMgaW4gdGhlIHBsYXRlJ3MgZ3JpZC5cclxuICAvLyBUaGlzIGlzIHRoZSBjZWxsIGluIHRoZSBncmlkIHRoYXQgYWxsIGxpa2UgdGVybXMgd2lsbCBvY2N1cHkuXHJcbiAgbGV0IGxpa2VUZXJtc0NlbGwgPSAwO1xyXG5cclxuICByZXR1cm4gW1xyXG5cclxuICAgIC8vIHggJiAteFxyXG4gICAgbmV3IFZhcmlhYmxlVGVybUNyZWF0b3IoIHgsIHtcclxuICAgICAgICBsaWtlVGVybXNDZWxsOiBsaWtlVGVybXNDZWxsKyssXHJcbiAgICAgICAgbG9ja2VkUHJvcGVydHk6IGxvY2tlZFByb3BlcnR5LFxyXG4gICAgICAgIHRhbmRlbTogcGFyZW50VGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3hUZXJtQ3JlYXRvcicgKVxyXG4gICAgICB9ICksXHJcblxyXG4gICAgLy8gMSAmIC0xXHJcbiAgICBuZXcgQ29uc3RhbnRUZXJtQ3JlYXRvcigge1xyXG4gICAgICBsaWtlVGVybXNDZWxsOiBsaWtlVGVybXNDZWxsKyssXHJcbiAgICAgIGxvY2tlZFByb3BlcnR5OiBsb2NrZWRQcm9wZXJ0eSxcclxuICAgICAgdGFuZGVtOiBwYXJlbnRUYW5kZW0uY3JlYXRlVGFuZGVtKCAnY29uc3RhbnRUZXJtQ3JlYXRvcicgKVxyXG4gICAgfSApXHJcbiAgXTtcclxufVxyXG5cclxuZXF1YWxpdHlFeHBsb3Jlci5yZWdpc3RlciggJ09wZXJhdGlvbnNTY2VuZScsIE9wZXJhdGlvbnNTY2VuZSApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztB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