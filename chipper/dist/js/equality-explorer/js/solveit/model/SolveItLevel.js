// Copyright 2018-2022, University of Colorado Boulder

/**
 * SolveItLevel is a level in the 'Solve It!' game screen. A level is a specialization of a scene from the 'Operations'
 * screen. (variable and constant terms on both sides of the equation), with the addition of game challenges.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import NumberProperty, { DEFAULT_RANGE } from '../../../../axon/js/NumberProperty.js';
import Property from '../../../../axon/js/Property.js';
import dotRandom from '../../../../dot/js/dotRandom.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import optionize from '../../../../phet-core/js/optionize.js';
import Fraction from '../../../../phetcommon/js/model/Fraction.js';
import NullableIO from '../../../../tandem/js/types/NullableIO.js';
import EqualityExplorerConstants from '../../common/EqualityExplorerConstants.js';
import EqualityExplorerQueryParameters from '../../common/EqualityExplorerQueryParameters.js';
import ConstantTerm from '../../common/model/ConstantTerm.js';
import ConstantTermCreator from '../../common/model/ConstantTermCreator.js';
import VariableTerm from '../../common/model/VariableTerm.js';
import VariableTermCreator from '../../common/model/VariableTermCreator.js';
import equalityExplorer from '../../equalityExplorer.js';
import OperationsScene from '../../operations/model/OperationsScene.js';
import Challenge from './Challenge.js';
import DebugChallenge from './DebugChallenge.js';

// constants
const POINTS_PER_CHALLENGE = 1;
export default class SolveItLevel extends OperationsScene {
  // integer, starting from 1

  // description that appears in the UI for the level

  // the current challenge, set by nextChallenge

  // has the current challenge been solved?

  // will x be on the left-side (true) or right-side (false) of the equation in the solution?

  constructor(descriptionProperty, challengeGenerator, providedOptions) {
    const options = optionize()({
      // OperationsSceneOptions
      lockable: false,
      // lock feature is relevant for the game
      scalePosition: new Vector2(355, 500),
      // determined empirically
      variableRange: DEFAULT_RANGE // because variables are not user-controlled in a game level
    }, providedOptions);
    assert && assert(Number.isInteger(options.levelNumber) && options.levelNumber > 0);
    super(options);
    this.levelNumber = options.levelNumber;
    this.descriptionProperty = descriptionProperty;
    this.challengeGenerator = challengeGenerator;
    this.scoreProperty = new NumberProperty(0, {
      numberType: 'Integer',
      isValidValue: value => value >= 0,
      // the game is open-ended, so there is no maximum score
      tandem: options.tandem.createTandem('scoreProperty'),
      phetioReadOnly: true
    });

    // Initialize positions of term creators. This is necessary because this screen has no TermToolboxes.
    // Positions can be any value, since terms in this screen never return to a toolbox.
    // This is preferable to using a default value, since initialization order is important in other screens.
    // See for example frameStartedCallback in TermCreatorNode.
    this.allTermCreators.forEach(termCreator => {
      termCreator.positivePosition = Vector2.ZERO;
      termCreator.negativePosition = Vector2.ZERO;
    });

    // The initial value is null because we don't want to restore the same Challenge when the sim is reset.
    this.challengeProperty = new Property(null, {
      isValidValue: value => value instanceof Challenge || value === null,
      tandem: options.tandem.createTandem('challengeProperty'),
      phetioValueType: NullableIO(Challenge.ChallengeIO),
      phetioReadOnly: true
    });
    this.challengeHasBeenSolved = false;
    this.xOnLeft = true;

    // Casting here is not great, but allows us to reuse OperationsScene.
    assert && assert(this.leftTermCreators.length === 2 && this.leftTermCreators[0] instanceof VariableTermCreator && this.leftTermCreators[1] instanceof ConstantTermCreator);
    assert && assert(this.rightTermCreators.length === 2 && this.rightTermCreators[0] instanceof VariableTermCreator && this.rightTermCreators[1] instanceof ConstantTermCreator);
    this.leftVariableTermCreator = this.leftTermCreators[0];
    this.leftConstantTermCreator = this.leftTermCreators[1];
    this.rightVariableTermCreator = this.rightTermCreators[0];
    this.rightConstantTermCreator = this.rightTermCreators[1];

    // When a universal operation is completed, determine if the challenge is solved.
    this.operationCompletedEmitter.addListener(operation => {
      // All challenges in the game are equalities, and applying a universal operation should result in an equality.
      assert && assert(this.scale.angleProperty.value === 0, `scale is not balanced after applying operation ${operation}`);

      // challenge is in a 'solved' state if x has been isolated on the scale.
      const solved = this.isXIsolated();

      // The first time that the challenge has been solved, award points and notify listeners.
      if (solved && !this.challengeHasBeenSolved) {
        phet.log && phet.log('operationCompletedEmitter listener: challenge is solved');
        this.challengeHasBeenSolved = true;
        this.scoreProperty.value = this.scoreProperty.value + POINTS_PER_CHALLENGE;
      }
    });
    this.addLinkedElement(descriptionProperty, {
      tandem: options.tandem.createTandem('descriptionProperty')
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
  reset() {
    this.scoreProperty.reset();
    this.challengeProperty.reset();
    super.reset();
  }

  /**
   * Generates the next challenge.
   */
  nextChallenge() {
    // reset the universal operation
    this.operatorProperty.reset();
    this.operandProperty.reset();

    // clear snapshots
    this.snapshotsCollection.reset();

    // dispose of all terms
    this.allTermCreators.forEach(termCreator => termCreator.disposeAllTerms());

    // generate the challenge, form is: ax + b = mx + n
    let challenge = this.challengeGenerator.nextChallenge();
    if (EqualityExplorerQueryParameters.challenge) {
      challenge = new DebugChallenge();
    }
    phet.log && phet.log(`nextChallenge: challenge=${challenge}`);
    phet.log && phet.log(`nextChallenge: derivation=${challenge.debugDerivation.replace(/<br>/g, ', ')}`);

    // set the value of x
    this.x.valueProperty.value = challenge.x;

    // randomize whether the scale shows 'ax + b = mx + n' or 'mx + n = ax + b'
    this.xOnLeft = dotRandom.nextBoolean();
    const aTermCreator = this.xOnLeft ? this.leftVariableTermCreator : this.rightVariableTermCreator;
    const bTermCreator = this.xOnLeft ? this.leftConstantTermCreator : this.rightConstantTermCreator;
    const mTermCreator = this.xOnLeft ? this.rightVariableTermCreator : this.leftVariableTermCreator;
    const nTermCreator = this.xOnLeft ? this.rightConstantTermCreator : this.leftConstantTermCreator;

    // Create terms on the scale that correspond to the challenge.
    this.createVariableTermOnPlate(aTermCreator, challenge.a);
    this.createConstantTermOnPlate(bTermCreator, challenge.b);
    this.createVariableTermOnPlate(mTermCreator, challenge.m);
    this.createConstantTermOnPlate(nTermCreator, challenge.n);

    // The new challenge has not been solved
    this.challengeHasBeenSolved = false;

    // Finally, set challengeProperty, to notify listeners that the challenge has changed.
    this.challengeProperty.value = challenge;
  }

  /**
   * Creates a variable term on the plate. If coefficient is zero, this is a no-op.
   */
  createVariableTermOnPlate(termCreator, coefficient) {
    if (coefficient.getValue() !== 0) {
      const term = termCreator.createTerm({
        coefficient: coefficient,
        diameter: EqualityExplorerConstants.BIG_TERM_DIAMETER
      });
      termCreator.putTermOnPlate(term);
    }
  }

  /**
   * Creates a constant term on the plate. If constantValue is zero, this is a no-op.
   */
  createConstantTermOnPlate(termCreator, constantValue) {
    if (constantValue.getValue() !== 0) {
      const term = termCreator.createTerm({
        constantValue: constantValue,
        diameter: EqualityExplorerConstants.BIG_TERM_DIAMETER
      });
      termCreator.putTermOnPlate(term);
    }
  }

  /**
   * Determines whether the value of x has been isolated on the scale.
   * This means that the scale contains either 'x = n' or 'b = x', where 'ax + b = mx + n' is the general form.
   */
  isXIsolated() {
    let xIsIsolated = false;

    // a, b, m, n
    const aTerm = this.leftVariableTermCreator.getLikeTermOnPlate();
    const bTerm = this.leftConstantTermCreator.getLikeTermOnPlate();
    const mTerm = this.rightVariableTermCreator.getLikeTermOnPlate();
    const nTerm = this.rightConstantTermCreator.getLikeTermOnPlate();
    if (aTerm && !bTerm && !mTerm && nTerm) {
      // ax + 0 = 0x + n
      assert && assert(aTerm instanceof VariableTerm); // eslint-disable-line no-simple-type-checking-assertions
      xIsIsolated = aTerm.coefficient.getValue() === 1; // x = n
    } else if (!aTerm && bTerm && mTerm && !nTerm) {
      // 0x + b = mx + 0
      assert && assert(mTerm instanceof VariableTerm); // eslint-disable-line no-simple-type-checking-assertions
      xIsIsolated = mTerm.coefficient.getValue() === 1; // b = x
    }

    return xIsIsolated;
  }

  /**
   * Displays the answer to the current challenge, for debugging.
   */
  showAnswer() {
    // 0 = 0
    this.allTermCreators.forEach(termCreator => termCreator.disposeAllTerms());

    // x
    const variableTerm = new VariableTerm(this.x, {
      //TODO https://github.com/phetsims/equality-explorer/issues/200 dynamic
      coefficient: Fraction.fromInteger(1),
      diameter: EqualityExplorerConstants.BIG_TERM_DIAMETER
    });

    // N
    const constantTerm = new ConstantTerm({
      //TODO https://github.com/phetsims/equality-explorer/issues/200 dynamic
      constantValue: Fraction.fromInteger(this.x.valueProperty.value),
      diameter: EqualityExplorerConstants.BIG_TERM_DIAMETER
    });

    // x = N
    if (this.xOnLeft) {
      this.leftVariableTermCreator.putTermOnPlate(variableTerm);
      this.rightConstantTermCreator.putTermOnPlate(constantTerm);
    } else {
      this.rightVariableTermCreator.putTermOnPlate(variableTerm);
      this.leftConstantTermCreator.putTermOnPlate(constantTerm);
    }

    // indicate that the challenge has been solved
    this.challengeHasBeenSolved = true;
    this.scoreProperty.value = this.scoreProperty.value + POINTS_PER_CHALLENGE;
  }
}
equalityExplorer.register('SolveItLevel', SolveItLevel);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOdW1iZXJQcm9wZXJ0eSIsIkRFRkFVTFRfUkFOR0UiLCJQcm9wZXJ0eSIsImRvdFJhbmRvbSIsIlZlY3RvcjIiLCJvcHRpb25pemUiLCJGcmFjdGlvbiIsIk51bGxhYmxlSU8iLCJFcXVhbGl0eUV4cGxvcmVyQ29uc3RhbnRzIiwiRXF1YWxpdHlFeHBsb3JlclF1ZXJ5UGFyYW1ldGVycyIsIkNvbnN0YW50VGVybSIsIkNvbnN0YW50VGVybUNyZWF0b3IiLCJWYXJpYWJsZVRlcm0iLCJWYXJpYWJsZVRlcm1DcmVhdG9yIiwiZXF1YWxpdHlFeHBsb3JlciIsIk9wZXJhdGlvbnNTY2VuZSIsIkNoYWxsZW5nZSIsIkRlYnVnQ2hhbGxlbmdlIiwiUE9JTlRTX1BFUl9DSEFMTEVOR0UiLCJTb2x2ZUl0TGV2ZWwiLCJjb25zdHJ1Y3RvciIsImRlc2NyaXB0aW9uUHJvcGVydHkiLCJjaGFsbGVuZ2VHZW5lcmF0b3IiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwibG9ja2FibGUiLCJzY2FsZVBvc2l0aW9uIiwidmFyaWFibGVSYW5nZSIsImFzc2VydCIsIk51bWJlciIsImlzSW50ZWdlciIsImxldmVsTnVtYmVyIiwic2NvcmVQcm9wZXJ0eSIsIm51bWJlclR5cGUiLCJpc1ZhbGlkVmFsdWUiLCJ2YWx1ZSIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb1JlYWRPbmx5IiwiYWxsVGVybUNyZWF0b3JzIiwiZm9yRWFjaCIsInRlcm1DcmVhdG9yIiwicG9zaXRpdmVQb3NpdGlvbiIsIlpFUk8iLCJuZWdhdGl2ZVBvc2l0aW9uIiwiY2hhbGxlbmdlUHJvcGVydHkiLCJwaGV0aW9WYWx1ZVR5cGUiLCJDaGFsbGVuZ2VJTyIsImNoYWxsZW5nZUhhc0JlZW5Tb2x2ZWQiLCJ4T25MZWZ0IiwibGVmdFRlcm1DcmVhdG9ycyIsImxlbmd0aCIsInJpZ2h0VGVybUNyZWF0b3JzIiwibGVmdFZhcmlhYmxlVGVybUNyZWF0b3IiLCJsZWZ0Q29uc3RhbnRUZXJtQ3JlYXRvciIsInJpZ2h0VmFyaWFibGVUZXJtQ3JlYXRvciIsInJpZ2h0Q29uc3RhbnRUZXJtQ3JlYXRvciIsIm9wZXJhdGlvbkNvbXBsZXRlZEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsIm9wZXJhdGlvbiIsInNjYWxlIiwiYW5nbGVQcm9wZXJ0eSIsInNvbHZlZCIsImlzWElzb2xhdGVkIiwicGhldCIsImxvZyIsImFkZExpbmtlZEVsZW1lbnQiLCJkaXNwb3NlIiwicmVzZXQiLCJuZXh0Q2hhbGxlbmdlIiwib3BlcmF0b3JQcm9wZXJ0eSIsIm9wZXJhbmRQcm9wZXJ0eSIsInNuYXBzaG90c0NvbGxlY3Rpb24iLCJkaXNwb3NlQWxsVGVybXMiLCJjaGFsbGVuZ2UiLCJkZWJ1Z0Rlcml2YXRpb24iLCJyZXBsYWNlIiwieCIsInZhbHVlUHJvcGVydHkiLCJuZXh0Qm9vbGVhbiIsImFUZXJtQ3JlYXRvciIsImJUZXJtQ3JlYXRvciIsIm1UZXJtQ3JlYXRvciIsIm5UZXJtQ3JlYXRvciIsImNyZWF0ZVZhcmlhYmxlVGVybU9uUGxhdGUiLCJhIiwiY3JlYXRlQ29uc3RhbnRUZXJtT25QbGF0ZSIsImIiLCJtIiwibiIsImNvZWZmaWNpZW50IiwiZ2V0VmFsdWUiLCJ0ZXJtIiwiY3JlYXRlVGVybSIsImRpYW1ldGVyIiwiQklHX1RFUk1fRElBTUVURVIiLCJwdXRUZXJtT25QbGF0ZSIsImNvbnN0YW50VmFsdWUiLCJ4SXNJc29sYXRlZCIsImFUZXJtIiwiZ2V0TGlrZVRlcm1PblBsYXRlIiwiYlRlcm0iLCJtVGVybSIsIm5UZXJtIiwic2hvd0Fuc3dlciIsInZhcmlhYmxlVGVybSIsImZyb21JbnRlZ2VyIiwiY29uc3RhbnRUZXJtIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJTb2x2ZUl0TGV2ZWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU29sdmVJdExldmVsIGlzIGEgbGV2ZWwgaW4gdGhlICdTb2x2ZSBJdCEnIGdhbWUgc2NyZWVuLiBBIGxldmVsIGlzIGEgc3BlY2lhbGl6YXRpb24gb2YgYSBzY2VuZSBmcm9tIHRoZSAnT3BlcmF0aW9ucydcclxuICogc2NyZWVuLiAodmFyaWFibGUgYW5kIGNvbnN0YW50IHRlcm1zIG9uIGJvdGggc2lkZXMgb2YgdGhlIGVxdWF0aW9uKSwgd2l0aCB0aGUgYWRkaXRpb24gb2YgZ2FtZSBjaGFsbGVuZ2VzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBMaW5rYWJsZVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTGlua2FibGVQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSwgeyBERUZBVUxUX1JBTkdFIH0gZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IGRvdFJhbmRvbSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvZG90UmFuZG9tLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgRnJhY3Rpb24gZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy9tb2RlbC9GcmFjdGlvbi5qcyc7XHJcbmltcG9ydCBOdWxsYWJsZUlPIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdWxsYWJsZUlPLmpzJztcclxuaW1wb3J0IEVxdWFsaXR5RXhwbG9yZXJDb25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL0VxdWFsaXR5RXhwbG9yZXJDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgRXF1YWxpdHlFeHBsb3JlclF1ZXJ5UGFyYW1ldGVycyBmcm9tICcuLi8uLi9jb21tb24vRXF1YWxpdHlFeHBsb3JlclF1ZXJ5UGFyYW1ldGVycy5qcyc7XHJcbmltcG9ydCBDb25zdGFudFRlcm0gZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL0NvbnN0YW50VGVybS5qcyc7XHJcbmltcG9ydCBDb25zdGFudFRlcm1DcmVhdG9yIGZyb20gJy4uLy4uL2NvbW1vbi9tb2RlbC9Db25zdGFudFRlcm1DcmVhdG9yLmpzJztcclxuaW1wb3J0IFZhcmlhYmxlVGVybSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvVmFyaWFibGVUZXJtLmpzJztcclxuaW1wb3J0IFZhcmlhYmxlVGVybUNyZWF0b3IgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL1ZhcmlhYmxlVGVybUNyZWF0b3IuanMnO1xyXG5pbXBvcnQgZXF1YWxpdHlFeHBsb3JlciBmcm9tICcuLi8uLi9lcXVhbGl0eUV4cGxvcmVyLmpzJztcclxuaW1wb3J0IE9wZXJhdGlvbnNTY2VuZSwgeyBPcGVyYXRpb25zU2NlbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vb3BlcmF0aW9ucy9tb2RlbC9PcGVyYXRpb25zU2NlbmUuanMnO1xyXG5pbXBvcnQgQ2hhbGxlbmdlIGZyb20gJy4vQ2hhbGxlbmdlLmpzJztcclxuaW1wb3J0IENoYWxsZW5nZUdlbmVyYXRvciBmcm9tICcuL0NoYWxsZW5nZUdlbmVyYXRvci5qcyc7XHJcbmltcG9ydCBEZWJ1Z0NoYWxsZW5nZSBmcm9tICcuL0RlYnVnQ2hhbGxlbmdlLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBQT0lOVFNfUEVSX0NIQUxMRU5HRSA9IDE7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIGxldmVsTnVtYmVyOiBudW1iZXI7XHJcbn07XHJcblxyXG50eXBlIFNvbHZlSXRMZXZlbE9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxPcGVyYXRpb25zU2NlbmVPcHRpb25zLCAndGFuZGVtJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTb2x2ZUl0TGV2ZWwgZXh0ZW5kcyBPcGVyYXRpb25zU2NlbmUge1xyXG5cclxuICAvLyBpbnRlZ2VyLCBzdGFydGluZyBmcm9tIDFcclxuICBwdWJsaWMgcmVhZG9ubHkgbGV2ZWxOdW1iZXI6IG51bWJlcjtcclxuXHJcbiAgLy8gZGVzY3JpcHRpb24gdGhhdCBhcHBlYXJzIGluIHRoZSBVSSBmb3IgdGhlIGxldmVsXHJcbiAgcHVibGljIHJlYWRvbmx5IGRlc2NyaXB0aW9uUHJvcGVydHk6IExpbmthYmxlUHJvcGVydHk8c3RyaW5nPjtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IGNoYWxsZW5nZUdlbmVyYXRvcjogQ2hhbGxlbmdlR2VuZXJhdG9yO1xyXG4gIHB1YmxpYyByZWFkb25seSBzY29yZVByb3BlcnR5OiBOdW1iZXJQcm9wZXJ0eTtcclxuXHJcbiAgLy8gdGhlIGN1cnJlbnQgY2hhbGxlbmdlLCBzZXQgYnkgbmV4dENoYWxsZW5nZVxyXG4gIHB1YmxpYyByZWFkb25seSBjaGFsbGVuZ2VQcm9wZXJ0eTogUHJvcGVydHk8Q2hhbGxlbmdlIHwgbnVsbD47XHJcblxyXG4gIC8vIGhhcyB0aGUgY3VycmVudCBjaGFsbGVuZ2UgYmVlbiBzb2x2ZWQ/XHJcbiAgcHJpdmF0ZSBjaGFsbGVuZ2VIYXNCZWVuU29sdmVkOiBib29sZWFuO1xyXG5cclxuICAvLyB3aWxsIHggYmUgb24gdGhlIGxlZnQtc2lkZSAodHJ1ZSkgb3IgcmlnaHQtc2lkZSAoZmFsc2UpIG9mIHRoZSBlcXVhdGlvbiBpbiB0aGUgc29sdXRpb24/XHJcbiAgcHJpdmF0ZSB4T25MZWZ0OiBib29sZWFuO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGxlZnRWYXJpYWJsZVRlcm1DcmVhdG9yOiBWYXJpYWJsZVRlcm1DcmVhdG9yO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbGVmdENvbnN0YW50VGVybUNyZWF0b3I6IENvbnN0YW50VGVybUNyZWF0b3I7XHJcbiAgcHJpdmF0ZSByZWFkb25seSByaWdodFZhcmlhYmxlVGVybUNyZWF0b3I6IFZhcmlhYmxlVGVybUNyZWF0b3I7XHJcbiAgcHJpdmF0ZSByZWFkb25seSByaWdodENvbnN0YW50VGVybUNyZWF0b3I6IENvbnN0YW50VGVybUNyZWF0b3I7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggZGVzY3JpcHRpb25Qcm9wZXJ0eTogTGlua2FibGVQcm9wZXJ0eTxzdHJpbmc+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgY2hhbGxlbmdlR2VuZXJhdG9yOiBDaGFsbGVuZ2VHZW5lcmF0b3IsXHJcbiAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnM6IFNvbHZlSXRMZXZlbE9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxTb2x2ZUl0TGV2ZWxPcHRpb25zLCBTZWxmT3B0aW9ucywgT3BlcmF0aW9uc1NjZW5lT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gT3BlcmF0aW9uc1NjZW5lT3B0aW9uc1xyXG4gICAgICBsb2NrYWJsZTogZmFsc2UsIC8vIGxvY2sgZmVhdHVyZSBpcyByZWxldmFudCBmb3IgdGhlIGdhbWVcclxuICAgICAgc2NhbGVQb3NpdGlvbjogbmV3IFZlY3RvcjIoIDM1NSwgNTAwICksIC8vIGRldGVybWluZWQgZW1waXJpY2FsbHlcclxuICAgICAgdmFyaWFibGVSYW5nZTogREVGQVVMVF9SQU5HRSAvLyBiZWNhdXNlIHZhcmlhYmxlcyBhcmUgbm90IHVzZXItY29udHJvbGxlZCBpbiBhIGdhbWUgbGV2ZWxcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIE51bWJlci5pc0ludGVnZXIoIG9wdGlvbnMubGV2ZWxOdW1iZXIgKSAmJiBvcHRpb25zLmxldmVsTnVtYmVyID4gMCApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5sZXZlbE51bWJlciA9IG9wdGlvbnMubGV2ZWxOdW1iZXI7XHJcbiAgICB0aGlzLmRlc2NyaXB0aW9uUHJvcGVydHkgPSBkZXNjcmlwdGlvblByb3BlcnR5O1xyXG4gICAgdGhpcy5jaGFsbGVuZ2VHZW5lcmF0b3IgPSBjaGFsbGVuZ2VHZW5lcmF0b3I7XHJcblxyXG4gICAgdGhpcy5zY29yZVByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCAwLCB7XHJcbiAgICAgIG51bWJlclR5cGU6ICdJbnRlZ2VyJyxcclxuICAgICAgaXNWYWxpZFZhbHVlOiB2YWx1ZSA9PiAoIHZhbHVlID49IDAgKSwgLy8gdGhlIGdhbWUgaXMgb3Blbi1lbmRlZCwgc28gdGhlcmUgaXMgbm8gbWF4aW11bSBzY29yZVxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Njb3JlUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZSBwb3NpdGlvbnMgb2YgdGVybSBjcmVhdG9ycy4gVGhpcyBpcyBuZWNlc3NhcnkgYmVjYXVzZSB0aGlzIHNjcmVlbiBoYXMgbm8gVGVybVRvb2xib3hlcy5cclxuICAgIC8vIFBvc2l0aW9ucyBjYW4gYmUgYW55IHZhbHVlLCBzaW5jZSB0ZXJtcyBpbiB0aGlzIHNjcmVlbiBuZXZlciByZXR1cm4gdG8gYSB0b29sYm94LlxyXG4gICAgLy8gVGhpcyBpcyBwcmVmZXJhYmxlIHRvIHVzaW5nIGEgZGVmYXVsdCB2YWx1ZSwgc2luY2UgaW5pdGlhbGl6YXRpb24gb3JkZXIgaXMgaW1wb3J0YW50IGluIG90aGVyIHNjcmVlbnMuXHJcbiAgICAvLyBTZWUgZm9yIGV4YW1wbGUgZnJhbWVTdGFydGVkQ2FsbGJhY2sgaW4gVGVybUNyZWF0b3JOb2RlLlxyXG4gICAgdGhpcy5hbGxUZXJtQ3JlYXRvcnMuZm9yRWFjaCggdGVybUNyZWF0b3IgPT4ge1xyXG4gICAgICB0ZXJtQ3JlYXRvci5wb3NpdGl2ZVBvc2l0aW9uID0gVmVjdG9yMi5aRVJPO1xyXG4gICAgICB0ZXJtQ3JlYXRvci5uZWdhdGl2ZVBvc2l0aW9uID0gVmVjdG9yMi5aRVJPO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFRoZSBpbml0aWFsIHZhbHVlIGlzIG51bGwgYmVjYXVzZSB3ZSBkb24ndCB3YW50IHRvIHJlc3RvcmUgdGhlIHNhbWUgQ2hhbGxlbmdlIHdoZW4gdGhlIHNpbSBpcyByZXNldC5cclxuICAgIHRoaXMuY2hhbGxlbmdlUHJvcGVydHkgPSBuZXcgUHJvcGVydHk8Q2hhbGxlbmdlIHwgbnVsbD4oIG51bGwsIHtcclxuICAgICAgaXNWYWxpZFZhbHVlOiB2YWx1ZSA9PiAoIHZhbHVlIGluc3RhbmNlb2YgQ2hhbGxlbmdlICkgfHwgKCB2YWx1ZSA9PT0gbnVsbCApLFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NoYWxsZW5nZVByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9WYWx1ZVR5cGU6IE51bGxhYmxlSU8oIENoYWxsZW5nZS5DaGFsbGVuZ2VJTyApLFxyXG4gICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuY2hhbGxlbmdlSGFzQmVlblNvbHZlZCA9IGZhbHNlO1xyXG4gICAgdGhpcy54T25MZWZ0ID0gdHJ1ZTtcclxuXHJcbiAgICAvLyBDYXN0aW5nIGhlcmUgaXMgbm90IGdyZWF0LCBidXQgYWxsb3dzIHVzIHRvIHJldXNlIE9wZXJhdGlvbnNTY2VuZS5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMubGVmdFRlcm1DcmVhdG9ycy5sZW5ndGggPT09IDIgJiYgdGhpcy5sZWZ0VGVybUNyZWF0b3JzWyAwIF0gaW5zdGFuY2VvZiBWYXJpYWJsZVRlcm1DcmVhdG9yICYmIHRoaXMubGVmdFRlcm1DcmVhdG9yc1sgMSBdIGluc3RhbmNlb2YgQ29uc3RhbnRUZXJtQ3JlYXRvciApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5yaWdodFRlcm1DcmVhdG9ycy5sZW5ndGggPT09IDIgJiYgdGhpcy5yaWdodFRlcm1DcmVhdG9yc1sgMCBdIGluc3RhbmNlb2YgVmFyaWFibGVUZXJtQ3JlYXRvciAmJiB0aGlzLnJpZ2h0VGVybUNyZWF0b3JzWyAxIF0gaW5zdGFuY2VvZiBDb25zdGFudFRlcm1DcmVhdG9yICk7XHJcbiAgICB0aGlzLmxlZnRWYXJpYWJsZVRlcm1DcmVhdG9yID0gdGhpcy5sZWZ0VGVybUNyZWF0b3JzWyAwIF0gYXMgVmFyaWFibGVUZXJtQ3JlYXRvcjtcclxuICAgIHRoaXMubGVmdENvbnN0YW50VGVybUNyZWF0b3IgPSB0aGlzLmxlZnRUZXJtQ3JlYXRvcnNbIDEgXSBhcyBDb25zdGFudFRlcm1DcmVhdG9yO1xyXG4gICAgdGhpcy5yaWdodFZhcmlhYmxlVGVybUNyZWF0b3IgPSB0aGlzLnJpZ2h0VGVybUNyZWF0b3JzWyAwIF0gYXMgVmFyaWFibGVUZXJtQ3JlYXRvcjtcclxuICAgIHRoaXMucmlnaHRDb25zdGFudFRlcm1DcmVhdG9yID0gdGhpcy5yaWdodFRlcm1DcmVhdG9yc1sgMSBdIGFzIENvbnN0YW50VGVybUNyZWF0b3I7XHJcblxyXG4gICAgLy8gV2hlbiBhIHVuaXZlcnNhbCBvcGVyYXRpb24gaXMgY29tcGxldGVkLCBkZXRlcm1pbmUgaWYgdGhlIGNoYWxsZW5nZSBpcyBzb2x2ZWQuXHJcbiAgICB0aGlzLm9wZXJhdGlvbkNvbXBsZXRlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIG9wZXJhdGlvbiA9PiB7XHJcblxyXG4gICAgICAvLyBBbGwgY2hhbGxlbmdlcyBpbiB0aGUgZ2FtZSBhcmUgZXF1YWxpdGllcywgYW5kIGFwcGx5aW5nIGEgdW5pdmVyc2FsIG9wZXJhdGlvbiBzaG91bGQgcmVzdWx0IGluIGFuIGVxdWFsaXR5LlxyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLnNjYWxlLmFuZ2xlUHJvcGVydHkudmFsdWUgPT09IDAsXHJcbiAgICAgICAgYHNjYWxlIGlzIG5vdCBiYWxhbmNlZCBhZnRlciBhcHBseWluZyBvcGVyYXRpb24gJHtvcGVyYXRpb259YCApO1xyXG5cclxuICAgICAgLy8gY2hhbGxlbmdlIGlzIGluIGEgJ3NvbHZlZCcgc3RhdGUgaWYgeCBoYXMgYmVlbiBpc29sYXRlZCBvbiB0aGUgc2NhbGUuXHJcbiAgICAgIGNvbnN0IHNvbHZlZCA9IHRoaXMuaXNYSXNvbGF0ZWQoKTtcclxuXHJcbiAgICAgIC8vIFRoZSBmaXJzdCB0aW1lIHRoYXQgdGhlIGNoYWxsZW5nZSBoYXMgYmVlbiBzb2x2ZWQsIGF3YXJkIHBvaW50cyBhbmQgbm90aWZ5IGxpc3RlbmVycy5cclxuICAgICAgaWYgKCBzb2x2ZWQgJiYgIXRoaXMuY2hhbGxlbmdlSGFzQmVlblNvbHZlZCApIHtcclxuICAgICAgICBwaGV0LmxvZyAmJiBwaGV0LmxvZyggJ29wZXJhdGlvbkNvbXBsZXRlZEVtaXR0ZXIgbGlzdGVuZXI6IGNoYWxsZW5nZSBpcyBzb2x2ZWQnICk7XHJcbiAgICAgICAgdGhpcy5jaGFsbGVuZ2VIYXNCZWVuU29sdmVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnNjb3JlUHJvcGVydHkudmFsdWUgPSB0aGlzLnNjb3JlUHJvcGVydHkudmFsdWUgKyBQT0lOVFNfUEVSX0NIQUxMRU5HRTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuYWRkTGlua2VkRWxlbWVudCggZGVzY3JpcHRpb25Qcm9wZXJ0eSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2Rlc2NyaXB0aW9uUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLnNjb3JlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMuY2hhbGxlbmdlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHN1cGVyLnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZXMgdGhlIG5leHQgY2hhbGxlbmdlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBuZXh0Q2hhbGxlbmdlKCk6IHZvaWQge1xyXG5cclxuICAgIC8vIHJlc2V0IHRoZSB1bml2ZXJzYWwgb3BlcmF0aW9uXHJcbiAgICB0aGlzLm9wZXJhdG9yUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMub3BlcmFuZFByb3BlcnR5LnJlc2V0KCk7XHJcblxyXG4gICAgLy8gY2xlYXIgc25hcHNob3RzXHJcbiAgICB0aGlzLnNuYXBzaG90c0NvbGxlY3Rpb24ucmVzZXQoKTtcclxuXHJcbiAgICAvLyBkaXNwb3NlIG9mIGFsbCB0ZXJtc1xyXG4gICAgdGhpcy5hbGxUZXJtQ3JlYXRvcnMuZm9yRWFjaCggdGVybUNyZWF0b3IgPT4gdGVybUNyZWF0b3IuZGlzcG9zZUFsbFRlcm1zKCkgKTtcclxuXHJcbiAgICAvLyBnZW5lcmF0ZSB0aGUgY2hhbGxlbmdlLCBmb3JtIGlzOiBheCArIGIgPSBteCArIG5cclxuICAgIGxldCBjaGFsbGVuZ2UgPSB0aGlzLmNoYWxsZW5nZUdlbmVyYXRvci5uZXh0Q2hhbGxlbmdlKCk7XHJcbiAgICBpZiAoIEVxdWFsaXR5RXhwbG9yZXJRdWVyeVBhcmFtZXRlcnMuY2hhbGxlbmdlICkge1xyXG4gICAgICBjaGFsbGVuZ2UgPSBuZXcgRGVidWdDaGFsbGVuZ2UoKTtcclxuICAgIH1cclxuICAgIHBoZXQubG9nICYmIHBoZXQubG9nKCBgbmV4dENoYWxsZW5nZTogY2hhbGxlbmdlPSR7Y2hhbGxlbmdlfWAgKTtcclxuICAgIHBoZXQubG9nICYmIHBoZXQubG9nKCBgbmV4dENoYWxsZW5nZTogZGVyaXZhdGlvbj0ke2NoYWxsZW5nZS5kZWJ1Z0Rlcml2YXRpb24ucmVwbGFjZSggLzxicj4vZywgJywgJyApfWAgKTtcclxuXHJcbiAgICAvLyBzZXQgdGhlIHZhbHVlIG9mIHhcclxuICAgIHRoaXMueC52YWx1ZVByb3BlcnR5LnZhbHVlID0gY2hhbGxlbmdlLng7XHJcblxyXG4gICAgLy8gcmFuZG9taXplIHdoZXRoZXIgdGhlIHNjYWxlIHNob3dzICdheCArIGIgPSBteCArIG4nIG9yICdteCArIG4gPSBheCArIGInXHJcbiAgICB0aGlzLnhPbkxlZnQgPSBkb3RSYW5kb20ubmV4dEJvb2xlYW4oKTtcclxuICAgIGNvbnN0IGFUZXJtQ3JlYXRvciA9IHRoaXMueE9uTGVmdCA/IHRoaXMubGVmdFZhcmlhYmxlVGVybUNyZWF0b3IgOiB0aGlzLnJpZ2h0VmFyaWFibGVUZXJtQ3JlYXRvcjtcclxuICAgIGNvbnN0IGJUZXJtQ3JlYXRvciA9IHRoaXMueE9uTGVmdCA/IHRoaXMubGVmdENvbnN0YW50VGVybUNyZWF0b3IgOiB0aGlzLnJpZ2h0Q29uc3RhbnRUZXJtQ3JlYXRvcjtcclxuICAgIGNvbnN0IG1UZXJtQ3JlYXRvciA9IHRoaXMueE9uTGVmdCA/IHRoaXMucmlnaHRWYXJpYWJsZVRlcm1DcmVhdG9yIDogdGhpcy5sZWZ0VmFyaWFibGVUZXJtQ3JlYXRvcjtcclxuICAgIGNvbnN0IG5UZXJtQ3JlYXRvciA9IHRoaXMueE9uTGVmdCA/IHRoaXMucmlnaHRDb25zdGFudFRlcm1DcmVhdG9yIDogdGhpcy5sZWZ0Q29uc3RhbnRUZXJtQ3JlYXRvcjtcclxuXHJcbiAgICAvLyBDcmVhdGUgdGVybXMgb24gdGhlIHNjYWxlIHRoYXQgY29ycmVzcG9uZCB0byB0aGUgY2hhbGxlbmdlLlxyXG4gICAgdGhpcy5jcmVhdGVWYXJpYWJsZVRlcm1PblBsYXRlKCBhVGVybUNyZWF0b3IsIGNoYWxsZW5nZS5hICk7XHJcbiAgICB0aGlzLmNyZWF0ZUNvbnN0YW50VGVybU9uUGxhdGUoIGJUZXJtQ3JlYXRvciwgY2hhbGxlbmdlLmIgKTtcclxuICAgIHRoaXMuY3JlYXRlVmFyaWFibGVUZXJtT25QbGF0ZSggbVRlcm1DcmVhdG9yLCBjaGFsbGVuZ2UubSApO1xyXG4gICAgdGhpcy5jcmVhdGVDb25zdGFudFRlcm1PblBsYXRlKCBuVGVybUNyZWF0b3IsIGNoYWxsZW5nZS5uICk7XHJcblxyXG4gICAgLy8gVGhlIG5ldyBjaGFsbGVuZ2UgaGFzIG5vdCBiZWVuIHNvbHZlZFxyXG4gICAgdGhpcy5jaGFsbGVuZ2VIYXNCZWVuU29sdmVkID0gZmFsc2U7XHJcblxyXG4gICAgLy8gRmluYWxseSwgc2V0IGNoYWxsZW5nZVByb3BlcnR5LCB0byBub3RpZnkgbGlzdGVuZXJzIHRoYXQgdGhlIGNoYWxsZW5nZSBoYXMgY2hhbmdlZC5cclxuICAgIHRoaXMuY2hhbGxlbmdlUHJvcGVydHkudmFsdWUgPSBjaGFsbGVuZ2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgdmFyaWFibGUgdGVybSBvbiB0aGUgcGxhdGUuIElmIGNvZWZmaWNpZW50IGlzIHplcm8sIHRoaXMgaXMgYSBuby1vcC5cclxuICAgKi9cclxuICBwcml2YXRlIGNyZWF0ZVZhcmlhYmxlVGVybU9uUGxhdGUoIHRlcm1DcmVhdG9yOiBWYXJpYWJsZVRlcm1DcmVhdG9yLCBjb2VmZmljaWVudDogRnJhY3Rpb24gKTogdm9pZCB7XHJcbiAgICBpZiAoIGNvZWZmaWNpZW50LmdldFZhbHVlKCkgIT09IDAgKSB7XHJcbiAgICAgIGNvbnN0IHRlcm0gPSB0ZXJtQ3JlYXRvci5jcmVhdGVUZXJtKCB7XHJcbiAgICAgICAgY29lZmZpY2llbnQ6IGNvZWZmaWNpZW50LFxyXG4gICAgICAgIGRpYW1ldGVyOiBFcXVhbGl0eUV4cGxvcmVyQ29uc3RhbnRzLkJJR19URVJNX0RJQU1FVEVSXHJcbiAgICAgIH0gKTtcclxuICAgICAgdGVybUNyZWF0b3IucHV0VGVybU9uUGxhdGUoIHRlcm0gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBjb25zdGFudCB0ZXJtIG9uIHRoZSBwbGF0ZS4gSWYgY29uc3RhbnRWYWx1ZSBpcyB6ZXJvLCB0aGlzIGlzIGEgbm8tb3AuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjcmVhdGVDb25zdGFudFRlcm1PblBsYXRlKCB0ZXJtQ3JlYXRvcjogQ29uc3RhbnRUZXJtQ3JlYXRvciwgY29uc3RhbnRWYWx1ZTogRnJhY3Rpb24gKTogdm9pZCB7XHJcbiAgICBpZiAoIGNvbnN0YW50VmFsdWUuZ2V0VmFsdWUoKSAhPT0gMCApIHtcclxuICAgICAgY29uc3QgdGVybSA9IHRlcm1DcmVhdG9yLmNyZWF0ZVRlcm0oIHtcclxuICAgICAgICBjb25zdGFudFZhbHVlOiBjb25zdGFudFZhbHVlLFxyXG4gICAgICAgIGRpYW1ldGVyOiBFcXVhbGl0eUV4cGxvcmVyQ29uc3RhbnRzLkJJR19URVJNX0RJQU1FVEVSXHJcbiAgICAgIH0gKTtcclxuICAgICAgdGVybUNyZWF0b3IucHV0VGVybU9uUGxhdGUoIHRlcm0gKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERldGVybWluZXMgd2hldGhlciB0aGUgdmFsdWUgb2YgeCBoYXMgYmVlbiBpc29sYXRlZCBvbiB0aGUgc2NhbGUuXHJcbiAgICogVGhpcyBtZWFucyB0aGF0IHRoZSBzY2FsZSBjb250YWlucyBlaXRoZXIgJ3ggPSBuJyBvciAnYiA9IHgnLCB3aGVyZSAnYXggKyBiID0gbXggKyBuJyBpcyB0aGUgZ2VuZXJhbCBmb3JtLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNYSXNvbGF0ZWQoKTogYm9vbGVhbiB7XHJcblxyXG4gICAgbGV0IHhJc0lzb2xhdGVkID0gZmFsc2U7XHJcblxyXG4gICAgLy8gYSwgYiwgbSwgblxyXG4gICAgY29uc3QgYVRlcm0gPSB0aGlzLmxlZnRWYXJpYWJsZVRlcm1DcmVhdG9yLmdldExpa2VUZXJtT25QbGF0ZSgpO1xyXG4gICAgY29uc3QgYlRlcm0gPSB0aGlzLmxlZnRDb25zdGFudFRlcm1DcmVhdG9yLmdldExpa2VUZXJtT25QbGF0ZSgpO1xyXG4gICAgY29uc3QgbVRlcm0gPSB0aGlzLnJpZ2h0VmFyaWFibGVUZXJtQ3JlYXRvci5nZXRMaWtlVGVybU9uUGxhdGUoKTtcclxuICAgIGNvbnN0IG5UZXJtID0gdGhpcy5yaWdodENvbnN0YW50VGVybUNyZWF0b3IuZ2V0TGlrZVRlcm1PblBsYXRlKCk7XHJcblxyXG4gICAgaWYgKCAoIGFUZXJtICYmICFiVGVybSAmJiAhbVRlcm0gJiYgblRlcm0gKSApIHtcclxuICAgICAgLy8gYXggKyAwID0gMHggKyBuXHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIGFUZXJtIGluc3RhbmNlb2YgVmFyaWFibGVUZXJtICk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2ltcGxlLXR5cGUtY2hlY2tpbmctYXNzZXJ0aW9uc1xyXG4gICAgICB4SXNJc29sYXRlZCA9ICggKCBhVGVybSBhcyBWYXJpYWJsZVRlcm0gKS5jb2VmZmljaWVudC5nZXRWYWx1ZSgpID09PSAxICk7IC8vIHggPSBuXHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggIWFUZXJtICYmIGJUZXJtICYmIG1UZXJtICYmICFuVGVybSApIHtcclxuICAgICAgLy8gMHggKyBiID0gbXggKyAwXHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIG1UZXJtIGluc3RhbmNlb2YgVmFyaWFibGVUZXJtICk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2ltcGxlLXR5cGUtY2hlY2tpbmctYXNzZXJ0aW9uc1xyXG4gICAgICB4SXNJc29sYXRlZCA9ICggKCBtVGVybSBhcyBWYXJpYWJsZVRlcm0gKS5jb2VmZmljaWVudC5nZXRWYWx1ZSgpID09PSAxICk7IC8vIGIgPSB4XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHhJc0lzb2xhdGVkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGlzcGxheXMgdGhlIGFuc3dlciB0byB0aGUgY3VycmVudCBjaGFsbGVuZ2UsIGZvciBkZWJ1Z2dpbmcuXHJcbiAgICovXHJcbiAgcHVibGljIHNob3dBbnN3ZXIoKTogdm9pZCB7XHJcblxyXG4gICAgLy8gMCA9IDBcclxuICAgIHRoaXMuYWxsVGVybUNyZWF0b3JzLmZvckVhY2goIHRlcm1DcmVhdG9yID0+IHRlcm1DcmVhdG9yLmRpc3Bvc2VBbGxUZXJtcygpICk7XHJcblxyXG4gICAgLy8geFxyXG4gICAgY29uc3QgdmFyaWFibGVUZXJtID0gbmV3IFZhcmlhYmxlVGVybSggdGhpcy54LCB7IC8vVE9ETyBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZXF1YWxpdHktZXhwbG9yZXIvaXNzdWVzLzIwMCBkeW5hbWljXHJcbiAgICAgIGNvZWZmaWNpZW50OiBGcmFjdGlvbi5mcm9tSW50ZWdlciggMSApLFxyXG4gICAgICBkaWFtZXRlcjogRXF1YWxpdHlFeHBsb3JlckNvbnN0YW50cy5CSUdfVEVSTV9ESUFNRVRFUlxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIE5cclxuICAgIGNvbnN0IGNvbnN0YW50VGVybSA9IG5ldyBDb25zdGFudFRlcm0oIHsgLy9UT0RPIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9lcXVhbGl0eS1leHBsb3Jlci9pc3N1ZXMvMjAwIGR5bmFtaWNcclxuICAgICAgY29uc3RhbnRWYWx1ZTogRnJhY3Rpb24uZnJvbUludGVnZXIoIHRoaXMueC52YWx1ZVByb3BlcnR5LnZhbHVlICksXHJcbiAgICAgIGRpYW1ldGVyOiBFcXVhbGl0eUV4cGxvcmVyQ29uc3RhbnRzLkJJR19URVJNX0RJQU1FVEVSXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8geCA9IE5cclxuICAgIGlmICggdGhpcy54T25MZWZ0ICkge1xyXG4gICAgICB0aGlzLmxlZnRWYXJpYWJsZVRlcm1DcmVhdG9yLnB1dFRlcm1PblBsYXRlKCB2YXJpYWJsZVRlcm0gKTtcclxuICAgICAgdGhpcy5yaWdodENvbnN0YW50VGVybUNyZWF0b3IucHV0VGVybU9uUGxhdGUoIGNvbnN0YW50VGVybSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMucmlnaHRWYXJpYWJsZVRlcm1DcmVhdG9yLnB1dFRlcm1PblBsYXRlKCB2YXJpYWJsZVRlcm0gKTtcclxuICAgICAgdGhpcy5sZWZ0Q29uc3RhbnRUZXJtQ3JlYXRvci5wdXRUZXJtT25QbGF0ZSggY29uc3RhbnRUZXJtICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaW5kaWNhdGUgdGhhdCB0aGUgY2hhbGxlbmdlIGhhcyBiZWVuIHNvbHZlZFxyXG4gICAgdGhpcy5jaGFsbGVuZ2VIYXNCZWVuU29sdmVkID0gdHJ1ZTtcclxuICAgIHRoaXMuc2NvcmVQcm9wZXJ0eS52YWx1ZSA9IHRoaXMuc2NvcmVQcm9wZXJ0eS52YWx1ZSArIFBPSU5UU19QRVJfQ0hBTExFTkdFO1xyXG4gIH1cclxufVxyXG5cclxuZXF1YWxpdHlFeHBsb3Jlci5yZWdpc3RlciggJ1NvbHZlSXRMZXZlbCcsIFNvbHZlSXRMZXZlbCApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLE9BQU9BLGNBQWMsSUFBSUMsYUFBYSxRQUFRLHVDQUF1QztBQUNyRixPQUFPQyxRQUFRLE1BQU0saUNBQWlDO0FBQ3RELE9BQU9DLFNBQVMsTUFBTSxpQ0FBaUM7QUFDdkQsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxTQUFTLE1BQU0sdUNBQXVDO0FBRTdELE9BQU9DLFFBQVEsTUFBTSw2Q0FBNkM7QUFDbEUsT0FBT0MsVUFBVSxNQUFNLDJDQUEyQztBQUNsRSxPQUFPQyx5QkFBeUIsTUFBTSwyQ0FBMkM7QUFDakYsT0FBT0MsK0JBQStCLE1BQU0saURBQWlEO0FBQzdGLE9BQU9DLFlBQVksTUFBTSxvQ0FBb0M7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