// Copyright 2017-2023, University of Colorado Boulder

/**
 * Common type for model items in inverse square law sims.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import Emitter from '../../../axon/js/Emitter.js';
import NumberProperty from '../../../axon/js/NumberProperty.js';
import Property from '../../../axon/js/Property.js';
import Range from '../../../dot/js/Range.js';
import merge from '../../../phet-core/js/merge.js';
import NumberIO from '../../../tandem/js/types/NumberIO.js';
import inverseSquareLawCommon from '../inverseSquareLawCommon.js';
import ISLCConstants from '../ISLCConstants.js';
import ISLCObjectEnum from './ISLCObjectEnum.js';
class ISLCObject {
  /**
   * @param {number} initialMass
   * @param {Vector2} initialPosition
   * @param {Range} valueRange
   * @param {Property.<boolean>} constantRadiusProperty
   * @param {function(mass:number):number} calculateRadius - function to get the radius based on the mass
   * @param {Tandem} tandem
   * @param {Object} [options]
   */
  constructor(initialMass, initialPosition, valueRange, constantRadiusProperty, calculateRadius, tandem, options) {
    options = merge({
      // in meters
      leftObjectBoundary: ISLCConstants.LEFT_OBJECT_BOUNDARY,
      rightObjectBoundary: ISLCConstants.RIGHT_OBJECT_BOUNDARY,
      constantRadius: ISLCConstants.CONSTANT_RADIUS,
      // radius when constant

      valueUnits: 'kg'
    }, options);

    // @public
    this.positionProperty = new NumberProperty(initialPosition, {
      tandem: tandem.createTandem('positionProperty'),
      units: 'm',
      range: new Range(options.leftObjectBoundary, options.rightObjectBoundary),
      phetioDocumentation: 'The position of the object along the track, in meters. The origin is in the center between the two objects.'
    });

    // @public {Property.<number>} - the mass or charge of the object in kilograms or coulombs
    this.valueProperty = new NumberProperty(initialMass, {
      tandem: tandem.createTandem('valueProperty'),
      range: valueRange,
      units: options.valueUnits,
      phetioDocumentation: 'The value of the object'
    });

    // @public (read-only) {function(mass:number):number}
    this.calculateRadius = calculateRadius;

    // @public {Property.<number>} - the radius of the mass or charge in meters
    // since ISLCObjects are never destroyed, no need to dispose
    this.radiusProperty = new DerivedProperty([this.valueProperty, constantRadiusProperty], (objectValue, constantRadius) => {
      return constantRadius ? options.constantRadius : calculateRadius(objectValue);
    }, {
      tandem: tandem.createTandem('radiusProperty'),
      phetioDocumentation: 'The radius of the object',
      units: 'm',
      phetioValueType: NumberIO
    });
    const enabledRange = new Range(options.leftObjectBoundary, options.rightObjectBoundary);

    // @public {Property.<Range>}- set by ISLCModel when the force changes, the range for position of the objects
    // based on their radius and position
    this.enabledRangeProperty = new Property(enabledRange, {
      tandem: tandem.createTandem('enabledRangeProperty'),
      phetioDocumentation: 'The range for position of this object based on the radius and position of both objects',
      phetioValueType: Range.RangeIO,
      phetioReadOnly: true
    });

    // @public (read-only) - Emitter that fires whenever the position changes as a result of an object's value changing.
    // Emits with the objectEnum that caused the position change.
    this.positionChangedFromSecondarySourceEmitter = new Emitter({
      parameters: [{
        valueType: ISLCObjectEnum
      }]
    });

    // @public - flag to check if the object is being dragged by the user
    //           set in the drag handler
    this.isDraggingProperty = new BooleanProperty(false);

    // @public - flag to check whether object's radius was updated, used to determine positioning
    this.radiusLastChanged = false;

    // @private - flag flipped when the value change is updated. This is used to check if a position change is caused
    // from a value change. See https://github.com/phetsims/gravity-force-lab-basics/issues/168
    this.valueChangedSinceLastStep = false;

    // @public (read-only) - flag flipped when the constant radius boolean is toggled. This is used to check if a position change is
    // caused from the constant radius toggling. See https://github.com/phetsims/gravity-force-lab-basics/issues/168
    this.constantRadiusChangedSinceLastStep = false;

    // @public
    this.valueRange = valueRange;

    // @public {ISLCObjectEnum|null} - filled in by ISLCModel
    this.enum = null;

    // @public {Property.<Color>} - filled in by subtypes
    // - object node color is will change with value (linked in ISLCObjectNode.js)
    //   - color Property will be updated based on a boolean value (negative vs positive)
    //   - brightness will be set according to the Mass/Charge magnitude
    this.baseColorProperty = null;

    // @public (read-only) {number} - the radius of the object when radius is constant.
    this.constantRadius = options.constantRadius;

    // Link these flags to their associatedProperties
    this.valueProperty.link(() => {
      this.valueChangedSinceLastStep = true;
    });
    constantRadiusProperty.link(() => {
      this.constantRadiusChangedSinceLastStep = true;
    });
  }

  /**
   * Clear flags that keep track of data that needs to be kept track of until the next step function is called.
   * @public
   */
  onStepEnd() {
    this.valueChangedSinceLastStep = false;
    this.constantRadiusChangedSinceLastStep = false;
  }

  /**
   * Resets object model properties.
   *
   * @public
   */
  reset() {
    this.valueProperty.reset();
    this.positionProperty.reset();
  }
}
inverseSquareLawCommon.register('ISLCObject', ISLCObject);
export default ISLCObject;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJFbWl0dGVyIiwiTnVtYmVyUHJvcGVydHkiLCJQcm9wZXJ0eSIsIlJhbmdlIiwibWVyZ2UiLCJOdW1iZXJJTyIsImludmVyc2VTcXVhcmVMYXdDb21tb24iLCJJU0xDQ29uc3RhbnRzIiwiSVNMQ09iamVjdEVudW0iLCJJU0xDT2JqZWN0IiwiY29uc3RydWN0b3IiLCJpbml0aWFsTWFzcyIsImluaXRpYWxQb3NpdGlvbiIsInZhbHVlUmFuZ2UiLCJjb25zdGFudFJhZGl1c1Byb3BlcnR5IiwiY2FsY3VsYXRlUmFkaXVzIiwidGFuZGVtIiwib3B0aW9ucyIsImxlZnRPYmplY3RCb3VuZGFyeSIsIkxFRlRfT0JKRUNUX0JPVU5EQVJZIiwicmlnaHRPYmplY3RCb3VuZGFyeSIsIlJJR0hUX09CSkVDVF9CT1VOREFSWSIsImNvbnN0YW50UmFkaXVzIiwiQ09OU1RBTlRfUkFESVVTIiwidmFsdWVVbml0cyIsInBvc2l0aW9uUHJvcGVydHkiLCJjcmVhdGVUYW5kZW0iLCJ1bml0cyIsInJhbmdlIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsInZhbHVlUHJvcGVydHkiLCJyYWRpdXNQcm9wZXJ0eSIsIm9iamVjdFZhbHVlIiwicGhldGlvVmFsdWVUeXBlIiwiZW5hYmxlZFJhbmdlIiwiZW5hYmxlZFJhbmdlUHJvcGVydHkiLCJSYW5nZUlPIiwicGhldGlvUmVhZE9ubHkiLCJwb3NpdGlvbkNoYW5nZWRGcm9tU2Vjb25kYXJ5U291cmNlRW1pdHRlciIsInBhcmFtZXRlcnMiLCJ2YWx1ZVR5cGUiLCJpc0RyYWdnaW5nUHJvcGVydHkiLCJyYWRpdXNMYXN0Q2hhbmdlZCIsInZhbHVlQ2hhbmdlZFNpbmNlTGFzdFN0ZXAiLCJjb25zdGFudFJhZGl1c0NoYW5nZWRTaW5jZUxhc3RTdGVwIiwiZW51bSIsImJhc2VDb2xvclByb3BlcnR5IiwibGluayIsIm9uU3RlcEVuZCIsInJlc2V0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJJU0xDT2JqZWN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIENvbW1vbiB0eXBlIGZvciBtb2RlbCBpdGVtcyBpbiBpbnZlcnNlIHNxdWFyZSBsYXcgc2ltcy5cclxuICpcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmcgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRW1pdHRlciBmcm9tICcuLi8uLi8uLi9heG9uL2pzL0VtaXR0ZXIuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFJhbmdlIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgTnVtYmVySU8gZnJvbSAnLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL051bWJlcklPLmpzJztcclxuaW1wb3J0IGludmVyc2VTcXVhcmVMYXdDb21tb24gZnJvbSAnLi4vaW52ZXJzZVNxdWFyZUxhd0NvbW1vbi5qcyc7XHJcbmltcG9ydCBJU0xDQ29uc3RhbnRzIGZyb20gJy4uL0lTTENDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgSVNMQ09iamVjdEVudW0gZnJvbSAnLi9JU0xDT2JqZWN0RW51bS5qcyc7XHJcblxyXG5jbGFzcyBJU0xDT2JqZWN0IHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IGluaXRpYWxNYXNzXHJcbiAgICogQHBhcmFtIHtWZWN0b3IyfSBpbml0aWFsUG9zaXRpb25cclxuICAgKiBAcGFyYW0ge1JhbmdlfSB2YWx1ZVJhbmdlXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IGNvbnN0YW50UmFkaXVzUHJvcGVydHlcclxuICAgKiBAcGFyYW0ge2Z1bmN0aW9uKG1hc3M6bnVtYmVyKTpudW1iZXJ9IGNhbGN1bGF0ZVJhZGl1cyAtIGZ1bmN0aW9uIHRvIGdldCB0aGUgcmFkaXVzIGJhc2VkIG9uIHRoZSBtYXNzXHJcbiAgICogQHBhcmFtIHtUYW5kZW19IHRhbmRlbVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggaW5pdGlhbE1hc3MsIGluaXRpYWxQb3NpdGlvbiwgdmFsdWVSYW5nZSwgY29uc3RhbnRSYWRpdXNQcm9wZXJ0eSwgY2FsY3VsYXRlUmFkaXVzLCB0YW5kZW0sIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcblxyXG4gICAgICAvLyBpbiBtZXRlcnNcclxuICAgICAgbGVmdE9iamVjdEJvdW5kYXJ5OiBJU0xDQ29uc3RhbnRzLkxFRlRfT0JKRUNUX0JPVU5EQVJZLFxyXG4gICAgICByaWdodE9iamVjdEJvdW5kYXJ5OiBJU0xDQ29uc3RhbnRzLlJJR0hUX09CSkVDVF9CT1VOREFSWSxcclxuICAgICAgY29uc3RhbnRSYWRpdXM6IElTTENDb25zdGFudHMuQ09OU1RBTlRfUkFESVVTLCAvLyByYWRpdXMgd2hlbiBjb25zdGFudFxyXG5cclxuICAgICAgdmFsdWVVbml0czogJ2tnJ1xyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIEBwdWJsaWNcclxuICAgIHRoaXMucG9zaXRpb25Qcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggaW5pdGlhbFBvc2l0aW9uLCB7XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Bvc2l0aW9uUHJvcGVydHknICksXHJcbiAgICAgIHVuaXRzOiAnbScsXHJcbiAgICAgIHJhbmdlOiBuZXcgUmFuZ2UoIG9wdGlvbnMubGVmdE9iamVjdEJvdW5kYXJ5LCBvcHRpb25zLnJpZ2h0T2JqZWN0Qm91bmRhcnkgKSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ1RoZSBwb3NpdGlvbiBvZiB0aGUgb2JqZWN0IGFsb25nIHRoZSB0cmFjaywgaW4gbWV0ZXJzLiBUaGUgb3JpZ2luIGlzIGluIHRoZSBjZW50ZXIgYmV0d2VlbiB0aGUgdHdvIG9iamVjdHMuJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge1Byb3BlcnR5LjxudW1iZXI+fSAtIHRoZSBtYXNzIG9yIGNoYXJnZSBvZiB0aGUgb2JqZWN0IGluIGtpbG9ncmFtcyBvciBjb3Vsb21ic1xyXG4gICAgdGhpcy52YWx1ZVByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCBpbml0aWFsTWFzcywge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICd2YWx1ZVByb3BlcnR5JyApLFxyXG4gICAgICByYW5nZTogdmFsdWVSYW5nZSxcclxuICAgICAgdW5pdHM6IG9wdGlvbnMudmFsdWVVbml0cyxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ1RoZSB2YWx1ZSBvZiB0aGUgb2JqZWN0J1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMgKHJlYWQtb25seSkge2Z1bmN0aW9uKG1hc3M6bnVtYmVyKTpudW1iZXJ9XHJcbiAgICB0aGlzLmNhbGN1bGF0ZVJhZGl1cyA9IGNhbGN1bGF0ZVJhZGl1cztcclxuXHJcbiAgICAvLyBAcHVibGljIHtQcm9wZXJ0eS48bnVtYmVyPn0gLSB0aGUgcmFkaXVzIG9mIHRoZSBtYXNzIG9yIGNoYXJnZSBpbiBtZXRlcnNcclxuICAgIC8vIHNpbmNlIElTTENPYmplY3RzIGFyZSBuZXZlciBkZXN0cm95ZWQsIG5vIG5lZWQgdG8gZGlzcG9zZVxyXG4gICAgdGhpcy5yYWRpdXNQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgdGhpcy52YWx1ZVByb3BlcnR5LCBjb25zdGFudFJhZGl1c1Byb3BlcnR5IF0sXHJcbiAgICAgICggb2JqZWN0VmFsdWUsIGNvbnN0YW50UmFkaXVzICkgPT4ge1xyXG4gICAgICAgIHJldHVybiBjb25zdGFudFJhZGl1cyA/IG9wdGlvbnMuY29uc3RhbnRSYWRpdXMgOiBjYWxjdWxhdGVSYWRpdXMoIG9iamVjdFZhbHVlICk7XHJcbiAgICAgIH0sIHtcclxuICAgICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdyYWRpdXNQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnVGhlIHJhZGl1cyBvZiB0aGUgb2JqZWN0JyxcclxuICAgICAgICB1bml0czogJ20nLFxyXG4gICAgICAgIHBoZXRpb1ZhbHVlVHlwZTogTnVtYmVySU9cclxuICAgICAgfVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBlbmFibGVkUmFuZ2UgPSBuZXcgUmFuZ2UoIG9wdGlvbnMubGVmdE9iamVjdEJvdW5kYXJ5LCBvcHRpb25zLnJpZ2h0T2JqZWN0Qm91bmRhcnkgKTtcclxuXHJcbiAgICAvLyBAcHVibGljIHtQcm9wZXJ0eS48UmFuZ2U+fS0gc2V0IGJ5IElTTENNb2RlbCB3aGVuIHRoZSBmb3JjZSBjaGFuZ2VzLCB0aGUgcmFuZ2UgZm9yIHBvc2l0aW9uIG9mIHRoZSBvYmplY3RzXHJcbiAgICAvLyBiYXNlZCBvbiB0aGVpciByYWRpdXMgYW5kIHBvc2l0aW9uXHJcbiAgICB0aGlzLmVuYWJsZWRSYW5nZVByb3BlcnR5ID0gbmV3IFByb3BlcnR5KCBlbmFibGVkUmFuZ2UsIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZW5hYmxlZFJhbmdlUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdUaGUgcmFuZ2UgZm9yIHBvc2l0aW9uIG9mIHRoaXMgb2JqZWN0IGJhc2VkIG9uIHRoZSByYWRpdXMgYW5kIHBvc2l0aW9uIG9mIGJvdGggb2JqZWN0cycsXHJcbiAgICAgIHBoZXRpb1ZhbHVlVHlwZTogUmFuZ2UuUmFuZ2VJTyxcclxuICAgICAgcGhldGlvUmVhZE9ubHk6IHRydWVcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIC0gRW1pdHRlciB0aGF0IGZpcmVzIHdoZW5ldmVyIHRoZSBwb3NpdGlvbiBjaGFuZ2VzIGFzIGEgcmVzdWx0IG9mIGFuIG9iamVjdCdzIHZhbHVlIGNoYW5naW5nLlxyXG4gICAgLy8gRW1pdHMgd2l0aCB0aGUgb2JqZWN0RW51bSB0aGF0IGNhdXNlZCB0aGUgcG9zaXRpb24gY2hhbmdlLlxyXG4gICAgdGhpcy5wb3NpdGlvbkNoYW5nZWRGcm9tU2Vjb25kYXJ5U291cmNlRW1pdHRlciA9IG5ldyBFbWl0dGVyKCB7IHBhcmFtZXRlcnM6IFsgeyB2YWx1ZVR5cGU6IElTTENPYmplY3RFbnVtIH0gXSB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAtIGZsYWcgdG8gY2hlY2sgaWYgdGhlIG9iamVjdCBpcyBiZWluZyBkcmFnZ2VkIGJ5IHRoZSB1c2VyXHJcbiAgICAvLyAgICAgICAgICAgc2V0IGluIHRoZSBkcmFnIGhhbmRsZXJcclxuICAgIHRoaXMuaXNEcmFnZ2luZ1Byb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuXHJcbiAgICAvLyBAcHVibGljIC0gZmxhZyB0byBjaGVjayB3aGV0aGVyIG9iamVjdCdzIHJhZGl1cyB3YXMgdXBkYXRlZCwgdXNlZCB0byBkZXRlcm1pbmUgcG9zaXRpb25pbmdcclxuICAgIHRoaXMucmFkaXVzTGFzdENoYW5nZWQgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBAcHJpdmF0ZSAtIGZsYWcgZmxpcHBlZCB3aGVuIHRoZSB2YWx1ZSBjaGFuZ2UgaXMgdXBkYXRlZC4gVGhpcyBpcyB1c2VkIHRvIGNoZWNrIGlmIGEgcG9zaXRpb24gY2hhbmdlIGlzIGNhdXNlZFxyXG4gICAgLy8gZnJvbSBhIHZhbHVlIGNoYW5nZS4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9ncmF2aXR5LWZvcmNlLWxhYi1iYXNpY3MvaXNzdWVzLzE2OFxyXG4gICAgdGhpcy52YWx1ZUNoYW5nZWRTaW5jZUxhc3RTdGVwID0gZmFsc2U7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAocmVhZC1vbmx5KSAtIGZsYWcgZmxpcHBlZCB3aGVuIHRoZSBjb25zdGFudCByYWRpdXMgYm9vbGVhbiBpcyB0b2dnbGVkLiBUaGlzIGlzIHVzZWQgdG8gY2hlY2sgaWYgYSBwb3NpdGlvbiBjaGFuZ2UgaXNcclxuICAgIC8vIGNhdXNlZCBmcm9tIHRoZSBjb25zdGFudCByYWRpdXMgdG9nZ2xpbmcuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZ3Jhdml0eS1mb3JjZS1sYWItYmFzaWNzL2lzc3Vlcy8xNjhcclxuICAgIHRoaXMuY29uc3RhbnRSYWRpdXNDaGFuZ2VkU2luY2VMYXN0U3RlcCA9IGZhbHNlO1xyXG5cclxuICAgIC8vIEBwdWJsaWNcclxuICAgIHRoaXMudmFsdWVSYW5nZSA9IHZhbHVlUmFuZ2U7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7SVNMQ09iamVjdEVudW18bnVsbH0gLSBmaWxsZWQgaW4gYnkgSVNMQ01vZGVsXHJcbiAgICB0aGlzLmVudW0gPSBudWxsO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge1Byb3BlcnR5LjxDb2xvcj59IC0gZmlsbGVkIGluIGJ5IHN1YnR5cGVzXHJcbiAgICAvLyAtIG9iamVjdCBub2RlIGNvbG9yIGlzIHdpbGwgY2hhbmdlIHdpdGggdmFsdWUgKGxpbmtlZCBpbiBJU0xDT2JqZWN0Tm9kZS5qcylcclxuICAgIC8vICAgLSBjb2xvciBQcm9wZXJ0eSB3aWxsIGJlIHVwZGF0ZWQgYmFzZWQgb24gYSBib29sZWFuIHZhbHVlIChuZWdhdGl2ZSB2cyBwb3NpdGl2ZSlcclxuICAgIC8vICAgLSBicmlnaHRuZXNzIHdpbGwgYmUgc2V0IGFjY29yZGluZyB0byB0aGUgTWFzcy9DaGFyZ2UgbWFnbml0dWRlXHJcbiAgICB0aGlzLmJhc2VDb2xvclByb3BlcnR5ID0gbnVsbDtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIHtudW1iZXJ9IC0gdGhlIHJhZGl1cyBvZiB0aGUgb2JqZWN0IHdoZW4gcmFkaXVzIGlzIGNvbnN0YW50LlxyXG4gICAgdGhpcy5jb25zdGFudFJhZGl1cyA9IG9wdGlvbnMuY29uc3RhbnRSYWRpdXM7XHJcblxyXG4gICAgLy8gTGluayB0aGVzZSBmbGFncyB0byB0aGVpciBhc3NvY2lhdGVkUHJvcGVydGllc1xyXG4gICAgdGhpcy52YWx1ZVByb3BlcnR5LmxpbmsoICgpID0+IHsgdGhpcy52YWx1ZUNoYW5nZWRTaW5jZUxhc3RTdGVwID0gdHJ1ZTsgfSApO1xyXG4gICAgY29uc3RhbnRSYWRpdXNQcm9wZXJ0eS5saW5rKCAoKSA9PiB7IHRoaXMuY29uc3RhbnRSYWRpdXNDaGFuZ2VkU2luY2VMYXN0U3RlcCA9IHRydWU7IH0gKTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBDbGVhciBmbGFncyB0aGF0IGtlZXAgdHJhY2sgb2YgZGF0YSB0aGF0IG5lZWRzIHRvIGJlIGtlcHQgdHJhY2sgb2YgdW50aWwgdGhlIG5leHQgc3RlcCBmdW5jdGlvbiBpcyBjYWxsZWQuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIG9uU3RlcEVuZCgpIHtcclxuICAgIHRoaXMudmFsdWVDaGFuZ2VkU2luY2VMYXN0U3RlcCA9IGZhbHNlO1xyXG4gICAgdGhpcy5jb25zdGFudFJhZGl1c0NoYW5nZWRTaW5jZUxhc3RTdGVwID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNldHMgb2JqZWN0IG1vZGVsIHByb3BlcnRpZXMuXHJcbiAgICpcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcbiAgICB0aGlzLnZhbHVlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMucG9zaXRpb25Qcm9wZXJ0eS5yZXNldCgpO1xyXG4gIH1cclxufVxyXG5cclxuaW52ZXJzZVNxdWFyZUxhd0NvbW1vbi5yZWdpc3RlciggJ0lTTENPYmplY3QnLCBJU0xDT2JqZWN0ICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBJU0xDT2JqZWN0OyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0scUNBQXFDO0FBQ2pFLE9BQU9DLGVBQWUsTUFBTSxxQ0FBcUM7QUFDakUsT0FBT0MsT0FBTyxNQUFNLDZCQUE2QjtBQUNqRCxPQUFPQyxjQUFjLE1BQU0sb0NBQW9DO0FBQy9ELE9BQU9DLFFBQVEsTUFBTSw4QkFBOEI7QUFDbkQsT0FBT0MsS0FBSyxNQUFNLDBCQUEwQjtBQUM1QyxPQUFPQyxLQUFLLE1BQU0sZ0NBQWdDO0FBQ2xELE9BQU9DLFFBQVEsTUFBTSxzQ0FBc0M7QUFDM0QsT0FBT0Msc0JBQXNCLE1BQU0sOEJBQThCO0FBQ2pFLE9BQU9DLGFBQWEsTUFBTSxxQkFBcUI7QUFDL0MsT0FBT0MsY0FBYyxNQUFNLHFCQUFxQjtBQUVoRCxNQUFNQyxVQUFVLENBQUM7RUFFZjtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRUMsV0FBV0EsQ0FBRUMsV0FBVyxFQUFFQyxlQUFlLEVBQUVDLFVBQVUsRUFBRUMsc0JBQXNCLEVBQUVDLGVBQWUsRUFBRUMsTUFBTSxFQUFFQyxPQUFPLEVBQUc7SUFFaEhBLE9BQU8sR0FBR2IsS0FBSyxDQUFFO01BRWY7TUFDQWMsa0JBQWtCLEVBQUVYLGFBQWEsQ0FBQ1ksb0JBQW9CO01BQ3REQyxtQkFBbUIsRUFBRWIsYUFBYSxDQUFDYyxxQkFBcUI7TUFDeERDLGNBQWMsRUFBRWYs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