// Copyright 2017-2022, University of Colorado Boulder

/**
 * The pullers attached to the mass and charge objects. The node maintains a list of puller images that vary in
 * perceived pull effort. They are made visible and invisible to correspond to a given force value.
 *
 * @author Michael Barlow (PhET Interactive Simulations)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */

import Bounds2 from '../../../dot/js/Bounds2.js';
import LinearFunction from '../../../dot/js/LinearFunction.js';
import Utils from '../../../dot/js/Utils.js';
import Vector2 from '../../../dot/js/Vector2.js';
import { Shape } from '../../../kite/js/imports.js';
import merge from '../../../phet-core/js/merge.js';
import { Circle, Image, Node, Path } from '../../../scenery/js/imports.js';
import inverseSquareLawCommon from '../inverseSquareLawCommon.js';
import ISLCPullerImages from '../ISLCPullerImages.js';

// constants
const IMAGE_SCALE = 0.45;
class ISLCPullerNode extends Node {
  /**
   * @param {RangeWithValue} forceRange - range of forces, used for determining the visible pullImage
   * @param {Object} [options]
   */
  constructor(forceRange, options) {
    options = merge({
      ropeLength: 50,
      shadowMinWidth: 32,
      shadowMaxWidth: 50,
      attractNegative: true,
      // if true, add pusher images
      displayShadow: true,
      atomicScale: false
    }, options);
    super();
    let pullImages = ISLCPullerImages.pullImages;
    let pushImages = ISLCPullerImages.pushImages;
    let zeroForceImage = ISLCPullerImages.zeroForceImage;

    // set atomic pullers if on the atomic screen
    if (options.atomicScale) {
      pullImages = ISLCPullerImages.atomicPullImages;
      pushImages = ISLCPullerImages.atomicPushImages;
      zeroForceImage = ISLCPullerImages.atomicZeroForceImage;
    }

    // @private
    this.pullerPusherImages = pullImages;

    // @public
    this.touchAreaBounds = new Bounds2(0, 0, 0, 0);

    // used to ensure that small non-zero forces do not map to the zero force puller (see lines 130-132)
    let zeroForceIndex = null;

    // if in coulomb's law, add pusher and zero force images in proper order
    if (options.attractNegative) {
      zeroForceIndex = pushImages.length;
      this.pullerPusherImages = pushImages.concat(zeroForceImage).concat(pullImages);
    }

    // function that maps the visible image to the model force value
    const forceToImage = new LinearFunction(forceRange.min, forceRange.max, 0, this.pullerPusherImages.length - 1, true);

    // function to dynamically move the position of the shadow under the puller
    const indexToShadowOffset = new LinearFunction(0, this.pullerPusherImages.length - 1, -4, 6);

    // function that maps the size of the shadow to the force value
    const forceToShadowWidth = new LinearFunction(forceRange.min, forceRange.max, options.shadowMinWidth, options.shadowMaxWidth, true);

    // parent node for all puller images and the rope
    const pullerGroupNode = new Node();

    // the optional shadow node under the pullers - a circle scaled down vertically to look elliptical
    const shadowNode = new Circle(10, {
      fill: '#777',
      scale: new Vector2(1, 0.20)
    });

    // create each of the puller/pusher image nodes
    const images = [];
    let i;
    for (i = 0; i < this.pullerPusherImages.length; i++) {
      const pullerImage = new Image(this.pullerPusherImages[i]);

      // puller images are much larger than pushers, so we need to scale it down
      pullerImage.scale(IMAGE_SCALE, IMAGE_SCALE);
      images.push(pullerImage);
    }
    pullerGroupNode.addChild(new Path(Shape.lineSegment(-options.ropeLength, 0, 0, 0), {
      stroke: '#666',
      lineWidth: 2
    }));

    // set the layout for the images
    for (i = 0; i < this.pullerPusherImages.length; i++) {
      pullerGroupNode.addChild(images[i]);
      images[i].bottom = 42;
      images[i].right = -options.ropeLength;
      images[i].setVisible(false);

      // the pullImages grow in width as they animate, but their hands stay in the same position, so make sure that
      // they are still grabbing the rope
      images[i].right += 0.1 * images[i].width;
    }

    // shadow first so it is behind the pullers
    options.displayShadow && this.addChild(shadowNode);
    this.addChild(pullerGroupNode);
    const self = this;
    // @public - set the visibility of the image corresponding to the current force value
    this.setPull = function (force, offsetX) {
      if (options.attractNegative) {
        force *= -1;
      }

      // from the force value, get an index for the visible image
      let index = Utils.roundSymmetric(forceToImage.evaluate(force));
      if (force !== 0 && index === zeroForceIndex) {
        index += force > 0 ? 1 : -1;
      }
      for (let i = 0; i < this.pullerPusherImages.length; i++) {
        images[i].setVisible(i === index);
      }
      pullerGroupNode.x = -offsetX;

      // scale the shadow and place it under the visible image
      shadowNode.radius = forceToShadowWidth.evaluate(force) / 2;
      shadowNode.right = images[index].right - offsetX + Utils.roundSymmetric(indexToShadowOffset.evaluate(index));
      shadowNode.centerY = images[index].bottom;

      // configure pointer area
      // NOTE: the rope is not included in the draggable node, so we expose the puller bounds here for setting
      // the touch and mouse areas in ISLCObjectNode
      self.touchAreaBounds = pullerGroupNode.bounds.withOffsets(0, 0, -options.ropeLength + 5, 2);
    };
  }
}
inverseSquareLawCommon.register('ISLCPullerNode', ISLCPullerNode);
export default ISLCPullerNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb3VuZHMyIiwiTGluZWFyRnVuY3Rpb24iLCJVdGlscyIsIlZlY3RvcjIiLCJTaGFwZSIsIm1lcmdlIiwiQ2lyY2xlIiwiSW1hZ2UiLCJOb2RlIiwiUGF0aCIsImludmVyc2VTcXVhcmVMYXdDb21tb24iLCJJU0xDUHVsbGVySW1hZ2VzIiwiSU1BR0VfU0NBTEUiLCJJU0xDUHVsbGVyTm9kZSIsImNvbnN0cnVjdG9yIiwiZm9yY2VSYW5nZSIsIm9wdGlvbnMiLCJyb3BlTGVuZ3RoIiwic2hhZG93TWluV2lkdGgiLCJzaGFkb3dNYXhXaWR0aCIsImF0dHJhY3ROZWdhdGl2ZSIsImRpc3BsYXlTaGFkb3ciLCJhdG9taWNTY2FsZSIsInB1bGxJbWFnZXMiLCJwdXNoSW1hZ2VzIiwiemVyb0ZvcmNlSW1hZ2UiLCJhdG9taWNQdWxsSW1hZ2VzIiwiYXRvbWljUHVzaEltYWdlcyIsImF0b21pY1plcm9Gb3JjZUltYWdlIiwicHVsbGVyUHVzaGVySW1hZ2VzIiwidG91Y2hBcmVhQm91bmRzIiwiemVyb0ZvcmNlSW5kZXgiLCJsZW5ndGgiLCJjb25jYXQiLCJmb3JjZVRvSW1hZ2UiLCJtaW4iLCJtYXgiLCJpbmRleFRvU2hhZG93T2Zmc2V0IiwiZm9yY2VUb1NoYWRvd1dpZHRoIiwicHVsbGVyR3JvdXBOb2RlIiwic2hhZG93Tm9kZSIsImZpbGwiLCJzY2FsZSIsImltYWdlcyIsImkiLCJwdWxsZXJJbWFnZSIsInB1c2giLCJhZGRDaGlsZCIsImxpbmVTZWdtZW50Iiwic3Ryb2tlIiwibGluZVdpZHRoIiwiYm90dG9tIiwicmlnaHQiLCJzZXRWaXNpYmxlIiwid2lkdGgiLCJzZWxmIiwic2V0UHVsbCIsImZvcmNlIiwib2Zmc2V0WCIsImluZGV4Iiwicm91bmRTeW1tZXRyaWMiLCJldmFsdWF0ZSIsIngiLCJyYWRpdXMiLCJjZW50ZXJZIiwiYm91bmRzIiwid2l0aE9mZnNldHMiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIklTTENQdWxsZXJOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFRoZSBwdWxsZXJzIGF0dGFjaGVkIHRvIHRoZSBtYXNzIGFuZCBjaGFyZ2Ugb2JqZWN0cy4gVGhlIG5vZGUgbWFpbnRhaW5zIGEgbGlzdCBvZiBwdWxsZXIgaW1hZ2VzIHRoYXQgdmFyeSBpblxyXG4gKiBwZXJjZWl2ZWQgcHVsbCBlZmZvcnQuIFRoZXkgYXJlIG1hZGUgdmlzaWJsZSBhbmQgaW52aXNpYmxlIHRvIGNvcnJlc3BvbmQgdG8gYSBnaXZlbiBmb3JjZSB2YWx1ZS5cclxuICpcclxuICogQGF1dGhvciBNaWNoYWVsIEJhcmxvdyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmcgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvdW5kczIgZnJvbSAnLi4vLi4vLi4vZG90L2pzL0JvdW5kczIuanMnO1xyXG5pbXBvcnQgTGluZWFyRnVuY3Rpb24gZnJvbSAnLi4vLi4vLi4vZG90L2pzL0xpbmVhckZ1bmN0aW9uLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IHsgQ2lyY2xlLCBJbWFnZSwgTm9kZSwgUGF0aCB9IGZyb20gJy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBpbnZlcnNlU3F1YXJlTGF3Q29tbW9uIGZyb20gJy4uL2ludmVyc2VTcXVhcmVMYXdDb21tb24uanMnO1xyXG5pbXBvcnQgSVNMQ1B1bGxlckltYWdlcyBmcm9tICcuLi9JU0xDUHVsbGVySW1hZ2VzLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBJTUFHRV9TQ0FMRSA9IDAuNDU7XHJcblxyXG5jbGFzcyBJU0xDUHVsbGVyTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1JhbmdlV2l0aFZhbHVlfSBmb3JjZVJhbmdlIC0gcmFuZ2Ugb2YgZm9yY2VzLCB1c2VkIGZvciBkZXRlcm1pbmluZyB0aGUgdmlzaWJsZSBwdWxsSW1hZ2VcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIGZvcmNlUmFuZ2UsIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcbiAgICAgIHJvcGVMZW5ndGg6IDUwLFxyXG4gICAgICBzaGFkb3dNaW5XaWR0aDogMzIsXHJcbiAgICAgIHNoYWRvd01heFdpZHRoOiA1MCxcclxuICAgICAgYXR0cmFjdE5lZ2F0aXZlOiB0cnVlLCAvLyBpZiB0cnVlLCBhZGQgcHVzaGVyIGltYWdlc1xyXG4gICAgICBkaXNwbGF5U2hhZG93OiB0cnVlLFxyXG4gICAgICBhdG9taWNTY2FsZTogZmFsc2VcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIGxldCBwdWxsSW1hZ2VzID0gSVNMQ1B1bGxlckltYWdlcy5wdWxsSW1hZ2VzO1xyXG4gICAgbGV0IHB1c2hJbWFnZXMgPSBJU0xDUHVsbGVySW1hZ2VzLnB1c2hJbWFnZXM7XHJcbiAgICBsZXQgemVyb0ZvcmNlSW1hZ2UgPSBJU0xDUHVsbGVySW1hZ2VzLnplcm9Gb3JjZUltYWdlO1xyXG5cclxuICAgIC8vIHNldCBhdG9taWMgcHVsbGVycyBpZiBvbiB0aGUgYXRvbWljIHNjcmVlblxyXG4gICAgaWYgKCBvcHRpb25zLmF0b21pY1NjYWxlICkge1xyXG4gICAgICBwdWxsSW1hZ2VzID0gSVNMQ1B1bGxlckltYWdlcy5hdG9taWNQdWxsSW1hZ2VzO1xyXG4gICAgICBwdXNoSW1hZ2VzID0gSVNMQ1B1bGxlckltYWdlcy5hdG9taWNQdXNoSW1hZ2VzO1xyXG4gICAgICB6ZXJvRm9yY2VJbWFnZSA9IElTTENQdWxsZXJJbWFnZXMuYXRvbWljWmVyb0ZvcmNlSW1hZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMucHVsbGVyUHVzaGVySW1hZ2VzID0gcHVsbEltYWdlcztcclxuXHJcbiAgICAvLyBAcHVibGljXHJcbiAgICB0aGlzLnRvdWNoQXJlYUJvdW5kcyA9IG5ldyBCb3VuZHMyKCAwLCAwLCAwLCAwICk7XHJcblxyXG4gICAgLy8gdXNlZCB0byBlbnN1cmUgdGhhdCBzbWFsbCBub24temVybyBmb3JjZXMgZG8gbm90IG1hcCB0byB0aGUgemVybyBmb3JjZSBwdWxsZXIgKHNlZSBsaW5lcyAxMzAtMTMyKVxyXG4gICAgbGV0IHplcm9Gb3JjZUluZGV4ID0gbnVsbDtcclxuXHJcbiAgICAvLyBpZiBpbiBjb3Vsb21iJ3MgbGF3LCBhZGQgcHVzaGVyIGFuZCB6ZXJvIGZvcmNlIGltYWdlcyBpbiBwcm9wZXIgb3JkZXJcclxuICAgIGlmICggb3B0aW9ucy5hdHRyYWN0TmVnYXRpdmUgKSB7XHJcbiAgICAgIHplcm9Gb3JjZUluZGV4ID0gcHVzaEltYWdlcy5sZW5ndGg7XHJcbiAgICAgIHRoaXMucHVsbGVyUHVzaGVySW1hZ2VzID0gcHVzaEltYWdlcy5jb25jYXQoIHplcm9Gb3JjZUltYWdlICkuY29uY2F0KCBwdWxsSW1hZ2VzICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZnVuY3Rpb24gdGhhdCBtYXBzIHRoZSB2aXNpYmxlIGltYWdlIHRvIHRoZSBtb2RlbCBmb3JjZSB2YWx1ZVxyXG4gICAgY29uc3QgZm9yY2VUb0ltYWdlID0gbmV3IExpbmVhckZ1bmN0aW9uKCBmb3JjZVJhbmdlLm1pbiwgZm9yY2VSYW5nZS5tYXgsIDAsIHRoaXMucHVsbGVyUHVzaGVySW1hZ2VzLmxlbmd0aCAtIDEsIHRydWUgKTtcclxuXHJcbiAgICAvLyBmdW5jdGlvbiB0byBkeW5hbWljYWxseSBtb3ZlIHRoZSBwb3NpdGlvbiBvZiB0aGUgc2hhZG93IHVuZGVyIHRoZSBwdWxsZXJcclxuICAgIGNvbnN0IGluZGV4VG9TaGFkb3dPZmZzZXQgPSBuZXcgTGluZWFyRnVuY3Rpb24oIDAsIHRoaXMucHVsbGVyUHVzaGVySW1hZ2VzLmxlbmd0aCAtIDEsIC00LCA2ICk7XHJcblxyXG4gICAgLy8gZnVuY3Rpb24gdGhhdCBtYXBzIHRoZSBzaXplIG9mIHRoZSBzaGFkb3cgdG8gdGhlIGZvcmNlIHZhbHVlXHJcbiAgICBjb25zdCBmb3JjZVRvU2hhZG93V2lkdGggPSBuZXcgTGluZWFyRnVuY3Rpb24oIGZvcmNlUmFuZ2UubWluLCBmb3JjZVJhbmdlLm1heCwgb3B0aW9ucy5zaGFkb3dNaW5XaWR0aCwgb3B0aW9ucy5zaGFkb3dNYXhXaWR0aCwgdHJ1ZSApO1xyXG5cclxuICAgIC8vIHBhcmVudCBub2RlIGZvciBhbGwgcHVsbGVyIGltYWdlcyBhbmQgdGhlIHJvcGVcclxuICAgIGNvbnN0IHB1bGxlckdyb3VwTm9kZSA9IG5ldyBOb2RlKCk7XHJcblxyXG4gICAgLy8gdGhlIG9wdGlvbmFsIHNoYWRvdyBub2RlIHVuZGVyIHRoZSBwdWxsZXJzIC0gYSBjaXJjbGUgc2NhbGVkIGRvd24gdmVydGljYWxseSB0byBsb29rIGVsbGlwdGljYWxcclxuICAgIGNvbnN0IHNoYWRvd05vZGUgPSBuZXcgQ2lyY2xlKCAxMCwge1xyXG4gICAgICBmaWxsOiAnIzc3NycsXHJcbiAgICAgIHNjYWxlOiBuZXcgVmVjdG9yMiggMSwgMC4yMCApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gY3JlYXRlIGVhY2ggb2YgdGhlIHB1bGxlci9wdXNoZXIgaW1hZ2Ugbm9kZXNcclxuICAgIGNvbnN0IGltYWdlcyA9IFtdO1xyXG4gICAgbGV0IGk7XHJcbiAgICBmb3IgKCBpID0gMDsgaSA8IHRoaXMucHVsbGVyUHVzaGVySW1hZ2VzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBjb25zdCBwdWxsZXJJbWFnZSA9IG5ldyBJbWFnZSggdGhpcy5wdWxsZXJQdXNoZXJJbWFnZXNbIGkgXSApO1xyXG5cclxuICAgICAgLy8gcHVsbGVyIGltYWdlcyBhcmUgbXVjaCBsYXJnZXIgdGhhbiBwdXNoZXJzLCBzbyB3ZSBuZWVkIHRvIHNjYWxlIGl0IGRvd25cclxuICAgICAgcHVsbGVySW1hZ2Uuc2NhbGUoIElNQUdFX1NDQUxFLCBJTUFHRV9TQ0FMRSApO1xyXG5cclxuICAgICAgaW1hZ2VzLnB1c2goIHB1bGxlckltYWdlICk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVsbGVyR3JvdXBOb2RlLmFkZENoaWxkKCBuZXcgUGF0aCggU2hhcGUubGluZVNlZ21lbnQoIC1vcHRpb25zLnJvcGVMZW5ndGgsIDAsIDAsIDAgKSwge1xyXG4gICAgICBzdHJva2U6ICcjNjY2JyxcclxuICAgICAgbGluZVdpZHRoOiAyXHJcbiAgICB9ICkgKTtcclxuXHJcbiAgICAvLyBzZXQgdGhlIGxheW91dCBmb3IgdGhlIGltYWdlc1xyXG4gICAgZm9yICggaSA9IDA7IGkgPCB0aGlzLnB1bGxlclB1c2hlckltYWdlcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgcHVsbGVyR3JvdXBOb2RlLmFkZENoaWxkKCBpbWFnZXNbIGkgXSApO1xyXG4gICAgICBpbWFnZXNbIGkgXS5ib3R0b20gPSA0MjtcclxuICAgICAgaW1hZ2VzWyBpIF0ucmlnaHQgPSAtb3B0aW9ucy5yb3BlTGVuZ3RoO1xyXG4gICAgICBpbWFnZXNbIGkgXS5zZXRWaXNpYmxlKCBmYWxzZSApO1xyXG5cclxuICAgICAgLy8gdGhlIHB1bGxJbWFnZXMgZ3JvdyBpbiB3aWR0aCBhcyB0aGV5IGFuaW1hdGUsIGJ1dCB0aGVpciBoYW5kcyBzdGF5IGluIHRoZSBzYW1lIHBvc2l0aW9uLCBzbyBtYWtlIHN1cmUgdGhhdFxyXG4gICAgICAvLyB0aGV5IGFyZSBzdGlsbCBncmFiYmluZyB0aGUgcm9wZVxyXG4gICAgICBpbWFnZXNbIGkgXS5yaWdodCArPSAwLjEgKiBpbWFnZXNbIGkgXS53aWR0aDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBzaGFkb3cgZmlyc3Qgc28gaXQgaXMgYmVoaW5kIHRoZSBwdWxsZXJzXHJcbiAgICBvcHRpb25zLmRpc3BsYXlTaGFkb3cgJiYgdGhpcy5hZGRDaGlsZCggc2hhZG93Tm9kZSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggcHVsbGVyR3JvdXBOb2RlICk7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIC8vIEBwdWJsaWMgLSBzZXQgdGhlIHZpc2liaWxpdHkgb2YgdGhlIGltYWdlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGN1cnJlbnQgZm9yY2UgdmFsdWVcclxuICAgIHRoaXMuc2V0UHVsbCA9IGZ1bmN0aW9uKCBmb3JjZSwgb2Zmc2V0WCApIHtcclxuXHJcbiAgICAgIGlmICggb3B0aW9ucy5hdHRyYWN0TmVnYXRpdmUgKSB7XHJcbiAgICAgICAgZm9yY2UgKj0gLTE7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGZyb20gdGhlIGZvcmNlIHZhbHVlLCBnZXQgYW4gaW5kZXggZm9yIHRoZSB2aXNpYmxlIGltYWdlXHJcbiAgICAgIGxldCBpbmRleCA9IFV0aWxzLnJvdW5kU3ltbWV0cmljKCBmb3JjZVRvSW1hZ2UuZXZhbHVhdGUoIGZvcmNlICkgKTtcclxuXHJcbiAgICAgIGlmICggZm9yY2UgIT09IDAgJiYgaW5kZXggPT09IHplcm9Gb3JjZUluZGV4ICkge1xyXG4gICAgICAgIGluZGV4ICs9ICggZm9yY2UgPiAwICkgPyAxIDogLTE7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMucHVsbGVyUHVzaGVySW1hZ2VzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgIGltYWdlc1sgaSBdLnNldFZpc2libGUoIGkgPT09IGluZGV4ICk7XHJcbiAgICAgIH1cclxuICAgICAgcHVsbGVyR3JvdXBOb2RlLnggPSAtb2Zmc2V0WDtcclxuXHJcbiAgICAgIC8vIHNjYWxlIHRoZSBzaGFkb3cgYW5kIHBsYWNlIGl0IHVuZGVyIHRoZSB2aXNpYmxlIGltYWdlXHJcbiAgICAgIHNoYWRvd05vZGUucmFkaXVzID0gZm9yY2VUb1NoYWRvd1dpZHRoLmV2YWx1YXRlKCBmb3JjZSApIC8gMjtcclxuICAgICAgc2hhZG93Tm9kZS5yaWdodCA9IGltYWdlc1sgaW5kZXggXS5yaWdodCAtIG9mZnNldFggKyBVdGlscy5yb3VuZFN5bW1ldHJpYyggaW5kZXhUb1NoYWRvd09mZnNldC5ldmFsdWF0ZSggaW5kZXggKSApO1xyXG4gICAgICBzaGFkb3dOb2RlLmNlbnRlclkgPSBpbWFnZXNbIGluZGV4IF0uYm90dG9tO1xyXG5cclxuICAgICAgLy8gY29uZmlndXJlIHBvaW50ZXIgYXJlYVxyXG4gICAgICAvLyBOT1RFOiB0aGUgcm9wZSBpcyBub3QgaW5jbHVkZWQgaW4gdGhlIGRyYWdnYWJsZSBub2RlLCBzbyB3ZSBleHBvc2UgdGhlIHB1bGxlciBib3VuZHMgaGVyZSBmb3Igc2V0dGluZ1xyXG4gICAgICAvLyB0aGUgdG91Y2ggYW5kIG1vdXNlIGFyZWFzIGluIElTTENPYmplY3ROb2RlXHJcbiAgICAgIHNlbGYudG91Y2hBcmVhQm91bmRzID0gcHVsbGVyR3JvdXBOb2RlLmJvdW5kcy53aXRoT2Zmc2V0cyggMCwgMCwgLW9wdGlvbnMucm9wZUxlbmd0aCArIDUsIDIgKTtcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5pbnZlcnNlU3F1YXJlTGF3Q29tbW9uLnJlZ2lzdGVyKCAnSVNMQ1B1bGxlck5vZGUnLCBJU0xDUHVsbGVyTm9kZSApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgSVNMQ1B1bGxlck5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0sNEJBQTRCO0FBQ2hELE9BQU9DLGNBQWMsTUFBTSxtQ0FBbUM7QUFDOUQsT0FBT0MsS0FBSyxNQUFNLDBCQUEwQjtBQUM1QyxPQUFPQyxPQUFPLE1BQU0sNEJBQTRCO0FBQ2hELFNBQVNDLEtBQUssUUFBUSw2QkFBNkI7QUFDbkQsT0FBT0MsS0FBSyxNQUFNLGdDQUFnQztBQUNsRCxTQUFTQyxNQUFNLEVBQUVDLEtBQUssRUFBRUMsSUFBSSxFQUFFQyxJQUFJLFFBQVEsZ0NBQWdDO0FBQzFFLE9BQU9DLHNCQUFzQixNQUFNLDhCQUE4QjtBQUNqRSxPQUFPQyxnQkFBZ0IsTUFBTSx3QkFBd0I7O0FBRXJEO0FBQ0EsTUFBTUMsV0FBVyxHQUFHLElBQUk7QUFFeEIsTUFBTUMsY0FBYyxTQUFTTCxJQUFJLENBQUM7RUFFaEM7QUFDRjtBQUNBO0FBQ0E7RUFDRU0sV0FBV0EsQ0FBRUMsVUFBVSxFQUFFQyxPQUFPLEVBQUc7SUFFakNBLE9BQU8sR0FBR1gsS0FBSyxDQUFFO01BQ2ZZLFVBQVUsRUFBRSxFQUFFO01BQ2RDLGNBQWMsRUFBRSxFQUFFO01BQ2xCQyxjQUFjLEVBQUUsRUFBRTtNQUNsQkMsZUFBZSxFQUFFLElBQUk7TUFBRTtNQUN2QkMsYUFBYSxFQUFFLElBQUk7TUFDbkJDLFdBQVcsRUFBRTtJQUNmLENBQUMsRUFBRU4sT0FBUSxDQUFDO0lBRVosS0FBSyxDQUFDLENBQUM7SUFFUCxJQUFJTyxVQUFVLEdBQUdaLGdCQUFnQixDQUFDWSxVQUFVO0lBQzVDLElBQUlDLFVBQVUsR0FBR2IsZ0JBQWdCLENBQUNhLFVBQVU7SUFDNUMsSUFBSUMsY0FBYyxHQUFHZCxnQkFBZ0IsQ0FBQ2MsY0FBYzs7SUFFcEQ7SUFDQSxJQUFLVCxPQUFPLENBQUNNLFdBQVcsRUFBRztNQUN6QkMsVUFBVSxHQUFHWixnQkFBZ0IsQ0FBQ2UsZ0JBQWdCO01BQzlDRixVQUFVLEdBQUdiLGdCQUFnQixDQUFDZ0IsZ0JBQWdCO01BQzlDRixjQUFjLEdBQUdkLGdCQUFnQixDQUFDaUIsb0JBQW9CO0lBQ3hEOztJQUVBO0lBQ0EsSUFBSSxDQUFDQyxrQkFBa0IsR0FBR04sVUFBVTs7SUFFcEM7SUFDQSxJQUFJLENBQUNPLGVBQWUsR0FBRyxJQUFJOUIsT0FBTyxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUUsQ0FBQzs7SUFFaEQ7SUFDQSxJQUFJK0IsY0FBYyxHQUFHLElBQUk7O0lBRXpCO0lBQ0EsSUFBS2YsT0FBTyxDQUFDSSxlQUFlLEVBQUc7TUFDN0JXLGNBQWMsR0FBR1AsVUFBVSxDQUFDUSxNQUFNO01BQ2xDLElBQUksQ0FBQ0gsa0JBQWtCLEdBQUdMLFVBQVUsQ0FBQ1MsTUFBTSxDQUFFUixjQUFlLENBQUMsQ0FBQ1EsTUFBTSxDQUFFVixVQUFXLENBQUM7SUFDcEY7O0lBRUE7SUFDQSxNQUFNVyxZQUFZLEdBQUcsSUFBSWpDLGNBQWMsQ0FBRWMsVUFBVSxDQUFDb0IsR0FBRyxFQUFFcEIsVUFBVSxDQUFDcUIsR0FBRyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUNQLGtCQUFrQixDQUFDRyxNQUFNLEdBQUcsQ0FBQyxFQUFFLElBQUssQ0FBQzs7SUFFdEg7SUFDQSxNQUFNSyxtQkFBbUIsR0FBRyxJQUFJcEMsY0FBYyxDQUFFLENBQUMsRUFBRSxJQUFJLENBQUM0QixrQkFBa0IsQ0FBQ0csTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFFLENBQUM7O0lBRTlGO0lBQ0EsTUFBTU0sa0JBQWtCLEdBQUcsSUFBSXJDLGNBQWMsQ0FBRWMsVUFBVSxDQUFDb0IsR0FBRyxFQUFFcEIsVUFBVSxDQUFDcUIsR0FBRyxFQUFFcEIsT0FBTyxDQUFDRSxjQUFjLEVBQUVGLE9BQU8sQ0FBQ0csY0FBYyxFQUFFLElBQUssQ0FBQzs7SUFFckk7SUFDQSxNQUFNb0IsZUFBZSxHQUFHLElBQUkvQixJQUFJLENBQUMsQ0FBQzs7SUFFbEM7SUFDQSxNQUFNZ0MsVUFBVSxHQUFHLElBQUlsQyxNQUFNLENBQUUsRUFBRSxFQUFFO01BQ2pDbUMsSUFBSSxFQUFFLE1BQU07TUFDWkMsS0FBSyxFQUFFLElBQUl2QyxPQUFPLENBQUUsQ0FBQyxFQUFFLElBQUs7SUFDOUIsQ0FBRSxDQUFDOztJQUVIO0lBQ0EsTUFBTXdDLE1BQU0sR0FBRyxFQUFFO0lBQ2pCLElBQUlDLENBQUM7SUFDTCxLQUFNQSxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUcsSUFBSSxDQUFDZixrQkFBa0IsQ0FBQ0csTUFBTSxFQUFFWSxDQUFDLEVBQUUsRUFBRztNQUNyRCxNQUFNQyxXQUFXLEdBQUcsSUFBSXRDLEtBQUssQ0FBRSxJQUFJLENBQUNzQixrQkFBa0IsQ0FBRWUsQ0FBQyxDQUFHLENBQUM7O01BRTdEO01BQ0FDLFdBQVcsQ0FBQ0gsS0FBSyxDQUFFOUIsV0FBVyxFQUFFQSxXQUFZLENBQUM7TUFFN0MrQixNQUFNLENBQUNHLElBQUksQ0FBRUQsV0FBWSxDQUFDO0lBQzVCO0lBRUFOLGVBQWUsQ0FBQ1EsUUFBUSxDQUFFLElBQUl0QyxJQUFJLENBQUVMLEtBQUssQ0FBQzRDLFdBQVcsQ0FBRSxDQUFDaEMsT0FBTyxDQUFDQyxVQUFVLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFFLENBQUMsRUFBRTtNQUNyRmdDLE1BQU0sRUFBRSxNQUFNO01BQ2RDLFNBQVMsRUFBRTtJQUNiLENBQUUsQ0FBRSxDQUFDOztJQUVMO0lBQ0EsS0FBTU4sQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHLElBQUksQ0FBQ2Ysa0JBQWtCLENBQUNHLE1BQU0sRUFBRVksQ0FBQyxFQUFFLEVBQUc7TUFDckRMLGVBQWUsQ0FBQ1EsUUFBUSxDQUFFSixNQUFNLENBQUVDLENBQUMsQ0FBRyxDQUFDO01BQ3ZDRCxNQUFNLENBQUVDLENBQUMsQ0FBRSxDQUFDTyxNQUFNLEdBQUcsRUFBRTtNQUN2QlIsTUFBTSxDQUFFQyxDQUFDLENBQUUsQ0FBQ1EsS0FBSyxHQUFHLENBQUNwQyxPQUFPLENBQUNDLFVBQVU7TUFDdkMwQixNQUFNLENBQUVDLENBQUMsQ0FBRSxDQUFDUyxVQUFVLENBQUUsS0FBTSxDQUFDOztNQUUvQjtNQUNBO01BQ0FWLE1BQU0sQ0FBRUMsQ0FBQyxDQUFFLENBQUNRLEtBQUssSUFBSSxHQUFHLEdBQUdULE1BQU0sQ0FBRUMsQ0FBQyxDQUFFLENBQUNVLEtBQUs7SUFDOUM7O0lBRUE7SUFDQXRDLE9BQU8sQ0FBQ0ssYUFBYSxJQUFJLElBQUksQ0FBQzBCLFFBQVEsQ0FBRVAsVUFBVyxDQUFDO0lBQ3BELElBQUksQ0FBQ08sUUFBUSxDQUFFUixlQUFnQixDQUFDO0lBQ2hDLE1BQU1nQixJQUFJLEdBQUcsSUFBSTtJQUNqQjtJQUNBLElBQUksQ0FBQ0MsT0FBTyxHQUFHLFVBQVVDLEtBQUssRUFBRUMsT0FBTyxFQUFHO01BRXhDLElBQUsxQyxPQUFPLENBQUNJLGVBQWUsRUFBRztRQUM3QnFDLEtBQUssSUFBSSxDQUFDLENBQUM7TUFDYjs7TUFFQTtNQUNBLElBQUlFLEtBQUssR0FBR3pELEtBQUssQ0FBQzBELGNBQWMsQ0FBRTFCLFlBQVksQ0FBQzJCLFFBQVEsQ0FBRUosS0FBTSxDQUFFLENBQUM7TUFFbEUsSUFBS0EsS0FBSyxLQUFLLENBQUMsSUFBSUUsS0FBSyxLQUFLNUIsY0FBYyxFQUFHO1FBQzdDNEIsS0FBSyxJQUFNRixLQUFLLEdBQUcsQ0FBQyxHQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7TUFDakM7TUFFQSxLQUFNLElBQUliLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBRyxJQUFJLENBQUNmLGtCQUFrQixDQUFDRyxNQUFNLEVBQUVZLENBQUMsRUFBRSxFQUFHO1FBQ3pERCxNQUFNLENBQUVDLENBQUMsQ0FBRSxDQUFDUyxVQUFVLENBQUVULENBQUMsS0FBS2UsS0FBTSxDQUFDO01BQ3ZDO01BQ0FwQixlQUFlLENBQUN1QixDQUFDLEdBQUcsQ0FBQ0osT0FBTzs7TUFFNUI7TUFDQWxCLFVBQVUsQ0FBQ3VCLE1BQU0sR0FBR3pCLGtCQUFrQixDQUFDdUIsUUFBUSxDQUFFSixLQUFNLENBQUMsR0FBRyxDQUFDO01BQzVEakIsVUFBVSxDQUFDWSxLQUFLLEdBQUdULE1BQU0sQ0FBRWdCLEtBQUssQ0FBRSxDQUFDUCxLQUFLLEdBQUdNLE9BQU8sR0FBR3hELEtBQUssQ0FBQzBELGNBQWMsQ0FBRXZCLG1CQUFtQixDQUFDd0IsUUFBUSxDQUFFRixLQUFNLENBQUUsQ0FBQztNQUNsSG5CLFVBQVUsQ0FBQ3dCLE9BQU8sR0FBR3JCLE1BQU0sQ0FBRWdCLEtBQUssQ0FBRSxDQUFDUixNQUFNOztNQUUzQztNQUNBO01BQ0E7TUFDQUksSUFBSSxDQUFDekIsZUFBZSxHQUFHUyxlQUFlLENBQUMwQixNQUFNLENBQUNDLFdBQVcsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUNsRCxPQUFPLENBQUNDLFVBQVUsR0FBRyxDQUFDLEVBQUUsQ0FBRSxDQUFDO0lBQy9GLENBQUM7RUFDSDtBQUNGO0FBRUFQLHNCQUFzQixDQUFDeUQsUUFBUSxDQUFFLGdCQUFnQixFQUFFdEQsY0FBZSxDQUFDO0FBRW5FLGVBQWVBLGNBQWMifQ==