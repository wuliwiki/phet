// Copyright 2013-2023, University of Colorado Boulder

/**
 * Solution is the base class for the solution in the 'Macro' and 'Micro' screens.
 * Solvent (water) is constant, solute (in stock solution form) is variable.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import optionize from '../../../../phet-core/js/optionize.js';
import { Color } from '../../../../scenery/js/imports.js';
import PhetioObject from '../../../../tandem/js/PhetioObject.js';
import NullableIO from '../../../../tandem/js/types/NullableIO.js';
import NumberIO from '../../../../tandem/js/types/NumberIO.js';
import Water from './Water.js';
import PHScaleConstants from '../PHScaleConstants.js';
import phScale from '../../phScale.js';
import PHModel from './PHModel.js';
// constants
const MIN_VOLUME = Math.pow(10, -PHScaleConstants.VOLUME_DECIMAL_PLACES);
export default class Solution extends PhetioObject {
  // Used to update total volume atomically when draining solution, see https://github.com/phetsims/ph-scale/issues/25

  constructor(soluteProperty, providedOptions) {
    const options = optionize()({
      // SelfOptions
      soluteVolume: 0,
      waterVolume: 0,
      maxVolume: 1,
      // PhetioOptions
      phetioState: false,
      phetioDocumentation: 'solution in the beaker'
    }, providedOptions);
    assert && assert(options.soluteVolume >= 0);
    assert && assert(options.waterVolume >= 0);
    assert && assert(options.maxVolume > 0);
    assert && assert(options.soluteVolume + options.waterVolume <= options.maxVolume);
    super(options);
    this.soluteProperty = soluteProperty;

    // Create a PhET-iO linked element that points to where soluteProperty lives (in Dropper).
    // This makes it easier to find soluteProperty in the Studio tree.
    this.addLinkedElement(this.soluteProperty, {
      tandem: options.tandem.createTandem('soluteProperty')
    });
    this.maxVolume = options.maxVolume;
    this.soluteVolumeProperty = new NumberProperty(options.soluteVolume, {
      units: 'L',
      tandem: options.tandem.createTandem('soluteVolumeProperty'),
      phetioDocumentation: `Volume of solute in the solution. soluteVolumeProperty + waterVolumeProperty should be <= ${options.maxVolume}`,
      phetioHighFrequency: true
    });
    this.waterVolumeProperty = new NumberProperty(options.waterVolume, {
      units: 'L',
      tandem: options.tandem.createTandem('waterVolumeProperty'),
      phetioDocumentation: `Volume of water in the solution. waterVolumeProperty + soluteVolumeProperty should be <= ${options.maxVolume}`,
      phetioHighFrequency: true
    });

    // Used to update total volume atomically when draining solution, see https://github.com/phetsims/ph-scale/issues/25
    this.ignoreVolumeUpdate = false;
    this.totalVolumeProperty = new DerivedProperty([this.soluteVolumeProperty, this.waterVolumeProperty], (soluteVolume, waterVolume) => this.ignoreVolumeUpdate ? this.totalVolumeProperty.value : soluteVolume + waterVolume, {
      units: 'L',
      tandem: options.tandem.createTandem('totalVolumeProperty'),
      phetioValueType: NumberIO,
      phetioDocumentation: 'total volume of the solution',
      phetioHighFrequency: true
    });
    this.pHProperty = new DerivedProperty([this.soluteProperty, this.soluteVolumeProperty, this.waterVolumeProperty], (solute, soluteVolume, waterVolume) => {
      if (this.ignoreVolumeUpdate) {
        return this.pHProperty.value;
      } else {
        return PHModel.computePH(solute.pH, soluteVolume, waterVolume);
      }
    }, {
      tandem: options.tandem.createTandem('pHProperty'),
      phetioValueType: NullableIO(NumberIO),
      phetioDocumentation: 'pH of the solution',
      phetioHighFrequency: true
    });
    this.colorProperty = new DerivedProperty([this.soluteProperty, this.soluteVolumeProperty, this.waterVolumeProperty], (solute, soluteVolume, waterVolume) => {
      if (this.ignoreVolumeUpdate) {
        return this.colorProperty.value;
      } else if (soluteVolume + waterVolume === 0) {
        return Color.BLACK; // no solution, should never see this color displayed
      } else if (soluteVolume === 0 || PHModel.isEquivalentToWater(this.pHProperty.value)) {
        return Water.color;
      } else {
        return solute.computeColor(soluteVolume / (soluteVolume + waterVolume));
      }
    });

    // When the solute changes, reset to initial volumes.
    // This is short-circuited while PhET-iO state is being restored. Otherwise, the restored state would be changed.
    // See https://github.com/phetsims/ph-scale/issues/132
    this.soluteProperty.link(() => {
      if (!phet.joist.sim.isSettingPhetioStateProperty.value) {
        this.waterVolumeProperty.reset();
        this.soluteVolumeProperty.reset();
      }
    });
  }
  reset() {
    this.soluteVolumeProperty.reset();
    this.waterVolumeProperty.reset();
  }

  //----------------------------------------------------------------------------
  // Volume (Liters)
  //----------------------------------------------------------------------------

  // Returns the amount of volume that is available to fill.
  getFreeVolume() {
    return this.maxVolume - this.totalVolumeProperty.value;
  }

  // Convenience function for adding solute
  addSolute(deltaVolume) {
    if (deltaVolume > 0) {
      this.soluteVolumeProperty.value = Math.max(MIN_VOLUME, this.soluteVolumeProperty.value + Math.min(deltaVolume, this.getFreeVolume()));
    }
  }

  // Convenience function for adding water
  addWater(deltaVolume) {
    if (deltaVolume > 0) {
      this.waterVolumeProperty.value = Math.max(MIN_VOLUME, this.waterVolumeProperty.value + Math.min(deltaVolume, this.getFreeVolume()));
    }
  }

  /**
   * Drains a specified amount of solution, in liters.
   */
  drainSolution(deltaVolume) {
    if (deltaVolume > 0) {
      const totalVolume = this.totalVolumeProperty.value;
      if (totalVolume > 0) {
        if (totalVolume - deltaVolume < MIN_VOLUME) {
          // drain the remaining solution
          this.setVolumeAtomic(0, 0);
        } else {
          // drain equal percentages of water and solute
          const waterVolume = this.waterVolumeProperty.value;
          const soluteVolume = this.soluteVolumeProperty.value;
          this.setVolumeAtomic(waterVolume - deltaVolume * waterVolume / totalVolume, soluteVolume - deltaVolume * soluteVolume / totalVolume);
        }
      }
    }
  }

  /**
   * Sets volume atomically, to prevent pH value from going through an intermediate state.
   * This is used when draining solution, so that equal parts of solute and water are removed atomically.
   * See documentation of ignoreVolumeUpdate above, and https://github.com/phetsims/ph-scale/issues/25.
   */
  setVolumeAtomic(waterVolume, soluteVolume) {
    // ignore the first notification if both volumes are changing
    this.ignoreVolumeUpdate = waterVolume !== this.waterVolumeProperty.value && soluteVolume !== this.soluteVolumeProperty.value;
    this.waterVolumeProperty.value = waterVolume;
    this.ignoreVolumeUpdate = false; // don't ignore the second notification, so that observers will update
    this.soluteVolumeProperty.value = soluteVolume;
  }
}
phScale.register('Solution', Solution);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIm9wdGlvbml6ZSIsIkNvbG9yIiwiUGhldGlvT2JqZWN0IiwiTnVsbGFibGVJTyIsIk51bWJlcklPIiwiV2F0ZXIiLCJQSFNjYWxlQ29uc3RhbnRzIiwicGhTY2FsZSIsIlBITW9kZWwiLCJNSU5fVk9MVU1FIiwiTWF0aCIsInBvdyIsIlZPTFVNRV9ERUNJTUFMX1BMQUNFUyIsIlNvbHV0aW9uIiwiY29uc3RydWN0b3IiLCJzb2x1dGVQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJzb2x1dGVWb2x1bWUiLCJ3YXRlclZvbHVtZSIsIm1heFZvbHVtZSIsInBoZXRpb1N0YXRlIiwicGhldGlvRG9jdW1lbnRhdGlvbiIsImFzc2VydCIsImFkZExpbmtlZEVsZW1lbnQiLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJzb2x1dGVWb2x1bWVQcm9wZXJ0eSIsInVuaXRzIiwicGhldGlvSGlnaEZyZXF1ZW5jeSIsIndhdGVyVm9sdW1lUHJvcGVydHkiLCJpZ25vcmVWb2x1bWVVcGRhdGUiLCJ0b3RhbFZvbHVtZVByb3BlcnR5IiwidmFsdWUiLCJwaGV0aW9WYWx1ZVR5cGUiLCJwSFByb3BlcnR5Iiwic29sdXRlIiwiY29tcHV0ZVBIIiwicEgiLCJjb2xvclByb3BlcnR5IiwiQkxBQ0siLCJpc0VxdWl2YWxlbnRUb1dhdGVyIiwiY29sb3IiLCJjb21wdXRlQ29sb3IiLCJsaW5rIiwicGhldCIsImpvaXN0Iiwic2ltIiwiaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eSIsInJlc2V0IiwiZ2V0RnJlZVZvbHVtZSIsImFkZFNvbHV0ZSIsImRlbHRhVm9sdW1lIiwibWF4IiwibWluIiwiYWRkV2F0ZXIiLCJkcmFpblNvbHV0aW9uIiwidG90YWxWb2x1bWUiLCJzZXRWb2x1bWVBdG9taWMiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlNvbHV0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDEzLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFNvbHV0aW9uIGlzIHRoZSBiYXNlIGNsYXNzIGZvciB0aGUgc29sdXRpb24gaW4gdGhlICdNYWNybycgYW5kICdNaWNybycgc2NyZWVucy5cclxuICogU29sdmVudCAod2F0ZXIpIGlzIGNvbnN0YW50LCBzb2x1dGUgKGluIHN0b2NrIHNvbHV0aW9uIGZvcm0pIGlzIHZhcmlhYmxlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTnVtYmVyUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9OdW1iZXJQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgeyBDb2xvciB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBQaGV0aW9PYmplY3QsIHsgUGhldGlvT2JqZWN0T3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9QaGV0aW9PYmplY3QuanMnO1xyXG5pbXBvcnQgTnVsbGFibGVJTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvTnVsbGFibGVJTy5qcyc7XHJcbmltcG9ydCBOdW1iZXJJTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvTnVtYmVySU8uanMnO1xyXG5pbXBvcnQgeyBQSFZhbHVlIH0gZnJvbSAnLi9QSE1vZGVsLmpzJztcclxuaW1wb3J0IFNvbHV0ZSBmcm9tICcuL1NvbHV0ZS5qcyc7XHJcbmltcG9ydCBXYXRlciBmcm9tICcuL1dhdGVyLmpzJztcclxuaW1wb3J0IFBIU2NhbGVDb25zdGFudHMgZnJvbSAnLi4vUEhTY2FsZUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBwaFNjYWxlIGZyb20gJy4uLy4uL3BoU2NhbGUuanMnO1xyXG5pbXBvcnQgUEhNb2RlbCBmcm9tICcuL1BITW9kZWwuanMnO1xyXG5pbXBvcnQgTGlua2FibGVSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTGlua2FibGVSZWFkT25seVByb3BlcnR5LmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBNSU5fVk9MVU1FID0gTWF0aC5wb3coIDEwLCAtUEhTY2FsZUNvbnN0YW50cy5WT0xVTUVfREVDSU1BTF9QTEFDRVMgKTtcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgc29sdXRlVm9sdW1lPzogbnVtYmVyOyAvLyBpbml0aWFsIHZvbHVtZSBvZiBzb2x1dGUsIGluIExcclxuICB3YXRlclZvbHVtZT86IG51bWJlcjsgLy8gaW5pdGlhbCB2b2x1bWUgb2Ygd2F0ZXIsIGluIExcclxuICBtYXhWb2x1bWU/OiBudW1iZXI7IC8vIG1heGltdW0gdG90YWwgdm9sdW1lIChzb2x1dGUgKyB3YXRlciksIGluIExcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFNvbHV0aW9uT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgUGlja1JlcXVpcmVkPFBoZXRpb09iamVjdE9wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNvbHV0aW9uIGV4dGVuZHMgUGhldGlvT2JqZWN0IHtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IHNvbHV0ZVByb3BlcnR5OiBQcm9wZXJ0eTxTb2x1dGU+O1xyXG4gIHB1YmxpYyByZWFkb25seSBzb2x1dGVWb2x1bWVQcm9wZXJ0eTogUHJvcGVydHk8bnVtYmVyPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgd2F0ZXJWb2x1bWVQcm9wZXJ0eTogUHJvcGVydHk8bnVtYmVyPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgdG90YWxWb2x1bWVQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPjtcclxuICBwdWJsaWMgcmVhZG9ubHkgcEhQcm9wZXJ0eTogTGlua2FibGVSZWFkT25seVByb3BlcnR5PFBIVmFsdWU+O1xyXG4gIHB1YmxpYyByZWFkb25seSBjb2xvclByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxDb2xvcj47XHJcbiAgcHVibGljIHJlYWRvbmx5IG1heFZvbHVtZTogbnVtYmVyO1xyXG5cclxuICAvLyBVc2VkIHRvIHVwZGF0ZSB0b3RhbCB2b2x1bWUgYXRvbWljYWxseSB3aGVuIGRyYWluaW5nIHNvbHV0aW9uLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3BoLXNjYWxlL2lzc3Vlcy8yNVxyXG4gIHByaXZhdGUgaWdub3JlVm9sdW1lVXBkYXRlOiBib29sZWFuO1xyXG5cclxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoIHNvbHV0ZVByb3BlcnR5OiBQcm9wZXJ0eTxTb2x1dGU+LCBwcm92aWRlZE9wdGlvbnM6IFNvbHV0aW9uT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFNvbHV0aW9uT3B0aW9ucywgU2VsZk9wdGlvbnMsIFBoZXRpb09iamVjdE9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNlbGZPcHRpb25zXHJcbiAgICAgIHNvbHV0ZVZvbHVtZTogMCxcclxuICAgICAgd2F0ZXJWb2x1bWU6IDAsXHJcbiAgICAgIG1heFZvbHVtZTogMSxcclxuXHJcbiAgICAgIC8vIFBoZXRpb09wdGlvbnNcclxuICAgICAgcGhldGlvU3RhdGU6IGZhbHNlLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnc29sdXRpb24gaW4gdGhlIGJlYWtlcidcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMuc29sdXRlVm9sdW1lID49IDAgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMud2F0ZXJWb2x1bWUgPj0gMCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5tYXhWb2x1bWUgPiAwICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zLnNvbHV0ZVZvbHVtZSArIG9wdGlvbnMud2F0ZXJWb2x1bWUgPD0gb3B0aW9ucy5tYXhWb2x1bWUgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIHRoaXMuc29sdXRlUHJvcGVydHkgPSBzb2x1dGVQcm9wZXJ0eTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSBQaEVULWlPIGxpbmtlZCBlbGVtZW50IHRoYXQgcG9pbnRzIHRvIHdoZXJlIHNvbHV0ZVByb3BlcnR5IGxpdmVzIChpbiBEcm9wcGVyKS5cclxuICAgIC8vIFRoaXMgbWFrZXMgaXQgZWFzaWVyIHRvIGZpbmQgc29sdXRlUHJvcGVydHkgaW4gdGhlIFN0dWRpbyB0cmVlLlxyXG4gICAgdGhpcy5hZGRMaW5rZWRFbGVtZW50KCB0aGlzLnNvbHV0ZVByb3BlcnR5LCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnc29sdXRlUHJvcGVydHknIClcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLm1heFZvbHVtZSA9IG9wdGlvbnMubWF4Vm9sdW1lO1xyXG5cclxuICAgIHRoaXMuc29sdXRlVm9sdW1lUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIG9wdGlvbnMuc29sdXRlVm9sdW1lLCB7XHJcbiAgICAgIHVuaXRzOiAnTCcsXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnc29sdXRlVm9sdW1lUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246IGBWb2x1bWUgb2Ygc29sdXRlIGluIHRoZSBzb2x1dGlvbi4gc29sdXRlVm9sdW1lUHJvcGVydHkgKyB3YXRlclZvbHVtZVByb3BlcnR5IHNob3VsZCBiZSA8PSAke29wdGlvbnMubWF4Vm9sdW1lfWAsXHJcbiAgICAgIHBoZXRpb0hpZ2hGcmVxdWVuY3k6IHRydWVcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLndhdGVyVm9sdW1lUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIG9wdGlvbnMud2F0ZXJWb2x1bWUsIHtcclxuICAgICAgdW5pdHM6ICdMJyxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICd3YXRlclZvbHVtZVByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiBgVm9sdW1lIG9mIHdhdGVyIGluIHRoZSBzb2x1dGlvbi4gd2F0ZXJWb2x1bWVQcm9wZXJ0eSArIHNvbHV0ZVZvbHVtZVByb3BlcnR5IHNob3VsZCBiZSA8PSAke29wdGlvbnMubWF4Vm9sdW1lfWAsXHJcbiAgICAgIHBoZXRpb0hpZ2hGcmVxdWVuY3k6IHRydWVcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBVc2VkIHRvIHVwZGF0ZSB0b3RhbCB2b2x1bWUgYXRvbWljYWxseSB3aGVuIGRyYWluaW5nIHNvbHV0aW9uLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3BoLXNjYWxlL2lzc3Vlcy8yNVxyXG4gICAgdGhpcy5pZ25vcmVWb2x1bWVVcGRhdGUgPSBmYWxzZTtcclxuXHJcbiAgICB0aGlzLnRvdGFsVm9sdW1lUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgICBbIHRoaXMuc29sdXRlVm9sdW1lUHJvcGVydHksIHRoaXMud2F0ZXJWb2x1bWVQcm9wZXJ0eSBdLFxyXG4gICAgICAoIHNvbHV0ZVZvbHVtZSwgd2F0ZXJWb2x1bWUgKSA9PiAoIHRoaXMuaWdub3JlVm9sdW1lVXBkYXRlICkgPyB0aGlzLnRvdGFsVm9sdW1lUHJvcGVydHkudmFsdWUgOiAoIHNvbHV0ZVZvbHVtZSArIHdhdGVyVm9sdW1lICksIHtcclxuICAgICAgICB1bml0czogJ0wnLFxyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndG90YWxWb2x1bWVQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9WYWx1ZVR5cGU6IE51bWJlcklPLFxyXG4gICAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICd0b3RhbCB2b2x1bWUgb2YgdGhlIHNvbHV0aW9uJyxcclxuICAgICAgICBwaGV0aW9IaWdoRnJlcXVlbmN5OiB0cnVlXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnBIUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgICBbIHRoaXMuc29sdXRlUHJvcGVydHksIHRoaXMuc29sdXRlVm9sdW1lUHJvcGVydHksIHRoaXMud2F0ZXJWb2x1bWVQcm9wZXJ0eSBdLFxyXG4gICAgICAoIHNvbHV0ZSwgc29sdXRlVm9sdW1lLCB3YXRlclZvbHVtZSApID0+IHtcclxuICAgICAgICBpZiAoIHRoaXMuaWdub3JlVm9sdW1lVXBkYXRlICkge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMucEhQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gUEhNb2RlbC5jb21wdXRlUEgoIHNvbHV0ZS5wSCwgc29sdXRlVm9sdW1lLCB3YXRlclZvbHVtZSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSwge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncEhQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9WYWx1ZVR5cGU6IE51bGxhYmxlSU8oIE51bWJlcklPICksXHJcbiAgICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ3BIIG9mIHRoZSBzb2x1dGlvbicsXHJcbiAgICAgICAgcGhldGlvSGlnaEZyZXF1ZW5jeTogdHJ1ZVxyXG4gICAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5jb2xvclByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eShcclxuICAgICAgWyB0aGlzLnNvbHV0ZVByb3BlcnR5LCB0aGlzLnNvbHV0ZVZvbHVtZVByb3BlcnR5LCB0aGlzLndhdGVyVm9sdW1lUHJvcGVydHkgXSxcclxuICAgICAgKCBzb2x1dGUsIHNvbHV0ZVZvbHVtZSwgd2F0ZXJWb2x1bWUgKSA9PiB7XHJcbiAgICAgICAgaWYgKCB0aGlzLmlnbm9yZVZvbHVtZVVwZGF0ZSApIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmNvbG9yUHJvcGVydHkudmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCBzb2x1dGVWb2x1bWUgKyB3YXRlclZvbHVtZSA9PT0gMCApIHtcclxuICAgICAgICAgIHJldHVybiBDb2xvci5CTEFDSzsgLy8gbm8gc29sdXRpb24sIHNob3VsZCBuZXZlciBzZWUgdGhpcyBjb2xvciBkaXNwbGF5ZWRcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIHNvbHV0ZVZvbHVtZSA9PT0gMCB8fCBQSE1vZGVsLmlzRXF1aXZhbGVudFRvV2F0ZXIoIHRoaXMucEhQcm9wZXJ0eS52YWx1ZSApICkge1xyXG4gICAgICAgICAgcmV0dXJuIFdhdGVyLmNvbG9yO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiBzb2x1dGUuY29tcHV0ZUNvbG9yKCBzb2x1dGVWb2x1bWUgLyAoIHNvbHV0ZVZvbHVtZSArIHdhdGVyVm9sdW1lICkgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBXaGVuIHRoZSBzb2x1dGUgY2hhbmdlcywgcmVzZXQgdG8gaW5pdGlhbCB2b2x1bWVzLlxyXG4gICAgLy8gVGhpcyBpcyBzaG9ydC1jaXJjdWl0ZWQgd2hpbGUgUGhFVC1pTyBzdGF0ZSBpcyBiZWluZyByZXN0b3JlZC4gT3RoZXJ3aXNlLCB0aGUgcmVzdG9yZWQgc3RhdGUgd291bGQgYmUgY2hhbmdlZC5cclxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcGgtc2NhbGUvaXNzdWVzLzEzMlxyXG4gICAgdGhpcy5zb2x1dGVQcm9wZXJ0eS5saW5rKCAoKSA9PiB7XHJcbiAgICAgIGlmICggIXBoZXQuam9pc3Quc2ltLmlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgdGhpcy53YXRlclZvbHVtZVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICAgICAgdGhpcy5zb2x1dGVWb2x1bWVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLnNvbHV0ZVZvbHVtZVByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLndhdGVyVm9sdW1lUHJvcGVydHkucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIC8vIFZvbHVtZSAoTGl0ZXJzKVxyXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAvLyBSZXR1cm5zIHRoZSBhbW91bnQgb2Ygdm9sdW1lIHRoYXQgaXMgYXZhaWxhYmxlIHRvIGZpbGwuXHJcbiAgcHJpdmF0ZSBnZXRGcmVlVm9sdW1lKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5tYXhWb2x1bWUgLSB0aGlzLnRvdGFsVm9sdW1lUHJvcGVydHkudmFsdWU7XHJcbiAgfVxyXG5cclxuICAvLyBDb252ZW5pZW5jZSBmdW5jdGlvbiBmb3IgYWRkaW5nIHNvbHV0ZVxyXG4gIHB1YmxpYyBhZGRTb2x1dGUoIGRlbHRhVm9sdW1lOiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICBpZiAoIGRlbHRhVm9sdW1lID4gMCApIHtcclxuICAgICAgdGhpcy5zb2x1dGVWb2x1bWVQcm9wZXJ0eS52YWx1ZSA9XHJcbiAgICAgICAgTWF0aC5tYXgoIE1JTl9WT0xVTUUsIHRoaXMuc29sdXRlVm9sdW1lUHJvcGVydHkudmFsdWUgKyBNYXRoLm1pbiggZGVsdGFWb2x1bWUsIHRoaXMuZ2V0RnJlZVZvbHVtZSgpICkgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIENvbnZlbmllbmNlIGZ1bmN0aW9uIGZvciBhZGRpbmcgd2F0ZXJcclxuICBwdWJsaWMgYWRkV2F0ZXIoIGRlbHRhVm9sdW1lOiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICBpZiAoIGRlbHRhVm9sdW1lID4gMCApIHtcclxuICAgICAgdGhpcy53YXRlclZvbHVtZVByb3BlcnR5LnZhbHVlID1cclxuICAgICAgICBNYXRoLm1heCggTUlOX1ZPTFVNRSwgdGhpcy53YXRlclZvbHVtZVByb3BlcnR5LnZhbHVlICsgTWF0aC5taW4oIGRlbHRhVm9sdW1lLCB0aGlzLmdldEZyZWVWb2x1bWUoKSApICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEcmFpbnMgYSBzcGVjaWZpZWQgYW1vdW50IG9mIHNvbHV0aW9uLCBpbiBsaXRlcnMuXHJcbiAgICovXHJcbiAgcHVibGljIGRyYWluU29sdXRpb24oIGRlbHRhVm9sdW1lOiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICBpZiAoIGRlbHRhVm9sdW1lID4gMCApIHtcclxuICAgICAgY29uc3QgdG90YWxWb2x1bWUgPSB0aGlzLnRvdGFsVm9sdW1lUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIGlmICggdG90YWxWb2x1bWUgPiAwICkge1xyXG4gICAgICAgIGlmICggdG90YWxWb2x1bWUgLSBkZWx0YVZvbHVtZSA8IE1JTl9WT0xVTUUgKSB7XHJcbiAgICAgICAgICAvLyBkcmFpbiB0aGUgcmVtYWluaW5nIHNvbHV0aW9uXHJcbiAgICAgICAgICB0aGlzLnNldFZvbHVtZUF0b21pYyggMCwgMCApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIC8vIGRyYWluIGVxdWFsIHBlcmNlbnRhZ2VzIG9mIHdhdGVyIGFuZCBzb2x1dGVcclxuICAgICAgICAgIGNvbnN0IHdhdGVyVm9sdW1lID0gdGhpcy53YXRlclZvbHVtZVByb3BlcnR5LnZhbHVlO1xyXG4gICAgICAgICAgY29uc3Qgc29sdXRlVm9sdW1lID0gdGhpcy5zb2x1dGVWb2x1bWVQcm9wZXJ0eS52YWx1ZTtcclxuICAgICAgICAgIHRoaXMuc2V0Vm9sdW1lQXRvbWljKCB3YXRlclZvbHVtZSAtICggZGVsdGFWb2x1bWUgKiB3YXRlclZvbHVtZSAvIHRvdGFsVm9sdW1lICksIHNvbHV0ZVZvbHVtZSAtICggZGVsdGFWb2x1bWUgKiBzb2x1dGVWb2x1bWUgLyB0b3RhbFZvbHVtZSApICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHZvbHVtZSBhdG9taWNhbGx5LCB0byBwcmV2ZW50IHBIIHZhbHVlIGZyb20gZ29pbmcgdGhyb3VnaCBhbiBpbnRlcm1lZGlhdGUgc3RhdGUuXHJcbiAgICogVGhpcyBpcyB1c2VkIHdoZW4gZHJhaW5pbmcgc29sdXRpb24sIHNvIHRoYXQgZXF1YWwgcGFydHMgb2Ygc29sdXRlIGFuZCB3YXRlciBhcmUgcmVtb3ZlZCBhdG9taWNhbGx5LlxyXG4gICAqIFNlZSBkb2N1bWVudGF0aW9uIG9mIGlnbm9yZVZvbHVtZVVwZGF0ZSBhYm92ZSwgYW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9waC1zY2FsZS9pc3N1ZXMvMjUuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzZXRWb2x1bWVBdG9taWMoIHdhdGVyVm9sdW1lOiBudW1iZXIsIHNvbHV0ZVZvbHVtZTogbnVtYmVyICk6IHZvaWQge1xyXG5cclxuICAgIC8vIGlnbm9yZSB0aGUgZmlyc3Qgbm90aWZpY2F0aW9uIGlmIGJvdGggdm9sdW1lcyBhcmUgY2hhbmdpbmdcclxuICAgIHRoaXMuaWdub3JlVm9sdW1lVXBkYXRlID0gKCB3YXRlclZvbHVtZSAhPT0gdGhpcy53YXRlclZvbHVtZVByb3BlcnR5LnZhbHVlICkgJiYgKCBzb2x1dGVWb2x1bWUgIT09IHRoaXMuc29sdXRlVm9sdW1lUHJvcGVydHkudmFsdWUgKTtcclxuICAgIHRoaXMud2F0ZXJWb2x1bWVQcm9wZXJ0eS52YWx1ZSA9IHdhdGVyVm9sdW1lO1xyXG4gICAgdGhpcy5pZ25vcmVWb2x1bWVVcGRhdGUgPSBmYWxzZTsgLy8gZG9uJ3QgaWdub3JlIHRoZSBzZWNvbmQgbm90aWZpY2F0aW9uLCBzbyB0aGF0IG9ic2VydmVycyB3aWxsIHVwZGF0ZVxyXG4gICAgdGhpcy5zb2x1dGVWb2x1bWVQcm9wZXJ0eS52YWx1ZSA9IHNvbHV0ZVZvbHVtZTtcclxuICB9XHJcbn1cclxuXHJcbnBoU2NhbGUucmVnaXN0ZXIoICdTb2x1dGlvbicsIFNvbHV0aW9uICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxjQUFjLE1BQU0sdUNBQXVDO0FBR2xFLE9BQU9DLFNBQVMsTUFBTSx1Q0FBdUM7QUFFN0QsU0FBU0MsS0FBSyxRQUFRLG1DQUFtQztBQUN6RCxPQUFPQyxZQUFZLE1BQStCLHVDQUF1QztBQUN6RixPQUFPQyxVQUFVLE1BQU0sMkNBQTJDO0FBQ2xFLE9BQU9D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