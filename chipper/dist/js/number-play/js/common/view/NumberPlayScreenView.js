// Copyright 2019-2023, University of Colorado Boulder

/**
 * ScreenView base class for Number Play. It is used for both the 'Ten' and 'Twenty' screens.
 *
 * @author Chris Klusendorf (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import ScreenView from '../../../../joist/js/ScreenView.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import { Image } from '../../../../scenery/js/imports.js';
import RectangularRadioButtonGroup from '../../../../sun/js/buttons/RectangularRadioButtonGroup.js';
import groupingScene1_png from '../../../images/groupingScene1_png.js';
import groupingScene2_png from '../../../images/groupingScene2_png.js';
import groupingScene3_png from '../../../images/groupingScene3_png.js';
import numberPlay from '../../numberPlay.js';
import NumberPlayColors from '../NumberPlayColors.js';
import NumberPlayConstants from '../NumberPlayConstants.js';
import CountingAccordionBox from '../../../../number-suite-common/js/common/view/CountingAccordionBox.js';
import SpeechSynthesisControl from '../../../../number-suite-common/js/common/view/SpeechSynthesisControl.js';
import TenFrameAccordionBox from './TenFrameAccordionBox.js';
import TotalAccordionBox from '../../../../number-suite-common/js/common/view/TotalAccordionBox.js';
import WordAccordionBox from './WordAccordionBox.js';
import CountingObjectType from '../../../../counting-common/js/common/model/CountingObjectType.js';
import NumberPlayStrings from '../../NumberPlayStrings.js';
import OrganizeButton from '../../../../number-suite-common/js/common/view/OrganizeButton.js';
import GroupAndLinkType from '../../../../number-suite-common/js/common/model/GroupAndLinkType.js';
import EnumerationProperty from '../../../../axon/js/EnumerationProperty.js';
import numberPlaySpeechSynthesisAnnouncer from './numberPlaySpeechSynthesisAnnouncer.js';
import numberPlayPreferences from '../model/numberPlayPreferences.js';
import Multilink from '../../../../axon/js/Multilink.js';
import numberPlayUtteranceQueue from './numberPlayUtteranceQueue.js';
import NumberSuiteCommonConstants from '../../../../number-suite-common/js/common/NumberSuiteCommonConstants.js';
import LocaleSwitch from './LocaleSwitch.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';

// types

// constants
const GROUPING_LINKING_TYPE_TO_IMAGE = new Map();
GROUPING_LINKING_TYPE_TO_IMAGE.set(GroupAndLinkType.UNGROUPED, groupingScene1_png);
GROUPING_LINKING_TYPE_TO_IMAGE.set(GroupAndLinkType.GROUPED, groupingScene2_png);
GROUPING_LINKING_TYPE_TO_IMAGE.set(GroupAndLinkType.GROUPED_AND_LINKED, groupingScene3_png);
class NumberPlayScreenView extends ScreenView {
  constructor(model, options) {
    super(options);

    // Properties used to control the expanded state of each accordion box
    this.wordAccordionBoxExpandedProperty = new BooleanProperty(false);
    this.totalAccordionBoxExpandedProperty = new BooleanProperty(true);
    this.tenFrameAccordionBoxExpandedProperty = new BooleanProperty(false);
    this.onesAccordionBoxExpandedProperty = new BooleanProperty(true);
    this.objectsAccordionBoxExpandedProperty = new BooleanProperty(true);
    const wordAccordionBoxHeightProperty = new NumberProperty(options.upperAccordionBoxHeight);

    // create and add the WordAccordionBox
    const wordAccordionBox = new WordAccordionBox(model.currentNumberProperty, wordAccordionBoxHeightProperty, {
      expandedProperty: this.wordAccordionBoxExpandedProperty,
      ...options.wordAccordionBoxOptions
    });
    wordAccordionBox.left = this.layoutBounds.minX + NumberSuiteCommonConstants.ACCORDION_BOX_MARGIN_X;
    wordAccordionBox.top = this.layoutBounds.minY + NumberSuiteCommonConstants.SCREEN_VIEW_PADDING_Y;
    this.addChild(wordAccordionBox);

    // create and add the TotalAccordionBox
    const totalAccordionBox = new TotalAccordionBox(model.onesCountingArea, options.upperAccordionBoxHeight, {
      expandedProperty: this.totalAccordionBoxExpandedProperty,
      ...options.totalAccordionBoxOptions
    });
    totalAccordionBox.centerX = this.layoutBounds.centerX;
    totalAccordionBox.top = wordAccordionBox.top;
    this.addChild(totalAccordionBox);

    // create and add the TenFrameAccordionBox
    const tenFrameAccordionBox = new TenFrameAccordionBox(model.currentNumberProperty, model.sumRange, options.upperAccordionBoxHeight, {
      expandedProperty: this.tenFrameAccordionBoxExpandedProperty,
      ...options.tenFrameAccordionBoxOptions
    });
    tenFrameAccordionBox.right = this.layoutBounds.maxX - NumberSuiteCommonConstants.ACCORDION_BOX_MARGIN_X;
    tenFrameAccordionBox.top = wordAccordionBox.top;
    this.addChild(tenFrameAccordionBox);

    // create and add the CountingAccordionBox for paper ones
    const onesAccordionBox = new CountingAccordionBox(model.onesCountingArea, new EnumerationProperty(CountingObjectType.PAPER_NUMBER), NumberPlayConstants.LOWER_ACCORDION_BOX_CONTENT_WIDTH, options.lowerAccordionBoxHeight, {
      titleStringProperty: NumberPlayStrings.onesStringProperty,
      expandedProperty: this.onesAccordionBoxExpandedProperty,
      fill: NumberPlayColors.pinkBackgroundColorProperty
    });
    onesAccordionBox.left = this.layoutBounds.minX + NumberSuiteCommonConstants.ACCORDION_BOX_MARGIN_X;
    onesAccordionBox.bottom = this.layoutBounds.maxY - NumberSuiteCommonConstants.SCREEN_VIEW_PADDING_Y;
    this.addChild(onesAccordionBox);

    // create and add the LocaleSwitch
    const localeSwitch = new LocaleSwitch(numberPlayPreferences, numberPlayUtteranceQueue, wordAccordionBox.width);
    this.addChild(localeSwitch);

    // Changes in locale will change the text in this control, so realign it
    localeSwitch.boundsProperty.link(() => {
      localeSwitch.left = wordAccordionBox.left + 10;
    });

    // update the position of the localeSwitch
    Multilink.multilink([wordAccordionBox.expandedProperty, numberPlayPreferences.showSecondLocaleProperty], (isExpanded, showSecondLocale) => {
      wordAccordionBoxHeightProperty.value = showSecondLocale ? options.upperAccordionBoxHeight - localeSwitch.height - 3 : options.upperAccordionBoxHeight;
      const currentWordAccordionBoxHeight = isExpanded ? wordAccordionBox.getExpandedBoxHeight() : wordAccordionBox.getCollapsedBoxHeight();

      // Use .bottom so the margin is identical to what would center the localeSwitch when the wordAccordionBox is expanded.
      const margin = (onesAccordionBox.top - wordAccordionBox.bottom) / 2;
      localeSwitch.centerY = wordAccordionBox.top + currentWordAccordionBoxHeight + margin;
    });

    // create and add the CountingAccordionBox for countingObjects
    this.objectsAccordionBox = new CountingAccordionBox(model.objectsCountingArea, model.countingObjectTypeProperty, NumberPlayConstants.LOWER_ACCORDION_BOX_CONTENT_WIDTH, options.lowerAccordionBoxHeight, {
      countingObjectTypes: [CountingObjectType.DOG, CountingObjectType.APPLE, CountingObjectType.BUTTERFLY, CountingObjectType.BALL],
      linkStatusChangedEmitter: model.linkStatusChangedEmitter,
      linkedCountingArea: model.onesCountingArea,
      expandedProperty: this.objectsAccordionBoxExpandedProperty,
      fill: NumberPlayColors.blueBackgroundColorProperty
    });
    this.objectsAccordionBox.right = this.layoutBounds.maxX - NumberSuiteCommonConstants.ACCORDION_BOX_MARGIN_X;
    this.objectsAccordionBox.bottom = onesAccordionBox.bottom;
    this.addChild(this.objectsAccordionBox);

    // create and add the ResetAllButton
    const resetAllButton = new ResetAllButton({
      listener: () => {
        this.interruptSubtreeInput(); // cancel interactions that may be in progress
        model.reset();
        this.reset();
      },
      right: this.layoutBounds.maxX - NumberSuiteCommonConstants.SCREEN_VIEW_PADDING_X,
      bottom: this.layoutBounds.maxY - NumberSuiteCommonConstants.SCREEN_VIEW_PADDING_Y,
      tandem: options.tandem.createTandem('resetAllButton')
    });
    this.addChild(resetAllButton);

    // Add the SpeechSynthesisControl, if the announcer is initialized.
    if (numberPlaySpeechSynthesisAnnouncer.initialized) {
      const speechSynthesisControl = new SpeechSynthesisControl(numberPlaySpeechSynthesisAnnouncer, numberPlayUtteranceQueue, {
        left: this.layoutBounds.minX + NumberSuiteCommonConstants.SCREEN_VIEW_PADDING_X,
        top: tenFrameAccordionBox.top
      });
      this.addChild(speechSynthesisControl);
    }

    // create the icons for the RectangularRadioButtonGroup
    const groupingLinkingButtons = [];
    const margin = 4.5;
    GroupAndLinkType.enumeration.values.forEach(groupAndLinkType => {
      groupingLinkingButtons.push({
        value: groupAndLinkType,
        createNode: () => new Image(GROUPING_LINKING_TYPE_TO_IMAGE.get(groupAndLinkType), {
          maxWidth: resetAllButton.width - 2 * margin
        })
      });
    });

    // Create and add the RectangularRadioButtonGroup, which is a control for changing the CountingObjectType of the countingObjects
    const groupingLinkingRadioButtonGroup = new RectangularRadioButtonGroup(model.objectsGroupAndLinkTypeProperty, groupingLinkingButtons, {
      orientation: 'vertical',
      spacing: 10,
      radioButtonOptions: {
        baseColor: NumberPlayColors.blueBackgroundColorProperty,
        xMargin: margin,
        yMargin: margin
      }
    });
    groupingLinkingRadioButtonGroup.centerX = resetAllButton.centerX;
    groupingLinkingRadioButtonGroup.centerY = this.objectsAccordionBox.centerY;
    this.addChild(groupingLinkingRadioButtonGroup);

    // create and add a button to organize the onesAccordionBox paper ones in a grid
    const organizeOnesButton = new OrganizeButton(NumberPlayColors.pinkBackgroundColorProperty, () => {
      model.onesCountingArea.organizeObjects();
    });
    organizeOnesButton.left = NumberSuiteCommonConstants.SCREEN_VIEW_PADDING_X;
    organizeOnesButton.top = onesAccordionBox.top;
    this.addChild(organizeOnesButton);

    // create and add a button to organize the objectsAccordionBox countingObjects in a grid
    const organizeObjectsButton = new OrganizeButton(NumberPlayColors.blueBackgroundColorProperty, () => {
      if (model.objectsGroupAndLinkTypeProperty.value === GroupAndLinkType.GROUPED_AND_LINKED) {
        model.onesCountingArea.organizeObjects();
      } else {
        model.objectsCountingArea.organizeObjects();
      }
    });
    organizeObjectsButton.centerX = resetAllButton.centerX;
    organizeObjectsButton.top = this.objectsAccordionBox.top;
    this.addChild(organizeObjectsButton);
    model.objectsGroupAndLinkTypeProperty.lazyLink((groupAndLinkType, previousGroupAndLinkType) => {
      // If the GroupAndLinkType changes, interrupt interaction with objects in these accordion boxes.
      // See https://github.com/phetsims/number-play/issues/173
      onesAccordionBox.interruptSubtreeInput();
      this.objectsAccordionBox.interruptSubtreeInput();
      const objectsLinkedToOnes = groupAndLinkType === GroupAndLinkType.GROUPED_AND_LINKED;
      const objectsLinkedToOnesPreviously = previousGroupAndLinkType === GroupAndLinkType.GROUPED_AND_LINKED;

      // If switching between linked and unlinked, set the objectsCountingArea to the appropriate state.
      if (objectsLinkedToOnes !== objectsLinkedToOnesPreviously) {
        model.objectsCountingArea.matchCountingObjectsToLinkedCountingArea(onesAccordionBox.countingAreaNode.getSerializedCountingObjectsIncludedInSum(), model.linkStatusChangedEmitter, objectsLinkedToOnes, groupAndLinkType);
      }
    });
  }

  /**
   * Resets the view.
   */
  reset() {
    this.wordAccordionBoxExpandedProperty.reset();
    this.totalAccordionBoxExpandedProperty.reset();
    this.tenFrameAccordionBoxExpandedProperty.reset();
    this.onesAccordionBoxExpandedProperty.reset();
    this.objectsAccordionBoxExpandedProperty.reset();
    numberPlayPreferences.autoHearEnabledProperty.value && numberPlayUtteranceQueue.speakSpeechData();
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
}
numberPlay.register('NumberPlayScreenView', NumberPlayScreenView);
export default NumberPlayScreenView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJTY3JlZW5WaWV3IiwiUmVzZXRBbGxCdXR0b24iLCJJbWFnZSIsIlJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cCIsImdyb3VwaW5nU2NlbmUxX3BuZyIsImdyb3VwaW5nU2NlbmUyX3BuZyIsImdyb3VwaW5nU2NlbmUzX3BuZyIsIm51bWJlclBsYXkiLCJOdW1iZXJQbGF5Q29sb3JzIiwiTnVtYmVyUGxheUNvbnN0YW50cyIsIkNvdW50aW5nQWNjb3JkaW9uQm94IiwiU3BlZWNoU3ludGhlc2lzQ29udHJvbCIsIlRlbkZyYW1lQWNjb3JkaW9uQm94IiwiVG90YWxBY2NvcmRpb25Cb3giLCJXb3JkQWNjb3JkaW9uQm94IiwiQ291bnRpbmdPYmplY3RUeXBlIiwiTnVtYmVyUGxheVN0cmluZ3MiLCJPcmdhbml6ZUJ1dHRvbiIsIkdyb3VwQW5kTGlua1R5cGUiLCJFbnVtZXJhdGlvblByb3BlcnR5IiwibnVtYmVyUGxheVNwZWVjaFN5bnRoZXNpc0Fubm91bmNlciIsIm51bWJlclBsYXlQcmVmZXJlbmNlcyIsIk11bHRpbGluayIsIm51bWJlclBsYXlVdHRlcmFuY2VRdWV1ZSIsIk51bWJlclN1aXRlQ29tbW9uQ29uc3RhbnRzIiwiTG9jYWxlU3dpdGNoIiwiTnVtYmVyUHJvcGVydHkiLCJHUk9VUElOR19MSU5LSU5HX1RZUEVfVE9fSU1BR0UiLCJNYXAiLCJzZXQiLCJVTkdST1VQRUQiLCJHUk9VUEVEIiwiR1JPVVBFRF9BTkRfTElOS0VEIiwiTnVtYmVyUGxheVNjcmVlblZpZXciLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwib3B0aW9ucyIsIndvcmRBY2NvcmRpb25Cb3hFeHBhbmRlZFByb3BlcnR5IiwidG90YWxBY2NvcmRpb25Cb3hFeHBhbmRlZFByb3BlcnR5IiwidGVuRnJhbWVBY2NvcmRpb25Cb3hFeHBhbmRlZFByb3BlcnR5Iiwib25lc0FjY29yZGlvbkJveEV4cGFuZGVkUHJvcGVydHkiLCJvYmplY3RzQWNjb3JkaW9uQm94RXhwYW5kZWRQcm9wZXJ0eSIsIndvcmRBY2NvcmRpb25Cb3hIZWlnaHRQcm9wZXJ0eSIsInVwcGVyQWNjb3JkaW9uQm94SGVpZ2h0Iiwid29yZEFjY29yZGlvbkJveCIsImN1cnJlbnROdW1iZXJQcm9wZXJ0eSIsImV4cGFuZGVkUHJvcGVydHkiLCJ3b3JkQWNjb3JkaW9uQm94T3B0aW9ucyIsImxlZnQiLCJsYXlvdXRCb3VuZHMiLCJtaW5YIiwiQUNDT1JESU9OX0JPWF9NQVJHSU5fWCIsInRvcCIsIm1pblkiLCJTQ1JFRU5fVklFV19QQURESU5HX1kiLCJhZGRDaGlsZCIsInRvdGFsQWNjb3JkaW9uQm94Iiwib25lc0NvdW50aW5nQXJlYSIsInRvdGFsQWNjb3JkaW9uQm94T3B0aW9ucyIsImNlbnRlclgiLCJ0ZW5GcmFtZUFjY29yZGlvbkJveCIsInN1bVJhbmdlIiwidGVuRnJhbWVBY2NvcmRpb25Cb3hPcHRpb25zIiwicmlnaHQiLCJtYXhYIiwib25lc0FjY29yZGlvbkJveCIsIlBBUEVSX05VTUJFUiIsIkxPV0VSX0FDQ09SRElPTl9CT1hfQ09OVEVOVF9XSURUSCIsImxvd2VyQWNjb3JkaW9uQm94SGVpZ2h0IiwidGl0bGVTdHJpbmdQcm9wZXJ0eSIsIm9uZXNTdHJpbmdQcm9wZXJ0eSIsImZpbGwiLCJwaW5rQmFja2dyb3VuZENvbG9yUHJvcGVydHkiLCJib3R0b20iLCJtYXhZIiwibG9jYWxlU3dpdGNoIiwid2lkdGgiLCJib3VuZHNQcm9wZXJ0eSIsImxpbmsiLCJtdWx0aWxpbmsiLCJzaG93U2Vjb25kTG9jYWxlUHJvcGVydHkiLCJpc0V4cGFuZGVkIiwic2hvd1NlY29uZExvY2FsZSIsInZhbHVlIiwiaGVpZ2h0IiwiY3VycmVudFdvcmRBY2NvcmRpb25Cb3hIZWlnaHQiLCJnZXRFeHBhbmRlZEJveEhlaWdodCIsImdldENvbGxhcHNlZEJveEhlaWdodCIsIm1hcmdpbiIsImNlbnRlclkiLCJvYmplY3RzQWNjb3JkaW9uQm94Iiwib2JqZWN0c0NvdW50aW5nQXJlYSIsImNvdW50aW5nT2JqZWN0VHlwZVByb3BlcnR5IiwiY291bnRpbmdPYmplY3RUeXBlcyIsIkRPRyIsIkFQUExFIiwiQlVUVEVSRkxZIiwiQkFMTCIsImxpbmtTdGF0dXNDaGFuZ2VkRW1pdHRlciIsImxpbmtlZENvdW50aW5nQXJlYSIsImJsdWVCYWNrZ3JvdW5kQ29sb3JQcm9wZXJ0eSIsInJlc2V0QWxsQnV0dG9uIiwibGlzdGVuZXIiLCJpbnRlcnJ1cHRTdWJ0cmVlSW5wdXQiLCJyZXNldCIsIlNDUkVFTl9WSUVXX1BBRERJTkdfWCIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsImluaXRpYWxpemVkIiwic3BlZWNoU3ludGhlc2lzQ29udHJvbCIsImdyb3VwaW5nTGlua2luZ0J1dHRvbnMiLCJlbnVtZXJhdGlvbiIsInZhbHVlcyIsImZvckVhY2giLCJncm91cEFuZExpbmtUeXBlIiwicHVzaCIsImNyZWF0ZU5vZGUiLCJnZXQiLCJtYXhXaWR0aCIsImdyb3VwaW5nTGlua2luZ1JhZGlvQnV0dG9uR3JvdXAiLCJvYmplY3RzR3JvdXBBbmRMaW5rVHlwZVByb3BlcnR5Iiwib3JpZW50YXRpb24iLCJzcGFjaW5nIiwicmFkaW9CdXR0b25PcHRpb25zIiwiYmFzZUNvbG9yIiwieE1hcmdpbiIsInlNYXJnaW4iLCJvcmdhbml6ZU9uZXNCdXR0b24iLCJvcmdhbml6ZU9iamVjdHMiLCJvcmdhbml6ZU9iamVjdHNCdXR0b24iLCJsYXp5TGluayIsInByZXZpb3VzR3JvdXBBbmRMaW5rVHlwZSIsIm9iamVjdHNMaW5rZWRUb09uZXMiLCJvYmplY3RzTGlua2VkVG9PbmVzUHJldmlvdXNseSIsIm1hdGNoQ291bnRpbmdPYmplY3RzVG9MaW5rZWRDb3VudGluZ0FyZWEiLCJjb3VudGluZ0FyZWFOb2RlIiwiZ2V0U2VyaWFsaXplZENvdW50aW5nT2JqZWN0c0luY2x1ZGVkSW5TdW0iLCJhdXRvSGVhckVuYWJsZWRQcm9wZXJ0eSIsInNwZWFrU3BlZWNoRGF0YSIsImRpc3Bvc2UiLCJhc3NlcnQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIk51bWJlclBsYXlTY3JlZW5WaWV3LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFNjcmVlblZpZXcgYmFzZSBjbGFzcyBmb3IgTnVtYmVyIFBsYXkuIEl0IGlzIHVzZWQgZm9yIGJvdGggdGhlICdUZW4nIGFuZCAnVHdlbnR5JyBzY3JlZW5zLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIEtsdXNlbmRvcmYgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBTY3JlZW5WaWV3IGZyb20gJy4uLy4uLy4uLy4uL2pvaXN0L2pzL1NjcmVlblZpZXcuanMnO1xyXG5pbXBvcnQgUmVzZXRBbGxCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL2J1dHRvbnMvUmVzZXRBbGxCdXR0b24uanMnO1xyXG5pbXBvcnQgeyBJbWFnZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBSZWN0YW5ndWxhclJhZGlvQnV0dG9uR3JvdXAsIHsgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwSXRlbSB9IGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9idXR0b25zL1JlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cC5qcyc7XHJcbmltcG9ydCBncm91cGluZ1NjZW5lMV9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2dyb3VwaW5nU2NlbmUxX3BuZy5qcyc7XHJcbmltcG9ydCBncm91cGluZ1NjZW5lMl9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2dyb3VwaW5nU2NlbmUyX3BuZy5qcyc7XHJcbmltcG9ydCBncm91cGluZ1NjZW5lM19wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2dyb3VwaW5nU2NlbmUzX3BuZy5qcyc7XHJcbmltcG9ydCBudW1iZXJQbGF5IGZyb20gJy4uLy4uL251bWJlclBsYXkuanMnO1xyXG5pbXBvcnQgTnVtYmVyUGxheUNvbG9ycyBmcm9tICcuLi9OdW1iZXJQbGF5Q29sb3JzLmpzJztcclxuaW1wb3J0IE51bWJlclBsYXlDb25zdGFudHMgZnJvbSAnLi4vTnVtYmVyUGxheUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBDb3VudGluZ0FjY29yZGlvbkJveCBmcm9tICcuLi8uLi8uLi8uLi9udW1iZXItc3VpdGUtY29tbW9uL2pzL2NvbW1vbi92aWV3L0NvdW50aW5nQWNjb3JkaW9uQm94LmpzJztcclxuaW1wb3J0IFNwZWVjaFN5bnRoZXNpc0NvbnRyb2wgZnJvbSAnLi4vLi4vLi4vLi4vbnVtYmVyLXN1aXRlLWNvbW1vbi9qcy9jb21tb24vdmlldy9TcGVlY2hTeW50aGVzaXNDb250cm9sLmpzJztcclxuaW1wb3J0IFRlbkZyYW1lQWNjb3JkaW9uQm94LCB7IFRlbkZyYW1lQWNjb3JkaW9uQm94T3B0aW9ucyB9IGZyb20gJy4vVGVuRnJhbWVBY2NvcmRpb25Cb3guanMnO1xyXG5pbXBvcnQgVG90YWxBY2NvcmRpb25Cb3gsIHsgVG90YWxBY2NvcmRpb25Cb3hPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vbnVtYmVyLXN1aXRlLWNvbW1vbi9qcy9jb21tb24vdmlldy9Ub3RhbEFjY29yZGlvbkJveC5qcyc7XHJcbmltcG9ydCBXb3JkQWNjb3JkaW9uQm94LCB7IFdvcmRBY2NvcmRpb25Cb3hPcHRpb25zIH0gZnJvbSAnLi9Xb3JkQWNjb3JkaW9uQm94LmpzJztcclxuaW1wb3J0IE51bWJlclBsYXlNb2RlbCBmcm9tICcuLi9tb2RlbC9OdW1iZXJQbGF5TW9kZWwuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgQ291bnRpbmdPYmplY3RUeXBlIGZyb20gJy4uLy4uLy4uLy4uL2NvdW50aW5nLWNvbW1vbi9qcy9jb21tb24vbW9kZWwvQ291bnRpbmdPYmplY3RUeXBlLmpzJztcclxuaW1wb3J0IE51bWJlclBsYXlTdHJpbmdzIGZyb20gJy4uLy4uL051bWJlclBsYXlTdHJpbmdzLmpzJztcclxuaW1wb3J0IE9yZ2FuaXplQnV0dG9uIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1zdWl0ZS1jb21tb24vanMvY29tbW9uL3ZpZXcvT3JnYW5pemVCdXR0b24uanMnO1xyXG5pbXBvcnQgR3JvdXBBbmRMaW5rVHlwZSBmcm9tICcuLi8uLi8uLi8uLi9udW1iZXItc3VpdGUtY29tbW9uL2pzL2NvbW1vbi9tb2RlbC9Hcm91cEFuZExpbmtUeXBlLmpzJztcclxuaW1wb3J0IEVudW1lcmF0aW9uUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbnVtZXJhdGlvblByb3BlcnR5LmpzJztcclxuaW1wb3J0IG51bWJlclBsYXlTcGVlY2hTeW50aGVzaXNBbm5vdW5jZXIgZnJvbSAnLi9udW1iZXJQbGF5U3BlZWNoU3ludGhlc2lzQW5ub3VuY2VyLmpzJztcclxuaW1wb3J0IG51bWJlclBsYXlQcmVmZXJlbmNlcyBmcm9tICcuLi9tb2RlbC9udW1iZXJQbGF5UHJlZmVyZW5jZXMuanMnO1xyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IG51bWJlclBsYXlVdHRlcmFuY2VRdWV1ZSBmcm9tICcuL251bWJlclBsYXlVdHRlcmFuY2VRdWV1ZS5qcyc7XHJcbmltcG9ydCBOdW1iZXJTdWl0ZUNvbW1vbkNvbnN0YW50cyBmcm9tICcuLi8uLi8uLi8uLi9udW1iZXItc3VpdGUtY29tbW9uL2pzL2NvbW1vbi9OdW1iZXJTdWl0ZUNvbW1vbkNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IExvY2FsZVN3aXRjaCBmcm9tICcuL0xvY2FsZVN3aXRjaC5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuXHJcbi8vIHR5cGVzXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcbiAgd29yZEFjY29yZGlvbkJveE9wdGlvbnM6IFdvcmRBY2NvcmRpb25Cb3hPcHRpb25zO1xyXG4gIHRvdGFsQWNjb3JkaW9uQm94T3B0aW9uczogVG90YWxBY2NvcmRpb25Cb3hPcHRpb25zO1xyXG4gIHRlbkZyYW1lQWNjb3JkaW9uQm94T3B0aW9uczogVGVuRnJhbWVBY2NvcmRpb25Cb3hPcHRpb25zO1xyXG4gIHVwcGVyQWNjb3JkaW9uQm94SGVpZ2h0OiBudW1iZXI7XHJcbiAgbG93ZXJBY2NvcmRpb25Cb3hIZWlnaHQ6IG51bWJlcjtcclxuICB0YW5kZW06IFRhbmRlbTtcclxufTtcclxuZXhwb3J0IHR5cGUgTnVtYmVyUGxheVNjcmVlblZpZXdPcHRpb25zID0gU2VsZk9wdGlvbnM7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgR1JPVVBJTkdfTElOS0lOR19UWVBFX1RPX0lNQUdFID0gbmV3IE1hcCgpO1xyXG5HUk9VUElOR19MSU5LSU5HX1RZUEVfVE9fSU1BR0Uuc2V0KCBHcm91cEFuZExpbmtUeXBlLlVOR1JPVVBFRCwgZ3JvdXBpbmdTY2VuZTFfcG5nICk7XHJcbkdST1VQSU5HX0xJTktJTkdfVFlQRV9UT19JTUFHRS5zZXQoIEdyb3VwQW5kTGlua1R5cGUuR1JPVVBFRCwgZ3JvdXBpbmdTY2VuZTJfcG5nICk7XHJcbkdST1VQSU5HX0xJTktJTkdfVFlQRV9UT19JTUFHRS5zZXQoIEdyb3VwQW5kTGlua1R5cGUuR1JPVVBFRF9BTkRfTElOS0VELCBncm91cGluZ1NjZW5lM19wbmcgKTtcclxuXHJcbmNsYXNzIE51bWJlclBsYXlTY3JlZW5WaWV3IGV4dGVuZHMgU2NyZWVuVmlldyB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgd29yZEFjY29yZGlvbkJveEV4cGFuZGVkUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgdG90YWxBY2NvcmRpb25Cb3hFeHBhbmRlZFByb3BlcnR5OiBQcm9wZXJ0eTxib29sZWFuPjtcclxuICBwcml2YXRlIHJlYWRvbmx5IHRlbkZyYW1lQWNjb3JkaW9uQm94RXhwYW5kZWRQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgcHJpdmF0ZSByZWFkb25seSBvbmVzQWNjb3JkaW9uQm94RXhwYW5kZWRQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgcHJpdmF0ZSByZWFkb25seSBvYmplY3RzQWNjb3JkaW9uQm94RXhwYW5kZWRQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcbiAgcHJpdmF0ZSByZWFkb25seSBvYmplY3RzQWNjb3JkaW9uQm94OiBDb3VudGluZ0FjY29yZGlvbkJveDtcclxuXHJcbiAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKCBtb2RlbDogTnVtYmVyUGxheU1vZGVsLCBvcHRpb25zOiBOdW1iZXJQbGF5U2NyZWVuVmlld09wdGlvbnMgKSB7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBQcm9wZXJ0aWVzIHVzZWQgdG8gY29udHJvbCB0aGUgZXhwYW5kZWQgc3RhdGUgb2YgZWFjaCBhY2NvcmRpb24gYm94XHJcbiAgICB0aGlzLndvcmRBY2NvcmRpb25Cb3hFeHBhbmRlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcclxuICAgIHRoaXMudG90YWxBY2NvcmRpb25Cb3hFeHBhbmRlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggdHJ1ZSApO1xyXG4gICAgdGhpcy50ZW5GcmFtZUFjY29yZGlvbkJveEV4cGFuZGVkUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xyXG4gICAgdGhpcy5vbmVzQWNjb3JkaW9uQm94RXhwYW5kZWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUgKTtcclxuICAgIHRoaXMub2JqZWN0c0FjY29yZGlvbkJveEV4cGFuZGVkUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlICk7XHJcblxyXG4gICAgY29uc3Qgd29yZEFjY29yZGlvbkJveEhlaWdodFByb3BlcnR5ID0gbmV3IE51bWJlclByb3BlcnR5KCBvcHRpb25zLnVwcGVyQWNjb3JkaW9uQm94SGVpZ2h0ICk7XHJcblxyXG4gICAgLy8gY3JlYXRlIGFuZCBhZGQgdGhlIFdvcmRBY2NvcmRpb25Cb3hcclxuICAgIGNvbnN0IHdvcmRBY2NvcmRpb25Cb3ggPSBuZXcgV29yZEFjY29yZGlvbkJveChcclxuICAgICAgbW9kZWwuY3VycmVudE51bWJlclByb3BlcnR5LFxyXG4gICAgICB3b3JkQWNjb3JkaW9uQm94SGVpZ2h0UHJvcGVydHksIHtcclxuICAgICAgICBleHBhbmRlZFByb3BlcnR5OiB0aGlzLndvcmRBY2NvcmRpb25Cb3hFeHBhbmRlZFByb3BlcnR5LFxyXG4gICAgICAgIC4uLm9wdGlvbnMud29yZEFjY29yZGlvbkJveE9wdGlvbnNcclxuICAgICAgfSApO1xyXG4gICAgd29yZEFjY29yZGlvbkJveC5sZWZ0ID0gdGhpcy5sYXlvdXRCb3VuZHMubWluWCArIE51bWJlclN1aXRlQ29tbW9uQ29uc3RhbnRzLkFDQ09SRElPTl9CT1hfTUFSR0lOX1g7XHJcbiAgICB3b3JkQWNjb3JkaW9uQm94LnRvcCA9IHRoaXMubGF5b3V0Qm91bmRzLm1pblkgKyBOdW1iZXJTdWl0ZUNvbW1vbkNvbnN0YW50cy5TQ1JFRU5fVklFV19QQURESU5HX1k7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB3b3JkQWNjb3JkaW9uQm94ICk7XHJcblxyXG4gICAgLy8gY3JlYXRlIGFuZCBhZGQgdGhlIFRvdGFsQWNjb3JkaW9uQm94XHJcbiAgICBjb25zdCB0b3RhbEFjY29yZGlvbkJveCA9IG5ldyBUb3RhbEFjY29yZGlvbkJveChcclxuICAgICAgbW9kZWwub25lc0NvdW50aW5nQXJlYSxcclxuICAgICAgb3B0aW9ucy51cHBlckFjY29yZGlvbkJveEhlaWdodCwge1xyXG4gICAgICAgIGV4cGFuZGVkUHJvcGVydHk6IHRoaXMudG90YWxBY2NvcmRpb25Cb3hFeHBhbmRlZFByb3BlcnR5LFxyXG4gICAgICAgIC4uLm9wdGlvbnMudG90YWxBY2NvcmRpb25Cb3hPcHRpb25zXHJcbiAgICAgIH0gKTtcclxuICAgIHRvdGFsQWNjb3JkaW9uQm94LmNlbnRlclggPSB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJYO1xyXG4gICAgdG90YWxBY2NvcmRpb25Cb3gudG9wID0gd29yZEFjY29yZGlvbkJveC50b3A7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0b3RhbEFjY29yZGlvbkJveCApO1xyXG5cclxuICAgIC8vIGNyZWF0ZSBhbmQgYWRkIHRoZSBUZW5GcmFtZUFjY29yZGlvbkJveFxyXG4gICAgY29uc3QgdGVuRnJhbWVBY2NvcmRpb25Cb3ggPSBuZXcgVGVuRnJhbWVBY2NvcmRpb25Cb3goXHJcbiAgICAgIG1vZGVsLmN1cnJlbnROdW1iZXJQcm9wZXJ0eSxcclxuICAgICAgbW9kZWwuc3VtUmFuZ2UsXHJcbiAgICAgIG9wdGlvbnMudXBwZXJBY2NvcmRpb25Cb3hIZWlnaHQsIHtcclxuICAgICAgICBleHBhbmRlZFByb3BlcnR5OiB0aGlzLnRlbkZyYW1lQWNjb3JkaW9uQm94RXhwYW5kZWRQcm9wZXJ0eSxcclxuICAgICAgICAuLi5vcHRpb25zLnRlbkZyYW1lQWNjb3JkaW9uQm94T3B0aW9uc1xyXG4gICAgICB9ICk7XHJcbiAgICB0ZW5GcmFtZUFjY29yZGlvbkJveC5yaWdodCA9IHRoaXMubGF5b3V0Qm91bmRzLm1heFggLSBOdW1iZXJTdWl0ZUNvbW1vbkNvbnN0YW50cy5BQ0NPUkRJT05fQk9YX01BUkdJTl9YO1xyXG4gICAgdGVuRnJhbWVBY2NvcmRpb25Cb3gudG9wID0gd29yZEFjY29yZGlvbkJveC50b3A7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0ZW5GcmFtZUFjY29yZGlvbkJveCApO1xyXG5cclxuICAgIC8vIGNyZWF0ZSBhbmQgYWRkIHRoZSBDb3VudGluZ0FjY29yZGlvbkJveCBmb3IgcGFwZXIgb25lc1xyXG4gICAgY29uc3Qgb25lc0FjY29yZGlvbkJveCA9IG5ldyBDb3VudGluZ0FjY29yZGlvbkJveChcclxuICAgICAgbW9kZWwub25lc0NvdW50aW5nQXJlYSxcclxuICAgICAgbmV3IEVudW1lcmF0aW9uUHJvcGVydHkoIENvdW50aW5nT2JqZWN0VHlwZS5QQVBFUl9OVU1CRVIgKSxcclxuICAgICAgTnVtYmVyUGxheUNvbnN0YW50cy5MT1dFUl9BQ0NPUkRJT05fQk9YX0NPTlRFTlRfV0lEVEgsXHJcbiAgICAgIG9wdGlvbnMubG93ZXJBY2NvcmRpb25Cb3hIZWlnaHQsIHtcclxuICAgICAgICB0aXRsZVN0cmluZ1Byb3BlcnR5OiBOdW1iZXJQbGF5U3RyaW5ncy5vbmVzU3RyaW5nUHJvcGVydHksXHJcbiAgICAgICAgZXhwYW5kZWRQcm9wZXJ0eTogdGhpcy5vbmVzQWNjb3JkaW9uQm94RXhwYW5kZWRQcm9wZXJ0eSxcclxuICAgICAgICBmaWxsOiBOdW1iZXJQbGF5Q29sb3JzLnBpbmtCYWNrZ3JvdW5kQ29sb3JQcm9wZXJ0eVxyXG4gICAgICB9ICk7XHJcbiAgICBvbmVzQWNjb3JkaW9uQm94LmxlZnQgPSB0aGlzLmxheW91dEJvdW5kcy5taW5YICsgTnVtYmVyU3VpdGVDb21tb25Db25zdGFudHMuQUNDT1JESU9OX0JPWF9NQVJHSU5fWDtcclxuICAgIG9uZXNBY2NvcmRpb25Cb3guYm90dG9tID0gdGhpcy5sYXlvdXRCb3VuZHMubWF4WSAtIE51bWJlclN1aXRlQ29tbW9uQ29uc3RhbnRzLlNDUkVFTl9WSUVXX1BBRERJTkdfWTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIG9uZXNBY2NvcmRpb25Cb3ggKTtcclxuXHJcbiAgICAvLyBjcmVhdGUgYW5kIGFkZCB0aGUgTG9jYWxlU3dpdGNoXHJcbiAgICBjb25zdCBsb2NhbGVTd2l0Y2ggPSBuZXcgTG9jYWxlU3dpdGNoKCBudW1iZXJQbGF5UHJlZmVyZW5jZXMsIG51bWJlclBsYXlVdHRlcmFuY2VRdWV1ZSwgd29yZEFjY29yZGlvbkJveC53aWR0aCApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbG9jYWxlU3dpdGNoICk7XHJcblxyXG4gICAgLy8gQ2hhbmdlcyBpbiBsb2NhbGUgd2lsbCBjaGFuZ2UgdGhlIHRleHQgaW4gdGhpcyBjb250cm9sLCBzbyByZWFsaWduIGl0XHJcbiAgICBsb2NhbGVTd2l0Y2guYm91bmRzUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICBsb2NhbGVTd2l0Y2gubGVmdCA9IHdvcmRBY2NvcmRpb25Cb3gubGVmdCArIDEwO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSB0aGUgcG9zaXRpb24gb2YgdGhlIGxvY2FsZVN3aXRjaFxyXG4gICAgTXVsdGlsaW5rLm11bHRpbGluayggWyB3b3JkQWNjb3JkaW9uQm94LmV4cGFuZGVkUHJvcGVydHksIG51bWJlclBsYXlQcmVmZXJlbmNlcy5zaG93U2Vjb25kTG9jYWxlUHJvcGVydHkgXSxcclxuICAgICAgKCBpc0V4cGFuZGVkLCBzaG93U2Vjb25kTG9jYWxlICkgPT4ge1xyXG5cclxuICAgICAgICB3b3JkQWNjb3JkaW9uQm94SGVpZ2h0UHJvcGVydHkudmFsdWUgPSBzaG93U2Vjb25kTG9jYWxlID8gb3B0aW9ucy51cHBlckFjY29yZGlvbkJveEhlaWdodCAtIGxvY2FsZVN3aXRjaC5oZWlnaHQgLSAzIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnVwcGVyQWNjb3JkaW9uQm94SGVpZ2h0O1xyXG5cclxuICAgICAgICBjb25zdCBjdXJyZW50V29yZEFjY29yZGlvbkJveEhlaWdodCA9IGlzRXhwYW5kZWQgPyB3b3JkQWNjb3JkaW9uQm94LmdldEV4cGFuZGVkQm94SGVpZ2h0KCkgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZEFjY29yZGlvbkJveC5nZXRDb2xsYXBzZWRCb3hIZWlnaHQoKTtcclxuXHJcbiAgICAgICAgLy8gVXNlIC5ib3R0b20gc28gdGhlIG1hcmdpbiBpcyBpZGVudGljYWwgdG8gd2hhdCB3b3VsZCBjZW50ZXIgdGhlIGxvY2FsZVN3aXRjaCB3aGVuIHRoZSB3b3JkQWNjb3JkaW9uQm94IGlzIGV4cGFuZGVkLlxyXG4gICAgICAgIGNvbnN0IG1hcmdpbiA9ICggb25lc0FjY29yZGlvbkJveC50b3AgLSB3b3JkQWNjb3JkaW9uQm94LmJvdHRvbSApIC8gMjtcclxuXHJcbiAgICAgICAgbG9jYWxlU3dpdGNoLmNlbnRlclkgPSB3b3JkQWNjb3JkaW9uQm94LnRvcCArIGN1cnJlbnRXb3JkQWNjb3JkaW9uQm94SGVpZ2h0ICsgbWFyZ2luO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgLy8gY3JlYXRlIGFuZCBhZGQgdGhlIENvdW50aW5nQWNjb3JkaW9uQm94IGZvciBjb3VudGluZ09iamVjdHNcclxuICAgIHRoaXMub2JqZWN0c0FjY29yZGlvbkJveCA9IG5ldyBDb3VudGluZ0FjY29yZGlvbkJveChcclxuICAgICAgbW9kZWwub2JqZWN0c0NvdW50aW5nQXJlYSxcclxuICAgICAgbW9kZWwuY291bnRpbmdPYmplY3RUeXBlUHJvcGVydHksXHJcbiAgICAgIE51bWJlclBsYXlDb25zdGFudHMuTE9XRVJfQUNDT1JESU9OX0JPWF9DT05URU5UX1dJRFRILFxyXG4gICAgICBvcHRpb25zLmxvd2VyQWNjb3JkaW9uQm94SGVpZ2h0LCB7XHJcbiAgICAgICAgY291bnRpbmdPYmplY3RUeXBlczogWyBDb3VudGluZ09iamVjdFR5cGUuRE9HLCBDb3VudGluZ09iamVjdFR5cGUuQVBQTEUsIENvdW50aW5nT2JqZWN0VHlwZS5CVVRURVJGTFksXHJcbiAgICAgICAgICBDb3VudGluZ09iamVjdFR5cGUuQkFMTCBdLFxyXG4gICAgICAgIGxpbmtTdGF0dXNDaGFuZ2VkRW1pdHRlcjogbW9kZWwubGlua1N0YXR1c0NoYW5nZWRFbWl0dGVyLFxyXG4gICAgICAgIGxpbmtlZENvdW50aW5nQXJlYTogbW9kZWwub25lc0NvdW50aW5nQXJlYSxcclxuICAgICAgICBleHBhbmRlZFByb3BlcnR5OiB0aGlzLm9iamVjdHNBY2NvcmRpb25Cb3hFeHBhbmRlZFByb3BlcnR5LFxyXG4gICAgICAgIGZpbGw6IE51bWJlclBsYXlDb2xvcnMuYmx1ZUJhY2tncm91bmRDb2xvclByb3BlcnR5XHJcbiAgICAgIH0gKTtcclxuICAgIHRoaXMub2JqZWN0c0FjY29yZGlvbkJveC5yaWdodCA9IHRoaXMubGF5b3V0Qm91bmRzLm1heFggLSBOdW1iZXJTdWl0ZUNvbW1vbkNvbnN0YW50cy5BQ0NPUkRJT05fQk9YX01BUkdJTl9YO1xyXG4gICAgdGhpcy5vYmplY3RzQWNjb3JkaW9uQm94LmJvdHRvbSA9IG9uZXNBY2NvcmRpb25Cb3guYm90dG9tO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5vYmplY3RzQWNjb3JkaW9uQm94ICk7XHJcblxyXG4gICAgLy8gY3JlYXRlIGFuZCBhZGQgdGhlIFJlc2V0QWxsQnV0dG9uXHJcbiAgICBjb25zdCByZXNldEFsbEJ1dHRvbiA9IG5ldyBSZXNldEFsbEJ1dHRvbigge1xyXG4gICAgICBsaXN0ZW5lcjogKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuaW50ZXJydXB0U3VidHJlZUlucHV0KCk7IC8vIGNhbmNlbCBpbnRlcmFjdGlvbnMgdGhhdCBtYXkgYmUgaW4gcHJvZ3Jlc3NcclxuICAgICAgICBtb2RlbC5yZXNldCgpO1xyXG4gICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgfSxcclxuICAgICAgcmlnaHQ6IHRoaXMubGF5b3V0Qm91bmRzLm1heFggLSBOdW1iZXJTdWl0ZUNvbW1vbkNvbnN0YW50cy5TQ1JFRU5fVklFV19QQURESU5HX1gsXHJcbiAgICAgIGJvdHRvbTogdGhpcy5sYXlvdXRCb3VuZHMubWF4WSAtIE51bWJlclN1aXRlQ29tbW9uQ29uc3RhbnRzLlNDUkVFTl9WSUVXX1BBRERJTkdfWSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdyZXNldEFsbEJ1dHRvbicgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggcmVzZXRBbGxCdXR0b24gKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIFNwZWVjaFN5bnRoZXNpc0NvbnRyb2wsIGlmIHRoZSBhbm5vdW5jZXIgaXMgaW5pdGlhbGl6ZWQuXHJcbiAgICBpZiAoIG51bWJlclBsYXlTcGVlY2hTeW50aGVzaXNBbm5vdW5jZXIuaW5pdGlhbGl6ZWQgKSB7XHJcbiAgICAgIGNvbnN0IHNwZWVjaFN5bnRoZXNpc0NvbnRyb2wgPSBuZXcgU3BlZWNoU3ludGhlc2lzQ29udHJvbChcclxuICAgICAgICBudW1iZXJQbGF5U3BlZWNoU3ludGhlc2lzQW5ub3VuY2VyLFxyXG4gICAgICAgIG51bWJlclBsYXlVdHRlcmFuY2VRdWV1ZSwge1xyXG4gICAgICAgICAgbGVmdDogdGhpcy5sYXlvdXRCb3VuZHMubWluWCArIE51bWJlclN1aXRlQ29tbW9uQ29uc3RhbnRzLlNDUkVFTl9WSUVXX1BBRERJTkdfWCxcclxuICAgICAgICAgIHRvcDogdGVuRnJhbWVBY2NvcmRpb25Cb3gudG9wXHJcbiAgICAgICAgfSApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCBzcGVlY2hTeW50aGVzaXNDb250cm9sICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gY3JlYXRlIHRoZSBpY29ucyBmb3IgdGhlIFJlY3Rhbmd1bGFyUmFkaW9CdXR0b25Hcm91cFxyXG4gICAgY29uc3QgZ3JvdXBpbmdMaW5raW5nQnV0dG9uczogUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwSXRlbTxHcm91cEFuZExpbmtUeXBlPltdID0gW107XHJcbiAgICBjb25zdCBtYXJnaW4gPSA0LjU7XHJcbiAgICBHcm91cEFuZExpbmtUeXBlLmVudW1lcmF0aW9uLnZhbHVlcy5mb3JFYWNoKCBncm91cEFuZExpbmtUeXBlID0+IHtcclxuXHJcbiAgICAgIGdyb3VwaW5nTGlua2luZ0J1dHRvbnMucHVzaCgge1xyXG4gICAgICAgIHZhbHVlOiBncm91cEFuZExpbmtUeXBlLFxyXG4gICAgICAgIGNyZWF0ZU5vZGU6ICgpID0+IG5ldyBJbWFnZSggR1JPVVBJTkdfTElOS0lOR19UWVBFX1RPX0lNQUdFLmdldCggZ3JvdXBBbmRMaW5rVHlwZSApLCB7XHJcbiAgICAgICAgICBtYXhXaWR0aDogcmVzZXRBbGxCdXR0b24ud2lkdGggLSAyICogbWFyZ2luXHJcbiAgICAgICAgfSApXHJcbiAgICAgIH0gKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYW5kIGFkZCB0aGUgUmVjdGFuZ3VsYXJSYWRpb0J1dHRvbkdyb3VwLCB3aGljaCBpcyBhIGNvbnRyb2wgZm9yIGNoYW5naW5nIHRoZSBDb3VudGluZ09iamVjdFR5cGUgb2YgdGhlIGNvdW50aW5nT2JqZWN0c1xyXG4gICAgY29uc3QgZ3JvdXBpbmdMaW5raW5nUmFkaW9CdXR0b25Hcm91cCA9IG5ldyBSZWN0YW5ndWxhclJhZGlvQnV0dG9uR3JvdXAoIG1vZGVsLm9iamVjdHNHcm91cEFuZExpbmtUeXBlUHJvcGVydHksIGdyb3VwaW5nTGlua2luZ0J1dHRvbnMsIHtcclxuICAgICAgb3JpZW50YXRpb246ICd2ZXJ0aWNhbCcsXHJcbiAgICAgIHNwYWNpbmc6IDEwLFxyXG4gICAgICByYWRpb0J1dHRvbk9wdGlvbnM6IHtcclxuICAgICAgICBiYXNlQ29sb3I6IE51bWJlclBsYXlDb2xvcnMuYmx1ZUJhY2tncm91bmRDb2xvclByb3BlcnR5LFxyXG4gICAgICAgIHhNYXJnaW46IG1hcmdpbixcclxuICAgICAgICB5TWFyZ2luOiBtYXJnaW5cclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gICAgZ3JvdXBpbmdMaW5raW5nUmFkaW9CdXR0b25Hcm91cC5jZW50ZXJYID0gcmVzZXRBbGxCdXR0b24uY2VudGVyWDtcclxuICAgIGdyb3VwaW5nTGlua2luZ1JhZGlvQnV0dG9uR3JvdXAuY2VudGVyWSA9IHRoaXMub2JqZWN0c0FjY29yZGlvbkJveC5jZW50ZXJZO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggZ3JvdXBpbmdMaW5raW5nUmFkaW9CdXR0b25Hcm91cCApO1xyXG5cclxuICAgIC8vIGNyZWF0ZSBhbmQgYWRkIGEgYnV0dG9uIHRvIG9yZ2FuaXplIHRoZSBvbmVzQWNjb3JkaW9uQm94IHBhcGVyIG9uZXMgaW4gYSBncmlkXHJcbiAgICBjb25zdCBvcmdhbml6ZU9uZXNCdXR0b24gPSBuZXcgT3JnYW5pemVCdXR0b24oIE51bWJlclBsYXlDb2xvcnMucGlua0JhY2tncm91bmRDb2xvclByb3BlcnR5LCAoKSA9PiB7XHJcbiAgICAgIG1vZGVsLm9uZXNDb3VudGluZ0FyZWEub3JnYW5pemVPYmplY3RzKCk7XHJcbiAgICB9ICk7XHJcbiAgICBvcmdhbml6ZU9uZXNCdXR0b24ubGVmdCA9IE51bWJlclN1aXRlQ29tbW9uQ29uc3RhbnRzLlNDUkVFTl9WSUVXX1BBRERJTkdfWDtcclxuICAgIG9yZ2FuaXplT25lc0J1dHRvbi50b3AgPSBvbmVzQWNjb3JkaW9uQm94LnRvcDtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIG9yZ2FuaXplT25lc0J1dHRvbiApO1xyXG5cclxuICAgIC8vIGNyZWF0ZSBhbmQgYWRkIGEgYnV0dG9uIHRvIG9yZ2FuaXplIHRoZSBvYmplY3RzQWNjb3JkaW9uQm94IGNvdW50aW5nT2JqZWN0cyBpbiBhIGdyaWRcclxuICAgIGNvbnN0IG9yZ2FuaXplT2JqZWN0c0J1dHRvbiA9IG5ldyBPcmdhbml6ZUJ1dHRvbiggTnVtYmVyUGxheUNvbG9ycy5ibHVlQmFja2dyb3VuZENvbG9yUHJvcGVydHksICgpID0+IHtcclxuICAgICAgaWYgKCBtb2RlbC5vYmplY3RzR3JvdXBBbmRMaW5rVHlwZVByb3BlcnR5LnZhbHVlID09PSBHcm91cEFuZExpbmtUeXBlLkdST1VQRURfQU5EX0xJTktFRCApIHtcclxuICAgICAgICBtb2RlbC5vbmVzQ291bnRpbmdBcmVhLm9yZ2FuaXplT2JqZWN0cygpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIG1vZGVsLm9iamVjdHNDb3VudGluZ0FyZWEub3JnYW5pemVPYmplY3RzKCk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIG9yZ2FuaXplT2JqZWN0c0J1dHRvbi5jZW50ZXJYID0gcmVzZXRBbGxCdXR0b24uY2VudGVyWDtcclxuICAgIG9yZ2FuaXplT2JqZWN0c0J1dHRvbi50b3AgPSB0aGlzLm9iamVjdHNBY2NvcmRpb25Cb3gudG9wO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggb3JnYW5pemVPYmplY3RzQnV0dG9uICk7XHJcblxyXG4gICAgbW9kZWwub2JqZWN0c0dyb3VwQW5kTGlua1R5cGVQcm9wZXJ0eS5sYXp5TGluayggKCBncm91cEFuZExpbmtUeXBlLCBwcmV2aW91c0dyb3VwQW5kTGlua1R5cGUgKSA9PiB7XHJcblxyXG4gICAgICAvLyBJZiB0aGUgR3JvdXBBbmRMaW5rVHlwZSBjaGFuZ2VzLCBpbnRlcnJ1cHQgaW50ZXJhY3Rpb24gd2l0aCBvYmplY3RzIGluIHRoZXNlIGFjY29yZGlvbiBib3hlcy5cclxuICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9udW1iZXItcGxheS9pc3N1ZXMvMTczXHJcbiAgICAgIG9uZXNBY2NvcmRpb25Cb3guaW50ZXJydXB0U3VidHJlZUlucHV0KCk7XHJcbiAgICAgIHRoaXMub2JqZWN0c0FjY29yZGlvbkJveC5pbnRlcnJ1cHRTdWJ0cmVlSW5wdXQoKTtcclxuXHJcbiAgICAgIGNvbnN0IG9iamVjdHNMaW5rZWRUb09uZXMgPSBncm91cEFuZExpbmtUeXBlID09PSBHcm91cEFuZExpbmtUeXBlLkdST1VQRURfQU5EX0xJTktFRDtcclxuICAgICAgY29uc3Qgb2JqZWN0c0xpbmtlZFRvT25lc1ByZXZpb3VzbHkgPSBwcmV2aW91c0dyb3VwQW5kTGlua1R5cGUgPT09IEdyb3VwQW5kTGlua1R5cGUuR1JPVVBFRF9BTkRfTElOS0VEO1xyXG5cclxuICAgICAgLy8gSWYgc3dpdGNoaW5nIGJldHdlZW4gbGlua2VkIGFuZCB1bmxpbmtlZCwgc2V0IHRoZSBvYmplY3RzQ291bnRpbmdBcmVhIHRvIHRoZSBhcHByb3ByaWF0ZSBzdGF0ZS5cclxuICAgICAgaWYgKCBvYmplY3RzTGlua2VkVG9PbmVzICE9PSBvYmplY3RzTGlua2VkVG9PbmVzUHJldmlvdXNseSApIHtcclxuICAgICAgICBtb2RlbC5vYmplY3RzQ291bnRpbmdBcmVhLm1hdGNoQ291bnRpbmdPYmplY3RzVG9MaW5rZWRDb3VudGluZ0FyZWEoXHJcbiAgICAgICAgICBvbmVzQWNjb3JkaW9uQm94LmNvdW50aW5nQXJlYU5vZGUuZ2V0U2VyaWFsaXplZENvdW50aW5nT2JqZWN0c0luY2x1ZGVkSW5TdW0oKSxcclxuICAgICAgICAgIG1vZGVsLmxpbmtTdGF0dXNDaGFuZ2VkRW1pdHRlcixcclxuICAgICAgICAgIG9iamVjdHNMaW5rZWRUb09uZXMsXHJcbiAgICAgICAgICBncm91cEFuZExpbmtUeXBlXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXRzIHRoZSB2aWV3LlxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLndvcmRBY2NvcmRpb25Cb3hFeHBhbmRlZFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLnRvdGFsQWNjb3JkaW9uQm94RXhwYW5kZWRQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy50ZW5GcmFtZUFjY29yZGlvbkJveEV4cGFuZGVkUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMub25lc0FjY29yZGlvbkJveEV4cGFuZGVkUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMub2JqZWN0c0FjY29yZGlvbkJveEV4cGFuZGVkUHJvcGVydHkucmVzZXQoKTtcclxuICAgIG51bWJlclBsYXlQcmVmZXJlbmNlcy5hdXRvSGVhckVuYWJsZWRQcm9wZXJ0eS52YWx1ZSAmJiBudW1iZXJQbGF5VXR0ZXJhbmNlUXVldWUuc3BlYWtTcGVlY2hEYXRhKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxubnVtYmVyUGxheS5yZWdpc3RlciggJ051bWJlclBsYXlTY3JlZW5WaWV3JywgTnVtYmVyUGxheVNjcmVlblZpZXcgKTtcclxuZXhwb3J0IGRlZmF1bHQgTnVtYmVyUGxheVNjcmVlblZpZXc7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsVUFBVSxNQUFNLG9DQUFvQztBQUMzRCxPQUFPQyxjQUFjLE1BQU0sdURBQXVEO0FBQ2xGLFNBQVNDLEtBQUssUUFBUSxtQ0FBbUM7QUFDekQsT0FBT0MsMkJBQTJCLE1BQTJDLDJEQUEyRDtBQUN4SSxPQUFPQyxrQkFBa0IsTUFBTSx1Q0FBdUM7QUFDdEUsT0FBT0Msa0JBQWtCLE1BQU0sdUNBQXVDO0FBQ3RFLE9BQU9DLGtCQUFrQixNQUFNLHVDQUF1QztBQUN0RSxPQUFPQyxVQUFVLE1BQU0scUJBQXFCO0FBQzVDLE9BQU9DLGdCQUFnQixNQUFNLHdCQUF3QjtBQUNyRCxPQUFPQyxtQkFBbUIsTUFBTSwyQkFBMkI7QUFDM0QsT0FBT0Msb0JBQW9CLE1BQU0sd0VBQXdFO0FBQ3pHLE9BQU9DLHNCQUFzQixNQUFNLDBFQUEwRTtBQUM3RyxPQUFP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