// Copyright 2021-2023, University of Colorado Boulder

/**
 * NumberPlayGameAnswerButtons are buttons that can be selected to input an answer to a game.
 *
 * @author Luisa Vargas
 * @author Chris Klusendorf (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Color, HBox, Node, Rectangle, Text } from '../../../../scenery/js/imports.js';
import RectangularPushButton from '../../../../sun/js/buttons/RectangularPushButton.js';
import numberPlay from '../../numberPlay.js';
import NumberPlayConstants from '../../common/NumberPlayConstants.js';
import NumberPlayGameLevel from '../model/NumberPlayGameLevel.js';
import GameAudioPlayer from '../../../../vegas/js/GameAudioPlayer.js';
import optionize from '../../../../phet-core/js/optionize.js';

// types

// constants
const BUTTON_TEXT_OPTIONS = {
  font: new PhetFont(45)
};
const BUTTON_DIMENSION = new Dimension2(80, 100);
const BUTTON_OBJECT_CORNER_RADIUS = 10;
class NumberPlayGameAnswerButtons extends Node {
  /**
   * Listener that is added to every answer button. It disabled selected buttons that are wrong, and turns correct
   * answer buttons green.
   */

  static BUTTON_DIMENSION = BUTTON_DIMENSION;
  constructor(level, pointAwardedNodeVisibleProperty, rewardDialog, rightAnswerCallback, wrongAnswerCallback, providedOptions) {
    super();
    const options = optionize()({
      buttonColor: Color.WHITE,
      buttonSpacing: 18,
      dependencyEnabledProperty: new BooleanProperty(true)
    }, providedOptions);
    this.buttonObjects = [];
    const gameAudioPlayer = new GameAudioPlayer();
    const buttonListener = index => {
      level.numberOfAnswerButtonPressesProperty.value++;
      const buttonObject = this.buttonObjects[index];

      // this button is the correct answer button
      if (level.challengeNumberProperty.value === buttonObject.value) {
        // audio feedback
        gameAudioPlayer.correctAnswer();
        level.isChallengeSolvedProperty.value = true;
        rightAnswerCallback();
        this.hBox.replaceChild(buttonObject.button, buttonObject.rectangle);

        // if this is the first guess, increase the score
        if (level.numberOfAnswerButtonPressesProperty.value === 1) {
          level.scoreProperty.value++;

          // If we've reached the reward score, show the reward dialog.
          if (level.scoreProperty.value === NumberPlayGameLevel.REWARD_SCORE) {
            gameAudioPlayer.gameOverPerfectScore();
            rewardDialog.show();
          } else {
            pointAwardedNodeVisibleProperty.value = true;
          }
        }
      } else {
        // audio feedback
        gameAudioPlayer.wrongAnswer();
        pointAwardedNodeVisibleProperty.value = false;
        wrongAnswerCallback();

        // disable incorrect answer button
        buttonObject.enabledProperty.value = false;
      }
    };

    // create the buttons and green rectangles together
    for (let i = 0; i < level.challengeRange.getLength() + 1; i++) {
      const value = i + level.challengeRange.min;

      // used to disable individual buttons but the true 'enabledProperty' for this button relies on other Properties
      // too, see the DerivedProperty usage below
      const enabledProperty = new BooleanProperty(true);
      const button = new RectangularPushButton({
        content: new Text(value, BUTTON_TEXT_OPTIONS),
        baseColor: options.buttonColor,
        size: BUTTON_DIMENSION,
        cornerRadius: BUTTON_OBJECT_CORNER_RADIUS,
        yMargin: 24,
        touchAreaXDilation: NumberPlayConstants.TOUCH_AREA_DILATION,
        touchAreaYDilation: NumberPlayConstants.TOUCH_AREA_DILATION,
        enabledProperty: new DerivedProperty([level.isChallengeSolvedProperty, enabledProperty, options.dependencyEnabledProperty], (isChallengeSolved, enabled, dependencyEnabled) => !isChallengeSolved && enabled && dependencyEnabled),
        listener: () => buttonListener(i)
      });

      // create and replace the correct answer button with a rectangle and the correct number on top
      const rectangle = new Rectangle(0, 0, BUTTON_DIMENSION.width, BUTTON_DIMENSION.height, {
        fill: Color.GREEN,
        cornerRadius: BUTTON_OBJECT_CORNER_RADIUS,
        lineWidth: 0.5,
        stroke: Color.GRAY
      });
      const correctAnswerText = new Text(value, BUTTON_TEXT_OPTIONS);
      correctAnswerText.center = rectangle.center;
      rectangle.addChild(correctAnswerText);
      this.buttonObjects.push({
        value: value,
        button: button,
        rectangle: rectangle,
        enabledProperty: enabledProperty
      });
    }
    this.hBox = new HBox({
      children: this.buttonObjects.map(buttonObject => buttonObject.button),
      spacing: options.buttonSpacing
    });
    this.addChild(this.hBox);
    this.buttonListener = buttonListener;
  }

  /**
   * Fires the button listener on the correct answer button.
   */
  showAnswer(challengeNumberProperty) {
    const buttonObjectIndex = challengeNumberProperty.value - challengeNumberProperty.range.min;
    this.buttonListener(buttonObjectIndex);
  }

  /**
   * Returns everything in the HBox to its original button state.
   */
  reset() {
    this.buttonObjects.forEach(buttonObject => buttonObject.enabledProperty.reset());
    this.hBox.children = this.buttonObjects.map(buttonObject => buttonObject.button);
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
}
numberPlay.register('NumberPlayGameAnswerButtons', NumberPlayGameAnswerButtons);
export default NumberPlayGameAnswerButtons;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJEaW1lbnNpb24yIiwiUGhldEZvbnQiLCJDb2xvciIsIkhCb3giLCJOb2RlIiwiUmVjdGFuZ2xlIiwiVGV4dCIsIlJlY3Rhbmd1bGFyUHVzaEJ1dHRvbiIsIm51bWJlclBsYXkiLCJOdW1iZXJQbGF5Q29uc3RhbnRzIiwiTnVtYmVyUGxheUdhbWVMZXZlbCIsIkdhbWVBdWRpb1BsYXllciIsIm9wdGlvbml6ZSIsIkJVVFRPTl9URVhUX09QVElPTlMiLCJmb250IiwiQlVUVE9OX0RJTUVOU0lPTiIsIkJVVFRPTl9PQkpFQ1RfQ09STkVSX1JBRElVUyIsIk51bWJlclBsYXlHYW1lQW5zd2VyQnV0dG9ucyIsImNvbnN0cnVjdG9yIiwibGV2ZWwiLCJwb2ludEF3YXJkZWROb2RlVmlzaWJsZVByb3BlcnR5IiwicmV3YXJkRGlhbG9nIiwicmlnaHRBbnN3ZXJDYWxsYmFjayIsIndyb25nQW5zd2VyQ2FsbGJhY2siLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiYnV0dG9uQ29sb3IiLCJXSElURSIsImJ1dHRvblNwYWNpbmciLCJkZXBlbmRlbmN5RW5hYmxlZFByb3BlcnR5IiwiYnV0dG9uT2JqZWN0cyIsImdhbWVBdWRpb1BsYXllciIsImJ1dHRvbkxpc3RlbmVyIiwiaW5kZXgiLCJudW1iZXJPZkFuc3dlckJ1dHRvblByZXNzZXNQcm9wZXJ0eSIsInZhbHVlIiwiYnV0dG9uT2JqZWN0IiwiY2hhbGxlbmdlTnVtYmVyUHJvcGVydHkiLCJjb3JyZWN0QW5zd2VyIiwiaXNDaGFsbGVuZ2VTb2x2ZWRQcm9wZXJ0eSIsImhCb3giLCJyZXBsYWNlQ2hpbGQiLCJidXR0b24iLCJyZWN0YW5nbGUiLCJzY29yZVByb3BlcnR5IiwiUkVXQVJEX1NDT1JFIiwiZ2FtZU92ZXJQZXJmZWN0U2NvcmUiLCJzaG93Iiwid3JvbmdBbnN3ZXIiLCJlbmFibGVkUHJvcGVydHkiLCJpIiwiY2hhbGxlbmdlUmFuZ2UiLCJnZXRMZW5ndGgiLCJtaW4iLCJjb250ZW50IiwiYmFzZUNvbG9yIiwic2l6ZSIsImNvcm5lclJhZGl1cyIsInlNYXJnaW4iLCJ0b3VjaEFyZWFYRGlsYXRpb24iLCJUT1VDSF9BUkVBX0RJTEFUSU9OIiwidG91Y2hBcmVhWURpbGF0aW9uIiwiaXNDaGFsbGVuZ2VTb2x2ZWQiLCJlbmFibGVkIiwiZGVwZW5kZW5jeUVuYWJsZWQiLCJsaXN0ZW5lciIsIndpZHRoIiwiaGVpZ2h0IiwiZmlsbCIsIkdSRUVOIiwibGluZVdpZHRoIiwic3Ryb2tlIiwiR1JBWSIsImNvcnJlY3RBbnN3ZXJUZXh0IiwiY2VudGVyIiwiYWRkQ2hpbGQiLCJwdXNoIiwiY2hpbGRyZW4iLCJtYXAiLCJzcGFjaW5nIiwic2hvd0Fuc3dlciIsImJ1dHRvbk9iamVjdEluZGV4IiwicmFuZ2UiLCJyZXNldCIsImZvckVhY2giLCJkaXNwb3NlIiwiYXNzZXJ0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJOdW1iZXJQbGF5R2FtZUFuc3dlckJ1dHRvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjEtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogTnVtYmVyUGxheUdhbWVBbnN3ZXJCdXR0b25zIGFyZSBidXR0b25zIHRoYXQgY2FuIGJlIHNlbGVjdGVkIHRvIGlucHV0IGFuIGFuc3dlciB0byBhIGdhbWUuXHJcbiAqXHJcbiAqIEBhdXRob3IgTHVpc2EgVmFyZ2FzXHJcbiAqIEBhdXRob3IgQ2hyaXMgS2x1c2VuZG9yZiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBEaW1lbnNpb24yIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9EaW1lbnNpb24yLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBIQm94LCBOb2RlLCBSZWN0YW5nbGUsIFRDb2xvciwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBSZWN0YW5ndWxhclB1c2hCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL2J1dHRvbnMvUmVjdGFuZ3VsYXJQdXNoQnV0dG9uLmpzJztcclxuaW1wb3J0IG51bWJlclBsYXkgZnJvbSAnLi4vLi4vbnVtYmVyUGxheS5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IE51bWJlclBsYXlDb25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL051bWJlclBsYXlDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgTnVtYmVyUGxheUdhbWVMZXZlbCBmcm9tICcuLi9tb2RlbC9OdW1iZXJQbGF5R2FtZUxldmVsLmpzJztcclxuaW1wb3J0IEdhbWVBdWRpb1BsYXllciBmcm9tICcuLi8uLi8uLi8uLi92ZWdhcy9qcy9HYW1lQXVkaW9QbGF5ZXIuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBUUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgTnVtYmVyUGxheUdhbWVSZXdhcmREaWFsb2cgZnJvbSAnLi9OdW1iZXJQbGF5R2FtZVJld2FyZERpYWxvZy5qcyc7XHJcblxyXG4vLyB0eXBlc1xyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG4gIGJ1dHRvbkNvbG9yPzogVENvbG9yO1xyXG4gIGJ1dHRvblNwYWNpbmc/OiBudW1iZXI7XHJcbiAgZGVwZW5kZW5jeUVuYWJsZWRQcm9wZXJ0eT86IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+O1xyXG59O1xyXG50eXBlIE51bWJlclBsYXlHYW1lQW5zd2VyQnV0dG9uc09wdGlvbnMgPSBTZWxmT3B0aW9ucztcclxudHlwZSBCdXR0b25PYmplY3QgPSB7XHJcbiAgdmFsdWU6IG51bWJlcjtcclxuICBidXR0b246IFJlY3Rhbmd1bGFyUHVzaEJ1dHRvbjtcclxuICByZWN0YW5nbGU6IFJlY3RhbmdsZTtcclxuICBlbmFibGVkUHJvcGVydHk6IEJvb2xlYW5Qcm9wZXJ0eTtcclxufTtcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBCVVRUT05fVEVYVF9PUFRJT05TID0geyBmb250OiBuZXcgUGhldEZvbnQoIDQ1ICkgfTtcclxuY29uc3QgQlVUVE9OX0RJTUVOU0lPTiA9IG5ldyBEaW1lbnNpb24yKCA4MCwgMTAwICk7XHJcbmNvbnN0IEJVVFRPTl9PQkpFQ1RfQ09STkVSX1JBRElVUyA9IDEwO1xyXG5cclxuY2xhc3MgTnVtYmVyUGxheUdhbWVBbnN3ZXJCdXR0b25zIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgYnV0dG9uT2JqZWN0czogQnV0dG9uT2JqZWN0W107XHJcbiAgcHJpdmF0ZSByZWFkb25seSBoQm94OiBIQm94O1xyXG5cclxuICAvKipcclxuICAgKiBMaXN0ZW5lciB0aGF0IGlzIGFkZGVkIHRvIGV2ZXJ5IGFuc3dlciBidXR0b24uIEl0IGRpc2FibGVkIHNlbGVjdGVkIGJ1dHRvbnMgdGhhdCBhcmUgd3JvbmcsIGFuZCB0dXJucyBjb3JyZWN0XHJcbiAgICogYW5zd2VyIGJ1dHRvbnMgZ3JlZW4uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZWFkb25seSBidXR0b25MaXN0ZW5lcjogKCBpbmRleDogbnVtYmVyICkgPT4gdm9pZDtcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IEJVVFRPTl9ESU1FTlNJT04gPSBCVVRUT05fRElNRU5TSU9OO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGxldmVsOiBOdW1iZXJQbGF5R2FtZUxldmVsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgcG9pbnRBd2FyZGVkTm9kZVZpc2libGVQcm9wZXJ0eTogVFByb3BlcnR5PGJvb2xlYW4+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgcmV3YXJkRGlhbG9nOiBOdW1iZXJQbGF5R2FtZVJld2FyZERpYWxvZyxcclxuICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0QW5zd2VyQ2FsbGJhY2s6ICgpID0+IHZvaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICB3cm9uZ0Fuc3dlckNhbGxiYWNrOiAoKSA9PiB2b2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWRPcHRpb25zPzogTnVtYmVyUGxheUdhbWVBbnN3ZXJCdXR0b25zT3B0aW9ucyApIHtcclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxOdW1iZXJQbGF5R2FtZUFuc3dlckJ1dHRvbnNPcHRpb25zPigpKCB7XHJcbiAgICAgIGJ1dHRvbkNvbG9yOiBDb2xvci5XSElURSxcclxuICAgICAgYnV0dG9uU3BhY2luZzogMTgsXHJcbiAgICAgIGRlcGVuZGVuY3lFbmFibGVkUHJvcGVydHk6IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUgKVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5idXR0b25PYmplY3RzID0gW107XHJcblxyXG4gICAgY29uc3QgZ2FtZUF1ZGlvUGxheWVyID0gbmV3IEdhbWVBdWRpb1BsYXllcigpO1xyXG5cclxuICAgIGNvbnN0IGJ1dHRvbkxpc3RlbmVyID0gKCBpbmRleDogbnVtYmVyICkgPT4ge1xyXG4gICAgICBsZXZlbC5udW1iZXJPZkFuc3dlckJ1dHRvblByZXNzZXNQcm9wZXJ0eS52YWx1ZSsrO1xyXG4gICAgICBjb25zdCBidXR0b25PYmplY3QgPSB0aGlzLmJ1dHRvbk9iamVjdHNbIGluZGV4IF07XHJcblxyXG4gICAgICAvLyB0aGlzIGJ1dHRvbiBpcyB0aGUgY29ycmVjdCBhbnN3ZXIgYnV0dG9uXHJcbiAgICAgIGlmICggbGV2ZWwuY2hhbGxlbmdlTnVtYmVyUHJvcGVydHkudmFsdWUgPT09IGJ1dHRvbk9iamVjdC52YWx1ZSApIHtcclxuXHJcbiAgICAgICAgLy8gYXVkaW8gZmVlZGJhY2tcclxuICAgICAgICBnYW1lQXVkaW9QbGF5ZXIuY29ycmVjdEFuc3dlcigpO1xyXG5cclxuICAgICAgICBsZXZlbC5pc0NoYWxsZW5nZVNvbHZlZFByb3BlcnR5LnZhbHVlID0gdHJ1ZTtcclxuICAgICAgICByaWdodEFuc3dlckNhbGxiYWNrKCk7XHJcblxyXG4gICAgICAgIHRoaXMuaEJveC5yZXBsYWNlQ2hpbGQoIGJ1dHRvbk9iamVjdC5idXR0b24sIGJ1dHRvbk9iamVjdC5yZWN0YW5nbGUgKTtcclxuXHJcbiAgICAgICAgLy8gaWYgdGhpcyBpcyB0aGUgZmlyc3QgZ3Vlc3MsIGluY3JlYXNlIHRoZSBzY29yZVxyXG4gICAgICAgIGlmICggbGV2ZWwubnVtYmVyT2ZBbnN3ZXJCdXR0b25QcmVzc2VzUHJvcGVydHkudmFsdWUgPT09IDEgKSB7XHJcbiAgICAgICAgICBsZXZlbC5zY29yZVByb3BlcnR5LnZhbHVlKys7XHJcblxyXG4gICAgICAgICAgLy8gSWYgd2UndmUgcmVhY2hlZCB0aGUgcmV3YXJkIHNjb3JlLCBzaG93IHRoZSByZXdhcmQgZGlhbG9nLlxyXG4gICAgICAgICAgaWYgKCBsZXZlbC5zY29yZVByb3BlcnR5LnZhbHVlID09PSBOdW1iZXJQbGF5R2FtZUxldmVsLlJFV0FSRF9TQ09SRSApIHtcclxuICAgICAgICAgICAgZ2FtZUF1ZGlvUGxheWVyLmdhbWVPdmVyUGVyZmVjdFNjb3JlKCk7XHJcbiAgICAgICAgICAgIHJld2FyZERpYWxvZy5zaG93KCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcG9pbnRBd2FyZGVkTm9kZVZpc2libGVQcm9wZXJ0eS52YWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAvLyBhdWRpbyBmZWVkYmFja1xyXG4gICAgICAgIGdhbWVBdWRpb1BsYXllci53cm9uZ0Fuc3dlcigpO1xyXG5cclxuICAgICAgICBwb2ludEF3YXJkZWROb2RlVmlzaWJsZVByb3BlcnR5LnZhbHVlID0gZmFsc2U7XHJcbiAgICAgICAgd3JvbmdBbnN3ZXJDYWxsYmFjaygpO1xyXG5cclxuICAgICAgICAvLyBkaXNhYmxlIGluY29ycmVjdCBhbnN3ZXIgYnV0dG9uXHJcbiAgICAgICAgYnV0dG9uT2JqZWN0LmVuYWJsZWRQcm9wZXJ0eS52YWx1ZSA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIGNyZWF0ZSB0aGUgYnV0dG9ucyBhbmQgZ3JlZW4gcmVjdGFuZ2xlcyB0b2dldGhlclxyXG4gICAgZm9yICggbGV0IGkgPSAwOyBpIDwgbGV2ZWwuY2hhbGxlbmdlUmFuZ2UuZ2V0TGVuZ3RoKCkgKyAxOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IHZhbHVlID0gaSArIGxldmVsLmNoYWxsZW5nZVJhbmdlLm1pbjtcclxuXHJcbiAgICAgIC8vIHVzZWQgdG8gZGlzYWJsZSBpbmRpdmlkdWFsIGJ1dHRvbnMgYnV0IHRoZSB0cnVlICdlbmFibGVkUHJvcGVydHknIGZvciB0aGlzIGJ1dHRvbiByZWxpZXMgb24gb3RoZXIgUHJvcGVydGllc1xyXG4gICAgICAvLyB0b28sIHNlZSB0aGUgRGVyaXZlZFByb3BlcnR5IHVzYWdlIGJlbG93XHJcbiAgICAgIGNvbnN0IGVuYWJsZWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUgKTtcclxuICAgICAgY29uc3QgYnV0dG9uID0gbmV3IFJlY3Rhbmd1bGFyUHVzaEJ1dHRvbigge1xyXG4gICAgICAgIGNvbnRlbnQ6IG5ldyBUZXh0KCB2YWx1ZSwgQlVUVE9OX1RFWFRfT1BUSU9OUyApLFxyXG4gICAgICAgIGJhc2VDb2xvcjogb3B0aW9ucy5idXR0b25Db2xvcixcclxuICAgICAgICBzaXplOiBCVVRUT05fRElNRU5TSU9OLFxyXG4gICAgICAgIGNvcm5lclJhZGl1czogQlVUVE9OX09CSkVDVF9DT1JORVJfUkFESVVTLFxyXG4gICAgICAgIHlNYXJnaW46IDI0LFxyXG4gICAgICAgIHRvdWNoQXJlYVhEaWxhdGlvbjogTnVtYmVyUGxheUNvbnN0YW50cy5UT1VDSF9BUkVBX0RJTEFUSU9OLFxyXG4gICAgICAgIHRvdWNoQXJlYVlEaWxhdGlvbjogTnVtYmVyUGxheUNvbnN0YW50cy5UT1VDSF9BUkVBX0RJTEFUSU9OLFxyXG4gICAgICAgIGVuYWJsZWRQcm9wZXJ0eTogbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBsZXZlbC5pc0NoYWxsZW5nZVNvbHZlZFByb3BlcnR5LCBlbmFibGVkUHJvcGVydHksIG9wdGlvbnMuZGVwZW5kZW5jeUVuYWJsZWRQcm9wZXJ0eSBdLFxyXG4gICAgICAgICAgKCBpc0NoYWxsZW5nZVNvbHZlZCwgZW5hYmxlZCwgZGVwZW5kZW5jeUVuYWJsZWQgKSA9PiAhaXNDaGFsbGVuZ2VTb2x2ZWQgJiYgZW5hYmxlZCAmJiBkZXBlbmRlbmN5RW5hYmxlZCApLFxyXG4gICAgICAgIGxpc3RlbmVyOiAoKSA9PiBidXR0b25MaXN0ZW5lciggaSApXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIC8vIGNyZWF0ZSBhbmQgcmVwbGFjZSB0aGUgY29ycmVjdCBhbnN3ZXIgYnV0dG9uIHdpdGggYSByZWN0YW5nbGUgYW5kIHRoZSBjb3JyZWN0IG51bWJlciBvbiB0b3BcclxuICAgICAgY29uc3QgcmVjdGFuZ2xlID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgQlVUVE9OX0RJTUVOU0lPTi53aWR0aCwgQlVUVE9OX0RJTUVOU0lPTi5oZWlnaHQsIHtcclxuICAgICAgICBmaWxsOiBDb2xvci5HUkVFTixcclxuICAgICAgICBjb3JuZXJSYWRpdXM6IEJVVFRPTl9PQkpFQ1RfQ09STkVSX1JBRElVUyxcclxuICAgICAgICBsaW5lV2lkdGg6IDAuNSxcclxuICAgICAgICBzdHJva2U6IENvbG9yLkdSQVlcclxuICAgICAgfSApO1xyXG4gICAgICBjb25zdCBjb3JyZWN0QW5zd2VyVGV4dCA9IG5ldyBUZXh0KCB2YWx1ZSwgQlVUVE9OX1RFWFRfT1BUSU9OUyApO1xyXG4gICAgICBjb3JyZWN0QW5zd2VyVGV4dC5jZW50ZXIgPSByZWN0YW5nbGUuY2VudGVyO1xyXG4gICAgICByZWN0YW5nbGUuYWRkQ2hpbGQoIGNvcnJlY3RBbnN3ZXJUZXh0ICk7XHJcblxyXG4gICAgICB0aGlzLmJ1dHRvbk9iamVjdHMucHVzaCgge1xyXG4gICAgICAgIHZhbHVlOiB2YWx1ZSxcclxuICAgICAgICBidXR0b246IGJ1dHRvbixcclxuICAgICAgICByZWN0YW5nbGU6IHJlY3RhbmdsZSxcclxuICAgICAgICBlbmFibGVkUHJvcGVydHk6IGVuYWJsZWRQcm9wZXJ0eVxyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5oQm94ID0gbmV3IEhCb3goIHtcclxuICAgICAgY2hpbGRyZW46IHRoaXMuYnV0dG9uT2JqZWN0cy5tYXAoIGJ1dHRvbk9iamVjdCA9PiBidXR0b25PYmplY3QuYnV0dG9uICksXHJcbiAgICAgIHNwYWNpbmc6IG9wdGlvbnMuYnV0dG9uU3BhY2luZ1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5oQm94ICk7XHJcblxyXG4gICAgdGhpcy5idXR0b25MaXN0ZW5lciA9IGJ1dHRvbkxpc3RlbmVyO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmlyZXMgdGhlIGJ1dHRvbiBsaXN0ZW5lciBvbiB0aGUgY29ycmVjdCBhbnN3ZXIgYnV0dG9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzaG93QW5zd2VyKCBjaGFsbGVuZ2VOdW1iZXJQcm9wZXJ0eTogTnVtYmVyUHJvcGVydHkgKTogdm9pZCB7XHJcbiAgICBjb25zdCBidXR0b25PYmplY3RJbmRleCA9IGNoYWxsZW5nZU51bWJlclByb3BlcnR5LnZhbHVlIC0gY2hhbGxlbmdlTnVtYmVyUHJvcGVydHkucmFuZ2UubWluO1xyXG4gICAgdGhpcy5idXR0b25MaXN0ZW5lciggYnV0dG9uT2JqZWN0SW5kZXggKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgZXZlcnl0aGluZyBpbiB0aGUgSEJveCB0byBpdHMgb3JpZ2luYWwgYnV0dG9uIHN0YXRlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMuYnV0dG9uT2JqZWN0cy5mb3JFYWNoKCBidXR0b25PYmplY3QgPT4gYnV0dG9uT2JqZWN0LmVuYWJsZWRQcm9wZXJ0eS5yZXNldCgpICk7XHJcbiAgICB0aGlzLmhCb3guY2hpbGRyZW4gPSB0aGlzLmJ1dHRvbk9iamVjdHMubWFwKCBidXR0b25PYmplY3QgPT4gYnV0dG9uT2JqZWN0LmJ1dHRvbiApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmYWxzZSwgJ2Rpc3Bvc2UgaXMgbm90IHN1cHBvcnRlZCwgZXhpc3RzIGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIHNpbScgKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbm51bWJlclBsYXkucmVnaXN0ZXIoICdOdW1iZXJQbGF5R2FtZUFuc3dlckJ1dHRvbnMnLCBOdW1iZXJQbGF5R2FtZUFuc3dlckJ1dHRvbnMgKTtcclxuZXhwb3J0IGRlZmF1bHQgTnVt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