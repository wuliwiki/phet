// Copyright 2022-2023, University of Colorado Boulder

/**
 * OriginalGraphNode is the view representation of an Original Graph, which includes two curves
 *  that can be user-manipulated as well as cueing arrows.
 * Labeled Points (only visible/accessible through PhET-IO) are also added to this graph
 * OriginalGraphNode extends GraphNode.
 * However, the zoom Button of GraphNode is set to be invisible in the OriginalGraphNode
 *
 * The public methods of OriginalGraphNode allow a client to add
 * - a ScrubberNode
 * - a TangentArrowNode
 * - an AreaUnderCurvePlot
 *
 * The decision to use the names 'original curve' and 'original graph' is documented in
 * https://github.com/phetsims/calculus-grapher/issues/119
 *
 * @author Martin Veillette
 * @author Brandon Li
 * @author Chris Malley (PixelZoom, Inc.)
 */

import calculusGrapher from '../../calculusGrapher.js';
import TransformedCurveNode from './TransformedCurveNode.js';
import optionize from '../../../../phet-core/js/optionize.js';
import CalculusGrapherColors from '../CalculusGrapherColors.js';
import GraphNode from './GraphNode.js';
import { DragListener, HBox, Rectangle, Text } from '../../../../scenery/js/imports.js';
import CalculusGrapherConstants from '../CalculusGrapherConstants.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import CalculusGrapherStrings from '../../CalculusGrapherStrings.js';
import GraphTypeLabelNode from './GraphTypeLabelNode.js';
import TangentArrowNode from './TangentArrowNode.js';
import AreaUnderCurvePlot from './AreaUnderCurvePlot.js';
import GraphType from '../model/GraphType.js';
import ShowOriginalCurveCheckbox from './ShowOriginalCurveCheckbox.js';
import LabeledPointsNode from './LabeledPointsNode.js';
import Property from '../../../../axon/js/Property.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import BooleanIO from '../../../../tandem/js/types/BooleanIO.js';
import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import CurveManipulationMode from '../model/CurveManipulationMode.js';

// Minimum x distance between drag points when drawing in FREEFORM mode.
// See https://github.com/phetsims/calculus-grapher/issues/297
const FREEFORM_MIN_DX = 0.1;
export default class OriginalGraphNode extends GraphNode {
  // Node for the original curve f(x), which is interactive

  // Node for the predict curve, which is interactive

  // Indicates if the original curve is visible while in 'Predict' mode.
  // This Property is controlled by the 'Show f(x)' checkbox that is visible when the 'Predict' radio button is selected.
  constructor(model, providedOptions) {
    // Destructuring fields from the model into local constants, to improve readability.
    const {
      originalCurve,
      predictCurve,
      curveManipulationProperties,
      predictEnabledProperty
    } = model;
    const graphType = GraphType.ORIGINAL;

    // Label that toggles between 'Predict f(x)' and 'f(x)'
    const labelNodeTandem = providedOptions.tandem.createTandem('labelNode');
    const labelNode = new HBox({
      children: [new Text(CalculusGrapherStrings.predictStringProperty, {
        font: CalculusGrapherConstants.CONTROL_FONT,
        maxWidth: 100,
        visibleProperty: model.predictEnabledProperty,
        // show/hide 'Predict'
        tandem: labelNodeTandem.createTandem('predictText')
      }), new GraphTypeLabelNode(graphType)],
      spacing: 5,
      tandem: labelNodeTandem
    });
    const options = optionize()({
      // GraphNodeOptions
      labelNode: labelNode,
      createCurveNode: false,
      // We'll be creating our own Node for model.originalCurve.
      chartRectangleOptions: {
        fill: CalculusGrapherColors.originalChartBackgroundFillProperty,
        stroke: CalculusGrapherColors.originalChartBackgroundStrokeProperty
      }
    }, providedOptions);
    super(graphType, originalCurve, model.gridVisibleProperty, options);
    this.showOriginalCurveProperty = new BooleanProperty(false, {
      tandem: providedOptions.tandem.createTandem('showOriginalCurveProperty'),
      phetioDocumentation: 'Controls whether the original curve is visible while the Predict radio button is selected.' + 'The value of this Property can be changed by toggling showOriginalCurveCheckbox.'
    });

    // Interactive f(x) 'original' curve
    const originalCurveNodeTandem = providedOptions.tandem.createTandem('originalCurveNode');
    this.originalCurveNode = new TransformedCurveNode(originalCurve, curveManipulationProperties, this.chartTransform, {
      stroke: graphType.strokeProperty,
      discontinuousPointsFill: options.chartRectangleOptions.fill,
      continuousLinePlotOptions: {
        lineWidth: 3 // see https://github.com/phetsims/calculus-grapher/issues/205
      },

      plotBoundsMethod: CalculusGrapherConstants.PLOT_BOUNDS_METHOD,
      // see https://github.com/phetsims/calculus-grapher/issues/210
      plotBounds: this.getChartRectangleBounds(),
      // see https://github.com/phetsims/calculus-grapher/issues/259
      isInteractiveProperty: DerivedProperty.not(predictEnabledProperty),
      visibleProperty: new DerivedProperty([predictEnabledProperty, this.showOriginalCurveProperty], (predictEnabled, showOriginalCurve) => !predictEnabled || showOriginalCurve, {
        tandem: originalCurveNodeTandem.createTandem('visibleProperty'),
        phetioValueType: BooleanIO
      }),
      tandem: originalCurveNodeTandem,
      // originalCurveNode does not have an input listener, but we want to allow PhET-iO clients to use
      // originalCurveNode.inputEnabledProperty to control chartRectangle.inputEnabledProperty (see derivation below).
      // See https://github.com/phetsims/calculus-grapher/issues/240
      phetioInputEnabledPropertyInstrumented: true
    });
    this.curveLayer.addChild(this.originalCurveNode);

    // Interactive 'Predict' curve
    this.predictCurveNode = new TransformedCurveNode(predictCurve, curveManipulationProperties, this.chartTransform, {
      stroke: CalculusGrapherColors.predictCurveStrokeProperty,
      discontinuousPointsFill: options.chartRectangleOptions.fill,
      plotBoundsMethod: CalculusGrapherConstants.PLOT_BOUNDS_METHOD,
      // see https://github.com/phetsims/calculus-grapher/issues/210
      plotBounds: this.getChartRectangleBounds(),
      // see https://github.com/phetsims/calculus-grapher/issues/259
      isInteractiveProperty: predictEnabledProperty,
      visibleProperty: predictEnabledProperty,
      tandem: options.tandem.createTandem('predictCurveNode')
    });
    this.curveLayer.addChild(this.predictCurveNode);

    // Add a highlight around the chartRectangle, color coded to the curve that is interactive.
    // See https://github.com/phetsims/calculus-grapher/issues/204
    const highlightRectangle = new Rectangle(0, 0, this.chartRectangle.width + 6, this.chartRectangle.height + 6, {
      center: this.chartRectangle.center,
      opacity: 0.25,
      visibleProperty: this.curveLayerVisibleProperty,
      fill: new DerivedProperty([model.predictEnabledProperty, CalculusGrapherColors.predictCurveStrokeProperty, CalculusGrapherColors.originalCurveStrokeProperty], (predictEnabled, predictCurveStroke, originalCurveStroke) => predictEnabled ? predictCurveStroke : originalCurveStroke)
    });
    this.addChild(highlightRectangle);
    highlightRectangle.moveToBack();

    // 'Show f(x)' checkbox, in upper-right corner of the chartRectangle
    const showOriginalCurveCheckbox = new ShowOriginalCurveCheckbox(this.showOriginalCurveProperty, model.predictEnabledProperty, options.tandem.createTandem('showOriginalCurveCheckbox'));
    this.addChild(showOriginalCurveCheckbox);
    showOriginalCurveCheckbox.boundsProperty.link(() => {
      showOriginalCurveCheckbox.right = this.chartTransform.modelToViewX(CalculusGrapherConstants.CURVE_X_RANGE.getMax()) - CalculusGrapherConstants.GRAPH_X_MARGIN;
      showOriginalCurveCheckbox.top = CalculusGrapherConstants.GRAPH_Y_MARGIN;
    });

    // Labeled points
    const labeledPointsNode = new LabeledPointsNode(model.labeledPoints, model.labeledPointsLinkableElement, this.chartTransform, model.predictEnabledProperty, this.curveLayerVisibleProperty, options.tandem.createTandem('labeledPointsNode'));
    this.addChild(labeledPointsNode);

    // Which of the CurveNode instances is currently interactive
    const interactiveCurveNodeProperty = new DerivedProperty([model.predictEnabledProperty], predictEnabled => predictEnabled ? this.predictCurveNode : this.originalCurveNode);

    // Variables to keep track of old model positions associated with the dragListener.
    // Set them to null as no drag event has occurred yet.
    // These are relevant only for CurveManipulationMode.FREEFORM.
    let penultimatePosition = null;
    let antepenultimatePosition = null;

    // Update whichever curve is currently interactive.
    const updateCurve = listener => {
      // This listener 'field' is actually an ES5 getter that allocates a Vector2, so call it only once.
      const modelPoint = listener.modelPoint;

      // Current modelPosition
      const modelPosition = this.chartTransform.viewToModelPosition(modelPoint);
      if (curveManipulationProperties.mode === CurveManipulationMode.FREEFORM) {
        // Do not update the curve model if the drag points in (FREEFORM mode) are too close from one another,
        // to prevent noise in the derivative  (see https://github.com/phetsims/calculus-grapher/issues/297 )
        if (penultimatePosition === null || Math.abs(modelPosition.x - penultimatePosition.x) > FREEFORM_MIN_DX) {
          interactiveCurveNodeProperty.value.transformedCurve.manipulateCurve(curveManipulationProperties.mode, curveManipulationProperties.width, modelPosition, penultimatePosition, antepenultimatePosition);

          // Update (model) antepenultimatePosition and penultimatePosition
          antepenultimatePosition = penultimatePosition;
          penultimatePosition = modelPosition;
        }
      } else {
        // For any mode other than FREEFORM...
        interactiveCurveNodeProperty.value.transformedCurve.manipulateCurve(curveManipulationProperties.mode, curveManipulationProperties.width, modelPosition);
      }
    };

    // Instead of having a DragListener on each TransformedCurveNode, we have a single DragListener on the chartRectangle.
    // This saves us the costly operation of creating pointer areas that match the Shapes of the curves.  And it allows
    // the user to modify a curve by doing a 'pointer down' anywhere in the chartRectangle.
    // See https://github.com/phetsims/calculus-grapher/issues/210 and https://github.com/phetsims/calculus-grapher/issues/74.
    this.chartRectangle.cursor = 'pointer';
    this.chartRectangle.addInputListener(new DragListener({
      dragBoundsProperty: new Property(new Bounds2(0, 0, this.chartTransform.viewWidth, this.chartTransform.viewHeight)),
      applyOffset: false,
      start: (event, listener) => {
        // Save the current values of the CurvePoints for the next undo() call.
        // This must be called once at the start of dragging (and not on each micro drag-position change).
        interactiveCurveNodeProperty.value.transformedCurve.save();

        // Set the previous last positions to null, since it is a new drag.
        antepenultimatePosition = null;
        penultimatePosition = null;
        updateCurve(listener);
      },
      drag: (event, listener) => updateCurve(listener),
      tandem: options.tandem.createTandem('dragListener')
    }));

    // This allows PhET-iO clients to use originalCurveNode.inputEnabledProperty to enabled/disable interactivity,
    // and prevents manipulation of the curves when they are hidden using the eyeToggleButton.
    // See https://github.com/phetsims/calculus-grapher/issues/240 and https://github.com/phetsims/calculus-grapher/issues/272.
    // Do not instrument.
    this.chartRectangle.setInputEnabledProperty(new DerivedProperty([this.originalCurveNode.inputEnabledProperty, predictEnabledProperty, this.curveLayerVisibleProperty], (originalCurveNodeInputEnabled, predictEnabled, curveLayerVisible) => (originalCurveNodeInputEnabled || predictEnabled) && curveLayerVisible));
  }
  reset() {
    this.originalCurveNode.reset();
    this.predictCurveNode.reset();
    this.showOriginalCurveProperty.reset();
    super.reset();
  }

  /**
   * Adds a double-headed tangent arrow to OriginalGraphNode.
   */
  addTangentArrowNode(tangentScrubber, visibleProperty) {
    const tangentArrowNode = new TangentArrowNode(tangentScrubber, this.chartTransform, {
      visibleProperty: visibleProperty,
      tandem: this.tandem.createTandem('tangentArrowNode')
    });
    this.curveLayer.addChild(tangentArrowNode);
    return tangentArrowNode;
  }

  /**
   * Adds a plot to OriginalGraphNode that shows the area under the curve.
   */
  addAreaUnderCurvePlot(areaUnderCurveScrubber, visibleProperty) {
    const areaUnderCurvePlot = new AreaUnderCurvePlot(areaUnderCurveScrubber, this.curve, this.chartTransform, areaUnderCurveScrubber.xProperty, {
      visibleProperty: visibleProperty,
      tandem: this.tandem.createTandem('areaUnderCurvePlot')
    });
    this.curveLayer.addChild(areaUnderCurvePlot);
    areaUnderCurvePlot.moveToBack();
    return areaUnderCurvePlot;
  }
}
calculusGrapher.register('OriginalGraphNode', OriginalGraphNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjYWxjdWx1c0dyYXBoZXIiLCJUcmFuc2Zvcm1lZEN1cnZlTm9kZSIsIm9wdGlvbml6ZSIsIkNhbGN1bHVzR3JhcGhlckNvbG9ycyIsIkdyYXBoTm9kZSIsIkRyYWdMaXN0ZW5lciIsIkhCb3giLCJSZWN0YW5nbGUiLCJUZXh0IiwiQ2FsY3VsdXNHcmFwaGVyQ29uc3RhbnRzIiwiRGVyaXZlZFByb3BlcnR5IiwiQ2FsY3VsdXNHcmFwaGVyU3RyaW5ncyIsIkdyYXBoVHlwZUxhYmVsTm9kZSIsIlRhbmdlbnRBcnJvd05vZGUiLCJBcmVhVW5kZXJDdXJ2ZVBsb3QiLCJHcmFwaFR5cGUiLCJTaG93T3JpZ2luYWxDdXJ2ZUNoZWNrYm94IiwiTGFiZWxlZFBvaW50c05vZGUiLCJQcm9wZXJ0eSIsIkJvdW5kczIiLCJCb29sZWFuSU8iLCJCb29sZWFuUHJvcGVydHkiLCJDdXJ2ZU1hbmlwdWxhdGlvbk1vZGUiLCJGUkVFRk9STV9NSU5fRFgiLCJPcmlnaW5hbEdyYXBoTm9kZSIsImNvbnN0cnVjdG9yIiwibW9kZWwiLCJwcm92aWRlZE9wdGlvbnMiLCJvcmlnaW5hbEN1cnZlIiwicHJlZGljdEN1cnZlIiwiY3VydmVNYW5pcHVsYXRpb25Qcm9wZXJ0aWVzIiwicHJlZGljdEVuYWJsZWRQcm9wZXJ0eSIsImdyYXBoVHlwZSIsIk9SSUdJTkFMIiwibGFiZWxOb2RlVGFuZGVtIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwibGFiZWxOb2RlIiwiY2hpbGRyZW4iLCJwcmVkaWN0U3RyaW5nUHJvcGVydHkiLCJmb250IiwiQ09OVFJPTF9GT05UIiwibWF4V2lkdGgiLCJ2aXNpYmxlUHJvcGVydHkiLCJzcGFjaW5nIiwib3B0aW9ucyIsImNyZWF0ZUN1cnZlTm9kZSIsImNoYXJ0UmVjdGFuZ2xlT3B0aW9ucyIsImZpbGwiLCJvcmlnaW5hbENoYXJ0QmFja2dyb3VuZEZpbGxQcm9wZXJ0eSIsInN0cm9rZSIsIm9yaWdpbmFsQ2hhcnRCYWNrZ3JvdW5kU3Ryb2tlUHJvcGVydHkiLCJncmlkVmlzaWJsZVByb3BlcnR5Iiwic2hvd09yaWdpbmFsQ3VydmVQcm9wZXJ0eSIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJvcmlnaW5hbEN1cnZlTm9kZVRhbmRlbSIsIm9yaWdpbmFsQ3VydmVOb2RlIiwiY2hhcnRUcmFuc2Zvcm0iLCJzdHJva2VQcm9wZXJ0eSIsImRpc2NvbnRpbnVvdXNQb2ludHNGaWxsIiwiY29udGludW91c0xpbmVQbG90T3B0aW9ucyIsImxpbmVXaWR0aCIsInBsb3RCb3VuZHNNZXRob2QiLCJQTE9UX0JPVU5EU19NRVRIT0QiLCJwbG90Qm91bmRzIiwiZ2V0Q2hhcnRSZWN0YW5nbGVCb3VuZHMiLCJpc0ludGVyYWN0aXZlUHJvcGVydHkiLCJub3QiLCJwcmVkaWN0RW5hYmxlZCIsInNob3dPcmlnaW5hbEN1cnZlIiwicGhldGlvVmFsdWVUeXBlIiwicGhldGlvSW5wdXRFbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQiLCJjdXJ2ZUxheWVyIiwiYWRkQ2hpbGQiLCJwcmVkaWN0Q3VydmVOb2RlIiwicHJlZGljdEN1cnZlU3Ryb2tlUHJvcGVydHkiLCJoaWdobGlnaHRSZWN0YW5nbGUiLCJjaGFydFJlY3RhbmdsZSIsIndpZHRoIiwiaGVpZ2h0IiwiY2VudGVyIiwib3BhY2l0eSIsImN1cnZlTGF5ZXJWaXNpYmxlUHJvcGVydHkiLCJvcmlnaW5hbEN1cnZlU3Ryb2tlUHJvcGVydHkiLCJwcmVkaWN0Q3VydmVTdHJva2UiLCJvcmlnaW5hbEN1cnZlU3Ryb2tlIiwibW92ZVRvQmFjayIsInNob3dPcmlnaW5hbEN1cnZlQ2hlY2tib3giLCJib3VuZHNQcm9wZXJ0eSIsImxpbmsiLCJyaWdodCIsIm1vZGVsVG9WaWV3WCIsIkNVUlZFX1hfUkFOR0UiLCJnZXRNYXgiLCJHUkFQSF9YX01BUkdJTiIsInRvcCIsIkdSQVBIX1lfTUFSR0lOIiwibGFiZWxlZFBvaW50c05vZGUiLCJsYWJlbGVkUG9pbnRzIiwibGFiZWxlZFBvaW50c0xpbmthYmxlRWxlbWVudCIsImludGVyYWN0aXZlQ3VydmVOb2RlUHJvcGVydHkiLCJwZW51bHRpbWF0ZVBvc2l0aW9uIiwiYW50ZXBlbnVsdGltYXRlUG9zaXRpb24iLCJ1cGRhdGVDdXJ2ZSIsImxpc3RlbmVyIiwibW9kZWxQb2ludCIsIm1vZGVsUG9zaXRpb24iLCJ2aWV3VG9Nb2RlbFBvc2l0aW9uIiwibW9kZSIsIkZSRUVGT1JNIiwiTWF0aCIsImFicyIsIngiLCJ2YWx1ZSIsInRyYW5zZm9ybWVkQ3VydmUiLCJtYW5pcHVsYXRlQ3VydmUiLCJjdXJzb3IiLCJhZGRJbnB1dExpc3RlbmVyIiwiZHJhZ0JvdW5kc1Byb3BlcnR5Iiwidmlld1dpZHRoIiwidmlld0hlaWdodCIsImFwcGx5T2Zmc2V0Iiwic3RhcnQiLCJldmVudCIsInNhdmUiLCJkcmFnIiwic2V0SW5wdXRFbmFibGVkUHJvcGVydHkiLCJpbnB1dEVuYWJsZWRQcm9wZXJ0eSIsIm9yaWdpbmFsQ3VydmVOb2RlSW5wdXRFbmFibGVkIiwiY3VydmVMYXllclZpc2libGUiLCJyZXNldCIsImFkZFRhbmdlbnRBcnJvd05vZGUiLCJ0YW5nZW50U2NydWJiZXIiLCJ0YW5nZW50QXJyb3dOb2RlIiwiYWRkQXJlYVVuZGVyQ3VydmVQbG90IiwiYXJlYVVuZGVyQ3VydmVTY3J1YmJlciIsImFyZWFVbmRlckN1cnZlUGxvdCIsImN1cnZlIiwieFByb3BlcnR5IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJPcmlnaW5hbEdyYXBoTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMi0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBPcmlnaW5hbEdyYXBoTm9kZSBpcyB0aGUgdmlldyByZXByZXNlbnRhdGlvbiBvZiBhbiBPcmlnaW5hbCBHcmFwaCwgd2hpY2ggaW5jbHVkZXMgdHdvIGN1cnZlc1xyXG4gKiAgdGhhdCBjYW4gYmUgdXNlci1tYW5pcHVsYXRlZCBhcyB3ZWxsIGFzIGN1ZWluZyBhcnJvd3MuXHJcbiAqIExhYmVsZWQgUG9pbnRzIChvbmx5IHZpc2libGUvYWNjZXNzaWJsZSB0aHJvdWdoIFBoRVQtSU8pIGFyZSBhbHNvIGFkZGVkIHRvIHRoaXMgZ3JhcGhcclxuICogT3JpZ2luYWxHcmFwaE5vZGUgZXh0ZW5kcyBHcmFwaE5vZGUuXHJcbiAqIEhvd2V2ZXIsIHRoZSB6b29tIEJ1dHRvbiBvZiBHcmFwaE5vZGUgaXMgc2V0IHRvIGJlIGludmlzaWJsZSBpbiB0aGUgT3JpZ2luYWxHcmFwaE5vZGVcclxuICpcclxuICogVGhlIHB1YmxpYyBtZXRob2RzIG9mIE9yaWdpbmFsR3JhcGhOb2RlIGFsbG93IGEgY2xpZW50IHRvIGFkZFxyXG4gKiAtIGEgU2NydWJiZXJOb2RlXHJcbiAqIC0gYSBUYW5nZW50QXJyb3dOb2RlXHJcbiAqIC0gYW4gQXJlYVVuZGVyQ3VydmVQbG90XHJcbiAqXHJcbiAqIFRoZSBkZWNpc2lvbiB0byB1c2UgdGhlIG5hbWVzICdvcmlnaW5hbCBjdXJ2ZScgYW5kICdvcmlnaW5hbCBncmFwaCcgaXMgZG9jdW1lbnRlZCBpblxyXG4gKiBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2FsY3VsdXMtZ3JhcGhlci9pc3N1ZXMvMTE5XHJcbiAqXHJcbiAqIEBhdXRob3IgTWFydGluIFZlaWxsZXR0ZVxyXG4gKiBAYXV0aG9yIEJyYW5kb24gTGlcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgY2FsY3VsdXNHcmFwaGVyIGZyb20gJy4uLy4uL2NhbGN1bHVzR3JhcGhlci5qcyc7XHJcbmltcG9ydCBUcmFuc2Zvcm1lZEN1cnZlTm9kZSBmcm9tICcuL1RyYW5zZm9ybWVkQ3VydmVOb2RlLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBFbXB0eVNlbGZPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBDYWxjdWx1c0dyYXBoZXJDb2xvcnMgZnJvbSAnLi4vQ2FsY3VsdXNHcmFwaGVyQ29sb3JzLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgR3JhcGhOb2RlLCB7IEdyYXBoTm9kZU9wdGlvbnMgfSBmcm9tICcuL0dyYXBoTm9kZS5qcyc7XHJcbmltcG9ydCB7IERyYWdMaXN0ZW5lciwgSEJveCwgUHJlc3NlZERyYWdMaXN0ZW5lciwgUmVjdGFuZ2xlLCBUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IENhbGN1bHVzR3JhcGhlckNvbnN0YW50cyBmcm9tICcuLi9DYWxjdWx1c0dyYXBoZXJDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgQ2FsY3VsdXNHcmFwaGVyTW9kZWwgZnJvbSAnLi4vbW9kZWwvQ2FsY3VsdXNHcmFwaGVyTW9kZWwuanMnO1xyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IENhbGN1bHVzR3JhcGhlclN0cmluZ3MgZnJvbSAnLi4vLi4vQ2FsY3VsdXNHcmFwaGVyU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBHcmFwaFR5cGVMYWJlbE5vZGUgZnJvbSAnLi9HcmFwaFR5cGVMYWJlbE5vZGUuanMnO1xyXG5pbXBvcnQgVGFuZ2VudFNjcnViYmVyIGZyb20gJy4uL21vZGVsL1RhbmdlbnRTY3J1YmJlci5qcyc7XHJcbmltcG9ydCBUYW5nZW50QXJyb3dOb2RlIGZyb20gJy4vVGFuZ2VudEFycm93Tm9kZS5qcyc7XHJcbmltcG9ydCBBcmVhVW5kZXJDdXJ2ZVNjcnViYmVyIGZyb20gJy4uL21vZGVsL0FyZWFVbmRlckN1cnZlU2NydWJiZXIuanMnO1xyXG5pbXBvcnQgQXJlYVVuZGVyQ3VydmVQbG90IGZyb20gJy4vQXJlYVVuZGVyQ3VydmVQbG90LmpzJztcclxuaW1wb3J0IEdyYXBoVHlwZSBmcm9tICcuLi9tb2RlbC9HcmFwaFR5cGUuanMnO1xyXG5pbXBvcnQgU2hvd09yaWdpbmFsQ3VydmVDaGVja2JveCBmcm9tICcuL1Nob3dPcmlnaW5hbEN1cnZlQ2hlY2tib3guanMnO1xyXG5pbXBvcnQgTGFiZWxlZFBvaW50c05vZGUgZnJvbSAnLi9MYWJlbGVkUG9pbnRzTm9kZS5qcyc7XHJcbmltcG9ydCBQaWNrUmVxdWlyZWQgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1BpY2tSZXF1aXJlZC5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IEJvdW5kczIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0JvdW5kczIuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBCb29sZWFuSU8gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0Jvb2xlYW5JTy5qcyc7XHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQ3VydmVNYW5pcHVsYXRpb25Nb2RlIGZyb20gJy4uL21vZGVsL0N1cnZlTWFuaXB1bGF0aW9uTW9kZS5qcyc7XHJcblxyXG4vLyBNaW5pbXVtIHggZGlzdGFuY2UgYmV0d2VlbiBkcmFnIHBvaW50cyB3aGVuIGRyYXdpbmcgaW4gRlJFRUZPUk0gbW9kZS5cclxuLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8yOTdcclxuY29uc3QgRlJFRUZPUk1fTUlOX0RYID0gMC4xO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IEVtcHR5U2VsZk9wdGlvbnM7XHJcblxyXG50eXBlIE9yaWdpbmFsR3JhcGhOb2RlT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgUGlja1JlcXVpcmVkPEdyYXBoTm9kZU9wdGlvbnMsICdjaGFydFJlY3RhbmdsZUhlaWdodCcgfCAndGFuZGVtJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBPcmlnaW5hbEdyYXBoTm9kZSBleHRlbmRzIEdyYXBoTm9kZSB7XHJcblxyXG4gIC8vIE5vZGUgZm9yIHRoZSBvcmlnaW5hbCBjdXJ2ZSBmKHgpLCB3aGljaCBpcyBpbnRlcmFjdGl2ZVxyXG4gIHByaXZhdGUgcmVhZG9ubHkgb3JpZ2luYWxDdXJ2ZU5vZGU6IFRyYW5zZm9ybWVkQ3VydmVOb2RlO1xyXG5cclxuICAvLyBOb2RlIGZvciB0aGUgcHJlZGljdCBjdXJ2ZSwgd2hpY2ggaXMgaW50ZXJhY3RpdmVcclxuICBwcml2YXRlIHJlYWRvbmx5IHByZWRpY3RDdXJ2ZU5vZGU6IFRyYW5zZm9ybWVkQ3VydmVOb2RlO1xyXG5cclxuICAvLyBJbmRpY2F0ZXMgaWYgdGhlIG9yaWdpbmFsIGN1cnZlIGlzIHZpc2libGUgd2hpbGUgaW4gJ1ByZWRpY3QnIG1vZGUuXHJcbiAgLy8gVGhpcyBQcm9wZXJ0eSBpcyBjb250cm9sbGVkIGJ5IHRoZSAnU2hvdyBmKHgpJyBjaGVja2JveCB0aGF0IGlzIHZpc2libGUgd2hlbiB0aGUgJ1ByZWRpY3QnIHJhZGlvIGJ1dHRvbiBpcyBzZWxlY3RlZC5cclxuICBwcml2YXRlIHJlYWRvbmx5IHNob3dPcmlnaW5hbEN1cnZlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG1vZGVsOiBDYWxjdWx1c0dyYXBoZXJNb2RlbCwgcHJvdmlkZWRPcHRpb25zOiBHcmFwaE5vZGVPcHRpb25zICkge1xyXG5cclxuICAgIC8vIERlc3RydWN0dXJpbmcgZmllbGRzIGZyb20gdGhlIG1vZGVsIGludG8gbG9jYWwgY29uc3RhbnRzLCB0byBpbXByb3ZlIHJlYWRhYmlsaXR5LlxyXG4gICAgY29uc3QgeyBvcmlnaW5hbEN1cnZlLCBwcmVkaWN0Q3VydmUsIGN1cnZlTWFuaXB1bGF0aW9uUHJvcGVydGllcywgcHJlZGljdEVuYWJsZWRQcm9wZXJ0eSB9ID0gbW9kZWw7XHJcblxyXG4gICAgY29uc3QgZ3JhcGhUeXBlID0gR3JhcGhUeXBlLk9SSUdJTkFMO1xyXG5cclxuICAgIC8vIExhYmVsIHRoYXQgdG9nZ2xlcyBiZXR3ZWVuICdQcmVkaWN0IGYoeCknIGFuZCAnZih4KSdcclxuICAgIGNvbnN0IGxhYmVsTm9kZVRhbmRlbSA9IHByb3ZpZGVkT3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnbGFiZWxOb2RlJyApO1xyXG4gICAgY29uc3QgbGFiZWxOb2RlID0gbmV3IEhCb3goIHtcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBuZXcgVGV4dCggQ2FsY3VsdXNHcmFwaGVyU3RyaW5ncy5wcmVkaWN0U3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgICAgIGZvbnQ6IENhbGN1bHVzR3JhcGhlckNvbnN0YW50cy5DT05UUk9MX0ZPTlQsXHJcbiAgICAgICAgICBtYXhXaWR0aDogMTAwLFxyXG4gICAgICAgICAgdmlzaWJsZVByb3BlcnR5OiBtb2RlbC5wcmVkaWN0RW5hYmxlZFByb3BlcnR5LCAvLyBzaG93L2hpZGUgJ1ByZWRpY3QnXHJcbiAgICAgICAgICB0YW5kZW06IGxhYmVsTm9kZVRhbmRlbS5jcmVhdGVUYW5kZW0oICdwcmVkaWN0VGV4dCcgKVxyXG4gICAgICAgIH0gKSxcclxuICAgICAgICBuZXcgR3JhcGhUeXBlTGFiZWxOb2RlKCBncmFwaFR5cGUgKVxyXG4gICAgICBdLFxyXG4gICAgICBzcGFjaW5nOiA1LFxyXG4gICAgICB0YW5kZW06IGxhYmVsTm9kZVRhbmRlbVxyXG4gICAgfSApO1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8T3JpZ2luYWxHcmFwaE5vZGVPcHRpb25zLCBTZWxmT3B0aW9ucywgR3JhcGhOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gR3JhcGhOb2RlT3B0aW9uc1xyXG4gICAgICBsYWJlbE5vZGU6IGxhYmVsTm9kZSxcclxuICAgICAgY3JlYXRlQ3VydmVOb2RlOiBmYWxzZSwgLy8gV2UnbGwgYmUgY3JlYXRpbmcgb3VyIG93biBOb2RlIGZvciBtb2RlbC5vcmlnaW5hbEN1cnZlLlxyXG4gICAgICBjaGFydFJlY3RhbmdsZU9wdGlvbnM6IHtcclxuICAgICAgICBmaWxsOiBDYWxjdWx1c0dyYXBoZXJDb2xvcnMub3JpZ2luYWxDaGFydEJhY2tncm91bmRGaWxsUHJvcGVydHksXHJcbiAgICAgICAgc3Ryb2tlOiBDYWxjdWx1c0dyYXBoZXJDb2xvcnMub3JpZ2luYWxDaGFydEJhY2tncm91bmRTdHJva2VQcm9wZXJ0eVxyXG4gICAgICB9XHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggZ3JhcGhUeXBlLCBvcmlnaW5hbEN1cnZlLCBtb2RlbC5ncmlkVmlzaWJsZVByb3BlcnR5LCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5zaG93T3JpZ2luYWxDdXJ2ZVByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UsIHtcclxuICAgICAgdGFuZGVtOiBwcm92aWRlZE9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Nob3dPcmlnaW5hbEN1cnZlUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdDb250cm9scyB3aGV0aGVyIHRoZSBvcmlnaW5hbCBjdXJ2ZSBpcyB2aXNpYmxlIHdoaWxlIHRoZSBQcmVkaWN0IHJhZGlvIGJ1dHRvbiBpcyBzZWxlY3RlZC4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1RoZSB2YWx1ZSBvZiB0aGlzIFByb3BlcnR5IGNhbiBiZSBjaGFuZ2VkIGJ5IHRvZ2dsaW5nIHNob3dPcmlnaW5hbEN1cnZlQ2hlY2tib3guJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEludGVyYWN0aXZlIGYoeCkgJ29yaWdpbmFsJyBjdXJ2ZVxyXG4gICAgY29uc3Qgb3JpZ2luYWxDdXJ2ZU5vZGVUYW5kZW0gPSBwcm92aWRlZE9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ29yaWdpbmFsQ3VydmVOb2RlJyApO1xyXG4gICAgdGhpcy5vcmlnaW5hbEN1cnZlTm9kZSA9IG5ldyBUcmFuc2Zvcm1lZEN1cnZlTm9kZSggb3JpZ2luYWxDdXJ2ZSwgY3VydmVNYW5pcHVsYXRpb25Qcm9wZXJ0aWVzLCB0aGlzLmNoYXJ0VHJhbnNmb3JtLCB7XHJcbiAgICAgIHN0cm9rZTogZ3JhcGhUeXBlLnN0cm9rZVByb3BlcnR5LFxyXG4gICAgICBkaXNjb250aW51b3VzUG9pbnRzRmlsbDogb3B0aW9ucy5jaGFydFJlY3RhbmdsZU9wdGlvbnMuZmlsbCEsXHJcbiAgICAgIGNvbnRpbnVvdXNMaW5lUGxvdE9wdGlvbnM6IHtcclxuICAgICAgICBsaW5lV2lkdGg6IDMgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8yMDVcclxuICAgICAgfSxcclxuICAgICAgcGxvdEJvdW5kc01ldGhvZDogQ2FsY3VsdXNHcmFwaGVyQ29uc3RhbnRzLlBMT1RfQk9VTkRTX01FVEhPRCwgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8yMTBcclxuICAgICAgcGxvdEJvdW5kczogdGhpcy5nZXRDaGFydFJlY3RhbmdsZUJvdW5kcygpLCAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NhbGN1bHVzLWdyYXBoZXIvaXNzdWVzLzI1OVxyXG4gICAgICBpc0ludGVyYWN0aXZlUHJvcGVydHk6IERlcml2ZWRQcm9wZXJ0eS5ub3QoIHByZWRpY3RFbmFibGVkUHJvcGVydHkgKSxcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgICAgIFsgcHJlZGljdEVuYWJsZWRQcm9wZXJ0eSwgdGhpcy5zaG93T3JpZ2luYWxDdXJ2ZVByb3BlcnR5IF0sXHJcbiAgICAgICAgKCBwcmVkaWN0RW5hYmxlZCwgc2hvd09yaWdpbmFsQ3VydmUgKSA9PiAhcHJlZGljdEVuYWJsZWQgfHwgc2hvd09yaWdpbmFsQ3VydmUsIHtcclxuICAgICAgICAgIHRhbmRlbTogb3JpZ2luYWxDdXJ2ZU5vZGVUYW5kZW0uY3JlYXRlVGFuZGVtKCAndmlzaWJsZVByb3BlcnR5JyApLFxyXG4gICAgICAgICAgcGhldGlvVmFsdWVUeXBlOiBCb29sZWFuSU9cclxuICAgICAgICB9ICksXHJcbiAgICAgIHRhbmRlbTogb3JpZ2luYWxDdXJ2ZU5vZGVUYW5kZW0sXHJcblxyXG4gICAgICAvLyBvcmlnaW5hbEN1cnZlTm9kZSBkb2VzIG5vdCBoYXZlIGFuIGlucHV0IGxpc3RlbmVyLCBidXQgd2Ugd2FudCB0byBhbGxvdyBQaEVULWlPIGNsaWVudHMgdG8gdXNlXHJcbiAgICAgIC8vIG9yaWdpbmFsQ3VydmVOb2RlLmlucHV0RW5hYmxlZFByb3BlcnR5IHRvIGNvbnRyb2wgY2hhcnRSZWN0YW5nbGUuaW5wdXRFbmFibGVkUHJvcGVydHkgKHNlZSBkZXJpdmF0aW9uIGJlbG93KS5cclxuICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8yNDBcclxuICAgICAgcGhldGlvSW5wdXRFbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQ6IHRydWVcclxuICAgIH0gKTtcclxuICAgIHRoaXMuY3VydmVMYXllci5hZGRDaGlsZCggdGhpcy5vcmlnaW5hbEN1cnZlTm9kZSApO1xyXG5cclxuICAgIC8vIEludGVyYWN0aXZlICdQcmVkaWN0JyBjdXJ2ZVxyXG4gICAgdGhpcy5wcmVkaWN0Q3VydmVOb2RlID0gbmV3IFRyYW5zZm9ybWVkQ3VydmVOb2RlKCBwcmVkaWN0Q3VydmUsIGN1cnZlTWFuaXB1bGF0aW9uUHJvcGVydGllcywgdGhpcy5jaGFydFRyYW5zZm9ybSwge1xyXG4gICAgICBzdHJva2U6IENhbGN1bHVzR3JhcGhlckNvbG9ycy5wcmVkaWN0Q3VydmVTdHJva2VQcm9wZXJ0eSxcclxuICAgICAgZGlzY29udGludW91c1BvaW50c0ZpbGw6IG9wdGlvbnMuY2hhcnRSZWN0YW5nbGVPcHRpb25zLmZpbGwhLFxyXG4gICAgICBwbG90Qm91bmRzTWV0aG9kOiBDYWxjdWx1c0dyYXBoZXJDb25zdGFudHMuUExPVF9CT1VORFNfTUVUSE9ELCAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NhbGN1bHVzLWdyYXBoZXIvaXNzdWVzLzIxMFxyXG4gICAgICBwbG90Qm91bmRzOiB0aGlzLmdldENoYXJ0UmVjdGFuZ2xlQm91bmRzKCksIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2FsY3VsdXMtZ3JhcGhlci9pc3N1ZXMvMjU5XHJcbiAgICAgIGlzSW50ZXJhY3RpdmVQcm9wZXJ0eTogcHJlZGljdEVuYWJsZWRQcm9wZXJ0eSxcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiBwcmVkaWN0RW5hYmxlZFByb3BlcnR5LFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3ByZWRpY3RDdXJ2ZU5vZGUnIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuY3VydmVMYXllci5hZGRDaGlsZCggdGhpcy5wcmVkaWN0Q3VydmVOb2RlICk7XHJcblxyXG4gICAgLy8gQWRkIGEgaGlnaGxpZ2h0IGFyb3VuZCB0aGUgY2hhcnRSZWN0YW5nbGUsIGNvbG9yIGNvZGVkIHRvIHRoZSBjdXJ2ZSB0aGF0IGlzIGludGVyYWN0aXZlLlxyXG4gICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8yMDRcclxuICAgIGNvbnN0IGhpZ2hsaWdodFJlY3RhbmdsZSA9IG5ldyBSZWN0YW5nbGUoIDAsIDAsIHRoaXMuY2hhcnRSZWN0YW5nbGUud2lkdGggKyA2LCB0aGlzLmNoYXJ0UmVjdGFuZ2xlLmhlaWdodCArIDYsIHtcclxuICAgICAgY2VudGVyOiB0aGlzLmNoYXJ0UmVjdGFuZ2xlLmNlbnRlcixcclxuICAgICAgb3BhY2l0eTogMC4yNSxcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiB0aGlzLmN1cnZlTGF5ZXJWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgIGZpbGw6IG5ldyBEZXJpdmVkUHJvcGVydHkoIFtcclxuICAgICAgICBtb2RlbC5wcmVkaWN0RW5hYmxlZFByb3BlcnR5LFxyXG4gICAgICAgIENhbGN1bHVzR3JhcGhlckNvbG9ycy5wcmVkaWN0Q3VydmVTdHJva2VQcm9wZXJ0eSxcclxuICAgICAgICBDYWxjdWx1c0dyYXBoZXJDb2xvcnMub3JpZ2luYWxDdXJ2ZVN0cm9rZVByb3BlcnR5XHJcbiAgICAgIF0sICggcHJlZGljdEVuYWJsZWQsIHByZWRpY3RDdXJ2ZVN0cm9rZSwgb3JpZ2luYWxDdXJ2ZVN0cm9rZSApID0+XHJcbiAgICAgICAgcHJlZGljdEVuYWJsZWQgPyBwcmVkaWN0Q3VydmVTdHJva2UgOiBvcmlnaW5hbEN1cnZlU3Ryb2tlIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGhpZ2hsaWdodFJlY3RhbmdsZSApO1xyXG4gICAgaGlnaGxpZ2h0UmVjdGFuZ2xlLm1vdmVUb0JhY2soKTtcclxuXHJcbiAgICAvLyAnU2hvdyBmKHgpJyBjaGVja2JveCwgaW4gdXBwZXItcmlnaHQgY29ybmVyIG9mIHRoZSBjaGFydFJlY3RhbmdsZVxyXG4gICAgY29uc3Qgc2hvd09yaWdpbmFsQ3VydmVDaGVja2JveCA9IG5ldyBTaG93T3JpZ2luYWxDdXJ2ZUNoZWNrYm94KCB0aGlzLnNob3dPcmlnaW5hbEN1cnZlUHJvcGVydHksXHJcbiAgICAgIG1vZGVsLnByZWRpY3RFbmFibGVkUHJvcGVydHksIG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Nob3dPcmlnaW5hbEN1cnZlQ2hlY2tib3gnICkgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHNob3dPcmlnaW5hbEN1cnZlQ2hlY2tib3ggKTtcclxuICAgIHNob3dPcmlnaW5hbEN1cnZlQ2hlY2tib3guYm91bmRzUHJvcGVydHkubGluayggKCkgPT4ge1xyXG4gICAgICBzaG93T3JpZ2luYWxDdXJ2ZUNoZWNrYm94LnJpZ2h0ID1cclxuICAgICAgICB0aGlzLmNoYXJ0VHJhbnNmb3JtLm1vZGVsVG9WaWV3WCggQ2FsY3VsdXNHcmFwaGVyQ29uc3RhbnRzLkNVUlZFX1hfUkFOR0UuZ2V0TWF4KCkgKSAtIENhbGN1bHVzR3JhcGhlckNvbnN0YW50cy5HUkFQSF9YX01BUkdJTjtcclxuICAgICAgc2hvd09yaWdpbmFsQ3VydmVDaGVja2JveC50b3AgPSBDYWxjdWx1c0dyYXBoZXJDb25zdGFudHMuR1JBUEhfWV9NQVJHSU47XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gTGFiZWxlZCBwb2ludHNcclxuICAgIGNvbnN0IGxhYmVsZWRQb2ludHNOb2RlID0gbmV3IExhYmVsZWRQb2ludHNOb2RlKCBtb2RlbC5sYWJlbGVkUG9pbnRzLCBtb2RlbC5sYWJlbGVkUG9pbnRzTGlua2FibGVFbGVtZW50LFxyXG4gICAgICB0aGlzLmNoYXJ0VHJhbnNmb3JtLCBtb2RlbC5wcmVkaWN0RW5hYmxlZFByb3BlcnR5LCB0aGlzLmN1cnZlTGF5ZXJWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgIG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xhYmVsZWRQb2ludHNOb2RlJyApXHJcbiAgICApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbGFiZWxlZFBvaW50c05vZGUgKTtcclxuXHJcbiAgICAvLyBXaGljaCBvZiB0aGUgQ3VydmVOb2RlIGluc3RhbmNlcyBpcyBjdXJyZW50bHkgaW50ZXJhY3RpdmVcclxuICAgIGNvbnN0IGludGVyYWN0aXZlQ3VydmVOb2RlUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIG1vZGVsLnByZWRpY3RFbmFibGVkUHJvcGVydHkgXSxcclxuICAgICAgcHJlZGljdEVuYWJsZWQgPT4gcHJlZGljdEVuYWJsZWQgPyB0aGlzLnByZWRpY3RDdXJ2ZU5vZGUgOiB0aGlzLm9yaWdpbmFsQ3VydmVOb2RlXHJcbiAgICApO1xyXG5cclxuICAgIC8vIFZhcmlhYmxlcyB0byBrZWVwIHRyYWNrIG9mIG9sZCBtb2RlbCBwb3NpdGlvbnMgYXNzb2NpYXRlZCB3aXRoIHRoZSBkcmFnTGlzdGVuZXIuXHJcbiAgICAvLyBTZXQgdGhlbSB0byBudWxsIGFzIG5vIGRyYWcgZXZlbnQgaGFzIG9jY3VycmVkIHlldC5cclxuICAgIC8vIFRoZXNlIGFyZSByZWxldmFudCBvbmx5IGZvciBDdXJ2ZU1hbmlwdWxhdGlvbk1vZGUuRlJFRUZPUk0uXHJcbiAgICBsZXQgcGVudWx0aW1hdGVQb3NpdGlvbjogVmVjdG9yMiB8IG51bGwgPSBudWxsO1xyXG4gICAgbGV0IGFudGVwZW51bHRpbWF0ZVBvc2l0aW9uOiBWZWN0b3IyIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gICAgLy8gVXBkYXRlIHdoaWNoZXZlciBjdXJ2ZSBpcyBjdXJyZW50bHkgaW50ZXJhY3RpdmUuXHJcbiAgICBjb25zdCB1cGRhdGVDdXJ2ZSA9ICggbGlzdGVuZXI6IFByZXNzZWREcmFnTGlzdGVuZXIgKTogdm9pZCA9PiB7XHJcblxyXG4gICAgICAvLyBUaGlzIGxpc3RlbmVyICdmaWVsZCcgaXMgYWN0dWFsbHkgYW4gRVM1IGdldHRlciB0aGF0IGFsbG9jYXRlcyBhIFZlY3RvcjIsIHNvIGNhbGwgaXQgb25seSBvbmNlLlxyXG4gICAgICBjb25zdCBtb2RlbFBvaW50ID0gbGlzdGVuZXIubW9kZWxQb2ludDtcclxuXHJcbiAgICAgIC8vIEN1cnJlbnQgbW9kZWxQb3NpdGlvblxyXG4gICAgICBjb25zdCBtb2RlbFBvc2l0aW9uID0gdGhpcy5jaGFydFRyYW5zZm9ybS52aWV3VG9Nb2RlbFBvc2l0aW9uKCBtb2RlbFBvaW50ICk7XHJcblxyXG4gICAgICBpZiAoIGN1cnZlTWFuaXB1bGF0aW9uUHJvcGVydGllcy5tb2RlID09PSBDdXJ2ZU1hbmlwdWxhdGlvbk1vZGUuRlJFRUZPUk0gKSB7XHJcblxyXG4gICAgICAgIC8vIERvIG5vdCB1cGRhdGUgdGhlIGN1cnZlIG1vZGVsIGlmIHRoZSBkcmFnIHBvaW50cyBpbiAoRlJFRUZPUk0gbW9kZSkgYXJlIHRvbyBjbG9zZSBmcm9tIG9uZSBhbm90aGVyLFxyXG4gICAgICAgIC8vIHRvIHByZXZlbnQgbm9pc2UgaW4gdGhlIGRlcml2YXRpdmUgIChzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NhbGN1bHVzLWdyYXBoZXIvaXNzdWVzLzI5NyApXHJcbiAgICAgICAgaWYgKCBwZW51bHRpbWF0ZVBvc2l0aW9uID09PSBudWxsIHx8IE1hdGguYWJzKCBtb2RlbFBvc2l0aW9uLnggLSBwZW51bHRpbWF0ZVBvc2l0aW9uLnggKSA+IEZSRUVGT1JNX01JTl9EWCApIHtcclxuXHJcbiAgICAgICAgICBpbnRlcmFjdGl2ZUN1cnZlTm9kZVByb3BlcnR5LnZhbHVlLnRyYW5zZm9ybWVkQ3VydmUubWFuaXB1bGF0ZUN1cnZlKFxyXG4gICAgICAgICAgICBjdXJ2ZU1hbmlwdWxhdGlvblByb3BlcnRpZXMubW9kZSxcclxuICAgICAgICAgICAgY3VydmVNYW5pcHVsYXRpb25Qcm9wZXJ0aWVzLndpZHRoLFxyXG4gICAgICAgICAgICBtb2RlbFBvc2l0aW9uLFxyXG4gICAgICAgICAgICBwZW51bHRpbWF0ZVBvc2l0aW9uLFxyXG4gICAgICAgICAgICBhbnRlcGVudWx0aW1hdGVQb3NpdGlvbiApO1xyXG5cclxuICAgICAgICAgIC8vIFVwZGF0ZSAobW9kZWwpIGFudGVwZW51bHRpbWF0ZVBvc2l0aW9uIGFuZCBwZW51bHRpbWF0ZVBvc2l0aW9uXHJcbiAgICAgICAgICBhbnRlcGVudWx0aW1hdGVQb3NpdGlvbiA9IHBlbnVsdGltYXRlUG9zaXRpb247XHJcbiAgICAgICAgICBwZW51bHRpbWF0ZVBvc2l0aW9uID0gbW9kZWxQb3NpdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgIC8vIEZvciBhbnkgbW9kZSBvdGhlciB0aGFuIEZSRUVGT1JNLi4uXHJcbiAgICAgICAgaW50ZXJhY3RpdmVDdXJ2ZU5vZGVQcm9wZXJ0eS52YWx1ZS50cmFuc2Zvcm1lZEN1cnZlLm1hbmlwdWxhdGVDdXJ2ZShcclxuICAgICAgICAgIGN1cnZlTWFuaXB1bGF0aW9uUHJvcGVydGllcy5tb2RlLFxyXG4gICAgICAgICAgY3VydmVNYW5pcHVsYXRpb25Qcm9wZXJ0aWVzLndpZHRoLFxyXG4gICAgICAgICAgbW9kZWxQb3NpdGlvbiApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEluc3RlYWQgb2YgaGF2aW5nIGEgRHJhZ0xpc3RlbmVyIG9uIGVhY2ggVHJhbnNmb3JtZWRDdXJ2ZU5vZGUsIHdlIGhhdmUgYSBzaW5nbGUgRHJhZ0xpc3RlbmVyIG9uIHRoZSBjaGFydFJlY3RhbmdsZS5cclxuICAgIC8vIFRoaXMgc2F2ZXMgdXMgdGhlIGNvc3RseSBvcGVyYXRpb24gb2YgY3JlYXRpbmcgcG9pbnRlciBhcmVhcyB0aGF0IG1hdGNoIHRoZSBTaGFwZXMgb2YgdGhlIGN1cnZlcy4gIEFuZCBpdCBhbGxvd3NcclxuICAgIC8vIHRoZSB1c2VyIHRvIG1vZGlmeSBhIGN1cnZlIGJ5IGRvaW5nIGEgJ3BvaW50ZXIgZG93bicgYW55d2hlcmUgaW4gdGhlIGNoYXJ0UmVjdGFuZ2xlLlxyXG4gICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8yMTAgYW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy83NC5cclxuICAgIHRoaXMuY2hhcnRSZWN0YW5nbGUuY3Vyc29yID0gJ3BvaW50ZXInO1xyXG4gICAgdGhpcy5jaGFydFJlY3RhbmdsZS5hZGRJbnB1dExpc3RlbmVyKCBuZXcgRHJhZ0xpc3RlbmVyKCB7XHJcbiAgICAgIGRyYWdCb3VuZHNQcm9wZXJ0eTogbmV3IFByb3BlcnR5KCBuZXcgQm91bmRzMiggMCwgMCwgdGhpcy5jaGFydFRyYW5zZm9ybS52aWV3V2lkdGgsIHRoaXMuY2hhcnRUcmFuc2Zvcm0udmlld0hlaWdodCApICksXHJcbiAgICAgIGFwcGx5T2Zmc2V0OiBmYWxzZSxcclxuICAgICAgc3RhcnQ6ICggZXZlbnQsIGxpc3RlbmVyICkgPT4ge1xyXG5cclxuICAgICAgICAvLyBTYXZlIHRoZSBjdXJyZW50IHZhbHVlcyBvZiB0aGUgQ3VydmVQb2ludHMgZm9yIHRoZSBuZXh0IHVuZG8oKSBjYWxsLlxyXG4gICAgICAgIC8vIFRoaXMgbXVzdCBiZSBjYWxsZWQgb25jZSBhdCB0aGUgc3RhcnQgb2YgZHJhZ2dpbmcgKGFuZCBub3Qgb24gZWFjaCBtaWNybyBkcmFnLXBvc2l0aW9uIGNoYW5nZSkuXHJcbiAgICAgICAgaW50ZXJhY3RpdmVDdXJ2ZU5vZGVQcm9wZXJ0eS52YWx1ZS50cmFuc2Zvcm1lZEN1cnZlLnNhdmUoKTtcclxuXHJcbiAgICAgICAgLy8gU2V0IHRoZSBwcmV2aW91cyBsYXN0IHBvc2l0aW9ucyB0byBudWxsLCBzaW5jZSBpdCBpcyBhIG5ldyBkcmFnLlxyXG4gICAgICAgIGFudGVwZW51bHRpbWF0ZVBvc2l0aW9uID0gbnVsbDtcclxuICAgICAgICBwZW51bHRpbWF0ZVBvc2l0aW9uID0gbnVsbDtcclxuICAgICAgICB1cGRhdGVDdXJ2ZSggbGlzdGVuZXIgKTtcclxuICAgICAgfSxcclxuICAgICAgZHJhZzogKCBldmVudCwgbGlzdGVuZXIgKSA9PiB1cGRhdGVDdXJ2ZSggbGlzdGVuZXIgKSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdkcmFnTGlzdGVuZXInIClcclxuICAgIH0gKSApO1xyXG5cclxuICAgIC8vIFRoaXMgYWxsb3dzIFBoRVQtaU8gY2xpZW50cyB0byB1c2Ugb3JpZ2luYWxDdXJ2ZU5vZGUuaW5wdXRFbmFibGVkUHJvcGVydHkgdG8gZW5hYmxlZC9kaXNhYmxlIGludGVyYWN0aXZpdHksXHJcbiAgICAvLyBhbmQgcHJldmVudHMgbWFuaXB1bGF0aW9uIG9mIHRoZSBjdXJ2ZXMgd2hlbiB0aGV5IGFyZSBoaWRkZW4gdXNpbmcgdGhlIGV5ZVRvZ2dsZUJ1dHRvbi5cclxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2FsY3VsdXMtZ3JhcGhlci9pc3N1ZXMvMjQwIGFuZCBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2FsY3VsdXMtZ3JhcGhlci9pc3N1ZXMvMjcyLlxyXG4gICAgLy8gRG8gbm90IGluc3RydW1lbnQuXHJcbiAgICB0aGlzLmNoYXJ0UmVjdGFuZ2xlLnNldElucHV0RW5hYmxlZFByb3BlcnR5KCBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgICBbIHRoaXMub3JpZ2luYWxDdXJ2ZU5vZGUuaW5wdXRFbmFibGVkUHJvcGVydHksIHByZWRpY3RFbmFibGVkUHJvcGVydHksIHRoaXMuY3VydmVMYXllclZpc2libGVQcm9wZXJ0eSBdLFxyXG4gICAgICAoIG9yaWdpbmFsQ3VydmVOb2RlSW5wdXRFbmFibGVkLCBwcmVkaWN0RW5hYmxlZCwgY3VydmVMYXllclZpc2libGUgKSA9PlxyXG4gICAgICAgICggb3JpZ2luYWxDdXJ2ZU5vZGVJbnB1dEVuYWJsZWQgfHwgcHJlZGljdEVuYWJsZWQgKSAmJiBjdXJ2ZUxheWVyVmlzaWJsZVxyXG4gICAgKSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5vcmlnaW5hbEN1cnZlTm9kZS5yZXNldCgpO1xyXG4gICAgdGhpcy5wcmVkaWN0Q3VydmVOb2RlLnJlc2V0KCk7XHJcbiAgICB0aGlzLnNob3dPcmlnaW5hbEN1cnZlUHJvcGVydHkucmVzZXQoKTtcclxuICAgIHN1cGVyLnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGRzIGEgZG91YmxlLWhlYWRlZCB0YW5nZW50IGFycm93IHRvIE9yaWdpbmFsR3JhcGhOb2RlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRUYW5nZW50QXJyb3dOb2RlKCB0YW5nZW50U2NydWJiZXI6IFRhbmdlbnRTY3J1YmJlciwgdmlzaWJsZVByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPiApOiBUYW5nZW50QXJyb3dOb2RlIHtcclxuICAgIGNvbnN0IHRhbmdlbnRBcnJvd05vZGUgPSBuZXcgVGFuZ2VudEFycm93Tm9kZSggdGFuZ2VudFNjcnViYmVyLCB0aGlzLmNoYXJ0VHJhbnNmb3JtLCB7XHJcbiAgICAgIHZpc2libGVQcm9wZXJ0eTogdmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICB0YW5kZW06IHRoaXMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3RhbmdlbnRBcnJvd05vZGUnIClcclxuICAgIH0gKTtcclxuICAgIHRoaXMuY3VydmVMYXllci5hZGRDaGlsZCggdGFuZ2VudEFycm93Tm9kZSApO1xyXG4gICAgcmV0dXJuIHRhbmdlbnRBcnJvd05vZGU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGRzIGEgcGxvdCB0byBPcmlnaW5hbEdyYXBoTm9kZSB0aGF0IHNob3dzIHRoZSBhcmVhIHVuZGVyIHRoZSBjdXJ2ZS5cclxuICAgKi9cclxuICBwdWJsaWMgYWRkQXJlYVVuZGVyQ3VydmVQbG90KCBhcmVhVW5kZXJDdXJ2ZVNjcnViYmVyOiBBcmVhVW5kZXJDdXJ2ZVNjcnViYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4gKTogQXJlYVVuZGVyQ3VydmVQbG90IHtcclxuICAgIGNvbnN0IGFyZWFVbmRlckN1cnZlUGxvdCA9IG5ldyBBcmVhVW5kZXJDdXJ2ZVBsb3QoIGFyZWFVbmRlckN1cnZlU2NydWJiZXIsIHRoaXMuY3VydmUsIHRoaXMuY2hhcnRUcmFuc2Zvcm0sXHJcbiAgICAgIGFyZWFVbmRlckN1cnZlU2NydWJiZXIueFByb3BlcnR5LCB7XHJcbiAgICAgICAgdmlzaWJsZVByb3BlcnR5OiB2aXNpYmxlUHJvcGVydHksXHJcbiAgICAgICAgdGFuZGVtOiB0aGlzLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdhcmVhVW5kZXJDdXJ2ZVBsb3QnIClcclxuICAgICAgfSApO1xyXG4gICAgdGhpcy5jdXJ2ZUxheWVyLmFkZENoaWxkKCBhcmVhVW5kZXJDdXJ2ZVBsb3QgKTtcclxuICAgIGFyZWFVbmRlckN1cnZlUGxvdC5tb3ZlVG9CYWNrKCk7XHJcbiAgICByZXR1cm4gYXJlYVVuZGVyQ3VydmVQbG90O1xyXG4gIH1cclxufVxyXG5cclxuY2FsY3VsdXNHcmFwaGVyLnJlZ2lzdGVyKCAnT3JpZ2luYWxHcmFwaE5vZGUnLCBPcmlnaW5hbEdyYXBoTm9kZSApO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSwwQkFBMEI7QUFDdEQsT0FBT0Msb0JBQW9CLE1BQU0sMkJBQTJCO0FBQzVELE9BQU9DLFNBQVMsTUFBNEIsdUNBQXVDO0FBQ25GLE9BQU9DLHFCQUFxQixNQUFNLDZCQUE2QjtBQUUvRCxPQUFPQyxTQUFTLE1BQTRCLGdCQUFnQjtBQUM1RCxTQUFTQyxZQUFZLEVBQUVDLElBQUksRUFBdUJDLFNBQVMsRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUM1RyxPQUFPQyx3QkFBd0IsTUFBTSxnQ0FBZ0M7QUFFckUsT0FBT0MsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxzQkFBc0IsTUFBTSxpQ0FBaUM7QUFDcEUsT0FBT0Msa0JBQWtCLE1BQU0seUJBQXlCO0FBRXhELE9BQU9DLGdCQUFnQixNQUFNLHVCQUF1QjtBQUVwRCxPQUFPQyxrQkFBa0IsTUFBTSx5QkFBeUI7QUFDeEQsT0FBT0MsU0FBUyxNQUFNLHVC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