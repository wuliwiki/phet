// Copyright 2020-2023, University of Colorado Boulder

/**
 * Base class for the top-level view of every screen in the 'Calculus Grapher' simulation.
 *
 * @author Brandon Li
 * @author Martin Veillette
 * @author Chris Malley (PixelZoom, Inc.)
 */

import ScreenView from '../../../../joist/js/ScreenView.js';
import calculusGrapher from '../../calculusGrapher.js';
import CalculusGrapherControlPanel from './CalculusGrapherControlPanel.js';
import optionize, { combineOptions } from '../../../../phet-core/js/optionize.js';
import ResetAllButton from '../../../../scenery-phet/js/buttons/ResetAllButton.js';
import GraphsNode from './GraphsNode.js';
import CalculusGrapherCheckboxGroup from './CalculusGrapherCheckboxGroup.js';
import GraphSetRadioButtonGroup from './GraphSetRadioButtonGroup.js';
import { Node, VBox } from '../../../../scenery/js/imports.js';
import CalculusGrapherConstants from '../CalculusGrapherConstants.js';
export default class CalculusGrapherScreenView extends ScreenView {
  // Node responsible for displaying all graphs and their decorations

  // The checkbox group that appears below the control panel

  // Instead of adding children directly to the ScreenView, add them to this parent Node, so that keyboard traversal
  // can be supported by setting pdomOrder on this Node.  See https://github.com/phetsims/calculus-grapher/issues/123
  constructor(model, providedOptions) {
    const options = optionize()({
      // SelfOptions
      graphSetRadioButtonGroupItems: []
    }, providedOptions);
    assert && assert(model.graphSets.length === 1 && options.graphSetRadioButtonGroupItems.length === 0 || model.graphSets.length === options.graphSetRadioButtonGroupItems.length, 'If > 1 graphSets, then there must be a radio button for each graphSet');
    super(options);
    this.model = model;
    const resetAllButton = new ResetAllButton({
      right: this.layoutBounds.right - CalculusGrapherConstants.SCREEN_VIEW_X_MARGIN,
      bottom: this.layoutBounds.bottom - CalculusGrapherConstants.SCREEN_VIEW_Y_MARGIN,
      listener: () => this.reset(),
      tandem: options.tandem.createTandem('resetAllButton')
    });
    const controlPanel = new CalculusGrapherControlPanel(model.curveManipulationProperties, model.predictSelectedProperty, model.predictEnabledProperty, model.interactiveCurveProperty, combineOptions({
      tandem: options.tandem.createTandem('controlPanel')
    }, options.controlPanelOptions));
    this.checkboxGroup = new CalculusGrapherCheckboxGroup(model.gridVisibleProperty, model.referenceLine.visibleProperty, options.tandem.createTandem('checkboxGroup'));
    const rightVBox = new VBox({
      children: [controlPanel, this.checkboxGroup],
      spacing: 20,
      align: 'left'
    });
    this.graphsNode = new GraphsNode(model, {
      centerX: this.layoutBounds.centerX - 25,
      y: this.layoutBounds.top + 40,
      tandem: options.tandem.createTandem('graphsNode')
    });

    // Put control panel in the negative space to the right of the ChartRectangles, top-aligned with graphsNode.y.
    rightVBox.boundsProperty.link(() => {
      const chartRectangleRight = this.graphsNode.x + CalculusGrapherConstants.CHART_RECTANGLE_WIDTH;
      rightVBox.centerX = this.layoutBounds.right - (this.layoutBounds.right - chartRectangleRight) / 2;
      rightVBox.top = this.graphsNode.y;
    });
    const children = [this.graphsNode, rightVBox, resetAllButton];
    if (options.graphSetRadioButtonGroupItems.length > 0) {
      const graphSetRadioButtonGroup = new GraphSetRadioButtonGroup(model.graphSetProperty, options.graphSetRadioButtonGroupItems, options.tandem.createTandem('graphSetRadioButtonGroup'));
      children.push(graphSetRadioButtonGroup);

      // Center graphSetRadioButtonGroup in the negative space to the left of graphNode. We're only adjusting centerX
      // dynamically so that GraphSetsAnimation doesn't cause tiny shifts in y.
      graphSetRadioButtonGroup.centerY = this.graphsNode.centerY;
      this.graphsNode.boundsProperty.link(() => {
        const eyeToggleButtonLeft = this.graphsNode.x + this.graphsNode.getEyeToggleButtonXOffset();
        graphSetRadioButtonGroup.centerX = this.layoutBounds.left + (eyeToggleButtonLeft - this.layoutBounds.left) / 2;
      });
    }
    this.screenViewRootNode = new Node({
      children: children
    });
    this.addChild(this.screenViewRootNode);
  }

  /**
   * Reset all
   */
  reset() {
    this.model.reset();
    this.graphsNode.reset();
  }
  step(dt) {
    this.graphsNode.step(dt);
    super.step(dt);
  }
}
calculusGrapher.register('CalculusGrapherScreenView', CalculusGrapherScreenView);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTY3JlZW5WaWV3IiwiY2FsY3VsdXNHcmFwaGVyIiwiQ2FsY3VsdXNHcmFwaGVyQ29udHJvbFBhbmVsIiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJSZXNldEFsbEJ1dHRvbiIsIkdyYXBoc05vZGUiLCJDYWxjdWx1c0dyYXBoZXJDaGVja2JveEdyb3VwIiwiR3JhcGhTZXRSYWRpb0J1dHRvbkdyb3VwIiwiTm9kZSIsIlZCb3giLCJDYWxjdWx1c0dyYXBoZXJDb25zdGFudHMiLCJDYWxjdWx1c0dyYXBoZXJTY3JlZW5WaWV3IiwiY29uc3RydWN0b3IiLCJtb2RlbCIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJncmFwaFNldFJhZGlvQnV0dG9uR3JvdXBJdGVtcyIsImFzc2VydCIsImdyYXBoU2V0cyIsImxlbmd0aCIsInJlc2V0QWxsQnV0dG9uIiwicmlnaHQiLCJsYXlvdXRCb3VuZHMiLCJTQ1JFRU5fVklFV19YX01BUkdJTiIsImJvdHRvbSIsIlNDUkVFTl9WSUVXX1lfTUFSR0lOIiwibGlzdGVuZXIiLCJyZXNldCIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsImNvbnRyb2xQYW5lbCIsImN1cnZlTWFuaXB1bGF0aW9uUHJvcGVydGllcyIsInByZWRpY3RTZWxlY3RlZFByb3BlcnR5IiwicHJlZGljdEVuYWJsZWRQcm9wZXJ0eSIsImludGVyYWN0aXZlQ3VydmVQcm9wZXJ0eSIsImNvbnRyb2xQYW5lbE9wdGlvbnMiLCJjaGVja2JveEdyb3VwIiwiZ3JpZFZpc2libGVQcm9wZXJ0eSIsInJlZmVyZW5jZUxpbmUiLCJ2aXNpYmxlUHJvcGVydHkiLCJyaWdodFZCb3giLCJjaGlsZHJlbiIsInNwYWNpbmciLCJhbGlnbiIsImdyYXBoc05vZGUiLCJjZW50ZXJYIiwieSIsInRvcCIsImJvdW5kc1Byb3BlcnR5IiwibGluayIsImNoYXJ0UmVjdGFuZ2xlUmlnaHQiLCJ4IiwiQ0hBUlRfUkVDVEFOR0xFX1dJRFRIIiwiZ3JhcGhTZXRSYWRpb0J1dHRvbkdyb3VwIiwiZ3JhcGhTZXRQcm9wZXJ0eSIsInB1c2giLCJjZW50ZXJZIiwiZXllVG9nZ2xlQnV0dG9uTGVmdCIsImdldEV5ZVRvZ2dsZUJ1dHRvblhPZmZzZXQiLCJsZWZ0Iiwic2NyZWVuVmlld1Jvb3ROb2RlIiwiYWRkQ2hpbGQiLCJzdGVwIiwiZHQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNhbGN1bHVzR3JhcGhlclNjcmVlblZpZXcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjAtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQmFzZSBjbGFzcyBmb3IgdGhlIHRvcC1sZXZlbCB2aWV3IG9mIGV2ZXJ5IHNjcmVlbiBpbiB0aGUgJ0NhbGN1bHVzIEdyYXBoZXInIHNpbXVsYXRpb24uXHJcbiAqXHJcbiAqIEBhdXRob3IgQnJhbmRvbiBMaVxyXG4gKiBAYXV0aG9yIE1hcnRpbiBWZWlsbGV0dGVcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgU2NyZWVuVmlldywgeyBTY3JlZW5WaWV3T3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL2pvaXN0L2pzL1NjcmVlblZpZXcuanMnO1xyXG5pbXBvcnQgY2FsY3VsdXNHcmFwaGVyIGZyb20gJy4uLy4uL2NhbGN1bHVzR3JhcGhlci5qcyc7XHJcbmltcG9ydCBDYWxjdWx1c0dyYXBoZXJNb2RlbCBmcm9tICcuLi9tb2RlbC9DYWxjdWx1c0dyYXBoZXJNb2RlbC5qcyc7XHJcbmltcG9ydCBDYWxjdWx1c0dyYXBoZXJDb250cm9sUGFuZWwsIHsgQ2FsY3VsdXNHcmFwaGVyQ29udHJvbFBhbmVsT3B0aW9ucyB9IGZyb20gJy4vQ2FsY3VsdXNHcmFwaGVyQ29udHJvbFBhbmVsLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSwgeyBjb21iaW5lT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUmVzZXRBbGxCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL2J1dHRvbnMvUmVzZXRBbGxCdXR0b24uanMnO1xyXG5pbXBvcnQgR3JhcGhzTm9kZSBmcm9tICcuL0dyYXBoc05vZGUuanMnO1xyXG5pbXBvcnQgQ2FsY3VsdXNHcmFwaGVyQ2hlY2tib3hHcm91cCBmcm9tICcuL0NhbGN1bHVzR3JhcGhlckNoZWNrYm94R3JvdXAuanMnO1xyXG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XHJcbmltcG9ydCBHcmFwaFNldFJhZGlvQnV0dG9uR3JvdXAsIHsgR3JhcGhTZXRSYWRpb0J1dHRvbkdyb3VwSXRlbSB9IGZyb20gJy4vR3JhcGhTZXRSYWRpb0J1dHRvbkdyb3VwLmpzJztcclxuaW1wb3J0IHsgTm9kZSwgVkJveCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBDYWxjdWx1c0dyYXBoZXJDb25zdGFudHMgZnJvbSAnLi4vQ2FsY3VsdXNHcmFwaGVyQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSB7XHJcblxyXG4gIC8vIEl0ZW1zIHRvIGluY2x1ZGUgaW4gdGhlIEdyYXBoU2V0UmFkaW9CdXR0b25Hcm91cEl0ZW1cclxuICBncmFwaFNldFJhZGlvQnV0dG9uR3JvdXBJdGVtcz86IEdyYXBoU2V0UmFkaW9CdXR0b25Hcm91cEl0ZW1bXTtcclxuXHJcbiAgLy8gT3B0aW9ucyBmb3IgdGhlIG1haW4gY29udHJvbCBwYW5lbFxyXG4gIGNvbnRyb2xQYW5lbE9wdGlvbnM/OiBQYXJ0aWFsPENhbGN1bHVzR3JhcGhlckNvbnRyb2xQYW5lbE9wdGlvbnM+O1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgQ2FsY3VsdXNHcmFwaGVyU2NyZWVuVmlld09wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxTY3JlZW5WaWV3T3B0aW9ucywgJ3RhbmRlbSc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FsY3VsdXNHcmFwaGVyU2NyZWVuVmlldyBleHRlbmRzIFNjcmVlblZpZXcge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IG1vZGVsOiBDYWxjdWx1c0dyYXBoZXJNb2RlbDtcclxuXHJcbiAgLy8gTm9kZSByZXNwb25zaWJsZSBmb3IgZGlzcGxheWluZyBhbGwgZ3JhcGhzIGFuZCB0aGVpciBkZWNvcmF0aW9uc1xyXG4gIHB1YmxpYyByZWFkb25seSBncmFwaHNOb2RlOiBHcmFwaHNOb2RlO1xyXG5cclxuICAvLyBUaGUgY2hlY2tib3ggZ3JvdXAgdGhhdCBhcHBlYXJzIGJlbG93IHRoZSBjb250cm9sIHBhbmVsXHJcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGNoZWNrYm94R3JvdXA6IENhbGN1bHVzR3JhcGhlckNoZWNrYm94R3JvdXA7XHJcblxyXG4gIC8vIEluc3RlYWQgb2YgYWRkaW5nIGNoaWxkcmVuIGRpcmVjdGx5IHRvIHRoZSBTY3JlZW5WaWV3LCBhZGQgdGhlbSB0byB0aGlzIHBhcmVudCBOb2RlLCBzbyB0aGF0IGtleWJvYXJkIHRyYXZlcnNhbFxyXG4gIC8vIGNhbiBiZSBzdXBwb3J0ZWQgYnkgc2V0dGluZyBwZG9tT3JkZXIgb24gdGhpcyBOb2RlLiAgU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8xMjNcclxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgc2NyZWVuVmlld1Jvb3ROb2RlOiBOb2RlO1xyXG5cclxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoIG1vZGVsOiBDYWxjdWx1c0dyYXBoZXJNb2RlbCwgcHJvdmlkZWRPcHRpb25zOiBDYWxjdWx1c0dyYXBoZXJTY3JlZW5WaWV3T3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPENhbGN1bHVzR3JhcGhlclNjcmVlblZpZXdPcHRpb25zLFxyXG4gICAgICBTdHJpY3RPbWl0PFNlbGZPcHRpb25zLCAnY29udHJvbFBhbmVsT3B0aW9ucyc+LFxyXG4gICAgICBTY3JlZW5WaWV3T3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gU2VsZk9wdGlvbnNcclxuICAgICAgZ3JhcGhTZXRSYWRpb0J1dHRvbkdyb3VwSXRlbXM6IFtdXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAoIG1vZGVsLmdyYXBoU2V0cy5sZW5ndGggPT09IDEgJiYgb3B0aW9ucy5ncmFwaFNldFJhZGlvQnV0dG9uR3JvdXBJdGVtcy5sZW5ndGggPT09IDAgKSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgKCBtb2RlbC5ncmFwaFNldHMubGVuZ3RoID09PSBvcHRpb25zLmdyYXBoU2V0UmFkaW9CdXR0b25Hcm91cEl0ZW1zLmxlbmd0aCApLFxyXG4gICAgICAnSWYgPiAxIGdyYXBoU2V0cywgdGhlbiB0aGVyZSBtdXN0IGJlIGEgcmFkaW8gYnV0dG9uIGZvciBlYWNoIGdyYXBoU2V0JyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xyXG5cclxuICAgIGNvbnN0IHJlc2V0QWxsQnV0dG9uID0gbmV3IFJlc2V0QWxsQnV0dG9uKCB7XHJcbiAgICAgIHJpZ2h0OiB0aGlzLmxheW91dEJvdW5kcy5yaWdodCAtIENhbGN1bHVzR3JhcGhlckNvbnN0YW50cy5TQ1JFRU5fVklFV19YX01BUkdJTixcclxuICAgICAgYm90dG9tOiB0aGlzLmxheW91dEJvdW5kcy5ib3R0b20gLSBDYWxjdWx1c0dyYXBoZXJDb25zdGFudHMuU0NSRUVOX1ZJRVdfWV9NQVJHSU4sXHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB0aGlzLnJlc2V0KCksXHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncmVzZXRBbGxCdXR0b24nIClcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBjb250cm9sUGFuZWwgPSBuZXcgQ2FsY3VsdXNHcmFwaGVyQ29udHJvbFBhbmVsKFxyXG4gICAgICBtb2RlbC5jdXJ2ZU1hbmlwdWxhdGlvblByb3BlcnRpZXMsXHJcbiAgICAgIG1vZGVsLnByZWRpY3RTZWxlY3RlZFByb3BlcnR5LFxyXG4gICAgICBtb2RlbC5wcmVkaWN0RW5hYmxlZFByb3BlcnR5LFxyXG4gICAgICBtb2RlbC5pbnRlcmFjdGl2ZUN1cnZlUHJvcGVydHksXHJcbiAgICAgIGNvbWJpbmVPcHRpb25zPENhbGN1bHVzR3JhcGhlckNvbnRyb2xQYW5lbE9wdGlvbnM+KCB7XHJcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdjb250cm9sUGFuZWwnIClcclxuICAgICAgfSwgb3B0aW9ucy5jb250cm9sUGFuZWxPcHRpb25zICkgKTtcclxuXHJcbiAgICB0aGlzLmNoZWNrYm94R3JvdXAgPSBuZXcgQ2FsY3VsdXNHcmFwaGVyQ2hlY2tib3hHcm91cCggbW9kZWwuZ3JpZFZpc2libGVQcm9wZXJ0eSxcclxuICAgICAgbW9kZWwucmVmZXJlbmNlTGluZS52aXNpYmxlUHJvcGVydHksIG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2NoZWNrYm94R3JvdXAnICkgKTtcclxuXHJcbiAgICBjb25zdCByaWdodFZCb3ggPSBuZXcgVkJveCgge1xyXG4gICAgICBjaGlsZHJlbjogWyBjb250cm9sUGFuZWwsIHRoaXMuY2hlY2tib3hHcm91cCBdLFxyXG4gICAgICBzcGFjaW5nOiAyMCxcclxuICAgICAgYWxpZ246ICdsZWZ0J1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZ3JhcGhzTm9kZSA9IG5ldyBHcmFwaHNOb2RlKCBtb2RlbCwge1xyXG4gICAgICBjZW50ZXJYOiB0aGlzLmxheW91dEJvdW5kcy5jZW50ZXJYIC0gMjUsXHJcbiAgICAgIHk6IHRoaXMubGF5b3V0Qm91bmRzLnRvcCArIDQwLFxyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2dyYXBoc05vZGUnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBQdXQgY29udHJvbCBwYW5lbCBpbiB0aGUgbmVnYXRpdmUgc3BhY2UgdG8gdGhlIHJpZ2h0IG9mIHRoZSBDaGFydFJlY3RhbmdsZXMsIHRvcC1hbGlnbmVkIHdpdGggZ3JhcGhzTm9kZS55LlxyXG4gICAgcmlnaHRWQm94LmJvdW5kc1Byb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgICAgY29uc3QgY2hhcnRSZWN0YW5nbGVSaWdodCA9IHRoaXMuZ3JhcGhzTm9kZS54ICsgQ2FsY3VsdXNHcmFwaGVyQ29uc3RhbnRzLkNIQVJUX1JFQ1RBTkdMRV9XSURUSDtcclxuICAgICAgcmlnaHRWQm94LmNlbnRlclggPSB0aGlzLmxheW91dEJvdW5kcy5yaWdodCAtICggdGhpcy5sYXlvdXRCb3VuZHMucmlnaHQgLSBjaGFydFJlY3RhbmdsZVJpZ2h0ICkgLyAyO1xyXG4gICAgICByaWdodFZCb3gudG9wID0gdGhpcy5ncmFwaHNOb2RlLnk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgY29uc3QgY2hpbGRyZW46IE5vZGVbXSA9IFtcclxuICAgICAgdGhpcy5ncmFwaHNOb2RlLFxyXG4gICAgICByaWdodFZCb3gsXHJcbiAgICAgIHJlc2V0QWxsQnV0dG9uXHJcbiAgICBdO1xyXG5cclxuICAgIGlmICggb3B0aW9ucy5ncmFwaFNldFJhZGlvQnV0dG9uR3JvdXBJdGVtcy5sZW5ndGggPiAwICkge1xyXG4gICAgICBjb25zdCBncmFwaFNldFJhZGlvQnV0dG9uR3JvdXAgPSBuZXcgR3JhcGhTZXRSYWRpb0J1dHRvbkdyb3VwKCBtb2RlbC5ncmFwaFNldFByb3BlcnR5LFxyXG4gICAgICAgIG9wdGlvbnMuZ3JhcGhTZXRSYWRpb0J1dHRvbkdyb3VwSXRlbXMsIG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2dyYXBoU2V0UmFkaW9CdXR0b25Hcm91cCcgKSApO1xyXG4gICAgICBjaGlsZHJlbi5wdXNoKCBncmFwaFNldFJhZGlvQnV0dG9uR3JvdXAgKTtcclxuXHJcbiAgICAgIC8vIENlbnRlciBncmFwaFNldFJhZGlvQnV0dG9uR3JvdXAgaW4gdGhlIG5lZ2F0aXZlIHNwYWNlIHRvIHRoZSBsZWZ0IG9mIGdyYXBoTm9kZS4gV2UncmUgb25seSBhZGp1c3RpbmcgY2VudGVyWFxyXG4gICAgICAvLyBkeW5hbWljYWxseSBzbyB0aGF0IEdyYXBoU2V0c0FuaW1hdGlvbiBkb2Vzbid0IGNhdXNlIHRpbnkgc2hpZnRzIGluIHkuXHJcbiAgICAgIGdyYXBoU2V0UmFkaW9CdXR0b25Hcm91cC5jZW50ZXJZID0gdGhpcy5ncmFwaHNOb2RlLmNlbnRlclk7XHJcbiAgICAgIHRoaXMuZ3JhcGhzTm9kZS5ib3VuZHNQcm9wZXJ0eS5saW5rKCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZXllVG9nZ2xlQnV0dG9uTGVmdCA9IHRoaXMuZ3JhcGhzTm9kZS54ICsgdGhpcy5ncmFwaHNOb2RlLmdldEV5ZVRvZ2dsZUJ1dHRvblhPZmZzZXQoKTtcclxuICAgICAgICBncmFwaFNldFJhZGlvQnV0dG9uR3JvdXAuY2VudGVyWCA9IHRoaXMubGF5b3V0Qm91bmRzLmxlZnQgKyAoIGV5ZVRvZ2dsZUJ1dHRvbkxlZnQgLSB0aGlzLmxheW91dEJvdW5kcy5sZWZ0ICkgLyAyO1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zY3JlZW5WaWV3Um9vdE5vZGUgPSBuZXcgTm9kZSgge1xyXG4gICAgICBjaGlsZHJlbjogY2hpbGRyZW5cclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuc2NyZWVuVmlld1Jvb3ROb2RlICk7XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXQgYWxsXHJcbiAgICovXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5tb2RlbC5yZXNldCgpO1xyXG4gICAgdGhpcy5ncmFwaHNOb2RlLnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgc3RlcCggZHQ6IG51bWJlciApOiB2b2lkIHtcclxuICAgIHRoaXMuZ3JhcGhzTm9kZS5zdGVwKCBkdCApO1xyXG4gICAgc3VwZXIuc3RlcCggZHQgKTtcclxuICB9XHJcbn1cclxuXHJcbmNhbGN1bHVzR3JhcGhlci5yZWdpc3RlciggJ0NhbGN1bHVzR3JhcGhlclNjcmVlblZpZXcnLCBDYWxjdWx1c0dyYXBoZXJTY3JlZW5WaWV3ICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsVUFBVSxNQUE2QixvQ0FBb0M7QUFDbEYsT0FBT0MsZUFBZSxNQUFNLDBCQUEwQjtBQUV0RCxPQUFPQywyQkFBMkIsTUFBOEMsa0NBQWtDO0FBQ2xILE9BQU9DLFNBQVMsSUFBSUMsY0FBYyxRQUFRLHVDQUF1QztBQUNqRixPQUFPQyxjQUFjLE1BQU0sdURBQXVEO0FBQ2xGLE9BQU9DLFVBQVUsTUFBTSxpQkFBaUI7QUFDeEMsT0FBT0MsNEJBQTRCLE1BQU0sbUNBQW1DO0FBRTVFLE9BQU9DLHdCQUF3QixNQUF3QywrQkFBK0I7QUFDdEcsU0FBU0MsSUFBSSxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQzlELE9BQU9DLHdCQUF3QixNQUFNLGdDQUFnQztBQWNyRSxlQUFlLE1BQU1DLHlCQUF5QixTQUFTWixVQUFVLENBQUM7RUFJaEU7O0VBR0E7O0VBR0E7RUFDQTtFQUdVYSxXQUFXQSxDQUFFQyxLQUEyQixFQUFFQyxlQUFpRCxFQUFHO0lBRXRHLE1BQU1DLE9BQU8sR0FBR2IsU0FBUyxDQUVKLENBQUMsQ0FBRTtNQUV0QjtNQUNBYyw2QkFBNkIsRUFBRTtJQUNqQyxD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