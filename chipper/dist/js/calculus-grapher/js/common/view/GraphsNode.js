// Copyright 2022-2023, University of Colorado Boulder

/**
 * GraphsNode is responsible for all graphs, animation between 'graph sets', the reference line, scrubbers,
 * labeled lines, labeled points.  The origin (0,0) is at this.graphSetNode.leftTop, the upper-left corner
 * of the top GraphNode's ChartRectangle,
 *
 * @author Martin Veillette
 * @author Chris Malley (PixelZoom, Inc.)
 */

import calculusGrapher from '../../calculusGrapher.js';
import GraphNode from './GraphNode.js';
import optionize from '../../../../phet-core/js/optionize.js';
import { Node } from '../../../../scenery/js/imports.js';
import CalculusGrapherConstants from '../CalculusGrapherConstants.js';
import OriginalGraphNode from './OriginalGraphNode.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import ReferenceLineNode from './ReferenceLineNode.js';
import GraphType from '../model/GraphType.js';
import CalculusGrapherColors from '../CalculusGrapherColors.js';
import LabeledLinesNode from './LabeledLinesNode.js';
import GraphSet from '../model/GraphSet.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import GraphSetsAnimator from './GraphSetsAnimator.js';
import CalculusGrapherPreferences from '../model/CalculusGrapherPreferences.js';
import AreaUnderCurveScrubberNode from './AreaUnderCurveScrubberNode.js';
import TangentScrubberNode from './TangentScrubberNode.js';
const GRAPH_NODE_Y_SPACING = 20; // vertical space between GraphNode instances, in view coordinates

export default class GraphsNode extends Node {
  // An OriginalGraphNode is always present, because the student interacts with curves in the graph.

  // These GraphNodes will be conditionally created, based on whether they appear in model.graphSets.

  // For iterating over all GraphNode instances

  // The parent for all GraphNode instances that are part model.graphSetProperty.value

  // Height of the ChartRectangles, in view coordinates

  // A reference line that extends vertically through all graphs

  // Vertical lines that pass through all graphs and follow the x position of a scrubber

  constructor(model, providedOptions) {
    const options = optionize()({
      // NodeOptions
      phetioVisiblePropertyInstrumented: false
    }, providedOptions);
    super();

    // The view height of the graph's chartRectangle, based on the number of visible graphs.
    this.chartRectangleHeight = CalculusGrapherConstants.SINGLE_CHART_RECTANGLE_HEIGHT / model.graphSetProperty.value.length;

    // OriginalGraphNode is always instrumented, because it should always be present.
    this.originalGraphNode = new OriginalGraphNode(model, {
      chartRectangleHeight: this.chartRectangleHeight,
      tandem: options.tandem.createTandem('originalGraphNode')
    });
    this.graphNodes = [this.originalGraphNode];

    // Conditionally create the GraphNodes for the derived curves, if they are in model.graphSets.
    if (GraphSet.includes(model.graphSets, GraphType.INTEGRAL)) {
      this.integralGraphNode = new GraphNode(GraphType.INTEGRAL, model.integralCurve, model.gridVisibleProperty, {
        chartRectangleHeight: this.chartRectangleHeight,
        tandem: options.tandem.createTandem('integralGraphNode')
      });
      this.graphNodes.push(this.integralGraphNode);
    }
    if (GraphSet.includes(model.graphSets, GraphType.DERIVATIVE)) {
      this.derivativeGraphNode = new GraphNode(GraphType.DERIVATIVE, model.derivativeCurve, model.gridVisibleProperty, {
        chartRectangleHeight: this.chartRectangleHeight,
        tandem: options.tandem.createTandem('derivativeGraphNode')
      });
      this.graphNodes.push(this.derivativeGraphNode);
    }
    if (GraphSet.includes(model.graphSets, GraphType.SECOND_DERIVATIVE)) {
      this.secondDerivativeGraphNode = new GraphNode(GraphType.SECOND_DERIVATIVE, model.secondDerivativeCurve, model.gridVisibleProperty, {
        chartRectangleHeight: this.chartRectangleHeight,
        tandem: options.tandem.createTandem('secondDerivativeGraphNode')
      });
      this.graphNodes.push(this.secondDerivativeGraphNode);
    }
    this.graphSetNode = new Node();

    // graphSetsAnimator is only PhET-iO instrumented if we have more than one GraphSet. If there is only one
    // graphSet, then it exists to put that GraphSet in its correct position, and then it never changes.
    this.graphSetsAnimator = new GraphSetsAnimator(model.graphSets.length > 1 ? options.tandem.createTandem('graphSetsAnimator') : Tandem.OPT_OUT);

    // To display a different set of graphs, get the GraphsNode, handle their layout, and adjust the position
    // of the reference line and labeled lines.
    model.graphSetProperty.link((newGraphSet, oldGraphSet) => {
      assert && assert(oldGraphSet === null || newGraphSet.length === oldGraphSet.length, 'graph sets must have the same length');

      // Interrupt any interactions that are in-progress.
      this.interruptSubtreeInput();

      // Get the GraphNode instances for the old and new GraphSets.
      const oldGraphNodes = oldGraphSet ? this.getGraphNodes(oldGraphSet) : null;
      const newGraphNodes = this.getGraphNodes(newGraphSet);
      this.graphSetsAnimator.changeGraphSets(this.graphSetNode, oldGraphNodes, newGraphNodes, this.chartRectangleHeight, GRAPH_NODE_Y_SPACING);
    });

    // Reference Line, length adjusted depending on whether values are visible.
    this.referenceLineNode = new ReferenceLineNode(model.referenceLine, this.originalGraphNode.chartTransform, options.tandem.createTandem('referenceLineNode'));
    CalculusGrapherPreferences.valuesVisibleProperty.link(() => {
      const top = this.getChartRectanglesTop() - (CalculusGrapherPreferences.valuesVisibleProperty.value ? 10 : 0);
      const bottom = this.getChartRectanglesBottom() + 26; // long enough to avoid overlapping other scrubbers
      this.referenceLineNode.setLineTopAndBottom(top, bottom);
    });

    // Labeled Lines
    const labeledLinesNode = new LabeledLinesNode(model.labeledLines, model.labeledLinesLinkableElement, this.originalGraphNode.chartTransform, {
      labeledLineOptions: {
        lineTop: this.getChartRectanglesTop() - 13,
        lineBottom: this.getChartRectanglesBottom()
      },
      tandem: options.tandem.createTandem('labeledLinesNode')
    });

    // Parent for optional scrubbers, to maintain rendering order.
    this.scrubberNodesParent = new Node();
    options.children = [this.graphSetNode, this.scrubberNodesParent, labeledLinesNode, this.referenceLineNode];
    this.mutate(options);
    this.addLinkedElement(model.graphSetProperty, {
      tandem: options.tandem.createTandem(model.graphSetProperty.tandem.name)
    });
  }
  reset() {
    this.graphNodes.forEach(graphNode => graphNode.reset());
  }
  step(dt) {
    this.graphSetsAnimator.step(dt);
  }

  /**
   * Gets the GraphNode instances that correspond to graphSet, in the same order as graphSet.
   */
  getGraphNodes(graphSet) {
    return graphSet.graphTypes.map(graphType => {
      const graphNode = _.find(this.graphNodes, graphNode => graphNode.graphType === graphType);
      assert && assert(graphNode, `expected a GraphNode for graphType=${graphType}`);
      return graphNode;
    });
  }

  /**
   * Gets the y coordinate of the top of the top-most ChartRectangle.
   */
  getChartRectanglesTop() {
    return this.graphSetNode.y;
  }

  /**
   * Gets the y coordinate of the bottom of the bottom-most ChartRectangle.
   */
  getChartRectanglesBottom() {
    const numberOfGraphNodes = this.graphSetNode.getChildrenCount();
    return this.getChartRectanglesTop() + numberOfGraphNodes * this.chartRectangleHeight + (numberOfGraphNodes - 1) * GRAPH_NODE_Y_SPACING;
  }

  /**
   * Gets the offset of the EyeToggleButton from the left edge of the ChartRectangle. This is used for dynamic layout.
   * It is the same for all GraphNodes, so use the first one.
   */
  getEyeToggleButtonXOffset() {
    return this.graphNodes[0].getEyeToggleButtonXOffset();
  }

  /**
   * Adds the tangent feature to this collection of graphs.
   */
  addTangentView(tangentScrubber, predictEnabledProperty) {
    const derivativeGraphNode = this.derivativeGraphNode;
    assert && assert(derivativeGraphNode);

    // Determines whether the tangent scrubber, tangent line, and associated points are visible on the graphs.
    const tangentVisibleProperty = new DerivedProperty([tangentScrubber.visibleProperty, predictEnabledProperty], (tangentScrubberVisible, predictEnabled) => tangentScrubberVisible && !predictEnabled, {
      // No PhET-iO instrumentation because this is more complicated than is useful for clients.
    });

    // Add the scrubber
    const tangentScrubberNode = new TangentScrubberNode(tangentScrubber, this.originalGraphNode.chartTransform, {
      lineTop: this.getChartRectanglesTop(),
      lineBottom: this.getChartRectanglesBottom(),
      visibleProperty: tangentVisibleProperty,
      tandem: this.tandem.createTandem('tangentScrubberNode')
    });
    this.scrubberNodesParent.addChild(tangentScrubberNode);

    // Add the double-headed tangent arrow at the tangent point on the original graph.
    this.originalGraphNode.addTangentArrowNode(tangentScrubber, tangentVisibleProperty);

    // Plot a point on the derivative graph, to show the point that corresponds to the slope of the tangent.
    this.addPlottedPoint(tangentScrubber, tangentVisibleProperty, derivativeGraphNode, tangentScrubber.derivativeCurvePointProperty, CalculusGrapherColors.derivativeCurveStrokeProperty, 'tangentPointNode');
  }

  /**
   * Adds the 'area under curve' feature to this collection of graphs.
   */
  addAreaUnderCurveView(areaUnderCurveScrubber, predictEnabledProperty) {
    const integralGraphNode = this.integralGraphNode;
    assert && assert(integralGraphNode);

    // Determines whether the area-under-curve scrubber, plot, and associated points are visible on the graphs.
    const areaUnderCurveVisibleProperty = new DerivedProperty([areaUnderCurveScrubber.visibleProperty, predictEnabledProperty], (tangentScrubberVisible, predictEnabled) => tangentScrubberVisible && !predictEnabled, {
      // No PhET-iO instrumentation because this is more complicated than is useful for clients.
    });

    // Add the scrubber
    const areaUnderCurveScrubberNode = new AreaUnderCurveScrubberNode(areaUnderCurveScrubber, this.originalGraphNode.chartTransform, {
      lineTop: this.getChartRectanglesTop(),
      lineBottom: this.getChartRectanglesBottom(),
      visibleProperty: areaUnderCurveVisibleProperty,
      tandem: this.tandem.createTandem('areaUnderCurveScrubberNode')
    });
    this.scrubberNodesParent.addChild(areaUnderCurveScrubberNode);

    // Add a plot of the area under the curve on the original graph.
    this.originalGraphNode.addAreaUnderCurvePlot(areaUnderCurveScrubber, areaUnderCurveVisibleProperty);

    // Plot a point on the integral graph, to show the point that corresponds to the area under the curve.
    this.addPlottedPoint(areaUnderCurveScrubber, areaUnderCurveVisibleProperty, integralGraphNode, areaUnderCurveScrubber.integralCurvePointProperty, CalculusGrapherColors.integralCurveStrokeProperty, 'areaUnderCurvePointNode');
  }

  /**
   * Adds a PlottedPoint to a specific graph.
   */
  addPlottedPoint(ancillaryTool, visibleProperty, graphNode, curvePointProperty, fill, tandemName) {
    const plottedPoint = graphNode.addPlottedPoint(curvePointProperty, fill, visibleProperty, tandemName);
    plottedPoint.addLinkedElement(ancillaryTool, {
      tandem: plottedPoint.tandem.createTandem(ancillaryTool.tandem.name)
    });
  }
}
calculusGrapher.register('GraphsNode', GraphsNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjYWxjdWx1c0dyYXBoZXIiLCJHcmFwaE5vZGUiLCJvcHRpb25pemUiLCJOb2RlIiwiQ2FsY3VsdXNHcmFwaGVyQ29uc3RhbnRzIiwiT3JpZ2luYWxHcmFwaE5vZGUiLCJUYW5kZW0iLCJSZWZlcmVuY2VMaW5lTm9kZSIsIkdyYXBoVHlwZSIsIkNhbGN1bHVzR3JhcGhlckNvbG9ycyIsIkxhYmVsZWRMaW5lc05vZGUiLCJHcmFwaFNldCIsIkRlcml2ZWRQcm9wZXJ0eSIsIkdyYXBoU2V0c0FuaW1hdG9yIiwiQ2FsY3VsdXNHcmFwaGVyUHJlZmVyZW5jZXMiLCJBcmVhVW5kZXJDdXJ2ZVNjcnViYmVyTm9kZSIsIlRhbmdlbnRTY3J1YmJlck5vZGUiLCJHUkFQSF9OT0RFX1lfU1BBQ0lORyIsIkdyYXBoc05vZGUiLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsInBoZXRpb1Zpc2libGVQcm9wZXJ0eUluc3RydW1lbnRlZCIsImNoYXJ0UmVjdGFuZ2xlSGVpZ2h0IiwiU0lOR0xFX0NIQVJUX1JFQ1RBTkdMRV9IRUlHSFQiLCJncmFwaFNldFByb3BlcnR5IiwidmFsdWUiLCJsZW5ndGgiLCJvcmlnaW5hbEdyYXBoTm9kZSIsInRhbmRlbSIsImNyZWF0ZVRhbmRlbSIsImdyYXBoTm9kZXMiLCJpbmNsdWRlcyIsImdyYXBoU2V0cyIsIklOVEVHUkFMIiwiaW50ZWdyYWxHcmFwaE5vZGUiLCJpbnRlZ3JhbEN1cnZlIiwiZ3JpZFZpc2libGVQcm9wZXJ0eSIsInB1c2giLCJERVJJVkFUSVZFIiwiZGVyaXZhdGl2ZUdyYXBoTm9kZSIsImRlcml2YXRpdmVDdXJ2ZSIsIlNFQ09ORF9ERVJJVkFUSVZFIiwic2Vjb25kRGVyaXZhdGl2ZUdyYXBoTm9kZSIsInNlY29uZERlcml2YXRpdmVDdXJ2ZSIsImdyYXBoU2V0Tm9kZSIsImdyYXBoU2V0c0FuaW1hdG9yIiwiT1BUX09VVCIsImxpbmsiLCJuZXdHcmFwaFNldCIsIm9sZEdyYXBoU2V0IiwiYXNzZXJ0IiwiaW50ZXJydXB0U3VidHJlZUlucHV0Iiwib2xkR3JhcGhOb2RlcyIsImdldEdyYXBoTm9kZXMiLCJuZXdHcmFwaE5vZGVzIiwiY2hhbmdlR3JhcGhTZXRzIiwicmVmZXJlbmNlTGluZU5vZGUiLCJyZWZlcmVuY2VMaW5lIiwiY2hhcnRUcmFuc2Zvcm0iLCJ2YWx1ZXNWaXNpYmxlUHJvcGVydHkiLCJ0b3AiLCJnZXRDaGFydFJlY3RhbmdsZXNUb3AiLCJib3R0b20iLCJnZXRDaGFydFJlY3RhbmdsZXNCb3R0b20iLCJzZXRMaW5lVG9wQW5kQm90dG9tIiwibGFiZWxlZExpbmVzTm9kZSIsImxhYmVsZWRMaW5lcyIsImxhYmVsZWRMaW5lc0xpbmthYmxlRWxlbWVudCIsImxhYmVsZWRMaW5lT3B0aW9ucyIsImxpbmVUb3AiLCJsaW5lQm90dG9tIiwic2NydWJiZXJOb2Rlc1BhcmVudCIsImNoaWxkcmVuIiwibXV0YXRlIiwiYWRkTGlua2VkRWxlbWVudCIsIm5hbWUiLCJyZXNldCIsImZvckVhY2giLCJncmFwaE5vZGUiLCJzdGVwIiwiZHQiLCJncmFwaFNldCIsImdyYXBoVHlwZXMiLCJtYXAiLCJncmFwaFR5cGUiLCJfIiwiZmluZCIsInkiLCJudW1iZXJPZkdyYXBoTm9kZXMiLCJnZXRDaGlsZHJlbkNvdW50IiwiZ2V0RXllVG9nZ2xlQnV0dG9uWE9mZnNldCIsImFkZFRhbmdlbnRWaWV3IiwidGFuZ2VudFNjcnViYmVyIiwicHJlZGljdEVuYWJsZWRQcm9wZXJ0eSIsInRhbmdlbnRWaXNpYmxlUHJvcGVydHkiLCJ2aXNpYmxlUHJvcGVydHkiLCJ0YW5nZW50U2NydWJiZXJWaXNpYmxlIiwicHJlZGljdEVuYWJsZWQiLCJ0YW5nZW50U2NydWJiZXJOb2RlIiwiYWRkQ2hpbGQiLCJhZGRUYW5nZW50QXJyb3dOb2RlIiwiYWRkUGxvdHRlZFBvaW50IiwiZGVyaXZhdGl2ZUN1cnZlUG9pbnRQcm9wZXJ0eSIsImRlcml2YXRpdmVDdXJ2ZVN0cm9rZVByb3BlcnR5IiwiYWRkQXJlYVVuZGVyQ3VydmVWaWV3IiwiYXJlYVVuZGVyQ3VydmVTY3J1YmJlciIsImFyZWFVbmRlckN1cnZlVmlzaWJsZVByb3BlcnR5IiwiYXJlYVVuZGVyQ3VydmVTY3J1YmJlck5vZGUiLCJhZGRBcmVhVW5kZXJDdXJ2ZVBsb3QiLCJpbnRlZ3JhbEN1cnZlUG9pbnRQcm9wZXJ0eSIsImludGVncmFsQ3VydmVTdHJva2VQcm9wZXJ0eSIsImFuY2lsbGFyeVRvb2wiLCJjdXJ2ZVBvaW50UHJvcGVydHkiLCJmaWxsIiwidGFuZGVtTmFtZSIsInBsb3R0ZWRQb2ludCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiR3JhcGhzTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMi0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBHcmFwaHNOb2RlIGlzIHJlc3BvbnNpYmxlIGZvciBhbGwgZ3JhcGhzLCBhbmltYXRpb24gYmV0d2VlbiAnZ3JhcGggc2V0cycsIHRoZSByZWZlcmVuY2UgbGluZSwgc2NydWJiZXJzLFxyXG4gKiBsYWJlbGVkIGxpbmVzLCBsYWJlbGVkIHBvaW50cy4gIFRoZSBvcmlnaW4gKDAsMCkgaXMgYXQgdGhpcy5ncmFwaFNldE5vZGUubGVmdFRvcCwgdGhlIHVwcGVyLWxlZnQgY29ybmVyXHJcbiAqIG9mIHRoZSB0b3AgR3JhcGhOb2RlJ3MgQ2hhcnRSZWN0YW5nbGUsXHJcbiAqXHJcbiAqIEBhdXRob3IgTWFydGluIFZlaWxsZXR0ZVxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBjYWxjdWx1c0dyYXBoZXIgZnJvbSAnLi4vLi4vY2FsY3VsdXNHcmFwaGVyLmpzJztcclxuaW1wb3J0IENhbGN1bHVzR3JhcGhlck1vZGVsIGZyb20gJy4uL21vZGVsL0NhbGN1bHVzR3JhcGhlck1vZGVsLmpzJztcclxuaW1wb3J0IEdyYXBoTm9kZSBmcm9tICcuL0dyYXBoTm9kZS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgeyBOb2RlLCBOb2RlT3B0aW9ucywgVENvbG9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IENhbGN1bHVzR3JhcGhlckNvbnN0YW50cyBmcm9tICcuLi9DYWxjdWx1c0dyYXBoZXJDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBPcmlnaW5hbEdyYXBoTm9kZSBmcm9tICcuL09yaWdpbmFsR3JhcGhOb2RlLmpzJztcclxuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcclxuaW1wb3J0IFN0cmljdE9taXQgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1N0cmljdE9taXQuanMnO1xyXG5pbXBvcnQgUmVmZXJlbmNlTGluZU5vZGUgZnJvbSAnLi9SZWZlcmVuY2VMaW5lTm9kZS5qcyc7XHJcbmltcG9ydCBUYW5nZW50U2NydWJiZXIgZnJvbSAnLi4vbW9kZWwvVGFuZ2VudFNjcnViYmVyLmpzJztcclxuaW1wb3J0IEFyZWFVbmRlckN1cnZlU2NydWJiZXIgZnJvbSAnLi4vbW9kZWwvQXJlYVVuZGVyQ3VydmVTY3J1YmJlci5qcyc7XHJcbmltcG9ydCBBbmNpbGxhcnlUb29sIGZyb20gJy4uL21vZGVsL0FuY2lsbGFyeVRvb2wuanMnO1xyXG5pbXBvcnQgR3JhcGhUeXBlIGZyb20gJy4uL21vZGVsL0dyYXBoVHlwZS5qcyc7XHJcbmltcG9ydCBDYWxjdWx1c0dyYXBoZXJDb2xvcnMgZnJvbSAnLi4vQ2FsY3VsdXNHcmFwaGVyQ29sb3JzLmpzJztcclxuaW1wb3J0IExhYmVsZWRMaW5lc05vZGUgZnJvbSAnLi9MYWJlbGVkTGluZXNOb2RlLmpzJztcclxuaW1wb3J0IEdyYXBoU2V0IGZyb20gJy4uL21vZGVsL0dyYXBoU2V0LmpzJztcclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBHcmFwaFNldHNBbmltYXRvciBmcm9tICcuL0dyYXBoU2V0c0FuaW1hdG9yLmpzJztcclxuaW1wb3J0IENhbGN1bHVzR3JhcGhlclByZWZlcmVuY2VzIGZyb20gJy4uL21vZGVsL0NhbGN1bHVzR3JhcGhlclByZWZlcmVuY2VzLmpzJztcclxuaW1wb3J0IEN1cnZlUG9pbnQgZnJvbSAnLi4vbW9kZWwvQ3VydmVQb2ludC5qcyc7XHJcbmltcG9ydCBBcmVhVW5kZXJDdXJ2ZVNjcnViYmVyTm9kZSBmcm9tICcuL0FyZWFVbmRlckN1cnZlU2NydWJiZXJOb2RlLmpzJztcclxuaW1wb3J0IFRhbmdlbnRTY3J1YmJlck5vZGUgZnJvbSAnLi9UYW5nZW50U2NydWJiZXJOb2RlLmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuXHJcbmNvbnN0IEdSQVBIX05PREVfWV9TUEFDSU5HID0gMjA7IC8vIHZlcnRpY2FsIHNwYWNlIGJldHdlZW4gR3JhcGhOb2RlIGluc3RhbmNlcywgaW4gdmlldyBjb29yZGluYXRlc1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IEVtcHR5U2VsZk9wdGlvbnM7XHJcblxyXG50eXBlIEdyYXBoc05vZGVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBTdHJpY3RPbWl0PE5vZGVPcHRpb25zLCAnY2hpbGRyZW4nPiAmIFBpY2tSZXF1aXJlZDxOb2RlT3B0aW9ucywgJ3RhbmRlbSc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR3JhcGhzTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvLyBBbiBPcmlnaW5hbEdyYXBoTm9kZSBpcyBhbHdheXMgcHJlc2VudCwgYmVjYXVzZSB0aGUgc3R1ZGVudCBpbnRlcmFjdHMgd2l0aCBjdXJ2ZXMgaW4gdGhlIGdyYXBoLlxyXG4gIHB1YmxpYyByZWFkb25seSBvcmlnaW5hbEdyYXBoTm9kZTogT3JpZ2luYWxHcmFwaE5vZGU7XHJcblxyXG4gIC8vIFRoZXNlIEdyYXBoTm9kZXMgd2lsbCBiZSBjb25kaXRpb25hbGx5IGNyZWF0ZWQsIGJhc2VkIG9uIHdoZXRoZXIgdGhleSBhcHBlYXIgaW4gbW9kZWwuZ3JhcGhTZXRzLlxyXG4gIHByaXZhdGUgcmVhZG9ubHkgaW50ZWdyYWxHcmFwaE5vZGU/OiBHcmFwaE5vZGU7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBkZXJpdmF0aXZlR3JhcGhOb2RlPzogR3JhcGhOb2RlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgc2Vjb25kRGVyaXZhdGl2ZUdyYXBoTm9kZT86IEdyYXBoTm9kZTtcclxuXHJcbiAgLy8gRm9yIGl0ZXJhdGluZyBvdmVyIGFsbCBHcmFwaE5vZGUgaW5zdGFuY2VzXHJcbiAgcHJpdmF0ZSByZWFkb25seSBncmFwaE5vZGVzOiBHcmFwaE5vZGVbXTtcclxuXHJcbiAgLy8gVGhlIHBhcmVudCBmb3IgYWxsIEdyYXBoTm9kZSBpbnN0YW5jZXMgdGhhdCBhcmUgcGFydCBtb2RlbC5ncmFwaFNldFByb3BlcnR5LnZhbHVlXHJcbiAgcHJpdmF0ZSByZWFkb25seSBncmFwaFNldE5vZGU6IE5vZGU7XHJcblxyXG4gIC8vIEhlaWdodCBvZiB0aGUgQ2hhcnRSZWN0YW5nbGVzLCBpbiB2aWV3IGNvb3JkaW5hdGVzXHJcbiAgcHJpdmF0ZSByZWFkb25seSBjaGFydFJlY3RhbmdsZUhlaWdodDogbnVtYmVyO1xyXG5cclxuICAvLyBBIHJlZmVyZW5jZSBsaW5lIHRoYXQgZXh0ZW5kcyB2ZXJ0aWNhbGx5IHRocm91Z2ggYWxsIGdyYXBoc1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVmZXJlbmNlTGluZU5vZGU6IFJlZmVyZW5jZUxpbmVOb2RlO1xyXG5cclxuICAvLyBWZXJ0aWNhbCBsaW5lcyB0aGF0IHBhc3MgdGhyb3VnaCBhbGwgZ3JhcGhzIGFuZCBmb2xsb3cgdGhlIHggcG9zaXRpb24gb2YgYSBzY3J1YmJlclxyXG4gIHByaXZhdGUgcmVhZG9ubHkgc2NydWJiZXJOb2Rlc1BhcmVudDogTm9kZTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBncmFwaFNldHNBbmltYXRvcjogR3JhcGhTZXRzQW5pbWF0b3I7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbW9kZWw6IENhbGN1bHVzR3JhcGhlck1vZGVsLCBwcm92aWRlZE9wdGlvbnM6IEdyYXBoc05vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8R3JhcGhzTm9kZU9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gTm9kZU9wdGlvbnNcclxuICAgICAgcGhldGlvVmlzaWJsZVByb3BlcnR5SW5zdHJ1bWVudGVkOiBmYWxzZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICAvLyBUaGUgdmlldyBoZWlnaHQgb2YgdGhlIGdyYXBoJ3MgY2hhcnRSZWN0YW5nbGUsIGJhc2VkIG9uIHRoZSBudW1iZXIgb2YgdmlzaWJsZSBncmFwaHMuXHJcbiAgICB0aGlzLmNoYXJ0UmVjdGFuZ2xlSGVpZ2h0ID0gQ2FsY3VsdXNHcmFwaGVyQ29uc3RhbnRzLlNJTkdMRV9DSEFSVF9SRUNUQU5HTEVfSEVJR0hUIC8gbW9kZWwuZ3JhcGhTZXRQcm9wZXJ0eS52YWx1ZS5sZW5ndGg7XHJcblxyXG4gICAgLy8gT3JpZ2luYWxHcmFwaE5vZGUgaXMgYWx3YXlzIGluc3RydW1lbnRlZCwgYmVjYXVzZSBpdCBzaG91bGQgYWx3YXlzIGJlIHByZXNlbnQuXHJcbiAgICB0aGlzLm9yaWdpbmFsR3JhcGhOb2RlID0gbmV3IE9yaWdpbmFsR3JhcGhOb2RlKCBtb2RlbCwge1xyXG4gICAgICBjaGFydFJlY3RhbmdsZUhlaWdodDogdGhpcy5jaGFydFJlY3RhbmdsZUhlaWdodCxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdvcmlnaW5hbEdyYXBoTm9kZScgKVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZ3JhcGhOb2RlcyA9IFsgdGhpcy5vcmlnaW5hbEdyYXBoTm9kZSBdO1xyXG5cclxuICAgIC8vIENvbmRpdGlvbmFsbHkgY3JlYXRlIHRoZSBHcmFwaE5vZGVzIGZvciB0aGUgZGVyaXZlZCBjdXJ2ZXMsIGlmIHRoZXkgYXJlIGluIG1vZGVsLmdyYXBoU2V0cy5cclxuICAgIGlmICggR3JhcGhTZXQuaW5jbHVkZXMoIG1vZGVsLmdyYXBoU2V0cywgR3JhcGhUeXBlLklOVEVHUkFMICkgKSB7XHJcbiAgICAgIHRoaXMuaW50ZWdyYWxHcmFwaE5vZGUgPSBuZXcgR3JhcGhOb2RlKCBHcmFwaFR5cGUuSU5URUdSQUwsIG1vZGVsLmludGVncmFsQ3VydmUsIG1vZGVsLmdyaWRWaXNpYmxlUHJvcGVydHksIHtcclxuICAgICAgICBjaGFydFJlY3RhbmdsZUhlaWdodDogdGhpcy5jaGFydFJlY3RhbmdsZUhlaWdodCxcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2ludGVncmFsR3JhcGhOb2RlJyApXHJcbiAgICAgIH0gKTtcclxuICAgICAgdGhpcy5ncmFwaE5vZGVzLnB1c2goIHRoaXMuaW50ZWdyYWxHcmFwaE5vZGUgKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIEdyYXBoU2V0LmluY2x1ZGVzKCBtb2RlbC5ncmFwaFNldHMsIEdyYXBoVHlwZS5ERVJJVkFUSVZFICkgKSB7XHJcbiAgICAgIHRoaXMuZGVyaXZhdGl2ZUdyYXBoTm9kZSA9IG5ldyBHcmFwaE5vZGUoIEdyYXBoVHlwZS5ERVJJVkFUSVZFLCBtb2RlbC5kZXJpdmF0aXZlQ3VydmUsIG1vZGVsLmdyaWRWaXNpYmxlUHJvcGVydHksIHtcclxuICAgICAgICBjaGFydFJlY3RhbmdsZUhlaWdodDogdGhpcy5jaGFydFJlY3RhbmdsZUhlaWdodCxcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2Rlcml2YXRpdmVHcmFwaE5vZGUnIClcclxuICAgICAgfSApO1xyXG4gICAgICB0aGlzLmdyYXBoTm9kZXMucHVzaCggdGhpcy5kZXJpdmF0aXZlR3JhcGhOb2RlICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCBHcmFwaFNldC5pbmNsdWRlcyggbW9kZWwuZ3JhcGhTZXRzLCBHcmFwaFR5cGUuU0VDT05EX0RFUklWQVRJVkUgKSApIHtcclxuICAgICAgdGhpcy5zZWNvbmREZXJpdmF0aXZlR3JhcGhOb2RlID0gbmV3IEdyYXBoTm9kZSggR3JhcGhUeXBlLlNFQ09ORF9ERVJJVkFUSVZFLCBtb2RlbC5zZWNvbmREZXJpdmF0aXZlQ3VydmUsIG1vZGVsLmdyaWRWaXNpYmxlUHJvcGVydHksIHtcclxuICAgICAgICBjaGFydFJlY3RhbmdsZUhlaWdodDogdGhpcy5jaGFydFJlY3RhbmdsZUhlaWdodCxcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3NlY29uZERlcml2YXRpdmVHcmFwaE5vZGUnIClcclxuICAgICAgfSApO1xyXG4gICAgICB0aGlzLmdyYXBoTm9kZXMucHVzaCggdGhpcy5zZWNvbmREZXJpdmF0aXZlR3JhcGhOb2RlICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5ncmFwaFNldE5vZGUgPSBuZXcgTm9kZSgpO1xyXG5cclxuICAgIC8vIGdyYXBoU2V0c0FuaW1hdG9yIGlzIG9ubHkgUGhFVC1pTyBpbnN0cnVtZW50ZWQgaWYgd2UgaGF2ZSBtb3JlIHRoYW4gb25lIEdyYXBoU2V0LiBJZiB0aGVyZSBpcyBvbmx5IG9uZVxyXG4gICAgLy8gZ3JhcGhTZXQsIHRoZW4gaXQgZXhpc3RzIHRvIHB1dCB0aGF0IEdyYXBoU2V0IGluIGl0cyBjb3JyZWN0IHBvc2l0aW9uLCBhbmQgdGhlbiBpdCBuZXZlciBjaGFuZ2VzLlxyXG4gICAgdGhpcy5ncmFwaFNldHNBbmltYXRvciA9IG5ldyBHcmFwaFNldHNBbmltYXRvcihcclxuICAgICAgKCBtb2RlbC5ncmFwaFNldHMubGVuZ3RoID4gMSApID8gb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZ3JhcGhTZXRzQW5pbWF0b3InICkgOiBUYW5kZW0uT1BUX09VVCApO1xyXG5cclxuICAgIC8vIFRvIGRpc3BsYXkgYSBkaWZmZXJlbnQgc2V0IG9mIGdyYXBocywgZ2V0IHRoZSBHcmFwaHNOb2RlLCBoYW5kbGUgdGhlaXIgbGF5b3V0LCBhbmQgYWRqdXN0IHRoZSBwb3NpdGlvblxyXG4gICAgLy8gb2YgdGhlIHJlZmVyZW5jZSBsaW5lIGFuZCBsYWJlbGVkIGxpbmVzLlxyXG4gICAgbW9kZWwuZ3JhcGhTZXRQcm9wZXJ0eS5saW5rKCAoIG5ld0dyYXBoU2V0LCBvbGRHcmFwaFNldCApID0+IHtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggb2xkR3JhcGhTZXQgPT09IG51bGwgfHwgbmV3R3JhcGhTZXQubGVuZ3RoID09PSBvbGRHcmFwaFNldC5sZW5ndGgsXHJcbiAgICAgICAgJ2dyYXBoIHNldHMgbXVzdCBoYXZlIHRoZSBzYW1lIGxlbmd0aCcgKTtcclxuXHJcbiAgICAgIC8vIEludGVycnVwdCBhbnkgaW50ZXJhY3Rpb25zIHRoYXQgYXJlIGluLXByb2dyZXNzLlxyXG4gICAgICB0aGlzLmludGVycnVwdFN1YnRyZWVJbnB1dCgpO1xyXG5cclxuICAgICAgLy8gR2V0IHRoZSBHcmFwaE5vZGUgaW5zdGFuY2VzIGZvciB0aGUgb2xkIGFuZCBuZXcgR3JhcGhTZXRzLlxyXG4gICAgICBjb25zdCBvbGRHcmFwaE5vZGVzID0gb2xkR3JhcGhTZXQgPyB0aGlzLmdldEdyYXBoTm9kZXMoIG9sZEdyYXBoU2V0ICkgOiBudWxsO1xyXG4gICAgICBjb25zdCBuZXdHcmFwaE5vZGVzID0gdGhpcy5nZXRHcmFwaE5vZGVzKCBuZXdHcmFwaFNldCApO1xyXG5cclxuICAgICAgdGhpcy5ncmFwaFNldHNBbmltYXRvci5jaGFuZ2VHcmFwaFNldHMoIHRoaXMuZ3JhcGhTZXROb2RlLCBvbGRHcmFwaE5vZGVzLCBuZXdHcmFwaE5vZGVzLFxyXG4gICAgICAgIHRoaXMuY2hhcnRSZWN0YW5nbGVIZWlnaHQsIEdSQVBIX05PREVfWV9TUEFDSU5HICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gUmVmZXJlbmNlIExpbmUsIGxlbmd0aCBhZGp1c3RlZCBkZXBlbmRpbmcgb24gd2hldGhlciB2YWx1ZXMgYXJlIHZpc2libGUuXHJcbiAgICB0aGlzLnJlZmVyZW5jZUxpbmVOb2RlID0gbmV3IFJlZmVyZW5jZUxpbmVOb2RlKCBtb2RlbC5yZWZlcmVuY2VMaW5lLCB0aGlzLm9yaWdpbmFsR3JhcGhOb2RlLmNoYXJ0VHJhbnNmb3JtLFxyXG4gICAgICBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdyZWZlcmVuY2VMaW5lTm9kZScgKSApO1xyXG4gICAgQ2FsY3VsdXNHcmFwaGVyUHJlZmVyZW5jZXMudmFsdWVzVmlzaWJsZVByb3BlcnR5LmxpbmsoICgpID0+IHtcclxuICAgICAgY29uc3QgdG9wID0gdGhpcy5nZXRDaGFydFJlY3RhbmdsZXNUb3AoKSAtICggQ2FsY3VsdXNHcmFwaGVyUHJlZmVyZW5jZXMudmFsdWVzVmlzaWJsZVByb3BlcnR5LnZhbHVlID8gMTAgOiAwICk7XHJcbiAgICAgIGNvbnN0IGJvdHRvbSA9IHRoaXMuZ2V0Q2hhcnRSZWN0YW5nbGVzQm90dG9tKCkgKyAyNjsgIC8vIGxvbmcgZW5vdWdoIHRvIGF2b2lkIG92ZXJsYXBwaW5nIG90aGVyIHNjcnViYmVyc1xyXG4gICAgICB0aGlzLnJlZmVyZW5jZUxpbmVOb2RlLnNldExpbmVUb3BBbmRCb3R0b20oIHRvcCwgYm90dG9tICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gTGFiZWxlZCBMaW5lc1xyXG4gICAgY29uc3QgbGFiZWxlZExpbmVzTm9kZSA9IG5ldyBMYWJlbGVkTGluZXNOb2RlKCBtb2RlbC5sYWJlbGVkTGluZXMsIG1vZGVsLmxhYmVsZWRMaW5lc0xpbmthYmxlRWxlbWVudCxcclxuICAgICAgdGhpcy5vcmlnaW5hbEdyYXBoTm9kZS5jaGFydFRyYW5zZm9ybSwge1xyXG4gICAgICAgIGxhYmVsZWRMaW5lT3B0aW9uczoge1xyXG4gICAgICAgICAgbGluZVRvcDogdGhpcy5nZXRDaGFydFJlY3RhbmdsZXNUb3AoKSAtIDEzLFxyXG4gICAgICAgICAgbGluZUJvdHRvbTogdGhpcy5nZXRDaGFydFJlY3RhbmdsZXNCb3R0b20oKVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdsYWJlbGVkTGluZXNOb2RlJyApXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBQYXJlbnQgZm9yIG9wdGlvbmFsIHNjcnViYmVycywgdG8gbWFpbnRhaW4gcmVuZGVyaW5nIG9yZGVyLlxyXG4gICAgdGhpcy5zY3J1YmJlck5vZGVzUGFyZW50ID0gbmV3IE5vZGUoKTtcclxuXHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gWyB0aGlzLmdyYXBoU2V0Tm9kZSwgdGhpcy5zY3J1YmJlck5vZGVzUGFyZW50LCBsYWJlbGVkTGluZXNOb2RlLCB0aGlzLnJlZmVyZW5jZUxpbmVOb2RlIF07XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLmFkZExpbmtlZEVsZW1lbnQoIG1vZGVsLmdyYXBoU2V0UHJvcGVydHksIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oIG1vZGVsLmdyYXBoU2V0UHJvcGVydHkudGFuZGVtLm5hbWUgKVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5ncmFwaE5vZGVzLmZvckVhY2goIGdyYXBoTm9kZSA9PiBncmFwaE5vZGUucmVzZXQoKSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0ZXAoIGR0OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICB0aGlzLmdyYXBoU2V0c0FuaW1hdG9yLnN0ZXAoIGR0ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBHcmFwaE5vZGUgaW5zdGFuY2VzIHRoYXQgY29ycmVzcG9uZCB0byBncmFwaFNldCwgaW4gdGhlIHNhbWUgb3JkZXIgYXMgZ3JhcGhTZXQuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRHcmFwaE5vZGVzKCBncmFwaFNldDogR3JhcGhTZXQgKTogR3JhcGhOb2RlW10ge1xyXG4gICAgcmV0dXJuIGdyYXBoU2V0LmdyYXBoVHlwZXMubWFwKCBncmFwaFR5cGUgPT4ge1xyXG4gICAgICBjb25zdCBncmFwaE5vZGUgPSBfLmZpbmQoIHRoaXMuZ3JhcGhOb2RlcywgZ3JhcGhOb2RlID0+IGdyYXBoTm9kZS5ncmFwaFR5cGUgPT09IGdyYXBoVHlwZSApITtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggZ3JhcGhOb2RlLCBgZXhwZWN0ZWQgYSBHcmFwaE5vZGUgZm9yIGdyYXBoVHlwZT0ke2dyYXBoVHlwZX1gICk7XHJcbiAgICAgIHJldHVybiBncmFwaE5vZGU7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSB5IGNvb3JkaW5hdGUgb2YgdGhlIHRvcCBvZiB0aGUgdG9wLW1vc3QgQ2hhcnRSZWN0YW5nbGUuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRDaGFydFJlY3RhbmdsZXNUb3AoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmdyYXBoU2V0Tm9kZS55O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyB0aGUgeSBjb29yZGluYXRlIG9mIHRoZSBib3R0b20gb2YgdGhlIGJvdHRvbS1tb3N0IENoYXJ0UmVjdGFuZ2xlLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0Q2hhcnRSZWN0YW5nbGVzQm90dG9tKCk6IG51bWJlciB7XHJcbiAgICBjb25zdCBudW1iZXJPZkdyYXBoTm9kZXMgPSB0aGlzLmdyYXBoU2V0Tm9kZS5nZXRDaGlsZHJlbkNvdW50KCk7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRDaGFydFJlY3RhbmdsZXNUb3AoKSArICggbnVtYmVyT2ZHcmFwaE5vZGVzICogdGhpcy5jaGFydFJlY3RhbmdsZUhlaWdodCApICtcclxuICAgICAgICAgICAoICggbnVtYmVyT2ZHcmFwaE5vZGVzIC0gMSApICogR1JBUEhfTk9ERV9ZX1NQQUNJTkcgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIG9mZnNldCBvZiB0aGUgRXllVG9nZ2xlQnV0dG9uIGZyb20gdGhlIGxlZnQgZWRnZSBvZiB0aGUgQ2hhcnRSZWN0YW5nbGUuIFRoaXMgaXMgdXNlZCBmb3IgZHluYW1pYyBsYXlvdXQuXHJcbiAgICogSXQgaXMgdGhlIHNhbWUgZm9yIGFsbCBHcmFwaE5vZGVzLCBzbyB1c2UgdGhlIGZpcnN0IG9uZS5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0RXllVG9nZ2xlQnV0dG9uWE9mZnNldCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuZ3JhcGhOb2Rlc1sgMCBdLmdldEV5ZVRvZ2dsZUJ1dHRvblhPZmZzZXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZHMgdGhlIHRhbmdlbnQgZmVhdHVyZSB0byB0aGlzIGNvbGxlY3Rpb24gb2YgZ3JhcGhzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRUYW5nZW50VmlldyggdGFuZ2VudFNjcnViYmVyOiBUYW5nZW50U2NydWJiZXIsIHByZWRpY3RFbmFibGVkUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+ICk6IHZvaWQge1xyXG5cclxuICAgIGNvbnN0IGRlcml2YXRpdmVHcmFwaE5vZGUgPSB0aGlzLmRlcml2YXRpdmVHcmFwaE5vZGUhO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZGVyaXZhdGl2ZUdyYXBoTm9kZSApO1xyXG5cclxuICAgIC8vIERldGVybWluZXMgd2hldGhlciB0aGUgdGFuZ2VudCBzY3J1YmJlciwgdGFuZ2VudCBsaW5lLCBhbmQgYXNzb2NpYXRlZCBwb2ludHMgYXJlIHZpc2libGUgb24gdGhlIGdyYXBocy5cclxuICAgIGNvbnN0IHRhbmdlbnRWaXNpYmxlUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgICBbIHRhbmdlbnRTY3J1YmJlci52aXNpYmxlUHJvcGVydHksIHByZWRpY3RFbmFibGVkUHJvcGVydHkgXSxcclxuICAgICAgKCB0YW5nZW50U2NydWJiZXJWaXNpYmxlLCBwcmVkaWN0RW5hYmxlZCApID0+IHRhbmdlbnRTY3J1YmJlclZpc2libGUgJiYgIXByZWRpY3RFbmFibGVkLCB7XHJcbiAgICAgICAgLy8gTm8gUGhFVC1pTyBpbnN0cnVtZW50YXRpb24gYmVjYXVzZSB0aGlzIGlzIG1vcmUgY29tcGxpY2F0ZWQgdGhhbiBpcyB1c2VmdWwgZm9yIGNsaWVudHMuXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIHNjcnViYmVyXHJcbiAgICBjb25zdCB0YW5nZW50U2NydWJiZXJOb2RlID0gbmV3IFRhbmdlbnRTY3J1YmJlck5vZGUoIHRhbmdlbnRTY3J1YmJlciwgdGhpcy5vcmlnaW5hbEdyYXBoTm9kZS5jaGFydFRyYW5zZm9ybSwge1xyXG4gICAgICBsaW5lVG9wOiB0aGlzLmdldENoYXJ0UmVjdGFuZ2xlc1RvcCgpLFxyXG4gICAgICBsaW5lQm90dG9tOiB0aGlzLmdldENoYXJ0UmVjdGFuZ2xlc0JvdHRvbSgpLFxyXG4gICAgICB2aXNpYmxlUHJvcGVydHk6IHRhbmdlbnRWaXNpYmxlUHJvcGVydHksXHJcbiAgICAgIHRhbmRlbTogdGhpcy50YW5kZW0uY3JlYXRlVGFuZGVtKCAndGFuZ2VudFNjcnViYmVyTm9kZScgKVxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5zY3J1YmJlck5vZGVzUGFyZW50LmFkZENoaWxkKCB0YW5nZW50U2NydWJiZXJOb2RlICk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBkb3VibGUtaGVhZGVkIHRhbmdlbnQgYXJyb3cgYXQgdGhlIHRhbmdlbnQgcG9pbnQgb24gdGhlIG9yaWdpbmFsIGdyYXBoLlxyXG4gICAgdGhpcy5vcmlnaW5hbEdyYXBoTm9kZS5hZGRUYW5nZW50QXJyb3dOb2RlKCB0YW5nZW50U2NydWJiZXIsIHRhbmdlbnRWaXNpYmxlUHJvcGVydHkgKTtcclxuXHJcbiAgICAvLyBQbG90IGEgcG9pbnQgb24gdGhlIGRlcml2YXRpdmUgZ3JhcGgsIHRvIHNob3cgdGhlIHBvaW50IHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIHNsb3BlIG9mIHRoZSB0YW5nZW50LlxyXG4gICAgdGhpcy5hZGRQbG90dGVkUG9pbnQoIHRhbmdlbnRTY3J1YmJlciwgdGFuZ2VudFZpc2libGVQcm9wZXJ0eSwgZGVyaXZhdGl2ZUdyYXBoTm9kZSxcclxuICAgICAgdGFuZ2VudFNjcnViYmVyLmRlcml2YXRpdmVDdXJ2ZVBvaW50UHJvcGVydHksIENhbGN1bHVzR3JhcGhlckNvbG9ycy5kZXJpdmF0aXZlQ3VydmVTdHJva2VQcm9wZXJ0eSxcclxuICAgICAgJ3RhbmdlbnRQb2ludE5vZGUnICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGRzIHRoZSAnYXJlYSB1bmRlciBjdXJ2ZScgZmVhdHVyZSB0byB0aGlzIGNvbGxlY3Rpb24gb2YgZ3JhcGhzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBhZGRBcmVhVW5kZXJDdXJ2ZVZpZXcoIGFyZWFVbmRlckN1cnZlU2NydWJiZXI6IEFyZWFVbmRlckN1cnZlU2NydWJiZXIsIHByZWRpY3RFbmFibGVkUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+ICk6IHZvaWQge1xyXG5cclxuICAgIGNvbnN0IGludGVncmFsR3JhcGhOb2RlID0gdGhpcy5pbnRlZ3JhbEdyYXBoTm9kZSE7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBpbnRlZ3JhbEdyYXBoTm9kZSApO1xyXG5cclxuICAgIC8vIERldGVybWluZXMgd2hldGhlciB0aGUgYXJlYS11bmRlci1jdXJ2ZSBzY3J1YmJlciwgcGxvdCwgYW5kIGFzc29jaWF0ZWQgcG9pbnRzIGFyZSB2aXNpYmxlIG9uIHRoZSBncmFwaHMuXHJcbiAgICBjb25zdCBhcmVhVW5kZXJDdXJ2ZVZpc2libGVQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFsgYXJlYVVuZGVyQ3VydmVTY3J1YmJlci52aXNpYmxlUHJvcGVydHksIHByZWRpY3RFbmFibGVkUHJvcGVydHkgXSxcclxuICAgICAgKCB0YW5nZW50U2NydWJiZXJWaXNpYmxlLCBwcmVkaWN0RW5hYmxlZCApID0+IHRhbmdlbnRTY3J1YmJlclZpc2libGUgJiYgIXByZWRpY3RFbmFibGVkLCB7XHJcbiAgICAgICAgLy8gTm8gUGhFVC1pTyBpbnN0cnVtZW50YXRpb24gYmVjYXVzZSB0aGlzIGlzIG1vcmUgY29tcGxpY2F0ZWQgdGhhbiBpcyB1c2VmdWwgZm9yIGNsaWVudHMuXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIHNjcnViYmVyXHJcbiAgICBjb25zdCBhcmVhVW5kZXJDdXJ2ZVNjcnViYmVyTm9kZSA9IG5ldyBBcmVhVW5kZXJDdXJ2ZVNjcnViYmVyTm9kZSggYXJlYVVuZGVyQ3VydmVTY3J1YmJlciwgdGhpcy5vcmlnaW5hbEdyYXBoTm9kZS5jaGFydFRyYW5zZm9ybSwge1xyXG4gICAgICBsaW5lVG9wOiB0aGlzLmdldENoYXJ0UmVjdGFuZ2xlc1RvcCgpLFxyXG4gICAgICBsaW5lQm90dG9tOiB0aGlzLmdldENoYXJ0UmVjdGFuZ2xlc0JvdHRvbSgpLFxyXG4gICAgICB2aXNpYmxlUHJvcGVydHk6IGFyZWFVbmRlckN1cnZlVmlzaWJsZVByb3BlcnR5LFxyXG4gICAgICB0YW5kZW06IHRoaXMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2FyZWFVbmRlckN1cnZlU2NydWJiZXJOb2RlJyApXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLnNjcnViYmVyTm9kZXNQYXJlbnQuYWRkQ2hpbGQoIGFyZWFVbmRlckN1cnZlU2NydWJiZXJOb2RlICk7XHJcblxyXG4gICAgLy8gQWRkIGEgcGxvdCBvZiB0aGUgYXJlYSB1bmRlciB0aGUgY3VydmUgb24gdGhlIG9yaWdpbmFsIGdyYXBoLlxyXG4gICAgdGhpcy5vcmlnaW5hbEdyYXBoTm9kZS5hZGRBcmVhVW5kZXJDdXJ2ZVBsb3QoIGFyZWFVbmRlckN1cnZlU2NydWJiZXIsIGFyZWFVbmRlckN1cnZlVmlzaWJsZVByb3BlcnR5ICk7XHJcblxyXG4gICAgLy8gUGxvdCBhIHBvaW50IG9uIHRoZSBpbnRlZ3JhbCBncmFwaCwgdG8gc2hvdyB0aGUgcG9pbnQgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgYXJlYSB1bmRlciB0aGUgY3VydmUuXHJcbiAgICB0aGlzLmFkZFBsb3R0ZWRQb2ludCggYXJlYVVuZGVyQ3VydmVTY3J1YmJlciwgYXJlYVVuZGVyQ3VydmVWaXNpYmxlUHJvcGVydHksIGludGVncmFsR3JhcGhOb2RlLFxyXG4gICAgICBhcmVhVW5kZXJDdXJ2ZVNjcnViYmVyLmludGVncmFsQ3VydmVQb2ludFByb3BlcnR5LCBDYWxjdWx1c0dyYXBoZXJDb2xvcnMuaW50ZWdyYWxDdXJ2ZVN0cm9rZVByb3BlcnR5LFxyXG4gICAgICAnYXJlYVVuZGVyQ3VydmVQb2ludE5vZGUnICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGRzIGEgUGxvdHRlZFBvaW50IHRvIGEgc3BlY2lmaWMgZ3JhcGguXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhZGRQbG90dGVkUG9pbnQoIGFuY2lsbGFyeVRvb2w6IEFuY2lsbGFyeVRvb2wsIHZpc2libGVQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyYXBoTm9kZTogR3JhcGhOb2RlLCBjdXJ2ZVBvaW50UHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PEN1cnZlUG9pbnQ+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsOiBUQ29sb3IsIHRhbmRlbU5hbWU6IHN0cmluZyApOiB2b2lkIHtcclxuICAgIGNvbnN0IHBsb3R0ZWRQb2ludCA9IGdyYXBoTm9kZS5hZGRQbG90dGVkUG9pbnQoIGN1cnZlUG9pbnRQcm9wZXJ0eSwgZmlsbCwgdmlzaWJsZVByb3BlcnR5LCB0YW5kZW1OYW1lICk7XHJcbiAgICBwbG90dGVkUG9pbnQuYWRkTGlua2VkRWxlbWVudCggYW5jaWxsYXJ5VG9vbCwge1xyXG4gICAgICB0YW5kZW06IHBsb3R0ZWRQb2ludC50YW5kZW0uY3JlYXRlVGFuZGVtKCBhbmNpbGxhcnlUb29sLnRhbmRlbS5uYW1lIClcclxuICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbmNhbGN1bHVzR3JhcGhlci5yZWdpc3RlciggJ0dyYXBoc05vZGUnLCBHcmFwaHNOb2RlICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sMEJBQTBCO0FBRXRELE9BQU9DLFNBQVMsTUFBTSxnQkFBZ0I7QUFDdEMsT0FBT0MsU0FBUyxNQUE0Qix1Q0FBdUM7QUFDbkYsU0FBU0MsSUFBSSxRQUE2QixtQ0FBbUM7QUFDN0UsT0FBT0Msd0JBQXdCLE1BQU0sZ0NBQWdDO0FBRXJFLE9BQU9DLGlCQUFpQixNQUFNLHdCQUF3QjtBQUN0RCxPQUFPQyxNQUFNLE1BQU0saUNBQWlDO0FBRXBELE9BQU9DLGlCQUFpQixNQUFNLHdCQUF3QjtBQUl0RCxPQUFPQyxTQUFTLE1BQU0sdUJBQXVCO0FBQzdDLE9BQU9DLHFCQUFxQixNQUFNLDZCQUE2QjtBQUMvRCxPQUFPQyxnQkFBZ0IsTUFBTSx1QkFBdUI7QUFDcEQsT0FBT0MsUUFB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