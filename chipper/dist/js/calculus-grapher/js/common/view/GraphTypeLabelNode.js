// Copyright 2022-2023, University of Colorado Boulder

/**
 * GraphTypeLabelNode is the view representation for graph labels in 'Calculus Grapher'
 *
 * @author Martin Veillette
 * @author Chris Malley (PixelZoom, Inc.)
 */

import { HSeparator, Node, RichText, VBox } from '../../../../scenery/js/imports.js';
import calculusGrapher from '../../calculusGrapher.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import CalculusGrapherPreferences from '../model/CalculusGrapherPreferences.js';
import optionize from '../../../../phet-core/js/optionize.js';
import GraphType from '../model/GraphType.js';
import CalculusGrapherSymbols from '../CalculusGrapherSymbols.js';
import CalculusGrapherConstants from '../CalculusGrapherConstants.js';
import MathSymbolFont from '../../../../scenery-phet/js/MathSymbolFont.js';
const HAIR_SPACE_STRING = '\u200A';
const NOMINAL_FONT_SIZE = CalculusGrapherConstants.GRAPH_LABEL_FONT.numericSize;

// Possible prime symbols that can appear after the 'f' in 'f(x)'
const PrimeStringValues = ['', CalculusGrapherSymbols.prime, CalculusGrapherSymbols.doublePrime];
export default class GraphTypeLabelNode extends Node {
  constructor(graphType, providedOptions) {
    const options = optionize()({
      // SelfOptions
      derivativeNotationProperty: CalculusGrapherPreferences.derivativeNotationProperty,
      functionVariableProperty: CalculusGrapherPreferences.functionVariableProperty,
      fontSizeOptions: {
        nominalFontSize: NOMINAL_FONT_SIZE,
        integralSymbolFontSize: 1.5 * NOMINAL_FONT_SIZE,
        limitsFontSize: 0.5 * NOMINAL_FONT_SIZE,
        fractionFontSize: 0.75 * NOMINAL_FONT_SIZE,
        superscriptSize: 0.625 * NOMINAL_FONT_SIZE
      }
    }, providedOptions);
    super(options);

    // To improve readability
    const derivativeNotationProperty = options.derivativeNotationProperty;
    const functionVariableProperty = options.functionVariableProperty;

    // get variable as a StringProperty
    const variableStringProperty = getVariableStringProperty(functionVariableProperty);

    // create and add content for the node, based on graphType, notation and variable
    let labelNode = getLabelNode(graphType, derivativeNotationProperty.value, variableStringProperty, options.fontSizeOptions);
    this.addChild(labelNode);
    const derivationNotationListener = derivationNotation => {
      // remove and dispose previous labelNode
      labelNode.dispose();

      // create and add new label
      labelNode = getLabelNode(graphType, derivationNotation, variableStringProperty, options.fontSizeOptions);
      this.addChild(labelNode);
    };
    derivativeNotationProperty.link(derivationNotationListener);
    this.disposeGraphTypeLabelNode = () => {
      variableStringProperty.dispose();
      labelNode.dispose();
      if (derivativeNotationProperty.hasListener(derivationNotationListener)) {
        derivativeNotationProperty.unlink(derivationNotationListener);
      }
    };
  }
}

/**
 * Gets the label for the specified graph type.
 */
function getLabelNode(graphType, derivativeNotation, variableStringProperty, fontSizeOptions) {
  if (graphType === GraphType.INTEGRAL) {
    return getIntegral(variableStringProperty, fontSizeOptions);
  } else if (graphType === GraphType.ORIGINAL) {
    return getOriginal(variableStringProperty, fontSizeOptions);
  } else if (graphType === GraphType.DERIVATIVE) {
    return getDerivative(derivativeNotation, variableStringProperty, fontSizeOptions);
  } else if (graphType === GraphType.SECOND_DERIVATIVE) {
    return getSecondDerivative(derivativeNotation, variableStringProperty, fontSizeOptions);
  } else {
    throw new Error('Unsupported graphType');
  }
}

/**
 * label for f(x), f'(x) and f"(x)
 */
function getPrimeLabel(variableStringProperty, primeString, fontSizeOptions) {
  const labelStringProperty = new DerivedProperty([CalculusGrapherSymbols.fStringProperty, variableStringProperty], (f, x) => `${f}${HAIR_SPACE_STRING}${primeString}(${x})`);
  const label = new RichText(labelStringProperty, {
    font: new PhetFont(fontSizeOptions.nominalFontSize),
    maxWidth: 50
    // No PhET-iO instrumentation is desired. See https://github.com/phetsims/calculus-grapher/issues/213
  });

  // Dispose of anything that's linked to a StringProperty or ProfileColorProperty.
  label.disposeEmitter.addListener(() => {
    labelStringProperty.dispose();
  });
  return label;
}

/**
 * label for f(x)
 */
function getOriginal(variableStringProperty, fontSizeOptions) {
  return getPrimeLabel(variableStringProperty, '', fontSizeOptions);
}

/**
 * label for f'(x)
 */
function getLagrangeDerivative(variableStringProperty, fontSizeOptions) {
  return getPrimeLabel(variableStringProperty, CalculusGrapherSymbols.prime, fontSizeOptions);
}

/**
 * label for f''(x)
 */
function getLagrangeSecondDerivative(variableStringProperty, fontSizeOptions) {
  return getPrimeLabel(variableStringProperty, CalculusGrapherSymbols.doublePrime, fontSizeOptions);
}

/**
 * label for df/dx or df/dt
 */
function getLeibnizDerivative(variableStringProperty, fontSizeOptions) {
  // string for df
  const numeratorStringProperty = new DerivedProperty([CalculusGrapherSymbols.dStringProperty, CalculusGrapherSymbols.fStringProperty], (d, f) => `${d}${HAIR_SPACE_STRING}${f}`);

  // string for dx
  const denominatorStringProperty = new DerivedProperty([CalculusGrapherSymbols.dStringProperty, variableStringProperty], (d, x) => `${d}${x}`);
  const label = getFractionLabel(numeratorStringProperty, denominatorStringProperty, fontSizeOptions);

  // Dispose of anything that's linked to a StringProperty or ProfileColorProperty.
  label.disposeEmitter.addListener(() => {
    numeratorStringProperty.dispose();
    denominatorStringProperty.dispose();
  });
  return label;
}

/**
 * label for d^2f/dx^2 or d^2f/dt^2
 */
function getLeibnizSecondDerivative(variableStringProperty, fontSizeOptions) {
  const superscriptSize = fontSizeOptions.superscriptSize;
  assert && assert(superscriptSize !== undefined);

  // string for d^2 f , we need a hairspace to prevent the superscript to overlap with d
  const numeratorStringProperty = new DerivedProperty([CalculusGrapherSymbols.dStringProperty, CalculusGrapherSymbols.fStringProperty], (d, f) => `${d}${HAIR_SPACE_STRING}${getSuperScript(2, superscriptSize)}${f}`);

  // string for dx^2 , the superscript is downsized but in the same Family at the math symbols
  const denominatorStringProperty = new DerivedProperty([CalculusGrapherSymbols.dStringProperty, variableStringProperty], (d, x) => `${d}${x}${getSuperScript(2, superscriptSize)}`);
  const label = getFractionLabel(numeratorStringProperty, denominatorStringProperty, fontSizeOptions);

  // Dispose of anything that's linked to a StringProperty or ProfileColorProperty.
  label.disposeEmitter.addListener(() => {
    numeratorStringProperty.dispose();
    denominatorStringProperty.dispose();
  });
  return label;
}

/**
 * Gets a superscript, like the '2' in 'dx^2'. Note that we do not want the superscript to be in italics,
 * so we are not using MathSymbolFont.getRichTextMarkup.
 */
function getSuperScript(value, superScriptSize) {
  return `<sup style='font-size:${superScriptSize}pt; font-family:${MathSymbolFont.FAMILY}'>${value}</sup>`;
}

/**
 * Gets the derivative label, appropriate for the chose derivative notation.
 */
function getDerivative(derivativeNotation, variableStringProperty, fontSizeOptions) {
  if (derivativeNotation === 'leibniz') {
    return getLeibnizDerivative(variableStringProperty, fontSizeOptions);
  } else {
    return getLagrangeDerivative(variableStringProperty, fontSizeOptions);
  }
}

/**
 * Gets the second derivative label, appropriate for the chose derivative notation.
 */
function getSecondDerivative(derivativeNotation, variableStringProperty, fontSizeOptions) {
  if (derivativeNotation === 'leibniz') {
    return getLeibnizSecondDerivative(variableStringProperty, fontSizeOptions);
  } else {
    return getLagrangeSecondDerivative(variableStringProperty, fontSizeOptions);
  }
}

/**
 * label for \int_0^x f(x) dx or \int_0^t f(t) dt
 */
function getIntegral(variableStringProperty, fontSizeOptions) {
  // The symbol for integral
  const integralSymbolNode = new RichText(CalculusGrapherSymbols.integral, {
    font: new PhetFont(fontSizeOptions.integralSymbolFontSize),
    maxWidth: 25
    // No PhET-iO instrumentation is desired. See https://github.com/phetsims/calculus-grapher/issues/213
  });

  const limitsFont = new PhetFont(fontSizeOptions.limitsFontSize);

  // lower limit of integral
  const lowerBoundNode = new RichText('0', {
    font: limitsFont,
    maxWidth: 25
    // No PhET-iO instrumentation is desired. See https://github.com/phetsims/calculus-grapher/issues/213
  });

  // upper limit of integral
  const upperBoundNode = new RichText(variableStringProperty, {
    font: limitsFont,
    maxWidth: 25
    // No PhET-iO instrumentation is desired. See https://github.com/phetsims/calculus-grapher/issues/213
  });

  // integrand of integral: f(x)dx
  const integrandStringProperty = new DerivedProperty([CalculusGrapherSymbols.fStringProperty, variableStringProperty, CalculusGrapherSymbols.dStringProperty], (f, x, d) => `${f}${HAIR_SPACE_STRING}(${x}) ${d}${x} `);
  const integrandNode = new RichText(integrandStringProperty, {
    font: new PhetFont(fontSizeOptions.nominalFontSize),
    maxWidth: 50
    // No PhET-iO instrumentation is desired. See https://github.com/phetsims/calculus-grapher/issues/213
  });

  // laying out the various nodes
  lowerBoundNode.left = integralSymbolNode.right - 2;
  lowerBoundNode.bottom = integralSymbolNode.bottom + 3;
  upperBoundNode.left = integralSymbolNode.right + 2;
  upperBoundNode.top = integralSymbolNode.top - 5;
  integrandNode.left = upperBoundNode.right + 2;
  integrandNode.centerY = integralSymbolNode.centerY;
  const node = new Node({
    children: [lowerBoundNode, upperBoundNode, integrandNode, integralSymbolNode]
  });

  // Dispose of anything that's linked to a StringProperty or ProfileColorProperty.
  node.disposeEmitter.addListener(() => {
    integralSymbolNode.dispose();
    lowerBoundNode.dispose();
    upperBoundNode.dispose();
    integrandStringProperty.dispose();
    integrandNode.dispose();
  });
  return node;
}

/**
 * Gets a fraction node, made of a numerator and a denominator separated by a horizontal line.
 */
function getFractionLabel(numeratorStringProperty, denominatorStringProperty, fontSizeOptions) {
  const fractionFont = new PhetFont(fontSizeOptions.fractionFontSize);
  const numerator = new RichText(numeratorStringProperty, {
    font: fractionFont,
    maxWidth: 50
    // No PhET-iO instrumentation is desired. See https://github.com/phetsims/calculus-grapher/issues/213
  });

  const denominator = new RichText(denominatorStringProperty, {
    font: fractionFont,
    maxWidth: 50
    // No PhET-iO instrumentation is desired. See https://github.com/phetsims/calculus-grapher/issues/213
  });

  // horizontal line between numerator and denominator, resized automatically by VBox
  const separator = new HSeparator({
    stroke: 'black',
    lineWidth: 0.5
  });
  const vBox = new VBox({
    children: [numerator, separator, denominator]
  });

  // Dispose of anything that's linked to a StringProperty or ProfileColorProperty.
  vBox.disposeEmitter.addListener(() => {
    numerator.dispose();
    denominator.dispose();
  });
  return vBox;
}

/**
 * Get the function variable as a StringProperty (rather than StringEnumeration).
 */
function getVariableStringProperty(functionVariableProperty) {
  return new DerivedProperty([functionVariableProperty, CalculusGrapherSymbols.xStringProperty, CalculusGrapherSymbols.tStringProperty], (functionVariable, xString, tString) => functionVariable === 'x' ? xString : tString);
}
calculusGrapher.register('GraphTypeLabelNode', GraphTypeLabelNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJIU2VwYXJhdG9yIiwiTm9kZSIsIlJpY2hUZXh0IiwiVkJveCIsImNhbGN1bHVzR3JhcGhlciIsIkRlcml2ZWRQcm9wZXJ0eSIsIlBoZXRGb250IiwiQ2FsY3VsdXNHcmFwaGVyUHJlZmVyZW5jZXMiLCJvcHRpb25pemUiLCJHcmFwaFR5cGUiLCJDYWxjdWx1c0dyYXBoZXJTeW1ib2xzIiwiQ2FsY3VsdXNHcmFwaGVyQ29uc3RhbnRzIiwiTWF0aFN5bWJvbEZvbnQiLCJIQUlSX1NQQUNFX1NUUklORyIsIk5PTUlOQUxfRk9OVF9TSVpFIiwiR1JBUEhfTEFCRUxfRk9OVCIsIm51bWVyaWNTaXplIiwiUHJpbWVTdHJpbmdWYWx1ZXMiLCJwcmltZSIsImRvdWJsZVByaW1lIiwiR3JhcGhUeXBlTGFiZWxOb2RlIiwiY29uc3RydWN0b3IiLCJncmFwaFR5cGUiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiZGVyaXZhdGl2ZU5vdGF0aW9uUHJvcGVydHkiLCJmdW5jdGlvblZhcmlhYmxlUHJvcGVydHkiLCJmb250U2l6ZU9wdGlvbnMiLCJub21pbmFsRm9udFNpemUiLCJpbnRlZ3JhbFN5bWJvbEZvbnRTaXplIiwibGltaXRzRm9udFNpemUiLCJmcmFjdGlvbkZvbnRTaXplIiwic3VwZXJzY3JpcHRTaXplIiwidmFyaWFibGVTdHJpbmdQcm9wZXJ0eSIsImdldFZhcmlhYmxlU3RyaW5nUHJvcGVydHkiLCJsYWJlbE5vZGUiLCJnZXRMYWJlbE5vZGUiLCJ2YWx1ZSIsImFkZENoaWxkIiwiZGVyaXZhdGlvbk5vdGF0aW9uTGlzdGVuZXIiLCJkZXJpdmF0aW9uTm90YXRpb24iLCJkaXNwb3NlIiwibGluayIsImRpc3Bvc2VHcmFwaFR5cGVMYWJlbE5vZGUiLCJoYXNMaXN0ZW5lciIsInVubGluayIsImRlcml2YXRpdmVOb3RhdGlvbiIsIklOVEVHUkFMIiwiZ2V0SW50ZWdyYWwiLCJPUklHSU5BTCIsImdldE9yaWdpbmFsIiwiREVSSVZBVElWRSIsImdldERlcml2YXRpdmUiLCJTRUNPTkRfREVSSVZBVElWRSIsImdldFNlY29uZERlcml2YXRpdmUiLCJFcnJvciIsImdldFByaW1lTGFiZWwiLCJwcmltZVN0cmluZyIsImxhYmVsU3RyaW5nUHJvcGVydHkiLCJmU3RyaW5nUHJvcGVydHkiLCJmIiwieCIsImxhYmVsIiwiZm9udCIsIm1heFdpZHRoIiwiZGlzcG9zZUVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImdldExhZ3JhbmdlRGVyaXZhdGl2ZSIsImdldExhZ3JhbmdlU2Vjb25kRGVyaXZhdGl2ZSIsImdldExlaWJuaXpEZXJpdmF0aXZlIiwibnVtZXJhdG9yU3RyaW5nUHJvcGVydHkiLCJkU3RyaW5nUHJvcGVydHkiLCJkIiwiZGVub21pbmF0b3JTdHJpbmdQcm9wZXJ0eSIsImdldEZyYWN0aW9uTGFiZWwiLCJnZXRMZWlibml6U2Vjb25kRGVyaXZhdGl2ZSIsImFzc2VydCIsInVuZGVmaW5lZCIsImdldFN1cGVyU2NyaXB0Iiwic3VwZXJTY3JpcHRTaXplIiwiRkFNSUxZIiwiaW50ZWdyYWxTeW1ib2xOb2RlIiwiaW50ZWdyYWwiLCJsaW1pdHNGb250IiwibG93ZXJCb3VuZE5vZGUiLCJ1cHBlckJvdW5kTm9kZSIsImludGVncmFuZFN0cmluZ1Byb3BlcnR5IiwiaW50ZWdyYW5kTm9kZSIsImxlZnQiLCJyaWdodCIsImJvdHRvbSIsInRvcCIsImNlbnRlclkiLCJub2RlIiwiY2hpbGRyZW4iLCJmcmFjdGlvbkZvbnQiLCJudW1lcmF0b3IiLCJkZW5vbWluYXRvciIsInNlcGFyYXRvciIsInN0cm9rZSIsImxpbmVXaWR0aCIsInZCb3giLCJ4U3RyaW5nUHJvcGVydHkiLCJ0U3RyaW5nUHJvcGVydHkiLCJmdW5jdGlvblZhcmlhYmxlIiwieFN0cmluZyIsInRTdHJpbmciLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkdyYXBoVHlwZUxhYmVsTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMi0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBHcmFwaFR5cGVMYWJlbE5vZGUgaXMgdGhlIHZpZXcgcmVwcmVzZW50YXRpb24gZm9yIGdyYXBoIGxhYmVscyBpbiAnQ2FsY3VsdXMgR3JhcGhlcidcclxuICpcclxuICogQGF1dGhvciBNYXJ0aW4gVmVpbGxldHRlXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgeyBIU2VwYXJhdG9yLCBOb2RlLCBOb2RlT3B0aW9ucywgUmljaFRleHQsIFZCb3ggfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgY2FsY3VsdXNHcmFwaGVyIGZyb20gJy4uLy4uL2NhbGN1bHVzR3JhcGhlci5qcyc7XHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgRGVyaXZhdGl2ZU5vdGF0aW9uLCBGdW5jdGlvblZhcmlhYmxlIH0gZnJvbSAnLi4vQ2FsY3VsdXNHcmFwaGVyUXVlcnlQYXJhbWV0ZXJzLmpzJztcclxuaW1wb3J0IENhbGN1bHVzR3JhcGhlclByZWZlcmVuY2VzIGZyb20gJy4uL21vZGVsL0NhbGN1bHVzR3JhcGhlclByZWZlcmVuY2VzLmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IEdyYXBoVHlwZSBmcm9tICcuLi9tb2RlbC9HcmFwaFR5cGUuanMnO1xyXG5pbXBvcnQgQ2FsY3VsdXNHcmFwaGVyU3ltYm9scyBmcm9tICcuLi9DYWxjdWx1c0dyYXBoZXJTeW1ib2xzLmpzJztcclxuaW1wb3J0IENhbGN1bHVzR3JhcGhlckNvbnN0YW50cyBmcm9tICcuLi9DYWxjdWx1c0dyYXBoZXJDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgTWF0aFN5bWJvbEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL01hdGhTeW1ib2xGb250LmpzJztcclxuaW1wb3J0IFBpY2tPcHRpb25hbCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja09wdGlvbmFsLmpzJztcclxuXHJcbmNvbnN0IEhBSVJfU1BBQ0VfU1RSSU5HID0gJ1xcdTIwMEEnO1xyXG5jb25zdCBOT01JTkFMX0ZPTlRfU0laRSA9IENhbGN1bHVzR3JhcGhlckNvbnN0YW50cy5HUkFQSF9MQUJFTF9GT05ULm51bWVyaWNTaXplO1xyXG5cclxuLy8gUG9zc2libGUgcHJpbWUgc3ltYm9scyB0aGF0IGNhbiBhcHBlYXIgYWZ0ZXIgdGhlICdmJyBpbiAnZih4KSdcclxuY29uc3QgUHJpbWVTdHJpbmdWYWx1ZXMgPSBbICcnLCBDYWxjdWx1c0dyYXBoZXJTeW1ib2xzLnByaW1lLCBDYWxjdWx1c0dyYXBoZXJTeW1ib2xzLmRvdWJsZVByaW1lIF0gYXMgY29uc3Q7XHJcbnR5cGUgUHJpbWVTdHJpbmcgPSAoIHR5cGVvZiBQcmltZVN0cmluZ1ZhbHVlcyApW251bWJlcl07XHJcblxyXG50eXBlIEZvbnRTaXplT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gVGhpcyB2YWx1ZSBkZXRlcm1pbmVzIHRoZSBzaXplIG9mIHRoZSBzeW1ib2xzICdmJywgJ2QnLCAneCcsIGFuZCAndCcgd2hlbiB0aGV5IGRvIG5vdCBhcHBlYXIgaW4gYSBmcmFjdGlvbi5cclxuICAvLyBUeXBpY2FsbHksIHlvdSdsbCB3YW50IHRvIHNldCBub21pbmFsRm9udFNpemUsIGFuZCB0aGUgb3RoZXIgc2l6ZXMgd2lsbCBiZSBjb21wdXRlZCBwcm9wb3J0aW9uYWxseS5cclxuICBub21pbmFsRm9udFNpemU/OiBudW1iZXI7XHJcblxyXG4gIC8vIExlYXZlIHRoZXNlIGFsb25lICh1c2UgdGhlIGRlZmF1bHRzKSwgdW5sZXNzIHlvdSBuZWVkIHRvIHR3ZWFrIGZvciBzcGVjaWZpYyBjYXNlcy5cclxuICBpbnRlZ3JhbFN5bWJvbEZvbnRTaXplPzogbnVtYmVyOyAvLyBmb3IgdGhlIGludGVncmFsIHN5bWJvbFxyXG4gIGxpbWl0c0ZvbnRTaXplPzogbnVtYmVyOyAvLyBmb3IgdGhlIHVwcGVyIGFuZCBsb3dlciBsaW1pdHMgb24gdGhlIGludGVncmFsIHN5bWJvbFxyXG4gIGZyYWN0aW9uRm9udFNpemU/OiBudW1iZXI7IC8vIGZvciBmcmFjdGlvbnMgbGlrZSBkZi9keFxyXG4gIHN1cGVyc2NyaXB0U2l6ZT86IG51bWJlcjsgLy8gZm9yIHN1cGVyLSBhbmQgc3ViLXNjcmlwdHMsIGxpbmUgaW4gZF4yZi9keF4yXHJcbn07XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0ge1xyXG5cclxuICAvLyBkeW5hbWljIG5vdGF0aW9uIHRvIHVzZSBmb3IgdGhlIGxhYmVsIChMYWdyYW5nZSBvciBMZWlibml6KVxyXG4gIGRlcml2YXRpdmVOb3RhdGlvblByb3BlcnR5PzogVFJlYWRPbmx5UHJvcGVydHk8RGVyaXZhdGl2ZU5vdGF0aW9uPjtcclxuXHJcbiAgLy8gZHluYW1pYyBmdW5jdGlvbiB2YXJpYWJsZSB0byB1c2UgaW4gdGhlIGxhYmVsICh4IG9yIHQpXHJcbiAgZnVuY3Rpb25WYXJpYWJsZVByb3BlcnR5PzogVFJlYWRPbmx5UHJvcGVydHk8RnVuY3Rpb25WYXJpYWJsZT47XHJcblxyXG4gIC8vIGZvbnQgc2l6ZXMgZm9yIHRoZSB2YXJpb3VzIHBhcnRzIG9mIGEgbGFiZWxcclxuICBmb250U2l6ZU9wdGlvbnM/OiBGb250U2l6ZU9wdGlvbnM7XHJcbn07XHJcblxyXG50eXBlIEdyYXBoVHlwZUxhYmVsTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFBpY2tPcHRpb25hbDxOb2RlT3B0aW9ucywgJ3RhbmRlbScgfCAncGlja2FibGUnPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdyYXBoVHlwZUxhYmVsTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGRpc3Bvc2VHcmFwaFR5cGVMYWJlbE5vZGU6ICgpID0+IHZvaWQ7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggZ3JhcGhUeXBlOiBHcmFwaFR5cGUsIHByb3ZpZGVkT3B0aW9ucz86IEdyYXBoVHlwZUxhYmVsTm9kZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxHcmFwaFR5cGVMYWJlbE5vZGVPcHRpb25zLCBTZWxmT3B0aW9ucywgTm9kZU9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIFNlbGZPcHRpb25zXHJcbiAgICAgIGRlcml2YXRpdmVOb3RhdGlvblByb3BlcnR5OiBDYWxjdWx1c0dyYXBoZXJQcmVmZXJlbmNlcy5kZXJpdmF0aXZlTm90YXRpb25Qcm9wZXJ0eSxcclxuICAgICAgZnVuY3Rpb25WYXJpYWJsZVByb3BlcnR5OiBDYWxjdWx1c0dyYXBoZXJQcmVmZXJlbmNlcy5mdW5jdGlvblZhcmlhYmxlUHJvcGVydHksXHJcbiAgICAgIGZvbnRTaXplT3B0aW9uczoge1xyXG4gICAgICAgIG5vbWluYWxGb250U2l6ZTogTk9NSU5BTF9GT05UX1NJWkUsXHJcbiAgICAgICAgaW50ZWdyYWxTeW1ib2xGb250U2l6ZTogMS41ICogTk9NSU5BTF9GT05UX1NJWkUsXHJcbiAgICAgICAgbGltaXRzRm9udFNpemU6IDAuNSAqIE5PTUlOQUxfRk9OVF9TSVpFLFxyXG4gICAgICAgIGZyYWN0aW9uRm9udFNpemU6IDAuNzUgKiBOT01JTkFMX0ZPTlRfU0laRSxcclxuICAgICAgICBzdXBlcnNjcmlwdFNpemU6IDAuNjI1ICogTk9NSU5BTF9GT05UX1NJWkVcclxuICAgICAgfVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBUbyBpbXByb3ZlIHJlYWRhYmlsaXR5XHJcbiAgICBjb25zdCBkZXJpdmF0aXZlTm90YXRpb25Qcm9wZXJ0eSA9IG9wdGlvbnMuZGVyaXZhdGl2ZU5vdGF0aW9uUHJvcGVydHk7XHJcbiAgICBjb25zdCBmdW5jdGlvblZhcmlhYmxlUHJvcGVydHkgPSBvcHRpb25zLmZ1bmN0aW9uVmFyaWFibGVQcm9wZXJ0eTtcclxuXHJcbiAgICAvLyBnZXQgdmFyaWFibGUgYXMgYSBTdHJpbmdQcm9wZXJ0eVxyXG4gICAgY29uc3QgdmFyaWFibGVTdHJpbmdQcm9wZXJ0eSA9IGdldFZhcmlhYmxlU3RyaW5nUHJvcGVydHkoIGZ1bmN0aW9uVmFyaWFibGVQcm9wZXJ0eSApO1xyXG5cclxuICAgIC8vIGNyZWF0ZSBhbmQgYWRkIGNvbnRlbnQgZm9yIHRoZSBub2RlLCBiYXNlZCBvbiBncmFwaFR5cGUsIG5vdGF0aW9uIGFuZCB2YXJpYWJsZVxyXG4gICAgbGV0IGxhYmVsTm9kZSA9IGdldExhYmVsTm9kZSggZ3JhcGhUeXBlLCBkZXJpdmF0aXZlTm90YXRpb25Qcm9wZXJ0eS52YWx1ZSwgdmFyaWFibGVTdHJpbmdQcm9wZXJ0eSwgb3B0aW9ucy5mb250U2l6ZU9wdGlvbnMgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGxhYmVsTm9kZSApO1xyXG5cclxuICAgIGNvbnN0IGRlcml2YXRpb25Ob3RhdGlvbkxpc3RlbmVyID0gKCBkZXJpdmF0aW9uTm90YXRpb246IERlcml2YXRpdmVOb3RhdGlvbiApID0+IHtcclxuXHJcbiAgICAgIC8vIHJlbW92ZSBhbmQgZGlzcG9zZSBwcmV2aW91cyBsYWJlbE5vZGVcclxuICAgICAgbGFiZWxOb2RlLmRpc3Bvc2UoKTtcclxuXHJcbiAgICAgIC8vIGNyZWF0ZSBhbmQgYWRkIG5ldyBsYWJlbFxyXG4gICAgICBsYWJlbE5vZGUgPSBnZXRMYWJlbE5vZGUoIGdyYXBoVHlwZSwgZGVyaXZhdGlvbk5vdGF0aW9uLCB2YXJpYWJsZVN0cmluZ1Byb3BlcnR5LCBvcHRpb25zLmZvbnRTaXplT3B0aW9ucyApO1xyXG4gICAgICB0aGlzLmFkZENoaWxkKCBsYWJlbE5vZGUgKTtcclxuICAgIH07XHJcbiAgICBkZXJpdmF0aXZlTm90YXRpb25Qcm9wZXJ0eS5saW5rKCBkZXJpdmF0aW9uTm90YXRpb25MaXN0ZW5lciApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZUdyYXBoVHlwZUxhYmVsTm9kZSA9ICgpID0+IHtcclxuICAgICAgdmFyaWFibGVTdHJpbmdQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICAgIGxhYmVsTm9kZS5kaXNwb3NlKCk7XHJcbiAgICAgIGlmICggZGVyaXZhdGl2ZU5vdGF0aW9uUHJvcGVydHkuaGFzTGlzdGVuZXIoIGRlcml2YXRpb25Ob3RhdGlvbkxpc3RlbmVyICkgKSB7XHJcbiAgICAgICAgZGVyaXZhdGl2ZU5vdGF0aW9uUHJvcGVydHkudW5saW5rKCBkZXJpdmF0aW9uTm90YXRpb25MaXN0ZW5lciApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEdldHMgdGhlIGxhYmVsIGZvciB0aGUgc3BlY2lmaWVkIGdyYXBoIHR5cGUuXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRMYWJlbE5vZGUoIGdyYXBoVHlwZTogR3JhcGhUeXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgIGRlcml2YXRpdmVOb3RhdGlvbjogRGVyaXZhdGl2ZU5vdGF0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlU3RyaW5nUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemVPcHRpb25zOiBGb250U2l6ZU9wdGlvbnMgKTogTm9kZSB7XHJcblxyXG4gIGlmICggZ3JhcGhUeXBlID09PSBHcmFwaFR5cGUuSU5URUdSQUwgKSB7XHJcbiAgICByZXR1cm4gZ2V0SW50ZWdyYWwoIHZhcmlhYmxlU3RyaW5nUHJvcGVydHksIGZvbnRTaXplT3B0aW9ucyApO1xyXG4gIH1cclxuICBlbHNlIGlmICggZ3JhcGhUeXBlID09PSBHcmFwaFR5cGUuT1JJR0lOQUwgKSB7XHJcbiAgICByZXR1cm4gZ2V0T3JpZ2luYWwoIHZhcmlhYmxlU3RyaW5nUHJvcGVydHksIGZvbnRTaXplT3B0aW9ucyApO1xyXG4gIH1cclxuICBlbHNlIGlmICggZ3JhcGhUeXBlID09PSBHcmFwaFR5cGUuREVSSVZBVElWRSApIHtcclxuICAgIHJldHVybiBnZXREZXJpdmF0aXZlKCBkZXJpdmF0aXZlTm90YXRpb24sIHZhcmlhYmxlU3RyaW5nUHJvcGVydHksIGZvbnRTaXplT3B0aW9ucyApO1xyXG4gIH1cclxuICBlbHNlIGlmICggZ3JhcGhUeXBlID09PSBHcmFwaFR5cGUuU0VDT05EX0RFUklWQVRJVkUgKSB7XHJcbiAgICByZXR1cm4gZ2V0U2Vjb25kRGVyaXZhdGl2ZSggZGVyaXZhdGl2ZU5vdGF0aW9uLCB2YXJpYWJsZVN0cmluZ1Byb3BlcnR5LCBmb250U2l6ZU9wdGlvbnMgKTtcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoICdVbnN1cHBvcnRlZCBncmFwaFR5cGUnICk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogbGFiZWwgZm9yIGYoeCksIGYnKHgpIGFuZCBmXCIoeClcclxuICovXHJcbmZ1bmN0aW9uIGdldFByaW1lTGFiZWwoIHZhcmlhYmxlU3RyaW5nUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4sIHByaW1lU3RyaW5nOiBQcmltZVN0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemVPcHRpb25zOiBGb250U2l6ZU9wdGlvbnMgKTogTm9kZSB7XHJcblxyXG4gIGNvbnN0IGxhYmVsU3RyaW5nUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgWyBDYWxjdWx1c0dyYXBoZXJTeW1ib2xzLmZTdHJpbmdQcm9wZXJ0eSwgdmFyaWFibGVTdHJpbmdQcm9wZXJ0eSBdLFxyXG4gICAgKCBmLCB4ICkgPT4gYCR7Zn0ke0hBSVJfU1BBQ0VfU1RSSU5HfSR7cHJpbWVTdHJpbmd9KCR7eH0pYFxyXG4gICk7XHJcblxyXG4gIGNvbnN0IGxhYmVsID0gbmV3IFJpY2hUZXh0KCBsYWJlbFN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICBmb250OiBuZXcgUGhldEZvbnQoIGZvbnRTaXplT3B0aW9ucy5ub21pbmFsRm9udFNpemUgKSxcclxuICAgIG1heFdpZHRoOiA1MFxyXG4gICAgLy8gTm8gUGhFVC1pTyBpbnN0cnVtZW50YXRpb24gaXMgZGVzaXJlZC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8yMTNcclxuICB9ICk7XHJcblxyXG4gIC8vIERpc3Bvc2Ugb2YgYW55dGhpbmcgdGhhdCdzIGxpbmtlZCB0byBhIFN0cmluZ1Byb3BlcnR5IG9yIFByb2ZpbGVDb2xvclByb3BlcnR5LlxyXG4gIGxhYmVsLmRpc3Bvc2VFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICBsYWJlbFN0cmluZ1Byb3BlcnR5LmRpc3Bvc2UoKTtcclxuICB9ICk7XHJcblxyXG4gIHJldHVybiBsYWJlbDtcclxufVxyXG5cclxuLyoqXHJcbiAqIGxhYmVsIGZvciBmKHgpXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRPcmlnaW5hbCggdmFyaWFibGVTdHJpbmdQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPiwgZm9udFNpemVPcHRpb25zOiBGb250U2l6ZU9wdGlvbnMgKTogTm9kZSB7XHJcbiAgcmV0dXJuIGdldFByaW1lTGFiZWwoIHZhcmlhYmxlU3RyaW5nUHJvcGVydHksICcnLCBmb250U2l6ZU9wdGlvbnMgKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIGxhYmVsIGZvciBmJyh4KVxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0TGFncmFuZ2VEZXJpdmF0aXZlKCB2YXJpYWJsZVN0cmluZ1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplT3B0aW9uczogRm9udFNpemVPcHRpb25zICk6IE5vZGUge1xyXG4gIHJldHVybiBnZXRQcmltZUxhYmVsKCB2YXJpYWJsZVN0cmluZ1Byb3BlcnR5LCBDYWxjdWx1c0dyYXBoZXJTeW1ib2xzLnByaW1lLCBmb250U2l6ZU9wdGlvbnMgKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIGxhYmVsIGZvciBmJycoeClcclxuICovXHJcbmZ1bmN0aW9uIGdldExhZ3JhbmdlU2Vjb25kRGVyaXZhdGl2ZSggdmFyaWFibGVTdHJpbmdQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250U2l6ZU9wdGlvbnM6IEZvbnRTaXplT3B0aW9ucyApOiBOb2RlIHtcclxuICByZXR1cm4gZ2V0UHJpbWVMYWJlbCggdmFyaWFibGVTdHJpbmdQcm9wZXJ0eSwgQ2FsY3VsdXNHcmFwaGVyU3ltYm9scy5kb3VibGVQcmltZSwgZm9udFNpemVPcHRpb25zICk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBsYWJlbCBmb3IgZGYvZHggb3IgZGYvZHRcclxuICovXHJcbmZ1bmN0aW9uIGdldExlaWJuaXpEZXJpdmF0aXZlKCB2YXJpYWJsZVN0cmluZ1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemVPcHRpb25zOiBGb250U2l6ZU9wdGlvbnMgKTogTm9kZSB7XHJcblxyXG4gIC8vIHN0cmluZyBmb3IgZGZcclxuICBjb25zdCBudW1lcmF0b3JTdHJpbmdQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICBbIENhbGN1bHVzR3JhcGhlclN5bWJvbHMuZFN0cmluZ1Byb3BlcnR5LCBDYWxjdWx1c0dyYXBoZXJTeW1ib2xzLmZTdHJpbmdQcm9wZXJ0eSBdLFxyXG4gICAgKCBkLCBmICkgPT4gYCR7ZH0ke0hBSVJfU1BBQ0VfU1RSSU5HfSR7Zn1gXHJcbiAgKTtcclxuXHJcbiAgLy8gc3RyaW5nIGZvciBkeFxyXG4gIGNvbnN0IGRlbm9taW5hdG9yU3RyaW5nUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgWyBDYWxjdWx1c0dyYXBoZXJTeW1ib2xzLmRTdHJpbmdQcm9wZXJ0eSwgdmFyaWFibGVTdHJpbmdQcm9wZXJ0eSBdLFxyXG4gICAgKCBkLCB4ICkgPT4gYCR7ZH0ke3h9YFxyXG4gICk7XHJcblxyXG4gIGNvbnN0IGxhYmVsID0gZ2V0RnJhY3Rpb25MYWJlbCggbnVtZXJhdG9yU3RyaW5nUHJvcGVydHksIGRlbm9taW5hdG9yU3RyaW5nUHJvcGVydHksIGZvbnRTaXplT3B0aW9ucyApO1xyXG5cclxuICAvLyBEaXNwb3NlIG9mIGFueXRoaW5nIHRoYXQncyBsaW5rZWQgdG8gYSBTdHJpbmdQcm9wZXJ0eSBvciBQcm9maWxlQ29sb3JQcm9wZXJ0eS5cclxuICBsYWJlbC5kaXNwb3NlRW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgbnVtZXJhdG9yU3RyaW5nUHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgZGVub21pbmF0b3JTdHJpbmdQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgfSApO1xyXG5cclxuICByZXR1cm4gbGFiZWw7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBsYWJlbCBmb3IgZF4yZi9keF4yIG9yIGReMmYvZHReMlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0TGVpYm5pelNlY29uZERlcml2YXRpdmUoIHZhcmlhYmxlU3RyaW5nUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250U2l6ZU9wdGlvbnM6IEZvbnRTaXplT3B0aW9ucyApOiBOb2RlIHtcclxuXHJcbiAgY29uc3Qgc3VwZXJzY3JpcHRTaXplID0gZm9udFNpemVPcHRpb25zLnN1cGVyc2NyaXB0U2l6ZSE7XHJcbiAgYXNzZXJ0ICYmIGFzc2VydCggc3VwZXJzY3JpcHRTaXplICE9PSB1bmRlZmluZWQgKTtcclxuXHJcbiAgLy8gc3RyaW5nIGZvciBkXjIgZiAsIHdlIG5lZWQgYSBoYWlyc3BhY2UgdG8gcHJldmVudCB0aGUgc3VwZXJzY3JpcHQgdG8gb3ZlcmxhcCB3aXRoIGRcclxuICBjb25zdCBudW1lcmF0b3JTdHJpbmdQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICBbIENhbGN1bHVzR3JhcGhlclN5bWJvbHMuZFN0cmluZ1Byb3BlcnR5LCBDYWxjdWx1c0dyYXBoZXJTeW1ib2xzLmZTdHJpbmdQcm9wZXJ0eSBdLFxyXG4gICAgKCBkLCBmICkgPT4gYCR7ZH0ke0hBSVJfU1BBQ0VfU1RSSU5HfSR7Z2V0U3VwZXJTY3JpcHQoIDIsIHN1cGVyc2NyaXB0U2l6ZSApfSR7Zn1gXHJcbiAgKTtcclxuXHJcbiAgLy8gc3RyaW5nIGZvciBkeF4yICwgdGhlIHN1cGVyc2NyaXB0IGlzIGRvd25zaXplZCBidXQgaW4gdGhlIHNhbWUgRmFtaWx5IGF0IHRoZSBtYXRoIHN5bWJvbHNcclxuICBjb25zdCBkZW5vbWluYXRvclN0cmluZ1Byb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eShcclxuICAgIFsgQ2FsY3VsdXNHcmFwaGVyU3ltYm9scy5kU3RyaW5nUHJvcGVydHksIHZhcmlhYmxlU3RyaW5nUHJvcGVydHkgXSxcclxuICAgICggZCwgeCApID0+IGAke2R9JHt4fSR7Z2V0U3VwZXJTY3JpcHQoIDIsIHN1cGVyc2NyaXB0U2l6ZSApfWBcclxuICApO1xyXG5cclxuICBjb25zdCBsYWJlbCA9IGdldEZyYWN0aW9uTGFiZWwoIG51bWVyYXRvclN0cmluZ1Byb3BlcnR5LCBkZW5vbWluYXRvclN0cmluZ1Byb3BlcnR5LCBmb250U2l6ZU9wdGlvbnMgKTtcclxuXHJcbiAgLy8gRGlzcG9zZSBvZiBhbnl0aGluZyB0aGF0J3MgbGlua2VkIHRvIGEgU3RyaW5nUHJvcGVydHkgb3IgUHJvZmlsZUNvbG9yUHJvcGVydHkuXHJcbiAgbGFiZWwuZGlzcG9zZUVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgIG51bWVyYXRvclN0cmluZ1Byb3BlcnR5LmRpc3Bvc2UoKTtcclxuICAgIGRlbm9taW5hdG9yU3RyaW5nUHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gIH0gKTtcclxuXHJcbiAgcmV0dXJuIGxhYmVsO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0cyBhIHN1cGVyc2NyaXB0LCBsaWtlIHRoZSAnMicgaW4gJ2R4XjInLiBOb3RlIHRoYXQgd2UgZG8gbm90IHdhbnQgdGhlIHN1cGVyc2NyaXB0IHRvIGJlIGluIGl0YWxpY3MsXHJcbiAqIHNvIHdlIGFyZSBub3QgdXNpbmcgTWF0aFN5bWJvbEZvbnQuZ2V0UmljaFRleHRNYXJrdXAuXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRTdXBlclNjcmlwdCggdmFsdWU6IG51bWJlciwgc3VwZXJTY3JpcHRTaXplOiBudW1iZXIgKTogc3RyaW5nIHtcclxuICByZXR1cm4gYDxzdXAgc3R5bGU9J2ZvbnQtc2l6ZToke3N1cGVyU2NyaXB0U2l6ZX1wdDsgZm9udC1mYW1pbHk6JHtNYXRoU3ltYm9sRm9udC5GQU1JTFl9Jz4ke3ZhbHVlfTwvc3VwPmA7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXRzIHRoZSBkZXJpdmF0aXZlIGxhYmVsLCBhcHByb3ByaWF0ZSBmb3IgdGhlIGNob3NlIGRlcml2YXRpdmUgbm90YXRpb24uXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXREZXJpdmF0aXZlKCBkZXJpdmF0aXZlTm90YXRpb246IERlcml2YXRpdmVOb3RhdGlvbiwgdmFyaWFibGVTdHJpbmdQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemVPcHRpb25zOiBGb250U2l6ZU9wdGlvbnMgKTogTm9kZSB7XHJcbiAgaWYgKCBkZXJpdmF0aXZlTm90YXRpb24gPT09ICdsZWlibml6JyApIHtcclxuICAgIHJldHVybiBnZXRMZWlibml6RGVyaXZhdGl2ZSggdmFyaWFibGVTdHJpbmdQcm9wZXJ0eSwgZm9udFNpemVPcHRpb25zICk7XHJcbiAgfVxyXG4gIGVsc2Uge1xyXG4gICAgcmV0dXJuIGdldExhZ3JhbmdlRGVyaXZhdGl2ZSggdmFyaWFibGVTdHJpbmdQcm9wZXJ0eSwgZm9udFNpemVPcHRpb25zICk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogR2V0cyB0aGUgc2Vjb25kIGRlcml2YXRpdmUgbGFiZWwsIGFwcHJvcHJpYXRlIGZvciB0aGUgY2hvc2UgZGVyaXZhdGl2ZSBub3RhdGlvbi5cclxuICovXHJcbmZ1bmN0aW9uIGdldFNlY29uZERlcml2YXRpdmUoIGRlcml2YXRpdmVOb3RhdGlvbjogRGVyaXZhdGl2ZU5vdGF0aW9uLCB2YXJpYWJsZVN0cmluZ1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250U2l6ZU9wdGlvbnM6IEZvbnRTaXplT3B0aW9ucyApOiBOb2RlIHtcclxuICBpZiAoIGRlcml2YXRpdmVOb3RhdGlvbiA9PT0gJ2xlaWJuaXonICkge1xyXG4gICAgcmV0dXJuIGdldExlaWJuaXpTZWNvbmREZXJpdmF0aXZlKCB2YXJpYWJsZVN0cmluZ1Byb3BlcnR5LCBmb250U2l6ZU9wdGlvbnMgKTtcclxuICB9XHJcbiAgZWxzZSB7XHJcbiAgICByZXR1cm4gZ2V0TGFncmFuZ2VTZWNvbmREZXJpdmF0aXZlKCB2YXJpYWJsZVN0cmluZ1Byb3BlcnR5LCBmb250U2l6ZU9wdGlvbnMgKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBsYWJlbCBmb3IgXFxpbnRfMF54IGYoeCkgZHggb3IgXFxpbnRfMF50IGYodCkgZHRcclxuICovXHJcbmZ1bmN0aW9uIGdldEludGVncmFsKCB2YXJpYWJsZVN0cmluZ1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxzdHJpbmc+LCBmb250U2l6ZU9wdGlvbnM6IEZvbnRTaXplT3B0aW9ucyApOiBOb2RlIHtcclxuXHJcbiAgLy8gVGhlIHN5bWJvbCBmb3IgaW50ZWdyYWxcclxuICBjb25zdCBpbnRlZ3JhbFN5bWJvbE5vZGUgPSBuZXcgUmljaFRleHQoIENhbGN1bHVzR3JhcGhlclN5bWJvbHMuaW50ZWdyYWwsIHtcclxuICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggZm9udFNpemVPcHRpb25zLmludGVncmFsU3ltYm9sRm9udFNpemUgKSxcclxuICAgIG1heFdpZHRoOiAyNVxyXG4gICAgLy8gTm8gUGhFVC1pTyBpbnN0cnVtZW50YXRpb24gaXMgZGVzaXJlZC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8yMTNcclxuICB9ICk7XHJcblxyXG4gIGNvbnN0IGxpbWl0c0ZvbnQgPSBuZXcgUGhldEZvbnQoIGZvbnRTaXplT3B0aW9ucy5saW1pdHNGb250U2l6ZSApO1xyXG5cclxuICAvLyBsb3dlciBsaW1pdCBvZiBpbnRlZ3JhbFxyXG4gIGNvbnN0IGxvd2VyQm91bmROb2RlID0gbmV3IFJpY2hUZXh0KCAnMCcsIHtcclxuICAgIGZvbnQ6IGxpbWl0c0ZvbnQsXHJcbiAgICBtYXhXaWR0aDogMjVcclxuICAgIC8vIE5vIFBoRVQtaU8gaW5zdHJ1bWVudGF0aW9uIGlzIGRlc2lyZWQuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2FsY3VsdXMtZ3JhcGhlci9pc3N1ZXMvMjEzXHJcbiAgfSApO1xyXG5cclxuICAvLyB1cHBlciBsaW1pdCBvZiBpbnRlZ3JhbFxyXG4gIGNvbnN0IHVwcGVyQm91bmROb2RlID0gbmV3IFJpY2hUZXh0KCB2YXJpYWJsZVN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICBmb250OiBsaW1pdHNGb250LFxyXG4gICAgbWF4V2lkdGg6IDI1XHJcbiAgICAvLyBObyBQaEVULWlPIGluc3RydW1lbnRhdGlvbiBpcyBkZXNpcmVkLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2NhbGN1bHVzLWdyYXBoZXIvaXNzdWVzLzIxM1xyXG4gIH0gKTtcclxuXHJcbiAgLy8gaW50ZWdyYW5kIG9mIGludGVncmFsOiBmKHgpZHhcclxuICBjb25zdCBpbnRlZ3JhbmRTdHJpbmdQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICBbIENhbGN1bHVzR3JhcGhlclN5bWJvbHMuZlN0cmluZ1Byb3BlcnR5LCB2YXJpYWJsZVN0cmluZ1Byb3BlcnR5LCBDYWxjdWx1c0dyYXBoZXJTeW1ib2xzLmRTdHJpbmdQcm9wZXJ0eSBdLFxyXG4gICAgKCBmLCB4LCBkICkgPT4gYCR7Zn0ke0hBSVJfU1BBQ0VfU1RSSU5HfSgke3h9KSAke2R9JHt4fSBgXHJcbiAgKTtcclxuICBjb25zdCBpbnRlZ3JhbmROb2RlID0gbmV3IFJpY2hUZXh0KCBpbnRlZ3JhbmRTdHJpbmdQcm9wZXJ0eSwge1xyXG4gICAgZm9udDogbmV3IFBoZXRGb250KCBmb250U2l6ZU9wdGlvbnMubm9taW5hbEZvbnRTaXplICksXHJcbiAgICBtYXhXaWR0aDogNTBcclxuICAgIC8vIE5vIFBoRVQtaU8gaW5zdHJ1bWVudGF0aW9uIGlzIGRlc2lyZWQuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2FsY3VsdXMtZ3JhcGhlci9pc3N1ZXMvMjEzXHJcbiAgfSApO1xyXG5cclxuICAvLyBsYXlpbmcgb3V0IHRoZSB2YXJpb3VzIG5vZGVzXHJcbiAgbG93ZXJCb3VuZE5vZGUubGVmdCA9IGludGVncmFsU3ltYm9sTm9kZS5yaWdodCAtIDI7XHJcbiAgbG93ZXJCb3VuZE5vZGUuYm90dG9tID0gaW50ZWdyYWxTeW1ib2xOb2RlLmJvdHRvbSArIDM7XHJcbiAgdXBwZXJCb3VuZE5vZGUubGVmdCA9IGludGVncmFsU3ltYm9sTm9kZS5yaWdodCArIDI7XHJcbiAgdXBwZXJCb3VuZE5vZGUudG9wID0gaW50ZWdyYWxTeW1ib2xOb2RlLnRvcCAtIDU7XHJcbiAgaW50ZWdyYW5kTm9kZS5sZWZ0ID0gdXBwZXJCb3VuZE5vZGUucmlnaHQgKyAyO1xyXG4gIGludGVncmFuZE5vZGUuY2VudGVyWSA9IGludGVncmFsU3ltYm9sTm9kZS5jZW50ZXJZO1xyXG5cclxuICBjb25zdCBub2RlID0gbmV3IE5vZGUoIHsgY2hpbGRyZW46IFsgbG93ZXJCb3VuZE5vZGUsIHVwcGVyQm91bmROb2RlLCBpbnRlZ3JhbmROb2RlLCBpbnRlZ3JhbFN5bWJvbE5vZGUgXSB9ICk7XHJcblxyXG4gIC8vIERpc3Bvc2Ugb2YgYW55dGhpbmcgdGhhdCdzIGxpbmtlZCB0byBhIFN0cmluZ1Byb3BlcnR5IG9yIFByb2ZpbGVDb2xvclByb3BlcnR5LlxyXG4gIG5vZGUuZGlzcG9zZUVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgIGludGVncmFsU3ltYm9sTm9kZS5kaXNwb3NlKCk7XHJcbiAgICBsb3dlckJvdW5kTm9kZS5kaXNwb3NlKCk7XHJcbiAgICB1cHBlckJvdW5kTm9kZS5kaXNwb3NlKCk7XHJcbiAgICBpbnRlZ3JhbmRTdHJpbmdQcm9wZXJ0eS5kaXNwb3NlKCk7XHJcbiAgICBpbnRlZ3JhbmROb2RlLmRpc3Bvc2UoKTtcclxuICB9ICk7XHJcblxyXG4gIHJldHVybiBub2RlO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0cyBhIGZyYWN0aW9uIG5vZGUsIG1hZGUgb2YgYSBudW1lcmF0b3IgYW5kIGEgZGVub21pbmF0b3Igc2VwYXJhdGVkIGJ5IGEgaG9yaXpvbnRhbCBsaW5lLlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0RnJhY3Rpb25MYWJlbCggbnVtZXJhdG9yU3RyaW5nUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbm9taW5hdG9yU3RyaW5nUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplT3B0aW9uczogRm9udFNpemVPcHRpb25zICk6IE5vZGUge1xyXG5cclxuICBjb25zdCBmcmFjdGlvbkZvbnQgPSBuZXcgUGhldEZvbnQoIGZvbnRTaXplT3B0aW9ucy5mcmFjdGlvbkZvbnRTaXplICk7XHJcblxyXG4gIGNvbnN0IG51bWVyYXRvciA9IG5ldyBSaWNoVGV4dCggbnVtZXJhdG9yU3RyaW5nUHJvcGVydHksIHtcclxuICAgIGZvbnQ6IGZyYWN0aW9uRm9udCxcclxuICAgIG1heFdpZHRoOiA1MFxyXG4gICAgLy8gTm8gUGhFVC1pTyBpbnN0cnVtZW50YXRpb24gaXMgZGVzaXJlZC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8yMTNcclxuICB9ICk7XHJcblxyXG4gIGNvbnN0IGRlbm9taW5hdG9yID0gbmV3IFJpY2hUZXh0KCBkZW5vbWluYXRvclN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICBmb250OiBmcmFjdGlvbkZvbnQsXHJcbiAgICBtYXhXaWR0aDogNTBcclxuICAgIC8vIE5vIFBoRVQtaU8gaW5zdHJ1bWVudGF0aW9uIGlzIGRlc2lyZWQuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2FsY3VsdXMtZ3JhcGhlci9pc3N1ZXMvMjEzXHJcbiAgfSApO1xyXG5cclxuICAvLyBob3Jpem9udGFsIGxpbmUgYmV0d2VlbiBudW1lcmF0b3IgYW5kIGRlbm9taW5hdG9yLCByZXNpemVkIGF1dG9tYXRpY2FsbHkgYnkgVkJveFxyXG4gIGNvbnN0IHNlcGFyYXRvciA9IG5ldyBIU2VwYXJhdG9yKCB7XHJcbiAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICBsaW5lV2lkdGg6IDAuNVxyXG4gIH0gKTtcclxuXHJcbiAgY29uc3QgdkJveCA9IG5ldyBWQm94KCB7XHJcbiAgICBjaGlsZHJlbjogWyBudW1lcmF0b3IsIHNlcGFyYXRvciwgZGVub21pbmF0b3IgXVxyXG4gIH0gKTtcclxuXHJcbiAgLy8gRGlzcG9zZSBvZiBhbnl0aGluZyB0aGF0J3MgbGlua2VkIHRvIGEgU3RyaW5nUHJvcGVydHkgb3IgUHJvZmlsZUNvbG9yUHJvcGVydHkuXHJcbiAgdkJveC5kaXNwb3NlRW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgbnVtZXJhdG9yLmRpc3Bvc2UoKTtcclxuICAgIGRlbm9taW5hdG9yLmRpc3Bvc2UoKTtcclxuICB9ICk7XHJcblxyXG4gIHJldHVybiB2Qm94O1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IHRoZSBmdW5jdGlvbiB2YXJpYWJsZSBhcyBhIFN0cmluZ1Byb3BlcnR5IChyYXRoZXIgdGhhbiBTdHJpbmdFbnVtZXJhdGlvbikuXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRWYXJpYWJsZVN0cmluZ1Byb3BlcnR5KCBmdW5jdGlvblZhcmlhYmxlUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PEZ1bmN0aW9uVmFyaWFibGU+ICk6IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4ge1xyXG4gIHJldHVybiBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgWyBmdW5jdGlvblZhcmlhYmxlUHJvcGVydHksIENhbGN1bHVzR3JhcGhlclN5bWJvbHMueFN0cmluZ1Byb3BlcnR5LCBDYWxjdWx1c0dyYXBoZXJTeW1ib2xzLnRTdHJpbmdQcm9wZXJ0eSBdLFxyXG4gICAgKCBmdW5jdGlvblZhcmlhYmxlLCB4U3RyaW5nLCB0U3RyaW5nICkgPT4gKCBmdW5jdGlvblZhcmlhYmxlID09PSAneCcgKSA/IHhTdHJpbmcgOiB0U3RyaW5nXHJcbiAgKTtcclxufVxyXG5cclxuY2FsY3VsdXNHcmFwaGVyLnJlZ2lzdGVyKCAnR3JhcGhUeXBlTGFiZWxOb2RlJywgR3JhcGhUeXBlTGFiZWxOb2RlICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FB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