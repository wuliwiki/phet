// Copyright 2020-2023, University of Colorado Boulder

/**
 * DerivativeCurve is a Curve subclass for a curve that represents the derivative of a Curve. It is used
 * to evaluate the first derivative of the original curve.
 *
 * DerivativeCurves' main responsibility is to observe when the original Curve changes and differentiates it and update
 * the Points of the derivative. Derivatives are computed by considering the slope of the secant lines from both sides
 * of every point. For a general background on differentiation, see
 * https://en.wikipedia.org/wiki/Derivative#Rigorous_definition.
 *
 * Like Curve, DerivativeCurve is created at the start and persists for the lifetime of the simulation. Links
 * are left as-is since instances of DerivativeCurve are never disposed.
 *
 * @author Brandon Li
 * @author Martin Veillette
 */

import calculusGrapher from '../../calculusGrapher.js';
import Curve from './Curve.js';
export default class DerivativeCurve extends Curve {
  // Reference to the originalCurve that was passed-in.

  /**
   * @param originalCurve - the curve to differentiate to get the values for this DerivativeCurve
   * @param tandem
   */
  constructor(originalCurve, tandem) {
    super({
      // CurveOptions
      xRange: originalCurve.xRange,
      numberOfPoints: originalCurve.numberOfPoints,
      tandem: tandem
    });
    this.originalCurve = originalCurve;

    // Observes when the originalCurve changes and update this curve to represent the derivative.
    // Listener is never removed since DerivativeCurves are never disposed.
    originalCurve.curveChangedEmitter.addListener(this.updateDerivative.bind(this));

    // Makes the initial call to updateDerivative() to evaluate the derivative the originalCurve upon initialization.
    this.updateDerivative();
  }

  /**
   * Updates the y-values and pointTypes of the DerivativeCurve to represent the derivative of the originalCurve.
   *
   * The derivative is approximated as the slope of the secant line between each adjacent Point.
   * Our version considers both the slope of the secant lines from the left and right sides of every point. See
   * https://en.wikipedia.org/wiki/Numerical_differentiation
   *
   * Special consideration is given to points of originalCurve that are 'cusp' or 'discontinuous'
   * For these cases, the simple algorithm of averaging the slope of the secant lines from the left and right side of every point
   * is incorrect. Instead, for points at the edge of discontinuities, we use the value of the slope that is available.
   *
   * The point type of the derivative is updated. The point type is "promoted", which means that 'cusp' and 'discontinuous'
   * type in the original curve becomes discontinuity in the derivative, but 'smooth' original point remains 'smooth'.
   */
  updateDerivative() {
    const originalPoints = this.originalCurve.points;
    const length = originalPoints.length;

    // Slope to the left of a point. It may not exist if the point is at the beginning of our curve range
    let backwardSlope;

    // Slope to the right of a point. It may not exist if the point is at the end of the curve range
    let forwardSlope;
    for (let index = 0; index < length; index++) {
      const previousPoint = index > 0 ? originalPoints[index - 1] : null;
      const point = originalPoints[index];
      const nextPoint = index < length - 1 ? originalPoints[index + 1] : null;
      if (previousPoint === null || point.isCusp && previousPoint.isCusp || point.isDiscontinuous && previousPoint.isDiscontinuous) {
        backwardSlope = null;
      } else {
        backwardSlope = point.getSlope(previousPoint);
      }
      if (nextPoint === null || point.isCusp && nextPoint.isCusp || point.isDiscontinuous && nextPoint.isDiscontinuous) {
        forwardSlope = null;
      } else {
        forwardSlope = point.getSlope(nextPoint);
      }
      if (typeof backwardSlope === 'number' && typeof forwardSlope === 'number') {
        // Best case scenario: Both slopes exist. We average them to get the symmetric difference quotient,
        // which is a better numerical approximation of the derivative than the usual difference quotient
        this.points[index].y = (backwardSlope + forwardSlope) / 2;
      } else if (typeof backwardSlope === 'number') {
        // If only the slope of the left side exists, use that as the derivative.
        this.points[index].y = backwardSlope;
      } else if (typeof forwardSlope === 'number') {
        // If only the slope of the right side exists, use that as the derivative.
        this.points[index].y = forwardSlope;
      }
      if (point.isCusp) {
        this.points[index].pointType = 'discontinuous';
      } else if (point.isDiscontinuous) {
        this.points[index].pointType = 'discontinuous';
      } else {
        this.points[index].pointType = 'smooth';
      }
    }

    // Signal once that this Curve has changed.
    this.curveChangedEmitter.emit();
  }
}
calculusGrapher.register('DerivativeCurve', DerivativeCurve);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjYWxjdWx1c0dyYXBoZXIiLCJDdXJ2ZSIsIkRlcml2YXRpdmVDdXJ2ZSIsImNvbnN0cnVjdG9yIiwib3JpZ2luYWxDdXJ2ZSIsInRhbmRlbSIsInhSYW5nZSIsIm51bWJlck9mUG9pbnRzIiwiY3VydmVDaGFuZ2VkRW1pdHRlciIsImFkZExpc3RlbmVyIiwidXBkYXRlRGVyaXZhdGl2ZSIsImJpbmQiLCJvcmlnaW5hbFBvaW50cyIsInBvaW50cyIsImxlbmd0aCIsImJhY2t3YXJkU2xvcGUiLCJmb3J3YXJkU2xvcGUiLCJpbmRleCIsInByZXZpb3VzUG9pbnQiLCJwb2ludCIsIm5leHRQb2ludCIsImlzQ3VzcCIsImlzRGlzY29udGludW91cyIsImdldFNsb3BlIiwieSIsInBvaW50VHlwZSIsImVtaXQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkRlcml2YXRpdmVDdXJ2ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMC0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBEZXJpdmF0aXZlQ3VydmUgaXMgYSBDdXJ2ZSBzdWJjbGFzcyBmb3IgYSBjdXJ2ZSB0aGF0IHJlcHJlc2VudHMgdGhlIGRlcml2YXRpdmUgb2YgYSBDdXJ2ZS4gSXQgaXMgdXNlZFxyXG4gKiB0byBldmFsdWF0ZSB0aGUgZmlyc3QgZGVyaXZhdGl2ZSBvZiB0aGUgb3JpZ2luYWwgY3VydmUuXHJcbiAqXHJcbiAqIERlcml2YXRpdmVDdXJ2ZXMnIG1haW4gcmVzcG9uc2liaWxpdHkgaXMgdG8gb2JzZXJ2ZSB3aGVuIHRoZSBvcmlnaW5hbCBDdXJ2ZSBjaGFuZ2VzIGFuZCBkaWZmZXJlbnRpYXRlcyBpdCBhbmQgdXBkYXRlXHJcbiAqIHRoZSBQb2ludHMgb2YgdGhlIGRlcml2YXRpdmUuIERlcml2YXRpdmVzIGFyZSBjb21wdXRlZCBieSBjb25zaWRlcmluZyB0aGUgc2xvcGUgb2YgdGhlIHNlY2FudCBsaW5lcyBmcm9tIGJvdGggc2lkZXNcclxuICogb2YgZXZlcnkgcG9pbnQuIEZvciBhIGdlbmVyYWwgYmFja2dyb3VuZCBvbiBkaWZmZXJlbnRpYXRpb24sIHNlZVxyXG4gKiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9EZXJpdmF0aXZlI1JpZ29yb3VzX2RlZmluaXRpb24uXHJcbiAqXHJcbiAqIExpa2UgQ3VydmUsIERlcml2YXRpdmVDdXJ2ZSBpcyBjcmVhdGVkIGF0IHRoZSBzdGFydCBhbmQgcGVyc2lzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltdWxhdGlvbi4gTGlua3NcclxuICogYXJlIGxlZnQgYXMtaXMgc2luY2UgaW5zdGFuY2VzIG9mIERlcml2YXRpdmVDdXJ2ZSBhcmUgbmV2ZXIgZGlzcG9zZWQuXHJcbiAqXHJcbiAqIEBhdXRob3IgQnJhbmRvbiBMaVxyXG4gKiBAYXV0aG9yIE1hcnRpbiBWZWlsbGV0dGVcclxuICovXHJcblxyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgY2FsY3VsdXNHcmFwaGVyIGZyb20gJy4uLy4uL2NhbGN1bHVzR3JhcGhlci5qcyc7XHJcbmltcG9ydCBDdXJ2ZSBmcm9tICcuL0N1cnZlLmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERlcml2YXRpdmVDdXJ2ZSBleHRlbmRzIEN1cnZlIHtcclxuXHJcbiAgLy8gUmVmZXJlbmNlIHRvIHRoZSBvcmlnaW5hbEN1cnZlIHRoYXQgd2FzIHBhc3NlZC1pbi5cclxuICBwcml2YXRlIHJlYWRvbmx5IG9yaWdpbmFsQ3VydmU6IEN1cnZlO1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0gb3JpZ2luYWxDdXJ2ZSAtIHRoZSBjdXJ2ZSB0byBkaWZmZXJlbnRpYXRlIHRvIGdldCB0aGUgdmFsdWVzIGZvciB0aGlzIERlcml2YXRpdmVDdXJ2ZVxyXG4gICAqIEBwYXJhbSB0YW5kZW1cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG9yaWdpbmFsQ3VydmU6IEN1cnZlLCB0YW5kZW06IFRhbmRlbSApIHtcclxuXHJcbiAgICBzdXBlcigge1xyXG5cclxuICAgICAgLy8gQ3VydmVPcHRpb25zXHJcbiAgICAgIHhSYW5nZTogb3JpZ2luYWxDdXJ2ZS54UmFuZ2UsXHJcbiAgICAgIG51bWJlck9mUG9pbnRzOiBvcmlnaW5hbEN1cnZlLm51bWJlck9mUG9pbnRzLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMub3JpZ2luYWxDdXJ2ZSA9IG9yaWdpbmFsQ3VydmU7XHJcblxyXG4gICAgLy8gT2JzZXJ2ZXMgd2hlbiB0aGUgb3JpZ2luYWxDdXJ2ZSBjaGFuZ2VzIGFuZCB1cGRhdGUgdGhpcyBjdXJ2ZSB0byByZXByZXNlbnQgdGhlIGRlcml2YXRpdmUuXHJcbiAgICAvLyBMaXN0ZW5lciBpcyBuZXZlciByZW1vdmVkIHNpbmNlIERlcml2YXRpdmVDdXJ2ZXMgYXJlIG5ldmVyIGRpc3Bvc2VkLlxyXG4gICAgb3JpZ2luYWxDdXJ2ZS5jdXJ2ZUNoYW5nZWRFbWl0dGVyLmFkZExpc3RlbmVyKCB0aGlzLnVwZGF0ZURlcml2YXRpdmUuYmluZCggdGhpcyApICk7XHJcblxyXG4gICAgLy8gTWFrZXMgdGhlIGluaXRpYWwgY2FsbCB0byB1cGRhdGVEZXJpdmF0aXZlKCkgdG8gZXZhbHVhdGUgdGhlIGRlcml2YXRpdmUgdGhlIG9yaWdpbmFsQ3VydmUgdXBvbiBpbml0aWFsaXphdGlvbi5cclxuICAgIHRoaXMudXBkYXRlRGVyaXZhdGl2ZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlcyB0aGUgeS12YWx1ZXMgYW5kIHBvaW50VHlwZXMgb2YgdGhlIERlcml2YXRpdmVDdXJ2ZSB0byByZXByZXNlbnQgdGhlIGRlcml2YXRpdmUgb2YgdGhlIG9yaWdpbmFsQ3VydmUuXHJcbiAgICpcclxuICAgKiBUaGUgZGVyaXZhdGl2ZSBpcyBhcHByb3hpbWF0ZWQgYXMgdGhlIHNsb3BlIG9mIHRoZSBzZWNhbnQgbGluZSBiZXR3ZWVuIGVhY2ggYWRqYWNlbnQgUG9pbnQuXHJcbiAgICogT3VyIHZlcnNpb24gY29uc2lkZXJzIGJvdGggdGhlIHNsb3BlIG9mIHRoZSBzZWNhbnQgbGluZXMgZnJvbSB0aGUgbGVmdCBhbmQgcmlnaHQgc2lkZXMgb2YgZXZlcnkgcG9pbnQuIFNlZVxyXG4gICAqIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL051bWVyaWNhbF9kaWZmZXJlbnRpYXRpb25cclxuICAgKlxyXG4gICAqIFNwZWNpYWwgY29uc2lkZXJhdGlvbiBpcyBnaXZlbiB0byBwb2ludHMgb2Ygb3JpZ2luYWxDdXJ2ZSB0aGF0IGFyZSAnY3VzcCcgb3IgJ2Rpc2NvbnRpbnVvdXMnXHJcbiAgICogRm9yIHRoZXNlIGNhc2VzLCB0aGUgc2ltcGxlIGFsZ29yaXRobSBvZiBhdmVyYWdpbmcgdGhlIHNsb3BlIG9mIHRoZSBzZWNhbnQgbGluZXMgZnJvbSB0aGUgbGVmdCBhbmQgcmlnaHQgc2lkZSBvZiBldmVyeSBwb2ludFxyXG4gICAqIGlzIGluY29ycmVjdC4gSW5zdGVhZCwgZm9yIHBvaW50cyBhdCB0aGUgZWRnZSBvZiBkaXNjb250aW51aXRpZXMsIHdlIHVzZSB0aGUgdmFsdWUgb2YgdGhlIHNsb3BlIHRoYXQgaXMgYXZhaWxhYmxlLlxyXG4gICAqXHJcbiAgICogVGhlIHBvaW50IHR5cGUgb2YgdGhlIGRlcml2YXRpdmUgaXMgdXBkYXRlZC4gVGhlIHBvaW50IHR5cGUgaXMgXCJwcm9tb3RlZFwiLCB3aGljaCBtZWFucyB0aGF0ICdjdXNwJyBhbmQgJ2Rpc2NvbnRpbnVvdXMnXHJcbiAgICogdHlwZSBpbiB0aGUgb3JpZ2luYWwgY3VydmUgYmVjb21lcyBkaXNjb250aW51aXR5IGluIHRoZSBkZXJpdmF0aXZlLCBidXQgJ3Ntb290aCcgb3JpZ2luYWwgcG9pbnQgcmVtYWlucyAnc21vb3RoJy5cclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZURlcml2YXRpdmUoKTogdm9pZCB7XHJcblxyXG4gICAgY29uc3Qgb3JpZ2luYWxQb2ludHMgPSB0aGlzLm9yaWdpbmFsQ3VydmUucG9pbnRzO1xyXG5cclxuICAgIGNvbnN0IGxlbmd0aCA9IG9yaWdpbmFsUG9pbnRzLmxlbmd0aDtcclxuXHJcbiAgICAvLyBTbG9wZSB0byB0aGUgbGVmdCBvZiBhIHBvaW50LiBJdCBtYXkgbm90IGV4aXN0IGlmIHRoZSBwb2ludCBpcyBhdCB0aGUgYmVnaW5uaW5nIG9mIG91ciBjdXJ2ZSByYW5nZVxyXG4gICAgbGV0IGJhY2t3YXJkU2xvcGU6IG51bWJlciB8IG51bGw7XHJcblxyXG4gICAgLy8gU2xvcGUgdG8gdGhlIHJpZ2h0IG9mIGEgcG9pbnQuIEl0IG1heSBub3QgZXhpc3QgaWYgdGhlIHBvaW50IGlzIGF0IHRoZSBlbmQgb2YgdGhlIGN1cnZlIHJhbmdlXHJcbiAgICBsZXQgZm9yd2FyZFNsb3BlOiBudW1iZXIgfCBudWxsO1xyXG5cclxuICAgIGZvciAoIGxldCBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkge1xyXG4gICAgICBjb25zdCBwcmV2aW91c1BvaW50ID0gaW5kZXggPiAwID8gb3JpZ2luYWxQb2ludHNbIGluZGV4IC0gMSBdIDogbnVsbDtcclxuICAgICAgY29uc3QgcG9pbnQgPSBvcmlnaW5hbFBvaW50c1sgaW5kZXggXTtcclxuICAgICAgY29uc3QgbmV4dFBvaW50ID0gaW5kZXggPCBsZW5ndGggLSAxID8gb3JpZ2luYWxQb2ludHNbIGluZGV4ICsgMSBdIDogbnVsbDtcclxuXHJcbiAgICAgIGlmICggcHJldmlvdXNQb2ludCA9PT0gbnVsbCB8fCBwb2ludC5pc0N1c3AgJiYgcHJldmlvdXNQb2ludC5pc0N1c3AgfHwgKCBwb2ludC5pc0Rpc2NvbnRpbnVvdXMgJiYgcHJldmlvdXNQb2ludC5pc0Rpc2NvbnRpbnVvdXMgKSApIHtcclxuICAgICAgICBiYWNrd2FyZFNsb3BlID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBiYWNrd2FyZFNsb3BlID0gcG9pbnQuZ2V0U2xvcGUoIHByZXZpb3VzUG9pbnQgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCBuZXh0UG9pbnQgPT09IG51bGwgfHwgcG9pbnQuaXNDdXNwICYmIG5leHRQb2ludC5pc0N1c3AgfHwgKCBwb2ludC5pc0Rpc2NvbnRpbnVvdXMgJiYgbmV4dFBvaW50LmlzRGlzY29udGludW91cyApICkge1xyXG4gICAgICAgIGZvcndhcmRTbG9wZSA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgZm9yd2FyZFNsb3BlID0gcG9pbnQuZ2V0U2xvcGUoIG5leHRQb2ludCApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIHR5cGVvZiBiYWNrd2FyZFNsb3BlID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgZm9yd2FyZFNsb3BlID09PSAnbnVtYmVyJyApIHtcclxuXHJcbiAgICAgICAgLy8gQmVzdCBjYXNlIHNjZW5hcmlvOiBCb3RoIHNsb3BlcyBleGlzdC4gV2UgYXZlcmFnZSB0aGVtIHRvIGdldCB0aGUgc3ltbWV0cmljIGRpZmZlcmVuY2UgcXVvdGllbnQsXHJcbiAgICAgICAgLy8gd2hpY2ggaXMgYSBiZXR0ZXIgbnVtZXJpY2FsIGFwcHJveGltYXRpb24gb2YgdGhlIGRlcml2YXRpdmUgdGhhbiB0aGUgdXN1YWwgZGlmZmVyZW5jZSBxdW90aWVudFxyXG4gICAgICAgIHRoaXMucG9pbnRzWyBpbmRleCBdLnkgPSAoIGJhY2t3YXJkU2xvcGUgKyBmb3J3YXJkU2xvcGUgKSAvIDI7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHR5cGVvZiBiYWNrd2FyZFNsb3BlID09PSAnbnVtYmVyJyApIHtcclxuXHJcbiAgICAgICAgLy8gSWYgb25seSB0aGUgc2xvcGUgb2YgdGhlIGxlZnQgc2lkZSBleGlzdHMsIHVzZSB0aGF0IGFzIHRoZSBkZXJpdmF0aXZlLlxyXG4gICAgICAgIHRoaXMucG9pbnRzWyBpbmRleCBdLnkgPSBiYWNrd2FyZFNsb3BlO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCB0eXBlb2YgZm9yd2FyZFNsb3BlID09PSAnbnVtYmVyJyApIHtcclxuXHJcbiAgICAgICAgLy8gSWYgb25seSB0aGUgc2xvcGUgb2YgdGhlIHJpZ2h0IHNpZGUgZXhpc3RzLCB1c2UgdGhhdCBhcyB0aGUgZGVyaXZhdGl2ZS5cclxuICAgICAgICB0aGlzLnBvaW50c1sgaW5kZXggXS55ID0gZm9yd2FyZFNsb3BlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIHBvaW50LmlzQ3VzcCApIHtcclxuICAgICAgICB0aGlzLnBvaW50c1sgaW5kZXggXS5wb2ludFR5cGUgPSAnZGlzY29udGludW91cyc7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHBvaW50LmlzRGlzY29udGludW91cyApIHtcclxuICAgICAgICB0aGlzLnBvaW50c1sgaW5kZXggXS5wb2ludFR5cGUgPSAnZGlzY29udGludW91cyc7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdGhpcy5wb2ludHNbIGluZGV4IF0ucG9pbnRUeXBlID0gJ3Ntb290aCc7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2lnbmFsIG9uY2UgdGhhdCB0aGlzIEN1cnZlIGhhcyBjaGFuZ2VkLlxyXG4gICAgdGhpcy5jdXJ2ZUNoYW5nZWRFbWl0dGVyLmVtaXQoKTtcclxuICB9XHJcbn1cclxuY2FsY3VsdXNHcmFwaGVyLnJlZ2lzdGVyKCAnRGVyaXZhdGl2ZUN1cnZlJywgRGVyaXZhdGl2ZUN1cnZlICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLE9BQU9BLGVBQWUsTUFBTSwwQkFBMEI7QUFDdEQsT0FBT0MsS0FBSyxNQUFNLFlBQVk7QUFFOUIsZUFB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