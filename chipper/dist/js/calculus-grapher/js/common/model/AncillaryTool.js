// Copyright 2022-2023, University of Colorado Boulder

/**
 * AncillaryTool is the model base class associated with an x value on the graph.
 * It keeps track of the following quantities associated with the x value:
 *  - the integral of f(x)
 *  - the original function f(x)
 *  - the derivative of f(x)
 *  - the second derivative of f(x)
 *
 * @author Martin Veillette
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import optionize from '../../../../phet-core/js/optionize.js';
import PhetioObject from '../../../../tandem/js/PhetioObject.js';
import NullableIO from '../../../../tandem/js/types/NullableIO.js';
import NumberIO from '../../../../tandem/js/types/NumberIO.js';
import calculusGrapher from '../../calculusGrapher.js';
import CalculusGrapherConstants from '../CalculusGrapherConstants.js';
import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
export default class AncillaryTool extends PhetioObject {
  // Whether the tool is nominally visible (placed here for performance reason)
  // The actual scenery visibility of the tool is often not solely based on it.
  // Instead, it may be AXON/derived from this property.

  // The x coordinate of the tool

  // CurvePoints for each curve at the location of xProperty.
  // These are of type ReadOnlyProperty so that we can call notifyListenersStatic.
  // CurvePoints for each curve at the location of xProperty.
  // These are of type ReadOnlyProperty in case we want to link to them via addLinkedElement in subclasses.
  constructor(integralCurve, originalCurve, derivativeCurve, secondDerivativeCurve, providedOptions) {
    const options = optionize()({
      // SelfOptions
      visible: false,
      yIntegralPropertyFeatured: true,
      yOriginalPropertyFeatured: true,
      yDerivativePropertyFeatured: true,
      ySecondDerivativePropertyFeatured: true,
      // PhetioObjectOptions
      phetioState: false
    }, providedOptions);
    super(options);
    this.visibleProperty = new BooleanProperty(options.visible, {
      tandem: options.tandem.createTandem('visibleProperty'),
      phetioFeatured: true
    });
    this.xProperty = new NumberProperty(options.x, {
      range: CalculusGrapherConstants.CURVE_X_RANGE,
      tandem: options.tandem.createTandem('xProperty'),
      phetioFeatured: true
    });

    // The CurvePoint at xProperty for each curve.
    this.integralCurvePointProperty = createCurvePointProperty(integralCurve, this.xProperty);
    this.originalCurvePointProperty = createCurvePointProperty(originalCurve, this.xProperty);
    this.derivativeCurvePointProperty = createCurvePointProperty(derivativeCurve, this.xProperty);
    this.secondDerivativeCurvePointProperty = createCurvePointProperty(secondDerivativeCurve, this.xProperty);

    // Create PhET-iO-only Properties for each of the above CurvePointProperty instances, where y is mapped to null
    // when there is a discontinuity. These are not used anywhere in the code - they exist solely so that the PhET-iO
    // client can inspect them. They are not garbage collected because they are registered with the PhET-iO tandem registry.
    this.yIntegralProperty = createYProperty(this.integralCurvePointProperty, options.tandem.createTandem('yIntegralProperty'), options.yIntegralPropertyFeatured);
    this.yOriginalProperty = createYProperty(this.originalCurvePointProperty, options.tandem.createTandem('yOriginalProperty'), options.yOriginalPropertyFeatured);
    this.yDerivativeProperty = createYProperty(this.derivativeCurvePointProperty, options.tandem.createTandem('yDerivativeProperty'), options.yDerivativePropertyFeatured);
    this.ySecondDerivativeProperty = createYProperty(this.secondDerivativeCurvePointProperty, options.tandem.createTandem('ySecondDerivativeProperty'), options.ySecondDerivativePropertyFeatured);

    // When a curve changes, force listeners of CurvePointProperty instances to be notified, which will cause them
    // to re-inspect the CurvePoint values. We need to do this because CurvePoint instances are mutated as a curve is
    // manipulated, and the value of these Properties will therefore not change.
    const integralCurveListener = () => this.integralCurvePointProperty.notifyListenersStatic();
    const originalCurveListener = () => this.originalCurvePointProperty.notifyListenersStatic();
    const derivativeCurveListener = () => this.derivativeCurvePointProperty.notifyListenersStatic();
    const secondDerivativeCurveListener = () => this.secondDerivativeCurvePointProperty.notifyListenersStatic();

    // Optimization: Only listen to curveChangedEmitter when this tool is visible.
    this.visibleProperty.link(visible => {
      if (visible) {
        // Attach listeners
        integralCurve.curveChangedEmitter.addListener(integralCurveListener);
        originalCurve.curveChangedEmitter.addListener(originalCurveListener);
        derivativeCurve.curveChangedEmitter.addListener(derivativeCurveListener);
        secondDerivativeCurve.curveChangedEmitter.addListener(secondDerivativeCurveListener);

        // Update immediately by calling listeners.
        integralCurveListener();
        originalCurveListener();
        derivativeCurveListener();
        secondDerivativeCurveListener();
      } else {
        if (integralCurve.curveChangedEmitter.hasListener(integralCurveListener)) {
          integralCurve.curveChangedEmitter.removeListener(integralCurveListener);
        }
        if (originalCurve.curveChangedEmitter.hasListener(originalCurveListener)) {
          originalCurve.curveChangedEmitter.removeListener(originalCurveListener);
        }
        if (derivativeCurve.curveChangedEmitter.hasListener(derivativeCurveListener)) {
          derivativeCurve.curveChangedEmitter.removeListener(derivativeCurveListener);
        }
        if (secondDerivativeCurve.curveChangedEmitter.hasListener(secondDerivativeCurveListener)) {
          secondDerivativeCurve.curveChangedEmitter.removeListener(secondDerivativeCurveListener);
        }
      }
    });
  }
  reset() {
    this.visibleProperty.reset();
    this.xProperty.reset();
  }
}

/**
 * As the xProperty for a curve changes, provide the corresponding CurvePoint.
 * Note that curve.pointsProperty may also be changed via PhET-iO, see https://github.com/phetsims/calculus-grapher/issues/307.
 * Return type is ReadOnlyProperty so that we can call notifyListenersStatic.
 */
function createCurvePointProperty(curve, xProperty) {
  return new DerivedProperty([curve.pointsProperty, xProperty], (points, x) => curve.getClosestPointAt(x));
}

/**
 * As a CurvePoint changes, provide the corresponding y value, mapping discontinuities to null.
 * This null representation is used only for presentation in PhET-iO/Studio.
 * The return type is ReadOnlyProperty because we may want to link to these in subclasses.
 */
function createYProperty(curvePointProperty, tandem, phetioFeatured) {
  return new DerivedProperty([curvePointProperty], curvePoint => curvePoint.isDiscontinuous ? null : curvePoint.y, {
    tandem: tandem,
    phetioFeatured: phetioFeatured,
    phetioValueType: NullableIO(NumberIO)
  });
}
calculusGrapher.register('AncillaryTool', AncillaryTool);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJOdW1iZXJQcm9wZXJ0eSIsIm9wdGlvbml6ZSIsIlBoZXRpb09iamVjdCIsIk51bGxhYmxlSU8iLCJOdW1iZXJJTyIsImNhbGN1bHVzR3JhcGhlciIsIkNhbGN1bHVzR3JhcGhlckNvbnN0YW50cyIsIkJvb2xlYW5Qcm9wZXJ0eSIsIkFuY2lsbGFyeVRvb2wiLCJjb25zdHJ1Y3RvciIsImludGVncmFsQ3VydmUiLCJvcmlnaW5hbEN1cnZlIiwiZGVyaXZhdGl2ZUN1cnZlIiwic2Vjb25kRGVyaXZhdGl2ZUN1cnZlIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsInZpc2libGUiLCJ5SW50ZWdyYWxQcm9wZXJ0eUZlYXR1cmVkIiwieU9yaWdpbmFsUHJvcGVydHlGZWF0dXJlZCIsInlEZXJpdmF0aXZlUHJvcGVydHlGZWF0dXJlZCIsInlTZWNvbmREZXJpdmF0aXZlUHJvcGVydHlGZWF0dXJlZCIsInBoZXRpb1N0YXRlIiwidmlzaWJsZVByb3BlcnR5IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwicGhldGlvRmVhdHVyZWQiLCJ4UHJvcGVydHkiLCJ4IiwicmFuZ2UiLCJDVVJWRV9YX1JBTkdFIiwiaW50ZWdyYWxDdXJ2ZVBvaW50UHJvcGVydHkiLCJjcmVhdGVDdXJ2ZVBvaW50UHJvcGVydHkiLCJvcmlnaW5hbEN1cnZlUG9pbnRQcm9wZXJ0eSIsImRlcml2YXRpdmVDdXJ2ZVBvaW50UHJvcGVydHkiLCJzZWNvbmREZXJpdmF0aXZlQ3VydmVQb2ludFByb3BlcnR5IiwieUludGVncmFsUHJvcGVydHkiLCJjcmVhdGVZUHJvcGVydHkiLCJ5T3JpZ2luYWxQcm9wZXJ0eSIsInlEZXJpdmF0aXZlUHJvcGVydHkiLCJ5U2Vjb25kRGVyaXZhdGl2ZVByb3BlcnR5IiwiaW50ZWdyYWxDdXJ2ZUxpc3RlbmVyIiwibm90aWZ5TGlzdGVuZXJzU3RhdGljIiwib3JpZ2luYWxDdXJ2ZUxpc3RlbmVyIiwiZGVyaXZhdGl2ZUN1cnZlTGlzdGVuZXIiLCJzZWNvbmREZXJpdmF0aXZlQ3VydmVMaXN0ZW5lciIsImxpbmsiLCJjdXJ2ZUNoYW5nZWRFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJoYXNMaXN0ZW5lciIsInJlbW92ZUxpc3RlbmVyIiwicmVzZXQiLCJjdXJ2ZSIsInBvaW50c1Byb3BlcnR5IiwicG9pbnRzIiwiZ2V0Q2xvc2VzdFBvaW50QXQiLCJjdXJ2ZVBvaW50UHJvcGVydHkiLCJjdXJ2ZVBvaW50IiwiaXNEaXNjb250aW51b3VzIiwieSIsInBoZXRpb1ZhbHVlVHlwZSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQW5jaWxsYXJ5VG9vbC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMi0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBbmNpbGxhcnlUb29sIGlzIHRoZSBtb2RlbCBiYXNlIGNsYXNzIGFzc29jaWF0ZWQgd2l0aCBhbiB4IHZhbHVlIG9uIHRoZSBncmFwaC5cclxuICogSXQga2VlcHMgdHJhY2sgb2YgdGhlIGZvbGxvd2luZyBxdWFudGl0aWVzIGFzc29jaWF0ZWQgd2l0aCB0aGUgeCB2YWx1ZTpcclxuICogIC0gdGhlIGludGVncmFsIG9mIGYoeClcclxuICogIC0gdGhlIG9yaWdpbmFsIGZ1bmN0aW9uIGYoeClcclxuICogIC0gdGhlIGRlcml2YXRpdmUgb2YgZih4KVxyXG4gKiAgLSB0aGUgc2Vjb25kIGRlcml2YXRpdmUgb2YgZih4KVxyXG4gKlxyXG4gKiBAYXV0aG9yIE1hcnRpbiBWZWlsbGV0dGVcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IE51bWJlclByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTnVtYmVyUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBvcHRpb25pemUgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XHJcbmltcG9ydCBQaWNrUmVxdWlyZWQgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1BpY2tSZXF1aXJlZC5qcyc7XHJcbmltcG9ydCBQaGV0aW9PYmplY3QsIHsgUGhldGlvT2JqZWN0T3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9QaGV0aW9PYmplY3QuanMnO1xyXG5pbXBvcnQgTnVsbGFibGVJTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvTnVsbGFibGVJTy5qcyc7XHJcbmltcG9ydCBOdW1iZXJJTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvTnVtYmVySU8uanMnO1xyXG5pbXBvcnQgY2FsY3VsdXNHcmFwaGVyIGZyb20gJy4uLy4uL2NhbGN1bHVzR3JhcGhlci5qcyc7XHJcbmltcG9ydCBDYWxjdWx1c0dyYXBoZXJDb25zdGFudHMgZnJvbSAnLi4vQ2FsY3VsdXNHcmFwaGVyQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEN1cnZlIGZyb20gJy4vQ3VydmUuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQ3VydmVQb2ludCBmcm9tICcuL0N1cnZlUG9pbnQuanMnO1xyXG5pbXBvcnQgUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1JlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICB4OiBudW1iZXI7IC8vIEluaXRpYWwgdmFsdWUgb2YgeFByb3BlcnR5XHJcbiAgdmlzaWJsZT86IGJvb2xlYW47IC8vIEluaXRpYWwgdmlzaWJpbGl0eSBvZiB0aGUgdG9vbFxyXG5cclxuICAvLyBTbyB0aGF0IHN1YmNsYXNzZXMgY2FuIGN1c3RvbWl6ZSB3aGljaCBQcm9wZXJ0aWVzIGFyZSBmZWF0dXJlZCBpbiBTdHVkaW8uXHJcbiAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8yMjVcclxuICB5SW50ZWdyYWxQcm9wZXJ0eUZlYXR1cmVkPzogYm9vbGVhbjtcclxuICB5T3JpZ2luYWxQcm9wZXJ0eUZlYXR1cmVkPzogYm9vbGVhbjtcclxuICB5RGVyaXZhdGl2ZVByb3BlcnR5RmVhdHVyZWQ/OiBib29sZWFuO1xyXG4gIHlTZWNvbmREZXJpdmF0aXZlUHJvcGVydHlGZWF0dXJlZD86IGJvb2xlYW47XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBBbmNpbGxhcnlUb29sT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgUGlja1JlcXVpcmVkPFBoZXRpb09iamVjdE9wdGlvbnMsICd0YW5kZW0nPjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFuY2lsbGFyeVRvb2wgZXh0ZW5kcyBQaGV0aW9PYmplY3Qge1xyXG5cclxuICAvLyBXaGV0aGVyIHRoZSB0b29sIGlzIG5vbWluYWxseSB2aXNpYmxlIChwbGFjZWQgaGVyZSBmb3IgcGVyZm9ybWFuY2UgcmVhc29uKVxyXG4gIC8vIFRoZSBhY3R1YWwgc2NlbmVyeSB2aXNpYmlsaXR5IG9mIHRoZSB0b29sIGlzIG9mdGVuIG5vdCBzb2xlbHkgYmFzZWQgb24gaXQuXHJcbiAgLy8gSW5zdGVhZCwgaXQgbWF5IGJlIEFYT04vZGVyaXZlZCBmcm9tIHRoaXMgcHJvcGVydHkuXHJcbiAgcHVibGljIHJlYWRvbmx5IHZpc2libGVQcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIFRoZSB4IGNvb3JkaW5hdGUgb2YgdGhlIHRvb2xcclxuICBwdWJsaWMgcmVhZG9ubHkgeFByb3BlcnR5OiBOdW1iZXJQcm9wZXJ0eTtcclxuXHJcbiAgLy8gQ3VydmVQb2ludHMgZm9yIGVhY2ggY3VydmUgYXQgdGhlIGxvY2F0aW9uIG9mIHhQcm9wZXJ0eS5cclxuICAvLyBUaGVzZSBhcmUgb2YgdHlwZSBSZWFkT25seVByb3BlcnR5IHNvIHRoYXQgd2UgY2FuIGNhbGwgbm90aWZ5TGlzdGVuZXJzU3RhdGljLlxyXG4gIHB1YmxpYyByZWFkb25seSBpbnRlZ3JhbEN1cnZlUG9pbnRQcm9wZXJ0eTogUmVhZE9ubHlQcm9wZXJ0eTxDdXJ2ZVBvaW50PjtcclxuICBwdWJsaWMgcmVhZG9ubHkgb3JpZ2luYWxDdXJ2ZVBvaW50UHJvcGVydHk6IFJlYWRPbmx5UHJvcGVydHk8Q3VydmVQb2ludD47XHJcbiAgcHVibGljIHJlYWRvbmx5IGRlcml2YXRpdmVDdXJ2ZVBvaW50UHJvcGVydHk6IFJlYWRPbmx5UHJvcGVydHk8Q3VydmVQb2ludD47XHJcbiAgcHVibGljIHJlYWRvbmx5IHNlY29uZERlcml2YXRpdmVDdXJ2ZVBvaW50UHJvcGVydHk6IFJlYWRPbmx5UHJvcGVydHk8Q3VydmVQb2ludD47XHJcblxyXG4gIC8vIEN1cnZlUG9pbnRzIGZvciBlYWNoIGN1cnZlIGF0IHRoZSBsb2NhdGlvbiBvZiB4UHJvcGVydHkuXHJcbiAgLy8gVGhlc2UgYXJlIG9mIHR5cGUgUmVhZE9ubHlQcm9wZXJ0eSBpbiBjYXNlIHdlIHdhbnQgdG8gbGluayB0byB0aGVtIHZpYSBhZGRMaW5rZWRFbGVtZW50IGluIHN1YmNsYXNzZXMuXHJcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IHlJbnRlZ3JhbFByb3BlcnR5OiBSZWFkT25seVByb3BlcnR5PG51bWJlciB8IG51bGw+O1xyXG4gIHByb3RlY3RlZCByZWFkb25seSB5T3JpZ2luYWxQcm9wZXJ0eTogUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXIgfCBudWxsPjtcclxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgeURlcml2YXRpdmVQcm9wZXJ0eTogUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXIgfCBudWxsPjtcclxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgeVNlY29uZERlcml2YXRpdmVQcm9wZXJ0eTogUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXIgfCBudWxsPjtcclxuXHJcbiAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKCBpbnRlZ3JhbEN1cnZlOiBDdXJ2ZSwgb3JpZ2luYWxDdXJ2ZTogQ3VydmUsIGRlcml2YXRpdmVDdXJ2ZTogQ3VydmUsIHNlY29uZERlcml2YXRpdmVDdXJ2ZTogQ3VydmUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnM6IEFuY2lsbGFyeVRvb2xPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8QW5jaWxsYXJ5VG9vbE9wdGlvbnMsIFNlbGZPcHRpb25zLCBQaGV0aW9PYmplY3RPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBTZWxmT3B0aW9uc1xyXG4gICAgICB2aXNpYmxlOiBmYWxzZSxcclxuICAgICAgeUludGVncmFsUHJvcGVydHlGZWF0dXJlZDogdHJ1ZSxcclxuICAgICAgeU9yaWdpbmFsUHJvcGVydHlGZWF0dXJlZDogdHJ1ZSxcclxuICAgICAgeURlcml2YXRpdmVQcm9wZXJ0eUZlYXR1cmVkOiB0cnVlLFxyXG4gICAgICB5U2Vjb25kRGVyaXZhdGl2ZVByb3BlcnR5RmVhdHVyZWQ6IHRydWUsXHJcblxyXG4gICAgICAvLyBQaGV0aW9PYmplY3RPcHRpb25zXHJcbiAgICAgIHBoZXRpb1N0YXRlOiBmYWxzZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICB0aGlzLnZpc2libGVQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIG9wdGlvbnMudmlzaWJsZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Zpc2libGVQcm9wZXJ0eScgKSxcclxuICAgICAgcGhldGlvRmVhdHVyZWQ6IHRydWVcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnhQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggb3B0aW9ucy54LCB7XHJcbiAgICAgIHJhbmdlOiBDYWxjdWx1c0dyYXBoZXJDb25zdGFudHMuQ1VSVkVfWF9SQU5HRSxcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICd4UHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0ZlYXR1cmVkOiB0cnVlXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gVGhlIEN1cnZlUG9pbnQgYXQgeFByb3BlcnR5IGZvciBlYWNoIGN1cnZlLlxyXG4gICAgdGhpcy5pbnRlZ3JhbEN1cnZlUG9pbnRQcm9wZXJ0eSA9IGNyZWF0ZUN1cnZlUG9pbnRQcm9wZXJ0eSggaW50ZWdyYWxDdXJ2ZSwgdGhpcy54UHJvcGVydHkgKTtcclxuICAgIHRoaXMub3JpZ2luYWxDdXJ2ZVBvaW50UHJvcGVydHkgPSBjcmVhdGVDdXJ2ZVBvaW50UHJvcGVydHkoIG9yaWdpbmFsQ3VydmUsIHRoaXMueFByb3BlcnR5ICk7XHJcbiAgICB0aGlzLmRlcml2YXRpdmVDdXJ2ZVBvaW50UHJvcGVydHkgPSBjcmVhdGVDdXJ2ZVBvaW50UHJvcGVydHkoIGRlcml2YXRpdmVDdXJ2ZSwgdGhpcy54UHJvcGVydHkgKTtcclxuICAgIHRoaXMuc2Vjb25kRGVyaXZhdGl2ZUN1cnZlUG9pbnRQcm9wZXJ0eSA9IGNyZWF0ZUN1cnZlUG9pbnRQcm9wZXJ0eSggc2Vjb25kRGVyaXZhdGl2ZUN1cnZlLCB0aGlzLnhQcm9wZXJ0eSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSBQaEVULWlPLW9ubHkgUHJvcGVydGllcyBmb3IgZWFjaCBvZiB0aGUgYWJvdmUgQ3VydmVQb2ludFByb3BlcnR5IGluc3RhbmNlcywgd2hlcmUgeSBpcyBtYXBwZWQgdG8gbnVsbFxyXG4gICAgLy8gd2hlbiB0aGVyZSBpcyBhIGRpc2NvbnRpbnVpdHkuIFRoZXNlIGFyZSBub3QgdXNlZCBhbnl3aGVyZSBpbiB0aGUgY29kZSAtIHRoZXkgZXhpc3Qgc29sZWx5IHNvIHRoYXQgdGhlIFBoRVQtaU9cclxuICAgIC8vIGNsaWVudCBjYW4gaW5zcGVjdCB0aGVtLiBUaGV5IGFyZSBub3QgZ2FyYmFnZSBjb2xsZWN0ZWQgYmVjYXVzZSB0aGV5IGFyZSByZWdpc3RlcmVkIHdpdGggdGhlIFBoRVQtaU8gdGFuZGVtIHJlZ2lzdHJ5LlxyXG4gICAgdGhpcy55SW50ZWdyYWxQcm9wZXJ0eSA9IGNyZWF0ZVlQcm9wZXJ0eSggdGhpcy5pbnRlZ3JhbEN1cnZlUG9pbnRQcm9wZXJ0eSxcclxuICAgICAgb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAneUludGVncmFsUHJvcGVydHknICksIG9wdGlvbnMueUludGVncmFsUHJvcGVydHlGZWF0dXJlZCApO1xyXG4gICAgdGhpcy55T3JpZ2luYWxQcm9wZXJ0eSA9IGNyZWF0ZVlQcm9wZXJ0eSggdGhpcy5vcmlnaW5hbEN1cnZlUG9pbnRQcm9wZXJ0eSxcclxuICAgICAgb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAneU9yaWdpbmFsUHJvcGVydHknICksIG9wdGlvbnMueU9yaWdpbmFsUHJvcGVydHlGZWF0dXJlZCApO1xyXG4gICAgdGhpcy55RGVyaXZhdGl2ZVByb3BlcnR5ID0gY3JlYXRlWVByb3BlcnR5KCB0aGlzLmRlcml2YXRpdmVDdXJ2ZVBvaW50UHJvcGVydHksXHJcbiAgICAgIG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3lEZXJpdmF0aXZlUHJvcGVydHknICksIG9wdGlvbnMueURlcml2YXRpdmVQcm9wZXJ0eUZlYXR1cmVkICk7XHJcbiAgICB0aGlzLnlTZWNvbmREZXJpdmF0aXZlUHJvcGVydHkgPSBjcmVhdGVZUHJvcGVydHkoIHRoaXMuc2Vjb25kRGVyaXZhdGl2ZUN1cnZlUG9pbnRQcm9wZXJ0eSxcclxuICAgICAgb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAneVNlY29uZERlcml2YXRpdmVQcm9wZXJ0eScgKSwgb3B0aW9ucy55U2Vjb25kRGVyaXZhdGl2ZVByb3BlcnR5RmVhdHVyZWQgKTtcclxuXHJcbiAgICAvLyBXaGVuIGEgY3VydmUgY2hhbmdlcywgZm9yY2UgbGlzdGVuZXJzIG9mIEN1cnZlUG9pbnRQcm9wZXJ0eSBpbnN0YW5jZXMgdG8gYmUgbm90aWZpZWQsIHdoaWNoIHdpbGwgY2F1c2UgdGhlbVxyXG4gICAgLy8gdG8gcmUtaW5zcGVjdCB0aGUgQ3VydmVQb2ludCB2YWx1ZXMuIFdlIG5lZWQgdG8gZG8gdGhpcyBiZWNhdXNlIEN1cnZlUG9pbnQgaW5zdGFuY2VzIGFyZSBtdXRhdGVkIGFzIGEgY3VydmUgaXNcclxuICAgIC8vIG1hbmlwdWxhdGVkLCBhbmQgdGhlIHZhbHVlIG9mIHRoZXNlIFByb3BlcnRpZXMgd2lsbCB0aGVyZWZvcmUgbm90IGNoYW5nZS5cclxuICAgIGNvbnN0IGludGVncmFsQ3VydmVMaXN0ZW5lciA9ICgpID0+IHRoaXMuaW50ZWdyYWxDdXJ2ZVBvaW50UHJvcGVydHkubm90aWZ5TGlzdGVuZXJzU3RhdGljKCk7XHJcbiAgICBjb25zdCBvcmlnaW5hbEN1cnZlTGlzdGVuZXIgPSAoKSA9PiB0aGlzLm9yaWdpbmFsQ3VydmVQb2ludFByb3BlcnR5Lm5vdGlmeUxpc3RlbmVyc1N0YXRpYygpO1xyXG4gICAgY29uc3QgZGVyaXZhdGl2ZUN1cnZlTGlzdGVuZXIgPSAoKSA9PiB0aGlzLmRlcml2YXRpdmVDdXJ2ZVBvaW50UHJvcGVydHkubm90aWZ5TGlzdGVuZXJzU3RhdGljKCk7XHJcbiAgICBjb25zdCBzZWNvbmREZXJpdmF0aXZlQ3VydmVMaXN0ZW5lciA9ICgpID0+IHRoaXMuc2Vjb25kRGVyaXZhdGl2ZUN1cnZlUG9pbnRQcm9wZXJ0eS5ub3RpZnlMaXN0ZW5lcnNTdGF0aWMoKTtcclxuXHJcbiAgICAvLyBPcHRpbWl6YXRpb246IE9ubHkgbGlzdGVuIHRvIGN1cnZlQ2hhbmdlZEVtaXR0ZXIgd2hlbiB0aGlzIHRvb2wgaXMgdmlzaWJsZS5cclxuICAgIHRoaXMudmlzaWJsZVByb3BlcnR5LmxpbmsoIHZpc2libGUgPT4ge1xyXG4gICAgICBpZiAoIHZpc2libGUgKSB7XHJcblxyXG4gICAgICAgIC8vIEF0dGFjaCBsaXN0ZW5lcnNcclxuICAgICAgICBpbnRlZ3JhbEN1cnZlLmN1cnZlQ2hhbmdlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIGludGVncmFsQ3VydmVMaXN0ZW5lciApO1xyXG4gICAgICAgIG9yaWdpbmFsQ3VydmUuY3VydmVDaGFuZ2VkRW1pdHRlci5hZGRMaXN0ZW5lciggb3JpZ2luYWxDdXJ2ZUxpc3RlbmVyICk7XHJcbiAgICAgICAgZGVyaXZhdGl2ZUN1cnZlLmN1cnZlQ2hhbmdlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIGRlcml2YXRpdmVDdXJ2ZUxpc3RlbmVyICk7XHJcbiAgICAgICAgc2Vjb25kRGVyaXZhdGl2ZUN1cnZlLmN1cnZlQ2hhbmdlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoIHNlY29uZERlcml2YXRpdmVDdXJ2ZUxpc3RlbmVyICk7XHJcblxyXG4gICAgICAgIC8vIFVwZGF0ZSBpbW1lZGlhdGVseSBieSBjYWxsaW5nIGxpc3RlbmVycy5cclxuICAgICAgICBpbnRlZ3JhbEN1cnZlTGlzdGVuZXIoKTtcclxuICAgICAgICBvcmlnaW5hbEN1cnZlTGlzdGVuZXIoKTtcclxuICAgICAgICBkZXJpdmF0aXZlQ3VydmVMaXN0ZW5lcigpO1xyXG4gICAgICAgIHNlY29uZERlcml2YXRpdmVDdXJ2ZUxpc3RlbmVyKCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgaWYgKCBpbnRlZ3JhbEN1cnZlLmN1cnZlQ2hhbmdlZEVtaXR0ZXIuaGFzTGlzdGVuZXIoIGludGVncmFsQ3VydmVMaXN0ZW5lciApICkge1xyXG4gICAgICAgICAgaW50ZWdyYWxDdXJ2ZS5jdXJ2ZUNoYW5nZWRFbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCBpbnRlZ3JhbEN1cnZlTGlzdGVuZXIgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCBvcmlnaW5hbEN1cnZlLmN1cnZlQ2hhbmdlZEVtaXR0ZXIuaGFzTGlzdGVuZXIoIG9yaWdpbmFsQ3VydmVMaXN0ZW5lciApICkge1xyXG4gICAgICAgICAgb3JpZ2luYWxDdXJ2ZS5jdXJ2ZUNoYW5nZWRFbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCBvcmlnaW5hbEN1cnZlTGlzdGVuZXIgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCBkZXJpdmF0aXZlQ3VydmUuY3VydmVDaGFuZ2VkRW1pdHRlci5oYXNMaXN0ZW5lciggZGVyaXZhdGl2ZUN1cnZlTGlzdGVuZXIgKSApIHtcclxuICAgICAgICAgIGRlcml2YXRpdmVDdXJ2ZS5jdXJ2ZUNoYW5nZWRFbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCBkZXJpdmF0aXZlQ3VydmVMaXN0ZW5lciApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIHNlY29uZERlcml2YXRpdmVDdXJ2ZS5jdXJ2ZUNoYW5nZWRFbWl0dGVyLmhhc0xpc3RlbmVyKCBzZWNvbmREZXJpdmF0aXZlQ3VydmVMaXN0ZW5lciApICkge1xyXG4gICAgICAgICAgc2Vjb25kRGVyaXZhdGl2ZUN1cnZlLmN1cnZlQ2hhbmdlZEVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoIHNlY29uZERlcml2YXRpdmVDdXJ2ZUxpc3RlbmVyICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLnZpc2libGVQcm9wZXJ0eS5yZXNldCgpO1xyXG4gICAgdGhpcy54UHJvcGVydHkucmVzZXQoKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBcyB0aGUgeFByb3BlcnR5IGZvciBhIGN1cnZlIGNoYW5nZXMsIHByb3ZpZGUgdGhlIGNvcnJlc3BvbmRpbmcgQ3VydmVQb2ludC5cclxuICogTm90ZSB0aGF0IGN1cnZlLnBvaW50c1Byb3BlcnR5IG1heSBhbHNvIGJlIGNoYW5nZWQgdmlhIFBoRVQtaU8sIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2FsY3VsdXMtZ3JhcGhlci9pc3N1ZXMvMzA3LlxyXG4gKiBSZXR1cm4gdHlwZSBpcyBSZWFkT25seVByb3BlcnR5IHNvIHRoYXQgd2UgY2FuIGNhbGwgbm90aWZ5TGlzdGVuZXJzU3RhdGljLlxyXG4gKi9cclxuZnVuY3Rpb24gY3JlYXRlQ3VydmVQb2ludFByb3BlcnR5KCBjdXJ2ZTogQ3VydmUsIHhQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8bnVtYmVyPiApOiBSZWFkT25seVByb3BlcnR5PEN1cnZlUG9pbnQ+IHtcclxuICByZXR1cm4gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBjdXJ2ZS5wb2ludHNQcm9wZXJ0eSwgeFByb3BlcnR5IF0sICggcG9pbnRzLCB4ICkgPT4gY3VydmUuZ2V0Q2xvc2VzdFBvaW50QXQoIHggKSApO1xyXG59XHJcblxyXG4vKipcclxuICogQXMgYSBDdXJ2ZVBvaW50IGNoYW5nZXMsIHByb3ZpZGUgdGhlIGNvcnJlc3BvbmRpbmcgeSB2YWx1ZSwgbWFwcGluZyBkaXNjb250aW51aXRpZXMgdG8gbnVsbC5cclxuICogVGhpcyBudWxsIHJlcHJlc2VudGF0aW9uIGlzIHVzZWQgb25seSBmb3IgcHJlc2VudGF0aW9uIGluIFBoRVQtaU8vU3R1ZGlvLlxyXG4gKiBUaGUgcmV0dXJuIHR5cGUgaXMgUmVhZE9ubHlQcm9wZXJ0eSBiZWNhdXNlIHdlIG1heSB3YW50IHRvIGxpbmsgdG8gdGhlc2UgaW4gc3ViY2xhc3Nlcy5cclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZVlQcm9wZXJ0eSggY3VydmVQb2ludFByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxDdXJ2ZVBvaW50PiwgdGFuZGVtOiBUYW5kZW0sIHBoZXRpb0ZlYXR1cmVkOiBib29sZWFuICk6XHJcbiAgUmVhZE9ubHlQcm9wZXJ0eTxudW1iZXIgfCBudWxsPiB7XHJcbiAgcmV0dXJuIG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgY3VydmVQb2ludFByb3BlcnR5IF0sIGN1cnZlUG9pbnQgPT4gY3VydmVQb2ludC5pc0Rpc2NvbnRpbnVvdXMgPyBudWxsIDogY3VydmVQb2ludC55LCB7XHJcbiAgICB0YW5kZW06IHRhbmRlbSxcclxuICAgIHBoZXRpb0ZlYXR1cmVkOiBwaGV0aW9GZWF0dXJlZCxcclxuICAgIHBoZXRpb1ZhbHVlVHlwZTogTnVsbGFibGVJTyggTnVtYmVySU8gKVxyXG4gIH0gKTtcclxufVxyXG5cclxuY2FsY3VsdXNHcmFwaGVyLnJlZ2lzdGVyKCAnQW5jaWxsYXJ5VG9vbCcsIEFuY2lsbGFyeVRvb2wgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsY0FBYyxNQUFNLHVDQUF1QztBQUVsRSxPQUFPQyxTQUFTLE1BQU0sdUNBQXVDO0FBRTdELE9BQU9DLFlBQVksTUFBK0IsdUNBQXVDO0FBQ3pGLE9BQU9DLFVBQVUsTUFBTSwyQ0FBMkM7QUFDbEUsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxPQUFPQyxlQUFlLE1BQU0sMEJBQTBCO0FBQ3RELE9BQU9DLHdCQUF3QixNQUFNLGdDQUFnQztBQUlyRSxPQUFPQyxlQUFlLE1BQU0sd0NBQXdDO0FBa0JwRSxlQUFlLE1BQU1DLGFBQWEsU0FBU04sWUFBWSxDQUFDO0VBRXREO0VBQ0E7RUFDQTs7RUFHQTs7RUFHQTtFQUNBO0VBTUE7RUFDQTtFQU1VTyxXQUFXQSxDQUFFQyxhQUFvQixFQUFFQyxhQUFvQixFQUFFQyxlQUFzQixFQUFFQyxxQkFBNEIsRUFDaEdDLGVBQXFDLEVBQUc7SUFFN0QsTUFBTUMsT0FBTyxHQUFHZCxTQUFTLENBQXlELENBQUMsQ0FBRTtNQUVuRjtNQUNBZSxPQUFPLEVBQUUsS0FBSztNQUNkQyx5QkFBeUIsRUFBRSxJQUFJO01BQy9CQyx5QkFBeUIsRUFBRSxJQUFJO01BQy9CQywyQkFBMkIsRUFBRSxJQUFJO01BQ2pDQyxpQ0FBaUMsRUFBRSxJQUFJO01BRXZDO01BQ0FDLFdBQVcsRUFBRTtJQUNmLENBQUMsRUFBRVAsZUFBZ0IsQ0FBQztJQUVwQixLQUFLLENBQUVDLE9BQVEsQ0FBQztJQUVoQixJQUFJLENBQUNPLGVBQWUsR0FBRyxJQUFJZixlQUFlLENBQUVRLE9BQU8sQ0FBQ0MsT0FBTyxFQUFFO01BQzNETyxNQUFNLEVBQUVSLE9BQU8sQ0FBQ1EsTUFBTSxDQUFDQyxZQUFZLENBQUUsaUJBQWtCLENBQUM7TUFDeERDLGNBQWMsRUFBRTtJQUNsQixDQUFFLENBQUM7SUFFSCxJQUFJLENBQUNDLFNBQVMsR0FBRyxJQUFJMUIsY0FBYyxDQUFFZSxPQUFPLENBQUNZLENBQUMsRUFBRTtNQUM5Q0MsS0FBSyxFQUFFdEIsd0JBQXdCLENBQUN1QixhQUFhO01BQzdDTixNQUFNLEVBQUVSLE9BQU8sQ0FBQ1EsTUFBTSxDQUFDQyxZQUFZLENBQUUsV0FBWSxDQUFDO01BQ2xEQyxjQUFjLEVBQUU7SUFDbEIsQ0FBRSxDQUFDOztJQUVIO0lBQ0EsSUFBSSxDQUFDSywwQkFBMEIsR0FBR0Msd0JBQXdCLENBQUVyQixhQUFhLEVBQUUsSUFBSSxDQUFDZ0IsU0FBVSxDQUFDO0lBQzNGLElBQUksQ0FBQ00sMEJBQTBCLEdBQUdELHdCQUF3QixDQUFFcEIsYUFBYSxFQUFFLElBQUksQ0FBQ2UsU0FBVSxDQUFDO0lBQzNGLElBQUksQ0FBQ08sNEJBQTRCLEdBQUdGLHdCQUF3QixDQUFFbkIsZUFBZSxFQUFFLElBQUksQ0FBQ2MsU0FBVSxDQUFDO0lBQy9GLElBQUksQ0FBQ1Esa0NBQWtDLEdBQUdILHdCQUF3QixDQUFFbEIscUJBQXFCLEVBQUUsSUFBSSxDQUFDYSxTQUFVLENBQUM7O0lBRTNHO0lBQ0E7SUFDQTtJQUNBLElBQUksQ0FBQ1MsaUJBQWlCLEdBQUdDLGVBQWUsQ0FBRSxJQUFJLENBQUNOLDBCQUEwQixFQUN2RWYsT0FBTyxDQUFDUSxNQUFNLENBQUNDLFlBQVksQ0FBRSxtQkFBb0IsQ0FBQyxFQUFFVCxPQUFPLENBQUNFLHlCQUEwQixDQUFDO0lBQ3pGLElBQUksQ0FBQ29CLGlCQUFpQixHQUFHRCxlQUFlLENBQUUsSUFBSSxDQUFDSiwwQkFBMEIsRUFDdkVqQixPQUFPLENBQUNRLE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLG1CQUFvQixDQUFDLEVBQUVULE9BQU8sQ0FBQ0cseUJBQTBCLENBQUM7SUFDekYsSUFBSSxDQUFDb0IsbUJBQW1CLEdBQUdGLGVBQWUsQ0FBRSxJQUFJLENBQUNILDRCQUE0QixFQUMzRWxCLE9BQU8sQ0FBQ1EsTUFBTSxDQUFDQyxZQUFZLENBQUUscUJBQXNCLENBQUMsRUFBRVQsT0FBTyxDQUFDSSwyQkFBNEIsQ0FBQztJQUM3RixJQUFJLENBQUNvQix5QkFBeUIsR0FBR0gsZUFBZSxDQUFFLElBQUksQ0FBQ0Ysa0NBQWtDLEVBQ3ZGbkIsT0FBTyxDQUFDUSxNQUFNLENBQUNDLFlBQVksQ0FBRSwyQkFBNEIsQ0FBQyxFQUFFVCxPQUFPLENBQUNLLGlDQUFrQyxDQUFDOztJQUV6RztJQUNBO0lBQ0E7SUFDQSxNQUFNb0IscUJBQXFCLEdBQUdBLENBQUEsS0FBTSxJQUFJLENBQUNWLDBCQUEwQixDQUFDVyxxQkFBcUIsQ0FBQyxDQUFDO0lBQzNGLE1BQU1DLHFCQUFxQixHQUFHQSxDQUFBLEtBQU0sSUFBSSxDQUFDViwwQkFBMEIsQ0FBQ1MscUJBQXFCLENBQUMsQ0FBQztJQUMzRixNQUFNRSx1QkFBdUIsR0FBR0EsQ0FBQSxLQUFNLElBQUksQ0FBQ1YsNEJBQTRCLENBQUNRLHFCQUFxQixDQUFDLENBQUM7SUFDL0YsTUFBTUcsNkJBQTZCLEdBQUdBLENBQUEsS0FBTSxJQUFJLENBQUNWLGtDQUFrQyxDQUFDTyxxQkFBcUIsQ0FBQyxDQUFDOztJQUUzRztJQUNBLElBQUksQ0FBQ25CLGVBQWUsQ0FBQ3VCLElBQUksQ0FBRTdCLE9BQU8sSUFBSTtNQUNwQyxJQUFLQSxPQUFPLEVBQUc7UUFFYjtRQUNBTixhQUFhLENBQUNvQyxtQkFBbUIsQ0FBQ0MsV0FBVyxDQUFFUCxxQkFBc0IsQ0FBQztRQUN0RTdCLGFBQWEsQ0FBQ21DLG1CQUFtQixDQUFDQyxXQUFXLENBQUVMLHFCQUFzQixDQUFDO1FBQ3RFOUIsZUFBZSxDQUFDa0MsbUJBQW1CLENBQUNDLFdBQVcsQ0FBRUosdUJBQXdCLENBQUM7UUFDMUU5QixxQkFBcUIsQ0FBQ2lDLG1CQUFtQixDQUFDQyxXQUFXLENBQUVILDZCQUE4QixDQUFDOztRQUV0RjtRQUNBSixxQkFBcUIsQ0FBQyxDQUFDO1FBQ3ZCRSxxQkFBcUIsQ0FBQyxDQUFDO1FBQ3ZCQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQ3pCQyw2QkFBNkIsQ0FBQyxDQUFDO01BQ2pDLENBQUMsTUFDSTtRQUNILElBQUtsQyxhQUFhLENBQUNvQyxtQkFBbUIsQ0FBQ0UsV0FBVyxDQUFFUixxQkFBc0IsQ0FBQyxFQUFHO1VBQzVFOUIsYUFBYSxDQUFDb0MsbUJBQW1CLENBQUNHLGNBQWMsQ0FBRVQscUJBQXNCLENBQUM7UUFDM0U7UUFDQSxJQUFLN0IsYUFBYSxDQUFDbUMsbUJBQW1CLENBQUNFLFdBQVcsQ0FBRU4scUJBQXNCLENBQUMsRUFBRztVQUM1RS9CLGFBQWEsQ0FBQ21DLG1CQUFtQixDQUFDRyxjQUFjLENBQUVQLHFCQUFzQixDQUFDO1FBQzNFO1FBQ0EsSUFBSzlCLGVBQWUsQ0FBQ2tDLG1CQUFtQixDQUFDRSxXQUFXLENBQUVMLHVCQUF3QixDQUFDLEVBQUc7VUFDaEYvQixlQUFlLENBQUNrQyxtQkFBbUIsQ0FBQ0csY0FBYyxDQUFFTix1QkFBd0IsQ0FBQztRQUMvRTtRQUNBLElBQUs5QixxQkFBcUIsQ0FBQ2lDLG1CQUFtQixDQUFDRSxXQUFXLENBQUVKLDZCQUE4QixDQUFDLEVBQUc7VUFDNUYvQixxQkFBcUIsQ0FBQ2lDLG1CQUFtQixDQUFDRyxjQUFjLENBQUVMLDZCQUE4QixDQUFDO1FBQzNGO01BQ0Y7SUFDRixDQUFFLENBQUM7RUFDTDtFQUVPTSxLQUFLQSxDQUFBLEVBQVM7SUFDbkIsSUFBSSxDQUFDNUIsZUFBZSxDQUFDNEIsS0FBSyxDQUFDLENBQUM7SUFDNUIsSUFBSSxDQUFDeEIsU0FBUyxDQUFDd0IsS0FBSyxDQUFDLENBQUM7RUFDeEI7QUFDRjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBU25CLHdCQUF3QkEsQ0FBRW9CLEtBQVksRUFBRXpCLFNBQW9DLEVBQWlDO0VBQ3BILE9BQU8sSUFBSTNCLGVBQWUsQ0FBRSxDQUFFb0QsS0FBSyxDQUFDQyxjQUFjLEVBQUUxQixTQUFTLENBQUUsRUFBRSxDQUFFMkIsTUFBTSxFQUFFMUIsQ0FBQyxLQUFNd0IsS0FBSyxDQUFDRyxpQkFBaUIsQ0FBRTNCLENBQUUsQ0FBRSxDQUFDO0FBQ2xIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTUyxlQUFlQSxDQUFFbUIsa0JBQWlELEVBQUVoQyxNQUFjLEVBQUVFLGNBQXVCLEVBQ2xGO0VBQ2hDLE9BQU8sSUFBSTFCLGVBQWUsQ0FBRSxDQUFFd0Qsa0JBQWtCLENBQUUsRUFBRUMsVUFBVSxJQUFJQSxVQUFVLENBQUNDLGVBQWUsR0FBRyxJQUFJLEdBQUdELFVBQVUsQ0FBQ0UsQ0FBQyxFQUFFO0lBQ2xIbkMsTUFBTSxFQUFFQSxNQUFNO0lBQ2RFLGNBQWMsRUFBRUEsY0FBYztJQUM5QmtDLGVBQWUsRUFBRXhELFVBQVUsQ0FBRUMsUUFBUztFQUN4QyxDQUFFLENBQUM7QUFDTDtBQUVBQyxlQUFlLENBQUN1RCxRQUFRLENBQUUsZUFBZSxFQUFFcEQsYUFBYyxDQUFDIn0=