// Copyright 2020-2023, University of Colorado Boulder

/**
 * CalculusGrapherModel is the base class for the top-level model of every screen in the 'Calculus Grapher' simulation.
 *
 * @author Brandon Li
 * @author Martin Veillette
 * @author Chris Malley (PixelZoom, Inc.)
 */

import calculusGrapher from '../../calculusGrapher.js';
import DerivativeCurve from './DerivativeCurve.js';
import SecondDerivativeCurve from './SecondDerivativeCurve.js';
import optionize from '../../../../phet-core/js/optionize.js';
import IntegralCurve from './IntegralCurve.js';
import PhetioObject from '../../../../tandem/js/PhetioObject.js';
import CurveManipulationMode from './CurveManipulationMode.js';
import CurveManipulationProperties from './CurveManipulationProperties.js';
import TransformedCurve from './TransformedCurve.js';
import GraphType from './GraphType.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import Property from '../../../../axon/js/Property.js';
import CalculusGrapherConstants from '../CalculusGrapherConstants.js';
import ReferenceLine from './ReferenceLine.js';
import LabeledLine from './LabeledLine.js';
import LabeledPoint from './LabeledPoint.js';
import GraphSet from './GraphSet.js';
import CalculusGrapherPreferences from './CalculusGrapherPreferences.js';
import BooleanIO from '../../../../tandem/js/types/BooleanIO.js';
export default class CalculusGrapherModel {
  // The graph sets that are supported by this model

  // The graphSet that is currently selected and displayed

  // Properties associated with curve manipulation

  // Whether the 'Predict' radio button is selected

  // Whether the 'Predict' feature is enabled for the original graph.
  // The Predict preferences must be turned on, and the Predict radio button must be selected.
  // Controls visibility of grid lines on all graphs
  // The curve that appears as f(x) or f(t), depending on the 'Variable' preference setting.
  // The user can manipulate this curve by clicking of click-dragging in the graph.
  // The decision to call it the 'original' curve is documented in https://github.com/phetsims/calculus-grapher/issues/119
  // The curve that appears when the user has turned on the 'Predict' preference setting, and has selected the
  // Predict radio button that appears in the control panel. This curve can also be manipulated by the user.
  // Its purpose is to facilitate predicting what originalCurve looks like, based on seeing one or more of the
  // derived curves.
  // These curves are derived, not manipulated by the user.
  // Indicates which curve (originalCurve or predictCurve) is being modified by the user.
  // Model elements for the various tools
  // If subclasses add additional tools, use this as the parent tandem for those tools.
  // These exist so that we have something to PhET-iO link to from the view.
  // See https://github.com/phetsims/calculus-grapher/issues/198
  constructor(providedOptions) {
    const options = optionize()({
      // SelfOptions
      graphSet: providedOptions.graphSets[0],
      curveManipulationModeChoices: CurveManipulationMode.enumeration.values,
      hasTangentScrubber: false,
      hasAreaUnderCurveScrubber: false
    }, providedOptions);
    assert && assert(options.graphSets.length > 0, 'there must be at least one valid graphSet');
    assert && assert(_.every(options.graphSets, graphSet => graphSet.length === options.graphSets[0].length), 'all elements of graphSets must have the same length, a current limitation of this sim');
    assert && assert(options.graphSets.includes(options.graphSet));
    this.graphSets = options.graphSets;
    this.graphSetProperty = new Property(options.graphSet, {
      validValues: options.graphSets,
      tandem: options.graphSets.length > 1 ? options.tandem.createTandem('graphSetProperty') : Tandem.OPT_OUT,
      phetioValueType: GraphSet.GraphSetIO,
      phetioDocumentation: 'Identifies the types of graphs that are displayed, and how they are grouped. ' + 'Radio buttons are available for choosing the desired set. See graphSetRadioButtonGroup.'
    });
    this.curveManipulationProperties = new CurveManipulationProperties(options.curveManipulationModeChoices, {
      tandem: options.tandem.createTandem('curveManipulationProperties')
    });
    this.predictSelectedProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('predictSelectedProperty'),
      phetioFeatured: true,
      phetioDocumentation: 'Whether the Predict radio button is selected. This will have no affect unless the ' + 'Predict preference is enabled.'
    });
    this.predictEnabledProperty = DerivedProperty.and([CalculusGrapherPreferences.predictPreferenceEnabledProperty, this.predictSelectedProperty], {
      tandem: options.tandem.createTandem('predictEnabledProperty'),
      phetioValueType: BooleanIO,
      phetioFeatured: true,
      phetioDocumentation: 'Whether the Predict feature is enabled. ' + 'This is true only if the Predict preference is enabled, and the Predict radio button is selected.'
    });
    this.gridVisibleProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('gridVisibleProperty'),
      phetioFeatured: true,
      phetioDocumentation: 'Controls the visibility of the grid lines for all graphs.'
    });
    const curvesTandem = options.tandem.createTandem('curves');
    this.originalCurve = new TransformedCurve({
      // OriginalCurve is always instrumented, because it should always be present.
      tandem: curvesTandem.createTandem('originalCurve'),
      phetioDocumentation: 'The curve that corresponds to the original function, f(x) or f(t)'
    });
    this.predictCurve = new TransformedCurve({
      // PredictCurve is always instrumented, because it should always be present.
      tandem: curvesTandem.createTandem('predictCurve'),
      phetioDocumentation: 'The curve that corresponds to the student\'s prediction of the original function'
    });
    this.interactiveCurveProperty = new DerivedProperty([this.predictEnabledProperty], predictEnabled => predictEnabled ? this.predictCurve : this.originalCurve);

    // If graphSets includes graphType, then create a tandem, otherwise opt out.
    const createCurveTandem = graphType => {
      return GraphSet.includes(this.graphSets, graphType) ? curvesTandem.createTandem(graphType.tandemNamePrefix) : Tandem.OPT_OUT;
    };
    this.derivativeCurve = new DerivativeCurve(this.originalCurve, createCurveTandem(GraphType.DERIVATIVE));
    this.secondDerivativeCurve = new SecondDerivativeCurve(this.originalCurve, createCurveTandem(GraphType.SECOND_DERIVATIVE));
    this.integralCurve = new IntegralCurve(this.originalCurve, createCurveTandem(GraphType.INTEGRAL));
    this.toolsTandem = options.tandem.createTandem('tools');
    this.referenceLine = new ReferenceLine(this.integralCurve, this.originalCurve, this.derivativeCurve, this.secondDerivativeCurve, this.toolsTandem.createTandem('referenceLine'));

    // This exists so that we have something we can link to from the view.
    // See https://github.com/phetsims/calculus-grapher/issues/198
    this.labeledPointsLinkableElement = new PhetioObject({
      tandem: this.toolsTandem.createTandem('labeledPoints'),
      phetioState: false
    });

    // LabeledPoint instances, will appear to be children of 'labeledPoints' in the Studio tree.
    this.labeledPoints = LabeledPoint.createLabeledPoints(CalculusGrapherConstants.NUMBER_OF_LABELED_POINTS, this.integralCurve, this.originalCurve, this.derivativeCurve, this.secondDerivativeCurve, this.labeledPointsLinkableElement.tandem);

    // This exists so that we have something we can link to from the view.
    // See https://github.com/phetsims/calculus-grapher/issues/198
    this.labeledLinesLinkableElement = new PhetioObject({
      tandem: this.toolsTandem.createTandem('labeledLines'),
      phetioState: false,
      phetioFeatured: true
    });

    // LabeledLine instances, will appear to be children of 'labeledLines' in the Studio tree.
    this.labeledLines = LabeledLine.createLabeledLines(CalculusGrapherConstants.NUMBER_OF_LABELED_LINES, this.integralCurve, this.originalCurve, this.derivativeCurve, this.secondDerivativeCurve, this.labeledLinesLinkableElement.tandem);
  }

  /**
   * Reset all
   */
  reset() {
    this.graphSetProperty.reset();
    this.originalCurve.reset();
    this.predictCurve.reset();
    this.curveManipulationProperties.reset();
    this.predictSelectedProperty.reset();
    this.gridVisibleProperty.reset();

    // Reset tools
    this.referenceLine.reset();
    // Do not reset this.labeledPoints, because they are configured only via PhET-iO.
    // Do not reset this.labeledLines, because they are configured only via PhET-iO.
  }
}

calculusGrapher.register('CalculusGrapherModel', CalculusGrapherModel);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjYWxjdWx1c0dyYXBoZXIiLCJEZXJpdmF0aXZlQ3VydmUiLCJTZWNvbmREZXJpdmF0aXZlQ3VydmUiLCJvcHRpb25pemUiLCJJbnRlZ3JhbEN1cnZlIiwiUGhldGlvT2JqZWN0IiwiQ3VydmVNYW5pcHVsYXRpb25Nb2RlIiwiQ3VydmVNYW5pcHVsYXRpb25Qcm9wZXJ0aWVzIiwiVHJhbnNmb3JtZWRDdXJ2ZSIsIkdyYXBoVHlwZSIsIlRhbmRlbSIsIkRlcml2ZWRQcm9wZXJ0eSIsIkJvb2xlYW5Qcm9wZXJ0eSIsIlByb3BlcnR5IiwiQ2FsY3VsdXNHcmFwaGVyQ29uc3RhbnRzIiwiUmVmZXJlbmNlTGluZSIsIkxhYmVsZWRMaW5lIiwiTGFiZWxlZFBvaW50IiwiR3JhcGhTZXQiLCJDYWxjdWx1c0dyYXBoZXJQcmVmZXJlbmNlcyIsIkJvb2xlYW5JTyIsIkNhbGN1bHVzR3JhcGhlck1vZGVsIiwiY29uc3RydWN0b3IiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiZ3JhcGhTZXQiLCJncmFwaFNldHMiLCJjdXJ2ZU1hbmlwdWxhdGlvbk1vZGVDaG9pY2VzIiwiZW51bWVyYXRpb24iLCJ2YWx1ZXMiLCJoYXNUYW5nZW50U2NydWJiZXIiLCJoYXNBcmVhVW5kZXJDdXJ2ZVNjcnViYmVyIiwiYXNzZXJ0IiwibGVuZ3RoIiwiXyIsImV2ZXJ5IiwiaW5jbHVkZXMiLCJncmFwaFNldFByb3BlcnR5IiwidmFsaWRWYWx1ZXMiLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJPUFRfT1VUIiwicGhldGlvVmFsdWVUeXBlIiwiR3JhcGhTZXRJTyIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJjdXJ2ZU1hbmlwdWxhdGlvblByb3BlcnRpZXMiLCJwcmVkaWN0U2VsZWN0ZWRQcm9wZXJ0eSIsInBoZXRpb0ZlYXR1cmVkIiwicHJlZGljdEVuYWJsZWRQcm9wZXJ0eSIsImFuZCIsInByZWRpY3RQcmVmZXJlbmNlRW5hYmxlZFByb3BlcnR5IiwiZ3JpZFZpc2libGVQcm9wZXJ0eSIsImN1cnZlc1RhbmRlbSIsIm9yaWdpbmFsQ3VydmUiLCJwcmVkaWN0Q3VydmUiLCJpbnRlcmFjdGl2ZUN1cnZlUHJvcGVydHkiLCJwcmVkaWN0RW5hYmxlZCIsImNyZWF0ZUN1cnZlVGFuZGVtIiwiZ3JhcGhUeXBlIiwidGFuZGVtTmFtZVByZWZpeCIsImRlcml2YXRpdmVDdXJ2ZSIsIkRFUklWQVRJVkUiLCJzZWNvbmREZXJpdmF0aXZlQ3VydmUiLCJTRUNPTkRfREVSSVZBVElWRSIsImludGVncmFsQ3VydmUiLCJJTlRFR1JBTCIsInRvb2xzVGFuZGVtIiwicmVmZXJlbmNlTGluZSIsImxhYmVsZWRQb2ludHNMaW5rYWJsZUVsZW1lbnQiLCJwaGV0aW9TdGF0ZSIsImxhYmVsZWRQb2ludHMiLCJjcmVhdGVMYWJlbGVkUG9pbnRzIiwiTlVNQkVSX09GX0xBQkVMRURfUE9JTlRTIiwibGFiZWxlZExpbmVzTGlua2FibGVFbGVtZW50IiwibGFiZWxlZExpbmVzIiwiY3JlYXRlTGFiZWxlZExpbmVzIiwiTlVNQkVSX09GX0xBQkVMRURfTElORVMiLCJyZXNldCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQ2FsY3VsdXNHcmFwaGVyTW9kZWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjAtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQ2FsY3VsdXNHcmFwaGVyTW9kZWwgaXMgdGhlIGJhc2UgY2xhc3MgZm9yIHRoZSB0b3AtbGV2ZWwgbW9kZWwgb2YgZXZlcnkgc2NyZWVuIGluIHRoZSAnQ2FsY3VsdXMgR3JhcGhlcicgc2ltdWxhdGlvbi5cclxuICpcclxuICogQGF1dGhvciBCcmFuZG9uIExpXHJcbiAqIEBhdXRob3IgTWFydGluIFZlaWxsZXR0ZVxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBjYWxjdWx1c0dyYXBoZXIgZnJvbSAnLi4vLi4vY2FsY3VsdXNHcmFwaGVyLmpzJztcclxuaW1wb3J0IERlcml2YXRpdmVDdXJ2ZSBmcm9tICcuL0Rlcml2YXRpdmVDdXJ2ZS5qcyc7XHJcbmltcG9ydCBTZWNvbmREZXJpdmF0aXZlQ3VydmUgZnJvbSAnLi9TZWNvbmREZXJpdmF0aXZlQ3VydmUuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgSW50ZWdyYWxDdXJ2ZSBmcm9tICcuL0ludGVncmFsQ3VydmUuanMnO1xyXG5pbXBvcnQgUGhldGlvT2JqZWN0LCB7IFBoZXRpb09iamVjdE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvUGhldGlvT2JqZWN0LmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuaW1wb3J0IEN1cnZlTWFuaXB1bGF0aW9uTW9kZSBmcm9tICcuL0N1cnZlTWFuaXB1bGF0aW9uTW9kZS5qcyc7XHJcbmltcG9ydCBDdXJ2ZU1hbmlwdWxhdGlvblByb3BlcnRpZXMgZnJvbSAnLi9DdXJ2ZU1hbmlwdWxhdGlvblByb3BlcnRpZXMuanMnO1xyXG5pbXBvcnQgVHJhbnNmb3JtZWRDdXJ2ZSBmcm9tICcuL1RyYW5zZm9ybWVkQ3VydmUuanMnO1xyXG5pbXBvcnQgVE1vZGVsIGZyb20gJy4uLy4uLy4uLy4uL2pvaXN0L2pzL1RNb2RlbC5qcyc7XHJcbmltcG9ydCBHcmFwaFR5cGUgZnJvbSAnLi9HcmFwaFR5cGUuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQ2FsY3VsdXNHcmFwaGVyQ29uc3RhbnRzIGZyb20gJy4uL0NhbGN1bHVzR3JhcGhlckNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBSZWZlcmVuY2VMaW5lIGZyb20gJy4vUmVmZXJlbmNlTGluZS5qcyc7XHJcbmltcG9ydCBMYWJlbGVkTGluZSBmcm9tICcuL0xhYmVsZWRMaW5lLmpzJztcclxuaW1wb3J0IExhYmVsZWRQb2ludCBmcm9tICcuL0xhYmVsZWRQb2ludC5qcyc7XHJcbmltcG9ydCBHcmFwaFNldCBmcm9tICcuL0dyYXBoU2V0LmpzJztcclxuaW1wb3J0IENhbGN1bHVzR3JhcGhlclByZWZlcmVuY2VzIGZyb20gJy4vQ2FsY3VsdXNHcmFwaGVyUHJlZmVyZW5jZXMuanMnO1xyXG5pbXBvcnQgQm9vbGVhbklPIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9Cb29sZWFuSU8uanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gSWRlbnRpZmllcyB0aGUgZ3JhcGhzIHRoYXQgYXJlIHN1cHBvcnRlZCBieSB0aGUgc2NyZWVuIGFzc29jaWF0ZWQgd2l0aCB0aGlzIG1vZGVsLCBhbmQgc2hvdWxkIHRoZXJlZm9yZVxyXG4gIC8vIGJlIGluc3RydW1lbnRlZCBmb3IgUGhFVC1pTy5cclxuICBncmFwaFNldHM6IEdyYXBoU2V0W107XHJcblxyXG4gIC8vIEluaXRpYWwgZ3JhcGggc2V0IHNlbGVjdGVkLCBtdXN0IGJlIGEgbWVtYmVyIG9mIGdyYXBoU2V0c1xyXG4gIGdyYXBoU2V0PzogR3JhcGhTZXQ7XHJcblxyXG4gIC8vIElkZW50aWZpZXMgdGhlIGN1cnZlIG1hbmlwdWxhdGlvbiBtb2RlcyB0aGF0IGFyZSBzdXBwb3J0ZWQgYnkgdGhlIHNjcmVlbiBhc3NvY2lhdGVkIHdpdGggdGhpcyBtb2RlbC5cclxuICBjdXJ2ZU1hbmlwdWxhdGlvbk1vZGVDaG9pY2VzPzogQ3VydmVNYW5pcHVsYXRpb25Nb2RlW107XHJcblxyXG4gIC8vIFNob3VsZCB0aGUgbW9kZWwgY3JlYXRlIGEgVGFuZ2VudFNjcnViYmVyP1xyXG4gIGhhc1RhbmdlbnRTY3J1YmJlcj86IGJvb2xlYW47XHJcblxyXG4gIC8vIFNob3VsZCB0aGUgbW9kZWwgY3JlYXRlIGFuIEFyZWFVbmRlckN1cnZlU2NydWJiZXI/XHJcbiAgaGFzQXJlYVVuZGVyQ3VydmVTY3J1YmJlcj86IGJvb2xlYW47XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBDYWxjdWx1c0dyYXBoZXJNb2RlbE9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxQaGV0aW9PYmplY3RPcHRpb25zLCAndGFuZGVtJz47XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYWxjdWx1c0dyYXBoZXJNb2RlbCBpbXBsZW1lbnRzIFRNb2RlbCB7XHJcblxyXG4gIC8vIFRoZSBncmFwaCBzZXRzIHRoYXQgYXJlIHN1cHBvcnRlZCBieSB0aGlzIG1vZGVsXHJcbiAgcHVibGljIHJlYWRvbmx5IGdyYXBoU2V0czogR3JhcGhTZXRbXTtcclxuXHJcbiAgLy8gVGhlIGdyYXBoU2V0IHRoYXQgaXMgY3VycmVudGx5IHNlbGVjdGVkIGFuZCBkaXNwbGF5ZWRcclxuICBwdWJsaWMgcmVhZG9ubHkgZ3JhcGhTZXRQcm9wZXJ0eTogUHJvcGVydHk8R3JhcGhTZXQ+O1xyXG5cclxuICAvLyBQcm9wZXJ0aWVzIGFzc29jaWF0ZWQgd2l0aCBjdXJ2ZSBtYW5pcHVsYXRpb25cclxuICBwdWJsaWMgcmVhZG9ubHkgY3VydmVNYW5pcHVsYXRpb25Qcm9wZXJ0aWVzOiBDdXJ2ZU1hbmlwdWxhdGlvblByb3BlcnRpZXM7XHJcblxyXG4gIC8vIFdoZXRoZXIgdGhlICdQcmVkaWN0JyByYWRpbyBidXR0b24gaXMgc2VsZWN0ZWRcclxuICBwdWJsaWMgcmVhZG9ubHkgcHJlZGljdFNlbGVjdGVkUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyBXaGV0aGVyIHRoZSAnUHJlZGljdCcgZmVhdHVyZSBpcyBlbmFibGVkIGZvciB0aGUgb3JpZ2luYWwgZ3JhcGguXHJcbiAgLy8gVGhlIFByZWRpY3QgcHJlZmVyZW5jZXMgbXVzdCBiZSB0dXJuZWQgb24sIGFuZCB0aGUgUHJlZGljdCByYWRpbyBidXR0b24gbXVzdCBiZSBzZWxlY3RlZC5cclxuICBwdWJsaWMgcmVhZG9ubHkgcHJlZGljdEVuYWJsZWRQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XHJcblxyXG4gIC8vIENvbnRyb2xzIHZpc2liaWxpdHkgb2YgZ3JpZCBsaW5lcyBvbiBhbGwgZ3JhcGhzXHJcbiAgcHVibGljIHJlYWRvbmx5IGdyaWRWaXNpYmxlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xyXG5cclxuICAvLyBUaGUgY3VydmUgdGhhdCBhcHBlYXJzIGFzIGYoeCkgb3IgZih0KSwgZGVwZW5kaW5nIG9uIHRoZSAnVmFyaWFibGUnIHByZWZlcmVuY2Ugc2V0dGluZy5cclxuICAvLyBUaGUgdXNlciBjYW4gbWFuaXB1bGF0ZSB0aGlzIGN1cnZlIGJ5IGNsaWNraW5nIG9mIGNsaWNrLWRyYWdnaW5nIGluIHRoZSBncmFwaC5cclxuICAvLyBUaGUgZGVjaXNpb24gdG8gY2FsbCBpdCB0aGUgJ29yaWdpbmFsJyBjdXJ2ZSBpcyBkb2N1bWVudGVkIGluIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8xMTlcclxuICBwdWJsaWMgcmVhZG9ubHkgb3JpZ2luYWxDdXJ2ZTogVHJhbnNmb3JtZWRDdXJ2ZTtcclxuXHJcbiAgLy8gVGhlIGN1cnZlIHRoYXQgYXBwZWFycyB3aGVuIHRoZSB1c2VyIGhhcyB0dXJuZWQgb24gdGhlICdQcmVkaWN0JyBwcmVmZXJlbmNlIHNldHRpbmcsIGFuZCBoYXMgc2VsZWN0ZWQgdGhlXHJcbiAgLy8gUHJlZGljdCByYWRpbyBidXR0b24gdGhhdCBhcHBlYXJzIGluIHRoZSBjb250cm9sIHBhbmVsLiBUaGlzIGN1cnZlIGNhbiBhbHNvIGJlIG1hbmlwdWxhdGVkIGJ5IHRoZSB1c2VyLlxyXG4gIC8vIEl0cyBwdXJwb3NlIGlzIHRvIGZhY2lsaXRhdGUgcHJlZGljdGluZyB3aGF0IG9yaWdpbmFsQ3VydmUgbG9va3MgbGlrZSwgYmFzZWQgb24gc2VlaW5nIG9uZSBvciBtb3JlIG9mIHRoZVxyXG4gIC8vIGRlcml2ZWQgY3VydmVzLlxyXG4gIHB1YmxpYyByZWFkb25seSBwcmVkaWN0Q3VydmU6IFRyYW5zZm9ybWVkQ3VydmU7XHJcblxyXG4gIC8vIFRoZXNlIGN1cnZlcyBhcmUgZGVyaXZlZCwgbm90IG1hbmlwdWxhdGVkIGJ5IHRoZSB1c2VyLlxyXG4gIHB1YmxpYyByZWFkb25seSBkZXJpdmF0aXZlQ3VydmU6IERlcml2YXRpdmVDdXJ2ZTtcclxuICBwdWJsaWMgcmVhZG9ubHkgaW50ZWdyYWxDdXJ2ZTogSW50ZWdyYWxDdXJ2ZTtcclxuICBwdWJsaWMgcmVhZG9ubHkgc2Vjb25kRGVyaXZhdGl2ZUN1cnZlOiBTZWNvbmREZXJpdmF0aXZlQ3VydmU7XHJcblxyXG4gIC8vIEluZGljYXRlcyB3aGljaCBjdXJ2ZSAob3JpZ2luYWxDdXJ2ZSBvciBwcmVkaWN0Q3VydmUpIGlzIGJlaW5nIG1vZGlmaWVkIGJ5IHRoZSB1c2VyLlxyXG4gIHB1YmxpYyByZWFkb25seSBpbnRlcmFjdGl2ZUN1cnZlUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PFRyYW5zZm9ybWVkQ3VydmU+O1xyXG5cclxuICAvLyBNb2RlbCBlbGVtZW50cyBmb3IgdGhlIHZhcmlvdXMgdG9vbHNcclxuICBwdWJsaWMgcmVhZG9ubHkgcmVmZXJlbmNlTGluZTogUmVmZXJlbmNlTGluZTtcclxuICBwdWJsaWMgcmVhZG9ubHkgbGFiZWxlZFBvaW50czogTGFiZWxlZFBvaW50W107XHJcbiAgcHVibGljIHJlYWRvbmx5IGxhYmVsZWRMaW5lczogTGFiZWxlZExpbmVbXTtcclxuXHJcbiAgLy8gSWYgc3ViY2xhc3NlcyBhZGQgYWRkaXRpb25hbCB0b29scywgdXNlIHRoaXMgYXMgdGhlIHBhcmVudCB0YW5kZW0gZm9yIHRob3NlIHRvb2xzLlxyXG4gIHByb3RlY3RlZCByZWFkb25seSB0b29sc1RhbmRlbTogVGFuZGVtO1xyXG5cclxuICAvLyBUaGVzZSBleGlzdCBzbyB0aGF0IHdlIGhhdmUgc29tZXRoaW5nIHRvIFBoRVQtaU8gbGluayB0byBmcm9tIHRoZSB2aWV3LlxyXG4gIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2FsY3VsdXMtZ3JhcGhlci9pc3N1ZXMvMTk4XHJcbiAgcHVibGljIHJlYWRvbmx5IGxhYmVsZWRQb2ludHNMaW5rYWJsZUVsZW1lbnQ6IFBoZXRpb09iamVjdDtcclxuICBwdWJsaWMgcmVhZG9ubHkgbGFiZWxlZExpbmVzTGlua2FibGVFbGVtZW50OiBQaGV0aW9PYmplY3Q7XHJcblxyXG4gIHByb3RlY3RlZCBjb25zdHJ1Y3RvciggcHJvdmlkZWRPcHRpb25zOiBDYWxjdWx1c0dyYXBoZXJNb2RlbE9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxDYWxjdWx1c0dyYXBoZXJNb2RlbE9wdGlvbnMsIFNlbGZPcHRpb25zPigpKCB7XHJcblxyXG4gICAgICAvLyBTZWxmT3B0aW9uc1xyXG4gICAgICBncmFwaFNldDogcHJvdmlkZWRPcHRpb25zLmdyYXBoU2V0c1sgMCBdLFxyXG4gICAgICBjdXJ2ZU1hbmlwdWxhdGlvbk1vZGVDaG9pY2VzOiBDdXJ2ZU1hbmlwdWxhdGlvbk1vZGUuZW51bWVyYXRpb24udmFsdWVzLFxyXG4gICAgICBoYXNUYW5nZW50U2NydWJiZXI6IGZhbHNlLFxyXG4gICAgICBoYXNBcmVhVW5kZXJDdXJ2ZVNjcnViYmVyOiBmYWxzZVxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5ncmFwaFNldHMubGVuZ3RoID4gMCwgJ3RoZXJlIG11c3QgYmUgYXQgbGVhc3Qgb25lIHZhbGlkIGdyYXBoU2V0JyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggXy5ldmVyeSggb3B0aW9ucy5ncmFwaFNldHMsIGdyYXBoU2V0ID0+IGdyYXBoU2V0Lmxlbmd0aCA9PT0gb3B0aW9ucy5ncmFwaFNldHNbIDAgXS5sZW5ndGggKSxcclxuICAgICAgJ2FsbCBlbGVtZW50cyBvZiBncmFwaFNldHMgbXVzdCBoYXZlIHRoZSBzYW1lIGxlbmd0aCwgYSBjdXJyZW50IGxpbWl0YXRpb24gb2YgdGhpcyBzaW0nICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zLmdyYXBoU2V0cy5pbmNsdWRlcyggb3B0aW9ucy5ncmFwaFNldCApICk7XHJcblxyXG4gICAgdGhpcy5ncmFwaFNldHMgPSBvcHRpb25zLmdyYXBoU2V0cztcclxuXHJcbiAgICB0aGlzLmdyYXBoU2V0UHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIG9wdGlvbnMuZ3JhcGhTZXQsIHtcclxuICAgICAgdmFsaWRWYWx1ZXM6IG9wdGlvbnMuZ3JhcGhTZXRzLFxyXG4gICAgICB0YW5kZW06ICggb3B0aW9ucy5ncmFwaFNldHMubGVuZ3RoID4gMSApID8gb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnZ3JhcGhTZXRQcm9wZXJ0eScgKSA6IFRhbmRlbS5PUFRfT1VULFxyXG4gICAgICBwaGV0aW9WYWx1ZVR5cGU6IEdyYXBoU2V0LkdyYXBoU2V0SU8sXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdJZGVudGlmaWVzIHRoZSB0eXBlcyBvZiBncmFwaHMgdGhhdCBhcmUgZGlzcGxheWVkLCBhbmQgaG93IHRoZXkgYXJlIGdyb3VwZWQuICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAnUmFkaW8gYnV0dG9ucyBhcmUgYXZhaWxhYmxlIGZvciBjaG9vc2luZyB0aGUgZGVzaXJlZCBzZXQuIFNlZSBncmFwaFNldFJhZGlvQnV0dG9uR3JvdXAuJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuY3VydmVNYW5pcHVsYXRpb25Qcm9wZXJ0aWVzID0gbmV3IEN1cnZlTWFuaXB1bGF0aW9uUHJvcGVydGllcyggb3B0aW9ucy5jdXJ2ZU1hbmlwdWxhdGlvbk1vZGVDaG9pY2VzLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnY3VydmVNYW5pcHVsYXRpb25Qcm9wZXJ0aWVzJyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5wcmVkaWN0U2VsZWN0ZWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncHJlZGljdFNlbGVjdGVkUHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0ZlYXR1cmVkOiB0cnVlLFxyXG4gICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnV2hldGhlciB0aGUgUHJlZGljdCByYWRpbyBidXR0b24gaXMgc2VsZWN0ZWQuIFRoaXMgd2lsbCBoYXZlIG5vIGFmZmVjdCB1bmxlc3MgdGhlICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAnUHJlZGljdCBwcmVmZXJlbmNlIGlzIGVuYWJsZWQuJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMucHJlZGljdEVuYWJsZWRQcm9wZXJ0eSA9IERlcml2ZWRQcm9wZXJ0eS5hbmQoXHJcbiAgICAgIFsgQ2FsY3VsdXNHcmFwaGVyUHJlZmVyZW5jZXMucHJlZGljdFByZWZlcmVuY2VFbmFibGVkUHJvcGVydHksIHRoaXMucHJlZGljdFNlbGVjdGVkUHJvcGVydHkgXSwge1xyXG4gICAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAncHJlZGljdEVuYWJsZWRQcm9wZXJ0eScgKSxcclxuICAgICAgICBwaGV0aW9WYWx1ZVR5cGU6IEJvb2xlYW5JTyxcclxuICAgICAgICBwaGV0aW9GZWF0dXJlZDogdHJ1ZSxcclxuICAgICAgICBwaGV0aW9Eb2N1bWVudGF0aW9uOiAnV2hldGhlciB0aGUgUHJlZGljdCBmZWF0dXJlIGlzIGVuYWJsZWQuICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICdUaGlzIGlzIHRydWUgb25seSBpZiB0aGUgUHJlZGljdCBwcmVmZXJlbmNlIGlzIGVuYWJsZWQsIGFuZCB0aGUgUHJlZGljdCByYWRpbyBidXR0b24gaXMgc2VsZWN0ZWQuJ1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5ncmlkVmlzaWJsZVByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdncmlkVmlzaWJsZVByb3BlcnR5JyApLFxyXG4gICAgICBwaGV0aW9GZWF0dXJlZDogdHJ1ZSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ0NvbnRyb2xzIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBncmlkIGxpbmVzIGZvciBhbGwgZ3JhcGhzLidcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBjdXJ2ZXNUYW5kZW0gPSBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdjdXJ2ZXMnICk7XHJcblxyXG4gICAgdGhpcy5vcmlnaW5hbEN1cnZlID0gbmV3IFRyYW5zZm9ybWVkQ3VydmUoIHtcclxuICAgICAgLy8gT3JpZ2luYWxDdXJ2ZSBpcyBhbHdheXMgaW5zdHJ1bWVudGVkLCBiZWNhdXNlIGl0IHNob3VsZCBhbHdheXMgYmUgcHJlc2VudC5cclxuICAgICAgdGFuZGVtOiBjdXJ2ZXNUYW5kZW0uY3JlYXRlVGFuZGVtKCAnb3JpZ2luYWxDdXJ2ZScgKSxcclxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ1RoZSBjdXJ2ZSB0aGF0IGNvcnJlc3BvbmRzIHRvIHRoZSBvcmlnaW5hbCBmdW5jdGlvbiwgZih4KSBvciBmKHQpJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMucHJlZGljdEN1cnZlID0gbmV3IFRyYW5zZm9ybWVkQ3VydmUoIHtcclxuICAgICAgLy8gUHJlZGljdEN1cnZlIGlzIGFsd2F5cyBpbnN0cnVtZW50ZWQsIGJlY2F1c2UgaXQgc2hvdWxkIGFsd2F5cyBiZSBwcmVzZW50LlxyXG4gICAgICB0YW5kZW06IGN1cnZlc1RhbmRlbS5jcmVhdGVUYW5kZW0oICdwcmVkaWN0Q3VydmUnICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdUaGUgY3VydmUgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgc3R1ZGVudFxcJ3MgcHJlZGljdGlvbiBvZiB0aGUgb3JpZ2luYWwgZnVuY3Rpb24nXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5pbnRlcmFjdGl2ZUN1cnZlUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbIHRoaXMucHJlZGljdEVuYWJsZWRQcm9wZXJ0eSBdLFxyXG4gICAgICBwcmVkaWN0RW5hYmxlZCA9PiBwcmVkaWN0RW5hYmxlZCA/IHRoaXMucHJlZGljdEN1cnZlIDogdGhpcy5vcmlnaW5hbEN1cnZlXHJcbiAgICApO1xyXG5cclxuICAgIC8vIElmIGdyYXBoU2V0cyBpbmNsdWRlcyBncmFwaFR5cGUsIHRoZW4gY3JlYXRlIGEgdGFuZGVtLCBvdGhlcndpc2Ugb3B0IG91dC5cclxuICAgIGNvbnN0IGNyZWF0ZUN1cnZlVGFuZGVtID0gKCBncmFwaFR5cGU6IEdyYXBoVHlwZSApID0+IHtcclxuICAgICAgcmV0dXJuIEdyYXBoU2V0LmluY2x1ZGVzKCB0aGlzLmdyYXBoU2V0cywgZ3JhcGhUeXBlICkgPyBjdXJ2ZXNUYW5kZW0uY3JlYXRlVGFuZGVtKCBncmFwaFR5cGUudGFuZGVtTmFtZVByZWZpeCApIDogVGFuZGVtLk9QVF9PVVQ7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZGVyaXZhdGl2ZUN1cnZlID0gbmV3IERlcml2YXRpdmVDdXJ2ZSggdGhpcy5vcmlnaW5hbEN1cnZlLCBjcmVhdGVDdXJ2ZVRhbmRlbSggR3JhcGhUeXBlLkRFUklWQVRJVkUgKSApO1xyXG4gICAgdGhpcy5zZWNvbmREZXJpdmF0aXZlQ3VydmUgPSBuZXcgU2Vjb25kRGVyaXZhdGl2ZUN1cnZlKCB0aGlzLm9yaWdpbmFsQ3VydmUsIGNyZWF0ZUN1cnZlVGFuZGVtKCBHcmFwaFR5cGUuU0VDT05EX0RFUklWQVRJVkUgKSApO1xyXG4gICAgdGhpcy5pbnRlZ3JhbEN1cnZlID0gbmV3IEludGVncmFsQ3VydmUoIHRoaXMub3JpZ2luYWxDdXJ2ZSwgY3JlYXRlQ3VydmVUYW5kZW0oIEdyYXBoVHlwZS5JTlRFR1JBTCApICk7XHJcblxyXG4gICAgdGhpcy50b29sc1RhbmRlbSA9IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Rvb2xzJyApO1xyXG5cclxuICAgIHRoaXMucmVmZXJlbmNlTGluZSA9IG5ldyBSZWZlcmVuY2VMaW5lKFxyXG4gICAgICB0aGlzLmludGVncmFsQ3VydmUsIHRoaXMub3JpZ2luYWxDdXJ2ZSwgdGhpcy5kZXJpdmF0aXZlQ3VydmUsIHRoaXMuc2Vjb25kRGVyaXZhdGl2ZUN1cnZlLFxyXG4gICAgICB0aGlzLnRvb2xzVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3JlZmVyZW5jZUxpbmUnIClcclxuICAgICk7XHJcblxyXG4gICAgLy8gVGhpcyBleGlzdHMgc28gdGhhdCB3ZSBoYXZlIHNvbWV0aGluZyB3ZSBjYW4gbGluayB0byBmcm9tIHRoZSB2aWV3LlxyXG4gICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9jYWxjdWx1cy1ncmFwaGVyL2lzc3Vlcy8xOThcclxuICAgIHRoaXMubGFiZWxlZFBvaW50c0xpbmthYmxlRWxlbWVudCA9IG5ldyBQaGV0aW9PYmplY3QoIHtcclxuICAgICAgdGFuZGVtOiB0aGlzLnRvb2xzVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xhYmVsZWRQb2ludHMnICksXHJcbiAgICAgIHBoZXRpb1N0YXRlOiBmYWxzZVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIExhYmVsZWRQb2ludCBpbnN0YW5jZXMsIHdpbGwgYXBwZWFyIHRvIGJlIGNoaWxkcmVuIG9mICdsYWJlbGVkUG9pbnRzJyBpbiB0aGUgU3R1ZGlvIHRyZWUuXHJcbiAgICB0aGlzLmxhYmVsZWRQb2ludHMgPSBMYWJlbGVkUG9pbnQuY3JlYXRlTGFiZWxlZFBvaW50cyhcclxuICAgICAgQ2FsY3VsdXNHcmFwaGVyQ29uc3RhbnRzLk5VTUJFUl9PRl9MQUJFTEVEX1BPSU5UUyxcclxuICAgICAgdGhpcy5pbnRlZ3JhbEN1cnZlLFxyXG4gICAgICB0aGlzLm9yaWdpbmFsQ3VydmUsXHJcbiAgICAgIHRoaXMuZGVyaXZhdGl2ZUN1cnZlLFxyXG4gICAgICB0aGlzLnNlY29uZERlcml2YXRpdmVDdXJ2ZSxcclxuICAgICAgdGhpcy5sYWJlbGVkUG9pbnRzTGlua2FibGVFbGVtZW50LnRhbmRlbSApO1xyXG5cclxuICAgIC8vIFRoaXMgZXhpc3RzIHNvIHRoYXQgd2UgaGF2ZSBzb21ldGhpbmcgd2UgY2FuIGxpbmsgdG8gZnJvbSB0aGUgdmlldy5cclxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvY2FsY3VsdXMtZ3JhcGhlci9pc3N1ZXMvMTk4XHJcbiAgICB0aGlzLmxhYmVsZWRMaW5lc0xpbmthYmxlRWxlbWVudCA9IG5ldyBQaGV0aW9PYmplY3QoIHtcclxuICAgICAgdGFuZGVtOiB0aGlzLnRvb2xzVGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xhYmVsZWRMaW5lcycgKSxcclxuICAgICAgcGhldGlvU3RhdGU6IGZhbHNlLFxyXG4gICAgICBwaGV0aW9GZWF0dXJlZDogdHJ1ZVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIExhYmVsZWRMaW5lIGluc3RhbmNlcywgd2lsbCBhcHBlYXIgdG8gYmUgY2hpbGRyZW4gb2YgJ2xhYmVsZWRMaW5lcycgaW4gdGhlIFN0dWRpbyB0cmVlLlxyXG4gICAgdGhpcy5sYWJlbGVkTGluZXMgPSBMYWJlbGVkTGluZS5jcmVhdGVMYWJlbGVkTGluZXMoXHJcbiAgICAgIENhbGN1bHVzR3JhcGhlckNvbnN0YW50cy5OVU1CRVJfT0ZfTEFCRUxFRF9MSU5FUyxcclxuICAgICAgdGhpcy5pbnRlZ3JhbEN1cnZlLFxyXG4gICAgICB0aGlzLm9yaWdpbmFsQ3VydmUsXHJcbiAgICAgIHRoaXMuZGVyaXZhdGl2ZUN1cnZlLFxyXG4gICAgICB0aGlzLnNlY29uZERlcml2YXRpdmVDdXJ2ZSxcclxuICAgICAgdGhpcy5sYWJlbGVkTGluZXNMaW5rYWJsZUVsZW1lbnQudGFuZGVtICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNldCBhbGxcclxuICAgKi9cclxuICBwdWJsaWMgcmVzZXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLmdyYXBoU2V0UHJvcGVydHkucmVzZXQoKTtcclxuICAgIHRoaXMub3JpZ2luYWxDdXJ2ZS5yZXNldCgpO1xyXG4gICAgdGhpcy5wcmVkaWN0Q3VydmUucmVzZXQoKTtcclxuICAgIHRoaXMuY3VydmVNYW5pcHVsYXRpb25Qcm9wZXJ0aWVzLnJlc2V0KCk7XHJcbiAgICB0aGlzLnByZWRpY3RTZWxlY3RlZFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmdyaWRWaXNpYmxlUHJvcGVydHkucmVzZXQoKTtcclxuXHJcbiAgICAvLyBSZXNldCB0b29sc1xyXG4gICAgdGhpcy5yZWZlcmVuY2VMaW5lLnJlc2V0KCk7XHJcbiAgICAvLyBEbyBub3QgcmVzZXQgdGhpcy5sYWJlbGVkUG9pbnRzLCBiZWNhdXNlIHRoZXkgYXJlIGNvbmZpZ3VyZWQgb25seSB2aWEgUGhFVC1pTy5cclxuICAgIC8vIERvIG5vdCByZXNldCB0aGlzLmxhYmVsZWRMaW5lcywgYmVjYXVzZSB0aGV5IGFyZSBjb25maWd1cmVkIG9ubHkgdmlhIFBoRVQtaU8uXHJcbiAgfVxyXG59XHJcbmNhbGN1bHVzR3JhcGhlci5yZWdpc3RlciggJ0NhbGN1bHVzR3JhcGhlck1vZGVsJywgQ2FsY3VsdXNHcmFwaGVyTW9kZWwgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sMEJBQTBCO0FBQ3RELE9BQU9DLGVBQWUsTUFBTSxzQkFBc0I7QUFDbEQsT0FBT0MscUJBQXFCLE1BQU0sNEJBQTRCO0FBQzlELE9BQU9DLFNBQVMsTUFBTSx1Q0FBdUM7QUFDN0QsT0FBT0MsYUFBYSxNQUFNLG9CQUFvQjtBQUM5QyxPQUFPQyxZQUFZLE1BQStCLHVDQUF1QztBQUV6RixPQUFPQyxxQkFBcUIsTUFBTSw0QkFBNEI7QUFDOUQsT0FBT0MsMkJBQTJCLE1BQU0sa0NBQWtDO0FBQzFFLE9BQU9DLGdCQUFnQixNQUFNLHVCQUF1QjtBQUVwRCxPQUFPQyxTQUFTLE1BQU0sZ0JBQWdCO0FBQ3RDLE9BQU9DLE1BQU0sTUFBTSxpQ0FBaUM7QUFDcEQsT0FBT0MsZUFBZSxNQUFNLHdDQUF3QztBQUVwRSxPQUFPQyxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLFFBQVEsTUFBTSxpQ0FBaUM7QUFDdEQsT0FBT0Msd0JBQXdCLE1BQU0sZ0NBQWdDO0FBQ3JFLE9BQU9DLGFBQWEsTUFBTSxvQkFBb0I7QUFDOUMsT0FBT0MsV0FBVyxNQUFNLGtCQUFrQjtBQUMxQyxPQUFPQyxZQUFZLE1BQU0sbUJBQW1CO0FBQzVDLE9BQU9DLFFBQVEsTUFBTSxlQUFlO0FBQ3BDLE9BQU9DLDBCQUEwQixNQUFNLGlDQUFpQztBQUN4RSxPQUFPQyxTQUFTLE1BQU0sMENBQTBDO0FBdUJoRSxlQUFlLE1BQU1DLG9CQUFvQixDQUFtQjtFQUUxRDs7RUFHQTs7RUFHQTs7RUFHQTs7RUFHQTtFQUNBO0VBR0E7RUFHQTtFQUNBO0VBQ0E7RUFHQTtFQUNBO0VBQ0E7RUFDQTtFQUdBO0VBS0E7RUFHQTtF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