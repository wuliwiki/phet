// Copyright 2023, University of Colorado Boulder

/**
 * SecondDerivative is a Curve subclass for a curve that represents the second derivative of a Curve.
 * It is used to evaluate the second derivative of the originalCurve.
 *
 * SecondDerivatives' main responsibility is to observe when the originalCurve changes and differentiates it and update
 * the Points of the second derivative.
 *
 * Like Curve, SecondDerivative is created at the start and persists for the lifetime of the simulation. Links
 * are left as-is and SecondDerivatives are never disposed.
 *
 * @author Martin Veillette
 */

import calculusGrapher from '../../calculusGrapher.js';
import Curve from './Curve.js';
export default class SecondDerivativeCurve extends Curve {
  // Reference to the originalCurve that was passed-in.

  /**
   * @param originalCurve - the curve to differentiate to get the values of this SecondDerivative
   * @param tandem
   */
  constructor(originalCurve, tandem) {
    super({
      // CurveOptions
      xRange: originalCurve.xRange,
      numberOfPoints: originalCurve.numberOfPoints,
      tandem: tandem
    });
    this.originalCurve = originalCurve;

    // Observes when the 'base' Curve changes and update this curve to represent the second derivative of the 'base' Curve.
    // Listener is never removed since SecondDerivative is never disposed.
    originalCurve.curveChangedEmitter.addListener(this.updateSecondDerivative.bind(this));

    // Makes the initial call to updateSecondDerivative() to match the 'base' Curve upon initialization.
    this.updateSecondDerivative();
  }

  /**
   * Updates the y-values and pointTypes for the SecondDerivative
   *
   * To update the second derivative, we (1) assume that the points are smooth,
   * and evaluate the second derivative using the standard finite difference algorithm.
   * (see central difference approximation of the second derivative in  https://en.wikipedia.org/wiki/Finite_difference )
   *
   * For points that are not smooth, we correct for this wrong assumption, by assigning
   * their second derivative to a smooth point directly next to it.
   */
  updateSecondDerivative() {
    // Convenience variables
    const originalPoints = this.originalCurve.points;
    const length = originalPoints.length;
    for (let index = 0; index < length; index++) {
      // Is the original point smooth?
      const isOriginalPointSmooth = originalPoints[index].pointType === 'smooth';

      // The point type is the same as the original point, unless the original point is not smooth, in which case it must be discontinuous
      this.points[index].pointType = isOriginalPointSmooth ? 'smooth' : 'discontinuous';

      // We exclude the first and last point. They will be dealt with later
      if (index !== 0 && index !== length - 1) {
        const previousPoint = originalPoints[index - 1];
        const point = originalPoints[index];
        const nextPoint = originalPoints[index + 1];

        // Determine the second derivative using the naive assumption that all original points are smooth. We will handle exceptions later
        this.points[index].y = (point.getSlope(nextPoint) - point.getSlope(previousPoint)) / this.deltaX;
      }
    }

    // Handle the y value of the first and last point
    this.points[0].y = originalPoints[1].pointType === 'smooth' ? this.points[1].y : 0;
    this.points[length - 1].y = originalPoints[length - 2].pointType === 'smooth' ? this.points[length - 2].y : 0;

    // Reiterate over points but this time taking into account the point type
    // Reassigning appropriate y value if the point type is not smooth
    for (let index = 1; index < length - 1; index++) {
      // Points of the second derivative (this class), their point type is now correctly assigned
      const previousPoint = this.points[index - 1];
      const point = this.points[index];
      const nextPoint = this.points[index + 1];

      // If the point is discontinuous, we have evaluated its second derivative incorrectly.
      if (point.isDiscontinuous) {
        if (nextPoint.isDiscontinuous) {
          // The point and next point are not smooth, which means that the second derivative of this point
          // was not evaluated correctly. Update its yValue with the point left to it
          point.y = previousPoint.y;
        }
        if (previousPoint.isDiscontinuous) {
          // The point and previous point are not smooth, which means that the second derivative of this point
          // was not evaluated correctly. Update its yValue with the point right to it
          point.y = nextPoint.y;
        }
      }
    }

    // Signal once that this Curve has changed.
    this.curveChangedEmitter.emit();
  }
}
calculusGrapher.register('SecondDerivativeCurve', SecondDerivativeCurve);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjYWxjdWx1c0dyYXBoZXIiLCJDdXJ2ZSIsIlNlY29uZERlcml2YXRpdmVDdXJ2ZSIsImNvbnN0cnVjdG9yIiwib3JpZ2luYWxDdXJ2ZSIsInRhbmRlbSIsInhSYW5nZSIsIm51bWJlck9mUG9pbnRzIiwiY3VydmVDaGFuZ2VkRW1pdHRlciIsImFkZExpc3RlbmVyIiwidXBkYXRlU2Vjb25kRGVyaXZhdGl2ZSIsImJpbmQiLCJvcmlnaW5hbFBvaW50cyIsInBvaW50cyIsImxlbmd0aCIsImluZGV4IiwiaXNPcmlnaW5hbFBvaW50U21vb3RoIiwicG9pbnRUeXBlIiwicHJldmlvdXNQb2ludCIsInBvaW50IiwibmV4dFBvaW50IiwieSIsImdldFNsb3BlIiwiZGVsdGFYIiwiaXNEaXNjb250aW51b3VzIiwiZW1pdCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiU2Vjb25kRGVyaXZhdGl2ZUN1cnZlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBTZWNvbmREZXJpdmF0aXZlIGlzIGEgQ3VydmUgc3ViY2xhc3MgZm9yIGEgY3VydmUgdGhhdCByZXByZXNlbnRzIHRoZSBzZWNvbmQgZGVyaXZhdGl2ZSBvZiBhIEN1cnZlLlxyXG4gKiBJdCBpcyB1c2VkIHRvIGV2YWx1YXRlIHRoZSBzZWNvbmQgZGVyaXZhdGl2ZSBvZiB0aGUgb3JpZ2luYWxDdXJ2ZS5cclxuICpcclxuICogU2Vjb25kRGVyaXZhdGl2ZXMnIG1haW4gcmVzcG9uc2liaWxpdHkgaXMgdG8gb2JzZXJ2ZSB3aGVuIHRoZSBvcmlnaW5hbEN1cnZlIGNoYW5nZXMgYW5kIGRpZmZlcmVudGlhdGVzIGl0IGFuZCB1cGRhdGVcclxuICogdGhlIFBvaW50cyBvZiB0aGUgc2Vjb25kIGRlcml2YXRpdmUuXHJcbiAqXHJcbiAqIExpa2UgQ3VydmUsIFNlY29uZERlcml2YXRpdmUgaXMgY3JlYXRlZCBhdCB0aGUgc3RhcnQgYW5kIHBlcnNpc3RzIGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIHNpbXVsYXRpb24uIExpbmtzXHJcbiAqIGFyZSBsZWZ0IGFzLWlzIGFuZCBTZWNvbmREZXJpdmF0aXZlcyBhcmUgbmV2ZXIgZGlzcG9zZWQuXHJcbiAqXHJcbiAqIEBhdXRob3IgTWFydGluIFZlaWxsZXR0ZVxyXG4gKi9cclxuXHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBjYWxjdWx1c0dyYXBoZXIgZnJvbSAnLi4vLi4vY2FsY3VsdXNHcmFwaGVyLmpzJztcclxuaW1wb3J0IEN1cnZlIGZyb20gJy4vQ3VydmUuanMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2Vjb25kRGVyaXZhdGl2ZUN1cnZlIGV4dGVuZHMgQ3VydmUge1xyXG5cclxuICAvLyBSZWZlcmVuY2UgdG8gdGhlIG9yaWdpbmFsQ3VydmUgdGhhdCB3YXMgcGFzc2VkLWluLlxyXG4gIHByaXZhdGUgcmVhZG9ubHkgb3JpZ2luYWxDdXJ2ZTogQ3VydmU7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSBvcmlnaW5hbEN1cnZlIC0gdGhlIGN1cnZlIHRvIGRpZmZlcmVudGlhdGUgdG8gZ2V0IHRoZSB2YWx1ZXMgb2YgdGhpcyBTZWNvbmREZXJpdmF0aXZlXHJcbiAgICogQHBhcmFtIHRhbmRlbVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvciggb3JpZ2luYWxDdXJ2ZTogQ3VydmUsIHRhbmRlbTogVGFuZGVtICkge1xyXG5cclxuICAgIHN1cGVyKCB7XHJcblxyXG4gICAgICAvLyBDdXJ2ZU9wdGlvbnNcclxuICAgICAgeFJhbmdlOiBvcmlnaW5hbEN1cnZlLnhSYW5nZSxcclxuICAgICAgbnVtYmVyT2ZQb2ludHM6IG9yaWdpbmFsQ3VydmUubnVtYmVyT2ZQb2ludHMsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtXHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5vcmlnaW5hbEN1cnZlID0gb3JpZ2luYWxDdXJ2ZTtcclxuXHJcbiAgICAvLyBPYnNlcnZlcyB3aGVuIHRoZSAnYmFzZScgQ3VydmUgY2hhbmdlcyBhbmQgdXBkYXRlIHRoaXMgY3VydmUgdG8gcmVwcmVzZW50IHRoZSBzZWNvbmQgZGVyaXZhdGl2ZSBvZiB0aGUgJ2Jhc2UnIEN1cnZlLlxyXG4gICAgLy8gTGlzdGVuZXIgaXMgbmV2ZXIgcmVtb3ZlZCBzaW5jZSBTZWNvbmREZXJpdmF0aXZlIGlzIG5ldmVyIGRpc3Bvc2VkLlxyXG4gICAgb3JpZ2luYWxDdXJ2ZS5jdXJ2ZUNoYW5nZWRFbWl0dGVyLmFkZExpc3RlbmVyKCB0aGlzLnVwZGF0ZVNlY29uZERlcml2YXRpdmUuYmluZCggdGhpcyApICk7XHJcblxyXG4gICAgLy8gTWFrZXMgdGhlIGluaXRpYWwgY2FsbCB0byB1cGRhdGVTZWNvbmREZXJpdmF0aXZlKCkgdG8gbWF0Y2ggdGhlICdiYXNlJyBDdXJ2ZSB1cG9uIGluaXRpYWxpemF0aW9uLlxyXG4gICAgdGhpcy51cGRhdGVTZWNvbmREZXJpdmF0aXZlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHRoZSB5LXZhbHVlcyBhbmQgcG9pbnRUeXBlcyBmb3IgdGhlIFNlY29uZERlcml2YXRpdmVcclxuICAgKlxyXG4gICAqIFRvIHVwZGF0ZSB0aGUgc2Vjb25kIGRlcml2YXRpdmUsIHdlICgxKSBhc3N1bWUgdGhhdCB0aGUgcG9pbnRzIGFyZSBzbW9vdGgsXHJcbiAgICogYW5kIGV2YWx1YXRlIHRoZSBzZWNvbmQgZGVyaXZhdGl2ZSB1c2luZyB0aGUgc3RhbmRhcmQgZmluaXRlIGRpZmZlcmVuY2UgYWxnb3JpdGhtLlxyXG4gICAqIChzZWUgY2VudHJhbCBkaWZmZXJlbmNlIGFwcHJveGltYXRpb24gb2YgdGhlIHNlY29uZCBkZXJpdmF0aXZlIGluICBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9GaW5pdGVfZGlmZmVyZW5jZSApXHJcbiAgICpcclxuICAgKiBGb3IgcG9pbnRzIHRoYXQgYXJlIG5vdCBzbW9vdGgsIHdlIGNvcnJlY3QgZm9yIHRoaXMgd3JvbmcgYXNzdW1wdGlvbiwgYnkgYXNzaWduaW5nXHJcbiAgICogdGhlaXIgc2Vjb25kIGRlcml2YXRpdmUgdG8gYSBzbW9vdGggcG9pbnQgZGlyZWN0bHkgbmV4dCB0byBpdC5cclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZVNlY29uZERlcml2YXRpdmUoKTogdm9pZCB7XHJcblxyXG4gICAgLy8gQ29udmVuaWVuY2UgdmFyaWFibGVzXHJcbiAgICBjb25zdCBvcmlnaW5hbFBvaW50cyA9IHRoaXMub3JpZ2luYWxDdXJ2ZS5wb2ludHM7XHJcbiAgICBjb25zdCBsZW5ndGggPSBvcmlnaW5hbFBvaW50cy5sZW5ndGg7XHJcblxyXG4gICAgZm9yICggbGV0IGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7XHJcblxyXG4gICAgICAvLyBJcyB0aGUgb3JpZ2luYWwgcG9pbnQgc21vb3RoP1xyXG4gICAgICBjb25zdCBpc09yaWdpbmFsUG9pbnRTbW9vdGggPSBvcmlnaW5hbFBvaW50c1sgaW5kZXggXS5wb2ludFR5cGUgPT09ICdzbW9vdGgnO1xyXG5cclxuICAgICAgLy8gVGhlIHBvaW50IHR5cGUgaXMgdGhlIHNhbWUgYXMgdGhlIG9yaWdpbmFsIHBvaW50LCB1bmxlc3MgdGhlIG9yaWdpbmFsIHBvaW50IGlzIG5vdCBzbW9vdGgsIGluIHdoaWNoIGNhc2UgaXQgbXVzdCBiZSBkaXNjb250aW51b3VzXHJcbiAgICAgIHRoaXMucG9pbnRzWyBpbmRleCBdLnBvaW50VHlwZSA9IGlzT3JpZ2luYWxQb2ludFNtb290aCA/ICdzbW9vdGgnIDogJ2Rpc2NvbnRpbnVvdXMnO1xyXG5cclxuICAgICAgLy8gV2UgZXhjbHVkZSB0aGUgZmlyc3QgYW5kIGxhc3QgcG9pbnQuIFRoZXkgd2lsbCBiZSBkZWFsdCB3aXRoIGxhdGVyXHJcbiAgICAgIGlmICggaW5kZXggIT09IDAgJiYgaW5kZXggIT09IGxlbmd0aCAtIDEgKSB7XHJcbiAgICAgICAgY29uc3QgcHJldmlvdXNQb2ludCA9IG9yaWdpbmFsUG9pbnRzWyBpbmRleCAtIDEgXTtcclxuICAgICAgICBjb25zdCBwb2ludCA9IG9yaWdpbmFsUG9pbnRzWyBpbmRleCBdO1xyXG4gICAgICAgIGNvbnN0IG5leHRQb2ludCA9IG9yaWdpbmFsUG9pbnRzWyBpbmRleCArIDEgXTtcclxuXHJcbiAgICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBzZWNvbmQgZGVyaXZhdGl2ZSB1c2luZyB0aGUgbmFpdmUgYXNzdW1wdGlvbiB0aGF0IGFsbCBvcmlnaW5hbCBwb2ludHMgYXJlIHNtb290aC4gV2Ugd2lsbCBoYW5kbGUgZXhjZXB0aW9ucyBsYXRlclxyXG4gICAgICAgIHRoaXMucG9pbnRzWyBpbmRleCBdLnkgPSAoIHBvaW50LmdldFNsb3BlKCBuZXh0UG9pbnQgKSAtIHBvaW50LmdldFNsb3BlKCBwcmV2aW91c1BvaW50ICkgKSAvIHRoaXMuZGVsdGFYO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSGFuZGxlIHRoZSB5IHZhbHVlIG9mIHRoZSBmaXJzdCBhbmQgbGFzdCBwb2ludFxyXG4gICAgdGhpcy5wb2ludHNbIDAgXS55ID0gKCBvcmlnaW5hbFBvaW50c1sgMSBdLnBvaW50VHlwZSA9PT0gJ3Ntb290aCcgKSA/IHRoaXMucG9pbnRzWyAxIF0ueSA6IDA7XHJcbiAgICB0aGlzLnBvaW50c1sgbGVuZ3RoIC0gMSBdLnkgPSAoIG9yaWdpbmFsUG9pbnRzWyBsZW5ndGggLSAyIF0ucG9pbnRUeXBlID09PSAnc21vb3RoJyApID8gdGhpcy5wb2ludHNbIGxlbmd0aCAtIDIgXS55IDogMDtcclxuXHJcblxyXG4gICAgLy8gUmVpdGVyYXRlIG92ZXIgcG9pbnRzIGJ1dCB0aGlzIHRpbWUgdGFraW5nIGludG8gYWNjb3VudCB0aGUgcG9pbnQgdHlwZVxyXG4gICAgLy8gUmVhc3NpZ25pbmcgYXBwcm9wcmlhdGUgeSB2YWx1ZSBpZiB0aGUgcG9pbnQgdHlwZSBpcyBub3Qgc21vb3RoXHJcbiAgICBmb3IgKCBsZXQgaW5kZXggPSAxOyBpbmRleCA8IGxlbmd0aCAtIDE7IGluZGV4KysgKSB7XHJcblxyXG4gICAgICAvLyBQb2ludHMgb2YgdGhlIHNlY29uZCBkZXJpdmF0aXZlICh0aGlzIGNsYXNzKSwgdGhlaXIgcG9pbnQgdHlwZSBpcyBub3cgY29ycmVjdGx5IGFzc2lnbmVkXHJcbiAgICAgIGNvbnN0IHByZXZpb3VzUG9pbnQgPSB0aGlzLnBvaW50c1sgaW5kZXggLSAxIF07XHJcbiAgICAgIGNvbnN0IHBvaW50ID0gdGhpcy5wb2ludHNbIGluZGV4IF07XHJcbiAgICAgIGNvbnN0IG5leHRQb2ludCA9IHRoaXMucG9pbnRzWyBpbmRleCArIDEgXTtcclxuXHJcbiAgICAgIC8vIElmIHRoZSBwb2ludCBpcyBkaXNjb250aW51b3VzLCB3ZSBoYXZlIGV2YWx1YXRlZCBpdHMgc2Vjb25kIGRlcml2YXRpdmUgaW5jb3JyZWN0bHkuXHJcbiAgICAgIGlmICggcG9pbnQuaXNEaXNjb250aW51b3VzICkge1xyXG5cclxuICAgICAgICBpZiAoIG5leHRQb2ludC5pc0Rpc2NvbnRpbnVvdXMgKSB7XHJcblxyXG4gICAgICAgICAgLy8gVGhlIHBvaW50IGFuZCBuZXh0IHBvaW50IGFyZSBub3Qgc21vb3RoLCB3aGljaCBtZWFucyB0aGF0IHRoZSBzZWNvbmQgZGVyaXZhdGl2ZSBvZiB0aGlzIHBvaW50XHJcbiAgICAgICAgICAvLyB3YXMgbm90IGV2YWx1YXRlZCBjb3JyZWN0bHkuIFVwZGF0ZSBpdHMgeVZhbHVlIHdpdGggdGhlIHBvaW50IGxlZnQgdG8gaXRcclxuICAgICAgICAgIHBvaW50LnkgPSBwcmV2aW91c1BvaW50Lnk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIHByZXZpb3VzUG9pbnQuaXNEaXNjb250aW51b3VzICkge1xyXG5cclxuICAgICAgICAgIC8vIFRoZSBwb2ludCBhbmQgcHJldmlvdXMgcG9pbnQgYXJlIG5vdCBzbW9vdGgsIHdoaWNoIG1lYW5zIHRoYXQgdGhlIHNlY29uZCBkZXJpdmF0aXZlIG9mIHRoaXMgcG9pbnRcclxuICAgICAgICAgIC8vIHdhcyBub3QgZXZhbHVhdGVkIGNvcnJlY3RseS4gVXBkYXRlIGl0cyB5VmFsdWUgd2l0aCB0aGUgcG9pbnQgcmlnaHQgdG8gaXRcclxuICAgICAgICAgIHBvaW50LnkgPSBuZXh0UG9pbnQueTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBTaWduYWwgb25jZSB0aGF0IHRoaXMgQ3VydmUgaGFzIGNoYW5nZWQuXHJcbiAgICB0aGlzLmN1cnZlQ2hhbmdlZEVtaXR0ZXIuZW1pdCgpO1xyXG4gIH1cclxuXHJcbn1cclxuY2FsY3VsdXNHcmFwaGVyLnJlZ2lzdGVyKCAnU2Vjb25kRGVyaXZhdGl2ZUN1cnZlJywgU2Vjb25kRGVyaXZhdGl2ZUN1cnZlICk7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLE9BQU9BLGVBQWUsTUFBTSwwQkFBMEI7QUFDdEQsT0FBT0MsS0FBSyxNQUFNLFlBQVk7QUFFOUIsZUFBZSxNQUFNQyxxQkFBcUIsU0FBU0QsS0FBSyxDQUFDO0VBRXZEOztFQUdBO0FBQ0Y7QUFDQTtBQUNBO0VBQ1NFLFdBQVdBLENBQUVDLGFBQW9CLEVBQUVDLE1BQWMsRUFBRztJQUV6RCxLQUFLLENBQUU7TUFFTDtNQUNBQyxNQUFNLEVBQUVGLGFBQWEsQ0FBQ0UsTUFBTTtNQUM1QkMsY0FBYyxFQUFFSCxhQUFhLENBQUNHLGNBQWM7TUFDNUNGLE1BQU0sRUFBRUE7SUFDVixDQUFFLENBQUM7SUFFSCxJQUFJLENBQUNELGFBQWEsR0FBR0EsYUFBYTs7SUFFbEM7SUFDQTtJQUNBQSxhQUFhLENBQUNJLG1CQUFtQixDQUFDQyxXQUFXLENBQUUsSUFBSSxDQUFDQyxzQkFBc0IsQ0FBQ0MsSUFB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