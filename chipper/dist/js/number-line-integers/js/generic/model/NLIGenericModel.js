// Copyright 2019-2022, University of Colorado Boulder

/**
 * main model for the "generic" screen
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import Property from '../../../../axon/js/Property.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import Range from '../../../../dot/js/Range.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import PointController from '../../../../number-line-common/js/common/model/PointController.js';
import SpatializedNumberLine from '../../../../number-line-common/js/common/model/SpatializedNumberLine.js';
import Orientation from '../../../../phet-core/js/Orientation.js';
import { Color } from '../../../../scenery/js/imports.js';
import NLIConstants from '../../common/NLIConstants.js';
import numberLineIntegers from '../../numberLineIntegers.js';

// constants
const NL_Y_OFFSET = 30; // offset of the number line from the center of the bounds, empirically determined
const BOTTOM_BOX_WIDTH = 320;
const BOTTOM_BOX_HEIGHT = 70;
const SIDE_BOX_WIDTH = BOTTOM_BOX_HEIGHT;
const SIDE_BOX_HEIGHT = BOTTOM_BOX_WIDTH;
const INSET = 30;
const BOTTOM_BOX_BOUNDS = new Bounds2(NLIConstants.NLI_LAYOUT_BOUNDS.centerX - BOTTOM_BOX_WIDTH / 2, NLIConstants.NLI_LAYOUT_BOUNDS.maxY - BOTTOM_BOX_HEIGHT - INSET, NLIConstants.NLI_LAYOUT_BOUNDS.centerX + BOTTOM_BOX_WIDTH / 2, NLIConstants.NLI_LAYOUT_BOUNDS.maxY - INSET);
const SIDE_BOX_BOUNDS = new Bounds2(NLIConstants.NLI_LAYOUT_BOUNDS.minX + INSET, NLIConstants.NLI_LAYOUT_BOUNDS.centerY - SIDE_BOX_HEIGHT / 2, NLIConstants.NLI_LAYOUT_BOUNDS.minX + INSET + SIDE_BOX_WIDTH, NLIConstants.NLI_LAYOUT_BOUNDS.centerY + SIDE_BOX_HEIGHT / 2);
const ORANGISH_POINT_COLOR = new Color('#ff8a15');
const INITIAL_POINT_COLOR = new Color('blue');
const NUMBER_LINE_RANGES = [new Range(-10, 10), new Range(-30, 30), new Range(-100, 100)];
class NLIGenericModel {
  /**
   * @public
   */
  constructor() {
    // @public (read-only) {SpatializedNumberLine} - the number line with which the user will interact
    this.numberLine = new SpatializedNumberLine(NLIConstants.NLI_LAYOUT_BOUNDS.center.plusXY(0, NL_Y_OFFSET), {
      initialDisplayedRange: NUMBER_LINE_RANGES[0],
      initialPointSpecs: [{
        initialValue: 1,
        color: INITIAL_POINT_COLOR
      }],
      labelsInitiallyVisible: true,
      // size of the number line in both orientations, number empirically determined to make it look good
      widthInModelSpace: NLIConstants.NLI_LAYOUT_BOUNDS.width - 100,
      heightInModelSpace: NLIConstants.NLI_LAYOUT_BOUNDS.height - 160
    });

    // @public (read-only) {Property.<Bounds2>} - the bounds of the box where the point controllers reside when not
    // being used, changes its position when the orientation of the number line changes
    this.pointControllerBoxProperty = new Property(BOTTOM_BOX_BOUNDS, {
      valueType: Bounds2
    });

    // @public (read-only) - an array of the point controllers available for manipulation by the user
    this.pointControllers = [new PointController({
      color: new Color('magenta'),
      numberLines: [this.numberLine]
    }), new PointController({
      color: ORANGISH_POINT_COLOR,
      numberLines: [this.numberLine]
    }), new PointController({
      color: INITIAL_POINT_COLOR,
      numberLines: [this.numberLine]
    })];

    // Put the first two point controllers into the box at the bottom of the screen.
    this.putPointControllerInBox(this.pointControllers[0]);
    this.putPointControllerInBox(this.pointControllers[1]);

    // The third point controller should be associated with the point already on the number line.
    assert && assert(this.numberLine.residentPoints.length === 1, 'expected one and only one point on the number line');
    this.pointControllers[2].associateWithNumberLinePoint(this.numberLine.residentPoints.get(0));

    // Set up the listeners that will place the point controllers back in their default positions when released over
    // the active point controller box.
    this.pointControllers.forEach(pointController => {
      pointController.isDraggingProperty.lazyLink(dragging => {
        // If the point controller is released and it's not controlling a point on the number line, put it away.
        if (!dragging && !pointController.isControllingNumberLinePoint()) {
          this.putPointControllerInBox(pointController, true);
        }
      });
    });

    // handle changes to the number line's orientation
    this.numberLine.orientationProperty.link(orientation => {
      const previousBoxBounds = orientation === Orientation.HORIZONTAL ? SIDE_BOX_BOUNDS : BOTTOM_BOX_BOUNDS;
      const newBoxBounds = orientation === Orientation.HORIZONTAL ? BOTTOM_BOX_BOUNDS : SIDE_BOX_BOUNDS;
      this.pointControllerBoxProperty.value = newBoxBounds;
      this.pointControllers.forEach(pointController => {
        // If the point controller is animating, stop it and put it in the box.
        if (pointController.inProgressAnimationProperty.value) {
          pointController.stopAnimation();
          this.putPointControllerInBox(pointController);
        }

        // If the point controller was sitting in the previous box, move it to the new one.
        else if (previousBoxBounds.containsPoint(pointController.positionProperty.value) && !pointController.isDraggingProperty.value) {
          this.putPointControllerInBox(pointController);
        }

        // If the controller is controlling a point on the number line, relocate the point and the controller.
        else if (pointController.isControllingNumberLinePoint()) {
          // There should only be one controlled point.
          assert && assert(pointController.numberLinePoints.length === 1);
          pointController.setPositionRelativeToPoint(pointController.numberLinePoints.get(0));
        }
      });
    });

    // Add a listener to handle any cases where a change to the number line's display range causes a point that was
    // already on the number line to be outside of the displayed range.
    this.numberLine.displayedRangeProperty.link(displayedRange => {
      this.pointControllers.forEach(pointController => {
        if (pointController.isControllingNumberLinePoint()) {
          // state checking
          assert && assert(pointController.numberLinePoints.length === 1, 'point controllers on the "Generic" screen should never control multiple points');

          // Get the point on the number line that is currently controlled by this point controller.
          const numberLinePoint = pointController.numberLinePoints.get(0);
          if (!displayedRange.contains(numberLinePoint.valueProperty.value)) {
            // The point controlled by this controller is out of the displayed range, so get rid of it.
            pointController.dissociateFromNumberLinePoint(numberLinePoint);
            this.numberLine.removePoint(numberLinePoint);
            numberLinePoint.dispose();

            // Put the controller away.
            this.putPointControllerInBox(pointController);
          }
        }
      });
    });
  }

  /**
   * Place the provided point controller into the currently active box, generally done on init, reset, and when the
   * user "puts it away".
   * @param {PointController} pointController
   * @param {boolean} [animate] - controls whether to animate the return to the box or do it instantly
   * @private
   */
  putPointControllerInBox(pointController, animate = false) {
    const index = this.pointControllers.indexOf(pointController);
    const numberOfPositions = this.pointControllers.length;

    // error checking
    assert && assert(index >= 0, 'point controller not found on list');
    assert && assert(!pointController.isControllingNumberLinePoint(), 'point controller should not be put away while controlling a point');
    let destination;

    // Decide which box and at which position the point controller should be placed.
    if (this.numberLine.orientationProperty.value === Orientation.HORIZONTAL) {
      // Put point in box at bottom of screen.
      const spacing = BOTTOM_BOX_BOUNDS.width / numberOfPositions;
      destination = new Vector2(BOTTOM_BOX_BOUNDS.minX + spacing / 2 + spacing * index, BOTTOM_BOX_BOUNDS.centerY);
    } else {
      // Put point in box at side of screen.
      const spacing = SIDE_BOX_BOUNDS.height / numberOfPositions;
      destination = new Vector2(SIDE_BOX_BOUNDS.centerX, SIDE_BOX_BOUNDS.minY + spacing / 2 + spacing * index);
    }
    pointController.goToPosition(destination, animate);
  }

  /**
   * Restore model to initial state.
   * @public
   */
  reset() {
    // Clear any associations that the point controllers have with points on the number line.
    this.pointControllers.forEach(pointController => {
      pointController.reset();
    });

    // Reset the number line.
    this.numberLine.reset();

    // Put the first two point controllers in the box at the bottom of the screen.
    this.putPointControllerInBox(this.pointControllers[0]);
    this.putPointControllerInBox(this.pointControllers[1]);

    // Associate the third point controller with the point on the number line.
    assert && assert(this.numberLine.residentPoints.length === 1, 'expected one and only one point on the number line');
    this.pointControllers[2].associateWithNumberLinePoint(this.numberLine.residentPoints.get(0));
  }
}

// static properties
NLIGenericModel.NUMBER_LINE_RANGES = NUMBER_LINE_RANGES;
numberLineIntegers.register('NLIGenericModel', NLIGenericModel);
export default NLIGenericModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIkJvdW5kczIiLCJSYW5nZSIsIlZlY3RvcjIiLCJQb2ludENvbnRyb2xsZXIiLCJTcGF0aWFsaXplZE51bWJlckxpbmUiLCJPcmllbnRhdGlvbiIsIkNvbG9yIiwiTkxJQ29uc3RhbnRzIiwibnVtYmVyTGluZUludGVnZXJzIiwiTkxfWV9PRkZTRVQiLCJCT1RUT01fQk9YX1dJRFRIIiwiQk9UVE9NX0JPWF9IRUlHSFQiLCJTSURFX0JPWF9XSURUSCIsIlNJREVfQk9YX0hFSUdIVCIsIklOU0VUIiwiQk9UVE9NX0JPWF9CT1VORFMiLCJOTElfTEFZT1VUX0JPVU5EUyIsImNlbnRlclgiLCJtYXhZIiwiU0lERV9CT1hfQk9VTkRTIiwibWluWCIsImNlbnRlclkiLCJPUkFOR0lTSF9QT0lOVF9DT0xPUiIsIklOSVRJQUxfUE9JTlRfQ09MT1IiLCJOVU1CRVJfTElORV9SQU5HRVMiLCJOTElHZW5lcmljTW9kZWwiLCJjb25zdHJ1Y3RvciIsIm51bWJlckxpbmUiLCJjZW50ZXIiLCJwbHVzWFkiLCJpbml0aWFsRGlzcGxheWVkUmFuZ2UiLCJpbml0aWFsUG9pbnRTcGVjcyIsImluaXRpYWxWYWx1ZSIsImNvbG9yIiwibGFiZWxzSW5pdGlhbGx5VmlzaWJsZSIsIndpZHRoSW5Nb2RlbFNwYWNlIiwid2lkdGgiLCJoZWlnaHRJbk1vZGVsU3BhY2UiLCJoZWlnaHQiLCJwb2ludENvbnRyb2xsZXJCb3hQcm9wZXJ0eSIsInZhbHVlVHlwZSIsInBvaW50Q29udHJvbGxlcnMiLCJudW1iZXJMaW5lcyIsInB1dFBvaW50Q29udHJvbGxlckluQm94IiwiYXNzZXJ0IiwicmVzaWRlbnRQb2ludHMiLCJsZW5ndGgiLCJhc3NvY2lhdGVXaXRoTnVtYmVyTGluZVBvaW50IiwiZ2V0IiwiZm9yRWFjaCIsInBvaW50Q29udHJvbGxlciIsImlzRHJhZ2dpbmdQcm9wZXJ0eSIsImxhenlMaW5rIiwiZHJhZ2dpbmciLCJpc0NvbnRyb2xsaW5nTnVtYmVyTGluZVBvaW50Iiwib3JpZW50YXRpb25Qcm9wZXJ0eSIsImxpbmsiLCJvcmllbnRhdGlvbiIsInByZXZpb3VzQm94Qm91bmRzIiwiSE9SSVpPTlRBTCIsIm5ld0JveEJvdW5kcyIsInZhbHVlIiwiaW5Qcm9ncmVzc0FuaW1hdGlvblByb3BlcnR5Iiwic3RvcEFuaW1hdGlvbiIsImNvbnRhaW5zUG9pbnQiLCJwb3NpdGlvblByb3BlcnR5IiwibnVtYmVyTGluZVBvaW50cyIsInNldFBvc2l0aW9uUmVsYXRpdmVUb1BvaW50IiwiZGlzcGxheWVkUmFuZ2VQcm9wZXJ0eSIsImRpc3BsYXllZFJhbmdlIiwibnVtYmVyTGluZVBvaW50IiwiY29udGFpbnMiLCJ2YWx1ZVByb3BlcnR5IiwiZGlzc29jaWF0ZUZyb21OdW1iZXJMaW5lUG9pbnQiLCJyZW1vdmVQb2ludCIsImRpc3Bvc2UiLCJhbmltYXRlIiwiaW5kZXgiLCJpbmRleE9mIiwibnVtYmVyT2ZQb3NpdGlvbnMiLCJkZXN0aW5hdGlvbiIsInNwYWNpbmciLCJtaW5ZIiwiZ29Ub1Bvc2l0aW9uIiwicmVzZXQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIk5MSUdlbmVyaWNNb2RlbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBtYWluIG1vZGVsIGZvciB0aGUgXCJnZW5lcmljXCIgc2NyZWVuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCBQb2ludENvbnRyb2xsZXIgZnJvbSAnLi4vLi4vLi4vLi4vbnVtYmVyLWxpbmUtY29tbW9uL2pzL2NvbW1vbi9tb2RlbC9Qb2ludENvbnRyb2xsZXIuanMnO1xyXG5pbXBvcnQgU3BhdGlhbGl6ZWROdW1iZXJMaW5lIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9qcy9jb21tb24vbW9kZWwvU3BhdGlhbGl6ZWROdW1iZXJMaW5lLmpzJztcclxuaW1wb3J0IE9yaWVudGF0aW9uIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9PcmllbnRhdGlvbi5qcyc7XHJcbmltcG9ydCB7IENvbG9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IE5MSUNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vTkxJQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IG51bWJlckxpbmVJbnRlZ2VycyBmcm9tICcuLi8uLi9udW1iZXJMaW5lSW50ZWdlcnMuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE5MX1lfT0ZGU0VUID0gMzA7IC8vIG9mZnNldCBvZiB0aGUgbnVtYmVyIGxpbmUgZnJvbSB0aGUgY2VudGVyIG9mIHRoZSBib3VuZHMsIGVtcGlyaWNhbGx5IGRldGVybWluZWRcclxuY29uc3QgQk9UVE9NX0JPWF9XSURUSCA9IDMyMDtcclxuY29uc3QgQk9UVE9NX0JPWF9IRUlHSFQgPSA3MDtcclxuY29uc3QgU0lERV9CT1hfV0lEVEggPSBCT1RUT01fQk9YX0hFSUdIVDtcclxuY29uc3QgU0lERV9CT1hfSEVJR0hUID0gQk9UVE9NX0JPWF9XSURUSDtcclxuY29uc3QgSU5TRVQgPSAzMDtcclxuY29uc3QgQk9UVE9NX0JPWF9CT1VORFMgPSBuZXcgQm91bmRzMihcclxuICBOTElDb25zdGFudHMuTkxJX0xBWU9VVF9CT1VORFMuY2VudGVyWCAtIEJPVFRPTV9CT1hfV0lEVEggLyAyLFxyXG4gIE5MSUNvbnN0YW50cy5OTElfTEFZT1VUX0JPVU5EUy5tYXhZIC0gQk9UVE9NX0JPWF9IRUlHSFQgLSBJTlNFVCxcclxuICBOTElDb25zdGFudHMuTkxJX0xBWU9VVF9CT1VORFMuY2VudGVyWCArIEJPVFRPTV9CT1hfV0lEVEggLyAyLFxyXG4gIE5MSUNvbnN0YW50cy5OTElfTEFZT1VUX0JPVU5EUy5tYXhZIC0gSU5TRVRcclxuKTtcclxuY29uc3QgU0lERV9CT1hfQk9VTkRTID0gbmV3IEJvdW5kczIoXHJcbiAgTkxJQ29uc3RhbnRzLk5MSV9MQVlPVVRfQk9VTkRTLm1pblggKyBJTlNFVCxcclxuICBOTElDb25zdGFudHMuTkxJX0xBWU9VVF9CT1VORFMuY2VudGVyWSAtIFNJREVfQk9YX0hFSUdIVCAvIDIsXHJcbiAgTkxJQ29uc3RhbnRzLk5MSV9MQVlPVVRfQk9VTkRTLm1pblggKyBJTlNFVCArIFNJREVfQk9YX1dJRFRILFxyXG4gIE5MSUNvbnN0YW50cy5OTElfTEFZT1VUX0JPVU5EUy5jZW50ZXJZICsgU0lERV9CT1hfSEVJR0hUIC8gMlxyXG4pO1xyXG5jb25zdCBPUkFOR0lTSF9QT0lOVF9DT0xPUiA9IG5ldyBDb2xvciggJyNmZjhhMTUnICk7XHJcbmNvbnN0IElOSVRJQUxfUE9JTlRfQ09MT1IgPSBuZXcgQ29sb3IoICdibHVlJyApO1xyXG5jb25zdCBOVU1CRVJfTElORV9SQU5HRVMgPSBbXHJcbiAgbmV3IFJhbmdlKCAtMTAsIDEwICksXHJcbiAgbmV3IFJhbmdlKCAtMzAsIDMwICksXHJcbiAgbmV3IFJhbmdlKCAtMTAwLCAxMDAgKVxyXG5dO1xyXG5cclxuY2xhc3MgTkxJR2VuZXJpY01vZGVsIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG5cclxuICAgIC8vIEBwdWJsaWMgKHJlYWQtb25seSkge1NwYXRpYWxpemVkTnVtYmVyTGluZX0gLSB0aGUgbnVtYmVyIGxpbmUgd2l0aCB3aGljaCB0aGUgdXNlciB3aWxsIGludGVyYWN0XHJcbiAgICB0aGlzLm51bWJlckxpbmUgPSBuZXcgU3BhdGlhbGl6ZWROdW1iZXJMaW5lKCBOTElDb25zdGFudHMuTkxJX0xBWU9VVF9CT1VORFMuY2VudGVyLnBsdXNYWSggMCwgTkxfWV9PRkZTRVQgKSwge1xyXG4gICAgICBpbml0aWFsRGlzcGxheWVkUmFuZ2U6IE5VTUJFUl9MSU5FX1JBTkdFU1sgMCBdLFxyXG4gICAgICBpbml0aWFsUG9pbnRTcGVjczogWyB7IGluaXRpYWxWYWx1ZTogMSwgY29sb3I6IElOSVRJQUxfUE9JTlRfQ09MT1IgfSBdLFxyXG4gICAgICBsYWJlbHNJbml0aWFsbHlWaXNpYmxlOiB0cnVlLFxyXG5cclxuICAgICAgLy8gc2l6ZSBvZiB0aGUgbnVtYmVyIGxpbmUgaW4gYm90aCBvcmllbnRhdGlvbnMsIG51bWJlciBlbXBpcmljYWxseSBkZXRlcm1pbmVkIHRvIG1ha2UgaXQgbG9vayBnb29kXHJcbiAgICAgIHdpZHRoSW5Nb2RlbFNwYWNlOiBOTElDb25zdGFudHMuTkxJX0xBWU9VVF9CT1VORFMud2lkdGggLSAxMDAsXHJcbiAgICAgIGhlaWdodEluTW9kZWxTcGFjZTogTkxJQ29uc3RhbnRzLk5MSV9MQVlPVVRfQk9VTkRTLmhlaWdodCAtIDE2MFxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMgKHJlYWQtb25seSkge1Byb3BlcnR5LjxCb3VuZHMyPn0gLSB0aGUgYm91bmRzIG9mIHRoZSBib3ggd2hlcmUgdGhlIHBvaW50IGNvbnRyb2xsZXJzIHJlc2lkZSB3aGVuIG5vdFxyXG4gICAgLy8gYmVpbmcgdXNlZCwgY2hhbmdlcyBpdHMgcG9zaXRpb24gd2hlbiB0aGUgb3JpZW50YXRpb24gb2YgdGhlIG51bWJlciBsaW5lIGNoYW5nZXNcclxuICAgIHRoaXMucG9pbnRDb250cm9sbGVyQm94UHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIEJPVFRPTV9CT1hfQk9VTkRTLCB7IHZhbHVlVHlwZTogQm91bmRzMiB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAocmVhZC1vbmx5KSAtIGFuIGFycmF5IG9mIHRoZSBwb2ludCBjb250cm9sbGVycyBhdmFpbGFibGUgZm9yIG1hbmlwdWxhdGlvbiBieSB0aGUgdXNlclxyXG4gICAgdGhpcy5wb2ludENvbnRyb2xsZXJzID0gW1xyXG4gICAgICBuZXcgUG9pbnRDb250cm9sbGVyKCB7IGNvbG9yOiBuZXcgQ29sb3IoICdtYWdlbnRhJyApLCBudW1iZXJMaW5lczogWyB0aGlzLm51bWJlckxpbmUgXSB9ICksXHJcbiAgICAgIG5ldyBQb2ludENvbnRyb2xsZXIoIHsgY29sb3I6IE9SQU5HSVNIX1BPSU5UX0NPTE9SLCBudW1iZXJMaW5lczogWyB0aGlzLm51bWJlckxpbmUgXSB9ICksXHJcbiAgICAgIG5ldyBQb2ludENvbnRyb2xsZXIoIHsgY29sb3I6IElOSVRJQUxfUE9JTlRfQ09MT1IsIG51bWJlckxpbmVzOiBbIHRoaXMubnVtYmVyTGluZSBdIH0gKVxyXG4gICAgXTtcclxuXHJcbiAgICAvLyBQdXQgdGhlIGZpcnN0IHR3byBwb2ludCBjb250cm9sbGVycyBpbnRvIHRoZSBib3ggYXQgdGhlIGJvdHRvbSBvZiB0aGUgc2NyZWVuLlxyXG4gICAgdGhpcy5wdXRQb2ludENvbnRyb2xsZXJJbkJveCggdGhpcy5wb2ludENvbnRyb2xsZXJzWyAwIF0gKTtcclxuICAgIHRoaXMucHV0UG9pbnRDb250cm9sbGVySW5Cb3goIHRoaXMucG9pbnRDb250cm9sbGVyc1sgMSBdICk7XHJcblxyXG4gICAgLy8gVGhlIHRoaXJkIHBvaW50IGNvbnRyb2xsZXIgc2hvdWxkIGJlIGFzc29jaWF0ZWQgd2l0aCB0aGUgcG9pbnQgYWxyZWFkeSBvbiB0aGUgbnVtYmVyIGxpbmUuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLm51bWJlckxpbmUucmVzaWRlbnRQb2ludHMubGVuZ3RoID09PSAxLCAnZXhwZWN0ZWQgb25lIGFuZCBvbmx5IG9uZSBwb2ludCBvbiB0aGUgbnVtYmVyIGxpbmUnICk7XHJcbiAgICB0aGlzLnBvaW50Q29udHJvbGxlcnNbIDIgXS5hc3NvY2lhdGVXaXRoTnVtYmVyTGluZVBvaW50KCB0aGlzLm51bWJlckxpbmUucmVzaWRlbnRQb2ludHMuZ2V0KCAwICkgKTtcclxuXHJcbiAgICAvLyBTZXQgdXAgdGhlIGxpc3RlbmVycyB0aGF0IHdpbGwgcGxhY2UgdGhlIHBvaW50IGNvbnRyb2xsZXJzIGJhY2sgaW4gdGhlaXIgZGVmYXVsdCBwb3NpdGlvbnMgd2hlbiByZWxlYXNlZCBvdmVyXHJcbiAgICAvLyB0aGUgYWN0aXZlIHBvaW50IGNvbnRyb2xsZXIgYm94LlxyXG4gICAgdGhpcy5wb2ludENvbnRyb2xsZXJzLmZvckVhY2goIHBvaW50Q29udHJvbGxlciA9PiB7XHJcbiAgICAgIHBvaW50Q29udHJvbGxlci5pc0RyYWdnaW5nUHJvcGVydHkubGF6eUxpbmsoIGRyYWdnaW5nID0+IHtcclxuXHJcbiAgICAgICAgLy8gSWYgdGhlIHBvaW50IGNvbnRyb2xsZXIgaXMgcmVsZWFzZWQgYW5kIGl0J3Mgbm90IGNvbnRyb2xsaW5nIGEgcG9pbnQgb24gdGhlIG51bWJlciBsaW5lLCBwdXQgaXQgYXdheS5cclxuICAgICAgICBpZiAoICFkcmFnZ2luZyAmJiAhcG9pbnRDb250cm9sbGVyLmlzQ29udHJvbGxpbmdOdW1iZXJMaW5lUG9pbnQoKSApIHtcclxuICAgICAgICAgIHRoaXMucHV0UG9pbnRDb250cm9sbGVySW5Cb3goIHBvaW50Q29udHJvbGxlciwgdHJ1ZSApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGhhbmRsZSBjaGFuZ2VzIHRvIHRoZSBudW1iZXIgbGluZSdzIG9yaWVudGF0aW9uXHJcbiAgICB0aGlzLm51bWJlckxpbmUub3JpZW50YXRpb25Qcm9wZXJ0eS5saW5rKCBvcmllbnRhdGlvbiA9PiB7XHJcbiAgICAgIGNvbnN0IHByZXZpb3VzQm94Qm91bmRzID0gb3JpZW50YXRpb24gPT09IE9yaWVudGF0aW9uLkhPUklaT05UQUwgPyBTSURFX0JPWF9CT1VORFMgOiBCT1RUT01fQk9YX0JPVU5EUztcclxuICAgICAgY29uc3QgbmV3Qm94Qm91bmRzID0gb3JpZW50YXRpb24gPT09IE9yaWVudGF0aW9uLkhPUklaT05UQUwgPyBCT1RUT01fQk9YX0JPVU5EUyA6IFNJREVfQk9YX0JPVU5EUztcclxuICAgICAgdGhpcy5wb2ludENvbnRyb2xsZXJCb3hQcm9wZXJ0eS52YWx1ZSA9IG5ld0JveEJvdW5kcztcclxuICAgICAgdGhpcy5wb2ludENvbnRyb2xsZXJzLmZvckVhY2goIHBvaW50Q29udHJvbGxlciA9PiB7XHJcblxyXG4gICAgICAgIC8vIElmIHRoZSBwb2ludCBjb250cm9sbGVyIGlzIGFuaW1hdGluZywgc3RvcCBpdCBhbmQgcHV0IGl0IGluIHRoZSBib3guXHJcbiAgICAgICAgaWYgKCBwb2ludENvbnRyb2xsZXIuaW5Qcm9ncmVzc0FuaW1hdGlvblByb3BlcnR5LnZhbHVlICkge1xyXG4gICAgICAgICAgcG9pbnRDb250cm9sbGVyLnN0b3BBbmltYXRpb24oKTtcclxuICAgICAgICAgIHRoaXMucHV0UG9pbnRDb250cm9sbGVySW5Cb3goIHBvaW50Q29udHJvbGxlciApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gSWYgdGhlIHBvaW50IGNvbnRyb2xsZXIgd2FzIHNpdHRpbmcgaW4gdGhlIHByZXZpb3VzIGJveCwgbW92ZSBpdCB0byB0aGUgbmV3IG9uZS5cclxuICAgICAgICBlbHNlIGlmICggcHJldmlvdXNCb3hCb3VuZHMuY29udGFpbnNQb2ludCggcG9pbnRDb250cm9sbGVyLnBvc2l0aW9uUHJvcGVydHkudmFsdWUgKSAmJlxyXG4gICAgICAgICAgICAgICAgICAhcG9pbnRDb250cm9sbGVyLmlzRHJhZ2dpbmdQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICAgIHRoaXMucHV0UG9pbnRDb250cm9sbGVySW5Cb3goIHBvaW50Q29udHJvbGxlciApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gSWYgdGhlIGNvbnRyb2xsZXIgaXMgY29udHJvbGxpbmcgYSBwb2ludCBvbiB0aGUgbnVtYmVyIGxpbmUsIHJlbG9jYXRlIHRoZSBwb2ludCBhbmQgdGhlIGNvbnRyb2xsZXIuXHJcbiAgICAgICAgZWxzZSBpZiAoIHBvaW50Q29udHJvbGxlci5pc0NvbnRyb2xsaW5nTnVtYmVyTGluZVBvaW50KCkgKSB7XHJcblxyXG4gICAgICAgICAgLy8gVGhlcmUgc2hvdWxkIG9ubHkgYmUgb25lIGNvbnRyb2xsZWQgcG9pbnQuXHJcbiAgICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBwb2ludENvbnRyb2xsZXIubnVtYmVyTGluZVBvaW50cy5sZW5ndGggPT09IDEgKTtcclxuICAgICAgICAgIHBvaW50Q29udHJvbGxlci5zZXRQb3NpdGlvblJlbGF0aXZlVG9Qb2ludCggcG9pbnRDb250cm9sbGVyLm51bWJlckxpbmVQb2ludHMuZ2V0KCAwICkgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBBZGQgYSBsaXN0ZW5lciB0byBoYW5kbGUgYW55IGNhc2VzIHdoZXJlIGEgY2hhbmdlIHRvIHRoZSBudW1iZXIgbGluZSdzIGRpc3BsYXkgcmFuZ2UgY2F1c2VzIGEgcG9pbnQgdGhhdCB3YXNcclxuICAgIC8vIGFscmVhZHkgb24gdGhlIG51bWJlciBsaW5lIHRvIGJlIG91dHNpZGUgb2YgdGhlIGRpc3BsYXllZCByYW5nZS5cclxuICAgIHRoaXMubnVtYmVyTGluZS5kaXNwbGF5ZWRSYW5nZVByb3BlcnR5LmxpbmsoIGRpc3BsYXllZFJhbmdlID0+IHtcclxuICAgICAgdGhpcy5wb2ludENvbnRyb2xsZXJzLmZvckVhY2goIHBvaW50Q29udHJvbGxlciA9PiB7XHJcbiAgICAgICAgaWYgKCBwb2ludENvbnRyb2xsZXIuaXNDb250cm9sbGluZ051bWJlckxpbmVQb2ludCgpICkge1xyXG5cclxuICAgICAgICAgIC8vIHN0YXRlIGNoZWNraW5nXHJcbiAgICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KFxyXG4gICAgICAgICAgICBwb2ludENvbnRyb2xsZXIubnVtYmVyTGluZVBvaW50cy5sZW5ndGggPT09IDEsXHJcbiAgICAgICAgICAgICdwb2ludCBjb250cm9sbGVycyBvbiB0aGUgXCJHZW5lcmljXCIgc2NyZWVuIHNob3VsZCBuZXZlciBjb250cm9sIG11bHRpcGxlIHBvaW50cydcclxuICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgLy8gR2V0IHRoZSBwb2ludCBvbiB0aGUgbnVtYmVyIGxpbmUgdGhhdCBpcyBjdXJyZW50bHkgY29udHJvbGxlZCBieSB0aGlzIHBvaW50IGNvbnRyb2xsZXIuXHJcbiAgICAgICAgICBjb25zdCBudW1iZXJMaW5lUG9pbnQgPSBwb2ludENvbnRyb2xsZXIubnVtYmVyTGluZVBvaW50cy5nZXQoIDAgKTtcclxuXHJcbiAgICAgICAgICBpZiAoICFkaXNwbGF5ZWRSYW5nZS5jb250YWlucyggbnVtYmVyTGluZVBvaW50LnZhbHVlUHJvcGVydHkudmFsdWUgKSApIHtcclxuXHJcbiAgICAgICAgICAgIC8vIFRoZSBwb2ludCBjb250cm9sbGVkIGJ5IHRoaXMgY29udHJvbGxlciBpcyBvdXQgb2YgdGhlIGRpc3BsYXllZCByYW5nZSwgc28gZ2V0IHJpZCBvZiBpdC5cclxuICAgICAgICAgICAgcG9pbnRDb250cm9sbGVyLmRpc3NvY2lhdGVGcm9tTnVtYmVyTGluZVBvaW50KCBudW1iZXJMaW5lUG9pbnQgKTtcclxuICAgICAgICAgICAgdGhpcy5udW1iZXJMaW5lLnJlbW92ZVBvaW50KCBudW1iZXJMaW5lUG9pbnQgKTtcclxuICAgICAgICAgICAgbnVtYmVyTGluZVBvaW50LmRpc3Bvc2UoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFB1dCB0aGUgY29udHJvbGxlciBhd2F5LlxyXG4gICAgICAgICAgICB0aGlzLnB1dFBvaW50Q29udHJvbGxlckluQm94KCBwb2ludENvbnRyb2xsZXIgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gKTtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFBsYWNlIHRoZSBwcm92aWRlZCBwb2ludCBjb250cm9sbGVyIGludG8gdGhlIGN1cnJlbnRseSBhY3RpdmUgYm94LCBnZW5lcmFsbHkgZG9uZSBvbiBpbml0LCByZXNldCwgYW5kIHdoZW4gdGhlXHJcbiAgICogdXNlciBcInB1dHMgaXQgYXdheVwiLlxyXG4gICAqIEBwYXJhbSB7UG9pbnRDb250cm9sbGVyfSBwb2ludENvbnRyb2xsZXJcclxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IFthbmltYXRlXSAtIGNvbnRyb2xzIHdoZXRoZXIgdG8gYW5pbWF0ZSB0aGUgcmV0dXJuIHRvIHRoZSBib3ggb3IgZG8gaXQgaW5zdGFudGx5XHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBwdXRQb2ludENvbnRyb2xsZXJJbkJveCggcG9pbnRDb250cm9sbGVyLCBhbmltYXRlID0gZmFsc2UgKSB7XHJcblxyXG4gICAgY29uc3QgaW5kZXggPSB0aGlzLnBvaW50Q29udHJvbGxlcnMuaW5kZXhPZiggcG9pbnRDb250cm9sbGVyICk7XHJcbiAgICBjb25zdCBudW1iZXJPZlBvc2l0aW9ucyA9IHRoaXMucG9pbnRDb250cm9sbGVycy5sZW5ndGg7XHJcblxyXG4gICAgLy8gZXJyb3IgY2hlY2tpbmdcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGluZGV4ID49IDAsICdwb2ludCBjb250cm9sbGVyIG5vdCBmb3VuZCBvbiBsaXN0JyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydChcclxuICAgICAgIXBvaW50Q29udHJvbGxlci5pc0NvbnRyb2xsaW5nTnVtYmVyTGluZVBvaW50KCksXHJcbiAgICAgICdwb2ludCBjb250cm9sbGVyIHNob3VsZCBub3QgYmUgcHV0IGF3YXkgd2hpbGUgY29udHJvbGxpbmcgYSBwb2ludCdcclxuICAgICk7XHJcblxyXG4gICAgbGV0IGRlc3RpbmF0aW9uO1xyXG5cclxuICAgIC8vIERlY2lkZSB3aGljaCBib3ggYW5kIGF0IHdoaWNoIHBvc2l0aW9uIHRoZSBwb2ludCBjb250cm9sbGVyIHNob3VsZCBiZSBwbGFjZWQuXHJcbiAgICBpZiAoIHRoaXMubnVtYmVyTGluZS5vcmllbnRhdGlvblByb3BlcnR5LnZhbHVlID09PSBPcmllbnRhdGlvbi5IT1JJWk9OVEFMICkge1xyXG5cclxuICAgICAgLy8gUHV0IHBvaW50IGluIGJveCBhdCBib3R0b20gb2Ygc2NyZWVuLlxyXG4gICAgICBjb25zdCBzcGFjaW5nID0gQk9UVE9NX0JPWF9CT1VORFMud2lkdGggLyBudW1iZXJPZlBvc2l0aW9ucztcclxuICAgICAgZGVzdGluYXRpb24gPSBuZXcgVmVjdG9yMiggQk9UVE9NX0JPWF9CT1VORFMubWluWCArIHNwYWNpbmcgLyAyICsgc3BhY2luZyAqIGluZGV4LCBCT1RUT01fQk9YX0JPVU5EUy5jZW50ZXJZICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuXHJcbiAgICAgIC8vIFB1dCBwb2ludCBpbiBib3ggYXQgc2lkZSBvZiBzY3JlZW4uXHJcbiAgICAgIGNvbnN0IHNwYWNpbmcgPSBTSURFX0JPWF9CT1VORFMuaGVpZ2h0IC8gbnVtYmVyT2ZQb3NpdGlvbnM7XHJcbiAgICAgIGRlc3RpbmF0aW9uID0gbmV3IFZlY3RvcjIoIFNJREVfQk9YX0JPVU5EUy5jZW50ZXJYLCBTSURFX0JPWF9CT1VORFMubWluWSArIHNwYWNpbmcgLyAyICsgc3BhY2luZyAqIGluZGV4ICk7XHJcbiAgICB9XHJcblxyXG4gICAgcG9pbnRDb250cm9sbGVyLmdvVG9Qb3NpdGlvbiggZGVzdGluYXRpb24sIGFuaW1hdGUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RvcmUgbW9kZWwgdG8gaW5pdGlhbCBzdGF0ZS5cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgcmVzZXQoKSB7XHJcblxyXG4gICAgLy8gQ2xlYXIgYW55IGFzc29jaWF0aW9ucyB0aGF0IHRoZSBwb2ludCBjb250cm9sbGVycyBoYXZlIHdpdGggcG9pbnRzIG9uIHRoZSBudW1iZXIgbGluZS5cclxuICAgIHRoaXMucG9pbnRDb250cm9sbGVycy5mb3JFYWNoKCBwb2ludENvbnRyb2xsZXIgPT4ge1xyXG4gICAgICBwb2ludENvbnRyb2xsZXIucmVzZXQoKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBSZXNldCB0aGUgbnVtYmVyIGxpbmUuXHJcbiAgICB0aGlzLm51bWJlckxpbmUucmVzZXQoKTtcclxuXHJcbiAgICAvLyBQdXQgdGhlIGZpcnN0IHR3byBwb2ludCBjb250cm9sbGVycyBpbiB0aGUgYm94IGF0IHRoZSBib3R0b20gb2YgdGhlIHNjcmVlbi5cclxuICAgIHRoaXMucHV0UG9pbnRDb250cm9sbGVySW5Cb3goIHRoaXMucG9pbnRDb250cm9sbGVyc1sgMCBdICk7XHJcbiAgICB0aGlzLnB1dFBvaW50Q29udHJvbGxlckluQm94KCB0aGlzLnBvaW50Q29udHJvbGxlcnNbIDEgXSApO1xyXG5cclxuICAgIC8vIEFzc29jaWF0ZSB0aGUgdGhpcmQgcG9pbnQgY29udHJvbGxlciB3aXRoIHRoZSBwb2ludCBvbiB0aGUgbnVtYmVyIGxpbmUuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0aGlzLm51bWJlckxpbmUucmVzaWRlbnRQb2ludHMubGVuZ3RoID09PSAxLCAnZXhwZWN0ZWQgb25lIGFuZCBvbmx5IG9uZSBwb2ludCBvbiB0aGUgbnVtYmVyIGxpbmUnICk7XHJcbiAgICB0aGlzLnBvaW50Q29udHJvbGxlcnNbIDIgXS5hc3NvY2lhdGVXaXRoTnVtYmVyTGluZVBvaW50KCB0aGlzLm51bWJlckxpbmUucmVzaWRlbnRQb2ludHMuZ2V0KCAwICkgKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIHN0YXRpYyBwcm9wZXJ0aWVzXHJcbk5MSUdlbmVyaWNNb2RlbC5OVU1CRVJfTElORV9SQU5HRVMgPSBOVU1CRVJfTElORV9SQU5HRVM7XHJcblxyXG5udW1iZXJMaW5lSW50ZWdlcnMucmVnaXN0ZXIoICdOTElHZW5lcmljTW9kZWwnLCBOTElHZW5lcmljTW9kZWwgKTtcclxuZXhwb3J0IGRlZmF1bHQgTkxJR2VuZXJpY01vZGVsO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsUUFBUSxNQUFNLGlDQUFpQztBQUN0RCxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxPQUFPQyxlQUFlLE1BQU0sbUVBQW1FO0FBQy9GLE9BQU9DLHFCQUFxQixNQUFNLHlFQUF5RTtBQUMzRyxPQUFPQyxXQUFXLE1BQU0seUNBQXlDO0FBQ2pFLFNBQVNDLEtBQUssUUFBUSxtQ0FBbUM7QUFDekQsT0FBT0MsWUFBWSxNQUFNLDhCQUE4QjtBQUN2RCxPQUFPQyxrQkFBa0IsTUFBTSw2QkFBNkI7O0FBRTVEO0FBQ0EsTUFBTUMsV0FBVyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0FBQ3hCLE1BQU1DLGdCQUFnQixHQUFHLEdBQUc7QUFDNUIsTUFBTUMsaUJBQWlCLEdBQUcsRUFBRTtBQUM1QixNQUFNQyxjQUFjLEdBQUdELGlCQUFpQjtBQUN4QyxNQUFNRSxlQUFlLEdBQUdILGdCQUFnQjtBQUN4QyxNQUFNSSxLQUFLLEdBQUcsRUFBRTtBQUNoQixNQUFNQyxpQkFBaUIsR0FBRyxJQUFJZixPQUFPLENBQ25DTyxZQUFZLENBQUNTLGlCQUFpQixDQUFDQyxPQUFPLEdBQUdQLGdCQUFnQixHQUFHLENBQUMsRUFDN0RILFlBQVksQ0FBQ1MsaUJBQWlCLENBQUNFLElBQUksR0FBR1AsaUJBQWlCLEdBQUdHLEtBQUssRUFDL0RQLFlBQVksQ0FBQ1MsaUJBQWlCLENBQUNDLE9BQU8sR0FBR1AsZ0JBQWdCLEdBQUcsQ0FBQyxFQUM3REgsWUFBWSxDQUFDUyxpQkFBaUIs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