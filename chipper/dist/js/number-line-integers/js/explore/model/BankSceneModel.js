// Copyright 2019-2022, University of Colorado Boulder

/**
 * model for the "bank" scene
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import LockToNumberLine from '../../../../number-line-common/js/common/model/LockToNumberLine.js';
import NumberLinePoint from '../../../../number-line-common/js/common/model/NumberLinePoint.js';
import PointController from '../../../../number-line-common/js/common/model/PointController.js';
import Orientation from '../../../../phet-core/js/Orientation.js';
import { Color } from '../../../../scenery/js/imports.js';
import NLIConstants from '../../common/NLIConstants.js';
import numberLineIntegers from '../../numberLineIntegers.js';
import BankAccount from './BankAccount.js';
import SceneModel from './SceneModel.js';

// constants
const SCENE_BOUNDS = NLIConstants.NLI_LAYOUT_BOUNDS; // bounds for the scenes match the layout bounds
const PRIMARY_ACCOUNT_POINT_COLOR = new Color('#d25da3');
const COMPARISON_ACCOUNT_POINT_COLOR = new Color('#001fff');
const INITIAL_PRIMARY_ACCOUNT_BALANCE = 10;
const INITIAL_COMPARISON_ACCOUNT_BALANCE = 40;
class BankSceneModel extends SceneModel {
  /**
   * @public
   */
  constructor() {
    // Position the number line on the left portion of the screen and roughly centered vertically.  The details of
    // these values were empirically determined by comparing with the mockups in the design doc.
    const numberLineZeroPosition = new Vector2(SCENE_BOUNDS.width * 0.37, SCENE_BOUNDS.centerY);
    super({
      numberLineZeroPositions: [numberLineZeroPosition],
      commonNumberLineOptions: {
        initialOrientation: Orientation.HORIZONTAL,
        labelsInitiallyVisible: true,
        widthInModelSpace: SCENE_BOUNDS.width * 0.475,
        initialPointSpecs: [{
          initialValue: INITIAL_PRIMARY_ACCOUNT_BALANCE,
          color: new Color(PRIMARY_ACCOUNT_POINT_COLOR)
        }]
      }
    });

    // @public - bank account that is always shown in the view
    this.primaryAccount = new BankAccount(INITIAL_PRIMARY_ACCOUNT_BALANCE);

    // There is only one number line in this scene - get a local reference to it for convenience.
    assert && assert(this.numberLines.length === 1);
    const numberLine = this.numberLines[0];

    // Hook the primary account balance up to the first number line point.
    this.primaryAccount.balanceProperty.link(balance => {
      numberLine.residentPoints.get(0).proposeValue(balance);
    });
    numberLine.residentPoints.get(0).valueProperty.link(value => {
      this.primaryAccount.balanceProperty.value = value;
    });

    // @public {BankAccount} - bank account that is shown when the user wants to compare two accounts
    this.comparisonAccount = new BankAccount(INITIAL_COMPARISON_ACCOUNT_BALANCE);

    // Hook the comparison account balance up to the second number line point.
    this.comparisonAccount.balanceProperty.link(balance => {
      if (numberLine.residentPoints.length > 1) {
        numberLine.residentPoints.get(1).proposeValue(balance);
      }
    });

    // @public {BooleanProperty} - controls whether the comparison account should be visible to the user
    this.showComparisonAccountProperty = new BooleanProperty(false);

    // @public {PointController} - the point controller for the primary account
    this.primaryAccountPointController = new PointController({
      color: numberLine.residentPoints.get(0).colorProperty.value,
      lockToNumberLine: LockToNumberLine.ALWAYS,
      numberLinePoints: [numberLine.residentPoints.get(0)],
      offsetFromHorizontalNumberLine: 120,
      numberLines: [numberLine]
    });

    // @public {PointController} - the point controller for the comparison account
    this.comparisonAccountPointController = new PointController({
      lockToNumberLine: LockToNumberLine.ALWAYS,
      offsetFromHorizontalNumberLine: -120,
      numberLines: [numberLine]
    });

    // the number line point that represents the comparison account value, only exists when enabled
    let comparisonAccountNumberLinePoint = null;

    // Add/remove the point and point controller for the comparison account when enabled.
    this.showComparisonAccountProperty.lazyLink(showComparisonAccount => {
      if (showComparisonAccount) {
        // state checking
        assert && assert(comparisonAccountNumberLinePoint === null, 'shouldn\'t have number line point for comparison account yet');
        assert && assert(this.comparisonAccountPointController.numberLinePoints.length === 0, 'shouldn\'t have number line point for comparison account controller yet');

        // Create the point and add it to the number line.
        comparisonAccountNumberLinePoint = new NumberLinePoint(numberLine, {
          valueProperty: this.comparisonAccount.balanceProperty,
          initialColor: COMPARISON_ACCOUNT_POINT_COLOR
        });
        numberLine.addPoint(comparisonAccountNumberLinePoint);

        // Associate the controller with this point.
        this.comparisonAccountPointController.associateWithNumberLinePoint(comparisonAccountNumberLinePoint);
      } else {
        // state checking
        assert && assert(comparisonAccountNumberLinePoint !== null, 'should have number line point for comparison account');
        assert && assert(this.comparisonAccountPointController.numberLinePoints.length === 1, 'should be controlling a single point');

        // Remove the point for the comparison account from the number line.
        this.comparisonAccountPointController.removeClearAndDisposePoints();
        comparisonAccountNumberLinePoint = null;
      }
    });
  }

  /**
   * Restore initial state to the scene.
   * @override
   * @public
   */
  resetScene() {
    this.primaryAccount.reset();
    this.showComparisonAccountProperty.reset();
    this.comparisonAccount.reset();
  }
}

// static properties
BankSceneModel.PRIMARY_ACCOUNT_POINT_COLOR = PRIMARY_ACCOUNT_POINT_COLOR;
BankSceneModel.COMPARISON_ACCOUNT_POINT_COLOR = COMPARISON_ACCOUNT_POINT_COLOR;
numberLineIntegers.register('BankSceneModel', BankSceneModel);
export default BankSceneModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJWZWN0b3IyIiwiTG9ja1RvTnVtYmVyTGluZSIsIk51bWJlckxpbmVQb2ludCIsIlBvaW50Q29udHJvbGxlciIsIk9yaWVudGF0aW9uIiwiQ29sb3IiLCJOTElDb25zdGFudHMiLCJudW1iZXJMaW5lSW50ZWdlcnMiLCJCYW5rQWNjb3VudCIsIlNjZW5lTW9kZWwiLCJTQ0VORV9CT1VORFMiLCJOTElfTEFZT1VUX0JPVU5EUyIsIlBSSU1BUllfQUNDT1VOVF9QT0lOVF9DT0xPUiIsIkNPTVBBUklTT05fQUNDT1VOVF9QT0lOVF9DT0xPUiIsIklOSVRJQUxfUFJJTUFSWV9BQ0NPVU5UX0JBTEFOQ0UiLCJJTklUSUFMX0NPTVBBUklTT05fQUNDT1VOVF9CQUxBTkNFIiwiQmFua1NjZW5lTW9kZWwiLCJjb25zdHJ1Y3RvciIsIm51bWJlckxpbmVaZXJvUG9zaXRpb24iLCJ3aWR0aCIsImNlbnRlclkiLCJudW1iZXJMaW5lWmVyb1Bvc2l0aW9ucyIsImNvbW1vbk51bWJlckxpbmVPcHRpb25zIiwiaW5pdGlhbE9yaWVudGF0aW9uIiwiSE9SSVpPTlRBTCIsImxhYmVsc0luaXRpYWxseVZpc2libGUiLCJ3aWR0aEluTW9kZWxTcGFjZSIsImluaXRpYWxQb2ludFNwZWNzIiwiaW5pdGlhbFZhbHVlIiwiY29sb3IiLCJwcmltYXJ5QWNjb3VudCIsImFzc2VydCIsIm51bWJlckxpbmVzIiwibGVuZ3RoIiwibnVtYmVyTGluZSIsImJhbGFuY2VQcm9wZXJ0eSIsImxpbmsiLCJiYWxhbmNlIiwicmVzaWRlbnRQb2ludHMiLCJnZXQiLCJwcm9wb3NlVmFsdWUiLCJ2YWx1ZVByb3BlcnR5IiwidmFsdWUiLCJjb21wYXJpc29uQWNjb3VudCIsInNob3dDb21wYXJpc29uQWNjb3VudFByb3BlcnR5IiwicHJpbWFyeUFjY291bnRQb2ludENvbnRyb2xsZXIiLCJjb2xvclByb3BlcnR5IiwibG9ja1RvTnVtYmVyTGluZSIsIkFMV0FZUyIsIm51bWJlckxpbmVQb2ludHMiLCJvZmZzZXRGcm9tSG9yaXpvbnRhbE51bWJlckxpbmUiLCJjb21wYXJpc29uQWNjb3VudFBvaW50Q29udHJvbGxlciIsImNvbXBhcmlzb25BY2NvdW50TnVtYmVyTGluZVBvaW50IiwibGF6eUxpbmsiLCJzaG93Q29tcGFyaXNvbkFjY291bnQiLCJpbml0aWFsQ29sb3IiLCJhZGRQb2ludCIsImFzc29jaWF0ZVdpdGhOdW1iZXJMaW5lUG9pbnQiLCJyZW1vdmVDbGVhckFuZERpc3Bvc2VQb2ludHMiLCJyZXNldFNjZW5lIiwicmVzZXQiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkJhbmtTY2VuZU1vZGVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIG1vZGVsIGZvciB0aGUgXCJiYW5rXCIgc2NlbmVcclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgTG9ja1RvTnVtYmVyTGluZSBmcm9tICcuLi8uLi8uLi8uLi9udW1iZXItbGluZS1jb21tb24vanMvY29tbW9uL21vZGVsL0xvY2tUb051bWJlckxpbmUuanMnO1xyXG5pbXBvcnQgTnVtYmVyTGluZVBvaW50IGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9qcy9jb21tb24vbW9kZWwvTnVtYmVyTGluZVBvaW50LmpzJztcclxuaW1wb3J0IFBvaW50Q29udHJvbGxlciBmcm9tICcuLi8uLi8uLi8uLi9udW1iZXItbGluZS1jb21tb24vanMvY29tbW9uL21vZGVsL1BvaW50Q29udHJvbGxlci5qcyc7XHJcbmltcG9ydCBPcmllbnRhdGlvbiBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvT3JpZW50YXRpb24uanMnO1xyXG5pbXBvcnQgeyBDb2xvciB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBOTElDb25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL05MSUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBudW1iZXJMaW5lSW50ZWdlcnMgZnJvbSAnLi4vLi4vbnVtYmVyTGluZUludGVnZXJzLmpzJztcclxuaW1wb3J0IEJhbmtBY2NvdW50IGZyb20gJy4vQmFua0FjY291bnQuanMnO1xyXG5pbXBvcnQgU2NlbmVNb2RlbCBmcm9tICcuL1NjZW5lTW9kZWwuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IFNDRU5FX0JPVU5EUyA9IE5MSUNvbnN0YW50cy5OTElfTEFZT1VUX0JPVU5EUzsgLy8gYm91bmRzIGZvciB0aGUgc2NlbmVzIG1hdGNoIHRoZSBsYXlvdXQgYm91bmRzXHJcbmNvbnN0IFBSSU1BUllfQUNDT1VOVF9QT0lOVF9DT0xPUiA9IG5ldyBDb2xvciggJyNkMjVkYTMnICk7XHJcbmNvbnN0IENPTVBBUklTT05fQUNDT1VOVF9QT0lOVF9DT0xPUiA9IG5ldyBDb2xvciggJyMwMDFmZmYnICk7XHJcbmNvbnN0IElOSVRJQUxfUFJJTUFSWV9BQ0NPVU5UX0JBTEFOQ0UgPSAxMDtcclxuY29uc3QgSU5JVElBTF9DT01QQVJJU09OX0FDQ09VTlRfQkFMQU5DRSA9IDQwO1xyXG5cclxuY2xhc3MgQmFua1NjZW5lTW9kZWwgZXh0ZW5kcyBTY2VuZU1vZGVsIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG5cclxuICAgIC8vIFBvc2l0aW9uIHRoZSBudW1iZXIgbGluZSBvbiB0aGUgbGVmdCBwb3J0aW9uIG9mIHRoZSBzY3JlZW4gYW5kIHJvdWdobHkgY2VudGVyZWQgdmVydGljYWxseS4gIFRoZSBkZXRhaWxzIG9mXHJcbiAgICAvLyB0aGVzZSB2YWx1ZXMgd2VyZSBlbXBpcmljYWxseSBkZXRlcm1pbmVkIGJ5IGNvbXBhcmluZyB3aXRoIHRoZSBtb2NrdXBzIGluIHRoZSBkZXNpZ24gZG9jLlxyXG4gICAgY29uc3QgbnVtYmVyTGluZVplcm9Qb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCBTQ0VORV9CT1VORFMud2lkdGggKiAwLjM3LCBTQ0VORV9CT1VORFMuY2VudGVyWSApO1xyXG5cclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIG51bWJlckxpbmVaZXJvUG9zaXRpb25zOiBbIG51bWJlckxpbmVaZXJvUG9zaXRpb24gXSxcclxuICAgICAgY29tbW9uTnVtYmVyTGluZU9wdGlvbnM6IHtcclxuICAgICAgICBpbml0aWFsT3JpZW50YXRpb246IE9yaWVudGF0aW9uLkhPUklaT05UQUwsXHJcbiAgICAgICAgbGFiZWxzSW5pdGlhbGx5VmlzaWJsZTogdHJ1ZSxcclxuICAgICAgICB3aWR0aEluTW9kZWxTcGFjZTogU0NFTkVfQk9VTkRTLndpZHRoICogMC40NzUsXHJcbiAgICAgICAgaW5pdGlhbFBvaW50U3BlY3M6IFsge1xyXG4gICAgICAgICAgaW5pdGlhbFZhbHVlOiBJTklUSUFMX1BSSU1BUllfQUNDT1VOVF9CQUxBTkNFLFxyXG4gICAgICAgICAgY29sb3I6IG5ldyBDb2xvciggUFJJTUFSWV9BQ0NPVU5UX1BPSU5UX0NPTE9SIClcclxuICAgICAgICB9IF1cclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMgLSBiYW5rIGFjY291bnQgdGhhdCBpcyBhbHdheXMgc2hvd24gaW4gdGhlIHZpZXdcclxuICAgIHRoaXMucHJpbWFyeUFjY291bnQgPSBuZXcgQmFua0FjY291bnQoIElOSVRJQUxfUFJJTUFSWV9BQ0NPVU5UX0JBTEFOQ0UgKTtcclxuXHJcbiAgICAvLyBUaGVyZSBpcyBvbmx5IG9uZSBudW1iZXIgbGluZSBpbiB0aGlzIHNjZW5lIC0gZ2V0IGEgbG9jYWwgcmVmZXJlbmNlIHRvIGl0IGZvciBjb252ZW5pZW5jZS5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHRoaXMubnVtYmVyTGluZXMubGVuZ3RoID09PSAxICk7XHJcbiAgICBjb25zdCBudW1iZXJMaW5lID0gdGhpcy5udW1iZXJMaW5lc1sgMCBdO1xyXG5cclxuICAgIC8vIEhvb2sgdGhlIHByaW1hcnkgYWNjb3VudCBiYWxhbmNlIHVwIHRvIHRoZSBmaXJzdCBudW1iZXIgbGluZSBwb2ludC5cclxuICAgIHRoaXMucHJpbWFyeUFjY291bnQuYmFsYW5jZVByb3BlcnR5LmxpbmsoIGJhbGFuY2UgPT4ge1xyXG4gICAgICBudW1iZXJMaW5lLnJlc2lkZW50UG9pbnRzLmdldCggMCApLnByb3Bvc2VWYWx1ZSggYmFsYW5jZSApO1xyXG4gICAgfSApO1xyXG4gICAgbnVtYmVyTGluZS5yZXNpZGVudFBvaW50cy5nZXQoIDAgKS52YWx1ZVByb3BlcnR5LmxpbmsoIHZhbHVlID0+IHtcclxuICAgICAgdGhpcy5wcmltYXJ5QWNjb3VudC5iYWxhbmNlUHJvcGVydHkudmFsdWUgPSB2YWx1ZTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBAcHVibGljIHtCYW5rQWNjb3VudH0gLSBiYW5rIGFjY291bnQgdGhhdCBpcyBzaG93biB3aGVuIHRoZSB1c2VyIHdhbnRzIHRvIGNvbXBhcmUgdHdvIGFjY291bnRzXHJcbiAgICB0aGlzLmNvbXBhcmlzb25BY2NvdW50ID0gbmV3IEJhbmtBY2NvdW50KCBJTklUSUFMX0NPTVBBUklTT05fQUNDT1VOVF9CQUxBTkNFICk7XHJcblxyXG4gICAgLy8gSG9vayB0aGUgY29tcGFyaXNvbiBhY2NvdW50IGJhbGFuY2UgdXAgdG8gdGhlIHNlY29uZCBudW1iZXIgbGluZSBwb2ludC5cclxuICAgIHRoaXMuY29tcGFyaXNvbkFjY291bnQuYmFsYW5jZVByb3BlcnR5LmxpbmsoIGJhbGFuY2UgPT4ge1xyXG4gICAgICBpZiAoIG51bWJlckxpbmUucmVzaWRlbnRQb2ludHMubGVuZ3RoID4gMSApIHtcclxuICAgICAgICBudW1iZXJMaW5lLnJlc2lkZW50UG9pbnRzLmdldCggMSApLnByb3Bvc2VWYWx1ZSggYmFsYW5jZSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7Qm9vbGVhblByb3BlcnR5fSAtIGNvbnRyb2xzIHdoZXRoZXIgdGhlIGNvbXBhcmlzb24gYWNjb3VudCBzaG91bGQgYmUgdmlzaWJsZSB0byB0aGUgdXNlclxyXG4gICAgdGhpcy5zaG93Q29tcGFyaXNvbkFjY291bnRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7UG9pbnRDb250cm9sbGVyfSAtIHRoZSBwb2ludCBjb250cm9sbGVyIGZvciB0aGUgcHJpbWFyeSBhY2NvdW50XHJcbiAgICB0aGlzLnByaW1hcnlBY2NvdW50UG9pbnRDb250cm9sbGVyID0gbmV3IFBvaW50Q29udHJvbGxlcigge1xyXG4gICAgICBjb2xvcjogbnVtYmVyTGluZS5yZXNpZGVudFBvaW50cy5nZXQoIDAgKS5jb2xvclByb3BlcnR5LnZhbHVlLFxyXG4gICAgICBsb2NrVG9OdW1iZXJMaW5lOiBMb2NrVG9OdW1iZXJMaW5lLkFMV0FZUyxcclxuICAgICAgbnVtYmVyTGluZVBvaW50czogWyBudW1iZXJMaW5lLnJlc2lkZW50UG9pbnRzLmdldCggMCApIF0sXHJcbiAgICAgIG9mZnNldEZyb21Ib3Jpem9udGFsTnVtYmVyTGluZTogMTIwLFxyXG4gICAgICBudW1iZXJMaW5lczogWyBudW1iZXJMaW5lIF1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBAcHVibGljIHtQb2ludENvbnRyb2xsZXJ9IC0gdGhlIHBvaW50IGNvbnRyb2xsZXIgZm9yIHRoZSBjb21wYXJpc29uIGFjY291bnRcclxuICAgIHRoaXMuY29tcGFyaXNvbkFjY291bnRQb2ludENvbnRyb2xsZXIgPSBuZXcgUG9pbnRDb250cm9sbGVyKCB7XHJcbiAgICAgIGxvY2tUb051bWJlckxpbmU6IExvY2tUb051bWJlckxpbmUuQUxXQVlTLFxyXG4gICAgICBvZmZzZXRGcm9tSG9yaXpvbnRhbE51bWJlckxpbmU6IC0xMjAsXHJcbiAgICAgIG51bWJlckxpbmVzOiBbIG51bWJlckxpbmUgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHRoZSBudW1iZXIgbGluZSBwb2ludCB0aGF0IHJlcHJlc2VudHMgdGhlIGNvbXBhcmlzb24gYWNjb3VudCB2YWx1ZSwgb25seSBleGlzdHMgd2hlbiBlbmFibGVkXHJcbiAgICBsZXQgY29tcGFyaXNvbkFjY291bnROdW1iZXJMaW5lUG9pbnQgPSBudWxsO1xyXG5cclxuICAgIC8vIEFkZC9yZW1vdmUgdGhlIHBvaW50IGFuZCBwb2ludCBjb250cm9sbGVyIGZvciB0aGUgY29tcGFyaXNvbiBhY2NvdW50IHdoZW4gZW5hYmxlZC5cclxuICAgIHRoaXMuc2hvd0NvbXBhcmlzb25BY2NvdW50UHJvcGVydHkubGF6eUxpbmsoIHNob3dDb21wYXJpc29uQWNjb3VudCA9PiB7XHJcbiAgICAgIGlmICggc2hvd0NvbXBhcmlzb25BY2NvdW50ICkge1xyXG5cclxuICAgICAgICAvLyBzdGF0ZSBjaGVja2luZ1xyXG4gICAgICAgIGFzc2VydCAmJiBhc3NlcnQoXHJcbiAgICAgICAgICBjb21wYXJpc29uQWNjb3VudE51bWJlckxpbmVQb2ludCA9PT0gbnVsbCxcclxuICAgICAgICAgICdzaG91bGRuXFwndCBoYXZlIG51bWJlciBsaW5lIHBvaW50IGZvciBjb21wYXJpc29uIGFjY291bnQgeWV0J1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydChcclxuICAgICAgICAgIHRoaXMuY29tcGFyaXNvbkFjY291bnRQb2ludENvbnRyb2xsZXIubnVtYmVyTGluZVBvaW50cy5sZW5ndGggPT09IDAsXHJcbiAgICAgICAgICAnc2hvdWxkblxcJ3QgaGF2ZSBudW1iZXIgbGluZSBwb2ludCBmb3IgY29tcGFyaXNvbiBhY2NvdW50IGNvbnRyb2xsZXIgeWV0J1xyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgcG9pbnQgYW5kIGFkZCBpdCB0byB0aGUgbnVtYmVyIGxpbmUuXHJcbiAgICAgICAgY29tcGFyaXNvbkFjY291bnROdW1iZXJMaW5lUG9pbnQgPSBuZXcgTnVtYmVyTGluZVBvaW50KCBudW1iZXJMaW5lLCB7XHJcbiAgICAgICAgICB2YWx1ZVByb3BlcnR5OiB0aGlzLmNvbXBhcmlzb25BY2NvdW50LmJhbGFuY2VQcm9wZXJ0eSxcclxuICAgICAgICAgIGluaXRpYWxDb2xvcjogQ09NUEFSSVNPTl9BQ0NPVU5UX1BPSU5UX0NPTE9SXHJcbiAgICAgICAgfSApO1xyXG4gICAgICAgIG51bWJlckxpbmUuYWRkUG9pbnQoIGNvbXBhcmlzb25BY2NvdW50TnVtYmVyTGluZVBvaW50ICk7XHJcblxyXG4gICAgICAgIC8vIEFzc29jaWF0ZSB0aGUgY29udHJvbGxlciB3aXRoIHRoaXMgcG9pbnQuXHJcbiAgICAgICAgdGhpcy5jb21wYXJpc29uQWNjb3VudFBvaW50Q29udHJvbGxlci5hc3NvY2lhdGVXaXRoTnVtYmVyTGluZVBvaW50KCBjb21wYXJpc29uQWNjb3VudE51bWJlckxpbmVQb2ludCApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAvLyBzdGF0ZSBjaGVja2luZ1xyXG4gICAgICAgIGFzc2VydCAmJiBhc3NlcnQoXHJcbiAgICAgICAgICBjb21wYXJpc29uQWNjb3VudE51bWJlckxpbmVQb2ludCAhPT0gbnVsbCxcclxuICAgICAgICAgICdzaG91bGQgaGF2ZSBudW1iZXIgbGluZSBwb2ludCBmb3IgY29tcGFyaXNvbiBhY2NvdW50J1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydChcclxuICAgICAgICAgIHRoaXMuY29tcGFyaXNvbkFjY291bnRQb2ludENvbnRyb2xsZXIubnVtYmVyTGluZVBvaW50cy5sZW5ndGggPT09IDEsXHJcbiAgICAgICAgICAnc2hvdWxkIGJlIGNvbnRyb2xsaW5nIGEgc2luZ2xlIHBvaW50J1xyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIC8vIFJlbW92ZSB0aGUgcG9pbnQgZm9yIHRoZSBjb21wYXJpc29uIGFjY291bnQgZnJvbSB0aGUgbnVtYmVyIGxpbmUuXHJcbiAgICAgICAgdGhpcy5jb21wYXJpc29uQWNjb3VudFBvaW50Q29udHJvbGxlci5yZW1vdmVDbGVhckFuZERpc3Bvc2VQb2ludHMoKTtcclxuICAgICAgICBjb21wYXJpc29uQWNjb3VudE51bWJlckxpbmVQb2ludCA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RvcmUgaW5pdGlhbCBzdGF0ZSB0byB0aGUgc2NlbmUuXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHJlc2V0U2NlbmUoKSB7XHJcbiAgICB0aGlzLnByaW1hcnlBY2NvdW50LnJlc2V0KCk7XHJcbiAgICB0aGlzLnNob3dDb21wYXJpc29uQWNjb3VudFByb3BlcnR5LnJlc2V0KCk7XHJcbiAgICB0aGlzLmNvbXBhcmlzb25BY2NvdW50LnJlc2V0KCk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBzdGF0aWMgcHJvcGVydGllc1xyXG5CYW5rU2NlbmVNb2RlbC5QUklNQVJZX0FDQ09VTlRfUE9JTlRfQ09MT1IgPSBQUklNQVJZX0FDQ09VTlRfUE9JTlRfQ09MT1I7XHJcbkJhbmtTY2VuZU1vZGVsLkNPTVBBUklTT05fQUNDT1VOVF9QT0lOVF9DT0xPUiA9IENPTVBBUklTT05fQUNDT1VOVF9QT0lOVF9DT0xPUjtcclxuXHJcbm51bWJlckxpbmVJbnRlZ2Vycy5yZWdpc3RlciggJ0JhbmtTY2VuZU1vZGVsJywgQmFua1NjZW5lTW9kZWwgKTtcclxuZXhwb3J0IGRlZmF1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