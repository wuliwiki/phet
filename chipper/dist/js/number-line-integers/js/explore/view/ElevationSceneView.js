// Copyright 2019-2022, University of Colorado Boulder

/**
 * view for the "Elevation" scene
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import birdInAir_png from '../../../../number-line-common/images/birdInAir_png.js';
import birdInWater_png from '../../../../number-line-common/images/birdInWater_png.js';
import fishInAir_png from '../../../../number-line-common/images/fishInAir_png.js';
import fishInWater_png from '../../../../number-line-common/images/fishInWater_png.js';
import PointControllerNode from '../../../../number-line-common/js/common/view/PointControllerNode.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Image, Node, Rectangle, Text } from '../../../../scenery/js/imports.js';
import elevationBackground_png from '../../../images/elevationBackground_png.js';
import girlHiking_png from '../../../images/girlHiking_png.js';
import girlInAir_png from '../../../images/girlInAir_png.js';
import girlInWater_png from '../../../images/girlInWater_png.js';
import numberLineIntegers from '../../numberLineIntegers.js';
import NumberLineIntegersStrings from '../../NumberLineIntegersStrings.js';
import ElevationPointControllerNode from './ElevationPointControllerNode.js';
import SceneView from './SceneView.js';

// constants
const NUMBER_LINE_LABEL_FONT = new PhetFont({
  size: 18,
  weight: 'bold'
});
const elevationAmountString = NumberLineIntegersStrings.elevationAmount;
const elevationString = NumberLineIntegersStrings.elevation;
class ElevationSceneView extends SceneView {
  /**
   * @param {ElevationSceneModel} sceneModel
   * @param {Bounds2} layoutBounds
   * @public
   */
  constructor(sceneModel, layoutBounds) {
    super(sceneModel, layoutBounds, {
      commonNumberLineNodeOptions: {
        numericalLabelTemplate: elevationAmountString,
        tickMarkLabelPositionWhenVertical: 'left'
      }
    });

    // Create and add the background image for the area where the user will be able to place things and change their
    // elevation.  This is scaled to match the bounds defined in the model, so the resolution and aspect ratio of the
    // image needs to be close to what is shown or this won't look good.
    const elevationAreaImage = new Image(elevationBackground_png);
    elevationAreaImage.scale(sceneModel.elevationAreaBounds.width / elevationAreaImage.width, sceneModel.elevationAreaBounds.height / elevationAreaImage.height);
    elevationAreaImage.center = sceneModel.elevationAreaBounds.center;
    this.scenesLayer.addChild(elevationAreaImage);

    // Add the node that represents the box that will hold the items that the user can elevate.
    this.scenesLayer.addChild(Rectangle.bounds(sceneModel.elevatableItemsBoxBounds, {
      fill: 'white',
      stroke: 'black',
      cornerRadius: 6
    }));

    // Add label for the number line.
    const numberLineLabel = new Text(elevationString, {
      font: NUMBER_LINE_LABEL_FONT,
      centerX: sceneModel.numberLines[0].centerPositionProperty.value.x,
      bottom: this.numberLineNodes[0].top - 5,
      maxWidth: this.layoutBounds.width * 0.18
    });
    sceneModel.showNumberLineProperty.linkAttribute(numberLineLabel, 'visible');
    this.scenesLayer.addChild(numberLineLabel);

    // Define a function that will be used to switch images based on its position in the model space.
    const selectImageIndex = (position, currentlySelectedImageIndex) => {
      // This function is intended to have some hysteresis, i.e. the image doesn't change until the point controller
      // fully transitions from above to below sea level or vice versa.
      let index = currentlySelectedImageIndex;
      if (position.y > sceneModel.seaLevel) {
        index = 0;
      } else if (position.y < sceneModel.seaLevel) {
        index = 1;
      }
      return index;
    };

    // Add a layer where the elevation point controllers go.
    const elevationPointControllersLayer = new Node();
    this.scenesLayer.addChild(elevationPointControllersLayer);

    // Add the girl that the user can place in the elevation scene.
    elevationPointControllersLayer.addChild(new ElevationPointControllerNode(sceneModel.permanentPointControllers[0], [new Image(girlInWater_png, {
      maxWidth: 85,
      center: new Vector2(3, 5)
    }), new Image(girlInAir_png, {
      maxWidth: 90,
      center: new Vector2(6, -25)
    }), new Image(girlHiking_png, {
      maxWidth: 30,
      center: new Vector2(0, 0)
    })], sceneModel.seaLevel, [new Vector2(3, 30), new Vector2(-25, 25), new Vector2(-25, 20)], {
      // special highly tweaked function for having the hiker image show up over the cliff
      imageSelectionFunction: (position, currentlySelectedImageIndex) => {
        // This function is intended to have some hysteresis, i.e. the image doesn't change until the point
        // controller fully transitions from above to below sea level or vice versa.
        let imageIndex = currentlySelectedImageIndex;
        if (position.y > sceneModel.seaLevel) {
          // image for underwater
          imageIndex = 0;
        } else if (position.y < sceneModel.seaLevel) {
          // The position is above sea level.  Decide whether to use the hiker or paraglider image.  This function
          // was empirically determined to match the background image and will have to be updated if the background
          // image for the scene changes.
          if (position.x > sceneModel.elevationAreaBounds.centerX + 40 + 0.6 * (sceneModel.seaLevel - position.y)) {
            // hiker
            imageIndex = 2;
          } else {
            // paraglider
            imageIndex = 1;
          }
        }
        return imageIndex;
      },
      connectorLine: false
    }));

    // Add the bird that the user can place in the elevation scene.
    elevationPointControllersLayer.addChild(new ElevationPointControllerNode(sceneModel.permanentPointControllers[1], [new Image(birdInWater_png, {
      maxWidth: 65,
      center: Vector2.ZERO
    }), new Image(birdInAir_png, {
      maxWidth: 60,
      center: new Vector2(0, -10)
    })], sceneModel.seaLevel, [new Vector2(6, 11), new Vector2(5, 10)], {
      imageSelectionFunction: selectImageIndex,
      connectorLine: false
    }));

    // Add the fish that the user can place in the elevation scene.
    elevationPointControllersLayer.addChild(new ElevationPointControllerNode(sceneModel.permanentPointControllers[2], [new Image(fishInWater_png, {
      maxWidth: 60,
      center: Vector2.ZERO
    }), new Image(fishInAir_png, {
      maxWidth: 60,
      center: Vector2.ZERO
    })], sceneModel.seaLevel, [new Vector2(5, 0), new Vector2(5, 5)], {
      imageSelectionFunction: selectImageIndex,
      connectorLine: false
    }));

    // Add the water.
    this.scenesLayer.addChild(new Rectangle(0, 0, sceneModel.elevationAreaBounds.width, sceneModel.elevationAreaBounds.maxY - sceneModel.seaLevel, {
      left: sceneModel.elevationAreaBounds.minX,
      top: sceneModel.seaLevel,
      fill: 'rgba( 0, 204, 204, 0.15 )'
    }));

    // Add the layer where the attached point controllers go.
    const attachedPointControllersLayer = new Node();
    this.addChild(attachedPointControllersLayer);
    attachedPointControllersLayer.moveToBack(); // so that they are behind the number line in z-order

    // The visibility of the attached point controllers should be the same as the number line.
    sceneModel.showNumberLineProperty.linkAttribute(attachedPointControllersLayer, 'visible');

    // Add/remove the nodes that represent the point controllers that are attached to the number line.
    sceneModel.numberLineAttachedPointControllers.addItemAddedListener(addedPointController => {
      const pointControllerNode = new PointControllerNode(addedPointController);
      attachedPointControllersLayer.addChild(pointControllerNode);
      const handlePointControllerRemoved = removedPointController => {
        if (addedPointController === removedPointController) {
          attachedPointControllersLayer.removeChild(pointControllerNode);
          pointControllerNode.dispose();
          sceneModel.numberLineAttachedPointControllers.removeItemRemovedListener(handlePointControllerRemoved);
        }
      };
      sceneModel.numberLineAttachedPointControllers.addItemRemovedListener(handlePointControllerRemoved);
    });
  }
}
numberLineIntegers.register('ElevationSceneView', ElevationSceneView);
export default ElevationSceneView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiYmlyZEluQWlyX3BuZyIsImJpcmRJbldhdGVyX3BuZyIsImZpc2hJbkFpcl9wbmciLCJmaXNoSW5XYXRlcl9wbmciLCJQb2ludENvbnRyb2xsZXJOb2RlIiwiUGhldEZvbnQiLCJJbWFnZSIsIk5vZGUiLCJSZWN0YW5nbGUiLCJUZXh0IiwiZWxldmF0aW9uQmFja2dyb3VuZF9wbmciLCJnaXJsSGlraW5nX3BuZyIsImdpcmxJbkFpcl9wbmciLCJnaXJsSW5XYXRlcl9wbmciLCJudW1iZXJMaW5lSW50ZWdlcnMiLCJOdW1iZXJMaW5lSW50ZWdlcnNTdHJpbmdzIiwiRWxldmF0aW9uUG9pbnRDb250cm9sbGVyTm9kZSIsIlNjZW5lVmlldyIsIk5VTUJFUl9MSU5FX0xBQkVMX0ZPTlQiLCJzaXplIiwid2VpZ2h0IiwiZWxldmF0aW9uQW1vdW50U3RyaW5nIiwiZWxldmF0aW9uQW1vdW50IiwiZWxldmF0aW9uU3RyaW5nIiwiZWxldmF0aW9uIiwiRWxldmF0aW9uU2NlbmVWaWV3IiwiY29uc3RydWN0b3IiLCJzY2VuZU1vZGVsIiwibGF5b3V0Qm91bmRzIiwiY29tbW9uTnVtYmVyTGluZU5vZGVPcHRpb25zIiwibnVtZXJpY2FsTGFiZWxUZW1wbGF0ZSIsInRpY2tNYXJrTGFiZWxQb3NpdGlvbldoZW5WZXJ0aWNhbCIsImVsZXZhdGlvbkFyZWFJbWFnZSIsInNjYWxlIiwiZWxldmF0aW9uQXJlYUJvdW5kcyIsIndpZHRoIiwiaGVpZ2h0IiwiY2VudGVyIiwic2NlbmVzTGF5ZXIiLCJhZGRDaGlsZCIsImJvdW5kcyIsImVsZXZhdGFibGVJdGVtc0JveEJvdW5kcyIsImZpbGwiLCJzdHJva2UiLCJjb3JuZXJSYWRpdXMiLCJudW1iZXJMaW5lTGFiZWwiLCJmb250IiwiY2VudGVyWCIsIm51bWJlckxpbmVzIiwiY2VudGVyUG9zaXRpb25Qcm9wZXJ0eSIsInZhbHVlIiwieCIsImJvdHRvbSIsIm51bWJlckxpbmVOb2RlcyIsInRvcCIsIm1heFdpZHRoIiwic2hvd051bWJlckxpbmVQcm9wZXJ0eSIsImxpbmtBdHRyaWJ1dGUiLCJzZWxlY3RJbWFnZUluZGV4IiwicG9zaXRpb24iLCJjdXJyZW50bHlTZWxlY3RlZEltYWdlSW5kZXgiLCJpbmRleCIsInkiLCJzZWFMZXZlbCIsImVsZXZhdGlvblBvaW50Q29udHJvbGxlcnNMYXllciIsInBlcm1hbmVudFBvaW50Q29udHJvbGxlcnMiLCJpbWFnZVNlbGVjdGlvbkZ1bmN0aW9uIiwiaW1hZ2VJbmRleCIsImNvbm5lY3RvckxpbmUiLCJaRVJPIiwibWF4WSIsImxlZnQiLCJtaW5YIiwiYXR0YWNoZWRQb2ludENvbnRyb2xsZXJzTGF5ZXIiLCJtb3ZlVG9CYWNrIiwibnVtYmVyTGluZUF0dGFjaGVkUG9pbnRDb250cm9sbGVycyIsImFkZEl0ZW1BZGRlZExpc3RlbmVyIiwiYWRkZWRQb2ludENvbnRyb2xsZXIiLCJwb2ludENvbnRyb2xsZXJOb2RlIiwiaGFuZGxlUG9pbnRDb250cm9sbGVyUmVtb3ZlZCIsInJlbW92ZWRQb2ludENvbnRyb2xsZXIiLCJyZW1vdmVDaGlsZCIsImRpc3Bvc2UiLCJyZW1vdmVJdGVtUmVtb3ZlZExpc3RlbmVyIiwiYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRWxldmF0aW9uU2NlbmVWaWV3LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIHZpZXcgZm9yIHRoZSBcIkVsZXZhdGlvblwiIHNjZW5lXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgYmlyZEluQWlyX3BuZyBmcm9tICcuLi8uLi8uLi8uLi9udW1iZXItbGluZS1jb21tb24vaW1hZ2VzL2JpcmRJbkFpcl9wbmcuanMnO1xyXG5pbXBvcnQgYmlyZEluV2F0ZXJfcG5nIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9pbWFnZXMvYmlyZEluV2F0ZXJfcG5nLmpzJztcclxuaW1wb3J0IGZpc2hJbkFpcl9wbmcgZnJvbSAnLi4vLi4vLi4vLi4vbnVtYmVyLWxpbmUtY29tbW9uL2ltYWdlcy9maXNoSW5BaXJfcG5nLmpzJztcclxuaW1wb3J0IGZpc2hJbldhdGVyX3BuZyBmcm9tICcuLi8uLi8uLi8uLi9udW1iZXItbGluZS1jb21tb24vaW1hZ2VzL2Zpc2hJbldhdGVyX3BuZy5qcyc7XHJcbmltcG9ydCBQb2ludENvbnRyb2xsZXJOb2RlIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9qcy9jb21tb24vdmlldy9Qb2ludENvbnRyb2xsZXJOb2RlLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IEltYWdlLCBOb2RlLCBSZWN0YW5nbGUsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgZWxldmF0aW9uQmFja2dyb3VuZF9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL2VsZXZhdGlvbkJhY2tncm91bmRfcG5nLmpzJztcclxuaW1wb3J0IGdpcmxIaWtpbmdfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9naXJsSGlraW5nX3BuZy5qcyc7XHJcbmltcG9ydCBnaXJsSW5BaXJfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9naXJsSW5BaXJfcG5nLmpzJztcclxuaW1wb3J0IGdpcmxJbldhdGVyX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvZ2lybEluV2F0ZXJfcG5nLmpzJztcclxuaW1wb3J0IG51bWJlckxpbmVJbnRlZ2VycyBmcm9tICcuLi8uLi9udW1iZXJMaW5lSW50ZWdlcnMuanMnO1xyXG5pbXBvcnQgTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncyBmcm9tICcuLi8uLi9OdW1iZXJMaW5lSW50ZWdlcnNTdHJpbmdzLmpzJztcclxuaW1wb3J0IEVsZXZhdGlvblBvaW50Q29udHJvbGxlck5vZGUgZnJvbSAnLi9FbGV2YXRpb25Qb2ludENvbnRyb2xsZXJOb2RlLmpzJztcclxuaW1wb3J0IFNjZW5lVmlldyBmcm9tICcuL1NjZW5lVmlldy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgTlVNQkVSX0xJTkVfTEFCRUxfRk9OVCA9IG5ldyBQaGV0Rm9udCggeyBzaXplOiAxOCwgd2VpZ2h0OiAnYm9sZCcgfSApO1xyXG5cclxuY29uc3QgZWxldmF0aW9uQW1vdW50U3RyaW5nID0gTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncy5lbGV2YXRpb25BbW91bnQ7XHJcbmNvbnN0IGVsZXZhdGlvblN0cmluZyA9IE51bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3MuZWxldmF0aW9uO1xyXG5cclxuXHJcbmNsYXNzIEVsZXZhdGlvblNjZW5lVmlldyBleHRlbmRzIFNjZW5lVmlldyB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7RWxldmF0aW9uU2NlbmVNb2RlbH0gc2NlbmVNb2RlbFxyXG4gICAqIEBwYXJhbSB7Qm91bmRzMn0gbGF5b3V0Qm91bmRzXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBzY2VuZU1vZGVsLCBsYXlvdXRCb3VuZHMgKSB7XHJcblxyXG4gICAgc3VwZXIoIHNjZW5lTW9kZWwsIGxheW91dEJvdW5kcywge1xyXG4gICAgICBjb21tb25OdW1iZXJMaW5lTm9kZU9wdGlvbnM6IHtcclxuICAgICAgICBudW1lcmljYWxMYWJlbFRlbXBsYXRlOiBlbGV2YXRpb25BbW91bnRTdHJpbmcsXHJcbiAgICAgICAgdGlja01hcmtMYWJlbFBvc2l0aW9uV2hlblZlcnRpY2FsOiAnbGVmdCdcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSBhbmQgYWRkIHRoZSBiYWNrZ3JvdW5kIGltYWdlIGZvciB0aGUgYXJlYSB3aGVyZSB0aGUgdXNlciB3aWxsIGJlIGFibGUgdG8gcGxhY2UgdGhpbmdzIGFuZCBjaGFuZ2UgdGhlaXJcclxuICAgIC8vIGVsZXZhdGlvbi4gIFRoaXMgaXMgc2NhbGVkIHRvIG1hdGNoIHRoZSBib3VuZHMgZGVmaW5lZCBpbiB0aGUgbW9kZWwsIHNvIHRoZSByZXNvbHV0aW9uIGFuZCBhc3BlY3QgcmF0aW8gb2YgdGhlXHJcbiAgICAvLyBpbWFnZSBuZWVkcyB0byBiZSBjbG9zZSB0byB3aGF0IGlzIHNob3duIG9yIHRoaXMgd29uJ3QgbG9vayBnb29kLlxyXG4gICAgY29uc3QgZWxldmF0aW9uQXJlYUltYWdlID0gbmV3IEltYWdlKCBlbGV2YXRpb25CYWNrZ3JvdW5kX3BuZyApO1xyXG4gICAgZWxldmF0aW9uQXJlYUltYWdlLnNjYWxlKFxyXG4gICAgICBzY2VuZU1vZGVsLmVsZXZhdGlvbkFyZWFCb3VuZHMud2lkdGggLyBlbGV2YXRpb25BcmVhSW1hZ2Uud2lkdGgsXHJcbiAgICAgIHNjZW5lTW9kZWwuZWxldmF0aW9uQXJlYUJvdW5kcy5oZWlnaHQgLyBlbGV2YXRpb25BcmVhSW1hZ2UuaGVpZ2h0XHJcbiAgICApO1xyXG4gICAgZWxldmF0aW9uQXJlYUltYWdlLmNlbnRlciA9IHNjZW5lTW9kZWwuZWxldmF0aW9uQXJlYUJvdW5kcy5jZW50ZXI7XHJcbiAgICB0aGlzLnNjZW5lc0xheWVyLmFkZENoaWxkKCBlbGV2YXRpb25BcmVhSW1hZ2UgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIG5vZGUgdGhhdCByZXByZXNlbnRzIHRoZSBib3ggdGhhdCB3aWxsIGhvbGQgdGhlIGl0ZW1zIHRoYXQgdGhlIHVzZXIgY2FuIGVsZXZhdGUuXHJcbiAgICB0aGlzLnNjZW5lc0xheWVyLmFkZENoaWxkKCBSZWN0YW5nbGUuYm91bmRzKCBzY2VuZU1vZGVsLmVsZXZhdGFibGVJdGVtc0JveEJvdW5kcywge1xyXG4gICAgICBmaWxsOiAnd2hpdGUnLFxyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGNvcm5lclJhZGl1czogNlxyXG4gICAgfSApICk7XHJcblxyXG4gICAgLy8gQWRkIGxhYmVsIGZvciB0aGUgbnVtYmVyIGxpbmUuXHJcbiAgICBjb25zdCBudW1iZXJMaW5lTGFiZWwgPSBuZXcgVGV4dCggZWxldmF0aW9uU3RyaW5nLCB7XHJcbiAgICAgIGZvbnQ6IE5VTUJFUl9MSU5FX0xBQkVMX0ZPTlQsXHJcbiAgICAgIGNlbnRlclg6IHNjZW5lTW9kZWwubnVtYmVyTGluZXNbIDAgXS5jZW50ZXJQb3NpdGlvblByb3BlcnR5LnZhbHVlLngsXHJcbiAgICAgIGJvdHRvbTogdGhpcy5udW1iZXJMaW5lTm9kZXNbIDAgXS50b3AgLSA1LFxyXG4gICAgICBtYXhXaWR0aDogdGhpcy5sYXlvdXRCb3VuZHMud2lkdGggKiAwLjE4XHJcbiAgICB9ICk7XHJcbiAgICBzY2VuZU1vZGVsLnNob3dOdW1iZXJMaW5lUHJvcGVydHkubGlua0F0dHJpYnV0ZSggbnVtYmVyTGluZUxhYmVsLCAndmlzaWJsZScgKTtcclxuICAgIHRoaXMuc2NlbmVzTGF5ZXIuYWRkQ2hpbGQoIG51bWJlckxpbmVMYWJlbCApO1xyXG5cclxuICAgIC8vIERlZmluZSBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSB1c2VkIHRvIHN3aXRjaCBpbWFnZXMgYmFzZWQgb24gaXRzIHBvc2l0aW9uIGluIHRoZSBtb2RlbCBzcGFjZS5cclxuICAgIGNvbnN0IHNlbGVjdEltYWdlSW5kZXggPSAoIHBvc2l0aW9uLCBjdXJyZW50bHlTZWxlY3RlZEltYWdlSW5kZXggKSA9PiB7XHJcblxyXG4gICAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGludGVuZGVkIHRvIGhhdmUgc29tZSBoeXN0ZXJlc2lzLCBpLmUuIHRoZSBpbWFnZSBkb2Vzbid0IGNoYW5nZSB1bnRpbCB0aGUgcG9pbnQgY29udHJvbGxlclxyXG4gICAgICAvLyBmdWxseSB0cmFuc2l0aW9ucyBmcm9tIGFib3ZlIHRvIGJlbG93IHNlYSBsZXZlbCBvciB2aWNlIHZlcnNhLlxyXG4gICAgICBsZXQgaW5kZXggPSBjdXJyZW50bHlTZWxlY3RlZEltYWdlSW5kZXg7XHJcbiAgICAgIGlmICggcG9zaXRpb24ueSA+IHNjZW5lTW9kZWwuc2VhTGV2ZWwgKSB7XHJcbiAgICAgICAgaW5kZXggPSAwO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBwb3NpdGlvbi55IDwgc2NlbmVNb2RlbC5zZWFMZXZlbCApIHtcclxuICAgICAgICBpbmRleCA9IDE7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGluZGV4O1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBBZGQgYSBsYXllciB3aGVyZSB0aGUgZWxldmF0aW9uIHBvaW50IGNvbnRyb2xsZXJzIGdvLlxyXG4gICAgY29uc3QgZWxldmF0aW9uUG9pbnRDb250cm9sbGVyc0xheWVyID0gbmV3IE5vZGUoKTtcclxuICAgIHRoaXMuc2NlbmVzTGF5ZXIuYWRkQ2hpbGQoIGVsZXZhdGlvblBvaW50Q29udHJvbGxlcnNMYXllciApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgZ2lybCB0aGF0IHRoZSB1c2VyIGNhbiBwbGFjZSBpbiB0aGUgZWxldmF0aW9uIHNjZW5lLlxyXG4gICAgZWxldmF0aW9uUG9pbnRDb250cm9sbGVyc0xheWVyLmFkZENoaWxkKCBuZXcgRWxldmF0aW9uUG9pbnRDb250cm9sbGVyTm9kZShcclxuICAgICAgc2NlbmVNb2RlbC5wZXJtYW5lbnRQb2ludENvbnRyb2xsZXJzWyAwIF0sXHJcbiAgICAgIFtcclxuICAgICAgICBuZXcgSW1hZ2UoIGdpcmxJbldhdGVyX3BuZywgeyBtYXhXaWR0aDogODUsIGNlbnRlcjogbmV3IFZlY3RvcjIoIDMsIDUgKSB9ICksXHJcbiAgICAgICAgbmV3IEltYWdlKCBnaXJsSW5BaXJfcG5nLCB7IG1heFdpZHRoOiA5MCwgY2VudGVyOiBuZXcgVmVjdG9yMiggNiwgLTI1ICkgfSApLFxyXG4gICAgICAgIG5ldyBJbWFnZSggZ2lybEhpa2luZ19wbmcsIHsgbWF4V2lkdGg6IDMwLCBjZW50ZXI6IG5ldyBWZWN0b3IyKCAwLCAwICkgfSApXHJcbiAgICAgIF0sXHJcbiAgICAgIHNjZW5lTW9kZWwuc2VhTGV2ZWwsXHJcbiAgICAgIFtcclxuICAgICAgICBuZXcgVmVjdG9yMiggMywgMzAgKSxcclxuICAgICAgICBuZXcgVmVjdG9yMiggLTI1LCAyNSApLFxyXG4gICAgICAgIG5ldyBWZWN0b3IyKCAtMjUsIDIwIClcclxuICAgICAgXSxcclxuICAgICAge1xyXG4gICAgICAgIC8vIHNwZWNpYWwgaGlnaGx5IHR3ZWFrZWQgZnVuY3Rpb24gZm9yIGhhdmluZyB0aGUgaGlrZXIgaW1hZ2Ugc2hvdyB1cCBvdmVyIHRoZSBjbGlmZlxyXG4gICAgICAgIGltYWdlU2VsZWN0aW9uRnVuY3Rpb246ICggcG9zaXRpb24sIGN1cnJlbnRseVNlbGVjdGVkSW1hZ2VJbmRleCApID0+IHtcclxuXHJcbiAgICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGludGVuZGVkIHRvIGhhdmUgc29tZSBoeXN0ZXJlc2lzLCBpLmUuIHRoZSBpbWFnZSBkb2Vzbid0IGNoYW5nZSB1bnRpbCB0aGUgcG9pbnRcclxuICAgICAgICAgIC8vIGNvbnRyb2xsZXIgZnVsbHkgdHJhbnNpdGlvbnMgZnJvbSBhYm92ZSB0byBiZWxvdyBzZWEgbGV2ZWwgb3IgdmljZSB2ZXJzYS5cclxuICAgICAgICAgIGxldCBpbWFnZUluZGV4ID0gY3VycmVudGx5U2VsZWN0ZWRJbWFnZUluZGV4O1xyXG4gICAgICAgICAgaWYgKCBwb3NpdGlvbi55ID4gc2NlbmVNb2RlbC5zZWFMZXZlbCApIHtcclxuXHJcbiAgICAgICAgICAgIC8vIGltYWdlIGZvciB1bmRlcndhdGVyXHJcbiAgICAgICAgICAgIGltYWdlSW5kZXggPSAwO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSBpZiAoIHBvc2l0aW9uLnkgPCBzY2VuZU1vZGVsLnNlYUxldmVsICkge1xyXG5cclxuICAgICAgICAgICAgLy8gVGhlIHBvc2l0aW9uIGlzIGFib3ZlIHNlYSBsZXZlbC4gIERlY2lkZSB3aGV0aGVyIHRvIHVzZSB0aGUgaGlrZXIgb3IgcGFyYWdsaWRlciBpbWFnZS4gIFRoaXMgZnVuY3Rpb25cclxuICAgICAgICAgICAgLy8gd2FzIGVtcGlyaWNhbGx5IGRldGVybWluZWQgdG8gbWF0Y2ggdGhlIGJhY2tncm91bmQgaW1hZ2UgYW5kIHdpbGwgaGF2ZSB0byBiZSB1cGRhdGVkIGlmIHRoZSBiYWNrZ3JvdW5kXHJcbiAgICAgICAgICAgIC8vIGltYWdlIGZvciB0aGUgc2NlbmUgY2hhbmdlcy5cclxuICAgICAgICAgICAgaWYgKCBwb3NpdGlvbi54ID5cclxuICAgICAgICAgICAgICAgICAoIHNjZW5lTW9kZWwuZWxldmF0aW9uQXJlYUJvdW5kcy5jZW50ZXJYICsgNDAgKyAwLjYgKiAoIHNjZW5lTW9kZWwuc2VhTGV2ZWwgLSBwb3NpdGlvbi55ICkgKSApIHtcclxuXHJcbiAgICAgICAgICAgICAgLy8gaGlrZXJcclxuICAgICAgICAgICAgICBpbWFnZUluZGV4ID0gMjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgLy8gcGFyYWdsaWRlclxyXG4gICAgICAgICAgICAgIGltYWdlSW5kZXggPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gaW1hZ2VJbmRleDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNvbm5lY3RvckxpbmU6IGZhbHNlXHJcbiAgICAgIH1cclxuICAgICkgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGJpcmQgdGhhdCB0aGUgdXNlciBjYW4gcGxhY2UgaW4gdGhlIGVsZXZhdGlvbiBzY2VuZS5cclxuICAgIGVsZXZhdGlvblBvaW50Q29udHJvbGxlcnNMYXllci5hZGRDaGlsZCggbmV3IEVsZXZhdGlvblBvaW50Q29udHJvbGxlck5vZGUoXHJcbiAgICAgIHNjZW5lTW9kZWwucGVybWFuZW50UG9pbnRDb250cm9sbGVyc1sgMSBdLFxyXG4gICAgICBbXHJcbiAgICAgICAgbmV3IEltYWdlKCBiaXJkSW5XYXRlcl9wbmcsIHsgbWF4V2lkdGg6IDY1LCBjZW50ZXI6IFZlY3RvcjIuWkVSTyB9ICksXHJcbiAgICAgICAgbmV3IEltYWdlKCBiaXJkSW5BaXJfcG5nLCB7IG1heFdpZHRoOiA2MCwgY2VudGVyOiBuZXcgVmVjdG9yMiggMCwgLTEwICkgfSApXHJcbiAgICAgIF0sXHJcbiAgICAgIHNjZW5lTW9kZWwuc2VhTGV2ZWwsXHJcbiAgICAgIFtcclxuICAgICAgICBuZXcgVmVjdG9yMiggNiwgMTEgKSxcclxuICAgICAgICBuZXcgVmVjdG9yMiggNSwgMTAgKVxyXG4gICAgICBdLFxyXG4gICAgICB7XHJcbiAgICAgICAgaW1hZ2VTZWxlY3Rpb25GdW5jdGlvbjogc2VsZWN0SW1hZ2VJbmRleCxcclxuICAgICAgICBjb25uZWN0b3JMaW5lOiBmYWxzZVxyXG4gICAgICB9XHJcbiAgICApICk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBmaXNoIHRoYXQgdGhlIHVzZXIgY2FuIHBsYWNlIGluIHRoZSBlbGV2YXRpb24gc2NlbmUuXHJcbiAgICBlbGV2YXRpb25Qb2ludENvbnRyb2xsZXJzTGF5ZXIuYWRkQ2hpbGQoIG5ldyBFbGV2YXRpb25Qb2ludENvbnRyb2xsZXJOb2RlKFxyXG4gICAgICBzY2VuZU1vZGVsLnBlcm1hbmVudFBvaW50Q29udHJvbGxlcnNbIDIgXSxcclxuICAgICAgW1xyXG4gICAgICAgIG5ldyBJbWFnZSggZmlzaEluV2F0ZXJfcG5nLCB7IG1heFdpZHRoOiA2MCwgY2VudGVyOiBWZWN0b3IyLlpFUk8gfSApLFxyXG4gICAgICAgIG5ldyBJbWFnZSggZmlzaEluQWlyX3BuZywgeyBtYXhXaWR0aDogNjAsIGNlbnRlcjogVmVjdG9yMi5aRVJPIH0gKVxyXG4gICAgICBdLFxyXG4gICAgICBzY2VuZU1vZGVsLnNlYUxldmVsLFxyXG4gICAgICBbXHJcbiAgICAgICAgbmV3IFZlY3RvcjIoIDUsIDAgKSxcclxuICAgICAgICBuZXcgVmVjdG9yMiggNSwgNSApXHJcbiAgICAgIF0sXHJcbiAgICAgIHtcclxuICAgICAgICBpbWFnZVNlbGVjdGlvbkZ1bmN0aW9uOiBzZWxlY3RJbWFnZUluZGV4LFxyXG4gICAgICAgIGNvbm5lY3RvckxpbmU6IGZhbHNlXHJcbiAgICAgIH1cclxuICAgICkgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIHdhdGVyLlxyXG4gICAgdGhpcy5zY2VuZXNMYXllci5hZGRDaGlsZCggbmV3IFJlY3RhbmdsZShcclxuICAgICAgMCxcclxuICAgICAgMCxcclxuICAgICAgc2NlbmVNb2RlbC5lbGV2YXRpb25BcmVhQm91bmRzLndpZHRoLFxyXG4gICAgICBzY2VuZU1vZGVsLmVsZXZhdGlvbkFyZWFCb3VuZHMubWF4WSAtIHNjZW5lTW9kZWwuc2VhTGV2ZWwsXHJcbiAgICAgIHtcclxuICAgICAgICBsZWZ0OiBzY2VuZU1vZGVsLmVsZXZhdGlvbkFyZWFCb3VuZHMubWluWCxcclxuICAgICAgICB0b3A6IHNjZW5lTW9kZWwuc2VhTGV2ZWwsXHJcbiAgICAgICAgZmlsbDogJ3JnYmEoIDAsIDIwNCwgMjA0LCAwLjE1ICknXHJcbiAgICAgIH1cclxuICAgICkgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGxheWVyIHdoZXJlIHRoZSBhdHRhY2hlZCBwb2ludCBjb250cm9sbGVycyBnby5cclxuICAgIGNvbnN0IGF0dGFjaGVkUG9pbnRDb250cm9sbGVyc0xheWVyID0gbmV3IE5vZGUoKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGF0dGFjaGVkUG9pbnRDb250cm9sbGVyc0xheWVyICk7XHJcbiAgICBhdHRhY2hlZFBvaW50Q29udHJvbGxlcnNMYXllci5tb3ZlVG9CYWNrKCk7IC8vIHNvIHRoYXQgdGhleSBhcmUgYmVoaW5kIHRoZSBudW1iZXIgbGluZSBpbiB6LW9yZGVyXHJcblxyXG4gICAgLy8gVGhlIHZpc2liaWxpdHkgb2YgdGhlIGF0dGFjaGVkIHBvaW50IGNvbnRyb2xsZXJzIHNob3VsZCBiZSB0aGUgc2FtZSBhcyB0aGUgbnVtYmVyIGxpbmUuXHJcbiAgICBzY2VuZU1vZGVsLnNob3dOdW1iZXJMaW5lUHJvcGVydHkubGlua0F0dHJpYnV0ZSggYXR0YWNoZWRQb2ludENvbnRyb2xsZXJzTGF5ZXIsICd2aXNpYmxlJyApO1xyXG5cclxuICAgIC8vIEFkZC9yZW1vdmUgdGhlIG5vZGVzIHRoYXQgcmVwcmVzZW50IHRoZSBwb2ludCBjb250cm9sbGVycyB0aGF0IGFyZSBhdHRhY2hlZCB0byB0aGUgbnVtYmVyIGxpbmUuXHJcbiAgICBzY2VuZU1vZGVsLm51bWJlckxpbmVBdHRhY2hlZFBvaW50Q29udHJvbGxlcnMuYWRkSXRlbUFkZGVkTGlzdGVuZXIoIGFkZGVkUG9pbnRDb250cm9sbGVyID0+IHtcclxuICAgICAgY29uc3QgcG9pbnRDb250cm9sbGVyTm9kZSA9IG5ldyBQb2ludENvbnRyb2xsZXJOb2RlKCBhZGRlZFBvaW50Q29udHJvbGxlciApO1xyXG4gICAgICBhdHRhY2hlZFBvaW50Q29udHJvbGxlcnNMYXllci5hZGRDaGlsZCggcG9pbnRDb250cm9sbGVyTm9kZSApO1xyXG4gICAgICBjb25zdCBoYW5kbGVQb2ludENvbnRyb2xsZXJSZW1vdmVkID0gcmVtb3ZlZFBvaW50Q29udHJvbGxlciA9PiB7XHJcbiAgICAgICAgaWYgKCBhZGRlZFBvaW50Q29udHJvbGxlciA9PT0gcmVtb3ZlZFBvaW50Q29udHJvbGxlciApIHtcclxuICAgICAgICAgIGF0dGFjaGVkUG9pbnRDb250cm9sbGVyc0xheWVyLnJlbW92ZUNoaWxkKCBwb2ludENvbnRyb2xsZXJOb2RlICk7XHJcbiAgICAgICAgICBwb2ludENvbnRyb2xsZXJOb2RlLmRpc3Bvc2UoKTtcclxuICAgICAgICAgIHNjZW5lTW9kZWwubnVtYmVyTGluZUF0dGFjaGVkUG9pbnRDb250cm9sbGVycy5yZW1vdmVJdGVtUmVtb3ZlZExpc3RlbmVyKCBoYW5kbGVQb2ludENvbnRyb2xsZXJSZW1vdmVkICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBzY2VuZU1vZGVsLm51bWJlckxpbmVBdHRhY2hlZFBvaW50Q29udHJvbGxlcnMuYWRkSXRlbVJlbW92ZWRMaXN0ZW5lciggaGFuZGxlUG9pbnRDb250cm9sbGVyUmVtb3ZlZCApO1xyXG4gICAgfSApO1xyXG4gIH1cclxufVxyXG5cclxubnVtYmVyTGluZUludGVnZXJzLnJlZ2lzdGVyKCAnRWxldmF0aW9uU2NlbmVWaWV3JywgRWxldmF0aW9uU2NlbmVWaWV3ICk7XHJcbmV4cG9ydCBkZWZhdWx0IEVsZXZhdGlvblNjZW5lVmlldztcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsYUFBYSxNQUFNLHdEQUF3RDtBQUNsRixPQUFPQyxlQUFlLE1BQU0sMERBQTBEO0FBQ3RGLE9BQU9DLGFBQWEsTUFBTSx3REFBd0Q7QUFDbEYsT0FBT0MsZUFBZSxNQUFNLDBEQUEwRDtBQUN0RixPQUFPQyxtQkFBbUIsTUFBTSxzRUFBc0U7QUFDdEcsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxTQUFTQyxLQUFLLEVBQUVDLElBQUksRUFBRUMsU0FBUyxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ2hGLE9BQU9DLHVCQUF1QixNQUFNLDRDQUE0QztBQUNoRixPQUFPQyxjQUFjLE1BQU0sbUNBQW1DO0FBQzlELE9BQU9DLGFBQWEsTUFBTSxrQ0FBa0M7QUFDNUQsT0FBT0MsZUFBZSxNQUFNLG9DQUFvQztBQUNoRSxPQUFPQyxrQkFBa0IsTUFBTSw2QkFBNkI7QUFDNUQsT0FBT0MseUJBQXlCLE1BQU0sb0NBQW9DO0FBQzFFLE9BQU9DLDRCQUE0QixNQUFNLG1DQUFtQztBQUM1RSxPQUFPQyxTQUFTLE1BQU0sZ0JBQWdC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