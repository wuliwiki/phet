// Copyright 2019-2022, University of Colorado Boulder

/**
 * view for the "Bank" scene
 *
 * @author John Blanco (PhET Interactive Simulations)
 * @author Saurabh Totey
 */

import Dimension2 from '../../../../dot/js/Dimension2.js';
import PiggyBankDecoration from '../../../../number-line-common/js/explore/model/PiggyBankDecoration.js';
import PiggyBankNode from '../../../../number-line-common/js/explore/view/PiggyBankNode.js';
import merge from '../../../../phet-core/js/merge.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { HBox, Node, Text } from '../../../../scenery/js/imports.js';
import ABSwitch from '../../../../sun/js/ABSwitch.js';
import numberLineIntegers from '../../numberLineIntegers.js';
import NumberLineIntegersStrings from '../../NumberLineIntegersStrings.js';
import BankSceneModel from '../model/BankSceneModel.js';
import AccountBalanceControllerNode from './AccountBalanceControllerNode.js';
import BankPointControllerNode from './BankPointControllerNode.js';
import SceneView from './SceneView.js';

// constants
const NUMBER_LINE_LABEL_FONT = new PhetFont({
  size: 18,
  weight: 'bold'
});
const BALANCE_CHANGE_AMOUNT = 1; // in dollars (or whatever currency units are being used)

const balanceString = NumberLineIntegersStrings.balance;
const currencyUnitsString = NumberLineIntegersStrings.currencyUnits;
const moneyAmountString = NumberLineIntegersStrings.moneyAmount;

// constants
const INSET = 10;
class BankSceneView extends SceneView {
  /**
   * @param {BankSceneModel} bankSceneModel
   * @param {Bounds2} layoutBounds
   * @public
   */
  constructor(bankSceneModel, layoutBounds) {
    super(bankSceneModel, layoutBounds, {
      commonNumberLineNodeOptions: {
        numericalLabelTemplate: StringUtils.fillIn(moneyAmountString, {
          currencyUnit: currencyUnitsString
        })
      }
    });

    // Get references to the only number line and number line node in this scene.
    const numberLine = bankSceneModel.numberLines[0];
    const numberLineNode = this.numberLineNodes[0];

    // number line label
    const numberLineLabel = new Text(balanceString, {
      font: NUMBER_LINE_LABEL_FONT,
      right: numberLineNode.left - 4,
      centerY: numberLine.centerPositionProperty.value.y,
      maxWidth: layoutBounds.width * 0.08
    });
    this.scenesLayer.addChild(numberLineLabel);
    bankSceneModel.showNumberLineProperty.linkAttribute(numberLineLabel, 'visible');

    // Add the switch that controls whether one or two accounts are shown.
    this.scenesLayer.addChild(new AccountVisibilityControlSwitch(bankSceneModel.showComparisonAccountProperty, {
      right: this.layoutBounds.maxX - INSET,
      centerY: numberLineNode.centerY
    }));

    // Add the point controllers.  This is being done a bit differently here in the "Bank" scene than in the other
    // scenes in that the controllers are being added to the number line layer.  This is because we want them behind
    // the number line in the z-order, whereas in the other scenes the controllers are above the number lines.  See
    // https://github.com/phetsims/number-line-integers/issues/88 and
    // https://github.com/phetsims/number-line-integers/issues/83.
    const pointControllerNodesLayer = new Node();
    this.numberLinesLayer.addChild(pointControllerNodesLayer);
    pointControllerNodesLayer.moveToBack();

    // Add node to represent the primary account point controller, which is always visible.
    const primaryAccountPointControllerNode = new BankPointControllerNode(bankSceneModel.primaryAccountPointController, bankSceneModel.primaryAccount.balanceChangedByButtonEmitter, PiggyBankDecoration.FLOWERS, {
      connectorLineVisibleProperty: bankSceneModel.showNumberLineProperty
    });
    pointControllerNodesLayer.addChild(primaryAccountPointControllerNode);

    // add node to represent the comparison account point controller, which is only visible when enabled
    const comparisonAccountPointControllerNode = new BankPointControllerNode(bankSceneModel.comparisonAccountPointController, bankSceneModel.comparisonAccount.balanceChangedByButtonEmitter, PiggyBankDecoration.LIGHTNING, {
      connectorLineVisibleProperty: bankSceneModel.showNumberLineProperty
    });
    pointControllerNodesLayer.addChild(comparisonAccountPointControllerNode);
    comparisonAccountPointControllerNode.moveToBack(); // make sure this is behind the number line point that it controls

    numberLine.residentPoints.lengthProperty.link(numPoints => {
      // Show the second controller if the second point is present.
      comparisonAccountPointControllerNode.visible = numPoints > 1;
    });

    // Calculate a horizontal position for the account balance controls that is centered between some other controls.
    const accountBalanceControllersCenterX = (this.comparisonStatementAccordionBoxes[0].right + this.checkboxGroup.bounds.minX) / 2;

    // Add the controller for the primary account.
    const primaryAccountBalanceControllerNode = new AccountBalanceControllerNode(bankSceneModel.primaryAccount.balanceProperty, bankSceneModel.primaryAccount.balanceChangedByButtonEmitter, numberLine.displayedRangeProperty.value, BALANCE_CHANGE_AMOUNT, {
      buttonBaseColor: BankSceneModel.PRIMARY_ACCOUNT_POINT_COLOR,
      centerX: accountBalanceControllersCenterX,
      top: numberLineNode.centerY + 70
    });
    this.scenesLayer.addChild(primaryAccountBalanceControllerNode);

    // Add the controller for the comparison account, and show it only when that account is enabled.
    const comparisonAccountBalanceControllerNode = new AccountBalanceControllerNode(bankSceneModel.comparisonAccount.balanceProperty, bankSceneModel.comparisonAccount.balanceChangedByButtonEmitter, numberLine.displayedRangeProperty.value, BALANCE_CHANGE_AMOUNT, {
      buttonBaseColor: BankSceneModel.COMPARISON_ACCOUNT_POINT_COLOR,
      centerX: accountBalanceControllersCenterX,
      bottom: numberLineNode.centerY - 70
    });
    bankSceneModel.showComparisonAccountProperty.linkAttribute(comparisonAccountBalanceControllerNode, 'visible');
    this.scenesLayer.addChild(comparisonAccountBalanceControllerNode);

    // Monitor the account controllers for when their buttons are released by the user and make sure that the values
    // of the two accounts are not the same and, if they are, correct the situation.
    primaryAccountBalanceControllerNode.buttonReleasedEmitter.addListener(() => {
      if (bankSceneModel.showComparisonAccountProperty.value && bankSceneModel.comparisonAccount.balanceProperty.value === bankSceneModel.primaryAccount.balanceProperty.value) {
        // Set the comparison account to the previous value of the primary account, in effect swapping values.
        bankSceneModel.comparisonAccount.balanceProperty.value = bankSceneModel.primaryAccount.previousBalance;
      }
    });
    comparisonAccountBalanceControllerNode.buttonReleasedEmitter.addListener(() => {
      if (bankSceneModel.comparisonAccount.balanceProperty.value === bankSceneModel.primaryAccount.balanceProperty.value) {
        // Set the primary account to the previous value of the comparison account, in effect swapping values.
        bankSceneModel.primaryAccount.balanceProperty.value = bankSceneModel.comparisonAccount.previousBalance;
      }
    });
  }
}

/**
 * a switch for controlling whether one or two account balances are shown
 * @private
 */
class AccountVisibilityControlSwitch extends ABSwitch {
  /**
   * @param {BooleanProperty} comparisonAccountVisible
   * @param {Object} [options]
   * @public
   */
  constructor(comparisonAccountVisible, options) {
    options = merge({
      toggleSwitchOptions: {
        size: new Dimension2(50, 15)
      },
      setEnabled: () => {} // turn off default behavior where opacity is used for non-selected nodes
    }, options);

    // The node for selecting that the comparison account is hidden is a single piggy bank that matches the style of
    // the visible account controller.
    const comparisonAccountHiddenNode = new PiggyBankNode({
      decorationType: PiggyBankDecoration.FLOWERS,
      maxWidth: 40
    });

    // The node for the selection where the comparison account is visible it two smaller piggy banks side by side.
    const comparisonAccountVisibleLeftPiggyBankNode = new PiggyBankNode({
      decorationType: PiggyBankDecoration.FLOWERS,
      maxWidth: 30
    });
    const comparisonAccountVisibleRightPiggyBankNode = new PiggyBankNode({
      decorationType: PiggyBankDecoration.LIGHTNING,
      maxWidth: 40
    });
    const comparisonAccountVisibleNode = new HBox({
      children: [comparisonAccountVisibleLeftPiggyBankNode, comparisonAccountVisibleRightPiggyBankNode],
      spacing: 10
    });
    const inactiveColor = 'rgb( 210, 210, 210 )';
    const activeColor = 'rgb( 0, 180, 147 )';
    comparisonAccountVisible.link(isComparisonAccountVisible => {
      const singleFill = isComparisonAccountVisible ? inactiveColor : activeColor;
      const doubleFill = isComparisonAccountVisible ? activeColor : inactiveColor;
      comparisonAccountHiddenNode.fill = singleFill;
      comparisonAccountVisibleLeftPiggyBankNode.fill = doubleFill;
      comparisonAccountVisibleRightPiggyBankNode.fill = doubleFill;
    });
    super(comparisonAccountVisible, false, comparisonAccountHiddenNode, true, comparisonAccountVisibleNode, options);
  }
}
numberLineIntegers.register('BankSceneView', BankSceneView);
export default BankSceneView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEaW1lbnNpb24yIiwiUGlnZ3lCYW5rRGVjb3JhdGlvbiIsIlBpZ2d5QmFua05vZGUiLCJtZXJnZSIsIlN0cmluZ1V0aWxzIiwiUGhldEZvbnQiLCJIQm94IiwiTm9kZSIsIlRleHQiLCJBQlN3aXRjaCIsIm51bWJlckxpbmVJbnRlZ2VycyIsIk51bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3MiLCJCYW5rU2NlbmVNb2RlbCIsIkFjY291bnRCYWxhbmNlQ29udHJvbGxlck5vZGUiLCJCYW5rUG9pbnRDb250cm9sbGVyTm9kZSIsIlNjZW5lVmlldyIsIk5VTUJFUl9MSU5FX0xBQkVMX0ZPTlQiLCJzaXplIiwid2VpZ2h0IiwiQkFMQU5DRV9DSEFOR0VfQU1PVU5UIiwiYmFsYW5jZVN0cmluZyIsImJhbGFuY2UiLCJjdXJyZW5jeVVuaXRzU3RyaW5nIiwiY3VycmVuY3lVbml0cyIsIm1vbmV5QW1vdW50U3RyaW5nIiwibW9uZXlBbW91bnQiLCJJTlNFVCIsIkJhbmtTY2VuZVZpZXciLCJjb25zdHJ1Y3RvciIsImJhbmtTY2VuZU1vZGVsIiwibGF5b3V0Qm91bmRzIiwiY29tbW9uTnVtYmVyTGluZU5vZGVPcHRpb25zIiwibnVtZXJpY2FsTGFiZWxUZW1wbGF0ZSIsImZpbGxJbiIsImN1cnJlbmN5VW5pdCIsIm51bWJlckxpbmUiLCJudW1iZXJMaW5lcyIsIm51bWJlckxpbmVOb2RlIiwibnVtYmVyTGluZU5vZGVzIiwibnVtYmVyTGluZUxhYmVsIiwiZm9udCIsInJpZ2h0IiwibGVmdCIsImNlbnRlclkiLCJjZW50ZXJQb3NpdGlvblByb3BlcnR5IiwidmFsdWUiLCJ5IiwibWF4V2lkdGgiLCJ3aWR0aCIsInNjZW5lc0xheWVyIiwiYWRkQ2hpbGQiLCJzaG93TnVtYmVyTGluZVByb3BlcnR5IiwibGlua0F0dHJpYnV0ZSIsIkFjY291bnRWaXNpYmlsaXR5Q29udHJvbFN3aXRjaCIsInNob3dDb21wYXJpc29uQWNjb3VudFByb3BlcnR5IiwibWF4WCIsInBvaW50Q29udHJvbGxlck5vZGVzTGF5ZXIiLCJudW1iZXJMaW5lc0xheWVyIiwibW92ZVRvQmFjayIsInByaW1hcnlBY2NvdW50UG9pbnRDb250cm9sbGVyTm9kZSIsInByaW1hcnlBY2NvdW50UG9pbnRDb250cm9sbGVyIiwicHJpbWFyeUFjY291bnQiLCJiYWxhbmNlQ2hhbmdlZEJ5QnV0dG9uRW1pdHRlciIsIkZMT1dFUlMiLCJjb25uZWN0b3JMaW5lVmlzaWJsZVByb3BlcnR5IiwiY29tcGFyaXNvbkFjY291bnRQb2ludENvbnRyb2xsZXJOb2RlIiwiY29tcGFyaXNvbkFjY291bnRQb2ludENvbnRyb2xsZXIiLCJjb21wYXJpc29uQWNjb3VudCIsIkxJR0hUTklORyIsInJlc2lkZW50UG9pbnRzIiwibGVuZ3RoUHJvcGVydHkiLCJsaW5rIiwibnVtUG9pbnRzIiwidmlzaWJsZSIsImFjY291bnRCYWxhbmNlQ29udHJvbGxlcnNDZW50ZXJYIiwiY29tcGFyaXNvblN0YXRlbWVudEFjY29yZGlvbkJveGVzIiwiY2hlY2tib3hHcm91cCIsImJvdW5kcyIsIm1pblgiLCJwcmltYXJ5QWNjb3VudEJhbGFuY2VDb250cm9sbGVyTm9kZSIsImJhbGFuY2VQcm9wZXJ0eSIsImRpc3BsYXllZFJhbmdlUHJvcGVydHkiLCJidXR0b25CYXNlQ29sb3IiLCJQUklNQVJZX0FDQ09VTlRfUE9JTlRfQ09MT1IiLCJjZW50ZXJYIiwidG9wIiwiY29tcGFyaXNvbkFjY291bnRCYWxhbmNlQ29udHJvbGxlck5vZGUiLCJDT01QQVJJU09OX0FDQ09VTlRfUE9JTlRfQ09MT1IiLCJib3R0b20iLCJidXR0b25SZWxlYXNlZEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsInByZXZpb3VzQmFsYW5jZSIsImNvbXBhcmlzb25BY2NvdW50VmlzaWJsZSIsIm9wdGlvbnMiLCJ0b2dnbGVTd2l0Y2hPcHRpb25zIiwic2V0RW5hYmxlZCIsImNvbXBhcmlzb25BY2NvdW50SGlkZGVuTm9kZSIsImRlY29yYXRpb25UeXBlIiwiY29tcGFyaXNvbkFjY291bnRWaXNpYmxlTGVmdFBpZ2d5QmFua05vZGUiLCJjb21wYXJpc29uQWNjb3VudFZpc2libGVSaWdodFBpZ2d5QmFua05vZGUiLCJjb21wYXJpc29uQWNjb3VudFZpc2libGVOb2RlIiwiY2hpbGRyZW4iLCJzcGFjaW5nIiwiaW5hY3RpdmVDb2xvciIsImFjdGl2ZUNvbG9yIiwiaXNDb21wYXJpc29uQWNjb3VudFZpc2libGUiLCJzaW5nbGVGaWxsIiwiZG91YmxlRmlsbCIsImZpbGwiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkJhbmtTY2VuZVZpZXcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogdmlldyBmb3IgdGhlIFwiQmFua1wiIHNjZW5lXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgU2F1cmFiaCBUb3RleVxyXG4gKi9cclxuXHJcbmltcG9ydCBEaW1lbnNpb24yIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9EaW1lbnNpb24yLmpzJztcclxuaW1wb3J0IFBpZ2d5QmFua0RlY29yYXRpb24gZnJvbSAnLi4vLi4vLi4vLi4vbnVtYmVyLWxpbmUtY29tbW9uL2pzL2V4cGxvcmUvbW9kZWwvUGlnZ3lCYW5rRGVjb3JhdGlvbi5qcyc7XHJcbmltcG9ydCBQaWdneUJhbmtOb2RlIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9qcy9leHBsb3JlL3ZpZXcvUGlnZ3lCYW5rTm9kZS5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IEhCb3gsIE5vZGUsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgQUJTd2l0Y2ggZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL0FCU3dpdGNoLmpzJztcclxuaW1wb3J0IG51bWJlckxpbmVJbnRlZ2VycyBmcm9tICcuLi8uLi9udW1iZXJMaW5lSW50ZWdlcnMuanMnO1xyXG5pbXBvcnQgTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncyBmcm9tICcuLi8uLi9OdW1iZXJMaW5lSW50ZWdlcnNTdHJpbmdzLmpzJztcclxuaW1wb3J0IEJhbmtTY2VuZU1vZGVsIGZyb20gJy4uL21vZGVsL0JhbmtTY2VuZU1vZGVsLmpzJztcclxuaW1wb3J0IEFjY291bnRCYWxhbmNlQ29udHJvbGxlck5vZGUgZnJvbSAnLi9BY2NvdW50QmFsYW5jZUNvbnRyb2xsZXJOb2RlLmpzJztcclxuaW1wb3J0IEJhbmtQb2ludENvbnRyb2xsZXJOb2RlIGZyb20gJy4vQmFua1BvaW50Q29udHJvbGxlck5vZGUuanMnO1xyXG5pbXBvcnQgU2NlbmVWaWV3IGZyb20gJy4vU2NlbmVWaWV3LmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBOVU1CRVJfTElORV9MQUJFTF9GT05UID0gbmV3IFBoZXRGb250KCB7IHNpemU6IDE4LCB3ZWlnaHQ6ICdib2xkJyB9ICk7XHJcbmNvbnN0IEJBTEFOQ0VfQ0hBTkdFX0FNT1VOVCA9IDE7IC8vIGluIGRvbGxhcnMgKG9yIHdoYXRldmVyIGN1cnJlbmN5IHVuaXRzIGFyZSBiZWluZyB1c2VkKVxyXG5cclxuY29uc3QgYmFsYW5jZVN0cmluZyA9IE51bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3MuYmFsYW5jZTtcclxuY29uc3QgY3VycmVuY3lVbml0c1N0cmluZyA9IE51bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3MuY3VycmVuY3lVbml0cztcclxuY29uc3QgbW9uZXlBbW91bnRTdHJpbmcgPSBOdW1iZXJMaW5lSW50ZWdlcnNTdHJpbmdzLm1vbmV5QW1vdW50O1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IElOU0VUID0gMTA7XHJcblxyXG5jbGFzcyBCYW5rU2NlbmVWaWV3IGV4dGVuZHMgU2NlbmVWaWV3IHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtCYW5rU2NlbmVNb2RlbH0gYmFua1NjZW5lTW9kZWxcclxuICAgKiBAcGFyYW0ge0JvdW5kczJ9IGxheW91dEJvdW5kc1xyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggYmFua1NjZW5lTW9kZWwsIGxheW91dEJvdW5kcyApIHtcclxuXHJcbiAgICBzdXBlciggYmFua1NjZW5lTW9kZWwsIGxheW91dEJvdW5kcywge1xyXG4gICAgICBjb21tb25OdW1iZXJMaW5lTm9kZU9wdGlvbnM6IHtcclxuICAgICAgICBudW1lcmljYWxMYWJlbFRlbXBsYXRlOiBTdHJpbmdVdGlscy5maWxsSW4oIG1vbmV5QW1vdW50U3RyaW5nLCB7IGN1cnJlbmN5VW5pdDogY3VycmVuY3lVbml0c1N0cmluZyB9IClcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEdldCByZWZlcmVuY2VzIHRvIHRoZSBvbmx5IG51bWJlciBsaW5lIGFuZCBudW1iZXIgbGluZSBub2RlIGluIHRoaXMgc2NlbmUuXHJcbiAgICBjb25zdCBudW1iZXJMaW5lID0gYmFua1NjZW5lTW9kZWwubnVtYmVyTGluZXNbIDAgXTtcclxuICAgIGNvbnN0IG51bWJlckxpbmVOb2RlID0gdGhpcy5udW1iZXJMaW5lTm9kZXNbIDAgXTtcclxuXHJcbiAgICAvLyBudW1iZXIgbGluZSBsYWJlbFxyXG4gICAgY29uc3QgbnVtYmVyTGluZUxhYmVsID0gbmV3IFRleHQoIGJhbGFuY2VTdHJpbmcsIHtcclxuICAgICAgZm9udDogTlVNQkVSX0xJTkVfTEFCRUxfRk9OVCxcclxuICAgICAgcmlnaHQ6IG51bWJlckxpbmVOb2RlLmxlZnQgLSA0LFxyXG4gICAgICBjZW50ZXJZOiBudW1iZXJMaW5lLmNlbnRlclBvc2l0aW9uUHJvcGVydHkudmFsdWUueSxcclxuICAgICAgbWF4V2lkdGg6IGxheW91dEJvdW5kcy53aWR0aCAqIDAuMDhcclxuICAgIH0gKTtcclxuICAgIHRoaXMuc2NlbmVzTGF5ZXIuYWRkQ2hpbGQoIG51bWJlckxpbmVMYWJlbCApO1xyXG4gICAgYmFua1NjZW5lTW9kZWwuc2hvd051bWJlckxpbmVQcm9wZXJ0eS5saW5rQXR0cmlidXRlKCBudW1iZXJMaW5lTGFiZWwsICd2aXNpYmxlJyApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgc3dpdGNoIHRoYXQgY29udHJvbHMgd2hldGhlciBvbmUgb3IgdHdvIGFjY291bnRzIGFyZSBzaG93bi5cclxuICAgIHRoaXMuc2NlbmVzTGF5ZXIuYWRkQ2hpbGQoIG5ldyBBY2NvdW50VmlzaWJpbGl0eUNvbnRyb2xTd2l0Y2goIGJhbmtTY2VuZU1vZGVsLnNob3dDb21wYXJpc29uQWNjb3VudFByb3BlcnR5LCB7XHJcbiAgICAgIHJpZ2h0OiB0aGlzLmxheW91dEJvdW5kcy5tYXhYIC0gSU5TRVQsXHJcbiAgICAgIGNlbnRlclk6IG51bWJlckxpbmVOb2RlLmNlbnRlcllcclxuICAgIH0gKSApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgcG9pbnQgY29udHJvbGxlcnMuICBUaGlzIGlzIGJlaW5nIGRvbmUgYSBiaXQgZGlmZmVyZW50bHkgaGVyZSBpbiB0aGUgXCJCYW5rXCIgc2NlbmUgdGhhbiBpbiB0aGUgb3RoZXJcclxuICAgIC8vIHNjZW5lcyBpbiB0aGF0IHRoZSBjb250cm9sbGVycyBhcmUgYmVpbmcgYWRkZWQgdG8gdGhlIG51bWJlciBsaW5lIGxheWVyLiAgVGhpcyBpcyBiZWNhdXNlIHdlIHdhbnQgdGhlbSBiZWhpbmRcclxuICAgIC8vIHRoZSBudW1iZXIgbGluZSBpbiB0aGUgei1vcmRlciwgd2hlcmVhcyBpbiB0aGUgb3RoZXIgc2NlbmVzIHRoZSBjb250cm9sbGVycyBhcmUgYWJvdmUgdGhlIG51bWJlciBsaW5lcy4gIFNlZVxyXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL251bWJlci1saW5lLWludGVnZXJzL2lzc3Vlcy84OCBhbmRcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9udW1iZXItbGluZS1pbnRlZ2Vycy9pc3N1ZXMvODMuXHJcbiAgICBjb25zdCBwb2ludENvbnRyb2xsZXJOb2Rlc0xheWVyID0gbmV3IE5vZGUoKTtcclxuICAgIHRoaXMubnVtYmVyTGluZXNMYXllci5hZGRDaGlsZCggcG9pbnRDb250cm9sbGVyTm9kZXNMYXllciApO1xyXG4gICAgcG9pbnRDb250cm9sbGVyTm9kZXNMYXllci5tb3ZlVG9CYWNrKCk7XHJcblxyXG4gICAgLy8gQWRkIG5vZGUgdG8gcmVwcmVzZW50IHRoZSBwcmltYXJ5IGFjY291bnQgcG9pbnQgY29udHJvbGxlciwgd2hpY2ggaXMgYWx3YXlzIHZpc2libGUuXHJcbiAgICBjb25zdCBwcmltYXJ5QWNjb3VudFBvaW50Q29udHJvbGxlck5vZGUgPSBuZXcgQmFua1BvaW50Q29udHJvbGxlck5vZGUoXHJcbiAgICAgIGJhbmtTY2VuZU1vZGVsLnByaW1hcnlBY2NvdW50UG9pbnRDb250cm9sbGVyLFxyXG4gICAgICBiYW5rU2NlbmVNb2RlbC5wcmltYXJ5QWNjb3VudC5iYWxhbmNlQ2hhbmdlZEJ5QnV0dG9uRW1pdHRlcixcclxuICAgICAgUGlnZ3lCYW5rRGVjb3JhdGlvbi5GTE9XRVJTLFxyXG4gICAgICB7IGNvbm5lY3RvckxpbmVWaXNpYmxlUHJvcGVydHk6IGJhbmtTY2VuZU1vZGVsLnNob3dOdW1iZXJMaW5lUHJvcGVydHkgfVxyXG4gICAgKTtcclxuICAgIHBvaW50Q29udHJvbGxlck5vZGVzTGF5ZXIuYWRkQ2hpbGQoIHByaW1hcnlBY2NvdW50UG9pbnRDb250cm9sbGVyTm9kZSApO1xyXG5cclxuICAgIC8vIGFkZCBub2RlIHRvIHJlcHJlc2VudCB0aGUgY29tcGFyaXNvbiBhY2NvdW50IHBvaW50IGNvbnRyb2xsZXIsIHdoaWNoIGlzIG9ubHkgdmlzaWJsZSB3aGVuIGVuYWJsZWRcclxuICAgIGNvbnN0IGNvbXBhcmlzb25BY2NvdW50UG9pbnRDb250cm9sbGVyTm9kZSA9IG5ldyBCYW5rUG9pbnRDb250cm9sbGVyTm9kZShcclxuICAgICAgYmFua1NjZW5lTW9kZWwuY29tcGFyaXNvbkFjY291bnRQb2ludENvbnRyb2xsZXIsXHJcbiAgICAgIGJhbmtTY2VuZU1vZGVsLmNvbXBhcmlzb25BY2NvdW50LmJhbGFuY2VDaGFuZ2VkQnlCdXR0b25FbWl0dGVyLFxyXG4gICAgICBQaWdneUJhbmtEZWNvcmF0aW9uLkxJR0hUTklORyxcclxuICAgICAgeyBjb25uZWN0b3JMaW5lVmlzaWJsZVByb3BlcnR5OiBiYW5rU2NlbmVNb2RlbC5zaG93TnVtYmVyTGluZVByb3BlcnR5IH1cclxuICAgICk7XHJcbiAgICBwb2ludENvbnRyb2xsZXJOb2Rlc0xheWVyLmFkZENoaWxkKCBjb21wYXJpc29uQWNjb3VudFBvaW50Q29udHJvbGxlck5vZGUgKTtcclxuICAgIGNvbXBhcmlzb25BY2NvdW50UG9pbnRDb250cm9sbGVyTm9kZS5tb3ZlVG9CYWNrKCk7IC8vIG1ha2Ugc3VyZSB0aGlzIGlzIGJlaGluZCB0aGUgbnVtYmVyIGxpbmUgcG9pbnQgdGhhdCBpdCBjb250cm9sc1xyXG5cclxuICAgIG51bWJlckxpbmUucmVzaWRlbnRQb2ludHMubGVuZ3RoUHJvcGVydHkubGluayggbnVtUG9pbnRzID0+IHtcclxuXHJcbiAgICAgIC8vIFNob3cgdGhlIHNlY29uZCBjb250cm9sbGVyIGlmIHRoZSBzZWNvbmQgcG9pbnQgaXMgcHJlc2VudC5cclxuICAgICAgY29tcGFyaXNvbkFjY291bnRQb2ludENvbnRyb2xsZXJOb2RlLnZpc2libGUgPSBudW1Qb2ludHMgPiAxO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIENhbGN1bGF0ZSBhIGhvcml6b250YWwgcG9zaXRpb24gZm9yIHRoZSBhY2NvdW50IGJhbGFuY2UgY29udHJvbHMgdGhhdCBpcyBjZW50ZXJlZCBiZXR3ZWVuIHNvbWUgb3RoZXIgY29udHJvbHMuXHJcbiAgICBjb25zdCBhY2NvdW50QmFsYW5jZUNvbnRyb2xsZXJzQ2VudGVyWCA9ICggdGhpcy5jb21wYXJpc29uU3RhdGVtZW50QWNjb3JkaW9uQm94ZXNbIDAgXS5yaWdodCArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja2JveEdyb3VwLmJvdW5kcy5taW5YICkgLyAyO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgY29udHJvbGxlciBmb3IgdGhlIHByaW1hcnkgYWNjb3VudC5cclxuICAgIGNvbnN0IHByaW1hcnlBY2NvdW50QmFsYW5jZUNvbnRyb2xsZXJOb2RlID0gbmV3IEFjY291bnRCYWxhbmNlQ29udHJvbGxlck5vZGUoXHJcbiAgICAgIGJhbmtTY2VuZU1vZGVsLnByaW1hcnlBY2NvdW50LmJhbGFuY2VQcm9wZXJ0eSxcclxuICAgICAgYmFua1NjZW5lTW9kZWwucHJpbWFyeUFjY291bnQuYmFsYW5jZUNoYW5nZWRCeUJ1dHRvbkVtaXR0ZXIsXHJcbiAgICAgIG51bWJlckxpbmUuZGlzcGxheWVkUmFuZ2VQcm9wZXJ0eS52YWx1ZSxcclxuICAgICAgQkFMQU5DRV9DSEFOR0VfQU1PVU5ULFxyXG4gICAgICB7XHJcbiAgICAgICAgYnV0dG9uQmFzZUNvbG9yOiBCYW5rU2NlbmVNb2RlbC5QUklNQVJZX0FDQ09VTlRfUE9JTlRfQ09MT1IsXHJcbiAgICAgICAgY2VudGVyWDogYWNjb3VudEJhbGFuY2VDb250cm9sbGVyc0NlbnRlclgsXHJcbiAgICAgICAgdG9wOiBudW1iZXJMaW5lTm9kZS5jZW50ZXJZICsgNzBcclxuICAgICAgfVxyXG4gICAgKTtcclxuICAgIHRoaXMuc2NlbmVzTGF5ZXIuYWRkQ2hpbGQoIHByaW1hcnlBY2NvdW50QmFsYW5jZUNvbnRyb2xsZXJOb2RlICk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBjb250cm9sbGVyIGZvciB0aGUgY29tcGFyaXNvbiBhY2NvdW50LCBhbmQgc2hvdyBpdCBvbmx5IHdoZW4gdGhhdCBhY2NvdW50IGlzIGVuYWJsZWQuXHJcbiAgICBjb25zdCBjb21wYXJpc29uQWNjb3VudEJhbGFuY2VDb250cm9sbGVyTm9kZSA9IG5ldyBBY2NvdW50QmFsYW5jZUNvbnRyb2xsZXJOb2RlKFxyXG4gICAgICBiYW5rU2NlbmVNb2RlbC5jb21wYXJpc29uQWNjb3VudC5iYWxhbmNlUHJvcGVydHksXHJcbiAgICAgIGJhbmtTY2VuZU1vZGVsLmNvbXBhcmlzb25BY2NvdW50LmJhbGFuY2VDaGFuZ2VkQnlCdXR0b25FbWl0dGVyLFxyXG4gICAgICBudW1iZXJMaW5lLmRpc3BsYXllZFJhbmdlUHJvcGVydHkudmFsdWUsXHJcbiAgICAgIEJBTEFOQ0VfQ0hBTkdFX0FNT1VOVCxcclxuICAgICAge1xyXG4gICAgICAgIGJ1dHRvbkJhc2VDb2xvcjogQmFua1NjZW5lTW9kZWwuQ09NUEFSSVNPTl9BQ0NPVU5UX1BPSU5UX0NPTE9SLFxyXG4gICAgICAgIGNlbnRlclg6IGFjY291bnRCYWxhbmNlQ29udHJvbGxlcnNDZW50ZXJYLFxyXG4gICAgICAgIGJvdHRvbTogbnVtYmVyTGluZU5vZGUuY2VudGVyWSAtIDcwXHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgICBiYW5rU2NlbmVNb2RlbC5zaG93Q29tcGFyaXNvbkFjY291bnRQcm9wZXJ0eS5saW5rQXR0cmlidXRlKCBjb21wYXJpc29uQWNjb3VudEJhbGFuY2VDb250cm9sbGVyTm9kZSwgJ3Zpc2libGUnICk7XHJcbiAgICB0aGlzLnNjZW5lc0xheWVyLmFkZENoaWxkKCBjb21wYXJpc29uQWNjb3VudEJhbGFuY2VDb250cm9sbGVyTm9kZSApO1xyXG5cclxuICAgIC8vIE1vbml0b3IgdGhlIGFjY291bnQgY29udHJvbGxlcnMgZm9yIHdoZW4gdGhlaXIgYnV0dG9ucyBhcmUgcmVsZWFzZWQgYnkgdGhlIHVzZXIgYW5kIG1ha2Ugc3VyZSB0aGF0IHRoZSB2YWx1ZXNcclxuICAgIC8vIG9mIHRoZSB0d28gYWNjb3VudHMgYXJlIG5vdCB0aGUgc2FtZSBhbmQsIGlmIHRoZXkgYXJlLCBjb3JyZWN0IHRoZSBzaXR1YXRpb24uXHJcbiAgICBwcmltYXJ5QWNjb3VudEJhbGFuY2VDb250cm9sbGVyTm9kZS5idXR0b25SZWxlYXNlZEVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgICAgaWYgKCBiYW5rU2NlbmVNb2RlbC5zaG93Q29tcGFyaXNvbkFjY291bnRQcm9wZXJ0eS52YWx1ZSAmJlxyXG4gICAgICAgICAgIGJhbmtTY2VuZU1vZGVsLmNvbXBhcmlzb25BY2NvdW50LmJhbGFuY2VQcm9wZXJ0eS52YWx1ZSA9PT0gYmFua1NjZW5lTW9kZWwucHJpbWFyeUFjY291bnQuYmFsYW5jZVByb3BlcnR5LnZhbHVlICkge1xyXG5cclxuICAgICAgICAvLyBTZXQgdGhlIGNvbXBhcmlzb24gYWNjb3VudCB0byB0aGUgcHJldmlvdXMgdmFsdWUgb2YgdGhlIHByaW1hcnkgYWNjb3VudCwgaW4gZWZmZWN0IHN3YXBwaW5nIHZhbHVlcy5cclxuICAgICAgICBiYW5rU2NlbmVNb2RlbC5jb21wYXJpc29uQWNjb3VudC5iYWxhbmNlUHJvcGVydHkudmFsdWUgPSBiYW5rU2NlbmVNb2RlbC5wcmltYXJ5QWNjb3VudC5wcmV2aW91c0JhbGFuY2U7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIGNvbXBhcmlzb25BY2NvdW50QmFsYW5jZUNvbnRyb2xsZXJOb2RlLmJ1dHRvblJlbGVhc2VkRW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICBpZiAoIGJhbmtTY2VuZU1vZGVsLmNvbXBhcmlzb25BY2NvdW50LmJhbGFuY2VQcm9wZXJ0eS52YWx1ZSA9PT0gYmFua1NjZW5lTW9kZWwucHJpbWFyeUFjY291bnQuYmFsYW5jZVByb3BlcnR5LnZhbHVlICkge1xyXG5cclxuICAgICAgICAvLyBTZXQgdGhlIHByaW1hcnkgYWNjb3VudCB0byB0aGUgcHJldmlvdXMgdmFsdWUgb2YgdGhlIGNvbXBhcmlzb24gYWNjb3VudCwgaW4gZWZmZWN0IHN3YXBwaW5nIHZhbHVlcy5cclxuICAgICAgICBiYW5rU2NlbmVNb2RlbC5wcmltYXJ5QWNjb3VudC5iYWxhbmNlUHJvcGVydHkudmFsdWUgPSBiYW5rU2NlbmVNb2RlbC5jb21wYXJpc29uQWNjb3VudC5wcmV2aW91c0JhbGFuY2U7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBhIHN3aXRjaCBmb3IgY29udHJvbGxpbmcgd2hldGhlciBvbmUgb3IgdHdvIGFjY291bnQgYmFsYW5jZXMgYXJlIHNob3duXHJcbiAqIEBwcml2YXRlXHJcbiAqL1xyXG5jbGFzcyBBY2NvdW50VmlzaWJpbGl0eUNvbnRyb2xTd2l0Y2ggZXh0ZW5kcyBBQlN3aXRjaCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7Qm9vbGVhblByb3BlcnR5fSBjb21wYXJpc29uQWNjb3VudFZpc2libGVcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBjb21wYXJpc29uQWNjb3VudFZpc2libGUsIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XHJcbiAgICAgIHRvZ2dsZVN3aXRjaE9wdGlvbnM6IHsgc2l6ZTogbmV3IERpbWVuc2lvbjIoIDUwLCAxNSApIH0sXHJcbiAgICAgIHNldEVuYWJsZWQ6ICgpID0+IHt9IC8vIHR1cm4gb2ZmIGRlZmF1bHQgYmVoYXZpb3Igd2hlcmUgb3BhY2l0eSBpcyB1c2VkIGZvciBub24tc2VsZWN0ZWQgbm9kZXNcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBUaGUgbm9kZSBmb3Igc2VsZWN0aW5nIHRoYXQgdGhlIGNvbXBhcmlzb24gYWNjb3VudCBpcyBoaWRkZW4gaXMgYSBzaW5nbGUgcGlnZ3kgYmFuayB0aGF0IG1hdGNoZXMgdGhlIHN0eWxlIG9mXHJcbiAgICAvLyB0aGUgdmlzaWJsZSBhY2NvdW50IGNvbnRyb2xsZXIuXHJcbiAgICBjb25zdCBjb21wYXJpc29uQWNjb3VudEhpZGRlbk5vZGUgPSBuZXcgUGlnZ3lCYW5rTm9kZSgge1xyXG4gICAgICBkZWNvcmF0aW9uVHlwZTogUGlnZ3lCYW5rRGVjb3JhdGlvbi5GTE9XRVJTLFxyXG4gICAgICBtYXhXaWR0aDogNDBcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBUaGUgbm9kZSBmb3IgdGhlIHNlbGVjdGlvbiB3aGVyZSB0aGUgY29tcGFyaXNvbiBhY2NvdW50IGlzIHZpc2libGUgaXQgdHdvIHNtYWxsZXIgcGlnZ3kgYmFua3Mgc2lkZSBieSBzaWRlLlxyXG4gICAgY29uc3QgY29tcGFyaXNvbkFjY291bnRWaXNpYmxlTGVmdFBpZ2d5QmFua05vZGUgPSBuZXcgUGlnZ3lCYW5rTm9kZSgge1xyXG4gICAgICBkZWNvcmF0aW9uVHlwZTogUGlnZ3lCYW5rRGVjb3JhdGlvbi5GTE9XRVJTLFxyXG4gICAgICBtYXhXaWR0aDogMzBcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IGNvbXBhcmlzb25BY2NvdW50VmlzaWJsZVJpZ2h0UGlnZ3lCYW5rTm9kZSA9IG5ldyBQaWdneUJhbmtOb2RlKCB7XHJcbiAgICAgIGRlY29yYXRpb25UeXBlOiBQaWdneUJhbmtEZWNvcmF0aW9uLkxJR0hUTklORyxcclxuICAgICAgbWF4V2lkdGg6IDQwXHJcbiAgICB9ICk7XHJcbiAgICBjb25zdCBjb21wYXJpc29uQWNjb3VudFZpc2libGVOb2RlID0gbmV3IEhCb3goIHtcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBjb21wYXJpc29uQWNjb3VudFZpc2libGVMZWZ0UGlnZ3lCYW5rTm9kZSxcclxuICAgICAgICBjb21wYXJpc29uQWNjb3VudFZpc2libGVSaWdodFBpZ2d5QmFua05vZGVcclxuICAgICAgXSxcclxuICAgICAgc3BhY2luZzogMTBcclxuICAgIH0gKTtcclxuXHJcbiAgICBjb25zdCBpbmFjdGl2ZUNvbG9yID0gJ3JnYiggMjEwLCAyMTAsIDIxMCApJztcclxuICAgIGNvbnN0IGFjdGl2ZUNvbG9yID0gJ3JnYiggMCwgMTgwLCAxNDcgKSc7XHJcblxyXG4gICAgY29tcGFyaXNvbkFjY291bnRWaXNpYmxlLmxpbmsoIGlzQ29tcGFyaXNvbkFjY291bnRWaXNpYmxlID0+IHtcclxuICAgICAgY29uc3Qgc2luZ2xlRmlsbCA9IGlzQ29tcGFyaXNvbkFjY291bnRWaXNpYmxlID8gaW5hY3RpdmVDb2xvciA6IGFjdGl2ZUNvbG9yO1xyXG4gICAgICBjb25zdCBkb3VibGVGaWxsID0gaXNDb21wYXJpc29uQWNjb3VudFZpc2libGUgPyBhY3RpdmVDb2xvciA6IGluYWN0aXZlQ29sb3I7XHJcbiAgICAgIGNvbXBhcmlzb25BY2NvdW50SGlkZGVuTm9kZS5maWxsID0gc2luZ2xlRmlsbDtcclxuICAgICAgY29tcGFyaXNvbkFjY291bnRWaXNpYmxlTGVmdFBpZ2d5QmFua05vZGUuZmlsbCA9IGRvdWJsZUZpbGw7XHJcbiAgICAgIGNvbXBhcmlzb25BY2NvdW50VmlzaWJsZVJpZ2h0UGlnZ3lCYW5rTm9kZS5maWxsID0gZG91YmxlRmlsbDtcclxuICAgIH0gKTtcclxuXHJcbiAgICBzdXBlcihcclxuICAgICAgY29tcGFyaXNvbkFjY291bnRWaXNpYmxlLFxyXG4gICAgICBmYWxzZSxcclxuICAgICAgY29tcGFyaXNvbkFjY291bnRIaWRkZW5Ob2RlLFxyXG4gICAgICB0cnVlLFxyXG4gICAgICBjb21wYXJpc29uQWNjb3VudFZpc2libGVOb2RlLFxyXG4gICAgICBvcHRpb25zXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxubnVtYmVyTGluZUludGVnZXJzLnJlZ2lzdGVyKCAnQmFua1NjZW5lVmlldycsIEJhbmtTY2VuZVZpZXcgKTtcclxuZXhwb3J0IGRl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