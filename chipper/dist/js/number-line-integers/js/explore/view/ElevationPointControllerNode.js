// Copyright 2019-2023, University of Colorado Boulder

/**
 * a Scenery node that is used to control point positions in the "Elevation" scene of the Number Line Integers sim
 *
 * @author John Blanco (PhET Interactive Simulations)
 * @author Saurabh Totey
 */

import Multilink from '../../../../axon/js/Multilink.js';
import { Shape } from '../../../../kite/js/imports.js';
import PointControllerNode from '../../../../number-line-common/js/common/view/PointControllerNode.js';
import merge from '../../../../phet-core/js/merge.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import BackgroundNode from '../../../../scenery-phet/js/BackgroundNode.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Node, Path, Text } from '../../../../scenery/js/imports.js';
import NLIConstants from '../../common/NLIConstants.js';
import numberLineIntegers from '../../numberLineIntegers.js';
import NumberLineIntegersStrings from '../../NumberLineIntegersStrings.js';

// constants
const IMAGE_DILATION = 20;
const DISTANCE_TEXT_MAX_WIDTH = 250;
const amountAboveSeaLevelString = NumberLineIntegersStrings.amountAboveSeaLevel;
const amountBelowSeaLevelString = NumberLineIntegersStrings.amountBelowSeaLevel;
const seaLevelString = NumberLineIntegersStrings.seaLevel;
class ElevationPointControllerNode extends PointControllerNode {
  /**
   * @param {ElevationPointController} pointController
   * @param {Image[]} imageList - an array of images used to depict this node
   * @param {number} seaLevel - the y value in view coordinates of the sea level
   * @param {Vector2[]} textOffsets - the offsets for the centerLeft positions of the absolute value texts relative to the image rightCenter
   * @param {Object} [options]
   * @public
   */
  constructor(pointController, imageList, seaLevel, textOffsets, options) {
    assert && assert(!options || !options.node, 'options should not include a node for this constructor');

    // dilates each image's touch area
    imageList.forEach(image => {
      image.touchArea = image.localBounds.dilated(IMAGE_DILATION);
    });

    // Create a node with all the images that will be used to depict this elevatable item.
    const compositeImageNode = new Node({
      children: imageList
    });
    options = merge({
      // Pass in the parent node that includes all images as the mode that will control the point.
      node: compositeImageNode,
      // {function} - A function that takes a position and a currently selected image index and returns the index
      // of the image that should be visible.  This enabled fairly complex appearance changes to the point controller
      // node.
      imageSelectionFunction: (position, currentlySelectedImageIndex) => {
        return currentlySelectedImageIndex;
      }
    }, options);
    let textOffset;

    // Update the visibility of the images as the position changes.
    pointController.positionProperty.link(position => {
      const currentlySelectedImageIndex = _.findIndex(imageList, image => image.visible);
      const selectedImageIndex = options.imageSelectionFunction(position, currentlySelectedImageIndex);
      imageList.forEach((image, index) => {
        image.visible = selectedImageIndex === index;
      });
      textOffset = textOffsets[selectedImageIndex];
    });
    super(pointController, options);

    // handling of what the point controller does when the absolute value checkbox is checked
    const absoluteValueLine = new Path(null, {
      stroke: pointController.color,
      lineWidth: 2
    });
    const distanceText = new Text('', {
      font: new PhetFont(18),
      fill: pointController.color,
      maxWidth: DISTANCE_TEXT_MAX_WIDTH
    });
    const distanceLabel = new BackgroundNode(distanceText, NLIConstants.LABEL_BACKGROUND_OPTIONS);
    this.addChild(absoluteValueLine);
    this.addChild(distanceLabel);
    absoluteValueLine.moveToBack();
    const numberLine = pointController.numberLines[0];

    // Update the absolute value representation and associated text. There is no need to unlink this since the
    // elevation point controllers don't come and go.
    Multilink.multilink([numberLine.showAbsoluteValuesProperty, pointController.positionProperty], showAbsoluteValues => {
      if (showAbsoluteValues && pointController.overElevationAreaProperty.value && pointController.isControllingNumberLinePoint()) {
        absoluteValueLine.shape = new Shape().moveTo(compositeImageNode.x, compositeImageNode.y).lineTo(compositeImageNode.x, seaLevel);
        const value = pointController.numberLinePoints.get(0).valueProperty.value;
        let seaLevelText = seaLevelString;
        if (value < 0) {
          seaLevelText = StringUtils.fillIn(amountBelowSeaLevelString, {
            value: Math.abs(value)
          });
        } else if (value > 0) {
          seaLevelText = StringUtils.fillIn(amountAboveSeaLevelString, {
            value: value
          });
        }
        distanceText.string = seaLevelText;
        distanceLabel.visible = true;
        distanceLabel.leftCenter = compositeImageNode.rightCenter.plus(textOffset);
      } else {
        absoluteValueLine.shape = null;
        distanceLabel.visible = false;
      }
    });
  }
}
numberLineIntegers.register('ElevationPointControllerNode', ElevationPointControllerNode);
export default ElevationPointControllerNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJTaGFwZSIsIlBvaW50Q29udHJvbGxlck5vZGUiLCJtZXJnZSIsIlN0cmluZ1V0aWxzIiwiQmFja2dyb3VuZE5vZGUiLCJQaGV0Rm9udCIsIk5vZGUiLCJQYXRoIiwiVGV4dCIsIk5MSUNvbnN0YW50cyIsIm51bWJlckxpbmVJbnRlZ2VycyIsIk51bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3MiLCJJTUFHRV9ESUxBVElPTiIsIkRJU1RBTkNFX1RFWFRfTUFYX1dJRFRIIiwiYW1vdW50QWJvdmVTZWFMZXZlbFN0cmluZyIsImFtb3VudEFib3ZlU2VhTGV2ZWwiLCJhbW91bnRCZWxvd1NlYUxldmVsU3RyaW5nIiwiYW1vdW50QmVsb3dTZWFMZXZlbCIsInNlYUxldmVsU3RyaW5nIiwic2VhTGV2ZWwiLCJFbGV2YXRpb25Qb2ludENvbnRyb2xsZXJOb2RlIiwiY29uc3RydWN0b3IiLCJwb2ludENvbnRyb2xsZXIiLCJpbWFnZUxpc3QiLCJ0ZXh0T2Zmc2V0cyIsIm9wdGlvbnMiLCJhc3NlcnQiLCJub2RlIiwiZm9yRWFjaCIsImltYWdlIiwidG91Y2hBcmVhIiwibG9jYWxCb3VuZHMiLCJkaWxhdGVkIiwiY29tcG9zaXRlSW1hZ2VOb2RlIiwiY2hpbGRyZW4iLCJpbWFnZVNlbGVjdGlvbkZ1bmN0aW9uIiwicG9zaXRpb24iLCJjdXJyZW50bHlTZWxlY3RlZEltYWdlSW5kZXgiLCJ0ZXh0T2Zmc2V0IiwicG9zaXRpb25Qcm9wZXJ0eSIsImxpbmsiLCJfIiwiZmluZEluZGV4IiwidmlzaWJsZSIsInNlbGVjdGVkSW1hZ2VJbmRleCIsImluZGV4IiwiYWJzb2x1dGVWYWx1ZUxpbmUiLCJzdHJva2UiLCJjb2xvciIsImxpbmVXaWR0aCIsImRpc3RhbmNlVGV4dCIsImZvbnQiLCJmaWxsIiwibWF4V2lkdGgiLCJkaXN0YW5jZUxhYmVsIiwiTEFCRUxfQkFDS0dST1VORF9PUFRJT05TIiwiYWRkQ2hpbGQiLCJtb3ZlVG9CYWNrIiwibnVtYmVyTGluZSIsIm51bWJlckxpbmVzIiwibXVsdGlsaW5rIiwic2hvd0Fic29sdXRlVmFsdWVzUHJvcGVydHkiLCJzaG93QWJzb2x1dGVWYWx1ZXMiLCJvdmVyRWxldmF0aW9uQXJlYVByb3BlcnR5IiwidmFsdWUiLCJpc0NvbnRyb2xsaW5nTnVtYmVyTGluZVBvaW50Iiwic2hhcGUiLCJtb3ZlVG8iLCJ4IiwieSIsImxpbmVUbyIsIm51bWJlckxpbmVQb2ludHMiLCJnZXQiLCJ2YWx1ZVByb3BlcnR5Iiwic2VhTGV2ZWxUZXh0IiwiZmlsbEluIiwiTWF0aCIsImFicyIsInN0cmluZyIsImxlZnRDZW50ZXIiLCJyaWdodENlbnRlciIsInBsdXMiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkVsZXZhdGlvblBvaW50Q29udHJvbGxlck5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogYSBTY2VuZXJ5IG5vZGUgdGhhdCBpcyB1c2VkIHRvIGNvbnRyb2wgcG9pbnQgcG9zaXRpb25zIGluIHRoZSBcIkVsZXZhdGlvblwiIHNjZW5lIG9mIHRoZSBOdW1iZXIgTGluZSBJbnRlZ2VycyBzaW1cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBTYXVyYWJoIFRvdGV5XHJcbiAqL1xyXG5cclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IFBvaW50Q29udHJvbGxlck5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vbnVtYmVyLWxpbmUtY29tbW9uL2pzL2NvbW1vbi92aWV3L1BvaW50Q29udHJvbGxlck5vZGUuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCBCYWNrZ3JvdW5kTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvQmFja2dyb3VuZE5vZGUuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgTm9kZSwgUGF0aCwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBOTElDb25zdGFudHMgZnJvbSAnLi4vLi4vY29tbW9uL05MSUNvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBudW1iZXJMaW5lSW50ZWdlcnMgZnJvbSAnLi4vLi4vbnVtYmVyTGluZUludGVnZXJzLmpzJztcclxuaW1wb3J0IE51bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3MgZnJvbSAnLi4vLi4vTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgSU1BR0VfRElMQVRJT04gPSAyMDtcclxuY29uc3QgRElTVEFOQ0VfVEVYVF9NQVhfV0lEVEggPSAyNTA7XHJcblxyXG5jb25zdCBhbW91bnRBYm92ZVNlYUxldmVsU3RyaW5nID0gTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncy5hbW91bnRBYm92ZVNlYUxldmVsO1xyXG5jb25zdCBhbW91bnRCZWxvd1NlYUxldmVsU3RyaW5nID0gTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncy5hbW91bnRCZWxvd1NlYUxldmVsO1xyXG5jb25zdCBzZWFMZXZlbFN0cmluZyA9IE51bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3Muc2VhTGV2ZWw7XHJcblxyXG5jbGFzcyBFbGV2YXRpb25Qb2ludENvbnRyb2xsZXJOb2RlIGV4dGVuZHMgUG9pbnRDb250cm9sbGVyTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7RWxldmF0aW9uUG9pbnRDb250cm9sbGVyfSBwb2ludENvbnRyb2xsZXJcclxuICAgKiBAcGFyYW0ge0ltYWdlW119IGltYWdlTGlzdCAtIGFuIGFycmF5IG9mIGltYWdlcyB1c2VkIHRvIGRlcGljdCB0aGlzIG5vZGVcclxuICAgKiBAcGFyYW0ge251bWJlcn0gc2VhTGV2ZWwgLSB0aGUgeSB2YWx1ZSBpbiB2aWV3IGNvb3JkaW5hdGVzIG9mIHRoZSBzZWEgbGV2ZWxcclxuICAgKiBAcGFyYW0ge1ZlY3RvcjJbXX0gdGV4dE9mZnNldHMgLSB0aGUgb2Zmc2V0cyBmb3IgdGhlIGNlbnRlckxlZnQgcG9zaXRpb25zIG9mIHRoZSBhYnNvbHV0ZSB2YWx1ZSB0ZXh0cyByZWxhdGl2ZSB0byB0aGUgaW1hZ2UgcmlnaHRDZW50ZXJcclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKCBwb2ludENvbnRyb2xsZXIsIGltYWdlTGlzdCwgc2VhTGV2ZWwsIHRleHRPZmZzZXRzLCBvcHRpb25zICkge1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICFvcHRpb25zIHx8ICFvcHRpb25zLm5vZGUsICdvcHRpb25zIHNob3VsZCBub3QgaW5jbHVkZSBhIG5vZGUgZm9yIHRoaXMgY29uc3RydWN0b3InICk7XHJcblxyXG4gICAgLy8gZGlsYXRlcyBlYWNoIGltYWdlJ3MgdG91Y2ggYXJlYVxyXG4gICAgaW1hZ2VMaXN0LmZvckVhY2goIGltYWdlID0+IHsgaW1hZ2UudG91Y2hBcmVhID0gaW1hZ2UubG9jYWxCb3VuZHMuZGlsYXRlZCggSU1BR0VfRElMQVRJT04gKTsgfSApO1xyXG5cclxuICAgIC8vIENyZWF0ZSBhIG5vZGUgd2l0aCBhbGwgdGhlIGltYWdlcyB0aGF0IHdpbGwgYmUgdXNlZCB0byBkZXBpY3QgdGhpcyBlbGV2YXRhYmxlIGl0ZW0uXHJcbiAgICBjb25zdCBjb21wb3NpdGVJbWFnZU5vZGUgPSBuZXcgTm9kZSggeyBjaGlsZHJlbjogaW1hZ2VMaXN0IH0gKTtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuXHJcbiAgICAgIC8vIFBhc3MgaW4gdGhlIHBhcmVudCBub2RlIHRoYXQgaW5jbHVkZXMgYWxsIGltYWdlcyBhcyB0aGUgbW9kZSB0aGF0IHdpbGwgY29udHJvbCB0aGUgcG9pbnQuXHJcbiAgICAgIG5vZGU6IGNvbXBvc2l0ZUltYWdlTm9kZSxcclxuXHJcbiAgICAgIC8vIHtmdW5jdGlvbn0gLSBBIGZ1bmN0aW9uIHRoYXQgdGFrZXMgYSBwb3NpdGlvbiBhbmQgYSBjdXJyZW50bHkgc2VsZWN0ZWQgaW1hZ2UgaW5kZXggYW5kIHJldHVybnMgdGhlIGluZGV4XHJcbiAgICAgIC8vIG9mIHRoZSBpbWFnZSB0aGF0IHNob3VsZCBiZSB2aXNpYmxlLiAgVGhpcyBlbmFibGVkIGZhaXJseSBjb21wbGV4IGFwcGVhcmFuY2UgY2hhbmdlcyB0byB0aGUgcG9pbnQgY29udHJvbGxlclxyXG4gICAgICAvLyBub2RlLlxyXG4gICAgICBpbWFnZVNlbGVjdGlvbkZ1bmN0aW9uOiAoIHBvc2l0aW9uLCBjdXJyZW50bHlTZWxlY3RlZEltYWdlSW5kZXggKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRseVNlbGVjdGVkSW1hZ2VJbmRleDtcclxuICAgICAgfVxyXG5cclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBsZXQgdGV4dE9mZnNldDtcclxuXHJcbiAgICAvLyBVcGRhdGUgdGhlIHZpc2liaWxpdHkgb2YgdGhlIGltYWdlcyBhcyB0aGUgcG9zaXRpb24gY2hhbmdlcy5cclxuICAgIHBvaW50Q29udHJvbGxlci5wb3NpdGlvblByb3BlcnR5LmxpbmsoIHBvc2l0aW9uID0+IHtcclxuICAgICAgY29uc3QgY3VycmVudGx5U2VsZWN0ZWRJbWFnZUluZGV4ID0gXy5maW5kSW5kZXgoIGltYWdlTGlzdCwgaW1hZ2UgPT4gaW1hZ2UudmlzaWJsZSApO1xyXG4gICAgICBjb25zdCBzZWxlY3RlZEltYWdlSW5kZXggPSBvcHRpb25zLmltYWdlU2VsZWN0aW9uRnVuY3Rpb24oIHBvc2l0aW9uLCBjdXJyZW50bHlTZWxlY3RlZEltYWdlSW5kZXggKTtcclxuICAgICAgaW1hZ2VMaXN0LmZvckVhY2goICggaW1hZ2UsIGluZGV4ICkgPT4ge1xyXG4gICAgICAgIGltYWdlLnZpc2libGUgPSBzZWxlY3RlZEltYWdlSW5kZXggPT09IGluZGV4O1xyXG4gICAgICB9ICk7XHJcbiAgICAgIHRleHRPZmZzZXQgPSB0ZXh0T2Zmc2V0c1sgc2VsZWN0ZWRJbWFnZUluZGV4IF07XHJcbiAgICB9ICk7XHJcblxyXG4gICAgc3VwZXIoIHBvaW50Q29udHJvbGxlciwgb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIGhhbmRsaW5nIG9mIHdoYXQgdGhlIHBvaW50IGNvbnRyb2xsZXIgZG9lcyB3aGVuIHRoZSBhYnNvbHV0ZSB2YWx1ZSBjaGVja2JveCBpcyBjaGVja2VkXHJcbiAgICBjb25zdCBhYnNvbHV0ZVZhbHVlTGluZSA9IG5ldyBQYXRoKCBudWxsLCB7IHN0cm9rZTogcG9pbnRDb250cm9sbGVyLmNvbG9yLCBsaW5lV2lkdGg6IDIgfSApO1xyXG4gICAgY29uc3QgZGlzdGFuY2VUZXh0ID0gbmV3IFRleHQoICcnLCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTggKSxcclxuICAgICAgZmlsbDogcG9pbnRDb250cm9sbGVyLmNvbG9yLFxyXG4gICAgICBtYXhXaWR0aDogRElTVEFOQ0VfVEVYVF9NQVhfV0lEVEhcclxuICAgIH0gKTtcclxuICAgIGNvbnN0IGRpc3RhbmNlTGFiZWwgPSBuZXcgQmFja2dyb3VuZE5vZGUoIGRpc3RhbmNlVGV4dCwgTkxJQ29uc3RhbnRzLkxBQkVMX0JBQ0tHUk9VTkRfT1BUSU9OUyApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggYWJzb2x1dGVWYWx1ZUxpbmUgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGRpc3RhbmNlTGFiZWwgKTtcclxuICAgIGFic29sdXRlVmFsdWVMaW5lLm1vdmVUb0JhY2soKTtcclxuICAgIGNvbnN0IG51bWJlckxpbmUgPSBwb2ludENvbnRyb2xsZXIubnVtYmVyTGluZXNbIDAgXTtcclxuXHJcbiAgICAvLyBVcGRhdGUgdGhlIGFic29sdXRlIHZhbHVlIHJlcHJlc2VudGF0aW9uIGFuZCBhc3NvY2lhdGVkIHRleHQuIFRoZXJlIGlzIG5vIG5lZWQgdG8gdW5saW5rIHRoaXMgc2luY2UgdGhlXHJcbiAgICAvLyBlbGV2YXRpb24gcG9pbnQgY29udHJvbGxlcnMgZG9uJ3QgY29tZSBhbmQgZ28uXHJcbiAgICBNdWx0aWxpbmsubXVsdGlsaW5rKFxyXG4gICAgICBbIG51bWJlckxpbmUuc2hvd0Fic29sdXRlVmFsdWVzUHJvcGVydHksIHBvaW50Q29udHJvbGxlci5wb3NpdGlvblByb3BlcnR5IF0sXHJcbiAgICAgIHNob3dBYnNvbHV0ZVZhbHVlcyA9PiB7XHJcbiAgICAgICAgaWYgKCBzaG93QWJzb2x1dGVWYWx1ZXNcclxuICAgICAgICAgICAgICYmIHBvaW50Q29udHJvbGxlci5vdmVyRWxldmF0aW9uQXJlYVByb3BlcnR5LnZhbHVlXHJcbiAgICAgICAgICAgICAmJiBwb2ludENvbnRyb2xsZXIuaXNDb250cm9sbGluZ051bWJlckxpbmVQb2ludCgpICkge1xyXG5cclxuICAgICAgICAgIGFic29sdXRlVmFsdWVMaW5lLnNoYXBlID0gbmV3IFNoYXBlKClcclxuICAgICAgICAgICAgLm1vdmVUbyggY29tcG9zaXRlSW1hZ2VOb2RlLngsIGNvbXBvc2l0ZUltYWdlTm9kZS55IClcclxuICAgICAgICAgICAgLmxpbmVUbyggY29tcG9zaXRlSW1hZ2VOb2RlLngsIHNlYUxldmVsICk7XHJcblxyXG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBwb2ludENvbnRyb2xsZXIubnVtYmVyTGluZVBvaW50cy5nZXQoIDAgKS52YWx1ZVByb3BlcnR5LnZhbHVlO1xyXG4gICAgICAgICAgbGV0IHNlYUxldmVsVGV4dCA9IHNlYUxldmVsU3RyaW5nO1xyXG4gICAgICAgICAgaWYgKCB2YWx1ZSA8IDAgKSB7XHJcbiAgICAgICAgICAgIHNlYUxldmVsVGV4dCA9IFN0cmluZ1V0aWxzLmZpbGxJbiggYW1vdW50QmVsb3dTZWFMZXZlbFN0cmluZywgeyB2YWx1ZTogTWF0aC5hYnMoIHZhbHVlICkgfSApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSBpZiAoIHZhbHVlID4gMCApIHtcclxuICAgICAgICAgICAgc2VhTGV2ZWxUZXh0ID0gU3RyaW5nVXRpbHMuZmlsbEluKCBhbW91bnRBYm92ZVNlYUxldmVsU3RyaW5nLCB7IHZhbHVlOiB2YWx1ZSB9ICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBkaXN0YW5jZVRleHQuc3RyaW5nID0gc2VhTGV2ZWxUZXh0O1xyXG4gICAgICAgICAgZGlzdGFuY2VMYWJlbC52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgIGRpc3RhbmNlTGFiZWwubGVmdENlbnRlciA9IGNvbXBvc2l0ZUltYWdlTm9kZS5yaWdodENlbnRlci5wbHVzKCB0ZXh0T2Zmc2V0ICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgYWJzb2x1dGVWYWx1ZUxpbmUuc2hhcGUgPSBudWxsO1xyXG4gICAgICAgICAgZGlzdGFuY2VMYWJlbC52aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG5udW1iZXJMaW5lSW50ZWdlcnMucmVnaXN0ZXIoICdFbGV2YXRpb25Qb2ludENvbnRyb2xsZXJOb2RlJywgRWxldmF0aW9uUG9pbnRDb250cm9sbGVyTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBFbGV2YXRpb25Qb2ludENvbnRyb2xsZXJOb2RlO1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7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