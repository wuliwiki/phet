// Copyright 2019-2022, University of Colorado Boulder

/**
 * SceneView is a base class for scene views in the "Explore" screen, includes check boxes, comparison statement, and
 * some other UI elements that are common to all scenes.
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import NLCheckbox from '../../../../number-line-common/js/common/view/NLCheckbox.js';
import NLCheckboxGroup from '../../../../number-line-common/js/common/view/NLCheckboxGroup.js';
import SpatializedNumberLineNode from '../../../../number-line-common/js/common/view/SpatializedNumberLineNode.js';
import merge from '../../../../phet-core/js/merge.js';
import ResetButton from '../../../../scenery-phet/js/buttons/ResetButton.js';
import { Node } from '../../../../scenery/js/imports.js';
import NLIConstants from '../../common/NLIConstants.js';
import ComparisonStatementAccordionBox from '../../common/view/ComparisonStatementAccordionBox.js';
import numberLineIntegers from '../../numberLineIntegers.js';
import NumberLineIntegersStrings from '../../NumberLineIntegersStrings.js';

// constants
const MAX_CHECKBOX_TEXT_WIDTH = 145; // empirically determined to stay within dev bounds
const CHECKBOX_OPTIONS = {
  textOptions: {
    maxWidth: MAX_CHECKBOX_TEXT_WIDTH
  }
};
const absoluteValueString = NumberLineIntegersStrings.absoluteValue;
const labelsString = NumberLineIntegersStrings.labels;
const numberLineString = NumberLineIntegersStrings.numberLine;
class SceneView extends Node {
  /**
   * @param {SceneModel} sceneModel
   * @param layoutBounds
   * @param options
   * @public
   */
  constructor(sceneModel, layoutBounds, options) {
    options = merge({
      // automatically add number line nodes to the scene graph, set to false if subclasses need more control
      automaticallyAddNLNodes: true,
      // {Object) - common options for the number line node(s)
      commonNumberLineNodeOptions: {},
      // {Object[]|null} - unique options for each of the number lines, null if only one or all are the same
      uniqueNumberLineNodeOptionsList: null
    }, options);

    // options checking
    assert && assert(!options.uniqueNumberLineNodeOptionsList || options.uniqueNumberLineNodeOptionsList.length === sceneModel.numberLines.length, 'the number of option objects for number line nodes does not match the number of number lines');
    super();

    // @protected (read-only) {Bounds2}
    this.layoutBounds = layoutBounds;

    // @protected (read-only) {Node} - layer where the number line or lines go
    this.numberLinesLayer = new Node();
    this.addChild(this.numberLinesLayer);

    // @protected (read-only) {Node} - layer where the controls go
    this.controlsLayer = new Node();
    this.addChild(this.controlsLayer);

    // @protected (read-only) {Node} - layer where the scene elements go, populated primarily in sub-classes
    this.scenesLayer = new Node();
    this.addChild(this.scenesLayer);

    // @protected (read-only) {Node} - layer where the comparison statements are shown, needs to be above scene elements
    this.comparisonStatementsLayer = new Node();
    this.addChild(this.comparisonStatementsLayer);

    // checkboxes that control common model properties
    const checkboxes = [new NLCheckbox(sceneModel.showNumberLineProperty, numberLineString, CHECKBOX_OPTIONS), new NLCheckbox(sceneModel.numberLineLabelsVisibleProperty, labelsString, CHECKBOX_OPTIONS), new NLCheckbox(sceneModel.numberLineAbsoluteValueIndicatorsVisibleProperty, absoluteValueString, CHECKBOX_OPTIONS)];

    // @protected {NLCheckboxGroup} - node containing the checkboxes that control common model properties
    this.checkboxGroup = new NLCheckboxGroup(checkboxes, {
      left: layoutBounds.maxX - NLIConstants.EXPLORE_SCREEN_CONTROLS_LEFT_SIDE_INSET,
      top: layoutBounds.minY + 10
    });
    this.controlsLayer.addChild(this.checkboxGroup);

    // @private
    this.comparisonStatementBoxesOpenProperty = new BooleanProperty(true);

    // @protected - comparison statements that are inside an accordion box
    this.comparisonStatementAccordionBoxes = [];

    // Create the comparison statements, which are contained within an accordion box, one for each number line.
    sceneModel.numberLines.forEach(numberLine => {
      const comparisonStatementAccordionBox = new ComparisonStatementAccordionBox(numberLine, {
        centerX: layoutBounds.centerX,
        top: 10,
        expandedProperty: this.comparisonStatementBoxesOpenProperty
      });
      this.comparisonStatementAccordionBoxes.push(comparisonStatementAccordionBox);
      this.comparisonStatementsLayer.addChild(comparisonStatementAccordionBox);
    });

    // @protected (read-only) {NumberLine} - views of the number lines
    this.numberLineNodes = [];

    // Create and, if options dictate, add the number line to the view.
    sceneModel.numberLines.forEach((numberLine, index) => {
      const numberLineNode = new SpatializedNumberLineNode(numberLine, merge({}, options.commonNumberLineNodeOptions, options.uniqueNumberLineNodeOptionsList ? options.uniqueNumberLineNodeOptionsList[index] : {}));
      sceneModel.showNumberLineProperty.linkAttribute(numberLineNode, 'visible');
      this.numberLineNodes.push(numberLineNode);
      if (options.automaticallyAddNLNodes) {
        this.numberLinesLayer.addChild(numberLineNode);
      }
    });

    // button that restores the scene to its initial state but doesn't reset the model and view for the whole screen
    const sceneResetButton = new ResetButton({
      listener: () => {
        this.interruptSubtreeInput();
        sceneModel.resetScene();
      },
      baseColor: '#f2f2f2',
      scale: 0.65,
      touchAreaDilation: 5,
      // position centered just above the scene selection buttons
      centerX: layoutBounds.maxX - 93,
      bottom: layoutBounds.maxY - 165
    });
    this.controlsLayer.addChild(sceneResetButton);
  }

  /**
   * @public
   */
  reset() {
    this.comparisonStatementAccordionBoxes.forEach(comparisonStatementAccordionBox => {
      comparisonStatementAccordionBox.reset();
    });
  }
}
numberLineIntegers.register('SceneView', SceneView);
export default SceneView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJOTENoZWNrYm94IiwiTkxDaGVja2JveEdyb3VwIiwiU3BhdGlhbGl6ZWROdW1iZXJMaW5lTm9kZSIsIm1lcmdlIiwiUmVzZXRCdXR0b24iLCJOb2RlIiwiTkxJQ29uc3RhbnRzIiwiQ29tcGFyaXNvblN0YXRlbWVudEFjY29yZGlvbkJveCIsIm51bWJlckxpbmVJbnRlZ2VycyIsIk51bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3MiLCJNQVhfQ0hFQ0tCT1hfVEVYVF9XSURUSCIsIkNIRUNLQk9YX09QVElPTlMiLCJ0ZXh0T3B0aW9ucyIsIm1heFdpZHRoIiwiYWJzb2x1dGVWYWx1ZVN0cmluZyIsImFic29sdXRlVmFsdWUiLCJsYWJlbHNTdHJpbmciLCJsYWJlbHMiLCJudW1iZXJMaW5lU3RyaW5nIiwibnVtYmVyTGluZSIsIlNjZW5lVmlldyIsImNvbnN0cnVjdG9yIiwic2NlbmVNb2RlbCIsImxheW91dEJvdW5kcyIsIm9wdGlvbnMiLCJhdXRvbWF0aWNhbGx5QWRkTkxOb2RlcyIsImNvbW1vbk51bWJlckxpbmVOb2RlT3B0aW9ucyIsInVuaXF1ZU51bWJlckxpbmVOb2RlT3B0aW9uc0xpc3QiLCJhc3NlcnQiLCJsZW5ndGgiLCJudW1iZXJMaW5lcyIsIm51bWJlckxpbmVzTGF5ZXIiLCJhZGRDaGlsZCIsImNvbnRyb2xzTGF5ZXIiLCJzY2VuZXNMYXllciIsImNvbXBhcmlzb25TdGF0ZW1lbnRzTGF5ZXIiLCJjaGVja2JveGVzIiwic2hvd051bWJlckxpbmVQcm9wZXJ0eSIsIm51bWJlckxpbmVMYWJlbHNWaXNpYmxlUHJvcGVydHkiLCJudW1iZXJMaW5lQWJzb2x1dGVWYWx1ZUluZGljYXRvcnNWaXNpYmxlUHJvcGVydHkiLCJjaGVja2JveEdyb3VwIiwibGVmdCIsIm1heFgiLCJFWFBMT1JFX1NDUkVFTl9DT05UUk9MU19MRUZUX1NJREVfSU5TRVQiLCJ0b3AiLCJtaW5ZIiwiY29tcGFyaXNvblN0YXRlbWVudEJveGVzT3BlblByb3BlcnR5IiwiY29tcGFyaXNvblN0YXRlbWVudEFjY29yZGlvbkJveGVzIiwiZm9yRWFjaCIsImNvbXBhcmlzb25TdGF0ZW1lbnRBY2NvcmRpb25Cb3giLCJjZW50ZXJYIiwiZXhwYW5kZWRQcm9wZXJ0eSIsInB1c2giLCJudW1iZXJMaW5lTm9kZXMiLCJpbmRleCIsIm51bWJlckxpbmVOb2RlIiwibGlua0F0dHJpYnV0ZSIsInNjZW5lUmVzZXRCdXR0b24iLCJsaXN0ZW5lciIsImludGVycnVwdFN1YnRyZWVJbnB1dCIsInJlc2V0U2NlbmUiLCJiYXNlQ29sb3IiLCJzY2FsZSIsInRvdWNoQXJlYURpbGF0aW9uIiwiYm90dG9tIiwibWF4WSIsInJlc2V0IiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJTY2VuZVZpZXcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTktMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogU2NlbmVWaWV3IGlzIGEgYmFzZSBjbGFzcyBmb3Igc2NlbmUgdmlld3MgaW4gdGhlIFwiRXhwbG9yZVwiIHNjcmVlbiwgaW5jbHVkZXMgY2hlY2sgYm94ZXMsIGNvbXBhcmlzb24gc3RhdGVtZW50LCBhbmRcclxuICogc29tZSBvdGhlciBVSSBlbGVtZW50cyB0aGF0IGFyZSBjb21tb24gdG8gYWxsIHNjZW5lcy5cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcclxuaW1wb3J0IE5MQ2hlY2tib3ggZnJvbSAnLi4vLi4vLi4vLi4vbnVtYmVyLWxpbmUtY29tbW9uL2pzL2NvbW1vbi92aWV3L05MQ2hlY2tib3guanMnO1xyXG5pbXBvcnQgTkxDaGVja2JveEdyb3VwIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9qcy9jb21tb24vdmlldy9OTENoZWNrYm94R3JvdXAuanMnO1xyXG5pbXBvcnQgU3BhdGlhbGl6ZWROdW1iZXJMaW5lTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9udW1iZXItbGluZS1jb21tb24vanMvY29tbW9uL3ZpZXcvU3BhdGlhbGl6ZWROdW1iZXJMaW5lTm9kZS5qcyc7XHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgUmVzZXRCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL2J1dHRvbnMvUmVzZXRCdXR0b24uanMnO1xyXG5pbXBvcnQgeyBOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IE5MSUNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vTkxJQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IENvbXBhcmlzb25TdGF0ZW1lbnRBY2NvcmRpb25Cb3ggZnJvbSAnLi4vLi4vY29tbW9uL3ZpZXcvQ29tcGFyaXNvblN0YXRlbWVudEFjY29yZGlvbkJveC5qcyc7XHJcbmltcG9ydCBudW1iZXJMaW5lSW50ZWdlcnMgZnJvbSAnLi4vLi4vbnVtYmVyTGluZUludGVnZXJzLmpzJztcclxuaW1wb3J0IE51bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3MgZnJvbSAnLi4vLi4vTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncy5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgTUFYX0NIRUNLQk9YX1RFWFRfV0lEVEggPSAxNDU7IC8vIGVtcGlyaWNhbGx5IGRldGVybWluZWQgdG8gc3RheSB3aXRoaW4gZGV2IGJvdW5kc1xyXG5jb25zdCBDSEVDS0JPWF9PUFRJT05TID0geyB0ZXh0T3B0aW9uczogeyBtYXhXaWR0aDogTUFYX0NIRUNLQk9YX1RFWFRfV0lEVEggfSB9O1xyXG5jb25zdCBhYnNvbHV0ZVZhbHVlU3RyaW5nID0gTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncy5hYnNvbHV0ZVZhbHVlO1xyXG5jb25zdCBsYWJlbHNTdHJpbmcgPSBOdW1iZXJMaW5lSW50ZWdlcnNTdHJpbmdzLmxhYmVscztcclxuY29uc3QgbnVtYmVyTGluZVN0cmluZyA9IE51bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3MubnVtYmVyTGluZTtcclxuXHJcbmNsYXNzIFNjZW5lVmlldyBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge1NjZW5lTW9kZWx9IHNjZW5lTW9kZWxcclxuICAgKiBAcGFyYW0gbGF5b3V0Qm91bmRzXHJcbiAgICogQHBhcmFtIG9wdGlvbnNcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIHNjZW5lTW9kZWwsIGxheW91dEJvdW5kcywgb3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuXHJcbiAgICAgIC8vIGF1dG9tYXRpY2FsbHkgYWRkIG51bWJlciBsaW5lIG5vZGVzIHRvIHRoZSBzY2VuZSBncmFwaCwgc2V0IHRvIGZhbHNlIGlmIHN1YmNsYXNzZXMgbmVlZCBtb3JlIGNvbnRyb2xcclxuICAgICAgYXV0b21hdGljYWxseUFkZE5MTm9kZXM6IHRydWUsXHJcblxyXG4gICAgICAvLyB7T2JqZWN0KSAtIGNvbW1vbiBvcHRpb25zIGZvciB0aGUgbnVtYmVyIGxpbmUgbm9kZShzKVxyXG4gICAgICBjb21tb25OdW1iZXJMaW5lTm9kZU9wdGlvbnM6IHt9LFxyXG5cclxuICAgICAgLy8ge09iamVjdFtdfG51bGx9IC0gdW5pcXVlIG9wdGlvbnMgZm9yIGVhY2ggb2YgdGhlIG51bWJlciBsaW5lcywgbnVsbCBpZiBvbmx5IG9uZSBvciBhbGwgYXJlIHRoZSBzYW1lXHJcbiAgICAgIHVuaXF1ZU51bWJlckxpbmVOb2RlT3B0aW9uc0xpc3Q6IG51bGxcclxuXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gb3B0aW9ucyBjaGVja2luZ1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydChcclxuICAgICAgIW9wdGlvbnMudW5pcXVlTnVtYmVyTGluZU5vZGVPcHRpb25zTGlzdCB8fCBvcHRpb25zLnVuaXF1ZU51bWJlckxpbmVOb2RlT3B0aW9uc0xpc3QubGVuZ3RoID09PSBzY2VuZU1vZGVsLm51bWJlckxpbmVzLmxlbmd0aCxcclxuICAgICAgJ3RoZSBudW1iZXIgb2Ygb3B0aW9uIG9iamVjdHMgZm9yIG51bWJlciBsaW5lIG5vZGVzIGRvZXMgbm90IG1hdGNoIHRoZSBudW1iZXIgb2YgbnVtYmVyIGxpbmVzJ1xyXG4gICAgKTtcclxuXHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIC8vIEBwcm90ZWN0ZWQgKHJlYWQtb25seSkge0JvdW5kczJ9XHJcbiAgICB0aGlzLmxheW91dEJvdW5kcyA9IGxheW91dEJvdW5kcztcclxuXHJcbiAgICAvLyBAcHJvdGVjdGVkIChyZWFkLW9ubHkpIHtOb2RlfSAtIGxheWVyIHdoZXJlIHRoZSBudW1iZXIgbGluZSBvciBsaW5lcyBnb1xyXG4gICAgdGhpcy5udW1iZXJMaW5lc0xheWVyID0gbmV3IE5vZGUoKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMubnVtYmVyTGluZXNMYXllciApO1xyXG5cclxuICAgIC8vIEBwcm90ZWN0ZWQgKHJlYWQtb25seSkge05vZGV9IC0gbGF5ZXIgd2hlcmUgdGhlIGNvbnRyb2xzIGdvXHJcbiAgICB0aGlzLmNvbnRyb2xzTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5jb250cm9sc0xheWVyICk7XHJcblxyXG4gICAgLy8gQHByb3RlY3RlZCAocmVhZC1vbmx5KSB7Tm9kZX0gLSBsYXllciB3aGVyZSB0aGUgc2NlbmUgZWxlbWVudHMgZ28sIHBvcHVsYXRlZCBwcmltYXJpbHkgaW4gc3ViLWNsYXNzZXNcclxuICAgIHRoaXMuc2NlbmVzTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5zY2VuZXNMYXllciApO1xyXG5cclxuICAgIC8vIEBwcm90ZWN0ZWQgKHJlYWQtb25seSkge05vZGV9IC0gbGF5ZXIgd2hlcmUgdGhlIGNvbXBhcmlzb24gc3RhdGVtZW50cyBhcmUgc2hvd24sIG5lZWRzIHRvIGJlIGFib3ZlIHNjZW5lIGVsZW1lbnRzXHJcbiAgICB0aGlzLmNvbXBhcmlzb25TdGF0ZW1lbnRzTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdGhpcy5jb21wYXJpc29uU3RhdGVtZW50c0xheWVyICk7XHJcblxyXG4gICAgLy8gY2hlY2tib3hlcyB0aGF0IGNvbnRyb2wgY29tbW9uIG1vZGVsIHByb3BlcnRpZXNcclxuICAgIGNvbnN0IGNoZWNrYm94ZXMgPSBbXHJcbiAgICAgIG5ldyBOTENoZWNrYm94KCBzY2VuZU1vZGVsLnNob3dOdW1iZXJMaW5lUHJvcGVydHksIG51bWJlckxpbmVTdHJpbmcsIENIRUNLQk9YX09QVElPTlMgKSxcclxuICAgICAgbmV3IE5MQ2hlY2tib3goIHNjZW5lTW9kZWwubnVtYmVyTGluZUxhYmVsc1Zpc2libGVQcm9wZXJ0eSwgbGFiZWxzU3RyaW5nLCBDSEVDS0JPWF9PUFRJT05TICksXHJcbiAgICAgIG5ldyBOTENoZWNrYm94KCBzY2VuZU1vZGVsLm51bWJlckxpbmVBYnNvbHV0ZVZhbHVlSW5kaWNhdG9yc1Zpc2libGVQcm9wZXJ0eSwgYWJzb2x1dGVWYWx1ZVN0cmluZywgQ0hFQ0tCT1hfT1BUSU9OUyApXHJcbiAgICBdO1xyXG5cclxuICAgIC8vIEBwcm90ZWN0ZWQge05MQ2hlY2tib3hHcm91cH0gLSBub2RlIGNvbnRhaW5pbmcgdGhlIGNoZWNrYm94ZXMgdGhhdCBjb250cm9sIGNvbW1vbiBtb2RlbCBwcm9wZXJ0aWVzXHJcbiAgICB0aGlzLmNoZWNrYm94R3JvdXAgPSBuZXcgTkxDaGVja2JveEdyb3VwKCBjaGVja2JveGVzLCB7XHJcbiAgICAgIGxlZnQ6IGxheW91dEJvdW5kcy5tYXhYIC0gTkxJQ29uc3RhbnRzLkVYUExPUkVfU0NSRUVOX0NPTlRST0xTX0xFRlRfU0lERV9JTlNFVCxcclxuICAgICAgdG9wOiBsYXlvdXRCb3VuZHMubWluWSArIDEwXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmNvbnRyb2xzTGF5ZXIuYWRkQ2hpbGQoIHRoaXMuY2hlY2tib3hHcm91cCApO1xyXG5cclxuICAgIC8vIEBwcml2YXRlXHJcbiAgICB0aGlzLmNvbXBhcmlzb25TdGF0ZW1lbnRCb3hlc09wZW5Qcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUgKTtcclxuXHJcbiAgICAvLyBAcHJvdGVjdGVkIC0gY29tcGFyaXNvbiBzdGF0ZW1lbnRzIHRoYXQgYXJlIGluc2lkZSBhbiBhY2NvcmRpb24gYm94XHJcbiAgICB0aGlzLmNvbXBhcmlzb25TdGF0ZW1lbnRBY2NvcmRpb25Cb3hlcyA9IFtdO1xyXG5cclxuICAgIC8vIENyZWF0ZSB0aGUgY29tcGFyaXNvbiBzdGF0ZW1lbnRzLCB3aGljaCBhcmUgY29udGFpbmVkIHdpdGhpbiBhbiBhY2NvcmRpb24gYm94LCBvbmUgZm9yIGVhY2ggbnVtYmVyIGxpbmUuXHJcbiAgICBzY2VuZU1vZGVsLm51bWJlckxpbmVzLmZvckVhY2goIG51bWJlckxpbmUgPT4ge1xyXG4gICAgICBjb25zdCBjb21wYXJpc29uU3RhdGVtZW50QWNjb3JkaW9uQm94ID0gbmV3IENvbXBhcmlzb25TdGF0ZW1lbnRBY2NvcmRpb25Cb3goIG51bWJlckxpbmUsIHtcclxuICAgICAgICBjZW50ZXJYOiBsYXlvdXRCb3VuZHMuY2VudGVyWCxcclxuICAgICAgICB0b3A6IDEwLFxyXG4gICAgICAgIGV4cGFuZGVkUHJvcGVydHk6IHRoaXMuY29tcGFyaXNvblN0YXRlbWVudEJveGVzT3BlblByb3BlcnR5XHJcbiAgICAgIH0gKTtcclxuICAgICAgdGhpcy5jb21wYXJpc29uU3RhdGVtZW50QWNjb3JkaW9uQm94ZXMucHVzaCggY29tcGFyaXNvblN0YXRlbWVudEFjY29yZGlvbkJveCApO1xyXG4gICAgICB0aGlzLmNvbXBhcmlzb25TdGF0ZW1lbnRzTGF5ZXIuYWRkQ2hpbGQoIGNvbXBhcmlzb25TdGF0ZW1lbnRBY2NvcmRpb25Cb3ggKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBAcHJvdGVjdGVkIChyZWFkLW9ubHkpIHtOdW1iZXJMaW5lfSAtIHZpZXdzIG9mIHRoZSBudW1iZXIgbGluZXNcclxuICAgIHRoaXMubnVtYmVyTGluZU5vZGVzID0gW107XHJcblxyXG4gICAgLy8gQ3JlYXRlIGFuZCwgaWYgb3B0aW9ucyBkaWN0YXRlLCBhZGQgdGhlIG51bWJlciBsaW5lIHRvIHRoZSB2aWV3LlxyXG4gICAgc2NlbmVNb2RlbC5udW1iZXJMaW5lcy5mb3JFYWNoKCAoIG51bWJlckxpbmUsIGluZGV4ICkgPT4ge1xyXG4gICAgICBjb25zdCBudW1iZXJMaW5lTm9kZSA9IG5ldyBTcGF0aWFsaXplZE51bWJlckxpbmVOb2RlKFxyXG4gICAgICAgIG51bWJlckxpbmUsXHJcbiAgICAgICAgbWVyZ2UoXHJcbiAgICAgICAgICB7fSxcclxuICAgICAgICAgIG9wdGlvbnMuY29tbW9uTnVtYmVyTGluZU5vZGVPcHRpb25zLFxyXG4gICAgICAgICAgb3B0aW9ucy51bmlxdWVOdW1iZXJMaW5lTm9kZU9wdGlvbnNMaXN0ID8gb3B0aW9ucy51bmlxdWVOdW1iZXJMaW5lTm9kZU9wdGlvbnNMaXN0WyBpbmRleCBdIDoge31cclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgICAgIHNjZW5lTW9kZWwuc2hvd051bWJlckxpbmVQcm9wZXJ0eS5saW5rQXR0cmlidXRlKCBudW1iZXJMaW5lTm9kZSwgJ3Zpc2libGUnICk7XHJcbiAgICAgIHRoaXMubnVtYmVyTGluZU5vZGVzLnB1c2goIG51bWJlckxpbmVOb2RlICk7XHJcbiAgICAgIGlmICggb3B0aW9ucy5hdXRvbWF0aWNhbGx5QWRkTkxOb2RlcyApIHtcclxuICAgICAgICB0aGlzLm51bWJlckxpbmVzTGF5ZXIuYWRkQ2hpbGQoIG51bWJlckxpbmVOb2RlICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBidXR0b24gdGhhdCByZXN0b3JlcyB0aGUgc2NlbmUgdG8gaXRzIGluaXRpYWwgc3RhdGUgYnV0IGRvZXNuJ3QgcmVzZXQgdGhlIG1vZGVsIGFuZCB2aWV3IGZvciB0aGUgd2hvbGUgc2NyZWVuXHJcbiAgICBjb25zdCBzY2VuZVJlc2V0QnV0dG9uID0gbmV3IFJlc2V0QnV0dG9uKCB7XHJcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5pbnRlcnJ1cHRTdWJ0cmVlSW5wdXQoKTtcclxuICAgICAgICBzY2VuZU1vZGVsLnJlc2V0U2NlbmUoKTtcclxuICAgICAgfSxcclxuICAgICAgYmFzZUNvbG9yOiAnI2YyZjJmMicsXHJcbiAgICAgIHNjYWxlOiAwLjY1LFxyXG4gICAgICB0b3VjaEFyZWFEaWxhdGlvbjogNSxcclxuXHJcbiAgICAgIC8vIHBvc2l0aW9uIGNlbnRlcmVkIGp1c3QgYWJvdmUgdGhlIHNjZW5lIHNlbGVjdGlvbiBidXR0b25zXHJcbiAgICAgIGNlbnRlclg6IGxheW91dEJvdW5kcy5tYXhYIC0gOTMsXHJcbiAgICAgIGJvdHRvbTogbGF5b3V0Qm91bmRzLm1heFkgLSAxNjVcclxuICAgIH0gKTtcclxuICAgIHRoaXMuY29udHJvbHNMYXllci5hZGRDaGlsZCggc2NlbmVSZXNldEJ1dHRvbiApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHJlc2V0KCkge1xyXG4gICAgdGhpcy5jb21wYXJpc29uU3RhdGVtZW50QWNjb3JkaW9uQm94ZXMuZm9yRWFjaCggY29tcGFyaXNvblN0YXRlbWVudEFjY29yZGlvbkJveCA9PiB7XHJcbiAgICAgIGNvbXBhcmlzb25TdGF0ZW1lbnRBY2NvcmRpb25Cb3gucmVzZXQoKTtcclxuICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbm51bWJlckxpbmVJbnRlZ2Vycy5yZWdp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