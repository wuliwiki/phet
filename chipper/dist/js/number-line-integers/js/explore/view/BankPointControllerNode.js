// Copyright 2019-2023, University of Colorado Boulder

/**
 * BankPointControllerNode is a Scenery node that is used to control point positions in the "Bank" scene of the Number
 * Line Integers sim
 *
 * @author John Blanco (PhET Interactive Simulations)
 * @author Saurabh Totey
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import NLCConstants from '../../../../number-line-common/js/common/NLCConstants.js';
import PointControllerNode from '../../../../number-line-common/js/common/view/PointControllerNode.js';
import PiggyBankDecoration from '../../../../number-line-common/js/explore/model/PiggyBankDecoration.js';
import PiggyBankNode from '../../../../number-line-common/js/explore/view/PiggyBankNode.js';
import merge from '../../../../phet-core/js/merge.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import BackgroundNode from '../../../../scenery-phet/js/BackgroundNode.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Circle, Color, Node, Text } from '../../../../scenery/js/imports.js';
import Animation from '../../../../twixt/js/Animation.js';
import Easing from '../../../../twixt/js/Easing.js';
import numberLineIntegers from '../../numberLineIntegers.js';
import NumberLineIntegersStrings from '../../NumberLineIntegersStrings.js';

// constants
const MIN_WIDTH = 80; // screen coords, empirically determined
const MAX_WIDTH = 200; // screen coords, empirically determined
const TOUCH_DILATION = 7; // dilates piggy banks enough to not overlap touch areas with account balance buttons
const MOST_POSITIVE_FILL = Color.toColor('#1fb493');
const LEAST_POSITIVE_FILL = Color.toColor('#a5e1d4');
const MOST_NEGATIVE_FILL = Color.toColor('#fb1d25');
const LEAST_NEGATIVE_FILL = Color.toColor('#fda5a8');
const POSITIVE_ABSOLUTE_VALUE_TEXT_COLOR = '#0e977b';
const NEGATIVE_ABSOLUTE_VALUE_TEXT_COLOR = MOST_NEGATIVE_FILL;
const EMPTY_FILL = Color.WHITE;
const ZERO_FILL = Color.BLACK;
const READOUT_DISTANCE_FROM_IMAGE = 5;
const COIN_RADIUS = 10;
const COIN_COLOR = new Color(213, 196, 39);
const COIN_ANIMATION_DURATION = 0.5; // seconds

const balanceAmountString = NumberLineIntegersStrings.balanceAmount;
const currencyUnitsString = NumberLineIntegersStrings.currencyUnits;
const debtAmountString = NumberLineIntegersStrings.debtAmount;
const moneyAmountString = NumberLineIntegersStrings.moneyAmount;

// constants
const COIN_DEPOSIT_ANIMATION_START_Y = -60; // above the piggy bank, in screen coordinates, empirically determined
const COIN_DEPOSIT_ANIMATION_END_Y = 0; // inside the piggy bank, in screen coordinates, empirically determined
const COIN_WITHDRAWAL_ANIMATION_START_Y = 30; // inside the piggy bank, in screen coordinates, empirically determined
const COIN_WITHDRAWAL_ANIMATION_END_Y = 60; // below the piggy bank, in screen coordinates, empirically determined
const NUMBER_OF_COINS_TO_PRE_CREATE = 20; // number of coins to create for animation, empirically determined
const COIN_NODE_X_POSITION = -3;
class BankPointControllerNode extends PointControllerNode {
  /**
   * @param {PointController} pointController
   * @param {Emitter} balanceChangedByButtonEmitter
   * @param {PiggyBankDecoration} decorationType - indicates artwork on bank
   * @param {Object} [options]
   * @public
   */
  constructor(pointController, balanceChangedByButtonEmitter, decorationType, options) {
    assert && assert(!options || !options.node, 'options should not include a node for this constructor');

    // root node for draggable controller portion, separate for absolute value display and coin animation
    const controllerNode = new Node();

    // Choose the overlay image source, which is artwork that must exactly match the shape of the outline.
    const piggyBankNode = new PiggyBankNode({
      decorationType: decorationType
    });
    controllerNode.addChild(piggyBankNode);

    // Add the balance indicator node.
    const balanceNode = new Text('', {
      font: new PhetFont(30),
      fill: 'white',
      stroke: 'black',
      center: Vector2.ZERO,
      maxWidth: 65
    });
    controllerNode.addChild(balanceNode);

    // dilates the touch area for the controllerNode
    controllerNode.touchArea = controllerNode.bounds.dilated(TOUCH_DILATION);
    options = merge({
      node: controllerNode
    }, options);
    super(pointController, options);

    // the readout that will display the absolute value in a phrase
    const absoluteValueText = new Text('', {
      font: new PhetFont(18),
      maxWidth: 250
    });
    const absoluteValueBackground = new BackgroundNode(absoluteValueText, NLCConstants.LABEL_BACKGROUND_OPTIONS);
    this.addChild(absoluteValueBackground);

    // Get a reference to the number line (there is only one for this scene).
    const numberLine = pointController.numberLines[0];

    // Control visibility of the absolute value readout.
    numberLine.showAbsoluteValuesProperty.linkAttribute(absoluteValueBackground, 'visible');

    // Update the position of the absolute value readout (i.e. the text node that says things like, "balance of $2".
    const updateAbsoluteValueReadoutPosition = () => {
      if (decorationType === PiggyBankDecoration.FLOWERS) {
        absoluteValueBackground.centerX = controllerNode.centerX - 9; // tweaked a bit to be centered under feet
        absoluteValueBackground.top = controllerNode.y + piggyBankNode.height / 2 * controllerNode.getScaleVector().y + READOUT_DISTANCE_FROM_IMAGE;
      } else {
        absoluteValueBackground.centerX = controllerNode.centerX - 2; // tweaked a bit to be centered over coin slot
        absoluteValueBackground.bottom = controllerNode.y - piggyBankNode.height / 2 * controllerNode.getScaleVector().y - READOUT_DISTANCE_FROM_IMAGE;
      }
    };

    // Update the node's appearance as its position changes.
    const valueRange = numberLine.displayedRangeProperty.value;
    const unscaledWidth = controllerNode.width;
    const updateController = () => {
      if (pointController.numberLinePoints.length > 0) {
        // state checking
        assert && assert(pointController.numberLinePoints.length === 1, 'point controllers in the bank scene should never control multiple points');

        // variables needed to make the updates
        const numberLinePoint = pointController.numberLinePoints.get(0);
        const currentBalance = numberLinePoint.valueProperty.value;

        // Scale the size.
        const desiredWidth = MIN_WIDTH + Math.abs(currentBalance) / valueRange.max * (MAX_WIDTH - MIN_WIDTH);
        controllerNode.setScaleMagnitude(desiredWidth / unscaledWidth);

        // Update the color of the point and the node's fill.
        let fill = EMPTY_FILL;
        if (currentBalance < 0) {
          fill = Color.interpolateRGBA(LEAST_NEGATIVE_FILL, MOST_NEGATIVE_FILL, currentBalance / valueRange.min);
        } else if (currentBalance > 0) {
          fill = Color.interpolateRGBA(LEAST_POSITIVE_FILL, MOST_POSITIVE_FILL, currentBalance / valueRange.max);
        }
        piggyBankNode.fill = fill;

        // Update the balance indicator text.
        const signIndicator = currentBalance < 0 ? '-' : '';
        balanceNode.string = signIndicator + StringUtils.fillIn(moneyAmountString, {
          currencyUnit: currencyUnitsString,
          value: Math.abs(currentBalance)
        });
        balanceNode.center = Vector2.ZERO;

        // Update the absolute value readout.
        const value = numberLinePoint.valueProperty.value;
        let stringTemplate;
        if (value < 0) {
          stringTemplate = debtAmountString;
          absoluteValueText.fill = NEGATIVE_ABSOLUTE_VALUE_TEXT_COLOR;
        } else {
          stringTemplate = balanceAmountString;
          absoluteValueText.fill = value > 0 ? POSITIVE_ABSOLUTE_VALUE_TEXT_COLOR : ZERO_FILL;
        }
        absoluteValueText.string = StringUtils.fillIn(stringTemplate, {
          value: Math.abs(value)
        });
        updateAbsoluteValueReadoutPosition();
      }
    };
    pointController.positionProperty.link(updateController);

    // immediately called so that absolute value texts are positioned correctly
    updateController();

    // Add the layer where the coin animations will occur.
    const coinAnimationLayer = new Node();
    controllerNode.addChild(coinAnimationLayer);

    // Add the coins now so that they don't have to be added on the fly during the animation.
    _.times(NUMBER_OF_COINS_TO_PRE_CREATE, () => {
      coinAnimationLayer.addChild(new CoinNode({
        centerX: COIN_NODE_X_POSITION,
        visible: false
      }));
    });

    // Add a clipping area so that the coins look like they are going in and out.  This must be manually updated if
    // the artwork for the piggy bank changes.  Since the clipping area is intended to make the coins visible when
    // they are outside the bank but invisible inside, this must be drawn as a set of two shapes, one inside the
    // other, with the inner one drawn with the opposite winding order.
    const coinClipArea = Shape.rectangle(-100, -100, 200, 200);
    coinClipArea.moveTo(-20, -40);
    coinClipArea.lineTo(-20, 40);
    coinClipArea.lineTo(20, 40);
    coinClipArea.lineTo(20, -40);
    coinClipArea.close();
    coinAnimationLayer.clipArea = coinClipArea;

    // List of the active animations for coin motions.
    let activeAnimations = [];

    // Watch for when the balance changes due to interaction with the account balance buttons.
    balanceChangedByButtonEmitter.addListener(balanceChange => {
      assert && assert(Math.abs(balanceChange) === 1, 'balance changes from the button should always be 1 or -1');
      const isDeposit = balanceChange > 0;

      // Look for a non-visible coin node on the animation layer and only create one if nothing is available.  This
      // way of caching the previously created coin nodes helps to improve performance, see
      // https://github.com/phetsims/number-line-integers/issues/69.
      const coinNodes = coinAnimationLayer.getChildren();
      let coinNode = _.find(coinNodes, testCoinNode => !testCoinNode.visible);
      if (!coinNode) {
        // There aren't any invisible, previously created coin nodes available, so add a new one.
        coinNode = new CoinNode({
          centerX: COIN_NODE_X_POSITION,
          visible: false
        });
        coinAnimationLayer.addChild(coinNode);
      }
      const startY = isDeposit ? COIN_DEPOSIT_ANIMATION_START_Y : COIN_WITHDRAWAL_ANIMATION_START_Y;
      const endY = isDeposit ? COIN_DEPOSIT_ANIMATION_END_Y : COIN_WITHDRAWAL_ANIMATION_END_Y;
      if (isDeposit) {
        coinNode.moveToBack();
      } else {
        coinNode.moveToFront();
      }
      coinNode.visible = true;
      const coinMotionAnimation = new Animation({
        duration: COIN_ANIMATION_DURATION,
        easing: Easing.CUBIC_IN_OUT,
        setValue: value => {
          coinNode.centerY = value;
        },
        from: startY,
        to: endY
      });
      coinMotionAnimation.endedEmitter.addListener(() => {
        activeAnimations = _.without(activeAnimations, coinMotionAnimation);

        // Just hide the coin node so that we can reuse it later if needed.
        coinNode.visible = false;
      });
      activeAnimations.push(coinMotionAnimation);
      coinMotionAnimation.start();
    });
    this.visibleProperty.lazyLink(visible => {
      // Cancel any in-progress user interactions when this goes invisible.  This helps to prevent multi-touch issues,
      // see https://github.com/phetsims/number-line-integers/issues/106.
      if (!visible) {
        this.interruptSubtreeInput();
      }
    });
  }
}
class CoinNode extends Circle {
  /**
   * @param {Object} [options]
   * @public
   */
  constructor(options) {
    options = merge({
      stroke: Color.black,
      fill: COIN_COLOR
    }, options);
    super(COIN_RADIUS, options);

    // Add the currency marking.
    this.addChild(new Text(currencyUnitsString, {
      font: new PhetFont(18),
      center: Vector2.ZERO,
      maxWidth: 15
    }));
  }
}
numberLineIntegers.register('BankPointControllerNode', BankPointControllerNode);
export default BankPointControllerNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiU2hhcGUiLCJOTENDb25zdGFudHMiLCJQb2ludENvbnRyb2xsZXJOb2RlIiwiUGlnZ3lCYW5rRGVjb3JhdGlvbiIsIlBpZ2d5QmFua05vZGUiLCJtZXJnZSIsIlN0cmluZ1V0aWxzIiwiQmFja2dyb3VuZE5vZGUiLCJQaGV0Rm9udCIsIkNpcmNsZSIsIkNvbG9yIiwiTm9kZSIsIlRleHQiLCJBbmltYXRpb24iLCJFYXNpbmciLCJudW1iZXJMaW5lSW50ZWdlcnMiLCJOdW1iZXJMaW5lSW50ZWdlcnNTdHJpbmdzIiwiTUlOX1dJRFRIIiwiTUFYX1dJRFRIIiwiVE9VQ0hfRElMQVRJT04iLCJNT1NUX1BPU0lUSVZFX0ZJTEwiLCJ0b0NvbG9yIiwiTEVBU1RfUE9TSVRJVkVfRklMTCIsIk1PU1RfTkVHQVRJVkVfRklMTCIsIkxFQVNUX05FR0FUSVZFX0ZJTEwiLCJQT1NJVElWRV9BQlNPTFVURV9WQUxVRV9URVhUX0NPTE9SIiwiTkVHQVRJVkVfQUJTT0xVVEVfVkFMVUVfVEVYVF9DT0xPUiIsIkVNUFRZX0ZJTEwiLCJXSElURSIsIlpFUk9fRklMTCIsIkJMQUNLIiwiUkVBRE9VVF9ESVNUQU5DRV9GUk9NX0lNQUdFIiwiQ09JTl9SQURJVVMiLCJDT0lOX0NPTE9SIiwiQ09JTl9BTklNQVRJT05fRFVSQVRJT04iLCJiYWxhbmNlQW1vdW50U3RyaW5nIiwiYmFsYW5jZUFtb3VudCIsImN1cnJlbmN5VW5pdHNTdHJpbmciLCJjdXJyZW5jeVVuaXRzIiwiZGVidEFtb3VudFN0cmluZyIsImRlYnRBbW91bnQiLCJtb25leUFtb3VudFN0cmluZyIsIm1vbmV5QW1vdW50IiwiQ09JTl9ERVBPU0lUX0FOSU1BVElPTl9TVEFSVF9ZIiwiQ09JTl9ERVBPU0lUX0FOSU1BVElPTl9FTkRfWSIsIkNPSU5fV0lUSERSQVdBTF9BTklNQVRJT05fU1RBUlRfWSIsIkNPSU5fV0lUSERSQVdBTF9BTklNQVRJT05fRU5EX1kiLCJOVU1CRVJfT0ZfQ09JTlNfVE9fUFJFX0NSRUFURSIsIkNPSU5fTk9ERV9YX1BPU0lUSU9OIiwiQmFua1BvaW50Q29udHJvbGxlck5vZGUiLCJjb25zdHJ1Y3RvciIsInBvaW50Q29udHJvbGxlciIsImJhbGFuY2VDaGFuZ2VkQnlCdXR0b25FbWl0dGVyIiwiZGVjb3JhdGlvblR5cGUiLCJvcHRpb25zIiwiYXNzZXJ0Iiwibm9kZSIsImNvbnRyb2xsZXJOb2RlIiwicGlnZ3lCYW5rTm9kZSIsImFkZENoaWxkIiwiYmFsYW5jZU5vZGUiLCJmb250IiwiZmlsbCIsInN0cm9rZSIsImNlbnRlciIsIlpFUk8iLCJtYXhXaWR0aCIsInRvdWNoQXJlYSIsImJvdW5kcyIsImRpbGF0ZWQiLCJhYnNvbHV0ZVZhbHVlVGV4dCIsImFic29sdXRlVmFsdWVCYWNrZ3JvdW5kIiwiTEFCRUxfQkFDS0dST1VORF9PUFRJT05TIiwibnVtYmVyTGluZSIsIm51bWJlckxpbmVzIiwic2hvd0Fic29sdXRlVmFsdWVzUHJvcGVydHkiLCJsaW5rQXR0cmlidXRlIiwidXBkYXRlQWJzb2x1dGVWYWx1ZVJlYWRvdXRQb3NpdGlvbiIsIkZMT1dFUlMiLCJjZW50ZXJYIiwidG9wIiwieSIsImhlaWdodCIsImdldFNjYWxlVmVjdG9yIiwiYm90dG9tIiwidmFsdWVSYW5nZSIsImRpc3BsYXllZFJhbmdlUHJvcGVydHkiLCJ2YWx1ZSIsInVuc2NhbGVkV2lkdGgiLCJ3aWR0aCIsInVwZGF0ZUNvbnRyb2xsZXIiLCJudW1iZXJMaW5lUG9pbnRzIiwibGVuZ3RoIiwibnVtYmVyTGluZVBvaW50IiwiZ2V0IiwiY3VycmVudEJhbGFuY2UiLCJ2YWx1ZVByb3BlcnR5IiwiZGVzaXJlZFdpZHRoIiwiTWF0aCIsImFicyIsIm1heCIsInNldFNjYWxlTWFnbml0dWRlIiwiaW50ZXJwb2xhdGVSR0JBIiwibWluIiwic2lnbkluZGljYXRvciIsInN0cmluZyIsImZpbGxJbiIsImN1cnJlbmN5VW5pdCIsInN0cmluZ1RlbXBsYXRlIiwicG9zaXRpb25Qcm9wZXJ0eSIsImxpbmsiLCJjb2luQW5pbWF0aW9uTGF5ZXIiLCJfIiwidGltZXMiLCJDb2luTm9kZSIsInZpc2libGUiLCJjb2luQ2xpcEFyZWEiLCJyZWN0YW5nbGUiLCJtb3ZlVG8iLCJsaW5lVG8iLCJjbG9zZSIsImNsaXBBcmVhIiwiYWN0aXZlQW5pbWF0aW9ucyIsImFkZExpc3RlbmVyIiwiYmFsYW5jZUNoYW5nZSIsImlzRGVwb3NpdCIsImNvaW5Ob2RlcyIsImdldENoaWxkcmVuIiwiY29pbk5vZGUiLCJmaW5kIiwidGVzdENvaW5Ob2RlIiwic3RhcnRZIiwiZW5kWSIsIm1vdmVUb0JhY2siLCJtb3ZlVG9Gcm9udCIsImNvaW5Nb3Rpb25BbmltYXRpb24iLCJkdXJhdGlvbiIsImVhc2luZyIsIkNVQklDX0lOX09VVCIsInNldFZhbHVlIiwiY2VudGVyWSIsImZyb20iLCJ0byIsImVuZGVkRW1pdHRlciIsIndpdGhvdXQiLCJwdXNoIiwic3RhcnQiLCJ2aXNpYmxlUHJvcGVydHkiLCJsYXp5TGluayIsImludGVycnVwdFN1YnRyZWVJbnB1dCIsImJsYWNrIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJCYW5rUG9pbnRDb250cm9sbGVyTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBCYW5rUG9pbnRDb250cm9sbGVyTm9kZSBpcyBhIFNjZW5lcnkgbm9kZSB0aGF0IGlzIHVzZWQgdG8gY29udHJvbCBwb2ludCBwb3NpdGlvbnMgaW4gdGhlIFwiQmFua1wiIHNjZW5lIG9mIHRoZSBOdW1iZXJcclxuICogTGluZSBJbnRlZ2VycyBzaW1cclxuICpcclxuICogQGF1dGhvciBKb2huIEJsYW5jbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICogQGF1dGhvciBTYXVyYWJoIFRvdGV5XHJcbiAqL1xyXG5cclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBOTENDb25zdGFudHMgZnJvbSAnLi4vLi4vLi4vLi4vbnVtYmVyLWxpbmUtY29tbW9uL2pzL2NvbW1vbi9OTENDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgUG9pbnRDb250cm9sbGVyTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9udW1iZXItbGluZS1jb21tb24vanMvY29tbW9uL3ZpZXcvUG9pbnRDb250cm9sbGVyTm9kZS5qcyc7XHJcbmltcG9ydCBQaWdneUJhbmtEZWNvcmF0aW9uIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9qcy9leHBsb3JlL21vZGVsL1BpZ2d5QmFua0RlY29yYXRpb24uanMnO1xyXG5pbXBvcnQgUGlnZ3lCYW5rTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9udW1iZXItbGluZS1jb21tb24vanMvZXhwbG9yZS92aWV3L1BpZ2d5QmFua05vZGUuanMnO1xyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCBCYWNrZ3JvdW5kTm9kZSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvQmFja2dyb3VuZE5vZGUuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgQ2lyY2xlLCBDb2xvciwgTm9kZSwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBBbmltYXRpb24gZnJvbSAnLi4vLi4vLi4vLi4vdHdpeHQvanMvQW5pbWF0aW9uLmpzJztcclxuaW1wb3J0IEVhc2luZyBmcm9tICcuLi8uLi8uLi8uLi90d2l4dC9qcy9FYXNpbmcuanMnO1xyXG5pbXBvcnQgbnVtYmVyTGluZUludGVnZXJzIGZyb20gJy4uLy4uL251bWJlckxpbmVJbnRlZ2Vycy5qcyc7XHJcbmltcG9ydCBOdW1iZXJMaW5lSW50ZWdlcnNTdHJpbmdzIGZyb20gJy4uLy4uL051bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3MuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IE1JTl9XSURUSCA9IDgwOyAvLyBzY3JlZW4gY29vcmRzLCBlbXBpcmljYWxseSBkZXRlcm1pbmVkXHJcbmNvbnN0IE1BWF9XSURUSCA9IDIwMDsgLy8gc2NyZWVuIGNvb3JkcywgZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG5jb25zdCBUT1VDSF9ESUxBVElPTiA9IDc7IC8vIGRpbGF0ZXMgcGlnZ3kgYmFua3MgZW5vdWdoIHRvIG5vdCBvdmVybGFwIHRvdWNoIGFyZWFzIHdpdGggYWNjb3VudCBiYWxhbmNlIGJ1dHRvbnNcclxuY29uc3QgTU9TVF9QT1NJVElWRV9GSUxMID0gQ29sb3IudG9Db2xvciggJyMxZmI0OTMnICk7XHJcbmNvbnN0IExFQVNUX1BPU0lUSVZFX0ZJTEwgPSBDb2xvci50b0NvbG9yKCAnI2E1ZTFkNCcgKTtcclxuY29uc3QgTU9TVF9ORUdBVElWRV9GSUxMID0gQ29sb3IudG9Db2xvciggJyNmYjFkMjUnICk7XHJcbmNvbnN0IExFQVNUX05FR0FUSVZFX0ZJTEwgPSBDb2xvci50b0NvbG9yKCAnI2ZkYTVhOCcgKTtcclxuY29uc3QgUE9TSVRJVkVfQUJTT0xVVEVfVkFMVUVfVEVYVF9DT0xPUiA9ICcjMGU5NzdiJztcclxuY29uc3QgTkVHQVRJVkVfQUJTT0xVVEVfVkFMVUVfVEVYVF9DT0xPUiA9IE1PU1RfTkVHQVRJVkVfRklMTDtcclxuY29uc3QgRU1QVFlfRklMTCA9IENvbG9yLldISVRFO1xyXG5jb25zdCBaRVJPX0ZJTEwgPSBDb2xvci5CTEFDSztcclxuY29uc3QgUkVBRE9VVF9ESVNUQU5DRV9GUk9NX0lNQUdFID0gNTtcclxuY29uc3QgQ09JTl9SQURJVVMgPSAxMDtcclxuY29uc3QgQ09JTl9DT0xPUiA9IG5ldyBDb2xvciggMjEzLCAxOTYsIDM5ICk7XHJcbmNvbnN0IENPSU5fQU5JTUFUSU9OX0RVUkFUSU9OID0gMC41OyAvLyBzZWNvbmRzXHJcblxyXG5jb25zdCBiYWxhbmNlQW1vdW50U3RyaW5nID0gTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncy5iYWxhbmNlQW1vdW50O1xyXG5jb25zdCBjdXJyZW5jeVVuaXRzU3RyaW5nID0gTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncy5jdXJyZW5jeVVuaXRzO1xyXG5jb25zdCBkZWJ0QW1vdW50U3RyaW5nID0gTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncy5kZWJ0QW1vdW50O1xyXG5jb25zdCBtb25leUFtb3VudFN0cmluZyA9IE51bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3MubW9uZXlBbW91bnQ7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgQ09JTl9ERVBPU0lUX0FOSU1BVElPTl9TVEFSVF9ZID0gLTYwOyAvLyBhYm92ZSB0aGUgcGlnZ3kgYmFuaywgaW4gc2NyZWVuIGNvb3JkaW5hdGVzLCBlbXBpcmljYWxseSBkZXRlcm1pbmVkXHJcbmNvbnN0IENPSU5fREVQT1NJVF9BTklNQVRJT05fRU5EX1kgPSAwOyAvLyBpbnNpZGUgdGhlIHBpZ2d5IGJhbmssIGluIHNjcmVlbiBjb29yZGluYXRlcywgZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG5jb25zdCBDT0lOX1dJVEhEUkFXQUxfQU5JTUFUSU9OX1NUQVJUX1kgPSAzMDsgLy8gaW5zaWRlIHRoZSBwaWdneSBiYW5rLCBpbiBzY3JlZW4gY29vcmRpbmF0ZXMsIGVtcGlyaWNhbGx5IGRldGVybWluZWRcclxuY29uc3QgQ09JTl9XSVRIRFJBV0FMX0FOSU1BVElPTl9FTkRfWSA9IDYwOyAvLyBiZWxvdyB0aGUgcGlnZ3kgYmFuaywgaW4gc2NyZWVuIGNvb3JkaW5hdGVzLCBlbXBpcmljYWxseSBkZXRlcm1pbmVkXHJcbmNvbnN0IE5VTUJFUl9PRl9DT0lOU19UT19QUkVfQ1JFQVRFID0gMjA7IC8vIG51bWJlciBvZiBjb2lucyB0byBjcmVhdGUgZm9yIGFuaW1hdGlvbiwgZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG5jb25zdCBDT0lOX05PREVfWF9QT1NJVElPTiA9IC0zO1xyXG5cclxuY2xhc3MgQmFua1BvaW50Q29udHJvbGxlck5vZGUgZXh0ZW5kcyBQb2ludENvbnRyb2xsZXJOb2RlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtQb2ludENvbnRyb2xsZXJ9IHBvaW50Q29udHJvbGxlclxyXG4gICAqIEBwYXJhbSB7RW1pdHRlcn0gYmFsYW5jZUNoYW5nZWRCeUJ1dHRvbkVtaXR0ZXJcclxuICAgKiBAcGFyYW0ge1BpZ2d5QmFua0RlY29yYXRpb259IGRlY29yYXRpb25UeXBlIC0gaW5kaWNhdGVzIGFydHdvcmsgb24gYmFua1xyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIHBvaW50Q29udHJvbGxlciwgYmFsYW5jZUNoYW5nZWRCeUJ1dHRvbkVtaXR0ZXIsIGRlY29yYXRpb25UeXBlLCBvcHRpb25zICkge1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICFvcHRpb25zIHx8ICFvcHRpb25zLm5vZGUsICdvcHRpb25zIHNob3VsZCBub3QgaW5jbHVkZSBhIG5vZGUgZm9yIHRoaXMgY29uc3RydWN0b3InICk7XHJcblxyXG4gICAgLy8gcm9vdCBub2RlIGZvciBkcmFnZ2FibGUgY29udHJvbGxlciBwb3J0aW9uLCBzZXBhcmF0ZSBmb3IgYWJzb2x1dGUgdmFsdWUgZGlzcGxheSBhbmQgY29pbiBhbmltYXRpb25cclxuICAgIGNvbnN0IGNvbnRyb2xsZXJOb2RlID0gbmV3IE5vZGUoKTtcclxuXHJcbiAgICAvLyBDaG9vc2UgdGhlIG92ZXJsYXkgaW1hZ2Ugc291cmNlLCB3aGljaCBpcyBhcnR3b3JrIHRoYXQgbXVzdCBleGFjdGx5IG1hdGNoIHRoZSBzaGFwZSBvZiB0aGUgb3V0bGluZS5cclxuICAgIGNvbnN0IHBpZ2d5QmFua05vZGUgPSBuZXcgUGlnZ3lCYW5rTm9kZSggeyBkZWNvcmF0aW9uVHlwZTogZGVjb3JhdGlvblR5cGUgfSApO1xyXG4gICAgY29udHJvbGxlck5vZGUuYWRkQ2hpbGQoIHBpZ2d5QmFua05vZGUgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGJhbGFuY2UgaW5kaWNhdG9yIG5vZGUuXHJcbiAgICBjb25zdCBiYWxhbmNlTm9kZSA9IG5ldyBUZXh0KCAnJywge1xyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIDMwICksXHJcbiAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICAgIHN0cm9rZTogJ2JsYWNrJyxcclxuICAgICAgY2VudGVyOiBWZWN0b3IyLlpFUk8sXHJcbiAgICAgIG1heFdpZHRoOiA2NVxyXG4gICAgfSApO1xyXG4gICAgY29udHJvbGxlck5vZGUuYWRkQ2hpbGQoIGJhbGFuY2VOb2RlICk7XHJcblxyXG4gICAgLy8gZGlsYXRlcyB0aGUgdG91Y2ggYXJlYSBmb3IgdGhlIGNvbnRyb2xsZXJOb2RlXHJcbiAgICBjb250cm9sbGVyTm9kZS50b3VjaEFyZWEgPSBjb250cm9sbGVyTm9kZS5ib3VuZHMuZGlsYXRlZCggVE9VQ0hfRElMQVRJT04gKTtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHsgbm9kZTogY29udHJvbGxlck5vZGUgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBwb2ludENvbnRyb2xsZXIsIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyB0aGUgcmVhZG91dCB0aGF0IHdpbGwgZGlzcGxheSB0aGUgYWJzb2x1dGUgdmFsdWUgaW4gYSBwaHJhc2VcclxuICAgIGNvbnN0IGFic29sdXRlVmFsdWVUZXh0ID0gbmV3IFRleHQoICcnLCB7IGZvbnQ6IG5ldyBQaGV0Rm9udCggMTggKSwgbWF4V2lkdGg6IDI1MCB9ICk7XHJcbiAgICBjb25zdCBhYnNvbHV0ZVZhbHVlQmFja2dyb3VuZCA9IG5ldyBCYWNrZ3JvdW5kTm9kZSggYWJzb2x1dGVWYWx1ZVRleHQsIE5MQ0NvbnN0YW50cy5MQUJFTF9CQUNLR1JPVU5EX09QVElPTlMgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGFic29sdXRlVmFsdWVCYWNrZ3JvdW5kICk7XHJcblxyXG4gICAgLy8gR2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBudW1iZXIgbGluZSAodGhlcmUgaXMgb25seSBvbmUgZm9yIHRoaXMgc2NlbmUpLlxyXG4gICAgY29uc3QgbnVtYmVyTGluZSA9IHBvaW50Q29udHJvbGxlci5udW1iZXJMaW5lc1sgMCBdO1xyXG5cclxuICAgIC8vIENvbnRyb2wgdmlzaWJpbGl0eSBvZiB0aGUgYWJzb2x1dGUgdmFsdWUgcmVhZG91dC5cclxuICAgIG51bWJlckxpbmUuc2hvd0Fic29sdXRlVmFsdWVzUHJvcGVydHkubGlua0F0dHJpYnV0ZSggYWJzb2x1dGVWYWx1ZUJhY2tncm91bmQsICd2aXNpYmxlJyApO1xyXG5cclxuICAgIC8vIFVwZGF0ZSB0aGUgcG9zaXRpb24gb2YgdGhlIGFic29sdXRlIHZhbHVlIHJlYWRvdXQgKGkuZS4gdGhlIHRleHQgbm9kZSB0aGF0IHNheXMgdGhpbmdzIGxpa2UsIFwiYmFsYW5jZSBvZiAkMlwiLlxyXG4gICAgY29uc3QgdXBkYXRlQWJzb2x1dGVWYWx1ZVJlYWRvdXRQb3NpdGlvbiA9ICgpID0+IHtcclxuICAgICAgaWYgKCBkZWNvcmF0aW9uVHlwZSA9PT0gUGlnZ3lCYW5rRGVjb3JhdGlvbi5GTE9XRVJTICkge1xyXG4gICAgICAgIGFic29sdXRlVmFsdWVCYWNrZ3JvdW5kLmNlbnRlclggPSBjb250cm9sbGVyTm9kZS5jZW50ZXJYIC0gOTsgLy8gdHdlYWtlZCBhIGJpdCB0byBiZSBjZW50ZXJlZCB1bmRlciBmZWV0XHJcbiAgICAgICAgYWJzb2x1dGVWYWx1ZUJhY2tncm91bmQudG9wID0gY29udHJvbGxlck5vZGUueSArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlnZ3lCYW5rTm9kZS5oZWlnaHQgLyAyICogY29udHJvbGxlck5vZGUuZ2V0U2NhbGVWZWN0b3IoKS55ICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSRUFET1VUX0RJU1RBTkNFX0ZST01fSU1BR0U7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgYWJzb2x1dGVWYWx1ZUJhY2tncm91bmQuY2VudGVyWCA9IGNvbnRyb2xsZXJOb2RlLmNlbnRlclggLSAyOyAvLyB0d2Vha2VkIGEgYml0IHRvIGJlIGNlbnRlcmVkIG92ZXIgY29pbiBzbG90XHJcbiAgICAgICAgYWJzb2x1dGVWYWx1ZUJhY2tncm91bmQuYm90dG9tID0gY29udHJvbGxlck5vZGUueSAtXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlnZ3lCYW5rTm9kZS5oZWlnaHQgLyAyICogY29udHJvbGxlck5vZGUuZ2V0U2NhbGVWZWN0b3IoKS55IC1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSRUFET1VUX0RJU1RBTkNFX0ZST01fSU1BR0U7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gVXBkYXRlIHRoZSBub2RlJ3MgYXBwZWFyYW5jZSBhcyBpdHMgcG9zaXRpb24gY2hhbmdlcy5cclxuICAgIGNvbnN0IHZhbHVlUmFuZ2UgPSBudW1iZXJMaW5lLmRpc3BsYXllZFJhbmdlUHJvcGVydHkudmFsdWU7XHJcbiAgICBjb25zdCB1bnNjYWxlZFdpZHRoID0gY29udHJvbGxlck5vZGUud2lkdGg7XHJcbiAgICBjb25zdCB1cGRhdGVDb250cm9sbGVyID0gKCkgPT4ge1xyXG5cclxuICAgICAgaWYgKCBwb2ludENvbnRyb2xsZXIubnVtYmVyTGluZVBvaW50cy5sZW5ndGggPiAwICkge1xyXG5cclxuICAgICAgICAvLyBzdGF0ZSBjaGVja2luZ1xyXG4gICAgICAgIGFzc2VydCAmJiBhc3NlcnQoXHJcbiAgICAgICAgICBwb2ludENvbnRyb2xsZXIubnVtYmVyTGluZVBvaW50cy5sZW5ndGggPT09IDEsXHJcbiAgICAgICAgICAncG9pbnQgY29udHJvbGxlcnMgaW4gdGhlIGJhbmsgc2NlbmUgc2hvdWxkIG5ldmVyIGNvbnRyb2wgbXVsdGlwbGUgcG9pbnRzJ1xyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIC8vIHZhcmlhYmxlcyBuZWVkZWQgdG8gbWFrZSB0aGUgdXBkYXRlc1xyXG4gICAgICAgIGNvbnN0IG51bWJlckxpbmVQb2ludCA9IHBvaW50Q29udHJvbGxlci5udW1iZXJMaW5lUG9pbnRzLmdldCggMCApO1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRCYWxhbmNlID0gbnVtYmVyTGluZVBvaW50LnZhbHVlUHJvcGVydHkudmFsdWU7XHJcblxyXG4gICAgICAgIC8vIFNjYWxlIHRoZSBzaXplLlxyXG4gICAgICAgIGNvbnN0IGRlc2lyZWRXaWR0aCA9IE1JTl9XSURUSCArICggTWF0aC5hYnMoIGN1cnJlbnRCYWxhbmNlICkgLyB2YWx1ZVJhbmdlLm1heCApICogKCBNQVhfV0lEVEggLSBNSU5fV0lEVEggKTtcclxuICAgICAgICBjb250cm9sbGVyTm9kZS5zZXRTY2FsZU1hZ25pdHVkZSggZGVzaXJlZFdpZHRoIC8gdW5zY2FsZWRXaWR0aCApO1xyXG5cclxuICAgICAgICAvLyBVcGRhdGUgdGhlIGNvbG9yIG9mIHRoZSBwb2ludCBhbmQgdGhlIG5vZGUncyBmaWxsLlxyXG4gICAgICAgIGxldCBmaWxsID0gRU1QVFlfRklMTDtcclxuICAgICAgICBpZiAoIGN1cnJlbnRCYWxhbmNlIDwgMCApIHtcclxuICAgICAgICAgIGZpbGwgPSBDb2xvci5pbnRlcnBvbGF0ZVJHQkEoXHJcbiAgICAgICAgICAgIExFQVNUX05FR0FUSVZFX0ZJTEwsXHJcbiAgICAgICAgICAgIE1PU1RfTkVHQVRJVkVfRklMTCxcclxuICAgICAgICAgICAgY3VycmVudEJhbGFuY2UgLyB2YWx1ZVJhbmdlLm1pblxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIGN1cnJlbnRCYWxhbmNlID4gMCApIHtcclxuICAgICAgICAgIGZpbGwgPSBDb2xvci5pbnRlcnBvbGF0ZVJHQkEoXHJcbiAgICAgICAgICAgIExFQVNUX1BPU0lUSVZFX0ZJTEwsXHJcbiAgICAgICAgICAgIE1PU1RfUE9TSVRJVkVfRklMTCxcclxuICAgICAgICAgICAgY3VycmVudEJhbGFuY2UgLyB2YWx1ZVJhbmdlLm1heFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcGlnZ3lCYW5rTm9kZS5maWxsID0gZmlsbDtcclxuXHJcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBiYWxhbmNlIGluZGljYXRvciB0ZXh0LlxyXG4gICAgICAgIGNvbnN0IHNpZ25JbmRpY2F0b3IgPSBjdXJyZW50QmFsYW5jZSA8IDAgPyAnLScgOiAnJztcclxuICAgICAgICBiYWxhbmNlTm9kZS5zdHJpbmcgPSBzaWduSW5kaWNhdG9yICsgU3RyaW5nVXRpbHMuZmlsbEluKCBtb25leUFtb3VudFN0cmluZywge1xyXG4gICAgICAgICAgY3VycmVuY3lVbml0OiBjdXJyZW5jeVVuaXRzU3RyaW5nLFxyXG4gICAgICAgICAgdmFsdWU6IE1hdGguYWJzKCBjdXJyZW50QmFsYW5jZSApXHJcbiAgICAgICAgfSApO1xyXG4gICAgICAgIGJhbGFuY2VOb2RlLmNlbnRlciA9IFZlY3RvcjIuWkVSTztcclxuXHJcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBhYnNvbHV0ZSB2YWx1ZSByZWFkb3V0LlxyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gbnVtYmVyTGluZVBvaW50LnZhbHVlUHJvcGVydHkudmFsdWU7XHJcbiAgICAgICAgbGV0IHN0cmluZ1RlbXBsYXRlO1xyXG4gICAgICAgIGlmICggdmFsdWUgPCAwICkge1xyXG4gICAgICAgICAgc3RyaW5nVGVtcGxhdGUgPSBkZWJ0QW1vdW50U3RyaW5nO1xyXG4gICAgICAgICAgYWJzb2x1dGVWYWx1ZVRleHQuZmlsbCA9IE5FR0FUSVZFX0FCU09MVVRFX1ZBTFVFX1RFWFRfQ09MT1I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgc3RyaW5nVGVtcGxhdGUgPSBiYWxhbmNlQW1vdW50U3RyaW5nO1xyXG4gICAgICAgICAgYWJzb2x1dGVWYWx1ZVRleHQuZmlsbCA9IHZhbHVlID4gMCA/IFBPU0lUSVZFX0FCU09MVVRFX1ZBTFVFX1RFWFRfQ09MT1IgOiBaRVJPX0ZJTEw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGFic29sdXRlVmFsdWVUZXh0LnN0cmluZyA9IFN0cmluZ1V0aWxzLmZpbGxJbiggc3RyaW5nVGVtcGxhdGUsIHsgdmFsdWU6IE1hdGguYWJzKCB2YWx1ZSApIH0gKTtcclxuICAgICAgICB1cGRhdGVBYnNvbHV0ZVZhbHVlUmVhZG91dFBvc2l0aW9uKCk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBwb2ludENvbnRyb2xsZXIucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCB1cGRhdGVDb250cm9sbGVyICk7XHJcblxyXG4gICAgLy8gaW1tZWRpYXRlbHkgY2FsbGVkIHNvIHRoYXQgYWJzb2x1dGUgdmFsdWUgdGV4dHMgYXJlIHBvc2l0aW9uZWQgY29ycmVjdGx5XHJcbiAgICB1cGRhdGVDb250cm9sbGVyKCk7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBsYXllciB3aGVyZSB0aGUgY29pbiBhbmltYXRpb25zIHdpbGwgb2NjdXIuXHJcbiAgICBjb25zdCBjb2luQW5pbWF0aW9uTGF5ZXIgPSBuZXcgTm9kZSgpO1xyXG4gICAgY29udHJvbGxlck5vZGUuYWRkQ2hpbGQoIGNvaW5BbmltYXRpb25MYXllciApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgY29pbnMgbm93IHNvIHRoYXQgdGhleSBkb24ndCBoYXZlIHRvIGJlIGFkZGVkIG9uIHRoZSBmbHkgZHVyaW5nIHRoZSBhbmltYXRpb24uXHJcbiAgICBfLnRpbWVzKCBOVU1CRVJfT0ZfQ09JTlNfVE9fUFJFX0NSRUFURSwgKCkgPT4ge1xyXG4gICAgICBjb2luQW5pbWF0aW9uTGF5ZXIuYWRkQ2hpbGQoIG5ldyBDb2luTm9kZSggeyBjZW50ZXJYOiBDT0lOX05PREVfWF9QT1NJVElPTiwgdmlzaWJsZTogZmFsc2UgfSApICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQWRkIGEgY2xpcHBpbmcgYXJlYSBzbyB0aGF0IHRoZSBjb2lucyBsb29rIGxpa2UgdGhleSBhcmUgZ29pbmcgaW4gYW5kIG91dC4gIFRoaXMgbXVzdCBiZSBtYW51YWxseSB1cGRhdGVkIGlmXHJcbiAgICAvLyB0aGUgYXJ0d29yayBmb3IgdGhlIHBpZ2d5IGJhbmsgY2hhbmdlcy4gIFNpbmNlIHRoZSBjbGlwcGluZyBhcmVhIGlzIGludGVuZGVkIHRvIG1ha2UgdGhlIGNvaW5zIHZpc2libGUgd2hlblxyXG4gICAgLy8gdGhleSBhcmUgb3V0c2lkZSB0aGUgYmFuayBidXQgaW52aXNpYmxlIGluc2lkZSwgdGhpcyBtdXN0IGJlIGRyYXduIGFzIGEgc2V0IG9mIHR3byBzaGFwZXMsIG9uZSBpbnNpZGUgdGhlXHJcbiAgICAvLyBvdGhlciwgd2l0aCB0aGUgaW5uZXIgb25lIGRyYXduIHdpdGggdGhlIG9wcG9zaXRlIHdpbmRpbmcgb3JkZXIuXHJcbiAgICBjb25zdCBjb2luQ2xpcEFyZWEgPSBTaGFwZS5yZWN0YW5nbGUoIC0xMDAsIC0xMDAsIDIwMCwgMjAwICk7XHJcbiAgICBjb2luQ2xpcEFyZWEubW92ZVRvKCAtMjAsIC00MCApO1xyXG4gICAgY29pbkNsaXBBcmVhLmxpbmVUbyggLTIwLCA0MCApO1xyXG4gICAgY29pbkNsaXBBcmVhLmxpbmVUbyggMjAsIDQwICk7XHJcbiAgICBjb2luQ2xpcEFyZWEubGluZVRvKCAyMCwgLTQwICk7XHJcbiAgICBjb2luQ2xpcEFyZWEuY2xvc2UoKTtcclxuICAgIGNvaW5BbmltYXRpb25MYXllci5jbGlwQXJlYSA9IGNvaW5DbGlwQXJlYTtcclxuXHJcbiAgICAvLyBMaXN0IG9mIHRoZSBhY3RpdmUgYW5pbWF0aW9ucyBmb3IgY29pbiBtb3Rpb25zLlxyXG4gICAgbGV0IGFjdGl2ZUFuaW1hdGlvbnMgPSBbXTtcclxuXHJcbiAgICAvLyBXYXRjaCBmb3Igd2hlbiB0aGUgYmFsYW5jZSBjaGFuZ2VzIGR1ZSB0byBpbnRlcmFjdGlvbiB3aXRoIHRoZSBhY2NvdW50IGJhbGFuY2UgYnV0dG9ucy5cclxuICAgIGJhbGFuY2VDaGFuZ2VkQnlCdXR0b25FbWl0dGVyLmFkZExpc3RlbmVyKCBiYWxhbmNlQ2hhbmdlID0+IHtcclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggTWF0aC5hYnMoIGJhbGFuY2VDaGFuZ2UgKSA9PT0gMSwgJ2JhbGFuY2UgY2hhbmdlcyBmcm9tIHRoZSBidXR0b24gc2hvdWxkIGFsd2F5cyBiZSAxIG9yIC0xJyApO1xyXG4gICAgICBjb25zdCBpc0RlcG9zaXQgPSBiYWxhbmNlQ2hhbmdlID4gMDtcclxuXHJcbiAgICAgIC8vIExvb2sgZm9yIGEgbm9uLXZpc2libGUgY29pbiBub2RlIG9uIHRoZSBhbmltYXRpb24gbGF5ZXIgYW5kIG9ubHkgY3JlYXRlIG9uZSBpZiBub3RoaW5nIGlzIGF2YWlsYWJsZS4gIFRoaXNcclxuICAgICAgLy8gd2F5IG9mIGNhY2hpbmcgdGhlIHByZXZpb3VzbHkgY3JlYXRlZCBjb2luIG5vZGVzIGhlbHBzIHRvIGltcHJvdmUgcGVyZm9ybWFuY2UsIHNlZVxyXG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvbnVtYmVyLWxpbmUtaW50ZWdlcnMvaXNzdWVzLzY5LlxyXG4gICAgICBjb25zdCBjb2luTm9kZXMgPSBjb2luQW5pbWF0aW9uTGF5ZXIuZ2V0Q2hpbGRyZW4oKTtcclxuICAgICAgbGV0IGNvaW5Ob2RlID0gXy5maW5kKCBjb2luTm9kZXMsIHRlc3RDb2luTm9kZSA9PiAhdGVzdENvaW5Ob2RlLnZpc2libGUgKTtcclxuICAgICAgaWYgKCAhY29pbk5vZGUgKSB7XHJcblxyXG4gICAgICAgIC8vIFRoZXJlIGFyZW4ndCBhbnkgaW52aXNpYmxlLCBwcmV2aW91c2x5IGNyZWF0ZWQgY29pbiBub2RlcyBhdmFpbGFibGUsIHNvIGFkZCBhIG5ldyBvbmUuXHJcbiAgICAgICAgY29pbk5vZGUgPSBuZXcgQ29pbk5vZGUoIHsgY2VudGVyWDogQ09JTl9OT0RFX1hfUE9TSVRJT04sIHZpc2libGU6IGZhbHNlIH0gKTtcclxuICAgICAgICBjb2luQW5pbWF0aW9uTGF5ZXIuYWRkQ2hpbGQoIGNvaW5Ob2RlICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHN0YXJ0WSA9IGlzRGVwb3NpdCA/IENPSU5fREVQT1NJVF9BTklNQVRJT05fU1RBUlRfWSA6IENPSU5fV0lUSERSQVdBTF9BTklNQVRJT05fU1RBUlRfWTtcclxuICAgICAgY29uc3QgZW5kWSA9IGlzRGVwb3NpdCA/IENPSU5fREVQT1NJVF9BTklNQVRJT05fRU5EX1kgOiBDT0lOX1dJVEhEUkFXQUxfQU5JTUFUSU9OX0VORF9ZO1xyXG4gICAgICBpZiAoIGlzRGVwb3NpdCApIHtcclxuICAgICAgICBjb2luTm9kZS5tb3ZlVG9CYWNrKCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgY29pbk5vZGUubW92ZVRvRnJvbnQoKTtcclxuICAgICAgfVxyXG4gICAgICBjb2luTm9kZS52aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgY29uc3QgY29pbk1vdGlvbkFuaW1hdGlvbiA9IG5ldyBBbmltYXRpb24oIHtcclxuICAgICAgICBkdXJhdGlvbjogQ09JTl9BTklNQVRJT05fRFVSQVRJT04sXHJcbiAgICAgICAgZWFzaW5nOiBFYXNpbmcuQ1VCSUNfSU5fT1VULFxyXG4gICAgICAgIHNldFZhbHVlOiB2YWx1ZSA9PiB7IGNvaW5Ob2RlLmNlbnRlclkgPSB2YWx1ZTsgfSxcclxuICAgICAgICBmcm9tOiBzdGFydFksXHJcbiAgICAgICAgdG86IGVuZFlcclxuICAgICAgfSApO1xyXG4gICAgICBjb2luTW90aW9uQW5pbWF0aW9uLmVuZGVkRW1pdHRlci5hZGRMaXN0ZW5lciggKCkgPT4ge1xyXG4gICAgICAgIGFjdGl2ZUFuaW1hdGlvbnMgPSBfLndpdGhvdXQoIGFjdGl2ZUFuaW1hdGlvbnMsIGNvaW5Nb3Rpb25BbmltYXRpb24gKTtcclxuXHJcbiAgICAgICAgLy8gSnVzdCBoaWRlIHRoZSBjb2luIG5vZGUgc28gdGhhdCB3ZSBjYW4gcmV1c2UgaXQgbGF0ZXIgaWYgbmVlZGVkLlxyXG4gICAgICAgIGNvaW5Ob2RlLnZpc2libGUgPSBmYWxzZTtcclxuICAgICAgfSApO1xyXG4gICAgICBhY3RpdmVBbmltYXRpb25zLnB1c2goIGNvaW5Nb3Rpb25BbmltYXRpb24gKTtcclxuICAgICAgY29pbk1vdGlvbkFuaW1hdGlvbi5zdGFydCgpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMudmlzaWJsZVByb3BlcnR5LmxhenlMaW5rKCB2aXNpYmxlID0+IHtcclxuXHJcbiAgICAgIC8vIENhbmNlbCBhbnkgaW4tcHJvZ3Jlc3MgdXNlciBpbnRlcmFjdGlvbnMgd2hlbiB0aGlzIGdvZXMgaW52aXNpYmxlLiAgVGhpcyBoZWxwcyB0byBwcmV2ZW50IG11bHRpLXRvdWNoIGlzc3VlcyxcclxuICAgICAgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9udW1iZXItbGluZS1pbnRlZ2Vycy9pc3N1ZXMvMTA2LlxyXG4gICAgICBpZiAoICF2aXNpYmxlICkge1xyXG4gICAgICAgIHRoaXMuaW50ZXJydXB0U3VidHJlZUlucHV0KCk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIENvaW5Ob2RlIGV4dGVuZHMgQ2lyY2xlIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvciggb3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHsgc3Ryb2tlOiBDb2xvci5ibGFjaywgZmlsbDogQ09JTl9DT0xPUiB9LCBvcHRpb25zICk7XHJcbiAgICBzdXBlciggQ09JTl9SQURJVVMsIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIGN1cnJlbmN5IG1hcmtpbmcuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBuZXcgVGV4dCggY3VycmVuY3lVbml0c1N0cmluZywge1xyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIDE4ICksXHJcbiAgICAgIGNlbnRlcjogVmVjdG9yMi5aRVJPLFxyXG4gICAgICBtYXhXaWR0aDogMTVcclxuICAgIH0gKSApO1xyXG4gIH1cclxufVxyXG5cclxubnVtYmVyTGluZUludGVnZXJzLnJlZ2lzdGVyKCAnQmFua1BvaW50Q29udHJvbGxlck5vZGUnLCBCYW5rUG9pbnRDb250cm9sbGVyTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBCYW5rUG9pbnRDb250cm9sbGVyTm9kZTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFDdEQsT0FBT0MsWUFBWSxNQUFNLDBEQUEwRDtBQUNuRixPQUFPQyxtQkFBbUIsTUFBTSxzRUFBc0U7QUFDdEcsT0FBT0MsbUJBQW1CLE1BQU0sd0VBQXdFO0FBQ3hHLE9BQU9DLGFBQWEsTUFBTSxpRUFBaUU7QUFDM0YsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxPQUFPQyxXQUFXLE1BQU0sK0NBQStDO0FBQ3ZFLE9BQU9DLGNBQWMsTUFBTSwrQ0FBK0M7QUFDMUUsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxTQUFTQyxNQUFNLEVBQUVDLEtBQUssRUFBRUMsSUFBSSxFQUFFQyxJQUFJLFFBQVEs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