// Copyright 2019-2022, University of Colorado Boulder

/**
 * A scenery node that is used to control point positions in the temperature scene based on the temperature of the map
 * below this node.  It looks like a thermometer with a triangular pointer next to it.
 *
 * @author Arnab Purkayastha
 * @author Saurabh Totey
 * @author John Blanco (PhET Interactive Simulations)
 */

import Multilink from '../../../../axon/js/Multilink.js';
import StringProperty from '../../../../axon/js/StringProperty.js';
import Range from '../../../../dot/js/Range.js';
import ColorizedReadoutNode from '../../../../number-line-common/js/common/view/ColorizedReadoutNode.js';
import PointControllerNode from '../../../../number-line-common/js/common/view/PointControllerNode.js';
import merge from '../../../../phet-core/js/merge.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import TemperatureAndColorSensorNode from '../../../../scenery-phet/js/TemperatureAndColorSensorNode.js';
import { Color, Node, Text } from '../../../../scenery/js/imports.js';
import NLIConstants from '../../common/NLIConstants.js';
import numberLineIntegers from '../../numberLineIntegers.js';
import NumberLineIntegersStrings from '../../NumberLineIntegersStrings.js';

// constants
const TOUCH_DILATION = 5;
const TEMPERATURE_RANGE = new Range(-85, 104); // determined based on the temperature data that was used

const negativeTemperatureAmountString = NumberLineIntegersStrings.negativeTemperatureAmount;
const positiveTemperatureAmountString = NumberLineIntegersStrings.positiveTemperatureAmount;
const zeroTemperatureAmountString = NumberLineIntegersStrings.zeroTemperatureAmount;
class TemperaturePointControllerNode extends PointControllerNode {
  /**
   * @param {TemperaturePointController} pointController
   * @param {BooleanProperty} showAbsoluteValuesProperty
   * @param {Property} temperatureUnitsProperty - whether temperature is being shown in Celsius or Fahrenheit
   * @param {Object} [options]
   * @public
   */
  constructor(pointController, showAbsoluteValuesProperty, temperatureUnitsProperty, options) {
    // Create a node that contains thermometer and triangle.
    const compositeThermometerNode = new Node();
    options = merge({
      node: compositeThermometerNode,
      connectorLine: false
    }, options);
    const temperatureAndColorSensorNode = new TemperatureAndColorSensorNode(pointController.fahrenheitTemperatureProperty, TEMPERATURE_RANGE, pointController.colorProperty, {
      thermometerNodeOptions: {
        fluidMainColor: new Color(0, 120, 0),
        fluidHighlightColor: new Color(0, 210, 0),
        backgroundFill: 'rgba( 255, 255, 255, 0.9 )',
        tickSpacingTemperature: 20,
        majorTickLength: 0,
        minorTickLength: 0
      }
    });
    compositeThermometerNode.addChild(temperatureAndColorSensorNode);

    // Add the textual label for this thermometer, generally a single letter.
    const thermometerLabel = new Text(pointController.label, {
      font: new PhetFont(16),
      centerX: temperatureAndColorSensorNode.thermometerBounds.centerX,
      top: temperatureAndColorSensorNode.top + 4,
      // offset empirically determined
      maxWidth: temperatureAndColorSensorNode.width * 0.25 // multiplier empirically determined
    });

    compositeThermometerNode.addChild(thermometerLabel);

    // Add a readout that will describe the temperature textually, e.g. "20Â° above 0".
    const temperatureReadoutStringProperty = new StringProperty('');
    const temperatureReadout = new ColorizedReadoutNode(temperatureReadoutStringProperty, pointController.colorProperty, {
      left: temperatureAndColorSensorNode.right + 3,
      centerY: 0,
      textOptions: {
        font: new PhetFont(18),
        maxWidth: 250
      }
    });
    compositeThermometerNode.addChild(temperatureReadout);

    // Control the visibility of the textual label, no unlink needed because these point controllers are permanent.
    Multilink.multilink([showAbsoluteValuesProperty, pointController.isOverMapProperty], (showAbsoluteValues, isOverMap) => {
      temperatureReadout.visible = showAbsoluteValues && isOverMap;
    });

    // Control the content of the textual label, no unlink needed because these point controllers are permanent.
    Multilink.multilink([pointController.fahrenheitTemperatureProperty, pointController.celsiusTemperatureProperty, temperatureUnitsProperty, pointController.isOverMapProperty], (fahrenheitTemperature, celsiusTemperature, temperatureUnits) => {
      const value = temperatureUnits === NLIConstants.TEMPERATURE_UNITS.CELSIUS ? celsiusTemperature : fahrenheitTemperature;
      const template = value < 0 ? negativeTemperatureAmountString : value > 0 ? positiveTemperatureAmountString : zeroTemperatureAmountString;
      temperatureReadoutStringProperty.set(StringUtils.fillIn(template, {
        value: Math.abs(value)
      }));
    });

    // Dilate the touch area for easier grabbing.
    compositeThermometerNode.touchArea = temperatureAndColorSensorNode.bounds.dilated(TOUCH_DILATION);
    super(pointController, options);
  }
}
numberLineIntegers.register('TemperaturePointControllerNode', TemperaturePointControllerNode);
export default TemperaturePointControllerNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJTdHJpbmdQcm9wZXJ0eSIsIlJhbmdlIiwiQ29sb3JpemVkUmVhZG91dE5vZGUiLCJQb2ludENvbnRyb2xsZXJOb2RlIiwibWVyZ2UiLCJTdHJpbmdVdGlscyIsIlBoZXRGb250IiwiVGVtcGVyYXR1cmVBbmRDb2xvclNlbnNvck5vZGUiLCJDb2xvciIsIk5vZGUiLCJUZXh0IiwiTkxJQ29uc3RhbnRzIiwibnVtYmVyTGluZUludGVnZXJzIiwiTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncyIsIlRPVUNIX0RJTEFUSU9OIiwiVEVNUEVSQVRVUkVfUkFOR0UiLCJuZWdhdGl2ZVRlbXBlcmF0dXJlQW1vdW50U3RyaW5nIiwibmVnYXRpdmVUZW1wZXJhdHVyZUFtb3VudCIsInBvc2l0aXZlVGVtcGVyYXR1cmVBbW91bnRTdHJpbmciLCJwb3NpdGl2ZVRlbXBlcmF0dXJlQW1vdW50IiwiemVyb1RlbXBlcmF0dXJlQW1vdW50U3RyaW5nIiwiemVyb1RlbXBlcmF0dXJlQW1vdW50IiwiVGVtcGVyYXR1cmVQb2ludENvbnRyb2xsZXJOb2RlIiwiY29uc3RydWN0b3IiLCJwb2ludENvbnRyb2xsZXIiLCJzaG93QWJzb2x1dGVWYWx1ZXNQcm9wZXJ0eSIsInRlbXBlcmF0dXJlVW5pdHNQcm9wZXJ0eSIsIm9wdGlvbnMiLCJjb21wb3NpdGVUaGVybW9tZXRlck5vZGUiLCJub2RlIiwiY29ubmVjdG9yTGluZSIsInRlbXBlcmF0dXJlQW5kQ29sb3JTZW5zb3JOb2RlIiwiZmFocmVuaGVpdFRlbXBlcmF0dXJlUHJvcGVydHkiLCJjb2xvclByb3BlcnR5IiwidGhlcm1vbWV0ZXJOb2RlT3B0aW9ucyIsImZsdWlkTWFpbkNvbG9yIiwiZmx1aWRIaWdobGlnaHRDb2xvciIsImJhY2tncm91bmRGaWxsIiwidGlja1NwYWNpbmdUZW1wZXJhdHVyZSIsIm1ham9yVGlja0xlbmd0aCIsIm1pbm9yVGlja0xlbmd0aCIsImFkZENoaWxkIiwidGhlcm1vbWV0ZXJMYWJlbCIsImxhYmVsIiwiZm9udCIsImNlbnRlclgiLCJ0aGVybW9tZXRlckJvdW5kcyIsInRvcCIsIm1heFdpZHRoIiwid2lkdGgiLCJ0ZW1wZXJhdHVyZVJlYWRvdXRTdHJpbmdQcm9wZXJ0eSIsInRlbXBlcmF0dXJlUmVhZG91dCIsImxlZnQiLCJyaWdodCIsImNlbnRlclkiLCJ0ZXh0T3B0aW9ucyIsIm11bHRpbGluayIsImlzT3Zlck1hcFByb3BlcnR5Iiwic2hvd0Fic29sdXRlVmFsdWVzIiwiaXNPdmVyTWFwIiwidmlzaWJsZSIsImNlbHNpdXNUZW1wZXJhdHVyZVByb3BlcnR5IiwiZmFocmVuaGVpdFRlbXBlcmF0dXJlIiwiY2Vsc2l1c1RlbXBlcmF0dXJlIiwidGVtcGVyYXR1cmVVbml0cyIsInZhbHVlIiwiVEVNUEVSQVRVUkVfVU5JVFMiLCJDRUxTSVVTIiwidGVtcGxhdGUiLCJzZXQiLCJmaWxsSW4iLCJNYXRoIiwiYWJzIiwidG91Y2hBcmVhIiwiYm91bmRzIiwiZGlsYXRlZCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiVGVtcGVyYXR1cmVQb2ludENvbnRyb2xsZXJOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE5LTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEEgc2NlbmVyeSBub2RlIHRoYXQgaXMgdXNlZCB0byBjb250cm9sIHBvaW50IHBvc2l0aW9ucyBpbiB0aGUgdGVtcGVyYXR1cmUgc2NlbmUgYmFzZWQgb24gdGhlIHRlbXBlcmF0dXJlIG9mIHRoZSBtYXBcclxuICogYmVsb3cgdGhpcyBub2RlLiAgSXQgbG9va3MgbGlrZSBhIHRoZXJtb21ldGVyIHdpdGggYSB0cmlhbmd1bGFyIHBvaW50ZXIgbmV4dCB0byBpdC5cclxuICpcclxuICogQGF1dGhvciBBcm5hYiBQdXJrYXlhc3RoYVxyXG4gKiBAYXV0aG9yIFNhdXJhYmggVG90ZXlcclxuICogQGF1dGhvciBKb2huIEJsYW5jbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgTXVsdGlsaW5rIGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvTXVsdGlsaW5rLmpzJztcclxuaW1wb3J0IFN0cmluZ1Byb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvU3RyaW5nUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcclxuaW1wb3J0IENvbG9yaXplZFJlYWRvdXROb2RlIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9qcy9jb21tb24vdmlldy9Db2xvcml6ZWRSZWFkb3V0Tm9kZS5qcyc7XHJcbmltcG9ydCBQb2ludENvbnRyb2xsZXJOb2RlIGZyb20gJy4uLy4uLy4uLy4uL251bWJlci1saW5lLWNvbW1vbi9qcy9jb21tb24vdmlldy9Qb2ludENvbnRyb2xsZXJOb2RlLmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBTdHJpbmdVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3V0aWwvU3RyaW5nVXRpbHMuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IFRlbXBlcmF0dXJlQW5kQ29sb3JTZW5zb3JOb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9UZW1wZXJhdHVyZUFuZENvbG9yU2Vuc29yTm9kZS5qcyc7XHJcbmltcG9ydCB7IENvbG9yLCBOb2RlLCBUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IE5MSUNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vTkxJQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IG51bWJlckxpbmVJbnRlZ2VycyBmcm9tICcuLi8uLi9udW1iZXJMaW5lSW50ZWdlcnMuanMnO1xyXG5pbXBvcnQgTnVtYmVyTGluZUludGVnZXJzU3RyaW5ncyBmcm9tICcuLi8uLi9OdW1iZXJMaW5lSW50ZWdlcnNTdHJpbmdzLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBUT1VDSF9ESUxBVElPTiA9IDU7XHJcbmNvbnN0IFRFTVBFUkFUVVJFX1JBTkdFID0gbmV3IFJhbmdlKCAtODUsIDEwNCApOyAvLyBkZXRlcm1pbmVkIGJhc2VkIG9uIHRoZSB0ZW1wZXJhdHVyZSBkYXRhIHRoYXQgd2FzIHVzZWRcclxuXHJcbmNvbnN0IG5lZ2F0aXZlVGVtcGVyYXR1cmVBbW91bnRTdHJpbmcgPSBOdW1iZXJMaW5lSW50ZWdlcnNTdHJpbmdzLm5lZ2F0aXZlVGVtcGVyYXR1cmVBbW91bnQ7XHJcbmNvbnN0IHBvc2l0aXZlVGVtcGVyYXR1cmVBbW91bnRTdHJpbmcgPSBOdW1iZXJMaW5lSW50ZWdlcnNTdHJpbmdzLnBvc2l0aXZlVGVtcGVyYXR1cmVBbW91bnQ7XHJcbmNvbnN0IHplcm9UZW1wZXJhdHVyZUFtb3VudFN0cmluZyA9IE51bWJlckxpbmVJbnRlZ2Vyc1N0cmluZ3MuemVyb1RlbXBlcmF0dXJlQW1vdW50O1xyXG5cclxuY2xhc3MgVGVtcGVyYXR1cmVQb2ludENvbnRyb2xsZXJOb2RlIGV4dGVuZHMgUG9pbnRDb250cm9sbGVyTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7VGVtcGVyYXR1cmVQb2ludENvbnRyb2xsZXJ9IHBvaW50Q29udHJvbGxlclxyXG4gICAqIEBwYXJhbSB7Qm9vbGVhblByb3BlcnR5fSBzaG93QWJzb2x1dGVWYWx1ZXNQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHl9IHRlbXBlcmF0dXJlVW5pdHNQcm9wZXJ0eSAtIHdoZXRoZXIgdGVtcGVyYXR1cmUgaXMgYmVpbmcgc2hvd24gaW4gQ2Vsc2l1cyBvciBGYWhyZW5oZWl0XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gICAqIEBwdWJsaWNcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggcG9pbnRDb250cm9sbGVyLCBzaG93QWJzb2x1dGVWYWx1ZXNQcm9wZXJ0eSwgdGVtcGVyYXR1cmVVbml0c1Byb3BlcnR5LCBvcHRpb25zICkge1xyXG5cclxuICAgIC8vIENyZWF0ZSBhIG5vZGUgdGhhdCBjb250YWlucyB0aGVybW9tZXRlciBhbmQgdHJpYW5nbGUuXHJcbiAgICBjb25zdCBjb21wb3NpdGVUaGVybW9tZXRlck5vZGUgPSBuZXcgTm9kZSgpO1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG4gICAgICBub2RlOiBjb21wb3NpdGVUaGVybW9tZXRlck5vZGUsXHJcbiAgICAgIGNvbm5lY3RvckxpbmU6IGZhbHNlXHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgdGVtcGVyYXR1cmVBbmRDb2xvclNlbnNvck5vZGUgPSBuZXcgVGVtcGVyYXR1cmVBbmRDb2xvclNlbnNvck5vZGUoXHJcbiAgICAgIHBvaW50Q29udHJvbGxlci5mYWhyZW5oZWl0VGVtcGVyYXR1cmVQcm9wZXJ0eSwgVEVNUEVSQVRVUkVfUkFOR0UsIHBvaW50Q29udHJvbGxlci5jb2xvclByb3BlcnR5LCB7XHJcbiAgICAgICAgdGhlcm1vbWV0ZXJOb2RlT3B0aW9uczoge1xyXG4gICAgICAgICAgZmx1aWRNYWluQ29sb3I6IG5ldyBDb2xvciggMCwgMTIwLCAwICksXHJcbiAgICAgICAgICBmbHVpZEhpZ2hsaWdodENvbG9yOiBuZXcgQ29sb3IoIDAsIDIxMCwgMCApLFxyXG4gICAgICAgICAgYmFja2dyb3VuZEZpbGw6ICdyZ2JhKCAyNTUsIDI1NSwgMjU1LCAwLjkgKScsXHJcbiAgICAgICAgICB0aWNrU3BhY2luZ1RlbXBlcmF0dXJlOiAyMCxcclxuICAgICAgICAgIG1ham9yVGlja0xlbmd0aDogMCxcclxuICAgICAgICAgIG1pbm9yVGlja0xlbmd0aDogMFxyXG4gICAgICAgIH1cclxuICAgICAgfSApO1xyXG4gICAgY29tcG9zaXRlVGhlcm1vbWV0ZXJOb2RlLmFkZENoaWxkKCB0ZW1wZXJhdHVyZUFuZENvbG9yU2Vuc29yTm9kZSApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgdGV4dHVhbCBsYWJlbCBmb3IgdGhpcyB0aGVybW9tZXRlciwgZ2VuZXJhbGx5IGEgc2luZ2xlIGxldHRlci5cclxuICAgIGNvbnN0IHRoZXJtb21ldGVyTGFiZWwgPSBuZXcgVGV4dCggcG9pbnRDb250cm9sbGVyLmxhYmVsLCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMTYgKSxcclxuICAgICAgY2VudGVyWDogdGVtcGVyYXR1cmVBbmRDb2xvclNlbnNvck5vZGUudGhlcm1vbWV0ZXJCb3VuZHMuY2VudGVyWCxcclxuICAgICAgdG9wOiB0ZW1wZXJhdHVyZUFuZENvbG9yU2Vuc29yTm9kZS50b3AgKyA0LCAvLyBvZmZzZXQgZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG4gICAgICBtYXhXaWR0aDogdGVtcGVyYXR1cmVBbmRDb2xvclNlbnNvck5vZGUud2lkdGggKiAwLjI1IC8vIG11bHRpcGxpZXIgZW1waXJpY2FsbHkgZGV0ZXJtaW5lZFxyXG4gICAgfSApO1xyXG4gICAgY29tcG9zaXRlVGhlcm1vbWV0ZXJOb2RlLmFkZENoaWxkKCB0aGVybW9tZXRlckxhYmVsICk7XHJcblxyXG4gICAgLy8gQWRkIGEgcmVhZG91dCB0aGF0IHdpbGwgZGVzY3JpYmUgdGhlIHRlbXBlcmF0dXJlIHRleHR1YWxseSwgZS5nLiBcIjIwwrAgYWJvdmUgMFwiLlxyXG4gICAgY29uc3QgdGVtcGVyYXR1cmVSZWFkb3V0U3RyaW5nUHJvcGVydHkgPSBuZXcgU3RyaW5nUHJvcGVydHkoICcnICk7XHJcbiAgICBjb25zdCB0ZW1wZXJhdHVyZVJlYWRvdXQgPSBuZXcgQ29sb3JpemVkUmVhZG91dE5vZGUoXHJcbiAgICAgIHRlbXBlcmF0dXJlUmVhZG91dFN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICBwb2ludENvbnRyb2xsZXIuY29sb3JQcm9wZXJ0eSxcclxuICAgICAge1xyXG4gICAgICAgIGxlZnQ6IHRlbXBlcmF0dXJlQW5kQ29sb3JTZW5zb3JOb2RlLnJpZ2h0ICsgMyxcclxuICAgICAgICBjZW50ZXJZOiAwLFxyXG4gICAgICAgIHRleHRPcHRpb25zOiB7XHJcbiAgICAgICAgICBmb250OiBuZXcgUGhldEZvbnQoIDE4ICksXHJcbiAgICAgICAgICBtYXhXaWR0aDogMjUwXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICApO1xyXG4gICAgY29tcG9zaXRlVGhlcm1vbWV0ZXJOb2RlLmFkZENoaWxkKCB0ZW1wZXJhdHVyZVJlYWRvdXQgKTtcclxuXHJcbiAgICAvLyBDb250cm9sIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSB0ZXh0dWFsIGxhYmVsLCBubyB1bmxpbmsgbmVlZGVkIGJlY2F1c2UgdGhlc2UgcG9pbnQgY29udHJvbGxlcnMgYXJlIHBlcm1hbmVudC5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoXHJcbiAgICAgIFsgc2hvd0Fic29sdXRlVmFsdWVzUHJvcGVydHksIHBvaW50Q29udHJvbGxlci5pc092ZXJNYXBQcm9wZXJ0eSBdLFxyXG4gICAgICAoIHNob3dBYnNvbHV0ZVZhbHVlcywgaXNPdmVyTWFwICkgPT4ge1xyXG4gICAgICAgIHRlbXBlcmF0dXJlUmVhZG91dC52aXNpYmxlID0gc2hvd0Fic29sdXRlVmFsdWVzICYmIGlzT3Zlck1hcDtcclxuICAgICAgfVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBDb250cm9sIHRoZSBjb250ZW50IG9mIHRoZSB0ZXh0dWFsIGxhYmVsLCBubyB1bmxpbmsgbmVlZGVkIGJlY2F1c2UgdGhlc2UgcG9pbnQgY29udHJvbGxlcnMgYXJlIHBlcm1hbmVudC5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoXHJcbiAgICAgIFtcclxuICAgICAgICBwb2ludENvbnRyb2xsZXIuZmFocmVuaGVpdFRlbXBlcmF0dXJlUHJvcGVydHksXHJcbiAgICAgICAgcG9pbnRDb250cm9sbGVyLmNlbHNpdXNUZW1wZXJhdHVyZVByb3BlcnR5LFxyXG4gICAgICAgIHRlbXBlcmF0dXJlVW5pdHNQcm9wZXJ0eSxcclxuICAgICAgICBwb2ludENvbnRyb2xsZXIuaXNPdmVyTWFwUHJvcGVydHlcclxuICAgICAgXSxcclxuICAgICAgKCBmYWhyZW5oZWl0VGVtcGVyYXR1cmUsIGNlbHNpdXNUZW1wZXJhdHVyZSwgdGVtcGVyYXR1cmVVbml0cyApID0+IHtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IHRlbXBlcmF0dXJlVW5pdHMgPT09IE5MSUNvbnN0YW50cy5URU1QRVJBVFVSRV9VTklUUy5DRUxTSVVTID8gY2Vsc2l1c1RlbXBlcmF0dXJlIDogZmFocmVuaGVpdFRlbXBlcmF0dXJlO1xyXG4gICAgICAgIGNvbnN0IHRlbXBsYXRlID0gdmFsdWUgPCAwID8gbmVnYXRpdmVUZW1wZXJhdHVyZUFtb3VudFN0cmluZyA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA+IDAgPyBwb3NpdGl2ZVRlbXBlcmF0dXJlQW1vdW50U3RyaW5nIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgIHplcm9UZW1wZXJhdHVyZUFtb3VudFN0cmluZztcclxuICAgICAgICB0ZW1wZXJhdHVyZVJlYWRvdXRTdHJpbmdQcm9wZXJ0eS5zZXQoIFN0cmluZ1V0aWxzLmZpbGxJbiggdGVtcGxhdGUsIHsgdmFsdWU6IE1hdGguYWJzKCB2YWx1ZSApIH0gKSApO1xyXG4gICAgICB9XHJcbiAgICApO1xyXG5cclxuICAgIC8vIERpbGF0ZSB0aGUgdG91Y2ggYXJlYSBmb3IgZWFzaWVyIGdyYWJiaW5nLlxyXG4gICAgY29tcG9zaXRlVGhlcm1vbWV0ZXJOb2RlLnRvdWNoQXJlYSA9IHRlbXBlcmF0dXJlQW5kQ29sb3JTZW5zb3JOb2RlLmJvdW5kcy5kaWxhdGVkKCBUT1VDSF9ESUxBVElPTiApO1xyXG5cclxuICAgIHN1cGVyKCBwb2ludENvbnRyb2xsZXIsIG9wdGlvbnMgKTtcclxuICB9XHJcbn1cclxuXHJcbm51bWJlckxpbmVJbnRlZ2Vycy5yZWdpc3RlciggJ1RlbXBlcmF0dXJlUG9pbnRDb250cm9sbGVyTm9kZScsIFRlbXBlcmF0dXJlUG9pbnRDb250cm9sbGVyTm9kZSApO1xyXG5leHBvcnQgZGVmYXVsdCBUZW1wZXJhdHVyZVBvaW50Q29udHJvbGxlck5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFNBQVMsTUFBTSxrQ0FBa0M7QUFDeEQsT0FBT0MsY0FBYyxNQUFNLHVDQUF1QztBQUNsRSxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLG9CQUFvQixNQUFNLHVFQUF1RTtBQUN4RyxPQUFPQyxtQkFBbUIsTUFBTSxzRUFBc0U7QUFDdEcsT0FBT0MsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxPQUFPQyxXQUFXLE1BQU0sK0NBQStDO0FBQ3ZFLE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsT0FBT0MsNkJBQTZCLE1BQU0sOERBQThEO0FBQ3hHLFNBQVNDLEtBQUssRUFBRUMsSUFBSSxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ3JFLE9BQU9DLFlBQVksTUFBTSw4QkFBOEI7QUFDdkQsT0FBT0Msa0JBQWtCLE1BQU0sNkJBQTZCO0FBQzVELE9BQU9DLHlCQUF5QixNQUFNLG9DQUFvQzs7QUFFMUU7QUFDQSxNQUFNQyxjQUFjLEdBQUcsQ0FBQztBQUN4QixNQUFNQyxpQkFBaUIsR0FBRyxJQUFJZCxLQUFLLENBQUUsQ0FBQyxFQUFFLEVBQUUsR0FBSSxDQUFDLENBQUMsQ0FBQzs7QUFFakQsTUFBTWUsK0JBQStCLEdBQUdILHlCQUF5QixDQUFDSSx5QkFBeUI7QUFDM0YsTUFBTUMsK0JBQStCLEdBQUdMLHlCQUF5QixDQUFDTSx5QkFBeUI7QUFDM0YsTUFBTUMsMkJBQTJCLEdBQUdQLHlCQUF5QixDQUFDUSxxQkFBcUI7QUFFbkYsTUFBTUMsOEJBQThCLFNBQVNuQixtQkFBbUIsQ0FBQztFQUUvRDtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFb0IsV0FBV0EsQ0FBRUMsZUFBZSxFQUFFQywwQkFBMEIsRUFBRUMsd0JBQXdCLEVBQUVDLE9BQU8sRUFBRztJQUU1RjtJQUNBLE1BQU1DLHdCQUF3QixHQUFHLElBQUluQixJQUFJLENBQUMsQ0FBQztJQUUzQ2tCLE9BQU8sR0FBR3ZCLEtBQUssQ0FBRTtNQUNmeUIsSUFBSSxFQUFFRCx3QkFBd0I7TUFDOUJFLGFBQWEsRUFBRTtJQUNqQixDQUFDLEVBQUVILE9BQVEsQ0FBQztJQUVaLE1BQU1JLDZCQUE2QixHQUFHLElBQUl4Qiw2QkFBNkIsQ0FDckVpQixlQUFlLENBQUNRLDZCQUE2QixFQUFFakIsaUJBQWlCLEVBQUVTLGVBQWUsQ0FBQ1MsYUFBYSxFQUFFO01BQy9GQyxzQkFBc0IsRUFBRTtRQUN0QkMsY0FBYyxFQUFFLElBQUkzQixLQUFLLENBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFFLENBQUM7UUFDdEM0QixtQkFBbUIsRUFBRSxJQUFJNUIsS0FBSyxDQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBRSxDQUFDO1FBQzNDNkIsY0FBYyxFQUFFLDRCQUE0QjtRQUM1Q0Msc0JBQXNCLEVBQUUsRUFBRTtRQUMxQkMsZUFBZSxFQUFFLENBQUM7UUFDbEJDLGVBQWUsRUFBRTtNQUNuQjtJQUNGLENBQUUsQ0FBQztJQUNMWix3QkFBd0IsQ0FBQ2EsUUFBUSxDQUFFViw2QkFBOEIsQ0FBQzs7SUFFbEU7SUFDQSxNQUFNVyxnQkFBZ0IsR0FBRyxJQUFJaEMsSUFBSSxDQUFFYyxlQUFlLENBQUNtQixLQUFLLEVBQUU7TUFDeERDLElBQUksRUFBRSxJQUFJdEMsUUFBUSxDQUFFLEVBQUcsQ0FBQztNQUN4QnVDLE9BQU8sRUFBRWQsNkJBQTZCLENBQUNlLGlCQUFpQixDQUFDRCxPQUFPO01BQ2hFRSxHQUFHLEVBQUVoQiw2QkFBNkIsQ0FBQ2dCLEdBQUcsR0FBRyxDQUFDO01BQUU7TUFDNUNDLFFBQVEsRUFBRWpCLDZCQUE2QixDQUFDa0IsS0FBSyxHQUFHLElBQUksQ0FBQztJQUN2RCxDQUFFLENBQUM7O0lBQ0hyQix3QkFBd0IsQ0FBQ2EsUUFBUSxDQUFFQyxnQkFBaUIsQ0FBQzs7SUFFckQ7SUFDQSxNQUFNUSxnQ0FBZ0MsR0FBRyxJQUFJbEQsY0FBYyxDQUFFLEVBQUcsQ0FBQztJQUNqRSxNQUFNbUQsa0JBQWtCLEdBQUcsSUFBSWpELG9CQUFvQixDQUNqRGdELGdDQUFnQyxFQUNoQzFCLGVBQWUsQ0FBQ1MsYUFBYSxFQUM3QjtNQUNFbUIsSUFBSSxFQUFFckIsNkJBQTZCLENBQUNzQixLQUFLLEdBQUcsQ0FBQztNQUM3Q0MsT0FBTyxFQUFFLENBQUM7TUFDVkMsV0FBVyxFQUFFO1FBQ1hYLElBQUksRUFBRSxJQUFJdEMsUUFBUSxDQUFFLEVBQUcsQ0FBQztRQUN4QjBDLFFBQVEsRUFBRTtNQUNaO0lBQ0YsQ0FDRixDQUFDO0lBQ0RwQix3QkFBd0IsQ0FBQ2EsUUFBUSxDQUFFVSxrQkFBbUIsQ0FBQzs7SUFFdkQ7SUFDQXBELFNBQVMsQ0FBQ3lELFNBQVMsQ0FDakIsQ0FBRS9CLDBCQUEwQixFQUFFRCxlQUFlLENBQUNpQyxpQkFBaUIsQ0FBRSxFQUNqRSxDQUFFQyxrQkFBa0IsRUFBRUMsU0FBUyxLQUFNO01BQ25DUixrQkFBa0IsQ0FBQ1MsT0FBTyxHQUFHRixrQkFBa0IsSUFBSUMsU0FBUztJQUM5RCxDQUNGLENBQUM7O0lBRUQ7SUFDQTVELFNBQVMsQ0FBQ3lELFNBQVMsQ0FDakIsQ0FDRWhDLGVBQWUsQ0FBQ1EsNkJBQTZCLEVBQzdDUixlQUFlLENBQUNxQywwQkFBMEIsRUFDMUNuQyx3QkFBd0IsRUFDeEJGLGVBQWUsQ0FBQ2lDLGlCQUFpQixDQUNsQyxFQUNELENBQUVLLHFCQUFxQixFQUFFQyxrQkFBa0IsRUFBRUMsZ0JBQWdCLEtBQU07TUFDakUsTUFBTUMsS0FBSyxHQUFHRCxnQkFBZ0IsS0FBS3JELFlBQVksQ0FBQ3VELGlCQUFpQixDQUFDQyxPQUFPLEdBQUdKLGtCQUFrQixHQUFHRCxxQkFBcUI7TUFDdEgsTUFBTU0sUUFBUSxHQUFHSCxLQUFLLEdBQUcsQ0FBQyxHQUFHakQsK0JBQStCLEdBQzNDaUQsS0FBSyxHQUFHLENBQUMsR0FBRy9DLCtCQUErQixHQUMzQ0UsMkJBQTJCO01BQzVDOEIsZ0NBQWdDLENBQUNtQixHQUFHLENBQUVoRSxXQUFXLENBQUNpRSxNQUFNLENBQUVGLFFBQVEsRUFBRTtRQUFFSCxLQUFLLEVBQUVNLElBQUksQ0FBQ0MsR0FBRyxDQUFFUCxLQUFNO01BQUUsQ0FBRSxDQUFFLENBQUM7SUFDdEcsQ0FDRixDQUFDOztJQUVEO0lBQ0FyQyx3QkFBd0IsQ0FBQzZDLFNBQVMsR0FBRzFDLDZCQUE2QixDQUFDMkMsTUFBTSxDQUFDQyxPQUFPLENBQUU3RCxjQUFlLENBQUM7SUFFbkcsS0FBSyxDQUFFVSxlQUFlLEVBQUVHLE9BQVEsQ0FBQztFQUNuQztBQUNGO0FBRUFmLGtCQUFrQixDQUFDZ0UsUUFBUSxDQUFFLGdDQUFnQyxFQUFFdEQsOEJBQStCLENBQUM7QUFDL0YsZUFBZUEsOEJBQThCIn0=