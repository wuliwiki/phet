// Copyright 2016-2023, University of Colorado Boulder

/**
 * View for a trajectory.
 * Listens to an observable array of DataPoints in the model to draw dots on the trajectory
 * Creates and contains projectileNodes
 *
 * @author Andrea Lin (PhET Interactive Simulations)
 */

import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import { Circle, Node, Path } from '../../../../scenery/js/imports.js';
import projectileMotion from '../../projectileMotion.js';
import ProjectileMotionConstants from '../ProjectileMotionConstants.js';
import ProjectileNode from './ProjectileNode.js';
const PATH_WIDTH = ProjectileMotionConstants.PATH_WIDTH; // view units
const PATH_MIN_OPACITY = 0.1;
const PATH_MAX_OPACITY = 1;
const AIR_RESISTANCE_OFF_PATH_COLOR = ProjectileMotionConstants.AIR_RESISTANCE_OFF_PATH_COLOR;
const AIR_RESISTANCE_ON_COLOR = ProjectileMotionConstants.AIR_RESISTANCE_ON_PATH_COLOR;
const SMALL_DOT_RADIUS = ProjectileMotionConstants.SMALL_DOT_RADIUS; // view units
const LARGE_DOT_RADIUS = ProjectileMotionConstants.LARGE_DOT_RADIUS; // view units
const DOTS_MIN_OPACITY = 0.1;
const DOTS_MAX_OPACITY = 0.5;
const TIME_PER_MINOR_DOT = ProjectileMotionConstants.TIME_PER_MINOR_DOT; // in ms
const TIME_PER_MAJOR_DOT = ProjectileMotionConstants.TIME_PER_MAJOR_DOT; // in ms

const DOT_GREEN = 'rgb( 50, 255, 50 )';
class TrajectoryNode extends Node {
  constructor(viewProperties, trajectory, transformProperty, maxNumberOfTrajectories, showPath, constantTrajectoryOpacity) {
    super({
      pickable: false,
      preventFit: true
    });

    // A single Vector2 instance used for each new model DataPoint to save on memory.
    const addedPointViewPosition = new Vector2(0, 0);

    // null until after first point is added (nulled out on transform change too).
    let lastViewPosition = null;
    let projectileNode;
    const addProjectileNode = () => {
      projectileNode && projectileNode.dispose();
      projectileNode = new ProjectileNode(viewProperties, trajectory.projectileDataPointProperty, trajectory.projectileObjectType, trajectory.diameter, trajectory.dragCoefficient, transformProperty.value);
      this.addChild(projectileNode);
    };
    addProjectileNode();
    let currentPathShape = null;
    let currentPathStroke = null;

    // Each new Path (created based on change in stroke) will be added as a child to this container.
    const pathsLayer = new Node();

    // Holds all visible data points that can be read with the tool (except the apex point)
    let dotsShape = new Shape();
    const dotsPath = new Path(dotsShape, {
      stroke: 'black'
    });
    this.addChild(pathsLayer);
    this.addChild(dotsPath);
    let apexDot = null;

    // add view nodes based on new dataPoints added
    const handleDataPointAdded = addedPoint => {
      if (!showPath) {
        return; // do not draw the path if showPath is false
      }

      // To be set by the transform
      addedPointViewPosition.set(addedPoint.position);
      transformProperty.get().getMatrix().multiplyVector2(addedPointViewPosition);
      addedPointViewPosition.x = Utils.roundSymmetric(addedPointViewPosition.x * 10000) / 10000;
      addedPointViewPosition.y = Utils.roundSymmetric(addedPointViewPosition.y * 10000) / 10000;
      if (lastViewPosition) {
        const pathStroke = addedPoint.airDensity > 0 ? AIR_RESISTANCE_ON_COLOR : AIR_RESISTANCE_OFF_PATH_COLOR;

        // Need to create a new Shape/Path because the stroke is different
        if (!currentPathShape || currentPathStroke !== pathStroke) {
          currentPathShape = new Shape().moveTo(lastViewPosition.x, lastViewPosition.y);
          currentPathStroke = pathStroke;
          pathsLayer.addChild(new Path(currentPathShape, {
            lineWidth: PATH_WIDTH,
            stroke: pathStroke
          }));
        }
        currentPathShape.lineTo(addedPointViewPosition.x, addedPointViewPosition.y);
      } else {
        lastViewPosition = new Vector2(0, 0);
      }
      lastViewPosition.set(addedPointViewPosition);

      // draw dot if it is time for data point should be shown (in ms)
      const addedPointTime = Utils.toFixedNumber(addedPoint.time * 1000, 0);
      if (addedPointTime % TIME_PER_MAJOR_DOT === 0) {
        dotsShape.moveTo(addedPointViewPosition.x + LARGE_DOT_RADIUS, addedPointViewPosition.y).circle(addedPointViewPosition.x, addedPointViewPosition.y, LARGE_DOT_RADIUS);
      } else if (addedPointTime % TIME_PER_MINOR_DOT === 0) {
        dotsShape.moveTo(addedPointViewPosition.x + SMALL_DOT_RADIUS, addedPointViewPosition.y).circle(addedPointViewPosition.x, addedPointViewPosition.y, SMALL_DOT_RADIUS);
      }

      // draw green dot if apex
      if (addedPoint.apex) {
        apexDot = new Circle(SMALL_DOT_RADIUS + 0.3, {
          x: addedPointViewPosition.x,
          y: addedPointViewPosition.y,
          fill: DOT_GREEN,
          stroke: 'black',
          lineWidth: 0.3
        });
        this.addChild(apexDot);
      }
    };

    // view listens to whether a datapoint has been added in the model
    trajectory.dataPoints.forEach(handleDataPointAdded);
    trajectory.dataPoints.addItemAddedListener(handleDataPointAdded);
    const updateTransform = () => {
      pathsLayer.removeAllChildren();
      currentPathShape = null;
      currentPathStroke = null;
      dotsShape = new Shape();
      dotsPath.shape = dotsShape;
      if (apexDot) {
        apexDot.dispose();
      }
      lastViewPosition = null;
      assert && assert(trajectory.dataPoints.get(0).position.x === 0, `Initial point x is not zero but ${trajectory.dataPoints.get(0).position.x}`);
      trajectory.dataPoints.forEach(handleDataPointAdded);
      addProjectileNode();
      updateOpacity(trajectory.rankProperty.value);
    };

    // update if model view transform changes
    transformProperty.lazyLink(updateTransform);
    const updateOpacity = rank => {
      //if projectile opacity is set as constant (as in 'stats' screen)
      if (constantTrajectoryOpacity) {
        pathsLayer.opacity = PATH_MAX_OPACITY;
      } else {
        const strength = (maxNumberOfTrajectories - rank) / maxNumberOfTrajectories;
        pathsLayer.opacity = Math.max(PATH_MIN_OPACITY, PATH_MIN_OPACITY + strength * (PATH_MAX_OPACITY - PATH_MIN_OPACITY));
        if (projectileNode) {
          projectileNode.opacity = pathsLayer.opacity;
        }
        if (apexDot) {
          apexDot.opacity = pathsLayer.opacity;
        }
        dotsPath.opacity = Math.max(DOTS_MIN_OPACITY, DOTS_MIN_OPACITY + strength * (DOTS_MAX_OPACITY - DOTS_MIN_OPACITY));
      }
    };

    // change decrease in opacity with each successive projectiled fired
    trajectory.rankProperty.link(updateOpacity);
    this.disposeTrajectoryNode = () => {
      while (pathsLayer.children.length) {
        const childToDispose = pathsLayer.children.pop();
        childToDispose?.dispose();
      }
      dotsPath.dispose();
      projectileNode && projectileNode.dispose();
      apexDot && apexDot.dispose();
      transformProperty.unlink(updateTransform);
      trajectory.rankProperty.unlink(updateOpacity);
    };
  }
  dispose() {
    this.disposeTrajectoryNode();
    super.dispose();
  }
}
projectileMotion.register('TrajectoryNode', TrajectoryNode);
export default TrajectoryNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlZlY3RvcjIiLCJTaGFwZSIsIkNpcmNsZSIsIk5vZGUiLCJQYXRoIiwicHJvamVjdGlsZU1vdGlvbiIsIlByb2plY3RpbGVNb3Rpb25Db25zdGFudHMiLCJQcm9qZWN0aWxlTm9kZSIsIlBBVEhfV0lEVEgiLCJQQVRIX01JTl9PUEFDSVRZIiwiUEFUSF9NQVhfT1BBQ0lUWSIsIkFJUl9SRVNJU1RBTkNFX09GRl9QQVRIX0NPTE9SIiwiQUlSX1JFU0lTVEFOQ0VfT05fQ09MT1IiLCJBSVJfUkVTSVNUQU5DRV9PTl9QQVRIX0NPTE9SIiwiU01BTExfRE9UX1JBRElVUyIsIkxBUkdFX0RPVF9SQURJVVMiLCJET1RTX01JTl9PUEFDSVRZIiwiRE9UU19NQVhfT1BBQ0lUWSIsIlRJTUVfUEVSX01JTk9SX0RPVCIsIlRJTUVfUEVSX01BSk9SX0RPVCIsIkRPVF9HUkVFTiIsIlRyYWplY3RvcnlOb2RlIiwiY29uc3RydWN0b3IiLCJ2aWV3UHJvcGVydGllcyIsInRyYWplY3RvcnkiLCJ0cmFuc2Zvcm1Qcm9wZXJ0eSIsIm1heE51bWJlck9mVHJhamVjdG9yaWVzIiwic2hvd1BhdGgiLCJjb25zdGFudFRyYWplY3RvcnlPcGFjaXR5IiwicGlja2FibGUiLCJwcmV2ZW50Rml0IiwiYWRkZWRQb2ludFZpZXdQb3NpdGlvbiIsImxhc3RWaWV3UG9zaXRpb24iLCJwcm9qZWN0aWxlTm9kZSIsImFkZFByb2plY3RpbGVOb2RlIiwiZGlzcG9zZSIsInByb2plY3RpbGVEYXRhUG9pbnRQcm9wZXJ0eSIsInByb2plY3RpbGVPYmplY3RUeXBlIiwiZGlhbWV0ZXIiLCJkcmFnQ29lZmZpY2llbnQiLCJ2YWx1ZSIsImFkZENoaWxkIiwiY3VycmVudFBhdGhTaGFwZSIsImN1cnJlbnRQYXRoU3Ryb2tlIiwicGF0aHNMYXllciIsImRvdHNTaGFwZSIsImRvdHNQYXRoIiwic3Ryb2tlIiwiYXBleERvdCIsImhhbmRsZURhdGFQb2ludEFkZGVkIiwiYWRkZWRQb2ludCIsInNldCIsInBvc2l0aW9uIiwiZ2V0IiwiZ2V0TWF0cml4IiwibXVsdGlwbHlWZWN0b3IyIiwieCIsInJvdW5kU3ltbWV0cmljIiwieSIsInBhdGhTdHJva2UiLCJhaXJEZW5zaXR5IiwibW92ZVRvIiwibGluZVdpZHRoIiwibGluZVRvIiwiYWRkZWRQb2ludFRpbWUiLCJ0b0ZpeGVkTnVtYmVyIiwidGltZSIsImNpcmNsZSIsImFwZXgiLCJmaWxsIiwiZGF0YVBvaW50cyIsImZvckVhY2giLCJhZGRJdGVtQWRkZWRMaXN0ZW5lciIsInVwZGF0ZVRyYW5zZm9ybSIsInJlbW92ZUFsbENoaWxkcmVuIiwic2hhcGUiLCJhc3NlcnQiLCJ1cGRhdGVPcGFjaXR5IiwicmFua1Byb3BlcnR5IiwibGF6eUxpbmsiLCJyYW5rIiwib3BhY2l0eSIsInN0cmVuZ3RoIiwiTWF0aCIsIm1heCIsImxpbmsiLCJkaXNwb3NlVHJhamVjdG9yeU5vZGUiLCJjaGlsZHJlbiIsImxlbmd0aCIsImNoaWxkVG9EaXNwb3NlIiwicG9wIiwidW5saW5rIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJUcmFqZWN0b3J5Tm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNi0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBWaWV3IGZvciBhIHRyYWplY3RvcnkuXHJcbiAqIExpc3RlbnMgdG8gYW4gb2JzZXJ2YWJsZSBhcnJheSBvZiBEYXRhUG9pbnRzIGluIHRoZSBtb2RlbCB0byBkcmF3IGRvdHMgb24gdGhlIHRyYWplY3RvcnlcclxuICogQ3JlYXRlcyBhbmQgY29udGFpbnMgcHJvamVjdGlsZU5vZGVzXHJcbiAqXHJcbiAqIEBhdXRob3IgQW5kcmVhIExpbiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgeyBDaXJjbGUsIE5vZGUsIFBhdGggfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgcHJvamVjdGlsZU1vdGlvbiBmcm9tICcuLi8uLi9wcm9qZWN0aWxlTW90aW9uLmpzJztcclxuaW1wb3J0IFRyYWplY3RvcnkgZnJvbSAnLi4vbW9kZWwvVHJhamVjdG9yeS5qcyc7XHJcbmltcG9ydCBQcm9qZWN0aWxlTW90aW9uQ29uc3RhbnRzIGZyb20gJy4uL1Byb2plY3RpbGVNb3Rpb25Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgUHJvamVjdGlsZU1vdGlvblZpZXdQcm9wZXJ0aWVzIGZyb20gJy4vUHJvamVjdGlsZU1vdGlvblZpZXdQcm9wZXJ0aWVzLmpzJztcclxuaW1wb3J0IFByb2plY3RpbGVOb2RlIGZyb20gJy4vUHJvamVjdGlsZU5vZGUuanMnO1xyXG5pbXBvcnQgRGF0YVBvaW50IGZyb20gJy4uL21vZGVsL0RhdGFQb2ludC5qcyc7XHJcblxyXG5jb25zdCBQQVRIX1dJRFRIID0gUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cy5QQVRIX1dJRFRIOyAvLyB2aWV3IHVuaXRzXHJcbmNvbnN0IFBBVEhfTUlOX09QQUNJVFkgPSAwLjE7XHJcbmNvbnN0IFBBVEhfTUFYX09QQUNJVFkgPSAxO1xyXG5jb25zdCBBSVJfUkVTSVNUQU5DRV9PRkZfUEFUSF9DT0xPUiA9IFByb2plY3RpbGVNb3Rpb25Db25zdGFudHMuQUlSX1JFU0lTVEFOQ0VfT0ZGX1BBVEhfQ09MT1I7XHJcbmNvbnN0IEFJUl9SRVNJU1RBTkNFX09OX0NPTE9SID0gUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cy5BSVJfUkVTSVNUQU5DRV9PTl9QQVRIX0NPTE9SO1xyXG5cclxuY29uc3QgU01BTExfRE9UX1JBRElVUyA9IFByb2plY3RpbGVNb3Rpb25Db25zdGFudHMuU01BTExfRE9UX1JBRElVUzsgLy8gdmlldyB1bml0c1xyXG5jb25zdCBMQVJHRV9ET1RfUkFESVVTID0gUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cy5MQVJHRV9ET1RfUkFESVVTOyAvLyB2aWV3IHVuaXRzXHJcbmNvbnN0IERPVFNfTUlOX09QQUNJVFkgPSAwLjE7XHJcbmNvbnN0IERPVFNfTUFYX09QQUNJVFkgPSAwLjU7XHJcbmNvbnN0IFRJTUVfUEVSX01JTk9SX0RPVCA9IFByb2plY3RpbGVNb3Rpb25Db25zdGFudHMuVElNRV9QRVJfTUlOT1JfRE9UOyAvLyBpbiBtc1xyXG5jb25zdCBUSU1FX1BFUl9NQUpPUl9ET1QgPSBQcm9qZWN0aWxlTW90aW9uQ29uc3RhbnRzLlRJTUVfUEVSX01BSk9SX0RPVDsgLy8gaW4gbXNcclxuXHJcbmNvbnN0IERPVF9HUkVFTiA9ICdyZ2IoIDUwLCAyNTUsIDUwICknO1xyXG5cclxuY2xhc3MgVHJhamVjdG9yeU5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuICBwcml2YXRlIGRpc3Bvc2VUcmFqZWN0b3J5Tm9kZTogKCkgPT4gdm9pZDtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCB2aWV3UHJvcGVydGllczogUHJvamVjdGlsZU1vdGlvblZpZXdQcm9wZXJ0aWVzLCB0cmFqZWN0b3J5OiBUcmFqZWN0b3J5LCB0cmFuc2Zvcm1Qcm9wZXJ0eTogUHJvcGVydHk8TW9kZWxWaWV3VHJhbnNmb3JtMj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBtYXhOdW1iZXJPZlRyYWplY3RvcmllczogbnVtYmVyLCBzaG93UGF0aDogYm9vbGVhbiwgY29uc3RhbnRUcmFqZWN0b3J5T3BhY2l0eTogYm9vbGVhbiApIHtcclxuICAgIHN1cGVyKCB7IHBpY2thYmxlOiBmYWxzZSwgcHJldmVudEZpdDogdHJ1ZSB9ICk7XHJcblxyXG4gICAgLy8gQSBzaW5nbGUgVmVjdG9yMiBpbnN0YW5jZSB1c2VkIGZvciBlYWNoIG5ldyBtb2RlbCBEYXRhUG9pbnQgdG8gc2F2ZSBvbiBtZW1vcnkuXHJcbiAgICBjb25zdCBhZGRlZFBvaW50Vmlld1Bvc2l0aW9uID0gbmV3IFZlY3RvcjIoIDAsIDAgKTtcclxuXHJcbiAgICAvLyBudWxsIHVudGlsIGFmdGVyIGZpcnN0IHBvaW50IGlzIGFkZGVkIChudWxsZWQgb3V0IG9uIHRyYW5zZm9ybSBjaGFuZ2UgdG9vKS5cclxuICAgIGxldCBsYXN0Vmlld1Bvc2l0aW9uOiBWZWN0b3IyIHwgbnVsbCA9IG51bGw7XHJcbiAgICBsZXQgcHJvamVjdGlsZU5vZGU6IFByb2plY3RpbGVOb2RlIHwgbnVsbDtcclxuXHJcbiAgICBjb25zdCBhZGRQcm9qZWN0aWxlTm9kZSA9ICgpID0+IHtcclxuICAgICAgcHJvamVjdGlsZU5vZGUgJiYgcHJvamVjdGlsZU5vZGUuZGlzcG9zZSgpO1xyXG5cclxuICAgICAgcHJvamVjdGlsZU5vZGUgPSBuZXcgUHJvamVjdGlsZU5vZGUoIHZpZXdQcm9wZXJ0aWVzLCB0cmFqZWN0b3J5LnByb2plY3RpbGVEYXRhUG9pbnRQcm9wZXJ0eSwgdHJhamVjdG9yeS5wcm9qZWN0aWxlT2JqZWN0VHlwZSxcclxuICAgICAgICB0cmFqZWN0b3J5LmRpYW1ldGVyLCB0cmFqZWN0b3J5LmRyYWdDb2VmZmljaWVudCwgdHJhbnNmb3JtUHJvcGVydHkudmFsdWUgKTtcclxuICAgICAgdGhpcy5hZGRDaGlsZCggcHJvamVjdGlsZU5vZGUgKTtcclxuICAgIH07XHJcblxyXG4gICAgYWRkUHJvamVjdGlsZU5vZGUoKTtcclxuXHJcbiAgICBsZXQgY3VycmVudFBhdGhTaGFwZTogU2hhcGUgfCBudWxsID0gbnVsbDtcclxuICAgIGxldCBjdXJyZW50UGF0aFN0cm9rZTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gICAgLy8gRWFjaCBuZXcgUGF0aCAoY3JlYXRlZCBiYXNlZCBvbiBjaGFuZ2UgaW4gc3Ryb2tlKSB3aWxsIGJlIGFkZGVkIGFzIGEgY2hpbGQgdG8gdGhpcyBjb250YWluZXIuXHJcbiAgICBjb25zdCBwYXRoc0xheWVyID0gbmV3IE5vZGUoKTtcclxuXHJcbiAgICAvLyBIb2xkcyBhbGwgdmlzaWJsZSBkYXRhIHBvaW50cyB0aGF0IGNhbiBiZSByZWFkIHdpdGggdGhlIHRvb2wgKGV4Y2VwdCB0aGUgYXBleCBwb2ludClcclxuICAgIGxldCBkb3RzU2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuICAgIGNvbnN0IGRvdHNQYXRoID0gbmV3IFBhdGgoIGRvdHNTaGFwZSwgeyBzdHJva2U6ICdibGFjaycgfSApO1xyXG5cclxuICAgIHRoaXMuYWRkQ2hpbGQoIHBhdGhzTGF5ZXIgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGRvdHNQYXRoICk7XHJcblxyXG4gICAgbGV0IGFwZXhEb3Q6IENpcmNsZSB8IG51bGwgPSBudWxsO1xyXG5cclxuICAgIC8vIGFkZCB2aWV3IG5vZGVzIGJhc2VkIG9uIG5ldyBkYXRhUG9pbnRzIGFkZGVkXHJcbiAgICBjb25zdCBoYW5kbGVEYXRhUG9pbnRBZGRlZCA9ICggYWRkZWRQb2ludDogRGF0YVBvaW50ICk6IHZvaWQgPT4ge1xyXG4gICAgICBpZiAoICFzaG93UGF0aCApIHtcclxuICAgICAgICByZXR1cm47IC8vIGRvIG5vdCBkcmF3IHRoZSBwYXRoIGlmIHNob3dQYXRoIGlzIGZhbHNlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFRvIGJlIHNldCBieSB0aGUgdHJhbnNmb3JtXHJcbiAgICAgIGFkZGVkUG9pbnRWaWV3UG9zaXRpb24uc2V0KCBhZGRlZFBvaW50LnBvc2l0aW9uICk7XHJcbiAgICAgIHRyYW5zZm9ybVByb3BlcnR5LmdldCgpLmdldE1hdHJpeCgpLm11bHRpcGx5VmVjdG9yMiggYWRkZWRQb2ludFZpZXdQb3NpdGlvbiApO1xyXG4gICAgICBhZGRlZFBvaW50Vmlld1Bvc2l0aW9uLnggPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggYWRkZWRQb2ludFZpZXdQb3NpdGlvbi54ICogMTAwMDAgKSAvIDEwMDAwO1xyXG4gICAgICBhZGRlZFBvaW50Vmlld1Bvc2l0aW9uLnkgPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggYWRkZWRQb2ludFZpZXdQb3NpdGlvbi55ICogMTAwMDAgKSAvIDEwMDAwO1xyXG5cclxuICAgICAgaWYgKCBsYXN0Vmlld1Bvc2l0aW9uICkge1xyXG4gICAgICAgIGNvbnN0IHBhdGhTdHJva2UgPSBhZGRlZFBvaW50LmFpckRlbnNpdHkgPiAwID8gQUlSX1JFU0lTVEFOQ0VfT05fQ09MT1IgOiBBSVJfUkVTSVNUQU5DRV9PRkZfUEFUSF9DT0xPUjtcclxuXHJcbiAgICAgICAgLy8gTmVlZCB0byBjcmVhdGUgYSBuZXcgU2hhcGUvUGF0aCBiZWNhdXNlIHRoZSBzdHJva2UgaXMgZGlmZmVyZW50XHJcbiAgICAgICAgaWYgKCAhY3VycmVudFBhdGhTaGFwZSB8fCBjdXJyZW50UGF0aFN0cm9rZSAhPT0gcGF0aFN0cm9rZSApIHtcclxuICAgICAgICAgIGN1cnJlbnRQYXRoU2hhcGUgPSBuZXcgU2hhcGUoKS5tb3ZlVG8oIGxhc3RWaWV3UG9zaXRpb24ueCwgbGFzdFZpZXdQb3NpdGlvbi55ICk7XHJcbiAgICAgICAgICBjdXJyZW50UGF0aFN0cm9rZSA9IHBhdGhTdHJva2U7XHJcbiAgICAgICAgICBwYXRoc0xheWVyLmFkZENoaWxkKCBuZXcgUGF0aCggY3VycmVudFBhdGhTaGFwZSwge1xyXG4gICAgICAgICAgICBsaW5lV2lkdGg6IFBBVEhfV0lEVEgsXHJcbiAgICAgICAgICAgIHN0cm9rZTogcGF0aFN0cm9rZVxyXG4gICAgICAgICAgfSApICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGN1cnJlbnRQYXRoU2hhcGUubGluZVRvKCBhZGRlZFBvaW50Vmlld1Bvc2l0aW9uLngsIGFkZGVkUG9pbnRWaWV3UG9zaXRpb24ueSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGxhc3RWaWV3UG9zaXRpb24gPSBuZXcgVmVjdG9yMiggMCwgMCApO1xyXG4gICAgICB9XHJcbiAgICAgIGxhc3RWaWV3UG9zaXRpb24uc2V0KCBhZGRlZFBvaW50Vmlld1Bvc2l0aW9uICk7XHJcblxyXG4gICAgICAvLyBkcmF3IGRvdCBpZiBpdCBpcyB0aW1lIGZvciBkYXRhIHBvaW50IHNob3VsZCBiZSBzaG93biAoaW4gbXMpXHJcbiAgICAgIGNvbnN0IGFkZGVkUG9pbnRUaW1lID0gVXRpbHMudG9GaXhlZE51bWJlciggYWRkZWRQb2ludC50aW1lICogMTAwMCwgMCApO1xyXG4gICAgICBpZiAoIGFkZGVkUG9pbnRUaW1lICUgVElNRV9QRVJfTUFKT1JfRE9UID09PSAwICkge1xyXG4gICAgICAgIGRvdHNTaGFwZS5tb3ZlVG8oIGFkZGVkUG9pbnRWaWV3UG9zaXRpb24ueCArIExBUkdFX0RPVF9SQURJVVMsIGFkZGVkUG9pbnRWaWV3UG9zaXRpb24ueSApXHJcbiAgICAgICAgICAuY2lyY2xlKCBhZGRlZFBvaW50Vmlld1Bvc2l0aW9uLngsIGFkZGVkUG9pbnRWaWV3UG9zaXRpb24ueSwgTEFSR0VfRE9UX1JBRElVUyApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBhZGRlZFBvaW50VGltZSAlIFRJTUVfUEVSX01JTk9SX0RPVCA9PT0gMCApIHtcclxuICAgICAgICBkb3RzU2hhcGUubW92ZVRvKCBhZGRlZFBvaW50Vmlld1Bvc2l0aW9uLnggKyBTTUFMTF9ET1RfUkFESVVTLCBhZGRlZFBvaW50Vmlld1Bvc2l0aW9uLnkgKVxyXG4gICAgICAgICAgLmNpcmNsZSggYWRkZWRQb2ludFZpZXdQb3NpdGlvbi54LCBhZGRlZFBvaW50Vmlld1Bvc2l0aW9uLnksIFNNQUxMX0RPVF9SQURJVVMgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gZHJhdyBncmVlbiBkb3QgaWYgYXBleFxyXG4gICAgICBpZiAoIGFkZGVkUG9pbnQuYXBleCApIHtcclxuICAgICAgICBhcGV4RG90ID0gbmV3IENpcmNsZSggU01BTExfRE9UX1JBRElVUyArIDAuMywge1xyXG4gICAgICAgICAgeDogYWRkZWRQb2ludFZpZXdQb3NpdGlvbi54LFxyXG4gICAgICAgICAgeTogYWRkZWRQb2ludFZpZXdQb3NpdGlvbi55LFxyXG4gICAgICAgICAgZmlsbDogRE9UX0dSRUVOLFxyXG4gICAgICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICAgICAgbGluZVdpZHRoOiAwLjNcclxuICAgICAgICB9ICk7XHJcbiAgICAgICAgdGhpcy5hZGRDaGlsZCggYXBleERvdCApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIHZpZXcgbGlzdGVucyB0byB3aGV0aGVyIGEgZGF0YXBvaW50IGhhcyBiZWVuIGFkZGVkIGluIHRoZSBtb2RlbFxyXG4gICAgdHJhamVjdG9yeS5kYXRhUG9pbnRzLmZvckVhY2goIGhhbmRsZURhdGFQb2ludEFkZGVkICk7XHJcbiAgICB0cmFqZWN0b3J5LmRhdGFQb2ludHMuYWRkSXRlbUFkZGVkTGlzdGVuZXIoIGhhbmRsZURhdGFQb2ludEFkZGVkICk7XHJcblxyXG4gICAgY29uc3QgdXBkYXRlVHJhbnNmb3JtID0gKCk6IHZvaWQgPT4ge1xyXG4gICAgICBwYXRoc0xheWVyLnJlbW92ZUFsbENoaWxkcmVuKCk7XHJcblxyXG4gICAgICBjdXJyZW50UGF0aFNoYXBlID0gbnVsbDtcclxuICAgICAgY3VycmVudFBhdGhTdHJva2UgPSBudWxsO1xyXG5cclxuICAgICAgZG90c1NoYXBlID0gbmV3IFNoYXBlKCk7XHJcbiAgICAgIGRvdHNQYXRoLnNoYXBlID0gZG90c1NoYXBlO1xyXG4gICAgICBpZiAoIGFwZXhEb3QgKSB7XHJcbiAgICAgICAgYXBleERvdC5kaXNwb3NlKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxhc3RWaWV3UG9zaXRpb24gPSBudWxsO1xyXG5cclxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggdHJhamVjdG9yeS5kYXRhUG9pbnRzLmdldCggMCApLnBvc2l0aW9uLnggPT09IDAsIGBJbml0aWFsIHBvaW50IHggaXMgbm90IHplcm8gYnV0ICR7XHJcbiAgICAgICAgdHJhamVjdG9yeS5kYXRhUG9pbnRzLmdldCggMCApLnBvc2l0aW9uLnh9YCApO1xyXG5cclxuICAgICAgdHJhamVjdG9yeS5kYXRhUG9pbnRzLmZvckVhY2goIGhhbmRsZURhdGFQb2ludEFkZGVkICk7XHJcbiAgICAgIGFkZFByb2plY3RpbGVOb2RlKCk7XHJcbiAgICAgIHVwZGF0ZU9wYWNpdHkoIHRyYWplY3RvcnkucmFua1Byb3BlcnR5LnZhbHVlICk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIHVwZGF0ZSBpZiBtb2RlbCB2aWV3IHRyYW5zZm9ybSBjaGFuZ2VzXHJcbiAgICB0cmFuc2Zvcm1Qcm9wZXJ0eS5sYXp5TGluayggdXBkYXRlVHJhbnNmb3JtICk7XHJcblxyXG4gICAgY29uc3QgdXBkYXRlT3BhY2l0eSA9ICggcmFuazogbnVtYmVyICk6IHZvaWQgPT4ge1xyXG4gICAgICAvL2lmIHByb2plY3RpbGUgb3BhY2l0eSBpcyBzZXQgYXMgY29uc3RhbnQgKGFzIGluICdzdGF0cycgc2NyZWVuKVxyXG4gICAgICBpZiAoIGNvbnN0YW50VHJhamVjdG9yeU9wYWNpdHkgKSB7XHJcbiAgICAgICAgcGF0aHNMYXllci5vcGFjaXR5ID0gUEFUSF9NQVhfT1BBQ0lUWTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBjb25zdCBzdHJlbmd0aCA9ICggbWF4TnVtYmVyT2ZUcmFqZWN0b3JpZXMgLSByYW5rICkgLyBtYXhOdW1iZXJPZlRyYWplY3RvcmllcztcclxuICAgICAgICBwYXRoc0xheWVyLm9wYWNpdHkgPSBNYXRoLm1heCggUEFUSF9NSU5fT1BBQ0lUWSwgUEFUSF9NSU5fT1BBQ0lUWSArIHN0cmVuZ3RoICogKCBQQVRIX01BWF9PUEFDSVRZIC0gUEFUSF9NSU5fT1BBQ0lUWSApICk7XHJcbiAgICAgICAgaWYgKCBwcm9qZWN0aWxlTm9kZSApIHtcclxuICAgICAgICAgIHByb2plY3RpbGVOb2RlLm9wYWNpdHkgPSBwYXRoc0xheWVyLm9wYWNpdHk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICggYXBleERvdCApIHtcclxuICAgICAgICAgIGFwZXhEb3Qub3BhY2l0eSA9IHBhdGhzTGF5ZXIub3BhY2l0eTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZG90c1BhdGgub3BhY2l0eSA9IE1hdGgubWF4KCBET1RTX01JTl9PUEFDSVRZLCBET1RTX01JTl9PUEFDSVRZICsgc3RyZW5ndGggKiAoIERPVFNfTUFYX09QQUNJVFkgLSBET1RTX01JTl9PUEFDSVRZICkgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBjaGFuZ2UgZGVjcmVhc2UgaW4gb3BhY2l0eSB3aXRoIGVhY2ggc3VjY2Vzc2l2ZSBwcm9qZWN0aWxlZCBmaXJlZFxyXG4gICAgdHJhamVjdG9yeS5yYW5rUHJvcGVydHkubGluayggdXBkYXRlT3BhY2l0eSApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZVRyYWplY3RvcnlOb2RlID0gKCkgPT4ge1xyXG4gICAgICB3aGlsZSAoIHBhdGhzTGF5ZXIuY2hpbGRyZW4ubGVuZ3RoICkge1xyXG4gICAgICAgIGNvbnN0IGNoaWxkVG9EaXNwb3NlOiBOb2RlIHwgdW5kZWZpbmVkID0gcGF0aHNMYXllci5jaGlsZHJlbi5wb3AoKTtcclxuICAgICAgICBjaGlsZFRvRGlzcG9zZT8uZGlzcG9zZSgpO1xyXG4gICAgICB9XHJcbiAgICAgIGRvdHNQYXRoLmRpc3Bvc2UoKTtcclxuICAgICAgcHJvamVjdGlsZU5vZGUgJiYgcHJvamVjdGlsZU5vZGUuZGlzcG9zZSgpO1xyXG4gICAgICBhcGV4RG90ICYmIGFwZXhEb3QuZGlzcG9zZSgpO1xyXG4gICAgICB0cmFuc2Zvcm1Qcm9wZXJ0eS51bmxpbmsoIHVwZGF0ZVRyYW5zZm9ybSApO1xyXG4gICAgICB0cmFqZWN0b3J5LnJhbmtQcm9wZXJ0eS51bmxpbmsoIHVwZGF0ZU9wYWNpdHkgKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZVRyYWplY3RvcnlOb2RlKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5wcm9qZWN0aWxlTW90aW9uLnJlZ2lzdGVyKCAnVHJhamVjdG9yeU5vZGUnLCBUcmFqZWN0b3J5Tm9kZSApO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgVHJhamVjdG9yeU5vZGU7XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0EsT0FBT0EsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELFNBQVNDLEtBQUssUUFBUSxnQ0FBZ0M7QUFFdEQsU0FBU0MsTUFBTSxFQUFFQyxJQUFJLEVBQUVDLElBQUksUUFBUSxtQ0FBbUM7QUFDdEUsT0FBT0MsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBRXhELE9BQU9DLHlCQUF5QixNQUFNLGlDQUFpQztBQUV2RSxPQUFPQyxjQUFjLE1BQU0scUJBQXFCO0FBR2hELE1BQU1DLFVBQVUsR0FBR0YseUJBQXlCLENBQUNFLFVBQVUsQ0FBQyxDQUFDO0FBQ3pELE1BQU1DLGdCQUFnQixHQUFHLEdBQUc7QUFDNUIsTUFBTUMsZ0JBQWdCLEdBQUcsQ0FBQztBQUMxQixNQUFNQyw2QkFBNkIsR0FBR0wseUJBQXlCLENBQUNLLDZCQUE2QjtBQUM3RixNQUFNQyx1QkFBdUIsR0FBR04seUJBQXlCLENBQUNPLDRCQUE0QjtBQUV0RixNQUFNQyxnQkFBZ0IsR0FBR1IseUJBQXlCLENBQUNRLGdCQUFnQixDQUFDLENBQUM7QUFD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