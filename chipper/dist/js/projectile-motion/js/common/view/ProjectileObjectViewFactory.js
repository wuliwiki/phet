// Copyright 2016-2023, University of Colorado Boulder

/**
 * Functions that create nodes for the projectile objects
 *
 * @author Andrea Lin (PhET Interactive Simulations)
 */

import Matrix3 from '../../../../dot/js/Matrix3.js';
import Utils from '../../../../dot/js/Utils.js';
import { Shape } from '../../../../kite/js/imports.js';
import { Circle, Image, Line, Node, Path } from '../../../../scenery/js/imports.js';
import baseball_png from '../../../images/baseball_png.js';
import car1_png from '../../../images/car1_png.js';
import car2_png from '../../../images/car2_png.js';
import football_png from '../../../images/football_png.js';
import human1_png from '../../../images/human1_png.js';
import human2_png from '../../../images/human2_png.js';
import piano1_png from '../../../images/piano1_png.js';
import piano2_png from '../../../images/piano2_png.js';
import pumpkin1_png from '../../../images/pumpkin1_png.js';
import pumpkin2_png from '../../../images/pumpkin2_png.js';
import tankShell_png from '../../../images/tankShell_png.js';
import projectileMotion from '../../projectileMotion.js';
export default class ProjectileObjectViewFactory {
  /**
   * Preset object view functions for benchmarks, some benchmarks have different landed objects
   * @param diameter - in meters in model coordinates
   * @param landed - whether we want the landed object view, as opposed to a flying projectile view
   */
  static createCannonball = (diameter, modelViewTransform) => {
    const transformedBallSize = modelViewTransform.modelToViewDeltaX(diameter);
    return new Circle(transformedBallSize / 2, {
      fill: 'black'
    });
  };
  static createPumpkin = (diameter, modelViewTransform, landed) => {
    const transformedBallSize = modelViewTransform.modelToViewDeltaX(diameter);
    if (landed) {
      return new Image(pumpkin2_png, {
        maxHeight: transformedBallSize * 0.75
      });
    } else {
      return new Image(pumpkin1_png, {
        maxHeight: transformedBallSize * 0.95
      });
    }
  };
  static createBaseball = (diameter, modelViewTransform) => {
    const transformedBallSize = modelViewTransform.modelToViewDeltaX(diameter);
    return new Image(baseball_png, {
      maxWidth: transformedBallSize
    });
  };
  static createCar = (diameter, modelViewTransform, landed) => {
    const transformedBallSize = modelViewTransform.modelToViewDeltaX(diameter);
    if (landed) {
      return new Image(car2_png, {
        maxHeight: transformedBallSize * 1.7
      });
    } else {
      return new Image(car1_png, {
        maxHeight: transformedBallSize * 0.75
      });
    }
  };
  static createFootball = (diameter, modelViewTransform) => {
    const transformedBallSize = modelViewTransform.modelToViewDeltaX(diameter);
    return new Image(football_png, {
      maxHeight: transformedBallSize
    });
  };
  static createHuman = (diameter, modelViewTransform, landed) => {
    const transformedBallSize = modelViewTransform.modelToViewDeltaX(diameter);
    if (landed) {
      return new Image(human2_png, {
        maxWidth: transformedBallSize * 1.35
      });
    } else {
      return new Image(human1_png, {
        maxHeight: transformedBallSize * 1.9
      });
    }
  };
  static createPiano = (diameter, modelViewTransform, landed) => {
    const transformedBallSize = modelViewTransform.modelToViewDeltaX(diameter);
    if (landed) {
      return new Image(piano2_png, {
        maxWidth: transformedBallSize * 1.3
      });
    } else {
      return new Image(piano1_png, {
        maxWidth: transformedBallSize * 1.1
      });
    }
  };
  static createGolfBall = (diameter, modelViewTransform) => {
    const transformedBallSize = modelViewTransform.modelToViewDeltaX(diameter);
    return new Circle(transformedBallSize / 2, {
      fill: 'white',
      stroke: 'gray'
    });
  };
  static createTankShell = (diameter, modelViewTransform) => {
    const transformedBallSize = modelViewTransform.modelToViewDeltaX(diameter);
    return new Image(tankShell_png, {
      maxHeight: transformedBallSize
    });
  };
  static createCustom(diameter, dragCoefficient) {
    // drag coefficients estimated from three sources:
    // https://en.wikipedia.org/wiki/Drag_coefficient#Drag_coefficient_cd_examples
    // https://www.grc.nasa.gov/www/k-12/airplane/shaped.html
    // http://www.aerospaceweb.org/question/aerodynamics/q0231.shtml
    assert && assert(dragCoefficient >= 0.04 && dragCoefficient <= 1, `drag coefficient ${dragCoefficient} out of bounds`);
    const radius = diameter / 2;
    let shape;
    let angle;
    let newRadius;
    let newCenterX;
    if (dragCoefficient <= 0.47) {
      // teardrop (inclusive) to sphere (inclusive)

      // Algorithm from http://mathworld.wolfram.com/TeardropCurve.html
      // drag coefficient ranges from [ 0.04 , 0.47 ], and m ranges from 0 to 7
      const m = Utils.linear(0.04, 0.47, 4, 0, dragCoefficient);
      shape = new Shape();
      shape.moveTo(-radius, 0);
      let t;
      for (t = Math.PI / 24; t < 2 * Math.PI; t += Math.PI / 24) {
        const x = -Math.cos(t) * radius;
        const y = Math.sin(t) * Math.pow(Math.sin(0.5 * t), m) * radius;
        shape.lineTo(x, y);
      }
      shape.lineTo(-radius, 0);

      // to maintain the same cross-sectional area
      const currentCrossSectionalRadius = (shape.bounds.maxY - shape.bounds.minY) / 2;
      const scaleFactor = radius / currentCrossSectionalRadius;
      shape = shape.transformed(Matrix3.scaling(scaleFactor, scaleFactor));
      const objectNode = new Path(shape, {
        fill: 'black'
      });

      // used to shift center onto COM
      const strut = new Line(objectNode.left, 0, 1.5 * objectNode.width - 2 * radius, 0, {
        visible: false
      });
      return new Node({
        children: [strut, objectNode]
      });
    } else {
      // sphere (exclusive) to kind of hemisphere (inclusive ) = ( 0.47 , 1 )
      shape = new Shape();
      shape.arc(0, 0, radius, Math.PI / 2, 3 * Math.PI / 2, false);
      shape.moveTo(0, -radius);
      angle = Utils.linear(0.47, 1.17, Math.PI / 2, 0, dragCoefficient);
      newRadius = radius / Math.sin(angle);
      newCenterX = -radius / Math.tan(angle);
      shape.arc(newCenterX, 0, newRadius, -angle, angle, false);
      return new Path(shape, {
        fill: 'black'
      });
    }
  }
}
projectileMotion.register('ProjectileObjectViewFactory', ProjectileObjectViewFactory);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNYXRyaXgzIiwiVXRpbHMiLCJTaGFwZSIsIkNpcmNsZSIsIkltYWdlIiwiTGluZSIsIk5vZGUiLCJQYXRoIiwiYmFzZWJhbGxfcG5nIiwiY2FyMV9wbmciLCJjYXIyX3BuZyIsImZvb3RiYWxsX3BuZyIsImh1bWFuMV9wbmciLCJodW1hbjJfcG5nIiwicGlhbm8xX3BuZyIsInBpYW5vMl9wbmciLCJwdW1wa2luMV9wbmciLCJwdW1wa2luMl9wbmciLCJ0YW5rU2hlbGxfcG5nIiwicHJvamVjdGlsZU1vdGlvbiIsIlByb2plY3RpbGVPYmplY3RWaWV3RmFjdG9yeSIsImNyZWF0ZUNhbm5vbmJhbGwiLCJkaWFtZXRlciIsIm1vZGVsVmlld1RyYW5zZm9ybSIsInRyYW5zZm9ybWVkQmFsbFNpemUiLCJtb2RlbFRvVmlld0RlbHRhWCIsImZpbGwiLCJjcmVhdGVQdW1wa2luIiwibGFuZGVkIiwibWF4SGVpZ2h0IiwiY3JlYXRlQmFzZWJhbGwiLCJtYXhXaWR0aCIsImNyZWF0ZUNhciIsImNyZWF0ZUZvb3RiYWxsIiwiY3JlYXRlSHVtYW4iLCJjcmVhdGVQaWFubyIsImNyZWF0ZUdvbGZCYWxsIiwic3Ryb2tlIiwiY3JlYXRlVGFua1NoZWxsIiwiY3JlYXRlQ3VzdG9tIiwiZHJhZ0NvZWZmaWNpZW50IiwiYXNzZXJ0IiwicmFkaXVzIiwic2hhcGUiLCJhbmdsZSIsIm5ld1JhZGl1cyIsIm5ld0NlbnRlclgiLCJtIiwibGluZWFyIiwibW92ZVRvIiwidCIsIk1hdGgiLCJQSSIsIngiLCJjb3MiLCJ5Iiwic2luIiwicG93IiwibGluZVRvIiwiY3VycmVudENyb3NzU2VjdGlvbmFsUmFkaXVzIiwiYm91bmRzIiwibWF4WSIsIm1pblkiLCJzY2FsZUZhY3RvciIsInRyYW5zZm9ybWVkIiwic2NhbGluZyIsIm9iamVjdE5vZGUiLCJzdHJ1dCIsImxlZnQiLCJ3aWR0aCIsInZpc2libGUiLCJjaGlsZHJlbiIsImFyYyIsInRhbiIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiUHJvamVjdGlsZU9iamVjdFZpZXdGYWN0b3J5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEZ1bmN0aW9ucyB0aGF0IGNyZWF0ZSBub2RlcyBmb3IgdGhlIHByb2plY3RpbGUgb2JqZWN0c1xyXG4gKlxyXG4gKiBAYXV0aG9yIEFuZHJlYSBMaW4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IE1hdHJpeDMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL01hdHJpeDMuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgeyBDaXJjbGUsIEltYWdlLCBMaW5lLCBOb2RlLCBQYXRoIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGJhc2ViYWxsX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvYmFzZWJhbGxfcG5nLmpzJztcclxuaW1wb3J0IGNhcjFfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9jYXIxX3BuZy5qcyc7XHJcbmltcG9ydCBjYXIyX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvY2FyMl9wbmcuanMnO1xyXG5pbXBvcnQgZm9vdGJhbGxfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9mb290YmFsbF9wbmcuanMnO1xyXG5pbXBvcnQgaHVtYW4xX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvaHVtYW4xX3BuZy5qcyc7XHJcbmltcG9ydCBodW1hbjJfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy9odW1hbjJfcG5nLmpzJztcclxuaW1wb3J0IHBpYW5vMV9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL3BpYW5vMV9wbmcuanMnO1xyXG5pbXBvcnQgcGlhbm8yX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvcGlhbm8yX3BuZy5qcyc7XHJcbmltcG9ydCBwdW1wa2luMV9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL3B1bXBraW4xX3BuZy5qcyc7XHJcbmltcG9ydCBwdW1wa2luMl9wbmcgZnJvbSAnLi4vLi4vLi4vaW1hZ2VzL3B1bXBraW4yX3BuZy5qcyc7XHJcbmltcG9ydCB0YW5rU2hlbGxfcG5nIGZyb20gJy4uLy4uLy4uL2ltYWdlcy90YW5rU2hlbGxfcG5nLmpzJztcclxuaW1wb3J0IHByb2plY3RpbGVNb3Rpb24gZnJvbSAnLi4vLi4vcHJvamVjdGlsZU1vdGlvbi5qcyc7XHJcbmltcG9ydCB0eXBlIHsgUHJvamVjdGlsZU9iamVjdFZpZXdDcmVhdG9yIH0gZnJvbSAnLi4vbW9kZWwvUHJvamVjdGlsZU9iamVjdFR5cGUuanMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvamVjdGlsZU9iamVjdFZpZXdGYWN0b3J5IHtcclxuXHJcbiAgLyoqXHJcbiAgICogUHJlc2V0IG9iamVjdCB2aWV3IGZ1bmN0aW9ucyBmb3IgYmVuY2htYXJrcywgc29tZSBiZW5jaG1hcmtzIGhhdmUgZGlmZmVyZW50IGxhbmRlZCBvYmplY3RzXHJcbiAgICogQHBhcmFtIGRpYW1ldGVyIC0gaW4gbWV0ZXJzIGluIG1vZGVsIGNvb3JkaW5hdGVzXHJcbiAgICogQHBhcmFtIGxhbmRlZCAtIHdoZXRoZXIgd2Ugd2FudCB0aGUgbGFuZGVkIG9iamVjdCB2aWV3LCBhcyBvcHBvc2VkIHRvIGEgZmx5aW5nIHByb2plY3RpbGUgdmlld1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlQ2Fubm9uYmFsbDogUHJvamVjdGlsZU9iamVjdFZpZXdDcmVhdG9yID0gKCBkaWFtZXRlciwgbW9kZWxWaWV3VHJhbnNmb3JtICkgPT4ge1xyXG4gICAgY29uc3QgdHJhbnNmb3JtZWRCYWxsU2l6ZSA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggZGlhbWV0ZXIgKTtcclxuICAgIHJldHVybiBuZXcgQ2lyY2xlKCB0cmFuc2Zvcm1lZEJhbGxTaXplIC8gMiwgeyBmaWxsOiAnYmxhY2snIH0gKTtcclxuICB9O1xyXG5cclxuICBwdWJsaWMgc3RhdGljIGNyZWF0ZVB1bXBraW46IFByb2plY3RpbGVPYmplY3RWaWV3Q3JlYXRvciA9ICggZGlhbWV0ZXIsIG1vZGVsVmlld1RyYW5zZm9ybSwgbGFuZGVkICkgPT4ge1xyXG4gICAgY29uc3QgdHJhbnNmb3JtZWRCYWxsU2l6ZSA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggZGlhbWV0ZXIgKTtcclxuICAgIGlmICggbGFuZGVkICkge1xyXG4gICAgICByZXR1cm4gbmV3IEltYWdlKCBwdW1wa2luMl9wbmcsIHsgbWF4SGVpZ2h0OiB0cmFuc2Zvcm1lZEJhbGxTaXplICogMC43NSB9ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgcmV0dXJuIG5ldyBJbWFnZSggcHVtcGtpbjFfcG5nLCB7IG1heEhlaWdodDogdHJhbnNmb3JtZWRCYWxsU2l6ZSAqIDAuOTUgfSApO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlQmFzZWJhbGw6IFByb2plY3RpbGVPYmplY3RWaWV3Q3JlYXRvciA9ICggZGlhbWV0ZXIsIG1vZGVsVmlld1RyYW5zZm9ybSApID0+IHtcclxuICAgIGNvbnN0IHRyYW5zZm9ybWVkQmFsbFNpemUgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YVgoIGRpYW1ldGVyICk7XHJcbiAgICByZXR1cm4gbmV3IEltYWdlKCBiYXNlYmFsbF9wbmcsIHsgbWF4V2lkdGg6IHRyYW5zZm9ybWVkQmFsbFNpemUgfSApO1xyXG4gIH07XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlQ2FyOiBQcm9qZWN0aWxlT2JqZWN0Vmlld0NyZWF0b3IgPSAoIGRpYW1ldGVyLCBtb2RlbFZpZXdUcmFuc2Zvcm0sIGxhbmRlZCApID0+IHtcclxuICAgIGNvbnN0IHRyYW5zZm9ybWVkQmFsbFNpemUgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YVgoIGRpYW1ldGVyICk7XHJcbiAgICBpZiAoIGxhbmRlZCApIHtcclxuICAgICAgcmV0dXJuIG5ldyBJbWFnZSggY2FyMl9wbmcsIHsgbWF4SGVpZ2h0OiB0cmFuc2Zvcm1lZEJhbGxTaXplICogMS43IH0gKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICByZXR1cm4gbmV3IEltYWdlKCBjYXIxX3BuZywgeyBtYXhIZWlnaHQ6IHRyYW5zZm9ybWVkQmFsbFNpemUgKiAwLjc1IH0gKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBwdWJsaWMgc3RhdGljIGNyZWF0ZUZvb3RiYWxsOiBQcm9qZWN0aWxlT2JqZWN0Vmlld0NyZWF0b3IgPSAoIGRpYW1ldGVyLCBtb2RlbFZpZXdUcmFuc2Zvcm0gKSA9PiB7XHJcbiAgICBjb25zdCB0cmFuc2Zvcm1lZEJhbGxTaXplID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFYKCBkaWFtZXRlciApO1xyXG4gICAgcmV0dXJuIG5ldyBJbWFnZSggZm9vdGJhbGxfcG5nLCB7IG1heEhlaWdodDogdHJhbnNmb3JtZWRCYWxsU2l6ZSB9ICk7XHJcbiAgfTtcclxuXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVIdW1hbjogUHJvamVjdGlsZU9iamVjdFZpZXdDcmVhdG9yID0gKCBkaWFtZXRlciwgbW9kZWxWaWV3VHJhbnNmb3JtLCBsYW5kZWQgKSA9PiB7XHJcbiAgICBjb25zdCB0cmFuc2Zvcm1lZEJhbGxTaXplID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFYKCBkaWFtZXRlciApO1xyXG4gICAgaWYgKCBsYW5kZWQgKSB7XHJcbiAgICAgIHJldHVybiBuZXcgSW1hZ2UoIGh1bWFuMl9wbmcsIHsgbWF4V2lkdGg6IHRyYW5zZm9ybWVkQmFsbFNpemUgKiAxLjM1IH0gKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICByZXR1cm4gbmV3IEltYWdlKCBodW1hbjFfcG5nLCB7IG1heEhlaWdodDogdHJhbnNmb3JtZWRCYWxsU2l6ZSAqIDEuOSB9ICk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgcHVibGljIHN0YXRpYyBjcmVhdGVQaWFubzogUHJvamVjdGlsZU9iamVjdFZpZXdDcmVhdG9yID0gKCBkaWFtZXRlciwgbW9kZWxWaWV3VHJhbnNmb3JtLCBsYW5kZWQgKSA9PiB7XHJcbiAgICBjb25zdCB0cmFuc2Zvcm1lZEJhbGxTaXplID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFYKCBkaWFtZXRlciApO1xyXG4gICAgaWYgKCBsYW5kZWQgKSB7XHJcbiAgICAgIHJldHVybiBuZXcgSW1hZ2UoIHBpYW5vMl9wbmcsIHsgbWF4V2lkdGg6IHRyYW5zZm9ybWVkQmFsbFNpemUgKiAxLjMgfSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHJldHVybiBuZXcgSW1hZ2UoIHBpYW5vMV9wbmcsIHsgbWF4V2lkdGg6IHRyYW5zZm9ybWVkQmFsbFNpemUgKiAxLjEgfSApO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlR29sZkJhbGw6IFByb2plY3RpbGVPYmplY3RWaWV3Q3JlYXRvciA9ICggZGlhbWV0ZXIsIG1vZGVsVmlld1RyYW5zZm9ybSApID0+IHtcclxuICAgIGNvbnN0IHRyYW5zZm9ybWVkQmFsbFNpemUgPSBtb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YVgoIGRpYW1ldGVyICk7XHJcbiAgICByZXR1cm4gbmV3IENpcmNsZSggdHJhbnNmb3JtZWRCYWxsU2l6ZSAvIDIsIHsgZmlsbDogJ3doaXRlJywgc3Ryb2tlOiAnZ3JheScgfSApO1xyXG4gIH07XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlVGFua1NoZWxsOiBQcm9qZWN0aWxlT2JqZWN0Vmlld0NyZWF0b3IgPSAoIGRpYW1ldGVyLCBtb2RlbFZpZXdUcmFuc2Zvcm0gKSA9PiB7XHJcbiAgICBjb25zdCB0cmFuc2Zvcm1lZEJhbGxTaXplID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3RGVsdGFYKCBkaWFtZXRlciApO1xyXG4gICAgcmV0dXJuIG5ldyBJbWFnZSggdGFua1NoZWxsX3BuZywgeyBtYXhIZWlnaHQ6IHRyYW5zZm9ybWVkQmFsbFNpemUgfSApO1xyXG4gIH07XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlQ3VzdG9tKCBkaWFtZXRlcjogbnVtYmVyLCBkcmFnQ29lZmZpY2llbnQ6IG51bWJlciApOiBOb2RlIHtcclxuXHJcbiAgICAvLyBkcmFnIGNvZWZmaWNpZW50cyBlc3RpbWF0ZWQgZnJvbSB0aHJlZSBzb3VyY2VzOlxyXG4gICAgLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRHJhZ19jb2VmZmljaWVudCNEcmFnX2NvZWZmaWNpZW50X2NkX2V4YW1wbGVzXHJcbiAgICAvLyBodHRwczovL3d3dy5ncmMubmFzYS5nb3Yvd3d3L2stMTIvYWlycGxhbmUvc2hhcGVkLmh0bWxcclxuICAgIC8vIGh0dHA6Ly93d3cuYWVyb3NwYWNld2ViLm9yZy9xdWVzdGlvbi9hZXJvZHluYW1pY3MvcTAyMzEuc2h0bWxcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGRyYWdDb2VmZmljaWVudCA+PSAwLjA0ICYmIGRyYWdDb2VmZmljaWVudCA8PSAxLCBgZHJhZyBjb2VmZmljaWVudCAke2RyYWdDb2VmZmljaWVudH0gb3V0IG9mIGJvdW5kc2AgKTtcclxuICAgIGNvbnN0IHJhZGl1cyA9IGRpYW1ldGVyIC8gMjtcclxuICAgIGxldCBzaGFwZTtcclxuICAgIGxldCBhbmdsZTtcclxuICAgIGxldCBuZXdSYWRpdXM7XHJcbiAgICBsZXQgbmV3Q2VudGVyWDtcclxuICAgIGlmICggZHJhZ0NvZWZmaWNpZW50IDw9IDAuNDcgKSB7IC8vIHRlYXJkcm9wIChpbmNsdXNpdmUpIHRvIHNwaGVyZSAoaW5jbHVzaXZlKVxyXG5cclxuICAgICAgLy8gQWxnb3JpdGhtIGZyb20gaHR0cDovL21hdGh3b3JsZC53b2xmcmFtLmNvbS9UZWFyZHJvcEN1cnZlLmh0bWxcclxuICAgICAgLy8gZHJhZyBjb2VmZmljaWVudCByYW5nZXMgZnJvbSBbIDAuMDQgLCAwLjQ3IF0sIGFuZCBtIHJhbmdlcyBmcm9tIDAgdG8gN1xyXG4gICAgICBjb25zdCBtID0gVXRpbHMubGluZWFyKCAwLjA0LCAwLjQ3LCA0LCAwLCBkcmFnQ29lZmZpY2llbnQgKTtcclxuICAgICAgc2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuICAgICAgc2hhcGUubW92ZVRvKCAtcmFkaXVzLCAwICk7XHJcbiAgICAgIGxldCB0O1xyXG4gICAgICBmb3IgKCB0ID0gTWF0aC5QSSAvIDI0OyB0IDwgMiAqIE1hdGguUEk7IHQgKz0gTWF0aC5QSSAvIDI0ICkge1xyXG4gICAgICAgIGNvbnN0IHggPSAtTWF0aC5jb3MoIHQgKSAqIHJhZGl1cztcclxuICAgICAgICBjb25zdCB5ID0gTWF0aC5zaW4oIHQgKSAqIE1hdGgucG93KCBNYXRoLnNpbiggMC41ICogdCApLCBtICkgKiByYWRpdXM7XHJcbiAgICAgICAgc2hhcGUubGluZVRvKCB4LCB5ICk7XHJcbiAgICAgIH1cclxuICAgICAgc2hhcGUubGluZVRvKCAtcmFkaXVzLCAwICk7XHJcblxyXG4gICAgICAvLyB0byBtYWludGFpbiB0aGUgc2FtZSBjcm9zcy1zZWN0aW9uYWwgYXJlYVxyXG4gICAgICBjb25zdCBjdXJyZW50Q3Jvc3NTZWN0aW9uYWxSYWRpdXMgPSAoIHNoYXBlLmJvdW5kcy5tYXhZIC0gc2hhcGUuYm91bmRzLm1pblkgKSAvIDI7XHJcbiAgICAgIGNvbnN0IHNjYWxlRmFjdG9yID0gcmFkaXVzIC8gY3VycmVudENyb3NzU2VjdGlvbmFsUmFkaXVzO1xyXG5cclxuICAgICAgc2hhcGUgPSBzaGFwZS50cmFuc2Zvcm1lZCggTWF0cml4My5zY2FsaW5nKCBzY2FsZUZhY3Rvciwgc2NhbGVGYWN0b3IgKSApO1xyXG5cclxuICAgICAgY29uc3Qgb2JqZWN0Tm9kZSA9IG5ldyBQYXRoKCBzaGFwZSwgeyBmaWxsOiAnYmxhY2snIH0gKTtcclxuXHJcbiAgICAgIC8vIHVzZWQgdG8gc2hpZnQgY2VudGVyIG9udG8gQ09NXHJcbiAgICAgIGNvbnN0IHN0cnV0ID0gbmV3IExpbmUoIG9iamVjdE5vZGUubGVmdCwgMCwgMS41ICogb2JqZWN0Tm9kZS53aWR0aCAtIDIgKiByYWRpdXMsIDAsIHsgdmlzaWJsZTogZmFsc2UgfSApO1xyXG5cclxuICAgICAgcmV0dXJuIG5ldyBOb2RlKCB7IGNoaWxkcmVuOiBbIHN0cnV0LCBvYmplY3ROb2RlIF0gfSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcblxyXG4gICAgICAvLyBzcGhlcmUgKGV4Y2x1c2l2ZSkgdG8ga2luZCBvZiBoZW1pc3BoZXJlIChpbmNsdXNpdmUgKSA9ICggMC40NyAsIDEgKVxyXG4gICAgICBzaGFwZSA9IG5ldyBTaGFwZSgpO1xyXG4gICAgICBzaGFwZS5hcmMoIDAsIDAsIHJhZGl1cywgTWF0aC5QSSAvIDIsIDMgKiBNYXRoLlBJIC8gMiwgZmFsc2UgKTtcclxuICAgICAgc2hhcGUubW92ZVRvKCAwLCAtcmFkaXVzICk7XHJcblxyXG4gICAgICBhbmdsZSA9IFV0aWxzLmxpbmVhciggMC40NywgMS4xNywgTWF0aC5QSSAvIDIsIDAsIGRyYWdDb2VmZmljaWVudCApO1xyXG4gICAgICBuZXdSYWRpdXMgPSByYWRpdXMgLyBNYXRoLnNpbiggYW5nbGUgKTtcclxuICAgICAgbmV3Q2VudGVyWCA9IC1yYWRpdXMgLyBNYXRoLnRhbiggYW5nbGUgKTtcclxuICAgICAgc2hhcGUuYXJjKCBuZXdDZW50ZXJYLCAwLCBuZXdSYWRpdXMsIC1hbmdsZSwgYW5nbGUsIGZhbHNlICk7XHJcbiAgICAgIHJldHVybiBuZXcgUGF0aCggc2hhcGUsIHsgZmlsbDogJ2JsYWNrJyB9ICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5wcm9qZWN0aWxlTW90aW9uLnJlZ2lzdGVyKCAnUHJvamVjdGlsZU9iamVjdFZpZXdGYWN0b3J5JywgUHJvamVjdGlsZU9iamVjdFZpZXdGYWN0b3J5ICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE9BQU8sTUFBTSwrQkFBK0I7QUFDbkQsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxTQUFTQyxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELFNBQVNDLE1BQU0sRUFBRUMsS0FBSyxFQUFFQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUNuRixPQUFPQyxZQUFZLE1BQU0saUNBQWlDO0FBQzFELE9BQU9DLFFBQVEsTUFBTSw2QkFBNkI7QUFDbEQsT0FBT0MsUUFBUSxNQUFNLDZCQUE2QjtBQUNsRCxPQUFPQyxZQUFZLE1BQU0saUNBQWlDO0FBQzFELE9BQU9DLFVBQVUsTUFBTSwrQkFBK0I7QUFDdEQsT0FBT0MsVUFBVSxNQUFNLCtCQUErQjtBQUN0RCxPQUFPQyxVQUFVLE1BQU0sK0JBQStCO0FBQ3RELE9BQU9DLFVBQVUsTUFBTSwrQkFBK0I7QUFDdEQsT0FBT0MsWUFBWSxNQUFNLGlDQUFpQztBQUMxRCxPQUFPQyxZQUFZLE1BQU0saUNBQWlDO0FBQzFELE9BQU9DLGFBQWEsTUFBTSxrQ0FBa0M7QUFDNUQsT0FBT0MsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBR3hELGVBQWUsTUFBTUMsMkJBQTJCLENBQUM7RUFFL0M7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNFLE9BQWNDLGdCQUFnQixHQUFnQ0EsQ0FBRUMsUUFBUSxFQUFFQyxrQkFBa0IsS0FBTTtJQUNoRyxNQUFNQyxtQkFBbUIsR0FBR0Qsa0JBQWtCLENBQUNFLGlCQUFpQixDQUFFSCxRQUFTLENBQUM7SUFDNUUsT0FBTyxJQUFJbkIsTUFBTSxDQUFFcUIsbUJBQW1CLEdBQUcsQ0FB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