// Copyright 2016-2023, University of Colorado Boulder

/**
 * View for a projectile including the flying object and the vectors.
 * Constructed based on many individually passed parameters about the projectile.
 * Listens to the viewProperties for vector visibility Properties.
 * Listens to a DataPoint Property to figure out when to move.
 *
 * @author Andrea Lin (PhET Interactive Simulations)
 */

import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import Multilink from '../../../../axon/js/Multilink.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import { Node } from '../../../../scenery/js/imports.js';
import projectileMotion from '../../projectileMotion.js';
import ProjectileMotionConstants from '../ProjectileMotionConstants.js';
import FreeBodyDiagram from './FreeBodyDiagram.js';
import ProjectileObjectViewFactory from './ProjectileObjectViewFactory.js';
import optionize from '../../../../phet-core/js/optionize.js';
// constants
const VELOCITY_ARROW_FILL = ProjectileMotionConstants.VELOCITY_ARROW_FILL;
const ACCELERATION_ARROW_FILL = ProjectileMotionConstants.ACCELERATION_ARROW_FILL;
const TOTAL_ARROW_TAIL_WIDTH = 6;
const TOTAL_ARROW_HEAD_WIDTH = 12;
const COMPONENT_VELOCITY_ARROW_OPTIONS = {
  fill: VELOCITY_ARROW_FILL,
  stroke: 'black',
  lineWidth: 0.2,
  tailWidth: 2,
  headWidth: 6
};
const COMPONENT_ACCELERATION_ARROW_OPTIONS = {
  fill: ACCELERATION_ARROW_FILL,
  stroke: 'black',
  lineWidth: 0.2,
  tailWidth: 2,
  headWidth: 6
};
const VELOCITY_SCALAR = 15; // scales the velocity arrow representations
const ACCELERATION_SCALAR = 15; // scales the acceleration arrow represenations

class ProjectileNode extends Node {
  /**
   *  @param viewProperties - Properties that determine which vectors are shown
   *  @param dataPointProperty - data for where the projectile is
   *  @param diameter - how big the object is, in meters
   *  @param dragCoefficient - shape of the object
   *  @param modelViewTransform - meters to scale, inverted y-axis, translated origin
   */
  constructor(viewProperties, dataPointProperty, objectType, diameter, dragCoefficient, modelViewTransform, providedOptions) {
    const options = optionize()({
      preventFit: true
    }, providedOptions);
    super(options);
    let unlandedObjectView = null;
    let landedObjectView = null;

    // draw projectile object view, which has separate flying and landed views if it has a benchmark.
    const transformedBallSize = modelViewTransform.modelToViewDeltaX(diameter);
    if (objectType && objectType.viewCreationFunction) {
      unlandedObjectView = objectType.viewCreationFunction(diameter, modelViewTransform, false);
      landedObjectView = objectType.viewCreationFunction(diameter, modelViewTransform, true);
    } else {
      unlandedObjectView = ProjectileObjectViewFactory.createCustom(transformedBallSize, dragCoefficient);
    }
    // Center the object view, and wrap it in a containing node, so we don't require bounds checks when animating
    unlandedObjectView.center = Vector2.ZERO;
    unlandedObjectView = new Node({
      children: [unlandedObjectView]
    });
    this.addChild(unlandedObjectView);
    this.viewPointProperty = new DerivedProperty([dataPointProperty], dataPoint => {
      assert && assert(!dataPoint.apex, 'Projectile current data point should never be the apex');
      const viewPosition = modelViewTransform.modelToViewPosition(dataPoint.position);
      viewPosition.x = Utils.roundSymmetric(viewPosition.x * 10000) / 10000;
      viewPosition.y = Utils.roundSymmetric(viewPosition.y * 10000) / 10000;
      const retVal = {
        viewPosition: viewPosition,
        dataPoint: dataPoint
      };
      return retVal;
    });

    // Add support for velocity vectors
    this.addComponentsVelocityVectors(viewProperties.componentsVelocityVectorsOnProperty);
    this.addTotalVelocityVector(viewProperties.totalVelocityVectorOnProperty);

    // Add support for acceleration vectors if applicable
    if (viewProperties.componentsAccelerationVectorsOnProperty) {
      this.addComponentsAccelerationVectors(viewProperties.componentsAccelerationVectorsOnProperty);
    }
    if (viewProperties.totalAccelerationVectorOnProperty) {
      this.addTotalAccelerationVector(viewProperties.totalAccelerationVectorOnProperty);
    }

    // Add support for force vectors via the FreeBodyDiagram if applicable
    let freeBodyDiagram = null;
    if (!!viewProperties.totalForceVectorOnProperty && !!viewProperties.componentsForceVectorsOnProperty) {
      freeBodyDiagram = new FreeBodyDiagram(this.viewPointProperty, viewProperties.totalForceVectorOnProperty, viewProperties.componentsForceVectorsOnProperty);
      freeBodyDiagram && this.addChild(freeBodyDiagram);

      // will be disposed if hits the ground, but cover the case where it is disposed midair
      this.disposeEmitter.addListener(() => !freeBodyDiagram?.isDisposed && freeBodyDiagram?.dispose());
    }

    // keep track of if this Projectile has been removed from the main layer yet so we don't do it twice.
    let removed = false;

    // Update the projectile's object view.
    const updateProjectileObjectView = viewPoint => {
      const dataPoint = viewPoint.dataPoint;

      // only rotate the object if it doesn't have an assigned benchmark, or it is an object that rotates
      if (objectType ? objectType.rotates : true) {
        let angle;
        if (dataPoint.velocity.x !== 0) {
          angle = Math.atan(dataPoint.velocity.y / dataPoint.velocity.x);
        } else {
          // x velocity is zero
          angle = dataPoint.velocity.y > 0 ? Math.PI / 2 : 3 * Math.PI / 2;
        }
        unlandedObjectView?.setRotation(-angle);
      }
      unlandedObjectView?.setTranslation(viewPoint.viewPosition);
      if (dataPoint.reachedGround) {
        // only remove it once
        if (!removed) {
          removed = true;
          freeBodyDiagram && freeBodyDiagram.dispose();
          if (landedObjectView) {
            landedObjectView.center = viewPoint.viewPosition;
            if (objectType && (objectType.benchmark === 'human' || objectType.benchmark === 'car')) {
              landedObjectView.bottom = landedObjectView.centerY;
            }
            if (unlandedObjectView && this.hasChild(unlandedObjectView)) {
              this.removeChild(unlandedObjectView);
            }
            this.addChild(landedObjectView);
          }
        }
      }
    };
    this.viewPointProperty.link(updateProjectileObjectView);
    this.disposeProjectileNode = () => {
      this.viewPointProperty.dispose();
    };
  }
  addComponentsVelocityVectors(property) {
    // add vector view for velocity x component
    const xVelocityArrow = new ArrowNode(0, 0, 0, 0, COMPONENT_VELOCITY_ARROW_OPTIONS);
    this.addChild(xVelocityArrow);

    // add vector view for velocity y component
    const yVelocityArrow = new ArrowNode(0, 0, 0, 0, COMPONENT_VELOCITY_ARROW_OPTIONS);
    this.addChild(yVelocityArrow);

    // Update component-wise velocity vectors.
    const multilink = Multilink.multilink([property, this.viewPointProperty], (visible, viewPoint) => {
      xVelocityArrow.visible = visible;
      yVelocityArrow.visible = visible;
      if (visible) {
        const viewPosition = viewPoint.viewPosition;
        const dataPoint = viewPoint.dataPoint;
        xVelocityArrow.setTailAndTip(viewPosition.x, viewPosition.y, viewPosition.x + VELOCITY_SCALAR * dataPoint.velocity.x, viewPosition.y);
        yVelocityArrow.setTailAndTip(viewPosition.x, viewPosition.y, viewPosition.x, viewPosition.y - VELOCITY_SCALAR * dataPoint.velocity.y);
      }
    });
    this.disposeEmitter.addListener(() => {
      multilink.dispose();
      xVelocityArrow.dispose();
      yVelocityArrow.dispose();
    });
  }
  addTotalVelocityVector(property) {
    // add vector view for total velocity
    const totalVelocityArrow = new ArrowNode(0, 0, 0, 0, {
      pickable: false,
      fill: VELOCITY_ARROW_FILL,
      tailWidth: TOTAL_ARROW_TAIL_WIDTH,
      headWidth: TOTAL_ARROW_HEAD_WIDTH
    });
    this.addChild(totalVelocityArrow);
    const multilink = Multilink.multilink([property, this.viewPointProperty], (visible, viewPoint) => {
      totalVelocityArrow.visible = visible;
      if (visible) {
        const viewPosition = viewPoint.viewPosition;
        const dataPoint = viewPoint.dataPoint;
        totalVelocityArrow.setTailAndTip(viewPosition.x, viewPosition.y, viewPosition.x + VELOCITY_SCALAR * dataPoint.velocity.x, viewPosition.y - VELOCITY_SCALAR * dataPoint.velocity.y);
      }
    });
    this.disposeEmitter.addListener(() => {
      multilink.dispose();
      totalVelocityArrow.dispose();
    });
  }
  addComponentsAccelerationVectors(property) {
    // add vector view for acceleration x component
    const xAccelerationArrow = new ArrowNode(0, 0, 0, 0, COMPONENT_ACCELERATION_ARROW_OPTIONS);
    this.addChild(xAccelerationArrow);

    // add vector view for acceleration y component
    const yAccelerationArrow = new ArrowNode(0, 0, 0, 0, COMPONENT_ACCELERATION_ARROW_OPTIONS);
    this.addChild(yAccelerationArrow);
    const multilink = Multilink.multilink([property, this.viewPointProperty], (visible, viewPoint) => {
      xAccelerationArrow.visible = visible;
      yAccelerationArrow.visible = visible;
      if (visible) {
        const viewPosition = viewPoint.viewPosition;
        const dataPoint = viewPoint.dataPoint;
        xAccelerationArrow.setTailAndTip(viewPosition.x, viewPosition.y, viewPosition.x + ACCELERATION_SCALAR * dataPoint.acceleration.x, viewPosition.y);
        yAccelerationArrow.setTailAndTip(viewPosition.x, viewPosition.y, viewPosition.x, viewPosition.y - ACCELERATION_SCALAR * dataPoint.acceleration.y);
      }
    });
    this.disposeEmitter.addListener(() => {
      multilink.dispose();
      xAccelerationArrow.dispose();
      yAccelerationArrow.dispose();
    });
  }

  // Add vector that shows the total acceleration
  addTotalAccelerationVector(property) {
    // add vector view for total acceleration
    const totalAccelerationArrow = new ArrowNode(0, 0, 0, 0, {
      pickable: false,
      fill: ACCELERATION_ARROW_FILL,
      tailWidth: TOTAL_ARROW_TAIL_WIDTH,
      headWidth: TOTAL_ARROW_HEAD_WIDTH
    });
    this.addChild(totalAccelerationArrow);
    const totalAccelerationVectorMultilink = Multilink.multilink([property, this.viewPointProperty], (visible, viewPoint) => {
      totalAccelerationArrow.visible = visible;
      if (visible) {
        const viewPosition = viewPoint.viewPosition;
        const dataPoint = viewPoint.dataPoint;
        totalAccelerationArrow.setTailAndTip(viewPosition.x, viewPosition.y, viewPosition.x + ACCELERATION_SCALAR * dataPoint.acceleration.x, viewPosition.y - ACCELERATION_SCALAR * dataPoint.acceleration.y);
      }
    });
    this.disposeEmitter.addListener(() => {
      totalAccelerationVectorMultilink.dispose();
      totalAccelerationArrow.dispose();
    });
  }
  dispose() {
    this.disposeProjectileNode();
    Node.prototype.dispose.call(this);
  }
}
projectileMotion.register('ProjectileNode', ProjectileNode);
export default ProjectileNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJNdWx0aWxpbmsiLCJVdGlscyIsIlZlY3RvcjIiLCJBcnJvd05vZGUiLCJOb2RlIiwicHJvamVjdGlsZU1vdGlvbiIsIlByb2plY3RpbGVNb3Rpb25Db25zdGFudHMiLCJGcmVlQm9keURpYWdyYW0iLCJQcm9qZWN0aWxlT2JqZWN0Vmlld0ZhY3RvcnkiLCJvcHRpb25pemUiLCJWRUxPQ0lUWV9BUlJPV19GSUxMIiwiQUNDRUxFUkFUSU9OX0FSUk9XX0ZJTEwiLCJUT1RBTF9BUlJPV19UQUlMX1dJRFRIIiwiVE9UQUxfQVJST1dfSEVBRF9XSURUSCIsIkNPTVBPTkVOVF9WRUxPQ0lUWV9BUlJPV19PUFRJT05TIiwiZmlsbCIsInN0cm9rZSIsImxpbmVXaWR0aCIsInRhaWxXaWR0aCIsImhlYWRXaWR0aCIsIkNPTVBPTkVOVF9BQ0NFTEVSQVRJT05fQVJST1dfT1BUSU9OUyIsIlZFTE9DSVRZX1NDQUxBUiIsIkFDQ0VMRVJBVElPTl9TQ0FMQVIiLCJQcm9qZWN0aWxlTm9kZSIsImNvbnN0cnVjdG9yIiwidmlld1Byb3BlcnRpZXMiLCJkYXRhUG9pbnRQcm9wZXJ0eSIsIm9iamVjdFR5cGUiLCJkaWFtZXRlciIsImRyYWdDb2VmZmljaWVudCIsIm1vZGVsVmlld1RyYW5zZm9ybSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJwcmV2ZW50Rml0IiwidW5sYW5kZWRPYmplY3RWaWV3IiwibGFuZGVkT2JqZWN0VmlldyIsInRyYW5zZm9ybWVkQmFsbFNpemUiLCJtb2RlbFRvVmlld0RlbHRhWCIsInZpZXdDcmVhdGlvbkZ1bmN0aW9uIiwiY3JlYXRlQ3VzdG9tIiwiY2VudGVyIiwiWkVSTyIsImNoaWxkcmVuIiwiYWRkQ2hpbGQiLCJ2aWV3UG9pbnRQcm9wZXJ0eSIsImRhdGFQb2ludCIsImFzc2VydCIsImFwZXgiLCJ2aWV3UG9zaXRpb24iLCJtb2RlbFRvVmlld1Bvc2l0aW9uIiwicG9zaXRpb24iLCJ4Iiwicm91bmRTeW1tZXRyaWMiLCJ5IiwicmV0VmFsIiwiYWRkQ29tcG9uZW50c1ZlbG9jaXR5VmVjdG9ycyIsImNvbXBvbmVudHNWZWxvY2l0eVZlY3RvcnNPblByb3BlcnR5IiwiYWRkVG90YWxWZWxvY2l0eVZlY3RvciIsInRvdGFsVmVsb2NpdHlWZWN0b3JPblByb3BlcnR5IiwiY29tcG9uZW50c0FjY2VsZXJhdGlvblZlY3RvcnNPblByb3BlcnR5IiwiYWRkQ29tcG9uZW50c0FjY2VsZXJhdGlvblZlY3RvcnMiLCJ0b3RhbEFjY2VsZXJhdGlvblZlY3Rvck9uUHJvcGVydHkiLCJhZGRUb3RhbEFjY2VsZXJhdGlvblZlY3RvciIsImZyZWVCb2R5RGlhZ3JhbSIsInRvdGFsRm9yY2VWZWN0b3JPblByb3BlcnR5IiwiY29tcG9uZW50c0ZvcmNlVmVjdG9yc09uUHJvcGVydHkiLCJkaXNwb3NlRW1pdHRlciIsImFkZExpc3RlbmVyIiwiaXNEaXNwb3NlZCIsImRpc3Bvc2UiLCJyZW1vdmVkIiwidXBkYXRlUHJvamVjdGlsZU9iamVjdFZpZXciLCJ2aWV3UG9pbnQiLCJyb3RhdGVzIiwiYW5nbGUiLCJ2ZWxvY2l0eSIsIk1hdGgiLCJhdGFuIiwiUEkiLCJzZXRSb3RhdGlvbiIsInNldFRyYW5zbGF0aW9uIiwicmVhY2hlZEdyb3VuZCIsImJlbmNobWFyayIsImJvdHRvbSIsImNlbnRlclkiLCJoYXNDaGlsZCIsInJlbW92ZUNoaWxkIiwibGluayIsImRpc3Bvc2VQcm9qZWN0aWxlTm9kZSIsInByb3BlcnR5IiwieFZlbG9jaXR5QXJyb3ciLCJ5VmVsb2NpdHlBcnJvdyIsIm11bHRpbGluayIsInZpc2libGUiLCJzZXRUYWlsQW5kVGlwIiwidG90YWxWZWxvY2l0eUFycm93IiwicGlja2FibGUiLCJ4QWNjZWxlcmF0aW9uQXJyb3ciLCJ5QWNjZWxlcmF0aW9uQXJyb3ciLCJhY2NlbGVyYXRpb24iLCJ0b3RhbEFjY2VsZXJhdGlvbkFycm93IiwidG90YWxBY2NlbGVyYXRpb25WZWN0b3JNdWx0aWxpbmsiLCJwcm90b3R5cGUiLCJjYWxsIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQcm9qZWN0aWxlTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNi0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBWaWV3IGZvciBhIHByb2plY3RpbGUgaW5jbHVkaW5nIHRoZSBmbHlpbmcgb2JqZWN0IGFuZCB0aGUgdmVjdG9ycy5cclxuICogQ29uc3RydWN0ZWQgYmFzZWQgb24gbWFueSBpbmRpdmlkdWFsbHkgcGFzc2VkIHBhcmFtZXRlcnMgYWJvdXQgdGhlIHByb2plY3RpbGUuXHJcbiAqIExpc3RlbnMgdG8gdGhlIHZpZXdQcm9wZXJ0aWVzIGZvciB2ZWN0b3IgdmlzaWJpbGl0eSBQcm9wZXJ0aWVzLlxyXG4gKiBMaXN0ZW5zIHRvIGEgRGF0YVBvaW50IFByb3BlcnR5IHRvIGZpZ3VyZSBvdXQgd2hlbiB0byBtb3ZlLlxyXG4gKlxyXG4gKiBAYXV0aG9yIEFuZHJlYSBMaW4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBNdWx0aWxpbmsgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9NdWx0aWxpbmsuanMnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgQXJyb3dOb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9BcnJvd05vZGUuanMnO1xyXG5pbXBvcnQgeyBOb2RlLCBOb2RlT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBwcm9qZWN0aWxlTW90aW9uIGZyb20gJy4uLy4uL3Byb2plY3RpbGVNb3Rpb24uanMnO1xyXG5pbXBvcnQgUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cyBmcm9tICcuLi9Qcm9qZWN0aWxlTW90aW9uQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEZyZWVCb2R5RGlhZ3JhbSBmcm9tICcuL0ZyZWVCb2R5RGlhZ3JhbS5qcyc7XHJcbmltcG9ydCBQcm9qZWN0aWxlT2JqZWN0Vmlld0ZhY3RvcnkgZnJvbSAnLi9Qcm9qZWN0aWxlT2JqZWN0Vmlld0ZhY3RvcnkuanMnO1xyXG5pbXBvcnQgUHJvamVjdGlsZU1vdGlvblZpZXdQcm9wZXJ0aWVzIGZyb20gJy4vUHJvamVjdGlsZU1vdGlvblZpZXdQcm9wZXJ0aWVzLmpzJztcclxuaW1wb3J0IERhdGFQb2ludCBmcm9tICcuLi9tb2RlbC9EYXRhUG9pbnQuanMnO1xyXG5pbXBvcnQgUHJvamVjdGlsZU9iamVjdFR5cGUgZnJvbSAnLi4vbW9kZWwvUHJvamVjdGlsZU9iamVjdFR5cGUuanMnO1xyXG5pbXBvcnQgTW9kZWxWaWV3VHJhbnNmb3JtMiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IFZFTE9DSVRZX0FSUk9XX0ZJTEwgPSBQcm9qZWN0aWxlTW90aW9uQ29uc3RhbnRzLlZFTE9DSVRZX0FSUk9XX0ZJTEw7XHJcbmNvbnN0IEFDQ0VMRVJBVElPTl9BUlJPV19GSUxMID0gUHJvamVjdGlsZU1vdGlvbkNvbnN0YW50cy5BQ0NFTEVSQVRJT05fQVJST1dfRklMTDtcclxuY29uc3QgVE9UQUxfQVJST1dfVEFJTF9XSURUSCA9IDY7XHJcbmNvbnN0IFRPVEFMX0FSUk9XX0hFQURfV0lEVEggPSAxMjtcclxuY29uc3QgQ09NUE9ORU5UX1ZFTE9DSVRZX0FSUk9XX09QVElPTlMgPSB7XHJcbiAgZmlsbDogVkVMT0NJVFlfQVJST1dfRklMTCxcclxuICBzdHJva2U6ICdibGFjaycsXHJcbiAgbGluZVdpZHRoOiAwLjIsXHJcbiAgdGFpbFdpZHRoOiAyLFxyXG4gIGhlYWRXaWR0aDogNlxyXG59O1xyXG5jb25zdCBDT01QT05FTlRfQUNDRUxFUkFUSU9OX0FSUk9XX09QVElPTlMgPSB7XHJcbiAgZmlsbDogQUNDRUxFUkFUSU9OX0FSUk9XX0ZJTEwsXHJcbiAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gIGxpbmVXaWR0aDogMC4yLFxyXG4gIHRhaWxXaWR0aDogMixcclxuICBoZWFkV2lkdGg6IDZcclxufTtcclxuXHJcbmNvbnN0IFZFTE9DSVRZX1NDQUxBUiA9IDE1OyAvLyBzY2FsZXMgdGhlIHZlbG9jaXR5IGFycm93IHJlcHJlc2VudGF0aW9uc1xyXG5jb25zdCBBQ0NFTEVSQVRJT05fU0NBTEFSID0gMTU7IC8vIHNjYWxlcyB0aGUgYWNjZWxlcmF0aW9uIGFycm93IHJlcHJlc2VuYXRpb25zXHJcblxyXG5leHBvcnQgdHlwZSBWaWV3UG9pbnQgPSB7XHJcbiAgdmlld1Bvc2l0aW9uOiBWZWN0b3IyO1xyXG4gIGRhdGFQb2ludDogRGF0YVBvaW50O1xyXG59O1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuICBwcmV2ZW50Rml0PzogYm9vbGVhbjtcclxufTtcclxudHlwZSBQcm9qZWN0aWxlTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIE5vZGVPcHRpb25zO1xyXG5cclxuY2xhc3MgUHJvamVjdGlsZU5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuICBwcml2YXRlIGRpc3Bvc2VQcm9qZWN0aWxlTm9kZTogKCkgPT4gdm9pZDtcclxuICBwdWJsaWMgcmVhZG9ubHkgdmlld1BvaW50UHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PFZpZXdQb2ludD47XHJcblxyXG4gIC8qKlxyXG4gICAqICBAcGFyYW0gdmlld1Byb3BlcnRpZXMgLSBQcm9wZXJ0aWVzIHRoYXQgZGV0ZXJtaW5lIHdoaWNoIHZlY3RvcnMgYXJlIHNob3duXHJcbiAgICogIEBwYXJhbSBkYXRhUG9pbnRQcm9wZXJ0eSAtIGRhdGEgZm9yIHdoZXJlIHRoZSBwcm9qZWN0aWxlIGlzXHJcbiAgICogIEBwYXJhbSBkaWFtZXRlciAtIGhvdyBiaWcgdGhlIG9iamVjdCBpcywgaW4gbWV0ZXJzXHJcbiAgICogIEBwYXJhbSBkcmFnQ29lZmZpY2llbnQgLSBzaGFwZSBvZiB0aGUgb2JqZWN0XHJcbiAgICogIEBwYXJhbSBtb2RlbFZpZXdUcmFuc2Zvcm0gLSBtZXRlcnMgdG8gc2NhbGUsIGludmVydGVkIHktYXhpcywgdHJhbnNsYXRlZCBvcmlnaW5cclxuICAgKi9cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHZpZXdQcm9wZXJ0aWVzOiBQcm9qZWN0aWxlTW90aW9uVmlld1Byb3BlcnRpZXMsIGRhdGFQb2ludFByb3BlcnR5OiBQcm9wZXJ0eTxEYXRhUG9pbnQ+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgb2JqZWN0VHlwZTogUHJvamVjdGlsZU9iamVjdFR5cGUsIGRpYW1ldGVyOiBudW1iZXIsIGRyYWdDb2VmZmljaWVudDogbnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgbW9kZWxWaWV3VHJhbnNmb3JtOiBNb2RlbFZpZXdUcmFuc2Zvcm0yLCBwcm92aWRlZE9wdGlvbnM/OiBQcm9qZWN0aWxlTm9kZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxQcm9qZWN0aWxlTm9kZU9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG4gICAgICBwcmV2ZW50Rml0OiB0cnVlXHJcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIGxldCB1bmxhbmRlZE9iamVjdFZpZXc6IE5vZGUgfCBudWxsID0gbnVsbDtcclxuICAgIGxldCBsYW5kZWRPYmplY3RWaWV3OiBOb2RlIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gICAgLy8gZHJhdyBwcm9qZWN0aWxlIG9iamVjdCB2aWV3LCB3aGljaCBoYXMgc2VwYXJhdGUgZmx5aW5nIGFuZCBsYW5kZWQgdmlld3MgaWYgaXQgaGFzIGEgYmVuY2htYXJrLlxyXG4gICAgY29uc3QgdHJhbnNmb3JtZWRCYWxsU2l6ZSA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggZGlhbWV0ZXIgKTtcclxuICAgIGlmICggb2JqZWN0VHlwZSAmJiBvYmplY3RUeXBlLnZpZXdDcmVhdGlvbkZ1bmN0aW9uICkge1xyXG4gICAgICB1bmxhbmRlZE9iamVjdFZpZXcgPSBvYmplY3RUeXBlLnZpZXdDcmVhdGlvbkZ1bmN0aW9uKCBkaWFtZXRlciwgbW9kZWxWaWV3VHJhbnNmb3JtLCBmYWxzZSApO1xyXG4gICAgICBsYW5kZWRPYmplY3RWaWV3ID0gb2JqZWN0VHlwZS52aWV3Q3JlYXRpb25GdW5jdGlvbiggZGlhbWV0ZXIsIG1vZGVsVmlld1RyYW5zZm9ybSwgdHJ1ZSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHVubGFuZGVkT2JqZWN0VmlldyA9IFByb2plY3RpbGVPYmplY3RWaWV3RmFjdG9yeS5jcmVhdGVDdXN0b20oIHRyYW5zZm9ybWVkQmFsbFNpemUsIGRyYWdDb2VmZmljaWVudCApO1xyXG4gICAgfVxyXG4gICAgLy8gQ2VudGVyIHRoZSBvYmplY3QgdmlldywgYW5kIHdyYXAgaXQgaW4gYSBjb250YWluaW5nIG5vZGUsIHNvIHdlIGRvbid0IHJlcXVpcmUgYm91bmRzIGNoZWNrcyB3aGVuIGFuaW1hdGluZ1xyXG4gICAgdW5sYW5kZWRPYmplY3RWaWV3LmNlbnRlciA9IFZlY3RvcjIuWkVSTztcclxuICAgIHVubGFuZGVkT2JqZWN0VmlldyA9IG5ldyBOb2RlKCB7XHJcbiAgICAgIGNoaWxkcmVuOiBbIHVubGFuZGVkT2JqZWN0VmlldyBdXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB1bmxhbmRlZE9iamVjdFZpZXcgKTtcclxuXHJcbiAgICB0aGlzLnZpZXdQb2ludFByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBkYXRhUG9pbnRQcm9wZXJ0eSBdLCBkYXRhUG9pbnQgPT4ge1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhZGF0YVBvaW50LmFwZXgsICdQcm9qZWN0aWxlIGN1cnJlbnQgZGF0YSBwb2ludCBzaG91bGQgbmV2ZXIgYmUgdGhlIGFwZXgnICk7XHJcbiAgICAgIGNvbnN0IHZpZXdQb3NpdGlvbiA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBkYXRhUG9pbnQucG9zaXRpb24gKTtcclxuICAgICAgdmlld1Bvc2l0aW9uLnggPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggdmlld1Bvc2l0aW9uLnggKiAxMDAwMCApIC8gMTAwMDA7XHJcbiAgICAgIHZpZXdQb3NpdGlvbi55ID0gVXRpbHMucm91bmRTeW1tZXRyaWMoIHZpZXdQb3NpdGlvbi55ICogMTAwMDAgKSAvIDEwMDAwO1xyXG4gICAgICBjb25zdCByZXRWYWw6IFZpZXdQb2ludCA9IHtcclxuICAgICAgICB2aWV3UG9zaXRpb246IHZpZXdQb3NpdGlvbixcclxuICAgICAgICBkYXRhUG9pbnQ6IGRhdGFQb2ludFxyXG4gICAgICB9O1xyXG4gICAgICByZXR1cm4gcmV0VmFsO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIEFkZCBzdXBwb3J0IGZvciB2ZWxvY2l0eSB2ZWN0b3JzXHJcbiAgICB0aGlzLmFkZENvbXBvbmVudHNWZWxvY2l0eVZlY3RvcnMoIHZpZXdQcm9wZXJ0aWVzLmNvbXBvbmVudHNWZWxvY2l0eVZlY3RvcnNPblByb3BlcnR5ICk7XHJcbiAgICB0aGlzLmFkZFRvdGFsVmVsb2NpdHlWZWN0b3IoIHZpZXdQcm9wZXJ0aWVzLnRvdGFsVmVsb2NpdHlWZWN0b3JPblByb3BlcnR5ICk7XHJcblxyXG4gICAgLy8gQWRkIHN1cHBvcnQgZm9yIGFjY2VsZXJhdGlvbiB2ZWN0b3JzIGlmIGFwcGxpY2FibGVcclxuICAgIGlmICggdmlld1Byb3BlcnRpZXMuY29tcG9uZW50c0FjY2VsZXJhdGlvblZlY3RvcnNPblByb3BlcnR5ICkge1xyXG4gICAgICB0aGlzLmFkZENvbXBvbmVudHNBY2NlbGVyYXRpb25WZWN0b3JzKCB2aWV3UHJvcGVydGllcy5jb21wb25lbnRzQWNjZWxlcmF0aW9uVmVjdG9yc09uUHJvcGVydHkgKTtcclxuICAgIH1cclxuICAgIGlmICggdmlld1Byb3BlcnRpZXMudG90YWxBY2NlbGVyYXRpb25WZWN0b3JPblByb3BlcnR5ICkge1xyXG4gICAgICB0aGlzLmFkZFRvdGFsQWNjZWxlcmF0aW9uVmVjdG9yKCB2aWV3UHJvcGVydGllcy50b3RhbEFjY2VsZXJhdGlvblZlY3Rvck9uUHJvcGVydHkgKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gQWRkIHN1cHBvcnQgZm9yIGZvcmNlIHZlY3RvcnMgdmlhIHRoZSBGcmVlQm9keURpYWdyYW0gaWYgYXBwbGljYWJsZVxyXG4gICAgbGV0IGZyZWVCb2R5RGlhZ3JhbTogRnJlZUJvZHlEaWFncmFtIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gICAgaWYgKCAhIXZpZXdQcm9wZXJ0aWVzLnRvdGFsRm9yY2VWZWN0b3JPblByb3BlcnR5ICYmICEhdmlld1Byb3BlcnRpZXMuY29tcG9uZW50c0ZvcmNlVmVjdG9yc09uUHJvcGVydHkgKSB7XHJcbiAgICAgIGZyZWVCb2R5RGlhZ3JhbSA9IG5ldyBGcmVlQm9keURpYWdyYW0oIHRoaXMudmlld1BvaW50UHJvcGVydHksIHZpZXdQcm9wZXJ0aWVzLnRvdGFsRm9yY2VWZWN0b3JPblByb3BlcnR5LFxyXG4gICAgICAgIHZpZXdQcm9wZXJ0aWVzLmNvbXBvbmVudHNGb3JjZVZlY3RvcnNPblByb3BlcnR5ICk7XHJcbiAgICAgIGZyZWVCb2R5RGlhZ3JhbSAmJiB0aGlzLmFkZENoaWxkKCBmcmVlQm9keURpYWdyYW0gKTtcclxuXHJcbiAgICAgIC8vIHdpbGwgYmUgZGlzcG9zZWQgaWYgaGl0cyB0aGUgZ3JvdW5kLCBidXQgY292ZXIgdGhlIGNhc2Ugd2hlcmUgaXQgaXMgZGlzcG9zZWQgbWlkYWlyXHJcbiAgICAgIHRoaXMuZGlzcG9zZUVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+ICFmcmVlQm9keURpYWdyYW0/LmlzRGlzcG9zZWQgJiYgZnJlZUJvZHlEaWFncmFtPy5kaXNwb3NlKCkgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBrZWVwIHRyYWNrIG9mIGlmIHRoaXMgUHJvamVjdGlsZSBoYXMgYmVlbiByZW1vdmVkIGZyb20gdGhlIG1haW4gbGF5ZXIgeWV0IHNvIHdlIGRvbid0IGRvIGl0IHR3aWNlLlxyXG4gICAgbGV0IHJlbW92ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBVcGRhdGUgdGhlIHByb2plY3RpbGUncyBvYmplY3Qgdmlldy5cclxuICAgIGNvbnN0IHVwZGF0ZVByb2plY3RpbGVPYmplY3RWaWV3ID0gKCB2aWV3UG9pbnQ6IFZpZXdQb2ludCApOiB2b2lkID0+IHtcclxuICAgICAgY29uc3QgZGF0YVBvaW50ID0gdmlld1BvaW50LmRhdGFQb2ludDtcclxuXHJcbiAgICAgIC8vIG9ubHkgcm90YXRlIHRoZSBvYmplY3QgaWYgaXQgZG9lc24ndCBoYXZlIGFuIGFzc2lnbmVkIGJlbmNobWFyaywgb3IgaXQgaXMgYW4gb2JqZWN0IHRoYXQgcm90YXRlc1xyXG4gICAgICBpZiAoIG9iamVjdFR5cGUgPyBvYmplY3RUeXBlLnJvdGF0ZXMgOiB0cnVlICkge1xyXG4gICAgICAgIGxldCBhbmdsZTtcclxuICAgICAgICBpZiAoIGRhdGFQb2ludC52ZWxvY2l0eS54ICE9PSAwICkge1xyXG4gICAgICAgICAgYW5nbGUgPSBNYXRoLmF0YW4oIGRhdGFQb2ludC52ZWxvY2l0eS55IC8gZGF0YVBvaW50LnZlbG9jaXR5LnggKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7IC8vIHggdmVsb2NpdHkgaXMgemVyb1xyXG4gICAgICAgICAgYW5nbGUgPSBkYXRhUG9pbnQudmVsb2NpdHkueSA+IDAgPyBNYXRoLlBJIC8gMiA6IDMgKiBNYXRoLlBJIC8gMjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdW5sYW5kZWRPYmplY3RWaWV3Py5zZXRSb3RhdGlvbiggLWFuZ2xlICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHVubGFuZGVkT2JqZWN0Vmlldz8uc2V0VHJhbnNsYXRpb24oIHZpZXdQb2ludC52aWV3UG9zaXRpb24gKTtcclxuXHJcbiAgICAgIGlmICggZGF0YVBvaW50LnJlYWNoZWRHcm91bmQgKSB7XHJcblxyXG4gICAgICAgIC8vIG9ubHkgcmVtb3ZlIGl0IG9uY2VcclxuICAgICAgICBpZiAoICFyZW1vdmVkICkge1xyXG4gICAgICAgICAgcmVtb3ZlZCA9IHRydWU7XHJcbiAgICAgICAgICBmcmVlQm9keURpYWdyYW0gJiYgZnJlZUJvZHlEaWFncmFtLmRpc3Bvc2UoKTtcclxuXHJcbiAgICAgICAgICBpZiAoIGxhbmRlZE9iamVjdFZpZXcgKSB7XHJcbiAgICAgICAgICAgIGxhbmRlZE9iamVjdFZpZXcuY2VudGVyID0gdmlld1BvaW50LnZpZXdQb3NpdGlvbjtcclxuICAgICAgICAgICAgaWYgKCBvYmplY3RUeXBlICYmICggb2JqZWN0VHlwZS5iZW5jaG1hcmsgPT09ICdodW1hbicgfHwgb2JqZWN0VHlwZS5iZW5jaG1hcmsgPT09ICdjYXInICkgKSB7XHJcbiAgICAgICAgICAgICAgbGFuZGVkT2JqZWN0Vmlldy5ib3R0b20gPSBsYW5kZWRPYmplY3RWaWV3LmNlbnRlclk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCB1bmxhbmRlZE9iamVjdFZpZXcgJiYgdGhpcy5oYXNDaGlsZCggdW5sYW5kZWRPYmplY3RWaWV3ICkgKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDaGlsZCggdW5sYW5kZWRPYmplY3RWaWV3ICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5hZGRDaGlsZCggbGFuZGVkT2JqZWN0VmlldyApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnZpZXdQb2ludFByb3BlcnR5LmxpbmsoIHVwZGF0ZVByb2plY3RpbGVPYmplY3RWaWV3ICk7XHJcblxyXG4gICAgdGhpcy5kaXNwb3NlUHJvamVjdGlsZU5vZGUgPSAoKSA9PiB7XHJcbiAgICAgIHRoaXMudmlld1BvaW50UHJvcGVydHkuZGlzcG9zZSgpO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYWRkQ29tcG9uZW50c1ZlbG9jaXR5VmVjdG9ycyggcHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+ICk6IHZvaWQge1xyXG5cclxuICAgIC8vIGFkZCB2ZWN0b3IgdmlldyBmb3IgdmVsb2NpdHkgeCBjb21wb25lbnRcclxuICAgIGNvbnN0IHhWZWxvY2l0eUFycm93ID0gbmV3IEFycm93Tm9kZSggMCwgMCwgMCwgMCwgQ09NUE9ORU5UX1ZFTE9DSVRZX0FSUk9XX09QVElPTlMgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHhWZWxvY2l0eUFycm93ICk7XHJcblxyXG4gICAgLy8gYWRkIHZlY3RvciB2aWV3IGZvciB2ZWxvY2l0eSB5IGNvbXBvbmVudFxyXG4gICAgY29uc3QgeVZlbG9jaXR5QXJyb3cgPSBuZXcgQXJyb3dOb2RlKCAwLCAwLCAwLCAwLCBDT01QT05FTlRfVkVMT0NJVFlfQVJST1dfT1BUSU9OUyApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggeVZlbG9jaXR5QXJyb3cgKTtcclxuXHJcblxyXG4gICAgLy8gVXBkYXRlIGNvbXBvbmVudC13aXNlIHZlbG9jaXR5IHZlY3RvcnMuXHJcbiAgICBjb25zdCBtdWx0aWxpbmsgPSBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIHByb3BlcnR5LCB0aGlzLnZpZXdQb2ludFByb3BlcnR5IF0sICggdmlzaWJsZSwgdmlld1BvaW50ICkgPT4ge1xyXG4gICAgICB4VmVsb2NpdHlBcnJvdy52aXNpYmxlID0gdmlzaWJsZTtcclxuICAgICAgeVZlbG9jaXR5QXJyb3cudmlzaWJsZSA9IHZpc2libGU7XHJcblxyXG4gICAgICBpZiAoIHZpc2libGUgKSB7XHJcbiAgICAgICAgY29uc3Qgdmlld1Bvc2l0aW9uID0gdmlld1BvaW50LnZpZXdQb3NpdGlvbjtcclxuICAgICAgICBjb25zdCBkYXRhUG9pbnQgPSB2aWV3UG9pbnQuZGF0YVBvaW50O1xyXG4gICAgICAgIHhWZWxvY2l0eUFycm93LnNldFRhaWxBbmRUaXAoIHZpZXdQb3NpdGlvbi54LCB2aWV3UG9zaXRpb24ueSwgdmlld1Bvc2l0aW9uLnggKyBWRUxPQ0lUWV9TQ0FMQVIgKiBkYXRhUG9pbnQudmVsb2NpdHkueCwgdmlld1Bvc2l0aW9uLnkgKTtcclxuICAgICAgICB5VmVsb2NpdHlBcnJvdy5zZXRUYWlsQW5kVGlwKCB2aWV3UG9zaXRpb24ueCwgdmlld1Bvc2l0aW9uLnksIHZpZXdQb3NpdGlvbi54LCB2aWV3UG9zaXRpb24ueSAtIFZFTE9DSVRZX1NDQUxBUiAqIGRhdGFQb2ludC52ZWxvY2l0eS55ICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgIG11bHRpbGluay5kaXNwb3NlKCk7XHJcbiAgICAgIHhWZWxvY2l0eUFycm93LmRpc3Bvc2UoKTtcclxuICAgICAgeVZlbG9jaXR5QXJyb3cuZGlzcG9zZSgpO1xyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhZGRUb3RhbFZlbG9jaXR5VmVjdG9yKCBwcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj4gKTogdm9pZCB7XHJcblxyXG4gICAgLy8gYWRkIHZlY3RvciB2aWV3IGZvciB0b3RhbCB2ZWxvY2l0eVxyXG4gICAgY29uc3QgdG90YWxWZWxvY2l0eUFycm93ID0gbmV3IEFycm93Tm9kZSggMCwgMCwgMCwgMCwge1xyXG4gICAgICBwaWNrYWJsZTogZmFsc2UsXHJcbiAgICAgIGZpbGw6IFZFTE9DSVRZX0FSUk9XX0ZJTEwsXHJcbiAgICAgIHRhaWxXaWR0aDogVE9UQUxfQVJST1dfVEFJTF9XSURUSCxcclxuICAgICAgaGVhZFdpZHRoOiBUT1RBTF9BUlJPV19IRUFEX1dJRFRIXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB0b3RhbFZlbG9jaXR5QXJyb3cgKTtcclxuXHJcbiAgICBjb25zdCBtdWx0aWxpbmsgPSBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIHByb3BlcnR5LCB0aGlzLnZpZXdQb2ludFByb3BlcnR5IF0sICggdmlzaWJsZSwgdmlld1BvaW50ICkgPT4ge1xyXG4gICAgICB0b3RhbFZlbG9jaXR5QXJyb3cudmlzaWJsZSA9IHZpc2libGU7XHJcblxyXG4gICAgICBpZiAoIHZpc2libGUgKSB7XHJcbiAgICAgICAgY29uc3Qgdmlld1Bvc2l0aW9uID0gdmlld1BvaW50LnZpZXdQb3NpdGlvbjtcclxuICAgICAgICBjb25zdCBkYXRhUG9pbnQgPSB2aWV3UG9pbnQuZGF0YVBvaW50O1xyXG4gICAgICAgIHRvdGFsVmVsb2NpdHlBcnJvdy5zZXRUYWlsQW5kVGlwKCB2aWV3UG9zaXRpb24ueCwgdmlld1Bvc2l0aW9uLnksXHJcbiAgICAgICAgICB2aWV3UG9zaXRpb24ueCArIFZFTE9DSVRZX1NDQUxBUiAqIGRhdGFQb2ludC52ZWxvY2l0eS54LFxyXG4gICAgICAgICAgdmlld1Bvc2l0aW9uLnkgLSBWRUxPQ0lUWV9TQ0FMQVIgKiBkYXRhUG9pbnQudmVsb2NpdHkueVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgIG11bHRpbGluay5kaXNwb3NlKCk7XHJcbiAgICAgIHRvdGFsVmVsb2NpdHlBcnJvdy5kaXNwb3NlKCk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFkZENvbXBvbmVudHNBY2NlbGVyYXRpb25WZWN0b3JzKCBwcm9wZXJ0eTogUHJvcGVydHk8Ym9vbGVhbj4gKTogdm9pZCB7XHJcblxyXG4gICAgLy8gYWRkIHZlY3RvciB2aWV3IGZvciBhY2NlbGVyYXRpb24geCBjb21wb25lbnRcclxuICAgIGNvbnN0IHhBY2NlbGVyYXRpb25BcnJvdyA9IG5ldyBBcnJvd05vZGUoIDAsIDAsIDAsIDAsIENPTVBPTkVOVF9BQ0NFTEVSQVRJT05fQVJST1dfT1BUSU9OUyApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggeEFjY2VsZXJhdGlvbkFycm93ICk7XHJcblxyXG4gICAgLy8gYWRkIHZlY3RvciB2aWV3IGZvciBhY2NlbGVyYXRpb24geSBjb21wb25lbnRcclxuICAgIGNvbnN0IHlBY2NlbGVyYXRpb25BcnJvdyA9IG5ldyBBcnJvd05vZGUoIDAsIDAsIDAsIDAsIENPTVBPTkVOVF9BQ0NFTEVSQVRJT05fQVJST1dfT1BUSU9OUyApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggeUFjY2VsZXJhdGlvbkFycm93ICk7XHJcblxyXG4gICAgY29uc3QgbXVsdGlsaW5rID0gTXVsdGlsaW5rLm11bHRpbGluayggW1xyXG4gICAgICBwcm9wZXJ0eSxcclxuICAgICAgdGhpcy52aWV3UG9pbnRQcm9wZXJ0eVxyXG4gICAgXSwgKCB2aXNpYmxlLCB2aWV3UG9pbnQgKSA9PiB7XHJcbiAgICAgIHhBY2NlbGVyYXRpb25BcnJvdy52aXNpYmxlID0gdmlzaWJsZTtcclxuICAgICAgeUFjY2VsZXJhdGlvbkFycm93LnZpc2libGUgPSB2aXNpYmxlO1xyXG5cclxuICAgICAgaWYgKCB2aXNpYmxlICkge1xyXG4gICAgICAgIGNvbnN0IHZpZXdQb3NpdGlvbiA9IHZpZXdQb2ludC52aWV3UG9zaXRpb247XHJcbiAgICAgICAgY29uc3QgZGF0YVBvaW50ID0gdmlld1BvaW50LmRhdGFQb2ludDtcclxuXHJcbiAgICAgICAgeEFjY2VsZXJhdGlvbkFycm93LnNldFRhaWxBbmRUaXAoXHJcbiAgICAgICAgICB2aWV3UG9zaXRpb24ueCxcclxuICAgICAgICAgIHZpZXdQb3NpdGlvbi55LFxyXG4gICAgICAgICAgdmlld1Bvc2l0aW9uLnggKyBBQ0NFTEVSQVRJT05fU0NBTEFSICogZGF0YVBvaW50LmFjY2VsZXJhdGlvbi54LFxyXG4gICAgICAgICAgdmlld1Bvc2l0aW9uLnlcclxuICAgICAgICApO1xyXG4gICAgICAgIHlBY2NlbGVyYXRpb25BcnJvdy5zZXRUYWlsQW5kVGlwKFxyXG4gICAgICAgICAgdmlld1Bvc2l0aW9uLngsXHJcbiAgICAgICAgICB2aWV3UG9zaXRpb24ueSxcclxuICAgICAgICAgIHZpZXdQb3NpdGlvbi54LFxyXG4gICAgICAgICAgdmlld1Bvc2l0aW9uLnkgLSBBQ0NFTEVSQVRJT05fU0NBTEFSICogZGF0YVBvaW50LmFjY2VsZXJhdGlvbi55XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZGlzcG9zZUVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHtcclxuICAgICAgbXVsdGlsaW5rLmRpc3Bvc2UoKTtcclxuICAgICAgeEFjY2VsZXJhdGlvbkFycm93LmRpc3Bvc2UoKTtcclxuICAgICAgeUFjY2VsZXJhdGlvbkFycm93LmRpc3Bvc2UoKTtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8vIEFkZCB2ZWN0b3IgdGhhdCBzaG93cyB0aGUgdG90YWwgYWNjZWxlcmF0aW9uXHJcbiAgcHJpdmF0ZSBhZGRUb3RhbEFjY2VsZXJhdGlvblZlY3RvciggcHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+ICk6IHZvaWQge1xyXG5cclxuICAgIC8vIGFkZCB2ZWN0b3IgdmlldyBmb3IgdG90YWwgYWNjZWxlcmF0aW9uXHJcbiAgICBjb25zdCB0b3RhbEFjY2VsZXJhdGlvbkFycm93ID0gbmV3IEFycm93Tm9kZSggMCwgMCwgMCwgMCwge1xyXG4gICAgICBwaWNrYWJsZTogZmFsc2UsXHJcbiAgICAgIGZpbGw6IEFDQ0VMRVJBVElPTl9BUlJPV19GSUxMLFxyXG4gICAgICB0YWlsV2lkdGg6IFRPVEFMX0FSUk9XX1RBSUxfV0lEVEgsXHJcbiAgICAgIGhlYWRXaWR0aDogVE9UQUxfQVJST1dfSEVBRF9XSURUSFxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggdG90YWxBY2NlbGVyYXRpb25BcnJvdyApO1xyXG5cclxuICAgIGNvbnN0IHRvdGFsQWNjZWxlcmF0aW9uVmVjdG9yTXVsdGlsaW5rID0gTXVsdGlsaW5rLm11bHRpbGluayggW1xyXG4gICAgICBwcm9wZXJ0eSxcclxuICAgICAgdGhpcy52aWV3UG9pbnRQcm9wZXJ0eVxyXG4gICAgXSwgKCB2aXNpYmxlLCB2aWV3UG9pbnQgKSA9PiB7XHJcbiAgICAgIHRvdGFsQWNjZWxlcmF0aW9uQXJyb3cudmlzaWJsZSA9IHZpc2libGU7XHJcblxyXG4gICAgICBpZiAoIHZpc2libGUgKSB7XHJcbiAgICAgICAgY29uc3Qgdmlld1Bvc2l0aW9uID0gdmlld1BvaW50LnZpZXdQb3NpdGlvbjtcclxuICAgICAgICBjb25zdCBkYXRhUG9pbnQgPSB2aWV3UG9pbnQuZGF0YVBvaW50O1xyXG5cclxuICAgICAgICB0b3RhbEFjY2VsZXJhdGlvbkFycm93LnNldFRhaWxBbmRUaXAoIHZpZXdQb3NpdGlvbi54LCB2aWV3UG9zaXRpb24ueSxcclxuICAgICAgICAgIHZpZXdQb3NpdGlvbi54ICsgQUNDRUxFUkFUSU9OX1NDQUxBUiAqIGRhdGFQb2ludC5hY2NlbGVyYXRpb24ueCxcclxuICAgICAgICAgIHZpZXdQb3NpdGlvbi55IC0gQUNDRUxFUkFUSU9OX1NDQUxBUiAqIGRhdGFQb2ludC5hY2NlbGVyYXRpb24ueVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmRpc3Bvc2VFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgIHRvdGFsQWNjZWxlcmF0aW9uVmVjdG9yTXVsdGlsaW5rLmRpc3Bvc2UoKTtcclxuICAgICAgdG90YWxBY2NlbGVyYXRpb25BcnJvdy5kaXNwb3NlKCk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzcG9zZVByb2plY3RpbGVOb2RlKCk7XHJcbiAgICBOb2RlLnByb3RvdHlwZS5kaXNwb3NlLmNhbGwoIHRoaXMgKTtcclxuICB9XHJcbn1cclxuXHJcbnByb2plY3RpbGVNb3Rpb24ucmVnaXN0ZXIoICdQcm9qZWN0aWxlTm9kZScsIFByb2plY3RpbGVOb2RlICk7XHJcbmV4cG9ydCBkZWZhdWx0IFByb2plY3RpbGVOb2RlOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLFNBQVMsTUFBTSxrQ0FBa0M7QUFDeEQsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxPQUFPLE1BQU0sK0JBQStCO0FBQ25ELE9BQU9DLFNBQVMsTUFBTSwwQ0FBMEM7QUFDaEUsU0FBU0MsSUFBSSxRQUFxQixtQ0FBbUM7QUFDckUsT0FBT0MsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBQ3hELE9BQU9DLHlCQUF5QixNQUFNLGlDQUFpQztBQUN2RSxPQUFPQyxlQUFlLE1BQU0sc0JBQXNCO0FBQ2xELE9BQU9DLDJCQUEyQixNQUFNLGtDQUFrQztBQU0xRSxPQUFPQyxTQUFTLE1BQU0sdUNBQXVDO0FBRzdEO0FBQ0EsTUFBTUMsbUJBQW1CLEdBQUdKLHlCQUF5QixDQUFDSSxt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