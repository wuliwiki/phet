// Copyright 2021-2023, University of Colorado Boulder

/**
 * GuideNode displays a guide, which consists of a fulcrum, to which are attached 2 arms.  One arm corresponds to the
 * incident angle, while the other corresponds to the transmitted angle. An optic has a pair of guides, positioned at
 * the top and bottom of the optic - see GuidesNode.
 *
 * @author Sarah Chang (Swarthmore College)
 * @author Chris Malley (PixelZoom, Inc.)
 */
import Vector2 from '../../../../dot/js/Vector2.js';
import { Circle, Node, Rectangle } from '../../../../scenery/js/imports.js';
import GOColors from '../../common/GOColors.js';
import geometricOptics from '../../geometricOptics.js';
// constants, in view coordinates
const FULCRUM_RADIUS = 5;
const ARM_WIDTH = 70;
const ARM_HEIGHT = 6;
const FULCRUM_OPTIONS = {
  fill: GOColors.guideFulcrumFillProperty,
  stroke: GOColors.guideStrokeProperty
};
const ARM_STROKE_PROPERTY = GOColors.guideStrokeProperty;
export default class GuideNode extends Node {
  constructor(guide, armColor, modelViewTransform) {
    const fulcrumNode = new Circle(FULCRUM_RADIUS, FULCRUM_OPTIONS);

    // The arms are two rectangles, with left center side laying on fulcrum initially.
    const incidentArmNode = createArmNode(armColor);
    const transmittedArmNode = createArmNode(armColor);
    super({
      children: [incidentArmNode, transmittedArmNode, fulcrumNode]
    });
    this.guide = guide;
    this.modelViewTransform = modelViewTransform;
    guide.fulcrumPositionProperty.link(fulcrumPosition => {
      // fulcrum position
      const viewFulcrumPosition = modelViewTransform.modelToViewPosition(fulcrumPosition);
      fulcrumNode.center = viewFulcrumPosition;

      // position the arms
      setArmPosition(incidentArmNode, viewFulcrumPosition, guide.incidentAngleProperty.value);
      setArmPosition(transmittedArmNode, viewFulcrumPosition, guide.transmittedAngleProperty.value);
    });

    // update position and angle of incident arm
    guide.incidentAngleProperty.link(incidentAngle => this.updateArm(incidentArmNode, incidentAngle));

    // update position and angle of transmitted arm
    guide.transmittedAngleProperty.link(transmittedAngle => this.updateArm(transmittedArmNode, transmittedAngle));
  }

  /**
   * Updates the angle and position of an arm.
   * @param armNode - incident or transmitted arm (rectangle) to be rotated and positioned
   * @param angle - incident or transmitted angle
   */
  updateArm(armNode, angle) {
    assert && assert(isFinite(angle));
    const viewFulcrumPosition = this.modelViewTransform.modelToViewPosition(this.guide.fulcrumPositionProperty.value);

    // because rotateAround prepends the transform
    armNode.rotation = 0;

    // The model-view transform is Y-inverted, so a positive rotation in the model is counterclockwise (negative) in the view.
    armNode.rotateAround(viewFulcrumPosition, -angle);

    // position of the arm
    setArmPosition(armNode, viewFulcrumPosition, angle);
  }

  /**
   * Creates an icon for guides, to be used with checkbox. This is intended to be a caricature of the actual guides.
   */
  static createIcon(armColor = GOColors.guideArm1FillProperty) {
    // constants
    const fulcrumRadius = 5;
    const armWidth = 50;
    const armHeight = 1.25 * fulcrumRadius;
    const angle = Math.PI / 15;

    // Nodes
    const fulcrumNode = new Circle(fulcrumRadius, FULCRUM_OPTIONS);
    const armOptions = {
      stroke: ARM_STROKE_PROPERTY,
      fill: armColor
    };
    const leftArmNode = new Rectangle(0, 0, armWidth, armHeight, armOptions);
    const rightArmNode = new Rectangle(0, 0, armWidth, armHeight, armOptions);

    // Layout
    leftArmNode.rotation = -angle;
    rightArmNode.rotation = angle;
    rightArmNode.left = leftArmNode.right;
    rightArmNode.top = leftArmNode.top;
    fulcrumNode.centerX = leftArmNode.right;
    fulcrumNode.centerY = leftArmNode.top + fulcrumRadius / 2;
    return new Node({
      scale: 0.4,
      children: [leftArmNode, rightArmNode, fulcrumNode]
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
}

/**
 * Creates one of the guide arms.
 */
function createArmNode(armColor) {
  return new Rectangle(0, 0, ARM_WIDTH, ARM_HEIGHT, {
    stroke: ARM_STROKE_PROPERTY,
    fill: armColor
  });
}

/**
 * Sets the position of an arm such that its left center is on the fulcrum point.
 */
function setArmPosition(armNode, viewFulcrumPosition, angle) {
  assert && assert(isFinite(angle));

  // Center of the arm is offset from the fulcrum point.
  // The model-view transform is Y-inverted, so a positive rotation in the model is counterclockwise (negative) in the view.
  armNode.center = Vector2.createPolar(ARM_WIDTH / 2, -angle).plus(viewFulcrumPosition);
}
geometricOptics.register('GuideNode', GuideNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiQ2lyY2xlIiwiTm9kZSIsIlJlY3RhbmdsZSIsIkdPQ29sb3JzIiwiZ2VvbWV0cmljT3B0aWNzIiwiRlVMQ1JVTV9SQURJVVMiLCJBUk1fV0lEVEgiLCJBUk1fSEVJR0hUIiwiRlVMQ1JVTV9PUFRJT05TIiwiZmlsbCIsImd1aWRlRnVsY3J1bUZpbGxQcm9wZXJ0eSIsInN0cm9rZSIsImd1aWRlU3Ryb2tlUHJvcGVydHkiLCJBUk1fU1RST0tFX1BST1BFUlRZIiwiR3VpZGVOb2RlIiwiY29uc3RydWN0b3IiLCJndWlkZSIsImFybUNvbG9yIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwiZnVsY3J1bU5vZGUiLCJpbmNpZGVudEFybU5vZGUiLCJjcmVhdGVBcm1Ob2RlIiwidHJhbnNtaXR0ZWRBcm1Ob2RlIiwiY2hpbGRyZW4iLCJmdWxjcnVtUG9zaXRpb25Qcm9wZXJ0eSIsImxpbmsiLCJmdWxjcnVtUG9zaXRpb24iLCJ2aWV3RnVsY3J1bVBvc2l0aW9uIiwibW9kZWxUb1ZpZXdQb3NpdGlvbiIsImNlbnRlciIsInNldEFybVBvc2l0aW9uIiwiaW5jaWRlbnRBbmdsZVByb3BlcnR5IiwidmFsdWUiLCJ0cmFuc21pdHRlZEFuZ2xlUHJvcGVydHkiLCJpbmNpZGVudEFuZ2xlIiwidXBkYXRlQXJtIiwidHJhbnNtaXR0ZWRBbmdsZSIsImFybU5vZGUiLCJhbmdsZSIsImFzc2VydCIsImlzRmluaXRlIiwicm90YXRpb24iLCJyb3RhdGVBcm91bmQiLCJjcmVhdGVJY29uIiwiZ3VpZGVBcm0xRmlsbFByb3BlcnR5IiwiZnVsY3J1bVJhZGl1cyIsImFybVdpZHRoIiwiYXJtSGVpZ2h0IiwiTWF0aCIsIlBJIiwiYXJtT3B0aW9ucyIsImxlZnRBcm1Ob2RlIiwicmlnaHRBcm1Ob2RlIiwibGVmdCIsInJpZ2h0IiwidG9wIiwiY2VudGVyWCIsImNlbnRlclkiLCJzY2FsZSIsImRpc3Bvc2UiLCJjcmVhdGVQb2xhciIsInBsdXMiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkd1aWRlTm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBHdWlkZU5vZGUgZGlzcGxheXMgYSBndWlkZSwgd2hpY2ggY29uc2lzdHMgb2YgYSBmdWxjcnVtLCB0byB3aGljaCBhcmUgYXR0YWNoZWQgMiBhcm1zLiAgT25lIGFybSBjb3JyZXNwb25kcyB0byB0aGVcclxuICogaW5jaWRlbnQgYW5nbGUsIHdoaWxlIHRoZSBvdGhlciBjb3JyZXNwb25kcyB0byB0aGUgdHJhbnNtaXR0ZWQgYW5nbGUuIEFuIG9wdGljIGhhcyBhIHBhaXIgb2YgZ3VpZGVzLCBwb3NpdGlvbmVkIGF0XHJcbiAqIHRoZSB0b3AgYW5kIGJvdHRvbSBvZiB0aGUgb3B0aWMgLSBzZWUgR3VpZGVzTm9kZS5cclxuICpcclxuICogQGF1dGhvciBTYXJhaCBDaGFuZyAoU3dhcnRobW9yZSBDb2xsZWdlKVxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgTW9kZWxWaWV3VHJhbnNmb3JtMiBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3ZpZXcvTW9kZWxWaWV3VHJhbnNmb3JtMi5qcyc7XHJcbmltcG9ydCB7IENpcmNsZSwgTm9kZSwgUmVjdGFuZ2xlLCBUQ29sb3IgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgR09Db2xvcnMgZnJvbSAnLi4vLi4vY29tbW9uL0dPQ29sb3JzLmpzJztcclxuaW1wb3J0IGdlb21ldHJpY09wdGljcyBmcm9tICcuLi8uLi9nZW9tZXRyaWNPcHRpY3MuanMnO1xyXG5pbXBvcnQgR3VpZGUgZnJvbSAnLi4vbW9kZWwvR3VpZGUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzLCBpbiB2aWV3IGNvb3JkaW5hdGVzXHJcbmNvbnN0IEZVTENSVU1fUkFESVVTID0gNTtcclxuY29uc3QgQVJNX1dJRFRIID0gNzA7XHJcbmNvbnN0IEFSTV9IRUlHSFQgPSA2O1xyXG5jb25zdCBGVUxDUlVNX09QVElPTlMgPSB7XHJcbiAgZmlsbDogR09Db2xvcnMuZ3VpZGVGdWxjcnVtRmlsbFByb3BlcnR5LFxyXG4gIHN0cm9rZTogR09Db2xvcnMuZ3VpZGVTdHJva2VQcm9wZXJ0eVxyXG59O1xyXG5jb25zdCBBUk1fU1RST0tFX1BST1BFUlRZID0gR09Db2xvcnMuZ3VpZGVTdHJva2VQcm9wZXJ0eTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEd1aWRlTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IGd1aWRlOiBHdWlkZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMjtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBndWlkZTogR3VpZGUsIGFybUNvbG9yOiBUQ29sb3IsIG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMiApIHtcclxuXHJcbiAgICBjb25zdCBmdWxjcnVtTm9kZSA9IG5ldyBDaXJjbGUoIEZVTENSVU1fUkFESVVTLCBGVUxDUlVNX09QVElPTlMgKTtcclxuXHJcbiAgICAvLyBUaGUgYXJtcyBhcmUgdHdvIHJlY3RhbmdsZXMsIHdpdGggbGVmdCBjZW50ZXIgc2lkZSBsYXlpbmcgb24gZnVsY3J1bSBpbml0aWFsbHkuXHJcbiAgICBjb25zdCBpbmNpZGVudEFybU5vZGUgPSBjcmVhdGVBcm1Ob2RlKCBhcm1Db2xvciApO1xyXG4gICAgY29uc3QgdHJhbnNtaXR0ZWRBcm1Ob2RlID0gY3JlYXRlQXJtTm9kZSggYXJtQ29sb3IgKTtcclxuXHJcbiAgICBzdXBlcigge1xyXG4gICAgICBjaGlsZHJlbjogWyBpbmNpZGVudEFybU5vZGUsIHRyYW5zbWl0dGVkQXJtTm9kZSwgZnVsY3J1bU5vZGUgXVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuZ3VpZGUgPSBndWlkZTtcclxuXHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSA9IG1vZGVsVmlld1RyYW5zZm9ybTtcclxuXHJcbiAgICBndWlkZS5mdWxjcnVtUG9zaXRpb25Qcm9wZXJ0eS5saW5rKCBmdWxjcnVtUG9zaXRpb24gPT4ge1xyXG5cclxuICAgICAgLy8gZnVsY3J1bSBwb3NpdGlvblxyXG4gICAgICBjb25zdCB2aWV3RnVsY3J1bVBvc2l0aW9uID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIGZ1bGNydW1Qb3NpdGlvbiApO1xyXG4gICAgICBmdWxjcnVtTm9kZS5jZW50ZXIgPSB2aWV3RnVsY3J1bVBvc2l0aW9uO1xyXG5cclxuICAgICAgLy8gcG9zaXRpb24gdGhlIGFybXNcclxuICAgICAgc2V0QXJtUG9zaXRpb24oIGluY2lkZW50QXJtTm9kZSwgdmlld0Z1bGNydW1Qb3NpdGlvbiwgZ3VpZGUuaW5jaWRlbnRBbmdsZVByb3BlcnR5LnZhbHVlICk7XHJcbiAgICAgIHNldEFybVBvc2l0aW9uKCB0cmFuc21pdHRlZEFybU5vZGUsIHZpZXdGdWxjcnVtUG9zaXRpb24sIGd1aWRlLnRyYW5zbWl0dGVkQW5nbGVQcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHVwZGF0ZSBwb3NpdGlvbiBhbmQgYW5nbGUgb2YgaW5jaWRlbnQgYXJtXHJcbiAgICBndWlkZS5pbmNpZGVudEFuZ2xlUHJvcGVydHkubGluayggaW5jaWRlbnRBbmdsZSA9PiB0aGlzLnVwZGF0ZUFybSggaW5jaWRlbnRBcm1Ob2RlLCBpbmNpZGVudEFuZ2xlICkgKTtcclxuXHJcbiAgICAvLyB1cGRhdGUgcG9zaXRpb24gYW5kIGFuZ2xlIG9mIHRyYW5zbWl0dGVkIGFybVxyXG4gICAgZ3VpZGUudHJhbnNtaXR0ZWRBbmdsZVByb3BlcnR5LmxpbmsoIHRyYW5zbWl0dGVkQW5nbGUgPT4gdGhpcy51cGRhdGVBcm0oIHRyYW5zbWl0dGVkQXJtTm9kZSwgdHJhbnNtaXR0ZWRBbmdsZSApICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHRoZSBhbmdsZSBhbmQgcG9zaXRpb24gb2YgYW4gYXJtLlxyXG4gICAqIEBwYXJhbSBhcm1Ob2RlIC0gaW5jaWRlbnQgb3IgdHJhbnNtaXR0ZWQgYXJtIChyZWN0YW5nbGUpIHRvIGJlIHJvdGF0ZWQgYW5kIHBvc2l0aW9uZWRcclxuICAgKiBAcGFyYW0gYW5nbGUgLSBpbmNpZGVudCBvciB0cmFuc21pdHRlZCBhbmdsZVxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVBcm0oIGFybU5vZGU6IE5vZGUsIGFuZ2xlOiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBpc0Zpbml0ZSggYW5nbGUgKSApO1xyXG5cclxuICAgIGNvbnN0IHZpZXdGdWxjcnVtUG9zaXRpb24gPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCB0aGlzLmd1aWRlLmZ1bGNydW1Qb3NpdGlvblByb3BlcnR5LnZhbHVlICk7XHJcblxyXG4gICAgLy8gYmVjYXVzZSByb3RhdGVBcm91bmQgcHJlcGVuZHMgdGhlIHRyYW5zZm9ybVxyXG4gICAgYXJtTm9kZS5yb3RhdGlvbiA9IDA7XHJcblxyXG4gICAgLy8gVGhlIG1vZGVsLXZpZXcgdHJhbnNmb3JtIGlzIFktaW52ZXJ0ZWQsIHNvIGEgcG9zaXRpdmUgcm90YXRpb24gaW4gdGhlIG1vZGVsIGlzIGNvdW50ZXJjbG9ja3dpc2UgKG5lZ2F0aXZlKSBpbiB0aGUgdmlldy5cclxuICAgIGFybU5vZGUucm90YXRlQXJvdW5kKCB2aWV3RnVsY3J1bVBvc2l0aW9uLCAtYW5nbGUgKTtcclxuXHJcbiAgICAvLyBwb3NpdGlvbiBvZiB0aGUgYXJtXHJcbiAgICBzZXRBcm1Qb3NpdGlvbiggYXJtTm9kZSwgdmlld0Z1bGNydW1Qb3NpdGlvbiwgYW5nbGUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYW4gaWNvbiBmb3IgZ3VpZGVzLCB0byBiZSB1c2VkIHdpdGggY2hlY2tib3guIFRoaXMgaXMgaW50ZW5kZWQgdG8gYmUgYSBjYXJpY2F0dXJlIG9mIHRoZSBhY3R1YWwgZ3VpZGVzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgY3JlYXRlSWNvbiggYXJtQ29sb3I6IFRDb2xvciA9IEdPQ29sb3JzLmd1aWRlQXJtMUZpbGxQcm9wZXJ0eSApOiBOb2RlIHtcclxuXHJcbiAgICAvLyBjb25zdGFudHNcclxuICAgIGNvbnN0IGZ1bGNydW1SYWRpdXMgPSA1O1xyXG4gICAgY29uc3QgYXJtV2lkdGggPSA1MDtcclxuICAgIGNvbnN0IGFybUhlaWdodCA9IDEuMjUgKiBmdWxjcnVtUmFkaXVzO1xyXG4gICAgY29uc3QgYW5nbGUgPSBNYXRoLlBJIC8gMTU7XHJcblxyXG4gICAgLy8gTm9kZXNcclxuICAgIGNvbnN0IGZ1bGNydW1Ob2RlID0gbmV3IENpcmNsZSggZnVsY3J1bVJhZGl1cywgRlVMQ1JVTV9PUFRJT05TICk7XHJcbiAgICBjb25zdCBhcm1PcHRpb25zID0ge1xyXG4gICAgICBzdHJva2U6IEFSTV9TVFJPS0VfUFJPUEVSVFksXHJcbiAgICAgIGZpbGw6IGFybUNvbG9yXHJcbiAgICB9O1xyXG4gICAgY29uc3QgbGVmdEFybU5vZGUgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBhcm1XaWR0aCwgYXJtSGVpZ2h0LCBhcm1PcHRpb25zICk7XHJcbiAgICBjb25zdCByaWdodEFybU5vZGUgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBhcm1XaWR0aCwgYXJtSGVpZ2h0LCBhcm1PcHRpb25zICk7XHJcblxyXG4gICAgLy8gTGF5b3V0XHJcbiAgICBsZWZ0QXJtTm9kZS5yb3RhdGlvbiA9IC1hbmdsZTtcclxuICAgIHJpZ2h0QXJtTm9kZS5yb3RhdGlvbiA9IGFuZ2xlO1xyXG4gICAgcmlnaHRBcm1Ob2RlLmxlZnQgPSBsZWZ0QXJtTm9kZS5yaWdodDtcclxuICAgIHJpZ2h0QXJtTm9kZS50b3AgPSBsZWZ0QXJtTm9kZS50b3A7XHJcbiAgICBmdWxjcnVtTm9kZS5jZW50ZXJYID0gbGVmdEFybU5vZGUucmlnaHQ7XHJcbiAgICBmdWxjcnVtTm9kZS5jZW50ZXJZID0gbGVmdEFybU5vZGUudG9wICsgKCBmdWxjcnVtUmFkaXVzIC8gMiApO1xyXG5cclxuICAgIHJldHVybiBuZXcgTm9kZSgge1xyXG4gICAgICBzY2FsZTogMC40LFxyXG4gICAgICBjaGlsZHJlbjogWyBsZWZ0QXJtTm9kZSwgcmlnaHRBcm1Ob2RlLCBmdWxjcnVtTm9kZSBdXHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIGZhbHNlLCAnZGlzcG9zZSBpcyBub3Qgc3VwcG9ydGVkLCBleGlzdHMgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgc2ltJyApO1xyXG4gICAgc3VwZXIuZGlzcG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZXMgb25lIG9mIHRoZSBndWlkZSBhcm1zLlxyXG4gKi9cclxuZnVuY3Rpb24gY3JlYXRlQXJtTm9kZSggYXJtQ29sb3I6IFRDb2xvciApOiBSZWN0YW5nbGUge1xyXG4gIHJldHVybiBuZXcgUmVjdGFuZ2xlKCAwLCAwLCBBUk1fV0lEVEgsIEFSTV9IRUlHSFQsIHtcclxuICAgIHN0cm9rZTogQVJNX1NUUk9LRV9QUk9QRVJUWSxcclxuICAgIGZpbGw6IGFybUNvbG9yXHJcbiAgfSApO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0cyB0aGUgcG9zaXRpb24gb2YgYW4gYXJtIHN1Y2ggdGhhdCBpdHMgbGVmdCBjZW50ZXIgaXMgb24gdGhlIGZ1bGNydW0gcG9pbnQuXHJcbiAqL1xyXG5mdW5jdGlvbiBzZXRBcm1Qb3NpdGlvbiggYXJtTm9kZTogTm9kZSwgdmlld0Z1bGNydW1Qb3NpdGlvbjogVmVjdG9yMiwgYW5nbGU6IG51bWJlciApOiB2b2lkIHtcclxuICBhc3NlcnQgJiYgYXNzZXJ0KCBpc0Zpbml0ZSggYW5nbGUgKSApO1xyXG5cclxuICAvLyBDZW50ZXIgb2YgdGhlIGFybSBpcyBvZmZzZXQgZnJvbSB0aGUgZnVsY3J1bSBwb2ludC5cclxuICAvLyBUaGUgbW9kZWwtdmlldyB0cmFuc2Zvcm0gaXMgWS1pbnZlcnRlZCwgc28gYSBwb3NpdGl2ZSByb3RhdGlvbiBpbiB0aGUgbW9kZWwgaXMgY291bnRlcmNsb2Nrd2lzZSAobmVnYXRpdmUpIGluIHRoZSB2aWV3LlxyXG4gIGFybU5vZGUuY2VudGVyID0gVmVjdG9yMi5jcmVhdGVQb2xhciggQVJNX1dJRFRIIC8gMiwgLWFuZ2xlICkucGx1cyggdmlld0Z1bGNydW1Qb3NpdGlvbiApO1xyXG59XHJcblxyXG5nZW9tZXRyaWNPcHRpY3MucmVnaXN0ZXIoICdHdWlkZU5vZGUnLCBHdWlkZU5vZGUgKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBT0EsT0FBTyxNQUFNLCtCQUErQjtBQUVuRCxTQUFTQyxNQUFNLEVBQUVDLElBQUksRUFBRUMsU0FBUyxRQUFnQixtQ0FBbUM7QUFDbkYsT0FBT0MsUUFBUSxNQUFNLDBCQUEwQjtBQUMvQyxPQUFPQyxlQUFlLE1BQU0sMEJBQTBCO0FBR3REO0FBQ0EsTUFBTUMsY0FBYyxHQUFHLENBQUM7QUFDeEIsTUFBTUMsU0FBUyxHQUFHLEVBQUU7QUFDcEIsTUFBTUMsVUFBVSxHQUFHLENBQUM7QUFDcEIsTUFBTUMsZUFBZSxHQUFHO0VBQ3RCQyxJQUFJLEVBQUVOLFFBQVEsQ0FBQ08sd0JBQXdCO0VBQ3ZDQyxNQUFNLEVBQUVSLFFBQVEsQ0FBQ1M7QUFDbkIsQ0FBQztBQUNELE1BQU1DLG1CQUFtQixHQUFHVixRQUFRLENBQUNTLG1CQUFtQjtBQUV4RCxlQUFlLE1BQU1FLFNBQVMsU0FBU2IsSUFBSSxDQUFDO0VBS25DYyxXQUFXQSxDQUFFQyxLQUFZLEVBQUVDLFFBQWdCLEVBQUVDLGtCQUF1QyxFQUFHO0lBRTVGLE1BQU1DLFdBQVcsR0FBRyxJQUFJbkIsTUFBTSxDQUFFSyxjQUFjLEVBQUVHLGVBQWdCLENBQUM7O0lBRWpFO0lBQ0EsTUFBTVksZUFBZSxHQUFHQyxhQUFhLENBQUVKLFFBQVMsQ0FBQztJQUNqRCxNQUFNSyxrQkFBa0IsR0FBR0QsYUFBYSxDQUFFSixRQUFTLENBQUM7SUFFcEQsS0FBSyxDQUFFO01BQ0xNLFFBQVEsRUFBRSxDQUFFSCxlQUFlLEVBQUVFLGtCQUFrQixFQUFFSCxXQUFXO0lBQzlELENBQUUsQ0FBQztJQUVILElBQUksQ0FBQ0gsS0FBSyxHQUFHQSxLQUFLO0lBRWxCLElBQUksQ0FBQ0Usa0JBQWtCLEdBQUdBLGtCQUFrQjtJQUU1Q0YsS0FBSyxDQUFDUSx1QkFBdUIsQ0FBQ0MsSUFBSSxDQUFFQyxlQUFlLElBQUk7TUFFckQ7TUFDQSxNQUFNQyxtQkFBbUIsR0FBR1Qsa0JBQWtCLENBQUNVLG1CQUFtQixDQUFFRixlQUFnQixDQUFDO01BQ3JGUCxXQUFXLENBQUNVLE1BQU0sR0FBR0YsbUJBQW1COztNQUV4QztNQUNBRyxjQUFjLENBQUVWLGVBQWUsRUFBRU8sbUJBQW1CLEVBQUVYLEtBQUssQ0FBQ2UscUJBQXFCLENBQUNDLEtBQU0sQ0FBQztNQUN6RkYsY0FBYyxDQUFFUixrQkFBa0IsRUFBRUssbUJBQW1CLEVBQUVYLEtBQUssQ0FBQ2lCLHdCQUF3QixDQUFDRCxLQUFNLENBQUM7SUFDakcsQ0FBRSxDQUFDOztJQUVIO0lBQ0FoQixLQUFLLENBQUNlLHFCQUFxQixDQUFDTixJQUFJLENBQUVTLGFBQWEsSUFBSSxJQUFJLENBQUNDLFNBQVMsQ0FBRWYsZUFBZSxFQUFFYyxhQUFjLENBQUUsQ0FBQzs7SUFFckc7SUFDQWxCLEtBQUssQ0FBQ2lCLHdCQUF3QixDQUFDUixJQUFJLENBQUVXLGdCQUFnQixJQUFJLElBQUksQ0FBQ0QsU0FBUyxDQUFFYixrQkFBa0IsRUFBRWMsZ0JBQWlCLENBQUUsQ0FBQztFQUNuSDs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ1NELFNBQVNBLENBQUVFLE9BQWEsRUFBRUMsS0FBYSxFQUFTO0lBQ3JEQyxNQUFNLElBQUlBLE1BQU0sQ0FBRUMsUUFBUSxDQUFFRixLQUFNLENBQUUsQ0FBQztJQUVyQyxNQUFNWCxtQkFBbUIsR0FBRyxJQUFJLENBQUNULGtCQUFrQixDQUFDVSxtQkFBbUIsQ0FBRSxJQUFJLENBQUNaLEtBQUssQ0FBQ1EsdUJBQXVCLENBQUNRLEtBQU0sQ0FBQzs7SUFFbkg7SUFDQUssT0FBTyxDQUFDSSxRQUFRLEdBQUcsQ0FBQzs7SUFFcEI7SUFDQUosT0FBTyxDQUFDSyxZQUFZLENBQUVmLG1CQUFtQixFQUFFLENBQUNXLEtBQU0sQ0FBQzs7SUFFbkQ7SUFDQVIsY0FBYyxDQUFFTyxPQUFPLEVBQUVWLG1CQUFtQixFQUFFVyxLQUFNLENBQUM7RUFDdkQ7O0VBRUE7QUFDRjtBQUNBO0VBQ0UsT0FBY0ssVUFBVUEsQ0FBRTFCLFFBQWdCLEdBQUdkLFFBQVEsQ0FBQ3lDLHFCQUFxQixFQUFTO0lBRWxGO0lBQ0EsTUFBTUMsYUFBYSxHQUFHLENBQUM7SUFDdkIsTUFBTUMsUUFBUSxHQUFHLEVBQUU7SUFDbkIsTUFBTUMsU0FBUyxHQUFHLElBQUksR0FBR0YsYUFBYTtJQUN0QyxNQUFNUCxLQUFLLEdBQUdVLElBQUksQ0FBQ0MsRUFBRSxHQUFHLEVBQUU7O0lBRTFCO0lBQ0EsTUFBTTlCLFdBQVcsR0FBRyxJQUFJbkIsTUFBTSxDQUFFNkMsYUFBYSxFQUFFckMsZUFBZ0IsQ0FBQztJQUNoRSxNQUFNMEMsVUFBVSxHQUFHO01BQ2pCdkMsTUFBTSxFQUFFRSxtQkFBbUI7TUFDM0JKLElBQUksRUFBRVE7SUFDUixDQUFDO0lBQ0QsTUFBTWtDLFdBQVcsR0FBRyxJQUFJakQsU0FBUyxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU0QyxRQUFRLEVBQUVDLFNBQVMsRUFBRUcsVUFBVyxDQUFDO0lBQzFFLE1BQU1FLFlBQVksR0FBRyxJQUFJbEQsU0FBUyxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU0QyxRQUFRLEVBQUVDLFNBQVMsRUFBRUcsVUFBVyxDQUFDOztJQUUzRTtJQUNBQyxXQUFXLENBQUNWLFFBQVEsR0FBRyxDQUFDSCxLQUFLO0lBQzdCYyxZQUFZLENBQUNYLFFBQVEsR0FBR0gsS0FBSztJQUM3QmMsWUFBWSxDQUFDQyxJQUFJLEdBQUdGLFdBQVcsQ0FBQ0csS0FBSztJQUNyQ0YsWUFBWSxDQUFDRyxHQUFHLEdBQUdKLFdBQVcsQ0FBQ0ksR0FBRztJQUNsQ3BDLFdBQVcsQ0FBQ3FDLE9BQU8sR0FBR0wsV0FBVyxDQUFDRyxLQUFLO0lBQ3ZDbkMsV0FBVyxDQUFDc0MsT0FBTyxHQUFHTixXQUFXLENBQUNJLEdBQUcsR0FBS1YsYUFBYSxHQUFHLENBQUc7SUFFN0QsT0FBTyxJQUFJNUMsSUFBSSxDQUFFO01BQ2Z5RCxLQUFLLEVBQUUsR0FBRztNQUNWbkMsUUFBUSxFQUFFLENBQUU0QixXQUFXLEVBQUVDLFlBQVksRUFBRWpDLFdBQVc7SUFDcEQsQ0FBRSxDQUFDO0VBQ0w7RUFFZ0J3QyxPQUFPQSxDQUFBLEVBQVM7SUFDOUJwQixNQUFNLElBQUlBLE1BQU0sQ0FBRSxLQUFLLEVBQUUsOERBQStELENBQUM7SUFDekYsS0FBSyxDQUFDb0IsT0FBTyxDQUFDLENBQUM7RUFDakI7QUFDRjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTdEMsYUFBYUEsQ0FBRUosUUFBZ0IsRUFBYztFQUNwRCxPQUFPLElBQUlmLFNBQVMsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFSSxTQUFTLEVBQUVDLFVBQVUsRUFBRTtJQUNqREksTUFBTSxFQUFFRSxtQkFBbUI7SUFDM0JKLElBQUksRUFBRVE7RUFDUixDQUFFLENBQUM7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTYSxjQUFjQSxDQUFFTyxPQUFhLEVBQUVWLG1CQUE0QixFQUFFVyxLQUFhLEVBQVM7RUFDMUZDLE1BQU0sSUFBSUEsTUFBTSxDQUFFQyxRQUFRLENBQUVGLEtBQU0sQ0FBRSxDQUFDOztFQUVyQztFQUNBO0VBQ0FELE9BQU8sQ0FBQ1IsTUFBTSxHQUFHOUIsT0FBTyxDQUFDNkQsV0FBVyxDQUFFdEQsU0FBUyxHQUFHLENBQUMsRUFBRSxDQUFDZ0MsS0FBTSxDQUFDLENBQUN1QixJQUFJLENBQUVsQyxtQkFBb0IsQ0FBQztBQUMzRjtBQUVBdkIsZUFBZSxDQUFDMEQsUUFBUSxDQUFFLFdBQVcsRUFBRWhELFNBQVUsQ0FBQyJ9