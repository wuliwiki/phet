// Copyright 2022-2023, University of Colorado Boulder

/**
 * GOToolNode is the abstract base class for the view of all tools.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import DerivedProperty from '../../../../../axon/js/DerivedProperty.js';
import optionize from '../../../../../phet-core/js/optionize.js';
import { IndexedNodeIO, InteractiveHighlighting, Node } from '../../../../../scenery/js/imports.js';
import geometricOptics from '../../../geometricOptics.js';
export default class GOToolNode extends InteractiveHighlighting(Node) {
  // the icon associated with this tool, as it appears in the toolbox

  // the toolbox that contains this tool, so the tool knows where to return to. null until setToolboxNode is called.

  // tandem name to be used for the icon

  // positions that are 'interesting' to measure, for the 'J' hotkey

  // current index into jumpPoints

  /**
   * @param tool - associated model element
   * @param providedOptions
   */
  constructor(tool, providedOptions) {
    const options = optionize()({
      // NodeOptions
      visibleProperty: DerivedProperty.not(tool.isInToolboxProperty),
      // visible when not in the toolbox
      tagName: 'div',
      focusable: true,
      phetioInputEnabledPropertyInstrumented: true,
      // Make z-ordering of tools stateful, see https://github.com/phetsims/geometric-optics/issues/431
      phetioType: IndexedNodeIO,
      phetioState: true
    }, providedOptions);
    super(options);
    this.toolboxNode = null; // to be set later via setToolboxNode
    this.iconTandemName = options.iconTandemName;
    this.jumpPoints = [];
    this.jumpPointsIndex = 0;
    this.addLinkedElement(tool, {
      tandem: options.tandem.createTandem(tool.tandem.name)
    });
  }

  /**
   * Sets the toolbox, so the tool knows where to return to.
   */
  setToolboxNode(toolboxNode) {
    this.toolboxNode = toolboxNode;
  }

  /**
   * Forwards an event from the toolbox to start dragging this Node.
   */
  startDrag(event) {
    this.dragListener.press(event, this);
  }

  /**
   * Sets the jump points used by the 'J' hotkey.
   */
  setJumpPoints(jumpPoints) {
    this.jumpPoints = jumpPoints;
    this.jumpPointsIndex = 0;
  }

  /**
   * Handles the 'J' (Jump) hotkey, which moves the ruler to the next 'interesting' point.
   */

  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }

  /**
   * Gets the next jump point, based on the current position of the tool.
   * @param jumpPoints
   * @param toolPosition
   * @param map - optional function for mapping jump points to new positions
   */
  static getNextJumpPoint(jumpPoints, toolPosition, map) {
    let nextPoint;

    // Extract just the position values.
    let points = jumpPoints.map(jumpPoint => jumpPoint.positionProperty.value);

    // Sort positions left-to-right, by increasing x coordinate.
    points = _.sortBy(points, point => point.x);

    // Apply optional map function.
    if (map) {
      points = map(points);
    }

    // Find the tool's position in the array of points.
    // Use _.findLast so that the tool doesn't get stuck when there are points that are the "same".
    // See https://github.com/phetsims/geometric-optics/issues/413
    const thisPoint = _.findLast(points, point => point.equals(toolPosition));
    if (thisPoint) {
      // If the tool is at one of the jump points, and there's more than 1 jump point, then
      // get the next jump point by searching for where we're current at in the array (with wrap-around).
      if (points.length > 1) {
        let nextIndex = points.indexOf(thisPoint) + 1;
        if (nextIndex > points.length - 1) {
          nextIndex = 0;
        }
        nextPoint = points[nextIndex];
      }
    } else {
      // If the tool is not one of the jump points, then find the next jump point that is to the right of
      // the tool (with wrap-around).
      nextPoint = _.find(points, position => position.x > toolPosition.x);
      if (!nextPoint) {
        const leftmostPosition = points[0];
        if (!leftmostPosition.equals(toolPosition)) {
          nextPoint = leftmostPosition;
        }
      }
    }
    return nextPoint || null;
  }
}
geometricOptics.register('GOToolNode', GOToolNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJvcHRpb25pemUiLCJJbmRleGVkTm9kZUlPIiwiSW50ZXJhY3RpdmVIaWdobGlnaHRpbmciLCJOb2RlIiwiZ2VvbWV0cmljT3B0aWNzIiwiR09Ub29sTm9kZSIsImNvbnN0cnVjdG9yIiwidG9vbCIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ2aXNpYmxlUHJvcGVydHkiLCJub3QiLCJpc0luVG9vbGJveFByb3BlcnR5IiwidGFnTmFtZSIsImZvY3VzYWJsZSIsInBoZXRpb0lucHV0RW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkIiwicGhldGlvVHlwZSIsInBoZXRpb1N0YXRlIiwidG9vbGJveE5vZGUiLCJpY29uVGFuZGVtTmFtZSIsImp1bXBQb2ludHMiLCJqdW1wUG9pbnRzSW5kZXgiLCJhZGRMaW5rZWRFbGVtZW50IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwibmFtZSIsInNldFRvb2xib3hOb2RlIiwic3RhcnREcmFnIiwiZXZlbnQiLCJkcmFnTGlzdGVuZXIiLCJwcmVzcyIsInNldEp1bXBQb2ludHMiLCJkaXNwb3NlIiwiYXNzZXJ0IiwiZ2V0TmV4dEp1bXBQb2ludCIsInRvb2xQb3NpdGlvbiIsIm1hcCIsIm5leHRQb2ludCIsInBvaW50cyIsImp1bXBQb2ludCIsInBvc2l0aW9uUHJvcGVydHkiLCJ2YWx1ZSIsIl8iLCJzb3J0QnkiLCJwb2ludCIsIngiLCJ0aGlzUG9pbnQiLCJmaW5kTGFzdCIsImVxdWFscyIsImxlbmd0aCIsIm5leHRJbmRleCIsImluZGV4T2YiLCJmaW5kIiwicG9zaXRpb24iLCJsZWZ0bW9zdFBvc2l0aW9uIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJHT1Rvb2xOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDIyLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEdPVG9vbE5vZGUgaXMgdGhlIGFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIHRoZSB2aWV3IG9mIGFsbCB0b29scy5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcclxuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vLi4vLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgeyBEcmFnTGlzdGVuZXIsIEluZGV4ZWROb2RlSU8sIEludGVyYWN0aXZlSGlnaGxpZ2h0aW5nLCBOb2RlLCBOb2RlT3B0aW9ucywgUHJlc3NMaXN0ZW5lckV2ZW50IH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IEdPVG9vbCBmcm9tICcuLi8uLi9tb2RlbC90b29scy9HT1Rvb2wuanMnO1xyXG5pbXBvcnQgVG9vbEp1bXBQb2ludCBmcm9tICcuLi8uLi9tb2RlbC90b29scy9Ub29sSnVtcFBvaW50LmpzJztcclxuaW1wb3J0IEdPVG9vbGJveE5vZGUgZnJvbSAnLi9HT1Rvb2xib3hOb2RlLmpzJztcclxuaW1wb3J0IGdlb21ldHJpY09wdGljcyBmcm9tICcuLi8uLi8uLi9nZW9tZXRyaWNPcHRpY3MuanMnO1xyXG5pbXBvcnQgUGlja09wdGlvbmFsIGZyb20gJy4uLy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrT3B0aW9uYWwuanMnO1xyXG5cclxudHlwZSBTZWxmT3B0aW9ucyA9IHtcclxuXHJcbiAgLy8gdGFuZGVtIG5hbWUgdG8gYmUgdXNlZCBmb3IgdGhlIGljb24gYXNzb2NpYXRlZCB3aXRoIHRoaXMgdG9vbCBOb2RlXHJcbiAgaWNvblRhbmRlbU5hbWU6IHN0cmluZztcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEdPVG9vbE5vZGVPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBQaWNrUmVxdWlyZWQ8Tm9kZSwgJ3RhbmRlbSc+ICYgUGlja09wdGlvbmFsPE5vZGUsICdyb3RhdGlvbic+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYWJzdHJhY3QgY2xhc3MgR09Ub29sTm9kZSBleHRlbmRzIEludGVyYWN0aXZlSGlnaGxpZ2h0aW5nKCBOb2RlICkge1xyXG5cclxuICAvLyB0aGUgaWNvbiBhc3NvY2lhdGVkIHdpdGggdGhpcyB0b29sLCBhcyBpdCBhcHBlYXJzIGluIHRoZSB0b29sYm94XHJcbiAgcHVibGljIGFic3RyYWN0IGljb246IE5vZGU7XHJcblxyXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBkcmFnTGlzdGVuZXI6IERyYWdMaXN0ZW5lcjtcclxuXHJcbiAgLy8gdGhlIHRvb2xib3ggdGhhdCBjb250YWlucyB0aGlzIHRvb2wsIHNvIHRoZSB0b29sIGtub3dzIHdoZXJlIHRvIHJldHVybiB0by4gbnVsbCB1bnRpbCBzZXRUb29sYm94Tm9kZSBpcyBjYWxsZWQuXHJcbiAgcHVibGljIHRvb2xib3hOb2RlOiBHT1Rvb2xib3hOb2RlIHwgbnVsbDtcclxuXHJcbiAgLy8gdGFuZGVtIG5hbWUgdG8gYmUgdXNlZCBmb3IgdGhlIGljb25cclxuICBwdWJsaWMgcmVhZG9ubHkgaWNvblRhbmRlbU5hbWU6IHN0cmluZztcclxuXHJcbiAgLy8gcG9zaXRpb25zIHRoYXQgYXJlICdpbnRlcmVzdGluZycgdG8gbWVhc3VyZSwgZm9yIHRoZSAnSicgaG90a2V5XHJcbiAgcHJvdGVjdGVkIGp1bXBQb2ludHM6IFRvb2xKdW1wUG9pbnRbXTtcclxuXHJcbiAgLy8gY3VycmVudCBpbmRleCBpbnRvIGp1bXBQb2ludHNcclxuICBwcm90ZWN0ZWQganVtcFBvaW50c0luZGV4OiBudW1iZXI7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB0b29sIC0gYXNzb2NpYXRlZCBtb2RlbCBlbGVtZW50XHJcbiAgICogQHBhcmFtIHByb3ZpZGVkT3B0aW9uc1xyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBjb25zdHJ1Y3RvciggdG9vbDogR09Ub29sLCBwcm92aWRlZE9wdGlvbnM6IEdPVG9vbE5vZGVPcHRpb25zICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8R09Ub29sTm9kZU9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xyXG5cclxuICAgICAgLy8gTm9kZU9wdGlvbnNcclxuICAgICAgdmlzaWJsZVByb3BlcnR5OiBEZXJpdmVkUHJvcGVydHkubm90KCB0b29sLmlzSW5Ub29sYm94UHJvcGVydHkgKSwgLy8gdmlzaWJsZSB3aGVuIG5vdCBpbiB0aGUgdG9vbGJveFxyXG4gICAgICB0YWdOYW1lOiAnZGl2JyxcclxuICAgICAgZm9jdXNhYmxlOiB0cnVlLFxyXG4gICAgICBwaGV0aW9JbnB1dEVuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZDogdHJ1ZSxcclxuXHJcbiAgICAgIC8vIE1ha2Ugei1vcmRlcmluZyBvZiB0b29scyBzdGF0ZWZ1bCwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9nZW9tZXRyaWMtb3B0aWNzL2lzc3Vlcy80MzFcclxuICAgICAgcGhldGlvVHlwZTogSW5kZXhlZE5vZGVJTyxcclxuICAgICAgcGhldGlvU3RhdGU6IHRydWVcclxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy50b29sYm94Tm9kZSA9IG51bGw7IC8vIHRvIGJlIHNldCBsYXRlciB2aWEgc2V0VG9vbGJveE5vZGVcclxuICAgIHRoaXMuaWNvblRhbmRlbU5hbWUgPSBvcHRpb25zLmljb25UYW5kZW1OYW1lO1xyXG4gICAgdGhpcy5qdW1wUG9pbnRzID0gW107XHJcbiAgICB0aGlzLmp1bXBQb2ludHNJbmRleCA9IDA7XHJcblxyXG4gICAgdGhpcy5hZGRMaW5rZWRFbGVtZW50KCB0b29sLCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCB0b29sLnRhbmRlbS5uYW1lIClcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIHRvb2xib3gsIHNvIHRoZSB0b29sIGtub3dzIHdoZXJlIHRvIHJldHVybiB0by5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0VG9vbGJveE5vZGUoIHRvb2xib3hOb2RlOiBHT1Rvb2xib3hOb2RlICk6IHZvaWQge1xyXG4gICAgdGhpcy50b29sYm94Tm9kZSA9IHRvb2xib3hOb2RlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRm9yd2FyZHMgYW4gZXZlbnQgZnJvbSB0aGUgdG9vbGJveCB0byBzdGFydCBkcmFnZ2luZyB0aGlzIE5vZGUuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXJ0RHJhZyggZXZlbnQ6IFByZXNzTGlzdGVuZXJFdmVudCApOiB2b2lkIHtcclxuICAgIHRoaXMuZHJhZ0xpc3RlbmVyLnByZXNzKCBldmVudCwgdGhpcyApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUganVtcCBwb2ludHMgdXNlZCBieSB0aGUgJ0onIGhvdGtleS5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0SnVtcFBvaW50cygganVtcFBvaW50czogVG9vbEp1bXBQb2ludFtdICk6IHZvaWQge1xyXG4gICAgdGhpcy5qdW1wUG9pbnRzID0ganVtcFBvaW50cztcclxuICAgIHRoaXMuanVtcFBvaW50c0luZGV4ID0gMDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhhbmRsZXMgdGhlICdKJyAoSnVtcCkgaG90a2V5LCB3aGljaCBtb3ZlcyB0aGUgcnVsZXIgdG8gdGhlIG5leHQgJ2ludGVyZXN0aW5nJyBwb2ludC5cclxuICAgKi9cclxuICBwdWJsaWMgYWJzdHJhY3QganVtcFRvUG9pbnQoKTogdm9pZDtcclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmYWxzZSwgJ2Rpc3Bvc2UgaXMgbm90IHN1cHBvcnRlZCwgZXhpc3RzIGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIHNpbScgKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIG5leHQganVtcCBwb2ludCwgYmFzZWQgb24gdGhlIGN1cnJlbnQgcG9zaXRpb24gb2YgdGhlIHRvb2wuXHJcbiAgICogQHBhcmFtIGp1bXBQb2ludHNcclxuICAgKiBAcGFyYW0gdG9vbFBvc2l0aW9uXHJcbiAgICogQHBhcmFtIG1hcCAtIG9wdGlvbmFsIGZ1bmN0aW9uIGZvciBtYXBwaW5nIGp1bXAgcG9pbnRzIHRvIG5ldyBwb3NpdGlvbnNcclxuICAgKi9cclxuICBwcm90ZWN0ZWQgc3RhdGljIGdldE5leHRKdW1wUG9pbnQoIGp1bXBQb2ludHM6IFRvb2xKdW1wUG9pbnRbXSwgdG9vbFBvc2l0aW9uOiBWZWN0b3IyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwPzogKCBwb2ludHM6IFZlY3RvcjJbXSApID0+IFZlY3RvcjJbXSApOiBWZWN0b3IyIHwgbnVsbCB7XHJcblxyXG4gICAgbGV0IG5leHRQb2ludDogVmVjdG9yMiB8IHVuZGVmaW5lZDtcclxuXHJcbiAgICAvLyBFeHRyYWN0IGp1c3QgdGhlIHBvc2l0aW9uIHZhbHVlcy5cclxuICAgIGxldCBwb2ludHM6IFZlY3RvcjJbXSA9IGp1bXBQb2ludHMubWFwKCBqdW1wUG9pbnQgPT4ganVtcFBvaW50LnBvc2l0aW9uUHJvcGVydHkudmFsdWUgKTtcclxuXHJcbiAgICAvLyBTb3J0IHBvc2l0aW9ucyBsZWZ0LXRvLXJpZ2h0LCBieSBpbmNyZWFzaW5nIHggY29vcmRpbmF0ZS5cclxuICAgIHBvaW50cyA9IF8uc29ydEJ5KCBwb2ludHMsIHBvaW50ID0+IHBvaW50LnggKTtcclxuXHJcbiAgICAvLyBBcHBseSBvcHRpb25hbCBtYXAgZnVuY3Rpb24uXHJcbiAgICBpZiAoIG1hcCApIHtcclxuICAgICAgcG9pbnRzID0gbWFwKCBwb2ludHMgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBGaW5kIHRoZSB0b29sJ3MgcG9zaXRpb24gaW4gdGhlIGFycmF5IG9mIHBvaW50cy5cclxuICAgIC8vIFVzZSBfLmZpbmRMYXN0IHNvIHRoYXQgdGhlIHRvb2wgZG9lc24ndCBnZXQgc3R1Y2sgd2hlbiB0aGVyZSBhcmUgcG9pbnRzIHRoYXQgYXJlIHRoZSBcInNhbWVcIi5cclxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvZ2VvbWV0cmljLW9wdGljcy9pc3N1ZXMvNDEzXHJcbiAgICBjb25zdCB0aGlzUG9pbnQgPSBfLmZpbmRMYXN0KCBwb2ludHMsIHBvaW50ID0+IHBvaW50LmVxdWFscyggdG9vbFBvc2l0aW9uICkgKTtcclxuXHJcbiAgICBpZiAoIHRoaXNQb2ludCApIHtcclxuXHJcbiAgICAgIC8vIElmIHRoZSB0b29sIGlzIGF0IG9uZSBvZiB0aGUganVtcCBwb2ludHMsIGFuZCB0aGVyZSdzIG1vcmUgdGhhbiAxIGp1bXAgcG9pbnQsIHRoZW5cclxuICAgICAgLy8gZ2V0IHRoZSBuZXh0IGp1bXAgcG9pbnQgYnkgc2VhcmNoaW5nIGZvciB3aGVyZSB3ZSdyZSBjdXJyZW50IGF0IGluIHRoZSBhcnJheSAod2l0aCB3cmFwLWFyb3VuZCkuXHJcbiAgICAgIGlmICggcG9pbnRzLmxlbmd0aCA+IDEgKSB7XHJcbiAgICAgICAgbGV0IG5leHRJbmRleCA9IHBvaW50cy5pbmRleE9mKCB0aGlzUG9pbnQgKSArIDE7XHJcbiAgICAgICAgaWYgKCBuZXh0SW5kZXggPiBwb2ludHMubGVuZ3RoIC0gMSApIHtcclxuICAgICAgICAgIG5leHRJbmRleCA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5leHRQb2ludCA9IHBvaW50c1sgbmV4dEluZGV4IF07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG5cclxuICAgICAgLy8gSWYgdGhlIHRvb2wgaXMgbm90IG9uZSBvZiB0aGUganVtcCBwb2ludHMsIHRoZW4gZmluZCB0aGUgbmV4dCBqdW1wIHBvaW50IHRoYXQgaXMgdG8gdGhlIHJpZ2h0IG9mXHJcbiAgICAgIC8vIHRoZSB0b29sICh3aXRoIHdyYXAtYXJvdW5kKS5cclxuICAgICAgbmV4dFBvaW50ID0gXy5maW5kKCBwb2ludHMsIHBvc2l0aW9uID0+IHBvc2l0aW9uLnggPiB0b29sUG9zaXRpb24ueCApO1xyXG4gICAgICBpZiAoICFuZXh0UG9pbnQgKSB7XHJcbiAgICAgICAgY29uc3QgbGVmdG1vc3RQb3NpdGlvbiA9IHBvaW50c1sgMCBdO1xyXG4gICAgICAgIGlmICggIWxlZnRtb3N0UG9zaXRpb24uZXF1YWxzKCB0b29sUG9zaXRpb24gKSApIHtcclxuICAgICAgICAgIG5leHRQb2ludCA9IGxlZnRtb3N0UG9zaXRpb247XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5leHRQb2ludCB8fCBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuZ2VvbWV0cmljT3B0aWNzLnJlZ2lzdGVyKCAnR09Ub29sTm9kZScsIEdPVG9vbE5vZGUgKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsZUFBZSxNQUFNLDJDQUEyQztBQUV2RSxPQUFPQyxTQUFTLE1BQU0sMENBQTBDO0FBRWhFLFNBQXVCQyxhQUFhLEVBQUVDLHVCQUF1QixFQUFFQyxJQUFJLFFBQXlDLHNDQUFzQztBQUlsSixPQUFPQyxlQUFlLE1BQU0sNkJBQTZCO0FBV3pELGVBQWUsTUFBZUMsVUFBVSxTQUFTSCx1QkFBdUIs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