// Copyright 2016-2023, University of Colorado Boulder

/**
 * Maker editor, used to manually enter markers on the double number line.
 * Values are entered via a keypad.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import merge from '../../../../phet-core/js/merge.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { FireListener, Line, Node, Path, Rectangle, Text } from '../../../../scenery/js/imports.js';
import editRegularShape from '../../../../sherpa/js/fontawesome-5/editRegularShape.js';
import RectangularPushButton from '../../../../sun/js/buttons/RectangularPushButton.js';
import unitRates from '../../unitRates.js';
import URColors from '../URColors.js';
import URConstants from '../URConstants.js';
import URUtils from '../URUtils.js';

// constants
const KEYPAD_POSITION_VALUES = ['above', 'below'];
const SHARED_OPTIONS = {
  maxDigits: 4,
  // {number} maximum number of digits that can be entered via keypad
  maxDecimals: 1,
  // {number} maximum number of decimal places that can be entered via keypad
  trimZeros: false // {boolean} whether to trim trailing zeros from decimal places
};

export default class MarkerEditorNode extends Node {
  /**
   * @param {MarkerEditor} markerEditor
   * @param {Node} doubleNumberLinePanel - panel that contains the double number line, for positioning the keypad
   * @param {KeypadLayer} keypadLayer - layer that manages the keypad
   * @param {Object} [options]
   */
  constructor(markerEditor, doubleNumberLinePanel, keypadLayer, options) {
    options = merge({
      lineLength: URConstants.MAJOR_MARKER_LENGTH,
      // {number} length of the vertical line between numerator and denominator values
      valueBoxWidth: 55,
      // {number} width of the value field, height determined by valueFont
      valueFont: new PhetFont(12),
      // {Font} font for the value
      valueColor: 'black',
      // {Color|string} color of the value
      zeroIsValid: false,
      // {boolean} zero is not a valid value for markers
      valueXMargin: 5,
      // {number} horizontal margin inside the value box
      valueYMargin: URConstants.MARKER_Y_SPACING,
      // {number} vertical margin inside the value box
      ySpacing: 3,
      // {number} vertical spacing between UI elements
      keypadPosition: 'below',
      // {string} 'above' or 'below' doubleNumberLinePanel
      numeratorOptions: null,
      // {*} options specific to the rate's numerator, see below
      denominatorOptions: null // {*} options specific to the rate's denominator, see below
    }, options);
    const numeratorOptions = merge({}, SHARED_OPTIONS, options.numeratorOptions);
    const denominatorOptions = merge({}, SHARED_OPTIONS, options.denominatorOptions);
    assert && assert(_.includes(KEYPAD_POSITION_VALUES, options.keypadPosition), `invalid keypadPosition: ${options.keypadPosition}`);
    super();

    // vertical line
    const verticalLine = new Line(0, 0, 0, options.lineLength, {
      stroke: 'black'
    });
    this.addChild(verticalLine);

    // common to both value boxes
    const valueBoxWidth = options.valueBoxWidth;
    const valueBoxHeight = new Text('0', {
      font: options.valueFont
    }).height + 2 * options.valueYMargin;
    const valueBoxOptions = {
      stroke: 'black',
      fill: 'white',
      cursor: 'pointer'
    };

    // box for the numerator
    const numeratorBox = new Rectangle(0, 0, valueBoxWidth, valueBoxHeight, merge({}, valueBoxOptions, {
      centerX: verticalLine.centerX,
      bottom: verticalLine.top
    }));
    this.addChild(numeratorBox);

    // box for the denominator
    const denominatorBox = new Rectangle(0, 0, valueBoxWidth, valueBoxHeight, merge({}, valueBoxOptions, {
      centerX: verticalLine.centerX,
      top: verticalLine.bottom
    }));
    this.addChild(denominatorBox);

    // numerator value
    const numeratorNode = new Text('', {
      pickable: false,
      // so it doesn't interfere with clicking in numeratorBox to open keypad
      fill: options.neutralColor,
      font: options.valueFont,
      center: numeratorBox.center
    });
    this.addChild(numeratorNode);

    // denominator value
    const denominatorNode = new Text('', {
      pickable: false,
      // so it doesn't interfere with clicking in denominatorBox to open keypad
      fill: options.neutralColor,
      font: options.valueFont,
      center: denominatorBox.center
    });
    this.addChild(denominatorNode);

    // edit button for the numerator
    const numeratorEditButton = new RectangularPushButton({
      content: new Path(editRegularShape, {
        scale: URConstants.EDIT_ICON_SCALE,
        fill: 'black'
      }),
      baseColor: URColors.editButton,
      centerX: verticalLine.centerX,
      bottom: numeratorBox.top - options.ySpacing
    });
    this.addChild(numeratorEditButton);
    numeratorEditButton.touchArea = numeratorEditButton.localBounds.dilatedXY(10, 0);

    // edit button for the denominator
    const denominatorEditButton = new RectangularPushButton({
      content: new Path(editRegularShape, {
        scale: URConstants.EDIT_ICON_SCALE,
        fill: 'black'
      }),
      baseColor: URColors.editButton,
      centerX: verticalLine.centerX,
      top: denominatorBox.bottom + options.ySpacing
    });
    this.addChild(denominatorEditButton);
    denominatorEditButton.touchArea = denominatorEditButton.localBounds.dilatedXY(10, 0);
    this.mutate(options);

    // Sets the position of the keypad
    const setKeypadPosition = keypad => {
      // This algorithm assumes that both buttons have the same centerX,
      // so either button can be used for horizontal positioning.
      assert && assert(numeratorEditButton.centerX === denominatorEditButton.centerX);

      // position the keypad relative to edit button and double number line panel
      const doubleNumberLinePanelBounds = keypad.globalToParentBounds(doubleNumberLinePanel.localToGlobalBounds(doubleNumberLinePanel.localBounds));
      const editButtonBounds = keypad.globalToParentBounds(numeratorEditButton.localToGlobalBounds(numeratorEditButton.localBounds));

      // Try to horizontally center the keypad on the edit button,
      // but don't let it go past the ends of the double number line panel.
      keypad.centerX = editButtonBounds.centerX;
      if (keypad.left < doubleNumberLinePanelBounds.left) {
        keypad.left = doubleNumberLinePanelBounds.left;
      } else if (keypad.right > doubleNumberLinePanelBounds.right) {
        keypad.right = doubleNumberLinePanelBounds.right;
      }

      // Put the key pad above or below the double number line panel.
      if (options.keypadPosition === 'above') {
        keypad.bottom = doubleNumberLinePanelBounds.top - 10;
      } else {
        // 'below'
        keypad.top = doubleNumberLinePanelBounds.bottom + 10;
      }
    };

    // opens a keypad for editing the numerator
    const editNumerator = () => {
      keypadLayer.beginEdit(markerEditor.numeratorProperty, {
        onBeginEdit: () => {
          numeratorBox.fill = URColors.edit;
        },
        onEndEdit: () => {
          numeratorBox.fill = 'white';
        },
        setKeypadPosition: setKeypadPosition,
        maxDigits: numeratorOptions.maxDigits,
        maxDecimals: numeratorOptions.maxDecimals,
        zeroIsValid: options.zeroIsValid
      });
    };

    // opens a keypad for editing the denominator
    const editDenominator = () => {
      keypadLayer.beginEdit(markerEditor.denominatorProperty, {
        onBeginEdit: () => {
          denominatorBox.fill = URColors.edit;
        },
        onEndEdit: () => {
          denominatorBox.fill = 'white';
        },
        setKeypadPosition: setKeypadPosition,
        maxDigits: denominatorOptions.maxDigits,
        maxDecimals: denominatorOptions.maxDecimals,
        zeroIsValid: options.zeroIsValid
      });
    };

    // Press on an edit button or box to begin editing
    numeratorEditButton.addListener(editNumerator); // no removeListener required
    numeratorBox.addInputListener(new FireListener({
      // no removeInputListener required
      fire: editNumerator
    }));
    denominatorEditButton.addListener(editDenominator); // no removeListener required
    denominatorBox.addInputListener(new FireListener({
      // no removeInputListener required
      fire: editDenominator
    }));

    // Observe edits to the numerator
    const numeratorObserver = numerator => {
      assert && assert(!isNaN(numerator), `invalid numerator: ${numerator}`);

      // update the numerator
      if (numerator) {
        numeratorNode.string = URUtils.numberToString(numerator, numeratorOptions.maxDecimals, numeratorOptions.trimZeros);
      } else {
        numeratorNode.string = '';
      }
      numeratorNode.fill = options.valueColor;
      numeratorNode.center = numeratorBox.center;

      // show the corresponding denominator
      if (phet.chipper.queryParameters.showAnswers && !markerEditor.denominatorProperty.value) {
        if (numerator) {
          const denominator = markerEditor.numeratorProperty.value / markerEditor.unitRateProperty.value;
          denominatorNode.string = URUtils.numberToString(denominator, denominatorOptions.maxDecimals, denominatorOptions.trimZeros);
        } else {
          denominatorNode.string = '';
        }
        denominatorNode.fill = URColors.showAnswers;
        denominatorNode.center = denominatorBox.center;
      }
    };
    markerEditor.numeratorProperty.link(numeratorObserver); // unlink in dispose

    // Observe edits to the denominator
    const denominatorObserver = denominator => {
      assert && assert(!isNaN(denominator), `invalid denominator: ${denominator}`);

      // update the denominator
      if (denominator) {
        denominatorNode.string = URUtils.numberToString(denominator, denominatorOptions.maxDecimals, denominatorOptions.trimZeros);
      } else {
        denominatorNode.string = '';
      }
      denominatorNode.fill = options.valueColor;
      denominatorNode.center = denominatorBox.center;

      // show the corresponding numerator
      if (phet.chipper.queryParameters.showAnswers && !markerEditor.numeratorProperty.value) {
        if (denominator) {
          const numerator = markerEditor.denominatorProperty.value * markerEditor.unitRateProperty.value;
          numeratorNode.string = URUtils.numberToString(numerator, numeratorOptions.maxDecimals, numeratorOptions.trimZeros);
        } else {
          numeratorNode.string = '';
        }
        numeratorNode.fill = URColors.showAnswers;
        numeratorNode.center = numeratorBox.center;
      }
    };
    markerEditor.denominatorProperty.link(denominatorObserver); // unlink in dispose

    // @private
    this.disposeMarkerEditorNode = () => {
      markerEditor.numeratorProperty.unlink(numeratorObserver);
      markerEditor.denominatorProperty.unlink(denominatorObserver);
      numeratorEditButton.dispose(); // workaround for memory leak https://github.com/phetsims/unit-rates/issues/207
      denominatorEditButton.dispose(); // workaround for memory leak https://github.com/phetsims/unit-rates/issues/207
    };

    // @private fields required by prototype functions
    this.numeratorNode = numeratorNode;
    this.denominatorNode = denominatorNode;
  }

  /**
   * @public
   * @override
   */
  dispose() {
    this.disposeMarkerEditorNode();
    super.dispose();
  }
}
unitRates.register('MarkerEditorNode', MarkerEditorNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtZXJnZSIsIlBoZXRGb250IiwiRmlyZUxpc3RlbmVyIiwiTGluZSIsIk5vZGUiLCJQYXRoIiwiUmVjdGFuZ2xlIiwiVGV4dCIsImVkaXRSZWd1bGFyU2hhcGUiLCJSZWN0YW5ndWxhclB1c2hCdXR0b24iLCJ1bml0UmF0ZXMiLCJVUkNvbG9ycyIsIlVSQ29uc3RhbnRzIiwiVVJVdGlscyIsIktFWVBBRF9QT1NJVElPTl9WQUxVRVMiLCJTSEFSRURfT1BUSU9OUyIsIm1heERpZ2l0cyIsIm1heERlY2ltYWxzIiwidHJpbVplcm9zIiwiTWFya2VyRWRpdG9yTm9kZSIsImNvbnN0cnVjdG9yIiwibWFya2VyRWRpdG9yIiwiZG91YmxlTnVtYmVyTGluZVBhbmVsIiwia2V5cGFkTGF5ZXIiLCJvcHRpb25zIiwibGluZUxlbmd0aCIsIk1BSk9SX01BUktFUl9MRU5HVEgiLCJ2YWx1ZUJveFdpZHRoIiwidmFsdWVGb250IiwidmFsdWVDb2xvciIsInplcm9Jc1ZhbGlkIiwidmFsdWVYTWFyZ2luIiwidmFsdWVZTWFyZ2luIiwiTUFSS0VSX1lfU1BBQ0lORyIsInlTcGFjaW5nIiwia2V5cGFkUG9zaXRpb24iLCJudW1lcmF0b3JPcHRpb25zIiwiZGVub21pbmF0b3JPcHRpb25zIiwiYXNzZXJ0IiwiXyIsImluY2x1ZGVzIiwidmVydGljYWxMaW5lIiwic3Ryb2tlIiwiYWRkQ2hpbGQiLCJ2YWx1ZUJveEhlaWdodCIsImZvbnQiLCJoZWlnaHQiLCJ2YWx1ZUJveE9wdGlvbnMiLCJmaWxsIiwiY3Vyc29yIiwibnVtZXJhdG9yQm94IiwiY2VudGVyWCIsImJvdHRvbSIsInRvcCIsImRlbm9taW5hdG9yQm94IiwibnVtZXJhdG9yTm9kZSIsInBpY2thYmxlIiwibmV1dHJhbENvbG9yIiwiY2VudGVyIiwiZGVub21pbmF0b3JOb2RlIiwibnVtZXJhdG9yRWRpdEJ1dHRvbiIsImNvbnRlbnQiLCJzY2FsZSIsIkVESVRfSUNPTl9TQ0FMRSIsImJhc2VDb2xvciIsImVkaXRCdXR0b24iLCJ0b3VjaEFyZWEiLCJsb2NhbEJvdW5kcyIsImRpbGF0ZWRYWSIsImRlbm9taW5hdG9yRWRpdEJ1dHRvbiIsIm11dGF0ZSIsInNldEtleXBhZFBvc2l0aW9uIiwia2V5cGFkIiwiZG91YmxlTnVtYmVyTGluZVBhbmVsQm91bmRzIiwiZ2xvYmFsVG9QYXJlbnRCb3VuZHMiLCJsb2NhbFRvR2xvYmFsQm91bmRzIiwiZWRpdEJ1dHRvbkJvdW5kcyIsImxlZnQiLCJyaWdodCIsImVkaXROdW1lcmF0b3IiLCJiZWdpbkVkaXQiLCJudW1lcmF0b3JQcm9wZXJ0eSIsIm9uQmVnaW5FZGl0IiwiZWRpdCIsIm9uRW5kRWRpdCIsImVkaXREZW5vbWluYXRvciIsImRlbm9taW5hdG9yUHJvcGVydHkiLCJhZGRMaXN0ZW5lciIsImFkZElucHV0TGlzdGVuZXIiLCJmaXJlIiwibnVtZXJhdG9yT2JzZXJ2ZXIiLCJudW1lcmF0b3IiLCJpc05hTiIsInN0cmluZyIsIm51bWJlclRvU3RyaW5nIiwicGhldCIsImNoaXBwZXIiLCJxdWVyeVBhcmFtZXRlcnMiLCJzaG93QW5zd2VycyIsInZhbHVlIiwiZGVub21pbmF0b3IiLCJ1bml0UmF0ZVByb3BlcnR5IiwibGluayIsImRlbm9taW5hdG9yT2JzZXJ2ZXIiLCJkaXNwb3NlTWFya2VyRWRpdG9yTm9kZSIsInVubGluayIsImRpc3Bvc2UiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIk1hcmtlckVkaXRvck5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogTWFrZXIgZWRpdG9yLCB1c2VkIHRvIG1hbnVhbGx5IGVudGVyIG1hcmtlcnMgb24gdGhlIGRvdWJsZSBudW1iZXIgbGluZS5cclxuICogVmFsdWVzIGFyZSBlbnRlcmVkIHZpYSBhIGtleXBhZC5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IEZpcmVMaXN0ZW5lciwgTGluZSwgTm9kZSwgUGF0aCwgUmVjdGFuZ2xlLCBUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGVkaXRSZWd1bGFyU2hhcGUgZnJvbSAnLi4vLi4vLi4vLi4vc2hlcnBhL2pzL2ZvbnRhd2Vzb21lLTUvZWRpdFJlZ3VsYXJTaGFwZS5qcyc7XHJcbmltcG9ydCBSZWN0YW5ndWxhclB1c2hCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL2J1dHRvbnMvUmVjdGFuZ3VsYXJQdXNoQnV0dG9uLmpzJztcclxuaW1wb3J0IHVuaXRSYXRlcyBmcm9tICcuLi8uLi91bml0UmF0ZXMuanMnO1xyXG5pbXBvcnQgVVJDb2xvcnMgZnJvbSAnLi4vVVJDb2xvcnMuanMnO1xyXG5pbXBvcnQgVVJDb25zdGFudHMgZnJvbSAnLi4vVVJDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgVVJVdGlscyBmcm9tICcuLi9VUlV0aWxzLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBLRVlQQURfUE9TSVRJT05fVkFMVUVTID0gWyAnYWJvdmUnLCAnYmVsb3cnIF07XHJcbmNvbnN0IFNIQVJFRF9PUFRJT05TID0ge1xyXG4gIG1heERpZ2l0czogNCwgLy8ge251bWJlcn0gbWF4aW11bSBudW1iZXIgb2YgZGlnaXRzIHRoYXQgY2FuIGJlIGVudGVyZWQgdmlhIGtleXBhZFxyXG4gIG1heERlY2ltYWxzOiAxLCAvLyB7bnVtYmVyfSBtYXhpbXVtIG51bWJlciBvZiBkZWNpbWFsIHBsYWNlcyB0aGF0IGNhbiBiZSBlbnRlcmVkIHZpYSBrZXlwYWRcclxuICB0cmltWmVyb3M6IGZhbHNlIC8vIHtib29sZWFufSB3aGV0aGVyIHRvIHRyaW0gdHJhaWxpbmcgemVyb3MgZnJvbSBkZWNpbWFsIHBsYWNlc1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWFya2VyRWRpdG9yTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge01hcmtlckVkaXRvcn0gbWFya2VyRWRpdG9yXHJcbiAgICogQHBhcmFtIHtOb2RlfSBkb3VibGVOdW1iZXJMaW5lUGFuZWwgLSBwYW5lbCB0aGF0IGNvbnRhaW5zIHRoZSBkb3VibGUgbnVtYmVyIGxpbmUsIGZvciBwb3NpdGlvbmluZyB0aGUga2V5cGFkXHJcbiAgICogQHBhcmFtIHtLZXlwYWRMYXllcn0ga2V5cGFkTGF5ZXIgLSBsYXllciB0aGF0IG1hbmFnZXMgdGhlIGtleXBhZFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggbWFya2VyRWRpdG9yLCBkb3VibGVOdW1iZXJMaW5lUGFuZWwsIGtleXBhZExheWVyLCBvcHRpb25zICkge1xyXG5cclxuICAgIG9wdGlvbnMgPSBtZXJnZSgge1xyXG4gICAgICBsaW5lTGVuZ3RoOiBVUkNvbnN0YW50cy5NQUpPUl9NQVJLRVJfTEVOR1RILCAvLyB7bnVtYmVyfSBsZW5ndGggb2YgdGhlIHZlcnRpY2FsIGxpbmUgYmV0d2VlbiBudW1lcmF0b3IgYW5kIGRlbm9taW5hdG9yIHZhbHVlc1xyXG4gICAgICB2YWx1ZUJveFdpZHRoOiA1NSwgLy8ge251bWJlcn0gd2lkdGggb2YgdGhlIHZhbHVlIGZpZWxkLCBoZWlnaHQgZGV0ZXJtaW5lZCBieSB2YWx1ZUZvbnRcclxuICAgICAgdmFsdWVGb250OiBuZXcgUGhldEZvbnQoIDEyICksIC8vIHtGb250fSBmb250IGZvciB0aGUgdmFsdWVcclxuICAgICAgdmFsdWVDb2xvcjogJ2JsYWNrJywgLy8ge0NvbG9yfHN0cmluZ30gY29sb3Igb2YgdGhlIHZhbHVlXHJcbiAgICAgIHplcm9Jc1ZhbGlkOiBmYWxzZSwgLy8ge2Jvb2xlYW59IHplcm8gaXMgbm90IGEgdmFsaWQgdmFsdWUgZm9yIG1hcmtlcnNcclxuICAgICAgdmFsdWVYTWFyZ2luOiA1LCAvLyB7bnVtYmVyfSBob3Jpem9udGFsIG1hcmdpbiBpbnNpZGUgdGhlIHZhbHVlIGJveFxyXG4gICAgICB2YWx1ZVlNYXJnaW46IFVSQ29uc3RhbnRzLk1BUktFUl9ZX1NQQUNJTkcsIC8vIHtudW1iZXJ9IHZlcnRpY2FsIG1hcmdpbiBpbnNpZGUgdGhlIHZhbHVlIGJveFxyXG4gICAgICB5U3BhY2luZzogMywgIC8vIHtudW1iZXJ9IHZlcnRpY2FsIHNwYWNpbmcgYmV0d2VlbiBVSSBlbGVtZW50c1xyXG4gICAgICBrZXlwYWRQb3NpdGlvbjogJ2JlbG93JywgLy8ge3N0cmluZ30gJ2Fib3ZlJyBvciAnYmVsb3cnIGRvdWJsZU51bWJlckxpbmVQYW5lbFxyXG4gICAgICBudW1lcmF0b3JPcHRpb25zOiBudWxsLCAvLyB7Kn0gb3B0aW9ucyBzcGVjaWZpYyB0byB0aGUgcmF0ZSdzIG51bWVyYXRvciwgc2VlIGJlbG93XHJcbiAgICAgIGRlbm9taW5hdG9yT3B0aW9uczogbnVsbCAvLyB7Kn0gb3B0aW9ucyBzcGVjaWZpYyB0byB0aGUgcmF0ZSdzIGRlbm9taW5hdG9yLCBzZWUgYmVsb3dcclxuICAgIH0sIG9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCBudW1lcmF0b3JPcHRpb25zID0gbWVyZ2UoIHt9LCBTSEFSRURfT1BUSU9OUywgb3B0aW9ucy5udW1lcmF0b3JPcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgZGVub21pbmF0b3JPcHRpb25zID0gbWVyZ2UoIHt9LCBTSEFSRURfT1BUSU9OUywgb3B0aW9ucy5kZW5vbWluYXRvck9wdGlvbnMgKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBfLmluY2x1ZGVzKCBLRVlQQURfUE9TSVRJT05fVkFMVUVTLCBvcHRpb25zLmtleXBhZFBvc2l0aW9uICksXHJcbiAgICAgIGBpbnZhbGlkIGtleXBhZFBvc2l0aW9uOiAke29wdGlvbnMua2V5cGFkUG9zaXRpb259YCApO1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgLy8gdmVydGljYWwgbGluZVxyXG4gICAgY29uc3QgdmVydGljYWxMaW5lID0gbmV3IExpbmUoIDAsIDAsIDAsIG9wdGlvbnMubGluZUxlbmd0aCwge1xyXG4gICAgICBzdHJva2U6ICdibGFjaydcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHZlcnRpY2FsTGluZSApO1xyXG5cclxuICAgIC8vIGNvbW1vbiB0byBib3RoIHZhbHVlIGJveGVzXHJcbiAgICBjb25zdCB2YWx1ZUJveFdpZHRoID0gb3B0aW9ucy52YWx1ZUJveFdpZHRoO1xyXG4gICAgY29uc3QgdmFsdWVCb3hIZWlnaHQgPSBuZXcgVGV4dCggJzAnLCB7IGZvbnQ6IG9wdGlvbnMudmFsdWVGb250IH0gKS5oZWlnaHQgKyAoIDIgKiBvcHRpb25zLnZhbHVlWU1hcmdpbiApO1xyXG4gICAgY29uc3QgdmFsdWVCb3hPcHRpb25zID0ge1xyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICAgIGN1cnNvcjogJ3BvaW50ZXInXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIGJveCBmb3IgdGhlIG51bWVyYXRvclxyXG4gICAgY29uc3QgbnVtZXJhdG9yQm94ID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgdmFsdWVCb3hXaWR0aCwgdmFsdWVCb3hIZWlnaHQsXHJcbiAgICAgIG1lcmdlKCB7fSwgdmFsdWVCb3hPcHRpb25zLCB7XHJcbiAgICAgICAgY2VudGVyWDogdmVydGljYWxMaW5lLmNlbnRlclgsXHJcbiAgICAgICAgYm90dG9tOiB2ZXJ0aWNhbExpbmUudG9wXHJcbiAgICAgIH0gKSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbnVtZXJhdG9yQm94ICk7XHJcblxyXG4gICAgLy8gYm94IGZvciB0aGUgZGVub21pbmF0b3JcclxuICAgIGNvbnN0IGRlbm9taW5hdG9yQm94ID0gbmV3IFJlY3RhbmdsZSggMCwgMCwgdmFsdWVCb3hXaWR0aCwgdmFsdWVCb3hIZWlnaHQsXHJcbiAgICAgIG1lcmdlKCB7fSwgdmFsdWVCb3hPcHRpb25zLCB7XHJcbiAgICAgICAgY2VudGVyWDogdmVydGljYWxMaW5lLmNlbnRlclgsXHJcbiAgICAgICAgdG9wOiB2ZXJ0aWNhbExpbmUuYm90dG9tXHJcbiAgICAgIH0gKSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggZGVub21pbmF0b3JCb3ggKTtcclxuXHJcbiAgICAvLyBudW1lcmF0b3IgdmFsdWVcclxuICAgIGNvbnN0IG51bWVyYXRvck5vZGUgPSBuZXcgVGV4dCggJycsIHtcclxuICAgICAgcGlja2FibGU6IGZhbHNlLCAvLyBzbyBpdCBkb2Vzbid0IGludGVyZmVyZSB3aXRoIGNsaWNraW5nIGluIG51bWVyYXRvckJveCB0byBvcGVuIGtleXBhZFxyXG4gICAgICBmaWxsOiBvcHRpb25zLm5ldXRyYWxDb2xvcixcclxuICAgICAgZm9udDogb3B0aW9ucy52YWx1ZUZvbnQsXHJcbiAgICAgIGNlbnRlcjogbnVtZXJhdG9yQm94LmNlbnRlclxyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggbnVtZXJhdG9yTm9kZSApO1xyXG5cclxuICAgIC8vIGRlbm9taW5hdG9yIHZhbHVlXHJcbiAgICBjb25zdCBkZW5vbWluYXRvck5vZGUgPSBuZXcgVGV4dCggJycsIHtcclxuICAgICAgcGlja2FibGU6IGZhbHNlLCAvLyBzbyBpdCBkb2Vzbid0IGludGVyZmVyZSB3aXRoIGNsaWNraW5nIGluIGRlbm9taW5hdG9yQm94IHRvIG9wZW4ga2V5cGFkXHJcbiAgICAgIGZpbGw6IG9wdGlvbnMubmV1dHJhbENvbG9yLFxyXG4gICAgICBmb250OiBvcHRpb25zLnZhbHVlRm9udCxcclxuICAgICAgY2VudGVyOiBkZW5vbWluYXRvckJveC5jZW50ZXJcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGRlbm9taW5hdG9yTm9kZSApO1xyXG5cclxuICAgIC8vIGVkaXQgYnV0dG9uIGZvciB0aGUgbnVtZXJhdG9yXHJcbiAgICBjb25zdCBudW1lcmF0b3JFZGl0QnV0dG9uID0gbmV3IFJlY3Rhbmd1bGFyUHVzaEJ1dHRvbigge1xyXG4gICAgICBjb250ZW50OiBuZXcgUGF0aCggZWRpdFJlZ3VsYXJTaGFwZSwge1xyXG4gICAgICAgIHNjYWxlOiBVUkNvbnN0YW50cy5FRElUX0lDT05fU0NBTEUsXHJcbiAgICAgICAgZmlsbDogJ2JsYWNrJ1xyXG4gICAgICB9ICksXHJcbiAgICAgIGJhc2VDb2xvcjogVVJDb2xvcnMuZWRpdEJ1dHRvbixcclxuICAgICAgY2VudGVyWDogdmVydGljYWxMaW5lLmNlbnRlclgsXHJcbiAgICAgIGJvdHRvbTogbnVtZXJhdG9yQm94LnRvcCAtIG9wdGlvbnMueVNwYWNpbmdcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIG51bWVyYXRvckVkaXRCdXR0b24gKTtcclxuICAgIG51bWVyYXRvckVkaXRCdXR0b24udG91Y2hBcmVhID0gbnVtZXJhdG9yRWRpdEJ1dHRvbi5sb2NhbEJvdW5kcy5kaWxhdGVkWFkoIDEwLCAwICk7XHJcblxyXG4gICAgLy8gZWRpdCBidXR0b24gZm9yIHRoZSBkZW5vbWluYXRvclxyXG4gICAgY29uc3QgZGVub21pbmF0b3JFZGl0QnV0dG9uID0gbmV3IFJlY3Rhbmd1bGFyUHVzaEJ1dHRvbigge1xyXG4gICAgICBjb250ZW50OiBuZXcgUGF0aCggZWRpdFJlZ3VsYXJTaGFwZSwge1xyXG4gICAgICAgIHNjYWxlOiBVUkNvbnN0YW50cy5FRElUX0lDT05fU0NBTEUsXHJcbiAgICAgICAgZmlsbDogJ2JsYWNrJ1xyXG4gICAgICB9ICksXHJcbiAgICAgIGJhc2VDb2xvcjogVVJDb2xvcnMuZWRpdEJ1dHRvbixcclxuICAgICAgY2VudGVyWDogdmVydGljYWxMaW5lLmNlbnRlclgsXHJcbiAgICAgIHRvcDogZGVub21pbmF0b3JCb3guYm90dG9tICsgb3B0aW9ucy55U3BhY2luZ1xyXG4gICAgfSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggZGVub21pbmF0b3JFZGl0QnV0dG9uICk7XHJcbiAgICBkZW5vbWluYXRvckVkaXRCdXR0b24udG91Y2hBcmVhID0gZGVub21pbmF0b3JFZGl0QnV0dG9uLmxvY2FsQm91bmRzLmRpbGF0ZWRYWSggMTAsIDAgKTtcclxuXHJcbiAgICB0aGlzLm11dGF0ZSggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIFNldHMgdGhlIHBvc2l0aW9uIG9mIHRoZSBrZXlwYWRcclxuICAgIGNvbnN0IHNldEtleXBhZFBvc2l0aW9uID0ga2V5cGFkID0+IHtcclxuXHJcbiAgICAgIC8vIFRoaXMgYWxnb3JpdGhtIGFzc3VtZXMgdGhhdCBib3RoIGJ1dHRvbnMgaGF2ZSB0aGUgc2FtZSBjZW50ZXJYLFxyXG4gICAgICAvLyBzbyBlaXRoZXIgYnV0dG9uIGNhbiBiZSB1c2VkIGZvciBob3Jpem9udGFsIHBvc2l0aW9uaW5nLlxyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBudW1lcmF0b3JFZGl0QnV0dG9uLmNlbnRlclggPT09IGRlbm9taW5hdG9yRWRpdEJ1dHRvbi5jZW50ZXJYICk7XHJcblxyXG4gICAgICAvLyBwb3NpdGlvbiB0aGUga2V5cGFkIHJlbGF0aXZlIHRvIGVkaXQgYnV0dG9uIGFuZCBkb3VibGUgbnVtYmVyIGxpbmUgcGFuZWxcclxuICAgICAgY29uc3QgZG91YmxlTnVtYmVyTGluZVBhbmVsQm91bmRzID1cclxuICAgICAgICBrZXlwYWQuZ2xvYmFsVG9QYXJlbnRCb3VuZHMoIGRvdWJsZU51bWJlckxpbmVQYW5lbC5sb2NhbFRvR2xvYmFsQm91bmRzKCBkb3VibGVOdW1iZXJMaW5lUGFuZWwubG9jYWxCb3VuZHMgKSApO1xyXG4gICAgICBjb25zdCBlZGl0QnV0dG9uQm91bmRzID1cclxuICAgICAgICBrZXlwYWQuZ2xvYmFsVG9QYXJlbnRCb3VuZHMoIG51bWVyYXRvckVkaXRCdXR0b24ubG9jYWxUb0dsb2JhbEJvdW5kcyggbnVtZXJhdG9yRWRpdEJ1dHRvbi5sb2NhbEJvdW5kcyApICk7XHJcblxyXG4gICAgICAvLyBUcnkgdG8gaG9yaXpvbnRhbGx5IGNlbnRlciB0aGUga2V5cGFkIG9uIHRoZSBlZGl0IGJ1dHRvbixcclxuICAgICAgLy8gYnV0IGRvbid0IGxldCBpdCBnbyBwYXN0IHRoZSBlbmRzIG9mIHRoZSBkb3VibGUgbnVtYmVyIGxpbmUgcGFuZWwuXHJcbiAgICAgIGtleXBhZC5jZW50ZXJYID0gZWRpdEJ1dHRvbkJvdW5kcy5jZW50ZXJYO1xyXG4gICAgICBpZiAoIGtleXBhZC5sZWZ0IDwgZG91YmxlTnVtYmVyTGluZVBhbmVsQm91bmRzLmxlZnQgKSB7XHJcbiAgICAgICAga2V5cGFkLmxlZnQgPSBkb3VibGVOdW1iZXJMaW5lUGFuZWxCb3VuZHMubGVmdDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICgga2V5cGFkLnJpZ2h0ID4gZG91YmxlTnVtYmVyTGluZVBhbmVsQm91bmRzLnJpZ2h0ICkge1xyXG4gICAgICAgIGtleXBhZC5yaWdodCA9IGRvdWJsZU51bWJlckxpbmVQYW5lbEJvdW5kcy5yaWdodDtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gUHV0IHRoZSBrZXkgcGFkIGFib3ZlIG9yIGJlbG93IHRoZSBkb3VibGUgbnVtYmVyIGxpbmUgcGFuZWwuXHJcbiAgICAgIGlmICggb3B0aW9ucy5rZXlwYWRQb3NpdGlvbiA9PT0gJ2Fib3ZlJyApIHtcclxuICAgICAgICBrZXlwYWQuYm90dG9tID0gZG91YmxlTnVtYmVyTGluZVBhbmVsQm91bmRzLnRvcCAtIDEwO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgeyAvLyAnYmVsb3cnXHJcbiAgICAgICAga2V5cGFkLnRvcCA9IGRvdWJsZU51bWJlckxpbmVQYW5lbEJvdW5kcy5ib3R0b20gKyAxMDtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBvcGVucyBhIGtleXBhZCBmb3IgZWRpdGluZyB0aGUgbnVtZXJhdG9yXHJcbiAgICBjb25zdCBlZGl0TnVtZXJhdG9yID0gKCkgPT4ge1xyXG4gICAgICBrZXlwYWRMYXllci5iZWdpbkVkaXQoIG1hcmtlckVkaXRvci5udW1lcmF0b3JQcm9wZXJ0eSwge1xyXG4gICAgICAgIG9uQmVnaW5FZGl0OiAoKSA9PiB7IG51bWVyYXRvckJveC5maWxsID0gVVJDb2xvcnMuZWRpdDsgfSxcclxuICAgICAgICBvbkVuZEVkaXQ6ICgpID0+IHsgbnVtZXJhdG9yQm94LmZpbGwgPSAnd2hpdGUnOyB9LFxyXG4gICAgICAgIHNldEtleXBhZFBvc2l0aW9uOiBzZXRLZXlwYWRQb3NpdGlvbixcclxuICAgICAgICBtYXhEaWdpdHM6IG51bWVyYXRvck9wdGlvbnMubWF4RGlnaXRzLFxyXG4gICAgICAgIG1heERlY2ltYWxzOiBudW1lcmF0b3JPcHRpb25zLm1heERlY2ltYWxzLFxyXG4gICAgICAgIHplcm9Jc1ZhbGlkOiBvcHRpb25zLnplcm9Jc1ZhbGlkXHJcbiAgICAgIH0gKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gb3BlbnMgYSBrZXlwYWQgZm9yIGVkaXRpbmcgdGhlIGRlbm9taW5hdG9yXHJcbiAgICBjb25zdCBlZGl0RGVub21pbmF0b3IgPSAoKSA9PiB7XHJcbiAgICAgIGtleXBhZExheWVyLmJlZ2luRWRpdCggbWFya2VyRWRpdG9yLmRlbm9taW5hdG9yUHJvcGVydHksIHtcclxuICAgICAgICBvbkJlZ2luRWRpdDogKCkgPT4geyBkZW5vbWluYXRvckJveC5maWxsID0gVVJDb2xvcnMuZWRpdDsgfSxcclxuICAgICAgICBvbkVuZEVkaXQ6ICgpID0+IHsgZGVub21pbmF0b3JCb3guZmlsbCA9ICd3aGl0ZSc7IH0sXHJcbiAgICAgICAgc2V0S2V5cGFkUG9zaXRpb246IHNldEtleXBhZFBvc2l0aW9uLFxyXG4gICAgICAgIG1heERpZ2l0czogZGVub21pbmF0b3JPcHRpb25zLm1heERpZ2l0cyxcclxuICAgICAgICBtYXhEZWNpbWFsczogZGVub21pbmF0b3JPcHRpb25zLm1heERlY2ltYWxzLFxyXG4gICAgICAgIHplcm9Jc1ZhbGlkOiBvcHRpb25zLnplcm9Jc1ZhbGlkXHJcbiAgICAgIH0gKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gUHJlc3Mgb24gYW4gZWRpdCBidXR0b24gb3IgYm94IHRvIGJlZ2luIGVkaXRpbmdcclxuICAgIG51bWVyYXRvckVkaXRCdXR0b24uYWRkTGlzdGVuZXIoIGVkaXROdW1lcmF0b3IgKTsgLy8gbm8gcmVtb3ZlTGlzdGVuZXIgcmVxdWlyZWRcclxuICAgIG51bWVyYXRvckJveC5hZGRJbnB1dExpc3RlbmVyKCBuZXcgRmlyZUxpc3RlbmVyKCB7IC8vIG5vIHJlbW92ZUlucHV0TGlzdGVuZXIgcmVxdWlyZWRcclxuICAgICAgZmlyZTogZWRpdE51bWVyYXRvclxyXG4gICAgfSApICk7XHJcbiAgICBkZW5vbWluYXRvckVkaXRCdXR0b24uYWRkTGlzdGVuZXIoIGVkaXREZW5vbWluYXRvciApOyAvLyBubyByZW1vdmVMaXN0ZW5lciByZXF1aXJlZFxyXG4gICAgZGVub21pbmF0b3JCb3guYWRkSW5wdXRMaXN0ZW5lciggbmV3IEZpcmVMaXN0ZW5lciggeyAvLyBubyByZW1vdmVJbnB1dExpc3RlbmVyIHJlcXVpcmVkXHJcbiAgICAgIGZpcmU6IGVkaXREZW5vbWluYXRvclxyXG4gICAgfSApICk7XHJcblxyXG4gICAgLy8gT2JzZXJ2ZSBlZGl0cyB0byB0aGUgbnVtZXJhdG9yXHJcbiAgICBjb25zdCBudW1lcmF0b3JPYnNlcnZlciA9IG51bWVyYXRvciA9PiB7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoICFpc05hTiggbnVtZXJhdG9yICksIGBpbnZhbGlkIG51bWVyYXRvcjogJHtudW1lcmF0b3J9YCApO1xyXG5cclxuICAgICAgLy8gdXBkYXRlIHRoZSBudW1lcmF0b3JcclxuICAgICAgaWYgKCBudW1lcmF0b3IgKSB7XHJcbiAgICAgICAgbnVtZXJhdG9yTm9kZS5zdHJpbmcgPSBVUlV0aWxzLm51bWJlclRvU3RyaW5nKCBudW1lcmF0b3IsIG51bWVyYXRvck9wdGlvbnMubWF4RGVjaW1hbHMsIG51bWVyYXRvck9wdGlvbnMudHJpbVplcm9zICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgbnVtZXJhdG9yTm9kZS5zdHJpbmcgPSAnJztcclxuICAgICAgfVxyXG4gICAgICBudW1lcmF0b3JOb2RlLmZpbGwgPSBvcHRpb25zLnZhbHVlQ29sb3I7XHJcbiAgICAgIG51bWVyYXRvck5vZGUuY2VudGVyID0gbnVtZXJhdG9yQm94LmNlbnRlcjtcclxuXHJcbiAgICAgIC8vIHNob3cgdGhlIGNvcnJlc3BvbmRpbmcgZGVub21pbmF0b3JcclxuICAgICAgaWYgKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnNob3dBbnN3ZXJzICYmICFtYXJrZXJFZGl0b3IuZGVub21pbmF0b3JQcm9wZXJ0eS52YWx1ZSApIHtcclxuICAgICAgICBpZiAoIG51bWVyYXRvciApIHtcclxuICAgICAgICAgIGNvbnN0IGRlbm9taW5hdG9yID0gbWFya2VyRWRpdG9yLm51bWVyYXRvclByb3BlcnR5LnZhbHVlIC8gbWFya2VyRWRpdG9yLnVuaXRSYXRlUHJvcGVydHkudmFsdWU7XHJcbiAgICAgICAgICBkZW5vbWluYXRvck5vZGUuc3RyaW5nID0gVVJVdGlscy5udW1iZXJUb1N0cmluZyggZGVub21pbmF0b3IsIGRlbm9taW5hdG9yT3B0aW9ucy5tYXhEZWNpbWFscywgZGVub21pbmF0b3JPcHRpb25zLnRyaW1aZXJvcyApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGRlbm9taW5hdG9yTm9kZS5zdHJpbmcgPSAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgZGVub21pbmF0b3JOb2RlLmZpbGwgPSBVUkNvbG9ycy5zaG93QW5zd2VycztcclxuICAgICAgICBkZW5vbWluYXRvck5vZGUuY2VudGVyID0gZGVub21pbmF0b3JCb3guY2VudGVyO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgbWFya2VyRWRpdG9yLm51bWVyYXRvclByb3BlcnR5LmxpbmsoIG51bWVyYXRvck9ic2VydmVyICk7IC8vIHVubGluayBpbiBkaXNwb3NlXHJcblxyXG4gICAgLy8gT2JzZXJ2ZSBlZGl0cyB0byB0aGUgZGVub21pbmF0b3JcclxuICAgIGNvbnN0IGRlbm9taW5hdG9yT2JzZXJ2ZXIgPSBkZW5vbWluYXRvciA9PiB7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoICFpc05hTiggZGVub21pbmF0b3IgKSwgYGludmFsaWQgZGVub21pbmF0b3I6ICR7ZGVub21pbmF0b3J9YCApO1xyXG5cclxuICAgICAgLy8gdXBkYXRlIHRoZSBkZW5vbWluYXRvclxyXG4gICAgICBpZiAoIGRlbm9taW5hdG9yICkge1xyXG4gICAgICAgIGRlbm9taW5hdG9yTm9kZS5zdHJpbmcgPSBVUlV0aWxzLm51bWJlclRvU3RyaW5nKCBkZW5vbWluYXRvciwgZGVub21pbmF0b3JPcHRpb25zLm1heERlY2ltYWxzLCBkZW5vbWluYXRvck9wdGlvbnMudHJpbVplcm9zICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgZGVub21pbmF0b3JOb2RlLnN0cmluZyA9ICcnO1xyXG4gICAgICB9XHJcbiAgICAgIGRlbm9taW5hdG9yTm9kZS5maWxsID0gb3B0aW9ucy52YWx1ZUNvbG9yO1xyXG4gICAgICBkZW5vbWluYXRvck5vZGUuY2VudGVyID0gZGVub21pbmF0b3JCb3guY2VudGVyO1xyXG5cclxuICAgICAgLy8gc2hvdyB0aGUgY29ycmVzcG9uZGluZyBudW1lcmF0b3JcclxuICAgICAgaWYgKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnNob3dBbnN3ZXJzICYmICFtYXJrZXJFZGl0b3IubnVtZXJhdG9yUHJvcGVydHkudmFsdWUgKSB7XHJcbiAgICAgICAgaWYgKCBkZW5vbWluYXRvciApIHtcclxuICAgICAgICAgIGNvbnN0IG51bWVyYXRvciA9IG1hcmtlckVkaXRvci5kZW5vbWluYXRvclByb3BlcnR5LnZhbHVlICogbWFya2VyRWRpdG9yLnVuaXRSYXRlUHJvcGVydHkudmFsdWU7XHJcbiAgICAgICAgICBudW1lcmF0b3JOb2RlLnN0cmluZyA9IFVSVXRpbHMubnVtYmVyVG9TdHJpbmcoIG51bWVyYXRvciwgbnVtZXJhdG9yT3B0aW9ucy5tYXhEZWNpbWFscywgbnVtZXJhdG9yT3B0aW9ucy50cmltWmVyb3MgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBudW1lcmF0b3JOb2RlLnN0cmluZyA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBudW1lcmF0b3JOb2RlLmZpbGwgPSBVUkNvbG9ycy5zaG93QW5zd2VycztcclxuICAgICAgICBudW1lcmF0b3JOb2RlLmNlbnRlciA9IG51bWVyYXRvckJveC5jZW50ZXI7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBtYXJrZXJFZGl0b3IuZGVub21pbmF0b3JQcm9wZXJ0eS5saW5rKCBkZW5vbWluYXRvck9ic2VydmVyICk7IC8vIHVubGluayBpbiBkaXNwb3NlXHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMuZGlzcG9zZU1hcmtlckVkaXRvck5vZGUgPSAoKSA9PiB7XHJcbiAgICAgIG1hcmtlckVkaXRvci5udW1lcmF0b3JQcm9wZXJ0eS51bmxpbmsoIG51bWVyYXRvck9ic2VydmVyICk7XHJcbiAgICAgIG1hcmtlckVkaXRvci5kZW5vbWluYXRvclByb3BlcnR5LnVubGluayggZGVub21pbmF0b3JPYnNlcnZlciApO1xyXG4gICAgICBudW1lcmF0b3JFZGl0QnV0dG9uLmRpc3Bvc2UoKTsgLy8gd29ya2Fyb3VuZCBmb3IgbWVtb3J5IGxlYWsgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3VuaXQtcmF0ZXMvaXNzdWVzLzIwN1xyXG4gICAgICBkZW5vbWluYXRvckVkaXRCdXR0b24uZGlzcG9zZSgpOyAvLyB3b3JrYXJvdW5kIGZvciBtZW1vcnkgbGVhayBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvdW5pdC1yYXRlcy9pc3N1ZXMvMjA3XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEBwcml2YXRlIGZpZWxkcyByZXF1aXJlZCBieSBwcm90b3R5cGUgZnVuY3Rpb25zXHJcbiAgICB0aGlzLm51bWVyYXRvck5vZGUgPSBudW1lcmF0b3JOb2RlO1xyXG4gICAgdGhpcy5kZW5vbWluYXRvck5vZGUgPSBkZW5vbWluYXRvck5vZGU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHVibGljXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICovXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIHRoaXMuZGlzcG9zZU1hcmtlckVkaXRvck5vZGUoKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbnVuaXRSYXRlcy5yZWdpc3RlciggJ01hcmtlckVkaXRvck5vZGUnLCBNYXJrZXJFZGl0b3JOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsS0FBSyxNQUFNLG1DQUFtQztBQUNyRCxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLFlBQVksRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsU0FBUyxFQUFFQyxJQUFJLFFBQVEsbUNBQW1DO0FBQ25HLE9BQU9DLGdCQUFnQixNQUFNLHlEQUF5RDtBQUN0RixPQUFPQyxxQkFBcUIsTUFBTSxxREFBcUQ7QUFDdkYsT0FBT0MsU0FBUyxNQUFNLG9CQUFvQjtBQUMxQyxPQUFPQyxRQUFRLE1BQU0sZ0JBQWdCO0FBQ3JDLE9BQU9DLFdBQVcsTUFBTSxtQkFBbUI7QUFDM0MsT0FBT0MsT0FBTyxNQUFNLGVBQWU7O0FBRW5DO0FBQ0EsTUFBTUMsc0JBQXNCLEdBQUcsQ0FBRSxPQUFPLEVBQUUsT0FBTyxDQUFFO0FBQ25ELE1BQU1DLGNBQWMsR0FBRztFQUNyQkMsU0FBUyxFQUFFLENBQUM7RUFBRTtFQUNkQyxXQUFXLEVBQUUsQ0FBQztFQUFFO0VBQ2hCQyxTQUFTLEVBQUUsS0FBSyxDQUFDO0FBQ25CLENBQUM7O0FBRUQsZUFBZSxNQUFNQyxnQkFBZ0IsU0FBU2YsSUFBSSxDQUFDO0VBRWpEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFZ0IsV0FBV0EsQ0FBRUMsWUFBWSxFQUFFQyxxQkFBcUIsRUFBRUMsV0FBVyxFQUFFQyxPQUFPLEVBQUc7SUFFdkVBLE9BQU8sR0FBR3hCLEtBQUssQ0FBRTtNQUNmeUIsVUFBVSxFQUFFYixXQUFXLENBQUNjLG1CQUFtQjtNQUFFO01BQzdDQyxhQUFhLEVBQUUsRUFBRTtNQUFFO01BQ25CQyxTQUFTLEVBQUUsSUFBSTNCLFFBQVEsQ0FBRSxFQUFHLENBQUM7TUFBRTtNQUMvQjRCLFVBQVUsRUFBRSxPQUFPO01BQUU7TUFDckJDLFdBQVcsRUFBRSxLQUFLO01BQUU7TUFDcEJDLFlBQVksRUFBRSxDQUFDO01BQUU7TUFDakJDLFlBQVksRUFBRXBCLFdBQVcsQ0FBQ3FCLGdCQUFnQjtNQUFFO01BQzVDQyxRQUFRLEVBQUUsQ0FBQztNQUFHO01BQ2RDLGNBQWMsRUFBRSxPQUFPO01BQUU7TUFDekJDLGdCQUFnQixFQUFFLElBQUk7TUFBRTtNQUN4QkMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDO0lBQzNCLENBQUMsRUFBRWIsT0FBUSxDQUFDO0lBRVosTUFBTVksZ0JBQWdCLEdBQUdwQyxLQUFLLENBQUUsQ0FBQyxDQUFDLEVBQUVlLGNBQWMsRUFBRVMsT0FBTyxDQUFDWSxnQkFBaUIsQ0FBQztJQUU5RSxNQUFNQyxrQkFBa0IsR0FBR3JDLEtBQUssQ0FBRSxDQUFDLENBQUMsRUFBRWUsY0FBYyxFQUFFUyxPQUFPLENBQUNhLGtCQUFtQixDQUFDO0lBRWxGQyxNQUFNLElBQUlBLE1BQU0sQ0FBRUMsQ0FBQyxDQUFDQyxRQUFRLENBQUUxQixzQkFBc0IsRUFBRVUsT0FBTyxDQUFDVyxjQUFlLENBQUMsRUFDM0UsMkJBQTBCWCxPQUFPLENBQUNXLGNBQWUsRUFBRSxDQUFDO0lBRXZELEtBQUssQ0FBQyxDQUFDOztJQUVQO0lBQ0EsTUFBTU0sWUFBWSxHQUFHLElBQUl0QyxJQUFJLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUVxQixPQUFPLENBQUNDLFVBQVUsRUFBRTtNQUMxRGlCLE1BQU0sRUFBRTtJQUNWLENBQUUsQ0FBQztJQUNILElBQUksQ0FBQ0MsUUFBUSxDQUFFRixZQUFhLENBQUM7O0lBRTdCO0lBQ0EsTUFBTWQsYUFBYSxHQUFHSCxPQUFPLENBQUNHLGFBQWE7SUFDM0MsTUFBTWlCLGNBQWMsR0FBRyxJQUFJckMsSUFBSSxDQUFFLEdBQUcsRUFBRTtNQUFFc0MsSUFBSSxFQUFFckIsT0FBTyxDQUFDSTtJQUFVLENBQUUsQ0FBQyxDQUFDa0IsTUFBTSxHQUFLLENBQUMsR0FBR3RCLE9BQU8sQ0FBQ1EsWUFBYztJQUN6RyxNQUFNZSxlQUFlLEdBQUc7TUFDdEJMLE1BQU0sRUFBRSxPQUFPO01BQ2ZNLElBQUksRUFBRSxPQUFPO01BQ2JDLE1BQU0sRUFBRTtJQUNWLENBQUM7O0lBRUQ7SUFDQSxNQUFNQyxZQUFZLEdBQUcsSUFBSTVDLFNBQVMsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFcUIsYUFBYSxFQUFFaUIsY0FBYyxFQUNyRTVDLEtBQUssQ0FBRSxDQUFDLENBQUMsRUFBRStDLGVBQWUsRUFBRTtNQUMxQkksT0FBTyxFQUFFVixZQUFZLENBQUNVLE9BQU87TUFDN0JDLE1BQU0sRUFBRVgsWUFBWSxDQUFDWTtJQUN2QixDQUFFLENBQUUsQ0FBQztJQUNQLElBQUksQ0FBQ1YsUUFBUSxDQUFFTyxZQUFhLENBQUM7O0lBRTdCO0lBQ0EsTUFBTUksY0FBYyxHQUFHLElBQUloRCxTQUFTLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRXFCLGFBQWEsRUFBRWlCLGNBQWMsRUFDdkU1QyxLQUFLLENBQUUsQ0FBQyxDQUFDLEVBQUUrQyxlQUFlLEVBQUU7TUFDMUJJLE9BQU8sRUFBRVYsWUFBWSxDQUFDVSxPQUFPO01BQzdCRSxHQUFHLEVBQUVaLFlBQVksQ0FBQ1c7SUFDcEIsQ0FBRSxDQUFFLENBQUM7SUFDUCxJQUFJLENBQUNULFFBQVEsQ0FBRVcsY0FBZSxDQUFDOztJQUUvQjtJQUNBLE1BQU1DLGFBQWEsR0FBRyxJQUFJaEQsSUFBSSxDQUFFLEVBQUUsRUFBRTtNQUNsQ2lELFFBQVEsRUFBRSxLQUFLO01BQUU7TUFDakJSLElBQUksRUFBRXhCLE9BQU8sQ0FBQ2lDLFlBQVk7TUFDMUJaLElBQUksRUFBRXJCLE9BQU8sQ0FBQ0ksU0FBUztNQUN2QjhCLE1BQU0sRUFBRVIsWUFBWSxDQUFDUTtJQUN2QixDQUFFLENBQUM7SUFDSCxJQUFJLENBQUNmLFFBQVEsQ0FBRVksYUFBYyxDQUFDOztJQUU5QjtJQUNBLE1BQU1JLGVBQWUsR0FBRyxJQUFJcEQsSUFBSSxDQUFFLEVBQUUsRUFBRTtNQUNwQ2lELFFBQVEsRUFBRSxLQUFLO01BQUU7TUFDakJSLElBQUksRUFBRXhCLE9BQU8sQ0FBQ2lDLFlBQVk7TUFDMUJaLElBQUksRUFBRXJCLE9BQU8sQ0FBQ0ksU0FBUztNQUN2QjhCLE1BQU0sRUFBRUosY0FBYyxDQUFDSTtJQUN6QixDQUFFLENBQUM7SUFDSCxJQUFJLENBQUNmLFFBQVEsQ0FBRWdCLGVBQWdCLENBQUM7O0lBRWhDO0lBQ0EsTUFBTUMsbUJBQW1CLEdBQUcsSUFBSW5ELHFCQUFxQixDQUFFO01BQ3JEb0QsT0FBTyxFQUFFLElBQUl4RCxJQUFJLENBQUVHLGdCQUFnQixFQUFFO1FBQ25Dc0QsS0FBSyxFQUFFbEQsV0FBVyxDQUFDbUQsZUFBZTtRQUNsQ2YsSUFBSSxFQUFFO01BQ1IsQ0FBRSxDQUFDO01BQ0hnQixTQUFTLEVBQUVyRCxRQUFRLENBQUNzRCxVQUFVO01BQzlCZCxPQUFPLEVBQUVWLFlBQVksQ0FBQ1UsT0FBTztNQUM3QkMsTUFBTSxFQUFFRixZQUFZLENBQUNHLEdBQUcsR0FBRzdCLE9BQU8sQ0FBQ1U7SUFDckMsQ0FBRSxDQUFDO0lBQ0gsSUFBSSxDQUFDUyxRQUFRLENBQUVpQixtQkFBb0IsQ0FBQztJQUNwQ0EsbUJBQW1CLENBQUNNLFNBQVMsR0FBR04sbUJBQW1CLENBQUNPLFdBQVcsQ0FBQ0MsU0FBUyxDQUFFLEVBQUUsRUFBRSxDQUFFLENBQUM7O0lBRWxGO0lBQ0EsTUFBTUMscUJBQXFCLEdBQUcsSUFBSTVELHFCQUFxQixDQUFFO01BQ3ZEb0QsT0FBTyxFQUFFLElBQUl4RCxJQUFJLENBQUVHLGdCQUFnQixFQUFFO1FBQ25Dc0QsS0FBSyxFQUFFbEQsV0FBVyxDQUFDbUQsZUFBZTtRQUNsQ2YsSUFBSSxFQUFFO01BQ1IsQ0FBRSxDQUFDO01BQ0hnQixTQUFTLEVBQUVyRCxRQUFRLENBQUNzRCxVQUFVO01BQzlCZCxPQUFPLEVBQUVWLFlBQVksQ0FBQ1UsT0FBTztNQUM3QkUsR0FBRyxFQUFFQyxjQUFjLENBQUNGLE1BQU0sR0FBRzVCLE9BQU8sQ0FBQ1U7SUFDdkMsQ0FBRSxDQUFDO0lBQ0gsSUFBSSxDQUFDUyxRQUFRLENBQUUwQixxQkFBc0IsQ0FBQztJQUN0Q0EscUJBQXFCLENBQUNILFNBQVMsR0FBR0cscUJBQXFCLENBQUNGLFdBQVcsQ0FBQ0MsU0FBUyxDQUFFLEVBQUUsRUFBRSxDQUFFLENBQUM7SUFFdEYsSUFBSSxDQUFDRSxNQUFNLENBQUU5QyxPQUFRLENBQUM7O0lBRXRCO0lBQ0EsTUFBTStDLGlCQUFpQixHQUFHQyxNQUFNLElBQUk7TUFFbEM7TUFDQTtNQUNBbEMsTUFBTSxJQUFJQSxNQUFNLENBQUVzQixtQkFBbUIsQ0FBQ1QsT0FBTyxLQUFLa0IscUJBQXFCLENBQUNsQixPQUFRLENBQUM7O01BRWpGO01BQ0EsTUFBTXNCLDJCQUEyQixHQUMvQkQsTUFBTSxDQUFDRSxvQkFBb0IsQ0FBRXBELHFCQUFxQixDQUFDcUQsbUJBQW1CLENBQUVyRCxxQkFBcUIsQ0FBQzZDLFdBQVksQ0FBRSxDQUFDO01BQy9HLE1BQU1TLGdCQUFnQixHQUNwQkosTUFBTSxDQUFDRSxvQkFBb0IsQ0FBRWQsbUJBQW1CLENBQUNlLG1CQUFtQixDQUFFZixtQkFBbUIsQ0FBQ08sV0FBWSxDQUFFLENBQUM7O01BRTNHO01BQ0E7TUFDQUssTUFBTSxDQUFDckIsT0FBTyxHQUFHeUIsZ0JBQWdCLENBQUN6QixPQUFPO01BQ3pDLElBQUtxQixNQUFNLENBQUNLLElBQUksR0FBR0osMkJBQTJCLENBQUNJLElBQUksRUFBRztRQUNwREwsTUFBTSxDQUFDSyxJQUFJLEdBQUdKLDJCQUEyQixDQUFDSSxJQUFJO01BQ2hELENBQUMsTUFDSSxJQUFLTCxNQUFNLENBQUNNLEtBQUssR0FBR0wsMkJBQTJCLENBQUNLLEtBQUssRUFBRztRQUMzRE4sTUFBTSxDQUFDTSxLQUFLLEdBQUdMLDJCQUEyQixDQUFDSyxLQUFLO01BQ2xEOztNQUVBO01BQ0EsSUFBS3RELE9BQU8sQ0FBQ1csY0FBYyxLQUFLLE9BQU8sRUFBRztRQUN4Q3FDLE1BQU0sQ0FBQ3BCLE1BQU0sR0FBR3FCLDJCQUEyQixDQUFDcEIsR0FBRyxHQUFHLEVBQUU7TUFDdEQsQ0FBQyxNQUNJO1FBQUU7UUFDTG1CLE1BQU0sQ0FBQ25CLEdBQUcsR0FBR29CLDJCQUEyQixDQUFDckIsTUFBTSxHQUFHLEVBQUU7TUFDdEQ7SUFDRixDQUFDOztJQUVEO0lBQ0EsTUFBTTJCLGFBQWEsR0FBR0EsQ0FBQSxLQUFNO01BQzFCeEQsV0FBVyxDQUFDeUQsU0FBUyxDQUFFM0QsWUFBWSxDQUFDNEQsaUJBQWlCLEVBQUU7UUFDckRDLFdBQVcsRUFBRUEsQ0FBQSxLQUFNO1VBQUVoQyxZQUFZLENBQUNGLElBQUksR0FBR3JDLFFBQVEsQ0FBQ3dFLElBQUk7UUFBRSxDQUFDO1FBQ3pEQyxTQUFTLEVBQUVBLENBQUEsS0FBTTtVQUFFbEMsWUFBWSxDQUFDRixJQUFJLEdBQUcsT0FBTztRQUFFLENBQUM7UUFDakR1QixpQkFBaUIsRUFBRUEsaUJBQWlCO1FBQ3BDdkQsU0FBUyxFQUFFb0IsZ0JBQWdCLENBQUNwQixTQUFTO1FBQ3JDQyxXQUFXLEVBQUVtQixnQkFBZ0IsQ0FBQ25CLFdBQVc7UUFDekNhLFdBQVcsRUFBRU4sT0FBTyxDQUFDTTtNQUN2QixDQUFFLENBQUM7SUFDTCxDQUFDOztJQUVEO0lBQ0EsTUFBTXVELGVBQWUsR0FBR0EsQ0FBQSxLQUFNO01BQzVCOUQsV0FBVyxDQUFDeUQsU0FBUyxDQUFFM0QsWUFBWSxDQUFDaUUsbUJBQW1CLEVBQUU7UUFDdkRKLFdBQVcsRUFBRUEsQ0FBQSxLQUFNO1VBQUU1QixjQUFjLENBQUNOLElBQUksR0FBR3JDLFFBQVEsQ0FBQ3dFLElBQUk7UUFBRSxDQUFDO1FBQzNEQyxTQUFTLEVBQUVBLENBQUEsS0FBTTtVQUFFOUIsY0FBYyxDQUFDTixJQUFJLEdBQUcsT0FBTztRQUFFLENBQUM7UUFDbkR1QixpQkFBaUIsRUFBRUEsaUJBQWlCO1FBQ3BDdkQsU0FBUyxFQUFFcUIsa0JBQWtCLENBQUNyQixTQUFTO1FBQ3ZDQyxXQUFXLEVBQUVvQixrQkFBa0IsQ0FBQ3BCLFdBQVc7UUFDM0NhLFdBQVcsRUFBRU4sT0FBTyxDQUFDTTtNQUN2QixDQUFFLENBQUM7SUFDTCxDQUFDOztJQUVEO0lBQ0E4QixtQkFBbUIsQ0FBQzJCLFdBQVcsQ0FBRVIsYUFBYyxDQUFDLENBQUMsQ0FBQztJQUNsRDdCLFlBQVksQ0FBQ3NDLGdCQUFnQixDQUFFLElBQUl0RixZQUFZLENBQUU7TUFBRTtNQUNqRHVGLElBQUksRUFBRVY7SUFDUixDQUFFLENBQUUsQ0FBQztJQUNMVixxQkFBcUIsQ0FBQ2tCLFdBQVcsQ0FBRUYsZUFBZ0IsQ0FBQyxDQUFDLENBQUM7SUFDdEQvQixjQUFjLENBQUNrQyxnQkFBZ0IsQ0FBRSxJQUFJdEYsWUFBWSxDQUFFO01BQUU7TUFDbkR1RixJQUFJLEVBQUVKO0lBQ1IsQ0FBRSxDQUFFLENBQUM7O0lBRUw7SUFDQSxNQUFNSyxpQkFBaUIsR0FBR0MsU0FBUyxJQUFJO01BQ3JDckQsTUFBTSxJQUFJQSxNQUFNLENBQUUsQ0FBQ3NELEtBQUssQ0FBRUQsU0FBVSxDQUFDLEVBQUcsc0JBQXFCQSxTQUFVLEVBQUUsQ0FBQzs7TUFFMUU7TUFDQSxJQUFLQSxTQUFTLEVBQUc7UUFDZnBDLGFBQWEsQ0FBQ3NDLE1BQU0sR0FBR2hGLE9BQU8sQ0FBQ2lGLGNBQWMsQ0FBRUgsU0FBUyxFQUFFdkQsZ0JBQWdCLENBQUNuQixXQUFXLEVBQUVtQixnQkFBZ0IsQ0FBQ2xCLFNBQVUsQ0FBQztNQUN0SCxDQUFDLE1BQ0k7UUFDSHFDLGFBQWEsQ0FBQ3NDLE1BQU0sR0FBRyxFQUFFO01BQzNCO01BQ0F0QyxhQUFhLENBQUNQLElBQUksR0FBR3hCLE9BQU8sQ0FBQ0ssVUFBVTtNQUN2QzBCLGFBQWEsQ0FBQ0csTUFBTSxHQUFHUixZQUFZLENBQUNRLE1BQU07O01BRTFDO01BQ0EsSUFBS3FDLElBQUksQ0FBQ0MsT0FBTyxDQUFDQyxlQUFlLENBQUNDLFdBQVcsSUFBSSxDQUFDN0UsWUFBWSxDQUFDaUUsbUJBQW1CLENBQUNhLEtBQUssRUFBRztRQUN6RixJQUFLUixTQUFTLEVBQUc7VUFDZixNQUFNUyxXQUFXLEdBQUcvRSxZQUFZLENBQUM0RCxpQkFBaUIsQ0FBQ2tCLEtBQUssR0FBRzlFLFlBQVksQ0FBQ2dGLGdCQUFnQixDQUFDRixLQUFLO1VBQzlGeEMsZUFBZSxDQUFDa0MsTUFBTSxHQUFHaEYsT0FBTyxDQUFDaUYsY0FBYyxDQUFFTSxXQUFXLEVBQUUvRCxrQkFBa0IsQ0FBQ3BCLFdBQVcsRUFBRW9CLGtCQUFrQixDQUFDbkIsU0FBVSxDQUFDO1FBQzlILENBQUMsTUFDSTtVQUNIeUMsZUFBZSxDQUFDa0MsTUFBTSxHQUFHLEVBQUU7UUFDN0I7UUFDQWxDLGVBQWUsQ0FBQ1gsSUFBSSxHQUFHckMsUUFBUSxDQUFDdUYsV0FBVztRQUMzQ3ZDLGVBQWUsQ0FBQ0QsTUFBTSxHQUFHSixjQUFjLENBQUNJLE1BQU07TUFDaEQ7SUFDRixDQUFDO0lBQ0RyQyxZQUFZLENBQUM0RCxpQkFBaUIsQ0FBQ3FCLElBQUksQ0FBRVosaUJBQWtCLENBQUMsQ0FBQyxDQUFDOztJQUUxRDtJQUNBLE1BQU1hLG1CQUFtQixHQUFHSCxXQUFXLElBQUk7TUFDekM5RCxNQUFNLElBQUlBLE1BQU0sQ0FBRSxDQUFDc0QsS0FBSyxDQUFFUSxXQUFZLENBQUMsRUFBRyx3QkFBdUJBLFdBQVksRUFBRSxDQUFDOztNQUVoRjtNQUNBLElBQUtBLFdBQVcsRUFBRztRQUNqQnpDLGVBQWUsQ0FBQ2tDLE1BQU0sR0FBR2hGLE9BQU8sQ0FBQ2lGLGNBQWMsQ0FBRU0sV0FBVyxFQUFFL0Qsa0JBQWtCLENBQUNwQixXQUFXLEVBQUVvQixrQkFBa0IsQ0FBQ25CLFNBQVUsQ0FBQztNQUM5SCxDQUFDLE1BQ0k7UUFDSHlDLGVBQWUsQ0FBQ2tDLE1BQU0sR0FBRyxFQUFFO01BQzdCO01BQ0FsQyxlQUFlLENBQUNYLElBQUksR0FBR3hCLE9BQU8sQ0FBQ0ssVUFBVTtNQUN6QzhCLGVBQWUsQ0FBQ0QsTUFBTSxHQUFHSixjQUFjLENBQUNJLE1BQU07O01BRTlDO01BQ0EsSUFBS3FDLElBQUksQ0FBQ0MsT0FBTyxDQUFDQyxlQUFlLENBQUNDLFdBQVcsSUFBSSxDQUFDN0UsWUFBWSxDQUFDNEQsaUJBQWlCLENBQUNrQixLQUFLLEVBQUc7UUFDdkYsSUFBS0MsV0FBVyxFQUFHO1VBQ2pCLE1BQU1ULFNBQVMsR0FBR3RFLFlBQVksQ0FBQ2lFLG1CQUFtQixDQUFDYSxLQUFLLEdBQUc5RSxZQUFZLENBQUNnRixnQkFBZ0IsQ0FBQ0YsS0FBSztVQUM5RjVDLGFBQWEsQ0FBQ3NDLE1BQU0sR0FBR2hGLE9BQU8sQ0FBQ2lGLGNBQWMsQ0FBRUgsU0FBUyxFQUFFdkQsZ0JBQWdCLENBQUNuQixXQUFXLEVBQUVtQixnQkFBZ0IsQ0FBQ2xCLFNBQVUsQ0FBQztRQUN0SCxDQUFDLE1BQ0k7VUFDSHFDLGFBQWEsQ0FBQ3NDLE1BQU0sR0FBRyxFQUFFO1FBQzNCO1FBQ0F0QyxhQUFhLENBQUNQLElBQUksR0FBR3JDLFFBQVEsQ0FBQ3VGLFdBQVc7UUFDekMzQyxhQUFhLENBQUNHLE1BQU0sR0FBR1IsWUFBWSxDQUFDUSxNQUFNO01BQzVDO0lBQ0YsQ0FBQztJQUNEckMsWUFBWSxDQUFDaUUsbUJBQW1CLENBQUNnQixJQUFJLENBQUVDLG1CQUFvQixDQUFDLENBQUMsQ0FBQzs7SUFFOUQ7SUFDQSxJQUFJLENBQUNDLHVCQUF1QixHQUFHLE1BQU07TUFDbkNuRixZQUFZLENBQUM0RCxpQkFBaUIsQ0FBQ3dCLE1BQU0sQ0FBRWYsaUJBQWtCLENBQUM7TUFDMURyRSxZQUFZLENBQUNpRSxtQkFBbUIsQ0FBQ21CLE1BQU0sQ0FBRUYsbUJBQW9CLENBQUM7TUFDOUQzQyxtQkFBbUIsQ0FBQzhDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztNQUMvQnJDLHFCQUFxQixDQUFDcUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ25DLENBQUM7O0lBRUQ7SUFDQSxJQUFJLENBQUNuRCxhQUFhLEdBQUdBLGFBQWE7SUFDbEMsSUFBSSxDQUFDSSxlQUFlLEdBQUdBLGVBQWU7RUFDeEM7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7RUFDRStDLE9BQU9BLENBQUEsRUFBRztJQUNSLElBQUksQ0FBQ0YsdUJBQXVCLENBQUMsQ0FBQztJQUM5QixLQUFLLENBQUNFLE9BQU8sQ0FBQyxDQUFDO0VBQ2pCO0FBQ0Y7QUFFQWhHLFNBQVMsQ0FBQ2lHLFFBQVEsQ0FBRSxrQkFBa0IsRUFBRXhGLGdCQUFpQixDQUFDIn0=