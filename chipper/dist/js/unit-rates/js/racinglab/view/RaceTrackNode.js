// Copyright 2017-2023, University of Colorado Boulder

/**
 * Displays a complete race track in the 'Racing Lab' screen, including:
 * - track
 * - start and finish flags
 * - race car
 * - timer
 *
 * The starting line flag is at x = 0.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import LinearFunction from '../../../../dot/js/LinearFunction.js';
import Utils from '../../../../dot/js/Utils.js';
import { Shape } from '../../../../kite/js/imports.js';
import merge from '../../../../phet-core/js/merge.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import ArrowNode from '../../../../scenery-phet/js/ArrowNode.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { DragListener, HBox, Image, Line, Node, Path, Text } from '../../../../scenery/js/imports.js';
import finishFlag_png from '../../../images/finishFlag_png.js';
import startFlag_png from '../../../images/startFlag_png.js';
import unitRates from '../../unitRates.js';
import UnitRatesStrings from '../../UnitRatesStrings.js';
import RaceTimerNode from './RaceTimerNode.js';

// constants
const NEGATIVE_TRACK_LENGTH = 65; // length of track to left of starting flag, in view coordinates
const CUE_ARROW_LENGTH = 28; // length of the 'drag cue' arrows around the finish flag
const CUE_ARROW_OPTIONS = {
  fill: 'rgb( 33, 190, 156 )',
  lineWidth: 0.5,
  headWidth: 20,
  headHeight: 16,
  tailWidth: 7
};
const TRACK_MARKER_SIDE_LENGTH = 5;
const TRACK_MARKER_OPTIONS = {
  fill: 'black',
  stroke: null
};
export default class RaceTrackNode extends Node {
  /**
   * @param {RaceCar} car
   * @param {Property.<boolean>} timerExpandedProperty
   * @param {Property.<boolean>} arrowsVisibleProperty - are the 'drag cue' arrows are visible?
   * @param {Object} [options]
   */
  constructor(car, timerExpandedProperty, arrowsVisibleProperty, options) {
    options = merge({
      trackViewLength: 1000,
      // {number} view length of the track
      timerTitleString: '' // {string} title for the timer accordion box
    }, options);

    // maps 'miles' between model and view coordinate frames
    const modelToView = new LinearFunction(0, car.track.maxLength, 0, options.trackViewLength);

    // Dashed line shows the maximum track length, revealed when the track is shortened.
    const dashedLineNode = new Line(0, 0, options.trackViewLength, 0, {
      stroke: 'gray',
      lineWidth: 0.5,
      lineDash: [5, 5]
    });

    // Solid line shows the actual track length.
    const solidLineNode = new Line(-NEGATIVE_TRACK_LENGTH, 0, options.trackViewLength, 0, {
      stroke: 'black',
      lineWidth: 1
    });

    // markers below the track
    const markerNodes = [];
    for (let x = 0; x <= car.track.maxLength;) {
      // create marker
      const markerNode = createMarkerNode();
      markerNodes.push(markerNode);

      // position marker
      markerNode.centerX = modelToView.evaluate(x);
      markerNode.top = solidLineNode.bottom;

      // next marker
      x = x + car.track.markerSpacing;
    }
    const markersParent = new Node({
      children: markerNodes
    });
    markersParent.top = solidLineNode.centerY;

    // Flag at starting line
    const startFlagNode = new Image(startFlag_png, {
      scale: 0.5,
      left: 0,
      bottom: 0
    });

    // Flag at finish line
    const finishFlagNode = new Image(finishFlag_png, {
      cursor: 'pointer',
      scale: 0.5,
      left: modelToView.evaluate(car.track.lengthProperty.value),
      bottom: 0
    });
    finishFlagNode.touchArea = finishFlagNode.localBounds.dilatedX(30);
    finishFlagNode.mouseArea = finishFlagNode.localBounds.dilatedX(30);

    // green arrows around the finish flag, cues the user to drag the flag
    const cueArrowsNode = new HBox({
      cursor: 'pointer',
      spacing: 9,
      children: [new ArrowNode(0, 0, -CUE_ARROW_LENGTH, 0, CUE_ARROW_OPTIONS), new ArrowNode(0, 0, CUE_ARROW_LENGTH, 0, CUE_ARROW_OPTIONS)],
      centerX: finishFlagNode.left,
      bottom: finishFlagNode.bottom - 2
    });

    // Timer, dispose required
    const timerNode = new RaceTimerNode(car.timeProperty, timerExpandedProperty, options.timerTitleString);

    // Label that indicates the length of the track
    const lengthNode = new Text('', {
      font: new PhetFont(12),
      maxWidth: timerNode.width // i18n
    });

    // Car
    const carNode = new Image(car.image, {
      scale: 0.5,
      right: startFlagNode.left,
      bottom: solidLineNode.top
    });
    assert && assert(!options.children, 'decoration not supported');
    options.children = [dashedLineNode, solidLineNode, markersParent, startFlagNode, finishFlagNode, timerNode, lengthNode, cueArrowsNode, carNode];

    // Synchronize track length with the model
    const lengthObserver = length => {
      const finishX = modelToView.evaluate(length);

      // adjust track length
      solidLineNode.setLine(-NEGATIVE_TRACK_LENGTH, 0, finishX, 0);

      // flag at finish line
      finishFlagNode.left = finishX;
      finishFlagNode.bottom = solidLineNode.centerY;

      // timer above finish flag
      timerNode.centerX = finishX;
      timerNode.bottom = finishFlagNode.top - 3;

      // distance label below finish flag
      lengthNode.string = StringUtils.format(UnitRatesStrings.pattern_0value_1units, length, UnitRatesStrings.miles);
      lengthNode.top = solidLineNode.bottom + TRACK_MARKER_SIDE_LENGTH + 4;
      lengthNode.centerX = finishX;

      // grey out markers that are past finish line
      for (let i = 0; i < markerNodes.length; i++) {
        const enabled = i * car.track.markerSpacing <= length;
        markerNodes[i].opacity = enabled ? 1 : 0.4;
      }
    };
    car.track.lengthProperty.link(lengthObserver); // unlink in dispose

    super(options);

    // {number} where the drag started relative to the finish flag's current position, in parent view coordinates
    let startDragXOffset;

    // Drag the finish flag to change the track length
    const dragListener = new DragListener({
      // allow touch swipes across a bag to pick it up
      allowTouchSnag: true,
      /**
       * Called when a drag sequence starts.
       * @param {SceneryEvent} event
       */
      start: event => {
        // compute offset from current track length
        startDragXOffset = finishFlagNode.globalToParentPoint(event.pointer.point).x - modelToView.evaluate(car.track.lengthProperty.value);
      },
      /**
       * Called when the pointer moves during a drag sequence.
       * @param {SceneryEvent} event
       */
      drag: event => {
        // hide the 'drag cue' arrows
        arrowsVisibleProperty.value = false;

        // compute track length in view coordinates
        const viewLength = finishFlagNode.globalToParentPoint(event.pointer.point).x - startDragXOffset;

        // convert to model coordinates, constrain to the track length range
        const modelLength = Utils.clamp(modelToView.inverse(viewLength), 0, car.track.maxLength);

        // update the model, constrain to integer values
        car.track.lengthProperty.value = Utils.toFixedNumber(modelLength, 0);
      }
    });
    finishFlagNode.addInputListener(dragListener);
    cueArrowsNode.addInputListener(dragListener);

    // Synchronize car position with model
    // unlink not needed, exists for sim lifetime
    car.distanceProperty.link(distance => {
      carNode.right = modelToView.evaluate(distance);
    });

    // unlink not needed, exists for sim lifetime
    arrowsVisibleProperty.link(visible => {
      cueArrowsNode.visible = visible;
    });
  }
}

/**
 * Creates a track marker, an equilateral triangle, with origin at tip.
 * @returns {Node}
 */
function createMarkerNode() {
  const markerShape = new Shape().moveTo(0, 0).lineTo(TRACK_MARKER_SIDE_LENGTH / 2, TRACK_MARKER_SIDE_LENGTH).lineTo(-TRACK_MARKER_SIDE_LENGTH / 2, TRACK_MARKER_SIDE_LENGTH).close();
  return new Path(markerShape, TRACK_MARKER_OPTIONS);
}
unitRates.register('RaceTrackNode', RaceTrackNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJMaW5lYXJGdW5jdGlvbiIsIlV0aWxzIiwiU2hhcGUiLCJtZXJnZSIsIlN0cmluZ1V0aWxzIiwiQXJyb3dOb2RlIiwiUGhldEZvbnQiLCJEcmFnTGlzdGVuZXIiLCJIQm94IiwiSW1hZ2UiLCJMaW5lIiwiTm9kZSIsIlBhdGgiLCJUZXh0IiwiZmluaXNoRmxhZ19wbmciLCJzdGFydEZsYWdfcG5nIiwidW5pdFJhdGVzIiwiVW5pdFJhdGVzU3RyaW5ncyIsIlJhY2VUaW1lck5vZGUiLCJORUdBVElWRV9UUkFDS19MRU5HVEgiLCJDVUVfQVJST1dfTEVOR1RIIiwiQ1VFX0FSUk9XX09QVElPTlMiLCJmaWxsIiwibGluZVdpZHRoIiwiaGVhZFdpZHRoIiwiaGVhZEhlaWdodCIsInRhaWxXaWR0aCIsIlRSQUNLX01BUktFUl9TSURFX0xFTkdUSCIsIlRSQUNLX01BUktFUl9PUFRJT05TIiwic3Ryb2tlIiwiUmFjZVRyYWNrTm9kZSIsImNvbnN0cnVjdG9yIiwiY2FyIiwidGltZXJFeHBhbmRlZFByb3BlcnR5IiwiYXJyb3dzVmlzaWJsZVByb3BlcnR5Iiwib3B0aW9ucyIsInRyYWNrVmlld0xlbmd0aCIsInRpbWVyVGl0bGVTdHJpbmciLCJtb2RlbFRvVmlldyIsInRyYWNrIiwibWF4TGVuZ3RoIiwiZGFzaGVkTGluZU5vZGUiLCJsaW5lRGFzaCIsInNvbGlkTGluZU5vZGUiLCJtYXJrZXJOb2RlcyIsIngiLCJtYXJrZXJOb2RlIiwiY3JlYXRlTWFya2VyTm9kZSIsInB1c2giLCJjZW50ZXJYIiwiZXZhbHVhdGUiLCJ0b3AiLCJib3R0b20iLCJtYXJrZXJTcGFjaW5nIiwibWFya2Vyc1BhcmVudCIsImNoaWxkcmVuIiwiY2VudGVyWSIsInN0YXJ0RmxhZ05vZGUiLCJzY2FsZSIsImxlZnQiLCJmaW5pc2hGbGFnTm9kZSIsImN1cnNvciIsImxlbmd0aFByb3BlcnR5IiwidmFsdWUiLCJ0b3VjaEFyZWEiLCJsb2NhbEJvdW5kcyIsImRpbGF0ZWRYIiwibW91c2VBcmVhIiwiY3VlQXJyb3dzTm9kZSIsInNwYWNpbmciLCJ0aW1lck5vZGUiLCJ0aW1lUHJvcGVydHkiLCJsZW5ndGhOb2RlIiwiZm9udCIsIm1heFdpZHRoIiwid2lkdGgiLCJjYXJOb2RlIiwiaW1hZ2UiLCJyaWdodCIsImFzc2VydCIsImxlbmd0aE9ic2VydmVyIiwibGVuZ3RoIiwiZmluaXNoWCIsInNldExpbmUiLCJzdHJpbmciLCJmb3JtYXQiLCJwYXR0ZXJuXzB2YWx1ZV8xdW5pdHMiLCJtaWxlcyIsImkiLCJlbmFibGVkIiwib3BhY2l0eSIsImxpbmsiLCJzdGFydERyYWdYT2Zmc2V0IiwiZHJhZ0xpc3RlbmVyIiwiYWxsb3dUb3VjaFNuYWciLCJzdGFydCIsImV2ZW50IiwiZ2xvYmFsVG9QYXJlbnRQb2ludCIsInBvaW50ZXIiLCJwb2ludCIsImRyYWciLCJ2aWV3TGVuZ3RoIiwibW9kZWxMZW5ndGgiLCJjbGFtcCIsImludmVyc2UiLCJ0b0ZpeGVkTnVtYmVyIiwiYWRkSW5wdXRMaXN0ZW5lciIsImRpc3RhbmNlUHJvcGVydHkiLCJkaXN0YW5jZSIsInZpc2libGUiLCJtYXJrZXJTaGFwZSIsIm1vdmVUbyIsImxpbmVUbyIsImNsb3NlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJSYWNlVHJhY2tOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIERpc3BsYXlzIGEgY29tcGxldGUgcmFjZSB0cmFjayBpbiB0aGUgJ1JhY2luZyBMYWInIHNjcmVlbiwgaW5jbHVkaW5nOlxyXG4gKiAtIHRyYWNrXHJcbiAqIC0gc3RhcnQgYW5kIGZpbmlzaCBmbGFnc1xyXG4gKiAtIHJhY2UgY2FyXHJcbiAqIC0gdGltZXJcclxuICpcclxuICogVGhlIHN0YXJ0aW5nIGxpbmUgZmxhZyBpcyBhdCB4ID0gMC5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgTGluZWFyRnVuY3Rpb24gZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0xpbmVhckZ1bmN0aW9uLmpzJztcclxuaW1wb3J0IFV0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9VdGlscy5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IG1lcmdlIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9tZXJnZS5qcyc7XHJcbmltcG9ydCBTdHJpbmdVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3V0aWwvU3RyaW5nVXRpbHMuanMnO1xyXG5pbXBvcnQgQXJyb3dOb2RlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9BcnJvd05vZGUuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgRHJhZ0xpc3RlbmVyLCBIQm94LCBJbWFnZSwgTGluZSwgTm9kZSwgUGF0aCwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBmaW5pc2hGbGFnX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvZmluaXNoRmxhZ19wbmcuanMnO1xyXG5pbXBvcnQgc3RhcnRGbGFnX3BuZyBmcm9tICcuLi8uLi8uLi9pbWFnZXMvc3RhcnRGbGFnX3BuZy5qcyc7XHJcbmltcG9ydCB1bml0UmF0ZXMgZnJvbSAnLi4vLi4vdW5pdFJhdGVzLmpzJztcclxuaW1wb3J0IFVuaXRSYXRlc1N0cmluZ3MgZnJvbSAnLi4vLi4vVW5pdFJhdGVzU3RyaW5ncy5qcyc7XHJcbmltcG9ydCBSYWNlVGltZXJOb2RlIGZyb20gJy4vUmFjZVRpbWVyTm9kZS5qcyc7XHJcblxyXG4vLyBjb25zdGFudHNcclxuY29uc3QgTkVHQVRJVkVfVFJBQ0tfTEVOR1RIID0gNjU7IC8vIGxlbmd0aCBvZiB0cmFjayB0byBsZWZ0IG9mIHN0YXJ0aW5nIGZsYWcsIGluIHZpZXcgY29vcmRpbmF0ZXNcclxuY29uc3QgQ1VFX0FSUk9XX0xFTkdUSCA9IDI4OyAvLyBsZW5ndGggb2YgdGhlICdkcmFnIGN1ZScgYXJyb3dzIGFyb3VuZCB0aGUgZmluaXNoIGZsYWdcclxuY29uc3QgQ1VFX0FSUk9XX09QVElPTlMgPSB7XHJcbiAgZmlsbDogJ3JnYiggMzMsIDE5MCwgMTU2ICknLFxyXG4gIGxpbmVXaWR0aDogMC41LFxyXG4gIGhlYWRXaWR0aDogMjAsXHJcbiAgaGVhZEhlaWdodDogMTYsXHJcbiAgdGFpbFdpZHRoOiA3XHJcbn07XHJcbmNvbnN0IFRSQUNLX01BUktFUl9TSURFX0xFTkdUSCA9IDU7XHJcbmNvbnN0IFRSQUNLX01BUktFUl9PUFRJT05TID0ge1xyXG4gIGZpbGw6ICdibGFjaycsXHJcbiAgc3Ryb2tlOiBudWxsXHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSYWNlVHJhY2tOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7UmFjZUNhcn0gY2FyXHJcbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IHRpbWVyRXhwYW5kZWRQcm9wZXJ0eVxyXG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPGJvb2xlYW4+fSBhcnJvd3NWaXNpYmxlUHJvcGVydHkgLSBhcmUgdGhlICdkcmFnIGN1ZScgYXJyb3dzIGFyZSB2aXNpYmxlP1xyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggY2FyLCB0aW1lckV4cGFuZGVkUHJvcGVydHksIGFycm93c1Zpc2libGVQcm9wZXJ0eSwgb3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuICAgICAgdHJhY2tWaWV3TGVuZ3RoOiAxMDAwLCAvLyB7bnVtYmVyfSB2aWV3IGxlbmd0aCBvZiB0aGUgdHJhY2tcclxuICAgICAgdGltZXJUaXRsZVN0cmluZzogJycgLy8ge3N0cmluZ30gdGl0bGUgZm9yIHRoZSB0aW1lciBhY2NvcmRpb24gYm94XHJcbiAgICB9LCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gbWFwcyAnbWlsZXMnIGJldHdlZW4gbW9kZWwgYW5kIHZpZXcgY29vcmRpbmF0ZSBmcmFtZXNcclxuICAgIGNvbnN0IG1vZGVsVG9WaWV3ID0gbmV3IExpbmVhckZ1bmN0aW9uKCAwLCBjYXIudHJhY2subWF4TGVuZ3RoLCAwLCBvcHRpb25zLnRyYWNrVmlld0xlbmd0aCApO1xyXG5cclxuICAgIC8vIERhc2hlZCBsaW5lIHNob3dzIHRoZSBtYXhpbXVtIHRyYWNrIGxlbmd0aCwgcmV2ZWFsZWQgd2hlbiB0aGUgdHJhY2sgaXMgc2hvcnRlbmVkLlxyXG4gICAgY29uc3QgZGFzaGVkTGluZU5vZGUgPSBuZXcgTGluZSggMCwgMCwgb3B0aW9ucy50cmFja1ZpZXdMZW5ndGgsIDAsIHtcclxuICAgICAgc3Ryb2tlOiAnZ3JheScsXHJcbiAgICAgIGxpbmVXaWR0aDogMC41LFxyXG4gICAgICBsaW5lRGFzaDogWyA1LCA1IF1cclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBTb2xpZCBsaW5lIHNob3dzIHRoZSBhY3R1YWwgdHJhY2sgbGVuZ3RoLlxyXG4gICAgY29uc3Qgc29saWRMaW5lTm9kZSA9IG5ldyBMaW5lKCAtTkVHQVRJVkVfVFJBQ0tfTEVOR1RILCAwLCBvcHRpb25zLnRyYWNrVmlld0xlbmd0aCwgMCwge1xyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGxpbmVXaWR0aDogMVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIG1hcmtlcnMgYmVsb3cgdGhlIHRyYWNrXHJcbiAgICBjb25zdCBtYXJrZXJOb2RlcyA9IFtdO1xyXG4gICAgZm9yICggbGV0IHggPSAwOyB4IDw9IGNhci50cmFjay5tYXhMZW5ndGg7ICkge1xyXG5cclxuICAgICAgLy8gY3JlYXRlIG1hcmtlclxyXG4gICAgICBjb25zdCBtYXJrZXJOb2RlID0gY3JlYXRlTWFya2VyTm9kZSgpO1xyXG4gICAgICBtYXJrZXJOb2Rlcy5wdXNoKCBtYXJrZXJOb2RlICk7XHJcblxyXG4gICAgICAvLyBwb3NpdGlvbiBtYXJrZXJcclxuICAgICAgbWFya2VyTm9kZS5jZW50ZXJYID0gbW9kZWxUb1ZpZXcuZXZhbHVhdGUoIHggKTtcclxuICAgICAgbWFya2VyTm9kZS50b3AgPSBzb2xpZExpbmVOb2RlLmJvdHRvbTtcclxuXHJcbiAgICAgIC8vIG5leHQgbWFya2VyXHJcbiAgICAgIHggPSB4ICsgY2FyLnRyYWNrLm1hcmtlclNwYWNpbmc7XHJcbiAgICB9XHJcbiAgICBjb25zdCBtYXJrZXJzUGFyZW50ID0gbmV3IE5vZGUoIHsgY2hpbGRyZW46IG1hcmtlck5vZGVzIH0gKTtcclxuICAgIG1hcmtlcnNQYXJlbnQudG9wID0gc29saWRMaW5lTm9kZS5jZW50ZXJZO1xyXG5cclxuICAgIC8vIEZsYWcgYXQgc3RhcnRpbmcgbGluZVxyXG4gICAgY29uc3Qgc3RhcnRGbGFnTm9kZSA9IG5ldyBJbWFnZSggc3RhcnRGbGFnX3BuZywge1xyXG4gICAgICBzY2FsZTogMC41LFxyXG4gICAgICBsZWZ0OiAwLFxyXG4gICAgICBib3R0b206IDBcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBGbGFnIGF0IGZpbmlzaCBsaW5lXHJcbiAgICBjb25zdCBmaW5pc2hGbGFnTm9kZSA9IG5ldyBJbWFnZSggZmluaXNoRmxhZ19wbmcsIHtcclxuICAgICAgY3Vyc29yOiAncG9pbnRlcicsXHJcbiAgICAgIHNjYWxlOiAwLjUsXHJcbiAgICAgIGxlZnQ6IG1vZGVsVG9WaWV3LmV2YWx1YXRlKCBjYXIudHJhY2subGVuZ3RoUHJvcGVydHkudmFsdWUgKSxcclxuICAgICAgYm90dG9tOiAwXHJcbiAgICB9ICk7XHJcbiAgICBmaW5pc2hGbGFnTm9kZS50b3VjaEFyZWEgPSBmaW5pc2hGbGFnTm9kZS5sb2NhbEJvdW5kcy5kaWxhdGVkWCggMzAgKTtcclxuICAgIGZpbmlzaEZsYWdOb2RlLm1vdXNlQXJlYSA9IGZpbmlzaEZsYWdOb2RlLmxvY2FsQm91bmRzLmRpbGF0ZWRYKCAzMCApO1xyXG5cclxuICAgIC8vIGdyZWVuIGFycm93cyBhcm91bmQgdGhlIGZpbmlzaCBmbGFnLCBjdWVzIHRoZSB1c2VyIHRvIGRyYWcgdGhlIGZsYWdcclxuICAgIGNvbnN0IGN1ZUFycm93c05vZGUgPSBuZXcgSEJveCgge1xyXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcclxuICAgICAgc3BhY2luZzogOSxcclxuICAgICAgY2hpbGRyZW46IFtcclxuICAgICAgICBuZXcgQXJyb3dOb2RlKCAwLCAwLCAtQ1VFX0FSUk9XX0xFTkdUSCwgMCwgQ1VFX0FSUk9XX09QVElPTlMgKSxcclxuICAgICAgICBuZXcgQXJyb3dOb2RlKCAwLCAwLCBDVUVfQVJST1dfTEVOR1RILCAwLCBDVUVfQVJST1dfT1BUSU9OUyApXHJcbiAgICAgIF0sXHJcbiAgICAgIGNlbnRlclg6IGZpbmlzaEZsYWdOb2RlLmxlZnQsXHJcbiAgICAgIGJvdHRvbTogZmluaXNoRmxhZ05vZGUuYm90dG9tIC0gMlxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFRpbWVyLCBkaXNwb3NlIHJlcXVpcmVkXHJcbiAgICBjb25zdCB0aW1lck5vZGUgPSBuZXcgUmFjZVRpbWVyTm9kZSggY2FyLnRpbWVQcm9wZXJ0eSwgdGltZXJFeHBhbmRlZFByb3BlcnR5LCBvcHRpb25zLnRpbWVyVGl0bGVTdHJpbmcgKTtcclxuXHJcbiAgICAvLyBMYWJlbCB0aGF0IGluZGljYXRlcyB0aGUgbGVuZ3RoIG9mIHRoZSB0cmFja1xyXG4gICAgY29uc3QgbGVuZ3RoTm9kZSA9IG5ldyBUZXh0KCAnJywge1xyXG4gICAgICBmb250OiBuZXcgUGhldEZvbnQoIDEyICksXHJcbiAgICAgIG1heFdpZHRoOiB0aW1lck5vZGUud2lkdGggLy8gaTE4blxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIENhclxyXG4gICAgY29uc3QgY2FyTm9kZSA9IG5ldyBJbWFnZSggY2FyLmltYWdlLCB7XHJcbiAgICAgIHNjYWxlOiAwLjUsXHJcbiAgICAgIHJpZ2h0OiBzdGFydEZsYWdOb2RlLmxlZnQsXHJcbiAgICAgIGJvdHRvbTogc29saWRMaW5lTm9kZS50b3BcclxuICAgIH0gKTtcclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhb3B0aW9ucy5jaGlsZHJlbiwgJ2RlY29yYXRpb24gbm90IHN1cHBvcnRlZCcgKTtcclxuICAgIG9wdGlvbnMuY2hpbGRyZW4gPSBbIGRhc2hlZExpbmVOb2RlLCBzb2xpZExpbmVOb2RlLCBtYXJrZXJzUGFyZW50LFxyXG4gICAgICBzdGFydEZsYWdOb2RlLCBmaW5pc2hGbGFnTm9kZSwgdGltZXJOb2RlLCBsZW5ndGhOb2RlLCBjdWVBcnJvd3NOb2RlLCBjYXJOb2RlIF07XHJcblxyXG4gICAgLy8gU3luY2hyb25pemUgdHJhY2sgbGVuZ3RoIHdpdGggdGhlIG1vZGVsXHJcbiAgICBjb25zdCBsZW5ndGhPYnNlcnZlciA9IGxlbmd0aCA9PiB7XHJcblxyXG4gICAgICBjb25zdCBmaW5pc2hYID0gbW9kZWxUb1ZpZXcuZXZhbHVhdGUoIGxlbmd0aCApO1xyXG5cclxuICAgICAgLy8gYWRqdXN0IHRyYWNrIGxlbmd0aFxyXG4gICAgICBzb2xpZExpbmVOb2RlLnNldExpbmUoIC1ORUdBVElWRV9UUkFDS19MRU5HVEgsIDAsIGZpbmlzaFgsIDAgKTtcclxuXHJcbiAgICAgIC8vIGZsYWcgYXQgZmluaXNoIGxpbmVcclxuICAgICAgZmluaXNoRmxhZ05vZGUubGVmdCA9IGZpbmlzaFg7XHJcbiAgICAgIGZpbmlzaEZsYWdOb2RlLmJvdHRvbSA9IHNvbGlkTGluZU5vZGUuY2VudGVyWTtcclxuXHJcbiAgICAgIC8vIHRpbWVyIGFib3ZlIGZpbmlzaCBmbGFnXHJcbiAgICAgIHRpbWVyTm9kZS5jZW50ZXJYID0gZmluaXNoWDtcclxuICAgICAgdGltZXJOb2RlLmJvdHRvbSA9IGZpbmlzaEZsYWdOb2RlLnRvcCAtIDM7XHJcblxyXG4gICAgICAvLyBkaXN0YW5jZSBsYWJlbCBiZWxvdyBmaW5pc2ggZmxhZ1xyXG4gICAgICBsZW5ndGhOb2RlLnN0cmluZyA9IFN0cmluZ1V0aWxzLmZvcm1hdCggVW5pdFJhdGVzU3RyaW5ncy5wYXR0ZXJuXzB2YWx1ZV8xdW5pdHMsIGxlbmd0aCwgVW5pdFJhdGVzU3RyaW5ncy5taWxlcyApO1xyXG4gICAgICBsZW5ndGhOb2RlLnRvcCA9IHNvbGlkTGluZU5vZGUuYm90dG9tICsgVFJBQ0tfTUFSS0VSX1NJREVfTEVOR1RIICsgNDtcclxuICAgICAgbGVuZ3RoTm9kZS5jZW50ZXJYID0gZmluaXNoWDtcclxuXHJcbiAgICAgIC8vIGdyZXkgb3V0IG1hcmtlcnMgdGhhdCBhcmUgcGFzdCBmaW5pc2ggbGluZVxyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXJrZXJOb2Rlcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICBjb25zdCBlbmFibGVkID0gKCBpICogY2FyLnRyYWNrLm1hcmtlclNwYWNpbmcgPD0gbGVuZ3RoICk7XHJcbiAgICAgICAgbWFya2VyTm9kZXNbIGkgXS5vcGFjaXR5ID0gKCBlbmFibGVkID8gMSA6IDAuNCApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgY2FyLnRyYWNrLmxlbmd0aFByb3BlcnR5LmxpbmsoIGxlbmd0aE9ic2VydmVyICk7IC8vIHVubGluayBpbiBkaXNwb3NlXHJcblxyXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyB7bnVtYmVyfSB3aGVyZSB0aGUgZHJhZyBzdGFydGVkIHJlbGF0aXZlIHRvIHRoZSBmaW5pc2ggZmxhZydzIGN1cnJlbnQgcG9zaXRpb24sIGluIHBhcmVudCB2aWV3IGNvb3JkaW5hdGVzXHJcbiAgICBsZXQgc3RhcnREcmFnWE9mZnNldDtcclxuXHJcbiAgICAvLyBEcmFnIHRoZSBmaW5pc2ggZmxhZyB0byBjaGFuZ2UgdGhlIHRyYWNrIGxlbmd0aFxyXG4gICAgY29uc3QgZHJhZ0xpc3RlbmVyID0gbmV3IERyYWdMaXN0ZW5lcigge1xyXG5cclxuICAgICAgLy8gYWxsb3cgdG91Y2ggc3dpcGVzIGFjcm9zcyBhIGJhZyB0byBwaWNrIGl0IHVwXHJcbiAgICAgIGFsbG93VG91Y2hTbmFnOiB0cnVlLFxyXG5cclxuICAgICAgLyoqXHJcbiAgICAgICAqIENhbGxlZCB3aGVuIGEgZHJhZyBzZXF1ZW5jZSBzdGFydHMuXHJcbiAgICAgICAqIEBwYXJhbSB7U2NlbmVyeUV2ZW50fSBldmVudFxyXG4gICAgICAgKi9cclxuICAgICAgc3RhcnQ6IGV2ZW50ID0+IHtcclxuXHJcbiAgICAgICAgLy8gY29tcHV0ZSBvZmZzZXQgZnJvbSBjdXJyZW50IHRyYWNrIGxlbmd0aFxyXG4gICAgICAgIHN0YXJ0RHJhZ1hPZmZzZXQgPSBmaW5pc2hGbGFnTm9kZS5nbG9iYWxUb1BhcmVudFBvaW50KCBldmVudC5wb2ludGVyLnBvaW50ICkueCAtXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsVG9WaWV3LmV2YWx1YXRlKCBjYXIudHJhY2subGVuZ3RoUHJvcGVydHkudmFsdWUgKTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBDYWxsZWQgd2hlbiB0aGUgcG9pbnRlciBtb3ZlcyBkdXJpbmcgYSBkcmFnIHNlcXVlbmNlLlxyXG4gICAgICAgKiBAcGFyYW0ge1NjZW5lcnlFdmVudH0gZXZlbnRcclxuICAgICAgICovXHJcbiAgICAgIGRyYWc6IGV2ZW50ID0+IHtcclxuXHJcbiAgICAgICAgLy8gaGlkZSB0aGUgJ2RyYWcgY3VlJyBhcnJvd3NcclxuICAgICAgICBhcnJvd3NWaXNpYmxlUHJvcGVydHkudmFsdWUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgLy8gY29tcHV0ZSB0cmFjayBsZW5ndGggaW4gdmlldyBjb29yZGluYXRlc1xyXG4gICAgICAgIGNvbnN0IHZpZXdMZW5ndGggPSBmaW5pc2hGbGFnTm9kZS5nbG9iYWxUb1BhcmVudFBvaW50KCBldmVudC5wb2ludGVyLnBvaW50ICkueCAtIHN0YXJ0RHJhZ1hPZmZzZXQ7XHJcblxyXG4gICAgICAgIC8vIGNvbnZlcnQgdG8gbW9kZWwgY29vcmRpbmF0ZXMsIGNvbnN0cmFpbiB0byB0aGUgdHJhY2sgbGVuZ3RoIHJhbmdlXHJcbiAgICAgICAgY29uc3QgbW9kZWxMZW5ndGggPSBVdGlscy5jbGFtcCggbW9kZWxUb1ZpZXcuaW52ZXJzZSggdmlld0xlbmd0aCApLCAwLCBjYXIudHJhY2subWF4TGVuZ3RoICk7XHJcblxyXG4gICAgICAgIC8vIHVwZGF0ZSB0aGUgbW9kZWwsIGNvbnN0cmFpbiB0byBpbnRlZ2VyIHZhbHVlc1xyXG4gICAgICAgIGNhci50cmFjay5sZW5ndGhQcm9wZXJ0eS52YWx1ZSA9IFV0aWxzLnRvRml4ZWROdW1iZXIoIG1vZGVsTGVuZ3RoLCAwICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuICAgIGZpbmlzaEZsYWdOb2RlLmFkZElucHV0TGlzdGVuZXIoIGRyYWdMaXN0ZW5lciApO1xyXG4gICAgY3VlQXJyb3dzTm9kZS5hZGRJbnB1dExpc3RlbmVyKCBkcmFnTGlzdGVuZXIgKTtcclxuXHJcbiAgICAvLyBTeW5jaHJvbml6ZSBjYXIgcG9zaXRpb24gd2l0aCBtb2RlbFxyXG4gICAgLy8gdW5saW5rIG5vdCBuZWVkZWQsIGV4aXN0cyBmb3Igc2ltIGxpZmV0aW1lXHJcbiAgICBjYXIuZGlzdGFuY2VQcm9wZXJ0eS5saW5rKCBkaXN0YW5jZSA9PiB7XHJcbiAgICAgIGNhck5vZGUucmlnaHQgPSBtb2RlbFRvVmlldy5ldmFsdWF0ZSggZGlzdGFuY2UgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB1bmxpbmsgbm90IG5lZWRlZCwgZXhpc3RzIGZvciBzaW0gbGlmZXRpbWVcclxuICAgIGFycm93c1Zpc2libGVQcm9wZXJ0eS5saW5rKCB2aXNpYmxlID0+IHtcclxuICAgICAgY3VlQXJyb3dzTm9kZS52aXNpYmxlID0gdmlzaWJsZTtcclxuICAgIH0gKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIGEgdHJhY2sgbWFya2VyLCBhbiBlcXVpbGF0ZXJhbCB0cmlhbmdsZSwgd2l0aCBvcmlnaW4gYXQgdGlwLlxyXG4gKiBAcmV0dXJucyB7Tm9kZX1cclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZU1hcmtlck5vZGUoKSB7XHJcblxyXG4gIGNvbnN0IG1hcmtlclNoYXBlID0gbmV3IFNoYXBlKClcclxuICAgIC5tb3ZlVG8oIDAsIDAgKVxyXG4gICAgLmxpbmVUbyggVFJBQ0tfTUFSS0VSX1NJREVfTEVOR1RIIC8gMiwgVFJBQ0tfTUFSS0VSX1NJREVfTEVOR1RIIClcclxuICAgIC5saW5lVG8oIC1UUkFDS19NQVJLRVJfU0lERV9MRU5HVEggLyAyLCBUUkFDS19NQVJLRVJfU0lERV9MRU5HVEggKVxyXG4gICAgLmNsb3NlKCk7XHJcblxyXG4gIHJldHVybiBuZXcgUGF0aCggbWFya2VyU2hhcGUsIFRSQUNLX01BUktFUl9PUFRJT05TICk7XHJcbn1cclxuXHJcbnVuaXRSYXRlcy5yZWdpc3RlciggJ1JhY2VUcmFja05vZGUnLCBSYWNlVHJhY2tOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGNBQWMsTUFBTSxzQ0FBc0M7QUFDakUsT0FBT0MsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxTQUFTQyxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELE9BQU9DLEtBQUssTUFBTSxtQ0FBbUM7QUFDckQsT0FBT0MsV0FBVyxNQUFNLCtDQUErQztBQUN2RSxPQUFPQyxTQUFTLE1BQU0sMENBQTBDO0FBQ2hFLE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsU0FBU0MsWUFBWSxFQUFFQyxJQUFJLEVBQUVDLEtBQUssRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsSUFBSSxRQUFR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