// Copyright 2016-2023, University of Colorado Boulder

/**
 * Displays a question and associated answer in the Shopping screen.
 * Values are entered via a keypad.
 * Layout is specified in https://github.com/phetsims/unit-rates/issues/152
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import merge from '../../../../phet-core/js/merge.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { FireListener, HStrut, Line, Node, Path, Rectangle, Text } from '../../../../scenery/js/imports.js';
import checkSolidShape from '../../../../sherpa/js/fontawesome-5/checkSolidShape.js';
import editRegularShape from '../../../../sherpa/js/fontawesome-5/editRegularShape.js';
import RectangularPushButton from '../../../../sun/js/buttons/RectangularPushButton.js';
import URColors from '../../common/URColors.js';
import URConstants from '../../common/URConstants.js';
import URUtils from '../../common/URUtils.js';
import unitRates from '../../unitRates.js';
export default class ShoppingQuestionNode extends Node {
  /**
   * @param {ShoppingQuestion} question - model element for the question
   * @param {Node} questionsPanel - panel that contains the question, for positioning the keypad
   * @param {KeypadLayer} keypadLayer - layer that manages the keypad
   * @param {Object} [options]
   */
  constructor(question, questionsPanel, keypadLayer, options) {
    options = merge({
      valueBoxWidth: 70,
      // {number} width of the value field, height determined by valueFont
      denominatorVisible: false,
      // {boolean} is the denominator visible before the answer is visible?
      neutralColor: 'black',
      // {Color|string} color for UI elements that are agnostic about whether the guess is correct
      questionFont: new PhetFont(14),
      // {Font} font for the question
      valueFont: new PhetFont(14),
      // {Font} font for the value
      valueYMargin: 1,
      // {number} vertical margin inside the value box
      xSpacing: 25,
      // {number} horizontal spacing between UI elements
      ySpacing: 5,
      // {number} vertical spacing between UI elements
      fractionYSpacing: 3 // {number} vertical space above and below fraction line
    }, options);
    super();

    // local vars to improve readability
    const answer = question.answer;
    const answerOptions = question.answerOptions;

    // box that is either empty or displays an incorrect value
    const valueBoxWidth = options.valueBoxWidth;
    const valueBoxHeight = new Text('0', {
      font: options.valueFont
    }).height + 2 * options.valueYMargin;
    const valueBox = new Rectangle(0, 0, valueBoxWidth, valueBoxHeight, {
      stroke: 'black',
      fill: 'white',
      cursor: 'pointer'
    });
    this.addChild(valueBox);
    valueBox.touchArea = valueBox.localBounds.dilatedXY(5, 5);

    // edit button, to the right of the box
    const editButton = new RectangularPushButton({
      content: new Path(editRegularShape, {
        scale: URConstants.EDIT_ICON_SCALE,
        fill: 'black'
      }),
      baseColor: URColors.editButton,
      left: valueBox.right + options.xSpacing,
      centerY: valueBox.centerY
    });
    this.addChild(editButton);
    editButton.touchArea = editButton.localBounds.dilatedXY(10, 10);

    // strut to the left of the box, same width as editButton
    // See layout specification in https://github.com/phetsims/unit-rates/issues/152
    const strut = new HStrut(editButton.width, {
      right: valueBox.left - options.xSpacing,
      centerY: valueBox.centerY
    });
    this.addChild(strut);

    // check mark to right of box, to indicate that the question has been correctly answered
    const checkMarkNode = new Path(checkSolidShape, {
      scale: 0.06,
      fill: URColors.checkMark,
      left: valueBox.right + options.xSpacing,
      centerY: valueBox.centerY,
      visible: false
    });
    this.addChild(checkMarkNode);

    // the question, centered above the box
    const questionTextNode = new Text(question.questionString, {
      font: options.questionFont,
      centerX: valueBox.centerX,
      bottom: valueBox.top - options.ySpacing,
      maxWidth: 180 // i18n, determined empirically
    });

    this.addChild(questionTextNode);

    // the user's guess, as entered via the keypad, appears centered in the box
    const guessNode = new Text('', {
      pickable: false,
      // so it doesn't interfere with clicking in valueBox to open keypad
      fill: options.neutralColor,
      font: options.valueFont,
      center: valueBox.center,
      maxWidth: 0.8 * valueBoxWidth
    });
    this.addChild(guessNode);

    // numerator in the revealed answer, replaces the box when the answer is correct
    const numeratorNode = new Text(question.numeratorString, {
      fill: URColors.correctQuestion,
      font: options.valueFont,
      center: valueBox.center,
      visible: false,
      maxWidth: 100 // i18n, determined empirically
    });

    this.addChild(numeratorNode);

    // fraction line in the revealed answer
    const fractionLineNode = new Line(0, 0, 1.1 * valueBox.width, 0, {
      stroke: options.neutralColor,
      lineWidth: 1,
      centerX: valueBox.centerX,
      top: valueBox.bottom + options.fractionYSpacing,
      visible: options.denominatorVisible
    });
    this.addChild(fractionLineNode);

    // denominator in the revealed answer
    const denominatorNode = new Text(question.denominatorString, {
      fill: options.neutralColor,
      font: options.valueFont,
      centerX: valueBox.centerX,
      top: fractionLineNode.bottom + options.fractionYSpacing,
      visible: options.denominatorVisible,
      maxWidth: 100 // i18n, determined empirically
    });

    this.addChild(denominatorNode);
    this.mutate(options);

    // Update when the guess changes
    const guessObserver = guess => {
      // compare guess to answer using the desired number of decimal places
      const correct = guess === answer;

      // update the guess
      if (guess !== null) {
        guessNode.string = URUtils.formatNumber(answerOptions.valueFormat, guess, answerOptions.maxDecimals, answerOptions.trimZeros);
        guessNode.fill = correct ? URColors.correctQuestion : URColors.incorrectQuestion;
      } else if (phet.chipper.queryParameters.showAnswers) {
        // show the answer, if query parameter is set
        guessNode.string = URUtils.formatNumber(answerOptions.valueFormat, answer, answerOptions.maxDecimals, answerOptions.trimZeros);
        guessNode.string = URUtils.formatNumber(answerOptions.valueFormat, answer, answerOptions.maxDecimals, answerOptions.trimZeros);
        guessNode.fill = URColors.showAnswers;
      } else {
        guessNode.string = '';
      }
      guessNode.visible = !correct;
      guessNode.center = valueBox.center; // center guess in box

      // update other UI elements
      editButton.visible = !correct;
      valueBox.visible = !correct;
      checkMarkNode.visible = correct;
      numeratorNode.visible = correct;
      fractionLineNode.stroke = denominatorNode.fill = correct ? URColors.correctQuestion : options.neutralColor;

      // The denominator is sometimes visible at all times (e.g. for the 'Unit Rate?' question).
      // If it's not visible at all times, make it visible when the answer is revealed.
      if (!options.denominatorVisible) {
        fractionLineNode.visible = denominatorNode.visible = correct;
      }
    };
    question.guessProperty.link(guessObserver); // unlink in dispose

    // highlight the value box to indicate that an edit is in progress
    const onBeginEdit = () => {
      valueBox.fill = URColors.edit;
    };

    // clear highlight to indicate that the edit is completed
    const onEndEdit = () => {
      valueBox.fill = 'white';
    };

    // position the keypad relative to the Questions panel
    const setKeypadPosition = keypad => {
      const questionsPanelBounds = keypad.globalToParentBounds(questionsPanel.localToGlobalBounds(questionsPanel.localBounds));
      keypad.right = questionsPanelBounds.left - 10;
      keypad.bottom = questionsPanelBounds.bottom;
    };

    // opens a keypad to edit the user's guess
    const editValue = () => {
      keypadLayer.beginEdit(question.guessProperty, {
        onBeginEdit: onBeginEdit,
        onEndEdit: onEndEdit,
        setKeypadPosition: setKeypadPosition,
        maxDigits: answerOptions.maxDigits,
        maxDecimals: answerOptions.maxDecimals
      });
    };

    // Press on editButton or in valueBox to begin editing
    editButton.addListener(editValue); // no removeListener required
    valueBox.addInputListener(new FireListener({
      // no removeInputListener required
      fire: editValue
    }));

    // @private cleanup that's specific to this Node
    this.disposeShoppingQuestionNode = () => {
      question.guessProperty.unlink(guessObserver);
      editButton.dispose(); // workaround for memory leak https://github.com/phetsims/unit-rates/issues/207
    };
  }

  /**
   * @public
   * @override
   */
  dispose() {
    this.disposeShoppingQuestionNode();
    super.dispose();
  }
}
unitRates.register('ShoppingQuestionNode', ShoppingQuestionNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtZXJnZSIsIlBoZXRGb250IiwiRmlyZUxpc3RlbmVyIiwiSFN0cnV0IiwiTGluZSIsIk5vZGUiLCJQYXRoIiwiUmVjdGFuZ2xlIiwiVGV4dCIsImNoZWNrU29saWRTaGFwZSIsImVkaXRSZWd1bGFyU2hhcGUiLCJSZWN0YW5ndWxhclB1c2hCdXR0b24iLCJVUkNvbG9ycyIsIlVSQ29uc3RhbnRzIiwiVVJVdGlscyIsInVuaXRSYXRlcyIsIlNob3BwaW5nUXVlc3Rpb25Ob2RlIiwiY29uc3RydWN0b3IiLCJxdWVzdGlvbiIsInF1ZXN0aW9uc1BhbmVsIiwia2V5cGFkTGF5ZXIiLCJvcHRpb25zIiwidmFsdWVCb3hXaWR0aCIsImRlbm9taW5hdG9yVmlzaWJsZSIsIm5ldXRyYWxDb2xvciIsInF1ZXN0aW9uRm9udCIsInZhbHVlRm9udCIsInZhbHVlWU1hcmdpbiIsInhTcGFjaW5nIiwieVNwYWNpbmciLCJmcmFjdGlvbllTcGFjaW5nIiwiYW5zd2VyIiwiYW5zd2VyT3B0aW9ucyIsInZhbHVlQm94SGVpZ2h0IiwiZm9udCIsImhlaWdodCIsInZhbHVlQm94Iiwic3Ryb2tlIiwiZmlsbCIsImN1cnNvciIsImFkZENoaWxkIiwidG91Y2hBcmVhIiwibG9jYWxCb3VuZHMiLCJkaWxhdGVkWFkiLCJlZGl0QnV0dG9uIiwiY29udGVudCIsInNjYWxlIiwiRURJVF9JQ09OX1NDQUxFIiwiYmFzZUNvbG9yIiwibGVmdCIsInJpZ2h0IiwiY2VudGVyWSIsInN0cnV0Iiwid2lkdGgiLCJjaGVja01hcmtOb2RlIiwiY2hlY2tNYXJrIiwidmlzaWJsZSIsInF1ZXN0aW9uVGV4dE5vZGUiLCJxdWVzdGlvblN0cmluZyIsImNlbnRlclgiLCJib3R0b20iLCJ0b3AiLCJtYXhXaWR0aCIsImd1ZXNzTm9kZSIsInBpY2thYmxlIiwiY2VudGVyIiwibnVtZXJhdG9yTm9kZSIsIm51bWVyYXRvclN0cmluZyIsImNvcnJlY3RRdWVzdGlvbiIsImZyYWN0aW9uTGluZU5vZGUiLCJsaW5lV2lkdGgiLCJkZW5vbWluYXRvck5vZGUiLCJkZW5vbWluYXRvclN0cmluZyIsIm11dGF0ZSIsImd1ZXNzT2JzZXJ2ZXIiLCJndWVzcyIsImNvcnJlY3QiLCJzdHJpbmciLCJmb3JtYXROdW1iZXIiLCJ2YWx1ZUZvcm1hdCIsIm1heERlY2ltYWxzIiwidHJpbVplcm9zIiwiaW5jb3JyZWN0UXVlc3Rpb24iLCJwaGV0IiwiY2hpcHBlciIsInF1ZXJ5UGFyYW1ldGVycyIsInNob3dBbnN3ZXJzIiwiZ3Vlc3NQcm9wZXJ0eSIsImxpbmsiLCJvbkJlZ2luRWRpdCIsImVkaXQiLCJvbkVuZEVkaXQiLCJzZXRLZXlwYWRQb3NpdGlvbiIsImtleXBhZCIsInF1ZXN0aW9uc1BhbmVsQm91bmRzIiwiZ2xvYmFsVG9QYXJlbnRCb3VuZHMiLCJsb2NhbFRvR2xvYmFsQm91bmRzIiwiZWRpdFZhbHVlIiwiYmVnaW5FZGl0IiwibWF4RGlnaXRzIiwiYWRkTGlzdGVuZXIiLCJhZGRJbnB1dExpc3RlbmVyIiwiZmlyZSIsImRpc3Bvc2VTaG9wcGluZ1F1ZXN0aW9uTm9kZSIsInVubGluayIsImRpc3Bvc2UiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIlNob3BwaW5nUXVlc3Rpb25Ob2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIERpc3BsYXlzIGEgcXVlc3Rpb24gYW5kIGFzc29jaWF0ZWQgYW5zd2VyIGluIHRoZSBTaG9wcGluZyBzY3JlZW4uXHJcbiAqIFZhbHVlcyBhcmUgZW50ZXJlZCB2aWEgYSBrZXlwYWQuXHJcbiAqIExheW91dCBpcyBzcGVjaWZpZWQgaW4gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3VuaXQtcmF0ZXMvaXNzdWVzLzE1MlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBtZXJnZSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvbWVyZ2UuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgRmlyZUxpc3RlbmVyLCBIU3RydXQsIExpbmUsIE5vZGUsIFBhdGgsIFJlY3RhbmdsZSwgVGV4dCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBjaGVja1NvbGlkU2hhcGUgZnJvbSAnLi4vLi4vLi4vLi4vc2hlcnBhL2pzL2ZvbnRhd2Vzb21lLTUvY2hlY2tTb2xpZFNoYXBlLmpzJztcclxuaW1wb3J0IGVkaXRSZWd1bGFyU2hhcGUgZnJvbSAnLi4vLi4vLi4vLi4vc2hlcnBhL2pzL2ZvbnRhd2Vzb21lLTUvZWRpdFJlZ3VsYXJTaGFwZS5qcyc7XHJcbmltcG9ydCBSZWN0YW5ndWxhclB1c2hCdXR0b24gZnJvbSAnLi4vLi4vLi4vLi4vc3VuL2pzL2J1dHRvbnMvUmVjdGFuZ3VsYXJQdXNoQnV0dG9uLmpzJztcclxuaW1wb3J0IFVSQ29sb3JzIGZyb20gJy4uLy4uL2NvbW1vbi9VUkNvbG9ycy5qcyc7XHJcbmltcG9ydCBVUkNvbnN0YW50cyBmcm9tICcuLi8uLi9jb21tb24vVVJDb25zdGFudHMuanMnO1xyXG5pbXBvcnQgVVJVdGlscyBmcm9tICcuLi8uLi9jb21tb24vVVJVdGlscy5qcyc7XHJcbmltcG9ydCB1bml0UmF0ZXMgZnJvbSAnLi4vLi4vdW5pdFJhdGVzLmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNob3BwaW5nUXVlc3Rpb25Ob2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7U2hvcHBpbmdRdWVzdGlvbn0gcXVlc3Rpb24gLSBtb2RlbCBlbGVtZW50IGZvciB0aGUgcXVlc3Rpb25cclxuICAgKiBAcGFyYW0ge05vZGV9IHF1ZXN0aW9uc1BhbmVsIC0gcGFuZWwgdGhhdCBjb250YWlucyB0aGUgcXVlc3Rpb24sIGZvciBwb3NpdGlvbmluZyB0aGUga2V5cGFkXHJcbiAgICogQHBhcmFtIHtLZXlwYWRMYXllcn0ga2V5cGFkTGF5ZXIgLSBsYXllciB0aGF0IG1hbmFnZXMgdGhlIGtleXBhZFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICAgKi9cclxuICBjb25zdHJ1Y3RvciggcXVlc3Rpb24sIHF1ZXN0aW9uc1BhbmVsLCBrZXlwYWRMYXllciwgb3B0aW9ucyApIHtcclxuXHJcbiAgICBvcHRpb25zID0gbWVyZ2UoIHtcclxuICAgICAgdmFsdWVCb3hXaWR0aDogNzAsIC8vIHtudW1iZXJ9IHdpZHRoIG9mIHRoZSB2YWx1ZSBmaWVsZCwgaGVpZ2h0IGRldGVybWluZWQgYnkgdmFsdWVGb250XHJcbiAgICAgIGRlbm9taW5hdG9yVmlzaWJsZTogZmFsc2UsIC8vIHtib29sZWFufSBpcyB0aGUgZGVub21pbmF0b3IgdmlzaWJsZSBiZWZvcmUgdGhlIGFuc3dlciBpcyB2aXNpYmxlP1xyXG4gICAgICBuZXV0cmFsQ29sb3I6ICdibGFjaycsIC8vIHtDb2xvcnxzdHJpbmd9IGNvbG9yIGZvciBVSSBlbGVtZW50cyB0aGF0IGFyZSBhZ25vc3RpYyBhYm91dCB3aGV0aGVyIHRoZSBndWVzcyBpcyBjb3JyZWN0XHJcbiAgICAgIHF1ZXN0aW9uRm9udDogbmV3IFBoZXRGb250KCAxNCApLCAvLyB7Rm9udH0gZm9udCBmb3IgdGhlIHF1ZXN0aW9uXHJcbiAgICAgIHZhbHVlRm9udDogbmV3IFBoZXRGb250KCAxNCApLCAvLyB7Rm9udH0gZm9udCBmb3IgdGhlIHZhbHVlXHJcbiAgICAgIHZhbHVlWU1hcmdpbjogMSwgLy8ge251bWJlcn0gdmVydGljYWwgbWFyZ2luIGluc2lkZSB0aGUgdmFsdWUgYm94XHJcbiAgICAgIHhTcGFjaW5nOiAyNSwgLy8ge251bWJlcn0gaG9yaXpvbnRhbCBzcGFjaW5nIGJldHdlZW4gVUkgZWxlbWVudHNcclxuICAgICAgeVNwYWNpbmc6IDUsICAvLyB7bnVtYmVyfSB2ZXJ0aWNhbCBzcGFjaW5nIGJldHdlZW4gVUkgZWxlbWVudHNcclxuICAgICAgZnJhY3Rpb25ZU3BhY2luZzogMyAvLyB7bnVtYmVyfSB2ZXJ0aWNhbCBzcGFjZSBhYm92ZSBhbmQgYmVsb3cgZnJhY3Rpb24gbGluZVxyXG4gICAgfSwgb3B0aW9ucyApO1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgLy8gbG9jYWwgdmFycyB0byBpbXByb3ZlIHJlYWRhYmlsaXR5XHJcbiAgICBjb25zdCBhbnN3ZXIgPSBxdWVzdGlvbi5hbnN3ZXI7XHJcbiAgICBjb25zdCBhbnN3ZXJPcHRpb25zID0gcXVlc3Rpb24uYW5zd2VyT3B0aW9ucztcclxuXHJcbiAgICAvLyBib3ggdGhhdCBpcyBlaXRoZXIgZW1wdHkgb3IgZGlzcGxheXMgYW4gaW5jb3JyZWN0IHZhbHVlXHJcbiAgICBjb25zdCB2YWx1ZUJveFdpZHRoID0gb3B0aW9ucy52YWx1ZUJveFdpZHRoO1xyXG4gICAgY29uc3QgdmFsdWVCb3hIZWlnaHQgPSBuZXcgVGV4dCggJzAnLCB7IGZvbnQ6IG9wdGlvbnMudmFsdWVGb250IH0gKS5oZWlnaHQgKyAoIDIgKiBvcHRpb25zLnZhbHVlWU1hcmdpbiApO1xyXG4gICAgY29uc3QgdmFsdWVCb3ggPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCB2YWx1ZUJveFdpZHRoLCB2YWx1ZUJveEhlaWdodCwge1xyXG4gICAgICBzdHJva2U6ICdibGFjaycsXHJcbiAgICAgIGZpbGw6ICd3aGl0ZScsXHJcbiAgICAgIGN1cnNvcjogJ3BvaW50ZXInXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCB2YWx1ZUJveCApO1xyXG4gICAgdmFsdWVCb3gudG91Y2hBcmVhID0gdmFsdWVCb3gubG9jYWxCb3VuZHMuZGlsYXRlZFhZKCA1LCA1ICk7XHJcblxyXG4gICAgLy8gZWRpdCBidXR0b24sIHRvIHRoZSByaWdodCBvZiB0aGUgYm94XHJcbiAgICBjb25zdCBlZGl0QnV0dG9uID0gbmV3IFJlY3Rhbmd1bGFyUHVzaEJ1dHRvbigge1xyXG4gICAgICBjb250ZW50OiBuZXcgUGF0aCggZWRpdFJlZ3VsYXJTaGFwZSwge1xyXG4gICAgICAgIHNjYWxlOiBVUkNvbnN0YW50cy5FRElUX0lDT05fU0NBTEUsXHJcbiAgICAgICAgZmlsbDogJ2JsYWNrJ1xyXG4gICAgICB9ICksXHJcbiAgICAgIGJhc2VDb2xvcjogVVJDb2xvcnMuZWRpdEJ1dHRvbixcclxuICAgICAgbGVmdDogdmFsdWVCb3gucmlnaHQgKyBvcHRpb25zLnhTcGFjaW5nLFxyXG4gICAgICBjZW50ZXJZOiB2YWx1ZUJveC5jZW50ZXJZXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBlZGl0QnV0dG9uICk7XHJcbiAgICBlZGl0QnV0dG9uLnRvdWNoQXJlYSA9IGVkaXRCdXR0b24ubG9jYWxCb3VuZHMuZGlsYXRlZFhZKCAxMCwgMTAgKTtcclxuXHJcbiAgICAvLyBzdHJ1dCB0byB0aGUgbGVmdCBvZiB0aGUgYm94LCBzYW1lIHdpZHRoIGFzIGVkaXRCdXR0b25cclxuICAgIC8vIFNlZSBsYXlvdXQgc3BlY2lmaWNhdGlvbiBpbiBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvdW5pdC1yYXRlcy9pc3N1ZXMvMTUyXHJcbiAgICBjb25zdCBzdHJ1dCA9IG5ldyBIU3RydXQoIGVkaXRCdXR0b24ud2lkdGgsIHtcclxuICAgICAgcmlnaHQ6IHZhbHVlQm94LmxlZnQgLSBvcHRpb25zLnhTcGFjaW5nLFxyXG4gICAgICBjZW50ZXJZOiB2YWx1ZUJveC5jZW50ZXJZXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBzdHJ1dCApO1xyXG5cclxuICAgIC8vIGNoZWNrIG1hcmsgdG8gcmlnaHQgb2YgYm94LCB0byBpbmRpY2F0ZSB0aGF0IHRoZSBxdWVzdGlvbiBoYXMgYmVlbiBjb3JyZWN0bHkgYW5zd2VyZWRcclxuICAgIGNvbnN0IGNoZWNrTWFya05vZGUgPSBuZXcgUGF0aCggY2hlY2tTb2xpZFNoYXBlLCB7XHJcbiAgICAgIHNjYWxlOiAwLjA2LFxyXG4gICAgICBmaWxsOiBVUkNvbG9ycy5jaGVja01hcmssXHJcbiAgICAgIGxlZnQ6IHZhbHVlQm94LnJpZ2h0ICsgb3B0aW9ucy54U3BhY2luZyxcclxuICAgICAgY2VudGVyWTogdmFsdWVCb3guY2VudGVyWSxcclxuICAgICAgdmlzaWJsZTogZmFsc2VcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGNoZWNrTWFya05vZGUgKTtcclxuXHJcbiAgICAvLyB0aGUgcXVlc3Rpb24sIGNlbnRlcmVkIGFib3ZlIHRoZSBib3hcclxuICAgIGNvbnN0IHF1ZXN0aW9uVGV4dE5vZGUgPSBuZXcgVGV4dCggcXVlc3Rpb24ucXVlc3Rpb25TdHJpbmcsIHtcclxuICAgICAgZm9udDogb3B0aW9ucy5xdWVzdGlvbkZvbnQsXHJcbiAgICAgIGNlbnRlclg6IHZhbHVlQm94LmNlbnRlclgsXHJcbiAgICAgIGJvdHRvbTogdmFsdWVCb3gudG9wIC0gb3B0aW9ucy55U3BhY2luZyxcclxuICAgICAgbWF4V2lkdGg6IDE4MCAvLyBpMThuLCBkZXRlcm1pbmVkIGVtcGlyaWNhbGx5XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBxdWVzdGlvblRleHROb2RlICk7XHJcblxyXG4gICAgLy8gdGhlIHVzZXIncyBndWVzcywgYXMgZW50ZXJlZCB2aWEgdGhlIGtleXBhZCwgYXBwZWFycyBjZW50ZXJlZCBpbiB0aGUgYm94XHJcbiAgICBjb25zdCBndWVzc05vZGUgPSBuZXcgVGV4dCggJycsIHtcclxuICAgICAgcGlja2FibGU6IGZhbHNlLCAvLyBzbyBpdCBkb2Vzbid0IGludGVyZmVyZSB3aXRoIGNsaWNraW5nIGluIHZhbHVlQm94IHRvIG9wZW4ga2V5cGFkXHJcbiAgICAgIGZpbGw6IG9wdGlvbnMubmV1dHJhbENvbG9yLFxyXG4gICAgICBmb250OiBvcHRpb25zLnZhbHVlRm9udCxcclxuICAgICAgY2VudGVyOiB2YWx1ZUJveC5jZW50ZXIsXHJcbiAgICAgIG1heFdpZHRoOiAwLjggKiB2YWx1ZUJveFdpZHRoXHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBndWVzc05vZGUgKTtcclxuXHJcbiAgICAvLyBudW1lcmF0b3IgaW4gdGhlIHJldmVhbGVkIGFuc3dlciwgcmVwbGFjZXMgdGhlIGJveCB3aGVuIHRoZSBhbnN3ZXIgaXMgY29ycmVjdFxyXG4gICAgY29uc3QgbnVtZXJhdG9yTm9kZSA9IG5ldyBUZXh0KCBxdWVzdGlvbi5udW1lcmF0b3JTdHJpbmcsIHtcclxuICAgICAgZmlsbDogVVJDb2xvcnMuY29ycmVjdFF1ZXN0aW9uLFxyXG4gICAgICBmb250OiBvcHRpb25zLnZhbHVlRm9udCxcclxuICAgICAgY2VudGVyOiB2YWx1ZUJveC5jZW50ZXIsXHJcbiAgICAgIHZpc2libGU6IGZhbHNlLFxyXG4gICAgICBtYXhXaWR0aDogMTAwIC8vIGkxOG4sIGRldGVybWluZWQgZW1waXJpY2FsbHlcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIG51bWVyYXRvck5vZGUgKTtcclxuXHJcbiAgICAvLyBmcmFjdGlvbiBsaW5lIGluIHRoZSByZXZlYWxlZCBhbnN3ZXJcclxuICAgIGNvbnN0IGZyYWN0aW9uTGluZU5vZGUgPSBuZXcgTGluZSggMCwgMCwgMS4xICogdmFsdWVCb3gud2lkdGgsIDAsIHtcclxuICAgICAgc3Ryb2tlOiBvcHRpb25zLm5ldXRyYWxDb2xvcixcclxuICAgICAgbGluZVdpZHRoOiAxLFxyXG4gICAgICBjZW50ZXJYOiB2YWx1ZUJveC5jZW50ZXJYLFxyXG4gICAgICB0b3A6IHZhbHVlQm94LmJvdHRvbSArIG9wdGlvbnMuZnJhY3Rpb25ZU3BhY2luZyxcclxuICAgICAgdmlzaWJsZTogb3B0aW9ucy5kZW5vbWluYXRvclZpc2libGVcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIGZyYWN0aW9uTGluZU5vZGUgKTtcclxuXHJcbiAgICAvLyBkZW5vbWluYXRvciBpbiB0aGUgcmV2ZWFsZWQgYW5zd2VyXHJcbiAgICBjb25zdCBkZW5vbWluYXRvck5vZGUgPSBuZXcgVGV4dCggcXVlc3Rpb24uZGVub21pbmF0b3JTdHJpbmcsIHtcclxuICAgICAgZmlsbDogb3B0aW9ucy5uZXV0cmFsQ29sb3IsXHJcbiAgICAgIGZvbnQ6IG9wdGlvbnMudmFsdWVGb250LFxyXG4gICAgICBjZW50ZXJYOiB2YWx1ZUJveC5jZW50ZXJYLFxyXG4gICAgICB0b3A6IGZyYWN0aW9uTGluZU5vZGUuYm90dG9tICsgb3B0aW9ucy5mcmFjdGlvbllTcGFjaW5nLFxyXG4gICAgICB2aXNpYmxlOiBvcHRpb25zLmRlbm9taW5hdG9yVmlzaWJsZSxcclxuICAgICAgbWF4V2lkdGg6IDEwMCAvLyBpMThuLCBkZXRlcm1pbmVkIGVtcGlyaWNhbGx5XHJcbiAgICB9ICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBkZW5vbWluYXRvck5vZGUgKTtcclxuXHJcbiAgICB0aGlzLm11dGF0ZSggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIFVwZGF0ZSB3aGVuIHRoZSBndWVzcyBjaGFuZ2VzXHJcbiAgICBjb25zdCBndWVzc09ic2VydmVyID0gZ3Vlc3MgPT4ge1xyXG5cclxuICAgICAgLy8gY29tcGFyZSBndWVzcyB0byBhbnN3ZXIgdXNpbmcgdGhlIGRlc2lyZWQgbnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzXHJcbiAgICAgIGNvbnN0IGNvcnJlY3QgPSAoIGd1ZXNzID09PSBhbnN3ZXIgKTtcclxuXHJcbiAgICAgIC8vIHVwZGF0ZSB0aGUgZ3Vlc3NcclxuICAgICAgaWYgKCBndWVzcyAhPT0gbnVsbCApIHtcclxuICAgICAgICBndWVzc05vZGUuc3RyaW5nID0gVVJVdGlscy5mb3JtYXROdW1iZXIoIGFuc3dlck9wdGlvbnMudmFsdWVGb3JtYXQsIGd1ZXNzLCBhbnN3ZXJPcHRpb25zLm1heERlY2ltYWxzLCBhbnN3ZXJPcHRpb25zLnRyaW1aZXJvcyApO1xyXG4gICAgICAgIGd1ZXNzTm9kZS5maWxsID0gY29ycmVjdCA/IFVSQ29sb3JzLmNvcnJlY3RRdWVzdGlvbiA6IFVSQ29sb3JzLmluY29ycmVjdFF1ZXN0aW9uO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKCBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnNob3dBbnN3ZXJzICkge1xyXG5cclxuICAgICAgICAvLyBzaG93IHRoZSBhbnN3ZXIsIGlmIHF1ZXJ5IHBhcmFtZXRlciBpcyBzZXRcclxuICAgICAgICBndWVzc05vZGUuc3RyaW5nID0gVVJVdGlscy5mb3JtYXROdW1iZXIoIGFuc3dlck9wdGlvbnMudmFsdWVGb3JtYXQsIGFuc3dlciwgYW5zd2VyT3B0aW9ucy5tYXhEZWNpbWFscywgYW5zd2VyT3B0aW9ucy50cmltWmVyb3MgKTtcclxuICAgICAgICBndWVzc05vZGUuc3RyaW5nID0gVVJVdGlscy5mb3JtYXROdW1iZXIoIGFuc3dlck9wdGlvbnMudmFsdWVGb3JtYXQsIGFuc3dlciwgYW5zd2VyT3B0aW9ucy5tYXhEZWNpbWFscywgYW5zd2VyT3B0aW9ucy50cmltWmVyb3MgKTtcclxuICAgICAgICBndWVzc05vZGUuZmlsbCA9IFVSQ29sb3JzLnNob3dBbnN3ZXJzO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGd1ZXNzTm9kZS5zdHJpbmcgPSAnJztcclxuICAgICAgfVxyXG4gICAgICBndWVzc05vZGUudmlzaWJsZSA9ICFjb3JyZWN0O1xyXG4gICAgICBndWVzc05vZGUuY2VudGVyID0gdmFsdWVCb3guY2VudGVyOyAvLyBjZW50ZXIgZ3Vlc3MgaW4gYm94XHJcblxyXG4gICAgICAvLyB1cGRhdGUgb3RoZXIgVUkgZWxlbWVudHNcclxuICAgICAgZWRpdEJ1dHRvbi52aXNpYmxlID0gIWNvcnJlY3Q7XHJcbiAgICAgIHZhbHVlQm94LnZpc2libGUgPSAhY29ycmVjdDtcclxuICAgICAgY2hlY2tNYXJrTm9kZS52aXNpYmxlID0gY29ycmVjdDtcclxuICAgICAgbnVtZXJhdG9yTm9kZS52aXNpYmxlID0gY29ycmVjdDtcclxuICAgICAgZnJhY3Rpb25MaW5lTm9kZS5zdHJva2UgPSBkZW5vbWluYXRvck5vZGUuZmlsbCA9ICggY29ycmVjdCA/IFVSQ29sb3JzLmNvcnJlY3RRdWVzdGlvbiA6IG9wdGlvbnMubmV1dHJhbENvbG9yICk7XHJcblxyXG4gICAgICAvLyBUaGUgZGVub21pbmF0b3IgaXMgc29tZXRpbWVzIHZpc2libGUgYXQgYWxsIHRpbWVzIChlLmcuIGZvciB0aGUgJ1VuaXQgUmF0ZT8nIHF1ZXN0aW9uKS5cclxuICAgICAgLy8gSWYgaXQncyBub3QgdmlzaWJsZSBhdCBhbGwgdGltZXMsIG1ha2UgaXQgdmlzaWJsZSB3aGVuIHRoZSBhbnN3ZXIgaXMgcmV2ZWFsZWQuXHJcbiAgICAgIGlmICggIW9wdGlvbnMuZGVub21pbmF0b3JWaXNpYmxlICkge1xyXG4gICAgICAgIGZyYWN0aW9uTGluZU5vZGUudmlzaWJsZSA9IGRlbm9taW5hdG9yTm9kZS52aXNpYmxlID0gY29ycmVjdDtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHF1ZXN0aW9uLmd1ZXNzUHJvcGVydHkubGluayggZ3Vlc3NPYnNlcnZlciApOyAvLyB1bmxpbmsgaW4gZGlzcG9zZVxyXG5cclxuICAgIC8vIGhpZ2hsaWdodCB0aGUgdmFsdWUgYm94IHRvIGluZGljYXRlIHRoYXQgYW4gZWRpdCBpcyBpbiBwcm9ncmVzc1xyXG4gICAgY29uc3Qgb25CZWdpbkVkaXQgPSAoKSA9PiB7XHJcbiAgICAgIHZhbHVlQm94LmZpbGwgPSBVUkNvbG9ycy5lZGl0O1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBjbGVhciBoaWdobGlnaHQgdG8gaW5kaWNhdGUgdGhhdCB0aGUgZWRpdCBpcyBjb21wbGV0ZWRcclxuICAgIGNvbnN0IG9uRW5kRWRpdCA9ICgpID0+IHtcclxuICAgICAgdmFsdWVCb3guZmlsbCA9ICd3aGl0ZSc7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIHBvc2l0aW9uIHRoZSBrZXlwYWQgcmVsYXRpdmUgdG8gdGhlIFF1ZXN0aW9ucyBwYW5lbFxyXG4gICAgY29uc3Qgc2V0S2V5cGFkUG9zaXRpb24gPSBrZXlwYWQgPT4ge1xyXG4gICAgICBjb25zdCBxdWVzdGlvbnNQYW5lbEJvdW5kcyA9IGtleXBhZC5nbG9iYWxUb1BhcmVudEJvdW5kcyggcXVlc3Rpb25zUGFuZWwubG9jYWxUb0dsb2JhbEJvdW5kcyggcXVlc3Rpb25zUGFuZWwubG9jYWxCb3VuZHMgKSApO1xyXG4gICAgICBrZXlwYWQucmlnaHQgPSBxdWVzdGlvbnNQYW5lbEJvdW5kcy5sZWZ0IC0gMTA7XHJcbiAgICAgIGtleXBhZC5ib3R0b20gPSBxdWVzdGlvbnNQYW5lbEJvdW5kcy5ib3R0b207XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIG9wZW5zIGEga2V5cGFkIHRvIGVkaXQgdGhlIHVzZXIncyBndWVzc1xyXG4gICAgY29uc3QgZWRpdFZhbHVlID0gKCkgPT4ge1xyXG4gICAgICBrZXlwYWRMYXllci5iZWdpbkVkaXQoIHF1ZXN0aW9uLmd1ZXNzUHJvcGVydHksIHtcclxuICAgICAgICBvbkJlZ2luRWRpdDogb25CZWdpbkVkaXQsXHJcbiAgICAgICAgb25FbmRFZGl0OiBvbkVuZEVkaXQsXHJcbiAgICAgICAgc2V0S2V5cGFkUG9zaXRpb246IHNldEtleXBhZFBvc2l0aW9uLFxyXG4gICAgICAgIG1heERpZ2l0czogYW5zd2VyT3B0aW9ucy5tYXhEaWdpdHMsXHJcbiAgICAgICAgbWF4RGVjaW1hbHM6IGFuc3dlck9wdGlvbnMubWF4RGVjaW1hbHNcclxuICAgICAgfSApO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBQcmVzcyBvbiBlZGl0QnV0dG9uIG9yIGluIHZhbHVlQm94IHRvIGJlZ2luIGVkaXRpbmdcclxuICAgIGVkaXRCdXR0b24uYWRkTGlzdGVuZXIoIGVkaXRWYWx1ZSApOyAvLyBubyByZW1vdmVMaXN0ZW5lciByZXF1aXJlZFxyXG4gICAgdmFsdWVCb3guYWRkSW5wdXRMaXN0ZW5lciggbmV3IEZpcmVMaXN0ZW5lciggeyAvLyBubyByZW1vdmVJbnB1dExpc3RlbmVyIHJlcXVpcmVkXHJcbiAgICAgIGZpcmU6IGVkaXRWYWx1ZVxyXG4gICAgfSApICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGUgY2xlYW51cCB0aGF0J3Mgc3BlY2lmaWMgdG8gdGhpcyBOb2RlXHJcbiAgICB0aGlzLmRpc3Bvc2VTaG9wcGluZ1F1ZXN0aW9uTm9kZSA9ICgpID0+IHtcclxuICAgICAgcXVlc3Rpb24uZ3Vlc3NQcm9wZXJ0eS51bmxpbmsoIGd1ZXNzT2JzZXJ2ZXIgKTtcclxuICAgICAgZWRpdEJ1dHRvbi5kaXNwb3NlKCk7IC8vIHdvcmthcm91bmQgZm9yIG1lbW9yeSBsZWFrIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy91bml0LXJhdGVzL2lzc3Vlcy8yMDdcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcHVibGljXHJcbiAgICogQG92ZXJyaWRlXHJcbiAgICovXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIHRoaXMuZGlzcG9zZVNob3BwaW5nUXVlc3Rpb25Ob2RlKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG51bml0UmF0ZXMucmVnaXN0ZXIoICdTaG9wcGluZ1F1ZXN0aW9uTm9kZScsIFNob3BwaW5nUXVlc3Rpb25Ob2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxLQUFLLE1BQU0sbUNBQW1DO0FBQ3JELE9BQU9DLFFBQVEsTUFBTSx5Q0FBeUM7QUFDOUQsU0FBU0MsWUFBWSxFQUFFQyxNQUFNLEVBQUVDLElBQUksRUFBRUMsSUFBSSxFQUFFQyxJQUFJLEVBQUVDLFNBQVMsRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUMzRyxPQUFPQyxlQUFlLE1BQU0sd0RBQXdEO0FBQ3BGLE9BQU9DLGdCQUFnQixNQUFNLHlEQUF5RDtBQUN0RixPQUFPQyxxQkFBcUIsTUFBTSxx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