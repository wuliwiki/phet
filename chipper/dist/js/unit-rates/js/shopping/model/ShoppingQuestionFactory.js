// Copyright 2017-2022, University of Colorado Boulder

/**
 * Functions for creating ShoppingQuestions and question sets.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Utils from '../../../../dot/js/Utils.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import URUtils from '../../common/URUtils.js';
import unitRates from '../../unitRates.js';
import UnitRatesStrings from '../../UnitRatesStrings.js';
import ShoppingQuestion from './ShoppingQuestion.js';
const ShoppingQuestionFactory = {
  /**
   * Creates a question of the form 'Unit Rate?'
   *
   * @param {number} unitRate
   * @param {string} units - units for the denominator
   * @param {Object} numeratorOptions - see ShoppingItem options.numeratorOptions
   * @param {Object} denominatorOptions - see ShoppingItem options.denominatorOptions
   * @returns {ShoppingQuestion}
   * @public
   * @static
   */
  createUnitRateQuestion: function (unitRate, units, numeratorOptions, denominatorOptions) {
    // '$0.50'
    const numerator = unitRate;
    const numeratorString = StringUtils.format(UnitRatesStrings.pattern_0cost, URUtils.numberToString(numerator, numeratorOptions.maxDecimals, numeratorOptions.trimZeros));

    // '1 Apple'
    const denominator = 1;
    const denominatorString = StringUtils.format(UnitRatesStrings.pattern_0value_1units, URUtils.numberToString(denominator, denominatorOptions.maxDecimals, denominatorOptions.trimZeros), units);
    return new ShoppingQuestion(UnitRatesStrings.unitRateQuestion, unitRate, numerator, denominator, numeratorString, denominatorString, numeratorOptions);
  },
  /**
   * Creates question sets from raw data.
   *
   * @param {number[][]} questionQuantities - number of items for each question, see ShoppingItemData
   * @param {number} unitRate
   * @param {string} singularUnits - denominator units to use for questions with singular quantities
   * @param {string} pluralUnits - denominator units to use for questions with plural quantities
   * @param {string} amountOfQuestionUnits - units used for "Apples for $10.00?" type questions
   * @param {Object} numeratorOptions - see ShoppingItem.numeratorOptions
   * @param {Object} denominatorOptions - see ShoppingItem.denominatorOptions
   * @returns {ShoppingQuestion[][]}
   * @public
   * @static
   */
  createQuestionSets: function (questionQuantities, unitRate, singularUnits, pluralUnits, amountOfQuestionUnits, numeratorOptions, denominatorOptions) {
    const questionSets = []; // {ShoppingQuestion[][]}

    questionQuantities.forEach(quantities => {
      const questions = [];

      // the first N-1 questions are of the form 'Cost of 3 Apples?'
      for (let i = 0; i < quantities.length - 1; i++) {
        questions.push(createCostOfQuestion(quantities[i], unitRate, singularUnits, pluralUnits, numeratorOptions, denominatorOptions));
      }

      // the last question is of the form 'Apples for $3.00?'
      questions.push(createItemsForQuestion(quantities[quantities.length - 1], unitRate, singularUnits, pluralUnits, amountOfQuestionUnits, numeratorOptions, denominatorOptions));
      questionSets.push(questions);
    });
    return questionSets;
  }
};

/**
 * Creates a question of the form 'Cost of 10 Apples?' or 'Cost of 2.2 pounds?'
 * @param {number} denominator
 * @param {number} unitRate
 * @param {string} singularUnits - denominator units to use for questions with singular quantities
 * @param {string} pluralUnits - denominator units to use for questions with plural quantities
 * @param {Object} numeratorOptions - see ShoppingItem options.numeratorOptions
 * @param {Object} denominatorOptions - see ShoppingItem options.denominatorOptions
 * @returns {ShoppingQuestion}
 */
function createCostOfQuestion(denominator, unitRate, singularUnits, pluralUnits, numeratorOptions, denominatorOptions) {
  // answer
  const numerator = denominator * unitRate;
  const answer = Utils.toFixedNumber(numerator, numeratorOptions.maxDecimals);

  // 'Apples' or 'Apple'
  const units = denominator > 1 ? pluralUnits : singularUnits;

  // '$3.00'
  const numeratorString = StringUtils.format(UnitRatesStrings.pattern_0cost, URUtils.numberToString(numerator, numeratorOptions.maxDecimals, numeratorOptions.trimZeros));

  // '10 Apples'
  const denominatorString = StringUtils.format(UnitRatesStrings.pattern_0value_1units, URUtils.numberToString(denominator, denominatorOptions.maxDecimals, denominatorOptions.trimZeros), units);

  // 'Cost of 10 Apples?'
  const questionString = StringUtils.format(UnitRatesStrings.pattern_costOf_0quantity_1units, URUtils.numberToString(denominator, denominatorOptions.maxDecimals, denominatorOptions.trimZeros), units);
  return new ShoppingQuestion(questionString, answer, numerator, denominator, numeratorString, denominatorString, numeratorOptions);
}

/**
 * Creates a question of the form 'Apples for $3.00?'
 * @param {number} denominator
 * @param {number} unitRate
 * @param {string} singularUnits
 * @param {string} pluralUnits
 * @param {string} amountOfQuestionUnits - units used for "Apples for $10.00?" type questions
 * @param {Object} numeratorOptions - see ShoppingItem options.numeratorOptions
 * @param {Object} denominatorOptions - see ShoppingItem options.denominatorOptions
 * @returns {ShoppingQuestion}
 */
function createItemsForQuestion(denominator, unitRate, singularUnits, pluralUnits, amountOfQuestionUnits, numeratorOptions, denominatorOptions) {
  // answer
  const answer = Utils.toFixedNumber(denominator, denominatorOptions.maxDecimals);

  // 'Apples' or 'Apple'
  const units = denominator > 1 ? pluralUnits : singularUnits;

  // '$4.00'
  const numerator = denominator * unitRate;
  const numeratorString = StringUtils.format(UnitRatesStrings.pattern_0cost, URUtils.numberToString(numerator, numeratorOptions.maxDecimals, numeratorOptions.trimZeros));

  // '8 Apples'
  const denominatorString = StringUtils.format(UnitRatesStrings.pattern_0value_1units, URUtils.numberToString(denominator, denominatorOptions.maxDecimals, denominatorOptions.trimZeros), units);

  // 'Apples for $4.00?'
  const questionString = StringUtils.format(UnitRatesStrings.pattern_0items_1cost, amountOfQuestionUnits, URUtils.numberToString(numerator, numeratorOptions.maxDecimals, numeratorOptions.trimZeros));
  return new ShoppingQuestion(questionString, answer, numerator, denominator, numeratorString, denominatorString, denominatorOptions);
}
unitRates.register('ShoppingQuestionFactory', ShoppingQuestionFactory);
export default ShoppingQuestionFactory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIlN0cmluZ1V0aWxzIiwiVVJVdGlscyIsInVuaXRSYXRlcyIsIlVuaXRSYXRlc1N0cmluZ3MiLCJTaG9wcGluZ1F1ZXN0aW9uIiwiU2hvcHBpbmdRdWVzdGlvbkZhY3RvcnkiLCJjcmVhdGVVbml0UmF0ZVF1ZXN0aW9uIiwidW5pdFJhdGUiLCJ1bml0cyIsIm51bWVyYXRvck9wdGlvbnMiLCJkZW5vbWluYXRvck9wdGlvbnMiLCJudW1lcmF0b3IiLCJudW1lcmF0b3JTdHJpbmciLCJmb3JtYXQiLCJwYXR0ZXJuXzBjb3N0IiwibnVtYmVyVG9TdHJpbmciLCJtYXhEZWNpbWFscyIsInRyaW1aZXJvcyIsImRlbm9taW5hdG9yIiwiZGVub21pbmF0b3JTdHJpbmciLCJwYXR0ZXJuXzB2YWx1ZV8xdW5pdHMiLCJ1bml0UmF0ZVF1ZXN0aW9uIiwiY3JlYXRlUXVlc3Rpb25TZXRzIiwicXVlc3Rpb25RdWFudGl0aWVzIiwic2luZ3VsYXJVbml0cyIsInBsdXJhbFVuaXRzIiwiYW1vdW50T2ZRdWVzdGlvblVuaXRzIiwicXVlc3Rpb25TZXRzIiwiZm9yRWFjaCIsInF1YW50aXRpZXMiLCJxdWVzdGlvbnMiLCJpIiwibGVuZ3RoIiwicHVzaCIsImNyZWF0ZUNvc3RPZlF1ZXN0aW9uIiwiY3JlYXRlSXRlbXNGb3JRdWVzdGlvbiIsImFuc3dlciIsInRvRml4ZWROdW1iZXIiLCJxdWVzdGlvblN0cmluZyIsInBhdHRlcm5fY29zdE9mXzBxdWFudGl0eV8xdW5pdHMiLCJwYXR0ZXJuXzBpdGVtc18xY29zdCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiU2hvcHBpbmdRdWVzdGlvbkZhY3RvcnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTctMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogRnVuY3Rpb25zIGZvciBjcmVhdGluZyBTaG9wcGluZ1F1ZXN0aW9ucyBhbmQgcXVlc3Rpb24gc2V0cy5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICovXHJcblxyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCBVUlV0aWxzIGZyb20gJy4uLy4uL2NvbW1vbi9VUlV0aWxzLmpzJztcclxuaW1wb3J0IHVuaXRSYXRlcyBmcm9tICcuLi8uLi91bml0UmF0ZXMuanMnO1xyXG5pbXBvcnQgVW5pdFJhdGVzU3RyaW5ncyBmcm9tICcuLi8uLi9Vbml0UmF0ZXNTdHJpbmdzLmpzJztcclxuaW1wb3J0IFNob3BwaW5nUXVlc3Rpb24gZnJvbSAnLi9TaG9wcGluZ1F1ZXN0aW9uLmpzJztcclxuXHJcbmNvbnN0IFNob3BwaW5nUXVlc3Rpb25GYWN0b3J5ID0ge1xyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgcXVlc3Rpb24gb2YgdGhlIGZvcm0gJ1VuaXQgUmF0ZT8nXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge251bWJlcn0gdW5pdFJhdGVcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdW5pdHMgLSB1bml0cyBmb3IgdGhlIGRlbm9taW5hdG9yXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IG51bWVyYXRvck9wdGlvbnMgLSBzZWUgU2hvcHBpbmdJdGVtIG9wdGlvbnMubnVtZXJhdG9yT3B0aW9uc1xyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBkZW5vbWluYXRvck9wdGlvbnMgLSBzZWUgU2hvcHBpbmdJdGVtIG9wdGlvbnMuZGVub21pbmF0b3JPcHRpb25zXHJcbiAgICogQHJldHVybnMge1Nob3BwaW5nUXVlc3Rpb259XHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEBzdGF0aWNcclxuICAgKi9cclxuICBjcmVhdGVVbml0UmF0ZVF1ZXN0aW9uOiBmdW5jdGlvbiggdW5pdFJhdGUsIHVuaXRzLCBudW1lcmF0b3JPcHRpb25zLCBkZW5vbWluYXRvck9wdGlvbnMgKSB7XHJcblxyXG4gICAgLy8gJyQwLjUwJ1xyXG4gICAgY29uc3QgbnVtZXJhdG9yID0gdW5pdFJhdGU7XHJcbiAgICBjb25zdCBudW1lcmF0b3JTdHJpbmcgPSBTdHJpbmdVdGlscy5mb3JtYXQoIFVuaXRSYXRlc1N0cmluZ3MucGF0dGVybl8wY29zdCxcclxuICAgICAgVVJVdGlscy5udW1iZXJUb1N0cmluZyggbnVtZXJhdG9yLCBudW1lcmF0b3JPcHRpb25zLm1heERlY2ltYWxzLCBudW1lcmF0b3JPcHRpb25zLnRyaW1aZXJvcyApICk7XHJcblxyXG4gICAgLy8gJzEgQXBwbGUnXHJcbiAgICBjb25zdCBkZW5vbWluYXRvciA9IDE7XHJcbiAgICBjb25zdCBkZW5vbWluYXRvclN0cmluZyA9IFN0cmluZ1V0aWxzLmZvcm1hdCggVW5pdFJhdGVzU3RyaW5ncy5wYXR0ZXJuXzB2YWx1ZV8xdW5pdHMsXHJcbiAgICAgIFVSVXRpbHMubnVtYmVyVG9TdHJpbmcoIGRlbm9taW5hdG9yLCBkZW5vbWluYXRvck9wdGlvbnMubWF4RGVjaW1hbHMsIGRlbm9taW5hdG9yT3B0aW9ucy50cmltWmVyb3MgKSxcclxuICAgICAgdW5pdHMgKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFNob3BwaW5nUXVlc3Rpb24oIFVuaXRSYXRlc1N0cmluZ3MudW5pdFJhdGVRdWVzdGlvbiwgdW5pdFJhdGUsIG51bWVyYXRvciwgZGVub21pbmF0b3IsIG51bWVyYXRvclN0cmluZywgZGVub21pbmF0b3JTdHJpbmcsIG51bWVyYXRvck9wdGlvbnMgKTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIHF1ZXN0aW9uIHNldHMgZnJvbSByYXcgZGF0YS5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyW11bXX0gcXVlc3Rpb25RdWFudGl0aWVzIC0gbnVtYmVyIG9mIGl0ZW1zIGZvciBlYWNoIHF1ZXN0aW9uLCBzZWUgU2hvcHBpbmdJdGVtRGF0YVxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB1bml0UmF0ZVxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzaW5ndWxhclVuaXRzIC0gZGVub21pbmF0b3IgdW5pdHMgdG8gdXNlIGZvciBxdWVzdGlvbnMgd2l0aCBzaW5ndWxhciBxdWFudGl0aWVzXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBsdXJhbFVuaXRzIC0gZGVub21pbmF0b3IgdW5pdHMgdG8gdXNlIGZvciBxdWVzdGlvbnMgd2l0aCBwbHVyYWwgcXVhbnRpdGllc1xyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhbW91bnRPZlF1ZXN0aW9uVW5pdHMgLSB1bml0cyB1c2VkIGZvciBcIkFwcGxlcyBmb3IgJDEwLjAwP1wiIHR5cGUgcXVlc3Rpb25zXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IG51bWVyYXRvck9wdGlvbnMgLSBzZWUgU2hvcHBpbmdJdGVtLm51bWVyYXRvck9wdGlvbnNcclxuICAgKiBAcGFyYW0ge09iamVjdH0gZGVub21pbmF0b3JPcHRpb25zIC0gc2VlIFNob3BwaW5nSXRlbS5kZW5vbWluYXRvck9wdGlvbnNcclxuICAgKiBAcmV0dXJucyB7U2hvcHBpbmdRdWVzdGlvbltdW119XHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEBzdGF0aWNcclxuICAgKi9cclxuICBjcmVhdGVRdWVzdGlvblNldHM6IGZ1bmN0aW9uKCBxdWVzdGlvblF1YW50aXRpZXMsIHVuaXRSYXRlLCBzaW5ndWxhclVuaXRzLCBwbHVyYWxVbml0cywgYW1vdW50T2ZRdWVzdGlvblVuaXRzLCBudW1lcmF0b3JPcHRpb25zLCBkZW5vbWluYXRvck9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3QgcXVlc3Rpb25TZXRzID0gW107IC8vIHtTaG9wcGluZ1F1ZXN0aW9uW11bXX1cclxuXHJcbiAgICBxdWVzdGlvblF1YW50aXRpZXMuZm9yRWFjaCggcXVhbnRpdGllcyA9PiB7XHJcblxyXG4gICAgICBjb25zdCBxdWVzdGlvbnMgPSBbXTtcclxuXHJcbiAgICAgIC8vIHRoZSBmaXJzdCBOLTEgcXVlc3Rpb25zIGFyZSBvZiB0aGUgZm9ybSAnQ29zdCBvZiAzIEFwcGxlcz8nXHJcbiAgICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHF1YW50aXRpZXMubGVuZ3RoIC0gMTsgaSsrICkge1xyXG4gICAgICAgIHF1ZXN0aW9ucy5wdXNoKCBjcmVhdGVDb3N0T2ZRdWVzdGlvbiggcXVhbnRpdGllc1sgaSBdLFxyXG4gICAgICAgICAgdW5pdFJhdGUsIHNpbmd1bGFyVW5pdHMsIHBsdXJhbFVuaXRzLFxyXG4gICAgICAgICAgbnVtZXJhdG9yT3B0aW9ucywgZGVub21pbmF0b3JPcHRpb25zICkgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gdGhlIGxhc3QgcXVlc3Rpb24gaXMgb2YgdGhlIGZvcm0gJ0FwcGxlcyBmb3IgJDMuMDA/J1xyXG4gICAgICBxdWVzdGlvbnMucHVzaCggY3JlYXRlSXRlbXNGb3JRdWVzdGlvbiggcXVhbnRpdGllc1sgcXVhbnRpdGllcy5sZW5ndGggLSAxIF0sXHJcbiAgICAgICAgdW5pdFJhdGUsIHNpbmd1bGFyVW5pdHMsIHBsdXJhbFVuaXRzLCBhbW91bnRPZlF1ZXN0aW9uVW5pdHMsXHJcbiAgICAgICAgbnVtZXJhdG9yT3B0aW9ucywgZGVub21pbmF0b3JPcHRpb25zICkgKTtcclxuXHJcbiAgICAgIHF1ZXN0aW9uU2V0cy5wdXNoKCBxdWVzdGlvbnMgKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICByZXR1cm4gcXVlc3Rpb25TZXRzO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIGEgcXVlc3Rpb24gb2YgdGhlIGZvcm0gJ0Nvc3Qgb2YgMTAgQXBwbGVzPycgb3IgJ0Nvc3Qgb2YgMi4yIHBvdW5kcz8nXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBkZW5vbWluYXRvclxyXG4gKiBAcGFyYW0ge251bWJlcn0gdW5pdFJhdGVcclxuICogQHBhcmFtIHtzdHJpbmd9IHNpbmd1bGFyVW5pdHMgLSBkZW5vbWluYXRvciB1bml0cyB0byB1c2UgZm9yIHF1ZXN0aW9ucyB3aXRoIHNpbmd1bGFyIHF1YW50aXRpZXNcclxuICogQHBhcmFtIHtzdHJpbmd9IHBsdXJhbFVuaXRzIC0gZGVub21pbmF0b3IgdW5pdHMgdG8gdXNlIGZvciBxdWVzdGlvbnMgd2l0aCBwbHVyYWwgcXVhbnRpdGllc1xyXG4gKiBAcGFyYW0ge09iamVjdH0gbnVtZXJhdG9yT3B0aW9ucyAtIHNlZSBTaG9wcGluZ0l0ZW0gb3B0aW9ucy5udW1lcmF0b3JPcHRpb25zXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBkZW5vbWluYXRvck9wdGlvbnMgLSBzZWUgU2hvcHBpbmdJdGVtIG9wdGlvbnMuZGVub21pbmF0b3JPcHRpb25zXHJcbiAqIEByZXR1cm5zIHtTaG9wcGluZ1F1ZXN0aW9ufVxyXG4gKi9cclxuZnVuY3Rpb24gY3JlYXRlQ29zdE9mUXVlc3Rpb24oIGRlbm9taW5hdG9yLCB1bml0UmF0ZSwgc2luZ3VsYXJVbml0cywgcGx1cmFsVW5pdHMsIG51bWVyYXRvck9wdGlvbnMsIGRlbm9taW5hdG9yT3B0aW9ucyApIHtcclxuXHJcbiAgLy8gYW5zd2VyXHJcbiAgY29uc3QgbnVtZXJhdG9yID0gZGVub21pbmF0b3IgKiB1bml0UmF0ZTtcclxuICBjb25zdCBhbnN3ZXIgPSBVdGlscy50b0ZpeGVkTnVtYmVyKCBudW1lcmF0b3IsIG51bWVyYXRvck9wdGlvbnMubWF4RGVjaW1hbHMgKTtcclxuXHJcbiAgLy8gJ0FwcGxlcycgb3IgJ0FwcGxlJ1xyXG4gIGNvbnN0IHVuaXRzID0gKCBkZW5vbWluYXRvciA+IDEgKSA/IHBsdXJhbFVuaXRzIDogc2luZ3VsYXJVbml0cztcclxuXHJcbiAgLy8gJyQzLjAwJ1xyXG4gIGNvbnN0IG51bWVyYXRvclN0cmluZyA9IFN0cmluZ1V0aWxzLmZvcm1hdCggVW5pdFJhdGVzU3RyaW5ncy5wYXR0ZXJuXzBjb3N0LFxyXG4gICAgVVJVdGlscy5udW1iZXJUb1N0cmluZyggbnVtZXJhdG9yLCBudW1lcmF0b3JPcHRpb25zLm1heERlY2ltYWxzLCBudW1lcmF0b3JPcHRpb25zLnRyaW1aZXJvcyApICk7XHJcblxyXG4gIC8vICcxMCBBcHBsZXMnXHJcbiAgY29uc3QgZGVub21pbmF0b3JTdHJpbmcgPSBTdHJpbmdVdGlscy5mb3JtYXQoIFVuaXRSYXRlc1N0cmluZ3MucGF0dGVybl8wdmFsdWVfMXVuaXRzLFxyXG4gICAgVVJVdGlscy5udW1iZXJUb1N0cmluZyggZGVub21pbmF0b3IsIGRlbm9taW5hdG9yT3B0aW9ucy5tYXhEZWNpbWFscywgZGVub21pbmF0b3JPcHRpb25zLnRyaW1aZXJvcyApLFxyXG4gICAgdW5pdHMgKTtcclxuXHJcbiAgLy8gJ0Nvc3Qgb2YgMTAgQXBwbGVzPydcclxuICBjb25zdCBxdWVzdGlvblN0cmluZyA9IFN0cmluZ1V0aWxzLmZvcm1hdCggVW5pdFJhdGVzU3RyaW5ncy5wYXR0ZXJuX2Nvc3RPZl8wcXVhbnRpdHlfMXVuaXRzLFxyXG4gICAgVVJVdGlscy5udW1iZXJUb1N0cmluZyggZGVub21pbmF0b3IsIGRlbm9taW5hdG9yT3B0aW9ucy5tYXhEZWNpbWFscywgZGVub21pbmF0b3JPcHRpb25zLnRyaW1aZXJvcyApLFxyXG4gICAgdW5pdHMgKTtcclxuXHJcbiAgcmV0dXJuIG5ldyBTaG9wcGluZ1F1ZXN0aW9uKCBxdWVzdGlvblN0cmluZywgYW5zd2VyLCBudW1lcmF0b3IsIGRlbm9taW5hdG9yLCBudW1lcmF0b3JTdHJpbmcsIGRlbm9taW5hdG9yU3RyaW5nLCBudW1lcmF0b3JPcHRpb25zICk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIGEgcXVlc3Rpb24gb2YgdGhlIGZvcm0gJ0FwcGxlcyBmb3IgJDMuMDA/J1xyXG4gKiBAcGFyYW0ge251bWJlcn0gZGVub21pbmF0b3JcclxuICogQHBhcmFtIHtudW1iZXJ9IHVuaXRSYXRlXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzaW5ndWxhclVuaXRzXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwbHVyYWxVbml0c1xyXG4gKiBAcGFyYW0ge3N0cmluZ30gYW1vdW50T2ZRdWVzdGlvblVuaXRzIC0gdW5pdHMgdXNlZCBmb3IgXCJBcHBsZXMgZm9yICQxMC4wMD9cIiB0eXBlIHF1ZXN0aW9uc1xyXG4gKiBAcGFyYW0ge09iamVjdH0gbnVtZXJhdG9yT3B0aW9ucyAtIHNlZSBTaG9wcGluZ0l0ZW0gb3B0aW9ucy5udW1lcmF0b3JPcHRpb25zXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBkZW5vbWluYXRvck9wdGlvbnMgLSBzZWUgU2hvcHBpbmdJdGVtIG9wdGlvbnMuZGVub21pbmF0b3JPcHRpb25zXHJcbiAqIEByZXR1cm5zIHtTaG9wcGluZ1F1ZXN0aW9ufVxyXG4gKi9cclxuZnVuY3Rpb24gY3JlYXRlSXRlbXNGb3JRdWVzdGlvbiggZGVub21pbmF0b3IsIHVuaXRSYXRlLCBzaW5ndWxhclVuaXRzLCBwbHVyYWxVbml0cywgYW1vdW50T2ZRdWVzdGlvblVuaXRzLCBudW1lcmF0b3JPcHRpb25zLCBkZW5vbWluYXRvck9wdGlvbnMgKSB7XHJcblxyXG4gIC8vIGFuc3dlclxyXG4gIGNvbnN0IGFuc3dlciA9IFV0aWxzLnRvRml4ZWROdW1iZXIoIGRlbm9taW5hdG9yLCBkZW5vbWluYXRvck9wdGlvbnMubWF4RGVjaW1hbHMgKTtcclxuXHJcbiAgLy8gJ0FwcGxlcycgb3IgJ0FwcGxlJ1xyXG4gIGNvbnN0IHVuaXRzID0gKCBkZW5vbWluYXRvciA+IDEgKSA/IHBsdXJhbFVuaXRzIDogc2luZ3VsYXJVbml0cztcclxuXHJcbiAgLy8gJyQ0LjAwJ1xyXG4gIGNvbnN0IG51bWVyYXRvciA9IGRlbm9taW5hdG9yICogdW5pdFJhdGU7XHJcbiAgY29uc3QgbnVtZXJhdG9yU3RyaW5nID0gU3RyaW5nVXRpbHMuZm9ybWF0KCBVbml0UmF0ZXNTdHJpbmdzLnBhdHRlcm5fMGNvc3QsXHJcbiAgICBVUlV0aWxzLm51bWJlclRvU3RyaW5nKCBudW1lcmF0b3IsIG51bWVyYXRvck9wdGlvbnMubWF4RGVjaW1hbHMsIG51bWVyYXRvck9wdGlvbnMudHJpbVplcm9zICkgKTtcclxuXHJcbiAgLy8gJzggQXBwbGVzJ1xyXG4gIGNvbnN0IGRlbm9taW5hdG9yU3RyaW5nID0gU3RyaW5nVXRpbHMuZm9ybWF0KCBVbml0UmF0ZXNTdHJpbmdzLnBhdHRlcm5fMHZhbHVlXzF1bml0cyxcclxuICAgIFVSVXRpbHMubnVtYmVyVG9TdHJpbmcoIGRlbm9taW5hdG9yLCBkZW5vbWluYXRvck9wdGlvbnMubWF4RGVjaW1hbHMsIGRlbm9taW5hdG9yT3B0aW9ucy50cmltWmVyb3MgKSxcclxuICAgIHVuaXRzICk7XHJcblxyXG4gIC8vICdBcHBsZXMgZm9yICQ0LjAwPydcclxuICBjb25zdCBxdWVzdGlvblN0cmluZyA9IFN0cmluZ1V0aWxzLmZvcm1hdCggVW5pdFJhdGVzU3RyaW5ncy5wYXR0ZXJuXzBpdGVtc18xY29zdCxcclxuICAgIGFtb3VudE9mUXVlc3Rpb25Vbml0cyxcclxuICAgIFVSVXRpbHMubnVtYmVyVG9TdHJpbmcoIG51bWVyYXRvciwgbnVtZXJhdG9yT3B0aW9ucy5tYXhEZWNpbWFscywgbnVtZXJhdG9yT3B0aW9ucy50cmltWmVyb3MgKSApO1xyXG5cclxuICByZXR1cm4gbmV3IFNob3BwaW5nUXVlc3Rpb24oIHF1ZXN0aW9uU3RyaW5nLCBhbnN3ZXIsIG51bWVyYXRvciwgZGVub21pbmF0b3IsIG51bWVyYXRvclN0cmluZywgZGVub21pbmF0b3JTdHJpbmcsIGRlbm9taW5hdG9yT3B0aW9ucyApO1xyXG59XHJcblxyXG51bml0UmF0ZXMucmVnaXN0ZXIoICdTaG9wcGluZ1F1ZXN0aW9uRmFjdG9yeScsIFNob3BwaW5nUXVlc3Rpb25GYWN0b3J5ICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBTaG9wcGluZ1F1ZXN0aW9uRmFjdG9yeTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsS0FBSyxNQUFNLDZCQUE2QjtBQUMvQyxPQUFPQyxXQUFXLE1BQU0s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