// Copyright 2018-2023, University of Colorado Boulder

/**
 * ConcentrationControl is actually a set of NumberControls, one for each solute.  Since each solute has its
 * own concentration, range, and associated color, it is (as of this writing) impossible to use a single NumberControl.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import BooleanProperty from '../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import DynamicProperty from '../../../../axon/js/DynamicProperty.js';
import Property from '../../../../axon/js/Property.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import Range from '../../../../dot/js/Range.js';
import Utils from '../../../../dot/js/Utils.js';
import optionize from '../../../../phet-core/js/optionize.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import NumberControl from '../../../../scenery-phet/js/NumberControl.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { HBox, HStrut, LinearGradient, Node, Text } from '../../../../scenery/js/imports.js';
import SunConstants from '../../../../sun/js/SunConstants.js';
import Tandem from '../../../../tandem/js/Tandem.js';
import StringIO from '../../../../tandem/js/types/StringIO.js';
import beersLawLab from '../../beersLawLab.js';
import BeersLawLabStrings from '../../BeersLawLabStrings.js';
// constants
const FONT = new PhetFont(20);
const TICK_FONT = new PhetFont(16);
const SLIDER_INTERVAL = 5; // in view units

export default class ConcentrationControl extends Node {
  constructor(solutions, solutionProperty, concentrationProperty, providedOptions) {
    const options = optionize()({
      // empty optionize because we're setting options.children below
    }, providedOptions);

    // Concentration:
    const labelStringProperty = new DerivedProperty([BeersLawLabStrings.pattern['0labelStringProperty'], BeersLawLabStrings.concentrationStringProperty], (pattern, concentrationString) => StringUtils.format(pattern, concentrationString), {
      tandem: options.tandem.createTandem('labelStringProperty'),
      phetioValueType: StringIO
    });

    // Whether concentration is editable. If false, hides the slider and arrow buttons. For PHET-iO only.
    const displayOnlyProperty = new BooleanProperty(false, {
      tandem: options.tandem.createTandem('displayOnlyProperty'),
      phetioDocumentation: 'Setting this to true will hide the slider and arrow buttons, showing only the value.'
    });

    // 1 control for each solution, with mutually-exclusive visibility
    options.children = solutions.map(solution => new SoluteConcentrationControl(labelStringProperty, solution, displayOnlyProperty, {
      visibleProperty: new DerivedProperty([solutionProperty], solutionValue => solutionValue === solution)
    }));
    super(options);

    // concentrationProperty is unused in this class, and provided only so that it can be linked for PhET-iO.
    this.addLinkedElement(concentrationProperty, {
      tandem: options.tandem.createTandem(concentrationProperty.tandem.name)
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
}

/**
 * SoluteConcentrationControl is the NumberControl used to set concentration for one specific solute.
 */

class SoluteConcentrationControl extends NumberControl {
  constructor(labelStringProperty, solution, displayOnlyProperty, providedOptions) {
    const options = optionize()({
      // NumberControl options
      titleNodeOptions: {
        font: FONT
      },
      numberDisplayOptions: {
        textOptions: {
          font: FONT
        },
        minBackgroundWidth: 95 // determined empirically
      },

      arrowButtonOptions: {
        visibleProperty: DerivedProperty.not(displayOnlyProperty),
        scale: 1,
        touchAreaXDilation: 8,
        touchAreaYDilation: 15
      },
      // Slider options, passed through by NumberControl
      sliderOptions: {
        visibleProperty: DerivedProperty.not(displayOnlyProperty),
        trackSize: new Dimension2(200, 15),
        thumbSize: new Dimension2(22, 45),
        constrainValue: value => Utils.roundToInterval(value, SLIDER_INTERVAL),
        tandem: Tandem.OPT_OUT
      },
      // single-line horizontal layout
      layoutFunction: (titleNode, numberDisplay, slider, leftArrowButton, rightArrowButton) => {
        assert && assert(leftArrowButton && rightArrowButton);
        return new HBox({
          spacing: 5,
          children: [titleNode, numberDisplay, new HStrut(5), leftArrowButton, slider, rightArrowButton]
        });
      },
      tandem: Tandem.OPT_OUT // see https://github.com/phetsims/beers-law-lab/issues/270
    }, providedOptions);
    const transform = solution.concentrationTransform;

    // e.g. display units that are specific to the solution, e.g. '{0} mM'
    assert && assert(!options.numberDisplayOptions.valuePattern, 'ConcentrationControl sets valuePattern');
    options.numberDisplayOptions.valuePattern = new DerivedProperty([BeersLawLabStrings.pattern['0value']['1unitsStringProperty'], transform.unitsStringProperty], (pattern, unitsString) => StringUtils.format(pattern, SunConstants.VALUE_NUMBERED_PLACEHOLDER, unitsString));
    assert && assert(options.delta === undefined, 'ConcentrationControl sets delta');
    options.delta = 1; // in view coordinates

    // fill the track with a linear gradient that corresponds to the solution color
    const trackSize = options.sliderOptions.trackSize;
    assert && assert(trackSize);
    assert && assert(!options.sliderOptions.trackFillEnabled, 'ConcentrationControl sets trackFillEnabled');
    options.sliderOptions.trackFillEnabled = new LinearGradient(0, 0, trackSize.width, 0).addColorStop(0, solution.colorRange.min).addColorStop(1, solution.colorRange.max);

    // map concentration value between model and view
    const numberProperty = new DynamicProperty(new Property(solution.concentrationProperty), {
      bidirectional: true,
      // Necessary because bidirectional:true
      reentrant: true,
      // map from model to view, apply options.interval to model value
      map: value => transform.modelToView(value),
      // map from view to model, apply options.interval to model value
      inverseMap: value => transform.viewToModel(value)
    });

    // convert solution's concentration range from model to view
    const concentrationRange = solution.concentrationProperty.range;
    const numberRange = new Range(transform.modelToView(concentrationRange.min), transform.modelToView(concentrationRange.max));

    // ticks at the min and max of the solution's concentration range
    assert && assert(!options.sliderOptions.majorTicks, 'ConcentrationControl sets majorTicks');
    options.sliderOptions.majorTicks = [{
      value: numberRange.min,
      label: new Text(numberRange.min, {
        font: TICK_FONT
        // No PhET-iO instrumentation is desired.
      })
    }, {
      value: numberRange.max,
      label: new Text(numberRange.max, {
        font: TICK_FONT
        // No PhET-iO instrumentation is desired.
      })
    }];

    super(labelStringProperty, numberProperty, numberRange, options);
    this.solution = solution;
    this.addLinkedElement(solution.concentrationProperty, {
      tandem: options.tandem.createTandem(solution.concentrationProperty.tandem.name)
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
}
beersLawLab.register('ConcentrationControl', ConcentrationControl);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJEeW5hbWljUHJvcGVydHkiLCJQcm9wZXJ0eSIsIkRpbWVuc2lvbjIiLCJSYW5nZSIsIlV0aWxzIiwib3B0aW9uaXplIiwiU3RyaW5nVXRpbHMiLCJOdW1iZXJDb250cm9sIiwiUGhldEZvbnQiLCJIQm94IiwiSFN0cnV0IiwiTGluZWFyR3JhZGllbnQiLCJOb2RlIiwiVGV4dCIsIlN1bkNvbnN0YW50cyIsIlRhbmRlbSIsIlN0cmluZ0lPIiwiYmVlcnNMYXdMYWIiLCJCZWVyc0xhd0xhYlN0cmluZ3MiLCJGT05UIiwiVElDS19GT05UIiwiU0xJREVSX0lOVEVSVkFMIiwiQ29uY2VudHJhdGlvbkNvbnRyb2wiLCJjb25zdHJ1Y3RvciIsInNvbHV0aW9ucyIsInNvbHV0aW9uUHJvcGVydHkiLCJjb25jZW50cmF0aW9uUHJvcGVydHkiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwibGFiZWxTdHJpbmdQcm9wZXJ0eSIsInBhdHRlcm4iLCJjb25jZW50cmF0aW9uU3RyaW5nUHJvcGVydHkiLCJjb25jZW50cmF0aW9uU3RyaW5nIiwiZm9ybWF0IiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwicGhldGlvVmFsdWVUeXBlIiwiZGlzcGxheU9ubHlQcm9wZXJ0eSIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJjaGlsZHJlbiIsIm1hcCIsInNvbHV0aW9uIiwiU29sdXRlQ29uY2VudHJhdGlvbkNvbnRyb2wiLCJ2aXNpYmxlUHJvcGVydHkiLCJzb2x1dGlvblZhbHVlIiwiYWRkTGlua2VkRWxlbWVudCIsIm5hbWUiLCJkaXNwb3NlIiwiYXNzZXJ0IiwidGl0bGVOb2RlT3B0aW9ucyIsImZvbnQiLCJudW1iZXJEaXNwbGF5T3B0aW9ucyIsInRleHRPcHRpb25zIiwibWluQmFja2dyb3VuZFdpZHRoIiwiYXJyb3dCdXR0b25PcHRpb25zIiwibm90Iiwic2NhbGUiLCJ0b3VjaEFyZWFYRGlsYXRpb24iLCJ0b3VjaEFyZWFZRGlsYXRpb24iLCJzbGlkZXJPcHRpb25zIiwidHJhY2tTaXplIiwidGh1bWJTaXplIiwiY29uc3RyYWluVmFsdWUiLCJ2YWx1ZSIsInJvdW5kVG9JbnRlcnZhbCIsIk9QVF9PVVQiLCJsYXlvdXRGdW5jdGlvbiIsInRpdGxlTm9kZSIsIm51bWJlckRpc3BsYXkiLCJzbGlkZXIiLCJsZWZ0QXJyb3dCdXR0b24iLCJyaWdodEFycm93QnV0dG9uIiwic3BhY2luZyIsInRyYW5zZm9ybSIsImNvbmNlbnRyYXRpb25UcmFuc2Zvcm0iLCJ2YWx1ZVBhdHRlcm4iLCJ1bml0c1N0cmluZ1Byb3BlcnR5IiwidW5pdHNTdHJpbmciLCJWQUxVRV9OVU1CRVJFRF9QTEFDRUhPTERFUiIsImRlbHRhIiwidW5kZWZpbmVkIiwidHJhY2tGaWxsRW5hYmxlZCIsIndpZHRoIiwiYWRkQ29sb3JTdG9wIiwiY29sb3JSYW5nZSIsIm1pbiIsIm1heCIsIm51bWJlclByb3BlcnR5IiwiYmlkaXJlY3Rpb25hbCIsInJlZW50cmFudCIsIm1vZGVsVG9WaWV3IiwiaW52ZXJzZU1hcCIsInZpZXdUb01vZGVsIiwiY29uY2VudHJhdGlvblJhbmdlIiwicmFuZ2UiLCJudW1iZXJSYW5nZSIsIm1ham9yVGlja3MiLCJsYWJlbCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQ29uY2VudHJhdGlvbkNvbnRyb2wudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQ29uY2VudHJhdGlvbkNvbnRyb2wgaXMgYWN0dWFsbHkgYSBzZXQgb2YgTnVtYmVyQ29udHJvbHMsIG9uZSBmb3IgZWFjaCBzb2x1dGUuICBTaW5jZSBlYWNoIHNvbHV0ZSBoYXMgaXRzXHJcbiAqIG93biBjb25jZW50cmF0aW9uLCByYW5nZSwgYW5kIGFzc29jaWF0ZWQgY29sb3IsIGl0IGlzIChhcyBvZiB0aGlzIHdyaXRpbmcpIGltcG9zc2libGUgdG8gdXNlIGEgc2luZ2xlIE51bWJlckNvbnRyb2wuXHJcbiAqXHJcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXHJcbiAqL1xyXG5cclxuaW1wb3J0IEJvb2xlYW5Qcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL0Jvb2xlYW5Qcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgRHluYW1pY1Byb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvRHluYW1pY1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1JlYWRPbmx5UHJvcGVydHkuanMnO1xyXG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XHJcbmltcG9ydCBEaW1lbnNpb24yIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9EaW1lbnNpb24yLmpzJztcclxuaW1wb3J0IFJhbmdlIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9SYW5nZS5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgb3B0aW9uaXplLCB7IEVtcHR5U2VsZk9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcclxuaW1wb3J0IFBpY2tSZXF1aXJlZCBmcm9tICcuLi8uLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvUGlja1JlcXVpcmVkLmpzJztcclxuaW1wb3J0IFN0cmluZ1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL3BoZXRjb21tb24vanMvdXRpbC9TdHJpbmdVdGlscy5qcyc7XHJcbmltcG9ydCBOdW1iZXJDb250cm9sLCB7IE51bWJlckNvbnRyb2xPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL051bWJlckNvbnRyb2wuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgSEJveCwgSFN0cnV0LCBMaW5lYXJHcmFkaWVudCwgTm9kZSwgTm9kZU9wdGlvbnMsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgU3VuQ29uc3RhbnRzIGZyb20gJy4uLy4uLy4uLy4uL3N1bi9qcy9TdW5Db25zdGFudHMuanMnO1xyXG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xyXG5pbXBvcnQgU3RyaW5nSU8gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL1N0cmluZ0lPLmpzJztcclxuaW1wb3J0IGJlZXJzTGF3TGFiIGZyb20gJy4uLy4uL2JlZXJzTGF3TGFiLmpzJztcclxuaW1wb3J0IEJlZXJzTGF3TGFiU3RyaW5ncyBmcm9tICcuLi8uLi9CZWVyc0xhd0xhYlN0cmluZ3MuanMnO1xyXG5pbXBvcnQgQmVlcnNMYXdTb2x1dGlvbiBmcm9tICcuLi9tb2RlbC9CZWVyc0xhd1NvbHV0aW9uLmpzJztcclxuXHJcbi8vIGNvbnN0YW50c1xyXG5jb25zdCBGT05UID0gbmV3IFBoZXRGb250KCAyMCApO1xyXG5jb25zdCBUSUNLX0ZPTlQgPSBuZXcgUGhldEZvbnQoIDE2ICk7XHJcbmNvbnN0IFNMSURFUl9JTlRFUlZBTCA9IDU7IC8vIGluIHZpZXcgdW5pdHNcclxuXHJcbnR5cGUgU2VsZk9wdGlvbnMgPSBFbXB0eVNlbGZPcHRpb25zO1xyXG5cclxudHlwZSBDb25jZW50cmF0aW9uQ29udHJvbE9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxOdW1iZXJDb250cm9sT3B0aW9ucywgJ3RhbmRlbSc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29uY2VudHJhdGlvbkNvbnRyb2wgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBzb2x1dGlvbnM6IEJlZXJzTGF3U29sdXRpb25bXSxcclxuICAgICAgICAgICAgICAgICAgICAgIHNvbHV0aW9uUHJvcGVydHk6IFByb3BlcnR5PEJlZXJzTGF3U29sdXRpb24+LFxyXG4gICAgICAgICAgICAgICAgICAgICAgY29uY2VudHJhdGlvblByb3BlcnR5OiBSZWFkT25seVByb3BlcnR5PG51bWJlcj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnM6IENvbmNlbnRyYXRpb25Db250cm9sT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPENvbmNlbnRyYXRpb25Db250cm9sT3B0aW9ucywgU2VsZk9wdGlvbnMsIE5vZGVPcHRpb25zPigpKCB7XHJcbiAgICAgIC8vIGVtcHR5IG9wdGlvbml6ZSBiZWNhdXNlIHdlJ3JlIHNldHRpbmcgb3B0aW9ucy5jaGlsZHJlbiBiZWxvd1xyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgLy8gQ29uY2VudHJhdGlvbjpcclxuICAgIGNvbnN0IGxhYmVsU3RyaW5nUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxyXG4gICAgICBbIEJlZXJzTGF3TGFiU3RyaW5ncy5wYXR0ZXJuWyAnMGxhYmVsU3RyaW5nUHJvcGVydHknIF0sIEJlZXJzTGF3TGFiU3RyaW5ncy5jb25jZW50cmF0aW9uU3RyaW5nUHJvcGVydHkgXSxcclxuICAgICAgKCBwYXR0ZXJuLCBjb25jZW50cmF0aW9uU3RyaW5nICkgPT4gU3RyaW5nVXRpbHMuZm9ybWF0KCBwYXR0ZXJuLCBjb25jZW50cmF0aW9uU3RyaW5nICksIHtcclxuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2xhYmVsU3RyaW5nUHJvcGVydHknICksXHJcbiAgICAgICAgcGhldGlvVmFsdWVUeXBlOiBTdHJpbmdJT1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgLy8gV2hldGhlciBjb25jZW50cmF0aW9uIGlzIGVkaXRhYmxlLiBJZiBmYWxzZSwgaGlkZXMgdGhlIHNsaWRlciBhbmQgYXJyb3cgYnV0dG9ucy4gRm9yIFBIRVQtaU8gb25seS5cclxuICAgIGNvbnN0IGRpc3BsYXlPbmx5UHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2Rpc3BsYXlPbmx5UHJvcGVydHknICksXHJcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdTZXR0aW5nIHRoaXMgdG8gdHJ1ZSB3aWxsIGhpZGUgdGhlIHNsaWRlciBhbmQgYXJyb3cgYnV0dG9ucywgc2hvd2luZyBvbmx5IHRoZSB2YWx1ZS4nXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gMSBjb250cm9sIGZvciBlYWNoIHNvbHV0aW9uLCB3aXRoIG11dHVhbGx5LWV4Y2x1c2l2ZSB2aXNpYmlsaXR5XHJcbiAgICBvcHRpb25zLmNoaWxkcmVuID0gc29sdXRpb25zLm1hcCggc29sdXRpb24gPT5cclxuICAgICAgbmV3IFNvbHV0ZUNvbmNlbnRyYXRpb25Db250cm9sKCBsYWJlbFN0cmluZ1Byb3BlcnR5LCBzb2x1dGlvbiwgZGlzcGxheU9ubHlQcm9wZXJ0eSwge1xyXG4gICAgICAgIHZpc2libGVQcm9wZXJ0eTogbmV3IERlcml2ZWRQcm9wZXJ0eSggWyBzb2x1dGlvblByb3BlcnR5IF0sIHNvbHV0aW9uVmFsdWUgPT4gKCBzb2x1dGlvblZhbHVlID09PSBzb2x1dGlvbiApIClcclxuICAgICAgfSApXHJcbiAgICApO1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgLy8gY29uY2VudHJhdGlvblByb3BlcnR5IGlzIHVudXNlZCBpbiB0aGlzIGNsYXNzLCBhbmQgcHJvdmlkZWQgb25seSBzbyB0aGF0IGl0IGNhbiBiZSBsaW5rZWQgZm9yIFBoRVQtaU8uXHJcbiAgICB0aGlzLmFkZExpbmtlZEVsZW1lbnQoIGNvbmNlbnRyYXRpb25Qcm9wZXJ0eSwge1xyXG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggY29uY2VudHJhdGlvblByb3BlcnR5LnRhbmRlbS5uYW1lIClcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogU29sdXRlQ29uY2VudHJhdGlvbkNvbnRyb2wgaXMgdGhlIE51bWJlckNvbnRyb2wgdXNlZCB0byBzZXQgY29uY2VudHJhdGlvbiBmb3Igb25lIHNwZWNpZmljIHNvbHV0ZS5cclxuICovXHJcblxyXG50eXBlIFNvbHV0ZUNvbmNlbnRyYXRpb25Db250cm9sU2VsZk9wdGlvbnMgPSBFbXB0eVNlbGZPcHRpb25zO1xyXG5cclxudHlwZSBTb2x1dGVDb25jZW50cmF0aW9uQ29udHJvbE9wdGlvbnMgPSBTb2x1dGVDb25jZW50cmF0aW9uQ29udHJvbFNlbGZPcHRpb25zICYgUGlja1JlcXVpcmVkPE51bWJlckNvbnRyb2xPcHRpb25zLCAndmlzaWJsZVByb3BlcnR5Jz47XHJcblxyXG5jbGFzcyBTb2x1dGVDb25jZW50cmF0aW9uQ29udHJvbCBleHRlbmRzIE51bWJlckNvbnRyb2wge1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgc29sdXRpb246IEJlZXJzTGF3U29sdXRpb247XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggbGFiZWxTdHJpbmdQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8c3RyaW5nPixcclxuICAgICAgICAgICAgICAgICAgICAgIHNvbHV0aW9uOiBCZWVyc0xhd1NvbHV0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU9ubHlQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4sXHJcbiAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZE9wdGlvbnM6IFNvbHV0ZUNvbmNlbnRyYXRpb25Db250cm9sT3B0aW9ucyApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFNvbHV0ZUNvbmNlbnRyYXRpb25Db250cm9sT3B0aW9ucywgU29sdXRlQ29uY2VudHJhdGlvbkNvbnRyb2xTZWxmT3B0aW9ucywgTnVtYmVyQ29udHJvbE9wdGlvbnM+KCkoIHtcclxuXHJcbiAgICAgIC8vIE51bWJlckNvbnRyb2wgb3B0aW9uc1xyXG4gICAgICB0aXRsZU5vZGVPcHRpb25zOiB7XHJcbiAgICAgICAgZm9udDogRk9OVFxyXG4gICAgICB9LFxyXG4gICAgICBudW1iZXJEaXNwbGF5T3B0aW9uczoge1xyXG4gICAgICAgIHRleHRPcHRpb25zOiB7XHJcbiAgICAgICAgICBmb250OiBGT05UXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtaW5CYWNrZ3JvdW5kV2lkdGg6IDk1IC8vIGRldGVybWluZWQgZW1waXJpY2FsbHlcclxuICAgICAgfSxcclxuICAgICAgYXJyb3dCdXR0b25PcHRpb25zOiB7XHJcbiAgICAgICAgdmlzaWJsZVByb3BlcnR5OiBEZXJpdmVkUHJvcGVydHkubm90KCBkaXNwbGF5T25seVByb3BlcnR5ICksXHJcbiAgICAgICAgc2NhbGU6IDEsXHJcbiAgICAgICAgdG91Y2hBcmVhWERpbGF0aW9uOiA4LFxyXG4gICAgICAgIHRvdWNoQXJlYVlEaWxhdGlvbjogMTVcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIFNsaWRlciBvcHRpb25zLCBwYXNzZWQgdGhyb3VnaCBieSBOdW1iZXJDb250cm9sXHJcbiAgICAgIHNsaWRlck9wdGlvbnM6IHtcclxuICAgICAgICB2aXNpYmxlUHJvcGVydHk6IERlcml2ZWRQcm9wZXJ0eS5ub3QoIGRpc3BsYXlPbmx5UHJvcGVydHkgKSxcclxuICAgICAgICB0cmFja1NpemU6IG5ldyBEaW1lbnNpb24yKCAyMDAsIDE1ICksXHJcbiAgICAgICAgdGh1bWJTaXplOiBuZXcgRGltZW5zaW9uMiggMjIsIDQ1ICksXHJcbiAgICAgICAgY29uc3RyYWluVmFsdWU6IHZhbHVlID0+IFV0aWxzLnJvdW5kVG9JbnRlcnZhbCggdmFsdWUsIFNMSURFUl9JTlRFUlZBTCApLFxyXG4gICAgICAgIHRhbmRlbTogVGFuZGVtLk9QVF9PVVRcclxuICAgICAgfSxcclxuXHJcbiAgICAgIC8vIHNpbmdsZS1saW5lIGhvcml6b250YWwgbGF5b3V0XHJcbiAgICAgIGxheW91dEZ1bmN0aW9uOiAoIHRpdGxlTm9kZSwgbnVtYmVyRGlzcGxheSwgc2xpZGVyLCBsZWZ0QXJyb3dCdXR0b24sIHJpZ2h0QXJyb3dCdXR0b24gKSA9PiB7XHJcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggbGVmdEFycm93QnV0dG9uICYmIHJpZ2h0QXJyb3dCdXR0b24gKTtcclxuICAgICAgICByZXR1cm4gbmV3IEhCb3goIHtcclxuICAgICAgICAgIHNwYWNpbmc6IDUsXHJcbiAgICAgICAgICBjaGlsZHJlbjogWyB0aXRsZU5vZGUsIG51bWJlckRpc3BsYXksIG5ldyBIU3RydXQoIDUgKSwgbGVmdEFycm93QnV0dG9uISwgc2xpZGVyLCByaWdodEFycm93QnV0dG9uISBdXHJcbiAgICAgICAgfSApO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgdGFuZGVtOiBUYW5kZW0uT1BUX09VVCAvLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2JlZXJzLWxhdy1sYWIvaXNzdWVzLzI3MFxyXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgdHJhbnNmb3JtID0gc29sdXRpb24uY29uY2VudHJhdGlvblRyYW5zZm9ybTtcclxuXHJcbiAgICAvLyBlLmcuIGRpc3BsYXkgdW5pdHMgdGhhdCBhcmUgc3BlY2lmaWMgdG8gdGhlIHNvbHV0aW9uLCBlLmcuICd7MH0gbU0nXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhb3B0aW9ucy5udW1iZXJEaXNwbGF5T3B0aW9ucy52YWx1ZVBhdHRlcm4sICdDb25jZW50cmF0aW9uQ29udHJvbCBzZXRzIHZhbHVlUGF0dGVybicgKTtcclxuICAgIG9wdGlvbnMubnVtYmVyRGlzcGxheU9wdGlvbnMudmFsdWVQYXR0ZXJuID0gbmV3IERlcml2ZWRQcm9wZXJ0eShcclxuICAgICAgWyBCZWVyc0xhd0xhYlN0cmluZ3MucGF0dGVyblsgJzB2YWx1ZScgXVsgJzF1bml0c1N0cmluZ1Byb3BlcnR5JyBdLCB0cmFuc2Zvcm0udW5pdHNTdHJpbmdQcm9wZXJ0eSBdLFxyXG4gICAgICAoIHBhdHRlcm4sIHVuaXRzU3RyaW5nICkgPT4gU3RyaW5nVXRpbHMuZm9ybWF0KCBwYXR0ZXJuLCBTdW5Db25zdGFudHMuVkFMVUVfTlVNQkVSRURfUExBQ0VIT0xERVIsIHVuaXRzU3RyaW5nIClcclxuICAgICk7XHJcblxyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggb3B0aW9ucy5kZWx0YSA9PT0gdW5kZWZpbmVkLCAnQ29uY2VudHJhdGlvbkNvbnRyb2wgc2V0cyBkZWx0YScgKTtcclxuICAgIG9wdGlvbnMuZGVsdGEgPSAxOyAvLyBpbiB2aWV3IGNvb3JkaW5hdGVzXHJcblxyXG4gICAgLy8gZmlsbCB0aGUgdHJhY2sgd2l0aCBhIGxpbmVhciBncmFkaWVudCB0aGF0IGNvcnJlc3BvbmRzIHRvIHRoZSBzb2x1dGlvbiBjb2xvclxyXG4gICAgY29uc3QgdHJhY2tTaXplID0gb3B0aW9ucy5zbGlkZXJPcHRpb25zLnRyYWNrU2l6ZSE7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0cmFja1NpemUgKTtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoICFvcHRpb25zLnNsaWRlck9wdGlvbnMudHJhY2tGaWxsRW5hYmxlZCwgJ0NvbmNlbnRyYXRpb25Db250cm9sIHNldHMgdHJhY2tGaWxsRW5hYmxlZCcgKTtcclxuICAgIG9wdGlvbnMuc2xpZGVyT3B0aW9ucy50cmFja0ZpbGxFbmFibGVkID0gbmV3IExpbmVhckdyYWRpZW50KCAwLCAwLCB0cmFja1NpemUud2lkdGgsIDAgKVxyXG4gICAgICAuYWRkQ29sb3JTdG9wKCAwLCBzb2x1dGlvbi5jb2xvclJhbmdlLm1pbiApXHJcbiAgICAgIC5hZGRDb2xvclN0b3AoIDEsIHNvbHV0aW9uLmNvbG9yUmFuZ2UubWF4ICk7XHJcblxyXG4gICAgLy8gbWFwIGNvbmNlbnRyYXRpb24gdmFsdWUgYmV0d2VlbiBtb2RlbCBhbmQgdmlld1xyXG4gICAgY29uc3QgbnVtYmVyUHJvcGVydHkgPSBuZXcgRHluYW1pY1Byb3BlcnR5KCBuZXcgUHJvcGVydHkoIHNvbHV0aW9uLmNvbmNlbnRyYXRpb25Qcm9wZXJ0eSApLCB7XHJcbiAgICAgIGJpZGlyZWN0aW9uYWw6IHRydWUsXHJcblxyXG4gICAgICAvLyBOZWNlc3NhcnkgYmVjYXVzZSBiaWRpcmVjdGlvbmFsOnRydWVcclxuICAgICAgcmVlbnRyYW50OiB0cnVlLFxyXG5cclxuICAgICAgLy8gbWFwIGZyb20gbW9kZWwgdG8gdmlldywgYXBwbHkgb3B0aW9ucy5pbnRlcnZhbCB0byBtb2RlbCB2YWx1ZVxyXG4gICAgICBtYXA6ICggdmFsdWU6IG51bWJlciApID0+IHRyYW5zZm9ybS5tb2RlbFRvVmlldyggdmFsdWUgKSxcclxuXHJcbiAgICAgIC8vIG1hcCBmcm9tIHZpZXcgdG8gbW9kZWwsIGFwcGx5IG9wdGlvbnMuaW50ZXJ2YWwgdG8gbW9kZWwgdmFsdWVcclxuICAgICAgaW52ZXJzZU1hcDogKCB2YWx1ZTogbnVtYmVyICkgPT4gdHJhbnNmb3JtLnZpZXdUb01vZGVsKCB2YWx1ZSApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gY29udmVydCBzb2x1dGlvbidzIGNvbmNlbnRyYXRpb24gcmFuZ2UgZnJvbSBtb2RlbCB0byB2aWV3XHJcbiAgICBjb25zdCBjb25jZW50cmF0aW9uUmFuZ2UgPSBzb2x1dGlvbi5jb25jZW50cmF0aW9uUHJvcGVydHkucmFuZ2U7XHJcbiAgICBjb25zdCBudW1iZXJSYW5nZSA9IG5ldyBSYW5nZShcclxuICAgICAgdHJhbnNmb3JtLm1vZGVsVG9WaWV3KCBjb25jZW50cmF0aW9uUmFuZ2UubWluICksXHJcbiAgICAgIHRyYW5zZm9ybS5tb2RlbFRvVmlldyggY29uY2VudHJhdGlvblJhbmdlLm1heCApXHJcbiAgICApO1xyXG5cclxuICAgIC8vIHRpY2tzIGF0IHRoZSBtaW4gYW5kIG1heCBvZiB0aGUgc29sdXRpb24ncyBjb25jZW50cmF0aW9uIHJhbmdlXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhb3B0aW9ucy5zbGlkZXJPcHRpb25zLm1ham9yVGlja3MsICdDb25jZW50cmF0aW9uQ29udHJvbCBzZXRzIG1ham9yVGlja3MnICk7XHJcbiAgICBvcHRpb25zLnNsaWRlck9wdGlvbnMubWFqb3JUaWNrcyA9IFtcclxuICAgICAge1xyXG4gICAgICAgIHZhbHVlOiBudW1iZXJSYW5nZS5taW4sXHJcbiAgICAgICAgbGFiZWw6IG5ldyBUZXh0KCBudW1iZXJSYW5nZS5taW4sIHtcclxuICAgICAgICAgIGZvbnQ6IFRJQ0tfRk9OVFxyXG4gICAgICAgICAgLy8gTm8gUGhFVC1pTyBpbnN0cnVtZW50YXRpb24gaXMgZGVzaXJlZC5cclxuICAgICAgICB9IClcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIHZhbHVlOiBudW1iZXJSYW5nZS5tYXgsXHJcbiAgICAgICAgbGFiZWw6IG5ldyBUZXh0KCBudW1iZXJSYW5nZS5tYXgsIHtcclxuICAgICAgICAgIGZvbnQ6IFRJQ0tfRk9OVFxyXG4gICAgICAgICAgLy8gTm8gUGhFVC1pTyBpbnN0cnVtZW50YXRpb24gaXMgZGVzaXJlZC5cclxuICAgICAgICB9IClcclxuICAgICAgfVxyXG4gICAgXTtcclxuXHJcbiAgICBzdXBlciggbGFiZWxTdHJpbmdQcm9wZXJ0eSwgbnVtYmVyUHJvcGVydHksIG51bWJlclJhbmdlLCBvcHRpb25zICk7XHJcblxyXG4gICAgdGhpcy5zb2x1dGlvbiA9IHNvbHV0aW9uO1xyXG5cclxuICAgIHRoaXMuYWRkTGlua2VkRWxlbWVudCggc29sdXRpb24uY29uY2VudHJhdGlvblByb3BlcnR5LCB7XHJcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCBzb2x1dGlvbi5jb25jZW50cmF0aW9uUHJvcGVydHkudGFuZGVtLm5hbWUgKVxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmYWxzZSwgJ2Rpc3Bvc2UgaXMgbm90IHN1cHBvcnRlZCwgZXhpc3RzIGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIHNpbScgKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcbn1cclxuXHJcbmJlZXJzTGF3TGFiLnJlZ2lzdGVyKCAnQ29uY2VudHJhdGlvbkNvbnRyb2wnLCBDb25jZW50cmF0aW9uQ29udHJvbCApOyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLGVBQWUsTUFBTSx3Q0FBd0M7QUFDcEUsT0FBT0MsZUFBZSxNQUFNLHdDQUF3QztBQUNwRSxPQUFPQyxlQUFlLE1BQU0sd0NBQXdDO0FBQ3BFLE9BQU9DLFFBQVEsTUFBTSxpQ0FBaUM7QUFHdEQsT0FBT0MsVUFBVSxNQUFNLGtDQUFrQztBQUN6RCxPQUFPQyxLQUFLLE1BQU0sNkJBQTZCO0FBQy9DLE9BQU9DLEtBQUssTUFBTSw2QkFBNkI7QUFDL0MsT0FBT0MsU0FBUyxNQUE0Qix1Q0FBdUM7QUFFbkYsT0FBT0MsV0FBVyxNQUFNLCtDQUErQztBQUN2RSxPQUFPQyxhQUFhLE1BQWdDLDhDQUE4QztBQUNsRyxPQUFPQyxRQUFRLE1BQU0seUNBQXlDO0FBQzlELFNBQVNDLElBQUksRUFBRUMsTUFBTSxFQUFFQyxjQUFjLEVBQUVDLElBQUksRUFBZUMsSUFBSSxRQUFRLG1DQUFtQztBQUN6RyxPQUFPQyxZQUFZLE1BQU0sb0NBQW9DO0FBQzdELE9BQU9DLE1BQU0sTUFBTSxpQ0FBaUM7QUFDcEQsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxPQUFPQyxXQUFXLE1BQU0sc0JBQXNCO0FBQzlDLE9BQU9DLGtCQUFrQixNQUFNLDZCQUE2QjtBQUc1RDtBQUNBLE1BQU1DLElBQUksR0FBRyxJQUFJWCxRQUFRLENBQUUsRUFBRyxDQUFDO0FBQy9CLE1BQU1ZLFNBQVMsR0FBRyxJQUFJWixRQUFRLENBQUUsRUFBRyxDQUFDO0FBQ3BDLE1BQU1hLGVBQWUsR0FBRyxDQUFDLENBQUMsQ0FBQzs7QUFNM0IsZUFBZSxNQUFNQyxvQkFBb0IsU0FBU1YsSUFBSSxDQUFDO0VBRTlDVyxXQUFXQSxDQUFFQyxTQUE2QixFQUM3QkMsZ0JBQTRDLEVBQzVDQyxxQkFBK0MsRUFDL0NDLGVBQTRDLEVBQUc7SUFFakUsTUFBTUMsT0FBTyxHQUFHdkIsU0FBUyxDQUF3RCxDQUFDLENBQUU7TUFDbEY7SUFBQSxDQUNELEVBQUVzQixlQUFnQixDQUFDOztJQUVwQjtJQUNBLE1BQU1FLG1CQUFtQixHQUFHLElBQUk5QixlQUFlLENBQzdDLENBQUVtQixrQkFBa0IsQ0FBQ1ksT0FBTyxDQUFFLHNCQUFzQixDQUFFLEVBQUVaLGtCQUFrQixDQUFDYSwyQkFBMkIsQ0FBRSxFQUN4RyxDQUFFRCxPQUFPLEVBQUVFLG1CQUFtQixLQUFNMUIsV0FBVyxDQUFDMkIsTUFBTSxDQUFFSCxPQUFPLEVBQUVFLG1CQUFvQixDQUFDLEVBQUU7TUFDdEZFLE1BQU0sRUFBRU4sT0FBTyxDQUFDTSxNQUFNLENBQUNDLFlBQVksQ0FBRSxxQkFBc0IsQ0FBQztNQUM1REMsZUFBZSxFQUFFcEI7SUFDbkIsQ0FBRSxDQUFDOztJQUVMO0lBQ0EsTUFBTXFCLG1CQUFtQixHQUFHLElBQUl2QyxlQUFlLENBQUUsS0FBSyxFQUFFO01BQ3REb0MsTUFBTSxFQUFFTixPQUFPLENBQUNNLE1BQU0sQ0FBQ0MsWUFBWSxDQUFFLHFCQUFzQixDQUFDO01BQzVERyxtQkFBbUIsRUFBRTtJQUN2QixDQUFFLENBQUM7O0lBRUg7SUFDQVYsT0FBTyxDQUFDVyxRQUFRLEdBQUdmLFNBQVMsQ0FBQ2dCLEdBQUcsQ0FBRUMsUUFBUSxJQUN4QyxJQUFJQywwQkFBMEIsQ0FBRWIsbUJBQW1CLEVBQUVZLFFBQVEsRUFBRUosbUJBQW1CLEVBQUU7TUFDbEZNLGVBQWUsRUFBRSxJQUFJNUMsZUFBZSxDQUFFLENBQUUwQixnQkFBZ0IsQ0FBRSxFQUFFbUIsYUFBYSxJQUFNQSxhQUFhLEtBQUtILFFBQVc7SUFDOUcsQ0FBRSxDQUNKLENBQUM7SUFFRCxLQUFLLENBQUViLE9BQVEsQ0FBQzs7SUFFaEI7SUFDQSxJQUFJLENBQUNpQixnQkFBZ0IsQ0FBRW5CLHFCQUFxQixFQUFFO01BQzVDUSxNQUFNLEVBQUVOLE9BQU8sQ0FBQ00sTUFBTSxDQUFDQyxZQUFZLENBQUVULHFCQUFxQixDQUFDUSxNQUFNLENBQUNZLElBQUs7SUFDekUsQ0FBRSxDQUFDO0VBQ0w7RUFFZ0JDLE9BQU9BLENBQUEsRUFBUztJQUM5QkMsTUFBTSxJQUFJQSxNQUFNLENBQUUsS0FBSyxFQUFFLDhEQUErRCxDQUFDO0lBQ3pGLEtBQUssQ0FBQ0QsT0FBTyxDQUFDLENBQUM7RUFDakI7QUFDRjs7QUFFQTtBQUNBO0FBQ0E7O0FBTUEsTUFBTUwsMEJBQTBCLFNBQVNuQyxhQUFhLENBQUM7RUFJOUNnQixXQUFXQSxDQUFFTSxtQkFBOEMsRUFDOUNZLFFBQTBCLEVBQzFCSixtQkFBK0MsRUFDL0NWLGVBQWtELEVBQUc7SUFFdkUsTUFBTUMsT0FBTyxHQUFHdkIsU0FBUyxDQUFpRyxDQUFDLENBQUU7TUFFM0g7TUFDQTRDLGdCQUFnQixFQUFFO1FBQ2hCQyxJQUFJLEVBQUUvQjtNQUNSLENBQUM7TUFDRGdDLG9CQUFvQixFQUFFO1FBQ3BCQyxXQUFXLEVBQUU7VUFDWEYsSUFBSSxFQUFFL0I7UUFDUixDQUFDO1FBQ0RrQyxrQkFBa0IsRUFBRSxFQUFFLENBQUM7TUFDekIsQ0FBQzs7TUFDREMsa0JBQWtCLEVBQUU7UUFDbEJYLGVBQWUsRUFBRTVDLGVBQWUsQ0FBQ3dELEdBQUcsQ0FBRWxCLG1CQUFvQixDQUFDO1FBQzNEbUIsS0FBSyxFQUFFLENBQUM7UUFDUkMsa0JBQWtCLEVBQUUsQ0FBQztRQUNyQkMsa0JBQWtCLEVBQUU7TUFDdEIsQ0FBQztNQUVEO01BQ0FDLGFBQWEsRUFBRTtRQUNiaEIsZUFBZSxFQUFFNUMsZUFBZSxDQUFDd0QsR0FBRyxDQUFFbEIsbUJBQW9CLENBQUM7UUFDM0R1QixTQUFTLEVBQUUsSUFBSTFELFVBQVUsQ0FBRSxHQUFHLEVBQUUsRUFBRyxDQUFDO1FBQ3BDMkQsU0FBUyxFQUFFLElBQUkzRCxVQUFVLENBQUUsRUFBRSxFQUFFLEVBQUcsQ0FBQztRQUNuQzRELGNBQWMsRUFBRUMsS0FBSyxJQUFJM0QsS0FBSyxDQUFDNEQsZUFBZSxDQUFFRCxLQUFLLEVBQUUxQyxlQUFnQixDQUFDO1FBQ3hFYSxNQUFNLEVBQUVuQixNQUFNLENBQUNrRDtNQUNqQixDQUFDO01BRUQ7TUFDQUMsY0FBYyxFQUFFQSxDQUFFQyxTQUFTLEVBQUVDLGFBQWEsRUFBRUMsTUFBTSxFQUFFQyxlQUFlLEVBQUVDLGdCQUFnQixLQUFNO1FBQ3pGdkIsTUFBTSxJQUFJQSxNQUFNLENBQUVzQixlQUFlLElBQUlDLGdCQUFpQixDQUFDO1FBQ3ZELE9BQU8sSUFBSTlELElBQUksQ0FBRTtVQUNmK0QsT0FBTyxFQUFFLENBQUM7VUFDVmpDLFFBQVEsRUFBRSxDQUFFNEIsU0FBUyxFQUFFQyxhQUFhLEVBQUUsSUFBSTFELE1BQU0sQ0FBRSxDQUFFLENBQUMsRUFBRTRELGVBQWUsRUFBR0QsTUFBTSxFQUFFRSxnQkFBZ0I7UUFDbkcsQ0FBRSxDQUFDO01BQ0wsQ0FBQztNQUVEckMsTUFBTSxFQUFFbkIsTUFBTSxDQUFDa0QsT0FBTyxDQUFDO0lBQ3pCLENBQUMsRUFBRXRDLGVBQWdCLENBQUM7SUFFcEIsTUFBTThDLFNBQVMsR0FBR2hDLFFBQVEsQ0FBQ2lDLHNCQUFzQjs7SUFFakQ7SUFDQTFCLE1BQU0sSUFBSUEsTUFBTSxDQUFFLENBQUNwQixPQUFPLENBQUN1QixvQkFBb0IsQ0FBQ3dCLFlBQVksRUFBRSx3Q0FBeUMsQ0FBQztJQUN4Ry9DLE9BQU8sQ0FBQ3VCLG9CQUFvQixDQUFDd0IsWUFBWSxHQUFHLElBQUk1RSxlQUFlLENBQzdELENBQUVtQixrQkFBa0IsQ0FBQ1ksT0FBTyxDQUFFLFFBQVEsQ0FBRSxDQUFFLHNCQUFzQixDQUFFLEVBQUUyQyxTQUFTLENBQUNHLG1CQUFtQixDQUFFLEVBQ25HLENBQUU5QyxPQUFPLEVBQUUrQyxXQUFXLEtBQU12RSxXQUFXLENBQUMyQixNQUFNLENBQUVILE9BQU8sRUFBRWhCLFlBQVksQ0FBQ2dFLDBCQUEwQixFQUFFRCxXQUFZLENBQ2hILENBQUM7SUFFRDdCLE1BQU0sSUFBSUEsTUFBTSxDQUFFcEIsT0FBTyxDQUFDbUQsS0FBSyxLQUFLQyxTQUFTLEVBQUUsaUNBQWtDLENBQUM7SUFDbEZwRCxPQUFPLENBQUNtRCxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7O0lBRW5CO0lBQ0EsTUFBTW5CLFNBQVMsR0FBR2hDLE9BQU8sQ0FBQytCLGFBQWEsQ0FBQ0MsU0FBVTtJQUNsRFosTUFBTSxJQUFJQSxNQUFNLENBQUVZLFNBQVUsQ0FBQztJQUM3QlosTUFBTSxJQUFJQSxNQUFNLENBQUUsQ0FBQ3BCLE9BQU8sQ0FBQytCLGFBQWEsQ0FBQ3NCLGdCQUFnQixFQUFFLDRDQUE2QyxDQUFDO0lBQ3pHckQsT0FBTyxDQUFDK0IsYUFBYSxDQUFDc0IsZ0JBQWdCLEdBQUcsSUFBSXRFLGNBQWMsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFaUQsU0FBUyxDQUFDc0IsS0FBSyxFQUFFLENBQUUsQ0FBQyxDQUNwRkMsWUFBWSxDQUFFLENBQUMsRUFBRTFDLFFBQVEsQ0FBQzJDLFVBQVUsQ0FBQ0MsR0FBSSxDQUFDLENBQzFDRixZQUFZLENBQUUsQ0FBQyxFQUFFMUMsUUFBUSxDQUFDMkMsVUFBVSxDQUFDRSxHQUFJLENBQUM7O0lBRTdDO0lBQ0EsTUFBTUMsY0FBYyxHQUFHLElBQUl2RixlQUFlLENBQUUsSUFBSUMsUUFBUSxDQUFFd0MsUUFBUSxDQUFDZixxQkFBc0IsQ0FBQyxFQUFFO01BQzFGOEQsYUFBYSxFQUFFLElBQUk7TUFFbkI7TUFDQUMsU0FBUyxFQUFFLElBQUk7TUFFZjtNQUNBakQsR0FBRyxFQUFJdUIsS0FBYSxJQUFNVSxTQUFTLENBQUNpQixXQUFXLENBQUUzQixLQUFNLENBQUM7TUFFeEQ7TUFDQTRCLFVBQVUsRUFBSTVCLEtBQWEsSUFBTVUsU0FBUyxDQUFDbUIsV0FBVyxDQUFFN0IsS0FBTTtJQUNoRSxDQUFFLENBQUM7O0lBRUg7SUFDQSxNQUFNOEIsa0JBQWtCLEdBQUdwRCxRQUFRLENBQUNmLHFCQUFxQixDQUFDb0UsS0FBSztJQUMvRCxNQUFNQyxXQUFXLEdBQUcsSUFBSTVGLEtBQUssQ0FDM0JzRSxTQUFTLENBQUNpQixXQUFXLENBQUVHLGtCQUFrQixDQUFDUixHQUFJLENBQUMsRUFDL0NaLFNBQVMsQ0FBQ2lCLFdBQVcsQ0FBRUcsa0JBQWtCLENBQUNQLEdBQUksQ0FDaEQsQ0FBQzs7SUFFRDtJQUNBdEMsTUFBTSxJQUFJQSxNQUFNLENBQUUsQ0FBQ3BCLE9BQU8sQ0FBQytCLGFBQWEsQ0FBQ3FDLFVBQVUsRUFBRSxzQ0FBdUMsQ0FBQztJQUM3RnBFLE9BQU8sQ0FBQytCLGFBQWEsQ0FBQ3FDLFVBQVUsR0FBRyxDQUNqQztNQUNFakMsS0FBSyxFQUFFZ0MsV0FBVyxDQUFDVixHQUFHO01BQ3RCWSxLQUFLLEVBQUUsSUFBSXBGLElBQUksQ0FBRWtGLFdBQVcsQ0FBQ1YsR0FBRyxFQUFFO1FBQ2hDbkMsSUFBSSxFQUFFOUI7UUFDTjtNQUNGLENBQUU7SUFDSixDQUFDLEVBQ0Q7TUFDRTJDLEtBQUssRUFBRWdDLFdBQVcsQ0FBQ1QsR0FBRztNQUN0QlcsS0FBSyxFQUFFLElBQUlwRixJQUFJLENBQUVrRixXQUFXLENBQUNULEdBQUcsRUFBRTtRQUNoQ3BDLElBQUksRUFBRTlCO1FBQ047TUFDRixDQUFFO0lBQ0osQ0FBQyxDQUNGOztJQUVELEtBQUssQ0FBRVMsbUJBQW1CLEVBQUUwRCxjQUFjLEVBQUVRLFdBQVcsRUFBRW5FLE9BQVEsQ0FBQztJQUVsRSxJQUFJLENBQUNhLFFBQVEsR0FBR0EsUUFBUTtJQUV4QixJQUFJLENBQUNJLGdCQUFnQixDQUFFSixRQUFRLENBQUNmLHFCQUFxQixFQUFFO01BQ3JEUSxNQUFNLEVBQUVOLE9BQU8sQ0FBQ00sTUFBTSxDQUFDQyxZQUFZLENBQUVNLFFBQVEsQ0FBQ2YscUJBQXFCLENBQUNRLE1BQU0sQ0FBQ1ksSUFBSztJQUNsRixDQUFFLENBQUM7RUFDTDtFQUVnQkMsT0FBT0EsQ0FBQSxFQUFTO0lBQzlCQyxNQUFNLElBQUlBLE1BQU0sQ0FBRSxLQUFLLEVBQUUsOERBQStELENBQUM7SUFDekYsS0FBSyxDQUFDRCxPQUFPLENBQUMsQ0FBQztFQUNqQjtBQUNGO0FBRUE5QixXQUFXLENBQUNpRixRQUFRLENBQUUsc0JBQXNCLEVBQUU1RSxvQkFBcUIsQ0FBQyJ9