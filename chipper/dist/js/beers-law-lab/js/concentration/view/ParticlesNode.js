// Copyright 2013-2023, University of Colorado Boulder

/**
 * ParticlesNode is the base class for drawing a system of particles. It draws directly to canvas for performance.
 * It's use for drawing particles that fall out of the shaker, and for precipitate on the bottom of the beaker.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Jonathan Olson
 */

import { CanvasNode } from '../../../../scenery/js/imports.js';
import beersLawLab from '../../beersLawLab.js';
export default class ParticlesNode extends CanvasNode {
  constructor(particles, modelViewTransform, canvasBounds) {
    super({
      pickable: false,
      canvasBounds: canvasBounds
    });
    this.particles = particles;
    this.modelViewTransform = modelViewTransform;

    // If particles are added or removed, then redraw.
    this.particles.addParticleCreatedListener(() => this.invalidatePaint());
    this.particles.addParticleDisposedListener(() => this.invalidatePaint());
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }

  /**
   * Called when this.invalidatePaint is called.
   */
  paintCanvas(context) {
    const particles = this.particles.getParticlesReference(); // reference - do not modify!
    const numberOfParticles = particles.length;

    // Set and compute static properties that should be shared by all the particles, and start the path.
    // Assumes that all particles are the same color and size.
    if (numberOfParticles > 0) {
      const particleSize = this.particles.getParticleSize();
      const halfViewSize = this.modelViewTransform.modelToViewDeltaX(particleSize) * Math.SQRT2 / 2;
      context.fillStyle = this.particles.getFillStyle();
      context.strokeStyle = this.particles.getStrokeStyle();
      context.lineWidth = 1;
      context.beginPath();

      // draw into one big path
      for (let i = 0; i < numberOfParticles; i++) {
        const particle = particles[i];
        const x = this.modelViewTransform.modelToViewX(particle.positionProperty.value.x);
        const y = this.modelViewTransform.modelToViewY(particle.positionProperty.value.y);
        const cos = particle.cos * halfViewSize;
        const sin = particle.sin * halfViewSize;
        context.moveTo(x + cos, y + sin);
        context.lineTo(x - sin, y + cos);
        context.lineTo(x - cos, y - sin);
        context.lineTo(x + sin, y - cos);
        context.closePath();
      }

      // fill and stroke the entire path
      context.fill();
      context.stroke();
    }
  }
}
beersLawLab.register('ParticlesNode', ParticlesNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDYW52YXNOb2RlIiwiYmVlcnNMYXdMYWIiLCJQYXJ0aWNsZXNOb2RlIiwiY29uc3RydWN0b3IiLCJwYXJ0aWNsZXMiLCJtb2RlbFZpZXdUcmFuc2Zvcm0iLCJjYW52YXNCb3VuZHMiLCJwaWNrYWJsZSIsImFkZFBhcnRpY2xlQ3JlYXRlZExpc3RlbmVyIiwiaW52YWxpZGF0ZVBhaW50IiwiYWRkUGFydGljbGVEaXNwb3NlZExpc3RlbmVyIiwiZGlzcG9zZSIsImFzc2VydCIsInBhaW50Q2FudmFzIiwiY29udGV4dCIsImdldFBhcnRpY2xlc1JlZmVyZW5jZSIsIm51bWJlck9mUGFydGljbGVzIiwibGVuZ3RoIiwicGFydGljbGVTaXplIiwiZ2V0UGFydGljbGVTaXplIiwiaGFsZlZpZXdTaXplIiwibW9kZWxUb1ZpZXdEZWx0YVgiLCJNYXRoIiwiU1FSVDIiLCJmaWxsU3R5bGUiLCJnZXRGaWxsU3R5bGUiLCJzdHJva2VTdHlsZSIsImdldFN0cm9rZVN0eWxlIiwibGluZVdpZHRoIiwiYmVnaW5QYXRoIiwiaSIsInBhcnRpY2xlIiwieCIsIm1vZGVsVG9WaWV3WCIsInBvc2l0aW9uUHJvcGVydHkiLCJ2YWx1ZSIsInkiLCJtb2RlbFRvVmlld1kiLCJjb3MiLCJzaW4iLCJtb3ZlVG8iLCJsaW5lVG8iLCJjbG9zZVBhdGgiLCJmaWxsIiwic3Ryb2tlIiwicmVnaXN0ZXIiXSwic291cmNlcyI6WyJQYXJ0aWNsZXNOb2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDEzLTIwMjMsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIFBhcnRpY2xlc05vZGUgaXMgdGhlIGJhc2UgY2xhc3MgZm9yIGRyYXdpbmcgYSBzeXN0ZW0gb2YgcGFydGljbGVzLiBJdCBkcmF3cyBkaXJlY3RseSB0byBjYW52YXMgZm9yIHBlcmZvcm1hbmNlLlxyXG4gKiBJdCdzIHVzZSBmb3IgZHJhd2luZyBwYXJ0aWNsZXMgdGhhdCBmYWxsIG91dCBvZiB0aGUgc2hha2VyLCBhbmQgZm9yIHByZWNpcGl0YXRlIG9uIHRoZSBib3R0b20gb2YgdGhlIGJlYWtlci5cclxuICpcclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvblxyXG4gKi9cclxuXHJcbmltcG9ydCBCb3VuZHMyIGZyb20gJy4uLy4uLy4uLy4uL2RvdC9qcy9Cb3VuZHMyLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgeyBDYW52YXNOb2RlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IGJlZXJzTGF3TGFiIGZyb20gJy4uLy4uL2JlZXJzTGF3TGFiLmpzJztcclxuaW1wb3J0IFNvbHV0ZVBhcnRpY2xlcyBmcm9tICcuLi9tb2RlbC9Tb2x1dGVQYXJ0aWNsZXMuanMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGFydGljbGVzTm9kZSBleHRlbmRzIENhbnZhc05vZGUge1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgcGFydGljbGVzOiBTb2x1dGVQYXJ0aWNsZXM7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTI7XHJcblxyXG4gIHByb3RlY3RlZCBjb25zdHJ1Y3RvciggcGFydGljbGVzOiBTb2x1dGVQYXJ0aWNsZXMsIG1vZGVsVmlld1RyYW5zZm9ybTogTW9kZWxWaWV3VHJhbnNmb3JtMiwgY2FudmFzQm91bmRzOiBCb3VuZHMyICkge1xyXG5cclxuICAgIHN1cGVyKCB7XHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZSxcclxuICAgICAgY2FudmFzQm91bmRzOiBjYW52YXNCb3VuZHNcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLnBhcnRpY2xlcyA9IHBhcnRpY2xlcztcclxuXHJcbiAgICB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybSA9IG1vZGVsVmlld1RyYW5zZm9ybTtcclxuXHJcbiAgICAvLyBJZiBwYXJ0aWNsZXMgYXJlIGFkZGVkIG9yIHJlbW92ZWQsIHRoZW4gcmVkcmF3LlxyXG4gICAgdGhpcy5wYXJ0aWNsZXMuYWRkUGFydGljbGVDcmVhdGVkTGlzdGVuZXIoICgpID0+IHRoaXMuaW52YWxpZGF0ZVBhaW50KCkgKTtcclxuICAgIHRoaXMucGFydGljbGVzLmFkZFBhcnRpY2xlRGlzcG9zZWRMaXN0ZW5lciggKCkgPT4gdGhpcy5pbnZhbGlkYXRlUGFpbnQoKSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBmYWxzZSwgJ2Rpc3Bvc2UgaXMgbm90IHN1cHBvcnRlZCwgZXhpc3RzIGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIHNpbScgKTtcclxuICAgIHN1cGVyLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGxlZCB3aGVuIHRoaXMuaW52YWxpZGF0ZVBhaW50IGlzIGNhbGxlZC5cclxuICAgKi9cclxuICBwdWJsaWMgb3ZlcnJpZGUgcGFpbnRDYW52YXMoIGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCApOiB2b2lkIHtcclxuXHJcbiAgICBjb25zdCBwYXJ0aWNsZXMgPSB0aGlzLnBhcnRpY2xlcy5nZXRQYXJ0aWNsZXNSZWZlcmVuY2UoKTsgLy8gcmVmZXJlbmNlIC0gZG8gbm90IG1vZGlmeSFcclxuICAgIGNvbnN0IG51bWJlck9mUGFydGljbGVzID0gcGFydGljbGVzLmxlbmd0aDtcclxuXHJcbiAgICAvLyBTZXQgYW5kIGNvbXB1dGUgc3RhdGljIHByb3BlcnRpZXMgdGhhdCBzaG91bGQgYmUgc2hhcmVkIGJ5IGFsbCB0aGUgcGFydGljbGVzLCBhbmQgc3RhcnQgdGhlIHBhdGguXHJcbiAgICAvLyBBc3N1bWVzIHRoYXQgYWxsIHBhcnRpY2xlcyBhcmUgdGhlIHNhbWUgY29sb3IgYW5kIHNpemUuXHJcbiAgICBpZiAoIG51bWJlck9mUGFydGljbGVzID4gMCApIHtcclxuXHJcbiAgICAgIGNvbnN0IHBhcnRpY2xlU2l6ZSA9IHRoaXMucGFydGljbGVzLmdldFBhcnRpY2xlU2l6ZSgpO1xyXG4gICAgICBjb25zdCBoYWxmVmlld1NpemUgPSB0aGlzLm1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld0RlbHRhWCggcGFydGljbGVTaXplICkgKiBNYXRoLlNRUlQyIC8gMjtcclxuXHJcbiAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gdGhpcy5wYXJ0aWNsZXMuZ2V0RmlsbFN0eWxlKCk7XHJcbiAgICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSB0aGlzLnBhcnRpY2xlcy5nZXRTdHJva2VTdHlsZSgpO1xyXG4gICAgICBjb250ZXh0LmxpbmVXaWR0aCA9IDE7XHJcblxyXG4gICAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xyXG5cclxuICAgICAgLy8gZHJhdyBpbnRvIG9uZSBiaWcgcGF0aFxyXG4gICAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBudW1iZXJPZlBhcnRpY2xlczsgaSsrICkge1xyXG4gICAgICAgIGNvbnN0IHBhcnRpY2xlID0gcGFydGljbGVzWyBpIF07XHJcbiAgICAgICAgY29uc3QgeCA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WCggcGFydGljbGUucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS54ICk7XHJcbiAgICAgICAgY29uc3QgeSA9IHRoaXMubW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3WSggcGFydGljbGUucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS55ICk7XHJcbiAgICAgICAgY29uc3QgY29zID0gcGFydGljbGUuY29zICogaGFsZlZpZXdTaXplO1xyXG4gICAgICAgIGNvbnN0IHNpbiA9IHBhcnRpY2xlLnNpbiAqIGhhbGZWaWV3U2l6ZTtcclxuICAgICAgICBjb250ZXh0Lm1vdmVUbyggeCArIGNvcywgeSArIHNpbiApO1xyXG4gICAgICAgIGNvbnRleHQubGluZVRvKCB4IC0gc2luLCB5ICsgY29zICk7XHJcbiAgICAgICAgY29udGV4dC5saW5lVG8oIHggLSBjb3MsIHkgLSBzaW4gKTtcclxuICAgICAgICBjb250ZXh0LmxpbmVUbyggeCArIHNpbiwgeSAtIGNvcyApO1xyXG4gICAgICAgIGNvbnRleHQuY2xvc2VQYXRoKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGZpbGwgYW5kIHN0cm9rZSB0aGUgZW50aXJlIHBhdGhcclxuICAgICAgY29udGV4dC5maWxsKCk7XHJcbiAgICAgIGNvbnRleHQuc3Ryb2tlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5iZWVyc0xhd0xhYi5yZWdpc3RlciggJ1BhcnRpY2xlc05vZGUnLCBQYXJ0aWNsZXNOb2RlICk7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFJQSxTQUFTQSxVQUFVLFFBQVEsbUNBQW1DO0FBQzlELE9BQU9DLFdBQVcsTUFBTSxzQkFBc0I7QUFHOUMsZUFBZSxNQUFNQyxhQUFhLFNBQVNGLFVBQVUsQ0FBQztFQUsxQ0csV0FBV0EsQ0FBRUMsU0FBMEIsRUFBRUMsa0JBQXVDLEVBQUVDLFlBQXFCLEVBQUc7SUFFbEgsS0FBSyxDQUFFO01BQ0xDLFFBQVEsRUFBRSxLQUFLO01BQ2ZELFlBQVksRUFBRUE7SUFDaEIsQ0FBRSxDQUFDO0lBRUgsSUFBSSxDQUFDRixTQUFTLEdBQUdBLFNBQVM7SUFFMUIsSUFBSSxDQUFDQyxrQkFBa0IsR0FBR0Esa0JBQWtCOztJQUU1QztJQUNBLElBQUksQ0FBQ0QsU0FBUyxDQUFDSSwwQkFBMEIsQ0FBRSxNQUFNLElBQUksQ0FBQ0MsZUFBZSxDQUFDLENBQUUsQ0FBQztJQUN6RSxJQUFJLENBQUNMLFNBQVMsQ0FBQ00sMkJBQTJCLENBQUUs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