// Copyright 2013-2023, University of Colorado Boulder

/**
 * Concentration meter, with probe.
 * The probe registers the concentration of all possible fluids that it may contact, including:
 *
 * - solution in the beaker
 * - output of the solvent faucet
 * - output of the drain faucet
 * - output of the dropper
 *
 * Rather than trying to model the shapes of all of these fluids, we handle 'probe is in fluid'
 * herein via intersection of Path shapes.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 */

import Property from '../../../../axon/js/Property.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import Dimension2 from '../../../../dot/js/Dimension2.js';
import Utils from '../../../../dot/js/Utils.js';
import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import MathSymbols from '../../../../scenery-phet/js/MathSymbols.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import ProbeNode from '../../../../scenery-phet/js/ProbeNode.js';
import ShadedRectangle from '../../../../scenery-phet/js/ShadedRectangle.js';
import { DragListener, Node, Path, Text, VBox } from '../../../../scenery/js/imports.js';
import beersLawLab from '../../beersLawLab.js';
import BeersLawLabStrings from '../../BeersLawLabStrings.js';
import DerivedProperty from '../../../../axon/js/DerivedProperty.js';
import BLLPreferences from '../../common/model/BLLPreferences.js';
import Multilink from '../../../../axon/js/Multilink.js';
import StringIO from '../../../../tandem/js/types/StringIO.js';

// constants
const DECIMAL_PLACES_MOLES_PER_LITER = 3;
const DECIMAL_PLACES_PERCENT = 1;
const READOUT_NO_VALUE = MathSymbols.NO_VALUE; // displayed in the readout when the meter is not measuring anything
const BODY_X_MARGIN = 15;
const BODY_Y_MARGIN = 15;
const READOUT_X_MARGIN = 5;
const READOUT_Y_MARGIN = 4;
const PROBE_COLOR = 'rgb( 135, 4, 72 )';
const MIN_VALUE_SIZE = new Dimension2(140, 35);
const MIN_BODY_SIZE = new Dimension2(170, 100);
export default class ConcentrationMeterNode extends Node {
  constructor(concentrationMeter, solution, dropper, solutionNode, stockSolutionNode, solventFluidNode, drainFluidNode, modelViewTransform, providedOptions) {
    const options = providedOptions;
    super(options);
    const bodyNode = new BodyNode(concentrationMeter, modelViewTransform, options.tandem.createTandem('bodyNode'));
    const probeNode = new ConcentrationProbeNode(concentrationMeter.probe, modelViewTransform, solutionNode, stockSolutionNode, solventFluidNode, drainFluidNode, options.tandem.createTandem('probeNode'));
    const wireNode = new WireNode(concentrationMeter.bodyPosition, concentrationMeter.probe, bodyNode, probeNode);

    // rendering order
    this.addChild(wireNode);
    this.addChild(bodyNode);
    this.addChild(probeNode);
    const updateValue = () => {
      if (probeNode.isInSolution() || probeNode.isInDrainFluid()) {
        concentrationMeter.valueProperty.value = BLLPreferences.concentrationMeterUnitsProperty.value === 'molesPerLiter' ? solution.concentrationProperty.value : solution.percentConcentrationProperty.value;
      } else if (probeNode.isInSolvent()) {
        concentrationMeter.valueProperty.value = 0;
      } else if (probeNode.isInStockSolution()) {
        concentrationMeter.valueProperty.value = BLLPreferences.concentrationMeterUnitsProperty.value === 'molesPerLiter' ? dropper.soluteProperty.value.stockSolutionConcentration : dropper.soluteProperty.value.stockSolutionPercentConcentration;
      } else {
        concentrationMeter.valueProperty.value = null;
      }
    };
    Multilink.multilink([BLLPreferences.concentrationMeterUnitsProperty, concentrationMeter.probe.positionProperty, solution.soluteProperty, solution.concentrationProperty, solution.percentConcentrationProperty, solutionNode.boundsProperty, stockSolutionNode.boundsProperty, solventFluidNode.boundsProperty, drainFluidNode.boundsProperty], () => updateValue());
    this.addLinkedElement(concentrationMeter, {
      tandem: options.tandem.createTandem('concentrationMeter')
    });
  }
  dispose() {
    assert && assert(false, 'dispose is not supported, exists for the lifetime of the sim');
    super.dispose();
  }
}

/**
 * Meter body, origin at upper left. Note that while the body is a BLLMovable, we have currently decided not to
 * allow it to be moved, so it has no drag handler.
 */
class BodyNode extends Node {
  constructor(concentrationMeter, modelViewTransform, tandem) {
    const options = {
      cursor: 'pointer',
      tandem: tandem,
      phetioVisiblePropertyInstrumented: false
    };
    super(options);
    const labelText = new Text(BeersLawLabStrings.concentrationStringProperty, {
      font: new PhetFont(18),
      fill: 'white',
      maxWidth: 125,
      tandem: tandem.createTandem('labelText')
    });

    // value + units
    const valueTextTandem = tandem.createTandem('valueText');
    const valueStringProperty = new DerivedProperty([BeersLawLabStrings.pattern['0value']['1unitsStringProperty'], BeersLawLabStrings.pattern['0percentStringProperty'], concentrationMeter.valueProperty, BeersLawLabStrings.units.molesPerLiterStringProperty, BLLPreferences.concentrationMeterUnitsProperty], (patternValueUnits, patternValuePercent, value, molesPerLiterString, concentrationMeterUnits) => {
      let text;
      if (value === null) {
        text = READOUT_NO_VALUE;
      } else {
        // display concentration as 'mol/L' or '%', see beers-law-lab#149
        if (concentrationMeterUnits === 'molesPerLiter') {
          text = StringUtils.format(patternValueUnits, Utils.toFixed(value, DECIMAL_PLACES_MOLES_PER_LITER), molesPerLiterString);
        } else {
          text = StringUtils.format(patternValuePercent, Utils.toFixed(value, DECIMAL_PLACES_PERCENT));
        }
      }
      return text;
    }, {
      tandem: valueTextTandem.createTandem(Text.STRING_PROPERTY_TANDEM_NAME),
      phetioValueType: StringIO
    });
    const valueText = new Text(valueStringProperty, {
      font: new PhetFont(22),
      fill: 'black',
      maxWidth: 125,
      tandem: valueTextTandem,
      stringPropertyOptions: {
        phetioReadOnly: true
      }
    });

    // background behind the value
    const backgroundWidth = Math.max(MIN_VALUE_SIZE.width, Math.max(labelText.width, valueText.width) + 2 * READOUT_X_MARGIN);
    const backgroundHeight = Math.max(MIN_VALUE_SIZE.height, valueText.height + 2 * READOUT_Y_MARGIN);
    const backgroundNode = new ShadedRectangle(new Bounds2(0, 0, backgroundWidth, backgroundHeight), {
      baseColor: 'white',
      lightSource: 'rightBottom'
    });

    // vertical arrangement of stuff in the concentrationMeter
    const vBox = new VBox({
      excludeInvisibleChildrenFromBounds: false,
      children: [labelText, new Node({
        children: [backgroundNode, valueText]
      })],
      align: 'center',
      spacing: 18
    });

    // concentrationMeter body
    const bodyWidth = Math.max(MIN_BODY_SIZE.width, vBox.width + 2 * BODY_X_MARGIN);
    const bodyHeight = Math.max(MIN_BODY_SIZE.height, vBox.height + 2 * BODY_Y_MARGIN);
    const bodyNode = new ShadedRectangle(new Bounds2(0, 0, bodyWidth, bodyHeight), {
      baseColor: PROBE_COLOR,
      lightOffset: 0.95
    });
    vBox.boundsProperty.link(bounds => {
      vBox.center = bodyNode.center;
    });
    this.children = [bodyNode, vBox];

    // body position
    this.translation = modelViewTransform.modelToViewPosition(concentrationMeter.bodyPosition);

    // Keep the value properly justified on the background
    valueText.boundsProperty.link(bounds => {
      if (concentrationMeter.valueProperty.value === null) {
        // center justified
        valueText.centerX = backgroundNode.centerX;
      } else {
        // right justified
        valueText.right = backgroundNode.right - READOUT_X_MARGIN;
      }
      valueText.centerY = backgroundNode.centerY;
    });
  }
}

/**
 * Meter probe, origin at center of crosshairs.
 */
class ConcentrationProbeNode extends ProbeNode {
  constructor(probe, modelViewTransform, solutionNode, stockSolutionNode, solventFluidNode, drainFluidNode, tandem) {
    const options = {
      sensorTypeFunction: ProbeNode.crosshairs({
        intersectionRadius: 6
      }),
      radius: 34,
      innerRadius: 26,
      handleWidth: 30,
      handleHeight: 25,
      handleCornerRadius: 12,
      lightAngle: 1.75 * Math.PI,
      color: PROBE_COLOR,
      rotation: -Math.PI / 2,
      cursor: 'pointer',
      // phet-io
      tandem: tandem,
      phetioInputEnabledPropertyInstrumented: true,
      phetioVisiblePropertyInstrumented: false
    };
    super(options);

    // probe position
    probe.positionProperty.link(position => {
      this.translation = modelViewTransform.modelToViewPosition(position);
    });

    // touch area
    this.touchArea = this.localBounds.dilatedXY(0.25 * this.width, 0.25 * this.height);

    // drag listener
    this.addInputListener(new DragListener({
      positionProperty: probe.positionProperty,
      dragBoundsProperty: new Property(probe.dragBounds),
      transform: modelViewTransform,
      tandem: tandem.createTandem('dragListener')
    }));
    const isInNode = node => {
      const localPoint = node.parentToLocalPoint(probe.positionProperty.value);
      const nodeShape = node.getShape();
      assert && assert(nodeShape);
      const shapeBounds = nodeShape.bounds;
      return shapeBounds.getWidth() > 0 && shapeBounds.getHeight() > 0 && nodeShape.containsPoint(localPoint); // see issue #65
    };

    this.isInSolution = () => isInNode(solutionNode);
    this.isInSolvent = () => isInNode(solventFluidNode);
    this.isInDrainFluid = () => isInNode(drainFluidNode);
    this.isInStockSolution = () => isInNode(stockSolutionNode);
  }
}

/**
 * Wire that connects the body and probe.
 */
class WireNode extends Path {
  constructor(bodyPosition, probe, bodyNode, probeNode) {
    const options = {
      stroke: 'gray',
      lineWidth: 8,
      lineCap: 'square',
      lineJoin: 'round',
      // no need to drag the wire, and we don't want to do cubic-curve intersection here, or have it get in the way
      pickable: false
    };
    super(new Shape(), options);
    const updateCurve = () => {
      // Connect bottom-center of body to right-center of probe.
      const bodyConnectionPoint = new Vector2(bodyNode.centerX, bodyNode.bottom - 10);
      const probeConnectionPoint = new Vector2(probeNode.right, probeNode.centerY);

      // control points
      // The y coordinate of the body's control point varies with the x distance between the body and probe.
      const c1Offset = new Vector2(0, Utils.linear(0, 800, 0, 200, bodyNode.centerX - probeNode.left)); // x distance -> y coordinate
      const c2Offset = new Vector2(50, 0);
      const c1 = new Vector2(bodyConnectionPoint.x + c1Offset.x, bodyConnectionPoint.y + c1Offset.y);
      const c2 = new Vector2(probeConnectionPoint.x + c2Offset.x, probeConnectionPoint.y + c2Offset.y);
      this.shape = new Shape().moveTo(bodyConnectionPoint.x, bodyConnectionPoint.y).cubicCurveTo(c1.x, c1.y, c2.x, c2.y, probeConnectionPoint.x, probeConnectionPoint.y);
    };
    probe.positionProperty.link(updateCurve);
  }
}
beersLawLab.register('ConcentrationMeterNode', ConcentrationMeterNode);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9wZXJ0eSIsIkJvdW5kczIiLCJEaW1lbnNpb24yIiwiVXRpbHMiLCJWZWN0b3IyIiwiU2hhcGUiLCJTdHJpbmdVdGlscyIsIk1hdGhTeW1ib2xzIiwiUGhldEZvbnQiLCJQcm9iZU5vZGUiLCJTaGFkZWRSZWN0YW5nbGUiLCJEcmFnTGlzdGVuZXIiLCJOb2RlIiwiUGF0aCIsIlRleHQiLCJWQm94IiwiYmVlcnNMYXdMYWIiLCJCZWVyc0xhd0xhYlN0cmluZ3MiLCJEZXJpdmVkUHJvcGVydHkiLCJCTExQcmVmZXJlbmNlcyIsIk11bHRpbGluayIsIlN0cmluZ0lPIiwiREVDSU1BTF9QTEFDRVNfTU9MRVNfUEVSX0xJVEVSIiwiREVDSU1BTF9QTEFDRVNfUEVSQ0VOVCIsIlJFQURPVVRfTk9fVkFMVUUiLCJOT19WQUxVRSIsIkJPRFlfWF9NQVJHSU4iLCJCT0RZX1lfTUFSR0lOIiwiUkVBRE9VVF9YX01BUkdJTiIsIlJFQURPVVRfWV9NQVJHSU4iLCJQUk9CRV9DT0xPUiIsIk1JTl9WQUxVRV9TSVpFIiwiTUlOX0JPRFlfU0laRSIsIkNvbmNlbnRyYXRpb25NZXRlck5vZGUiLCJjb25zdHJ1Y3RvciIsImNvbmNlbnRyYXRpb25NZXRlciIsInNvbHV0aW9uIiwiZHJvcHBlciIsInNvbHV0aW9uTm9kZSIsInN0b2NrU29sdXRpb25Ob2RlIiwic29sdmVudEZsdWlkTm9kZSIsImRyYWluRmx1aWROb2RlIiwibW9kZWxWaWV3VHJhbnNmb3JtIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImJvZHlOb2RlIiwiQm9keU5vZGUiLCJ0YW5kZW0iLCJjcmVhdGVUYW5kZW0iLCJwcm9iZU5vZGUiLCJDb25jZW50cmF0aW9uUHJvYmVOb2RlIiwicHJvYmUiLCJ3aXJlTm9kZSIsIldpcmVOb2RlIiwiYm9keVBvc2l0aW9uIiwiYWRkQ2hpbGQiLCJ1cGRhdGVWYWx1ZSIsImlzSW5Tb2x1dGlvbiIsImlzSW5EcmFpbkZsdWlkIiwidmFsdWVQcm9wZXJ0eSIsInZhbHVlIiwiY29uY2VudHJhdGlvbk1ldGVyVW5pdHNQcm9wZXJ0eSIsImNvbmNlbnRyYXRpb25Qcm9wZXJ0eSIsInBlcmNlbnRDb25jZW50cmF0aW9uUHJvcGVydHkiLCJpc0luU29sdmVudCIsImlzSW5TdG9ja1NvbHV0aW9uIiwic29sdXRlUHJvcGVydHkiLCJzdG9ja1NvbHV0aW9uQ29uY2VudHJhdGlvbiIsInN0b2NrU29sdXRpb25QZXJjZW50Q29uY2VudHJhdGlvbiIsIm11bHRpbGluayIsInBvc2l0aW9uUHJvcGVydHkiLCJib3VuZHNQcm9wZXJ0eSIsImFkZExpbmtlZEVsZW1lbnQiLCJkaXNwb3NlIiwiYXNzZXJ0IiwiY3Vyc29yIiwicGhldGlvVmlzaWJsZVByb3BlcnR5SW5zdHJ1bWVudGVkIiwibGFiZWxUZXh0IiwiY29uY2VudHJhdGlvblN0cmluZ1Byb3BlcnR5IiwiZm9udCIsImZpbGwiLCJtYXhXaWR0aCIsInZhbHVlVGV4dFRhbmRlbSIsInZhbHVlU3RyaW5nUHJvcGVydHkiLCJwYXR0ZXJuIiwidW5pdHMiLCJtb2xlc1BlckxpdGVyU3RyaW5nUHJvcGVydHkiLCJwYXR0ZXJuVmFsdWVVbml0cyIsInBhdHRlcm5WYWx1ZVBlcmNlbnQiLCJtb2xlc1BlckxpdGVyU3RyaW5nIiwiY29uY2VudHJhdGlvbk1ldGVyVW5pdHMiLCJ0ZXh0IiwiZm9ybWF0IiwidG9GaXhlZCIsIlNUUklOR19QUk9QRVJUWV9UQU5ERU1fTkFNRSIsInBoZXRpb1ZhbHVlVHlwZSIsInZhbHVlVGV4dCIsInN0cmluZ1Byb3BlcnR5T3B0aW9ucyIsInBoZXRpb1JlYWRPbmx5IiwiYmFja2dyb3VuZFdpZHRoIiwiTWF0aCIsIm1heCIsIndpZHRoIiwiYmFja2dyb3VuZEhlaWdodCIsImhlaWdodCIsImJhY2tncm91bmROb2RlIiwiYmFzZUNvbG9yIiwibGlnaHRTb3VyY2UiLCJ2Qm94IiwiZXhjbHVkZUludmlzaWJsZUNoaWxkcmVuRnJvbUJvdW5kcyIsImNoaWxkcmVuIiwiYWxpZ24iLCJzcGFjaW5nIiwiYm9keVdpZHRoIiwiYm9keUhlaWdodCIsImxpZ2h0T2Zmc2V0IiwibGluayIsImJvdW5kcyIsImNlbnRlciIsInRyYW5zbGF0aW9uIiwibW9kZWxUb1ZpZXdQb3NpdGlvbiIsImNlbnRlclgiLCJyaWdodCIsImNlbnRlclkiLCJzZW5zb3JUeXBlRnVuY3Rpb24iLCJjcm9zc2hhaXJzIiwiaW50ZXJzZWN0aW9uUmFkaXVzIiwicmFkaXVzIiwiaW5uZXJSYWRpdXMiLCJoYW5kbGVXaWR0aCIsImhhbmRsZUhlaWdodCIsImhhbmRsZUNvcm5lclJhZGl1cyIsImxpZ2h0QW5nbGUiLCJQSSIsImNvbG9yIiwicm90YXRpb24iLCJwaGV0aW9JbnB1dEVuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZCIsInBvc2l0aW9uIiwidG91Y2hBcmVhIiwibG9jYWxCb3VuZHMiLCJkaWxhdGVkWFkiLCJhZGRJbnB1dExpc3RlbmVyIiwiZHJhZ0JvdW5kc1Byb3BlcnR5IiwiZHJhZ0JvdW5kcyIsInRyYW5zZm9ybSIsImlzSW5Ob2RlIiwibm9kZSIsImxvY2FsUG9pbnQiLCJwYXJlbnRUb0xvY2FsUG9pbnQiLCJub2RlU2hhcGUiLCJnZXRTaGFwZSIsInNoYXBlQm91bmRzIiwiZ2V0V2lkdGgiLCJnZXRIZWlnaHQiLCJjb250YWluc1BvaW50Iiwic3Ryb2tlIiwibGluZVdpZHRoIiwibGluZUNhcCIsImxpbmVKb2luIiwicGlja2FibGUiLCJ1cGRhdGVDdXJ2ZSIsImJvZHlDb25uZWN0aW9uUG9pbnQiLCJib3R0b20iLCJwcm9iZUNvbm5lY3Rpb25Qb2ludCIsImMxT2Zmc2V0IiwibGluZWFyIiwibGVmdCIsImMyT2Zmc2V0IiwiYzEiLCJ4IiwieSIsImMyIiwic2hhcGUiLCJtb3ZlVG8iLCJjdWJpY0N1cnZlVG8iLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkNvbmNlbnRyYXRpb25NZXRlck5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTMtMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQ29uY2VudHJhdGlvbiBtZXRlciwgd2l0aCBwcm9iZS5cclxuICogVGhlIHByb2JlIHJlZ2lzdGVycyB0aGUgY29uY2VudHJhdGlvbiBvZiBhbGwgcG9zc2libGUgZmx1aWRzIHRoYXQgaXQgbWF5IGNvbnRhY3QsIGluY2x1ZGluZzpcclxuICpcclxuICogLSBzb2x1dGlvbiBpbiB0aGUgYmVha2VyXHJcbiAqIC0gb3V0cHV0IG9mIHRoZSBzb2x2ZW50IGZhdWNldFxyXG4gKiAtIG91dHB1dCBvZiB0aGUgZHJhaW4gZmF1Y2V0XHJcbiAqIC0gb3V0cHV0IG9mIHRoZSBkcm9wcGVyXHJcbiAqXHJcbiAqIFJhdGhlciB0aGFuIHRyeWluZyB0byBtb2RlbCB0aGUgc2hhcGVzIG9mIGFsbCBvZiB0aGVzZSBmbHVpZHMsIHdlIGhhbmRsZSAncHJvYmUgaXMgaW4gZmx1aWQnXHJcbiAqIGhlcmVpbiB2aWEgaW50ZXJzZWN0aW9uIG9mIFBhdGggc2hhcGVzLlxyXG4gKlxyXG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxyXG4gKi9cclxuXHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IEJvdW5kczIgZnJvbSAnLi4vLi4vLi4vLi4vZG90L2pzL0JvdW5kczIuanMnO1xyXG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XHJcbmltcG9ydCBVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVXRpbHMuanMnO1xyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xyXG5pbXBvcnQgUGlja1JlcXVpcmVkIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy90eXBlcy9QaWNrUmVxdWlyZWQuanMnO1xyXG5pbXBvcnQgU3RyaW5nVXRpbHMgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy91dGlsL1N0cmluZ1V0aWxzLmpzJztcclxuaW1wb3J0IE1vZGVsVmlld1RyYW5zZm9ybTIgZnJvbSAnLi4vLi4vLi4vLi4vcGhldGNvbW1vbi9qcy92aWV3L01vZGVsVmlld1RyYW5zZm9ybTIuanMnO1xyXG5pbXBvcnQgTWF0aFN5bWJvbHMgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL01hdGhTeW1ib2xzLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCBQcm9iZU5vZGUsIHsgUHJvYmVOb2RlT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9Qcm9iZU5vZGUuanMnO1xyXG5pbXBvcnQgU2hhZGVkUmVjdGFuZ2xlIGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9TaGFkZWRSZWN0YW5nbGUuanMnO1xyXG5pbXBvcnQgeyBEcmFnTGlzdGVuZXIsIE5vZGUsIE5vZGVPcHRpb25zLCBQYXRoLCBQYXRoT3B0aW9ucywgVGV4dCwgVkJveCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XHJcbmltcG9ydCBiZWVyc0xhd0xhYiBmcm9tICcuLi8uLi9iZWVyc0xhd0xhYi5qcyc7XHJcbmltcG9ydCBCZWVyc0xhd0xhYlN0cmluZ3MgZnJvbSAnLi4vLi4vQmVlcnNMYXdMYWJTdHJpbmdzLmpzJztcclxuaW1wb3J0IENvbmNlbnRyYXRpb25NZXRlciBmcm9tICcuLi9tb2RlbC9Db25jZW50cmF0aW9uTWV0ZXIuanMnO1xyXG5pbXBvcnQgQ29uY2VudHJhdGlvblNvbHV0aW9uIGZyb20gJy4uL21vZGVsL0NvbmNlbnRyYXRpb25Tb2x1dGlvbi5qcyc7XHJcbmltcG9ydCBEcm9wcGVyIGZyb20gJy4uL21vZGVsL0Ryb3BwZXIuanMnO1xyXG5pbXBvcnQgQkxMTW92YWJsZSBmcm9tICcuLi8uLi9jb21tb24vbW9kZWwvQkxMTW92YWJsZS5qcyc7XHJcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQkxMUHJlZmVyZW5jZXMgZnJvbSAnLi4vLi4vY29tbW9uL21vZGVsL0JMTFByZWZlcmVuY2VzLmpzJztcclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCBTdHJpbmdJTyBmcm9tICcuLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvU3RyaW5nSU8uanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IERFQ0lNQUxfUExBQ0VTX01PTEVTX1BFUl9MSVRFUiA9IDM7XHJcbmNvbnN0IERFQ0lNQUxfUExBQ0VTX1BFUkNFTlQgPSAxO1xyXG5jb25zdCBSRUFET1VUX05PX1ZBTFVFID0gTWF0aFN5bWJvbHMuTk9fVkFMVUU7IC8vIGRpc3BsYXllZCBpbiB0aGUgcmVhZG91dCB3aGVuIHRoZSBtZXRlciBpcyBub3QgbWVhc3VyaW5nIGFueXRoaW5nXHJcbmNvbnN0IEJPRFlfWF9NQVJHSU4gPSAxNTtcclxuY29uc3QgQk9EWV9ZX01BUkdJTiA9IDE1O1xyXG5jb25zdCBSRUFET1VUX1hfTUFSR0lOID0gNTtcclxuY29uc3QgUkVBRE9VVF9ZX01BUkdJTiA9IDQ7XHJcbmNvbnN0IFBST0JFX0NPTE9SID0gJ3JnYiggMTM1LCA0LCA3MiApJztcclxuY29uc3QgTUlOX1ZBTFVFX1NJWkUgPSBuZXcgRGltZW5zaW9uMiggMTQwLCAzNSApO1xyXG5jb25zdCBNSU5fQk9EWV9TSVpFID0gbmV3IERpbWVuc2lvbjIoIDE3MCwgMTAwICk7XHJcblxyXG50eXBlIFNlbGZPcHRpb25zID0gRW1wdHlTZWxmT3B0aW9ucztcclxuXHJcbnR5cGUgQ29uY2VudHJhdGlvbk1ldGVyTm9kZU9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFBpY2tSZXF1aXJlZDxOb2RlT3B0aW9ucywgJ3RhbmRlbSc+O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29uY2VudHJhdGlvbk1ldGVyTm9kZSBleHRlbmRzIE5vZGUge1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIGNvbmNlbnRyYXRpb25NZXRlcjogQ29uY2VudHJhdGlvbk1ldGVyLCBzb2x1dGlvbjogQ29uY2VudHJhdGlvblNvbHV0aW9uLCBkcm9wcGVyOiBEcm9wcGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgc29sdXRpb25Ob2RlOiBQYXRoLCBzdG9ja1NvbHV0aW9uTm9kZTogUGF0aCwgc29sdmVudEZsdWlkTm9kZTogUGF0aCwgZHJhaW5GbHVpZE5vZGU6IFBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTIsIHByb3ZpZGVkT3B0aW9uczogQ29uY2VudHJhdGlvbk1ldGVyTm9kZU9wdGlvbnMgKSB7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHByb3ZpZGVkT3B0aW9ucztcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIGNvbnN0IGJvZHlOb2RlID0gbmV3IEJvZHlOb2RlKCBjb25jZW50cmF0aW9uTWV0ZXIsIG1vZGVsVmlld1RyYW5zZm9ybSwgb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnYm9keU5vZGUnICkgKTtcclxuXHJcbiAgICBjb25zdCBwcm9iZU5vZGUgPSBuZXcgQ29uY2VudHJhdGlvblByb2JlTm9kZSggY29uY2VudHJhdGlvbk1ldGVyLnByb2JlLCBtb2RlbFZpZXdUcmFuc2Zvcm0sIHNvbHV0aW9uTm9kZSwgc3RvY2tTb2x1dGlvbk5vZGUsXHJcbiAgICAgIHNvbHZlbnRGbHVpZE5vZGUsIGRyYWluRmx1aWROb2RlLCBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdwcm9iZU5vZGUnICkgKTtcclxuXHJcbiAgICBjb25zdCB3aXJlTm9kZSA9IG5ldyBXaXJlTm9kZSggY29uY2VudHJhdGlvbk1ldGVyLmJvZHlQb3NpdGlvbiwgY29uY2VudHJhdGlvbk1ldGVyLnByb2JlLCBib2R5Tm9kZSwgcHJvYmVOb2RlICk7XHJcblxyXG4gICAgLy8gcmVuZGVyaW5nIG9yZGVyXHJcbiAgICB0aGlzLmFkZENoaWxkKCB3aXJlTm9kZSApO1xyXG4gICAgdGhpcy5hZGRDaGlsZCggYm9keU5vZGUgKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHByb2JlTm9kZSApO1xyXG5cclxuICAgIGNvbnN0IHVwZGF0ZVZhbHVlID0gKCkgPT4ge1xyXG4gICAgICBpZiAoIHByb2JlTm9kZS5pc0luU29sdXRpb24oKSB8fCBwcm9iZU5vZGUuaXNJbkRyYWluRmx1aWQoKSApIHtcclxuICAgICAgICBjb25jZW50cmF0aW9uTWV0ZXIudmFsdWVQcm9wZXJ0eS52YWx1ZSA9ICggQkxMUHJlZmVyZW5jZXMuY29uY2VudHJhdGlvbk1ldGVyVW5pdHNQcm9wZXJ0eS52YWx1ZSA9PT0gJ21vbGVzUGVyTGl0ZXInICkgP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29sdXRpb24uY29uY2VudHJhdGlvblByb3BlcnR5LnZhbHVlIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvbHV0aW9uLnBlcmNlbnRDb25jZW50cmF0aW9uUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAoIHByb2JlTm9kZS5pc0luU29sdmVudCgpICkge1xyXG4gICAgICAgIGNvbmNlbnRyYXRpb25NZXRlci52YWx1ZVByb3BlcnR5LnZhbHVlID0gMDtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmICggcHJvYmVOb2RlLmlzSW5TdG9ja1NvbHV0aW9uKCkgKSB7XHJcbiAgICAgICAgY29uY2VudHJhdGlvbk1ldGVyLnZhbHVlUHJvcGVydHkudmFsdWUgPSAoIEJMTFByZWZlcmVuY2VzLmNvbmNlbnRyYXRpb25NZXRlclVuaXRzUHJvcGVydHkudmFsdWUgPT09ICdtb2xlc1BlckxpdGVyJyApID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BwZXIuc29sdXRlUHJvcGVydHkudmFsdWUuc3RvY2tTb2x1dGlvbkNvbmNlbnRyYXRpb24gOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcHBlci5zb2x1dGVQcm9wZXJ0eS52YWx1ZS5zdG9ja1NvbHV0aW9uUGVyY2VudENvbmNlbnRyYXRpb247XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgY29uY2VudHJhdGlvbk1ldGVyLnZhbHVlUHJvcGVydHkudmFsdWUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFtcclxuICAgICAgQkxMUHJlZmVyZW5jZXMuY29uY2VudHJhdGlvbk1ldGVyVW5pdHNQcm9wZXJ0eSxcclxuICAgICAgY29uY2VudHJhdGlvbk1ldGVyLnByb2JlLnBvc2l0aW9uUHJvcGVydHksXHJcbiAgICAgIHNvbHV0aW9uLnNvbHV0ZVByb3BlcnR5LFxyXG4gICAgICBzb2x1dGlvbi5jb25jZW50cmF0aW9uUHJvcGVydHksXHJcbiAgICAgIHNvbHV0aW9uLnBlcmNlbnRDb25jZW50cmF0aW9uUHJvcGVydHksXHJcbiAgICAgIHNvbHV0aW9uTm9kZS5ib3VuZHNQcm9wZXJ0eSxcclxuICAgICAgc3RvY2tTb2x1dGlvbk5vZGUuYm91bmRzUHJvcGVydHksXHJcbiAgICAgIHNvbHZlbnRGbHVpZE5vZGUuYm91bmRzUHJvcGVydHksXHJcbiAgICAgIGRyYWluRmx1aWROb2RlLmJvdW5kc1Byb3BlcnR5XHJcbiAgICBdLCAoKSA9PiB1cGRhdGVWYWx1ZSgpICk7XHJcblxyXG4gICAgdGhpcy5hZGRMaW5rZWRFbGVtZW50KCBjb25jZW50cmF0aW9uTWV0ZXIsIHtcclxuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdjb25jZW50cmF0aW9uTWV0ZXInIClcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggZmFsc2UsICdkaXNwb3NlIGlzIG5vdCBzdXBwb3J0ZWQsIGV4aXN0cyBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBzaW0nICk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogTWV0ZXIgYm9keSwgb3JpZ2luIGF0IHVwcGVyIGxlZnQuIE5vdGUgdGhhdCB3aGlsZSB0aGUgYm9keSBpcyBhIEJMTE1vdmFibGUsIHdlIGhhdmUgY3VycmVudGx5IGRlY2lkZWQgbm90IHRvXHJcbiAqIGFsbG93IGl0IHRvIGJlIG1vdmVkLCBzbyBpdCBoYXMgbm8gZHJhZyBoYW5kbGVyLlxyXG4gKi9cclxuY2xhc3MgQm9keU5vZGUgZXh0ZW5kcyBOb2RlIHtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBjb25jZW50cmF0aW9uTWV0ZXI6IENvbmNlbnRyYXRpb25NZXRlciwgbW9kZWxWaWV3VHJhbnNmb3JtOiBNb2RlbFZpZXdUcmFuc2Zvcm0yLCB0YW5kZW06IFRhbmRlbSApIHtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zOiBOb2RlT3B0aW9ucyA9IHtcclxuICAgICAgY3Vyc29yOiAncG9pbnRlcicsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLFxyXG4gICAgICBwaGV0aW9WaXNpYmxlUHJvcGVydHlJbnN0cnVtZW50ZWQ6IGZhbHNlXHJcbiAgICB9O1xyXG5cclxuICAgIHN1cGVyKCBvcHRpb25zICk7XHJcblxyXG4gICAgY29uc3QgbGFiZWxUZXh0ID0gbmV3IFRleHQoIEJlZXJzTGF3TGFiU3RyaW5ncy5jb25jZW50cmF0aW9uU3RyaW5nUHJvcGVydHksIHtcclxuICAgICAgZm9udDogbmV3IFBoZXRGb250KCAxOCApLFxyXG4gICAgICBmaWxsOiAnd2hpdGUnLFxyXG4gICAgICBtYXhXaWR0aDogMTI1LFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdsYWJlbFRleHQnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyB2YWx1ZSArIHVuaXRzXHJcbiAgICBjb25zdCB2YWx1ZVRleHRUYW5kZW0gPSB0YW5kZW0uY3JlYXRlVGFuZGVtKCAndmFsdWVUZXh0JyApO1xyXG4gICAgY29uc3QgdmFsdWVTdHJpbmdQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoXHJcbiAgICAgIFtcclxuICAgICAgICBCZWVyc0xhd0xhYlN0cmluZ3MucGF0dGVyblsgJzB2YWx1ZScgXVsgJzF1bml0c1N0cmluZ1Byb3BlcnR5JyBdLFxyXG4gICAgICAgIEJlZXJzTGF3TGFiU3RyaW5ncy5wYXR0ZXJuWyAnMHBlcmNlbnRTdHJpbmdQcm9wZXJ0eScgXSxcclxuICAgICAgICBjb25jZW50cmF0aW9uTWV0ZXIudmFsdWVQcm9wZXJ0eSxcclxuICAgICAgICBCZWVyc0xhd0xhYlN0cmluZ3MudW5pdHMubW9sZXNQZXJMaXRlclN0cmluZ1Byb3BlcnR5LFxyXG4gICAgICAgIEJMTFByZWZlcmVuY2VzLmNvbmNlbnRyYXRpb25NZXRlclVuaXRzUHJvcGVydHlcclxuICAgICAgXSxcclxuICAgICAgKCBwYXR0ZXJuVmFsdWVVbml0cywgcGF0dGVyblZhbHVlUGVyY2VudCwgdmFsdWUsIG1vbGVzUGVyTGl0ZXJTdHJpbmcsIGNvbmNlbnRyYXRpb25NZXRlclVuaXRzICkgPT4ge1xyXG4gICAgICAgIGxldCB0ZXh0OiBzdHJpbmc7XHJcbiAgICAgICAgaWYgKCB2YWx1ZSA9PT0gbnVsbCApIHtcclxuICAgICAgICAgIHRleHQgPSBSRUFET1VUX05PX1ZBTFVFO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgICAvLyBkaXNwbGF5IGNvbmNlbnRyYXRpb24gYXMgJ21vbC9MJyBvciAnJScsIHNlZSBiZWVycy1sYXctbGFiIzE0OVxyXG4gICAgICAgICAgaWYgKCBjb25jZW50cmF0aW9uTWV0ZXJVbml0cyA9PT0gJ21vbGVzUGVyTGl0ZXInICkge1xyXG4gICAgICAgICAgICB0ZXh0ID0gU3RyaW5nVXRpbHMuZm9ybWF0KCBwYXR0ZXJuVmFsdWVVbml0cywgVXRpbHMudG9GaXhlZCggdmFsdWUsIERFQ0lNQUxfUExBQ0VTX01PTEVTX1BFUl9MSVRFUiApLCBtb2xlc1BlckxpdGVyU3RyaW5nICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGV4dCA9IFN0cmluZ1V0aWxzLmZvcm1hdCggcGF0dGVyblZhbHVlUGVyY2VudCwgVXRpbHMudG9GaXhlZCggdmFsdWUsIERFQ0lNQUxfUExBQ0VTX1BFUkNFTlQgKSApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGV4dDtcclxuICAgICAgfSwge1xyXG4gICAgICAgIHRhbmRlbTogdmFsdWVUZXh0VGFuZGVtLmNyZWF0ZVRhbmRlbSggVGV4dC5TVFJJTkdfUFJPUEVSVFlfVEFOREVNX05BTUUgKSxcclxuICAgICAgICBwaGV0aW9WYWx1ZVR5cGU6IFN0cmluZ0lPXHJcbiAgICAgIH0gKTtcclxuICAgIGNvbnN0IHZhbHVlVGV4dCA9IG5ldyBUZXh0KCB2YWx1ZVN0cmluZ1Byb3BlcnR5LCB7XHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggMjIgKSxcclxuICAgICAgZmlsbDogJ2JsYWNrJyxcclxuICAgICAgbWF4V2lkdGg6IDEyNSxcclxuICAgICAgdGFuZGVtOiB2YWx1ZVRleHRUYW5kZW0sXHJcbiAgICAgIHN0cmluZ1Byb3BlcnR5T3B0aW9uczogeyBwaGV0aW9SZWFkT25seTogdHJ1ZSB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYmFja2dyb3VuZCBiZWhpbmQgdGhlIHZhbHVlXHJcbiAgICBjb25zdCBiYWNrZ3JvdW5kV2lkdGggPSBNYXRoLm1heCggTUlOX1ZBTFVFX1NJWkUud2lkdGgsIE1hdGgubWF4KCBsYWJlbFRleHQud2lkdGgsIHZhbHVlVGV4dC53aWR0aCApICsgKCAyICogUkVBRE9VVF9YX01BUkdJTiApICk7XHJcbiAgICBjb25zdCBiYWNrZ3JvdW5kSGVpZ2h0ID0gTWF0aC5tYXgoIE1JTl9WQUxVRV9TSVpFLmhlaWdodCwgdmFsdWVUZXh0LmhlaWdodCArICggMiAqIFJFQURPVVRfWV9NQVJHSU4gKSApO1xyXG4gICAgY29uc3QgYmFja2dyb3VuZE5vZGUgPSBuZXcgU2hhZGVkUmVjdGFuZ2xlKCBuZXcgQm91bmRzMiggMCwgMCwgYmFja2dyb3VuZFdpZHRoLCBiYWNrZ3JvdW5kSGVpZ2h0ICksIHtcclxuICAgICAgYmFzZUNvbG9yOiAnd2hpdGUnLFxyXG4gICAgICBsaWdodFNvdXJjZTogJ3JpZ2h0Qm90dG9tJ1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHZlcnRpY2FsIGFycmFuZ2VtZW50IG9mIHN0dWZmIGluIHRoZSBjb25jZW50cmF0aW9uTWV0ZXJcclxuICAgIGNvbnN0IHZCb3ggPSBuZXcgVkJveCgge1xyXG4gICAgICBleGNsdWRlSW52aXNpYmxlQ2hpbGRyZW5Gcm9tQm91bmRzOiBmYWxzZSxcclxuICAgICAgY2hpbGRyZW46IFsgbGFiZWxUZXh0LCBuZXcgTm9kZSggeyBjaGlsZHJlbjogWyBiYWNrZ3JvdW5kTm9kZSwgdmFsdWVUZXh0IF0gfSApIF0sXHJcbiAgICAgIGFsaWduOiAnY2VudGVyJyxcclxuICAgICAgc3BhY2luZzogMThcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBjb25jZW50cmF0aW9uTWV0ZXIgYm9keVxyXG4gICAgY29uc3QgYm9keVdpZHRoID0gTWF0aC5tYXgoIE1JTl9CT0RZX1NJWkUud2lkdGgsIHZCb3gud2lkdGggKyAoIDIgKiBCT0RZX1hfTUFSR0lOICkgKTtcclxuICAgIGNvbnN0IGJvZHlIZWlnaHQgPSBNYXRoLm1heCggTUlOX0JPRFlfU0laRS5oZWlnaHQsIHZCb3guaGVpZ2h0ICsgKCAyICogQk9EWV9ZX01BUkdJTiApICk7XHJcbiAgICBjb25zdCBib2R5Tm9kZSA9IG5ldyBTaGFkZWRSZWN0YW5nbGUoIG5ldyBCb3VuZHMyKCAwLCAwLCBib2R5V2lkdGgsIGJvZHlIZWlnaHQgKSwge1xyXG4gICAgICBiYXNlQ29sb3I6IFBST0JFX0NPTE9SLFxyXG4gICAgICBsaWdodE9mZnNldDogMC45NVxyXG4gICAgfSApO1xyXG5cclxuICAgIHZCb3guYm91bmRzUHJvcGVydHkubGluayggYm91bmRzID0+IHtcclxuICAgICAgdkJveC5jZW50ZXIgPSBib2R5Tm9kZS5jZW50ZXI7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5jaGlsZHJlbiA9IFsgYm9keU5vZGUsIHZCb3ggXTtcclxuXHJcbiAgICAvLyBib2R5IHBvc2l0aW9uXHJcbiAgICB0aGlzLnRyYW5zbGF0aW9uID0gbW9kZWxWaWV3VHJhbnNmb3JtLm1vZGVsVG9WaWV3UG9zaXRpb24oIGNvbmNlbnRyYXRpb25NZXRlci5ib2R5UG9zaXRpb24gKTtcclxuXHJcbiAgICAvLyBLZWVwIHRoZSB2YWx1ZSBwcm9wZXJseSBqdXN0aWZpZWQgb24gdGhlIGJhY2tncm91bmRcclxuICAgIHZhbHVlVGV4dC5ib3VuZHNQcm9wZXJ0eS5saW5rKCBib3VuZHMgPT4ge1xyXG4gICAgICBpZiAoIGNvbmNlbnRyYXRpb25NZXRlci52YWx1ZVByb3BlcnR5LnZhbHVlID09PSBudWxsICkge1xyXG5cclxuICAgICAgICAvLyBjZW50ZXIganVzdGlmaWVkXHJcbiAgICAgICAgdmFsdWVUZXh0LmNlbnRlclggPSBiYWNrZ3JvdW5kTm9kZS5jZW50ZXJYO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIHJpZ2h0IGp1c3RpZmllZFxyXG4gICAgICAgIHZhbHVlVGV4dC5yaWdodCA9IGJhY2tncm91bmROb2RlLnJpZ2h0IC0gUkVBRE9VVF9YX01BUkdJTjtcclxuICAgICAgfVxyXG4gICAgICB2YWx1ZVRleHQuY2VudGVyWSA9IGJhY2tncm91bmROb2RlLmNlbnRlclk7XHJcbiAgICB9ICk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogTWV0ZXIgcHJvYmUsIG9yaWdpbiBhdCBjZW50ZXIgb2YgY3Jvc3NoYWlycy5cclxuICovXHJcbmNsYXNzIENvbmNlbnRyYXRpb25Qcm9iZU5vZGUgZXh0ZW5kcyBQcm9iZU5vZGUge1xyXG5cclxuICBwdWJsaWMgcmVhZG9ubHkgaXNJblNvbHV0aW9uOiAoKSA9PiBib29sZWFuO1xyXG4gIHB1YmxpYyByZWFkb25seSBpc0luU29sdmVudDogKCkgPT4gYm9vbGVhbjtcclxuICBwdWJsaWMgcmVhZG9ubHkgaXNJbkRyYWluRmx1aWQ6ICgpID0+IGJvb2xlYW47XHJcbiAgcHVibGljIHJlYWRvbmx5IGlzSW5TdG9ja1NvbHV0aW9uOiAoKSA9PiBib29sZWFuO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIHByb2JlOiBCTExNb3ZhYmxlLCBtb2RlbFZpZXdUcmFuc2Zvcm06IE1vZGVsVmlld1RyYW5zZm9ybTIsIHNvbHV0aW9uTm9kZTogUGF0aCxcclxuICAgICAgICAgICAgICAgICAgICAgIHN0b2NrU29sdXRpb25Ob2RlOiBQYXRoLCBzb2x2ZW50Rmx1aWROb2RlOiBQYXRoLCBkcmFpbkZsdWlkTm9kZTogUGF0aCxcclxuICAgICAgICAgICAgICAgICAgICAgIHRhbmRlbTogVGFuZGVtICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnM6IFByb2JlTm9kZU9wdGlvbnMgPSB7XHJcbiAgICAgIHNlbnNvclR5cGVGdW5jdGlvbjogUHJvYmVOb2RlLmNyb3NzaGFpcnMoIHtcclxuICAgICAgICBpbnRlcnNlY3Rpb25SYWRpdXM6IDZcclxuICAgICAgfSApLFxyXG4gICAgICByYWRpdXM6IDM0LFxyXG4gICAgICBpbm5lclJhZGl1czogMjYsXHJcbiAgICAgIGhhbmRsZVdpZHRoOiAzMCxcclxuICAgICAgaGFuZGxlSGVpZ2h0OiAyNSxcclxuICAgICAgaGFuZGxlQ29ybmVyUmFkaXVzOiAxMixcclxuICAgICAgbGlnaHRBbmdsZTogMS43NSAqIE1hdGguUEksXHJcbiAgICAgIGNvbG9yOiBQUk9CRV9DT0xPUixcclxuICAgICAgcm90YXRpb246IC1NYXRoLlBJIC8gMixcclxuICAgICAgY3Vyc29yOiAncG9pbnRlcicsXHJcblxyXG4gICAgICAvLyBwaGV0LWlvXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLFxyXG4gICAgICBwaGV0aW9JbnB1dEVuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZDogdHJ1ZSxcclxuICAgICAgcGhldGlvVmlzaWJsZVByb3BlcnR5SW5zdHJ1bWVudGVkOiBmYWxzZVxyXG4gICAgfTtcclxuXHJcbiAgICBzdXBlciggb3B0aW9ucyApO1xyXG5cclxuICAgIC8vIHByb2JlIHBvc2l0aW9uXHJcbiAgICBwcm9iZS5wb3NpdGlvblByb3BlcnR5LmxpbmsoIHBvc2l0aW9uID0+IHtcclxuICAgICAgdGhpcy50cmFuc2xhdGlvbiA9IG1vZGVsVmlld1RyYW5zZm9ybS5tb2RlbFRvVmlld1Bvc2l0aW9uKCBwb3NpdGlvbiApO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHRvdWNoIGFyZWFcclxuICAgIHRoaXMudG91Y2hBcmVhID0gdGhpcy5sb2NhbEJvdW5kcy5kaWxhdGVkWFkoIDAuMjUgKiB0aGlzLndpZHRoLCAwLjI1ICogdGhpcy5oZWlnaHQgKTtcclxuXHJcbiAgICAvLyBkcmFnIGxpc3RlbmVyXHJcbiAgICB0aGlzLmFkZElucHV0TGlzdGVuZXIoIG5ldyBEcmFnTGlzdGVuZXIoIHtcclxuICAgICAgcG9zaXRpb25Qcm9wZXJ0eTogcHJvYmUucG9zaXRpb25Qcm9wZXJ0eSxcclxuICAgICAgZHJhZ0JvdW5kc1Byb3BlcnR5OiBuZXcgUHJvcGVydHkoIHByb2JlLmRyYWdCb3VuZHMgKSxcclxuICAgICAgdHJhbnNmb3JtOiBtb2RlbFZpZXdUcmFuc2Zvcm0sXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RyYWdMaXN0ZW5lcicgKVxyXG4gICAgfSApICk7XHJcblxyXG4gICAgY29uc3QgaXNJbk5vZGUgPSAoIG5vZGU6IFBhdGggKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxvY2FsUG9pbnQgPSBub2RlLnBhcmVudFRvTG9jYWxQb2ludCggcHJvYmUucG9zaXRpb25Qcm9wZXJ0eS52YWx1ZSApO1xyXG4gICAgICBjb25zdCBub2RlU2hhcGUgPSBub2RlLmdldFNoYXBlKCkhO1xyXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCBub2RlU2hhcGUgKTtcclxuICAgICAgY29uc3Qgc2hhcGVCb3VuZHMgPSBub2RlU2hhcGUuYm91bmRzO1xyXG4gICAgICByZXR1cm4gc2hhcGVCb3VuZHMuZ2V0V2lkdGgoKSA+IDAgJiYgc2hhcGVCb3VuZHMuZ2V0SGVpZ2h0KCkgPiAwICYmIG5vZGVTaGFwZS5jb250YWluc1BvaW50KCBsb2NhbFBvaW50ICk7IC8vIHNlZSBpc3N1ZSAjNjVcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5pc0luU29sdXRpb24gPSAoKSA9PiBpc0luTm9kZSggc29sdXRpb25Ob2RlICk7XHJcbiAgICB0aGlzLmlzSW5Tb2x2ZW50ID0gKCkgPT4gaXNJbk5vZGUoIHNvbHZlbnRGbHVpZE5vZGUgKTtcclxuICAgIHRoaXMuaXNJbkRyYWluRmx1aWQgPSAoKSA9PiBpc0luTm9kZSggZHJhaW5GbHVpZE5vZGUgKTtcclxuICAgIHRoaXMuaXNJblN0b2NrU29sdXRpb24gPSAoKSA9PiBpc0luTm9kZSggc3RvY2tTb2x1dGlvbk5vZGUgKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBXaXJlIHRoYXQgY29ubmVjdHMgdGhlIGJvZHkgYW5kIHByb2JlLlxyXG4gKi9cclxuY2xhc3MgV2lyZU5vZGUgZXh0ZW5kcyBQYXRoIHtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKCBib2R5UG9zaXRpb246IFZlY3RvcjIsIHByb2JlOiBCTExNb3ZhYmxlLCBib2R5Tm9kZTogTm9kZSwgcHJvYmVOb2RlOiBOb2RlICkge1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnM6IFBhdGhPcHRpb25zID0ge1xyXG4gICAgICBzdHJva2U6ICdncmF5JyxcclxuICAgICAgbGluZVdpZHRoOiA4LFxyXG4gICAgICBsaW5lQ2FwOiAnc3F1YXJlJyxcclxuICAgICAgbGluZUpvaW46ICdyb3VuZCcsXHJcblxyXG4gICAgICAvLyBubyBuZWVkIHRvIGRyYWcgdGhlIHdpcmUsIGFuZCB3ZSBkb24ndCB3YW50IHRvIGRvIGN1YmljLWN1cnZlIGludGVyc2VjdGlvbiBoZXJlLCBvciBoYXZlIGl0IGdldCBpbiB0aGUgd2F5XHJcbiAgICAgIHBpY2thYmxlOiBmYWxzZVxyXG4gICAgfTtcclxuXHJcbiAgICBzdXBlciggbmV3IFNoYXBlKCksIG9wdGlvbnMgKTtcclxuXHJcbiAgICBjb25zdCB1cGRhdGVDdXJ2ZSA9ICgpID0+IHtcclxuXHJcbiAgICAgIC8vIENvbm5lY3QgYm90dG9tLWNlbnRlciBvZiBib2R5IHRvIHJpZ2h0LWNlbnRlciBvZiBwcm9iZS5cclxuICAgICAgY29uc3QgYm9keUNvbm5lY3Rpb25Qb2ludCA9IG5ldyBWZWN0b3IyKCBib2R5Tm9kZS5jZW50ZXJYLCBib2R5Tm9kZS5ib3R0b20gLSAxMCApO1xyXG4gICAgICBjb25zdCBwcm9iZUNvbm5lY3Rpb25Qb2ludCA9IG5ldyBWZWN0b3IyKCBwcm9iZU5vZGUucmlnaHQsIHByb2JlTm9kZS5jZW50ZXJZICk7XHJcblxyXG4gICAgICAvLyBjb250cm9sIHBvaW50c1xyXG4gICAgICAvLyBUaGUgeSBjb29yZGluYXRlIG9mIHRoZSBib2R5J3MgY29udHJvbCBwb2ludCB2YXJpZXMgd2l0aCB0aGUgeCBkaXN0YW5jZSBiZXR3ZWVuIHRoZSBib2R5IGFuZCBwcm9iZS5cclxuICAgICAgY29uc3QgYzFPZmZzZXQgPSBuZXcgVmVjdG9yMiggMCwgVXRpbHMubGluZWFyKCAwLCA4MDAsIDAsIDIwMCwgYm9keU5vZGUuY2VudGVyWCAtIHByb2JlTm9kZS5sZWZ0ICkgKTsgLy8geCBkaXN0YW5jZSAtPiB5IGNvb3JkaW5hdGVcclxuICAgICAgY29uc3QgYzJPZmZzZXQgPSBuZXcgVmVjdG9yMiggNTAsIDAgKTtcclxuICAgICAgY29uc3QgYzEgPSBuZXcgVmVjdG9yMiggYm9keUNvbm5lY3Rpb25Qb2ludC54ICsgYzFPZmZzZXQueCwgYm9keUNvbm5lY3Rpb25Qb2ludC55ICsgYzFPZmZzZXQueSApO1xyXG4gICAgICBjb25zdCBjMiA9IG5ldyBWZWN0b3IyKCBwcm9iZUNvbm5lY3Rpb25Qb2ludC54ICsgYzJPZmZzZXQueCwgcHJvYmVDb25uZWN0aW9uUG9pbnQueSArIGMyT2Zmc2V0LnkgKTtcclxuXHJcbiAgICAgIHRoaXMuc2hhcGUgPSBuZXcgU2hhcGUoKVxyXG4gICAgICAgIC5tb3ZlVG8oIGJvZHlDb25uZWN0aW9uUG9pbnQueCwgYm9keUNvbm5lY3Rpb25Qb2ludC55IClcclxuICAgICAgICAuY3ViaWNDdXJ2ZVRvKCBjMS54LCBjMS55LCBjMi54LCBjMi55LCBwcm9iZUNvbm5lY3Rpb25Qb2ludC54LCBwcm9iZUNvbm5lY3Rpb25Qb2ludC55ICk7XHJcbiAgICB9O1xyXG4gICAgcHJvYmUucG9zaXRpb25Qcm9wZXJ0eS5saW5rKCB1cGRhdGVDdXJ2ZSApO1xyXG4gIH1cclxufVxyXG5cclxuYmVlcnNMYXdMYWIucmVnaXN0ZXIoICdDb25jZW50cmF0aW9uTWV0ZXJOb2RlJywgQ29uY2VudHJhdGlvbk1ldGVyTm9kZSApOyJdLCJt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