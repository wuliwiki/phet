// Copyright 2020-2022, University of Colorado Boulder

/**
 * a Scenery node that represents the span of an absolute value separated from the number line
 *
 * @author John Blanco (PhET Interactive Simulations)
 */

import Multilink from '../../../../axon/js/Multilink.js';
import NumberProperty from '../../../../axon/js/NumberProperty.js';
import { Shape } from '../../../../kite/js/imports.js';
import BackgroundNode from '../../../../scenery-phet/js/BackgroundNode.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { Node, Path, Text } from '../../../../scenery/js/imports.js';
import Animation from '../../../../twixt/js/Animation.js';
import Easing from '../../../../twixt/js/Easing.js';
import numberLineCommon from '../../numberLineCommon.js';
import NLCConstants from '../NLCConstants.js';
import AbsoluteValueLine from './AbsoluteValueLine.js';

// constants
const CAP_LENGTH = 10; // the "cap" is the end portion of the span, value is in screen coords
const ANIMATION_SPEED = 160; // in screen coords per second
const MAX_ANIMATION_DURATION = 0.5; // in seconds
const EQUATION_NUMBER_FONT = new PhetFont(18);
const EXAMPLE_EQUATION_NUMBER_NODE = new Text(8, {
  font: EQUATION_NUMBER_FONT
});
const ABSOLUTE_VALUE_LINE_SPACING = 1;
const EQUALS_SIGN_SPACING = 4;
class AbsoluteValueSpanNode extends Node {
  /**
   * @param {NumberLine} numberLine - the number line for which this will be displayed
   * @param {NumberLinePoint} numberLinePoint
   * @param {number} initialDistanceFromNumberLine
   * @public
   */
  constructor(numberLine, numberLinePoint, initialDistanceFromNumberLine) {
    super();

    // Control the visibility of this node.
    const visibilityUpdater = showAbsoluteValues => {
      this.visible = showAbsoluteValues;
    };
    numberLine.showAbsoluteValuesProperty.link(visibilityUpdater);

    // @public {number} - the distance in model/view coordinates of the line portion of the span from the number line
    this.distanceFromNumberLineProperty = new NumberProperty(initialDistanceFromNumberLine);

    // @public (read-only) {NumberLinePoint} - point whose absolute value is being displayed by this span
    this.numberLinePoint = numberLinePoint;

    // @private {null|Animation} - null when this span node is not animating
    this.translateAnimation = null;

    // Add the equation text.
    const equationNode = new Node();
    const equationBackground = new BackgroundNode(equationNode, NLCConstants.LABEL_BACKGROUND_OPTIONS);
    this.addChild(equationBackground);

    // Add the span indicator shape.
    const spanIndicatorNode = new Path(null, {
      stroke: numberLinePoint.colorProperty,
      lineWidth: 2
    });
    this.addChild(spanIndicatorNode);

    // Define a function to update the span shape.
    const updateSpanShape = () => {
      const spanIndicatorShape = new Shape();
      const distanceFromNumberLine = this.distanceFromNumberLineProperty.value;
      const pointPosition = numberLinePoint.getPositionInModelSpace();
      if (numberLine.isHorizontal) {
        spanIndicatorShape.moveTo(numberLine.centerPositionProperty.value.x, numberLine.centerPositionProperty.value.y - distanceFromNumberLine - CAP_LENGTH / 2);
        spanIndicatorShape.lineTo(numberLine.centerPositionProperty.value.x, numberLine.centerPositionProperty.value.y - distanceFromNumberLine + CAP_LENGTH / 2);
        spanIndicatorShape.moveTo(numberLine.centerPositionProperty.value.x, numberLine.centerPositionProperty.value.y - distanceFromNumberLine);
        spanIndicatorShape.lineTo(pointPosition.x, pointPosition.y - distanceFromNumberLine);
        spanIndicatorShape.moveTo(pointPosition.x, numberLine.centerPositionProperty.value.y - distanceFromNumberLine - CAP_LENGTH / 2);
        spanIndicatorShape.lineTo(pointPosition.x, numberLine.centerPositionProperty.value.y - distanceFromNumberLine + CAP_LENGTH / 2);
      } else {
        spanIndicatorShape.moveTo(numberLine.centerPositionProperty.value.x - distanceFromNumberLine - CAP_LENGTH / 2, numberLine.centerPositionProperty.value.y);
        spanIndicatorShape.lineTo(numberLine.centerPositionProperty.value.x - distanceFromNumberLine + CAP_LENGTH / 2, numberLine.centerPositionProperty.value.y);
        spanIndicatorShape.moveTo(numberLine.centerPositionProperty.value.x - distanceFromNumberLine, numberLine.centerPositionProperty.value.y);
        spanIndicatorShape.lineTo(pointPosition.x - distanceFromNumberLine, pointPosition.y);
        spanIndicatorShape.moveTo(pointPosition.x - distanceFromNumberLine - CAP_LENGTH / 2, pointPosition.y);
        spanIndicatorShape.lineTo(pointPosition.x - distanceFromNumberLine + CAP_LENGTH / 2, pointPosition.y);
      }
      spanIndicatorNode.shape = spanIndicatorShape;
    };

    // Define a function to update the text label.
    const updateEquation = () => {
      const value = numberLinePoint.valueProperty.value;
      equationNode.removeAllChildren();
      equationNode.addChild(new AbsoluteValueLine(EXAMPLE_EQUATION_NUMBER_NODE));
      equationNode.addChild(new Text(value, {
        font: EQUATION_NUMBER_FONT,
        left: equationNode.width + ABSOLUTE_VALUE_LINE_SPACING
      }));
      equationNode.addChild(new AbsoluteValueLine(EXAMPLE_EQUATION_NUMBER_NODE, {
        left: equationNode.width + ABSOLUTE_VALUE_LINE_SPACING
      }));
      equationNode.addChild(new Text('=', {
        font: EQUATION_NUMBER_FONT,
        left: equationNode.width + EQUALS_SIGN_SPACING
      }));
      equationNode.addChild(new Text(Math.abs(value), {
        font: EQUATION_NUMBER_FONT,
        left: equationNode.width + EQUALS_SIGN_SPACING
      }));
      const distanceFromNumberLine = this.distanceFromNumberLineProperty.value;
      const pointPosition = numberLinePoint.getPositionInModelSpace();
      if (numberLine.isHorizontal) {
        equationBackground.centerX = (numberLine.centerPositionProperty.value.x + pointPosition.x) / 2;
        equationBackground.bottom = numberLine.centerPositionProperty.value.y - distanceFromNumberLine - CAP_LENGTH / 2;
      } else {
        equationBackground.centerX = pointPosition.x - distanceFromNumberLine;
        if (value > 0) {
          equationBackground.bottom = pointPosition.y - 5;
        } else {
          equationBackground.top = pointPosition.y + 5;
        }
      }
    };

    // Update when the point value changes.
    numberLinePoint.valueProperty.link(() => {
      updateSpanShape();
      updateEquation();
    });

    // Update position when the orientation or displayed range of the number line changes.
    const positionAndShapeMultilink = Multilink.multilink([numberLine.orientationProperty, numberLine.displayedRangeProperty, this.distanceFromNumberLineProperty], () => {
      updateSpanShape();
      updateEquation();
    });

    // @private
    this.disposeAbsoluteValueSpanNode = () => {
      positionAndShapeMultilink.dispose();
      numberLine.showAbsoluteValuesProperty.unlink(visibilityUpdater);
    };
  }

  /**
   * @param {number} distance
   * @param {boolean} doAnimation
   * @public
   */
  setDistanceFromNumberLine(distance, doAnimation) {
    const currentDistanceFromNumberLine = this.distanceFromNumberLineProperty.value;
    if (distance === currentDistanceFromNumberLine) {
      return;
    }
    if (doAnimation) {
      const animationDuration = Math.min(Math.abs(currentDistanceFromNumberLine - distance) / ANIMATION_SPEED, MAX_ANIMATION_DURATION);
      const animationOptions = {
        property: this.distanceFromNumberLineProperty,
        to: distance,
        duration: animationDuration,
        easing: Easing.CUBIC_IN_OUT
      };

      // If an animation is in progress, stop it.
      if (this.translateAnimation) {
        this.translateAnimation.stop();
      }

      // Create and start a new animation.
      this.translateAnimation = new Animation(animationOptions);
      this.translateAnimation.start();

      // Set the current animation to null once it finishes (or is stopped).
      this.translateAnimation.endedEmitter.addListener(() => {
        this.translateAnimation = null;
      });
    } else {
      this.distanceFromNumberLineProperty.value = distance;
    }
  }

  /**
   * @public
   * @override
   */
  dispose() {
    this.disposeAbsoluteValueSpanNode();
    super.dispose();
  }
}
numberLineCommon.register('AbsoluteValueSpanNode', AbsoluteValueSpanNode);
export default AbsoluteValueSpanNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJOdW1iZXJQcm9wZXJ0eSIsIlNoYXBlIiwiQmFja2dyb3VuZE5vZGUiLCJQaGV0Rm9udCIsIk5vZGUiLCJQYXRoIiwiVGV4dCIsIkFuaW1hdGlvbiIsIkVhc2luZyIsIm51bWJlckxpbmVDb21tb24iLCJOTENDb25zdGFudHMiLCJBYnNvbHV0ZVZhbHVlTGluZSIsIkNBUF9MRU5HVEgiLCJBTklNQVRJT05fU1BFRUQiLCJNQVhfQU5JTUFUSU9OX0RVUkFUSU9OIiwiRVFVQVRJT05fTlVNQkVSX0ZPTlQiLCJFWEFNUExFX0VRVUFUSU9OX05VTUJFUl9OT0RFIiwiZm9udCIsIkFCU09MVVRFX1ZBTFVFX0xJTkVfU1BBQ0lORyIsIkVRVUFMU19TSUdOX1NQQUNJTkciLCJBYnNvbHV0ZVZhbHVlU3Bhbk5vZGUiLCJjb25zdHJ1Y3RvciIsIm51bWJlckxpbmUiLCJudW1iZXJMaW5lUG9pbnQiLCJpbml0aWFsRGlzdGFuY2VGcm9tTnVtYmVyTGluZSIsInZpc2liaWxpdHlVcGRhdGVyIiwic2hvd0Fic29sdXRlVmFsdWVzIiwidmlzaWJsZSIsInNob3dBYnNvbHV0ZVZhbHVlc1Byb3BlcnR5IiwibGluayIsImRpc3RhbmNlRnJvbU51bWJlckxpbmVQcm9wZXJ0eSIsInRyYW5zbGF0ZUFuaW1hdGlvbiIsImVxdWF0aW9uTm9kZSIsImVxdWF0aW9uQmFja2dyb3VuZCIsIkxBQkVMX0JBQ0tHUk9VTkRfT1BUSU9OUyIsImFkZENoaWxkIiwic3BhbkluZGljYXRvck5vZGUiLCJzdHJva2UiLCJjb2xvclByb3BlcnR5IiwibGluZVdpZHRoIiwidXBkYXRlU3BhblNoYXBlIiwic3BhbkluZGljYXRvclNoYXBlIiwiZGlzdGFuY2VGcm9tTnVtYmVyTGluZSIsInZhbHVlIiwicG9pbnRQb3NpdGlvbiIsImdldFBvc2l0aW9uSW5Nb2RlbFNwYWNlIiwiaXNIb3Jpem9udGFsIiwibW92ZVRvIiwiY2VudGVyUG9zaXRpb25Qcm9wZXJ0eSIsIngiLCJ5IiwibGluZVRvIiwic2hhcGUiLCJ1cGRhdGVFcXVhdGlvbiIsInZhbHVlUHJvcGVydHkiLCJyZW1vdmVBbGxDaGlsZHJlbiIsImxlZnQiLCJ3aWR0aCIsIk1hdGgiLCJhYnMiLCJjZW50ZXJYIiwiYm90dG9tIiwidG9wIiwicG9zaXRpb25BbmRTaGFwZU11bHRpbGluayIsIm11bHRpbGluayIsIm9yaWVudGF0aW9uUHJvcGVydHkiLCJkaXNwbGF5ZWRSYW5nZVByb3BlcnR5IiwiZGlzcG9zZUFic29sdXRlVmFsdWVTcGFuTm9kZSIsImRpc3Bvc2UiLCJ1bmxpbmsiLCJzZXREaXN0YW5jZUZyb21OdW1iZXJMaW5lIiwiZGlzdGFuY2UiLCJkb0FuaW1hdGlvbiIsImN1cnJlbnREaXN0YW5jZUZyb21OdW1iZXJMaW5lIiwiYW5pbWF0aW9uRHVyYXRpb24iLCJtaW4iLCJhbmltYXRpb25PcHRpb25zIiwicHJvcGVydHkiLCJ0byIsImR1cmF0aW9uIiwiZWFzaW5nIiwiQ1VCSUNfSU5fT1VUIiwic3RvcCIsInN0YXJ0IiwiZW5kZWRFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJyZWdpc3RlciJdLCJzb3VyY2VzIjpbIkFic29sdXRlVmFsdWVTcGFuTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMC0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBhIFNjZW5lcnkgbm9kZSB0aGF0IHJlcHJlc2VudHMgdGhlIHNwYW4gb2YgYW4gYWJzb2x1dGUgdmFsdWUgc2VwYXJhdGVkIGZyb20gdGhlIG51bWJlciBsaW5lXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCBOdW1iZXJQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL051bWJlclByb3BlcnR5LmpzJztcclxuaW1wb3J0IHsgU2hhcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9raXRlL2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgQmFja2dyb3VuZE5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL0JhY2tncm91bmROb2RlLmpzJztcclxuaW1wb3J0IFBoZXRGb250IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9QaGV0Rm9udC5qcyc7XHJcbmltcG9ydCB7IE5vZGUsIFBhdGgsIFRleHQgfSBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xyXG5pbXBvcnQgQW5pbWF0aW9uIGZyb20gJy4uLy4uLy4uLy4uL3R3aXh0L2pzL0FuaW1hdGlvbi5qcyc7XHJcbmltcG9ydCBFYXNpbmcgZnJvbSAnLi4vLi4vLi4vLi4vdHdpeHQvanMvRWFzaW5nLmpzJztcclxuaW1wb3J0IG51bWJlckxpbmVDb21tb24gZnJvbSAnLi4vLi4vbnVtYmVyTGluZUNvbW1vbi5qcyc7XHJcbmltcG9ydCBOTENDb25zdGFudHMgZnJvbSAnLi4vTkxDQ29uc3RhbnRzLmpzJztcclxuaW1wb3J0IEFic29sdXRlVmFsdWVMaW5lIGZyb20gJy4vQWJzb2x1dGVWYWx1ZUxpbmUuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IENBUF9MRU5HVEggPSAxMDsgLy8gdGhlIFwiY2FwXCIgaXMgdGhlIGVuZCBwb3J0aW9uIG9mIHRoZSBzcGFuLCB2YWx1ZSBpcyBpbiBzY3JlZW4gY29vcmRzXHJcbmNvbnN0IEFOSU1BVElPTl9TUEVFRCA9IDE2MDsgLy8gaW4gc2NyZWVuIGNvb3JkcyBwZXIgc2Vjb25kXHJcbmNvbnN0IE1BWF9BTklNQVRJT05fRFVSQVRJT04gPSAwLjU7IC8vIGluIHNlY29uZHNcclxuY29uc3QgRVFVQVRJT05fTlVNQkVSX0ZPTlQgPSBuZXcgUGhldEZvbnQoIDE4ICk7XHJcbmNvbnN0IEVYQU1QTEVfRVFVQVRJT05fTlVNQkVSX05PREUgPSBuZXcgVGV4dCggOCwgeyBmb250OiBFUVVBVElPTl9OVU1CRVJfRk9OVCB9ICk7XHJcbmNvbnN0IEFCU09MVVRFX1ZBTFVFX0xJTkVfU1BBQ0lORyA9IDE7XHJcbmNvbnN0IEVRVUFMU19TSUdOX1NQQUNJTkcgPSA0O1xyXG5cclxuY2xhc3MgQWJzb2x1dGVWYWx1ZVNwYW5Ob2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7TnVtYmVyTGluZX0gbnVtYmVyTGluZSAtIHRoZSBudW1iZXIgbGluZSBmb3Igd2hpY2ggdGhpcyB3aWxsIGJlIGRpc3BsYXllZFxyXG4gICAqIEBwYXJhbSB7TnVtYmVyTGluZVBvaW50fSBudW1iZXJMaW5lUG9pbnRcclxuICAgKiBAcGFyYW0ge251bWJlcn0gaW5pdGlhbERpc3RhbmNlRnJvbU51bWJlckxpbmVcclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG51bWJlckxpbmUsIG51bWJlckxpbmVQb2ludCwgaW5pdGlhbERpc3RhbmNlRnJvbU51bWJlckxpbmUgKSB7XHJcblxyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICAvLyBDb250cm9sIHRoZSB2aXNpYmlsaXR5IG9mIHRoaXMgbm9kZS5cclxuICAgIGNvbnN0IHZpc2liaWxpdHlVcGRhdGVyID0gc2hvd0Fic29sdXRlVmFsdWVzID0+IHsgdGhpcy52aXNpYmxlID0gc2hvd0Fic29sdXRlVmFsdWVzOyB9O1xyXG4gICAgbnVtYmVyTGluZS5zaG93QWJzb2x1dGVWYWx1ZXNQcm9wZXJ0eS5saW5rKCB2aXNpYmlsaXR5VXBkYXRlciApO1xyXG5cclxuICAgIC8vIEBwdWJsaWMge251bWJlcn0gLSB0aGUgZGlzdGFuY2UgaW4gbW9kZWwvdmlldyBjb29yZGluYXRlcyBvZiB0aGUgbGluZSBwb3J0aW9uIG9mIHRoZSBzcGFuIGZyb20gdGhlIG51bWJlciBsaW5lXHJcbiAgICB0aGlzLmRpc3RhbmNlRnJvbU51bWJlckxpbmVQcm9wZXJ0eSA9IG5ldyBOdW1iZXJQcm9wZXJ0eSggaW5pdGlhbERpc3RhbmNlRnJvbU51bWJlckxpbmUgKTtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIHtOdW1iZXJMaW5lUG9pbnR9IC0gcG9pbnQgd2hvc2UgYWJzb2x1dGUgdmFsdWUgaXMgYmVpbmcgZGlzcGxheWVkIGJ5IHRoaXMgc3BhblxyXG4gICAgdGhpcy5udW1iZXJMaW5lUG9pbnQgPSBudW1iZXJMaW5lUG9pbnQ7XHJcblxyXG4gICAgLy8gQHByaXZhdGUge251bGx8QW5pbWF0aW9ufSAtIG51bGwgd2hlbiB0aGlzIHNwYW4gbm9kZSBpcyBub3QgYW5pbWF0aW5nXHJcbiAgICB0aGlzLnRyYW5zbGF0ZUFuaW1hdGlvbiA9IG51bGw7XHJcblxyXG4gICAgLy8gQWRkIHRoZSBlcXVhdGlvbiB0ZXh0LlxyXG4gICAgY29uc3QgZXF1YXRpb25Ob2RlID0gbmV3IE5vZGUoKTtcclxuICAgIGNvbnN0IGVxdWF0aW9uQmFja2dyb3VuZCA9IG5ldyBCYWNrZ3JvdW5kTm9kZSggZXF1YXRpb25Ob2RlLCBOTENDb25zdGFudHMuTEFCRUxfQkFDS0dST1VORF9PUFRJT05TICk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBlcXVhdGlvbkJhY2tncm91bmQgKTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIHNwYW4gaW5kaWNhdG9yIHNoYXBlLlxyXG4gICAgY29uc3Qgc3BhbkluZGljYXRvck5vZGUgPSBuZXcgUGF0aCggbnVsbCwge1xyXG4gICAgICBzdHJva2U6IG51bWJlckxpbmVQb2ludC5jb2xvclByb3BlcnR5LFxyXG4gICAgICBsaW5lV2lkdGg6IDJcclxuICAgIH0gKTtcclxuICAgIHRoaXMuYWRkQ2hpbGQoIHNwYW5JbmRpY2F0b3JOb2RlICk7XHJcblxyXG4gICAgLy8gRGVmaW5lIGEgZnVuY3Rpb24gdG8gdXBkYXRlIHRoZSBzcGFuIHNoYXBlLlxyXG4gICAgY29uc3QgdXBkYXRlU3BhblNoYXBlID0gKCkgPT4ge1xyXG4gICAgICBjb25zdCBzcGFuSW5kaWNhdG9yU2hhcGUgPSBuZXcgU2hhcGUoKTtcclxuICAgICAgY29uc3QgZGlzdGFuY2VGcm9tTnVtYmVyTGluZSA9IHRoaXMuZGlzdGFuY2VGcm9tTnVtYmVyTGluZVByb3BlcnR5LnZhbHVlO1xyXG4gICAgICBjb25zdCBwb2ludFBvc2l0aW9uID0gbnVtYmVyTGluZVBvaW50LmdldFBvc2l0aW9uSW5Nb2RlbFNwYWNlKCk7XHJcbiAgICAgIGlmICggbnVtYmVyTGluZS5pc0hvcml6b250YWwgKSB7XHJcbiAgICAgICAgc3BhbkluZGljYXRvclNoYXBlLm1vdmVUbyhcclxuICAgICAgICAgIG51bWJlckxpbmUuY2VudGVyUG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS54LFxyXG4gICAgICAgICAgbnVtYmVyTGluZS5jZW50ZXJQb3NpdGlvblByb3BlcnR5LnZhbHVlLnkgLSBkaXN0YW5jZUZyb21OdW1iZXJMaW5lIC0gQ0FQX0xFTkdUSCAvIDJcclxuICAgICAgICApO1xyXG4gICAgICAgIHNwYW5JbmRpY2F0b3JTaGFwZS5saW5lVG8oXHJcbiAgICAgICAgICBudW1iZXJMaW5lLmNlbnRlclBvc2l0aW9uUHJvcGVydHkudmFsdWUueCxcclxuICAgICAgICAgIG51bWJlckxpbmUuY2VudGVyUG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS55IC0gZGlzdGFuY2VGcm9tTnVtYmVyTGluZSArIENBUF9MRU5HVEggLyAyXHJcbiAgICAgICAgKTtcclxuICAgICAgICBzcGFuSW5kaWNhdG9yU2hhcGUubW92ZVRvKFxyXG4gICAgICAgICAgbnVtYmVyTGluZS5jZW50ZXJQb3NpdGlvblByb3BlcnR5LnZhbHVlLngsXHJcbiAgICAgICAgICBudW1iZXJMaW5lLmNlbnRlclBvc2l0aW9uUHJvcGVydHkudmFsdWUueSAtIGRpc3RhbmNlRnJvbU51bWJlckxpbmVcclxuICAgICAgICApO1xyXG4gICAgICAgIHNwYW5JbmRpY2F0b3JTaGFwZS5saW5lVG8oIHBvaW50UG9zaXRpb24ueCwgcG9pbnRQb3NpdGlvbi55IC0gZGlzdGFuY2VGcm9tTnVtYmVyTGluZSApO1xyXG4gICAgICAgIHNwYW5JbmRpY2F0b3JTaGFwZS5tb3ZlVG8oXHJcbiAgICAgICAgICBwb2ludFBvc2l0aW9uLngsXHJcbiAgICAgICAgICBudW1iZXJMaW5lLmNlbnRlclBvc2l0aW9uUHJvcGVydHkudmFsdWUueSAtIGRpc3RhbmNlRnJvbU51bWJlckxpbmUgLSBDQVBfTEVOR1RIIC8gMlxyXG4gICAgICAgICk7XHJcbiAgICAgICAgc3BhbkluZGljYXRvclNoYXBlLmxpbmVUbyhcclxuICAgICAgICAgIHBvaW50UG9zaXRpb24ueCxcclxuICAgICAgICAgIG51bWJlckxpbmUuY2VudGVyUG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS55IC0gZGlzdGFuY2VGcm9tTnVtYmVyTGluZSArIENBUF9MRU5HVEggLyAyXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBzcGFuSW5kaWNhdG9yU2hhcGUubW92ZVRvKFxyXG4gICAgICAgICAgbnVtYmVyTGluZS5jZW50ZXJQb3NpdGlvblByb3BlcnR5LnZhbHVlLnggLSBkaXN0YW5jZUZyb21OdW1iZXJMaW5lIC0gQ0FQX0xFTkdUSCAvIDIsXHJcbiAgICAgICAgICBudW1iZXJMaW5lLmNlbnRlclBvc2l0aW9uUHJvcGVydHkudmFsdWUueVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgc3BhbkluZGljYXRvclNoYXBlLmxpbmVUbyhcclxuICAgICAgICAgIG51bWJlckxpbmUuY2VudGVyUG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS54IC0gZGlzdGFuY2VGcm9tTnVtYmVyTGluZSArIENBUF9MRU5HVEggLyAyLFxyXG4gICAgICAgICAgbnVtYmVyTGluZS5jZW50ZXJQb3NpdGlvblByb3BlcnR5LnZhbHVlLnlcclxuICAgICAgICApO1xyXG4gICAgICAgIHNwYW5JbmRpY2F0b3JTaGFwZS5tb3ZlVG8oIG51bWJlckxpbmUuY2VudGVyUG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS54IC0gZGlzdGFuY2VGcm9tTnVtYmVyTGluZSwgbnVtYmVyTGluZS5jZW50ZXJQb3NpdGlvblByb3BlcnR5LnZhbHVlLnkgKTtcclxuICAgICAgICBzcGFuSW5kaWNhdG9yU2hhcGUubGluZVRvKCBwb2ludFBvc2l0aW9uLnggLSBkaXN0YW5jZUZyb21OdW1iZXJMaW5lLCBwb2ludFBvc2l0aW9uLnkgKTtcclxuICAgICAgICBzcGFuSW5kaWNhdG9yU2hhcGUubW92ZVRvKFxyXG4gICAgICAgICAgcG9pbnRQb3NpdGlvbi54IC0gZGlzdGFuY2VGcm9tTnVtYmVyTGluZSAtIENBUF9MRU5HVEggLyAyLFxyXG4gICAgICAgICAgcG9pbnRQb3NpdGlvbi55XHJcbiAgICAgICAgKTtcclxuICAgICAgICBzcGFuSW5kaWNhdG9yU2hhcGUubGluZVRvKFxyXG4gICAgICAgICAgcG9pbnRQb3NpdGlvbi54IC0gZGlzdGFuY2VGcm9tTnVtYmVyTGluZSArIENBUF9MRU5HVEggLyAyLFxyXG4gICAgICAgICAgcG9pbnRQb3NpdGlvbi55XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgICBzcGFuSW5kaWNhdG9yTm9kZS5zaGFwZSA9IHNwYW5JbmRpY2F0b3JTaGFwZTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gRGVmaW5lIGEgZnVuY3Rpb24gdG8gdXBkYXRlIHRoZSB0ZXh0IGxhYmVsLlxyXG4gICAgY29uc3QgdXBkYXRlRXF1YXRpb24gPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHZhbHVlID0gbnVtYmVyTGluZVBvaW50LnZhbHVlUHJvcGVydHkudmFsdWU7XHJcbiAgICAgIGVxdWF0aW9uTm9kZS5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgICBlcXVhdGlvbk5vZGUuYWRkQ2hpbGQoIG5ldyBBYnNvbHV0ZVZhbHVlTGluZSggRVhBTVBMRV9FUVVBVElPTl9OVU1CRVJfTk9ERSApICk7XHJcbiAgICAgIGVxdWF0aW9uTm9kZS5hZGRDaGlsZCggbmV3IFRleHQoIHZhbHVlLCB7XHJcbiAgICAgICAgZm9udDogRVFVQVRJT05fTlVNQkVSX0ZPTlQsXHJcbiAgICAgICAgbGVmdDogZXF1YXRpb25Ob2RlLndpZHRoICsgQUJTT0xVVEVfVkFMVUVfTElORV9TUEFDSU5HXHJcbiAgICAgIH0gKSApO1xyXG4gICAgICBlcXVhdGlvbk5vZGUuYWRkQ2hpbGQoIG5ldyBBYnNvbHV0ZVZhbHVlTGluZSggRVhBTVBMRV9FUVVBVElPTl9OVU1CRVJfTk9ERSwge1xyXG4gICAgICAgIGxlZnQ6IGVxdWF0aW9uTm9kZS53aWR0aCArIEFCU09MVVRFX1ZBTFVFX0xJTkVfU1BBQ0lOR1xyXG4gICAgICB9ICkgKTtcclxuICAgICAgZXF1YXRpb25Ob2RlLmFkZENoaWxkKCBuZXcgVGV4dCggJz0nLCB7XHJcbiAgICAgICAgZm9udDogRVFVQVRJT05fTlVNQkVSX0ZPTlQsXHJcbiAgICAgICAgbGVmdDogZXF1YXRpb25Ob2RlLndpZHRoICsgRVFVQUxTX1NJR05fU1BBQ0lOR1xyXG4gICAgICB9ICkgKTtcclxuICAgICAgZXF1YXRpb25Ob2RlLmFkZENoaWxkKCBuZXcgVGV4dCggTWF0aC5hYnMoIHZhbHVlICksIHtcclxuICAgICAgICBmb250OiBFUVVBVElPTl9OVU1CRVJfRk9OVCxcclxuICAgICAgICBsZWZ0OiBlcXVhdGlvbk5vZGUud2lkdGggKyBFUVVBTFNfU0lHTl9TUEFDSU5HXHJcbiAgICAgIH0gKSApO1xyXG5cclxuICAgICAgY29uc3QgZGlzdGFuY2VGcm9tTnVtYmVyTGluZSA9IHRoaXMuZGlzdGFuY2VGcm9tTnVtYmVyTGluZVByb3BlcnR5LnZhbHVlO1xyXG4gICAgICBjb25zdCBwb2ludFBvc2l0aW9uID0gbnVtYmVyTGluZVBvaW50LmdldFBvc2l0aW9uSW5Nb2RlbFNwYWNlKCk7XHJcbiAgICAgIGlmICggbnVtYmVyTGluZS5pc0hvcml6b250YWwgKSB7XHJcbiAgICAgICAgZXF1YXRpb25CYWNrZ3JvdW5kLmNlbnRlclggPSAoIG51bWJlckxpbmUuY2VudGVyUG9zaXRpb25Qcm9wZXJ0eS52YWx1ZS54ICsgcG9pbnRQb3NpdGlvbi54ICkgLyAyO1xyXG4gICAgICAgIGVxdWF0aW9uQmFja2dyb3VuZC5ib3R0b20gPSBudW1iZXJMaW5lLmNlbnRlclBvc2l0aW9uUHJvcGVydHkudmFsdWUueSAtIGRpc3RhbmNlRnJvbU51bWJlckxpbmUgLSBDQVBfTEVOR1RIIC8gMjtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBlcXVhdGlvbkJhY2tncm91bmQuY2VudGVyWCA9IHBvaW50UG9zaXRpb24ueCAtIGRpc3RhbmNlRnJvbU51bWJlckxpbmU7XHJcbiAgICAgICAgaWYgKCB2YWx1ZSA+IDAgKSB7XHJcbiAgICAgICAgICBlcXVhdGlvbkJhY2tncm91bmQuYm90dG9tID0gcG9pbnRQb3NpdGlvbi55IC0gNTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBlcXVhdGlvbkJhY2tncm91bmQudG9wID0gcG9pbnRQb3NpdGlvbi55ICsgNTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gVXBkYXRlIHdoZW4gdGhlIHBvaW50IHZhbHVlIGNoYW5nZXMuXHJcbiAgICBudW1iZXJMaW5lUG9pbnQudmFsdWVQcm9wZXJ0eS5saW5rKCAoKSA9PiB7XHJcbiAgICAgIHVwZGF0ZVNwYW5TaGFwZSgpO1xyXG4gICAgICB1cGRhdGVFcXVhdGlvbigpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIFVwZGF0ZSBwb3NpdGlvbiB3aGVuIHRoZSBvcmllbnRhdGlvbiBvciBkaXNwbGF5ZWQgcmFuZ2Ugb2YgdGhlIG51bWJlciBsaW5lIGNoYW5nZXMuXHJcbiAgICBjb25zdCBwb3NpdGlvbkFuZFNoYXBlTXVsdGlsaW5rID0gTXVsdGlsaW5rLm11bHRpbGluayhcclxuICAgICAgWyBudW1iZXJMaW5lLm9yaWVudGF0aW9uUHJvcGVydHksIG51bWJlckxpbmUuZGlzcGxheWVkUmFuZ2VQcm9wZXJ0eSwgdGhpcy5kaXN0YW5jZUZyb21OdW1iZXJMaW5lUHJvcGVydHkgXSxcclxuICAgICAgKCkgPT4ge1xyXG4gICAgICAgIHVwZGF0ZVNwYW5TaGFwZSgpO1xyXG4gICAgICAgIHVwZGF0ZUVxdWF0aW9uKCk7XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgLy8gQHByaXZhdGVcclxuICAgIHRoaXMuZGlzcG9zZUFic29sdXRlVmFsdWVTcGFuTm9kZSA9ICgpID0+IHtcclxuICAgICAgcG9zaXRpb25BbmRTaGFwZU11bHRpbGluay5kaXNwb3NlKCk7XHJcbiAgICAgIG51bWJlckxpbmUuc2hvd0Fic29sdXRlVmFsdWVzUHJvcGVydHkudW5saW5rKCB2aXNpYmlsaXR5VXBkYXRlciApO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBkaXN0YW5jZVxyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gZG9BbmltYXRpb25cclxuICAgKiBAcHVibGljXHJcbiAgICovXHJcbiAgc2V0RGlzdGFuY2VGcm9tTnVtYmVyTGluZSggZGlzdGFuY2UsIGRvQW5pbWF0aW9uICkge1xyXG4gICAgY29uc3QgY3VycmVudERpc3RhbmNlRnJvbU51bWJlckxpbmUgPSB0aGlzLmRpc3RhbmNlRnJvbU51bWJlckxpbmVQcm9wZXJ0eS52YWx1ZTtcclxuICAgIGlmICggZGlzdGFuY2UgPT09IGN1cnJlbnREaXN0YW5jZUZyb21OdW1iZXJMaW5lICkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCBkb0FuaW1hdGlvbiApIHtcclxuICAgICAgY29uc3QgYW5pbWF0aW9uRHVyYXRpb24gPSBNYXRoLm1pbihcclxuICAgICAgICBNYXRoLmFicyggY3VycmVudERpc3RhbmNlRnJvbU51bWJlckxpbmUgLSBkaXN0YW5jZSApIC8gQU5JTUFUSU9OX1NQRUVELFxyXG4gICAgICAgIE1BWF9BTklNQVRJT05fRFVSQVRJT05cclxuICAgICAgKTtcclxuICAgICAgY29uc3QgYW5pbWF0aW9uT3B0aW9ucyA9IHtcclxuICAgICAgICBwcm9wZXJ0eTogdGhpcy5kaXN0YW5jZUZyb21OdW1iZXJMaW5lUHJvcGVydHksXHJcbiAgICAgICAgdG86IGRpc3RhbmNlLFxyXG4gICAgICAgIGR1cmF0aW9uOiBhbmltYXRpb25EdXJhdGlvbixcclxuICAgICAgICBlYXNpbmc6IEVhc2luZy5DVUJJQ19JTl9PVVRcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIElmIGFuIGFuaW1hdGlvbiBpcyBpbiBwcm9ncmVzcywgc3RvcCBpdC5cclxuICAgICAgaWYgKCB0aGlzLnRyYW5zbGF0ZUFuaW1hdGlvbiApIHtcclxuICAgICAgICB0aGlzLnRyYW5zbGF0ZUFuaW1hdGlvbi5zdG9wKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENyZWF0ZSBhbmQgc3RhcnQgYSBuZXcgYW5pbWF0aW9uLlxyXG4gICAgICB0aGlzLnRyYW5zbGF0ZUFuaW1hdGlvbiA9IG5ldyBBbmltYXRpb24oIGFuaW1hdGlvbk9wdGlvbnMgKTtcclxuICAgICAgdGhpcy50cmFuc2xhdGVBbmltYXRpb24uc3RhcnQoKTtcclxuXHJcbiAgICAgIC8vIFNldCB0aGUgY3VycmVudCBhbmltYXRpb24gdG8gbnVsbCBvbmNlIGl0IGZpbmlzaGVzIChvciBpcyBzdG9wcGVkKS5cclxuICAgICAgdGhpcy50cmFuc2xhdGVBbmltYXRpb24uZW5kZWRFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy50cmFuc2xhdGVBbmltYXRpb24gPSBudWxsO1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5kaXN0YW5jZUZyb21OdW1iZXJMaW5lUHJvcGVydHkudmFsdWUgPSBkaXN0YW5jZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwdWJsaWNcclxuICAgKiBAb3ZlcnJpZGVcclxuICAgKi9cclxuICBkaXNwb3NlKCkge1xyXG4gICAgdGhpcy5kaXNwb3NlQWJzb2x1dGVWYWx1ZVNwYW5Ob2RlKCk7XHJcbiAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5udW1iZXJMaW5lQ29tbW9uLnJlZ2lzdGVyKCAnQWJzb2x1dGVWYWx1ZVNwYW5Ob2RlJywgQWJzb2x1dGVWYWx1ZVNwYW5Ob2RlICk7XHJcbmV4cG9ydCBkZWZhdWx0IEFic29sdXRlVmFsdWVTcGFuTm9kZTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLFNBQVMsTUFBTSxrQ0FBa0M7QUFDeEQsT0FBT0MsY0FBYyxNQUFNLHVDQUF1QztBQUNsRSxTQUFTQyxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELE9BQU9DLGNBQWMsTUFBTSwrQ0FBK0M7QUFDMUUsT0FBT0MsUUFBUSxNQUFNLHlDQUF5QztBQUM5RCxTQUFTQyxJQUFJLEVBQUVDLElBQUksRUFBRUMsSUFBSSxRQUFRLG1DQUFtQztBQUNwRSxPQUFPQyxTQUFTLE1BQU0sbUNBQW1DO0FBQ3pELE9BQU9DLE1BQU0sTUFBTSxnQ0FBZ0M7QUFDbkQsT0FBT0MsZ0JBQWdCLE1BQU0sMkJBQTJCO0FBQ3hELE9BQU9DLFlBQVksTUFBTSxvQkFBb0I7QUFDN0MsT0FBT0MsaUJBQWlCLE1BQU0sd0JBQXdCOztBQUV0RDtBQUNBLE1BQU1DLFVBQVUsR0FBRyxFQUFFLENBQUMsQ0FBQztBQUN2QixNQUFNQyxlQUFlLEdBQUcsR0FBRyxDQUFDLENBQUM7QUFDN0IsTUFBTUMsc0JBQXNCLEdBQUcsR0FBRyxDQUFDLENBQUM7QUFDcEMsTUFBTUMsb0JBQW9CLEdBQUcsSUFBSVosUUFBUSxDQUFFLEVBQUcsQ0FBQztBQUMvQyxNQUFNYSw0QkFBNEIsR0FBRyxJQUFJVixJQUFJLENBQUUsQ0FBQyxFQUFFO0VBQUVXLElBQUksRUFBRUY7QUFBcUIsQ0FBRSxDQUFDO0FBQ2xGLE1BQU1HLDJCQUEyQixHQUFHLENBQUM7QUFDckMsTUFBTUMsbUJBQW1CLEdBQUcsQ0FBQztBQUU3QixNQUFNQyxxQkFBcUIsU0FBU2hCLElBQUksQ0FBQztFQUV2QztBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRWlCLFdBQVdBLENBQUVDLFVBQVUsRUFBRUMsZUFBZSxFQUFFQyw2QkFBNkIsRUFBRztJQUV4RSxLQUFLLENBQUMsQ0FBQzs7SUFFUDtJQUNBLE1BQU1DLGlCQUFpQixHQUFHQyxrQkFBa0IsSUFBSTtNQUFFLElBQUksQ0FBQ0MsT0FBTyxHQUFHRCxrQkFBa0I7SUFBRSxDQUFDO0lBQ3RGSixVQUFVLENBQUNNLDBCQUEwQixDQUFDQyxJQUFJLENBQUVKLGlCQUFrQixDQUFDOztJQUUvRDtJQUNBLElBQUksQ0FBQ0ssOEJBQThCLEdBQUcsSUFBSTlCLGNBQWMsQ0FBRXdCLDZCQUE4QixDQUFDOztJQUV6RjtJQUNBLElBQUksQ0FBQ0QsZUFBZSxHQUFHQSxlQUFlOztJQUV0QztJQUNBLElBQUksQ0FBQ1Esa0JBQWtCLEdBQUcsSUFBSTs7SUFFOUI7SUFDQSxNQUFNQyxZQUFZLEdBQUcsSUFBSTVCLElBQUksQ0FBQyxDQUFDO0lBQy9CLE1BQU02QixrQkFBa0IsR0FBRyxJQUFJL0IsY0FBYyxDQUFFOEIsWUFBWSxFQUFFdEIsWUFBWSxDQUFDd0Isd0JBQXlCLENBQUM7SUFDcEcsSUFBSSxDQUFDQyxRQUFRLENBQUVGLGtCQUFtQixDQUFDOztJQUVuQztJQUNBLE1BQU1HLGlCQUFpQixHQUFHLElBQUkvQixJQUFJLENBQUUsSUFBSSxFQUFFO01BQ3hDZ0MsTUFBTSxFQUFFZCxlQUFlLENBQUNlLGFBQWE7TUFDckNDLFNBQVMsRUFBRTtJQUNiLENBQUUsQ0FBQztJQUNILElBQUksQ0FBQ0osUUFBUSxDQUFFQyxpQkFBa0IsQ0FBQzs7SUFFbEM7SUFDQSxNQUFNSSxlQUFlLEdBQUdBLENBQUEsS0FBTTtNQUM1QixNQUFNQyxrQkFBa0IsR0FBRyxJQUFJeEMsS0FBSyxDQUFDLENBQUM7TUFDdEMsTUFBTXlDLHNCQUFzQixHQUFHLElBQUksQ0FBQ1osOEJBQThCLENBQUNhLEtBQUs7TUFDeEUsTUFBTUMsYUFBYSxHQUFHckIsZUFBZSxDQUFDc0IsdUJBQXVCLENBQUMsQ0FBQztNQUMvRCxJQUFLdkIsVUFBVSxDQUFDd0IsWUFBWSxFQUFHO1FBQzdCTCxrQkFBa0IsQ0FBQ00sTUFBTSxDQUN2QnpCLFVBQVUsQ0FBQzBCLHNCQUFzQixDQUFDTCxLQUFLLENBQUNNLENBQUMsRUFDekMzQixVQUFVLENBQUMwQixzQkFBc0IsQ0FBQ0wsS0FBSyxDQUFDTyxDQUFDLEdBQUdSLHNCQUFzQixHQUFHOUIsVUFBVSxHQUFHLENBQ3BGLENBQUM7UUFDRDZCLGtCQUFrQixDQUFDVSxNQUFNLENBQ3ZCN0IsVUFBVSxDQUFDMEIsc0JBQXNCLENBQUNMLEtBQUssQ0FBQ00sQ0FBQyxFQUN6QzNCLFVBQVUsQ0FBQzBCLHNCQUFzQixDQUFDTCxLQUFLLENBQUNPLENBQUMsR0FBR1Isc0JBQXNCLEdBQUc5QixVQUFVLEdBQUcsQ0FDcEYsQ0FBQztRQUNENkIsa0JBQWtCLENBQUNNLE1BQU0sQ0FDdkJ6QixVQUFVLENBQUMwQixzQkFBc0IsQ0FBQ0wsS0FBSyxDQUFDTSxDQUFDLEVBQ3pDM0IsVUFBVSxDQUFDMEIsc0JBQXNCLENBQUNMLEtBQUssQ0FBQ08sQ0FBQyxHQUFHUixzQkFDOUMsQ0FBQztRQUNERCxrQkFBa0IsQ0FBQ1UsTUFBTSxDQUFFUCxhQUFhLENBQUNLLENBQUMsRUFBRUwsYUFBYSxDQUFDTSxDQUFDLEdBQUdSLHNCQUF1QixDQUFDO1FBQ3RGRCxrQkFBa0IsQ0FBQ00sTUFBTSxDQUN2QkgsYUFBYSxDQUFDSyxDQUFDLEVBQ2YzQixVQUFVLENBQUMwQixzQkFBc0IsQ0FBQ0wsS0FBSyxDQUFDTyxDQUFDLEdBQUdSLHNCQUFzQixHQUFHOUIsVUFBVSxHQUFHLENBQ3BGLENBQUM7UUFDRDZCLGtCQUFrQixDQUFDVSxNQUFNLENBQ3ZCUCxhQUFhLENBQUNLLENBQUMsRUFDZjNCLFVBQVUsQ0FBQzBCLHNCQUFzQixDQUFDTCxLQUFLLENBQUNPLENBQUMsR0FBR1Isc0JBQXNCLEdBQUc5QixVQUFVLEdBQUcsQ0FDcEYsQ0FBQztNQUNILENBQUMsTUFDSTtRQUNINkIsa0JBQWtCLENBQUNNLE1BQU0sQ0FDdkJ6QixVQUFVLENBQUMwQixzQkFBc0IsQ0FBQ0wsS0FBSyxDQUFDTSxDQUFDLEdBQUdQLHNCQUFzQixHQUFHOUIsVUFBVSxHQUFHLENBQUMsRUFDbkZVLFVBQVUsQ0FBQzBCLHNCQUFzQixDQUFDTCxLQUFLLENBQUNPLENBQzFDLENBQUM7UUFDRFQsa0JBQWtCLENBQUNVLE1BQU0sQ0FDdkI3QixVQUFVLENBQUMwQixzQkFBc0IsQ0FBQ0wsS0FBSyxDQUFDTSxDQUFDLEdBQUdQLHNCQUFzQixHQUFHOUIsVUFBVSxHQUFHLENBQUMsRUFDbkZVLFVBQVUsQ0FBQzBCLHNCQUFzQixDQUFDTCxLQUFLLENBQUNPLENBQzFDLENBQUM7UUFDRFQsa0JBQWtCLENBQUNNLE1BQU0sQ0FBRXpCLFVBQVUsQ0FBQzBCLHNCQUFzQixDQUFDTCxLQUFLLENBQUNNLENBQUMsR0FBR1Asc0JBQXNCLEVBQUVwQixVQUFVLENBQUMwQixzQkFBc0IsQ0FBQ0wsS0FBSyxDQUFDTyxDQUFFLENBQUM7UUFDMUlULGtCQUFrQixDQUFDVSxNQUFNLENBQUVQLGFBQWEsQ0FBQ0ssQ0FBQyxHQUFHUCxzQkFBc0IsRUFBRUUsYUFBYSxDQUFDTSxDQUFFLENBQUM7UUFDdEZULGtCQUFrQixDQUFDTSxNQUFNLENBQ3ZCSCxhQUFhLENBQUNLLENBQUMsR0FBR1Asc0JBQXNCLEdBQUc5QixVQUFVLEdBQUcsQ0FBQyxFQUN6RGdDLGFBQWEsQ0FBQ00sQ0FDaEIsQ0FBQztRQUNEVCxrQkFBa0IsQ0FBQ1UsTUFBTSxDQUN2QlAsYUFBYSxDQUFDSyxDQUFDLEdBQUdQLHNCQUFzQixHQUFHOUIsVUFBVSxHQUFHLENBQUMsRUFDekRnQyxhQUFhLENBQUNNLENBQ2hCLENBQUM7TUFDSDtNQUNBZCxpQkFBaUIsQ0FBQ2dCLEtBQUssR0FBR1gsa0JBQWtCO0lBQzlDLENBQUM7O0lBRUQ7SUFDQSxNQUFNWSxjQUFjLEdBQUdBLENBQUEsS0FBTTtNQUMzQixNQUFNVixLQUFLLEdBQUdwQixlQUFlLENBQUMrQixhQUFhLENBQUNYLEtBQUs7TUFDakRYLFlBQVksQ0FBQ3VCLGlCQUFpQixDQUFDLENBQUM7TUFDaEN2QixZQUFZLENBQUNHLFFBQVEsQ0FBRSxJQUFJeEIsaUJBQWlCLENBQUVLLDRCQUE2QixDQUFFLENBQUM7TUFDOUVnQixZQUFZLENBQUNHLFFBQVEsQ0FBRSxJQUFJN0IsSUFBSSxDQUFFcUMsS0FBSyxFQUFFO1FBQ3RDMUIsSUFBSSxFQUFFRixvQkFBb0I7UUFDMUJ5QyxJQUFJLEVBQUV4QixZQUFZLENBQUN5QixLQUFLLEdBQUd2QztNQUM3QixDQUFFLENBQUUsQ0FBQztNQUNMYyxZQUFZLENBQUNHLFFBQVEsQ0FBRSxJQUFJeEIsaUJBQWlCLENBQUVLLDRCQUE0QixFQUFFO1FBQzFFd0MsSUFBSSxFQUFFeEIsWUFBWSxDQUFDeUIsS0FBSyxHQUFHdkM7TUFDN0IsQ0FBRSxDQUFFLENBQUM7TUFDTGMsWUFBWSxDQUFDRyxRQUFRLENBQUUsSUFBSTdCLElBQUksQ0FBRSxHQUFHLEVBQUU7UUFDcENXLElBQUksRUFBRUYsb0JBQW9CO1FBQzFCeUMsSUFBSSxFQUFFeEIsWUFBWSxDQUFDeUIsS0FBSyxHQUFHdEM7TUFDN0IsQ0FBRSxDQUFFLENBQUM7TUFDTGEsWUFBWSxDQUFDRyxRQUFRLENBQUUsSUFBSTdCLElBQUksQ0FBRW9ELElBQUksQ0FBQ0MsR0FBRyxDQUFFaEIsS0FBTSxDQUFDLEVBQUU7UUFDbEQxQixJQUFJLEVBQUVGLG9CQUFvQjtRQUMxQnlDLElBQUksRUFBRXhCLFlBQVksQ0FBQ3lCLEtBQUssR0FBR3RDO01BQzdCLENBQUUsQ0FBRSxDQUFDO01BRUwsTUFBTXVCLHNCQUFzQixHQUFHLElBQUksQ0FBQ1osOEJBQThCLENBQUNhLEtBQUs7TUFDeEUsTUFBTUMsYUFBYSxHQUFHckIsZUFBZSxDQUFDc0IsdUJBQXVCLENBQUMsQ0FBQztNQUMvRCxJQUFLdkIsVUFBVSxDQUFDd0IsWUFBWSxFQUFHO1FBQzdCYixrQkFBa0IsQ0FBQzJCLE9BQU8sR0FBRyxDQUFFdEMsVUFBVSxDQUFDMEIsc0JBQXNCLENBQUNMLEtBQUssQ0FBQ00sQ0FBQyxHQUFHTCxhQUFhLENBQUNLLENBQUMsSUFBSyxDQUFDO1FBQ2hHaEIsa0JBQWtCLENBQUM0QixNQUFNLEdBQUd2QyxVQUFVLENBQUMwQixzQkFBc0IsQ0FBQ0wsS0FBSyxDQUFDTyxDQUFDLEdBQUdSLHNCQUFzQixHQUFHOUIsVUFBVSxHQUFHLENBQUM7TUFDakgsQ0FBQyxNQUNJO1FBQ0hxQixrQkFBa0IsQ0FBQzJCLE9BQU8sR0FBR2hCLGFBQWEsQ0FBQ0ssQ0FBQyxHQUFHUCxzQkFBc0I7UUFDckUsSUFBS0MsS0FBSyxHQUFHLENBQUMsRUFBRztVQUNmVixrQkFBa0IsQ0FBQzRCLE1BQU0sR0FBR2pCLGFBQWEsQ0FBQ00sQ0FBQyxHQUFHLENBQUM7UUFDakQsQ0FBQyxNQUNJO1VBQ0hqQixrQkFBa0IsQ0FBQzZCLEdBQUcsR0FBR2xCLGFBQWEsQ0FBQ00sQ0FBQyxHQUFHLENBQUM7UUFDOUM7TUFDRjtJQUNGLENBQUM7O0lBRUQ7SUFDQTNCLGVBQWUsQ0FBQytCLGFBQWEsQ0FBQ3pCLElBQUksQ0FBRSxNQUFNO01BQ3hDVyxlQUFlLENBQUMsQ0FBQztNQUNqQmEsY0FBYyxDQUFDLENBQUM7SUFDbEIsQ0FBRSxDQUFDOztJQUVIO0lBQ0EsTUFBTVUseUJBQXlCLEdBQUdoRSxTQUFTLENBQUNpRSxTQUFTLENBQ25ELENBQUUxQyxVQUFVLENBQUMyQyxtQkFBbUIsRUFBRTNDLFVBQVUsQ0FBQzRDLHNCQUFzQixFQUFFLElBQUksQ0FBQ3BDLDhCQUE4QixDQUFFLEVBQzFHLE1BQU07TUFDSlUsZUFBZSxDQUFDLENBQUM7TUFDakJhLGNBQWMsQ0FBQyxDQUFDO0lBQ2xCLENBQ0YsQ0FBQzs7SUFFRDtJQUNBLElBQUksQ0FBQ2MsNEJBQTRCLEdBQUcsTUFBTTtNQUN4Q0oseUJBQXlCLENBQUNLLE9BQU8sQ0FBQyxDQUFDO01BQ25DOUMsVUFBVSxDQUFDTSwwQkFBMEIsQ0FBQ3lDLE1BQU0sQ0FBRTVDLGlCQUFrQixDQUFDO0lBQ25FLENBQUM7RUFDSDs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ0U2Qyx5QkFBeUJBLENBQUVDLFFBQVEsRUFBRUMsV0FBVyxFQUFHO0lBQ2pELE1BQU1DLDZCQUE2QixHQUFHLElBQUksQ0FBQzNDLDhCQUE4QixDQUFDYSxLQUFLO0lBQy9FLElBQUs0QixRQUFRLEtBQUtFLDZCQUE2QixFQUFHO01BQ2hEO0lBQ0Y7SUFFQSxJQUFLRCxXQUFXLEVBQUc7TUFDakIsTUFBTUUsaUJBQWlCLEdBQUdoQixJQUFJLENBQUNpQixHQUFHLENBQ2hDakIsSUFBSSxDQUFDQyxHQUFHLENBQUVjLDZCQUE2QixHQUFHRixRQUFTLENBQUMsR0FBRzFELGVBQWUsRUFDdEVDLHNCQUNGLENBQUM7TUFDRCxNQUFNOEQsZ0JBQWdCLEdBQUc7UUFDdkJDLFFBQVEsRUFBRSxJQUFJLENBQUMvQyw4QkFBOEI7UUFDN0NnRCxFQUFFLEVBQUVQLFFBQVE7UUFDWlEsUUFBUSxFQUFFTCxpQkFBaUI7UUFDM0JNLE1BQU0sRUFBRXhFLE1BQU0sQ0FBQ3lFO01BQ2pCLENBQUM7O01BRUQ7TUFDQSxJQUFLLElBQUksQ0FBQ2xELGtCQUFrQixFQUFHO1FBQzdCLElBQUksQ0FBQ0Esa0JBQWtCLENBQUNtRCxJQUFJLENBQUMsQ0FBQztNQUNoQzs7TUFFQTtNQUNBLElBQUksQ0FBQ25ELGtCQUFrQixHQUFHLElBQUl4QixTQUFTLENBQUVxRSxnQkFBaUIsQ0FBQztNQUMzRCxJQUFJLENBQUM3QyxrQkFBa0IsQ0FBQ29ELEtBQUssQ0FBQyxDQUFDOztNQUUvQjtNQUNBLElBQUksQ0FBQ3BELGtCQUFrQixDQUFDcUQsWUFBWSxDQUFDQyxXQUFXLENBQUUsTUFBTTtRQUN0RCxJQUFJLENBQUN0RCxrQkFBa0IsR0FBRyxJQUFJO01BQ2hDLENBQUUsQ0FBQztJQUNMLENBQUMsTUFDSTtNQUNILElBQUksQ0FBQ0QsOEJBQThCLENBQUNhLEtBQUssR0FBRzRCLFFBQVE7SUFDdEQ7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtFQUNFSCxPQUFPQSxDQUFBLEVBQUc7SUFDUixJQUFJLENBQUNELDRCQUE0QixDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDQyxPQUFPLENBQUMsQ0FBQztFQUNqQjtBQUNGO0FBRUEzRCxnQkFBZ0IsQ0FBQzZFLFFBQVEsQ0FBRSx1QkFBdUIsRUFBRWxFLHFCQUFzQixDQUFDO0FBQzNFLGVBQWVBLHFCQUFxQiJ9