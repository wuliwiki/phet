// Copyright 2014-2022, University of Colorado Boulder

/**
 * A fraction and associated operations.
 *
 * NOTE: The common version of this class in the PhET Java code base has a number of additional methods.  These methods
 * should be ported into this file as needed.  Please see edu.colorado.phet.fractions.common.math.Fraction.java in the
 * PhET Java code base.
 *
 * @author John Blanco
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Sam Reid (PhET Interactive Simulations)
 */

import Utils from '../../../dot/js/Utils.js';
import IOType from '../../../tandem/js/types/IOType.js';
import NumberIO from '../../../tandem/js/types/NumberIO.js';
import phetcommon from '../phetcommon.js';
export default class Fraction {
  static ZERO = new Fraction(0, 1);
  static ONE = new Fraction(1, 1);
  constructor(numerator, denominator) {
    assert && assert(Number.isInteger(numerator), `numerator must be an integer: ${numerator}`);
    assert && assert(Number.isInteger(denominator), `denominator must be an integer: ${denominator}`);
    this._numerator = numerator;
    this._denominator = denominator;
  }

  /**
   * Sets the numerator, which must be an integer.
   */
  set numerator(value) {
    assert && assert(Number.isInteger(value), `numerator must be an integer: ${value}`);
    this._numerator = value;
  }

  /**
   * Gets the numerator.
   */
  get numerator() {
    return this._numerator;
  }

  /**
   * Sets the denominator, which must be an integer.
   */
  set denominator(value) {
    assert && assert(Number.isInteger(value), `denominator must be an integer: ${value}`);
    this._denominator = value;
  }

  /**
   * Gets the denominator.
   */
  get denominator() {
    return this._denominator;
  }

  /**
   * Computes the numeric value of the fraction.
   * Floating-point error is not an issue as long as numerator and denominator are integers < 2^53.
   */
  getValue() {
    return this.numerator / this.denominator;
  }
  get value() {
    return this.getValue();
  }

  /**
   * Does this fraction reduce to an integer value?
   */
  isInteger() {
    return this.numerator % this.denominator === 0;
  }
  toString() {
    return `${this.numerator}/${this.denominator}`;
  }
  copy() {
    return new Fraction(this.numerator, this.denominator);
  }

  /**
   * Reduces this fraction, modifies the numerator and denominator.
   */
  reduce() {
    const gcd = Utils.gcd(this.numerator, this.denominator);
    this.numerator = gcd === 0 ? 0 : Utils.roundSymmetric(this.numerator / gcd);
    this.denominator = gcd === 0 ? 0 : Utils.roundSymmetric(this.denominator / gcd);
    return this;
  }

  /**
   * Creates a reduced instance of this fraction.
   */
  reduced() {
    return this.copy().reduce();
  }

  /**
   * Is this fraction reduced?
   */
  isReduced() {
    return Utils.gcd(this.numerator, this.denominator) === 1;
  }

  /**
   * Returns whether the two fractions are equal (not whether their reduced values are equal).
   */
  equals(fraction) {
    return this.numerator === fraction.numerator && this.denominator === fraction.denominator;
  }

  /**
   * Returns whether this fraction has a value that is less than the provided fraction.
   */
  isLessThan(fraction) {
    // The more straightforward approach would be: this.getValue() < fraction.getValue().
    // But that uses floating-point operations and comparisons, which could result in a loss of precision.
    // https://github.com/phetsims/phetcommon/issues/43
    return SCRATCH_FRACTION.set(this).subtract(fraction).sign === -1;
  }

  /**
   * Gets the sign of the value, as defined by Math.sign
   */
  get sign() {
    return Math.sign(this.getValue());
  }

  /**
   * Returns the absolute value of this fraction.
   */
  abs() {
    return new Fraction(Math.abs(this.numerator), Math.abs(this.denominator));
  }

  /**
   * Sets the value of this fraction to the provided fraction.
   */
  set(value) {
    this.numerator = value.numerator;
    this.denominator = value.denominator;
    return this;
  }

  /**
   * Sets the value of this fraction to the sum of the two fractions:
   * numerator1 / denominator1 + numerator2 / denominator2
   */
  setToSum(numerator1, denominator1, numerator2, denominator2) {
    assert && assert(Number.isInteger(numerator1), 'numerator1 must be an integer');
    assert && assert(Number.isInteger(denominator1), 'denominator1 must be an integer');
    assert && assert(Number.isInteger(numerator2), 'numerator2 must be an integer');
    assert && assert(Number.isInteger(denominator2), 'denominator2 must be an integer');
    const lcm = Utils.lcm(denominator1, denominator2);
    this.numerator = Utils.roundSymmetric(numerator1 * lcm / denominator1) + Utils.roundSymmetric(numerator2 * lcm / denominator2);
    this.denominator = lcm;
    return this;
  }

  /**
   * Adds the provided fraction into this fraction (mutates this fraction). The result is NOT reduced,
   * and has a denominator that is the least-common multiple of the 2 denominators.
   */
  add(value) {
    return this.setToSum(this.numerator, this.denominator, value.numerator, value.denominator);
  }

  /**
   * Adds a fraction to this fraction to create a new fraction.
   * The result is not reduced, and has a denominator that is the least-common multiple of the 2 denominators.
   */
  plus(value) {
    return this.copy().add(value);
  }

  /**
   * Subtracts the provided fraction from this fraction (mutates this fraction). The result is NOT reduced,
   * and has a denominator that is the least-common multiple of the 2 denominators.
   */
  subtract(value) {
    return this.setToSum(this.numerator, this.denominator, -value.numerator, value.denominator);
  }

  /**
   * Subtracts a fraction from this fraction to create a new fraction.
   * The result is not reduced, and has a denominator that is the least-common multiple of the 2 denominators.
   */
  minus(value) {
    return this.copy().subtract(value);
  }

  /**
   * Multiplies the provided fraction and this fraction, setting the result into this fraction (mutates).
   * The value is not reduced.
   */
  multiply(value) {
    this.numerator *= value.numerator;
    this.denominator *= value.denominator;
    return this;
  }

  /**
   * Multiplies this fraction by another fraction to create a new fraction.
   * The result is not reduced.
   */
  times(value) {
    return this.copy().multiply(value);
  }

  /**
   * Divides this fraction by the provided fraction, setting the result into this fraction (mutates).
   * The value is not reduced.
   */
  divide(value) {
    this.numerator *= value.denominator;
    this.denominator *= value.numerator;
    return this;
  }

  /**
   * Divides this fraction by another fraction to create a new fraction.
   * The result is not reduced.
   */
  divided(value) {
    return this.copy().divide(value);
  }

  /**
   * Convenience method.
   * Adds an integer value to this fraction to create a new fraction.
   * The result is not reduced, and the denominator is the same as the denominator of this fraction.
   */
  plusInteger(value) {
    assert && assert(Number.isInteger(value), `value is not an integer: ${value}`);
    return new Fraction(this.numerator + value * this.denominator, this.denominator);
  }

  /**
   * Convenience method.
   * Subtracts an integer value from this fraction to create a new fraction.
   * The result is not reduced, and the denominator is the same as the denominator of this fraction.
   */
  minusInteger(value) {
    assert && assert(Number.isInteger(value), `value is not an integer: ${value}`);
    return new Fraction(this.numerator - value * this.denominator, this.denominator);
  }

  /**
   * Convenience method.
   * Multiplies this fraction by an integer to create a new fraction.
   * The result is not reduced, and the denominator is the same as the denominator of this fraction.
   */
  timesInteger(value) {
    assert && assert(Number.isInteger(value), `value is not an integer: ${value}`);
    return new Fraction(this.numerator * value, this.denominator);
  }

  /**
   * Convenience method.
   * Divides this fraction by an integer to create a new fraction.
   * This operation affects the value and sign of the denominator only, and the result is not reduced.
   * Careful! Division by zero is allowed here.
   */
  dividedInteger(value) {
    assert && assert(Number.isInteger(value), `value is not an integer: ${value}`);
    return new Fraction(this.numerator, this.denominator * value);
  }

  /**
   * Convenience method for constructing a fraction from an integer.
   */
  static fromInteger(value) {
    assert && assert(Number.isInteger(value), `value is not an integer: ${value}`);
    return new Fraction(value, 1);
  }

  /**
   * Convert a number into a Fraction
   */
  static fromDecimal(value) {
    if (Number.isInteger(value)) {
      return Fraction.fromInteger(value);
    } else {
      // Get the decimal part of the number.
      const decimal = value - Utils.toFixedNumber(value, 0);
      assert && assert(decimal !== 0, 'expected decimal to be non-zero');

      // Convert the decimal part into an integer. This becomes the denominator.
      const denominator = Math.pow(10, Utils.numberOfDecimalPlaces(decimal));

      // Compute numerator
      const numerator = Utils.toFixedNumber(value * denominator, 0);
      return new Fraction(numerator, denominator).reduce();
    }
  }

  /**
   * Serializes this Fraction instance.
   */
  toStateObject() {
    return {
      numerator: this._numerator,
      denominator: this._denominator
    };
  }

  /**
   * Deserializes a Fraction from PhET-iO state.
   */
  static fromStateObject(stateObject) {
    return new Fraction(stateObject.numerator, stateObject.denominator);
  }

  /**
   * IOType for Fraction.
   */
  static FractionIO = new IOType('FractionIO', {
    valueType: Fraction,
    stateSchema: {
      numerator: NumberIO,
      denominator: NumberIO
    },
    toStateObject: fraction => fraction.toStateObject(),
    fromStateObject: stateObject => Fraction.fromStateObject(stateObject)
  });
}

// Used to avoid GC. NOTE: Do NOT move in front of the constructor, as it is creating a copy of the type defined.
const SCRATCH_FRACTION = new Fraction(1, 1);
phetcommon.register('Fraction', Fraction);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVdGlscyIsIklPVHlwZSIsIk51bWJlcklPIiwicGhldGNvbW1vbiIsIkZyYWN0aW9uIiwiWkVSTyIsIk9ORSIsImNvbnN0cnVjdG9yIiwibnVtZXJhdG9yIiwiZGVub21pbmF0b3IiLCJhc3NlcnQiLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJfbnVtZXJhdG9yIiwiX2Rlbm9taW5hdG9yIiwidmFsdWUiLCJnZXRWYWx1ZSIsInRvU3RyaW5nIiwiY29weSIsInJlZHVjZSIsImdjZCIsInJvdW5kU3ltbWV0cmljIiwicmVkdWNlZCIsImlzUmVkdWNlZCIsImVxdWFscyIsImZyYWN0aW9uIiwiaXNMZXNzVGhhbiIsIlNDUkFUQ0hfRlJBQ1RJT04iLCJzZXQiLCJzdWJ0cmFjdCIsInNpZ24iLCJNYXRoIiwiYWJzIiwic2V0VG9TdW0iLCJudW1lcmF0b3IxIiwiZGVub21pbmF0b3IxIiwibnVtZXJhdG9yMiIsImRlbm9taW5hdG9yMiIsImxjbSIsImFkZCIsInBsdXMiLCJtaW51cyIsIm11bHRpcGx5IiwidGltZXMiLCJkaXZpZGUiLCJkaXZpZGVkIiwicGx1c0ludGVnZXIiLCJtaW51c0ludGVnZXIiLCJ0aW1lc0ludGVnZXIiLCJkaXZpZGVkSW50ZWdlciIsImZyb21JbnRlZ2VyIiwiZnJvbURlY2ltYWwiLCJkZWNpbWFsIiwidG9GaXhlZE51bWJlciIsInBvdyIsIm51bWJlck9mRGVjaW1hbFBsYWNlcyIsInRvU3RhdGVPYmplY3QiLCJmcm9tU3RhdGVPYmplY3QiLCJzdGF0ZU9iamVjdCIsIkZyYWN0aW9uSU8iLCJ2YWx1ZVR5cGUiLCJzdGF0ZVNjaGVtYSIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiRnJhY3Rpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTQtMjAyMiwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXHJcblxyXG4vKipcclxuICogQSBmcmFjdGlvbiBhbmQgYXNzb2NpYXRlZCBvcGVyYXRpb25zLlxyXG4gKlxyXG4gKiBOT1RFOiBUaGUgY29tbW9uIHZlcnNpb24gb2YgdGhpcyBjbGFzcyBpbiB0aGUgUGhFVCBKYXZhIGNvZGUgYmFzZSBoYXMgYSBudW1iZXIgb2YgYWRkaXRpb25hbCBtZXRob2RzLiAgVGhlc2UgbWV0aG9kc1xyXG4gKiBzaG91bGQgYmUgcG9ydGVkIGludG8gdGhpcyBmaWxlIGFzIG5lZWRlZC4gIFBsZWFzZSBzZWUgZWR1LmNvbG9yYWRvLnBoZXQuZnJhY3Rpb25zLmNvbW1vbi5tYXRoLkZyYWN0aW9uLmphdmEgaW4gdGhlXHJcbiAqIFBoRVQgSmF2YSBjb2RlIGJhc2UuXHJcbiAqXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY29cclxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcclxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vLi4vZG90L2pzL1V0aWxzLmpzJztcclxuaW1wb3J0IElPVHlwZSBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvSU9UeXBlLmpzJztcclxuaW1wb3J0IE51bWJlcklPIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9OdW1iZXJJTy5qcyc7XHJcbmltcG9ydCBwaGV0Y29tbW9uIGZyb20gJy4uL3BoZXRjb21tb24uanMnO1xyXG5cclxuZXhwb3J0IHR5cGUgRnJhY3Rpb25TdGF0ZU9iamVjdCA9IHtcclxuICBudW1lcmF0b3I6IG51bWJlcjtcclxuICBkZW5vbWluYXRvcjogbnVtYmVyO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRnJhY3Rpb24ge1xyXG5cclxuICBwcml2YXRlIF9udW1lcmF0b3I6IG51bWJlcjtcclxuICBwcml2YXRlIF9kZW5vbWluYXRvcjogbnVtYmVyO1xyXG5cclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IFpFUk8gPSBuZXcgRnJhY3Rpb24oIDAsIDEgKTtcclxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IE9ORSA9IG5ldyBGcmFjdGlvbiggMSwgMSApO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoIG51bWVyYXRvcjogbnVtYmVyLCBkZW5vbWluYXRvcjogbnVtYmVyICkge1xyXG5cclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIE51bWJlci5pc0ludGVnZXIoIG51bWVyYXRvciApLCBgbnVtZXJhdG9yIG11c3QgYmUgYW4gaW50ZWdlcjogJHtudW1lcmF0b3J9YCApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggTnVtYmVyLmlzSW50ZWdlciggZGVub21pbmF0b3IgKSwgYGRlbm9taW5hdG9yIG11c3QgYmUgYW4gaW50ZWdlcjogJHtkZW5vbWluYXRvcn1gICk7XHJcblxyXG4gICAgdGhpcy5fbnVtZXJhdG9yID0gbnVtZXJhdG9yO1xyXG4gICAgdGhpcy5fZGVub21pbmF0b3IgPSBkZW5vbWluYXRvcjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIG51bWVyYXRvciwgd2hpY2ggbXVzdCBiZSBhbiBpbnRlZ2VyLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXQgbnVtZXJhdG9yKCB2YWx1ZTogbnVtYmVyICkge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggTnVtYmVyLmlzSW50ZWdlciggdmFsdWUgKSwgYG51bWVyYXRvciBtdXN0IGJlIGFuIGludGVnZXI6ICR7dmFsdWV9YCApO1xyXG4gICAgdGhpcy5fbnVtZXJhdG9yID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBudW1lcmF0b3IuXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBudW1lcmF0b3IoKTogbnVtYmVyIHsgcmV0dXJuIHRoaXMuX251bWVyYXRvcjsgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSBkZW5vbWluYXRvciwgd2hpY2ggbXVzdCBiZSBhbiBpbnRlZ2VyLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXQgZGVub21pbmF0b3IoIHZhbHVlOiBudW1iZXIgKSB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBOdW1iZXIuaXNJbnRlZ2VyKCB2YWx1ZSApLCBgZGVub21pbmF0b3IgbXVzdCBiZSBhbiBpbnRlZ2VyOiAke3ZhbHVlfWAgKTtcclxuICAgIHRoaXMuX2Rlbm9taW5hdG9yID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBkZW5vbWluYXRvci5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0IGRlbm9taW5hdG9yKCk6IG51bWJlciB7IHJldHVybiB0aGlzLl9kZW5vbWluYXRvcjsgfVxyXG5cclxuICAvKipcclxuICAgKiBDb21wdXRlcyB0aGUgbnVtZXJpYyB2YWx1ZSBvZiB0aGUgZnJhY3Rpb24uXHJcbiAgICogRmxvYXRpbmctcG9pbnQgZXJyb3IgaXMgbm90IGFuIGlzc3VlIGFzIGxvbmcgYXMgbnVtZXJhdG9yIGFuZCBkZW5vbWluYXRvciBhcmUgaW50ZWdlcnMgPCAyXjUzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRWYWx1ZSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMubnVtZXJhdG9yIC8gdGhpcy5kZW5vbWluYXRvcjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgdmFsdWUoKTogbnVtYmVyIHsgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoKTsgfVxyXG5cclxuICAvKipcclxuICAgKiBEb2VzIHRoaXMgZnJhY3Rpb24gcmVkdWNlIHRvIGFuIGludGVnZXIgdmFsdWU/XHJcbiAgICovXHJcbiAgcHVibGljIGlzSW50ZWdlcigpOiBib29sZWFuIHtcclxuICAgIHJldHVybiAoIHRoaXMubnVtZXJhdG9yICUgdGhpcy5kZW5vbWluYXRvciA9PT0gMCApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gYCR7dGhpcy5udW1lcmF0b3J9LyR7dGhpcy5kZW5vbWluYXRvcn1gO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGNvcHkoKTogRnJhY3Rpb24ge1xyXG4gICAgcmV0dXJuIG5ldyBGcmFjdGlvbiggdGhpcy5udW1lcmF0b3IsIHRoaXMuZGVub21pbmF0b3IgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlZHVjZXMgdGhpcyBmcmFjdGlvbiwgbW9kaWZpZXMgdGhlIG51bWVyYXRvciBhbmQgZGVub21pbmF0b3IuXHJcbiAgICovXHJcbiAgcHVibGljIHJlZHVjZSgpOiBGcmFjdGlvbiB7XHJcbiAgICBjb25zdCBnY2QgPSBVdGlscy5nY2QoIHRoaXMubnVtZXJhdG9yLCB0aGlzLmRlbm9taW5hdG9yICk7XHJcbiAgICB0aGlzLm51bWVyYXRvciA9ICggZ2NkID09PSAwICkgPyAwIDogVXRpbHMucm91bmRTeW1tZXRyaWMoIHRoaXMubnVtZXJhdG9yIC8gZ2NkICk7XHJcbiAgICB0aGlzLmRlbm9taW5hdG9yID0gKCBnY2QgPT09IDAgKSA/IDAgOiBVdGlscy5yb3VuZFN5bW1ldHJpYyggdGhpcy5kZW5vbWluYXRvciAvIGdjZCApO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIGEgcmVkdWNlZCBpbnN0YW5jZSBvZiB0aGlzIGZyYWN0aW9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyByZWR1Y2VkKCk6IEZyYWN0aW9uIHtcclxuICAgIHJldHVybiB0aGlzLmNvcHkoKS5yZWR1Y2UoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIElzIHRoaXMgZnJhY3Rpb24gcmVkdWNlZD9cclxuICAgKi9cclxuICBwdWJsaWMgaXNSZWR1Y2VkKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIFV0aWxzLmdjZCggdGhpcy5udW1lcmF0b3IsIHRoaXMuZGVub21pbmF0b3IgKSA9PT0gMTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgd2hldGhlciB0aGUgdHdvIGZyYWN0aW9ucyBhcmUgZXF1YWwgKG5vdCB3aGV0aGVyIHRoZWlyIHJlZHVjZWQgdmFsdWVzIGFyZSBlcXVhbCkuXHJcbiAgICovXHJcbiAgcHVibGljIGVxdWFscyggZnJhY3Rpb246IEZyYWN0aW9uICk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuICggdGhpcy5udW1lcmF0b3IgPT09IGZyYWN0aW9uLm51bWVyYXRvciApICYmICggdGhpcy5kZW5vbWluYXRvciA9PT0gZnJhY3Rpb24uZGVub21pbmF0b3IgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgd2hldGhlciB0aGlzIGZyYWN0aW9uIGhhcyBhIHZhbHVlIHRoYXQgaXMgbGVzcyB0aGFuIHRoZSBwcm92aWRlZCBmcmFjdGlvbi5cclxuICAgKi9cclxuICBwdWJsaWMgaXNMZXNzVGhhbiggZnJhY3Rpb246IEZyYWN0aW9uICk6IGJvb2xlYW4ge1xyXG5cclxuICAgIC8vIFRoZSBtb3JlIHN0cmFpZ2h0Zm9yd2FyZCBhcHByb2FjaCB3b3VsZCBiZTogdGhpcy5nZXRWYWx1ZSgpIDwgZnJhY3Rpb24uZ2V0VmFsdWUoKS5cclxuICAgIC8vIEJ1dCB0aGF0IHVzZXMgZmxvYXRpbmctcG9pbnQgb3BlcmF0aW9ucyBhbmQgY29tcGFyaXNvbnMsIHdoaWNoIGNvdWxkIHJlc3VsdCBpbiBhIGxvc3Mgb2YgcHJlY2lzaW9uLlxyXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3BoZXRjb21tb24vaXNzdWVzLzQzXHJcbiAgICByZXR1cm4gU0NSQVRDSF9GUkFDVElPTi5zZXQoIHRoaXMgKS5zdWJ0cmFjdCggZnJhY3Rpb24gKS5zaWduID09PSAtMTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgdGhlIHNpZ24gb2YgdGhlIHZhbHVlLCBhcyBkZWZpbmVkIGJ5IE1hdGguc2lnblxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXQgc2lnbigpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIE1hdGguc2lnbiggdGhpcy5nZXRWYWx1ZSgpICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRoZSBhYnNvbHV0ZSB2YWx1ZSBvZiB0aGlzIGZyYWN0aW9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBhYnMoKTogRnJhY3Rpb24ge1xyXG4gICAgcmV0dXJuIG5ldyBGcmFjdGlvbiggTWF0aC5hYnMoIHRoaXMubnVtZXJhdG9yICksIE1hdGguYWJzKCB0aGlzLmRlbm9taW5hdG9yICkgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIHZhbHVlIG9mIHRoaXMgZnJhY3Rpb24gdG8gdGhlIHByb3ZpZGVkIGZyYWN0aW9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXQoIHZhbHVlOiBGcmFjdGlvbiApOiBGcmFjdGlvbiB7XHJcbiAgICB0aGlzLm51bWVyYXRvciA9IHZhbHVlLm51bWVyYXRvcjtcclxuICAgIHRoaXMuZGVub21pbmF0b3IgPSB2YWx1ZS5kZW5vbWluYXRvcjtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgdmFsdWUgb2YgdGhpcyBmcmFjdGlvbiB0byB0aGUgc3VtIG9mIHRoZSB0d28gZnJhY3Rpb25zOlxyXG4gICAqIG51bWVyYXRvcjEgLyBkZW5vbWluYXRvcjEgKyBudW1lcmF0b3IyIC8gZGVub21pbmF0b3IyXHJcbiAgICovXHJcbiAgcHVibGljIHNldFRvU3VtKCBudW1lcmF0b3IxOiBudW1iZXIsIGRlbm9taW5hdG9yMTogbnVtYmVyLCBudW1lcmF0b3IyOiBudW1iZXIsIGRlbm9taW5hdG9yMjogbnVtYmVyICk6IEZyYWN0aW9uIHtcclxuICAgIGFzc2VydCAmJiBhc3NlcnQoIE51bWJlci5pc0ludGVnZXIoIG51bWVyYXRvcjEgKSwgJ251bWVyYXRvcjEgbXVzdCBiZSBhbiBpbnRlZ2VyJyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggTnVtYmVyLmlzSW50ZWdlciggZGVub21pbmF0b3IxICksICdkZW5vbWluYXRvcjEgbXVzdCBiZSBhbiBpbnRlZ2VyJyApO1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggTnVtYmVyLmlzSW50ZWdlciggbnVtZXJhdG9yMiApLCAnbnVtZXJhdG9yMiBtdXN0IGJlIGFuIGludGVnZXInICk7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBOdW1iZXIuaXNJbnRlZ2VyKCBkZW5vbWluYXRvcjIgKSwgJ2Rlbm9taW5hdG9yMiBtdXN0IGJlIGFuIGludGVnZXInICk7XHJcblxyXG4gICAgY29uc3QgbGNtID0gVXRpbHMubGNtKCBkZW5vbWluYXRvcjEsIGRlbm9taW5hdG9yMiApO1xyXG4gICAgdGhpcy5udW1lcmF0b3IgPSBVdGlscy5yb3VuZFN5bW1ldHJpYyggbnVtZXJhdG9yMSAqIGxjbSAvIGRlbm9taW5hdG9yMSApICtcclxuICAgICAgICAgICAgICAgICAgICAgVXRpbHMucm91bmRTeW1tZXRyaWMoIG51bWVyYXRvcjIgKiBsY20gLyBkZW5vbWluYXRvcjIgKTtcclxuICAgIHRoaXMuZGVub21pbmF0b3IgPSBsY207XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZHMgdGhlIHByb3ZpZGVkIGZyYWN0aW9uIGludG8gdGhpcyBmcmFjdGlvbiAobXV0YXRlcyB0aGlzIGZyYWN0aW9uKS4gVGhlIHJlc3VsdCBpcyBOT1QgcmVkdWNlZCxcclxuICAgKiBhbmQgaGFzIGEgZGVub21pbmF0b3IgdGhhdCBpcyB0aGUgbGVhc3QtY29tbW9uIG11bHRpcGxlIG9mIHRoZSAyIGRlbm9taW5hdG9ycy5cclxuICAgKi9cclxuICBwdWJsaWMgYWRkKCB2YWx1ZTogRnJhY3Rpb24gKTogRnJhY3Rpb24ge1xyXG4gICAgcmV0dXJuIHRoaXMuc2V0VG9TdW0oIHRoaXMubnVtZXJhdG9yLCB0aGlzLmRlbm9taW5hdG9yLCB2YWx1ZS5udW1lcmF0b3IsIHZhbHVlLmRlbm9taW5hdG9yICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGRzIGEgZnJhY3Rpb24gdG8gdGhpcyBmcmFjdGlvbiB0byBjcmVhdGUgYSBuZXcgZnJhY3Rpb24uXHJcbiAgICogVGhlIHJlc3VsdCBpcyBub3QgcmVkdWNlZCwgYW5kIGhhcyBhIGRlbm9taW5hdG9yIHRoYXQgaXMgdGhlIGxlYXN0LWNvbW1vbiBtdWx0aXBsZSBvZiB0aGUgMiBkZW5vbWluYXRvcnMuXHJcbiAgICovXHJcbiAgcHVibGljIHBsdXMoIHZhbHVlOiBGcmFjdGlvbiApOiBGcmFjdGlvbiB7XHJcbiAgICByZXR1cm4gdGhpcy5jb3B5KCkuYWRkKCB2YWx1ZSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3VidHJhY3RzIHRoZSBwcm92aWRlZCBmcmFjdGlvbiBmcm9tIHRoaXMgZnJhY3Rpb24gKG11dGF0ZXMgdGhpcyBmcmFjdGlvbikuIFRoZSByZXN1bHQgaXMgTk9UIHJlZHVjZWQsXHJcbiAgICogYW5kIGhhcyBhIGRlbm9taW5hdG9yIHRoYXQgaXMgdGhlIGxlYXN0LWNvbW1vbiBtdWx0aXBsZSBvZiB0aGUgMiBkZW5vbWluYXRvcnMuXHJcbiAgICovXHJcbiAgcHVibGljIHN1YnRyYWN0KCB2YWx1ZTogRnJhY3Rpb24gKTogRnJhY3Rpb24ge1xyXG4gICAgcmV0dXJuIHRoaXMuc2V0VG9TdW0oIHRoaXMubnVtZXJhdG9yLCB0aGlzLmRlbm9taW5hdG9yLCAtdmFsdWUubnVtZXJhdG9yLCB2YWx1ZS5kZW5vbWluYXRvciApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3VidHJhY3RzIGEgZnJhY3Rpb24gZnJvbSB0aGlzIGZyYWN0aW9uIHRvIGNyZWF0ZSBhIG5ldyBmcmFjdGlvbi5cclxuICAgKiBUaGUgcmVzdWx0IGlzIG5vdCByZWR1Y2VkLCBhbmQgaGFzIGEgZGVub21pbmF0b3IgdGhhdCBpcyB0aGUgbGVhc3QtY29tbW9uIG11bHRpcGxlIG9mIHRoZSAyIGRlbm9taW5hdG9ycy5cclxuICAgKi9cclxuICBwdWJsaWMgbWludXMoIHZhbHVlOiBGcmFjdGlvbiApOiBGcmFjdGlvbiB7XHJcbiAgICByZXR1cm4gdGhpcy5jb3B5KCkuc3VidHJhY3QoIHZhbHVlICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNdWx0aXBsaWVzIHRoZSBwcm92aWRlZCBmcmFjdGlvbiBhbmQgdGhpcyBmcmFjdGlvbiwgc2V0dGluZyB0aGUgcmVzdWx0IGludG8gdGhpcyBmcmFjdGlvbiAobXV0YXRlcykuXHJcbiAgICogVGhlIHZhbHVlIGlzIG5vdCByZWR1Y2VkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBtdWx0aXBseSggdmFsdWU6IEZyYWN0aW9uICk6IEZyYWN0aW9uIHtcclxuICAgIHRoaXMubnVtZXJhdG9yICo9IHZhbHVlLm51bWVyYXRvcjtcclxuICAgIHRoaXMuZGVub21pbmF0b3IgKj0gdmFsdWUuZGVub21pbmF0b3I7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE11bHRpcGxpZXMgdGhpcyBmcmFjdGlvbiBieSBhbm90aGVyIGZyYWN0aW9uIHRvIGNyZWF0ZSBhIG5ldyBmcmFjdGlvbi5cclxuICAgKiBUaGUgcmVzdWx0IGlzIG5vdCByZWR1Y2VkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyB0aW1lcyggdmFsdWU6IEZyYWN0aW9uICk6IEZyYWN0aW9uIHtcclxuICAgIHJldHVybiB0aGlzLmNvcHkoKS5tdWx0aXBseSggdmFsdWUgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERpdmlkZXMgdGhpcyBmcmFjdGlvbiBieSB0aGUgcHJvdmlkZWQgZnJhY3Rpb24sIHNldHRpbmcgdGhlIHJlc3VsdCBpbnRvIHRoaXMgZnJhY3Rpb24gKG11dGF0ZXMpLlxyXG4gICAqIFRoZSB2YWx1ZSBpcyBub3QgcmVkdWNlZC5cclxuICAgKi9cclxuICBwdWJsaWMgZGl2aWRlKCB2YWx1ZTogRnJhY3Rpb24gKTogRnJhY3Rpb24ge1xyXG4gICAgdGhpcy5udW1lcmF0b3IgKj0gdmFsdWUuZGVub21pbmF0b3I7XHJcbiAgICB0aGlzLmRlbm9taW5hdG9yICo9IHZhbHVlLm51bWVyYXRvcjtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGl2aWRlcyB0aGlzIGZyYWN0aW9uIGJ5IGFub3RoZXIgZnJhY3Rpb24gdG8gY3JlYXRlIGEgbmV3IGZyYWN0aW9uLlxyXG4gICAqIFRoZSByZXN1bHQgaXMgbm90IHJlZHVjZWQuXHJcbiAgICovXHJcbiAgcHVibGljIGRpdmlkZWQoIHZhbHVlOiBGcmFjdGlvbiApOiBGcmFjdGlvbiB7XHJcbiAgICByZXR1cm4gdGhpcy5jb3B5KCkuZGl2aWRlKCB2YWx1ZSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29udmVuaWVuY2UgbWV0aG9kLlxyXG4gICAqIEFkZHMgYW4gaW50ZWdlciB2YWx1ZSB0byB0aGlzIGZyYWN0aW9uIHRvIGNyZWF0ZSBhIG5ldyBmcmFjdGlvbi5cclxuICAgKiBUaGUgcmVzdWx0IGlzIG5vdCByZWR1Y2VkLCBhbmQgdGhlIGRlbm9taW5hdG9yIGlzIHRoZSBzYW1lIGFzIHRoZSBkZW5vbWluYXRvciBvZiB0aGlzIGZyYWN0aW9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBwbHVzSW50ZWdlciggdmFsdWU6IG51bWJlciApOiBGcmFjdGlvbiB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBOdW1iZXIuaXNJbnRlZ2VyKCB2YWx1ZSApLCBgdmFsdWUgaXMgbm90IGFuIGludGVnZXI6ICR7dmFsdWV9YCApO1xyXG4gICAgcmV0dXJuIG5ldyBGcmFjdGlvbiggdGhpcy5udW1lcmF0b3IgKyAoIHZhbHVlICogdGhpcy5kZW5vbWluYXRvciApLCB0aGlzLmRlbm9taW5hdG9yICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb252ZW5pZW5jZSBtZXRob2QuXHJcbiAgICogU3VidHJhY3RzIGFuIGludGVnZXIgdmFsdWUgZnJvbSB0aGlzIGZyYWN0aW9uIHRvIGNyZWF0ZSBhIG5ldyBmcmFjdGlvbi5cclxuICAgKiBUaGUgcmVzdWx0IGlzIG5vdCByZWR1Y2VkLCBhbmQgdGhlIGRlbm9taW5hdG9yIGlzIHRoZSBzYW1lIGFzIHRoZSBkZW5vbWluYXRvciBvZiB0aGlzIGZyYWN0aW9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBtaW51c0ludGVnZXIoIHZhbHVlOiBudW1iZXIgKTogRnJhY3Rpb24ge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggTnVtYmVyLmlzSW50ZWdlciggdmFsdWUgKSwgYHZhbHVlIGlzIG5vdCBhbiBpbnRlZ2VyOiAke3ZhbHVlfWAgKTtcclxuICAgIHJldHVybiBuZXcgRnJhY3Rpb24oIHRoaXMubnVtZXJhdG9yIC0gKCB2YWx1ZSAqIHRoaXMuZGVub21pbmF0b3IgKSwgdGhpcy5kZW5vbWluYXRvciApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29udmVuaWVuY2UgbWV0aG9kLlxyXG4gICAqIE11bHRpcGxpZXMgdGhpcyBmcmFjdGlvbiBieSBhbiBpbnRlZ2VyIHRvIGNyZWF0ZSBhIG5ldyBmcmFjdGlvbi5cclxuICAgKiBUaGUgcmVzdWx0IGlzIG5vdCByZWR1Y2VkLCBhbmQgdGhlIGRlbm9taW5hdG9yIGlzIHRoZSBzYW1lIGFzIHRoZSBkZW5vbWluYXRvciBvZiB0aGlzIGZyYWN0aW9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyB0aW1lc0ludGVnZXIoIHZhbHVlOiBudW1iZXIgKTogRnJhY3Rpb24ge1xyXG4gICAgYXNzZXJ0ICYmIGFzc2VydCggTnVtYmVyLmlzSW50ZWdlciggdmFsdWUgKSwgYHZhbHVlIGlzIG5vdCBhbiBpbnRlZ2VyOiAke3ZhbHVlfWAgKTtcclxuICAgIHJldHVybiBuZXcgRnJhY3Rpb24oIHRoaXMubnVtZXJhdG9yICogdmFsdWUsIHRoaXMuZGVub21pbmF0b3IgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnZlbmllbmNlIG1ldGhvZC5cclxuICAgKiBEaXZpZGVzIHRoaXMgZnJhY3Rpb24gYnkgYW4gaW50ZWdlciB0byBjcmVhdGUgYSBuZXcgZnJhY3Rpb24uXHJcbiAgICogVGhpcyBvcGVyYXRpb24gYWZmZWN0cyB0aGUgdmFsdWUgYW5kIHNpZ24gb2YgdGhlIGRlbm9taW5hdG9yIG9ubHksIGFuZCB0aGUgcmVzdWx0IGlzIG5vdCByZWR1Y2VkLlxyXG4gICAqIENhcmVmdWwhIERpdmlzaW9uIGJ5IHplcm8gaXMgYWxsb3dlZCBoZXJlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBkaXZpZGVkSW50ZWdlciggdmFsdWU6IG51bWJlciApOiBGcmFjdGlvbiB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBOdW1iZXIuaXNJbnRlZ2VyKCB2YWx1ZSApLCBgdmFsdWUgaXMgbm90IGFuIGludGVnZXI6ICR7dmFsdWV9YCApO1xyXG4gICAgcmV0dXJuIG5ldyBGcmFjdGlvbiggdGhpcy5udW1lcmF0b3IsIHRoaXMuZGVub21pbmF0b3IgKiB2YWx1ZSApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBjb25zdHJ1Y3RpbmcgYSBmcmFjdGlvbiBmcm9tIGFuIGludGVnZXIuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBmcm9tSW50ZWdlciggdmFsdWU6IG51bWJlciApOiBGcmFjdGlvbiB7XHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBOdW1iZXIuaXNJbnRlZ2VyKCB2YWx1ZSApLCBgdmFsdWUgaXMgbm90IGFuIGludGVnZXI6ICR7dmFsdWV9YCApO1xyXG4gICAgcmV0dXJuIG5ldyBGcmFjdGlvbiggdmFsdWUsIDEgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnZlcnQgYSBudW1iZXIgaW50byBhIEZyYWN0aW9uXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXRpYyBmcm9tRGVjaW1hbCggdmFsdWU6IG51bWJlciApOiBGcmFjdGlvbiB7XHJcblxyXG4gICAgaWYgKCBOdW1iZXIuaXNJbnRlZ2VyKCB2YWx1ZSApICkge1xyXG4gICAgICByZXR1cm4gRnJhY3Rpb24uZnJvbUludGVnZXIoIHZhbHVlICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuXHJcbiAgICAgIC8vIEdldCB0aGUgZGVjaW1hbCBwYXJ0IG9mIHRoZSBudW1iZXIuXHJcbiAgICAgIGNvbnN0IGRlY2ltYWwgPSB2YWx1ZSAtIFV0aWxzLnRvRml4ZWROdW1iZXIoIHZhbHVlLCAwICk7XHJcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIGRlY2ltYWwgIT09IDAsICdleHBlY3RlZCBkZWNpbWFsIHRvIGJlIG5vbi16ZXJvJyApO1xyXG5cclxuICAgICAgLy8gQ29udmVydCB0aGUgZGVjaW1hbCBwYXJ0IGludG8gYW4gaW50ZWdlci4gVGhpcyBiZWNvbWVzIHRoZSBkZW5vbWluYXRvci5cclxuICAgICAgY29uc3QgZGVub21pbmF0b3IgPSBNYXRoLnBvdyggMTAsIFV0aWxzLm51bWJlck9mRGVjaW1hbFBsYWNlcyggZGVjaW1hbCApICk7XHJcblxyXG4gICAgICAvLyBDb21wdXRlIG51bWVyYXRvclxyXG4gICAgICBjb25zdCBudW1lcmF0b3IgPSBVdGlscy50b0ZpeGVkTnVtYmVyKCB2YWx1ZSAqIGRlbm9taW5hdG9yLCAwICk7XHJcblxyXG4gICAgICByZXR1cm4gbmV3IEZyYWN0aW9uKCBudW1lcmF0b3IsIGRlbm9taW5hdG9yICkucmVkdWNlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXJpYWxpemVzIHRoaXMgRnJhY3Rpb24gaW5zdGFuY2UuXHJcbiAgICovXHJcbiAgcHVibGljIHRvU3RhdGVPYmplY3QoKTogRnJhY3Rpb25TdGF0ZU9iamVjdCB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBudW1lcmF0b3I6IHRoaXMuX251bWVyYXRvcixcclxuICAgICAgZGVub21pbmF0b3I6IHRoaXMuX2Rlbm9taW5hdG9yXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVzZXJpYWxpemVzIGEgRnJhY3Rpb24gZnJvbSBQaEVULWlPIHN0YXRlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgZnJvbVN0YXRlT2JqZWN0KCBzdGF0ZU9iamVjdDogRnJhY3Rpb25TdGF0ZU9iamVjdCApOiBGcmFjdGlvbiB7XHJcbiAgICByZXR1cm4gbmV3IEZyYWN0aW9uKCBzdGF0ZU9iamVjdC5udW1lcmF0b3IsIHN0YXRlT2JqZWN0LmRlbm9taW5hdG9yICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJT1R5cGUgZm9yIEZyYWN0aW9uLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgRnJhY3Rpb25JTyA9IG5ldyBJT1R5cGU8RnJhY3Rpb24sIEZyYWN0aW9uU3RhdGVPYmplY3Q+KCAnRnJhY3Rpb25JTycsIHtcclxuICAgIHZhbHVlVHlwZTogRnJhY3Rpb24sXHJcbiAgICBzdGF0ZVNjaGVtYToge1xyXG4gICAgICBudW1lcmF0b3I6IE51bWJlcklPLFxyXG4gICAgICBkZW5vbWluYXRvcjogTnVtYmVySU9cclxuICAgIH0sXHJcbiAgICB0b1N0YXRlT2JqZWN0OiAoIGZyYWN0aW9uOiBGcmFjdGlvbiApID0+IGZyYWN0aW9uLnRvU3RhdGVPYmplY3QoKSxcclxuICAgIGZyb21TdGF0ZU9iamVjdDogKCBzdGF0ZU9iamVjdDogRnJhY3Rpb25TdGF0ZU9iamVjdCApID0+IEZyYWN0aW9uLmZyb21TdGF0ZU9iamVjdCggc3RhdGVPYmplY3QgKVxyXG4gIH0gKTtcclxufVxyXG5cclxuLy8gVXNlZCB0byBhdm9pZCBHQy4gTk9URTogRG8gTk9UIG1vdmUgaW4gZnJvbnQgb2YgdGhlIGNvbnN0cnVjdG9yLCBhcyBpdCBpcyBjcmVhdGluZyBhIGNvcHkgb2YgdGhlIHR5cGUgZGVmaW5lZC5cclxuY29uc3QgU0NSQVRDSF9GUkFDVElPTiA9IG5ldyBGcmFjdGlvbiggMSwgMSApO1xyXG5cclxucGhldGNvbW1vbi5yZWdpc3RlciggJ0ZyYWN0aW9uJywgRnJhY3Rpb24gKTsiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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