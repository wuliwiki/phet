// Copyright 2013-2022, University of Colorado Boulder

/**
 * Main model container, which has wall, balloons & sweater.
 *
 * @author Vasily Shakhov (Mlearner.com)
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Jesse Greenberg(PhET Interactive Simulations)
 */

import Emitter from '../../../../axon/js/Emitter.js';
import Multilink from '../../../../axon/js/Multilink.js';
import Property from '../../../../axon/js/Property.js';
import StringProperty from '../../../../axon/js/StringProperty.js';
import Bounds2 from '../../../../dot/js/Bounds2.js';
import balloonsAndStaticElectricity from '../../balloonsAndStaticElectricity.js';
import BalloonModel from './BalloonModel.js';
import PlayAreaMap from './PlayAreaMap.js';
import ScanningPropertySet from './ScanningPropertySet.js';
import SweaterModel from './SweaterModel.js';
import WallModel from './WallModel.js';
class BASEModel {
  /**
   * Constructor for main model for the Balloons and Static Electricity sim.
   * @param {number} width
   * @param {number} height
   * @param {Tandem} tandem
   */
  constructor(width, height, tandem) {
    // @public {string} - charge visibility setting, valid values of 'all', 'none', 'diff'
    this.showChargesProperty = new StringProperty('all', {
      tandem: tandem.createTandem('showChargesProperty')
    });

    // @public {boolean} - whether or not the two balloons are considered 'next to' each other, primarily used for a11y
    this.balloonsAdjacentProperty = new Property(false);

    // @public (read-only)
    this.width = width;
    this.height = height;

    // @public {read-only}
    this.wallWidth = 80;

    // @public (read-only) - Model of the sweater, position empirically determined to match design
    this.sweater = new SweaterModel(25, 20, tandem.createTandem('sweater'));

    // @public
    this.playAreaBounds = new Bounds2(0, 0, width - this.wallWidth, height);
    this.yellowBalloon = new BalloonModel(440, 100, this, true, tandem.createTandem('yellowBalloon'));
    this.greenBalloon = new BalloonModel(380, 130, this, false, tandem.createTandem('greenBalloon'));

    // assign 'other' balloon references
    this.yellowBalloon.other = this.greenBalloon;
    this.greenBalloon.other = this.yellowBalloon;

    // @public - set of Properties that indicate where the user is while scanning for objects in the play area
    this.scanningPropertySet = new ScanningPropertySet();

    // @public (read-only) - Model of the wall
    this.wall = new WallModel(width - this.wallWidth, this.wallWidth, height, this.yellowBalloon, this.greenBalloon, tandem.createTandem('wall'));

    // @public - broadcasts an event when we step the model
    this.stepEmitter = new Emitter({
      parameters: [{
        valueType: 'number'
      }]
    });

    // when the wall changes visibility, the balloons could start moving if they have charge and are near the wall
    this.wall.isVisibleProperty.link(isVisible => {
      // update the model bounds
      const newWidth = isVisible ? width - this.wallWidth : width;
      this.playAreaBounds.setMaxX(newWidth);
    });

    // add listeners to each balloon
    this.balloons.forEach(balloon => {
      // when the balloon positions change, update the closest charge in the wall
      balloon.positionProperty.link(position => {
        // find the closest charge in the wall
        balloon.closestChargeInWall = this.wall.getClosestChargeToBalloon(balloon);

        // update whether or not the two balloons are close to each other
        this.balloonsAdjacentProperty.set(this.getBalloonsAdjacent());

        // update the balloon play area row and column
        balloon.playAreaRowProperty.set(PlayAreaMap.getPlayAreaRow(balloon.getCenter(), this.wall.isVisibleProperty.get()));
        balloon.playAreaColumnProperty.set(PlayAreaMap.getPlayAreaColumn(balloon.getCenter()));
        balloon.playAreaLandmarkProperty.set(PlayAreaMap.getPlayAreaLandmark(balloon.getCenter()));
      });

      // when wall visibility changes, update the Properties indicating induced charge and which charges are visible
      this.wall.isVisibleProperty.link(isVisible => {
        balloon.touchingWallProperty.set(balloon.touchingWall());
      });

      // update whether the balloon is currently inducing charge in the wall
      Multilink.multilink([this.wall.isVisibleProperty, balloon.positionProperty], (wallVisible, position) => {
        balloon.inducingChargeProperty.set(balloon.inducingCharge(wallVisible));
      });
    });
    this.reset();
  }

  /**
   * Get all of the ballons in an array, for ease of iterating over them.
   * @returns {BalloonModel[]}
   */
  get balloons() {
    return [this.yellowBalloon, this.greenBalloon];
  }

  /**
   * Called by the animation loop.
   * @public
   * @param {number} dt
   */
  step(dt) {
    this.balloons.forEach(balloon => {
      if (balloon.isVisibleProperty.get()) {
        balloon.step(this, dt);
      }
    });
    this.stepEmitter.emit(dt);
  }

  /**
   * Reset the entire model.
   * @public
   */
  reset() {
    //Reset the properties in this model
    this.showChargesProperty.reset();

    //Reset balloons, resetChildren don't get them
    this.balloons.forEach(balloon => {
      balloon.reset();
    });
    this.sweater.reset();
    this.wall.reset();
  }

  /**
   * Return true when both balloons are visible.
   * @public
   *
   * @returns {boolean}
   */
  bothBalloonsVisible() {
    return this.greenBalloon.isVisibleProperty.get() && this.yellowBalloon.isVisibleProperty.get();
  }

  /**
   * Returns true when both balloons are visible and adjacent to each other.
   * @public
   *
   * @returns {boolean}
   */
  getBalloonsAdjacent() {
    const balloonsAdjacent = this.yellowBalloon.getCenter().minus(this.greenBalloon.getCenter()).magnitude < BalloonModel.BALLOON_WIDTH;
    return balloonsAdjacent && this.bothBalloonsVisible();
  }
}
BASEModel.LEFT = 'LEFT';
BASEModel.RIGHT = 'RIGHT';
BASEModel.UP = 'UP';
BASEModel.DOWN = 'DOWN';
BASEModel.UP_LEFT = 'UP_LEFT';
BASEModel.UP_RIGHT = 'UP_RIGHT';
BASEModel.DOWN_LEFT = 'DOWN_LEFT';
BASEModel.DOWN_RIGHT = 'DOWN_RIGHT';
balloonsAndStaticElectricity.register('BASEModel', BASEModel);
export default BASEModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFbWl0dGVyIiwiTXVsdGlsaW5rIiwiUHJvcGVydHkiLCJTdHJpbmdQcm9wZXJ0eSIsIkJvdW5kczIiLCJiYWxsb29uc0FuZFN0YXRpY0VsZWN0cmljaXR5IiwiQmFsbG9vbk1vZGVsIiwiUGxheUFyZWFNYXAiLCJTY2FubmluZ1Byb3BlcnR5U2V0IiwiU3dlYXRlck1vZGVsIiwiV2FsbE1vZGVsIiwiQkFTRU1vZGVsIiwiY29uc3RydWN0b3IiLCJ3aWR0aCIsImhlaWdodCIsInRhbmRlbSIsInNob3dDaGFyZ2VzUHJvcGVydHkiLCJjcmVhdGVUYW5kZW0iLCJiYWxsb29uc0FkamFjZW50UHJvcGVydHkiLCJ3YWxsV2lkdGgiLCJzd2VhdGVyIiwicGxheUFyZWFCb3VuZHMiLCJ5ZWxsb3dCYWxsb29uIiwiZ3JlZW5CYWxsb29uIiwib3RoZXIiLCJzY2FubmluZ1Byb3BlcnR5U2V0Iiwid2FsbCIsInN0ZXBFbWl0dGVyIiwicGFyYW1ldGVycyIsInZhbHVlVHlwZSIsImlzVmlzaWJsZVByb3BlcnR5IiwibGluayIsImlzVmlzaWJsZSIsIm5ld1dpZHRoIiwic2V0TWF4WCIsImJhbGxvb25zIiwiZm9yRWFjaCIsImJhbGxvb24iLCJwb3NpdGlvblByb3BlcnR5IiwicG9zaXRpb24iLCJjbG9zZXN0Q2hhcmdlSW5XYWxsIiwiZ2V0Q2xvc2VzdENoYXJnZVRvQmFsbG9vbiIsInNldCIsImdldEJhbGxvb25zQWRqYWNlbnQiLCJwbGF5QXJlYVJvd1Byb3BlcnR5IiwiZ2V0UGxheUFyZWFSb3ciLCJnZXRDZW50ZXIiLCJnZXQiLCJwbGF5QXJlYUNvbHVtblByb3BlcnR5IiwiZ2V0UGxheUFyZWFDb2x1bW4iLCJwbGF5QXJlYUxhbmRtYXJrUHJvcGVydHkiLCJnZXRQbGF5QXJlYUxhbmRtYXJrIiwidG91Y2hpbmdXYWxsUHJvcGVydHkiLCJ0b3VjaGluZ1dhbGwiLCJtdWx0aWxpbmsiLCJ3YWxsVmlzaWJsZSIsImluZHVjaW5nQ2hhcmdlUHJvcGVydHkiLCJpbmR1Y2luZ0NoYXJnZSIsInJlc2V0Iiwic3RlcCIsImR0IiwiZW1pdCIsImJvdGhCYWxsb29uc1Zpc2libGUiLCJiYWxsb29uc0FkamFjZW50IiwibWludXMiLCJtYWduaXR1ZGUiLCJCQUxMT09OX1dJRFRIIiwiTEVGVCIsIlJJR0hUIiwiVVAiLCJET1dOIiwiVVBfTEVGVCIsIlVQX1JJR0hUIiwiRE9XTl9MRUZUIiwiRE9XTl9SSUdIVCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQkFTRU1vZGVsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDEzLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIE1haW4gbW9kZWwgY29udGFpbmVyLCB3aGljaCBoYXMgd2FsbCwgYmFsbG9vbnMgJiBzd2VhdGVyLlxyXG4gKlxyXG4gKiBAYXV0aG9yIFZhc2lseSBTaGFraG92IChNbGVhcm5lci5jb20pXHJcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqL1xyXG5cclxuaW1wb3J0IEVtaXR0ZXIgZnJvbSAnLi4vLi4vLi4vLi4vYXhvbi9qcy9FbWl0dGVyLmpzJztcclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL1Byb3BlcnR5LmpzJztcclxuaW1wb3J0IFN0cmluZ1Byb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uL2F4b24vanMvU3RyaW5nUHJvcGVydHkuanMnO1xyXG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XHJcbmltcG9ydCBiYWxsb29uc0FuZFN0YXRpY0VsZWN0cmljaXR5IGZyb20gJy4uLy4uL2JhbGxvb25zQW5kU3RhdGljRWxlY3RyaWNpdHkuanMnO1xyXG5pbXBvcnQgQmFsbG9vbk1vZGVsIGZyb20gJy4vQmFsbG9vbk1vZGVsLmpzJztcclxuaW1wb3J0IFBsYXlBcmVhTWFwIGZyb20gJy4vUGxheUFyZWFNYXAuanMnO1xyXG5pbXBvcnQgU2Nhbm5pbmdQcm9wZXJ0eVNldCBmcm9tICcuL1NjYW5uaW5nUHJvcGVydHlTZXQuanMnO1xyXG5pbXBvcnQgU3dlYXRlck1vZGVsIGZyb20gJy4vU3dlYXRlck1vZGVsLmpzJztcclxuaW1wb3J0IFdhbGxNb2RlbCBmcm9tICcuL1dhbGxNb2RlbC5qcyc7XHJcblxyXG5jbGFzcyBCQVNFTW9kZWwge1xyXG5cclxuICAvKipcclxuICAgKiBDb25zdHJ1Y3RvciBmb3IgbWFpbiBtb2RlbCBmb3IgdGhlIEJhbGxvb25zIGFuZCBTdGF0aWMgRWxlY3RyaWNpdHkgc2ltLlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aFxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHRcclxuICAgKiBAcGFyYW0ge1RhbmRlbX0gdGFuZGVtXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIHdpZHRoLCBoZWlnaHQsIHRhbmRlbSApIHtcclxuXHJcbiAgICAvLyBAcHVibGljIHtzdHJpbmd9IC0gY2hhcmdlIHZpc2liaWxpdHkgc2V0dGluZywgdmFsaWQgdmFsdWVzIG9mICdhbGwnLCAnbm9uZScsICdkaWZmJ1xyXG4gICAgdGhpcy5zaG93Q2hhcmdlc1Byb3BlcnR5ID0gbmV3IFN0cmluZ1Byb3BlcnR5KCAnYWxsJywge1xyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdzaG93Q2hhcmdlc1Byb3BlcnR5JyApXHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7Ym9vbGVhbn0gLSB3aGV0aGVyIG9yIG5vdCB0aGUgdHdvIGJhbGxvb25zIGFyZSBjb25zaWRlcmVkICduZXh0IHRvJyBlYWNoIG90aGVyLCBwcmltYXJpbHkgdXNlZCBmb3IgYTExeVxyXG4gICAgdGhpcy5iYWxsb29uc0FkamFjZW50UHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIGZhbHNlICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAocmVhZC1vbmx5KVxyXG4gICAgdGhpcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XHJcblxyXG4gICAgLy8gQHB1YmxpYyB7cmVhZC1vbmx5fVxyXG4gICAgdGhpcy53YWxsV2lkdGggPSA4MDtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIC0gTW9kZWwgb2YgdGhlIHN3ZWF0ZXIsIHBvc2l0aW9uIGVtcGlyaWNhbGx5IGRldGVybWluZWQgdG8gbWF0Y2ggZGVzaWduXHJcbiAgICB0aGlzLnN3ZWF0ZXIgPSBuZXcgU3dlYXRlck1vZGVsKCAyNSwgMjAsIHRhbmRlbS5jcmVhdGVUYW5kZW0oICdzd2VhdGVyJyApICk7XHJcblxyXG4gICAgLy8gQHB1YmxpY1xyXG4gICAgdGhpcy5wbGF5QXJlYUJvdW5kcyA9IG5ldyBCb3VuZHMyKCAwLCAwLCB3aWR0aCAtIHRoaXMud2FsbFdpZHRoLCBoZWlnaHQgKTtcclxuICAgIHRoaXMueWVsbG93QmFsbG9vbiA9IG5ldyBCYWxsb29uTW9kZWwoIDQ0MCwgMTAwLCB0aGlzLCB0cnVlLCB0YW5kZW0uY3JlYXRlVGFuZGVtKCAneWVsbG93QmFsbG9vbicgKSApO1xyXG4gICAgdGhpcy5ncmVlbkJhbGxvb24gPSBuZXcgQmFsbG9vbk1vZGVsKCAzODAsIDEzMCwgdGhpcywgZmFsc2UsIHRhbmRlbS5jcmVhdGVUYW5kZW0oICdncmVlbkJhbGxvb24nICkgKTtcclxuXHJcbiAgICAvLyBhc3NpZ24gJ290aGVyJyBiYWxsb29uIHJlZmVyZW5jZXNcclxuICAgIHRoaXMueWVsbG93QmFsbG9vbi5vdGhlciA9IHRoaXMuZ3JlZW5CYWxsb29uO1xyXG4gICAgdGhpcy5ncmVlbkJhbGxvb24ub3RoZXIgPSB0aGlzLnllbGxvd0JhbGxvb247XHJcblxyXG4gICAgLy8gQHB1YmxpYyAtIHNldCBvZiBQcm9wZXJ0aWVzIHRoYXQgaW5kaWNhdGUgd2hlcmUgdGhlIHVzZXIgaXMgd2hpbGUgc2Nhbm5pbmcgZm9yIG9iamVjdHMgaW4gdGhlIHBsYXkgYXJlYVxyXG4gICAgdGhpcy5zY2FubmluZ1Byb3BlcnR5U2V0ID0gbmV3IFNjYW5uaW5nUHJvcGVydHlTZXQoKTtcclxuXHJcbiAgICAvLyBAcHVibGljIChyZWFkLW9ubHkpIC0gTW9kZWwgb2YgdGhlIHdhbGxcclxuICAgIHRoaXMud2FsbCA9IG5ldyBXYWxsTW9kZWwoIHdpZHRoIC0gdGhpcy53YWxsV2lkdGgsIHRoaXMud2FsbFdpZHRoLCBoZWlnaHQsIHRoaXMueWVsbG93QmFsbG9vbiwgdGhpcy5ncmVlbkJhbGxvb24sIHRhbmRlbS5jcmVhdGVUYW5kZW0oICd3YWxsJyApICk7XHJcblxyXG4gICAgLy8gQHB1YmxpYyAtIGJyb2FkY2FzdHMgYW4gZXZlbnQgd2hlbiB3ZSBzdGVwIHRoZSBtb2RlbFxyXG4gICAgdGhpcy5zdGVwRW1pdHRlciA9IG5ldyBFbWl0dGVyKCB7XHJcbiAgICAgIHBhcmFtZXRlcnM6IFsgeyB2YWx1ZVR5cGU6ICdudW1iZXInIH0gXVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIHdoZW4gdGhlIHdhbGwgY2hhbmdlcyB2aXNpYmlsaXR5LCB0aGUgYmFsbG9vbnMgY291bGQgc3RhcnQgbW92aW5nIGlmIHRoZXkgaGF2ZSBjaGFyZ2UgYW5kIGFyZSBuZWFyIHRoZSB3YWxsXHJcbiAgICB0aGlzLndhbGwuaXNWaXNpYmxlUHJvcGVydHkubGluayggaXNWaXNpYmxlID0+IHtcclxuXHJcbiAgICAgIC8vIHVwZGF0ZSB0aGUgbW9kZWwgYm91bmRzXHJcbiAgICAgIGNvbnN0IG5ld1dpZHRoID0gaXNWaXNpYmxlID8gd2lkdGggLSB0aGlzLndhbGxXaWR0aCA6IHdpZHRoO1xyXG4gICAgICB0aGlzLnBsYXlBcmVhQm91bmRzLnNldE1heFgoIG5ld1dpZHRoICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgLy8gYWRkIGxpc3RlbmVycyB0byBlYWNoIGJhbGxvb25cclxuICAgIHRoaXMuYmFsbG9vbnMuZm9yRWFjaCggYmFsbG9vbiA9PiB7XHJcblxyXG4gICAgICAvLyB3aGVuIHRoZSBiYWxsb29uIHBvc2l0aW9ucyBjaGFuZ2UsIHVwZGF0ZSB0aGUgY2xvc2VzdCBjaGFyZ2UgaW4gdGhlIHdhbGxcclxuICAgICAgYmFsbG9vbi5wb3NpdGlvblByb3BlcnR5LmxpbmsoIHBvc2l0aW9uID0+IHtcclxuXHJcbiAgICAgICAgLy8gZmluZCB0aGUgY2xvc2VzdCBjaGFyZ2UgaW4gdGhlIHdhbGxcclxuICAgICAgICBiYWxsb29uLmNsb3Nlc3RDaGFyZ2VJbldhbGwgPSB0aGlzLndhbGwuZ2V0Q2xvc2VzdENoYXJnZVRvQmFsbG9vbiggYmFsbG9vbiApO1xyXG5cclxuICAgICAgICAvLyB1cGRhdGUgd2hldGhlciBvciBub3QgdGhlIHR3byBiYWxsb29ucyBhcmUgY2xvc2UgdG8gZWFjaCBvdGhlclxyXG4gICAgICAgIHRoaXMuYmFsbG9vbnNBZGphY2VudFByb3BlcnR5LnNldCggdGhpcy5nZXRCYWxsb29uc0FkamFjZW50KCkgKTtcclxuXHJcbiAgICAgICAgLy8gdXBkYXRlIHRoZSBiYWxsb29uIHBsYXkgYXJlYSByb3cgYW5kIGNvbHVtblxyXG4gICAgICAgIGJhbGxvb24ucGxheUFyZWFSb3dQcm9wZXJ0eS5zZXQoIFBsYXlBcmVhTWFwLmdldFBsYXlBcmVhUm93KCBiYWxsb29uLmdldENlbnRlcigpLCB0aGlzLndhbGwuaXNWaXNpYmxlUHJvcGVydHkuZ2V0KCkgKSApO1xyXG4gICAgICAgIGJhbGxvb24ucGxheUFyZWFDb2x1bW5Qcm9wZXJ0eS5zZXQoIFBsYXlBcmVhTWFwLmdldFBsYXlBcmVhQ29sdW1uKCBiYWxsb29uLmdldENlbnRlcigpICkgKTtcclxuICAgICAgICBiYWxsb29uLnBsYXlBcmVhTGFuZG1hcmtQcm9wZXJ0eS5zZXQoIFBsYXlBcmVhTWFwLmdldFBsYXlBcmVhTGFuZG1hcmsoIGJhbGxvb24uZ2V0Q2VudGVyKCkgKSApO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyB3aGVuIHdhbGwgdmlzaWJpbGl0eSBjaGFuZ2VzLCB1cGRhdGUgdGhlIFByb3BlcnRpZXMgaW5kaWNhdGluZyBpbmR1Y2VkIGNoYXJnZSBhbmQgd2hpY2ggY2hhcmdlcyBhcmUgdmlzaWJsZVxyXG4gICAgICB0aGlzLndhbGwuaXNWaXNpYmxlUHJvcGVydHkubGluayggaXNWaXNpYmxlID0+IHtcclxuICAgICAgICBiYWxsb29uLnRvdWNoaW5nV2FsbFByb3BlcnR5LnNldCggYmFsbG9vbi50b3VjaGluZ1dhbGwoKSApO1xyXG4gICAgICB9ICk7XHJcblxyXG4gICAgICAvLyB1cGRhdGUgd2hldGhlciB0aGUgYmFsbG9vbiBpcyBjdXJyZW50bHkgaW5kdWNpbmcgY2hhcmdlIGluIHRoZSB3YWxsXHJcbiAgICAgIE11bHRpbGluay5tdWx0aWxpbmsoIFsgdGhpcy53YWxsLmlzVmlzaWJsZVByb3BlcnR5LCBiYWxsb29uLnBvc2l0aW9uUHJvcGVydHkgXSwgKCB3YWxsVmlzaWJsZSwgcG9zaXRpb24gKSA9PiB7XHJcbiAgICAgICAgYmFsbG9vbi5pbmR1Y2luZ0NoYXJnZVByb3BlcnR5LnNldCggYmFsbG9vbi5pbmR1Y2luZ0NoYXJnZSggd2FsbFZpc2libGUgKSApO1xyXG4gICAgICB9ICk7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgdGhpcy5yZXNldCgpO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBhbGwgb2YgdGhlIGJhbGxvbnMgaW4gYW4gYXJyYXksIGZvciBlYXNlIG9mIGl0ZXJhdGluZyBvdmVyIHRoZW0uXHJcbiAgICogQHJldHVybnMge0JhbGxvb25Nb2RlbFtdfVxyXG4gICAqL1xyXG4gIGdldCBiYWxsb29ucygpIHtcclxuICAgIHJldHVybiBbIHRoaXMueWVsbG93QmFsbG9vbiwgdGhpcy5ncmVlbkJhbGxvb24gXTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGxlZCBieSB0aGUgYW5pbWF0aW9uIGxvb3AuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBkdFxyXG4gICAqL1xyXG4gIHN0ZXAoIGR0ICkge1xyXG4gICAgdGhpcy5iYWxsb29ucy5mb3JFYWNoKCBiYWxsb29uID0+IHtcclxuICAgICAgaWYgKCBiYWxsb29uLmlzVmlzaWJsZVByb3BlcnR5LmdldCgpICkge1xyXG4gICAgICAgIGJhbGxvb24uc3RlcCggdGhpcywgZHQgKTtcclxuICAgICAgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuc3RlcEVtaXR0ZXIuZW1pdCggZHQgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc2V0IHRoZSBlbnRpcmUgbW9kZWwuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqL1xyXG4gIHJlc2V0KCkge1xyXG5cclxuICAgIC8vUmVzZXQgdGhlIHByb3BlcnRpZXMgaW4gdGhpcyBtb2RlbFxyXG4gICAgdGhpcy5zaG93Q2hhcmdlc1Byb3BlcnR5LnJlc2V0KCk7XHJcblxyXG4gICAgLy9SZXNldCBiYWxsb29ucywgcmVzZXRDaGlsZHJlbiBkb24ndCBnZXQgdGhlbVxyXG4gICAgdGhpcy5iYWxsb29ucy5mb3JFYWNoKCBiYWxsb29uID0+IHtcclxuICAgICAgYmFsbG9vbi5yZXNldCgpO1xyXG4gICAgfSApO1xyXG5cclxuICAgIHRoaXMuc3dlYXRlci5yZXNldCgpO1xyXG4gICAgdGhpcy53YWxsLnJlc2V0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm4gdHJ1ZSB3aGVuIGJvdGggYmFsbG9vbnMgYXJlIHZpc2libGUuXHJcbiAgICogQHB1YmxpY1xyXG4gICAqXHJcbiAgICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAgICovXHJcbiAgYm90aEJhbGxvb25zVmlzaWJsZSgpIHtcclxuICAgIHJldHVybiB0aGlzLmdyZWVuQmFsbG9vbi5pc1Zpc2libGVQcm9wZXJ0eS5nZXQoKSAmJiB0aGlzLnllbGxvd0JhbGxvb24uaXNWaXNpYmxlUHJvcGVydHkuZ2V0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm5zIHRydWUgd2hlbiBib3RoIGJhbGxvb25zIGFyZSB2aXNpYmxlIGFuZCBhZGphY2VudCB0byBlYWNoIG90aGVyLlxyXG4gICAqIEBwdWJsaWNcclxuICAgKlxyXG4gICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAqL1xyXG4gIGdldEJhbGxvb25zQWRqYWNlbnQoKSB7XHJcbiAgICBjb25zdCBiYWxsb29uc0FkamFjZW50ID0gKCB0aGlzLnllbGxvd0JhbGxvb24uZ2V0Q2VudGVyKCkubWludXMoIHRoaXMuZ3JlZW5CYWxsb29uLmdldENlbnRlcigpICkubWFnbml0dWRlICkgPCBCYWxsb29uTW9kZWwuQkFMTE9PTl9XSURUSDtcclxuICAgIHJldHVybiBiYWxsb29uc0FkamFjZW50ICYmIHRoaXMuYm90aEJhbGxvb25zVmlzaWJsZSgpO1xyXG4gIH1cclxufVxyXG5cclxuXHJcbkJBU0VNb2RlbC5MRUZUID0gJ0xFRlQnO1xyXG5CQVNFTW9kZWwuUklHSFQgPSAnUklHSFQnO1xyXG5CQVNFTW9kZWwuVVAgPSAnVVAnO1xyXG5CQVNFTW9kZWwuRE9XTiA9ICdET1dOJztcclxuQkFTRU1vZGVsLlVQX0xFRlQgPSAnVVBfTEVGVCc7XHJcbkJBU0VNb2RlbC5VUF9SSUdIVCA9ICdVUF9SSUdIVCc7XHJcbkJBU0VNb2RlbC5ET1dOX0xFRlQgPSAnRE9XTl9MRUZUJztcclxuQkFTRU1vZGVsLkRPV05fUklHSFQgPSAnRE9XTl9SSUdIVCc7XHJcblxyXG5iYWxsb29uc0FuZFN0YXRpY0VsZWN0cmljaXR5LnJlZ2lzdGVyKCAnQkFTRU1vZGVsJywgQkFTRU1vZGVsICk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBCQVNFTW9kZWw7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPQSxPQUFPLE1B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