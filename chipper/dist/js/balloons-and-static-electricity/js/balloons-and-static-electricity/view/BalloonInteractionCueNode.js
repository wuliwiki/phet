// Copyright 2017-2023, University of Colorado Boulder

/**
 * A node that provides an interaction cue for dragging the balloon in Balloons and Static Electricity. Includes arrow
 * and letter keys to indicate that the user can use WASD or arrow keys to move it around the play area.
 *
 * @author Jesse Greenberg
 */

import Multilink from '../../../../axon/js/Multilink.js';
import { Shape } from '../../../../kite/js/imports.js';
import LetterKeyNode from '../../../../scenery-phet/js/keyboard/LetterKeyNode.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import { HBox, Node, Path, VBox } from '../../../../scenery/js/imports.js';
import balloonsAndStaticElectricity from '../../balloonsAndStaticElectricity.js';
import PlayAreaMap from '../model/PlayAreaMap.js';

// constants
const ARROW_HEIGHT = 15; // dimensions for the arrow icons
const KEY_HEIGHT = 24; // height of the arrow key, larger than default KeyNode height
const ARROW_WIDTH = 1 / 2 * Math.sqrt(3) * ARROW_HEIGHT; // for equilateral triangle
const LETTER_KEY_OPTIONS = {
  font: new PhetFont(14),
  keyHeight: KEY_HEIGHT
};
const KEY_ARROW_SPACING = 2;
const BALLOON_KEY_SPACING = 8;
const SHADOW_WIDTH = 2;

// possible directions or the directional cues
const DIRECTION_ANGLES = {
  up: 0,
  down: Math.PI,
  left: -Math.PI / 2,
  right: Math.PI / 2
};
class BalloonInteractionCueNode extends Node {
  /**
   * @param {BASEModel} model
   * @param {BalloonModel} balloonModel
   * @param {BalloonNode} balloonNode
   * @param {Bounds2} layoutBounds
   */
  constructor(model, balloonModel, balloonNode, layoutBounds) {
    super();

    // create the help node for the WASD and arrow keys, invisible except for on the initial balloon pick up
    const directionKeysParent = new Node();
    this.addChild(directionKeysParent);
    const wNode = this.createMovementKeyNode('up');
    const aNode = this.createMovementKeyNode('left');
    const sNode = this.createMovementKeyNode('down');
    const dNode = this.createMovementKeyNode('right');
    directionKeysParent.addChild(wNode);
    directionKeysParent.addChild(aNode);
    directionKeysParent.addChild(sNode);
    directionKeysParent.addChild(dNode);

    // add listeners to update visibility of nodes when position changes and when the wall is made
    // visible/invisible
    Multilink.multilink([balloonModel.positionProperty, model.wall.isVisibleProperty], (position, visible) => {
      // get the max x positions depending on if the wall is visible
      let centerXRightBoundary;
      if (visible) {
        centerXRightBoundary = PlayAreaMap.X_POSITIONS.AT_WALL;
      } else {
        centerXRightBoundary = PlayAreaMap.X_BOUNDARY_POSITIONS.AT_RIGHT_EDGE;
      }
      const balloonCenter = balloonModel.getCenter();
      aNode.visible = balloonCenter.x !== PlayAreaMap.X_BOUNDARY_POSITIONS.AT_LEFT_EDGE;
      sNode.visible = balloonCenter.y !== PlayAreaMap.Y_BOUNDARY_POSITIONS.AT_BOTTOM;
      dNode.visible = balloonCenter.x !== centerXRightBoundary;
      wNode.visible = balloonCenter.y !== PlayAreaMap.Y_BOUNDARY_POSITIONS.AT_TOP;
    });

    // place the direction cues relative to the balloon bounds
    const balloonBounds = balloonModel.bounds;
    wNode.centerBottom = balloonBounds.getCenterTop().plusXY(0, -BALLOON_KEY_SPACING);
    aNode.rightCenter = balloonBounds.getLeftCenter().plusXY(-BALLOON_KEY_SPACING, 0);
    sNode.centerTop = balloonBounds.getCenterBottom().plusXY(0, BALLOON_KEY_SPACING + SHADOW_WIDTH);
    dNode.leftCenter = balloonBounds.getRightCenter().plusXY(BALLOON_KEY_SPACING + SHADOW_WIDTH, 0);
  }

  /**
   * Create a node that looks like a keyboard letter key next to an arrow indicating the direction the balloon
   * would move if that key is pressed.
   *
   * @private
   *
   * @param {string} direction - 'up'|'down'|'left'|'right'
   * @returns {Node}
   */
  createMovementKeyNode(direction) {
    // create the arrow icon
    const arrowShape = new Shape();
    arrowShape.moveTo(ARROW_HEIGHT / 2, 0).lineTo(ARROW_HEIGHT, ARROW_WIDTH).lineTo(0, ARROW_WIDTH).close();
    const arrowIcon = new Path(arrowShape, {
      fill: 'white',
      stroke: 'black',
      lineJoin: 'bevel',
      lineCap: 'butt',
      lineWidth: 2,
      rotation: DIRECTION_ANGLES[direction]
    });

    // create the letter key nodes and place in the correct layout box
    let keyIcon;
    let box;
    if (direction === 'up') {
      keyIcon = LetterKeyNode.w(LETTER_KEY_OPTIONS);
      box = new VBox({
        children: [arrowIcon, keyIcon],
        spacing: KEY_ARROW_SPACING
      });
    } else if (direction === 'left') {
      keyIcon = LetterKeyNode.a(LETTER_KEY_OPTIONS);
      box = new HBox({
        children: [arrowIcon, keyIcon],
        spacing: KEY_ARROW_SPACING
      });
    } else if (direction === 'right') {
      keyIcon = LetterKeyNode.d(LETTER_KEY_OPTIONS);
      box = new HBox({
        children: [keyIcon, arrowIcon],
        spacing: KEY_ARROW_SPACING
      });
    } else if (direction === 'down') {
      keyIcon = LetterKeyNode.s(LETTER_KEY_OPTIONS);
      box = new VBox({
        children: [keyIcon, arrowIcon],
        spacing: KEY_ARROW_SPACING
      });
    }
    assert && assert(box, `No box created for direction ${direction}`);
    return box;
  }
}
balloonsAndStaticElectricity.register('BalloonInteractionCueNode', BalloonInteractionCueNode);
export default BalloonInteractionCueNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aWxpbmsiLCJTaGFwZSIsIkxldHRlcktleU5vZGUiLCJQaGV0Rm9udCIsIkhCb3giLCJOb2RlIiwiUGF0aCIsIlZCb3giLCJiYWxsb29uc0FuZFN0YXRpY0VsZWN0cmljaXR5IiwiUGxheUFyZWFNYXAiLCJBUlJPV19IRUlHSFQiLCJLRVlfSEVJR0hUIiwiQVJST1dfV0lEVEgiLCJNYXRoIiwic3FydCIsIkxFVFRFUl9LRVlfT1BUSU9OUyIsImZvbnQiLCJrZXlIZWlnaHQiLCJLRVlfQVJST1dfU1BBQ0lORyIsIkJBTExPT05fS0VZX1NQQUNJTkciLCJTSEFET1dfV0lEVEgiLCJESVJFQ1RJT05fQU5HTEVTIiwidXAiLCJkb3duIiwiUEkiLCJsZWZ0IiwicmlnaHQiLCJCYWxsb29uSW50ZXJhY3Rpb25DdWVOb2RlIiwiY29uc3RydWN0b3IiLCJtb2RlbCIsImJhbGxvb25Nb2RlbCIsImJhbGxvb25Ob2RlIiwibGF5b3V0Qm91bmRzIiwiZGlyZWN0aW9uS2V5c1BhcmVudCIsImFkZENoaWxkIiwid05vZGUiLCJjcmVhdGVNb3ZlbWVudEtleU5vZGUiLCJhTm9kZSIsInNOb2RlIiwiZE5vZGUiLCJtdWx0aWxpbmsiLCJwb3NpdGlvblByb3BlcnR5Iiwid2FsbCIsImlzVmlzaWJsZVByb3BlcnR5IiwicG9zaXRpb24iLCJ2aXNpYmxlIiwiY2VudGVyWFJpZ2h0Qm91bmRhcnkiLCJYX1BPU0lUSU9OUyIsIkFUX1dBTEwiLCJYX0JPVU5EQVJZX1BPU0lUSU9OUyIsIkFUX1JJR0hUX0VER0UiLCJiYWxsb29uQ2VudGVyIiwiZ2V0Q2VudGVyIiwieCIsIkFUX0xFRlRfRURHRSIsInkiLCJZX0JPVU5EQVJZX1BPU0lUSU9OUyIsIkFUX0JPVFRPTSIsIkFUX1RPUCIsImJhbGxvb25Cb3VuZHMiLCJib3VuZHMiLCJjZW50ZXJCb3R0b20iLCJnZXRDZW50ZXJUb3AiLCJwbHVzWFkiLCJyaWdodENlbnRlciIsImdldExlZnRDZW50ZXIiLCJjZW50ZXJUb3AiLCJnZXRDZW50ZXJCb3R0b20iLCJsZWZ0Q2VudGVyIiwiZ2V0UmlnaHRDZW50ZXIiLCJkaXJlY3Rpb24iLCJhcnJvd1NoYXBlIiwibW92ZVRvIiwibGluZVRvIiwiY2xvc2UiLCJhcnJvd0ljb24iLCJmaWxsIiwic3Ryb2tlIiwibGluZUpvaW4iLCJsaW5lQ2FwIiwibGluZVdpZHRoIiwicm90YXRpb24iLCJrZXlJY29uIiwiYm94IiwidyIsImNoaWxkcmVuIiwic3BhY2luZyIsImEiLCJkIiwicyIsImFzc2VydCIsInJlZ2lzdGVyIl0sInNvdXJjZXMiOlsiQmFsbG9vbkludGVyYWN0aW9uQ3VlTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNy0yMDIzLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcclxuXHJcbi8qKlxyXG4gKiBBIG5vZGUgdGhhdCBwcm92aWRlcyBhbiBpbnRlcmFjdGlvbiBjdWUgZm9yIGRyYWdnaW5nIHRoZSBiYWxsb29uIGluIEJhbGxvb25zIGFuZCBTdGF0aWMgRWxlY3RyaWNpdHkuIEluY2x1ZGVzIGFycm93XHJcbiAqIGFuZCBsZXR0ZXIga2V5cyB0byBpbmRpY2F0ZSB0aGF0IHRoZSB1c2VyIGNhbiB1c2UgV0FTRCBvciBhcnJvdyBrZXlzIHRvIG1vdmUgaXQgYXJvdW5kIHRoZSBwbGF5IGFyZWEuXHJcbiAqXHJcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnXHJcbiAqL1xyXG5cclxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IExldHRlcktleU5vZGUgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL2tleWJvYXJkL0xldHRlcktleU5vZGUuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IHsgSEJveCwgTm9kZSwgUGF0aCwgVkJveCB9IGZyb20gJy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XHJcbmltcG9ydCBiYWxsb29uc0FuZFN0YXRpY0VsZWN0cmljaXR5IGZyb20gJy4uLy4uL2JhbGxvb25zQW5kU3RhdGljRWxlY3RyaWNpdHkuanMnO1xyXG5pbXBvcnQgUGxheUFyZWFNYXAgZnJvbSAnLi4vbW9kZWwvUGxheUFyZWFNYXAuanMnO1xyXG5cclxuLy8gY29uc3RhbnRzXHJcbmNvbnN0IEFSUk9XX0hFSUdIVCA9IDE1OyAvLyBkaW1lbnNpb25zIGZvciB0aGUgYXJyb3cgaWNvbnNcclxuY29uc3QgS0VZX0hFSUdIVCA9IDI0OyAvLyBoZWlnaHQgb2YgdGhlIGFycm93IGtleSwgbGFyZ2VyIHRoYW4gZGVmYXVsdCBLZXlOb2RlIGhlaWdodFxyXG5jb25zdCBBUlJPV19XSURUSCA9IDEgLyAyICogTWF0aC5zcXJ0KCAzICkgKiBBUlJPV19IRUlHSFQ7IC8vIGZvciBlcXVpbGF0ZXJhbCB0cmlhbmdsZVxyXG5jb25zdCBMRVRURVJfS0VZX09QVElPTlMgPSB7IGZvbnQ6IG5ldyBQaGV0Rm9udCggMTQgKSwga2V5SGVpZ2h0OiBLRVlfSEVJR0hUIH07XHJcbmNvbnN0IEtFWV9BUlJPV19TUEFDSU5HID0gMjtcclxuY29uc3QgQkFMTE9PTl9LRVlfU1BBQ0lORyA9IDg7XHJcbmNvbnN0IFNIQURPV19XSURUSCA9IDI7XHJcblxyXG4vLyBwb3NzaWJsZSBkaXJlY3Rpb25zIG9yIHRoZSBkaXJlY3Rpb25hbCBjdWVzXHJcbmNvbnN0IERJUkVDVElPTl9BTkdMRVMgPSB7XHJcbiAgdXA6IDAsXHJcbiAgZG93bjogTWF0aC5QSSxcclxuICBsZWZ0OiAtTWF0aC5QSSAvIDIsXHJcbiAgcmlnaHQ6IE1hdGguUEkgLyAyXHJcbn07XHJcblxyXG5jbGFzcyBCYWxsb29uSW50ZXJhY3Rpb25DdWVOb2RlIGV4dGVuZHMgTm9kZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7QkFTRU1vZGVsfSBtb2RlbFxyXG4gICAqIEBwYXJhbSB7QmFsbG9vbk1vZGVsfSBiYWxsb29uTW9kZWxcclxuICAgKiBAcGFyYW0ge0JhbGxvb25Ob2RlfSBiYWxsb29uTm9kZVxyXG4gICAqIEBwYXJhbSB7Qm91bmRzMn0gbGF5b3V0Qm91bmRzXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1vZGVsLCBiYWxsb29uTW9kZWwsIGJhbGxvb25Ob2RlLCBsYXlvdXRCb3VuZHMgKSB7XHJcblxyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICAvLyBjcmVhdGUgdGhlIGhlbHAgbm9kZSBmb3IgdGhlIFdBU0QgYW5kIGFycm93IGtleXMsIGludmlzaWJsZSBleGNlcHQgZm9yIG9uIHRoZSBpbml0aWFsIGJhbGxvb24gcGljayB1cFxyXG4gICAgY29uc3QgZGlyZWN0aW9uS2V5c1BhcmVudCA9IG5ldyBOb2RlKCk7XHJcbiAgICB0aGlzLmFkZENoaWxkKCBkaXJlY3Rpb25LZXlzUGFyZW50ICk7XHJcblxyXG4gICAgY29uc3Qgd05vZGUgPSB0aGlzLmNyZWF0ZU1vdmVtZW50S2V5Tm9kZSggJ3VwJyApO1xyXG4gICAgY29uc3QgYU5vZGUgPSB0aGlzLmNyZWF0ZU1vdmVtZW50S2V5Tm9kZSggJ2xlZnQnICk7XHJcbiAgICBjb25zdCBzTm9kZSA9IHRoaXMuY3JlYXRlTW92ZW1lbnRLZXlOb2RlKCAnZG93bicgKTtcclxuICAgIGNvbnN0IGROb2RlID0gdGhpcy5jcmVhdGVNb3ZlbWVudEtleU5vZGUoICdyaWdodCcgKTtcclxuXHJcbiAgICBkaXJlY3Rpb25LZXlzUGFyZW50LmFkZENoaWxkKCB3Tm9kZSApO1xyXG4gICAgZGlyZWN0aW9uS2V5c1BhcmVudC5hZGRDaGlsZCggYU5vZGUgKTtcclxuICAgIGRpcmVjdGlvbktleXNQYXJlbnQuYWRkQ2hpbGQoIHNOb2RlICk7XHJcbiAgICBkaXJlY3Rpb25LZXlzUGFyZW50LmFkZENoaWxkKCBkTm9kZSApO1xyXG5cclxuICAgIC8vIGFkZCBsaXN0ZW5lcnMgdG8gdXBkYXRlIHZpc2liaWxpdHkgb2Ygbm9kZXMgd2hlbiBwb3NpdGlvbiBjaGFuZ2VzIGFuZCB3aGVuIHRoZSB3YWxsIGlzIG1hZGVcclxuICAgIC8vIHZpc2libGUvaW52aXNpYmxlXHJcbiAgICBNdWx0aWxpbmsubXVsdGlsaW5rKCBbIGJhbGxvb25Nb2RlbC5wb3NpdGlvblByb3BlcnR5LCBtb2RlbC53YWxsLmlzVmlzaWJsZVByb3BlcnR5IF0sICggcG9zaXRpb24sIHZpc2libGUgKSA9PiB7XHJcblxyXG4gICAgICAvLyBnZXQgdGhlIG1heCB4IHBvc2l0aW9ucyBkZXBlbmRpbmcgb24gaWYgdGhlIHdhbGwgaXMgdmlzaWJsZVxyXG4gICAgICBsZXQgY2VudGVyWFJpZ2h0Qm91bmRhcnk7XHJcbiAgICAgIGlmICggdmlzaWJsZSApIHtcclxuICAgICAgICBjZW50ZXJYUmlnaHRCb3VuZGFyeSA9IFBsYXlBcmVhTWFwLlhfUE9TSVRJT05TLkFUX1dBTEw7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgY2VudGVyWFJpZ2h0Qm91bmRhcnkgPSBQbGF5QXJlYU1hcC5YX0JPVU5EQVJZX1BPU0lUSU9OUy5BVF9SSUdIVF9FREdFO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBiYWxsb29uQ2VudGVyID0gYmFsbG9vbk1vZGVsLmdldENlbnRlcigpO1xyXG4gICAgICBhTm9kZS52aXNpYmxlID0gYmFsbG9vbkNlbnRlci54ICE9PSBQbGF5QXJlYU1hcC5YX0JPVU5EQVJZX1BPU0lUSU9OUy5BVF9MRUZUX0VER0U7XHJcbiAgICAgIHNOb2RlLnZpc2libGUgPSBiYWxsb29uQ2VudGVyLnkgIT09IFBsYXlBcmVhTWFwLllfQk9VTkRBUllfUE9TSVRJT05TLkFUX0JPVFRPTTtcclxuICAgICAgZE5vZGUudmlzaWJsZSA9IGJhbGxvb25DZW50ZXIueCAhPT0gY2VudGVyWFJpZ2h0Qm91bmRhcnk7XHJcbiAgICAgIHdOb2RlLnZpc2libGUgPSBiYWxsb29uQ2VudGVyLnkgIT09IFBsYXlBcmVhTWFwLllfQk9VTkRBUllfUE9TSVRJT05TLkFUX1RPUDtcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBwbGFjZSB0aGUgZGlyZWN0aW9uIGN1ZXMgcmVsYXRpdmUgdG8gdGhlIGJhbGxvb24gYm91bmRzXHJcbiAgICBjb25zdCBiYWxsb29uQm91bmRzID0gYmFsbG9vbk1vZGVsLmJvdW5kcztcclxuICAgIHdOb2RlLmNlbnRlckJvdHRvbSA9IGJhbGxvb25Cb3VuZHMuZ2V0Q2VudGVyVG9wKCkucGx1c1hZKCAwLCAtQkFMTE9PTl9LRVlfU1BBQ0lORyApO1xyXG4gICAgYU5vZGUucmlnaHRDZW50ZXIgPSBiYWxsb29uQm91bmRzLmdldExlZnRDZW50ZXIoKS5wbHVzWFkoIC1CQUxMT09OX0tFWV9TUEFDSU5HLCAwICk7XHJcbiAgICBzTm9kZS5jZW50ZXJUb3AgPSBiYWxsb29uQm91bmRzLmdldENlbnRlckJvdHRvbSgpLnBsdXNYWSggMCwgQkFMTE9PTl9LRVlfU1BBQ0lORyArIFNIQURPV19XSURUSCApO1xyXG4gICAgZE5vZGUubGVmdENlbnRlciA9IGJhbGxvb25Cb3VuZHMuZ2V0UmlnaHRDZW50ZXIoKS5wbHVzWFkoIEJBTExPT05fS0VZX1NQQUNJTkcgKyBTSEFET1dfV0lEVEgsIDAgKTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGUgYSBub2RlIHRoYXQgbG9va3MgbGlrZSBhIGtleWJvYXJkIGxldHRlciBrZXkgbmV4dCB0byBhbiBhcnJvdyBpbmRpY2F0aW5nIHRoZSBkaXJlY3Rpb24gdGhlIGJhbGxvb25cclxuICAgKiB3b3VsZCBtb3ZlIGlmIHRoYXQga2V5IGlzIHByZXNzZWQuXHJcbiAgICpcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGRpcmVjdGlvbiAtICd1cCd8J2Rvd24nfCdsZWZ0J3wncmlnaHQnXHJcbiAgICogQHJldHVybnMge05vZGV9XHJcbiAgICovXHJcbiAgY3JlYXRlTW92ZW1lbnRLZXlOb2RlKCBkaXJlY3Rpb24gKSB7XHJcblxyXG4gICAgLy8gY3JlYXRlIHRoZSBhcnJvdyBpY29uXHJcbiAgICBjb25zdCBhcnJvd1NoYXBlID0gbmV3IFNoYXBlKCk7XHJcbiAgICBhcnJvd1NoYXBlLm1vdmVUbyggQVJST1dfSEVJR0hUIC8gMiwgMCApLmxpbmVUbyggQVJST1dfSEVJR0hULCBBUlJPV19XSURUSCApLmxpbmVUbyggMCwgQVJST1dfV0lEVEggKS5jbG9zZSgpO1xyXG4gICAgY29uc3QgYXJyb3dJY29uID0gbmV3IFBhdGgoIGFycm93U2hhcGUsIHtcclxuICAgICAgZmlsbDogJ3doaXRlJyxcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBsaW5lSm9pbjogJ2JldmVsJyxcclxuICAgICAgbGluZUNhcDogJ2J1dHQnLFxyXG4gICAgICBsaW5lV2lkdGg6IDIsXHJcbiAgICAgIHJvdGF0aW9uOiBESVJFQ1RJT05fQU5HTEVTWyBkaXJlY3Rpb24gXVxyXG4gICAgfSApO1xyXG5cclxuICAgIC8vIGNyZWF0ZSB0aGUgbGV0dGVyIGtleSBub2RlcyBhbmQgcGxhY2UgaW4gdGhlIGNvcnJlY3QgbGF5b3V0IGJveFxyXG4gICAgbGV0IGtleUljb247XHJcbiAgICBsZXQgYm94O1xyXG4gICAgaWYgKCBkaXJlY3Rpb24gPT09ICd1cCcgKSB7XHJcbiAgICAgIGtleUljb24gPSBMZXR0ZXJLZXlOb2RlLncoIExFVFRFUl9LRVlfT1BUSU9OUyApO1xyXG4gICAgICBib3ggPSBuZXcgVkJveCggeyBjaGlsZHJlbjogWyBhcnJvd0ljb24sIGtleUljb24gXSwgc3BhY2luZzogS0VZX0FSUk9XX1NQQUNJTkcgfSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIGRpcmVjdGlvbiA9PT0gJ2xlZnQnICkge1xyXG4gICAgICBrZXlJY29uID0gTGV0dGVyS2V5Tm9kZS5hKCBMRVRURVJfS0VZX09QVElPTlMgKTtcclxuICAgICAgYm94ID0gbmV3IEhCb3goIHsgY2hpbGRyZW46IFsgYXJyb3dJY29uLCBrZXlJY29uIF0sIHNwYWNpbmc6IEtFWV9BUlJPV19TUEFDSU5HIH0gKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCBkaXJlY3Rpb24gPT09ICdyaWdodCcgKSB7XHJcbiAgICAgIGtleUljb24gPSBMZXR0ZXJLZXlOb2RlLmQoIExFVFRFUl9LRVlfT1BUSU9OUyApO1xyXG4gICAgICBib3ggPSBuZXcgSEJveCggeyBjaGlsZHJlbjogWyBrZXlJY29uLCBhcnJvd0ljb24gXSwgc3BhY2luZzogS0VZX0FSUk9XX1NQQUNJTkcgfSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoIGRpcmVjdGlvbiA9PT0gJ2Rvd24nICkge1xyXG4gICAgICBrZXlJY29uID0gTGV0dGVyS2V5Tm9kZS5zKCBMRVRURVJfS0VZX09QVElPTlMgKTtcclxuICAgICAgYm94ID0gbmV3IFZCb3goIHsgY2hpbGRyZW46IFsga2V5SWNvbiwgYXJyb3dJY29uIF0sIHNwYWNpbmc6IEtFWV9BUlJPV19TUEFDSU5HIH0gKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBib3gsIGBObyBib3ggY3JlYXRlZCBmb3IgZGlyZWN0aW9uICR7ZGlyZWN0aW9ufWAgKTtcclxuICAgIHJldHVybiBib3g7XHJcbiAgfVxyXG59XHJcblxyXG5iYWxsb29uc0FuZFN0YXRpY0VsZWN0cmljaXR5LnJlZ2lzdGVyKCAnQmFsbG9vbkludGVyYWN0aW9uQ3VlTm9kZScsIEJhbGxvb25JbnRlcmFjdGlvbkN1ZU5vZGUgKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IEJhbGxvb25JbnRlcmFjdGlvbkN1ZU5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsU0FBUyxNQUFNLGtDQUFrQztBQUN4RCxTQUFTQyxLQUFLLFFBQVEsZ0NBQWdDO0FBQ3RELE9BQU9DLGFBQWEsTUFBTSx1REFBdUQ7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